{
    "hands_on_practices": [
        {
            "introduction": "The success of any hierarchical multiscale model hinges on a clear separation of scales. This exercise provides a concrete method to quantify this separation using the nondimensional parameter $\\epsilon = \\ell_{\\text{micro}} / \\ell_{\\text{macro}}$. By calculating $\\epsilon$ and understanding its relation to the leading-order modeling error, you will learn to justify the use of homogenization-based strategies and estimate their inherent accuracy .",
            "id": "3767411",
            "problem": "A heterogeneous linear elastic solid with a periodic microstructure is modeled using a hierarchical sequential multiscale (homogenization-based) strategy, in which a Representative Volume Element (RVE) is used to compute an effective constitutive response passed to a macroscale boundary value problem. Let the characteristic microstructural length be $\\ell_{\\text{micro}}$ and the characteristic length over which the macroscopic fields vary (macroscopic gradient length scale) be $\\ell_{\\text{macro}}$. Define the nondimensional scale-separation parameter $\\epsilon$ by $\\epsilon = \\ell_{\\text{micro}} / \\ell_{\\text{macro}}$. Assume standard smoothness and periodicity conditions for asymptotic homogenization to apply and that the macroscopic problem retains only the leading-order (homogenized) term, neglecting higher-order gradient effects and boundary layers away from external boundaries.\n\nUsing only fundamental principles of scale separation and asymptotic expansions, determine the order of the modeling error introduced by the hierarchical sequential strategy in terms of $\\epsilon$. Then, for a material with known microstructural length $\\ell_{\\text{micro}} = 1\\,\\mu\\text{m}$ and macroscopic gradient length scale $\\ell_{\\text{macro}} = 1\\,\\text{mm}$, compute $\\epsilon$ and evaluate the predicted leading-order relative error magnitude as a pure number. State in your reasoning whether the hierarchical sequential strategy is justified under these conditions. Report only the predicted leading-order relative error magnitude as your final answer, rounded to three significant figures. Do not include any units in your final answer.",
            "solution": "The problem statement is first subjected to a rigorous validation process.\n\n### Step 1: Extract Givens\n-   **Model:** A hierarchical sequential multiscale (homogenization-based) strategy is used for a heterogeneous linear elastic solid with a periodic microstructure.\n-   **Methodology:** A Representative Volume Element (RVE) is used to compute an effective constitutive response for a macroscale boundary value problem.\n-   **Characteristic Lengths:** Microstructural length $\\ell_{\\text{micro}}$ and macroscopic gradient length scale $\\ell_{\\text{macro}}$.\n-   **Nondimensional Parameter:** The scale-separation parameter is defined as $\\epsilon = \\ell_{\\text{micro}} / \\ell_{\\text{macro}}$.\n-   **Assumptions:**\n    1.  Standard smoothness and periodicity conditions for asymptotic homogenization apply.\n    2.  The macroscopic problem retains only the leading-order (homogenized) term.\n    3.  Higher-order gradient effects and boundary layers away from external boundaries are neglected.\n-   **Given Values:** $\\ell_{\\text{micro}} = 1\\,\\mu\\text{m}$ and $\\ell_{\\text{macro}} = 1\\,\\text{mm}$.\n-   **Task:**\n    1.  Determine the order of the modeling error in terms of $\\epsilon$.\n    2.  Compute $\\epsilon$ and evaluate the predicted leading-order relative error magnitude for the given lengths.\n    3.  State whether the strategy is justified.\n    4.  Report the final answer as the predicted leading-order relative error magnitude, rounded to three significant figures.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded:** The problem is firmly rooted in the mathematical theory of homogenization, a standard and well-established method in multiscale modeling and continuum mechanics. The concepts of scale separation, asymptotic expansion, and leading-order approximation are central to this field. The problem is scientifically sound.\n-   **Well-Posed:** The problem is clearly defined and provides all necessary information and assumptions to determine a unique and meaningful solution. It asks for a standard result from homogenization theory and its application to a concrete example.\n-   **Objective:** The problem is stated using precise, unambiguous scientific language, free of subjective or opinion-based content.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is self-contained, scientifically sound, and well-posed. The solution process may proceed.\n\n### Solution Derivation\nThe problem concerns the error analysis of a hierarchical multiscale method based on asymptotic homogenization. In this framework, the solution field (e.g., displacement $u^\\epsilon$) is assumed to depend on both the macroscopic spatial coordinate $x$ and a fast-oscillating microscopic coordinate $y = x/\\epsilon$. The solution is sought as an asymptotic expansion in powers of the small parameter $\\epsilon$:\n$$u^{\\epsilon}(x) \\approx u_0(x, y) + \\epsilon u_1(x, y) + \\epsilon^2 u_2(x, y) + \\mathcal{O}(\\epsilon^3)$$\nHere, $u_i(x,y)$ are periodic functions with respect to the microscale variable $y$.\n\nThe core of the homogenization procedure is to substitute this expansion into the governing partial differential equations (e.g., the equations of linear elastostatics) and collect terms of equal power in $\\epsilon$. The standard result from this procedure is that the leading-order term, $u_0$, is a function of only the macroscopic coordinate, i.e., $u_0(x, y) = u_0(x)$. This function $u_0(x)$ is the solution to the \"homogenized\" or effective macroscopic boundary value problem, which is what the problem refers to as the result of the hierarchical sequential strategy.\n\nThe problem states that the macroscopic model retains *only* the leading-order term. This means the approximation being used is $u^{\\epsilon}(x) \\approx u_0(x)$. The modeling error, which we can denote as $E$, is the difference between the true solution $u^{\\epsilon}(x)$ and the computed leading-order approximation $u_0(x)$:\n$$E = u^{\\epsilon}(x) - u_0(x)$$\nFrom the asymptotic series, this error is:\n$$E \\approx (\\epsilon u_1(x, y) + \\epsilon^2 u_2(x, y) + \\dots)$$\nThe dominant term in the error is the first term that was neglected in the approximation. This is the term of order $\\epsilon$:\n$$E = \\epsilon u_1(x, y) + \\mathcal{O}(\\epsilon^2)$$\nTherefore, the absolute modeling error is of order $\\epsilon$, written as $\\mathcal{O}(\\epsilon)$.\n\nThe problem asks for the *relative* error magnitude. The relative error is the absolute error divided by the characteristic magnitude of the quantity being approximated. The leading-order solution $u_0(x)$ is typically of order one, i.e., $\\mathcal{O}(1)$, in a properly non-dimensionalized problem. Thus, the relative error, $E_{\\text{rel}}$, is:\n$$E_{\\text{rel}} = \\frac{|E|}{|u_0|} = \\frac{\\mathcal{O}(\\epsilon)}{\\mathcal{O}(1)} = \\mathcal{O}(\\epsilon)$$\nThis means the leading-order relative error magnitude is directly proportional to $\\epsilon$. In the absence of further information about the prefactors (which depend on the specific material properties and loading, but are typically of order one), the parameter $\\epsilon$ itself is taken as the estimate for the leading-order relative error magnitude.\n\nNext, we compute the value of $\\epsilon$ for the given lengths.\nThe microstructural length is $\\ell_{\\text{micro}} = 1\\,\\mu\\text{m} = 1 \\times 10^{-6}\\,\\text{m}$.\nThe macroscopic gradient length scale is $\\ell_{\\text{macro}} = 1\\,\\text{mm} = 1 \\times 10^{-3}\\,\\text{m}$.\n\nThe scale-separation parameter $\\epsilon$ is the ratio of these two lengths:\n$$\\epsilon = \\frac{\\ell_{\\text{micro}}}{\\ell_{\\text{macro}}} = \\frac{1 \\times 10^{-6}\\,\\text{m}}{1 \\times 10^{-3}\\,\\text{m}} = 10^{-3} = 0.001$$\nThe leading-order relative error magnitude is therefore estimated to be $0.001$.\n\nThe justification for using the hierarchical sequential strategy depends on the principle of scale separation, which requires $\\epsilon \\ll 1$. In this case, $\\epsilon = 0.001$, which is indeed much less than $1$. This indicates a strong separation of scales. An estimated relative error of $0.001$, or $0.1\\%$, is generally considered small and acceptable in most engineering and scientific contexts. Therefore, the application of the homogenization-based hierarchical strategy is well-justified under these conditions.\n\nThe final task is to report the predicted leading-order relative error magnitude as a pure number, rounded to three significant figures. The calculated value is $\\epsilon = 0.001$. To express this with three significant figures, we write it as $1.00 \\times 10^{-3}$.",
            "answer": "$$\\boxed{1.00 \\times 10^{-3}}$$"
        },
        {
            "introduction": "Hierarchical models often rely on estimating effective properties from a finite number of microscale simulations, introducing statistical uncertainty into the macroscopic prediction. This practice explores the crucial link between microscale computational effort and macroscale predictive confidence . You will apply principles from the Central Limit Theorem and uncertainty propagation to determine the minimum number of simulations needed to achieve a target precision, a vital skill for designing efficient computational workflows.",
            "id": "3767300",
            "problem": "A hierarchical (sequential) multiscale modeling workflow is used to predict a macroscopic displacement response from a microscopically heterogeneous elastic composite. At the microscopic scale, the composite has an effective Young’s modulus $E_{\\mathrm{eff}}$ that varies from one microstructure realization to another due to stochastic morphology. Independent and identically distributed (i.i.d.) microstructure samples yield realizations $\\{E_{\\mathrm{eff}}^{(i)}\\}_{i=1}^{n}$, and the estimator passed up the hierarchy is the sample mean $\\bar{E}_{\\mathrm{eff}}$. You may assume the conditions of the Central Limit Theorem (CLT) are satisfied and that the population standard deviation of $E_{\\mathrm{eff}}$ across microstructure realizations is known and equal to $\\sigma_{E}$. At the macroscale, the structure is a prismatic, linearly elastic bar of length $L$, cross-sectional area $A$, and subjected to an axial force $F$. Under small-strain linear elasticity, the axial displacement at the loaded end is given by $u(E) = \\dfrac{F L}{A E}$ when the bar’s stiffness is represented by the effective modulus $E$ supplied from the microscale.\n\nIn this sequential setup, the uncertainty in $\\bar{E}_{\\mathrm{eff}}$ induces uncertainty in the predicted displacement $u(\\bar{E}_{\\mathrm{eff}})$. Using first-order (linear) uncertainty propagation via a Taylor expansion at the mean modulus and a normal approximation justified by the CLT, determine the minimum number of independent microstructure samples $n$ required so that the two-sided $0.95$ confidence interval for the macroscopic displacement $u(\\bar{E}_{\\mathrm{eff}})$ has half-width no greater than the tolerance $\\delta_{u}$.\n\nUse the following scientifically consistent parameters:\n- Axial force $F = 1.0 \\times 10^{5}\\,\\mathrm{N}$,\n- Length $L = 2.0\\,\\mathrm{m}$,\n- Cross-sectional area $A = 1.0 \\times 10^{-2}\\,\\mathrm{m}^{2}$,\n- Mean effective modulus $\\mu_{E} = 5.0 \\times 10^{10}\\,\\mathrm{Pa}$,\n- Population standard deviation of effective modulus $\\sigma_{E} = 5.0 \\times 10^{8}\\,\\mathrm{Pa}$,\n- Displacement tolerance (confidence interval half-width) $\\delta_{u} = 1.0 \\times 10^{-6}\\,\\mathrm{m}$,\n- Confidence level $0.95$ (so that $z_{0.975}$ from the standard normal distribution applies).\n\nState and use any needed fundamental laws and standard statistical results explicitly. Report the minimal integer $n$ that satisfies the requirement.",
            "solution": "The user has provided a problem statement that requires validation before a solution is attempted.\n\n### Step 1: Extract Givens\n- **Workflow:** Hierarchical (sequential) multiscale modeling.\n- **Microscale Quantity:** Effective Young's modulus, $E_{\\mathrm{eff}}$.\n- **Microscale Samples:** $\\{E_{\\mathrm{eff}}^{(i)}\\}_{i=1}^{n}$ are independent and identically distributed (i.i.d.).\n- **Microscale Estimator:** The sample mean, $\\bar{E}_{\\mathrm{eff}} = \\frac{1}{n} \\sum_{i=1}^{n} E_{\\mathrm{eff}}^{(i)}$.\n- **Statistical Assumptions:** The conditions of the Central Limit Theorem (CLT) are satisfied.\n- **Mean Effective Modulus:** The population mean is $\\mu_{E} = 5.0 \\times 10^{10}\\,\\mathrm{Pa}$.\n- **Standard Deviation of Effective Modulus:** The population standard deviation is $\\sigma_{E} = 5.0 \\times 10^{8}\\,\\mathrm{Pa}$.\n- **Macroscale Model:** A prismatic, linearly elastic bar.\n- **Axial Force:** $F = 1.0 \\times 10^{5}\\,\\mathrm{N}$.\n- **Length:** $L = 2.0\\,\\mathrm{m}$.\n- **Cross-sectional Area:** $A = 1.0 \\times 10^{-2}\\,\\mathrm{m}^{2}$.\n- **Displacement Function:** $u(E) = \\dfrac{F L}{A E}$.\n- **Uncertainty Propagation Method:** First-order (linear) uncertainty propagation via a Taylor expansion at the mean modulus. A normal approximation is used for the output distribution.\n- **Requirement:** The two-sided $0.95$ confidence interval for the macroscopic displacement $u(\\bar{E}_{\\mathrm{eff}})$ must have a half-width no greater than the tolerance $\\delta_{u}$.\n- **Displacement Tolerance:** $\\delta_{u} = 1.0 \\times 10^{-6}\\,\\mathrm{m}$.\n- **Confidence Level:** $0.95$. This implies a significance level of $\\alpha = 0.05$, and for a two-sided interval, the relevant standard normal quantile is $z_{1-\\alpha/2} = z_{0.975}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, employing standard principles of linear elasticity ($u=FL/AE$) and statistical mechanics (Central Limit Theorem, sample mean as an estimator, propagation of uncertainty). The context is a common and important application within computational materials science and multiscale modeling. The problem is well-posed, providing all necessary physical and statistical parameters, assumptions, and a clear objective. The language is objective and precise. The numerical values are physically plausible for engineering materials. No contradictions, ambiguities, or unsound premises are detected. The problem is a valid, solvable exercise in applied science and engineering.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid. A solution will be provided.\n\n### Solution\nThe problem requires finding the minimum number of microscopic simulations, $n$, needed to ensure the predicted macroscopic displacement has a specified level of precision. This is a classic problem in uncertainty propagation within a hierarchical modeling framework.\n\nFirst, we analyze the statistical properties of the estimator for the effective Young's modulus, $\\bar{E}_{\\mathrm{eff}}$. Since the samples $\\{E_{\\mathrm{eff}}^{(i)}\\}_{i=1}^{n}$ are i.i.d. with population mean $\\mu_E$ and population standard deviation $\\sigma_E$, the sample mean $\\bar{E}_{\\mathrm{eff}}$ has the following properties:\n- Mean: $E[\\bar{E}_{\\mathrm{eff}}] = \\mu_E$.\n- Variance: $\\mathrm{Var}(\\bar{E}_{\\mathrm{eff}}) = \\frac{\\sigma_E^2}{n}$.\n- Standard deviation (also known as the standard error of the mean): $\\sigma_{\\bar{E}} = \\frac{\\sigma_E}{\\sqrt{n}}$.\n\nThe problem states that the conditions for the Central Limit Theorem (CLT) are met. Therefore, for a sufficiently large $n$, the distribution of $\\bar{E}_{\\mathrm{eff}}$ can be approximated by a normal distribution:\n$$ \\bar{E}_{\\mathrm{eff}} \\sim \\mathcal{N}\\left(\\mu_E, \\frac{\\sigma_E^2}{n}\\right) $$\n\nNext, we propagate the uncertainty from the input modulus $\\bar{E}_{\\mathrm{eff}}$ to the output displacement $u(\\bar{E}_{\\mathrm{eff}})$. The relationship is given by:\n$$ u(E) = \\frac{FL}{AE} $$\nWe are instructed to use a first-order Taylor series expansion of $u(\\bar{E}_{\\mathrm{eff}})$ around the mean value $\\mu_E$:\n$$ u(\\bar{E}_{\\mathrm{eff}}) \\approx u(\\mu_E) + \\frac{du}{dE}\\bigg|_{E=\\mu_E} (\\bar{E}_{\\mathrm{eff}} - \\mu_E) $$\nThe derivative of $u(E)$ with respect to $E$ is:\n$$ \\frac{du}{dE} = \\frac{d}{dE} \\left( \\frac{FL}{A} E^{-1} \\right) = -\\frac{FL}{AE^2} $$\nEvaluating this derivative at $E = \\mu_E$ gives:\n$$ \\frac{du}{dE}\\bigg|_{E=\\mu_E} = -\\frac{FL}{A\\mu_E^2} $$\nSubstituting this into the Taylor expansion gives the linearized model for the displacement:\n$$ u(\\bar{E}_{\\mathrm{eff}}) \\approx \\frac{FL}{A\\mu_E} - \\frac{FL}{A\\mu_E^2} (\\bar{E}_{\\mathrm{eff}} - \\mu_E) $$\nSince this is a linear transformation of the approximately normal variable $\\bar{E}_{\\mathrm{eff}}$, the resulting displacement $u(\\bar{E}_{\\mathrm{eff}})$ is also approximately normally distributed. The mean and variance of $u(\\bar{E}_{\\mathrm{eff}})$ under this linear approximation are:\n$$ E[u(\\bar{E}_{\\mathrm{eff}})] \\approx u(\\mu_E) = \\frac{FL}{A\\mu_E} $$\n$$ \\mathrm{Var}(u(\\bar{E}_{\\mathrm{eff}})) \\approx \\left( \\frac{du}{dE}\\bigg|_{E=\\mu_E} \\right)^2 \\mathrm{Var}(\\bar{E}_{\\mathrm{eff}}) = \\left( -\\frac{FL}{A\\mu_E^2} \\right)^2 \\left( \\frac{\\sigma_E^2}{n} \\right) = \\left( \\frac{FL}{A\\mu_E^2} \\right)^2 \\frac{\\sigma_E^2}{n} $$\nThe standard deviation of the displacement, $\\sigma_u$, is the square root of the variance:\n$$ \\sigma_u \\approx \\sqrt{\\left( \\frac{FL}{A\\mu_E^2} \\right)^2 \\frac{\\sigma_E^2}{n}} = \\frac{FL}{A\\mu_E^2} \\frac{\\sigma_E}{\\sqrt{n}} $$\nWe are asked to construct a two-sided $0.95$ confidence interval for the displacement. For a normally distributed variable, this interval is given by $[E[u] - W, E[u] + W]$, where $W$ is the half-width. The half-width is defined as:\n$$ W = z_{1-\\alpha/2} \\sigma_u $$\nwhere for a $0.95$ confidence level, $\\alpha=0.05$, and $1-\\alpha/2 = 0.975$. The corresponding value from the standard normal distribution is $z_{0.975} \\approx 1.96$.\n\nThe problem requires that this half-width be no greater than the specified tolerance $\\delta_u$:\n$$ W \\le \\delta_u $$\n$$ z_{0.975} \\sigma_u \\le \\delta_u $$\nSubstituting the expression for $\\sigma_u$:\n$$ z_{0.975} \\left( \\frac{FL}{A\\mu_E^2} \\frac{\\sigma_E}{\\sqrt{n}} \\right) \\le \\delta_u $$\nWe now solve this inequality for the integer $n$:\n$$ \\sqrt{n} \\ge \\frac{z_{0.975} FL \\sigma_E}{\\delta_u A \\mu_E^2} $$\n$$ n \\ge \\left( \\frac{z_{0.975} FL \\sigma_E}{\\delta_u A \\mu_E^2} \\right)^2 $$\nNow we substitute the given numerical values:\n- $z_{0.975} \\approx 1.96$\n- $F = 1.0 \\times 10^5$\n- $L = 2.0$\n- $\\sigma_E = 5.0 \\times 10^8$\n- $\\delta_u = 1.0 \\times 10^{-6}$\n- $A = 1.0 \\times 10^{-2}$\n- $\\mu_E = 5.0 \\times 10^{10}$\n\nLet's calculate the term in the parentheses:\n$$ \\frac{z_{0.975} FL \\sigma_E}{\\delta_u A \\mu_E^2} = \\frac{(1.96)(1.0 \\times 10^5)(2.0)(5.0 \\times 10^8)}{(1.0 \\times 10^{-6})(1.0 \\times 10^{-2})(5.0 \\times 10^{10})^2} $$\n$$ = \\frac{1.96 \\times 2.0 \\times 5.0 \\times 10^5 \\times 10^8}{1.0 \\times 10^{-6} \\times 10^{-2} \\times 25.0 \\times 10^{20}} = \\frac{19.6 \\times 10^{13}}{25.0 \\times 10^{12}} = \\frac{196 \\times 10^{12}}{25.0 \\times 10^{12}} = \\frac{196}{25} = 7.84 $$\nNow, we square this result to find the lower bound for $n$:\n$$ n \\ge (7.84)^2 = 61.4656 $$\nSince the number of samples $n$ must be an integer, we must take the smallest integer that satisfies this condition, which is the ceiling of the calculated value:\n$$ n_{\\min} = \\lceil 61.4656 \\rceil = 62 $$\nThus, a minimum of $62$ independent microstructure samples are required to achieve the desired precision for the macroscopic displacement prediction.",
            "answer": "$$\\boxed{62}$$"
        },
        {
            "introduction": "Moving beyond linear statics, this practice delves into the implementation of a hierarchical multiscale scheme for a challenging nonlinear, transient diffusion problem. You will derive and implement an upscaled flux for a finite volume macro-solver by solving local, steady-state microscale problems at each interface . This exercise demonstrates how the principles of scale separation are put into practice to build a predictive dynamic simulation, bridging the gap between theory and computational application.",
            "id": "3767356",
            "problem": "Consider the one-dimensional, dimensionless, nonlinear diffusion equation on a macroscopic interval with microscopic heterogeneity, posed in conservative form as $$\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\left(k(x,u)\\frac{\\partial u}{\\partial x}\\right),$$ where $u$ is a scalar field, $x$ is a spatial coordinate, $t$ is time, and $k(x,u)$ is a positive diffusion coefficient. Assume that the diffusion coefficient factors as $$k(x,u) = a(x)\\,f(u),$$ with $a(x) > 0$ representing a spatially varying microscale heterogeneity and $f(u) > 0$ representing a nonlinear dependence on the state variable $u$. The upscaling task is hierarchical and sequential: at each macroscopic interface, a local microscale steady-state problem is solved to produce a single effective flux that is used by a finite volume method (FVM) macroscopic update.\n\nAt the macroscale, discretize the domain $[0,L]$ into $N$ cells of uniform size $\\Delta X = L/N$ with cell centers $\\{x_i\\}_{i=1}^{N}$ and interfaces $\\{x_{i+\\frac{1}{2}}\\}_{i=0}^{N}$, where $x_{i+\\frac{1}{2}} = i\\,\\Delta X$ and $x_i = \\left(i-\\frac{1}{2}\\right)\\Delta X$. Let $u_i^n$ denote the cell average approximation at time level $t^n$, and define the interface quantity $$q = k(x,u)\\,\\frac{\\partial u}{\\partial x},$$ such that the FVM update is $$u_i^{n+1} = u_i^n + \\frac{\\Delta t}{\\Delta X}\\left(q_{i+\\frac{1}{2}}^n - q_{i-\\frac{1}{2}}^n\\right).$$ Impose zero-flux (homogeneous Neumann) boundary conditions at the domain endpoints, namely $q_{-\\frac{1}{2}}^n = 0$ and $q_{N+\\frac{1}{2}}^n = 0$.\n\nAt each interior macroscopic interface $x_{i+\\frac{1}{2}}$, define a local microscale interval of length $L_{\\text{micro}}$ centered at $x_{i+\\frac{1}{2}}$, that is, $$I_{i+\\frac{1}{2}} = \\left[x_{i+\\frac{1}{2}} - \\frac{L_{\\text{micro}}}{2},\\, x_{i+\\frac{1}{2}} + \\frac{L_{\\text{micro}}}{2}\\right].$$ On $I_{i+\\frac{1}{2}}$, solve the microscale steady-state problem $$\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(a(x)\\,f(u)\\,\\frac{\\mathrm{d}u}{\\mathrm{d}x}\\right) = 0,$$ with Dirichlet boundary conditions consistent with the macroscopic states on the adjacent cells, namely $$u\\left(x_{i+\\frac{1}{2}} - \\frac{L_{\\text{micro}}}{2}\\right) = u_i^n,\\qquad u\\left(x_{i+\\frac{1}{2}} + \\frac{L_{\\text{micro}}}{2}\\right) = u_{i+1}^n.$$ The constant microscale steady flux on $I_{i+\\frac{1}{2}}$ defines the upscaled interface quantity $q_{i+\\frac{1}{2}}^n$ used by the macroscopic update.\n\nYour task is to implement this hierarchical (sequential) multiscale flux upscaling and apply one explicit FVM update step for a small test suite. All variables are dimensionless; no physical units are required. Use the following specifications:\n\n- The nonlinear factor is $$f(u) = 1 + \\beta\\,u^2,$$ with $\\beta > 0$.\n- The microscale heterogeneity $a(x)$ is either periodic or constant, as specified per test case.\n- The local microscale interval length is set equal to the macroscopic cell size, $$L_{\\text{micro}} = \\Delta X.$$\n- The microscale steady problem must be solved to produce the single constant flux on $I_{i+\\frac{1}{2}}$ that is consistent with the Dirichlet boundary data stated above. You must derive this constant flux from first principles and implement it numerically, evaluating any required spatial integrals over $I_{i+\\frac{1}{2}}$ by a suitable quadrature.\n\nImplement the algorithm to produce, for each test case, the list of macroscopic cell averages $\\{u_i^{n+1}\\}_{i=1}^{N}$ after one explicit FVM update step starting from a prescribed initial field $\\{u_i^0\\}_{i=1}^{N}$.\n\nTest Suite and parameters:\n\n- Case A (happy path, heterogeneous periodic microscale):\n  - $N = 5$, $L = 1$, $\\Delta t = 10^{-4}$, $\\beta = 2$, $L_{\\text{micro}} = \\Delta X$.\n  - $a(x) = 2 + 0.5\\sin\\left(\\frac{2\\pi x}{p}\\right) + 0.25\\cos\\left(\\frac{4\\pi x}{p}\\right)$ with $p = 0.2$.\n  - Initial condition $u_i^0 = 0.3 + 0.2\\sin\\left(\\frac{2\\pi x_i}{L}\\right)$ for $i = 1,\\dots,N$.\n- Case B (boundary condition edge case, uniform microscale coefficient, minimal grid):\n  - $N = 2$, $L = 1$, $\\Delta t = 10^{-3}$, $\\beta = 1$, $L_{\\text{micro}} = \\Delta X$.\n  - $a(x) \\equiv 2$ (constant).\n  - Initial condition $u_i^0 = 0.05 + 0.01\\,x_i$ for $i = 1,2$.\n- Case C (strong nonlinearity, heterogeneous periodic microscale):\n  - $N = 4$, $L = 1$, $\\Delta t = 5\\times 10^{-6}$, $\\beta = 50$, $L_{\\text{micro}} = \\Delta X$.\n  - $a(x) = 1.5 + 0.9\\sin\\left(\\frac{2\\pi x}{p}\\right) + 0.4\\cos\\left(\\frac{4\\pi x}{p}\\right)$ with $p = 0.1$.\n  - Initial condition $u_i^0 = 0.1 + 0.05\\cos\\left(\\frac{\\pi x_i}{L}\\right)$ for $i = 1,\\dots,N$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The outer list should contain one inner list per case, in order A, B, C, and each inner list should contain the updated macroscopic cell averages $\\{u_i^{n+1}\\}_{i=1}^{N}$ for that case. For example, the format should be $$[\\,[u_1^{n+1},\\dots,u_N^{n+1}],\\,[\\dots],\\,[\\dots]\\,],$$ with numerical values printed as floats.",
            "solution": "We begin from first principles. The macroscopic governing equation is $$\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\left(k(x,u)\\frac{\\partial u}{\\partial x}\\right),$$ where $k(x,u) = a(x)\\,f(u)$, $a(x) > 0$, and $f(u) > 0$. The associated conservative quantity on an interface is $$q = k(x,u)\\frac{\\partial u}{\\partial x},$$ so that the finite volume method (FVM) update on a uniform grid of cell size $\\Delta X$ is $$u_i^{n+1} = u_i^n + \\frac{\\Delta t}{\\Delta X}\\left(q_{i+\\frac{1}{2}}^n - q_{i-\\frac{1}{2}}^n\\right),$$ where $q_{i+\\frac{1}{2}}^n$ is the interface quantity obtained from the microscale computation and zero-flux boundary conditions imply $q_{-\\frac{1}{2}}^n = 0$ and $q_{N+\\frac{1}{2}}^n = 0$.\n\nThe hierarchical (sequential) upscaling step defines a local microscale boundary value problem at each macroscopic interface $x_{i+\\frac{1}{2}}$ on the interval $$I_{i+\\frac{1}{2}} = \\left[x_{i+\\frac{1}{2}} - \\frac{L_{\\text{micro}}}{2},\\, x_{i+\\frac{1}{2}} + \\frac{L_{\\text{micro}}}{2}\\right],$$ where $L_{\\text{micro}} = \\Delta X$. On $I_{i+\\frac{1}{2}}$, solve the steady microscale problem $$\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(a(x)\\,f(u)\\,\\frac{\\mathrm{d}u}{\\mathrm{d}x}\\right) = 0,$$ subject to Dirichlet boundary conditions $$u\\left(x_{i+\\frac{1}{2}} - \\frac{L_{\\text{micro}}}{2}\\right) = u_i^n,\\qquad u\\left(x_{i+\\frac{1}{2}} + \\frac{L_{\\text{micro}}}{2}\\right) = u_{i+1}^n,$$ inherited from the adjacent macroscopic cell states. The steady equation implies that the quantity $$q(x) = a(x)\\,f(u)\\,\\frac{\\mathrm{d}u}{\\mathrm{d}x}$$ is constant with respect to $x$ on $I_{i+\\frac{1}{2}}$, i.e., $$\\frac{\\mathrm{d}q}{\\mathrm{d}x} = 0,\\qquad q(x) \\equiv q_{i+\\frac{1}{2}}^n.$$ Because $a(x) > 0$ and $f(u) > 0$, the microscale problem is strictly monotone, and the boundary value problem is well-posed with a unique steady-state solution connecting $u_i^n$ to $u_{i+1}^n$.\n\nTo derive $q_{i+\\frac{1}{2}}^n$ from first principles, observe that the steady microscale relation can be rearranged to the first-order ordinary differential equation $$\\frac{\\mathrm{d}u}{\\mathrm{d}x} = \\frac{q_{i+\\frac{1}{2}}^n}{a(x)\\,f(u)}.$$ This equation is separable. Multiply both sides by $f(u)$ and integrate across the microscale interval and the corresponding range in $u$:\n$$\\int_{u_i^n}^{u_{i+1}^n} f(s)\\,\\mathrm{d}s = q_{i+\\frac{1}{2}}^n \\int_{x_{i+\\frac{1}{2}} - \\frac{L_{\\text{micro}}}{2}}^{x_{i+\\frac{1}{2}} + \\frac{L_{\\text{micro}}}{2}} \\frac{1}{a(x)}\\,\\mathrm{d}x.$$\nHence, the constant microscale flux is determined solely by the boundary values and the heterogeneity through the integrals,\n$$q_{i+\\frac{1}{2}}^n = \\frac{\\displaystyle\\int_{u_i^n}^{u_{i+1}^n} f(s)\\,\\mathrm{d}s}{\\displaystyle\\int_{x_{i+\\frac{1}{2}} - \\frac{L_{\\text{micro}}}{2}}^{x_{i+\\frac{1}{2}} + \\frac{L_{\\text{micro}}}{2}} \\frac{1}{a(x)}\\,\\mathrm{d}x}.$$\nFor the specific choice $f(u) = 1 + \\beta\\,u^2$ with $\\beta > 0$, the antiderivative is explicit: $$\\int f(s)\\,\\mathrm{d}s = \\int \\left(1 + \\beta s^2\\right)\\mathrm{d}s = s + \\frac{\\beta}{3}s^3,$$ so that\n$$\\int_{u_i^n}^{u_{i+1}^n} f(s)\\,\\mathrm{d}s = \\left(u_{i+1}^n - u_i^n\\right) + \\frac{\\beta}{3}\\left[\\left(u_{i+1}^n\\right)^3 - \\left(u_i^n\\right)^3\\right].$$\nThe denominator integral $$\\int_{x_{i+\\frac{1}{2}} - \\frac{L_{\\text{micro}}}{2}}^{x_{i+\\frac{1}{2}} + \\frac{L_{\\text{micro}}}{2}} \\frac{1}{a(x)}\\,\\mathrm{d}x$$ must be evaluated numerically for heterogeneous $a(x)$, for example, by composite trapezoidal or Simpson quadrature on a sufficiently fine microscale grid over $I_{i+\\frac{1}{2}}$. In the uniform case $a(x) \\equiv a_0$, the integral reduces to $$\\int \\frac{1}{a_0}\\,\\mathrm{d}x = \\frac{L_{\\text{micro}}}{a_0}.$$\n\nWith $q_{i+\\frac{1}{2}}^n$ assembled for all interfaces, the explicit FVM update is performed,\n$$u_i^{n+1} = u_i^n + \\frac{\\Delta t}{\\Delta X}\\left(q_{i+\\frac{1}{2}}^n - q_{i-\\frac{1}{2}}^n\\right),\\qquad i=1,\\dots,N,$$\nwith zero-flux boundary conditions implemented by setting $q_{-\\frac{1}{2}}^n = 0$ and $q_{N+\\frac{1}{2}}^n = 0$. The choice $L_{\\text{micro}} = \\Delta X$ ties the microscale interval size to the macroscale cell size, a common hierarchical (sequential) multiscale modeling choice that preserves locality and computational efficiency.\n\nAlgorithmic design:\n\n- Construct the macroscopic grid: define $x_{i+\\frac{1}{2}} = i\\,\\Delta X$ and $x_i = \\left(i-\\frac{1}{2}\\right)\\Delta X$ for $i=0,\\dots,N$ and $i=1,\\dots,N$ respectively.\n- For each interior interface $i = 1,\\dots,N-1$:\n  - Define the microscale interval $I_{i+\\frac{1}{2}} = \\left[x_{i+\\frac{1}{2}} - \\frac{\\Delta X}{2},\\,x_{i+\\frac{1}{2}} + \\frac{\\Delta X}{2}\\right]$.\n  - Evaluate the denominator integral $\\int_{I_{i+\\frac{1}{2}}} \\frac{1}{a(x)}\\,\\mathrm{d}x$ via numerical quadrature on a fine uniform grid over $I_{i+\\frac{1}{2}}$. In the constant case, compute it analytically as $\\frac{\\Delta X}{a_0}$.\n  - Compute the numerator using the explicit antiderivative for $f(u)$ to obtain $\\int_{u_i^n}^{u_{i+1}^n} f(s)\\,\\mathrm{d}s = \\left(u_{i+1}^n - u_i^n\\right) + \\frac{\\beta}{3}\\left[\\left(u_{i+1}^n\\right)^3 - \\left(u_i^n\\right)^3\\right]$.\n  - Form $q_{i+\\frac{1}{2}}^n$ as the quotient of numerator and denominator.\n- Set $q_{-\\frac{1}{2}}^n = 0$ and $q_{N+\\frac{1}{2}}^n = 0$.\n- Update each cell by $u_i^{n+1} = u_i^n + \\frac{\\Delta t}{\\Delta X}\\left(q_{i+\\frac{1}{2}}^n - q_{i-\\frac{1}{2}}^n\\right)$.\n\nThis procedure embodies the hierarchical (sequential) multiscale modeling philosophy: a microscale steady-state computation per interface produces an upscaled interface flux consistent with the nonlinear, heterogeneous physics, which then feeds the macroscale FVM update. The test suite exercises:\n- A heterogeneous periodic $a(x)$ with moderate nonlinearity ($\\beta = 2$), demonstrating spatial variability in $\\int 1/a(x)\\,\\mathrm{d}x$ across interfaces (Case A).\n- A uniform $a(x)$ and minimal grid ($N=2$), stressing boundary treatment and the analytical denominator (Case B).\n- Strong nonlinearity ($\\beta = 50$) with heterogeneous periodic $a(x)$, checking robustness of the flux formula and numerical quadrature at small time step (Case C).\n\nThe program implements these steps and outputs, for each case, the updated macroscopic cell averages $\\{u_i^{n+1}\\}_{i=1}^{N}$ after one explicit step, aggregated into a single outer list printed on one line.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef periodic_a(x, a0, A1, A2, p):\n    \"\"\"\n    Periodic microscale heterogeneity:\n    a(x) = a0 + A1*sin(2*pi*x/p) + A2*cos(4*pi*x/p)\n    \"\"\"\n    return a0 + A1 * np.sin(2.0 * np.pi * x / p) + A2 * np.cos(4.0 * np.pi * x / p)\n\ndef compute_inv_a_integral(a_func, x_start, x_end, num_points=1000):\n    \"\"\"\n    Numerically compute integral_{x_start}^{x_end} (1/a(x)) dx using the trapezoidal rule.\n    \"\"\"\n    xs = np.linspace(x_start, x_end, num_points)\n    ax = a_func(xs)\n    inv_a = 1.0 / ax\n    return np.trapz(inv_a, xs)\n\ndef upscaled_interface_flux(uL, uR, inv_a_integral, beta):\n    \"\"\"\n    Compute q_{i+1/2} from the separable steady-state relation:\n    q = [∫_{uL}^{uR} f(s) ds] / [∫ (1/a(x)) dx], with f(u) = 1 + beta*u^2,\n    so numerator = (uR - uL) + (beta/3) * (uR^3 - uL^3).\n    \"\"\"\n    numerator = (uR - uL) + (beta / 3.0) * (uR**3 - uL**3)\n    return numerator / inv_a_integral\n\ndef fvm_one_step(u, L_macro, a_descriptor, beta, dt):\n    \"\"\"\n    Perform one explicit FVM update step using hierarchical upscaled fluxes.\n    a_descriptor: dict describing the a(x) function type and parameters.\n    Returns updated u after one step.\n    \"\"\"\n    N = len(u)\n    dx = L_macro / N\n    # Cell centers and interfaces\n    x_centers = (np.arange(N) + 0.5) * dx\n    x_interfaces = np.arange(N + 1) * dx\n\n    # Build a(x) function based on descriptor\n    if a_descriptor[\"type\"] == \"periodic\":\n        a0 = a_descriptor[\"a0\"]\n        A1 = a_descriptor[\"A1\"]\n        A2 = a_descriptor[\"A2\"]\n        p = a_descriptor[\"p\"]\n        a_func_all = lambda x: periodic_a(x, a0, A1, A2, p)\n        # inv a integral computed per interface over micro interval centered at the interface\n        inv_a_integral_cache = np.zeros(N + 1)\n        for i in range(1, N):  # interior interfaces only (boundaries are zero flux)\n            x_mid = x_interfaces[i]\n            x_start = x_mid - 0.5 * dx\n            x_end = x_mid + 0.5 * dx\n            inv_a_integral_cache[i] = compute_inv_a_integral(a_func_all, x_start, x_end, num_points=1200)\n        # boundaries not used (zero flux), but keep zeros\n        a_inv_integral_getter = lambda i: inv_a_integral_cache[i]\n    elif a_descriptor[\"type\"] == \"constant\":\n        a0 = a_descriptor[\"a0\"]\n        # For constant a, integral of 1/a over micro interval is dx / a0\n        a_inv_integral_getter = lambda i: dx / a0\n    else:\n        raise ValueError(\"Unknown a(x) descriptor type.\")\n\n    # Compute interface fluxes q_{i+1/2}\n    q = np.zeros(N + 1)\n    # Zero-flux boundaries (Neumann)\n    q[0] = 0.0\n    q[N] = 0.0\n    for i in range(1, N):\n        uL = u[i - 1]\n        uR = u[i]\n        inv_a_int = a_inv_integral_getter(i)\n        q[i] = upscaled_interface_flux(uL, uR, inv_a_int, beta)\n\n    # Explicit FVM update\n    u_new = np.empty_like(u)\n    for i in range(N):\n        u_new[i] = u[i] + (dt / dx) * (q[i + 1] - q[i])\n\n    return u_new.tolist()\n\ndef format_list_no_spaces(obj):\n    \"\"\"\n    Recursively format lists of numbers into a compact string without spaces.\n    \"\"\"\n    if isinstance(obj, list):\n        return '[' + ','.join(format_list_no_spaces(x) for x in obj) + ']'\n    elif isinstance(obj, (float, np.floating)):\n        # Use default str for float to keep reasonable precision\n        return str(float(obj))\n    elif isinstance(obj, (int, np.integer)):\n        return str(int(obj))\n    elif isinstance(obj, bool):\n        return 'True' if obj else 'False'\n    else:\n        # Fallback\n        return str(obj)\n\ndef solve():\n    # Define test cases from the problem statement.\n\n    # Case A: Heterogeneous periodic microscale, N=5, L=1, dt=1e-4, beta=2\n    N_A = 5\n    L_A = 1.0\n    dx_A = L_A / N_A\n    x_centers_A = (np.arange(N_A) + 0.5) * dx_A\n    u0_A = 0.3 + 0.2 * np.sin(2.0 * np.pi * x_centers_A / L_A)\n    a_desc_A = {\n        \"type\": \"periodic\",\n        \"a0\": 2.0,\n        \"A1\": 0.5,\n        \"A2\": 0.25,\n        \"p\": 0.2\n    }\n    beta_A = 2.0\n    dt_A = 1e-4\n    u1_A = fvm_one_step(u0_A.tolist(), L_A, a_desc_A, beta_A, dt_A)\n\n    # Case B: Constant microscale coefficient, boundary condition edge case, N=2, L=1, dt=1e-3, beta=1\n    N_B = 2\n    L_B = 1.0\n    dx_B = L_B / N_B\n    x_centers_B = (np.arange(N_B) + 0.5) * dx_B\n    u0_B = 0.05 + 0.01 * x_centers_B\n    a_desc_B = {\n        \"type\": \"constant\",\n        \"a0\": 2.0\n    }\n    beta_B = 1.0\n    dt_B = 1e-3\n    u1_B = fvm_one_step(u0_B.tolist(), L_B, a_desc_B, beta_B, dt_B)\n\n    # Case C: Strong nonlinearity, heterogeneous periodic microscale, N=4, L=1, dt=5e-6, beta=50\n    N_C = 4\n    L_C = 1.0\n    dx_C = L_C / N_C\n    x_centers_C = (np.arange(N_C) + 0.5) * dx_C\n    u0_C = 0.1 + 0.05 * np.cos(np.pi * x_centers_C / L_C)\n    a_desc_C = {\n        \"type\": \"periodic\",\n        \"a0\": 1.5,\n        \"A1\": 0.9,\n        \"A2\": 0.4,\n        \"p\": 0.1\n    }\n    beta_C = 50.0\n    dt_C = 5e-6\n    u1_C = fvm_one_step(u0_C.tolist(), L_C, a_desc_C, beta_C, dt_C)\n\n    results = [u1_A, u1_B, u1_C]\n    print(format_list_no_spaces(results))\n\nsolve()\n```"
        }
    ]
}