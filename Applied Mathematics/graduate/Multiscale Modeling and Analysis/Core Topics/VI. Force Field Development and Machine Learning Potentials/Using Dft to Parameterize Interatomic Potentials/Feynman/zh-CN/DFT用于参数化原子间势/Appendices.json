{
    "hands_on_practices": [
        {
            "introduction": "一个高质量的原子间势不仅要能准确预测体系的总能量，还必须能够再现作用在每个原子上的力以及材料整体的应力状态。这个练习将为你奠定构建综合性势函数拟合目标的理论基础。我们将从第一性原理出发，推导如何从密度泛函理论（DFT）计算的能量中得到应力张量，并学习如何将能量、力和应力的误差组合成一个统一的目标函数，为参数优化做好准备。",
            "id": "3828947",
            "problem": "考虑一个由密度泛函理论 (DFT) 建模的周期性晶体系统，其总基态能量 $E(\\{\\mathbf{R}_{\\alpha}\\}, \\mathbf{h})$ 依赖于原子笛卡尔坐标集 $\\{\\mathbf{R}_{\\alpha}\\}$ 和晶格矩阵 $\\mathbf{h}$（其列向量为布拉维晶格矢量）。假设温度为零，电子数固定，并考虑对晶胞施加一个无穷小、均匀、对称的小应变 $\\boldsymbol{\\epsilon}$，使得 $\\mathbf{h} \\mapsto (\\mathbf{I} + \\boldsymbol{\\epsilon}) \\mathbf{h}$，同时保持分数坐标 $\\{\\mathbf{s}_{\\alpha}\\}$ 不变，其中 $\\mathbf{R}_{\\alpha} = \\mathbf{h}\\,\\mathbf{s}_{\\alpha}$。设体积为 $V = \\det(\\mathbf{h})$，并假设基组是完备的，因此可以忽略 Pulay 贡献，且构型相对于原子位置是稳态的，因此 $\\mathbf{F}_{\\alpha} = -\\partial E/\\partial \\mathbf{R}_{\\alpha} = \\mathbf{0}$。\n\n从微小均匀形变的虚功原理和连续介质力学中的标准变分定义出发，推导柯西应力张量分量 $\\sigma_{ij}$ 的显式解析表达式，该表达式以 DFT 能量对无穷小应变张量分量 $\\epsilon_{ij}$ 的导数表示。清楚地说明此表达式成立的假设条件。\n\n然后，在构建一个由参数向量 $\\boldsymbol{\\theta}$ 参数化的原子间势以再现训练集 $\\mathcal{D}$ 中各个构型 $c$ 的 DFT 数据的背景下，构建一个无量纲的最小二乘目标函数，该函数能同时拟合能量、力和应力。设训练集中的每个构型 $c \\in \\mathcal{D}$ 含有 $N_c$ 个原子，体积为 $V_c$，DFT 参考能量为 $E^{\\mathrm{DFT}}(c)$，力为 $\\{\\mathbf{F}^{\\mathrm{DFT}}_{\\alpha}(c)\\}_{\\alpha=1}^{N_c}$，应力张量为 $\\boldsymbol{\\sigma}^{\\mathrm{DFT}}(c)$。模型预测值为 $E_{\\boldsymbol{\\theta}}(c)$、$\\{\\mathbf{F}_{\\boldsymbol{\\theta},\\alpha}(c)\\}$ 和 $\\boldsymbol{\\sigma}_{\\boldsymbol{\\theta}}(c)$。使用正标量权重 $w_E$、$w_F$、$w_{\\sigma}$ 和特征尺度 $E_0$ (每个原子的能量)、$F_0$ (力) 和 $\\sigma_0$ (应力) 来确保各项是可比较且无量纲的，并使用弗罗贝尼乌斯范数来计算应力失配。以每个原子的能量为基础来表示能量失配，以避免因系统大小而产生的偏差，并对原子和笛卡尔分量上的力失配进行平均。\n\n以闭合形式的符号表示法提供 $\\sigma_{ij}$ 和最小二乘目标的最终表达式。以符号形式表示最终表达式；不要包含单位，也不要进行任何数值舍入。",
            "solution": "用户提出了一个由两部分组成的问题，涉及从密度泛函理论 (DFT) 计算应力以及为参数化原子间势构建目标函数。问题陈述在科学上是合理的、适定的、客观的，并包含足够的信息来推导所要求的表达式。因此，该问题被认为是有效的。\n\n### 第一部分：柯西应力张量的推导\n\n推导始于虚功原理，该原理将系统内能的变化量 $dE$ 与无穷小形变过程中外力对其所做的机械功 $dW$ 相等同。对于体积为 $V$、承受无穷小对称应变 $d\\boldsymbol{\\epsilon}$ 的连续介质，由柯西应力张量 $\\boldsymbol{\\sigma}$ 所做的功由下式给出：\n$$\ndW = V (\\boldsymbol{\\sigma}:d\\boldsymbol{\\epsilon}) = V \\sum_{i,j=1}^3 \\sigma_{ij} d\\epsilon_{ij}\n$$\n由于此应变，周期性系统的总基态能量 $E$ 的变化为：\n$$\ndE = \\sum_{i,j=1}^3 \\frac{dE}{d\\epsilon_{ij}} d\\epsilon_{ij}\n$$\n令功与能量变化相等 ($dE = dW$)，我们得到 $\\sum_{i,j} (\\frac{1}{V}\\frac{dE}{d\\epsilon_{ij}} - \\sigma_{ij}) d\\epsilon_{ij} = 0$。由于这对任何对称的 $d\\boldsymbol{\\epsilon}$ 都成立，我们得到 $\\sigma_{ij} = \\frac{1}{2V}(\\frac{dE}{d\\epsilon_{ij}} + \\frac{dE}{d\\epsilon_{ji}})$。\n\n能量 $E$ 对应变张量分量 $\\epsilon_{kl}$ 的全导数必须使用链式法则进行计算。能量 $E$ 是晶格矩阵 $\\mathbf{h}$ 和原子位置 $\\{\\mathbf{R}_\\alpha\\}$ 的显式函数，而后者又依赖于所施加的应变 $\\boldsymbol{\\epsilon}$。\n$$\n\\frac{dE}{d\\epsilon_{kl}} = \\sum_{i,j=1}^3 \\frac{\\partial E}{\\partial h_{ij}} \\frac{\\partial h_{ij}}{\\partial \\epsilon_{kl}} + \\sum_{\\alpha=1}^N \\sum_{i=1}^3 \\frac{\\partial E}{\\partial R_{\\alpha,i}} \\frac{\\partial R_{\\alpha,i}}{\\partial \\epsilon_{kl}}\n$$\n问题指定了两个关键假设。首先，原子构型是稳态的，意味着在初始未应变状态下，原子上的力为零：\n$$\nF_{\\alpha,i} = -\\frac{\\partial E}{\\partial R_{\\alpha,i}} = 0\n$$\n这使得链式法则展开式中的第二项（内功项）为零。其次，根据基组完备性的假设，由基组随晶格形变而变化所引起的 Pulay 应力贡献可以忽略不计。\n\n剩下的问题是计算导数 $\\partial h_{ij}/\\partial \\epsilon_{kl}$。晶格矩阵的变换方式为 $\\mathbf{h}' = (\\mathbf{I} + \\boldsymbol{\\epsilon})\\mathbf{h}$，或以分量形式表示为：\n$$\nh'_{ij} = \\sum_m (\\delta_{im} + \\epsilon_{im}) h_{mj}\n$$\n新晶格矩阵的一个分量 $h'_{ij}$ 相对于应变分量 $\\epsilon_{kl}$ 的导数为：\n$$\n\\frac{\\partial h'_{ij}}{\\partial \\epsilon_{kl}} = \\frac{\\partial}{\\partial \\epsilon_{kl}} \\left( \\sum_m (\\delta_{im} + \\epsilon_{im}) h_{mj} \\right) = \\sum_m \\frac{\\partial \\epsilon_{im}}{\\partial \\epsilon_{kl}} h_{mj} = \\sum_m \\delta_{ik}\\delta_{ml} h_{mj} = \\delta_{ik}h_{lj}\n$$\n将此结果代回到简化的能量导数表达式中（力为零）：\n$$\n\\frac{dE}{d\\epsilon_{kl}} = \\sum_{i,j=1}^3 \\frac{\\partial E}{\\partial h_{ij}} (\\delta_{ik} h_{lj}) = \\sum_{j=1}^3 \\frac{\\partial E}{\\partial h_{kj}} h_{lj}\n$$\n这可以写成矩阵形式：$\\frac{dE}{d\\boldsymbol{\\epsilon}} = \\frac{\\partial E}{\\partial \\mathbf{h}} \\mathbf{h}^T$。\n将此代入应力表达式，我们得到：\n$$\n\\sigma_{ij} = \\frac{1}{2V} \\left( \\left(\\frac{\\partial E}{\\partial \\mathbf{h}} \\mathbf{h}^T\\right)_{ij} + \\left(\\frac{\\partial E}{\\partial \\mathbf{h}} \\mathbf{h}^T\\right)_{ji} \\right) = \\frac{1}{2V} \\left( \\sum_{m=1}^3 \\frac{\\partial E}{\\partial h_{im}} h_{jm} + \\sum_{m=1}^3 \\frac{\\partial E}{\\partial h_{jm}} h_{im} \\right)\n$$\n这就完成了应力张量的推导。\n\n### 第二部分：目标函数的构建\n\n目标是构建一个无量纲的最小二乘目标函数 $\\mathcal{L}(\\boldsymbol{\\theta})$，它结合了能量、力和应力的误差。我们对训练集 $\\mathcal{D}$ 中的所有构型 $c$ 进行平均。\n- **能量误差**: 为了避免系统大小的偏差，我们使用每个原子的能量误差。对于一个构型 $c$，误差项为 $\\left( \\frac{E_{\\boldsymbol{\\theta}}(c) - E^{\\mathrm{DFT}}(c)}{N_c} \\right)^2$。\n- **力误差**: 我们对所有原子和笛卡尔分量的均方根误差进行平均。对于构型 $c$，误差项为 $\\frac{1}{3N_c} \\sum_{\\alpha=1}^{N_c} \\|\\mathbf{F}_{\\boldsymbol{\\theta},\\alpha}(c) - \\mathbf{F}^{\\mathrm{DFT}}_{\\alpha}(c)\\|^2$。\n- **应力误差**: 我们使用应力张量之间差异的弗罗贝尼乌斯范数的平方，即 $\\sum_{i,j} (\\sigma_{\\boldsymbol{\\theta},ij}(c) - \\sigma^{\\mathrm{DFT}}_{ij}(c))^2$。\n\n为了使各项无量纲并可比较，我们引入权重 $w_E, w_F, w_{\\sigma}$ 和特征尺度 $E_0, F_0, \\sigma_0$。最终的目标函数是所有这些项的加权和，在整个数据集上取平均：\n$$\n\\mathcal{L}(\\boldsymbol{\\theta}) = \\frac{1}{|\\mathcal{D}|} \\sum_{c \\in \\mathcal{D}} \\left[ w_E \\left( \\frac{E_{\\boldsymbol{\\theta}}(c) - E^{\\mathrm{DFT}}(c)}{N_c E_0} \\right)^2 + \\frac{w_F}{3 N_c F_0^2} \\sum_{\\alpha=1}^{N_c} \\sum_{i=1}^3 (F_{\\boldsymbol{\\theta},\\alpha,i}(c) - F^{\\mathrm{DFT}}_{\\alpha,i}(c))^2 + \\frac{w_{\\sigma}}{\\sigma_0^2} \\sum_{i=1}^3 \\sum_{j=1}^3 (\\sigma_{\\boldsymbol{\\theta},ij}(c) - \\sigma^{\\mathrm{DFT}}_{ij}(c))^2 \\right]\n$$\n这个表达式与最终答案中提供的表达式一致。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\sigma_{ij} = \\frac{1}{2V} \\left( \\sum_{m=1}^3 \\frac{\\partial E}{\\partial h_{im}} h_{jm} + \\sum_{m=1}^3 \\frac{\\partial E}{\\partial h_{jm}} h_{im} \\right)\n\n\\mathcal{L}(\\boldsymbol{\\theta}) = \\frac{1}{|\\mathcal{D}|} \\sum_{c \\in \\mathcal{D}} \\left[ w_E \\left( \\frac{E_{\\boldsymbol{\\theta}}(c) - E^{\\mathrm{DFT}}(c)}{N_c E_0} \\right)^2 + \\frac{w_F}{3 N_c F_0^2} \\sum_{\\alpha=1}^{N_c} \\sum_{i=1}^3 (F_{\\boldsymbol{\\theta},\\alpha,i}(c) - F^{\\mathrm{DFT}}_{\\alpha,i}(c))^2 + \\frac{w_{\\sigma}}{\\sigma_0^2} \\sum_{i=1}^3 \\sum_{j=1}^3 (\\sigma_{\\boldsymbol{\\theta},ij}(c) - \\sigma^{\\mathrm{DFT}}_{ij}(c))^2 \\right]\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "一个拟合好的模型不应被当作一个“黑箱”，理解其内部工作机制至关重要。最后一个练习将通过灵敏度分析深入探讨模型的可解释性。通过计算模型的能量预测对每个参数的响应程度，我们可以识别出哪些参数对模型行为影响最大，这不仅能为我们提供关键的物理洞察，还能指导未来模型的进一步改进。",
            "id": "3828938",
            "problem": "考虑一组原子核固定的原子构型，其基态能量已通过密度泛函理论（DFT）获得。在 Born-Oppenheimer 近似下，原子核被视为经典粒子，电子能量是原子核位置的函数。在多尺度建模中，通过校准一个参数化的原子间势来复现在训练集上的 DFT 能量。在本问题中，使用对加和的 Morse 势来定义模型能量，并对势参数进行敏感性分析。\n\n设一个构型中有 $N$ 个原子，其位置为 $\\{\\mathbf{R}_i\\}_{i=1}^N$（单位为 $\\mathrm{\\AA}$），并令 $r_{ij} = \\|\\mathbf{R}_i - \\mathbf{R}_j\\|$ 表示原子对之间的距离（单位为 $\\mathrm{\\AA}$）。定义参数化的对 Morse 势\n$$\nV(r; \\boldsymbol{\\theta}) = D \\left(e^{-2 a (r - r_0)} - 2 e^{- a (r - r_0)}\\right),\n$$\n其中 $\\boldsymbol{\\theta} = (D, a, r_0)$，$D$ 的单位是 $\\mathrm{eV}$，$a$ 的单位是 $\\mathrm{\\AA}^{-1}$，$r_0$ 的单位是 $\\mathrm{\\AA}$。一个构型的总模型能量为\n$$\nE(\\boldsymbol{\\theta}; \\{\\mathbf{R}_i\\}) = \\sum_{1 \\le i  j \\le N} V(r_{ij}; \\boldsymbol{\\theta}).\n$$\n对于一组由 $k$ 索引的构型，其位置为 $\\{\\mathbf{R}_i^{(k)}\\}$，相关的 DFT 能量为 $E_{\\mathrm{DFT}}^{(k)}$（单位为 $\\mathrm{eV}$），将每个参数分量 $\\theta_j \\in \\{D, a, r_0\\}$ 的参数敏感性定义为归一化的方和根\n$$\nS_j(\\boldsymbol{\\theta}) = \\frac{\\sqrt{\\sum_k w_k \\left(\\frac{\\partial E(\\boldsymbol{\\theta}; \\{\\mathbf{R}_i^{(k)}\\})}{\\partial \\theta_j}\\right)^2}}{\\max\\{|\\theta_j|, s_{\\min}\\}},\n$$\n其中 $w_k$ 是非负权重（本问题中对所有 $k$ 使用 $w_k = 1$），$s_{\\min} = 10^{-6}$ 是一个小的正数，以避免除以零。如果对于给定的阈值 $\\tau$ 有 $S_j(\\boldsymbol{\\theta})  \\tau$，则称参数分量 $\\theta_j$ 具有不成比例的影响。\n\n从以上定义和基础微积分（链式法则）出发，推导 Morse 势的 $\\frac{\\partial E}{\\partial D}$、$\\frac{\\partial E}{\\partial a}$ 和 $\\frac{\\partial E}{\\partial r_0}$ 的解析表达式。然后实现一个程序，对下面的每个测试用例，计算归一化的敏感性 $S_D$、$S_a$ 和 $S_{r_0}$，并输出具有不成比例影响的参数的索引。使用索引映射 $(D \\mapsto 0, a \\mapsto 1, r_0 \\mapsto 2)$。\n\n所有位置的单位均为 $\\mathrm{\\AA}$，所有能量的单位均为 $\\mathrm{eV}$。最终输出应为索引列表，因此无单位。你的程序必须生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如 $[ [0,2], [0], [] ]$），每个元素对应一个测试用例，并且本身是该用例中被认为具有不成比例影响的参数的索引列表。\n\n测试套件：\n对于每个测试用例，原子构型是三个边长为 $s$（单位为 $\\mathrm{\\AA}$）的等边三角形，原子位置为\n$\\mathbf{R}_1 = (0, 0, 0)$,\n$\\mathbf{R}_2 = (s, 0, 0)$,\n$\\mathbf{R}_3 = \\left(\\frac{s}{2}, \\frac{\\sqrt{3}}{2} s, 0\\right)$.\n\n测试用例 1 (正常路径):\n- 参数: $\\boldsymbol{\\theta} = (D, a, r_0) = (0.35, 1.5, 2.5)$。\n- 构型 (三个 $s$ 值): $s \\in \\{2.5, 2.1, 3.0\\}$。\n- DFT 能量: $E_{\\mathrm{DFT}}^{(k)} \\in \\{-0.8, -1.5, -0.3\\}$ (此处不用于加权；设 $w_k = 1$)。\n- 阈值: $\\tau = 1.8$。\n\n测试用例 2 (接近平衡的边界情况):\n- 参数: $\\boldsymbol{\\theta} = (D, a, r_0) = (1.0, 2.0, 2.5)$。\n- 构型: $s \\in \\{2.5, 2.5, 2.5\\}$。\n- DFT 能量: $E_{\\mathrm{DFT}}^{(k)} \\in \\{-1.2, -1.2, -1.2\\}$。\n- 阈值: $\\tau = 4.0$。\n\n测试用例 3 (远离平衡的边缘情况):\n- 参数: $\\boldsymbol{\\theta} = (D, a, r_0) = (1.0, 0.8, 3.0)$。\n- 构型: $s \\in \\{5.0, 6.0, 7.0\\}$。\n- DFT 能量: $E_{\\mathrm{DFT}}^{(k)} \\in \\{-0.05, -0.02, -0.01\\}$。\n- 阈值: $\\tau = 1.5$。\n\n你的程序应该生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是对应测试用例（按测试用例1、测试用例2、测试用例3的顺序）中具有不成比例影响的参数的索引列表。",
            "solution": "问题陈述已经过严格验证，并被确定为是合理的。它在科学上基于计算材料科学的原理，特别是利用密度泛函理论（DFT）的数据来参数化原子间势。该问题是适定的，所有必要的数据、定义和方程均已提供，从而可以得出一个唯一的、可验证的解。所有术语都得到了客观和定量的定义。因此，我们可以着手求解。\n\n目标是计算对加和 Morse 势模型的参数敏感性 $S_j$，并根据给定的阈值 $\\tau$ 确定哪些参数具有不成比例的影响。这需要两个主要步骤：首先，解析推导总模型能量相对于势参数的偏导数；其次，实现一个算法来计算给定测试用例的敏感性。\n\n设 Morse 势定义为：\n$$\nV(r; \\boldsymbol{\\theta}) = D \\left(e^{-2 a (r - r_0)} - 2 e^{- a (r - r_0)}\\right)\n$$\n其中参数向量为 $\\boldsymbol{\\theta} = (D, a, r_0)$。\n\n一个包含 $N$ 个原子的构型的总模型能量是所有唯一原子对之和：\n$$\nE(\\boldsymbol{\\theta}) = \\sum_{1 \\le i  j \\le N} V(r_{ij}; \\boldsymbol{\\theta})\n$$\n所提供的构型是边长为 $s$ 的等边三角形。对于这样的系统，$N=3$，且所有三个原子对距离都相同：$r_{12} = r_{13} = r_{23} = s$。对于边长为 $s^{(k)}$ 的单个构型 $k$，总能量简化为：\n$$\nE^{(k)}(\\boldsymbol{\\theta}) = 3 V(s^{(k)}; \\boldsymbol{\\theta})\n$$\n敏感性分析需要计算此能量相对于每个参数 $\\theta_j \\in \\{D, a, r_0\\}$ 的偏导数。根据微分算子的线性性质，我们有：\n$$\n\\frac{\\partial E^{(k)}}{\\partial \\theta_j} = 3 \\frac{\\partial V(s^{(k)}; \\boldsymbol{\\theta})}{\\partial \\theta_j}\n$$\n我们现在推导 Morse 势 $V(r; \\boldsymbol{\\theta})$ 相对于每个参数的偏导数。\n\n1.  **关于 $D$ 的偏导数**：\n    将 $a$ 和 $r_0$ 视为常数，导数很简单：\n    $$\n    \\frac{\\partial V}{\\partial D} = \\frac{\\partial}{\\partial D} \\left[ D \\left(e^{-2 a (r - r_0)} - 2 e^{- a (r - r_0)}\\right) \\right] = e^{-2 a (r - r_0)} - 2 e^{- a (r - r_0)}\n    $$\n\n2.  **关于 $a$ 的偏导数**：\n    使用链式法则，我们对 $a$ 求导：\n    $$\n    \\frac{\\partial V}{\\partial a} = D \\frac{\\partial}{\\partial a} \\left( e^{-2 a (r - r_0)} - 2 e^{- a (r - r_0)} \\right)\n    $$\n    $$\n    \\frac{\\partial V}{\\partial a} = D \\left( e^{-2 a (r - r_0)} \\cdot (-2(r - r_0)) - 2 e^{- a (r - r_0)} \\cdot (-(r - r_0)) \\right)\n    $$\n    $$\n    \\frac{\\partial V}{\\partial a} = D \\left( -2(r - r_0)e^{-2 a (r - r_0)} + 2(r - r_0)e^{- a (r - r_0)} \\right)\n    $$\n    $$\n    \\frac{\\partial V}{\\partial a} = 2D(r-r_0) \\left( e^{-a(r-r_0)} - e^{-2a(r-r_0)} \\right)\n    $$\n\n3.  **关于 $r_0$ 的偏导数**：\n    再次使用链式法则，我们对 $r_0$ 求导：\n    $$\n    \\frac{\\partial V}{\\partial r_0} = D \\frac{\\partial}{\\partial r_0} \\left( e^{-2 a (r - r_0)} - 2 e^{- a (r - r_0)} \\right)\n    $$\n    $$\n    \\frac{\\partial V}{\\partial r_0} = D \\left( e^{-2 a (r - r_0)} \\cdot (-2a)(-1) - 2 e^{- a (r - r_0)} \\cdot (-a)(-1) \\right)\n    $$\n    $$\n    \\frac{\\partial V}{\\partial r_0} = D \\left( 2a e^{-2 a (r - r_0)} - 2a e^{- a (r - r_0)} \\right)\n    $$\n    $$\n    \\frac{\\partial V}{\\partial r_0} = 2aD \\left( e^{-2 a (r - r_0)} - e^{- a (r - r_0)} \\right)\n    $$\n\n现在，我们可以写出边长为 $s^{(k)}$ 的单个三角形构型 $k$ 的总能量偏导数的表达式：\n$$\n\\frac{\\partial E^{(k)}}{\\partial D} = 3 \\left( e^{-2 a (s^{(k)} - r_0)} - 2 e^{- a (s^{(k)} - r_0)} \\right)\n$$\n$$\n\\frac{\\partial E^{(k)}}{\\partial a} = 6 D (s^{(k)} - r_0) \\left( e^{-a(s^{(k)}-r0)} - e^{-2a(s^{(k)}-r0)} \\right)\n$$\n$$\n\\frac{\\partial E^{(k)}}{\\partial r_0} = 6 a D \\left( e^{-2a(s^{(k)}-r0)} - e^{-a(s^{(k)}-r0)} \\right)\n$$\n\n每个参数 $\\theta_j \\in \\{D, a, r_0\\}$ 的参数敏感性 $S_j$ 计算如下：\n$$\nS_j(\\boldsymbol{\\theta}) = \\frac{\\sqrt{\\sum_k w_k \\left(\\frac{\\partial E(\\boldsymbol{\\theta}; \\{\\mathbf{R}_i^{(k)}\\})}{\\partial \\theta_j}\\right)^2}}{\\max\\{|\\theta_j|, s_{\\min}\\}}\n$$\n当权重 $w_k=1$ 时，公式变为：\n$$\nS_j(\\boldsymbol{\\theta}) = \\frac{\\sqrt{\\sum_k \\left(\\frac{\\partial E^{(k)}}{\\partial \\theta_j}\\right)^2}}{\\max\\{|\\theta_j|, s_{\\min}\\}}\n$$\n其中求和是针对给定测试用例中的构型集（即不同的 $s^{(k)}$ 值）。\n\n每个测试用例的计算过程如下：\n1.  接收参数 $\\boldsymbol{\\theta}=(D, a, r_0)$、构型边长集合 $\\{s^{(k)}\\}_k$ 和阈值 $\\tau$。\n2.  将每个导数的平方和变量初始化为零：$\\Sigma_D = 0$, $\\Sigma_a = 0$, $\\Sigma_{r_0} = 0$。\n3.  对于集合中的每个边长 $s^{(k)}$：\n    a.  使用上面推导的解析公式计算三个偏导数 $\\frac{\\partial E^{(k)}}{\\partial D}$、$\\frac{\\partial E^{(k)}}{\\partial a}$ 和 $\\frac{\\partial E^{(k)}}{\\partial r_0}$。\n    b.  将每个结果平方并加到相应的总和中：$\\Sigma_D \\mathrel{+}= (\\frac{\\partial E^{(k)}}{\\partial D})^2$、$\\Sigma_a \\mathrel{+}= (\\frac{\\partial E^{(k)}}{\\partial a})^2$、$\\Sigma_{r_0} \\mathrel{+}= (\\frac{\\partial E^{(k)}}{\\partial r_0})^2$。\n4.  遍历所有构型后，计算敏感性：\n    $$ S_D = \\frac{\\sqrt{\\Sigma_D}}{\\max\\{|D|, s_{\\min}\\}}, \\quad S_a = \\frac{\\sqrt{\\Sigma_a}}{\\max\\{|a|, s_{\\min}\\}}, \\quad S_{r_0} = \\frac{\\sqrt{\\Sigma_{r_0}}}{\\max\\{|r_0|, s_{\\min}\\}} $$\n5.  将每个敏感性与阈值 $\\tau$进行比较。对于 $S_j  \\tau$ 的参数，使用映射 $(D \\mapsto 0, a \\mapsto 1, r_0 \\mapsto 2)$ 构建索引列表。\n6.  测试用例的最终结果是这个索引列表。总输出是这些列表的列表。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes parameter sensitivities for a Morse potential model and identifies\n    disproportionately influential parameters based on a given threshold.\n    \"\"\"\n    test_cases = [\n        {\n            \"params\": (0.35, 1.5, 2.5),  # (D, a, r0)\n            \"configs\": [2.5, 2.1, 3.0], # s values\n            \"threshold\": 1.8\n        },\n        {\n            \"params\": (1.0, 2.0, 2.5),\n            \"configs\": [2.5, 2.5, 2.5],\n            \"threshold\": 4.0\n        },\n        {\n            \"params\": (1.0, 0.8, 3.0),\n            \"configs\": [5.0, 6.0, 7.0],\n            \"threshold\": 1.5\n        }\n    ]\n\n    s_min = 1e-6\n    all_results = []\n\n    for case in test_cases:\n        D, a, r0 = case[\"params\"]\n        s_values = case[\"configs\"]\n        tau = case[\"threshold\"]\n\n        sum_sq_dEdD = 0.0\n        sum_sq_dEda = 0.0\n        sum_sq_dEdr0 = 0.0\n\n        for s in s_values:\n            # Calculate common terms\n            s_minus_r0 = s - r0\n            exp_term1 = np.exp(-a * s_minus_r0)\n            exp_term2 = np.exp(-2 * a * s_minus_r0)\n\n            # Partial derivative of total energy (E) wrt D for a single config k\n            # dE_dD_k = 3 * (e^(-2a(s-r0)) - 2e^(-a(s-r0)))\n            dE_dD_k = 3.0 * (exp_term2 - 2.0 * exp_term1)\n\n            # Partial derivative of total energy (E) wrt a\n            # dE_da_k = 6 * D * (s - r0) * (e^(-a(s-r0)) - e^(-2a(s-r0)))\n            dE_da_k = 6.0 * D * s_minus_r0 * (exp_term1 - exp_term2)\n\n            # Partial derivative of total energy (E) wrt r0\n            # dE_dr0_k = 6 * a * D * (e^(-2a(s-r0)) - e^(-a(s-r0)))\n            dE_dr0_k = 6.0 * a * D * (exp_term2 - exp_term1)\n\n            # Accumulate sum of squares\n            sum_sq_dEdD += dE_dD_k**2\n            sum_sq_dEda += dE_da_k**2\n            sum_sq_dEdr0 += dE_dr0_k**2\n\n        # Calculate sensitivities Sj\n        # Sj = sqrt(sum_k (dE_k/d_theta_j)^2) / max(|theta_j|, s_min)\n        S_D = np.sqrt(sum_sq_dEdD) / max(abs(D), s_min)\n        S_a = np.sqrt(sum_sq_dEda) / max(abs(a), s_min)\n        S_r0 = np.sqrt(sum_sq_dEdr0) / max(abs(r0), s_min)\n\n        # Identify disproportionately influential parameters\n        influential_indices = []\n        if S_D  tau:\n            influential_indices.append(0)\n        if S_a  tau:\n            influential_indices.append(1)\n        if S_r0  tau:\n            influential_indices.append(2)\n        \n        all_results.append(influential_indices)\n\n    # Format the final output string to be whitespace-free inside lists\n    # e.g., [[0,2],[0],[1]] - '[[0,2],[0],[1]]'\n    result_str = f\"[{','.join(str(r).replace(' ', '') for r in all_results)}]\"\n    print(result_str)\n\nsolve()\n```"
        }
    ]
}