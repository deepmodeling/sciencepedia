{
    "hands_on_practices": [
        {
            "introduction": "The analysis of any reaction-diffusion system begins with identifying its baseline states. This exercise  guides you through the fundamental process of calculating the homogeneous steady state, a condition where all reactions are in perfect balance and concentrations are uniform in space. Mastering this skill is crucial as this uniform state is the foundation from which complex spatial patterns, or morphogenetic structures, can emerge.",
            "id": "4382312",
            "problem": "In systems biomedicine, activator–inhibitor reaction–diffusion systems provide mechanistic models for self-organization of morphogen concentrations in tissues. Consider the Schnakenberg model for two dimensionless chemical species with concentrations $u(\\mathbf{x},t)$ and $v(\\mathbf{x},t)$ evolving on a bounded domain with reflecting boundaries. The governing equations follow the general reaction–diffusion form $u_t = D_u \\nabla^2 u + R_u(u,v)$ and $v_t = D_v \\nabla^2 v + R_v(u,v)$ where $D_u > 0$ and $D_v > 0$ are the diffusion coefficients, and $R_u$, $R_v$ are reaction terms derived from well-tested mass-action kinetics approximations of feed and autocatalytic steps. In the Schnakenberg model, the reaction terms are given by $R_u(u,v)=a - u + u^2 v$ and $R_v(u,v)=b - u^2 v$, where $a > 0$ and $b > 0$ are constant feed rates.\n\nWrite down the full Schnakenberg reaction–diffusion system and, using the definition of a homogeneous steady state as a spatially uniform, time-independent solution that balances reaction fluxes, compute the homogeneous steady state $(u^*,v^*)$ in terms of $a$ and $b$. Express your final answer as a single closed-form analytic expression for the ordered pair $(u^*,v^*)$. No rounding is required and no physical units should be included in the final expression.",
            "solution": "The problem has been validated and is deemed valid. It is scientifically grounded in the established theory of reaction-diffusion systems, specifically the Schnakenberg model, which is a standard topic in mathematical biology. The problem is well-posed, unambiguous, and contains all necessary information to compute the requested homogeneous steady state.\n\nThe first task is to write down the full Schnakenberg reaction–diffusion system. The problem provides the general form of the equations:\n$$\nu_t = D_u \\nabla^2 u + R_u(u,v)\n$$\n$$\nv_t = D_v \\nabla^2 v + R_v(u,v)\n$$\nand the specific reaction kinetics for the Schnakenberg model:\n$$\nR_u(u,v) = a - u + u^2 v\n$$\n$$\nR_v(u,v) = b - u^2 v\n$$\nSubstituting these reaction terms into the general equations yields the full system:\n$$\n\\frac{\\partial u}{\\partial t} = D_u \\nabla^2 u + a - u + u^2 v\n$$\n$$\n\\frac{\\partial v}{\\partial t} = D_v \\nabla^2 v + b - u^2 v\n$$\nwhere $u(\\mathbf{x}, t)$ and $v(\\mathbf{x}, t)$ are the concentrations of the two chemical species, $D_u > 0$ and $D_v > 0$ are their respective diffusion coefficients, and $a > 0$ and $b > 0$ are constant feed rates. The reflecting boundaries impose no-flux boundary conditions, $\\mathbf{n} \\cdot \\nabla u = 0$ and $\\mathbf{n} \\cdot \\nabla v = 0$ on the domain boundary, where $\\mathbf{n}$ is the outward normal vector.\n\nThe second task is to compute the homogeneous steady state, denoted as $(u^*, v^*)$. A homogeneous steady state is a solution that is both time-independent and spatially uniform.\n\n$1$. **Time-independence**: The concentrations do not change with time, which means their partial derivatives with respect to time are zero.\n$$\n\\frac{\\partial u}{\\partial t} = 0\n$$\n$$\n\\frac{\\partial v}{\\partial t} = 0\n$$\n\n$2$. **Spatial uniformity (homogeneity)**: The concentrations do not vary with spatial position $\\mathbf{x}$. This implies that the concentrations are constant in space, $u = u^*$ and $v = v^*$, where $u^*$ and $v^*$ are constants. Consequently, all spatial derivatives are zero. In particular, the Laplacian terms are zero:\n$$\n\\nabla^2 u = \\nabla \\cdot (\\nabla u) = \\nabla \\cdot (\\mathbf{0}) = 0\n$$\n$$\n\\nabla^2 v = \\nabla \\cdot (\\nabla v) = \\nabla \\cdot (\\mathbf{0}) = 0\n$$\n\nApplying these two conditions to the full reaction-diffusion system simplifies the partial differential equations into a system of two algebraic equations. The diffusion terms and time derivatives vanish, leaving only the reaction terms which must equal zero to maintain the steady state.\n$$\n0 = 0 + a - u^* + (u^*)^2 v^* \\quad \\implies \\quad a - u^* + (u^*)^2 v^* = 0\n$$\n$$\n0 = 0 + b - (u^*)^2 v^* \\quad \\implies \\quad b - (u^*)^2 v^* = 0\n$$\n\nWe now solve this system of two algebraic equations for the two unknowns, $u^*$ and $v^*$.\nFrom the second equation, we can express the term $(u^*)^2 v^*$ in terms of $b$:\n$$\n(u^*)^2 v^* = b\n$$\nThis expression represents the balance where the autocatalytic production of species $v$ is exactly matched by the constant feed rate $b$.\n\nNext, we substitute this result into the first equation:\n$$\na - u^* + (b) = 0\n$$\nSolving for $u^*$, we find:\n$$\nu^* = a + b\n$$\n\nFinally, we substitute the expression for $u^*$ back into the relation $(u^*)^2 v^* = b$ to find $v^*$:\n$$\n(a+b)^2 v^* = b\n$$\nSince the problem states that $a > 0$ and $b > 0$, it follows that $a+b \\neq 0$, so we can divide by $(a+b)^2$:\n$$\nv^* = \\frac{b}{(a+b)^2}\n$$\n\nThe homogeneous steady state $(u^*, v^*)$ is therefore given by the ordered pair of expressions derived above. Since $a$ and $b$ are positive, both $u^*$ and $v^*$ are positive, which is physically consistent for chemical concentrations.\n\nThe solution is the ordered pair $(u^*,v^*)$.\n$$\n(u^*, v^*) = \\left( a+b, \\frac{b}{(a+b)^2} \\right)\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} a+b  \\frac{b}{(a+b)^2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Alan Turing's seminal insight was that diffusion can act as a destabilizing force, driving a system to form spontaneous patterns. This practice  delves into this mechanism by having you perform a linear stability analysis on a general reaction-diffusion system. By deriving the critical wavenumber, you will uncover the direct mathematical link between the system's kinetic and diffusive parameters and the characteristic spatial scale of the emergent Turing patterns.",
            "id": "3800520",
            "problem": "Consider a two-species reaction-diffusion system on the infinite line with state vector $w(x,t) = (u(x,t), v(x,t))^{\\top}$ obeying\n$$\n\\partial_t w = D \\,\\partial_{xx} w + R(w),\n$$\nwhere $D = \\mathrm{diag}(D_u, D_v)$ is the diagonal diffusion matrix and $R(w)$ is a smooth reaction vector field. Let $w^{\\ast}$ be a spatially homogeneous fixed point of the reaction dynamics, so that $R(w^{\\ast}) = 0$. Linearize about $w^{\\ast}$ by setting $w(x,t) = w^{\\ast} + \\eta(x,t)$ with $|\\eta| \\ll 1$, and denote the Jacobian of $R$ at $w^{\\ast}$ by $J$, with entries $J = \\begin{pmatrix} f_u  f_v \\\\ g_u  g_v \\end{pmatrix}$, trace $\\tau = f_u + g_v$, and determinant $\\Delta = f_u g_v - f_v g_u$. Assume the homogeneous fixed point is linearly stable to spatially uniform perturbations in the absence of diffusion, that is, $\\tau  0$ and $\\Delta  0$. Let the diffusion coefficients be $D_u = 1$ and $D_v = 10$.\n\nStarting from the linearized partial differential equation and using spatial Fourier modes, derive the dispersion relation for modal growth rates and determine the critical wavenumber $k_c \\neq 0$ at which the real part of the leading eigenvalue $\\mathrm{Re}\\,\\lambda(k)$ first becomes positive as parameters are tuned through the onset of a stationary Turing instability. Express your final answer as a closed-form analytic expression in terms of $f_u$ and $g_v$ only, using the given values $D_u = 1$ and $D_v = 10$. No numerical evaluation is required. If a square root appears, take the principal branch. State your answer for $k_c$ without units. No rounding is required.",
            "solution": "The starting point is the two-species reaction-diffusion system described by the vector equation:\n$$\n\\partial_t w = D \\,\\partial_{xx} w + R(w)\n$$\nwhere $w(x,t) = (u(x,t), v(x,t))^{\\top}$, $D = \\mathrm{diag}(D_u, D_v)$ is the diagonal diffusion matrix, and $R(w)$ is the reaction term.\n\nWe are given a spatially homogeneous fixed point $w^{\\ast}$ such that $R(w^{\\ast}) = 0$. To analyze the linear stability of this fixed point, we consider small perturbations $\\eta(x,t)$ by setting $w(x,t) = w^{\\ast} + \\eta(x,t)$. Substituting this into the governing equation and linearizing around $w^{\\ast}$ yields the equation for the perturbation $\\eta$:\n$$\n\\partial_t \\eta = D \\,\\partial_{xx} \\eta + J \\eta\n$$\nwhere $J$ is the Jacobian matrix of the reaction term $R(w)$ evaluated at the fixed point $w^{\\ast}$:\n$$\nJ = \\begin{pmatrix} f_u  f_v \\\\ g_u  g_v \\end{pmatrix}\n$$\nHere, the entries are the partial derivatives of the components of $R$, e.g., $f_u = \\partial R_1 / \\partial u$ evaluated at $w^{\\ast}$.\n\nTo find the dispersion relation, we seek solutions in the form of spatial Fourier modes:\n$$\n\\eta(x,t) = \\hat{\\eta} \\exp(i k x + \\lambda t)\n$$\nwhere $k$ is the spatial wavenumber, $\\lambda$ is the temporal growth rate, and $\\hat{\\eta}$ is the constant amplitude vector. Substituting this ansatz into the linearized partial differential equation gives:\n$$\n\\lambda \\hat{\\eta} \\exp(i k x + \\lambda t) = D (ik)^2 \\hat{\\eta} \\exp(i k x + \\lambda t) + J \\hat{\\eta} \\exp(i k x + \\lambda t)\n$$\nDividing by the exponential term, we obtain an eigenvalue problem for the growth rate $\\lambda$:\n$$\n\\lambda \\hat{\\eta} = (-k^2 D + J) \\hat{\\eta}\n$$\nThe eigenvalues $\\lambda$ are the solutions to the characteristic equation $\\det(-k^2 D + J - \\lambda I) = 0$, where $I$ is the identity matrix. The matrix of the eigenvalue problem is $M(k) = J - k^2 D$:\n$$\nM(k) = \\begin{pmatrix} f_u - k^2 D_u  f_v \\\\ g_u  g_v - k^2 D_v \\end{pmatrix}\n$$\nThe characteristic equation is $\\lambda^2 - \\mathrm{Tr}(M(k))\\lambda + \\det(M(k)) = 0$. This equation is the dispersion relation, linking the growth rate $\\lambda$ to the wavenumber $k$.\n\nThe trace and determinant of $M(k)$ are:\n$$\n\\mathrm{Tr}(M(k)) = (f_u - k^2 D_u) + (g_v - k^2 D_v) = (f_u + g_v) - k^2(D_u + D_v) = \\tau - k^2(D_u + D_v)\n$$\n$$\n\\det(M(k)) = (f_u - k^2 D_u)(g_v - k^2 D_v) - f_v g_u = f_u g_v - f_v g_u - k^2(f_u D_v + g_v D_u) + k^4 D_u D_v = \\Delta - k^2(f_u D_v + g_v D_u) + k^4 D_u D_v\n$$\nwhere $\\tau = f_u + g_v$ and $\\Delta = f_u g_v - f_v g_u$ are the trace and determinant of the Jacobian $J$, respectively.\n\nThe problem states that the spatially homogeneous fixed point is stable to spatially uniform perturbations ($k=0$). This implies that for $k=0$, the real parts of both eigenvalues $\\lambda$ are negative. The conditions for this in a $2$-dimensional system are $\\tau  0$ and $\\Delta  0$.\n\nA stationary Turing instability occurs when diffusion destabilizes this fixed point for a non-zero wavenumber, $k \\neq 0$. The onset of this instability is stationary, meaning the imaginary part of the eigenvalue is zero ($\\mathrm{Im}(\\lambda) = 0$). The instability arises when the leading real eigenvalue, $\\mathrm{Re}(\\lambda_+(k))$, crosses zero from negative to positive. From the characteristic equation, the eigenvalues are given by $\\lambda_{\\pm}(k) = \\frac{1}{2}(\\mathrm{Tr}(M(k)) \\pm \\sqrt{\\mathrm{Tr}(M(k))^2 - 4\\det(M(k))})$. For a stationary instability, an eigenvalue passes through $\\lambda = 0$. This occurs precisely when $\\det(M(k)) = 0$.\n\nThe instability emerges at the wavenumber $k$ for which $\\det(M(k))$ first becomes negative as system parameters are varied. At the threshold of instability, the minimum value of $\\det(M(k))$ for $k0$ is exactly zero. The critical wavenumber $k_c$ is the wavenumber at which this minimum occurs.\n\nLet's find the minimum of $\\det(M(k))$ with respect to $k$. For simplicity, let $K = k^2$. The expression for the determinant is a quadratic in $K$:\n$$\nF(K) = (D_u D_v) K^2 - (f_u D_v + g_v D_u) K + \\Delta\n$$\nTo find the minimum, we compute the derivative with respect to $K$ and set it to zero:\n$$\n\\frac{dF}{dK} = 2(D_u D_v)K - (f_u D_v + g_v D_u) = 0\n$$\nSolving for $K$ gives the critical value $K_c = k_c^2$:\n$$\nk_c^2 = \\frac{f_u D_v + g_v D_u}{2 D_u D_v}\n$$\nThis gives the square of the critical wavenumber, which is the wavenumber of the most unstable mode at the onset of the Turing instability. For a Turing instability to occur, we must have $k_c^2  0$, which requires $f_u D_v + g_v D_u  0$.\n\nThe problem asks for an expression for the critical wavenumber $k_c$. Taking the principal (positive) square root, we get:\n$$\nk_c = \\sqrt{\\frac{f_u D_v + g_v D_u}{2 D_u D_v}}\n$$\nWe are given the diffusion coefficients $D_u = 1$ and $D_v = 10$. Substituting these values into the expression for $k_c^2$:\n$$\nk_c^2 = \\frac{f_u(10) + g_v(1)}{2(1)(10)} = \\frac{10 f_u + g_v}{20}\n$$\nTaking the square root gives the final expression for the critical wavenumber $k_c$ in terms of $f_u$ and $g_v$:\n$$\nk_c = \\sqrt{\\frac{10 f_u + g_v}{20}}\n$$\nThis can also be written as $k_c = \\sqrt{\\frac{f_u}{2} + \\frac{g_v}{20}}$. We will present the answer in the first form.",
            "answer": "$$\\boxed{\\sqrt{\\frac{10f_u + g_v}{20}}}$$"
        },
        {
            "introduction": "Biological systems are rarely homogeneous; their properties often vary on a microscopic scale. This computational practice  challenges you to bridge the gap between microscopic heterogeneity and macroscopic behavior using homogenization theory. You will derive effective parameters from first principles and then validate your theoretical model against direct numerical simulations, a core workflow in modern multiscale modeling.",
            "id": "4382351",
            "problem": "Consider a one-dimensional reaction-diffusion medium representing a periodically microstructured biological tissue. The concentration field is denoted by $u(x,t)$, the spatial coordinate is $x \\in [0,L]$, and time is $t \\ge 0$. The governing Partial Differential Equation (PDE) is the balance of flux by Fick's law and first-order consumption by reaction, namely\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\left(D\\left(\\frac{x}{\\epsilon}\\right)\\frac{\\partial u}{\\partial x}\\right) - k\\left(\\frac{x}{\\epsilon}\\right) u,\n$$\nwhere $D\\left(\\frac{x}{\\epsilon}\\right)$ is the microscale diffusion coefficient and $k\\left(\\frac{x}{\\epsilon}\\right)$ is the microscale first-order reaction rate, both $L$-periodic at the microscale with period $\\epsilon \\ll L$. The microstructure is comprised of two phases per period, with volume fraction $f \\in (0,1)$ assigned to phase $1$ and $1-f$ assigned to phase $2$. Phase $1$ has diffusion coefficient $D_1$ and reaction rate $k_1$, while phase $2$ has diffusion coefficient $D_2$ and reaction rate $k_2$. All physical quantities must be treated with the following units: $D$ in micrometer squared per second $\\mu m^2/s$, $k$ in inverse seconds $s^{-1}$, and lengths (including $L$ and cell length) in micrometers $\\mu m$. The answer must be expressed as dimensionless decimal numbers (floats).\n\nYour goal is to implement a complete, runnable program that, for a specified set of microscale parameters, performs two microscale simulations to infer effective parameters and then compares them to homogenized-model parameters derived from first principles. The two simulations are:\n\n- Steady-state diffusion experiment (to infer the effective diffusion coefficient): impose fixed boundary concentrations $u(0)=0$ and $u(L)=\\Delta$, with $\\Delta$ a specified constant. Solve the steady-state problem\n$$\n\\frac{d}{dx}\\left(D\\left(\\frac{x}{\\epsilon}\\right)\\frac{d u}{dx}\\right) = 0,\n$$\nand compute the constant flux $J$ that results. From the microscale solution, infer an effective diffusion coefficient $D_{\\mathrm{eff}}^{\\mathrm{micro}}$ by the relation of flux to macroscopic gradient across the whole domain. Use a numerically consistent one-dimensional discretization that resolves the periodic microstructure.\n\n- Initial decay under zero-flux boundaries (to infer the effective reaction rate): impose zero-flux (Neumann) boundary conditions at $x=0$ and $x=L$, start from a spatially uniform initial condition $u(x,0)=u_0$, and advance the microscale system for a single small time increment $dt$ so that the change in the spatial average is dominated by reaction at $t=0$ (diffusion flux is initially zero for a uniform field). Infer the effective reaction rate $k_{\\mathrm{eff}}^{\\mathrm{micro}}$ from the initial decay rate of the spatial average.\n\nThen, for each test case, you must:\n1. Derive homogenized-model parameters $D_{\\mathrm{eff}}^{\\mathrm{hom}}$ and $k_{\\mathrm{eff}}^{\\mathrm{hom}}$ from first principles based on the microstructure definition and the reaction-diffusion mechanics, without assuming any shortcut formulas.\n2. Quantify the model mismatch across scales by computing the relative errors\n$$\n\\text{mismatch}_D = \\left|\\frac{D_{\\mathrm{eff}}^{\\mathrm{micro}} - D_{\\mathrm{eff}}^{\\mathrm{hom}}}{D_{\\mathrm{eff}}^{\\mathrm{hom}}}\\right|,\\quad\n\\text{mismatch}_k = \\left|\\frac{k_{\\mathrm{eff}}^{\\mathrm{micro}} - k_{\\mathrm{eff}}^{\\mathrm{hom}}}{k_{\\mathrm{eff}}^{\\mathrm{hom}}}\\right|.\n$$\nExpress these mismatches as dimensionless decimal numbers.\n\nImplementation details that must be followed:\n- Discretize the domain into cells that resolve the micro-period. Use a piecewise-constant $D$ and $k$ per cell. Within each micro-period of length $\\ell_{\\mathrm{cell}}$, assign the first fraction $f$ of the cells to phase $1$ and the remaining fraction to phase $2$. Use a sufficiently fine per-period resolution to approximate $f$ well.\n- For the steady-state diffusion experiment, use Dirichlet boundary conditions $u(0)=0$ and $u(L)=\\Delta$ with $\\Delta=1$ (unit concentration difference), and compute the constant flux $J$ from the discrete solution using Fick's law. Infer $D_{\\mathrm{eff}}^{\\mathrm{micro}}$ by collapsing the flux into a single effective coefficient over $[0,L]$ with gradient $\\Delta/L$.\n- For the initial decay experiment, use Neumann boundaries (zero flux), a uniform initial condition $u_0=1$, and a small time step $dt = 10^{-4}$ in seconds. Advance one explicit step using the discrete reaction-diffusion operator, then infer $k_{\\mathrm{eff}}^{\\mathrm{micro}}$ from the change in the spatial average at $t=0$.\n- The homogenized parameters $D_{\\mathrm{eff}}^{\\mathrm{hom}}$ and $k_{\\mathrm{eff}}^{\\mathrm{hom}}$ must be derived from foundational laws and defined microstructure, not from any memorized shortcuts.\n\nTest suite:\nUse the following three scientifically plausible cases. In each, $L$ is an integer multiple of $\\ell_{\\mathrm{cell}}$ to yield an integer number of micro-periods, and you must discretize each micro-period into an integer number of cells sufficiently large to approximate $f$.\n\n- Case $1$ (general heterogeneous case):\n  - $L = 100\\,\\mu m$, $\\ell_{\\mathrm{cell}} = 5\\,\\mu m$, $f=0.3$, $D_1 = 100\\,\\mu m^2/s$, $D_2 = 10\\,\\mu m^2/s$, $k_1 = 0.05\\,s^{-1}$, $k_2 = 0.01\\,s^{-1}$.\n\n- Case $2$ (extreme diffusion contrast and reaction localized in one phase):\n  - $L = 96\\,\\mu m$, $\\ell_{\\mathrm{cell}} = 6\\,\\mu m$, $f=0.5$, $D_1 = 1000\\,\\mu m^2/s$, $D_2 = 1\\,\\mu m^2/s$, $k_1 = 0.00\\,s^{-1}$, $k_2 = 0.10\\,s^{-1}$.\n\n- Case $3$ (homogeneous limit for verification):\n  - $L = 120\\,\\mu m$, $\\ell_{\\mathrm{cell}} = 4\\,\\mu m$, $f=0.4$, $D_1 = 50\\,\\mu m^2/s$, $D_2 = 50\\,\\mu m^2/s$, $k_1 = 0.02\\,s^{-1}$, $k_2 = 0.02\\,s^{-1}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain, in order, the diffusion mismatch then reaction mismatch for each case:\n$[\\text{mismatch}_{D,1},\\text{mismatch}_{k,1},\\text{mismatch}_{D,2},\\text{mismatch}_{k,2},\\text{mismatch}_{D,3},\\text{mismatch}_{k,3}]$.\nAll entries must be dimensionless decimal numbers (floats).",
            "solution": "The problem is well-posed and scientifically grounded, requiring the derivation and numerical validation of effective parameters for a one-dimensional reaction-diffusion system in a periodic medium. The problem will be solved by first deriving the homogenized parameters from first principles, then performing the two specified numerical experiments to find their microscale counterparts, and finally computing the relative error between the two sets of parameters.\n\n### Step 1: Derivation of Homogenized Parameters ($D_{\\mathrm{eff}}^{\\mathrm{hom}}, k_{\\mathrm{eff}}^{\\mathrm{hom}}$)\n\nThe problem considers a one-dimensional medium with periodically varying diffusion coefficient $D(x/\\epsilon)$ and reaction rate $k(x/\\epsilon)$. The goal of homogenization is to find constant effective parameters, $D_{\\mathrm{eff}}$ and $k_{\\mathrm{eff}}$, that describe the system's behavior on a macroscopic scale, where the microstructural variations are averaged out.\n\n#### Effective Reaction Rate ($k_{\\mathrm{eff}}^{\\mathrm{hom}}$)\n\nConsider the case where the concentration field $u$ is spatially uniform, but is consumed by reaction over time. The macroscopic or spatially averaged reaction-diffusion equation is:\n$$ \\frac{\\partial \\langle u \\rangle}{\\partial t} = \\frac{\\partial}{\\partial x}\\left\\langle D\\frac{\\partial u}{\\partial x}\\right\\rangle - \\langle ku \\rangle $$\nwhere $\\langle \\cdot \\rangle$ denotes a spatial average over a representative volume element, in this case, a single period of length $\\ell_{\\mathrm{cell}}$.\nIf $u$ is uniform, the diffusion term vanishes. The equation simplifies to $\\frac{d\\langle u \\rangle}{dt} = -\\langle ku \\rangle$. Since $u$ is spatially constant, we can write $\\langle u \\rangle = u$, and the equation becomes $\\frac{du}{dt} = -\\langle k \\rangle u$.\nBy comparing this to the homogenized form $\\frac{du}{dt} = -k_{\\mathrm{eff}} u$, we identify the effective reaction rate as the spatial average of the microscale reaction rate:\n$$ k_{\\mathrm{eff}}^{\\mathrm{hom}} = \\langle k \\rangle = \\frac{1}{\\ell_{\\mathrm{cell}}} \\int_{0}^{\\ell_{\\mathrm{cell}}} k(y) dy $$\nFor the given two-phase medium, where phase $1$ occupies a fraction $f$ of the volume with rate $k_1$ and phase $2$ occupies the remaining $1-f$ with rate $k_2$, the integral becomes a simple weighted sum:\n$$ k_{\\mathrm{eff}}^{\\mathrm{hom}} = \\frac{1}{\\ell_{\\mathrm{cell}}} \\left( \\int_{0}^{f\\ell_{\\mathrm{cell}}} k_1 dy + \\int_{f\\ell_{\\mathrm{cell}}}^{\\ell_{\\mathrm{cell}}} k_2 dy \\right) = \\frac{1}{\\ell_{\\mathrm{cell}}} (f\\ell_{\\mathrm{cell}}k_1 + (1-f)\\ell_{\\mathrm{cell}}k_2) $$\n$$ k_{\\mathrm{eff}}^{\\mathrm{hom}} = f k_1 + (1-f) k_2 $$\nThis is the arithmetic mean of the reaction rates, weighted by their respective volume fractions.\n\n#### Effective Diffusion Coefficient ($D_{\\mathrm{eff}}^{\\mathrm{hom}}$)\n\nTo find the effective diffusion coefficient, we consider the steady-state pure diffusion problem:\n$$ \\frac{d}{dx}\\left(D(x)\\frac{du}{dx}\\right) = 0 $$\nThis equation implies that the flux, $J = -D(x)\\frac{du}{dx}$, is constant throughout the medium. We can rearrange this to express the concentration gradient as $\\frac{du}{dx} = -\\frac{J}{D(x)}$.\nThe macroscopic flux $\\langle J \\rangle$ is simply $J$. The macroscopic gradient is $\\langle \\frac{du}{dx} \\rangle$. The effective diffusion coefficient relates these two by Fick's law at the macroscale: $\\langle J \\rangle = -D_{\\mathrm{eff}} \\langle \\frac{du}{dx} \\rangle$.\nThe average gradient over one period is $\\langle \\frac{du}{dx} \\rangle = \\frac{1}{\\ell_{\\mathrm{cell}}} \\int_{0}^{\\ell_{\\mathrm{cell}}} \\frac{du}{dx} dx = \\frac{u(\\ell_{\\mathrm{cell}}) - u(0)}{\\ell_{\\mathrm{cell}}}$.\nWe find the concentration drop over one period by integrating the microscopic gradient:\n$$ u(\\ell_{\\mathrm{cell}}) - u(0) = \\int_{0}^{\\ell_{\\mathrm{cell}}} \\left(-\\frac{J}{D(x)}\\right) dx = -J \\int_{0}^{\\ell_{\\mathrm{cell}}} \\frac{1}{D(x)} dx $$\nSubstituting this into the expressions for the macroscopic law:\n$$ J = -D_{\\mathrm{eff}}^{\\mathrm{hom}} \\frac{-J}{\\ell_{\\mathrm{cell}}} \\int_{0}^{\\ell_{\\mathrm{cell}}} \\frac{1}{D(x)} dx $$\n$$ 1 = \\frac{D_{\\mathrm{eff}}^{\\mathrm{hom}}}{\\ell_{\\mathrm{cell}}} \\int_{0}^{\\ell_{\\mathrm{cell}}} \\frac{1}{D(x)} dx $$\nSolving for $D_{\\mathrm{eff}}^{\\mathrm{hom}}$ yields:\n$$ D_{\\mathrm{eff}}^{\\mathrm{hom}} = \\left( \\frac{1}{\\ell_{\\mathrm{cell}}} \\int_{0}^{\\ell_{\\mathrm{cell}}} \\frac{1}{D(x)} dx \\right)^{-1} $$\nFor the two-phase medium, the integral is:\n$$ \\frac{1}{\\ell_{\\mathrm{cell}}} \\int_{0}^{\\ell_{\\mathrm{cell}}} \\frac{1}{D(x)} dx = \\frac{1}{\\ell_{\\mathrm{cell}}} \\left( \\int_{0}^{f\\ell_{\\mathrm{cell}}} \\frac{1}{D_1} dx + \\int_{f\\ell_{\\mathrm{cell}}}^{\\ell_{\\mathrm{cell}}} \\frac{1}{D_2} dx \\right) = \\frac{f}{D_1} + \\frac{1-f}{D_2} $$\nTherefore, the effective diffusion coefficient is the harmonic mean of the diffusion coefficients, weighted by their volume fractions:\n$$ D_{\\mathrm{eff}}^{\\mathrm{hom}} = \\left( \\frac{f}{D_1} + \\frac{1-f}{D_2} \\right)^{-1} $$\n\n### Step 2: Numerical Inference of Microscale Parameters ($D_{\\mathrm{eff}}^{\\mathrm{micro}}, k_{\\mathrm{eff}}^{\\mathrm{micro}}$)\n\nWe discretize the domain $[0, L]$ into $N$ cells of equal width $h=L/N$. The properties $D$ and $k$ are taken to be piecewise constant within each cell.\n\n#### Inference of $D_{\\mathrm{eff}}^{\\mathrm{micro}}$\n\nThe steady-state problem $\\frac{d}{dx}(D\\frac{du}{dx}) = 0$ is solved with boundary conditions $u(0)=0$ and $u(L)=\\Delta=1$. Using a finite difference scheme on nodes $x_i = ih$, with cell-based diffusion coefficients $D_i$ for the interval $[x_i, x_{i+1}]$, the discrete equation at an interior node $x_i$ is derived from the constancy of flux: $D_{i-1}\\frac{u_i-u_{i-1}}{h} = D_i\\frac{u_{i+1}-u_i}{h}$. This yields the linear system:\n$$ D_{i-1}u_{i-1} - (D_{i-1}+D_i)u_i + D_iu_{i+1} = 0 $$\nfor interior nodes $i=1, \\dots, N-1$. This tridiagonal system is solved for the concentrations $u_i$. The total flux $J$ is then computed from the solution, for example at the first interval: $J = -D_0 \\frac{u_1-u_0}{h}$. The effective diffusion coefficient is inferred from the macroscopic form of Fick's law: $J = -D_{\\mathrm{eff}}^{\\mathrm{micro}} \\frac{\\Delta}{L}$, which gives:\n$$ D_{\\mathrm{eff}}^{\\mathrm{micro}} = - J \\frac{L}{\\Delta} $$\n\n#### Inference of $k_{\\mathrm{eff}}^{\\mathrm{micro}}$\n\nThe system starts with a uniform initial condition $u(x,0)=u_0=1$ and zero-flux boundary conditions. For a uniform field, the diffusion term $\\frac{\\partial}{\\partial x}(D\\frac{\\partial u}{\\partial x})$ is initially zero everywhere. Thus, at $t=0$, the governing equation simplifies to $\\frac{\\partial u}{\\partial t} = -k(x)u$.\nAdvancing by one small explicit Euler time step $dt$ gives the concentration at each discrete location $i$ as $u_i(dt) = u_i(0) - dt \\cdot k_i u_i(0) = u_0(1 - k_i dt)$. The spatial average concentration at time $dt$ is $\\langle u(dt) \\rangle = \\langle u_0(1 - k(x)dt) \\rangle = u_0(1 - \\langle k(x) \\rangle dt)$. The effective reaction rate is defined by the decay of the spatial average: $\\frac{d\\langle u \\rangle}{dt} = -k_{\\mathrm{eff}}\\langle u \\rangle$. Approximating the derivative gives $\\frac{\\langle u(dt) \\rangle - \\langle u(0) \\rangle}{dt} = -k_{\\mathrm{eff}}^{\\mathrm{micro}} \\langle u(0) \\rangle$. Substituting the expressions for the averages yields:\n$$ k_{\\mathrm{eff}}^{\\mathrm{micro}} = -\\frac{u_0(1 - \\langle k \\rangle dt) - u_0}{dt \\cdot u_0} = \\langle k \\rangle $$\nThus, the inferred microscale reaction rate is simply the numerical spatial average of the microscopic reaction rate coefficient, $\\langle k \\rangle_{\\mathrm{num}}$.\n\n### Step 3: Calculation of Model Mismatch\n\nThe mismatches are computed as the relative errors between the numerically inferred microscale parameters and the theoretically derived homogenized parameters.\n$$ \\text{mismatch}_D = \\left|\\frac{D_{\\mathrm{eff}}^{\\mathrm{micro}} - D_{\\mathrm{eff}}^{\\mathrm{hom}}}{D_{\\mathrm{eff}}^{\\mathrm{hom}}}\\right|,\\quad \\text{mismatch}_k = \\left|\\frac{k_{\\mathrm{eff}}^{\\mathrm{micro}} - k_{\\mathrm{eff}}^{\\mathrm{hom}}}{k_{\\mathrm{eff}}^{\\mathrm{hom}}}\\right| $$\nThese quantities measure the consistency of the numerical simulation with the first-principles homogenization theory. For the 1D case, these mismatches are expected to be very small, primarily reflecting floating-point inaccuracies and any minor discretization error in representing the volume fraction $f$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    test_cases = [\n        # Case 1: General heterogeneous case\n        {'L': 100.0, 'l_cell': 5.0, 'f': 0.3, 'D1': 100.0, 'D2': 10.0, 'k1': 0.05, 'k2': 0.01},\n        # Case 2: Extreme diffusion contrast and localized reaction\n        {'L': 96.0, 'l_cell': 6.0, 'f': 0.5, 'D1': 1000.0, 'D2': 1.0, 'k1': 0.00, 'k2': 0.10},\n        # Case 3: Homogeneous limit for verification\n        {'L': 120.0, 'l_cell': 4.0, 'f': 0.4, 'D1': 50.0, 'D2': 50.0, 'k1': 0.02, 'k2': 0.02},\n    ]\n\n    results = []\n    for case in test_cases:\n        mismatch_D, mismatch_k = calculate_mismatches(**case)\n        results.extend([mismatch_D, mismatch_k])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_mismatches(L, l_cell, f, D1, D2, k1, k2):\n    \"\"\"\n    Performs microscale simulations to infer effective parameters and compares\n    them to analytically derived homogenized parameters.\n\n    Args:\n        L (float): Total length of the domain [micrometers].\n        l_cell (float): Length of a single micro-period [micrometers].\n        f (float): Volume fraction of phase 1 [dimensionless].\n        D1, D2 (float): Diffusion coefficients of phase 1 and 2 [micrometer^2/s].\n        k1, k2 (float): Reaction rates of phase 1 and 2 [1/s].\n\n    Returns:\n        tuple[float, float]: The relative mismatches for D and k.\n    \"\"\"\n    # 1. Derive homogenized-model parameters from first principles\n    # Effective diffusion coefficient is the harmonic mean for a 1D layered medium.\n    if D1 = 0 or D2 = 0:\n        if f > 0 and f  1:\n            D_eff_hom = 0.0\n        elif f == 0:\n            D_eff_hom = D2\n        else: # f == 1\n            D_eff_hom = D1\n    else:\n        D_eff_hom = (f / D1 + (1 - f) / D2)**-1\n\n    # Effective reaction rate is the volume-weighted arithmetic mean.\n    k_eff_hom = f * k1 + (1 - f) * k2\n\n    # 2. Setup numerical simulation parameters\n    N_cell_per_period = 100  # Discretization resolution per micro-period\n    N_periods = int(round(L / l_cell))\n    N_cells = N_periods * N_cell_per_period\n    h = L / N_cells\n    n_phase1_cells = int(round(f * N_cell_per_period))\n    \n    # 3. Microscale experiment to infer D_eff_micro\n    D_cell = np.zeros(N_cells)\n    for i in range(N_cells):\n        cell_in_period = i % N_cell_per_period\n        D_cell[i] = D1 if cell_in_period  n_phase1_cells else D2\n            \n    # Solve the steady-state diffusion problem: d/dx(D du/dx) = 0\n    # Boundary conditions: u(0)=0, u(L)=1. This creates a tridiagonal system.\n    num_unknowns = N_cells - 1\n    if num_unknowns > 0 :\n        ab = np.zeros((3, num_unknowns))\n        b = np.zeros(num_unknowns)\n        \n        # Assemble the tridiagonal matrix\n        # For unknown u_j (j=1..N-1), matrix row is j-1\n        # D_{j-1}*u_{j-1} - (D_{j-1}+D_j)*u_j + D_j*u_{j+1} = 0\n        main_diag = -(D_cell[:-1] + D_cell[1:])\n        upper_diag = D_cell[1:-1]\n        lower_diag = D_cell[1:-1]\n        \n        ab[0, 1:] = upper_diag\n        ab[1, :] = main_diag\n        ab[2, :-1] = lower_diag\n        \n        # Assemble the right-hand side vector\n        delta_u = 1.0\n        b[-1] = -D_cell[-1] * delta_u\n        \n        # Solve for interior concentrations\n        u_interior = solve_banded((1, 1), ab, b)\n        u = np.concatenate(([0.0], u_interior, [delta_u]))\n        \n        # Infer D_eff_micro from the resulting flux\n        # J = -D_eff * (u(L)-u(0))/L = -D_eff * delta_u/L\n        # J is constant, can be computed from the first cell: J = -D_0 * (u_1-u_0)/h\n        flux = -D_cell[0] * (u[1] - u[0]) / h\n        D_eff_micro = -flux * L / delta_u\n    else: # Domain has only one cell\n        flux = -D_cell[0] * (1.0 - 0.0) / L\n        D_eff_micro = -flux * L / 1.0\n\n    # 4. Microscale experiment to infer k_eff_micro\n    k_cell = np.zeros(N_cells)\n    for i in range(N_cells):\n        cell_in_period = i % N_cell_per_period\n        k_cell[i] = k1 if cell_in_period  n_phase1_cells else k2\n            \n    # As derived, k_eff_micro is the spatial average of the microscale k values\n    k_eff_micro = np.mean(k_cell)\n\n    # 5. Compute and return mismatches\n    if D_eff_hom == 0:\n        mismatch_D = 0.0 if D_eff_micro == 0.0 else float('inf')\n    else:\n        mismatch_D = abs((D_eff_micro - D_eff_hom) / D_eff_hom)\n\n    if k_eff_hom == 0:\n        mismatch_k = 0.0 if k_eff_micro == 0.0 else float('inf')\n    else:\n        mismatch_k = abs((k_eff_micro - k_eff_hom) / k_eff_hom)\n        \n    return mismatch_D, mismatch_k\n\nif __name__ == '__main__':\n    solve()\n\n```"
        }
    ]
}