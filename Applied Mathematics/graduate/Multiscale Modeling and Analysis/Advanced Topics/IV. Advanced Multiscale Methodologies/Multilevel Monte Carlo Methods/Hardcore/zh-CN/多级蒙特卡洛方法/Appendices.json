{
    "hands_on_practices": [
        {
            "introduction": "多层蒙特卡罗方法（MLMC）的精髓在于它巧妙地耦合了不同层级上的模拟，从而显著降低了修正项的方差。这个练习将通过一个简单的随机微分方程（SDE），让您亲手计算并对比正确耦合与独立（不正确）耦合两种策略下的方差。通过这个鲜明的对比，您将深刻理解为何耦合是MLMC方法能够高效运作的关键所在。",
            "id": "3068034",
            "problem": "考虑标量随机微分方程 (SDE) $dX_t = \\sigma\\, dW_t$，其中 $X_0 = 0$，时间区间为 $[0,T]$。这里，$W_t$ 是一个标准维纳过程，$\\sigma > 0$ 是一个常数。令 $P_\\ell$ 表示在层级 $\\ell$ 上计算的 $X_T$ 的 Euler–Maruyama 终端近似，该计算使用 $N_\\ell$ 个步长为 $h_\\ell = T/N_\\ell$ 的时间步；令 $P_{\\ell-1}$ 表示在层级 $\\ell-1$ 上计算的相应近似，该计算使用 $N_{\\ell-1} = N_\\ell/2$ 个步长为 $h_{\\ell-1} = 2 h_\\ell$ 的时间步。在这两种情况下，Euler–Maruyama 格式定义为 $X_{n+1} = X_n + \\sigma\\, \\Delta W_n$，其中每个布朗增量 $\\Delta W_n$ 服从 $\\mathcal{N}(0,h)$ 分布，$h$ 等于相应的步长。定义 $P_\\ell = \\sum_{n=1}^{N_\\ell} \\sigma\\, \\Delta W^{(\\ell)}_n$ 和 $P_{\\ell-1} = \\sum_{m=1}^{N_{\\ell-1}} \\sigma\\, \\Delta W^{(\\ell-1)}_m$。在多层蒙特卡洛 (MLMC) 方法中，跨层级的耦合被用来减小层级差异的方差。\n\n考虑两种耦合策略：\n- 正确耦合：对于每个 $m \\in \\{1,\\dots,N_{\\ell-1}\\}$，令 $\\Delta W^{(\\ell-1)}_m = \\Delta W^{(\\ell)}_{2m-1} + \\Delta W^{(\\ell)}_{2m}$，其中细层级增量 $\\{\\Delta W^{(\\ell)}_n\\}_{n=1}^{N_\\ell}$ 是独立同分布的，服从 $\\mathcal{N}(0,h_\\ell)$ 分布。\n- 不正确耦合：生成 $\\{\\Delta W^{(\\ell-1)}_m\\}_{m=1}^{N_{\\ell-1}}$ 作为独立同分布的 $\\mathcal{N}(0,h_{\\ell-1})$ 增量，且这些增量独立于细层级增量 $\\{\\Delta W^{(\\ell)}_n\\}_{n=1}^{N_\\ell}$。\n\n仅从布朗运动的独立高斯增量性质和独立随机变量的方差可加性出发，推导每种耦合策略下的 $\\mathrm{Var}(P_\\ell - P_{\\ell-1})$。然后，将不正确耦合下的方差 $\\mathrm{Var}(P_\\ell - P_{\\ell-1})$ 表示为以 $\\sigma$ 和 $T$ 为变量的简化闭式解析表达式。你的最终答案必须是这个表达式。无需四舍五入。",
            "solution": "该问题要求针对随机微分方程 (SDE) $dX_t = \\sigma\\, dW_t$（其中 $X_0 = 0$），在两种不同的耦合策略下，推导细层级和粗层级 Euler-Maruyama 近似之差的方差 $\\mathrm{Var}(P_\\ell - P_{\\ell-1})$。最终答案是在不正确耦合策略下该方差的具体表达式。\n\n令 $P_\\ell$ 和 $P_{\\ell-1}$ 分别为代表在层级 $\\ell$（细）和层级 $\\ell-1$（粗）上终端时刻 $T$ 的数值近似的随机变量。两个随机变量之差的方差通用公式为：\n$$\n\\mathrm{Var}(P_\\ell - P_{\\ell-1}) = \\mathrm{Var}(P_\\ell) + \\mathrm{Var}(P_{\\ell-1}) - 2 \\mathrm{Cov}(P_\\ell, P_{\\ell-1})\n$$\n我们通过先计算各自的方差 $\\mathrm{Var}(P_\\ell)$ 和 $\\mathrm{Var}(P_{\\ell-1})$，然后评估协方差项来分析每种耦合策略。\n\n细层级近似由 $P_\\ell = \\sum_{n=1}^{N_\\ell} \\sigma\\, \\Delta W^{(\\ell)}_n$ 给出，其中 $\\{\\Delta W^{(\\ell)}_n\\}_{n=1}^{N_\\ell}$ 是服从 $\\mathcal{N}(0,h_\\ell)$ 分布的独立同分布 (i.i.d.) 随机变量。$P_\\ell$ 的方差使用独立随机变量的方差可加性以及缩放性质 $\\mathrm{Var}(aZ) = a^2 \\mathrm{Var}(Z)$ 来计算：\n$$\n\\mathrm{Var}(P_\\ell) = \\mathrm{Var}\\left(\\sigma \\sum_{n=1}^{N_\\ell} \\Delta W^{(\\ell)}_n\\right) = \\sigma^2 \\mathrm{Var}\\left(\\sum_{n=1}^{N_\\ell} \\Delta W^{(\\ell)}_n\\right)\n$$\n由于增量 $\\Delta W^{(\\ell)}_n$ 是独立的，它们的和的方差等于它们方差的和：\n$$\n\\mathrm{Var}(P_\\ell) = \\sigma^2 \\sum_{n=1}^{N_\\ell} \\mathrm{Var}(\\Delta W^{(\\ell)}_n) = \\sigma^2 \\sum_{n=1}^{N_\\ell} h_\\ell = \\sigma^2 N_\\ell h_\\ell\n$$\n已知步长为 $h_\\ell = T/N_\\ell$，我们有 $N_\\ell h_\\ell = T$。因此，细层级近似的方差为：\n$$\n\\mathrm{Var}(P_\\ell) = \\sigma^2 T\n$$\n类似地，粗层级近似由 $P_{\\ell-1} = \\sum_{m=1}^{N_{\\ell-1}} \\sigma\\, \\Delta W^{(\\ell-1)}_m$ 给出，其中增量 $\\Delta W^{(\\ell-1)}_m$ 是独立同分布的，服从 $\\mathcal{N}(0,h_{\\ell-1})$ 分布。遵循相同的逻辑：\n$$\n\\mathrm{Var}(P_{\\ell-1}) = \\sigma^2 \\sum_{m=1}^{N_{\\ell-1}} \\mathrm{Var}(\\Delta W^{(\\ell-1)}_m) = \\sigma^2 \\sum_{m=1}^{N_{\\ell-1}} h_{\\ell-1} = \\sigma^2 N_{\\ell-1} h_{\\ell-1}\n$$\n已知 $h_{\\ell-1} = T/N_{\\ell-1}$，我们有 $N_{\\ell-1} h_{\\ell-1} = T$。因此，粗层级近似的方差为：\n$$\n\\mathrm{Var}(P_{\\ell-1}) = \\sigma^2 T\n$$\n我们现在开始评估每种耦合策略下的 $\\mathrm{Var}(P_\\ell - P_{\\ell-1})$。\n\n**1. 不正确耦合策略**\n\n在此策略下，粗层级增量集合 $\\{\\Delta W^{(\\ell-1)}_m\\}_{m=1}^{N_{\\ell-1}}$ 的生成独立于细层级增量集合 $\\{\\Delta W^{(\\ell)}_n\\}_{n=1}^{N_\\ell}$。由于 $P_\\ell$ 仅是细层级增量的函数，而 $P_{\\ell-1}$ 仅是粗层级增量的函数，因此随机变量 $P_\\ell$ 和 $P_{\\ell-1}$ 是独立的。对于独立随机变量，协方差为零：\n$$\n\\mathrm{Cov}(P_\\ell, P_{\\ell-1}) = 0\n$$\n将此代入通用方差公式，得到：\n$$\n\\mathrm{Var}(P_\\ell - P_{\\ell-1}) = \\mathrm{Var}(P_\\ell) + \\mathrm{Var}(P_{\\ell-1})\n$$\n使用先前为 $P_\\ell$ 和 $P_{\\ell-1}$ 推导出的方差：\n$$\n\\mathrm{Var}(P_\\ell - P_{\\ell-1}) = \\sigma^2 T + \\sigma^2 T = 2 \\sigma^2 T\n$$\n这就是不正确耦合下的方差。\n\n**2. 正确耦合策略**\n\n在此策略下，粗层级增量由细层级增量构建：$\\Delta W^{(\\ell-1)}_m = \\Delta W^{(\\ell)}_{2m-1} + \\Delta W^{(\\ell)}_{2m}$。我们直接计算差值 $P_\\ell - P_{\\ell-1}$：\n$$\nP_\\ell - P_{\\ell-1} = \\sum_{n=1}^{N_\\ell} \\sigma\\, \\Delta W^{(\\ell)}_n - \\sum_{m=1}^{N_{\\ell-1}} \\sigma\\, \\Delta W^{(\\ell-1)}_m\n$$\n将耦合定义代入第二项：\n$$\n\\sum_{m=1}^{N_{\\ell-1}} \\sigma\\, \\Delta W^{(\\ell-1)}_m = \\sigma \\sum_{m=1}^{N_{\\ell-1}} \\left( \\Delta W^{(\\ell)}_{2m-1} + \\Delta W^{(\\ell)}_{2m} \\right)\n$$\n这个和覆盖了从 $n=1$ 到 $n=2N_{\\ell-1}$ 的所有细层级增量。由于 $N_\\ell = 2N_{\\ell-1}$，这个和恰好是所有细层级增量的和：\n$$\n\\sigma \\sum_{m=1}^{N_{\\ell-1}} \\left( \\Delta W^{(\\ell)}_{2m-1} + \\Delta W^{(\\ell)}_{2m} \\right) = \\sigma \\sum_{n=1}^{N_\\ell} \\Delta W^{(\\ell)}_n = P_\\ell\n$$\n因此，对于这个特定的 SDE，当使用正确耦合时，粗层级近似 $P_{\\ell-1}$ 与细层级近似 $P_\\ell$ 完全相同。其差值为：\n$$\nP_\\ell - P_{\\ell-1} = P_\\ell - P_\\ell = 0\n$$\n一个常数的方差为零：\n$$\n\\mathrm{Var}(P_\\ell - P_{\\ell-1}) = \\mathrm{Var}(0) = 0\n$$\n这个结果突显了通过正确耦合实现的显著方差减小，这是多层蒙特卡洛方法的基本原理。对于这个简单的 SDE，方差减小是最大的。\n\n问题要求的是不正确耦合方差关于 $\\sigma$ 和 $T$ 的简化闭式解析表达式。如上所述，该表达式为 $2 \\sigma^2 T$。",
            "answer": "$$\n\\boxed{2 \\sigma^{2} T}\n$$"
        },
        {
            "introduction": "在理解了通过耦合降低各层级间差异方差的重要性之后（），下一个自然而然的问题就是：我们应如何在各个层级间分配我们的计算预算以达到最优效率？本练习将引导您解决MLMC方法核心的约束优化问题。您将推导出在给定方差约束下，最小化总计算成本所需的各层级最优样本数量的通用公式。",
            "id": "3783568",
            "problem": "考虑一个由层级 $\\ell \\in \\{0,1,\\dots,L\\}$ 索引的分层离散化序列，用于逼近一个多尺度模型中的标量目标量 $P$。在每个层级 $\\ell$ 上，定义层级差分随机变量 $\\Delta P_{\\ell} = P_{\\ell} - P_{\\ell-1}$（其中 $P_{-1} \\equiv 0$），并假设在给定层级的条件下，可以生成 $\\Delta P_{\\ell}$ 的独立同分布样本。令 $Y$ 表示多层蒙特卡洛 (MLMC) 估计量 (Multilevel Monte Carlo (MLMC))，其表达式为\n$$\nY \\;=\\; \\sum_{\\ell=0}^{L} \\frac{1}{N_{\\ell}} \\sum_{i=1}^{N_{\\ell}} \\Delta P_{\\ell}^{(i)},\n$$\n其中 $N_{\\ell}$ 是在层级 $\\ell$ 抽取的样本数量，$\\Delta P_{\\ell}^{(i)}$ 是 $\\Delta P_{\\ell}$ 的独立副本。假设以下基本事实：对于每个层级 $\\ell$，样本均值的方差等于层级方差除以样本数量，即\n$$\n\\operatorname{Var}\\!\\left(\\frac{1}{N_{\\ell}} \\sum_{i=1}^{N_{\\ell}} \\Delta P_{\\ell}^{(i)}\\right) \\;=\\; \\frac{V_{\\ell}}{N_{\\ell}},\n$$\n其中 $V_{\\ell} = \\operatorname{Var}(\\Delta P_{\\ell})$，并且 $Y$ 的总方差是各独立层级方差之和。此外，假设生成 $\\Delta P_{\\ell}$ 的单个样本的期望计算成本为 $C_{\\ell}$，因此总期望成本为\n$$\n\\mathcal{C} \\;=\\; \\sum_{\\ell=0}^{L} N_{\\ell} C_{\\ell}.\n$$\n在一项预研究中，您已分别获得了 $V_{\\ell}$ 和 $C_{\\ell}$ 的经验估计量 $\\hat{V}_{\\ell}$ 和 $\\hat{C}_{\\ell}$。您希望选择 $\\{N_{\\ell}\\}_{\\ell=0}^{L}$ 以在满足以下方差约束的条件下最小化 $\\mathcal{C}$：\n$$\n\\operatorname{Var}(Y) \\;=\\; \\sum_{\\ell=0}^{L} \\frac{V_{\\ell}}{N_{\\ell}} \\;\\le\\; \\frac{1}{2}\\,\\varepsilon^{2},\n$$\n其中 $\\varepsilon>0$ 是为均方误差预设的精度容差，误差预算的另一半通过适当选择 $L$ 为偏差的平方预留。将 $\\{N_{\\ell}\\}_{\\ell=0}^{L}$ 视为连续正决策变量，并使用预研究的估计量代替未知的真实 $V_{\\ell}$ 和 $C_{\\ell}$。推导最优分配 $N_{\\ell}$ 的闭式表达式，该表达式用 $\\varepsilon$、$\\hat{V}_{\\ell}$、$\\hat{C}_{\\ell}$ 和 $L$ 表示，并且能在使方差约束取等号的条件下最小化成本。请以包含这些符号的单一解析表达式形式提供 $N_{\\ell}$ 的最终结果。无需四舍五-入，无单位。",
            "solution": "任务是为多层蒙特卡洛 (MLMC) 估计量找到样本的最优分配 $\\{N_{\\ell}\\}_{\\ell=0}^{L}$。这是一个经典的约束优化问题，其目标是在总方差约束下最小化总计算成本。\n\n该问题可以正式表述为：\n最小化总期望成本，\n$$\n\\mathcal{C}(\\{N_{\\ell}\\}_{\\ell=0}^{L}) \\;=\\; \\sum_{\\ell=0}^{L} N_{\\ell} \\hat{C}_{\\ell}\n$$\n约束条件为方差约束取等号，\n$$\n\\operatorname{Var}(Y) \\;=\\; \\sum_{\\ell=0}^{L} \\frac{\\hat{V}_{\\ell}}{N_{\\ell}} \\;=\\; \\frac{1}{2}\\,\\varepsilon^{2}.\n$$\n此处，$\\{\\hat{V}_{\\ell}\\}_{\\ell=0}^{L}$ 和 $\\{\\hat{C}_{\\ell}\\}_{\\ell=0}^{L}$ 分别是经验估计的层级方差和成本。样本数量 $\\{N_{\\ell}\\}_{\\ell=0}^{L}$ 被视为连续正变量。\n\n这个约束优化问题适用于拉格朗日乘数法。我们将拉格朗日函数 $\\mathcal{L}$ 定义为目标函数加上拉格朗日乘数 $\\lambda$ 乘以约束函数：\n$$\n\\mathcal{L}(\\{N_{\\ell}\\}, \\lambda) \\;=\\; \\sum_{\\ell=0}^{L} N_{\\ell} \\hat{C}_{\\ell} + \\lambda \\left( \\left(\\sum_{\\ell=0}^{L} \\frac{\\hat{V}_{\\ell}}{N_{\\ell}}\\right) - \\frac{1}{2}\\varepsilon^{2} \\right).\n$$\n为求最小值，我们计算 $\\mathcal{L}$ 关于每个 $N_{k}$ (其中 $k \\in \\{0, 1, \\dots, L\\}$) 的偏导数，并令其为零。\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial N_{k}} \\;=\\; \\hat{C}_{k} - \\lambda \\frac{\\hat{V}_{k}}{N_{k}^{2}} \\;=\\; 0.\n$$\n由于 $\\hat{C}_{k} > 0$ 且 $\\hat{V}_{k} \\ge 0$，并且我们要求 $N_k > 0$，因此拉格朗日乘数 $\\lambda$ 必须为正。我们可以重新整理该方程以解出 $N_{k}$：\n$$\n\\hat{C}_{k} N_{k}^{2} \\;=\\; \\lambda \\hat{V}_{k} \\quad \\implies \\quad N_{k}^{2} \\;=\\; \\lambda \\frac{\\hat{V}_{k}}{\\hat{C}_{k}}.\n$$\n取正平方根，因为 $N_k$ 必须是正量，我们得到：\n$$\nN_{k} \\;=\\; \\sqrt{\\lambda} \\sqrt{\\frac{\\hat{V}_{k}}{\\hat{C}_{k}}}.\n$$\n该表达式给出了每个层级 $k$ 的最优样本数，用未知的拉格朗日乘数 $\\lambda$ 表示。为确定 $\\lambda$，我们将 $N_{k}$ 的表达式代回方差约束方程：\n$$\n\\sum_{k=0}^{L} \\frac{\\hat{V}_{k}}{N_{k}} \\;=\\; \\frac{1}{2}\\varepsilon^{2}.\n$$\n$$\n\\sum_{k=0}^{L} \\frac{\\hat{V}_{k}}{\\sqrt{\\lambda} \\sqrt{\\frac{\\hat{V}_{k}}{\\hat{C}_{k}}}} \\;=\\; \\frac{1}{2}\\varepsilon^{2}.\n$$\n化简求和号内的项：\n$$\n\\frac{\\hat{V}_{k}}{\\sqrt{\\frac{\\hat{V}_{k}}{\\hat{C}_{k}}}} \\;=\\; \\frac{(\\sqrt{\\hat{V}_{k}})^{2} \\sqrt{\\hat{C}_{k}}}{\\sqrt{\\hat{V}_{k}}} \\;=\\; \\sqrt{\\hat{V}_{k} \\hat{C}_{k}}.\n$$\n约束方程变为：\n$$\n\\sum_{k=0}^{L} \\frac{\\sqrt{\\hat{V}_{k} \\hat{C}_{k}}}{\\sqrt{\\lambda}} \\;=\\; \\frac{1}{2}\\varepsilon^{2}.\n$$\n我们可以从求和式中提取公因子 $1/\\sqrt{\\lambda}$：\n$$\n\\frac{1}{\\sqrt{\\lambda}} \\sum_{k=0}^{L} \\sqrt{\\hat{V}_{k} \\hat{C}_{k}} \\;=\\; \\frac{1}{2}\\varepsilon^{2}.\n$$\n现在，我们解出 $\\sqrt{\\lambda}$：\n$$\n\\sqrt{\\lambda} \\;=\\; \\frac{2}{\\varepsilon^{2}} \\sum_{k=0}^{L} \\sqrt{\\hat{V}_{k} \\hat{C}_{k}}.\n$$\n最后，我们将 $\\sqrt{\\lambda}$ 的这个表达式代回到我们的最优 $N_{\\ell}$ 方程中（根据问题陈述的要求使用索引 $\\ell$）：\n$$\nN_{\\ell} \\;=\\; \\sqrt{\\lambda} \\sqrt{\\frac{\\hat{V}_{\\ell}}{\\hat{C}_{\\ell}}} \\;=\\; \\left( \\frac{2}{\\varepsilon^{2}} \\sum_{k=0}^{L} \\sqrt{\\hat{V}_{k} \\hat{C}_{k}} \\right) \\sqrt{\\frac{\\hat{V}_{\\ell}}{\\hat{C}_{\\ell}}}.\n$$\n此方程为每个层级 $\\ell$ 的最优样本数 $N_{\\ell}$ 提供了闭式表达式，它在满足指定方差约束的同时最小化了总计算成本。",
            "answer": "$$\\boxed{ N_{\\ell} = \\frac{2}{\\varepsilon^{2}} \\sqrt{\\frac{\\hat{V}_{\\ell}}{\\hat{C}_{\\ell}}} \\sum_{k=0}^{L} \\sqrt{\\hat{V}_{k} \\hat{C}_{k}} }$$"
        },
        {
            "introduction": "在推导出了最优样本分配的通用公式之后（），我们现在可以将其应用于一个具体的计算场景。本练习将提供一组符合典型行为的假设方差（$V_\\ell$）和成本（$C_\\ell$）模型。您的任务是运用所学理论，计算出为达到给定的精度目标 $\\epsilon$，在每个层级上所需的具体样本数量 $N_\\ell$，并最终确定总计算功耗。",
            "id": "3067966",
            "problem": "考虑在 $t\\in[0,1]$ 上的几何布朗运动随机微分方程 (SDE) $\\mathrm{d}X_t=\\mu X_t\\,\\mathrm{d}t+\\sigma X_t\\,\\mathrm{d}W_t$，其初始条件为 $X_0=1$，参数为 $\\mu,\\sigma\\in\\mathbb{R}$。设目标是使用多层蒙特卡洛 (MLMC) 方法对一个 Lipschitz 偿付 $P=g(X_1)$ 的期望 $\\mathbb{E}[P]$ 进行近似。一个由 $\\ell=0,1,2,3,4$ 构成的 Euler–Maruyama 时间步长层级 $h_\\ell=2^{-\\ell}$ 已经通过独立的偏差分析被确定，以确保在目标精度 $\\epsilon=10^{-2}$ 下，偏差平方的贡献至多为 $\\epsilon^2/2$。根据引导性模拟，对于 $\\ell=0,1,2,3,4$，层级差分方差和每样本成本估计为 $V_\\ell=\\operatorname{Var}(Y_\\ell)=2^{-\\ell}$ 和 $C_\\ell=\\text{第 }\\ell\\text{ 层上每样本的成本}=2^{\\ell}$，其中 $Y_0=P_0$ 且对于 $\\ell\\ge 1$ 有 $Y_\\ell=P_\\ell-P_{\\ell-1}$。\n\n确定整数样本数 $N_\\ell\\in\\mathbb{N}$（对于 $\\ell=0,1,2,3,4$），在满足方差约束 $\\sum_{\\ell=0}^{4}\\frac{V_\\ell}{N_\\ell}\\le \\epsilon^2/2$ 的前提下，最小化总计算量。仅使用约束优化的第一性原理来推导此分配方案。使用你得到的整数 $N_\\ell$ 计算产生的总计算量 $W=\\sum_{\\ell=0}^{4}N_\\ell C_\\ell$。仅报告总计算量作为最终答案。对最终数字没有舍入要求；请提供精确的整数。",
            "solution": "任务是确定多层蒙特卡洛（MLMC）估计量的整数样本数 $N_\\ell$，以在估计量方差的约束下最小化总计算量。该问题是一个经典的约束优化练习。\n\n首先，我们将该优化问题形式化。\n设 $L=4$ 为最大层级。\n我们旨在最小化的总计算量是目标函数：\n$$W = \\sum_{\\ell=0}^{L} N_\\ell C_\\ell$$\n此处，$N_\\ell$ 是层级 $\\ell$ 上的样本数，$C_\\ell$ 是层级 $\\ell$ 上每个样本的计算成本。\n\nMLMC 估计量的方差由 $\\sum_{\\ell=0}^{L} \\frac{V_\\ell}{N_\\ell}$ 给出，其中 $V_\\ell$ 是层级差分估计量 $Y_\\ell$ 的方差。问题对此方差指定了一个约束：\n$$\\sum_{\\ell=0}^{L} \\frac{V_\\ell}{N_\\ell} \\le \\frac{\\epsilon^2}{2}$$\n其中 $\\epsilon$ 是目标精度。\n\n对于层级 $\\ell = 0, 1, 2, 3, 4$，我们有以下具体问题数据：\n- 目标精度：$\\epsilon = 10^{-2}$，因此方差约束为 $\\frac{\\epsilon^2}{2} = \\frac{(10^{-2})^2}{2} = \\frac{10^{-4}}{2} = 5 \\times 10^{-5}$。\n- 层级差分方差：$V_\\ell = 2^{-\\ell}$。\n- 每样本成本：$C_\\ell = 2^{\\ell}$。\n- 层级数为 $L+1 = 5$。\n\n为在约束条件下求 $W$ 的最小值，我们使用拉格朗日乘数法。我们首先将 $N_\\ell$ 视为连续实变量。最小计算量将在方差约束为紧约束时出现，即等式成立时：\n$$\\sum_{\\ell=0}^{L} \\frac{V_\\ell}{N_\\ell} = \\frac{\\epsilon^2}{2}$$\n\n拉格朗日函数 $\\mathcal{L}$ 为：\n$$\\mathcal{L}(N_0, \\dots, N_L, \\lambda) = \\sum_{\\ell=0}^{L} N_\\ell C_\\ell + \\lambda \\left( \\sum_{\\ell=0}^{L} \\frac{V_\\ell}{N_\\ell} - \\frac{\\epsilon^2}{2} \\right)$$\n其中 $\\lambda$ 是拉格朗日乘数。\n\n为求最小值，我们将 $\\mathcal{L}$ 关于每个 $N_k$ 的偏导数设为零：\n$$\\frac{\\partial \\mathcal{L}}{\\partial N_k} = C_k - \\lambda \\frac{V_k}{N_k^2} = 0$$\n解出 $N_k$ 得：\n$$C_k N_k^2 = \\lambda V_k \\implies N_k^2 = \\lambda \\frac{V_k}{C_k} \\implies N_k = \\sqrt{\\lambda} \\sqrt{\\frac{V_k}{C_k}}$$\n这表明最优样本数 $N_k$ 与 $\\sqrt{V_k/C_k}$ 成正比。\n\n接下来，我们将 $N_k$ 的表达式代回紧的方差约束中，以确定 $\\sqrt{\\lambda}$ 的值：\n$$\\sum_{\\ell=0}^{L} \\frac{V_\\ell}{\\sqrt{\\lambda} \\sqrt{V_\\ell/C_\\ell}} = \\frac{\\epsilon^2}{2}$$\n$$\\frac{1}{\\sqrt{\\lambda}} \\sum_{\\ell=0}^{L} \\frac{V_\\ell \\sqrt{C_\\ell}}{\\sqrt{V_\\ell}} = \\frac{\\epsilon^2}{2}$$\n$$\\frac{1}{\\sqrt{\\lambda}} \\sum_{\\ell=0}^{L} \\sqrt{V_\\ell C_\\ell} = \\frac{\\epsilon^2}{2}$$\n解出 $\\sqrt{\\lambda}$：\n$$\\sqrt{\\lambda} = \\frac{2}{\\epsilon^2} \\sum_{\\ell=0}^{L} \\sqrt{V_\\ell C_\\ell}$$\n\n现在我们将 $\\sqrt{\\lambda}$ 的这个表达式代回 $N_k$ 的方程中：\n$$N_k = \\left( \\frac{2}{\\epsilon^2} \\sum_{\\ell=0}^{L} \\sqrt{V_\\ell C_\\ell} \\right) \\sqrt{\\frac{V_k}{C_k}}$$\n\n让我们计算这个具体问题的各项。\n乘积 $\\sqrt{V_\\ell C_\\ell}$ 为：\n$$\\sqrt{V_\\ell C_\\ell} = \\sqrt{2^{-\\ell} \\cdot 2^{\\ell}} = \\sqrt{1} = 1$$\n对所有层级 $L=4$ 求和得到：\n$$\\sum_{\\ell=0}^{4} \\sqrt{V_\\ell C_\\ell} = \\sum_{\\ell=0}^{4} 1 = 5$$\n项 $\\sqrt{V_k/C_k}$ 为：\n$$\\sqrt{\\frac{V_k}{C_k}} = \\sqrt{\\frac{2^{-k}}{2^k}} = \\sqrt{2^{-2k}} = 2^{-k}$$\n\n现在我们可以计算最优（实值）$N_k$：\n$$N_k = \\left( \\frac{2}{(10^{-2})^2} \\cdot 5 \\right) \\cdot 2^{-k} = \\left( \\frac{2}{10^{-4}} \\cdot 5 \\right) \\cdot 2^{-k} = (2 \\cdot 10^4 \\cdot 5) \\cdot 2^{-k} = 10^5 \\cdot 2^{-k}$$\n\n问题要求整数样本数 $N_k \\in \\mathbb{N}$。我们来计算这些值：\n- 对于 $\\ell=0$: $N_0 = 10^5 \\cdot 2^{-0} = 100000$\n- 对于 $\\ell=1$: $N_1 = 10^5 \\cdot 2^{-1} = 50000$\n- 对于 $\\ell=2$: $N_2 = 10^5 \\cdot 2^{-2} = 25000$\n- 对于 $\\ell=3$: $N_3 = 10^5 \\cdot 2^{-3} = 12500$\n- 对于 $\\ell=4$: $N_4 = 10^5 \\cdot 2^{-4} = 6250$\n\n由于所有计算出的最优 $N_\\ell$ 值都是整数，我们无需进行任何舍入。这些就是最小化成本的整数样本数。\n\n最后，我们使用这些最优样本数计算总计算量 $W$：\n$$W = \\sum_{\\ell=0}^{4} N_\\ell C_\\ell = \\sum_{\\ell=0}^{4} (10^5 \\cdot 2^{-\\ell}) \\cdot (2^{\\ell})$$\n$$W = \\sum_{\\ell=0}^{4} 10^5 = 10^5 \\cdot (4 - 0 + 1) = 5 \\cdot 10^5 = 500000$$\n\n另外，也可以直接推导出最小计算量：\n$$W = \\sum_{\\ell=0}^{L} N_\\ell C_\\ell = \\sum_{\\ell=0}^{L} \\left( \\sqrt{\\lambda} \\sqrt{\\frac{V_\\ell}{C_\\ell}} \\right) C_\\ell = \\sqrt{\\lambda} \\sum_{\\ell=0}^{L} \\sqrt{V_\\ell C_\\ell}$$\n代入 $\\sqrt{\\lambda}$ 的表达式：\n$$W = \\left( \\frac{2}{\\epsilon^2} \\sum_{j=0}^{L} \\sqrt{V_j C_j} \\right) \\left( \\sum_{\\ell=0}^{L} \\sqrt{V_\\ell C_\\ell} \\right) = \\frac{2}{\\epsilon^2} \\left( \\sum_{\\ell=0}^{L} \\sqrt{V_\\ell C_\\ell} \\right)^2$$\n代入本问题的数值：\n$$W = \\frac{2}{(10^{-2})^2} (5)^2 = \\frac{2}{10^{-4}} \\cdot 25 = 2 \\cdot 10^4 \\cdot 25 = 50 \\cdot 10^4 = 500000$$\n两种方法得到相同的结果。最小总计算量为 $500000$。",
            "answer": "$$\\boxed{500000}$$"
        }
    ]
}