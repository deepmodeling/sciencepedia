{"hands_on_practices": [{"introduction": "理想的范数概念是元素范数的推广。对于主理想而言，这种联系最为直接：理想的范数就是其生成元域范数的绝对值。本练习 [@problem_id:3019799] 将引导您在二次域中明确推导这一基本关系，为理解更复杂的情形奠定坚实的基础。", "problem": "设 $d$ 是一个固定的无平方因子整数，满足 $d \\neq 0$ 且 $d \\neq 1$。令 $K=\\mathbb{Q}(\\sqrt{d})$ 为一个二次数域，其整数环为 $\\mathcal{O}_K$。对于不全为零的整数 $a,b$，考虑主分式理想 $\\left(a+b\\sqrt{d}\\right)\\mathcal{O}_K \\subset K$。从元素 $\\alpha \\in K$ 的域范数 $N_{K/\\mathbb{Q}}(\\alpha)$ 作为其 Galois 共轭之积的定义出发，并结合非零分式理想的绝对范数定义以及二次数域整数环的特征，推导绝对范数 $N\\!\\left(\\left(a+b\\sqrt{d}\\right)\\mathcal{O}_K\\right)$ 关于 $a$，$b$ 和 $d$ 的一个闭式表达式。此外，解释当 $d \\equiv 1 \\pmod{4}$ 时，这个范数如何能写成 $a+b\\sqrt{d}$ 关于 $\\mathcal{O}_K$ 的一个整基的坐标的二元二次型，并说明这两个表达式之间的关系。你的最终答案必须是 $N\\!\\left(\\left(a+b\\sqrt{d}\\right)\\mathcal{O}_K\\right)$ 关于 $a$，$b$ 和 $d$ 的一个单一闭式解析表达式。", "solution": "问题要求计算二次数域 $K = \\mathbb{Q}(\\sqrt{d})$ 中主分式理想 $I = (a+b\\sqrt{d})\\mathcal{O}_K$ 的绝对范数，其中 $d$ 是不等于 $0$ 或 $1$ 的无平方因子整数，而 $a,b$ 是不全为零的整数。\n\n首先，我们建立必要的定义和关系。数域 $K = \\mathbb{Q}(\\sqrt{d})$ 在 $\\mathbb{Q}$ 上的次数为 $2$。扩张 $K/\\mathbb{Q}$ 的 Galois 群阶为 $2$，包含恒等映射和共轭自同构 $\\sigma: K \\to K$，定义为对任意 $x, y \\in \\mathbb{Q}$ 有 $\\sigma(x+y\\sqrt{d}) = x-y\\sqrt{d}$。\n\n元素 $\\alpha \\in K$ 的域范数定义为其 Galois 共轭的乘积。对于 $\\alpha = a+b\\sqrt{d}$，其共轭为 $\\sigma(\\alpha) = a-b\\sqrt{d}$。\n因此，域范数为：\n$$N_{K/\\mathbb{Q}}(\\alpha) = \\alpha \\cdot \\sigma(\\alpha) = (a+b\\sqrt{d})(a-b\\sqrt{d}) = a^2 - (b\\sqrt{d})^2 = a^2 - db^2$$\n由于 $a, b, d$ 是整数，所以 $N_{K/\\mathbb{Q}}(a+b\\sqrt{d})$ 总是整数。\n\n接下来，我们讨论理想 $I = (a+b\\sqrt{d})\\mathcal{O}_K$ 的性质。题目将其称为分式理想。一个分式理想是 $K$ 的一个 $\\mathcal{O}_K$-子模 $J$，使得存在一个非零的 $c \\in \\mathcal{O}_K$ 满足 $cJ \\subseteq \\mathcal{O}_K$。一个整理想是 $\\mathcal{O}_K$ 的一个子集的分式理想。由 $\\alpha \\in K$ 生成的主分式理想是整理想当且仅当 $\\alpha \\in \\mathcal{O}_K$。\n\n让我们确定生成元 $\\alpha = a+b\\sqrt{d}$ 是否是代数整数，即 $\\alpha \\in \\mathcal{O}_K$ 是否成立。数域中的一个元素是代数整数，当且仅当其在 $\\mathbb{Q}$ 上的极小多项式是首一整系数多项式。$\\alpha = a+b\\sqrt{d}$ 的极小多项式（因为 $b \\neq 0$ 意味着 $\\alpha \\notin \\mathbb{Q}$）是：\n$$m(x) = (x - \\alpha)(x - \\sigma(\\alpha)) = x^2 - (\\alpha + \\sigma(\\alpha))x + \\alpha\\sigma(\\alpha) = x^2 - (2a)x + (a^2-db^2)$$\n根据假设，$a$ 和 $b$ 是整数，所以这个首一多项式的系数 $-2a$ 和 $a^2-db^2$ 都是整数。因此，对于任意整数 $a, b$，$\\alpha=a+b\\sqrt{d}$ 都是一个代数整数。这意味着 $\\alpha \\in \\mathcal{O}_K$，因此 $I = (a+b\\sqrt{d})\\mathcal{O}_K$ 是一个主整理想。\n\n非零整理想 $J \\subset \\mathcal{O}_K$ 的绝对范数定义为商环的基数，即 $N(J) = |\\mathcal{O}_K / J|$。代数数论的一个基本定理指出，对于由元素 $\\alpha \\in \\mathcal{O}_K$ 生成的主整理想 $J = (\\alpha)$，其范数等于其生成元的域范数的绝对值：\n$$N((\\alpha)) = |N_{K/\\mathbb{Q}}(\\alpha)|$$\n这可以通过将 $\\mathcal{O}_K$ 视为一个秩为 $2$ 的自由 $\\mathbb{Z}$-模来证明。由 $x \\mapsto \\alpha x$ 定义的乘法映射 $m_\\alpha: \\mathcal{O}_K \\to \\mathcal{O}_K$ 是一个 $\\mathbb{Z}$-线性自同态。它的像是理想 $(\\alpha)$。像的指数 $[\\mathcal{O}_K : (\\alpha)]$，也就是理想的范数，由表示 $m_\\alpha$ 关于 $\\mathcal{O}_K$ 的任意 $\\mathbb{Z}$-基的矩阵的行列式的绝对值给出。根据定义，这个行列式就是域范数 $N_{K/\\mathbb{Q}}(\\alpha)$。\n\n综合这些结果，理想 $I = (a+b\\sqrt{d})\\mathcal{O}_K$ 的绝对范数是：\n$$N(I) = |N_{K/\\mathbb{Q}}(a+b\\sqrt{d})| = |a^2 - db^2|$$\n这个表达式给出了所要求的关于 $a, b$ 和 $d$ 的闭式表达式。\n\n题目进一步要求分析 $d \\equiv 1 \\pmod{4}$ 的情况，并将此范数与关于一个整基的二元二次型联系起来。整数环 $\\mathcal{O}_K$ 的整基根据 $d \\pmod{4}$ 的不同而不同。\n\n情况1：$d \\equiv 2 \\text{ 或 } 3 \\pmod{4}$。\n整数环为 $\\mathcal{O}_K = \\mathbb{Z}[\\sqrt{d}]$，一个标准整基是 $\\{1, \\sqrt{d}\\}$。$\\mathcal{O}_K$ 中的元素 $\\gamma$ 具有形式 $x \\cdot 1 + y \\cdot \\sqrt{d}$，其中 $x, y \\in \\mathbb{Z}$。这样一个元素的范数是 $N_{K/\\mathbb{Q}}(\\gamma) = x^2 - dy^2$。这是一个关于坐标 $(x,y)$ 的二元二次型。对于我们的元素 $\\alpha = a+b\\sqrt{d}$，它在这个基下的坐标是 $(a,b)$，所以其范数直接就是 $a^2 - db^2$。\n\n情况2：$d \\equiv 1 \\pmod{4}$。\n整数环为 $\\mathcal{O}_K = \\mathbb{Z}\\left[\\frac{1+\\sqrt{d}}{2}\\right]$。一个标准整基是 $\\{1, \\omega\\}$，其中 $\\omega = \\frac{1+\\sqrt{d}}{2}$。\n$\\mathcal{O}_K$ 中的任意元素 $\\gamma$ 具有形式 $\\gamma = x \\cdot 1 + y \\cdot \\omega$，其中 $x,y$ 是唯一的整数。让我们用这些坐标 $(x,y)$ 来计算它的域范数。$\\omega$ 的共轭是 $\\bar{\\omega} = \\frac{1-\\sqrt{d}}{2}$。\n$$N_{K/\\mathbb{Q}}(\\gamma) = (x+y\\omega)(x+y\\bar{\\omega}) = x^2 + xy(\\omega+\\bar{\\omega}) + y^2(\\omega\\bar{\\omega})$$\n我们有 $\\omega+\\bar{\\omega} = \\frac{1+\\sqrt{d}}{2} + \\frac{1-\\sqrt{d}}{2} = 1$，以及 $\\omega\\bar{\\omega} = \\left(\\frac{1}{2}\\right)^2 - \\left(\\frac{\\sqrt{d}}{2}\\right)^2 = \\frac{1-d}{4}$。因为 $d \\equiv 1 \\pmod{4}$，$1-d$ 能被 $4$ 整除，所以 $\\frac{1-d}{4}$ 是一个整数。\n范数由以下二元二次型给出：\n$$N_{K/\\mathbb{Q}}(x+y\\omega) = Q(x,y) = x^2 + xy + \\frac{1-d}{4}y^2$$\n现在我们将其与我们原来的元素 $\\alpha = a+b\\sqrt{d}$（其中 $a,b \\in \\mathbb{Z}$）联系起来。我们必须找到它在基 $\\{1, \\omega\\}$ 下的坐标 $(x,y)$。\n$$a+b\\sqrt{d} = x + y\\left(\\frac{1+\\sqrt{d}}{2}\\right) = \\left(x+\\frac{y}{2}\\right) + \\left(\\frac{y}{2}\\right)\\sqrt{d}$$\n比较 $\\sqrt{d}$ 的系数和有理部分：\n$\\frac{y}{2} = b \\implies y = 2b$\n$x+\\frac{y}{2} = a \\implies x+b=a \\implies x = a-b$\n所以 $\\alpha=a+b\\sqrt{d}$ 在整基 $\\{1, \\omega\\}$ 下的坐标是 $(x,y) = (a-b, 2b)$。由于 $a, b$ 是整数，$x, y$ 也是整数，这与 $\\alpha \\in \\mathcal{O}_K$ 一致。\n\n让我们将这些坐标代回二次型 $Q(x,y)$ 中：\n$$Q(a-b, 2b) = (a-b)^2 + (a-b)(2b) + \\frac{1-d}{4}(2b)^2$$\n$$= (a^2 - 2ab + b^2) + (2ab - 2b^2) + \\frac{1-d}{4}(4b^2)$$\n$$= a^2 - 2ab + b^2 + 2ab - 2b^2 + (1-d)b^2$$\n$$= a^2 - b^2 + b^2 - db^2$$\n$$= a^2 - db^2$$\n这证实了域范数 $N_{K/\\mathbb{Q}}(a+b\\sqrt{d})$ 的计算结果为 $a^2-db^2$，无论使用哪个基进行计算。这两个表达式是恒等式。表达式 $a^2 - db^2$ 是一个元素在 $K$ 的 $\\mathbb{Q}$-基 $\\{1, \\sqrt{d}\\}$ 下表示时的域范数的一般形式，而二次型 $Q(x,y)$ 是特定于当 $d\\equiv 1 \\pmod{4}$ 时 $\\mathcal{O}_K$ 的整基。该计算显示了它们对于任何元素 $\\alpha \\in \\mathcal{O}_K$ 的等价性。\n\n总之，对于任意无平方因子整数 $d \\neq 0, 1$ 和任意不全为零的整数 $a, b$，主理想 $(a+b\\sqrt{d})\\mathcal{O}_K$ 的绝对范数是 $|N_{K/\\mathbb{Q}}(a+b\\sqrt{d})|$。这就得到了一个在所有情况下都有效的单一表达式。", "answer": "$$\\boxed{|a^2-db^2|}$$", "id": "3019799"}, {"introduction": "并非所有理想都由单个元素生成。本练习 [@problem_id:3019783] 将带您进入非主理想的领域，演示如何根据其在整数环中的加法指数这一定义直接计算范数。通过在 $\\mathbb{Q}(\\sqrt{-5})$ 中处理一个具体例子，您将获得处理理想加法结构的实践经验，并验证范数的乘法性质。", "problem": "令 $K=\\mathbb{Q}(\\sqrt{-5})$，并令 $\\mathcal{O}_{K}$ 表示其整数环。考虑非主理想 $\\mathfrak{a}=(2,\\,1+\\sqrt{-5})\\subset\\mathcal{O}_{K}$。仅使用以下基本定义：(i) 非零整理想 $\\mathfrak{b}\\subset\\mathcal{O}_{K}$ 的范数是 $N(\\mathfrak{b})=[\\mathcal{O}_{K}:\\mathfrak{b}]$，即 $\\mathfrak{b}$ 在 $\\mathcal{O}_{K}$ 中的加法指数，以及 (ii) 对于主理想 $(\\alpha)$，$N((\\alpha))=|N_{K/\\mathbb{Q}}(\\alpha)|$，通过在 $\\mathcal{O}_{K}$ 中进行显式指数计算来计算 $N(\\mathfrak{a})$ 和 $N(\\mathfrak{a}^{2})$。根据您的计算，判断 $N(\\mathfrak{a}^{2})$ 是否与 $N(\\mathfrak{a})^{2}$ 相等，从而验证此情况下的乘法性。将最终答案以 $N(\\mathfrak{a})$ 和 $N(\\mathfrak{a}^{2})$ 这两个值的形式给出。", "solution": "二次域为 $K = \\mathbb{Q}(\\sqrt{-5})$。整数 $d=-5$ 是无平方因子数，且满足 $-5 \\equiv 3 \\pmod{4}$。因此，$K$ 的整数环是 $\\mathcal{O}_K = \\mathbb{Z}[\\sqrt{-5}]$。作为一个自由 $\\mathbb{Z}$-模，$\\mathcal{O}_K$ 具有整基 $\\{1, \\sqrt{-5}\\}$。因此，$\\mathcal{O}_K$ 中的任何元素都可以唯一地写成 $a+b\\sqrt{-5}$ 的形式，其中整数 $a, b \\in \\mathbb{Z}$。\n\n所讨论的理想是 $\\mathfrak{a}=(2,\\,1+\\sqrt{-5})$。问题要求我们通过显式计算这些理想在 $\\mathcal{O}_K$ 中的指数来计算范数 $N(\\mathfrak{a})$ 和 $N(\\mathfrak{a}^2)$。非零整理想 $\\mathfrak{b}$ 的范数定义为 $N(\\mathfrak{b}) = [\\mathcal{O}_K:\\mathfrak{b}] = |\\mathcal{O}_K/\\mathfrak{b}|$。\n\n首先，我们计算 $N(\\mathfrak{a})$。我们必须刻画理想 $\\mathfrak{a}$ 的元素。根据定义，$\\mathfrak{a}$ 由其生成元 $2$ 和 $1+\\sqrt{-5}$ 的所有 $\\mathcal{O}_K$-线性组合构成。\n要计算指数，将 $\\mathfrak{a}$ 作为一个 $\\mathbb{Z}$-模来刻画更为直接。$\\mathfrak{a}$ 中的一个元素 $x+y\\sqrt{-5}$ ($x,y \\in \\mathbb{Z}$) 可以表示为 $2$ 和 $1+\\sqrt{-5}$ 的 $\\mathbb{Z}$-线性组合的特定形式。可以证明，一个元素 $x+y\\sqrt{-5}$ 属于 $\\mathfrak{a}$ 当且仅当其系数满足 $x \\equiv y \\pmod{2}$。\n因此，我们已经将理想 $\\mathfrak{a}$ 刻画为 $\\mathcal{O}_K$ 的一个子集：\n$$ \\mathfrak{a} = \\{ x+y\\sqrt{-5} \\in \\mathcal{O}_K \\mid x \\equiv y \\pmod{2} \\} $$\n现在我们可以计算指数 $[\\mathcal{O}_K:\\mathfrak{a}]$。商群 $\\mathcal{O}_K/\\mathfrak{a}$ 由陪集 $(x+y\\sqrt{-5})+\\mathfrak{a}$ 组成。两个元素 $x_1+y_1\\sqrt{-5}$ 和 $x_2+y_2\\sqrt{-5}$ 在同一个陪集中，当且仅当它们的差在 $\\mathfrak{a}$ 中。这等价于 $(x_1-x_2) \\equiv (y_1-y_2) \\pmod{2}$，可以重写为 $x_1-y_1 \\equiv x_2-y_2 \\pmod{2}$。这意味着一个陪集由 $(x-y) \\pmod 2$ 的值唯一确定。\n$\\mathcal{O}_K$ 中的一个元素 $x+y\\sqrt{-5}$ 的 $x-y$ 可以是偶数或奇数。\n如果 $x-y$ 是偶数，则 $x \\equiv y \\pmod 2$，这意味着 $x+y\\sqrt{-5} \\in \\mathfrak{a}$。这是单位陪集 $\\mathfrak{a}$。\n如果 $x-y$ 是奇数，这对应于另一个陪集。例如，元素 $1 = 1+0\\sqrt{-5}$ 满足 $1-0=1$ 是奇数。\n恰好有两个不同的陪集：$\\mathfrak{a}$ 和 $1+\\mathfrak{a}$。商群的阶是 $2$。\n因此，$N(\\mathfrak{a}) = [\\mathcal{O}_K:\\mathfrak{a}] = 2$。\n\n接下来，我们计算 $N(\\mathfrak{a}^2)$。首先，我们必须确定理想 $\\mathfrak{a}^2$。\n$$ \\mathfrak{a}^2 = (2, 1+\\sqrt{-5})(2, 1+\\sqrt{-5}) = (2\\cdot 2, 2(1+\\sqrt{-5}), (1+\\sqrt{-5})^2) $$\n生成元是 $4$，$2+2\\sqrt{-5}$，和 $(1+\\sqrt{-5})^2 = 1+2\\sqrt{-5}-5 = -4+2\\sqrt{-5}$。\n所以，$\\mathfrak{a}^2 = (4, 2+2\\sqrt{-5}, -4+2\\sqrt{-5})$。\n我们来证明 $\\mathfrak{a}^2$ 是主理想 $(2)$。\n首先，$\\mathfrak{a}^2$ 的所有生成元都是 $2$ 的倍数，因此 $\\mathfrak{a}^2 \\subseteq (2)$。\n其次，为了证明 $(2) \\subseteq \\mathfrak{a}^2$，我们需要说明 $2 \\in \\mathfrak{a}^2$。我们知道 $4$ 是 $\\mathfrak{a}^2$ 的生成元之一，所以 $4 \\in \\mathfrak{a}^2$。我们还可证明 $6 \\in \\mathfrak{a}^2$：由于 $1+\\sqrt{-5} \\in \\mathfrak{a}$ 且 $2 \\in \\mathfrak{a}$，那么 $1-\\sqrt{-5} = (1+\\sqrt{-5}) - 2\\sqrt{-5}$ 也在 $\\mathfrak{a}$ 中。因此，它们的乘积 $(1+\\sqrt{-5})(1-\\sqrt{-5}) = 6$ 就在 $\\mathfrak{a}^2$ 中。由于 $\\mathfrak{a}^2$ 是一个理想，它包含 $4$ 和 $6$，因此也包含它们的差 $6-4=2$。既然 $2 \\in \\mathfrak{a}^2$，则主理想 $(2)$ 包含于 $\\mathfrak{a}^2$ 中。\n结合两个包含关系，我们得出结论 $\\mathfrak{a}^2=(2)$。\n\n现在我们通过指数计算来计算 $N(\\mathfrak{a}^2) = N((2))$：\n$$ N((2)) = [\\mathcal{O}_K:(2)] = |\\mathcal{O}_K/2\\mathcal{O}_K| $$\n理想 $(2)$ 是 $2\\mathcal{O}_K = \\{ 2(x+y\\sqrt{-5}) \\mid x,y \\in \\mathbb{Z} \\} = \\{ 2x+2y\\sqrt{-5} \\mid x,y \\in \\mathbb{Z} \\}$。\n一个元素 $x_1+y_1\\sqrt{-5}$ 与 $x_2+y_2\\sqrt{-5}$ 模 $(2)$ 同余，如果它们的差在 $(2)$ 中。\n这成立当且仅当 $x_1-x_2$ 和 $y_1-y_2$ 都是偶数，即 $x_1\\equiv x_2 \\pmod 2$ 且 $y_1\\equiv y_2 \\pmod 2$。\n一个陪集代表由剩余对 $(x \\pmod 2, y \\pmod 2)$ 决定。共有 $2 \\times 2 = 4$ 个这样的对：$(0,0), (0,1), (1,0), (1,1)$。\n这给出了四个不同的陪集，代表元为 $0, \\sqrt{-5}, 1, 1+\\sqrt{-5}$。\n商群 $\\mathcal{O}_K/(2)$ 的阶是 $4$。\n因此，$N(\\mathfrak{a}^2) = 4$。\n\n最后，我们比较 $N(\\mathfrak{a}^2)$ 和 $N(\\mathfrak{a})^2$。\n我们得到 $N(\\mathfrak{a}) = 2$ 和 $N(\\mathfrak{a}^2) = 4$。\n因此，$N(\\mathfrak{a})^2 = 2^2 = 4 = N(\\mathfrak{a}^2)$。\n这在 $\\mathfrak{b}=\\mathfrak{c}=\\mathfrak{a}$ 的特定情况下验证了理想范数的乘法性质 $N(\\mathfrak{b}\\mathfrak{c})=N(\\mathfrak{b})N(\\mathfrak{c})$。\n\n问题要求给出 $N(\\mathfrak{a})$ 和 $N(\\mathfrak{a}^{2})$ 这两个值。\n$N(\\mathfrak{a})=2$。\n$N(\\mathfrak{a}^2)=4$。", "answer": "$$\\boxed{\\begin{pmatrix} 2  4 \\end{pmatrix}}$$", "id": "3019783"}, {"introduction": "理想指数的计算可以通过线性代数的方法系统化。本练习 [@problem_id:3019796] 将理想范数描述为格的体积之比，这个量可以由基变换矩阵的行列式来捕捉。通过开发一个通用算法，您将把一个抽象的数论概念转化为一个强大且普遍适用的计算工具。", "problem": "给定一个在有理数域 $\\mathbb{Q}$ 上次数为 $n$ 的数域 $K$ 及其整数环 $\\mathcal{O}_K$。设 $\\{e_1,\\dots,e_n\\}$ 是 $\\mathcal{O}_K$ 的一个固定的 $\\mathbb{Z}$-基。考虑 $K$ 中的一个非零理想或分数理想 $\\mathfrak{a} \\subset K$，其 $\\mathbb{Z}$-基为 $\\{v_1,\\dots,v_n\\}$，其中每个 $v_i$ 表示为 $e_j$ 的 $\\mathbb{Q}$-线性组合：\n$$\nv_i \\;=\\; \\sum_{j=1}^n m_{ij}\\, e_j \\quad \\text{其中 } m_{ij} \\in \\mathbb{Q}.\n$$\n构造矩阵 $M = (m_{ij}) \\in \\mathrm{Mat}_{n \\times n}(\\mathbb{Q})$，其第 $i$ 行记录了 $v_i$ 在基 $\\{e_j\\}$ 下的坐标。你的任务是设计并实现一个算法，通过将理想范数 $N(\\mathfrak{a})$ 解释为格的余体积之比（即从 $\\mathcal{O}_K$ 到 $\\mathfrak{a}$ 的基变换矩阵的行列式的绝对值），从矩阵 $M$ 计算 $N(\\mathfrak{a})$。\n\n该算法必须从以下基本原理推导得出：\n\n- 对于非零整理想 $\\mathfrak{a} \\subset \\mathcal{O}_K$，理想范数的定义是 $N(\\mathfrak{a}) = \\lvert \\mathcal{O}_K / \\mathfrak{a} \\rvert$，它等于指数 $[\\mathcal{O}_K : \\mathfrak{a}]$。\n- 范数通过规则 $N(\\mathfrak{a}) = N(\\alpha \\mathfrak{a}) / \\lvert N_{K/\\mathbb{Q}}(\\alpha) \\rvert$ 乘性地推广到分数理想，其中 $\\alpha \\in K^\\times$ 使得 $\\alpha \\mathfrak{a} \\subset \\mathcal{O}_K$（所得结果与 $\\alpha$ 的选择无关）。\n- 对于 $\\mathbb{R}^n$ 中的满秩 $\\mathbb{Z}$-格 $L, L'$，若其基通过矩阵 $M \\in \\mathrm{GL}_n(\\mathbb{Q})$ 相关联，则对于整格，指数 $[L : L']$ 等于行列式的绝对值 $\\lvert \\det(M) \\rvert$，更一般地，余体积之比 $\\mathrm{covol}(L')/\\mathrm{covol}(L)$ 等于 $\\lvert \\det(M) \\rvert$。\n\n从这些原理可以得出结论：对于表示 $\\mathfrak{a}$ 的 $\\mathbb{Z}$-基在 $\\mathcal{O}_K$ 的 $\\mathbb{Z}$-基下的矩阵 $M$，有\n$$\nN(\\mathfrak{a}) \\;=\\; \\lvert \\det(M) \\rvert,\n$$\n需要理解的是，如果 $\\mathfrak{a}$ 是一个整理想，那么 $M$ 的元素是整数；如果 $\\mathfrak{a}$ 是一个分数理想，那么 $M$ 的元素可以是有理数，从而得到一个正有理范数。\n\n你必须实现一个算法，使用有理数算术精确计算 $\\lvert \\det(M) \\rvert$，并将值 $N(\\mathfrak{a})$ 报告为一个数字。如果该值是整数，则以整数形式输出；如果它是一个非整数的有理数，则以十进制（浮点）数形式输出。\n\n测试套件：\n对以下每个矩阵 $M$ 计算 $N(\\mathfrak{a})$，其中环境次数 $n$ 等于矩阵的大小。每个矩阵表示 $\\mathfrak{a}$ 的一个 $\\mathbb{Z}$-基在 $\\mathcal{O}_K$ 的固定 $\\mathbb{Z}$-基下的坐标。\n\n- 情况1（整理想，次数 $n=2$ 的对角缩放）： \n  $$\n  M = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}.\n  $$\n  预期 $N(\\mathfrak{a}) = \\lvert \\det(M) \\rvert = 2$。\n\n- 情况2（整理想，次数 $n=2$ 的幺模变换，负定向）：\n  $$\n  M = \\begin{pmatrix} 1  1 \\\\ 0  -1 \\end{pmatrix}.\n  $$\n  预期 $N(\\mathfrak{a}) = \\lvert \\det(M) \\rvert = 1$。\n\n- 情况3（主整理想 $(d)$，次数 $n=3$，其中 $d=5$）：\n  $$\n  M = 5 \\cdot I_3 = \\begin{pmatrix} 5  0  0 \\\\ 0  5  0 \\\\ 0  0  5 \\end{pmatrix}.\n  $$\n  预期 $N((5)) = \\lvert 5 \\rvert^3 = 125$。\n\n- 情况4（分数理想，次数 $n=2$，有理对角矩阵）：\n  $$\n  M = \\begin{pmatrix} \\tfrac{1}{2}  0 \\\\ 0  \\tfrac{3}{2} \\end{pmatrix}.\n  $$\n  预期 $N(\\mathfrak{a}) = \\lvert \\det(M) \\rvert = \\tfrac{3}{4}$，应报告为小数 $0.75$。\n\n- 情况5（分数理想，次数 $n=3$，上三角矩阵，对角线有负元素）：\n  $$\n  M = \\begin{pmatrix} \\tfrac{1}{2}  \\tfrac{1}{3}  0 \\\\ 0  2  \\tfrac{1}{2} \\\\ 0  0  -3 \\end{pmatrix}.\n  $$\n  预期 $N(\\mathfrak{a}) = \\lvert \\det(M) \\rvert = \\lvert \\tfrac{1}{2} \\cdot 2 \\cdot (-3) \\rvert = 3$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含按测试用例1到5的顺序排列的结果，以逗号分隔并用方括号括起来，例如 $[2,1,125,0.75,3]$。", "solution": "目标是推导并实现一个算法，用于计算数域 $K$ 中非零理想或分数理想 $\\mathfrak{a}$ 的范数 $N(\\mathfrak{a})$。计算将基于从整数环 $\\mathcal{O}_K$ 的一个 $\\mathbb{Z}$-基到 $\\mathfrak{a}$ 的一个 $\\mathbb{Z}$-基的基变换矩阵 $M$。推导将建立在所提供的、将理想范数与格指数和余体积相关联的原理之上。\n\n设 $K$ 是一个次数为 $n = [K:\\mathbb{Q}]$ 的数域。其整数环 $\\mathcal{O}_K$ 是一个秩为 $n$ 的自由 $\\mathbb{Z}$-模。设 $\\{e_1, \\dots, e_n\\}$ 为 $\\mathcal{O}_K$ 的一个固定 $\\mathbb{Z}$-基。$K$ 的任何非零理想（整理想或分数理想）$\\mathfrak{a}$ 也是一个秩为 $n$ 的自由 $\\mathbb{Z}$-模。设 $\\{v_1, \\dots, v_n\\}$ 为 $\\mathfrak{a}$ 的一个 $\\mathbb{Z}$-基。这两个基之间的关系由一个矩阵 $M = (m_{ij}) \\in \\mathrm{GL}_n(\\mathbb{Q})$ 给出，使得对 $i=1, \\dots, n$ 有 $v_i = \\sum_{j=1}^n m_{ij} e_j$。我们的目标是证明理想的范数 $N(\\mathfrak{a})$ 由该矩阵行列式的绝对值给出，即 $N(\\mathfrak{a}) = \\lvert \\det(M) \\rvert$。\n\n我们分两种情况进行讨论：整理想和分数理想。\n\n**情况1：整理想**\n\n设 $\\mathfrak{a}$ 是一个非零整理想，因此 $\\mathfrak{a} \\subseteq \\mathcal{O}_K$。由于 $\\mathfrak{a}$ 是 $\\mathcal{O}_K$ 的一个子模，其基向量 $\\{v_i\\}$ 必须能表示为 $\\mathcal{O}_K$ 的基向量 $\\{e_j\\}$ 的 $\\mathbb{Z}$-线性组合。这意味着矩阵 $M=(m_{ij})$ 的元素是整数，即 $M \\in \\mathrm{Mat}_{n\\times n}(\\mathbb{Z})$。\n\n根据提供的第一个原理，整理想 $\\mathfrak{a}$ 的范数定义为商环的大小，$N(\\mathfrak{a}) = \\lvert \\mathcal{O}_K / \\mathfrak{a} \\rvert$。由于 $\\mathcal{O}_K$ 和 $\\mathfrak{a}$ 都是秩为 $n$ 的自由 $\\mathbb{Z}$-模，这个大小等价于 $\\mathfrak{a}$ 作为 $\\mathcal{O}_K$ 加法群中的子群的指数，记作 $[\\mathcal{O}_K : \\mathfrak{a}]$。\n\n我们可以将 $\\mathcal{O}_K$ 和 $\\mathfrak{a}$ 视为由基 $\\{e_j\\}$ 张成的 $n$ 维空间中的满秩格。第三个原理指出，对于格 $L = \\mathcal{O}_K$ 和 $L' = \\mathfrak{a}$，其中 $L'$ 的基是通过矩阵 $M$ 从 $L$ 的基获得的，指数 $[L:L']$ 由 $\\lvert \\det(M) \\rvert$ 给出。这是主理想整环（如 $\\mathbb{Z}$）上模理论的一个标准结果。\n\n结合这些原理：\n$$\nN(\\mathfrak{a}) = [\\mathcal{O}_K : \\mathfrak{a}] = \\lvert \\det(M) \\rvert.\n$$\n这就为整理想建立了公式。\n\n**情况2：分数理想**\n\n现在，设 $\\mathfrak{a}$ 是一个非零分数理想。根据定义，存在一个非零元素 $c \\in \\mathcal{O}_K$ 使得 $c\\mathfrak{a}$ 是一个整理想。我们总可以选择这个元素为一个正整数，比如说 $d \\in \\mathbb{Z}^+$，使得 $\\mathfrak{b} = d\\mathfrak{a}$ 是一个整理想。$\\mathfrak{a}$ 的基是 $\\{v_1, \\dots, v_n\\}$，由矩阵 $M \\in \\mathrm{Mat}_{n \\times n}(\\mathbb{Q})$ 给出。因此，整理想 $\\mathfrak{b}$ 的一个基是 $\\{dv_1, \\dots, dv_n\\}$。从 $\\{e_j\\}$ 到 $\\{dv_i\\}$ 的基变换矩阵因此是 $dM$。\n\n第二个原理提供了将范数推广到分数理想的规则：$N(\\mathfrak{a}) = N(\\alpha \\mathfrak{a}) / \\lvert N_{K/\\mathbb{Q}}(\\alpha) \\rvert$，其中 $\\alpha \\in K^\\times$ 使得 $\\alpha\\mathfrak{a}$ 是一个整理想。我们选择 $\\alpha = d \\in \\mathbb{Z}^+$。那么 $\\mathfrak{b} = d\\mathfrak{a}$ 是一个整理想，该公式给出：\n$$\nN(\\mathfrak{a}) = \\frac{N(\\mathfrak{b})}{\\lvert N_{K/\\mathbb{Q}}(d) \\rvert}.\n$$\n从情况1，我们可以计算 $N(\\mathfrak{b})$。$\\mathfrak{b}$ 的基变换矩阵是 $dM$。因此，\n$$\nN(\\mathfrak{b}) = \\lvert \\det(dM) \\rvert = \\lvert d^n \\det(M) \\rvert = d^n \\lvert \\det(M) \\rvert,\n$$\n因为 $d$ 是一个正整数。\n\n接下来，我们计算域范数 $N_{K/\\mathbb{Q}}(d)$。元素 $d \\in \\mathbb{Z} \\subset K$ 通过乘法作用于 $K$。在基 $\\{e_1, \\dots, e_n\\}$ 中，“乘以 $d$” 这个映射将每个基向量 $e_j$ 变换为 $de_j$。这个线性变换的矩阵表示是对角矩阵 $dI_n$，其中 $I_n$ 是 $n \\times n$ 单位矩阵。域范数是这个矩阵的行列式：\n$$\nN_{K/\\mathbb{Q}}(d) = \\det(dI_n) = d^n.\n$$\n将这些结果代回 $N(\\mathfrak{a})$ 的方程：\n$$\nN(\\mathfrak{a}) = \\frac{N(\\mathfrak{b})}{\\lvert N_{K/\\mathbb{Q}}(d) \\rvert} = \\frac{d^n \\lvert \\det(M) \\rvert}{\\lvert d^n \\rvert} = \\lvert \\det(M) \\rvert.\n$$\n这证实了公式 $N(\\mathfrak{a}) = \\lvert \\det(M) \\rvert$ 对分数理想同样成立。\n\n**算法设计**\n\n问题现在简化为计算一个给定有理数项的 $n \\times n$ 矩阵 $M$ 的行列式的绝对值。\"使用有理数算术精确计算\" 这句话表明，在计算中应避免使用可能引入精度误差的浮点算术。\n\n1.  **数据表示**：矩阵 $M$ 的元素是有理数。为了保持精确性，我们使用 Python 标准库中可用的 `fractions.Fraction` 类来表示每个元素 $m_{ij}$。\n\n2.  **行列式计算**：我们必须计算一个元素为 `Fraction` 对象的矩阵的行列式。一个标准且高效的算法是高斯消元法。该过程包括将矩阵转换为上三角形式，其行列式就是其对角线元素的乘积。\n    - 我们创建输入矩阵的一个可变副本。\n    - 我们从 $k=0$ 到 $n-1$ 遍历各列，使用位置 $(k,k)$ 处的元素作为主元来消除同一列中其下方的所有元素。\n    - 如果 $(k,k)$ 处的主元为零，我们在同一列中查找行 $i > k$ 处的一个非零元素，并将第 $i$ 行与第 $k$ 行交换。每次行交换都会使行列式变号。如果找不到非零主元，则行列式为零。\n    - 将一行的倍数加到另一行（$R_i \\leftarrow R_i - c R_k$）的行操作不会改变行列式的值。\n    - 矩阵变为上三角形式后，其行列式是对角线元素的乘积，再乘以每次行交换所产生的 $-1$。\n\n3.  **最终结果格式化**：计算出的行列式将是一个 `Fraction` 对象。我们取其绝对值。\n    - 如果所得分数的分母为 $1$，则它表示一个整数。我们将其格式化为整数。\n    - 否则，它是一个非整数的有理数，我们按要求将其格式化为浮点小数。\n\n该算法保证了对任何有理数项矩阵都能得到精确结果，从而正确计算理想范数 $N(\\mathfrak{a})$。", "answer": "```python\nimport numpy as np\nfrom fractions import Fraction\n\ndef determinant_rational(matrix_of_fractions):\n    \"\"\"\n    Computes the determinant of a matrix with Fraction entries using\n    Gaussian elimination. This ensures exact rational arithmetic.\n    \"\"\"\n    n = len(matrix_of_fractions)\n    # Create a mutable copy of the matrix\n    A = [row[:] for row in matrix_of_fractions]\n    \n    sign = 1\n    \n    for k in range(n):\n        # Find a non-zero pivot in column k, starting from row k\n        pivot_row = k\n        while pivot_row  n and A[pivot_row][k] == 0:\n            pivot_row += 1\n        \n        if pivot_row == n:\n            # No pivot found in this column, matrix is singular\n            return Fraction(0)\n        \n        # Swap rows to move the pivot to the diagonal position (k, k)\n        if pivot_row != k:\n            A[k], A[pivot_row] = A[pivot_row], A[k]\n            sign *= -1\n            \n        pivot_element = A[k][k]\n        \n        # Use the pivot to eliminate all entries below it in the same column\n        for i in range(k + 1, n):\n            if A[i][k] == 0:\n                continue\n            \n            # The factor is chosen to make A[i][k] zero\n            factor = A[i][k] / pivot_element\n            # Perform the row operation: R_i - R_i - factor * R_k\n            for j in range(k, n):\n                A[i][j] -= factor * A[k][j]\n\n    # The determinant of the resulting upper triangular matrix is the product\n    # of its diagonal elements.\n    det = Fraction(sign)\n    for i in range(n):\n        det *= A[i][i]\n        \n    return det\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    # Define test cases where matrix entries are num/den pairs.\n    test_cases_raw = [\n        # Case 1: M = [[2, 0], [0, 1]]\n        [[(2, 1), (0, 1)],\n         [(0, 1), (1, 1)]],\n        \n        # Case 2: M = [[1, 1], [0, -1]]\n        [[(1, 1), (1, 1)],\n         [(0, 1), (-1, 1)]],\n        \n        # Case 3: M = 5 * I_3\n        [[(5, 1), (0, 1), (0, 1)],\n         [(0, 1), (5, 1), (0, 1)],\n         [(0, 1), (0, 1), (5, 1)]],\n        \n        # Case 4: M = [[1/2, 0], [0, 3/2]]\n        [[(1, 2), (0, 1)],\n         [(0, 1), (3, 2)]],\n        \n        # Case 5: M is upper triangular\n        [[(1, 2), (1, 3), (0, 1)],\n         [(0, 1), (2, 1), (1, 2)],\n         [(0, 1), (0, 1), (-3, 1)]]\n    ]\n\n    # Convert raw test cases into matrices of Fraction objects\n    test_cases = []\n    for raw_matrix in test_cases_raw:\n        matrix = [[Fraction(num, den) for num, den in raw_row] for raw_row in raw_matrix]\n        test_cases.append(matrix)\n\n    results = []\n    for M in test_cases:\n        # The norm N(a) is the absolute value of the determinant of M.\n        det = determinant_rational(M)\n        norm = abs(det)\n        \n        # Format the result as an integer or a float based on its value.\n        if norm.denominator == 1:\n            result = int(norm.numerator)\n        else:\n            result = float(norm)\n        results.append(result)\n\n    # Print the final results in the specified format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3019796"}]}