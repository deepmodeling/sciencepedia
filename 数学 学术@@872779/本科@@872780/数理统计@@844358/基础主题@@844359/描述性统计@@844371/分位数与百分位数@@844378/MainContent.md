## 引言
在数据分析的世界里，我们常常使用均值来概括数据的中心趋势，但这远非故事的全貌。一个数据点在整个群体中的相对位置，往往蕴含着更丰富的信息。分位数与百分位数正是为此而生的关键统计工具，它使我们能够精确描述一个值在其[分布](@entry_id:182848)中所处的位置，从而解决了仅凭绝对数值无法衡量其相对重要性的问题。理解分位数不仅是掌握描述性统计的基础，更是通往高级统计推断和跨学科数据应用的门户。

本文将带领读者深入探索分位数的世界。在第一章**“原理与机制”**中，我们将从数学定义出发，详细阐述连续和[离散随机变量](@entry_id:163471)的[分位数](@entry_id:178417)计算方法，并深入探讨中位数等关键[分位数](@entry_id:178417)的统计特性，如稳健性。接着，在第二章**“应用与跨学科联系”**中，我们将展示[分位数](@entry_id:178417)如何在金融、工程、医学和机器学习等不同领域解决实际问题，从风险价值（VaR）的评估到[生存分析](@entry_id:163785)，再到前沿的[分位数回归](@entry_id:169107)模型。最后，在第三章**“动手实践”**中，你将通过一系列精心设计的问题，将理论知识付诸实践，巩固对核心概念的理解。通过这三个章节的学习，你将构建起对分位数的全面认识，并学会如何运用它来揭示数据背后更深层次的洞见。

## 原理与机制

在统计分析中，我们常常不仅关心数据的中心趋势（如均值），还关心数据点在整个[分布](@entry_id:182848)中的相对位置。一个学生在考试中获得85分，这个绝对分数本身提供的信息有限。但是，如果我们知道该学生的分数排在所有考生中的第85百分位，我们就能立刻理解其表现超越了85%的同学。这种描述相对位置的度量工具就是**分位数 (Quantiles)**。本章将系统地阐述[分位数](@entry_id:178417)的定义、计算方法及其在理论和实践中的重要性质。

### [分位数](@entry_id:178417)的定义

分位数是将一个[概率分布](@entry_id:146404)或一组观测数据划分为等概率（或等数量）区间的切点。对于一个[随机变量](@entry_id:195330) $X$，其 **$p$-分位数** (或第 $p$ 个[分位数](@entry_id:178417))，记作 $x_p$，是一个数值，它将[分布](@entry_id:182848)的概率质量分为两部分：至多有 $p$ 的比例位于 $x_p$ 左侧，同时至多有 $(1-p)$ 的比例位于其右侧。这里的 $p$ 是一个介于0和1之间的数。

[分位数](@entry_id:178417)的概念有几个常见的特例，它们在不同场合下有专门的名称：

*   **百[分位数](@entry_id:178417) (Percentiles)**: 这是最常见的形式，其中 $p$ 以百分比表示。例如，第85百分位数对应于 $p=0.85$ 的分位数。
*   **[四分位数](@entry_id:167370) (Quartiles)**: 它们将数据分为四个相等的部分。
    *   **第一[四分位数](@entry_id:167370) ($Q_1$)**: 对应于 $p=0.25$，即第25百分位数。
    *   **第二[四分位数](@entry_id:167370) ($Q_2$)**: 对应于 $p=0.50$，即第50百分位数。
    *   **第三[四分位数](@entry_id:167370) ($Q_3$)**: 对应于 $p=0.75$，即第75百分位数。
*   **中位数 (Median)**: 这是第二[四分位数](@entry_id:167370) $Q_2$ 的另一个名称，它标志着[分布](@entry_id:182848)的“正中心”，有50%的数据小于它，50%的数据大于它。

### [随机变量](@entry_id:195330)的分位数

分位数的精确数学定义取决于我们处理的是[连续随机变量](@entry_id:166541)还是[离散随机变量](@entry_id:163471)。

#### [连续随机变量](@entry_id:166541)的分位数

对于一个具有累积分布函数 (Cumulative Distribution Function, CDF) $F(x)$ 的[连续随机变量](@entry_id:166541) $X$，其 $p$-分位数 $x_p$ 的定义非常直观。如果 $F(x)$ 是严格单调递增的，那么 $x_p$ 就是满足下式的唯一解：

$F(x_p) = \int_{-\infty}^{x_p} f(t) dt = p$

其中 $f(t)$ 是该[随机变量](@entry_id:195330)的概率密度函数 (Probability Density Function, PDF)。从几何上看，$x_p$ 是这样一个点，它左侧PDF曲线下的面积恰好等于 $p$。

例如，在[可靠性工程](@entry_id:271311)中，一个电子元件的寿命 $T$ 可以用一个[随机变量](@entry_id:195330)来建模。假设其CDF为 $F_T(t) = \frac{t^2}{t^2 + \alpha^2}$ 对于 $t \ge 0$，其中 $\alpha$ 是一个与制造工艺相关的正常数。工程师可能关心所谓的“B15寿命”，即15%的元件预期会失效的时间点。这正是该寿命[分布](@entry_id:182848)的0.15-分位数。为了找到它，我们需求解方程 $F_T(t_{0.15}) = 0.15$ [@problem_id:1329216]。通过代数运算，我们可以得到 $t_{0.15} = \alpha \sqrt{\frac{3}{17}}$。

在更复杂的情况下，PDF可能是分段定义的。例如，考虑一个金融模型中某资产的日相对价格变化 $X$，其PDF在 $[-L, L]$ 区间上由两段线性函数构成。要计算其75百分位数（即第三[四分位数](@entry_id:167370) $Q_3$），我们必须首先通过对整个PDF积分等于1的条件来标准化函数，然后构建其分段的CDF $F(x)$。由于75%这个位置可能落在CDF的第二段定义域内，我们就需要解出相应的方程 $F(x_{0.75}) = 0.75$ 来找到分位数值 [@problem_id:1949190]。

这个求解CDF反函数的过程是寻找连续[分位数](@entry_id:178417)的通用方法。即使对于像 $F(E) = \frac{\ln(E)}{\ln(20)}$ 这样的非代数形式的CDF（这可以模拟[粒子探测器](@entry_id:273214)中的能量[分布](@entry_id:182848)），我们也可以通过求解 $F(E_p) = p$ 来找到任意百[分位数](@entry_id:178417)，例如第40百分位数 $P_{40}$ 和第三[四分位数](@entry_id:167370) $Q_3$ [@problem_id:1943547]。求解可得 $E_p = 20^p$。

#### [离散随机变量](@entry_id:163471)的分位数

对于[离散随机变量](@entry_id:163471)，其CDF是一个阶梯函数，因此方程 $F(x) = p$ 可能没有解。在这种情况下，我们采用一个稍有不同的定义：$p$-分位数是满足 $F(x_p) \ge p$ 的**最小值** $x_p$。

$x_p = \min \{x | F(x) \ge p\}$

考虑一个质量控制场景：一个自动系统逐一检测芯片，每次检测成功的概率为 $p$。我们想知道至少需要检测多少个芯片（设为 $k$），才能保证以至少 $q$ 的概率观测到一次成功。设 $X$ 为直到第一次成功所需的检测次数，这是一个[几何分布](@entry_id:154371)。我们需要找到最小的整数 $k$ 使得 $\Pr(X \le k) \ge q$。这里的 $k$ 正是该几何分布的 $q$-分位数。通过解不等式 $1 - (1-p)^k \ge q$，我们可以得到 $k = \left\lceil \frac{\ln(1-q)}{\ln(1-p)} \right\rceil$ [@problem_id:1949186]。这个结果为制造商设定性能保证提供了明确的数学依据。

### 样本分位数：从理论到数据

当处理一组有限的观测数据（一个样本）时，[分位数](@entry_id:178417)的计算变得不那么唯一。理论上，样本是从一个未知的总体[分布](@entry_id:182848)中抽取的，我们计算样本[分位数](@entry_id:178417)是为了估计总体[分位数](@entry_id:178417)。然而，对于如何从有限的样本中“最佳”地估计分位数，并没有一个普遍统一的标准。因此，不同的统计软件和教科书可能会采用不同的计算方法。

让我们来看几个常见的方法。假设我们有一个大小为 $n$ 的数据集，已按升序[排列](@entry_id:136432)为 $x_1, x_2, \dots, x_n$。

*   **方法1 ([经验分布函数](@entry_id:178599)法)**: 这种方法将秩（rank）计算为 $k = \lceil p \cdot n \rceil$，其中 $\lceil \cdot \rceil$ 是向[上取整函数](@entry_id:262460)。那么第 $p$ 百[分位数](@entry_id:178417)就是数据点 $x_k$。

*   **方法2 ([线性插值法](@entry_id:140450))**: 这种方法在相邻的两个数据点之间进行插值。秩被定义为 $r = 1 + p(n-1)$。如果 $r$ 是整数，则分位数就是 $x_r$。如果 $r$ 不是整数，设其整数部分为 $i$ (即 $\lfloor r \rfloor$)，小数部分为 $f$，则[分位数](@entry_id:178417)由 $x_i$ 和 $x_{i+1}$ [线性插值](@entry_id:137092)得到：$(1-f)x_i + f x_{i+1}$。

为了说明这些差异，考虑一个包含4个API响应时间的小样本：$\{10, 20, 40, 50\}$ 毫秒。我们要计算第75百[分位数](@entry_id:178417) ($p=0.75$) [@problem_id:1949201]。
使用方法1，秩为 $k = \lceil 0.75 \times 4 \rceil = \lceil 3 \rceil = 3$。因此，75百分位数是第3个数据点，$x_3 = 40.0$。
使用方法2，秩为 $r = 1 + 0.75 \times (4-1) = 1 + 2.25 = 3.25$。整数部分 $i=3$，小数部分 $f=0.25$。因此，75百分位数是 $(1-0.25)x_3 + 0.25x_4 = 0.75 \times 40 + 0.25 \times 50 = 30 + 12.5 = 42.5$。
可见，两种标准方法给出了不同的结果。

还有些方法结合了这两种思想。例如，一种常见的定义是计算索引 $R = \frac{p}{100} \times N$。如果 $R$ 不是整数，则向上取整并取对应秩的数据点（类似方法1）；如果 $R$ 是整数，则取第 $R$ 个和第 $R+1$ 个数据点的平均值。这种[混合方法](@entry_id:163463)凸显了样本[分位数](@entry_id:178417)计算的灵活性。例如，在一个19名学生的数据集中计算第90百[分位数](@entry_id:178417)，我们得到 $R = 0.90 \times 19 = 17.1$，向上取整为18，[分位数](@entry_id:178417)为排序后的第18个分数。但如果增加一个学生使总人数变为20，我们得到 $R = 0.90 \times 20 = 18$，此时[分位数](@entry_id:178417)变为第18和第19个分数的平均值 [@problem_id:1949181]。这个例子也说明，样本分位数的值可能对数据集中单个点的增减非常敏感。

### 中位数：深入探讨

[中位数](@entry_id:264877)作为最重要的分位数，具有一些使其在统计分析中格外有用的独特性质。

#### 性质1：对异常值的稳健性

与均值相比，中位数对极端值（或称异常值）不敏感，这一特性被称为**稳健性 (robustness)**。均值是所有数据点的总和除以数据点的数量，因此一个极大的或极小的值会显著地“拉动”均值。而[中位数](@entry_id:264877)只取决于排序后中间位置的值，不受两端极端值大小的影响。

考虑一个由10名员工组成的团队，其中9名员工的年薪均为5万美元，而他们的经理年薪为50万美元。该团队薪酬的算术平均值 $\mu = (9 \times 50,000 + 500,000) / 10 = 95,000$ 美元。这个均值被经理的极端高薪显著拉高，远高于团队中90%成员的实际收入。然而，薪酬的中位数是排序后中间位置的数值（第5和第6位员工薪水的平均值），即5万美元。在这个例子中，均值（9.5万美元）远大于[中位数](@entry_id:264877)（5万美元），清晰地揭示了[分布](@entry_id:182848)的[右偏](@entry_id:180351)斜性。这说明，在处理可能包含异常值或具有偏斜[分布](@entry_id:182848)的数据（如收入、房价）时，[中位数](@entry_id:264877)通常是比均值更好的中心趋势度量。[@problem_id:1949199]

#### 性质2：与对称性的联系

中位数与[分布](@entry_id:182848)的对称性有着深刻的几何联系。对于一个[连续随机变量](@entry_id:166541)，如果其[概率密度函数](@entry_id:140610) (PDF) $f(x)$ 关于某一点 $c$ 对称，即对于所有 $h$ 都有 $f(c-h) = f(c+h)$，那么该[分布](@entry_id:182848)的[中位数](@entry_id:264877)就是 $c$。这是因为对称性保证了点 $c$ 两侧的概率质量恰好相等，均为0.5。

例如，一个[随机变量](@entry_id:195330)的PDF在区间 $[0, 6]$上为 $f(x) = \frac{1}{42}(-x^2 + 6x + 1)$。我们可以通过观察发现，函数中的二次项 $-x^2+6x = -(x-3)^2+9$ 是关于 $x=3$ 对称的。因此，整个PDF在 $[0,6]$ 上也是关于 $x=3$ 对称的。据此，我们可以直接断定其中位数为3，而无需进行复杂的积分运算并求解一个三次方程 $m^3 - 9m^2 - 3m + 63 = 0$ [@problem_id:1949162]。

#### 性质3：最小化[绝对偏差](@entry_id:265592)

选择中心趋势的度量也可以从优化的角度来看。我们熟知的**均值**是最小化**均方误差 (Mean Squared Error)** 的值，即均值 $\mu$ 是使得 $E[(X-m)^2]$ 最小化的 $m$。

[中位数](@entry_id:264877)则拥有一个类似的优化性质：**中位数**是最小化**平均[绝对偏差](@entry_id:265592) (Mean Absolute Deviation)** 的值。也就是说，中位数 $M$ 是使得 $g(m) = E[|X-m|]$ 最小化的 $m$。

我们可以通过对 $g(m)$ 求导来证明这一点。使用[莱布尼茨积分法则](@entry_id:145735)，可以证明 $g'(m) = 2F(m) - 1$。令导数为零以寻找最小值，我们得到 $2F(m) - 1 = 0$，即 $F(m) = 0.5$。这正是中位数的定义 [@problem_id:1949182]。

这个性质的直观解释是：均方误差对大的偏差（即 $|X-m|$ 大的值）给予平方级的惩罚，这使得均值被异常值严重影响。而[绝对偏差](@entry_id:265592)对所有偏差给予线性的惩罚，使得中位数能够“抵抗”异常值的拉动，保持其作为中心位置的代表性。

### [分位数](@entry_id:178417)的[抽样分布](@entry_id:269683)

最后，需要强调一个重要概念：从一个总体中抽取的样本所计算出的任何统计量（如样本均值、样本[中位数](@entry_id:264877)）其本身都是一个[随机变量](@entry_id:195330)。它的值会随着我们抽取的样本不同而变化。

想象一个由8名数据科学家组成的总体，他们的薪水是已知的。该总体的中位数是一个确定的值（8个薪水中第4个和第5个的平均值）。如果我们从中随机抽取一个大小为3的样本，并计算这个样本的中位数，那么这个样本中位数的值将取决于具体抽中了哪三位科学家的薪水。

我们可以列举出所有可能的样本（共有 $\binom{8}{3}=56$ 种），计算每种样本的中位数，然后计算这些样本中位数的[期望值](@entry_id:153208)。这个[期望值](@entry_id:153208)并不一定精确等于总体的[中位数](@entry_id:264877) [@problem_id:1949183]。这说明样本[中位数](@entry_id:264877)是总体[中位数](@entry_id:264877)的一个**估计量 (estimator)**，它本身具有一个[抽样分布](@entry_id:269683)，有自己的期望和[方差](@entry_id:200758)。理解这一点是进入推断统计领域，为总体[分位数](@entry_id:178417)构建[置信区间](@entry_id:142297)等更高级主题的基础。