{"hands_on_practices": [{"introduction": "在进行任何生存分析之前，首要步骤是系统地整理原始数据。这项练习将指导您完成这一关键的预处理阶段。通过将散乱的事件和删失时间点，转化为一个有序的汇总表，包含风险集大小 ($Y_j$)、事件数 ($d_j$) 和删失数 ($c_j$)，您将为后续的Kaplan-Meier估计计算奠定坚实的基础 [@problem_id:1961488]。", "problem": "一项临床试验旨在评估新药“Neurostabil”在预防神经系统症状复发方面的功效。十五名受试者参与了这项研究，计划持续时间为12个月。对于每位受试者，数据以`(时间, 状态)`对的形式记录，其中`时间`是指直到症状复发（事件）或受试者被删失为止的月数，而`状态`是一个指示变量（1表示事件，0表示删失）。如果受试者退出研究，或者在他们经历事件之前研究结束，那么该受试者就会被删失。\n\n15名受试者的数据如下：\n(3, 1), (5, 1), (12, 0), (7, 1), (4, 0), (9, 1), (7, 1), (10, 0), (11, 1), (12, 0), (3, 1), (7, 1), (8, 0), (5, 0), (9, 1)\n\n为了准备进行Kaplan-Meier生存分析，要求您总结这些数据。设 $t_1  t_2  \\dots  t_k$ 为唯一的、有序的事件时间序列。对于每个不同的事件时间 $t_j$ （其中 $j=1, \\dots, k$），我们定义以下量：\n- $Y_j$：在时间 $t_j$ 刚开始前的风险人数。如果一个受试者在时间 $t_j$ 之前尚未发生事件或被删失，则认为其处于风险中。\n- $d_j$：在时间 $t_j$ 发生事件的受试者数量。\n- $c_j$：在时间区间 $[t_{j-1}, t_j)$ 内被删失的受试者数量，其中 $t_0 = 0$。\n\n确定所有不同事件时间的三元组序列 $(Y_j, d_j, c_j)$。将您的答案表示为一个矩阵，其中第$j$行包含第$j$个事件时间的三元组。", "solution": "我们总共有15名受试者。首先，我们按时间顺序整理所有观测，并识别出唯一的事件发生时间。\n原始数据：(3, 1), (5, 1), (12, 0), (7, 1), (4, 0), (9, 1), (7, 1), (10, 0), (11, 1), (12, 0), (3, 1), (7, 1), (8, 0), (5, 0), (9, 1)\n\n唯一的事件时间点，按升序排列为：$t_1 = 3, t_2 = 5, t_3 = 7, t_4 = 9, t_5 = 11$。\n\n现在我们为每个事件时间 $t_j$ 计算 $(Y_j, d_j, c_j)$ 三元组。\n- **$t_0=0$**: 初始风险集大小为15。\n\n- **$t_1=3$**:\n  - 区间 $[0, 3)$ 内的删失数 $c_1 = 0$。\n  - 在时间3之前的风险人数 $Y_1 = 15 - 0 = 15$。\n  - 在时间3发生的事件数 $d_1 = 2$（来自数据点 (3, 1) 和 (3, 1)）。\n  - 三元组：$(15, 2, 0)$。\n  - 之后风险集大小变为 $15 - 2 = 13$。\n\n- **$t_2=5$**:\n  - 区间 $[3, 5)$ 内的删失数 $c_2 = 1$（来自数据点 (4, 0)）。\n  - 在时间5之前的风险人数 $Y_2 = 13 - 1 = 12$。\n  - 在时间5发生的事件数 $d_2 = 1$（来自数据点 (5, 1)）。\n  - 三元组：$(12, 1, 1)$。\n  - 之后风险集大小变为 $12 - 1 = 11$。注意：在时间5还有一个删失 (5, 0)，这个删失将用于计算下一个区间的风险集。\n\n- **$t_3=7$**:\n  - 区间 $[5, 7)$ 内的删失数 $c_3 = 1$（来自数据点 (5, 0)）。\n  - 在时间7之前的风险人数 $Y_3 = 11 - 1 = 10$。\n  - 在时间7发生的事件数 $d_3 = 3$（来自数据点 (7, 1), (7, 1) 和 (7, 1)）。\n  - 三元组：$(10, 3, 1)$。\n  - 之后风险集大小变为 $10 - 3 = 7$。\n\n- **$t_4=9$**:\n  - 区间 $[7, 9)$ 内的删失数 $c_4 = 1$（来自数据点 (8, 0)）。\n  - 在时间9之前的风险人数 $Y_4 = 7 - 1 = 6$。\n  - 在时间9发生的事件数 $d_4 = 2$（来自数据点 (9, 1) 和 (9, 1)）。\n  - 三元组：$(6, 2, 1)$。\n  - 之后风险集大小变为 $6 - 2 = 4$。\n\n- **$t_5=11$**:\n  - 区间 $[9, 11)$ 内的删失数 $c_5 = 1$（来自数据点 (10, 0)）。\n  - 在时间11之前的风险人数 $Y_5 = 4 - 1 = 3$。\n  - 在时间11发生的事件数 $d_5 = 1$（来自数据点 (11, 1)）。\n  - 三元组：$(3, 1, 1)$。\n\n将这些三元组按顺序排列成矩阵，得到最终结果。", "answer": "$$\\boxed{\\begin{pmatrix}\n15  2  0 \\\\\n12  1  1 \\\\\n10  3  1 \\\\\n6  2  1 \\\\\n3  1  1\n\\end{pmatrix}}$$", "id": "1961488"}, {"introduction": "掌握了数据整理的方法后，我们便可以开始计算生存函数本身。这项练习将引导您应用Kaplan-Meier乘积极限公式，这是该方法的核心。通过在一个小型数据集上逐步计算特定时间点的生存概率 $\\hat{S}(t)$，您将深入理解风险集如何随时间和事件的发生而动态变化 [@problem_id:1961438]。", "problem": "一个材料科学研究小组正在测试一种新型可生物降解电子元件的耐用性。总共有8个元件接受了加速老化测试。“事件”定义为元件发生故障。由于测试设备的限制，一些测试在元件发生故障前就停止了；这些被认为是“删失”观测值。该研究记录了以下数据，其中每对数据代表（时间（小时），状态），状态“1”表示发生故障，状态“0”表示在该时间观测值被删失：\n\n(15, 1), (25, 1), (40, 1), (30, 0), (50, 1), (35, 0), (55, 0), (20, 1)\n\n计算在该研究中观察到的第二次故障事件发生的确切时间点的生存函数Kaplan-Meier估计值 $\\hat{S}(t)$。将您的答案表示为保留三位有效数字的小数。", "solution": "题目要求计算在特定时间点的生存函数Kaplan-Meier估计值 $\\hat{S}(t)$。Kaplan-Meier估计量是一种非参数统计量，用于根据可能包含删失的生存时间数据来估计生存函数。该估计量的公式是乘积极限公式：\n$$ \\hat{S}(t) = \\prod_{i: t_i \\le t} \\left( 1 - \\frac{d_i}{n_i} \\right) $$\n其中 $t_i$ 是事件（故障）发生的离散时间点，$d_i$ 是在时间 $t_i$ 发生的事件数，而 $n_i$ 是在时间 $t_i$ 之前处于风险中的个体（即仍在观察中且未发生故障的元件）数量。\n\n首先，我们必须按时间顺序整理数据。数据集包含8个元件及其事件/删失时间：(15, 1), (25, 1), (40, 1), (30, 0), (50, 1), (35, 0), (55, 0), (20, 1)。按时间排序后得到：\n\n1.  时间 15：故障（事件）\n2.  时间 20：故障（事件）\n3.  时间 25：故障（事件）\n4.  时间 30：删失\n5.  时间 35：删失\n6.  时间 40：故障（事件）\n7.  时间 50：故障（事件）\n8.  时间 55：删失\n\n题目要求在*第二次观察到的故障事件*发生时计算估计值 $\\hat{S}(t)$。从排序后的列表中，第一次故障事件发生在 $t=15$ 小时，第二次故障事件发生在 $t=20$ 小时。因此，我们需要计算 $\\hat{S}(20)$。\n\n计算过程包括对截至 $t=20$（含）的所有不同事件时间点进行乘积运算。相关的事件时间是 $t_1 = 15$ 和 $t_2 = 20$。\n\n在研究开始时，即 $t=0$ 时，所有8个元件都处于风险中。\n\n**步骤1：计算在 $t_1 = 15$ 时第一次事件的生存因子。**\n- 在 $t=15$ 之前，处于风险中的元件数量为 $n_1 = 8$。\n- 在 $t=15$ 时的故障数量为 $d_1 = 1$。\n- 计算此事件发生后的生存概率估计值。此步骤的因子是 $\\left(1 - \\frac{d_1}{n_1}\\right) = \\left(1 - \\frac{1}{8}\\right) = \\frac{7}{8}$。\n- 对于区间 $[15, 20)$ 中的任何时间 $t$，Kaplan-Meier估计值为 $\\hat{S}(t) = \\frac{7}{8}$。\n\n**步骤2：计算在 $t_2 = 20$ 时第二次事件的生存因子。**\n- 为了找到在 $t=20$ 之前处于风险中的元件数量，我们从上一个事件之前处于风险中的数量（$n_1=8$）开始，并减去在该时间与当前时间之间发生事件或被删失的所有个体。一个元件在 $t=15$ 时发生故障。在 $t=15$ 和 $t=20$ 之间没有元件被删失。\n- 因此，在 $t=20$ 之前，处于风险中的元件数量为 $n_2 = 8 - 1 = 7$。\n- 在 $t=20$ 时的故障数量为 $d_2 = 1$。\n- 此步骤的因子是 $\\left(1 - \\frac{d_2}{n_2}\\right) = \\left(1 - \\frac{1}{7}\\right) = \\frac{6}{7}$。\n\n**步骤3：合并因子以求得 $\\hat{S}(20)$。**\n在 $t=20$ 时的Kaplan-Meier估计值是在此时间或之前发生的所有事件的生存因子的乘积。\n$$ \\hat{S}(20) = \\prod_{i: t_i \\le 20} \\left( 1 - \\frac{d_i}{n_i} \\right) = \\left(1 - \\frac{d_1}{n_1}\\right) \\times \\left(1 - \\frac{d_2}{n_2}\\right) $$\n$$ \\hat{S}(20) = \\left(\\frac{7}{8}\\right) \\times \\left(\\frac{6}{7}\\right) $$\n'7' 项相互抵消：\n$$ \\hat{S}(20) = \\frac{6}{8} = \\frac{3}{4} $$\n换算成小数，即为 $0.75$。\n\n题目要求答案保留三位有效数字。为了用三位有效数字表示 $0.75$，我们在后面加一个零。\n\n因此，Kaplan-Meier估计值为 $0.750$。", "answer": "$$\\boxed{0.750}$$", "id": "1961438"}, {"introduction": "一次完整的生存分析不仅在于计算特定时间点的概率，还在于理解整个生存曲线的走势，尤其是其长期行为。这个最后的练习探讨了一种关键情景：当研究中的最后一个观测是事件时，生存函数会发生什么。通过分析一个完整的数据集来确定最终的生存概率，您将学会辨别研究以事件结束与以删失结束对 $\\lim_{t \\to \\infty} \\hat{S}(t)$ 的根本影响 [@problem_id:1961480]。", "problem": "在一个材料科学实验室中，进行了一项实验来研究一种新型复合材料的疲劳寿命。将该材料的十五个相同样本进行连续的高频应力测试。记录每个样本的断裂时间。由于实验限制，一些测试在样本断裂前被终止；这些被视为删失观测。\n\n数据集包含 15 个观测值，记录为 (时间, 状态) 对，其中时间以小时为单位，状态是一个二元指示符：1 表示断裂事件，0 表示删失观测。收集到的数据如下：\n\n(50, 1), (65, 0), (70, 1), (82, 0), (90, 1), (95, 0), (105, 0), (110, 1), (112, 1), (118, 0), (120, 1), (125, 0), (130, 1), (140, 0), (150, 1).\n\n你的任务是计算该材料生存函数 $\\hat{S}(t)$ 的 Kaplan-Meier 估计。根据你的计算，确定当时间趋于无穷大时生存函数的极限值。\n\n请以单个数值的形式提供 $\\lim_{t \\to \\infty} \\hat{S}(t)$ 的值。", "solution": "Kaplan-Meier 估计量定义为\n$$\n\\hat{S}(t)=\\prod_{t_{i}\\leq t}\\left(1-\\frac{d_{i}}{n_{i}}\\right),\n$$\n其中 $t_{i}$ 是排序后的不同事件时间，$d_{i}$ 是在 $t_{i}$ 时刻的失败数量，$n_{i}$ 是在 $t_{i}$ 时刻之前的风险集中的数量。\n\n将数据排序并区分事件时间和删失时间。事件时间为 $50,70,90,110,112,120,130,150$（八个事件）。删失时间为 $65,82,95,105,118,125,140$（七个删失）。开始时有 $n=15$ 个个体处于风险中。\n\n按时间顺序追踪风险集和事件：\n- 在 $t=50$ (事件): $n_{1}=15$, $d_{1}=1$; 之后剩余的风险数量 = $14$。\n- $t=65$ (删失): 之后剩余的风险数量 = $13$。\n- 在 $t=70$ (事件): $n_{2}=13$, $d_{2}=1$; 之后剩余的风险数量 = $12$。\n- $t=82$ (删失): 之后剩余的风险数量 = $11$。\n- 在 $t=90$ (事件): $n_{3}=11$, $d_{3}=1$; 之后剩余的风险数量 = $10$。\n- $t=95$ (删失): 之后剩余的风险数量 = $9$。\n- $t=105$ (删失): 之后剩余的风险数量 = $8$。\n- 在 $t=110$ (事件): $n_{4}=8$, $d_{4}=1$; 之后剩余的风险数量 = $7$。\n- 在 $t=112$ (事件): $n_{5}=7$, $d_{5}=1$; 之后剩余的风险数量 = $6$。\n- $t=118$ (删失): 之后剩余的风险数量 = $5$。\n- 在 $t=120$ (事件): $n_{6}=5$, $d_{6}=1$; 之后剩余的风险数量 = $4$。\n- $t=125$ (删失): 之后剩余的风险数量 = $3$。\n- 在 $t=130$ (事件): $n_{7}=3$, $d_{7}=1$; 之后剩余的风险数量 = $2$。\n- $t=140$ (删失): 之后剩余的风险数量 = $1$。\n- 在 $t=150$ (事件): $n_{8}=1$, $d_{8}=1$; 之后剩余的风险数量 = $0$。\n\n因此，对于 $t\\geq 150$，乘积包含以下因子：\n$$\n\\left(1-\\frac{1}{15}\\right)\\left(1-\\frac{1}{13}\\right)\\left(1-\\frac{1}{11}\\right)\\left(1-\\frac{1}{8}\\right)\\left(1-\\frac{1}{7}\\right)\\left(1-\\frac{1}{5}\\right)\\left(1-\\frac{1}{3}\\right)\\left(1-\\frac{1}{1}\\right).\n$$\n最后一项等于零，因为在 $t=150$ 时，风险集中只有一个个体，并且该个体发生了失效，所以 $1-1/1=0$。因此，对于所有 $t\\geq 150$，\n$$\n\\hat{S}(t)=0,\n$$\n所以\n$$\n\\lim_{t\\to\\infty}\\hat{S}(t)=0.\n$$", "answer": "$$\\boxed{0}$$", "id": "1961480"}]}