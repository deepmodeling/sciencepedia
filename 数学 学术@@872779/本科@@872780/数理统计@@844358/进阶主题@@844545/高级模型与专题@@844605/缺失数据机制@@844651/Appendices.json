{"hands_on_practices": [{"introduction": "理解缺失数据机制是进行正确分析的第一步。本练习提供了一个经典的随机缺失（MAR）情景。通过分析野生动物相机案例 [@problem_id:1936096]，你将学会识别数据缺失如何系统性地与一个观测变量相关联，这是它与完全随机缺失（MCAR）的关键区别。", "problem": "一个野生生物学家团队正在一个偏远、寒冷的环境中研究一个稀有物种的活动模式。他们部署了一个由运动激活的相机陷阱组成的网络。该系统设计为每小时记录两个变量：`animal_sighting`，一个二元变量，如果探测到目标物种则为1，否则为0；以及 `ambient_temperature`，以摄氏度为单位的温度。\n\n相机陷阱由电池供电，其性能在寒冷天气中会显著下降。数据采集系统有两个组成部分：一个坚固的、独立供电的传感器，它每小时都会无故障地记录 `ambient_temperature`；以及相机系统本身，它记录 `animal_sighting`。\n\n在分析收集到的数据时，生物学家们观察到，在许多小时内，`ambient_temperature` 被记录下来，但 `animal_sighting` 的值却缺失了。他们确定，`animal_sighting` 的这些缺失数据点之所以出现，是因为相机系统因电池在低温下消耗过快而暂时关闭。相机关闭并无法记录 `animal_sighting` 的概率与 `ambient_temperature` 的值直接相关，但并不取决于当时是否有动物在相机前。\n\n鉴于此情景，请确定 `animal_sighting` 变量的缺失数据机制的正确分类。\n\n标准分类如下：\n- 完全随机缺失 (MCAR)：某个值缺失的概率与任何其他测量变量无关，也与该变量本身的值无关。\n- 随机缺失 (MAR)：某个值缺失的概率与数据集中的某个其他测量变量有关，但与该变量本身的未观测值无关。\n- 非随机缺失 (MNAR)：某个值缺失的概率与该变量本身的未观测值有关。\n\n以下哪项最能描述这种缺失数据机制？\n\nA. 非随机缺失 (MNAR)\n\nB. 结构性赤字缺失\n\nC. 完全随机缺失 (MCAR)\n\nD. 随机缺失 (MAR)", "solution": "定义变量如下：令 $Y$ 表示每小时的二元结果 `animal_sighting`，令 $X$ 表示完全观测到的每小时 `ambient_temperature`，令 $R$ 为 $Y$ 的缺失指示符，其中当 $Y$ 被观测到时 $R=1$，当 $Y$ 缺失时 $R=0$。\n\n根据情景描述，产生缺失的机制是相机系统因低温而关闭。这意味着缺失的概率取决于 $X$ 而不取决于 $Y$。形式上，给定的信息意味着\n$$\n\\Pr(R=0 \\mid Y, X) = \\Pr(R=0 \\mid X),\n$$\n其中 $X$ 在所有小时都被完全观测到。\n\n将此与标准定义进行比较：\n1. MCAR 要求\n$$\n\\Pr(R=0 \\mid Y, X) = \\Pr(R=0),\n$$\n这在此处不成立，因为相机关闭的概率取决于 $X$（温度），所以它不是一个常数。\n\n2. MAR 要求\n$$\n\\Pr(R=0 \\mid Y, X) = \\Pr(R=0 \\mid X),\n$$\n这恰好被所描述的机制满足，因为缺失仅仅是 $X$ 的函数，并且 $X$ 是完全观测到的。\n\n3. MNAR 会要求即使在对观测变量进行条件化之后，缺失也依赖于 $Y$ 的未观测值，即 $\\Pr(R=0 \\mid Y, X)$ 在对 $X$ 进行条件化后仍然依赖于 $Y$。问题陈述中说明缺失不依赖于是否有动物出现，因此情况并非如此。\n\n因此，正确的分类是随机缺失 (MAR)。标记为“结构性赤字缺失”的选项不是标准的 Rubin 分类之一，并且在此处不适用，因为缺失是通过低温随机产生的，而不是由设计强制的结构性数值缺失引起的。", "answer": "$$\\boxed{D}$$", "id": "1936096"}, {"introduction": "在实践中，同一个项目中的数据缺失可能由多种不同原因导致。这个问题将挑战你扮演数据科学家的角色，诊断一个健康应用中的问题 [@problem_id:1936102]。通过对三个不同的真实世界情景进行分类，你将练习区分MCAR、MAR和MNAR，从而磨练任何数据分析师都应具备的关键诊断技能。", "problem": "一个数据科学家团队正在分析一款新健康应用的数据，该应用旨在监测夜间睡眠质量。我们称之为 `SleepScore` 的主要关注变量是一个从0（非常差）到100（极好）的连续值。然而，他们注意到在相当多的夜晚，`SleepScore` 值是缺失的。他们的任务是根据用户报告和内部日志中发现的三种不同情况，识别可能的数据缺失机制。\n\n三种主要的数据缺失机制是：\n-   **完全随机缺失 (MCAR):** 一个值缺失的概率与任何观测变量或未观测变量都无关。\n-   **随机缺失 (MAR):** 一个值缺失的概率仅依赖于其他观测变量，而不依赖于该变量本身的未观测值。\n-   **非随机缺失 (MNAR):** 一个值缺失的概率依赖于该变量本身的未观测值。\n\n以下是该团队正在调查的三种情景。\n\n**情景 1:** 在一周的时间里，一个软件错误导致，如果手机在睡眠结束时的电量（该电量被记录）低于20%，应用程序就无法将其数据传输到中央服务器。在分析了完整数据后，团队发现手机的夜间结束时电量与用户的实际 `SleepScore` 之间没有相关性。\n\n**情景 2:** 该应用程序使用一个灵敏的麦克风来检测鼾声和呼吸模式。在一个罕见的“数据过载”错误中，如果应用程序整夜检测到极其响亮和持续的鼾声，它会崩溃并且无法保存任何 `SleepScore` 数据。鼾声的强度是用于计算 `SleepScore` 的一个主要组成部分。\n\n**情景 3:** 由于服务器硬件故障影响了硬盘的任意扇区，一个随机的用户记录样本被从数据库中永久删除。\n\n识别每种情景的正确数据缺失机制。\n\nA. 情景 1: MAR, 情景 2: MNAR, 情景 3: MCAR\n\nB. 情景 1: MCAR, 情景 2: MNAR, 情景 3: MAR\n\nC. 情景 1: MAR, 情景 2: MCAR, 情景 3: MNAR\n\nD. 情景 1: MNAR, 情景 2: MAR, 情景 3: MCAR\n\nE. 情景 1: MCAR, 情景 2: MAR, 情景 3: MNAR", "solution": "设 $Y$ 表示我们感兴趣的未观测真实变量 ($\\text{SleepScore}$)，设 $X$ 表示观测到的协变量（例如，手机电量），设 $R$ 为缺失指示符，当 $Y$ 被观测到时 $R=1$，当 $Y$ 缺失时 $R=0$。标准定义如下：\n$$\n\\text{MCAR: } P(R=0 \\mid Y,X)=P(R=0), \\quad\n\\text{MAR: } P(R=0 \\mid Y,X)=P(R=0 \\mid X), \\quad\n\\text{MNAR: } P(R=0 \\mid Y,X) \\text{ depends on } Y \\text{ given } X.\n$$\n\n情景 1: 当观测到的电量 $B$ 低于一个阈值时，传输失败。因此，缺失性取决于一个观测变量 $B$，而不是 $Y$，所以\n$$\nP(R=0 \\mid Y,B)=P(R=0 \\mid B),\n$$\n这是MAR。注意到 $B$ 与 $Y$ 不相关并不会将该机制转换为 MCAR，因为 MCAR 要求 $P(R=0 \\mid Y,X)$ 是一个常数，而在这里它随 $B$ 变化。\n\n情景 2: 应用程序在检测到极其响亮和持续的鼾声时崩溃，而鼾声是计算 $Y$ 的一个主要组成部分。因此，即使在以任何观测变量 $X$ 为条件后，缺失的概率仍然取决于 $Y$ 的（未观测）值。形式上，\n$$\nP(R=0 \\mid Y,X) \\text{ varies with } Y,\n$$\n所以该机制是 MNAR。\n\n情景 3: 由于任意的硬件扇区故障，一个随机的记录样本被删除。这意味着删除事件独立于 $Y$ 和 $X$：\n$$\nP(R=0 \\mid Y,X)=P(R=0),\n$$\n这是 MCAR。\n\n因此，正确的识别是：情景 1 是 MAR，情景 2 是 MNAR，情景 3 是 MCAR，这对应于选项 A。", "answer": "$$\\boxed{A}$$", "id": "1936102"}, {"introduction": "随机缺失（MAR）和非随机缺失（MNAR）之间的区别可能非常微妙，特别是当未观测到的（潜在）因素同时影响结果变量和缺失过程时。这个高级问题超越了简单的场景描述，进入了形式化统计模型的领域 [@problem_id:1936118]。你将需要确定在一个包含潜在患者特征的临床试验中，定义MAR边界的精确数学条件，从而更深入地洞察缺失数据机制的理论基础。", "problem": "在一项旨在测试一种新药的临床研究中，研究人员遇到了患者中途退出的情况，这导致了结果数据的缺失。他们提出了一个统计模型来理解这一现象。对于每位患者，该模型包括：\n- 一个结果变量 $Y$，代表患者对药物的反应。\n- 一个二元协变量 $X \\in \\{0, 1\\}$，表示患者属于两个诊所中的哪一个。\n- 一个未观测到的二元潜在类别 $Z \\in \\{0, 1\\}$，代表一种内在的患者类型（例如，对药物反应良好或不良的遗传倾向）。\n- 一个响应指示符 $R \\in \\{0, 1\\}$，其中如果结果 $Y$被观测到，则 $R=1$；如果患者中途退出且 $Y$缺失，则 $R=0$。\n\n该模型由以下一组假设定义：\n1.  潜在类别 $Z$ 服从伯努利分布，$P(Z=1) = \\pi_z$，其中 $0  \\pi_z  1$。\n2.  诊所协变量 $X$ 服从伯努利分布，$P(X=1) = \\pi_x$，其中 $0  \\pi_x  1$。变量 $X$ 和 $Z$ 在统计上是独立的。\n3.  患者的结果 $Y$，在给定其潜在类别 $Z=z$ 的条件下，服从均值为 $\\mu_z$ 且恒定方差为 $\\sigma^2 > 0$ 的正态分布。假设结果 $Y$ 在给定潜在类别 $Z$ 的条件下，与诊所 $X$ 条件独立。\n4.  观测到结果 $Y$ 的概率（即 $R=1$）通过逻辑斯蒂回归模型同时依赖于诊所 $X$ 和潜在类别 $Z$：\n    $$ \\ln\\left(\\frac{P(R=1 | X=x, Z=z)}{1 - P(R=1 | X=x, Z=z)}\\right) = \\beta_0 + \\beta_x x + \\beta_z z $$\n    其中 $\\beta_0, \\beta_x, \\beta_z$ 是有限的实值参数。响应 $R$ 在给定 $X$ 和 $Z$ 的条件下，与结果 $Y$ 条件独立。\n\n在缺失数据分析中，一个关键概念是数据是否为随机缺失（Missing At Random, MAR）。如果一个值缺失的概率仅依赖于已观测到的信息，则MAR假设成立。在本问题的背景下，缺失数据机制是MAR当且仅当响应的条件概率 $P(R=1 | Y, X)$ 不依赖于（可能缺失的）结果 $Y$ 的值。\n\n关于模型参数，以下哪个条件是缺失数据机制为随机缺失（MAR）的充分必要条件？\n\nA. $\\beta_x = 0$\n\nB. $\\beta_z = 0$\n\nC. $\\mu_0 = \\mu_1$\n\nD. $\\beta_x = 0$ 或 $\\mu_0 = \\mu_1$\n\nE. $\\beta_z = 0$ 或 $\\mu_0 = \\mu_1$\n\nF. $\\beta_x = 0$ 且 $\\mu_0 = \\mu_1$\n\nG. $\\beta_z = 0$ 且 $\\mu_0 = \\mu_1$\n\nH. 只要 $\\beta_z \\neq 0$，该机制就始终为非随机缺失（Missing Not at Random, MNAR）。", "solution": "我们需要满足随机缺失（MAR）条件：$P(R=1 \\mid Y=y, X=x)$ 对于任何 $x$ 都不能依赖于 $y$。\n\n根据关于潜在类别 $Z$ 的全概率公式以及所述的条件独立性，\n$$\nP(R=1 \\mid Y=y, X=x)\n=\\sum_{z \\in \\{0,1\\}} P(R=1 \\mid X=x, Z=z)\\,P(Z=z \\mid Y=y, X=x).\n$$\n从模型可知，$R \\perp Y \\mid (X,Z)$ 且 $P(R=1 \\mid X=x, Z=z)=\\{1+\\exp[-(\\beta_{0}+\\beta_{x}x+\\beta_{z}z)]\\}^{-1}$。此外，利用 $X \\perp Z$ 和 $Y \\perp X \\mid Z$，我们有\n$$\nP(Z=z \\mid Y=y, X=x)=P(Z=z \\mid Y=y).\n$$\n定义 $s(t)=\\{1+\\exp(-t)\\}^{-1}$，并令 $p_{0}(x)=s(\\beta_{0}+\\beta_{x}x)$ 和 $p_{1}(x)=s(\\beta_{0}+\\beta_{x}x+\\beta_{z})$。那么\n$$\nP(R=1 \\mid Y=y, X=x)=p_{0}(x)\\,[1-P(Z=1 \\mid Y=y)] + p_{1}(x)\\,P(Z=1 \\mid Y=y)\n= p_{0}(x) + \\{p_{1}(x)-p_{0}(x)\\} P(Z=1 \\mid Y=y).\n$$\n因此，$P(R=1 \\mid Y=y, X=x)$ 不依赖于 $y$ 当且仅当对所有 $x$ 有 $p_{1}(x)=p_{0}(x)$，或者 $P(Z=1 \\mid Y=y)$ 对于 $y$ 是一个常数。\n\n第一种情况（响应不依赖于 $Z$）：对所有 $x$ 都有 $p_{1}(x)=p_{0}(x)$ 成立，当且仅当 $\\beta_{z}=0$，因为 $s(\\cdot)$ 是严格单调递增的。\n\n第二种情况（结果不包含关于 $Z$ 的信息）：$P(Z=1 \\mid Y=y)$ 对于 $y$ 是一个常数，当且仅当 $Y \\perp Z$。在 $Y \\mid Z=z \\sim \\mathcal{N}(\\mu_{z},\\sigma^{2})$ 的模型下，这发生当且仅当 $\\mu_{0}=\\mu_{1}$。要看到在其他情况下 $P(Z=1 \\mid Y=y)$ 依赖于 $y$，我们可以计算后验对数优势比：\n$$\n\\ln\\frac{P(Z=1 \\mid Y=y)}{P(Z=0 \\mid Y=y)}\n=\\ln\\frac{\\pi_{z}}{1-\\pi_{z}} + \\ln f_{1}(y) - \\ln f_{0}(y),\n$$\n其中 $f_{z}(y)$ 是 $\\mathcal{N}(\\mu_{z},\\sigma^{2})$ 的密度函数。使用\n$$\n\\ln f_{z}(y) = -\\frac{1}{2}\\ln(2\\pi\\sigma^{2}) - \\frac{(y-\\mu_{z})^{2}}{2\\sigma^{2}},\n$$\n我们得到\n$$\n\\ln\\frac{P(Z=1 \\mid Y=y)}{P(Z=0 \\mid Y=y)} = \\ln\\frac{\\pi_{z}}{1-\\pi_{z}} + \\frac{-(y-\\mu_{1})^{2} + (y-\\mu_{0})^{2}}{2\\sigma^{2}}\n= \\ln\\frac{\\pi_{z}}{1-\\pi_{z}} + \\frac{\\mu_{1}-\\mu_{0}}{\\sigma^{2}}\\,y + \\text{const},\n$$\n其关于 $y$ 的斜率为 $(\\mu_{1}-\\mu_{0})/\\sigma^{2}$。该斜率为零当且仅当 $\\mu_{1}=\\mu_{0}$，此时 $P(Z=1 \\mid Y=y)$ 是常数；否则它会随 $y$ 变化。\n\n因此，$P(R=1 \\mid Y=y, X=x)$ 不依赖于 $y$ 当且仅当 $\\beta_{z}=0$ 或 $\\mu_{0}=\\mu_{1}$。对 $\\beta_{x}$ 无需任何限制，因为 $X$ 是已观测的，其效应不会在 $P(R=1 \\mid Y=y, X=x)$ 中引入对 $y$ 的依赖性。\n\n因此，在这些选项中，充分必要条件是 $\\beta_{z}=0$ 或 $\\mu_{0}=\\mu_{1}$。", "answer": "$$\\boxed{E}$$", "id": "1936118"}]}