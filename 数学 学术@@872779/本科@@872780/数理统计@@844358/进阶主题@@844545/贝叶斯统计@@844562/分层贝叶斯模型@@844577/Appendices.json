{"hands_on_practices": [{"introduction": "层级贝叶斯模型的核心思想是“借力”——即利用跨组信息来改进对单个组的推断。这个练习 [@problem_id:1920799] 是一个绝佳的起点，它通过一个质量控制的场景，展示了如何将代表总体（工厂级别）性能的先验知识与来自特定单元（新生产线）的数据相结合。通过计算后验估计，您将亲身体验贝叶斯更新的基本机制，这是构建更复杂层级模型的基础。", "problem": "一家名为“Quantum Circuits Inc.”的科技公司生产高度敏感的量子处理器。质量控制过程涉及多条相同的生产线。根据所有生产线的大量历史数据，该公司对任何给定生产线的缺陷率 $p$ 建立了一个先验信念。该信念由参数为 $\\alpha = 3$ 和 $\\beta = 147$ 的贝塔分布（Beta distribution）建模。\n\n一条新的生产线“Line Gamma”投入使用。为了评估其性能，生产并检验了一批 $n = 850$ 个处理器的测试批次。在此批次中，发现了 $k = 22$ 个有缺陷的处理器。\n\n假设一批次中有缺陷的处理器的数量遵循二项分布（Binomial distribution），计算Gamma生产线（Line Gamma）缺陷率 $p_{\\gamma}$ 的更新贝叶斯点估计。使用后验分布的均值作为您的点估计。\n\n将您的答案以单个数值的形式给出，四舍五入到三位有效数字。", "solution": "我们使用贝塔先验（Beta prior）和二项似然（Binomial likelihood）来对缺陷率 $p$ 进行建模。先验为 $p \\sim \\mathrm{Beta}(\\alpha,\\beta)$，其中 $\\alpha=3$ 且 $\\beta=147$。数据包括 $n=850$ 个样本中的 $k=22$ 个次品，建模为 $k \\mid p,n \\sim \\mathrm{Binomial}(n,p)$。\n\n根据贝塔-二项共轭性（Beta-Binomial conjugacy），$p$ 的后验分布为\n$$\np \\mid k,n \\sim \\mathrm{Beta}(\\alpha+k,\\ \\beta+n-k).\n$$\n代入给定值，\n$$\n\\alpha_{\\text{post}}=\\alpha+k=3+22=25,\\qquad \\beta_{\\text{post}}=\\beta+n-k=147+850-22=975.\n$$\n后验均值，用作贝叶斯点估计，为\n$$\n\\mathbb{E}[p \\mid k,n]=\\frac{\\alpha_{\\text{post}}}{\\alpha_{\\text{post}}+\\beta_{\\text{post}}}\n=\\frac{\\alpha+k}{\\alpha+\\beta+n}\n=\\frac{3+22}{3+147+850}\n=\\frac{25}{1000}\n=0.025.\n$$\n四舍五入到三位有效数字，结果是 $0.0250$。", "answer": "$$\\boxed{0.0250}$$", "id": "1920799"}, {"introduction": "在许多实际问题中，我们不仅关心总体趋势，也需要对每个具体分组的特性进行精确估计。此练习 [@problem_id:1920769] 构建了一个真实的层级模型，其中多个实验室的测量方差被假定源于一个共同的总体分布。您的任务是为一个特定实验室的数据计算其测量方差的后验期望值，这将清晰地揭示后验估计是如何在总体先验和该组特定数据之间取得平衡的。", "problem": "一个研究联盟正在协调几个大学实验室的实验，以测量一种新发现粒子的基本物理常数——衰变率 $\\lambda$。通过国家实验室的一项高精度实验，已知该常数的真实值为 $\\lambda_{\\text{true}} = 5.20$ s$^{-1}$。来自大学实验室的测量数据会受到随机误差的影响。\n\n为分析这些数据，提出了一个分层贝叶斯模型。来自任何特定实验室的测量值 $x_i$ 被建模为从正态分布 $N(\\lambda_{\\text{true}}, \\sigma^2)$ 中抽取的样本，其中特定于实验室的方差 $\\sigma^2$ 是未知的。根据这类实验的先验经验，不同实验室的方差 $\\sigma^2$ 本身被建模为从一个共同的逆伽马分布 $IG(\\alpha, \\beta)$ 中抽取的随机变量。$IG(a, b)$ 分布的概率密度函数 (PDF) 由 $p(y; a, b) = \\frac{b^a}{\\Gamma(a)} y^{-(a+1)} \\exp(-\\frac{b}{y})$ 给出，其中 $y > 0$。对于该研究联盟，超参数已确定为 $\\alpha = 3$ 和 $\\beta = 0.500$ s$^{-2}$。\n\n一个特定的实验室‘Lab K’进行了一项实验，并获得了以下五个衰变率的测量值（$n_K=5$，单位为 s$^{-1}$）：\n$$ \\{5.35, 4.90, 5.70, 5.05, 5.50\\} $$\n\n给定Lab K的实验数据，计算其测量方差 $\\sigma_K^2$ 的后验期望值。答案以 s$^{-2}$ 为单位，并四舍五入至三位有效数字。", "solution": "我们将来自Lab K的五个测量值 $x_{1:n}$ 建模为 $x_{i} \\mid \\sigma^{2} \\sim N(\\lambda_{\\text{true}}, \\sigma^{2})$，其中 $\\lambda_{\\text{true}}$ 已知。其先验分布为 $\\sigma^{2} \\sim IG(\\alpha, \\beta)$，密度函数为 $p(y;\\alpha,\\beta)=\\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)}y^{-(\\alpha+1)}\\exp\\!\\left(-\\frac{\\beta}{y}\\right)$，其中 $y>0$。对于均值已知的 $n$ 个观测值，似然函数正比于\n$$\nL(\\sigma^{2}\\mid x_{1:n}) \\propto (\\sigma^{2})^{-n/2}\\exp\\!\\left(-\\frac{S}{2\\sigma^{2}}\\right),\n$$\n其中 $S=\\sum_{i=1}^{n}(x_{i}-\\lambda_{\\text{true}})^{2}$。与先验分布结合，得到共轭后验分布\n$$\n\\sigma^{2}\\mid x_{1:n} \\sim IG\\!\\left(\\alpha+\\frac{n}{2},\\,\\beta+\\frac{S}{2}\\right).\n$$\n在此参数化下，对于 $a>1$ 的 $IG(a,b)$ 分布，其均值存在且等于 $\\mathbb{E}[Y]=\\frac{b}{a-1}$。因此，\n$$\n\\mathbb{E}[\\sigma^{2}\\mid x_{1:n}] \\;=\\; \\frac{\\beta+\\frac{S}{2}}{\\alpha+\\frac{n}{2}-1}.\n$$\n\n对于Lab K，$\\lambda_{\\text{true}}=5.20$，$x_{1:5}=\\{5.35,\\,4.90,\\,5.70,\\,5.05,\\,5.50\\}$，$\\alpha=3$ 且 $\\beta=0.500$。计算相对于 $\\lambda_{\\text{true}}$ 的残差：\n$$\n\\{0.15,\\,-0.30,\\,0.50,\\,-0.15,\\,0.30\\},\n$$\n所以\n$$\nS=\\sum (x_{i}-\\lambda_{\\text{true}})^{2}=0.15^{2}+(-0.30)^{2}+0.50^{2}+(-0.15)^{2}+0.30^{2}=0.475.\n$$\n因此，后验参数为\n$$\n\\alpha^{\\prime}=\\alpha+\\frac{n}{2}=3+\\frac{5}{2}=5.5,\\qquad\n\\beta^{\\prime}=\\beta+\\frac{S}{2}=0.500+\\frac{0.475}{2}=0.7375.\n$$\n$\\sigma^{2}$ 的后验均值为\n$$\n\\mathbb{E}[\\sigma^{2}\\mid x_{1:5}]=\\frac{\\beta^{\\prime}}{\\alpha^{\\prime}-1}=\\frac{0.7375}{5.5-1}=\\frac{0.7375}{4.5}=\\frac{59}{360}\\approx 0.163888\\ldots\n$$\n四舍五入至三位有效数字，结果为 $0.164$，单位为 s$^{-2}$。", "answer": "$$\\boxed{0.164}$$", "id": "1920769"}, {"introduction": "层级模型最强大的应用之一是“收缩估计”，即当单个组的数据稀疏或噪声较大时，模型会将其估计值“收缩”到更可靠的总体平均值。这个练习 [@problem_id:1920805] 采用经验贝叶斯方法，您将首先从一组患者数据中估计出总体疗效的分布参数，然后利用这些信息为一个新患者的真实疗效提供一个更稳健的估计。这个过程完美地诠释了层级模型如何通过在各组之间“借力”来提高预测的准确性。", "problem": "在一项针对一种新癌症疗法的临床试验中，研究人员为每位患者的治疗反应建模。该反应由患者特定的真实对数增长率来表征，对于患者 $i$ 表示为 $k_i$，其中负值表示肿瘤缩小。真实增长率 $k_i$ 无法直接观测。取而代之的是，为每位患者测量一个带噪声的对数增长率 $d_i$。\n\n研究人员采用分层贝叶斯模型来整合来自不同患者的信息。该模型的结构如下：\n\n1.  **观测模型**：对于患者 $i$，测得的对数增长率 $d_i$ 假定服从以真实增长率 $k_i$ 为中心、方差为已知的常数 $s^2$ 的正态分布，该方差代表测量误差。\n    $$d_i | k_i, s^2 \\sim \\mathcal{N}(k_i, s^2)$$\n\n2.  **群体模型**：患者特定的真实增长率 $k_i$ 假定是从一个共同的群体分布中抽取的，该分布是均值为未知 $\\mu$、方差为未知 $\\tau^2$ 的正态分布。该分布代表了疗法的总体疗效和患者间的变异性。\n    $$k_i | \\mu, \\tau^2 \\sim \\mathcal{N}(\\mu, \\tau^2)$$\n\n一项初步研究提供了来自 $N$ 位患者的数据，得到了测量的对数增长率 $\\{d_1, d_2, \\ldots, d_N\\}$。群体超参数 $\\mu$ 和 $\\tau^2$ 使用矩估计法从这些数据中估计，得到“代入式”估计量 $\\hat{\\mu}$ 和 $\\hat{\\tau}^2$。这些估计量的计算方式如下：\n-   $\\hat{\\mu} = \\bar{d}$，其中 $\\bar{d} = \\frac{1}{N} \\sum_{i=1}^{N} d_i$。\n-   $\\hat{\\tau}^2 = S_d^2 - s^2$，其中 $S_d^2 = \\frac{1}{N-1} \\sum_{i=1}^{N} (d_i - \\bar{d})^2$ 是测量值的样本方差。您可以假设研究数据满足 $S_d^2 > s^2$，从而确保 $\\hat{\\tau}^2 > 0$。\n\n现在，一位新患者（索引为 $N+1$）进入试验，其测量的对数增长率观测值为 $d_{N+1}$。使用先前估计的超参数，我们希望找到这位新患者的*真实*对数增长率 $k_{N+1}$ 的最佳估计。\n\n您的任务是推导 $k_{N+1}$ 的经验贝叶斯估计的表达式，该估计定义为其后验均值 $E[k_{N+1} | d_{N+1}, \\hat{\\mu}, \\hat{\\tau}^2]$。请用 $\\bar{d}$、$S_d^2$、$s^2$ 和 $d_{N+1}$ 来表示您的最终答案。", "solution": "我们从分层模型开始：对于一位新患者，\n$$d_{N+1} \\mid k_{N+1}, s^{2} \\sim \\mathcal{N}(k_{N+1}, s^{2}), \\quad k_{N+1} \\mid \\mu, \\tau^{2} \\sim \\mathcal{N}(\\mu, \\tau^{2}).$$\n使用贝叶斯定理和共轭正态-正态对，在给定 $\\mu$、$\\tau^2$、$s^2$ 和 $d_{N+1}$ 的条件下，$k_{N+1}$ 的后验分布是正态分布，其精度等于先验精度和似然精度之和。对指数部分进行配方，\n$$\\ln p(k_{N+1} \\mid d_{N+1}, \\mu, \\tau^{2}, s^{2})=\\text{const}-\\frac{1}{2s^{2}}(d_{N+1}-k_{N+1})^{2}-\\frac{1}{2\\tau^{2}}(k_{N+1}-\\mu)^{2},$$\n这是一个关于 $k_{N+1}$ 的二次函数，$k_{N+1}^{2}$ 的系数为 $\\frac{1}{s^{2}}+\\frac{1}{\\tau^{2}}$，一次项系数为 $\\frac{d_{N+1}}{s^{2}}+\\frac{\\mu}{\\tau^{2}}$。因此，后验均值为\n$$E[k_{N+1} \\mid d_{N+1}, \\mu, \\tau^{2}]=\\frac{\\frac{d_{N+1}}{s^{2}}+\\frac{\\mu}{\\tau^{2}}}{\\frac{1}{s^{2}}+\\frac{1}{\\tau^{2}}}=\\frac{\\tau^{2} d_{N+1}+s^{2}\\mu}{\\tau^{2}+s^{2}}.$$\n在经验贝叶斯方法中，我们代入矩估计量 $\\hat{\\mu}=\\bar{d}$ 和 $\\hat{\\tau}^{2}=S_{d}^{2}-s^{2}$，得到\n$$E[k_{N+1} \\mid d_{N+1}, \\hat{\\mu}, \\hat{\\tau}^{2}]=\\frac{(S_{d}^{2}-s^{2})\\, d_{N+1}+s^{2}\\,\\bar{d}}{(S_{d}^{2}-s^{2})+s^{2}}=\\frac{(S_{d}^{2}-s^{2})\\, d_{N+1}+s^{2}\\,\\bar{d}}{S_{d}^{2}}.$$\n等价地，这可以写成一个收缩估计量\n$$\\left(1-\\frac{s^{2}}{S_{d}^{2}}\\right)d_{N+1}+\\frac{s^{2}}{S_{d}^{2}}\\bar{d},$$\n这明确地显示了将 $d_{N+1}$ 向总体均值 $\\bar{d}$ 收缩的数据驱动权重 $1-\\frac{s^{2}}{S_{d}^{2}}$。", "answer": "$$\\boxed{\\frac{(S_{d}^{2}-s^{2})\\, d_{N+1}+s^{2}\\,\\bar{d}}{S_{d}^{2}}}$$", "id": "1920805"}]}