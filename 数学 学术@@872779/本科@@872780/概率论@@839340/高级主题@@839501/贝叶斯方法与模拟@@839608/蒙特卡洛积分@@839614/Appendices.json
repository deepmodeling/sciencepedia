{"hands_on_practices": [{"introduction": "蒙特卡洛方法的核心思想是通过随机抽样来近似计算复杂的数值问题。这项实践练习是该思想的一个经典入门示例，您将通过处理一组预先生成的模拟数据点来估算一个事件的概率。通过亲手检查每个样本是否满足特定条件（即“命中”或“未命中”），您将直观地理解如何用样本频率来近似理论概率 [@problem_id:1376841]，从而为掌握更复杂的蒙特卡洛技术打下坚实的基础。", "problem": "一位机器人工程师正在测试一种新的导航算法。机器人在二维平面中的最终位置误差由两个独立的随机变量 $X$ 和 $Y$ 建模，它们分别表示两个相互垂直的轴上的误差。$X$ 和 $Y$ 都服从标准正态分布，其概率密度函数 (PDF) 为\n$$ f(z) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{z^2}{2}\\right), \\quad \\text{其中 } -\\infty  z  \\infty $$\n如果机器人的最终位置误差位于以原点为中心的单位圆内，即满足条件 $X^2 + Y^2 \\le 1$，则认为测试成功。\n\n为了估计测试成功的概率，该工程师运行了一次仿真，并为随机变量对 $(X, Y)$ 生成了一小组随机样本。生成了以下十对数值：\n(0.52, -0.31), (-1.21, 0.44), (0.87, 0.73), (-0.05, 0.55), (1.57, -0.62),\n(-0.48, 0.19), (0.91, -0.25), (-1.10, -0.89), (0.33, 0.15), (0.60, -0.95).\n\n使用这组十个模拟数据点，估计测试成功的概率。答案表示为保留三位有效数字的小数。", "solution": "我们被要求使用给定的大小为 $n=10$ 的样本来估计成功的概率。定义成功事件 $S=\\{X^{2}+Y^{2} \\le 1\\}$。基于样本 $\\{(X_{i},Y_{i})\\}_{i=1}^{n}$ 的 $p=\\mathbb{P}(S)$ 的蒙特卡洛估计量是\n$$\n\\hat{p}=\\frac{1}{n}\\sum_{i=1}^{n}\\mathbf{1}\\{X_{i}^{2}+Y_{i}^{2} \\le 1\\}.\n$$\n我们对每一对样本计算 $X_{i}^{2}+Y_{i}^{2}$ 的值，并与 $1$ 进行比较：\n- $(0.52,-0.31)$: $0.52^{2}+(-0.31)^{2}=0.2704+0.0961=0.3665 \\le 1$ (成功)。\n- $(-1.21,0.44)$: $(-1.21)^{2}+0.44^{2}=1.4641+0.1936=1.6577 > 1$ (失败)。\n- $(0.87,0.73)$: $0.87^{2}+0.73^{2}=0.7569+0.5329=1.2898 > 1$ (失败)。\n- $(-0.05,0.55)$: $(-0.05)^{2}+0.55^{2}=0.0025+0.3025=0.3050 \\le 1$ (成功)。\n- $(1.57,-0.62)$: $1.57^{2}+(-0.62)^{2}=2.4649+0.3844=2.8493 > 1$ (失败)。\n- $(-0.48,0.19)$: $(-0.48)^{2}+0.19^{2}=0.2304+0.0361=0.2665 \\le 1$ (成功)。\n- $(0.91,-0.25)$: $0.91^{2}+(-0.25)^{2}=0.8281+0.0625=0.8906 \\le 1$ (成功)。\n- $(-1.10,-0.89)$: $(-1.10)^{2}+(-0.89)^{2}=1.2100+0.7921=2.0021 > 1$ (失败)。\n- $(0.33,0.15)$: $0.33^{2}+0.15^{2}=0.1089+0.0225=0.1314 \\le 1$ (成功)。\n- $(0.60,-0.95)$: $0.60^{2}+(-0.95)^{2}=0.3600+0.9025=1.2625 > 1$ (失败)。\n\n在 $n=10$ 次试验中，有 $k=5$ 次成功，所以\n$$\n\\hat{p}=\\frac{k}{n}=\\frac{5}{10}=0.5.\n$$\n保留三位有效数字，结果为 $0.500$。", "answer": "$$\\boxed{0.500}$$", "id": "1376841"}, {"introduction": "在处理罕见事件的概率估计时，朴素蒙特卡洛方法的效率会变得很低，因为绝大多数样本都不会“命中”我们感兴趣的事件。重要性采样是一种强大的方差缩减技术，它通过从一个更有可能产生重要事件的新分布中抽样来解决这个问题。这项实践 [@problem_id:1376878] 引导您设计一个重要性采样方案，通过一种启发式方法选择最佳的采样分布参数，并计算关键的似然比，这能加深您对如何高效估计罕见事件的理解。", "problem": "正在研究一个复杂系统的可靠性。其在发生某种特定类型故障前的总运行时间被建模为 $n=20$ 个独立同分布组件寿命的总和 $S = \\sum_{i=1}^{n} X_i$。每个组件的寿命 $X_i$ 服从指数概率分布，其速率参数为 $\\lambda=1 \\text{ year}^{-1}$。如果总运行时间 $S$ 超过阈值 $a=40$ 年，则会触发一次关键且成本高昂的维护事件。\n\n为了数值估计这一罕见事件的概率 $P(S > a)$，一位分析师决定使用重要性抽样方法。这涉及从一个新的分布中生成组件寿命 $Y_i$，该分布也是指数分布，但具有不同的速率参数 $\\theta$。\n\n在这种情况下，选择有效重要性抽样参数的一个常用启发式方法是，选择 $\\theta$ 使得新分布下的期望总运行时间以关键阈值为中心。也就是说，选择的 $\\theta$ 值满足 $E_{\\theta}[S_Y] = a$，其中 $S_Y = \\sum_{i=1}^{n} Y_i$。\n\n设 $f_S(s)$ 是真实总寿命 $S$ 的概率密度函数（PDF），$g_{S,\\theta}(s)$ 是在由该启发式方法确定的速率参数 $\\theta$ 下，重要性抽样方案的总寿命 $S_Y$ 的概率密度函数。计算在关键阈值 $s=a$ 处评估的似然比 $W(s) = \\frac{f_S(s)}{g_{S,\\theta}(s)}$ 的值。\n\n将您的答案表示为一个保留三位有效数字的实数。", "solution": "$n$ 个独立的 $\\operatorname{Exp}(\\lambda)$ 随机变量之和服从伽马分布，其形状参数为 $n$，速率参数为 $\\lambda$。因此，对于 $S=\\sum_{i=1}^{n}X_{i}$，其中 $X_{i}\\sim \\operatorname{Exp}(\\lambda)$，其概率密度函数（PDF）为\n$$\nf_{S}(s)=\\frac{\\lambda^{n}}{\\Gamma(n)}\\,s^{n-1}\\exp(-\\lambda s),\\quad s>0.\n$$\n在重要性抽样下，$Y_{i}\\sim \\operatorname{Exp}(\\theta)$ 且相互独立，因此 $S_{Y}=\\sum_{i=1}^{n}Y_{i}$ 的概率密度函数为\n$$\ng_{S,\\theta}(s)=\\frac{\\theta^{n}}{\\Gamma(n)}\\,s^{n-1}\\exp(-\\theta s),\\quad s>0.\n$$\n该启发式方法选择 $\\theta$ 以使 $E_{\\theta}[S_{Y}]=a$。由于 $E_{\\theta}[S_{Y}]=n/\\theta$，这给出\n$$\n\\frac{n}{\\theta}=a\\quad\\Rightarrow\\quad \\theta=\\frac{n}{a}.\n$$\n在 $s$ 处的似然比为\n$$\nW(s)=\\frac{f_{S}(s)}{g_{S,\\theta}(s)}=\\frac{\\lambda^{n}\\exp(-\\lambda s)}{\\theta^{n}\\exp(-\\theta s)}=\\left(\\frac{\\lambda}{\\theta}\\right)^{n}\\exp\\bigl(-(\\lambda-\\theta)s\\bigr).\n$$\n当 $\\lambda=1$ 时，这简化为\n$$\nW(s)=\\theta^{-n}\\exp\\bigl(-(1-\\theta)s\\bigr).\n$$\n在 $s=a$ 处，使用 $\\theta=n/a$ 进行评估，得到\n$$\nW(a)=\\left(\\frac{a}{n}\\right)^{n}\\exp(n-a).\n$$\n对于 $n=20$ 和 $a=40$，\n$$\nW(a)=2^{20}\\exp(-20)\\approx 0.002161276\\ldots\n$$\n保留三位有效数字，结果为 $0.00216$。", "answer": "$$\\boxed{0.00216}$$", "id": "1376878"}, {"introduction": "选择一个好的重要性采样分布是降低蒙特卡洛估计方差的关键，但一个糟糕的选择甚至可能使结果比标准蒙特卡洛方法更差。这项高级实践 [@problem_id:2414609] 旨在培养您对数值方法批判性评估的能力，您将分析并比较不同重要性采样策略下的估计器方差。通过研究重要性采样取得显著成功、完全失效甚至达到零方差的理想情况，您将深刻领会构建高效重要性采样策略的精髓所在。", "problem": "考虑一个非负被积函数在有限区间上的积分。设目标积分为\n$$\nI = \\int_{0}^{1} f(x)\\,dx,\n$$\n其中 $f(x) = x^{m}$，对于固定的指数 $m$ 满足 $m > -1$。定义原始蒙特卡罗估计量为随机变量 $Y_{\\mathrm{c}} = f(U)$，其中 $U \\sim \\mathrm{Uniform}(0,1)$，并定义重要性采样估计量为 $Y_{\\mathrm{is}} = f(X)/p(X)$，其在 $[0,1]$ 上的概率密度函数为 $p(x)$，且 $X \\sim p$。根据定义，这些无偏估计量的单位样本方差为\n$$\n\\mathrm{Var}(Y_{\\mathrm{c}}) = \\mathbb{E}[Y_{\\mathrm{c}}^{2}] - I^{2}, \\qquad \\mathrm{Var}(Y_{\\mathrm{is}}) = \\mathbb{E}[Y_{\\mathrm{is}}^{2}] - I^{2}.\n$$\n对于重要性采样密度，考虑在 $[0,1]$ 上参数为 $\\alpha > 0$ 和 $\\beta > 0$ 的贝塔分布，\n$$\np(x) = \\frac{x^{\\alpha - 1}(1 - x)^{\\beta - 1}}{B(\\alpha,\\beta)},\n$$\n其中 $B(\\alpha,\\beta)$ 是贝塔函数。假设参数的选择使所有量均为有限值；特别地，假设 $\\beta  2$ 和 $\\alpha  2m + 2$ 以确保 $\\mathbb{E}[Y_{\\mathrm{is}}^{2}]$ 存在。\n\n对于以下测试集中的每个参数集 $(m,\\alpha,\\beta)$，计算比率\n$$\nr = \\frac{\\mathrm{Var}(Y_{\\mathrm{is}})}{\\mathrm{Var}(Y_{\\mathrm{c}})},\n$$\n并按指定格式生成结果。\n\n测试集（每个三元组为 $(m,\\alpha,\\beta)$）：\n\n- 情况 $1$：$(2,\\tfrac{1}{2},\\tfrac{3}{2})$。\n- 情况 $2$：$(2,1,1)$。\n- 情况 $3$：$(2,\\tfrac{5}{2},1)$。\n- 情况 $4$：$(2,3,1)$。\n\n最终输出格式：您的程序应生成单行输出，其中包含按上述顺序列出的各情况的结果，形式为方括号括起来的逗号分隔列表（例如，$[r_{1},r_{2}]$）。每个数字必须四舍五入到 $6$ 位小数。不应打印任何额外文本。", "solution": "该问题要求计算比率 $r = \\mathrm{Var}(Y_{\\mathrm{is}})/\\mathrm{Var}(Y_{\\mathrm{c}})$，其中 $\\mathrm{Var}(Y_{\\mathrm{c}})$ 是原始蒙特卡罗估计量的方差，$\\mathrm{Var}(Y_{\\mathrm{is}})$ 是重要性采样估计量的方差，用于计算积分 $I = \\int_{0}^{1} f(x)\\,dx$ 且 $f(x) = x^{m}$。分析过程通过推导每个方差的解析表达式来进行。\n\n首先，我们计算积分 $I$ 的精确值。对于 $m > -1$：\n$$\nI = \\int_{0}^{1} x^{m} \\, dx = \\left[ \\frac{x^{m+1}}{m+1} \\right]_{0}^{1} = \\frac{1}{m+1}\n$$\n\n接下来，我们推导原始蒙特卡罗估计量 $Y_{\\mathrm{c}} = f(U) = U^m$ 的方差，其中 $U \\sim \\mathrm{Uniform}(0,1)$。方差定义为 $\\mathrm{Var}(Y_{\\mathrm{c}}) = \\mathbb{E}[Y_{\\mathrm{c}}^{2}] - I^{2}$。二阶矩 $\\mathbb{E}[Y_{\\mathrm{c}}^{2}]$ 为：\n$$\n\\mathbb{E}[Y_{\\mathrm{c}}^{2}] = \\mathbb{E}[(U^m)^2] = \\mathbb{E}[U^{2m}] = \\int_{0}^{1} u^{2m} \\cdot 1 \\, du = \\frac{1}{2m+1}\n$$\n这要求 $2m+1 > 0$，即 $m > -1/2$。给定的条件 $m > -1$ 和测试用例 $m=2$ 满足此要求。因此，方差为：\n$$\n\\mathrm{Var}(Y_{\\mathrm{c}}) = \\frac{1}{2m+1} - \\left(\\frac{1}{m+1}\\right)^2 = \\frac{(m+1)^2 - (2m+1)}{(2m+1)(m+1)^2} = \\frac{m^2 + 2m + 1 - 2m - 1}{(2m+1)(m+1)^2} = \\frac{m^2}{(2m+1)(m+1)^2}\n$$\n\n现在，我们推导重要性采样估计量 $Y_{\\mathrm{is}} = f(X)/p(X)$ 的方差，其中 $X$ 从密度为 $p(x) = x^{\\alpha - 1}(1 - x)^{\\beta - 1} / B(\\alpha, \\beta)$ 的贝塔分布中抽取。方差为 $\\mathrm{Var}(Y_{\\mathrm{is}}) = \\mathbb{E}[Y_{\\mathrm{is}}^{2}] - I^{2}$。二阶矩 $\\mathbb{E}[Y_{\\mathrm{is}}^{2}]$ 计算如下：\n$$\n\\mathbb{E}[Y_{\\mathrm{is}}^{2}] = \\int_{0}^{1} \\left(\\frac{f(x)}{p(x)}\\right)^2 p(x) \\, dx = \\int_{0}^{1} \\frac{f(x)^2}{p(x)} \\, dx\n$$\n代入 $f(x) = x^m$ 和密度 $p(x)$：\n$$\n\\mathbb{E}[Y_{\\mathrm{is}}^{2}] = \\int_{0}^{1} \\frac{(x^m)^2}{\\frac{x^{\\alpha - 1}(1 - x)^{\\beta - 1}}{B(\\alpha, \\beta)}} \\, dx = B(\\alpha, \\beta) \\int_{0}^{1} x^{2m - \\alpha + 1} (1 - x)^{1 - \\beta} \\, dx\n$$\n该积分为贝塔函数积分，$B(a,b) = \\int_0^1 t^{a-1}(1-t)^{b-1}dt$。我们相应地重写被积函数的指数：\n$$\n\\mathbb{E}[Y_{\\mathrm{is}}^{2}] = B(\\alpha, \\beta) \\int_{0}^{1} x^{(2m - \\alpha + 2) - 1} (1 - x)^{(2 - \\beta) - 1} \\, dx\n$$\n该积分等于 $B(2m - \\alpha + 2, 2 - \\beta)$。问题约束 $\\alpha  2m + 2$ 和 $\\beta  2$ 保证了此积分的存在性。因此，二阶矩为：\n$$\n\\mathbb{E}[Y_{\\mathrm{is}}^{2}] = B(\\alpha, \\beta) B(2m - \\alpha + 2, 2 - \\beta)\n$$\n重要性采样估计量的方差为：\n$$\n\\mathrm{Var}(Y_{\\mathrm{is}}) = B(\\alpha, \\beta) B(2m - \\alpha + 2, 2 - \\beta) - \\frac{1}{(m+1)^2}\n$$\n\n最后，比率 $r$ 由通用公式给出：\n$$\nr = \\frac{\\mathrm{Var}(Y_{\\mathrm{is}})}{\\mathrm{Var}(Y_{\\mathrm{c}})} = \\frac{B(\\alpha, \\beta) B(2m - \\alpha + 2, 2 - \\beta) - \\frac{1}{(m+1)^2}}{\\frac{m^2}{(2m+1)(m+1)^2}}\n$$\n\n对于所有测试用例，指数为 $m=2$。我们可以将公式具体化：\n$I = \\frac{1}{2+1} = \\frac{1}{3}$。\n$\\mathrm{Var}(Y_{\\mathrm{c}}) = \\frac{2^2}{(2(2)+1)(2+1)^2} = \\frac{4}{5 \\cdot 9} = \\frac{4}{45}$。\n对于 $m=2$，比率 $r$ 变为：\n$$\nr = \\frac{B(\\alpha, \\beta) B(6 - \\alpha, 2 - \\beta) - \\frac{1}{9}}{\\frac{4}{45}} = \\frac{45}{4} \\left( B(\\alpha, \\beta) B(6 - \\alpha, 2 - \\beta) - \\frac{1}{9} \\right)\n$$\n\n现在我们为每个测试用例计算比率。\n\n情况 $1$：$(m,\\alpha,\\beta) = (2, \\frac{1}{2}, \\frac{3}{2})$。\n我们有 $\\alpha = 0.5$ 和 $\\beta = 1.5$。\n$r = \\frac{45}{4} \\left( B(0.5, 1.5) B(5.5, 0.5) - \\frac{1}{9} \\right)$。\n使用关系 $B(x,y) = \\frac{\\Gamma(x)\\Gamma(y)}{\\Gamma(x+y)}$：\n$B(0.5, 1.5) = B(\\frac{1}{2}, \\frac{3}{2}) = \\frac{\\Gamma(1/2)\\Gamma(3/2)}{\\Gamma(2)} = \\frac{\\sqrt{\\pi} \\cdot (1/2)\\sqrt{\\pi}}{1!} = \\frac{\\pi}{2}$。\n$B(5.5, 0.5) = B(\\frac{11}{2}, \\frac{1}{2}) = \\frac{\\Gamma(11/2)\\Gamma(1/2)}{\\Gamma(6)} = \\frac{(945/32)\\sqrt{\\pi} \\cdot \\sqrt{\\pi}}{5!} = \\frac{945\\pi}{32 \\cdot 120} = \\frac{63\\pi}{256}$。\n$r = \\frac{45}{4} \\left( \\frac{\\pi}{2} \\cdot \\frac{63\\pi}{256} - \\frac{1}{9} \\right) = \\frac{45}{4} \\frac{63\\pi^2}{512} - \\frac{45}{36} = \\frac{2835\\pi^2}{2048} - \\frac{5}{4} = \\frac{2835\\pi^2 - 2560}{2048}$。\n数值上，这大约是 $12.408172$。\n\n情况 $2$：$(m,\\alpha,\\beta) = (2, 1, 1)$。\n这里，$\\alpha=1, \\beta=1$，所以 $p(x) = \\frac{x^0(1-x)^0}{B(1,1)} = 1$，即均匀分布。重要性采样方案与原始蒙特卡罗方案相同。因此，$\\mathrm{Var}(Y_{\\mathrm{is}}) = \\mathrm{Var}(Y_{\\mathrm{c}})$ 且比率 $r$ 必须为 $1$。\n用公式验证：\n$r = \\frac{45}{4} \\left( B(1, 1) B(5, 1) - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( 1 \\cdot \\frac{1}{5} - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{1}{5} - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{9-5}{45} \\right) = \\frac{45}{4} \\frac{4}{45} = 1$。\n\n情况 $3$：$(m,\\alpha,\\beta) = (2, \\frac{5}{2}, 1)$。\n我们有 $\\alpha = 2.5$ 和 $\\beta = 1$。$B(a,1)$ 的公式是 $1/a$。\n$r = \\frac{45}{4} \\left( B(2.5, 1) B(3.5, 1) - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{1}{2.5} \\cdot \\frac{1}{3.5} - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{2}{5} \\cdot \\frac{2}{7} - \\frac{1}{9} \\right)$。\n$r = \\frac{45}{4} \\left( \\frac{4}{35} - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{36 - 35}{315} \\right) = \\frac{45}{4 \\cdot 315} = \\frac{1}{4 \\cdot 7} = \\frac{1}{28}$。\n数值上，这大约是 $0.035714$。\n\n情况 $4$：$(m,\\alpha,\\beta) = (2, 3, 1)$。\n这里，$\\alpha = 3$ 和 $\\beta = 1$。采样密度为 $p(x) = \\frac{x^{3-1}}{B(3,1)} = \\frac{x^2}{1/3} = 3x^2$。被积函数为 $f(x)=x^2$。由于 $p(x) \\propto f(x)$，估计量 $Y_{\\mathrm{is}} = \\frac{f(X)}{p(X)} = \\frac{X^2}{3X^2} = \\frac{1}{3}$ 是一个常数。常数的方差为零。因此，$r=0$。\n用公式验证：\n$r = \\frac{45}{4} \\left( B(3, 1) B(3, 1) - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{1}{3} \\cdot \\frac{1}{3} - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{1}{9} - \\frac{1}{9} \\right) = 0$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import beta\n\ndef solve():\n    \"\"\"\n    Computes the ratio of variances for importance sampling vs. crude Monte Carlo\n    for the integral of f(x) = x^m from 0 to 1.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (2, 0.5, 1.5),  # Case 1\n        (2, 1, 1),      # Case 2\n        (2, 2.5, 1),    # Case 3\n        (2, 3, 1)       # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        m, alpha, beta_p = case\n\n        # General formula for the variance of the crude Monte Carlo estimator.\n        # Var(Y_c) = E[f(U)^2] - I^2 = integral(x^(2m))dx - (integral(x^m)dx)^2\n        #          = 1/(2m+1) - 1/((m+1)^2)\n        #          = m^2 / ((2m+1)*(m+1)^2)\n        var_c = m**2 / ((2 * m + 1) * (m + 1)**2)\n\n        # General formula for the variance of the importance sampling estimator.\n        # Var(Y_is) = E[(f(X)/p(X))^2] - I^2 = integral(f(x)^2/p(x))dx - I^2\n        #           = B(alpha, beta) * B(2m - alpha + 2, 2 - beta) - 1/((m+1)^2)\n        # The conditions m > -1, alpha > 0, beta > 0, alpha  2m+2, beta  2 are met.\n        term1 = beta(alpha, beta_p)\n        term2 = beta(2 * m - alpha + 2, 2 - beta_p)\n        var_is = term1 * term2 - 1 / ((m + 1)**2)\n        \n        # The ratio r = Var(Y_is) / Var(Y_c).\n        # var_c is non-zero since m=2 is used in all test cases.\n        ratio = var_is / var_c\n        \n        results.append(ratio)\n\n    # Format the results to 6 decimal places as required.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2414609"}]}