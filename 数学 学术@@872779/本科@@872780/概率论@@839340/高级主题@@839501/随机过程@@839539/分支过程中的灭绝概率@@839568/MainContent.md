## 引言
分支过程是概率论中一个强大而优美的分支，它为模拟那些由独立个体进行随机繁衍的系统提供了数学框架。从一个物种的繁衍、一个基因的遗传，到一条信息的传播，甚至是核反应的链式过程，这些看似无关的现象背后都隐藏着共同的随机增长模式。然而，在这种增长过程中，一个根本性的问题始终存在：一个谱系（lineage）是会无限延续下去，还是会在某个时刻因为随机波动而彻底消失？量化这种“灭绝”的可能性，不仅具有深刻的理论意义，更在众多实际应用中至关重要。

本文旨在系统性地介绍计算分支过程中[灭绝概率](@entry_id:270869)的核心理论与方法。我们将填补直觉与严谨数学之间的鸿沟，揭示决定一个谱系长期命运的关键因素。通过本文的学习，你将能够：

- **第一章：原理与机制** - 掌握分支过程的数学基础，理解[概率生成函数](@entry_id:190573)如何作为核心分析工具，并运用它推导出计算[灭绝概率](@entry_id:270869)的基本定理。你将学会根据[平均后代数](@entry_id:269928)的不同，判断种群的三种命运：亚临界、临界与超临界。
- **第二章：应用与跨学科联系** - 探索分支过程理论在生物学、流行病学、社会科学和技术系统等多个领域的广泛应用。你将看到这一理论如何帮助我们理解物种存续、疾病爆发和信息“病毒式”传播等现实问题。
- **第三章：动手实践** - 通过一系列精心设计的练习，将理论知识转化为解决实际问题的能力，从计算短期内的[灭绝概率](@entry_id:270869)，到处理更复杂的后代[分布](@entry_id:182848)，从而巩固和深化你的理解。

让我们从分支过程的基本原理开始，一步步揭开谱系存亡之谜。

## 原理与机制

在理解了分支过程的基本概念之后，本章将深入探讨其核心的数学原理与机制，重点关注如何量化一个谱系最终走向灭绝的可能性。我们将建立一套系统性的方法，不仅能够计算[灭绝概率](@entry_id:270869)，还能揭示决定一个种群长期存续或消亡的关键因素。

### 分支过程与灭绝事件的数学表述

一个**高尔顿–沃森（Galton–Watson）过程**是一个[随机过程](@entry_id:159502)，用以模拟一个种群在离散时间代（generation）中的演化。该过程由一系列[随机变量](@entry_id:195330) $\{Z_n\}_{n=0,1,2,\dots}$ 描述，其中 $Z_n$ 表示第 $n$ 代的个体数量。

该模型建立在几个关键假设之上：
1.  过程从第 0 代的 $Z_0$ 个个体开始。除非另有说明，我们通常假设过程由单个祖先开始，即 $Z_0=1$。
2.  在每一代，所有个体都独立地产生下一代后代。
3.  每个个体产生的后代数量是一个[随机变量](@entry_id:195330) $X$，其[概率分布](@entry_id:146404)对于所有个体和所有代都是相同的。我们将这个[分布](@entry_id:182848)称为**后代[分布](@entry_id:182848)（offspring distribution）**，用[概率质量函数](@entry_id:265484) $p_k = P(X=k)$ 表示，其中 $k=0, 1, 2, \dots$。

**灭绝（extinction）**事件被定义为种群在未来的某一时刻彻底消失。用数学语言来说，就是存在一个代数 $n$，使得 $Z_n=0$。一旦 $Z_n=0$，由于没有个体可以产生后代，所有后续代的种群大小也必然为零。我们最关心的量就是**[灭绝概率](@entry_id:270869)（extinction probability）**，记为 $q$，即从单个祖先开始的谱系最终灭绝的概率。

$q = P(\text{存在 } n \ge 1 \text{ 使得 } Z_n=0 | Z_0=1)$

### 核心分析工具：[概率生成函数](@entry_id:190573)

分析分支过程的强大工具是后代[分布](@entry_id:182848)的**[概率生成函数](@entry_id:190573)（Probability Generating Function, PGF）**。对于后代数量[随机变量](@entry_id:195330) $X$，其 PGF 定义为：

$G(s) = \mathbb{E}[s^X] = \sum_{k=0}^{\infty} P(X=k) s^k = \sum_{k=0}^{\infty} p_k s^k$

其中 $s$ 是一个实数变量，通常在区间 $[0,1]$ 内取值。

PGF 巧妙地将整个[概率分布](@entry_id:146404)编码成一个函数。例如，在一个网络[故障传播](@entry_id:178582)的模型中，单个故障节点可能导致0个、1个或2个新故障，其概率分别为 $p_0 = \frac{1}{3}$，$p_1 = \frac{1}{6}$ 和 $p_2 = \frac{1}{2}$ [@problem_id:1362062]。该后代[分布](@entry_id:182848)的 PGF 就是：

$G(s) = p_0 s^0 + p_1 s^1 + p_2 s^2 = \frac{1}{3} + \frac{1}{6}s + \frac{1}{2}s^2$

PGF 具有两个至关重要的性质：
1.  $G(1) = \sum_{k=0}^{\infty} p_k (1)^k = \sum p_k = 1$。
2.  在 $s=1$ 处的导数等于后代[分布](@entry_id:182848)的均值 $\mu$，即**[平均后代数](@entry_id:269928)**。
    $\mu = \mathbb{E}[X] = G'(1) = \sum_{k=1}^{\infty} k p_k$。

这个均值 $\mu$ 是决定种群长期行为的最关键参数。

### [灭绝概率](@entry_id:270869)的基本定理

分支过程理论的一个基石是关于[灭绝概率](@entry_id:270869)的如下定理：

**定理**：从单个祖先开始的分支过程的[灭绝概率](@entry_id:270869) $q$ 是方程 $s = G(s)$ 在区间 $[0,1]$ 内的**最小非负解**。

这个深刻的结果可以通过一个直观的论证来理解。让我们再次考虑[灭绝概率](@entry_id:270869) $q$。为了使从单个祖先开始的谱系灭绝，其第一代后代所开创的所有子谱系都必须灭绝。

假设第0代的祖先产生了 $k$ 个后代（即 $Z_1=k$），这一事件发生的概率是 $p_k$。由于每个后代都独立地开启一个与原始过程完全相同的新分支过程，因此这 $k$ 个子谱系中的每一个都有 $q$ 的概率最终灭绝。由于它们的独立性，这 $k$ 个子谱系全部灭绝的概率是 $q^k$。

通过对 $k$ 的所有可能值进行全概率分解，我们可以得到一个关于 $q$ 的[自洽方程](@entry_id:155949)：

$q = \sum_{k=0}^{\infty} P(Z_1=k) \times P(\text{灭绝} | Z_1=k)$
$q = \sum_{k=0}^{\infty} p_k q^k$

我们立刻认出，这个方程的右边正是后代[分布](@entry_id:182848)的 PGF 在点 $s=q$ 处的值，即 $G(q)$。因此，[灭绝概率](@entry_id:270869) $q$ 必须是 PGF 的一个**[不动点](@entry_id:156394)（fixed point）**：

$q = G(q)$

为什么是最小的非负解呢？我们可以考虑在第 $n$ 代之前灭绝的概率，记为 $q_n = P(Z_n=0)$。显然，$q_1 = P(Z_1=0) = p_0 = G(0)$。通过类似的递推关系，可以证明 $q_{n+1} = G(q_n)$。由于 $Z_{n+1}=0$ 并不蕴含 $Z_n=0$（原文有误，应为序列 $\{q_n\}$ 是非递减的），序列 $\{q_n\}$ 是一个[非递减序列](@entry_id:139501)，它有界（不超过1），因此必定收敛到某个极限，这个极限就是最终的[灭绝概率](@entry_id:270869) $q$。这个迭代过程 $q_{n+1}=G(q_n)$ 从 $q_1=G(0)$ 开始，会收敛到方程 $s=G(s)$ 的最小[不动点](@entry_id:156394)。

### [平均后代数](@entry_id:269928) $\mu$ 的决定性作用：三种机制

[不动点方程](@entry_id:203270) $s=G(s)$ 的解的数量和性质，与[平均后代数](@entry_id:269928) $\mu$ 密切相关。这可以通过分析函数 $y=G(s)$ 和直线 $y=s$ 的几何关系来理解。注意到 $G(s)$ 在区间 $[0,1]$ 上是一个[凸函数](@entry_id:143075)，因为它的[二阶导数](@entry_id:144508) $G''(s) = \sum_{k=2}^{\infty} k(k-1)p_k s^{k-2} \ge 0$。

1.  **亚临界（Subcritical）与临界（Critical）过程：$\mu \le 1$**
    当 $\mu = G'(1) \le 1$ 时，由于 $G(s)$ 是凸函数且 $G(1)=1$，曲线 $y=G(s)$ 在点 $(1,1)$ 处与直线 $y=s$ 相切或从其下方穿过。这意味着在整个区间 $[0,1)$ 内，$G(s) > s$（除非在 $p_1=1$ 的平凡情况下）。因此，方程 $s=G(s)$ 在 $[0,1]$ 上的唯一解是 $s=1$。
    **结论**：如果平均每个个体产生的后代数量不超过一个，那么除非每次都恰好产生一个后代，否则种群几乎必然会灭绝，即**[灭绝概率](@entry_id:270869) $q=1$**。

2.  **超临界（Supercritical）过程：$\mu > 1$**
    当 $\mu = G'(1) > 1$ 时，曲线 $y=G(s)$ 在点 $(1,1)$ 处以大于1的斜率穿过直线 $y=s$。由于 $G(0) = p_0 \ge 0$，且 $G(s)$ 是连续的凸函数，它必须在 $[0,1)$ 区间内与直线 $y=s$ 有且仅有另一个交点。这个交点就是方程 $s=G(s)$ 的最小非负解。
    **结论**：如果平均每个个体产生的后代数量大于一个，那么种群就有可能无限存续下去。[灭绝概率](@entry_id:270869) $q$ 是一个小于1的数，即 **$q \in [0, 1)$**。

这个分类揭示了一个深刻的阈值现象。正如对一种自复制恶意软件的分析所指出的，如果其“遏制概率”（即[灭绝概率](@entry_id:270869)）被确定为一个介于0和1之间的数，那么我们就可以断定，其平均繁殖率 $\mu$ 必须大于1 [@problem_id:1362070]。

### [灭绝概率](@entry_id:270869)的计算实践

基于上述理论，我们可以给出一个计算[灭绝概率](@entry_id:270869)的实用步骤：

1.  **确定后代[分布](@entry_id:182848)** $\{p_k\}$。
2.  **构建[概率生成函数](@entry_id:190573)** $G(s) = \sum p_k s^k$。
3.  **求解[不动点方程](@entry_id:203270)** $s = G(s)$。这通常会转化为一个多项式方程。
4.  **确定解**。在所有非负解中，选择最小的一个作为[灭绝概率](@entry_id:270869) $q$。如果 $\mu > 1$，这个解将严格小于1。

让我们通过几个例子来应用这个流程。

**示例1：[二项分布](@entry_id:141181)后代**
一个社交平台的“级联”功能，每个用户以 $p=2/3$ 的概率触发向 $N=2$ 个新用户传播 [@problem_id:1362103]。每个个体的后代数 $X \sim \text{Binomial}(2, 2/3)$。其PGF为：
$G(s) = \mathbb{E}[s^X] = ( (1-p) + ps )^N = (\frac{1}{3} + \frac{2}{3}s)^2$

求解 $q = G(q)$：
$q = (\frac{1+2q}{3})^2 \implies 9q = 1 + 4q + 4q^2 \implies 4q^2 - 5q + 1 = 0$
这个二次方程的解是 $q = \frac{5 \pm \sqrt{25-16}}{8} = \frac{5 \pm 3}{8}$，即 $q=1$ 和 $q=1/4$。
[平均后代数](@entry_id:269928) $\mu = Np = 2 \times \frac{2}{3} = \frac{4}{3} > 1$，过程是超临界的。因此，[灭绝概率](@entry_id:270869)是较小的解，即 $q=1/4$。

**示例2：几何分布后代**
一种自复制纳米材料的后代[分布](@entry_id:182848)PGF为 $G(s) = \frac{1-p}{1-ps}$，其中参数 $p=2/3$ [@problem_id:1362106]。这是一个从0开始的几何分布的PGF。
求解 $q = G(q)$：
$q = \frac{1-2/3}{1-(2/3)q} \implies q(1 - \frac{2}{3}q) = \frac{1}{3} \implies 3q - 2q^2 = 1 \implies 2q^2 - 3q + 1 = 0$
这个方程可以分解为 $(2q-1)(q-1)=0$，解为 $q=1/2$ 和 $q=1$。
[平均后代数](@entry_id:269928) $\mu = G'(1) = \frac{p}{1-p} = \frac{2/3}{1/3} = 2 > 1$。因此，[灭绝概率](@entry_id:270869)是 $q=1/2$。

**示例3：更复杂的[分布](@entry_id:182848)**
在一种加密货币[网络模型](@entry_id:136956)中，后代[分布](@entry_id:182848)为 $P(X=0) = 1/2$, $P(X=1) = 1/8$, $P(X=3) = 3/8$ [@problem_id:1362095]。PGF为：
$G(s) = \frac{1}{2} + \frac{1}{8}s + \frac{3}{8}s^3$
求解 $q = G(q)$：
$q = \frac{1}{2} + \frac{1}{8}q + \frac{3}{8}q^3 \implies 8q = 4 + q + 3q^3 \implies 3q^3 - 7q + 4 = 0$
这是一个三次方程。我们注意到 $q=1$ 是一个解，所以 $(q-1)$ 是一个因子。通过[多项式除法](@entry_id:151800)，我们得到 $(q-1)(3q^2+3q-4)=0$。另一个二次方程的解是 $q = \frac{-3 \pm \sqrt{9 - 4(3)(-4)}}{6} = \frac{-3 \pm \sqrt{57}}{6}$。在区间 $[0,1]$ 内的解只有 $\frac{-3+\sqrt{57}}{6}$ 和 $1$。由于均值 $\mu = 1 \cdot \frac{1}{8} + 3 \cdot \frac{3}{8} = \frac{10}{8} = \frac{5}{4} > 1$，[灭绝概率](@entry_id:270869)是较小的解 $q = \frac{-3+\sqrt{57}}{6}$。

### 进阶主题与深入洞察

#### 多祖先的灭绝
如果过程从 $k$ 个独立的祖先开始（$Z_0=k$），那么整个种群的灭绝事件等价于所有 $k$ 个独立谱系都灭绝。如果单个谱系的[灭绝概率](@entry_id:270869)是 $q$，那么 $k$ 个谱系全部灭绝的概率就是 $q^k$。例如，一个网络中初始有10个独立的恶意软件实例，单个实例谱系的[灭绝概率](@entry_id:270869)为 $\pi=0.8$，那么整个恶意软件种群的[灭绝概率](@entry_id:270869)就是 $(0.8)^{10} \approx 0.1074$ [@problem_id:1362098]。

#### 有限时间内的[灭绝概率](@entry_id:270869)
我们也可以计算种群在第 $n$ 代或之前灭绝的概率，即 $q_n = P(Z_n=0)$。如前所述，这个概率可以通过迭代计算得到：
$q_1 = G(0)$
$q_2 = P(Z_2=0) = G(q_1) = G(G(0))$
$q_n = G(q_{n-1}) = G^{(n)}(0)$ （$G$ 的 $n$ 次复合迭代）

在一个数字实体传播模型中，通过计算 $q_3 = G(G(G(0)))$，我们可以得到前三代内灭绝的概率，而其存活概率就是 $P(Z_3>0) = 1-q_3$ [@problem_id:1362127]。这个迭代过程也直观地显示了[灭绝概率](@entry_id:270869)如何逐代逼近最终的极限值 $q$。

#### [随机占优](@entry_id:142966)与灭绝
比较不同分支过程的生存能力是一个重要问题。假设有两个菌株Alpha和Beta，其后代[随机变量](@entry_id:195330)分别为 $X_A$ 和 $X_B$。如果对于所有的 $k$ 都有 $P(X_B \le k) \le P(X_A \le k)$，并且至少在一个 $k$ 上不等号成立，我们就说 $X_B$ **[随机占优](@entry_id:142966)于（stochastically dominates）** $X_A$，意味着菌株Beta倾向于产生更多的后代。

这种占优关系直接反映在它们的PGF上：$G_B(s) \le G_A(s)$ 对于所有 $s \in [0,1]$。从 $s=G(s)$ 的图像解法可以看出，更“低”的PGF曲线会与 $y=s$ 在一个更小的点相交。因此，一个[随机占优](@entry_id:142966)的（更“强壮”的）过程具有更低的[灭绝概率](@entry_id:270869)，即 $q_B \le q_A$。一个具体的计算比较了两种细菌菌株，验证了后代[分布](@entry_id:182848)更优的菌株Beta确实有更低的[灭绝概率](@entry_id:270869)（$\pi_B = 3/8  \pi_A = 1/2$） [@problem_id:1362096]。

#### 存活种群的行为
分支过程理论不仅告诉我们灭绝的概率，还描述了当种群**没有**灭绝时会发生什么。
-   **[亚临界过程](@entry_id:267021)（$\mu  1$）**: 即使一个谱系碰巧存活了很长一段时间，其在存活条件下的预期规模也会趋于一个常数。生存是一种稀有事件，并且幸存下来的种群规模并不会无限增长 [@problem_id:1362077]。
-   **临界过程（$\mu = 1$）**: 存活下来的种群预期规模会随代数 $n$ 线性增长。这是一种非常缓慢的增长 [@problem_id:1362077]。
-   **超临界过程（$\mu > 1$）**: 存活下来的种群倾向于以指数形式爆炸性增长。种群规模 $Z_n$ 的[期望值](@entry_id:153208)是 $\mu^n$。为了研究这种指数增长的细节，我们可以考察归一化的种群规模 $W_n = Z_n / \mu^n$。

#### (高等内容) 与[鞅](@entry_id:267779)的联系
在超临界情况下 ($\mu>1$)，序列 $W_n = Z_n/\mu^n$ 构成一个非负的**[鞅](@entry_id:267779)（martingale）**。根据[鞅收敛定理](@entry_id:261620)，$W_n$ [几乎必然收敛](@entry_id:265812)到一个极限[随机变量](@entry_id:195330) $W = \lim_{n\to\infty} W_n$。

Kesten-Stigum 定理揭示了极限变量 $W$ 与灭绝事件之间的深刻联系。在后代[分布](@entry_id:182848)[方差](@entry_id:200758)有限的条件下（这是一个相当弱的条件），该定理表明：
-   灭绝事件 $\{\lim_{n\to\infty} Z_n = 0\}$ 与极限为零事件 $\{W=0\}$ 是[几乎必然](@entry_id:262518)等价的。
-   因此，极限变量 $W$ 取值为0的概率，恰好就是该过程的[灭绝概率](@entry_id:270869)：$P(W=0) = q$。
-   在存活事件上，$W$ 是一个严格为正的[随机变量](@entry_id:195330)，描述了种群规模[渐近增长](@entry_id:637505)的“[速率常数](@entry_id:196199)”。

这一结果将[灭绝概率](@entry_id:270869)这一看似孤立的概念，与[随机过程](@entry_id:159502)理论中更广泛的鞅理论和收敛行为联系在一起，为理[解分支](@entry_id:755045)过程的长期动态提供了更为深刻的视角 [@problem_id:1362078]。