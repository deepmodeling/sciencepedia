{"hands_on_practices": [{"introduction": "阿祖马-霍夫丁不等式最直接的应用场景之一是分析独立随机变量之和的行为，其特例霍夫丁不等式在此类问题中非常有用。我们将从一个群体遗传学中的经典模型——赖特-费舍尔（Wright-Fisher）模型——入手。通过这个练习 [@problem_id:1336267]，你将看到在一个大种群中，等位基因的频率如何通过随机抽样发生漂变，并运用不等式来量化这种频率偏离其期望值的概率，从而直观地理解浓度效应。", "problem": "考虑一个被称为赖特-费舍尔模型的简化遗传漂变模型。我们研究的是一个单倍体种群，这意味着每个个体对每个基因只有一个拷贝。种群大小是恒定的，每一代都有 $N$ 个个体。\n\n该种群中的一个特定基因以两种形式或等位基因存在，记为 $A_1$ 和 $A_2$。在初始代（我们称之为第0代）中，携带等位基因 $A_1$ 的个体比例为 $p_0$，其中 $0  p_0  1$。\n\n下一代，即第1代，是通过从第0代种群中有放回地抽样 $N$ 个个体来创建的。这意味着新一代中的 $N$ 个位置中的每一个都是通过从原来的 $N$ 个个体中随机挑选一个个体来填充的，这个过程重复 $N$ 次。\n\n设 $p_1$ 为第1代中等位基因 $A_1$ 的频率（比例）。抽样的随机性导致等位基因频率发生波动，这种现象被称为遗传漂变。一代中等位基因频率的变化为 $\\Delta p = p_1 - p_0$。对于任意给定的小的正值 $\\epsilon$，求出该频率变化的绝对值超过 $\\epsilon$ 的概率的一个上界。也就是说，求概率 $P(|\\Delta p|  \\epsilon)$ 的一个上界。\n\n你的答案应该是一个关于种群大小 $N$ 和偏差阈值 $\\epsilon$ 的闭式表达式。", "solution": "在一个有放回抽样的单倍体赖特-费舍尔模型中，构建指示变量 $X_{i}$（$i=1,\\dots,N$），如果第1代中第 $i$ 个抽样个体携带等位基因 $A_{1}$，则 $X_{i}=1$，否则 $X_{i}=0$。因为每次抽样都是从第0代中有放回地进行，并且其中 $A_{1}$ 的比例为 $p_{0}$，所以 $X_{i}$ 是参数为 $p_{0}$ 的独立同分布的伯努利随机变量：\n$$\n\\mathbb{P}(X_{i}=1)=p_{0}, \\quad \\mathbb{P}(X_{i}=0)=1-p_{0}, \\quad \\text{and} \\quad \\mathbb{E}[X_{i}]=p_{0}.\n$$\n设 $K=\\sum_{i=1}^{N} X_{i}\\sim \\text{Binomial}(N,p_{0})$ 为第1代中等位基因 $A_{1}$ 的数量，因此第1代的频率是\n$$\np_{1}=\\frac{K}{N}=\\frac{1}{N}\\sum_{i=1}^{N} X_{i}.\n$$\n因此，一代的变化是\n$$\n\\Delta p = p_{1}-p_{0} = \\frac{1}{N}\\sum_{i=1}^{N} X_{i} - \\mathbb{E}[\\frac{1}{N}\\sum_{i=1}^{N} X_{i}].\n$$\n我们对在 $[0,1]$ 内有界的独立变量应用霍夫丁不等式。对于均值为 $\\mathbb{E}[X_{i}]=p_{0}$ 的独立同分布变量 $X_{i}\\in[0,1]$，样本均值 $S_{N}=\\frac{1}{N}\\sum_{i=1}^{N} X_{i}$ 满足\n$$\n\\mathbb{P}\\left(\\left|S_{N}-\\mathbb{E}[S_{N}]\\right|\\ge \\epsilon\\right) \\le 2 \\exp\\!\\left(-2 N \\epsilon^{2}\\right).\n$$\n由于 $S_{N}=p_{1}$ 且 $\\mathbb{E}[S_{N}]=p_{0}$，这给出了\n$$\n\\mathbb{P}\\left(\\left|p_{1}-p_{0}\\right|\\ge \\epsilon\\right) \\le 2 \\exp\\!\\left(-2 N \\epsilon^{2}\\right).\n$$\n因为 $\\mathbb{P}(|\\Delta p|\\epsilon)\\le \\mathbb{P}(|\\Delta p|\\ge \\epsilon)$，所以同样的上界对严格不等式也成立：\n$$\n\\mathbb{P}\\left(\\left|\\Delta p\\right|\\epsilon\\right) \\le 2 \\exp\\!\\left(-2 N \\epsilon^{2}\\right).\n$$\n这个上界只取决于 $N$ 和 $\\epsilon$，并且对于所有 $p_{0}\\in(0,1)$ 一致成立。", "answer": "$$\\boxed{2\\exp\\!\\left(-2N\\epsilon^{2}\\right)}$$", "id": "1336267"}, {"introduction": "许多随机过程，尤其是算法分析，涉及到的变量序列并非相互独立，这正是阿祖马-霍夫丁不等式大显身手的领域。本练习 [@problem_id:1336225] 将带你分析经典的随机化快速排序算法，其比较次数的随机性依赖于每一步主元（pivot）的选择。你将学习如何将算法的执行过程构建成一个鞅，并利用阿祖马-霍夫丁不等式为其性能提供强有力的理论保证。", "problem": "一位软件工程师正在分析一个遗留数据处理系统的性能。该系统的一个核心组件使用随机快速排序算法对大批量的唯一数值作业标识符进行排序。整个系统的性能对排序步骤中执行的关键比较次数高度敏感。\n\n考虑对一个包含 $n$ 个不同元素的列表运行一次随机快速排序算法。令 $C$ 为关键比较的总次数，它是一个随机变量。工程师的目标是建立一个稳健的性能保证。\n\n为此分析，您将获得以下信息：\n1.  待排序的元素数量为 $n = 40000$。\n2.  比较次数的期望值 $\\mu$ 由公式 $\\mu = 2n \\ln(n)$ 给出，其中 $\\ln$ 表示自然对数。\n3.  $C$ 的概率行为可以使用某种形式的 Azuma-Hoeffding 不等式进行界定。对于排序过程的一个合适的鞅表示，其一步差分的平方和的上界为 $\\frac{\\pi^2}{6} n^2$。\n4.  要使用的具体不等式是：$P(|C - \\mu| \\ge t) \\le 2 \\exp\\left(-\\frac{t^2}{B}\\right)$，其中 $t  0$ 且 $B$ 是第3点中提到的一步差分平方和的上界。\n\n一份新的服务水平协议 (SLA) 要求，比较次数 $C$ 超出其均值 $\\mu$ 的某个分数 $\\lambda$ 倍的概率必须极小。具体来说，要求是 $P(C - \\mu  \\lambda \\mu) \\le 10^{-12}$。\n\n确定满足此 SLA 的无量纲分式偏差 $\\lambda$ 的最小值。将您的最终答案四舍五入到三位有效数字。", "solution": "我们已知对 $n$ 个不同元素进行单次随机快速排序，其总比较次数为 $C$，均值为 $\\mu=2n\\ln(n)$，并有一个 Azuma-Hoeffding 类型的尾部界\n$$\nP\\!\\left(|C-\\mu|\\ge t\\right)\\le 2\\exp\\!\\left(-\\frac{t^{2}}{B}\\right),\n$$\n其中 $B$ 受一步差分平方和的限制，此处 $B=\\frac{\\pi^{2}}{6}n^{2}$。\n\nSLA 要求\n$$\nP\\!\\left(C-\\mu\\lambda\\mu\\right)\\le 10^{-12}.\n$$\n由于 $P(C-\\mu\\lambda\\mu)\\le P(|C-\\mu|\\ge \\lambda\\mu)$，我们只需强制执行\n$$\nP\\!\\left(|C-\\mu|\\ge \\lambda\\mu\\right)\\le 10^{-12}.\n$$\n根据给定的不等式，\n$$\nP\\!\\left(|C-\\mu|\\ge \\lambda\\mu\\right)\\le 2\\exp\\!\\left(-\\frac{\\lambda^{2}\\mu^{2}}{B}\\right).\n$$\n因此，SLA 的一个充分条件是\n$$\n2\\exp\\!\\left(-\\frac{\\lambda^{2}\\mu^{2}}{B}\\right)\\le 10^{-12}.\n$$\n取自然对数并重新整理可得\n$$\n-\\frac{\\lambda^{2}\\mu^{2}}{B}+\\ln 2\\le -12\\ln 10\n\\quad\\Longrightarrow\\quad\n\\frac{\\lambda^{2}\\mu^{2}}{B}\\ge 12\\ln 10+\\ln 2,\n$$\n所以\n$$\n\\lambda^{2}\\ge \\frac{B}{\\mu^{2}}\\left(12\\ln 10+\\ln 2\\right).\n$$\n使用 $\\mu=2n\\ln n$ 和 $B=\\frac{\\pi^{2}}{6}n^{2}$，\n$$\n\\frac{B}{\\mu^{2}}\n=\\frac{\\frac{\\pi^{2}}{6}n^{2}}{\\left(2n\\ln n\\right)^{2}}\n=\\frac{\\pi^{2}}{24(\\ln n)^{2}}.\n$$\n因此，满足条件的最小 $\\lambda$ 为\n$$\n\\lambda=\\frac{\\pi}{\\ln n}\\sqrt{\\frac{12\\ln 10+\\ln 2}{24}}.\n$$\n对于 $n=40000$，我们有 $\\ln n=\\ln(4\\times 10^{4})=\\ln 4+4\\ln 10$。代入数值，\n$$\n\\ln 2\\approx 0.6931471806,\\quad \\ln 10\\approx 2.302585093,\\quad \\ln 4=2\\ln 2\\approx 1.386294361,\n$$\n所以\n$$\n\\ln n\\approx 1.386294361+4\\times 2.302585093\\approx 10.596634733,\n$$\n且\n$$\n\\lambda\\approx \\frac{\\pi}{10.596634733}\\sqrt{\\frac{12\\ln 10+\\ln 2}{24}}\n\\approx 0.296470788\\times 1.086357989\\approx 0.322073409.\n$$\n四舍五入到三位有效数字，得到 $0.322$。", "answer": "$$\\boxed{0.322}$$", "id": "1336225"}, {"introduction": "阿祖马-霍夫丁不等式的核心思想——有界差分法——可以推广到更广泛的情境，形成了强大的麦克迪尔米德不等式（McDiarmid's inequality）。这个工具能够处理多个独立随机变量的复杂函数，而不仅仅是简单的加和。在这个挑战中 [@problem_id:1345075]，我们将分析一个随机增长树的维纳指数（Wiener index），它是一个复杂的全局图属性，你将练习如何通过分析单个随机决策的局部影响来为这个复杂量提供浓度界限，这展示了该不等式在随机组合结构分析中的威力。", "problem": "一个顶点集为 $V=\\{1, 2, \\dots, n\\}$ 的随机递归树 $T_n$ 的构造如下：该树从单个顶点 $T_1$ 开始。对于 $k=2, 3, \\dots, n$，树 $T_k$ 是在 $T_{k-1}$ 的基础上，通过添加顶点 $k$ 以及一条连接 $k$ 与从集合 $\\{1, 2, \\dots, k-1\\}$ 中均匀随机选择的一个父顶点的边而形成的。\n\n图 $G$ 的维纳指数（Wiener index），记为 $W(G)$，是所有无序的不同顶点对之间最短路径距离的总和。也就是说，$W(G) = \\sum_{\\{u,v\\} \\subseteq V} d(u,v)$，其中 $d(u,v)$ 是 $u$ 和 $v$ 之间最短路径上的边数。\n\n令 $W(T_n)$ 为一个具有 $n$ 个顶点的随机递归树的维纳指数。推导概率 $P(|W(T_n) - \\mathbb{E}[W(T_n)]| \\geq t)$ 的一个上界，其中 $t  0$。你的最终答案应该是一个用 $n$ 和 $t$ 表示的封闭形式表达式。", "solution": "问题要求的是随机递归树维纳指数的集中不等式。该随机过程由 $n-1$ 个独立的随机选择序列决定：对于每个顶点 $k \\in \\{2, \\dots, n\\}$，我们从 $\\{1, \\dots, k-1\\}$ 中均匀选择一个父顶点 $J_k$。维纳指数 $W(T_n)$ 是这 $n-1$ 个随机变量的函数，$W(T_n) = f(J_2, J_3, \\dots, J_n)$。\n\n我们可以使用麦克迪尔米德不等式（McDiarmid's inequality）来界定 $W(T_n)$ 与其期望值的偏差。麦克迪尔米德不等式指出，如果一个关于独立随机变量的函数 $f(X_1, \\dots, X_m)$ 满足有界差分性质，\n$$\n\\sup_{x_1, \\dots, x_m, x'_i} |f(x_1, \\dots, x_i, \\dots, x_m) - f(x_1, \\dots, x'_i, \\dots, x_m)| \\leq c_i\n$$\n对于每个 $i \\in \\{1, \\dots, m\\}$ 成立，那么对于任意 $t  0$，\n$$\nP(|f(X_1, \\dots, X_m) - \\mathbb{E}[f]| \\geq t) \\leq 2 \\exp\\left(-\\frac{2t^2}{\\sum_{i=1}^m c_i^2}\\right).\n$$\n\n在我们的问题中，变量是 $J_2, \\dots, J_n$。我们需要找到对于 $k=2, \\dots, n$ 的界 $c_k$。常数 $c_k$ 是在保持所有其他父顶点选择不变的情况下，仅改变顶点 $k$ 的父顶点时，维纳指数 $W(T_n)$ 可能产生的最大变化。\n\n让我们固定所有 $i \\in \\{2, \\dots, n\\} \\setminus \\{k\\}$ 的父顶点选择 $J_i$。这定义了树 $T_{k-1}$ 的结构，并指定了所有顶点 $i  k$ 将如何连接到正在生长的树上。设 $T$ 是当顶点 $k$ 连接到父顶点 $j_a \\in \\{1, \\dots, k-1\\}$ 时得到的树，设 $T'$ 是当 $k$ 连接到另一个父顶点 $j_b \\in \\{1, \\dots, k-1\\}$ 时得到的树。树 $T$ 和 $T'$ 有相同的顶点集，且仅有一条边不同：$(k, j_a) \\in E(T)$ 且 $(k, j_b) \\in E(T')$。\n\n我们想要界定 $|W(T) - W(T')|$。从 $T$ 中移除边 $(k, j_a)$ 会将树分成两个连通分量。一个分量是以 $k$ 为根的子树，我们称之为 $S_k$。这个子树包含顶点 $k$ 本身，以及所有从 $i$ 到根集 $\\{1, \\dots, k-1\\}$ 的路径经过 $k$ 的顶点 $ik$。另一个分量是 $T \\setminus S_k$。在 $T'$ 中，子树 $S_k$ 连接到顶点 $j_b$ 而不是 $j_a$。\n\n两个顶点都在 $S_k$ 中或都在 $T \\setminus S_k$ 中的顶点对之间的距离保持不变。维纳指数的变化来自于一个顶点在 $S_k$ 中、另一个在 $T \\setminus S_k$ 中的顶点对。\n设 $u \\in S_k$ 且 $v \\in T \\setminus S_k$。\n在 $T$ 中，从 $u$ 到 $v$ 的路径经过边 $(k, j_a)$。因此，$d_T(u,v) = d_{S_k}(u,k) + 1 + d_{T \\setminus S_k}(j_a, v)$。\n在 $T'$ 中，从 $u$ 到 $v$ 的路径经过边 $(k, j_b)$。因此，$d_{T'}(u,v) = d_{S_k}(u,k) + 1 + d_{T \\setminus S_k}(j_b, v)$。\n注意图 $T \\setminus S_k$ 和 $T' \\setminus S_k$ 是相同的。\n\n维纳指数的总变化为：\n$$\n\\Delta W = W(T) - W(T') = \\sum_{u \\in S_k} \\sum_{v \\in T \\setminus S_k} (d_T(u,v) - d_{T'}(u,v))\n$$\n$$\n\\Delta W = \\sum_{u \\in S_k} \\sum_{v \\in T \\setminus S_k} (d_{T \\setminus S_k}(j_a,v) - d_{T \\setminus S_k}(j_b,v))\n$$\n$$\n\\Delta W = |S_k| \\sum_{v \\in T \\setminus S_k} (d_{T \\setminus S_k}(j_a,v) - d_{T \\setminus S_k}(j_b,v))\n$$\n为了界定 $|\\Delta W|$，我们使用距离的三角不等式：$|d(j_a,v) - d(j_b,v)| \\le d(j_a,j_b)$。距离 $d(j_a, j_b)$ 是在图 $T\\setminus S_k$ 中计算的。由于 $j_a, j_b \\in \\{1,\\dots, k-1\\}$，它们之间的路径完全位于由 $\\{1,\\dots, k-1\\}$ 导出的子图中，也就是 $T_{k-1}$。\n$$\n|\\Delta W| \\leq |S_k| \\sum_{v \\in T \\setminus S_k} |d_{T \\setminus S_k}(j_a,v) - d_{T \\setminus S_k}(j_b,v)| \\leq |S_k| \\sum_{v \\in T \\setminus S_k} d_{T_{k-1}}(j_a,j_b)\n$$\n$$\n|\\Delta W| \\leq |S_k| |V(T \\setminus S_k)| d_{T_{k-1}}(j_a,j_b) = |S_k| (n - |S_k|) d_{T_{k-1}}(j_a,j_b).\n$$\n为了找到 $c_k$，我们必须在所有可能的配置上最大化这个量。决定 $S_k$ 的连接选择与决定 $T_{k-1}$ 的选择是独立的。\n我们分别最大化每一项：\n1.  $\\max d_{T_{k-1}}(j_a, j_b)$：在一个有 $k-1$ 个顶点的树中，任意两个顶点之间的最大距离（即其直径）最多为 $k-2$。当 $T_{k-1}$ 是一个路径图且 $j_a, j_b$ 是其端点时，达到这个最大值。\n2.  $\\max_{|S_k|} |S_k|(n - |S_k|)$：子树 $S_k$ 的大小范围可以从 1 到 $n-k+1$。函数 $x(n-x)$ 在 $x=n/2$ 时最大化。因此， $|S_k|(n-|S_k|) \\leq \\frac{n^2}{4}$。\n\n结合这些界，我们得到最坏情况下的变化 $c_k$：\n$$\nc_k \\leq \\frac{n^2}{4}(k-2).\n$$\n现在我们计算麦克迪尔米德不等式的平方和：\n$$\n\\sum_{k=2}^{n} c_k^2 \\leq \\sum_{k=2}^{n} \\left(\\frac{n^2}{4}(k-2)\\right)^2 = \\frac{n^4}{16} \\sum_{k=2}^{n} (k-2)^2.\n$$\n令 $j=k-2$。该和变为：\n$$\n\\sum_{j=0}^{n-2} j^2 = \\frac{(n-2)((n-2)+1)(2(n-2)+1)}{6} = \\frac{(n-2)(n-1)(2n-3)}{6}.\n$$\n所以，差的平方和的界为：\n$$\n\\sum_{k=2}^{n} c_k^2 \\leq \\frac{n^4}{16} \\frac{(n-2)(n-1)(2n-3)}{6} = \\frac{n^4(n-1)(n-2)(2n-3)}{96}.\n$$\n将此代入麦克迪尔米德不等式，我们得到最终的概率界：\n$$\nP(|W(T_n) - \\mathbb{E}[W(T_n)]| \\geq t) \\leq 2 \\exp\\left(-\\frac{2t^2}{\\frac{n^4(n-1)(n-2)(2n-3)}{96}}\\right)\n$$\n$$\nP(|W(T_n) - \\mathbb{E}[W(T_n)]| \\geq t) \\leq 2 \\exp\\left(-\\frac{192 t^2}{n^4(n-1)(n-2)(2n-3)}\\right).\n$$\n该公式要非退化，问题只在 $n \\ge 3$ 时有效。对于 $n=2$，平方和为0。我们假设 $n \\ge 3$。", "answer": "$$\\boxed{2\\exp\\left(-\\frac{192t^{2}}{n^{4}(n-1)(n-2)(2n-3)}\\right)}$$", "id": "1345075"}]}