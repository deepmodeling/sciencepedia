{"hands_on_practices": [{"introduction": "本练习将探讨条件期望的一个基本应用：当已知某个事件发生时，我们如何更新对另一个随机变量的期望。我们将通过一个具体问题 [@problem_id:1350718]，分析在给定一组随机变量的最小值的条件下，其最大值的期望会如何变化。这个例子清晰地展示了条件如何改变了我们分析问题的样本空间，是将抽象概念应用于实际计算的绝佳起点。", "problem": "考虑两个独立同分布 (i.i.d.) 的随机变量 $X_1$ 和 $X_2$。每个变量都服从整数集合 $\\{1, 2, \\dots, M\\}$ 上的离散均匀分布，其中 $M$ 是一个大于2的整数。令 $Y = \\max(X_1, X_2)$ 为这两个变量的最大值， $Z = \\min(X_1, X_2)$ 为最小值。\n\n给定最小值 $Z$ 严格大于一个整数 $k$（其中 $1 \\le k  M-1$），求最大值的条件期望 $E[Y | Z  k]$ 的一个闭式表达式。你的最终表达式应以 $M$ 和 $k$ 表示。", "solution": "问题要求的是条件期望 $E[Y | Z  k]$，其中 $Y = \\max(X_1, X_2)$，$Z = \\min(X_1, X_2)$，且 $X_1, X_2$ 是在 $\\{1, 2, \\dots, M\\}$ 上均匀分布的独立同分布随机变量。\n\n条件 $Z  k$ 意味着 $\\min(X_1, X_2)  k$。这等价于事件 $X_1  k$ 和 $X_2  k$ 同时发生。在此条件下，每个随机变量的样本空间被限制在整数集合 $\\{k+1, k+2, \\dots, M\\}$ 内。此集合中可能的结果数量为 $M-k$。\n\n我们定义新的随机变量 $X_1^*$ 和 $X_2^*$，表示在条件 $Z  k$ 下 $X_1$ 和 $X_2$ 的值。这些条件变量是独立的，并且在集合 $\\{k+1, k+2, \\dots, M\\}$ 上均匀分布。因此，问题等价于求这两个新变量最大值的期望，即 $E[\\max(X_1^*, X_2^*)]$。\n\n为了简化计算，我们可以进行一个线性变换。我们定义另一组变量 $X'_i = X_i^* - k$，其中 $i=1,2$。这些变量 $X'_1$ 和 $X'_2$ 是独立同分布的，并且服从集合 $\\{1, 2, \\dots, M-k\\}$ 上的离散均匀分布。我们用 $M' = M-k$ 表示这个新样本空间的大小。所以，$X'_i \\sim U\\{1, 2, \\dots, M'\\}$。\n\n条件变量的最大值与变换后变量的最大值相关：\n$\\max(X_1^*, X_2^*) = \\max(X'_1+k, X'_2+k) = \\max(X'_1, X'_2) + k$。\n令 $Y' = \\max(X'_1, X'_2)$。根据期望的线性性，我们有：\n$E[Y | Z  k] = E[\\max(X_1^*, X_2^*)] = E[Y' + k] = E[Y'] + k$。\n\n我们现在的任务是计算 $E[Y']$，即从 $U\\{1, 2, \\dots, M'\\}$ 中抽取的两个独立同分布变量的最大值的期望。\n对于一个非负整值随机变量，其期望可以用以下公式计算：\n$E[Y'] = \\sum_{j=0}^{\\infty} P(Y'  j)$。\n由于 $Y'$ 的最大可能值为 $M'$，该求和变为：\n$E[Y'] = \\sum_{j=0}^{M'-1} P(Y'  j)$。\n\n我们可以将 $P(Y'  j)$ 表示为 $1 - P(Y' \\le j)$。项 $P(Y' \\le j)$ 是 $Y'$ 的累积分布函数 (CDF)，我们称之为 $F_{Y'}(j)$。\n$F_{Y'}(j) = P(Y' \\le j) = P(\\max(X'_1, X'_2) \\le j)$。\n这等价于 $P(X'_1 \\le j \\text{ and } X'_2 \\le j)$。由于 $X'_1$ 和 $X'_2$ 是独立的：\n$F_{Y'}(j) = P(X'_1 \\le j) \\cdot P(X'_2 \\le j)$。\n\n对于一个在 $\\{1, \\dots, M'\\}$ 上的离散均匀变量 $X'_i$，对于范围 $1 \\le j \\le M'$ 内的整数 $j$，其概率 $P(X'_i \\le j)$ 为 $\\frac{j}{M'}$。\n因此，$Y'$ 的累积分布函数为 $F_{Y'}(j) = \\left(\\frac{j}{M'}\\right)^2$，其中 $j \\in \\{1, \\dots, M'\\}$。注意 $F_{Y'}(0) = 0$。\n\n现在我们可以计算期望：\n$E[Y'] = \\sum_{j=0}^{M'-1} (1 - F_{Y'}(j)) = \\sum_{j=0}^{M'-1} \\left(1 - \\left(\\frac{j}{M'}\\right)^2\\right)$。\n我们可以拆分这个和：\n$E[Y'] = \\sum_{j=0}^{M'-1} 1 - \\sum_{j=0}^{M'-1} \\left(\\frac{j}{M'}\\right)^2 = M' - \\frac{1}{(M')^2} \\sum_{j=0}^{M'-1} j^2$。\n\n前 $N$ 个平方数的和由公式 $\\sum_{j=1}^{N} j^2 = \\frac{N(N+1)(2N+1)}{6}$ 给出。我们需要求和到 $M'-1$，所以我们设 $N=M'-1$：\n$\\sum_{j=1}^{M'-1} j^2 = \\frac{(M'-1)((M'-1)+1)(2(M'-1)+1)}{6} = \\frac{(M'-1)M'(2M'-1)}{6}$。\n由于 $j=0$ 项为零，所以 $\\sum_{j=0}^{M'-1} j^2 = \\sum_{j=1}^{M'-1} j^2$。\n\n将此代回到 $E[Y']$ 的表达式中：\n$E[Y'] = M' - \\frac{1}{(M')^2} \\left( \\frac{(M'-1)M'(2M'-1)}{6} \\right)$。\n$E[Y'] = M' - \\frac{(M'-1)(2M'-1)}{6M'}$。\n\n为了简化，我们通分：\n$E[Y'] = \\frac{6(M')^2 - (M'-1)(2M'-1)}{6M'} = \\frac{6(M')^2 - (2(M')^2 - 3M' + 1)}{6M'} = \\frac{4(M')^2 + 3M' - 1}{6M'}$。\n分子可以因式分解为 $(4M'-1)(M'+1)$。\n所以，$E[Y'] = \\frac{(4M'-1)(M'+1)}{6M'}$。\n\n最后，我们将此结果代回到我们最初的条件期望方程中，并记住 $M' = M-k$：\n$E[Y | Z  k] = E[Y'] + k = \\frac{(4M'-1)(M'+1)}{6M'} + k$。\n$E[Y | Z  k] = \\frac{(4(M-k)-1)((M-k)+1)}{6(M-k)} + k$。\n\n这就是条件期望的最终闭式表达式。", "answer": "$$\\boxed{\\frac{(4(M-k)-1)(M-k+1)}{6(M-k)} + k}$$", "id": "1350718"}, {"introduction": "在许多科学和工程模型中，我们经常遇到对一个随机数量的随机变量求和的情况。本练习 [@problem_id:1350716] 将引导我们使用全期望定律（或称重期望定律）来解决此类问题。通过在一个假设的量子隧穿场景中计算总光子数的条件期望，我们将学会如何通过对一个中间随机变量（例如，尝试次数）进行条件化来分解复杂问题，并领略几何分布的“无记忆性”这一重要性质的应用。", "problem": "在一个简化的量子隧穿模型中，一个粒子进行一系列尝试以穿过一个势垒。在粒子成功隧穿之前，其尝试的总次数 $N$ 是一个随机变量，服从几何分布，其概率质量函数为 $P(N=n) = (1-p)^{n-1}p$，其中 $n = 1, 2, 3, \\dots$，$p$ 是单次尝试成功隧穿的概率。\n\n在每次尝试 $i$（其中 $i=1, 2, \\dots, N$）中，粒子会发射若干“探测”光子，记为 $X_i$。在不同尝试中发射的光子数是独立同分布 (i.i.d.) 的随机变量，其中每个 $X_i$ 服从均值为 $\\lambda$ 的泊松分布。在整个过程中发射的光子总数为 $S_N = \\sum_{i=1}^{N} X_i$。\n\n进行了一项实验，但由于早期探测系统的限制，我们只知道该粒子在前 $k$ 次尝试中均未成功隧穿。具体来说，我们得到的条件是 $N  k$。\n\n基于此信息，求粒子最终成功隧穿时所发射的探测光子的期望总数 $E[S_N | N  k]$。请用 $p$、$\\lambda$ 和 $k$ 将你的答案表示为单个闭式解析表达式。", "solution": "我们需要计算条件期望 $E[S_{N} \\mid Nk]$，其中 $S_{N}=\\sum_{i=1}^{N}X_{i}$，$X_{i}$ 是均值为 $\\lambda$ 的独立同分布泊松随机变量，而 $N$ 服从几何分布，其概率为 $P(N=n)=(1-p)^{n-1}p$，对于 $n\\in\\{1,2,\\dots\\}$。$X_{i}$ 与 $N$ 相互独立。\n\n根据全期望定律以及 $\\{X_{i}\\}$ 和 $N$ 的独立性，\n$$\nE[S_{N} \\mid Nk]\n= E\\!\\left[\\,E\\!\\left[\\sum_{i=1}^{N}X_{i}\\,\\middle|\\,N,\\,Nk\\right] \\middle| Nk\\right]\n= E\\!\\left[\\,E\\!\\left[\\sum_{i=1}^{N}X_{i}\\,\\middle|\\,N\\right] \\middle| Nk\\right].\n$$\n给定 $N$，我们有\n$$\nE\\!\\left[\\sum_{i=1}^{N}X_{i}\\,\\middle|\\,N\\right] = \\sum_{i=1}^{N}E[X_{i}] = N\\,\\lambda,\n$$\n所以\n$$\nE[S_{N} \\mid Nk] = E[N\\lambda \\mid Nk] = \\lambda\\,E[N \\mid Nk].\n$$\n\n我们现在计算 $E[N \\mid Nk]$。对于 $nk$，\n$$\nP(N=n \\mid Nk) = \\frac{P(N=n)}{P(Nk)} = \\frac{(1-p)^{n-1}p}{(1-p)^{k}} = (1-p)^{n-k-1}p.\n$$\n因此，在 $Nk$ 的条件下，$N-k$ 服从参数为 $p$ 且定义域为 $\\{1,2,\\dots\\}$ 的几何分布。因此\n$$\nE[N \\mid Nk] = k + E[N-k \\mid Nk] = k + \\frac{1}{p}.\n$$\n为了完整起见，这可以通过求和来验证。令 $q=1-p$。那么\n$$\nE[N \\mid Nk] = \\sum_{n=k+1}^{\\infty} n\\, q^{\\,n-k-1} p\n= \\sum_{m=1}^{\\infty} (k+m)\\, q^{\\,m-1} p\n= k \\sum_{m=1}^{\\infty} q^{\\,m-1} p + \\sum_{m=1}^{\\infty} m\\, q^{\\,m-1} p.\n$$\n使用几何级数恒等式\n$$\n\\sum_{m=1}^{\\infty} q^{\\,m-1} p = p \\sum_{m=0}^{\\infty} q^{m} = \\frac{p}{1-q} = 1,\n$$\n和\n$$\n\\sum_{m=1}^{\\infty} m\\, q^{\\,m-1} p = p \\frac{\\mathrm{d}}{\\mathrm{d}q} \\left(\\sum_{m=1}^{\\infty} q^{m}\\right)\n= p \\frac{\\mathrm{d}}{\\mathrm{d}q} \\left(\\frac{q}{1-q}\\right)\n= \\frac{p}{(1-q)^{2}} = \\frac{1}{p},\n$$\n我们得到 $E[N \\mid Nk] = k + \\frac{1}{p}$。\n\n所以，\n$$\nE[S_{N} \\mid Nk] = \\lambda \\left(k + \\frac{1}{p}\\right).\n$$", "answer": "$$\\boxed{\\lambda\\left(k+\\frac{1}{p}\\right)}$$", "id": "1350716"}, {"introduction": "最后一个练习将介绍一种用于解决“等待时间”问题的强大技巧。当一个过程随时间演进时，我们可以通过定义代表“进展”的不同状态来分析它。在本问题 [@problem_id:1350734] 中，我们将计算在已经看到部分序列的情况下，还需要多少次抛硬币才能得到一个特定序列。我们将构建一个关于条件期望的方程组，该方法是通向理解更复杂的随机过程的重要一步。", "problem": "一枚公平的硬币被重复抛掷，出现正面（H）和反面（T）的概率相等。一位观察者在等待特定的五次抛掷序列 `HTHTH` 首次出现。\n\n假设在一次实验中，前三次抛掷已经发生，其结果依次为 H、T 和 H。计算从此刻起，为了首次观察到完整序列 `HTHTH` 所需的*额外*抛掷次数的期望值。", "solution": "设目标序列为 $S = \\text{HTHTH}$。我们可以通过定义状态来解决这个问题，这些状态对应于我们最近观察到的 $S$ 的前缀的长度。设 $E_p$ 为在已知最后几次抛掷已形成 $S$ 的前缀 $p$ 的情况下，要看到完整序列 $S$ 所需的额外抛掷次数的期望值。具有空前缀的状态表示为 $E_{\\emptyset}$。问题要求的是在已经观察到 'HTH' 的情况下所需的额外抛掷次数的期望值，这对应于 $E_{\\text{HTH}}$ 的值。\n\n$S$ 的可能前缀有 'H'、'HT'、'HTH' 和 'HTHT'。我们定义以下期望值：\n- $E_{\\emptyset}$：在最后一次抛掷序列不是 $S$ 的前缀的情况下，所需的额外抛掷次数的期望值。\n- $E_{\\text{H}}$：在最后一次抛掷是 'H' 的情况下，所需的额外抛掷次数的期望值。\n- $E_{\\text{HT}}$：在最后两次抛掷是 'HT' 的情况下，所需的额外抛掷次数的期望值。\n- $E_{\\text{HTH}}$：在最后三次抛掷是 'HTH' 的情况下，所需的额外抛掷次数的期望值。\n- $E_{\\text{HTHT}}$：在最后四次抛掷是 'HTHT' 的情况下，所需的额外抛掷次数的期望值。\n\n当观察到完整序列 'HTHTH' 时，过程停止，因此所需的额外抛掷次数的期望值变为 0。\n\n我们可以通过考虑从每个状态出发下一次抛掷的结果来建立一个线性方程组。每次抛掷花费1次试验。由于硬币是公平的，$P(H) = P(T) = 1/2$。\n\n1.  从状态 $\\emptyset$：我们抛掷硬币。\n    - 如果是 H（概率 1/2），我们现在匹配了前缀 'H'。新状态是 'H'。\n    - 如果是 T（概率 1/2），我们观察到了 'T'，它不是 $S$ 的前缀。当前匹配的前缀仍然为空。\n    所以，$E_{\\emptyset} = 1 + \\frac{1}{2}E_{\\text{H}} + \\frac{1}{2}E_{\\emptyset} \\implies \\frac{1}{2}E_{\\emptyset} = 1 + \\frac{1}{2}E_{\\text{H}} \\implies E_{\\emptyset} = 2 + E_{\\text{H}}$。\n\n2.  从状态 'H'：我们已有 'H'，然后再次抛掷。\n    - 如果是 T（概率 1/2），我们得到 'HT'，匹配了长度为 2 的前缀。新状态是 'HT'。\n    - 如果是 H（概率 1/2），我们得到 'HH'。'HH' 的最长后缀中，同时是 $S$ 的前缀的是 'H'。所以我们返回状态 'H'。\n    所以，$E_{\\text{H}} = 1 + \\frac{1}{2}E_{\\text{HT}} + \\frac{1}{2}E_{\\text{H}} \\implies \\frac{1}{2}E_{\\text{H}} = 1 + \\frac{1}{2}E_{\\text{HT}} \\implies E_{\\text{H}} = 2 + E_{\\text{HT}}$。\n\n3.  从状态 'HT'：我们已有 'HT'，然后再次抛掷。\n    - 如果是 H（概率 1/2），我们得到 'HTH'，匹配了长度为 3 的前缀。新状态是 'HTH'。\n    - 如果是 T（概率 1/2），我们得到 'HTT'。'HTT' 的最长后缀中，同时是 $S$ 的前缀的是空字符串。我们返回状态 $\\emptyset$。\n    所以，$E_{\\text{HT}} = 1 + \\frac{1}{2}E_{\\text{HTH}} + \\frac{1}{2}E_{\\emptyset}$。\n\n4.  从状态 'HTH'：我们已有 'HTH'，然后再次抛掷。这是我们开始时的状态。\n    - 如果是 T（概率 1/2），我们得到 'HTHT'，匹配了长度为 4 的前缀。新状态是 'HTHT'。\n    - 如果是 H（概率 1/2），我们得到 'HTHH'。'HTHH' 的最长后缀中，同时是 $S$ 的前缀的是 'H'。我们返回状态 'H'。\n    所以，$E_{\\text{HTH}} = 1 + \\frac{1}{2}E_{\\text{HTHT}} + \\frac{1}{2}E_{\\text{H}}$。\n\n5.  从状态 'HTHT'：我们已有 'HTHT'，然后再次抛掷。\n    - 如果是 H（概率 1/2），我们得到 'HTHTH'，这是完整的序列。过程停止。所需的额外抛掷次数的期望值为 0。\n    - 如果是 T（概率 1/2），我们得到 'HTHTT'。'HTHTT' 的最长后缀中，同时是 $S$ 的前缀的是空字符串。我们返回状态 $\\emptyset$。\n    所以，$E_{\\text{HTHT}} = 1 + \\frac{1}{2}(0) + \\frac{1}{2}E_{\\emptyset} \\implies E_{\\text{HTHT}} = 1 + \\frac{1}{2}E_{\\emptyset}$。\n\n我们得到了一个包含五个线性方程的方程组。我们需要求解的值是 $E_{\\text{HTH}}$。\n我们来解这个方程组：\n(i) $E_{\\emptyset} = 2 + E_{\\text{H}}$\n(ii) $E_{\\text{H}} = 2 + E_{\\text{HT}}$\n(iii) $E_{\\text{HT}} = 1 + \\frac{1}{2}E_{\\text{HTH}} + \\frac{1}{2}E_{\\emptyset}$\n(iv) $E_{\\text{HTH}} = 1 + \\frac{1}{2}E_{\\text{HTHT}} + \\frac{1}{2}E_{\\text{H}}$\n(v) $E_{\\text{HTHT}} = 1 + \\frac{1}{2}E_{\\emptyset}$\n\n从 (ii) 式，我们可以写出 $E_{\\text{HT}} = E_{\\text{H}} - 2$。\n将 (i) 式代入 (v) 式：\n$E_{\\text{HTHT}} = 1 + \\frac{1}{2}(2 + E_{\\text{H}}) = 1 + 1 + \\frac{1}{2}E_{\\text{H}} = 2 + \\frac{1}{2}E_{\\text{H}}$。\n\n现在将这些表达式代入 (iii) 和 (iv) 式，以得到一个关于 $E_{\\text{H}}$ 和 $E_{\\text{HTH}}$ 的方程组。\n代入 (iii) 式：\n$E_{\\text{HT}} = 1 + \\frac{1}{2}E_{\\text{HTH}} + \\frac{1}{2}E_{\\emptyset}$\n$E_{\\text{H}} - 2 = 1 + \\frac{1}{2}E_{\\text{HTH}} + \\frac{1}{2}(2 + E_{\\text{H}})$\n$E_{\\text{H}} - 2 = 1 + \\frac{1}{2}E_{\\text{HTH}} + 1 + \\frac{1}{2}E_{\\text{H}}$\n$E_{\\text{H}} - 2 = 2 + \\frac{1}{2}E_{\\text{HTH}} + \\frac{1}{2}E_{\\text{H}}$\n两边乘以 2 以消去分数：\n$2E_{\\text{H}} - 4 = 4 + E_{\\text{HTH}} + E_{\\text{H}}$\n$E_{\\text{H}} - 8 = E_{\\text{HTH}}$。\n\n代入 (iv) 式：\n$E_{\\text{HTH}} = 1 + \\frac{1}{2}E_{\\text{HTHT}} + \\frac{1}{2}E_{\\text{H}}$\n$E_{\\text{HTH}} = 1 + \\frac{1}{2}(2 + \\frac{1}{2}E_{\\text{H}}) + \\frac{1}{2}E_{\\text{H}}$\n$E_{\\text{HTH}} = 1 + 1 + \\frac{1}{4}E_{\\text{H}} + \\frac{1}{2}E_{\\text{H}}$\n$E_{\\text{HTH}} = 2 + \\frac{3}{4}E_{\\text{H}}$。\n\n现在我们有两个用 $E_{\\text{H}}$ 表示 $E_{\\text{HTH}}$ 的表达式：\n$E_{\\text{HTH}} = E_{\\text{H}} - 8$\n$E_{\\text{HTH}} = 2 + \\frac{3}{4}E_{\\text{H}}$\n\n令它们相等：\n$E_{\\text{H}} - 8 = 2 + \\frac{3}{4}E_{\\text{H}}$\n$E_{\\text{H}} - \\frac{3}{4}E_{\\text{H}} = 2 + 8$\n$\\frac{1}{4}E_{\\text{H}} = 10 \\implies E_{\\text{H}} = 40$。\n\n最后，我们求出所需的值 $E_{\\text{HTH}}$：\n$E_{\\text{HTH}} = E_{\\text{H}} - 8 = 40 - 8 = 32$。\n\n因此，所需的额外抛掷次数的期望值是 32。", "answer": "$$\\boxed{32}$$", "id": "1350734"}]}