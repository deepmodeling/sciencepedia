## 引言
将整数表示为平方数之和是数论中一个古老而迷人的问题，从费马到拉格朗日，数学家们为此贡献了深刻的见解。然而，在二平方和与[四平方和](@entry_id:203455)问题之间，三个[平方数](@entry_id:635622)之和的问题展现出一种独特的复杂性与精致性：并非所有数都能如此表示。本文旨在彻底解决这一疑问，揭示一个整数能够表示为三个[平方数](@entry_id:635622)之和的精确条件。我们将通过三个章节的探索，为读者构建一个完整的知识体系。在“原理与机制”中，我们将深入勒让德三平方数定理的核心，运用[模算术](@entry_id:143700)等基本工具揭示其判定法则。接着，在“应用与跨学科联系”中，我们将跨出纯数学的边界，探索该理论在量子力学、[晶体学](@entry_id:140656)等领域的惊人应用。最后，“动手实践”部分将提供具体的练习，帮助您巩固所学。让我们首先进入第一章，探寻这个问题的基本原理与内在机制。

## 原理与机制

继导论之后，本章将深入探讨一个整数能否表示为三个[平方数](@entry_id:635622)之和的核心问题。我们将从基本原理出发，通过[模算术](@entry_id:143700)等初等方法揭示其内在规律，最终引出精确的判定法则——勒让德三[平方数](@entry_id:635622)定理。此外，我们还会将此问题置于更广阔的数论背景中，探讨其与二平方数和、四平方数和问题的关联，并介绍通往现代研究（如[局部-整体原则](@entry_id:183320)和模形式理论）的深刻视角。

### 基本障碍：模8分析

要判断一个正整数 $n$ 是否能写成三个整数的平方和，即 $n = x^2 + y^2 + z^2$ 的形式，一个强有力的初等工具是**模算术**。通过考察该方程在特定模数下的行为，我们可以发现一些根本性的限制。对于平方和问题，模 $8$ 提供了一个极具启发性的视角。

首先，我们来确定任意整数的平方在模 $8$ 意义下可能有哪些余数。令 $k$ 为一个整数：
-   若 $k$ 是偶数，则 $k=2m$。其平方为 $k^2 = 4m^2$。
    -   若 $m$ 也是偶数，即 $m=2j$，则 $k=4j$，此时 $k^2 = 16j^2 \equiv 0 \pmod{8}$。
    -   若 $m$ 是奇数，即 $m=2j+1$，则 $k=2(2j+1)$，此时 $k^2 = 4(2j+1)^2 = 4(4j^2+4j+1) = 16j^2+16j+4 \equiv 4 \pmod{8}$。
-   若 $k$ 是奇数，则 $k=2m+1$。其平方为 $k^2 = (2m+1)^2 = 4m^2+4m+1 = 4m(m+1)+1$。由于 $m$ 和 $m+1$ 是连续整数，其中必有一个是偶数，故其乘积 $m(m+1)$ 是偶数。令 $m(m+1)=2j$，则 $k^2 = 4(2j)+1 = 8j+1 \equiv 1 \pmod{8}$。

综上所述，任意整数的平方模 $8$ 的余数只可能是 $0, 1$ 或 $4$。
$$ x^2 \pmod{8} \in \{0, 1, 4\} $$

现在，考虑三个[平方数](@entry_id:635622)的和 $n = x^2 + y^2 + z^2$。它模 $8$ 的余数必然是集合 $\{0, 1, 4\}$ 中三个数（可重复）的和。我们可以穷举所有可能的组合：
- $0+0+0 = 0$
- $0+0+1 = 1$
- $0+1+1 = 2$
- $1+1+1 = 3$
- $0+0+4 = 4$
- $0+1+4 = 5$
- $1+1+4 = 6$
- 包含两个或三个 $4$ 的情况（如 $0+4+4=8\equiv 0$，$1+4+4=9\equiv 1$，$4+4+4=12\equiv 4$）不会产生新的余数。

因此，三个平方数之和模 $8$ 的余数集合为 $\{0, 1, 2, 3, 4, 5, 6\}$。

一个至关重要的观察是，**$7$ 不在这个集合中**。这意味着，如果一个整数 $n$ 满足 $n \equiv 7 \pmod{8}$，那么它**不可能**表示为三个整数的平方和。这是一个非常强的必要条件。例如，数字 $7, 15, 23, 31$ 等，它们模 $8$ 的余数都是 $7$，因此它们都不能表示为三个平方数的和 [@problem_id:3089640]。

### 勒让德三平方数定理：完整判据

$n \not\equiv 7 \pmod{8}$ 是一个必要条件，但它是否是充分条件呢？换言之，所有不满足 $n \equiv 7 \pmod{8}$ 的整数都能写成三个平方数的和吗？答案是否定的。考虑 $n=28$ 这个例子。$28 \equiv 4 \pmod{8}$，不属于禁忌的余数类。然而，我们无法找到三个整数 $x,y,z$ 使得 $x^2+y^2+z^2=28$。这表明存在比模 $8$ 同余更微妙的限制。

这个额外的限制与因子 $4$ 有关。考虑一个能表示为[三平方和](@entry_id:637637)的数 $n=x^2+y^2+z^2$，且 $n$ 是 $4$ 的倍数，即 $n \equiv 0 \pmod{4}$。我们知道，一个整数平方模 $4$ 的余数只能是 $0$ (偶数平方) 或 $1$ (奇数平方)。要使三个这样的余数之和为 $0 \pmod{4}$，唯一的可能性是这三个余数都是 $0$。也就是说，$x^2 \equiv 0 \pmod{4}$, $y^2 \equiv 0 \pmod{4}$, $z^2 \equiv 0 \pmod{4}$。这进一步要求 $x, y, z$ 必须都是偶数 [@problem_id:3089660]。

既然 $x,y,z$ 都是偶数，我们可以设 $x=2x'$, $y=2y'$, $z=2z'$。代入方程：
$$ n = (2x')^2 + (2y')^2 + (2z')^2 = 4(x'^2 + y'^2 + z'^2) $$
这意味着 $n/4$ 也必须是三个整数的平方和。这个过程被称为**下降法** (descent)。它揭示了一个重要性质：一个整数 $n$ 能否表示为[三平方和](@entry_id:637637)，与其除以 $4$ 后的商 $n/4$ 的性质完全相同。我们可以反复地从 $n$ 中提出因子 $4$ 而不改变其[可表示性](@entry_id:635277)。

现在，我们可以将模 $8$ 的障碍与因子 $4$ 的下降法结合起来，得到一个完整的判据。假设一个数 $n$ 的形式为 $4^a(8b+7)$，其中 $a,b$ 为非负整数。如果 $n$ 可以表示为三个平方数的和，那么根据下降法，将它除以 $4^a$ 之后得到的数 $n/4^a = 8b+7$ 也必须能表示为三个平方数的和。然而，我们已经证明了任何形如 $8b+7$ 的数都不可能表示为三个平方数的和。这个矛盾说明，我们最初的假设是错误的。

因此，形如 $4^a(8b+7)$ 的数永远不能表示为三个[平方数](@entry_id:635622)的和。事实证明，这个条件不仅是必要的，也是充分的。这就是著名的**勒让德三平方数定理** (Legendre's three-square theorem)：

**一个正整数 $n$ 可以表示为三个整数的平方和，当且仅当 $n$ 不具有 $4^a(8b+7)$ 的形式，其中 $a, b$ 为非负整数。** [@problem_id:3089642]

这个定理提供了一个完整且可操作的算法来判定任意正整数 $n$。我们只需：
1.  反复将 $n$ 除以 $4$，直到得到一个不能被 $4$ 整除的数 $m$。这个 $m$ 被称为 $n$ 的“4-无平方部分”。
2.  检查 $m$ 模 $8$ 的余数。如果 $m \equiv 7 \pmod{8}$，则 $n$ 不能表示为三个[平方数](@entry_id:635622)的和。
3.  否则，$n$ 可以表示为三个[平方数](@entry_id:635622)的和。[@problem_id:3089659]

### 背景与比较：相关的平方和定理

为了更好地理解[三平方和](@entry_id:637637)问题，将其与数论中其他著名的平方和定理进行比较是很有助益的。

#### 与二平方和问题的联系

一种构造性的方法是尝试寻找一个整数 $z$，使得 $n-z^2$ 是两个[平方数](@entry_id:635622)的和。如果成功，即 $n-z^2 = x^2+y^2$，那么我们便找到了一个解 $n=x^2+y^2+z^2$。这个方法的可行性取决于我们能否高效地判断一个数是否为二平方和。幸运的是，这由**费马二平方和定理**给出了完整的解答：

**一个正整数 $m$ 可以表示为两个整数的平方和，当且仅当在其素[因子分解](@entry_id:150389)中，所有形如 $4k+3$ 的素数都以偶数次幂出现。** [@problem_id:3089632]

这个定理源于[高斯整数环](@entry_id:149594) $\mathbb{Z}[i]$ 的算术性质，并揭示了二平方和的集合在乘法下是封闭的。

我们可以利用这个定理来检验[三平方和](@entry_id:637637)的构造方法。例如，对于 $n=2026$，勒让德定理预言它是[三平方和](@entry_id:637637)。我们尝试取 $z=1$，得到 $n-z^2 = 2026-1 = 2025 = 45^2$。由于 $2025 = 3^4 \cdot 5^2$，其唯一的 $4k+3$ 型素因子 $3$ 的幂次是 $4$ (偶数)，因此 $2025$ 是二平方和。事实上，$2025=45^2+0^2$。这样我们便找到了一个解 $2026 = 45^2 + 0^2 + 1^2$。

相反，对于 $n=2023$，由于 $2023 = 8 \cdot 252 + 7$，勒让德定理断言它不是[三平方和](@entry_id:637637)。这意味着对于**任何**整数 $z$，$2023-z^2$ 都**不是**二平方和。我们可以通过模 $8$ 分析再次确认这一点：$z^2 \pmod{8} \in \{0, 1, 4\}$，所以 $2023-z^2 \pmod{8} \in \{7-0, 7-1, 7-4\} = \{7, 6, 3\}$。而二平方和模 $8$ 的余数只能是 $\{0, 1, 2, 4, 5\}$。这两个集合没有交集，因此构造必定失败。[@problem_id:3089644]

#### 与[四平方和](@entry_id:203455)问题的对比

[三平方和](@entry_id:637637)定理的美妙之处在于它揭示了特定算术级数中的数存在表示障碍。与此形成鲜明对比的是**拉格朗日[四平方和](@entry_id:203455)定理**，它断言：

**任何正整数都可以表示为四个整数的平方和。**

为什么增加一个[平方数](@entry_id:635622)会消除所有障碍？我们再次回到模 $8$ 分析。[三平方和](@entry_id:637637)无法构成模 $8$ 余 $7$ 的数。但是，如果允许四个平方数，我们就可以通过添加第四个[平方数](@entry_id:635622)来“补全”这个余数。例如，我们知道 $6$ 是[三平方和](@entry_id:637637)（如 $2^2+1^2+1^2$），加上一个平方数 $1^2$，我们就得到 $6+1=7$。因此，任何模 $8$ 的余数都可以由四个[平方数](@entry_id:635622)的和构成。事实上，拉格朗日定理表明，不存在任何[同余](@entry_id:143700)障碍阻止一个数表示为[四平方和](@entry_id:203455)。[@problem_id:3089668]

### 深层结构与高等视角

勒让德的定理虽然优美，但其“当且仅当”的证明（特别是“当”的部分）相当困难。现代数论为此提供了更深刻的解释框架。

#### [局部-整体原则](@entry_id:183320)

勒让德定理中的条件 $n \neq 4^a(8b+7)$ 可以被理解为一个**局部障碍**。数论中的**[局部-整体原则](@entry_id:183320)** (Local-Global Principle)，特别是**哈斯-[闵可夫斯基定理](@entry_id:204587)** (Hasse-Minkowski Theorem)，指出一个有理[数域](@entry_id:155558)上的二次型方程有解，当且仅当它在所有“[局部域](@entry_id:195717)”——[实数域](@entry_id:151347) $\mathbb{R}$ 和所有 $p$-进[数域](@entry_id:155558) $\mathbb{Q}_p$ ——中都有解。

对于[三平方和](@entry_id:637637)问题，更强的结论成立：一个整数 $n$ 有**整数解**，当且仅当它在 $\mathbb{R}$ 和所有 $p$-进整数环 $\mathbb{Z}_p$ 中有整数解。
-   在 $\mathbb{R}$ 中有解的条件是 $n \ge 0$。
-   在 $\mathbb{Z}_p$ (对于奇素数 $p$) 中有解总是成立的，没有障碍。
-   唯一的障碍出现在 $\mathbb{Z}_2$ 中：方程 $x^2+y^2+z^2=n$ 在 $\mathbb{Z}_2$ 中有解的充要条件，恰好就是 $n$ 不具有 $4^a(8b+7)$ 的形式。

因此，勒让德定理中的算术条件，从更深的层面看，是唯一存在的局部障碍（在素数 $2$ 处）的体现。[@problem_id:3089676]

#### 本原表示

一个表示 $n=x^2+y^2+z^2$ 被称为**本原的** (primitive)，如果 $\gcd(x,y,z)=1$。如果一个数 $n$ 的表示都不是本原的，那么 $\gcd(x,y,z)=d>1$，这意味着 $d^2$ 是 $n$ 的一个因子，且 $n/d^2$ 可以由一个本原表示写出。特别地，如果一个可表示的数 $n$ 是无平方因子的，那么它的任何表示都必须是本原的。反过来，如果 $n$ 有一个本原表示，那么 $t^2n$ 对于任何整数 $t \ge 1$ 都有一个公因子为 $t$ 的表示。[@problem_id:3089660]

#### 模形式与精确表示数

我们不仅可以问“能否表示”，还可以问“有多少种表示方式？”。令 $r_3(n)$ 为表示 $n$ 为三个平方和的有序整数三元组 $(x,y,z)$ 的数量。为了研究 $r_3(n)$，数学家们构造了一个**[生成函数](@entry_id:146702)**，即**theta 级数**：
$$ \Theta_3(\tau) = \sum_{n=0}^{\infty} r_3(n) q^n = \left( \sum_{k \in \mathbb{Z}} q^{k^2} \right)^3 \quad (q = e^{2\pi i \tau}) $$
这个级数是一个**模形式** (modular form)，具有特定的对称性 [@problem_id:3089633]。[模形式](@entry_id:160014)理论是一个极其强大的工具。它表明 $\Theta_3(\tau)$ 可以被唯一地分解为一个**爱森斯坦级数**和一个**[尖点形式](@entry_id:189096)**的和。

-   爱森斯坦级数的系数是相对简单的[算术函数](@entry_id:200701)，通常与 $n$ 的因子和有关。
-   [尖点形式](@entry_id:189096)的系数则更为神秘，但它们与另一类深刻的算术对象——**赫尔维茨类数** (Hurwitz class number) $H(D)$ ——紧密相关。$H(D)$ 是对判别式为 $-D$ 的二次型进行加权计数的结果 [@problem_id:3089675]。

通过这种分解，可以得到 $r_3(n)$ 的精确公式。公式的形式取决于 $n$ 模4的余数，并与赫尔维茨类数 $H(D)$ (与判别式 $-D$ 相关) 关联：
*   若 $n \equiv 1, 2 \pmod{4}$，则 $r_3(n) = 12 H(4n)$。
*   若 $n \equiv 3 \pmod{4}$，则 $r_3(n) = 24 H(n)$。
*   若 $n \equiv 0 \pmod{4}$，则 $r_3(n) = r_3(n/4)$。
这一系列公式将一个看似初等的计数问题 ($r_3(n)$) 与二次型理论的中心对象 ([类数](@entry_id:156164)) 联系起来，展示了数论不同分支之间令人惊叹的内在统一性。[@problem_id:3089634]