{"hands_on_practices": [{"introduction": "Understanding the relationship between a body's orientation and its angular velocity is a cornerstone of rigid body kinematics. While we often integrate a known angular velocity $\\vec{\\omega}$ to find the orientation quaternion $q(t)$ over time, it is equally important to solve the inverse problem. This practice will guide you through calculating the instantaneous body-frame angular velocity from a given time-dependent orientation quaternion, a crucial skill for analyzing motion data from sensors or pre-planned trajectories [@problem_id:2031381].", "problem": "A small satellite is executing a pre-programmed attitude maneuver. Its orientation in space, relative to a fixed inertial reference frame, is described by a time-dependent unit quaternion $q(t) = q_s(t) + q_1(t)\\mathbf{i} + q_2(t)\\mathbf{j} + q_3(t)\\mathbf{k}$. A unit quaternion is a mathematical object used to represent rotations where $q_s$ is the scalar part, $(q_1, q_2, q_3)$ is the vector part, and the components satisfy the condition $q_s(t)^2 + q_1(t)^2 + q_2(t)^2 + q_3(t)^2 = 1$.\n\nThe components of the satellite's orientation quaternion are given by the following functions of time $t$ (in seconds):\n$$q_s(t) = \\cos\\left(\\frac{\\beta t^2}{2}\\right)\\cos\\left(\\frac{\\alpha t}{2}\\right)$$\n$$q_1(t) = \\cos\\left(\\frac{\\beta t^2}{2}\\right)\\sin\\left(\\frac{\\alpha t}{2}\\right)$$\n$$q_2(t) = \\sin\\left(\\frac{\\beta t^2}{2}\\right)\\sin\\left(\\frac{\\alpha t}{2}\\right)$$\n$$q_3(t) = \\sin\\left(\\frac{\\beta t^2}{2}\\right)\\cos\\left(\\frac{\\alpha t}{2}\\right)$$\nThe maneuver is defined by the constants $\\alpha = 0.50 \\text{ rad/s}$ and $\\beta = 0.10 \\text{ rad/s}^2$.\n\nDetermine the three components $(\\omega_x, \\omega_y, \\omega_z)$ of the satellite's angular velocity vector $\\vec{\\omega}_B$ as measured in its own body-fixed reference frame at the instant $t = 2.0$ s.\n\nExpress your answer as the numerical values of the three components, in the specified order $(\\omega_x, \\omega_y, \\omega_z)$. All components must be in units of rad/s. Round your final answers to three significant figures.", "solution": "Let $q(t) = [q_{s}(t), q_{1}(t), q_{2}(t), q_{3}(t)]$ be a unit quaternion with scalar part $q_{s}$ and vector part $q_{v} = (q_{1}, q_{2}, q_{3})$. Using the standard quaternion kinematics for body angular velocity, the relation is\n$$\n\\dot{q} = \\frac{1}{2}\\, q \\otimes [0,\\vec{\\omega}_{B}],\n$$\nso that\n$$\n\\vec{\\omega}_{B} = 2\\,\\text{vec}\\!\\left(q^{*} \\otimes \\dot{q}\\right),\n$$\nwhere $q^{*}$ is the quaternion conjugate of $q$ and $\\text{vec}(\\cdot)$ extracts the vector part.\n\nIntroduce the shorthand\n$$\nA(t) = \\frac{\\alpha t}{2}, \\quad B(t) = \\frac{\\beta t^{2}}{2}, \\quad A' = \\frac{\\alpha}{2}, \\quad B' = \\beta t,\n$$\nand define $cA = \\cos A$, $sA = \\sin A$, $cB = \\cos B$, $sB = \\sin B$. The given quaternion components are\n$$\nq_{s} = cB\\,cA,\\quad q_{1} = cB\\,sA,\\quad q_{2} = sB\\,sA,\\quad q_{3} = sB\\,cA.\n$$\nThis quaternion factors as a product of two elementary rotations:\n$$\nq(t) = q_{B}(t) \\otimes q_{A}(t), \\quad q_{A} = [\\cos A,\\, \\sin A\\,\\mathbf{i}], \\quad q_{B} = [\\cos B,\\, \\sin B\\,\\mathbf{k}],\n$$\nwhich one verifies by direct quaternion multiplication. Here $q_{A}$ is a rotation by angle $2A = \\alpha t$ about the body $x$-axis (right factor), and $q_{B}$ is a rotation by angle $2B = \\beta t^{2}$ about the inertial $z$-axis (left factor).\n\nDifferentiate the product:\n$$\n\\dot{q} = \\dot{q}_{B} \\otimes q_{A} + q_{B} \\otimes \\dot{q}_{A}.\n$$\nUsing the kinematic relations for each factor,\n$$\n\\dot{q}_{A} = \\frac{1}{2}\\,q_{A}\\otimes[0,\\alpha\\,\\mathbf{e}_{x}], \\qquad\n\\dot{q}_{B} = \\frac{1}{2}\\,[0, 2\\beta t\\,\\mathbf{e}_{z}]\\otimes q_{B},\n$$\nwe obtain\n$$\n\\dot{q} = \\frac{1}{2}\\,[0, 2\\beta t\\,\\mathbf{e}_{z}]\\otimes q + \\frac{1}{2}\\,q\\otimes[0,\\alpha\\,\\mathbf{e}_{x}].\n$$\nFor any unit quaternion $q$ and inertial vector $\\mathbf{v}_{I}$, the identity\n$$\n[0,\\mathbf{v}_{I}] \\otimes q = q \\otimes [0, R(q)^{T}\\mathbf{v}_{I}]\n$$\nholds, where $R(q)$ maps body to inertial vectors. Applying this to the first term gives\n$$\n\\dot{q} = \\frac{1}{2}\\,q\\otimes\\big[0,\\; \\alpha\\,\\mathbf{e}_{x} + 2\\beta t\\,R(q)^{T}\\mathbf{e}_{z}\\big].\n$$\nComparing with $\\dot{q} = \\frac{1}{2} q \\otimes [0,\\vec{\\omega}_{B}]$ yields\n$$\n\\vec{\\omega}_{B} = \\alpha\\,\\mathbf{e}_{x} + 2\\beta t\\,R(q)^{T}\\mathbf{e}_{z}.\n$$\n\nCompute $R(q)^{T}\\mathbf{e}_{z}$ from $q$. For a unit quaternion $q = [q_{0},q_{1},q_{2},q_{3}]$ mapping body to inertial, the inertial $z$-axis expressed in body coordinates is the third column of $R(q)^{T}$, i.e.,\n$$\nR(q)^{T}\\mathbf{e}_{z} =\n\\begin{pmatrix}\n2(q_{1}q_{3} - q_{0}q_{2})\\\\\n2(q_{2}q_{3} + q_{0}q_{1})\\\\\n1 - 2(q_{1}^{2} + q_{2}^{2})\n\\end{pmatrix}.\n$$\nSubstitute $q_{0}=cB cA$, $q_{1}=cB sA$, $q_{2}=sB sA$, $q_{3}=sB cA$ to get\n$$\n2(q_{1}q_{3} - q_{0}q_{2}) = 2 cB sB (sA cA - cA sA) = 0,\n$$\n$$\n2(q_{2}q_{3} + q_{0}q_{1}) = 2(sB^{2} sA cA + cB^{2} cA sA) = 2 sA cA = \\sin(2A),\n$$\n$$\n1 - 2(q_{1}^{2} + q_{2}^{2}) = 1 - 2 sA^{2}(cB^{2} + sB^{2}) = 1 - 2 sA^{2} = \\cos(2A).\n$$\nHence\n$$\nR(q)^{T}\\mathbf{e}_{z} =\n\\begin{pmatrix}\n0\\\\\n\\sin(2A)\\\\\n\\cos(2A)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0\\\\\n\\sin(\\alpha t)\\\\\n\\cos(\\alpha t)\n\\end{pmatrix}.\n$$\nTherefore, the body angular velocity components are\n$$\n\\vec{\\omega}_{B}(t) =\n\\begin{pmatrix}\n\\omega_{x}\\\\\n\\omega_{y}\\\\\n\\omega_{z}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\alpha\\\\\n2\\beta t\\,\\sin(\\alpha t)\\\\\n2\\beta t\\,\\cos(\\alpha t)\n\\end{pmatrix}.\n$$\n\nAt $t = 2.0$ s with $\\alpha = 0.50$ and $\\beta = 0.10$,\n$$\n\\alpha t = 1.0,\\quad 2\\beta t = 0.40,\n$$\nso\n$$\n\\omega_{x} = 0.50,\\quad \\omega_{y} = 0.40\\,\\sin(1.0) \\approx 0.337,\\quad \\omega_{z} = 0.40\\,\\cos(1.0) \\approx 0.216,\n$$\nall in rad/s, rounded to three significant figures.", "answer": "$$\\boxed{\\begin{pmatrix} 0.500 & 0.337 & 0.216 \\end{pmatrix}}$$", "id": "2031381"}, {"introduction": "Moving from a pure description of motion to its causes, we enter the realm of dynamics. In many engineering applications, such as spacecraft maneuvering or robotic arm control, we first define a desired orientation path and then must determine the forces and torques needed to achieve it. This exercise [@problem_id:2031398] challenges you to solve such an inverse dynamics problem by combining quaternion kinematics with Euler's equations of motion to find the precise torque required for a smooth reorientation defined by Spherical Linear Interpolation (SLERP).", "problem": "A spacecraft, modeled as a rigid body, is being reoriented by its attitude control system. In its body-fixed frame, aligned with the principal axes $(\\hat{e}_1, \\hat{e}_2, \\hat{e}_3)$, the principal moments of inertia are $I_1 = I_0$, $I_2 = 2I_0$, and $I_3 = 3I_0$ for some constant $I_0$.\n\nThe orientation of the spacecraft is represented by a unit quaternion $q = w + x\\mathbf{i} + y\\mathbf{j} + z\\mathbf{k}$. The reorientation maneuver takes a total time $T$. The initial orientation at $t=0$ is given by the identity quaternion, $q_0 = 1$. The target orientation at $t=T$ is $q_f = \\frac{1}{\\sqrt{2}} + \\frac{1}{2}\\mathbf{i} + \\frac{1}{2}\\mathbf{j}$.\n\nThe orientation path $q(t)$ is prescribed to follow a specific type of Spherical Linear Interpolation (SLERP) defined by the formula:\n$$\nq(t) = q_0 \\left(q_0^{-1} q_f\\right)^{t/T}\n$$\nfor $t \\in [0, T]$.\n\nDetermine the time-varying torque vector $\\vec{\\tau}(t) = (\\tau_1, \\tau_2, \\tau_3)$ that must be applied by the control system to enforce this motion. The torque should be expressed in the spacecraft's body frame. Your answer should be a vector expression in terms of the constants $I_0$ and $T$.", "solution": "We use quaternion kinematics and rigid-body dynamics in the body frame. The prescribed SLERP is\n$$\nq(t) = q_{0} \\left(q_{0}^{-1} q_{f}\\right)^{t/T}.\n$$\nWith $q_{0}=1$, this becomes\n$$\nq(t) = \\left(q_{f}\\right)^{t/T} = \\exp\\!\\left(\\frac{t}{T}\\,\\ln q_{f}\\right).\n$$\nFor unit quaternions, the kinematic relation in the body frame is\n$$\n\\dot{q} = \\frac{1}{2}\\,q \\otimes (0,\\boldsymbol{\\omega}),\n$$\nwhere $\\boldsymbol{\\omega}$ is the angular velocity expressed in the body frame and $(0,\\boldsymbol{\\omega})$ is the corresponding pure imaginary quaternion. Differentiating $q(t)$ gives\n$$\n\\dot{q}(t) = \\frac{1}{T}\\,q(t)\\otimes \\ln q_{f}.\n$$\nIdentifying with the kinematic equation, we obtain\n$$\n(0,\\boldsymbol{\\omega}) = \\frac{2}{T}\\,\\ln q_{f},\n$$\nso $\\boldsymbol{\\omega}$ is constant in time and equals\n$$\n\\boldsymbol{\\omega} = \\frac{2}{T}\\,\\mathrm{vect}\\!\\left(\\ln q_{f}\\right).\n$$\n\nNext, compute $\\ln q_{f}$. Write $q_{f} = w + \\mathbf{v}$ with $w=\\frac{1}{\\sqrt{2}}$ and $\\mathbf{v}=\\left(\\frac{1}{2},\\frac{1}{2},0\\right)$. For a unit quaternion, $w=\\cos(\\theta/2)$, $|\\mathbf{v}|=\\sin(\\theta/2)$, axis $\\hat{\\mathbf{u}}=\\mathbf{v}/|\\mathbf{v}|$, and\n$$\n\\ln q_{f} = \\left(0,\\hat{\\mathbf{u}}\\,\\frac{\\theta}{2}\\right).\n$$\nHere $|\\mathbf{v}|=\\sqrt{\\frac{1}{2}}=\\frac{1}{\\sqrt{2}}$ and $w=\\frac{1}{\\sqrt{2}}$, hence $\\theta = 2\\,\\operatorname{arctan2}\\!\\left(|\\mathbf{v}|,w\\right) = \\frac{\\pi}{2}$ and\n$$\n\\hat{\\mathbf{u}} = \\frac{\\left(\\frac{1}{2},\\frac{1}{2},0\\right)}{\\frac{1}{\\sqrt{2}}} = \\left(\\frac{1}{\\sqrt{2}},\\frac{1}{\\sqrt{2}},0\\right).\n$$\nTherefore\n$$\n\\ln q_{f} = \\left(0,\\hat{\\mathbf{u}}\\,\\frac{\\theta}{2}\\right) = \\left(0,\\frac{\\pi}{4}\\left(\\frac{1}{\\sqrt{2}},\\frac{1}{\\sqrt{2}},0\\right)\\right).\n$$\nIt follows that the constant body angular velocity is\n$$\n\\boldsymbol{\\omega} = \\frac{2}{T}\\,\\mathrm{vect}\\!\\left(\\ln q_{f}\\right) = \\frac{\\pi}{2T}\\left(\\frac{1}{\\sqrt{2}},\\frac{1}{\\sqrt{2}},0\\right) = \\left(\\frac{\\pi}{2\\sqrt{2}\\,T},\\frac{\\pi}{2\\sqrt{2}\\,T},0\\right).\n$$\n\nIn the body frame aligned with principal axes, the rigid-body dynamics are\n$$\n\\boldsymbol{\\tau} = \\mathbf{I}\\,\\dot{\\boldsymbol{\\omega}} + \\boldsymbol{\\omega} \\times (\\mathbf{I}\\,\\boldsymbol{\\omega}),\n$$\nwith $\\mathbf{I}=\\mathrm{diag}(I_{1},I_{2},I_{3})=\\mathrm{diag}(I_{0},2I_{0},3I_{0})$. Since $\\boldsymbol{\\omega}$ is constant, $\\dot{\\boldsymbol{\\omega}}=\\mathbf{0}$ and\n$$\n\\boldsymbol{\\tau} = \\boldsymbol{\\omega} \\times (\\mathbf{I}\\,\\boldsymbol{\\omega}).\n$$\nLet $a \\equiv \\frac{\\pi}{2\\sqrt{2}\\,T}$. Then $\\boldsymbol{\\omega}=(a,a,0)$ and\n$$\n\\mathbf{I}\\,\\boldsymbol{\\omega} = (I_{0}a,\\,2I_{0}a,\\,0).\n$$\nHence\n$$\n\\boldsymbol{\\tau} = (a,a,0) \\times (I_{0}a,2I_{0}a,0) = \\left(0,\\,0,\\,a\\cdot 2I_{0}a - a\\cdot I_{0}a\\right) = \\left(0,0,I_{0}a^{2}\\right).\n$$\nSubstituting $a^{2} = \\left(\\frac{\\pi}{2\\sqrt{2}\\,T}\\right)^{2} = \\frac{\\pi^{2}}{8T^{2}}$ gives the constant torque vector in the body frame:\n$$\n\\boldsymbol{\\tau}(t) = \\left(0,\\,0,\\,\\frac{I_{0}\\pi^{2}}{8T^{2}}\\right).\n$$\nThis torque is time-invariant and aligned with $\\hat{e}_{3}$, providing the required gyroscopic moment to maintain the constant body-rate SLERP motion.", "answer": "$$\\boxed{\\begin{pmatrix}0 & 0 & \\frac{I_{0}\\pi^{2}}{8T^{2}}\\end{pmatrix}}$$", "id": "2031398"}, {"introduction": "The theoretical elegance of quaternions must often be translated into the practical world of numerical simulation, which comes with its own set of challenges. When integrating the quaternion kinematic equations on a computer, small numerical errors can accumulate, causing the quaternion's norm to drift away from the essential value of 1. This practice [@problem_id:2031365] provides a hands-on look at this numerical artifact, allowing you to quantify the error introduced by a simple integration scheme and understand why normalization is a critical step in any robust simulation.", "problem": "In the simulation of a satellite's attitude dynamics, its orientation is represented by a unit quaternion $q = q_w + q_x \\mathbf{i} + q_y \\mathbf{j} + q_z \\mathbf{k}$, which can also be denoted by the vector $(q_w, q_x, q_y, q_z)$. The evolution of the quaternion is governed by the kinematic equation $\\dot{q} = \\frac{1}{2} q \\otimes \\omega_B$, where $\\omega_B$ is the pure quaternion $(0, \\omega_{Bx}, \\omega_{By}, \\omega_{Bz})$ representing the satellite's angular velocity in its body-fixed frame. The quaternion product for two quaternions $p=(p_w, \\vec{p})$ and $q=(q_w, \\vec{q})$ is defined as $p \\otimes q = (p_w q_w - \\vec{p} \\cdot \\vec{q}, p_w \\vec{q} + q_w \\vec{p} + \\vec{p} \\times \\vec{q})$.\n\nConsider a satellite initially in a non-rotating reference orientation, corresponding to an initial quaternion $q(0) = (1, 0, 0, 0)$. At $t=0$, it is subjected to a constant angular velocity given in the body frame as $\\vec{\\omega}_B = (0, 0, 0.5)$ rad/s.\n\nAn engineer simulates the satellite's orientation over a total time of $T = 2.0$ s using a simple forward Euler integration scheme, $q_{k+1} = q_k + \\Delta t \\cdot \\dot{q}_k$, with a time step of $\\Delta t = 0.1$ s. However, the engineer neglects to re-normalize the quaternion at each step, a common source of error in naive implementations. As a result, the computed quaternion, which should ideally be 1, will drift.\n\nLet $q_{final}$ be the non-unit-norm quaternion obtained at time $T$ from this simulation. Calculate the numerical error in the norm, defined as $E = \\|q_{final}\\| - 1$. Round your final answer to four significant figures.", "solution": "The quaternion kinematics are given by\n$$\n\\dot{q}=\\frac{1}{2} q \\otimes \\omega_{B},\n$$\nwhere $\\omega_{B}=(0,0,0,\\omega)$ with $\\omega=0.5$. Writing $q=(q_{w},q_{x},q_{y},q_{z})$ and using the quaternion product\n$$\nq \\otimes \\omega_{B}=\\left(-q_{z}\\omega,\\; q_{y}\\omega,\\; -q_{x}\\omega,\\; q_{w}\\omega\\right),\n$$\nwe obtain the component ODEs\n$$\n\\dot{q}_{w}=-\\frac{\\omega}{2}q_{z},\\quad \\dot{q}_{x}=\\frac{\\omega}{2}q_{y},\\quad \\dot{q}_{y}=-\\frac{\\omega}{2}q_{x},\\quad \\dot{q}_{z}=\\frac{\\omega}{2}q_{w}.\n$$\nWith $q(0)=(1,0,0,0)$, the forward Euler update $q_{k+1}=q_{k}+\\Delta t\\,\\dot{q}_{k}$ with $\\Delta t$ yields\n$$\nq_{w,k+1}=q_{w,k}-a\\,q_{z,k},\\quad q_{x,k+1}=q_{x,k}+a\\,q_{y,k},\\quad q_{y,k+1}=q_{y,k}-a\\,q_{x,k},\\quad q_{z,k+1}=q_{z,k}+a\\,q_{w,k},\n$$\nwhere $a=\\frac{\\Delta t\\,\\omega}{2}$. Since $q_{x,0}=q_{y,0}=0$, the recurrences keep $q_{x,k}=q_{y,k}=0$ for all $k$, and the evolution reduces to\n$$\nq_{w,k+1}=q_{w,k}-a\\,q_{z,k},\\qquad q_{z,k+1}=q_{z,k}+a\\,q_{w,k}.\n$$\nDefine $s_{k}=q_{w,k}^{2}+q_{z,k}^{2}=\\|q_{k}\\|^{2}$. Then\n$$\ns_{k+1}=(q_{w,k}-a q_{z,k})^{2}+(q_{z,k}+a q_{w,k})^{2}=(1+a^{2})(q_{w,k}^{2}+q_{z,k}^{2})=(1+a^{2})s_{k}.\n$$\nWith $s_{0}=1$, after $n$ steps we have\n$$\ns_{n}=(1+a^{2})^{n}\\quad\\Rightarrow\\quad \\|q_{n}\\|=(1+a^{2})^{\\frac{n}{2}}.\n$$\nOver total time $T$ with step $\\Delta t$, the number of steps is $n=\\frac{T}{\\Delta t}$. Therefore the norm error is\n$$\nE=\\|q_{n}\\|-1=(1+a^{2})^{\\frac{n}{2}}-1,\\qquad a=\\frac{\\Delta t\\,\\omega}{2},\\quad n=\\frac{T}{\\Delta t}.\n$$\nSubstituting $\\omega=0.5$, $\\Delta t=0.1$, and $T=2.0$ gives\n$$\na=\\frac{0.1\\times 0.5}{2}=0.025,\\quad n=20,\\quad E=(1+0.025^{2})^{10}-1=(1+0.000625)^{10}-1.\n$$\nUsing the binomial expansion up to negligible terms,\n$$\n(1+0.000625)^{10}\\approx 1+10(0.000625)+45(0.000625)^{2}+120(0.000625)^{3}=1.006267607421875,\n$$\nso\n$$\nE\\approx 0.006267607421875.\n$$\nRounding to four significant figures yields $E=0.006268$.", "answer": "$$\\boxed{0.006268}$$", "id": "2031365"}]}