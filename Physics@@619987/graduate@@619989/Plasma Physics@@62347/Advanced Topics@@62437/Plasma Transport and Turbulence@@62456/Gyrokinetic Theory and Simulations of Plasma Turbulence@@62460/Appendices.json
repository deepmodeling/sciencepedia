{"hands_on_practices": [{"introduction": "Particle-in-Cell (PIC) simulations are a cornerstone of kinetic plasma physics, but their reliance on a computational grid can introduce numerical artifacts. A fundamental example is the unphysical self-force, where a particle interacts with the field it generates due to discretization. This exercise guides you through the core steps of the PIC algorithm to calculate this force, providing crucial insight into the interplay between charge assignment, the field solver, and force interpolation [@problem_id:264056].", "problem": "In modern plasma simulations, such as those based on gyrokinetic theory, charged particles are often modeled as 'macro-particles' that interact via fields calculated on a discrete computational grid. Understanding the numerical artifacts arising from this particle-grid coupling is crucial for the validity of such simulations. A fundamental artifact is the unphysical self-force, where a particle interacts with the field it generates due to the discretization process.\n\nConsider a one-dimensional electrostatic Particle-in-Cell (PIC) simulation domain with grid points located at positions $x_j = j \\Delta x$ for integer $j$. A single particle of charge $q$ is located at position $x_p$. We will analyze the self-force on this particle using a non-standard, \"hybrid\" PIC scheme that combines methods of different orders.\n\nThe procedure for calculating the force on the particle is as follows:\n1.  **Charge Assignment (Nearest-Grid-Point, NGP):** The total charge $q$ of the particle is assigned to the single closest grid point, $x_J$. The charge density $\\rho_j$ at grid point $j$ is given by $\\rho_j = Q_j / \\Delta x$, where $Q_j$ is the charge assigned to grid point $j$.\n2.  **Field Solver:** The electric potential $\\phi_j$ on the grid is computed by solving the one-dimensional finite-difference Poisson equation:\n    $$\n    \\frac{\\phi_{j+1} - 2\\phi_j + \\phi_{j-1}}{(\\Delta x)^2} = -\\frac{\\rho_j}{\\epsilon_0}\n    $$\n    where $\\epsilon_0$ is the vacuum permittivity. Assume an infinite domain, which implies the potential from a single point charge on the grid has the form $\\phi_j \\propto |j-J|$. The electric field $E_j$ at each grid point is then calculated using the symmetric second-order finite-difference formula:\n    $$\n    E_j = -\\frac{\\phi_{j+1} - \\phi_{j-1}}{2\\Delta x}\n    $$\n3.  **Force Interpolation (Cloud-in-Cell, CIC):** The electric field $E(x_p)$ at the particle's position is determined by linearly interpolating the electric field values from the two grid points that bracket the particle.\n    \nLet the nearest grid point to the particle be $x_J = J \\Delta x$. Define the particle's normalized displacement from this nearest grid point as $\\xi = (x_p - x_J)/\\Delta x$, where $\\xi \\in (-1/2, 1/2]$. Derive the expression for the unphysical self-force $F$ exerted on the particle as a function of $q$, $\\epsilon_0$, and the normalized displacement $\\xi$.", "solution": "1. Discrete Poisson solver in 1D with a single point‐charge $q$ at node $J$ satisfies\n$$\n\\frac{\\phi_{j+1}-2\\phi_j+\\phi_{j-1}}{(\\Delta x)^2}=-\\frac{q}{\\epsilon_0\\,\\Delta x}\\,\\delta_{jJ}.\n$$\nThe Green’s function of the 1D discrete Laplacian is proportional to $|j-J|$, so\n$$\n\\phi_j=-\\frac{q\\,\\Delta x}{2\\epsilon_0}\\,\\bigl|\\,j-J\\bigr|.\n$$\n2. The electric field at grid node $j$ by centered differencing is\n$$\nE_j=-\\frac{\\phi_{j+1}-\\phi_{j-1}}{2\\Delta x}\n=\\frac{q\\Delta x}{2\\epsilon_0\\,2\\Delta x}\\Bigl(|j+1-J|-|\\,j-1-J|\\Bigr)\n=\\frac{q}{4\\epsilon_0}\\bigl(|j+1-J|-|\\,j-1-J|\\bigr).\n$$\nNoting $|m+1|-|m-1|=2\\,\\mathrm{sign}(m)$ for $m\\neq0$ and zero for $m=0$, one finds\n$$\nE_j=\\begin{cases}\\displaystyle \n\\frac{q}{2\\epsilon_0}\\,\\mathrm{sign}(j-J),&j\\neq J,\\\\0,&j=J~.\n\\end{cases}\n$$\n3. For a particle at $x_p=J\\Delta x+\\xi\\,\\Delta x$ with $\\xi\\in(-\\tfrac12,\\tfrac12]$, the CIC interpolation from the two bracketing nodes gives\n$$\nE(x_p)=(1-|\\xi|)\\,E_J+|\\xi|\\,E_{J+\\mathrm{sign}(\\xi)}\n=|\\xi|\\;\\frac{q}{2\\epsilon_0}\\,\\mathrm{sign}(\\xi)\n=\\frac{q}{2\\epsilon_0}\\,\\xi.\n$$\n4. The unphysical self‐force is\n$$\nF=q\\,E(x_p)=\\frac{q^2}{2\\epsilon_0}\\,\\xi.\n$$", "answer": "$$\\boxed{\\frac{q^2}{2\\epsilon_0}\\,\\xi}$$", "id": "264056"}, {"introduction": "Simulating small turbulent fluctuations on top of a large equilibrium background is computationally challenging due to statistical noise. The delta-f ($\\delta f$) method is a powerful technique that addresses this by evolving only the perturbed part of the distribution function, represented by particle weights. This practice focuses on a critical step: setting initial conditions to model a specific physical scenario without introducing spurious noise from the start [@problem_id:264074].", "problem": "In the delta-f ($\\delta f$) particle-in-cell (PIC) method for plasma simulation, the total distribution function, $f$, is decomposed into a large, stationary background component, $f_0$, and a small, evolving perturbation, $\\delta f$, such that $f = f_0 + \\delta f$. The simulation tracks the evolution of marker particles, which sample the phase space according to the background distribution $f_0$. Each marker particle, labeled $p$, is assigned a weight, $w_p$, defined as the ratio of the perturbation to the background distribution at the particle's phase-space position $\\mathbf{Z}_p$:\n$$w_p(t) = \\frac{\\delta f(\\mathbf{Z}_p, t)}{f_0(\\mathbf{Z}_p)}$$\nThe perturbed number density, $\\delta n$, is a moment of the perturbed distribution function, given by the integral over velocity space:\n$$\\delta n(\\mathbf{x}, t) = \\int \\delta f(\\mathbf{x}, \\mathbf{v}, t) d^3v$$\nConsider a spatially homogeneous, unmagnetized plasma where the background distribution function $f_0$ for a given species is a 3D Maxwellian:\n$$f_0(\\mathbf{v}) = n_0 \\left(\\frac{m}{2\\pi T_0}\\right)^{3/2} \\exp\\left(-\\frac{m|\\mathbf{v}|^2}{2T_0}\\right)$$\nHere, $n_0$ is the equilibrium number density, $m$ is the mass of the particles, and $T_0$ is the equilibrium temperature in energy units.\n\nA simulation is to be initialized with a specific type of perturbation that corresponds to a pure temperature perturbation, without any associated density perturbation. To achieve this, the initial weights of the simulation particles are set according to the following form, which depends on the particle's kinetic energy:\n$$w_p = A\\left(\\frac{m v_p^2}{2 T_0} - C\\right)$$\nwhere $v_p=|\\mathbf{v}_p|$ is the speed of particle $p$, $A$ is an arbitrary non-zero amplitude constant, and $C$ is a dimensionless constant.\n\nAssuming the particle loading at time $t=0$ provides a perfect sampling of the continuous background distribution $f_0$, derive the exact numerical value of the constant $C$ required to ensure that the initial perturbed number density, $\\delta n$, is zero everywhere in space.", "solution": "We require the initial perturbed density \n$$\\delta n \\;=\\;\\int \\delta f\\,d^3v \\;=\\;\\int w(\\mathbf v)\\,f_0(\\mathbf v)\\,d^3v \\;=\\;0.$$\nSince $w(\\mathbf v)=A\\bigl(\\frac{m v^2}{2T_0}-C\\bigr)$ and $A\\neq0$, we have\n$$\\int\\!f_0\\frac{m v^2}{2T_0}\\,d^3v \\;-\\;C\\int\\!f_0\\,d^3v \\;=\\;0.$$\nEvaluate the moments of the Maxwellian:\n$$\\int f_0\\,d^3v = n_0,$$\n$$\\int f_0\\,\\frac{m v^2}{2}\\,d^3v = \\frac{3}{2}n_0T_0\n\\quad\\Longrightarrow\\quad\n\\int f_0\\,\\frac{m v^2}{2T_0}\\,d^3v = \\frac{3}{2}n_0.$$\nHence\n$$C = \\frac{\\displaystyle\\int f_0\\,\\frac{m v^2}{2T_0}\\,d^3v}{\\displaystyle\\int f_0\\,d^3v}\n= \\frac{\\frac{3}{2}n_0}{n_0} = \\frac{3}{2}.$$", "answer": "$$\\boxed{\\frac{3}{2}}$$", "id": "264074"}, {"introduction": "A defining feature of gyrokinetic theory is the averaging over fast particle gyromotion, a process mathematically captured by the gyroaveraging operator. To implement this theory in a simulation, this continuous operator must be translated into a discrete finite-difference form that acts on the grid. This hands-on problem challenges you to derive the coefficients for a high-order numerical stencil, a fundamental skill in developing accurate gyrokinetic codes [@problem_id:263858].", "problem": "In gyrokinetic simulations of magnetically confined plasmas, the effect of the finite Larmor radius (FLR) of particles is captured by the gyroaveraging operator. In Fourier space, for a fluctuating quantity $\\phi$, this operation corresponds to multiplying its perpendicular wavevector component $\\hat{\\phi}(\\mathbf{k}_\\perp)$ by the zeroth-order Bessel function of the first kind, $J_0(k_\\perp \\rho)$, where $k_\\perp=|\\mathbf{k}_\\perp|$ is the perpendicular wavenumber and $\\rho$ is the particle Larmor radius.\n\nFor numerical implementation on a spatial grid, this operator must be approximated using a finite-difference scheme. Consider a one-dimensional problem where quantities vary only in the $x$-direction, such that $k_\\perp = k_x$. The grid has a uniform spacing $\\Delta x$. We wish to construct a symmetric, 5-point finite-difference stencil to approximate the gyroaveraging operator. The action of this finite-difference operator, $\\mathcal{J}_{FD}$, on the field $\\phi$ at a grid point $x_i$ is given by:\n$$\n(\\mathcal{J}_{FD}\\phi)_i = c_2 \\phi_{i-2} + c_1 \\phi_{i-1} + c_0 \\phi_i + c_1 \\phi_{i+1} + c_2 \\phi_{i+2}\n$$\nThe Fourier representation (or symbol) of this stencil is:\n$$\n\\widehat{\\mathcal{J}_{FD}}(k_x) = c_0 + 2c_1\\cos(k_x \\Delta x) + 2c_2\\cos(2k_x \\Delta x)\n$$\nTo determine the coefficients $c_0, c_1, c_2$, we demand that the Taylor series expansion of $\\widehat{\\mathcal{J}_{FD}}(k_x)$ in powers of $k_x$ matches the expansion of the exact operator $J_0(k_x \\rho)$ up to the fourth order in $k_x$. This ensures the scheme is fourth-order accurate.\n\nThe relevant Taylor series expansions are:\n$$\nJ_0(z) = 1 - \\frac{z^2}{4} + \\frac{z^4}{64} - \\mathcal{O}(z^6)\n$$\n$$\n\\cos(u) = 1 - \\frac{u^2}{2!} + \\frac{u^4}{4!} - \\mathcal{O}(u^6)\n$$\nLet the dimensionless parameter $b = \\left(\\frac{\\rho}{\\Delta x}\\right)^2$.\n\nDerive the coefficient $c_1$ for this fourth-order finite-difference scheme as a function of the parameter $b$.", "solution": "We match the Taylor expansion of \n$$\\widehat{\\mathcal{J}_{FD}}(k_x) = c_0 + 2c_1\\cos(u) + 2c_2\\cos(2u), \\quad u = k_x \\Delta x$$ \nto that of \n$$J_0(k_x\\rho) = 1 - \\frac{(k_x\\rho)^2}{4} + \\frac{(k_x\\rho)^4}{64} + \\mathcal{O}(k_x^6)$$ \nwith $b=(\\rho/\\Delta x)^2$, so $k_x\\rho=u\\sqrt b$.\n\n1. Expand the stencil symbol to fourth order in $u$:\n$$\\cos(u)=1-\\frac{u^2}{2}+\\frac{u^4}{24},\\quad\n\\cos(2u)=1-2u^2+\\frac{2u^4}{3}.$$\nHence\n$$\\widehat{\\mathcal{J}_{FD}}=c_0+2c_1\\Bigl(1-\\frac{u^2}{2}+\\frac{u^4}{24}\\Bigr)\n+2c_2\\Bigl(1-2u^2+\\frac{2u^4}{3}\\Bigr)+\\mathcal{O}(u^6).$$\n\n2. Collect coefficients:\nConstant: $c_0+2c_1+2c_2=1.$  \n$u^2$ term: $-c_1-4c_2=-\\frac b4.$  \n$u^4$ term: $\\frac{c_1}{12}+\\frac{4c_2}{3}=\\frac{b^2}{64}.$\n\n3. Solve the linear system. From\n$$c_1+4c_2=\\frac b4,\\quad c_1+16c_2=\\frac{3b^2}{16},$$\nsubtracting gives \n$$12c_2=\\frac{3b^2-4b}{16},\\quad c_2=\\frac{3b^2-4b}{192}.$$\nThen \n$$c_1=\\frac b4-4c_2=\\frac{12b-(3b^2-4b)}{48}=\\frac{16b-3b^2}{48}.$$", "answer": "$$\\boxed{\\frac{b(16 - 3b)}{48}}$$", "id": "263858"}]}