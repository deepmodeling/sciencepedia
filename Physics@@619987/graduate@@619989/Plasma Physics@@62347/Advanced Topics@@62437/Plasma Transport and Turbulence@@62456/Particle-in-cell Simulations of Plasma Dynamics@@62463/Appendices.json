{"hands_on_practices": [{"introduction": "The foundation of any Particle-in-Cell simulation is the accurate and stable integration of particle trajectories over time. This exercise explores the stability of the widely-used leapfrog integration scheme, a core component of the \"particle pusher.\" By applying the integrator to a simple harmonic oscillator, which models many fundamental plasma phenomena, you will derive the critical constraint that limits the size of the time step, $\\Delta t$, relative to the characteristic frequency of the system, $\\omega_0$. Mastering this concept is the first gate to pass in developing robust and physically meaningful simulations [@problem_id:296795].", "problem": "In Particle-in-Cell (PIC) simulations, the motion of individual charged particles is tracked over time. The simplest model for oscillatory motion, such as a particle gyrating in a uniform magnetic field or oscillating in an electrostatic potential well, is the simple harmonic oscillator (SHO). The equation of motion for a one-dimensional SHO is given by:\n$$\n\\frac{d^2x}{dt^2} = -\\omega_0^2 x\n$$\nwhere $x$ is the particle's position and $\\omega_0$ is the natural angular frequency of oscillation.\n\nA widely used numerical integration algorithm for this type of problem is the staggered leapfrog (or Verlet) method. The discrete update equations for position and velocity are:\n$$\nv_{n+1/2} = v_{n-1/2} + a_n \\Delta t\n$$\n$$\nx_{n+1} = x_n + v_{n+1/2} \\Delta t\n$$\nHere, $x_n = x(t_n)$ is the position at time $t_n = n \\Delta t$, $v_{n \\pm 1/2} = v(t_n \\pm \\Delta t/2)$ is the velocity evaluated at half-integer time steps, $a_n = -\\omega_0^2 x_n$ is the acceleration at time $t_n$, and $\\Delta t$ is the constant time step.\n\nThe numerical stability of this scheme depends on the dimensionless parameter $\\alpha = \\omega_0 \\Delta t$. A numerical scheme is defined as stable if the magnitude of all eigenvalues of its amplification matrix is less than or equal to one $(|\\lambda| \\le 1)$, with the strict requirement that any eigenvalue with magnitude exactly one must be a simple (non-repeated) root of the characteristic polynomial. An eigenvalue with magnitude one that is a repeated root leads to secular growth, a form of numerical instability.\n\nBy performing a matrix stability analysis of the leapfrog scheme applied to the simple harmonic oscillator, derive the stability condition. Determine the maximum value of the dimensionless parameter $\\alpha$ for which this scheme is stable.", "solution": "We can combine the two leapfrog update equations into a single recurrence relation for position $x_n$. From $x_{n+1} = x_n + v_{n+1/2} \\Delta t$, we have $v_{n+1/2} = (x_{n+1}-x_n)/\\Delta t$. Similarly, $v_{n-1/2} = (x_n - x_{n-1})/\\Delta t$.\nSubstituting these into the velocity update $v_{n+1/2} = v_{n-1/2} - \\omega_0^2 x_n \\Delta t$ gives:\n$$ \\frac{x_{n+1}-x_n}{\\Delta t} = \\frac{x_n - x_{n-1}}{\\Delta t} - \\omega_0^2 x_n \\Delta t $$\nMultiplying by $\\Delta t$ and rearranging yields:\n$$ x_{n+1} = (2 - (\\omega_0 \\Delta t)^2)x_n - x_{n-1} $$\nLet $\\alpha = \\omega_0 \\Delta t$. To analyze stability, we seek solutions of the form $x_n = \\lambda^n$, which leads to the characteristic equation:\n$$ \\lambda^2 - (2 - \\alpha^2)\\lambda + 1 = 0 $$\nFor the solution to be stable, the roots $\\lambda$ must satisfy $|\\lambda| \\le 1$. Since the product of the roots is 1, this requires them to be on the unit circle, which occurs when the discriminant is non-positive. This condition is equivalent to $|(2-\\alpha^2)/2| \\le 1$.\n$$ -1 \\le 1 - \\frac{\\alpha^2}{2} \\le 1 $$\nThe right inequality ($\\alpha^2 \\ge 0$) is always true. The left inequality gives $\\alpha^2/2 \\le 2$, so $\\alpha^2 \\le 4$.\nThe stability condition is therefore $|\\alpha| \\le 2$. The maximum value is 2.", "answer": "$$\\boxed{2}$$", "id": "296795"}, {"introduction": "In a PIC simulation, particles do not interact directly but through the intermediary of a computational grid. This discretization, while computationally necessary, introduces non-physical artifacts. This problem guides you through the analysis of one of the most important of these: the \"self-force,\" where a particle's own charge, deposited on the grid, creates a field that acts back on itself. By calculating the root-mean-square magnitude of this force for a standard linear weighting scheme, you will gain a quantitative understanding of a primary source of energy non-conservation, often called numerical heating, in PIC simulations [@problem_id:296780].", "problem": "In one-dimensional electrostatic Particle-in-Cell (PIC) simulations using linear weighting (also known as Cloud-in-Cell or CIC), a charged particle interacts with the computational grid, giving rise to a non-physical \"self-force\". This force arises because the particle's own charge, when deposited onto the grid, creates a gridded electric field which then acts back on the particle itself after interpolation. This spurious force is a direct consequence of the spatial discretization and is responsible for numerical heating and a violation of energy conservation.\n\nFor a single particle of charge $q$ in an infinite, one-dimensional system with grid spacing $\\Delta x$ and vacuum permittivity $\\epsilon_0$, the potential energy of its own gridded electric field, $U_{self}$, can be shown to vary with its position within a grid cell. The potential is periodic with the grid period $\\Delta x$ and within a given cell, defined by grid nodes at $x_j$ and $x_{j+1}$, it is given by:\n$$\nU_{self}(x) = \\frac{q^2 \\Delta x}{2\\epsilon_0} u(1-u)\n$$\nwhere $u = \\frac{x - x_j}{\\Delta x}$ is the normalized position of the particle within the cell, for $x \\in [x_j, x_{j+1}]$. This energy is zero at the cell boundaries ($u=0$ and $u=1$) and maximum at the cell center ($u=1/2$).\n\nThe conservative force associated with this self-potential is $F_{self}(x) = -\\frac{\\partial U_{self}}{\\partial x}$. This force varies as the particle moves across the cell, and its spatial average over a cell is zero. To quantify the typical magnitude of this force, it is useful to compute its root-mean-square (RMS) value.\n\nDerive the root-mean-square value of the self-force, $F_{RMS}$, for a particle uniformly distributed over a single grid cell.", "solution": "The self-potential and normalized position are:  \n$$U_{self}(x)=\\frac{q^2\\Delta x}{2\\epsilon_0}\\,u(1-u),\\qquad u=\\frac{x-x_j}{\\Delta x}.$$  \nThe self-force is:  \n$$F_{self}(x)=-\\frac{\\partial U_{self}}{\\partial x}\n=-\\frac{1}{\\Delta x}\\frac{\\partial}{\\partial u}\\left(\\frac{q^2\\Delta x}{2\\epsilon_0}u(1-u)\\right)$$  \n$$=-\\frac{q^2}{2\\epsilon_0}(1-2u)\n=\\frac{q^2}{2\\epsilon_0}(2u-1).$$  \n\nTo find the RMS value, we square the force and average over a cell, i.e., over $u \\in [0,1]$:  \n$$F_{self}^2=\\frac{q^4}{4\\epsilon_0^2}(2u-1)^2,$$  \n$$\\langle F^2\\rangle=\\int_0^1 \\frac{q^4}{4\\epsilon_0^2}(2u-1)^2\\,du\n=\\frac{q^4}{4\\epsilon_0^2}\\int_0^1(4u^2-4u+1)\\,du\n=\\frac{q^4}{4\\epsilon_0^2}\\left[\\frac{4u^3}{3} - 2u^2 + u\\right]_0^1 = \\frac{q^4}{4\\epsilon_0^2}\\cdot\\frac{1}{3}.$$\n\nThus the RMS self-force is  \n$$F_{RMS}=\\sqrt{\\langle F^2\\rangle}\n=\\sqrt{\\frac{q^4}{12\\epsilon_0^2}}\n=\\frac{q^2}{2\\sqrt{3}\\,\\epsilon_0}.$$", "answer": "$$\\boxed{\\frac{q^2}{2\\sqrt{3}\\,\\epsilon_0}}$$", "id": "296780"}, {"introduction": "A fundamental requirement for any valid physics simulation is the adherence to conservation laws. In plasma simulations, the exact conservation of charge is paramount for accurately evolving the electromagnetic fields. This practice demonstrates how to construct a current deposition scheme that rigorously satisfies the discrete version of the continuity equation. By working through the motion of a single particle crossing a cell boundary, you will see how a charge-conserving algorithm ensures that no charge is artificially created or destroyed by the numerical process, a cornerstone of modern PIC codes [@problem_id:296879].", "problem": "In Particle-In-Cell (PIC) simulations, a charge-conserving current deposition scheme is essential for long-term numerical stability and accuracy. This is achieved by ensuring that the discrete continuity equation is satisfied exactly.\n\nConsider a one-dimensional grid with uniform spacing $\\Delta x$, where grid node positions are given by $x_j = j \\Delta x$ for integer $j$. The charge $Q_j$ assigned to a node $j$ and the electric current $I_{j+1/2}$ flowing across the boundary located at the midpoint $x_{j+1/2} = (j+1/2)\\Delta x$ are related by the discrete continuity equation:\n$$\n\\frac{Q_j^{n+1} - Q_j^n}{\\Delta t} + I_{j+1/2} - I_{j-1/2} = 0\n$$\nwhere the superscripts $n$ and $n+1$ denote two consecutive time steps separated by $\\Delta t$.\n\nThe charge of a particle is assigned to the grid nodes using the first-order, linear Cloud-In-Cell (CIC) weighting scheme. For a particle of charge $q$ located at position $x_p$ between nodes $j$ and $j+1$, the charges assigned to these nodes are:\n$$\nQ_j = q \\frac{x_{j+1} - x_p}{\\Delta x} \\quad \\text{and} \\quad Q_{j+1} = q \\frac{x_p - x_j}{\\Delta x}\n$$\n\nThe current $I_j$ assigned to a grid node $j$ is defined as the arithmetic mean of the currents flowing across the two adjacent cell boundaries:\n$$\nI_j = \\frac{1}{2} (I_{j-1/2} + I_{j+1/2})\n$$\n\nNow, consider a single particle of charge $q$. In the time interval $\\Delta t$, it moves from position $x_p^n$ to $x_p^{n+1}$. During this move, the particle crosses the grid node at $x_i$. Specifically, its initial position $x_p^n$ is in the cell $[x_{i-1}, x_i)$, and its final position $x_p^{n+1}$ is in the cell $[x_i, x_{i+1})$. Let the particle's fractional position within its starting cell be $\\delta_n = (x_p^n - x_{i-1}) / \\Delta x$, and its fractional position within its final cell be $\\delta_{n+1} = (x_p^{n+1} - x_i) / \\Delta x$. Note that by definition, $0 \\le \\delta_n < 1$ and $0 \\le \\delta_{n+1} < 1$.\n\nAssuming the current is zero far from the particle (i.e., $\\lim_{j\\to-\\infty} I_{j+1/2} = 0$), derive an expression for the total current $I_{\\text{dep}}$ deposited to the two nodes that bracket the particle's final position, i.e., $I_{\\text{dep}} = I_i + I_{i+1}$. Express your answer in terms of $q$, $\\Delta t$, $\\delta_n$, and $\\delta_{n+1}$.", "solution": "1. Charge assignment via linear CIC at times $n$ and $n+1$ in the relevant nodes:\n$$\n\\begin{aligned}\n&Q_{i-1}^n = q\\,(1-\\delta_n),\\quad Q_i^n = q\\,\\delta_n,\\quad Q_{i+1}^n=0,\\\\\n&Q_{i-1}^{n+1}=0,\\quad Q_i^{n+1}=q\\,(1-\\delta_{n+1}),\\quad Q_{i+1}^{n+1}=q\\,\\delta_{n+1}.\n\\end{aligned}\n$$\nAll other $Q_j^n$ and $Q_j^{n+1}$ vanish.\n\n2. Compute charge changes $\\Delta Q_j=Q_j^{n+1}-Q_j^n$ and apply the discrete continuity equation\n$$\n\\frac{\\Delta Q_j}{\\Delta t}+I_{j+1/2}-I_{j-1/2}=0,\n$$\nwith the boundary condition $I_{j \\to -\\infty} = 0$.\n\n– At $j=i-1$: $\\Delta Q_{i-1}=-\\,q\\,(1-\\delta_n)$, so\n$$\nI_{i-1/2}=\\frac{q\\,(1-\\delta_n)}{\\Delta t}.\n$$\n\n– At $j=i$: $\\Delta Q_i=q\\bigl((1-\\delta_{n+1})-\\delta_n\\bigr)=q\\,(1-\\delta_n-\\delta_{n+1})$, hence\n$$\nI_{i+1/2}=I_{i-1/2}-\\frac{\\Delta Q_i}{\\Delta t}\n=\\frac{q\\,(1-\\delta_n)}{\\Delta t}-\\frac{q\\,(1-\\delta_n-\\delta_{n+1})}{\\Delta t}\n=\\frac{q\\,\\delta_{n+1}}{\\Delta t}.\n$$\n\n– At $j=i+1$: $\\Delta Q_{i+1}=q\\,\\delta_{n+1}$ gives\n$$\nI_{i+3/2}=I_{i+1/2}-\\frac{\\Delta Q_{i+1}}{\\Delta t}\n=\\frac{q\\,\\delta_{n+1}}{\\Delta t}-\\frac{q\\,\\delta_{n+1}}{\\Delta t}=0.\n$$\nAll subsequent boundary currents are also zero.\n\n3. Node-centered currents via arithmetic means:\n$$\nI_i=\\frac{I_{i-1/2}+I_{i+1/2}}{2}\n=\\frac{q}{2\\Delta t}\\bigl((1-\\delta_n)+\\delta_{n+1}\\bigr),\n\\quad\nI_{i+1}=\\frac{I_{i+1/2}+I_{i+3/2}}{2}\n=\\frac{q\\,\\delta_{n+1}}{2\\Delta t}.\n$$\n\n4. Total deposited current at nodes $i,i+1$:\n$$\nI_{\\text{dep}}=I_i+I_{i+1}\n=\\frac{q}{2\\Delta t}\\bigl(1-\\delta_n+2\\,\\delta_{n+1}\\bigr).\n$$", "answer": "$$\\boxed{\\frac{q}{2\\Delta t}\\bigl(1-\\delta_n+2\\delta_{n+1}\\bigr)}$$", "id": "296879"}]}