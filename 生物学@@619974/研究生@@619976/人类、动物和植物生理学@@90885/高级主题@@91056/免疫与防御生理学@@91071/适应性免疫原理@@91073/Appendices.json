{"hands_on_practices": [{"introduction": "我们的实践始于适应性免疫的一个核心筛选过程：胸腺中枢耐受。这项练习将指导你通过一个定量模型，计算一个胸腺细胞在经历正向和负向选择后得以存活的概率 [@problem_id:2600008]。通过这个计算，你将具体地理解免疫系统如何在确保T细胞能够识别自身MHC分子（正向选择）与清除高亲和力自我反应性克隆（负向选择）这两个相互矛盾的目标之间取得微妙的平衡。", "problem": "一个携带单个T细胞受体(TCR)的胸腺细胞在胸腺皮质中接受自身肽-主要组织相容性复合体(MHC)配体的筛选。采用以下基于生物学基础的规则：如果TCR与至少一个遇到的自身肽-MHC以“中等”范围内的结合自由能结合，则发生阳性选择；如果TCR与任何遇到的肽-MHC的结合强度超过一个更严格的“强结合”阈值，则发生阴性选择（克隆清除）。建立结合自由能模型，使得能量越小对应结合越强。设阴性选择阈值为 $E_{n}$，阳性选择阈值为 $E_{p}$，且 $E_{n} < E_{p}$。\n\n考虑一个包含 $N$ 种不同自身肽的池。对于此胸腺细胞，其与 $N$ 种肽-MHC的结合自由能是固定的数值 $\\{E_{1},\\dots,E_{N}\\}$。其中，恰好有 $n_{s}$ 个满足 $E_{i} \\leq E_{n}$（触发阴性选择的强结合物），恰好有 $n_{m}$ 个满足 $E_{n} < E_{i} \\leq E_{p}$（可介导阳性选择且不引起阴性选择的中等结合物），其余的 $N - n_{s} - n_{m}$ 个满足 $E_{i} > E_{p}$（结合太弱无法产生信号）。\n\n在皮质扫描期间，胸腺细胞从包含 $N$ 种自身肽的池中有放回地均匀随机选择，与肽-MHC进行 $m$ 次独立遭遇。当且仅当在这 $m$ 次遭遇中，胸腺细胞遇到至少一个中等结合物且没有遇到任何强结合物时，它将通过阳性选择而不被阴性选择。\n\n仅使用核心概率法则（试验独立性和补集法则）以及上述选择阈值的定义，计算在下列数值下，胸腺细胞通过阳性选择而不被阴性选择的概率：$N = 10000$，$n_{s} = 12$，$n_{m} = 180$，$m = 300$。将最终结果表示为四舍五入到四位有效数字的小数（不带百分号）。", "solution": "在尝试任何解答之前，对所述问题进行验证。\n\n步骤1：提取已知条件。\n- 一个携带单个T细胞受体(TCR)的胸腺细胞接受一个包含 $N$ 种不同自身肽-主要组织相容性复合体(pMHC)配体的池的筛选。\n- 结合自由能记为 $\\{E_{1}, \\dots, E_{N}\\}$，其中能量越小表示结合越强。\n- 阴性选择阈值为 $E_{n}$。\n- 阳性选择阈值为 $E_{p}$，条件为 $E_{n} < E_{p}$。\n- 强结合肽的数量为 $n_{s}$，定义为 $E_{i} \\leq E_{n}$。\n- 中等结合肽的数量为 $n_{m}$，定义为 $E_{n} < E_{i} \\leq E_{p}$。\n- 弱结合肽的数量为 $N - n_{s} - n_{m}$，定义为 $E_{i} > E_{p}$。\n- 胸腺细胞进行 $m$ 次独立遭遇，其中pMHC从 $N$ 个池中有放回地均匀随机选取。\n- 成功结果（存活）的条件：在 $m$ 次遭遇过程中，胸腺细胞必须遇到至少一个中等结合物并且没有遇到强结合物。\n- 提供的数值：$N = 10000$，$n_{s} = 12$，$n_{m} = 180$，$m = 300$。\n- 最终结果必须是四舍五入到四位有效数字的小数。\n\n步骤2：使用提取的已知条件进行验证。\n- **科学依据**：该问题提出了一个胸腺选择的简化数学模型，这是免疫学中的一个核心概念。使用结合能阈值和概率性遭遇是定量生物学中一种标准且有效的方法。该模型是一个抽象，但建立在公认的科学原理之上。它不是伪科学。\n- **适定性**：该问题定义明确。所有变量都已指定，概率框架（有放回抽样，独立试验）清晰，需要计算其概率的事件描述无歧义。存在唯一的数值解。\n- **客观性**：问题以客观、数学的语言陈述。\n- 问题是自洽的、一致的，并且可以科学地形式化。它不违反任何无效性标准。\n\n步骤3：结论与行动。\n问题被认为是有效的。将提供解答。\n\n任务是计算从一个包含 $m$ 次独立试验的序列中导出的事件的概率。在每次试验中，从一个包含 $N$ 种肽的池中有放回地均匀随机抽取一个肽-MHC复合物。该池被分为三个不相交的集合：强结合物、中等结合物和弱结合物。\n\n让我们定义单次随机遭遇的概率：\n- 遇到强结合物的概率 $p_s$ 是强结合物数量与肽总数之比：\n$$p_s = \\frac{n_s}{N}$$\n- 遇到中等结合物的概率 $p_m$ 是：\n$$p_m = \\frac{n_m}{N}$$\n- 遇到弱结合物的概率 $p_w$ 是：\n$$p_w = \\frac{N - n_s - n_m}{N}$$\n对于单次遭遇，这三个事件是互斥且穷尽的，因此 $p_s + p_m + p_w = 1$。\n\n胸腺细胞存活的条件是在 $m$ 次遭遇中，必须同时满足两个条件：\n1. 事件 $A$：没有遇到强结合物。\n2. 事件 $B$：至少遇到一个中等结合物。\n\n我们必须计算这两个事件的交集概率，$P(A \\cap B)$。\n使用补集事件通常更简单。我们使用全概率法则，即 $P(A) = P(A \\cap B) + P(A \\cap B^c)$，其中 $B^c$ 是事件 $B$ 的补集。整理后得到：\n$$P(A \\cap B) = P(A) - P(A \\cap B^c)$$\n\n让我们分析每一项：\n事件 $A$ 是“在 $m$ 次试验中没有遇到强结合物”。这意味着在 $m$ 次独立试验的每一次中，结果都不能是强结合物。单次试验不遇到强结合物的概率是 $1 - p_s = p_m + p_w = \\frac{N - n_s}{N}$。由于试验是独立的，所有 $m$ 次试验都发生这种情况的概率是：\n$$P(A) = \\left(1 - p_s\\right)^m = \\left(\\frac{N - n_s}{N}\\right)^m$$\n\n事件 $B^c$ 是事件 $B$ 的补集，意为“在 $m$ 次试验中没有遇到中等结合物”。\n事件 $A \\cap B^c$ 是“在 $m$ 次试验中没有遇到强结合物 并且 没有遇到中等结合物”。这等价于所有 $m$ 次遭遇都必须是与弱结合物。单次试验遇到弱结合物的概率是 $p_w$。由于试验是独立的，所有 $m$ 次试验都发生这种情况的概率是：\n$$P(A \\cap B^c) = (p_w)^m = \\left(\\frac{N - n_s - n_m}{N}\\right)^m$$\n\n现在，我们可以将这些结果代回到我们所求的概率表达式中，$P(\\text{存活}) = P(A \\cap B)$：\n$$P(\\text{存活}) = P(A) - P(A \\cap B^c) = \\left(\\frac{N - n_s}{N}\\right)^m - \\left(\\frac{N - n_s - n_m}{N}\\right)^m$$\n\n我们得到的数值为：$N = 10000$，$n_s = 12$，$n_m = 180$，$m = 300$。\n让我们将这些值代入公式。\n首先，计算指数的底数：\n- 第一项的底数是 $\\frac{N - n_s}{N} = \\frac{10000 - 12}{10000} = \\frac{9988}{10000} = 0.9988$。\n- 第二项的底数是 $\\frac{N - n_s - n_m}{N} = \\frac{10000 - 12 - 180}{10000} = \\frac{9808}{10000} = 0.9808$。\n\n那么概率是：\n$$P(\\text{存活}) = (0.9988)^{300} - (0.9808)^{300}$$\n\n现在，我们计算这些项的数值。\n$(0.9988)^{300} \\approx 0.697529366$\n$(0.9808)^{300} \\approx 0.002981358$\n\n最终的概率是这两个值之差：\n$$P(\\text{存活}) \\approx 0.697529366 - 0.002981358 = 0.694548008$$\n\n问题要求结果四舍五入到四位有效数字。\n计算出的概率是 $0.694548008...$。前四位有效数字是 $6$、$9$、$4$ 和 $5$。第五位有效数字是 $4$，小于 $5$，所以我们向下舍入。\n最终结果是 $0.6945$。", "answer": "$$\\boxed{0.6945}$$", "id": "2600008"}, {"introduction": "在单个淋巴细胞被成功激活后，其后代会进行大规模的克隆扩增，这是适应性免疫应答的关键特征。本练习要求你从基本原理出发，推导出一个描述T细胞克隆在连续细胞周期中预期数量增长的数学模型 [@problem_id:2600015]。通过这个推导，你将清晰地看到，基于单个细胞的分裂概率 $p$ 和死亡概率 $d$ 的微观规则，如何决定了整个细胞群体的宏观动态。", "problem": "在适应性免疫应答过程中，抗原特异性T淋巴细胞发生克隆扩增，其中白细胞介素-2 (IL-2) 的有限信号传导限制了单个细胞的增殖和存活。考虑在所关注的时间窗口内，一个抗原特异性克隆在一个白细胞介素-2 (IL-2) 供应量固定的均匀混合环境中，经历离散的细胞周期进行演化。对于周期开始时存在的每个细胞，其在每个周期中的模型如下：\n- 细胞以概率 $p$ 在该周期内完成一次分裂，到下一周期开始时产生 $2$ 个存活的子细胞；\n- 细胞以概率 $d$ 在该周期内发生凋亡，到下一周期开始时产生 $0$ 个细胞；\n- 细胞以概率 $1 - p - d$ 在该周期内既不分裂也不死亡，到下一周期开始时仍为 $1$ 个存活的细胞。\n\n假设 $0 \\leq p \\leq 1$, $0 \\leq d \\leq 1$ 且 $p + d \\leq 1$。假设在固定的 IL-2 环境条件下，这些结果在不同细胞和不同周期之间是相互独立的。设 $N_0$ 表示在周期 $0$ 时的克隆初始大小，设 $N_n$ 表示完成 $n$ 个周期后的克隆大小。\n\n请从分支过程中期望和独立性的基本定义出发，不借助任何预先推导的增长公式，推导期望克隆大小 $\\mathbb{E}[N_n]$ 关于 $N_0$、$p$、$d$ 和 $n$ 的闭式表达式。在推导过程中，请明确说明对差值 $p - d$ 的依赖性是如何从 IL-2 限制下的单细胞结果中产生的。请以 $N_0$、$p$、$d$ 和 $n$ 表示的单个闭式解析表达式的形式给出最终结果。不要进行近似或四舍五入。", "solution": "题干需经过验证。\n\n按原文提取已知条件如下：\n- 单个抗原特异性克隆在离散的细胞周期中演化。\n- 环境中的白细胞介素-2 (IL-2) 供应量是固定的。\n- 对于每个周期开始时的细胞：\n    - 以概率 $p$ 分裂，产生 $2$ 个子细胞。\n    - 以概率 $d$ 发生凋亡，产生 $0$ 个细胞。\n    - 以概率 $1 - p - d$ 既不分裂也不死亡，仍为 $1$ 个细胞。\n- 约束条件：$0 \\leq p \\leq 1$，$0 \\leq d \\leq 1$，且 $p + d \\leq 1$。\n- 不同细胞和不同周期的结果相互独立。\n- $N_0$ 是周期 $0$ 时的初始克隆大小。\n- $N_n$ 是完成 $n$ 个周期后的克隆大小。\n- 任务是从基本原理出发，推导期望克隆大小 $\\mathbb{E}[N_n]$ 的闭式表达式。\n\n标准验证：\n- **科学依据**：该模型是淋巴细胞群体动力学（一个分支过程）的简化但标准的表示，其基础是关于克隆扩增、IL-2信号传导、细胞分裂和凋亡的既定免疫学原理。作为一个建模练习，它在科学上是合理的。\n- **适定性**：该问题是适定的。它提供了所有必要的参数（$N_0$，$p$，$d$，$n$）和一个清晰的概率结构。其目标——求期望值 $\\mathbb{E}[N_n]$——是一个数学上精确且可解的任务。\n- **客观性**：问题以精确、客观的语言陈述，没有歧义或主观论断。\n\n该问题没有科学或事实上的不合理之处，是可形式化、完整且内部一致的。它是随机过程在生物学中应用的一个标准问题，并且并非微不足道。因此，该问题被认定为有效。\n\n推导过程从期望值的基本定义和条件期望的性质出发。设 $N_n$ 为第 $n$ 个周期结束时克隆中的细胞数量的随机变量。初始种群大小 $N_0$ 是一个给定的常数。\n\n第 $n$ 个周期的细胞数 $N_n$ 是该周期开始时存在的 $N_{n-1}$ 个细胞所产生后代的总和。设 $X_i$ 是表示第 $i$ 个细胞在一个周期内产生的子细胞数量的随机变量。$X_i$ 的概率分布如下：\n$$\nP(X_i = 2) = p \\\\\nP(X_i = 0) = d \\\\\nP(X_i = 1) = 1 - p - d\n$$\n因为所有细胞的命运相互独立，所以所有的 $X_i$ 都是独立同分布的 (i.i.d.)。\n\n第 $n$ 个周期的总种群可以表示为第 $n-1$ 个周期种群产生的后代总和：\n$$\nN_n = \\sum_{i=1}^{N_{n-1}} X_i^{(n-1)}\n$$\n其中 $X_i^{(n-1)}$ 表示在第 $n$ 个周期开始时存在的第 $i$ 个细胞的后代数量。\n\n为了求得期望值 $\\mathbb{E}[N_n]$，我们使用全期望定律（也称为塔性质）：\n$$\n\\mathbb{E}[N_n] = \\mathbb{E}[\\mathbb{E}[N_n | N_{n-1}]]\n$$\n首先，我们计算内部的条件期望 $\\mathbb{E}[N_n | N_{n-1}]$。给定在第 $n-1$ 个周期时克隆大小为 $N_{n-1}$，我们有：\n$$\n\\mathbb{E}[N_n | N_{n-1}] = \\mathbb{E}\\left[\\sum_{i=1}^{N_{n-1}} X_i^{(n-1)} \\Big| N_{n-1}\\right]\n$$\n根据期望的线性性质，并且因为 $N_{n-1}$ 在条件期望中被视为一个常数，上式变为：\n$$\n\\mathbb{E}[N_n | N_{n-1}] = \\sum_{i=1}^{N_{n-1}} \\mathbb{E}[X_i^{(n-1)} | N_{n-1}]\n$$\n由于每个细胞的结果与细胞总数无关，所以 $\\mathbb{E}[X_i^{(n-1)} | N_{n-1}] = \\mathbb{E}[X_i^{(n-1)}]$。由于所有的 $X_i$ 是同分布的，我们将其共同的均值定义为 $\\mu$：\n$$\n\\mu = \\mathbb{E}[X_i]\n$$\n因此，条件期望简化为：\n$$\n\\mathbb{E}[N_n | N_{n-1}] = \\sum_{i=1}^{N_{n-1}} \\mu = N_{n-1} \\mu\n$$\n现在，我们根据定义计算 $\\mu$，即每个细胞在每个周期内的平均后代数：\n$$\n\\mu = (2 \\cdot P(X_i=2)) + (0 \\cdot P(X_i=0)) + (1 \\cdot P(X_i=1))\n$$\n$$\n\\mu = 2p + 0 \\cdot d + 1(1 - p - d) = 2p + 1 - p - d = 1 + p - d\n$$\n这个表达式 $\\mu = 1 + p - d$ 是每个周期细胞种群的平均增殖因子。项 $p-d$ 代表了分裂与凋亡对种群数量的净效应。如果 $p>d$，克隆倾向于扩张；如果 $p<d$，克隆倾向于收缩。这明确地展示了题目所要求的，对差值 $p-d$ 的依赖性是如何从单细胞的结果中产生的。\n\n将 $\\mathbb{E}[N_n | N_{n-1}]$ 的表达式代回到全期望定律中：\n$$\n\\mathbb{E}[N_n] = \\mathbb{E}[N_{n-1} \\mu]\n$$\n由于 $\\mu$ 是一个常数，可以将其从期望中提出：\n$$\n\\mathbb{E}[N_n] = \\mu \\mathbb{E}[N_{n-1}] = (1 + p - d) \\mathbb{E}[N_{n-1}]\n$$\n这是一个关于期望克隆大小的一阶线性递推关系。我们可以从 $n=0$ 开始，通过迭代来求解它：\n初始条件是 $\\mathbb{E}[N_0] = N_0$，因为 $N_0$ 是一个给定的常数。\n对于 $n=1$：\n$$\n\\mathbb{E}[N_1] = (1 + p - d) \\mathbb{E}[N_0] = N_0(1 + p - d)\n$$\n对于 $n=2$：\n$$\n\\mathbb{E}[N_2] = (1 + p - d) \\mathbb{E}[N_1] = (1 + p - d) [N_0(1 + p - d)] = N_0(1 + p - d)^2\n$$\n通过数学归纳法，我们可以为任意整数 $n \\ge 0$ 建立通项公式。假设 $\\mathbb{E}[N_k] = N_0(1+p-d)^k$ 对某个 $k$ 成立。那么对于 $k+1$：\n$$\n\\mathbb{E}[N_{k+1}] = (1 + p - d) \\mathbb{E}[N_k] = (1 + p - d) [N_0(1+p-d)^k] = N_0(1+p-d)^{k+1}\n$$\n该公式对 $k+1$ 也成立。因此，经过 $n$ 个周期后，期望克隆大小的闭式表达式为：\n$$\n\\mathbb{E}[N_n] = N_0(1 + p - d)^n\n$$\n这就是按题目要求从第一性原理推导出的最终结果。", "answer": "$$\\boxed{N_0(1 + p - d)^{n}}$$", "id": "2600015"}, {"introduction": "适应性免疫系统不仅要能有效清除病原体，还必须应对病原体通过抗原漂变等方式进行的免疫逃逸。这项最终的实践练习要求你构建一个计算模型，来模拟已建立的记忆抗体库如何应对发生抗原漂变的病毒 [@problem_id:2600020]。通过编写代码并分析结果，你将探索抗原距离、抗体交叉反应性以及免疫应答的广度与亲和力之间的定量关系，这些都是理解流感病毒免疫和疫苗设计的核心议题。", "problem": "你的任务是构建并评估一个最小化的、有原则的模型，该模型使用一个抗原空间表示法来描述抗原漂移如何改变血清抗体的有效广度和亲和力，其中交叉反应性随抗原距离的增加而衰减。该模型必须基于适应性免疫中以下基础且经过充分检验的事实：(i) B淋巴细胞（B细胞）的克隆选择产生独特的抗体特异性，(ii) 免疫记忆编码了一组分布在先前遇到的抗原周围的抗体特异性，以及 (iii) 经验上，交叉反应性随着抗体互补位与抗原表位之间抗原距离的增加而衰减。你的任务是将这些原则转化为一个定量且可检验的算法，该算法能计算因抗原从原始抗原发生漂移而产生的两个指标。\n\n需使用的模型定义和假设：\n- 抗原空间是一个2维欧几里得平面 $\\mathbb{R}^2$。最初遇到的抗原位于原点 $(0,0)$。\n- 记忆血清抗体库由 $N$ 个权重相同的B细胞衍生克隆中心表示，这些中心均匀分布在围绕原点、半径为 $r$ 的圆上。具体来说，对于 $i \\in \\{0,1,\\dots,N-1\\}$，\n  $$\\mu_i = \\left(r \\cos\\left(\\frac{2\\pi i}{N}\\right),\\ r \\sin\\left(\\frac{2\\pi i}{N}\\right)\\right)。$$\n  所有克隆权重相等且总和为 $1$，因此每个克隆的权重为 $w_i = 1/N$。\n- 交叉反应性通过一个仅依赖于抗原距离的高斯核进行建模。对于位于位置 $x \\in \\mathbb{R}^2$ 的抗原和克隆中心 $\\mu_i$，单个克隆的结合亲和力为\n  $$K\\!\\left(\\|x - \\mu_i\\|\\right) = \\exp\\!\\left(-\\frac{\\|x - \\mu_i\\|^2}{2\\tau^2}\\right),$$\n  其中 $\\tau > 0$ 是交叉反应长度尺度，$\\|\\cdot\\|$ 是欧几里得范数。\n- 抗原漂移使抗原从原点移动了一个极坐标形式为 $(\\delta,\\phi)$ 的向量，即\n  $$x = \\left(\\delta \\cos\\phi,\\ \\delta \\sin\\phi\\right),$$\n  其中 $\\delta \\ge 0$ 是漂移幅度，$\\phi$ 是漂移角度（以弧度为单位）。\n- 定义一个功能性结合的阳性阈值 $\\alpha_{\\min} \\in (0,1)$。一个克隆当且仅当其亲和力达到或超过该阈值时，被认为具有功能性贡献：\n  $$K\\!\\left(\\|x - \\mu_i\\|\\right) \\ge \\alpha_{\\min}。$$\n\n每个测试用例需计算的量：\n- 广度 $B$ 是满足阈值条件的克隆所占的比例，按 $w_i$（此处均相等）加权。由于所有 $w_i$ 都相等，这简化为满足 $K(\\|x-\\mu_i\\|) \\ge \\alpha_{\\min}$ 的索引 $i$ 的比例。形式上，\n  $$B = \\frac{\\sum_{i=0}^{N-1} w_i \\,\\mathbf{1}\\!\\left[K\\!\\left(\\|x-\\mu_i\\|\\right) \\ge \\alpha_{\\min}\\right]}{\\sum_{i=0}^{N-1} w_i} = \\frac{1}{N}\\sum_{i=0}^{N-1} \\mathbf{1}\\!\\left[K\\!\\left(\\|x-\\mu_i\\|\\right) \\ge \\alpha_{\\min}\\right]。$$\n- 贡献克隆的平均亲和力 $A$ 是满足阈值条件的克隆的 $K(\\|x-\\mu_i\\|)$ 的权重归一化均值。如果没有克隆满足阈值，则定义 $A=0$。形式上，设 $S=\\{i: K(\\|x-\\mu_i\\|)\\ge \\alpha_{\\min}\\}$，\n  $$A = \\begin{cases}\n  \\dfrac{\\sum_{i \\in S} w_i\\, K\\!\\left(\\|x - \\mu_i\\|\\right)}{\\sum_{i \\in S} w_i}, & \\text{若 } |S| > 0, \\\\\n  0, & \\text{若 } |S| = 0.\n  \\end{cases}$$\n\n所有测试用例的固定抗体库配置：\n- 克隆数 $N = 8$。\n- 抗体库半径 $r = 2.0$ (无量纲)。\n- 所有量均为无量纲；没有物理单位。\n\n输入规范（在程序中隐式给定）：对于每个测试用例，你将收到一个如上所述的参数元组 $(\\delta,\\phi,\\tau,\\alpha_{\\min})$。角度必须以弧度为单位进行解释。\n\n需实现的测试套件：\n- 用例 1: $(\\delta,\\phi,\\tau,\\alpha_{\\min}) = (1.5,\\ \\pi/6,\\ 1.0,\\ 0.2)$。\n- 用例 2: $(\\delta,\\phi,\\tau,\\alpha_{\\min}) = (0.0,\\ 0.0,\\ 1.0,\\ 0.5)$。\n- 用例 3: $(\\delta,\\phi,\\tau,\\alpha_{\\min}) = (5.0,\\ \\pi/3,\\ 1.0,\\ 0.1)$。\n- 用例 4: $(\\delta,\\phi,\\tau,\\alpha_{\\min}) = (3.0,\\ \\pi/2,\\ 2.0,\\ 0.2)$。\n- 用例 5: $(\\delta,\\phi,\\tau,\\alpha_{\\min}) = (2.0,\\ \\pi/4,\\ 0.8,\\ 0.4)$。\n- 用例 6: $(\\delta,\\phi,\\tau,\\alpha_{\\min}) = (3.0,\\ 0.0,\\ 0.5,\\ 0.7)$。\n\n要求的最终输出格式：\n- 你的程序应生成单行输出，包含一个由列表组成的逗号分隔列表，每个内部列表为对应测试用例的 $[B,A]$，顺序与上述列表相同。\n- 每个 $B$ 和 $A$ 必须打印为四舍五入到 $6$ 位小数的十进制浮点数。\n- 该单行输出必须如下所示：\n  $$\\texttt{[[B\\_1,A\\_1],[B\\_2,A\\_2],\\dots,[B\\_6,A\\_6]]}$$\n  前后不得有任何附加文本。\n\n你的交付成果必须是一个完整的、可运行的程序，该程序能为固定的抗体库配置和给定的测试套件计算指定的量，并以确切指定的格式打印结果。所有计算都是无量纲的。不允许用户输入或外部文件。", "solution": "问题陈述有效。其科学依据建立在公认的免疫学原理之上，定量表述清晰，且无矛盾或歧义。我们继续进行解答。\n\n任务是为一个抗体库响应抗原漂移的模型计算两个指标：广度`$B$`和平均亲和力`$A$`。该模型由一组固定参数和可变的测试用例参数定义。\n\n固定参数：\n- 抗体克隆数量：`$N = 8$`。\n- 记忆抗体库半径：`$r = 2.0$`。\n\n代表不同抗体特异性的克隆中心由向量`$\\mu_i$`给出，其中`$i \\in \\{0, 1, \\dots, N-1\\}$`：\n$$ \\mu_i = \\left(r \\cos\\left(\\frac{2\\pi i}{N}\\right),\\ r \\sin\\left(\\frac{2\\pi i}{N}\\right)\\right) $$\n\n最初位于原点`$(0,0)$`的抗原，漂移到一个由极坐标`$(\\delta, \\phi)$`定义的新位置`$x$`：\n$$ x = (\\delta \\cos\\phi, \\delta \\sin\\phi) $$\n\n第`$i$`个克隆对位于`$x$`处的漂移抗原的结合亲和力`$K_i$`，通过欧几里得距离`$\\|x - \\mu_i\\|$`的高斯函数进行建模：\n$$ K_i = K(\\|x - \\mu_i\\|) = \\exp\\left(-\\frac{\\|x - \\mu_i\\|^2}{2\\tau^2}\\right) $$\n其中`$\\tau$`是交叉反应长度尺度。\n\n如果一个克隆的亲和力`$K_i$`达到或超过阈值`$\\alpha_{\\min}$`，则该克隆被认为具有功能性贡献。具有贡献的克隆的索引集合表示为`$S = \\{i : K_i \\ge \\alpha_{\\min}\\}$`。\n\n需要计算的两个量是：\n1.  广度`$B$`：具有功能性贡献的克隆所占的比例。由于克隆权重`$w_i = 1/N$`是均一的，这简化为有贡献的克隆数与总克隆数的比值。\n    $$ B = \\frac{|S|}{N} $$\n2.  平均亲和力`$A$`：有贡献克隆的平均亲和力。如果没有克隆做出贡献（`$S$`为空），则`$A=0$`。同样，由于权重均一，这即为简单的算术平均值。\n    $$ A = \\begin{cases} \\frac{1}{|S|} \\sum_{i \\in S} K_i, & \\text{若 } |S| > 0 \\\\ 0, & \\text{若 } |S| = 0 \\end{cases} $$\n\n对于每个测试用例`$(\\delta, \\phi, \\tau, \\alpha_{\\min})$`的计算流程如下：\n\n1.  **构建抗体库**：使用给定公式和`$r=2.0$`生成`$N=8$`个克隆中心的坐标`$\\mu_i$`。这些坐标存储为一组二维向量。\n\n2.  **确定抗原位置**：根据其极坐标`$(\\delta, \\phi)`计算漂移抗原`$x$`的笛卡尔坐标。\n\n3.  **计算所有亲和力**：对于从`$0$`到`$7$`的每个克隆`$i$`：\n    a. 计算欧几里得距离的平方`$d_i^2 = \\|x - \\mu_i\\|^2$`。\n    b. 计算亲和力`$K_i = \\exp(-d_i^2 / (2\\tau^2))$`。\n\n4.  **识别贡献克隆**：通过将每个计算出的亲和力`$K_i$`与阈值`$\\alpha_{\\min}$`进行比较，创建一个布尔掩码。如果`$K_i \\ge \\alpha_{\\min}$`，则该克隆有贡献。\n\n5.  **计算广度`$B$`**：有贡献的克隆数`$|S|$`是布尔掩码中`true`值的数量。则广度为`$B = |S| / N$`。\n\n6.  **计算平均亲和力`$A$`**：\n    a. 如果`$|S| > 0$`，平均亲和力`$A$`是有贡献克隆的亲和力的算术平均值。\n    b. 如果`$|S| = 0$`，则`$A$`设为`$0$`。\n\n该算法为提高效率而采用向量运算实现，并应用于所有六个指定的测试用例。计算得到的`$[B, A]``对按要求格式化为`$6$`位小数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_metrics(delta, phi, tau, alpha_min, N, r):\n    \"\"\"\n    Computes breadth B and mean affinity A for a given set of parameters.\n\n    Args:\n        delta (float): Antigenic drift magnitude.\n        phi (float): Antigenic drift angle in radians.\n        tau (float): Cross-reactivity length scale.\n        alpha_min (float): Functional binding affinity threshold.\n        N (int): Number of antibody clones.\n        r (float): Radius of the memory repertoire.\n\n    Returns:\n        tuple: A tuple containing (breadth, mean_affinity).\n    \"\"\"\n    # 1. Construct Repertoire: Generate clone center coordinates\n    # Create an array of clone indices from 0 to N-1\n    i_vals = np.arange(N)\n    # Calculate the angle for each clone\n    thetas = 2 * np.pi * i_vals / N\n    # Calculate the cartesian coordinates for all clone centers using vectorization\n    mu = r * np.stack((np.cos(thetas), np.sin(thetas)), axis=1)\n\n    # 2. Determine Antigen Position: Calculate cartesian coordinates of the antigen\n    x = np.array([delta * np.cos(phi), delta * np.sin(phi)])\n\n    # 3. Calculate All Affinities\n    # Calculate the squared Euclidean distance from the antigen to each clone center\n    # Broadcasting is used here: mu is (N, 2), x is (2,), so (mu - x) is (N, 2)\n    dist_sq = np.sum((mu - x)**2, axis=1)\n    # Calculate the affinity for each clone\n    affinities = np.exp(-dist_sq / (2 * tau**2))\n\n    # 4. Identify Contributing Clones using a boolean mask\n    contributing_mask = affinities >= alpha_min\n    \n    # 5. Compute Breadth B\n    num_contributing = np.sum(contributing_mask)\n    breadth = num_contributing / N\n    \n    # 6. Compute Mean Affinity A\n    if num_contributing > 0:\n        # Calculate the mean of affinities for only the contributing clones\n        mean_affinity = np.mean(affinities[contributing_mask])\n    else:\n        # As per the definition, A is 0 if no clones contribute\n        mean_affinity = 0.0\n\n    return breadth, mean_affinity\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the result.\n    \"\"\"\n    # Fixed repertoire configuration\n    N = 8\n    r = 2.0\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.5, np.pi/6, 1.0, 0.2),\n        (0.0, 0.0, 1.0, 0.5),\n        (5.0, np.pi/3, 1.0, 0.1),\n        (3.0, np.pi/2, 2.0, 0.2),\n        (2.0, np.pi/4, 0.8, 0.4),\n        (3.0, 0.0, 0.5, 0.7),\n    ]\n\n    results = []\n    for case in test_cases:\n        delta, phi, tau, alpha_min = case\n        B, A = compute_metrics(delta, phi, tau, alpha_min, N=N, r=r)\n        results.append((B, A))\n\n    # Format the final output string exactly as specified.\n    # Each pair [B, A] is formatted to 6 decimal places.\n    # The pairs are joined by commas, and the whole list is enclosed in brackets.\n    formatted_pairs = [f\"[{b:.6f},{a:.6f}]\" for b, a in results]\n    final_output_string = f\"[{','.join(formatted_pairs)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```", "id": "2600020"}]}