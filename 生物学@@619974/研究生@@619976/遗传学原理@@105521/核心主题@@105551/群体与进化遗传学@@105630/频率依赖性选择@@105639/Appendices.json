{"hands_on_practices": [{"introduction": "在群体遗传学中，进化博弈论 (Evolutionary Game Theory, EGT) 为我们分析频率依赖性选择提供了强有力的框架。此练习将指导您完成一个基础但至关重要的任务：将个体间的相互作用收益（由一个支付矩阵 $$\n\\begin{pmatrix}\n\\alpha & \\beta \\\\\n\\gamma & \\delta\n\\end{pmatrix}\n$$ 定义）转化为等位基因的期望适应度，并由此推导出内部平衡点。这个练习是理解和分析频率依赖动态的基石，它让您亲手建立模型并求解两种策略能够稳定共存的条件 [@problem_id:2811537]。", "problem": "一个大的、混合均匀的单倍体种群，在单个基因座上携带两个等位基因（记为 $A$ 和 $a$），其频率分别为 $p$ 和 $1-p$。每一代中，个体参与一次随机的成对相互作用。该相互作用是对称的，并由以下 $2 \\times 2$ 收益矩阵刻画\n$$\n\\begin{pmatrix}\n\\alpha & \\beta \\\\\n\\gamma & \\delta\n\\end{pmatrix},\n$$\n其中第 $i$ 行第 $j$ 列的元素表示焦点类型 $i \\in \\{A,a\\}$ 与类型 $j \\in \\{A,a\\}$ 配对时的繁殖收益。假设如下：\n- 来自相互作用的繁殖收益与该代的绝对适应度成正比。\n- 无突变、迁移或遗传漂变，且世代是离散且不重叠的。\n- 配对是随机的，因此遇到等位基因 $A$ 的概率为 $p$，遇到等位基因 $a$ 的概率为 $1-p$。\n\n仅从“在离散时间的单倍体选择中，下一代的等位基因频率与当前频率乘以其期望绝对适应度成正比”这一基本原理出发，推导在随机匹配条件下 $p$ 的等位基因频率动态。然后，在内部平衡存在的情况下，用 $\\alpha$、$\\beta$、$\\gamma$ 和 $\\delta$ 来确定内部平衡等位基因频率 $p^{\\ast}$（满足 $0 < p^{\\ast} < 1$）。将最终答案表示为 $p^{\\ast}$ 的单一闭式符号表达式。如果存在多个平衡点，请报告内部平衡点。不需要进行数值近似。", "solution": "对问题陈述进行验证。\n\n**第一步：提取已知条件**\n- 种群：大的、混合均匀的、单倍体。\n- 等位基因：$A$ 和 $a$。\n- 频率：等位基因 $A$ 的频率为 $p$，等位基因 $a$ 的频率为 $1-p$。\n- 相互作用：每一代进行一次单一的、随机的、成对的相互作用，且作用是对称的。\n- 收益矩阵：\n$$\n\\begin{pmatrix}\n\\alpha & \\beta \\\\\n\\gamma & \\delta\n\\end{pmatrix}\n$$\n其中第 $i$ 行第 $j$ 列的元素是类型 $i$ 与类型 $j$ 相互作用时类型 $i$ 的收益。\n- 假设：\n  1. 繁殖收益与绝对适应度成正比。\n  2. 无突变、迁移或遗传漂变。\n  3. 世代是离散且不重叠的。\n  4. 配对是随机的。\n- 基本原理：下一代的等位基因频率与当前频率乘以其期望绝对适应度成正比。\n- 目标：推导 $p$ 的等位基因频率动态，并确定内部平衡等位基因频率 $p^{\\ast}$（其中 $0 < p^{\\ast} < 1$）。\n\n**第二步：使用提取的已知条件进行验证**\n- **科学依据：** 该问题描述了群体遗传学中频率依赖选择的一个经典模型，通常在演化博弈论的框架内进行分析。它在科学上是合理的，并且是一个基本概念。\n- **适定性：** 该问题提供了推导所要求的方程及其平衡点所需的所有必要信息（等位基因、频率、通过收益矩阵定义的适应度结构，以及动态原理）。它正确地指定了寻找一个*内部*平衡点，并承认存在其他平衡点（$p=0, p=1$）。\n- **客观性：** 该问题使用形式化的数学语言和符号参数进行陈述，没有任何主观或模糊的术语。\n\n**第三步：结论与行动**\n该问题是有效的。这是数学生物学中一个定义明确的练习。我们将继续进行推导。\n\n该问题的核心在于将频率依赖适应度的概念形式化，并应用离散时间选择的原理。设 $W_A$ 和 $W_a$ 分别是携带等位基因 $A$ 和 $a$ 的个体的期望绝对适应度。\n\n在随机配对的情况下，一个 $A$ 类型的个体以概率 $p$ 与另一个 $A$ 类型个体相互作用，以概率 $1-p$ 与一个 $a$ 类型个体相互作用。这些相互作用的收益为 $\\alpha$ 和 $\\beta$。因此，$A$ 类型个体的期望适应度是这些收益的加权平均值：\n$$\nW_A = p \\cdot \\alpha + (1-p) \\cdot \\beta\n$$\n同样地，一个 $a$ 类型的个体以概率 $p$ 与 $A$ 类型相互作用（收益为 $\\gamma$），以概率 $1-p$ 与 $a$ 类型相互作用（收益为 $\\delta$）。$a$ 类型个体的期望适应度是：\n$$\nW_a = p \\cdot \\gamma + (1-p) \\cdot \\delta\n$$\n整个种群的平均适应度 $\\bar{W}$ 是个体适应度按其频率加权的平均值：\n$$\n\\bar{W} = p \\cdot W_A + (1-p) \\cdot W_a\n$$\n问题陈述，下一代中一个等位基因的频率是其在当前代中的频率乘以其相对适应度。设 $p'$ 为下一代中等位基因 $A$ 的频率。根据所提供的基本原理：\n$$\np' = p \\frac{W_A}{\\bar{W}}\n$$\n这个方程描述了等位基因频率的动态。平衡是等位基因频率从一代到下一代不发生变化的状态，即 $p' = p$。这个条件，表示为 $\\Delta p = p' - p = 0$，在以下情况下满足：\n$$\np \\frac{W_A}{\\bar{W}} = p\n$$\n如果 $p=0$ 或者 $\\frac{W_A}{\\bar{W}} = 1$，则该方程有解，后者意味着 $W_A = \\bar{W}$。代入 $\\bar{W}$ 的定义：\n$$\nW_A = p W_A + (1-p) W_a\n$$\n$$\n(1-p)W_A = (1-p)W_a\n$$\n如果 $p=1$ 或者 $W_A = W_a$，则此条件得到满足。\n\n我们的任务是找到*内部*平衡点 $p^{\\ast}$，满足 $0 < p^{\\ast} < 1$。这个平衡点可以通过将两种类型的适应度设为相等来找到：\n$$\nW_A = W_a\n$$\n在平衡频率 $p^{\\ast}$ 处，代入 $W_A$ 和 $W_a$ 的表达式：\n$$\np^{\\ast}\\alpha + (1-p^{\\ast})\\beta = p^{\\ast}\\gamma + (1-p^{\\ast})\\delta\n$$\n我们现在求解这个关于 $p^{\\ast}$ 的线性方程。首先，展开各项：\n$$\np^{\\ast}\\alpha + \\beta - p^{\\ast}\\beta = p^{\\ast}\\gamma + \\delta - p^{\\ast}\\delta\n$$\n接下来，将所有包含 $p^{\\ast}$ 的项移到一边，常数项移到另一边：\n$$\np^{\\ast}\\alpha - p^{\\ast}\\beta - p^{\\ast}\\gamma + p^{\\ast}\\delta = \\delta - \\beta\n$$\n提取公因子 $p^{\\ast}$：\n$$\np^{\\ast}(\\alpha - \\beta - \\gamma + \\delta) = \\delta - \\beta\n$$\n假设系数 $(\\alpha - \\beta - \\gamma + \\delta)$ 非零，我们可以分离出 $p^{\\ast}$：\n$$\np^{\\ast} = \\frac{\\delta - \\beta}{\\alpha - \\beta - \\gamma + \\delta}\n$$\n这就是内部平衡等位基因频率的符号表达式。它作为一个有效频率（即 $0 < p^{\\ast} < 1$）是否存在，取决于收益参数 $\\alpha$、$\\beta$、$\\gamma$ 和 $\\delta$ 的具体值。具体来说，为了使 $p^{\\ast}$ 介于 $0$ 和 $1$ 之间，分子 $\\delta - \\beta$ 和分母 $\\alpha - \\beta - \\gamma + \\delta$ 必须同号，且分子的绝对值必须小于分母的绝对值。然而，问题只要求给出表达式本身。", "answer": "$$\\boxed{\\frac{\\delta - \\beta}{\\alpha - \\beta - \\gamma + \\delta}}$$", "id": "2811537"}, {"introduction": "在我们学会了如何求解平衡点之后，下一步是深入理解其动态特性。这个练习提出了一个发人深省的场景，旨在对比两种维持多态性的关键机制：负频率依赖性选择 (Negative Frequency-Dependent Selection, NFDS) 和超显性 (Overdominance)。通过计算和比较平衡点附近的“恢复斜率” $\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{*}}$, 您将定量地探索当一个群体偏离平衡时，其恢复平衡的速度，从而揭示这两种选择模式在本质上的微妙而关键的区别 [@problem_id:2811536]。", "problem": "在一个随机交配的离散世代种群中，一个具有等位基因 $A$ 和 $a$ 的常染色体基因座在生存力选择下发生分离。考虑两种模型，它们都能产生一个稳定的内部平衡等位基因频率，但它们对偏离平衡的选择响应方式不同。\n\n模型 $\\mathrm{OD}$ (超显性): 基因型生存力是恒定的，由 $w_{AA}=1-s$，$w_{Aa}=1$，$w_{aa}=1-t$ 给出，其中 $s>0$ 且 $t>0$，同时 $s<1$ 且 $t<1$，以确保所有生存力均为正。\n\n模型 $\\mathrm{NFDS}$ (负频率依赖性选择): 构建一个对称的、二倍体的、频率依赖的生存力方案，使其具有与模型 $\\mathrm{OD}$ 相同的内部平衡等位基因频率 $p^{*}$。这需要满足以下条件：在 $p=p^{*}$ 时所有基因型的生存力均为 $1$；对于所有 $p\\in[0,1]$，杂合子的生存力 $w_{Aa}(p)\\equiv 1$；纯合子的生存力在 $p^{*}$ 周围线性变化，其变化量大小相等、符号相反，即 $w_{AA}(p)=1-\\kappa\\,(p-p^{*})$ 和 $w_{aa}(p)=1+\\kappa\\,(p-p^{*})$，其中 $\\kappa>0$ 且其值被选取得足够小，以确保在 $[0,1]$ 上所有生存力都保持为正。\n\n设 $\\Delta p$ 表示在每个模型下等位基因 $A$ 频率的单代变化，即 $\\Delta p=p'-p$。将局部恢复斜率定义为导数 $\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{*}}$，其绝对值概括了在受到微小扰动后恢复到平衡的一阶趋势强度。\n\n仅使用随机交配下的标准二倍体生存力选择递推式，并在共同的平衡点 $p^{*}$ 附近进行线性化，计算在模型 $\\mathrm{NFDS}$ 和模型 $\\mathrm{OD}$ 下这些局部恢复斜率的绝对值之比 $R$。该比值需用 $s$、$t$ 和 $\\kappa$ 以闭式形式表示。你的最终答案必须是一个单一的符号表达式。不要进行近似或四舍五入。", "solution": "该问题要求计算两种平衡选择模型——超显性（模型 OD）和负频率依赖性选择（模型 NFDS）——的局部恢复斜率的绝对值之比。在平衡等位基因频率 $p^{\\*}$ 处的局部恢复斜率被定义为等位基因频率单代变化的导数，即 $\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}}$。\n\n设 $p$ 为等位基因 $A$ 的频率，$q=1-p$ 为等位基因 $a$ 的频率。在一个随机交配的二倍体种群中，在生存力选择下，下一代中等位基因 $A$ 的频率 $p'$ 由下式给出：\n$$p' = \\frac{p^2 w_{AA} + pq w_{Aa}}{\\bar{w}}$$\n其中 $w_{ij}$ 是基因型生存力，$\\bar{w} = p^2 w_{AA} + 2pq w_{Aa} + q^2 w_{aa}$ 是种群的平均生存力。等位基因频率的单代变化为 $\\Delta p = p' - p$。代入 $p'$ 的表达式可得：\n$$\\Delta p = \\frac{p^2 w_{AA} + p(1-p) w_{Aa}}{\\bar{w}} - p = \\frac{p(p w_{AA} + (1-p) w_{Aa}) - p \\bar{w}}{\\bar{w}}$$\n$$\\Delta p = \\frac{p(p w_{AA} + (1-p) w_{Aa} - (p^2 w_{AA} + 2p(1-p) w_{Aa} + (1-p)^2 w_{aa}))}{\\bar{w}}$$\n简化分子可得到 $\\Delta p$ 的标准表达式：\n$$\\Delta p = \\frac{p(1-p)[p w_{AA} + (1-2p) w_{Aa} - (1-p) w_{aa}]}{\\bar{w}}$$\n当 $p \\in (0,1)$ 时，若 $\\Delta p = 0$，则存在一个内部平衡频率 $p^{\\*}$。这要求方括号中的项为零：\n$$p^{\\*} w_{AA} + (1-2p^{\\*}) w_{Aa} - (1-p^{\\*}) w_{aa} = 0$$\n\n为了求得局部恢复斜率，我们将 $\\Delta p$ 对 $p$ 求导，并在 $p^{\\*}$ 处取值。设 $\\Delta p(p) = \\frac{N(p)}{D(p)}$，其中 $N(p) = p(1-p)[p w_{AA} + (1-2p) w_{Aa} - (1-p) w_{aa}]$ 且 $D(p) = \\bar{w}(p)$。在平衡点 $p=p^{\\*}$ 处，$N(p^{\\*}) = 0$。其导数为：\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}} = \\frac{N'(p^{\\*})D(p^{\\*}) - N(p^{\\*})D'(p^{\\*})}{[D(p^{\\*})]^2} = \\frac{N'(p^{\\*})}{D(p^{\\*})} = \\frac{N'(p^{\\*})}{\\bar{w}(p^{\\*})}$$\n设 $F(p) = p w_{AA}(p) + (1-2p) w_{Aa}(p) - (1-p) w_{aa}(p)$，因此 $N(p) = p(1-p)F(p)$。那么 $N'(p) = (1-2p)F(p) + p(1-p)F'(p)$。在平衡点处，$F(p^{\\*})=0$，所以 $N'(p^{\\*}) = p^{\\*}(1-p^{\\*})F'(p^{\\*})$。\n因此，局部恢复斜率为：\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}} = \\frac{p^{\\*}(1-p^{\\*})F'(p^{\\*})}{\\bar{w}(p^{\\*})}$$\n\n首先，我们分析模型 OD。生存力是恒定的：$w_{AA}=1-s$，$w_{Aa}=1$，$w_{aa}=1-t$。\n平衡条件 $p^{\\*}(1-s) + (1-2p^{\\*})(1) - (1-p^{\\*})(1-t) = 0$ 可简化为 $p^{\\*}(-s-t)+t = 0$，由此得出平衡频率：\n$$p^{\\*} = \\frac{t}{s+t}$$\n平衡时等位基因 $a$ 的频率为 $1-p^{\\*} = \\frac{s}{s+t}$。\n对于模型 OD，生存力不是 $p$ 的函数，因此它们的导数为零。$F'(p) = \\frac{d}{dp}[p(1-s) + (1-2p) - (1-p)(1-t)] = (1-s) - 2 - (-(1-t)) = -s-t$。\n所以，$F'(p^{\\*}) = -(s+t)$。\n平衡时的平均生存力为：\n$$\\bar{w}_{\\mathrm{OD}}(p^{\\*}) = \\left(\\frac{t}{s+t}\\right)^2(1-s) + 2\\frac{st}{(s+t)^2} + \\left(\\frac{s}{s+t}\\right)^2(1-t) = \\frac{t^2-st^2+2st+s^2-s^2t}{(s+t)^2}$$\n$$\\bar{w}_{\\mathrm{OD}}(p^{\\*}) = \\frac{(s+t)^2 - st(s+t)}{(s+t)^2} = 1 - \\frac{st}{s+t}$$\n模型 OD 的斜率为：\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{OD}} = \\frac{p^{\\*}(1-p^{\\*})(-(s+t))}{1 - \\frac{st}{s+t}} = \\frac{(\\frac{t}{s+t})(\\frac{s}{s+t})(-(s+t))}{\\frac{s+t-st}{s+t}} = \\frac{-\\frac{st}{s+t}}{\\frac{s+t-st}{s+t}} = -\\frac{st}{s+t-st}$$\n此斜率的绝对值为 $\\left|\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{OD}}\\right| = \\frac{st}{s+t-st}$，因为 $s>0$，$t>0$ 且 $s,t<1$ 保证了分母为正。\n\n接下来，我们分析模型 NFDS。该模型被构造成具有相同的平衡点 $p^{\\*} = \\frac{t}{s+t}$。\n生存力是频率依赖的：$w_{AA}(p)=1-\\kappa(p-p^{\\*})$, $w_{Aa}(p)=1$, 和 $w_{aa}(p)=1+\\kappa(p-p^{\\*})$。\n在 $p=p^{\\*}$ 时，所有生存力都等于 $1$。平衡时的平均生存力为 $\\bar{w}_{\\mathrm{NFDS}}(p^{\\*}) = (p^{\\*})^2(1) + 2p^{\\*}(1-p^{\\*})(1) + (1-p^{\\*})^2(1) = 1$。\n现在我们为此模型计算 $F'(p^{\\*})$。函数 $F(p)$ 包含了频率依赖的生存力：\n$$F'(p) = \\frac{d}{dp}[p w_{AA}(p) + (1-2p) w_{Aa}(p) - (1-p) w_{aa}(p)]$$\n使用乘法法则：\n$$F'(p) = [w_{AA}(p) + p w'_{AA}(p)] - 2w_{Aa}(p) + w_{aa}(p) - (1-p)w'_{aa}(p)$$\n注意 $w'_{Aa}(p) = 0$。纯合子生存力的导数是 $w'_{AA}(p) = -\\kappa$ 和 $w'_{aa}(p) = \\kappa$。\n在 $p=p^{\\*}$ 处求值：\n$$F'(p^{\\*}) = [w_{AA}(p^{\\*}) + p^{\\*} w'_{AA}(p^{\\*})] - 2w_{Aa}(p^{\\*}) + w_{aa}(p^{\\*}) - (1-p^{\\*})w'_{aa}(p^{\\*})$$\n$$F'(p^{\\*}) = [1 + p^{\\*}(-\\kappa)] - 2(1) + 1 - (1-p^{\\*})(\\kappa)$$\n$$F'(p^{\\*}) = 1 - \\kappa p^{\\*} - 2 + 1 - \\kappa + \\kappa p^{\\*} = -\\kappa$$\n模型 NFDS 的斜率为：\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{NFDS}} = \\frac{p^{\\*}(1-p^{\\*})F'(p^{\\*})}{\\bar{w}_{\\mathrm{NFDS}}(p^{\\*})} = \\frac{p^{\\*}(1-p^{\\*})(-\\kappa)}{1} = -\\kappa p^{\\*}(1-p^{\\*})$$\n代入 $p^{\\*} = t/(s+t)$:\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{NFDS}} = -\\kappa \\frac{t}{s+t} \\frac{s}{s+t} = -\\frac{\\kappa st}{(s+t)^2}$$\n其绝对值为 $\\left|\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{NFDS}}\\right| = \\frac{\\kappa st}{(s+t)^2}$。\n\n最后，我们计算恢复斜率绝对值的比率 $R$，即模型 NFDS 与模型 OD 之比：\n$$R = \\frac{\\left|\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{NFDS}}\\right|}{\\left|\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{OD}}\\right|} = \\frac{\\frac{\\kappa st}{(s+t)^2}}{\\frac{st}{s+t-st}}$$\n$st$ 项可以消掉（因为 $s, t > 0$）：\n$$R = \\frac{\\kappa}{(s+t)^2} \\cdot (s+t-st) = \\frac{\\kappa (s+t-st)}{(s+t)^2}$$\n这就是用给定参数表示的比率的最终闭式表达式。", "answer": "$$\\boxed{\\frac{\\kappa(s+t-st)}{(s+t)^2}}$$", "id": "2811536"}, {"introduction": "基于对 NFDS 和超显性在理论上的区分，这最后一个实践将理论与实际应用联系起来。您将开发一种计算方法来分析时间序列基因型数据，例如来自快速进化的病原体的数据。此练习涉及实现选择的数学模型，并使用统计模型比较方法（如修正的赤池信息量准则, AICc）来推断哪种进化过程最能解释观察到的遗传变异，这是现代进化生物学中的一项核心任务 [@problem_id:2811510]。", "problem": "您会获得从一个二倍体病原体抗原基因座中，以每个离散世代采样一次的方式获得的纵向基因型计数数据。目标是仅使用这些基因型时间序列，构建一个定量的、基于似然的检验，以区分负频率依赖选择（NFDS）与超显性（杂合子优势，基因型适应度恒定）。您的程序必须从第一性原理出发实现这两种模型，通过最大似然法估计其参数，使用信息论准则对它们进行比较，并对每个数据集分类，判断哪个模型能更好地解释数据。\n\n所使用的基本依据包括群体遗传学和数量遗传学中以下经过充分检验的原则：\n- 在一个大的二倍体群体中进行随机交配，意味着在合子阶段基因型比例符合 Hardy–Weinberg 平衡：如果第 $t$ 代等位基因 $A$ 的频率为 $p_t \\in (0,1)$，那么选择前的基因型频率对于 $AA$ 是 $p_t^2$，对于 $Aa$ 是 $2 p_t (1-p_t)$，对于 $aa$ 是 $(1-p_t)^2$。\n- 选择通过相对适应度作用于基因型，下一代的等位基因频率 $p_{t+1}$ 可通过将合子基因型频率按其适应度加权，并应用 Mendelian 分离定律得出。这是标准的离散世代中的 Wright–Fisher 选择递推式。\n- 每个世代观察到的基因型计数（在选择前采样）服从独立的多项式抽样分布，其概率由该世代真实 $p_t$ 对应的 Hardy–Weinberg 基因型频率给出。\n- 校正的 Akaike 信息准则（AICc）为有限样本下基于似然的拟合提供了一种信息论的模型比较方法。\n\n需要实现的模型定义：\n- 超显性（OD）：恒定的基因型适应度，其中 $w_{AA} = 1 - s$, $w_{Aa} = 1$, $w_{aa} = 1 - t$，且 $s \\in (0,1)$ 和 $t \\in (0,1)$。等位基因频率递推式 $p_{t} \\mapsto p_{t+1}$ 必须根据上述原则推导。该模型的自由参数为 $(s, t, p_0)$，其中 $p_0 \\in (0,1)$ 是第一个观察世代中等位基因 $A$ 的初始频率。\n- 负频率依赖选择（NFDS）：等位基因特异性的适应度惩罚会随着当前等位基因频率的增加而增加，并对基因型适应度有加性贡献。设 $\\alpha_A \\in (0,1)$ 和 $\\alpha_a \\in (0,1)$ 分别量化作用于等位基因 $A$ 和 $a$ 的 NFDS 强度。在第 $t$ 代，通过平均等位基因的惩罚来定义依赖于等位基因频率的基因型适应度：$w_{AA}(p_t)$, $w_{Aa}(p_t)$, $w_{aa}(p_t)$。等位基因频率递推式 $p_{t} \\mapsto p_{t+1}$ 必须根据上述原则推导。该模型的自由参数为 $(\\alpha_A, \\alpha_a, p_0)$。\n\n需要实现的统计推断：\n- 对于一个给定模型 $M$，其参数向量为 $\\theta$，所隐含的等位基因频率轨迹为 $\\{p_t(\\theta)\\}_{t=0}^{T}$，那么观察到的基因型计数 $\\{(n_{AA,t}, n_{Aa,t}, n_{aa,t})\\}_{t=0}^{T}$ 的似然是各世代多项式概率的乘积，其概率为 $(p_t^2, 2 p_t (1-p_t), (1-p_t)^2)$。您必须使用对数似然 $\\ell(\\theta) = \\sum_{t=0}^{T} \\sum_{g \\in \\{AA,Aa,aa\\}} n_{g,t} \\log q_{g,t}$，其中 $q_{AA,t} = p_t^2$， $q_{Aa,t} = 2 p_t (1-p_t)$，$q_{aa,t} = (1-p_t)^2$。\n- 对每个模型，在其参数边界内数值最大化对数似然，以获得最大似然估计（MLE）和最大对数似然值 $\\ell_{\\max}$。\n- 为每个模型计算校正的 Akaike 信息准则（AICc），公式如下\n$$\n\\mathrm{AICc} = -2 \\,\\ell_{\\max} + 2 k + \\frac{2 k (k+1)}{n - k - 1},\n$$\n其中 $k$ 是模型的自由参数数量，$n$ 是观察到的世代数（即多项式观测的数量）。如果 $n - k - 1 \\le 0$，则使用 $\\mathrm{AIC} = -2 \\,\\ell_{\\max} + 2 k$。\n- 每个数据集的决策规则：如果 $\\mathrm{AICc}_{\\mathrm{NFDS}} + \\Delta < \\mathrm{AICc}_{\\mathrm{OD}}$，则选择 NFDS，否则选择 OD，其中 $\\Delta = 2.0$ 是选择阈值。如果选择 NFDS，则报告 $1$；如果选择 OD，则报告 $0$。\n\n必须遵守的实现细节：\n- 您必须根据上述原则为每个模型推导并实现等位基因频率递推式 $p_{t} \\mapsto p_{t+1}$，确保对于所有 $t$，都有 $p_t \\in (0,1)$，并且在给定的参数边界内适应度保持为正。\n- 优化器必须能处理边界约束，并且您应通过在计算 $\\log$ 时将概率的下限设定为远离 $0$ 的值来稳定计算，以避免出现未定义值。\n\n测试套件（三个数据集），以确保覆盖不同的动态情境：\n- 数据集 A（预期的类 OD 动态；从高 $p_t$ 单调趋近）：\n  - 按时间索引的基因型计数 $(n_{AA,t}, n_{Aa,t}, n_{aa,t})$，其中 $t = 0, 1, 2, 3, 4, 5, 6$：\n    - $[(256,128,16),(218,155,27),(184,175,41),(155,188,57),(131,196,73),(112,199,89),(98,200,102)]$\n- 数据集 B（预期的类 NFDS 动态；非对称的稀有等位基因优势）：\n  - 按时间索引的基因型计数 $(n_{AA,t}, n_{Aa,t}, n_{aa,t})$，其中 $t = 0, 1, 2, 3, 4, 5, 6$：\n    - $[(256,128,16),(221,153,26),(191,171,38),(164,184,52),(142,193,65),(124,197,79),(110,200,90)]$\n- 数据集 C（近中性边缘情况，在中间频率附近动态极为缓慢）：\n  - 按时间索引的基因型计数 $(n_{AA,t}, n_{Aa,t}, n_{aa,t})$，其中 $t = 0, 1, 2, 3, 4, 5, 6$：\n    - $[(108,200,92),(108,199,93),(108,200,92),(107,200,93),(107,200,93),(107,200,93),(106,200,94)]$\n\n您的程序必须：\n- 为每个数据集上的每个模型，使用带边界约束的数值优化实现最大似然参数估计。\n- 为每个数据集上的每个模型计算 $\\mathrm{AICc}$。\n- 应用阈值 $\\Delta = 2.0$ 的决策规则，将每个数据集分类为 NFDS ($1$) 或 OD ($0$)。\n- 生成单行输出，其中包含三个整数结果，按数据集 A、B、C 的顺序排列，形式为用方括号括起来的逗号分隔列表（例如，$[0,1,0]$）。不允许有任何其他输出。", "solution": "该问题定义明确，并基于群体遗传学的基本原则。我们将着手推导必要的公式并构建计算解决方案。\n\n我们的分析基础是适用于大型、随机交配、世代离散的二倍体群体的标准 Wright-Fisher 模型。设 $p_t$ 为第 $t$ 代等位基因 $A$ 的频率，$1-p_t$ 为等位基因 $a$ 的频率。在随机交配的假设下，合子阶段的基因型频率由 Hardy-Weinberg 比例给出：\n$$\n\\begin{cases}\n    \\text{freq}(AA) = p_t^2 \\\\\n    \\text{freq}(Aa) = 2 p_t (1-p_t) \\\\\n    \\text{freq}(aa) = (1-p_t)^2\n\\end{cases}\n$$\n选择作用于这些基因型，其相对适应度分别为 $w_{AA}$, $w_{Aa}$ 和 $w_{aa}$。群体在第 $t$ 代的平均适应度是基因型适应度的加权平均值：\n$$\n\\bar{w}_t = p_t^2 w_{AA} + 2 p_t (1-p_t) w_{Aa} + (1-p_t)^2 w_{aa}\n$$\n下一代等位基因 $A$ 的频率 $p_{t+1}$，由选择后基因库中 $A$ 等位基因的比例推导得出。这得出了通用的递推式：\n$$\np_{t+1} = \\frac{p_t^2 w_{AA} + p_t (1-p_t) w_{Aa}}{\\bar{w}_t}\n$$\n我们现在为这两个竞争模型具体化此递推式。\n\n\\textbf{模型 1：超显性（OD）}\n\n该模型假定基因型适应度恒定，其中杂合子具有最高的适应度。适应度是相对于杂合子定义的：\n$$\nw_{AA} = 1 - s, \\quad w_{Aa} = 1, \\quad w_{aa} = 1 - t\n$$\n此模型的参数是选择系数 $s \\in (0,1)$, $t \\in (0,1)$，以及初始等位基因频率 $p_0 \\in (0,1)$。自由参数的总数为 $k_{\\text{OD}} = 3$。\n该模型下的平均适应度 $\\bar{w}_t$ 为：\n$$\n\\bar{w}_t = p_t^2 (1-s) + 2p_t(1-p_t) + (1-p_t)^2(1-t) = 1 - s p_t^2 - t(1-p_t)^2\n$$\n将这些适应度代入通用递推式，可得到 OD 模型的等位基因频率动态：\n$$\np_{t+1}^{\\text{OD}} = \\frac{p_t^2 (1-s) + p_t (1-p_t)}{1 - s p_t^2 - t(1-p_t)^2} = \\frac{p_t(1 - s p_t)}{1 - s p_t^2 - t(1-p_t)^2}\n$$\n\n\\textbf{模型 2：负频率依赖选择（NFDS）}\n\n该模型假设一个等位基因对适应度的贡献会因其自身频率的增高而受到惩罚。设 $\\alpha_A \\in (0,1)$ 和 $\\alpha_a \\in (0,1)$ 分别为选择强度参数。问题陈述指明了等位基因效应对基因型适应度的加性贡献。我们通过定义基于等位基因频率线性惩罚的频率依赖性基因型适应度来解释这一点：\n$$\n\\begin{aligned}\nw_{AA}(p_t) &= 1 - \\alpha_A p_t \\\\\nw_{Aa}(p_t) &= 1 - \\frac{\\alpha_A p_t + \\alpha_a(1-p_t)}{2} \\\\\nw_{aa}(p_t) &= 1 - \\alpha_a(1-p_t)\n\\end{aligned}\n$$\n杂合子的适应度是两个纯合子适应度的平均值，这代表了在适应度尺度上的加性基因作用，是一种标准方法。参数为 $\\alpha_A$, $\\alpha_a$ 和 $p_0$，均在 $(0,1)$ 内，因此自由参数的数量为 $k_{\\text{NFDS}} = 3$。\n平均适应度 $\\bar{w}_t$ 通过对基因型进行平均计算得出：\n$$\n\\bar{w}_t = p_t^2 w_{AA}(p_t) + 2 p_t(1-p_t) w_{Aa}(p_t) + (1-p_t)^2 w_{aa}(p_t)\n$$\n代入适应度定义并化简，可得到紧凑形式：\n$$\n\\bar{w}_t = 1 - \\alpha_A p_t^2 - \\alpha_a (1-p_t)^2\n$$\n递推式的分子是 $p_t^2 w_{AA}(p_t) + p_t (1-p_t) w_{Aa}(p_t)$，它代表了选择后等位基因 $A$ 的总频率。因此，NFDS 模型的等位基因频率递推式为：\n$$\np_{t+1}^{\\text{NFDS}} = \\frac{p_t \\left(p_t(1-\\alpha_A p_t) + (1-p_t)\\left(1 - \\frac{\\alpha_A p_t + \\alpha_a(1-p_t)}{2}\\right)\\right)}{1 - \\alpha_A p_t^2 - \\alpha_a (1-p_t)^2}\n$$\n\n\\textbf{统计推断与模型选择}\n\n对于一个给定参数为 $\\theta_M$ 的模型 $M$，我们从 $p_0$ 开始，使用相应的递推式生成一个等位基因频率轨迹 $\\{p_t(\\theta_M)\\}_{t=0}^{T}$。在第 $t$ 代观察到的基因型计数 $(n_{AA,t}, n_{Aa,t}, n_{aa,t})$，被假定为来自一个总计数为 $N_t = n_{AA,t} + n_{Aa,t} + n_{aa,t}$ 的多项式分布的单次抽样，其概率由预测的 Hardy-Weinberg 频率确定：\n$q_{AA,t} = p_t^2$，$q_{Aa,t} = 2 p_t(1-p_t)$，以及 $q_{aa,t} = (1-p_t)^2$。\n在给定完整时间序列数据 $D = \\{(n_{AA,t}, n_{Aa,t}, n_{aa,t})\\}_{t=0}^{T}$ 的情况下，参数 $\\theta_M$ 的对数似然是每个独立多项式观测的对数似然之和：\n$$\n\\ell(\\theta_M | D) = \\sum_{t=0}^{T} \\left( n_{AA,t} \\log(q_{AA,t}) + n_{Aa,t} \\log(q_{Aa,t}) + n_{aa,t} \\log(q_{aa,t}) \\right)\n$$\n我们实现一个数值优化程序，为每个模型找到最大化此函数的参数的最大似然估计（MLEs）$\\hat{\\theta}_M$。这给出了最大对数似然 $\\ell_{\\max, M} = \\ell(\\hat{\\theta}_M | D)$。\n\n为了比较这两个模型，我们使用校正的 Akaike 信息准则（AICc），它对模型的自由参数数量 $k$ 进行惩罚，并适用于小样本量 $n$。\n$$\n\\mathrm{AICc} = -2 \\ell_{\\max} + 2k + \\frac{2k(k+1)}{n-k-1}\n$$\n在此问题中，所有数据集的观察世代数均为 $n=7$。两个模型都有 $k=3$ 个参数。分母 $n-k-1 = 7-3-1=3$ 为正，因此直接使用 AICc 公式。\n\n决策规则是选择 AICc 值较低的模型。引入一个选择阈值 $\\Delta = 2.0$ 以提供一个防止过拟合的缓冲，默认偏好概念上更简单的 OD 模型。我们当且仅当以下条件成立时选择 NFDS：\n$$\n\\mathrm{AICc}_{\\mathrm{NFDS}} + \\Delta < \\mathrm{AICc}_{\\mathrm{OD}}\n$$\n鉴于两个模型具有相同数量的参数（$k=3$），此不等式可简化为对最大对数似然的直接比较：将一个数据集分类为 NFDS 需要 $\\ell_{\\max, \\text{NFDS}} > \\ell_{\\max, \\text{OD}} + \\frac{\\Delta}{2}$。当 $\\Delta=2.0$ 时，如果 NFDS 的最大对数似然比 OD 的大 $1.0$ 以上，我们就选择 NFDS。否则，选择 OD。结果编码为 NFDS 为 $1$，OD 为 $0$。该实现将对提供的三个数据集分别执行此程序。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Main function to solve the model selection problem for the three datasets.\n    \"\"\"\n    \n    # Define test cases from the problem statement\n    test_cases = [\n        # Dataset A\n        np.array([(256, 128, 16), (218, 155, 27), (184, 175, 41), (155, 188, 57), \n                  (131, 196, 73), (112, 199, 89), (98, 200, 102)]),\n        # Dataset B\n        np.array([(256, 128, 16), (221, 153, 26), (191, 171, 38), (164, 184, 52), \n                  (142, 193, 65), (124, 197, 79), (110, 200, 90)]),\n        # Dataset C\n        np.array([(108, 200, 92), (108, 199, 93), (108, 200, 92), (107, 200, 93), \n                  (107, 200, 93), (107, 200, 93), (106, 200, 94)])\n    ]\n    \n    results = []\n    for counts in test_cases:\n        results.append(process_dataset(counts))\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\ndef process_dataset(counts):\n    \"\"\"\n    Performs model fitting and selection for a single dataset.\n    \n    Args:\n        counts (np.ndarray): A (T x 3) array of genotype counts (n_AA, n_Aa, n_aa).\n    \n    Returns:\n        int: 1 if NFDS is selected, 0 if OD is selected.\n    \"\"\"\n    n = counts.shape[0]  # Number of generations\n    k = 3  # Number of parameters for both models\n    delta = 2.0\n    \n    # Estimate initial p0 from data for a better starting guess\n    n_AA_0, n_Aa_0, n_aa_0 = counts[0]\n    total_alleles_0 = 2 * (n_AA_0 + n_Aa_0 + n_aa_0)\n    p0_guess = (2 * n_AA_0 + n_Aa_0) / total_alleles_0\n\n    # Bounds for parameters (s, t, p0) or (alpha_A, alpha_a, p0)\n    epsilon = 1e-9\n    bounds = [(epsilon, 1 - epsilon), (epsilon, 1 - epsilon), (epsilon, 1 - epsilon)]\n\n    # --- Overdominance (OD) Model Fitting ---\n    x0_od = [0.1, 0.1, p0_guess]  # Initial guess for (s, t, p0)\n    res_od = minimize(\n        neg_log_likelihood,\n        x0_od,\n        args=(counts, 'OD'),\n        method='L-BFGS-B',\n        bounds=bounds\n    )\n    ll_max_od = -res_od.fun\n\n    # --- Negative Frequency-Dependent Selection (NFDS) Model Fitting ---\n    x0_nfds = [0.1, 0.1, p0_guess] # Initial guess for (alpha_A, alpha_a, p0)\n    res_nfds = minimize(\n        neg_log_likelihood,\n        x0_nfds,\n        args=(counts, 'NFDS'),\n        method='L-BFGS-B',\n        bounds=bounds\n    )\n    ll_max_nfds = -res_nfds.fun\n\n    # --- Model Comparison using AICc ---\n    aicc_od = calculate_aicc(ll_max_od, k, n)\n    aicc_nfds = calculate_aicc(ll_max_nfds, k, n)\n\n    if aicc_nfds + delta  aicc_od:\n        return 1  # Select NFDS\n    else:\n        return 0  # Select OD\n\ndef neg_log_likelihood(params, counts, model):\n    \"\"\"\n    Calculates the negative log-likelihood for a given model and parameters.\n    \n    Args:\n        params (list): Model parameters: (s, t, p0) for OD or (alpha_A, alpha_a, p0) for NFDS.\n        counts (np.ndarray): Genotype counts data.\n        model (str): 'OD' or 'NFDS'.\n        \n    Returns:\n        float: Negative log-likelihood.\n    \"\"\"\n    num_generations = counts.shape[0]\n    p_traj = np.zeros(num_generations)\n    p_traj[0] = params[2] # p0\n    \n    # Generate allele frequency trajectory\n    for t in range(num_generations - 1):\n        p_curr = np.clip(p_traj[t], 1e-9, 1 - 1e-9)\n        if model == 'OD':\n            s, t_param = params[0], params[1]\n            p_traj[t+1] = p_next_od(p_curr, s, t_param)\n        elif model == 'NFDS':\n            alpha_A, alpha_a = params[0], params[1]\n            p_traj[t+1] = p_next_nfds(p_curr, alpha_A, alpha_a)\n\n    # Clip entire trajectory for stability in log\n    p_traj = np.clip(p_traj, 1e-9, 1 - 1e-9)\n\n    # Calculate HWE frequencies from trajectory\n    q_AA = p_traj**2\n    q_Aa = 2 * p_traj * (1 - p_traj)\n    q_aa = (1 - p_traj)**2\n\n    # Calculate log-likelihood\n    log_lik = np.sum(\n        counts[:, 0] * np.log(q_AA) +\n        counts[:, 1] * np.log(q_Aa) +\n        counts[:, 2] * np.log(q_aa)\n    )\n    \n    if np.isnan(log_lik):\n        return np.inf\n        \n    return -log_lik\n\ndef p_next_od(p_curr, s, t):\n    \"\"\"Allele frequency recursion for the OD model.\"\"\"\n    numerator = p_curr * (1 - s * p_curr)\n    denominator = 1 - s * p_curr**2 - t * (1 - p_curr)**2\n    return numerator / denominator\n\ndef p_next_nfds(p_curr, alpha_A, alpha_a):\n    \"\"\"Allele frequency recursion for the NFDS model.\"\"\"\n    p = p_curr\n    w_AA = 1 - alpha_A * p\n    w_Aa = 1 - 0.5 * (alpha_A * p + alpha_a * (1 - p))\n    \n    num_term = p * (p * w_AA + (1 - p) * w_Aa)\n    w_bar = 1 - alpha_A * p**2 - alpha_a * (1 - p)**2\n\n    return num_term / w_bar\n\ndef calculate_aicc(ll_max, k, n):\n    \"\"\"Calculates the corrected Akaike Information Criterion.\"\"\"\n    if n - k - 1 = 0: # Fallback to AIC as per problem statement\n        return -2 * ll_max + 2 * k\n    else:\n        correction = (2 * k * (k + 1)) / (n - k - 1)\n        return -2 * ll_max + 2 * k + correction\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2811510"}]}