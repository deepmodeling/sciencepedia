{"hands_on_practices": [{"introduction": "霍尔丹法则的一个关键推论是“大 $X$ 染色体效应”（large X-effect），即 $X$ 染色体在杂交不亲和中扮演了不成比例的重要角色。本练习旨在帮助您将这一抽象概念与具体量化联系起来。通过从显性理论等基本原理出发，论证 $X$ 连锁雄性不育的普遍性，并计算一个简明的统计量，您将能更深刻地理解理论与观察数据之间的桥梁 [@problem_id:2720963]。", "problem": "在 `Drosophila simulans`（拟果蝇）种复合体中，`Drosophila simulans` 与其姐妹种之间的种间杂交经常产生不育的 $F_{1}$ 代杂种雄性，这与霍尔丹法则（Haldane's rule）一致，即异配性别更常出现不育或不存活。设想一个研究项目，该项目使用基因渗入系、数量性状基因座（QTL）定位和缺失定位来确定杂种雄性不育基因座的位置。该研究报告在 X 染色体和常染色体上存在多个杂种雄性不育基因座。要求您从物种形成遗传学的基础原理出发，解释为何预期 X 染色体对杂种雄性不育有不成比例的贡献（即巨大的 X 效应），然后计算已定位基因座基因组分布的汇总统计量。\n\n使用以下基本原理和事实：\n- 霍尔丹法则：在杂种后代中，异配性别更可能不育或不存活。\n- 多布然斯基-穆勒不相容性（Dobzhansky–Muller incompatibilities）：杂种功能障碍源于在隔离状态下演化出的趋异等位基因之间的负上位性相互作用。\n- 霍尔丹法则的显性理论：如果许多不相容性等位基因为部分隐性，那么在异配性别中，X 染色体的半合子性会暴露隐性的 X 连锁不相容性，从而增加 X 连锁不育的发生率和表现度。\n- 来自 `Drosophila simulans` 种复合体的证据表明，杂种雄性不育定位于 X 染色体上的多个区间，半合子的 X 染色体片段在其他方面均为同种遗传背景下足以导致雄性不育，并且在可比较的基因组尺度下，检测到的常染色体区间数量更少或效应更弱。\n\n首先，用不超过几句话，阐明一种基于机制的合理解释，说明为何 X 连锁杂种雄性不育在该系统中被认为是常见的。然后，设 $n_{X}$ 为定位于 X 染色体上的杂种雄性不育基因座的数量，设 $n_{A}$ 为定位于常染色体上的数量。将已定位的基因座总数定义为 $N$，并将 X 连锁的不育基因座所占的比例定义为 $f_{X}$。推导 $f_{X}$ 作为 $n_{X}$ 和 $n_{A}$ 的函数表达式，并以其最简代数形式报告此比例。您的最终答案必须是关于 $n_{X}$ 和 $n_{A}$ 的单个闭式表达式。无需进行数值计算，也不涉及单位。", "solution": "该问题是在物种形成遗传学和杂种功能障碍原因的框架下提出的，援引了霍尔丹法则和多布然斯基-穆勒模型。我们从公认的原理和观察出发，然后计算所要求的比例。\n\n巨大 X 效应的机制性解释：\n- 根据多布然斯基-穆勒模型，杂种功能障碍是由在不同谱系中独立演化出的等位基因之间的负上位性造成的。如果许多这类不相容性等位基因为部分隐性，那么它们在杂合子中效应被掩盖，但在纯合或半合状态下则会表达出来。\n- 在果蝇中，雄性是异配性别 ($XY$)。雄性中的 X 连锁等位基因是半合子的，因此任何部分隐性的 X 连锁不相容性在 $F_{1}$ 代雄性中都会完全暴露，而常染色体的不相容性则除非处于适当的纯合状态或特定的上位性组合中，否则仍然被掩盖。这就是对霍尔丹法则的显性理论解释。\n- 在 `Drosophila simulans` 种复合体中的经验证据表明，基因渗入和缺失定位已反复证明，将一个物种的小段 X 连锁片段替换到另一个物种的遗传背景中，就足以导致雄性不育，并且有许多不同的 X 连锁区间对此有贡献，而当定位分辨率和基因组覆盖度相当时，检测到的常染色体区间数量更少或效应更低。这些观察结果强化了 X 连锁杂种雄性不育基因座数量众多且效应巨大的预期。\n\nX 连锁基因座比例的计算：\n- 设 $n_{X}$ 表示定位于 X 染色体上的杂种雄性不育基因座的数量，设 $n_{A}$ 表示定位于常染色体上的数量。已定位的基因座总数是它们的和\n$$\nN = n_{X} + n_{A}.\n$$\n- 被定为 X 连锁的不育基因座所占的比例，记为 $f_{X}$，定义为 X 连锁基因座的数量除以已定位的基因座总数。因此，\n$$\nf_{X} = \\frac{n_{X}}{N} = \\frac{n_{X}}{n_{X} + n_{A}}.\n$$\n该表达式已是最简代数形式，并满足了作为关于 $n_{X}$ 和 $n_{A}$ 的单个闭式表达式的要求。", "answer": "$$\\boxed{\\frac{n_{X}}{n_{X}+n_{A}}}$$", "id": "2720963"}, {"introduction": "要深入理解霍尔丹法则，我们必须探究其背后的遗传机制。这个练习将引导您通过一个经典的 Dobzhansky-Muller 不亲和（DMI）模型，亲手推演杂交后代中不相容性的表现。通过分析涉及 $X$ 染色体和常染色体上基因座的相互作用，您将清晰地看到，在不同显性模式下，遗传不相容性是如何仅在异配性别中表现出来，从而导致霍尔丹法则所描述的不对称杂交衰败 [@problem_id:2820483]。", "problem": "两个物种 $\\mathrm{S}_1$ 和 $\\mathrm{S}_2$，在构成杜布赞斯基-马勒不相容性 (DMI) 的两个基因座上分别固定了不同的等位基因。一个基因座位于 X 染色体上（等位基因为 $X^{a}$ 祖先型，$X^{d}$ 衍生型），另一个基因座位于常染色体上（等位基因为 $A^{a}$ 祖先型，$A^{d}$ 衍生型）。物种 $\\mathrm{S}_1$ 在 X 连锁基因座上固定了 $X^{d}$，在常染色体基因座上固定了 $A^{a}$；物种 $\\mathrm{S}_2$ 在相应基因座上分别固定了 $X^{a}$ 和 $A^{d}$。假设采用 XY 型性别决定系统，雄性为异配性别 ($XY$)，雌性为同配性别 ($XX$)。子一代 (F1) 由正反交产生，遵循标准的孟德尔遗传方式，且每次杂交的后代性别比为 $1{:}1$。\n\n当衍生等位基因相遇且不被显性所掩盖时，DMI 表型（不存活或不育）就会表现出来。考虑 DMI 的两种显性模型：\n\n- 模型 A（经典的 X 连锁隐性与常染色体显性互作）：衍生的 X 连锁等位基因 $X^{d}$ 在二倍体雌性中为完全隐性，在半合子雄性中完全表达；衍生的常染色体等位基因 $A^{d}$ 在互作中为完全显性（一个拷贝即可）。当且仅当一个个体同时携带 $A^{d}$（处于任何 $A^{a}/A^{d}$ 或 $A^{d}/A^{d}$ 状态）并且 $X^{d}$ 处于表达状态（雄性为半合子 $X^{d}/Y$ 或雌性为纯合子 $X^{d}/X^{d}$）时，该个体才会表现出 DMI 表型。\n- 模型 B（两个衍生等位基因均为完全隐性）：衍生的 X 连锁等位基因 $X^{d}$ 在二倍体雌性中为完全隐性，在半合子雄性中完全表达；衍生的常染色体等位基因 $A^{d}$ 为完全隐性，需要 $A^{d}/A^{d}$ 才能导致 DMI。当且仅当一个个体为 $A^{d}/A^{d}$ 并且 $X^{d}$ 处于表达状态（半合子 $X^{d}/Y$ 或纯合子 $X^{d}/X^{d}$）时，该个体才会表现出 DMI 表型。\n\n任务：\n1. 针对 $\\mathrm{S}_1 \\, \\female \\times \\mathrm{S}_2 \\, \\male$ 和 $\\mathrm{S}_2 \\, \\female \\times \\mathrm{S}_1 \\, \\male$ 这两种正反交，构建 F1 代在 X 连锁和常染色体 DMI 基因座上的预期基因型，并分别列出 F1 雌性和 F1 雄性的基因型。\n2. 对于每种显性模型（模型 A 和模型 B），确定在每次正反交和每种性别中，哪些 F1 基因型（如果有的话）会表现出 DMI 表型，并根据孟德尔遗传和显性/半合性的第一性原理证明你的判断。\n3. 假设两种正反交方向的发生概率相等，且每个 F1 家系的性别比为 $1{:}1$，仅在模型 A 下，计算所有 F1 个体（包括两种杂交方向和两种性别）中表现出 DMI 表型的预期比例。将最终答案表示为最简分数。", "solution": "该问题陈述具有科学依据，阐述清晰且客观。它提供了一套完整且一致的既定条件，用以模拟杜布赞斯基-马勒不相容性 (DMI) 这一物种形成遗传学中的基本概念的经典案例。所有关于亲本基因型、遗传模式以及 DMI 表型表达具体条件的必要信息都得到了明确定义。因此，可以从第一性原理推导出一个严谨的解决方案。\n\n该解决方案分为三个部分，与问题陈述中指定的任务相对应。\n\n### 任务 1：确定 F1 基因型\n\n我们必须确定由物种 $\\mathrm{S}_1$ 和 $\\mathrm{S}_2$ 之间的正反交产生的子一代 ($F_1$) 的基因型。性别决定系统为 $XY$ 型，其中雄性是异配性别 ($XY$)，雌性是同配性别 ($XX$)。X 染色体携带一个 DMI 基因座，一条常染色体携带第二个。\n\n亲本物种 ($\\mathrm{P}$) 具有以下基因型：\n-   物种 $\\mathrm{S}_1$：雌性为 $X^{d}X^{d}; A^{a}A^{a}$，雄性为 $X^{d}Y; A^{a}A^{a}$。\n-   物种 $\\mathrm{S}_2$：雌性为 $X^{a}X^{a}; A^{d}A^{d}$，雄性为 $X^{a}Y; A^{d}A^{d}$。\n\n我们分别分析每一次正反交。\n\n**杂交 1: $\\mathrm{S}_1$ 雌性 $\\times$ $\\mathrm{S}_2$ 雄性**\n-   亲本基因型: $\\mathrm{S}_1 \\, \\female (X^{d}X^{d}; A^{a}A^{a}) \\times \\mathrm{S}_2 \\, \\male (X^{a}Y; A^{d}A^{d})$。\n-   配子产生:\n    -   $\\mathrm{S}_1$ 雌性只产生一种类型的配子：$X^{d}; A^{a}$。\n    -   $\\mathrm{S}_2$ 雄性以相等比例产生两种类型的配子：$X^{a}; A^{d}$ 和 $Y; A^{d}$。\n-   产生的 $F_1$ 后代:\n    -   $F_1$ 雌性：一个 $X^{d}; A^{a}$ 的卵细胞与一个 $X^{a}; A^{d}$ 的精子受精，产生基因型 $X^{d}X^{a}; A^{a}A^{d}$。\n    -   $F_1$ 雄性：一个 $X^{d}; A^{a}$ 的卵细胞与一个 $Y; A^{d}$ 的精子受精，产生基因型 $X^{d}Y; A^{a}A^{d}$。\n\n**杂交 2: $\\mathrm{S}_2$ 雌性 $\\times$ $\\mathrm{S}_1$ 雄性**\n-   亲本基因型: $\\mathrm{S}_2 \\, \\female (X^{a}X^{a}; A^{d}A^{d}) \\times \\mathrm{S}_1 \\, \\male (X^{d}Y; A^{a}A^{a})$。\n-   配子产生:\n    -   $\\mathrm{S}_2$ 雌性只产生一种类型的配子：$X^{a}; A^{d}$。\n    -   $\\mathrm{S}_1$ 雄性以相等比例产生两种类型的配子：$X^{d}; A^{a}$ 和 $Y; A^{a}$。\n-   产生的 $F_1$ 后代:\n    -   $F_1$ 雌性：一个 $X^{a}; A^{d}$ 的卵细胞与一个 $X^{d}; A^{a}$ 的精子受精，产生基因型 $X^{a}X^{d}; A^{d}A^{a}$。\n    -   $F_1$ 雄性：一个 $X^{a}; A^{d}$ 的卵细胞与一个 $Y; A^{a}$ 的精子受精，产生基因型 $X^{a}Y; A^{d}A^{a}$。\n\n$F_1$ 基因型总结：\n-   来自杂交 $\\mathrm{S}_1 \\, \\female \\times \\mathrm{S}_2 \\, \\male$：\n    -   雌性：$X^{d}X^{a}; A^{a}A^{d}$\n    -   雄性：$X^{d}Y; A^{a}A^{d}$\n-   来自杂交 $\\mathrm{S}_2 \\, \\female \\times \\mathrm{S}_1 \\, \\male$：\n    -   雌性：$X^{a}X^{d}; A^{d}A^{a}$ (注意：这与杂交 1 产生的雌性基因型相同)\n    -   雄性：$X^{a}Y; A^{d}A^{a}$\n\n### 任务 2：确定 F1 的不存活/不育性\n\n我们现在将每个指定模型下 DMI 表型的条件应用于上面推导出的 $F_1$ 基因型。\n\n**模型 A 的分析：**\n当且仅当一个个体满足以下条件时，DMI 表型才会表现出来：\n$1$. 携带至少一个衍生的常染色体等位基因 $A^{d}$ （显性）。\n$2$. 衍生的 X 连锁等位基因 $X^{d}$ 处于表达状态，即雄性为半合子 ($X^{d}Y$) 或雌性为纯合子 ($X^{d}X^{d}$)，因为 $X^{d}$ 是隐性的。\n\n-   **$F_1$ 雌性（来自两次杂交的 $X^{d}X^{a}; A^{a}A^{d}$）：**\n    -   条件 $1$：她们是杂合子 $A^{a}A^{d}$，因此携带 $A^{d}$ 等位基因。条件满足。\n    -   条件 $2$：她们是杂合子 $X^{d}X^{a}$。由于 $X^{d}$ 对 $X^{a}$ 是隐性的，该等位基因不处于表达状态。条件不满足。\n    -   结论：在模型 A 下， $F_1$ 雌性**不受** DMI 影响。\n\n-   **来自杂交 1（$\\mathrm{S}_1\\female \\times \\mathrm{S}_2\\male$）的 $F_1$ 雄性，基因型 $X^{d}Y; A^{a}A^{d}$：**\n    -   条件 $1$：他们是杂合子 $A^{a}A^{d}$，因此携带 $A^{d}$ 等位基因。条件满足。\n    -   条件 $2$：他们是半合子 $X^{d}Y$。$X^{d}$ 等位基因处于表达状态。条件满足。\n    -   结论：来自该杂交的 $F_1$ 雄性在模型 A 下**受** DMI 影响。\n\n-   **来自杂交 2（$\\mathrm{S}_2\\female \\times \\mathrm{S}_1\\male$）的 $F_1$ 雄性，基因型 $X^{a}Y; A^{d}A^{a}$：**\n    -   条件 $1$：他们是杂合子 $A^{d}A^{a}$，因此携带 $A^{d}$ 等位基因。条件满足。\n    -   条件 $2$：他们是半合子 $X^{a}Y$。他们不携带 $X^{d}$ 等位基因。条件不满足。\n    -   结论：来自该杂交的 $F_1$ 雄性在模型 A 下**不受** DMI 影响。\n\n**模型 B 的分析：**\n当且仅当一个个体满足以下条件时，DMI 表型才会表现出来：\n$1$. 是衍生的常染色体等位基因的纯合子，$A^{d}A^{d}$ （隐性）。\n$2$. 衍生的 X 连锁等位基因 $X^{d}$ 处于表达状态（$X^{d}Y$ 或 $X^{d}X^{d}$）。\n\n-   **$F_1$ 雌性（来自两次杂交的 $X^{d}X^{a}; A^{a}A^{d}$）：**\n    -   条件 $1$：她们是杂合子 $A^{a}A^{d}$。她们不是纯合子 $A^{d}A^{d}$。条件不满足。\n    -   结论：在模型 B 下， $F_1$ 雌性**不受** DMI 影响。\n\n-   **来自杂交 1 的 $F_1$ 雄性（$X^{d}Y; A^{a}A^{d}$）：**\n    -   条件 $1$：他们是杂合子 $A^{a}A^{d}$。他们不是纯合子 $A^{d}A^{d}$。条件不满足。\n    -   结论：来自该杂交的 $F_1$ 雄性在模型 B 下**不受** DMI 影响。\n\n-   **来自杂交 2 的 $F_1$ 雄性（$X^{a}Y; A^{d}A^{a}$）：**\n    -   条件 $1$：他们是杂合子 $A^{d}A^{a}$。他们不是纯合子 $A^{d}A^{d}$。条件不满足。\n    -   结论：来自该杂交的 $F_1$ 雄性在模型 B 下**不受** DMI 影响。\n\n总之，在模型 B 下，没有任何 $F_1$ 基因型表现出 DMI 表型。不相容性仅在模型 A 的 $F_1$ 代中出现，并且仅出现在其中一次正反交的雄性后代中。这种在异配性别中出现的不对称结果是霍尔丹法则的一个经典例子。\n\n### 任务 3：模型 A 下受影响 F1 个体的比例\n\n我们被要求计算在模型 A 下，所有表现出 DMI 表型的 $F_1$ 个体的预期比例。问题陈述假设两种正反交方向的发生概率相等，且每次杂交产生 $1:1$ 的性别比。\n\n设 $F_1$ 后代的总群体数量为 $N$。\n-   来自杂交 1（$\\mathrm{S}_1\\female \\times \\mathrm{S}_2\\male$）的后代数量为 $\\frac{1}{2}N$。\n-   来自杂交 2（$\\mathrm{S}_2\\female \\times \\mathrm{S}_1\\male$）的后代数量为 $\\frac{1}{2}N$。\n\n在每次杂交中，后代一半是雌性，一半是雄性。因此，总的 $F_1$ 种群由四个大小相等的组构成，每个组占总数的 $\\frac{1}{4}$：\n$1$. 来自杂交 1 的雌性：比例为 $\\frac{1}{2} \\times \\frac{1}{2} = \\frac{1}{4}$。\n$2$. 来自杂交 1 的雄性：比例为 $\\frac{1}{2} \\times \\frac{1}{2} = \\frac{1}{4}$。\n$3$. 来自杂交 2 的雌性：比例为 $\\frac{1}{2} \\times \\frac{1}{2} = \\frac{1}{4}$。\n$4$. 来自杂交 2 的雄性：比例为 $\\frac{1}{2} \\times \\frac{1}{2} = \\frac{1}{4}$。\n\n根据任务 2 中对模型 A 的分析：\n-   组 1（雌性，杂交 1）：全部不受影响。对受影响比例的贡献为 $0$。\n-   组 2（雄性，杂交 1）：全部受影响。对受影响比例的贡献为 $\\frac{1}{4}$。\n-   组 3（雌性，杂交 2）：全部不受影响。对受影响比例的贡献为 $0$。\n-   组 4（雄性，杂交 2）：全部不受影响。对受影响比例的贡献为 $0$。\n\n受影响个体的总预期比例是来自这四个组的受影响个体比例之和：\n$$ \\text{Total Proportion Affected} = 0 + \\frac{1}{4} + 0 + 0 = \\frac{1}{4} $$\n\n因此，在模型 A 下，预计总 $F_1$ 后代中恰好有四分之一会表现出 DMI 表型。", "answer": "$$\\boxed{\\frac{1}{4}}$$", "id": "2820483"}, {"introduction": "现代物种形成遗传学研究越来越依赖于从基因组数据中进行统计推断。本练习将带您进入该领域的前沿，挑战您应用群体遗传学和统计学原理，从模拟的基因组渗入数据中估算性别特异性的选择系数。通过构建并最大化一个似然函数，您将学习如何量化作用于杂交个体中 $X$ 染色体上的选择压力，这是对霍尔丹法则进行实证检验的强大方法 [@problem_id:2720969]。", "problem": "给定一个简化但有原则的模型，用于推断与霍尔丹法则一致的、作用于X染色体（表示为X）上渐渗祖源的性别特异性选择。该推断基于全基因组祖源比例、性别标签以及在X连锁基因座上观测到的单倍体祖源状态。您必须使用的核心原则是作用于等位基因频率的标准确定性生存力选择。\n\n基本原理：\n- 设 $p$ 为一个个体中随机选择的单倍体X连锁等位基因来源于源种群 $\\mathsf{A}$ 的选择前概率。在中性条件下，$p$ 等于该个体来源于种群 $\\mathsf{A}$ 的全基因组祖源比例 $q$。\n- 在生存力选择下，存活的单倍体等位基因中的选择后等位基因频率 $p^{\\prime}$ 由 $p^{\\prime} = \\dfrac{p \\, w_{\\mathsf{A}}}{p \\, w_{\\mathsf{A}} + (1 - p) \\, w_{\\mathsf{B}}}$ 给出，其中 $w_{\\mathsf{A}}$ 和 $w_{\\mathsf{B}}$ 分别是与来自种群 $\\mathsf{A}$ 和 $\\mathsf{B}$ 的等位基因相关的相对适应度值。这是基础种群遗传学中经典的按选择加权归一化。假设 $w_{\\mathsf{B}} = 1$ 且 $w_{\\mathsf{A}} = 1 - s_{z}$，其中 $z \\in \\{0,1\\}$ 编码性别，$z = 0$ 代表雌性，$z = 1$ 代表雄性。\n- 因此，对于一个全基因组祖源为 $q$、性别为 $z$ 的个体，其携带的某个X连锁单倍体等位基因在经过选择后来源于种群 $\\mathsf{A}$ 的概率为\n$$\n\\pi(q,z;s_f,s_m) \\equiv \\frac{q \\, (1 - s_z)}{q \\, (1 - s_z) + (1 - q)},\n$$\n其中 $s_0 = s_f$ 和 $s_1 = s_m$ 是未知的、作用于来自种群 $\\mathsf{A}$ 的渐渗X连锁祖源的性别特异性选择系数。\n\n统计模型：\n- 对于每个单倍体X连锁观测值 $j$，给定一个个体的全基因组祖源比例 $q_j \\in [0,1]$、性别 $z_j \\in \\{0,1\\}$ 以及一个X连锁基因座的二元单倍体祖源指示符 $y_j \\in \\{0,1\\}$，其中 $y_j = 1$ 表示祖源来自种群 $\\mathsf{A}$，$y_j = 0$ 表示祖源来自种群 $\\mathsf{B}$。\n- 假设为独立的伯努利抽样，其成功概率为 $\\pi(q_j,z_j;s_f,s_m)$。需要最大化的对数似然函数为\n$$\n\\ell(s_f,s_m) = \\sum_{j=1}^{n} \\left[ y_j \\, \\log \\pi(q_j,z_j;s_f,s_m) + (1 - y_j) \\, \\log \\left(1 - \\pi(q_j,z_j;s_f,s_m)\\right) \\right].\n$$\n- 参数必须满足 $0 \\le s_f < 1$ 和 $0 \\le s_m < 1$。\n\n任务：\n- 通过在上述边界条件下最大化 $\\ell(s_f,s_m)$，实现最大似然估计（MLE）以获得估计值 $\\hat{s}_f$ 和 $\\hat{s}_m$。请使用带边界约束的数值优化器。\n- 判断这些估计值是否与针对雄性异配性（雄性为异配性别）的霍尔丹法则一致。该法则预测，作用于渐渗X祖源的选择在雄性中比在雌性中更强。定义一个决策阈值 $\\tau = 0.05$，当且仅当 $\\hat{s}_m - \\hat{s}_f > \\tau$ 时，判定数据与霍尔丹法则一致。\n\n数值与输出要求：\n- 报告 $\\hat{s}_m$ 和 $\\hat{s}_f$ 的值，四舍五入到三位小数。不涉及物理单位。\n- 对于每个测试用例，返回一个包含三个元素的列表：四舍五入后的 $\\hat{s}_m$（浮点数）、四舍五入后的 $\\hat{s}_f$（浮点数）以及根据上述规则做出的霍尔丹决策（布尔值）。\n- 您的程序应生成单行输出，其中包含一个由三个用例的列表组成的逗号分隔列表，并用方括号括起来（例如：\"[[sm1,sf1,flag1],[sm2,sf2,flag2],[sm3,sf3,flag3]]\"）。不应打印任何其他文本。\n- 您的程序不得读取任何输入；必须使用下面嵌入的测试套件。\n\n测试套件：\n- 在所有用例中，性别编码为 $z = 0$（雌性）和 $z = 1$（雄性）。这些列表按索引对齐，因此三个列表中第 $j$ 个条目对应于同一个观测值。\n\n用例1（雄性中X染色体渐渗减少；代表霍尔丹法则的情况）：\n- $q$ 列表: $[0.3,\\, 0.3,\\, 0.4,\\, 0.4,\\, 0.5,\\, 0.5,\\, 0.6,\\, 0.6,\\, 0.7,\\, 0.7,\\, 0.8,\\, 0.8,\\, 0.9,\\, 0.9]$\n- $z$ 列表: $[0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1]$\n- $y$ 列表: $[0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1]$\n\n用例2（无性别差异；近中性行为）：\n- $q$ 列表: $[0.2,\\, 0.2,\\, 0.4,\\, 0.4,\\, 0.5,\\, 0.5,\\, 0.6,\\, 0.6,\\, 0.8,\\, 0.8]$\n- $z$ 列表: $[0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1]$\n- $y$ 列表: $[0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1]$\n\n用例3（类边界行为；强的雄性特异性选择）：\n- $q$ 列表: $[0.1,\\, 0.1,\\, 0.49,\\, 0.49,\\, 0.51,\\, 0.51,\\, 0.9,\\, 0.9,\\, 0.96,\\, 0.96,\\, 0.98,\\, 0.98]$\n- $z$ 列表: $[0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1]$\n- $y$ 列表: $[0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1]$\n\n定义与决策规则：\n- 设 $\\widehat{s}_m$ 和 $\\widehat{s}_f$ 分别表示雄性和雌性的最大似然估计值；定义 $\\tau = 0.05$。如果 $\\widehat{s}_m - \\widehat{s}_f > \\tau$，则判定为“与霍尔丹法则一致”；否则，判定为“不一致”。\n- 在最终输出中，将 $\\widehat{s}_m$ 和 $\\widehat{s}_f$ 四舍五入到三位小数。\n\n您的程序必须实现最大似然估计，将其应用于所有三个用例，并打印单行指定聚合格式的输出。", "solution": "为了找到 $s_f$ 和 $s_m$ 的最大似然估计（MLE），我们需要最大化对数似然函数 $\\ell(s_f, s_m)$。这等价于最小化负对数似然函数 $L(s_f, s_m) = -\\ell(s_f, s_m)$。\n\n对数似然函数的一个关键特性是它对于参数 $s_f$ 和 $s_m$ 是可分离的。因为一个观测值的概率 $\\pi(q, z; s_f, s_m)$ 仅在个体为雌性（$z=0$）时依赖于 $s_f$，在个体为雄性（$z=1$）时依赖于 $s_m$。因此，我们可以将总的对数似然函数分解为两个独立的部分，一个只与雌性数据和 $s_f$ 相关，另一个只与雄性数据和 $s_m$ 相关：\n$$\n\\ell(s_f, s_m) = \\ell_f(s_f) + \\ell_m(s_m)\n$$\n这种可分离性使我们能够通过解决两个独立的一维优化问题来分别找到 $\\hat{s}_f$ 和 $\\hat{s}_m$。\n\n让我们为通用的选择系数 $s$ 和其对应的数据子集 $(q_k, y_k)$ 简化要优化的函数。概率为 $\\pi_k = \\frac{q_k (1 - s)}{q_k (1 - s) + (1 - q_k)} = \\frac{q_k(1-s)}{1-q_k s}$，且 $1-\\pi_k = \\frac{1-q_k}{1-q_k s}$。\n对数似然函数中与 $s$ 相关的部分（忽略与 $s$ 无关的常数项）可以写为：\n$$\n\\sum_k \\left[ y_k \\log(1-s) - \\log(1-q_k s) \\right]\n$$\n为了找到最大值，我们转而最小化其负值：\n$$\nL(s) = \\sum_k \\left[ \\log(1-q_k s) - y_k \\log(1-s) \\right]\n$$\n该函数将作为数值优化的目标。我们将分别用雌性和雄性的数据来最小化该函数，从而在约束条件 $0 \\le s < 1$ 下，求得 $\\hat{s}_f$ 和 $\\hat{s}_m$。该算法的实现见答案中的代码。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves the Haldane's rule inference problem for the given test cases.\n    \"\"\"\n    # Test cases as provided in the problem statement.\n    test_cases = [\n        # Case 1: reduced X introgression in males; representative of Haldane's rule\n        {\n            \"q\": [0.3, 0.3, 0.4, 0.4, 0.5, 0.5, 0.6, 0.6, 0.7, 0.7, 0.8, 0.8, 0.9, 0.9],\n            \"z\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"y\": [0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1]\n        },\n        # Case 2: no sex difference; near-neutral behavior\n        {\n            \"q\": [0.2, 0.2, 0.4, 0.4, 0.5, 0.5, 0.6, 0.6, 0.8, 0.8],\n            \"z\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"y\": [0, 0, 0, 0, 0, 0, 1, 1, 1, 1]\n        },\n        # Case 3: boundary-like behavior; strong male-specific selection\n        {\n            \"q\": [0.1, 0.1, 0.49, 0.49, 0.51, 0.51, 0.9, 0.9, 0.96, 0.96, 0.98, 0.98],\n            \"z\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"y\": [0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1]\n        }\n    ]\n\n    tau = 0.05\n    results = []\n\n    for case_data in test_cases:\n        q = np.array(case_data[\"q\"])\n        z = np.array(case_data[\"z\"])\n        y = np.array(case_data[\"y\"])\n\n        # Partition data into female (z=0) and male (z=1) subsets\n        female_mask = (z == 0)\n        male_mask = (z == 1)\n\n        q_f, y_f = q[female_mask], y[female_mask]\n        q_m, y_m = q[male_mask], y[male_mask]\n\n        def neg_log_lik(s, q_arr, y_arr):\n            \"\"\"\n            Calculates the simplified negative log-likelihood to be minimized.\n            L(s) = sum(log(1 - q_k*s) - y_k*log(1 - s))\n            \"\"\"\n            # If no data for a sex, likelihood is flat, s=0 is the neutral default.\n            if len(q_arr) == 0:\n                return 0.0\n            \n            # log(1-s) -> -inf as s->1. If any y_k=1, -y_k*log(1-s) -> +inf,\n            # which correctly penalizes s=1.\n            # np.log handles the vectorization automatically.\n            term1 = np.sum(np.log(1 - q_arr * s))\n            term2 = np.sum(y_arr * np.log(1 - s))\n            return term1 - term2\n\n        # --- Estimate s_f for females ---\n        # If no female data, MLE for s_f is taken as 0 (neutrality).\n        if len(q_f) > 0:\n            res_f = minimize_scalar(\n                lambda s: neg_log_lik(s, q_f, y_f),\n                bounds=(0, 1),\n                method='bounded'\n            )\n            s_f_hat = res_f.x\n        else:\n            s_f_hat = 0.0\n\n        # --- Estimate s_m for males ---\n        # If no male data, MLE for s_m is taken as 0.\n        if len(q_m) > 0:\n            res_m = minimize_scalar(\n                lambda s: neg_log_lik(s, q_m, y_m),\n                bounds=(0, 1),\n                method='bounded'\n            )\n            s_m_hat = res_m.x\n        else:\n            s_m_hat = 0.0\n            \n        # Decision for Haldane's rule using unrounded estimates\n        is_haldane = (s_m_hat - s_f_hat) > tau\n\n        # Round estimates for reporting\n        s_m_rounded = round(s_m_hat, 3)\n        s_f_rounded = round(s_f_hat, 3)\n\n        results.append([s_m_rounded, s_f_rounded, is_haldane])\n\n    # Format the final output string exactly as specified.\n    # The default str() representation of a list of lists matches the required format.\n    # e.g., [[0.1, 0.2, True], [0.3, 0.4, False]]\n    # However, to be certain about no extra spaces, we build it manually.\n    sub_lists_str = [f\"[{r[0]},{r[1]},{str(r[2]).lower()}]\" for r in results]\n    final_output_str = f\"[[{results[0][0]},{results[0][1]},{str(results[0][2]).lower()}],[{results[1][0]},{results[1][1]},{str(results[1][2]).lower()}],[{results[2][0]},{results[2][1]},{str(results[2][2]).lower()}]]\"\n\n    # Per user request in a similar task, let's make it a more compact print\n    print(str(results).replace(\"'\", \"\").replace(\" \", \"\"))\n\nsolve()\n```", "id": "2720969"}]}