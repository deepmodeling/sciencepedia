{"hands_on_practices": [{"introduction": "我们从转录组学实践的基础开始：评估原始测序读段的质量。任何测序数据的可靠性都始于对其碱基召回准确性的理解。本练习将通过一个基本计算，巩固您对 Phred 质量分数（$Q$ 值）的理解，这是评估碱基召回准确性的通用语言，并教您如何将这些分数转化为预期的错误率。掌握这项技能对于任何测序数据集的初步质量控制都至关重要。[@problem_id:2848935]", "problem": "一个实验室对真核转录组进行核糖核酸测序（RNA-seq），生成长度为 $L=150$ 个核苷酸的单端读段。测序仪报告了该数据集的以下逐周期碱基检出质量摘要：对于第 $1$ 到 $60$ 个循环，Phred质量中位数为 $Q=36$；对于第 $61$ 到 $120$ 个循环，Phred质量中位数为 $Q=32$；对于第 $121$ 到 $150$ 个循环，Phred质量中位数为 $Q=25$。假设为便于计算，给定循环范围内的每个位置都具有所述的 Phred 质量分数。\n\n仅使用连接 Phred 质量分数与碱基检出错误概率和期望值的标准定义和原理，从第一性原理推导：\n- 该读段每个碱基的预期碱基检出错误率，在所有 $L=150$ 个位置上取平均；以及\n- 每个读段的预期碱基检出错误数。\n\n将您的最终答案报告为单个实数，等于每个读段的预期碱基检出错误数，以小数形式（非百分比）表示，并四舍五入到四位有效数字。无需单位。", "solution": "问题陈述经评估有效。它在科学上基于生物信息学的标准原理，特别是用于 DNA/RNA 测序的 Phred 质量分数。该问题设定良好、客观，并包含推导唯一解所需的所有信息。不存在矛盾、歧义或逻辑缺陷。我们可以进行推导。\n\n连接 Phred 质量分数 $Q$ 与碱基检出错误概率 $P$ 的基本原理由以下定义给出：\n$$ Q = -10 \\log_{10}(P) $$\n根据这个定义，我们必须首先推导错误概率 $P$ 作为 $Q$ 的函数表达式。整理该方程，我们得到：\n$$ P = 10^{-Q/10} $$\n这个概率 $P$ 代表质量分数为 $Q$ 的单个碱基检出的预期错误率。\n\n问题指定了一个总长度为 $L=150$ 个核苷酸的读段，它被划分为三个片段，每个片段都具有恒定的 Phred 质量分数中位数。我们用 $n_i$ 表示片段 $i$ 的长度，用 $Q_i$ 表示其质量分数。\n对于第一个片段（循环 $1-60$）：\n碱基数为 $n_1 = 60 - 1 + 1 = 60$。\nPhred 质量分数为 $Q_1 = 36$。\n此片段中每个碱基的错误概率为 $P_1 = 10^{-Q_1/10} = 10^{-36/10} = 10^{-3.6}$。\n\n对于第二个片段（循环 $61-120$）：\n碱基数为 $n_2 = 120 - 61 + 1 = 60$。\nPhred 质量分数为 $Q_2 = 32$。\n此片段中每个碱基的错误概率为 $P_2 = 10^{-Q_2/10} = 10^{-32/10} = 10^{-3.2}$。\n\n对于第三个片段（循环 $121-150$）：\n碱基数为 $n_3 = 150 - 121 + 1 = 30$。\nPhred 质量分数为 $Q_3 = 25$。\n此片段中每个碱基的错误概率为 $P_3 = 10^{-Q_3/10} = 10^{-25/10} = 10^{-2.5}$。\n读段的总长度确实是 $L = n_1 + n_2 + n_3 = 60 + 60 + 30 = 150$，这与所提供的信息一致。\n\n碱基检出序列中的预期错误数遵循期望的线性性质原理。如果我们为读段中的每个位置 $i$ 定义一个指示随机变量 $X_i$，使得当发生错误时 $X_i=1$，否则 $X_i=0$，那么 $X_i$ 的期望值为 $E[X_i] = (1 \\cdot P(X_i=1)) + (0 \\cdot P(X_i=0)) = p_i$，其中 $p_i$ 是位置 $i$ 的错误概率。整个读段的预期总错误数 $E_{\\text{read}}$ 是各个期望值的总和：\n$$ E_{\\text{read}} = \\sum_{i=1}^{L} E[X_i] = \\sum_{i=1}^{L} p_i $$\n将此应用于我们的分段模型，我们在各自的片段上对恒定的错误概率求和：\n$$ E_{\\text{read}} = \\sum_{i=1}^{60} P_1 + \\sum_{i=61}^{120} P_2 + \\sum_{i=121}^{150} P_3 $$\n这可以简化为每个片段的碱基数与错误概率乘积的总和：\n$$ E_{\\text{read}} = n_1 P_1 + n_2 P_2 + n_3 P_3 $$\n这是每个读段预期碱基检出错误数的表达式。\n\n第一个要求解的量，即读段每个碱基的预期碱基检出错误率（在所有位置上取平均值）$\\bar{P}$，是预期总错误数除以读段总长度：\n$$ \\bar{P} = \\frac{E_{\\text{read}}}{L} = \\frac{n_1 P_1 + n_2 P_2 + n_3 P_3}{L} $$\n第二个要求解的量是 $E_{read}$ 本身。问题要求计算 $E_{read}$ 的数值。\n\n现在我们将具体数值代入推导出的 $E_{read}$ 表达式中：\n$$ E_{\\text{read}} = 60 \\cdot 10^{-3.6} + 60 \\cdot 10^{-3.2} + 30 \\cdot 10^{-2.5} $$\n为了得到最终的数值答案，我们计算各项：\n$10^{-3.6} \\approx 0.0002511886$\n$10^{-3.2} \\approx 0.0006309573$\n$10^{-2.5} \\approx 0.0031622777$\n代入这些值：\n$$ E_{\\text{read}} \\approx 60 \\cdot (0.0002511886) + 60 \\cdot (0.0006309573) + 30 \\cdot (0.0031622777) $$\n$$ E_{\\text{read}} \\approx 0.015071316 + 0.037857438 + 0.094868331 $$\n$$ E_{\\text{read}} \\approx 0.147797085 $$\n问题要求将此值四舍五入到四位有效数字。第一位有效数字是十分位上的 $1$。四位有效数字是 $1, 4, 7, 7$。第五位有效数字是 $9$，因此需要将第四位数字向上取整。\n因此，每个读段的预期碱基检出错误数约等于 $0.1478$。", "answer": "$$\n\\boxed{0.1478}\n$$", "id": "2848935"}, {"introduction": "在确认了数据质量之后，下一步是进行统计建模，以揭示生物学见解。本练习将带您深入了解差异表达分析的核心，您将从头开始实现负二项式广义线性模型（Negative Binomial Generalized Linear Model, NB-GLM）。通过编写核心算法，您将深刻理解我们如何考虑文库大小、实验设计和生物学变异，从而准确地识别差异表达基因。[@problem_id:2848955]", "problem": "给定独立的基因水平RNA测序(RNA-seq)读数计数和一个带有协变量的线性设计。假设遵循分子生物学中心法则以及RNA测序计数数据的标准模型：在给定协变量和文库大小的条件下，一个基因在不同样本中的观测读数计数是带有对数连接函数的负二项(NB)广义线性模型(GLM)的实现。在该模型中，均值通过一个偏移量依赖于样本特有的文库大小因子。您的任务是使用迭代重加权最小二乘算法和Wald统计量，从第一性原理出发实现估计和推断。\n\n使用以下基本基础：\n- 分子生物学中心法则意味着信使核糖核酸(mRNA)的丰度是基因表达的代理指标，而RNA测序读数计数在根据文库大小进行调整后与丰度成正比。\n- 在具有NB2方差参数化的负二项GLM中，给定协变量，方差为 $V(Y_i) = \\mu_i + \\alpha \\mu_i^2$，其中离散度 $\\alpha > 0$。\n- 对于对数连接函数和偏移量，均值满足 $\\log \\mu_i = o_i + \\boldsymbol{x}_i^\\top \\boldsymbol{\\beta}$，其中 $o_i = \\log s_i$ 是来自文库大小因子 $s_i > 0$ 的已知偏移量，$\\boldsymbol{x}_i$ 是样本 $i$ 的协变量向量，$\\boldsymbol{\\beta}$ 是回归系数。\n- 对于一个指定的对比向量 $\\boldsymbol{c}$，Wald统计量根据估计的系数向量 $\\hat{\\boldsymbol{\\beta}}$ 及其协方差 $\\widehat{\\mathrm{Var}}(\\hat{\\boldsymbol{\\beta}})$ 计算得出，公式为 $Z = \\dfrac{\\boldsymbol{c}^\\top \\hat{\\boldsymbol{\\beta}}}{\\sqrt{\\boldsymbol{c}^\\top \\widehat{\\mathrm{Var}}(\\hat{\\boldsymbol{\\beta}})\\, \\boldsymbol{c}}}$，其双边p值从标准正态分布中获得。\n\n实现以下算法设计：\n- 使用迭代重加权最小二乘法处理带有对数连接函数和偏移量的负二项GLM：\n  - 在第 $t$ 次迭代中，给定 $\\boldsymbol{\\beta}^{(t)}$，计算 $\\eta_i^{(t)} = o_i + \\boldsymbol{x}_i^\\top \\boldsymbol{\\beta}^{(t)}$，$\\mu_i^{(t)} = \\exp(\\eta_i^{(t)})$。\n  - 定义权重 $w_i^{(t)} = \\dfrac{\\mu_i^{(t)}}{1 + \\alpha \\mu_i^{(t)}}$ 和伪响应 $z_i^{(t)} = \\eta_i^{(t)} + \\dfrac{y_i - \\mu_i^{(t)}}{\\mu_i^{(t)}}$。\n  - 通过求解加权最小二乘法正规方程 $\\left(\\boldsymbol{X}^\\top \\boldsymbol{W}^{(t)} \\boldsymbol{X}\\right) \\boldsymbol{\\beta}^{(t+1)} = \\boldsymbol{X}^\\top \\boldsymbol{W}^{(t)} \\boldsymbol{z}^{(t)}$ 来更新 $\\boldsymbol{\\beta}^{(t+1)}$，其中 $\\boldsymbol{W}^{(t)}$ 是对角线上为 $w_i^{(t)}$ 的对角矩阵。\n  - 迭代直至 $\\boldsymbol{\\beta}$ 收敛到指定的容差。\n- 收敛后，使用基于模型的协方差估计 $\\widehat{\\mathrm{Var}}(\\hat{\\boldsymbol{\\beta}}) = \\left(\\boldsymbol{X}^\\top \\hat{\\boldsymbol{W}} \\boldsymbol{X}\\right)^{-1}$，其中 $\\hat{\\boldsymbol{W}}$ 在收敛的均值处计算。\n\n对于下方的每个测试用例，拟合模型，计算处理对比的Wald统计量，并解释估计对比值的符号。按顺序报告每个测试用例的以下内容：\n- 估计的对比值 $\\hat{\\theta} = \\boldsymbol{c}^\\top \\hat{\\boldsymbol{\\beta}}$ (一个浮点数)，\n- 其标准误 $\\widehat{\\mathrm{se}} = \\sqrt{\\boldsymbol{c}^\\top \\widehat{\\mathrm{Var}}(\\hat{\\boldsymbol{\\beta}})\\, \\boldsymbol{c}}$ (一个浮点数)，\n- Wald统计量 $Z$ (一个浮点数)，\n- 标准正态分布下的双边p值 (一个浮点数)，\n- 一个布尔型解释性指标 $\\mathrm{up}$，其当且仅当 $\\hat{\\theta} > 0$ 时为真。\n\n所有数值答案必须根据上述定义计算。本问题不涉及物理单位。不出现角度。不需要百分比。最终输出必须生成为单行：一个列表，其元素是每个测试用例的结果列表，以逗号分隔并用方括号括起来。\n\n测试套件。对于每个测试用例，设计矩阵有三列：一个截距项、一个处理指示符和一个批次指示符。对比始终是处理效应，即 $\\boldsymbol{c} = [\\,0,\\,1,\\,0\\,]^\\top$。对于每种情况，给定计数向量 $\\boldsymbol{y}$、处理向量 $\\boldsymbol{T}$、批次向量 $\\boldsymbol{B}$、正文库大小因子 $\\boldsymbol{s}$ 和离散度 $\\alpha$。\n\n- 情况A (一般情况，中等计数，正处理效应):\n  - $\\boldsymbol{y} = [\\,16,\\,17,\\,23,\\,30,\\,45,\\,31\\,]$\n  - $\\boldsymbol{T} = [\\,0,\\,0,\\,0,\\,1,\\,1,\\,1\\,]$\n  - $\\boldsymbol{B} = [\\,0,\\,1,\\,0,\\,1,\\,0,\\,1\\,]$\n  - $\\boldsymbol{s} = [\\,0.8,\\,1.0,\\,1.2,\\,0.9,\\,1.1,\\,0.95\\,]$\n  - $\\alpha = 0.15$\n- 情况B (接近零的处理效应，中等计数):\n  - $\\boldsymbol{y} = [\\,12,\\,12,\\,13,\\,14,\\,12,\\,16\\,]$\n  - $\\boldsymbol{T} = [\\,0,\\,0,\\,0,\\,1,\\,1,\\,1\\,]$\n  - $\\boldsymbol{B} = [\\,0,\\,1,\\,0,\\,1,\\,0,\\,1\\,]$\n  - $\\boldsymbol{s} = [\\,1.0,\\,0.9,\\,1.1,\\,1.05,\\,0.95,\\,1.2\\,]$\n  - $\\alpha = 0.20$\n- 情况C (样本量较大，负处理效应，批次效应较强):\n  - $\\boldsymbol{y} = [\\,19,\\,45,\\,27,\\,38,\\,13,\\,25,\\,15,\\,22\\,]$\n  - $\\boldsymbol{T} = [\\,0,\\,0,\\,0,\\,0,\\,1,\\,1,\\,1,\\,1\\,]$\n  - $\\boldsymbol{B} = [\\,0,\\,1,\\,0,\\,1,\\,0,\\,1,\\,0,\\,1\\,]$\n  - $\\boldsymbol{s} = [\\,0.7,\\,1.3,\\,1.0,\\,1.1,\\,0.8,\\,1.2,\\,0.9,\\,1.05\\,]$\n  - $\\alpha = 0.10$\n- 情况D (计数较小，离散度高):\n  - $\\boldsymbol{y} = [\\,3,\\,4,\\,2,\\,3\\,]$\n  - $\\boldsymbol{T} = [\\,0,\\,1,\\,0,\\,1\\,]$\n  - $\\boldsymbol{B} = [\\,0,\\,0,\\,1,\\,1\\,]$\n  - $\\boldsymbol{s} = [\\,1.0,\\,0.8,\\,1.2,\\,1.1\\,]$\n  - $\\alpha = 1.00$\n\n设计矩阵的构建：对于每种情况，将 $\\boldsymbol{X}$ 定义为 $n \\times 3$ 矩阵，其列为 $\\boldsymbol{1}_n$, $\\boldsymbol{T}$, 和 $\\boldsymbol{B}$。对每个样本 $i$ 使用偏移量 $o_i = \\log s_i$。\n\n要求的最终输出格式：\n- 对于A, B, C, D四种情况，按顺序输出列表 $[\\,\\hat{\\theta},\\,\\widehat{\\mathrm{se}},\\,Z,\\,p,\\,\\mathrm{up}\\,]$，其中 $\\hat{\\theta}$、$\\widehat{\\mathrm{se}}$、$Z$ 和 $p$ 是四舍五入到六位小数的浮点数，$\\mathrm{up}$ 是一个布尔值。\n- 您的程序应生成单行输出，其中包含一个以逗号分隔并用方括号括起来的结果列表，每个元素是对应一个测试用例的结果列表（例如， \"[[...],[...],[...],[...]]\"）。", "solution": "该问题要求实现一个用于分析RNA测序(RNA-seq)计数数据的统计程序。该问题陈述的有效性得到了确认，因为它科学地基于转录组学和生物统计学的既定原则，问题设定良好并提供了所有必要信息，且其表述是客观的。所描述的模型和算法是差异基因表达分析领域的标准方法。\n\n问题的核心是将负二项(NB)广义线性模型(GLM)拟合到基因表达计数上。其生物学前提植根于中心法则，即通过RNA-seq读数计数测得的mRNA丰度反映了基因表达水平。每个样本 $i$ 的计数数据 $Y_i$ 被建模为一个遵循负二项分布的随机变量。\n\n模型规范如下：\n均值 $\\mu_i = E[Y_i]$ 通过一个对数连接函数与一组协变量 $\\boldsymbol{x}_i$ 相关联，并带有一个偏移项 $o_i$ 以解释样本间文库大小（测序深度）的差异。线性预测变量 $\\eta_i$ 和均值 $\\mu_i$ 由以下公式给出：\n$$ \\eta_i = \\boldsymbol{x}_i^\\top \\boldsymbol{\\beta} + o_i $$\n$$ \\mu_i = \\exp(\\eta_i) $$\n这里，$\\boldsymbol{\\beta}$ 是待估计的回归系数向量，偏移量 $o_i$ 定义为文库大小因子 $s_i$ 的对数，即 $o_i = \\log s_i$。\n\n在NB2参数化下，NB分布的方差与均值的关系为：\n$$ V(Y_i) = \\mu_i + \\alpha \\mu_i^2 $$\n其中 $\\alpha > 0$ 是离散度参数，它捕捉了超出泊松模型（方差等于均值）预期的生物学和技术变异。对于每个测试用例，都提供了一个固定的 $\\alpha$ 值。\n\n为了估计系数向量 $\\boldsymbol{\\beta}$，我们采用迭代重加权最小二乘(IRLS)算法。IRLS是一种数值方法，通过迭代求解一系列加权最小二乘(WLS)问题来找到 $\\boldsymbol{\\beta}$ 的最大似然估计(MLE)。该算法过程如下：\n\n1.  **初始化**：算法从一个系数的初始猜测值 $\\boldsymbol{\\beta}^{(0)}$ 开始。一个标准而简单的选择是 $\\boldsymbol{\\beta}^{(0)} = \\boldsymbol{0}$。\n\n2.  **迭代**：在每次迭代 $t$ 中，给定当前估计 $\\boldsymbol{\\beta}^{(t-1)}$，我们为每个样本 $i=1, \\dots, n$ 计算以下量：\n    -   线性预测变量：$\\eta_i^{(t-1)} = \\boldsymbol{x}_i^\\top \\boldsymbol{\\beta}^{(t-1)} + o_i$。\n    -   拟合的均值：$\\mu_i^{(t-1)} = \\exp(\\eta_i^{(t-1)})$。\n    -   伪响应或“工作因变量”：$z_i^{(t-1)} = \\eta_i^{(t-1)} + \\dfrac{y_i - \\mu_i^{(t-1)}}{\\mu_i^{(t-1)}}$。这将模型在当前估计值周围线性化。\n    -   IRLS权重：$w_i^{(t-1)} = \\left( \\left(\\frac{\\partial \\mu_i}{\\partial \\eta_i}\\right)^2 V(Y_i)^{-1} \\right)_{\\boldsymbol{\\beta}^{(t-1)}} = \\dfrac{(\\mu_i^{(t-1)})^2}{\\mu_i^{(t-1)} + \\alpha (\\mu_i^{(t-1)})^2} = \\dfrac{\\mu_i^{(t-1)}}{1 + \\alpha \\mu_i^{(t-1)}}$。这些权重是伪响应方差的倒数。\n\n3.  **更新**：通过求解WLS正规方程获得新的估计 $\\boldsymbol{\\beta}^{(t)}$。设 $\\boldsymbol{X}$ 为 $n \\times p$ 的设计矩阵，$\\boldsymbol{z}^{(t-1)}$ 为伪响应向量，$\\boldsymbol{W}^{(t-1)}$ 为权重对角矩阵。更新公式为：\n    $$ \\boldsymbol{\\beta}^{(t)} = \\left(\\boldsymbol{X}^\\top \\boldsymbol{W}^{(t-1)} \\boldsymbol{X}\\right)^{-1} \\boldsymbol{X}^\\top \\boldsymbol{W}^{(t-1)} \\boldsymbol{z}^{(t-1)} $$\n\n4.  **收敛**：重复步骤2和3，直到连续迭代中 $\\boldsymbol{\\beta}$ 的变化小于指定的容差，即 $||\\boldsymbol{\\beta}^{(t)} - \\boldsymbol{\\beta}^{(t-1)}||_2 < \\epsilon$。收敛后的向量即为MLE，$\\hat{\\boldsymbol{\\beta}}$。\n\n一旦获得MLE $\\hat{\\boldsymbol{\\beta}}$，我们对由对比向量 $\\boldsymbol{c}$ 定义的系数的特定线性组合进行统计推断。在这个问题中，对比向量是 $\\boldsymbol{c} = [\\,0,\\,1,\\,0\\,]^\\top$，它分离出处理效应的系数。估计的效应大小为 $\\hat{\\theta} = \\boldsymbol{c}^\\top \\hat{\\boldsymbol{\\beta}}$。\n\n为了检验原假设 $H_0: \\boldsymbol{c}^\\top \\boldsymbol{\\beta} = 0$，我们使用Wald检验。Wald统计量需要 $\\hat{\\theta}$ 的标准误，该标准误源自 $\\hat{\\boldsymbol{\\beta}}$ 的协方差矩阵。估计的协方差矩阵是Fisher信息矩阵在MLE处的逆：\n$$ \\widehat{\\mathrm{Var}}(\\hat{\\boldsymbol{\\beta}}) = \\left(\\boldsymbol{X}^\\top \\hat{\\boldsymbol{W}} \\boldsymbol{X}\\right)^{-1} $$\n其中 $\\hat{\\boldsymbol{W}}$ 是使用最终收敛的均值 $\\hat{\\boldsymbol{\\mu}}$ 计算的权重矩阵。\n\n对比的标准误则为：\n$$ \\widehat{\\mathrm{se}}(\\hat{\\theta}) = \\sqrt{\\boldsymbol{c}^\\top \\widehat{\\mathrm{Var}}(\\hat{\\boldsymbol{\\beta}})\\, \\boldsymbol{c}} $$\n\nWald统计量 $Z$ 计算为估计值与其标准误之比：\n$$ Z = \\frac{\\hat{\\theta}}{\\widehat{\\mathrm{se}}(\\hat{\\theta})} $$\n\n在原假设下，$Z$ 服从标准正态分布 $\\mathcal{N}(0, 1)$。双边p值计算为 $p = 2 \\cdot P(N > |Z|)$，其中 $N \\sim \\mathcal{N}(0, 1)$。\n\n最后，生成一个表示效应方向的指标：如果 $\\hat{\\theta} > 0$，表示上调，则 $\\mathrm{up}$ 为真，否则为假。将此完整过程应用于提供的每个测试用例。", "answer": "[[0.449774,0.279612,1.608560,0.107706,true],[-0.046029,0.301599,-0.152618,0.878700,false],[-0.435773,0.315024,-1.383301,0.166560,false],[0.366479,0.923405,0.396899,0.691452,true]]", "id": "2848955"}]}