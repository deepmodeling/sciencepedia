{"hands_on_practices": [{"introduction": "长非编码RNA（lncRNA）的一个关键调控机制是作为分子“海绵”或诱饵，隔离转录因子等蛋白质，从而调节其活性。为了从根本上理解这种竞争性结合的后果，我们可以运用质量作用定律建立一个定量的数学模型。通过这个练习 [@problem_id:2826230]，你将基于基本的化学平衡原理，计算在给定浓度和解离常数（$K_d$）的情况下，有多少转录因子被lncRNA隔离，并预测这对目标基因转录的最终影响。", "problem": "一种长链非编码RNA (lncRNA) 可以作为转录因子 (TF) 的分子诱饵，将TF从靶基因的启动子上隔离。考虑TF和lncRNA之间形成TF–lncRNA复合物的一对一可逆结合。假设在单个隔室中处于充分混合的平衡状态，并遵循质量作用动力学。设总TF浓度为 $[T]_{\\text{tot}} = 50\\,\\text{nM}$，总lncRNA浓度为 $[L]_{\\text{tot}} = 30\\,\\text{nM}$，TF–lncRNA结合的解离常数为 $K_{d,TL} = 5\\,\\text{nM}$。该TF还与靶基因的单个同源启动子位点结合，解离常数为 $K_{d,D} = 10\\,\\text{nM}$。假设启动子位点的浓度与 $[T]_{\\text{tot}}$ 和 $[L]_{\\text{tot}}$ 相比可以忽略不计，因此启动子结合不会显著消耗游离的TF库。进一步假设，转录速率与TF对启动子的占有率成正比，希尔系数为 $1$（一个TF结合位点，无协同性），并且所有下游步骤都与占有率成线性关系。\n\n仅从解离常数的质量作用定义和质量守恒出发，首先计算被lncRNA隔离的TF的平衡分数。然后，使用游离TF浓度来确定启动子占有率，并预测在有lncRNA存在的情况下，相对于没有lncRNA的假设情况，转录速率的倍数变化。请以单个精确分数（无单位）的形式报告您的最终答案。如果使用了近似，则四舍五入到四位有效数字并明确说明；否则，请提供精确值。", "solution": "该问题要求分析竞争性结合平衡。分析必须基于化学动力学和热力学的基本原理，特别是质量作用定律和质量守恒定律。我们将首先验证问题陈述的有效性。\n\n已知条件如下：\n- 总转录因子浓度：$[T]_{\\text{tot}} = 50\\,\\text{nM}$\n- 总长链非编码RNA浓度：$[L]_{\\text{tot}} = 30\\,\\text{nM}$\n- TF–lncRNA结合的解离常数：$K_{d,TL} = 5\\,\\text{nM}$\n- TF–启动子结合的解离常数：$K_{d,D} = 10\\,\\text{nM}$\n- 启动子位点的浓度与 $[T]_{\\text{tot}}$ 和 $[L]_{\\text{tot}}$ 相比可以忽略不计。\n- 转录速率与启动子占有率成正比。\n- 启动子结合涉及一个位点，希尔系数为 $1$。\n\n该问题具有科学依据，提法恰当且客观。它描述了一个分子隔离的标准模型，这是基因调控中的一种常见机制。所有必要的参数都已提供，并且在简化模型的背景下，所做的假设陈述清晰且物理上合理。问题有效。我们开始求解。\n\n设 $[T]$, $[L]$ 和 $[C]$ 分别代表游离转录因子、游离lncRNA和TF–lncRNA复合物的平衡浓度。该系统受两个原理支配：\n\n1.  **质量守恒**: TF和lncRNA的总浓度是恒定的。\n    $$[T]_{\\text{tot}} = [T] + [C]$$\n    $$[L]_{\\text{tot}} = [L] + [C]$$\n\n2.  **质量作用定律**: 在平衡状态下，解离反应 $C \\rightleftharpoons T + L$ 的产物与反应物的比率由解离常数 $K_{d,TL}$ 定义。\n    $$K_{d,TL} = \\frac{[T][L]}{[C]}$$\n\n根据质量守恒方程，我们将复合物和游离lncRNA的浓度用游离TF浓度 $[T]$ 表示：\n$$[C] = [T]_{\\text{tot}} - [T]$$\n$$[L] = [L]_{\\text{tot}} - [C] = [L]_{\\text{tot}} - ([T]_{\\text{tot}} - [T]) = [L]_{\\text{tot}} - [T]_{\\text{tot}} + [T]$$\n\n将这些表达式代入质量作用方程，得到一个仅含 $[T]$ 的方程：\n$$K_{d,TL} = \\frac{[T]([L]_{\\text{tot}} - [T]_{\\text{tot}} + [T])}{[T]_{\\text{tot}} - [T]}$$\n\n整理此表达式可得到关于 $[T]$ 的二次方程：\n$$K_{d,TL}([T]_{\\text{tot}} - [T]) = [T]^2 + ([L]_{\\text{tot}} - [T]_{\\text{tot}})[T]$$\n$$0 = [T]^2 + ([L]_{\\text{tot}} - [T]_{\\text{tot}} + K_{d,TL})[T] - K_{d,TL}[T]_{\\text{tot}}$$\n\n现在，我们代入给定值：$[T]_{\\text{tot}} = 50\\,\\text{nM}$，$[L]_{\\text{tot}} = 30\\,\\text{nM}$ 和 $K_{d,TL} = 5\\,\\text{nM}$。\n一次项的系数是：\n$$[L]_{\\text{tot}} - [T]_{\\text{tot}} + K_{d,TL} = 30 - 50 + 5 = -15\\,\\text{nM}$$\n常数项是：\n$$-K_{d,TL}[T]_{\\text{tot}} = -(5)(50) = -250\\,\\text{nM}^2$$\n\n因此，关于 $[T]$ 的二次方程是：\n$$[T]^2 - 15[T] - 250 = 0$$\n\n我们使用二次方程求根公式 $[T] = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 来解这个方程，其中 $a=1$, $b=-15$, $c=-250$：\n$$[T] = \\frac{-(-15) \\pm \\sqrt{(-15)^2 - 4(1)(-250)}}{2(1)}$$\n$$[T] = \\frac{15 \\pm \\sqrt{225 + 1000}}{2}$$\n$$[T] = \\frac{15 \\pm \\sqrt{1225}}{2}$$\n由于 $\\sqrt{1225} = 35$，我们得到两个数学解：\n$$[T]_{1} = \\frac{15 + 35}{2} = \\frac{50}{2} = 25\\,\\text{nM}$$\n$$[T]_{2} = \\frac{15 - 35}{2} = \\frac{-20}{2} = -10\\,\\text{nM}$$\n负浓度在物理上是不可能的。因此，游离TF浓度的唯一有效解是 $[T] = 25\\,\\text{nM}$。\n\n被隔离的TF浓度为 $[C] = [T]_{\\text{tot}} - [T] = 50\\,\\text{nM} - 25\\,\\text{nM} = 25\\,\\text{nM}$。被lncRNA隔离的TF的分数是 $\\frac{[C]}{[T]_{\\text{tot}}} = \\frac{25}{50} = \\frac{1}{2}$。\n\n接下来，我们确定启动子占有率 $\\theta_D$。对于单个非协同结合位点（希尔系数为 $1$），占有率由Langmuir等温线给出：\n$$\\theta_D = \\frac{[T]}{K_{d,D} + [T]}$$\n问题陈述转录速率与此占有率成正比。转录的倍数变化是有lncRNA存在时的转录速率与没有lncRNA存在时的转录速率之比。\n$$\\text{Fold-change} = \\frac{\\text{Rate}_{\\text{with lncRNA}}}{\\text{Rate}_{\\text{without lncRNA}}} = \\frac{\\theta_{D, \\text{with}}}{\\theta_{D, \\text{without}}}$$\n\n首先，我们使用我们求出的游离TF浓度 $[T] = 25\\,\\text{nM}$ 和给定的 $K_{d,D} = 10\\,\\text{nM}$，计算有lncRNA存在时的占有率。\n$$\\theta_{D, \\text{with}} = \\frac{25}{10 + 25} = \\frac{25}{35} = \\frac{5}{7}$$\n\n其次，我们计算在没有lncRNA的假设情况下的占有率。在这种情况下，没有TF被隔离，因此可用于启动子结合的游离TF浓度就是总TF浓度，即 $[T] = [T]_{\\text{tot}} = 50\\,\\text{nM}$。这是有效的，因为假设启动子浓度可忽略不计，不会消耗游离TF库。\n$$\\theta_{D, \\text{without}} = \\frac{50}{10 + 50} = \\frac{50}{60} = \\frac{5}{6}$$\n\n最后，转录速率的倍数变化是这两个占有率之比：\n$$\\text{Fold-change} = \\frac{\\theta_{D, \\text{with}}}{\\theta_{D, \\text{without}}} = \\frac{5/7}{5/6} = \\frac{5}{7} \\times \\frac{6}{5} = \\frac{6}{7}$$\n\n这就是最终答案，按要求以精确分数形式呈现。lncRNA的存在降低了游离TF的浓度，导致启动子占有率下降，从而使转录速率降低到其潜在水平的 $6/7$。", "answer": "$$\\boxed{\\frac{6}{7}}$$", "id": "2826230"}, {"introduction": "在活细胞中确定lncRNA的功能远比理论模型复杂，因为其功能可能源于RNA分子本身（反式作用），也可能源于其基因座的转录过程或DNA元件的顺式调控活性。区分这些机制是lncRNA研究的核心挑战。这个实践 [@problem_id:2826291] 提供了一系列精心设计的基因扰动实验（如CRISPRi、启动子替换和转录终止子插入）的模拟结果，要求你像一位分子遗传学家一样，综合分析数据，以推断出最符合所有证据的调控模型。", "problem": "一个实验室正在研究一个长链非编码RNA（lncRNA）位点（表示为 `L`），如何以顺式（in cis）方式影响邻近一个蛋白质编码基因 `G` 的稳态信使RNA（mRNA）水平。该团队希望区分这种调控是需要通过 `L` 的转录过程本身（例如，RNA聚合酶II的延伸改变局部染色质结构），还是需要序列特异性的lncRNA产物。他们在其他条件相同且细胞周期阶段匹配的情况下，进行了以下扰动和分析：\n\n- 需假设的定义和基本原理：\n  - 根据中心法则，DNA由RNA聚合酶II（RNAP II）转录为RNA，对于蛋白质编码基因，RNA被翻译成蛋白质。长链非编码RNA（lncRNA）被转录但不被翻译，它们可以以顺式（影响邻近位点）或反式（可扩散的RNA作用于远距离位点）方式调控基因表达。\n  - 顺式调控要求基因组位点或局部转录活动影响邻近的基因表达。反式调控由一种可扩散的分子介导，该分子可以从异位基因组位置发挥作用。\n  - 转录起始发生在转录起始位点（TSS）附近的启动子上，RNAP II沿基因体延伸，转录终止发生在一个转录终止信号处（例如，一个多聚腺苷酸化信号）。\n\n- 扰动实验：\n  1. 野生型（$\\mathrm{WT}$）。\n  2. 使用靶向 `L` 启动子的核酸酶失活的Cas9进行CRISPR干扰（CRISPRi），以阻断转录起始（无序列删除）。\n  3. 精确删除最小 `L` 启动子（移除启动子DNA）。\n  4. 在相对于 `L` TSS下游 $+150$ 碱基对处，插入一个强效、方向正确的基于多聚腺苷酸化的转录终止子盒，同时保持 `L` 启动子DNA完整。\n  5. 用一个不相关的异源启动子替换 `L` 启动子，该启动子能以与野生型相似的转录水平恢复RNAP II在 `L` 基因体上的起始和延伸，同时打乱 `L` 的外显子序列，从而使任何原始RNA序列基序丢失，但转录仍能穿过原始的 `L` 基因组区域。\n  6. 在一个中性的“安全港”位点，使用一个诱导型启动子，以反式方式表达 `L` RNA序列，使其水平与野生型匹配，而不改变内源性 `L` 位点（此实验在扰动4的背景下进行测试）。\n\n- 测量指标：\n  - 对全长 `L` RNA（引物跨越远端外显子）和 `G` mRNA进行逆转录定量聚合酶链式反应（RT-qPCR），并以$\\mathrm{WT}=1.0$进行归一化。\n  - 对 `L` 区域进行RNAP II染色质免疫共沉淀后测序（ChIP-seq），以评估起始和延伸的分布情况。\n\n- 结果：\n  - 条件1（$\\mathrm{WT}$）：全长 `L` RNA $=1.0$，$G$ mRNA $=1.0$，RNAP II信号覆盖 `L` 基因体。\n  - 条件2（在 `L` 启动子上CRISPRi）：`L` RNA $\\approx 0.05$，$G$ mRNA $\\approx 0.30$，$L$ TSS和基因体处的RNAP II信号减少。\n  - 条件3（`L` 启动子删除）：`L` RNA $\\approx 0.00$，$G$ mRNA $\\approx 0.30$，$L$ 位点无RNAP II信号。\n  - 条件4（在$+150$碱基对处引入早期终止子）：全长 `L` RNA $\\approx 0.05$，在TSS附近可检测到短的 `L` 近端转录本，$G$ mRNA $\\approx 0.30$，RNAP II信号在 `L` 启动子处积累，并在$+150$碱基对后急剧下降（没有通过 `L` 的剩余部分进行延伸）。\n  - 条件5（用异源启动子替换并打乱 `L` 外显子）：`L` 区域的转录被恢复（ChIP-seq显示RNAP II在 `L` 区域起始和延伸），使用原始外显子引物通过RT-qPCR检测不到原始 `L` RNA序列，$G$ mRNA $\\approx 1.0$。\n  - 条件6（在条件4背景下，反式表达外源 `L` RNA）：外源 `L` RNA（来自安全港）$=1.0$，内源全长 `L` RNA保持在 $\\approx 0.05$，$G$ mRNA保持在 $\\approx 0.30$。\n\n基于这些结果和转录调控的基本原理，哪种解释最能说明 `L` 位点调控 `G` 的机制？\n\nA. `L` RNA作为一种可扩散的反式作用效应子；`L` RNA的序列是调控 `G` 的必要且充分条件，与内源性 `L` 位点的转录状态无关。\n\nB. `L` 启动子DNA包含一个增强子样序列，它调控 `G` 而无需 `L` 的转录起始或延伸。\n\nC. 调控 `G` 所需的是RNAP II以顺式方式通过 `L` 基因组区域的转录过程本身，而不是 `L` RNA产物的序列。\n\nD. `L` 的开放阅读框编码一个微肽，其翻译对于调控 `G` 是必需的，这一点由早期终止子破坏编码潜能以及外源RNA补救失败所证明。", "solution": "问题陈述描述了一系列分子生物学实验，旨在阐明一个长链非编码RNA（lncRNA）位点（表示为 `L`）对一个邻近蛋白质编码基因 `G` 的调控机制。核心任务是区分依赖于lncRNA分子本身（一种反式作用或序列特异性的顺式作用产物）的机制，与依赖于通过 `L` 位点的转录过程（一种顺式作用过程）的机制。\n\n### 第一步：提取已知信息\n\n- **位点：** 基因 `G`（蛋白质编码）和lncRNA位点 `L` 在基因组上相邻（顺式）。\n- **野生型（WT）状态：** 位点 `L` 被转录，产生 `L` RNA。基因 `G` 被表达。这是用于比较的基线，`L` RNA水平设为 `1.0`，`G` mRNA水平设为 `1.0`。在 `L` 基因体上观察到RNAP II。\n- **扰动1（WT）：** `L` RNA $= 1.0$，`G` mRNA $= 1.0$。\n- **扰动2（在 `L` 启动子上CRISPRi）：** 阻断在 `L` 上的转录起始。结果：`L` RNA `$\\approx 0.05$`，`G` mRNA `$\\approx 0.30$`。在 `L` 上的RNAP II信号减少。\n- **扰动3（`L` 启动子删除）：** 移除 `L` 启动子序列。结果：`L` RNA `$\\approx 0.00$`，`G` mRNA `$\\approx 0.30$`。在 `L` 上无RNAP II信号。\n- **扰动4（早期终止子插入）：** 在相对于 `L` TSS的 `$+150$` bp处插入一个转录终止子。结果：全长 `L` RNA `$\\approx 0.05$`，但可检测到短转录本。`G` mRNA `$\\approx 0.30$`。RNAP II延伸在 `$+150$` bp后被阻断。\n- **扰动5（用打乱外显子的异源启动子替换）：** 内源性 `L` 启动子被替换为一个异源启动子，且 `L` 外显子序列被打乱。通过 `L` 区域的转录恢复至WT水平。结果：检测不到原始 `L` RNA，但 `G` mRNA恢复至 `$\\approx 1.0$`。\n- **扰动6（反式互补）：** 在扰动 `4` 的背景下，从不同基因组位点表达 `L` RNA序列。结果：外源 `L` RNA水平为 `1.0`，但 `G` mRNA仍保持在 `$\\approx 0.30$` 的低水平。\n\n### 第二步：使用提取的已知信息进行验证\n\n该问题提出了分子遗传学中一个假设性但实验上可行的场景。所描述的技术（CRISPRi、启动子删除、终止子插入、启动子交换、反式互补）是标准方法。数据内部一致，允许进行逻辑推导。该问题在科学上基于lncRNA调控基因的原理，问题提出得很好、客观，并且不违反任何基本原理。这是一个有效的问题。\n\n### 第三步：推导解决方案\n\n目标是确定 `L` 位点调控 `G` 表达的机制。我们将分析结果以检验主要的竞争性假说：（1）由可扩散的 `L` RNA产物进行调控（反式），（2）由 `L` 位点内的静态DNA元件（如增强子）进行调控，以及（3）由通过 `L` 位点的物理转录行为进行调控（顺式）。\n\n- **扰动2和3的分析：** 阻断或移除 `L` 启动子会废除 `L` 的转录，并导致 `G` mRNA水平显著降低（从 `1.0` 降至 `$\\approx 0.30$`）。这证实了来自 `L` 位点的活跃转录是 `G` 正常表达所必需的。\n\n- **扰动6的分析：** 这是检验反式作用机制的关键实验。在内源性 `L` 位点不能正常转录的背景下（条件 `4`），从一个异位位点（“反式”）提供了 `L` RNA分子。结果是 `G` 的表达*没有*被挽救；它仍然保持在 `$\\approx 0.30$`。这个实验决定性地驳斥了 `L` RNA作为一种可扩散的反式作用分子发挥作用的假说。调控效应必须局限于原始位点，即它必须是一种顺式机制。\n\n- **扰动4的分析：** 在此条件下，`L` 启动子是完整的并能起始转录，但RNAP II被迫提前终止。全长 `L` RNA没有产生，并且至关重要的是，RNAP II没有通过 `L` 基因体的大部分区域进行延伸。其结果是 `G` 的表达降低到 `$\\approx 0.30$`，与完全阻断 `L` 转录时的水平相同。这表明在 `L` 启动子上的转录起始不足以进行调控；还需要其他条件。两种可能性是：要么需要全长RNA产物，要么需要通过该位点的转录延伸过程。\n\n- **扰动5的分析：** 这个实验旨在区分从扰动 `4` 分析中得出的两个剩余可能性。`L` RNA序列被扰乱，破坏了任何序列特异性信息，但通过使用不同的启动子，恢复了通过 `L` 基因组区域的转录*行为*。结果是 `G` mRNA水平恢复到 `$\\approx 1.0$`。由于相对于原始 `L` RNA，现在的RNA序列是无意义的，但 `G` 的表达却恢复正常，我们必须得出结论：`L` RNA的特定序列并非必需。相反，RNAP II转录机器物理上穿过 `L` 基因组区域是上调 `G` 的必要且充分的事件。\n\n**综合分析：** 这一系列实验共同指向一个单一、一致的模型。`L` 位点对 `G` 的调控以顺式方式发生。它不是由 `L` RNA分子反式作用介导的（被实验 `6` 驳斥），也不是由RNA产物的序列介导的（被实验 `5` 驳斥）。它也不仅仅是由于启动子中存在一个独立于转录发挥作用的增强子元件，因为没有完全延伸的活跃转录起始是不够的（实验 `4`）。唯一能解释所有观察结果的假说是，通过 `L` 基因组区域的*转录行为*本身就是调控机制。这是lncRNA作用的一种已知模式，通常被称为转录干扰或相关的顺式作用转录过程。\n\n### 逐项分析选项\n\n- **A. `L` RNA作为一种可扩散的反式作用效应子；`L` RNA的序列是调控 `G` 的必要且充分条件，与内源性 `L` 位点的转录状态无关。**\n这一说法被实验 `6` 的结果直接且明确地驳斥。在反式条件下表达 `L` RNA未能恢复 `G` 的低表达表型。因此，`L` RNA不是一种可扩散的反式作用效应子。\n**结论：错误。**\n\n- **B. `L` 启动子DNA包含一个增强子样序列，它调控 `G` 而无需 `L` 的转录起始或延伸。**\n这一说法被多个实验所驳斥。如果启动子是一个不依赖转录的增强子，删除它（实验 `3`）会降低 `G` 的表达，这一点确实观察到了。然而，在实验 `4` 中，启动子存在且活跃，但由于延伸受阻，`G` 的表达水平很低。如果作为静态增强子起作用的启动子是充分的，那么 `G` 的表达应该很高。此外，在实验 `5` 中，内源性启动子被一个异源启动子*替换*，但 `G` 的表达却恢复了。这表明 `L` 启动子的特定序列并非必需，这反驳了它是一个独特的增强子元件的观点。所需的是一个能够驱动转录通过该位点的启动子。\n**结论：错误。**\n\n- **C. 调控 `G` 所需的是RNAP II以顺式方式通过 `L` 基因组区域的转录过程本身，而不是 `L` RNA产物的序列。**\n这一说法与所有给出的数据一致。实验 `2`、`3` 和 `4` 表明，破坏转录（起始或延伸）会降低 `G` 的表达。实验 `6` 排除了反式作用的RNA产物。至关重要的是，实验 `5` 证明，恢复通过该区域的转录——即使用一个被打乱的、无功能的RNA序列——也足以将 `G` 的表达恢复到野生型水平。这直接支持了转录过程本身就是调控机制的结论。\n**结论：正确。**\n\n- **D. `L` 的开放阅读框编码一个微肽，其翻译对于调控 `G` 是必需的，这一点由早期终止子破坏编码潜能以及外源RNA补救失败所证明。**\n这是RNA产物依赖假说的一个特定版本。它被驳斥的原因与选项A相同，甚至更多。首先，反式互补实验（`6`）的失败反驳了任何翻译产物（它将是可扩散的）的功能。其次，更具决定性的是，实验 `5` 在打乱 `L` 外显子序列后恢复了 `G` 的表达。打乱序列几乎肯定会破坏任何预先存在的开放阅读框，从而阻止假定微肽的产生。由于 `G` 的表达得到了恢复，所以微肽不可能是其作用机制。\n**结论：错误。**", "answer": "$$\\boxed{C}$$", "id": "2826291"}, {"introduction": "将分子机制的理解与全基因组关联研究（GWAS）等大规模人类遗传学数据联系起来，是现代遗传学的核心前沿。我们如何从一个统计关联信号推断出其背后是由lncRNA介导的因果通路？这个高级计算实践 [@problem_id:2826218] 将指导你从贝叶斯统计的第一性原理出发，设计并实现一个整合等位基因特异性表达（ASE）、QTL和GWAS信号的量化流程，以计算一个特定lncRNA介导致病风险的后验概率。", "problem": "你的任务是设计并实现一个有原则的、量化的流程，该流程整合等位基因特异性表达、染色质可及性数量性状位点和全基因组关联研究信号，以推断一个长非编码RNA是否在某个基因座介导了因果关联。具体来说，考虑一个在相关测定中为杂合的单一双等位基因变异（两个等位基因：参考和备选），具有以下可观测量：(i) 对长非编码RNA表达的汇总效应估计，(ii) 对附近调控元件的染色质可及性的汇总效应估计，(iii) 来自全基因组关联研究的对某个复杂性状的汇总效应估计，以及 (iv) 在杂合个体中，对应到长非编码RNA的备选和参考等位基因的读数的等位基因特异性计数。你的目标是仅使用基础的概率论和统计学知识，计算一个机理模型的后验概率，在该模型中，同一个因果变异是所有三种关联的基础，且长非编码RNA介导了下游效应。\n\n基础出发点：\n- 中心法则和基因调控概念：变异可以调节长非编码RNA的转录，进而影响染色质可及性，并最终影响性状。这为建立一个机理模型提供了动机，但没有规定具体的公式。\n- 贝叶斯定理、用于已知标准误差的效应估计的正态分布，以及用于等位基因特异性计数的带有共轭Beta先验的二项分布。\n\n用于推导的假设：\n- 对于具有单变异摘要统计量的性状，观测到的回归系数 $\\hat{\\beta}$ 的抽样分布为 $\\hat{\\beta} \\sim \\mathcal{N}(\\beta, s^2)$，其中 $\\beta$ 是真实效应，$s$ 是报告的标准误差。\n- 在变异影响性状的备择假设下，真实效应的先验分布为 $\\beta \\sim \\mathcal{N}(0, W)$，先验方差 $W > 0$。在零假设下，$\\beta = 0$。\n- 对于等位基因特异性表达，给定 $n$ 个等位基因信息读数，备选等位基因计数 $k$ 服从 $k \\sim \\mathrm{Binomial}(n, p)$，其中 $p$ 是等位基因表达概率。在无等位基因不平衡的零假设下，$p = 1/2$。在存在不平衡的备择假设下，对 $p$ 设置一个对称的 $\\mathrm{Beta}(\\alpha, \\alpha)$ 先验，其中 $\\alpha > 0$。\n\n用于比较单一变异和基因座的机理模型：\n- $M_0$：与长非编码RNA表达无关联，与染色质可及性无关联，与性状无关联。\n- $M_{1e}$：仅与长非编码RNA表达有关联。\n- $M_{1c}$：仅与染色质可及性有关联。\n- $M_{1g}$：仅与性状有关联。\n- $M_{2ec}$：与长非编码RNA表达和染色质可及性有关联（共享因果变异）。\n- $M_{2eg}$：与长非编码RNA表达和性状有关联（共享因果变异）。\n- $M_{2cg}$：与染色质可及性和性状有关联（共享因果变异）。\n- $M_3$：与所有三者都有关联（共享因果变异），并附加长非编码RNA介导的机理一致性。机理一致性由两个符号一致性似然比编码：一个是长非编码RNA表达效应方向与等位基因特异性表达方向之间的一致性，另一个是染色质可及性效应与性状效应方向之间的一致性。\n\n先验和超参数（固定且已知）：\n- 效应大小的先验方差：$W = 0.04$。\n- 等位基因特异性表达不平衡的先验：$\\alpha = 1$（均匀分布）。\n- 符号一致性对数似然增量：$\\kappa_{e\\_ASE} = 1.0$ 用于长非编码RNA表达与等位基因特异性表达，$\\kappa_{c\\_g} = 0.5$ 用于染色质可及性与性状。\n- 模型的先验概率（这些概率的总和必须小于 $1$，以使 $M_0$ 具有正的先验质量）：\n  - $\\pi_{1e} = 10^{-3}$, $\\pi_{1c} = 10^{-3}$, $\\pi_{1g} = 10^{-3}$,\n  - $\\pi_{2ec} = 10^{-5}$, $\\pi_{2eg} = 10^{-5}$, $\\pi_{2cg} = 10^{-5}$,\n  - $\\pi_{3} = 10^{-7}$,\n  - $\\pi_{0} = 1 - (\\pi_{1e} + \\pi_{1c} + \\pi_{1g} + \\pi_{2ec} + \\pi_{2eg} + \\pi_{2cg} + \\pi_{3})$。\n\n要求的推导与计算：\n1. 根据贝叶斯定理和带有 $\\beta$ 的正态先验的正态似然，仅使用 $\\hat{\\beta}$ 和 $s$ 推导出比较零假设 $\\beta = 0$ 与备择假设 $\\beta \\sim \\mathcal{N}(0, W)$ 的贝叶斯因子。将此方法独立应用于三个摘要统计量：长非编码RNA表达、染色质可及性和性状，从而产生三个贝叶斯因子。\n2. 根据二项似然和 $p$ 上的 $\\mathrm{Beta}(\\alpha, \\alpha)$ 先验，仅使用 $k$ 和 $n$ 推导出用于等位基因不平衡的贝叶斯因子，该因子比较零假设 $p = 1/2$ 与带有对称Beta先验的备择假设。\n3. 按如下方式定义符号一致性似然比。令 $\\mathrm{sgn}(x)$ 在 $x > 0$ 时为 $+1$，在 $x < 0$ 时为 $-1$，在 $x = 0$ 时为 $0$。\n   - 对于长非编码RNA表达与等位基因特异性表达，令 $\\Delta_{ASE} = k - (n - k)$。若 $\\mathrm{sgn}(\\hat{\\beta}_{e}) = \\mathrm{sgn}(\\Delta_{ASE})$，则设 $L_{e,ASE} = \\exp(\\kappa_{e\\_ASE})$；若 $\\mathrm{sgn}(\\hat{\\beta}_{e}) = -\\mathrm{sgn}(\\Delta_{ASE})$，则设 $L_{e,ASE} = \\exp(-\\kappa_{e\\_ASE})$；若任一符号为零，则设 $L_{e,ASE} = 1$。\n   - 对于染色质可及性与性状，若 $\\mathrm{sgn}(\\hat{\\beta}_{c}) = \\mathrm{sgn}(\\hat{\\beta}_{g})$，则设 $L_{c,g} = \\exp(\\kappa_{c\\_g})$；若 $\\mathrm{sgn}(\\hat{\\beta}_{c}) = -\\mathrm{sgn}(\\hat{\\beta}_{g})$，则设 $L_{c,g} = \\exp(-\\kappa_{c\\_g})$；若任一符号为零，则设 $L_{c,g} = 1$。\n   - 对于 $M_3$，使用 $L_{\\mathrm{sign}} = L_{e,ASE} \\times L_{c,g}$；对于所有其他模型，不应用符号因子。\n4. 将每个模型 $M$ 的未归一化后验质量定义为 $\\mathrm{mass}(M) = \\pi_M \\times \\mathrm{BF}(M)$，其中 $\\pi_M$ 是先验概率，$\\mathrm{BF}(M)$ 是模型相关的贝叶斯因子的乘积：对于 $M_0$，$\\mathrm{BF}(M_0) = 1$；对于 $M_{1e}$，$\\mathrm{BF}(M_{1e}) = \\mathrm{BF}_e$；对于 $M_{1c}$，$\\mathrm{BF}_c$；对于 $M_{1g}$，$\\mathrm{BF}_g$；对于 $M_{2ec}$，$\\mathrm{BF}_e \\times \\mathrm{BF}_c$；对于 $M_{2eg}$，$\\mathrm{BF}_e \\times \\mathrm{BF}_g$；对于 $M_{2cg}$，$\\mathrm{BF}_c \\times \\mathrm{BF}_g$；对于 $M_3$，$\\mathrm{BF}_e \\times \\mathrm{BF}_c \\times \\mathrm{BF}_g \\times \\mathrm{BF}_{ASE} \\times L_{\\mathrm{sign}}$。归一化这些质量以获得模型的后验概率。目标量是后验概率 $\\mathbb{P}(M_3 \\mid \\text{data})$。\n5. 必须通过在对数空间中执行乘法并使用log-sum-exp变换进行归一化来确保数值稳定性。\n\n每个测试案例的输入格式：\n- 一个包含八个值的元组，对应于 $(\\hat{\\beta}_e, s_e, \\hat{\\beta}_c, s_c, \\hat{\\beta}_g, s_g, k, n-k)$，其中下标 $e$、$c$ 和 $g$ 分别表示长非编码RNA表达、染色质可及性和全基因组关联研究性状。计数满足 $k \\ge 0$，$n-k \\ge 0$，且 $n = k + (n-k)$。\n\n要实现的测试组：\n- 案例 1：$(0.20, 0.05, 0.15, 0.05, 0.10, 0.03, 70, 30)$。\n- 案例 2：$(0.22, 0.05, 0.16, 0.05, 0.11, 0.03, 50, 50)$。\n- 案例 3：$(0.18, 0.06, -0.12, 0.05, 0.08, 0.03, 60, 40)$。\n- 案例 4：$(0.05, 0.05, 0.03, 0.05, 0.02, 0.03, 52, 48)$。\n- 案例 5：$(-0.04, 0.05, 0.02, 0.05, 0.01, 0.03, 90, 10)$。\n\n输出规格：\n- 你的程序应使用指定的先验和超参数为每个测试案例计算 $\\mathbb{P}(M_3 \\mid \\text{data})$，并产生单行输出，其中包含以逗号分隔并用方括号括起来的结果列表。每个值必须是浮点数，四舍五入到六位小数，并按上述案例的顺序排列。例如，包含三个案例的输出看起来像 $[\\;0.123456,0.000321,0.987650\\;]$（不包括省略号）。\n\n不提供外部输入；所有常数和测试组都都必须在程序中定义。解决方案必须完全可重现且数值稳定。不涉及角度。不涉及物理单位。所有计算必须在维度上一致，并从所述的概率模型和先验中推导出来，除了从这些基础可以推导出的公式外，不得使用任何额外的捷径或预先指定的公式。", "solution": "该问题要求推导并实现一个贝叶斯框架，用于计算一个针对长非编码RNA（lncRNA）的特定机理模型 $M_3$ 的后验概率。该模型假定单一遗传变异会因果性地影响lncRNA表达、染色质可及性和一个复杂性状，并由lncRNA介导下游效应。该解决方案是根据所规定的概率论和统计学的第一性原理推导出来的。\n\n分析的核心是使用贝叶斯定理比较八个层级模型（$M_0, M_{1e}, M_{1c}, M_{1g}, M_{2ec}, M_{2eg}, M_{2cg}, M_3$）。给定数据 $D$，模型 $M_i$ 的后验概率与其先验概率 $\\pi_i$ 和其边缘似然 $P(D|M_i)$ 成正比。\n$$ \\mathbb{P}(M_i | D) = \\frac{P(D | M_i) \\pi_i}{\\sum_{j} P(D | M_j) \\pi_j} $$\n一个模型 $M_1$ 与一个更简单的嵌套模型 $M_0$ 之间的边缘似然比即为贝叶斯因子（BF）。将所有模型的似然表示为相对于零模型 $M_0$ 的值是很方便的，在 $M_0$ 模型下不存在遗传关联。数量 $\\pi_i \\times \\mathrm{BF}(M_i)$ 是模型 $M_i$ 的未归一化后验质量。我们为每个模型计算这个值，然后进行归一化以获得后验概率。为了数值稳定性，所有计算都在对数空间中进行。\n\n所需贝叶斯因子的推导如下。\n\n**1. 数量性状位点（QTL）摘要统计量的贝叶斯因子**\n\n对于三个数量性状（lncRNA表达 $e$、染色质可及性 $c$ 和性状 $g$）中的每一个，我们都得到了一个摘要统计量，包括一个估计的效应大小 $\\hat{\\beta}$ 及其标准误差 $s$。我们比较两个假设：\n- 零假设（$H_0$）：该变异没有效应，因此真实效应大小为 $\\beta = 0$。数据服从 $\\hat{\\beta} | H_0 \\sim \\mathcal{N}(0, s^2)$。\n- 备择假设（$H_1$）：该变异有效应，真实效应大小从先验分布 $\\beta \\sim \\mathcal{N}(0, W)$ 中抽样。\n\n在 $H_0$ 下数据的似然是正态分布的概率密度：\n$$ P(\\hat{\\beta}|H_0) = \\frac{1}{\\sqrt{2\\pi s^2}} \\exp\\left(-\\frac{\\hat{\\beta}^2}{2s^2}\\right) $$\n在 $H_1$ 下，边缘似然是通过对 $\\beta$ 的先验进行积分得到的：\n$$ P(\\hat{\\beta}|H_1) = \\int_{-\\infty}^{\\infty} P(\\hat{\\beta}|\\beta, s^2) P(\\beta|W) d\\beta $$\n这是两个正态分布的卷积：$\\mathcal{N}(\\beta; 0, W)$（先验）和 $\\mathcal{N}(\\hat{\\beta}; \\beta, s^2)$（似然）。结果是 $\\hat{\\beta}$ 的一个正态分布，其均值为 $0$，方差为各个方差之和：\n$$ P(\\hat{\\beta}|H_1) = \\mathcal{N}(\\hat{\\beta}; 0, s^2+W) = \\frac{1}{\\sqrt{2\\pi (s^2+W)}} \\exp\\left(-\\frac{\\hat{\\beta}^2}{2(s^2+W)}\\right) $$\n贝叶斯因子（BF）是这些边缘似然的比率：\n$$ \\mathrm{BF} = \\frac{P(\\hat{\\beta}|H_1)}{P(\\hat{\\beta}|H_0)} = \\frac{\\frac{1}{\\sqrt{2\\pi (s^2+W)}} \\exp\\left(-\\frac{\\hat{\\beta}^2}{2(s^2+W)}\\right)}{\\frac{1}{\\sqrt{2\\pi s^2}} \\exp\\left(-\\frac{\\hat{\\beta}^2}{2s^2}\\right)} = \\sqrt{\\frac{s^2}{s^2+W}} \\exp\\left(\\frac{\\hat{\\beta}^2}{2s^2} - \\frac{\\hat{\\beta}^2}{2(s^2+W)}\\right) $$\n简化指数项后得到最终表达式，称为Wakefield近似贝叶斯因子：\n$$ \\mathrm{BF} = \\sqrt{\\frac{s^2}{s^2+W}} \\exp\\left(\\frac{W \\hat{\\beta}^2}{2s^2(s^2+W)}\\right) $$\n为了计算，我们使用其对数形式：\n$$ \\log(\\mathrm{BF}) = \\frac{1}{2}\\log(s^2) - \\frac{1}{2}\\log(s^2+W) + \\frac{W \\hat{\\beta}^2}{2s^2(s^2+W)} $$\n该公式被独立应用于获得 $\\mathrm{BF}_e$、$\\mathrm{BF}_c$ 和 $\\mathrm{BF}_g$。\n\n**2. 等位基因特异性表达（ASE）的贝叶斯因子**\n\n对于ASE，我们给定总共 $n$ 个等位基因信息读数中来自备选等位基因的读数计数 $k$。数据使用二项分布建模。我们比较：\n- 零假设（$H_0$）：无等位基因不平衡，因此来自备选等位基因的读数概率为 $p = 1/2$。\n- 备择假设（$H_1$）：存在等位基因不平衡，其中 $p$ 从对称的Beta先验 $p \\sim \\mathrm{Beta}(\\alpha, \\alpha)$ 中抽取。\n\n在 $H_0$ 下的似然为：\n$$ P(k|n, H_0) = \\binom{n}{k} \\left(\\frac{1}{2}\\right)^n $$\n在 $H_1$ 下，边缘似然是通过对 $p$ 的先验进行积分得到的：\n$$ P(k|n, H_1) = \\int_0^1 P(k|n, p) P(p|\\alpha) dp = \\int_0^1 \\binom{n}{k}p^k(1-p)^{n-k} \\frac{p^{\\alpha-1}(1-p)^{\\alpha-1}}{B(\\alpha, \\alpha)} dp $$\n$$ P(k|n, H_1) = \\frac{\\binom{n}{k}}{B(\\alpha, \\alpha)} \\int_0^1 p^{k+\\alpha-1}(1-p)^{n-k+\\alpha-1} dp = \\frac{\\binom{n}{k} B(k+\\alpha, n-k+\\alpha)}{B(\\alpha, \\alpha)} $$\n其中 $B(x, y)$ 是Beta函数。贝叶斯因子 $\\mathrm{BF}_{ASE}$ 是其比率：\n$$ \\mathrm{BF}_{ASE} = \\frac{P(k|n, H_1)}{P(k|n, H_0)} = \\frac{\\frac{\\binom{n}{k} B(k+\\alpha, n-k+\\alpha)}{B(\\alpha, \\alpha)}}{\\binom{n}{k} (1/2)^n} = \\frac{B(k+\\alpha, n-k+\\alpha)}{B(\\alpha, \\alpha) \\cdot (1/2)^n} $$\n给定超参数 $\\alpha=1$，先验是均匀分布，$p \\sim \\mathrm{Beta}(1,1)$，且 $B(1,1)=1$。表达式简化为：\n$$ \\mathrm{BF}_{ASE} = \\frac{B(k+1, n-k+1)}{(1/2)^n} $$\n在对数空间中，使用恒等式 $B(x, y) = \\frac{\\Gamma(x)\\Gamma(y)}{\\Gamma(x+y)}$，我们得到：\n$$ \\log(\\mathrm{BF}_{ASE}) = \\log(\\Gamma(k+1)) + \\log(\\Gamma(n-k+1)) - \\log(\\Gamma(n+2)) + n\\log(2) $$\n\n**3. 符号一致性似然比**\n\n模型 $M_3$ 包含一个介导假设，该假设通过作为似然比的符号一致性因子来编码。这些是根据观测到的效应方向来定义的。\n- 对于lncRNA表达与ASE：$\\Delta_{ASE} = k - (n-k)$。如果 $\\mathrm{sgn}(\\hat{\\beta}_e) = \\mathrm{sgn}(\\Delta_{ASE})$，则对数似然项为 $\\kappa_{e\\_ASE}$；如果符号相反，则为 $-\\kappa_{e\\_ASE}$；否则为 $0$。令其为 $\\log(L_{e,ASE})$。\n- 对于染色质可及性与性状：如果 $\\mathrm{sgn}(\\hat{\\beta}_c) = \\mathrm{sgn}(\\hat{\\beta}_g)$，则对数似然项为 $\\kappa_{c\\_g}$；如果符号相反，则为 $-\\kappa_{c\\_g}$；否则为 $0$。令其为 $\\log(L_{c,g})$。\n模型 $M_3$ 的总对数符号一致性因子为 $\\log(L_{\\mathrm{sign}}) = \\log(L_{e,ASE}) + \\log(L_{c,g})$。对于所有其他模型，此因子为 $1$（在对数空间中为 $0$）。\n\n**4. 后验概率的计算**\n\n我们以对数形式计算每个模型 $M_i$ 的未归一化后验质量 $m_i = \\log(\\pi_i \\times \\mathrm{BF}(M_i))$：\n- $m_0 = \\log(\\pi_0)$\n- $m_{1e} = \\log(\\pi_{1e}) + \\log(\\mathrm{BF}_e)$\n- $m_{1c} = \\log(\\pi_{1c}) + \\log(\\mathrm{BF}_c)$\n- $m_{1g} = \\log(\\pi_{1g}) + \\log(\\mathrm{BF}_g)$\n- $m_{2ec} = \\log(\\pi_{2ec}) + \\log(\\mathrm{BF}_e) + \\log(\\mathrm{BF}_c)$\n- $m_{2eg} = \\log(\\pi_{2eg}) + \\log(\\mathrm{BF}_e) + \\log(\\mathrm{BF}_g)$\n- $m_{2cg} = \\log(\\pi_{2cg}) + \\log(\\mathrm{BF}_c) + \\log(\\mathrm{BF}_g)$\n- $m_3 = \\log(\\pi_3) + \\log(\\mathrm{BF}_e) + \\log(\\mathrm{BF}_c) + \\log(\\mathrm{BF}_g) + \\log(\\mathrm{BF}_{ASE}) + \\log(L_{\\mathrm{sign}})$\n\n后验概率是通过归一化这些质量得到的。为了稳定地进行计算，我们使用log-sum-exp变换。质量的总和的对数是 $S = \\mathrm{logsumexp}(m_0, m_{1e}, \\dots, m_3)$。\n那么模型 $M_3$ 的后验概率为：\n$$ \\mathbb{P}(M_3 | D) = \\frac{\\exp(m_3)}{\\sum_j \\exp(m_j)} = \\exp(m_3 - S) $$\n这为每个测试案例提供了最终的目标量。", "answer": "```python\nimport numpy as np\nfrom scipy.special import gammaln, logsumexp\n\ndef solve():\n    \"\"\"\n    Solves the problem of computing the posterior probability of lncRNA mediation model M3.\n    \"\"\"\n\n    # --- Priors and Hyperparameters ---\n    W = 0.04\n    alpha = 1.0\n    kappa_e_ase = 1.0\n    kappa_c_g = 0.5\n\n    # Prior probabilities over models\n    pi_dict = {\n        '1e': 1e-3,\n        '1c': 1e-3,\n        '1g': 1e-3,\n        '2ec': 1e-5,\n        '2eg': 1e-5,\n        '2cg': 1e-5,\n        '3': 1e-7,\n    }\n    pi_dict['0'] = 1.0 - sum(pi_dict.values())\n    \n    log_pi = {key: np.log(val) for key, val in pi_dict.items()}\n\n    # --- Test Cases ---\n    test_cases = [\n        (0.20, 0.05, 0.15, 0.05, 0.10, 0.03, 70, 30),\n        (0.22, 0.05, 0.16, 0.05, 0.11, 0.03, 50, 50),\n        (0.18, 0.06, -0.12, 0.05, 0.08, 0.03, 60, 40),\n        (0.05, 0.05, 0.03, 0.05, 0.02, 0.03, 52, 48),\n        (-0.04, 0.05, 0.02, 0.05, 0.01, 0.03, 90, 10),\n    ]\n\n    results = []\n    \n    # --- Helper Functions for Log Bayes Factors ---\n    \n    def log_bf_qtl(beta_hat, s):\n        \"\"\"Calculates the log Bayes Factor for a QTL summary statistic.\"\"\"\n        s2 = s**2\n        term1 = 0.5 * np.log(s2 / (s2 + W))\n        term2 = (W * beta_hat**2) / (2 * s2 * (s2 + W))\n        return term1 + term2\n\n    def log_bf_ase(k, n):\n        \"\"\"Calculates the log Bayes Factor for allele-specific expression.\"\"\"\n        if n == 0:\n            return 0.0\n        # Using lgamma for B(x,y) = exp(lgamma(x) + lgamma(y) - lgamma(x+y))\n        # and log B(alpha,alpha) = 2*lgamma(alpha) - lgamma(2*alpha)\n        # For alpha = 1, log(B(1,1)) is 0.\n        log_B_posterior = gammaln(k + alpha) + gammaln(n - k + alpha) - gammaln(n + 2 * alpha)\n        log_B_prior = 2 * gammaln(alpha) - gammaln(2*alpha)\n        \n        # log BF = log(P(D|H1)/P(D|H0))\n        # P(D|H1) = C(n,k) * B(k+a, n-k+a) / B(a,a)\n        # P(D|H0) = C(n,k) * (1/2)^n\n        # log BF = log(B(k+a, n-k+a)) - log(B(a,a)) - n*log(0.5)\n        return log_B_posterior - log_B_prior + n * np.log(2)\n\n    for case in test_cases:\n        beta_e, s_e, beta_c, s_c, beta_g, s_g, k_alt, k_ref = case\n        n_ase = k_alt + k_ref\n\n        # --- Step 1: Calculate individual log Bayes Factors ---\n        log_bf_e = log_bf_qtl(beta_e, s_e)\n        log_bf_c = log_bf_qtl(beta_c, s_c)\n        log_bf_g = log_bf_qtl(beta_g, s_g)\n        log_bf_ase_val = log_bf_ase(k_alt, n_ase)\n\n        # --- Step 2: Calculate sign-consistency likelihood ratio ---\n        log_L_sign = 0.0\n        \n        # lncRNA expression vs ASE\n        delta_ase = k_alt - k_ref\n        sign_be = np.sign(beta_e)\n        sign_ase = np.sign(delta_ase)\n        if sign_be * sign_ase > 0:\n            log_L_sign += kappa_e_ase\n        elif sign_be * sign_ase < 0:\n            log_L_sign -= kappa_e_ase\n\n        # Chromatin vs trait\n        sign_bc = np.sign(beta_c)\n        sign_bg = np.sign(beta_g)\n        if sign_bc * sign_bg > 0:\n            log_L_sign += kappa_c_g\n        elif sign_bc * sign_bg < 0:\n            log_L_sign -= kappa_c_g\n            \n        # --- Step 3: Compute log unnormalized posterior masses for each model ---\n        log_masses = {\n            '0': log_pi['0'],\n            '1e': log_pi['1e'] + log_bf_e,\n            '1c': log_pi['1c'] + log_bf_c,\n            '1g': log_pi['1g'] + log_bf_g,\n            '2ec': log_pi['2ec'] + log_bf_e + log_bf_c,\n            '2eg': log_pi['2eg'] + log_bf_e + log_bf_g,\n            '2cg': log_pi['2cg'] + log_bf_c + log_bf_g,\n            '3': log_pi['3'] + log_bf_e + log_bf_c + log_bf_g + log_bf_ase_val + log_L_sign\n        }\n\n        # --- Step 4: Normalize to get posterior probabilities ---\n        log_mass_array = np.array(list(log_masses.values()))\n        log_partition_func = logsumexp(log_mass_array)\n        \n        log_posterior_m3 = log_masses['3'] - log_partition_func\n        posterior_m3 = np.exp(log_posterior_m3)\n        \n        results.append(posterior_m3)\n\n    # --- Final Output Formatting ---\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2826218"}]}