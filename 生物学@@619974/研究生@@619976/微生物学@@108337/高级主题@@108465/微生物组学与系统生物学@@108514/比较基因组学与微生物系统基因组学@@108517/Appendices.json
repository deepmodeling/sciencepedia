{"hands_on_practices": [{"introduction": "现代比较基因组学依赖于高通量测序，但这些数据并非完美无瑕。Phred质量分（$Q$）是量化每个碱基检出（base call）不确定性的基本指标。本练习将引导您将这一分数转化为一个实际且有意义的结果：在基因组比较中预期的假阳性变异数量，从而巩固您对数据质量控制如何直接影响科学结论可靠性的理解。[@problem_id:2483725]", "problem": "一项比较微生物系统发育基因组学研究旨在使用新一代测序 (NGS) 读段，在 $N$ 个克隆细菌分离株中鉴定单核苷酸变异 (SNV)，这些分离株共享一个长度为 $L$ 个碱基对的核心基因组比对。每个分离株中的每个位点都由恰好 $D$ 条独立读段覆盖，这些读段的碱基判读结果通过一个最低 Phred 质量分阈值 $Q_{\\mathrm{th}}$ 进行过滤。假设映射完美，不存在真实的生物学变异（即分离株完全相同），并且在保留的碱基上，测序错误在不同读段和分离株之间是独立的，其每碱基错误概率 $p_{\\mathrm{err}}$ 由 Phred 变换 $Q=-10\\log_{10}(p_{\\mathrm{err}})$ 确定。一个朴素的位点级变异发现程序将一个位点标记为变异位点，条件是至少有一个分离株中的至少一条读段在该位点报告了与（真实的）参考碱基不同的碱基。\n\n从 Phred 质量分的定义和基本概率法则出发，推导假阳性变异位点的期望数 $E_{\\mathrm{FP}}(Q_{\\mathrm{th}})$ 作为 $L$、$N$、$D$ 和 $p_{\\mathrm{err}}(Q_{\\mathrm{th}})$ 的函数，然后在适用于严格过滤的小错误极限（其中 $N D\\,p_{\\mathrm{err}}(Q_{\\mathrm{th}})\\ll 1$）下简化该表达式。使用此结果，在相同的 $L$、$N$ 和 $D$ 条件下，计算比率\n$$\nR \\equiv \\frac{E_{\\mathrm{FP}}(Q_{\\mathrm{th}}=20)}{E_{\\mathrm{FP}}(Q_{\\mathrm{th}}=30)}\n$$\n将 $R$ 的最终答案以一个无量纲的单一数字形式给出。不要四舍五入。", "solution": "首先对问题陈述进行系统性验证。\n\n逐字提取已知条件：\n- $N$：克隆细菌分离株的数量。\n- $L$：核心基因组比对的长度（单位：碱基对）。\n- $D$：覆盖每个分离株中每个位点的独立读段数量。\n- $Q_{\\mathrm{th}}$：最低 Phred 质量分阈值。\n- 假设：映射完美。\n- 假设：无真实生物学变异（分离株完全相同）。\n- 假设：在保留的碱基上，测序错误在读段和分离株之间是独立的。\n- $p_{\\mathrm{err}}$：每碱基错误概率。\n- 定义：Phred 分数 $Q = -10\\log_{10}(p_{\\mathrm{err}})$。\n- 变异发现规则：如果至少有一条读段在至少一个分离株中报告了与真实参考碱基不同的碱基，则该位点被标记为变异位点。\n- 任务1：推导假阳性变异位点的期望数 $E_{\\mathrm{FP}}(Q_{\\mathrm{th}})$ 作为 $L$、$N$、$D$ 和 $p_{\\mathrm{err}}(Q_{\\mathrm{th}})$ 的函数。\n- 任务2：在小错误极限 $N D p_{\\mathrm{err}}(Q_{\\mathrm{th}}) \\ll 1$ 下简化此表达式。\n- 任务3：使用简化后的结果计算比率 $R \\equiv \\frac{E_{\\mathrm{FP}}(Q_{\\mathrm{th}}=20)}{E_{\\mathrm{FP}}(Q_{\\mathrm{th}}=30)}$。\n\n验证结论：\n问题有效。它在科学上基于基因组学和生物信息学的原理，特别是测序错误的统计建模。Phred 分数、单核苷酸变异和假阳性率等概念是该领域的标准概念。问题提法明确，构建概率模型所需的所有参数和假设都已清晰定义。语言客观而精确。诸如恒定读段深度和无真实变异等假设，是用于建立基线错误模型的常见理想化条件。该问题是概率论的一个非平凡应用，需要逻辑推导，而不仅仅是背诵事实。\n\n解题推导：\n我们首先将每碱基错误概率 $p_{\\mathrm{err}}$ 形式化为 Phred 质量分阈值 $Q_{\\mathrm{th}}$ 的函数。问题定义了 $Q = -10\\log_{10}(p_{\\mathrm{err}})$。求解 $p_{\\mathrm{err}}$ 可得：\n$$\n\\log_{10}(p_{\\mathrm{err}}) = -\\frac{Q}{10}\n$$\n$$\np_{\\mathrm{err}}(Q) = 10^{-Q/10}\n$$\n对于给定的阈值 $Q_{\\mathrm{th}}$，我们将错误概率表示为 $p_{\\mathrm{err}} \\equiv p_{\\mathrm{err}}(Q_{\\mathrm{th}})$。根据问题陈述，所有保留的碱基都假定具有此错误概率。\n\n单个碱基判读正确（即没有错误）的概率是 $1 - p_{\\mathrm{err}}$。\n考虑一个基因组位点。该位点在 $N$ 个分离株中各被 $D$ 条读段覆盖，总计 $N \\times D$ 条读段。问题陈述指出，测序错误在读段和分离株之间是独立的。\n\n如果覆盖某个位点的 $N \\times D$ 条读段中至少有一条报告了错误的碱基，则该位点被标记为假阳性变异。计算其互补事件的概率会更简单：即该位点*未*被标记为变异。这种情况发生当且仅当覆盖该位点的所有 $N \\times D$ 条读段都是正确的。\n\n由于独立性，所有 $N \\times D$ 条读段都正确的概率是它们各自正确概率的乘积：\n$$\nP(\\text{no error at site}) = (1 - p_{\\mathrm{err}})^{N D}\n$$\n因此，一个位点被标记为假阳性的概率 $P_{\\mathrm{FP}}$ 为：\n$$\nP_{\\mathrm{FP}} = 1 - P(\\text{no error at site}) = 1 - (1 - p_{\\mathrm{err}})^{N D}\n$$\n假阳性位点的总数是一个随机变量，是对比对中 $L$ 个位点进行伯努利试验的总和。假设错误在各位点之间是独立的，则假阳性位点的期望数 $E_{\\mathrm{FP}}$ 是位点总数 $L$ 乘以单个位点成为假阳性的概率：\n$$\nE_{\\mathrm{FP}}(Q_{\\mathrm{th}}) = L \\cdot P_{\\mathrm{FP}} = L \\left(1 - (1 - p_{\\mathrm{err}}(Q_{\\mathrm{th}}))^{N D}\\right)\n$$\n这就是假阳性期望数的完整表达式。\n\n接下来，我们在 $N D p_{\\mathrm{err}} \\ll 1$ 的小错误极限下简化此表达式。这一条件允许我们使用一阶二项式近似，即当 $|kx| \\ll 1$ 时，$(1-x)^k \\approx 1 - kx$。在这里，我们令 $x = p_{\\mathrm{err}}$ 且 $k = N D$。给定条件 $ND p_{\\mathrm{err}} \\ll 1$ 确保了此近似的有效性。\n将此应用于我们的 $P_{\\mathrm{FP}}$ 表达式：\n$$\n(1 - p_{\\mathrm{err}})^{N D} \\approx 1 - N D p_{\\mathrm{err}}\n$$\n将此代入 $E_{\\mathrm{FP}}$ 的公式：\n$$\nE_{\\mathrm{FP}}(Q_{\\mathrm{th}}) \\approx L (1 - (1 - N D p_{\\mathrm{err}}(Q_{\\mathrm{th}}))) = L (1 - 1 + N D p_{\\mathrm{err}}(Q_{\\mathrm{th}})) = L N D p_{\\mathrm{err}}(Q_{\\mathrm{th}})\n$$\n这个简化结果表明，假阳性的期望数约等于测序的总碱基数（$L \\times N \\times D$）乘以每碱基的错误率。\n\n问题要求我们使用这个简化结果来计算比率 $R \\equiv \\frac{E_{\\mathrm{FP}}(Q_{\\mathrm{th}}=20)}{E_{\\mathrm{FP}}(Q_{\\mathrm{th}}=30)}$。\n使用该近似，我们得到：\n$$\nR = \\frac{L N D p_{\\mathrm{err}}(Q_{\\mathrm{th}}=20)}{L N D p_{\\mathrm{err}}(Q_{\\mathrm{th}}=30)}\n$$\n$L$、$N$ 和 $D$ 项相消，剩下：\n$$\nR = \\frac{p_{\\mathrm{err}}(20)}{p_{\\mathrm{err}}(30)}\n$$\n现在我们计算 $Q=20$ 和 $Q=30$ 时的具体错误概率：\n对于 $Q_{\\mathrm{th}} = 20$：\n$$\np_{\\mathrm{err}}(20) = 10^{-20/10} = 10^{-2} = 0.01\n$$\n对于 $Q_{\\mathrm{th}} = 30$：\n$$\np_{\\mathrm{err}}(30) = 10^{-30/10} = 10^{-3} = 0.001\n$$\n将这些值代入 $R$ 的表达式：\n$$\nR = \\frac{10^{-2}}{10^{-3}} = 10^{-2 - (-3)} = 10^1 = 10\n$$\n使用简化模型的指令至关重要，因为它使得该比率与参数 $L$、$N$ 和 $D$ 无关，从而得出一个单一的数值答案。该比率表明，在该模型的假设下，使用 $Q=20$ 的质量阈值预计会比使用 $Q=30$ 的阈值产生多10倍的假阳性变异位点。", "answer": "$$\n\\boxed{10}\n$$", "id": "2483725"}, {"introduction": "除了原始读段的质量，组装基因组的完整性也是一个关键因素，尤其是在处理宏基因组组装基因组（MAGs）时。不完整性可能导致基因的人为丢失，从而对此后的分析（如泛基因组表征）产生偏见。本练习将向您展示如何建立一个简单的概率模型，来量化基因组完整性（$c$）如何直接影响核心基因组的估计，这对于准确解释宏基因组数据至关重要。[@problem_id:2483716]", "problem": "您正在对两个细菌宏基因组组装基因组 (MAGs) 进行泛基因组分析。每个 MAG 的估计完整度为 $0.90$，污染度为 $0.05$。假设存在以下基础模型，该模型反映了宏基因组分箱和基因存在-缺失分析中广泛使用的操作性定义：\n\n- MAG 的完整度 $c$ 近似地表示，对于该基因组中真实存在的任何一个单拷贝基因，该基因被恢复并正确分箱的概率。因此，每个基因的假阴性（丢失）概率为 $1-c$。\n- 污染由不属于真实目标基因组的基因组成；它可以产生假阳性的基因存在判断，但在严格的、识别直系同源的评分方法下，它不会“拯救”分箱中丢失的真实基因。因此，污染不会降低真实单拷贝基因的假缺失概率。\n- 在不同 MAG 之间，基因恢复事件是独立的，并且所有核心基因在每个基因组中都真实存在一次。\n- 在泛基因组中，严格核心集定义为在所有被考察的基因组中均被评分为存在的基因集合。\n\n在此模型下：\n\n1) 根据 $c$ 和基因组数量 $n$，推导由于不完全恢复而被错误地从严格核心中排除的真实单拷贝核心基因的预期比例。然后，使用 $n=2$ 和 $c=0.90$ 计算该表达式的值。\n\n2) 提出数学上明确的筛选标准来控制核心基因的错误排除，该标准用 $c$、$n$ 和用户指定的、对于在严格核心定义下丢失的真实核心基因的预期比例的容差 $\\epsilon$ 来表示。提供一个关于所需最小完整度 $c_{\\min}$ 的闭式条件，以确保预期的严格核心损失最多为 $\\epsilon$。同时，陈述一个互补的“软核心”放宽条件，该条件通过关于允许缺失的基因组数量 $m$ 的二项分布尾部概率来表示。\n\n最终答案只报告第 (1) 部分中预期错误排除率的数值，以小数形式表示，并四舍五入到三位有效数字。最终答案中不要包含任何单位或百分号。", "solution": "对问题陈述进行验证。\n\n**第 1 步：提取已知条件**\n- 宏基因组组装基因组 (MAGs) 的数量：$n$。对于第 (1) 部分，具体为 $n=2$。\n- 每个 MAG 的估计完整度：$c = 0.90$。\n- 每个 MAG 的估计污染度：$0.05$。\n- 完整度 $c$ 的模型定义：基因组中真实存在的单拷贝基因被恢复的概率。\n- 一个真实基因的假阴性（丢失）概率：$1-c$。\n- 污染不会降低一个真实基因的假缺失概率。\n- 不同 MAG 之间的基因恢复事件是独立的。\n- 所有核心基因在每个基因组中真实存在一次。\n- 严格核心集的定义：在所有 $n$ 个被考察的基因组中均被评分为存在的基因集合。\n- 任务 1：根据 $c$ 和 $n$ 推导被错误地从严格核心中排除的真实单拷贝核心基因的预期比例。使用 $n=2$ 和 $c=0.90$ 进行计算。\n- 任务 2：提出筛选标准以控制核心基因的错误排除。这涉及在给定容差 $\\epsilon$ 的情况下推导最小完整度 $c_{\\min}$，并提出一个基于二项分布尾部概率的“软核心”放宽条件。\n\n**第 2 步：使用提取的已知条件进行验证**\n这个问题有科学依据，提法明确，且客观。它将在计算生物学中的一个常见挑战——数据不完整性对核心基因组估计等比较基因组学推断的影响——形式化。该模型虽然是简化版，但基于宏基因组学中使用的标准操作性定义（例如 CheckM 的输出）。独立性假设和完整度的定义对于一阶近似是标准的。这些问题在数学上是精确的，可以使用概率论的基本原理来解决。问题不包含科学谬误、矛盾或歧义。污染度的值与所提出的关于真实核心基因的具体问题无关，但它的存在并不会使问题无效；它只要求解答者正确识别相关信息。\n\n**第 3 步：结论与行动**\n问题有效。将提供完整解答。\n\n**第 1 部分：错误排除率的推导与计算**\n\n让我们考虑一个单一的真实核心基因。根据问题陈述，根据定义，该基因存在于 $n$ 个 MAG 中每一个的真实基因组中。\n\n在单个 MAG 中成功恢复该基因的概率由完整度 $c$ 给出。\n在单个 MAG 中该基因*未被*恢复（假阴性）的概率是 $1-c$。\n\n一个基因只有在*所有* $n$ 个 MAG 中都成功恢复时，才被包含在“严格核心集”中。由于规定恢复事件在不同 MAG 之间是独立的，一个真实的核心基因被正确识别为严格核心一部分的概率 $P_{\\text{core}}$ 是各个恢复概率的乘积：\n$$P_{\\text{core}} = \\prod_{i=1}^{n} c_i$$\n假设（如问题所暗示）所有 MAG 的完整度 $c$ 均相同，则上式简化为：\n$$P_{\\text{core}} = c^n$$\n\n问题要求的是被错误排除的真实核心基因的预期比例。这等同于单个真实核心基因*未被*包含在观测到的严格核心集中的概率。如果该基因在至少一个 MAG 中丢失，该事件就会发生。此事件的概率 $P_{\\text{exclude}}$ 是被包含在核心集中的补集：\n$$P_{\\text{exclude}} = 1 - P_{\\text{core}}$$\n代入 $P_{\\text{core}}$ 的表达式，我们得到被错误排除的真实核心基因的预期比例的通用公式：\n$$P_{\\text{exclude}}(n, c) = 1 - c^n$$\n\n这是关于 $c$ 和 $n$ 的通用推导。\n现在，我们必须使用给定值计算此表达式：$n=2$ 和 $c=0.90$。\n$$P_{\\text{exclude}}(2, 0.90) = 1 - (0.90)^2$$\n$$P_{\\text{exclude}}(2, 0.90) = 1 - 0.81$$\n$$P_{\\text{exclude}}(2, 0.90) = 0.19$$\n因此，对于两个完整度为 $90\\%$ 的 MAG，我们预计仅由于随机的未恢复，就会错误地丢失 $19\\%$ 的真实核心基因组。四舍五入到三位有效数字得到 $0.190$。\n\n**第 2 部分：筛选标准**\n\n首先，我们解决关于最小完整度 $c_{\\min}$ 的条件。给定一个用户指定的容差 $\\epsilon$，表示可接受的真实核心基因丢失比例的最大值。条件是：\n$$P_{\\text{exclude}} \\le \\epsilon$$\n代入我们推导的表达式：\n$$1 - c^n \\le \\epsilon$$\n为了找到在给定 $n$ 和 $\\epsilon$ 下满足此条件的最小完整度 $c_{\\min}$，我们解关于 $c$ 的不等式：\n$$1 - \\epsilon \\le c^n$$\n$$c \\ge (1 - \\epsilon)^{1/n}$$\n因此，关于最小完整度的闭式条件是：\n$$c_{\\min} = (1 - \\epsilon)^{1/n}$$\n在严格核心定义下，任意 $n$ 个基因组的集合必须具有至少为此值的平均完整度，才能满足容差 $\\epsilon$。\n\n其次，我们提出了一个“软核心”放宽条件。我们可以定义软核心为存在于至少 $n-m$ 个 MAG 中的基因集合，而不是要求一个基因存在于所有 $n$ 个 MAG 中，其中 $m$ 是允许的最大丢失数量。\n\n设 $X$ 是一个随机变量，表示一个真实核心基因被成功恢复的 MAG 数量（总数为 $n$）。根据问题的假设（独立试验，成功概率恒定），$X$ 服从参数为 $n$（试验次数）和 $c$（成功概率）的二项分布：\n$$X \\sim B(n, c)$$\n其概率质量函数由 $P(X=k) = \\binom{n}{k} c^k (1-c)^{n-k}$ 给出。\n\n如果一个真实核心基因在少于 $n-m$ 个 MAG 中被恢复，它就会被错误地从这个“软核心”中排除。此事件的概率 $P_{\\text{soft\\_exclude}}$ 是在 $0, 1, \\dots, n-m-1$ 个 MAG 中被发现的概率之和。这是二项分布的左尾：\n$$P_{\\text{soft\\_exclude}} = P(X < n-m) = \\sum_{k=0}^{n-m-1} P(X=k)$$\n$$P_{\\text{soft\\_exclude}} = \\sum_{k=0}^{n-m-1} \\binom{n}{k} c^k (1-c)^{n-k}$$\n筛选标准是选择一个放宽参数 $m$，使得预期损失在容差 $\\epsilon$ 之内：\n$$\\sum_{k=0}^{n-m-1} \\binom{n}{k} c^k (1-c)^{n-k} \\le \\epsilon$$\n这提供了一种数学上明确的方法来放宽严格核心的定义，通过根据基因组数量 $n$、其完整度 $c$ 和期望的误差容差 $\\epsilon$ 允许特定数量的丢失 $m$，来控制错误排除率。", "answer": "$$\\boxed{0.190}$$", "id": "2483716"}, {"introduction": "系统发育基因组学分析常常涉及比较从不同类型数据（如核心基因组的单核苷酸多态性与附加基因含量）推断出的进化历史。这个综合性练习模拟了这样一个研究场景，引导您完成一个完整的工作流程。您将从基因存在/缺失数据入手，计算进化距离，使用经典的邻接（Neighbor-Joining）算法构建系统发育树，并最终使用Robinson-Foulds距离定量评估其与参考树的一致性。[@problem_id:2483707]", "problem": "一组四个细菌基因组 $S_{1}, S_{2}, S_{3}, S_{4}$ 已根据其在六个基因家族 $f_{1}, f_{2}, f_{3}, f_{4}, f_{5}, f_{6}$ 中的附加基因含量进行了分析。附加基因存在 ($1$) 或缺失 ($0$) 的向量如下：\n- $S_{1}: (1,1,0,0,1,0)$\n- $S_{2}: (1,1,0,0,1,1)$\n- $S_{3}: (0,0,1,1,0,1)$\n- $S_{4}: (0,0,1,1,1,1)$\n\n从比较基因组学和系统发育基因组学的基本原理出发，完成以下任务：\n1. 使用汉明距离的定义（即两个二进制向量在不同位置上的数量），计算所有无序对 $\\{i,j\\} \\subset \\{1,2,3,4\\}$ 的成对附加基因含量距离 $d(S_{i}, S_{j})$。\n2. 根据得到的距离矩阵，使用邻接（NJ）算法（邻接（NJ）算法应按照基于距离的系统发育学中的标准定义来理解）推断一个无根系统发育树。清晰地陈述在标记叶片 $S_{1}, S_{2}, S_{3}, S_{4}$ 上的无根拓扑结构。\n3. 一个基于相同分类单元的参考核心基因组单核苷酸多态性（SNP）最大似然（ML）树由以下无根Newick拓扑给出：$$((S_{1},S_{3}),(S_{2},S_{4}))$$。将这两棵树都视为在相同叶片集上的无根且完全解析的树，计算Robinson–Foulds（RF）距离（Robinson-Foulds（RF）距离是指存在于一棵树中但不存在于另一棵树中的非平凡二分划分的数量，对两棵树进行总和）。\n\n将RF距离报告为一个无单位的精确整数。无需四舍五入。", "solution": "该问题分为三个部分，必须按顺序解决。首先，我们根据附加基因含量计算一个距离矩阵。其次，我们使用邻接算法从该矩阵推断一个系统发育树。第三，我们使用Robinson-Foulds距离将推断出的系统发育树与参考系统发育树进行比较。该问题设定良好，并在比较基因组学和系统发育基因组学的原理上有坚实的科学基础。\n\n这四个细菌基因组的集合是 $S = \\{S_{1}, S_{2}, S_{3}, S_{4}\\}$。附加基因含量由长度为 $6$ 的二进制向量表示，其中 $1$ 表示存在，$0$ 表示缺失。这些向量是：\n$v_{1} = (1,1,0,0,1,0)$ 对应基因组 $S_{1}$\n$v_{2} = (1,1,0,0,1,1)$ 对应基因组 $S_{2}$\n$v_{3} = (0,0,1,1,0,1)$ 对应基因组 $S_{3}$\n$v_{4} = (0,0,1,1,1,1)$ 对应基因组 $S_{4}$\n\n第 1 部分：成对距离计算\n问题指定使用汉明距离 $d(S_{i}, S_{j})$，即相应向量 $v_{i}$ 和 $v_{j}$ 在不同位置上的数量。我们为所有 $\\binom{4}{2} = 6$ 个无序基因组对计算此值。\n\n$d(S_{1}, S_{2})$：比较 $v_1=(1,1,0,0,1,0)$ 和 $v_2=(1,1,0,0,1,1)$。它们仅在第 $6$ 个位置上不同。因此，$d(S_{1}, S_{2}) = 1$。\n\n$d(S_{1}, S_{3})$：比较 $v_1=(1,1,0,0,1,0)$ 和 $v_3=(0,0,1,1,0,1)$。它们在第 $1, 2, 3, 4, 5, 6$ 个位置上不同。因此，$d(S_{1}, S_{3}) = 6$。\n\n$d(S_{1}, S_{4})$：比较 $v_1=(1,1,0,0,1,0)$ 和 $v_4=(0,0,1,1,1,1)$。它们在第 $1, 2, 3, 4, 6$ 个位置上不同。因此，$d(S_{1}, S_{4}) = 5$。\n\n$d(S_{2}, S_{3})$：比较 $v_2=(1,1,0,0,1,1)$ 和 $v_3=(0,0,1,1,0,1)$。它们在第 $1, 2, 3, 4, 5$ 个位置上不同。因此，$d(S_{2}, S_{3}) = 5$。\n\n$d(S_{2}, S_{4})$：比较 $v_2=(1,1,0,0,1,1)$ 和 $v_4=(0,0,1,1,1,1)$。它们在第 $1, 2, 3, 4$ 个位置上不同。因此，$d(S_{2}, S_{4}) = 4$。\n\n$d(S_{3}, S_{4})$：比较 $v_3=(0,0,1,1,0,1)$ 和 $v_4=(0,0,1,1,1,1)$。它们仅在第 $5$ 个位置上不同。因此，$d(S_{3}, S_{4}) = 1$。\n\n这得到了对称距离矩阵 $D$：\n$$\nD = \\begin{pmatrix}\n0 & 1 & 6 & 5 \\\\\n1 & 0 & 5 & 4 \\\\\n6 & 5 & 0 & 1 \\\\\n5 & 4 & 1 & 0\n\\end{pmatrix}\n$$\n其中行和列由 $S_1, S_2, S_3, S_4$ 索引。\n\n第 2 部分：邻接（NJ）树推断\nNJ 算法旨在找到树中的相邻分类单元对。它基于速率校正的距离准则，迭代地连接最近的邻居。对于一个包含 $n$ 个分类单元的集合，该算法按以下步骤进行。\n首先，对于每个分类单元 $i$，我们计算其与所有其他分类单元的总差异度 $r_i$：$r_i = \\sum_{k=1}^{n} d(S_i, S_k)$。\n在我们的情况中，$n=4$：\n$r_{1} = d(S_{1}, S_{2}) + d(S_{1}, S_{3}) + d(S_{1}, S_{4}) = 1 + 6 + 5 = 12$\n$r_{2} = d(S_{2}, S_{1}) + d(S_{2}, S_{3}) + d(S_{2}, S_{4}) = 1 + 5 + 4 = 10$\n$r_{3} = d(S_{3}, S_{1}) + d(S_{3}, S_{2}) + d(S_{3}, S_{4}) = 6 + 5 + 1 = 12$\n$r_{4} = d(S_{4}, S_{1}) + d(S_{4}, S_{2}) + d(S_{4}, S_{3}) = 5 + 4 + 1 = 10$\n\n接下来，我们计算 NJ 矩阵 $Q$，其中 $Q_{ij} = (n-2)d(S_i, S_j) - r_i - r_j$。当 $n=4$ 时，这变成 $Q_{ij} = 2d(S_i, S_j) - r_i - r_j$。该算法识别使 $Q_{ij}$ 最小化的对 $(i, j)$。\n$Q_{12} = 2d(S_{1}, S_{2}) - r_{1} - r_{2} = 2(1) - 12 - 10 = -20$\n$Q_{13} = 2d(S_{1}, S_{3}) - r_{1} - r_{3} = 2(6) - 12 - 12 = -12$\n$Q_{14} = 2d(S_{1}, S_{4}) - r_{1} - r_{4} = 2(5) - 12 - 10 = -12$\n$Q_{23} = 2d(S_{2}, S_{3}) - r_{2} - r_{3} = 2(5) - 10 - 12 = -12$\n$Q_{24} = 2d(S_{2}, S_{4}) - r_{2} - r_{4} = 2(4) - 10 - 10 = -12$\n$Q_{34} = 2d(S_{3}, S_{4}) - r_{3} - r_{4} = 2(1) - 12 - 10 = -20$\n\n$Q$ 矩阵中的最小值是 $-20$，对应于对 $(S_1, S_2)$ 和 $(S_3, S_4)$。在标准的 NJ 算法中，任何产生最小 $Q$ 值的对都可以被选择连接。该算法选择这样一对，比如 $(S_1, S_2)$，作为第一组邻居。对于一个有 $4$ 个分类单元的无根树，一旦确定了一对邻居，其拓扑结构就完全确定了。如果 $S_1$ 和 $S_2$ 是邻居，那么 $S_3$ 和 $S_4$ 也必须是邻居，形成无根树的另一个分支。如果我们首先选择对 $(S_3, S_4)$，也会得到相同的结论。因此，邻接算法推断出一个拓扑结构，其中 $S_1$ 与 $S_2$ 聚类，而 $S_3$ 与 $S_4$ 聚类。\n得到的无根拓扑结构，我们称之为 $T_{NJ}$，可以用 Newick 格式写为 $((S_1,S_2),(S_3,S_4))$。\n\n第 3 部分：Robinson–Foulds (RF) 距离计算\n我们需要计算推断出的树 $T_{NJ}$ 和给定的参考树 $T_{Ref}$ 之间的 RF 距离。\n$T_{NJ}$ 拓扑结构：$((S_1,S_2),(S_3,S_4))$\n$T_{Ref}$ 拓扑结构：$((S_1,S_3),(S_2,S_4))$\n\nRF 距离衡量了在同一组叶片上的两个系统发育树之间的不相似性。它被定义为存在于一棵树中但不存在于另一棵树中的叶片的非平凡二分划分（或分裂）的数量。对于一个有 $n$ 个叶片的完全解析（二分）的无根树，有 $n-3$ 个内部边，每个内部边对应于叶片的一个非平凡二分划分。\n\n在我们的情况中，$n=4$，所以每棵树有 $n-3 = 4-3 = 1$ 个内部边，因此恰好定义了一个非平凡二分划分。\n让我们为每棵树确定其二分划分。\n对于 $T_{NJ} = ((S_1,S_2),(S_3,S_4))$，移除唯一的内部边会将叶片分成两个集合：$\\{S_1, S_2\\}$ 和 $\\{S_3, S_4\\}$。这个二分划分是 $\\{\\{S_1, S_2\\}, \\{S_3, S_4\\}\\}$。让我们将 $T_{NJ}$ 的二分划分集合表示为 $B(T_{NJ})$。所以，$B(T_{NJ}) = \\{\\{\\{S_1, S_2\\}, \\{S_3, S_4\\}\\}\\}$。\n\n对于 $T_{Ref} = ((S_1,S_3),(S_2,S_4))$，移除唯一的内部边会将叶片分成两个集合：$\\{S_1, S_3\\}$ 和 $\\{S_2, S_4\\}$。这个二分划分是 $\\{\\{S_1, S_3\\}, \\{S_2, S_4\\}\\}$。让我们将 $T_{Ref}$ 的二分划分集合表示为 $B(T_{Ref})$。所以，$B(T_{Ref}) = \\{\\{\\{S_1, S_3\\}, \\{S_2, S_4\\}\\}\\}$。\n\nRF 距离是这两个二分划分集合的对称差的大小：\n$d_{RF}(T_{NJ}, T_{Ref}) = |B(T_{NJ}) \\setminus B(T_{Ref})| + |B(T_{Ref}) \\setminus B(T_{NJ})|$。\n\n来自 $T_{NJ}$ 的二分划分 $\\{\\{S_1, S_2\\}, \\{S_3, S_4\\}\\}$ 不存在于 $T_{Ref}$ 中。所以，$|B(T_{NJ}) \\setminus B(T_{Ref})| = 1$。\n来自 $T_{Ref}$ 的二分划分 $\\{\\{S_1, S_3\\}, \\{S_2, S_4\\}\\}$ 不存在于 $T_{NJ}$ 中。所以，$|B(T_{Ref}) \\setminus B(T_{NJ})| = 1$。\n\nRF 距离是这些计数的总和：$d_{RF} = 1 + 1 = 2$。", "answer": "$$\\boxed{2}$$", "id": "2483707"}]}