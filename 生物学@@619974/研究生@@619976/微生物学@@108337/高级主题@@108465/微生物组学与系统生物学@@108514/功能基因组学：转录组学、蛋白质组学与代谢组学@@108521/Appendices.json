{"hands_on_practices": [{"introduction": "可靠的定量数据是功能基因组学的基石。本实践将带你掌握质谱法测量的基本校准技能，这是现代代谢组学和蛋白质组学的核心技术。你将亲手构建一条校准曲线，确定其可靠的线性动态范围，并为测量误差（即异方差性）建模——这些都是将原始仪器信号转化为精确生物学定量的关键步骤。[@problem_id:2494820]", "problem": "一个微生物学实验室正在开发一种绝对定量分析方法，用于测定厌氧培养上清液中的短链脂肪酸丁酸盐。该方法采用液相色谱-串联质谱（LC-MS/MS）和稳定同位素标记内标（SIL-IS）。仪器响应记录为分析物与内标的峰面积比（无量纲）。在合成基质中制备了覆盖从低到高微摩尔浓度的外部校准标准品。对于每种标准品，在恒定离子源条件下进行三次重复进样，以评估校准的线性以及响应的均值-方差关系。\n\n给定以下校准水平（丁酸盐浓度，单位为 $\\mu\\text{M}$）和三次重复响应（面积比，无量纲）。每行列出浓度 $c$ 以及其后的三个重复响应 $y_{1},y_{2},y_{3}$：\n\n- $c = 1$：$0.0147$，$0.0150$，$0.0153$\n- $c = 2$：$0.0294$，$0.0300$，$0.0306$\n- $c = 4$：$0.0588$，$0.0600$，$0.0612$\n- $c = 8$：$0.1176$，$0.1200$，$0.1224$\n- $c = 16$：$0.2352$，$0.2400$，$0.2448$\n- $c = 32$：$0.4704$，$0.4800$，$0.4896$\n- $c = 64$：$0.9408$，$0.9600$，$0.9792$\n- $c = 128$：$1.666$，$1.700$，$1.734$\n\n假设以下在功能性代谢组学定量中为标准的基础：\n- 在线性动态范围内，平均仪器响应与分析物浓度成正比：$y = \\beta c + \\varepsilon$，且 $E[\\varepsilon \\mid c] = 0$。\n- 当权重与条件方差的倒数成正比时，加权最小二乘法适用于异方差性情况：$w(\\mu) \\propto 1/\\operatorname{Var}(Y \\mid \\mu)$，其中 $\\mu = E[Y \\mid c]$。\n- 每个水平上的无偏样本方差为 $s^{2} = \\frac{1}{n-1}\\sum_{j=1}^{n}(y_{j}-\\bar{y})^{2}$，其中 $n = 3$。\n- 对于使用内标且基于离子流的检测器，方差-均值幂模型是合理的：$\\operatorname{Var}(Y \\mid \\mu) = a \\mu^{p}$，其中 $a > 0$，$p > 0$。\n\n您必须执行的任务：\n1) 通过对前七个标准品（$c \\leq 64\\ \\mu\\text{M}$）的各水平平均值 $\\bar{y}$ 使用普通最小二乘法 (OLS) 拟合通过原点的比例模型 $y = \\beta c$ 来构建校准曲线。使用此模型定义预测响应 $\\hat{y} = \\hat{\\beta} c$。\n2) 将线性动态范围定义为所提供校准品中的最大区间 $\\left[c_{\\min}, c_{\\max}\\right]$，使得该区间内的每个校准品，其绝对相对残差满足 $\\left|\\bar{y} - \\hat{y}\\right|/\\hat{y} < \\delta$，其中 $\\delta = 0.05$。根据此标准确定 $c_{\\max}$。\n3) 使用所有水平，通过对各水平的 $\\ln(s^{2})$ 关于 $\\ln(\\bar{y})$ 进行普通最小二乘回归，来估计方差-均值幂模型中的指数 $p$。使用自然对数以及根据每个水平的三次重复计算出的无偏样本方差。\n4) 根据拟合的方差模型，指定用于加权最小二乘法的权重函数 $w(\\bar{y}) \\propto 1/\\widehat{\\operatorname{Var}}(Y \\mid \\bar{y})$。\n\n答案规格：\n- 仅报告任务3中估计的指数 $p$。\n- 将 $p$ 表示为一个无量纲实数。\n- 将您的答案四舍五入至四位有效数字。", "solution": "问题已经过验证。\n\n**步骤1：提取给定信息**\n- **数据**：八个校准水平，包括浓度 $c$ （单位为 $\\mu\\text{M}$）和三次重复响应 $(y_1, y_2, y_3)$（无量纲的面积比）：\n    - $c = 1$: $\\{0.0147, 0.0150, 0.0153\\}$\n    - $c = 2$: $\\{0.0294, 0.0300, 0.0306\\}$\n    - $c = 4$: $\\{0.0588, 0.0600, 0.0612\\}$\n    - $c = 8$: $\\{0.1176, 0.1200, 0.1224\\}$\n    - $c = 16$: $\\{0.2352, 0.2400, 0.2448\\}$\n    - $c = 32$: $\\{0.4704, 0.4800, 0.4896\\}$\n    - $c = 64$: $\\{0.9408, 0.9600, 0.9792\\}$\n    - $c = 128$: $\\{1.666, 1.700, 1.734\\}$\n- **模型与定义**：\n    - 平均响应模型：$y = \\beta c + \\varepsilon$，且 $E[\\varepsilon \\mid c] = 0$。\n    - 用于加权最小二乘法的权重：$w(\\mu) \\propto 1/\\operatorname{Var}(Y \\mid \\mu)$，其中 $\\mu = E[Y \\mid c]$。\n    - 无偏样本方差公式：$s^{2} = \\frac{1}{n-1}\\sum_{j=1}^{n}(y_{j}-\\bar{y})^{2}$，其中 $n=3$。\n    - 方差-均值幂模型：$\\operatorname{Var}(Y \\mid \\mu) = a \\mu^{p}$，其中 $a > 0$，$p > 0$。\n- **任务**：\n    1. 对 $c \\leq 64\\ \\mu\\text{M}$ 的均值进行 $y = \\beta c$ 的普通最小二乘法拟合。\n    2. 使用绝对相对残差标准 $|\\bar{y} - \\hat{y}|/\\hat{y} < 0.05$ 确定线性动态范围 $c_{\\max}$。\n    3. 使用所有数据，通过对 $\\ln(s^{2})$ 关于 $\\ln(\\bar{y})$ 进行普通最小二乘回归来估计指数 $p$。\n    4. 指明权重函数 $w(\\bar{y})$。\n- **要求输出**：报告任务3中得到的 $p$ 值，四舍五入至四位有效数字。\n\n**步骤2：使用提取的信息进行验证**\n该问题具有科学依据，描述了定量质谱分析中标准的校准和方差建模流程。问题提法明确，提供了所有必要数据，并指定了执行任务所需的分析方法。语言客观，无歧义。问题是自洽的、一致的，并且可以通过计算进行验证。不存在违反科学原理、逻辑不一致或事实错误的情况。数据虽然经过理想化处理，但在物理上是合理的。\n\n**步骤3：结论与行动**\n问题有效。将提供解答。\n\n目标是确定方差-均值幂模型 $\\operatorname{Var}(Y \\mid \\mu) = a \\mu^{p}$ 的指数 $p$。该模型描述了仪器响应的异方差性。我们将使用样本统计量，即平均响应 $\\bar{y}$ 和样本方差 $s^2$，分别作为总体参数 $\\mu$ 和 $\\operatorname{Var}(Y \\mid \\mu)$ 的估计值。因此，该模型可近似为 $s^2 \\approx a \\bar{y}^p$。\n\n为了估计 $p$，我们通过对等式两边取自然对数来线性化这个幂律关系：\n$$ \\ln(s^2) = \\ln(a) + p \\ln(\\bar{y}) $$\n该方程的形式为 $Y' = \\beta_0 + \\beta_1 X'$，其中 $Y' = \\ln(s^2)$，$X' = \\ln(\\bar{y})$，截距为 $\\beta_0 = \\ln(a)$，斜率为 $\\beta_1 = p$。因此，可以通过对所有八个浓度水平的 $\\ln(s^2)$ 关于 $\\ln(\\bar{y})$ 进行普通最小二乘法 (OLS) 回归来估计参数 $p$。\n\n首先，我们为每个浓度水平 $c_i$ 计算样本均值 $\\bar{y}_i$ 和无偏样本方差 $s_i^2$，其中 $i = 1, \\dots, 8$。重复次数为 $n=3$。\n\n计算出的值为：\n- 对于 $c_1=1$：$\\bar{y}_1 = (0.0147+0.0150+0.0153)/3 = 0.0150$。\n$s_1^2 = \\frac{1}{2}\\left((0.0147-0.0150)^2 + (0.0150-0.0150)^2 + (0.0153-0.0150)^2\\right) = 9 \\times 10^{-8}$。\n\n- 对于 $c_2=2$：$\\bar{y}_2 = (0.0294+0.0300+0.0306)/3 = 0.0300$。\n$s_2^2 = \\frac{1}{2}\\left((0.0294-0.0300)^2 + (0.0300-0.0300)^2 + (0.0306-0.0300)^2\\right) = 3.6 \\times 10^{-7}$。\n\n- 对于 $c_3=4$：$\\bar{y}_3 = (0.0588+0.0600+0.0612)/3 = 0.0600$。\n$s_3^2 = 1.44 \\times 10^{-6}$。\n\n- 对于 $c_4=8$：$\\bar{y}_4 = (0.1176+0.1200+0.1224)/3 = 0.1200$。\n$s_4^2 = 5.76 \\times 10^{-6}$。\n\n- 对于 $c_5=16$：$\\bar{y}_5 = (0.2352+0.2400+0.2448)/3 = 0.2400$。\n$s_5^2 = 2.304 \\times 10^{-5}$。\n\n- 对于 $c_6=32$：$\\bar{y}_6 = (0.4704+0.4800+0.4896)/3 = 0.4800$。\n$s_6^2 = 9.216 \\times 10^{-5}$。\n\n- 对于 $c_7=64$：$\\bar{y}_7 = (0.9408+0.9600+0.9792)/3 = 0.9600$。\n$s_7^2 = 3.6864 \\times 10^{-4}$。\n\n- 对于 $c_8=128$：$\\bar{y}_8 = (1.666+1.700+1.734)/3 = 1.700$。\n$s_8^2 = \\frac{1}{2}\\left((1.666-1.700)^2 + (1.700-1.700)^2 + (1.734-1.700)^2\\right) = 1.156 \\times 10^{-3}$。\n\n所提供的数据是人为构造的完美数据。我们可以证明关系式 $s_i^2 = k \\cdot \\bar{y}_i^2$ 对所有数据点都成立，其中 $k$ 是一个常数，这意味着 $p=2$。让我们通过计算所有数据点的比率 $k = s_i^2 / \\bar{y}_i^2$ 来检验这个假设。\n\n对于第一个点 ($i=1$):\n$$ k = \\frac{s_1^2}{\\bar{y}_1^2} = \\frac{9 \\times 10^{-8}}{(0.0150)^2} = \\frac{9 \\times 10^{-8}}{2.25 \\times 10^{-4}} = 4 \\times 10^{-4} $$\n对于第二个点 ($i=2$):\n$$ k = \\frac{s_2^2}{\\bar{y}_2^2} = \\frac{3.6 \\times 10^{-7}}{(0.0300)^2} = \\frac{3.6 \\times 10^{-7}}{9 \\times 10^{-4}} = 4 \\times 10^{-4} $$\n这个模式对所有数据点都完美适用。让我们验证最后一个点 ($i=8$)，该点似乎偏离了其他校准品的简单倍增序列：\n$$ k = \\frac{s_8^2}{\\bar{y}_8^2} = \\frac{1.156 \\times 10^{-3}}{(1.700)^2} = \\frac{1.156 \\times 10^{-3}}{2.89} = 4 \\times 10^{-4} $$\n由于对于所有的 $i=1, \\dots, 8$，比率 $s_i^2 / \\bar{y}_i^2$ 都是常数且等于 $4 \\times 10^{-4}$，我们可以断定样本数据完美地拟合了该模型：\n$$ s^2 = (4 \\times 10^{-4}) \\bar{y}^2 $$\n将此与通用模型 $s^2 = a \\bar{y}^p$ 进行比较，我们可以通过观察直接确定参数：$a = 4 \\times 10^{-4}$ 和 $p=2$。\n\n如果继续进行 $\\ln(s^2)$ 关于 $\\ln(\\bar{y})$ 的正式 OLS 回归，数据点将位于一条由 $\\ln(s^2) = \\ln(4 \\times 10^{-4}) + 2 \\ln(\\bar{y})$ 描述的完美直线上。对此类数据进行线性回归将得到斜率恰好为 $2$，决定系数 $R^2=1$。\n\n因此, 估计的指数为 $p=2$。问题要求将此结果报告为四位有效数字。", "answer": "$$\\boxed{2.000}$$", "id": "2494820"}, {"introduction": "从仪器校准转向数据分析，我们现在来解决一个转录组学中的基本挑战。RNA测序通过对转录本片段进行抽样来量化表达，这个过程可能引入系统性误差或偏差。本模拟练习将阐明“长度偏差”这一概念，展示当同一基因的不同长度异构体表达发生变化时，如果处理不当，会如何扭曲基因的表达量估算，从而让你体会到异构体感知型（isoform-aware）定量方法的必要性。[@problem_id:2494870]", "problem": "您的任务是使用一个基于原则的抽样模型，实现RNA测序（RNA-seq）中基因水平表达量化的确定性模拟，并比较两种估计量：一种是异构体感知估计量，另一种是朴素的基因水平长度校正估计量。目标是形式化并量化异构体比例的变化如何在聚合到基因水平时引入长度偏倚，并计算朴素方法所引入的乘性偏倚和相对误差。\n\n基本原理和假设：\n- 中心法则和表达测量：RNA测序（RNA-seq）测量源自转录本的片段；在均一化片段化和无偏抽样的情况下，映射到某个异构体的片段的期望数量与其摩尔浓度和有效长度成正比。\n- 确定性期望模型：对于一个基因，其异构体索引为 $j \\in \\{1,\\dots,I\\}$，在样本 $s$ 中，设 $\\theta_{j,s}$ 表示异构体的摩尔浓度，$L_j$ 表示其有效长度（单位：核苷酸，nt），$k_s$ 为一个测序深度缩放常数。异构体 $j$ 的片段计数期望值为\n$$\\mathbb{E}[C_{j,s}] = k_s \\, \\theta_{j,s} \\, L_j.$$\n- 设基因水平的摩尔丰度为 $G_s = \\sum_{j=1}^{I} \\theta_{j,s}$。定义异构体分数 $p_{j,s} = \\theta_{j,s}/G_s$，因此 $\\sum_{j} p_{j,s} = 1$ 且 $p_{j,s} \\ge 0$，由此可得 $\\theta_{j,s} = G_s \\, p_{j,s}$。\n\n待比较的估计量：\n- 异构体感知估计量（理想化）：给定期望计数和有效长度，定义\n$$\\widehat{G}_{\\mathrm{aware},s} = \\sum_{j=1}^{I} \\frac{\\mathbb{E}[C_{j,s}]}{k_s \\, L_j}.$$\n- 朴素的基因水平长度校正：首先将期望计数聚合到基因水平 $\\mathbb{E}[C_{\\mathrm{gene},s}] = \\sum_{j=1}^{I} \\mathbb{E}[C_{j,s}]$。然后除以一个根据参考样本 $r$ 计算出的固定的基因水平长度，\n$$L_{\\mathrm{ref}} = \\sum_{j=1}^{I} p_{j,r} \\, L_j,$$\n以得到\n$$\\widehat{G}_{\\mathrm{naive},s} = \\frac{\\mathbb{E}[C_{\\mathrm{gene},s}]}{k_s \\, L_{\\mathrm{ref}}}.$$\n\n每个测试用例需要计算的输出量：\n- 乘性偏倚因子\n$$B_s = \\frac{\\widehat{G}_{\\mathrm{naive},s}}{\\widehat{G}_{\\mathrm{aware},s}}.$$\n- 相对误差（以小数表示，而非百分比）\n$$\\delta_s = B_s - 1.$$\n\n实现说明：\n- 将上述过程视为使用期望计数的确定性模拟；不要引入随机性。\n- 使用提供的参数集测试套组。对于每个测试用例，您将获得：\n  - 异构体有效长度（单位：核苷酸）：一个列表 $[L_1,\\dots,L_I]$ （单位：nt）。\n  - 参考异构体分数 $[p_{1,r},\\dots,p_{I,r}]$，满足 $\\sum_j p_{j,r} = 1$。\n  - 样本异构体分数 $[p_{1,s},\\dots,p_{I,s}]$，满足 $\\sum_j p_{j,s} = 1$。\n  - 一个测序深度缩放常数 $k_s$ 和一个基因水平摩尔丰度 $G_s$ 用于构建期望计数。为进行此模拟，在每个测试用例中设置 $k_s = 1$ 和 $G_s = 1$，以使单位保持隐式，并隔离长度混合效应。\n- 对每个异构体 $j$ 计算 $\\mathbb{E}[C_{j,s}] = k_s \\, G_s \\, p_{j,s} \\, L_j$，然后如上所述计算 $\\widehat{G}_{\\mathrm{aware},s}$ 和 $\\widehat{G}_{\\mathrm{naive},s}$，随后计算 $B_s$ 和 $\\delta_s$。\n\n测试套组：\n- 案例 1（两种异构体，样本中向更短的异构体偏移）：\n  - $[L_1,L_2] = [1000,2000]$ nt\n  - $[p_{1,r},p_{2,r}] = [0.5,0.5]$\n  - $[p_{1,s},p_{2,s}] = [0.8,0.2]$\n  - $k_s = 1$, $G_s = 1$\n- 案例 2（两种异构体，样本中向更长的异构体偏移）：\n  - $[L_1,L_2] = [1000,2000]$ nt\n  - $[p_{1,r},p_{2,r}] = [0.5,0.5]$\n  - $[p_{1,s},p_{2,s}] = [0.2,0.8]$\n  - $k_s = 1$, $G_s = 1$\n- 案例 3（三种异构体，从中等长度到短异构体的显著转换）：\n  - $[L_1,L_2,L_3] = [500,1500,3000]$ nt\n  - $[p_{1,r},p_{2,r},p_{3,r}] = [0.2,0.7,0.1]$\n  - $[p_{1,s},p_{2,s},p_{3,s}] = [0.7,0.2,0.1]$\n  - $k_s = 1$, $G_s = 1$\n- 案例 4（三种异构体，长度相等，任何比例变化都不应产生偏倚）：\n  - $[L_1,L_2,L_3] = [1000,1000,1000]$ nt\n  - $[p_{1,r},p_{2,r},p_{3,r}] = [0.1,0.8,0.1]$\n  - $[p_{1,s},p_{2,s},p_{3,s}] = [0.7,0.2,0.1]$\n  - $k_s = 1$, $G_s = 1$\n- 案例 5（三种异构体，参考样本和测试样本中比例相同，预期无偏倚）：\n  - $[L_1,L_2,L_3] = [750,1800,2400]$ nt\n  - $[p_{1,r},p_{2,r},p_{3,r}] = [0.3,0.4,0.3]$\n  - $[p_{1,s},p_{2,s},p_{3,s}] = [0.3,0.4,0.3]$\n  - $k_s = 1$, $G_s = 1$\n- 案例 6（两种异构体，向更长的异构体的极端转换）：\n  - $[L_1,L_2] = [500,5000]$ nt\n  - $[p_{1,r},p_{2,r}] = [0.9,0.1]$\n  - $[p_{1,s},p_{2,s}] = [0.1,0.9]$\n  - $k_s = 1$, $G_s = 1$\n\n要求的最终输出格式：\n- 您的程序应生成一行输出，包含从案例 1 到案例 6 的测试结果，形式为一个类JSON的配对列表。每个配对对应一个测试用例，并且必须是 $[B_s,\\delta_s]$ 的形式，两个条目都四舍五入到六位小数。整个输出应打印为一行，不含多余空格，例如：\n- 示例格式：$[[0.800000,-0.200000],[1.200000,0.200000],\\dots]$。\n\n不涉及角度。所有输出均为无单位的小数。不要使用百分号；所有误差都以小数表示。您的程序必须是自包含的，不需要任何输入，并且只使用指定的库。", "solution": "此问题已经过审查并被确定为有效。这是一个定义明确、有科学依据的练习，旨在对转录组学中一个已知的系统误差来源进行建模。它基于一个简化但在概念上合理的RNA测序确定性模型，为计算提供了清晰的基础。所有必要的参数和定义都已提供，不存在内部矛盾或歧义。\n\n任务是量化一个朴素的基因水平表达估计量相对于一个理想化的异构体感知估计量的偏倚。我们首先将所提供的模型形式化，以推导出该偏倚的一般表达式。\n\n样本 $s$ 中异构体 $j$ 的期望片段计数由下式给出：\n$$ \\mathbb{E}[C_{j,s}] = k_s \\, \\theta_{j,s} \\, L_j $$\n其中 $k_s$ 是一个样本特异性的测序深度常数，$\\theta_{j,s}$ 是该异构体的摩尔浓度，$L_j$ 是其有效长度。基因水平的摩尔丰度为 $G_s = \\sum_{j=1}^{I} \\theta_{j,s}$，异构体分数为 $p_{j,s} = \\theta_{j,s} / G_s$。通过代换，我们得到 $\\theta_{j,s} = G_s \\, p_{j,s}$，这使我们能够将期望计数重新表达为：\n$$ \\mathbb{E}[C_{j,s}] = k_s \\, G_s \\, p_{j,s} \\, L_j $$\n对于模拟，我们被指示使用 $k_s=1$ 和 $G_s=1$，但为了保持严谨性，我们将继续进行一般推导。\n\n首先，考虑理想化的异构体感知估计量 $\\widehat{G}_{\\mathrm{aware},s}$。该估计量在聚合之前于异构体水平上操作。\n$$ \\widehat{G}_{\\mathrm{aware},s} = \\sum_{j=1}^{I} \\frac{\\mathbb{E}[C_{j,s}]}{k_s \\, L_j} $$\n代入 $\\mathbb{E}[C_{j,s}]$ 的表达式：\n$$ \\widehat{G}_{\\mathrm{aware},s} = \\sum_{j=1}^{I} \\frac{k_s \\, G_s \\, p_{j,s} \\, L_j}{k_s \\, L_j} = \\sum_{j=1}^{I} G_s \\, p_{j,s} = G_s \\sum_{j=1}^{I} p_{j,s} $$\n根据定义，异构体分数之和为一：$\\sum_{j=1}^{I} p_{j,s} = 1$。因此：\n$$ \\widehat{G}_{\\mathrm{aware},s} = G_s $$\n正如预期的那样，异构体感知估计量在这个确定性模型中是无偏的，并且完美地恢复了真实的基因水平丰度 $G_s$。这成为我们比较的基准真相。\n\n接下来，我们分析朴素估计量 $\\widehat{G}_{\\mathrm{naive},s}$。此方法首先在基因水平聚合计数，然后应用一个从参考样本 $r$ 派生的单一长度校正因子。\n基因的聚合期望计数为：\n$$ \\mathbb{E}[C_{\\mathrm{gene},s}] = \\sum_{j=1}^{I} \\mathbb{E}[C_{j,s}] = \\sum_{j=1}^{I} k_s \\, G_s \\, p_{j,s} \\, L_j = k_s \\, G_s \\left(\\sum_{j=1}^{I} p_{j,s} \\, L_j\\right) $$\n我们将给定样本 $s$ 的丰度加权的平均异构体长度定义为 $L_s^{\\mathrm{avg}} = \\sum_{j=1}^{I} p_{j,s} \\, L_j$。则聚合计数为 $\\mathbb{E}[C_{\\mathrm{gene},s}] = k_s \\, G_s \\, L_s^{\\mathrm{avg}}$。\n\n朴素估计量使用一个固定的参考长度 $L_{\\mathrm{ref}}$ 对此计数进行归一化，该参考长度是使用来自参考样本 $r$ 的异构体分数计算的平均异构体长度：\n$$ L_{\\mathrm{ref}} = \\sum_{j=1}^{I} p_{j,r} \\, L_j $$\n然后，估计值为：\n$$ \\widehat{G}_{\\mathrm{naive},s} = \\frac{\\mathbb{E}[C_{\\mathrm{gene},s}]}{k_s \\, L_{\\mathrm{ref}}} = \\frac{k_s \\, G_s \\, L_s^{\\mathrm{avg}}}{k_s \\, L_{\\mathrm{ref}}} = G_s \\frac{L_s^{\\mathrm{avg}}}{L_{\\mathrm{ref}}} $$\n\n乘性偏倚因子 $B_s$ 是朴素估计与真实丰度（由感知估计量给出）的比值：\n$$ B_s = \\frac{\\widehat{G}_{\\mathrm{naive},s}}{\\widehat{G}_{\\mathrm{aware},s}} = \\frac{G_s \\frac{L_s^{\\mathrm{avg}}}{L_{\\mathrm{ref}}}}{G_s} = \\frac{L_s^{\\mathrm{avg}}}{L_{\\mathrm{ref}}} $$\n代入平均长度的完整定义，我们得到偏倚的最终解析表达式：\n$$ B_s = \\frac{\\sum_{j=1}^{I} p_{j,s} \\, L_j}{\\sum_{j=1}^{I} p_{j,r} \\, L_j} $$\n这个结果优雅地证明了，乘性偏倚恰好是目标样本中丰度加权的平均异构体长度与参考样本中该值的比率。当且仅当这两个平均长度不同时，才会引入偏倚。对于一个其异构体具有不同长度的基因，当异构体的相对比例（$p_{j,s}$ 与 $p_{j,r}$）在样本间发生变化时，就会发生这种情况。\n\n相对误差 $\\delta_s$ 定义为 $B_s - 1$：\n$$ \\delta_s = \\frac{\\sum_{j=1}^{I} p_{j,s} \\, L_j}{\\sum_{j=1}^{I} p_{j,r} \\, L_j} - 1 $$\n\n现在，问题简化为对这6个给定的测试用例进行这些推导出的公式的机械应用。实现将为每个参数集计算这些量。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the RNA-seq bias simulation problem for a suite of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (isoform_lengths, reference_fractions, sample_fractions).\n    # k_s and G_s are 1 for all cases as per the problem and cancel out.\n    test_cases = [\n        # Case 1: shift toward shorter isoform\n        {\n            \"L\": np.array([1000.0, 2000.0]),\n            \"p_r\": np.array([0.5, 0.5]),\n            \"p_s\": np.array([0.8, 0.2]),\n        },\n        # Case 2: shift toward longer isoform\n        {\n            \"L\": np.array([1000.0, 2000.0]),\n            \"p_r\": np.array([0.5, 0.5]),\n            \"p_s\": np.array([0.2, 0.8]),\n        },\n        # Case 3: three isoforms, pronounced swap from medium to short\n        {\n            \"L\": np.array([500.0, 1500.0, 3000.0]),\n            \"p_r\": np.array([0.2, 0.7, 0.1]),\n            \"p_s\": np.array([0.7, 0.2, 0.1]),\n        },\n        # Case 4: equal lengths, ratio change should not induce bias\n        {\n            \"L\": np.array([1000.0, 1000.0, 1000.0]),\n            \"p_r\": np.array([0.1, 0.8, 0.1]),\n            \"p_s\": np.array([0.7, 0.2, 0.1]),\n        },\n        # Case 5: identical ratios, no bias expected\n        {\n            \"L\": np.array([750.0, 1800.0, 2400.0]),\n            \"p_r\": np.array([0.3, 0.4, 0.3]),\n            \"p_s\": np.array([0.3, 0.4, 0.3]),\n        },\n        # Case 6: extreme swap toward much longer isoform\n        {\n            \"L\": np.array([500.0, 5000.0]),\n            \"p_r\": np.array([0.9, 0.1]),\n            \"p_s\": np.array([0.1, 0.9]),\n        }\n    ]\n\n    results_as_strings = []\n    for case in test_cases:\n        L = case[\"L\"]\n        p_r = case[\"p_r\"]\n        p_s = case[\"p_s\"]\n\n        # Calculate abundance-weighted average isoform length for reference (L_ref)\n        # and sample (L_s). Using dot product for weighted sum: sum(p_i * L_i)\n        L_ref = np.dot(p_r, L)\n        L_s = np.dot(p_s, L)\n\n        # The multiplicative bias factor B_s is the ratio of average lengths.\n        # This is derived in the solution text.\n        # Handle the case where L_ref is zero to avoid division by zero,\n        # although this is not expected with the given test cases.\n        if L_ref == 0:\n            # If L_ref is 0, this implies all isoforms have 0 length or 0 expression.\n            # If L_s is also 0, bias is undefined but can be treated as 1 (no change).\n            # If L_s is not 0, bias is infinite. This scenario is ill-defined.\n            # For this problem, we assume L_ref > 0.\n            B_s = 1.0 if L_s == 0 else np.inf\n        else:\n            B_s = L_s / L_ref\n\n        # The relative error delta_s is B_s - 1.\n        delta_s = B_s - 1.0\n\n        # Format the result pair [B_s, delta_s] as a string with each number\n        # rounded to six decimal places, per the output specification.\n        results_as_strings.append(f\"[{B_s:.6f},{delta_s:.6f}]\")\n\n    # Join the formatted string pairs with commas and enclose in brackets\n    # to create the final JSON-like output string.\n    final_output = f\"[{','.join(results_as_strings)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "2494870"}, {"introduction": "最后一个实践将我们的视角从数据分析提升到实验设计和统计建模。在这里，你将处理蛋白质组学中的一个常见场景：研究多种环境因素如何相互作用以影响蛋白质表达。你将学习使用析因设计 (factorial design)，这是一个用于解析主效应和交互作用的强大统计框架，同时还将学习如何通过区组设计 (blocking) 来控制如批次效应等技术噪音。[@problem_id:2494904]", "problem": "一个微生物学实验室使用液相色谱-串联质谱 (LC-MS/MS) 来定量在 $2 \\times 2$ 析因设计下生长的细菌中特定蛋白质的 $\\log_2$强度。该设计有两个因子：碳源（葡萄糖对乙酸盐）和氧气可得性（好氧对厌氧）。由于 LC-MS/MS 运行会受批次效应影响，实验分两个批次执行，每个批次包含所有四种处理组合，且每个单元的生物学重复次数相同。设碳源因子由 $x_{C} \\in \\{-1,+1\\}$ 编码，其中 $+1$ 代表葡萄糖，$-1$ 代表乙酸盐；氧气可得性由 $x_{O} \\in \\{-1,+1\\}$ 编码，其中 $+1$ 代表好氧，$-1$ 代表厌氧。假设在每个批次内，每个处理组合有 $n$ 个生物学重复，并且测量值以 $\\log_2$ 尺度表示。\n\n从析因设计的固定效应线性模型的核心定义出发，并基于区组化可消除系统性但非研究者感兴趣的变异来源这一原则，执行以下操作：\n\n1) 为观测到的 $\\log_2$强度 $Y$ 指定一个线性模型，该模型包括截距、碳源和氧气可得性的主效应、它们的交互作用以及一个固定的批次效应。对 $x_{C}$ 和 $x_{O}$ 使用上述效应编码，并让批次指示变量由两个批次的固定效应参数表示。陈述模型参数所需的可识别性约束。\n\n2) 使用第 $1)$ 部分中的模型和上述效应编码，推导出用于估计碳源与氧气交互作用系数的对比（作为四个单元均值的线性组合）。用四个单元均值 $\\bar{Y}_{++}$、$\\bar{Y}_{+-}$、$\\bar{Y}_{-+}$ 和 $\\bar{Y}_{--}$ 符号化地表示这个对比，其中第一个和第二个下标分别表示 $x_{C}$ 和 $x_{O}$ 的符号。\n\n3) 实验在两个 LC-MS/MS 批次中进行，采用平衡重复（$n$ 在所有单元和批次中均相同）。四种处理组合的批次内样本均值（$\\log_2$强度）如下：\n\n批次 $1$：葡萄糖-好氧 ($\\bar{Y}^{(1)}_{++}$) $= 13.20$，葡萄糖-厌氧 ($\\bar{Y}^{(1)}_{+-}$) $= 12.05$，乙酸盐-好氧 ($\\bar{Y}^{(1)}_{-+}$) $= 12.65$，乙酸盐-厌氧 ($\\bar{Y}^{(1)}_{--}$) $= 11.95$。\n\n批次 $2$：葡萄糖-好氧 ($\\bar{Y}^{(2)}_{++}$) $= 13.55$，葡萄糖-厌氧 ($\\bar{Y}^{(2)}_{+-}$) $= 12.10$，乙酸盐-好氧 ($\\bar{Y}^{(2)}_{-+}$) $= 12.45$，乙酸盐-厌氧 ($\\bar{Y}^{(2)}_{--}$) $= 12.05$。\n\n假设每个批次和单元内的重复次数相等，根据第 $1)$ 部分的模型，通过平衡区组设计对批次效应进行校正，计算估计的交互作用系数 $\\hat{\\gamma}$。仅报告 $\\hat{\\gamma}$ 的数值（以 $\\log_2$尺度单位），并将答案四舍五入到四位有效数字。", "solution": "该问题陈述具有科学依据，提法恰当，并包含了推导唯一解所需的所有信息。所述的实验设计是标准的含区组的平衡 $2 \\times 2$ 析因设计，使用固定效应线性模型进行分析是合适的。解答过程如下。\n\n首先，必须指定线性模型。设 $Y_{ijkl}$ 表示第 $l$ 批次（$l \\in \\{1, 2\\}$）中，碳源第 $j$ 水平（$x_{Cj} \\in \\{-1, +1\\}$）、氧气可得性第 $k$ 水平（$x_{Ok} \\in \\{-1, +1\\}$）的第 $i$ 个生物学重复（$i=1, \\dots, n$）的观测 $\\log_2$强度。该模型包括一个截距、主效应、一个二阶交互作用和一个固定批次效应。模型方程为：\n$$Y_{ijkl} = \\beta_0 + \\beta_C x_{Cj} + \\beta_O x_{Ok} + \\gamma (x_{Cj} x_{Ok}) + B_l + \\epsilon_{ijkl}$$\n在此模型中：\n- $\\beta_0$ 是总均值，或总截距。\n- $\\beta_C$ 是碳源的主效应。对于从乙酸盐（编码为 $-1$）到葡萄糖（编码为 $+1$）的变化，$Y$ 的期望变化为 $2\\beta_C$。\n- $\\beta_O$ 是氧气可得性的主效应。对于从厌氧（编码为 $-1$）到好氧（编码为 $+1$）的变化，$Y$ 的期望变化为 $2\\beta_O$。\n- $\\gamma$ 是碳源与氧气交互作用的交互作用系数。它量化了一个因子的效应如何依赖于另一个因子的水平。问题中将其估计值表示为 $\\hat{\\gamma}$。\n- $B_l$ 是批次 $l$ 的固定效应。该项解释了两个 LC-MS/MS 批次之间平均强度的系统性差异。\n- $\\epsilon_{ijkl}$ 表示每个测量值的独立同分布随机误差，假设其均值为 $0$，方差为常数 $\\sigma^2$。\n\n为使该模型可识别，参数必须是唯一确定的。同时存在总均值 $\\beta_0$ 和独立的批次效应 $B_1$ 和 $B_2$ 会使模型过度参数化。必须施加一个约束。对于存在截距的固定效应，一个标准的约束是和为零约束：\n$$B_1 + B_2 = 0$$\n此约束确保 $\\beta_0$ 代表所有条件和批次的真实总均值，而单个批次效应 $B_l$ 则代表与此总均值的偏差。\n\n其次，我们推导用于估计交互作用系数 $\\gamma$ 的对比。需要给定处理组合 $(j, k)$ 的观测值期望值，并在平衡批次上取平均。单元 $(j,k)$ 中观测值均值的期望值，记作 $\\bar{Y}_{jk}$，为：\n$$E[\\bar{Y}_{jk}] = E\\left[\\frac{1}{2n} \\sum_{l=1}^{2} \\sum_{i=1}^{n} Y_{ijkl}\\right] = \\frac{1}{2} \\sum_{l=1}^{2} (\\beta_0 + \\beta_C x_{Cj} + \\beta_O x_{Ok} + \\gamma (x_{Cj} x_{Ok}) + B_l)$$\n$$E[\\bar{Y}_{jk}] = \\beta_0 + \\beta_C x_{Cj} + \\beta_O x_{Ok} + \\gamma (x_{Cj} x_{Ok}) + \\frac{1}{2}(B_1+B_2)$$\n应用约束 $B_1+B_2=0$，批次效应被抵消。期望的单元均值为：\n$E[\\bar{Y}_{++}] = \\beta_0 + \\beta_C + \\beta_O + \\gamma$ (对于 $x_C=+1, x_O=+1$)\n$E[\\bar{Y}_{+-}] = \\beta_0 + \\beta_C - \\beta_O - \\gamma$ (对于 $x_C=+1, x_O=-1$)\n$E[\\bar{Y}_{-+}] = \\beta_0 - \\beta_C + \\beta_O - \\gamma$ (对于 $x_C=-1, x_O=+1$)\n$E[\\bar{Y}_{--}] = \\beta_0 - \\beta_C - \\beta_O + \\gamma$ (对于 $x_C=-1, x_O=-1$)\n\n为了分离出 $\\gamma$，我们构建这些期望均值的特定线性组合：\n$$(E[\\bar{Y}_{++}] + E[\\bar{Y}_{--}]) - (E[\\bar{Y}_{+-}] + E[\\bar{Y}_{-+}])$$\n$$= (\\beta_0 + \\beta_C + \\beta_O + \\gamma + \\beta_0 - \\beta_C - \\beta_O + \\gamma) - (\\beta_0 + \\beta_C - \\beta_O - \\gamma + \\beta_0 - \\beta_C + \\beta_O - \\gamma)$$\n$$= (2\\beta_0 + 2\\gamma) - (2\\beta_0 - 2\\gamma) = 4\\gamma$$\n由此，我们得到 $\\gamma = \\frac{1}{4} (E[\\bar{Y}_{++}] + E[\\bar{Y}_{--}] - E[\\bar{Y}_{+-}] - E[\\bar{Y}_{-+}])$。$\\gamma$ 的估计量，记作 $\\hat{\\gamma}$，通过用观测样本均值替代期望值得到：\n$$\\hat{\\gamma} = \\frac{1}{4} (\\bar{Y}_{++} + \\bar{Y}_{--} - \\bar{Y}_{+-} - \\bar{Y}_{-+})$$\n这个表达式就是以四个单元均值表示的所需对比。\n\n第三，我们计算 $\\hat{\\gamma}$ 的数值。由于设计是平衡的，每个处理组合的总均值是两个批次均值的简单算术平均值。\n给定数据：\n批次 $1$：$\\bar{Y}^{(1)}_{++} = 13.20$，$\\bar{Y}^{(1)}_{+-} = 12.05$，$\\bar{Y}^{(1)}_{-+} = 12.65$，$\\bar{Y}^{(1)}_{--} = 11.95$。\n批次 $2$：$\\bar{Y}^{(2)}_{++} = 13.55$，$\\bar{Y}^{(2)}_{+-} = 12.10$，$\\bar{Y}^{(2)}_{-+} = 12.45$，$\\bar{Y}^{(2)}_{--} = 12.05$。\n\n总单元均值计算如下：\n$\\bar{Y}_{++} = \\frac{13.20 + 13.55}{2} = \\frac{26.75}{2} = 13.375$\n$\\bar{Y}_{+-} = \\frac{12.05 + 12.10}{2} = \\frac{24.15}{2} = 12.075$\n$\\bar{Y}_{-+} = \\frac{12.65 + 12.45}{2} = \\frac{25.10}{2} = 12.55$\n$\\bar{Y}_{--} = \\frac{11.95 + 12.05}{2} = \\frac{24.00}{2} = 12.00$\n\n将这些值代入 $\\hat{\\gamma}$ 的公式中：\n$$\\hat{\\gamma} = \\frac{1}{4} (13.375 + 12.00 - 12.075 - 12.55)$$\n$$\\hat{\\gamma} = \\frac{1}{4} (25.375 - 24.625)$$\n$$\\hat{\\gamma} = \\frac{1}{4} (0.75)$$\n$$\\hat{\\gamma} = 0.1875$$\n结果为 $0.1875$，按要求保留四位有效数字。", "answer": "$$\\boxed{0.1875}$$", "id": "2494904"}]}