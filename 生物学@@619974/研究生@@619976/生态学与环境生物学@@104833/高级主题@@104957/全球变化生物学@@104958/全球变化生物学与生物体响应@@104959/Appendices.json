{"hands_on_practices": [{"introduction": "全球变化生物学的一个核心任务是评估生物体对环境变化的生理耐受性。本练习将指导您完成一个典型的生态生理学数据分析流程：从呼吸代谢测量数据中，估算关键氧分压（$P_{crit}$），并进一步评估生物在不同温度和氧气条件下的热安全裕度（Thermal Safety Margin）。通过这个实践，您将掌握如何将基础生理数据转化为预测生物对气候变暖和海洋脱氧脆弱性的关键指标 [@problem_id:2495573]。", "problem": "给定某水生外温动物在多个温度下测得的密闭式呼吸测定法数据集。对于每个温度，溶解氧分压（单位：千帕，kPa）从空气饱和条件开始逐步降低，同时测量生物体静息时的耗氧率。假设以下基本原理和定义为出发点：\n\n- 在临界氧分压之上，生物体调节其代谢率，单位质量耗氧率与环境氧分压无关；在临界氧分压之下，该速率随环境氧分压近似线性下降。这个转变点即为临界氧分压 $P_{crit}$。\n- 对于给定温度 $T$（单位：摄氏度，$^{\\circ}\\mathrm{C}$），耗氧率 $M$（单位为在不同温度间一致的任意单位）作为氧分压 $P$（单位：kPa）函数的分段模型为\n$$\nM(P) =\n\\begin{cases}\nc, & P \\ge P_{crit},\\\\\nm\\,(P - P_{crit}) + c, & P < P_{crit},\n\\end{cases}\n$$\n其中 $c$ 是调节平台期的代谢率，$m$ 是氧依赖区的斜率。测量数据除四舍五入外不包含随机误差，并与此理想化模型一致。\n- 在一个有限的温度范围内，根据经验将 $P_{crit}$ 和 $T$ 之间的关系近似为线性是合理的，\n$$\nP_{crit}(T) \\approx a + b\\,T,\n$$\n其中常数 $a$ 和 $b$ 通过对 $(T, P_{crit})$ 估计值集合进行最小二乘回归来确定。\n- 定义在环境氧分压 $P_{amb}$（单位：kPa）下，氧限制性调节温度上限 $T^{*}(P_{amb})$ 为方程 $P_{crit}(T^{*}) = P_{amb}$ 的解。在线性近似下，如果 $b \\ne 0$，\n$$\nT^{*}(P_{amb}) = \\frac{P_{amb} - a}{b}.\n$$\n- 定义热安全裕度为\n$$\n\\mathrm{TSM}(P_{amb}) = T^{*}(P_{amb}) - T_{env},\n$$\n其中 $T_{env}$ 是环境温度（单位：$^{\\circ}\\mathrm{C}$）。\n\n您的任务是编写一个程序，对每个测试用例执行以下操作：\n\n1. 对于每个温度 $T$，通过拟合上述分段模型，从提供的 $(P, M)$ 数据中估计 $P_{crit}$。使用以下原则性估计程序：对于观测到的不同 $P$ 值中的每个候选断点 $\\tilde{P}$（不包括最小值，以确保下段至少有一个点），计算\n   - 平台期估计值 $c$，即 $P \\ge \\tilde{P}$ 处观测到的 $M$ 的平均值，\n   - 下段的斜率估计值 $m$，通过对变换后的回归方程 $M - c = m\\,(P - \\tilde{P})$ 进行最小二乘法计算，仅使用 $P < \\tilde{P}$ 的数据点，\n   - 在连续性约束下，两个分段的总平方误差和。\n   选择使该总误差最小化的 $\\tilde{P}$，并将其报告为该温度下的估计 $P_{crit}$。\n2. 使用跨温度的估计 $P_{crit}$ 值集合，通过最小二乘法拟合线性模型 $P_{crit}(T) \\approx a + b\\,T$。\n3. 计算常氧（$P_{amb} = P_{norm}$）和低氧（$P_{amb} = P_{hyp}$）条件下的 $T^{*}(P_{amb})$，然后使用测试用例中提供的 $T_{env}$ 计算 $\\mathrm{TSM}(P_{norm})$ 和 $\\mathrm{TSM}(P_{hyp})$。\n\n$P_{crit}$ 以 kPa 表示，$T^{*}$ 以 $^{\\circ}\\mathrm{C}$ 表示，$\\mathrm{TSM}$ 以 $^{\\circ}\\mathrm{C}$ 表示。所有报告的浮点数输出均四舍五入到小数点后两位。\n\n三个测试用例的输入数据（直接嵌入到您的代码中）如下：\n\n- 测试用例 1：\n  - 各温度下的数据集：\n    - $T = 15$ $^{\\circ}\\mathrm{C}$：$P$ (kPa) = $[2,4,6,8,12,16,20]$, $M$ (任意单位) = $[20,40,60,80,80,80,80]$。\n    - $T = 20$ $^{\\circ}\\mathrm{C}$：$P$ (kPa) = $[3,6,9,12,15,18,21]$, $M$ = $[27.5,55,82.5,110,110,110,110]$。\n    - $T = 25$ $^{\\circ}\\mathrm{C}$：$P$ (kPa) = $[4,8,12,16,18,20,21]$, $M$ = $[37.5,75,112.5,150,150,150,150]$。\n  - 环境氧：$P_{norm} = 21$ kPa, $P_{hyp} = 10$ kPa。\n  - 环境温度：$T_{env} = 22$ $^{\\circ}\\mathrm{C}$。\n\n- 测试用例 2：\n  - 各温度下的数据集：\n    - $T = 10$ $^{\\circ}\\mathrm{C}$：$P$ (kPa) = $[1,3.5,7,10,14,18,21]$, $M$ = $[10,35,70,70,70,70,70]$。\n    - $T = 15$ $^{\\circ}\\mathrm{C}$：$P$ (kPa) = $[2,5,10,14,18,21]$, $M$ = $[20,50,100,100,100,100]$。\n    - $T = 20$ $^{\\circ}\\mathrm{C}$：$P$ (kPa) = $[2,6.5,13,16,19,21]$, $M$ = $[20,65,130,130,130,130]$。\n  - 环境氧：$P_{norm} = 21$ kPa, $P_{hyp} = 10$ kPa。\n  - 环境温度：$T_{env} = 18$ $^{\\circ}\\mathrm{C}$。\n\n- 测试用例 3：\n  - 各温度下的数据集：\n    - $T = 12$ $^{\\circ}\\mathrm{C}$：$P$ (kPa) = $[0.5,2.5,5,10,15,21]$, $M$ = $[7.5,37.5,75,75,75,75]$。\n    - $T = 22$ $^{\\circ}\\mathrm{C}$：$P$ (kPa) = $[3,7,14,17,20,21]$, $M$ = $[30,70,140,140,140,140]$。\n  - 环境氧：$P_{norm} = 21$ kPa, $P_{hyp} = 10$ kPa。\n  - 环境温度：$T_{env} = 20$ $^{\\circ}\\mathrm{C}$。\n\n您的程序应生成单行输出，其中包含一个每个测试用例结果的列表。每个测试用例的结果必须是按以下结构组织的列表：\n- 估计的 $P_{crit}$ 值列表（按给定顺序每个温度一个值），单位为 kPa，四舍五入到小数点后两位，\n- $T^{*}(P_{norm})$，单位为 $^{\\circ}\\mathrm{C}$，四舍五入到小数点后两位，\n- $T^{*}(P_{hyp})$，单位为 $^{\\circ}\\mathrm{C}$，四舍五入到小数点后两位，\n- $\\mathrm{TSM}(P_{norm})$，单位为 $^{\\circ}\\mathrm{C}$，四舍五入到小数点后两位，\n- $\\mathrm{TSM}(P_{hyp})$，单位为 $^{\\circ}\\mathrm{C}$，四舍五入到小数点后两位。\n\n因此，最终输出必须是单个 Python 风格的列表的列表，例如，`[[[...], \\dots], [[...], \\dots], [[...], \\dots]]`，打印在一行上，没有多余的文本。", "solution": "该问题要求实现对生态生理学数据的序贯分析，这些数据涉及水生外温动物对变化的​​环境氧和温度的代谢反应。该分析分为三个主要阶段：首先，根据多个温度下的分段耗氧量数据估算临界氧分压 $P_{crit}$；其次，对 $P_{crit}$ 和温度 $T$ 之间的关系进行建模；第三，计算生态学相关指标，如氧限制性调节温度上限 $T^{*}$ 和热安全裕度 $\\mathrm{TSM}$。整个过程基于已建立的生理模型和标准统计方法。\n\n逻辑步骤如下：\n\n**1. 临界氧分压 ($P_{crit}$) 的估计**\n\n对于每个恒定温度 $T$ 下的呼吸测定数据集 $(P_i, M_i)$，我们必须估计分段模型中的断点 $P_{crit}$：\n$$\nM(P) =\n\\begin{cases}\nc, & P \\ge P_{crit}\\\\\nm\\,(P - P_{crit}) + c, & P < P_{crit}\n\\end{cases}\n$$\n问题指定了一种对一组候选断点进行网格搜索的方法。设观测到的不同氧分压集合为 $\\{p_1, p_2, ..., p_k\\}$（按升序排列）。候选断点（表示为 $\\tilde{P}$）从集合 $\\{p_2, ..., p_k\\}$ 中选取，从而确保对于任何候选 $\\tilde{P}$，数据集都被划分为非空的上段 ($P \\ge \\tilde{P}$) 和下段 ($P < \\tilde{P}$)。\n\n对于每个候选断点 $\\tilde{P}$：\n\n- 调节代谢率 $c$ 被估计为上段耗氧率 $M_i$ 的平均值，在该段中，生物体是氧调节者：\n$$\n\\hat{c} = \\frac{1}{N_{upper}} \\sum_{i | P_i \\ge \\tilde{P}} M_i\n$$\n其中 $N_{upper}$ 是上段中的数据点数。\n\n- 氧依赖区的斜率 $m$ 是通过对下段数据进行线性最小二乘法来估计的。该段的模型是 $M_i = m(P_i - \\tilde{P}) + c$。为了满足在 $P = \\tilde{P}$ 处的连续性约束，我们使用上段的估计值 $\\hat{c}$，并对变换后的变量 $y_i = M_i - \\hat{c}$ 和 $x_i = P_i - \\tilde{P}$ 进行回归。模型变为 $y_i = m x_i$，这是一个通过原点的回归。$m$ 的最小二乘估计值为：\n$$\n\\hat{m} = \\frac{\\sum_{i | P_i < \\tilde{P}} x_i y_i}{\\sum_{i | P_i < \\tilde{P}} x_i^2} = \\frac{\\sum_{i | P_i < \\tilde{P}} (P_i - \\tilde{P})(M_i - \\hat{c})}{\\sum_{i | P_i < \\tilde{P}} (P_i - \\tilde{P})^2}\n$$\n只要分母不为零，该估计就有效，所提供数据集的结构满足此条件。\n\n- 候选断点 $\\tilde{P}$ 的总平方误差和 (SSE) 是两段误差之和：\n$$\n\\mathrm{SSE}(\\tilde{P}) = \\sum_{i | P_i \\ge \\tilde{P}} (M_i - \\hat{c})^2 + \\sum_{i | P_i < \\tilde{P}} (M_i - (\\hat{m}(P_i - \\tilde{P}) + \\hat{c}))^2\n$$\n\n临界氧分压的最优估计值 $\\hat{P}_{crit}$ 是使该总SSE最小化的候选断点 $\\tilde{P}$：\n$$\n\\hat{P}_{crit} = \\arg\\min_{\\tilde{P}} \\mathrm{SSE}(\\tilde{P})\n$$\n\n**2. $P_{crit}$ 温度依赖性的建模**\n\n在获得每个温度 $T_j$ 的一组估计对 $(\\hat{P}_{crit,j}, T_j)$ 后，我们使用线性近似来对其关系进行建模：\n$$\nP_{crit}(T) \\approx a + bT\n$$\n参数 $a$（截距）和 $b$（斜率）通过对 $(\\hat{P}_{crit,j}, T_j)$ 点集进行简单线性回归（普通最小二乘法）来确定。系数的标准公式为：\n$$\nb = \\frac{N \\sum(T_j \\hat{P}_{crit,j}) - (\\sum T_j)(\\sum \\hat{P}_{crit,j})}{N \\sum(T_j^2) - (\\sum T_j)^2}\n$$\n$$\na = \\bar{\\hat{P}}_{crit} - b \\bar{T}\n$$\n其中 $N$ 是温度处理的数量，$\\bar{T}$ 和 $\\bar{\\hat{P}}_{crit}$ 分别是温度和估计的临界氧分压的平均值。标准数值库为此计算提供了稳健的函数。\n\n**3. 热阈值和安全裕度的计算**\n\n建立了线性模型 $P_{crit}(T) = a + bT$ 后，我们可以计算在给定环境氧分压 $P_{amb}$ 下的氧限制性调节温度上限 $T^{*}(P_{amb})$。该阈值被定义为调节所需的氧水平与环境水平相等的温度，即 $P_{crit}(T^{*}) = P_{amb}$。求解 $T^{*}$ 得：\n$$\nT^{*}(P_{amb}) = \\frac{P_{amb} - a}{b} \\quad (\\text{当 } b \\neq 0)\n$$\n此计算针对常氧 ($P_{amb} = P_{norm}$) 和低氧 ($P_{amb} = P_{hyp}$) 两种情况进行。\n\n最后，给定环境氧水平下的热安全裕度 (TSM) 是该阈值温度与当前环境温度 $T_{env}$ 之间的差值：\n$$\n\\mathrm{TSM}(P_{amb}) = T^{*}(P_{amb}) - T_{env}\n$$\n正的 TSM 表示生物体可以在环境温度下维持其调节的代谢率，而负的 TSM 则表明它将被迫进入氧顺应状态，这是一种代谢抑制的状态。\n\n以下程序为提供的测试用例实现了这整个序列，并按要求将最终数值结果四舍五入到小数点后两位。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for all test cases as specified.\n    \"\"\"\n    test_cases = [\n        {\n            \"datasets\": [\n                {\"T\": 15, \"P\": np.array([2, 4, 6, 8, 12, 16, 20]), \"M\": np.array([20, 40, 60, 80, 80, 80, 80])},\n                {\"T\": 20, \"P\": np.array([3, 6, 9, 12, 15, 18, 21]), \"M\": np.array([27.5, 55, 82.5, 110, 110, 110, 110])},\n                {\"T\": 25, \"P\": np.array([4, 8, 12, 16, 18, 20, 21]), \"M\": np.array([37.5, 75, 112.5, 150, 150, 150, 150])},\n            ],\n            \"P_norm\": 21.0, \"P_hyp\": 10.0, \"T_env\": 22.0\n        },\n        {\n            \"datasets\": [\n                {\"T\": 10, \"P\": np.array([1, 3.5, 7, 10, 14, 18, 21]), \"M\": np.array([10, 35, 70, 70, 70, 70, 70])},\n                {\"T\": 15, \"P\": np.array([2, 5, 10, 14, 18, 21]), \"M\": np.array([20, 50, 100, 100, 100, 100])},\n                {\"T\": 20, \"P\": np.array([2, 6.5, 13, 16, 19, 21]), \"M\": np.array([20, 65, 130, 130, 130, 130])},\n            ],\n            \"P_norm\": 21.0, \"P_hyp\": 10.0, \"T_env\": 18.0\n        },\n        {\n            \"datasets\": [\n                {\"T\": 12, \"P\": np.array([0.5, 2.5, 5, 10, 15, 21]), \"M\": np.array([7.5, 37.5, 75, 75, 75, 75])},\n                {\"T\": 22, \"P\": np.array([3, 7, 14, 17, 20, 21]), \"M\": np.array([30, 70, 140, 140, 140, 140])},\n            ],\n            \"P_norm\": 21.0, \"P_hyp\": 10.0, \"T_env\": 20.0\n        }\n    ]\n\n    def estimate_pcrit(P_obs, M_obs):\n        \"\"\"\n        Estimates Pc_rit for a single dataset by finding the breakpoint\n        that minimizes the total sum of squared errors.\n        \"\"\"\n        min_sse = float('inf')\n        best_pcrit = None\n        \n        # Candidate breakpoints are all distinct P values except the minimum\n        candidate_p = np.unique(P_obs)[1:]\n\n        for p_tilde in candidate_p:\n            mask_upper = P_obs >= p_tilde\n            mask_lower = P_obs < p_tilde\n\n            P_upper, M_upper = P_obs[mask_upper], M_obs[mask_upper]\n            P_lower, M_lower = P_obs[mask_lower], M_obs[mask_lower]\n\n            if P_lower.size == 0:\n                continue\n\n            # Estimate c from the upper (regulated) segment\n            c = np.mean(M_upper)\n\n            # Estimate m from the lower (conforming) segment using transformed variables\n            y_trans = M_lower - c\n            x_trans = P_lower - p_tilde\n            \n            # Use formula for regression through the origin: m = sum(xy)/sum(x^2)\n            sum_x_squared = np.sum(x_trans**2)\n            if sum_x_squared == 0:\n                 # This would happen if all P_lower values were identical,\n                 # which is not the case for this problem's data.\n                 # Skip this candidate if it happens.\n                continue\n            \n            m = np.sum(x_trans * y_trans) / sum_x_squared\n\n            # Calculate total sum of squared errors (SSE)\n            sse_upper = np.sum((M_upper - c)**2)\n            M_pred_lower = m * x_trans + c\n            sse_lower = np.sum((M_lower - M_pred_lower)**2)\n            total_sse = sse_upper + sse_lower\n\n            if total_sse < min_sse:\n                min_sse = total_sse\n                best_pcrit = p_tilde\n\n        return best_pcrit\n\n    all_results = []\n    for case in test_cases:\n        pcrit_estimates = []\n        temps = []\n        for dataset in case[\"datasets\"]:\n            T, P, M = dataset[\"T\"], dataset[\"P\"], dataset[\"M\"]\n            temps.append(T)\n            pcrit = estimate_pcrit(P, M)\n            pcrit_estimates.append(pcrit)\n        \n        # Fit linear model Pc_rit = a + b*T\n        # np.polyfit returns coefficients [b, a] for a degree 1 polynomial\n        b, a = np.polyfit(temps, pcrit_estimates, 1)\n\n        P_norm = case[\"P_norm\"]\n        P_hyp = case[\"P_hyp\"]\n        T_env = case[\"T_env\"]\n\n        # Calculate T* and TSM\n        if b == 0:\n            T_star_norm = float('inf')\n            T_star_hyp = float('inf')\n        else:\n            T_star_norm = (P_norm - a) / b\n            T_star_hyp = (P_hyp - a) / b\n\n        tsm_norm = T_star_norm - T_env\n        tsm_hyp = T_star_hyp - T_env\n        \n        # Format results for the current test case\n        case_result = [\n            [round(p, 2) for p in pcrit_estimates],\n            round(T_star_norm, 2),\n            round(T_star_hyp, 2),\n            round(tsm_norm, 2),\n            round(tsm_hyp, 2)\n        ]\n        all_results.append(case_result)\n\n    # Final print statement in the exact required format.\n    print(all_results)\n\nsolve()\n```", "id": "2495573"}, {"introduction": "在现实世界中，生物体常常同时面临多种环境胁迫，例如海水升温和海洋酸化。这些胁迫的综合效应可能并非简单的线性叠加，而是表现为协同或拮抗作用。本练习将向您介绍如何使用响应面模型来量化和分类多个胁迫因子之间的交互作用，这是一个理解和预测全球变化复杂后果的强大统计工具 [@problem_id:2495614]。", "problem": "生物体的钙化率共同受到文石饱和度和温度的影响。在全球变化的背景下，文石饱和度和温度都在发生变化，生物体在其联合响应中可能会表现出对加性作用的偏离（协同作用或拮抗作用）。考虑一个包含交互项和二次项的钙化率二阶响应面。令文石饱和度由 $\\Omega$（无单位）表示，温度由 $T$（单位为摄氏度）表示。令钙化率由 $G$（单位为 $\\mu\\text{mol}~\\text{CaCO}_3~\\text{cm}^{-2}~\\text{d}^{-1}$）表示。定义中心化预测变量 $x = \\Omega - \\Omega_0$ 和 $z = T - T_0$，其中 $\\Omega_0 = 3.0$ 且 $T_0 = 21.0$。通过普通最小二乘法（最小化残差平方和）拟合以下响应面：\n$$\nG \\approx \\beta_0 + \\beta_1 x + \\beta_2 z + \\beta_3 x z + \\beta_4 x^2 + \\beta_5 z^2.\n$$\n如果 $\\hat{\\beta}_3 > 0$，则将交互作用分类为协同作用；如果 $\\hat{\\beta}_3 < 0$，则分类为拮抗作用；如果 $|\\hat{\\beta}_3| \\le \\epsilon$（其中 $\\epsilon = 10^{-8}$），则分类为加性作用（无交互作用）。分类结果必须以整数形式返回：协同作用 $\\to 1$，拮抗作用 $\\to -1$，加性作用 $\\to 0$。\n\n给定三个测试数据集（每个数据集由九个 $(\\Omega, T, G)$ 三元组构成）。对于每个数据集，拟合上述指定的响应面，提取 $\\hat{\\beta}_3$，并输出相应的交互作用分类。\n\n使用以下数据。在下文每个列表中，每一行都是一个三元组 $(\\Omega, T, G)$，其中 $\\Omega$ 无单位，$T$ 的单位为 $^\\circ\\mathrm{C}$，$G$ 的单位为 $\\mu\\text{mol}~\\text{CaCO}_3~\\text{cm}^{-2}~\\text{d}^{-1}$。\n\n- 数据集 $1$：\n  - $(2.5, 18.0, 6.325)$\n  - $(3.0, 18.0, 5.2)$\n  - $(3.5, 18.0, 3.825)$\n  - $(2.5, 21.0, 8.875)$\n  - $(3.0, 21.0, 10.0)$\n  - $(3.5, 21.0, 10.875)$\n  - $(2.5, 24.0, 7.825)$\n  - $(3.0, 24.0, 11.2)$\n  - $(3.5, 24.0, 14.325)$\n\n- 数据集 $2$：\n  - $(2.5, 18.0, 1.825)$\n  - $(3.0, 18.0, 5.2)$\n  - $(3.5, 18.0, 8.325)$\n  - $(2.5, 21.0, 8.875)$\n  - $(3.0, 21.0, 10.0)$\n  - $(3.5, 21.0, 10.875)$\n  - $(2.5, 24.0, 12.325)$\n  - $(3.0, 24.0, 11.2)$\n  - $(3.5, 24.0, 9.825)$\n\n- 数据集 $3$：\n  - $(2.5, 18.0, 4.075)$\n  - $(3.0, 18.0, 5.2)$\n  - $(3.5, 18.0, 6.075)$\n  - $(2.5, 21.0, 8.875)$\n  - $(3.0, 21.0, 10.0)$\n  - $(3.5, 21.0, 10.875)$\n  - $(2.5, 24.0, 10.075)$\n  - $(3.0, 24.0, 11.2)$\n  - $(3.5, 24.0, 12.075)$\n\n实现细节与约束：\n- 使用普通最小二乘法来最小化 $\\sum_i \\left(G_i - \\hat{G}_i\\right)^2$，其中 $\\hat{G}_i$ 是对第 $i$ 个观测值的模型预测值。\n- 构建设计矩阵，其列按顺序对应于 $1$、$x$、$z$、$x z$、$x^2$ 和 $z^2$，其中 $x = \\Omega - 3.0$，$z = T - 21.0$。\n- 使用数值容差 $\\epsilon = 10^{-8}$ 来判断 $|\\hat{\\beta}_3|$ 是否有效为零。\n\n您的程序应生成单行输出，其中包含按数据集 1、数据集 2、数据集 3 顺序排列的结果，格式为一个由方括号括起来、以逗号分隔的列表（例如，[r1,r2,r3] 格式）。每个列表元素必须是 $\\{ -1, 0, 1 \\}$中的整数，映射关系如上所述。不应打印任何其他文本。", "solution": "该问题要求估计一个二阶响应面模型的参数，并对交互项进行分类。指定的方法是普通最小二乘（OLS）回归。\n\n模型由下式给出：\n$$\nG \\approx \\beta_0 + \\beta_1 x + \\beta_2 z + \\beta_3 x z + \\beta_4 x^2 + \\beta_5 z^2\n$$\n其中 $G$ 是钙化率，$x = \\Omega - \\Omega_0$ 和 $z = T - T_0$ 分别是文石饱和度（$\\Omega$）和温度（$T$）的中心化预测变量。中心化常数为 $\\Omega_0 = 3.0$ 和 $T_0 = 21.0$。\n\n用矩阵代数术语来说，一个线性回归模型表示为：\n$$\n\\mathbf{Y} = \\mathbf{X}\\boldsymbol{\\beta} + \\boldsymbol{\\varepsilon}\n$$\n在这里，$\\mathbf{Y}$ 是观测响应（$G_i$）的 $n \\times 1$ 向量，其中 $n=9$ 是观测次数。$\\mathbf{X}$ 是 $n \\times p$ 的设计矩阵，其中 $p=6$ 是待估计的参数数量。$\\boldsymbol{\\beta}$ 是待估计的系数 $(\\beta_0, \\beta_1, \\beta_2, \\beta_3, \\beta_4, \\beta_5)^T$ 的 $p \\times 1$ 向量。$\\boldsymbol{\\varepsilon}$ 是误差项向量。\n\nOLS 方法找到最小化残差平方和 $\\sum_{i=1}^n (G_i - \\hat{G}_i)^2 = (\\mathbf{Y} - \\mathbf{X}\\boldsymbol{\\beta})^T(\\mathbf{Y} - \\mathbf{X}\\boldsymbol{\\beta})$ 的系数向量 $\\hat{\\boldsymbol{\\beta}}$。其解析解由正规方程给出：\n$$\n\\hat{\\boldsymbol{\\beta}} = (\\mathbf{X}^T \\mathbf{X})^{-1} \\mathbf{X}^T \\mathbf{Y}\n$$\n\n首先，我们构建设计矩阵 $\\mathbf{X}$。预测变量 $\\Omega$ 的取值为 $\\{2.5, 3.0, 3.5\\}$，$T$ 的取值为 $\\{18.0, 21.0, 24.0\\}$。因此，中心化预测变量为 $x \\in \\{-0.5, 0, 0.5\\}$ 和 $z \\in \\{-3, 0, 3\\}$。该设计是一个全因子 $3 \\times 3$ 设计，因此这些水平的所有 9 种组合都存在。设计矩阵的列对应于模型中的项：$1$、$x$、$z$、$xz$、$x^2$ 和 $z^2$。对于 $n=9$ 个数据点 $(\\Omega_i, T_i)$ 中的每一个，$\\mathbf{X}$ 的相应行为 $[1, x_i, z_i, x_i z_i, x_i^2, z_i^2]$。由于所有三个数据集的 $(\\Omega, T)$ 对都相同，因此每次分析的设计矩阵 $\\mathbf{X}$ 也是相同的。\n\n$$\n\\mathbf{X} = \\begin{pmatrix}\n1 & -0.5 & -3 &  1.5 & 0.25 & 9 \\\\\n1 &  0.0 & -3 &  0.0 & 0.00 & 9 \\\\\n1 &  0.5 & -3 & -1.5 & 0.25 & 9 \\\\\n1 & -0.5 &  0 &  0.0 & 0.25 & 0 \\\\\n1 &  0.0 &  0 &  0.0 & 0.00 & 0 \\\\\n1 &  0.5 &  0 &  0.0 & 0.25 & 0 \\\\\n1 & -0.5 &  3 & -1.5 & 0.25 & 9 \\\\\n1 &  0.0 &  3 &  0.0 & 0.00 & 9 \\\\\n1 &  0.5 &  3 &  1.5 & 0.25 & 9\n\\end{pmatrix}\n$$\n\n这种平衡且中心化的因子设计的一个关键特性是，与交互项 $xz$ 对应的列向量（我们称之为 $\\mathbf{c}_3$）与设计矩阵 $\\mathbf{X}$ 中的所有其他列都是正交的。也就是说，$\\mathbf{c}_3$ 与任何其他列 $\\mathbf{c}_j$（$j \\neq 3$）的点积为零。例如，$\\sum_i (x_i z_i) \\cdot 1 = 0$，$\\sum_i (x_i z_i) \\cdot x_i = 0$ 等等。这种正交性意味着矩阵 $\\mathbf{X}^T \\mathbf{X}$ 是块对角矩阵，这简化了 $\\beta_3$ 的估计。系数 $\\hat{\\beta}_3$ 可以使用简化公式独立于其他系数进行计算：\n$$\n\\hat{\\beta}_3 = (\\mathbf{c}_3^T \\mathbf{c}_3)^{-1} \\mathbf{c}_3^T \\mathbf{Y} = \\frac{\\sum_{i=1}^9 (x_i z_i) G_i}{\\sum_{i=1}^9 (x_i z_i)^2}\n$$\n\n对于所有数据集，分母是恒定的：\n$\\sum_{i=1}^9 (x_i z_i)^2 = (1.5)^2 + (-1.5)^2 + (-1.5)^2 + (1.5)^2 = 4 \\times 2.25 = 9.0$。\n\n项 $x_i z_i$ 的非零值仅出现在设计的四个角点上。令 $G_1、G_3、G_7、G_9$ 分别为角点 $(x,z) = (-0.5, -3)、(0.5, -3)、(-0.5, 3)$ 和 $(0.5, 3)$ 处的钙化率。分子为：\n$\\sum_{i=1}^9 (x_i z_i) G_i = 1.5 \\cdot G_1 - 1.5 \\cdot G_3 - 1.5 \\cdot G_7 + 1.5 \\cdot G_9$。\n\n因此，$\\hat{\\beta}_3$ 的公式简化为：\n$$\n\\hat{\\beta}_3 = \\frac{1.5 (G_1 - G_3 - G_7 + G_9)}{9} = \\frac{1}{6} (G_1 - G_3 - G_7 + G_9)\n$$\n\n我们将此公式应用于每个数据集。\n\n数据集 1：\n$G_1=6.325$，$G_3=3.825$，$G_7=7.825$，$G_9=14.325$。\n$\\hat{\\beta}_3 = \\frac{1}{6} (6.325 - 3.825 - 7.825 + 14.325) = \\frac{1}{6}(9.0) = 1.5$。\n由于 $\\hat{\\beta}_3=1.5 > 0$，该交互作用是协同作用（$1$）。\n\n数据集 2：\n$G_1=1.825$，$G_3=8.325$，$G_7=12.325$，$G_9=9.825$。\n$\\hat{\\beta}_3 = \\frac{1}{6} (1.825 - 8.325 - 12.325 + 9.825) = \\frac{1}{6}(-9.0) = -1.5$。\n由于 $\\hat{\\beta}_3=-1.5 < 0$，该交互作用是拮抗作用（$-1$）。\n\n数据集 3：\n$G_1=4.075$，$G_3=6.075$，$G_7=10.075$，$G_9=12.075$。\n$\\hat{\\beta}_3 = \\frac{1}{6} (4.075 - 6.075 - 10.075 + 12.075) = \\frac{1}{6}(0.0) = 0.0$。\n由于 $|\\hat{\\beta}_3|=0.0 \\le 10^{-8}$，该交互作用是加性作用（$0$）。\n\n数据集 1、2 和 3 的分类结果分别为 $1$、$-1$ 和 $0$。为了一般性和稳健性，实现将使用 `numpy.linalg.lstsq` 来求解完整的系数向量 $\\boldsymbol{\\beta}$，尽管这里 $\\hat{\\beta}_3$ 的结果与推导出的结果是相同的。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Fits a second-order response surface model to three datasets to classify\n    the interaction between aragonite saturation and temperature on calcification.\n    \"\"\"\n    # Define constants from the problem statement\n    omega_0 = 3.0\n    T_0 = 21.0\n    epsilon = 1e-8\n\n    # Define the three test datasets as list of tuples (Omega, T, G)\n    datasets = [\n        # Dataset 1\n        [(2.5, 18.0, 6.325), (3.0, 18.0, 5.2), (3.5, 18.0, 3.825),\n         (2.5, 21.0, 8.875), (3.0, 21.0, 10.0), (3.5, 21.0, 10.875),\n         (2.5, 24.0, 7.825), (3.0, 24.0, 11.2), (3.5, 24.0, 14.325)],\n        # Dataset 2\n        [(2.5, 18.0, 1.825), (3.0, 18.0, 5.2), (3.5, 18.0, 8.325),\n         (2.5, 21.0, 8.875), (3.0, 21.0, 10.0), (3.5, 21.0, 10.875),\n         (2.5, 24.0, 12.325), (3.0, 24.0, 11.2), (3.5, 24.0, 9.825)],\n        # Dataset 3\n        [(2.5, 18.0, 4.075), (3.0, 18.0, 5.2), (3.5, 18.0, 6.075),\n         (2.5, 21.0, 8.875), (3.0, 21.0, 10.0), (3.5, 21.0, 10.875),\n         (2.5, 24.0, 10.075), (3.0, 24.0, 11.2), (3.5, 24.0, 12.075)]\n    ]\n\n    results = []\n\n    # Since the experimental design (Omega, T values) is the same for all datasets,\n    # the design matrix X can be constructed once.\n    sample_data = datasets[0]\n    omegas = np.array([d[0] for d in sample_data])\n    Ts = np.array([d[1] for d in sample_data])\n\n    # Center the predictor variables\n    x = omegas - omega_0\n    z = Ts - T_0\n\n    # Construct the design matrix X. The columns are 1, x, z, xz, x^2, z^2.\n    X = np.stack([\n        np.ones_like(x),\n        x,\n        z,\n        x * z,\n        x**2,\n        z**2\n    ], axis=1)\n\n    # Process each dataset\n    for data in datasets:\n        # Extract the response variable G (calcification rate)\n        G = np.array([d[2] for d in data])\n        \n        # Solve the ordinary least squares problem Y = X*beta\n        # np.linalg.lstsq returns the solution that minimizes the Euclidean 2-norm ||b - Ax||.\n        # This is equivalent to minimizing sum of squared residuals.\n        beta_hat, _, _, _ = np.linalg.lstsq(X, G, rcond=None)\n        \n        # The coefficient for the interaction term xz is beta_hat[3].\n        beta_3 = beta_hat[3]\n        \n        # Classify the interaction based on the sign of beta_3.\n        # Synergistic: 1, Antagonistic: -1, Additive: 0\n        if abs(beta_3) <= epsilon:\n            classification = 0\n        elif beta_3 > 0:\n            classification = 1\n        else:  # beta_3 < 0\n            classification = -1\n        \n        results.append(classification)\n\n    # Final print statement in the exact required format [r1,r2,r3]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2495614"}, {"introduction": "个体生理上的响应最终如何决定种群的命运？本练习通过构建依赖于温度的矩阵种群模型，将生理变化与种群动态联系起来。您将学习如何使用生命周期数据来计算种群增长率（$\\lambda$），确定导致种群崩溃的临界温度，并通过弹性分析识别出限制种群存续的最脆弱生命阶段 [@problem_id:2495608]。这对于预测物种对气候变化的长期响应至关重要。", "problem": "一个由幼体和成体组成的变温动物两阶段种群，其结构由依赖于年平均温度 $T$（单位：摄氏度）的年度投影矩阵 $A(T)$ 决定。状态向量为 $n(t) = \\begin{pmatrix} J(t) \\\\ A(t) \\end{pmatrix}$，其年度动态遵循 $n(t+1) = A(T)\\,n(t)$，其中\n$$\nA(T) \\;=\\; \\begin{pmatrix}\n0 & F(T) \\\\\nS_{j}(T) & S_{a}(T)\n\\end{pmatrix},\n$$\n$S_{j}(T)$ 是幼体存活至成体阶段的年存活率，$S_{a}(T)$ 是成体年存活率，$F(T)$ 是每个成体的年均新幼体招募数量。在温和的气候范围 $T \\in [5,35]$（摄氏度）内，经验拟合的线性近似值为\n$$\nS_{j}(T) \\;=\\; 0.5 \\;-\\; 0.005\\,(T-20), \\quad\nS_{a}(T) \\;=\\; 0.6 \\;-\\; 0.01\\,(T-20), \\quad\nF(T) \\;=\\; 0.8 \\;-\\; 0.01\\,(T-20).\n$$\n假设时间步长为一年，种群在临界温度下处于平稳状态，且 $A(T)$ 的主特征值 $\\lambda(T)$ 等于长期增殖生长因子。将 $T^{\\star}$（使得 $\\lambda(T^{\\star}) = 1$ 的温度）时的种群瓶颈阶段定义为在该温度下，其存活分量对 $\\lambda$ 具有最大弹性的生命周期阶段。使用参数 $\\theta$ 的弹性标准定义 $e_{\\theta} = (\\theta/\\lambda)\\,(\\partial \\lambda/\\partial \\theta)$，以及矩阵种群模型中已建立的特征值扰动理论。\n\n任务：\n1. 计算临界温度 $T^{\\star}$（单位：摄氏度），使得主特征值满足 $\\lambda(T^{\\star}) = 1$。\n2. 在 $T^{\\star}$ 时，通过比较 $\\lambda$ 对 $S_{j}$ 和 $S_{a}$ 的弹性，确定哪个存活分量构成了种群瓶颈。将瓶颈报告为阶段指数 $k^{\\star}$，其中 $k^{\\star} = 1$ 表示幼体（对 $S_{j}$ 的弹性更大），$k^{\\star} = 2$ 表示成体（对 $S_{a}$ 的弹性更大）。\n\n答案格式：\n- 仅返回行向量 $\\begin{pmatrix} T^{\\star} & k^{\\star} \\end{pmatrix}$。\n- 将 $T^{\\star}$ 四舍五入到三位有效数字。\n- 以摄氏度表示 $T^{\\star}$（在最终的方框答案中不要包含单位）。", "solution": "对问题陈述进行分析后，认定其有效。它基于生态学中的标准工具——矩阵种群模型的原理，具有科学依据。问题是适定的，为求得唯一解提供了所有必要的数据和定义。其表述客观，设定在指定域内是内部一致且物理上合理的。\n\n该问题需要分两步解决：首先，计算种群增长率为1时的临界温度 $T^{\\star}$；其次，通过比较增长率对幼体和成体存活率的弹性，确定在此温度下的种群瓶颈。\n\n种群动态由矩阵方程 $n(t+1) = A(T)n(t)$ 描述，其中投影矩阵为\n$$ A(T) = \\begin{pmatrix} 0 & F(T) \\\\ S_{j}(T) & S_{a}(T) \\end{pmatrix} $$\n长期增殖生长因子是矩阵 $A(T)$ 的主特征值 $\\lambda$。该矩阵的特征方程由 $\\det(A(T) - \\lambda I) = 0$ 得出：\n$$ \\det \\begin{pmatrix} -\\lambda & F(T) \\\\ S_{j}(T) & S_{a}(T) - \\lambda \\end{pmatrix} = (-\\lambda)(S_{a}(T) - \\lambda) - F(T)S_{j}(T) = 0 $$\n$$ \\lambda^{2} - S_{a}(T)\\lambda - F(T)S_{j}(T) = 0 $$\n这是该两阶段模型的欧拉-洛特卡方程。\n\n第1部分：计算临界温度 $T^{\\star}$。\n我们要寻找使种群达到平稳状态的温度 $T^{\\star}$，这对应于 $\\lambda(T^{\\star}) = 1$。将 $\\lambda = 1$ 代入特征方程，得到：\n$$ 1^{2} - S_{a}(T) \\cdot 1 - F(T)S_{j}(T) = 0 \\implies 1 - S_{a}(T) - F(T)S_{j}(T) = 0 $$\n生命率被给出为温度 $T$ 的线性函数：\n$$ S_{j}(T) = 0.5 - 0.005(T-20) $$\n$$ S_{a}(T) = 0.6 - 0.01(T-20) $$\n$$ F(T) = 0.8 - 0.01(T-20) $$\n让我们定义一个偏移温度变量 $\\Delta T = T - 20$。方程变为：\n$$ S_{j}(\\Delta T) = 0.5 - 0.005 \\Delta T $$\n$$ S_{a}(\\Delta T) = 0.6 - 0.01 \\Delta T $$\n$$ F(\\Delta T) = 0.8 - 0.01 \\Delta T $$\n将这些表达式代入平稳条件：\n$$ 1 - (0.6 - 0.01 \\Delta T) - (0.8 - 0.01 \\Delta T)(0.5 - 0.005 \\Delta T) = 0 $$\n$$ 0.4 + 0.01 \\Delta T - (0.8 \\cdot 0.5 - 0.8 \\cdot 0.005 \\Delta T - 0.01 \\Delta T \\cdot 0.5 + 0.01 \\Delta T \\cdot 0.005 \\Delta T) = 0 $$\n$$ 0.4 + 0.01 \\Delta T - (0.4 - 0.004 \\Delta T - 0.005 \\Delta T + 0.00005 (\\Delta T)^{2}) = 0 $$\n$$ 0.4 + 0.01 \\Delta T - 0.4 + 0.009 \\Delta T - 0.00005 (\\Delta T)^{2} = 0 $$\n$$ 0.019 \\Delta T - 0.00005 (\\Delta T)^{2} = 0 $$\n将 $\\Delta T$ 因子提出：\n$$ \\Delta T (0.019 - 0.00005 \\Delta T) = 0 $$\n这个二次方程关于 $\\Delta T$ 有两个解：\n1. $\\Delta T = 0$\n2. $0.019 - 0.00005 \\Delta T = 0 \\implies \\Delta T = \\frac{0.019}{0.00005} = \\frac{19000}{5} = 380$\n\n转换回温度 $T = \\Delta T + 20$：\n1. $T^{\\star} = 0 + 20 = 20$\n2. $T^{\\star} = 380 + 20 = 400$\n\n题目指明该模型在气候范围 $T \\in [5, 35]$ 内有效。第二个解 $T = 400$ 超出此范围。因此，唯一有效的临界温度是 $T^{\\star} = 20$ 摄氏度。四舍五入到三位有效数字为 $20.0$。\n\n第2部分：确定种群瓶颈。\n我们必须在 $T^{\\star} = 20$ 时，比较 $\\lambda$ 对幼体存活率 $S_{j}$ 和成体存活率 $S_{a}$ 的弹性。$\\lambda$ 对矩阵元素 $a_{ij}$ 的弹性由下式给出：\n$$ e_{ij} = \\frac{a_{ij}}{\\lambda} \\frac{\\partial \\lambda}{\\partial a_{ij}} = \\frac{a_{ij}}{\\lambda} \\frac{v_i w_j}{\\langle v, w \\rangle} $$\n其中 $w$ 是右特征向量（稳定阶段分布），$v$ 是左特征向量（繁殖值），$\\langle v, w \\rangle = v^{T}w$ 是它们的标量积。我们在比较 $e_{S_{j}} = e_{21}$ 和 $e_{S_{a}} = e_{22}$。\n\n在 $T^{\\star} = 20$ 时，我们有 $\\Delta T = 0$，所以生命率为：\n$S_{j} = 0.5$, $S_{a} = 0.6$, $F = 0.8$。\n矩阵为 $A(20) = \\begin{pmatrix} 0 & 0.8 \\\\ 0.5 & 0.6 \\end{pmatrix}$ 且 $\\lambda = 1$。\n\n首先，从 $A w = \\lambda w$ 求出右特征向量 $w = \\begin{pmatrix} w_1 \\\\ w_2 \\end{pmatrix}$：\n$$ \\begin{pmatrix} 0 & 0.8 \\\\ 0.5 & 0.6 \\end{pmatrix} \\begin{pmatrix} w_1 \\\\ w_2 \\end{pmatrix} = 1 \\cdot \\begin{pmatrix} w_1 \\\\ w_2 \\end{pmatrix} $$\n这得出了方程组：$0.8 w_2 = w_1$ 和 $0.5 w_1 + 0.6 w_2 = w_2$。该方程组是相容的。选择 $w_2 = 1$，我们得到 $w_1 = 0.8$。所以，$w = \\begin{pmatrix} 0.8 \\\\ 1 \\end{pmatrix}$。\n\n接下来，从 $v^{T}A = \\lambda v^{T}$ 求出左特征向量 $v = \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix}$：\n$$ \\begin{pmatrix} v_1 & v_2 \\end{pmatrix} \\begin{pmatrix} 0 & 0.8 \\\\ 0.5 & 0.6 \\end{pmatrix} = 1 \\cdot \\begin{pmatrix} v_1 & v_2 \\end{pmatrix} $$\n这得出了：$0.5 v_2 = v_1$ 和 $0.8 v_1 + 0.6 v_2 = v_2$。该方程组是相容的。选择 $v_1 = 1$，我们得到 $v_2 = 1/0.5 = 2$。所以，$v = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n\n标量积为 $\\langle v, w \\rangle = v_1 w_1 + v_2 w_2 = (1)(0.8) + (2)(1) = 0.8 + 2 = 2.8$。\n\n现在我们计算弹性。存活分量是 $S_j = a_{21}$ 和 $S_a = a_{22}$。\n幼体存活率 $S_{j}$ 的弹性：\n$$ e_{S_{j}} = e_{21} = \\frac{a_{21} v_2 w_1}{\\lambda \\langle v, w \\rangle} = \\frac{0.5 \\cdot 2 \\cdot 0.8}{1 \\cdot 2.8} = \\frac{0.8}{2.8} = \\frac{8}{28} = \\frac{2}{7} $$\n成体存活率 $S_{a}$ 的弹性：\n$$ e_{S_{a}} = e_{22} = \\frac{a_{22} v_2 w_2}{\\lambda \\langle v, w \\rangle} = \\frac{0.6 \\cdot 2 \\cdot 1}{1 \\cdot 2.8} = \\frac{1.2}{2.8} = \\frac{12}{28} = \\frac{3}{7} $$\n比较这两个值：$e_{S_{a}} = 3/7 > 2/7 = e_{S_{j}}$。\n种群增长率对成体存活率的弹性大于其对幼体存活率的弹性。因此，成体阶段是种群瓶颈。根据题目的索引，这对应于 $k^{\\star} = 2$。\n\n最终答案是行向量 $\\begin{pmatrix} T^{\\star} & k^{\\star} \\end{pmatrix}$。\n$T^{\\star}$ 四舍五入到三位有效数字为 $20.0$。\n$k^{\\star}$ 是 $2$。\n结果是 $\\begin{pmatrix} 20.0 & 2 \\end{pmatrix}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n20.0 & 2\n\\end{pmatrix}\n}\n$$", "id": "2495608"}]}