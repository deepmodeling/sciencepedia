{"hands_on_practices": [{"introduction": "要理解城市气候，核心在于掌握地表能量平衡。这个基本原理如同会计学中的资产负债表，追踪着所有能量的来源与去向。本练习 [@problem_id:2541979] 提供了一个应用能量守恒定律的绝佳实践，模拟了云层消散后能量输入的突然变化。通过计算，你将亲身体验多余的辐射能量如何在加热空气（感热通量 $Q_H$）、蒸发水分（潜热通量 $Q_E$）和被城市建筑材质吸收（储存热通量 $\\Delta Q_S$）之间进行分配，从而加深对这些通量动态相互作用的理解。", "problem": "一个城市微气象学团队在一次云消散后的正午过渡期内，监测一个均质、不透水的市中心区域的地表能量收支。考虑一个控制体积，该体积涵盖城市地表和相邻的冠层，其尺度上湍流通量是空间平均的，并且假定能量收支闭合，水平平流可忽略不计。设各通量分量定义如下：净全波辐射通量 $Q^{\\ast}$；向空气中的湍流感热通量 $Q_{H}$；湍流潜热通量 $Q_{E}$；进入城市结构的蓄存热通量 $\\Delta Q_{S}$；人为热通量 $Q_{F}$；以及水平平流热通量辐合 $Q_{A}$。对该控制体积应用能量守恒定律。\n\n天气状况的阶跃变化使得 $Q^{\\ast}$ 增加了 $\\Delta Q^{\\ast}=+100\\,\\mathrm{W\\,m^{-2}}$。在此期间，由于灌溉控制和植物水分状况的限制，$Q_{E}$ 保持固定在 $50\\,\\mathrm{W\\,m^{-2}}$（因此 $\\Delta Q_{E}=0$）。独立观测表明，由于城市材料相对于先前状态吸收了额外的热量，蓄存热通量增加了 $\\Delta\\left(\\Delta Q_{S}\\right)=+20\\,\\mathrm{W\\,m^{-2}}$。人为热排放保持稳定在 $Q_{F}=10\\,\\mathrm{W\\,m^{-2}}$（因此 $\\Delta Q_{F}=0$），并且平流可忽略不计，因此 $Q_{A}\\approx 0\\,\\mathrm{W\\,m^{-2}}$（因此 $\\Delta Q_{A}=0$）。\n\n假设该控制体积的城市地表能量收支闭合，根据能量守恒定律，确定由此引起的湍流感热通量变化量 $\\Delta Q_{H}$。请用单位 $\\mathrm{W\\,m^{-2}}$ 表示最终结果。无需四舍五入。", "solution": "该问题要求确定一个受到辐射强迫变化的城市控制体积中，湍流感热通量 $\\Delta Q_{H}$ 的变化量。解答源于对该控制体积应用能量守恒原理。\n\n城市环境的地表能量收支将能量来源与能量汇等同起来。对于指定的控制体积，能量平衡方程可表示为：\n$$Q^{\\ast} + Q_{F} + Q_{A} = Q_{H} + Q_{E} + \\Delta Q_{S}$$\n此处，等式左侧的各项代表进入地-气界面的能量输入：\n- $Q^{\\ast}$ 是净全波辐射通量。\n- $Q_{F}$ 是人为热通量。\n- $Q_{A}$ 是水平平流热通量辐合。\n\n等式右侧的各项代表从该界面输出的能量或能量汇：\n- $Q_{H}$ 是进入大气的湍流感热通量。\n- $Q_{E}$ 是湍流潜热通量（蒸散）。\n- $\\Delta Q_{S}$ 是进入城市结构（地面、建筑物）的蓄存热通量。\n\n该问题描述了在气象条件发生阶跃变化后，两个稳态之间的过渡。为了分析系统的响应，我们必须考虑能量收支方程中每一项的变化。对能量平衡方程应用变化算子 $\\Delta$，可得：\n$$\\Delta (Q^{\\ast} + Q_{F} + Q_{A}) = \\Delta (Q_{H} + Q_{E} + \\Delta Q_{S})$$\n根据线性性质，上式可展开为：\n$$\\Delta Q^{\\ast} + \\Delta Q_{F} + \\Delta Q_{A} = \\Delta Q_{H} + \\Delta Q_{E} + \\Delta(\\Delta Q_{S})$$\n问题给出了这些通量分量变化的以下数值：\n- 净全波辐射通量的变化量为 $\\Delta Q^{\\ast} = +100\\,\\mathrm{W\\,m^{-2}}$。\n- 人为热通量是稳定的，这意味着其变化量为零：$\\Delta Q_{F} = 0\\,\\mathrm{W\\,m^{-2}}$。\n- 水平平流据称可忽略不计，因此其变化量也为零：$\\Delta Q_{A} = 0\\,\\mathrm{W\\,m^{-2}}$。\n- 潜热通量被限制为常数，因此其变化量为零：$\\Delta Q_{E} = 0\\,\\mathrm{W\\,m^{-2}}$。\n- 给出了蓄存热通量的增加量。蓄存热通量本身用 $\\Delta Q_{S}$ 表示，因此其变化量为 $\\Delta(\\Delta Q_{S}) = +20\\,\\mathrm{W\\,m^{-2}}$。\n\n将这些指定值代入能量平衡方程的变化形式中：\n$$100\\,\\mathrm{W\\,m^{-2}} + 0\\,\\mathrm{W\\,m^{-2}} + 0\\,\\mathrm{W\\,m^{-2}} = \\Delta Q_{H} + 0\\,\\mathrm{W\\,m^{-2}} + 20\\,\\mathrm{W\\,m^{-2}}$$\n简化后可得：\n$$100\\,\\mathrm{W\\,m^{-2}} = \\Delta Q_{H} + 20\\,\\mathrm{W\\,m^{-2}}$$\n我们现在可以求解未知的湍流感热通量变化量 $\\Delta Q_{H}$：\n$$\\Delta Q_{H} = 100\\,\\mathrm{W\\,m^{-2}} - 20\\,\\mathrm{W\\,m^{-2}}$$\n$$\\Delta Q_{H} = 80\\,\\mathrm{W\\,m^{-2}}$$\n这一结果表明，在来自净辐射的 $100\\,\\mathrm{W\\,m^{-2}}$ 额外能量中，$20\\,\\mathrm{W\\,m^{-2}}$ 被城市结构吸收为增加的蓄存热，而剩余的 $80\\,\\mathrm{W\\,m^{-2}}$ 则作为感热增量转移到大气中，从而加热了城市冠层中的空气。这种能量分配是能量守恒的直接结果。", "answer": "$$\n\\boxed{80}\n$$", "id": "2541979"}, {"introduction": "在掌握了能量平衡的基本原理后，我们可以进一步探讨如何主动调控它以改善城市环境。本练习 [@problem_id:2541981] 聚焦于一种关键的城市热岛缓解策略——提高地表反照率 $(\\alpha)$，例如使用“冷屋顶”技术。通过计算表面反照率改变对净辐射吸收量 $(Q^*)$ 的直接影响，你将获得一个关于材料科学如何具体影响城市微气候的量化认识，并将抽象的物理概念与实际的工程应用联系起来。", "problem": "一座城市建筑对其平屋顶进行改造，使用高反射涂层，将其宽带短波反照率从 $\\alpha_i = 0.15$ 增加到 $\\alpha_f = 0.70$。在晴空条件下的当地太阳正午，屋顶处的向下短波辐照度为 $K_{\\downarrow} = 800\\,\\mathrm{W\\,m^{-2}}$。在改造评估的短时间内，假设向下和向上长波辐照度保持不变，且任何遮蔽或天空视角几何形状的变化都可以忽略不计，因此只有表面反照率发生变化。将表面在短波波段视为朗伯体，并注意反照率即短波反射率。\n\n使用表面辐射平衡的能量守恒原理，确定仅由反照率变化引起的屋顶处全波段净辐射通量 $Q^{\\ast}$ 的减少量。将此减少量报告为吸收短波辐射变化的绝对值，并以 $\\mathrm{W\\,m^{-2}}$ 为单位表示您的最终答案。不要四舍五入；请提供精确值。", "solution": "表面的全波段净辐射通量，记为 $Q^{\\ast}$，由表面辐射平衡方程定义。它是短波净辐射 $K^{\\ast}$ 和长波净辐射 $L^{\\ast}$ 的和。\n$$\nQ^{\\ast} = K^{\\ast} + L^{\\ast}\n$$\n短波净辐射 $K^{\\ast}$ 是向下（入射）短波辐照度 $K_{\\downarrow}$ 与向上（反射）短波辐照度 $K_{\\uparrow}$ 之差。\n$$\nK^{\\ast} = K_{\\downarrow} - K_{\\uparrow}\n$$\n反照率 $\\alpha$ 是被表面反射的向下短波辐照度的比例。因此，向上短波辐照度由下式给出：\n$$\nK_{\\uparrow} = \\alpha K_{\\downarrow}\n$$\n将此代入 $K^{\\ast}$ 的表达式，我们发现短波净辐射等于吸收的短波辐射：\n$$\nK^{\\ast} = K_{\\downarrow} - \\alpha K_{\\downarrow} = (1 - \\alpha) K_{\\downarrow}\n$$\n长波净辐射 $L^{\\ast}$ 是向下长波辐照度 $L_{\\downarrow}$ 和向上长波辐照度 $L_{\\uparrow}$ 之差：\n$$\nL^{\\ast} = L_{\\downarrow} - L_{\\uparrow}\n$$\n结合这些分量，全波段净辐射通量的完整表达式为：\n$$\nQ^{\\ast} = (1 - \\alpha) K_{\\downarrow} + L_{\\downarrow} - L_{\\uparrow}\n$$\n我们必须确定仅由反照率从初始值 $\\alpha_i$ 变为最终值 $\\alpha_f$ 所引起的 $Q^{\\ast}$ 的变化。设 $Q^{\\ast}_i$ 为初始净辐射，$Q^{\\ast}_f$ 为最终净辐射。\n$$\nQ^{\\ast}_i = (1 - \\alpha_i) K_{\\downarrow} + L_{\\downarrow} - L_{\\uparrow}\n$$\n$$\nQ^{\\ast}_f = (1 - \\alpha_f) K_{\\downarrow} + L_{\\downarrow} - L_{\\uparrow}\n$$\n净辐射的变化量 $\\Delta Q^{\\ast}$ 是差值 $Q^{\\ast}_f - Q^{\\ast}_i$。\n$$\n\\Delta Q^{\\ast} = Q^{\\ast}_f - Q^{\\ast}_i = \\left[ (1 - \\alpha_f) K_{\\downarrow} + L_{\\downarrow} - L_{\\uparrow} \\right] - \\left[ (1 - \\alpha_i) K_{\\downarrow} + L_{\\downarrow} - L_{\\uparrow} \\right]\n$$\n根据问题陈述，长波辐射项 ($L_{\\downarrow}$ 和 $L_{\\uparrow}$) 以及向下短波辐照度 ($K_{\\downarrow}$) 是恒定的。因此，长波项相互抵消。\n$$\n\\Delta Q^{\\ast} = (1 - \\alpha_f) K_{\\downarrow} - (1 - \\alpha_i) K_{\\downarrow}\n$$\n提出 $K_{\\downarrow}$：\n$$\n\\Delta Q^{\\ast} = [(1 - \\alpha_f) - (1 - \\alpha_i)] K_{\\downarrow} = (\\alpha_i - \\alpha_f) K_{\\downarrow}\n$$\n问题要求的是全波段净辐射通量的*减少量*，即该变化的绝对值。减少量为 $-\\Delta Q^{\\ast}$。\n$$\n\\text{Reduction} = -\\Delta Q^{\\ast} = -(\\alpha_i - \\alpha_f) K_{\\downarrow} = (\\alpha_f - \\alpha_i) K_{\\downarrow}\n$$\n这个量恰好是吸收的短波辐射的减少量。代入给定值：\n- $\\alpha_i = 0.15$\n- $\\alpha_f = 0.70$\n- $K_{\\downarrow} = 800\\,\\mathrm{W\\,m^{-2}}$\n$$\n\\text{Reduction} = (0.70 - 0.15) \\times 800\\,\\mathrm{W\\,m^{-2}}\n$$\n$$\n\\text{Reduction} = 0.55 \\times 800\\,\\mathrm{W\\,m^{-2}}\n$$\n$$\n\\text{Reduction} = 440\\,\\mathrm{W\\,m^{-2}}\n$$\n屋顶处全波段净辐射通量的减少量为 $440\\,\\mathrm{W\\,m^{-2}}$。", "answer": "$$\n\\boxed{440}\n$$", "id": "2541981"}, {"introduction": "本章的最终实践将带你完成一次从分析单个物理过程到构建综合系统模型的飞跃。这项挑战性任务 [@problem_id:2542051] 要求你将前面练习中涉及的能量平衡、通量分配等原理综合起来，编写一个简化的城市冠层模型 (Urban Canopy Model, UCM)。通过使用合成数据校准模型参数，你不仅将实现复杂的物理过程，还将直面参数估计和“殊途同归” (equifinality) 等真实世界建模中的核心难题，从而架起教科书公式与前沿科研实践之间的桥梁。", "problem": "您的任务是实施并校准一个降阶单层城市冠层模型 (UCM)，用于模拟热浪期间的湍流热通量，该模型使用感热通量 $Q_H$ 和潜热通量 $Q_E$ 的合成涡动协方差观测数据。其目的在于从第一性原理出发，估算城市的空气动力学和地表参数，计算每个通量的模型偏差和均方根误差 (RMSE)，并思考参数的等效性问题。\n\n从地表能量平衡和湍流输送原理出发：\n\n- 地表能量平衡：$R_n = Q_H + Q_E + G + Q_A$，其中 $R_n$ 是净辐射，$G$ 是储存热通量，$Q_A$ 是人为热输入。所有通量的单位均为 $\\mathrm{W}\\,\\mathrm{m}^{-2}$。\n- 潜热通量使用适用于城市整体表面的 Penman–Monteith 公式计算：\n$$Q_E = \\frac{\\Delta \\left(R_n - G - Q_A\\right) + \\rho c_p \\frac{\\mathrm{VPD}}{r_a}}{\\Delta + \\gamma \\left(1 + \\frac{r_s}{r_a}\\right)}$$\n其中 $\\Delta$ 是饱和水汽压曲线相对于温度的斜率，$\\gamma$ 是干湿表常数，$\\rho$ 是空气密度，$c_p$ 是空气定压比热容，$\\mathrm{VPD}$ 是水汽压差，$r_a$ 是空气动力学阻力，$r_s$ 是城市整体表面阻力。\n- 空气动力学阻力通过一个整体输送系数和风速参数化为 $r_a = \\frac{1}{C_H U}$，其中 $C_H$ 是一个无量纲的热量和水分整体输送系数，$U$ 是风速，单位为 $\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n- 储存/地面热通量被参数化为净辐射的固定比例，$G = s R_n$，其中 $s \\in [0,1)$ 是一个无量纲的储存分数，代表城市热储存和传导损失。\n- 感热通量则为 $Q_H = R_n - G - Q_A - Q_E$。\n\n使用以下经过充分检验的物理关系：\n\n- 饱和水汽压（单位 $\\mathrm{Pa}$）作为气温 $T_a$（单位 $\\mathrm{^\\circ C}$）的函数，使用 Tetens 公式计算：\n$$e_s(T_a) = 610.78 \\exp\\!\\left(\\frac{17.2694\\,T_a}{T_a + 237.3}\\right)。$$\n- 在 $T_a$ 处计算的饱和水汽压曲线的斜率（单位 $\\mathrm{Pa}\\,\\mathrm{K}^{-1}$）：\n$$\\Delta(T_a) = \\frac{4098\\,e_s(T_a)}{(T_a + 237.3)^2}。$$\n- 干湿表常数（单位 $\\mathrm{Pa}\\,\\mathrm{K}^{-1}$）：\n$$\\gamma = \\frac{c_p P}{0.622\\,L_v},$$\n其中 $P$ 是气压，$L_v$ 是蒸发潜热。\n- 水汽压差（单位 $\\mathrm{Pa}$），由相对湿度 $\\mathrm{RH}$（小数形式）和 $e_s$ 计算得出：\n$$\\mathrm{VPD} = e_s(T_a)\\,[1-\\mathrm{RH}]。$$\n\n使用的常数：\n- 空气密度 $\\rho = 1.2\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$，\n- 空气比热容 $c_p = 1004\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$，\n- 蒸发潜热 $L_v = 2.45\\times 10^6\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}$，\n- 气压 $P = 101325\\ \\mathrm{Pa}$。\n\n校准任务：\n- 待校准的未知参数为 $\\theta = (C_H, r_s, s, Q_A)$，其取值范围为 \n$$C_H \\in [0.005, 0.05],\\quad r_s \\in [50, 600]\\ \\mathrm{s}\\,\\mathrm{m}^{-1},\\quad s \\in [0.0, 0.6],\\quad Q_A \\in [0, 150]\\ \\mathrm{W}\\,\\mathrm{m}^{-2}。$$\n- 对于每个情景，给定气象学的时间序列 $\\{R_n, T_a, \\mathrm{RH}, U\\}$，使用上述方程计算 $\\{Q_H(\\theta), Q_E(\\theta)\\}$。\n- 通过最小化两个通量的平方误差和来校准 $\\theta$：\n$$J(\\theta) = \\sum_{i=1}^N \\left(Q_H(\\theta)_i - Q_{H,\\mathrm{obs},i}\\right)^2 + \\left(Q_E(\\theta)_i - Q_{E,\\mathrm{obs},i}\\right)^2。$$\n\n观测数据：\n- 合成涡动协方差观测值是由同一模型使用“真实”参数，并加上小的、确定性的测量-模型差异项来确定性地生成的。对于时间指数 $i$（从零开始，用于三角函数的单位为弧度），定义 \n$$\\delta_H(i) = A_H \\cos(i),\\quad \\delta_E(i) = A_E \\sin(2 i),$$\n其中 $A_H = 20$ 且 $A_E = 15$，单位均为 $\\mathrm{W}\\,\\mathrm{m}^{-2}$。于是 \n$$Q_{H,\\mathrm{obs},i} = Q_H(\\theta_{\\mathrm{true}})_i + \\delta_H(i),\\quad Q_{E,\\mathrm{obs},i} = Q_E(\\theta_{\\mathrm{true}})_i + \\delta_E(i)。$$\n三角函数的所有角度必须使用弧度。\n\n测试套件：\n实现您的程序以处理以下三种情景，每种情景代表城市热浪状况的一个不同方面。在所有数组中，条目按时间排序；单位如上所述。下方的每个数字都应按其字面值精确解释。\n\n- 情景1（干燥，中等风速；“理想路径”）：\n    - $R_n = [\\,650,\\,720,\\,800,\\,850,\\,820,\\,780,\\,700,\\,600\\,]$,\n    - $T_a = [\\,36,\\,37,\\,39,\\,41,\\,40,\\,38,\\,37,\\,35\\,]$,\n    - $\\mathrm{RH} = [\\,0.25,\\,0.23,\\,0.20,\\,0.18,\\,0.19,\\,0.22,\\,0.24,\\,0.27\\,]$,\n    - $U = [\\,3.5,\\,3.2,\\,3.0,\\,2.8,\\,3.0,\\,3.3,\\,3.6,\\,3.8\\,]$,\n    - 真实参数 $\\theta_{\\mathrm{true}}^{(1)} = (\\,0.018,\\,220,\\,0.22,\\,60\\,)$。\n- 情景2（干燥，低风速；空气动力学阻力边缘情况）：\n    - $R_n = [\\,700,\\,780,\\,820,\\,840,\\,810,\\,760\\,]$,\n    - $T_a = [\\,38,\\,39,\\,40,\\,41,\\,40,\\,39\\,]$,\n    - $\\mathrm{RH} = [\\,0.30,\\,0.28,\\,0.26,\\,0.24,\\,0.25,\\,0.27\\,]$,\n    - $U = [\\,0.6,\\,0.8,\\,0.9,\\,1.0,\\,0.8,\\,0.7\\,]$,\n    - 真实参数 $\\theta_{\\mathrm{true}}^{(2)} = (\\,0.014,\\,260,\\,0.28,\\,50\\,)$。\n- 情景3（湿热；湿度限制边缘情况）：\n    - $R_n = [\\,600,\\,680,\\,750,\\,780,\\,740,\\,690,\\,620\\,]$,\n    - $T_a = [\\,34,\\,35,\\,36,\\,37,\\,36,\\,35,\\,34\\,]$,\n    - $\\mathrm{RH} = [\\,0.60,\\,0.58,\\,0.55,\\,0.50,\\,0.52,\\,0.55,\\,0.58\\,]$,\n    - $U = [\\,2.5,\\,2.7,\\,2.9,\\,3.0,\\,2.8,\\,2.6,\\,2.4\\,]$,\n    - 真实参数 $\\theta_{\\mathrm{true}}^{(3)} = (\\,0.016,\\,160,\\,0.20,\\,40\\,)$。\n\n需要实现的任务：\n- 对于每个情景 $k \\in \\{1,2,3\\}$：\n    1. 根据给定的气象数据计算 $e_s(T_a)$、$\\Delta(T_a)$、$\\gamma$ 和 $\\mathrm{VPD}$。\n    2. 使用 $\\theta_{\\mathrm{true}}^{(k)}$ 生成 $Q_H$ 和 $Q_E$ 时间序列，然后使用上面定义的确定性差异（$A_H = 20$ 和 $A_E = 15$）构建 $Q_{H,\\mathrm{obs}}$ 和 $Q_{E,\\mathrm{obs}}$。时间指数 $i$ 为 $0,1,2,\\dots,N-1$，三角函数参数以弧度为单位。\n    3. 通过最小化 $J(\\theta)$ 并在边界条件下校准 $\\theta$。\n    4. 使用校准后的 $\\theta$ 计算模型预测值，然后计算每个通量的偏差和 RMSE：\n       $$\\mathrm{bias}(Q_H) = \\frac{1}{N}\\sum_{i=1}^N\\left(Q_H(\\theta)_i - Q_{H,\\mathrm{obs},i}\\right),\\quad \\mathrm{RMSE}(Q_H) = \\sqrt{\\frac{1}{N}\\sum_{i=1}^N\\left(Q_H(\\theta)_i - Q_{H,\\mathrm{obs},i}\\right)^2},$$\n       $$\\mathrm{bias}(Q_E) = \\frac{1}{N}\\sum_{i=1}^N\\left(Q_E(\\theta)_i - Q_{E,\\mathrm{obs},i}\\right),\\quad \\mathrm{RMSE}(Q_E) = \\sqrt{\\frac{1}{N}\\sum_{i=1}^N\\left(Q_E(\\theta)_i - Q_{E,\\mathrm{obs},i}\\right)^2}。$$\n- 讨论提示（在您的解答叙述中解决，而非在代码中）：解释在此校准问题中参数等效性是如何产生的，特别是在能量平衡分配中 $(s, Q_A)$ 之间的权衡，以及在 Penman–Monteith 公式中通过 $r_a$ 在 $(C_H, r_s)$ 之间的权衡。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。该列表应按情景 $1,2,3$ 的顺序，每个情景包含四个浮点数，这些数字按 $[\\,\\mathrm{bias}(Q_H),\\,\\mathrm{RMSE}(Q_H),\\,\\mathrm{bias}(Q_E),\\,\\mathrm{RMSE}(Q_E)\\,]$ 的顺序排列，并四舍五入到三位小数。因此，最后一行必须总共包含 12 个数字，单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}$，例如 $[\\,x_1, x_2, x_3, x_4, x_5, \\dots, x_{12}\\,]$，其中每个 $x_j$ 都是一个小数。", "solution": "所述问题是有效的。它在科学上基于微气象学和环境物理学的既定原理，为数值求解作了良好设定，并具有足够的细节和客观性。所有必需的方程、常数和数据均已提供，且模型公式是内部一致的。我们将进行严谨的求解。\n\n目标是使用感热通量 ($Q_H$) 和潜热通量 ($Q_E$) 的合成观测数据来校准一个简化的城市冠层模型 (UCM)。这包括通过优化进行参数估计，随后使用偏差和均方根误差 (RMSE) 进行模型评估，以及对参数等效性进行批判性分析。\n\n该模型建立在地表能量平衡原理之上：\n$$R_n = Q_H + Q_E + G + Q_A$$\n其中 $R_n$ 是净辐射，$G$ 是地面及储存热通量之和，$Q_A$ 是人为热通量。所有通量的单位均为 $\\mathrm{W}\\,\\mathrm{m}^{-2}$。\n\n湍流通量是耦合的。潜热通量 $Q_E$ 是使用适用于城市整体表面的 Penman-Monteith 方程确定的：\n$$Q_E = \\frac{\\Delta \\left(R_n - G - Q_A\\right) + \\rho c_p \\frac{\\mathrm{VPD}}{r_a}}{\\Delta + \\gamma \\left(1 + \\frac{r_s}{r_a}\\right)}$$\n在此，$\\Delta$ 是饱和水汽压曲线的斜率，$\\gamma$ 是干湿表常数，$\\rho$ 是空气密度，$c_p$ 是空气比热容，$\\mathrm{VPD}$ 是水汽压差，$r_a$ 是空气动力学阻力，$r_s$ 是对水汽输送的整体表面阻力。\n\n其余各项使用标准的简化假设进行参数化。储存热通量取为净辐射的恒定比例 $s$：$G = s R_n$。空气动力学阻力通过整体输送系数 $C_H$ 与风速 $U$ 成反比：$r_a = \\frac{1}{C_H U}$。然后，感热通量 $Q_H$ 作为能量平衡方程的余项计算：\n$$Q_H = R_n(1-s) - Q_A - Q_E$$\n\n气象输入用于计算必要的热力学变量。饱和水汽压 $e_s$ 由 Tetens 公式给出，是气温 $T_a$ (单位 ${}^\\circ\\mathrm{C}$) 的函数：\n$$e_s(T_a) = 610.78 \\exp\\!\\left(\\frac{17.2694\\,T_a}{T_a + 237.3}\\right)$$\n其斜率 $\\Delta$ 是相对于温度的导数：\n$$\\Delta(T_a) = \\frac{4098\\,e_s(T_a)}{(T_a + 237.3)^2}$$\n干湿表常数 $\\gamma$ 是大气属性的函数：\n$$\\gamma = \\frac{c_p P}{0.622\\,L_v}$$\n其中 $P$ 是大气压力，$L_v$ 是蒸发潜热。最终，水汽压差由相对湿度 $\\mathrm{RH}$ (以小数形式) 确定：\n$$\\mathrm{VPD} = e_s(T_a)\\,[1-\\mathrm{RH}]$$\n\n任务的核心是校准参数矢量 $\\theta = (C_H, r_s, s, Q_A)$。这是一个反问题，我们旨在寻找使模型输出与一组观测数据最佳匹配的参数。“最佳匹配”由成本函数 $J(\\theta)$ 的最小值定义，该函数是模型通量与观测通量在长度为 $N$ 的时间序列上的平方误差和 (SSE)：\n$$J(\\theta) = \\sum_{i=0}^{N-1} \\left[ \\left(Q_H(\\theta)_i - Q_{H,\\mathrm{obs},i}\\right)^2 + \\left(Q_E(\\theta)_i - Q_{E,\\mathrm{obs},i}\\right)^2 \\right]$$\n优化必须在基于物理的参数边界条件下进行：$C_H \\in [0.005, 0.05]$，$r_s \\in [50, 600]\\ \\mathrm{s}\\,\\mathrm{m}^{-1}$，$s \\in [0.0, 0.6]$，以及 $Q_A \\in [0, 150]\\ \\mathrm{W}\\,\\mathrm{m}^{-2}$。\n\n此类校准工作的一个关键方面是**参数等效性** (parameter equifinality) 的可能性。当多个不同的参数集 $\\theta$ 产生的模型输出在与观测数据的拟合程度上几乎相同时（即，它们产生同样低的成本函数 $J(\\theta)$ 值），就会出现这种现象。该模型的结构为等效性提供了明确的机制。\n1.  **$s$ 与 $Q_A$ 之间的权衡**：这两个参数都减少了可用于湍流通量的能量，$R_n' = R_n - G - Q_A$。通过代入 $G$ 的参数化表达式，我们得到 $R_n' = R_n(1-s) - Q_A$。很明显，储存分数 $s$ 的增加（这会增加 $G$）可以通过人为热通量 $Q_A$ 的相应减少来补偿，以维持一个几乎恒定的 $R_n'$。例如，如果 $R_n$ 是常数，储存分数增加 $\\Delta s$ 会使可用能量减少 $R_n \\Delta s$。这可以被人为通量减少 $\\Delta Q_A = -R_n \\Delta s$ 来抵消。如果 $R_n$ 的时间序列不能提供足够的可变性来解耦 $s$ 和 $Q_A$ 的影响，优化算法可能会收敛到补偿线上的一系列 $(s, Q_A)$ 对中的任何一个，从而导致等效性。\n2.  **$C_H$ 与 $r_s$ 之间的权衡**：这两个参数通过影响空气动力学和表面阻力，共同控制可用能量在感热和潜热之间的分配。它们的相互作用主要通过 Penman-Monteith 方程分母中的项 $\\gamma(1 + r_s/r_a)$ 体现。代入 $r_a = 1/(C_H U)$，该项变为 $\\gamma(1 + r_s C_H U)$。较大的表面阻力 $r_s$（表示较干的条件）可以部分地被较小的输送系数 $C_H$ 补偿，反之亦然，以产生相似的乘积 $r_s C_H$，从而得到相似的 $Q_E$。这种相互作用是非线性的，并且还涉及到分子项 $\\rho c_p \\mathrm{VPD}/r_a = \\rho c_p \\mathrm{VPD} \\cdot C_H U$，其中 $C_H$ 也出现。在干燥条件下 (高 $r_s$)，$Q_E$ 变小，模型对 $C_H$ 和 $r_s$ 的敏感性都降低，加剧了等效性的可能性。成本函数的结构，即对 $Q_H$ 和 $Q_E$ 的误差赋予同等权重，会影响优化过程偏好哪种权衡。\n\n计算流程如下：对于每个情景，我们首先使用给定的真实参数 $\\theta_{\\mathrm{true}}$ 和指定的确定性差异项生成合成观测值 $Q_{H,\\mathrm{obs}}$ 和 $Q_{E,\\mathrm{obs}}$。然后，采用一种数值优化算法（具体来说，是一种能够处理参数边界的拟牛顿法，如 L-BFGS-B）来找到使 $J(\\theta)$ 最小化的校准参数集 $\\theta_{\\mathrm{cal}}$。使用 $\\theta_{\\mathrm{cal}}$，我们重新计算模型通量，并通过计算问题陈述中定义的偏差和 RMSE 来评估其与观测值的性能。对所有三种情景重复此完整过程。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    实现并校准一个用于模拟湍流热通量的单层城市冠层模型 (UCM)。\n    \"\"\"\n\n    # 物理常数\n    RHO = 1.2  # 空气密度, kg/m^3\n    CP = 1004.0  # 空气比热容, J/kg/K\n    LV = 2.45e6  # 蒸发潜热, J/kg\n    P = 101325.0  # 气压, Pa\n    GAMMA = (CP * P) / (0.622 * LV)  # 干湿表常数, Pa/K\n\n    # 差异项振幅\n    A_H = 20.0  # W/m^2\n    A_E = 15.0  # W/m^2\n\n    # 校准参数边界\n    PARAM_BOUNDS = [\n        (0.005, 0.05),   # C_H\n        (50.0, 600.0),   # r_s (s/m)\n        (0.0, 0.6),      # s\n        (0.0, 150.0)     # Q_A (W/m^2)\n    ]\n\n    # 测试情景\n    scenarios = [\n        {\n            \"Rn\": np.array([650, 720, 800, 850, 820, 780, 700, 600]),\n            \"Ta\": np.array([36, 37, 39, 41, 40, 38, 37, 35]),\n            \"RH\": np.array([0.25, 0.23, 0.20, 0.18, 0.19, 0.22, 0.24, 0.27]),\n            \"U\": np.array([3.5, 3.2, 3.0, 2.8, 3.0, 3.3, 3.6, 3.8]),\n            \"theta_true\": (0.018, 220, 0.22, 60),\n        },\n        {\n            \"Rn\": np.array([700, 780, 820, 840, 810, 760]),\n            \"Ta\": np.array([38, 39, 40, 41, 40, 39]),\n            \"RH\": np.array([0.30, 0.28, 0.26, 0.24, 0.25, 0.27]),\n            \"U\": np.array([0.6, 0.8, 0.9, 1.0, 0.8, 0.7]),\n            \"theta_true\": (0.014, 260, 0.28, 50),\n        },\n        {\n            \"Rn\": np.array([600, 680, 750, 780, 740, 690, 620]),\n            \"Ta\": np.array([34, 35, 36, 37, 36, 35, 34]),\n            \"RH\": np.array([0.60, 0.58, 0.55, 0.50, 0.52, 0.55, 0.58]),\n            \"U\": np.array([2.5, 2.7, 2.9, 3.0, 2.8, 2.6, 2.4]),\n            \"theta_true\": (0.016, 160, 0.20, 40),\n        },\n    ]\n\n    def es_fn(Ta):\n        return 610.78 * np.exp((17.2694 * Ta) / (Ta + 237.3))\n\n    def delta_fn(Ta, es):\n        return (4098.0 * es) / (Ta + 237.3) ** 2\n\n    def compute_fluxes(theta, Rn, Ta, RH, U):\n        \"\"\"计算感热和潜热通量。\"\"\"\n        C_H, r_s, s, Q_A = theta\n        \n        # 计算气象变量\n        es_val = es_fn(Ta)\n        delta = delta_fn(Ta, es_val)\n        vpd = es_val * (1 - RH)\n\n        # 计算模型项\n        G = s * Rn\n        available_energy = Rn - G - Q_A\n        ra = 1.0 / (C_H * U)\n\n        # Penman-Monteith 方程计算 QE\n        numerator = delta * available_energy + (RHO * CP * vpd) / ra\n        denominator = delta + GAMMA * (1 + r_s / ra)\n        Q_E = numerator / denominator\n\n        # 能量平衡余项计算 QH\n        Q_H = available_energy - Q_E\n        \n        return Q_H, Q_E\n\n    all_results = []\n    for scenario in scenarios:\n        met_data = {k: v for k, v in scenario.items() if k != \"theta_true\"}\n        N = len(scenario[\"Rn\"])\n        time_indices = np.arange(N)\n\n        # 1. 生成“真实”通量\n        Q_H_true, Q_E_true = compute_fluxes(scenario[\"theta_true\"], **met_data)\n\n        # 2. 生成带有确定性差异的“观测”通量\n        delta_H = A_H * np.cos(time_indices)\n        delta_E = A_E * np.sin(2 * time_indices)\n        Q_H_obs = Q_H_true + delta_H\n        Q_E_obs = Q_E_true + delta_E\n\n        # 3. 定义用于校准的成本函数\n        def cost_function(theta):\n            Q_H_model, Q_E_model = compute_fluxes(theta, **met_data)\n            sse = np.sum((Q_H_model - Q_H_obs)**2 + (Q_E_model - Q_E_obs)**2)\n            return sse\n\n        # 4. 通过最小化成本函数来校准参数\n        # 初始猜测值：参数空间的中心\n        x0 = np.array([np.mean(b) for b in PARAM_BOUNDS])\n        \n        opt_result = minimize(\n            cost_function,\n            x0,\n            method='L-BFGS-B',\n            bounds=PARAM_BOUNDS\n        )\n        theta_cal = opt_result.x\n\n        # 5. 使用校准后的参数计算通量\n        Q_H_cal, Q_E_cal = compute_fluxes(theta_cal, **met_data)\n\n        # 6. 计算偏差和均方根误差 (RMSE)\n        diff_H = Q_H_cal - Q_H_obs\n        diff_E = Q_E_cal - Q_E_obs\n\n        bias_H = np.mean(diff_H)\n        rmse_H = np.sqrt(np.mean(diff_H**2))\n        bias_E = np.mean(diff_E)\n        rmse_E = np.sqrt(np.mean(diff_E**2))\n\n        all_results.extend([bias_H, rmse_H, bias_E, rmse_E])\n\n    # 按要求的精确格式输出最终结果\n    print(f\"[{','.join(f'{x:.3f}' for x in all_results)}]\")\n\nsolve()\n```", "id": "2542051"}]}