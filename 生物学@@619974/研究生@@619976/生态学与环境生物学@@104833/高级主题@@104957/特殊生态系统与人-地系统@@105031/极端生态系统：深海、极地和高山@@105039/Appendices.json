{"hands_on_practices": [{"introduction": "生物体的新陈代谢速率深受温度影响，在以低温为主要特征的极地和高山生态系统中，这种关系尤为关键。本练习旨在深入探讨 $Q_{10}$ 温度系数，这是一个量化代谢对温度敏感性的核心生态学概念 [@problem_id:2490797]。通过从更基础的阿伦尼乌斯方程出发推导 $Q_{10}$ 的表达式，您将更深刻地理解代谢速率随温度变化的物理化学基础，并探索为何这类简化模型在嗜冷生物所面临的极寒条件下可能会失效。", "problem": "在极地和高山生态系统中，微生物和整个生物体的呼吸速率表现出强烈的温度敏感性。考虑南极海冰中的一个冷适应群落，其呼吸作用遵循与绝对温度的Arrhenius型依赖关系。假设瞬时呼吸速率作为绝对温度 $T_{K}$ (单位为 $\\mathrm{K}$) 的函数，遵循以下公式\n$$\nR(T_{K}) \\;=\\; A\\,\\exp\\!\\left(-\\frac{E_{a}}{R_{\\mathrm{gas}}\\,T_{K}}\\right),\n$$\n其中 $A$ 是指前因子，$E_{a}$ 是表观活化能，$R_{\\mathrm{gas}}$ 是普适气体常数。10度温度系数 $Q_{10}(T)$ 在概念上定义为，从温度 $T_{K}$ 开始，绝对温度增加 $10$ $\\mathrm{K}$ 时速率的倍数变化。\n\n任务：\n1. 从上述的Arrhenius依赖关系和10度温度系数 $Q_{10}(T)$ 的概念性定义出发，推导出 $Q_{10}(T)$ 关于 $E_{a}$、$R_{\\mathrm{gas}}$ 和 $T_{K}$ 的显式表达式。\n2. 运用生物化学动力学和细胞生物物理学的基本原理，陈述一个机理上的原因，解释为何 $Q_{10}$ 概念在与极端极地或高山环境相关的极低温度下可能失效或变得不明确。\n3. 对于一个嗜冷微生物群落，在温度 $T \\,=\\, -1.0\\,^{\\circ}\\mathrm{C}$（因此 $T_{K} \\,=\\, T + 273.15\\,\\mathrm{K}$）、表观活化能 $E_{a} \\,=\\, 60\\,\\mathrm{kJ\\,mol^{-1}}$ 的条件下，使用 $R_{\\mathrm{gas}} \\,=\\, 8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，根据你推导的表达式计算此温度下的 $Q_{10}$ 数值。将你的答案四舍五入到三位有效数字。由于 $Q_{10}$ 是一个比率，它是无量纲的；只报告数值。", "solution": "问题陈述已经过严格验证，并被认为是有效的。它在科学上基于化学动力学和生物物理学的既定原理，定量上是适定的、客观的。它包含了完整解答所需的所有必要信息和一致的参数。我们将按顺序进行这三项任务。\n\n本问题的基础是Arrhenius方程，该方程描述了速率常数的温度依赖性，此处应用于生物速率，即呼吸作用 $R$：\n$$\nR(T_{K}) = A \\exp\\left(-\\frac{E_{a}}{R_{\\mathrm{gas}} T_{K}}\\right)\n$$\n其中 $T_{K}$ 是绝对温度（单位为开尔文），$A$ 是指前因子，$E_{a}$ 是表观活化能，$R_{\\mathrm{gas}}$ 是普适气体常数。\n\n**任务1：推导10度温度系数 $Q_{10}(T)$**\n\n10度温度系数 $Q_{10}$ 在概念上定义为温度升高 $10\\,\\mathrm{K}$ 时速率增加的倍数。在数学上，对于在起始温度 $T_{K}$ 下的速率 $R(T_{K})$，$Q_{10}$ 是温度为 $T_{K} + 10\\,\\mathrm{K}$ 时的速率与温度为 $T_{K}$ 时的速率之比。\n$$\nQ_{10}(T_{K}) = \\frac{R(T_{K} + 10)}{R(T_{K})}\n$$\n我们将给定的呼吸速率的Arrhenius表达式代入此定义。\n温度为 $T_{K} + 10$ 时的速率是：\n$$\nR(T_{K} + 10) = A \\exp\\left(-\\frac{E_{a}}{R_{\\mathrm{gas}} (T_{K} + 10)}\\right)\n$$\n温度为 $T_{K}$ 时的速率是：\n$$\nR(T_{K}) = A \\exp\\left(-\\frac{E_{a}}{R_{\\mathrm{gas}} T_{K}}\\right)\n$$\n现在，我们构建这个比率：\n$$\nQ_{10}(T_{K}) = \\frac{A \\exp\\left(-\\frac{E_{a}}{R_{\\mathrm{gas}} (T_{K} + 10)}\\right)}{A \\exp\\left(-\\frac{E_{a}}{R_{\\mathrm{gas}} T_{K}}\\right)}\n$$\n指前因子 $A$ 被消去。利用指数性质 $\\frac{\\exp(x)}{\\exp(y)} = \\exp(x-y)$，我们得到：\n$$\nQ_{10}(T_{K}) = \\exp\\left( -\\frac{E_{a}}{R_{\\mathrm{gas}} (T_{K} + 10)} - \\left(-\\frac{E_{a}}{R_{\\mathrm{gas}} T_{K}}\\right) \\right)\n$$\n$$\nQ_{10}(T_{K}) = \\exp\\left( \\frac{E_{a}}{R_{\\mathrm{gas}} T_{K}} - \\frac{E_{a}}{R_{\\mathrm{gas}} (T_{K} + 10)} \\right)\n$$\n我们可以提出公因子 $\\frac{E_{a}}{R_{\\mathrm{gas}}}$：\n$$\nQ_{10}(T_{K}) = \\exp\\left( \\frac{E_{a}}{R_{\\mathrm{gas}}} \\left(\\frac{1}{T_{K}} - \\frac{1}{T_{K} + 10}\\right) \\right)\n$$\n为简化括号中的表达式，我们通分：\n$$\n\\frac{1}{T_{K}} - \\frac{1}{T_{K} + 10} = \\frac{(T_{K} + 10) - T_{K}}{T_{K}(T_{K} + 10)} = \\frac{10}{T_{K}(T_{K} + 10)}\n$$\n将此结果代回 $Q_{10}(T_{K})$ 的表达式，得到最终的显式形式：\n$$\nQ_{10}(T_{K}) = \\exp\\left( \\frac{10 E_{a}}{R_{\\mathrm{gas}} T_{K} (T_{K} + 10)} \\right)\n$$\n这就是所要求的 $Q_{10}$ 作为 $E_{a}$、$R_{\\mathrm{gas}}$ 和 $T_{K}$ 函数的表达式。\n\n**任务2：$Q_{10}$ 概念在低温下失效的机理原因**\n\nArrhenius模型，以及由其引申出的 $Q_{10}$ 概念，其根本假设是活化能 $E_{a}$ 在所关注的温度范围内是恒定的。在生物系统中，由于细胞基质的相变，这个假设在极低温度下会失效。一个主要的机理原因是温度诱导的细胞膜相变。\n\n在生理温度下，细胞膜处于液晶态，这为嵌入其中的酶和转运蛋白的正常功能提供了所需的流动性。随着温度降低，细胞膜会经历相变，转变为更为刚性的凝胶态。这个转变不是渐进的；它发生在一个狭窄的温度范围内，并从根本上改变了膜相关蛋白（包括许多参与呼吸作用的蛋白）的物理环境。\n\n这种相变使得 $E_{a}$ 恒定的假设失效。膜结合酶促反应的活化能在液晶相和凝胶相中是不同的。因此，Arrhenius图（$\\ln(R)$ 对 $1/T_{K}$）将不是一条直线，而是在相变温度处显示出明显的“断点”或斜率变化。由于 $Q_{10}$ 的推导假设 $E_{a}$ 是单一且恒定的，因此在跨越这个相变温度时，该概念变得不明确，或者至少是高度可变的。随着细胞膜固化并严重限制酶的构象变化和底物扩散，反应速率可能会急剧下降，其方式是简单的 $Q_{10}$ 因子无法描述的。\n\n**任务3：$Q_{10}$ 的数值计算**\n\n给定以下参数：\n- 温度 $T = -1.0\\,^{\\circ}\\mathrm{C}$。\n- 活化能 $E_{a} = 60\\,\\mathrm{kJ\\,mol^{-1}}$。\n- 普适气体常数 $R_{\\mathrm{gas}} = 8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。\n\n首先，我们必须使用一致的单位。绝对温度 $T_{K}$（单位为开尔文）是：\n$$\nT_{K} = -1.0 + 273.15 = 272.15\\,\\mathrm{K}\n$$\n活化能必须从千焦耳转换为焦耳：\n$$\nE_{a} = 60\\,\\mathrm{kJ\\,mol^{-1}} = 60 \\times 10^{3}\\,\\mathrm{J\\,mol^{-1}} = 60000\\,\\mathrm{J\\,mol^{-1}}\n$$\n现在，我们使用推导出的 $Q_{10}(T_{K})$ 表达式：\n$$\nQ_{10}(T_{K}) = \\exp\\left( \\frac{10 E_{a}}{R_{\\mathrm{gas}} T_{K} (T_{K} + 10)} \\right)\n$$\n我们将数值代入指数函数的参数中：\n$$\n\\frac{10 E_{a}}{R_{\\mathrm{gas}} T_{K} (T_{K} + 10)} = \\frac{10 \\times 60000\\,\\mathrm{J\\,mol^{-1}}}{(8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}) \\times (272.15\\,\\mathrm{K}) \\times (272.15 + 10)\\,\\mathrm{K}}\n$$\n$$\n= \\frac{600000}{8.314 \\times 272.15 \\times 282.15}\n$$\n我们来计算分母：\n$$\n8.314 \\times 272.15 \\times 282.15 \\approx 638510.8\n$$\n现在指数的参数是：\n$$\n\\frac{600000}{638510.8} \\approx 0.939686\n$$\n最后，我们计算 $Q_{10}$：\n$$\nQ_{10}(272.15\\,\\mathrm{K}) = \\exp(0.939686) \\approx 2.55916\n$$\n题目要求答案四舍五入到三位有效数字。\n$$\nQ_{10} \\approx 2.56\n$$\n这个无量纲值表明，对于在 $-1.0\\,^{\\circ}\\mathrm{C}$ 下的这个特定微生物群落，温度升高 $10\\,\\mathrm{K}$ 将导致呼吸速率增加约 $2.56$ 倍。", "answer": "$$\\boxed{\\begin{pmatrix} \\exp\\left(\\frac{10 E_{a}}{R_{\\mathrm{gas}} T_{K} (T_{K} + 10)}\\right) & 2.56 \\end{pmatrix}}$$", "id": "2490797"}, {"introduction": "在极端环境中生存不仅依赖于生理耐受性，更取决于应对环境不可预测性的演化对策。本练习以高山草甸多变的融雪时间为背景，介绍了“风险对冲”（bet-hedging）这一重要的生命史策略 [@problem_id:2490726]。您将通过最大化长期几何平均适合度来推导最优的种子萌发比例，从而亲身实践并理解种群如何在充满不确定性的环境中通过演化策略得以延续。", "problem": "在融雪时间高度可变的高山草甸中，一年生种子的萌发可能导致高补充量（当雪早融化时），也可能导致灾难性的失败（当雪晚融化时）。考虑一种拥有种子库的植物，其种子面临两种随时间独立同分布的环境年份类型：融雪早的“好”年份，概率为 $p$；以及融雪晚的“坏”年份，概率为 $1-p$。在任何给定的年份，有固定比例 $g \\in [0,1]$ 的种子萌发，而剩余的比例 $(1-g)$ 保持休眠。休眠的种子在种子库中以概率 $s$ 存活到下一年。萌发的种子在年末为种子库贡献 $R$ 粒存活种子，其中在好年份 $R = R_{G}$，在坏年份 $R = R_{B}$。假设没有密度依赖性，并且所有种子的行为都相同。\n\n从种群跨年份增长的乘法性质出发（即，如果 $N_t$ 是第 $t$ 年初的存活种子数量，则 $N_{t+1} = W_t N_t$，其中 $W_t$ 是某个随机的年增长因子），从第一性原理推导出选择 $g$ 的合适的长期适应度准则。明确对比算术平均值准则（该准则最大化预期的一年期回报）与几何平均值准则（该准则最大化多年期的长期人均增长率）。然后，利用这些原理，推导出描述最优萌发率 $g^{\\ast}$ 的一阶条件，该萌发率在上述双状态环境下能最大化长期增长。\n\n最后，对于参数值 $p = 0.6$， $R_{G} = 10$， $R_{B} = 0.1$ 和 $s = 0.5$，计算最优萌发率 $g^{\\ast}$。将最终答案表示为四舍五入到四位有效数字的单个十进制数。不要包含单位。", "solution": "所提出的问题是种群生物学领域中一个定义明确且有科学依据的练习，具体涉及随机环境下的生活史策略。它是“风险对冲”（bet-hedging）理论的一个经典例子。该问题是有效的，并存在唯一解。\n\n首先，我们必须推导出年乘法增长因子 $W_t$ 的表达式。设 $N_t$ 为第 $t$ 年初种子库中的存活种子数量。这些种子中有比例 $g$ 萌发，所以有 $gN_t$ 粒种子萌发。剩余的比例 $(1-g)$ 留在种子库中休眠，所以有 $(1-g)N_t$ 粒种子休眠。\n\n萌发的种子 $gN_t$ 以每粒 $R_t$ 的速率产生新种子，其中 $R_t$ 是代表第 $t$ 年环境条件的随机变量。产生的新种子总数为 $gN_t R_t$。\n\n休眠的种子 $(1-g)N_t$ 以概率 $s$ 存活到下一年。因此，存活的休眠种子数量为 $s(1-g)N_t$。\n\n下一年初的种子总数 $N_{t+1}$ 是新产生的种子和存活的休眠种子的总和：\n$$N_{t+1} = gN_t R_t + s(1-g)N_t$$\n提出 $N_t$ 后，我们得到问题陈述中给出的关系式 $N_{t+1} = W_t N_t$，其中年乘法增长因子 $W_t$ 为：\n$$W_t = gR_t + s(1-g)$$\n这个因子是一个随机变量，因为 $R_t$ 是随机的。在一个“好”年份（以概率 $p$ 发生），$R_t = R_G$，增长因子为 $W_G = gR_G + s(1-g)$。在一个“坏”年份（以概率 $(1-p)$ 发生），$R_t = R_B$，增长因子为 $W_B = gR_B + s(1-g)$。\n\n问题要求对比选择萌发率 $g$ 的两种适应度准则。\n\n第一个准则是算术平均值，它试图最大化预期的一年期增长因子 $E[W_t]$。期望是在可能的环境状态上计算的：\n$$E[W_t] = p W_G + (1-p) W_B$$\n$$E[W_t] = p(gR_G + s(1-g)) + (1-p)(gR_B + s(1-g))$$\n$$E[W_t] = g(p R_G + (1-p) R_B) + s(1-g) = g E[R] + s(1-g)$$\n这个表达式是关于 $g$ 的线性函数。最大化此函数会导致一个角点解：如果 $E[R] > s$，最大值在 $g=1$ 处取得；如果 $E[R] < s$，最大值在 $g=0$ 处取得。这种“全有或全无”的策略不适合种群的长期持续生存。它忽略了增长的乘法、复利性质，即在某一年份中一个非常低的增长因子（例如，$W_B$ 接近于0）就可能导致准灭绝，而无论算术平均值有多高。\n\n在随机、乘法环境中，衡量长期适应度的正确准则是几何平均增长率。$T$ 年后的种群大小为 $N_T = N_0 \\prod_{t=0}^{T-1} W_t$。长期人均增长率为 $\\lambda = \\lim_{T \\to \\infty} (N_T/N_0)^{1/T}$。对此表达式取对数，得到对数增长率 $\\ln(\\lambda)$：\n$$\\ln(\\lambda) = \\lim_{T \\to \\infty} \\frac{1}{T} \\sum_{t=0}^{T-1} \\ln(W_t)$$\n根据强大数定律，由于年份类型是独立同分布的，这个时间平均值收敛于 $\\ln(W_t)$ 的期望值：\n$$\\ln(\\lambda) = E[\\ln(W_t)]$$\n最大化长期增长率 $\\lambda$ 等价于最大化其对数 $E[\\ln(W_t)]$。这是合适的适应度准则，因为它正确地考虑了好年份和坏年份的复利效应，并惩罚了那些方差高、有灾难性下降风险的策略。\n\n最优萌发率 $g^*$ 是使这个长期对数增长率最大化的 $g$ 值。我们定义目标函数 $L(g) = E[\\ln(W_t)]$：\n$$L(g) = p \\ln(W_G) + (1-p) \\ln(W_B)$$\n$$L(g) = p \\ln(gR_G + s(1-g)) + (1-p) \\ln(gR_B + s(1-g))$$\n为找到最优的 $g^*$，我们通过对 $L(g)$ 关于 $g$ 求导并令其为零，即 $\\frac{dL}{dg} = 0$，来找到一阶条件。使用链式法则求导：\n$$\\frac{dL}{dg} = p \\frac{\\frac{d}{dg}(gR_G + s(1-g))}{gR_G + s(1-g)} + (1-p) \\frac{\\frac{d}{dg}(gR_B + s(1-g))}{gR_B + s(1-g)}$$\n$$\\frac{dL}{dg} = p \\frac{R_G - s}{gR_G + s(1-g)} + (1-p) \\frac{R_B - s}{gR_B + s(1-g)} = 0$$\n这个方程是隐式定义了最优萌发率 $g^*$ 的一阶条件。\n\n最后，我们为给定的参数值计算 $g^*$：$p = 0.6$，$R_G = 10$，$R_B = 0.1$ 和 $s = 0.5$。\n我们将这些值代入一阶条件中：\n$$(0.6) \\frac{10 - 0.5}{g(10) + (0.5)(1-g)} + (1-0.6) \\frac{0.1 - 0.5}{g(0.1) + (0.5)(1-g)} = 0$$\n$$\\frac{0.6(9.5)}{10g + 0.5 - 0.5g} + \\frac{0.4(-0.4)}{0.1g + 0.5 - 0.5g} = 0$$\n$$\\frac{5.7}{9.5g + 0.5} - \\frac{0.16}{-0.4g + 0.5} = 0$$\n为了解出 $g$，我们重排方程：\n$$\\frac{5.7}{9.5g + 0.5} = \\frac{0.16}{-0.4g + 0.5}$$\n交叉相乘得到一个关于 $g$ 的线性方程：\n$$5.7(-0.4g + 0.5) = 0.16(9.5g + 0.5)$$\n$$-2.28g + 2.85 = 1.52g + 0.08$$\n现在，我们求解 $g$：\n$$2.85 - 0.08 = 1.52g + 2.28g$$\n$$2.77 = 3.8g$$\n$$g^* = \\frac{2.77}{3.8} \\approx 0.728947368...$$\n四舍五入到四位有效数字，最优萌发率为 $0.7289$。这个内部解表明，最优策略是一种风险对冲形式，即并非所有种子都萌发，从而在不可预测的坏年份中缓冲种群免于灾难性失败。", "answer": "$$\\boxed{0.7289}$$", "id": "2490726"}, {"introduction": "极端生态系统的研究常常只能获得稀疏且充满噪声的数据，这为得出稳健的科学结论带来了挑战。这个前沿的实践练习将向您介绍贝叶斯分层模型，它是一个整合此类信息的强大统计框架 [@problem_id:2490768]。通过为来自不同极端生境（如深海、极地、高山）的微生物生长速率构建模型，您将学习如何通过“部分池化”（partial pooling）来稳定参数估计并进行预测，从而掌握现代定量生态学的一项核心技能。", "problem": "您正在研究多个地点（深海、极地、高山和热液喷口）的极端生态系统中微生物种群的对数增长。每个地点​​的观测数据稀疏且伴有噪声，您希望估计地点级别的真实对数增长率，同时允许跨地点进行部分池化以稳定估计值。您将使用一个贝叶斯分层正态模型对数据进行建模，该模型具有已知的观测方差和地点间方差，以实现闭式推断。\n\n基本原理：\n- 用于更新概率分布的贝叶斯法则以及共轭的定义。\n- 正态分布及其在线性变换和边缘化下的性质。\n- 当组级先验连接相关参数时，分层模型会引导收缩（部分池化）的原理。\n- 在给定参数的条件下，重复观测的独立性。\n\n数据：\n- 地点和观测值（每天的自然对数增长）如下：\n  - 深海：$y_{\\mathrm{DS}} = \\{-0.12,-0.05,0.00\\}$\n  - 极地：$y_{\\mathrm{PL}} = \\{0.02\\}$\n  - 高山：$y_{\\mathrm{AL}} = \\{0.15,0.10\\}$\n  - 热液喷口：$y_{\\mathrm{HV}} = \\{0.30,0.28,0.35,0.40\\}$\n- 令 $n_i$ 表示地点 $i$ 的观测次数，$\\bar{y}_i$ 表示地点 $i$ 的样本均值。\n\n需要实现的模型规范：\n- 似然函数：对于地点 $i$ 和重复观测 $j$，$y_{i,j} \\mid \\theta_i \\sim \\mathcal{N}(\\theta_i,\\sigma^2)$，其中 $\\sigma^2$ 已知。\n- 地点级效应：$\\theta_i \\mid \\mu \\sim \\mathcal{N}(\\mu,\\tau^2)$，其中 $\\tau^2$ 已知。\n- 超先验：$\\mu \\sim \\mathcal{N}(m_0,s_0^2)$，其中 $m_0$ 和 $s_0^2$ 已知。\n\n任务：\n- 仅使用上述基本原理，不引入任何快捷公式，推导一个正确的算法来计算给定所有地点数据下全局均值 $\\mu$ 的后验分布，然后计算以下情况的后验预测分布：\n  - 在一个已有地点 $i$ 的未来观测值。\n  - 在一个全新的、之前未观测过的地点的未来观测值。\n- 将所有最终的预测摘要表示为后验预测正态分布的均值和标准差。\n\n角度和物理单位：\n- 所有增长值都以每天的自然对数为单位。将所有数值输出表示为不带任何单位符号的纯数字。\n- 不涉及角度。\n\n测试套件：\n- 在所有情况下均使用上述固定数据集。对于每个测试，计算指定查询的后验预测均值和标准差。\n- 参数以元组 $(m_0,s_0^2,\\tau^2,\\sigma^2,\\text{query})$ 的形式给出，其中 `query` 是现有地点代码 $\\{\\mathrm{DS},\\mathrm{PL},\\mathrm{AL},\\mathrm{HV}\\}$ 中的一个，或者是代表新地点的字符串 $\\mathrm{NEW}$。测试套件如下：\n  - 测试 $1$： $(0.05,0.10,0.05,0.04,\\mathrm{AL})$。\n  - 测试 $2$： $(0.05,0.10,0.05,0.25,\\mathrm{PL})$。\n  - 测试 $3$： $(0.05,0.10,1000.0,0.04,\\mathrm{HV})$。\n  - 测试 $4$： $(0.00,0.01,0.02,0.09,\\mathrm{NEW})$。\n\n要求的最终输出格式：\n- 您的程序必须按照上述测试的顺序，计算每个测试的后验预测均值和标准差，并四舍五入到 $6$ 位小数。\n- 程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，格式为 $[\\text{mean}_1,\\text{sd}_1,\\text{mean}_2,\\text{sd}_2,\\text{mean}_3,\\text{sd}_3,\\text{mean}_4,\\text{sd}_4]$，不含空格。\n- 程序必须是自包含的，不得读取任何输入，也不得访问任何外部资源。", "solution": "所述问题具有科学依据、适定、客观，并包含足够的信息以得到唯一解。它描述了一个具有已知方差的标准贝叶斯分层模型，这是统计分析中一种常用且有效的技术。任务是推导和计算后验分布和后验预测分布，这是贝叶斯推断中的一个基本练习。因此，该问题被认为是有效的。\n\n对每个地点 $i \\in \\{\\mathrm{DS}, \\mathrm{PL}, \\mathrm{AL}, \\mathrm{HV}\\}$，分层模型的规范如下：\n\\begin{enumerate}\n    \\item 全局平均对数增长率 $\\mu$ 的超先验：$\\mu \\sim \\mathcal{N}(m_0, s_0^2)$。\n    \\item 地点特定真实对数增长率 $\\theta_i$ 的先验：$\\theta_i \\mid \\mu \\sim \\mathcal{N}(\\mu, \\tau^2)$。\n    \\item 地点 $i$ 的观测对数增长数据 $y_{i,j}$ 的似然函数：$y_{i,j} \\mid \\theta_i \\sim \\mathcal{N}(\\theta_i, \\sigma^2)$。\n\\end{enumerate}\n所有方差 $\\sigma^2$、$\\tau^2$ 和 $s_0^2$ 以及超均值 $m_0$ 均为已知常数。在给定 $\\theta_i$ 的条件下，地点 $i$ 的观测值 $\\{y_{i,j}\\}$ (其中 $j=1, \\dots, n_i$) 是条件独立的。样本均值 $\\bar{y}_i = \\frac{1}{n_i} \\sum_{j=1}^{n_i} y_{i,j}$ 是 $\\theta_i$ 的一个充分统计量。样本均值的分布为 $\\bar{y}_i \\mid \\theta_i \\sim \\mathcal{N}(\\theta_i, \\sigma^2/n_i)$。我们用 $\\mathbf{y}$ 表示来自所有地点的所有数据的集合。\n\n我们的推导分三步进行：首先，我们求出全局均值 $\\mu$ 的后验分布；其次，我们求出在现有地点进行一次观测的后验预测分布；第三，我们求出在新地点进行一次观测的后验预测分布。\n\n**1. 全局均值 $\\mu$ 的后验分布**\n\n为了求后验分布 $p(\\mu | \\mathbf{y})$，我们应用贝叶斯法则：$p(\\mu | \\mathbf{y}) \\propto p(\\mathbf{y} | \\mu) p(\\mu)$。来自不同地点的数据在给定 $\\mu$ 的条件下是独立的，因此 $p(\\mathbf{y} | \\mu) = \\prod_i p(\\mathbf{y}_i | \\mu)$。我们可以使用地点级别的样本均值，所以 $p(\\mathbf{y}_i | \\mu) = p(\\bar{y}_i | \\mu)$。\n\n我们通过对潜变量 $\\theta_i$ 进行积分来求出给定 $\\mu$ 时 $\\bar{y}_i$ 的边缘分布：\n$$p(\\bar{y}_i | \\mu) = \\int p(\\bar{y}_i | \\theta_i) p(\\theta_i | \\mu) d\\theta_i$$\n这是两个正态分布的卷积：$\\bar{y}_i \\mid \\theta_i \\sim \\mathcal{N}(\\theta_i, \\sigma^2/n_i)$ 和 $\\theta_i \\mid \\mu \\sim \\mathcal{N}(\\mu, \\tau^2)$。结果分布也是正态分布，其均值等于均值之和，方差等于方差之和：\n$$\\bar{y}_i \\mid \\mu \\sim \\mathcal{N}(\\mu, \\tau^2 + \\sigma^2/n_i)$$\n现在，我们来求 $\\mu$ 的后验分布。\n$$p(\\mu | \\mathbf{y}) \\propto p(\\mu) \\prod_{i=1}^k p(\\bar{y}_i | \\mu)$$\n这是正态概率密度函数的乘积。$\\mu$ 的后验分布也将是正态的，我们设其为 $\\mu \\mid \\mathbf{y} \\sim \\mathcal{N}(m_k, s_k^2)$。我们可以通过在对数后验的指数部分进行配方来找到其参数。忽略一个加法常数，对数后验为：\n$$\\log p(\\mu | \\mathbf{y}) \\propto -\\frac{1}{2} \\left( \\frac{(\\mu - m_0)^2}{s_0^2} + \\sum_{i=1}^k \\frac{(\\mu - \\bar{y}_i)^2}{\\tau^2 + \\sigma^2/n_i} \\right)$$\n括号中项里 $\\mu^2$ 的系数是 $(\\frac{1}{s_0^2} + \\sum_i \\frac{1}{\\tau^2+\\sigma^2/n_i})$。这给出了后验精度（方差的倒数）：\n$$\\frac{1}{s_k^2} = \\frac{1}{s_0^2} + \\sum_{i=1}^k \\frac{1}{\\tau^2 + \\sigma^2/n_i}$$\n$\\mu$ 的系数是 $-2(\\frac{m_0}{s_0^2} + \\sum_i \\frac{\\bar{y}_i}{\\tau^2+\\sigma^2/n_i})$。这使我们能够找到后验均值：\n$$m_k = s_k^2 \\left( \\frac{m_0}{s_0^2} + \\sum_{i=1}^k \\frac{\\bar{y}_i}{\\tau^2 + \\sigma^2/n_i} \\right)$$\n因此，我们推导出了后验分布 $p(\\mu|\\mathbf{y}) = \\mathcal{N}(m_k, s_k^2)$。\n\n**2. 现有地点的后验预测分布**\n\n令 $y_{\\text{new},i}$ 为现有地点 $i$ 的一个未来观测值。其后验预测分布通过对参数 $\\theta_i$ 和 $\\mu$ 的联合后验进行积分得到：\n$$p(y_{\\text{new},i} | \\mathbf{y}) = \\iint p(y_{\\text{new},i} | \\theta_i) p(\\theta_i, \\mu | \\mathbf{y}) d\\theta_i d\\mu = \\int p(\\mu | \\mathbf{y}) \\left( \\int p(y_{\\text{new},i} | \\theta_i) p(\\theta_i | \\mu, \\mathbf{y}) d\\theta_i \\right) d\\mu$$\n给定 $\\mu$ 和数据 $\\mathbf{y}$ 时，$\\theta_i$ 的后验只依赖于地点 $i$ 的数据 $\\bar{y}_i$：$p(\\theta_i | \\mu, \\mathbf{y}) = p(\\theta_i | \\mu, \\bar{y}_i)$。这个后验是通过贝叶斯法则，结合先验 $\\theta_i \\mid \\mu \\sim \\mathcal{N}(\\mu, \\tau^2)$ 和似然 $\\bar{y}_i \\mid \\theta_i \\sim \\mathcal{N}(\\theta_i, \\sigma^2/n_i)$ 求得的。这得到 $\\theta_i \\mid \\mu, \\bar{y}_i \\sim \\mathcal{N}(\\mu_{\\theta_i}, \\sigma^2_{\\theta_i})$，其中：\n$$\\sigma^2_{\\theta_i} = \\left(\\frac{1}{\\tau^2} + \\frac{n_i}{\\sigma^2}\\right)^{-1}$$\n$$\\mu_{\\theta_i} = \\sigma^2_{\\theta_i} \\left(\\frac{\\mu}{\\tau^2} + \\frac{n_i \\bar{y}_i}{\\sigma^2}\\right)$$\n内部积分是 $y_{\\text{new},i} | \\theta_i \\sim \\mathcal{N}(\\theta_i, \\sigma^2)$ 和 $\\theta_i \\mid \\mu, \\bar{y}_i$ 的卷积。这得到 $y_{\\text{new},i} \\mid \\mu, \\mathbf{y} \\sim \\mathcal{N}(\\mu_{\\theta_i}, \\sigma^2 + \\sigma^2_{\\theta_i})$。\n最终的预测分布是正态分布。其均值和方差使用全期望定律和全方差定律求得。均值为：\n$$E[y_{\\text{new},i} | \\mathbf{y}] = E_{\\mu|\\mathbf{y}}[\\mu_{\\theta_i}] = E_{\\mu|\\mathbf{y}}\\left[\\sigma^2_{\\theta_i} \\left(\\frac{\\mu}{\\tau^2} + \\frac{n_i \\bar{y}_i}{\\sigma^2}\\right)\\right] = \\sigma^2_{\\theta_i} \\left(\\frac{m_k}{\\tau^2} + \\frac{n_i \\bar{y}_i}{\\sigma^2}\\right)$$\n方差为：\n$$\\text{Var}(y_{\\text{new},i} | \\mathbf{y}) = E_{\\mu|\\mathbf{y}}[\\sigma^2 + \\sigma^2_{\\theta_i}] + \\text{Var}_{\\mu|\\mathbf{y}}[\\mu_{\\theta_i}]$$\n$$= (\\sigma^2 + \\sigma^2_{\\theta_i}) + \\text{Var}_{\\mu|\\mathbf{y}}\\left[ \\sigma^2_{\\theta_i} \\frac{\\mu}{\\tau^2} \\right] = (\\sigma^2 + \\sigma^2_{\\theta_i}) + \\left(\\frac{\\sigma^2_{\\theta_i}}{\\tau^2}\\right)^2 s_k^2$$\n我们定义 $C_i = \\sigma^2_{\\theta_i} / \\tau^2 = \\frac{(\\frac{1}{\\tau^2} + \\frac{n_i}{\\sigma^2})^{-1}}{\\tau^2} = \\frac{\\sigma^2}{n_i \\tau^2 + \\sigma^2}$。那么预测均值为 $(1-C_i)\\bar{y}_i + C_i m_k$。预测标准差为 $\\sqrt{\\sigma^2 + \\sigma^2_{\\theta_i} + C_i^2 s_k^2}$。\n\n**3. 新地点的后验预测分布**\n\n对于一个新地点，我们有一个新参数 $\\theta_{\\text{new}} \\sim \\mathcal{N}(\\mu, \\tau^2)$ 和一个新观测值 $y_{\\text{new}} \\sim \\mathcal{N}(\\theta_{\\text{new}}, \\sigma^2)$。预测分布为：\n$$p(y_{\\text{new}} | \\mathbf{y}) = \\iint p(y_{\\text{new}} | \\theta_{\\text{new}}) p(\\theta_{\\text{new}} | \\mu) p(\\mu | \\mathbf{y}) d\\theta_{\\text{new}} d\\mu$$\n内部积分 $\\int p(y_{\\text{new}} | \\theta_{\\text{new}}) p(\\theta_{\\text{new}} | \\mu) d\\theta_{\\text{new}}$ 描述了给定 $\\mu$ 时 $y_{\\text{new}}$ 的边缘分布。这是两个正态分布的卷积，结果为 $y_{\\text{new}} \\mid \\mu \\sim \\mathcal{N}(\\mu, \\tau^2 + \\sigma^2)$。\n外部积分现在变为 $\\int \\mathcal{N}(y_{\\text{new}} | \\mu, \\tau^2 + \\sigma^2) \\mathcal{N}(\\mu | m_k, s_k^2) d\\mu$。这是另一次卷积，得到最终的预测分布，该分布也是正态的。\n预测均值是条件均值的期望：$E[y_{\\text{new}} | \\mathbf{y}] = E_{\\mu|\\mathbf{y}}[\\mu] = m_k$。\n预测方差是方差之和（根据全方差定律）：\n$$\\text{Var}(y_{\\text{new}} | \\mathbf{y}) = E_{\\mu|\\mathbf{y}}[\\tau^2 + \\sigma^2] + \\text{Var}_{\\mu|\\mathbf{y}}[\\mu] = \\tau^2 + \\sigma^2 + s_k^2$$\n来自新地点的一个观测值的后验预测分布是 $\\mathcal{N}(m_k, \\tau^2 + \\sigma^2 + s_k^2)$。\n\n用于实现的算法将为指定的测试参数计算这些量。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Bayesian hierarchical model problem for the given test suite.\n    \"\"\"\n    \n    # Static data from the problem statement\n    site_observations = {\n        'DS': np.array([-0.12, -0.05, 0.00]),\n        'PL': np.array([0.02]),\n        'AL': np.array([0.15, 0.10]),\n        'HV': np.array([0.30, 0.28, 0.35, 0.40]),\n    }\n\n    site_data = {\n        site: (len(obs), np.mean(obs))\n        for site, obs in site_observations.items()\n    }\n    \n    # Test suite from the problem statement\n    test_cases = [\n        (0.05, 0.10, 0.05, 0.04, 'AL'),\n        (0.05, 0.10, 0.05, 0.25, 'PL'),\n        (0.05, 0.10, 1000.0, 0.04, 'HV'),\n        (0.00, 0.01, 0.02, 0.09, 'NEW'),\n    ]\n\n    results = []\n\n    for m0, s0_sq, tau_sq, sigma_sq, query in test_cases:\n        # Step 1: Calculate the posterior distribution of the global mean mu\n        # p(mu | y) = N(m_k, s_k_sq)\n        \n        # Calculate posterior precision of mu (1/s_k_sq)\n        sum_prec_term = 0\n        for site, (n, _) in site_data.items():\n            sum_prec_term += 1 / (tau_sq + sigma_sq / n)\n        \n        post_prec_mu = (1 / s0_sq) + sum_prec_term\n        s_k_sq = 1 / post_prec_mu\n\n        # Calculate posterior mean of mu (m_k)\n        sum_mean_term = 0\n        for site, (n, y_bar) in site_data.items():\n            sum_mean_term += y_bar / (tau_sq + sigma_sq / n)\n\n        m_k = s_k_sq * (m0 / s0_sq + sum_mean_term)\n\n        # Step 2: Calculate posterior predictive distribution for the query\n        if query == 'NEW':\n            # For a new, unobserved site\n            pred_mean = m_k\n            pred_var = tau_sq + sigma_sq + s_k_sq\n            pred_std = np.sqrt(pred_var)\n        else:\n            # For an existing site\n            n_i, y_bar_i = site_data[query]\n            \n            # Posterior variance of theta_i given mu and y_bar_i\n            # sigma_sq_theta = (1/tau^2 + n_i/sigma^2)^-1\n            sigma_sq_theta_i = 1 / (1/tau_sq + n_i/sigma_sq)\n            \n            # Constant C_i\n            # C_i = sigma_sq_theta_i / tau_sq\n            C_i = sigma_sq / (n_i * tau_sq + sigma_sq)\n\n            # Predictive mean\n            pred_mean = (1 - C_i) * y_bar_i + C_i * m_k\n            \n            # Predictive variance\n            pred_var = sigma_sq + sigma_sq_theta_i + (C_i**2) * s_k_sq\n            pred_std = np.sqrt(pred_var)\n            \n        results.extend([round(pred_mean, 6), round(pred_std, 6)])\n\n    # Format output as a single comma-separated string in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "2490768"}]}