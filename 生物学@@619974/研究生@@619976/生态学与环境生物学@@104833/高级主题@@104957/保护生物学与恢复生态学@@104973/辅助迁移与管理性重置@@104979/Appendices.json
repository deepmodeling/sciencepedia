{"hands_on_practices": [{"introduction": "辅助基因流通常涉及混合种群以增强适应潜力。本练习探讨了在这种过程中一个核心的遗传学权衡：掩盖有害等位基因带来的好处（杂种优势）与遗传不兼容性导致的远交衰退风险之间的平衡。通过推导一个简单而强大的模型，您将学习如何量化当近交衰退效应 $s$ 与远交衰退效应 $d$ 相比足够大时，遗传拯救变得有利的阈值条件，为制定迁移决策提供理论基础。[@problem_id:2471827]", "problem": "一个保护团队正在计划一项管理下迁移和辅助基因流的干预措施。他们将把一个在受体环境中有平均相对适合度 $1$ 的供体种群的个体，与一个在该相同环境中有平均相对适合度 $1 - s$ 的受体种群的个体进行杂交，其中 $s \\in (0,1)$ 代表了受体种群因近交负荷与局域适应不良所造成的平均适合度亏损。子一代（F1）中的所有后代均由一个供体亲本和一个受体亲本产生，因此每个亲本对后代基因组的贡献是相等的。源于遗传不相容性的远交衰退被建模为F1平均相对适合度的一个比例性降低，降低因子为 $d \\in [0,1)$，该降低以乘法方式应用于根据亲本贡献预期的基线F1平均适合度。\n\n仅从平均相对适合度、亲本对F1的遗传贡献相等、以及远交衰退导致的乘法比例性降低的定义出发，推导预期的F1平均相对适合度 $W_{\\mathrm{F1}}(s,d)$ 的表达式。然后，使用受体种群干预前的基线平均相对适合度 $1 - s$ 作为参考，推导出确切的阈值 $s_{\\star}(d)$，使得经过一代后，遗传拯救的效果超过远交衰退，当且仅当 $s > s_{\\star}(d)$。\n\n将你的最终答案报告为关于 $s_{\\star}(d)$ 的单个闭式表达式。无需进行数值四舍五入。单位为无量纲的相对适合度。", "solution": "问题陈述具有科学依据、提法恰当、客观且自洽。它提出了保护遗传学中的一个标准模型，并要求从第一性原理出发推导一个关键的理论结果。该问题是有效的，并允许进行严谨的求解。\n\n本任务首先是推导出子一代的预期平均相对适合度 $W_{\\mathrm{F1}}(s,d)$ 的表达式，然后确定适合度亏损阈值 $s_{\\star}(d)$，在该阈值下，经过一代后辅助基因流是有益的。\n\n设 $W_{\\mathrm{donor}}$ 为供体种群的平均相对适合度，$W_{\\mathrm{recipient}}$ 为受体种群的平均相对适合度，两者均在受体环境中测量。根据问题陈述，我们有：\n$$W_{\\mathrm{donor}} = 1$$\n$$W_{\\mathrm{recipient}} = 1 - s$$\n其中 $s \\in (0,1)$ 是受体种群的适合度亏损。\n\n子一代（F1）的后代由一个供体亲本与一个受体亲本杂交形成。陈述中提到，每个亲本对后代基因组的贡献是相等的。在没有显性和上位性（包括远交衰退）的情况下，F1代的预期平均适合度，我们记为基线适合度 $W'_{\\mathrm{F1}}$，是亲本适合度值的算术平均值。\n$$W'_{\\mathrm{F1}} = \\frac{1}{2} W_{\\mathrm{donor}} + \\frac{1}{2} W_{\\mathrm{recipient}}$$\n代入给定值：\n$$W'_{\\mathrm{F1}} = \\frac{1}{2}(1) + \\frac{1}{2}(1-s) = \\frac{1}{2} + \\frac{1}{2} - \\frac{s}{2} = 1 - \\frac{s}{2}$$\n这个表达式代表了通过遮蔽导致 $s$ 中近交负荷部分的有害隐性等位基因而获得的预期适合度增益，这一现象被称为杂种优势。\n\n接下来，我们必须考虑远交衰退。问题将其定义为F1平均相对适合度按因子 $d \\in [0,1)$ 的比例性降低。一个数量 $Q$ 按因子 $d$ 的比例性降低意味着新数量为 $Q' = Q \\times (1-d)$。将此应用于基线F1适合度 $W'_{\\mathrm{F1}}$：\n$$W_{\\mathrm{F1}}(s,d) = W'_{\\mathrm{F1}} \\times (1-d)$$\n代入 $W'_{\\mathrm{F1}}$ 的表达式：\n$$W_{\\mathrm{F1}}(s,d) = \\left(1 - \\frac{s}{2}\\right)(1 - d)$$\n这就是所求的预期F1平均相对适合度的表达式。\n\n问题的第二部分要求解出阈值 $s_{\\star}(d)$，使得遗传拯救是有益的。这被明确定义为F1的适合度 $W_{\\mathrm{F1}}(s,d)$ 超过受体种群干预前的适合度 $W_{\\mathrm{recipient}} = 1 - s$ 的条件。不等式为：\n$$W_{\\mathrm{F1}}(s,d) > W_{\\mathrm{recipient}}$$\n$$\\left(1 - \\frac{s}{2}\\right)(1 - d) > 1 - s$$\n我们现在必须对这个不等式求解 $s$，以找到遗传拯救发生的条件。我们展开不等式的左侧：\n$$1 - d - \\frac{s}{2} + \\frac{sd}{2} > 1 - s$$\n为了分离出 $s$，我们将所有包含 $s$ 的项归集到不等式的左侧，所有其他项归集到右侧。\n$$s - \\frac{s}{2} + \\frac{sd}{2} > d$$\n从左侧的项中提取因子 $s$：\n$$s\\left(1 - \\frac{1}{2} + \\frac{d}{2}\\right) > d$$\n$$s\\left(\\frac{1}{2} + \\frac{d}{2}\\right) > d$$\n$$s\\left(\\frac{1+d}{2}\\right) > d$$\n为了解出 $s$，我们必须除以系数 $\\frac{1+d}{2}$。由于 $d \\in [0,1)$，我们有 $1+d > 0$，因此系数 $\\frac{1+d}{2}$ 是严格为正的。所以，用它来除不等式两边不会改变不等号的方向。\n$$s > \\frac{d}{\\frac{1+d}{2}}$$\n$$s > \\frac{2d}{1+d}$$\n这个不等式指明了要使F1代比受体种群有所改善，初始适合度亏损 $s$ 必须满足的条件。因此，阈值 $s_{\\star}(d)$ 就是 $s$ 必须超过的值。\n$$s_{\\star}(d) = \\frac{2d}{1+d}$$\n因此，当且仅当 $s > \\frac{2d}{1+d}$ 时，经过一代后的遗传拯救效果会超过远交衰退。这就是该阈值的最终表达式。", "answer": "$$\\boxed{\\frac{2d}{1+d}}$$", "id": "2471827"}, {"introduction": "辅助迁移的一个主要挑战是选择在长期内仍能保持气候适宜性的接收地。本练习介绍了一种定量方法，通过对不同气候情景下的未来温度不确定性进行建模，来评估和排序候选地点。您将应用核心统计概念来评估每个地点的稳健性，从而从简单的环境匹配转向更复杂、更具风险意识的决策框架。[@problem_id:2471836]", "problem": "辅助迁移和管理搬迁规划通常需要量化在可能的未来气候下，候选接收地点是否将保持在物种的热生态位内。考虑一个物种，其热生态位由一个能使其持续生存的年平均温度闭区间定义。对于每个候选地点，目标年份的未来平均温度被建模为基线地点温度、依赖于情景的强迫变化以及内部变率之和。假设以下基本事实：(i) 独立正态随机变量之和仍为正态分布；(ii) 连续正态分布的概率通过累积分布函数计算；(iii) 为了方差相加，假设强迫变化和内部变率之间是独立的。\n\n设物种的热生态位为区间 $\\left[L, U\\right]$，单位为摄氏度 ($^\\circ\\mathrm{C}$)，其中 $L$ 和 $U$ 是包含边界。对于2070年情景 $s$ 下的地点 $i$，其年平均温度 $T_{i,s}$ 建模为\n$$\nT_{i,s} \\;=\\; T_{0,i} \\;+\\; \\Delta T_{i,s} \\;+\\; \\varepsilon,\n$$\n其中 $T_{0,i}$ 是基线年平均温度，单位为 $^\\circ\\mathrm{C}$，$\\Delta T_{i,s}$ 是代表性浓度路径 (RCP) 情景 $s$ 下的强迫变化，而 $\\varepsilon$ 是内部变率。假设 $\\Delta T_{i,s} \\sim \\mathcal{N}\\!\\left(\\mu_{\\Delta,i,s},\\, \\sigma_{\\Delta,i,s}^2\\right)$ 且 $\\varepsilon \\sim \\mathcal{N}\\!\\left(0,\\, \\sigma_{\\mathrm{int}}^2\\right)$，两者独立。那么 $T_{i,s} \\sim \\mathcal{N}\\!\\left(m_{i,s},\\, v_{i,s}\\right)$，其中\n$$\nm_{i,s} \\;=\\; T_{0,i} \\;+\\; \\mu_{\\Delta,i,s}, \n\\qquad \nv_{i,s} \\;=\\; \\sigma_{\\Delta,i,s}^2 \\;+\\; \\sigma_{\\mathrm{int}}^2.\n$$\n地点 $i$ 在2070年保持在生态位内的特定情景概率为\n$$\nP_{i,s} \\;=\\; \\mathbb{P}\\!\\left(L \\le T_{i,s} \\le U\\right) \\;=\\; \\Phi\\!\\left(\\frac{U - m_{i,s}}{\\sqrt{v_{i,s}}}\\right) \\;-\\; \\Phi\\!\\left(\\frac{L - m_{i,s}}{\\sqrt{v_{i,s}}}\\right),\n$$\n约定当 $v_{i,s} = 0$ (退化正态分布) 时，如果 $m_{i,s} \\in [L,U]$，则 $P_{i,s} = 1$，否则 $P_{i,s}=0$。此处，$\\Phi(\\cdot)$ 是标准正态累积分布函数。定义地点 $i$ 的稳健性得分为跨所有 RCP 情景的这些概率的最小值，\n$$\n\\rho_i \\;=\\; \\min_{s} P_{i,s}.\n$$\n按 $\\rho_i$ 的降序对三个候选地点进行排名。如果 $\\rho_i$ 值完全相等（差异精确到零），则按地点索引的升序打破平局，地点索引为 $1, 2, 3$。\n\n实现一个程序，为每个地点计算 $\\rho_i$，并为以下三个测试用例返回稳健性得分和排名。所有温度单位均为摄氏度 ($^\\circ\\mathrm{C}$)。所有返回的概率必须是 $\\left[0,1\\right]$ 范围内的小数，并四舍五入到六位小数。\n\n测试用例 A (正常路径):\n- 热生态位: $L = 12.0$, $U = 18.0$。\n- 基线地点温度: $\\left[T_{0,1}, T_{0,2}, T_{0,3}\\right] = \\left[12.5, 14.8, 16.2\\right]$。\n- RCP 情景 $s \\in \\{1,2,3\\}$ 对应于 RCP $2.6$、RCP $4.5$ 和 RCP $8.5$。\n- 强迫变化均值 $\\mu_{\\Delta,i,s}$ (按情景为行，地点为列):\n  - RCP $2.6$: $\\left[1.0, 0.9, 1.1\\right]$,\n  - RCP $4.5$: $\\left[1.8, 2.0, 2.1\\right]$,\n  - RCP $8.5$: $\\left[3.7, 3.9, 4.1\\right]$。\n- 强迫变化标准差 $\\sigma_{\\Delta,i,s}$ (按情景为行，地点为列):\n  - RCP $2.6$: $\\left[0.25, 0.30, 0.35\\right]$,\n  - RCP $4.5$: $\\left[0.35, 0.40, 0.45\\right]$,\n  - RCP $8.5$: $\\left[0.50, 0.60, 0.70\\right]$。\n- 内部变率标准差: $\\sigma_{\\mathrm{int}} = 0.30$。\n\n测试用例 B (关注边界，窄生态位):\n- 热生态位: $L = 15.0$, $U = 16.0$。\n- 基线地点温度: $\\left[T_{0,1}, T_{0,2}, T_{0,3}\\right] = \\left[14.0, 15.5, 16.0\\right]$。\n- RCP 情景 $s \\in \\{1,2,3\\}$ 对应于 RCP $2.6$、RCP $4.5$ 和 RCP $8.5$。\n- 强迫变化均值 $\\mu_{\\Delta,i,s}$:\n  - RCP $2.6$: $\\left[0.8, 0.8, 0.8\\right]$,\n  - RCP $4.5$: $\\left[1.5, 1.6, 1.7\\right]$,\n  - RCP $8.5$: $\\left[3.5, 3.2, 3.0\\right]$。\n- 强迫变化标准差 $\\sigma_{\\Delta,i,s}$:\n  - RCP $2.6$: $\\left[0.20, 0.20, 0.20\\right]$,\n  - RCP $4.5$: $\\left[0.25, 0.25, 0.25\\right]$,\n  - RCP $8.5$: $\\left[0.40, 0.35, 0.30\\right]$。\n- 内部变率标准差: $\\sigma_{\\mathrm{int}} = 0.20$。\n\n测试用例 C (方差退化的边缘情况):\n- 热生态位: $L = 10.0$, $U = 12.0$。\n- 基线地点温度: $\\left[T_{0,1}, T_{0,2}, T_{0,3}\\right] = \\left[10.5, 11.0, 11.5\\right]$。\n- RCP 情景 $s \\in \\{1,2,3\\}$ 对应于 RCP $2.6$、RCP $4.5$ 和 RCP $8.5$。\n- 强迫变化均值 $\\mu_{\\Delta,i,s}$:\n  - RCP $2.6$: $\\left[0.0, 0.0, 0.0\\right]$,\n  - RCP $4.5$: $\\left[1.0, 1.0, 1.0\\right]$,\n  - RCP $8.5$: $\\left[2.5, 2.5, 2.5\\right]$。\n- 强迫变化标准差 $\\sigma_{\\Delta,i,s}$:\n  - RCP $2.6$: $\\left[0.0, 0.0, 0.0\\right]$,\n  - RCP $4.5$: $\\left[0.0, 0.0, 0.0\\right]$,\n  - RCP $8.5$: $\\left[0.0, 0.0, 0.0\\right]$。\n- 内部变率标准差: $\\sigma_{\\mathrm{int}} = 0.0$。\n\n程序要求:\n- 在每个测试用例中，为地点 $i \\in \\{1,2,3\\}$ 计算 $\\rho_i$。计算方法是评估三种 RCP 情景下的 $P_{i,s}$，并取每个地点所有情景中的最小值。\n- 将每个 $\\rho_i$ 四舍五入到六位小数。\n- 每个测试用例生成一个排名：一个地点索引列表 $\\left[1,2,3\\right]$，按 $\\rho_i$ 降序排列。完全相等的数值按地点索引升序打破平局。\n- 最终输出格式：您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。每个测试用例的结果必须是一个形式为 $\\left[\\left[\\rho_1,\\rho_2,\\rho_3\\right],\\left[r_1,r_2,r_3\\right]\\right]$ 的嵌套列表，其中 $\\left[r_1,r_2,r_3\\right]$ 是排名。例如，一个包含三个测试用例的有效总输出形式为 \n$[[[a_1,a_2,a_3],[i_1,i_2,i_3]],[[b_1,b_2,b_3],[j_1,j_2,j_3]],[[c_1,c_2,c_3],[k_1,k_2,k_3]]]$,\n其中所有的 $a_\\ell,b_\\ell,c_\\ell \\in [0,1]$ 都四舍五入到六位小数，并且所有的 $i_\\ell,j_\\ell,k_\\ell \\in \\{1,2,3\\}$。", "solution": "该问题要求计算三个候选生态地点在三种不同气候变化情景下的稳健性得分 $\\rho_i$，并随后根据该得分对这些地点进行排名。整个过程基于应用于简化气候模型的初等概率论。该过程是确定性的，计算上简单直接。\n\n地点 $i$ 在情景 $s$ 下的年平均温度 $T_{i,s}$ 的模型给出为三个组成部分之和：基线温度 $T_{0,i}$、强迫变化 $\\Delta T_{i,s}$ 和内部变率 $\\varepsilon$。后两者被指定为独立的服从正态分布的随机变量，$\\Delta T_{i,s} \\sim \\mathcal{N}(\\mu_{\\Delta,i,s}, \\sigma_{\\Delta,i,s}^2)$ 和 $\\varepsilon \\sim \\mathcal{N}(0, \\sigma_{\\mathrm{int}}^2)$。正态分布的一个基本性质是它们的和也服从正态分布。因此，$T_{i,s}$ 是一个正态随机变量：\n$$\nT_{i,s} \\sim \\mathcal{N}(m_{i,s}, v_{i,s})\n$$\n均值 $m_{i,s}$ 是各组成部分均值的和，而方差 $v_{i,s}$ 因其独立性而是各组成部分方差的和。\n$$\nm_{i,s} = T_{0,i} + \\mu_{\\Delta,i,s} + 0 = T_{0,i} + \\mu_{\\Delta,i,s}\n$$\n$$\nv_{i,s} = \\sigma_{\\Delta,i,s}^2 + \\sigma_{\\mathrm{int}}^2\n$$\n问题将物种的热生态位指定为闭区间 $[L, U]$。地点 $i$ 在情景 $s$ 下保持在此生态位内的概率 $P_{i,s}$ 是概率 $\\mathbb{P}(L \\le T_{i,s} \\le U)$。对于连续随机变量，这是使用其累积分布函数（CDF）计算的。对于一个正态变量 $X \\sim \\mathcal{N}(\\mu, \\sigma^2)$，概率 $\\mathbb{P}(a \\le X \\le b)$ 由 $\\Phi(\\frac{b-\\mu}{\\sigma}) - \\Phi(\\frac{a-\\mu}{\\sigma})$ 给出，其中 $\\Phi(\\cdot)$ 表示标准正态分布 $\\mathcal{N}(0, 1)$ 的累积分布函数。\n\n将此应用于 $T_{i,s}$，我们得到特定情景的概率：\n$$\nP_{i,s} = \\Phi\\left(\\frac{U - m_{i,s}}{\\sqrt{v_{i,s}}}\\right) - \\Phi\\left(\\frac{L - m_{i,s}}{\\sqrt{v_{i,s}}}\\right)\n$$\n该公式对非零方差 $v_{i,s} > 0$ 有效。问题正确地指明了如何处理 $v_{i,s} = 0$ 的退化情况。在这种情况下，温度 $T_{i,s}$ 不是一个随机变量，而是一个等于其均值 $m_{i,s}$ 的固定值。因此，概率 $P_{i,s}$ 是二元的：如果均值落在生态位内，$L \\le m_{i,s} \\le U$，则为 $1$，否则为 $0$。\n\n在为所有 $i$ 和 $s$ 建立了计算 $P_{i,s}$ 的方法后，每个地点的稳健性得分 $\\rho_i$ 定义为所有情景中的最小概率：\n$$\n\\rho_i = \\min_{s} P_{i,s}\n$$\n这表示了在所考虑的未来气候情景下，对地点生存能力的最坏情况分析。\n\n最后一步是对地点进行排名。主要排名标准是稳健性得分 $\\rho_i$，按降序排列。更高的 $\\rho_i$ 表示地点更稳健。问题提供了一个明确的平局打破规则：在 $\\rho_i$ 值完全相等的情况下，索引较低的地点（例如，地点1在地点2之前）排名更高。这等同于按 $\\rho_i$ 降序、再按 $i$ 升序对数对 $(\\rho_i, i)$ 进行排序。\n\n实现计划如下：\n1. 对于每个测试用例，遍历每个地点 $i \\in \\{1, 2, 3\\}$。\n2. 对于每个地点，遍历每个情景 $s \\in \\{1, 2, 3\\}$。\n3. 在最内层循环中，使用所提供的数据 $T_{0,i}$、$\\mu_{\\Delta,i,s}$、$\\sigma_{\\Delta,i,s}$ 和 $\\sigma_{\\mathrm{int}}$ 计算 $m_{i,s}$ 和 $v_{i,s}$。\n4. 计算 $P_{i,s}$，正确处理标准情况（$v_{i,s} > 0$，使用标准正态CDF函数，如 `scipy.stats.norm.cdf`）和退化情况（$v_{i,s} = 0$）。\n5. 在遍历完给定地点 $i$ 的所有情景后，通过找到计算出的 $P_{i,s}$ 值的最小值来确定 $\\rho_i$。\n6. 存储所有地点的全精度 $\\rho_i$ 值。\n7. 计算完所有 $\\rho_i$ 后，创建一个包含得分和原始地点索引的元组列表，例如 $(\\rho_1, 1)$, $(\\rho_2, 2)$, $(\\rho_3, 3)$。\n8. 对此列表进行排序。基于一个优先考虑 $\\rho_i$ 降序、其次是地点索引 $i$ 升序的键进行稳定排序，将产生正确的排名。例如，基于元组键 $(-\\rho_i, i)$ 进行升序排序可实现预期结果。\n9. 排序后，提取地点索引以形成最终的排名列表。\n10. 最终输出的稳健性得分 $\\rho_i$ 必须四舍五入到六位小数。每个测试用例的最终结果是一个嵌套列表，包含四舍五入后的得分列表和排名后的地点索引列表。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes robustness scores and rankings for candidate sites based on a climate model.\n    \"\"\"\n\n    test_cases = [\n        # Test Case A\n        {\n            \"L\": 12.0, \"U\": 18.0,\n            \"T0\": [12.5, 14.8, 16.2],\n            \"mu_delta\": np.array([\n                [1.0, 0.9, 1.1],\n                [1.8, 2.0, 2.1],\n                [3.7, 3.9, 4.1]\n            ]),\n            \"sigma_delta\": np.array([\n                [0.25, 0.30, 0.35],\n                [0.35, 0.40, 0.45],\n                [0.50, 0.60, 0.70]\n            ]),\n            \"sigma_int\": 0.30\n        },\n        # Test Case B\n        {\n            \"L\": 15.0, \"U\": 16.0,\n            \"T0\": [14.0, 15.5, 16.0],\n            \"mu_delta\": np.array([\n                [0.8, 0.8, 0.8],\n                [1.5, 1.6, 1.7],\n                [3.5, 3.2, 3.0]\n            ]),\n            \"sigma_delta\": np.array([\n                [0.20, 0.20, 0.20],\n                [0.25, 0.25, 0.25],\n                [0.40, 0.35, 0.30]\n            ]),\n            \"sigma_int\": 0.20\n        },\n        # Test Case C\n        {\n            \"L\": 10.0, \"U\": 12.0,\n            \"T0\": [10.5, 11.0, 11.5],\n            \"mu_delta\": np.array([\n                [0.0, 0.0, 0.0],\n                [1.0, 1.0, 1.0],\n                [2.5, 2.5, 2.5]\n            ]),\n            \"sigma_delta\": np.array([\n                [0.0, 0.0, 0.0],\n                [0.0, 0.0, 0.0],\n                [0.0, 0.0, 0.0]\n            ]),\n            \"sigma_int\": 0.0\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        L, U = case[\"L\"], case[\"U\"]\n        T0 = case[\"T0\"]\n        mu_delta = case[\"mu_delta\"]\n        sigma_delta = case[\"sigma_delta\"]\n        sigma_int = case[\"sigma_int\"]\n\n        num_sites = len(T0)\n        num_scenarios = mu_delta.shape[0]\n        \n        rho_scores = []\n\n        for i in range(num_sites):  # site index 0, 1, 2 for sites 1, 2, 3\n            p_is_list = []\n            for s in range(num_scenarios):  # scenario index 0, 1, 2\n                \n                # Model parameters for T_is\n                m_is = T0[i] + mu_delta[s, i]\n                v_is = sigma_delta[s, i]**2 + sigma_int**2\n\n                # Calculate scenario-specific probability P_is\n                if v_is == 0:\n                    p_is = 1.0 if L <= m_is <= U else 0.0\n                else:\n                    std_dev = np.sqrt(v_is)\n                    z_U = (U - m_is) / std_dev\n                    z_L = (L - m_is) / std_dev\n                    p_is = norm.cdf(z_U) - norm.cdf(z_L)\n                \n                p_is_list.append(p_is)\n\n            # Robustness score rho_i is the minimum probability across scenarios\n            rho_i = min(p_is_list)\n            rho_scores.append(rho_i)\n\n        # Round scores to 6 decimal places for output\n        rounded_rho = [round(score, 6) for score in rho_scores]\n\n        # Rank sites: descending rho_i, with ties broken by ascending site index\n        # Site indices are 1-based (1, 2, 3)\n        sites_with_scores = list(zip(rho_scores, range(1, num_sites + 1)))\n\n        # Sort using a key: -score for descending order, site_index for tie-breaking\n        sites_with_scores.sort(key=lambda x: (-x[0], x[1]))\n        \n        ranking = [site_index for score, site_index in sites_with_scores]\n        \n        all_results.append([rounded_rho, ranking])\n\n    # Format the final output string\n    # str() on a list produces the required format, so we join these string representations\n    output_str = \",\".join(map(str, all_results))\n    print(f\"[{output_str}]\")\n\nsolve()\n```", "id": "2471836"}, {"introduction": "任何物种迁移都伴随着将病原体引入新区域的内在风险。这个动手实践问题将演示如何运用贝叶斯统计推断（现代风险分析的基石）来形式化和量化此风险。通过整合来自诊断测试和隔离观察的信息，您将计算一个种群群体不携带病原体的后验概率，这为操作规划和生物安全管理提供了关键工具。[@problem_id:2471832]", "problem": "一个保护机构正在对一个两栖动物群体实施辅助迁移（也称为管理搬迁），将它们迁移到一个气候避难所。为了最大限度地降低转移真菌病原体的风险，每个个体在进入生物安全的隔离区时都会接受筛查，并在固定的隔离期内进行监测。假设以下条件成立，这些都是野生动物疾病风险分析中的标准工作假设：\n\n- 群体中有 $N$ 个个体，每个个体在捕获时被感染的独立先验概率为 $\\pi$（近似于源种群的背景感染率）。\n- 在第 $0$ 天（进入隔离区时），对每个个体进行一次诊断测试（聚合酶链式反应，PCR）。该测试的灵敏度为 $S_e$，特异性为 $S_p$，两者在个体间独立起作用。\n- 在隔离期间，没有新的感染暴露，也没有群体内传播。如果一个个体在第 $0$ 天被感染，其可检测临床症状出现的时间服从速率为 $\\lambda$（每天）的指数分布，且在个体间独立。因此，一个受感染的个体到第 $q$ 天仍未表现出临床症状的概率为 $\\exp(-\\lambda q)$。未受感染的个体绝不会表现出病原体特异性的临床症状。\n- 观测数据包括第 $0$ 天的 $N$ 个阴性 PCR 结果，以及在 $q$ 天的隔离期内所有个体均未观察到临床症状。\n\n从 Bayes 定理和上述独立性假设出发，推导在给定观测数据的情况下，该群体在第 $q$ 天不含受感染个体的后验概率的解析表达式。然后，使用以下参数值计算该概率：$N = 20$，$\\pi = 0.05$， $S_e = 0.90$， $S_p = 0.98$，$\\lambda = 0.2$ (每天)，以及 $q = 14$ (天)。将最终答案表示为小数并四舍五入到四位有效数字。", "solution": "所述问题具有科学依据，提法恰当且客观。它基于贝叶斯推断和流行病学建模的标准原理，特别是在保护性易地搬迁的野生动物疾病风险分析背景下。所有必要的参数和假设都已提供，并且它们在内部是一致的、科学上是合理的。该问题是概率论中一个可以形式化的问题，不违反任何指定的无效标准。因此，我将开始推导解决方案。\n\n目标是求在给定一组特定观测数据的情况下，一个包含 $N$ 个个体的群体不携带病原体的后验概率。整个群体的观测数据包括第 $0$ 天的 $N$ 个阴性聚合酶链式反应（PCR）测试结果，以及在为期 $q$ 天的隔离期内所有 $N$ 个个体均未观察到临床症状。推导将基于条件概率和 Bayes 定理的原理，并利用个体之间相互独立的假设。\n\n首先，我们为单个个体（索引为 $i$）定义相关事件：\n- $I_i$：个体 $i$ 确实被感染的事件。先验概率为 $P(I_i) = \\pi$。\n- $U_i$：个体 $i$ 确实未被感染的事件。先验概率为 $P(U_i) = 1 - \\pi$。\n- $T_i^-$：个体 $i$ 在第 $0$ 天的 PCR 测试中结果为阴性的事件。\n- $C_i^-$：个体 $i$ 到第 $q$ 天仍未表现出临床症状的事件。\n- $D_i$：个体 $i$ 的组合观测数据，即测试结果为阴性且无临床症状的合取，因此 $D_i = T_i^- \\cap C_i^-$。\n\n问题的核心可以通过首先计算在给定单个个体观测数据 $D_i$ 的情况下，该个体被感染的后验概率来简化。设这个后验概率为 $p_{\\mathrm{post}} = P(I_i | D_i)$。\n\n使用 Bayes 定理：\n$$P(I_i | D_i) = \\frac{P(D_i | I_i) P(I_i)}{P(D_i)}$$\n分母 $P(D_i)$ 可以使用全概率公式展开：\n$$P(D_i) = P(D_i | I_i) P(I_i) + P(D_i | U_i) P(U_i)$$\n我们现在必须计算条件概率 $P(D_i | I_i)$ 和 $P(D_i | U_i)$。\n\n1.  给定个体被感染（$I_i$）时，观测到数据的概率：\n    $P(D_i | I_i) = P(T_i^- \\cap C_i^- | I_i)$。\n    对于一个受感染的个体，第 $0$ 天的测试结果和后续临床症状的出现是条件独立的过程。因此：\n    $$P(D_i | I_i) = P(T_i^- | I_i) \\times P(C_i^- | I_i)$$\n    - $P(T_i^- | I_i)$ 是假阴性的概率，即 $1 - S_e$，其中 $S_e$ 是测试灵敏度。\n    - $P(C_i^- | I_i)$ 是一个受感染个体到第 $q$ 天仍不表现出临床症状的概率。这由发病时间指数分布的生存函数给出，即 $\\exp(-\\lambda q)$。\n    因此，$P(D_i | I_i) = (1 - S_e) \\exp(-\\lambda q)$。\n\n2.  给定个体未被感染（$U_i$）时，观测到数据的概率：\n    $P(D_i | U_i) = P(T_i^- \\cap C_i^- | U_i)$。\n    类似地，对于一个未受感染的个体，测试结果和无临床症状是条件独立的。\n    $$P(D_i | U_i) = P(T_i^- | U_i) \\times P(C_i^- | U_i)$$\n    - $P(T_i^- | U_i)$ 是真阴性的概率，即测试特异性 $S_p$。\n    - $P(C_i^- | U_i)$ 是一个未受感染个体不表现出临床症状的概率。问题陈述这为确定性事件，所以 $P(C_i^- | U_i) = 1$。\n    因此，$P(D_i | U_i) = S_p$。\n\n现在，我们可以整合 $p_{\\mathrm{post}}$ 的表达式：\n$$p_{\\mathrm{post}} = P(I_i | D_i) = \\frac{P(I_i) P(D_i | I_i)}{P(I_i) P(D_i | I_i) + P(U_i) P(D_i | U_i)}$$\n代入先验概率和条件概率：\n$$p_{\\mathrm{post}} = \\frac{\\pi (1 - S_e) \\exp(-\\lambda q)}{\\pi (1 - S_e) \\exp(-\\lambda q) + (1 - \\pi) S_p}$$\n这是在给定某个特定个体测试为阴性且未表现出临床症状的情况下，该个体被感染的后验概率。\n\n问题要求的是在给定整个群体数据的情况下，该群体不含受感染个体的后验概率。设这个事件为 $E_0$。这等同于在观测之后，所有 $N$ 个个体都未被感染。由于个体在先验上是独立的，并且对它们的观测是独立进行的，因此它们的后验状态也是独立的。\n因此，该群体无感染的概率是每个个体在其各自数据条件下未被感染概率的乘积：\n$$P(E_0 | \\mathrm{all\\,data}) = \\prod_{i=1}^{N} P(U_i | D_i)$$\n单个个体未被感染的后验概率是 $P(U_i | D_i) = 1 - P(I_i | D_i) = 1 - p_{\\mathrm{post}}$。\n所以，我们所求的概率，记为 $P_{\\mathrm{free}}$，是：\n$$P_{\\mathrm{free}} = (1 - p_{\\mathrm{post}})^N = \\left( 1 - \\frac{\\pi (1 - S_e) \\exp(-\\lambda q)}{\\pi (1 - S_e) \\exp(-\\lambda q) + (1 - \\pi) S_p} \\right)^N$$\n通过对括号内的项进行通分，我们得到解析表达式：\n$$P_{\\mathrm{free}} = \\left( \\frac{(1 - \\pi) S_p}{\\pi (1 - S_e) \\exp(-\\lambda q) + (1 - \\pi) S_p} \\right)^N$$\n这就是该群体无感染的后验概率的最终解析表达式。\n\n现在，我们必须使用给定的参数值来计算这个表达式：\n-  $N = 20$\n-  $\\pi = 0.05$\n-  $S_e = 0.90$\n-  $S_p = 0.98$\n-  $\\lambda = 0.2 \\text{ 天}^{-1}$\n-  $q = 14 \\text{ 天}$\n\n首先，我们计算表达式中的各项。\n指数项为 $\\exp(-\\lambda q) = \\exp(-0.2 \\times 14) = \\exp(-2.8)$。\n受感染个体对数据概率的贡献项是 $\\pi (1 - S_e) \\exp(-\\lambda q) = 0.05 \\times (1 - 0.90) \\times \\exp(-2.8) = 0.05 \\times 0.1 \\times \\exp(-2.8) = 0.005 \\exp(-2.8)$。\n未受感染个体的项是 $(1 - \\pi) S_p = (1 - 0.05) \\times 0.98 = 0.95 \\times 0.98 = 0.931$。\n\n让我们计算 $p_{\\mathrm{post}}$ 的值：\n$$p_{\\mathrm{post}} \\approx \\frac{0.005 \\exp(-2.8)}{0.005 \\exp(-2.8) + 0.931}$$\n使用 $\\exp(-2.8) \\approx 0.06081006$：\n$$p_{\\mathrm{post}} \\approx \\frac{0.005 \\times 0.06081006}{0.005 \\times 0.06081006 + 0.931} = \\frac{0.00030405}{0.00030405 + 0.931} = \\frac{0.00030405}{0.93130405} \\approx 0.00032648$$\n单个个体未被感染的后验概率为 $1 - p_{\\mathrm{post}} \\approx 1 - 0.00032648 = 0.99967352$。\n最后，整个包含 $N=20$ 个个体的群体都未被感染的后验概率为：\n$$P_{\\mathrm{free}} = (1 - p_{\\mathrm{post}})^N \\approx (0.99967352)^{20}$$\n$$P_{\\mathrm{free}} \\approx 0.993491295$$\n四舍五入到四位有效数字，结果是 $0.9935$。\n这个结果表明，在整个群体经过 $14$ 天隔离且无临床症状、初始 PCR 测试均为阴性之后，尽管初始背景感染率为 $5\\%$ 且诊断测试不完美，该群体完全不携带病原体的概率为 $99.35\\%$。", "answer": "$$\\boxed{0.9935}$$", "id": "2471832"}]}