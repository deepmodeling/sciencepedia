{"hands_on_practices": [{"introduction": "在自然界中，种群的大小很少保持恒定，常常会经历剧烈的波动。理解这些波动如何影响遗传多样性是保护遗传学的核心。本练习将通过一个假设的时间序列数据，引导你从第一性原理推导出有效种群大小（$N_e$）的概念，并计算其谐波平均值[@problem_id:2472477]。这个实践旨在揭示为何种群瓶颈对遗传多样性的丧失具有不成比例的巨大影响，并让你掌握量化这一长期效应的关键工具。", "problem": "一个随机交配的二倍体种群遵循Wright-Fisher模型，其世代离散且不重叠，无突变，也无迁移。设第 $t$ 代的普查种群大小为 $N_t$。在 $T$ 代的有限时间窗口内，将有效种群大小（$N_e$）定义为这样一个恒定的种群大小：它所产生的中性杂合度的预期累积下降，与观测到的随时间变化的普查种群大小所产生的结果相同。\n\n你观测到时间序列 $N_1 = 50$，$N_2 = 200$，以及 $N_3 = 100$（因此 $T=3$）。请仅从Wright-Fisher繁殖下，中性杂合度预期值与普查种群大小之间的基本单代关系出发，推导出一个用 $\\{N_t\\}_{t=1}^T$ 表示的、跨越 $T$ 代的 $N_e$ 表达式，并用它计算给定序列的调和平均有效种群大小。报告最终数值答案时，请以个体为单位，给出精确有理数，不要四舍五入。\n\n在你的推理过程中，解释为什么 $\\{N_t\\}$ 的时间变异会使 $N_e$ 低于 $\\{N_t\\}$ 的算术平均值，从而随时间推移抑制中性遗传多样性。", "solution": "该问题陈述具有科学依据，提法恰当，并包含足够信息以得到唯一解。这是种群遗传学中一个基于Wright-Fisher模型的标准练习。因此，该问题被视为有效，并将提供解答。\n\n推导始于描述在Wright-Fisher模型下，单代内由遗传漂变引起的预期杂合度衰减的基本关系。对于一个在第 $t$ 代普查种群大小为 $N_t$ 的随机交配二倍体种群，下一代（$t+1$）的预期杂合度 $H_{t+1}$ 与第 $t$ 代的杂合度 $H_t$ 之间的关系为：\n$$E[H_{t+1}] = \\left(1 - \\frac{1}{2N_t}\\right) H_t$$\n这种关系源于以下事实：从第 $t$ 代的基因库中有放回地抽取两个等位基因以形成第 $t+1$ 代的一个个体时，这两个等位基因同源相同的概率是 $\\frac{1}{2N_t}$。因此，项 $\\left(1 - \\frac{1}{2N_t}\\right)$ 是它们不同源相同的概率，也即杂合度预期下降的因子。\n\n为了确定在随时间变化的普查种群大小 $\\{N_t\\}_{t=1}^T$ 下，经过 $T$ 代的累积效应，我们迭代地应用此递推关系。设 $H_1$ 为过程开始时（即第1代）的杂合度。经过 $T$ 代后，在第 $T+1$ 代开始时的预期杂合度为：\n$$E[H_{T+1}] = H_1 \\prod_{t=1}^{T} \\left(1 - \\frac{1}{2N_t}\\right)$$\n问题将有效种群大小 $N_e$ 定义为一个理想化的恒定种群的大小，该种群在相同的 $T$ 代内会经历与前者相同的杂合度累积下降。对于一个大小恒为 $N_e$ 的种群， $T$ 代后的预期杂合度为：\n$$E[H_{T+1}] = H_1 \\left(1 - \\frac{1}{2N_e}\\right)^T$$\n根据定义，这两个累积下降因子必须相等：\n$$\\left(1 - \\frac{1}{2N_e}\\right)^T = \\prod_{t=1}^{T} \\left(1 - \\frac{1}{2N_t}\\right)$$\n对于远大于1的普查种群大小 $N_t$ (这是此类模型中的一个标准假设)，我们可以对小的 $x$ 使用近似 $1-x \\approx \\exp(-x)$。在我们的例子中，$x = \\frac{1}{2N_t}$非常小。将此近似应用于方程两边，得到：\n$$\\left(\\exp\\left(-\\frac{1}{2N_e}\\right)\\right)^T \\approx \\prod_{t=1}^{T} \\exp\\left(-\\frac{1}{2N_t}\\right)$$\n利用指数性质 $\\exp(a)\\exp(b) = \\exp(a+b)$，右边化简为：\n$$\\exp\\left(-\\frac{T}{2N_e}\\right) \\approx \\exp\\left(-\\sum_{t=1}^{T} \\frac{1}{2N_t}\\right)$$\n为使两边相等，它们的指数必须相等：\n$$\\frac{T}{2N_e} = \\sum_{t=1}^{T} \\frac{1}{2N_t}$$\n两边乘以 $2$ 并对 $N_e$ 进行移项整理，得到有效种群大小的表达式：\n$$\\frac{T}{N_e} = \\sum_{t=1}^{T} \\frac{1}{N_t}$$\n$$N_e = \\frac{T}{\\sum_{t=1}^{T} \\frac{1}{N_t}}$$\n此表达式表明，在普查种群大小波动的时期内，有效种群大小是这些普查种群大小的调和平均值。\n\n现在，我们为给定的时间序列计算 $N_e$ 的值：$T=3$, $N_1 = 50$, $N_2 = 200$ 以及 $N_3 = 100$。将这些值代入推导出的公式中：\n$$N_e = \\frac{3}{\\frac{1}{50} + \\frac{1}{200} + \\frac{1}{100}}$$\n为了计算分母，我们找到公分母 $200$：\n$$\\sum_{t=1}^{3} \\frac{1}{N_t} = \\frac{4}{200} + \\frac{1}{200} + \\frac{2}{200} = \\frac{4+1+2}{200} = \\frac{7}{200}$$\n将此结果代回 $N_e$ 的表达式中：\n$$N_e = \\frac{3}{\\frac{7}{200}} = 3 \\times \\frac{200}{7} = \\frac{600}{7}$$\n\n最后，我们必须解释为什么 $\\{N_t\\}$ 的时间变异会使 $N_e$ 低于 $\\{N_t\\}$ 的算术平均值。算术平均值由 $\\bar{N}_{\\text{arith}} = \\frac{1}{T}\\sum_{t=1}^T N_t$ 给出。有效种群大小 $N_e$ 是调和平均值。根据算术平均-调和平均（AM-HM）不等式，对于任何一组正数 $\\{N_t\\}$，算术平均值总是大于或等于调和平均值：\n$$\\frac{1}{T}\\sum_{t=1}^T N_t \\ge \\frac{T}{\\sum_{t=1}^T \\frac{1}{N_t}}$$\n仅当所有 $N_t$ 都相等时，等号才成立。因此，$\\bar{N}_{\\text{arith}} \\ge N_e$，并且种群大小的任何时间变异都会导致有效种群大小严格小于算术平均值。\n\n其生物学原因是，在任何一代中，杂合度丢失的速率与种群大小成反比（$\\frac{1}{2N_t}$）。种群规模小的世代，即所谓的瓶颈期，对遗传多样性的累积丧失贡献尤为巨大。短暂的小 $N_t$ 时期会导致 $\\frac{1}{2N_t}$ 的值很大，从而引起杂合度的严重下降。随后种群规模大的世代无法逆转这种损失，只能减缓未来损失的速率。因此，长期的漂变速率是由最极端的瓶颈期决定的。调和平均值是一个数学构造，它在计算中极大地受到一个系列中最小值的权重影响，因此它能正确地捕捉到这一生物学现象。对于给定的序列，算术平均值为 $\\frac{50+200+100}{3} = \\frac{350}{3} \\approx 116.7$，而有效种群大小为 $N_e = \\frac{600}{7} \\approx 85.7$。第一代50个体的低普查种群大小产生了不成比例的影响，将有效种群大小拉低至远低于算术平均值，并导致种群遗传多样性的丧失速率远快于平均种群大小所预示的速率。", "answer": "$$\\boxed{\\frac{600}{7}}$$", "id": "2472477"}, {"introduction": "一个群落中的物种并非随机组合，其构成受到环境筛选和物种间相互作用等生态过程的深刻影响。功能性状的多样性模式可以为我们揭示这些背后隐藏的群落构建规则。本练习将指导你设计并实现一个零模型检验，用以区分环境筛选（导致性状聚类）和限制性相似（导致性状过度分散）这两种对立的假说[@problem_id:2472458]。通过亲手计算功能离散度（Functional Dispersion, FDis）并分析其标准化效应量，你将掌握一种分析群落功能结构及其生态学意义的强大计算方法。", "problem": "给定沿环境梯度的物种-性状数据和样地-物种群落成员关系。目标是使用功能离散度的标准化效应量，为环境过滤与限制性相似实现一个基于原则的零模型检验。所有定义和步骤必须源自性状空间中距离的核心定义，以及在一个保留群落丰富度但破坏物种-性状关联的零假设下的随机化过程。\n\n作为基础的定义：\n- 每个物种的功能性状向量是 $D$ 维欧几里得空间中的一个元素，对于物种索引 $i \\in \\{1,\\dots,S\\}$，记作 $\\mathbf{t}_i \\in \\mathbb{R}^D$。\n- 对于一个样地中的群落，设 $\\mathbf{a} \\in \\{0,1\\}^S$ 为物种库（大小为 $S$）上的存在-缺失向量。该群落包含索引集 $I = \\{ i \\mid a_i = 1 \\}$，其丰富度为 $m = \\sum_{i=1}^S a_i$。\n- 形心（群落加权平均性状）为 $\\mathbf{c} = \\left(\\sum_{i \\in I} w_i \\mathbf{t}_i\\right) \\Big/ \\left(\\sum_{i \\in I} w_i\\right)$，其中对于所有 $i \\in I$，存在权重 $w_i = 1$。\n- 对于 $i \\in I$，从 $\\mathbf{t}_i$ 到 $\\mathbf{c}$ 的欧几里得距离是 $d_i = \\lVert \\mathbf{t}_i - \\mathbf{c} \\rVert_2$。\n- 功能离散度（FDis）是到形心的加权平均距离，$\\mathrm{FDis} = \\left(\\sum_{i \\in I} w_i d_i\\right) \\Big/ \\left(\\sum_{i \\in I} w_i\\right)$。使用存在权重时，这等于 $\\{ d_i \\}_{i \\in I}$ 的简单平均值。\n- 零模型随机化了物种身份与性状向量之间的映射关系，同时在每个样地保留了群落成员关系向量 $\\mathbf{a}$。具体来说，对于每次零模型重复，对性状矩阵的行应用一个均匀随机置换 $\\pi$，生成一个置换后的性状集 $\\{\\mathbf{t}_{\\pi(1)},\\dots,\\mathbf{t}_{\\pi(S)}\\}$，然后对于重复索引 $r \\in \\{1,\\dots,R\\}$，使用相同的 $\\mathbf{a}$ 计算 $\\mathrm{FDis}^{(r)}$。\n- 标准化效应量为 $\\mathrm{SES} = \\left(\\mathrm{FDis}_{\\mathrm{obs}} - \\mu_{\\mathrm{null}}\\right) \\Big/ \\sigma_{\\mathrm{null}}$，其中 $\\mu_{\\mathrm{null}}$ 为零模型重复的均值，$\\sigma_{\\mathrm{null}}$ 为其标准差。如果 $\\sigma_{\\mathrm{null}} = 0$，为避免除以零，按惯例定义 $\\mathrm{SES} = 0$。负的 $\\mathrm{SES}$ 表示性状聚集，与环境过滤一致；正的 $\\mathrm{SES}$ 表示过度离散，与限制性相似一致。\n\n算法要求：\n- 使用上述定义实现 $\\mathbb{R}^D$ 中 $\\mathrm{FDis}$ 的计算。\n- 实现具有 $R$ 次重复和固定随机种子的性状-标签随机化零模型，以确保可复现性。\n- 计算每个样地的 $\\mathrm{SES}$，输出时四舍五入到三位小数。\n- 仅为解释目的使用双尾解释性阈值 $\\alpha = 0.10$ 和临界值 $z_{\\alpha/2} = 1.645$；不要在要求的输出中包含分类。\n\n测试套件规范：\n- 使用以下两个案例。\n\n案例A (单变量性状, $D = 1$, $S = 8$, 5个样地):\n- 性状向量 $\\mathbf{t} \\in \\mathbb{R}^8$:\n  $\\mathbf{t} = [\\,0.05,\\,0.12,\\,0.20,\\,0.50,\\,0.60,\\,0.80,\\,0.92,\\,0.97\\,]$。\n- 样地-物种存在矩阵 $\\mathbf{A} \\in \\{0,1\\}^{5 \\times 8}$，行代表样地 $1$ 至 $5$：\n  - 样地 $1$: $[\\,1,\\,1,\\,1,\\,0,\\,0,\\,0,\\,0,\\,0\\,]$。\n  - 样地 $2$: $[\\,0,\\,1,\\,0,\\,1,\\,1,\\,0,\\,0,\\,0\\,]$。\n  - 样地 $3$: $[\\,0,\\,0,\\,0,\\,0,\\,0,\\,1,\\,1,\\,1\\,]$。\n  - 样地 $4$: $[\\,1,\\,0,\\,0,\\,1,\\,0,\\,0,\\,0,\\,1\\,]$。\n  - 样地 $5$: $[\\,0,\\,0,\\,0,\\,1,\\,0,\\,0,\\,0,\\,0\\,]$。\n- 环境梯度值 (不用于计算，仅为提供背景信息): $\\mathbf{E} = [\\,0.10,\\,0.50,\\,0.90,\\,0.60,\\,0.50\\,]$。\n\n案例B (双变量性状, $D = 2$, $S = 6$, 3个样地):\n- 性状矩阵 $\\mathbf{T} \\in \\mathbb{R}^{6 \\times 2}$，行代表物种 $1$ 至 $6$：\n  $\\big[\\, [\\,0.10,\\,0.10\\,],\\; [\\,0.20,\\,0.20\\,],\\; [\\,0.30,\\,0.30\\,],\\; [\\,0.70,\\,0.70\\,],\\; [\\,0.80,\\,0.80\\,],\\; [\\,0.90,\\,0.90\\,] \\,\\big]$。\n- 样地-物种存在矩阵 $\\mathbf{A} \\in \\{0,1\\}^{3 \\times 6}$，行代表样地 $1$ 至 $3$：\n  - 样地 $1$: $[\\,1,\\,1,\\,1,\\,0,\\,0,\\,0\\,]$。\n  - 样地 $2$: $[\\,1,\\,0,\\,0,\\,0,\\,0,\\,1\\,]$。\n  - 样地 $3$: $[\\,0,\\,1,\\,0,\\,1,\\,0,\\,1\\,]$。\n- 环境梯度值 (不用于计算，仅为提供背景信息): $\\mathbf{E} = [\\,0.15,\\,0.85,\\,0.50\\,]$。\n\n零模型设置和可复现性：\n- 零模型重复次数: $R = 499$。\n- 随机种子: $123$。\n\n角度单位不适用。不涉及物理单位。所有输出均为纯数。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个连接列表，该列表含有两个案例中所有样地的 $\\mathrm{SES}$ 值，按案例A的样地1到5、后跟案例B的样地1到3的顺序排列，每个值都四舍五入到三位小数，并以逗号分隔，用方括号括起来。例如：$[\\mathrm{ses}_1,\\mathrm{ses}_2,\\dots,\\mathrm{ses}_8]$。", "solution": "对问题陈述进行验证。\n\n步骤1：提取给定信息。\n- **功能性状向量**：对于每个物种 $i \\in \\{1, \\dots, S\\}$，性状向量为 $\\mathbf{t}_i \\in \\mathbb{R}^D$。\n- **群落组成**：对于一个给定的样地，存在-缺失向量为 $\\mathbf{a} \\in \\{0, 1\\}^S$。存在的物种集合为 $I = \\{ i \\mid a_i = 1 \\}$。群落丰富度为 $m = \\sum_{i=1}^S a_i$。\n- **群落形心**：形心定义为 $\\mathbf{c} = \\left(\\sum_{i \\in I} w_i \\mathbf{t}_i\\right) \\Big/ \\left(\\sum_{i \\in I} w_i\\right)$，其中对于所有 $i \\in I$，仅存在权重 $w_i = 1$。这简化为存在的物种的性状向量的算术平均值。\n- **欧几里得距离**：对于 $i \\in I$，一个物种的性状向量到形心的距离是 $d_i = \\lVert \\mathbf{t}_i - \\mathbf{c} \\rVert_2$。\n- **功能离散度（FDis）**：$\\mathrm{FDis} = \\left(\\sum_{i \\in I} w_i d_i\\right) \\Big/ \\left(\\sum_{i \\in I} w_i\\right)$。对于 $w_i=1$，这是距离 $\\{d_i\\}_{i \\in I}$ 的算术平均值。\n- **零模型**：物种身份与性状向量之间的映射关系被随机化。对于每次重复 $r \\in \\{1, \\dots, R\\}$，对性状矩阵的行应用一个均匀随机置换 $\\pi$，创建一个置换后的集合 $\\{\\mathbf{t}_{\\pi(1)}, \\dots, \\mathbf{t}_{\\pi(S)}\\}$。然后使用原始的存在-缺失向量 $\\mathbf{a}$ 为每个样地计算 $\\mathrm{FDis}^{(r)}$。\n- **标准化效应量（SES）**：$\\mathrm{SES} = (\\mathrm{FDis}_{\\mathrm{obs}} - \\mu_{\\mathrm{null}}) / \\sigma_{\\mathrm{null}}$，其中 $\\mu_{\\mathrm{null}}$ 和 $\\sigma_{\\mathrm{null}}$ 分别是 FDis 的 $R$ 次零模型重复值的均值和标准差。如果 $\\sigma_{\\mathrm{null}} = 0$，则定义 $\\mathrm{SES}$ 为 $0$。\n- **案例A数据**：\n    - 维度 $D = 1$，物种数 $S = 8$，样地数 $= 5$。\n    - 性状向量 $\\mathbf{t} = [\\,0.05,\\,0.12,\\,0.20,\\,0.50,\\,0.60,\\,0.80,\\,0.92,\\,0.97\\,]$。\n    - 存在矩阵 $\\mathbf{A} \\in \\{0,1\\}^{5 \\times 8}$：\n        - 样地 $1$: $[\\,1,\\,1,\\,1,\\,0,\\,0,\\,0,\\,0,\\,0\\,]$。\n        - 样地 $2$: $[\\,0,\\,1,\\,0,\\,1,\\,1,\\,0,\\,0,\\,0\\,]$。\n        - 样地 $3$: $[\\,0,\\,0,\\,0,\\,0,\\,0,\\,1,\\,1,\\,1\\,]$。\n        - 样地 $4$: $[\\,1,\\,0,\\,0,\\,1,\\,0,\\,0,\\,0,\\,1\\,]$。\n        - 样地 $5$: $[\\,0,\\,0,\\,0,\\,1,\\,0,\\,0,\\,0,\\,0\\,]$。\n- **案例B数据**：\n    - 维度 $D = 2$，物种数 $S = 6$，样地数 $= 3$。\n    - 性状矩阵 $\\mathbf{T} \\in \\mathbb{R}^{6 \\times 2}$：$\\big[\\, [\\,0.10,\\,0.10\\,],\\; [\\,0.20,\\,0.20\\,],\\; [\\,0.30,\\,0.30\\,],\\; [\\,0.70,\\,0.70\\,],\\; [\\,0.80,\\,0.80\\,],\\; [\\,0.90,\\,0.90\\,] \\,\\big]$。\n    - 存在矩阵 $\\mathbf{A} \\in \\{0,1\\}^{3 \\times 6}$：\n        - 样地 $1$: $[\\,1,\\,1,\\,1,\\,0,\\,0,\\,0\\,]$。\n        - 样地 $2$: $[\\,1,\\,0,\\,0,\\,0,\\,0,\\,1\\,]$。\n        - 样地 $3$: $[\\,0,\\,1,\\,0,\\,1,\\,0,\\,1\\,]$。\n- **零模型参数**：重复次数 $R = 499$。随机种子为 $123$。\n- **输出要求**：一个包含所有样地 SES 值的单一列表，四舍五入到三位小数。\n\n步骤2：使用提取的给定信息进行验证。\n检查问题陈述的有效性。\n- **科学依据**：该问题利用了群落生态学和功能生物地理学中已建立的概念和度量，即功能离散度（FDis）和零模型检验。这些定义与主要文献（例如，Laliberté & Legendre，$2010$，Ecology）一致。所检验的生态学假说（环境过滤与限制性相似）是该领域的核心。该问题在科学上是合理的。\n- **适定性**：该问题以数学精度进行了规定。所有必要的数据（性状和群落矩阵）、参数（$R$、随机种子）以及所有计算的明确公式（形心、FDis、SES）都已提供。固定随机种子的规定确保了唯一的、可复现的数值结果。该问题是适定的。\n- **客观性**：该问题以客观的数学语言表述。不含主观性或模糊性。背景信息（环境梯度值）被明确标记为不属于计算部分。\n- **其他缺陷**：该问题是自洽的、内部一致的，并且需要非平凡的计算，因此它不是一个同义反复。其参数和数据对于生态学研究是现实的。\n\n步骤3：结论与行动。\n问题有效。现制定一个合理的解决方案。\n\n目标是为几个生态群落计算功能离散度（$\\mathrm{FDis}$）的标准化效应量（$\\mathrm{SES}$）。这需要对每个群落进行三阶段处理：（$1$）计算观测到的 $\\mathrm{FDis}$，（$2$）生成一个 $\\mathrm{FDis}$ 值的零分布，以及（$3$）根据观测值和零分布计算 $\\mathrm{SES}$。\n\n阶段1：观测功能离散度（$\\mathrm{FDis}_{\\mathrm{obs}}$）的计算。\n对于一个由存在-缺失向量 $\\mathbf{a}$ 定义的特定样地的群落，我们首先确定存在的物种集合 $I = \\{i \\mid a_i = 1\\}$ 及其对应的性状向量 $\\{\\mathbf{t}_i\\}_{i \\in I}$。存在的物种数量即为丰富度，$m = |I|$。\n如果 $m \\le 1$，根据公理，离散度为零，因此 $\\mathrm{FDis} = 0$。对于 $m > 1$，我们继续。\n首先，计算群落性状空间的形心。由于权重 $w_i$ 均为 $1$，形心 $\\mathbf{c}$ 是存在的物种的性状向量的算术平均值：\n$$ \\mathbf{c} = \\frac{1}{m} \\sum_{i \\in I} \\mathbf{t}_i $$\n接下来，对于每个存在的物种 $i \\in I$，计算其性状向量 $\\mathbf{t}_i$ 到形心 $\\mathbf{c}$ 的欧几里得距离 $d_i$：\n$$ d_i = \\lVert \\mathbf{t}_i - \\mathbf{c} \\rVert_2 = \\sqrt{\\sum_{k=1}^D (t_{ik} - c_k)^2} $$\n其中 $D$ 是性状的数量（空间的维度）。\n最后，功能离散度 $\\mathrm{FDis}$ 是这些距离的算术平均值。使用原始、未置换的性状数据计算得出的这个值是观测到的功能离散度 $\\mathrm{FDis}_{\\mathrm{obs}}$。\n$$ \\mathrm{FDis}_{\\mathrm{obs}} = \\frac{1}{m} \\sum_{i \\in I} d_i $$\n此过程应用于案例A和案例B中的每个样地。\n\n阶段2：生成零分布。\n零假设假定，观测到的群落组装相对于物种性状是随机的。所选的零模型通过随机化物种身份与其性状向量之间的关联来实现这一点。这个过程重复 $R$ 次，以创建一个在随机条件下预期的 $\\mathrm{FDis}$ 值分布。\n对于从 $1$ 到 $R = 499$ 的每次重复 $r$：\n1. 生成物种索引 $\\{1, \\dots, S\\}$ 的一个随机置换 $\\pi$。固定的随机种子 $123$ 确保每次执行的置换序列都是相同的。\n2. 将此置换应用于全局物种-性状矩阵 $\\mathbf{T}$ 的行，创建一个置换后的性状矩阵 $\\mathbf{T}^{(r)}$。因此，物种 $i$ 现在被赋予原属于物种 $\\pi(i)$ 的性状向量。\n3. 对于每个样地，使用原始的、固定的存在-缺失向量 $\\mathbf{a}$ 和来自 $\\mathbf{T}^{(r)}$ 的置换后性状，重新计算功能离散度 $\\mathrm{FDis}^{(r)}$。\n此过程为每个样地填充了一个包含 $R$ 个零模型 $\\mathrm{FDis}$ 值的向量：$\\{\\mathrm{FDis}^{(1)}, \\mathrm{FDis}^{(2)}, \\dots, \\mathrm{FDis}^{(R)}\\}$。\n\n阶段3：标准化效应量（$\\mathrm{SES}$）的计算。\n$\\mathrm{SES}$ 以标准差为单位，量化了观测值 $\\mathrm{FDis}_{\\mathrm{obs}}$ 与零期望值的偏差。\n对于每个样地，我们首先计算在阶段2中生成的零分布的均值 $\\mu_{\\mathrm{null}}$ 和标准差 $\\sigma_{\\mathrm{null}}$：\n$$ \\mu_{\\mathrm{null}} = \\frac{1}{R} \\sum_{r=1}^R \\mathrm{FDis}^{(r)} $$\n$$ \\sigma_{\\mathrm{null}} = \\sqrt{\\frac{1}{R-1} \\sum_{r=1}^R (\\mathrm{FDis}^{(r)} - \\mu_{\\mathrm{null}})^2} $$\n此处使用样本标准差（分母为 $R-1$）是合适的。\n然后计算 $\\mathrm{SES}$：\n$$ \\mathrm{SES} = \\frac{\\mathrm{FDis}_{\\mathrm{obs}} - \\mu_{\\mathrm{null}}}{\\sigma_{\\mathrm{null}}} $$\n对于 $\\sigma_{\\mathrm{null}} = 0$ 的情况，定义了一个特殊条件。如果所有零模型重复产生相同的 $\\mathrm{FDis}$ 值，就会出现这种情况，这在丰富度 $m \\le 1$ 的群落中是预期的。在这种情况下，$\\mathrm{SES}$ 定义为 $0$ 以防止除以零。\n负的 $\\mathrm{SES}$ 表示观测到的性状比随机预期的更聚集（$\\mathrm{FDis}_{\\mathrm{obs}} < \\mu_{\\mathrm{null}}$），这被解释为环境过滤的证据。正的 $\\mathrm{SES}$ 表示性状比随机预期的更分散（$\\mathrm{FDis}_{\\mathrm{obs}} > \\mu_{\\mathrm{null}}$），这被解释为限制性相似的证据。\n最终输出是这些 $\\mathrm{SES}$ 值的列表，四舍五入到三位小数，按案例A的5个样地后跟案例B的3个样地的顺序排列。\n\n实现将严格遵循这些阶段。为保证可复现性，将使用指定的种子 $123$ 初始化一个 numpy 随机数生成器。整个过程是确定性的。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating the standardized effect size of functional dispersion\n    for two test cases based on a trait-label randomization null model.\n    \"\"\"\n\n    # --- Define Test Cases ---\n\n    # Case A (univariate traits, D=1, S=8, 5 sites)\n    traits_A = np.array([0.05, 0.12, 0.20, 0.50, 0.60, 0.80, 0.92, 0.97]).reshape(-1, 1)\n    presences_A = np.array([\n        [1, 1, 1, 0, 0, 0, 0, 0],  # Site 1\n        [0, 1, 0, 1, 1, 0, 0, 0],  # Site 2\n        [0, 0, 0, 0, 0, 1, 1, 1],  # Site 3\n        [1, 0, 0, 1, 0, 0, 0, 1],  # Site 4\n        [0, 0, 0, 1, 0, 0, 0, 0],  # Site 5\n    ])\n\n    # Case B (bivariate traits, D=2, S=6, 3 sites)\n    traits_B = np.array([\n        [0.10, 0.10], [0.20, 0.20], [0.30, 0.30],\n        [0.70, 0.70], [0.80, 0.80], [0.90, 0.90]\n    ])\n    presences_B = np.array([\n        [1, 1, 1, 0, 0, 0],  # Site 1\n        [1, 0, 0, 0, 0, 1],  # Site 2\n        [0, 1, 0, 1, 0, 1],  # Site 3\n    ])\n\n    test_cases = [\n        (traits_A, presences_A),\n        (traits_B, presences_B),\n    ]\n\n    # --- Null Model Settings ---\n    R = 499\n    RANDOM_SEED = 123\n    rng = np.random.default_rng(RANDOM_SEED)\n\n    # --- Main Calculation Logic ---\n\n    def calculate_fdis(traits, presence_vector):\n        \"\"\"\n        Calculates Functional Dispersion (FDis) for a single community.\n        \"\"\"\n        present_indices = np.where(presence_vector == 1)[0]\n        richness = len(present_indices)\n\n        if richness <= 1:\n            return 0.0\n\n        present_traits = traits[present_indices]\n        \n        # Calculate centroid (community-weighted mean trait)\n        centroid = np.mean(present_traits, axis=0)\n\n        # Calculate Euclidean distances to the centroid\n        distances = np.linalg.norm(present_traits - centroid, axis=1)\n\n        # FDis is the mean distance to the centroid\n        fdis = np.mean(distances)\n        \n        return fdis\n\n    all_ses_results = []\n\n    for traits, presences_matrix in test_cases:\n        num_species = traits.shape[0]\n        \n        for site_presence_vector in presences_matrix:\n            # 1. Calculate observed FDis\n            fdis_obs = calculate_fdis(traits, site_presence_vector)\n\n            # 2. Generate null distribution of FDis\n            fdis_null = np.zeros(R)\n            for r in range(R):\n                permuted_indices = rng.permutation(num_species)\n                permuted_traits = traits[permuted_indices]\n                fdis_null[r] = calculate_fdis(permuted_traits, site_presence_vector)\n            \n            # 3. Calculate SES\n            mu_null = np.mean(fdis_null)\n            # Use ddof=1 for sample standard deviation, though with R=499 difference is negligible.\n            # R-1 is specified in the solution text.\n            sigma_null = np.std(fdis_null, ddof=1)\n\n            if sigma_null == 0.0:\n                ses = 0.0\n            else:\n                ses = (fdis_obs - mu_null) / sigma_null\n\n            all_ses_results.append(round(ses, 3))\n\n    # --- Final Output Formatting ---\n    # The final print statement must produce only the specified single-line format.\n    formatted_results = [f\"{res:.3f}\" for res in all_ses_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n# Execute the main function.\nsolve()\n```", "id": "2472458"}]}