{"hands_on_practices": [{"introduction": "在深入探讨复杂的系统发育方法之前，我们必须首先掌握一个最基本的概念：如何在系统发育树上量化物种间的演化距离。本练习旨在通过一个基础但重要的计算任务，巩固您对系统发育距离的理解。您将通过两种不同的方法——直接路径加和法与基于节点深度的公式法——来计算距离，从而验证这两种方法在数学上的等价性，并确保您能准确地从树状图中提取核心信息 [@problem_id:2520702]。", "problem": "在比较群落生态学中，物种间的成对系统发育距离被用来量化进化相关性，这是系统发育聚集或分散检验的基础。考虑一个包含四个叶尖 $\\{A,B,C,D\\}$ 的有根二叉系统发育树，其分支长度为非负值，单位为每位点的期望替换数。根节点分裂成两个支系：第一个支系包含叶尖 $A$ 和 $B$，第二个支系包含叶尖 $C$ 和 $D$。从根节点到作为 $A$ 和 $B$ 最近共同祖先的内部节点的分支长度为 $0.5$。从该内部节点到 $A$ 和 $B$ 的分支长度分别为 $0.6$ 和 $0.9$。从根节点到作为 $C$ 和 $D$ 最近共同祖先的内部节点的分支长度为 $0.4$。从该内部节点到 $C$ 和 $D$ 的分支长度分别为 $0.3$ 和 $1.1$。\n\n仅使用树（具有可加边长的连通无环图）上距离的基本定义以及最近共同祖先（MRCA）的定义，完成以下操作：\n\n- 对于每对无序叶尖 $\\{i,j\\} \\subset \\{A,B,C,D\\}$，将 $s_{ij}$ 定义为 $i$ 和 $j$ 之间唯一路径上的分支长度之和，通过直接遍历树上的边来计算。\n- 从第一性原理出发，根据从根到叶尖的深度和 $\\operatorname{MRCA}(i,j)$ 的深度，推导叶尖 $i$ 和 $j$ 之间的树距离 $d_{ij}$ 的表达式，然后对所有无序对计算 $d_{ij}$。\n- 定义差异\n$$\nE \\equiv \\sum_{i<j} \\left| d_{ij} - s_{ij} \\right|,\n$$\n其中，总和是对六个无序对 $\\{A,B\\}, \\{A,C\\}, \\{A,D\\}, \\{B,C\\}, \\{B,D\\}, \\{C,D\\}$ 进行的。\n\n$E$ 的值是多少？用每位点的替换数来表示你的答案。提供精确值，无需四舍五入。", "solution": "所述问题定义明确、内部一致，并且在科学上基于应用于系统发育学的图论原理。这是一个有效的问题。\n\n我们首先形式化系统发育树的结构和给定的参数。该树有一组叶尖（叶节点） $T = \\{A, B, C, D\\}$ 和内部节点，包括根节点 $R$。拓扑结构描述如下：根节点 $R$ 是两个支系 $\\{A, B\\}$ 和 $\\{C, D\\}$ 的最近共同祖先（MRCA）。设 $N_{AB}$ 是叶尖 $A$ 和 $B$ 的 MRCA，设 $N_{CD}$ 是叶尖 $C$ 和 $D$ 的 MRCA。对于任一对叶尖，如果一个来自 $\\{A, B\\}$ 而另一个来自 $\\{C, D\\}$，那么它们的 MRCA 就是根节点 $R$。\n\n分支长度，用 $l(u, v)$ 表示节点 $u$ 和 $v$ 之间边的长度，给定如下：\n$l(R, N_{AB}) = 0.5$\n$l(N_{AB}, A) = 0.6$\n$l(N_{AB}, B) = 0.9$\n$l(R, N_{CD}) = 0.4$\n$l(N_{CD}, C) = 0.3$\n$l(N_{CD}, D) = 1.1$\n\n这个问题需要一个三部分的分析。\n\n首先，我们计算所有六对无序叶尖 $\\{i, j\\}$ 的 $s_{ij}$。量 $s_{ij}$ 定义为连接叶尖 $i$ 和 $j$ 的唯一路径上的分支长度之和。\n\n对于 $\\{A, B\\}$：路径是 $A \\leftrightarrow N_{AB} \\leftrightarrow B$。\n$s_{AB} = l(N_{AB}, A) + l(N_{AB}, B) = 0.6 + 0.9 = 1.5$。\n\n对于 $\\{C, D\\}$：路径是 $C \\leftrightarrow N_{CD} \\leftrightarrow D$。\n$s_{CD} = l(N_{CD}, C) + l(N_{CD}, D) = 0.3 + 1.1 = 1.4$。\n\n对于 $\\{A, C\\}$：路径是 $A \\leftrightarrow N_{AB} \\leftrightarrow R \\leftrightarrow N_{CD} \\leftrightarrow C$。\n$s_{AC} = l(N_{AB}, A) + l(R, N_{AB}) + l(R, N_{CD}) + l(N_{CD}, C) = 0.6 + 0.5 + 0.4 + 0.3 = 1.8$。\n\n对于 $\\{A, D\\}$：路径是 $A \\leftrightarrow N_{AB} \\leftrightarrow R \\leftrightarrow N_{CD} \\leftrightarrow D$。\n$s_{AD} = l(N_{AB}, A) + l(R, N_{AB}) + l(R, N_{CD}) + l(N_{CD}, D) = 0.6 + 0.5 + 0.4 + 1.1 = 2.6$。\n\n对于 $\\{B, C\\}$：路径是 $B \\leftrightarrow N_{AB} \\leftrightarrow R \\leftrightarrow N_{CD} \\leftrightarrow C$。\n$s_{BC} = l(N_{AB}, B) + l(R, N_{AB}) + l(R, N_{CD}) + l(N_{CD}, C) = 0.9 + 0.5 + 0.4 + 0.3 = 2.1$。\n\n对于 $\\{B, D\\}$：路径是 $B \\leftrightarrow N_{AB} \\leftrightarrow R \\leftrightarrow N_{CD} \\leftrightarrow D$。\n$s_{BD} = l(N_{AB}, B) + l(R, N_{AB}) + l(R, N_{CD}) + l(N_{CD}, D) = 0.9 + 0.5 + 0.4 + 1.1 = 2.9$。\n\n其次，我们必须根据从根到叶尖的深度和 MRCA 的深度推导树距离 $d_{ij}$ 的表达式。设 $\\delta(v)$ 为任意节点 $v$ 的深度，定义为从根节点 $R$ 到 $v$ 的路径上的分支长度之和。根据定义，$\\delta(R) = 0$。\n\n树中距离的基本定义是路径和距离，这正是 $s_{ij}$ 的定义方式。让我们用 $\\mathcal{D}(i, j)$ 表示这个基本距离。任意两个叶尖 $i$ 和 $j$ 之间的唯一路径由两部分组成：从 $i$ 到 $\\operatorname{MRCA}(i, j)$ 的路径和从 $\\operatorname{MRCA}(i, j)$ 到 $j$ 的路径。\n从 $i$ 到 $\\operatorname{MRCA}(i, j)$ 的路径长度是该路径上的分支长度之和。这条路径是从 $i$ 到根节点 $R$ 的路径的一部分。因此，其长度是 $i$ 的深度与 $\\operatorname{MRCA}(i, j)$ 深度之差。\n路径长度 $(i \\to \\operatorname{MRCA}(i, j)) = \\delta(i) - \\delta(\\operatorname{MRCA}(i, j))$。\n同样，对于叶尖 $j$：\n路径长度 $(j \\to \\operatorname{MRCA}(i, j)) = \\delta(j) - \\delta(\\operatorname{MRCA}(i, j))$。\n总距离 $\\mathcal{D}(i, j)$ 是这两段路径长度之和：\n$\\mathcal{D}(i, j) = (\\delta(i) - \\delta(\\operatorname{MRCA}(i, j))) + (\\delta(j) - \\delta(\\operatorname{MRCA}(i, j)))$。\n这可以简化为：\n$\\mathcal{D}(i, j) = \\delta(i) + \\delta(j) - 2 \\cdot \\delta(\\operatorname{MRCA}(i, j))$。\n\n问题将 $d_{ij}$ 定义为使用此推导表达式计算出的量。因此，我们有：\n$$d_{ij} \\equiv \\delta(i) + \\delta(j) - 2 \\cdot \\delta(\\operatorname{MRCA}(i, j))$$\n由于该表达式是直接从路径和距离的第一性原理推导出来的，因此在数学上它等同于 $s_{ij}$。也就是说，对于任何具有可加分支长度的树，都有 $d_{ij} = s_{ij}$。\n\n我们现在评估所有相关节点的深度：\n$\\delta(R) = 0$\n$\\delta(N_{AB}) = l(R, N_{AB}) = 0.5$\n$\\delta(N_{CD}) = l(R, N_{CD}) = 0.4$\n$\\delta(A) = \\delta(N_{AB}) + l(N_{AB}, A) = 0.5 + 0.6 = 1.1$\n$\\delta(B) = \\delta(N_{AB}) + l(N_{AB}, B) = 0.5 + 0.9 = 1.4$\n$\\delta(C) = \\delta(N_{CD}) + l(N_{CD}, C) = 0.4 + 0.3 = 0.7$\n$\\delta(D) = \\delta(N_{CD}) + l(N_{CD}, D) = 0.4 + 1.1 = 1.5$\n\n现在我们计算所有对的 $d_{ij}$：\n$\\operatorname{MRCA}(A, B) = N_{AB}$。\n$d_{AB} = \\delta(A) + \\delta(B) - 2 \\cdot \\delta(N_{AB}) = 1.1 + 1.4 - 2(0.5) = 2.5 - 1.0 = 1.5$。\n\n$\\operatorname{MRCA}(C, D) = N_{CD}$。\n$d_{CD} = \\delta(C) + \\delta(D) - 2 \\cdot \\delta(N_{CD}) = 0.7 + 1.5 - 2(0.4) = 2.2 - 0.8 = 1.4$。\n\n对于所有其他对，MRCA 是根节点 $R$。\n$\\operatorname{MRCA}(A, C) = R$。\n$d_{AC} = \\delta(A) + \\delta(C) - 2 \\cdot \\delta(R) = 1.1 + 0.7 - 2(0) = 1.8$。\n\n$\\operatorname{MRCA}(A, D) = R$。\n$d_{AD} = \\delta(A) + \\delta(D) - 2 \\cdot \\delta(R) = 1.1 + 1.5 - 2(0) = 2.6$。\n\n$\\operatorname{MRCA}(B, C) = R$。\n$d_{BC} = \\delta(B) + \\delta(C) - 2 \\cdot \\delta(R) = 1.4 + 0.7 - 2(0) = 2.1$。\n\n$\\operatorname{MRCA}(B, D) = R$。\n$d_{BD} = \\delta(B) + \\delta(D) - 2 \\cdot \\delta(R) = 1.4 + 1.5 - 2(0) = 2.9$。\n\n比较这两组值：\n$s_{AB} = 1.5$ 且 $d_{AB} = 1.5$。\n$s_{CD} = 1.4$ 且 $d_{CD} = 1.4$。\n$s_{AC} = 1.8$ 且 $d_{AC} = 1.8$。\n$s_{AD} = 2.6$ 且 $d_{AD} = 2.6$。\n$s_{BC} = 2.1$ 且 $d_{BC} = 2.1$。\n$s_{BD} = 2.9$ 且 $d_{BD} = 2.9$。\n正如推导所预测的，$s_{ij} = d_{ij}$ 对所有对 $\\{i,j\\}$ 成立。\n\n第三，我们计算总差异 $E$。\n$$E \\equiv \\sum_{i<j} \\left| d_{ij} - s_{ij} \\right|$$\n总和是对六个无序对进行的。\n$E = |d_{AB} - s_{AB}| + |d_{AC} - s_{AC}| + |d_{AD} - s_{AD}| + |d_{BC} - s_{BC}| + |d_{BD} - s_{BD}| + |d_{CD} - s_{CD}|$\n$E = |1.5 - 1.5| + |1.8 - 1.8| + |2.6 - 2.6| + |2.1 - 2.1| + |2.9 - 2.9| + |1.4 - 1.4|$\n$E = 0 + 0 + 0 + 0 + 0 + 0 = 0$。\n\n这个问题是对树上距离基本定义的概念性检验。计算成对距离的两种方法，即直接路径求和 ($s_{ij}$) 和基于深度的公式 ($d_{ij}$)，在数学上是等价的。因此，差异 $E$ 必须为零。计算结果证实了这一点。", "answer": "$$\\boxed{0}$$", "id": "2520702"}, {"introduction": "掌握了物种间距离的计算方法后，我们便可以将其应用于生态群落的比较分析中。UniFrac距离是微生物生态学中一个强大的工具，它通过整合系统发育信息来评估群落间的相似性。本练习将引导您亲手计算未加权（定性）和加权（定量）的UniFrac距离，从而深刻理解仅考虑物种存在与否和考虑物种相对丰度对群落 beta 多样性分析结果的巨大影响 [@problem_id:2520695]。", "problem": "考虑两个微生物组样本，记为样本 $\\mathrm{S1}$ 和样本 $\\mathrm{S2}$，它们从一个群落中提取，该群落的分类单元由一个具有可加性分支长度的有根、二叉系统发育树表示。该树有五个末端分类单元（操作分类单元，OTU），标记为 $\\mathrm{A}$、$\\mathrm{B}$、$\\mathrm{C}$、$\\mathrm{D}$ 和 $\\mathrm{E}$。其拓扑结构和分支长度如下，每行表示一个从父节点（左）到子节点（右）的分支，括号内为分支长度：\n- $\\mathrm{root} \\to \\mathrm{X}$ ($0.4$)，$\\mathrm{root} \\to \\mathrm{Y}$ ($0.6$)\n- $\\mathrm{X} \\to \\mathrm{A}$ ($0.2$)，$\\mathrm{X} \\to \\mathrm{B}$ ($0.3$)\n- $\\mathrm{Y} \\to \\mathrm{Y1}$ ($0.25$)，$\\mathrm{Y} \\to \\mathrm{E}$ ($0.35$)\n- $\\mathrm{Y1} \\to \\mathrm{C}$ ($0.1$)，$\\mathrm{Y1} \\to \\mathrm{D}$ ($0.15$)\n\n每个样本中各OTU的观测计数如下：\n- $\\mathrm{S1}$：$\\mathrm{A}=40$，$\\mathrm{B}=10$，$\\mathrm{C}=5$，$\\mathrm{D}=0$，$\\mathrm{E}=45$\n- $\\mathrm{S2}$：$\\mathrm{A}=0$，$\\mathrm{B}=30$，$\\mathrm{C}=35$，$\\mathrm{D}=25$，$\\mathrm{E}=10$\n\n使用以下基本定义。\n- 分支上的存在/缺失：如果一个样本在该分支所有后代OTU上的计数总和大于 $0$，则称该样本在该分支上“存在”。\n- 非加权UniFrac距离 $d_{U}$：仅在两个样本之一中存在的总分支长度，除以至少在两个样本之一中存在的总分支长度。\n- 加权UniFrac距离 $d_{W}$：首先将每个样本内的计数转换为相对丰度，使所有OTU的相对丰度总和为 $1$。对于每个长度为 $L_{b}$ 的分支 $b$，设 $p_{\\mathrm{S1}}(b)$ 和 $p_{\\mathrm{S2}}(b)$ 分别为样本 $\\mathrm{S1}$ 和 $\\mathrm{S2}$ 在分支 $b$ 的后代OTU上的相对丰度之和。则标准化加权UniFrac距离为\n$$\nd_{W} \\;=\\; \\frac{\\sum_{b} L_{b}\\,|p_{\\mathrm{S1}}(b) - p_{\\mathrm{S2}}(b)|}{\\sum_{b} L_{b}\\,\\big(p_{\\mathrm{S1}}(b)+p_{\\mathrm{S2}}(b)\\big)}.\n$$\n\n任务：\n1. 根据上述定义，从基本原理出发计算 $\\mathrm{S1}$ 和 $\\mathrm{S2}$ 之间的 $d_{U}$。\n2. 根据上述定义，从基本原理出发计算 $\\mathrm{S1}$ 和 $\\mathrm{S2}$ 之间的 $d_{W}$。\n3. 用文字简要解释在此案例中 $d_{U}$ 和 $d_{W}$ 为何不同，重点关注稀有谱系的贡献以及丰度如何与分支长度相互作用。\n4. 最后，计算比值 $R = d_{W}/d_{U}$，并将 $R$ 报告为一个无量纲数，四舍五入到四位有效数字。\n\n将最终报告的比值 $R$ 表示为一个纯数字（无单位）。最终数值答案必须四舍五入到四位有效数字。", "solution": "该问题具有科学依据，提法明确，并包含了唯一解所需的所有信息。我们将按照规定进行计算。该问题要求计算两种生态距离度量，即非加权和加权UniFrac距离（$d_U$ 和 $d_W$），然后解释它们的差异并计算其比值 $R$。\n\n首先，我们必须重建系统发育树，并列出所有分支及其对应的长度 $L_b$。该树共有 $8$ 个分支。为清楚起见，我们对它们进行标记：\n\\begin{itemize}\n    \\item $b_1$：$\\mathrm{root} \\to \\mathrm{X}$，$L_1 = 0.4$\n    \\item $b_2$：$\\mathrm{root} \\to \\mathrm{Y}$，$L_2 = 0.6$\n    \\item $b_3$：$\\mathrm{X} \\to \\mathrm{A}$，$L_3 = 0.2$\n    \\item $b_4$：$\\mathrm{X} \\to \\mathrm{B}$，$L_4 = 0.3$\n    \\item $b_5$：$\\mathrm{Y} \\to \\mathrm{Y1}$，$L_5 = 0.25$\n    \\item $b_6$：$\\mathrm{Y} \\to \\mathrm{E}$，$L_6 = 0.35$\n    \\item $b_7$：$\\mathrm{Y1} \\to \\mathrm{C}$，$L_7 = 0.1$\n    \\item $b_8$：$\\mathrm{Y1} \\to \\mathrm{D}$，$L_8 = 0.15$\n\\end{itemize}\n每个分支的后代末端分类单元集合如下：\n\\begin{itemize}\n    \\item $b_1$ 的后代：$\\{\\mathrm{A}, \\mathrm{B}\\}$\n    \\item $b_2$ 的后代：$\\{\\mathrm{C}, \\mathrm{D}, \\mathrm{E}\\}$\n    \\item $b_3$ 的后代：$\\{\\mathrm{A}\\}$\n    \\item $b_4$ 的后代：$\\{\\mathrm{B}\\}$\n    \\item $b_5$ 的后代：$\\{\\mathrm{C}, \\mathrm{D}\\}$\n    \\item $b_6$ 的后代：$\\{\\mathrm{E}\\}$\n    \\item $b_7$ 的后代：$\\{\\mathrm{C}\\}$\n    \\item $b_8$ 的后代：$\\{\\mathrm{D}\\}$\n\\end{itemize}\n\n观测到的计数如下：\n\\begin{itemize}\n    \\item 样本 S1：$\\mathrm{A}=40$，$\\mathrm{B}=10$，$\\mathrm{C}=5$，$\\mathrm{D}=0$，$\\mathrm{E}=45$\n    \\item 样本 S2：$\\mathrm{A}=0$，$\\mathrm{B}=30$，$\\mathrm{C}=35$，$\\mathrm{D}=25$，$\\mathrm{E}=10$\n\\end{itemize}\n\n**任务1：计算非加权UniFrac距离 $d_U$**\n\n非加权UniFrac距离定义为 $d_U = \\frac{\\text{仅存在于一个样本中的分支长度之和}}{\\text{至少存在于一个样本中的分支长度之和}}$。如果一个分支的后代分类单元的计数总和大于 $0$，则认为该分支存在。\n\n我们为每个样本的每个分支制表以记录其存在/缺失状态：\n\\begin{itemize}\n    \\item $b_1$ ($\\{\\mathrm{A}, \\mathrm{B}\\}$)：S1 总和 = $40+10 = 50>0$ (存在)；S2 总和 = $0+30 = 30>0$ (存在)。\n    \\item $b_2$ ($\\{\\mathrm{C}, \\mathrm{D}, \\mathrm{E}\\}$)：S1 总和 = $5+0+45 = 50>0$ (存在)；S2 总和 = $35+25+10 = 70>0$ (存在)。\n    \\item $b_3$ ($\\{\\mathrm{A}\\}$)：S1 总和 = $40>0$ (存在)；S2 总和 = $0$ (缺失)。\n    \\item $b_4$ ($\\{\\mathrm{B}\\}$)：S1 总和 = $10>0$ (存在)；S2 总和 = $30>0$ (存在)。\n    \\item $b_5$ ($\\{\\mathrm{C}, \\mathrm{D}\\}$)：S1 总和 = $5+0 = 5>0$ (存在)；S2 总和 = $35+25 = 60>0$ (存在)。\n    \\item $b_6$ ($\\{\\mathrm{E}\\}$)：S1 总和 = $45>0$ (存在)；S2 总和 = $10>0$ (存在)。\n    \\item $b_7$ ($\\{\\mathrm{C}\\}$)：S1 总和 = $5>0$ (存在)；S2 总和 = $35>0$ (存在)。\n    \\item $b_8$ ($\\{\\mathrm{D}\\}$)：S1 总和 = $0$ (缺失)；S2 总和 = $25>0$ (存在)。\n\\end{itemize}\n\n仅存在于一个样本中的分支是 $b_3$（仅在S1中）和 $b_8$（仅在S2中）。它们长度的总和构成了 $d_U$ 的分子：\n$$ \\text{分子} = L_3 + L_8 = 0.2 + 0.15 = 0.35 $$\n分母是至少存在于两个样本之一中的所有分支的总长度。根据我们的分析，所有 $8$ 个分支都至少存在于一个样本中。因此，分母是整个树的总长度：\n$$ \\text{分母} = \\sum_{i=1}^{8} L_i = 0.4 + 0.6 + 0.2 + 0.3 + 0.25 + 0.35 + 0.1 + 0.15 = 2.35 $$\n因此，非加权UniFrac距离为：\n$$ d_U = \\frac{0.35}{2.35} = \\frac{35}{235} = \\frac{7}{47} $$\n\n**任务2：计算加权UniFrac距离 $d_W$**\n\n加权UniFrac距离 $d_W$ 需要将计数转换为相对丰度。每个样本中的读数总数为 $100$。\n\\begin{itemize}\n    \\item 样本 S1 的丰度：$p_{\\mathrm{A},1}=0.4$, $p_{\\mathrm{B},1}=0.1$, $p_{\\mathrm{C},1}=0.05$, $p_{\\mathrm{D},1}=0$, $p_{\\mathrm{E},1}=0.45$\n    \\item 样本 S2 的丰度：$p_{\\mathrm{A},2}=0$, $p_{\\mathrm{B},2}=0.3$, $p_{\\mathrm{C},2}=0.35$, $p_{\\mathrm{D},2}=0.25$, $p_{\\mathrm{E},2}=0.1$\n\\end{itemize}\n对于每个分支 $b$，我们计算 $p_{\\mathrm{S1}}(b)$ 和 $p_{\\mathrm{S2}}(b)$，即其后代分类单元的相对丰度之和。\n\\begin{itemize}\n    \\item $b_1$: $p_{\\mathrm{S1}}(b_1)=0.4+0.1=0.5$; $p_{\\mathrm{S2}}(b_1)=0+0.3=0.3$\n    \\item $b_2$: $p_{\\mathrm{S1}}(b_2)=0.05+0+0.45=0.5$; $p_{\\mathrm{S2}}(b_2)=0.35+0.25+0.1=0.7$\n    \\item $b_3$: $p_{\\mathrm{S1}}(b_3)=0.4$; $p_{\\mathrm{S2}}(b_3)=0$\n    \\item $b_4$: $p_{\\mathrm{S1}}(b_4)=0.1$; $p_{\\mathrm{S2}}(b_4)=0.3$\n    \\item $b_5$: $p_{\\mathrm{S1}}(b_5)=0.05+0=0.05$; $p_{\\mathrm{S2}}(b_5)=0.35+0.25=0.6$\n    \\item $b_6$: $p_{\\mathrm{S1}}(b_6)=0.45$; $p_{\\mathrm{S2}}(b_6)=0.1$\n    \\item $b_7$: $p_{\\mathrm{S1}}(b_7)=0.05$; $p_{\\mathrm{S2}}(b_7)=0.35$\n    \\item $b_8$: $p_{\\mathrm{S1}}(b_8)=0$; $p_{\\mathrm{S2}}(b_8)=0.25$\n\\end{itemize}\n现在我们计算 $d_W = \\frac{\\sum_{b} L_{b}\\,|p_{\\mathrm{S1}}(b) - p_{\\mathrm{S2}}(b)|}{\\sum_{b} L_{b}\\,\\big(p_{\\mathrm{S1}}(b)+p_{\\mathrm{S2}}(b)\\big)}$ 的分子和分母。\n\n分子：$\\sum L_{b}\\,|p_{\\mathrm{S1}}(b) - p_{\\mathrm{S2}}(b)|$\n$$ N = 0.4|0.5-0.3| + 0.6|0.5-0.7| + 0.2|0.4-0| + 0.3|0.1-0.3| + 0.25|0.05-0.6| + 0.35|0.45-0.1| + 0.1|0.05-0.35| + 0.15|0-0.25| $$\n$$ N = 0.4(0.2) + 0.6(0.2) + 0.2(0.4) + 0.3(0.2) + 0.25(0.55) + 0.35(0.35) + 0.1(0.3) + 0.15(0.25) $$\n$$ N = 0.08 + 0.12 + 0.08 + 0.06 + 0.1375 + 0.1225 + 0.03 + 0.0375 = 0.6675 $$\n\n分母：$\\sum L_{b}\\,(p_{\\mathrm{S1}}(b) + p_{\\mathrm{S2}}(b))$\n$$ D = 0.4(0.5+0.3) + 0.6(0.5+0.7) + 0.2(0.4+0) + 0.3(0.1+0.3) + 0.25(0.05+0.6) + 0.35(0.45+0.1) + 0.1(0.05+0.35) + 0.15(0+0.25) $$\n$$ D = 0.4(0.8) + 0.6(1.2) + 0.2(0.4) + 0.3(0.4) + 0.25(0.65) + 0.35(0.55) + 0.1(0.4) + 0.15(0.25) $$\n$$ D = 0.32 + 0.72 + 0.08 + 0.12 + 0.1625 + 0.1925 + 0.04 + 0.0375 = 1.6725 $$\n\n加权UniFrac距离为：\n$$ d_W = \\frac{0.6675}{1.6725} = \\frac{6675}{16725} = \\frac{267}{669} = \\frac{89}{223} $$\n\n**任务3：解释 $d_U$ 和 $d_W$ 之间的差异**\n\n我们计算得出 $d_U = \\frac{7}{47} \\approx 0.149$ 和 $d_W = \\frac{89}{223} \\approx 0.399$。加权UniFrac距离远大于非加权距离 ($d_W > 2.5 \\times d_U$）。这表明，虽然两个样本共享了大部分系统发育谱系，但这些谱系的相对丰度却截然不同。\n\n$d_U$ 只对存在/缺失信息敏感。它的值很小，因为样本之间唯一的定性差异是S1中存在分类单元$\\mathrm{A}$（在S2中缺失）和S2中存在分类单元$\\mathrm{D}$（在S1中缺失）。这对应于末端分支 $b_3$ 和 $b_8$，它们的总长度（$0.35$）相对于总树长（$2.35$）来说很小。$d_U$ 忽略了其他分类单元（如 $\\mathrm{C}$ 和 $\\mathrm{E}$）虽然存在于两个样本中，但其丰度却大相径庭这一事实。\n\n$d_W$ 包含了丰度信息。它的值很大，因为它对树上许多分支的相对丰度的大幅变化很敏感，而不仅仅是那些分类单元完全缺失的分支。例如，分类单元 $\\mathrm{E}$ 在两个样本中都存在（通过其末端分支对 $d_U$ 分子的贡献为 $0$），但其丰度从S1中的 $45\\%$ 骤降至S2中的 $10\\%$。这个巨大的比例变化，再乘以分支长度 $L_6=0.35$，对 $d_W$ 的分子做出了巨大贡献（$0.35 \\times|0.45 - 0.10| = 0.1225$）。同样，分类单元 $\\mathrm{B}$ 和 $\\mathrm{C}$ 的主要丰度变化也对 $d_W$ 有显著贡献。因此，$d_W$ 捕捉到了这样一个信息：即使群落来自相似的谱系集合，它们也是由系统发育树的不同部分所主导的。\n\n**任务4：计算比值 $R = d_W/d_U$**\n\n使用前面计算的精确分数形式：\n$$ R = \\frac{d_W}{d_U} = \\frac{89/223}{7/47} = \\frac{89 \\times 47}{223 \\times 7} = \\frac{4183}{1561} $$\n现在我们计算数值并四舍五入到四位有效数字：\n$$ R \\approx 2.6796925... $$\n四舍五入到四位有效数字得到 $2.680$。", "answer": "$$\\boxed{2.680}$$", "id": "2520695"}, {"introduction": "除了分析群落结构，系统发育信息在检验性状演化假说方面也至关重要，这便是系统发育比较方法的用武之地。系统发育广义最小二乘法（PGLS）是解决因共享祖先而导致的物种数据非独立性问题的经典方法。本练习模拟了一个实际研究情景，不仅要求您应用PGLS模型，还需处理一个常见的数据挑战——测量误差，通过将误差方差$E$整合到协方差矩阵中，学习如何构建一个更符合现实的统计模型 [@problem_id:2520685]。", "problem": "一位研究人员研究了在考虑系统发育相关性和不等的测量误差方差的情况下，一个连续生态响应性状 $y$ 如何与一个连续预测变量 $x$ 在 $3$ 个物种间呈线性关系。在一个具有已知速率参数 $\\sigma^{2}$ 和超度量树的性状演化布朗运动模型下，性状向量被建模为多元正态分布，其协方差由系统发育协方差和测量误差方差之和给出。具体而言，总协方差为 $\\sigma^{2} C + E$，其中 $C$ 是由共享分支长度所隐含的系统发育协方差，$E$ 是一个已知的物种特异性测量误差方差的对角矩阵。\n\n给定以下关于物种 $\\{A,B,C\\}$ 的小型数据集：\n- 预测变量值 $x$：$x_{A} = 1.0$, $x_{B} = 2.0$, $x_{C} = 4.0$。\n- 响应变量值 $y$：$y_{A} = 1.2$, $y_{B} = 2.3$, $y_{C} = 3.9$。\n\n该超度量系统发育树的每个谱系的总根到末端时间为 $2$，物种 $A$ 和 $B$ 在时间点 $1$ 共享一个最近共同祖先，而物种 $C$ 在根部分裂。在布朗运动模型下，系统发育协方差矩阵 $C$（共享路径长度）为\n$$\nC \\;=\\;\n\\begin{pmatrix}\n2 & 1 & 0 \\\\\n1 & 2 & 0 \\\\\n0 & 0 & 2\n\\end{pmatrix}.\n$$\n独立的测量误差方差是已知的，由下式给出\n$$\nE \\;=\\;\n\\begin{pmatrix}\n0.1 & 0 & 0 \\\\\n0 & 0.2 & 0 \\\\\n0 & 0 & 0.3\n\\end{pmatrix}.\n$$\n假设布朗运动速率参数为 $\\sigma^{2} = 1.0$。在具有指定总协方差的高斯线性模型下，拟合 $y$ 对 $x$ 的带有截距的系统发育广义最小二乘 (PGLS) 回归。计算 $x$ 对 $y$ 影响的 PGLS 斜率参数，并按所述方式通过 $E$ 纳入测量误差。将您的答案表示为一个无单位的实数，并四舍五入到四位有效数字。", "solution": "适用的基本模型是高斯线性模型，其误差项由布朗运动下的系统发育引起相关性，并加上独立的测量误差。设响应向量为 $y \\in \\mathbb{R}^{n}$，设计矩阵为 $X \\in \\mathbb{R}^{n \\times p}$，参数向量为 $\\beta \\in \\mathbb{R}^{p}$。在一个固定系统发育树上，具有已知速率 $\\sigma^{2}$ 的布朗运动模型下，末端值之间的系统发育协方差为 $\\sigma^{2} C$，其中 $C$ 集合了共享路径长度，而独立的测量误差贡献了一个可加的方差矩阵 $E$。因此，总协方差为\n$$\nV \\;=\\; \\sigma^{2} C + E.\n$$\n假设误差服从多元正态分布，$y \\sim \\mathcal{N}(X \\beta, V)$，则 $\\beta$ 的最大似然估计量是广义最小二乘估计量\n$$\n\\hat{\\beta} \\;=\\; \\left(X^{\\top} V^{-1} X\\right)^{-1} X^{\\top} V^{-1} y,\n$$\n前提是 $V$ 是正定矩阵。\n\n我们现在实例化这些对象。有 $n=3$ 个物种，我们拟合一个截距和一个斜率，所以 $p=2$。设计矩阵为\n$$\nX \\;=\\; \\begin{pmatrix}\n1 & x_{A} \\\\\n1 & x_{B} \\\\\n1 & x_{C}\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n1 & 1.0 \\\\\n1 & 2.0 \\\\\n1 & 4.0\n\\end{pmatrix}.\n$$\n当 $\\sigma^{2} = 1.0$ 时，总协方差为\n$$\nV \\;=\\; \\sigma^{2} C + E \\;=\\;\n\\begin{pmatrix}\n2 & 1 & 0 \\\\\n1 & 2 & 0 \\\\\n0 & 0 & 2\n\\end{pmatrix}\n+\n\\begin{pmatrix}\n0.1 & 0 & 0 \\\\\n0 & 0.2 & 0 \\\\\n0 & 0 & 0.3\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n2.1 & 1 & 0 \\\\\n1 & 2.2 & 0 \\\\\n0 & 0 & 2.3\n\\end{pmatrix}.\n$$\n该矩阵 $V$ 是块对角的，即 $\\{A,B\\}$ 块与物种 C 的块是独立的。我们通过分别求 $2 \\times 2$ 块和 $1 \\times 1$ 块的逆来求 $V$ 的逆。对于 $\\{A,B\\}$ 块，\n$$\nS \\;=\\; \\begin{pmatrix} 2.1 & 1 \\\\ 1 & 2.2 \\end{pmatrix}, \\quad \\det(S) \\;=\\; 2.1 \\cdot 2.2 - 1 \\cdot 1 \\;=\\; 3.62,\n$$\n所以\n$$\nS^{-1} \\;=\\; \\frac{1}{3.62} \\begin{pmatrix} 2.2 & -1 \\\\ -1 & 2.1 \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n\\frac{110}{181} & -\\frac{50}{181} \\\\\n-\\frac{50}{181} & \\frac{105}{181}\n\\end{pmatrix}.\n$$\n对于物种 $C$，方差为 $2.3$，其逆为 $1/2.3 = 10/23$。因此，\n$$\nV^{-1} \\;=\\; W \\;=\\;\n\\begin{pmatrix}\n\\frac{110}{181} & -\\frac{50}{181} & 0 \\\\\n-\\frac{50}{181} & \\frac{105}{181} & 0 \\\\\n0 & 0 & \\frac{10}{23}\n\\end{pmatrix}.\n$$\n接下来计算正规方程的组成部分 $X^{\\top} W X$ 和 $X^{\\top} W y$。设 $x = (1.0, 2.0, 4.0)^{\\top}$ 和 $y = (1.2, 2.3, 3.9)^{\\top} = \\left(\\frac{6}{5}, \\frac{23}{10}, \\frac{39}{10}\\right)^{\\top}$。我们逐项进行计算：\n- 标量 $1^{\\top} W 1$ 等于 $W$ 的所有元素之和：\n$$\n1^{\\top} W 1 \\;=\\; \\frac{60}{181} + \\frac{55}{181} + \\frac{10}{23} \\;=\\; \\frac{4455}{4163}.\n$$\n- 标量 $1^{\\top} W x$：\n$$\nW x \\;=\\; \\begin{pmatrix} \\frac{110}{181} \\cdot 1 + \\left(-\\frac{50}{181}\\right)\\cdot 2 \\\\ \\left(-\\frac{50}{181}\\right)\\cdot 1 + \\frac{105}{181} \\cdot 2 \\\\ \\frac{10}{23} \\cdot 4 \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix} \\frac{10}{181} \\\\ \\frac{160}{181} \\\\ \\frac{40}{23} \\end{pmatrix},\n\\quad\n1^{\\top} W x \\;=\\; \\frac{10}{181} + \\frac{160}{181} + \\frac{40}{23} \\;=\\; \\frac{11150}{4163}.\n$$\n- 标量 $x^{\\top} W x$：\n$$\nx^{\\top} W x \\;=\\; 1 \\cdot \\frac{10}{181} + 2 \\cdot \\frac{160}{181} + 4 \\cdot \\frac{40}{23} \\;=\\; \\frac{36550}{4163}.\n$$\n因此，\n$$\nX^{\\top} W X \\;=\\;\n\\begin{pmatrix}\n\\frac{4455}{4163} & \\frac{11150}{4163} \\\\\n\\frac{11150}{4163} & \\frac{36550}{4163}\n\\end{pmatrix}.\n$$\n现在计算 $X^{\\top} W y$。首先，\n$$\nW y \\;=\\;\n\\begin{pmatrix}\n\\frac{110}{181} \\cdot \\frac{6}{5} + \\left(-\\frac{50}{181}\\right) \\cdot \\frac{23}{10} \\\\\n\\left(-\\frac{50}{181}\\right) \\cdot \\frac{6}{5} + \\frac{105}{181} \\cdot \\frac{23}{10} \\\\\n\\frac{10}{23} \\cdot \\frac{39}{10}\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n\\frac{17}{181} \\\\\n\\frac{363}{362} \\\\\n\\frac{39}{23}\n\\end{pmatrix}.\n$$\n因此，\n$$\nX^{\\top} W y \\;=\\;\n\\begin{pmatrix}\n1 & 1 & 1 \\\\\n1 & 2 & 4\n\\end{pmatrix}\n\\begin{pmatrix}\n\\frac{17}{181} \\\\\n\\frac{363}{362} \\\\\n\\frac{39}{23}\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n\\frac{17}{181} + \\frac{363}{362} + \\frac{39}{23} \\\\\n\\frac{17}{181} + 2 \\cdot \\frac{363}{362} + 4 \\cdot \\frac{39}{23}\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n\\frac{23249}{8326} \\\\\n\\frac{36976}{4163}\n\\end{pmatrix}.\n$$\n为简化计算，将正规方程两边同乘以 $4163$ 以消去分母。定义\n$$\nM \\;=\\; 4163 \\, X^{\\top} W X \\;=\\; \\begin{pmatrix} 4455 & 11150 \\\\ 11150 & 36550 \\end{pmatrix}, \n\\qquad\nb \\;=\\; 4163 \\, X^{\\top} W y \\;=\\; \\begin{pmatrix} 4163 \\cdot \\frac{23249}{8326} \\\\ 4163 \\cdot \\frac{36976}{4163} \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n\\frac{23249}{2} \\\\\n36976\n\\end{pmatrix}.\n$$\n我们求解 $M \\hat{\\beta} = b$。$M$ 的逆是\n$$\nM^{-1} \\;=\\; \\frac{1}{\\det(M)} \\begin{pmatrix} 36550 & -11150 \\\\ -11150 & 4455 \\end{pmatrix},\n\\quad\n\\det(M) \\;=\\; 4455 \\cdot 36550 - 11150^{2} \\;=\\; 38{,}507{,}750.\n$$\n斜率（第二个分量）是\n$$\n\\hat{\\beta}_{\\text{slope}} \\;=\\; \\frac{-11150 \\cdot \\left(\\frac{23249}{2}\\right) + 4455 \\cdot 36976}{38{,}507{,}750}\n\\;=\\; \\frac{-129{,}613{,}175 + 164{,}728{,}080}{38{,}507{,}750}\n\\;=\\; \\frac{35{,}114{,}905}{38{,}507{,}750}.\n$$\n该精确比值的数值约等于\n$$\n\\hat{\\beta}_{\\text{slope}} \\;\\approx\\; 0.9118919\\ldots\n$$\n按照要求四舍五入到四位有效数字，PGLS 斜率为 $0.9119$。", "answer": "$$\\boxed{0.9119}$$", "id": "2520685"}]}