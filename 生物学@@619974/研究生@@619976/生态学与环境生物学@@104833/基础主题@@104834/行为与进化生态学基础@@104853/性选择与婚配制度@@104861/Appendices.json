{"hands_on_practices": [{"introduction": "性选择中的竞争并不仅限于交配前。当雌性与多个雄性交配时，竞争就延续到了精子层面。本练习将带您从最基本的概率公理出发，推导精子竞争研究中的一个基石模型——Parker的“公平抽彩”模型（fair raffle model）。通过构建这个零假设模型，您将掌握一个核心技能：建立一个简单的基准，用以判断更复杂的生物学因素（如精子优先权或雌性隐秘选择）是否在起作用。[@problem_id:2532461]", "problem": "在一个进行体内受精的物种中，两只雄性在单次交配事件中竞争使一只雌性的卵子受精。雄性$1$向雌性生殖道内射入$s_1$个精子，雄性$2$射入$s_2$个精子，其中$s_1$和$s_2$为正整数。假设受精是无偏的，其含义如下：存在的每一个精细胞使一个给定卵子受精的概率均等；不存在时间优先性，无精子死亡率差异，也无雌性介导的偏好，并且精子池是充分混合的，因此每个卵子都由一个在接触瞬间从所有可用精子中随机选出的单个精子受精。设$P_1$和$P_2$分别表示雄性1和雄性2的预期父权份额，定义为在上述假设下，大量卵子中由每只雄性授精的预期比例。\n\n仅从基本概率公理、期望的定义（例如，期望的线性性）以及无偏抽样下的对称性出发，推导出$P_1$和$P_2$作为$s_1$和$s_2$函数的闭式表达式。你的推导应明确说明单个卵子层面的无偏抽样如何转化为多个卵子的预期父权份额。将你的最终答案表示为一对关于$s_1$和$s_2$的函数。不需要进行数值舍入，也不需要单位。", "solution": "在尝试提供解答之前，对问题陈述进行验证。\n\n首先，逐字提取给定信息：\n1.  两只雄性，雄性$1$和雄性$2$，进行竞争。\n2.  雄性$1$射出$s_1$个精子；雄性$2$射出$s_2$个精子。\n3.  $s_1$和$s_2$是正整数。\n4.  受精是无偏的：每个精细胞使一个给定卵子受精的概率均等。\n5.  假设：无时间优先性，无精子死亡率差异，无雌性介导的偏好，精子池充分混合。\n6.  每个卵子由一个随机选出的单个精子受精。\n7.  $P_1$和$P_2$是预期父权份额，分别定义为大量卵子中由雄性$1$和雄性$2$授精的预期比例。\n8.  任务是从基本概率公理、期望的定义和无偏抽样下的对称性出发，推导$P_1$和$P_2$的闭式表达式。\n\n其次，根据所需标准对问题进行验证。\n该问题具有**科学依据**。它描述了精子竞争中的“公平抽彩”或“彩票”模型，这是性选择和演化生物学研究中的一个基础零模型。这些假设虽然是理想化的，但为理论分析创造了一个易于处理的基本基线。\n该问题是**良构的**。所有术语都有定义（例如，无偏受精、预期父权份额），并且给定的条件（$s_1$, $s_2$）足以确定所求的量（$P_1$, $P_2$）。\n该问题是**客观的**。它使用精确、形式化的语言，不包含任何主观或模糊的陈述。\n该问题不违反任何有效性条件。它是理论生物学和应用概率论中的一个标准且可形式化的问题，内部一致，并要求从第一性原理进行严格推导，而非陈述一个直觉的猜测。\n\n结论是该问题是**有效的**。将提供解答。\n\n推导从指定的基本原理开始。设$s_1$是来自雄性$1$的精子数量，$s_2$是来自雄性$2$的精子数量。雌性生殖道中的总精子数量为$S = s_1 + s_2$。问题陈述$s_1$和$s_2$是正整数，因此$S \\ge 2$。\n\n核心假设是无偏受精：任何单个精细胞使一个卵子受精的概率均等。这建立了一个简单的随机抽样情景。考虑单个卵子。其受精事件等价于从总共$S$个精子的池中抽取一个精子。\n\n随机选出的一个精子来自雄性$1$的概率是雄性$1$的精子数量与总精子数量的比值。我们将一个特定卵子由雄性$1$受精的事件记为$E_1$。此事件的概率为：\n$$p_1 = P(E_1) = \\frac{s_1}{s_1 + s_2}$$\n根据对称性，同一个卵子由雄性$2$受精的概率（记为事件$E_2$）为：\n$$p_2 = P(E_2) = \\frac{s_2}{s_1 + s_2}$$\n对于单次受精，这两个事件是互斥且穷尽的，因此$p_1 + p_2 = \\frac{s_1}{s_1 + s_2} + \\frac{s_2}{s_1 + s_2} = 1$，这符合概率公理的要求。\n\n问题要求我们求出预期父权份额$P_1$，其定义为由雄性$1$授精的大量卵子的预期比例。假设有$N$个卵子，其中$N$是一个大整数。我们必须将单个卵子的概率$p_1$转化为这$N$个卵子上的预期比例。\n\n为了形式化地做到这一点，我们使用指示随机变量。对于每个卵子$i$（其中$i \\in \\{1, 2, \\dots, N\\}$），我们定义一个随机变量$X_i$如下：\n$$\nX_i =\n\\begin{cases}\n1 & \\text{if egg } i \\text{ is fertilized by Male } 1 \\\\\n0 & \\text{if egg } i \\text{ is fertilized by Male } 2\n\\end{cases}\n$$\n指示随机变量的期望值等于它所指示事件的概率。因此，对于任意卵子$i$：\n$$E[X_i] = 1 \\cdot P(X_i=1) + 0 \\cdot P(X_i=0) = P(X_i=1) = p_1 = \\frac{s_1}{s_1 + s_2}$$\n由雄性$1$受精的卵子总数（记为$K_1$）是这些指示变量在所有$N$个卵子上的和：\n$$K_1 = \\sum_{i=1}^{N} X_i$$\n由雄性$1$授精的卵子比例是$\\frac{K_1}{N}$。预期父权份额$P_1$是该比例的期望值：\n$$P_1 = E\\left[\\frac{K_1}{N}\\right] = E\\left[\\frac{1}{N} \\sum_{i=1}^{N} X_i\\right]$$\n根据期望的线性性，我们可以写出：\n$$P_1 = \\frac{1}{N} E\\left[\\sum_{i=1}^{N} X_i\\right] = \\frac{1}{N} \\sum_{i=1}^{N} E[X_i]$$\n由于每个卵子的受精都是从同一个精子池中进行的相同且独立的抽取（根据问题中的“充分混合”和“随机”抽样条件），期望$E[X_i]$对所有$i$都是相同的：\n$$E[X_i] = p_1 = \\frac{s_1}{s_1 + s_2} \\quad \\text{for all } i=1, \\dots, N$$\n将此代入$P_1$的表达式中：\n$$P_1 = \\frac{1}{N} \\sum_{i=1}^{N} \\left(\\frac{s_1}{s_1 + s_2}\\right) = \\frac{1}{N} \\cdot N \\cdot \\left(\\frac{s_1}{s_1 + s_2}\\right)$$\n这可简化为$P_1$的闭式表达式：\n$$P_1 = \\frac{s_1}{s_1 + s_2}$$\n对于雄性$2$的预期父权份额$P_2$的推导是完全对称的。我们可以定义第二组指示变量$Y_i$，或者更简单地，注意到总预期份额必须为$1$。因此，$P_1 + P_2 = 1$。由此得出：\n$$P_2 = 1 - P_1 = 1 - \\frac{s_1}{s_1 + s_2} = \\frac{s_1 + s_2 - s_1}{s_1 + s_2} = \\frac{s_2}{s_1 + s_2}$$\n这就完成了从第一性原理出发的推导。期望线性性的使用提供了单个事件（一个卵子受精）的概率与大量此类事件的预期比例之间的严谨联系。最终表达式仅是$s_1$和$s_2$的函数，符合要求。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{s_1}{s_1 + s_2} & \\frac{s_2}{s_1 + s_2}\n\\end{pmatrix}\n}\n$$", "id": "2532461"}, {"introduction": "在许多物种中，雄性面临一个进化上的两难困境：投资于当前的后代可能会以牺牲未来的繁殖机会为代价，而不确定的父权关系使这一权衡变得更加复杂。本练习要求您运用边际分析这一行为生态学的核心工具，来量化这种繁殖投资的成本$C$与收益$B$。您将推导出一个简洁但影响深远的不等式，它揭示了在父权概率为$p$的情况下，雄性亲代抚育行为得以演化的条件。[@problem_id:2532459]", "problem": "在一个大型、随机交配的双亲哺育脊椎动物种群中，雄性可以为当前的一窝后代提供合子后抚育，但这会消耗能量和时间，从而降低其未来的繁殖成功率。设 $x$ 表示在一个繁殖期内，雄性分配给当前窝的抚育投入的一个连续一维量度。假设对 $x$ 的选择是弱选择，因此局部的边际效应决定了演化响应。当前窝的父权是不确定的：在当前窝中随机抽取的一个后代，其亲本是该焦点雄性的概率为 $p$，不是的概率为 $1 - p$。\n\n将焦点雄性自身的存活后代的预期终生数量（其直接遗传贡献）定义为\n$$\nW(x) = \\underbrace{p\\,S(x)}_{\\text{来自当前窝的自身存活后代的预期数量}} + \\underbrace{F(x)}_{\\text{来自未来繁殖的自身存活后代的预期数量}}。\n$$\n假设 $S(x)$ 和 $F(x)$ 在一个固有基线水平 $x = x_{0}$ 处可导，并且 $x$ 的微小增加会产生：\n- 来自当前窝的存活后代数量的边际增量为 $B \\equiv \\left.\\frac{dS}{dx}\\right|_{x_{0}}$，\n- 未来存活后代数量的边际减量为 $C \\equiv -\\left.\\frac{dF}{dx}\\right|_{x_{0}}$。\n\n你可以假设 $B > 0$、$C > 0$ 且 $p \\in (0,1)$。仅使用以下原理：在弱选择下，当 $x$ 的一个无穷小增量能够增加 $W(x)$ 时（即当 $x$ 上的选择梯度为正时），该增量是有利的。据此推导出父权阈值概率 $p^{*}$，使得雄性抚育从 $x_0$ 开始的无穷小增量是有利的，当且仅当 $p > p^{*}$。请用 $B$ 和 $C$ 将你的最终结果表示为一个闭式符号表达式。不包含单位。无需进行数值四舍五入。", "solution": "该问题陈述已经过验证，被认为是科学上合理、提法恰当，且没有矛盾或含糊之处。它提出了行为生态学领域一个标准的最优化问题，其基础是演化论的原理。它包含了进行严谨求解所需的所有信息。因此，我们开始解答。\n\n任务是确定父权阈值概率，记为 $p^{*}$，当父权概率高于此值时，雄性亲代抚育 $x$ 从基线水平 $x_{0}$ 的一个无穷小增量将受到选择的青睐。做出此判断的原理是：如果一种行为能导致雄性预期终生适合度 $W(x)$ 的增加，那么这种行为就是有利的。\n\n焦点雄性的适合度由以下函数给出：\n$$\nW(x) = p\\,S(x) + F(x)\n$$\n此处，$p\\,S(x)$ 代表雄性从当前窝中获得的自身存活后代的预期数量，其中 $p$ 是父权概率，$S(x)$ 是存活后代数量作为抚育投入 $x$ 的函数。项 $F(x)$ 代表雄性的预期未来繁殖成功率，它是当前抚育投入 $x$ 的函数。\n\n如果适合度相对于 $x$ 的边际变化为正，则选择会青睐抚育投入 $x$ 从固有值 $x_0$ 开始的无穷小增量。这个边际变化就是性状 $x$ 上的选择梯度，即适合度函数对 $x$ 的导数 $\\frac{dW}{dx}$ 在 $x = x_{0}$ 处的值。抚育投入增加受青睐的条件是：\n$$\n\\left.\\frac{dW}{dx}\\right|_{x=x_{0}} > 0\n$$\n为了评估这一点，我们首先计算 $W(x)$ 对 $x$ 的导数：\n$$\n\\frac{dW}{dx} = \\frac{d}{dx} \\left( p\\,S(x) + F(x) \\right)\n$$\n使用微分的求和法则和常数倍法则，我们得到：\n$$\n\\frac{dW}{dx} = p\\,\\frac{dS}{dx} + \\frac{dF}{dx}\n$$\n现在，我们在特定点 $x = x_{0}$ 处计算这个导数：\n$$\n\\left.\\frac{dW}{dx}\\right|_{x=x_{0}} = p\\,\\left.\\frac{dS}{dx}\\right|_{x=x_{0}} + \\left.\\frac{dF}{dx}\\right|_{x=x_{0}}\n$$\n问题陈述给出了在 $x_{0}$ 处抚育的边际收益和边际成本的定义。边际收益 $B$ 是当前存活后代数量的增加率：\n$$\nB \\equiv \\left.\\frac{dS}{dx}\\right|_{x_{0}}\n$$\n边际成本 $C$ 是未来存活后代数量的降低率。其定义中带有一个负号，以确保 $C$ 是一个正数：\n$$\nC \\equiv -\\left.\\frac{dF}{dx}\\right|_{x_{0}}\n$$\n这意味着 $\\left.\\frac{dF}{dx}\\right|_{x_{0}} = -C$。\n\n将 $B$ 和 $-C$ 的这些定义代入选择梯度的表达式中，得到：\n$$\n\\left.\\frac{dW}{dx}\\right|_{x=x_{0}} = p\\,B - C\n$$\n抚育投入增加受选择青睐的条件 $\\left.\\frac{dW}{dx}\\right|_{x=x_{0}} > 0$ 变为：\n$$\np\\,B - C > 0\n$$\n这个不等式代表了核心的权衡关系：经父权概率 ($pB$) 折算后，来自当前窝的适合度收益必须超过对未来繁殖的适合度成本 ($C$)。为了找到关于 $p$ 的条件，我们求解这个不等式。\n$$\np\\,B > C\n$$\n因为给定边际收益 $B > 0$，我们可以将不等式两边同时除以 $B$ 而不改变不等号的方向：\n$$\np > \\frac{C}{B}\n$$\n这个不等式表明，增加雄性抚育是有利的，当且仅当父权概率 $p$ 大于抚育的边际成本与边际收益之比。因此，父权阈值概率 $p^{*}$ 是净边际适合度增益为零时的值，也就是这个条件的边界值。\n$$\np^{*} = \\frac{C}{B}\n$$\n因此，雄性抚育从 $x_0$ 开始的无穷小增量是有利的，当且仅当 $p > p^{*}$。", "answer": "$$\\boxed{\\frac{C}{B}}$$", "id": "2532459"}, {"introduction": "理论模型，例如前一个练习 [@problem_id:2532459] 中探讨的模型，会产生可供检验的预测。本练习将搭建从理论到实证研究的桥梁，要求您分析一个假设的数据集，以确定雄性是否会根据其父权份额来调整亲代抚育投入。您将从第一性原理出发，亲手实现一个逻辑斯蒂回归模型，从而深入理解我们如何运用统计工具（如估计系数$\\hat{\\beta}_1$并进行假设检验）来检验进化理论。[@problem_id:2532476]", "problem": "在许多有双亲抚育的物种中，生态学和性选择理论预测，雄性的父权确定性可能会影响其抚育投入。现有在窝层面的独立观测数据：雄性实现的父权份额以及它是否表现出抚育行为。您必须将抚育行为形式化为一个伯努利随机变量，其概率通过逻辑斯蒂连接函数与父权份额相关联，并使用最大似然法估计父权份额对抚育行为的影响。仅从伯努利分布、观测独立性和逻辑斯蒂连接函数的定义出发，推导出一个有理可据的估计和检验程序。\n\n您的任务是实现一个程序，对每个提供的数据集执行以下步骤：\n- 将抚育行为建模为一个二元响应 $y_i \\in \\{0,1\\}$，其依赖于一个标量预测变量 $x_i \\in [0,1]$（雄性对第 $i$ 窝的父权份额）。\n- 使用带有线性预测器 $\\eta_i = \\beta_0 + \\beta_1 x_i$ 的逻辑斯蒂连接，其概率 $p_i$ 由 $p_i = \\sigma(\\eta_i)$ 给出，其中 $\\sigma(\\cdot)$ 是逻辑斯蒂函数。\n- 假定在预测变量给定的条件下，观测值是独立同分布的，因此联合似然是伯努利概率的乘积。\n- 通过最大化对数似然来估计系数向量 $\\boldsymbol{\\beta} = (\\beta_0,\\beta_1)$，使用一种基于最大似然估计基本原理的数值稳定方法。\n- 使用最大似然估计量的大样本正态近似和观测Fisher信息，构建一个沃尔德(Wald)统计量来检验单边假设 $H_0: \\beta_1 \\le 0$ 与 $H_1: \\beta_1 > 0$。计算相应的单边p值。\n- 对于每个数据集，返回一个三元列表 $[\\hat{\\beta}_1, p, d]$，其中 $\\hat{\\beta}_1$ 是估计的斜率，四舍五入到3位小数；$p$ 是单边p值，四舍五入到4位小数；$d$ 是一个布尔决策，当且仅当 $\\hat{\\beta}_1 > 0$ 且 $p < 0.05$ 时为 $True$。\n\n科学真实性约束：父权与抚育之间的联系在机制上由性选择和亲代投资理论所证明。您实现的推断必须从伯努利模型和逻辑斯蒂连接出发，除了数值线性代数和基本特殊函数外，不使用任何预封装的快捷方法。\n\n测试套件：\n为以下数据集提供结果。在每种情况下，$x$是父权份额的列表，$y$是观察到的雄性抚育结果的列表，其中$1$表示有抚育，$0$表示没有抚育。\n\n- 数据集 A（在整个范围内存在变异的普遍正相关）：\n  - $x = [\\, 0.05,\\, 0.10,\\, 0.15,\\, 0.20,\\, 0.30,\\, 0.35,\\, 0.40,\\, 0.50,\\, 0.60,\\, 0.70,\\, 0.80,\\, 0.90 \\,]$\n  - $y = [\\, 0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1,\\, 1,\\, 0,\\, 1 \\,]$\n\n- 数据集 B（弱相关或无相关）：\n  - $x = [\\, 0.10,\\, 0.15,\\, 0.20,\\, 0.25,\\, 0.30,\\, 0.35,\\, 0.40,\\, 0.45,\\, 0.50,\\, 0.55 \\,]$\n  - $y = [\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0 \\,]$\n\n- 数据集 C（负相关，但有例外以避免分离）：\n  - $x = [\\, 0.10,\\, 0.20,\\, 0.25,\\, 0.30,\\, 0.40,\\, 0.45,\\, 0.50,\\, 0.55,\\, 0.60,\\, 0.70,\\, 0.80,\\, 0.85,\\, 0.90,\\, 0.95 \\,]$\n  - $y = [\\, 1,\\, 1,\\, 1,\\, 1,\\, 1,\\, 0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 0,\\, 0,\\, 0 \\,]$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个数据集的结果本身必须是一个三元列表，顺序为 $[\\hat{\\beta}_1, p, d]$。例如，打印的输出应如下所示：\n[ [b1_A,p_A,decision_A], [b1_B,p_B,decision_B], [b1_C,p_C,decision_C] ]\n此任务不涉及物理单位或角度。所有数值输出必须按上述规定进行四舍五入，布尔决策必须反映显著性水平 $\\alpha = 0.05$ 下的单边检验。", "solution": "所提出的问题是在演化生态学中应用统计模型的一个标准且有效练习。它涉及估计一个连续预测变量（父权份额）对一个二元结果（雄性亲代抚育）的影响。这需要应用广义线性模型（GLM），特别是逻辑斯蒂回归。我们将按照要求，从第一性原理出发进行完整的推导和实现。\n\n问题的有效性验证如下：\n- **科学依据**：将父权确定性与亲代投资联系起来的前提，是性选择理论的基石。它在科学上是合理的。\n- **适定性**：该问题定义了一个明确的目标：通过最大似然估计逻辑斯蒂模型的参数并进行假设检验。指定的模型和估计技术导向一个明确定义的统计过程。\n- **客观性**：该问题以精确、客观的数学和统计语言陈述。\n\n结论是该问题是**有效的**。下面是严谨的解决方案。\n\n**1. 统计模型**\n\n令 $Y_i$ 为表示第 $i$ 窝抚育决策的二元随机变量，其中如果提供了抚育则 $Y_i=1$，否则 $Y_i=0$。令 $x_i \\in [0, 1]$ 为该窝观察到的父权份额。我们在给定 $x_i$ 的条件下，将 $Y_i$ 建模为服从伯努利(Bernoulli)分布的随机变量：\n$$ Y_i \\sim \\text{Bernoulli}(p_i) $$\n观测值 $i$ 的概率质量函数为：\n$$ f(y_i|p_i) = p_i^{y_i} (1-p_i)^{1-y_i}, \\quad y_i \\in \\{0, 1\\} $$\n概率 $p_i$ 通过逻辑斯蒂连接函数与预测变量 $x_i$ 相关。线性预测器 $\\eta_i$ 定义为预测变量的线性函数：\n$$ \\eta_i = \\beta_0 + \\beta_1 x_i $$\n逻辑斯蒂连接函数 $\\sigma(\\cdot)$ 将线性预测器从 $(-\\infty, \\infty)$ 映射到概率空间 $(0, 1)$：\n$$ p_i = \\sigma(\\eta_i) = \\frac{1}{1 + e^{-\\eta_i}} $$\n参数 $\\beta_1$ 量化了父权份额每增加一个单位时，提供抚育的对数几率(log-odds)的变化。我们的目标是估计系数向量 $\\boldsymbol{\\beta} = [\\beta_0, \\beta_1]^T$。\n\n**2. 最大似然估计 (MLE)**\n\n假设 $n$ 个观测值 $(x_i, y_i)$ 是独立的，那么在给定预测变量 $\\mathbf{x} = (x_1, ..., x_n)$ 和参数 $\\boldsymbol{\\beta}$ 的条件下，观测数据 $\\mathbf{y} = (y_1, ..., y_n)$ 的总似然函数是各个概率的乘积：\n$$ \\mathcal{L}(\\boldsymbol{\\beta}; \\mathbf{x}, \\mathbf{y}) = \\prod_{i=1}^n p_i^{y_i} (1-p_i)^{1-y_i} $$\n为了分析和计算的方便，我们最大化对数似然函数 $\\ell(\\boldsymbol{\\beta}) = \\log \\mathcal{L}(\\boldsymbol{\\beta})$：\n$$ \\ell(\\boldsymbol{\\beta}) = \\sum_{i=1}^n \\left[ y_i \\log(p_i) + (1-y_i) \\log(1-p_i) \\right] $$\n我们可以用线性预测器 $\\eta_i$ 来重新表达它。使用恒等式 $\\log(p_i/(1-p_i)) = \\eta_i$ 和 $\\log(1-p_i) = -\\log(1+e^{\\eta_i})$，我们推导出逻辑斯蒂回归的对数似然函数的规范形式：\n$$ \\ell(\\boldsymbol{\\beta}) = \\sum_{i=1}^n \\left[ y_i \\eta_i - \\log(1+e^{\\eta_i}) \\right] $$\n此处，$\\eta_i = \\mathbf{x}_i^T \\boldsymbol{\\beta}$，其中 $\\mathbf{x}_i = [1, x_i]^T$ 是观测值 $i$ 的预测向量。\n\n为了找到最大似然估计 $\\hat{\\boldsymbol{\\beta}}$，我们必须找到使 $\\ell(\\boldsymbol{\\beta})$ 最大化的 $\\boldsymbol{\\beta}$ 值。这通过求解 $\\nabla \\ell(\\boldsymbol{\\beta}) = \\mathbf{0}$ 来实现，其中 $\\nabla \\ell(\\boldsymbol{\\beta})$ 是对数似然函数的梯度。梯度的分量是关于每个参数 $\\beta_j$ 的偏导数：\n$$ \\frac{\\partial \\ell}{\\partial \\beta_j} = \\sum_{i=1}^n \\frac{\\partial}{\\partial \\beta_j} \\left[ y_i \\eta_i - \\log(1+e^{\\eta_i}) \\right] = \\sum_{i=1}^n \\left( y_i \\frac{\\partial \\eta_i}{\\partial \\beta_j} - \\frac{e^{\\eta_i}}{1+e^{\\eta_i}} \\frac{\\partial \\eta_i}{\\partial \\beta_j} \\right) $$\n注意到 $p_i = e^{\\eta_i}/(1+e^{\\eta_i})$ 且 $\\partial \\eta_i / \\partial \\beta_j = x_{ij}$（其中 $x_{i0}=1$ 且 $x_{i1}=x_i$），我们有：\n$$ \\frac{\\partial \\ell}{\\partial \\beta_j} = \\sum_{i=1}^n (y_i - p_i) x_{ij} $$\n用矩阵表示法，梯度向量是：\n$$ \\nabla \\ell(\\boldsymbol{\\beta}) = \\mathbf{X}^T (\\mathbf{y} - \\mathbf{p}) $$\n其中 $\\mathbf{X}$ 是一个 $n \\times 2$ 的设计矩阵，其行是 $\\mathbf{x}_i^T$，$\\mathbf{y}$ 是结果向量，$\\mathbf{p}$ 是概率向量。\n\n$\\hat{\\boldsymbol{\\beta}}$ 没有闭式解，因此我们必须使用数值优化算法。我们将采用一种拟牛顿法（BFGS），该方法需要被最小化函数的梯度。我们将最小化负对数似然 $-\\ell(\\boldsymbol{\\beta})$，其梯度就是 $-\\nabla \\ell(\\boldsymbol{\\beta})$。\n\n**3. 使用沃尔德检验进行假设检验**\n\n该问题要求对原假设 $H_0: \\beta_1 \\le 0$ 和备择假设 $H_1: \\beta_1 > 0$ 进行单边检验。我们使用基于最大似然估计量(MLE)渐近正态性的沃尔德(Wald)检验。对于大样本，MLE $\\hat{\\boldsymbol{\\beta}}$ 的分布近似为正态分布：\n$$ \\hat{\\boldsymbol{\\beta}} \\stackrel{\\cdot}{\\sim} \\mathcal{N}(\\boldsymbol{\\beta}, \\mathcal{I}(\\boldsymbol{\\beta})^{-1}) $$\n其中 $\\mathcal{I}(\\boldsymbol{\\beta})$ 是Fisher信息矩阵。我们使用**观测Fisher信息矩阵** $\\mathcal{J}(\\hat{\\boldsymbol{\\beta}})$，它是在最大似然估计值 $\\hat{\\boldsymbol{\\beta}}$ 处求值的对数似然函数Hessian矩阵的负数。Hessian矩阵 $\\mathbf{H}(\\boldsymbol{\\beta})$ 包含二阶偏导数：\n$$ H_{jk} = \\frac{\\partial^2 \\ell}{\\partial \\beta_j \\partial \\beta_k} = \\frac{\\partial}{\\partial \\beta_k} \\sum_{i=1}^n (y_i - p_i) x_{ij} = \\sum_{i=1}^n -x_{ij} \\frac{\\partial p_i}{\\partial \\beta_k} $$\n使用链式法则，$\\frac{\\partial p_i}{\\partial \\beta_k} = \\frac{dp_i}{d\\eta_i}\\frac{\\partial \\eta_i}{\\partial \\beta_k} = p_i(1-p_i)x_{ik}$。因此：\n$$ H_{jk} = -\\sum_{i=1}^n p_i(1-p_i) x_{ij} x_{ik} $$\n以矩阵形式表示，$\\mathbf{H}(\\boldsymbol{\\beta}) = -\\mathbf{X}^T \\mathbf{W} \\mathbf{X}$，其中 $\\mathbf{W}$ 是一个对角矩阵，其对角线元素为 $W_{ii} = p_i(1-p_i)$。\n观测Fisher信息为 $\\mathcal{J}(\\hat{\\boldsymbol{\\beta}}) = -\\mathbf{H}(\\hat{\\boldsymbol{\\beta}}) = \\mathbf{X}^T \\hat{\\mathbf{W}} \\mathbf{X}$，其中 $\\hat{\\mathbf{W}}$ 使用从 $\\hat{\\boldsymbol{\\beta}}$ 计算出的概率 $\\hat{\\mathbf{p}}$ 来求值。\n\n$\\hat{\\boldsymbol{\\beta}}$ 的估计渐近协方差矩阵是 $\\widehat{\\text{Cov}}(\\hat{\\boldsymbol{\\beta}}) = \\mathcal{J}(\\hat{\\boldsymbol{\\beta}})^{-1}$。$\\hat{\\beta}_1$ 的标准误是该矩阵相应对角元素的平方根：\n$$ \\text{SE}(\\hat{\\beta}_1) = \\sqrt{[\\mathcal{J}(\\hat{\\boldsymbol{\\beta}})^{-1}]_{11}} $$\n（使用基于0的索引，这是位置 (1,1) 处的元素）。\n\n沃尔德统计量为：\n$$ W = \\frac{\\hat{\\beta}_1}{\\text{SE}(\\hat{\\beta}_1)} $$\n在 $H_0$ 下，$W$ 在分布上收敛于一个标准正态变量 $Z \\sim \\mathcal{N}(0, 1)$。对于单边备择假设 $H_1: \\beta_1 > 0$，p值是观测到至少与 $W$ 一样大的统计量的概率：\n$$ p = P(Z \\ge W) = 1 - \\Phi(W) $$\n其中 $\\Phi$ 是标准正态分布的累积分布函数(CDF)。\n\n最终决策 $d$ 为 `True` 当且仅当估计值支持备择假设（$\\hat{\\beta}_1 > 0$）且结果在 $\\alpha = 0.05$ 的显著性水平上是统计显著的（$p  0.05$）。\n\n理论推导到此结束。我们现在将实现这一过程。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Main function to process datasets and print results.\n    \"\"\"\n    test_cases = [\n        {\n            \"x\": [0.05, 0.10, 0.15, 0.20, 0.30, 0.35, 0.40, 0.50, 0.60, 0.70, 0.80, 0.90],\n            \"y\": [0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1],\n        },\n        {\n            \"x\": [0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55],\n            \"y\": [0, 1, 0, 1, 0, 0, 1, 0, 1, 0],\n        },\n        {\n            \"x\": [0.10, 0.20, 0.25, 0.30, 0.40, 0.45, 0.50, 0.55, 0.60, 0.70, 0.80, 0.85, 0.90, 0.95],\n            \"y\": [1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        x_data = case[\"x\"]\n        y_data = case[\"y\"]\n        result = estimate_and_test(x_data, y_data)\n        results.append(result)\n\n    # Format output to be a single line with no spaces within sublists.\n    # Example: [[-1.23,0.456,False],[...]]\n    formatted_results = f\"[{','.join([str(r).replace(' ', '') for r in results])}]\"\n    print(formatted_results)\n\ndef estimate_and_test(x, y):\n    \"\"\"\n    Performs logistic regression from first principles and a one-sided Wald test.\n    \n    Args:\n        x (list): List of paternity shares (predictor).\n        y (list): List of care outcomes (binary response).\n        \n    Returns:\n        list: A list containing [beta_1_hat, p_value, decision].\n    \"\"\"\n    # 1. Prepare data\n    x_vec = np.array(x, dtype=np.float64)\n    y_vec = np.array(y, dtype=np.float64)\n    X_design = np.vstack([np.ones(len(x_vec)), x_vec]).T\n    \n    # 2. Define objective function (negative log-likelihood) and its gradient\n    def neg_log_likelihood(beta, X, y):\n        # eta = beta_0 + beta_1 * x\n        eta = X @ beta\n        # Numerically stable log-likelihood using logaddexp for log(1+exp(eta))\n        # l = sum(y*eta - log(1+exp(eta)))\n        # Here we return -l\n        return -np.sum(y * eta - np.logaddexp(0, eta))\n\n    def gradient(beta, X, y):\n        # eta = beta_0 + beta_1 * x\n        eta = X @ beta\n        # p = 1 / (1 + exp(-eta))\n        p = 1 / (1 + np.exp(-eta))\n        # grad(l) = X^T * (y - p)\n        # We return -grad(l) for the minimization problem\n        return -X.T @ (y - p)\n    \n    # 3. Perform optimization to find MLE for beta\n    initial_beta = np.zeros(2)\n    opt_result = minimize(\n        neg_log_likelihood,\n        initial_beta,\n        args=(X_design, y_vec),\n        jac=gradient,\n        method='BFGS'\n    )\n    beta_hat = opt_result.x\n    beta_1_hat = beta_hat[1]\n    \n    # 4. Calculate standard error of beta_1_hat\n    # eta_hat = X @ beta_hat\n    eta_hat = X_design @ beta_hat\n    # p_hat = 1 / (1 + exp(-eta_hat))\n    p_hat = 1 / (1 + np.exp(-eta_hat))\n    # W is a diagonal matrix of weights p_hat * (1 - p_hat)\n    weights = p_hat * (1 - p_hat)\n    # Observed Fisher Information Matrix: J = X^T * W * X\n    fisher_info_matrix = X_design.T @ (weights[:, np.newaxis] * X_design)\n    \n    try:\n        # Covariance matrix is the inverse of the Fisher Information Matrix\n        cov_matrix = np.linalg.inv(fisher_info_matrix)\n        # Variance of beta_1_hat is the (1,1) element\n        var_beta_1 = cov_matrix[1, 1]\n        se_beta_1 = np.sqrt(var_beta_1)\n        \n        # 5. Perform one-sided Wald test\n        # H0: beta_1 = 0, H1: beta_1  0\n        wald_statistic = beta_1_hat / se_beta_1\n        # p_value is the upper tail probability of a standard normal distribution\n        p_value = norm.sf(wald_statistic)\n\n    except np.linalg.LinAlgError:\n        # Handle cases of singularity, e.g., perfect separation,\n        # which would make inference impossible.\n        p_value = np.nan\n        se_beta_1 = np.nan\n\n    # 6. Format the output\n    beta_1_rounded = round(beta_1_hat, 3)\n    p_value_rounded = round(p_value, 4) if not np.isnan(p_value) else None\n    \n    # Decision: True if beta_1_hat  0 and p-value  0.05\n    decision = False\n    if p_value_rounded is not None:\n        if beta_1_hat  0 and p_value_rounded  0.05:\n            decision = True\n            \n    return [beta_1_rounded, p_value_rounded, decision]\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2532476"}]}