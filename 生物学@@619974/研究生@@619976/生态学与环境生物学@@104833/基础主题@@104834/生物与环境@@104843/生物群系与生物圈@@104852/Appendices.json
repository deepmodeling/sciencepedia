{"hands_on_practices": [{"introduction": "对生物群系进行分类是理解其在全球尺度上分布和功能的基石。本练习将带您亲手应用经典的Holdridge生命区分类系统，这是一个基于气候变量来预测潜在植被类型的强大框架。通过处理原始气候数据来计算生物温度，并将其映射到该模型的对数坐标空间中，您将深入理解气候如何作为主导因素，决定全球植被分布的宏观格局 [@problem_id:2473806]。", "problem": "一个位于中纬度地区的野外站记录了某一个日历年的月平均气温和月总降水量。在 Holdridge 生命区框架中，年平均生物温度定义为将所有低于 $0\\,^\\circ\\mathrm{C}$ 或高于 $30\\,^\\circ\\mathrm{C}$ 的月平均温度替换为 $0\\,^\\circ\\mathrm{C}$ 后，对这 $12$ 个月平均温度计算的算术平均值。假设 Holdridge 生命区图使用其标准的对数形式，并且将一个站点映射到一个“六边形”可以通过在以 $2$ 为底的对数空间中，将该站点分配给每个坐标轴上最近的几何中心来近似。具体来说，设生物温度中心的集合为 $\\{\\,1.5,\\,3,\\,6,\\,12,\\,24\\,\\}$（摄氏度），年降水量中心的集合为 $\\{\\,62.5,\\,125,\\,250,\\,500,\\,1000,\\,2000,\\,4000\\,\\}$（毫米）。对于一个年平均生物温度为 $B$、年降水量为 $P$（毫米）的站点，定义的指定生物温度中心 $B_c$ 和降水量中心 $P_c$ 是从它们各自集合中取出的值，这些值使得在坐标为 $(\\log_{2} B,\\,\\log_{2} P)$ 的平面中的欧几里得距离平方最小化；如果出现距离相等的情况，则选择较大的中心值。按递增顺序为生物温度中心编制索引 $i_B \\in \\{1,2,3,4,5\\}$，为降水量中心编制索引 $i_P \\in \\{1,2,3,4,5,6,7\\}$，并定义唯一的六边形指数为 $I = 100\\,i_B + i_P$。\n\n该站的月平均温度（单位：$^\\circ\\mathrm{C}$）为：\n$(-5,\\,-2,\\,3,\\,10,\\,16,\\,27,\\,32,\\,31,\\,24,\\,12,\\,5,\\,-1)$，\n月总降水量（单位：毫米）为：\n$(30,\\,28,\\,35,\\,45,\\,60,\\,75,\\,100,\\,90,\\,85,\\,80,\\,85,\\,87)$。\n\n仅使用上述定义（不要引入任何替代的映射方法），计算年平均生物温度 $B$、年降水量 $P$，在以 $2$ 为底的对数空间中执行最近中心分配，并报告最终的六边形指数 $I$。最终答案以纯数字形式表示，不带单位。如果进行任何中间数值近似，请确保其足够精确，以便明确无误地确定正确的最近中心。由于最终答案是整数，因此不需要舍入指令。", "solution": "我们从 Holdridge 的核心定义开始：\n\n1. 年平均生物温度 $B$ 是将所有低于 $0\\,^\\circ\\mathrm{C}$ 或高于 $30\\,^\\circ\\mathrm{C}$ 的月平均温度替换为 $0\\,^\\circ\\mathrm{C}$ 后，对这 $12$ 个月平均温度计算的算术平均值。形式上，\n$$\nB \\;=\\; \\frac{1}{12} \\sum_{m=1}^{12} b(T_m),\n\\quad\nb(T) \\;=\\; \\begin{cases}\nT, & 0 \\le T \\le 30,\\\\\n0, & \\text{otherwise}.\n\\end{cases}\n$$\n\n2. 年降水量 $P$ 是 $12$ 个月总降水量的总和：\n$$\nP \\;=\\; \\sum_{m=1}^{12} P_m.\n$$\n\n3. Holdridge 图使用对数坐标轴；我们通过在以 $2$ 为底的对数空间中选择最近的几何中心来近似六边形的分配。因此，设 $x=\\log_{2} B$ 和 $y=\\log_{2} P$，我们选择 $B_c \\in \\{\\,1.5,\\,3,\\,6,\\,12,\\,24\\,\\}$ 和 $P_c \\in \\{\\,62.5,\\,125,\\,250,\\,500,\\,1000,\\,2000,\\,4000\\,\\}$ 以最小化\n$$\nd^{2} \\;=\\; \\bigl(\\log_{2} B - \\log_{2} B_c\\bigr)^{2} \\;+\\; \\bigl(\\log_{2} P - \\log_{2} P_c\\bigr)^{2}.\n$$\n由于距离在坐标轴上是可分的，最小化 $d^{2}$ 可简化为在 $\\log_{2}$ 空间中独立地选择最接近 $B$ 的 $B_c$ 和最接近 $P$ 的 $P_c$；距离相等时选择较大的中心。\n\n计算 $B$：\n\n- 月平均温度为 $(-5,\\,-2,\\,3,\\,10,\\,16,\\,27,\\,32,\\,31,\\,24,\\,12,\\,5,\\,-1)$。应用 $b(T)$ 将任何 $T<0$ 或 $T>30$ 的值设为 $0$：\n$$\nb(T_m) \\;=\\; (0,\\,0,\\,3,\\,10,\\,16,\\,27,\\,0,\\,0,\\,24,\\,12,\\,5,\\,0).\n$$\n- 调整后月度值的总和：\n$$\n\\sum_{m=1}^{12} b(T_m) \\;=\\; 3 + 10 + 16 + 27 + 24 + 12 + 5 \\;=\\; 97.\n$$\n- 因此，\n$$\nB \\;=\\; \\frac{97}{12}.\n$$\n\n计算 $P$：\n\n- 月总降水量为 $(30,\\,28,\\,35,\\,45,\\,60,\\,75,\\,100,\\,90,\\,85,\\,80,\\,85,\\,87)$ 毫米，所以\n$$\nP \\;=\\; 30 + 28 + 35 + 45 + 60 + 75 + 100 + 90 + 85 + 80 + 85 + 87 \\;=\\; 800.\n$$\n\n在以 $2$ 为底的对数空间中分配最近的中心：\n\n- 计算 $\\log_{2} B$：\n$$\nB \\;=\\; \\frac{97}{12} \\;\\approx\\; 8.083\\overline{3},\n\\qquad\n\\log_{2} B \\;=\\; \\frac{\\ln B}{\\ln 2} \\;\\approx\\; \\log_{2}(8.083\\overline{3}) \\;\\approx\\; 3.015.\n$$\n- 候选生物温度中心及其以 $2$ 为底的对数：\n$$\n\\log_{2}(1.5) \\approx 0.585,\\quad\n\\log_{2}(3) \\approx 1.585,\\quad\n\\log_{2}(6) \\approx 2.585,\\quad\n\\log_{2}(12) \\approx 3.585,\\quad\n\\log_{2}(24) \\approx 4.585.\n$$\n- 沿生物温度轴的差异：\n$$\n|\\log_{2} B - \\log_{2}(6)| \\approx |3.015 - 2.585| \\approx 0.430, \\\\\n|\\log_{2} B - \\log_{2}(12)| \\approx |3.015 - 3.585| \\approx 0.570.\n$$\n对于 $1.5$、$3$ 和 $24$ 的值要远得多。因此，最近的生物温度中心是 $B_c = 6$，这在有序集合 $\\{1.5,\\,3,\\,6,\\,12,\\,24\\}$ 中对应的索引是 $i_B = 3$。\n\n- 计算 $\\log_{2} P$：\n$$\nP \\;=\\; 800 \\;=\\; 2^{5} \\times 25 \\;\\Rightarrow\\; \\log_{2} P \\;=\\; 5 + \\log_{2}(25) \\;=\\; 5 + 2\\log_{2}(5) \\;\\approx\\; 9.643856.\n$$\n- 候选降水量中心及其以 $2$ 为底的对数：\n$$\n\\log_{2}(62.5) \\approx 5.965784,\\quad\n\\log_{2}(125) \\approx 6.965784,\\quad\n\\log_{2}(250) \\approx 7.965784,\\\\\n\\log_{2}(500) \\approx 8.965784,\\quad\n\\log_{2}(1000) \\approx 9.965784,\\quad\n\\log_{2}(2000) \\approx 10.965784,\\quad\n\\log_{2}(4000) \\approx 11.965784.\n$$\n- 沿降水轴在 $P$ 附近的差异：\n$$\n|\\log_{2} P - \\log_{2}(500)| \\approx |9.643856 - 8.965784| \\approx 0.678072, \\\\\n|\\log_{2} P - \\log_{2}(1000)| \\approx |9.643856 - 9.965784| \\approx 0.321928.\n$$\n最近的降水量中心是 $P_c = 1000$，这在有序集合 $\\{62.5,\\,125,\\,250,\\,500,\\,1000,\\,2000,\\,4000\\}$ 中对应的索引是 $i_P = 5$。\n\n计算六边形指数：\n$$\nI \\;=\\; 100\\,i_B + i_P \\;=\\; 100 \\times 3 + 5 \\;=\\; 305.\n$$\n\n因此，由该站数据和指定的映射协议确定的唯一六边形指数是 $I = 305$。", "answer": "$$\\boxed{305}$$", "id": "2473806"}, {"introduction": "超越静态的分类，我们需要量化生物群系的功能，尤其是它们在全球碳循环中的作用。本练习将指导您完成一项生态系统科学家的核心任务：利用涡度相关数据分离净生态系统二氧化碳交换（$F_{\\mathrm{CO2}}$）为其基本组成部分——总初级生产力（GPP）和生态系统呼吸（$R$）。您将学习如何使用夜间数据建立呼吸作用的温度响应模型，并用它来估算整个昼夜周期的碳通量，从而掌握评估生态系统“新陈代谢”的关键技术 [@problem_id:2473798]。", "problem": "针对三种对比鲜明的生物群系，各提供了一组简短、合成但物理上合理的涡度相关时间序列，每组时间序列包含$24$小时周期内的八个等间距样本。每个样本都提供了垂直$\\mathrm{CO}_{2}$通量 $F_{\\mathrm{CO2}}$（正值表示朝向大气的向上通量）和冠层气温 $T$，以及一个指示样本是否在夜间采集的布尔标志。每个案例中的时间步长均相同，为 $10800$ s，因此八个样本恰好覆盖一整天。目标是仅利用夜间温度响应模型，通过将$F_{\\mathrm{CO2}}$分解为总初级生产力 (GPP) 和生态系统呼吸作用 $R$ 来推导出生态系统净生产力 (NEP)，并进而重建整个日周期内的 NEP。\n\n使用的基本定义和假设：\n- 在涡度相关符号约定下（向上为正）的生态系统 $\\mathrm{CO}_{2}$ 交换质量平衡：$F_{\\mathrm{CO2}}(t) = R(t) - \\mathrm{GPP}(t)$。\n- 生态系统净生产力 (NEP) 的定义：$\\mathrm{NEP}(t) = \\mathrm{GPP}(t) - R(t)$。因此，正值的 $\\mathrm{NEP}$ 表示生态系统的净碳吸收。\n- 在夜间，$\\mathrm{GPP}(t) = 0$，因此对于夜间样本，$F_{\\mathrm{CO2}}(t) = R(t)$。\n- 生态系统呼吸作用的温度响应：$R(T) = R_{0}\\, Q_{10}^{(T - 10)/10}$，其中 $R_{0}$ 是在 $T = 10\\,^{\\circ}\\mathrm{C}$ 时的呼吸速率，而 $Q_{10}$ 是温度每升高 $10\\,^{\\circ}\\mathrm{C}$ 时的温度敏感性因子。\n\n你的任务（需分别对每个测试案例执行）：\n1. 仅使用夜间样本和模型 $R(T) = R_{0}\\, Q_{10}^{(T - 10)/10}$，通过对夜间通量的自然对数进行普通最小二乘法拟合，来估计 $R_{0}$ 和 $Q_{10}$。使用自然对数。排除任何 $F_{\\mathrm{CO2}}$ 为非正值的夜间样本（所提供的数据中不存在此种情况）。\n2. 使用拟合得到的呼吸作用参数，根据完整的温度序列预测所有时刻的呼吸速率 $\\widehat{R}(t)$。\n3. 对于日间样本，通过计算 $\\widehat{\\mathrm{GPP}}(t) = \\max(\\widehat{R}(t) - F_{\\mathrm{CO2}}(t), 0)$ 来分解日间通量，从而得到光合作用；并对夜间样本强制设定 $\\widehat{\\mathrm{GPP}}(t) = 0$。\n4. 计算所有时刻的瞬时 $\\mathrm{NEP}(t) = \\widehat{\\mathrm{GPP}}(t) - \\widehat{R}(t)$。\n5. 报告两项总结性诊断指标：\n   - 日间 $\\widehat{\\mathrm{GPP}}(t)$ 的算术平均值，单位为 $\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$，四舍五入保留三位小数。\n   - $24$小时积分 $\\mathrm{NEP}$，单位为 $\\mathrm{g}\\,\\mathrm{C}\\,\\mathrm{m}^{-2}\\,\\mathrm{d}^{-1}$。该值通过对八个样本进行黎曼求和（时间步长 $\\Delta t = 10800$ s）得到，并使用每微摩尔碳 $12 \\times 10^{-6}\\,\\mathrm{g\\,C}$ 的转换因子。结果四舍五入保留三位小数。\n\n参数估计细节：\n- 通过取自然对数将呼吸模型线性化：令 $x = (T - 10)/10$ 且 $y = \\ln R$，模型变为 $y = \\ln R_{0} + (\\ln Q_{10})\\, x$。使用夜间数据对 $\\{(x_{i}, \\ln F_{\\mathrm{CO2},i})\\}$ 通过最小二乘法拟合截距和斜率。\n- 恢复 $R_{0} = \\exp(\\text{截距})$ 和 $Q_{10} = \\exp(\\text{斜率})$。\n\n单位：\n- $F_{\\mathrm{CO2}}$ 单位为 $\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$。\n- $T$ 单位为 $^{\\circ}\\mathrm{C}$。\n- 时间步长 $\\Delta t$ 单位为 s。\n- 日间平均 $\\widehat{\\mathrm{GPP}}$ 单位为 $\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$。\n- 每日积分 $\\mathrm{NEP}$ 单位为 $\\mathrm{g}\\,\\mathrm{C}\\,\\mathrm{m}^{-2}\\,\\mathrm{d}^{-1}$。\n\n测试套件（三个案例）。每个案例中，数组长度为8，索引从0到7，每个样本间隔 $\\Delta t = 10800$ s：\n\n案例1（类温带森林）：\n- $T$ [$^{\\circ}\\mathrm{C}$]: [$6$, $5$, $7$, $12$, $18$, $23$, $16$, $10$]\n- $F_{\\mathrm{CO2}}$ [$\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$]: [$2.274$, $2.121$, $2.437$, $-6.554$, $-10.777$, $-6.614$, $-4.453$, $3.000$]\n- is\\_night: [True, True, True, False, False, False, False, True]\n\n案例2（类暖性稀树草原）：\n- $T$ [$^{\\circ}\\mathrm{C}$]: [$20$, $18$, $17$, $24$, $30$, $34$, $28$, $22$]\n- $F_{\\mathrm{CO2}}$ [$\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$]: [$6.250$, $5.205$, $4.748$, $-10.985$, $-14.375$, $-2.452$, $-4.999$, $7.508$]\n- is\\_night: [True, True, True, False, False, False, False, True]\n\n案例3（类北方森林）：\n- $T$ [$^{\\circ}\\mathrm{C}$]: [$0$, $-2$, $1$, $5$, $12$, $15$, $9$, $3$]\n- $F_{\\mathrm{CO2}}$ [$\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$]: [$0.833$, $0.741$, $0.884$, $-2.882$, $-8.313$, $-5.988$, $-3.585$, $0.994$]\n- is\\_night: [True, True, True, False, False, False, False, True]\n\n程序所需行为：\n- 为每个案例实现上述方法。\n- 为每个案例，计算 $\\widehat{R}_{0}$ [$\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$]、$\\widehat{Q}_{10}$ [无量纲]、日间平均 $\\widehat{\\mathrm{GPP}}$ [$\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$] 和每日积分 $\\mathrm{NEP}$ [$\\mathrm{g}\\,\\mathrm{C}\\,\\mathrm{m}^{-2}\\,\\mathrm{d}^{-1}$]，并四舍五入保留三位小数。\n- 最终输出格式：你的程序应生成单行输出，其中包含一个由逗号分隔的列表，该列表包含三个内部列表（每个案例一个）。每个内部列表中的元素顺序为 [$\\widehat{R}_{0}$,$\\widehat{Q}_{10}$,mean\\_daytime\\_GPP,NEP\\_24h]，所有数值均四舍五入保留三位小数，且无空格，例如：\"[[r01,q101,gpp1,nep1],[r02,q102,gpp2,nep2],[r03,q103,gpp3,nep3]]\"。\n- 不应读取任何输入；所有数据均按上文规定。\n\n答案单位：\n- 报告日间平均 $\\widehat{\\mathrm{GPP}}$，单位为 $\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$，四舍五入保留三位小数。\n- 报告$24$小时积分 $\\mathrm{NEP}$，单位为 $\\mathrm{g}\\,\\mathrm{C}\\,\\mathrm{m}^{-2}\\,\\mathrm{d}^{-1}$，四舍五入保留三位小数。", "solution": "问题陈述已经过严格审查，并被确定为有效。这是一个在生态学和环境生物学领域中定义明确、具有科学依据的问题，具体涉及涡度相关数据的分析。问题提供了求解所需的所有必要数据、定义以及清晰的序贯方法。其中不存在任何矛盾、歧义或违反科学原理之处。\n\n任务是将生态系统净 $\\mathrm{CO}_2$ 交换 ($F_{\\mathrm{CO2}}$) 分解为其组成部分：生态系统呼吸作用 ($R$) 和总初级生产力 (GPP)。这是生物气象学中的一项基础技术。分析将针对三个不同的类生物群系数据集逐一进行。\n\n控制方程如下：\n1.  $\\mathrm{CO}_2$ 通量的质量平衡：$F_{\\mathrm{CO2}}(t) = R(t) - \\mathrm{GPP}(t)$。符号约定为向上（离开生态系统表面）的通量为正。\n2.  生态系统净生产力 (NEP)：$\\mathrm{NEP}(t) = \\mathrm{GPP}(t) - R(t) = -F_{\\mathrm{CO2}}(t)$。\n3.  生态系统呼吸作用的温度依赖模型：$R(T) = R_{0}\\, Q_{10}^{(T - 10)/10}$。此处，$R_0$ 是参考温度为 $10\\,^{\\circ}\\mathrm{C}$ 时的基础呼吸速率，而 $Q_{10}$ 是温度每升高 $10\\,^{\\circ}\\mathrm{C}$ 呼吸速率增加的倍数因子。\n\n该方法的核心在于使用夜间数据来对呼吸模型进行参数化。在夜间，光合作用停止，因此 $\\mathrm{GPP}(t) = 0$。从而，对于夜间样本，测得的通量就等于生态系统呼吸作用：$F_{\\mathrm{CO2}}(t) = R(t)$。这使得参数 $R_0$ 和 $Q_{10}$ 的估算成为可能。\n\n**步骤1：呼吸模型的参数估计**\n指数呼吸模型 $R(T) = R_{0}\\, Q_{10}^{(T - 10)/10}$ 是非线性的。为了便于进行线性最小二乘法拟合，通过取自然对数对模型进行变换：\n$$ \\ln(R) = \\ln(R_{0}) + \\frac{T - 10}{10} \\ln(Q_{10}) $$\n该方程具有线性形式 $y = c + m x$，其中：\n-   $y = \\ln(R)$\n-   $x = (T - 10)/10$\n-   截距 $c = \\ln(R_{0})$\n-   斜率 $m = \\ln(Q_{10})$\n\n对每个案例，我们提取夜间的温度 $T$ 和通量 $F_{\\mathrm{CO2}}$ 样本。我们使用 $F_{\\mathrm{CO2}}$ 作为 $R$ 的测量值。然后，我们计算相应的点对 $(x_i, y_i)$，其中 $x_i = (T_i - 10)/10$ 且 $y_i = \\ln(F_{\\mathrm{CO2},i})$。接着对这些点对应用普通最小二乘法 (OLS) 回归，以找出最优的斜率 $m$ 和截距 $c$。呼吸模型参数随后通过逆变换恢复：\n$$ \\widehat{R}_{0} = \\exp(c) $$\n$$ \\widehat{Q}_{10} = \\exp(m) $$\n\n让我们以**案例1（类温带森林）**为例进行演示。\n夜间数据点（索引为 $0, 1, 2, 7$）如下：\n-   $T_{\\text{night}} = [6, 5, 7, 10]\\,^{\\circ}\\mathrm{C}$\n-   $F_{\\mathrm{CO2, night}} = [2.274, 2.121, 2.437, 3.000]\\,\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$\n\n用于线性回归的变换后变量为：\n-   $x = [ (6-10)/10, (5-10)/10, (7-10)/10, (10-10)/10 ] = [-0.4, -0.5, -0.3, 0.0]$\n-   $y = [ \\ln(2.274), \\ln(2.121), \\ln(2.437), \\ln(3.000) ] \\approx [0.8215, 0.7519, 0.8908, 1.0986]$\n\n对这些 $(x, y)$ 点对执行 OLS，得到 $m \\approx 0.6931$ 和 $c \\approx 1.0986$。\n因此，估计的参数为：\n-   $\\widehat{Q}_{10} = \\exp(0.6931) \\approx 2.000$\n-   $\\widehat{R}_{0} = \\exp(1.0986) \\approx 3.000\\,\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$\n\n**步骤2：重建呼吸作用并分解GPP**\n利用拟合得到的参数 $\\widehat{R}_{0}$ 和 $\\widehat{Q}_{10}$，我们可以使用完整的温度序列 $T$ 来预测所有8个时间步的生态系统呼吸作用 $\\widehat{R}(t)$。\n$$ \\widehat{R}(t) = \\widehat{R}_{0} \\widehat{Q}_{10}^{(T(t) - 10)/10} $$\n对于案例1，使用 $\\widehat{R}_{0} = 3.0$ 和 $\\widehat{Q}_{10} = 2.0$ 计算完整的呼吸作用时间序列。\n\n接着分解出总初级生产力 ($\\widehat{\\mathrm{GPP}}$)。对于夜间样本，$\\widehat{\\mathrm{GPP}}(t)$ 定义为 $0$。对于日间样本，它根据通量平衡方程 $\\mathrm{GPP} = R - F_{\\mathrm{CO2}}$ 计算得出。为确保物理上的合理性（光合作用不能为负），我们使用：\n$$ \\widehat{\\mathrm{GPP}}(t) = \\max(\\widehat{R}(t) - F_{\\mathrm{CO2}}(t), 0) \\quad \\text{for daytime} $$\n\n**步骤3：计算 NEP 和总结性诊断指标**\n使用分解出的各组分，在所有时间步计算瞬时生态系统净生产力：\n$$ \\mathrm{NEP}(t) = \\widehat{\\mathrm{GPP}}(t) - \\widehat{R}(t) $$\n注意，对于日间样本，假设 $\\widehat{R}(t) - F_{\\mathrm{CO2}}(t) > 0$（本案例中此条件成立），则此式简化为 $\\mathrm{NEP}(t) = (\\widehat{R}(t) - F_{\\mathrm{CO2}}(t)) - \\widehat{R}(t) = -F_{\\mathrm{CO2}}(t)$。对于夜间样本，$\\mathrm{NEP}(t) = -\\widehat{R}(t)$。\n\n最后，为每个案例计算两项总结性诊断指标：\n1.  **日间平均 $\\widehat{\\mathrm{GPP}}$**：为所有日间样本计算的 $\\widehat{\\mathrm{GPP}}(t)$ 值的算术平均值。\n2.  **24小时积分 NEP**：该值通过对8个样本进行黎曼求和（均匀时间步长 $\\Delta t = 10800$ s）计算得出。总碳交换量（单位为 $\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}$）使用碳的摩尔质量（$12.0\\,\\mathrm{g/mol}$，或 $12 \\times 10^{-6}\\,\\mathrm{g/\\mu mol}$）转换为 $\\mathrm{g}\\,\\mathrm{C}\\,\\mathrm{m}^{-2}$。\n    $$ \\mathrm{NEP}_{24\\mathrm{h}} = \\left( \\sum_{i=1}^{8} \\mathrm{NEP}(t_i) \\cdot \\Delta t \\right) \\cdot (12 \\times 10^{-6}\\,\\mathrm{g\\,C}/\\mu\\mathrm{mol}) $$\n\n这一完整流程将独立应用于三个测试案例中的每一个。最终输出由随附的程序生成，该程序以计算方式实现了这些步骤。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the eddy covariance partitioning problem for three test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"T\": np.array([6.0, 5.0, 7.0, 12.0, 18.0, 23.0, 16.0, 10.0]),\n            \"F_CO2\": np.array([2.274, 2.121, 2.437, -6.554, -10.777, -6.614, -4.453, 3.000]),\n            \"is_night\": np.array([True, True, True, False, False, False, False, True]),\n        },\n        {\n            \"T\": np.array([20.0, 18.0, 17.0, 24.0, 30.0, 34.0, 28.0, 22.0]),\n            \"F_CO2\": np.array([6.250, 5.205, 4.748, -10.985, -14.375, -2.452, -4.999, 7.508]),\n            \"is_night\": np.array([True, True, True, False, False, False, False, True]),\n        },\n        {\n            \"T\": np.array([0.0, -2.0, 1.0, 5.0, 12.0, 15.0, 9.0, 3.0]),\n            \"F_CO2\": np.array([0.833, 0.741, 0.884, -2.882, -8.313, -5.988, -3.585, 0.994]),\n            \"is_night\": np.array([True, True, True, False, False, False, False, True]),\n        },\n    ]\n\n    all_results = []\n    \n    # Constants\n    DELTA_T_S = 10800.0  # Time step in seconds\n    C_CONVERSION_FACTOR = 12.0 * 1e-6  # gC per umol C\n\n    for case in test_cases:\n        T = case[\"T\"]\n        F_CO2 = case[\"F_CO2\"]\n        is_night = case[\"is_night\"]\n\n        # Step 1: Estimate R0 and Q10 from nighttime data\n        T_night = T[is_night]\n        F_CO2_night = F_CO2[is_night]\n        \n        # Linearize the model: y = ln(R0) + ln(Q10) * x\n        # where x = (T-10)/10 and y = ln(F_CO2)\n        x_reg = (T_night - 10.0) / 10.0\n        y_reg = np.log(F_CO2_night)\n\n        # Perform ordinary least squares using numpy.polyfit (degree 1)\n        # It returns [slope, intercept]\n        slope, intercept = np.polyfit(x_reg, y_reg, 1)\n        \n        # Recover R0 and Q10\n        ln_Q10 = slope\n        ln_R0 = intercept\n        R0_hat = np.exp(ln_R0)\n        Q10_hat = np.exp(ln_Q10)\n\n        # Step 2: Predict respiration R_hat for all time steps\n        R_hat = R0_hat * (Q10_hat ** ((T - 10.0) / 10.0))\n\n        # Step 3: Partition daytime fluxes to get GPP_hat\n        GPP_hat = np.zeros_like(T)\n        is_day = ~is_night\n        \n        daytime_GPP_unconstrained = R_hat[is_day] - F_CO2[is_day]\n        GPP_hat[is_day] = np.maximum(daytime_GPP_unconstrained, 0)\n        \n        # Step 4: Compute instantaneous NEP_hat\n        NEP_hat = GPP_hat - R_hat\n        \n        # Step 5: Calculate summary diagnostics\n        # Mean daytime GPP\n        mean_daytime_GPP = np.mean(GPP_hat[is_day])\n        \n        # 24-hour integrated NEP\n        # Sum of NEP rates * time step to get total umol/m^2/day\n        total_NEP_umol = np.sum(NEP_hat) * DELTA_T_S\n        # Convert to gC/m^2/day\n        NEP_24h_gC = total_NEP_umol * C_CONVERSION_FACTOR\n        \n        # Store results rounded to three decimals\n        results = [\n            round(R0_hat, 3),\n            round(Q10_hat, 3),\n            round(mean_daytime_GPP, 3),\n            round(NEP_24h_gC, 3)\n        ]\n        all_results.append(results)\n\n    # Format the final output string\n    # e.g., \"[[r01,q101,gpp1,nep1],[r02,q102,gpp2,nep2],[r03,q103,gpp3,nep3]]\"\n    inner_lists_str = []\n    for res_list in all_results:\n        # Format numbers to 3 decimal places explicitly for trailing zeros\n        formatted_list = [f\"{x:.3f}\" for x in res_list]\n        inner_lists_str.append(f\"[{','.join(formatted_list)}]\")\n    \n    final_output = f\"[{','.join(inner_lists_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "2473798"}, {"introduction": "为了全面评估一个生物群系在长期碳预算中的角色，我们必须考虑光合作用与呼吸作用之外的更多因素。火灾等自然干扰和木材采伐等管理活动深刻地影响着生态系统的碳储存能力。此练习将引导您从净生态系统生产力（NEP）扩展至净生物群系生产力（NBP），通过构建一个完整的碳质量平衡方程，将干扰事件和横向碳通量纳入考量。通过这个练习，您将能够精准地核算一个受管理的生态系统中的所有主要碳通量途径，从而将生态系统尺度的测量与景观及全球碳收支的宏观问题联系起来 [@problem_id:2473755]。", "problem": "在陆地碳核算中，森林生物群系的控制体积通常被视为包括生态系统边界内的所有活生物量、死亡有机质和土壤。从碳的质量守恒和核心生态系统定义出发，推导大气扰动排放和横向碳通量如何将净生态系统生产力（NEP）转化为净生物群系生产力（NBP）。具体来说，从总初级生产力（GPP）、自养呼吸和异养呼吸的定义开始，构建一个质量平衡，得出一个以NEP、控制体积内扰动造成的直接大气碳排放以及跨生态系统边界的净横向碳传输为函数的NBP表达式。在此质量平衡中，请明确说明采伐物质和火灾排放是如何分类的。\n\n然后，根据以下年度、单位面积归一化的通量数据，使用您推导的表达式计算一个受管理的温带森林的NBP：\n- 总初级生产力 (GPP): $2250$ g C m$^{-2}$ yr$^{-1}$。\n- 自养呼吸 ($R_{\\mathrm{a}}$): $955$ g C m$^{-2}$ yr$^{-1}$。\n- 异养呼吸 ($R_{\\mathrm{h}}$): $895$ g C m$^{-2}$ yr$^{-1}$。\n- 控制体积内年平均化火灾情景产生的直接大气碳排放：$70$ g C m$^{-2}$ yr$^{-1}$。\n- 木材采伐从林分中移除了 $H_{\\mathrm{gross}} = 180$ g C m$^{-2}$ yr$^{-1}$ 的生物量碳；其中一部分（比例为 $f_{\\mathrm{off}} = 0.65$）作为木制品离开生态系统边界，而剩余部分作为采伐剩余物留在原地，并已包含在测量的异养呼吸中。\n- 跨越生态系统边界的溶解和颗粒有机碳的水文横向输出：$28$ g C m$^{-2}$ yr$^{-1}$。\n- 来自上坡流入的、跨越生态系统边界的有机碳的水文横向输入：$6$ g C m$^{-2}$ yr$^{-1}$。\n\n假设净生态系统生产力定义为 $ \\mathrm{NEP} = \\mathrm{GPP} - R_{\\mathrm{a}} - R_{\\mathrm{h}} $，采伐剩余物的分解包含在 $R_{\\mathrm{h}}$ 中，并且所有通量都经过时间平均，以便在年度时间尺度上具有可比性。\n\n以 g C m$^{-2}$ yr$^{-1}$ 为单位报告NBP的值，最终答案应为单个数字，并四舍五入至三位有效数字。", "solution": "对问题陈述进行验证。\n\n步骤1：提取已知条件。\n- 总初级生产力, $\\mathrm{GPP}$: $2250 \\, \\mathrm{g \\, C \\, m^{-2} \\, yr^{-1}}$\n- 自养呼吸, $R_{\\mathrm{a}}$: $955 \\, \\mathrm{g \\, C \\, m^{-2} \\, yr^{-1}}$\n- 异养呼吸, $R_{\\mathrm{h}}$: $895 \\, \\mathrm{g \\, C \\, m^{-2} \\, yr^{-1}}$\n- 火灾产生的直接大气碳排放, $F_{\\mathrm{fire}}$: $70 \\, \\mathrm{g \\, C \\, m^{-2} \\, yr^{-1}}$\n- 总木材采伐量, $H_{\\mathrm{gross}}$: $180 \\, \\mathrm{g \\, C \\, m^{-2} \\, yr^{-1}}$\n- 作为木制品离开生态系统的采伐比例, $f_{\\mathrm{off}}$: $0.65$\n- 有机碳的水文横向输出, $F_{\\mathrm{hydro,out}}$: $28 \\, \\mathrm{g \\, C \\, m^{-2} \\, yr^{-1}}$\n- 有机碳的水文横向输入, $F_{\\mathrm{hydro,in}}$: $6 \\, \\mathrm{g \\, C \\, m^{-2} \\, yr^{-1}}$\n- 净生态系统生产力的定义: $ \\mathrm{NEP} = \\mathrm{GPP} - R_{\\mathrm{a}} - R_{\\mathrm{h}} $\n- 采伐剩余物（未输出的采伐物）的分解包含在 $R_{\\mathrm{h}}$ 中。\n\n步骤2：使用提取的已知条件进行验证。\n该问题具有科学依据，运用了生态系统生态学和碳循环科学中的标准、明确定义的概念（例如 $\\mathrm{GPP}$、$\\mathrm{NEP}$、$\\mathrm{NBP}$）。问题提法恰当，为求得唯一解提供了所有必要的数据和定义。语言客观、精确。所提供的碳通量数值对于温带森林生态系统是符合实际的。没有矛盾、歧义或违反基本原则之处。\n\n步骤3：结论与行动。\n问题有效。将提供解答。\n\n推导和求解过程源于已定义的生态系统控制体积内的碳质量守恒原理。生物群系内碳储量的净变化率，即定义为净生物群系生产力（$\\mathrm{NBP}$），等于所有碳输入之和减去所有碳输出之和。\n\n设 $C$ 为生态系统控制体积中的总碳储量（活生物量、死亡有机质、土壤）。那么，根据定义：\n$$ \\mathrm{NBP} = \\frac{dC}{dt} $$\n进出控制体积的碳通量可分类如下：\n1.  与大气之间的通量：\n    - 输入：总初级生产力（$\\mathrm{GPP}$），即通过光合作用对大气 $\\mathrm{CO}_2$ 的吸收。\n    - 输出：生态系统呼吸（$R_{\\mathrm{eco}}$），即自养呼吸（$R_{\\mathrm{a}}$）和异养呼吸（$R_{\\mathrm{h}}$）之和。\n    - 输出：来自扰动（如火灾 $F_{\\mathrm{fire}}$）的直接排放。\n2.  跨越生态系统边界的横向通量：\n    - 输入：进入生态系统的横向传输，如水文输入（$F_{\\mathrm{hydro,in}}$）。\n    - 输出：离开生态系统的横向传输，包括采伐物质的移除（$F_{\\mathrm{harvest,export}}$）和水文输出（$F_{\\mathrm{hydro,out}}$）。\n\n因此，综合质量平衡方程为：\n$$ \\mathrm{NBP} = \\frac{dC}{dt} = \\mathrm{GPP} - R_{\\mathrm{a}} - R_{\\mathrm{h}} - F_{\\mathrm{fire}} - F_{\\mathrm{harvest,export}} - F_{\\mathrm{hydro,out}} + F_{\\mathrm{hydro,in}} $$\n问题将净生态系统生产力（$\\mathrm{NEP}$）定义为仅由生物过程产生的与大气的净碳交换：\n$$ \\mathrm{NEP} = \\mathrm{GPP} - R_{\\mathrm{a}} - R_{\\mathrm{h}} $$\n将 $\\mathrm{NEP}$ 的定义代入质量平衡方程，得到 $\\mathrm{NBP}$ 和 $\\mathrm{NEP}$ 之间的关系：\n$$ \\mathrm{NBP} = \\mathrm{NEP} - F_{\\mathrm{fire}} - F_{\\mathrm{harvest,export}} - F_{\\mathrm{hydro,out}} + F_{\\mathrm{hydro,in}} $$\n此表达式表明，$\\mathrm{NBP}$ 是经非生物性大气排放（扰动）和净横向碳传输校正后的 $\\mathrm{NEP}$。我们可以将净横向碳传输 $F_{\\mathrm{lateral,net}}$ 定义为所有横向输出之和减去横向输入之和。此外，我们可以定义一个总扰动通量 $F_{\\mathrm{D}}$，作为所有非呼吸性损失的总和。在本问题中，$F_{\\mathrm{D}}$ 包括火灾排放和净横向传输。\n$$ \\mathrm{NBP} = \\mathrm{NEP} - F_{\\mathrm{fire}} - (F_{\\mathrm{harvest,export}} + F_{\\mathrm{hydro,out}} - F_{\\mathrm{hydro,in}}) $$\n这就是所要求的推导关系。\n\n所提供的通量类别分配如下：\n- 火灾排放（$F_{\\mathrm{fire}}$）是直接的大气碳损失。\n- 离开生态系统的采伐物质是一种横向碳损失。其量值为 $F_{\\mathrm{harvest,export}} = H_{\\mathrm{gross}} \\times f_{\\mathrm{off}}$。剩余部分（比例为 $1 - f_{\\mathrm{off}}$）作为采伐剩余物留在原地。问题正确地指出，由此产生的分解排放已被计入 $R_{\\mathrm{h}}$ 项中，从而避免了重复计算。\n- 水文输出（$F_{\\mathrm{hydro,out}}$）和输入（$F_{\\mathrm{hydro,in}}$）是横向通量。\n\n现在，我们计算 $\\mathrm{NBP}$ 的数值。\n首先，计算 $\\mathrm{NEP}$：\n$$ \\mathrm{NEP} = \\mathrm{GPP} - R_{\\mathrm{a}} - R_{\\mathrm{h}} $$\n$$ \\mathrm{NEP} = 2250 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} - 955 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} - 895 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} $$\n$$ \\mathrm{NEP} = 2250 - 1850 = 400 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} $$\n接着，计算横向采伐输出通量：\n$$ F_{\\mathrm{harvest,export}} = H_{\\mathrm{gross}} \\times f_{\\mathrm{off}} = 180 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} \\times 0.65 = 117 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} $$\n最后，将所有数值代入推导出的 $\\mathrm{NBP}$ 表达式：\n$$ \\mathrm{NBP} = \\mathrm{NEP} - F_{\\mathrm{fire}} - F_{\\mathrm{harvest,export}} - F_{\\mathrm{hydro,out}} + F_{\\mathrm{hydro,in}} $$\n$$ \\mathrm{NBP} = 400 - 70 - 117 - 28 + 6 $$\n所有项的单位均为 $\\mathrm{g \\, C \\, m^{-2} \\, yr^{-1}}$。\n$$ \\mathrm{NBP} = 400 - (70 + 117 + 28 - 6) $$\n$$ \\mathrm{NBP} = 400 - (187 + 22) $$\n$$ \\mathrm{NBP} = 400 - 209 $$\n$$ \\mathrm{NBP} = 191 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} $$\n结果 $191$ 有三位有效数字，满足四舍五入的要求。这个正值表明，尽管存在扰动和管理，该森林生态系统仍是一个净碳汇，其速率为 $191 \\, \\mathrm{g \\, C \\, m^{-2} \\, yr^{-1}}$。", "answer": "$$\\boxed{191}$$", "id": "2473755"}]}