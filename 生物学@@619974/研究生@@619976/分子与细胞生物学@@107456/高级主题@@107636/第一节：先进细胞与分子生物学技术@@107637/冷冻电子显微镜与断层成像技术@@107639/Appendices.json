{"hands_on_practices": [{"introduction": "一个成功的单颗粒冷冻电镜项目始于周密的实验设计。本练习将引导您完成数据收集中最基本的决策之一：根据目标分辨率选择合适的像素尺寸，并为避免计算伪影而确定颗粒挑选框的大小。这项基于香农-奈奎斯特采样定理（Shannon–Nyquist sampling theorem）的计算，是保证高质量三维重构的关键第一步。[@problem_id:2940156]", "problem": "正在为一个球状蛋白质规划一个单颗粒低温电子显微镜（cryo-EM）数据集，其估计的投影直径为 $D = 220\\,\\text{\\AA}$。目标重构分辨率为 $d = 3.2\\,\\text{\\AA}$。您需要 (i) 根据香non-奈奎斯特定理选择一个满足采样要求的像素尺寸 $p$，以及 (ii) 确定一个足够大的盒子尺寸（以像素为单位），该盒子需能容纳颗粒以及用于抑制环绕伪影的填充区域。当通过快速傅里叶变换（FFT）使用离散傅里叶变换（DFT）在空间频率 $1/d$ 处进行傅里叶域带限时，会产生这种伪影。\n\n请仅使用以下基本原理来证明您的选择：\n\n- 采样：香农-奈奎斯特定理指出，对于一个最大空间频率为 $k_{\\max}$ 的带限信号，如果采样频率 $k_{s}$ 满足 $k_{s} \\ge 2 k_{\\max}$，则可以无混叠地表示该信号。在使用像素尺寸为 $p$ 的实空间成像中，采样频率为 $k_{s} = 1/p$，奈奎斯特频率为 $k_{N} = 1/(2p)$。实空间分辨率 $d$ 对应于空间频率截止值 $k_{\\max} = 1/d$。\n\n- DFT 下的环绕抑制：DFT 实现的是循环卷积。如果在傅里叶空间中使用一个沿每个笛卡尔轴半宽为 $k_{\\max}$ 的可分离矩形通带进行带限（这对应于一个由一维 sinc 函数乘积构成的实空间脉冲响应），那么实空间核函数的主瓣从原点延伸到其第一零点，该距离可以从傅里叶变换对中计算得出。为避免主瓣与物体的周期性图像重叠，要求在颗粒的每一侧都有一个实空间填充边距，其大小至少等于该核函数到第一零点的距离。\n\n假设带限是沿每个轴截止频率为 $k_{\\max} = 1/d$ 的理想可分离矩形低通滤波器，并且实际操作中的边缘切趾足以抑制第一零点之外的贡献，从而使得此边距标准在上述意义上被认为是“充分”的。请选择在满足目标分辨率 $d$ 采样要求的条件下最大的 $p$ 值以最小化像素数量，然后根据所述标准计算出能够容纳颗粒及所有侧面所需填充的最小整数盒子尺寸（以像素为单位）。\n\n仅报告最终的盒子尺寸，以单个整数像素数表示。在最终的方框答案中不要包含单位。", "solution": "所述问题具有科学依据，表述清晰，客观，并包含足够的信息以得出唯一解。这是低温电子显微镜领域一个标准的前期计算。我们将开始求解。\n\n该问题要求确定成像蛋白质颗粒所需的最小整数盒子尺寸（以像素为单位）。此计算分两个阶段进行：首先，根据目标分辨率选择合适的像素尺寸；其次，计算考虑填充后的实空间总盒子尺寸，然后将其转换为像素单位。\n\n第 1 部分：确定像素尺寸 $p$。\n\n香农-奈奎斯特定理为像素尺寸提供了基本约束。该定理指出，为了无歧义地表示一个最大空间频率为 $k_{\\max}$ 的信号，采样频率 $k_s$ 必须满足以下条件：\n$$k_s \\ge 2 k_{\\max}$$\n问题在成像的背景下提供了这些量的定义。目标分辨率 $d$ 对应于最大空间频率 $k_{\\max} = 1/d$。采样使用尺寸为 $p$ 的像素进行，因此采样频率为 $k_s = 1/p$。\n\n将这些定义代入采样定理可得：\n$$\\frac{1}{p} \\ge \\frac{2}{d}$$\n求解像素尺寸 $p$，我们得到：\n$$p \\le \\frac{d}{2}$$\n这为避免混叠伪影并实现目标分辨率 $d = 3.2\\,\\text{\\AA}$ 设定了像素尺寸的上限。问题要求我们选择满足此条件的最大可能像素尺寸，从而最小化图像中的总像素数。这一选择对应于等式：\n$$p = \\frac{d}{2}$$\n代入给定的 $d$ 值：\n$$p = \\frac{3.2\\,\\text{\\AA}}{2} = 1.6\\,\\text{\\AA}$$\n这就是在后续计算中将要使用的像素尺寸。\n\n第 2 部分：确定盒子大小 $N$。\n\n盒子必须足够大，以容纳颗粒和足够的填充区域，从而减轻傅里叶处理过程中的环绕伪影。这些伪影的产生是因为离散傅里叶变换（DFT）隐含地假设信号是周期性的，导致在傅里叶空间中应用滤波器时会发生循环卷积。\n\n问题明确了填充要求。带限操作是使用一个沿各轴截止频率为 $k_{\\max} = 1/d$ 的理想可分离矩形低通滤波器来执行的。这样一个频域矩形函数的傅里叶逆变换在实空间中是一个类 sinc 函数。在一维情况下，该滤波器是一个宽度为 $2k_{\\max}$ 的矩形脉冲。其傅里叶逆变换，即滤波操作的脉冲响应或点扩展函数（PSF），与 $\\text{sinc}(2k_{\\max}x)$ 成正比，其中归一化 sinc 函数定义为 $\\text{sinc}(u) = \\sin(\\pi u)/(\\pi u)$。\n\n此 sinc 函数的第一个零点（对于 $x>0$）出现在其自变量为 1 时：\n$$2k_{\\max}x_{\\text{zero}} = 1$$\n求解 $x_{\\text{zero}}$ 得到 PSF 主瓣的范围：\n$$x_{\\text{zero}} = \\frac{1}{2k_{\\max}}$$\n代入 $k_{\\max} = 1/d$，我们找到所需的填充边距：\n$$\\text{padding margin} = \\frac{1}{2(1/d)} = \\frac{d}{2}$$\n这个填充必须应用于颗粒的每一侧。盒子在实空间中所需的总边长 $L$ 是颗粒直径 $D$ 与两侧填充之和：\n$$L = D + 2 \\times (\\text{padding margin}) = D + 2 \\times \\left(\\frac{d}{2}\\right) = D + d$$\n使用给定的值 $D = 220\\,\\text{\\AA}$ 和 $d = 3.2\\,\\text{\\AA}$:\n$$L = 220\\,\\text{\\AA} + 3.2\\,\\text{\\AA} = 223.2\\,\\text{\\AA}$$\n这是盒子的最小实空间尺寸。要计算盒子的像素尺寸 $N$，我们将此长度除以像素尺寸 $p$：\n$$N_{\\text{pixels}} = \\frac{L}{p} = \\frac{223.2\\,\\text{\\AA}}{1.6\\,\\text{\\AA}/\\text{pixel}} = 139.5\\,\\text{pixels}$$\n由于像素数必须是整数，并且盒子必须足够大以包含整个长度，我们必须对这个值向上取整。满足条件 $N \\ge 139.5$ 的最小整数 $N$ 是：\n$$N = 140$$\n因此，成像盒子的边长应为 140 像素。", "answer": "$$\\boxed{140}$$", "id": "2940156"}, {"introduction": "理解影响图像质量的物理限制是优化冷冻电镜数据的关键。本练习聚焦于非弹性散射，这一过程会降低图像衬度并增加噪声，尤其是在冷冻电子断层扫描所使用的较厚样品中。通过依据比尔-朗伯定律（Beer–Lambert law）进行计算，您将能够量化非弹性散射对信号的削弱作用，并从根本上理解能量过滤器为何能显著提升信噪比（SNR）。[@problem_id:2940169]", "problem": "在冷冻电子显微技术 (cryo-EM) 和冷冻电子断层扫描技术中，穿过玻璃态冰的电子会经历非弹性散射，这会使它们从零损峰中被移除，从而降低图像衬度并改变噪声统计特性。考虑一个厚度为 $t$ 的均匀玻璃态冰样品，一束恒定通量的入射电子束穿过它。假设非弹性散射过程遵循指数衰减：电子行进路径长度 $t$ 后未经历非弹性事件的生存概率由比尔-朗伯定律和非弹性平均自由程 $\\lambda_{\\text{inel}}$ 决定。\n\n(a) 从比尔-朗伯定律和非弹性平均自由程的定义出发，推导在穿过厚度为 $t$ 的样品时，至少经历一次非弹性散射事件的电子分数 $p_{\\text{inel}}$ 的表达式。\n\n(b) 对于一个在 $300$ 千电子伏特下进行冷冻电子断层扫描的薄片（lamella），取 $\\lambda_{\\text{inel}} = 350$ 纳米，$t = 150$ 纳米。使用 (a) 部分的表达式，计算 $p_{\\text{inel}}$ 的数值。将答案四舍五入到四位有效数字，并以无单位小数表示。\n\n(c) 简要解释在散粒噪声主导的探测条件下，(b) 部分推导出的 $p_{\\text{inel}}$ 值如何影响图像信噪比 (SNR)。在以下简化假设下：只有零损电子携带样品特异性衬度（信号），而所有探测到的电子都贡献泊松噪声，并且一个理想的柱后能量过滤器只透射零损电子。推导经过滤波的图像相对于未滤波图像的 SNR 改善因子，用 $t$ 和 $\\lambda_{\\text{inel}}$ 表示。在最终答案中，不要计算此因子的数值；仅提供 (b) 部分中 $p_{\\text{inel}}$ 的数值作为最终答案。仅按要求对 (b) 部分所求的量进行四舍五入。", "solution": "在尝试解答之前，对问题陈述进行验证。\n\n步骤 1：提取已知条件\n- 均匀玻璃态冰样品的厚度为 $t$。\n- 入射电子束具有恒定通量。\n- 非弹性散射遵循指数衰减（比尔-朗伯定律）。\n- 电子在路径长度为 $t$ 后的生存概率由该定律和非弹性平均自由程 $\\lambda_{\\text{inel}}$ 决定。\n- (a) 部分：推导在厚度 $t$ 内至少经历一次非弹性散射事件的电子分数 $p_{\\text{inel}}$ 的表达式。\n- (b) 部分：对于一个在 $300$ 千电子伏特下进行冷冻电子断层扫描的薄片，$\\lambda_{\\text{inel}} = 350$ 纳米，$t = 150$ 纳米。计算 $p_{\\text{inel}}$ 的数值，四舍五入到四位有效数字。\n- (c) 部分：解释 $p_{\\text{inel}}$ 对图像信噪比 (SNR) 的影响，并推导滤波图像相对于未滤波图像的 SNR 改善因子，用 $t$ 和 $\\lambda_{\\text{inel}}$ 表示。此部分的假设是：只有零损电子携带信号，所有探测到的电子都贡献泊松噪声，并且一个理想能量过滤器只透射零损电子。\n\n步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据。应用比尔-朗伯定律描述电子在介质中的衰减是电子显微学中的一个标准物理模型。非弹性平均自由程（$\\lambda_{\\text{inel}}$）的概念是此描述的基础。所提供的样品厚度和在 $300$ keV 下的 $\\lambda_{\\text{inel}}$ 数值对于冷冻电子断层扫描是物理上现实的。该问题提法清晰，每个部分都要求根据所提供的信息和标准原理推导或计算一个量。 (c) 部分的假设被明确陈述，用于建立一个可形式化的、尽管简化的电子成像 SNR 模型，这是一种标准的教学方法。该问题不包含科学不准确、模糊或矛盾之处。它是一个应用于分子和细胞生物学的物理学中有效且可解的问题。\n\n步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n(a) 非弹性散射分数 $p_{\\text{inel}}$ 的推导\n\n比尔-朗伯定律描述了粒子束穿过介质时的衰减。设 $N(x)$ 为电子进入样品行进距离 $x$ 后未发生非弹性散射事件的数量。$N(x)$ 相对于距离 $x$ 的变化率与 $N(x)$ 本身成正比：\n$$\n\\frac{dN(x)}{dx} = - \\mu N(x)\n$$\n其中 $\\mu$ 是非弹性散射的线性衰减系数。非弹性平均自由程 $\\lambda_{\\text{inel}}$ 定义为电子在发生非弹性碰撞前行进的平均距离，它是衰减系数的倒数：\n$$\n\\mu = \\frac{1}{\\lambda_{\\text{inel}}}\n$$\n将此代入微分方程，得到：\n$$\n\\frac{dN(x)}{dx} = -\\frac{1}{\\lambda_{\\text{inel}}} N(x)\n$$\n这是一个一阶线性常微分方程。我们通过分离变量法求解，从入射表面（$x=0$）积分到深度 $t$。设 $N_0$ 为 $x=0$ 处的初始电子数。\n$$\n\\int_{N_0}^{N(t)} \\frac{dN}{N} = \\int_{0}^{t} -\\frac{1}{\\lambda_{\\text{inel}}} dx\n$$\n$$\n\\ln(N(t)) - \\ln(N_0) = -\\frac{t}{\\lambda_{\\text{inel}}}\n$$\n$$\n\\ln\\left(\\frac{N(t)}{N_0}\\right) = -\\frac{t}{\\lambda_{\\text{inel}}}\n$$\n未发生非弹性散射的电子分数（即“零损”分数），我们记为 $p_0$，由下式给出：\n$$\np_0 = \\frac{N(t)}{N_0} = \\exp\\left(-\\frac{t}{\\lambda_{\\text{inel}}}\\right)\n$$\n这就是生存概率。至少经历一次非弹性散射事件的电子分数 $p_{\\text{inel}}$ 是生存概率的补集。这是因为任何给定的电子要么被散射，要么没有。\n$$\np_{\\text{inel}} + p_0 = 1\n$$\n因此，$p_{\\text{inel}}$ 的表达式为：\n$$\np_{\\text{inel}} = 1 - p_0 = 1 - \\exp\\left(-\\frac{t}{\\lambda_{\\text{inel}}}\\right)\n$$\n\n(b) $p_{\\text{inel}}$ 的数值计算\n\n给定值为 $t = 150$ nm 和 $\\lambda_{\\text{inel}} = 350$ nm。我们将这些值代入推导出的 $p_{\\text{inel}}$ 表达式中。比值 $t/\\lambda_{\\text{inel}}$ 是一个无量纲的量。\n$$\n\\frac{t}{\\lambda_{\\text{inel}}} = \\frac{150}{350} = \\frac{15}{35} = \\frac{3}{7}\n$$\n现在，我们计算 $p_{\\text{inel}}$：\n$$\np_{\\text{inel}} = 1 - \\exp\\left(-\\frac{3}{7}\\right)\n$$\n对此表达式进行数值计算：\n$$\n\\frac{3}{7} \\approx 0.4285714\n$$\n$$\n\\exp\\left(-\\frac{3}{7}\\right) \\approx \\exp(-0.4285714) \\approx 0.651415\n$$\n$$\np_{\\text{inel}} \\approx 1 - 0.651415 = 0.348585\n$$\n将此结果四舍五入到四位有效数字，我们得到：\n$$\np_{\\text{inel}} \\approx 0.3486\n$$\n\n(c) 对 SNR 的影响及 SNR 改善因子的推导\n\n量 $p_{\\text{inel}}$ 代表被非弹性散射的电子的分数。根据问题的简化假设，这些电子会贡献噪声，但不会贡献由零损电子独家携带的有用信号。较高的 $p_{\\text{inel}}$ 值意味着入射电子剂量中有更大一部分被转化为背景噪声，而对图像衬度没有贡献。这直接降低了信噪比 (SNR)，因为信号分量（来自零损电子）相对于总噪声（来自所有探测到的电子）变得更弱。\n\n现在，我们推导 SNR 改善因子。设 $N_0$ 为总入射电子通量。\n零损（携带信号的）电子数量为 $N_{ZL}$：\n$$\nN_{ZL} = N_0 \\exp\\left(-\\frac{t}{\\lambda_{\\text{inel}}}\\right)\n$$\n信号 $S$ 与携带信号的电子数成正比。我们可以说 $S$ 是 $N_{ZL}$ 的一个调制。然而，为了分析基本的 SNR 依赖关系，我们可以认为“信号强度”与 $N_{ZL}$ 成正比。\n噪声被假设为泊松散粒噪声，其大小等于探测到的电子数的平方根。\n\n情况 1：未滤波图像\n所有电子都被探测到。探测到的电子总数为 $N_{total, unf} = N_0$。\n噪声为 $\\sigma_{unf} = \\sqrt{N_{total, unf}} = \\sqrt{N_0}$。\nSNR 是信号强度与噪声的比值：\n$$\nSNR_{unf} \\propto \\frac{N_{ZL}}{\\sigma_{unf}} = \\frac{N_0 \\exp(-t/\\lambda_{\\text{inel}})}{\\sqrt{N_0}} = \\sqrt{N_0} \\exp\\left(-\\frac{t}{\\lambda_{\\text{inel}}}\\right)\n$$\n\n情况 2：滤波图像\n理想的能量过滤器移除了所有非弹性散射的电子。只有零损电子被探测到。\n探测到的电子总数为 $N_{total, fil} = N_{ZL} = N_0 \\exp(-t/\\lambda_{\\text{inel}})$。\n噪声为 $\\sigma_{fil} = \\sqrt{N_{total, fil}} = \\sqrt{N_0 \\exp(-t/\\lambda_{\\text{inel}})}$。\n信号强度仍然与 $N_{ZL}$ 成正比，因为是相同的电子携带信号。\nSNR 为：\n$$\nSNR_{fil} \\propto \\frac{N_{ZL}}{\\sigma_{fil}} = \\frac{N_0 \\exp(-t/\\lambda_{\\text{inel}})}{\\sqrt{N_0 \\exp(-t/\\lambda_{\\text{inel}})}} = \\sqrt{N_0 \\exp\\left(-\\frac{t}{\\lambda_{\\text{inel}}}\\right)} = \\sqrt{N_0} \\exp\\left(-\\frac{t}{2\\lambda_{\\text{inel}}}\\right)\n$$\n\nSNR 改善因子是滤波后 SNR 与未滤波 SNR 的比值：\n$$\n\\text{Factor} = \\frac{SNR_{fil}}{SNR_{unf}} = \\frac{\\sqrt{N_0} \\exp(-t/(2\\lambda_{\\text{inel}}))}{\\sqrt{N_0} \\exp(-t/\\lambda_{\\text{inel}})}\n$$\n$$\n\\text{Factor} = \\exp\\left(-\\frac{t}{2\\lambda_{\\text{inel}}} - \\left(-\\frac{t}{\\lambda_{\\text{inel}}}\\right)\\right) = \\exp\\left(-\\frac{t}{2\\lambda_{\\text{inel}}} + \\frac{t}{\\lambda_{\\text{inel}}}\\right)\n$$\n$$\n\\text{Factor} = \\exp\\left(\\frac{t}{2\\lambda_{\\text{inel}}}\\right)\n$$\n这个因子代表了通过使用理想能量过滤器移除非弹性散射电子的噪声贡献所获得的 SNR 改善。", "answer": "$$\n\\boxed{0.3486}\n$$", "id": "2940169"}, {"introduction": "在获得初步的三维重构图后，通常需要进行后处理以提升其可解释性。本练习将带您实践一种关键的后处理技术——B因子锐化，它用于补偿由样品运动或结构异质性导致的各向同性分辨率衰减。通过对傅里葉振幅谱进行线性回归分析，您将学习如何估计并校正这种指数衰减，从而“锐化”密度图，使其高分辨率特征更加清晰。[@problem_id:2940128]", "problem": "通过低温电子显微技术 (cryo-EM) 重建的三维大分子密度，由于束致运动和结构无序，通常会表现出高空间频率对比度的各向同性损失。在傅里叶空间中，这种损失通常通过德拜-瓦勒衰减（也称为原子位移参数或B因子）来建模，该衰减导致振幅随空间频率大小的平方近似呈指数衰减。在傅里叶振幅仅依赖于空间频率大小的各向同性径向平均中，请考虑以下假设和任务。\n\n基于经过充分检验的原理的假设：\n- 在各向同性径向平均中，由于原子位移，傅里叶变换振幅的大小随空间频率大小的平方近似呈指数衰减。这与晶体学中用于德拜-瓦勒因子的物理原理相同。\n- 对于一个恒定的尺度因子，取自然对数可将指数定律转换成关于空间频率大小平方的线性关系。\n\n任务：\n1. 从振幅随空间频率大小变化的指数衰减原理出发，使用自然对数获得一个线性关系。展示如何通过对测量振幅的对数与空间频率大小的平方进行线性最小二乘回归来估计各向同性B因子。提供将回归斜率与B因子联系起来的表达式。\n2. 使用估计的B因子，推导用于补偿衰减的频域乘法因子，从而得到锐化谱。然后为所提供的测试用例计算锐化谱。\n3. 数值稳定性要求：对数仅对正输入有定义。为避免在实践中出现未定义的操作，应将任何非正的测量振幅钳位，用一个小的正常数 $\\varepsilon$ 替换。在您的计算中使用 $\\varepsilon = 10^{-12}$ 。\n4. 单位：空间频率大小的单位必须是埃格斯特朗的倒数 $\\left(\\text{\\AA}^{-1}\\right)$；估计的B因子的单位必须是平方埃格斯特朗 $\\left(\\text{\\AA}^{2}\\right)$。振幅的单位是任意一致的单位。\n\n测试套件 (为每个案例提供结果)：\n- 案例A (清晰的各向同性衰减)：\n  - 空间频率大小 $s$ (单位 $\\text{\\AA}^{-1}$): $[0.05, 0.10, 0.15, 0.20, 0.25]$。\n  - 测量的谱振幅 $|F(s)|$: $[95.12294245, 81.87307531, 63.76281516, 44.93289641, 28.65047967]$。\n- 案例B (边界情况，无衰减)：\n  - 空间频率大小 $s$ (单位 $\\text{\\AA}^{-1}$): $[0.05, 0.10, 0.15, 0.20, 0.25]$。\n  - 测量的谱振幅 $|F(s)|$: $[50.0, 50.0, 50.0, 50.0, 50.0]$。\n- 案例C (有噪声，衰减更强，频带更宽)：\n  - 空间频率大小 $s$ (单位 $\\text{\\AA}^{-1}$): $[0.05, 0.10, 0.15, 0.20, 0.25, 0.30]$。\n  - 测量的谱振幅 $|F(s)|$: $[178.12674937, 152.60855346, 99.78690897, 63.25078450, 29.75086356, 13.97874665]$。\n\n对于每个案例：\n- 通过使用无加权最小二乘法拟合测量振幅的对数与空间频率大小平方的线性模型，估计以 $\\text{\\AA}^{2}$ 为单位的B因子。\n- 通过将测量谱乘以从估计的B因子导出的补偿因子，计算锐化谱。\n- 为每个案例报告一个包含以下内容的数对：\n  - 估计的B因子，以实数 (浮点数) 形式表示。\n  - 该案例中最高空间频率处的锐化振幅，以实数 (浮点数) 形式表示。\n\n角度单位不适用。将所有输出表示为不带百分号的实数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个案例对应一个按上述顺序排列的双元素列表。例如，输出必须采用 $[[b_{A}, v_{A}], [b_{B}, v_{B}], [b_{C}, v_{C}]]$ 的形式，其中 $b_{X}$ 是案例 $X$ 的估计B因子，$v_{X}$ 是案例 $X$ 在最高空间频率处的锐化振幅。", "solution": "所呈现的问题是结构生物学信号处理领域，特别是低温电子显微技术中，一个定义明确的任务。它要求应用一个标准的物理模型——德拜-瓦勒因子——和一个标准的数学技术——线性最小二乘回归——来估计和校正傅里叶空间中的信号衰减。所有必要的数据和约束都已提供。该问题具有科学依据、客观且内部一致。因此，将提供一个解决方案。\n\n核心原理是，无论是热运动还是结构无序引起的随机原子位移，都会导致在较高空间频率下相关性的损失。在傅里叶空间中，这表现为信号振幅的指数衰减。对于一个各向同性过程，这种衰减仅取决于空间频率的大小，$s$。测量的傅里叶振幅 $|F_{meas}(s)|$ 与理想的、未衰减的振幅 $|F_{true}(s)|$ 通过德拜-瓦勒因子相关联：\n\n$$\n|F_{meas}(s)| = |F_{true}(s)| \\cdot \\exp\\left(-\\frac{B s^2}{4}\\right)\n$$\n\n这里，$B$ 是各向同性B因子，单位为面积 (例如 $\\text{\\AA}^2$)，$s$ 是空间频率，单位为长度的倒数 (例如 $\\text{\\AA}^{-1}$)，这确保了指数函数的参数是无量纲的。\n\n为了估计B因子，我们必须从这个模型中建立一个线性关系。在一个有限的空间频率范围内，真实振幅 $|F_{true}(s)|$ 可以近似为一个常数 $C$。模型随之简化为：\n\n$$\n|F_{meas}(s)| \\approx C \\cdot \\exp\\left(-\\frac{B s^2}{4}\\right)\n$$\n\n对两边取自然对数，可将方程线性化：\n\n$$\n\\ln(|F_{meas}(s)|) = \\ln(C) - \\frac{B}{4}s^2\n$$\n\n该方程是直线形式 $y = mx + c$，其中：\n- 因变量是 $y = \\ln(|F_{meas}(s)|)$。\n- 自变量是 $x = s^2$。\n- 斜率是 $m = -B/4$。\n- y轴截距是 $c = \\ln(C)$。\n\n通过对数据点 $(s_i^2, \\ln(|F_{meas}(s_i)|))$ 进行线性最小二乘回归，我们得到斜率的估计值 $\\hat{m}$。根据这个斜率，可以直接确定B因子 $B$：\n\n$$\n\\hat{B} = -4\\hat{m}\n$$\n\n问题要求采取数值稳定性预防措施。自然对数对于非正参数没有定义。因此，在计算对数之前，任何测量振幅 $|F_{meas}(s)| \\le 0$ 都必须被替换为一个小的正常数 $\\varepsilon = 10^{-12}$。因此，因变量更准确地定义为 $y = \\ln(\\max(|F_{meas}(s)|, \\varepsilon))$。\n\n一旦估计出B因子 $\\hat{B}$，就可以校正衰减。这个过程称为锐化，它涉及将测量谱乘以一个补偿因子 $W(s)$，该因子是估计衰减的倒数：\n\n$$\nW(s) = \\left[\\exp\\left(-\\frac{\\hat{B} s^2}{4}\\right)\\right]^{-1} = \\exp\\left(\\frac{\\hat{B} s^2}{4}\\right)\n$$\n\n然后，锐化谱 $|F_{sharp}(s)|$ 按如下方式计算：\n\n$$\n|F_{sharp}(s)| = |F_{meas}(s)| \\cdot W(s) = |F_{meas}(s)| \\cdot \\exp\\left(\\frac{\\hat{B} s^2}{4}\\right)\n$$\n\n此过程应用于每个测试用例。对于每个案例，我们首先计算对数振幅与频率平方图的斜率以找到 $\\hat{B}$，然后使用这个 $\\hat{B}$ 来计算所提供的最高空间频率下的锐化振幅。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the cryo-EM B-factor estimation and sharpening problem for a suite of test cases.\n    \"\"\"\n    \n    # Define the small positive constant for numerical stability.\n    epsilon = 1e-12\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (clean, isotropic attenuation)\n        {\n            \"s\": np.array([0.05, 0.10, 0.15, 0.20, 0.25]),\n            \"f_meas\": np.array([95.12294245, 81.87307531, 63.76281516, 44.93289641, 28.65047967]),\n        },\n        # Case B (boundary, no decay)\n        {\n            \"s\": np.array([0.05, 0.10, 0.15, 0.20, 0.25]),\n            \"f_meas\": np.array([50.0, 50.0, 50.0, 50.0, 50.0]),\n        },\n        # Case C (noisy, stronger attenuation, extended band)\n        {\n            \"s\": np.array([0.05, 0.10, 0.15, 0.20, 0.25, 0.30]),\n            \"f_meas\": np.array([178.12674937, 152.60855346, 99.78690897, 63.25078450, 29.75086356, 13.97874665]),\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        s = case[\"s\"]\n        f_meas = case[\"f_meas\"]\n\n        # 1. Prepare data for linear regression\n        # Independent variable x = s^2\n        x = s**2\n        \n        # Dependent variable y = ln(|F_meas(s)|)\n        # Apply clamping for numerical stability\n        clamped_f_meas = np.maximum(f_meas, epsilon)\n        y = np.log(clamped_f_meas)\n\n        # 2. Perform linear least-squares regression to find the slope\n        # The model is y = m*x + c. np.polyfit returns [m, c].\n        slope, _ = np.polyfit(x, y, 1)\n\n        # 3. Estimate the B-factor from the slope\n        # B = -4 * slope\n        b_factor = -4.0 * slope\n\n        # 4. Compute the sharpened magnitude at the highest spatial frequency\n        s_max = s[-1]\n        f_meas_at_s_max = f_meas[-1]\n        \n        # Sharpening factor W(s) = exp(B * s^2 / 4)\n        sharpening_factor = np.exp(b_factor * s_max**2 / 4.0)\n        \n        # Sharpened magnitude |F_sharp(s)| = |F_meas(s)| * W(s)\n        sharpened_mag_at_s_max = f_meas_at_s_max * sharpening_factor\n\n        # 5. Store the results for the current case\n        results.append([b_factor, sharpened_mag_at_s_max])\n\n    # Final print statement in the exact required format.\n    # The str() representation of a list is its string literal form, which is what is needed.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2940128"}]}