{"hands_on_practices": [{"introduction": "将基因组物理压缩成染色质是调控 DNA 可及性的基本机制。为了建立对这一原理的定量直觉，我们可以使用一个简化的生物物理模型。本练习将引导你使用一维晶格模型，推导核小体重复长度 ($NRL$) 与转录因子可及的 DNA 比例之间的关系。通过完成此计算，你将精确地看到连接 DNA 长度（区分开放的常染色质和紧凑的异染色质的关键特征）的差异如何直接决定基因调控元件暴露或隐藏的概率。[@problem_id:2944124]", "problem": "考虑一个长的染色质纤维，其模型为一个一维（1D）周期性晶格，其中每个重复单元包含一个长度为 $147$ 碱基对（bp）的核小体核心颗粒，其后跟一个平均长度为 $L$ bp的连接子。因此，核小体重复长度（NRL）为 $NRL = 147 + L$。假设以下基本事实：在稳态条件下，核小体核心颗粒会遮蔽脱氧核糖核酸（DNA），阻止大多数转录因子的结合，而连接子DNA是可及的；一个长度为 $m$ bp的转录因子（TF）结合位点是可及的，当且仅当整个 $m$-bp基序完全位于一个连接子片段内（在极长纤维的极限情况下，忽略核小体的瞬时解开和边界效应）。\n\n设 $m = 10$ bp。将在上述一维晶格模型下，所有可能的基序起始位置中，能使整个 $m$-bp基序完全位于连接子DNA内的那部分位置所占的比例，定义为可及比例 $f(L,m)$。\n\n1. 从晶格的周期性和在单碱基对分辨率下对基序起始位置的均匀采样出发，推导出 $f(L,m)$ 作为 $L$ 和 $m$ 的函数，该函数在 $L \\ge m$ 时有效。\n2. 在常染色质中，取 $L_{\\mathrm{eu}} = 60$ bp；在异染色质中，取 $L_{\\mathrm{het}} = 20$ bp。使用你得到的 $f(L,m)$ 表达式，计算比率\n$$\nR \\equiv \\frac{f(L_{\\mathrm{eu}}, m)}{f(L_{\\mathrm{het}}, m)}.\n$$\n将 $R$ 报告为一个无单位的、四舍五入到四位有效数字的小数。", "solution": "该问题陈述经过验证，被认为是科学上可靠、提法恰当、客观且内部一致的。它提出了一个简化但标准的染色质可及性生物物理模型。所有必需的参数均已定义，目标明确。因此，我将给出完整解答。\n\n该问题分两部分解决。首先，推导可及比例 $f(L,m)$；其次，计算特定染色质状态下的比率 $R$。\n\n1. 可及比例 $f(L,m)$ 的推导。\n染色质纤维的模型是一个一维周期性晶格。每个重复单元的总长度称为核小体重复长度（$NRL$），由一个核小体核心颗粒和一个脱氧核糖核酸（DNA）连接子片段组成。\n包裹在核小体核心颗粒中的DNA长度为 $147$ 碱基对（bp）。\n连接子DNA的长度为 $L$ bp。\n因此，一个周期单元的总长度是 $NRL = 147 + L$。\n\n我们假设转录因子（TF）结合基序沿DNA的起始位置具有均匀概率。由于晶格的周期性，我们可以通过分析单个长度为 $NRL$ 的重复单元内的可及性来确定总体的可及比例。\n在单碱基对分辨率下，一个重复单元内基序的可能起始位置总数等于该单元的长度，即 $NRL = 147 + L$。\n\n一个长度为 $m$ bp的TF结合基序被定义为可及的，当且仅当整个基序位于连接子DNA片段内。长度为 $147$ bp的核小体DNA被认为是不可及的。长度为 $L$ bp的连接子DNA被认为是可及的。\n\n让我们考虑一个重复单元。我们可以将连接子DNA片段放在前面，占据位置 $1, 2, \\dots, L$。核小体DNA紧随其后，占据位置 $L+1, \\dots, L+147$。当考虑长纤维时，由于周期性，单元内的具体排列是无关紧要的。\n为了使一个长度为 $m$ 的基序完全位于连接子DNA内，其起始位置 $s$ 和结束位置 $s+m-1$ 都必须在连接子片段的边界内。\n因此，我们必须满足以下条件：\n$$s \\ge 1$$\n$$s+m-1 \\le L$$\n第二个不等式可以重新排列以找到起始位置 $s$ 的上限：\n$$s \\le L - m + 1$$\n因此，一个可及基序的允许起始位置是所有满足 $1 \\le s \\le L-m+1$ 的整数 $s$。\n\n这些整数位置的数量 $N_{\\text{accessible}}$ 由此范围内的整数个数给出：\n$$N_{\\text{accessible}} = (L-m+1) - 1 + 1 = L-m+1$$\n这个公式在 $L-m+1 \\ge 1$ 的条件下有效，可简化为 $L \\ge m$。问题陈述中明确给出了此推导条件。如果 $L < m$，则无法将基序置于连接子中，可及位点的数量将为 $0$。我们的表达式 $L-m+1$ 能正确处理 $L=m-1$ 的边界情况（结果为 $0$），但对于 $L < m-1$ 的情况，它会给出一个非物理的负结果。然而，我们的操作是在 $L \\ge m$ 的约束下进行的。\n\n可及比例 $f(L,m)$ 定义为一个重复单元内可及起始位置的数量与可能起始位置总数的比值。\n$$f(L,m) = \\frac{N_{\\text{accessible}}}{N_{\\text{total}}} = \\frac{L-m+1}{147+L}$$\n这就是在具有连接子长度 $L$ 的晶格上，对于长度为 $m$ 的基序的可及比例的通用表达式，在 $L \\ge m$ 时有效。\n\n2. 比率 $R$ 的计算。\n我们已知以下数值：\n- 基序长度：$m = 10$ bp。\n- 常染色质连接子长度：$L_{\\mathrm{eu}} = 60$ bp。\n- 异染色质连接子长度：$L_{\\mathrm{het}} = 20$ bp。\n$L_{\\mathrm{eu}}$ 和 $L_{\\mathrm{het}}$ 均满足条件 $L \\ge m$。\n\n首先，我们计算常染色质的可及比例 $f(L_{\\mathrm{eu}}, m)$:\n$$f(L_{\\mathrm{eu}}, m) = f(60, 10) = \\frac{60-10+1}{147+60} = \\frac{51}{207}$$\n这个分数可以化简。分子是 $51 = 3 \\times 17$。分母是 $207 = 9 \\times 23$。\n$$f(L_{\\mathrm{eu}}, m) = \\frac{3 \\times 17}{9 \\times 23} = \\frac{17}{3 \\times 23} = \\frac{17}{69}$$\n\n接下来，我们计算异染色质的可及比例 $f(L_{\\mathrm{het}}, m)$:\n$$f(L_{\\mathrm{het}}, m) = f(20, 10) = \\frac{20-10+1}{147+20} = \\frac{11}{167}$$\n数字 $11$ 是质数， $167$ 也是质数。这个分数是不可约分的。\n\n最后，我们计算比率 $R \\equiv \\frac{f(L_{\\mathrm{eu}}, m)}{f(L_{\\mathrm{het}}, m)}$：\n$$R = \\frac{f(60, 10)}{f(20, 10)} = \\frac{51/207}{11/167} = \\frac{51}{207} \\cdot \\frac{167}{11}$$\n使用化简后的 $f(L_{\\mathrm{eu}}, m)$ 分数：\n$$R = \\frac{17}{69} \\cdot \\frac{167}{11} = \\frac{17 \\times 167}{69 \\times 11} = \\frac{2839}{759}$$\n为了以四舍五入到四位有效数字的小数形式提供答案，我们进行除法运算：\n$$R = \\frac{2839}{759} \\approx 3.7404479578...$$\n四舍五入到四位有效数字，得到：\n$$R \\approx 3.740$$\n这一结果量化了如此简单模型所预测的，常染色质中TF结合位点相比于异染色质具有更高的可及性。常染色质中较长的连接子为TF结合不成比例地提供了更多可及DNA。", "answer": "$$\\boxed{3.740}$$", "id": "2944124"}, {"introduction": "虽然简单模型能提供直觉，但在实践中，染色质状态是由组蛋白修饰的复杂组合所定义的。本练习将从简化的模型转向对真实的表观基因组数据的分析，要求你实现一个计算算法，根据多种 ChIP-seq 信号将一个基因组区域分割成不同的状态。你将练习开发一个基于规则的分类器，这模仿了前沿的生物信息学工具，让你亲身体验如何将原始表观基因组数据转化为对常染色质、兼性异染色质和组成性异染色质的生物学上有意义的注释。[@problem_id:2944136]", "problem": "给定四个一维数组，代表在长度为 $200\\,\\mathrm{kb}$ 的单个基因组区域上，四种组蛋白修饰的染色质免疫沉淀后测序 (ChIP-seq) 信号强度。这四种组蛋白标记是：组蛋白H3赖氨酸4三甲基化 (H3K4me3)、组蛋白H3赖氨酸27乙酰化 (H3K27ac)、组蛋白H3赖氨酸9三甲基化 (H3K9me3) 和组蛋白H3赖氨酸27三甲基化 (H3K27me3)。该区域被离散化为 $20$ 个大小相等（各 $10\\,\\mathrm{kb}$）的不重叠区间，每个数组为每个区间包含一个非负实数值，代表该区间的归一化信号汇总值。你的任务是设计并实现一个计算规则，将每个区间分割为三种染色质状态之一：常染色质、组成型异染色质或兼性异染色质。你还必须从第一性原理以及分子和细胞生物学中经过充分检验的事实出发，来论证你的分割逻辑的合理性。\n\n推导的基本依据和约束条件：\n- 常染色质与转录允许和可及的染色质相关，通常富集激活型组蛋白标记，如H3K4me3和H3K27ac。组成型异染色质在各种细胞类型中通常是紧缩的，并富集H3K9me3。兼性异染色质以细胞类型特异性的方式被动态抑制，通常富集H3K27me3。这些关联是表观基因组学中经过充分检验、可重复的观察结果。\n- 每个区间的ChIP-seq信号强度是组蛋白修饰局部丰度的代理指标。\n- 你的规则必须是纯粹算法性的，仅使用所提供的数组、简单统计量和逻辑优先级。它不得需要任何外部数据。\n\n定义以下待实现的分割规则：\n1. 对于每个标记 $m \\in \\{\\mathrm{K4}, \\mathrm{K27ac}, \\mathrm{K9}, \\mathrm{K27me3}\\}$，计算一个区域级的高信号阈值，即该标记在所有 $20$ 个区间上的 $q$-分位数，其中 $q = 0.8$。将此阈值记为 $T_m$。如果标记 $m$ 的一个区间值 $x$ 满足 $x \\ge T_m$，则认为该信号为“高”。\n2. 对于每个区间 $i$，应用以下基于优先级的逻辑：\n   - 如果区间 $i$ 的H3K9me3信号为高，则分配为组成型异染色质。\n   - 否则，如果区间 $i$ 的H3K27me3信号为高，则分配为兼性异染色质。\n   - 否则，如果区间 $i$ 的H3K4me3或H3K27ac信号为高，则分配为常染色质。\n   - 否则，使用 $z$-分数 $z_m(i) = \\dfrac{x_m(i) - \\mu_m}{\\sigma_m}$ 计算每个轨道的标准化分数，其中 $\\mu_m$ 和 $\\sigma_m$ 分别是标记 $m$ 在所有 $20$ 个区间上的均值和标准差（如果 $\\sigma_m = 0$，则定义标准化分数为 $0$）。然后为每个区间定义三个状态证据分数：常染色质为 $A(i) = \\max\\{z_{\\mathrm{K4}}(i), z_{\\mathrm{K27ac}}(i)\\}$，组成型异染色质为 $C(i) = z_{\\mathrm{K9}}(i)$，兼性异染色质为 $F(i) = z_{\\mathrm{K27me3}}(i)$。分配 $\\{A(i), C(i), F(i)\\}$ 中得分最高的状态；如果出现平局，则优先选择常染色质。\n3. 将每个区间的最终状态编码为整数：常染色质 $\\rightarrow 0$，组成型异染色质 $\\rightarrow 1$，兼性异染色质 $\\rightarrow 2$。\n\n实现上述规则，并将其应用于以下三个测试用例。每个测试用例包含四个数组，顺序为H3K4me3、H3K27ac、H3K9me3、H3K27me3。每个数组有 $20$ 个值，对应 $20$ 个区间，所有数值均以任意归一化单位给出：\n\n- 测试用例 1：\n  - H3K4me3: $[\\,5.0,5.0,5.0,5.0,5.0,5.0,5.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0\\,]$\n  - H3K27ac: $[\\,4.5,4.5,4.5,4.5,4.5,4.5,4.5,0.8,0.8,0.8,0.8,0.8,0.8,0.8,0.8,0.8,0.8,0.8,0.8,0.8\\,]$\n  - H3K9me3: $[\\,0.7,0.7,0.7,0.7,0.7,0.7,0.7,5.0,5.0,5.0,5.0,5.0,5.0,0.7,0.7,0.7,0.7,0.7,0.7,0.7\\,]$\n  - H3K27me3: $[\\,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,4.8,4.8,4.8,4.8,4.8,4.8,4.8\\,]$\n\n- 测试用例 2：\n  - H3K4me3: $[\\,1.0,1.0,1.0,1.0,1.0,5.0,5.0,5.0,5.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0\\,]$\n  - H3K27ac: $[\\,5.0,5.0,5.0,5.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,5.0,5.0,5.0,5.0,1.0,1.0,1.0\\,]$\n  - H3K9me3: $[\\,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,5.0,5.0,5.0,5.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0\\,]$\n  - H3K27me3: $[\\,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,5.0,5.0,5.0,5.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0\\,]$\n\n- 测试用例 3：\n  - H3K4me3: $[\\,5.0,5.0,5.0,5.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0\\,]$\n  - H3K27ac: $[\\,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,5.0,5.0,5.0,5.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0\\,]$\n  - H3K9me3: $[\\,1.0,1.0,1.0,1.0,5.0,5.0,5.0,5.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0\\,]$\n  - H3K27me3: $[\\,5.0,5.0,5.0,5.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0\\,]$\n\n你的程序必须实现上述规则，并为每个测试用例输出分割结果，形式为一个包含 $20$ 个整数的列表，使用编码：常染色质 $\\rightarrow 0$，组成型异染色质 $\\rightarrow 1$，兼性异染色质 $\\rightarrow 2$。最终输出格式：生成单行内容，其中包含一个Python风格的列表，该列表包含三个列表，每个列表对应一个测试用例。如果需要，除了逗号外不应有其他多余的空白字符。所需格式样式示例：$[[0,1],[2,2],[0,0]]$。\n\n输出中不需要进行物理单位转换；输出条目是无量纲整数编码。你的解决方案必须是通用的，而不是针对所提供答案进行硬编码的；但是，你必须严格使用上述数组作为测试套件。", "solution": "所提出的问题具有科学依据，定义明确且客观。它提出了一个在计算表观基因组学中常见任务的简化但有效的模型：基于组蛋白修饰数据将基因组分割为离散的染色质状态。所提供的组蛋白标记与染色质状态之间的关联是分子生物学的核心原理。用于分割的规则是算法性的、无歧义的，并且可以确定性地实现。因此，该问题是有效的，我将着手提供一个完整的解决方案。\n\n任务是将 $20$ 个基因组区间（每个大小为 $10\\,\\mathrm{kb}$）分类为三种染色质状态之一：常染色质（状态码 $0$）、组成型异染色质（状态码 $1$）或兼性异染色质（状态码 $2$）。该分类基于四种组蛋白修饰的染色质免疫沉淀测序 (ChIP-seq) 的信号强度：组蛋白H3赖氨酸4三甲基化 (H3K4me3)、组蛋白H3赖氨酸27乙酰化 (H3K27ac)、组蛋白H3赖氨酸9三甲基化 (H3K9me3) 和组蛋白H3赖氨酸27三甲基化 (H3K27me3)。\n\n该分割规则的生物学原理植根于这些组蛋白标记的既定功能。\n- **常染色质**：这是一种转录活跃或允许的状态，其特征是开放的染色质结构。它与激活型标记（如H3K4me3和H3K27ac）的存在密切相关。因此，这些标记的高信号是常染色质的有力证据。\n- **组成型异染色质**：这是一种静态浓缩、基因稀少且转录沉默的状态。其形成和维持严重依赖于H3K9me3。因此，H3K9me3的高信号是该状态的定义性特征。\n- **兼性异染色质**：该状态涉及细胞类型特异性的基因沉默，并在发育过程中受到动态调控。其特征是H3K27me3的存在，该标记由Polycomb抑制复合物2 (PRC2) 沉积。\n\n所提供的分割算法将这些生物学知识形式化为一个计算过程。它采用两层方法：首先是基于高信号阈值的初步分类，然后是对模糊区间使用标准化分数进行二次分类。\n\n**步骤 1：高信号阈值化**\n对于每种组蛋白标记 $m \\in \\{\\text{H3K4me3, H3K27ac, H3K9me3, H3K27me3}\\}$，我们首先建立一个数据驱动的阈值来识别显著富集的区域。该阈值 $T_m$ 定义为该标记在所有 $20$ 个区间上的信号强度的 $q$-分位数，其中 $q = 0.8$。如果一个区间的标记 $m$ 的信号值 $x_m$ 满足 $x_m \\geq T_m$，则认为该信号为“高”。该方法根据给定基因组区域内观察到的信号分布自适应地定义何为高信号。\n\n**步骤 2：基于优先级的状态分配**\n一旦确定了阈值，就根据一套严格的规则层级对区间进行分类，这反映了某些染色质状态的生物学主导性。\n1.  **组成型异染色质（$1$）**：首先检查区间 $i$ 是否具有高的H3K9me3信号。如果 $x_{\\text{K9}}(i) \\geq T_{\\text{K9}}$，它会立即被分配为组成型异染色质。该规则具有最高优先级，反映了这种染色质状态的稳定和主导性质。\n2.  **兼性异染色质（$2$）**：如果一个区间未被分类为组成型异染色质，则接着检查其是否具有高的H3K27me3信号。如果 $x_{\\text{K27me3}}(i) \\geq T_{\\text{K27me3}}$，它被分配为兼性异染色质。\n3.  **常染色质（$0$）**：如果一个区间仍未被分类，则检查其在任一激活型标记中是否具有高信号。如果 $x_{\\text{K4}}(i) \\geq T_{\\text{K4}}$ 或 $x_{\\text{K27ac}}(i) \\geq T_{\\text{K27ac}}$，它被分配为常染色质。\n\n**步骤 3：模糊区间的解析**\n对于任何四种标记都没有表现出“高”信号的区间被认为是模糊的。为了确定它们的状态，我们必须在一个共同的尺度上比较不同标记间的相对信号水平。这是通过为每个区间 $i$ 的每个标记 $m$ 计算一个 $z$-分数来实现的：\n$$\nz_m(i) = \\frac{x_m(i) - \\mu_m}{\\sigma_m}\n$$\n其中 $\\mu_m$ 和 $\\sigma_m$ 分别是标记 $m$ 的信号在所有 $20$ 个区间上的均值和标准差。$z$-分数衡量一个观测值偏离均值的标准差倍数。如果 $\\sigma_m = 0$，则信号是恒定的，我们定义 $z_m(i) = 0$。\n\n然后为每个模糊区间 $i$ 计算每个潜在状态的证据分数：\n- 常染色质证据：$A(i) = \\max\\{z_{\\text{K4}}(i), z_{\\text{K27ac}}(i)\\}$\n- 组成型异染色质证据：$C(i) = z_{\\text{K9}}(i)$\n- 兼性异染色质证据：$F(i) = z_{\\text{K27me3}}(i)$\n\n该区间被分配给证据分数集合 $\\{A(i), C(i), F(i)\\}$ 中得分最高的状态。如问题所规定，如果出现平局，则将状态分配为常染色质（$0$）。\n\n这个全面、基于规则的流程确保了每个区间都被分配一个唯一的、具有生物学动机的染色质状态。以下代码实现了这一逻辑，并将其应用于所提供的测试用例。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the chromatin segmentation problem for the given test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple of 4 lists: H3K4me3, H3K27ac, H3K9me3, H3K27me3\n    test_cases = [\n        (\n            [5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],\n            [4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8],\n            [0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7],\n            [0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 4.8, 4.8, 4.8, 4.8, 4.8, 4.8, 4.8]\n        ),\n        (\n            [1.0, 1.0, 1.0, 1.0, 1.0, 5.0, 5.0, 5.0, 5.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],\n            [5.0, 5.0, 5.0, 5.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 5.0, 5.0, 5.0, 5.0, 1.0, 1.0, 1.0],\n            [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 5.0, 5.0, 5.0, 5.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],\n            [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 5.0, 5.0, 5.0, 5.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]\n        ),\n        (\n            [5.0, 5.0, 5.0, 5.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],\n            [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 5.0, 5.0, 5.0, 5.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],\n            [1.0, 1.0, 1.0, 1.0, 5.0, 5.0, 5.0, 5.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],\n            [5.0, 5.0, 5.0, 5.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]\n        )\n    ]\n    \n    # Encoding: Euchromatin -> 0, Constitutive Het. -> 1, Facultative Het. -> 2\n    EUCHROMATIN = 0\n    CONSTITUTIVE_HETEROCHROMATIN = 1\n    FACULTATIVE_HETEROCHROMATIN = 2\n\n    results = []\n    \n    for case in test_cases:\n        # Convert lists to numpy arrays for vectorized operations\n        h3k4me3, h3k27ac, h3k9me3, h3k27me3 = map(np.array, case)\n        num_bins = len(h3k4me3)\n        \n        # Step 1: Compute high-signal thresholds (q=0.8 quantile)\n        q = 0.8\n        T_k4 = np.quantile(h3k4me3, q)\n        T_k27ac = np.quantile(h3k27ac, q)\n        T_k9 = np.quantile(h3k9me3, q)\n        T_k27me3 = np.quantile(h3k27me3, q)\n\n        # Initialize segmentation array with a placeholder for 'unassigned'\n        segmentation = np.full(num_bins, -1, dtype=int)\n        \n        # Step 2: Apply precedence-based logic\n        # - Highest precedence: Constitutive Heterochromatin (H3K9me3)\n        for i in range(num_bins):\n            if h3k9me3[i] >= T_k9:\n                segmentation[i] = CONSTITUTIVE_HETEROCHROMATIN\n\n        # - Second precedence: Facultative Heterochromatin (H3K27me3)\n        for i in range(num_bins):\n            if segmentation[i] == -1 and h3k27me3[i] >= T_k27me3:\n                segmentation[i] = FACULTATIVE_HETEROCHROMATIN\n\n        # - Third precedence: Euchromatin (H3K4me3 or H3K27ac)\n        for i in range(num_bins):\n            if segmentation[i] == -1 and (h3k4me3[i] >= T_k4 or h3k27ac[i] >= T_k27ac):\n                segmentation[i] = EUCHROMATIN\n\n        # Step 3: Resolve unassigned bins using Z-scores\n        unassigned_indices = np.where(segmentation == -1)[0]\n        if len(unassigned_indices) > 0:\n            # Compute means and standard deviations for all tracks\n            tracks = [h3k4me3, h3k27ac, h3k9me3, h3k27me3]\n            means = [np.mean(track) for track in tracks]\n            stds = [np.std(track) for track in tracks]\n\n            # Function to calculate z-score safely\n            def get_z_score(value, mean, std):\n                if std == 0:\n                    return 0.0\n                return (value - mean) / std\n\n            for i in unassigned_indices:\n                # Calculate Z-scores for the bin `i`\n                z_k4 = get_z_score(h3k4me3[i], means[0], stds[0])\n                z_k27ac = get_z_score(h3k27ac[i], means[1], stds[1])\n                z_k9 = get_z_score(h3k9me3[i], means[2], stds[2])\n                z_k27me3 = get_z_score(h3k27me3[i], means[3], stds[3])\n\n                # Define state evidence scores\n                A_i = max(z_k4, z_k27ac)  # Euchromatin\n                C_i = z_k9                 # Constitutive\n                F_i = z_k27me3             # Facultative\n                \n                scores = [A_i, C_i, F_i]\n                max_score = max(scores)\n                \n                # Assign state based on max score, with tie-break for euchromatin\n                if A_i == max_score:\n                    segmentation[i] = EUCHROMATIN\n                elif C_i == max_score:\n                    segmentation[i] = CONSTITUTIVE_HETEROCHROMATIN\n                else: # F_i must be max_score\n                    segmentation[i] = FACULTATIVE_HETEROCHROMATIN\n        \n        results.append(segmentation.tolist())\n\n    # Final print statement in the exact required format.\n    # The format is a string representation of a list of lists, with no spaces.\n    output_str = str(results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```", "id": "2944136"}, {"introduction": "观察组蛋白标记与染色质状态之间的相关性是第一步，但建立因果关系是分子生物学的最终目标。本练习要求你设计一个现代实验来检验一个特定的因果假设：单独施加抑制性标记 $\\mathrm{H3K9me3}$ 是否足以诱导异染色质状态？你将利用像 CRISPR-dCas9 这样的表观基因组编辑工具的强大功能，制定一个严谨的实验计划，包括必要的对照组，以明确回答这个关于染色质调控的基本问题。[@problem_id:2944203]", "problem": "要求你检验在常染色质区域沉积组蛋白修饰 $\\mathrm{H3K9me3}$，在未经其他任何操作的细胞中，其本身是否足以诱导局部形成类似异染色质的状态。仅从以下基本原则出发：(i) 分子生物学中心法则（DNA转录为RNA，RNA翻译为蛋白质），(ii) 染色质修饰的“读写擦”范式（“写入器”沉积标记，“读取器”结合标记并影响下游结构/功能，“擦除器”移除标记），以及 (iii) 普遍观察到的异染色质特征：核小体密度和紧实度增加、转录输出减少、以及特定“读取器”（如异染色质蛋白1（HP1））在$\\mathrm{H3K9me3}$位点的占据。请选择最佳的实验设计和预期结果模式，以检验在活性基因座上沉积$\\mathrm{H3K9me3}$的充分性。\n\n以下每个选项都提出了：(a) 一种招募策略，(b) 核心对照组，以及 (c) 目标基因座上染色质可及性、转录和“读取器”占据的预期变化。请选择唯一一个其设计和预测结果最直接、最正确地检验了仅沉积$\\mathrm{H3K9me3}$是否足以诱导形成类似异染色质状态的选项。\n\nA. 使用向导RNA靶向启动子和第一个内含子的催化失活的CRISPR相关蛋白9（dCas9），将具有催化活性的黑腹果蝇位置效应花斑抑制因子3-9同源物1（SUV39H1）的SET结构域招募到一个整合在安全港基因座的单拷贝、组成性表达的绿色荧光蛋白报告基因上。使用小分子二聚体急性诱导招募，并通过转座酶可及性染色质测序（ATAC-seq）分析局部变化，通过精确全基因组起始位点测序（PRO-seq）分析新生转录，通过染色质免疫共沉淀测序（ChIP-seq）分析$\\mathrm{H3K9me3}$和HP1的占据情况，以及RNA聚合酶II的占据情况。对照组：以相同方式拴系的催化失活的SUV39H1 SET突变体，无向导RNA的对照组，以及一个同基因的HP1敲除细胞系。预期结果：在活性SUV39H1存在下，目标基因座的$\\mathrm{H3K9me3}$和HP1占据灶性增加，同时该基因座的ATAC-seq可及性下降，新生转录和RNA聚合酶II的占据减少，而非目标基因座没有变化。在催化失活和无向导RNA的对照组中，没有变化。在HP1敲除的细胞系中，$\\mathrm{H3K9me3}$增加，但可及性和转录没有显著降低，这表明虽然沉积的$\\mathrm{H3K9me3}$在有其内源性读取器的情况下足以诱导类似异染色质的状态，但染色质的紧实需要HP1。\n\nB. 使用dCas9将zeste基因增强子同源物2（EZH2）的催化结构域招募到同一个报告基因上。对照组：催化失活的EZH2和无向导RNA。预期结果：目标基因座的$\\mathrm{H3K9me3}$增加，HP1占据增加，ATAC-seq可及性降低，转录减少，对照组无变化。\n\nC. 如A选项所述，将活性的SUV39H1 SET结构域招募到报告基因上，对照组与A选项相同。预期结果：目标基因座$\\mathrm{H3K9me3}$增加，同时由于核小体被驱逐，染色质可及性增加，新生转录增加，HP1占据减少，这表明该标记本身会破坏活性基因上核小体的稳定性。\n\nD. 使用lac阻遏物-操纵子系统，在没有任何“写入器”酶的情况下，单独将HP1招募到报告基因上。对照组：招募一个不结合染色质的HP1突变体和无lac操onyl子。预期结果：通过正反馈招募“写入器”，基因座上的$\\mathrm{H3K9me3}$增加，ATAC-seq可及性降低，转录减少，从而证明招募“读取器”足以安装标记并使染色质紧实。\n\nE. 使用dCas9将赖氨酸去甲基化酶4（KDM4）招募到报告基因上，以移除$\\mathrm{H3K9me3}$。对照组：催化失活的KDM4和无向导RNA。预期结果：$\\mathrm{H3K9me3}$消失，HP1占据消失，可及性增加，转录增加，从而证明当$\\mathrm{H3K9me3}$存在时，它足以起到抑制作用。\n\n哪个选项是最佳的设计和预测组合，能够直接检验在常染色质区域沉积$\\mathrm{H3K9me3}$是否足以诱导形成类似異染色质的状态，同时指定了恰当的对照和检测指标？", "solution": "这个问题要求设计一个实验，以检验在常染色质区域沉积组蛋白$\\mathrm{H3}$赖氨酸$9$三甲基化（$\\mathrm{H3K9me3}$）在诱导形成类似异染色质状态方面的充分性。要检验充分性，必须将所讨论的组分——在本例中是$\\mathrm{H3K9me3}$标记——引入一个最初缺少该组分的系统中，然后观察预期的下游效应是否出现。该系统是一个常染色质，即转录活跃的基因座。要观察的效应是形成类似异染色质的状态，根据问题的定义，其特征是核小体紧实度增加（可及性降低）、转录减少，以及典型的$\\mathrm{H3K9me3}$读取蛋白——异染色质蛋白1（HP1）的招募。\n\n因此，一个严谨的检验充分性的实验设计必须具备以下几个部分：\n$1$。 一种在选定的活性基因上特异性沉积$\\mathrm{H3K9me3}$的方法。这需要将$\\mathrm{H3K9me3}$特异性组蛋白甲基转移酶（一种“写入器”）的催化结构域靶向到该基因座。组成型异染色质$\\mathrm{H3K9me3}$的典型“写入器”是位置效应花斑抑制因子3-9同源物1（SUV39H1）。一个可编程的DNA结合平台，例如催化失活的CRISPR相关蛋白9（dCas9），是实现此类靶向的最先进工具。\n$2$。 一套定量的检测指标，用于测量原因和结果。为确认“写入器”的作用，必须进行针对$\\mathrm{H3K9me3}$的染色质免疫共沉淀测序（ChIP-seq）。为测量下游效应，必须检测HP1的招募（例如，HP1 ChIP-seq）、染色质可及性的变化（例如，转座酶可及性染色质测序，即ATAC-seq），以及转录的变化（例如，用精确全基因组起始位点测序，即PRO-seq，进行新生转录分析，以及通过ChIP-seq检测RNA聚合酶II的占据情况）。\n$3$。 一套严格的对照组，以将“写入器”催化活性的效应与其他潜在的假象分离开。一个关键的对照是将“写入器”酶的催化失活版本招募到同一基因座。这能区分酶活性（即组蛋白甲基化）的效应与仅仅将一个大蛋白复合物拴系在DNA上所产生的效应。另一个必要的对照是非靶向条件（例如，无向导RNA），以确保观察到的效应是基因座特异性的。\n\n现在我们根据这些原则来评估每个选项。\n\nA. 该选项提议使用dCas9将一个具有催化活性的SUV39H1 SET结构域招募到一个活性报告基因上。这正确地指明了“写入器”（SUV39H1）和靶向系统（dCas9）。所选择的检测指标（用于可及性的ATAC-seq、用于转录的PRO-seq、用于$\\mathrm{H3K9me3}$，HP1和RNA聚合酶II的ChIP-seq）是全面且适于测量预期效应的。提议的对照组异常严谨：（$1$）一个催化失活的SUV39H1突变体，用以控制蛋白质拴系带来的效应；（$2$）一个无向导RNA的对照，用以控制靶向特异性；以及（$3$）一个同基因的HP1敲除细胞系，用以剖析下游机制。预期的结果在生物学上是合理的：$\\mathrm{H3K9me3}$的灶性沉积导致HP1的招募、染色质紧实（ATAC-seq信号降低）和转录抑制（PRO-seq和RNA聚合酶II占据率降低）。在HP1敲除细胞系中的预测结果——即$\\mathrm{H3K9me3}$被沉积，但染色质紧实和转录抑制作用减弱——正确地分离出了“读取器”HP1作为该标记下游结构效应关键介导者的角色。这构成了一个直接、控制良好且具有机制洞察力的充分性检验。其结论，即$\\mathrm{H3K9me3}$在其“读取器”存在的情况下足以诱导形成类似异染色质的状态，是对这类数据的精确解读。\n**结论：正确。**\n\nB. 该选项提议招募zeste基因增强子同源物2（EZH2）的催化结构域。这是一个根本性的科学错误。EZH2是负责沉积抑制性标记$\\mathrm{H3K27me3}$的组蛋白甲基转移酶，而不是$\\mathrm{H3K9me3}$。$\\mathrm{H3K27me3}$标记与兼性异染色质和Polycomb介导的抑制相关，这涉及到一套与$\\mathrm{H3K9me3}$/HP1介导的组成型异染色质不同的“读取器”和机制。因此，该实验并未检验关于$\\mathrm{H3K9me3}$的假说。其预测的$\\mathrm{H3K9me3}$增加和HP1占据增加的结果也是不正确的。\n**结论：错误。**\n\nC. 该选项正确地提议招募SUV39H1的SET结构域。然而，它预测了生物学上不合理的结果：染色质可及性增加和新生转录增加。这些效应与异染色质形成的定义完全相反。问题的基本前提是，异染色质的特征是紧实和转录减少。一个预测结果与其旨在产生的基本现象相矛盾的实验设计，在逻辑和科学上都是有缺陷的。\n**结论：错误。**\n\nD. 该选项提议直接招募“读取器”蛋白HP1，而不是“写入器”酶。问题是要检验*标记沉积*（$\\mathrm{H3K9me3}$的安装）的充分性。而这个实验检验的是*“读取器”*（HP1）诱导异染色质状态的充分性。尽管拴系HP1确实可以通过正反馈回路导致“写入器”的招募和异染色质的形成，但这只是对主要假说的一个间接检验。实验中的初始致因是“读取器”，而不是标记。对标记充分性的直接检验要求标记是主要的实验扰动。\n**结论：错误。**\n\nE. 该选项提议招募一个赖氨酸去甲基化酶KDM4来*移除*$\\mathrm{H3K9me3}$。一个通过移除某个组分来观察特定状态是否消失的实验，是检验*必要性*，而非*充分性*。要检验充分性，必须将该组分添加到一个缺少它的系统中。这个实验被正确地设计用于检验$\\mathrm{H3K9me3}$对于维持一个已存的异染色质状态是否是必要的，但它没有解决其沉积是否足以在一个常染色质区域*从头*建立这种状态的问题。问题的框架明确是关于充分性的。\n**结论：错误。**\n\n综上所述，选项A提供了唯一一个科学上合理、直接解决了充分性问题、包含一套完整而严谨的对照组、并提出了一套生物学上正确且具有机制洞察力的预期结果的实验设计。", "answer": "$$\\boxed{A}$$", "id": "2944203"}]}