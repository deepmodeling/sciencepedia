{"hands_on_practices": [{"introduction": "在免疫学研究中，直接测量特定细胞群（如幼稚B细胞）在体内的生成速率极具挑战性。本练习将指导您利用一种巧妙的生物标记——KREC（Kappa-deleting Recombination Excision Circles），通过构建一个基于基本原理的动力学模型，将可测量的生物指标与我们真正关心的细胞生成速率联系起来。通过这个实践，您将掌握如何运用稳态分析和守恒定律来解决复杂的生物学定量问题。[@problem_id:2852642]", "problem": "您正在分析κ-删除重组切除环 (Kappa-deleting Recombination Excision Circles, KREC)，这是一种在发育中的B细胞进行免疫球蛋白轻链受体编辑过程中产生的附加体DNA副产物。KREC在细胞分裂时不被复制，并且在所考虑的时间范围内被假定为稳定维持而不降解。在一个处于稳态的、充分混合的初始B细胞区室中，骨髓新生成的初始B细胞以恒定速率进入该区室，区室内的细胞会分裂并且会丢失（通过死亡或移出）。设 $N(t)$ 为初始B细胞的总数，而 $K(t)$ 为该区室内KREC的总数。假设：\n- 每个新生成的初始B细胞在进入时平均携带 $k_0$ 个KREC（例如，如果有比例为 $f$ 的进入细胞恰好携带一个KREC，则 $k_0 = f$）。\n- KREC在细胞分裂过程中不复制，并平均分配到子细胞中，因此在分裂过程中总数 $K(t)$ 是守恒的。\n- 细胞分裂以人均速率 $r$ （单位：$\\text{day}^{-1}$）发生，细胞丢失以人均速率 $d$ （单位：$\\text{day}^{-1}$）发生。\n- 该区室处于稳态。\n\n定义每个初始B细胞的稳态平均KREC含量为 $C = K/N$。仅使用这些假设和守恒定律，从第一性原理推导骨髓输出（初始B细胞的稳态生成速率）的表达式，记为 $S$（单位：细胞/天），并用 $r$、$N$、$k_0$ 和 $C$ 表示。\n\n您获得了两个队列的测量值：\n\n年轻队列：\n- 初始B细胞池总大小：$N_{\\text{y}} = 2.0 \\times 10^{9}$ 个细胞。\n- 人均分裂速率：$r_{\\text{y}} = 0.004 \\ \\text{day}^{-1}$。\n- 每个细胞的平均KREC数：$C_{\\text{y}} = 0.12$ 个环/细胞。\n\n年老队列：\n- 初始B细胞池总大小：$N_{\\text{a}} = 1.2 \\times 10^{9}$ 个细胞。\n- 人均分裂速率：$r_{\\text{a}} = 0.002 \\ \\text{day}^{-1}$。\n- 每个细胞的平均KREC数：$C_{\\text{a}} = 0.05$ 个环/细胞。\n\n假设每个新生成的初始B细胞的平均KREC含量在不同队列中是不变的，等于 $k_0 = 0.40$ 个环/新生成初始B细胞。使用您推导的表达式，计算年轻队列和年老队列之间骨髓输出的比率 $S_{\\text{y}} / S_{\\text{a}}$。提供一个精确值（不进行四舍五入）。最终答案应为没有单位的纯数。", "solution": "该问题已经过严格验证，并被认为是有效的，因为它具有科学依据、问题设定良好、客观且内部一致。我们将进行推导和求解。\n\n该问题要求推导初始B细胞的稳态生成速率 $S$ 的表达式，并随后计算两个队列中该速率的比率。我们首先建立区室内初始B细胞总数 $N(t)$ 和κ-删除重组切除环 (KREC) 总数 $K(t)$ 的守恒方程。\n\n设 $N(t)$ 为时刻 $t$ 的初始B细胞总数， $K(t)$ 为KREC总数。该系统的动力学由以下过程决定：\n$1$. 来源：新的初始B细胞以恒定速率 $S$ 从骨髓进入区室。每个新细胞平均引入 $k_0$ 个KREC。\n$2$. 分裂：细胞以人均速率 $r$ 进行分裂。这会增加细胞数量，但KREC的总数保持不变，因为它们不被复制。\n$3$. 丢失：细胞以人均速率 $d$ 从区室中丢失（由于死亡或移出）。这同时移除了细胞及其所含的KREC。\n\n初始B细胞总数的变化率 $\\frac{dN}{dt}$ 由生成、分裂和丢失的平衡给出：\n$$\n\\frac{dN}{dt} = S + rN - dN\n$$\n第一项 $S$ 是来自骨髓的流入。第二项 $rN$ 是通过分裂产生的细胞生成速率。第三项 $-dN$ 是细胞丢失速率。\n\nKREC总数的变化率 $\\frac{dK}{dt}$ 由下式描述：\n$$\n\\frac{dK}{dt} = S k_0 - dK\n$$\n第一项 $S k_0$ 代表由来自骨髓的新细胞携带的KREC流入。第二项 $-dK$ 代表从区室中丢失的KREC。细胞的丢失速率是 $dN$。每个细胞的平均KREC数量为 $C = K/N$。因此，KREC的丢失速率是 $d \\cdot N \\cdot (K/N) = dK$。如问题所述，细胞分裂保持KREC总数守恒，因此它对该方程没有贡献项。\n\n问题指明系统处于稳态。这意味着 $N$ 和 $K$ 的净变化率都为零：\n$$\n\\frac{dN}{dt} = 0 \\quad \\text{和} \\quad \\frac{dK}{dt} = 0\n$$\n将此条件应用于我们的方程组，得到两个代数方程：\n$$\nS + rN - dN = 0 \\quad \\implies \\quad S = (d - r)N \\quad (1)\n$$\n$$\nS k_0 - dK = 0 \\quad \\implies \\quad S k_0 = dK \\quad (2)\n$$\n在这里，$N$ 和 $K$ 代表它们的稳态值。我们的目标是找到以 $r$、$N$、$k_0$ 和稳态平均KREC含量 $C = K/N$ 表示的 $S$ 的表达式。为此，我们必须消去未知的丢失速率 $d$。\n\n从方程 $(2)$，我们可以将 $d$ 表示为：\n$$\nd = \\frac{S k_0}{K}\n$$\n问题将每个细胞的平均KREC含量定义为 $C = K/N$。因此我们可以写成 $K = CN$。将此代入 $d$ 的表达式中：\n$$\nd = \\frac{S k_0}{CN}\n$$\n现在，将这个 $d$ 的表达式代入方程 $(1)$：\n$$\nS = \\left(\\frac{S k_0}{CN} - r\\right)N\n$$\n我们继续求解此方程以得到 $S$。将右侧的 $N$ 分配进去得到：\n$$\nS = \\frac{S k_0 N}{CN} - rN\n$$\n$$\nS = S \\frac{k_0}{C} - rN\n$$\n为了分离出 $S$，我们将所有包含 $S$ 的项移到方程的一边：\n$$\nrN = S \\frac{k_0}{C} - S\n$$\n提取公因式 $S$：\n$$\nrN = S \\left(\\frac{k_0}{C} - 1\\right)\n$$\n$$\nrN = S \\left(\\frac{k_0 - C}{C}\\right)\n$$\n最后，求解 $S$ 得到所需的骨髓输出表达式：\n$$\nS = rN \\frac{C}{k_0 - C}\n$$\n该公式用可测量的量 $r$、$N$、$C$以及给定的参数 $k_0$ 来表示稳态生成速率 $S$。对于一个有物理意义的正生成速率 $S > 0$，并且鉴于 $r, N, C$ 均为正值，要求 $k_0 - C > 0$，即 $k_0 > C$。问题中描述的两个队列都满足此条件（$k_0 = 0.40$ 大于 $C_{\\text{y}} = 0.12$ 和 $C_{\\text{a}} = 0.05$）。\n\n我们的任务是计算年轻队列和年老队列之间骨髓输出的比率 $S_{\\text{y}} / S_{\\text{a}}$。对每个队列使用推导出的公式：\n$$\nS_{\\text{y}} = r_{\\text{y}} N_{\\text{y}} \\frac{C_{\\text{y}}}{k_0 - C_{\\text{y}}}\n$$\n$$\nS_{\\text{a}} = r_{\\text{a}} N_{\\text{a}} \\frac{C_{\\text{a}}}{k_0 - C_{\\text{a}}}\n$$\n因此，比率为：\n$$\n\\frac{S_{\\text{y}}}{S_{\\text{a}}} = \\frac{r_{\\text{y}} N_{\\text{y}} \\frac{C_{\\text{y}}}{k_0 - C_{\\text{y}}}}{r_{\\text{a}} N_{\\text{a}} \\frac{C_{\\text{a}}}{k_0 - C_{\\text{a}}}} = \\left(\\frac{r_{\\text{y}} N_{\\text{y}}}{r_{\\text{a}} N_{\\text{a}}}\\right) \\left(\\frac{C_{\\text{y}}}{C_{\\text{a}}}\\right) \\left(\\frac{k_0 - C_{\\text{a}}}{k_0 - C_{\\text{y}}}\\right)\n$$\n我们现在代入所提供的数值：\n对于年轻队列：$N_{\\text{y}} = 2.0 \\times 10^{9}$，$r_{\\text{y}} = 0.004 \\ \\text{day}^{-1}$，$C_{\\text{y}} = 0.12$。\n对于年老队列：$N_{\\text{a}} = 1.2 \\times 10^{9}$，$r_{\\text{a}} = 0.002 \\ \\text{day}^{-1}$，$C_{\\text{a}} = 0.05$。\n不变的参数是 $k_0 = 0.40$。\n\n我们来计算比率的每个组成部分：\n$$\n\\frac{r_{\\text{y}} N_{\\text{y}}}{r_{\\text{a}} N_{\\text{a}}} = \\frac{(0.004) \\cdot (2.0 \\times 10^{9})}{(0.002) \\cdot (1.2 \\times 10^{9})} = \\frac{0.008}{0.0024} = \\frac{80}{24} = \\frac{10}{3}\n$$\n$$\n\\frac{C_{\\text{y}}}{C_{\\text{a}}} = \\frac{0.12}{0.05} = \\frac{12}{5}\n$$\n$$\n\\frac{k_0 - C_{\\text{a}}}{k_0 - C_{\\text{y}}} = \\frac{0.40 - 0.05}{0.40 - 0.12} = \\frac{0.35}{0.28} = \\frac{35}{28} = \\frac{5}{4}\n$$\n将这些组成部分相乘，得到最终的比率：\n$$\n\\frac{S_{\\text{y}}}{S_{\\text{a}}} = \\left(\\frac{10}{3}\\right) \\left(\\frac{12}{5}\\right) \\left(\\frac{5}{4}\\right)\n$$\n这些项可以被简化：\n$$\n\\frac{S_{\\text{y}}}{S_{\\text{a}}} = \\frac{10 \\cdot 12 \\cdot 5}{3 \\cdot 5 \\cdot 4} = \\frac{10 \\cdot (3 \\cdot 4) \\cdot 5}{3 \\cdot 5 \\cdot 4}\n$$\n从分子和分母中约去公因数 $3$、$4$ 和 $5$，我们得到：\n$$\n\\frac{S_{\\text{y}}}{S_{\\text{a}}} = 10\n$$\n年轻队列和年老队列之间骨髓输出的比率恰好为 $10$。", "answer": "$$\n\\boxed{10}\n$$", "id": "2852642"}, {"introduction": "造血干细胞（HSCs）是整个造血系统的源头，但它们在骨髓中极为罕见，这使得直接计数变得不切实际。本练习将向您介绍一种经典的定量方法——有限稀释分析（limiting dilution analysis），它结合了巧妙的实验设计和严谨的统计推断。您将学习如何应用泊松（Poisson）单次命中模型，通过最大似然估计（Maximum Likelihood Estimation）来精确估算这些稀有但至关重要的细胞的频率，这是干细胞生物学和免疫学中的一项基本技能。[@problem_id:2852659]", "problem": "一个造血干细胞移植实验室进行了一项极限稀释实验，以估计长期造血干细胞（LT-HSCs）的频率。在单击模型下，当且仅当受体接收到至少一个 LT-HSC 时，植入才会成功。假设 LT-HSCs 是稀有的，并在供体细胞中独立分布，因此大小为 $c$ 的接种物中 LT-HSCs 的数量服从均值为 $\\lambda c$ 的泊松分布，其中 $\\lambda$ 是 LT-HSC 的频率，单位为 $\\text{cells}^{-1}$。因此，对于给定的剂量 $c$，受体中未发生植入的概率是 $\\exp(-\\lambda c)$。\n\n在一项实验中，受体在四个不同的供体细胞剂量下进行移植，每个剂量组有 $n_i = 10$ 只小鼠。剂量及对应的未植入受体数量（$x_i$）如下：\n- $c_1 = 2.231435513 \\times 10^{4}$，其中 $x_1 = 8$，\n- $c_2 = 5.108256238 \\times 10^{4}$，其中 $x_2 = 6$，\n- $c_3 = 9.162907319 \\times 10^{4}$，其中 $x_3 = 4$，\n- $c_4 = 1.609437912 \\times 10^{5}$，其中 $x_4 = 2$。\n\n从独立性假设和罕见事件的泊松定律出发，将每个剂量组视为独立的伯努利试验，其剂量特异性的未植入概率为 $\\exp(-\\lambda c_i)$，通过编写并最大化跨剂量的联合对数似然函数，推导出 $\\lambda$ 的最大似然估计。然后，使用观测到的费雪信息（在最大似然估计处求值的对数似然函数的负二阶导数），通过沃尔德近似法为 $\\lambda$ 构建一个近似的 $95\\%$ 置信区间。\n\n按顺序报告最终结果的三个量：点估计值 $\\hat{\\lambda}$、置信下限和置信上限。所有三个答案均以 $\\text{cells}^{-1}$ 为单位表示，并四舍五入至四位有效数字。最终答案中不提供任何中间值。", "solution": "该问题要求使用最大似然方法估计造血干细胞频率 $\\lambda$，并为该估计构建一个置信区间。\n\n首先，必须构建观测数据的似然函数。对于每个剂量组 $i$（其中 $i \\in \\{1, 2, 3, 4\\}$），我们有 $n_i$ 个受体。每个受体代表一次独立的伯努利试验。结果是二元的：植入成功或不成功。我们已知在 $n_i$ 个受体中有 $x_i$ 个未植入。根据单击泊松模型，给定剂量 $c_i$ 的未植入概率为 $p_i = \\exp(-\\lambda c_i)$。因此，植入概率为 $1 - p_i = 1 - \\exp(-\\lambda c_i)$。\n\n在一组 $n_i$ 只小鼠中，未植入的小鼠数量 $x_i$ 服从二项分布，其概率质量函数为：\n$$ L_i(\\lambda) = \\binom{n_i}{x_i} p_i^{x_i} (1-p_i)^{n_i-x_i} = \\binom{n_i}{x_i} [\\exp(-\\lambda c_i)]^{x_i} [1 - \\exp(-\\lambda c_i)]^{n_i-x_i} $$\n由于四个剂量组是独立的，总似然函数 $L(\\lambda)$ 是各个似然函数的乘积：\n$$ L(\\lambda) = \\prod_{i=1}^{4} L_i(\\lambda) = \\prod_{i=1}^{4} \\binom{n_i}{x_i} \\exp(-\\lambda c_i x_i) [1 - \\exp(-\\lambda c_i)]^{n_i-x_i} $$\n为了找到 $\\lambda$ 的最大似然估计（MLE），最大化对数似然函数 $\\ell(\\lambda) = \\ln(L(\\lambda))$ 更为方便：\n$$ \\ell(\\lambda) = \\sum_{i=1}^{4} \\left[ \\ln\\binom{n_i}{x_i} - \\lambda c_i x_i + (n_i - x_i) \\ln(1 - \\exp(-\\lambda c_i)) \\right] $$\n通过将对数似然函数关于 $\\lambda$ 的一阶导数（得分函数）设为零，可以求得 MLE $\\hat{\\lambda}$。\n$$ \\frac{d\\ell}{d\\lambda} = \\sum_{i=1}^{4} \\left[ -c_i x_i + (n_i - x_i) \\frac{d}{d\\lambda}\\ln(1 - \\exp(-\\lambda c_i)) \\right] $$\n$$ \\frac{d\\ell}{d\\lambda} = \\sum_{i=1}^{4} \\left[ -c_i x_i + (n_i - x_i) \\frac{c_i \\exp(-\\lambda c_i)}{1 - \\exp(-\\lambda c_i)} \\right] $$\n令 $\\frac{d\\ell}{d\\lambda} = 0$：\n$$ \\sum_{i=1}^{4} c_i \\left[ -x_i + \\frac{(n_i - x_i) \\exp(-\\lambda c_i)}{1 - \\exp(-\\lambda c_i)} \\right] = 0 $$\n该方程可以重新整理为：\n$$ \\sum_{i=1}^{4} c_i \\frac{-x_i(1 - \\exp(-\\lambda c_i)) + (n_i - x_i) \\exp(-\\lambda c_i)}{1 - \\exp(-\\lambda c_i)} = \\sum_{i=1}^{4} c_i \\frac{n_i \\exp(-\\lambda c_i) - x_i}{1 - \\exp(-\\lambda c_i)} = 0 $$\n虽然这个方程通常需要数值求解，但所提供的数据揭示了一个特殊的结构。观察到的未植入小鼠比例为 $x_1/n_1 = 8/10 = 0.8$, $x_2/n_2 = 6/10 = 0.6$, $x_3/n_3 = 4/10 = 0.4$, 和 $x_4/n_4 = 2/10 = 0.2$。我们来检验是否存在一个估计值 $\\hat{\\lambda}$，使得模型概率 $\\exp(-\\hat{\\lambda} c_i)$与这些观测比例相匹配。当 $\\hat{\\lambda} = 1 \\times 10^{-5} \\, \\text{cells}^{-1}$ 时，此条件成立，因为：\n- $\\hat{\\lambda} c_1 = (10^{-5}) (2.231435513 \\times 10^4) = 0.2231435513 \\approx \\ln(1.25)$，因此 $\\exp(-\\hat{\\lambda} c_1) \\approx 1/1.25 = 0.8$。\n- $\\hat{\\lambda} c_2 = (10^{-5}) (5.108256238 \\times 10^4) = 0.5108256238 \\approx \\ln(5/3)$，因此 $\\exp(-\\hat{\\lambda} c_2) \\approx 3/5 = 0.6$。\n- $\\hat{\\lambda} c_3 = (10^{-5}) (9.162907319 \\times 10^4) = 0.9162907319 \\approx \\ln(2.5)$，因此 $\\exp(-\\hat{\\lambda} c_3) \\approx 1/2.5 = 0.4$。\n- $\\hat{\\lambda} c_4 = (10^{-5}) (1.609437912 \\times 10^5) = 1.609437912 \\approx \\ln(5)$，因此 $\\exp(-\\hat{\\lambda} c_4) \\approx 1/5 = 0.2$。\n对于这个 $\\lambda$ 值，项 $n_i \\exp(-\\lambda c_i) - x_i$ 对于所有 $i$ 都变为 $n_i(x_i/n_i) - x_i = x_i - x_i = 0$。因此，得分方程求和中的每一项都为零，方程成立。因此，最大似然估计为 $\\hat{\\lambda} = 1 \\times 10^{-5} \\, \\text{cells}^{-1}$。\n\n接下来，我们使用沃尔德近似构建一个 $95\\%$ 的置信区间：$\\hat{\\lambda} \\pm z_{0.025} \\sqrt{\\widehat{\\text{Var}}(\\hat{\\lambda})}$。MLE 的方差通过观测到的费雪信息 $J(\\hat{\\lambda})$ 的倒数来近似，费雪信息是对数似然函数在 $\\hat{\\lambda}$ 处求值的负二阶导数。\n$$ J(\\lambda) = -\\frac{d^2\\ell}{d\\lambda^2} $$\n我们来计算二阶导数：\n$$ \\frac{d^2\\ell}{d\\lambda^2} = \\frac{d}{d\\lambda} \\sum_{i=1}^{4} (n_i-x_i) c_i \\frac{\\exp(-\\lambda c_i)}{1 - \\exp(-\\lambda c_i)} $$\n令 $u_i = \\exp(-\\lambda c_i)$。$\\frac{u_i}{1-u_i}$ 关于 $\\lambda$ 的导数是 $\\frac{d}{d\\lambda} \\left(\\frac{u_i}{1-u_i}\\right) = \\frac{-c_i u_i}{(1-u_i)^2} = \\frac{-c_i \\exp(-\\lambda c_i)}{(1 - \\exp(-\\lambda c_i))^2}$。\n$$ \\frac{d^2\\ell}{d\\lambda^2} = \\sum_{i=1}^{4} (n_i - x_i) c_i \\left(\\frac{-c_i \\exp(-\\lambda c_i)}{(1 - \\exp(-\\lambda c_i))^2}\\right) = - \\sum_{i=1}^{4} \\frac{(n_i - x_i) c_i^2 \\exp(-\\lambda c_i)}{(1 - \\exp(-\\lambda c_i))^2} $$\n观测到的费雪信息是：\n$$ J(\\lambda) = \\sum_{i=1}^{4} \\frac{(n_i - x_i) c_i^2 \\exp(-\\lambda c_i)}{(1 - \\exp(-\\lambda c_i))^2} $$\n我们在 $\\hat{\\lambda} = 10^{-5}$ 处对此进行求值。在此值下，$x_i = n_i \\exp(-\\hat{\\lambda} c_i)$，所以 $n_i - x_i = n_i(1 - \\exp(-\\hat{\\lambda} c_i))$。将此代入 $J(\\hat{\\lambda})$ 的表达式中得到：\n$$ J(\\hat{\\lambda}) = \\sum_{i=1}^{4} \\frac{n_i(1 - \\exp(-\\hat{\\lambda} c_i)) c_i^2 \\exp(-\\hat{\\lambda} c_i)}{(1 - \\exp(-\\hat{\\lambda} c_i))^2} = \\sum_{i=1}^{4} \\frac{n_i c_i^2 \\exp(-\\hat{\\lambda} c_i)}{1 - \\exp(-\\hat{\\lambda} c_i)} $$\n使用 $n_i=10$, $\\hat{\\lambda} = 10^{-5}$，以及先前计算的 $c_i$ 和 $\\exp(-\\hat{\\lambda} c_i)$ 的值：\n$J(\\hat{\\lambda}) = 10 \\left[ \\frac{c_1^2 (0.8)}{0.2} + \\frac{c_2^2 (0.6)}{0.4} + \\frac{c_3^2 (0.4)}{0.6} + \\frac{c_4^2 (0.2)}{0.8} \\right] = 10 \\left[ 4 c_1^2 + 1.5 c_2^2 + \\frac{2}{3} c_3^2 + 0.25 c_4^2 \\right]$\n使用 $c_i$ 的精确值和给定的系数：\n$c_1^2 \\approx 4.9791 \\times 10^8$\n$c_2^2 \\approx 2.6094 \\times 10^9$\n$c_3^2 \\approx 8.3959 \\times 10^9$\n$c_4^2 \\approx 2.5903 \\times 10^{10}$\n$J(\\hat{\\lambda}) \\approx 10 \\left[ 4(4.9791\\mathrm{e}8) + 1.5(2.6094\\mathrm{e}9) + (2/3)(8.3959\\mathrm{e}9) + 0.25(2.5903\\mathrm{e}10) \\right]$\n$J(\\hat{\\lambda}) \\approx 10 \\left[ 1.9916\\mathrm{e}9 + 3.9141\\mathrm{e}9 + 5.5973\\mathrm{e}9 + 6.4758\\mathrm{e}9 \\right] = 10 [1.79788\\mathrm{e}10] \\approx 1.79788 \\times 10^{11}$\n$\\hat{\\lambda}$ 的估计方差为 $\\widehat{\\text{Var}}(\\hat{\\lambda}) = J(\\hat{\\lambda})^{-1} \\approx (1.79788 \\times 10^{11})^{-1} \\approx 5.56209 \\times 10^{-12}$。\n标准误为 $\\text{SE}(\\hat{\\lambda}) = \\sqrt{\\widehat{\\text{Var}}(\\hat{\\lambda})} \\approx \\sqrt{5.56209 \\times 10^{-12}} \\approx 2.35841 \\times 10^{-6}$。\n对于 $95\\%$ 的置信区间，$z_{0.025} \\approx 1.959964$。误差范围为 $ME = z_{0.025} \\times \\text{SE}(\\hat{\\lambda}) \\approx 1.959964 \\times 2.35841 \\times 10^{-6} \\approx 4.62239 \\times 10^{-6}$。\n置信区间为 $\\hat{\\lambda} \\pm ME$：\n下限：$1 \\times 10^{-5} - 4.62239 \\times 10^{-6} = 10 \\times 10^{-6} - 4.62239 \\times 10^{-6} = 5.37761 \\times 10^{-6}$。\n上限：$1 \\times 10^{-5} + 4.62239 \\times 10^{-6} = 10 \\times 10^{-6} + 4.62239 \\times 10^{-6} = 14.62239 \\times 10^{-6} = 1.462239 \\times 10^{-5}$。\n\n将结果四舍五入至四位有效数字：\n- 点估计 $\\hat{\\lambda} = 1.000 \\times 10^{-5}$。\n- 置信下限 = $5.378 \\times 10^{-6}$。\n- 置信上限 = $1.462 \\times 10^{-5}$。", "answer": "$$ \\boxed{ \\begin{pmatrix} 1.000 \\times 10^{-5} & 5.378 \\times 10^{-6} & 1.462 \\times 10^{-5} \\end{pmatrix} } $$", "id": "2852659"}, {"introduction": "从群体平均水平的估计，我们进一步深入到单细胞分辨率的精细世界。造血过程是一个连续的动态分化过程，我们如何从静态的单细胞测序快照中推断出细胞分化的方向和路径？本练习将引导您通过编程实现RNA速度（RNA velocity）的核心逻辑，这是一种前沿的计算生物学方法。您将亲手构建一个描述造血谱系从HSC到GMP的马尔可夫（Markov）转移模型，并学习如何利用独立的谱系追踪数据来验证模型的准确性，从而获得处理和解读现代单细胞组学数据的宝贵经验。[@problem_id:2852618]", "problem": "您将处理一个概念化的单细胞核糖核酸测序（scRNA-seq）情境，该情境专注于造血过程（hematopoiesis）。其中，每个细胞的状态被嵌入到一个低维空间中，并且一个RNA速度向量近似了细胞状态的瞬时时间导数。其生物学背景是经典的髓系轨迹，从造血干细胞（Hematopoietic Stem Cell, HSC）经由中间祖细胞，最终到达粒细胞-巨噬细胞祖细胞（Granulocyte–Macrophage Progenitor, GMP）。您的任务是：形式化并实现一个算法，以利用簇之间速度对齐的转换来推断从HSC到GMP的方向性流，并使用独立的谱系条形码（lineage barcoding）轨迹来验证推断出的转换。\n\n基本基础（待使用的定义与事实）：\n- 造血层级包含可表示为簇的祖细胞类别；经典的髓系进程在到达GMP之前，会从HSC发展到下游祖细胞。\n- RNA速度近似于基因表达状态的瞬时时间导数，并可在连续嵌入中建模为向量场；向量投影可量化速度向量和位移向量之间的对齐程度。\n- 对于向量$\\mathbf{a}$和$\\mathbf{b}$，余弦相似度为$\\cos(\\theta) = \\dfrac{\\mathbf{a} \\cdot \\mathbf{b}}{\\|\\mathbf{a}\\|\\,\\|\\mathbf{b}\\|}$，其中$\\cdot$是点积，$\\|\\cdot\\|$是欧几里得范数。\n- 行随机马尔可夫转移矩阵（row-stochastic Markov transition matrix）的每行条目均为非负数且总和为$1$，多步转移概率通过该矩阵的整数次幂获得。\n\n问题要求：\n1) 您将把簇视为按$\\{\\mathrm{HSC}, \\mathrm{MPP}, \\mathrm{CMP}, \\mathrm{GMP}\\}$这个固定顺序排列。对于每个测试用例，您将获得：\n   - 每个簇中单个细胞的一组二维坐标。\n   - 这些细胞相应的一组二维RNA速度向量。\n   - 一个独立的、在相同簇之间的谱系条形码转移矩阵，该矩阵是行随机的，且按上述顺序排列。\n2) 设$\\mathbf{c}_k$表示簇$k$的质心，计算为其细胞坐标的算术平均值。对于源簇$s$中的细胞$i$，其位置为$\\mathbf{x}_i$，速度为$\\mathbf{v}_i$，定义到簇$t$的位移为$\\mathbf{d}_{i,t} = \\mathbf{c}_t - \\mathbf{x}_i$。定义对齐分数$a_{i,t}$如下：\n   - 如果$\\|\\mathbf{v}_i\\| = 0$或$\\|\\mathbf{d}_{i,t}\\| = 0$，则设$a_{i,t} = 0$。\n   - 否则，设$a_{i,t} = \\max\\{0, \\cos(\\theta_{i,t})\\}$，其中$\\cos(\\theta_{i,t}) = \\dfrac{\\mathbf{v}_i \\cdot \\mathbf{d}_{i,t}}{\\|\\mathbf{v}_i\\|\\,\\|\\mathbf{d}_{i,t}\\|}$。\n   对于每个细胞$i$，通过以下方式定义其到所有目标$t \\in \\{\\mathrm{HSC}, \\mathrm{MPP}, \\mathrm{CMP}, \\mathrm{GMP}\\}$的单细胞转移概率$p_{i,t}$：\n   - 如果$\\sum_t a_{i,t} > 0$，则$p_{i,t} = \\dfrac{a_{i,t}}{\\sum_{u} a_{i,u}}$。\n   - 否则（完全没有正向对齐），使用一个基于距离的备用方案，温度为$\\sigma$：$p_{i,t} \\propto \\exp\\!\\left(-\\dfrac{\\|\\mathbf{d}_{i,t}\\|}{\\sigma}\\right)$，并进行归一化，使得$\\sum_t p_{i,t} = 1$。使用$\\sigma = 1.0$。\n3) 簇级转移概率$P_{s,t}$定义为源簇$s$中所有细胞$i$的$p_{i,t}$的算术平均值。将每行进行归一化，以确保$\\sum_t P_{s,t} = 1$。将得到的$4 \\times 4$行随机矩阵记为$\\mathbf{P}$。\n4) 定义从HSC到GMP的$k$步转移概率为$\\mathbf{P}^k$矩阵的$(\\mathrm{HSC}, \\mathrm{GMP})$条目。使用$k = 3$来代表从HSC通过中间体到达GMP的经典步数。\n5) 将HSC到GMP流的“方向性支持”定义为一个布尔谓词，其条件是：从HSC到达GMP的$3$步概率严格大于从HSC到达HSC、MPP或CMP的相应$3$步概率。\n6) 使用谱系条形码进行验证：设$\\mathbf{B}$为给定的条形码转移矩阵。计算$\\mathbf{P}$的HSC行与$\\mathbf{B}$的HSC行之间的Jensen–Shannon散度（JSD）：\n   - 对于在相同支持上、总和为$1$且具有非负条目的两个离散分布$\\mathbf{p}$和$\\mathbf{q}$，定义$\\mathbf{m} = \\dfrac{\\mathbf{p} + \\mathbf{q}}{2}$，并使用自然对数定义Kullback–Leibler散度为$\\mathrm{KL}(\\mathbf{p}\\|\\mathbf{m}) = \\sum_j p_j \\log\\!\\left(\\dfrac{p_j}{m_j}\\right)$，并约定$0 \\log(0/r) = 0$。则$\\mathrm{JSD}(\\mathbf{p}, \\mathbf{q}) = \\dfrac{1}{2}\\mathrm{KL}(\\mathbf{p}\\|\\mathbf{m}) + \\dfrac{1}{2}\\mathrm{KL}(\\mathbf{q}\\|\\mathbf{m})$。\n   - 如果$\\mathrm{JSD} \\le \\tau$，则声明验证通过，阈值$\\tau = 0.25$。\n7) 数值输出：\n   - 对每个测试用例，您的程序必须输出一个四元素列表：[directional_support_boolean, three_step_probability_to_GMP_from_HSC, JSD_HSC_row, validation_boolean]。\n   - 3步概率和Jensen–Shannon散度必须是实数。将两者都四舍五入到$6$位小数。\n8) 最终输出格式：您的程序应生成单行输出，其中包含一个结果列表，该列表由逗号分隔，并用方括号括起，其中每个元素是上述的四元素列表。例如：\"[[true,0.123456,0.234567,false],[...],...]\"。\n\n测试套件（三个用例）：\n- 全局常量：$\\sigma = 1.0$， $k = 3$， $\\tau = 0.25$。\n- 簇顺序固定为 [$\\mathrm{HSC}$, $\\mathrm{MPP}$, $\\mathrm{CMP}$, $\\mathrm{GMP}$]。\n\n用例1：\n- 细胞坐标和速度：\n  - HSC坐标：$[(0.00, 0.00), (-0.10, 0.00), (0.05, 0.02)]$；HSC速度：$[(0.80, 0.00), (0.70, 0.05), (0.60, -0.02)]$。\n  - MPP坐标：$[(1.00, 0.00), (1.02, 0.01)]$；MPP速度：$[(0.70, 0.00), (0.65, 0.01)]$。\n  - CMP坐标：$[(2.00, 0.00), (2.05, -0.01)]$；CMP速度：$[(0.60, 0.00), (0.55, 0.00)]$。\n  - GMP坐标：$[(3.00, 0.00)]$；GMP速度：$[(0.00, 0.00)]$。\n- 谱系条形码矩阵$\\mathbf{B}$（行按簇顺序排列，每行总和为$1$）：\n  - HSC行：$[0.00, 0.85, 0.10, 0.05]$。\n  - MPP行：$[0.10, 0.00, 0.70, 0.20]$。\n  - CMP行：$[0.00, 0.20, 0.00, 0.80]$。\n  - GMP行：$[0.00, 0.00, 0.00, 1.00]$。\n\n用例2：\n- 细胞坐标和速度：\n  - HSC坐标：$[(0.00, 0.00), (-0.10, 0.00), (0.05, 0.02)]$；HSC速度：$[(0.30, 0.00), (-0.10, 0.20), (0.00, 0.00)]$。\n  - MPP坐标：$[(1.00, 0.00), (1.02, 0.01)]$；MPP速度：$[(0.60, 0.02), (0.55, 0.00)]$。\n  - CMP坐标：$[(2.00, 0.00), (2.05, -0.01)]$；CMP速度：$[(0.50, 0.00), (0.45, 0.00)]$。\n  - GMP坐标：$[(3.00, 0.00)]$；GMP速度：$[(0.00, 0.00)]$。\n- 谱系条形码矩阵$\\mathbf{B}$：\n  - HSC行：$[0.00, 0.60, 0.25, 0.15]$。\n  - MPP行：$[0.05, 0.10, 0.65, 0.20]$。\n  - CMP行：$[0.00, 0.15, 0.05, 0.80]$。\n  - GMP行：$[0.00, 0.00, 0.00, 1.00]$。\n\n用例3：\n- 细胞坐标和速度：\n  - HSC坐标：$[(0.00, 0.00), (-0.10, 0.00), (0.05, 0.02)]$；HSC速度：$[(0.00, 0.00), (0.00, 0.00), (0.00, 0.00)]$。\n  - MPP坐标：$[(1.00, 0.00), (1.02, 0.01)]$；MPP速度：$[(0.00, 0.00), (0.00, 0.00)]$。\n  - CMP坐标：$[(2.00, 0.00), (2.05, -0.01)]$；CMP速度：$[(0.00, 0.00), (0.00, 0.00)]$。\n  - GMP坐标：$[(3.00, 0.00)]$；GMP速度：$[(0.00, 0.00)]$。\n- 谱系条形码矩阵$\\mathbf{B}$：\n  - HSC行：$[0.40, 0.30, 0.20, 0.10]$。\n  - MPP行：$[0.20, 0.30, 0.30, 0.20]$。\n  - CMP行：$[0.10, 0.20, 0.30, 0.40]$。\n  - GMP行：$[0.00, 0.00, 0.00, 1.00]$。\n\n您的程序必须：\n- 实现上述流程以计算$\\mathbf{P}$、从HSC到GMP的$3$步概率、方向性支持布尔值、$\\mathbf{P}$和$\\mathbf{B}$的HSC行之间的Jensen–Shannon散度，以及使用阈值$\\tau = 0.25$的验证布尔值。\n- 生成单行输出，其中包含一个由逗号分隔的列表，列表由每个测试用例的四元素列表组成，并用方括号括起。将实数四舍五入到$6$位小数。如果您的语言使用小写布尔字面量（如true/false），请使用该表示法；在Python中，布尔值呈现为True/False，这也是可接受的。", "solution": "该问题是有效的。它提出了一个定义明确的计算任务，该任务基于单细胞数据分析的原理，特别是用于推断造血过程中细胞命运轨迹的RNA速度建模。所有必要的数据、数学定义和参数都已提供，使得该问题自洽、客观且科学上合理。我将继续提供解决方案。\n\n任务是基于RNA速度向量构建细胞状态转移的马尔可夫模型，并对照独立的谱系条形码数据验证该模型。该系统由代表造血分化路径的四个细胞簇组成：造血干细胞（HSC）、多能祖细胞（MPP）、共同髓系祖细胞（CMP）和粒细胞-巨噬细胞祖细胞（GMP）。这些簇按此顺序从$0$到$3$进行索引。\n\n首先，我们通过计算每个簇$k$的质心$\\mathbf{c}_k$来为其建立一个参考点，质心是该簇内所有细胞坐标的算术平均值。\n$$\n\\mathbf{c}_k = \\frac{1}{N_k} \\sum_{i \\in \\text{cluster } k} \\mathbf{x}_i\n$$\n其中$N_k$是簇$k$中的细胞数量，$\\mathbf{x}_i$是细胞$i$的坐标向量。\n\n接下来，我们计算从每个细胞到所有可能的目标簇的转移概率。对于源簇$s$中的一个细胞$i$，其位置为$\\mathbf{x}_i$，速度为$\\mathbf{v}_i$，它朝向目标簇$t$的转移趋势，是通过其速度向量与指向目标簇质心的位移向量的对齐程度来量化的。位移向量是$\\mathbf{d}_{i,t} = \\mathbf{c}_t - \\mathbf{x}_i$。对齐程度由$\\mathbf{v}_i$和$\\mathbf{d}_{i,t}$之间的余弦相似度来衡量。我们将对齐分数$a_{i,t}$定义为该余弦相似度的非负部分：\n$$\na_{i,t} = \\max\\left\\{0, \\frac{\\mathbf{v}_i \\cdot \\mathbf{d}_{i,t}}{\\|\\mathbf{v}_i\\|_2 \\|\\mathbf{d}_{i,t}\\|_2}\\right\\}\n$$\n其中$\\|\\cdot\\|_2$是欧几里得范数。如果$\\mathbf{v}_i$或$\\mathbf{d}_{i,t}$是零向量，其范数为$0$，我们定义$a_{i,t} = 0$。然后将这些分数归一化，得到单细胞转移概率$p_{i,t}$：\n$$\np_{i,t} = \\frac{a_{i,t}}{\\sum_{u=0}^{3} a_{i,u}}\n$$\n仅当$\\sum_{u} a_{i,u} > 0$时才执行此归一化。如果一个细胞的速度向量与任何簇质心都没有正向对齐（即$\\sum_{u} a_{i,u} = 0$），我们采用一个备用机制。此时，概率将基于到簇质心的欧几里得距离的负指数，并由温度参数$\\sigma = 1.0$控制：\n$$\np_{i,t} \\propto \\exp\\left(-\\frac{\\|\\mathbf{d}_{i,t}\\|_2}{\\sigma}\\right)\n$$\n这些值随后被归一化，以使它们的总和为$1$。\n\n从源簇$s$到目标簇$t$的簇-簇转移概率$P_{s,t}$，是通过对属于簇$s$的所有细胞$i$的单细胞概率$p_{i,t}$求平均值来计算的。然后，对所得矩阵$\\mathbf{P}$的每一行进行重新归一化，以确保其为行随机矩阵。\n$$\nP_{s,t} = \\frac{1}{N_s} \\sum_{i \\in \\text{cluster } s} p_{i,t} \\quad \\text{然后进行行归一化}\n$$\n\n为了对多步分化过程建模，我们通过计算$\\mathbf{P}$的$k$次幂来得到$k$步转移矩阵，记为$\\mathbf{P}^k$。问题指定$k=3$来代表从HSC到GMP的经典步数。因此，条目$(\\mathbf{P}^3)_{0,3}$代表从HSC（索引0）到GMP（索引3）的3步转移概率。\n\n然后，我们评估HSC到GMP轨迹的“方向性支持”。这是一个布尔条件，当且仅当从HSC转移到GMP的3步概率严格大于从HSC转移到任何其他簇（包括其自身）的3步概率时，该条件为真。设$\\mathbf{P}^{(3)} = \\mathbf{P}^3$。该条件是：\n$$\n\\mathbf{P}^{(3)}_{0,3} > \\mathbf{P}^{(3)}_{0,0} \\quad \\land \\quad \\mathbf{P}^{(3)}_{0,3} > \\mathbf{P}^{(3)}_{0,1} \\quad \\land \\quad \\mathbf{P}^{(3)}_{0,3} > \\mathbf{P}^{(3)}_{0,2}\n$$\n\n最后，我们将通过速度推断出的一步转移概率与一个独立的实验模式——谱系条形码进行验证，后者由给定的转移矩阵$\\mathbf{B}$表示。该比较是针对HSC源簇（即矩阵$\\mathbf{P}$和$\\mathbf{B}$的第一行）进行的，使用Jensen-Shannon散度（JSD）。对于两个概率分布$\\mathbf{p}$和$\\mathbf{q}$，JSD定义为：\n$$\n\\mathrm{JSD}(\\mathbf{p}, \\mathbf{q}) = \\frac{1}{2} D_{KL}(\\mathbf{p} \\| \\mathbf{m}) + \\frac{1}{2} D_{KL}(\\mathbf{q} \\| \\mathbf{m})\n$$\n其中$\\mathbf{m} = \\frac{1}{2}(\\mathbf{p} + \\mathbf{q})$是混合分布，而$D_{KL}(\\mathbf{p} \\| \\mathbf{m}) = \\sum_j p_j \\ln\\left(\\frac{p_j}{m_j}\\right)$是Kullback-Leibler散度。应用$0 \\ln(0/x) = 0$的约定。如果计算出的JSD小于或等于阈值$\\tau = 0.25$，则认为验证成功。\n\n对于每个测试用例，我们将计算四个值：方向性支持布尔值、从HSC到GMP的3步概率、$\\mathbf{P}$和$\\mathbf{B}$的HSC行之间的JSD，以及验证通过布尔值。浮点数将四舍五入到6位小数。", "answer": "[[true,0.613627,0.186836,true],[false,0.407963,0.301988,false],[false,0.218525,0.245849,true]]", "id": "2852618"}]}