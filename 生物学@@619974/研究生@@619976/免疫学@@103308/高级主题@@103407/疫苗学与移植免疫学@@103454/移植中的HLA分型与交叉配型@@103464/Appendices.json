{"hands_on_practices": [{"introduction": "现代移植免疫学已经超越了传统的抗原层面匹配，它在表位子（eplet）——即HLA分子上的功能性表位——的层面上量化错配。本练习提供了一个从高分辨率分型数据中直接计算表位子错配负荷的实践机会，这是评估供者特异性抗体（DSA）形成风险的一项核心技能。通过应用一个定量的风险模型，您将把这些分子数据转化为具有临床相关性的概率 [@problem_id:2854197]。", "problem": "一个移植免疫学实验室使用基于eplet的人类白细胞抗原（HLA）错配评估来进行虚拟交叉配型，并估算肾移植后产生供者特异性抗体（DSA）的概率。Eplet是在HLA分子上由少量多态性残基构象定义的最小结构表位。下面提供了供者和受者的高分辨率HLA分型，以及本案例中涉及的特定等位基因的eplet目录。对于任意等位基因标签$\\text{X}$，令$\\mathcal{E}(\\text{X})$表示分配给该等位基因的eplet集合。为明确起见，每个eplet用符号$\\epsilon_{\\text{code}}$表示，其中下标“code”唯一地标识该eplet。\n\n供者高分辨率HLA分型：\n- I类：`HLA-A*24:02`、`HLA-A*02:01`；`HLA-B*57:01`、`HLA-B*44:02`；`HLA-C*06:02`、`HLA-C*07:02`。\n- II类：`HLA-DRB1*15:01`、`HLA-DRB1*03:01`；`HLA-DQA1*01:02`、`HLA-DQA1*05:01`；`HLA-DQB1*06:02`、`HLA-DQB1*02:01`；`HLA-DPB1*04:01`、`HLA-DPB1*02:01`；`HLA-DPA1*02:01`、`HLA-DPA1*01:03`。\n\n受者高分辨率HLA分型：\n- I类：`HLA-A*02:01`、`HLA-A*03:01`；`HLA-B*44:02`、`HLA-B*15:01`；`HLA-C*07:02`、`HLA-C*03:04`。\n- II类：`HLA-DRB1*04:01`、`HLA-DRB1*03:01`；`HLA-DQA1*03:01`、`HLA-DQA1*05:01`；`HLA-DQB1*03:02`、`HLA-DQB1*02:01`；`HLA-DPB1*04:02`、`HLA-DPB1*02:01`；`HLA-DPA1*02:02`、`HLA-DPA1*01:03`。\n\n本案例中等位基因对应的eplet目录：\n- $\\mathcal{E}(\\text{HLA-A*02:01})=\\{\\epsilon_{\\text{A62GE}},\\ \\epsilon_{\\text{A144TKH}},\\ \\epsilon_{\\text{A163EW}},\\ \\epsilon_{\\text{A9F}}\\}$。\n- $\\mathcal{E}(\\text{HLA-A*24:02})=\\{\\epsilon_{\\text{A62GE}},\\ \\epsilon_{\\text{A70Q}},\\ \\epsilon_{\\text{A76V}},\\ \\epsilon_{\\text{A150R}},\\ \\epsilon_{\\text{A163EW}}\\}$。\n- $\\mathcal{E}(\\text{HLA-A*03:01})=\\{\\epsilon_{\\text{A62GE}},\\ \\epsilon_{\\text{A152AE}},\\ \\epsilon_{\\text{A9F}},\\ \\epsilon_{\\text{A244Q}}\\}$。\n\n- $\\mathcal{E}(\\text{HLA-B*44:02})=\\{\\epsilon_{\\text{B67F}},\\ \\epsilon_{\\text{B70N}},\\ \\epsilon_{\\text{B82LR}},\\ \\epsilon_{\\text{B163EW}}\\}$。\n- $\\mathcal{E}(\\text{HLA-B*57:01})=\\{\\epsilon_{\\text{B97V}},\\ \\epsilon_{\\text{B116F}},\\ \\epsilon_{\\text{B163EW}},\\ \\epsilon_{\\text{B145R}}\\}$。\n- $\\mathcal{E}(\\text{HLA-B*15:01})=\\{\\epsilon_{\\text{B62GE}},\\ \\epsilon_{\\text{B70N}},\\ \\epsilon_{\\text{B116S}},\\ \\epsilon_{\\text{B163EW}}\\}$。\n\n- $\\mathcal{E}(\\text{HLA-C*07:02})=\\{\\epsilon_{\\text{C9L}},\\ \\epsilon_{\\text{C77S}},\\ \\epsilon_{\\text{C80N}},\\ \\epsilon_{\\text{C116Y}}\\}$。\n- $\\mathcal{E}(\\text{HLA-C*06:02})=\\{\\epsilon_{\\text{C9L}},\\ \\epsilon_{\\text{C77N}},\\ \\epsilon_{\\text{C80K}},\\ \\epsilon_{\\text{C116Y}}\\}$。\n- $\\mathcal{E}(\\text{HLA-C*03:04})=\\{\\epsilon_{\\text{C9L}},\\ \\epsilon_{\\text{C77S}},\\ \\epsilon_{\\text{C80N}},\\ \\epsilon_{\\text{C116F}}\\}$。\n\n- $\\mathcal{E}(\\text{HLA-DRB1*15:01})=\\{\\epsilon_{\\text{DR13H}},\\ \\epsilon_{\\text{DR71AA}},\\ \\epsilon_{\\text{DR96E}},\\ \\epsilon_{\\text{DR140A}}\\}$。\n- $\\mathcal{E}(\\text{HLA-DRB1*03:01})=\\{\\epsilon_{\\text{DR9E}},\\ \\epsilon_{\\text{DR71K}},\\ \\epsilon_{\\text{DR96Q}},\\ \\epsilon_{\\text{DR140A}}\\}$。\n- $\\mathcal{E}(\\text{HLA-DRB1*04:01})=\\{\\epsilon_{\\text{DR13H}},\\ \\epsilon_{\\text{DR71K}},\\ \\epsilon_{\\text{DR96E}},\\ \\epsilon_{\\text{DR140A}}\\}$。\n\n- $\\mathcal{E}(\\text{HLA-DQA1*01:02})=\\{\\epsilon_{\\text{DQA34A}},\\ \\epsilon_{\\text{DQA47Y}},\\ \\epsilon_{\\text{DQA52H}}\\}$。\n- $\\mathcal{E}(\\text{HLA-DQA1*05:01})=\\{\\epsilon_{\\text{DQA34S}},\\ \\epsilon_{\\text{DQA47Y}},\\ \\epsilon_{\\text{DQA52H}}\\}$。\n- $\\mathcal{E}(\\text{HLA-DQA1*03:01})=\\{\\epsilon_{\\text{DQA34A}},\\ \\epsilon_{\\text{DQA47F}},\\ \\epsilon_{\\text{DQA52N}}\\}$。\n\n- $\\mathcal{E}(\\text{HLA-DQB1*06:02})=\\{\\epsilon_{\\text{DQB26L}},\\ \\epsilon_{\\text{DQB37Y}},\\ \\epsilon_{\\text{DQB57D}},\\ \\epsilon_{\\text{DQB71A}}\\}$。\n- $\\mathcal{E}(\\text{HLA-DQB1*02:01})=\\{\\epsilon_{\\text{DQB26V}},\\ \\epsilon_{\\text{DQB37Y}},\\ \\epsilon_{\\text{DQB57A}},\\ \\epsilon_{\\text{DQB71A}}\\}$。\n- $\\mathcal{E}(\\text{HLA-DQB1*03:02})=\\{\\epsilon_{\\text{DQB26L}},\\ \\epsilon_{\\text{DQB37F}},\\ \\epsilon_{\\text{DQB57D}},\\ \\epsilon_{\\text{DQB71E}}\\}$。\n\n- $\\mathcal{E}(\\text{HLA-DPB1*04:01})=\\{\\epsilon_{\\text{DP84GGPM}},\\ \\epsilon_{\\text{DP56E}},\\ \\epsilon_{\\text{DP65E}},\\ \\epsilon_{\\text{DP69K}}\\}$。\n- $\\mathcal{E}(\\text{HLA-DPB1*02:01})=\\{\\epsilon_{\\text{DP84DEAV}},\\ \\epsilon_{\\text{DP56D}},\\ \\epsilon_{\\text{DP65Q}},\\ \\epsilon_{\\text{DP69E}}\\}$。\n- $\\mathcal{E}(\\text{HLA-DPB1*04:02})=\\{\\epsilon_{\\text{DP84GGPM}},\\ \\epsilon_{\\text{DP56E}},\\ \\epsilon_{\\text{DP65E}},\\ \\epsilon_{\\text{DP69E}}\\}$。\n\n- $\\mathcal{E}(\\text{HLA-DPA1*02:01})=\\{\\epsilon_{\\text{DPA31Q}},\\ \\epsilon_{\\text{DPA50V}}\\}$。\n- $\\mathcal{E}(\\text{HLA-DPA1*01:03})=\\{\\epsilon_{\\text{DPA31M}},\\ \\epsilon_{\\text{DPA50M}}\\}$。\n- $\\mathcal{E}(\\text{HLA-DPA1*02:02})=\\{\\epsilon_{\\text{DPA31Q}},\\ \\epsilon_{\\text{DPA50M}}\\}$。\n\nEplet错配负荷的定义：\n- 对于每个基因座 $\\ell$，将供者在 $\\ell$ 基因座上两个等位基因的eplet合并，构成供者eplet并集 $\\mathcal{E}^{D}_{\\ell}$；同样，将受者在 $\\ell$ 基因座上两个等位基因的eplet合并，构成受者eplet并集 $\\mathcal{E}^{R}_{\\ell}$。\n- 特定基因座的eplet错配集合为 $\\mathcal{M}_{\\ell}=\\mathcal{E}^{D}_{\\ell}\\setminus \\mathcal{E}^{R}_{\\ell}$，其负荷为 $L_{\\ell}=|\\mathcal{M}_{\\ell}|$。\n- I类负荷 $L_{I}$ 是 $\\mathcal{M}_{\\ell}$ 在 $\\ell\\in\\{\\text{A},\\text{B},\\text{C}\\}$ 上并集的基数；II类负荷 $L_{II}$ 是 $\\mathcal{M}_{\\ell}$ 在 $\\ell\\in\\{\\text{DRB1},\\text{DQA1},\\text{DQB1},\\text{DPB1},\\text{DPA1}\\}$ 上并集的基数。\n\n错配负荷与DSA风险关联模型：\n- 该实验室使用一个逻辑斯谛模型来计算一年内产生移植后供者特异性抗体的概率 $p$：\n$$\np=\\frac{1}{1+\\exp\\!\\big(-(\\alpha+\\beta_{1}L_{I}+\\beta_{2}L_{II})\\big)},\n$$\n其中常数 $\\alpha=-2.0$, $\\beta_{1}=0.12$, $\\beta_{2}=0.25$。\n\n任务：\n- 使用上述定义，根据所提供的数据计算 $L_{I}$ 和 $L_{II}$，然后根据模型计算概率 $p$。将最终概率 $p$ 以小数形式表示，并四舍五入至四位有效数字。", "solution": "问题陈述已经过评估并被认定为有效。它在科学上基于移植免疫学的原理，问题提法清晰，定义明确，数据完整，且客观、内部一致。不存在科学上不健全、不完整或模棱两可的缺陷，可以推导出一个严谨的、分步的解答。\n\n任务是计算I类eplet错配负荷（$L_{I}$）、II类eplet错配负荷（$L_{II}$），以及随后产生供者特异性抗体（DSA）的概率（$p$）。分析过程如下：首先确定每个HLA基因座的eplet错配集合，然后汇总这些集合以计算总的I类和II类负荷，最后应用所提供的逻辑回归模型。\n\n首先，我们确定I类eplet错配负荷 $L_{I}$。这需要分析HLA-A、HLA-B和HLA-C基因座。\n\n对于HLA-A基因座：\n供者的等位基因是`A*24:02`和`A*02:01`。受者的等位基因是`A*02:01`和`A*03:01`。\n相关等位基因的eplet集合为：\n$\\mathcal{E}(\\text{A*24:02}) = \\{\\epsilon_{\\text{A62GE}}, \\epsilon_{\\text{A70Q}}, \\epsilon_{\\text{A76V}}, \\epsilon_{\\text{A150R}}, \\epsilon_{\\text{A163EW}}\\}$\n$\\mathcal{E}(\\text{A*02:01}) = \\{\\epsilon_{\\text{A62GE}}, \\epsilon_{\\text{A144TKH}}, \\epsilon_{\\text{A163EW}}, \\epsilon_{\\text{A9F}}\\}$\n$\\mathcal{E}(\\text{A*03:01}) = \\{\\epsilon_{\\text{A62GE}}, \\epsilon_{\\text{A152AE}}, \\epsilon_{\\text{A9F}}, \\epsilon_{\\text{A244Q}}\\}$\n\n供者在A基因座上的eplet并集是：\n$\\mathcal{E}^{D}_{A} = \\mathcal{E}(\\text{A*24:02}) \\cup \\mathcal{E}(\\text{A*02:01}) = \\{\\epsilon_{\\text{A62GE}}, \\epsilon_{\\text{A70Q}}, \\epsilon_{\\text{A76V}}, \\epsilon_{\\text{A150R}}, \\epsilon_{\\text{A163EW}}, \\epsilon_{\\text{A144TKH}}, \\epsilon_{\\text{A9F}}\\}$\n\n受者在A基因座上的eplet并集是：\n$\\mathcal{E}^{R}_{A} = \\mathcal{E}(\\text{A*02:01}) \\cup \\mathcal{E}(\\text{A*03:01}) = \\{\\epsilon_{\\text{A62GE}}, \\epsilon_{\\text{A144TKH}}, \\epsilon_{\\text{A163EW}}, \\epsilon_{\\text{A9F}}, \\epsilon_{\\text{A152AE}}, \\epsilon_{\\text{A244Q}}\\}$\n\nA基因座的错配集合是集合差 $\\mathcal{M}_{A} = \\mathcal{E}^{D}_{A} \\setminus \\mathcal{E}^{R}_{A}$：\n$\\mathcal{M}_{A} = \\{\\epsilon_{\\text{A70Q}}, \\epsilon_{\\text{A76V}}, \\epsilon_{\\text{A150R}}\\}$\n\n对于HLA-B基因座：\n供者的等位基因是`B*57:01`和`B*44:02`。受者的等位基因是`B*44:02`和`B*15:01`。\n这些等位基因的eplet集合为：\n$\\mathcal{E}(\\text{B*57:01}) = \\{\\epsilon_{\\text{B97V}}, \\epsilon_{\\text{B116F}}, \\epsilon_{\\text{B163EW}}, \\epsilon_{\\text{B145R}}\\}$\n$\\mathcal{E}(\\text{B*44:02}) = \\{\\epsilon_{\\text{B67F}}, \\epsilon_{\\text{B70N}}, \\epsilon_{\\text{B82LR}}, \\epsilon_{\\text{B163EW}}\\}$\n$\\mathcal{E}(\\text{B*15:01}) = \\{\\epsilon_{\\text{B62GE}}, \\epsilon_{\\text{B70N}}, \\epsilon_{\\text{B116S}}, \\epsilon_{\\text{B163EW}}\\}$\n\n$\\mathcal{E}^{D}_{B} = \\mathcal{E}(\\text{B*57:01}) \\cup \\mathcal{E}(\\text{B*44:02}) = \\{\\epsilon_{\\text{B97V}}, \\epsilon_{\\text{B116F}}, \\epsilon_{\\text{B163EW}}, \\epsilon_{\\text{B145R}}, \\epsilon_{\\text{B67F}}, \\epsilon_{\\text{B70N}}, \\epsilon_{\\text{B82LR}}\\}$\n$\\mathcal{E}^{R}_{B} = \\mathcal{E}(\\text{B*44:02}) \\cup \\mathcal{E}(\\text{B*15:01}) = \\{\\epsilon_{\\text{B67F}}, \\epsilon_{\\text{B70N}}, \\epsilon_{\\text{B82LR}}, \\epsilon_{\\text{B163EW}}, \\epsilon_{\\text{B62GE}}, \\epsilon_{\\text{B116S}}\\}$\n$\\mathcal{M}_{B} = \\mathcal{E}^{D}_{B} \\setminus \\mathcal{E}^{R}_{B} = \\{\\epsilon_{\\text{B97V}}, \\epsilon_{\\text{B116F}}, \\epsilon_{\\text{B145R}}\\}$\n\n对于HLA-C基因座：\n供者的等位基因是`C*06:02`和`C*07:02`。受者的等位基因是`C*07:02`和`C*03:04`。\n这些等位基因的eplet集合为：\n$\\mathcal{E}(\\text{C*06:02}) = \\{\\epsilon_{\\text{C9L}}, \\epsilon_{\\text{C77N}}, \\epsilon_{\\text{C80K}}, \\epsilon_{\\text{C116Y}}\\}$\n$\\mathcal{E}(\\text{C*07:02}) = \\{\\epsilon_{\\text{C9L}}, \\epsilon_{\\text{C77S}}, \\epsilon_{\\text{C80N}}, \\epsilon_{\\text{C116Y}}\\}$\n$\\mathcal{E}(\\text{C*03:04}) = \\{\\epsilon_{\\text{C9L}}, \\epsilon_{\\text{C77S}}, \\epsilon_{\\text{C80N}}, \\epsilon_{\\text{C116F}}\\}$\n\n$\\mathcal{E}^{D}_{C} = \\mathcal{E}(\\text{C*06:02}) \\cup \\mathcal{E}(\\text{C*07:02}) = \\{\\epsilon_{\\text{C9L}}, \\epsilon_{\\text{C77N}}, \\epsilon_{\\text{C80K}}, \\epsilon_{\\text{C116Y}}, \\epsilon_{\\text{C77S}}, \\epsilon_{\\text{C80N}}\\}$\n$\\mathcal{E}^{R}_{C} = \\mathcal{E}(\\text{C*07:02}) \\cup \\mathcal{E}(\\text{C*03:04}) = \\{\\epsilon_{\\text{C9L}}, \\epsilon_{\\text{C77S}}, \\epsilon_{\\text{C80N}}, \\epsilon_{\\text{C116Y}}, \\epsilon_{\\text{C116F}}\\}$\n$\\mathcal{M}_{C} = \\mathcal{E}^{D}_{C} \\setminus \\mathcal{E}^{R}_{C} = \\{\\epsilon_{\\text{C77N}}, \\epsilon_{\\text{C80K}}\\}$\n\n总的I类错配集合是 $\\mathcal{M}_{I} = \\mathcal{M}_{A} \\cup \\mathcal{M}_{B} \\cup \\mathcal{M}_{C}$。由于eplet编码是基因座特异性的（以A、B、C为前缀），这些集合是不相交的。\n$\\mathcal{M}_{I} = \\{\\epsilon_{\\text{A70Q}}, \\epsilon_{\\text{A76V}}, \\epsilon_{\\text{A150R}}, \\epsilon_{\\text{B97V}}, \\epsilon_{\\text{B116F}}, \\epsilon_{\\text{B145R}}, \\epsilon_{\\text{C77N}}, \\epsilon_{\\text{C80K}}\\}$\nI类负荷为 $L_{I} = |\\mathcal{M}_{I}| = |\\mathcal{M}_{A}| + |\\mathcal{M}_{B}| + |\\mathcal{M}_{C}| = 3 + 3 + 2 = 8$。\n\n接下来，我们确定II类eplet错配负荷（$L_{II}$）。这需要分析DRB1、DQA1、DQB1、DPB1和DPA1基因座。\n\n对于DRB1基因座：$\\mathcal{M}_{\\text{DRB1}} = \\mathcal{E}^{D}_{\\text{DRB1}} \\setminus \\mathcal{E}^{R}_{\\text{DRB1}} = \\{\\epsilon_{\\text{DR71AA}}\\}$。\n对于DQA1基因座：$\\mathcal{M}_{\\text{DQA1}} = \\mathcal{E}^{D}_{\\text{DQA1}} \\setminus \\mathcal{E}^{R}_{\\text{DQA1}} = \\emptyset$。\n对于DQB1基因座：$\\mathcal{M}_{\\text{DQB1}} = \\mathcal{E}^{D}_{\\text{DQB1}} \\setminus \\mathcal{E}^{R}_{\\text{DQB1}} = \\emptyset$。\n对于DPB1基因座：$\\mathcal{M}_{\\text{DPB1}} = \\mathcal{E}^{D}_{\\text{DPB1}} \\setminus \\mathcal{E}^{R}_{\\text{DPB1}} = \\{\\epsilon_{\\text{DP69K}}\\}$。\n对于DPA1基因座：$\\mathcal{M}_{\\text{DPA1}} = \\mathcal{E}^{D}_{\\text{DPA1}} \\setminus \\mathcal{E}^{R}_{\\text{DPA1}} = \\{\\epsilon_{\\text{DPA50V}}\\}$。\n\n总的II类错配集合是 $\\mathcal{M}_{II} = \\mathcal{M}_{\\text{DRB1}} \\cup \\mathcal{M}_{\\text{DQA1}} \\cup \\mathcal{M}_{\\text{DQB1}} \\cup \\mathcal{M}_{\\text{DPB1}} \\cup \\mathcal{M}_{\\text{DPA1}}$。\n$\\mathcal{M}_{II} = \\{\\epsilon_{\\text{DR71AA}}, \\epsilon_{\\text{DP69K}}, \\epsilon_{\\text{DPA50V}}\\}$\nII类的eplet编码也是基因座特异性的，确保了集合的不相交性。\nII类负荷为 $L_{II} = |\\mathcal{M}_{II}| = 1 + 0 + 0 + 1 + 1 = 3$。\n\n最后，我们使用逻辑斯谛模型和计算出的负荷值 $L_{I}=8$ 及 $L_{II}=3$ 来计算概率 $p$。模型为：\n$$p = \\frac{1}{1 + \\exp(-(\\alpha + \\beta_{1}L_{I} + \\beta_{2}L_{II}))}$$\n给定的参数为 $\\alpha = -2.0$, $\\beta_{1} = 0.12$, $\\beta_{2} = 0.25$。\n我们首先计算线性预测子 $Z$，即指数函数的参数：\n$$Z = \\alpha + \\beta_{1}L_{I} + \\beta_{2}L_{II}$$\n$$Z = -2.0 + (0.12)(8) + (0.25)(3)$$\n$$Z = -2.0 + 0.96 + 0.75$$\n$$Z = -2.0 + 1.71 = -0.29$$\n现在，将该值代入概率公式：\n$$p = \\frac{1}{1 + \\exp(-Z)} = \\frac{1}{1 + \\exp(-(-0.29))} = \\frac{1}{1 + \\exp(0.29)}$$\n计算数值：\n$$\\exp(0.29) \\approx 1.336421$$\n$$p = \\frac{1}{1 + 1.336421} = \\frac{1}{2.336421} \\approx 0.4279998$$\n按要求四舍五入到四位有效数字，我们得到 $p \\approx 0.4280$。", "answer": "$$\\boxed{0.4280}$$", "id": "2854197"}, {"introduction": "在移植领域，临床决策常常需要解读不完整的信息，例如被无效等位基因（null alleles）混淆的模糊HLA分型结果。贝叶斯推断提供了一个严谨的框架，让我们能够根据检测结果和群体遗传学的先验知识，更新对供者真实表型的评估。本问题将挑战您在给定一个模糊的检测结果以及包括无效变异在内的等位基因频率知识的条件下，计算供者表达特定HLA表位的后验概率 [@problem_id:2854228]。", "problem": "一名肾移植候选者体内存在针对人类白细胞抗原 (HLA)-B 上公共表位 Bw4 的具有临床意义的免疫球蛋白G (IgG)。现要求您在分子分型结果不明确的情况下，估计一位潜在供体在 HLA-B 基因座上于细胞表面表达 Bw4 的概率。为进行此计算，请假设以下具有科学依据的基础：\n\n- HLA 分子呈共显性表达；一个无效等位基因不产生表面 HLA 蛋白，因此不贡献 Bw4 表位。\n- 供体所属的群体在 HLA-B 基因座上处于 Hardy–Weinberg 平衡状态。\n- 在 HLA-B 基因座上，存在与 Bw4 及分型模糊性相关的三种等位基因类别：\n  1. 功能性携带 Bw4 的等位基因，记为 $a$，其群体频率为 $p$。\n  2. 功能性不携带 Bw4 的等位基因，记为 $b$，其群体频率为 $q$。\n  3. 一个源自 Bw4 序列背景的无效等位基因（即，序列包含 Bw4 基序但无表面表达），记为 $n$，其群体频率为 $r$。\n- 这些频率满足 $p+q+r=1$，且分别为 $p=0.20$，$q=0.78$，$r=0.02$。\n- 该不明确分型结果是通过用于检测 Bw4 基序的序列特异性寡核苷酸 (SSO) 探针组获得的。设观察到的检测结果为 $M$，意为“SSO 检测到 Bw4 基序”。该 SSO 探针组具有以下操作特性：\n  - 如果基因型中至少有一个等位基因在序列水平上携带 Bw4 基序（等位基因 $a$ 或 $n$），则 $\\mathbb{P}(M \\mid \\text{genotype contains } a \\text{ or } n)=\\alpha$，其中 $\\alpha=0.95$。\n  - 如果基因型中没有等位基因在序列水平上携带 Bw4 基序（基因型 $bb$），则 $\\mathbb{P}(M \\mid bb)=\\beta$，其中 $\\beta=0.05$。\n\n假设在 Hardy–Weinberg 平衡下等位基因是独立的，并且 SSO 检测序列基序的存在，但无法区分表达状态。将“Bw4 表达”定义为供体基因型中存在至少一个功能性携带 Bw4 的等位基因 $a$，即基因型为 $aa、ab$ 或 $an$。\n\n以观察到的 SSO 结果 $M$ 为条件，计算供体在 HLA-B 基因座上表达 Bw4 的后验概率 $\\mathbb{P}(\\text{Bw4 expressed} \\mid M)$。将最终答案四舍五入至四位有效数字，并以小数形式表示，不带百分号。", "solution": "对所述问题进行有效性验证。\n\n逐字提取已知条件如下：\n- 供体群体在 HLA-B 基因座上处于 Hardy–Weinberg 平衡状态。\n- 存在三种等位基因类别：\n  1. 功能性携带 Bw4 的等位基因 $a$，频率为 $p = 0.20$。\n  2. 功能性不携带 Bw4 的等位基因 $b$，频率为 $q = 0.78$。\n  3. 源自 Bw4 序列背景的无效等位基因 $n$，频率为 $r = 0.02$。\n- 这些频率满足 $p+q+r=1$。\n- 检测结果为 $M$，即“SSO 检测到 Bw4 基序”。\n- 检测操作特性为：\n  - $\\mathbb{P}(M \\mid \\text{genotype contains } a \\text{ or } n) = \\alpha = 0.95$。\n  - $\\mathbb{P}(M \\mid bb) = \\beta = 0.05$。\n- HLA 分子呈共显性表达。无效等位基因不产生表面蛋白。\n- “Bw4 表达”定义为存在至少一个功能性携带 Bw4 的等位基因 $a$。这对应于基因型 $aa$、$ab$ 和 $an$。\n- 任务是计算后验概率 $\\mathbb{P}(\\text{Bw4 expressed} \\mid M)$。\n\n验证结论：\n该问题是有效的。其科学基础是群体遗传学和免疫学的既定原则。问题提法恰当，提供了所有必要的参数和明确的目标。数据是一致的（$p+q+r = 0.20 + 0.78 + 0.02 = 1$），并且假设在指定情境下是现实的。该问题构成了贝叶斯概率论的一个标准的、非平凡的应用。\n\n我们开始解题。\n\n目标是计算在 Bw4 基序的 SSO 检测结果为阳性的条件下，供体表达 Bw4 表位的后验概率。设 $E$ 为供体表达 Bw4 的事件，设 $M$ 为 SSO 检测到 Bw4 基序的事件。我们必须计算 $\\mathbb{P}(E \\mid M)$。\n\n根据贝叶斯定理，该概率由下式给出：\n$$ \\mathbb{P}(E \\mid M) = \\frac{\\mathbb{P}(M \\mid E) \\mathbb{P}(E)}{\\mathbb{P}(M)} $$\n我们将计算右侧的每一项。\n\n该群体处于 Hardy-Weinberg 平衡状态，等位基因频率为 $p = \\mathbb{P}(a) = 0.20$，$q = \\mathbb{P}(b) = 0.78$ 和 $r = \\mathbb{P}(n) = 0.02$。\n\n首先，我们计算 Bw4 表达的先验概率 $\\mathbb{P}(E)$。如果供体的基因型包含至少一个等位基因 $a$，则事件 $E$ 发生。可能的基因型是 $aa$、$ab$ 和 $an$。在 Hardy-Weinberg 平衡下，这些基因型的概率为：\n$\\mathbb{P}(aa) = p^2$\n$\\mathbb{P}(ab) = 2pq$\n$\\mathbb{P}(an) = 2pr$\n\n因此，表达的总概率为：\n$$ \\mathbb{P}(E) = \\mathbb{P}(aa) + \\mathbb{P}(ab) + \\mathbb{P}(an) = p^2 + 2pq + 2pr $$\n或者，我们可以计算其互补事件 $E^c$（即不表达 Bw4）的概率。如果基因型不包含等位基因 $a$，则该事件发生。这样的个体必须具有由等位基因 $b$ 和 $n$ 组成的基因型。这些等位基因的组合频率是 $q+r$。不含等位基因 $a$ 的基因型的概率是 $(q+r)^2$。\n$$ \\mathbb{P}(E) = 1 - \\mathbb{P}(E^c) = 1 - (q+r)^2 $$\n使用给定值：\n$$ \\mathbb{P}(E) = 1 - (0.78 + 0.02)^2 = 1 - (0.80)^2 = 1 - 0.64 = 0.36 $$\n\n接下来，我们计算 SSO 检测为阳性的总概率 $\\mathbb{P}(M)$。我们使用全概率定律。设 $S$ 为基因型包含 Bw4 序列基序的事件（即，包含至少一个等位基因 $a$ 或 $n$）。其互补事件 $S^c$ 是基因型既不包含 $a$ 也不包含 $n$，这对应于基因型 $bb$。\n$S^c$ 的概率为：\n$$ \\mathbb{P}(S^c) = \\mathbb{P}(bb) = q^2 $$\n因此，$S$ 的概率为：\n$$ \\mathbb{P}(S) = 1 - \\mathbb{P}(S^c) = 1 - q^2 $$\n问题给出了检测结果 $M$ 的条件概率：\n$\\mathbb{P}(M \\mid S) = \\alpha = 0.95$\n$\\mathbb{P}(M \\mid S^c) = \\beta = 0.05$\n\n根据全概率定律：\n$$ \\mathbb{P}(M) = \\mathbb{P}(M \\mid S) \\mathbb{P}(S) + \\mathbb{P}(M \\mid S^c) \\mathbb{P}(S^c) $$\n$$ \\mathbb{P}(M) = \\alpha(1 - q^2) + \\beta q^2 $$\n代入数值：\n$$ \\mathbb{P}(M) = 0.95 \\times (1 - 0.78^2) + 0.05 \\times (0.78^2) $$\n$$ \\mathbb{P}(M) = 0.95 \\times (1 - 0.6084) + 0.05 \\times 0.6084 $$\n$$ \\mathbb{P}(M) = 0.95 \\times 0.3916 + 0.05 \\times 0.6084 $$\n$$ \\mathbb{P}(M) = 0.37202 + 0.03042 = 0.40244 $$\n\n最后，我们需要贝叶斯定理分子中的项 $\\mathbb{P}(M \\mid E)$。事件 $E$（基因型包含等位基因 $a$）是事件 $S$（基因型包含等位基因 $a$ 或 $n$）的一个子事件。如果事件 $E$ 发生，则满足 SSO 检测灵敏度 $\\alpha$ 的条件。因此，在 Bw4 表达的条件下，检测结果为阳性的概率就是 $\\alpha$。\n$$ \\mathbb{P}(M \\mid E) = \\alpha = 0.95 $$\n\n我们现在可以组合得到最终的后验概率：\n$$ \\mathbb{P}(E \\mid M) = \\frac{\\mathbb{P}(M \\mid E) \\mathbb{P}(E)}{\\mathbb{P}(M)} = \\frac{\\alpha \\mathbb{P}(E)}{\\mathbb{P}(M)} $$\n代入计算出的值：\n$$ \\mathbb{P}(E \\mid M) = \\frac{0.95 \\times 0.36}{0.40244} = \\frac{0.342}{0.40244} $$\n$$ \\mathbb{P}(E \\mid M) \\approx 0.849816114... $$\n问题要求答案四舍五入到四位有效数字。\n$$ \\mathbb{P}(E \\mid M) \\approx 0.8498 $$\n这就是在 SSO 检测结果不明确的情况下，供体表达 Bw4 表位的后验概率。", "answer": "$$\n\\boxed{0.8498}\n$$", "id": "2854228"}, {"introduction": "患者的HLA致敏水平，通过计算的群体反应性抗体（Calculated Panel Reactive Antibody, CPRA）进行量化，直接影响其获得相容器官的机会。这种关系可以使用随机过程来建模，其中供者机会随时间随机出现。在本次实践中，您将实施一个基于泊松过程的生物统计学模型，来量化患者“不可接受抗原”（Unacceptable Antigens, UAs）列表的变化如何影响他们移植的预期等待时间 [@problem_id:2854191]，从而将分子水平的致敏与器官分配的系统级动态联系起来。", "problem": "一个移植分配系统在确定供体是否与受体相容时，会考虑计算的群体反应性抗体（Calculated Panel Reactive Antibody, CPRA）和不可接受抗原（Unacceptable Antigens, UAs）列表。CPRA 是指随机供体表达至少一种受体携带抗体的抗原的概率，因此预测其虚拟交叉配血将呈阳性。高 CPRA 意味着相容的供体很少。移除一些被认为免疫学风险较低的 UAs 可以通过增加被视为相容的供体集合，从而增加获得移植的机会。考虑以下简化的、有原则的模型：\n\n- 候选人可接触到的供体机会遵循一个齐次泊松过程到达，其率为 $\\lambda_{d}$，单位为每年次机会。令 $N$ 表示每年的期望机会数（因此 $\\lambda_{d} = N$）。\n- 令 $c$ 表示以 $[0,1]$ 区间内的小数表示的基线 CPRA，即 $c$ 是随机供体携带基线列表上至少一个 UA 的概率。\n- 假设许多 HLA 抗原的个体频率较低，并且抗原在不同供体间的出现可以建模为独立的稀有事件。在这种常见近似下，存在一个总抗原“风险量” $s \\ge 0$，使得 $c = 1 - e^{-s}$。\n- 假设从列表中移除了比例为 $r \\in [0,1]$ 的 UAs（特别是那些被视为低风险的）。假设被移除的 UAs 在基础风险量中也占有相同比例，因此新的风险量为 $(1 - r)s$。那么移除后的 CPRA 变为 $c' = 1 - e^{-(1-r)s}$。\n- 如果供体不携带任何剩余的 UA，则该供体是可接受的。在上述模型下，随机机会是可接受的概率为 $p = 1 - c' = e^{-(1-r)s}$。使用 $c = 1 - e^{-s}$，对于 $c \\in [0,1)$，我们可以写作 $p = (1 - c)^{(1 - r)}$。对于 $c = 1$，当 $r \\in [0,1)$ 时，解释为 $p = 0$；当 $r = 1$ 时，解释为 $p = 1$。\n- 根据泊松过程的稀疏化特性，可接受的机会以率为 $\\lambda = \\lambda_{d} \\cdot p = N \\cdot p$ 的泊松过程到达。因此，到第一个可接受机会的等待时间 $T$ 服从指数分布，其均值为 $\\mathbb{E}[T] = 1/\\lambda = 1/(N p)$，前提是 $N p &gt; 0$。如果 $N p = 0$，则设 $\\mathbb{E}[T] = \\infty$。\n\n任务：实现一个程序，对每个测试用例，使用上述模型计算期望等待时间 $\\mathbb{E}[T]$（以年为单位）。时间单位使用“年”。你的程序必须严格使用上述定义来处理边界情况。\n\n使用以下测试套件，其中每个测试用例是一个三元组 $(c, N, r)$:\n\n- 测试 1：$c = 0.6$, $N = 15000$, $r = 0.0$。\n- 测试 2：$c = 0.6$, $N = 15000$, $r = 0.25$。\n- 测试 3：$c = 0.0$, $N = 12000$, $r = 0.5$。\n- 测试 4：$c = 0.99$, $N = 10000$, $r = 0.3$。\n- 测试 5：$c = 1.0$, $N = 10000$, $r = 0.5$。\n- 测试 6：$c = 0.9$, $N = 200$, $r = 0.1$。\n\n要求：\n\n- 输入：无。将上述测试套件硬编码在你的程序中。\n- 处理：对于每个 $(c, N, r)$，对于 $c \\in [0,1)$ 使用 $p = (1 - c)^{(1 - r)}$ 计算 $p$，并根据上面定义的 $c=1$ 的边界情况，然后计算 $\\mathbb{E}[T] = 1/(N p)$（单位为年），如果 $N p > 0$，否则为 $\\infty$。\n- 输出：你的程序应生成一行输出，包含用方括号括起来的逗号分隔的结果列表（例如，“[result1,result2,...]”）。每个结果必须是年为单位的浮点数（使用该语言的标准浮点数字符串表示）。不应打印任何额外文本。\n\n目标是形式化地描述移除低风险不可接受抗原（UAs）如何通过影响有效 CPRA 来改变获得相容供体的机会，并利用泊松过程和指数等待时间的基本性质将其转化为期望等待时间。", "solution": "首先将对问题陈述进行严格的验证过程。\n\n**问题验证**\n\n**步骤 1：提取给定信息**\n\n- 供体机会以齐次泊松过程到达，率为 $\\lambda_{d} = N$。\n- $N$ 是每年的期望机会数。\n- $c$ 是基线计算的群体反应性抗体（CPRA），一个在 $[0,1]$ 区间内的概率。\n- 总抗原风险量 $s \\ge 0$ 与 $c$ 的关系为 $c = 1 - e^{-s}$。\n- $r \\in [0,1]$ 是被移除的不可接受抗原（UAs）的比例。\n- 新的风险量是 $(1 - r)s$。\n- 移除后的 CPRA 是 $c' = 1 - e^{-(1-r)s}$。\n- 随机机会是可接受的概率为 $p = 1 - c'$。\n- 对于 $c \\in [0,1)$，可接受机会的概率由公式 $p = (1 - c)^{(1 - r)}$ 给出。\n- 对于 $c=1$，应用以下特殊条件：\n    - 如果 $r \\in [0,1)$，则 $p = 0$。\n    - 如果 $r = 1$，则 $p = 1$。\n- 可接受的机会以泊松过程到达，率为 $\\lambda = N \\cdot p$。\n- 到第一个可接受机会的等待时间 $T$ 呈指数分布，均值为 $\\mathbb{E}[T]$。\n- 期望等待时间为 $\\mathbb{E}[T] = 1/\\lambda = 1/(N p)$，前提是 $N p > 0$。\n- 如果 $N p = 0$，则 $\\mathbb{E}[T] = \\infty$。\n\n测试用例以三元组 $(c, N, r)$ 的形式给出：\n- 测试 1：($0.6$, $15000$, $0.0$)\n- 测试 2：($0.6$, $15000$, $0.25$)\n- 测试 3：($0.0$, $12000$, $0.5$)\n- 测试 4：($0.99$, $10000$, $0.3$)\n- 测试 5：($1.0$, $10000$, $0.5$)\n- 测试 6：($0.9$, $200$, $0.1$)\n\n**步骤 2：使用提取的给定信息进行验证**\n\n- **科学上合理（关键）**：该问题使用了一个简化但标准的生物统计模型。使用泊松过程表示到达、其稀疏化特性以及由此产生的指数等待时间是随机过程中的基本概念。CPRA 的模型 $c = 1 - e^{-s}$ 是至少一个独立稀有事件发生概率的有效近似，这是模拟 HLA 抗原分布时的常见假设。该问题具有科学依据。\n- **适定性**：该问题是适定的。它提供了所有必要的公式、参数以及对边界情况（例如，当 $c=1$ 或 $Np=0$ 时）的明确定义。这种结构保证了每个测试用例都存在唯一且有意义的解。\n- **客观性（关键）**：问题以精确、量化且无偏见的语言陈述。它不含主观性论断。\n\n该问题没有表现出任何诸如科学不健全、不完整、矛盾或模糊之类的缺陷。所有术语都已明确定义，任务是基于所提供的模型执行指定的计算。\n\n**步骤 3：结论与行动**\n\n问题被判定为**有效**。将提供解决方案。\n\n**解决方案构建**\n\n目标是为一组给定的参数 $(c, N, r)$ 计算期望等待时间 $\\mathbb{E}[T]$。计算根据所提供的模型分三步进行。\n\n**步骤 1：计算可接受机会的概率 $p$。**\n\n$p$ 的计算取决于基线 CPRA $c$ 的值。问题定义了两种不同的情况。\n\n- 情况 A：$c \\in [0,1)$。\n在此范围内，概率 $p$ 直接使用公式计算：\n$$p = (1 - c)^{(1 - r)}$$\n该公式源自风险量模型。由于 $c = 1 - e^{-s}$，我们有 $1-c = e^{-s}$。那么 $p = 1 - c' = e^{-(1-r)s} = (e^{-s})^{(1-r)} = (1-c)^{(1-r)}$。\n\n- 情况 B：$c = 1$。\n对于这个边界条件，问题提供了一个绕过公式的明确解释。\n  - 如果移除的 UAs 比例 $r$ 小于 1（即 $r \\in [0,1)$），则不可能找到相容的供体。因此，可接受机会的概率是 $p=0$。\n  - 如果所有 UAs 都被移除（$r=1$），则任何供体都是可接受的，概率为 $p=1$。\n\n**步骤 2：计算可接受机会的率 $\\lambda$。**\n\n供体机会的到达是一个率为 $N$ 的泊松过程。给定机会“可接受”的事件是一个独立的伯努利试验，成功概率为 $p$。根据泊松过程的稀疏化特性，可接受机会流也是一个泊松过程，其新率为 $\\lambda$，由下式给出：\n$$\\lambda = N \\cdot p$$\n\n**步骤 3：计算期望等待时间 $\\mathbb{E}[T]$。**\n\n在率为 $\\lambda$ 的泊松过程中，等待第一个事件发生的时间遵循指数分布。这个指数分布的均值就是期望等待时间 $\\mathbb{E}[T]$。\n\n- 如果率 $\\lambda > 0$，则期望等待时间是有限的，由下式给出：\n$$\\mathbb{E}[T] = \\frac{1}{\\lambda} = \\frac{1}{N \\cdot p}$$\n- 如果率 $\\lambda = 0$，这意味着可接受的机会永远不会到达。因此，期望等待时间是无限的：\n$$\\mathbb{E}[T] = \\infty$$\n这种情况在 $N=0$ 或 $p=0$ 时发生。所给的测试用例中 $N > 0$，因此该条件等价于 $p=0$。\n\n实现将严格遵循这些步骤和针对每个测试输入 $(c, N, r)$ 的情况区分。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the expected waiting time for a compatible transplant donor\n    based on a simplified biostatistical model.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each test case is a tuple (c, N, r) where:\n    # c: baseline CPRA (Calculated Panel Reactive Antibody)\n    # N: expected number of offers per year\n    # r: fraction of Unacceptable Antigens (UAs) removed\n    test_cases = [\n        (0.6, 15000, 0.0),\n        (0.6, 15000, 0.25),\n        (0.0, 12000, 0.5),\n        (0.99, 10000, 0.3),\n        (1.0, 10000, 0.5),\n        (0.9, 200, 0.1),\n    ]\n\n    results = []\n    for c, N, r in test_cases:\n        # Step 1: Compute the probability of an acceptable offer, p.\n        # This requires careful handling of the boundary case c = 1.0.\n        p = 0.0\n        if c == 1.0:\n            # Special interpretation for c=1 as per problem statement\n            if r == 1.0:\n                p = 1.0\n            else: # r is in [0, 1)\n                p = 0.0\n        elif 0 <= c < 1.0:\n            # General formula for c in [0, 1)\n            p = (1.0 - c)**(1.0 - r)\n        else:\n            # This case should not be reached with valid inputs\n            # but is included for robustness.\n            # Handles c < 0 or c > 1.\n            raise ValueError(f\"CPRA 'c' must be in [0, 1], but got {c}\")\n\n        # Step 2: Compute the rate of acceptable offers, lambda.\n        lambda_rate = N * p\n\n        # Step 3: Compute the expected waiting time, E[T].\n        # If the rate is zero, the waiting time is infinite.\n        if lambda_rate > 0:\n            expected_time = 1.0 / lambda_rate\n        else:\n            expected_time = np.inf\n            \n        results.append(expected_time)\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) correctly handles converting np.inf to the string 'inf'.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2854191"}]}