{"hands_on_practices": [{"introduction": "进化免疫学中的一项基本任务是量化作用于基因上的选择压力。非同义替换率 ($d_N$) 与同义替换率 ($d_S$) 之比是实现这一目标的有力指标，它使我们能够区分驱动适应的正选择和维持功能的纯化选择。本练习将指导您计算和解释主要组织相容性复合体 (MHC) 基因特定区域的 $d_N/d_S$ 值，这是宿主-病原体协同进化的经典案例。[@problem_id:2842372]", "problem": "在许多脊椎动物中，主要组织相容性复合体（MHC）的肽结合区是宿主-病原体协同进化的一个焦点。考虑一个MHC II类基因，其来自两个亲缘关系很近的灵长类物种的直系同源编码序列比对被划分为肽结合区（PBR）和非肽结合区的其余部分（non-PBR）。设 $d_N$ 表示每个非同义位点的非同义替换数， $d_S$ 表示每个同义位点的同义替换数。假设序列分歧足够低，可以忽略多次突变的影响，因此将观察到的固定差异数除以相应位点类别的数量是 $d_N$ 和 $d_S$ 的一个合适的估计量。给你以下每个区域的数据：\n- PBR：非同义位点 $L_N = 420$，同义位点 $L_S = 180$，观察到的固定非同义差异 $N = 58$，观察到的固定同义差异 $S = 6$。\n- Non-PBR：非同义位点 $L_N = 2880$，同义位点 $L_S = 960$，观察到的固定非同义差异 $N = 35$，观察到的固定同义差异 $S = 20$。\n\n仅使用核心定义（非同义与同义，以及每位点的替换数），计算出各区域特定的 $d_N/d_S$ 值，并在比较与进化免疫学的背景下，解释每个区域的结果与哪种选择模式最为一致。对于你最终报告的数值，计算以下比率\n$$\nR \\equiv \\frac{(d_N/d_S)_{\\mathrm{PBR}}}{(d_N/d_S)_{\\mathrm{non\\text{-}PBR}}}.\n$$\n将你计算出的 $R$ 的最终答案四舍五入到三位有效数字。不要在最终报告值中包含任何单位。", "solution": "所给出的问题是分子进化中的一个标准练习，要求计算和解释非同义替换率与同义替换率的比值。这个问题有科学依据，提法明确，并包含了所有必要的信息。因此，我将着手解答。\n\n问题的核心在于通过比较非同义替换率（$d_N$）和同义替换率（$d_S$）来分析作用于基因不同区域的选择压力。替换率 $d_S$ 是每个同义位点（$L_S$）的同义替换数（$S$），它可作为中性进化条件下突变率的基线估计，因为这些替换不改变氨基酸序列，因此在很大程度上不受自然选择的影响。替换率 $d_N$ 是每个非同义位点（$L_N$）的非同义替换数（$N$）。\n\n根据问题陈述，我们使用一个简单的估计量，即替换率等于观察到的差异数除以位点数。\n对于基因的任何给定区域，这些比率定义如下：\n$$\nd_N = \\frac{N}{L_N}\n$$\n$$\nd_S = \\frac{S}{L_S}\n$$\n比率 $\\omega = d_N/d_S$ 是判断作用于蛋白质编码序列的选择模式的一个经典指标。$\\omega = 1$ 表明是中性进化，即非同义突变与同义突变以相同的速率被固定。$\\omega < 1$ 表明是纯化（或负）选择，即非同义突变是有害的，并会从群体中被清除。$\\omega > 1$ 则是正向（或多样性）选择的强有力信号，表明非同义突变是有利的，并以比中性突变更高的速率被驱动至固定。\n\n首先，我们分析肽结合区（PBR）。PBR的已知数据如下：\n- 非同义位点, $L_{N, \\mathrm{PBR}} = 420$\n- 同义位点, $L_{S, \\mathrm{PBR}} = 180$\n- 非同义差异, $N_{\\mathrm{PBR}} = 58$\n- 同义差异, $S_{\\mathrm{PBR}} = 6$\n\n我们计算PBR的替换率：\n$$\n(d_N)_{\\mathrm{PBR}} = \\frac{N_{\\mathrm{PBR}}}{L_{N, \\mathrm{PBR}}} = \\frac{58}{420}\n$$\n$$\n(d_S)_{\\mathrm{PBR}} = \\frac{S_{\\mathrm{PBR}}}{L_{S, \\mathrm{PBR}}} = \\frac{6}{180} = \\frac{1}{30}\n$$\n现在，我们计算比率 $\\omega_{\\mathrm{PBR}} = (d_N/d_S)_{\\mathrm{PBR}}$：\n$$\n\\omega_{\\mathrm{PBR}} = \\frac{(d_N)_{\\mathrm{PBR}}}{(d_S)_{\\mathrm{PBR}}} = \\frac{58/420}{1/30} = \\frac{58}{420} \\times 30 = \\frac{58}{14} = \\frac{29}{7}\n$$\n数值上，$\\omega_{\\mathrm{PBR}} \\approx 4.14$。由于这个值显著大于1，它表明存在强烈的正向选择。这对于MHC基因的PBR来说是预期的结果。该区域直接参与结合并呈递来自病原体的肽段。宿主-病原体的协同进化产生了巨大的选择压力，迫使宿主识别多样化且不断变化的病原体肽谱，这驱动了PBR中新氨基酸变异的快速进化。\n\n接下来，我们分析非肽结合区（non-PBR）。该区域的已知数据如下：\n- 非同义位点, $L_{N, \\text{non-PBR}} = 2880$\n- 同义位点, $L_{S, \\text{non-PBR}} = 960$\n- 非同义差异, $N_{\\text{non-PBR}} = 35$\n- 同义差异, $S_{\\text{non-PBR}} = 20$\n\n我们计算non-PBR的替换率：\n$$\n(d_N)_{\\text{non-PBR}} = \\frac{N_{\\text{non-PBR}}}{L_{N, \\text{non-PBR}}} = \\frac{35}{2880}\n$$\n$$\n(d_S)_{\\text{non-PBR}} = \\frac{S_{\\text{non-PBR}}}{L_{S, \\text{non-PBR}}} = \\frac{20}{960} = \\frac{1}{48}\n$$\n现在，我们计算比率 $\\omega_{\\text{non-PBR}} = (d_N/d_S)_{\\text{non-PBR}}$：\n$$\n\\omega_{\\text{non-PBR}} = \\frac{(d_N)_{\\text{non-PBR}}}{(d_S)_{\\text{non-PBR}}} = \\frac{35/2880}{1/48} = \\frac{35}{2880} \\times 48 = \\frac{35 \\times 48}{2880}\n$$\n注意到 $2880 = 60 \\times 48$，计算可简化为：\n$$\n\\omega_{\\text{non-PBR}} = \\frac{35}{60} = \\frac{7}{12}\n$$\n数值上，$\\omega_{\\text{non-PBR}} \\approx 0.583$。由于这个值小于1，它表明存在纯化选择。这也是预期的结果。MHC分子的非PBR部分具有必须被保守的关键结构和信号传导功能。这些区域大多数的氨基酸变化可能是有害的，会破坏蛋白质的整体结构或其与免疫系统其他组分（如T细胞受体或CD4共受体）的相互作用，因此会受到负选择。\n\n最后，问题要求计算比率 $R$，该比率对比了PBR与non-PBR中所受选择压力的强度。\n$$\nR \\equiv \\frac{(d_N/d_S)_{\\mathrm{PBR}}}{(d_N/d_S)_{\\mathrm{non\\text{-}PBR}}} = \\frac{\\omega_{\\mathrm{PBR}}}{\\omega_{\\text{non-PBR}}}\n$$\n代入我们计算出的精确分数值：\n$$\nR = \\frac{29/7}{7/12} = \\frac{29}{7} \\times \\frac{12}{7} = \\frac{29 \\times 12}{7 \\times 7} = \\frac{348}{49}\n$$\n为了得到最终的数值答案，我们进行除法运算，并按要求四舍五入到三位有效数字。\n$$\nR = \\frac{348}{49} \\approx 7.1020408...\n$$\n四舍五入到三位有效数字得到 $7.10$。\n这个较大的 $R$ 值定量地表明，作用于MHC蛋白不同功能域的选择压力存在巨大差异，肽结合区在强正向选择下进化，其速率（就 $\\omega$ 比率而言）比功能上受约束的non-PBR区域的背景速率快7倍以上。", "answer": "$$\n\\boxed{7.10}\n$$", "id": "2842372"}, {"introduction": "中枢耐受是防止免疫系统攻击自身组织的关键过程，其失败可导致自身免疫。本实践问题超越了序列数据分析，从自身免疫调节因子 (Aire) 的功能出发，自下而上地构建中枢耐受的定量模型。通过推导自身免疫风险的表达式，您将培养应用随机模型的能力，将分子水平的事件（如胸腺中的抗原呈递）与生物体水平的结局联系起来。[@problem_id:2842341]", "problem": "在脊椎动物中，中枢耐受是在胸腺中通过负选择过程实现的，该过程会删除其T细胞受体（TCR）与自身肽-主要组织相容性复合体（MHC）复合物强力结合的胸腺细胞。由胸腺髓质上皮细胞表达的自身免疫调节因子（Aire）能诱导组织限制性抗原（TRA）的混杂表达，从而使这些抗原能够呈递给发育中的T细胞。考虑两个亲缘关系很近的哺乳动物物种，它们在所有胸腺选择参数上均相同，唯一的区别是B物种表达Aire的相对水平为 $A \\in (0,1]$，而A物种的水平为 $A = 1$。假设以下建模假设，这些假设基于胸腺选择原理以及广泛应用的对抗原呈递和T细胞扫描的随机性描述：\n\n1. 对于一个代表性抗原呈递细胞（APC）上的给定TRA，可用于触发删除的识别性肽-MHC复合物的数量是一个泊松随机变量，其均值为 $\\mu(A) = \\mu_{0} A$，其中 $\\mu_{0}$ 是野生型Aire（$A=1$）下的均值。\n2. 在可被负选择的时间窗口内，一个发育中的胸腺细胞会与不同的APC进行 $M$ 次独立的连续接触。在任何一次接触中，如果存在至少一个针对该克隆自身表位的识别性肽-MHC复合物，则由于信号传导的可变性，删除会以概率 $\\sigma \\in (0,1)$ 被触发；否则，该克隆在这次接触中不被删除。\n3. 在一批 $T$ 个不同的选择前胸腺细胞克隆中，对任何单个特定TRA表位具有特异性（并可能具有自身反应性）的克隆比例 $f$ 很小，并且存在 $N$ 个不同的、不重叠的TRA，它们的中枢耐受主要依赖于Aire。你可以假设 $N f \\ll 1$，因此在此尺度上双重特异性可以忽略不计，并且稀有事件的独立性近似适用于所有克隆和TRA。\n\n任务：\na) 从这些假设和负选择的定义出发，推导B物种中自身免疫风险 $R(A)$ 的闭式表达式，该风险定义为至少有一个针对 $N$ 个TRA中任何一个的自身反应性克隆逃脱负选择的概率。表达式需用 $A$、$\\mu_{0}$、 $M$、 $\\sigma$、 $T$、 $N$ 和 $f$ 表示。\n\nb) 使用你推导的表达式，当 $A = \\frac{1}{2}$ 时，利用以下在这些物种间被认为是保守的经验上合理的参数来计算B物种的 $R(A)$：$\\mu_{0} = 0.02$, $M = 800$, $\\sigma = 0.4$, $T = 10^{6}$, $N = 10^{3}$ 以及 $f = 5 \\times 10^{-9}$。将 $R\\!\\left(\\tfrac{1}{2}\\right)$ 的最终数值以无单位小数的形式报告，并四舍五入到四位有效数字。", "solution": "问题陈述是连贯的，并且基于免疫学和随机建模的既定原理。假设陈述清晰，可以进行严格的推导。该问题是有效的。我们按要求分两部分进行求解。\n\na) 自身免疫风险 $R(A)$ 的推导。\n\n推导过程首先计算单个自身反应性胸腺细胞逃脱负选择的概率，然后将此风险汇总到整个相关的T细胞库中。\n\n让我们考虑一个针对 $N$ 个组织限制性抗原（TRA）之一的单个自身反应性胸腺细胞克隆。\n根据假设1，单个抗原呈递细胞（APC）上的识别性肽-MHC（pMHC）复合物数量 $K$ 服从均值为 $\\mu(A) = \\mu_0 A$ 的泊松分布。其概率质量函数为 $P(K=k) = \\frac{\\exp(-\\mu_0 A)(\\mu_0 A)^k}{k!}$。\n\n一个APC呈递零个识别性pMHC复合物的概率是：\n$$ P(K=0) = \\exp(-\\mu_0 A) $$\n一个APC呈递至少一个识别性pMHC复合物的概率是：\n$$ P(K \\geq 1) = 1 - P(K=0) = 1 - \\exp(-\\mu_0 A) $$\n根据假设2，在与APC的单次相遇中，胸腺细胞的删除只有在 $K \\geq 1$ 时才会发生。如果 $K \\geq 1$，删除以概率 $\\sigma$ 被触发。因此，如果 $K=0$（无信号），或者如果 $K \\geq 1$ 且删除信号失败（概率为 $1-\\sigma$），胸腺细胞在这次相遇中*不会*被删除。\n\n一个胸腺细胞在与APC单次相遇中不被删除的概率，记为 $p_{nd,1}$，是这两个互斥事件的概率之和：\n$$ p_{nd,1} = P(K=0) + P(K \\geq 1) \\times (1-\\sigma) $$\n代入从泊松分布推导出的表达式：\n$$ p_{nd,1} = \\exp(-\\mu_0 A) + (1 - \\exp(-\\mu_0 A))(1-\\sigma) $$\n$$ p_{nd,1} = \\exp(-\\mu_0 A) + 1 - \\sigma - \\exp(-\\mu_0 A) + \\sigma \\exp(-\\mu_0 A) $$\n$$ p_{nd,1} = 1 - \\sigma + \\sigma \\exp(-\\mu_0 A) = 1 - \\sigma(1 - \\exp(-\\mu_0 A)) $$\n一个胸腺细胞会经历 $M$ 次这样的独立相遇。为了使该克隆逃脱负选择，它必须在所有 $M$ 次相遇中都存活下来。因此，单个自身反应性克隆的逃脱概率 $P_{\\text{esc,clone}}$ 为：\n$$ P_{\\text{esc,clone}} = (p_{nd,1})^M = \\left[ 1 - \\sigma(1 - \\exp(-\\mu_0 A)) \\right]^M $$\n自身免疫风险 $R(A)$ 是至少有一个自身反应性克隆逃脱负选择的概率。选择前的胸腺细胞克隆总数为 $T$。对单个TRA具有特异性的克隆比例为 $f$。存在 $N$ 个这样的TRA。跨越所有 $N$ 个TRA的潜在自身反应性克隆总数为 $N \\times T \\times f$。\n这些克隆中任何一个的逃脱概率 $P_{\\text{esc,clone}}$ 是一个很小的值。而这类克隆的数量 $N T f$ 可能很大。逃脱的克隆数量可以用泊松分布进行建模，其合理性在于克隆的独立性（假设 $Nf \\ll 1$）和逃脱事件的稀有性。\n\n这个泊松分布的均值（或参数 $\\lambda$），代表逃脱的自身反应性克隆的期望数量，为：\n$$ \\lambda_{\\text{total}} = (\\text{潜在自身反应性克隆总数}) \\times (\\text{每个克隆的逃脱概率}) $$\n$$ \\lambda_{\\text{total}} = (N T f) \\times P_{\\text{esc,clone}} $$\n$$ \\lambda_{\\text{total}} = N T f \\left[ 1 - \\sigma(1 - \\exp(-\\mu_0 A)) \\right]^M $$\n风险 $R(A)$ 是逃脱克隆数至少为一个的概率。对于均值为 $\\lambda$ 的泊松分布随机变量 $X$，有 $P(X \\geq 1) = 1 - P(X=0) = 1 - \\exp(-\\lambda)$。\n因此，自身免疫风险为：\n$$ R(A) = 1 - \\exp(-\\lambda_{\\text{total}}) $$\n代入 $\\lambda_{\\text{total}}$ 的表达式，我们得到自身免疫风险的最终闭式表达式：\n$$ R(A) = 1 - \\exp\\left(-N T f \\left[1 - \\sigma\\left(1 - \\exp(-\\mu_0 A)\\right)\\right]^M\\right) $$\n\nb) 对给定参数计算 $R(A)$。\n\n题目要求我们当 $A = \\frac{1}{2}$ 时，使用以下参数计算 $R(A)$：$\\mu_{0} = 0.02$, $M = 800$, $\\sigma = 0.4$, $T = 10^{6}$, $N = 10^{3}$ 以及 $f = 5 \\times 10^{-9}$。\n\n首先，我们计算内部指数项的指数：\n$$ \\mu_0 A = (0.02) \\times \\left(\\frac{1}{2}\\right) = 0.01 $$\n接下来，我们计算单次相遇中不被删除的概率 $p_{nd,1}$：\n$$ p_{nd,1} = 1 - \\sigma(1 - \\exp(-\\mu_0 A)) = 1 - 0.4(1 - \\exp(-0.01)) $$\n这可以重写为 $0.6 + 0.4 \\exp(-0.01)$。\n使用 $\\exp(-0.01) \\approx 0.99004983$：\n$$ p_{nd,1} \\approx 0.6 + 0.4 \\times 0.99004983 = 0.6 + 0.39601993 = 0.99601993 $$\n现在，我们计算单个克隆的逃脱概率 $P_{\\text{esc,clone}}$：\n$$ P_{\\text{esc,clone}} = (p_{nd,1})^M = (0.99601993)^{800} $$\n取自然对数：\n$$ \\ln(P_{\\text{esc,clone}}) = 800 \\ln(0.99601993) \\approx 800 \\times (-0.00398807) \\approx -3.190456 $$\n$$ P_{\\text{esc,clone}} = \\exp(-3.190456) \\approx 0.0411516 $$\n接下来，我们计算逃脱克隆的平均数 $\\lambda_{\\text{total}}$。首先，我们求出相关克隆的总数：\n$$ N T f = (10^3) \\times (10^6) \\times (5 \\times 10^{-9}) = 5 $$\n所以，$\\lambda_{\\text{total}} = 5 \\times P_{\\text{esc,clone}}$：\n$$ \\lambda_{\\text{total}} \\approx 5 \\times 0.0411516 = 0.205758 $$\n最后，我们计算自身免疫风险 $R(\\frac{1}{2})$：\n$$ R\\!\\left(\\frac{1}{2}\\right) = 1 - \\exp(-\\lambda_{\\text{total}}) \\approx 1 - \\exp(-0.205758) $$\n$$ R\\!\\left(\\frac{1}{2}\\right) \\approx 1 - 0.8140321 = 0.1859679 $$\n按要求将结果四舍五入到四位有效数字：\n$$ R\\!\\left(\\frac{1}{2}\\right) \\approx 0.1860 $$\n这表明，对于一个Aire水平降低了50%的B物种个体，针对这组 $N$ 个依赖Aire的抗原，存在大约 $18.6\\%$ 的概率，至少有一个自身反应性T细胞克隆会逃脱中枢耐受。", "answer": "$$\\boxed{0.1860}$$", "id": "2842341"}, {"introduction": "不同物种进化出了产生免疫受体多样性的独特机制。这项高级练习将挑战您扮演一名计算生物学家，区分鸟类抗体多样化的两种竞争性假说：模板化的基因转换与随机点突变。您将为每个模型推导概率分布，并构建一个似然比检验——这是现代定量生物学中至关重要的复杂统计工具——以评估来自序列数据的证据。[@problem_id:2842385]", "problem": "设计一个程序，该程序能够接收鸟类免疫球蛋白 (Ig) 轻链多样化过程中的序列段长度数据，并利用序列段长度分布，实现一个基于原则的似然比检验，用以区分模板化基因转换和独立点突变。你的推导应基于下列比较免疫学、演化免疫学以及概率论中基础且经过充分检验的原理：\n- 在鸟类中，模板化基因转换会引入从供体片段复制而来的连续错配序列段。复制的持续性可建模为沿脱氧核糖核酸 (DNA) 序列的无记忆终止过程。\n- 独立点突变在整个比对区域内近似为位点独立的事件，每个位点的突变概率为 $p$，错配的连续性仅由偶然的邻接产生。\n\n基于这些基础，进行数学推导：\n1. 在纯点突变模型 $\\mathcal{M}_0$（每个位点上发生概率为 $p$ 的独立伯努利突变）下，推导以一个游程的开始为条件时，连续突变位点游程的长度 $L$ 的概率质量函数，并将其表达为 $p$ 的函数。仅使用独立性假设来获取该分布，并用 $p$ 来表示。\n2. 在模板化基因转换模型 $\\mathcal{M}_1$ 下，假设转换序列段具有一个无记忆终止机制。仅使用无记忆假设，推导序列段长度 $L$ 的概率质量函数，该函数包含一个参数 $r \\in (0,1)$，它决定了每个位置上的终止概率以及相应的平均序列段长度。\n3. 给定一个观测到的序列段长度列表 $\\{ \\ell_i \\}_{i=1}^n$，展示如何在 $\\mathcal{M}_0$ 模型下计算对数似然。其中，参数 $p$ 从全序列数据中估计得出，即 $\\hat p = M/N$，这里 $M = \\sum_{i=1}^n \\ell_i$ 是突变位置的总数，$N$ 是数据集中所有序列的总比对位置数。使用在第1部分中推导出的 $\\mathcal{M}_0$ 模型下的序列段长度分布。\n4. 在 $\\mathcal{M}_1$ 模型下，推导参数 $r$ 的最大似然估计量，并用样本均值 $\\bar L = \\frac{1}{n}\\sum_{i=1}^n \\ell_i$ 表示。然后，引入一个有生物学依据的单边备择假设，即模板化基因转换的平均序列段长度至少为 $L_{\\min}$，这实现为一个边界条件 $r \\leq 1/L_{\\min}$。定义受约束的最大似然估计 $\\hat r^\\star = \\min\\{ \\hat r,\\, 1/L_{\\min} \\}$，并计算在 $\\hat r^\\star$ 处 $\\mathcal{M}_1$ 模型下的对数似然。\n5. 定义对数似然比统计量\n$$\n\\Lambda = 2 \\left[ \\log \\mathcal{L}_1(\\hat r^\\star \\mid \\{\\ell_i\\}) \\;-\\; \\log \\mathcal{L}_0(\\hat p \\mid \\{\\ell_i\\}) \\right],\n$$\n并使用自由度为1的渐近卡方参考分布，在显著性水平 $\\alpha = 0.05$ 下，判断应选择模板化基因转换还是点突变模型。为每种情况报告一个布尔决策：若 $\\Lambda \\geq 3.841458820694124$ 则为 $\\,\\text{True}$，否则为 $\\,\\text{False}$。\n\n强制执行的实现细节：\n- 所有对数必须是自然对数。\n- 如果任何参数估计可能导致数值问题（例如 $\\log 0$），请使用与推导公式一致的标准极限方法，或将参数限制在 $(\\varepsilon, 1-\\varepsilon)$ 范围内（其中 $\\varepsilon$ 是一个非常小的数），以确保所得似然是恰当的连续极限。\n\n使用以下测试套件。对于每个测试用例 $j$，输入为一个序对 $(N^{(j)}, \\mathcal{L}^{(j)})$，其中 $N^{(j)}$ 是检查的所有序列的比对位置总数，$\\mathcal{L}^{(j)}$ 是观测到的序列段长度列表：\n- 测试用例 1: $N^{(1)} = 5000$, $\\mathcal{L}^{(1)} = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2]$。\n- 测试用例 2: $N^{(2)} = 10000$, $\\mathcal{L}^{(2)} = [12,15,9,21,8,17,10,14]$。\n- 测试用例 3: $N^{(3)} = 100$, $\\mathcal{L}^{(3)} = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]$。\n- 测试用例 4: $N^{(4)} = 8000$, $\\mathcal{L}^{(4)} = [1,1,3,1,2,1,5,1,1,2,4,1,1]$。\n- 测试用例 5: $N^{(5)} = 10000$, $\\mathcal{L}^{(5)} = [1]$。\n\n所有测试的通用参数：\n- 模板化转换的最小平均序列段长度：$L_{\\min} = 3$。\n- 显著性水平：$\\alpha = 0.05$，自由度为1的卡方临界值：$3.841458820694124$。\n\n你的程序应生成单行输出，其中包含五个测试用例的布尔决策，形式为用方括号括起来的逗号分隔列表（例如，“[True,False,True,False,True]”）。", "solution": "该问题陈述已经过严格评估，被认为是有效的。它在科学上基于演化免疫学的既定原则，特别是鸟类抗体多样化的机制。它在数学上是适定的，为获得唯一解提供了明确的目标以及一套完整、自洽的定义、数据和约束。其语言客观且无歧义。因此，我们将继续进行推导和求解。\n\n任务是构建一个似然比检验，以区分两种体细胞突变模型：独立点突变（$\\mathcal{M}_0$）和模板化基因转换（$\\mathcal{M}_1$）。这需要推导每种模型下突变序列段长度的概率分布、建立相应的似然函数，并构建检验统计量。\n\n**1. 点突变模型 $\\mathcal{M}_0$ 的概率质量函数**\n\n在模型 $\\mathcal{M}_0$ 下，每个位点上的突变都是成功概率为 $p$ 的独立伯努利试验。我们需要求解的是，在给定一个游程开始的条件下，突变位点游程长度 $L$ 的概率质量函数（PMF）。设长度为 $L=k$ 的游程是一个事件，其中 $k$ 个连续位点发生突变，且该序列段由一个非突变位点终止。一个游程的开始意味着我们已经观察到一个突变位点。要使游程长度为 $k$，我们必须观察到 $k-1$ 个额外的连续突变，随后是一个非突变。鉴于位点的独立性，这一系列事件的概率是它们各自概率的乘积：$p^{k-1}(1-p)$。这为游程长度 $k \\in \\{1, 2, \\dots\\}$ 定义了一个几何分布。\n\n因此，在 $\\mathcal{M}_0$ 模型下，一个游程的长度 $L$ 的概率质量函数为：\n$$\nP_0(L=k \\mid p) = p^{k-1}(1-p)\n$$\n\n**2. 基因转换模型 $\\mathcal{M}_1$ 的概率质量函数**\n\n在模型 $\\mathcal{M}_1$ 下，一个模板化基因转换序列段是通过一个无记忆终止过程形成的。设 $r \\in (0,1)$ 是在序列上任意给定位置终止转换的恒定概率。如果该过程连续进行了 $k-1$ 步，然后在第 $k$ 步终止，则形成一个长度为 $L=k$ 的序列段。在任何一步继续（不终止）的概率是 $1-r$。由于无记忆性，观察到 $k-1$ 次连续和一次终止的概率是一系列独立事件的乘积。\n\n在 $\\mathcal{M}_1$ 模型下，序列段长度 $L$ 的概率质量函数也是一个几何分布：\n$$\nP_1(L=k \\mid r) = (1-r)^{k-1}r\n$$\n该分布的平均序列段长度为 $\\mathbb{E}[L] = 1/r$。\n\n**3. 模型 $\\mathcal{M}_0$ 的对数似然**\n\n给定一组 $n$ 个观测到的独立序列段长度 $\\{\\ell_i\\}_{i=1}^n$，在 $\\mathcal{M}_0$ 模型下的似然函数是观察到每个长度的概率的乘积：\n$$\n\\mathcal{L}_0(p \\mid \\{\\ell_i\\}) = \\prod_{i=1}^n P_0(L=\\ell_i \\mid p) = \\prod_{i=1}^n p^{\\ell_i-1}(1-p)\n$$\n对数似然 $\\log \\mathcal{L}_0$ 在计算上更为方便：\n$$\n\\log \\mathcal{L}_0 = \\sum_{i=1}^n \\log\\left(p^{\\ell_i-1}(1-p)\\right) = \\sum_{i=1}^n \\left( (\\ell_i-1)\\log p + \\log(1-p) \\right)\n$$\n令 $M = \\sum_{i=1}^n \\ell_i$ 为突变位点的总数。表达式可简化为：\n$$\n\\log \\mathcal{L}_0 = \\left(\\sum_{i=1}^n (\\ell_i-1)\\right)\\log p + n\\log(1-p) = (M-n)\\log p + n\\log(1-p)\n$$\n我们使用为 $p$ 提供的估计量 $\\hat p = M/N$ 来评估此对数似然，其中 $N$ 是总比对位置数：\n$$\n\\log \\mathcal{L}_0(\\hat p \\mid \\{\\ell_i\\}) = (M-n)\\log\\left(\\frac{M}{N}\\right) + n\\log\\left(1 - \\frac{M}{N}\\right)\n$$\n\n**4. 模型 $\\mathcal{M}_1$ 的最大似然估计与对数似然**\n\n类似地，$\\mathcal{M}_1$ 的对数似然函数为：\n$$\n\\log \\mathcal{L}_1(r \\mid \\{\\ell_i\\}) = (M-n)\\log(1-r) + n\\log r\n$$\n为了找到最大似然估计量（MLE）$\\hat r$，我们对 $r$ 求导并令其为零：\n$$\n\\frac{d}{dr}\\log \\mathcal{L}_1 = -\\frac{M-n}{1-r} + \\frac{n}{r} = 0 \\implies n(1-r) = r(M-n) \\implies n = Mr \\implies \\hat r = \\frac{n}{M}\n$$\n用样本平均序列段长度 $\\bar L = M/n$ 表示，MLE 为 $\\hat r = 1/\\bar L$。\n\n题目引入了一个有生物学动机的约束，即平均序列段长度必须至少为 $L_{\\min}$，这意味着 $1/r \\ge L_{\\min}$，或 $r \\le 1/L_{\\min}$。受约束的 MLE $\\hat r^\\star$ 是在 $[0, 1/L_{\\min}]$ 区间内使似然最大化的值。其表达式为：\n$$\n\\hat r^\\star = \\min(\\hat r, 1/L_{\\min}) = \\min(n/M, 1/L_{\\min})\n$$\n然后，在 $\\hat r^\\star$ 处评估 $\\mathcal{M}_1$ 的对数似然：\n$$\n\\log \\mathcal{L}_1(\\hat r^\\star \\mid \\{\\ell_i\\}) = (M-n)\\log(1-\\hat r^\\star) + n\\log(\\hat r^\\star)\n$$\n\n**5. 对数似然比检验**\n\n定义对数似然比统计量 $\\Lambda$ 来比较两种模型的拟合优度：\n$$\n\\Lambda = 2 \\left[ \\log \\mathcal{L}_1(\\hat r^\\star \\mid \\{\\ell_i\\}) - \\log \\mathcal{L}_0(\\hat p \\mid \\{\\ell_i\\}) \\right]\n$$\n根据 Wilks 定理，在原假设（$\\mathcal{M}_0$）下，$\\Lambda$ 渐近服从卡方（$\\chi^2$）随机变量分布。由于模型 $\\mathcal{M}_1$ 有一个自由参数（$r$）是从被检验的数据中估计的，而模型 $\\mathcal{M}_0$ 的参数 $p$ 是使用外部信息（$N$）估计的，因此自由度为1。\n\n决策规则是，如果 $\\Lambda$ 超过显著性水平为 $\\alpha = 0.05$ 的 $\\chi^2_1$ 分布的临界值，则拒绝 $\\mathcal{M}_0$ 而支持 $\\mathcal{M}_1$。该临界值给定为 $3.841458820694124$。每个测试用例的决策为：若 $\\Lambda \\geq 3.841458820694124$ 则为 $\\text{True}$，否则为 $\\text{False}$。实现将使用推导出的公式为每个测试用例计算 $\\Lambda$，并应用此决策规则。", "answer": "```python\nimport numpy as np\n\ndef _solve_case(N, tract_lengths, L_min, chi_sq_crit):\n    \"\"\"\n    Performs the likelihood-ratio test for a single case.\n\n    Args:\n        N (int): Total number of aligned positions.\n        tract_lengths (list): List of observed tract lengths.\n        L_min (float): Minimum mean tract length for gene conversion.\n        chi_sq_crit (float): Chi-square critical value for the test.\n\n    Returns:\n        bool: True if templated gene conversion is favored, False otherwise.\n    \"\"\"\n    n = len(tract_lengths)\n    \n    # If there are no observed tracts, the null model cannot be rejected.\n    if n == 0:\n        return False\n        \n    M = sum(tract_lengths)\n    \n    # --- Log-Likelihood for Null Model M_0 (Point Mutation) ---\n    # The PMF for tract length L is P(L=k | p) = p^(k-1) * (1-p).\n    # The log-likelihood is log L_0 = (M-n)*log(p) + n*log(1-p).\n    # The parameter p is estimated as p_hat = M/N.\n    \n    p_hat = M / N\n    \n    # Handle edge cases for p_hat to avoid log(0).\n    if p_hat == 0.0:\n        # Occurs if M=0, so n=0. Handled above, but for formal correctness.\n        # log L_0 = 0 in this case.\n        log_L0 = 0.0\n    elif p_hat == 1.0:\n        # P(data | M_0) = 0, so log-likelihood is negative infinity.\n        # This implies the data is impossible under the null model.\n        log_L0 = -np.inf\n    else:\n        log_L0 = (M - n) * np.log(p_hat) + n * np.log(1 - p_hat)\n        \n    # --- Log-Likelihood for Alternative Model M_1 (Gene Conversion) ---\n    # The PMF for tract length L is P(L=k | r) = (1-r)^(k-1) * r.\n    # The log-likelihood is log L_1 = (M-n)*log(1-r) + n*log(r).\n    # The MLE for r is r_hat = n/M = 1/L_bar.\n    \n    r_hat = n / M\n    \n    # Apply the constraint r <= 1/L_min to get the constrained MLE r_hat_star.\n    r_hat_star = min(r_hat, 1.0 / L_min)\n    \n    # Given L_min > 1 and M >= n >= 1, r_hat_star will be in (0, 1),\n    # so we do not expect log(0) issues here.\n    log_L1 = (M - n) * np.log(1.0 - r_hat_star) + n * np.log(r_hat_star)\n    \n    # --- Log-Likelihood Ratio Test ---\n    # Lambda = 2 * (log_L1 - log_L0)\n    # The statistic is compared to a chi-square distribution with 1 df.\n    \n    lambda_stat = 2.0 * (log_L1 - log_L0)\n    \n    return lambda_stat >= chi_sq_crit\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis on all test cases and print the result.\n    \"\"\"\n    # Test cases: (N, list_of_tract_lengths)\n    test_cases = [\n        (5000, [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2]),\n        (10000, [12,15,9,21,8,17,10,14]),\n        (100, [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),\n        (8000, [1,1,3,1,2,1,5,1,1,2,4,1,1]),\n        (10000, [1]),\n    ]\n    \n    # Common parameters from the problem statement.\n    L_min = 3.0\n    alpha = 0.05\n    chi_sq_crit_1df = 3.841458820694124\n    \n    results = []\n    for N, L_list in test_cases:\n        decision = _solve_case(N, L_list, L_min, chi_sq_crit_1df)\n        results.append(decision)\n        \n    # Print the final output in the required format: [res1,res2,...]\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the main function.\nsolve()\n```", "id": "2842385"}]}