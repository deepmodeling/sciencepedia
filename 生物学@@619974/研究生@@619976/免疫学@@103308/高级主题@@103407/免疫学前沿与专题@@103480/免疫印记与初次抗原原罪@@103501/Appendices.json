{"hands_on_practices": [{"introduction": "免疫印记的概念首先需要被量化才能进行深入研究。本练习将引导你使用病毒学中的经典方法——血凝抑制（HI）试验——来处理典型的血清学数据 [@problem_id:2856748]。你将学习如何将原始的滴度倍比稀释数据通过对数转换（$\\log_{2}$）为“倍增步数”，从而计算出一个明确的指标，用以衡量加强免疫后，机体对印记亚型和疫苗匹配亚型的免疫应答强弱偏向。这个实践将帮助你掌握量化“原始抗原罪”现象的核心技能。", "problem": "一名成年个体，其儿童早期有记录的首次流感感染为H3亚型（最初的印记亚型），接种了与当前流行的H1抗原相匹配的三价灭活流感疫苗。为了量化免疫印记和抗原原罪（OAS）现象，我们使用血凝抑制（HI；Hemagglutination Inhibition）试验来考查疫苗接种后血清学增强在一组抗原中的分配情况。\n\n基本事实：\n- HI滴度定义为能够抑制血凝反应的最高血清稀释倍数的倒数，并通过两倍系列稀释法进行测量。因此，如果对于某一给定抗原，接种后滴度相对于接种前滴度增加了$k$倍，那么这一变化可以表示为$\\log_{2}(k)$个“两倍步长”。\n- 将各抗原经$\\log_{2}$转换的倍数变化相加，适合用来量化总增长，因为两倍滴定步长在对数尺度上是累加的。\n\n现提供某一个体在疫苗接种前后的HI滴度测量值如下：\n- 最初印记亚型组（三种不同的H3抗原）：\n  - 抗原Alpha：接种前$40$，接种后$320$。\n  - 抗原Beta：接种前$20$，接种后$160$。\n  - 抗原Gamma：接种前$10$，接种后$40$。\n- 疫苗匹配抗原（疫苗中包含的当前H1抗原）：\n  - 抗原V：接种前$20$，接种后$80$。\n\n定义“印记集中比”$R$来操作化衡量接种后滴度增长集中于最初印记亚型与集中于疫苗匹配亚型的程度，具体方法如下：\n1. 对每种抗原，通过计算$\\log_{2}\\!\\big(\\text{post}/\\text{pre}\\big)$将其接种前后的变化转换为两倍步长。\n2. 设$\\Delta I$为印记亚型组（Alpha、Beta、Gamma）中这些两倍步长的总和。\n3. 设$\\Delta V$为疫苗匹配抗原（V）的两倍步长。\n4. 计算$R$，即印记组的总两倍步长与疫苗匹配抗原的两倍步长之比，即$R = \\Delta I / \\Delta V$。\n\n根据以上数据计算$R$。最终答案以小数形式表示，并四舍五入至四位有效数字。答案中不要包含单位或百分号。", "solution": "问题陈述已经过验证，被认为是科学上合理、定义明确且客观的。它提供了一个清晰的定量定义和计算所需指标的所有必要数据。我们现在开始求解。\n\n问题要求计算“印记集中比”，记为$R$。该比率量化了针对印记抗原亚型与针对疫苗匹配抗原亚型的血清学反应的相对强度。该方法基于血凝抑制（HI）滴度，该滴度通过两倍系列稀释法测量。滴度变化$k$倍在对数尺度上可以恰当地表示为$\\log_{2}(k)$个“两倍步长”。\n\n首先，我们定义每种抗原在两倍步长上的变化。设$T_{pre}$为接种前HI滴度，$T_{post}$为接种后HI滴度。单个抗原的两倍步长变化$\\Delta$由下式给出：\n$$\n\\Delta = \\log_{2}\\left(\\frac{T_{post}}{T_{pre}}\\right)\n$$\n\n我们使用所提供的数据，将此公式应用于每种抗原。\n\n对于印记亚型组（H3抗原）：\n1.  抗原Alpha：$T_{pre} = 40$， $T_{post} = 320$。\n    $$\n    \\Delta_{Alpha} = \\log_{2}\\left(\\frac{320}{40}\\right) = \\log_{2}(8) = \\log_{2}(2^{3}) = 3\n    $$\n2.  抗原Beta：$T_{pre} = 20$， $T_{post} = 160$。\n    $$\n    \\Delta_{Beta} = \\log_{2}\\left(\\frac{160}{20}\\right) = \\log_{2}(8) = \\log_{2}(2^{3}) = 3\n    $$\n3.  抗原Gamma：$T_{pre} = 10$， $T_{post} = 40$。\n    $$\n    \\Delta_{Gamma} = \\log_{2}\\left(\\frac{40}{10}\\right) = \\log_{2}(4) = \\log_{2}(2^{2}) = 2\n    $$\n\n接下来，对于疫苗匹配抗原（H1）：\n1.  抗原V：$T_{pre} = 20$， $T_{post} = 80$。\n    $$\n    \\Delta_{V} = \\log_{2}\\left(\\frac{80}{20}\\right) = \\log_{2}(4) = \\log_{2}(2^{2}) = 2\n    $$\n\n问题将$\\Delta I$定义为印记亚型组的两倍步长之和。因此：\n$$\n\\Delta I = \\Delta_{Alpha} + \\Delta_{Beta} + \\Delta_{Gamma} = 3 + 3 + 2 = 8\n$$\n\n值$\\Delta V$被定义为疫苗匹配抗原的两倍步长。根据我们上面的计算：\n$$\n\\Delta V = \\Delta_{V} = 2\n$$\n\n最后，印记集中比$R$计算为$\\Delta I$与$\\Delta V$之比：\n$$\nR = \\frac{\\Delta I}{\\Delta V} = \\frac{8}{2} = 4\n$$\n\n问题要求答案以小数形式表示，并四舍五入至四位有效数字。确切值为$4$。为了用四位有效数字表示，我们将其写为$4.000$。", "answer": "$$\\boxed{4.000}$$", "id": "2856748"}, {"introduction": "在量化了免疫印记的整体效应之后，下一个关键问题是探究其背后的机制，即这种偏向性是否由针对特定抗原表位的抗体所驱动。本练习通过一个关于竞争性ELISA的思维实验，让你扮演实验设计者的角色 [@problem_id:2856695]。你将学习如何利用特异性单克隆抗体作为工具，来精确解析复杂的多克隆血清反应，并量化其中归因于印记表位的组分。这项实践对于理解和设计用于剖析抗体应答特异性的免疫学检测至关重要。", "problem": "一个研究小组正在研究人类在用一种漂移的病毒抗原进行加强疫苗接种后的免疫印记和抗原原罪（OAS）现象。该抗原保留了一个在初次暴露中被识别的表位。他们旨在通过竞争性酶联免疫吸附测定（ELISA）来量化，在加强接种前后，血清与加强抗原总结合中由印记特异性引起的结合所占的比例。他们拥有一种针对该印记表位的、表位已定位的单克隆抗体（mAb），并能制备其抗原结合片段（Fab）。用于检测的二抗识别人免疫球蛋白G（IgG），但不识别小鼠Fab。他们将在酶标板上包被加强抗原，然后用饱和浓度的非结合对照Fab或印记表位Fab进行孵育，最后加入稀释的人血清。\n\n使用以下基本原理：(i) 抗原-抗体结合遵循质量作用定律和占有率概念，(ii) 在ELISA已验证的线性范围内，光密度（OD）与结合的人免疫球蛋白量成正比，以及 (iii) 用饱和的、无交叉反应的Fab封闭一个表位，可以阻止血清中针对该表位的抗体结合，而不影响其他非重叠表位的可及性。\n\n在单一已验证的血清稀释度下，当用加强抗原包被时，获得以下OD值：\n- 加强前血清：对照Fab孔OD为$1.00$，印记表位Fab孔OD为$0.60$，无抗原背景OD为$0.10$。\n- 加强后血清：对照Fab孔OD为$1.40$，印记表位Fab孔OD为$0.70$，无抗原背景OD为$0.10$。\n\n哪个选项正确地描述了如何通过使用表位特异性单克隆抗体的竞争性ELISA来量化加强接种前后由印记特异性引起的血清结合比例，包括适当的对照、假设和归一化，并根据上述数据得出正确的数值估算？\n\nA. 用饱和的单价印记表位Fab预封闭包被的抗原以占据印记表位，通过使用小鼠Fab（无Fc）和人IgG Fc特异性二抗来验证无检测交叉反应性，并包括一个非结合对照Fab。假设呈线性关系，减去背景OD，并将印记比例计算为总特异性信号中被抑制的部分：$f = \\dfrac{\\text{OD}_{\\text{对照}} - \\text{OD}_{\\text{印记Fab}}}{\\text{OD}_{\\text{对照}} - \\text{OD}_{\\text{背景}}}$。使用数据计算：加强前 $f = \\dfrac{1.00 - 0.60}{1.00 - 0.10} = \\dfrac{0.40}{0.90} \\approx 0.44$，加强后 $f = \\dfrac{1.40 - 0.70}{1.40 - 0.10} = \\dfrac{0.70}{1.30} \\approx 0.54$。\n\nB. 将饱和浓度的全长印记表位小鼠IgG竞争剂加入血清中，并将印记比例计算为比率 $\\text{OD}_{\\text{印记IgG}} / \\text{OD}_{\\text{无竞争剂}}$，不进行背景扣除或使用对照，因为任何下降都必须是由于竞争。使用数据计算：加强前 $0.60 / 1.00 = 0.60$，加强后 $0.70 / 1.40 = 0.50$。\n\nC. 通过与固定化抗原孵育来耗尽血清中的印记特异性抗体，然后不加任何竞争剂测量ELISA结合；将印记比例计算为 $(\\text{OD}_{\\text{未耗尽}} - \\text{OD}_{\\text{已耗尽}}) / \\text{OD}_{\\text{未耗尽}}$。使用提供的ELISA输出作为耗尽的替代数据来估算比例。\n\nD. 用针对非印记表位的单克隆抗体进行预封闭，以仅留下印记结合，并将印记比例直接计算为 $(\\text{OD}_{\\text{仅印记}} - \\text{OD}_{\\text{背景}}) / \\text{OD}_{\\text{仅印记}}$；使用印记表位Fab的读数作为“仅印记”读数，则加强前比例为 $(0.60 - 0.10)/0.60 \\approx 0.83$，加强后为 $(0.70 - 0.10)/0.70 \\approx 0.86$。", "solution": "首先必须确定问题陈述的有效性。\n\n### 步骤1：提取给定信息\n- **目标**：量化血清抗体与加强抗原的结合中，归因于印记表位的比例。\n- **方法**：竞争性酶联免疫吸附测定（ELISA）。\n- **试剂与设置**：\n    - 抗原：包被在ELISA板上的漂移病毒抗原。\n    - 封闭剂：\n        1. 一种针对印记表位的、表位已定位的单克隆抗体（mAb）的抗原结合片段（Fab），使用饱和浓度。\n        2. 一种非结合对照Fab，用作对照。\n    - 血清：稀释的人血清，于加强疫苗接种前后采集。\n    - 检测：一种识别人免疫球蛋白G（IgG）但不识别小鼠Fab封闭剂的二抗。\n- **基本原理**：\n    - (i) 抗原-抗体结合遵循质量作用定律。\n    - (ii) 在ELISA已验证的线性范围内，光密度（OD）与结合的人IgG量成正比。\n    - (iii) 饱和浓度的印记表位Fab能完全阻断血清抗体与该特定表位的结合，而不影响与其他非重叠表位的结合。\n- **数据**：\n    - 无抗原背景OD：$OD_{\\text{背景}} = 0.10$。\n    - 加强前血清：\n        - 对照Fab孔OD：$OD_{\\text{加强前, 对照}} = 1.00$。\n        - 印记表位Fab孔OD：$OD_{\\text{加强前, 印记Fab}} = 0.60$。\n    - 加强后血清：\n        - 对照Fab孔OD：$OD_{\\text{加强后, 对照}} = 1.40$。\n        - 印记表位Fab孔OD：$OD_{\\text{加强后, 印记Fab}} = 0.70$。\n\n### 步骤2：使用提取的给定信息进行验证\n问题陈述在科学上是合理的，适定的，且客观的。\n- **科学依据**：所述实验是标准的竞争性ELISA，这是免疫学和生物化学中用于表征抗体特异性和表位定位的基础技术。免疫印记、抗原原罪（OAS）、Fab片段和特异性检测等概念在免疫学领域都是公认的。\n- **适定性**：目标明确，所有必要的数据和对照值都已提供，并且基本原理已明确说明。这允许推导出唯一且有意义的解。\n- **客观性**：问题以精确、定量和无偏见的技术语言陈述。\n\n未发现任何缺陷。该问题在科学上是合理的，并非不完整、矛盾、不切实际或不适定的。\n\n### 步骤3：结论与行动\n问题陈述是**有效的**。将根据提供的原理和数据推导解答。\n\n### 解答推导\n\n目标是确定总特异性抗体结合信号中朝向印记表位的比例 $f$。\n\n1.  **定义特异性结合信号**：根据原理(ii)，测得的光密度（$OD$）与结合的人IgG量成正比。非特异性结合由无抗原背景孔（$OD_{\\text{背景}}$）来解释。因此，任何测量对应的特异性信号（$S$）与减去背景后的OD值成正比。\n    $$S \\propto (OD_{\\text{测量值}} - OD_{\\text{背景}})$$\n\n2.  **总特异性信号（$S_{\\text{总}}$）**：在用非结合对照Fab处理的孔中，血清抗体可以自由地与包被抗原上的所有表位结合。因此，所产生的特异性信号与总抗体结合成正比。\n    $$S_{\\text{总}} \\propto (OD_{\\text{对照}} - OD_{\\text{背景}})$$\n\n3.  **非印记信号（$S_{\\text{非印记}}$）**：在用饱和浓度的印记表位Fab预封闭的孔中，该特定表位被占据，血清抗体无法与之结合（原理iii）。因此，任何测得的信号都来自于血清抗体与所有*其他*非印记表位的结合。\n    $$S_{\\text{非印记}} \\propto (OD_{\\text{印记Fab}} - OD_{\\text{背景}})$$\n\n4.  **印记信号（$S_{\\text{印记}}$）**：总结合是与印记表位的结合以及与所有非印记表位的结合之和。\n    $$S_{\\text{总}} = S_{\\text{印记}} + S_{\\text{非印记}}$$\n    因此，归因于印记表位特异性抗体的信号是总信号与非印记信号之差。\n    $$S_{\\text{印记}} = S_{\\text{总}} - S_{\\text{非印记}}$$\n    代入成比例的OD值：\n    $$S_{\\text{印记}} \\propto (OD_{\\text{对照}} - OD_{\\text{背景}}) - (OD_{\\text{印记Fab}} - OD_{\\text{背景}})$$\n    $$S_{\\text{印记}} \\propto (OD_{\\text{对照}} - OD_{\\text{印记Fab}})$$\n\n5.  **印记结合的比例（$f$）**：总血清结合中归因于印记特异性的比例是印记信号与总信号的比值。\n    $$f = \\frac{S_{\\text{印记}}}{S_{\\text{总}}}$$\n    用OD值代入表达式：\n    $$f = \\frac{OD_{\\text{对照}} - OD_{\\text{印记Fab}}}{OD_{\\text{对照}} - OD_{\\text{背景}}}$$\n    该公式表示通过封闭印记表位而被抑制的信号占总特异性信号的比例。\n\n### 数值计算\n\n-   **加强前血清**：\n    $$f_{\\text{加强前}} = \\frac{1.00 - 0.60}{1.00 - 0.10} = \\frac{0.40}{0.90} = \\frac{4}{9} \\approx 0.444$$\n-   **加强后血清**：\n    $$f_{\\text{加强后}} = \\frac{1.40 - 0.70}{1.40 - 0.10} = \\frac{0.70}{1.30} = \\frac{7}{13} \\approx 0.538$$\n\n### 逐项分析\n\n**A. 用饱和的单价印记表位Fab预封闭包被的抗原以占据印记表位，通过使用小鼠Fab（无Fc）和人IgG Fc特异性二抗来验证无检测交叉反应性，并包括一个非结合对照Fab。假设呈线性关系，减去背景OD，并将印记比例计算为总特异性信号中被抑制的部分：$f = \\dfrac{\\text{OD}_{\\text{对照}} - \\text{OD}_{\\text{印记Fab}}}{\\text{OD}_{\\text{对照}} - \\text{OD}_{\\text{背景}}}$。使用数据计算：加强前 $f = \\dfrac{1.00 - 0.60}{1.00 - 0.10} = \\dfrac{0.40}{0.90} \\approx 0.44$，加强后 $f = \\dfrac{1.40 - 0.70}{1.40 - 0.10} = \\dfrac{0.70}{1.30} \\approx 0.54$。**\n-   **分析**：该选项正确地描述了用于此目的的竞争性ELISA的实验逻辑。使用单价Fab是合适的。该公式正确地计算了被抑制信号占总*特异性*信号的比例（通过在分母中减去背景）。数值计算正确，且进行了合理的四舍五入。\n-   **结论**：**正确**。\n\n**B. 将饱和浓度的全长印记表位小鼠IgG竞争剂加入血清中，并将印记比例计算为比率 $\\text{OD}_{\\text{印记IgG}} / \\text{OD}_{\\text{无竞争剂}}$，不进行背景扣除或使用对照，因为任何下降都必须是由于竞争。使用数据计算：加强前 $0.60 / 1.00 = 0.60$，加强后 $0.70 / 1.40 = 0.50$。**\n-   **分析**：该选项描述了一个不同的、控制较少的实验设置（使用全长IgG进行液相竞争）。其提出的公式不正确，原因有二：（1）它计算的是*未被抑制*的比例，而不是印记（被抑制）的比例；（2）它没有减去背景OD，这是测定归一化中的一个关键错误。\n-   **结论**：**错误**。\n\n**C. 通过与固定化抗原孵育来耗尽血清中的印记特异性抗体，然后不加任何竞争剂测量ELISA结合；将印记比例计算为 $(\\text{OD}_{\\text{未耗尽}} - \\text{OD}_{\\text{已耗尽}}) / \\text{OD}_{\\text{未耗尽}}$。使用提供的ELISA输出作为耗尽的替代数据来估算比例。**\n-   **分析**：该选项描述了一种不同的实验方法（血清耗尽），并错误地将其应用于竞争性ELISA的数据。所提出的公式也有缺陷，因为它没有从分母中减去背景OD，而分母应代表总*特异性*信号。\n-   **结论**：**错误**。\n\n**D. 用针对非印记表位的单克隆抗体进行预封闭，以仅留下印记结合，并将印记比例直接计算为 $(\\text{OD}_{\\text{仅印记}} - \\text{OD}_{\\text{背景}}) / \\text{OD}_{\\text{仅印记}}$；使用印记表位Fab的读数作为“仅印记”读数，则加强前比例为 $(0.60 - 0.10)/0.60 \\approx 0.83$，加强后为 $(0.70 - 0.10)/0.70 \\approx 0.86$。**\n-   **分析**：该选项从根本上误解了实验。在存在印记表位Fab的情况下的读数是*非印记*反应的度量，而不是“仅印记”反应的度量。逻辑是颠倒的。所使用的公式在此上下文中是无意义的，因为它将一个信号归一化到其自身。\n-   **结论**：**错误**。", "answer": "$$\\boxed{A}$$", "id": "2856695"}, {"introduction": "现代免疫学研究越来越依赖计算模型来解析高维度的实验数据。本练习带你进入计算免疫学的世界，利用一个简化的混合模型来解构血清的中和能力 [@problem_id:2856726]。通过将观察到的针对多种病毒变体的中和滴度数据，拟合到一个由“印记”（$ w_A $）和“新”（$ w_O $）两种抗体组分构成的线性模型，你将亲手实现一个估计这两种组分相对权重的计算过程。这个练习展示了如何将一个生物学假说转化为可检验的数学模型，并通过数据拟合来量化免疫印记在复杂血清反应中的作用。", "problem": "考虑严重急性呼吸综合征冠状病毒2（SARS-CoV-2）中的血清中和作用，其源于免疫印记所塑造的两种抗体特异性：一种是祖先印记组分，另一种是奥密克戎特异性组分。原始抗原罪（OAS）假定，先前的暴露会使再次免疫应答偏向于首次遇到的相似表位，我们将其编码为两种免疫组分的混合权重。我们采用一个基于以下基本假设的、简化的、有内在机理的模型：(i) 针对某一变体的总中和效力在独立的抗体特异性之间近似可加，以及 (ii) 在固定中和阈值下的倒数稀释滴度与总中和效力成正比。在这些假设下，针对某个变体的预期滴度被建模为固定组分效能的非负线性组合。\n\n设存在两个组分：祖先印记组分（索引为 $A$）和奥密克戎特异性组分（索引为 $O$）。设存在 $V$ 个变体，索引为 $v \\in \\{1,2,\\dots,V\\}$。令 $e_A(v) \\ge 0$ 和 $e_O(v) \\ge 0$ 表示这两个组分针对变体 $v$ 的固定的、已知的相对中和效能（无量纲），令 $w_A \\ge 0$ 和 $w_O \\ge 0$ 表示满足 $w_A + w_O = 1$ 的未知混合权重。令 $s > 0$ 为一个血清特异性尺度因子（与总抗体浓度成正比），同样未知。对于在相同 $V$ 个变体上测量得到的观测滴度向量 $\\mathbf{y} \\in \\mathbb{R}_{\\ge 0}^V$，该模型假定\n$$\ny_v \\approx s \\left( w_A \\, e_A(v) + w_O \\, e_O(v) \\right), \\quad \\text{for } v = 1,\\dots,V,\n$$\n其偏差归因于测量噪声。估计的目标是通过最小化残差平方和来确定 $w_O$（以及 $w_A = 1 - w_O$）和冗余尺度 $s$\n$$\n\\mathrm{SSE}(w_O, s) = \\sum_{v=1}^{V} \\left( y_v - s \\left( (1 - w_O) e_A(v) + w_O e_O(v) \\right) \\right)^2,\n$$\n约束条件为 $w_O \\in [0,1]$ 和 $s \\ge 0$。向量 $e_A$ 和 $e_O$ 假定为已知且不共线，这确保了混合结构在尺度 $s$ 内的可识别性。\n\n您的任务是编写一个程序，对于一对固定的效能向量 $e_A$ 和 $e_O$ 以及一组观测到的多变体滴度向量 $\\{\\mathbf{y}^{(i)}\\}$（每个向量对应一个不同的血清），通过解决上述约束最小二乘问题，为每个血清估计其奥密克戎特异性混合权重 $\\hat{w}_O^{(i)}$。请实现以下计算方法：对每个血清，在 $w_O \\in [0,1]$ 上进行搜索，对于每个候选的 $w_O$，以闭式解计算出在 $s \\ge 0$ 范围内最小化 $\\mathrm{SSE}(w_O, s)$ 的最优 $\\hat{s}(w_O)$。然后，选择能够最小化 $\\mathrm{SSE}(w_O, \\hat{s}(w_O))$ 的 $\\hat{w}_O$。\n\n允许用于推理的基本依据：独立抗体中和效力的可加性、中和滴度与总中和效力之间的比例性、非负混合建模以及欧几里得空间中的最小二乘投影。\n\n使用以下固定的效能向量（按变体排序：Wuhan-Hu-1, Delta, Omicron BA.1, Omicron BA.5）：\n$$\ne_A = [1.0, \\, 0.7, \\, 0.1, \\, 0.2], \\quad e_O = [0.25, \\, 0.3, \\, 1.0, \\, 0.9].\n$$\n\n测试套件：对于每个血清 $i \\in \\{1,2,3,4,5\\}$，观测到的多变体滴度向量 $\\mathbf{y}^{(i)}$（单位为倒数稀释度；为建模作无量纲比率而无单位）如下：\n$$\n\\mathbf{y}^{(1)} = [1000, \\, 700, \\, 100, \\, 200], \\\\\n\\mathbf{y}^{(2)} = [200, \\, 240, \\, 800, \\, 720], \\\\\n\\mathbf{y}^{(3)} = [630, \\, 486, \\, 414, \\, 432], \\\\\n\\mathbf{y}^{(4)} = [200, \\, 190, \\, 410, \\, 380], \\\\\n\\mathbf{y}^{(5)} = [1020, \\, 744, \\, 336, \\, 408].\n$$\n\n在数值实现中，您必须强制执行约束条件 $w_O \\in [0,1]$ 和 $s \\ge 0$。程序必须为每个血清 $i$ 输出估计的奥密克戎特异性权重 $\\hat{w}_O^{(i)}$，结果为在 $[0,1]$ 区间内的小数，并四舍五入到三位小数。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表（例如，$[r_1, r_2, r_3, r_4, r_5]$），其中每个 $r_i$ 是 $\\hat{w}_O^{(i)}$ 的三位小数表示。\n\n程序必须使用上面提供的精确效能向量和滴度向量，且不得要求任何用户输入。", "solution": "首先将对问题陈述进行严格验证。\n\n第1步：提取给定信息。\n问题提供了以下数据、定义和约束：\n- 针对变体 $v$ 的观测滴度 $y_v$ 模型：$y_v \\approx s ( w_A e_A(v) + w_O e_O(v) )$。\n- 两种抗体组分：祖先印记（$A$）和奥密克戎特异性（$O$）。\n- 针对 $V$ 个变体的组分效能：$e_A(v) \\ge 0$ 和 $e_O(v) \\ge 0$。\n- 混合权重：$w_A \\ge 0$，$w_O \\ge 0$，且约束为 $w_A + w_O = 1$。这意味着 $w_O \\in [0,1]$。\n- 血清特异性尺度因子：$s > 0$，为优化问题放宽至 $s \\ge 0$。\n- 给定血清的观测滴度向量：$\\mathbf{y} \\in \\mathbb{R}_{\\ge 0}^V$。\n- 目标是找到使残差平方和最小化的 $w_O$ 和 $s$：\n$$\n\\mathrm{SSE}(w_O, s) = \\sum_{v=1}^{V} \\left( y_v - s \\left( (1 - w_O) e_A(v) + w_O e_O(v) \\right) \\right)^2\n$$\n- 最小化的约束条件是 $w_O \\in [0,1]$ 和 $s \\ge 0$。\n- 效能向量 $\\mathbf{e}_A$ 和 $\\mathbf{e}_O$ 假设已知且不共线。\n- 针对各变体的固定效能向量（Wuhan-Hu-1, Delta, Omicron BA.1, Omicron BA.5）：\n$$\n\\mathbf{e}_A = [1.0, \\, 0.7, \\, 0.1, \\, 0.2] \\\\\n\\mathbf{e}_O = [0.25, \\, 0.3, \\, 1.0, \\, 0.9]\n$$\n- 用于估计的五个多变体观测滴度向量：\n$$\n\\mathbf{y}^{(1)} = [1000, \\, 700, \\, 100, \\, 200] \\\\\n\\mathbf{y}^{(2)} = [200, \\, 240, \\, 800, \\, 720] \\\\\n\\mathbf{y}^{(3)} = [630, \\, 486, \\, 414, \\, 432] \\\\\n\\mathbf{y}^{(4)} = [200, \\, 190, \\, 410, \\, 380] \\\\\n\\mathbf{y}^{(5)} = [1020, \\, 744, \\, 336, \\, 408]\n$$\n- 指定的计算方法：对每个血清，在 $w_O \\in [0,1]$ 上进行搜索，对每个候选 $w_O$，计算闭式最优解 $\\hat{s}(w_O)$。然后，找到最小化所得目标函数的 $\\hat{w}_O$。\n- 每个血清 $i$ 的输出是估计的奥密克戎特异性权重 $\\hat{w}_O^{(i)}$，四舍五入到三位小数。\n\n第2步：使用提取的给定信息进行验证。\n根据指定标准对问题进行评估：\n- **科学合理性：** 问题基于一个简化的但机理上合理的血清中和模型，借鉴了免疫学中的既定概念，如免疫印记和原始抗原罪。中和效力可加性和滴度比例性的假设是该领域的标准简化方法。该模型是一种非负线性混合建模，是一种可靠的数学和统计技术。对于定量建模练习而言，该问题具有科学依据。\n- **适定性：** 该问题是一个约束最小二乘估计问题。目标函数对于 $s$ 是二次的，对于 $w_O$ 是非线性的。约束条件 $w_O \\in [0,1]$ 和 $s \\ge 0$ 定义了一个用于优化的紧凑凸集。问题陈述中指出，效能向量 $\\mathbf{e}_A$ 和 $\\mathbf{e}_O$ 不共线，这可以通过检查来验证，并确保混合组分的可识别性（在冗余尺度参数 $s$ 的范围内），从而防止退化解。因此，预期存在唯一最小值。\n- **客观性：** 问题以精确、形式化的数学语言陈述，没有主观或含糊的术语。\n- **其他缺陷：** 问题没有违反任何列出的无效标准。它自成一体、逻辑一致且计算上易于处理。所提供的数据在数值上一致且合理。\n\n第3步：结论与行动。\n该问题被判定为 **有效**。将制定并提出解决方案。\n\n任务是通过最小化残差平方和（$\\mathrm{SSE}$）来为每个给定的血清向量 $\\mathbf{y}^{(i)}$ 估计参数 $w_O$ 和 $s$。预测滴度向量 $\\hat{\\mathbf{y}}$ 的模型方程可以使用一个依赖于混合权重 $w_O$ 的复合效能向量 $\\mathbf{E}(w_O)$ 来编写：\n$$ \\mathbf{E}(w_O) = (1 - w_O)\\mathbf{e}_A + w_O\\mathbf{e}_O $$\n然后，该模型可以紧凑地写为 $\\hat{\\mathbf{y}} = s \\mathbf{E}(w_O)$。目标函数是最小化残差向量的欧几里得范数的平方：\n$$ \\mathrm{SSE}(w_O, s) = \\|\\mathbf{y} - s \\mathbf{E}(w_O)\\|_2^2 = \\sum_{v=1}^{V} \\left( y_v - s E_v(w_O) \\right)^2 $$\n我们必须在 $w_O \\in [0,1]$ 和 $s \\ge 0$ 的约束下最小化此函数。按照指定的方法，我们采用嵌套优化策略。首先，对于固定的 $w_O$ 值，我们找到最小化 $\\mathrm{SSE}(w_O, s)$ 的最优尺度因子 $\\hat{s}(w_O)$。这是一个关于参数 $s$ 的标准线性最小二乘问题。为求最小值，我们对 $\\mathrm{SSE}$ 关于 $s$ 求偏导数并令其为零：\n$$ \\frac{\\partial \\mathrm{SSE}}{\\partial s} = \\sum_{v=1}^{V} 2 \\left( y_v - s E_v(w_O) \\right) \\left( -E_v(w_O) \\right) = 0 $$\n$$ \\sum_{v=1}^{V} y_v E_v(w_O) - s \\sum_{v=1}^{V} E_v(w_O)^2 = 0 $$\n解出 $s$ 得到最优值，我们将其表示为 $\\hat{s}(w_O)$：\n$$ \\hat{s}(w_O) = \\frac{\\sum_{v=1}^{V} y_v E_v(w_O)}{\\sum_{v=1}^{V} E_v(w_O)^2} = \\frac{\\mathbf{y} \\cdot \\mathbf{E}(w_O)}{\\mathbf{E}(w_O) \\cdot \\mathbf{E}(w_O)} $$\n必须满足约束 $s \\ge 0$。鉴于 $\\mathbf{y} \\ge 0$, $\\mathbf{e}_A \\ge 0$, $\\mathbf{e}_O \\ge 0$ 且 $w_O \\in [0,1]$，复合向量 $\\mathbf{E}(w_O)$ 是逐元素非负的。因此，分子 $\\mathbf{y} \\cdot \\mathbf{E}(w_O)$ 是非负的。分母 $\\|\\mathbf{E}(w_O)\\|_2^2$ 是严格正的，因为 $\\mathbf{e}_A$ 和 $\\mathbf{e}_O$ 不是共线的，也不是零向量。因此，最优的 $\\hat{s}(w_O)$ 总是非负的，约束被自动满足。\n\n将 $\\hat{s}(w_O)$ 的闭式解代回目标函数，该函数现在只与 $w_O$ 有关：\n$$ f(w_O) = \\mathrm{SSE}(w_O, \\hat{s}(w_O)) = \\sum_{v=1}^{V} \\left( y_v - \\hat{s}(w_O) E_v(w_O) \\right)^2 $$\n问题现在简化为一个一维优化问题：\n$$ \\hat{w}_O = \\arg\\min_{w_O \\in [0,1]} f(w_O) $$\n这是一个关于 $w_O$ 的非线性但连续且表现良好的函数。根据要求，需要在区间 $[0,1]$ 上进行搜索。这将通过使用一维有界函数的数值优化例程在计算上实现，该例程能高效地执行此搜索，以找到最小化 $f(w_O)$ 的 $w_O$ 值。\n\n对于每个血清 $\\mathbf{y}^{(i)}$，我们将定义目标函数 $f(w_O)$ 并使用此过程找到最优的 $\\hat{w}_O^{(i)}$。最终结果将按要求四舍五入到三位小数。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves for the Omicron-specific mixture weight w_O for multiple serum samples\n    by minimizing a constrained least squares problem.\n    \"\"\"\n    # Fixed efficacy vectors for variants (Wuhan-Hu-1, Delta, Omicron BA.1, Omicron BA.5)\n    e_A = np.array([1.0, 0.7, 0.1, 0.2])\n    e_O = np.array([0.25, 0.3, 1.0, 0.9])\n\n    # Observed multi-variant titer vectors for 5 serum samples\n    test_cases = [\n        np.array([1000, 700, 100, 200]),    # Serum 1\n        np.array([200, 240, 800, 720]),    # Serum 2\n        np.array([630, 486, 414, 432]),    # Serum 3\n        np.array([200, 190, 410, 380]),    # Serum 4\n        np.array([1020, 744, 336, 408]),   # Serum 5\n    ]\n\n    estimated_weights = []\n\n    for y_obs in test_cases:\n        \n        def objective_function(w_o, y, e_A_vec, e_O_vec):\n            \"\"\"\n            Calculates the Sum of Squared Errors (SSE) for a given w_o.\n\n            Args:\n                w_o (float): The Omicron-specific mixture weight, w_O.\n                y (np.ndarray): The observed titer vector.\n                e_A_vec (np.ndarray): The ancestral-imprinted efficacy vector.\n                e_O_vec (np.ndarray): The Omicron-specific efficacy vector.\n\n            Returns:\n                float: The sum of squared errors.\n            \"\"\"\n            # Calculate the composite efficacy vector E(w_o)\n            # E(w_o) = (1 - w_o) * e_A + w_o * e_O\n            e_composite = (1 - w_o) * e_A_vec + w_o * e_O_vec\n\n            # Calculate the optimal scale factor s_hat(w_o) in closed form.\n            # s_hat = (y . E) / (E . E)\n            numerator = np.dot(y, e_composite)\n            denominator = np.dot(e_composite, e_composite)\n\n            # Avoid division by zero, though unlikely with non-collinear e_A and e_O\n            if denominator == 0:\n                # If E is a zero vector, s can be anything, but SSE is ||y||^2.\n                # If E is not zero but orthogonal to y, s_hat is 0.\n                s_hat = 0.0\n            else:\n                s_hat = numerator / denominator\n\n            # Calculate the predicted titer vector y_hat\n            y_pred = s_hat * e_composite\n\n            # Calculate the Sum of Squared Errors\n            sse = np.sum((y - y_pred)**2)\n            \n            return sse\n\n        # Perform the 1D constrained optimization to find the best w_o\n        # The search for w_o is bounded in the interval [0, 1].\n        result = minimize_scalar(\n            objective_function,\n            args=(y_obs, e_A, e_O),\n            bounds=(0, 1),\n            method='bounded'\n        )\n\n        w_o_hat = result.x\n        \n        # Round the result to three decimal places and append\n        estimated_weights.append(round(w_o_hat, 3))\n\n    # Format the final output string as specified\n    # The expected output from running the code is: [0.000, 1.000, 0.600, 0.800, 0.200]\n    output_str = f\"[{','.join(f'{w:.3f}' for w in estimated_weights)}]\"\n    print(output_str)\n\nsolve()\n```", "id": "2856726"}]}