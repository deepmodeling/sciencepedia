{"hands_on_practices": [{"introduction": "基因之间的相互作用（即上位性，epistasis）是遗传学分析中的一个关键复杂层面。ABO血型的表达并非仅由$ABO$基因座决定，它还依赖于由$H$基因座编码的功能性岩藻糖基转移酶。本练习将孟德尔遗传、上位性与群体遗传学原理（哈迪-温伯格平衡）相结合，以解决一个涉及罕见孟买血型 ($hh$) 的真实遗传场景，从而加深你对基因互作如何塑造最终表型的理解 [@problem_id:2772052]。", "problem": "在人类ABO血型系统中，ABO基因座有三个等位基因，记作$I^{A}$、$I^{B}$和$i$。等位基因$I^{A}$和$I^{B}$相互之间为共显性，且二者均对$i$为显性。红细胞上ABO抗原的表达需要由$H$基因座编码的功能性岩藻糖基转移酶；$H$基因座上基因型为$hh$的个体不合成所需底物（孟买血型），因此无论ABO基因型如何，其红细胞上均不表现出ABO抗原，表现型为O型。假设$ABO$和$H$基因座位于不同染色体上，且遵循自由组合定律。\n\n两个已知基因型的亲本交配：一个在ABO基因座上的基因型为$I^{A}i$，另一个为$I^{B}i$。亲本的$H$基因座基因型未知，但群体中无效等位基因$h$的频率为$f \\in (0,1)$，且$H$基因座处于哈迪-温伯格平衡状态，等位基因$H$的频率为$1-f$，$h$的频率为$f$。\n\n使用庞尼特方格、孟德尔分离定律和自由组合定律，从第一性原理出发，推导$I^{A}i \\times I^{B}i$杂交后代的ABO基因型分布，然后结合上位性的$H$基因座，以$f$表示后代出现AB、A、B和O型血的表型概率。通过明确阐述$hh$的作用，解释为何这次杂交可以产生所有四种表现型。\n\n后代中表现型为AB型的预期比例是多少（以$f$的函数表示）？请将最终答案表示为一个关于$f$的简化代数表达式。", "solution": "基本原理如下：\n\n- 在$ABO$基因座上，等位基因$I^{A}$和$I^{B}$相互共显性，且二者均对$i$为显性。根据孟德尔分离定律，每个亲本从其等位基因对中随机传递一个等位基因。\n\n- 在$H$基因座上，基因型$hh$对$ABO$基因座具有上位性，导致红细胞上不产生ABO抗原；因此任何$ABO$基因型与$hh$组合都会产生O型表现型。一个孩子表现为非O型血的条件是其至少携带一个$H$等位基因。$ABO$和$H$基因座遵循自由组合定律。\n\n- 在$H$基因座处于哈迪-温伯格平衡下，等位基因$H$的频率为$1-f$，$h$的频率为$f$，随机交配意味着后代在$H$基因座上的基因型频率为：$HH$为$(1-f)^{2}$，$Hh$为$2f(1-f)$，$hh$为$f^{2}$。\n\n步骤$1$：推导$I^{A}i \\times I^{B}i$杂交的$ABO$基因型分布。\n\n构建$ABO$基因座的庞尼特方格。第一个亲本($I^{A}i$)产生$I^{A}$和$i$两种配子，概率均为$1/2$；第二个亲本($I^{B}i$)产生$I^{B}$和$i$两种配子，概率均为$1/2$。组合这些配子：\n\n- 来自第一个亲本的$I^{A}$和来自第二个亲本的$I^{B}$结合，产生$I^{A}I^{B}$的概率为$1/2 \\times 1/2 = 1/4$。\n\n- 来自第一个亲本的$I^{A}$和来自第二个亲本的$i$结合，产生$I^{A}i$的概率为$1/4$。\n\n- 来自第一个亲本的$i$和来自第二个亲本的$I^{B}$结合，产生$I^{B}i$的概率为$1/4$。\n\n- 来自第一个亲本的$i$和来自第二个亲本的$i$结合，产生$ii$的概率为$1/4$。\n\n因此，后代中的$ABO$基因型分布为：\n$$\nP(I^{A}I^{B})=\\frac{1}{4},\\quad P(I^{A}i)=\\frac{1}{4},\\quad P(I^{B}i)=\\frac{1}{4},\\quad P(ii)=\\frac{1}{4}.\n$$\n\n步骤$2$：在$H$基因座的条件下，将$ABO$基因型映射到表现型，并考虑上位性。\n\n- 如果孩子在$H$基因座上的基因型为$hh$，则无论$ABO$基因型如何，其表现型均为O型。\n\n- 如果孩子的基因型为$H\\_$（即$HH$或$Hh$），则：\n  - $I^{A}I^{B}$表现为AB型。\n  - $I^{A}i$表现为A型。\n  - $I^{B}i$表现为B型。\n  - $ii$表现为O型。\n\n因此，对于除O型以外的任何表现型，孩子必须是$H\\_$基因型。\n\n步骤$3$：确定孩子基因型为$H\\_$的概率。\n\n在$H$基因座处于哈迪-温伯格平衡且随机交配，并且等位基因$h$的频率为$f$的条件下，后代在$H$基因座上的基因型频率为：\n$$\nP(HH)=(1-f)^{2},\\quad P(Hh)=2f(1-f),\\quad P(hh)=f^{2}.\n$$\n因此，\n$$\nP(H\\_)=P(HH)+P(Hh) = 1 - P(hh) = 1 - f^{2}.\n$$\n\n根据$ABO$和$H$基因座的独立性，一个孩子同时具有$ABO$基因型$I^{A}I^{B}$和$H\\_$基因型的联合概率是边际概率的乘积：\n$$\nP\\big(I^{A}I^{B}\\ \\text{且}\\ H\\_\\big) = P(I^{A}I^{B}) \\times P(H\\_) = \\frac{1}{4}\\,(1 - f^{2}).\n$$\n\n步骤$4$：确定所求的数量。\n\nAB表现型需要$ABO$基因型为$I^{A}I^{B}$且$H$基因座基因型为$H\\_$。因此，后代中表现型为AB型的预期比例是：\n$$\n\\frac{1}{4}\\,(1 - f^{2}).\n$$\n\n为求完整（以解释所有四种表现型如何出现），请注意，通过类似的推理：\n- $P(\\text{表现型 }A) = \\frac{1}{4}\\,(1 - f^{2})$。\n- $P(\\text{表现型 }B) = \\frac{1}{4}\\,(1 - f^{2})$。\n- $P(\\text{表现型 }O) = P(hh) + P(ii \\ \\text{且}\\ H\\_) = f^{2} + \\frac{1}{4}\\,(1 - f^{2}) = \\frac{1}{4} + \\frac{3}{4}f^{2}$。\n\n这些概率之和为$1$：\n$$\n\\frac{1}{4}(1 - f^{2}) + \\frac{1}{4}(1 - f^{2}) + \\frac{1}{4}(1 - f^{2}) + \\left(\\frac{1}{4} + \\frac{3}{4}f^{2}\\right) = 1,\n$$\n这也证明了$hh$的上位性如何在$ii$基因型之外创造额外的O型表现型，而$H\\_$基因型则允许在$I^{A}i \\times I^{B}i$杂交中表达出AB、A和B型。\n\n所求的最终数量是AB表现型的比例：\n$$\n\\frac{1}{4}\\,(1 - f^{2}).\n$$", "answer": "$$\\boxed{\\frac{1 - f^{2}}{4}}$$", "id": "2772052"}, {"introduction": "经典的 $I^{A}$、$I^{B}$ 和 $i$ 三等位基因模型是 ABO 遗传学的基础，但自然界中存在着挑战这一简洁模型的罕见变异。本练习将探讨一种名为 `cis-AB` 的特殊重组等位基因，它使得单个等位基因能够编码具有双重特异性的糖基转移酶，同时产生 A 和 B 两种抗原。你将运用全概率定律，并结合不完全外显率这一重要概念，来计算后代中各种表型的预期频率，这有助于理解基因表达的复杂性和随机性 [@problem_id:2772066]。", "problem": "一个关于 ABO 血型系统的单基因座模型假设，ABO 基因拥有编码糖基转移酶活性的等位基因，这些活性决定了红细胞的抗原表型：等位基因 $A$ 编码 $\\alpha$-$N$-乙酰半乳糖胺转移酶（A 活性），等位基因 $B$ 编码 $\\alpha$-半乳糖基转移酶（B 活性），而等位基因 $i$（历史上称为 $O$）是一个无酶活性的无效等位基因。一个罕见的重组等位基因，记作 $\\mathrm{cis}\\!-\\!AB$，编码一种对 A和B决定簇具有双重特异性的单一糖基转移酶，并且已知在标准血清学检测中表现出可变外显率和不完全外显。假设减数分裂遵循孟德尔分离定律，并且不存在分离畸变。\n\n考虑一个 $\\mathrm{cis}\\!-\\!AB/i$ 基因型的亲代与一个 $i/i$ 基因型的亲代之间的交配。在一个经过验证且固定的表型分析方案下，基因型 $\\mathrm{cis}\\!-\\!AB/i$ 被分为以下血清学表型，其外显率概率如下：\n- $P(\\text{表型 }A \\mid \\mathrm{cis}\\!-\\!AB/i) = 0.22$，\n- $P(\\text{表型 }B \\mid \\mathrm{cis}\\!-\\!AB/i) = 0.15$，\n- $P(\\text{表型 }AB \\mid \\mathrm{cis}\\!-\\!AB/i) = 0.62$，\n- $P(\\text{表型 }O \\mid \\mathrm{cis}\\!-\\!AB/i) = 0.01$，\n总和为 $1.00$。\n\n对于基因型 $i/i$，假设 $P(\\text{表型 }O \\mid i/i) = 1.00$ 且 $P(\\text{任何其他表型} \\mid i/i) = 0$。\n\n仅使用上述定义、孟德尔分离定律和全概率定律，推导此次交配如何在子代中产生所有四种 ABO 表型，并计算子代中表型 $A$、$B$、$AB$ 和 $O$ 的期望频率。按 $A, B, AB, O$ 的顺序，以小数形式报告这四个频率，其总和应为 $1$，并将最终报告的数字四舍五入到四位有效数字。答案中不要使用百分号。", "solution": "求解需要两个主要步骤：首先，使用孟德尔分离定律确定可能的子代基因型的概率；其次，应用全概率定律，使用给定的外显率概率来计算每种表型的期望频率。\n\n设等位基因记为 $\\mathcal{A}_{\\mathrm{cisAB}}$, $\\mathcal{A}_A$, $\\mathcal{A}_B$ 和 $\\mathcal{A}_i$。问题中使用了 $\\mathrm{cis}\\!-\\!AB$, $A$, $B$ 和 $i$ 的记法。我们将遵循问题的记法。\n\n交配在一个基因型为 $\\mathrm{cis}\\!-\\!AB/i$ 的亲代和一个基因型为 $i/i$ 的亲代之间进行。\n根据孟德尔分离定律，每个亲代以相等的概率将其两个等位基因中的一个传递给子代。不存在分离畸变，因此对于来自杂合子亲代的每个等位基因，其概率恰好为 $\\frac{1}{2}$。\n\n亲代 1（基因型 $\\mathrm{cis}\\!-\\!AB/i$）产生两种类型的配子：\n*   带有等位基因 $\\mathrm{cis}\\!-\\!AB$ 的配子，概率为 $P(\\text{配子} = \\mathrm{cis}\\!-\\!AB) = 0.5$。\n*   带有等位基因 $i$ 的配子，概率为 $P(\\text{配子} = i) = 0.5$。\n\n亲代 2（基因型 $i/i$）只产生一种类型的配子：\n*   带有等位基因 $i$ 的配子，概率为 $P(\\text{配子} = i) = 1.0$。\n\n子代的基因型及其概率由来自每个亲代的配子组合决定。\n1.  子代基因型 $\\mathrm{cis}\\!-\\!AB/i$：这是由亲代 1 的一个 $\\mathrm{cis}\\!-\\!AB$ 配子和亲代 2 的一个 $i$ 配子融合产生。\n    其概率为 $P(G=\\mathrm{cis}\\!-\\!AB/i) = 0.5 \\times 1.0 = 0.5$。\n2.  子代基因型 $i/i$：这是由亲代 1 的一个 $i$ 配子和亲代 2 的一个 $i$ 配子融合产生。\n    其概率为 $P(G=i/i) = 0.5 \\times 1.0 = 0.5$。\n子代基因型概率之和为 $0.5 + 0.5 = 1.0$，符合预期。\n\n问题要求子代中表型 $A$, $B$, $AB$ 和 $O$ 的期望频率。我们使用全概率定律。对于任何表型 $\\Phi$，其概率是给定每种可能基因型下该表型的条件概率之和，并按每种基因型的概率加权：\n$$P(\\Phi=\\phi) = \\sum_{G_j} P(\\Phi=\\phi \\mid G=G_j) \\times P(G=G_j)$$\n其中，求和是针对所有可能的子代基因型 $G_j$。在我们的例子中，基因型为 $G_1 = \\mathrm{cis}\\!-\\!AB/i$ 和 $G_2 = i/i$。\n\n给定的条件概率（外显率值）是：\n*   $P(\\text{表型 } A \\mid \\mathrm{cis}\\!-\\!AB/i) = 0.22$\n*   $P(\\text{表型 } B \\mid \\mathrm{cis}\\!-\\!AB/i) = 0.15$\n*   $P(\\text{表型 } AB \\mid \\mathrm{cis}\\!-\\!AB/i) = 0.62$\n*   $P(\\text{表型 } O \\mid \\mathrm{cis}\\!-\\!AB/i) = 0.01$\n\n对于 $i/i$ 基因型：\n*   $P(\\text{表型 } O \\mid i/i) = 1.00$\n*   $P(\\text{任何其他表型} \\mid i/i) = 0$\n\n利用这些信息，我们计算每种表型的概率：\n\n1.  **表型 A 频率：**\n    $$P(A) = P(A \\mid \\mathrm{cis}\\!-\\!AB/i)P(\\mathrm{cis}\\!-\\!AB/i) + P(A \\mid i/i)P(i/i)$$\n    $$P(A) = (0.22)(0.5) + (0)(0.5) = 0.11$$\n\n2.  **表型 B 频率：**\n    $$P(B) = P(B \\mid \\mathrm{cis}\\!-\\!AB/i)P(\\mathrm{cis}\\!-\\!AB/i) + P(B \\mid i/i)P(i/i)$$\n    $$P(B) = (0.15)(0.5) + (0)(0.5) = 0.075$$\n\n3.  **表型 AB 频率：**\n    $$P(AB) = P(AB \\mid \\mathrm{cis}\\!-\\!AB/i)P(\\mathrm{cis}\\!-\\!AB/i) + P(AB \\mid i/i)P(i/i)$$\n    $$P(AB) = (0.62)(0.5) + (0)(0.5) = 0.31$$\n\n4.  **表型 O 频率：**\n    $$P(O) = P(O \\mid \\mathrm{cis}\\!-\\!AB/i)P(\\mathrm{cis}\\!-\\!AB/i) + P(O \\mid i/i)P(i/i)$$\n    $$P(O) = (0.01)(0.5) + (1.00)(0.5) = 0.005 + 0.5 = 0.505$$\n\n这个推导解释了这次交配如何能产生所有四种表型。子代群体是两种基因型的混合体。$i/i$ 个体将永远是 O 型表型。$\\mathrm{cis}\\!-\\!AB/i$ 个体由于不完全外显，可以表现出四种表型中的任何一种，尽管概率不同。这些结果的加权和导致总子代群体中所有四种表型都具有非零概率。\n\n为了验证，表型频率的总和是：\n$P(A) + P(B) + P(AB) + P(O) = 0.11 + 0.075 + 0.31 + 0.505 = 1.0$。\n\n问题要求以小数形式报告频率，并四舍五入到四位有效数字。\n*   $P(A) = 0.11 → 0.1100$\n*   $P(B) = 0.075 → 0.07500$\n*   $P(AB) = 0.31 → 0.3100$\n*   $P(O) = 0.505 → 0.5050$\n对于表型 $A, B, AB, O$，最终频率分别为 $0.1100$, $0.07500$, $0.3100$ 和 $0.5050$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1100 & 0.07500 & 0.3100 & 0.5050\n\\end{pmatrix}\n}\n$$", "id": "2772066"}, {"introduction": "为了更深入地理解基因型如何转化为表型，我们可以从分子层面构建定量模型。这项高级实践任务邀请你扮演系统生物学家的角色，设计一个囊括内质网到高尔基体区室化运输的聚糖合成模型。通过整合酶促反应的质量作用动力学和细胞内运输的随机过程，你将能够从第一性原理出发，预测不同ABO基因型如何精确地决定细胞表面A、B和H抗原的最终比例，这充分展示了计算建模在连接多尺度生物过程中的强大能力 [@problem_id:2772055]。", "problem": "你的任务是设计并实现一个离散的、单程的区室模型，用于模拟基于N-乙酰乳糖胺的聚糖在内质网（ER）和高尔基体中的成熟过程。该模型需要能够捕捉ABO血型转移酶活性对细胞表面抗原出现的影响。模型必须从以下基础出发：分子生物学的中心法则（基因型决定酶的丰度）、在底物饱和条件下由质量作用动力学描述的酶催化（产生有效的一级速率定律），以及通过高尔基体的顺序囊泡运输。你编写的程序必须能针对指定的参数集，计算出携带A抗原、B抗原或仍为H抗原的细胞表面聚糖末端的预测比例，并以小数形式表示。\n\n需使用的建模假设和定义：\n- 区室化：一个糖蛋白按顺序穿过内质网（ER），然后是高尔基体，其中高尔基体由三个串联的区室表示：顺式（cis）、中间（medial）和反式（trans）。设高尔基体有 $n=3$ 个区室，索引为 $i \\in \\{1,2,3\\}$。在本问题中，内质网被视为一个无ABO转换的转运区室；它在顺式高尔基体入口处引入底物H抗原。因此，就ABO转换而言，只有三个高尔基体区室贡献反应事件。\n- 区室内停留时间：设在区室 $i$ 内的停留时间为 $t_i$（单位为$\\mathrm{s}$），汇集在一个向量 $\\mathbf{t} = [t_1,t_2,t_3]$ 中，其中 $t_i \\ge 0$。\n- 有效动力学：假设供体底物是饱和的，因此ABO转移酶催化的H到A和H到B的转换可以很好地近似为独立的、竞争的、不可逆的一级反应，每个区室具有恒定的风险率。对于区室 $i$，定义伪一级速率常数 $k_{Ai}$ 和 $k_{Bi}$，单位为 $\\mathrm{s}^{-1}$。\n- 酶活性的遗传控制：设 $E_A$ 和 $E_B$ 分别为A和B转移酶的无量纲相对表达水平，由基因型决定。每个区室中单位酶的催化效率是常数 $c_{Ai}$ 和 $c_{Bi}$，单位为每酶单位 $\\mathrm{s}^{-1}$，因此对于每个 $i$，$k_{Ai} = E_A \\cdot c_{Ai}$ 且 $k_{Bi} = E_B \\cdot c_{Bi}$。\n- 单程运输：每个聚糖按顺序单次通过每个区室。在区室 $i$ 内，状态H可以随机且不可逆地转换为A或B，或保持为H直到离开，其恒定风险率为 $k_{Ai}$ 和 $k_{Bi}$。到达细胞表面后不发生转换。没有反向运输，也没有逆反应。进入顺式高尔基体时的初始条件是状态H的比例为$1$，状态A和B的比例为$0$。\n\n要求的推导和计算：\n- 仅使用上述定义以及竞争性泊松过程和恒定风险率下生存分析的第一性原理，推导出将 $(\\mathbf{t}, \\mathbf{c}_A, \\mathbf{c}_B, E_A, E_B)$ 映射到最终细胞表面比例 $(f_A, f_B, f_H)$ 的表达式，其中 $f_A$ 是携带A抗原的比例，$f_B$ 是携带B抗原的比例，$f_H$ 是仍为H抗原的比例。你的推导必须从每个区室中未转换的H状态的生存函数开始，并考虑跨区室生存率的顺序乘积以及在每个区室中转换为A或B的条件概率。最终比例必须满足 $f_A \\ge 0$，$f_B \\ge 0$，$f_H \\ge 0$，以及 $f_A + f_B + f_H = 1$。\n- 所有时间参数的单位必须是 $\\mathrm{s}$，所有速率常数的单位必须是 $\\mathrm{s}^{-1}$，所有输出必须报告为四舍五入到$6$位的小数。\n\n测试套件的输入参数：\n- 固定催化效率向量（所有测试用例中相同）：\n  - $\\mathbf{c}_A = [2.0\\times 10^{-3},\\;4.0\\times 10^{-3},\\;1.0\\times 10^{-3}]\\,\\mathrm{s}^{-1}\\,\\text{每酶单位}$。\n  - $\\mathbf{c}_B = [1.5\\times 10^{-3},\\;3.5\\times 10^{-3},\\;1.2\\times 10^{-3}]\\,\\mathrm{s}^{-1}\\,\\text{每酶单位}$。\n- 定义基础停留时间向量：\n  - $\\mathbf{t}^{(\\text{base})} = [600,\\;900,\\;600]\\,\\mathrm{s}$。\n- 程序必须为以下$5$个测试用例中的每一个计算 $(f_A, f_B, f_H)$，其中每个用例是一个元组 $(E_A, E_B, \\mathbf{t})$：\n  1. $(1.0,\\;0.0,\\;\\mathbf{t}^{(\\text{base})})$，模拟具有典型运输的A基因型。\n  2. $(0.0,\\;1.2,\\;\\mathbf{t}^{(\\text{base})})$，模拟B表达增强且具有典型运输的情况。\n  3. $(0.8,\\;0.8,\\;\\mathbf{t}^{(\\text{base})})$，模拟共表达（AB基因型）且具有典型运输的情况。\n  4. $(0.0,\\;0.0,\\;\\mathbf{t}^{(\\text{base})})$，模拟O基因型，无转换。\n  5. $(1.0,\\;0.0,\\;[5,\\;5,\\;5]\\,\\mathrm{s})$，模拟A基因型且具有极快速运输的情况。\n\n最终输出规范：\n- 你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个元素是一个包含三个小数 $[f_A,f_B,f_H]$ 的内部列表，对应一个测试用例，并按上述顺序列出。值必须四舍五入到$6$位小数。例如，一个语法正确的输出形式为 $[[x_{11},x_{12},x_{13}],[x_{21},x_{22},x_{23}],\\dots]$，除了逗号和括号外没有额外的空白字符要求。", "solution": "**模型推导。**\n\n设糖蛋白的状态由其末端抗原表示，可以是H、A或B。过程始于一批全部处于H状态的糖蛋白进入高尔基体的第一个区室。高尔基体被建模为 $n=3$ 个顺序区室，索引为 $i \\in \\{1, 2, 3\\}$。\n\n设 $H_i$、$A_i$ 和 $B_i$ 分别表示在离开区室 $i$ 时，该批次中处于H、A和B状态的比例。进入区室1（为方便表示，索引为 $i=0$）时的初始条件是：\n$$\nH_0 = 1, \\quad A_0 = 0, \\quad B_0 = 0\n$$\n\n在每个区室 $i$ 内，一个糖蛋白停留时间为 $t_i$。在此期间，处于H状态的分子可以以伪一级速率常数 $k_{Ai}$ 转换为状态A，或以速率常数 $k_{Bi}$ 转换为状态B。这些转换被建模为竞争性的、独立的泊松过程。在区室 $i$ 中H转换的总风险率为各个速率之和：\n$$\n\\lambda_i = k_{Ai} + k_{Bi}\n$$\n速率常数由酶表达水平 $E_A$ 和 $E_B$ 以及内在催化效率 $\\mathbf{c}_A$ 和 $\\mathbf{c}_B$ 决定：\n$$\nk_{Ai} = E_A \\cdot c_{Ai}, \\quad k_{Bi} = E_B \\cdot c_{Bi}\n$$\n\n考虑一个进入区室 $i$ 的处于H状态的单个糖蛋白。在其停留时间 $t_i$ 内保持H状态的概率由速率为 $\\lambda_i$ 的指数分布的生存函数给出：\n$$\nP(\\text{在区室 } i \\text{ 内以H状态存活}) = e^{-\\lambda_i t_i}\n$$\n因此，它被转换为A或B的概率是：\n$$\nP(\\text{在区室 } i \\text{ 内发生转换}) = 1 - e^{-\\lambda_i t_i}\n$$\n如果发生转换（即 $\\lambda_i > 0$），其结果由相对速率决定。转换为状态A的条件概率是：\n$$\nP(\\text{H} \\to \\text{A} | \\text{发生转换}) = \\frac{k_{Ai}}{k_{Ai} + k_{Bi}} = \\frac{k_{Ai}}{\\lambda_i}\n$$\n转换为状态B的条件概率是：\n$$\nP(\\text{H} \\to \\text{B} | \\text{发生转换}) = \\frac{k_{Bi}}{k_{Ai} + k_{Bi}} = \\frac{k_{Bi}}{\\lambda_i}\n$$\n如果 $\\lambda_i=0$，则不发生转换，也就不需要这些条件概率。\n\n现在我们可以建立当这批糖蛋白从一个区室传递到下一个区室时，比例 $H_i$、$A_i$ 和 $B_i$ 的递推关系。设 $H_{i-1}$、$A_{i-1}$ 和 $B_{i-1}$ 是进入区室 $i$ 的比例。\n\n进入区室 $i$ 时仍处于H状态的批次比例是 $H_{i-1}$。只有这部分比例会发生转换。离开区室 $i$ 时仍保持H状态的比例是：\n$$\nH_i = H_{i-1} \\cdot e^{-\\lambda_i t_i}\n$$\n这是一个递推公式。将其展开，经过 $n$ 个区室后剩余的H总比例是：\n$$\nH_n = H_0 \\prod_{j=1}^{n} e^{-\\lambda_j t_j} = \\exp\\left(-\\sum_{j=1}^{n} \\lambda_j t_j\\right)\n$$\n\n已经处于A或B状态的糖蛋白是惰性的。新的A和B抗原仅由 $H_{i-1}$ 比例形成。在区室 $i$ 中A抗原携带者比例的增量，记为 $\\Delta A_i$，等于进入的H比例乘以转换概率，再乘以该转换为A的条件概率：\n$$\n\\Delta A_i = H_{i-1} \\cdot \\left(1 - e^{-\\lambda_i t_i}\\right) \\cdot \\frac{k_{Ai}}{\\lambda_i}\n$$\n对于B也类似：\n$$\n\\Delta B_i = H_{i-1} \\cdot \\left(1 - e^{-\\lambda_i t_i}\\right) \\cdot \\frac{k_{Bi}}{\\lambda_i}\n$$\n这些公式在 $\\lambda_i > 0$ 时成立。如果 $\\lambda_i=0$，则 $k_{Ai}=k_{Bi}=0$，项 $(1 - e^{-\\lambda_i t_i})$ 为零，从而正确地得到 $\\Delta A_i = 0$ 和 $\\Delta B_i = 0$。\n\n经过区室 $i$ 后的总比例是进入时的比例与新形成比例之和：\n$$\nA_i = A_{i-1} + \\Delta A_i\n$$\n$$\nB_i = B_{i-1} + \\Delta B_i\n$$\n\n离开最后一个区室（$i=3$）时的最终比例为 $(f_A, f_B, f_H) = (A_3, B_3, H_3)$。这些是通过对 $i=1, 2, 3$ 顺序应用递推关系计算得出的。\n\n**计算算法。**\n1. 初始化比例：$H \\leftarrow 1.0$， $A \\leftarrow 0.0$， $B \\leftarrow 0.0$。\n2. 对从 $1$ 到 $3$ 的每个区室 $i$：\n   a. 计算速率常数 $k_{Ai} = E_A \\cdot c_{Ai}$ 和 $k_{Bi} = E_B \\cdot c_{Bi}$。\n   b. 计算总风险率 $\\lambda_i = k_{Ai} + k_{Bi}$。\n   c. 确定进入的H中通过区室 $i$ 后存活下来的比例：$S_i = e^{-\\lambda_i t_i}$。\n   d. 确定进入的H中发生转换的比例：$C_i = 1 - S_i$。\n   e. 从当前的H比例中计算新生成的A和B的数量。如果 $\\lambda_i > 0$：\n      i. $\\Delta A = H \\cdot C_i \\cdot (k_{Ai} / \\lambda_i)$\n      ii. $\\Delta B = H \\cdot C_i \\cdot (k_{Bi} / \\lambda_i)$\n   f. 更新总比例：$A \\leftarrow A + \\Delta A$，$B \\leftarrow B + \\Delta B$。\n   g. 为下一阶段更新H比例：$H \\leftarrow H \\cdot S_i$。\n3. 最终计算出的 $A$、$B$ 和 $H$ 的值即为所需的比例 $f_A, f_B, f_H$。然后将它们四舍五入到$6$位小数。此过程确保了质量守恒，即在浮点精度和舍入误差允许的范围内，$f_A + f_B + f_H = 1$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the final fractions of A, B, and H antigens based on a \n    three-compartment Golgi model.\n    \"\"\"\n    \n    # Fixed parameters as defined in the problem statement.\n    c_A = np.array([2.0e-3, 4.0e-3, 1.0e-3])  # Catalytic efficiency for A-transferase\n    c_B = np.array([1.5e-3, 3.5e-3, 1.2e-3])  # Catalytic efficiency for B-transferase\n    t_base = np.array([600.0, 900.0, 600.0]) # Base residence times\n\n    # Test cases: (E_A, E_B, residence_times_vector)\n    test_cases = [\n        (1.0, 0.0, t_base),\n        (0.0, 1.2, t_base),\n        (0.8, 0.8, t_base),\n        (0.0, 0.0, t_base),\n        (1.0, 0.0, np.array([5.0, 5.0, 5.0]))\n    ]\n    \n    num_compartments = 3\n    final_results = []\n\n    for case in test_cases:\n        E_A, E_B, t = case\n        \n        # Calculate per-compartment rate constants\n        k_A_vec = E_A * c_A\n        k_B_vec = E_B * c_B\n        \n        # Initialize fractions entering the cis-Golgi\n        h_frac = 1.0\n        a_frac = 0.0\n        b_frac = 0.0\n\n        # Sequentially process through each of the three Golgi compartments\n        for i in range(num_compartments):\n            k_A_i = k_A_vec[i]\n            k_B_i = k_B_vec[i]\n            t_i = t[i]\n            \n            # Total hazard rate for H conversion in compartment i\n            lambda_i = k_A_i + k_B_i\n            \n            # Survival probability of H within the compartment\n            survival_prob = np.exp(-lambda_i * t_i)\n            \n            # Conversion probability of H within the compartment\n            conversion_prob = 1.0 - survival_prob\n            \n            # These are the fractions of the incoming H pool that are converted to A or B\n            newly_converted_a = 0.0\n            newly_converted_b = 0.0\n            \n            if lambda_i > 1e-12: # Check for non-zero conversion rate to avoid division by zero\n                # Conditional probabilities of converting to A or B\n                prob_a_given_conversion = k_A_i / lambda_i\n                prob_b_given_conversion = k_B_i / lambda_i\n                \n                # Update total A and B fractions. The new amounts are derived\n                # from the H fraction entering the current compartment.\n                newly_converted_a = h_frac * conversion_prob * prob_a_given_conversion\n                newly_converted_b = h_frac * conversion_prob * prob_b_given_conversion\n\n            a_frac += newly_converted_a\n            b_frac += newly_converted_b\n            \n            # The H fraction for the next compartment is the fraction that survived this one.\n            h_frac *= survival_prob\n\n        # Round results to 6 decimal places as required\n        result_tuple = [\n            round(a_frac, 6), \n            round(b_frac, 6), \n            round(h_frac, 6)\n        ]\n        final_results.append(result_tuple)\n\n    # Format the final output string exactly as specified.\n    # The output format is `[[f_A1,f_B1,f_H1],[...],...]`\n    # Use str() on list to get '[]' representation, then join.\n    output_str = f\"[{','.join(map(str, final_results))}]\"\n    \n    print(output_str)\n\nsolve()\n```", "id": "2772055"}]}