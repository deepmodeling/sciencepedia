{"hands_on_practices": [{"introduction": "系统发育分析的第一步是将生物体的性状转化为可分析的数据矩阵，这一过程充满了挑战。本练习将引导你处理形态学数据中常见的复杂情况，如同一个性状依赖于另一个性状（不适用数据）以及种内存在多种状态（多态性）。通过比较不同编码方案（有序 vs. 无序）对简约性得分的影响，你将亲身体会到数据编码决策如何深刻地影响系统发育推断的结果 [@problem_id:2840512]。", "problem": "一位研究人员正在研究一个由五个标记为 $t_{1}$、$t_{2}$、$t_{3}$、$t_{4}$ 和 $t_{5}$ 的分类单元构成的分支中，一个角质层结构的演化。初始形态矩阵包含一个表示该结构是否存在的主性状，一个描述该结构形状的依赖性状（仅当该结构存在时才有意义），以及一个独立的计数性状。一些分类单元在形状上表现出多态性，而在结构缺失的情况下，形状性状不适用。\n\n现给出以下观察结果：\n- 主性状，角质层结构的存在与否 ($P$)：状态编码为 $0$ 代表缺失， $1$ 代表存在。\n  - $t_{1}: 1$，$t_{2}: 1$，$t_{3}: 0$，$t_{4}: 1$，$t_{5}: 0$。\n- 结构形状 ($S$)：一个依赖性多态性状，仅在 $P=1$ 时定义，状态编码为 $0$ 代表圆形，$1$ 代表椭圆形，$2$ 代表三角形。多态状态由一个集合表示，当 $P=0$ 时出现不适用情况。\n  - $t_{1}: 0$，$t_{2}: \\{0,1\\}$，$t_{3}$: 不适用，$t_{4}: 2$，$t_{5}$：不适用。\n- 边缘刺的数量 ($C$)：一个独立计数性状，状态为 $0$、$1$ 和 $2$。\n  - $t_{1}: 0$，$t_{2}: 1$，$t_{3}: 2$，$t_{4}: 2$，$t_{5}: 0$。\n\n假定固定的、完全解析的有根树拓扑结构为\n$$\n\\big((t_{1},t_{2}),\\,(t_{3},\\,(t_{4},t_{5}))\\big).\n$$\n\n按照如下方式对矩阵进行简约重编码：在完整矩阵中保留主性状 $P$；对于依赖性状 $S$，通过从 $S$ 的评估中剪除不适用的条目（即 $P=0$ 的分类单元）来处理它们，并仅在跨越适用分类单元的诱导最小子树上计算步数。将末端的多态状态视为末端的状​​态集。\n\n在两种方案下评估简约性：\n- 方案 $\\mathrm{U}$：将 $P$ 视为无序二态性状，$S$ 视为无序多态性状，$C$ 视为有序多态性状。\n- 方案 $\\mathrm{O}$：将 $P$ 视为无序二态性状，$S$ 视为有序多态性状，$C$ 视为有序多态性状。\n\n对于无序多态性状，使用标准的等权重原则，即最小化状态变化的次数。对于有序多态性状，使用 Wagner 度量，步长成本为 $d(i,j)=|i-j|$。使用给定的数据和 $S$ 的简约编码规则，评估在每种方案下给定树的简约长度。\n\n报告量 $L_{\\mathrm{O}}-L_{\\mathrm{U}}$，其中 $L_{\\mathrm{U}}$ 是方案 $\\mathrm{U}$ 下的总树长，$L_{\\mathrm{O}}$ 是方案 $\\mathrm{O}$ 下的总树长。以无单位的单个整数形式表示您的最终答案。为您在构建重编码矩阵和性状类型分配时做出的每一个编码决策提供简要的理由。", "solution": "在尝试解答之前，对问题陈述进行验证。\n\n首先，逐字提取给定条件：\n- 分类单元：$t_{1}$、$t_{2}$、$t_{3}$、$t_{4}$ 和 $t_{5}$。\n- 主性状 $P$ (存在与否)：状态 $0$ (缺失)， $1$ (存在)。\n  - 数据：$t_{1}: 1$, $t_{2}: 1$, $t_{3}: 0$, $t_{4}: 1$, $t_{5}: 0$。\n- 依赖性状 $S$ (形状)：状态 $0$ (圆形)，$1$ (椭圆形)，$2$ (三角形)。多态性由集合表示。当 $P=0$ 时不适用。\n  - 数据: $t_{1}: 0$, $t_{2}: \\{0,1\\}$, $t_{3}$: 不适用, $t_{4}: 2$, $t_{5}$: 不适用。\n- 独立性状 $C$ (计数)：状态 $0, 1, 2$。\n  - 数据：$t_{1}: 0$, $t_{2}: 1$, $t_{3}: 2$, $t_{4}: 2$, $t_{5}: 0$。\n- 树拓扑结构：$\\big((t_{1}, t_{2}),\\,(t_{3},\\,(t_{4}, t_{5}))\\big)$。\n- $S$ 的简约重编码规则：“通过从 $S$ 的评估中剪除不适用条目……来处理它们，并仅在跨越适用分类单元的诱导最小子树上计算步数。将末端多态状态视为末端的状态集。”\n- 方案 $\\mathrm{U}$：$P$ 为无序二态，$S$ 为无序多态，$C$ 为有序多态。\n- 方案 $\\mathrm{O}$：$P$ 为无序二态，$S$ 为有序多态，$C$ 为有序多态。\n- 有序性状的成本函数：Wagner 度量，$d(i,j) = |i-j|$。\n- 目标：报告量 $L_{\\mathrm{O}} - L_{\\mathrm{U}}$。\n\n对问题进行有效性评估。该问题具有科学依据，因为它描述了系统发育学中的一个标准问题，使用了既定方法（简约性、Fitch 算法、Wagner 算法）和概念（依赖性状、多态性、不适用数据）。该问题定义明确，提供了所有必要的数据、固定的拓扑结构以及明确的性状编码和成本评估规则，从而可以得出一个唯一的、可计算的解。语言客观而精确。问题是完整且自洽的。因此，该问题被视为有效，并将提供解答。\n\n树的总简约长度是每个性状长度的总和：$L = L_{P} + L_{S} + L_{C}$。我们必须计算方案 $\\mathrm{U}$ ($L_{\\mathrm{U}}$) 和方案 $\\mathrm{O}$ ($L_{\\mathrm{O}}$) 下的总长度。性状 $P$ 和 $C$ 的处理在两种方案中是相同的，因此我们首先计算它们的长度。\n\n性状 $P$ (存在与否) 的分析：\n该性状是无序二态的。简约长度使用 Fitch 算法计算。末端的状态分配为 $S(t_{1})=\\{1\\}$, $S(t_{2})=\\{1\\}$, $S(t_{3})=\\{0\\}$, $S(t_{4})=\\{1\\}$, $S(t_{5})=\\{0\\}$。\n设内部节点为 $v_{1} = (t_{1},t_{2})$, $v_{2} = (t_{4},t_{5})$, $v_{3} = (t_{3}, v_{2})$，根节点为 $v_{R} = (v_{1}, v_{3})$。\n- 节点 $v_{1}$：$S(t_{1}) \\cap S(t_{2}) = \\{1\\} \\cap \\{1\\} = \\{1\\}$。状态集为 $\\{1\\}$。长度增加为 $0$。\n- 节点 $v_{2}$：$S(t_{4}) \\cap S(t_{5}) = \\{1\\} \\cap \\{0\\} = \\emptyset$。状态集为 $S(t_{4}) \\cup S(t_{5}) = \\{0,1\\}$。长度增加为 $1$。\n- 节点 $v_{3}$：$S(t_{3}) \\cap S(v_{2}) = \\{0\\} \\cap \\{0,1\\} = \\{0\\}$。状态集为 $\\{0\\}$。长度增加为 $0$。\n- 节点 $v_{R}$：$S(v_{1}) \\cap S(v_{3}) = \\{1\\} \\cap \\{0\\} = \\emptyset$。状态集为 $S(v_{1}) \\cup S(v_{3}) = \\{0,1\\}$。长度增加为 $1$。\n性状 $P$ 的总长度为 $L_{P} = 0 + 1 + 0 + 1 = 2$。\n\n性状 $C$ (刺数量) 的分析：\n该性状是有序多态的。长度使用 Wagner 算法计算，其中成本为 $d(i,j) = |i-j|$。我们将节点处的状态集表示为区间。\n- 末端状态：$I(t_{1})=[0,0]$, $I(t_{2})=[1,1]$, $I(t_{3})=[2,2]$, $I(t_{4})=[2,2]$, $I(t_{5})=[0,0]$。\n- 节点 $v_{1}$：子节点状态为 $[0,0]$ 和 $[1,1]$。区间不重叠。成本为 $\\min_{i \\in [0,0], j \\in [1,1]} |i-j| = |1-0| = 1$。新的节点状态区间为 $[0,1]$。\n- 节点 $v_{2}$：子节点状态为 $[2,2]$ 和 $[0,0]$。区间不重叠。成本为 $|2-0|=2$。新的节点状态区间为 $[0,2]$。\n- 节点 $v_{3}$：子节点状态为 $[2,2]$ (来自 $t_{3}$) 和 $[0,2]$ (来自 $v_{2}$)。交集为 $[2,2]$。成本为 $0$。新的节点状态区间为 $[2,2]$。\n- 节点 $v_{R}$：子节点状态为 $[0,1]$ (来自 $v_{1}$) 和 $[2,2]$ (来自 $v_{3}$)。区间不重叠。成本为 $\\min_{i \\in [0,1], j \\in [2,2]} |i-j| = |2-1|=1$。\n性状 $C$ 的总长度为 $L_{C} = 1 + 2 + 0 + 1 = 4$。\n\n性状 $S$ (形状) 的分析：\n这是一个依赖性状。根据简约重编码规则，我们确定此性状适用的分类单元，即那些 $P=1$ 的分类单元：$t_{1}$, $t_{2}$ 和 $t_{4}$。连接这三个分类单元的最小子树是 $\\big((t_{1},t_{2}), t_{4}\\big)$。性状 $S$ 的长度是在这个简化的三分类单元树上计算的。状态为 $t_{1}: 0$, $t_{2}: \\{0,1\\}$, $t_{4}: 2$。\n\n在方案 $\\mathrm{U}$ 下， $S$ 是无序多态的。我们使用 Fitch 算法。\n- 末端状态集：$S(t_{1})=\\{0\\}$，$S(t_{2})=\\{0,1\\}$ (多态性被视作一个状态集)，$S(t_{4})=\\{2\\}$。\n- 设内部节点为 $v_{S1} = (t_{1}, t_{2})$。$S(t_{1}) \\cap S(t_{2}) = \\{0\\} \\cap \\{0,1\\} = \\{0\\}$。集合非空，因此 $S(v_{S1}) = \\{0\\}$。长度增加为 $0$。\n- 在根节点 $v_{SR} = (v_{S1}, t_{4})$，我们有 $S(v_{S1}) \\cap S(t_{4}) = \\{0\\} \\cap \\{2\\} = \\emptyset$。集合为空，因此 $S(v_{SR}) = S(v_{S1}) \\cup S(t_{4}) = \\{0,2\\}$。长度增加为 $1$。\n方案 $\\mathrm{U}$ 下性状 $S$ 的总长度为 $L_{S, \\mathrm{U}} = 0 + 1 = 1$。\n\n在方案 $\\mathrm{O}$ 下， $S$ 是有序多态的。我们在同一个简化树上使用 Wagner 算法。$t_2$ 处的多态性被视为区间 $[0,1]$。\n- 末端状态区间：$I(t_{1})=[0,0]$, $I(t_{2})=[0,1]$, $I(t_{4})=[2,2]$。\n- 在节点 $v_{S1} = (t_{1}, t_{2})$，子区间为 $[0,0]$ 和 $[0,1]$。它们的交集为 $[0,0]$，非空。成本为 $0$。新的节点区间为 $[0,0]$。\n- 在根节点 $v_{SR} = (v_{S1}, t_{4})$，子区间为 $[0,0]$ 和 $[2,2]$。它们不重叠。成本为 $\\min_{i \\in [0,0], j \\in [2,2]} |i-j| = |2-0| = 2$。\n方案 $\\mathrm{O}$ 下性状 $S$ 的总长度为 $L_{S, \\mathrm{O}} = 0 + 2 = 2$。\n\n最终计算：\n方案 $\\mathrm{U}$ 下的总树长由下式给出：\n$$L_{\\mathrm{U}} = L_{P} + L_{S, \\mathrm{U}} + L_{C} = 2 + 1 + 4 = 7$$\n方案 $\\mathrm{O}$ 下的总树长由下式给出：\n$$L_{\\mathrm{O}} = L_{P} + L_{S, \\mathrm{O}} + L_{C} = 2 + 2 + 4 = 8$$\n所要求的量是这两个长度之差：\n$$L_{\\mathrm{O}} - L_{\\mathrm{U}} = 8 - 7 = 1$$\n差异完全源于对形状性状 $S$ 的处理。将其视为有序 ($0 \\to 1 \\to 2$) 对简化树上从状态集 $\\{0\\}$ 到状态 $\\{2\\}$ 的变化施加了比将其视为无序时更大的惩罚。", "answer": "$$\n\\boxed{1}\n$$", "id": "2840512"}, {"introduction": "距离法是构建系统发育树的一类核心算法，但不同的算法基于不同的进化假设。本练习将让你使用同一个距离矩阵，分别应用两种经典的距离法：UPGMA（非加权配对平均法）和NJ（邻接法）。通过亲手计算并比较它们的结果，你将深刻理解分子钟假设（超度量性）与进化速率可变假设（可加性）之间的关键区别，并体会到选择与数据特性相匹配的算法是何等重要 [@problem_id:2840492]。", "problem": "考虑四个分类单元 $\\{A,B,C,D\\}$，其对称成对距离矩阵 $D$ 如下（可解释为每个位点的预期替换数）：\n$$\nD \\;=\\; \\begin{pmatrix}\n0 & 0.17 & 0.26 & 0.29\\\\\n0.17 & 0 & 0.27 & 0.22\\\\\n0.26 & 0.27 & 0 & 0.39\\\\\n0.29 & 0.22 & 0.39 & 0\n\\end{pmatrix}.\n$$\n在三点条件的意义上，该矩阵近似但非严格超度量。仅从系统发育学和基于距离的树重建的核心定义出发，完成以下任务：\n\n- 使用非加权配对算术平均法 (UPGMA)，为 $\\{A,B,C,D\\}$ 构建有根超度量树，包括算法所隐含的所有中间合并高度和末端分支长度，并计算此 UPGMA 树中的路径距离与 $D$ 矩阵各项之间的平方和误差 $\\mathrm{SSE}_{\\mathrm{UPGMA}}$。\n\n- 使用邻接法 (NJ)，为 $\\{A,B,C,D\\}$ 构建无根可加树，包括确定首个连接对、中间简化距离和最终分支长度，并计算此 NJ 树中的路径距离与 $D$ 矩阵各项之间的平方和误差 $\\mathrm{SSE}_{\\mathrm{NJ}}$。\n\n- 运用超度量性的定义以及 UPGMA 和 NJ 的算法标准，解释为什么 UPGMA 未能从此数据中恢复正确的分组，而 NJ 却成功了。\n\n最后，计算差值\n$$\n\\Delta \\;=\\; \\mathrm{SSE}_{\\mathrm{UPGMA}} \\;-\\; \\mathrm{SSE}_{\\mathrm{NJ}}.\n$$\n将 $\\Delta$ 作为实数报告。将您的答案四舍五入至四位有效数字。不要包含任何单位。", "solution": "该问题要求基于给定的成对距离矩阵 $D$，使用两种不同的基于距离的方法——UPGMA 和邻接法，为四个分类单元 $\\{A, B, C, D\\}$ 构建并评估系统发育树。首先，我们验证该问题。给定条件是分类单元集合和对称距离矩阵 $D$：\n$$\nD = \\begin{pmatrix}\n0 & 0.17 & 0.26 & 0.29 \\\\\n0.17 & 0 & 0.27 & 0.22 \\\\\n0.26 & 0.27 & 0 & 0.39 \\\\\n0.29 & 0.22 & 0.39 & 0\n\\end{pmatrix}\n$$\n该问题具有科学依据，提法明确且客观。这是系统发育重建中的一个标准练习。所用数据和方法在普通生物学领域，特别是系统发育学领域，是标准化的。问题有效。我们开始求解。\n\n首先，我们分析矩阵 $D$ 的性质。该矩阵不是超度量的。例如，对于三元组 $\\{A, C, D\\}$，距离为 $d(A,C)=0.26$，$d(A,D)=0.29$ 和 $d(C,D)=0.39$。两个最大的距离 $0.39$ 和 $0.29$ 并不相等，这违反了三点条件。\n然而，该矩阵是完全可加的。对于这四个分类单元，我们检验四点条件。令相对两对距离之和为 $S_1 = d(A,B)+d(C,D)$，$S_2 = d(A,C)+d(B,D)$ 和 $S_3 = d(A,D)+d(B,C)$。\n$S_1 = 0.17 + 0.39 = 0.56$\n$S_2 = 0.26 + 0.22 = 0.48$\n$S_3 = 0.29 + 0.27 = 0.56$\n由于 $S_1 = S_3 > S_2$，该矩阵是可加的，并对应于无根树拓扑 $((A,C),(B,D))$。\n\n**非加权配对算术平均法 (UPGMA)**\n\nUPGMA 是一种层次聚类算法，它假设存在分子钟，即数据是超度量的。\n**迭代 1：** 初始簇为 $\\{A\\}, \\{B\\}, \\{C\\}, \\{D\\}$。$D$ 中最小的距离是 $d(A,B) = 0.17$。我们将 $A$ 和 $B$ 合并成一个新的簇 $(AB)$。连接它们的节点高度为 $h_{(AB)} = \\frac{d(A,B)}{2} = \\frac{0.17}{2} = 0.085$。\n计算这个新簇到 $C$ 和 $D$ 的距离：\n$d((AB), C) = \\frac{d(A,C) + d(B,C)}{2} = \\frac{0.26 + 0.27}{2} = 0.265$\n$d((AB), D) = \\frac{d(A,D) + d(B,D)}{2} = \\frac{0.29 + 0.22}{2} = 0.255$\n新的距离矩阵为：\n$$\nD_1 = \\begin{array}{c|ccc}\n & (AB) & C & D \\\\ \\hline\n(AB) & 0 & 0.265 & 0.255 \\\\\nC & 0.265 & 0 & 0.39 \\\\\nD & 0.255 & 0.39 & 0\n\\end{array}\n$$\n**迭代 2：** $D_1$ 中最小的距离是 $d((AB), D) = 0.255$。我们将簇 $(AB)$ 与 $D$ 合并，形成 $((AB)D)$。这个新节点的高度是 $h_{((AB)D)} = \\frac{d((AB),D)}{2} = \\frac{0.255}{2} = 0.1275$。\n\n**迭代 3：** 剩余的簇是 $((AB)D)$ 和 $C$。根据 UPGMA（平均连锁）的定义，它们之间的距离是：\n$d(((AB)D), C) = \\frac{d(A,C) + d(B,C) + d(D,C)}{3} = \\frac{0.26 + 0.27 + 0.39}{3} = \\frac{0.92}{3} \\approx 0.3067$。\n我们合并它们。根节点的高度是 $h_{root} = \\frac{1}{2} d(((AB)D), C) = \\frac{1}{2} \\cdot \\frac{0.92}{3} = \\frac{0.46}{3} \\approx 0.1533$。\n\n最终得到的 UPGMA 树的拓扑结构为 $(((A,B),D),C)$。此树中的路径距离 $D_{\\mathrm{UPGMA}}$ 由最近共同祖先高度的两倍给出。\n$d_{\\mathrm{UPGMA}}(A,B) = 2 h_{(AB)} = 2(0.085) = 0.17$\n$d_{\\mathrm{UPGMA}}(A,D) = d_{\\mathrm{UPGMA}}(B,D) = 2 h_{((AB)D)} = 2(0.1275) = 0.255$\n$d_{\\mathrm{UPGMA}}(A,C) = d_{\\mathrm{UPGMA}}(B,C) = d_{\\mathrm{UPGMA}}(D,C) = 2 h_{root} = 2 (\\frac{0.46}{3}) = \\frac{0.92}{3}$\n\n平方和误差为 $\\mathrm{SSE}_{\\mathrm{UPGMA}} = \\sum_{i<j} (D_{ij} - (D_{\\mathrm{UPGMA}})_{ij})^2$。\n$\\mathrm{SSE}_{\\mathrm{UPGMA}} = (0.17 - 0.17)^2 + (0.26 - \\frac{0.92}{3})^2 + (0.29 - 0.255)^2 + (0.27 - \\frac{0.92}{3})^2 + (0.22 - 0.255)^2 + (0.39 - \\frac{0.92}{3})^2$\n$= 0 + (\\frac{0.78 - 0.92}{3})^2 + (0.035)^2 + (\\frac{0.81 - 0.92}{3})^2 + (-0.035)^2 + (\\frac{1.17 - 0.92}{3})^2$\n$= (\\frac{-0.14}{3})^2 + (0.035)^2 + (\\frac{-0.11}{3})^2 + (-0.035)^2 + (\\frac{0.25}{3})^2$\n$= \\frac{0.0196}{9} + 0.001225 + \\frac{0.0121}{9} + 0.001225 + \\frac{0.0625}{9}$\n$= \\frac{0.0196+0.0121+0.0625}{9} + 2(0.001225) = \\frac{0.0942}{9} + 0.00245 = 0.010466... + 0.00245 = \\frac{31}{2400} \\approx 0.0129166...$\n\n**邻接法 (NJ)**\n\nNJ 旨在重建可加树。\n**迭代 1：** 对 $N=4$ 个分类单元，我们计算 $r_i = \\sum_{k \\ne i} d(i,k)$。\n$r_A=0.17+0.26+0.29=0.72$\n$r_B=0.17+0.27+0.22=0.66$\n$r_C=0.26+0.27+0.39=0.92$\n$r_D=0.29+0.22+0.39=0.90$\n选择标准是最小化 $Q_{ij} = (N-2)d(i,j) - r_i - r_j = 2d(i,j) - r_i - r_j$。\n$Q_{AC} = 2(0.26) - 0.72 - 0.92 = 0.52 - 1.64 = -1.12$\n$Q_{BD} = 2(0.22) - 0.66 - 0.90 = 0.44 - 1.56 = -1.12$\n其他 $Q$ 值均为 $-1.04$。最小值为 $-1.12$，对应于配对 $(A,C)$ 和 $(B,D)$。这与四点条件一致。我们选择先连接 $(A,C)$；这是确定的第一个配对。创建一个新节点 $U$。\n到新节点 $U$ 的分支长度为：\n$v_A = d(A,U) = \\frac{1}{2}d(A,C) + \\frac{1}{2(N-2)}(r_A-r_C) = \\frac{0.26}{2} + \\frac{0.72-0.92}{4} = 0.13 - 0.05 = 0.08$。\n$v_C = d(C,U) = d(A,C) - v_A = 0.26 - 0.08 = 0.18$。\n从 $B$ 和 $D$ 到新节点 $U$ 的中间简化距离为：\n$d(B,U) = \\frac{1}{2}(d(A,B)+d(C,B)-d(A,C)) = \\frac{1}{2}(0.17+0.27-0.26) = 0.09$。\n$d(D,U) = \\frac{1}{2}(d(A,D)+d(C,D)-d(A,C)) = \\frac{1}{2}(0.29+0.39-0.26) = 0.21$。\n\n**迭代 2：** 剩下的分类单元是 $\\{B,D,U\\}$，它们之间的距离是 $d(B,D)=0.22$，$d(B,U)=0.09$，$d(D,U)=0.21$。这定义了最终的树，其中一个中心节点 $V$ 连接 $B,D,U$。最后三个分支的长度是：\n$v_B = d(B,V) = \\frac{1}{2}(d(B,D)+d(B,U)-d(D,U)) = \\frac{1}{2}(0.22+0.09-0.21) = 0.05$。\n$v_D = d(D,V) = \\frac{1}{2}(d(B,D)+d(D,U)-d(B,U)) = \\frac{1}{2}(0.22+0.21-0.09) = 0.17$。\n$v_{UV} = d(U,V) = \\frac{1}{2}(d(B,U)+d(D,U)-d(B,D)) = \\frac{1}{2}(0.09+0.21-0.22) = 0.04$。\n最终的分支长度为：$v_A=0.08$, $v_C=0.18$, $v_B=0.05$, $v_D=0.17$，内部支长为 $v_{UV}=0.04$。拓扑结构为 $((A,C),(B,D))$。\nNJ 树中的路径距离 $D_{\\mathrm{NJ}}$ 与原始矩阵 $D$ 完全匹配：\n$d_{\\mathrm{NJ}}(A,C) = v_A+v_C = 0.08+0.18 = 0.26$。\n$d_{\\mathrm{NJ}}(B,D) = v_B+v_D = 0.05+0.17 = 0.22$。\n$d_{\\mathrm{NJ}}(A,B) = v_A+v_{UV}+v_B = 0.08+0.04+0.05 = 0.17$。\n$d_{\\mathrm{NJ}}(C,D) = v_C+v_{UV}+v_D = 0.18+0.04+0.17 = 0.39$。\n由于 $D_{\\mathrm{NJ}} = D$，平方和误差为 $\\mathrm{SSE}_{\\mathrm{NJ}} = 0$。\n\n**关于 UPGMA 失败和 NJ 成功的解释**\n\nUPGMA 失败是因为它在分子钟假设下运行，该假设要求距离矩阵是超度量的。该算法的标准是在每一步贪婪地合并距离最小的簇对。对于给定的矩阵 $D$，全局最小距离是 $d(A,B)=0.17$。因此，UPGMA 错误地将 $A$ 和 $B$ 配对，强制生成了 $(((A,B),D),C)$ 的拓扑结构，这与四点条件揭示的真实可加结构 $((A,C),(B,D))$ 相矛盾。基础数据不是超度量的，正如三点条件的违反所显示的，这意味着进化速率在不同谱系间存在差异。\n\nNJ 成功是因为其目标是找到最能拟合可加距离矩阵的树。所提供的数据是完全可加的，满足拓扑结构 $((A,C),(B,D))$ 的四点条件。NJ 的选择标准，即最小化 $Q_{ij}$ 值，在数学上被构造成用于识别可加树中的真实邻居。因此，它正确地将 $(A,C)$ 和 $(B,D)$ 识别为邻居，并重建了正确的树拓扑和分支长度，从而完美地拟合了数据 ($\\mathrm{SSE}_{\\mathrm{NJ}}=0$)。NJ 不假设分子钟，并且能够适应谱系特异性的速率变异。\n\n**最终计算**\n\n平方和误差的差值为：\n$\\Delta = \\mathrm{SSE}_{\\mathrm{UPGMA}} - \\mathrm{SSE}_{\\mathrm{NJ}} = \\frac{31}{2400} - 0 = \\frac{31}{2400} \\approx 0.0129166...$\n四舍五入到四位有效数字，我们得到 $\\Delta = 0.01292$。", "answer": "$$\\boxed{0.01292}$$", "id": "2840492"}, {"introduction": "系统发育推断，尤其是使用自展法（bootstrapping）等重抽样技术时，通常会产生大量候选树，反映了数据中的不确定性。如何从这些树中提炼出一个可靠的结论？本练习将指导你处理一组自展复制树，计算其中各分支（进化枝）的支持率，并构建严格共有树和多数决定共有树。这个过程是总结和展示系统发育分析结果的标准流程，能帮助你准确地评估不同进化关系的可信度 [@problem_id:2840470]。", "problem": "给定一个包含数个有根、完全二分的系统发育树的集合，这些树基于相同的分类单元集 $\\{A,B,C,D,E\\}$，其中 $E$ 是固定的外类群（所有树都通过指定 $E$ 为外类群进行定根）。该集合由 $100$ 次非参数自举重复构成，汇总为 $5$ 种唯一的拓扑结构及其重复计数（支持度）。这些树以Newick格式书写如下，每种拓扑结构的重复计数在括号内给出：\n\n- $((A,B),(C,D),E)$，计数为 $(40)$，表示有根树 $(((A,B),(C,D)),E)$。\n- $(A,(B,(C,D)),E)$，计数为 $(25)$，表示有根树 $((A,(B,(C,D))),E)$。\n- $(((A,B),C),D,E)$，计数为 $(20)$，表示有根树 $((((A,B),C),D),E)$。\n- $((A,(B,C)),D,E)$，计数为 $(10)$，表示有根树 $(((A,(B,C)),D),E)$。\n- $((A,D),(B,C),E)$，计数为 $(5)$，表示有根树 $(((A,D),(B,C)),E)$。\n\n任务：\n\n1) 使用自举重复计数作为权重，计算在 $100$ 棵树中观察到的每个不同非平凡分支的频率（表示为 $0$到$1$之间的小数）。这里，非平凡分支是指 $\\{A,B,C,D,E\\}$ 的任何大小至少为 $2$ 的真子集，且该子集对应于至少一棵有根树中的一个节点；不计算单个叶节点或全集 $\\{A,B,C,D,E\\}$。明确列出每个此类分支及其频率。\n\n2) 通过仅包含所有树中都出现的分支（频率为 $1$）来构建严格一致树。识别由于缺乏一致解析而产生的任何多岐点（具有超过 $2$ 个直接后代的节点），并说明严格一致树包含多少个多岐点。\n\n3) 通过包含所有频率严格大于 $0.5$ 的分支来构建多数决一致树。通过相容性定义来验证这些分支的相容性，即如果两个分支中的一个是另一个的子集，或者它们是不相交的，则这两个分支是相容的。识别多数决一致树中的任何多岐点，并说明它包含多少个多岐点。\n\n最后，设 $P$ 为两棵一致树的多岐点总数，设 $S_{\\mathrm{maj}}$ 为多数决一致树中包含的非平凡分支的频率之和。计算乘积 $R = P \\times S_{\\mathrm{maj}}$。给出 $R$ 的最终数值；无需单位，也无需四舍五入。", "solution": "所提出的问题具有科学依据，表述清晰且客观。它基于系统发育学领域已建立的形式化方法，特别是基于自举重复构建和解释一致树的方法。所提供的数据是自洽的，足以推导出唯一的解。因此，该问题是有效的。\n\n任务是分析一组包含 $100$ 棵自举重复树的集合，这些树基于分类单元集 $\\{A,B,C,D,E\\}$，其中 $E$ 是外类群。我们必须计算分支频率，构建严格一致树和多数决一致树，并根据这些结果进行最终计算。\n\n**第1步：识别所有不同的非平凡分支并计算其频率。**\n一个非平凡分支是 $\\{A,B,C,D,E\\}$ 的一个真子集，包含至少 $2$ 个分类单元。总重复次数为 $N_{total} = 100$。频率的计算方法是：包含某个给定分支的树的计数总和，除以总重复次数 $N_{total}$。\n\n这 $5$ 种唯一的拓扑结构及其计数如下：\n1.  拓扑 $T_1$: `(((A,B),(C,D)),E)`，计数 $n_1 = 40$。非平凡分支： $\\{A,B\\}$, $\\{C,D\\}$, $\\{A,B,C,D\\}$。\n2.  拓扑 $T_2$: `((A,(B,(C,D))),E)`，计数 $n_2 = 25$。非平凡分支： $\\{C,D\\}$, $\\{B,C,D\\}$, $\\{A,B,C,D\\}$。\n3.  拓扑 $T_3$: `((((A,B),C),D),E)`，计数 $n_3 = 20$。非平凡分支： $\\{A,B\\}$, $\\{A,B,C\\}$, $\\{A,B,C,D\\}$。\n4.  拓扑 $T_4$: `(((A,(B,C)),D),E)`，计数 $n_4 = 10$。非平凡分支： $\\{B,C\\}$, $\\{A,B,C\\}$, $\\{A,B,C,D\\}$。\n5.  拓扑 $T_5$: `(((A,D),(B,C)),E)`，计数 $n_5 = 5$。非平凡分支： $\\{A,D\\}$, $\\{B,C\\}$, $\\{A,B,C,D\\}$。\n\n现在，我们列出所有唯一的非平凡分支，并加总其支持计数：\n-   分支 $\\{A,B,C,D\\}$：出现在 $T_1, T_2, T_3, T_4, T_5$ 中。计数 = $n_1+n_2+n_3+n_4+n_5 = 40+25+20+10+5 = 100$。\n    频率 $f_{\\{A,B,C,D\\}} = \\frac{100}{100} = 1.0$。\n-   分支 $\\{C,D\\}$：出现在 $T_1, T_2$ 中。计数 = $n_1+n_2 = 40+25 = 65$。\n    频率 $f_{\\{C,D\\}} = \\frac{65}{100} = 0.65$。\n-   分支 $\\{A,B\\}$：出现在 $T_1, T_3$ 中。计数 = $n_1+n_3 = 40+20 = 60$。\n    频率 $f_{\\{A,B\\}} = \\frac{60}{100} = 0.60$。\n-   分支 $\\{A,B,C\\}$：出现在 $T_3, T_4$ 中。计数 = $n_3+n_4 = 20+10 = 30$。\n    频率 $f_{\\{A,B,C\\}} = \\frac{30}{100} = 0.30$。\n-   分支 $\\{B,C,D\\}$：出现在 $T_2$ 中。计数 = $n_2 = 25$。\n    频率 $f_{\\{B,C,D\\}} = \\frac{25}{100} = 0.25$。\n-   分支 $\\{B,C\\}$：出现在 $T_4, T_5$ 中。计数 = $n_4+n_5 = 10+5 = 15$。\n    频率 $f_{\\{B,C\\}} = \\frac{15}{100} = 0.15$。\n-   分支 $\\{A,D\\}$：出现在 $T_5$ 中。计数 = $n_5 = 5$。\n    频率 $f_{\\{A,D\\}} = \\frac{5}{100} = 0.05$。\n\n**第2步：构建严格一致树并计算其多岐点。**\n严格一致树只包含频率为 $1.0$ 的分支。根据我们的分析，只有一个非平凡分支满足此标准：$\\{A,B,C,D\\}$。这个分支定义了与外类群 $E$ 分开的内类群。由于没有其他分支出现在所有 $100$ 棵树中，因此分类单元 $A, B, C, D$ 之间的关系是未解析的。\n这导致生成一棵树，其根节点分裂为外类群 $E$ 和一个代表内类群共同祖先的节点。这个内类群节点随后同时分裂为四个分类单元 $A, B, C, D$。这样一个具有两个以上后代的节点就是一个多岐点。其Newick表示法为 `((A,B,C,D),E)`。\n$\\{A,B,C,D\\}$ 的祖先节点有四个子节点（$A,B,C,D$），因此构成一个多岐点。根节点有两个子节点（内类群节点和分类单元 $E$），因此是二分的。\n严格一致树中的多岐点总数为 $1$。\n\n**第3步：构建多数决一致树并计算其多岐点。**\n多数决一致树包含所有频率严格大于 $0.5$ 的分支。从我们的频率列表中：\n-   $\\{A,B,C,D\\}$：频率 $1.0 > 0.5$\n-   $\\{C,D\\}$：频率 $0.65 > 0.5$\n-   $\\{A,B\\}$：频率 $0.60 > 0.5$\n\n所有其他分支的频率均 $\\le 0.5$。我们必须检查这三个分支是否相容。如果两个分支 $C_1, C_2$ 中一个是另一个的子集（$C_1 \\subset C_2$ 或 $C_2 \\subset C_1$），或者它们是不相交的（$C_1 \\cap C_2 = \\emptyset$），那么它们就是相容的。\n-   设 $C_1 = \\{A,B,C,D\\}$，$C_2 = \\{A,B\\}$，$C_3 = \\{C,D\\}$。\n-   比较 $C_2$ 和 $C_1$：$C_2 \\subset C_1$。它们相容。\n-   比较 $C_3$ 和 $C_1$：$C_3 \\subset C_1$。它们相容。\n-   比较 $C_2$ 和 $C_3$：$C_2 \\cap C_3 = \\{A,B\\} \\cap \\{C,D\\} = \\emptyset$。它们相容。\n由于所有分支相互兼容，它们可以表示在同一棵树上。\n-   分支 $\\{A,B,C,D\\}$ 将内类群与外类群 $E$ 分开。\n-   在内类群中，不相交的分支 $\\{A,B\\}$ 和 $\\{C,D\\}$ 形成一个划分，这意味着 $\\{A,B,C,D\\}$ 的共同祖先分裂为 $\\{A,B\\}$ 的共同祖先和 $\\{C,D\\}$ 的共同祖先。\n这定义了一棵完全解析的、二分的树，其Newick表示法为 `(((A,B),(C,D)),E)`。在这棵树中，每个内部节点都恰好有两个后代。因此，没有多岐点。\n多数决一致树中的多岐点总数为 $0$。\n\n**第4步：计算最终值 $R$。**\n首先，我们求出 $P$，即两棵一致树的多岐点总数。\n$$P = (\\text{严格一致树中的多岐点}) + (\\text{多数决一致树中的多岐点}) = 1 + 0 = 1$$\n接下来，我们求出 $S_{\\mathrm{maj}}$，即多数决一致树中包含的非平凡分支的频率之和。这些分支是 $\\{A,B,C,D\\}$、$\\{C,D\\}$ 和 $\\{A,B\\}$。\n$$S_{\\mathrm{maj}} = f_{\\{A,B,C,D\\}} + f_{\\{C,D\\}} + f_{\\{A,B\\}} = 1.0 + 0.65 + 0.60 = 2.25$$\n最后，我们计算乘积 $R = P \\times S_{\\mathrm{maj}}$。\n$$R = 1 \\times 2.25 = 2.25$$", "answer": "$$\\boxed{2.25}$$", "id": "2840470"}]}