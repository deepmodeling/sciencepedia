{"hands_on_practices": [{"introduction": "检测古老的基因流，即基因渗入，是理解杂交区和复杂物种形成历史的基础。$D$统计量，也称为ABBA-BABA检验，提供了一个强大的框架，用于在存在不完全谱系分选（ILS）这一混淆因素的情况下识别基因渗入。本练习将引导你推导无基因流零假设下$D$统计量的理论基础，然后通过块式刀切法（block jackknife）进行动手实践，估算其统计不确定性，这是解读基因组数据的关键技能。[@problem_id:2775031]", "problem": "在一个形成接触带的近缘谱系演化支中，三个内群群体排列在一个有根物种树 $((H_{1},H_{2}),H_{3})$ 上，并有一个外群 $O$ 用于区分祖先等位基因与衍生等位基因。假定为无穷位点模型、中性、无重复突变，并且在所有分析的位点上，外群状态为真实的祖先状态。令 $\\mathrm{ABBA}$表示衍生等位基因存在于 $H_{2}$ 和 $H_{3}$ 但不存在于 $H_{1}$ 的位点，令 $\\mathrm{BABA}$ 表示衍生等位基因存在于 $H_{1}$ 和 $H_{3}$ 但不存在于 $H_{2}$ 的位点。考虑D-统计量\n$$\nD \\equiv \\frac{\\mathrm{ABBA}-\\mathrm{BABA}}{\\mathrm{ABBA}+\\mathrm{BABA}}.\n$$\n您将检验内群谱系间无分化后基因流的原假设（允许不完全谱系分选），然后通过区块刀切法估计全基因组估计量 $\\hat{D}$ 的抽样方差。\n\n任务：\n1. 以溯祖框架和无穷位点模型为基本依据，推导在允许不完全谱系分选但内群谱系间无基因流的原假设下，$D$ 的期望值 $\\mathbb{E}[D]$。您的推导应从不一致基因树产生的位点模式的定义，以及导致 $\\mathrm{ABBA}$ 和 $\\mathrm{BABA}$ 位点模式的谱系合并的对称性开始。\n2. 现在，假设基因组被划分为 $B=6$ 个不重叠、近似连锁平衡的区块（假设区块足够大，以至于对于区块刀切法的目的而言，这些区块实际上是独立的）。对于区块 $b\\in\\{1,2,3,4,5,6\\}$，您观测到的计数 $(\\mathrm{ABBA}_{b},\\mathrm{BABA}_{b})$ 如下：\n$$\n( \\mathrm{ABBA}_{1},\\mathrm{BABA}_{1} )=(120,100),\\quad\n( \\mathrm{ABBA}_{2},\\mathrm{BABA}_{2} )=(80,90),\\quad\n( \\mathrm{ABBA}_{3},\\mathrm{BABA}_{3} )=(150,140),\n$$\n$$\n( \\mathrm{ABBA}_{4},\\mathrm{BABA}_{4} )=(60,70),\\quad\n( \\mathrm{ABBA}_{5},\\mathrm{BABA}_{5} )=(110,100),\\quad\n( \\mathrm{ABBA}_{6},\\mathrm{BABA}_{6} )=(90,95).\n$$\n定义每个区块的差值 $x_{b}\\equiv \\mathrm{ABBA}_{b}-\\mathrm{BABA}_{b}$ 和每个区块的分母 $y_{b}\\equiv \\mathrm{ABBA}_{b}+\\mathrm{BABA}_{b}$。令全基因组估计量为 $\\hat{D}=\\left(\\sum_{b=1}^{6} x_{b}\\right)\\Big/\\left(\\sum_{b=1}^{6} y_{b}\\right)$。将这些区块视为刀切法单元，执行删一区块刀切法来估计这6个区块上 $\\hat{D}$ 的抽样方差。计算 $\\hat{D}$ 的刀切法方差估计量的数值。\n\n只需报告估计方差的数值，四舍五入到四位有效数字。无需单位。", "solution": "这个问题包含两部分。第一部分要求在无基因渗入的原假设下，对D-统计量的期望值进行理论推导。第二部分要求使用区块刀切法对D-统计量的抽样方差进行数值估计。\n\n**第一部分：在原假设下推导 $\\mathbb{E}[D]$**\n\n问题定义了一个拓扑结构为 $((H_{1},H_{2}),H_{3})$ 的有根物种树和一个外群 $O$。D-统计量定义为 $D \\equiv \\frac{\\mathrm{ABBA}-\\mathrm{BABA}}{\\mathrm{ABBA}+\\mathrm{BABA}}$，其中 $\\mathrm{ABBA}$ 和 $\\mathrm{BABA}$ 指的是特定双等位基因位点模式的计数。外群 $O$ 被假定携带祖先等位基因，我们记作'A'。衍生等位基因记作'B'。\n如果 $(H_1, H_2, H_3, O)$ 的等位基因状态为 (A, B, B, A)，则该位点呈现ABBA模式。鉴于外群 $O$ 是祖先状态，正确的模式是 $(H_1, H_2, H_3)$ 为 $(\\text{A}, \\text{B}, \\text{B})$。当一个独特的突变发生在基因树上连接 $H_2$ 和 $H_3$ 谱系（并排除 $H_1$ 谱系）的那个分支上时，就会出现这种模式。这要求这三个分类单元的基因树具有 $(H_1, (H_2, H_3))$ 的拓扑结构。\n\n如果 $(H_1, H_2, H_3)$ 的等位基因状态为 $(\\text{B}, \\text{A}, \\text{B})$，则该位点呈现BABA模式。当一个独特的突变发生在基因树上连接 $H_1$ 和 $H_3$ 谱系（并排除 $H_2$ 谱系）的那个分支上时，就会出现这种模式。这要求基因树具有 $(H_2, (H_1, H_3))$ 的拓扑结构。\n\n物种树的拓扑结构是 $((H_1, H_2), H_3)$。在无分化后基因流（基因渗入）的原假设下，唯一能产生与物种树不一致的基因树的机制是不完全谱系分选（ILS）。当谱系未能在其直接祖先群体中合并，而是在更古老的共同祖先中追溯到更早的时间点合并时，就会发生ILS。\n\n让我们从群体 $H_1$, $H_2$ 和 $H_3$ 向后追溯谱系 $h_1$, $h_2$ 和 $h_3$。根据物种树，$h_1$ 和 $h_2$ 谱系进入它们的共同祖先群体 $P_{12}$。如果它们在 $P_{12}$ 内合并，产生的基因树将与物种树 $((H_1, H_2), H_3)$ 一致。这种拓扑结构不会产生ABBA或BABA模式。\n\n要想产生ABBA或BABA模式，$h_1$ 和 $h_2$ 必须未在 $P_{12}$ 中合并。因此，三个不同的谱系——$h_1$、$h_2$ 以及 $H_3$ 的祖先谱系 $h_3$ ——进入了祖先群体 $P_{123}$。在中性溯祖模型下，这三个谱系中的任意一对首先合并的概率是相等的。有三种可能的配对：$(h_1, h_2)$、$(h_2, h_3)$ 和 $(h_1, h_3)$。这些合并事件中每一个的概率都是 $1/3$。\n\n1.  $h_1$ 和 $h_2$ 的合并：此事件以 $1/3$ 的概率发生。产生的基因树是 $((H_1,H_2),H_3)$，与物种树一致。不产生ABBA或BABA模式。\n2.  $h_2$ 和 $h_3$ 的合并：此事件以 $1/3$ 的概率发生。产生的基因树是 $(H_1,(H_2,H_3))$。在通往 $(H_2, H_3)$ 演化支的内部分支上发生的一次突变会产生一个ABBA位点模式。\n3.  $h_1$ 和 $h_3$ 的合并：此事件以 $1/3$ 的概率发生。产生的基因树是 $(H_2,(H_1,H_3))$。在通往 $(H_1, H_3)$ 演化支的内部分支上发生的一次突变会产生一个BABA位点模式。\n\n给定模式的位点期望数与相应基因树拓扑的概率乘以必须发生突变的内部分支的期望长度成正比。设 $T_{23}$ 是基因树 $(H_1, (H_2, H_3))$ 中内部分支的长度，而 $T_{13}$ 是基因树 $(H_2, (H_1, H_3))$ 中内部分支的长度。ABBA位点的数量，记作 $N_{\\mathrm{ABBA}}$，与 $P((H_1, (H_2, H_3))) \\times \\mathbb{E}[T_{23}]$ 成正比；而 BABA 位点的数量 $N_{\\mathrm{BABA}}$ 与 $P((H_2, (H_1, H_3))) \\times \\mathbb{E}[T_{13}]$ 成正比。\n\n由于在原假设下，祖先群体 $P_{123}$ 内的溯祖过程具有基本对称性，两种不一致的拓扑结构以相等的概率生成：$P(h_2,h_3 \\text{ 首先合并}) = P(h_1,h_3 \\text{ 首先合并}) = 1/3$。此外，直到最终合并事件的等待时间分布（因此也是内部分支长度 $T_{23}$ 和 $T_{13}$ 的分布）在这两种情况下是相同的。因此，$\\mathbb{E}[T_{23}] = \\mathbb{E}[T_{13}]$。\n\n因此，在无基因流的原假设下，ABBA位点的期望数等于BABA位点的期望数：\n$$ \\mathbb{E}[N_{\\mathrm{ABBA}}] = \\mathbb{E}[N_{\\mathrm{BABA}}] $$\nD-统计量分子的期望值为：\n$$ \\mathbb{E}[N_{\\mathrm{ABBA}} - N_{\\mathrm{BABA}}] = \\mathbb{E}[N_{\\mathrm{ABBA}}] - \\mathbb{E}[N_{\\mathrm{BABA}}] = 0 $$\n虽然D-统计量是随机变量的比率，但其期望通常近似为期望的比率，尤其是在分母很大时。\n$$ \\mathbb{E}[D] \\approx \\frac{\\mathbb{E}[N_{\\mathrm{ABBA}} - N_{\\mathrm{BABA}}]}{\\mathbb{E}[N_{\\mathrm{ABBA}} + N_{\\mathrm{BABA}}]} = \\frac{0}{\\mathbb{E}[N_{\\mathrm{ABBA}} + N_{\\mathrm{BABA}}]} = 0 $$\n因此，在只有不完全谱系分选而无基因渗入的原假设下，D-统计量的期望值为 $0$。\n\n**第二部分：刀切法方差估计**\n\n我们得到了 $B=6$ 个基因组区块的位点计数。任务是计算 $\\hat{D}$ 方差的刀切法估计值。\n估计量为 $\\hat{D} = \\frac{\\sum_{b=1}^{B} x_b}{\\sum_{b=1}^{B} y_b}$，其中 $x_b = \\mathrm{ABBA}_b - \\mathrm{BABA}_b$ 且 $y_b = \\mathrm{ABBA}_b + \\mathrm{BABA}_b$。\n\n首先，我们为每个区块 $b \\in \\{1, \\dots, 6\\}$ 计算 $x_b$ 和 $y_b$：\n- 区块 1: $(\\mathrm{ABBA}_1, \\mathrm{BABA}_1) = (120, 100) \\implies x_1 = 120 - 100 = 20, y_1 = 120 + 100 = 220$\n- 区块 2: $(\\mathrm{ABBA}_2, \\mathrm{BABA}_2) = (80, 90) \\implies x_2 = 80 - 90 = -10, y_2 = 80 + 90 = 170$\n- 区块 3: $(\\mathrm{ABBA}_3, \\mathrm{BABA}_3) = (150, 140) \\implies x_3 = 150 - 140 = 10, y_3 = 150 + 140 = 290$\n- 区块 4: $(\\mathrm{ABBA}_4, \\mathrm{BABA}_4) = (60, 70) \\implies x_4 = 60 - 70 = -10, y_4 = 60 + 70 = 130$\n- 区块 5: $(\\mathrm{ABBA}_5, \\mathrm{BABA}_5) = (110, 100) \\implies x_5 = 110 - 100 = 10, y_5 = 110 + 100 = 210$\n- 区块 6: $(\\mathrm{ABBA}_6, \\mathrm{BABA}_6) = (90, 95) \\implies x_6 = 90 - 95 = -5, y_6 = 90 + 95 = 185$\n\n接下来，我们计算总和：\n$$ S_x = \\sum_{b=1}^{6} x_b = 20 - 10 + 10 - 10 + 10 - 5 = 15 $$\n$$ S_y = \\sum_{b=1}^{6} y_b = 220 + 170 + 290 + 130 + 210 + 185 = 1205 $$\n\n刀切法程序需要通过每次移除一个区块来计算估计值 $\\hat{D}_{(i)}$。公式为 $\\hat{D}_{(i)} = (S_x - x_i) / (S_y - y_i)$。\n- $\\hat{D}_{(1)} = \\frac{15 - 20}{1205 - 220} = \\frac{-5}{985} \\approx -0.00507614$\n- $\\hat{D}_{(2)} = \\frac{15 - (-10)}{1205 - 170} = \\frac{25}{1035} \\approx 0.02415459$\n- $\\hat{D}_{(3)} = \\frac{15 - 10}{1205 - 290} = \\frac{5}{915} \\approx 0.00546448$\n- $\\hat{D}_{(4)} = \\frac{15 - (-10)}{1205 - 130} = \\frac{25}{1075} \\approx 0.02325581$\n- $\\hat{D}_{(5)} = \\frac{15 - 10}{1205 - 210} = \\frac{5}{995} \\approx 0.00502513$\n- $\\hat{D}_{(6)} = \\frac{15 - (-5)}{1205 - 185} = \\frac{20}{1020} \\approx 0.01960784$\n\n现在，我们计算刀切法重复样本的均值 $\\bar{D}_{\\mathrm{jack}}$：\n$$ \\bar{D}_{\\mathrm{jack}} = \\frac{1}{B} \\sum_{i=1}^{B} \\hat{D}_{(i)} = \\frac{1}{6}(-0.00507614 + 0.02415459 + 0.00546448 + 0.02325581 + 0.00502513 + 0.01960784) $$\n$$ \\bar{D}_{\\mathrm{jack}} = \\frac{1}{6}(0.07243171) \\approx 0.01207195 $$\n\n刀切法方差估计值由以下公式给出：\n$$ \\mathrm{var}_{\\mathrm{jack}}(\\hat{D}) = \\frac{B-1}{B} \\sum_{i=1}^{B} (\\hat{D}_{(i)} - \\bar{D}_{\\mathrm{jack}})^2 $$\n我们计算差的平方：\n- $(\\hat{D}_{(1)} - \\bar{D}_{\\mathrm{jack}})^2 \\approx (-0.00507614 - 0.01207195)^2 = (-0.01714809)^2 \\approx 0.0002940576$\n- $(\\hat{D}_{(2)} - \\bar{D}_{\\mathrm{jack}})^2 \\approx (0.02415459 - 0.01207195)^2 = (0.01208264)^2 \\approx 0.0001459902$\n- $(\\hat{D}_{(3)} - \\bar{D}_{\\mathrm{jack}})^2 \\approx (0.00546448 - 0.01207195)^2 = (-0.00660747)^2 \\approx 0.0000436587$\n- $(\\hat{D}_{(4)} - \\bar{D}_{\\mathrm{jack}})^2 \\approx (0.02325581 - 0.01207195)^2 = (0.01118386)^2 \\approx 0.0001250800$\n- $(\\hat{D}_{(5)} - \\bar{D}_{\\mathrm{jack}})^2 \\approx (0.00502513 - 0.01207195)^2 = (-0.00704682)^2 \\approx 0.0000496578$\n- $(\\hat{D}_{(6)} - \\bar{D}_{\\mathrm{jack}})^2 \\approx (0.01960784 - 0.01207195)^2 = (0.00753589)^2 \\approx 0.0000567897$\n\n差的平方和为：\n$$ \\sum_{i=1}^{6} (\\hat{D}_{(i)} - \\bar{D}_{\\mathrm{jack}})^2 \\approx 0.0002940576 + 0.0001459902 + 0.0000436587 + 0.0001250800 + 0.0000496578 + 0.0000567897 $$\n$$ \\sum_{i=1}^{6} (\\hat{D}_{(i)} - \\bar{D}_{\\mathrm{jack}})^2 \\approx 0.000715234 $$\n\n最后，我们用前置因子 $\\frac{B-1}{B} = \\frac{5}{6}$ 来计算方差：\n$$ \\mathrm{var}_{\\mathrm{jack}}(\\hat{D}) = \\frac{5}{6} \\times 0.000715234 \\approx 0.000596028 $$\n四舍五入到四位有效数字，得到 $0.0005960$。", "answer": "$$\n\\boxed{0.0005960}\n$$", "id": "2775031"}, {"introduction": "虽然一些基因可能跨越物种界限，但生殖隔离屏障通常会限制基因流的程度。这些屏障的强度并非绝对，而是由一个动态的相互作用决定：一方面是针对外来等位基因的选择，另一方面是能够将中性标记与这些受选择位点分离的重组。本练习深入探讨杂交区理论的核心，要求你推导并计算遗传屏障的累积强度，从而定量地理解多个位点如何共同作用于生殖隔离。[@problem_id:2775018]", "problem": "两个部分隔离的分类单元在一个狭窄的杂交带相遇，并以每代 $m$ 的基准迁移率在两个亚群之间交换迁移个体。考虑一个焦点中性标记，该标记最初由一个迁入单倍型携带，此单倍型上还带有 $k$ 个障碍基因座，每个障碍基因座上的迁入等位基因在受体亚群中都受到生存力选择的作用。假设如下：\n- 选择在每个障碍基因座 $i \\in \\{1,\\dots,k\\}$ 上独立作用，以选择系数 $s_i$ 表征的每代速率移除迁入单倍型。\n- 中性标记以每代 $r_i$ 的重组率与障碍基因座 $i$ 重组分离；一旦重组分离，该障碍基因座上的选择便不再通过该基因座移除此中性标记。\n- 在各基因座之间，重组和选择风险在短时间尺度上（每代风险较弱）独立且可加地作用，且连锁不平衡（LD）最初仅由迁入背景产生。\n- 根据杂交带理论中障碍强度的经典定义，将中性标记处的累积障碍强度 $B$ 定义为关系式 $m_{\\text{eff}} = \\frac{m}{1 + B}$，其中 $m_{\\text{eff}}$ 是考虑了障碍基因座选择作用后的中性标记有效迁移率。\n\n从这些假设和替代风险（重组与选择性移除）竞争的基本原理出发，推导 $B$ 作为 $\\{s_i\\}$ 和 $\\{r_i\\}$ 函数的表达式，然后为以下参数集计算 $B$ 的数值：\n- $k = 4$\n- $(s_1, s_2, s_3, s_4) = (0.02, 0.03, 0.02, 0.01)$\n- $(r_1, r_2, r_3, r_4) = (0.02, 0.03, 0.01, 0.02)$\n\n将您最终的 $B$ 数值答案表示为四舍五入到四位有效数字的无量纲小数。", "solution": "该问题要求推导累积障碍强度 $B$ 的表达式，并随后进行数值计算。\n\n**1. 理论推导**\n任务是找到一个中性标记的有效迁移率 $m_{\\text{eff}}$，该标记最初与 $k$ 个有害等位基因处于完全连锁不平衡状态。有效迁移率是基准迁移率 $m$ 乘以中性标记成功渗入的概率，即它在因与障碍基因座的连锁而受到的间接选择中存活下来的概率。\n\n考虑单个障碍基因座 $i$。携带中性标记的迁入单倍型受到两个竞争过程的影响：\n1. 以每代 $s_i$ 的速率对单倍型进行选择性移除。\n2. 通过重组破坏中性标记与基因座 $i$ 上有害等位基因之间的连锁，重组以每代 $r_i$ 的速率发生。\n\n假设这些是较弱的连续时间风险，这是一个经典的竞争风险问题。标记与基因座 $i$ 上有害等位基因之间的连锁关联被解除（通过移除单倍型或通过重组）的总速率是单个速率之和，即 $s_i + r_i$。这种解除通过重组发生的概率——即允许标记“逃脱”该基因座选择的事件——是重组率与总事件率之比。\n\n设 $P_{\\text{escape}, i}$ 为从基因座 $i$ 的选择拖累中逃脱的概率。\n$$P_{\\text{escape}, i} = \\frac{r_i}{r_i + s_i}$$\n这个表达式给出了中性标记谱系在因基因座 $i$ 上的选择作用而被从群体中清除之前，与有害等位基因重组分离的概率。\n\n根据问题陈述，选择和重组在 $k$ 个障碍基因座上独立作用。要使中性标记成功渗入，它必须从所有 $k$ 个基因座的选择拖累中逃脱。因此，该标记的总存活概率 $P_{\\text{survival}}$ 是每个基因座的单个逃脱概率的乘积。\n$$P_{\\text{survival}} = \\prod_{i=1}^{k} P_{\\text{escape}, i} = \\prod_{i=1}^{k} \\frac{r_i}{r_i + s_i}$$\n\n有效迁移率 $m_{\\text{eff}}$ 是基准迁移率 $m$ 与存活概率的乘积。\n$$m_{\\text{eff}} = m \\cdot P_{\\text{survival}} = m \\prod_{i=1}^{k} \\frac{r_i}{r_i + s_i}$$\n\n我们已知累积障碍强度 $B$ 的定义为 $m_{\\text{eff}} = \\frac{m}{1 + B}$。现在我们可以将两个 $m_{\\text{eff}}$ 的表达式相等来求解 $B$。\n$$\\frac{m}{1 + B} = m \\prod_{i=1}^{k} \\frac{r_i}{r_i + s_i}$$\n两边同时除以 $m$（假设 $m \\neq 0$）得到：\n$$\\frac{1}{1 + B} = \\prod_{i=1}^{k} \\frac{r_i}{r_i + s_i}$$\n两边取倒数得到：\n$$1 + B = \\frac{1}{\\prod_{i=1}^{k} \\frac{r_i}{r_i + s_i}} = \\prod_{i=1}^{k} \\frac{r_i + s_i}{r_i}$$\n这可以简化为：\n$$1 + B = \\prod_{i=1}^{k} \\left(1 + \\frac{s_i}{r_i}\\right)$$\n最终，累积障碍强度 $B$ 的表达式为：\n$$B = \\left[ \\prod_{i=1}^{k} \\left(1 + \\frac{s_i}{r_i}\\right) \\right] - 1$$\n\n**2. 数值计算**\n现在，我们使用所提供的 $k=4$ 的参数计算 $B$ 的数值。\n4个基因座中每个基因座的比率 $\\frac{s_i}{r_i}$ 分别为：\n- 对于基因座 $i=1$：$\\frac{s_1}{r_1} = \\frac{0.02}{0.02} = 1$\n- 对于基因座 $i=2$：$\\frac{s_2}{r_2} = \\frac{0.03}{0.03} = 1$\n- 对于基因座 $i=3$：$\\frac{s_3}{r_3} = \\frac{0.02}{0.01} = 2$\n- 对于基因座 $i=4$：$\\frac{s_4}{r_4} = \\frac{0.01}{0.02} = 0.5$\n\n接下来，我们计算 $\\left(1 + \\frac{s_i}{r_i}\\right)$ 项：\n- 基因座 1：$1 + 1 = 2$\n- 基因座 2：$1 + 1 = 2$\n- 基因座 3：$1 + 2 = 3$\n- 基因座 4：$1 + 0.5 = 1.5$\n\n然后我们计算乘积：\n$$\\prod_{i=1}^{4} \\left(1 + \\frac{s_i}{r_i}\\right) = 2 \\times 2 \\times 3 \\times 1.5 = 4 \\times 4.5 = 18$$\n这个乘积等于 $1 + B$：\n$$1 + B = 18$$\n求解 $B$：\n$$B = 18 - 1 = 17$$\n问题要求答案为四舍五入到四位有效数字的小数。\n$$B = 17.00$$\n这个最终结果代表了对中性标记基因渗入的累积障碍强度，它将有效迁移率降低了 $1 + B = 18$ 倍。", "answer": "$$\\boxed{17.00}$$", "id": "2775018"}, {"introduction": "两个种群间的基因组分化景观可以揭示其演化历史的大量信息，特别是它们是在存在基因流的情况下还是在完全隔离中分化的。通过计算窗口化的相对分化（$F_{ST}$）和绝对分化（$d_{XY}$）等统计量，并检视它们与局部重组率的关系，我们可以发现正在进行中的针对杂交后代的选择信号。这项计算练习模拟了一次真实的基因组扫描，要求你亲手实现这些计算，并利用生成的分化模式来区分“伴有基因流的分化”和其他演化情景。[@problem_id:2774991]", "problem": "您需要完成一项基于群体遗传学的计算任务，使用全基因组汇总统计量在杂交区的背景下评估不同的物种概念。从基本定义出发，实现 Wright 固定指数和绝对分化度的窗口化估计，并推断整个基因组中观察到的模式是更符合抗基因流选择，还是仅符合连锁选择。所有计算都必须从基本原理出发，并遵循以下定义、规则和决策标准。\n\n基本原理和定义：\n- 考虑跨越一个基因组采样的两个种群，该基因组被划分为不重叠的窗口。对于每个窗口，您将获得种群 $1$ 中各位点的等位基因频率（记为 $p_{1,i}$）和种群 $2$ 中各位点的等位基因频率（记为 $p_{2,i}$），其中位点 $i = 1, \\dots, S$，$S$ 是窗口中的位点数。\n- 在种群 $k \\in \\{1,2\\}$ 中，位点 $i$ 的种群内期望杂合度定义为 $H_{k,i} = 2 \\, p_{k,i} \\, \\left(1 - p_{k,i}\\right)$。\n- 在两个种群中取平均后，位点 $i$ 的亚群内杂合度为 $H_{S,i} = \\dfrac{H_{1,i} + H_{2,i}}{2}$。\n- 位点 $i$ 的总杂合度定义为 $H_{T,i} = 2 \\, \\bar{p}_i \\, \\left(1 - \\bar{p}_i\\right)$，其中 $\\bar{p}_i = \\dfrac{p_{1,i} + p_{2,i}}{2}$。\n- 窗口平均的亚群内杂合度为 $H_S^{(w)} = \\dfrac{1}{S} \\sum_{i=1}^{S} H_{S,i}$，窗口平均的总杂合度为 $H_T^{(w)} = \\dfrac{1}{S} \\sum_{i=1}^{S} H_{T,i}$。\n- 对于 $H_T^{(w)} > 0$ 的窗口，将窗口化固定指数定义为 $F_{ST}^{(w)} = 1 - \\dfrac{H_S^{(w)}}{H_T^{(w)}}$。如果 $H_T^{(w)} = 0$，则该窗口的 $F_{ST}^{(w)}$ 未定义，并且必须从任何涉及 $F_{ST}^{(w)}$ 的相关性分析中排除。\n- 位点 $i$ 的绝对分化度为 $d_{XY,i} = p_{1,i}\\left(1 - p_{2,i}\\right) + p_{2,i}\\left(1 - p_{1,i}\\right) = p_{1,i} + p_{2,i} - 2 p_{1,i} p_{2,i}$。窗口平均的绝对分化度为 $d_{XY}^{(w)} = \\dfrac{1}{S} \\sum_{i=1}^{S} d_{XY,i}$。\n\n用于区分情景的推断逻辑：\n- 令 $r^{(w)}$ 表示窗口 $w$ 的重组率代理指标（在本问题中无量纲）。\n- 计算所有窗口上 $d_{XY}^{(w)}$ 与 $r^{(w)}$ 之间的 Spearman 等级相关系数，记为 $\\rho\\left(d_{XY}, r\\right)$。如果 $d_{XY}^{(w)}$ 值在各窗口间是恒定的（方差为零），则根据本问题的约定，定义 $\\rho\\left(d_{XY}, r\\right) = 0$。\n- 在 $F_{ST}^{(w)}$ 有定义的窗口上，计算 $F_{ST}^{(w)}$ 与 $d_{XY}^{(w)}$ 之间的 Spearman 等级相关系数，记为 $\\rho\\left(F_{ST}, d_{XY}\\right)$。如果所包含的 $F_{ST}^{(w)}$ 值是恒定的（方差为零），则根据本问题的约定，定义 $\\rho\\left(F_{ST}, d_{XY}\\right) = 0$。\n- 决策规则（与杂交区基因组学中公认的预期相符的启发式规则）：\n  - 当且仅当 $\\rho\\left(d_{XY}, r\\right) \\le -0.3$ 且 $\\rho\\left(F_{ST}, d_{XY}\\right) \\ge 0.3$ 时，推断为“抗基因流选择”。\n  - 否则，推断为“仅连锁选择”。\n- 您的程序必须为每个数据集输出一个整数分类：对于“抗基因流选择”输出 $1$，对于“仅连锁选择”输出 $0$。\n\n测试套件（数据集）：\n每个数据集是一个窗口列表。每个窗口包含：\n- 一个重组率值 $r^{(w)}$。\n- 对应两个种群的等位基因频率列表 $[p_{1,1}, \\dots, p_{1,S}]$ 和 $[p_{2,1}, \\dots, p_{2,S}]$，每个窗口有 $S=6$ 个位点。\n\n数据集 A（预期与抗基因流选择一致；$d_{XY}^{(w)}$ 与重组率呈负相关，且 $F_{ST}^{(w)}$ 与 $d_{XY}^{(w)}$ 呈正相关）：\n- 重组率：$[0.4, 0.8, 1.2, 1.6, 2.0]$。\n- 窗口（每行显示 $[p_{1,1},\\dots,p_{1,6}]$ 和 $[p_{2,1},\\dots,p_{2,6}]$）：\n  1. $p_1 = [0.95, 0.90, 0.85, 0.10, 0.20, 0.15]$, $p_2 = [0.05, 0.10, 0.15, 0.90, 0.80, 0.85]$。\n  2. $p_1 = [0.75, 0.70, 0.65, 0.35, 0.30, 0.25]$, $p_2 = [0.25, 0.30, 0.35, 0.65, 0.70, 0.75]$。\n  3. $p_1 = [0.60, 0.55, 0.52, 0.48, 0.45, 0.40]$, $p_2 = [0.40, 0.45, 0.48, 0.52, 0.55, 0.60]$。\n  4. $p_1 = [0.55, 0.50, 0.52, 0.49, 0.51, 0.50]$, $p_2 = [0.45, 0.50, 0.48, 0.51, 0.49, 0.50]$。\n  5. $p_1 = [0.50, 0.50, 0.50, 0.50, 0.50, 0.50]$, $p_2 = [0.50, 0.50, 0.50, 0.50, 0.50, 0.50]$。\n\n数据集 B（预期与仅连锁选择一致；$d_{XY}^{(w)}$ 在不同重组率下大致恒定，而 $F_{ST}^{(w)}$ 随重组率增加而减小）：\n- 重组率：$[0.4, 0.8, 1.2, 1.6, 2.0]$。\n- 对于所有窗口，目标单位点绝对分化度固定为 $0.4$，即每个位点满足 $p_{1,i} + p_{2,i} - 2 p_{1,i} p_{2,i} = 0.4$。以下数值满足该条件：\n  1. $p_1 = [0.10, 0.15, 0.10, 0.20, 0.12, 0.18]$, $p_2 = [0.3750000, 0.3571429, 0.3750000, 0.3333333, 0.3684211, 0.3437500]$。\n  2. $p_1 = [0.18, 0.22, 0.16, 0.24, 0.20, 0.26]$, $p_2 = [0.3437500, 0.3214286, 0.3529412, 0.3076923, 0.3333333, 0.2916667]$。\n  3. $p_1 = [0.22, 0.24, 0.26, 0.28, 0.23, 0.27]$, $p_2 = [0.3214286, 0.3076923, 0.2916667, 0.2727273, 0.3142857, 0.2857143]$。\n  4. $p_1 = [0.26, 0.27, 0.28, 0.29, 0.30, 0.31]$, $p_2 = [0.2916667, 0.2826087, 0.2727273, 0.2631579, 0.2500000, 0.2368421]$。\n  5. $p_1 = [0.30, 0.28, 0.32, 0.27, 0.33, 0.31]$, $p_2 = [0.2500000, 0.2727273, 0.2222222, 0.2826087, 0.2058824, 0.2368421]$。\n\n数据集 C（边界情况，包含一个因总杂合度为零而导致 $F_{ST}^{(w)}$ 未定义的窗口；预期与仅连锁选择一致）：\n- 重组率：$[0.5, 1.0, 1.5, 2.0]$。\n- 窗口：\n  1. $p_1 = [0.0, 0.0, 0.0, 1.0, 1.0, 1.0]$, $p_2 = [0.0, 0.0, 0.0, 1.0, 1.0, 1.0]$。\n  2. $p_1 = [0.40, 0.45, 0.50, 0.55, 0.60, 0.65]$, $p_2 = [0.35, 0.40, 0.45, 0.50, 0.55, 0.60]$。\n  3. $p_1 = [0.50, 0.55, 0.60, 0.65, 0.70, 0.75]$, $p_2 = [0.45, 0.50, 0.55, 0.60, 0.65, 0.70]$。\n  4. $p_1 = [0.55, 0.60, 0.65, 0.70, 0.75, 0.80]$, $p_2 = [0.50, 0.55, 0.60, 0.65, 0.70, 0.75]$。\n\n计算要求与最终输出：\n1. 对于每个数据集，使用上述定义为每个窗口计算 $F_{ST}^{(w)}$ 和 $d_{XY}^{(w)}$。\n2. 在数据集的所有窗口上计算 $\\rho\\left(d_{XY}, r\\right)$。\n3. 在数据集中 $F_{ST}^{(w)}$ 有定义的窗口上计算 $\\rho\\left(F_{ST}, d_{XY}\\right)$。\n4. 严格按照规定，应用阈值为 $-0.3$ 和 $0.3$ 的决策规则，为每个数据集输出一个整数标签：对于“抗基因流选择”输出 $1$，对于“仅连锁选择”输出 $0$。\n5. 您的程序应生成单行输出，其中包含结果，格式为逗号分隔的列表，并用方括号括起来，结果按数据集 A, B, C 的顺序排列。例如，输出如 $[1,0,0]$（这只是一个示例格式；实际值必须来自您的计算）。\n\n角度单位不适用。不涉及物理单位。所有输出必须是整数。", "solution": "该问题是一个群体遗传学领域的计算练习，要求实现一个已定义的工作流程，以区分杂交区中的两种进化情景：“抗基因流选择”和“仅连锁选择”。这项任务基于既定原则，并采用标准的汇总统计量。问题阐述清晰，科学上合理，并为获得唯一解提供了所有必要的定义和数据。\n\n该分析基于为不重叠基因组窗口计算的两个关键统计量：绝对分化度 $d_{XY}^{(w)}$ 和 Wright 固定指数 $F_{ST}^{(w)}$。这些统计量量化了两个种群间遗传分化的不同方面。\n\n首先，我们必须定义用于推导窗口化统计量的各位点量。对于一个给定的遗传位点 $i$，其在两个种群中的等位基因频率分别为 $p_{1,i}$ 和 $p_{2,i}$，基本量如下：\n\n1.  **种群内杂合度**：在位点 $i$ 上，种群 $k \\in \\{1, 2\\}$ 的期望杂合度由下式给出：\n    $$H_{k,i} = 2 \\, p_{k,i} \\, (1 - p_{k,i})$$\n    这衡量了从种群 $k$ 的位点 $i$ 随机抽取两个等位基因时，它们不相同的概率。\n\n2.  **平均亚群内杂合度**：在位点 $i$ 上，这是两个种群杂合度的算术平均值：\n    $$H_{S,i} = \\frac{H_{1,i} + H_{2,i}}{2}$$\n\n3.  **总杂合度**：这是在由两个亚群合并而成的假设总种群中，位点 $i$ 的期望杂合度。它是使用平均等位基因频率 $\\bar{p}_i = \\frac{p_{1,i} + p_{2,i}}{2}$ 计算的：\n    $$H_{T,i} = 2 \\, \\bar{p}_i \\, (1 - \\bar{p}_i)$$\n\n4.  **绝对分化度**：在位点 $i$ 上的绝对分化度 $d_{XY,i}$ 代表从种群1和种群2各抽取一个等位基因时，它们不相同的概率。其定义为：\n    $$d_{XY,i} = p_{1,i}(1 - p_{2,i}) + p_{2,i}(1 - p_{1,i}) = p_{1,i} + p_{2,i} - 2 p_{1,i} p_{2,i}$$\n\n接着，我们将这些位点值在基因组窗口 $w$ 内的所有 $S$ 个位点上取平均，以获得窗口化统计量：\n\n1.  **窗口平均亚群内杂合度**：\n    $$H_S^{(w)} = \\frac{1}{S} \\sum_{i=1}^{S} H_{S,i}$$\n\n2.  **窗口平均总杂合度**：\n    $$H_T^{(w)} = \\frac{1}{S} \\sum_{i=1}^{S} H_{T,i}$$\n\n3.  **窗口化固定指数 ($F_{ST}^{(w)}$)**：该统计量衡量了由于等位基因频率差异，亚群中杂合度相对于总种群的降低程度。其定义为：\n    $$F_{ST}^{(w)} = 1 - \\frac{H_S^{(w)}}{H_T^{(w)}}$$\n    该量仅在 $H_T^{(w)} > 0$ 时有定义。如果 $H_T^{(w)} = 0$，则意味着窗口中的所有位点在两个种群合并后都固定为相同的等位基因，这使得分化的概念变得无意义。此类窗口必须从任何涉及 $F_{ST}^{(w)}$ 的相关性分析中排除。\n\n4.  **窗口平均绝对分化度 ($d_{XY}^{(w)}$)**：\n    $$d_{XY}^{(w)} = \\frac{1}{S} \\sum_{i=1}^{S} d_{XY,i}$$\n\n在为数据集中的每个窗口计算出这些窗口化统计量后，下一步是使用 Spearman 等级相关系数 $\\rho$ 进行推断。这种非参数统计量评估了两个变量之间单调关系的强度和方向。\n\n需要计算两个特定的相关性：\n\n1.  $\\rho(d_{XY}, r)$：窗口化绝对分化度 $d_{XY}^{(w)}$ 与局部重组率代理指标 $r^{(w)}$ 之间的相关性。在抗基因流选择的作用下，预期存在强烈的负相关，因为在低重组区域，基因流屏障能更有效地维持分化。\n\n2.  $\\rho(F_{ST}, d_{XY})$：窗口化固定指数 $F_{ST}^{(w)}$ 与绝对分化度 $d_{XY}^{(w)}$ 之间的相关性。当分化是由基因流屏障驱动时，预期存在强烈的正相关，因为在“分化岛”中，两种分化度量应协同增加。\n\n问题规定了特殊情况的处理：如果一系列值（$d_{XY}^{(w)}$ 或有效的 $F_{ST}^{(w)}$ 值）是恒定的（方差为零），则其相关性定义为 $0$。\n\n最后，应用一个决策规则对每个数据集进行分类：\n- 当且仅当同时满足以下两个条件时，该情景被推断为 **“抗基因流选择”** （输出 $1$）：\n  $$\\rho(d_{XY}, r) \\le -0.3 \\quad \\text{且} \\quad \\rho(F_{ST}, d_{XY}) \\ge 0.3$$\n- 否则，该情景被推断为 **“仅连锁选择”** （输出 $0$）。\n\n以下是用于得出最终答案的 Python 实现：\n```python\nimport numpy as np\nfrom scipy.stats import spearmanr\n\ndef solve():\n    \"\"\"\n    Solves the computational biology problem by calculating windowed population genetic\n    statistics and applying a decision rule based on Spearman rank correlations.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"recombs\": [0.4, 0.8, 1.2, 1.6, 2.0],\n            \"windows_p1\": [\n                [0.95, 0.90, 0.85, 0.10, 0.20, 0.15],\n                [0.75, 0.70, 0.65, 0.35, 0.30, 0.25],\n                [0.60, 0.55, 0.52, 0.48, 0.45, 0.40],\n                [0.55, 0.50, 0.52, 0.49, 0.51, 0.50],\n                [0.50, 0.50, 0.50, 0.50, 0.50, 0.50],\n            ],\n            \"windows_p2\": [\n                [0.05, 0.10, 0.15, 0.90, 0.80, 0.85],\n                [0.25, 0.30, 0.35, 0.65, 0.70, 0.75],\n                [0.40, 0.45, 0.48, 0.52, 0.55, 0.60],\n                [0.45, 0.50, 0.48, 0.51, 0.49, 0.50],\n                [0.50, 0.50, 0.50, 0.50, 0.50, 0.50],\n            ],\n        },\n        {\n            \"name\": \"B\",\n            \"recombs\": [0.4, 0.8, 1.2, 1.6, 2.0],\n            \"windows_p1\": [\n                [0.10, 0.15, 0.10, 0.20, 0.12, 0.18],\n                [0.18, 0.22, 0.16, 0.24, 0.20, 0.26],\n                [0.22, 0.24, 0.26, 0.28, 0.23, 0.27],\n                [0.26, 0.27, 0.28, 0.29, 0.30, 0.31],\n                [0.30, 0.28, 0.32, 0.27, 0.33, 0.31],\n            ],\n            \"windows_p2\": [\n                [0.3750000, 0.3571429, 0.3750000, 0.3333333, 0.3684211, 0.3437500],\n                [0.3437500, 0.3214286, 0.3529412, 0.3076923, 0.3333333, 0.2916667],\n                [0.3214286, 0.3076923, 0.2916667, 0.2727273, 0.3142857, 0.2857143],\n                [0.2916667, 0.2826087, 0.2727273, 0.2631579, 0.2500000, 0.2368421],\n                [0.2500000, 0.2727273, 0.2222222, 0.2826087, 0.2058824, 0.2368421],\n            ],\n        },\n        {\n            \"name\": \"C\",\n            \"recombs\": [0.5, 1.0, 1.5, 2.0],\n            \"windows_p1\": [\n                [0.0, 0.0, 0.0, 1.0, 1.0, 1.0],\n                [0.40, 0.45, 0.50, 0.55, 0.60, 0.65],\n                [0.50, 0.55, 0.60, 0.65, 0.70, 0.75],\n                [0.55, 0.60, 0.65, 0.70, 0.75, 0.80],\n            ],\n            \"windows_p2\": [\n                [0.0, 0.0, 0.0, 1.0, 1.0, 1.0],\n                [0.35, 0.40, 0.45, 0.50, 0.55, 0.60],\n                [0.45, 0.50, 0.55, 0.60, 0.65, 0.70],\n                [0.50, 0.55, 0.60, 0.65, 0.70, 0.75],\n            ],\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        window_fsts = []\n        window_dxys = []\n        \n        num_windows = len(case[\"recombs\"])\n        for i in range(num_windows):\n            p1 = np.array(case[\"windows_p1\"][i])\n            p2 = np.array(case[\"windows_p2\"][i])\n            \n            # Within-population heterozygosities\n            h1 = 2 * p1 * (1 - p1)\n            h2 = 2 * p2 * (1 - p2)\n            \n            # Within-subpopulation heterozygosity\n            hs_site = (h1 + h2) / 2\n            hs_window = np.mean(hs_site)\n            \n            # Total heterozygosity\n            p_bar = (p1 + p2) / 2\n            ht_site = 2 * p_bar * (1 - p_bar)\n            ht_window = np.mean(ht_site)\n\n            # Absolute divergence\n            dxy_site = p1 + p2 - 2 * p1 * p2\n            dxy_window = np.mean(dxy_site)\n            window_dxys.append(dxy_window)\n            \n            # Fixation index (Fst)\n            if ht_window > 0:\n                fst_window = 1 - hs_window / ht_window\n                window_fsts.append(fst_window)\n            else:\n                window_fsts.append(np.nan)\n\n        # Compute Spearman correlations\n        \n        # rho(d_XY, r)\n        dxy_array = np.array(window_dxys)\n        recomb_array = np.array(case[\"recombs\"])\n        \n        if np.var(dxy_array, ddof=0) == 0:\n            rho_dxy_r = 0.0\n        else:\n            rho_dxy_r, _ = spearmanr(dxy_array, recomb_array)\n\n        # rho(F_ST, d_XY)\n        fst_array = np.array(window_fsts)\n        \n        # Filter out windows where Fst is undefined (nan)\n        valid_indices = ~np.isnan(fst_array)\n        filtered_fsts = fst_array[valid_indices]\n        filtered_dxys = dxy_array[valid_indices]\n        \n        if len(filtered_fsts)  2 or np.var(filtered_fsts, ddof=0) == 0:\n            rho_fst_dxy = 0.0\n        else:\n            rho_fst_dxy, _ = spearmanr(filtered_fsts, filtered_dxys)\n            \n        # Apply the decision rule\n        if rho_dxy_r = -0.3 and rho_fst_dxy >= 0.3:\n            classification = 1\n        else:\n            classification = 0\n        \n        results.append(classification)\n\n    # The problem asks for this to be returned in the answer tag.\n    # print(f\"[{','.join(map(str, results))}]\")\n\n# The code is part of the solution process, not the final answer.\n# Executing this logic yields the result [1,0,0].\n```", "answer": "[1,0,0]", "id": "2774991"}]}