{"hands_on_practices": [{"introduction": "进化生物学的核心目标之一是预测种群将如何响应自然选择。本练习将带你应用数量遗传学中最基本的公式之一——育种家方程，来量化这种响应。通过这个实践，你将学会如何利用选择差异（$S$）和窄义遗传力（$h^2$）来计算预期的进化响应（$R$），并根据选择差异的符号判断选择的模式。[@problem_id:2818449]", "problem": "一个大型的随机交配群体表现出一个数量性状 $z$。该性状由加性遗传效应和环境影响共同决定，因此 $z=a+e$，其中 $a$ 是加性遗传值，$e$ 是环境偏差。狭义遗传力 ($h^2$) 定义为加性遗传方差与表型方差的比值，即 $h^2 = V_A/V_P$，其中 $V_P=V_A+V_E$。在单代选择中，代内选择差 $S$ 定义为被选择的繁殖个体的平均表型与选择前群体平均表型之差。假设随机交配，无基因型-环境协方差，无母体或父体效应，且代际间的相似性完全由加性基因作用决定。\n\n已知 $h^2=0.4$，观测到的代内选择差为 $S=1.2$ 性状单位。仅使用上述核心定义和标准的数量遗传学假设，计算预期的选择反应 $R$。$R$ 定义为子代与选择前亲代之间的群体平均表型变化。\n\n此外，请仅根据当前代中 $S$ 的符号和含义，论证哪种选择模式（定向选择、稳定选择或分裂选择）与这些观察结果最一致，并根据预期均值和方差的变化来解释你的推理。\n\n仅报告 $R$ 的数值（以性状单位计）。最终数值答案中不要包含单位。无需四舍五入。", "solution": "该问题要求计算预期的选择反应 $R$，并根据所提供的信息确定选择模式。\n\n在给定假设（加性基因作用、随机交配等）下，支配数量性状的选择与进化反应之间关系的核心原理是育种家方程。这个数量遗传学的基本方程表述为：\n$$R = h^2 S$$\n其中：\n-   $R$ 是选择反应，定义为性状的平均表型值从亲代（选择前）到子代的变化。数学上表示为 $R = \\bar{z}_{\\text{offspring}} - \\bar{z}_{\\text{parental}}$。\n-   $h^2$ 是狭义遗传力，定义为总表型方差 ($V_P$) 中由加性遗传方差 ($V_A$) 引起的比例。数学上表示为 $h^2 = \\frac{V_A}{V_P}$。它代表了子代因加性遗传效应而与亲代相似的程度。\n-   $S$ 是选择差，定义为被选为亲代的个体平均表型 ($\\bar{z}_{\\text{selected}}$) 与选择前整个群体平均表型 ($\\bar{z}_{\\text{parental}}$) 之差。数学上表示为 $S = \\bar{z}_{\\text{selected}} - \\bar{z}_{\\text{parental}}$。它量化了一代中选择的强度和方向。\n\n问题提供了以下数值：\n-   狭义遗传力，$h^2 = 0.4$。\n-   选择差，$S = 1.2$ 性状单位。\n\n为了计算预期的选择反应 $R$，我们将这些值直接代入育种家方程：\n$$R = (0.4) \\times (1.2)$$\n$$R = 0.48$$\n因此，下一代群体平均表型的预期变化是增加 $0.48$ 个性状单位。\n\n任务的第二部分是论证与观察结果一致的选择模式（定向选择、稳定选择或分裂选择）。该论证必须基于所提供的信息，特别是选择差 $S$。\n\n让我们回顾一下数量性状背景下的自然选择模式：\n1.  **定向选择 (Directional Selection)**：这种模式偏好分布一端的表型个体。这导致群体的平均表型随时间向受偏好的一端移动。一个关键的诊断特征是选择差不为零，即 $S \\neq 0$。如果 $S > 0$，选择偏好较大的性状值。如果 $S < 0$，选择偏好较小的性状值。\n2.  **稳定选择 (Stabilizing Selection)**：这种模式偏好具有中间表型的个体，并淘汰两端的个体。这会减少群体中性状的表型方差，但不会改变均值。被选择的亲代的均值与初始群体的均值相同，因此选择差 $S \\approx 0$。\n3.  **分裂选择 (Disruptive Selection)**：这种模式偏好表型分布两端的个体，同时淘汰中间表型的个体。这可能导致表型方差增加，并可能形成双峰分布。尽管被选择个体的均值可能与群体均值相同（如果选择是对称的），导致 $S \\approx 0$，但其特征是方差增加。\n\n在这个问题中，我们已知选择差为 $S=1.2$。这个值是正数，并且显著不为零。根据其定义，$S = \\bar{z}_{\\text{selected}} - \\bar{z}_{\\text{parental}} = 1.2 > 0$，这表明繁殖个体的平均表型大于他们从中被选择出来的群体的平均表型。这说明具有高于平均水平性状值的个体具有繁殖优势。\n\n这一观察结果是**定向选择**的决定性特征。$S$ 的正号表明选择的方向是增加性状 $z$ 的值。预期的结果，即非零的选择反应 ($R=0.48$)，证实了群体均值预计会发生移动，这是定向选择下的预期结果。相比之下，对于纯粹的稳定选择或分裂选择，人们会预期 $S \\approx 0$，因此 $R \\approx 0$，因为这些选择模式主要不是为了改变群体均值。因此，仅根据 $S$ 的符号和大小，唯一一致的选择模式是定向选择。", "answer": "$$\n\\boxed{0.48}\n$$", "id": "2818449"}, {"introduction": "自然选择的形式很少是纯粹的定向、稳定或分裂选择。更常见的情况是，一个性状同时受到多种选择压力的影响。本练习模拟了分析真实野外数据时的常见情景，即定向选择梯度（$\\beta$）和二次选择梯度（$\\gamma$）均不为零，通过这项实践，你将学习如何综合这两种信息来理解适应度地形的形状，并预测种群的短期进化轨迹。[@problem_id:2818427]", "problem": "一项野外研究使用Lande–Arnold方法，通过将相对适合度 $w$ 对性状 $z$ 和 $z^2$ 进行回归，来量化野生种群中一个标准化数量性状 $z$ 上的自然选择。估计的线性（定向）梯度为 $\\beta = 0.3$，二次（曲率）梯度为 $\\gamma = -0.6$。根据设定，该性状的表型方差为 $P = 1$，加性遗传方差为 $G = 0.2$。假设选择是弱的，交配是随机的，并且跨一代的遗传传递是无偏的。\n\n在这些数据下，哪个选项最好地解释了定向选择和稳定选择的共同证据，并正确预测了均值的短期进化响应的符号和近似大小，以及对表型方差的定性影响？\n\n- A. 数据表明选择偏爱较大的性状值（$\\beta>0$），同时偏爱一个中间最适值（$\\gamma<0$）。在二次适合度曲面下，峰值出现在一个中间表型处；根据给定的估计值，这个峰值偏离了当前均值，种群均值应该在下一代适度增加约 $\\Delta \\bar z \\approx 0.06$，而表型方差应该下降。$|\\gamma|$ 的大小决定了适合度从最适值下降的陡峭程度，因此当 $\\bar z$ 接近峰值时，有效的定向选择分量减弱，响应变慢。\n\n- B. 数据表明存在定向选择和分裂选择，因此没有中间最适值。均值应大幅增加约 $\\Delta \\bar z \\approx 0.2$，并且由于极端表型受到偏爱，表型方差应增加。\n\n- C. 当两者同时存在时，稳定选择（$\\gamma<0$）会抵消定向选择，因此均值在一代内不会改变（$\\Delta \\bar z \\approx 0$），尽管方差会下降。\n\n- D. 数据意味着最适值位于当前均值以下，因此均值应减少约 $\\Delta \\bar z \\approx 0.06$，方差应下降。\n\n- E. 数据表明选择朝向一个中间表型。因为性状是标准化的，所以均值的单代变化等于 $\\Delta \\bar z \\approx 0.3$，并且方差应该增加，因为曲率加速了朝向偏离均值的极端的选择。", "solution": "必须首先验证问题陈述的科学性和逻辑完整性。\n\n### 第一步：提取已知条件\n- 一个标准化的数量性状用 $z$ 表示。\n- 使用Lande-Arnold方法，通过将相对适合度 $w$ 对性状 $z$ 及其平方 $z^2$ 进行回归来量化自然选择。\n- 估计的线性（定向）选择梯度为 $\\beta = 0.3$。\n- 估计的二次（稳定/分裂）选择梯度为 $\\gamma = -0.6$。\n- 性状是标准化的，所以其表型方差为 $P = 1$，均值为 $\\bar{z} = 0$。\n- 该性状的加性遗传方差为 $G = 0.2$。\n- 做出以下假设：弱选择、随机交配和无偏遗传传递。\n- 目标是解释选择的模式，并预测性状均值的单代进化响应 $\\Delta\\bar{z}$ 以及表型方差的定性变化。\n\n### 第二步：使用已知条件进行验证\n该问题具有科学依据。它采用了标准的Lande-Arnold框架来衡量选择，这是进化数量遗传学的基石。所提供的参数是一致且现实的。该性状的遗传力为 $h^2 = G/P = 0.2/1 = 0.2$，这是一个数量性状的合理值。问题提得很好，提供了应用既定理论模型预测进化变化所需的所有信息。语言精确客观。没有矛盾、歧义或违反基本原则之处。\n\n### 第三步：结论与行动\n问题有效。将推导解答。\n\n### 解题推导\n在选择作用下，数量性状的进化变化分析受数量遗传学基本原理的支配。\n\n1.  **解释选择梯度：**\n    - 定向选择梯度 $\\beta$ 衡量了对性状均值的线性选择的强度和方向。此处，$\\beta = 0.3$。由于 $\\beta > 0$，存在正向的定向选择，偏爱具有较大性状值 $z$ 的个体。\n    - 二次选择梯度 $\\gamma$ 衡量了适合度曲面的曲率。它表明选择是稳定选择还是分裂选择。此处，$\\gamma = -0.6$。由于 $\\gamma < 0$，选择是稳定选择（或凹型选择）。这种选择形式惩罚具有极端表型（非常高和非常低）的个体，而偏爱具有中间表型的个体。分裂选择对应于 $\\gamma > 0$。\n\n2.  **预测性状均值的响应：**\n    性状均值的短期进化响应（$\\Delta\\bar{z}$）由多元育种家方程预测，对于单个-性状，该方程简化为加性遗传方差和定向选择梯度的乘积：\n    $$ \\Delta\\bar{z} = G \\beta $$\n    代入给定值：\n    $$ \\Delta\\bar{z} = (0.2) \\times (0.3) = 0.06 $$\n    预测的性状均值在一代内的变化是增加 $0.06$ 个标准差单位。\n\n3.  **预测表型方差的变化：**\n    由 $\\gamma < 0$ 表示的稳定选择，通过在繁殖前从种群中移除极端表型，从而在一代内减小性状的方差。虽然要精确预测跨代表型方差的变化需要考虑突变和重组等其他因素，但选择的直接效应是减少方差。因此，预计表型方差会下降。\n\n4.  **定位适合度最适值：**\n    非零 $\\beta$ 和 $\\gamma$ 的组合描述了一个二次适合度曲面，$w(z) \\approx \\text{const} + \\beta z + \\gamma z^2$。该曲面的峰值，即最适表型 $z_{opt}$，可以通过将关于 $z$ 的导数设为零来找到：\n    $$ \\frac{dw}{dz} = \\beta + 2\\gamma z = 0 $$\n    $$ z_{opt} = -\\frac{\\beta}{2\\gamma} $$\n    代入给定值：\n    $$ z_{opt} = -\\frac{0.3}{2(-0.6)} = -\\frac{0.3}{-1.2} = \\frac{1}{4} = 0.25 $$\n    当前种群均值为 $\\bar{z}=0$（通过标准化）。最适值位于 $z_{opt} = 0.25$。正的定向选择梯度 $\\beta = 0.3$ 正确地反映了当前均值低于最适值，并且种群正朝着该最适值进化。\n\n### 逐项分析\n\n-   **A. 数据表明选择偏爱较大的性状值（$\\beta>0$），同时偏爱一个中间最适值（$\\gamma<0$）。在二次适合度曲面下，峰值出现在一个中间表型处；根据给定的估计值，这个峰值偏离了当前均值，种群均值应该在下一代适度增加约 $\\Delta \\bar z \\approx 0.06$，而表型方差应该下降。$|\\gamma|$ 的大小决定了适合度从最适值下降的陡峭程度，因此当 $\\bar z$ 接近峰值时，有效的定向选择分量减弱，响应变慢。**\n    - 该陈述与上述推导完全一致。它正确地指出了定向选择（$\\beta > 0$）和稳定选择（$\\gamma < 0$）。它正确地计算了均值响应为 $\\Delta\\bar{z} \\approx 0.06$。它正确地预测了方差的下降。它还正确地描述了长期动态，即当均值接近最适值时，响应将减慢。\n    - **结论：正确。**\n\n-   **B. 数据表明存在定向选择和分裂选择，因此没有中间最适值。均值应大幅增加约 $\\Delta \\bar z \\approx 0.2$，并且由于极端表型受到偏爱，表型方差应增加。**\n    - 这是不正确的。选择是稳定选择（$\\gamma = -0.6$），而不是分裂选择。对 $\\Delta\\bar{z}$ 的预测是不正确的；正确的值是 $0.06$。表型方差应该减少，而不是增加。\n    - **结论：不正确。**\n\n-   **C. 当两者同时存在时，稳定选择（$\\gamma<0$）会抵消定向选择，因此均值在一代内不会改变（$\\Delta \\bar z \\approx 0$），尽管方差会下降。**\n    - 这表现出一个根本性的误解。在此模型中，稳定选择和定向选择是适合度函数的正交分量；它们不会“抵消”彼此对均值的影响。均值的响应由 $\\beta$ 和 $G$ 决定，并且非零。预测 $\\Delta\\bar{z} \\approx 0$ 是错误的。\n    - **结论：不正确。**\n\n-   **D. 数据意味着最适值位于当前均值以下，因此均值应减少约 $\\Delta \\bar z \\approx 0.06$，方差应下降。**\n    - 这是不正确的。一个正的 $\\beta$ 意味着最适值在当前均值之上，因此均值应该增加。计算结果 $z_{opt} = 0.25 > 0$ 证实了这一点。预测的变化方向是错误的。\n    - **结论：不正确。**\n\n-   **E. 数据表明选择朝向一个中间表型。因为性状是标准化的，所以均值的单代变化等于 $\\Delta \\bar z \\approx 0.3$，并且方差应该增加，因为曲率加速了朝向偏离均值的极端的选择。**\n    - 这是不正确的。响应 $\\Delta\\bar{z}$ 不等于 $\\beta$；它必须按加性遗传方差（$G$）进行缩放。因此，预测 $\\Delta\\bar{z} \\approx 0.3$ 是错误的。此外，负曲率（$\\gamma < 0$）导致方差减少，而不是增加。\n    - **结论：不正确。**", "answer": "$$\\boxed{A}$$", "id": "2818427"}, {"introduction": "将理论模型转化为可运行的仿真是检验和深化理解的有力工具。在这个综合性练习中，你将亲手构建一个个体化模型，来模拟稳定选择对数量性状的影响。通过从头开始设定适应度函数、模拟繁殖过程，并最终用统计方法分析你生成的数据，你将直观地看到稳定选择如何降低群体方差，并学会如何从模拟数据中准确地估算选择梯度。[@problem_id:2818446]", "problem": "您将实现一个关于单数量性状稳定选择的基于个体的模拟，并根据模拟的性状和适应度数据计算实现的二次选择梯度，记为 $\\gamma$。设计必须从以下基本设定开始：\n\n- 一个数量性状 $Z$ 在种群中的初始分布为一个均值为 $\\mu$、标准差为 $\\sigma$ 的高斯（正态）随机变量，因此个体性状值 $z_i$ 是独立的抽样结果 $z_i \\sim \\mathcal{N}(\\mu,\\sigma^2)$。\n- 稳定选择的特征是，在最优性状值 $\\theta$ 处具有最高的绝对适应度，并从 $\\theta$ 向两侧对称递减。一个经过充分检验的表示方法是使用高斯适应度函数 $w(z) = \\exp\\!\\left(-\\dfrac{(z-\\theta)^2}{2\\omega^2}\\right)$，其中 $\\omega$ 控制稳定选择的强度（较小的 $\\omega$ 意味着较强的选择）。\n\n基于这些设定，请按如下步骤进行，以确定要模拟的内容以及如何测量实现的 $\\gamma$：\n\n1) 建模绝对适应度和实际繁殖。对于每个性状为 $z_i$ 的个体，设置其绝对适应度为 $w_i = w(z_i) = \\exp\\!\\left(-\\dfrac{(z_i-\\theta)^2}{2\\omega^2}\\right)$。实际繁殖产出 $X_i$ 是一个均值为 $\\lambda_i = R_0 w_i$ 的泊松随机变量，即 $X_i \\sim \\text{Poisson}(R_0 w_i)$，其中 $R_0$ 是一个正的基准繁殖力常数。将相对适应度定义为 $r_i = \\dfrac{X_i}{\\bar{X}}$，其中 $\\bar{X} = \\dfrac{1}{N}\\sum_{i=1}^{N} X_i$。\n\n2) 为选择分析将性状标准化。设 $\\bar{z} = \\dfrac{1}{N}\\sum_{i=1}^{N} z_i$ 和 $s_z = \\sqrt{\\dfrac{1}{N}\\sum_{i=1}^{N} (z_i - \\bar{z})^2}$。定义标准化性状为 $\\tilde{z}_i = \\dfrac{z_i - \\bar{z}}{s_z}$。\n\n3) 估计实现的二次选择梯度。使用普通最小二乘法 (OLS)，将相对适应度 $r_i$ 对截距项、$\\tilde{z}_i$ 和 $\\tilde{z}_i^2$ 进行回归，以拟合以下模型：\n$$\nr_i = b_0 + b_1 \\tilde{z}_i + b_2 \\tilde{z}_i^2 + \\varepsilon_i.\n$$\n在标准的 Lande–Arnold 选择分析下，实现的二次选择梯度为 $\\gamma = 2 b_2$。\n\n4) 量化稳定选择下的方差减少。计算选择前方差 $\\mathrm{Var}_{\\text{before}}(Z) = \\dfrac{1}{N}\\sum_{i=1}^{N} (z_i - \\bar{z})^2$。通过用每个 $z_i$ 的实际繁殖数 $X_i$ 进行加权来建模选择后的性状分布（在没有分离方差的情况下，这可解释为携带亲代表型的后代数量）。计算选择后均值 $\\mu_{\\text{after}} = \\dfrac{\\sum_{i=1}^{N} X_i z_i}{\\sum_{i=1}^{N} X_i}$ 和选择后方差 $\\mathrm{Var}_{\\text{after}}(Z) = \\dfrac{\\sum_{i=1}^{N} X_i (z_i - \\mu_{\\text{after}})^2}{\\sum_{i=1}^{N} X_i}$。报告方差比 $\\rho = \\dfrac{\\mathrm{Var}_{\\text{after}}(Z)}{\\mathrm{Var}_{\\text{before}}(Z)}$，当选择不容忽视且其中心接近当前均值时，在稳定选择下该比率预期将小于 1。\n\n您的程序必须：\n\n- 使用以上步骤为每个测试用例模拟一代。\n- 按照所述通过 OLS 估计实现的 $\\gamma$。\n- 计算 $\\rho$ 和一个布尔标记，该标记指示方差是否减少，即 $\\rho < 1$。\n\n使用以下测试套件。每个测试用例是一个 7 元组 $(N,\\mu,\\sigma,\\theta,\\omega,R_0,\\text{seed})$：\n\n- 案例 A（基线稳定选择）：$(N=\\,$$20000$$,\\ \\mu=\\,$$0.0$$,\\ \\sigma=\\,$$1.0$$,\\ \\theta=\\,$$0.0$$,\\ \\omega=\\,$$1.0$$,\\ R_0=\\,$$2.0$$,\\ \\text{seed}=\\,$$1$$)$。\n- 案例 B（强稳定选择）：$(N=\\,$$20000$$,\\ \\mu=\\,$$0.0$$,\\ \\sigma=\\,$$1.0$$,\\ \\theta=\\,$$0.0$$,\\ \\omega=\\,$$0.5$$,\\ R_0=\\,$$2.0$$,\\ \\text{seed}=\\,$$2$$)$。\n- 案例 C（近中性选择）：$(N=\\,$$20000$$,\\ \\mu=\\,$$0.0$$,\\ \\sigma=\\,$$1.0$$,\\ \\theta=\\,$$0.0$$,\\ \\omega=\\,$$10^6$$,\\ R_0=\\,$$2.0$$,\\ \\text{seed}=\\,$$3$$)$。\n- 案例 D（最优值偏移）：$(N=\\,$$20000$$,\\ \\mu=\\,$$0.0$$,\\ \\sigma=\\,$$1.0$$,\\ \\theta=\\,$$1.5$$,\\ \\omega=\\,$$1.0$$,\\ R_0=\\,$$2.0$$,\\ \\text{seed}=\\,$$4$$)$。\n\n最终输出规范：\n\n- 对于每个测试用例，输出一个列表 $[\\gamma, \\rho, \\text{decreased}]$，其中 $\\gamma$ 和 $\\rho$ 是四舍五入到 6 位小数的浮点数，而 $\\text{decreased}$ 是一个指示 $\\rho < 1$ 是否成立的布尔值。\n- 将四个案例列表聚合为一个单一列表，并准确打印一行，其中包含此聚合列表，格式为\n\"`[ [g_A, r_A, b_A], [g_B, r_B, b_B], [g_C, r_C, b_C], [g_D, r_D, b_D] ]`\"\n，其中除了分隔各案例列表所需的空格外，逗号后不加其他空格。", "solution": "该问题陈述是有效的。它提出了一个科学上合理、提法恰当且客观的任务，植根于演化数量遗传学的基本原理。所有必需的参数和过程都得到了明确定义，从而允许一个唯一且可验证的解。该问题要求实现一个基于个体的模拟，以探究稳定选择对数量性状的影响，并使用已建立的 Lande-Arnold 回归框架来量化这些影响。\n\n解决方案将遵循问题中概述的步骤顺序来构建。\n\n步骤1：初始种群和性状值的生成\n模拟首先创建一个包含 $N$ 个个体的种群。对于每个测试用例，种群规模指定为 $N=20000$。每个个体 $i$ 被赋予一个数量性状 $Z$ 的值。这些性状值（对于 $i=1, \\dots, N$，表示为 $z_i$）是从高斯（正态）分布中抽取的独立同分布样本，$z_i \\sim \\mathcal{N}(\\mu, \\sigma^2)$。每个案例都提供了初始均值 $\\mu$ 和标准差 $\\sigma$ 的参数。使用指定的随机种子可确保随机数序列是固定的，从而使模拟结果可复现。\n\n步骤2：适应度和繁殖的建模\n通过高斯适应度函数施加稳定选择，该函数将最高适应度赋予最优性状值 $\\theta$。具有性状值 $z_i$ 的个体的绝对适应度 $w_i$ 由下式给出：\n$$\nw(z_i) = \\exp\\left(-\\frac{(z_i - \\theta)^2}{2\\omega^2}\\right)\n$$\n此处，$\\omega$ 控制选择强度：较小的 $\\omega$ 对应于更窄的适应度峰值，从而意味着更强的稳定选择。下一步是为种群动态建模，特别是每个个体的实际后代数量。个体 $i$ 的后代数量 $X_i$ 是从泊松分布中抽取的随机变量：\n$$\nX_i \\sim \\text{Poisson}(\\lambda_i)\n$$\n泊松分布的均值 $\\lambda_i$ 是个体绝对适应度 $w_i$ 与基准繁殖力常数 $R_0$ 的乘积，即 $\\lambda_i = R_0 w_i$。这个随机步骤将种群统计方差引入模拟中。\n\n步骤3：用于选择分析的性状标准化\n为了以标准化的方式测量选择，必须对性状值进行转换。首先，计算亲代中性状的选择前均值 $\\bar{z}$ 和标准差 $s_z$：\n$$\n\\bar{z} = \\frac{1}{N}\\sum_{i=1}^{N} z_i\n$$\n$$\ns_z = \\sqrt{\\frac{1}{N}\\sum_{i=1}^{N} (z_i - \\bar{z})^2}\n$$\n请注意，这是总体标准差，而非样本标准差。使用这些统计量，将每个个体的性状值 $z_i$ 标准化为 $\\tilde{z}_i$：\n$$\n\\tilde{z}_i = \\frac{z_i - \\bar{z}}{s_z}\n$$\n根据其构造，标准化性状 $\\tilde{z}$ 的均值为 0，标准差为 1。\n\n步骤4：二次选择梯度 ($\\gamma$) 的估计\n二次选择梯度 $\\gamma$ 量化了性状与适应度之间关系的曲率强度和形式。它通过多元线性回归进行估计。首先，我们将每个个体的相对适应度 $r_i$ 定义为其实现的后代数 $X_i$ 除以整个种群的平均后代数 $\\bar{X}$：\n$$\nr_i = \\frac{X_i}{\\bar{X}}, \\quad \\text{其中} \\quad \\bar{X} = \\frac{1}{N}\\sum_{i=1}^N X_i\n$$\n根据定义，平均相对适应度为 1。然后我们使用普通最小二乘法 (OLS) 拟合以下二次模型：\n$$\nr_i = b_0 + b_1 \\tilde{z}_i + b_2 \\tilde{z}_i^2 + \\varepsilon_i\n$$\n用矩阵表示法，即 $\\mathbf{r} = \\mathbf{Z}\\mathbf{b} + \\boldsymbol{\\varepsilon}$，其中 $\\mathbf{r}$ 是相对适应度向量，$\\mathbf{b} = [b_0, b_1, b_2]^T$ 是系数向量，$\\mathbf{Z}$ 是设计矩阵，其列分别对应于截距项 (1)、线性项 ($\\tilde{z}_i$) 和二次项 ($\\tilde{z}_i^2$)。系数的 OLS 估计值为 $\\hat{\\mathbf{b}} = (\\mathbf{Z}^T\\mathbf{Z})^{-1}\\mathbf{Z}^T\\mathbf{r}$。实现的二次选择梯度 $\\gamma$ 定义为估计的二次项系数的两倍：\n$$\n\\gamma = 2 \\hat{b}_2\n$$\n负的 $\\gamma$ 表示稳定选择（适应度函数是下凹的），而正的 $\\gamma$ 表示分裂选择（适应度函数是上凹的）。\n\n步骤5：方差减少的量化\n稳定选择预期会减少种群中性状的方差，因为具有中间表型的个体具有更高的繁殖成功率。我们通过比较选择前后的性状方差来量化这一点。\n选择前方差即为步骤3中计算的标准差的平方：\n$$\n\\mathrm{Var}_{\\text{before}}(Z) = s_z^2 = \\frac{1}{N}\\sum_{i=1}^{N} (z_i - \\bar{z})^2\n$$\n选择后性状分布由子代构成。假设没有突变或分离方差，子代的性状值与其亲代相同。因此，选择后分布即为按后代数量 $X_i$ 加权的亲代性状分布。子代中的个体总数为 $N_{\\text{after}} = \\sum_{i=1}^{N} X_i$。\n选择后均值 $\\mu_{\\text{after}}$ 是亲代性状的加权平均值：\n$$\n\\mu_{\\text{after}} = \\frac{\\sum_{i=1}^{N} X_i z_i}{\\sum_{i=1}^{N} X_i}\n$$\n选择后方差 $\\mathrm{Var}_{\\text{after}}(Z)$ 是加权方差：\n$$\n\\mathrm{Var}_{\\text{after}}(Z) = \\frac{\\sum_{i=1}^{N} X_i (z_i - \\mu_{\\text{after}})^2}{\\sum_{i=1}^{N} X_i}\n$$\n选择对​​方差的影响由比率 $\\rho$ 来衡量：\n$$\n\\rho = \\frac{\\mathrm{Var}_{\\text{after}}(Z)}{\\mathrm{Var}_{\\text{before}}(Z)}\n$$\n在有效的稳定选择下，我们预期 $\\rho < 1$，表示性状方差减少。如果此条件成立，则将布尔标记 `decreased` 设置为 `True`。为每个测试用例执行这些计算以生成所需的输出。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates one generation of stabilizing selection on a quantitative trait\n    and computes the realized quadratic selection gradient (gamma) and the\n    change in variance (rho).\n    \"\"\"\n\n    # Test cases: (N, mu, sigma, theta, omega, R0, seed)\n    test_cases = [\n        # Case A (baseline stabilizing)\n        (20000, 0.0, 1.0, 0.0, 1.0, 2.0, 1),\n        # Case B (strong stabilizing)\n        (20000, 0.0, 1.0, 0.0, 0.5, 2.0, 2),\n        # Case C (near-neutral)\n        (20000, 0.0, 1.0, 0.0, 1e6, 2.0, 3),\n        # Case D (offset optimum)\n        (20000, 0.0, 1.0, 1.5, 1.0, 2.0, 4),\n    ]\n\n    results = []\n    \n    for N, mu, sigma, theta, omega, R0, seed in test_cases:\n        # Create a seeded random number generator for reproducibility\n        rng = np.random.default_rng(seed)\n\n        # 1. Generate initial population's trait values\n        # z_i ~ N(mu, sigma^2)\n        z = rng.normal(loc=mu, scale=sigma, size=N)\n\n        # 2. Model absolute fitness and realized reproduction\n        # w(z) = exp(-(z-theta)^2 / (2*omega^2))\n        w = np.exp(-((z - theta)**2) / (2 * omega**2))\n        \n        # X_i ~ Poisson(R0 * w_i)\n        X = rng.poisson(lam=(R0 * w))\n\n        # 3. Standardize the trait for selection analysis\n        z_mean = np.mean(z)\n        # Use population standard deviation (ddof=0)\n        z_std = np.std(z, ddof=0) \n        \n        # Handle the edge case where z_std is zero\n        if z_std == 0:\n            z_tilde = np.zeros(N)\n        else:\n            z_tilde = (z - z_mean) / z_std\n\n        # 4. Estimate the realized quadratic selection gradient (gamma)\n        # Calculate relative fitness r_i = X_i / mean(X)\n        X_mean = np.mean(X)\n        if X_mean == 0:\n            # This is highly unlikely given the parameters but is a safe check.\n            # If no offspring are produced, relative fitness is undefined.\n            # We can set OLS coefficients to zero.\n            b0, b1, b2 = 0.0, 0.0, 0.0\n        else:\n            r = X / X_mean\n            \n            # Set up the design matrix for OLS: r = b0 + b1*z_tilde + b2*z_tilde^2\n            # Columns are for intercept, linear term, and quadratic term\n            Z_matrix = np.vstack([np.ones(N), z_tilde, z_tilde**2]).T\n            \n            # Solve for coefficients b = [b0, b1, b2] using OLS\n            b, _, _, _ = np.linalg.lstsq(Z_matrix, r, rcond=None)\n            b0, b1, b2 = b[0], b[1], b[2]\n\n        # Quadratic selection gradient is gamma = 2 * b2\n        gamma = 2 * b2\n\n        # 5. Quantify variance reduction\n        var_before = z_std**2\n        \n        # Post-selection statistics, weighted by offspring count X\n        # Total number of offspring\n        N_after = np.sum(X)\n        \n        if N_after == 0:\n            # If no offspring, post-selection variance is undefined, but can be set to 0.\n            # The ratio rho would be 0.\n            var_after = 0.0\n        else:\n            # Post-selection mean (weighted average)\n            mu_after = np.average(z, weights=X)\n            # Post-selection variance (weighted variance)\n            var_after = np.average((z - mu_after)**2, weights=X)\n\n        # Variance ratio rho\n        if var_before == 0:\n             # If initial variance is zero, rho is undefined (or 1 if var_after is also 0)\n            rho = 1.0 if var_after == 0.0 else np.inf\n        else:\n            rho = var_after / var_before\n\n        # Boolean flag for variance decrease\n        decreased = rho  1.0\n\n        # Append results for this case\n        results.append([gamma, rho, decreased])\n\n    # Format the final output string as per the specification\n    final_output_parts = []\n    for gamma_val, rho_val, decreased_val in results:\n        dec_str = \"True\" if decreased_val else \"False\"\n        final_output_parts.append(f\"[{gamma_val:.6f},{rho_val:.6f},{dec_str}]\")\n\n    print(f\"[{','.join(final_output_parts)}]\")\n\nsolve()\n```", "id": "2818446"}]}