{"hands_on_practices": [{"introduction": "进化生物学经常使用最优模型来理解自然选择如何塑造表型。本练习探讨了后代大小与数量之间的权衡，这是生命史理论中的一个经典问题。通过构建一个包含环境限制和生理成本的适应度函数 $W(x)$，我们可以预测每个后代的最优投资水平 $x^{\\ast}$。这项实践旨在培养数学建模的技能，展示如何将生物学假设转化为定量框架，并求解进化上的最优策略，从而揭示进化如何针对生态挑战产生可预测的、高效的解决方案。[@problem_id:2798314]", "problem": "在一个恒定的环境中，考虑一个一次生殖生物，它将由环境决定的固定繁殖能量预算分配给大量的后代。设表型由单个后代投入（后代大小）$x  0$ 来表征。环境施加了固定的每次繁殖能量预算 $E  0$（对总投入的环境约束），以及一个外在风险尺度 $h  0$，该尺度决定了后代存活率随其大小增加的方式。此外，产生每个后代都会产生一个生理开销成本 $c  0$，该成本不增加后代的大小（例如，卵壳、包装或胎盘建构成本），因此每个后代的总能量成本为 $x + c$。\n\n假设存在以下两个得到充分支持的生活史关系：\n- 后代数量和大小之间的权衡由资源约束决定：后代数量为 $n(x) = \\frac{E}{x + c}$。\n- 后代存活概率是一个关于其大小的饱和函数，反映了在外在风险下的边际效益递减：$p(x) = \\frac{x}{x + h}$。\n\n使用达尔文适应度的基本定义，即在恒定环境中的期望存活后代数量，构建该生物以 $x$ 表示的适应度函数，然后，使用第一性原理，推导出在环境约束下使适应度最大化的表型 $x^{\\ast}$。将你的最终答案表示为由参数 $c$ 和 $h$ 构成的闭式解析表达式。请勿代入数值。如果出现多个驻点，请在 $x  0$、$c  0$ 和 $h  0$ 的条件下，论证哪一个是具有进化意义的最大值点。", "solution": "基本依据是在恒定环境中达尔文适应度的定义，即期望繁殖成功率，此处取为每次繁殖事件中期望的存活后代数量。给定单个后代投入 $x$，环境资源约束意味着后代数量为\n$$\nn(x) = \\frac{E}{x + c},\n$$\n且饱和的存活概率为\n$$\np(x) = \\frac{x}{x + h}.\n$$\n因此，期望的存活后代数量（适应度）为\n$$\nW(x) = n(x)\\,p(x) = \\frac{E}{x + c}\\cdot\\frac{x}{x + h}.\n$$\n由于 $E  0$ 是一个不依赖于 $x$ 的乘法常数，它不影响最大值点的位置。定义\n$$\nf(x) \\equiv \\frac{x}{(x + c)(x + h)},\n$$\n并在 $x  0$、$c  0$ 和 $h  0$ 的条件下最大化 $f(x)$。\n\n使用商法则计算导数。令\n$$\ng(x) = (x + c)(x + h) = x^{2} + (c + h)\\,x + c\\,h,\n$$\n那么 $f(x) = \\frac{x}{g(x)}$。于是\n$$\nf'(x) = \\frac{1\\cdot g(x) - x\\cdot g'(x)}{[g(x)]^{2}}.\n$$\n计算 $g'(x)$：\n$$\ng'(x) = 2x + (c + h).\n$$\n因此 $f'(x)$ 的分子是\n$$\nN(x) = g(x) - x g'(x) = \\bigl[x^{2} + (c + h)\\,x + c\\,h\\bigr] - x\\bigl[2x + (c + h)\\bigr].\n$$\n展开并化简：\n$$\nN(x) = x^{2} + (c + h)\\,x + c\\,h - 2x^{2} - (c + h)\\,x = -x^{2} + c\\,h.\n$$\n因此\n$$\nf'(x) = \\frac{-x^{2} + c\\,h}{[g(x)]^{2}}.\n$$\n驻点满足 $f'(x) = 0$，这等价于\n$$\n-x^{2} + c\\,h = 0 \\quad\\Longrightarrow\\quad x^{2} = c\\,h.\n$$\n在 $c  0$ 和 $h  0$ 的条件下，生物学上可接受的 $x  0$ 解是\n$$\nx^{\\ast} = \\sqrt{c\\,h}.\n$$\n为验证 $x^{\\ast}$ 是一个全局最大值，我们检验 $f'(x)$ 的符号：\n- 对于 $0  x  \\sqrt{c\\,h}$，有 $-x^{2} + c\\,h  0$，所以 $f'(x)  0$。\n- 对于 $x  \\sqrt{c\\,h}$，有 $-x^{2} + c\\,h  0$，所以 $f'(x)  0$。\n\n因为对于所有 $x  0$，分母 $[g(x)]^{2}$ 均严格为正，所以 $f'(x)$ 的符号由 $N(x)$ 决定。因此，$f(x)$ 在 $(0, \\sqrt{c\\,h})$ 上递增，在 $(\\sqrt{c\\,h}, \\infty)$ 上递减，从而确立了 $x^{\\ast} = \\sqrt{c\\,h}$ 是 $x  0$ 上的唯一全局最大值点。\n\n总而言之，在指定的权衡和环境约束下，使适应度最大化的表型是单个后代投入\n$$\nx^{\\ast} = \\sqrt{c\\,h}.\n$$", "answer": "$$\\boxed{\\sqrt{c h}}$$", "id": "2798314"}, {"introduction": "群体遗传学的基础模型，如哈迪-温伯格平衡，通常假设种群内随机交配。然而，现实世界中的种群常常具有结构。本练习旨在探究瓦伦德效应（Wahlund effect），即种群亚结构所产生的后果。你将定量地证明，为什么将遗传上不同的亚群混合后，与单一随机交配群体的预期相比，会导致杂合子频率的亏缺。这项实践对于理解种群结构如何作为一种塑造遗传变异的演化力量至关重要，并为解读自然种群中的遗传多样性模式提供了关键工具，它构成了理想化模型与真实世界数据之间的一座桥梁。[@problem_id:2798300]", "problem": "在演化生物学的框架下，将群体结构解释为导致偏离Hardy–Weinberg平衡（HWE）的一个原因。考虑一个具有等位基因 $A$ 和 $a$ 的双等位基因座。两个大的亚群体 $S_{1}$ 和 $S_{2}$，各自进行随机交配，并且各自处于HWE状态，其等位基因 $A$ 的频率分别为 $p_{1}$ 和 $p_{2}$。在亚群体间进行交配之前，通过从 $S_{1}$ 中抽取比例为 $w_{1}$ 的个体和从 $S_{2}$ 中抽取比例为 $w_{2}$ 的个体（其中 $w_{1}+w_{2}=1$）形成一个混合样本。\n\n- 简要解释为什么即使每个亚群体都处于HWE状态，混合这些亚群体也会导致杂合子缺失（Wahlund效应）。\n\n- 仅从等位基因频率、HWE下的基因型频率和杂合度（此处定义为预期杂合子频率）的定义出发，推导由混合引起的预期杂合子缺失。将杂合子缺失 $D$ 定义为在混合等位基因频率下随机交配所预期的杂合子频率与在混合样本中实际观察到的杂合子频率之差：\n$$\nD \\equiv H_{\\text{HWE at } \\bar{p}} - H_{\\text{observed in pooled sample}}.\n$$\n将 $D$ 表示为 $p_{1}$、$p_{2}$、$w_{1}$ 和 $w_{2}$ 的封闭形式函数。您的最终答案必须是一个没有单位的单一解析表达式。如果引入任何新符号，请明确定义它们。不需要进行数值计算。", "solution": "Wahlund效应描述了当一个群体由两个或多个不相互繁殖的独立亚群体组成时，观察到的杂合度降低（以及相应的纯合度增加）的现象。即使每个亚群体都处于Hardy-Weinberg平衡（HWE）状态，作为一个整体的混合群体与基于其总等位基因频率的HWE期望相比，仍会表现出杂合子缺失。\n\n这种现象的根本原因在于等位基因频率与预期杂合子频率之间的非线性关系。在HWE下，杂合子的频率由函数 $H(p) = 2p(1-p)$ 给出，其中 $p$ 是所关注的等位基因频率。这个函数是一个开口向下的抛物线，在数学上对于 $p \\in (0,1)$ 是一个严格的凹函数。对于任何凹函数 $f(x)$，Jensen不等式指出，对于一组点 $x_i$ 和相应的权重 $w_i$ (使得 $\\sum w_i = 1$)，以下关系成立：\n$$\n\\sum_{i} w_i f(x_i) \\leq f\\left(\\sum_{i} w_i x_i\\right)\n$$\n在我们的情境中，$x_i$ 是等位基因频率 $p_1$ 和 $p_2$，权重是亚群体的贡献比例 $w_1$ 和 $w_2$。不等式的左侧 $\\sum w_i H(p_i) = w_1 H(p_1) + w_2 H(p_2)$ 代表混合样本中实际观察到的平均杂合度，因为它是每个亚群体HWE杂合度的加权平均。不等式的右侧 $H(\\sum w_i p_i) = H(w_1 p_1 + w_2 p_2) = H(\\bar{p})$ 代表如果整个群体是随机交配的，并且具有混合等位基因频率 $\\bar{p}$ 时所预期的理论杂合度。\n\n因此，Jensen不等式直接意味着：\n$$\nH_{\\text{observed in pooled sample}} \\leq H_{\\text{HWE at } \\bar{p}}\n$$\n仅当亚群体中的等位基因频率相同时（$p_1 = p_2$），等式才成立。如果 $p_1 \\neq p_2$，则严格不等式成立，表明存在杂合子缺失。直观上，纯合子的过量是由于个体更可能对其原生亚群体中常见的等位基因呈纯合（在高 $p$ 值的亚群体中为 $AA$，在低 $p$ 值的亚群体中为 $aa$）。当这些预先存在的基因型集合在未经混合的情况下合并时，纯合子的总数会超过在整个混合基因库中进行随机交配所预测的数量。\n\n现在，我们进行杂合子缺失 $D$ 的形式化推导。\n\n设亚群体 $S_1$ 和 $S_2$ 中等位基因 $A$ 的频率分别为 $p_1$ 和 $p_2$。相应地，等位基因 $a$ 的频率为 $q_1 = 1-p_1$ 和 $q_2 = 1-p_2$。\n从 $S_1$ 和 $S_2$ 中抽取的个体比例分别为 $w_1$ 和 $w_2$，且约束条件为 $w_1 + w_2 = 1$。\n\n首先，我们确定混合样本中观察到的杂合子（$Aa$）频率，记为 $H_{\\text{obs}}$。由于每个亚群体都处于HWE状态，因此 $S_1$ 中杂合子的频率为 $H_1 = 2p_1q_1$，$S_2$ 中杂合子的频率为 $H_2 = 2p_2q_2$。混合样本的杂合子频率是这些频率的加权平均值：\n$$\nH_{\\text{obs}} = w_1 H_1 + w_2 H_2 = w_1(2p_1q_1) + w_2(2p_2q_2) = 2w_1p_1(1-p_1) + 2w_2p_2(1-p_2)\n$$\n\n接下来，我们确定如果混合群体是一个处于HWE的单一随机交配单元时所预期的杂合子频率。这需要计算混合样本中的平均等位基因频率 $\\bar{p}$。\n等位基因 $A$ 的平均频率是各亚群体等位基因频率的加权平均值：\n$$\n\\bar{p} = w_1 p_1 + w_2 p_2\n$$\n等位基因 $a$ 的平均频率是 $\\bar{q} = 1 - \\bar{p}$。\n对于这个混合等位基因频率，在HWE下预期的杂合子频率 $H_{\\text{exp}}$ 为：\n$$\nH_{\\text{exp}} = 2\\bar{p}\\bar{q} = 2\\bar{p}(1-\\bar{p}) = 2(w_1 p_1 + w_2 p_2)(1 - (w_1 p_1 + w_2 p_2))\n$$\n\n杂合子缺失 $D$ 定义为 $D \\equiv H_{\\text{exp}} - H_{\\text{obs}}$。\n$$\nD = 2(w_1 p_1 + w_2 p_2)(1 - w_1 p_1 - w_2 p_2) - \\left[ 2w_1p_1(1-p_1) + 2w_2p_2(1-p_2) \\right]\n$$\n为简便起见，我们可以先处理 $D/2$：\n$$\n\\frac{D}{2} = (w_1 p_1 + w_2 p_2)(1 - w_1 p_1 - w_2 p_2) - [w_1p_1(1-p_1) + w_2p_2(1-p_2)]\n$$\n展开各项：\n$$\n\\frac{D}{2} = (w_1p_1 + w_2p_2) - (w_1p_1 + w_2p_2)^2 - (w_1p_1 - w_1p_1^2) - (w_2p_2 - w_2p_2^2)\n$$\n线性项相互抵消：$(w_1p_1 + w_2p_2) - w_1p_1 - w_2p_2 = 0$。\n$$\n\\frac{D}{2} = -(w_1p_1 + w_2p_2)^2 + w_1p_1^2 + w_2p_2^2\n$$\n展开平方二项式：\n$$\n\\frac{D}{2} = -(w_1^2p_1^2 + 2w_1w_2p_1p_2 + w_2^2p_2^2) + w_1p_1^2 + w_2p_2^2\n$$\n重新整理各项：\n$$\n\\frac{D}{2} = (w_1p_1^2 - w_1^2p_1^2) + (w_2p_2^2 - w_2^2p_2^2) - 2w_1w_2p_1p_2\n$$\n提出因子 $w_1p_1^2$ 和 $w_2p_2^2$：\n$$\n\\frac{D}{2} = w_1p_1^2(1-w_1) + w_2p_2^2(1-w_2) - 2w_1w_2p_1p_2\n$$\n使用约束条件 $w_1+w_2=1$，我们有 $1-w_1=w_2$ 和 $1-w_2=w_1$。将它们代入表达式中：\n$$\n\\frac{D}{2} = w_1p_1^2(w_2) + w_2p_2^2(w_1) - 2w_1w_2p_1p_2\n$$\n提出公因子 $w_1w_2$：\n$$\n\\frac{D}{2} = w_1w_2 (p_1^2 + p_2^2 - 2p_1p_2)\n$$\n括号中的项是一个完全平方，即 $(p_1-p_2)^2$。\n$$\n\\frac{D}{2} = w_1w_2 (p_1 - p_2)^2\n$$\n最后，乘以 $2$ 得到 $D$ 的表达式：\n$$\nD = 2w_1w_2(p_1 - p_2)^2\n$$\n该表达式表明，缺失值 $D$ 始终为非负数，因为 $w_1, w_2\n\\ge 0$ 且 $(p_1-p_2)^2 \\ge 0$。仅当 $p_1=p_2$（没有遗传分化）或其中一个亚群体未被抽样（例如，$w_1=0$ 或 $w_2=0$）时，缺失值才为零。缺失值与亚群体权重的乘积及其等位基因频率差异的平方成正比。这对于给定的系统量化了Wahlund效应。", "answer": "$$\n\\boxed{2w_{1}w_{2}(p_{1} - p_{2})^{2}}\n$$", "id": "2798300"}, {"introduction": "现代进化生物学越来越依赖基因组数据来推断进化过程和参数。连锁不平衡（Linkage disequilibrium, LD），尤其是其标准化度量 $r^2$，为我们了解一个群体的历史提供了强有力的信号。本练习模拟了群体遗传学家的工作，利用一个连接 $r^2$、有效种群大小 $N_e$ 和重组率 $\\rho$ 的理论模型。你将利用这个模型，根据观测到的连锁不平衡数据和给定的基因组图谱，来估计性别平均的重组率。这项计算实践展示了进化理论如何为基因组数据的统计推断提供一个严谨的框架。掌握这种方法，你就能将原始的遗传数据转化为关于基本进化参数的定量见解，这是当代生物学的一项核心技能。[@problem_id:2798309]", "problem": "一位群体遗传学家正在分析沿染色体的单核苷酸多态性对，以估计能够最佳解释所观察到的连锁不平衡（LD）衰减的性别平均重组率。你需要编写一个程序，在给定一个交换图谱和一组作为基因组距离函数的 LD 观测值的情况下，使用基于演化理论的有原则的回归方法来估计性别平均重组率。该程序必须是完全确定性的，并且不得从用户读取输入。\n\n从群体遗传学中的以下基本基础和核心定义出发，在你的推理中不要使用任何未经证明的快捷公式：在一个有效群体大小为 $N_e$、遵循 Wright–Fisher 模型的随机交配二倍体群体中，两个位点之间的配子不平衡系数 $D$ 每代都会因重组而减少，并因随机遗传漂变而改变。而两个位点上等位基因之间非随机关联的标准化度量 $r^2$ 会随着位点间有效重组距离的增加而衰减。交换图谱指定了重组强度沿基因组的变化方式，因此两个位置之间的有效重组距离是通过对它们之间的局部交换强度进行积分得到的。假设所有交配都是随机的，在所考虑的距离内选择的作用可以忽略不计，并且在连锁不平衡形成的时间尺度上，突变率足够小，其在塑造短程连锁不平衡中的作用不及重组。\n\n提供给你一个一兆碱基窗口内的分段常数交换图谱。该图谱表示为多个片段，每个片段上具有恒定的无量纲交换权重 $w(x)$，单位为兆碱基 (Mb)。令 $W_{ij}$ 表示两个位置 $x_i$ 和 $x_j$（单位为 Mb）之间的积分交换权重，定义为当 $x_j \\ge x_i$ 时，$W_{ij} = \\int_{x_i}^{x_j} w(x)\\,dx$，否则 $W_{ij} = \\int_{x_j}^{x_i} w(x)\\,dx$。假设性别平均重组率 $\\rho$ 的单位为每兆碱基的重组分数（每代），因此在所考虑的 $W_{ij}$ 范围内，$x_i$ 和 $x_j$ 之间的重组分数建模为 $c_{ij} = \\rho \\, W_{ij}$。在上述假设下，存在一个经过充分检验的近似方法，它将预期的标准化连锁不平衡 $r^2$ 表示为 $c_{ij}$ 和 $N_e$ 的单调递减函数。你必须使用这一理论关系来构建一个似然或回归模型，以便从观测值中估计 $\\rho$。你的方法必须强制 $\\rho \\ge 0$。\n\n实现要求：\n- 通过对提供的分段常数图谱进行精确积分来计算每个 $W_{ij}$。\n- 对每个测试用例，使用从理论推导出的似然或回归方法来估计单个标量 $\\hat{\\rho}$。\n- 以厘摩根每兆碱基（cM/Mb）为单位报告最终的性别平均重组率估计值。请记住，$1$ 重组分数等于 $100$ 厘摩根，因此 $\\text{cM/Mb} = 100 \\times \\rho$。\n- 将每个最终数值结果表示为精确到三位小数的浮点数。\n- 你的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如，“[$a,b,c$]”，其中 $a$、$b$ 和 $c$ 是按指定顺序排列的三个数值答案。输出中不要包含单位或多余的空格。\n\n测试套件：\n对于以下每个案例，所有位置的单位均为兆碱基 (Mb)，交换权重是无量纲的，观测到的连锁不平衡值是标准化的 $r^2$ 值。\n\n案例 A（均匀交换图谱；中等重组率；中等有效群体大小）：\n- 有效群体大小: $N_e = 10000$。\n- 交换图谱片段: $[(0.0, 1.0, 1.0)]$，表示在 $[0.0, 1.0]$ 上 $w(x) = 1.0$。\n- 位点对及观测到的标准化LD：\n  - 位置 $(0.00, 0.01)$，观测 $r^2 = 0.175$。\n  - 位置 $(0.00, 0.02)$，观测 $r^2 = 0.093$。\n  - 位置 $(0.00, 0.05)$，观测 $r^2 = 0.042$。\n  - 位置 $(0.00, 0.10)$，观测 $r^2 = 0.019$。\n  - 位置 $(0.00, 0.20)$，观测 $r^2 = 0.010$。\n\n案例 B（热点图谱；较低重组率；较大有效群体大小）：\n- 有效群体大小: $N_e = 15000$。\n- 交换图谱片段: $[(0.0, 0.5, 0.5), (0.5, 0.7, 3.0), (0.7, 1.0, 1.0)]$。\n- 位点对及观测到的标准化LD：\n  - 位置 $(0.10, 0.40)$，观测 $r^2 = 0.0142$。\n  - 位置 $(0.40, 0.55)$，观测 $r^2 = 0.0100$。\n  - 位置 $(0.55, 0.65)$，观测 $r^2 = 0.0073$。\n  - 位置 $(0.65, 0.90)$，观测 $r^2 = 0.0059$。\n  - 位置 $(0.10, 0.90)$，观测 $r^2 = 0.0021$。\n\n案例 C（均匀交换图谱；极低重组率；较小有效群体大小）：\n- 有效群体大小: $N_e = 5000$。\n- 交换图谱片段: $[(0.0, 1.0, 1.0)]$。\n- 位点对及观测到的标准化LD：\n  - 位置 $(0.00, 0.01)$，观测 $r^2 = 0.82$。\n  - 位置 $(0.00, 0.05)$，观测 $r^2 = 0.52$。\n  - 位置 $(0.00, 0.20)$，观测 $r^2 = 0.19$。\n  - 位置 $(0.00, 1.00)$，观测 $r^2 = 0.047$。\n\n假设与约束：\n- 将每个观测到的 $r^2$ 视为在其对应有效重组距离的理论期望附近的独立抽样，其噪音相对于均值较小。你必须基于理论上合理的 $r^2$ 期望值、$N_e$ 和 $c_{ij}$ 之间的单调关系来构建你的估计器。\n- 你的程序必须为每个案例估计 $\\rho$，并以厘摩根每兆碱基（cM/Mb）为单位输出性别平均重组率，四舍五入到三位小数，形式为单行列表：“[$\\hat{\\rho}_A,\\hat{\\rho}_B,\\hat{\\rho}_C$]”。\n- 角度单位不适用。输出中不得使用百分比。最终输出中的单位已由问题要求隐含，不得打印。\n\n你的程序应生成单行输出，包含三个用方括号括起来的逗号分隔列表形式的结果（例如，“[$x,y,z$]”）。", "solution": "该问题要求通过将连锁不平衡 ($r^2$) 的观测数据拟合到一个理论模型来估计性别平均重组率 $\\rho$。该模型基于 Wright-Fisher 模型，适用于一个有效群体大小为 $N_e$ 的二倍体、随机交配群体，在遗传漂变和重组的作用下演化，而突变和选择的影响可以忽略不计。\n\n核心理论关系将标准化连锁不平衡的期望值 $E[r^2]$ 与有效群体大小 $N_e$及两个位点间的重组分数 $c$ 联系起来。这个关系由 Ohta、Kimura 和 Sved 建立，表达式如下：\n$$ E[r^2] = \\frac{1}{1 + 4N_e c} $$\n该方程描述了平衡状态，在此状态下，由重组引起的 LD 衰减与由随机遗传漂变产生的 LD 达到平衡。\n\n问题规定，两个基因组位置 $x_i$ 和 $x_j$ 之间的重组分数 $c_{ij}$ 是性别平均重组率 $\\rho$（单位为每兆碱基的重组分数）和积分交换权重 $W_{ij}$ 的函数。表达式为：\n$$ c_{ij} = \\rho W_{ij} $$\n积分交换权重 $W_{ij}$ 是根据分段常数交换图谱 $w(x)$ 计算得出的：\n$$ W_{ij} = \\int_{\\min(x_i, x_j)}^{\\max(x_i, x_j)} w(x)\\,dx $$\n对于一个由具有恒定权重 $w_k$ 的片段 $[s_{k, \\text{start}}, s_{k, \\text{end}}]$ 组成的图谱，该积分通过对与区间 $[x_i, x_j]$ 重叠的每个片段的贡献求和来计算。\n\n将 $c_{ij}$ 的表达式代入 $E[r^2]$ 的方程，我们得到给定一对位点的预测 $r^2$ 作为未知参数 $\\rho$ 的函数：\n$$ E[r^2_{ij}] = \\frac{1}{1 + 4N_e \\rho W_{ij}} $$\n\n为了估计 $\\rho$，我们必须找到最能拟合一组观测数据点的值，每个数据点包含一个观测到的 LD 值 $r^2_{\\text{obs}, k}$ 和一个对应的积分交换权重 $W_{ij, k}$。一种有原则的估计方法是对此模型的变换形式进行线性回归。通过重新排列方程，我们可以建立一个线性关系。\n令 $y_k = \\frac{1}{r^2_{\\text{obs}, k}} - 1$。\n理论模型预测 $y_k \\approx \\frac{1}{E[r^2_{ij,k}]} - 1 = 4N_e \\rho W_{ij,k}$。\n令 $x_k = 4 N_e W_{ij,k}$。\n该关系简化为一个强制通过原点的线性模型：\n$$ y_k = \\rho x_k + \\epsilon_k $$\n其中 $\\epsilon_k$ 是一个误差项。任务是找到斜率 $\\rho$ 以最小化残差平方和 $S(\\rho) = \\sum_k (y_k - \\rho x_k)^2$。这是一个无截距模型的标准普通最小二乘 (OLS) 问题。\n\n$\\rho$ 的 OLS 估计量可以通过将 $S(\\rho)$ 对 $\\rho$ 的导数设为零来求得：\n$$ \\frac{dS}{d\\rho} = \\frac{d}{d\\rho} \\sum_k (y_k - \\rho x_k)^2 = \\sum_k 2(y_k - \\rho x_k)(-x_k) = -2 \\sum_k (x_k y_k - \\rho x_k^2) = 0 $$\n解出 $\\rho$，我们得到估计量 $\\hat{\\rho}$：\n$$ \\hat{\\rho} = \\frac{\\sum_k x_k y_k}{\\sum_k x_k^2} $$\n代入 $x_k$ 和 $y_k$ 的表达式：\n$$ \\hat{\\rho} = \\frac{\\sum_k (4 N_e W_{ij,k}) (\\frac{1}{r^2_{\\text{obs}, k}} - 1)}{\\sum_k (4 N_e W_{ij,k})^2} = \\frac{1}{4 N_e} \\frac{\\sum_k W_{ij,k} (\\frac{1}{r^2_{\\text{obs}, k}} - 1)}{\\sum_k W_{ij,k}^2} $$\n问题要求最终结果以厘摩根每兆碱基（cM/Mb）为单位。由于 $1$ 单位的重组分数等于 $100$ 厘摩根，转换公式为：\n$$ \\hat{\\rho}_{\\text{cM/Mb}} = 100 \\times \\hat{\\rho} $$\n程序必须为每个测试用例实现以下算法：\n1.  初始化两个累加器 `sum_xy` 和 `sum_x2` 为 $0$。\n2.  对于每个数据点 $k$（一对位置 $(x_i, x_j)$ 和一个观测值 $r^2_{\\text{obs}, k}$）：\n    a.  通过在 $x_i$ 和 $x_j$ 之间对分段常数交换图谱 $w(x)$ 进行积分，来计算积分交换权重 $W_{ij,k}$。这涉及到识别两个位置之间的所有图谱片段并对其加权长度求和。\n    b.  计算变换后的变量：$x_k = 4 N_e W_{ij,k}$ 和 $y_k = \\frac{1}{r^2_{\\text{obs}, k}} - 1$。\n    c.  更新累加器：`sum_xy += x_k * y_k` 和 `sum_x2 += x_k * x_k`。\n3.  处理完所有数据点后，使用公式 $\\hat{\\rho} = \\frac{\\text{sum\\_xy}}{\\text{sum\\_x2}}$ 计算 $\\rho$ 的估计值。\n4.  将估计值转换为 cM/Mb 单位：$\\hat{\\rho}_{\\text{cM/Mb}} = 100 \\times \\hat{\\rho}$。\n5.  将最终结果四舍五入到三位小数。\n\n此过程是确定性的，并且基于已建立的群体遗传学理论，满足问题陈述的所有要求。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the sex-averaged recombination rate for three test cases\n    based on a population genetics model of linkage disequilibrium decay.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"Ne\": 10000.0,\n            \"crossover_map\": [(0.0, 1.0, 1.0)],\n            \"ld_data\": [\n                ((0.00, 0.01), 0.175),\n                ((0.00, 0.02), 0.093),\n                ((0.00, 0.05), 0.042),\n                ((0.00, 0.10), 0.019),\n                ((0.00, 0.20), 0.010),\n            ]\n        },\n        {\n            \"Ne\": 15000.0,\n            \"crossover_map\": [(0.0, 0.5, 0.5), (0.5, 0.7, 3.0), (0.7, 1.0, 1.0)],\n            \"ld_data\": [\n                ((0.10, 0.40), 0.0142),\n                ((0.40, 0.55), 0.0100),\n                ((0.55, 0.65), 0.0073),\n                ((0.65, 0.90), 0.0059),\n                ((0.10, 0.90), 0.0021),\n            ]\n        },\n        {\n            \"Ne\": 5000.0,\n            \"crossover_map\": [(0.0, 1.0, 1.0)],\n            \"ld_data\": [\n                ((0.00, 0.01), 0.82),\n                ((0.00, 0.05), 0.52),\n                ((0.00, 0.20), 0.19),\n                ((0.00, 1.00), 0.047),\n            ]\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        result = estimate_recombination_rate(\n            Ne=case[\"Ne\"],\n            crossover_map=case[\"crossover_map\"],\n            ld_data=case[\"ld_data\"]\n        )\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_W(pos1, pos2, crossover_map):\n    \"\"\"\n    Calculates the integrated crossover weight W_ij between two positions.\n\n    Args:\n        pos1 (float): The first genomic position in Mb.\n        pos2 (float): The second genomic position in Mb.\n        crossover_map (list): A list of tuples (start, end, weight)\n                              representing the piecewise-constant map.\n\n    Returns:\n        float: The integrated crossover weight.\n    \"\"\"\n    start_pos = min(pos1, pos2)\n    end_pos = max(pos1, pos2)\n    \n    total_W = 0.0\n    for seg_start, seg_end, seg_weight in crossover_map:\n        overlap_start = max(start_pos, seg_start)\n        overlap_end = min(end_pos, seg_end)\n        \n        if overlap_end > overlap_start:\n            overlap_length = overlap_end - overlap_start\n            total_W += overlap_length * seg_weight\n            \n    return total_W\n\ndef estimate_recombination_rate(Ne, crossover_map, ld_data):\n    \"\"\"\n    Estimates the recombination rate rho using linear regression on a\n    transformed model of LD decay.\n\n    Args:\n        Ne (float): The effective population size.\n        crossover_map (list): The crossover map definition.\n        ld_data (list): A list of tuples ((pos1, pos2), r2_obs).\n\n    Returns:\n        float: The estimated recombination rate in cM/Mb, rounded to 3 places.\n    \"\"\"\n    # Sums for the linear regression y = rho * x, where rho = sum(xy) / sum(x^2)\n    # y = 1/r^2 - 1\n    # x = 4 * Ne * W\n    sum_xy = 0.0\n    sum_x2 = 0.0\n\n    for (positions, r2_obs) in ld_data:\n        pos1, pos2 = positions\n        \n        # Calculate integrated crossover weight W\n        W_ij = calculate_W(pos1, pos2, crossover_map)\n        \n        # Linearized variables for regression through the origin\n        # y = rho * x\n        y_k = (1.0 / r2_obs) - 1.0\n        x_k = 4.0 * Ne * W_ij\n        \n        sum_xy += x_k * y_k\n        sum_x2 += x_k * x_k\n        \n    # Estimate rho (in recombination fraction per Mb)\n    if sum_x2 == 0:\n        # Avoid division by zero, though unlikely with valid inputs\n        rho_hat = 0.0\n    else:\n        rho_hat = sum_xy / sum_x2\n    \n    # Convert to cM/Mb and round\n    rho_cM_per_Mb = 100.0 * rho_hat\n    \n    return round(rho_cM_per_Mb, 3)\n\nsolve()\n```", "id": "2798309"}]}