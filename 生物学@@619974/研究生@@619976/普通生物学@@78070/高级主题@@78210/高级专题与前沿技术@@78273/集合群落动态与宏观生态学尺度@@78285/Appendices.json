{"hands_on_practices": [{"introduction": "本练习将引导你探讨宏观生态学中最基本的标度律之一：物种-面积关系（Species-Area Relationship, SAR）。通过一个假设的数据集，你将亲手实践如何使用统计上更为严谨的最大似然估计方法，来拟合两种常见的SAR模型，并利用赤池信息准则（Akaike Information Criterion, AIC）进行模型选择。这项实践不仅能加深你对生物多样性空间格局的理解，更为重要的是，它将为你提供分析真实生态学数据时必备的核心建模技能[@problem_id:2816069]。", "problem": "给定来自单一集合群落在多个空间粒度（面积）下的嵌套样方观测数据。每次观测包含一个以公顷为单位的面积和相应的观测物种丰富度（一个非负整数）。假设物种库是单一的，且在每个粒度上，物种的出现是稀有的，并且在物种间近似独立。在这些假设下，面积为 $A$ 的样方中出现的物种数量可以被建模为一个泊松随机变量，其均值等于由物种-面积关系函数预测的期望物种丰富度。\n\n您的任务是，对下面的每个数据集，在泊松抽样模型下，通过最大似然法拟合两个竞争的物种-面积关系模型，然后执行模型选择，以推断出最合理的标度形式。\n\n需要拟合的模型：\n- 模型P（幂律；Arrhenius形式）：$S(A) = c A^{z}$，其中 $c > 0$ 且 $z > 0$。\n- 模型G（Gleason半对数形式）：$S(A) = k + b \\ln A$，约束条件为对于所有观测到的 $A$，都有 $S(A) > 0$。\n\n您必须基于以下基本假设：\n- 在面积 $A_i$ 处观测到的物种丰富度是均值为 $\\mu_i = S(A_i)$ 的泊松随机变量的一个实现。\n- 对于独立的泊松观测值 $\\{(A_i, s_i)\\}_{i=1}^{n}$，其对数似然函数为\n$$\n\\ell(\\theta) = \\sum_{i=1}^{n} \\left[ s_i \\ln \\mu_i(\\theta) - \\mu_i(\\theta) - \\ln(s_i!) \\right],\n$$\n其中 $\\theta$ 表示模型参数，$\\mu_i(\\theta)$ 表示模型对 $A_i$ 预测的均值。\n- 赤池信息准则 (AIC) 为\n$$\n\\mathrm{AIC} = 2p - 2 \\ell(\\hat{\\theta}),\n$$\n其中 $p$ 是自由参数的数量，$\\hat{\\theta}$ 是最大似然估计值。\n\n实现要求：\n- 通过最大化泊松对数似然（等效于最小化负对数似然）来拟合两个模型，同时满足所述的参数约束。\n- 对于模型P，强制 $c > 0$ 和 $z > 0$。为保证优化的数值稳定性，您可以为一个小的固定值 $\\varepsilon$ 实现下界 $c \\ge \\varepsilon$ 和 $z \\ge \\varepsilon$。\n- 对于模型G，强制对所有观测到的 $A_i$ 满足 $k + b \\ln A_i > 0$。为保证数值稳定性，您可以为同一个小的 $\\varepsilon$ 值实现 $k + b \\ln A_i \\ge \\varepsilon$。\n- 对于每个数据集，使用每个模型的最大化对数似然计算 $\\mathrm{AIC}_\\mathrm{P}$ 和 $\\mathrm{AIC}_\\mathrm{G}$。两个模型均使用 $p = 2$。\n- 决策规则：如果 $\\mathrm{AIC}_\\mathrm{P} + \\delta < \\mathrm{AIC}_\\mathrm{G}$，返回 $0$；如果 $\\mathrm{AIC}_\\mathrm{G} + \\delta < \\mathrm{AIC}_\\mathrm{P}$，返回 $1$；如果 $\\lvert \\mathrm{AIC}_\\mathrm{P} - \\mathrm{AIC}_\\mathrm{G} \\rvert \\le \\delta$，返回 $2$。其中 $\\delta = 2$ 是一个固定的容差，代表实际等效。\n\n数据以一个包含四个嵌套样方数据集的测试套件形式提供。面积单位为公顷，物种计数无量纲：\n\n- 数据集 $1$：\n  - 面积（公顷）：[$1$, $2$, $4$, $8$, $16$, $32$]\n  - 物种计数：[$5$, $6$, $7$, $9$, $10$, $12$]\n\n- 数据集 $2$：\n  - 面积（公顷）：[$1$, $2$, $4$, $8$, $16$, $32$, $64$]\n  - 物种计数：[$8$, $10$, $12$, $15$, $16$, $19$, $21$]\n\n- 数据集 $3$：\n  - 面积（公顷）：[$1$, $4$, $16$]\n  - 物种计数：[$10$, $13$, $17$]\n\n- 数据集 $4$：\n  - 面积（公顷）：[$1$, $2$, $4$, $8$, $16$, $32$, $64$]\n  - 物种计数：[$3$, $4$, $5$, $6$, $7$, $7$, $8$]\n\n最终输出规范：\n- 您的程序应按上述顺序处理所有四个数据集，并输出一行，其中包含一个由四个整数组成的列表，每个整数根据上述决策规则对应一个数据集。也就是说，对于每个数据集 $i$，如果模型P更优，则输出 $0$；如果模型G更优，则输出 $1$；如果在容差 $\\delta$ 范围内两者实际无法区分，则输出 $2$。\n- 最后一行必须以方括号括起来的逗号分隔列表形式打印，例如：[$0$, $1$, $2$, $0$]。\n\n不涉及角度单位。除所述的以公顷为单位的面积外，没有出现其他物理单位。所有数值输出均为所述的整数。不需要用户输入；所有数据均按上述规定在程序中硬编码。确保代码是确定性的和自包含的，仅使用允许的库。", "solution": "问题陈述已经过严格评估，并被确定为有效。它在科学上植根于生态学理论和统计方法论，问题提法清晰，提供了所有必要信息，并且表述客观。我们将着手推导和实现一个解决方案。\n\n任务是为四个数据集拟合两个竞争的物种-面积关系（SAR）模型，并使用赤池信息准则（AIC）为每个数据集选择最合理的模型。\n\n**1. 统计框架与目标函数**\n\n问题陈述指出，在面积为 $A_i$ 的样方中观测到的物种丰富度 $s_i$ 是泊松随机变量的一个实现，其均值为 $\\mu_i = S(A_i)$，其中 $S(A)$ 是真实的物种-面积关系。对于一组包含 $n$ 个独立观测值 $\\{(A_i, s_i)\\}_{i=1}^{n}$ 的集合，对数似然函数由下式给出：\n$$\n\\ell(\\theta) = \\sum_{i=1}^{n} \\left[ s_i \\ln \\mu_i(\\theta) - \\mu_i(\\theta) - \\ln(s_i!) \\right]\n$$\n其中 $\\theta$ 表示模型参数。\n\n最大似然估计（MLE）旨在寻找使 $\\ell(\\theta)$ 最大化的参数值 $\\hat{\\theta}$。这等效于最小化负对数似然（NLL）。项 $\\sum_{i=1}^{n} \\ln(s_i!)$ 相对于 $\\theta$ 是一个常数，在优化过程中可以省略。我们将要最小化的目标函数定义为：\n$$\nf(\\theta) = -\\sum_{i=1}^{n} \\left[ s_i \\ln \\mu_i(\\theta) - \\mu_i(\\theta) \\right] = \\sum_{i=1}^{n} \\left[ \\mu_i(\\theta) - s_i \\ln \\mu_i(\\theta) \\right]\n$$\n设 $\\hat{\\theta}$ 是最小化 $f(\\theta)$ 的参数，并设 $f^* = f(\\hat{\\theta})$ 是该函数的最小值。\n\n**2. 物种-面积关系模型与参数估计**\n\n我们必须为每个数据集拟合两个模型。将使用 `scipy.optimize.minimize` 函数进行数值优化。一个小的常数 $\\varepsilon = 10^{-9}$ 将用于约束中的数值稳定性。\n\n**模型P（幂律）：**\n期望物种丰富度由 Arrhenius 形式给出：\n$$\nS(A; c, z) = c A^z\n$$\n参数为 $\\theta_P = (c, z)$，约束条件为 $c > 0$ 和 $z > 0$。对于数值优化，这些约束实现为箱式界限：$c \\ge \\varepsilon$ 和 $z \\ge \\varepsilon$。\n初始参数估计 $(c_0, z_0)$ 通过对模型进行线性化来获得：$\\ln S = \\ln c + z \\ln A$。我们对 $\\ln s_i$ 关于 $\\ln A_i$ 进行线性回归，`numpy.polyfit` 函数适合此任务。\n\n**模型G（Gleason半对数）：**\n期望物种丰富度由 Gleason 形式给出：\n$$\nS(A; k, b) = k + b \\ln A\n$$\n参数为 $\\theta_G = (k, b)$。约束条件是对于所有观测面积，预测的均值必须为正，即 $k + b \\ln A_i > 0$。这通过 `scipy.optimize.LinearConstraint` 实现为一组线性不等式约束，$k + b \\ln A_i \\ge \\varepsilon$。\n初始参数估计 $(k_0, b_0)$ 通过 $s_i$ 关于 $\\ln A_i$ 的线性回归获得。\n\n**3. 通过赤池信息准则（AIC）进行模型选择**\n\nAIC 的定义为：\n$$\n\\mathrm{AIC} = 2p - 2\\ell(\\hat{\\theta})\n$$\n其中 $p$ 是自由参数的数量，$\\ell(\\hat{\\theta})$ 是最大化后的对数似然。代入 $\\ell(\\hat{\\theta})$ 和 $f^*$ 之间的关系：\n$$\n\\ell(\\hat{\\theta}) = -f^* - \\sum_{i=1}^{n} \\ln(s_i!)\n$$\nAIC 可以表示为：\n$$\n\\mathrm{AIC} = 2p - 2\\left(-f^* - \\sum_{i=1}^{n} \\ln(s_i!)\\right) = 2p + 2f^* + 2\\sum_{i=1}^{n} \\ln(s_i!)\n$$\n对于给定的数据集，项 $2\\sum \\ln(s_i!)$ 对两个模型都是一个常数。在比较两个模型的 AIC 值时，这个常数会抵消。模型P和模型G都有 $p=2$ 个参数。设 $f_P^*$ 和 $f_G^*$ 分别为幂律模型和 Gleason 模型的最小化NLL值。\n\n比较 $\\mathrm{AIC}_P < \\mathrm{AIC}_G$ 等价于 $2p_P + 2f_P^* < 2p_G + 2f_G^*$。由于 $p_P = p_G = 2$，这可以简化为 $4 + 2f_P^* < 4 + 2f_G^*$，即 $f_P^* < f_G^*$。\n\n问题指定了基于容差 $\\delta = 2$ 的决策规则。\n- **选择模型P（输出 $0$）**：如果 $\\mathrm{AIC}_P + \\delta < \\mathrm{AIC}_G$。这等价于 $2p_P + 2f_P^* + \\delta < 2p_G + 2f_G^*$，简化为 $f_P^* + \\delta/2 < f_G^*$。当 $\\delta=2$ 时，条件是 $f_P^* + 1 < f_G^*$。\n- **选择模型G（输出 $1$）**：如果 $\\mathrm{AIC}_G + \\delta < \\mathrm{AIC}_P$。根据对称性，即为 $f_G^* + 1 < f_P^*$。\n- **无法区分（输出 $2$）**：如果 $|\\mathrm{AIC}_P - \\mathrm{AIC}_G| \\le \\delta$。这等价于 $|(2p_P + 2f_P^*) - (2p_G + 2f_G^*)| \\le \\delta$，简化为 $|f_P^* - f_G^*| \\le \\delta/2$。当 $\\delta=2$ 时，即为 $|f_P^* - f_G^*| \\le 1$。\n\n该程序将系统地应用于四个提供的数据集，以确定最终的输出向量。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize, LinearConstraint\n\ndef solve():\n    \"\"\"\n    Fits power-law and semi-log species-area models to ecological data,\n    and performs model selection using AIC.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Dataset 1\n        {\n            \"areas\": np.array([1, 2, 4, 8, 16, 32], dtype=float),\n            \"counts\": np.array([5, 6, 7, 9, 10, 12], dtype=float),\n        },\n        # Dataset 2\n        {\n            \"areas\": np.array([1, 2, 4, 8, 16, 32, 64], dtype=float),\n            \"counts\": np.array([8, 10, 12, 15, 16, 19, 21], dtype=float),\n        },\n        # Dataset 3\n        {\n            \"areas\": np.array([1, 4, 16], dtype=float),\n            \"counts\": np.array([10, 13, 17], dtype=float),\n        },\n        # Dataset 4\n        {\n            \"areas\": np.array([1, 2, 4, 8, 16, 32, 64], dtype=float),\n            \"counts\": np.array([3, 4, 5, 6, 7, 7, 8], dtype=float),\n        },\n    ]\n\n    # Small constant for numerical stability in constraints.\n    EPS = 1e-9\n    \n    # Model P (Power-law): S(A) = c * A^z\n    def model_p(params, A):\n        c, z = params\n        return c * A**z\n\n    # Model G (Gleason/semi-log): S(A) = k + b*ln(A)\n    def model_g(params, A):\n        k, b = params\n        return k + b * np.log(A)\n\n    # Negative log-likelihood for Poisson distributed counts.\n    # The constant term sum(ln(s_i!)) is omitted as it cancels during AIC comparison.\n    def nll_poisson(params, model_func, A, s):\n        mu = model_func(params, A)\n        # Safeguard against non-positive means, though constraints should prevent this.\n        if np.any(mu = 0):\n            return np.inf\n        \n        # log-likelihood = s * log(mu) - mu\n        # negative log-likelihood = mu - s * log(mu)\n        return np.sum(mu - s * np.log(mu))\n\n    results = []\n    \n    for case in test_cases:\n        A = case[\"areas\"]\n        s = case[\"counts\"]\n\n        # --- Fit Model P (Power-law) ---\n        # Initial guess from log-log linear regression: log(s) ~ log(c) + z*log(A)\n        # np.polyfit returns [slope, intercept]\n        try:\n            # Handle cases where counts might be zero, which is not the case here.\n            valid_pts = s > 0\n            if np.sum(valid_pts) > 1:\n                z0, log_c0 = np.polyfit(np.log(A[valid_pts]), np.log(s[valid_pts]), 1)\n                c0 = np.exp(log_c0)\n            else: # Fallback initial guess\n                c0, z0 = np.mean(s), 0.25\n        except (np.linalg.LinAlgError, ValueError):\n            c0, z0 = np.mean(s), 0.25\n        x0_p = [c0, z0]\n        \n        # Parameter bounds: c > 0, z > 0\n        bounds_p = [(EPS, None), (EPS, None)]\n\n        res_p = minimize(\n            fun=nll_poisson,\n            x0=x0_p,\n            args=(model_p, A, s),\n            method='L-BFGS-B',\n            bounds=bounds_p\n        )\n        nll_p_min = res_p.fun\n\n        # --- Fit Model G (Gleason/semi-log) ---\n        # Initial guess from semi-log linear regression: s ~ k + b*log(A)\n        try:\n            b0, k0 = np.polyfit(np.log(A), s, 1)\n        except (np.linalg.LinAlgError, ValueError):\n            k0, b0 = np.mean(s), 1.0\n        x0_g = [k0, b0]\n\n        # Linear constraints: k + b*ln(A_i) >= EPS for all i\n        n = len(A)\n        constraint_matrix_g = np.vstack([np.ones(n), np.log(A)]).T\n        lb_g = np.full(n, EPS)\n        constraints_g = LinearConstraint(constraint_matrix_g, lb_g, np.inf)\n\n        res_g = minimize(\n            fun=nll_poisson,\n            x0=x0_g,\n            args=(model_g, A, s),\n            method='SLSQP',\n            constraints=constraints_g\n        )\n        nll_g_min = res_g.fun\n\n        # --- Model Selection ---\n        # Compare based on AIC difference, which simplifies to NLL difference\n        # Delta_AIC = AIC_P - AIC_G = 2*(NLL_P - NLL_G)\n        # Decision rule tolerance delta = 2, so NLL tolerance is delta/2 = 1.\n        nll_tolerance = 1.0\n        \n        if nll_p_min + nll_tolerance  nll_g_min:\n            results.append(0)  # Model P is preferred\n        elif nll_g_min + nll_tolerance  nll_p_min:\n            results.append(1)  # Model G is preferred\n        else:\n            results.append(2)  # Models are practically indistinguishable\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2816069"}, {"introduction": "像物种-面积关系这样的模型依赖于准确的物种丰富度数据，然而在实际野外调查中，我们几乎总会因不完美探测（imperfect detection）而漏掉一些物种。本练习将带你从第一性原理出发，推导不完美探测如何导致对 $\\alpha$ 多样性（物种丰富度）和 $\\beta$ 多样性的估计产生系统性偏差。你将学会如何利用群落占域模型（community occupancy model）的思想来校正这些偏差，并最终计算出一个考虑了探测误差的群落相异度指数[@problem_id:2816065]。", "problem": "一个集合群落由一个大小为 $S$ 的物种库组成，这些物种可能占据两个生境斑块（$j \\in \\{1,2\\}$）。每个物种在地点 $j$ 有一个特定地点的占据概率 $\\,\\psi_{j}\\,$，该概率在物种间相同且物种间相互独立。在一个短暂的时间窗口内（种群动态封闭），每个地点被调查 $K$ 次，单次访问的探测概率为 $p$，该概率在物种间和重复调查间相同，且没有假阳性。由于不完全探测，出现在某个地点的物种在某些或所有访问中可能会被漏掉。\n\n根据占据和探测的基本定义，按以下步骤进行：\n\n1) 从 $K$ 次访问中探测的独立性以及至少一次探测的指标出发，推导在地点 $j$ 至少被探测到一次的物种的期望数量（记为 $X_{j}$），用 $S$、$\\psi_{j}$、$K$ 和 $p$ 表示。并以此解释为什么 $X_{j}$ 是真实地点物种丰富度 $R_{j} = S \\psi_{j}$ 的一个向下偏倚的估计量。\n\n2) 使用第 (1) 部分的结果，推导 $R_{j}$ 和 $\\psi_{j}$ 的无偏估计量，用 $X_{j}$、$S$、$K$ 和 $p$ 表示。\n\n3) 假设对于任何给定物种，其在两个地点的占据事件是独立的，概率分别为 $\\psi_{1}$ 和 $\\psi_{2}$。仅用 $\\psi_{1}$ 和 $\\psi_{2}$ 推导两个地点之间真实 Jaccard 相异性的表达式。回想一下，Jaccard 相异性是 1 减去物种集合的交集与并集的比率。\n\n4) 在一项研究中，$S = 150$ 个物种，每个地点进行 $K = 3$ 次重复调查，两个地点的单次访问探测概率均为 $p = 0.4$。观测到的至少被探测到一次的物种数量分别为 $X_{1} = 68$ 和 $X_{2} = 74$。使用你的推导和上述独立性假设，计算两个地点之间经过探测校正的 Jaccard 相异性，结果为一个十进制数。将你的答案四舍五入到四位有效数字。最终答案中不要包含单位。", "solution": "所提出的问题是定量生态学中一个定义明确的练习，具体涉及在探测不完全的情况下，根据调查数据估计群落参数。\n\n首先，需要对问题陈述进行验证。\n\n步骤1：提取已知条件。\n- 一个集合群落由一个大小为 $S$ 的物种库组成。\n- 有两个生境斑块，$j \\in \\{1,2\\}$。\n- 特定地点的占据概率在地点 $j$ 为 $\\psi_{j}$，在物种间相同且物种间相互独立。\n- 每个地点被调查 $K$ 次。\n- 单次访问的探测概率为 $p$，在物种间和重复调查间相同。\n- 没有假阳性。\n- $X_{j}$ 是在地点 $j$ 至少被探测到一次的物种数量。\n- $R_{j} = S \\psi_{j}$ 是地点 $j$ 的真实地点物种丰富度。\n- 对于任何给定物种，在两个地点的占据事件是独立的。\n- Jaccard 相异性是 1 减去物种集合的交集与并集的比率。\n- 用于数值计算的数据：$S = 150$，$K = 3$，$p = 0.4$，$X_{1} = 68$，$X_{2} = 74$。\n\n步骤2：验证。\n该问题具有科学依据，采用了占据模型（现代生态学中处理观测误差的基本工具）的标准概念。所提出的框架（例如，参数 $\\psi$ 和 $p$，使用重复调查）是该领域的基石。该问题提法恰当，逻辑结构清晰，并提供了足够的信息来推导出唯一解。其语言客观、精确，使用了既定术语。它不含科学或事实上的不严谨之处，是可形式化的，并与其陈述的主题相关；内容完整且一致，给出了切合实际的参数值，并且并非无足轻重。\n\n步骤3：结论。\n该问题有效。将提供解答。\n\n该问题分四部分解答。\n\n1) 推导探测到的物种的期望数量 $E[X_{j}]$，并解释偏倚。\n我们考虑单个物种 $i$ 在单个地点 $j$ 的情况。要使该物种在地点 $j$ 被探测到，必须发生两个独立事件：首先，该物种必须出现在地点 $j$；其次，它必须在 $K$ 次调查中至少被探测到一次。\n\n出现的概率为 $P(\\text{出现}) = \\psi_{j}$。\n在物种出现的条件下，单次调查探测到它的概率是 $p$。因此，单次调查*未*探测到它的概率是 $1-p$。\n由于 $K$ 次调查是独立的，在*任何*一次调查中都未探测到一个已出现物种的概率是 $(1-p)^{K}$。\n因此，至少探测到一次已出现物种的概率是其补集事件的概率，即 $P(\\text{探测到 }|\\text{ 出现}) = 1 - (1-p)^{K}$。\n\n在地点 $j$ 探测到物种 $i$ 的无条件概率是这两个独立事件概率的乘积：\n$$P(\\text{物种 } i \\text{ 在地点 } j \\text{ 被探测到}) = P(\\text{探测到 }|\\text{ 出现}) \\times P(\\text{出现}) = \\psi_{j} \\left( 1 - (1-p)^{K} \\right)$$\n在地点 $j$ 探测到的物种总数（记为 $X_{j}$）是 $S$ 个物种中每个物种被探测到的指示变量之和。根据期望的线性性质以及所有物种参数均相同的假设，探测到的物种的期望数量为：\n$$E[X_{j}] = \\sum_{i=1}^{S} P(\\text{物种 } i \\text{ 在地点 } j \\text{ 被探测到}) = S \\psi_{j} \\left( 1 - (1-p)^{K} \\right)$$\n地点 $j$ 的真实物种丰富度定义为 $R_{j} = S \\psi_{j}$。将其代入 $E[X_{j}]$ 的表达式中可得：\n$$E[X_{j}] = R_{j} \\left( 1 - (1-p)^{K} \\right)$$\n为了证明 $X_{j}$ 是 $R_{j}$ 的一个向下偏倚的估计量，我们考察其中的乘法因子。假定探测是可能的，即 $0  p \\le 1$ 且 $K \\ge 1$，则 $1-p$ 的范围是 $0 \\le 1-p  1$。因此，$(1-p)^{K}$ 的范围是 $0 \\le (1-p)^{K}  1$。这意味着因子 $\\left( 1 - (1-p)^{K} \\right)$ 严格小于 1（除非 $p=1$，此时探测是完美的，没有偏倚）。\n因此，对于任何不完全探测的情况（$p1$），都有 $E[X_{j}]  R_{j}$。根据定义，如果一个估计量的期望值不等于它所要估计的参数，那么这个估计量就是有偏的。由于其期望值系统性地低于真实值，$X_{j}$ 是 $R_{j}$ 的一个向下偏倚的估计量。\n\n2) 推导 $R_{j}$ 和 $\\psi_{j}$ 的无偏估计量。\n为了构建 $R_{j}$ 的无偏估计量，我们使用上面推导出的关系式 $E[X_{j}] = R_{j} \\left( 1 - (1-p)^{K} \\right)$。我们可以重新整理此式以求解 $R_{j}$。使用矩估计法，我们用观测值 $X_{j}$ 代替其期望，提出一个估计量 $\\hat{R}_{j}$：\n$$\\hat{R}_{j} = \\frac{X_{j}}{1 - (1-p)^{K}}$$\n为了确认该估计量是无偏的，我们求其期望：\n$$E[\\hat{R}_{j}] = E\\left[\\frac{X_{j}}{1 - (1-p)^{K}}\\right] = \\frac{1}{1 - (1-p)^{K}} E[X_{j}]$$\n代入 $E[X_{j}]$ 的表达式：\n$$E[\\hat{R}_{j}] = \\frac{1}{1 - (1-p)^{K}} \\left( R_{j} \\left( 1 - (1-p)^{K} \\right) \\right) = R_{j}$$\n由于 $E[\\hat{R}_{j}] = R_{j}$，该估计量是无偏的。\n\n接下来，我们推导 $\\psi_{j}$ 的无偏估计量。我们从定义 $R_{j} = S \\psi_{j}$ 开始，这意味着 $\\psi_{j} = R_{j} / S$。通过用无偏估计量 $\\hat{R}_{j}$ 代替 $R_{j}$，我们可以得到一个直观的估计量 $\\hat{\\psi}_{j}$：\n$$\\hat{\\psi}_{j} = \\frac{\\hat{R}_{j}}{S} = \\frac{1}{S} \\left( \\frac{X_{j}}{1 - (1-p)^{K}} \\right) = \\frac{X_{j}}{S \\left( 1 - (1-p)^{K} \\right)}$$\n此估计量的期望是：\n$$E[\\hat{\\psi}_{j}] = E\\left[\\frac{\\hat{R}_{j}}{S}\\right] = \\frac{1}{S} E[\\hat{R}_{j}] = \\frac{R_{j}}{S} = \\frac{S \\psi_{j}}{S} = \\psi_{j}$$\n这证实了 $\\hat{\\psi}_{j}$ 是 $\\psi_{j}$ 的一个无偏估计量。\n\n3) 推导真实的 Jaccard 相异性。\nJaccard 相异性 $J_{d}$ 定义为 $1 - J_{s}$，其中 $J_{s}$ 是 Jaccard 相似性。对于两个物种集合 $A_{1}$（地点 1 的物种）和 $A_{2}$（地点 2 的物种），相似性为 $J_{s} = \\frac{|A_{1} \\cap A_{2}|}{|A_{1} \\cup A_{2}|}$。我们关心的是真实的群落组成，因此我们使用从真实占据概率 $\\psi_{1}$ 和 $\\psi_{2}$ 推导出的期望集合大小。\n\n交集中的期望物种数 $E[|A_{1} \\cap A_{2}|]$ 是同时出现在两个地点的物种的期望数量。鉴于任何给定物种在两个地点之间的占据事件是独立的，一个物种同时出现在地点 1 和地点 2 的概率是 $\\psi_{1} \\psi_{2}$。因此，对于一个包含 $S$ 个物种的物种库：\n$$E[|A_{1} \\cap A_{2}|] = S \\psi_{1} \\psi_{2}$$\n并集的期望大小可以通过容斥原理找到：$E[|A_{1} \\cup A_{2}|] = E[|A_{1}|] + E[|A_{2}|] - E[|A_{1} \\cap A_{2}|]$。\n我们有 $E[|A_{1}|] = E[R_{1}] = S\\psi_{1}$ 和 $E[|A_{2}|] = E[R_{2}] = S\\psi_{2}$。\n$$E[|A_{1} \\cup A_{2}|] = S\\psi_{1} + S\\psi_{2} - S\\psi_{1}\\psi_{2} = S(\\psi_{1} + \\psi_{2} - \\psi_{1}\\psi_{2})$$\n真实的 Jaccard 相似性是这些期望值的比率：\n$$J_{s} = \\frac{E[|A_{1} \\cap A_{2}|]}{E[|A_{1} \\cup A_{2}|]} = \\frac{S \\psi_{1} \\psi_{2}}{S(\\psi_{1} + \\psi_{2} - \\psi_{1}\\psi_{2})} = \\frac{\\psi_{1} \\psi_{2}}{\\psi_{1} + \\psi_{2} - \\psi_{1}\\psi_{2}}$$\n因此，真实的 Jaccard 相异性是：\n$$J_{d} = 1 - J_{s} = 1 - \\frac{\\psi_{1} \\psi_{2}}{\\psi_{1} + \\psi_{2} - \\psi_{1}\\psi_{2}} = \\frac{(\\psi_{1} + \\psi_{2} - \\psi_{1}\\psi_{2}) - \\psi_{1}\\psi_{2}}{\\psi_{1} + \\psi_{2} - \\psi_{1}\\psi_{2}} = \\frac{\\psi_{1} + \\psi_{2} - 2\\psi_{1}\\psi_{2}}{\\psi_{1} + \\psi_{2} - \\psi_{1}\\psi_{2}}$$\n这就是所求的表达式。\n\n4) 探测校正的 Jaccard 相异性的数值计算。\n给定数据为 $S = 150$，$K = 3$，$p = 0.4$，$X_{1} = 68$ 和 $X_{2} = 74$。\n首先，我们计算占据概率的无偏估计值 $\\hat{\\psi}_{1}$ 和 $\\hat{\\psi}_{2}$。\n探测到一个已出现物种至少一次的概率是：\n$$p' = 1 - (1-p)^{K} = 1 - (1-0.4)^{3} = 1 - (0.6)^{3} = 1 - 0.216 = 0.784$$\n使用第 (2) 部分的估计量：\n$$\\hat{\\psi}_{j} = \\frac{X_{j}}{S \\cdot p'}$$\n对于地点 1：\n$$\\hat{\\psi}_{1} = \\frac{68}{150 \\times 0.784} = \\frac{68}{117.6} = \\frac{85}{147}$$\n对于地点 2：\n$$\\hat{\\psi}_{2} = \\frac{74}{150 \\times 0.784} = \\frac{74}{117.6} = \\frac{185}{294}$$\n现在，我们将这些估计的概率代入第 (3) 部分的 Jaccard 相异性公式中。令 $\\psi_1 = \\hat{\\psi}_1$ 和 $\\psi_2 = \\hat{\\psi}_2$。为保持精度，我们使用分数进行计算。$\\hat{\\psi}_1$ 可写作 $\\frac{170}{294}$，与 $\\hat{\\psi}_2 = \\frac{185}{294}$ 的公分母是 294。\n和：$\\psi_{1} + \\psi_{2} = \\frac{170}{294} + \\frac{185}{294} = \\frac{355}{294}$。\n积：$\\psi_{1} \\psi_{2} = \\frac{170}{294} \\times \\frac{185}{294} = \\frac{31450}{86436}$。\nJaccard 相异性公式的分子是：\n$$\\psi_{1} + \\psi_{2} - 2\\psi_{1}\\psi_{2} = \\frac{355}{294} - 2 \\cdot \\frac{31450}{86436} = \\frac{355 \\times 294}{294 \\times 294} - \\frac{62900}{86436} = \\frac{104370 - 62900}{86436} = \\frac{41470}{86436}$$\n该公式的分母是：\n$$\\psi_{1} + \\psi_{2} - \\psi_{1}\\psi_{2} = \\frac{355}{294} - \\frac{31450}{86436} = \\frac{104370 - 31450}{86436} = \\frac{72920}{86436}$$\n经探测校正的 Jaccard 相异性是这两个量的比值：\n$$J_{d} = \\frac{41470 / 86436}{72920 / 86436} = \\frac{41470}{72920} = \\frac{4147}{7292} \\approx 0.5687054...$$\n四舍五入到四位有效数字，结果是 $0.5687$。", "answer": "$$\\boxed{0.5687}$$", "id": "2816065"}, {"introduction": "本高级练习在前一个练习的基础上，探讨了元群落研究中的一个关键挑战：如何区分生态过程与观测过程。你将通过数学推导，揭示一个空间变化的探测概率梯度（例如，随着距离增加，探测变得更加困难）如何能够制造出一种虚假的相似性距离衰减（distance-decay of similarity）模式。这种模式通常被解释为物种扩散受限的证据，但此练习将展示，若不仔细地对观测过程进行建模，我们可能会得出关于生态动态的错误结论[@problem_id:2815987]。", "problem": "一个元群落由大量物种组成，这些物种分布在相距为 $d$ 的 $2$ 个地点。相似性不存在真实的距离衰减：对于随机选择的一个物种，其在两个地点的真实联合占据概率与距离无关，由 $P(11)=t$、$P(10)=u$、$P(01)=u$ 和 $P(00)=1 - t - 2u$ 给出，其中 $t \\in (0,1)$ 和 $u \\in (0,1)$ 满足 $t + 2u \\leq 1$。每个地点进行一次调查，存在不完全探测且无假阳性：在物种真实存在的条件下，地点 $i \\in \\{1,2\\}$ 的探测概率为 $p_i(d) \\in (0,1)$，且在地点间和物种间独立。探测概率通过逻辑斯蒂链接（logistic link）与地点水平的探测协变量 $C_i(d)$ 系统性地变化，$p_i(d) = \\left[1 + \\exp\\left(-(\\alpha + \\beta C_i(d))\\right)\\right]^{-1}$，其中 $\\alpha$ 和 $\\beta$ 为常数。假设偏远性会降低更远地点的探测概率，使得 $C_1(d) = c_0$ 和 $C_2(d) = c_0 - \\gamma d$，其中 $c_0 \\in \\mathbb{R}$ 且 $\\gamma  0$。\n\n定义根据大量物种的观测探测数据计算出的 Jaccard 相似性为 $J_{\\mathrm{obs}}(d) = \\frac{a}{a+b+c}$，其中 $a$ 是在两个地点都被探测到的物种比例， $b$ 是仅在地点 1 被探测到的物种比例， $c$ 是仅在地点 2 被探测到的物种比例。\n\na) 从上述联合占据和条件探测的定义出发，并假设在给定 $(t,u)$ 和 $(p_1(d),p_2(d))$ 的条件下物种是可交换和独立的，推导期望的观测 Jaccard 相似性 $J_{\\mathrm{obs}}(d)$ 作为 $t$、$u$、$p_1(d)$ 和 $p_2(d)$ 的函数。仅使用全概率定律和 Jaccard 指数的定义。\n\nb) 通过计算您在 a) 部分得到的表达式关于 $p_2(d)$ 的偏导数，解释为何当 $t$ 和 $u$ 与距离无关时，$p_2(d)$ 随 $d$ 的系统性下降会在 $J_{\\mathrm{obs}}(d)$ 中产生虚假的距离衰减。\n\nc) 现在假设已使用重复调查来拟合探测模型，并为探测过程生成了一致估计量 $\\hat{\\alpha}$ 和 $\\hat{\\beta}$。在大物种数量极限下，观测比例 $(a,b,c)$ 收敛于其在探测过程下的期望值。仅使用探测过程的代数反演和真实 Jaccard 相似性 $J_{\\mathrm{true}} = \\frac{t}{t + 2u}$ 的定义，推导一个基于模型的闭式校正 $J_{\\mathrm{corr}}(d)$，该校正将 $J_{\\mathrm{true}}$ 表示为可观测量 $(a,b,c)$、估计的探测参数 $(\\hat{\\alpha},\\hat{\\beta})$ 和协变量值 $(C_1(d),C_2(d))$ 的形式。然后在 $C_1(d) = c_0$ 和 $C_2(d) = c_0 - \\gamma d$ 的条件下明确写出该校正公式。\n\n请以 c) 部分获得的 $J_{\\mathrm{corr}}(d)$ 的单一闭式表达式作为您的最终答案。无需进行数值计算，Jaccard 相似性没有单位。确保您的表达式完全由 $d$、$(a,b,c)$、$(\\hat{\\alpha},\\hat{\\beta})$、$c_0$ 和 $\\gamma$ 明确表示。", "solution": "问题陈述根据既定标准进行了验证。\n\n**步骤 1：提取已知条件**\n- 元群落地点：$2$ 个，相距为 $d$。\n- 真实联合占据概率：$P(11)=t$、$P(10)=u$、$P(01)=u$、$P(00)=1 - t - 2u$。\n- 参数约束：$t \\in (0,1)$、$u \\in (0,1)$、$t + 2u \\leq 1$。这些参数与距离无关。\n- 探测过程：不完全探测，无假阳性。\n- 地点 $i \\in \\{1,2\\}$ 的条件探测概率：$p_i(d) \\in (0,1)$，在地点间和物种间独立。\n- 探测模型：$p_i(d) = \\left[1 + \\exp\\left(-(\\alpha + \\beta C_i(d))\\right)\\right]^{-1}$。\n- 探测协变量：$C_1(d) = c_0$ 和 $C_2(d) = c_0 - \\gamma d$。\n- 协变量参数：$c_0 \\in \\mathbb{R}$，$\\gamma  0$。\n- 观测 Jaccard 相似性：$J_{\\mathrm{obs}}(d) = \\frac{a}{a+b+c}$，其中 $a$、$b$、$c$ 分别是在两个地点、仅在地点 1、仅在地点 2 被探测到的物种比例。\n- (a) 部分：推导期望的 $J_{\\mathrm{obs}}(d)$ 作为 $t, u, p_1(d), p_2(d)$ 的函数。\n- (b) 部分：使用 $\\frac{\\partial J_{\\mathrm{obs}}(d)}{\\partial p_2(d)}$ 解释虚假的距离衰减。\n- (c) 部分：推导一个校正后的相似性 $J_{\\mathrm{corr}}(d)$，该相似性将 $J_{\\mathrm{true}} = \\frac{t}{t+2u}$ 表示为可观测量 $(a,b,c)$、估计的参数 $(\\hat{\\alpha},\\hat{\\beta})$ 和协变量 $(C_1(d), C_2(d))$ 的形式，并以 $d$ 完全显式表示。\n\n**步骤 2：验证**\n该问题具有科学依据，使用了来自占据模型和群落生态学的标准概念（Jaccard 相似性，逻辑斯蒂探测函数）。问题提法得当，提供了推导所需表达式的所有必要定义和参数。语言客观、正式。问题结构逻辑清晰，引导了一个推导过程，该过程解决的是生态数据分析中的一个重要问题：生物过程与观测偏差的混淆。该问题未违反任何无效标准。\n\n**步骤 3：结论**\n问题有效。将提供完整解答。\n\n解答按顺序处理问题的每个部分。设 $S_i \\in \\{0, 1\\}$ 为地点 $i$ 的真实存在-缺失状态，而 $O_i \\in \\{0, 1\\}$ 为地点 $i$ 的观测探测状态。给定的真实联合占据概率为 $P(S_1=1, S_2=1)=t$、$P(S_1=1, S_2=0)=u$、$P(S_1=0, S_2=1)=u$ 和 $P(S_1=0, S_2=0)=1-t-2u$。条件探测概率为 $p_1(d) = P(O_1=1|S_1=1)$ 和 $p_2(d) = P(O_2=1|S_2=1)$。不存在假阳性，因此 $P(O_i=1|S_i=0)=0$。为简洁起见，我们将记作 $p_1$ 和 $p_2$。\n\n**a) 期望的观测 Jaccard 相似性的推导**\n\n在物种数量极大的极限情况下，观测到的比例 $a, b, c$ 收敛于它们的期望值，即联合观测状态下的概率。\n$a = P(O_1=1, O_2=1)$\n$b = P(O_1=1, O_2=0)$\n$c = P(O_1=0, O_2=1)$\n\n我们使用全概率定律，以四种可能的真实状态 $(S_1, S_2)$ 为条件。\n比例 $a$ 为：\n$$a = P(O_1=1, O_2=1) = \\sum_{s_1,s_2 \\in \\{0,1\\}} P(O_1=1, O_2=1 | S_1=s_1, S_2=s_2) P(S_1=s_1, S_2=s_2)$$\n由于无假阳性规则，唯一非零项对应于 $(S_1, S_2) = (1,1)$。在物种存在的条件下，探测是独立的。\n$$a = P(O_1=1|S_1=1)P(O_2=1|S_2=1)P(S_1=1, S_2=1) = p_1 p_2 t$$\n比例 $b$ 为：\n$$b = P(O_1=1, O_2=0) = P(O_1=1, O_2=0|S_1=1, S_2=1)P(11) + P(O_1=1, O_2=0|S_1=1, S_2=0)P(10)$$\n$$b = (p_1 (1-p_2))t + (p_1 \\cdot 1)u = p_1 t - p_1 p_2 t + p_1 u = p_1(t+u) - p_1 p_2 t$$\n根据对称性，比例 $c$ 为：\n$$c = P(O_1=0, O_2=1) = P(O_1=0, O_2=1|S_1=1, S_2=1)P(11) + P(O_1=0, O_2=1|S_1=0, S_2=1)P(01)$$\n$$c = ((1-p_1) p_2)t + (1 \\cdot p_2)u = p_2 t - p_1 p_2 t + p_2 u = p_2(t+u) - p_1 p_2 t$$\n观测 Jaccard 相似性为 $J_{\\mathrm{obs}}(d) = \\frac{a}{a+b+c}$。分母为：\n$$a+b+c = (p_1 p_2 t) + (p_1(t+u) - p_1 p_2 t) + (p_2(t+u) - p_1 p_2 t) = p_1(t+u) + p_2(t+u) - p_1 p_2 t$$\n因此，期望的观测 Jaccard 相似性为：\n$$J_{\\mathrm{obs}}(d) = \\frac{p_1 p_2 t}{p_1(t+u) + p_2(t+u) - p_1 p_2 t}$$\n\n**b) 虚假的距离衰减**\n\n为理解 $J_{\\mathrm{obs}}(d)$ 如何随 $p_2(d)$ 变化，我们计算其关于 $p_2(d)$ 的偏导数 $\\frac{\\partial J_{\\mathrm{obs}}(d)}{\\partial p_2(d)}$，并将 $p_1$ 视为常数。令 $N = p_1 p_2 t$ 且 $D = p_1(t+u) + p_2(t+u) - p_1 p_2 t = p_1(t+u) + p_2((t+u)-p_1 t)$。\n使用商法则，$\\frac{\\partial J_{\\mathrm{obs}}}{\\partial p_2} = \\frac{(\\partial N/\\partial p_2) D - N (\\partial D/\\partial p_2)}{D^2}$：\n$$\\frac{\\partial N}{\\partial p_2} = p_1 t$$\n$$\\frac{\\partial D}{\\partial p_2} = (t+u) - p_1 t$$\n导数的分子为：\n$$(p_1 t)[p_1(t+u) + p_2(t+u) - p_1 p_2 t] - (p_1 p_2 t)[(t+u) - p_1 t]$$\n$$= p_1^2 t(t+u) + p_1 p_2 t(t+u) - p_1^2 p_2 t^2 - p_1 p_2 t(t+u) + p_1^2 p_2 t^2$$\n$$= p_1^2 t(t+u)$$\n导数为：\n$$\\frac{\\partial J_{\\mathrm{obs}}}{\\partial p_2} = \\frac{p_1^2 t(t+u)}{[p_1(t+u) + p_2(t+u) - p_1 p_2 t]^2}$$\n分母是一个平方项，恒为正。在分子中，$p_1^2  0$、$t  0$ 且 $u  0$（给定 $u \\in (0,1)$），所以 $t+u  0$。因此，$\\frac{\\partial J_{\\mathrm{obs}}}{\\partial p_2}  0$。这表明 $J_{\\mathrm{obs}}(d)$ 是 $p_2(d)$ 的一个严格递增函数。\n\n问题指定 $C_2(d) = c_0 - \\gamma d$ 且 $\\gamma  0$，因此地点 2 的协变量随距离 $d$ 减小。探测概率为 $p_2(d) = [1 + \\exp(-(\\alpha + \\beta C_2(d)))]^{-1}$。为使“偏远性降低探测概率”，$p_2(d)$ 必须随 $d$ 的增加而减小。这意味着 $\\frac{dp_2}{dd}  0$。根据链式法则，$\\frac{dp_2}{dd} = \\frac{\\partial p_2}{\\partial C_2}\\frac{dC_2}{dd}$。我们有 $\\frac{dC_2}{dd} = -\\gamma  0$。逻辑斯蒂函数对其输入的导数为正，所以 $\\frac{\\partial p_2}{\\partial C_2}$ 的符号与 $\\beta$ 的符号相同。因此，为使 $\\frac{dp_2}{dd}  0$，我们需要 $\\beta  0$。\n\n由于 $J_{\\mathrm{obs}}(d)$ 是 $p_2(d)$ 的增函数，而 $p_2(d)$ 是 $d$ 的减函数（假设 $\\beta0$），$J_{\\mathrm{obs}}(d)$ 必然是 $d$ 的减函数。这造成了相似性随距离下降的模式，即距离衰减，尽管真实的占据参数 $t$ 和 $u$ 是恒定的。这是一个由观测偏差引起的虚假结果。\n\n**c) 基于模型的 Jaccard 相似性校正**\n\n目标是使用可观测的比例 $(a,b,c)$ 和估计的探测模型，找到真实 Jaccard 相似性 $J_{\\mathrm{true}} = \\frac{t}{t+2u}$ 的表达式。可观测量通过 (a) 部分推导出的方程与真实参数和探测概率相关联：\n1) $a = p_1 p_2 t$\n2) $b = p_1(t+u) - a$\n3) $c = p_2(t+u) - a$\n\n由此，我们可以用可观测量来表示 $J_{\\mathrm{true}}$ 的各组成部分。\n从 (1) 式，我们求解 $t$：\n$$t = \\frac{a}{p_1 p_2}$$\n从 (2) 和 (3) 式，我们可以求解 $(t+u)$：\n$$t+u = \\frac{a+b}{p_1}$$\n$$t+u = \\frac{a+c}{p_2}$$\n将 $t$ 和 $t+u$ 的表达式结合起来，我们可以求解 $u$：\n$$u = (t+u) - t = \\frac{a+b}{p_1} - \\frac{a}{p_1 p_2} = \\frac{(a+b)p_2 - a}{p_1 p_2}$$\n接下来，我们构建 $J_{\\mathrm{true}}$ 的分母 $t+2u$：\n$$t+2u = t+u+u = \\frac{a+b}{p_1} + \\frac{(a+b)p_2 - a}{p_1 p_2} = \\frac{(a+b)p_2 + (a+b)p_2 - a}{p_1 p_2} = \\frac{2(a+b)p_2 - a}{p_1 p_2}$$\n或者，使用一个更对称的形式，我们知道 $t+2u$ 可以写为：\n$t+2u = \\frac{(a+b)p_2+(a+c)p_1-a}{p_1 p_2}$\n最后，我们构建校正后的 Jaccard 指数 $J_{\\mathrm{corr}}(d)$，这是我们对 $J_{\\mathrm{true}}$ 的估计：\n$$J_{\\mathrm{corr}}(d) = J_{\\mathrm{true}} = \\frac{t}{t+2u} = \\frac{\\frac{a}{p_1 p_2}}{\\frac{(a+b)p_2+(a+c)p_1-a}{p_1 p_2}} = \\frac{a}{(a+b)p_2 + (a+c)p_1 - a}$$\n探测概率 $p_1$ 和 $p_2$ 被它们的估计值所替代，这些估计值使用拟合的参数 $\\hat{\\alpha}, \\hat{\\beta}$ 和已知的协变量得出。\n$$\\hat{p}_1(d) = \\left[1 + \\exp\\left(-(\\hat{\\alpha} + \\hat{\\beta} C_1(d))\\right)\\right]^{-1} = \\left[1 + \\exp\\left(-(\\hat{\\alpha} + \\hat{\\beta} c_0)\\right)\\right]^{-1}$$\n$$\\hat{p}_2(d) = \\left[1 + \\exp\\left(-(\\hat{\\alpha} + \\hat{\\beta} C_2(d))\\right)\\right]^{-1} = \\left[1 + \\exp\\left(-(\\hat{\\alpha} + \\hat{\\beta} (c_0 - \\gamma d))\\right)\\right]^{-1}$$\n将这些代入 $J_{\\mathrm{corr}}(d)$ 的表达式，得到最终的显式公式：\n$$J_{\\mathrm{corr}}(d) = \\frac{a}{(a+b)\\left[1 + \\exp\\left(-(\\hat{\\alpha} + \\hat{\\beta} (c_0 - \\gamma d))\\right)\\right]^{-1} + (a+c)\\left[1 + \\exp\\left(-(\\hat{\\alpha} + \\hat{\\beta} c_0)\\right)\\right]^{-1} - a}$$\n该表达式使用探测模型校正观测数据 $(a,b,c)$，以提供对真实 Jaccard 相似性的估计，该估计与距离 $d$ 无关。", "answer": "$$\n\\boxed{\n\\frac{a}{(a+b)\\left[1 + \\exp\\left(-(\\hat{\\alpha} + \\hat{\\beta} c_0 - \\hat{\\beta}\\gamma d)\\right)\\right]^{-1} + (a+c)\\left[1 + \\exp\\left(-(\\hat{\\alpha} + \\hat{\\beta} c_0)\\right)\\right]^{-1} - a}\n}\n$$", "id": "2815987"}]}