{"hands_on_practices": [{"introduction": "这项实践将挑战你像一位实验胚胎学家一样思考。通过分析一个经典的肢体移植实验，你将探索 Sonic hedgehog (*Shh*) 形态发生素如何构建前后轴。核心任务不仅是预测异位 *Shh* 表达的表型结果，更重要的是，设计一个分子策略来区分形态发生素作用的两种基本模型：长程梯度模型与短程接力模型。这个练习将磨练你在分子水平上提出并检验竞争性假说的能力。[@problem_id:2569623]", "problem": "在鸡翼芽中进行的一项经典移植手术，是在其前缘放置第二个 Sonic hedgehog (*Shh*) 源，从而产生异位的前部 *Shh* 表达，而内源性的后部极化活动区 (Zone of Polarizing Activity, ZPA) 保持完整。考虑一个处于Hamburger-Hamilton分期20 (HH20)的翼芽，在指骨前后轴身份被指定的阶段，将一个浸泡过 *Shh* 的珠子植入其前部一个短暂的时间窗口。假设以下基本事实作为推理的基础：(i) 形态发生素是一种分泌因子，它形成一个浓度场，由细胞通过阈值解读为不同的命运；(ii) 分子生物学中心法则 (DNA $\\rightarrow$ RNA $\\rightarrow$ 蛋白质) 允许通过立即早期转录靶标直接读出信号传导；以及 (iii) *Shh* 与 Patched1 (*Ptch1*) 结合，去抑制 Smoothened 以激活 GLI 转录因子；*Ptch1* 和 *Gli1* 是 *Shh* 信号的直接转录靶标，而 *Gremlin1* 和 $5^{\\prime}$ *Hoxd*基因（例如 *Hoxd13*）可以通过与顶外胚层脊 (apical ectodermal ridge, AER) 发出的成纤维细胞生长因子 (Fibroblast Growth Factor, FGF) 信号的反馈间接维持。\n\n在这一异位前部 *Shh* 场景下，哪个选项最能预测指骨序列，并提出一种基于标记物的实验策略，用以区分直接长程 *Shh* 梯度机制与短程 *Shh* 中继机制？\n\nA. 预测出现前后轴序列为 $4$-$3$-$2$-$2$-$3$-$4$ 的镜像重复。为区分这两种机制，在早期时间点（例如，移植后约 $6$–$8$ 小时和约 $18$–$24$ 小时）对 *Ptch1* 和 *Gli1* 进行时间分辨的原位杂交。直接梯度模型预测，在早期，*Ptch1*/*Gli1* 的表达会呈现两个局部最大值，分别以内源性后部和异位前部源为中心，并向场中心单调衰减；*Alx4* 应在两个源附近被对称地抑制。中继模型预测，在早期，*Ptch1*/*Gli1* 的表达仅限于 *Shh* 源附近的区域，而到晚期，*Gremlin1* 和 *Hoxd13* 的表达会更广泛地扩展到中央间充质中，超出 *Ptch1*/*Gli1* 的表达域。\n\nB. 预测出现前后轴序列为 $2$-$3$-$4$-$4$-$3$-$2$ 的镜像重复。为区分这两种机制，追踪 AER 中 *Fgf8* 的扩展，并预期如果梯度机制起作用，*Ptch1* 会在整个间充质中均匀表达；如果中继机制起作用，*Ptch1* 应在前部缺失。\n\nC. 预测出现前后轴序列为 $4$-$3$-$2$-$2$-$3$-$4$ 的镜像重复。为区分这两种机制，仅将 *Hoxd13* 作为 *Shh* 梯度的直接读出进行量化；梯度应产生一个均匀的 *Hoxd13* 平台，而中继应产生一个斑块状的 *Hoxd13* 表达域。\n\nD. 预测出现无序、无镜像对称的多指畸形。为区分这两种机制，检测 *Tbx5* 与 *Tbx4* 的表达；梯度应将前部的 *Tbx5* 转换为 *Tbx4*，而中继机制不应改变 *Tbx5*/*Tbx4* 的表达。", "solution": "该问题陈述在科学上是合理的，提法恰当且内部一致。它描述了发育生物学中的一个经典实验——将形态发生素 Sonic hedgehog (*Shh*) 异位施加于发育中的鸡肢芽。所提供的关于 *Shh* 信号通路及其转录靶标的假设基于已确立的分子生物学知识，为解决问题提供了有效的框架。问题要求预测产生的表型，并设计一个实验来区分两种相互竞争的形态发生素作用模型，这是模式建成研究中的一个核心任务。因此，可以推导出一个严谨的解决方案。\n\n问题描述了一个处于Hamburger-Hamilton分期20 (HH20)的鸡翼芽，它有两个形态发生素 *Shh* 的来源：内源性的后部极化活动区 (ZPA) 和一个植入前部的、浸泡过 *Shh* 的珠子。这个设置在肢芽前后 (AP) 轴的前后两极创造了两个信号中心。\n\n首先，我们必须预测最终的指骨模式。在正常发育中，单一的后部 *Shh* 源建立一个从后向前递减的梯度。这个浓度梯度被间充质细胞解读，以从后到前的顺序 $4, 3, 2$ 指定指骨身份。高 *Shh* 浓度指定最靠后的指骨，即指骨 $4$；中等浓度指定指骨 $3$；低浓度指定指骨 $2$。当存在两个相对的 *Shh* 源时，将会建立两个梯度，每个梯度都从其各自的极点向肢芽中心衰减。\n-   离后部ZPA最近的细胞将接收到最高的 *Shh* 浓度并形成指骨 $4$。\n-   离后部ZPA稍远的细胞将接收到中等浓度并形成指骨 $3$。\n-   离前部 *Shh* 珠子最近的细胞也将接收到最高的 *Shh* 浓度并形成指骨 $4$。\n-   离前部珠子稍远的细胞将接收到中等浓度并形成指骨 $3$。\n-   位于肢芽中心、与两个源等距的细胞，将接收到来自任一梯度的最低 *Shh* 浓度，导致形成由 *Shh* 指定的最前部的指骨身份，即指骨 $2$。\n这将导致一个对称的模式。从前向后读，指骨序列将是一个镜像重复：$4$-$3$-$2$-$2$-$3$-$4$。\n\n其次，我们必须设计一个实验策略来区分直接长程梯度机制和短程中继机制。关键在于利用问题中提供的关于 *Shh* 信号通路的信息。问题陈述 *Ptch1* 和 *Gli1* 是 *Shh* 信号的直接转录靶标。相比之下，*Gremlin1* 和 $5^{\\prime}$ *Hoxd*基因（如 *Hoxd13*）是间接维持的，可能通过一个涉及成纤维细胞生长因子 (FGF) 信号的反馈回路。\n\n-   **直接长程梯度模型 (Direct Long-Range Gradient Model):** 该模型假定 *Shh* 蛋白本身扩散穿过整个场并被所有细胞直接“读取”。如果这是真的，那么活跃的 *Shh* 信号的空间域应直接对应于被模式化的场的全部范围。因此，直接靶标 *Ptch1* 和 *Gli1* 的表达应反映 *Shh* 配体本身的浓度梯度。在实验上，人们会预期看到两个宽阔的 *Ptch1* 和 *Gli1* 表达域，每个域在 *Shh* 源附近有一个峰值，并向肢芽中心平滑地衰减。这些基因的表达应跨越最终将形成指骨 $2, 3$ 和 $4$ 的整个区域。\n\n-   **短程中继模型 (Short-Range Relay Model):** 该模型假定 *Shh* 仅在其源头的短距离内起作用，以激活一个次级信号分子或一个自我传播的基因调控网络，然后由后者对组织的其余部分进行模式化。如果这是真的，那么 *Shh* 的直接转录靶标 (*Ptch1*, *Gli1*) 将只在靠近 *Shh* 源的一个狭窄细胞区域内被激活。人们将观察到，间接或下游靶标（如 *Gremlin1* 和后部 *Hoxd* 基因）的表达会随着时间扩展到中央组织中，远远超出 *Ptch1*/*Gli1* 表达的初始受限域。\n\n一个决定性的实验将涉及使用原位杂交进行时程分析，以可视化直接 (*Ptch1*, *Gli1*) 和间接 (*Gremlin1*, *Hoxd13*) 靶标的表达域。比较这两类基因的空间范围和动态变化，将揭示直接 *Shh* 信号的范围是否与最终模式的范围相匹配。\n\n现在，让我们基于这一推理来评估每个选项。\n\n**A. 预测出现前后轴序列为 $4$-$3$-$2$-$2$-$3$-$4$ 的镜像重复。为区分这两种机制，在早期时间点（例如，移植后约 $6$–$8$ 小时和约 $18$–$24$ 小时）对 *Ptch1* 和 *Gli1* 进行时间分辨的原位杂交。直接梯度模型预测，在早期，*Ptch1*/*Gli1* 的表达会呈现两个局部最大值，分别以内源性后部和异位前部源为中心，并向场中心单调衰减；*Alx4* 应在两个源附近被对称地抑制。中继模型预测，在早期，*Ptch1*/*Gli1* 的表达仅限于 *Shh* 源附近的区域，而到晚期，*Gremlin1* 和 *Hoxd13* 的表达会更广泛地扩展到中央间充质中，超出 *Ptch1*/*Gli1* 的表达域。**\n\n这个选项完全正确。\n-   如上所述，预测的指骨模式 $4$-$3$-$2$-$2$-$3$-$4$ 是准确的。\n-   提出的实验——对直接 (*Ptch1*, *Gli1*) 和间接 (*Gremlin1*, *Hoxd13*) 靶标进行时间分辨的比较——正是正确的策略。\n-   对直接梯度模型的预测（宽阔、分级的 *Ptch1*/*Gli1* 表达）是正确的。关于前部标记物 *Alx4* 对称性抑制的补充细节也是正确的，并进一步加强了分析。\n-   对中继模型的预测（受限的 *Ptch1*/*Gli1* 表达域，以及更宽阔、不断扩展的 *Gremlin1*/*Hoxd13* 表达域）准确地抓住了模型之间的核心区别。\n因此，该选项在科学上是合理的，逻辑上是一致的。**正确**。\n\n**B. 预测出现前后轴序列为 $2$-$3$-$4$-$4$-$3$-$2$ 的镜像重复。为区分这两种机制，追踪 AER 中 *Fgf8* 的扩展，并预期如果梯度机制起作用，*Ptch1* 会在整个间充质中均匀表达；如果中继机制起作用，*Ptch1* 应在前部缺失。**\n\n这个选项因多个原因而不正确。\n-   预测的指骨模式 $2$-$3$-$4$-$4$-$3$-$2$ 是颠倒的。极点处的高 *Shh* 浓度指定后部指骨（指骨 $4$），而不是前部指骨（指骨 $2$）。\n-   实验逻辑有缺陷。“梯度”不会产生“均匀”的 *Ptch1* 表达；根据定义，梯度产生的是分级的、非均匀的响应。\n-   对中继模型的预测也是不正确的。在前部 *Shh* 珠子附近会有一个 *Ptch1* 的表达域，而不是完全缺失。\n因此，这个选项存在根本性缺陷。**错误**。\n\n**C. 预测出现前后轴序列为 $4$-$3$-$2$-$2$-$3$-$4$ 的镜像重复。为区分这两种机制，仅将 *Hoxd13* 作为 *Shh* 梯度的直接读出进行量化；梯度应产生一个均匀的 *Hoxd13* 平台，而中继应产生一个斑块状的 *Hoxd13* 表达域。**\n\n这个选项不正确。\n-   虽然预测的指骨模式 $4$-$3$-$2$-$2$-$3$-$4$ 是正确的，但实验策略基于一个错误的前提。问题陈述明确将 *Hoxd13* 定义为一个*间接*靶标。因此，它不能用作“*Shh* 梯度的直接读出”。\n-   关于梯度产生“均匀平台”的预测是对形态发生素梯度如何运作的误解；它们产生的是分级响应。\n-   将中继结果描述为“斑块状表达域”是模糊的，并不是最显著的特征。关键特征是直接和间接靶基因表达域在时空上的不匹配。\n因此，提出的实验是无效的。**错误**。\n\n**D. 预测出现无序、无镜像对称的多指畸形。为区分这两种机制，检测 *Tbx5* 与 *Tbx4* 的表达；梯度应将前部的 *Tbx5* 转换为 *Tbx4*，而中继机制不应改变 *Tbx5*/*Tbx4* 的表达。**\n\n这个选项不正确。\n-   预测“无序多指畸形”是错误的。ZPA/*Shh* 移植以产生高度有序的镜像对称模式而闻名。\n-   提出的实验检测了错误的生物学过程。*Tbx5* 和 *Tbx4* 是前肢与后肢身份的标记物，而不是一个肢体内指骨的前后轴标记物。在翼芽中异位表达 *Shh* 会重塑 AP 轴；它不会将翅膀转变为腿。\n因此，这个选项与AP模式建成的问题无关。**错误**。\n\n基于全面的分析，选项 A 是唯一一个根据所提供的分子事实，正确预测了表型并提出了一个有效的、论证充分的实验策略来区分两种理论模型的选项。", "answer": "$$\\boxed{A}$$", "id": "2569623"}, {"introduction": "进化上的新颖性常常源于对保守发育过程在时间或速率上的微小改变。这项实践要求你建立一个简单而强大的数学模型，来量化肢体发育中异时性的影响。通过将指间细胞凋亡建模为一个指数衰减过程，你将推导出一个解析表达式，阐明延迟细胞死亡如何影响最终形态，从而清晰地连接发育参数的改变及其进化后果。[@problem_id:2569545]", "problem": "在脊椎动物的肢体发育中，指间间充质通过由骨形态发生蛋白（BMP）信号通路驱动的程序性细胞死亡而被清除，这一过程可以建模为存活细胞数量的一阶衰变。令 $t$ 表示自细胞凋亡开始后经过的时间，存活细胞数量由指数衰变公式 $N(t)=N_0 \\exp(-\\kappa t)$ 给出，其中 $N_0$ 是细胞凋亡开始瞬间的存活细胞数量，$\\kappa$ 是一个恒定速率参数。假设在固定的发育终点 $T$，由于细胞密度和厚度近似均匀，预测的指间蹼面积与此时的存活细胞数量成正比，因此 $A(T)=\\alpha N(t)$，其中 $\\alpha$ 为某个比例常数，$t$ 为自凋亡开始后经过的时间。基线条件下的细胞凋亡在肢芽起始后的 $t_0$ 时刻开始，发育终点满足 $T>t_0$。考虑一个将细胞凋亡起始时间延迟 $1.10$ 倍的扰动，因此扰动后的起始时间为 $t_0^{\\prime}=1.10\\,t_0$，速率常数 $\\kappa$ 和终点 $T$ 保持不变，且满足 $T>t_0^{\\prime}$。仅使用这些假设和指数衰变模型，推导在延迟起始条件下与基线条件下，在 $T$ 时刻预测的蹼面积之比 $A^{\\prime}(T)/A(T)$ 的闭式解析表达式，该表达式应以 $\\kappa$ 和 $t_0$ 表示。请以单个闭式解析表达式的形式给出最终答案。最终表达式无需四舍五入，也无需单位。", "solution": "问题陈述提出了一个关于指间间充质细胞凋亡的量化模型，并要求推导在两种不同条件下结果的比率。首先，需要对该问题进行批判性验证。\n\n已知条件如下：\n1.  存活细胞数量 $N(t)$ 服从一阶衰变模型：$N(t)=N_0 \\exp(-\\kappa t)$，其中 $t$ 是自细胞凋亡开始后经过的时间。\n2.  $N_0$ 是细胞凋亡开始时的初始存活细胞数量。\n3.  $\\kappa$ 是一个恒定速率参数。\n4.  在发育终点 $T$ 预测的蹼面积，记为 $A(T)$，与存活细胞数量成正比：$A(T)=\\alpha N(t)$，其中 $\\alpha$ 是比例常数，$t$ 是经过的时间。\n5.  基线条件：细胞凋亡在起始时间 $t_0$ 开始。终点 $T$ 满足 $T > t_0$。\n6.  扰动条件：细胞凋亡起始被延迟，新的起始时间为 $t_0^{\\prime}=1.10\\,t_0$。速率常数 $\\kappa$ 和终点 $T$ 保持不变。新的条件 $T > t_0^{\\prime}$ 成立。\n7.  目标是求出扰动后的面积与基线面积之比 $\\frac{A^{\\prime}(T)}{A(T)}$，并用 $\\kappa$ 和 $t_0$ 表示。\n\n该问题具有科学依据，使用了标准的指数衰变模型来描述一个生物过程。问题提法恰当，提供了所有必要信息和明确的目标。其语言客观，参数一致。略有歧义的符号表示 $A(T)=\\alpha N(t)$ 由上下文澄清，它规定了经过时间 $t$ 必须相对于相关的起始时间和共同的终点 $T$ 来计算。因此，该问题被认为是有效的，可以推导出解。\n\n让我们定义一个绝对时间尺度，用 $\\tau$ 表示，从一个任意的原点（如肢芽起始）开始。\n基线条件下的细胞凋亡起始于 $\\tau = t_0$。\n扰动条件下的细胞凋亡起始于 $\\tau = t_0^{\\prime} = 1.10 t_0$。\n该过程在一个单一、固定的发育终点 $\\tau = T$ 进行评估。\n\n对于基线条件，细胞凋亡的持续时间，即从起始到终点 $T$ 的经过时间，由 $\\Delta t_{base} = T - t_0$ 给出。\n在 $T$ 时刻的存活细胞数量可以通过将这段经过时间代入衰变模型来确定：\n$$N_{base}(T) = N_0 \\exp(-\\kappa(T - t_0))$$\n预测的蹼面积与此细胞数量成正比：\n$$A(T) = \\alpha N_{base}(T) = \\alpha N_0 \\exp(-\\kappa(T - t_0))$$\n\n对于扰动条件，细胞凋亡的起始延迟到 $t_0^{\\prime}$。到同一终点 $T$ 为止的细胞凋亡持续时间现在是 $\\Delta t_{pert} = T - t_0^{\\prime} = T - 1.10 t_0$。\n在此扰动下，$T$ 时刻的存活细胞数量为：\n$$N_{pert}(T) = N_0 \\exp(-\\kappa(T - 1.10 t_0))$$\n相应的蹼面积为：\n$$A^{\\prime}(T) = \\alpha N_{pert}(T) = \\alpha N_0 \\exp(-\\kappa(T - 1.10 t_0))$$\n\n问题要求计算比率 $\\frac{A^{\\prime}(T)}{A(T)}$。我们使用上面推导的表达式构建此比率：\n$$\\frac{A^{\\prime}(T)}{A(T)} = \\frac{\\alpha N_0 \\exp(-\\kappa(T - 1.10 t_0))}{\\alpha N_0 \\exp(-\\kappa(T - t_0))}$$\n比例常数 $\\alpha$ 和初始细胞数量 $N_0$ 在分子和分母中是共同的，因此可以消掉：\n$$\\frac{A^{\\prime}(T)}{A(T)} = \\frac{\\exp(-\\kappa(T - 1.10 t_0))}{\\exp(-\\kappa(T - t_0))}$$\n利用指数的性质 $\\frac{\\exp(a)}{\\exp(b)} = \\exp(a-b)$，我们可以简化表达式：\n$$\\frac{A^{\\prime}(T)}{A(T)} = \\exp\\left( (-\\kappa(T - 1.10 t_0)) - (-\\kappa(T - t_0)) \\right)$$\n将指数内的项展开：\n$$\\frac{A^{\\prime}(T)}{A(T)} = \\exp\\left( -\\kappa T + 1.10 \\kappa t_0 + \\kappa T - \\kappa t_0 \\right)$$\n涉及终点 $T$ 的项，具体是 $-\\kappa T$ 和 $+\\kappa T$，相互抵消。这表明该比率与具体终点 $T$ 无关，只要 $T$ 大于两个起始时间。表达式简化为：\n$$\\frac{A^{\\prime}(T)}{A(T)} = \\exp\\left( 1.10 \\kappa t_0 - \\kappa t_0 \\right)$$\n将项 $\\kappa t_0$ 提取出来：\n$$\\frac{A^{\\prime}(T)}{A(T)} = \\exp\\left( (1.10 - 1) \\kappa t_0 \\right)$$\n这就得出了该比率的最终闭式解析表达式：\n$$\\frac{A^{\\prime}(T)}{A(T)} = \\exp(0.10 \\kappa t_0)$$\n这个结果在物理上是合理的。延迟细胞凋亡的起始会减少细胞死亡的可用时间，导致存活细胞数量增加，从而使得蹼面积更大。由于 $\\kappa > 0$ 且 $t_0 > 0$，指数 $0.10 \\kappa t_0$ 为正，使得比率大于 $1$，这与物理上的推理一致。", "answer": "$$\\boxed{\\exp(0.10 \\kappa t_0)}$$", "id": "2569545"}, {"introduction": "现代演化发育生物学在很大程度上依赖于比较物种间的大规模基因组数据集，以揭示形态变化的分子基础。这项计算实践让你沉浸在一个真实的生物信息学工作流程中，使用来自蝙蝠和老鼠远端肢（手/足部）的合成单细胞RNA测序数据。你将实施一个分析流程来鉴定差异表达基因，定义保守的和物种特异的基因模块，并用统计学方法检验其功能富集的显著性，这完全模拟了研究如蝙蝠翅膀等特化肢体演化的真实方法。[@problem_id:2569639]", "problem": "给定来自蝙蝠和小鼠的肢端细胞的简化、合成的单细胞信使核糖核酸 (mRNA) 丰度摘要，这些细胞被分为远端组与近端组。从基于原则的视角出发，以分子生物学中心法则（DNA到RNA到蛋白质）以及“不同解剖区域间的mRNA丰度差异可以反映差异性基因活性”这一经验性观察为基础，将与指/趾伸长相关的程序建模为远端上调模块。您必须为每个物种使用以2为底的倍数变化对数来计算远端偏向性，选择排名靠前的基因构成一个模块，将跨物种的交集推导为保守模块，将蝙蝠特有的集合差集推导为特异性模块，然后使用单侧超几何检验（无放回抽样）评估这些模块在给定基因集中的富集的统计显著性。使用一个小的正伪计数以避免除以零。\n\n使用的核心定义和假设：\n- 对于每个物种 $s$ 和基因 $g$，将远端偏向性定义为以2为底的倍数变化对数 $L_{s}(g) = \\log_{2}\\left(\\dfrac{\\mu_{\\text{distal},s}(g) + \\epsilon}{\\mu_{\\text{proximal},s}(g) + \\epsilon}\\right)$，其中 $\\mu_{\\text{distal},s}(g)$ 和 $\\mu_{\\text{proximal},s}(g)$ 分别是远端和近端细胞组的平均mRNA丰度，而 $\\epsilon$ 是一个小的正伪计数。\n- 选择具有最大正值 $L_{s}(g)$ 的前 $k$ 个基因，为物种 $s$ 形成远端上调模块 $M_{s}$。\n- 将保守模块定义为 $M_{\\text{cons}} = M_{\\text{bat}} \\cap M_{\\text{mouse}}$，并将蝙蝠特异性模块定义为 $M_{\\text{div,bat}} = M_{\\text{bat}} \\setminus M_{\\text{mouse}}$。\n- 基因集富集使用超几何分布进行评估：给定一个大小为 $N = |U|$ 的全集 $U$，一个大小为 $K = |G|$ 的基因集 $G \\subseteq U$，一个大小为 $n = |M|$ 的模块 $M \\subseteq U$，以及一个观测到的重叠大小 $x = |M \\cap G|$，计算单侧 $p$ 值 $p = \\Pr[X \\ge x]$，其中 $X \\sim \\text{Hypergeometric}(N, K, n)$。使用生存函数以避免下溢。当 $n = 0$ 时，报告 $p = 1$。\n\n所有测试用例中固定的参数：\n- 伪计数 $\\epsilon = 10^{-3}$。\n- 显著性阈值 $\\alpha = 0.05$。\n- 所有对数均以2为底。\n- 将所有 $p$ 值作为浮点数报告，并四舍五入到六位小数。\n\n您的程序必须为以下测试套件实现上述过程。在每种情况下，使用提供的基因顺序来对齐向量。\n\n测试用例 1（具有明确保守性的理想路径）：\n- 全集 $U_{1}$ 顺序：[SHH, FGF8, BMP2, SOX9, COL2A1, HOXD13, IGF1, GREM1, GLI3, RUNX2, PTCH1, IHH]。\n- 蝙蝠近端平均值 $\\mu_{\\text{prox},\\text{bat},1}$：[$2$, $1$, $4$, $5$, $6$, $0.5$, $1$, $0.5$, $2$, $3$, $4$, $2$]。\n- 蝙蝠远端平均值 $\\mu_{\\text{dist},\\text{bat},1}$：[$12$, $10$, $3$, $4$, $5$, $8$, $7$, $6$, $3$, $2$, $4.5$, $1.8$]。\n- 小鼠近端平均值 $\\mu_{\\text{prox},\\text{mouse},1}$：[$2$, $1$, $4$, $5$, $6$, $0.5$, $0.8$, $0.5$, $1$, $3$, $4$, $2$]。\n- 小鼠远端平均值 $\\mu_{\\text{dist},\\text{mouse},1}$：[$11$, $9$, $3$, $4$, $5$, $7$, $6$, $1.5$, $5$, $2$, $4.3$, $1.9$]。\n- 顶部选择大小 $k_{1} = 5$。\n- 伸长基因集 $G_{\\text{elong},1} = \\{\\text{FGF8}, \\text{HOXD13}, \\text{IGF1}, \\text{GREM1}, \\text{SHH}\\}$。\n- 比较基因集 $G_{\\text{comp},1} = \\{\\text{SOX9}, \\text{COL2A1}, \\text{RUNX2}, \\text{IHH}\\}$。\n- 任务：计算 $M_{\\text{cons}}$ 在 $G_{\\text{elong},1}$ 中富集的 $p$ 值，以及 $M_{\\text{div,bat}}$ 在 $G_{\\text{comp},1}$ 中富集的 $p$ 值。\n\n测试用例 2（无重叠和空特异性集合的边界情况）：\n- 全集 $U_{2}$ 顺序：[SHH, FGF8, BMP2, SOX9, COL2A1, HOXD13, IGF1, GREM1, GLI3, RUNX2, PTCH1, IHH]。\n- 蝙蝠近端平均值 $\\mu_{\\text{prox},\\text{bat},2}$：[$4$, $3$, $3$, $2$, $2$, $2$, $3$, $2$, $2$, $1$, $3$, $1$]。\n- 蝙蝠远端平均值 $\\mu_{\\text{dist},\\text{bat},2}$：[$3.5$, $2.4$, $10$, $8$, $9$, $1.3$, $2.5$, $1.5$, $2.2$, $6$, $3.3$, $5$]。\n- 小鼠近端平均值 $\\mu_{\\text{prox},\\text{mouse},2}$：[$4$, $3$, $3$, $2$, $2$, $2$, $3$, $2$, $2$, $1$, $3$, $1$]。\n- 小鼠远端平均值 $\\mu_{\\text{dist},\\text{mouse},2}$：[$3.5$, $2.4$, $11$, $9$, $8.5$, $1.3$, $2.2$, $1.7$, $2.2$, $6.2$, $3.3$, $5.3$]。\n- 顶部选择大小 $k_{2} = 5$。\n- 伸长基因集 $G_{\\text{elong},2} = \\{\\text{FGF8}, \\text{HOXD13}, \\text{IGF1}, \\text{GREM1}, \\text{SHH}\\}$。\n- 比较基因集 $G_{\\text{comp},2} = \\{\\text{SOX9}, \\text{COL2A1}, \\text{RUNX2}, \\text{IHH}\\}$。\n- 任务：计算 $M_{\\text{cons}}$ 在 $G_{\\text{elong},2}$ 中富集的 $p$ 值，以及 $M_{\\text{div,bat}}$ 在 $G_{\\text{comp},2}$ 中富集的 $p$ 值。\n\n测试用例 3（小全集中的最大保守性边缘情况）：\n- 全集 $U_{3}$ 顺序：[FGF8, HOXD13, IGF1, GREM1, SHH, GLI3, BMP2]。\n- 蝙蝠近端平均值 $\\mu_{\\text{prox},\\text{bat},3}$：[$1$, $0.5$, $1$, $0.5$, $2$, $2$, $3$]。\n- 蝙蝠远端平均值 $\\mu_{\\text{dist},\\text{bat},3}$：[$8$, $7$, $6$, $5$, $2.5$, $1.8$, $2.5$]。\n- 小鼠近端平均值 $\\mu_{\\text{prox},\\text{mouse},3}$：[$1$, $0.5$, $1$, $0.5$, $2$, $2$, $3$]。\n- 小鼠远端平均值 $\\mu_{\\text{dist},\\text{mouse},3}$：[$8$, $7$, $6$, $5$, $2.3$, $1.9$, $2.6$]。\n- 顶部选择大小 $k_{3} = 4$。\n- 伸长基因集 $G_{\\text{elong},3} = \\{\\text{FGF8}, \\text{HOXD13}, \\text{IGF1}, \\text{GREM1}\\}$。\n- 比较基因集 $G_{\\text{comp},3} = \\{\\text{BMP2}, \\text{GLI3}\\}$。\n- 任务：计算 $M_{\\text{cons}}$ 在 $G_{\\text{elong},3}$ 中富集的 $p$ 值，以及 $M_{\\text{div,bat}}$ 在 $G_{\\text{comp},3}$ 中富集的 $p$ 值。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。每个测试用例贡献一个按顺序 [$p_{\\text{cons}}$, $p_{\\text{div,bat}}$] 排列的双元素列表，每个 $p$ 值都四舍五入到六位小数。例如，输出应类似于 [[p11,p12],[p21,p22],[p31,p32]]，其中每个 $p$ 显示为六位小数，并且没有多余的空格。", "solution": "问题已经过严格验证。\n\n步骤 1：提取已知信息\n该问题为三个测试用例提供了以下定义、参数和数据集。\n\n核心定义：\n- 远端偏向性：$L_{s}(g) = \\log_{2}\\left(\\dfrac{\\mu_{\\text{distal},s}(g) + \\epsilon}{\\mu_{\\text{proximal},s}(g) + \\epsilon}\\right)$，适用于物种 $s$ 和基因 $g$。\n- 远端上调模块：$M_{s}$ 是具有最大正远端偏向性 $L_{s}(g)$ 的前 $k$ 个基因的集合。\n- 保守模块：$M_{\\text{cons}} = M_{\\text{bat}} \\cap M_{\\text{mouse}}$。\n- 蝙蝠特异性模块：$M_{\\text{div,bat}} = M_{\\text{bat}} \\setminus M_{\\text{mouse}}$。\n- 超几何 $p$ 值：来自超几何分布 $X \\sim \\text{Hypergeometric}(N, K, n)$ 的单侧概率 $\\Pr[X \\ge x]$，其中 $N$ 是全集大小，$K$ 是基因集大小，$n$ 是模块大小，$x$ 是重叠大小。给定一个特殊情况：如果 $n=0$，则 $p=1$。\n\n固定参数：\n- 伪计数 $\\epsilon = 10^{-3}$。\n- 显著性阈值 $\\alpha = 0.05$。\n- 对数底为 $2$。\n- 所有 $p$ 值都需四舍五入到六位小数。\n\n测试用例 1：\n- 全集 $U_1$：[SHH, FGF8, BMP2, SOX9, COL2A1, HOXD13, IGF1, GREM1, GLI3, RUNX2, PTCH1, IHH]。\n- 蝙蝠近端平均值 $\\mu_{\\text{prox},\\text{bat},1}$：[$2$, $1$, $4$, $5$, $6$, $0.5$, $1$, $0.5$, $2$, $3$, $4$, $2$]。\n- 蝙蝠远端平均值 $\\mu_{\\text{dist},\\text{bat},1}$：[$12$, $10$, $3$, $4$, $5$, $8$, $7$, $6$, $3$, $2$, $4.5$, $1.8$]。\n- 小鼠近端平均值 $\\mu_{\\text{prox},\\text{mouse},1}$：[$2$, $1$, $4$, $5$, $6$, $0.5$, $0.8$, $0.5$, $1$, $3$, $4$, $2$]。\n- 小鼠远端平均值 $\\mu_{\\text{dist},\\text{mouse},1}$：[$11$, $9$, $3$, $4$, $5$, $7$, $6$, $1.5$, $5$, $2$, $4.3$, $1.9$]。\n- 顶部选择大小 $k_1 = 5$。\n- 基因集：$G_{\\text{elong},1} = \\{\\text{FGF8}, \\text{HOXD13}, \\text{IGF1}, \\text{GREM1}, \\text{SHH}\\}$，$G_{\\text{comp},1} = \\{\\text{SOX9}, \\text{COL2A1}, \\text{RUNX2}, \\text{IHH}\\}$。\n- 任务：计算 $M_{\\text{cons}}$ 在 $G_{\\text{elong},1}$ 中以及 $M_{\\text{div,bat}}$ 在 $G_{\\text{comp},1}$ 中的富集 $p$ 值。\n\n测试用例 2：\n- 全集 $U_2$：[SHH, FGF8, BMP2, SOX9, COL2A1, HOXD13, IGF1, GREM1, GLI3, RUNX2, PTCH1, IHH]。\n- 蝙蝠近端平均值 $\\mu_{\\text{prox},\\text{bat},2}$：[$4$, $3$, $3$, $2$, $2$, $2$, $3$, $2$, $2$, $1$, $3$, $1$]。\n- 蝙蝠远端平均值 $\\mu_{\\text{dist},\\text{bat},2}$：[$3.5$, $2.4$, $10$, $8$, $9$, $1.3$, $2.5$, $1.5$, $2.2$, $6$, $3.3$, $5$]。\n- 小鼠近端平均值 $\\mu_{\\text{prox},\\text{mouse},2}$：[$4$, $3$, $3$, $2$, $2$, $2$, $3$, $2$, $2$, $1$, $3$, $1$]。\n- 小鼠远端平均值 $\\mu_{\\text{dist},\\text{mouse},2}$：[$3.5$, $2.4$, $11$, $9$, $8.5$, $1.3$, $2.2$, $1.7$, $2.2$, $6.2$, $3.3$, $5.3$]。\n- 顶部选择大小 $k_2 = 5$。\n- 基因集：$G_{\\text{elong},2} = \\{\\text{FGF8}, \\text{HOXD13}, \\text{IGF1}, \\text{GREM1}, \\text{SHH}\\}$，$G_{\\text{comp},2} = \\{\\text{SOX9}, \\text{COL2A1}, \\text{RUNX2}, \\text{IHH}\\}$。\n- 任务：计算 $M_{\\text{cons}}$ 在 $G_{\\text{elong},2}$ 中以及 $M_{\\text{div,bat}}$ 在 $G_{\\text{comp},2}$ 中的富集 $p$ 值。\n\n测试用例 3：\n- 全集 $U_3$：[FGF8, HOXD13, IGF1, GREM1, SHH, GLI3, BMP2]。\n- 蝙蝠近端平均值 $\\mu_{\\text{prox},\\text{bat},3}$：[$1$, $0.5$, $1$, $0.5$, $2$, $2$, $3$]。\n- 蝙蝠远端平均值 $\\mu_{\\text{dist},\\text{bat},3}$：[$8$, $7$, $6$, $5$, $2.5$, $1.8$, $2.5$]。\n- 小鼠近端平均值 $\\mu_{\\text{prox},\\text{mouse},3}$：[$1$, $0.5$, $1$, $0.5$, $2$, $2$, $3$]。\n- 小鼠远端平均值 $\\mu_{\\text{dist},\\text{mouse},3}$：[$8$, $7$, $6$, $5$, $2.3$, $1.9$, $2.6$]。\n- 顶部选择大小 $k_3 = 4$。\n- 基因集：$G_{\\text{elong},3} = \\{\\text{FGF8}, \\text{HOXD13}, \\text{IGF1}, \\text{GREM1}\\}$，$G_{\\text{comp},3} = \\{\\text{BMP2}, \\text{GLI3}\\}$。\n- 任务：计算 $M_{\\text{cons}}$ 在 $G_{\\text{elong},3}$ 中以及 $M_{\\text{div,bat}}$ 在 $G_{\\text{comp},3}$ 中的富集 $p$ 值。\n\n步骤 2：使用提取的已知信息进行验证\n根据指定标准对问题进行评估：\n- **科学合理且客观**：该问题是一个简化但标准的生物信息学工作流程。用于差异表达的倍数变化对数（log fold-change）、模块定义以及用于基因集富集分析的超几何检验等概念，是基因组学和分子生物学中的基础且广泛应用的方法。该问题基于客观的、定量的程序。\n- **格式良好**：该问题被构建为一个精确的算法。所有必要的数据、参数和定义均已提供。指令明确，确保可以计算出唯一且稳定的解。边缘情况，如除以零（通过伪计数 $\\epsilon$ 解决）和空模块（通过规则 $p=1$ 当 $n=0$ 时解决），都得到了明确处理。\n- **完整性和一致性**：该问题是自洽的。每个测试用例的数据集都是完整的，没有内部矛盾。\n\n步骤 3：结论与行动\n该问题在科学上是合理的、格式良好且完整的。因此，它是**有效的**。将提供一个解决方案。\n\n一般流程是为每个测试用例执行已定义的计算流程。这包括：\n1. 对于每个物种（蝙蝠和小鼠），计算给定全集中所有基因的远端偏向性 $L_s(g)$。\n2. 筛选出具有正 $L_s(g)$ 的基因，按降序排序，并选择前 $k$ 个基因以形成物种特异性模块 $M_{\\text{bat}}$ 和 $M_{\\text{mouse}}$。\n3. 分别使用集合交集和差集推导出保守模块 $M_{\\text{cons}}$ 和特异性模块 $M_{\\text{div,bat}}$。\n4. 对于每个要求的富集检验，使用单侧超几何检验的生存函数计算相应的 $p$ 值。\n\n超几何检验的参数是：\n- $N$：全集 $U$ 中的基因总数。\n- $K$：目标基因集 $G$ 中的基因数量（总体中的“成功”数）。\n- $n$：待测模块 $M$ 中的基因数量（“抽样”数）。\n- $x$：模块和基因集交集中的基因数量，$x = |M \\cap G|$（“观测到的成功”数）。\n\n$p$ 值为 $p = \\Pr[X \\ge x]$，计算为随机变量 $X \\sim \\text{Hypergeometric}(N, K, n)$ 的超几何分布的生存函数。这等同于将概率 $\\Pr[X=i]$ 从 $i=x$ 到 $\\min(n, K)$ 求和。\n\n现在，我们将此流程应用于每个测试用例。\n\n测试用例 1：\n- 全集大小 $N_1 = 12$，选择大小 $k_1 = 5$，伪计数 $\\epsilon = 0.001$。\n- 蝙蝠模块 $M_{\\text{bat},1}$：我们为所有基因计算 $L_{\\text{bat},1}(g)$。具有正偏向性的前5个基因是：$\\{\\text{HOXD13}, \\text{GREM1}, \\text{FGF8}, \\text{IGF1}, \\text{SHH}\\}$。\n- 小鼠模块 $M_{\\text{mouse},1}$：我们为所有基因计算 $L_{\\text{mouse},1}(g)$。具有正偏向性的前5个基因是：$\\{\\text{HOXD13}, \\text{FGF8}, \\text{IGF1}, \\text{SHH}, \\text{GLI3}\\}$。\n- 保守模块 $M_{\\text{cons},1} = M_{\\text{bat},1} \\cap M_{\\text{mouse},1} = \\{\\text{SHH}, \\text{FGF8}, \\text{HOXD13}, \\text{IGF1}\\}$。\n- 特异性模块 $M_{\\text{div,bat},1} = M_{\\text{bat},1} \\setminus M_{\\text{mouse},1} = \\{\\text{GREM1}\\}$。\n- $M_{\\text{cons},1}$ 相对于 $G_{\\text{elong},1}$ 的P值：\n  - $N_1 = 12$。$K_1 = |G_{\\text{elong},1}| = 5$。$n_1 = |M_{\\text{cons},1}| = 4$。\n  - 重叠 $x_1 = |M_{\\text{cons},1} \\cap G_{\\text{elong},1}| = |\\{\\text{SHH, FGF8, HOXD13, IGF1}\\}| = 4$。\n  - $p_{\\text{cons},1} = \\Pr[X \\ge 4]$ 对于 $X \\sim \\text{Hypergeometric}(12, 5, 4)$。$p = \\frac{\\binom{5}{4}\\binom{7}{0}}{\\binom{12}{4}} = \\frac{5}{495} \\approx 0.010101$。\n- $M_{\\text{div,bat},1}$ 相对于 $G_{\\text{comp},1}$ 的P值：\n  - $N_1 = 12$。$K_2 = |G_{\\text{comp},1}| = 4$。$n_2 = |M_{\\text{div,bat},1}| = 1$。\n  - 重叠 $x_2 = |M_{\\text{div,bat},1} \\cap G_{\\text{comp},1}| = |\\{\\text{GREM1}\\} \\cap \\{\\text{SOX9}, \\text{COL2A1}, \\text{RUNX2}, \\text{IHH}\\}| = 0$。\n  - $p_{\\text{div},1} = \\Pr[X \\ge 0]$ 对于 $X \\sim \\text{Hypergeometric}(12, 4, 1)$。这个概率必然为 $1$。\n\n测试用例 2：\n- 全集大小 $N_2 = 12$，选择大小 $k_2 = 5$，伪计数 $\\epsilon = 0.001$。\n- 蝙蝠模块 $M_{\\text{bat},2}$：具有正偏向性的前5个基因是 $\\{\\text{RUNX2}, \\text{IHH}, \\text{COL2A1}, \\text{SOX9}, \\text{BMP2}\\}$。\n- 小鼠模块 $M_{\\text{mouse},2}$：具有正偏向性的前5个基因是 $\\{\\text{RUNX2}, \\text{IHH}, \\text{SOX9}, \\text{COL2A1}, \\text{BMP2}\\}$。\n- 保守模块 $M_{\\text{cons},2} = M_{\\text{bat},2} \\cap M_{\\text{mouse},2} = \\{\\text{RUNX2}, \\text{IHH}, \\text{COL2A1}, \\text{SOX9}, \\text{BMP2}\\}$。\n- 特异性模块 $M_{\\text{div,bat},2} = M_{\\text{bat},2} \\setminus M_{\\text{mouse},2} = \\emptyset$。\n- $M_{\\text{cons},2}$ 相对于 $G_{\\text{elong},2}$ 的P值：\n  - $N_2 = 12$。$K_1 = |G_{\\text{elong},2}| = 5$。$n_1 = |M_{\\text{cons},2}| = 5$。\n  - 重叠 $x_1 = |M_{\\text{cons},2} \\cap G_{\\text{elong},2}| = 0$。\n  - $p_{\\text{cons},2} = \\Pr[X \\ge 0]$ 对于 $X \\sim \\text{Hypergeometric}(12, 5, 5)$。这个概率是 $1$。\n- $M_{\\text{div,bat},2}$ 相对于 $G_{\\text{comp},2}$ 的P值：\n  - $n_2 = |M_{\\text{div,bat},2}| = 0$。根据问题定义，如果模块大小为 $0$，则 $p$ 值为 $1$。\n\n测试用例 3：\n- 全集大小 $N_3 = 7$，选择大小 $k_3 = 4$，伪计数 $\\epsilon = 0.001$。\n- 蝙蝠模块 $M_{\\text{bat},3}$：具有正偏向性的前4个基因是 $\\{\\text{HOXD13}, \\text{GREM1}, \\text{FGF8}, \\text{IGF1}\\}$。\n- 小鼠模块 $M_{\\text{mouse},3}$：具有正偏向性的前4个基因是 $\\{\\text{HOXD13}, \\text{GREM1}, \\text{FGF8}, \\text{IGF1}\\}$。\n- 保守模块 $M_{\\text{cons},3} = M_{\\text{bat},3} \\cap M_{\\text{mouse},3} = \\{\\text{HOXD13}, \\text{GREM1}, \\text{FGF8}, \\text{IGF1}\\}$。\n- 特异性模块 $M_{\\text{div,bat},3} = M_{\\text{bat},3} \\setminus M_{\\text{mouse},3} = \\emptyset$。\n- $M_{\\text{cons},3}$ 相对于 $G_{\\text{elong},3}$ 的P值：\n  - $N_3 = 7$。$K_1 = |G_{\\text{elong},3}| = 4$。$n_1 = |M_{\\text{cons},3}| = 4$。\n  - 重叠 $x_1 = |M_{\\text{cons},3} \\cap G_{\\text{elong},3}| = 4$。\n  - $p_{\\text{cons},3} = \\Pr[X \\ge 4]$ 对于 $X \\sim \\text{Hypergeometric}(7, 4, 4)$。$p = \\frac{\\binom{4}{4}\\binom{3}{0}}{\\binom{7}{4}} = \\frac{1}{35} \\approx 0.028571$。\n- $M_{\\text{div,bat},3}$ 相对于 $G_{\\text{comp},3}$ 的P值：\n  - $n_2 = |M_{\\text{div,bat},3}| = 0$。$p$ 值为 $1$。\n\n计算结果摘要：\n- 测试用例 1：$p_{\\text{cons}} \\approx 0.010101$，$p_{\\text{div,bat}} = 1.000000$。\n- 测试用例 2：$p_{\\text{cons}} = 1.000000$，$p_{\\text{div,bat}} = 1.000000$。\n- 测试用例 3：$p_{\\text{cons}} \\approx 0.028571$，$p_{\\text{div,bat}} = 1.000000$。\n这些结果将按最终答案的要求格式化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import hypergeom\n\ndef solve():\n    \"\"\"\n    Solves the bioinformatics problem for a suite of test cases.\n    \"\"\"\n    \n    # Define the fixed parameters for all test cases.\n    epsilon = 1e-3\n\n    test_cases = [\n        {\n            \"U\": ['SHH', 'FGF8', 'BMP2', 'SOX9', 'COL2A1', 'HOXD13', 'IGF1', 'GREM1', 'GLI3', 'RUNX2', 'PTCH1', 'IHH'],\n            \"mu_prox_bat\": np.array([2, 1, 4, 5, 6, 0.5, 1, 0.5, 2, 3, 4, 2]),\n            \"mu_dist_bat\": np.array([12, 10, 3, 4, 5, 8, 7, 6, 3, 2, 4.5, 1.8]),\n            \"mu_prox_mouse\": np.array([2, 1, 4, 5, 6, 0.5, 0.8, 0.5, 1, 3, 4, 2]),\n            \"mu_dist_mouse\": np.array([11, 9, 3, 4, 5, 7, 6, 1.5, 5, 2, 4.3, 1.9]),\n            \"k\": 5,\n            \"G_elong\": {'FGF8', 'HOXD13', 'IGF1', 'GREM1', 'SHH'},\n            \"G_comp\": {'SOX9', 'COL2A1', 'RUNX2', 'IHH'}\n        },\n        {\n            \"U\": ['SHH', 'FGF8', 'BMP2', 'SOX9', 'COL2A1', 'HOXD13', 'IGF1', 'GREM1', 'GLI3', 'RUNX2', 'PTCH1', 'IHH'],\n            \"mu_prox_bat\": np.array([4, 3, 3, 2, 2, 2, 3, 2, 2, 1, 3, 1]),\n            \"mu_dist_bat\": np.array([3.5, 2.4, 10, 8, 9, 1.3, 2.5, 1.5, 2.2, 6, 3.3, 5]),\n            \"mu_prox_mouse\": np.array([4, 3, 3, 2, 2, 2, 3, 2, 2, 1, 3, 1]),\n            \"mu_dist_mouse\": np.array([3.5, 2.4, 11, 9, 8.5, 1.3, 2.2, 1.7, 2.2, 6.2, 3.3, 5.3]),\n            \"k\": 5,\n            \"G_elong\": {'FGF8', 'HOXD13', 'IGF1', 'GREM1', 'SHH'},\n            \"G_comp\": {'SOX9', 'COL2A1', 'RUNX2', 'IHH'}\n        },\n        {\n            \"U\": ['FGF8', 'HOXD13', 'IGF1', 'GREM1', 'SHH', 'GLI3', 'BMP2'],\n            \"mu_prox_bat\": np.array([1, 0.5, 1, 0.5, 2, 2, 3]),\n            \"mu_dist_bat\": np.array([8, 7, 6, 5, 2.5, 1.8, 2.5]),\n            \"mu_prox_mouse\": np.array([1, 0.5, 1, 0.5, 2, 2, 3]),\n            \"mu_dist_mouse\": np.array([8, 7, 6, 5, 2.3, 1.9, 2.6]),\n            \"k\": 4,\n            \"G_elong\": {'FGF8', 'HOXD13', 'IGF1', 'GREM1'},\n            \"G_comp\": {'BMP2', 'GLI3'}\n        }\n    ]\n\n    all_results = []\n\n    def get_module(U, mu_prox, mu_dist, k, epsilon):\n        \"\"\"\n        Calculates the distal-upregulated module for a single species.\n        \"\"\"\n        log_fc = np.log2((mu_dist + epsilon) / (mu_prox + epsilon))\n        \n        # Filter for positive log fold-changes\n        positive_indices = np.where(log_fc > 0)[0]\n        \n        if len(positive_indices) == 0:\n            return set()\n            \n        # Get LFCs and corresponding gene names for positive ones\n        positive_lfc = log_fc[positive_indices]\n        positive_genes = np.array(U)[positive_indices]\n        \n        # Sort by LFC descending\n        sorted_indices = np.argsort(positive_lfc)[::-1]\n        \n        # Select top k genes\n        top_k = min(k, len(sorted_indices))\n        module_genes = positive_genes[sorted_indices][:top_k]\n        \n        return set(module_genes)\n\n    def calculate_p_value(M_module, G_geneset, U_universe):\n        \"\"\"\n        Calculates the one-sided hypergeometric p-value for enrichment.\n        \"\"\"\n        N = len(U_universe)\n        K = len(G_geneset)\n        n = len(M_module)\n        \n        # Per problem statement, if module size is 0, p-value is 1.\n        if n == 0:\n            return 1.0\n            \n        x = len(M_module.intersection(G_geneset))\n        \n        # Using the survival function (sf), Pr[X >= x] is sf(x-1).\n        # sf(k, M, n, N) -- k=successes, M=pop size, n=type I objects, N=draws\n        # scipy.stats.hypergeom(M, n, N) where M=total, n=successes in pop, N=draws\n        # so M=N, n=K, N=n from problem notation\n        p_val = hypergeom.sf(x - 1, N, K, n)\n        \n        return p_val\n\n    for case in test_cases:\n        U = case[\"U\"]\n        k = case[\"k\"]\n        \n        # Step 1  2: Get species-specific modules\n        M_bat = get_module(U, case[\"mu_prox_bat\"], case[\"mu_dist_bat\"], k, epsilon)\n        M_mouse = get_module(U, case[\"mu_prox_mouse\"], case[\"mu_dist_mouse\"], k, epsilon)\n        \n        # Step 3: Derive conserved and divergent modules\n        M_cons = M_bat.intersection(M_mouse)\n        M_div_bat = M_bat.difference(M_mouse)\n\n        # Step 4: Perform enrichment analysis\n        p_cons = calculate_p_value(M_cons, case[\"G_elong\"], U)\n        p_div_bat = calculate_p_value(M_div_bat, case[\"G_comp\"], U)\n        \n        all_results.append([p_cons, p_div_bat])\n\n    # Final print statement in the exact required format.\n    # e.g., [[p11,p12],[p21,p22],[p31,p32]] with 6 decimal places.\n    formatted_results = [f\"[{p[0]:.6f},{p[1]:.6f}]\" for p in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2569639"}]}