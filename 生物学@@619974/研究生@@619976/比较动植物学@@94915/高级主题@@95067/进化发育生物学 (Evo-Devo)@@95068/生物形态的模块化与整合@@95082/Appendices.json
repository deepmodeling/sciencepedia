{"hands_on_practices": [{"introduction": "要科学地检验模块化假说，我们首先需要一种量化模块化程度的方法。协方差比率 ($CR$) 提供了一个直观的度量，它直接比较了模块内性状间的平均协方差与模块间性状的平均协方差。[@problem_id:2590340] 这个基础练习将指导你如何从给定的协方差矩阵中计算 $CR$ 值，这是后续更复杂分析的基石。", "problem": "在比较动物学和植物学中，模块性假说提出，同一形态或功能模块内的性状之间的协变要强于它们与其他模块中性状的协变。考虑一个在相关物种的演化支中测量的四性状数据集，其经验性状协方差矩阵总结如下\n$$\nS \\;=\\; \\begin{pmatrix}\n1 & 0.6 & 0.1 & 0.0\\\\\n0.6 & 1 & 0.0 & 0.1\\\\\n0.1 & 0.0 & 1 & 0.7\\\\\n0.0 & 0.1 & 0.7 & 1\n\\end{pmatrix}.\n$$\n假设假定的模块划分为 $\\{1,2\\}$ 与 $\\{3,4\\}$。使用协方差和矩阵分块的核心定义，计算协方差比率 (CR)。CR 定义为模块间协方差均值与模块内协方差均值之比，其中均值仅针对唯一的性状对计算（使用相应分块的上三角非对角线元素；不包括方差）。\n\n然后，基于一个模块划分应得出小于 $1$ 的 $CR$ 值（模块间平均协方差低于模块内平均协方差）这一普遍预期，解释指定的划分是否对给定数据显示出模块性。最终答案仅报告 $CR$ 的数值；以精确形式表示，无需四舍五入或单位。", "solution": "该问题要求计算协方差比率 ($CR$)，其定义为模块间协方差均值与模块内协方差均值之比。所提供的数据包括一个 $4 \\times 4$ 的性状协方差矩阵 $S$，以及一个将四个性状划分为两个模块 $M_1 = \\{1, 2\\}$ 和 $M_2 = \\{3, 4\\}$ 的假定模块划分。\n\n协方差矩阵 $S$ 如下所示：\n$$\nS \\;=\\; \\begin{pmatrix}\n1 & 0.6 & 0.1 & 0.0\\\\\n0.6 & 1 & 0.0 & 0.1\\\\\n0.1 & 0.0 & 1 & 0.7\\\\\n0.0 & 0.1 & 0.7 & 1\n\\end{pmatrix}.\n$$\n$S$ 的对角线元素是方差（本例中归一化为 $1$），非对角线元素 $S_{ij}$ 代表性状 $i$ 和性状 $j$ 之间的协方差。\n\n模块划分 $\\{1, 2\\}$ 与 $\\{3, 4\\}$ 使我们能够将矩阵 $S$ 构造成对应于模块内和模块间协方差的块：\n$$\nS = \\begin{pmatrix} S_{11} & S_{12} \\\\ S_{21} & S_{22} \\end{pmatrix}\n$$\n在这里，$S_{11}$ 是模块 $M_1$ 中性状间协方差的 $2 \\times 2$ 子矩阵，$S_{22}$ 是模块 $M_2$ 的 $2 \\times 2$ 子矩阵，而 $S_{12}$ 是 $M_1$ 和 $M_2$ 中性状间协方差的 $2 \\times 2$ 子矩阵。子矩阵 $S_{21}$ 是 $S_{12}$ 的转置。\n\n从 $S$ 中提取这些块：\n模块 $M_1 = \\{1, 2\\}$ 的模块内协方差块为：\n$$\nS_{11} = \\begin{pmatrix} 1 & 0.6 \\\\ 0.6 & 1 \\end{pmatrix}\n$$\n模块 $M_2 = \\{3, 4\\}$ 的模块内协方差块为：\n$$\nS_{22} = \\begin{pmatrix} 1 & 0.7 \\\\ 0.7 & 1 \\end{pmatrix}\n$$\n模块间协方差块为：\n$$\nS_{12} = \\begin{pmatrix} 0.1 & 0.0 \\\\ 0.0 & 0.1 \\end{pmatrix}\n$$\n\n协方差比率 ($CR$) 定义为：\n$$\nCR = \\frac{\\bar{c}_{_B}}{\\bar{c}_{_W}}\n$$\n其中 $\\bar{c}_{_W}$ 是模块内协方差均值，$\\bar{c}_{_B}$ 是模块间协方差均值。根据规定，均值是针对唯一的非对角线性状对计算的。\n\n首先，我们计算模块内协方差均值 $\\bar{c}_{_W}$。这是块 $S_{11}$ 和 $S_{22}$ 内唯一非对角线协方差的平均值。问题指定使用上三角非对角线元素来计算唯一的性状对。\n从块 $S_{11}$ 中，唯一的非对角线协方差是 $S_{12} = 0.6$。\n从块 $S_{22}$ 中，唯一的非对角线协方差是 $S_{34} = 0.7$。\n总共有两个这样的模块内协方差。均值为：\n$$\n\\bar{c}_{_W} = \\frac{0.6 + 0.7}{2} = \\frac{1.3}{2} = 0.65\n$$\n\n其次，我们计算模块间协方差均值 $\\bar{c}_{_B}$。这是来自不同模块的性状之间所有协方差的平均值。这些是块 $S_{12}$ 的所有元素，代表来自 $M_1$ 的性状和来自 $M_2$ 的性状之间的协方差。\n$S_{12}$ 的元素是 $\\{0.1, 0.0, 0.0, 0.1\\}$。\n共有 $2 \\times 2 = 4$ 个模块间协方差。均值为：\n$$\n\\bar{c}_{_B} = \\frac{0.1 + 0.0 + 0.0 + 0.1}{4} = \\frac{0.2}{4} = 0.05\n$$\n\n最后，我们使用计算出的均值来计算 $CR$：\n$$\nCR = \\frac{\\bar{c}_{_B}}{\\bar{c}_{_W}} = \\frac{0.05}{0.65}\n$$\n为了以精确的分数形式表示该值，我们进行除法运算：\n$$\nCR = \\frac{\\frac{5}{100}}{\\frac{65}{100}} = \\frac{5}{65} = \\frac{1}{13}\n$$\n对于一个有效的模块划分，期望的条件是 $CR < 1$。我们的结果 $CR = \\frac{1}{13}$ 远小于 $1$，这表明模块内的平均协方差是模块间平均协方差的 $13$ 倍。这为假定的模块结构提供了强有力的支持。然而，问题只要求提供 $CR$ 的数值。", "answer": "$$\n\\boxed{\\frac{1}{13}}\n$$", "id": "2590340"}, {"introduction": "计算出模块化指标值只是第一步，更关键的问题是：这个结果在统计上显著吗？置换检验 (permutation test) 为此提供了一个强大的非参数方法，它通过随机重排性状的模块归属来构建零假设下的分布。[@problem_id:2590370] 这个实践将引导你编写代码实现一个完整的置换检验流程，让你从“计算者”转变为“假设检验者”，从而能够严谨地评估你观察到的模块化模式是否仅仅是随机偶然。", "problem": "给定一个在多个样本上测量的定量性状矩阵，以及一个预先指定的性状模块划分。科学目标是检验观察到的划分是否反映了模块化组织，即模块内的性状间协变是否强于模块间的协变。您的推理和实现应基于协方差的核心定义以及原假设下的可交换性。\n\n设 $X \\in \\mathbb{R}^{n \\times p}$ 是一个数据矩阵，其中有 $n$ 个独立的样本（行）和 $p$ 个性状（列）。设 $S \\in \\mathbb{R}^{p \\times p}$ 表示 $X$ 各列的样本协方差矩阵，其元素 $s_{ij}$ 由通常的协方差无偏估计量定义。设预先指定的模块划分为 $\\mathcal{M} = \\{M_1, M_2, \\ldots, M_K\\}$，其中 $M_k \\subset \\{1,2,\\ldots,p\\}$ 是不相交的非空集合，其并集为 $\\{1,2,\\ldots,p\\}$。\n\n定义一个标量模块化指数，即模块间总协方差与模块内总协方差之比，通过对 $S$ 的非对角线协方差求和计算如下。令\n- 模块内总和为所有满足 $i<j$ 且 $i$ 和 $j$ 同属 $\\mathcal{M}$ 中同一模块的无序性状索引对 $(i,j)$ 的 $s_{ij}$ 之和，\n- 模块间总和为所有满足 $i<j$ 且 $i$ 和 $j$ 属于 $\\mathcal{M}$ 中不同模块的无序对 $(i,j)$ 的 $s_{ij}$ 之和。\n\n令模块化指数为比率 $\\mathrm{R}$，等于模块间总和除以模块内总和。当协方差主要为非负时，较小的 $\\mathrm{R}$ 值表示更强的模块化。\n\n原假设与置换检验。在原假设下，观察到的划分与 $X$ 的协方差结构没有特殊对应关系；特别地，在给定观察到的性状间协方差的情况下，将性状标签分配给模块标签的各种方式，在所有保持模块大小不变的分配中是可交换的。因此，一个有效的置换过程是在所有保持模块大小多重集固定的分配中，均匀随机地置换性状到模块的标签，同时保持 $X$（以及 $S$）不变。这保留了样本内的协方差结构，同时打破了由 $\\mathcal{M}$ 暗示的性状身份与模块身份之间的任何特定关联。\n\n设计并实现一个包含 $B$ 次置换的置换检验，如下所示：\n- 根据 $S$ 和 $\\mathcal{M}$ 计算观察到的 $\\mathrm{R}_{\\mathrm{obs}}$。\n- 对于每次置换 $b \\in \\{1,2,\\ldots,B\\}$，生成一个将 $p$ 个性状索引随机重新分配给 $K$ 个模块标签的方案，使得模块大小 $\\{|M_1|,\\ldots,|M_K|\\}$ 保持不变；根据 $S$ 和置换后的分配计算 $\\mathrm{R}_b$。\n- 计算用于检测模块化的单尾置换 $p$ 值，其公式为 $p_{\\mathrm{perm}} = \\frac{1 + \\#\\{b: \\mathrm{R}_b \\le \\mathrm{R}_{\\mathrm{obs}}\\}}{1 + B}$。\n\n所有计算必须以纯数学术语表示。不涉及角度和物理单位。您的代码必须通过设置指定的伪随机数生成器种子来保证可复现性。\n\n测试套件。实现您的程序以运行以下三个测试用例。在所有情况下，数据矩阵 $X$ 都是通过使用给定的随机种子，从均值向量为 $0$、协方差矩阵为指定 $\\Sigma$ 的 $p$ 元正态分布中独立抽样生成的。观察到的划分以一个由从零开始的性状索引指定的模块列表形式给出。\n\n- 测试用例 A（清晰的模块结构）：\n  - 维度：$n = 200$， $p = 6$。\n  - 划分：$M_1 = \\{0,1,2\\}$， $M_2 = \\{3,4,5\\}$。\n  - 协方差矩阵构建：对所有 $i$，设 $\\Sigma_{ii} = 1$；如果 $i \\neq j$ 且 $i,j \\in M_1$ 或 $i,j \\in M_2$，设 $\\Sigma_{ij} = 0.8$；如果 $i \\in M_1$ 且 $j \\in M_2$ 或反之，设 $\\Sigma_{ij} = 0.05$。\n  - 数据生成种子：$s_{\\mathrm{data}} = 42$。\n  - 置换种子：$s_{\\mathrm{perm}} = 4242$。\n  - 置换次数：$B = 999$。\n\n- 测试用例 B（无模块结构）：\n  - 维度：$n = 300$， $p = 8$。\n  - 划分：$M_1 = \\{0,1,2,3\\}$， $M_2 = \\{4,5,6,7\\}$。\n  - 协方差矩阵构建：对所有 $i$，设 $\\Sigma_{ii} = 1$；对所有 $i \\neq j$，设 $\\Sigma_{ij} = 0.5$。\n  - 数据生成种子：$s_{\\mathrm{data}} = 7$。\n  - 置换种子：$s_{\\mathrm{perm}} = 7007$。\n  - 置换次数：$B = 999$。\n\n- 测试用例 C（具有三个模块的近乎完美的模块结构）：\n  - 维度：$n = 180$， $p = 6$。\n  - 划分：$M_1 = \\{0,1\\}$， $M_2 = \\{2,3\\}$， $M_3 = \\{4,5\\}$。\n  - 协方差矩阵构建：对所有 $i$，设 $\\Sigma_{ii} = 1$；如果 $i \\neq j$ 且 $i,j$ 在同一模块中，设 $\\Sigma_{ij} = 0.7$；如果 $i$ 和 $j$ 在不同模块中，设 $\\Sigma_{ij} = 0.01$。\n  - 数据生成种子：$s_{\\mathrm{data}} = 99$。\n  - 置换种子：$s_{\\mathrm{perm}} = 9090$。\n  - 置换次数：$B = 999$。\n\n实现细节：\n- 将 $S$ 计算为 $X$ 各列的无偏样本协方差矩阵。\n- 对于每个测试用例，报告两个数字：观察到的模块化指数 $\\mathrm{R}_{\\mathrm{obs}}$ 和置换 $p$ 值 $p_{\\mathrm{perm}}$。\n- 将报告的每个数字四舍五入到 $6$ 位小数。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按顺序包含测试用例 A 的两个结果，然后是测试用例 B 的结果，最后是测试用例 C 的结果：$[\\mathrm{R}_{\\mathrm{obs}}^{(A)}, p_{\\mathrm{perm}}^{(A)}, \\mathrm{R}_{\\mathrm{obs}}^{(B)}, p_{\\mathrm{perm}}^{(B)}, \\mathrm{R}_{\\mathrm{obs}}^{(C)}, p_{\\mathrm{perm}}^{(C)}]$。", "solution": "问题陈述已经过严格审查，并被确定为有效。它在科学上基于统计假设检验，问题表述清晰，提供了所有必要信息，并以客观、正式的语言表达。其中没有矛盾、歧义或事实错误。这是一个应用于生物学问题的计算统计学标准（尽管不简单）练习。因此，我们可以着手解决问题。\n\n目标是执行一个置换检验，以评估定量性状模块划分的统计显著性。核心思想是将观察到的模块化指数 $\\mathrm{R}_{\\mathrm{obs}}$ 与通过随机置换性状到模块的分配而生成的该指数的零分布进行比较。指数值越小，表示模块化越强，意味着模块内的协方差远大于模块间的协方差。\n\n设数据矩阵为 $X \\in \\mathbb{R}^{n \\times p}$，包含 $n$ 个样本和 $p$ 个性状。计算样本协方差矩阵 $S \\in \\mathbb{R}^{p \\times p}$，其中其元素 $s_{ij}$ 是性状 $i$ 和性状 $j$ 之间的无偏样本协方差：\n$$ s_{ij} = \\frac{1}{n-1} \\sum_{k=1}^{n} (x_{ki} - \\bar{x}_i)(x_{kj} - \\bar{x}_j) $$\n其中 $\\bar{x}_i$ 是第 $i$ 个性状的样本均值。\n\n将 $p$ 个性状划分为 $K$ 个模块，给定为 $\\mathcal{M} = \\{M_1, M_2, \\ldots, M_K\\}$，其中每个 $M_k$ 是一个性状索引集合，$\\bigcup_{k=1}^K M_k = \\{1, 2, \\ldots, p\\}$，且当 $k \\ne k'$ 时 $M_k \\cap M_{k'} = \\emptyset$。为方便计算，我们可以定义一个映射 $\\mathrm{mod}(i)$，它返回包含性状 $i$ 的模块 $M_k$ 的索引 $k$。\n\n模块内非对角线总协方差 $C_{within}$ 是所有属于同一模块的不同性状对的协方差之和：\n$$ C_{within} = \\sum_{1 \\le i < j \\le p, \\atop \\mathrm{mod}(i) = \\mathrm{mod}(j)} s_{ij} $$\n模块间总协方差 $C_{between}$ 是所有属于不同模块的性状对的协方差之和：\n$$ C_{between} = \\sum_{1 \\le i < j \\le p, \\atop \\mathrm{mod}(i) \\ne \\mathrm{mod}(j)} s_{ij} $$\n模块化指数 $\\mathrm{R}$ 是这两个总和的比率：\n$$ \\mathrm{R} = \\frac{C_{between}}{C_{within}} $$\n假设协方差主要为正，较小的 $\\mathrm{R}$ 值表明模块化更强。我们为观察到的划分 $\\mathcal{M}$ 计算此值，得到 $\\mathrm{R}_{\\mathrm{obs}}$。\n\n原假设 $H_0$ 假定性状身份与模块结构之间没有特殊对应关系。也就是说，相对于划分结构，标签 $\\{1, \\ldots, p\\}$ 是可交换的。我们使用置换检验来检验这个假设。该过程包括生成大量的（$B$ 个）置换划分。每个置换划分都是通过随机置换所有性状索引的集合 $\\{1, \\ldots, p\\}$，然后在保持原始模块大小 $\\{|M_1|, \\ldots, |M_K|\\}$ 不变的情况下将它们重新分配给模块而创建的。\n\n令 $\\pi$ 为 $\\{1, \\ldots, p\\}$ 的一个置换。一个置换后的分配可以通过创建新模块 $M'_k = \\{\\pi(i) | i \\in M_k\\}$ 来构建。对于 $B$ 个这样的随机置换中的每一个，我们使用原始协方差矩阵 $S$ 和置换后的划分来计算模块化指数 $\\mathrm{R}_b$。这样就生成了 $\\mathrm{R}$ 值的零分布。\n\n然后，通过将 $\\mathrm{R}_{\\mathrm{obs}}$ 与置换值的集合 $\\{\\mathrm{R}_b\\}_{b=1}^B$ 进行比较，计算用于检测模块化（即检验 $\\mathrm{R}_{\\mathrm{obs}}$ 是否显著小）的单尾 $p$ 值。公式为：\n$$ p_{\\mathrm{perm}} = \\frac{1 + |\\{b \\in \\{1, \\ldots, B\\} : \\mathrm{R}_b \\le \\mathrm{R}_{\\mathrm{obs}}\\}|}{1 + B} $$\n在分子和分母中都包含 $1$ 是为了将观察值本身视为零分布中的一个元素。\n\n对于指定的每个测试用例，实施以下步骤：\n1.  根据问题规则构建真实的协方差矩阵 $\\Sigma \\in \\mathbb{R}^{p \\times p}$。\n2.  通过使用指定的数据生成种子 $s_{\\mathrm{data}}$，从多元正态分布 $\\mathcal{N}(\\mathbf{0}, \\Sigma)$ 中独立抽取 $n$ 个样本，生成数据矩阵 $X \\in \\mathbb{R}^{n \\times p}$。\n3.  从 $X$ 计算无偏样本协方差矩阵 $S$。\n4.  使用 $S$ 和给定的划分 $\\mathcal{M}$ 计算观察到的模块化指数 $\\mathrm{R}_{\\mathrm{obs}}$。\n5.  使用置换种子 $s_{\\mathrm{perm}}$ 初始化一个伪随机数生成器。\n6.  执行 $B$ 次置换。在每次迭代中，生成一个置换划分，计算相应的指数 $\\mathrm{R}_b$，并将其与 $\\mathrm{R}_{\\mathrm{obs}}$ 进行比较。\n7.  根据小于或等于 $\\mathrm{R}_{\\mathrm{obs}}$ 的置换指数的数量，计算最终的 $p$ 值 $p_{\\mathrm{perm}}$。\n8.  将得到的值 $\\mathrm{R}_{\\mathrm{obs}}$ 和 $p_{\\mathrm{perm}}$ 四舍五入到 $6$ 位小数。\n\n此过程应用于三个测试用例中的每一个，并将结果汇总成所需的最终格式。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n\n    def construct_sigma(p, partition, within_cov, between_cov):\n        \"\"\"Constructs the true covariance matrix Sigma.\"\"\"\n        sigma = np.full((p, p), between_cov)\n        for module in partition:\n            # Create index arrays for advanced indexing\n            indices = np.ix_(module, module)\n            sigma[indices] = within_cov\n        np.fill_diagonal(sigma, 1.0)\n        return sigma\n\n    def calculate_modularity_index(S, p, module_map):\n        \"\"\"Calculates the modularity index R.\"\"\"\n        within_sum = 0.0\n        between_sum = 0.0\n        for i in range(p):\n            for j in range(i + 1, p):\n                if module_map[i] == module_map[j]:\n                    within_sum += S[i, j]\n                else:\n                    between_sum += S[i, j]\n        \n        if within_sum == 0:\n            # Handle the case of zero within-module covariance to avoid division by zero.\n            # This is unlikely given the problem setup but is good practice.\n            return np.inf if between_sum > 0 else 0.0\n\n        return between_sum / within_sum\n\n    def run_permutation_test(n, p, partition, sigma_params, s_data, s_perm, B):\n        \"\"\"\n        Runs the full analysis for a single test case.\n        \"\"\"\n        # 1. Construct Sigma and generate data\n        rng_data = np.random.default_rng(s_data)\n        sigma = construct_sigma(p, partition, sigma_params['within'], sigma_params['between'])\n        mean_vec = np.zeros(p)\n        X = rng_data.multivariate_normal(mean=mean_vec, cov=sigma, size=n)\n\n        # 2. Compute the sample covariance matrix S\n        # np.cov with rowvar=False and default ddof=1 computes the unbiased estimator\n        S = np.cov(X, rowvar=False)\n\n        # 3. Compute the observed modularity index\n        # Create a map from trait index to module index for efficient lookup\n        module_map_obs = np.zeros(p, dtype=int)\n        for module_idx, module in enumerate(partition):\n            for trait_idx in module:\n                module_map_obs[trait_idx] = module_idx\n        \n        r_obs = calculate_modularity_index(S, p, module_map_obs)\n        \n        # 4. Perform the permutation test\n        rng_perm = np.random.default_rng(s_perm)\n        trait_indices = np.arange(p)\n        module_sizes = [len(m) for m in partition]\n        module_starts = np.concatenate(([0], np.cumsum(module_sizes[:-1])))\n\n        count_le = 0\n        for _ in range(B):\n            permuted_indices = rng_perm.permutation(trait_indices)\n            \n            # Create the permuted module map\n            module_map_perm = np.zeros(p, dtype=int)\n            for module_idx, start_pos in enumerate(module_starts):\n                 size = module_sizes[module_idx]\n                 permuted_module_traits = permuted_indices[start_pos : start_pos + size]\n                 for trait_idx in permuted_module_traits:\n                     module_map_perm[trait_idx] = module_idx\n            \n            r_perm = calculate_modularity_index(S, p, module_map_perm)\n            \n            if r_perm = r_obs:\n                count_le += 1\n        \n        # 5. Calculate the p-value\n        p_perm = (1 + count_le) / (1 + B)\n\n        return round(r_obs, 6), round(p_perm, 6)\n    \n    # Define test cases from the problem statement\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"n\": 200, \"p\": 6, \"B\": 999,\n            \"partition\": [[0, 1, 2], [3, 4, 5]],\n            \"sigma_params\": {\"within\": 0.8, \"between\": 0.05},\n            \"s_data\": 42, \"s_perm\": 4242\n        },\n        {\n            \"name\": \"Case B\",\n            \"n\": 300, \"p\": 8, \"B\": 999,\n            \"partition\": [[0, 1, 2, 3], [4, 5, 6, 7]],\n            \"sigma_params\": {\"within\": 0.5, \"between\": 0.5},\n            \"s_data\": 7, \"s_perm\": 7007\n        },\n        {\n            \"name\": \"Case C\",\n            \"n\": 180, \"p\": 6, \"B\": 999,\n            \"partition\": [[0, 1], [2, 3], [4, 5]],\n            \"sigma_params\": {\"within\": 0.7, \"between\": 0.01},\n            \"s_data\": 99, \"s_perm\": 9090\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        r_obs, p_perm = run_permutation_test(\n            n=case[\"n\"],\n            p=case[\"p\"],\n            partition=case[\"partition\"],\n            sigma_params=case[\"sigma_params\"],\n            s_data=case[\"s_data\"],\n            s_perm=case[\"s_perm\"],\n            B=case[\"B\"]\n        )\n        all_results.extend([r_obs, p_perm])\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```", "id": "2590370"}, {"introduction": "在真实世界的研究中，测量误差是不可避免的，而高级研究者必须理解这些误差如何影响其分析结果。不同的统计量对误差的敏感度不同，选择错误的度量可能导致结论偏差。[@problem_id:2590364] 本练习通过一个理论模型，要求你推导测量误差对两种常用模块化度量——$RV$ 系数和 $CR$ 比率——的影响。通过这个过程，你将深刻体会到为何某些度量标准在特定条件下更具稳健性，并学会在你的研究中做出更明智的方法论选择。", "problem": "在动物学和植物学结构的比较形态计量学中，模块性和整合性通常根据性状间的协方差模式进行量化。考虑一个系统，包含两个生物模块，记为模块 $A$（有 $m$ 个性状）和模块 $B$（有 $n$ 个性状），这些性状是在一个大的样本总体上测量的。假设采用以下简单的随机模型和结构性假设。\n\n带加性噪声的测量基本模型：对于每个性状 $i$，观测值为 $X_{i}^{\\mathrm{obs}} = X_{i}^{\\ast} + \\varepsilon_{i}$，其中 $X_{i}^{\\ast}$ 是潜在的生物性状值，$\\varepsilon_{i}$ 是测量误差，满足 $\\mathbb{E}[\\varepsilon_{i}] = 0$，$\\operatorname{Var}(\\varepsilon_{i}) = \\sigma_{e}^{2}$，且对于 $i \\neq j$ 有 $\\operatorname{Cov}(\\varepsilon_{i}, \\varepsilon_{j}) = 0$。假设对于所有的 $i,j$，$\\varepsilon_{i}$ 都独立于 $X_{j}^{\\ast}$。\n\n潜在协方差的结构性假设：潜在性状协方差矩阵具有模块内的复合对称性和恒定的模块间协方差：所有潜在方差等于 $v0$，所有潜在模块内协方差等于 $c_{w}$，所有潜在模块间协方差等于 $c_{b}$。也就是说，对于同一模块内的 $i \\neq j$，有 $\\operatorname{Cov}(X_{i}^{\\ast},X_{j}^{\\ast}) = c_{w}$；对于 $A$ 中的 $i$ 和 $B$ 中的 $j$，有 $\\operatorname{Cov}(X_{i}^{\\ast},X_{j}^{\\ast}) = c_{b}$；对于任意 $i$，有 $\\operatorname{Var}(X_{i}^{\\ast}) = v$。假设 $v|c_{w}|$ 和 $v|c_{b}|$，以确保对于给定的 $m$ 和 $n$，潜在协方差矩阵是正定的。\n\n模块性度量：令 $\\Sigma$ 表示总体潜在协方差矩阵，分块如下\n$$\n\\Sigma \\;=\\; \\begin{pmatrix}\n\\Sigma_{AA}  \\Sigma_{AB} \\\\\n\\Sigma_{BA}  \\Sigma_{BB}\n\\end{pmatrix},\n$$\n其块结构是显而易见的。定义两种标准的模块性度量：\n\n- 模块 $A$ 和 $B$ 之间的 Escoufier RV 系数 (RV)：\n$$\n\\mathrm{RV} \\;=\\; \\frac{\\operatorname{tr}\\!\\left(\\Sigma_{AB}\\Sigma_{BA}\\right)}{\\sqrt{\\operatorname{tr}\\!\\left(\\Sigma_{AA}^{2}\\right)\\,\\operatorname{tr}\\!\\left(\\Sigma_{BB}^{2}\\right)}}.\n$$\n\n- 协方差比率 (CR)：将模块内平均协方差定义为 $\\Sigma_{AA}$ 和 $\\Sigma_{BB}$ 非对角线元素的平均值，将模块间平均协方差定义为 $\\Sigma_{AB}$ 元素的平均值。那么\n$$\n\\mathrm{CR} \\;=\\; \\frac{\\text{模块间平均协方差}}{\\text{模块内平均协方差}}.\n$$\n\n基于协方差、相关性和期望线性性的核心定义，完成以下任务：\n\n(a) 从 $\\operatorname{Cov}(X,Y)=\\mathbb{E}[(X-\\mathbb{E}X)(Y-\\mathbb{E}Y)]$ 和上述独立性假设出发，推导期望观测协方差矩阵（用 $\\Sigma$ 和 $\\sigma_{e}^{2}$ 表示）。解释为什么测量误差会使对角线方差膨胀并削弱相关性。\n\n(b) 在所述的复合对称潜在结构下，用 $m$、$n$、$v$、$c_{w}$ 和 $c_{b}$ 表示潜在的 $\\mathrm{RV}$ 和 $\\mathrm{CR}$。\n\n(c) 在相同结构下，用 $m$、$n$、$v$、$c_{w}$、$c_{b}$ 和 $\\sigma_{e}^{2}$ 计算期望观测的 $\\mathrm{RV}$ 和 $\\mathrm{CR}$。\n\n(d) 使用你的结果，为期望偏差\n$$\n\\Delta \\mathrm{RV} \\;=\\; \\mathbb{E}[\\mathrm{RV}_{\\mathrm{obs}}]-\\mathrm{RV}_{\\ast}, \n\\qquad \n\\Delta \\mathrm{CR} \\;=\\; \\mathbb{E}[\\mathrm{CR}_{\\mathrm{obs}}]-\\mathrm{CR}_{\\ast},\n$$\n提供精确的符号表达式，其中下标 $\\ast$ 表示潜在值，“obs”表示有测量误差时的观测值。以行矩阵 $\\bigl(\\Delta \\mathrm{RV}\\;\\;\\Delta \\mathrm{CR}\\bigr)$ 的形式给出最终答案，使用精确的符号形式（无数值舍入）。", "solution": "所述问题具有科学依据，提法明确且客观。它提出了一个标准的测量误差统计模型和一个简化的、但有效的协方差结构，用于分析常用生物模块性度量的性质。推导所需的所有定义和参数均已提供，并且内部一致。我们开始求解。\n\n(a) 期望观测协方差矩阵的推导以及测量误差的影响。\n\n令 $\\mathbf{X}^{\\mathrm{obs}}$ 为观测性状值向量，$\\mathbf{X}^{\\ast}$ 为潜在性状值向量。单个特征 $i$ 的模型为 $X_{i}^{\\mathrm{obs}} = X_{i}^{\\ast} + \\varepsilon_{i}$。期望观测协方差矩阵记为 $\\Sigma_{\\mathrm{obs}}$，其元素为 $(\\Sigma_{\\mathrm{obs}})_{ij} = \\operatorname{Cov}(X_{i}^{\\mathrm{obs}}, X_{j}^{\\mathrm{obs}})$。我们使用协方差的定义 $\\operatorname{Cov}(U, V) = \\mathbb{E}[(U-\\mathbb{E}[U])(V-\\mathbb{E}[V])]$ 及其双线性性质。\n\n观测值的期望是 $\\mathbb{E}[X_{i}^{\\mathrm{obs}}] = \\mathbb{E}[X_{i}^{\\ast} + \\varepsilon_{i}] = \\mathbb{E}[X_{i}^{\\ast}] + \\mathbb{E}[\\varepsilon_{i}]$。由于 $\\mathbb{E}[\\varepsilon_{i}] = 0$，我们有 $\\mathbb{E}[X_{i}^{\\mathrm{obs}}] = \\mathbb{E}[X_{i}^{\\ast}]$。令 $\\mu_i^* = \\mathbb{E}[X_{i}^{\\ast}]$。\n\n两个观测性状 $i$ 和 $j$ 之间的协方差为：\n$$\n\\operatorname{Cov}(X_{i}^{\\mathrm{obs}}, X_{j}^{\\mathrm{obs}}) = \\operatorname{Cov}(X_{i}^{\\ast} + \\varepsilon_{i}, X_{j}^{\\ast} + \\varepsilon_{j})\n$$\n利用协方差算子的双线性：\n$$\n\\operatorname{Cov}(X_{i}^{\\mathrm{obs}}, X_{j}^{\\mathrm{obs}}) = \\operatorname{Cov}(X_{i}^{\\ast}, X_{j}^{\\ast}) + \\operatorname{Cov}(X_{i}^{\\ast}, \\varepsilon_{j}) + \\operatorname{Cov}(\\varepsilon_{i}, X_{j}^{\\ast}) + \\operatorname{Cov}(\\varepsilon_{i}, \\varepsilon_{j})\n$$\n根据问题陈述，测量误差 $\\varepsilon_{k}$ 独立于任何潜在性状值 $X_{l}^{\\ast}$。独立性意味着协方差为零，因此对于所有 $i,j$，$\\operatorname{Cov}(X_{i}^{\\ast}, \\varepsilon_{j}) = 0$ 且 $\\operatorname{Cov}(\\varepsilon_{i}, X_{j}^{\\ast}) = 0$。表达式简化为：\n$$\n\\operatorname{Cov}(X_{i}^{\\mathrm{obs}}, X_{j}^{\\mathrm{obs}}) = \\operatorname{Cov}(X_{i}^{\\ast}, X_{j}^{\\ast}) + \\operatorname{Cov}(\\varepsilon_{i}, \\varepsilon_{j})\n$$\n我们分析 $\\operatorname{Cov}(\\varepsilon_{i}, \\varepsilon_{j})$ 项的两种情况：\n1. 对于 $i=j$ (方差)：$\\operatorname{Cov}(\\varepsilon_{i}, \\varepsilon_{i}) = \\operatorname{Var}(\\varepsilon_{i}) = \\sigma_{e}^{2}$。\n2. 对于 $i \\neq j$ (协方差)：$\\operatorname{Cov}(\\varepsilon_{i}, \\varepsilon_{j}) = 0$，因为不同性状间的误差是不相关的。\n\n因此，对于 $\\Sigma_{\\mathrm{obs}}$ 的对角线元素 (方差, $i=j$)：\n$$\n(\\Sigma_{\\mathrm{obs}})_{ii} = \\operatorname{Var}(X_{i}^{\\mathrm{obs}}) = \\operatorname{Var}(X_{i}^{\\ast}) + \\sigma_{e}^{2} = (\\Sigma)_{ii} + \\sigma_{e}^{2}\n$$\n而对于 $\\Sigma_{\\mathrm{obs}}$ 的非对角线元素 (协方差, $i \\neq j$)：\n$$\n(\\Sigma_{\\mathrm{obs}})_{ij} = \\operatorname{Cov}(X_{i}^{\\mathrm{obs}}, X_{j}^{\\mathrm{obs}}) = \\operatorname{Cov}(X_{i}^{\\ast}, X_{j}^{\\ast}) = (\\Sigma)_{ij}\n$$\n用矩阵表示法，该关系表示为：\n$$\n\\Sigma_{\\mathrm{obs}} = \\Sigma + \\sigma_{e}^{2}I\n$$\n其中 $I$ 是维度为 $(m+n) \\times (m+n)$ 的单位矩阵。\n\n这个结果解释了测量误差的影响。\n- **方差膨胀**：每个性状的观测方差 $(\\Sigma_{\\mathrm{obs}})_{ii} = (\\Sigma)_{ii} + \\sigma_{e}^{2}$，比潜在的生物方差 $(\\Sigma)_{ii}$ 大，其差值为误差方差 $\\sigma_{e}^{2}$（假设 $\\sigma_{e}^{2}  0$）。\n- **相关性削弱**：两个不同性状 $i$ 和 $j$ 之间的相关性定义为 $\\rho_{ij} = \\frac{\\operatorname{Cov}(X_i, X_j)}{\\sqrt{\\operatorname{Var}(X_i) \\operatorname{Var}(X_j)}}$。\n潜在相关性为 $\\rho_{ij}^{\\ast} = \\frac{\\operatorname{Cov}(X_{i}^{\\ast}, X_{j}^{\\ast})}{\\sqrt{\\operatorname{Var}(X_{i}^{\\ast}) \\operatorname{Var}(X_{j}^{\\ast})}} = \\frac{(\\Sigma)_{ij}}{\\sqrt{(\\Sigma)_{ii}(\\Sigma)_{jj}}} = \\frac{(\\Sigma)_{ij}}{v}$。\n观测相关性为 $\\rho_{ij}^{\\mathrm{obs}} = \\frac{\\operatorname{Cov}(X_{i}^{\\mathrm{obs}}, X_{j}^{\\mathrm{obs}})}{\\sqrt{\\operatorname{Var(X_{i}^{\\mathrm{obs}})} \\operatorname{Var(X_{j}^{\\mathrm{obs}})}}} = \\frac{(\\Sigma)_{ij}}{\\sqrt{((\\Sigma)_{ii}+\\sigma_{e}^{2})((\\Sigma)_{jj}+\\sigma_{e}^{2})}} = \\frac{(\\Sigma)_{ij}}{v+\\sigma_{e}^{2}}$。\n由于 $v+\\sigma_{e}^{2}  v$，我们有 $|\\rho_{ij}^{\\mathrm{obs}}| = \\frac{|(\\Sigma)_{ij}|}{v+\\sigma_{e}^{2}}  \\frac{|(\\Sigma)_{ij}|}{v} = |\\rho_{ij}^{\\ast}|$。相关性的大小被测量误差减小或“削弱”了。\n\n(b) 潜在的 RV 和 CR。\n\n我们首先基于复合对称结构构建潜在协方差矩阵 $\\Sigma_{\\ast}$ 的分块。\n模块 A 有 $m$ 个性状，模块 B 有 $n$ 个性状。\n$\\operatorname{Var}(X_i^*) = v$，$\\operatorname{Cov}(X_i^*, X_j^*) = c_w$ (模块内, $i \\neq j$)，$\\operatorname{Cov}(X_i^*, X_j^*) = c_b$ (模块间)。\n- $\\Sigma_{AA}$ 是一个 $m \\times m$ 矩阵，其对角线元素为 $v$，非对角线元素为 $c_w$。\n- $\\Sigma_{BB}$ 是一个 $n \\times n$ 矩阵，其对角线元素为 $v$，非对角线元素为 $c_w$。\n- $\\Sigma_{AB}$ 是一个 $m \\times n$ 矩阵，其所有元素都等于 $c_b$。\n- $\\Sigma_{BA} = \\Sigma_{AB}^{T}$ 是一个 $n \\times m$ 矩阵，其所有元素都等于 $c_b$。\n\n为计算 RV 系数，我们需要矩阵乘积的迹。\n- $\\operatorname{tr}(\\Sigma_{AB}\\Sigma_{BA})$：矩阵乘积为 $\\Sigma_{AB}\\Sigma_{BA} = (c_b J_{m,n})(c_b J_{n,m}) = c_b^2 J_{m,n}J_{n,m}$，其中 $J_{k,l}$ 是 $k \\times l$ 的全 1 矩阵。乘积 $J_{m,n}J_{n,m}$ 是一个 $m \\times m$ 矩阵，其中每个元素都是 $n$。因此，$\\Sigma_{AB}\\Sigma_{BA} = c_b^2 n J_m$。迹是其 $m$ 个对角线元素之和，这些元素都等于 $n c_b^2$。所以，$\\operatorname{tr}(\\Sigma_{AB}\\Sigma_{BA}) = m n c_b^2$。\n- $\\operatorname{tr}(\\Sigma_{AA}^2)$：$\\Sigma_{AA}^2$ 的第 $i$ 个对角线元素是 $(\\Sigma_{AA}^2)_{ii} = \\sum_{k=1}^m (\\Sigma_{AA})_{ik}(\\Sigma_{AA})_{ki}$。我们有 $(\\Sigma_{AA})_{ii}=v$ 和对于 $k \\neq i$ 有 $(\\Sigma_{AA})_{ik}=c_w$。\n$$(\\Sigma_{AA}^2)_{ii} = (\\Sigma_{AA})_{ii}^2 + \\sum_{k \\neq i} (\\Sigma_{AA})_{ik}^2 = v^2 + (m-1)c_w^2$$\n迹是 $m$ 个相同的对角线元素之和：$\\operatorname{tr}(\\Sigma_{AA}^2) = m(v^2 + (m-1)c_w^2)$。\n- $\\operatorname{tr}(\\Sigma_{BB}^2)$：根据对称性，我们将 $m$ 替换为 $n$：$\\operatorname{tr}(\\Sigma_{BB}^2) = n(v^2 + (n-1)c_w^2)$。\n\n潜在的 RV 系数，$\\mathrm{RV}_{\\ast}$，为：\n$$\n\\mathrm{RV}_{\\ast} = \\frac{\\operatorname{tr}(\\Sigma_{AB}\\Sigma_{BA})}{\\sqrt{\\operatorname{tr}(\\Sigma_{AA}^2)\\operatorname{tr}(\\Sigma_{BB}^2)}} = \\frac{m n c_b^2}{\\sqrt{m(v^2 + (m-1)c_w^2) \\cdot n(v^2 + (n-1)c_w^2)}}\n$$\n$$\n\\mathrm{RV}_{\\ast} = \\frac{\\sqrt{mn} c_b^2}{\\sqrt{(v^2 + (m-1)c_w^2)(v^2 + (n-1)c_w^2)}}\n$$\n为计算 CR，我们求出所需的平均协方差。\n- 模块间平均协方差：$\\Sigma_{AB}$ 的所有 $mn$ 个元素都是 $c_b$。其平均值为 $c_b$。\n- 模块内平均协方差：$\\Sigma_{AA}$ 中有 $m(m-1)$ 个非对角线元素，$\\Sigma_{BB}$ 中有 $n(n-1)$ 个，它们都等于 $c_w$。其平均值为 $\\frac{m(m-1)c_w + n(n-1)c_w}{m(m-1)+n(n-1)} = c_w$。\n潜在的协方差比率，$\\mathrm{CR}_{\\ast}$，为：\n$$\n\\mathrm{CR}_{\\ast} = \\frac{c_b}{c_w}\n$$\n\n(c) 期望观测的 RV 和 CR。\n\n我们使用观测总体协方差矩阵 $\\Sigma_{\\mathrm{obs}} = \\Sigma_{\\ast} + \\sigma_{e}^{2}I$。度量是在此矩阵上计算的。\n$\\Sigma_{\\mathrm{obs}}$ 的块结构：\n- $\\Sigma_{AA, \\mathrm{obs}} = \\Sigma_{AA} + \\sigma_e^2 I_m$。其对角线元素为 $v+\\sigma_e^2$，非对角线元素为 $c_w$。\n- $\\Sigma_{BB, \\mathrm{obs}} = \\Sigma_{BB} + \\sigma_e^2 I_n$。其对角线元素为 $v+\\sigma_e^2$，非对角线元素为 $c_w$。\n- $\\Sigma_{AB, \\mathrm{obs}} = \\Sigma_{AB}$ 和 $\\Sigma_{BA, \\mathrm{obs}} = \\Sigma_{BA}$，因为单位矩阵在非对角块中为零。\n\n对于 $\\mathrm{RV}_{\\mathrm{obs}}$：\n- 分子项 $\\operatorname{tr}(\\Sigma_{AB, \\mathrm{obs}}\\Sigma_{BA, \\mathrm{obs}}) = \\operatorname{tr}(\\Sigma_{AB}\\Sigma_{BA}) = m n c_b^2$ 不变。\n- 分母项使用新的对角线方差 $v_{\\mathrm{obs}} = v+\\sigma_e^2$ 重新计算，而非对角线协方差 $c_w$ 保持不变。\n- $\\operatorname{tr}(\\Sigma_{AA, \\mathrm{obs}}^2) = m(v_{\\mathrm{obs}}^2 + (m-1)c_w^2) = m((v+\\sigma_e^2)^2 + (m-1)c_w^2)$。\n- $\\operatorname{tr}(\\Sigma_{BB, \\mathrm{obs}}^2) = n(v_{\\mathrm{obs}}^2 + (n-1)c_w^2) = n((v+\\sigma_e^2)^2 + (n-1)c_w^2)$。\n观测的 RV 系数，$\\mathrm{RV}_{\\mathrm{obs}}$，为：\n$$\n\\mathrm{RV}_{\\mathrm{obs}} = \\frac{m n c_b^2}{\\sqrt{m((v+\\sigma_e^2)^2 + (m-1)c_w^2) \\cdot n((v+\\sigma_e^2)^2 + (n-1)c_w^2)}}\n$$\n$$\n\\mathrm{RV}_{\\mathrm{obs}} = \\frac{\\sqrt{mn} c_b^2}{\\sqrt{((v+\\sigma_e^2)^2 + (m-1)c_w^2)((v+\\sigma_e^2)^2 + (n-1)c_w^2)}}\n$$\n对于 $\\mathrm{CR}_{\\mathrm{obs}}$：\n- 模块间平均协方差：对 $\\Sigma_{AB, \\mathrm{obs}} = \\Sigma_{AB}$ 的元素（均为 $c_b$）取平均，得到 $c_b$。\n- 模块内平均协方差：对 $\\Sigma_{AA, \\mathrm{obs}}$ 和 $\\Sigma_{BB, \\mathrm{obs}}$ 的非对角线元素取平均。这些元素不受加性误差的影响，仍然是 $c_w$。因此平均值为 $c_w$。\n观测的协方差比率，$\\mathrm{CR}_{\\mathrm{obs}}$，为：\n$$\n\\mathrm{CR}_{\\mathrm{obs}} = \\frac{c_b}{c_w}\n$$\n\n(d) 期望偏差 $\\Delta \\mathrm{RV}$ 和 $\\Delta \\mathrm{CR}$。\n\n偏差是观测度量与潜在度量之差。\nRV 系数的偏差为 $\\Delta \\mathrm{RV} = \\mathrm{RV}_{\\mathrm{obs}} - \\mathrm{RV}_{\\ast}$。\n$$\n\\Delta \\mathrm{RV} = \\frac{\\sqrt{mn} c_b^2}{\\sqrt{((v+\\sigma_e^2)^2 + (m-1)c_w^2)((v+\\sigma_e^2)^2 + (n-1)c_w^2)}} - \\frac{\\sqrt{mn} c_b^2}{\\sqrt{(v^2 + (m-1)c_w^2)(v^2 + (n-1)c_w^2)}}\n$$\n这可以更紧凑地写成：\n$$\n\\Delta \\mathrm{RV} = \\sqrt{mn} c_b^2 \\left( \\frac{1}{\\sqrt{((v+\\sigma_e^2)^2 + (m-1)c_w^2)((v+\\sigma_e^2)^2 + (n-1)c_w^2)}} - \\frac{1}{\\sqrt{(v^2 + (m-1)c_w^2)(v^2 + (n-1)c_w^2)}} \\right)\n$$\nCR 的偏差为 $\\Delta \\mathrm{CR} = \\mathrm{CR}_{\\mathrm{obs}} - \\mathrm{CR}_{\\ast}$。\n$$\n\\Delta \\mathrm{CR} = \\frac{c_b}{c_w} - \\frac{c_b}{c_w} = 0\n$$\n分析表明，对于这种特定的误差模型和协方差结构，并基于所提供的定义，CR 度量对测量误差是不变的，而 RV 系数则被削弱（即，偏向于零）。\n\n最终答案要求将这两个偏差表示为一个行矩阵。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\sqrt{mn} c_b^2 \\left( \\frac{1}{\\sqrt{((v+\\sigma_e^2)^2 + (m-1)c_w^2)((v+\\sigma_e^2)^2 + (n-1)c_w^2)}} - \\frac{1}{\\sqrt{(v^2 + (m-1)c_w^2)(v^2 + (n-1)c_w^2)}} \\right)  0 \\end{pmatrix}}\n$$", "id": "2590364"}]}