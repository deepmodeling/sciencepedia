{"hands_on_practices": [{"introduction": "物种是生物圈层次结构中的一个基本单元，但界定其边界在实践中极具挑战性。本练习将物种界定的概念性问题转化为一个严谨的、可计算的框架。通过使用贝叶斯模型选择，我们将量化支持“一个物种”与“两个物种”假说的证据强度，让您亲身体验如何利用基因数据和统计推断来解决系统学中的核心问题 [@problem_id:2580969]。", "problem": "您正在物种水平上研究生物圈的层级组织，通过比较关于二倍体基因型在蝾螈环物种情境下如何跨空间组织的两种替选假说。这两种假说分别是：$H_1$（单一物种）：两个地理种群是共享每个基因座上相同等位基因频率的单一泛交物种；$H_2$（两个物种）：两个地理种群是独立的物种，在每个基因座上具有独立的等位基因频率。请使用基本的种群遗传学建模假设，即在每个物种内，二倍体个体符合哈迪-温伯格平衡（HWE），并且在非连锁的基因座之间，给定等位基因频率，数据是独立的。在HWE下，等位基因计数是基因型数据的充分统计量。假设在每个基因座上，每个物种的等位基因频率都有一个Beta先验 $\\mathrm{Beta}(\\alpha,\\beta)$，其中 $\\alpha=\\beta=1$（等位基因频率的均匀先验）。对于每个基因座 $\\ell$，设数据为：组1中，$m_{1\\ell}$ 次总伯努利试验（染色体）中有 $k_{1\\ell}$ 次成功（等位基因 $A$）；组2中，$m_{2\\ell}$ 次试验中有 $k_{2\\ell}$ 次成功。\n\n仅从以下基础出发：\n- 哈迪-温伯格平衡（HWE）下等位基因计数的二项抽样模型。\n- 等位基因频率参数 $p$ 的Beta先验 $\\mathrm{Beta}(\\alpha, \\beta)$。\n- Beta函数恒等式 $\\mathrm{B}(x,y)=\\dfrac{\\Gamma(x)\\Gamma(y)}{\\Gamma(x+y)}$ 及其在共轭Beta-二项积分中的作用。\n- 非连锁基因座间的条件独立性。\n\n推导在 $H_1$ 和 $H_2$ 假说下单个基因座的边缘似然（通过解析地对等位基因频率进行积分），然后推导多个基因座的贝叶斯因子（BF），定义为 $B_{21}=\\dfrac{P(D\\mid H_2)}{P(D\\mid H_1)}$，作为各基因座比率的乘积。您的程序必须为每个测试用例计算所有基因座的总证据，即 $\\log_{10} B_{21}$。\n\n测试套件。对于下方的每个测试用例，每个基因座由一个四元组 $(k_1,m_1,k_2,m_2)$ 指定，使用等位基因计数（对于二倍体，$m_i$ 是采样个体数量的两倍）。所有基因座都是非连锁的，并使用 $\\alpha=\\beta=1$。计算每个用例的 $\\log_{10} B_{21}$，四舍五入到 $6$ 位小数。\n\n- 测试用例 $1$（强烈的末端分化，与环物种中不同的末端形态一致）：\n  - 基因座：$(4,4,0,4)$, $(4,4,0,4)$, $(3,4,1,4)$, $(4,4,0,4)$, $(3,4,1,4)$。\n- 测试用例 $2$（分化很小，与环内部的单一物种一致）：\n  - 基因座：$(2,4,2,4)$, $(1,4,1,4)$, $(3,4,3,4)$, $(2,4,2,4)$, $(2,4,2,4)$。\n- 测试用例 $3$（中等分化，代表接触区的部分分化）：\n  - 基因座：$(3,4,2,4)$, $(2,4,1,4)$, $(3,4,2,4)$, $(2,4,1,4)$, $(2,4,2,4)$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个条目等于一个测试用例的 $\\log_{10} B_{21}$，四舍五入到 $6$ 位小数，顺序与上述相同。例如，一个可接受的格式是 [$x_1,x_2,x_3$]，其中每个 $x_i$ 是一个小数点后恰好有 $6$ 位数字的浮点数。不允许有其他输出。", "solution": "所述问题经过了严格的验证。所有提供的假设和数据都是明确且自洽的。该框架基于种群遗传学和贝叶斯统计的基本原理，特别是利用了Beta-二项共轭模型，这是分析等位基因计数数据的标准方法。该问题是良定的，可以从所提供的信息中推导出唯一的解。待比较的假说 $H_1$ 和 $H_2$ 是对观测数据的清晰定义且互斥的模型。目标明确，需要进行贝叶斯模型选择中的标准计算。因此，该问题被认为是有效的，现在将推导其形式化解。\n\n任务是计算贝叶斯因子 $B_{21}$，它比较了关于种群结构的两种假说。设 $D$ 为观测数据，它由 $L$ 个非连锁基因座的等位基因计数组成。对于每个基因座 $\\ell \\in \\{1, \\dots, L\\}$，数据为 $D_\\ell = (k_{1\\ell}, m_{1\\ell}, k_{2\\ell}, m_{2\\ell})$，其中 $k_{i\\ell}$ 是从地理组 $i$ 抽样的 $m_{i\\ell}$ 个总等位基因中等位基因“A”的计数。\n\n贝叶斯因子定义为两种假说下数据的边缘似然之比：\n$$ B_{21} = \\frac{P(D \\mid H_2)}{P(D \\mid H_1)} $$\n由于基因座是非连锁的，在给定一个假说的情况下，数据在不同基因座之间是条件独立的。因此，总贝叶斯因子是各基因座贝叶斯因子的乘积：\n$$ B_{21} = \\prod_{\\ell=1}^{L} \\frac{P(D_\\ell \\mid H_2)}{P(D_\\ell \\mid H_1)} = \\prod_{\\ell=1}^{L} B_{21, \\ell} $$\n要求的输出是此数量以10为底的对数，即各基因座对数贝叶斯因子之和：\n$$ \\log_{10}(B_{21}) = \\sum_{\\ell=1}^{L} \\log_{10}(B_{21, \\ell}) $$\n我们接下来推导单个基因座 $\\ell$ 的边缘似然。为清晰起见，本节将省略下标 $\\ell$。\n\n模型的边缘似然（或证据）是通过对参数的先验分布上的似然函数进行积分得到的。一般形式为 $P(D \\mid H) = \\int P(D \\mid \\theta, H) P(\\theta \\mid H) d\\theta$。\n等位基因计数的抽样分布是二项分布。对于一个大小为 $m$、等位基因频率为 $p$ 的样本，观测到 $k$ 个该等位基因拷贝的概率为：\n$$ P(k \\mid m, p) = \\binom{m}{k} p^k (1-p)^{m-k} $$\n等位基因频率 $p$ 的先验分布是Beta分布：\n$$ P(p \\mid \\alpha, \\beta) = \\frac{p^{\\alpha-1} (1-p)^{\\beta-1}}{B(\\alpha, \\beta)} $$\n其中 $B(\\alpha, \\beta) = \\frac{\\Gamma(\\alpha)\\Gamma(\\beta)}{\\Gamma(\\alpha+\\beta)}$ 是Beta函数。问题指定了均匀先验，这对应于设置超参数 $\\alpha=1$ 和 $\\beta=1$。\n\n**$H_1$（单一物种）下的边缘似然：**\n在 $H_1$ 下，两个组共享一个单一的等位基因频率 $p$。来自两个组的数据 $D = (k_1, m_1, k_2, m_2)$ 可以合并。总成功数为 $k_{tot} = k_1 + k_2$，总试验数为 $m_{tot} = m_1 + m_2$。给定 $p$ 的数据似然为：\n$$ P(D \\mid p, H_1) = P(k_1 \\mid m_1, p) P(k_2 \\mid m_2, p) = \\binom{m_1}{k_1} p^{k_1} (1-p)^{m_1-k_1} \\binom{m_2}{k_2} p^{k_2} (1-p)^{m_2-k_2} $$\n$$ P(D \\mid p, H_1) = \\binom{m_1}{k_1} \\binom{m_2}{k_2} p^{k_{tot}} (1-p)^{m_{tot}-k_{tot}} $$\n边缘似然是似然函数对 $p$ 的先验积分：\n$$ P(D \\mid H_1) = \\int_0^1 \\binom{m_1}{k_1} \\binom{m_2}{k_2} p^{k_{tot}} (1-p)^{m_{tot}-k_{tot}} \\frac{p^{\\alpha-1} (1-p)^{\\beta-1}}{B(\\alpha, \\beta)} dp $$\n$$ P(D \\mid H_1) = \\frac{\\binom{m_1}{k_1} \\binom{m_2}{k_2}}{B(\\alpha, \\beta)} \\int_0^1 p^{k_{tot}+\\alpha-1} (1-p)^{m_{tot}-k_{tot}+\\beta-1} dp $$\n认识到该积分为Beta函数的定义，我们得到Beta-二项概率：\n$$ P(D \\mid H_1) = \\binom{m_1}{k_1} \\binom{m_2}{k_2} \\frac{B(k_{tot}+\\alpha, m_{tot}-k_{tot}+\\beta)}{B(\\alpha, \\beta)} $$\n\n**$H_2$（两个物种）下的边缘似然：**\n在 $H_2$ 下，两个组具有独立的等位基因频率 $p_1$ 和 $p_2$，每个频率都有一个独立的先验 $P(p_i \\mid \\alpha, \\beta) = \\mathrm{Beta}(\\alpha, \\beta)$。似然函数因此可以分解，边缘似然积分也同样可以分解：\n$$ P(D \\mid H_2) = \\left( \\int_0^1 P(k_1 \\mid m_1, p_1) P(p_1) dp_1 \\right) \\times \\left( \\int_0^1 P(k_2 \\mid m_2, p_2) P(p_2) dp_2 \\right) $$\n每一项都是一个独立的Beta-二项计算：\n$$ P(D \\mid H_2) = \\left( \\binom{m_1}{k_1} \\frac{B(k_1+\\alpha, m_1-k_1+\\beta)}{B(\\alpha, \\beta)} \\right) \\times \\left( \\binom{m_2}{k_2} \\frac{B(k_2+\\alpha, m_2-k_2+\\beta)}{B(\\alpha, \\beta)} \\right) $$\n\n**单个基因座的贝叶斯因子：**\n我们现在构成 $B_{21, \\ell}$ 的比率。二项式系数项 $\\binom{m_1}{k_1}$ 和 $\\binom{m_2}{k_2}$ 会抵消，一个 $B(\\alpha, \\beta)$ 项也会抵消：\n$$ B_{21} = \\frac{P(D \\mid H_2)}{P(D \\mid H_1)} = \\frac{B(k_1+\\alpha, m_1-k_1+\\beta) \\cdot B(k_2+\\alpha, m_2-k_2+\\beta)}{B(\\alpha, \\beta) \\cdot B(k_1+k_2+\\alpha, m_1-k_1-k_2+\\beta)} $$\n对于指定的均匀先验，$\\alpha=1$ 和 $\\beta=1$。这简化了表达式，因为 $B(1, 1) = \\frac{\\Gamma(1)\\Gamma(1)}{\\Gamma(2)} = 1$。\n$$ B_{21} = \\frac{B(k_1+1, m_1-k_1+1) \\cdot B(k_2+1, m_2-k_2+1)}{B(k_1+k_2+1, m_1-k_1-k_2+1)} $$\n为了避免由阶乘产生极大或极小数字而导致的数值不稳定性，计算必须在对数空间中使用对数伽马函数 $\\ln \\Gamma(x)$ 进行。Beta函数的自然对数是 $\\ln B(x, y) = \\ln \\Gamma(x) + \\ln \\Gamma(y) - \\ln \\Gamma(x+y)$。单个基因座贝叶斯因子的自然对数是：\n$$ \\ln(B_{21, \\ell}) = \\ln B(k_{1\\ell}+1, m_{1\\ell}-k_{1\\ell}+1) + \\ln B(k_{2\\ell}+1, m_{2\\ell}-k_{2\\ell}+1) - \\ln B(k_{1\\ell}+k_{2\\ell}+1, m_{1\\ell}+m_{2\\ell}-k_{1\\ell}-k_{2\\ell}+1) $$\n所有基因座的总对数贝叶斯因子是这些各基因座项的总和：\n$$ \\ln(B_{21}) = \\sum_{\\ell=1}^{L} \\ln(B_{21, \\ell}) $$\n最后，为了得到以10为底的结果，我们使用换底公式：\n$$ \\log_{10}(B_{21}) = \\frac{\\ln(B_{21})}{\\ln(10)} $$\n算法是遍历每个测试用例，并在每个用例中遍历其基因座。对于每个基因座，使用上述带有对数伽马函数的公式计算 $\\ln(B_{21, \\ell})$。将这些值相加，转换为以10为底的对数，并报告结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import gammaln\n\ndef solve():\n    \"\"\"\n    Computes the log10 Bayes Factor (B_21) for species delimitation\n    based on allele count data across multiple loci.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each locus is a tuple (k1, m1, k2, m2).\n    test_cases = [\n        # Test case 1 (strong terminal divergence)\n        [\n            (4, 4, 0, 4),\n            (4, 4, 0, 4),\n            (3, 4, 1, 4),\n            (4, 4, 0, 4),\n            (3, 4, 1, 4),\n        ],\n        # Test case 2 (little divergence)\n        [\n            (2, 4, 2, 4),\n            (1, 4, 1, 4),\n            (3, 4, 3, 4),\n            (2, 4, 2, 4),\n            (2, 4, 2, 4),\n        ],\n        # Test case 3 (intermediate divergence)\n        [\n            (3, 4, 2, 4),\n            (2, 4, 1, 4),\n            (3, 4, 2, 4),\n            (2, 4, 1, 4),\n            (2, 4, 2, 4),\n        ],\n    ]\n\n    # Hyperparameters for the Beta prior. a=b=1 corresponds to a uniform prior.\n    alpha = 1.0\n    beta = 1.0\n\n    def calculate_ln_B21_for_locus(k1, m1, k2, m2, a, b):\n        \"\"\"\n        Calculates the natural logarithm of the Bayes Factor B_21 for a single locus.\n        B_21 = P(Data|H2) / P(Data|H1)\n        \"\"\"\n        # Calculate log of Beta function, ln B(x, y) = gammaln(x) + gammaln(y) - gammaln(x+y)\n\n        # Numerator of B_21: Product of Beta functions for H2 (two independent species)\n        # ln( B(k1+a, m1-k1+b) * B(k2+a, m2-k2+b) )\n        ln_num = (gammaln(k1 + a) + gammaln(m1 - k1 + b) - gammaln(m1 + a + b)) + \\\n                 (gammaln(k2 + a) + gammaln(m2 - k2 + b) - gammaln(m2 + a + b))\n\n        # Denominator of B_21: Product of Beta functions for H1 (one species, pooled data)\n        # ln( B(a,b) * B(k1+k2+a, m1+m2-k1-k2+b) )\n        k_tot = k1 + k2\n        m_tot = m1 + m2\n        ln_den = (gammaln(a) + gammaln(b) - gammaln(a + b)) + \\\n                 (gammaln(k_tot + a) + gammaln(m_tot - k_tot + b) - gammaln(m_tot + a + b))\n        \n        # ln(B_21) = ln(numerator) - ln(denominator)\n        ln_B21 = ln_num - ln_den\n        return ln_B21\n\n    results = []\n    for case_loci in test_cases:\n        total_ln_B21 = 0.0\n        for locus in case_loci:\n            k1, m1, k2, m2 = locus\n            total_ln_B21 += calculate_ln_B21_for_locus(k1, m1, k2, m2, alpha, beta)\n        \n        # Convert total natural log Bayes Factor to log base 10\n        log10_B21 = total_ln_B21 / np.log(10)\n        \n        # Format the result to 6 decimal places\n        results.append(f\"{log10_B21:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2580969"}, {"introduction": "群落并非物种的随机组合，而是由复杂的相互作用网络所构成，其中异速生长关系（allometry）——即生物学特性与身体质量的标度关系——起着基础性作用。本练习将引导您从第一性原理出发，基于生物体的身体质量构建一个营养网络，并评估其动态稳定性 [@problem_id:2580979]。通过这个过程，您将深刻理解个体层面的特征（如身体质量 $M_i$）如何决定群落层面的结构和功能（如稳定性 $\\lambda_{\\max}$）这些涌现属性。", "problem": "您的任务是形式化一个异速生长营养网络，并评估一个由广义洛特卡-沃尔泰拉动力学控制的群落的可行平衡点的局部稳定性。请根据下文给出的第一性原理构建所有内容，并实现一个程序来计算群落雅可比矩阵的主导实部特征值，并对几个测试用例给出布尔值的稳定性判定。\n\n基本基础：\n- 广义洛特卡-沃尔泰拉（GLV）种群动力学：对于每个物种指数 $i \\in \\{1,\\dots,S\\}$，其丰度为 $x_i(t)$，动力学方程为\n$$\n\\frac{d x_i}{d t} \\;=\\; x_i \\left( r_i + \\sum_{j=1}^{S} a_{ij} x_j \\right).\n$$\n- 一个可行平衡点 $(x_1^\\ast,\\dots,x_S^\\ast)$（其中 $x_i^\\ast > 0$）的局部稳定性要求该平衡点处的雅可比矩阵的所有特征值都具有严格为负的实部。\n- GLV系统在可行平衡点处的雅可比矩阵满足\n$$\nJ \\;=\\; \\mathrm{diag}(x^\\ast) \\, A,\n$$\n因为在平衡点处，对每个 $i$ 都有 $r_i + \\sum_{j} a_{ij} x_j^\\ast = 0$，因此对所有 $i,j$ 都有 $J_{ij} = x_i^\\ast a_{ij}$。\n\n相互作用矩阵的异速生长构建：\n- 给定物种 $i \\in \\{1,\\dots,S\\}$ 的体重 $M_i$（单位为千克）。通过体重比规则定义一个有向的营养邻接矩阵 $L_{ij} \\in \\{0,1\\}$\n$$\nL_{ij} \\;=\\; \\begin{cases}\n1, & \\text{若 } i \\neq j \\text{ 且 } \\dfrac{M_i}{M_j} \\ge \\theta,\\\\\n0, & \\text{否则,}\n\\end{cases}\n$$\n意味着物种 $i$ 捕食物种 $j$ 当且仅当满足体重比阈值 $\\theta$。\n- 设 $b_0 > 0$ 为基础相互作用尺度，$\\alpha \\in \\mathbb{R}$ 为异速生长指数，$e \\in (0,1]$ 为生物量转换效率。对于每个消费者-资源链接（$L_{ij}=1$ 且比率为 $R_{ij} = M_i/M_j$），定义人均效应大小\n$$\nb_{ij} \\;=\\; b_0 \\, R_{ij}^{\\alpha}.\n$$\n- 组装具有捕食-被捕食符号结构的相互作用矩阵 $A \\in \\mathbb{R}^{S \\times S}$：\n$$\na_{ij} \\;=\\; \\begin{cases}\n+ e \\, b_{ij}, & \\text{若 } L_{ij}=1 \\text{（被捕食者 } j \\text{ 对捕食者 } i \\text{ 的效应）},\\\\\n- b_{ji}, & \\text{若 } L_{ji}=1 \\text{（捕食者 } j \\text{ 对被捕食者 } i \\text{ 的效应）},\\\\\n0, & \\text{否则,}\n\\end{cases}\n$$\n以及种内自我调节\n$$\na_{ii} \\;=\\; - s,\n$$\n对于给定的 $s > 0$（在本问题中假设所有物种相同）。\n\n平衡点的异速生长锚定：\n- 假设一个由达穆斯定律（Damuth’s law）启示的可行平衡丰度标度关系：对于常数 $c>0$ 和 $\\beta>0$，\n$$\nx_i^\\ast \\;=\\; c \\, M_i^{-\\beta}.\n$$\n- 通过在 $x^\\ast$ 处强制可行性来定义内禀增长率 $r \\in \\mathbb{R}^S$：设\n$$\nr \\;=\\; - A \\, x^\\ast,\n$$\n这样，$x^\\ast$ 通过构造即成为GLV系统的一个平衡点。\n\n稳定性目标：\n- 计算 $J = \\mathrm{diag}(x^\\ast) A$，然后计算 $J$ 的谱。设 $\\lambda_{\\max}$ 表示 $J$ 的所有特征值中的最大实部。当且仅当 $\\lambda_{\\max} < 0$ 时，该平衡点是局部渐近稳定的。\n\n算法任务：\n- 对于以下每个测试用例，构建 $L$，然后是 $A$，然后是 $x^\\ast$，然后是 $r$，然后是 $J$，最后计算 $\\lambda_{\\max}$ 和布尔稳定性判定 $S$。$S$ 的定义为：如果 $\\lambda_{\\max} < -\\varepsilon$，则 $S=\\text{True}$，否则 $S=\\text{False}$，其中 $\\varepsilon = 10^{-9}$ 是一个严格的数值容差。\n- 为每个用例报告序对 $[S, \\lambda_{\\max}]$，其中 $\\lambda_{\\max}$ 四舍五入到 $6$ 位小数。\n\n物理和数值单位：\n- 输入的体重 $M_i$ 单位为千克。输出量无需物理单位。\n\n角度单位：\n- 不涉及角度。\n\n输出格式：\n- 您的程序应生成单行输出，包含一个顶级列表，其长度等于测试用例的数量。每个元素必须是一个双元素列表 $[S_i,\\lambda_i]$，其中 $S_i$ 是一个布尔值，$\\lambda_i$ 是一个四舍五入到 $6$ 位小数的浮点数。例如：$[[\\text{True},-0.123456],[\\text{False},0.010000]]$。\n\n测试套件：\n使用以下四个测试用例。每个用例提供 $S$、千克为单位的质量 $\\{M_i\\}_{i=1}^S$以及参数 $(\\theta, b_0, \\alpha, e, s, c, \\beta)$。\n\n- 用例 $1$（基线食物链，中等耦合）：\n  - $S = 4$\n  - $M = [\\,0.01,\\,0.1,\\,1,\\,10\\,]$\n  - $\\theta = 10$, $b_0 = 0.05$, $\\alpha = 0.25$, $e = 0.2$, $s = 1.0$, $c = 1000$, $\\beta = 0.75$\n- 用例 $2$（相同拓扑结构下更强的耦合）：\n  - $S = 4$\n  - $M = [\\,0.01,\\,0.1,\\,1,\\,10\\,]$\n  - $\\theta = 10$, $b_0 = 0.5$, $\\alpha = 0.25$, $e = 0.2$, $s = 1.0$, $c = 1000$, $\\beta = 0.75$\n- 用例 $3$（通过更高阈值实现的更稀疏的营养链接）：\n  - $S = 4$\n  - $M = [\\,0.01,\\,0.1,\\,1,\\,10\\,]$\n  - $\\theta = 100$, $b_0 = 0.5$, $\\alpha = 0.25$, $e = 0.2$, $s = 1.0$, $c = 1000$, $\\beta = 0.75$\n- 用例 $4$（更宽的质量谱，修改了指数和自我调节）：\n  - $S = 5$\n  - $M = [\\,0.002,\\,0.02,\\,0.2,\\,2,\\,20\\,]$\n  - $\\theta = 10$, $b_0 = 0.2$, $\\alpha = 0.5$, $e = 0.3$, $s = 1.2$, $c = 800$, $\\beta = 0.75$\n\n程序必须严格按照所述方式实现构建过程，并输出单行结果，其格式为列表 $[[S_1,\\lambda_1], [S_2,\\lambda_2], [S_3,\\lambda_3], [S_4,\\lambda_4]]$，其中每个 $\\lambda_i$ 四舍五入到 $6$ 位小数。", "solution": "问题陈述已经过验证。\n\n已知条件提取如下：\n1.  **系统动力学**：广义洛特卡-沃尔泰拉（GLV）方程描述了 $S$ 个物种的种群动力学，其丰度为 $x_i(t)$：\n    $$ \\frac{d x_i}{d t} = x_i \\left( r_i + \\sum_{j=1}^{S} a_{ij} x_j \\right) $$\n    对于每个物种 $i \\in \\{1, \\dots, S\\}$。\n2.  **平衡点与稳定性**：一个所有 $x_i^\\ast > 0$ 的平衡点 $x^\\ast = (x_1^\\ast, \\dots, x_S^\\ast)$ 是局部渐近稳定的，如果评估于 $x^\\ast$ 处的雅可比矩阵 $J$ 的所有特征值都具有严格为负的实部。\n3.  **雅可比矩阵**：在可行平衡点处，雅可比矩阵由 $J = \\mathrm{diag}(x^\\ast) A$ 给出，其中 $A$ 是相互作用矩阵。这是由平衡条件 $r_i + \\sum_{j=1}^{S} a_{ij} x_j^\\ast = 0$ 推导出来的。\n4.  **营养网络结构**：使用体重 $M_i$ 和阈值 $\\theta$ 定义一个有向邻接矩阵 $L \\in \\{0, 1\\}^{S \\times S}$：\n    $$ L_{ij} = \\begin{cases} 1, & \\text{若 } i \\neq j \\text{ 且 } \\frac{M_i}{M_j} \\ge \\theta \\\\ 0, & \\text{否则} \\end{cases} $$\n5.  **相互作用矩阵的构建**：\n    -   对于一个链接 $L_{ij}=1$，人均相互作用大小为 $b_{ij} = b_0 (M_i/M_j)^{\\alpha}$，其中 $b_0 > 0$ 且 $\\alpha \\in \\mathbb{R}$。\n    -   相互作用矩阵 $A \\in \\mathbb{R}^{S \\times S}$ 定义如下：\n        $$ a_{ij} = \\begin{cases} + e \\, b_{ij}, & \\text{若 } L_{ij}=1 \\\\ - b_{ji}, & \\text{若 } L_{ji}=1 \\\\ 0, & \\text{否则} \\end{cases} \\quad \\text{对于 } i \\neq j $$\n        以及种内竞争 $a_{ii} = -s$，对于给定的 $s > 0$。参数 $e \\in (0,1]$ 是生物量转换效率。\n6.  **平衡丰度**：假设可行平衡点 $x^\\ast$ 遵循异速生长标度律：\n    $$ x_i^\\ast = c \\, M_i^{-\\beta} $$\n    对于常数 $c > 0$ 和 $\\beta > 0$。内禀增长率被设置为 $r = -A x^\\ast$ 以确保 $x^\\ast$ 是一个平衡点。\n7.  **计算目标**：\n    -   计算雅可比矩阵 $J = \\mathrm{diag}(x^\\ast) A$。\n    -   确定 $J$ 的特征值的最大实部，记为 $\\lambda_{\\max}$。\n    -   稳定性判定 $S$ 为 $\\text{True}$ 如果 $\\lambda_{\\max} < -\\varepsilon$，否则为 $\\text{False}$，数值容差为 $\\varepsilon = 10^{-9}$。\n    -   为每个测试用例报告序对 $[S, \\lambda_{\\max}]$，其中 $\\lambda_{\\max}$ 四舍五入到 $6$ 位小数。\n8.  **测试用例**：提供了四个不同的测试用例，指定了所有必要参数 $(S, \\{M_i\\}, \\theta, b_0, \\alpha, e, s, c, \\beta)$。\n\n验证表明，该问题具有科学依据，定义明确且目标清晰。它基于理论生态学（洛特卡-沃尔泰拉动力学，异速生长标度）和动力系统理论（局部稳定性分析）的既定原则。该问题提供了一套完整、明确、自洽的指令和参数，构成一个定义明确的计算任务。未检测到科学、逻辑或数学上的缺陷。因此，该问题被认定为**有效**。\n\n求解过程按照规定，逐步构建所需的数学对象。\n\n该过程从每个测试用例给定的体重 $\\{M_i\\}_{i=1}^S$ 和参数开始。\n\n首先，我们构建营养邻接矩阵 $L$。对于每一对不同的物种 $(i, j)$，我们计算质量比 $R_{ij} = M_i/M_j$。如果 $R_{ij} \\ge \\theta$，则物种 $i$ 捕食物种 $j$，我们设置矩阵元素 $L_{ij} = 1$。否则，$L_{ij} = 0$。条件 $i \\neq j$ 确保没有自我消费。对于给定的测试集，其中所有质量都是不同的且 $\\theta > 1$，对于任何一对 $(i, j)$，$L_{ij}=1$ 和 $L_{ji}=1$ 不可能同时成立。\n\n其次，我们构建群落相互作用矩阵 $A \\in \\mathbb{R}^{S \\times S}$。对角线元素被设置为表示种内竞争：$a_{ii} = -s$。对于非对角线元素，我们首先计算存在营养链接（$L_{ij} = 1$）的所有物种对 $(i, j)$ 的人均相互作用大小 $b_{ij} = b_0 R_{ij}^{\\alpha}$。然后根据捕食-被捕食动力学填充 $A$ 的元素：\n-   若 $L_{ij} = 1$（物种 $i$ 吃物种 $j$），则被捕食者 $j$ 对捕食者 $i$ 的影响是正的：$a_{ij} = +e \\cdot b_{ij}$。\n-   反之，捕食者 $i$ 对被捕食者 $j$ 的影响是负的。这对应于元素 $a_{ji}$，其相关的营养链接是 $L_{ij}=1$。问题陈述指出 $a_{ij} = -b_{ji}$ 如果 $L_{ji}=1$。因此，对于一对 $(i, j)$，其中 $i$ 吃 $j$，我们有 $a_{ij} = e b_{ij}$ 和 $a_{ji} = -b_{ij}$。\n\n第三，我们确定平衡丰度向量 $x^\\ast$。这直接从异速生长标度律 $x_i^\\ast = c M_i^{-\\beta}$ 计算得出，对每个物种 $i$ 都适用。\n\n第四，我们构建系统在平衡点 $x^\\ast$ 处的雅可比矩阵 $J$。按照规定，$J = \\mathrm{diag}(x^\\ast) A$。因此，雅可比矩阵的第 $(i, j)$ 个元素是 $J_{ij} = x_i^\\ast a_{ij}$。对角线元素是 $J_{ii} = x_i^\\ast a_{ii} = -s x_i^\\ast$。非对角线元素是 $J_{ij} = x_i^\\ast a_{ij}$ 对于 $i \\neq j$。\n\n最后，我们进行稳定性分析。我们计算矩阵 $J$ 的特征值集合 $\\{\\lambda_k\\}_{k=1}^S$。平衡点的局部稳定性由这些特征值的最大实部 $\\lambda_{\\max} = \\max_k \\{ \\mathrm{Re}(\\lambda_k) \\}$ 的符号决定。当且仅当 $\\lambda_{\\max} < 0$ 时，平衡点是局部渐近稳定的。我们应用提供的严格数值标准：如果 $\\lambda_{\\max} < -10^{-9}$，则稳定性判定 $S$ 为 $\\text{True}$，否则为 $\\text{False}$。\n\n此过程将应用于四个测试用例中的每一个，以获得最终结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the stability of allometric trophic networks for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"case_id\": 1,\n            \"S\": 4,\n            \"M\": np.array([0.01, 0.1, 1, 10]),\n            \"params\": {\"theta\": 10.0, \"b0\": 0.05, \"alpha\": 0.25, \"e\": 0.2, \"s\": 1.0, \"c\": 1000.0, \"beta\": 0.75}\n        },\n        {\n            \"case_id\": 2,\n            \"S\": 4,\n            \"M\": np.array([0.01, 0.1, 1, 10]),\n            \"params\": {\"theta\": 10.0, \"b0\": 0.5, \"alpha\": 0.25, \"e\": 0.2, \"s\": 1.0, \"c\": 1000.0, \"beta\": 0.75}\n        },\n        {\n            \"case_id\": 3,\n            \"S\": 4,\n            \"M\": np.array([0.01, 0.1, 1, 10]),\n            \"params\": {\"theta\": 100.0, \"b0\": 0.5, \"alpha\": 0.25, \"e\": 0.2, \"s\": 1.0, \"c\": 1000.0, \"beta\": 0.75}\n        },\n        {\n            \"case_id\": 4,\n            \"S\": 5,\n            \"M\": np.array([0.002, 0.02, 0.2, 2, 20]),\n            \"params\": {\"theta\": 10.0, \"b0\": 0.2, \"alpha\": 0.5, \"e\": 0.3, \"s\": 1.2, \"c\": 800.0, \"beta\": 0.75}\n        }\n    ]\n\n    results = []\n    epsilon = 1e-9\n\n    for case in test_cases:\n        S = case[\"S\"]\n        M = case[\"M\"]\n        p = case[\"params\"]\n        \n        # Step 1: Construct trophic adjacency matrix L\n        # R_ij = M_i / M_j. Using numpy broadcasting for efficiency.\n        R = M[:, np.newaxis] / M\n        L = (R >= p[\"theta\"]).astype(float)\n        np.fill_diagonal(L, 0) # Enforce i != j\n\n        # Step 2: Construct interaction matrix A\n        A = np.zeros((S, S))\n        \n        # Calculate per-capita interaction magnitudes b_ij\n        b = p[\"b0\"] * (R ** p[\"alpha\"])\n        \n        # Populate off-diagonal elements of A based on L\n        # a_ij = +e * b_ij for predator i on prey j (L_ij = 1)\n        # a_ji = -b_ij for predator i on prey j (L_ij = 1)\n        # We can vectorize this: A_predator_gain = e * (b * L)\n        # A_prey_loss = -(b * L).T\n        A = p[\"e\"] * (b * L) - (b * L).T\n\n        # Set diagonal elements for intraspecific self-regulation\n        np.fill_diagonal(A, -p[\"s\"])\n\n        # Step 3: Construct equilibrium abundance vector x*\n        x_star = p[\"c\"] * (M ** -p[\"beta\"])\n\n        # Step 4: Construct the Jacobian matrix J = diag(x*) @ A\n        J = np.diag(x_star) @ A\n        \n        # Step 5: Compute eigenvalues and determine stability\n        eigenvalues = np.linalg.eigvals(J)\n        lambda_max = np.max(np.real(eigenvalues))\n        \n        is_stable = lambda_max  -epsilon\n        \n        results.append([is_stable, round(lambda_max, 6)])\n\n    # Format output as a single string\n    output_str = \"[\" + \",\".join([f\"[{str(r[0]).lower()},{r[1]:.6f}]\" for r in results]) + \"]\"\n    print(output_str)\n\nsolve()\n```", "id": "2580979"}, {"introduction": "在景观尺度上，生物多样性呈现出规律性的宏观生态学模式，其中物种-面积关系（Species-Area Relationship, SAR）——$S = c A^{z}$——是最普适的定律之一。本练习不仅要求您拟合这一经典模型，更关键的是比较不同分类群（植物与鸟类）的标度指数 $z$ 是否存在差异 [@problem_id:2581017]。这种比较将促使您深入思考，是何种潜在的生物学过程（如扩散能力和生境特化）塑造了我们在大尺度上观察到的生物多样性格局。", "problem": "在比较动物学和植物学中，生物圈的等级组织结构意味着物种丰富度从局域种群、群落逐级汇聚，直至群岛。将群落层面的丰富度与空间尺度联系起来的一个被广泛观察到的宏观生态学规律是物种-面积关系，此处假设其遵循幂律 $S = c A^{z}$。其中，$S$ 是物种丰富度，$A$ 是岛屿面积，$c$ 是一个与分类单元和区域相关的常数，$z$ 是面积定标指数，它概括了在整个岛屿等级系统中扩散限制和生境特化的影响。考虑一个群岛，其中对两个分类单元（维管植物和陆生鸟类）分别在 $6$ 个岛屿上测量了面积的自然对数 $x = \\ln(A)$ 和物种丰富度的自然对数 $y = \\ln(S)$。对于每个分类单元，需要在线性模型 $y = \\alpha + z x + \\varepsilon$ 下，对 $y$ 关于 $x$ 进行独立的普通最小二乘（OLS）回归拟合。其中，$\\varepsilon$ 是每个分类单元内部独立的、均值为零、同方差的正态分布误差。\n\n原始数据已被简化为两个组的中心化平方和与叉积和（所有量都是在用各组特定的均值对 $x$ 和 $y$ 进行中心化后计算得出的）：\n- 植物：$n_{p} = 6$，$S_{xx,p} = 20.0$，$S_{xy,p} = 5.8$，$S_{yy,p} = 1.762$。\n- 鸟类：$n_{b} = 6$，$S_{xx,b} = 20.0$，$S_{xy,b} = 3.8$，$S_{yy,b} = 0.802$。\n\n假设分类单元间的误差方差相等。仅使用这些摘要统计量，分别为植物和鸟类拟合双对数物种-面积关系，以估计指数 $z_{p}$ 和 $z_{b}$。然后，通过计算原假设 $H_{0}: z_{p} - z_{b} = 0$ 相对于双侧备择假设的 $t$-统计量，来检验这两个指数是否存在差异。在计算中，请使用合并了两个回归的 OLS 残差方差，以及由独立拟合所决定的常规自由度。\n\n以无单位的纯数形式报告 $t$-统计量的值，并四舍五入到四位有效数字。", "solution": "所陈述的问题在科学上是合理的，在计算上是可行的。它借鉴了宏观生态学的既定原则——特别是物种-面积关系——并在线性回归的背景下，采用了用于参数估计和假设检验的标准统计方法。所有必要的摘要统计量均已提供，目标明确，且没有内部矛盾。因此，该问题是有效的，并将提供解答。\n\n该问题要求对原假设 $H_{0}: z_{p} - z_{b} = 0$ 与双侧备择假设 $H_{A}: z_{p} - z_{b} \\neq 0$ 进行统计检验，其中 $z_{p}$ 和 $z_{b}$ 分别是植物和鸟类的真实定标指数。这是一个检验来自两个独立线性回归的两个回归系数之间差异的检验。\n\n物种-面积关系由幂律 $S = c A^{z}$ 给出。对两边取自然对数可将模型线性化：\n$$ \\ln(S) = \\ln(c) + z \\ln(A) $$\n这对应于线性回归模型 $y = \\alpha + z x + \\varepsilon$，其中 $y = \\ln(S)$，$x = \\ln(A)$，$\\alpha = \\ln(c)$，$\\varepsilon$是误差项。\n\n斜率系数 $z$ 的普通最小二乘（OLS）估计量由下式给出：\n$$ \\hat{z} = \\frac{S_{xy}}{S_{xx}} $$\n其中 $S_{xy} = \\sum_{i=1}^{n} (x_i - \\bar{x})(y_i - \\bar{y})$ 且 $S_{xx} = \\sum_{i=1}^{n} (x_i - \\bar{x})^2$。\n\n首先，我们使用提供的摘要统计量来估计植物（$\\hat{z}_{p}$）和鸟类（$\\hat{z}_{b}$）的斜率系数。\n对于植物：\n$$ \\hat{z}_{p} = \\frac{S_{xy,p}}{S_{xx,p}} = \\frac{5.8}{20.0} = 0.29 $$\n对于鸟类：\n$$ \\hat{z}_{b} = \\frac{S_{xy,b}}{S_{xx,b}} = \\frac{3.8}{20.0} = 0.19 $$\n\n用于检验两个独立回归系数之间差异的 $t$-统计量为：\n$$ t = \\frac{(\\hat{z}_{p} - \\hat{z}_{b}) - (z_{p} - z_{b})_{0}}{\\text{SE}(\\hat{z}_{p} - \\hat{z}_{b})} $$\n在原假设 $H_{0}$ 下，期望差异 $(z_{p} - z_{b})_{0}$ 为 $0$。差异的标准误 $\\text{SE}(\\hat{z}_{p} - \\hat{z}_{b})$ 是从各个估计量的方差推导出来的。由于两个回归是独立的，差异的方差是方差之和：\n$$ \\text{Var}(\\hat{z}_{p} - \\hat{z}_{b}) = \\text{Var}(\\hat{z}_{p}) + \\text{Var}(\\hat{z}_{b}) $$\n斜率估计量 $\\hat{z}$ 的方差为 $\\text{Var}(\\hat{z}) = \\frac{\\sigma^2}{S_{xx}}$。题目要求假设两个分类单元的误差方差相等，即 $\\sigma_{p}^2 = \\sigma_{b}^2 = \\sigma^2$。我们必须使用一个合并估计量 $s_{pool}^2$ 来估计这个公共方差。差异的标准误则为：\n$$ \\text{SE}(\\hat{z}_{p} - \\hat{z}_{b}) = \\sqrt{s_{pool}^2 \\left( \\frac{1}{S_{xx,p}} + \\frac{1}{S_{xx,b}} \\right)} $$\n合并方差 $s_{pool}^2$ 的计算方法是：将每个回归的残差平方和 ($RSS$)相加，然后除以它们各自自由度 ($df$) 的总和。对于一个有 $n$ 个观测值的简单线性回归，残差的自由度为 $df = n-2$。单个回归的 $RSS$ 由 $RSS = S_{yy} - \\frac{S_{xy}^2}{S_{xx}}$ 给出。\n\n我们为每个分类单元计算 $RSS$：\n对于植物：\n$$ RSS_{p} = S_{yy,p} - \\frac{(S_{xy,p})^2}{S_{xx,p}} = 1.762 - \\frac{(5.8)^2}{20.0} = 1.762 - \\frac{33.64}{20.0} = 1.762 - 1.682 = 0.08 $$\n植物的自由度是 $df_{p} = n_{p} - 2 = 6-2=4$。\n\n对于鸟类：\n$$ RSS_{b} = S_{yy,b} - \\frac{(S_{xy,b})^2}{S_{xx,b}} = 0.802 - \\frac{(3.8)^2}{20.0} = 0.802 - \\frac{14.44}{20.0} = 0.802 - 0.722 = 0.08 $$\n鸟类的自由度是 $df_{b} = n_{b} - 2 = 6-2=4$。\n\n现在，我们计算合并方差 $s_{pool}^2$：\n$$ s_{pool}^2 = \\frac{RSS_{p} + RSS_{b}}{df_{p} + df_{b}} = \\frac{0.08 + 0.08}{4 + 4} = \\frac{0.16}{8} = 0.02 $$\n有了合并方差，我们就可以计算差异的标准误：\n$$ \\text{SE}(\\hat{z}_{p} - \\hat{z}_{b}) = \\sqrt{0.02 \\left( \\frac{1}{20.0} + \\frac{1}{20.0} \\right)} = \\sqrt{0.02 \\left( \\frac{2}{20.0} \\right)} = \\sqrt{0.02 \\times 0.1} = \\sqrt{0.002} $$\n最后，我们计算 $t$-统计量：\n$$ t = \\frac{\\hat{z}_{p} - \\hat{z}_{b}}{\\text{SE}(\\hat{z}_{p} - \\hat{z}_{b})} = \\frac{0.29 - 0.19}{\\sqrt{0.002}} = \\frac{0.10}{\\sqrt{0.002}} $$\n计算数值：\n$$ t \\approx \\frac{0.10}{0.04472135955} \\approx 2.236067977 $$\n根据题目要求，四舍五入到四位有效数字，我们得到 $t = 2.236$。这个统计量将与自由度为 $df_{p} + df_{b} = 8$ 的 $t$-分布的临界值进行比较，以确定统计显著性。然而，问题只要求提供统计量本身的值。", "answer": "$$\n\\boxed{2.236}\n$$", "id": "2581017"}]}