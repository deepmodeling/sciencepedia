{"hands_on_practices": [{"introduction": "在研究进化机制时，首先要掌握如何判断一个群体是否处于非进化状态。哈代-温伯格平衡（Hardy-Weinberg Equilibrium, HWE）为此提供了一个关键的零假设。本练习将引导你运用群体遗传学的基础统计方法，从观测到的基因型数据出发，计算等位基因频率，并使用卡方检验（$\\chi^2$ test）来评估群体是否偏离哈代-温伯格平衡的预期，这是将理论模型与经验数据相连接的一项基本技能 [@problem_id:2588582]。", "problem": "对一个复合种群中存在持续基因流的单一目标种群进行抽样，对样本中的一个二倍体、异交、风媒被子植物的双等位基因、共显性核基因座 $\\mathcal{L}$（等位基因为 $A$ 和 $a$）进行了基因分型。在一个包含 $N=84$ 个个体的随机样本中，观察到的基因型计数为 $n_{AA}=59$，$n_{Aa}=23$，$n_{aa}=2$。假设不存在无效等位基因，没有基因分型错误，且该种群可以进行哈迪-温伯格平衡 (HWE) 评估。\n\n仅从等位基因频率、HWE下的基因型频率以及Pearson卡方拟合优度检验框架的核心定义出发，完成以下任务：\n- 计算 $A$ 和 $a$ 的样本等位基因频率。\n- 使用这些等位基因频率，写出预期的HWE基因型比例和相应的预期基因型计数。\n- 为了用一个自由度检验HWE，将两个纯合子类别合并为一个“纯合子”类别，并比较“杂合子”与“纯合子”。计算适用于具有估计期望值的两分类拟合优度评估的Yates连续性校正卡方检验统计量。\n\n仅报告Yates连续性校正卡方检验统计量的值。将答案四舍五入至四位有效数字。不要报告中间值。最终答案无需单位。", "solution": "对问题陈述进行验证。\n\n**第一步：提取已知条件**\n-   基因座类型：双等位基因、共显性核基因座 $\\mathcal{L}$，等位基因为 $A$ 和 $a$。\n-   抽样生物体：二倍体、异交、风媒被子植物。\n-   种群背景：一个复合种群中正在经历基因流的单一目标种群。\n-   样本大小：$N = 84$ 个个体。\n-   观测基因型计数：$n_{AA} = 59$，$n_{Aa} = 23$，$n_{aa} = 2$。\n-   假设：无无效等位基因，无基因分型错误。\n-   任务：评估哈迪-温伯格平衡（HWE）。\n-   指定方法：\n    1.  计算 $A$ 和 $a$ 的样本等位基因频率。\n    2.  从这些等位基因频率计算预期的HWE基因型比例和计数。\n    3.  将纯合子类别（$AA$ 和 $aa$）合并为一个“纯合子”类别，与“杂合子”类别进行比较。\n    4.  计算适用于自由度为1的两分类拟合优度检验的Yates连续性校正卡方检验统计量。\n-   输出要求：报告Yates连续性校正卡方统计量的最终值，四舍五入至四位有效数字。\n\n**第二步：使用提取的已知条件进行验证**\n该问题具有科学依据，采用了群体遗传学的标准概念和方法，即等位基因和基因型频率计算、哈迪-温伯格原理以及Pearson卡方拟合优度检验。数据是自洽且一致的，因为基因型计数之和等于总样本大小（$59 + 23 + 2 = 84$）。语言客观、精确。关于合并类别和应用Yates校正的说明使得问题定义明确，能够导出一个唯一的解。情景在生物学上是现实的。问题有效。\n\n**第三步：结论与行动**\n问题有效。将推导解答过程。\n\n解答过程遵循指定的方法。\n\n首先，我们根据样本基因型计数计算等位基因 $A$ 和 $a$ 的频率。设 $p$ 为等位基因 $A$ 的频率，$q$ 为等位基因 $a$ 的频率。$N$ 个二倍体个体的样本中等位基因的总数为 $2N$。\n\n$A$ 等位基因的总数由 $2n_{AA} + n_{Aa}$ 给出。$a$ 等位基因的总数由 $2n_{aa} + n_{Aa}$ 给出。\n总样本大小为 $N = n_{AA} + n_{Aa} + n_{aa} = 59 + 23 + 2 = 84$。\n等位基因总数为 $2N = 2 \\times 84 = 168$。\n\n等位基因 $A$ 的频率，记为 $p$，是：\n$$p = \\frac{2n_{AA} + n_{Aa}}{2N} = \\frac{2(59) + 23}{168} = \\frac{118 + 23}{168} = \\frac{141}{168}$$\n等位基因 $a$ 的频率，记为 $q$，是：\n$$q = \\frac{2n_{aa} + n_{Aa}}{2N} = \\frac{2(2) + 23}{168} = \\frac{4 + 23}{168} = \\frac{27}{168}$$\n作为检验，$p + q = \\frac{141}{168} + \\frac{27}{168} = \\frac{168}{168} = 1$。频率计算正确。为了计算，我们简化这些分数：$p = \\frac{47}{56}$ 和 $q = \\frac{9}{56}$。\n\n接下来，我们为指定的两个类别“纯合子”和“杂合子”确定观测计数和预期计数。\n\n纯合子的观测计数是基因型 $AA$ 和 $aa$ 的计数之和：\n$$O_{hom} = n_{AA} + n_{aa} = 59 + 2 = 61$$\n杂合子的观测计数是基因型 $Aa$ 的计数：\n$$O_{het} = n_{Aa} = 23$$\n观测计数之和为 $O_{hom} + O_{het} = 61 + 23 = 84$，即总样本大小 $N$。\n\n在哈迪-温伯格平衡的假设下，纯合子和杂合子类别的预期频率分别为 $p^2 + q^2$ 和 $2pq$。预期计数是这些频率乘以总样本大小 $N$。\n\n纯合子的预期计数是：\n$$E_{hom} = N(p^2 + q^2) = 84 \\left( \\left(\\frac{47}{56}\\right)^2 + \\left(\\frac{9}{56}\\right)^2 \\right) = 84 \\left( \\frac{2209}{3136} + \\frac{81}{3136} \\right) = 84 \\left( \\frac{2290}{3136} \\right)$$\n因为 $3136 = 56^2$ 且 $84 = 1.5 \\times 56$，我们有：\n$$E_{hom} = \\frac{84 \\times 2290}{56 \\times 56} = \\frac{1.5 \\times 2290}{56} = \\frac{3435}{56}$$\n\n杂合子的预期计数是：\n$$E_{het} = N(2pq) = 84 \\left( 2 \\cdot \\frac{47}{56} \\cdot \\frac{9}{56} \\right) = 84 \\left( \\frac{846}{3136} \\right)$$\n$$E_{het} = \\frac{84 \\times 846}{56 \\times 56} = \\frac{1.5 \\times 846}{56} = \\frac{1269}{56}$$\n作为检验，$E_{hom} + E_{het} = \\frac{3435}{56} + \\frac{1269}{56} = \\frac{4704}{56} = 84 = N$。预期计数正确。\n\n最后，我们计算这两个类别的Yates连续性校正卡方统计量（$\\chi^2_{Yates}$）。公式为：\n$$\\chi^2_{Yates} = \\sum_{i} \\frac{(|O_i - E_i| - 0.5)^2}{E_i}$$\n对于我们的两个类别，即为：\n$$\\chi^2_{Yates} = \\frac{(|O_{hom} - E_{hom}| - 0.5)^2}{E_{hom}} + \\frac{(|O_{het} - E_{het}| - 0.5)^2}{E_{het}}$$\n我们计算差值 $|O - E|$：\n$$|O_{hom} - E_{hom}| = \\left| 61 - \\frac{3435}{56} \\right| = \\left| \\frac{61 \\times 56 - 3435}{56} \\right| = \\left| \\frac{3416 - 3435}{56} \\right| = \\left| -\\frac{19}{56} \\right| = \\frac{19}{56}$$\n杂合子类别的差值大小必须相同：\n$$|O_{het} - E_{het}| = \\left| 23 - \\frac{1269}{56} \\right| = \\left| \\frac{23 \\times 56 - 1269}{56} \\right| = \\left| \\frac{1288 - 1269}{56} \\right| = \\left| \\frac{19}{56} \\right| = \\frac{19}{56}$$\n$\\chi^2$ 求和中每一项的分子是 $(|O - E| - 0.5)^2$：\n$$\\left( \\frac{19}{56} - 0.5 \\right)^2 = \\left( \\frac{19}{56} - \\frac{28}{56} \\right)^2 = \\left( -\\frac{9}{56} \\right)^2 = \\frac{81}{3136}$$\n现在我们构建 $\\chi^2$ 统计量：\n$$\\chi^2_{Yates} = \\frac{81/3136}{3435/56} + \\frac{81/3136}{1269/56}$$\n$$\\chi^2_{Yates} = \\frac{81}{3136} \\left( \\frac{56}{3435} + \\frac{56}{1269} \\right) = \\frac{81 \\times 56}{3136} \\left( \\frac{1}{3435} + \\frac{1}{1269} \\right)$$\n因为 $3136 = 56^2$：\n$$\\chi^2_{Yates} = \\frac{81}{56} \\left( \\frac{1269 + 3435}{3435 \\times 1269} \\right) = \\frac{81}{56} \\left( \\frac{4704}{4359015} \\right)$$\n注意到 $4704 = 84 \\times 56$：\n$$\\chi^2_{Yates} = \\frac{81}{56} \\frac{84 \\times 56}{4359015} = \\frac{81 \\times 84}{4359015} = \\frac{6804}{4359015}$$\n进行除法运算得到数值：\n$$\\chi^2_{Yates} \\approx 0.0015609503$$\n四舍五入到四位有效数字，我们得到 $0.001561$。", "answer": "$$\\boxed{0.001561}$$", "id": "2588582"}, {"introduction": "自然选择是进化的核心驱动力之一，但其作用方式远非一成不变。负频率依赖选择是一种重要的平衡选择形式，其中稀有的等位基因具有适应性优势，从而维持了群体内的遗传多态性。本练习旨在让你从第一性原理出发，构建一个选择强度随等位基因频率变化的动态数学模型，推导出其内部平衡点 $p^*$ 的表达式，并分析其稳定性，这体现了理论生态学与进化生物学中模型构建与分析的核心能力 [@problem_id:2588599]。", "problem": "在一个比较动物学和植物学的背景下，考虑一个单倍体生物中表现出的两种可遗传的替代色型，等位基因 $A$ 和等位基因 $a$。假设选择源于负频率依赖性相互作用，这种相互作用在动物猎物与鸟类捕食者之间（搜索图像）以及开花植物与传粉者之间（新奇偏好）具有可比性。具体来说，假设 $A$ 和 $a$ 的绝对赖特适应度（absolute Wrightian fitness）是群体中 $A$ 的当前频率 $p$ 的线性函数：\n$$\nw_{A}(p) \\equiv 1 - \\alpha p, \\quad w_{a}(p) \\equiv 1 - \\beta (1 - p),\n$$\n其中 $\\alpha > 0$ 和 $\\beta > 0$ 是参数，描述了由于相互作用物种的识别或利用，每种色型的适应度随其自身频率增加而下降的强度。假设世代离散且不重叠，单倍体遗传，随机交配（或配子随机结合），无突变，无迁移（无基因流），也无遗传漂变（有效种群大小无限的确定性动态）。令 $p_{t}$ 表示第 $t$ 代时 $A$ 的频率。\n\n仅使用赖特适应度、平均适应度和通过相对适应度将 $p_{t+1}$ 与 $p_{t}$ 联系起来的标准单倍体选择递归式，完成以下任务：\n\n1. 推导 $p_{t+1}$ 作为 $p_{t}$、$w_{A}(p_{t})$ 和 $w_{a}(p_{t})$ 的函数的确定性递归式，并明确写出平均适应度 $\\bar{w}(p_{t})$。\n\n2. 根据“当每个等位基因稀有时其频率都会增加，则出现受保护的多态性”这一定义，推导出现受保护的多态性时 $\\alpha$ 和 $\\beta$ 所需的充分必要条件。\n\n3. 求解内部平衡等位基因频率 $p^* \\in (0,1)$（用 $\\alpha$ 和 $\\beta$ 表示），并根据你推导的确定性动态来证明其局部稳定性。\n\n将你的最终答案表示为稳定内部平衡等位基因频率 $p^*$ 的单个封闭形式代数表达式，不带单位。如果你进行任何近似，它们必须是精确的代数简化；不需要进行数值四舍五入。", "solution": "问题陈述已经过验证，被认定为有效。这是一个适定、有科学依据的理论群体遗传学问题，没有矛盾、歧义或事实错误。它提出了一个标准的负频率依赖性选择模型。我们可以开始求解。\n\n该问题要求对选择作用下单倍体群体中两个等位基因 $A$ 和 $a$ 的动态进行三部分推导。设 $p$ 为等位基因 $A$ 的频率，$1-p$ 为等位基因 $a$ 的频率。绝对赖特适应度被给定为频率依赖的函数：\n$$\nw_{A}(p) = 1 - \\alpha p\n$$\n$$\nw_{a}(p) = 1 - \\beta (1 - p)\n$$\n其中参数 $\\alpha$ 和 $\\beta$ 为正常数，$\\alpha > 0$ 且 $\\beta > 0$。分析假设世代离散，有效种群大小无限，且没有突变和迁移。\n\n1. 推导 $p_{t+1}$ 的递归式。\n\n在单倍体群体中，一个等位基因在下一代（$t+1$）的频率由其在当前代（$t$）的频率和其相对适应度决定。第 $t+1$ 代中等位基因 $A$ 的频率，记为 $p_{t+1}$，是选择后基因库中所有等位基因里 $A$ 等位基因的比例。它等于第 $t$ 代中 $A$ 的频率 $p_t$ 乘以其绝对适应度 $w_{A}(p_{t})$，再除以群体的平均适应度 $\\bar{w}(p_{t})$。\n\n平均适应度 $\\bar{w}(p_{t})$ 是两个等位基因适应度的加权平均值，权重是它们的频率：\n$$\n\\bar{w}(p_{t}) = p_{t} w_{A}(p_{t}) + (1 - p_{t}) w_{a}(p_{t})\n$$\n代入给定的适应度函数：\n$$\n\\bar{w}(p_{t}) = p_{t}(1 - \\alpha p_{t}) + (1 - p_{t})(1 - \\beta (1 - p_{t}))\n$$\n该表达式代表了第 $t$ 代群体中个体的平均适应度。\n\n因此，$p_{t+1}$ 的递归式为：\n$$\np_{t+1} = \\frac{p_{t} w_{A}(p_{t})}{\\bar{w}(p_{t})}\n$$\n代入适应度函数的显式形式，完整的递归式为：\n$$\np_{t+1} = \\frac{p_{t}(1 - \\alpha p_{t})}{p_{t}(1 - \\alpha p_{t}) + (1 - p_{t})(1 - \\beta(1-p_{t}))}\n$$\n这就是所要求的等位基因频率的确定性递归式。\n\n2. 受保护的多态性的条件。\n\n受保护的多态性是指两个等位基因都能在群体中维持的状态，因为每个等位基因在稀有时其频率都能增加。这需要同时满足两个条件：\n(i) 等位基因 $A$ 在稀有时频率必须增加（即当 $p \\to 0$ 时）。\n(ii) 等位基因 $a$ 在稀有时频率必须增加（即当 $p \\to 1$ 时）。\n\n如果携带等位基因 $A$ 的个体比群体平均适应度更高，即 $w_{A}(p) > \\bar{w}(p)$，则 $A$ 的频率将会增加。代入 $\\bar{w}(p)$ 的定义，这等价于 $w_{A}(p) > p w_{A}(p) + (1-p) w_{a}(p)$，可简化为 $w_{A}(p) > w_{a}(p)$（对于 $p \\in [0, 1)$）。\n\n对于条件 (i)，我们在 $p \\to 0$ 时评估此不等式：\n$$\nw_{A}(0) > w_{a}(0)\n$$\n使用给定的适应度函数：\n$$\nw_{A}(0) = 1 - \\alpha(0) = 1\n$$\n$$\nw_{a}(0) = 1 - \\beta(1-0) = 1 - \\beta\n$$\n该条件变为 $1 > 1 - \\beta$，简化为 $\\beta > 0$。\n\n对于条件 (ii)，等位基因 $a$ 在稀有时频率必须增加。这意味着其频率 $1-p$ 在 $1-p \\to 0$ 时必须增加，这等价于 $p \\to 1$。这种情况发生于携带等位基因 $a$ 的个体比群体平均适应度更高，即 $w_{a}(p) > \\bar{w}(p)$，这等价于 $w_{a}(p) > w_{A}(p)$。我们在 $p \\to 1$ 时评估此不等式：\n$$\nw_{a}(1) > w_{A}(1)\n$$\n使用适应度函数：\n$$\nw_{a}(1) = 1 - \\beta(1-1) = 1\n$$\n$$\nw_{A}(1) = 1 - \\alpha(1) = 1 - \\alpha\n$$\n该条件变为 $1 > 1 - \\alpha$，简化为 $\\alpha > 0$。\n\n问题陈述中已给出 $\\alpha > 0$ 和 $\\beta > 0$。然而，对参数空间的完整描述还必须确保模型在生物学上是合理的。绝对适应度不能为负。因此，我们必须对所有 $p \\in [0,1]$ 强制要求 $w_{A}(p) \\ge 0$ 和 $w_{a}(p) \\ge 0$。\n函数 $w_{A}(p) = 1 - \\alpha p$ 随 $p$ 单调递减。其在区间 $[0,1]$ 上的最小值为 $p=1$ 时的 $w_{A}(1) = 1 - \\alpha$。约束条件 $w_{A}(1) \\ge 0$ 意味着 $1 - \\alpha \\ge 0$，即 $\\alpha \\le 1$。\n函数 $w_{a}(p) = 1 - \\beta(1-p)$ 随 $p$ 单调递增。其在 $[0,1]$ 上的最小值为 $p=0$ 时的 $w_{a}(0) = 1 - \\beta$。约束条件 $w_{a}(0) \\ge 0$ 意味着 $1 - \\beta \\ge 0$，即 $\\beta \\le 1$。\n\n因此，对于一个具有生物学意义的受保护的多态性，参数 $\\alpha$ 和 $\\beta$ 的充分必要条件是两个等位基因在稀有时都能入侵（$\\alpha > 0, \\beta > 0$）并且适应度保持非负（$ \\alpha \\le 1, \\beta \\le 1$）。合并后的条件是 $0 < \\alpha \\le 1$ 和 $0 < \\beta \\le 1$。\n\n3. 内部平衡及其稳定性。\n\n平衡频率 $p^*$ 是一个使等位基因频率代代保持不变的 $p$ 值，即 $p_{t+1} = p_{t} = p^*$。频率 $p=0$ 和 $p=1$ 总是平凡平衡点。我们寻求一个内部平衡点，其中 $0 < p^* < 1$。\n对于这样一个平衡点，递归式 $p^* = \\frac{p^* w_{A}(p^*)}{\\bar{w}(p^*)}$ 必须成立。由于 $p^* \\ne 0$，我们可以用它来除，得到 $1 = \\frac{w_{A}(p^*)}{\\bar{w}(p^*)}$，这意味着 $\\bar{w}(p^*) = w_{A}(p^*)$。\n代入 $\\bar{w}(p^*)$ 的定义得到 $p^*w_{A}(p^*) + (1-p^*)w_{a}(p^*) = w_{A}(p^*)$。\n这可以简化为 $(1-p^*)w_{a}(p^*) = (1-p^*)w_{A}(p^*)$。由于 $p^* \\ne 1$，我们可以用 $(1-p^*)$ 来除，得到内部选择平衡的一般条件：\n$$\nw_{A}(p^*) = w_{a}(p^*)\n$$\n在这个频率下，两个等位基因的适应度相等。代入给定的函数：\n$$\n1 - \\alpha p^* = 1 - \\beta(1 - p^*)\n$$\n$$\n-\\alpha p^* = -\\beta(1 - p^*)\n$$\n$$\n\\alpha p^* = \\beta - \\beta p^*\n$$\n$$\n\\alpha p^* + \\beta p^* = \\beta\n$$\n$$\np^*(\\alpha + \\beta) = \\beta\n$$\n由于 $\\alpha > 0$ 和 $\\beta > 0$，$(\\alpha + \\beta)$ 不为零，我们可以解出 $p^*$：\n$$\np^* = \\frac{\\beta}{\\alpha + \\beta}\n$$\n这是唯一的内部平衡频率。对于 $\\alpha > 0$ 和 $\\beta > 0$，显然有 $0 < p^* < 1$。\n\n为了证明该平衡的稳定性，我们考察等位基因频率的变化量 $\\Delta p = p_{t+1} - p_t$。$\\Delta p$ 的符号由 $w_A(p) - w_a(p)$ 的符号决定。让我们分析这个差值：\n$$\ng(p) = w_{A}(p) - w_{a}(p) = (1 - \\alpha p) - (1 - \\beta(1-p)) = \\beta - (\\alpha + \\beta)p\n$$\n如果 $g(p) > 0$，等位基因频率 $p$ 将增加；如果 $g(p) < 0$，则将减少。\n- 如果 $p < p^* = \\frac{\\beta}{\\alpha+\\beta}$，则 $(\\alpha+\\beta)p < \\beta$，所以 $g(p) = \\beta - (\\alpha+\\beta)p > 0$。因此，$p$ 将向 $p^*$ 增加。\n- 如果 $p > p^* = \\frac{\\beta}{\\alpha+\\beta}$，则 $(\\alpha+\\beta)p > \\beta$，所以 $g(p) = \\beta - (\\alpha+\\beta)p < 0$。因此，$p$ 将向 $p^*$ 减少。\n\n因为等位基因频率总是从 $(0,1)$ 内的任何其他起始频率向 $p^*$ 移动，所以平衡点 $p^*$ 是局部稳定的。实际上，这一分析证明了在区间 $(0,1)$ 内的全局稳定性。这对于一个负频率依赖性选择系统来说是预期的结果，在这种系统中，稀有等位基因总是具有适应度优势，从而驱动群体达到一个平衡的中间频率。", "answer": "$$\n\\boxed{\\frac{\\beta}{\\alpha + \\beta}}\n$$", "id": "2588599"}, {"introduction": "除了确定性的选择过程，随机的遗传漂变在有限群体中扮演着至关重要的角色。本练习将带你深入理解遗传漂变的随机性质，通过经典的Wright-Fisher模型，推导等位基因频率均值 $\\mathbb{E}[p_{t}]$ 和方差 $\\mathrm{Var}(p_{t})$ 的离散时间演化。更进一步，你将通过计算机模拟来验证这些理论预测，并将其与强大的扩散近似理论结果进行比较，这个过程整合了理论推导、计算实现和模型验证，是现代定量进化生物学研究的关键工作流程 [@problem_id:2588608]。", "problem": "本任务要求您通过推导并实现一个中性漂变基准，将基本的种群遗传学定义与算法验证联系起来。该基准需关联离散世代的 Wright–Fisher 过程及其连续时间扩散近似。请在标准、中性、二倍体的 Wright–Fisher 模型框架下进行，并假定种群大小恒定。\n\n仅使用以下基本原理：\n- 离散世代中性与随机遗传漂变：在一个大小为 $N$ 的二倍体种群中，存在 $2N$ 个基因拷贝。在中性、随机交配且无选择、突变或迁移的条件下，第 $t$ 代的等位基因频率 $p_{t}$ 通过抽样 $X_{t+1} \\sim \\mathrm{Binomial}(2N, p_{t})$ 并设定 $p_{t+1} = X_{t+1}/(2N)$ 进行演化。\n- 全期望定律与全方差定律。\n- 中性 Wright–Fisher 动态的扩散近似：在大 $N$ 极限下，$p(t)$ 满足一个随机微分方程（Stochastic Differential Equation (SDE)），其无穷小方差与 $p(t) \\left(1 - p(t)\\right)/(2N)$ 成正比；由此推导出二阶矩的常微分方程，并进而推导出方差的常微分方程。\n\n需完成的任务：\n1. 基于上述原理，推导中性条件下 $p_{t}$ 均值和方差的离散时间递归式，并求解其闭式解。写出 $\\mathbb{E}[p_{t}]$ 和 $\\mathrm{Var}(p_{t})$ 作为 $t$、$N$ 和 $p_{0}$ 的函数的最终表达式。\n2. 基于扩散近似原理，推导 $\\mathrm{Var}(p(t))$ 的连续时间方程，并求解其作为 $t$、$N$ 和 $p_{0}$ 的函数的闭式解。写出最终表达式。\n3. 设计一个最小化模拟，以量化漂变下的随机等位基因频率路径，并用离散世代的预测结果来验证扩散近似的结果。对于每组参数，从 $p_{0}$ 开始，模拟 $R$ 条长度为 $T$ 代的中性 Wright–Fisher 过程的独立重复路径，并在每一代 $t \\in \\{1,\\dots,T\\}$ 对所有重复路径进行计算：\n   - 样本均值 $\\widehat{m}(t)$，\n   - 样本方差 $\\widehat{v}(t)$。\n   然后计算以下三个标量摘要诊断指标：\n   - $E_{\\mathrm{mean}} = \\max_{1 \\le t \\le T} \\left| \\widehat{m}(t) - p_{0} \\right|$，\n   - $E_{\\mathrm{disc}} = \\max_{1 \\le t \\le T} \\left| \\widehat{v}(t) - v_{\\mathrm{disc}}(t) \\right|$，其中 $v_{\\mathrm{disc}}(t)$ 是您在任务1中得到的离散时间方差的闭式解，\n   - $E_{\\mathrm{diff}} = \\left| v_{\\mathrm{diff}}(T) - v_{\\mathrm{disc}}(T) \\right|$，其中 $v_{\\mathrm{diff}}(t)$ 是您在任务2中得到的扩散方差的闭式解。\n4. 确定性要求：使用固定的伪随机种子以使结果可复现。\n5. 所有概率和频率必须表示为 $[0,1]$ 区间内的小数。\n\n测试套件与接受阈值：\n实现您的程序以运行以下三组参数集。每组参数以元组 $(N, T, p_{0}, R, \\varepsilon_{\\mathrm{mean}}, \\varepsilon_{\\mathrm{var}}, \\tau)$ 的形式给出，其中 $\\varepsilon_{\\mathrm{mean}}$ 和 $\\varepsilon_{\\mathrm{var}}$ 分别是 $E_{\\mathrm{mean}}$ 和 $E_{\\mathrm{disc}}$ 的接受阈值，$\\tau$ 是时间 $T$ 时 $E_{\\mathrm{diff}}$ 的接受阈值。\n- 情况 A（大种群，中等时间，中等频率）：(1000, 50, 0.3, 12000, 0.005, 0.001, $1 \\times 10^{-4}$)。\n- 情况 B（小种群，中等时间，对称频率）：(20, 50, 0.5, 20000, 0.01, 0.01, 0.005)。\n- 情况 C（中等种群，长时间，稀有等位基因）：(100, 200, 0.01, 15000, 0.005, 0.001, $1 \\times 10^{-4}$)。\n\n程序要求：\n- 实现模拟以及您推导出的两个闭式预测。\n- 对于每种情况，计算三个诊断指标 $E_{\\mathrm{mean}}$、$E_{\\mathrm{disc}}$ 和 $E_{\\mathrm{diff}}$，然后为每种情况返回一个布尔值，表示是否同时满足所有三个标准：\n  - $E_{\\mathrm{mean}} \\le \\varepsilon_{\\mathrm{mean}}$，\n  - $E_{\\mathrm{disc}} \\le \\varepsilon_{\\mathrm{var}}$，\n  - $E_{\\mathrm{diff}} \\le \\tau$。\n- 为伪随机数生成器使用固定种子。\n- 最终输出格式：您的程序应生成单行输出，包含针对情况 A、B 和 C 的三个布尔值，以逗号分隔并用方括号括起（例如，[True, False, True]）。不应打印任何额外文本。\n\n不涉及物理单位。所有输出必须是布尔值。不使用角度。请将所有概率和频率表示为 $[0,1]$ 区间内的小数。", "solution": "该问题陈述是理论与计算种群遗传学领域一个有效且适定的练习。它要求推导遗传漂变 Wright-Fisher 模型的基本结果，并通过随机模拟对其进行验证。该问题在科学上是合理的，内部逻辑一致，并包含了继续研究所需的所有信息。\n\n现在，我将按要求提供分步推导和模拟设计的描述。\n\n**任务1：离散时间 Wright–Fisher 模型分析**\n\n给定一个大小恒为 $N$ 的二倍体种群。第 $t$ 代的等位基因频率 $p_t$ 遵循规则 $p_{t+1} = X_{t+1}/(2N)$ 进行演化，其中下一代中'A'等位基因的数量 $X_{t+1}$ 从二项分布 $X_{t+1} \\sim \\mathrm{Binomial}(2N, p_t)$ 中抽取。该过程从一个固定的初始频率 $p_0$ 开始。\n\n**均值等位基因频率 $\\mathbb{E}[p_t]$ 的推导**\n\n我们使用全期望定律：$\\mathbb{E}[p_{t+1}] = \\mathbb{E}[\\mathbb{E}[p_{t+1} | p_t]]$。\n首先，我们求在给定 $p_t$ 的条件下 $p_{t+1}$ 的条件期望。\n$$\n\\mathbb{E}[p_{t+1} | p_t] = \\mathbb{E}\\left[\\frac{X_{t+1}}{2N} \\bigg| p_t\\right] = \\frac{1}{2N} \\mathbb{E}[X_{t+1} | p_t]\n$$\n一个二项随机变量 $\\mathrm{Binomial}(n, p)$ 的期望是 $np$。此处，$n=2N$，概率是 $p_t$。\n$$\n\\mathbb{E}[X_{t+1} | p_t] = (2N) p_t\n$$\n将此代入 $\\mathbb{E}[p_{t+1} | p_t]$ 的表达式中：\n$$\n\\mathbb{E}[p_{t+1} | p_t] = \\frac{1}{2N} (2N p_t) = p_t\n$$\n现在，应用外层期望：\n$$\n\\mathbb{E}[p_{t+1}] = \\mathbb{E}[p_t]\n$$\n这是一个简单的递归关系。通过归纳法，并使用初始条件 $\\mathbb{E}[p_0] = p_0$（因为 $p_0$ 是一个给定的常数），我们发现平均等位基因频率不随时间变化。\n$$\n\\mathbb{E}[p_t] = p_0\n$$\n\n**等位基因频率方差 $\\mathrm{Var}(p_t)$ 的推导**\n\n我们使用全方差定律：$\\mathrm{Var}(p_{t+1}) = \\mathbb{E}[\\mathrm{Var}(p_{t+1} | p_t)] + \\mathrm{Var}(\\mathbb{E}[p_{t+1} | p_t])$。\n根据我们之前的推导，我们知道 $\\mathbb{E}[p_{t+1} | p_t] = p_t$。因此第二项是 $\\mathrm{Var}(p_t)$。\n对于第一项，我们需要条件方差 $\\mathrm{Var}(p_{t+1} | p_t)$。一个二项随机变量 $\\mathrm{Binomial}(n, p)$ 的方差是 $np(1-p)$。\n$$\n\\mathrm{Var}(p_{t+1} | p_t) = \\mathrm{Var}\\left(\\frac{X_{t+1}}{2N} \\bigg| p_t\\right) = \\frac{1}{(2N)^2} \\mathrm{Var}(X_{t+1} | p_t) = \\frac{2N p_t(1-p_t)}{4N^2} = \\frac{p_t(1-p_t)}{2N}\n$$\n现在，我们对这个条件方差求关于 $p_t$ 分布的期望：\n$$\n\\mathbb{E}[\\mathrm{Var}(p_{t+1} | p_t)] = \\mathbb{E}\\left[\\frac{p_t(1-p_t)}{2N}\\right] = \\frac{1}{2N}\\left(\\mathbb{E}[p_t] - \\mathbb{E}[p_t^2]\\right)\n$$\n我们知道 $\\mathbb{E}[p_t] = p_0$ 并且 $\\mathbb{E}[p_t^2] = \\mathrm{Var}(p_t) + (\\mathbb{E}[p_t])^2 = \\mathrm{Var}(p_t) + p_0^2$。将这些代入：\n$$\n\\mathbb{E}[\\mathrm{Var}(p_{t+1} | p_t)] = \\frac{1}{2N}\\left(p_0 - (\\mathrm{Var}(p_t) + p_0^2)\\right) = \\frac{p_0(1-p_0) - \\mathrm{Var}(p_t)}{2N}\n$$\n将两部分在全方差定律中合并，我们得到一个关于 $v_t = \\mathrm{Var}(p_t)$ 的递归式：\n$$\nv_{t+1} = \\frac{p_0(1-p_0) - v_t}{2N} + v_t = \\left(1 - \\frac{1}{2N}\\right)v_t + \\frac{p_0(1-p_0)}{2N}\n$$\n这是一个线性一阶递归关系，初始条件为 $v_0 = \\mathrm{Var}(p_0) = 0$。通过观察不动点是 $v^* = p_0(1-p_0)$ 来找到解。与不動點的偏差呈几何衰减：$v_{t+1} - v^* = (1 - 1/(2N))(v_t - v^*)$。展开递归式可得 $v_t - v^* = (1-1/(2N))^t(v_0 - v^*)$。\n当 $v_0=0$ 时，这给出 $v_t = v^*(1 - (1-1/(2N))^t)$。\n离散时间方差的闭式解为：\n$$\nv_{\\mathrm{disc}}(t) = p_0(1-p_0)\\left[1 - \\left(1 - \\frac{1}{2N}\\right)^t\\right]\n$$\n\n**任务2：扩散近似分析**\n\nWright-Fisher 过程的连续时间扩散近似由一个随机微分方程（SDE）描述，其无穷小方差为 $\\sigma^2(p) = p(1-p)/(2N)$，无穷小漂移为 $\\mu(p)=0$。为了找到方差的演化，我们首先使用相应的向前 Kolmogorov 方程来找到二阶矩 $m_2(t) = \\mathbb{E}[p(t)^2]$ 的动态。对于任意平滑函数 $f(p)$，其期望 $\\mathbb{E}[f(p(t))]$ 的演化如下：\n$$\n\\frac{d}{dt}\\mathbb{E}[f(p)] = \\mathbb{E}\\left[\\mu(p) \\frac{\\partial f}{\\partial p} + \\frac{1}{2}\\sigma^2(p) \\frac{\\partial^2 f}{\\partial p^2}\\right]\n$$\n我们选择 $f(p) = p^2$。那么 $\\frac{\\partial f}{\\partial p}=2p$ 且 $\\frac{\\partial^2 f}{\\partial p^2}=2$。\n$$\n\\frac{d}{dt}\\mathbb{E}[p^2] = \\mathbb{E}\\left[0 \\cdot (2p) + \\frac{1}{2}\\frac{p(1-p)}{2N} \\cdot 2\\right] = \\mathbb{E}\\left[\\frac{p(1-p)}{2N}\\right] = \\frac{1}{2N}\\left(\\mathbb{E}[p] - \\mathbb{E}[p^2]\\right)\n$$\n与离散情况一样，$\\mathbb{E}[p(t)] = p_0$。令 $m_2(t) = \\mathbb{E}[p(t)^2]$，我们得到常微分方程：\n$$\n\\frac{dm_2}{dt} = \\frac{1}{2N}(p_0 - m_2)\n$$\n这是一个线性一阶常微分方程，可以重排为 $\\frac{dm_2}{dt} + \\frac{1}{2N}m_2 = \\frac{p_0}{2N}$。满足初始条件 $m_2(0) = \\mathbb{E}[p_0^2] = p_0^2$ 的解为：\n$$\nm_2(t) = p_0 - p_0(1-p_0)e^{-t/(2N)}\n$$\n然后方差 $v_{\\mathrm{diff}}(t) = \\mathrm{Var}(p(t))$ 通过下式求得：\n$$\nv_{\\mathrm{diff}}(t) = \\mathbb{E}[p(t)^2] - (\\mathbb{E}[p(t)])^2 = m_2(t) - p_0^2\n$$\n$$\nv_{\\mathrm{diff}}(t) = \\left(p_0 - p_0(1-p_0)e^{-t/(2N)}\\right) - p_0^2 = p_0(1-p_0) - p_0(1-p_0)e^{-t/(2N)}\n$$\n这给出了扩散近似下，方差的闭式解：\n$$\nv_{\\mathrm{diff}}(t) = p_0(1-p_0)\\left(1 - e^{-t/(2N)}\\right)\n$$\n\n**任务3：模拟与验证逻辑**\n\n实现将遵循对离散过程的直接模拟。对于每个测试用例 $(N, T, p_0, R, ...)$，我们执行以下步骤：\n1.  **可复现性**：为伪随机数生成器设置一个固定的种子，以确保结果是确定性的。\n2.  **模拟**：模拟 $R$ 条独立的种群路径，每条路径持续 $T$ 代。初始化一个大小为 $(R, T+1)$ 的数组，其第一列设置为 $p_0$。然后，对于从 $0$ 到 $T-1$ 的每一代 $t$，所有 $R$ 个重复路径的第 $t+1$ 代的等位基因数量，都从一个二项分布 $\\mathrm{Binomial}(2N, \\mathbf{p}_t)$ 中同时抽取，其中 $\\mathbf{p}_t$ 是所有重复路径在时间 $t$ 的频率向量。然后更新频率。这种向量化的方法计算效率很高。\n3.  **分析**：模拟结束后，计算理论统计量和样本统计量。\n    -   使用推导出的公式计算所有 $t \\in \\{0, \\dots, T\\}$ 的理论方差预测 $v_{\\mathrm{disc}}(t)$ 和 $v_{\\mathrm{diff}}(t)$。\n    -   针对每个时间步长，在 $R$ 个重复路径上计算样本均值 $\\widehat{m}(t)$ 和样本方差 $\\widehat{v}(t)$。\n4.  **诊断**：计算三个误差度量。\n    -   $E_{\\mathrm{mean}} = \\max_{1 \\le t \\le T} \\left| \\widehat{m}(t) - p_{0} \\right|$：衡量经验均值与理论恒定均值的最大偏差。这证实了漂变过程的无偏性。\n    -   $E_{\\mathrm{disc}} = \\max_{1 \\le t \\le T} \\left| \\widehat{v}(t) - v_{\\mathrm{disc}}(t) \\right|$：衡量经验方差与精确离散理论的最大偏差。这验证了模拟的准确性。\n    -   $E_{\\mathrm{diff}} = \\left| v_{\\mathrm{diff}}(T) - v_{\\mathrm{disc}}(T) \\right|$：衡量在最后一代时，扩散模型相对于离散模型的近似误差。这是一个纯理论上的比较。\n5.  **验证**：对于每个测试用例，将计算出的度量与提供的阈值进行比较检验：$E_{\\mathrm{mean}} \\le \\varepsilon_{\\mathrm{mean}}$，$E_{\\mathrm{disc}} \\le \\varepsilon_{\\mathrm{var}}$，以及 $E_{\\mathrm{diff}} \\le \\tau$。如果所有三个不等式都成立，则该用例的最终结果为 `True`，否则为 `False`。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, simulates, and validates the neutral Wright-Fisher process\n    against its discrete and continuous theoretical predictions.\n    \"\"\"\n    \n    # Set a fixed seed for the pseudorandom number generator for reproducibility.\n    # The problem requires this for deterministic output.\n    np.random.seed(42)\n\n    # Test suite from the problem statement.\n    # Each tuple contains:\n    # (N, T, p0, R, eps_mean, eps_var, tau)\n    # N: diploid population size\n    # T: number of generations\n    # p0: initial allele frequency\n    # R: number of replicate simulations\n    # eps_mean: acceptance threshold for E_mean\n    # eps_var: acceptance threshold for E_disc\n    # tau: acceptance threshold for E_diff\n    test_cases = [\n        # Case A: large population, moderate time, intermediate frequency\n        (1000, 50, 0.3, 12000, 0.005, 0.001, 1e-4),\n        # Case B: small population, moderate time, symmetric frequency\n        (20, 50, 0.5, 20000, 0.01, 0.01, 0.005),\n        # Case C: moderate population, long time, rare allele\n        (100, 200, 0.01, 15000, 0.005, 0.001, 1e-4),\n    ]\n\n    # This list will store the boolean result (True/False) for each test case.\n    results = []\n\n    for case in test_cases:\n        N, T, p0, R, eps_mean, eps_var, tau = case\n\n        # --- 1. Simulation of the discrete Wright-Fisher process ---\n        \n        # Array to store allele frequency paths for R replicates over T+1 time points (0 to T)\n        paths = np.zeros((R, T + 1))\n        # Set initial frequency for all replicates\n        paths[:, 0] = p0\n\n        # Run the simulation for T generations\n        for t in range(T):\n            # Get current frequencies for all R replicates\n            current_p = paths[:, t]\n            \n            # For each replicate, draw the number of alleles for the next generation\n            # from a binomial distribution. This is done in a vectorized manner for efficiency.\n            num_alleles = np.random.binomial(2 * N, current_p)\n            \n            # Calculate and store the new frequencies for the next generation\n            paths[:, t + 1] = num_alleles / (2 * N)\n\n        # --- 2. Calculation of theoretical predictions and sample statistics ---\n\n        # Time vector from t=0 to t=T\n        t_vec = np.arange(T + 1)\n\n        # Theoretical variance for the discrete-generation model (v_disc)\n        # v_disc(t) = p0*(1-p0) * (1 - (1 - 1/(2N))^t)\n        v_disc = p0 * (1.0 - p0) * (1.0 - (1.0 - 1.0 / (2.0 * N))**t_vec)\n\n        # Theoretical variance for the continuous-time diffusion approximation (v_diff)\n        # v_diff(t) = p0*(1-p0) * (1 - exp(-t/(2N)))\n        v_diff = p0 * (1.0 - p0) * (1.0 - np.exp(-t_vec / (2.0 * N)))\n\n        # Sample mean of allele frequency across replicates at each time point\n        m_hat = np.mean(paths, axis=0)\n        \n        # Sample variance of allele frequency across replicates at each time point.\n        # ddof=0 calculates the population variance (MLE), which is appropriate\n        # for comparison against a theoretical population parameter with large R.\n        v_hat = np.var(paths, axis=0, ddof=0)\n        \n        # --- 3. Computation of diagnostic error metrics ---\n\n        # E_mean: Max deviation of sample mean from theoretical mean (p0) for t>0.\n        E_mean = np.max(np.abs(m_hat[1:] - p0))\n        \n        # E_disc: Max deviation of sample variance from discrete theory for t>0.\n        E_disc = np.max(np.abs(v_hat[1:] - v_disc[1:]))\n\n        # E_diff: Theoretical deviation between diffusion and discrete models at T.\n        E_diff = np.abs(v_diff[T] - v_disc[T])\n\n        # --- 4. Validation against acceptance thresholds ---\n        \n        # A case is valid if and only if all three error metrics are within their thresholds.\n        is_valid = (E_mean <= eps_mean) and \\\n                   (E_disc <= eps_var) and \\\n                   (E_diff <= tau)\n        \n        results.append(is_valid)\n\n    # Final print statement in the exact required format.\n    # The output is a list of booleans, one for each test case.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2588608"}]}