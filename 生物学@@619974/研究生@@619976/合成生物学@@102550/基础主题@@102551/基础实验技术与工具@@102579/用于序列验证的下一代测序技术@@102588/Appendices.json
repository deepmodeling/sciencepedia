{"hands_on_practices": [{"introduction": "在任何序列验证项目中，首要问题是：我们需要多少测序数据？本练习将指导您从基本原理出发，运用泊松分布模型来量化测序深度（$C$）与目标序列上出现覆盖“缺口”的概率之间的关系。通过这个实践，您将掌握设计既经济又可靠的下一代测序实验所需的核心统计技能。[@problem_id:2754129]", "problem": "一个合成生物学实验室需要使用下一代测序 (NGS) 技术来验证一个长度为 $L$ 个碱基对的 *de novo* 组装的 DNA 构建体。假设文库制备和测序产生的读段（reads）长度固定为 $\\ell$ 个碱基对，并且读段在目标序列上的起始位点遵循速率为每个碱基 $\\lambda$ 的均匀泊松点过程。定义平均测序深度为 $C=\\lambda \\ell$。忽略末端效应（假设 $L \\gg \\ell$，因此边缘校正是可以忽略的）。\n\n任务：\n1. 仅从泊松点过程的定义性质（任何长度为 $x$ 的区间中的事件数服从均值为 $\\lambda x$ 的泊松分布，且不相交区间是独立的）出发，推导一个特定碱基未被任何读段覆盖的概率表达式，用 $C$ 来表示。\n2. 设 $\\delta$ 是用户指定的在整个目标序列中至少有一个碱基未被覆盖的总体风险容忍度。在不假设不同碱基间的覆盖事件独立的情况下，推导 $C$ 的一个严格下界，该下界保证 $L$ 个碱基中至少有一个未被覆盖的概率严格小于 $\\delta$。用 $L$ 和 $\\delta$ 以闭合形式表示你的 $C$ 的下界。\n3. 对于 $L=10^{5}$ 和 $\\delta=10^{-6}$，对你的下界进行数值计算。将满足该下界的最小 $C$ 值报告为一个纯数（无量纲）。将你的答案四舍五入到四位有效数字。", "solution": "所提出的问题具有科学依据、提法明确、客观，并包含足够的信息以进行严谨的求解。这是生物信息学中的一个标准问题，通常被称为用于测序的 Lander-Waterman 模型。我们将进行推导。\n\n### 第一部分：单个碱基未被覆盖的概率\n\n我们被要求推导一个特定碱基未被任何读段覆盖的概率。让我们考虑一个位于特定基因组坐标上的任意碱基。要使这个碱基被一个长度为 $\\ell$ 的读段覆盖，该读段的起始位置必须使得该碱基落入读段的跨度内。如果该碱基在位置 $x$，一个起始于位置 $s$ 的读段将覆盖它当且仅当 $s \\le x < s + \\ell$。这等价于读段必须在区间 $(x-\\ell, x]$ 内起始的条件。\n\n问题指出，读段起始位点由一个速率为每个碱基对 $\\lambda$ 的均匀泊松点过程所控制。$L \\gg \\ell$ 的假设允许我们忽略末端效应，这意味着我们可以将这个长度为 $\\ell$ 的区间视为不靠近构建体末端。\n\n根据泊松过程的定义，在任何给定长度的区间内发生的事件（读段起始）数量是一个服从泊松分布的随机变量。该分布的均值是速率 $\\lambda$ 与该区间长度的乘积。对于区间 $(x-\\ell, x]$，其长度为 $\\ell$。因此，在这个特定区间内起始的读段数量（我们称这个随机变量为 $N$）服从均值为 $\\lambda \\ell$ 的泊松分布。\n\n问题将平均测序深度定义为 $C = \\lambda \\ell$。因此，$N \\sim \\text{Poisson}(C)$。$N$ 的概率质量函数由下式给出：\n$$P(N=k) = \\frac{\\exp(-C) C^k}{k!}$$\n其中 $k$ 是一个非负整数。\n\n一个特定的碱基未被覆盖，当且仅当在对应的长度为 $\\ell$ 的区间内有零个读段起始。这对应于事件 $N=0$。我们可以通过在概率质量函数中设置 $k=0$ 来计算这个概率：\n$$P(\\text{base is not covered}) = P(N=0) = \\frac{\\exp(-C) C^0}{0!}$$\n回想一下，$C^0=1$ 且 $0!=1$，我们得到一个特定碱基未被覆盖的概率：\n$$P(\\text{base is not covered}) = \\exp(-C)$$\n\n### 第二部分：平均测序深度的下界\n\n我们的任务是找到平均测序深度 $C$ 的一个下界，以确保在整个长度为 $L$ 的构建体上至少有一个碱基未被覆盖的概率严格小于指定的容忍度 $\\delta$。\n\n设 $E_i$ 为第 $i$ 个碱基（$i=1, 2, \\dots, L$）未被任何读段覆盖的事件。“至少有一个碱基未被覆盖”这一事件是构建体中所有碱基的此类事件的并集：$\\bigcup_{i=1}^{L} E_i$。我们要求这个并集事件的概率小于 $\\delta$：\n$$P\\left(\\bigcup_{i=1}^{L} E_i\\right) < \\delta$$\n\n问题正确地要求我们不假设事件 $E_i$ 之间是独立的。相邻碱基的覆盖状态是相关的。例如，如果碱基 $i$ 未被覆盖，这意味着在区间 $(i-\\ell, i]$ 内没有读段起始。这反过来又影响了碱基 $i+1$ 未被覆盖的概率，因为其潜在覆盖读段的区间 $(i+1-\\ell, i+1]$ 与第一个区间大部分重叠。\n\n为了处理这种依赖性，我们使用并集界，也称为布尔不等式 (Boole's inequality)。对于任何事件集合 $E_1, E_2, \\dots, E_L$，该不等式表明：\n$$P\\left(\\bigcup_{i=1}^{L} E_i\\right) \\le \\sum_{i=1}^{L} P(E_i)$$\n\n在第一部分中，我们确定了对于任何单个碱基 $i$，其未被覆盖的概率是 $P(E_i) = \\exp(-C)$。由于我们忽略了末端效应，这个概率对于从 $i=1$ 到 $L$ 的所有碱基都是一致的。将此应用于并集界中的求和：\n$$\\sum_{i=1}^{L} P(E_i) = \\sum_{i=1}^{L} \\exp(-C) = L \\exp(-C)$$\n\n结合这些结果，我们得到了我们所关心的概率的一个上界：\n$$P(\\text{at least one base uncovered}) \\le L \\exp(-C)$$\n\n为了满足条件 $P(\\text{at least one base uncovered}) < \\delta$，我们只需施加一个更严格的条件，即其上界小于 $\\delta$：\n$$L \\exp(-C) < \\delta$$\n\n我们现在可以解这个关于 $C$ 的不等式，以找到所需的下界。\n$$\\exp(-C) < \\frac{\\delta}{L}$$\n对两边取自然对数：\n$$-C < \\ln\\left(\\frac{\\delta}{L}\\right)$$\n两边乘以 $-1$ 会反转不等号：\n$$C > -\\ln\\left(\\frac{\\delta}{L}\\right)$$\n利用对数性质 $-\\ln(x) = \\ln(1/x)$，我们得到了 $C$ 的下界的最终表达式：\n$$C > \\ln\\left(\\frac{L}{\\delta}\\right)$$\n这提供了一个严格的下界，保证了覆盖缺口的总体错误率低于容忍度 $\\delta$。\n\n### 第三部分：数值计算\n\n最后，我们被要求对给定的参数进行下界评估：构建体长度 $L=10^5$ 个碱基对，风险容忍度 $\\delta=10^{-6}$。\n\n使用推导出的不等式，最小测序深度 $C$ 必须满足：\n$$C > \\ln\\left(\\frac{10^5}{10^{-6}}\\right)$$\n$$C > \\ln(10^{5 - (-6)})$$\n$$C > \\ln(10^{11})$$\n利用对数性质 $\\ln(x^a) = a \\ln(x)$:\n$$C > 11 \\ln(10)$$\n自然对数 $\\ln(10)$ 的值约为 $2.30258509...$。\n$$C > 11 \\times 2.30258509...$$\n$$C > 25.328436...$$\n问题要求报告满足该下界的最小 $C$ 值，并四舍五入到四位有效数字。将数值结果 $25.328436...$ 四舍五入到四位有效数字得到 $25.33$。因此，在此模型下，需要至少 $25.33$ 的平均测序深度才能满足指定的验证标准。", "answer": "$$\\boxed{25.33}$$", "id": "2754129"}, {"introduction": "原始的下一代测序读数不可避免地包含错误，而唯一分子标识符（UMI）是克服这一挑战的有力工具。本练习的核心在于，通过对源自同一原始分子的读数进行分组和多数表决，我们可以构建一个高保真度的共识序列。您将运用二项式和条件概率来推导出这种方法在理论上能够将错误率降低多少，从而量化UMI技术的强大能力。[@problem_id:2754097]", "problem": "一个合成生物学实验室使用带有唯一分子标识符（UMI）标记的二代测序（NGS）技术，来验证一个质粒构建体在单个核苷酸位置上的序列。每个UMI家族由源自同一个原始分子的 $n$ 个独立读段（reads）组成，每个读段都经过碱基识别（base calling），其单次读取的替换错误概率为 $p \\in (0,1)$，并且家族内各个读段的错误是相互独立的。假设一个对称替换模型：当一个读段发生错误时，它变为任何一个非真实核苷酸的概率是均等的。\n\n该实验室在该位置使用以下UMI感知的一致性规则：仅当家族中严格多数的读段认同同一个碱基时，才生成一个一致性碱基；否则，在该位置上该家族不生成一致性序列。如果生成了一致性序列，则该一致性碱基就是由严格多数支持的那个碱基。设真实碱基是固定的但未知。\n\n从独立性和分类结果的二项/多项计数模型的第一性原理出发，推导误差抑制因子作为 $p$ 和 $n$ 的函数解析表达式。将误差抑制因子定义为单次读取错误率与在生成一致性序列的情况下一致性序列发生错误的概率之比，\n$$\n\\mathcal{F}(p,n) \\equiv \\frac{p}{\\Pr(\\text{consensus wrong} \\mid \\text{consensus called})}.\n$$\n将您的最终答案表示为一个关于 $p$ 和 $n$ 的单一闭式表达式，仅使用标准数学函数和有限和。不需要数值近似，也不需要四舍五入。给出答案时无需单位。", "solution": "提交分析的问题陈述具有科学依据、问题明确且内容完整。它基于概率论在合成生物学序列分析中应用的既定原则，呈现了一个清晰、可形式化的场景。所有参数和规则都得到了明确的定义，从而允许进行严谨且唯一的推导。因此，该问题被认为是**有效的**，我将着手进行解答。\n\n目标是推导误差抑制因子 $\\mathcal{F}(p,n)$ 的表达式，它被定义为单次读取错误率 $p$ 与在生成一致性序列的条件下，该一致性序列出错的条件概率之比。\n$$\n\\mathcal{F}(p,n) \\equiv \\frac{p}{\\Pr(\\text{consensus wrong} \\mid \\text{consensus called})}\n$$\n我们首先使用条件概率的定义 $\\Pr(A|B) = \\Pr(A \\cap B) / \\Pr(B)$ 来分析这个条件概率。\n在这里，事件 $A$ 是“一致性序列错误”，事件 $B$ 是“生成了一致性序列”。\n$$\n\\Pr(\\text{consensus wrong} \\mid \\text{consensus called}) = \\frac{\\Pr(\\text{consensus wrong} \\cap \\text{consensus called})}{\\Pr(\\text{consensus called})}\n$$\n让我们分别分析分子和分母。分析将从第一性原理出发，假设有一个固定的但未知的真实核苷酸碱基，我们不妨将其表示为 $B_T$。存在三种非真实（错误）的碱基，$B_{E1}$、$B_{E2}$ 和 $B_{E3}$。\n\n问题陈述了单次读取的替换错误概率为 $p$。一个读段正确（与 $B_T$ 匹配）的概率是 $1-p$。对称错误模型规定，如果发生错误，读段变为三种非真实碱基中任何一种的概率是均等的。因此，单次读取报告一个特定错误碱基（比如 $B_{E1}$）的概率是 $\\frac{p}{3}$。\n\n如果UMI家族中的 $n$ 个读段有严格多数认同同一个碱基，则生成一致性序列。严格多数要求某个碱基的计数 $k$ 满足 $k > n/2$。因此，构成严格多数的最小整数计数为 $k_{maj} = \\lfloor \\frac{n}{2} \\rfloor + 1$。\n\n首先，我们计算分子中的联合事件概率：“一致性序列错误且生成了一致性序列”。该事件发生当且仅当三种非真实碱基（$B_{E1}$、$B_{E2}$、$B_{E3}$）之一达到了严格多数。设 $M_{Ei}$ 为碱基 $B_{Ei}$ 获得严格多数的事件。在一个大小为 $n$ 的家族中，观察到特定碱基 $B_{Ei}$ 的读段数服从二项分布，因为 $n$ 个独立读段中每一个为 $B_{Ei}$ 的概率都是 $\\frac{p}{3}$。设 $N_{Ei}$ 为碱基 $B_{Ei}$ 计数的随机变量。则 $N_{Ei} \\sim \\text{Binomial}(n, \\frac{p}{3})$。\n事件 $M_{Ei}$ 的概率为：\n$$\n\\Pr(M_{Ei}) = \\Pr(N_{Ei} \\ge k_{maj}) = \\sum_{k=k_{maj}}^{n} \\binom{n}{k} \\left(\\frac{p}{3}\\right)^k \\left(1 - \\frac{p}{3}\\right)^{n-k}\n$$\n事件 $M_{E1}$、$M_{E2}$ 和 $M_{E3}$ 是互斥的，因为不可能有两个不同的碱基各自拥有超过 $n/2$ 个读段。因此，生成错误的一致性序列的概率是它们各自概率之和：\n$$\n\\Pr(\\text{consensus wrong} \\cap \\text{consensus called}) = \\Pr(M_{E1} \\cup M_{E2} \\cup M_{E3}) = \\sum_{i=1}^{3} \\Pr(M_{Ei}) = 3\\Pr(M_{E1})\n$$\n$$\n= 3 \\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} \\left(\\frac{p}{3}\\right)^k \\left(1 - \\frac{p}{3}\\right)^{n-k}\n$$\n接下来，我们计算分母中的概率：“生成了一致性序列”。如果*任何一个*碱基——无论是真实碱基 $B_T$ 还是错误碱基之一 $B_{Ei}$——达到了严格多数，则生成一致性序列。设 $M_T$ 为真实碱基 $B_T$ 达到严格多数的事件。真实碱基的计数 $N_T$ 服从二项分布 $N_T \\sim \\text{Binomial}(n, 1-p)$。该事件的概率为：\n$$\n\\Pr(M_T) = \\Pr(N_T \\ge k_{maj}) = \\sum_{k=k_{maj}}^{n} \\binom{n}{k} (1-p)^k (1 - (1-p))^{n-k} = \\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} (1-p)^k p^{n-k}\n$$\n“生成了一致性序列”这一事件是互斥事件 $M_T, M_{E1}, M_{E2}, M_{E3}$ 的并集。其概率是各个概率之和：\n$$\n\\Pr(\\text{consensus called}) = \\Pr(M_T) + \\Pr(M_{E1}) + \\Pr(M_{E2}) + \\Pr(M_{E3}) = \\Pr(M_T) + 3\\Pr(M_{E1})\n$$\n$$\n= \\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} (1-p)^k p^{n-k} + 3 \\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} \\left(\\frac{p}{3}\\right)^k \\left(1 - \\frac{p}{3}\\right)^{n-k}\n$$\n现在我们可以计算一致性序列错误的条件概率：\n$$\n\\Pr(\\text{consensus wrong} \\mid \\text{consensus called}) = \\frac{3 \\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} \\left(\\frac{p}{3}\\right)^k \\left(1 - \\frac{p}{3}\\right)^{n-k}}{\\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} (1-p)^k p^{n-k} + 3 \\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} \\left(\\frac{p}{3}\\right)^k \\left(1 - \\frac{p}{3}\\right)^{n-k}}\n$$\n最后，我们将其代入误差抑制因子 $\\mathcal{F}(p,n)$ 的定义中：\n$$\n\\mathcal{F}(p,n) = \\frac{p}{\\Pr(\\text{consensus wrong} \\mid \\text{consensus called})} = p \\cdot \\frac{\\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} (1-p)^k p^{n-k} + 3 \\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} \\left(\\frac{p}{3}\\right)^k \\left(1 - \\frac{p}{3}\\right)^{n-k}}{3 \\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} \\left(\\frac{p}{3}\\right)^k \\left(1 - \\frac{p}{3}\\right)^{n-k}}\n$$\n这个表达式可以通过分配分数来简化：\n$$\n\\mathcal{F}(p,n) = p \\left( \\frac{\\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} (1-p)^k p^{n-k}}{3 \\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} \\left(\\frac{p}{3}\\right)^k \\left(1 - \\frac{p}{3}\\right)^{n-k}} + 1 \\right)\n$$\n这就是所要求的最终解析表达式。它是一个包含二项概率有限和的单一闭式表达式。", "answer": "$$\n\\boxed{p \\left( 1 + \\frac{\\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} (1-p)^{k} p^{n-k}}{3 \\sum_{k=\\lfloor n/2 \\rfloor + 1}^{n} \\binom{n}{k} \\left(\\frac{p}{3}\\right)^{k} \\left(1 - \\frac{p}{3}\\right)^{n-k}} \\right)}\n$$", "id": "2754097"}, {"introduction": "在测序数据中观察到的低频变异，究竟是真实的生物学信号（例如嵌合体），还是仅仅是PCR和测序过程中的错误？要回答这个问题，需要一个正式的统计检验。本练习将引导您构建一个似然比检验，它巧妙地结合了UMI家族共识信息和碱基质量分数，以区分这两种可能性。完成此练习后，您将能够建立一个严谨的统计框架来识别真实的稀有变异，这在基因编辑验证等前沿领域至关重要。[@problem_id:2754083]", "problem": "一个合成生物学实验室使用带有唯一分子标识符（UMI）的新一代测序（NGS）技术，来验证可能作为真实低频（嵌合）变异存在于克隆细胞群体中的序列编辑。每个原始分子在扩增前都会被标记上一个唯一分子标识符（UMI）。测序读数（reads）根据UMI被分组成大小为 $r$ 的家族，如果一个家族中至少有 $m$ 条读数在特定目标位置支持同一个替换碱基，则该UMI家族的共有序列被称为“已编辑”（变异）。\n\n现给定以下实验背景和定义，以构建一个似然比假设检验，该检验利用UMI家族共有序列和单读数质量指标，来区分真实的嵌合编辑与聚合酶链式反应（PCR）及测序错误。请仅使用此处提供的基本定义作为出发点。\n\n基本要素与假设：\n1. Phred质量分值定义：一个Phred分值为 $Q$ 的碱基，其单碱基测序错误概率 $p_{s}$ 由 $p_{s} = 10^{-Q/10}$ 给出。\n2. 在没有上下文偏好的情况下，当发生测序错误时，其变成三种错误核苷酸中任意一种的可能性是均等的，因此由于测序导致出现某个特定错误替换碱基的概率为 $p_{s}/3$。\n3. UMI标记后的PCR错误建模（UMI标记后引入的错误）：假设有 $C$ 个完美的倍增PCR循环，每个碱基每个循环的聚合酶错误率为 $\\epsilon_{p}$，并且在第 $c$ 个循环中引入的单个碱基错误会传播到最终扩增子（amplicons）的 $2^{-(C - c)}$ 比例中。那么，在目标位点上，最终扩增子携带一个错误的预期比例为 $\\sum_{c=1}^{C} \\epsilon_{p} 2^{-(C - c)} = 2 \\epsilon_{p} \\left(1 - 2^{-C}\\right)$。假设错误均匀分布在三种非真实碱基中，则由于PCR导致一条读数表现出某个特定错误替换碱基的概率为 $\\frac{2 \\epsilon_{p} \\left(1 - 2^{-C}\\right)}{3}$。\n4. 独立性近似：在给定一个UMI家族的真实状态（已编辑或未编辑）的条件下，家族内各条读数的错误事件是独立发生的。如果一个UMI家族中至少有 $m$ 条读数显示同一个替换碱基，则其共有序列被称为变异型；否则被称为参考型。\n\n假设：\n- 原假设 $\\mathcal{H}_{0}$：群体中不存在真实的编辑（嵌合比例 $f = 0$）；所有观察到的支持变异的读数都源于测序和PCR错误。\n- 备择假设 $\\mathcal{H}_{1}$：存在一个非零的嵌合比例 $f \\in (0,1]$，使得这部分UMI家族源于真正被编辑过的分子。\n\n在 $\\mathcal{H}_{0}$（未编辑分子）下，在目标位置观察到特定替换碱基的单读数概率为\n$$\np_{0} \\;=\\; \\frac{p_{s}}{3} \\;+\\; \\frac{2 \\epsilon_{p} \\left(1 - 2^{-C}\\right)}{3}.\n$$\n在 $\\mathcal{H}_{0}$ 下，获得一个变异共有序列的单家族概率为\n$$\n\\pi_{0} \\;=\\; \\sum_{k=m}^{r} \\binom{r}{k} p_{0}^{k} \\left(1 - p_{0}\\right)^{r-k}.\n$$\n\n在 $\\mathcal{H}_{1}$ 下，对于一个真正被编辑的UMI家族，其位点上的真实碱基就是那个替换碱基；除非发生错误使其变为其他三种核苷酸之一，否则读数将保持为替换碱基。近似认为测序和PCR错误是独立的，并忽略高阶乘积项，则单读数保持为替换碱基的概率为\n$$\nq_{1} \\;\\approx\\; 1 \\;-\\; p_{s} \\;-\\; 2 \\epsilon_{p} \\left(1 - 2^{-C}\\right),\n$$\n因此，在已编辑家族中获得一个变异共有序列的单家族概率为\n$$\n\\pi_{1} \\;=\\; \\sum_{k=m}^{r} \\binom{r}{k} q_{1}^{k} \\left(1 - q_{1}\\right)^{r-k}.\n$$\n如果比例为 $f$ 的家族是真正被编辑的，比例为 $1-f$ 的家族是未编辑的，那么获得一个变异共有序列的边际单家族概率为\n$$\n\\pi(f) \\;=\\; f \\,\\pi_{1} \\;+\\; (1-f) \\,\\pi_{0}.\n$$\n\n数据：\n- UMI家族数量：$N = 1000$。\n- 家族大小：$r = 5$。\n- 共有序列阈值：$m = 4$。\n- 观察到的变异共有序列家族数量：$X = 6$。\n- 位点碱基质量中位数：$Q = 35$。\n- PCR循环数：$C = 20$。\n- 每个碱基每个循环的聚合酶错误率：$\\epsilon_{p} = 1.0 \\times 10^{-6}$。\n\n任务：\n1. 使用上述定义，根据给定参数推导 $p_{0}$, $\\pi_{0}$, $q_{1}$ 和 $\\pi_{1}$ 的表达式。\n2. 将 $X$ 视为来自成功概率为 $\\pi(f)$ 的二项分布的实现，构建似然比检验统计量\n$$\n\\Lambda \\;=\\; \\frac{L\\!\\left(f=0\\right)}{\\displaystyle \\max_{f \\in [0,1]} L(f)},\n$$\n并通过对 $f$ 进行剖析（profiling），将该检验统计量表示为渐近服从卡方分布的便捷形式 $-2 \\ln \\Lambda$。\n3. 对给定数据，使用 $\\mathcal{H}_{1}$ 下的最大似然估计 $\\hat{f}$，数值计算 $-2 \\ln \\Lambda$。你可以以符号形式保留中间步骤，但最终报告的值必须是单一的无单位数字。将你的答案四舍五入到四位有效数字。", "solution": "该问题要求构建并评估一个似然比检验，用以在新一代测序（NGS）实验中区分真实的低频基因变异与由实验过程（利用唯一分子标识符UMI）引入的错误。该问题具有科学依据，设定清晰，且解决问题所需的所有参数均已提供。我们将按要求进行推导和计算。\n\n按照题目要求，分析分为三个部分。\n\n首先，我们从给定的基本原理推导错误概率和共有序列概率的表达式。\n设 $Q$ 为Phred质量分值。在给定碱基上的测序错误概率为 $p_{s} = 10^{-Q/10}$。假设错误等概率地导致任一错误碱基，那么因测序错误而出现某一特定替换碱基的概率为 $\\frac{p_{s}}{3}$。\n聚合酶链式反应（PCR）在 $C$ 个循环中以每个碱基每个循环 $\\epsilon_{p}$ 的错误率引入错误。由于PCR错误，携带某一特定替换碱基的扩增子的预期比例为 $\\frac{2 \\epsilon_{p} (1 - 2^{-C})}{3}$。\n\n在原假设 $\\mathcal{H}_{0}$ 下，分子是未编辑的（野生型）。观察到的替换碱基必定是错误的结果。假设测序和PCR错误是独立的，且其概率很小，那么在单条读数中观察到某一特定替换碱基的总概率 $p_{0}$ 是它们各自概率之和：\n$$\np_{0} = \\frac{p_{s}}{3} + \\frac{2 \\epsilon_{p} \\left(1 - 2^{-C}\\right)}{3}\n$$\n一个大小为 $r$ 的UMI家族，如果至少有 $m$ 条读数支持替换碱基，则被称为“变异型”。在分子未编辑的条件下，支持替换碱基的读数数量 $k$ 服从试验次数为 $r$、成功概率为 $p_{0}$ 的二项分布。在 $\\mathcal{H}_{0}$ 下，一个变异共有序列的概率（记为 $\\pi_{0}$）是 $k \\ge m$ 的概率：\n$$\n\\pi_{0} = P(k \\ge m) = \\sum_{k=m}^{r} \\binom{r}{k} p_{0}^{k} \\left(1 - p_{0}\\right)^{r-k}\n$$\n在备择假设 $\\mathcal{H}_{1}$ 下，对于一个源自真正编辑过的分子的UMI家族，正确的碱基就是那个替换碱基。除非发生错误，将其翻转为其他三种碱基之一，否则读数将显示这个正确的替换碱基。测序错误的概率是 $p_{s}$，而带有PCR错误的分子的预期比例是 $2\\epsilon_{p}(1-2^{-C})$。一条读数正确显示替换碱基的概率 $q_{1}$ 是1减去这些错误概率之和：\n$$\nq_{1} \\approx 1 - p_{s} - 2 \\epsilon_{p} \\left(1 - 2^{-C}\\right)\n$$\n对于这样一个已编辑的家族，支持替换碱基的读数数量服从试验次数为 $r$、成功概率为 $q_{1}$ 的二项分布。一个变异共有序列的概率 $\\pi_{1}$ 是 $k \\ge m$ 的概率：\n$$\n\\pi_{1} = P(k \\ge m) = \\sum_{k=m}^{r} \\binom{r}{k} q_{1}^{k} \\left(1 - q_{1}\\right)^{r-k}\n$$\n至此，完成了所需概率表达式的推导。\n\n其次，我们构建似然比检验统计量。\n观测值是 $X$，即在总共 $N$ 个UMI家族中，具有变异共有序列的家族数量。设 $f$ 是真实已编辑分子的比例。任何单个家族具有变异共有序列的概率为 $\\pi(f) = f \\pi_{1} + (1-f) \\pi_{0}$。观察到的变异家族数量 $X$ 可被模型化为从二项分布 $X \\sim \\text{Binomial}(N, \\pi(f))$ 中抽取的一个值。其似然函数为：\n$$\nL(f) = \\binom{N}{X} [\\pi(f)]^{X} [1 - \\pi(f)]^{N-X}\n$$\n似然比检验统计量为 $\\Lambda = \\frac{L(\\mathcal{H}_{0})}{\\sup_{\\mathcal{H}_{1}} L(f)}$。在 $\\mathcal{H}_{0}$ 下，$f=0$，所以分子是 $L(0) = \\binom{N}{X} \\pi_{0}^{X} (1 - \\pi_{0})^{N-X}$。\n分母是在参数空间 $f \\in [0,1]$ 上最大化的似然。当 $\\pi(f)$ 等于其最大似然估计（MLE）时，似然达到最大值。对于二项分布，MLE是样本比例，即 $\\hat{\\pi} = X/N$。因此，$\\max_{f \\in [0,1]} L(f) = L(\\hat{f})$，其中 $\\hat{f}$ 是使 $\\pi(\\hat{f}) = X/N$ 成立的 $f$ 值。这给出 $\\hat{f} = \\frac{X/N - \\pi_0}{\\pi_1 - \\pi_0}$。只要 $0 \\le \\hat{f} \\le 1$，最大化的似然为：\n$$\n\\sup_{f \\in [0,1]} L(f) = \\binom{N}{X} \\left(\\frac{X}{N}\\right)^{X} \\left(1 - \\frac{X}{N}\\right)^{N-X}\n$$\n因此，似然比为：\n$$\n\\Lambda = \\frac{\\binom{N}{X} \\pi_{0}^{X} (1 - \\pi_{0})^{N-X}}{\\binom{N}{X} (X/N)^{X} (1 - X/N)^{N-X}} = \\left(\\frac{\\pi_{0}}{X/N}\\right)^{X} \\left(\\frac{1 - \\pi_{0}}{1 - X/N}\\right)^{N-X}\n$$\n该检验统计量通常表示为渐近服从 $\\chi^2$ 分布的形式 $-2 \\ln \\Lambda$：\n$$\n-2 \\ln \\Lambda = -2 \\left[ X \\ln\\left(\\frac{\\pi_{0}}{X/N}\\right) + (N-X) \\ln\\left(\\frac{1 - \\pi_{0}}{1 - X/N}\\right) \\right]\n$$\n为了更清晰，可以重写为：\n$$\n-2 \\ln \\Lambda = 2 \\left[ X \\ln\\left(\\frac{X/N}{\\pi_{0}}\\right) + (N-X) \\ln\\left(\\frac{1 - X/N}{1 - \\pi_{0}}\\right) \\right]\n$$\n这就是所要求的表达式。它等价于拟合优度的G检验统计量，用于比较观测频数（$X, N-X$）与在 $\\mathcal{H}_{0}$ 下的期望频数（$N\\pi_0, N(1-\\pi_0)$）。\n\n第三，我们使用给定的数据数值计算 $-2 \\ln \\Lambda$：$N = 1000$，$r = 5$，$m = 4$，$X = 6$，$Q = 35$，$C = 20$，以及 $\\epsilon_{p} = 1.0 \\times 10^{-6}$。\n\n1.  计算 $p_s$：\n    $p_{s} = 10^{-Q/10} = 10^{-35/10} = 10^{-3.5} \\approx 3.162278 \\times 10^{-4}$。\n\n2.  计算PCR错误部分：\n    $2 \\epsilon_{p} (1 - 2^{-C}) = 2 \\times 10^{-6} (1 - 2^{-20}) \\approx 2 \\times 10^{-6} (1 - 9.5367 \\times 10^{-7}) \\approx 1.999998 \\times 10^{-6}$。\n\n3.  计算 $p_0$：\n    $p_{0} = \\frac{1}{3} \\left[ p_{s} + 2 \\epsilon_{p} (1 - 2^{-C}) \\right] \\approx \\frac{1}{3} (3.162278 \\times 10^{-4} + 1.999998 \\times 10^{-6}) \\approx \\frac{3.182278 \\times 10^{-4}}{3} \\approx 1.060759 \\times 10^{-4}$。\n\n4.  计算 $\\pi_0$：\n    $\\pi_{0} = \\sum_{k=4}^{5} \\binom{5}{k} p_{0}^{k} (1 - p_{0})^{5-k} = \\binom{5}{4}p_{0}^{4}(1-p_{0}) + \\binom{5}{5}p_{0}^{5} = p_{0}^{4}(5(1-p_{0}) + p_{0}) = p_{0}^{4}(5 - 4p_{0})$。\n    鉴于 $p_{0}$ 非常小，$\\pi_0 \\approx 5 p_{0}^{4}$。\n    $\\pi_{0} \\approx 5 \\times (1.060759 \\times 10^{-4})^{4} \\approx 5 \\times (1.26296 \\times 10^{-16}) \\approx 6.3148 \\times 10^{-16}$。\n\n5.  计算检验统计量的各组成部分：\n    观察到的变异家族比例是 $\\hat{p} = X/N = 6/1000 = 0.006$。\n    由于 $\\hat{p} \\gg \\pi_0$， $f$ 的MLE是正数，因此 $-2 \\ln \\Lambda$ 的公式适用。\n\n    方括号内的第一项是 $X \\ln(\\frac{X/N}{\\pi_{0}})$。\n    $\\frac{X/N}{\\pi_{0}} \\approx \\frac{0.006}{6.3148 \\times 10^{-16}} \\approx 9.5015 \\times 10^{12}$。\n    $\\ln(9.5015 \\times 10^{12}) \\approx 29.882$。\n    $X \\ln(\\frac{X/N}{\\pi_{0}}) \\approx 6 \\times 29.882 = 179.292$。\n\n    第二项是 $(N-X) \\ln(\\frac{1-X/N}{1-\\pi_0})$。由于 $\\pi_0$ 与1相比可以忽略不计，此项约等于 $(N-X) \\ln(1-X/N)$。\n    $(1000 - 6) \\ln(1 - 0.006) = 994 \\ln(0.994) \\approx 994 \\times (-0.0060181) \\approx -5.982$。\n\n6.  计算最终值：\n    $-2 \\ln \\Lambda = 2 \\times (179.292 - 5.982) = 2 \\times 173.31 = 346.62$。\n\n四舍五入到四位有效数字，最终值为 $346.6$。对于一个自由度为1的 $\\chi^2$ 统计量来说，这是一个极大的值，表明原假设（$\\mathcal{H}_{0}$）以非常高的置信度被拒绝。\n\n使用更高精度的最终计算：\n$p_0 \\approx 1.0607592 \\times 10^{-4}$。\n$\\pi_0 \\approx 6.314220 \\times 10^{-16}$。\n$-2 \\ln \\Lambda = 2 \\left[ 6 \\ln\\left(\\frac{0.006}{6.314220 \\times 10^{-16}}\\right) + 994 \\ln\\left(\\frac{0.994}{1 - 6.314220 \\times 10^{-16}}\\right) \\right]$\n$= 2 \\left[ 6 \\times \\ln(9.50236 \\times 10^{12}) + 994 \\times \\ln(0.994000...) \\right]$\n$= 2 \\left[ 6 \\times 29.88257 + 994 \\times (-0.0060181) \\right]$\n$= 2 \\left[ 179.2954 - 5.9820 \\right] = 2 \\times 173.3134 = 346.6268$。\n\n四舍五入到四位有效数字得到 $346.6$。", "answer": "$$\\boxed{346.6}$$", "id": "2754083"}]}