{"hands_on_practices": [{"introduction": "CAR-T 细胞的功能效力始于其表面嵌合抗原受体（CAR）的表达水平。然而，在单个细胞中，由于基因表达的随机性，受体的数量并非恒定不变，而是处于动态波动之中。本练习将指导您使用系统生物学中的一个基本工具——生灭过程（birth-death process），来量化描述这种随机性[@problem_id:2720770]。通过从化学主方程（Chemical Master Equation）出发推导 CAR 分子数量的稳态分布，您将能深刻理解CAR表达的变异性来源，并掌握评估这种变异性对细胞功能影响的基础定量技能。", "problem": "单个经基因工程改造、在组成型启动子下表达嵌合抗原受体（CAR）的T淋巴细胞，其在受体-蛋白水平上的模型如下。质膜上的CAR分子数量，记为 $N(t)$，由于两种相反的过程，作为一个在非负整数上进行演化的连续时间马尔可夫过程：(i) 一个有效的零级生成过程，速率为常数 $\\alpha$（单位时间内的分子数），该过程将转录、翻译和运输到膜上视为一个单一的粗粒化步骤；(ii) 一个一级降解过程，速率为 $\\delta N(t)$（单位时间内），代表内吞和降解，其中 $\\delta$ 为一个常数。假设细胞内环境充分混合，环境条件恒定，且该过程满足化学主方程（CME）的基本假设，即事件的发生是具有给定倾向性的无记忆泊松过程。\n\n从CME所编码的基本随机动力学以及零级生成和一级死亡的生灭过程的定义出发，推导 $N$ 的稳态概率分布，然后计算CAR数量的稳态均值和方差。请从第一性原理出发给出您的推理过程，并且不要先验地假设稳态分布的任何特定形式。\n\n以行矩阵 $\\begin{pmatrix}\\mu_{\\mathrm{ss}} & \\sigma_{\\mathrm{ss}}^{2}\\end{pmatrix}$ 的形式，用 $\\alpha$ 和 $\\delta$ 表示您的最终答案。不需要数值近似，最终答案中不应包含单位。如果得到闭式解，请保持其精确形式，不要四舍五入。", "solution": "问题陈述已经过分析，并被确定为有效。它具有科学依据，问题定义明确，客观且内部一致，是随机系统生物学中的一个典型问题。我们可以开始求解。\n\n该系统将细胞膜上的CAR分子数量 $N$ 描述为一个连续时间生灭过程。系统的状态是整数 $n$，代表分子的数量。两个随机过程如下：\n1. 生成（出生）：一个物种，我们可以表示为 $\\emptyset$，转化为一个CAR分子 $N$。反应为 $\\emptyset \\xrightarrow{\\alpha} N$。这是一个零级过程，意味着其倾向性（速率）是恒定的，与现有分子的数量无关。对于具有 $n$ 个分子的状态，其生成速率为 $b_n = \\alpha$。\n2. 降解（死亡）：一个CAR分子 $N$ 从系统中移除。反应为 $N \\xrightarrow{\\delta} \\emptyset$。这是一个一级过程，意味着其倾向性与存在的分子数量成正比。对于具有 $n$ 个分子的状态，其降解速率为 $d_n = \\delta n$。\n\n设 $P(n, t)$ 为在时间 $t$ 有 $n$ 个分子的概率。该概率分布的时间演化由化学主方程（CME）控制。状态 $n$ 概率的变化 $\\frac{dP(n, t)}{dt}$，是流入状态 $n$ 的概率通量之和减去流出状态 $n$ 的概率通量之和。\n\n流入状态 $n$ 的通量：\n- 通过生成从状态 $n-1$ 流入：倾向性为 $\\alpha$，因此通量为 $\\alpha P(n-1, t)$。\n- 通过降解从状态 $n+1$ 流入：倾向性为 $\\delta(n+1)$，因此通量为 $\\delta(n+1) P(n+1, t)$。\n\n流出状态 $n$ 的通量：\n- 通过生成流向状态 $n+1$：倾向性为 $\\alpha$，因此通量为 $\\alpha P(n, t)$。\n- 通过降解流向状态 $n-1$：倾向性为 $\\delta n$，因此通量为 $\\delta n P(n, t)$。\n\n因此，CME为：\n$$ \\frac{dP(n, t)}{dt} = \\alpha P(n-1, t) + \\delta(n+1)P(n+1, t) - (\\alpha + \\delta n)P(n, t) \\quad \\text{for } n \\ge 1 $$\n必须考虑 $n=0$ 的特殊情况，因为不可能从状态 $n=-1$ 跃迁而来，也无法从状态 $n=0$ 发生降解：\n$$ \\frac{dP(0, t)}{dt} = \\delta P(1, t) - \\alpha P(0, t) $$\n\n我们寻求稳态概率分布 $P_{\\mathrm{ss}}(n)$，其中对所有 $n$ 都有 $\\frac{dP_{\\mathrm{ss}}(n)}{dt} = 0$。为简化起见，我们用 $P(n)$ 表示此分布。稳态方程为：\n$$ 0 = \\alpha P(n-1) + \\delta(n+1)P(n+1) - (\\alpha + \\delta n)P(n) \\quad \\text{for } n \\ge 1 $$\n$$ 0 = \\delta P(1) - \\alpha P(0) \\quad \\text{for } n = 0 $$\n对于处于稳态的一维生灭过程，任何两个相邻状态之间的净概率通量必须为零。这个原理被称为细致平衡。从状态 $n$ 到 $n+1$ 的通量是由生成引起的，等于 $\\alpha P(n)$。从 $n+1$ 到 $n$ 的通量是由降解引起的，等于 $\\delta(n+1)P(n+1)$。将两者相等，得到细致平衡条件：\n$$ \\alpha P(n) = \\delta(n+1) P(n+1) \\quad \\text{for } n \\ge 0 $$\n这个单一的递推关系等价于全套稳态主方程。我们可以通过迭代求解，用 $P(0)$ 表示 $P(n)$：\n$$ P(n+1) = \\frac{\\alpha}{\\delta(n+1)} P(n) $$\n对于 $n=0$：$P(1) = \\frac{\\alpha}{\\delta(1)}P(0) = \\frac{\\alpha}{\\delta}P(0)$\n对于 $n=1$：$P(2) = \\frac{\\alpha}{\\delta(2)}P(1) = \\frac{\\alpha}{2\\delta} \\left(\\frac{\\alpha}{\\delta}P(0)\\right) = \\frac{1}{2}\\left(\\frac{\\alpha}{\\delta}\\right)^2 P(0)$\n继续这个过程，我们可以看到一个模式浮现出来：\n$P(n) = \\frac{\\alpha}{n\\delta} P(n-1) = \\frac{\\alpha}{n\\delta} \\frac{\\alpha}{(n-1)\\delta} \\cdots \\frac{\\alpha}{1\\delta} P(0) = \\frac{1}{n!} \\left(\\frac{\\alpha}{\\delta}\\right)^n P(0)$.\n\n为了确定 $P(0)$，我们使用归一化条件，即所有概率的总和必须等于1：\n$$ \\sum_{n=0}^{\\infty} P(n) = 1 $$\n$$ \\sum_{n=0}^{\\infty} \\frac{1}{n!} \\left(\\frac{\\alpha}{\\delta}\\right)^n P(0) = 1 $$\n$$ P(0) \\sum_{n=0}^{\\infty} \\frac{1}{n!} \\left(\\frac{\\alpha}{\\delta}\\right)^n = 1 $$\n该和式是指数函数的泰勒级数展开，$\\sum_{k=0}^{\\infty} \\frac{x^k}{k!} = \\exp(x)$。令 $x = \\alpha/\\delta$，我们得到：\n$$ P(0) \\exp\\left(\\frac{\\alpha}{\\delta}\\right) = 1 \\implies P(0) = \\exp\\left(-\\frac{\\alpha}{\\delta}\\right) $$\n将此结果代回 $P(n)$ 的表达式中，我们得到稳态分布：\n$$ P(n) = \\frac{(\\alpha/\\delta)^n}{n!} \\exp\\left(-\\frac{\\alpha}{\\delta}\\right) $$\n这是一个参数为 $\\lambda = \\frac{\\alpha}{\\delta}$ 的泊松分布。\n\n现在，我们计算稳态均值 $\\mu_{\\mathrm{ss}}$ 和方差 $\\sigma_{\\mathrm{ss}}^2$。\n均值是 $N$ 的期望值：\n$$ \\mu_{\\mathrm{ss}} = \\langle N \\rangle = \\sum_{n=0}^{\\infty} n P(n) $$\n对于参数为 $\\lambda$ 的泊松分布，其均值为 $\\lambda$。我们从第一性原理证明这一点：\n$$ \\mu_{\\mathrm{ss}} = \\sum_{n=0}^{\\infty} n \\frac{\\lambda^n}{n!} \\exp(-\\lambda) = \\exp(-\\lambda) \\sum_{n=1}^{\\infty} n \\frac{\\lambda^n}{n!} $$\n因为当 $n \\ge 1$ 时，$n/n! = 1/(n-1)!$：\n$$ \\mu_{\\mathrm{ss}} = \\exp(-\\lambda) \\sum_{n=1}^{\\infty} \\frac{\\lambda^n}{(n-1)!} $$\n令 $k=n-1$。和式变为：\n$$ \\mu_{\\mathrm{ss}} = \\exp(-\\lambda) \\sum_{k=0}^{\\infty} \\frac{\\lambda^{k+1}}{k!} = \\lambda \\exp(-\\lambda) \\sum_{k=0}^{\\infty} \\frac{\\lambda^k}{k!} = \\lambda \\exp(-\\lambda) \\exp(\\lambda) = \\lambda $$\n因此，稳态均值为 $\\mu_{\\mathrm{ss}} = \\frac{\\alpha}{\\delta}$。\n\n接下来，我们计算方差 $\\sigma_{\\mathrm{ss}}^2 = \\langle N^2 \\rangle - \\mu_{\\mathrm{ss}}^2$。\n对于泊松分布，其方差也等于其参数 $\\lambda$。我们通过先计算二阶阶乘矩 $\\langle N(N-1) \\rangle$ 来推导这一点：\n$$ \\langle N(N-1) \\rangle = \\sum_{n=0}^{\\infty} n(n-1) P(n) = \\exp(-\\lambda) \\sum_{n=2}^{\\infty} n(n-1) \\frac{\\lambda^n}{n!} $$\n求和从 $n=2$ 开始，因为当 $n=0,1$ 时因子 $n(n-1)$ 为零。\n$$ \\langle N(N-1) \\rangle = \\exp(-\\lambda) \\sum_{n=2}^{\\infty} \\frac{\\lambda^n}{(n-2)!} $$\n令 $k=n-2$。和式变为：\n$$ \\langle N(N-1) \\rangle = \\exp(-\\lambda) \\sum_{k=0}^{\\infty} \\frac{\\lambda^{k+2}}{k!} = \\lambda^2 \\exp(-\\lambda) \\sum_{k=0}^{\\infty} \\frac{\\lambda^k}{k!} = \\lambda^2 \\exp(-\\lambda) \\exp(\\lambda) = \\lambda^2 $$\n二阶矩 $\\langle N^2 \\rangle$ 与阶乘矩的关系为 $\\langle N^2 \\rangle = \\langle N(N-1) \\rangle + \\langle N \\rangle$。\n$$ \\langle N^2 \\rangle = \\lambda^2 + \\lambda $$\n于是方差为：\n$$ \\sigma_{\\mathrm{ss}}^2 = \\langle N^2 \\rangle - \\mu_{\\mathrm{ss}}^2 = (\\lambda^2 + \\lambda) - (\\lambda)^2 = \\lambda $$\n因此，稳态方差为 $\\sigma_{\\mathrm{ss}}^2 = \\frac{\\alpha}{\\delta}$。\n\n总之，对于给定的生灭过程，CAR分子的稳态数量服从参数为 $\\lambda = \\alpha/\\delta$ 的泊松分布。其均值和方差均等于此参数。\n$\\mu_{\\mathrm{ss}} = \\frac{\\alpha}{\\delta}$\n$\\sigma_{\\mathrm{ss}}^2 = \\frac{\\alpha}{\\delta}$\n要求的结果是行矩阵 $\\begin{pmatrix}\\mu_{\\mathrm{ss}} & \\sigma_{\\mathrm{ss}}^{2}\\end{pmatrix}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\alpha}{\\delta} & \\frac{\\alpha}{\\delta}\n\\end{pmatrix}\n}\n$$", "id": "2720770"}, {"introduction": "CAR-T 疗法成功的关键在于精确区分表达高密度靶抗原的肿瘤细胞和可能表达低密度相同抗原的健康细胞。这本质上是一个信号检测和分类问题，CAR-T 细胞必须设定一个最佳的激活阈值 $\\theta$ 来做出“攻击”或“忽略”的决定。本练习将引导您应用贝叶斯决策理论，在一个符合生物学实际的对数正态分布模型下，推导出能使总分类错误率（即错误攻击健康细胞与错失攻击肿瘤细胞）最小化的最优激活阈值[@problem_id:2720703]。通过这个过程，您将亲手量化并理解在CAR-T设计中，灵敏度（on-tumor efficacy）与特异性（off-tumor safety）之间无法回避的权衡关系。", "problem": "嵌合抗原受体T细胞（CAR-T细胞）经过工程化改造，当其遇到表面抗原密度超过一个可调信号阈值（表示为 $\\theta$ 分子/细胞）的靶细胞时，便会激活。\n\n考虑一种抗原，其在肿瘤细胞上的单细胞拷贝数由对数正态随机变量 $A_{T} \\sim \\mathrm{LogNormal}(\\mu_{T}, \\sigma^{2})$ 建模，在健康旁观者细胞上的单细胞拷贝数由 $A_{H} \\sim \\mathrm{LogNormal}(\\mu_{H}, \\sigma^{2})$ 建模，其中 $\\ln(A_{T}) \\sim \\mathcal{N}(\\mu_{T}, \\sigma^{2})$ 且 $\\ln(A_{H}) \\sim \\mathcal{N}(\\mu_{H}, \\sigma^{2})$。假设肿瘤细胞的中位数为 $10^{5}$ 分子/细胞，健康细胞的中位数为 $10^{3}$ 分子/细胞，因此 $\\mu_{T} = \\ln(10^{5})$ 且 $\\mu_{H} = \\ln(10^{3})$，共享的对数空间标准差为 $\\sigma = 0.7$。假设在与安全性和疗效相关的遭遇中，随机遇到的细胞是肿瘤细胞的概率为 $p_{T} = 0.4$，是健康细胞的概率为 $p_{H} = 0.6$，并且对健康细胞的错误激活和对肿瘤细胞的漏激活产生相等的分类成本。\n\n使用贝叶斯决策论（Bayesian decision theory）的基本原理和对数正态概率密度的定义，从这些前提出发，推导出能够使总预期分类误差（在给定遭遇概率下，假阳性和假阴性概率之和）最小化的阈值 $\\theta$ 的解析表达式，然后根据上述参数对其进行数值计算。\n\n以分子/细胞为单位表示最终阈值 $\\theta$，并将您的数值答案四舍五入至三位有效数字。\n\n最后，从灵敏度和特异性的角度，定性解释将 $\\theta$ 从误差最小化值增加或减少，如何在靶向肿瘤激活和脱靶安全性之间进行权衡。在本次讨论中，请勿计算任何额外的数值。", "solution": "在尝试求解之前，对问题陈述进行验证。\n\n逐字提取给定的条件如下：\n- CAR-T细胞的激活阈值为 $\\theta$。\n- 肿瘤细胞上的抗原拷贝数 $A_{T}$ 服从对数正态分布：$A_{T} \\sim \\mathrm{LogNormal}(\\mu_{T}, \\sigma^{2})$。\n- 健康细胞上的抗原拷贝数 $A_{H}$ 服从对数正态分布：$A_{H} \\sim \\mathrm{LogNormal}(\\mu_{H}, \\sigma^{2})$。\n- 与正态分布的关系为 $\\ln(A_{T}) \\sim \\mathcal{N}(\\mu_{T}, \\sigma^{2})$ 且 $\\ln(A_{H}) \\sim \\mathcal{N}(\\mu_{H}, \\sigma^{2})$。\n- 肿瘤细胞的中位抗原计数为 $10^{5}$，意味着 $\\mu_{T} = \\ln(10^{5})$。\n- 健康细胞的中位抗原计数为 $10^{3}$，意味着 $\\mu_{H} = \\ln(10^{3})$。\n- 共享的对数空间标准差为 $\\sigma = 0.7$。\n- 遇到肿瘤细胞的概率为 $p_{T} = 0.4$。\n- 遇到健康细胞的概率为 $p_{H} = 0.6$。\n- 对健康细胞的错误激活（假阳性）和对肿瘤细胞的漏激活（假阴性）的分类成本相等。\n\n该问题具有科学依据，使用标准的统计模型来描述生物量，并应用了贝叶斯决策论。问题提法明确，提供了所有必需的参数（$\\mu_T, \\mu_H, \\sigma, p_T, p_H$）和一个清晰的待最小化目标函数。前提条件在数学上是一致的，没有违反任何物理或逻辑原则。因此，该问题被认为是有效的，可以进行求解。\n\n目标是找到使总预期分类误差最小化的阈值 $\\theta$。分类误差有两种类型：\n1. 假阴性（漏掉肿瘤），其发生概率为 $P(A_{T} \\le \\theta)$。\n2. 假阳性（攻击健康细胞），其发生概率为 $P(A_{H} > \\theta)$。\n\n鉴于与这些误差相关的成本相等，最小化预期成本等同于最小化总误差概率 $E(\\theta)$，即每种误差类型概率的加权和。权重是遇到每种细胞类型的先验概率 $p_T$ 和 $p_H$。\n$$E(\\theta) = p_{T} P(A_{T} \\le \\theta) + p_{H} P(A_{H} > \\theta)$$\n设 $f_{T}(a)$ 和 $f_{H}(a)$ 分别为随机变量 $A_{T}$ 和 $A_{H}$ 的概率密度函数（PDF）。误差函数可以写成积分形式：\n$$E(\\theta) = p_{T} \\int_{0}^{\\theta} f_{T}(a) da + p_{H} \\int_{\\theta}^{\\infty} f_{H}(a) da$$\n为了找到使 $E(\\theta)$ 最小化的 $\\theta$ 值，我们计算 $E(\\theta)$ 关于 $\\theta$ 的导数并将其设为零。根据微积分基本定理（特别是莱布尼茨积分法则）：\n$$\\frac{d}{d\\theta} \\left( \\int_{0}^{\\theta} f_{T}(a) da \\right) = f_{T}(\\theta)$$\n$$\\frac{d}{d\\theta} \\left( \\int_{\\theta}^{\\infty} f_{H}(a) da \\right) = -f_{H}(\\theta)$$\n因此，误差函数的导数是：\n$$\\frac{dE(\\theta)}{d\\theta} = p_{T} f_{T}(\\theta) - p_{H} f_{H}(\\theta)$$\n将导数设为零，得到最优阈值的条件，我们将其表示为 $\\theta_{\\text{opt}}$：\n$$p_{T} f_{T}(\\theta_{\\text{opt}}) = p_{H} f_{H}(\\theta_{\\text{opt}})$$\n这是贝叶斯决策论的一个标准结果：最优决策边界位于两类后验概率相等之处，对于相等成本的情况，这简化为由先验加权的似然相等。\n\n参数为 $\\mu$ 和 $\\sigma^2$ 的对数正态分布的PDF由下式给出：\n$$f(a) = \\frac{1}{a\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{(\\ln(a)-\\mu)^2}{2\\sigma^2}\\right)$$\n将 $A_T$ 和 $A_H$ 的PDF代入最优性条件：\n$$p_{T} \\frac{1}{\\theta_{\\text{opt}}\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{(\\ln(\\theta_{\\text{opt}})-\\mu_{T})^2}{2\\sigma^2}\\right) = p_{H} \\frac{1}{\\theta_{\\text{opt}}\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{(\\ln(\\theta_{\\text{opt}})-\\mu_{H})^2}{2\\sigma^2}\\right)$$\n在 $\\theta_{\\text{opt}} > 0$（这是保证的）的情况下，公共因子 $\\frac{1}{\\theta_{\\text{opt}}\\sigma\\sqrt{2\\pi}}$ 从两边消去。\n$$p_{T} \\exp\\left(-\\frac{(\\ln(\\theta_{\\text{opt}})-\\mu_{T})^2}{2\\sigma^2}\\right) = p_{H} \\exp\\left(-\\frac{(\\ln(\\theta_{\\text{opt}})-\\mu_{H})^2}{2\\sigma^2}\\right)$$\n取两边的自然对数：\n$$\\ln(p_{T}) - \\frac{(\\ln(\\theta_{\\text{opt}})-\\mu_{T})^2}{2\\sigma^2} = \\ln(p_{H}) - \\frac{(\\ln(\\theta_{\\text{opt}})-\\mu_{H})^2}{2\\sigma^2}$$\n为了求解 $\\theta_{\\text{opt}}$，我们首先求解 $x = \\ln(\\theta_{\\text{opt}})$。整理方程：\n$$(x-\\mu_{H})^2 - (x-\\mu_{T})^2 = 2\\sigma^2 (\\ln(p_{H}) - \\ln(p_{T}))$$\n展开平方项：\n$$(x^2 - 2x\\mu_{H} + \\mu_{H}^2) - (x^2 - 2x\\mu_{T} + \\mu_{T}^2) = 2\\sigma^2 \\ln\\left(\\frac{p_{H}}{p_{T}}\\right)$$\n$$-2x\\mu_{H} + \\mu_{H}^2 + 2x\\mu_{T} - \\mu_{T}^2 = 2\\sigma^2 \\ln\\left(\\frac{p_{H}}{p_{T}}\\right)$$\n$$2x(\\mu_{T} - \\mu_{H}) - (\\mu_{T}^2 - \\mu_{H}^2) = 2\\sigma^2 \\ln\\left(\\frac{p_{H}}{p_{T}}\\right)$$\n因式分解 $\\mu_{T}^2 - \\mu_{H}^2 = (\\mu_{T} - \\mu_{H})(\\mu_{T} + \\mu_{H})$：\n$$2x(\\mu_{T} - \\mu_{H}) - (\\mu_{T} - \\mu_{H})(\\mu_{T} + \\mu_{H}) = 2\\sigma^2 \\ln\\left(\\frac{p_{H}}{p_{T}}\\right)$$\n$$2x(\\mu_{T} - \\mu_{H}) = (\\mu_{T} - \\mu_{H})(\\mu_{T} + \\mu_{H}) + 2\\sigma^2 \\ln\\left(\\frac{p_{H}}{p_{T}}\\right)$$\n两边除以 $2(\\mu_{T} - \\mu_{H})$（因为 $\\mu_T \\neq \\mu_H$，所以该项非零）：\n$$x = \\frac{\\mu_{T} + \\mu_{H}}{2} + \\frac{\\sigma^2}{\\mu_{T} - \\mu_{H}} \\ln\\left(\\frac{p_{H}}{p_{T}}\\right)$$\n将 $x = \\ln(\\theta_{\\text{opt}})$ 代回，我们得到其自然对数的解析表达式：\n$$\\ln(\\theta_{\\text{opt}}) = \\frac{\\mu_{T} + \\mu_{H}}{2} + \\frac{\\sigma^2}{\\mu_{T} - \\mu_{H}} \\ln\\left(\\frac{p_{H}}{p_{T}}\\right)$$\n对两边取指数，得到最优阈值 $\\theta$ 的最终解析表达式：\n$$\\theta_{\\text{opt}} = \\exp\\left( \\frac{\\mu_{T} + \\mu_{H}}{2} + \\frac{\\sigma^2}{\\mu_{T} - \\mu_{H}} \\ln\\left(\\frac{p_{H}}{p_{T}}\\right) \\right)$$\n现在，我们用给定的参数对该表达式进行数值计算：\n$\\mu_T = \\ln(10^5)$\n$\\mu_H = \\ln(10^3)$\n$\\sigma = 0.7 \\implies \\sigma^2 = 0.49$\n$p_T = 0.4$\n$p_H = 0.6$\n首先，计算指数中的各项：\n$\\frac{\\mu_{T} + \\mu_{H}}{2} = \\frac{\\ln(10^5) + \\ln(10^3)}{2} = \\frac{\\ln(10^5 \\cdot 10^3)}{2} = \\frac{\\ln(10^8)}{2} = 4\\ln(10) = \\ln(10^4)$.\n$\\mu_{T} - \\mu_{H} = \\ln(10^5) - \\ln(10^3) = \\ln\\left(\\frac{10^5}{10^3}\\right) = \\ln(100) = 2\\ln(10)$.\n$\\frac{p_{H}}{p_{T}} = \\frac{0.6}{0.4} = 1.5$.\n将这些代入 $\\ln(\\theta_{\\text{opt}})$ 的表达式中：\n$$\\ln(\\theta_{\\text{opt}}) = \\ln(10^4) + \\frac{0.49}{2\\ln(10)} \\ln(1.5)$$\n$$\\theta_{\\text{opt}} = \\exp\\left( \\ln(10^4) + \\frac{0.49 \\ln(1.5)}{2\\ln(10)} \\right) = \\exp(\\ln(10^4)) \\cdot \\exp\\left(\\frac{0.49 \\ln(1.5)}{2\\ln(10)}\\right)$$\n$$\\theta_{\\text{opt}} = 10^4 \\cdot \\exp\\left(\\frac{0.49 \\times 0.405465...}{2 \\times 2.302585...}\\right) = 10^4 \\cdot \\exp\\left(\\frac{0.198677...}{4.605170...}\\right)$$\n$$\\theta_{\\text{opt}} = 10^4 \\cdot \\exp(0.043141...) = 10^4 \\cdot (1.04408...) \\approx 10440.8$$\n四舍五入到三位有效数字，最优阈值为 $10400$ 分子/细胞，即 $1.04 \\times 10^4$。\n\n最后，对权衡进行定性解释。CAR-T细胞作为分类器的性能由其灵敏度和特异性来描述。\n- **灵敏度**，或称真阳性率，是在给定肿瘤细胞的情况下激活的概率：$P(A_T > \\theta)$。这对应于靶向肿瘤的疗效。\n- **特异性**，或称真阴性率，是在给定健康细胞的情况下不激活的概率：$P(A_H \\le \\theta)$。这对应于脱靶安全性。\n最优阈值 $\\theta_{\\text{opt}}$ 是使特定的误差加权和最小化的值。偏离该值会改变灵敏度和特异性之间的平衡。\n\n- 将 $\\theta$ 从 $\\theta_{\\text{opt}}$ **增加**会使激活更加困难。这增加了CAR-T细胞的激活严格性。因此，在健康细胞上激活的概率降低，导致特异性增加（$P(A_H \\le \\theta)$ 增加）。这改善了脱靶安全性。然而，在肿瘤细胞上激活的概率也随之降低，导致灵敏度下降（$P(A_T > \\theta)$ 下降）。这降低了靶向肿瘤的疗效。因此，增加 $\\theta$ 是以牺牲灵敏度来换取特异性。\n\n- 将 $\\theta$ 从 $\\theta_{\\text{opt}}$ **减少**会使激活更容易。这降低了CAR-T细胞的激活严格性。因此，在肿瘤细胞上激活的概率增加，导致灵敏度提高（$P(A_T > \\theta)$ 增加）。这增强了靶向肿瘤的疗效。然而，在健康细胞上激活的概率也随之增加，意味着在健康细胞上不激活的概率降低。这是特异性的下降（$P(A_H \\le \\theta)$ 下降），损害了脱靶安全性。因此，减少 $\\theta$ 是以牺牲特异性来换取灵敏度。\n计算出的 $\\theta_{\\text{opt}}$ 代表了在给定先验和相等误差成本下，通过理性推导得出的平衡点。", "answer": "$$\n\\boxed{1.04 \\times 10^{4}}\n$$", "id": "2720703"}, {"introduction": "CAR设计的核心之一是选择胞内共刺激结构域，例如 CD28 或 4-1BB，这一选择深刻地影响了CAR-T细胞在患者体内的长期动态行为。不同的共刺激信号会转化为不同的细胞增殖、分化和存活速率，最终决定了疗效的强度与持久性。这个综合性练习将理论与实践相结合，要求您通过建立并求解一个常微分方程组（ODEs）来模拟CAR-T细胞的群体动力学[@problem_id:2720765]。您将亲手实现这个“生灭-分化”模型，并定量比较不同共刺激结构域（CD28 vs. 4-1BB）如何影响细胞的克隆扩增轨迹、峰值时间以及长期持久性，从而将分子层面的设计决策与宏观的治疗结果直接联系起来。", "problem": "使用一个极简的双室出生-死亡-分化模型，来比较嵌合抗原受体T细胞（chimeric antigen receptor T cell, CAR-T）的克隆扩增轨迹，这些CAR-T细胞经由不同的共刺激结构域工程化改造，特别是分化簇28（Cluster of Differentiation 28, CD28）和4-1BB（也称为TNFRSF9）。该模型追踪一个效应样细胞群体 $E(t)$ 和一个记忆样细胞群体 $M(t)$，其中时间 $t$ 的单位为天。该模型的基本原理是经过充分检验的种群动力学法则：在质量作用假设下，均质区室中的细胞数量遵循线性常微分方程，其系数为单位细胞净速率。\n\n模型定义与假设：\n- 效应样细胞以单位细胞速率 $r$ 增殖，以单位细胞速率 $d$ 死亡，并以单位细胞速率 $k$ 分化为记忆样细胞。因此，$E(t)$ 的单位细胞净速率为 $r - d - k$。\n- 记忆样细胞以单位细胞速率 $r_m$ 增殖，并以单位细胞速率 $d_m$ 死亡。因此，$M(t)$ 的单位细胞净速率为 $r_m - d_m$。\n- 从效应样细胞到记忆样细胞的分化以单位细胞速率 $k$ 发生，并为 $M(t)$ 提供一个与 $E(t)$ 成正比的源项。\n- 初始条件为 $E(0) = E_0$ 和 $M(0) = 0$。\n- 对于给定的共刺激设计 $X \\in \\{\\text{CD28}, \\text{4-1BB}\\}$，参数 $(r_X, d_X)$ 可能不同，而 $(k, r_m, d_m)$ 在一个测试用例中保持不变。\n\n控制方程为\n$$\n\\frac{dE}{dt} = \\left(r - d - k\\right) E, \\qquad \\frac{dM}{dt} = k E + \\left(r_m - d_m\\right) M,\n$$\n其中 $E(0) = E_0$ 且 $M(0) = 0$。定义总细胞数为 $T(t) = E(t) + M(t)$。\n\n任务：\n- 对于下文的每个测试用例，在时间窗口 $t \\in [0, t_{\\max}]$（其中 $t$ 的单位为天）内，计算4-1BB和CD28设计之间的以下三个定量比较：\n  1. 最终时间点的倍数变化\n     $$\n     F = \\frac{T_{\\text{4-1BB}}(t_{\\max})}{T_{\\text{CD28}}(t_{\\max})},\n     $$\n     以小数形式报告（无百分号）。\n  2. 峰值时间的差异\n     $$\n     \\Delta t_{\\text{peak}} = t_{\\text{peak, 4-1BB}} - t_{\\text{peak, CD28}},\n     $$\n     其中 $t_{\\text{peak},X}$ 是 $T_X(t)$ 在 $[0, t_{\\max}]$ 上达到其最大值的时间（以天为单位）；以天为单位报告 $\\Delta t_{\\text{peak}}$。\n  3. 曲线下面积（AUC）的比率\n     $$\n     R_{\\text{AUC}} = \\frac{\\int_{0}^{t_{\\max}} T_{\\text{4-1BB}}(t)\\, dt}{\\int_{0}^{t_{\\max}} T_{\\text{CD28}}(t)\\, dt},\n     $$\n     以小数形式报告（无百分号）。该积分的单位是细胞-天，但仅报告无量纲的比率。\n\n实现约束：\n- 对于 $E(t)$ 和 $M(t)$，使用上述线性系统所蕴含的精确解析解。当参数组合满足 $\\alpha = r - d - k$ 和 $\\beta = r_m - d_m$ 且 $\\alpha = \\beta$ 时，使用 $M(t)$ 的正确极限解。\n- 对于在 $[0, t_{\\max}]$ 上的峰值时间检测和面积计算，可接受使用具有足够分辨率的均匀网格，但每个网格点的模型评估必须使用解析解。时间单位为天，任何报告的时间差也必须以天为单位。\n- 所有报告的数值输出必须四舍五入到6位小数。\n\n测试套件：\n提供以下四个测试用例的结果。在给定的测试用例中，$(k, r_m, d_m, E_0, t_{\\max})$ 是两种设计所共有的，而 $(r, d)$ 在CD28和4-1BB之间有所不同，具体如下。\n\n- 测试用例1（典型权衡：CD28具有较高的增殖率和较高的死亡率，4-1BB具有较低的增殖率和较低的死亡率）：\n  - 公共参数：$k = 0.15\\, \\text{day}^{-1}$，$r_m = 0.05\\, \\text{day}^{-1}$，$d_m = 0.01\\, \\text{day}^{-1}$，$E_0 = 10{,}000$，$t_{\\max} = 30\\, \\text{days}$。\n  - CD28：$r_{\\text{CD28}} = 0.8\\, \\text{day}^{-1}$，$d_{\\text{CD28}} = 0.3\\, \\text{day}^{-1}$。\n  - 4-1-BB：$r_{\\text{4-1BB}} = 0.6\\, \\text{day}^{-1}$，$d_{\\text{4-1BB}} = 0.1\\, \\text{day}^{-1}$。\n\n- 测试用例2（CD28的边界条件，其中 $\\alpha = \\beta$）：\n  - 公共参数：$k = 0.12\\, \\text{day}^{-1}$，$r_m = 0.10\\, \\text{day}^{-1}$，$d_m = 0.02\\, \\text{day}^{-1}$，$E_0 = 20{,}000$，$t_{\\max} = 20\\, \\text{days}$。\n  - CD28：$r_{\\text{CD28}} = 0.5\\, \\text{day}^{-1}$，$d_{\\text{CD28}} = 0.3\\, \\text{day}^{-1}$，这使得 $\\alpha_{\\text{CD28}} = r - d - k = 0.5 - 0.3 - 0.12 = 0.08$ 且 $\\beta = r_m - d_m = 0.10 - 0.02 = 0.08$，所以 $\\alpha_{\\text{CD28}} = \\beta$。\n  - 4-1-BB：$r_{\\text{4-1BB}} = 0.4\\, \\text{day}^{-1}$，$d_{\\text{4-1BB}} = 0.15\\, \\text{day}^{-1}$。\n\n- 测试用例3（作为对照，两种设计具有相同的动力学）：\n  - 公共参数：$k = 0.10\\, \\text{day}^{-1}$，$r_m = 0.05\\, \\text{day}^{-1}$，$d_m = 0.01\\, \\text{day}^{-1}$，$E_0 = 1{,}000$，$t_{\\max} = 10\\, \\text{days}$。\n  - CD28：$r_{\\text{CD28}} = 0.5\\, \\text{day}^{-1}$，$d_{\\text{CD28}} = 0.2\\, \\text{day}^{-1}$。\n  - 4-1-BB：$r_{\\text{4-1BB}} = 0.5\\, \\text{day}^{-1}$，$d_{\\text{4-1BB}} = 0.2\\, \\text{day}^{-1}$。\n\n- 测试用例4（两种设计的效应细胞均为净负增长；较低的死亡率带来生存优势）：\n  - 公共参数：$k = 0.20\\, \\text{day}^{-1}$，$r_m = 0.02\\, \\text{day}^{-1}$，$d_m = 0.03\\, \\text{day}^{-1}$，$E_0 = 50{,}000$，$t_{\\max} = 60\\, \\text{days}$。\n  - CD28：$r_{\\text{CD28}} = 0.25\\, \\text{day}^{-1}$，$d_{\\text{CD28}} = 0.50\\, \\text{day}^{-1}$。\n  - 4-1-BB：$r_{\\text{4-1BB}} = 0.30\\, \\text{day}^{-1}$，$d_{\\text{4-1BB}} = 0.40\\, \\text{day}^{-1}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有测试用例的结果，形式为方括号内以逗号分隔的列表。\n- 输出必须是一个长度为12的扁平化列表，排序为 $[F_1, \\Delta t_{\\text{peak},1}, R_{\\text{AUC},1}, F_2, \\Delta t_{\\text{peak},2}, R_{\\text{AUC},2}, F_3, \\Delta t_{\\text{peak},3}, R_{\\text{AUC},3}, F_4, \\Delta t_{\\text{peak},4}, R_{\\text{AUC},4}]$。\n- 所有数字必须四舍五入到6位小数并无单位报告，但 $\\Delta t_{\\text{peak}}$ 根据其构造，单位默认为天。", "solution": "问题陈述已经过验证，被认为是有效的。它提出了一个基于种群动力学标准线性常微分方程模型的适定初值问题，并应用于CAR-T细胞工程相关领域。所有必要的参数和条件均已提供，任务是客观且数学上精确的。\n\n该模型是一个由两个一阶线性常微分方程组成的系统：\n$$\n\\frac{dE}{dt} = \\left(r - d - k\\right) E\n$$\n$$\n\\frac{dM}{dt} = k E + \\left(r_m - d_m\\right) M\n$$\n初始条件为 $E(0) = E_0$ 和 $M(0) = 0$。\n\n接下来，我们分别定义效应细胞和记忆细胞群体的单位细胞净增长率如下：\n$$\n\\alpha = r - d - k\n$$\n$$\n\\beta = r_m - d_m\n$$\n方程组变为：\n$$\n\\frac{dE}{dt} = \\alpha E\n$$\n$$\n\\frac{dM}{dt} = k E + \\beta M\n$$\n\n首先，我们求解效应细胞群体 $E(t)$。$E(t)$ 的方程是一个标准的指数增长/衰减模型。根据初始条件 $E(0) = E_0$，其解为：\n$$\nE(t) = E_0 e^{\\alpha t}\n$$\n接着，我们将此解代入 $M(t)$ 的方程中：\n$$\n\\frac{dM}{dt} - \\beta M = k E_0 e^{\\alpha t}\n$$\n这是一个一阶线性非齐次微分方程，可以使用积分因子 $I(t) = e^{-\\beta t}$ 求解。解的形式取决于 $\\alpha$ 和 $\\beta$ 是否相等。\n\n情况1：$\\alpha \\neq \\beta$\n乘以积分因子并积分可得：\n$$\n\\frac{d}{dt}(M(t)e^{-\\beta t}) = k E_0 e^{(\\alpha - \\beta)t}\n$$\n$$\nM(t)e^{-\\beta t} = \\frac{k E_0}{\\alpha - \\beta} e^{(\\alpha - \\beta)t} + C\n$$\n使用初始条件 $M(0) = 0$，我们求得积分常数 $C = -\\frac{k E_0}{\\alpha - \\beta}$。\n因此，记忆样细胞群体的解为：\n$$\nM(t) = \\frac{k E_0}{\\alpha - \\beta} \\left( e^{\\alpha t} - e^{\\beta t} \\right)\n$$\n\n情况2：$\\alpha = \\beta$\n在这种特殊情况下，$M(t)$ 的微分方程变为：\n$$\n\\frac{d}{dt}(M(t)e^{-\\alpha t}) = k E_0 e^{(\\alpha - \\alpha)t} = k E_0\n$$\n对 $t$ 积分：\n$$\nM(t)e^{-\\alpha t} = k E_0 t + C\n$$\n初始条件 $M(0)=0$ 意味着 $C=0$。因此解为：\n$$\nM(t) = k E_0 t e^{\\alpha t}\n$$\n\n总细胞数为 $T(t) = E(t) + M(t)$。\n对于 $\\alpha \\neq \\beta$：\n$$\nT(t) = E_0 e^{\\alpha t} + \\frac{k E_0}{\\alpha - \\beta} \\left( e^{\\alpha t} - e^{\\beta t} \\right) = E_0 \\left( \\left(1 + \\frac{k}{\\alpha - \\beta} \\right) e^{\\alpha t} - \\frac{k}{\\alpha - \\beta} e^{\\beta t} \\right)\n$$\n对于 $\\alpha = \\beta$：\n$$\nT(t) = E_0 e^{\\alpha t} + k E_0 t e^{\\alpha t} = E_0 (1 + kt) e^{\\alpha t}\n$$\n\n所需的三个指标计算如下：\n1.  **最终时间点倍数变化, $F$**：通过直接计算解析解 $T_{\\text{4-1BB}}(t)$ 和 $T_{\\text{CD28}}(t)$ 在 $t = t_{\\max}$ 时的值来计算。\n    $$\n    F = \\frac{T_{\\text{4-1BB}}(t_{\\max})}{T_{\\text{CD28}}(t_{\\max})}\n    $$\n2.  **峰值时间的差异, $\\Delta t_{\\text{peak}}$**：对于每种设计，峰值时间 $t_{\\text{peak}}$ 是使 $T(t)$ 在 $t \\in [0, t_{\\max}]$ 上最大化的时间。按照允许的方法，通过在区间 $[0, t_{\\max}]$ 的一个精细均匀时间网格上评估解析解 $T(t)$，并找出其最大值所对应的时间。\n3.  **曲线下面积的比率, $R_{\\text{AUC}}$**：这需要将 $T(t)$ 从 $0$ 积分到 $t_{\\max}$。我们通过分别对 $E(t)$ 和 $M(t)$ 的表达式进行积分来解析地计算它。\n    曲线下的总面积为 $\\text{AUC} = \\int_{0}^{t_{\\max}} E(t) dt + \\int_{0}^{t_{\\max}} M(t) dt$。\n\n    $E(t)$ 的积分：\n    $$ \\int_{0}^{t_{\\max}} E_0 e^{\\alpha t} dt = \\begin{cases} \\frac{E_0}{\\alpha}(e^{\\alpha t_{\\max}} - 1) & \\text{if } \\alpha \\neq 0 \\\\ E_0 t_{\\max} & \\text{if } \\alpha = 0 \\end{cases} $$\n\n    当 $\\alpha \\neq \\beta$ 时，$M(t)$ 的积分：\n    $$ \\int_{0}^{t_{\\max}} M(t) dt = \\frac{k E_0}{\\alpha - \\beta} \\left( \\int_{0}^{t_{\\max}} e^{\\alpha t} dt - \\int_{0}^{t_{\\max}} e^{\\beta t} dt \\right) $$\n    结果取决于 $\\alpha$ 或 $\\beta$ 是否为零，这通过上述指数函数的分情况积分来处理。\n\n    当 $\\alpha = \\beta$ 时，$M(t)$ 的积分：\n    $$ \\int_{0}^{t_{\\max}} k E_0 t e^{\\alpha t} dt = \\begin{cases} \\frac{k E_0}{\\alpha^2} \\left[ e^{\\alpha t_{\\max}}(\\alpha t_{\\max} - 1) + 1 \\right] & \\text{if } \\alpha \\neq 0 \\\\ \\frac{1}{2} k E_0 t_{\\max}^2 & \\text{if } \\alpha = 0 \\end{cases} $$\n    比率 $R_{\\text{AUC}}$ 即为 4-1BB 设计的总 AUC 与 CD28 设计的总 AUC 之比。\n\n提供的 Python 脚本实现了这些解析解和计算过程，以确定每个测试用例所需的指标。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the CAR-T cell population dynamics problem for the given test cases.\n    \"\"\"\n    # Test cases as defined in the problem statement.\n    # Format: ((common parameters), (CD28 parameters), (4-1BB parameters))\n    # common: (k, r_m, d_m, E_0, t_max)\n    # design-specific: (r, d)\n    test_cases = [\n        # Test case 1\n        ((0.15, 0.05, 0.01, 10000, 30), (0.8, 0.3), (0.6, 0.1)),\n        # Test case 2\n        ((0.12, 0.10, 0.02, 20000, 20), (0.5, 0.3), (0.4, 0.15)),\n        # Test case 3\n        ((0.10, 0.05, 0.01, 1000, 10), (0.5, 0.2), (0.5, 0.2)),\n        # Test case 4\n        ((0.20, 0.02, 0.03, 50000, 60), (0.25, 0.50), (0.30, 0.40)),\n    ]\n\n    def get_population_stats(r, d, k, r_m, d_m, E0, t_max):\n        \"\"\"\n        Calculates T_final, t_peak, and AUC for a single design.\n        \"\"\"\n        alpha = r - d - k\n        beta = r_m - d_m\n\n        # Define T(t) function based on analytical solution\n        if np.isclose(alpha, beta):\n            def T_func(t):\n                return E0 * (1 + k * t) * np.exp(alpha * t)\n        else:\n            c1 = 1 + k / (alpha - beta)\n            c2 = -k / (alpha - beta)\n            def T_func(t):\n                return E0 * (c1 * np.exp(alpha * t) + c2 * np.exp(beta * t))\n\n        # 1. Final-time total cell count\n        T_final = T_func(t_max)\n\n        # 2. Peak time detection using a fine grid\n        time_grid = np.linspace(0, t_max, 20001)\n        T_values = T_func(time_grid)\n        peak_idx = np.argmax(T_values)\n        t_peak = time_grid[peak_idx]\n\n        # 3. Area Under the Curve (AUC) via analytical integration\n        # Integral of E(t)\n        if np.isclose(alpha, 0):\n            auc_E = E0 * t_max\n        else:\n            auc_E = E0 / alpha * (np.exp(alpha * t_max) - 1)\n        \n        # Integral of M(t)\n        if np.isclose(alpha, beta):\n            if np.isclose(alpha, 0): # M(t) = k*E0*t\n                auc_M = k * E0 * (t_max**2) / 2\n            else: # M(t) = k*E0*t*exp(alpha*t)\n                term = np.exp(alpha * t_max) * (alpha * t_max - 1) + 1\n                auc_M = k * E0 / (alpha**2) * term\n        else: # alpha != beta\n            const = k * E0 / (alpha - beta)\n            if np.isclose(alpha, 0):\n                term_alpha = t_max\n            else:\n                term_alpha = (np.exp(alpha * t_max) - 1) / alpha\n            \n            if np.isclose(beta, 0):\n                term_beta = t_max\n            else:\n                term_beta = (np.exp(beta * t_max) - 1) / beta\n            \n            auc_M = const * (term_alpha - term_beta)\n            \n        auc_total = auc_E + auc_M\n        \n        return T_final, t_peak, auc_total\n\n    all_results = []\n    for case in test_cases:\n        common_params, cd28_params, bb_params = case\n        k, r_m, d_m, E0, t_max = common_params\n        r_cd28, d_cd28 = cd28_params\n        r_bb, d_bb = bb_params\n        \n        # Calculate for CD28\n        T_final_28, t_peak_28, auc_28 = get_population_stats(r_cd28, d_cd28, k, r_m, d_m, E0, t_max)\n        \n        # Calculate for 4-1BB\n        T_final_bb, t_peak_bb, auc_bb = get_population_stats(r_bb, d_bb, k, r_m, d_m, E0, t_max)\n        \n        # Compute final metrics, handling division by zero for identical cases\n        if np.isclose(T_final_28, 0): F = 1.0 if np.isclose(T_final_bb, 0) else np.inf\n        else: F = T_final_bb / T_final_28\n\n        delta_t_peak = t_peak_bb - t_peak_28\n\n        if np.isclose(auc_28, 0): R_auc = 1.0 if np.isclose(auc_bb, 0) else np.inf\n        else: R_auc = auc_bb / auc_28\n        \n        # Append rounded results\n        all_results.extend([\n            round(F, 6),\n            round(delta_t_peak, 6),\n            round(R_auc, 6)\n        ])\n        \n    # Format the final output string\n    print(f\"[{','.join(f'{x:.6f}' for x in all_results)}]\")\n\nsolve()\n```", "id": "2720765"}]}