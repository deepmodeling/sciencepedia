{"hands_on_practices": [{"introduction": "对任何分裂蛋白系统进行定量理解，都始于对化学平衡基本原理的掌握。本练习旨在引导你从第一性原理出发，推导重构复合物的平衡浓度。掌握这一推导过程，你将获得分析和预测任何蛋白质片段互补分析（PCA）行为的基础数学工具 [@problem_id:2774885]。", "problem": "在合成生物学中使用的蛋白质片段互补 (PFC) 技术中，一个蛋白质被分裂成两个片段（此处表示为片段 $A$ 和片段 $B$），当它们相互结合时，会重构成一个功能性复合物 $C$。考虑一个处于平衡状态的等温、充分混合溶液，其中片段 $A$ 和片段 $B$ 的总分析浓度分别为 $A_T$ 和 $B_T$。假设如下：重构反应的化学计量比为 $1{:}1$，每个片段有单个结合位点，仅形成异源二聚体 $C$（不形成高阶寡聚体或同源二聚体），溶液是理想稀溶液，并且系统遵循质量作用平衡，解离常数为 $K_d$。同时假设 $A_T>0$，$B_T \\ge 0$ 且 $K_d>0$。\n\n从化学平衡和质量守恒的基本原理出发，推导出一个闭式解析表达式，用于表示并入重构复合物中的片段 $A$ 的平衡分数（定义为 $f_A \\equiv C/A_T$），该表达式是关于 $A_T$，$B_T$ 和 $K_d$ 的函数。你的最终答案必须是 $f_A(A_T,B_T,K_d)$ 的单个闭式解析表达式，该表达式对物理相关的平衡分支有效，而不是一个方程组。不需要进行数值计算，并且由于 $f_A$ 是无量纲的，因此不需要单位。", "solution": "在尝试求解之前，对问题陈述进行验证。\n\n步骤 1：提取已知条件。\n- 反应物是片段 $A$ 和片段 $B$。\n- 产物是功能性复合物 $C$。\n- 系统是一个处于平衡状态的等温、充分混合溶液。\n- 总分析浓度为 $A_T$ 和 $B_T$。\n- 重构反应为 $A + B \\rightleftharpoons C$，化学计量比为 $1{:}1$。\n- 每个片段有单个结合位点。\n- 仅形成异源二聚体 $C$。\n- 溶液是理想稀溶液。\n- 系统遵循质量作用平衡，解离常数为 $K_d$。\n- 约束条件为 $A_T > 0$，$B_T \\ge 0$ 且 $K_d > 0$。\n- 待求量为复合物中片段 $A$ 的平衡分数，定义为 $f_A \\equiv C/A_T$。\n- $f_A$ 的最终表达式必须是关于 $A_T$，$B_T$ 和 $K_d$ 的单个闭式解析函数。\n\n步骤 2：使用提取的已知条件进行验证。\n该问题具有科学依据，提法明确且客观。它描述了一个标准的双分子结合平衡，这是物理化学和生物化学中的一个基本概念。该模型基于质量作用定律和质量守恒这两个核心原理。所提供的假设（理想溶液、$1{:}1$ 化学计量、无副反应）是为建立一个可解的解析模型而做的标准简化。该问题是自洽的，定义了求所需量（$f_A$）所需的所有参数（$A_T$、$B_T$、$K_d$）。约束条件在物理上是一致的。验证标准中列出的缺陷均不存在。\n\n步骤 3：结论与行动。\n问题有效。将推导解答。\n\n从片段 $A$ 和 $B$ 重构成功能性复合物 $C$ 的过程由以下平衡反应表示：\n$$\nA + B \\rightleftharpoons C\n$$\n对于处于平衡状态的系统，解离常数 $K_d$ 由质量作用定律定义。考虑解离反应 $C \\rightleftharpoons A + B$ 更为方便。$K_d$ 的表达式为：\n$$\nK_d = \\frac{[A][B]}{[C]}\n$$\n其中 $[A]$、$[B]$ 和 $[C]$ 分别代表游离片段 $A$、游离片段 $B$ 和复合物 $C$ 的平衡浓度。\n\n物种 $A$ 和 $B$ 的总浓度（表示为 $A_T$ 和 $B_T$）是守恒的。这由质量平衡方程表示：\n$$\nA_T = [A] + [C]\n$$\n$$\nB_T = [B] + [C]\n$$\n根据这些守恒定律，我们可以用总浓度和复合物浓度 $[C]$ 来表示游离浓度 $[A]$ 和 $[B]$：\n$$\n[A] = A_T - [C]\n$$\n$$\n[B] = B_T - [C]\n$$\n这些表达式是有效的，因为复合物中某个组分的浓度不能超过其总浓度，即 $[C] \\le A_T$ 且 $[C] \\le B_T$。\n\n将这些游离浓度的表达式代入解离常数的方程中，得到：\n$$\nK_d = \\frac{(A_T - [C])(B_T - [C])}{[C]}\n$$\n为了求解 $[C]$，我们将此方程重排为多项式形式。将两边同乘以 $[C]$，得到：\n$$\nK_d [C] = (A_T - [C])(B_T - [C])\n$$\n展开右侧的乘积：\n$$\nK_d [C] = A_T B_T - A_T [C] - B_T [C] + [C]^2\n$$\n将所有项移到一边，得到一个关于 $[C]$ 的标准二次方程：\n$$\n[C]^2 - (A_T + B_T + K_d)[C] + A_T B_T = 0\n$$\n该方程的形式为 $ax^2 + bx + c = 0$，其中 $x = [C]$，$a = 1$，$b = -(A_T + B_T + K_d)$，$c = A_T B_T$。解由二次公式给出：\n$$\n[C] = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}\n$$\n代入系数：\n$$\n[C] = \\frac{(A_T + B_T + K_d) \\pm \\sqrt{(-(A_T + B_T + K_d))^2 - 4(1)(A_T B_T)}}{2(1)}\n$$\n$$\n[C] = \\frac{(A_T + B_T + K_d) \\pm \\sqrt{(A_T + B_T + K_d)^2 - 4A_T B_T}}{2}\n$$\n该二次方程产生两个数学解，但只有一个是物理上有效的。为了确定正确的根，我们考察其在极限条件下的行为。让我们考虑片段 $B$ 的总浓度为零的情况，即 $B_T = 0$。在这种情况下，无法形成复合物 $C$，因此我们必须有 $[C] = 0$。\n将 $B_T = 0$ 代入 $[C]$ 的解中：\n$$\n[C] = \\frac{(A_T + K_d) \\pm \\sqrt{(A_T + K_d)^2 - 0}}{2} = \\frac{(A_T + K_d) \\pm (A_T + K_d)}{2}\n$$\n使用加号的解给出 $[C] = \\frac{2(A_T + K_d)}{2} = A_T + K_d$。这个结果是非物理的，因为 $[C]$ 必须为零。\n使用减号的解给出 $[C] = \\frac{(A_T + K_d) - (A_T + K_d)}{2} = 0$。这个结果与物理预期一致。\n因此，对于所有有效参数值，二次公式中的减号提供了物理上有意义的解。复合物的平衡浓度的正确表达式是：\n$$\n[C] = \\frac{1}{2} \\left( (A_T + B_T + K_d) - \\sqrt{(A_T + B_T + K_d)^2 - 4 A_T B_T} \\right)\n$$\n问题要求的是并入复合物中的片段 $A$ 的分数，定义为 $f_A \\equiv [C]/A_T$。我们通过将 $[C]$ 的表达式除以 $A_T$ 来得到：\n$$\nf_A = \\frac{[C]}{A_T} = \\frac{(A_T + B_T + K_d) - \\sqrt{(A_T + B_T + K_d)^2 - 4 A_T B_T}}{2 A_T}\n$$\n这是 $f_A$ 关于 $A_T$，$B_T$ 和 $K_d$ 的最终闭式解析表达式。", "answer": "$$\\boxed{\\frac{(A_T + B_T + K_d) - \\sqrt{(A_T + B_T + K_d)^2 - 4 A_T B_T}}{2 A_T}}$$", "id": "2774885"}, {"introduction": "在基础平衡模型之上，我们现在探讨一个更高级的设计原则：协同性。许多工程化的分裂蛋白系统表现出开关般的“超敏”响应，这是简单的 $1{:}1$ 结合模型无法解释的。本练习将深入探讨折叠耦合结合的统计热力学，揭示要求多个事件同时发生（例如，两个片段的结合与折叠）如何能够产生这种强大的非线性行为 [@problem_id:2774854]。", "problem": "一种拆分酶由两个片段设计而成，记为片段 $A$ 和片段 $B$。这两个片段在单独存在时是本征无序的，但在结合时会协同折叠，形成一个具有催化能力的复合物 $C$。实验在一个大型、充分混合的反应器中进行。在反应器中，$A$ 和 $B$ 的总拷贝数通过表达所缓冲，使得它们的化学势由一个浓度为 $c$ 的共同小分子输入所控制。假设化学势满足 $\\mu_{A} = \\mu_{A}^{0} + k_{B}T \\ln(\\alpha_{A} c)$ 和 $\\mu_{B} = \\mu_{B}^{0} + k_{B}T \\ln(\\alpha_{B} c)$，其中 $k_{B}$ 是 Boltzmann 常数，$T$ 是绝对温度，而 $\\alpha_{A}$ 和 $\\alpha_{B}$ 是捕捉了可用片段活性对 $c$ 的线性依赖关系的正常数。\n\n在折叠耦合结合的强耦合极限下（即两个片段的折叠仅在结合的复合物中发生，并且所有部分折叠或弱结合的中间体的布居数可以忽略不计），一个假想结合位点的相关微观态是空态（没有复合物存在）和完全重构的复合物 $C$ 态。设从无序片段形成 $C$ 的标准自由能变为 $\\Delta G^{0}$，它包括 $A$ 和 $B$ 的折叠代价以及结合时有利的结合自由能。\n\n仅从统计热力学原理（Boltzmann 权重）和化学势的定义出发，推导在强耦合极限下，处于重构状态 $C$ 的位点所占的平衡分数 $p(c)$ 作为 $c$ 的函数。然后，通过下式定义关于输入 $c$ 的 Hill-like 指数 $n_{\\mathrm{eff}}$：\n$$\nn_{\\mathrm{eff}} \\equiv \\left.\\frac{d}{d\\ln c}\\,\\ln\\!\\left(\\frac{p(c)}{1 - p(c)}\\right)\\right|_{p=1/2}.\n$$\n在此极限下计算 $n_{\\mathrm{eff}}$。你的最终答案必须是一个没有单位的实数。", "solution": "该问题要求基于统计热力学原理，为一个拆分蛋白系统推导平衡占有率和有效 Hill 指数。该系统由一个假想的结合位点组成，该位点可以为空，也可以被一个由片段 $A$ 和 $B$ 形成的重构蛋白质复合物 $C$ 所占据。$A$ 和 $B$ 的化学势由一个外部输入 $c$ 控制。\n\n我们使用巨正则系综来模拟这个系统，其中“系统”是结合位点，“粒子库”是含有片段 $A$ 和 $B$ 的周围溶液，其化学势分别为指定的 $\\mu_A$ 和 $\\mu_B$。该位点处于给定微观态 $i$ 的概率与其 Boltzmann 权重 $W_i = \\exp \\left( - \\frac{E_i - \\sum_j N_{j,i}\\mu_j}{k_B T} \\right)$ 成正比，其中 $E_i$ 是该状态的能量，$N_{j,i}$ 是为形成该状态而从粒子库中取出的 $j$ 物种的粒子数，$\\mu_j$ 是 $j$ 物种的化学势。\n\n问题指出，在强耦合极限下，只有两个微观态是相关的：\n1. 空的位点。\n2. 被重构的复合物 $C$ 占据的位点。\n\n让我们定义这两个状态的性质。\n\n状态 1：空位点。\n对于这个状态，没有从粒子库中取出粒子，所以 $N_A = 0$ 且 $N_B = 0$。我们可以将这个参考态的能量设为零，$E_{empty} = 0$。空态的 Boltzmann 权重是：\n$$\nW_{empty} = \\exp\\left(-\\frac{0 - (0 \\cdot \\mu_A + 0 \\cdot \\mu_B)}{k_B T}\\right) = \\exp(0) = 1\n$$\n\n状态 2：被复合物 $C$ 占据的位点。\n要在该位点上形成复合物 $C$，必须从粒子库中取出一个片段 $A$ 和一个片段 $B$。因此，$N_A = 1$ 且 $N_B = 1$。复合物 $C$ 本身的能量，相对于标准状态下分离的片段，可以等同于其标准化学势，$E_C = \\mu_C^0$。复合物状态的 Boltzmann 权重是：\n$$\nW_C = \\exp\\left(-\\frac{\\mu_C^0 - (1 \\cdot \\mu_A + 1 \\cdot \\mu_B)}{k_B T}\\right) = \\exp\\left(-\\frac{\\mu_C^0 - \\mu_A - \\mu_B}{k_B T}\\right)\n$$\n指数中的项 $\\mu_C^0 - \\mu_A - \\mu_B$ 代表了从粒子库提供的组分在位点上形成复合物 $C$ 的巨势。\n\n问题给出了从无序片段 $A$ 和 $B$ 形成 $C$ 的标准自由能变，$\\Delta G^0 = \\mu_C^0 - (\\mu_A^0 + \\mu_B^0)$。我们还得到了片段的化学势对输入浓度 $c$ 的依赖关系：\n$$\n\\mu_A = \\mu_A^0 + k_B T \\ln(\\alpha_A c)\n$$\n$$\n\\mu_B = \\mu_B^0 + k_B T \\ln(\\alpha_B c)\n$$\n将这些代入指数项的表达式中：\n\\begin{align*}\n\\mu_C^0 - \\mu_A - \\mu_B &= \\mu_C^0 - \\left(\\mu_A^0 + k_B T \\ln(\\alpha_A c)\\right) - \\left(\\mu_B^0 + k_B T \\ln(\\alpha_B c)\\right) \\\\\n&= (\\mu_C^0 - \\mu_A^0 - \\mu_B^0) - k_B T \\left(\\ln(\\alpha_A c) + \\ln(\\alpha_B c)\\right) \\\\\n&= \\Delta G^0 - k_B T \\ln(\\alpha_A \\alpha_B c^2)\n\\end{align*}\n现在，我们可以写出复合物状态 $C$ 的 Boltzmann 权重：\n$$\nW_C = \\exp\\left(-\\frac{\\Delta G^0 - k_B T \\ln(\\alpha_A \\alpha_B c^2)}{k_B T}\\right) = \\exp\\left(-\\frac{\\Delta G^0}{k_B T}\\right) \\exp\\left(\\ln(\\alpha_A \\alpha_B c^2)\\right) = \\alpha_A \\alpha_B c^2 \\exp\\left(-\\frac{\\Delta G^0}{k_B T}\\right)\n$$\n巨配分函数 $\\mathcal{Z}$ 是所有可能状态的权重之和：\n$$\n\\mathcal{Z} = W_{empty} + W_C = 1 + \\alpha_A \\alpha_B c^2 \\exp\\left(-\\frac{\\Delta G^0}{k_B T}\\right)\n$$\n处于重构状态 $C$ 的位点的平衡分数 $p(c)$ 是状态 $C$ 的 Boltzmann 权重与巨配分函数的比值：\n$$\np(c) = \\frac{W_C}{\\mathcal{Z}} = \\frac{\\alpha_A \\alpha_B c^2 \\exp\\left(-\\frac{\\Delta G^0}{k_B T}\\right)}{1 + \\alpha_A \\alpha_B c^2 \\exp\\left(-\\frac{\\Delta G^0}{k_B T}\\right)}\n$$\n这个表达式给出了所求的平衡分数作为 $c$ 的函数。\n\n下一步是计算有效 Hill 指数 $n_{\\mathrm{eff}}$。其定义为：\n$$\nn_{\\mathrm{eff}} \\equiv \\left.\\frac{d}{d\\ln c}\\,\\ln\\!\\left(\\frac{p(c)}{1 - p(c)}\\right)\\right|_{p=1/2}\n$$\n首先，我们计算比值 $\\frac{p(c)}{1 - p(c)}$。\n$$\n1 - p(c) = 1 - \\frac{W_C}{1 + W_C} = \\frac{1 + W_C - W_C}{1 + W_C} = \\frac{1}{1 + W_C}\n$$\n因此，该比值就是复合物状态的 Boltzmann 权重：\n$$\n\\frac{p(c)}{1 - p(c)} = \\frac{W_C / (1 + W_C)}{1 / (1 + W_C)} = W_C\n$$\n代入 $W_C$ 的表达式：\n$$\n\\frac{p(c)}{1 - p(c)} = \\alpha_A \\alpha_B c^2 \\exp\\left(-\\frac{\\Delta G^0}{k_B T}\\right)\n$$\n现在我们必须对这个量取自然对数：\n$$\n\\ln\\left(\\frac{p(c)}{1 - p(c)}\\right) = \\ln\\left(\\alpha_A \\alpha_B c^2 \\exp\\left(-\\frac{\\Delta G^0}{k_B T}\\right)\\right)\n$$\n利用对数的性质：\n$$\n\\ln\\left(\\frac{p(c)}{1 - p(c)}\\right) = \\ln(\\alpha_A \\alpha_B) + \\ln(c^2) - \\frac{\\Delta G^0}{k_B T} = \\ln(\\alpha_A \\alpha_B) + 2\\ln(c) - \\frac{\\Delta G^0}{k_B T}\n$$\n最后，我们将此表达式对 $\\ln(c)$ 求导以求出 $n_{\\mathrm{eff}}$。令 $u = \\ln(c)$。该表达式变成一个关于 $u$ 的简单导数：\n\\begin{align*}\nn_{\\mathrm{eff}} &= \\frac{d}{d\\ln c}\\left(\\ln(\\alpha_A \\alpha_B) + 2\\ln(c) - \\frac{\\Delta G^0}{k_B T}\\right) \\\\\n&= \\frac{d}{d\\ln c}\\left(\\ln(\\alpha_A \\alpha_B) - \\frac{\\Delta G^0}{k_B T}\\right) + \\frac{d}{d\\ln c}\\left(2\\ln(c)\\right)\n\\end{align*}\n项 $\\ln(\\alpha_A \\alpha_B)$ 和 $\\frac{\\Delta G^0}{k_B T}$ 是关于 $c$ 的常数，因此它们的导数为零。\n$$\nn_{\\mathrm{eff}} = 0 + 2 \\frac{d(\\ln c)}{d(\\ln c)} = 2 \\cdot 1 = 2\n$$\n结果是一个常数值 $2$。$n_{\\mathrm{eff}}$ 的定义包含在 $p(c)=1/2$ 点的求值。由于我们推导出的量是一个常数，不依赖于 $c$（因此也不依赖于 $p$ 的值），所以这个求值不会改变结果。有效 Hill 指数为 $2$。这个整数值反映了结合反应的化学计量关系，即两个物种（$A$ 和 $B$）必须结合在一起形成最终的复合物，而这两个物种的活性都与输入 $c$ 呈线性关系。", "answer": "$$\n\\boxed{2}\n$$", "id": "2774854"}, {"introduction": "我们模型的最终考验在于其解释实验数据和进行预测的能力。这最后一个实践通过模拟深度突变扫描数据的分析，架起了理论与实验之间的桥梁。你将学习如何将原始实验读数转化为具有物理意义的量，如结合自由能（$\\Delta G$），并利用这些信息构建一个能够量化单个突变及其相互作用（上位性）效应的预测模型，这是现代蛋白质工程和定量生物学的核心任务 [@problem_id:2774873]。", "problem": "给定来自一个分裂蛋白质界面的蛋白质片段互补分析 (PCA) 的深度突变扫描数据。每个变体被编码为一个长度为 $4$ 的二进制字符串，其中每个位置表示相对于野生型，特定界面残基上的单点突变是否存在 ($1$) 或不存在 ($0$)。每个变体测得的 PCA 读出值是 $(0,1)$ 内的一个无量纲值，已经过归一化，与平衡时结合复合物的比例成正比。你的任务是推断对结合自由能的加性贡献和成对上位性贡献，并为未见过的组合构建一个预测模型。\n\n使用的基本原理：\n- 双态结合的化学热力学：假设一个未结合态和一个结合态处于平衡状态。\n- 使用热能 $R T$ 的玻尔兹曼统计，其中 $R$ 是普适气体常数，$T$ 是绝对温度。\n- 自由能分解为加性单点项和成对上位性项的线性模型。\n\n假设：\n- 某个变体的 PCA 读出值等于该变体在固定总浓度条件下的平衡结合复合物比例，该条件可以在一个有效的双态模型中处理。在这些条件下，结合比例由标准结合自由能差 $\\Delta G$ 通过玻尔兹曼统计确定。\n- 具有二进制突变向量 $\\mathbf{m} \\in \\{0,1\\}^4$ 的变体的结合自由能遵循一个加性加成对模型：\n  $$\\Delta G(\\mathbf{m}) = \\Delta G_0 + \\sum_{i=1}^{4} a_i m_i + \\sum_{1 \\le i < j \\le 4} e_{ij} m_i m_j,$$\n  其中 $\\Delta G_0$ 是野生型基线自由能，单位为 $\\mathrm{kcal/mol}$；$a_i$ 是加性系数，单位为 $\\mathrm{kcal/mol}$；$e_{ij}$ 是成对上位性系数，单位为 $\\mathrm{kcal/mol}$。\n\n热力学映射要求：\n- 从具有自由能差 $\\Delta G$ 的双态系统的玻尔兹曼统计出发，推导平衡结合比例与 $\\Delta G$ 之间的关系。然后反转此关系，将 $\\Delta G$ 表示为测得的结合比例的函数。使用 $R = 0.001987\\ \\mathrm{kcal/(mol \\cdot K)}$ 和 $T = 298\\ \\mathrm{K}$。确保所有 $\\Delta G$ 值的单位都是 $\\mathrm{kcal/mol}$。为了数值稳定性，在反转映射时，将测得的比例 $y$ 裁剪到开区间 $(\\epsilon, 1-\\epsilon)$ 内，其中 $\\epsilon = 10^{-6}$。\n\n估计要求：\n- 通过最小化关于推断出的 $\\Delta G$ 值的 Tikhonov 正则化（岭）最小二乘目标函数来估计参数 $\\Delta G_0$、$a_i$ 和 $e_{ij}$：\n  $$\\min_{\\theta} \\left\\| \\mathbf{X}\\theta - \\mathbf{g} \\right\\|_2^2 + \\lambda \\left\\| \\mathbf{P}\\theta \\right\\|_2^2,$$\n  其中 $\\mathbf{g}$ 包含训练变体推断出的 $\\Delta G$ 值，$\\mathbf{X}$ 是设计矩阵，其列分别对应一个截距、$4$ 个加性指标 $m_i$ 和 $6$ 个成对乘积 $m_i m_j$ ($1 \\le i < j \\le 4$)，$\\theta$ 堆叠了 $[\\Delta G_0, a_1,\\dots,a_4, e_{12}, e_{13}, e_{14}, e_{23}, e_{24}, e_{34}]^\\top$。使用 $\\lambda = 0.1$。不要惩罚截距项（即将 $\\mathbf{P}$ 相应的对角线元素设置为 $0$，所有其他对角线元素设置为 $1$）。\n\n预测要求：\n- 使用拟合的参数，为每个指定的测试变体预测 $\\Delta G$ 和相应的结合比例，使用相同的热力学映射和常数。只报告预测的结合比例。\n\n训练数据集 (二进制变体字符串, 测量的 PCA 读出值):\n- $0000$: $0.96$\n- $1000$: $0.85$\n- $0100$: $0.88$\n- $0010$: $0.70$\n- $0001$: $0.82$\n- $1010$: $0.78$\n- $0101$: $0.70$\n- $0110$: $0.60$\n- $0011$: $0.58$\n- $1100$: $0.78$\n- $1110$: $0.40$\n- $0111$: $0.35$\n\n测试集 (用于预测的未见变体):\n- 变体 A: $1011$\n- 变体 B: $1101$\n- 变体 C: $0000$\n- 变体 D: $1111$\n\n需要报告的额外诊断信息：\n- 推断的成对上位性系数 $e_{13}$，单位为 $\\mathrm{kcal/mol}$。\n- 所有上位性系数绝对值之和，$\\sum_{1 \\le i < j \\le 4} \\lvert e_{ij} \\rvert$，单位为 $\\mathrm{kcal/mol}$。\n\n最终输出格式：\n- 你的程序应产生单行输出，包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列：\n  $$[\\text{pred\\_A},\\ \\text{pred\\_B},\\ \\text{pred\\_C},\\ \\text{pred\\_D},\\ e_{13},\\ \\sum \\lvert e_{ij} \\rvert],$$\n  其中每个 $\\text{pred\\_X}$ 是预测的结合比例（在 $(0,1)$ 内的无量纲值）。所有自由能的中间计算必须以 $\\mathrm{kcal/mol}$ 为单位，且 $R = 0.001987\\ \\mathrm{kcal/(mol \\cdot K)}$ 和 $T = 298\\ \\mathrm{K}$。", "solution": "我们从结合的双态热力学模型开始。设未结合态的自由能为 $G_{\\mathrm{U}}$，结合态的自由能为 $G_{\\mathrm{B}}$。定义标准结合自由能差为 $\\Delta G = G_{\\mathrm{B}} - G_{\\mathrm{U}}$。在温度为 $T$ 的热平衡状态下，玻尔兹曼统计表明结合态与未结合态的平衡概率之比由下式给出：\n$$\n\\frac{p_{\\mathrm{B}}}{p_{\\mathrm{U}}} = \\exp\\left(-\\beta \\Delta G\\right),\n$$\n其中 $\\beta = \\frac{1}{R T}$，$R$ 是普适气体常数。由于 $p_{\\mathrm{B}} + p_{\\mathrm{U}} = 1$，平衡结合比例 $f$ 为：\n$$\nf = \\frac{p_{\\mathrm{B}}}{p_{\\mathrm{B}} + p_{\\mathrm{U}}} = \\frac{1}{1 + \\frac{p_{\\mathrm{U}}}{p_{\\mathrm{B}}}} = \\frac{1}{1 + \\exp\\left(\\beta \\Delta G\\right)}.\n$$\n这个 logistic 关系是具有自由能隙 $\\Delta G$ 的双态划分的直接结果。\n\n为了反转该映射（将 $\\Delta G$ 表示为 $f$ 的函数），我们求解 $\\Delta G$：\n$$\nf = \\frac{1}{1 + \\exp\\left(\\beta \\Delta G\\right)} \\quad \\Longrightarrow \\quad \\frac{1-f}{f} = \\exp\\left(\\beta \\Delta G\\right) \\quad \\Longrightarrow \\quad \\Delta G = \\frac{1}{\\beta} \\ln\\!\\left(\\frac{1-f}{f}\\right) = R T \\ln\\!\\left(\\frac{1-f}{f}\\right).\n$$\n我们采用 $R = 0.001987\\ \\mathrm{kcal/(mol \\cdot K)}$ 和 $T = 298\\ \\mathrm{K}$，因此 $R T$ 的单位是 $\\mathrm{kcal/mol}$，从而 $\\Delta G$ 的单位也是 $\\mathrm{kcal/mol}$。当 $f$ 极度接近 $0$ 或 $1$ 时，为了数值稳定性，我们在应用对数之前将 $f$ 裁剪到 $(\\epsilon, 1-\\epsilon)$ 区间内，其中 $\\epsilon = 10^{-6}$。\n\n接下来，我们假设一个具有加性单点效应和成对上位性的线性自由能分解模型。对于一个由二进制向量 $\\mathbf{m} \\in \\{0,1\\}^4$ 编码的变体，我们写作：\n$$\n\\Delta G(\\mathbf{m}) = \\Delta G_0 + \\sum_{i=1}^{4} a_i m_i + \\sum_{1 \\le i < j \\le 4} e_{ij} m_i m_j.\n$$\n这里，$\\Delta G_0$ 是野生型基线，$a_i$ 代表突变位置 $i$ 的加性贡献，$e_{ij}$ 捕捉了当位置 $i$ 和 $j$ 同时突变时的成对上位性偏差。所有参数的单位都是 $\\mathrm{kcal/mol}$。\n\n设 $\\mathbf{g} \\in \\mathbb{R}^n$ 为 $n$ 个训练变体推断出的自由能向量，其通过测得的结合比例 $\\{f_k\\}_{k=1}^n$ 经由以下公式获得：\n$$\ng_k = R T \\ln\\!\\left(\\frac{1 - f_k}{f_k}\\right).\n$$\n构建一个设计矩阵 $\\mathbf{X} \\in \\mathbb{R}^{n \\times 11}$，其列对应于：一个截距（全为 1）、4 个加性指标 $m_i$、以及 6 个按字典序排列的成对乘积 $m_i m_j$（即 $(1,2), (1,3), (1,4), (2,3), (2,4), (3,4)$）。将参数堆叠成：\n$$\n\\theta = \\begin{bmatrix} \\Delta G_0 & a_1 & a_2 & a_3 & a_4 & e_{12} & e_{13} & e_{14} & e_{23} & e_{24} & e_{34} \\end{bmatrix}^\\top.\n$$\n\n我们通过岭回归来估计 $\\theta$，这等同于在 $\\Delta G$ 上存在独立同分布的高斯噪声（高斯似然）和对参数（不包括截距）采用零均值高斯先验的条件下的最大后验 (MAP) 估计。目标函数是：\n$$\n\\min_{\\theta} \\left\\| \\mathbf{X}\\theta - \\mathbf{g} \\right\\|_2^2 + \\lambda \\left\\| \\mathbf{P}\\theta \\right\\|_2^2,\n$$\n其中 $\\lambda = 0.1$ 是正则化强度，$\\mathbf{P} = \\mathrm{diag}(0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)$ 使截距项不受惩罚。其闭式解为：\n$$\n\\hat{\\theta} = \\left( \\mathbf{X}^\\top \\mathbf{X} + \\lambda \\mathbf{P} \\right)^{-1} \\mathbf{X}^\\top \\mathbf{g}.\n$$\n\n对于任何具有二进制编码 $\\mathbf{m}$ 的测试变体，我们按照与 $\\mathbf{X}$ 的列相同的顺序构建其特征向量 $\\mathbf{x} \\in \\mathbb{R}^{11}$，计算预测的自由能\n$$\n\\widehat{\\Delta G} = \\mathbf{x}^\\top \\hat{\\theta},\n$$\n然后使用正向热力学关系将其映射回预测的结合比例，\n$$\n\\hat{f} = \\frac{1}{1 + \\exp\\!\\left( \\beta \\widehat{\\Delta G} \\right)}, \\quad \\beta = \\frac{1}{R T}.\n$$\n\n实现细节：\n- 将每个训练读出值 $y$ 在裁剪到 $(\\epsilon, 1-\\epsilon)$（其中 $\\epsilon = 10^{-6}$）后转换为 $g = R T \\ln\\!\\left(\\frac{1-y}{y}\\right)$。\n- 精确地按照指定的特征顺序构建 $\\mathbf{X}$。\n- 使用闭式岭回归解（$\\lambda = 0.1$ 且截距不被惩罚）求解 $\\hat{\\theta}$。\n- 为四个测试变体 $1011$、$1101$、$0000$ 和 $1111$ 预测 $\\hat{f}$。\n- 从 $\\hat{\\theta}$ 中提取推断出的 $e_{13}$（在指定的顺序下，它是六个成对项中的第二个）。\n- 计算上位性幅度总和 $\\sum_{1 \\le i < j \\le 4} \\lvert e_{ij} \\rvert$。\n\n最终程序将这些结果聚合到一个列表中：\n$$\n[\\hat{f}_{1011},\\ \\hat{f}_{1101},\\ \\hat{f}_{0000},\\ \\hat{f}_{1111},\\ \\hat{e}_{13},\\ \\sum_{1 \\le i < j \\le 4} \\lvert \\hat{e}_{ij} \\rvert]\n$$\n并将其作为单行、逗号分隔、用方括号括起来的字符串打印出来。所有中间的 $\\Delta G$ 计算都按要求以 $\\mathrm{kcal/mol}$ 为单位。这种方法将预测建立在第一性原理（双态热力学模型）之上，同时通过在自由能空间中进行线性建模来解析加性贡献和上位性贡献。这样做具有物理意义，因为对于独立贡献，自由能是可加的，而上位性在该空间中可以自然地表示为相互作用项。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef clip01(x, eps=1e-6):\n    return min(max(x, eps), 1.0 - eps)\n\ndef variant_to_features(variant_str):\n    \"\"\"\n    Build feature vector in the order:\n    [1, m1, m2, m3, m4, m1*m2, m1*m3, m1*m4, m2*m3, m2*m4, m3*m4]\n    \"\"\"\n    m = np.array([int(c) for c in variant_str], dtype=float)\n    m1, m2, m3, m4 = m\n    features = [\n        1.0,\n        m1, m2, m3, m4,\n        m1*m2, m1*m3, m1*m4, m2*m3, m2*m4, m3*m4\n    ]\n    return np.array(features, dtype=float)\n\ndef fit_ridge(X, g, lam):\n    \"\"\"\n    Solve (X^T X + lam P) theta = X^T g\n    with P = diag(0, 1, ..., 1) to avoid penalizing intercept.\n    \"\"\"\n    n_features = X.shape[1]\n    XtX = X.T @ X\n    Xtg = X.T @ g\n    P = np.eye(n_features)\n    P[0, 0] = 0.0  # do not penalize intercept\n    A = XtX + lam * P\n    theta = np.linalg.solve(A, Xtg)\n    return theta\n\ndef predict_fraction(theta, variant_str, beta):\n    x = variant_to_features(variant_str)\n    dG = float(x @ theta)\n    # Map to fraction bound via thermodynamic relation\n    f = 1.0 / (1.0 + np.exp(beta * dG))\n    return float(f)\n\ndef solve():\n    # Physical constants\n    R = 0.001987  # kcal/(mol·K)\n    T = 298.0     # K\n    RT = R * T\n    beta = 1.0 / RT\n\n    # Regularization strength\n    lam = 0.1\n\n    # Training data: (variant_str, normalized PCA readout)\n    training_data = [\n        (\"0000\", 0.96),\n        (\"1000\", 0.85),\n        (\"0100\", 0.88),\n        (\"0010\", 0.70),\n        (\"0001\", 0.82),\n        (\"1010\", 0.78),\n        (\"0101\", 0.70),\n        (\"0110\", 0.60),\n        (\"0011\", 0.58),\n        (\"1100\", 0.78),\n        (\"1110\", 0.40),\n        (\"0111\", 0.35),\n    ]\n\n    # Build design matrix X and target vector g (ΔG)\n    X_rows = []\n    g_vals = []\n    for var, y in training_data:\n        y_clipped = clip01(y, eps=1e-6)\n        # Invert fraction -> ΔG in kcal/mol\n        dG = RT * np.log((1.0 - y_clipped) / y_clipped)\n        X_rows.append(variant_to_features(var))\n        g_vals.append(dG)\n    X = np.vstack(X_rows)\n    g = np.array(g_vals, dtype=float)\n\n    # Fit ridge regression in ΔG space\n    theta = fit_ridge(X, g, lam)\n\n    # Test variants for prediction\n    test_variants = [\"1011\", \"1101\", \"0000\", \"1111\"]\n    preds = [predict_fraction(theta, v, beta) for v in test_variants]\n\n    # Extract e_13 and sum of absolute epistasis magnitudes\n    # Parameter ordering: [ΔG0, a1, a2, a3, a4, e12, e13, e14, e23, e24, e34]\n    e13 = float(theta[6])\n    epistasis_coeffs = theta[5:11]\n    sum_abs_e = float(np.sum(np.abs(epistasis_coeffs)))\n\n    results = preds + [e13, sum_abs_e]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2774873"}]}