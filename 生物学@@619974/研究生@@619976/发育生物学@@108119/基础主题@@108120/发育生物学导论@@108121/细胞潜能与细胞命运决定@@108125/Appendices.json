{"hands_on_practices": [{"introduction": "通过重编程指导细胞命运是再生医学的基石，但得出可靠的结论需要严谨的实验设计。一个关键挑战是区分真正的转分化与细胞融合等假象。本练习将指导您设计一个决定性的实验，利用 Cre-lox 等遗传工具进行谱系追踪，并使用特异性报告基因来明确捕获融合事件 [@problem_id:2624287]。掌握这种实验逻辑对于在细胞工程领域产生明确的数据并提出可信的科学主张至关重要。", "problem": "一个实验室正在通过异位表达编码于多西环素诱导型载体上的前神经因子，将小鼠真皮成纤维细胞转化为诱导神经元。由于与原代皮层神经元共培养能提高诱导神经元的存活率和成熟度，因此主要问题是要严格排除表面上的神经元细胞是通过成纤维细胞和神经元之间的细胞融合产生，而非通过直接转分化而来。请仅根据核心定义、关于位点特异性重组实现的不可逆谱系标记的成熟事实、分子生物学的中心法则以及细胞融合的物理后果（细胞质混合，在某些情况下还有细胞核混合，通常导致多倍体），选择一个或多个选项。这些选项需要详细说明一种科学上有效的双报告基因策略，该策略能区分直接转分化和融合假象，并包含足以得出可靠结论的定量合格/不合格标准。\n\n用作基本依据的背景事实和定义：\n- 位点特异性重组酶，如环化重组（Cre）重组酶，催化loxP位点对之间的不可逆重组，从而永久性地改变脱氧核糖核酸（DNA）及谱系标记；根据分子生物学的中心法则，这种改变会被子细胞稳定遗传。\n- 一个真正的谱系标记必须在任何命运转化发生之前在起始细胞群体中被激活，并且必须独立于靶细胞命运相关的启动子。\n- 细胞融合产生共享的细胞质，这使得分裂报告基因得以互补，或由伴侣细胞提供的重组酶响应性盒被激活；融合通常产生DNA含量大于或等于$2N$（其中$N$是单倍体基因组含量）的单核四倍体或多核异核体，而直接转分化则保留二倍体（$2N$）状态和单个细胞核。\n\n在成纤维细胞到神经元的转化中，哪个或哪些选项提供了有效的实验设计和严格的合格/不合格标准，以区分直接转分化与细胞融合假象？请选择所有适用项。\n\nA. 设计：在任何诱导之前，使用成纤维细胞特异性的、他莫昔芬诱导的Cre重组酶（CreER）驱动子（例如，血小板衍生生长因子受体α启动子，Pdgfra-CreER）预先标记成纤维细胞，以永久激活Rosa26位点上的LoxP-STOP-LoxP (LSL) tdTomato谱系报告基因。此外，在成纤维细胞中整合一个由普遍表达的巨细胞病毒增强子/鸡β-肌动蛋白启动子（CAG）驱动的LSL核绿色荧光蛋白（GFP）盒，该盒在没有Cre的情况下保持关闭。与从Synapsin $1$ (Syn$1$) 启动子表达Cre (Syn$1$-Cre)但不携带任何荧光报告基因的皮层神经元共培养。 原理：只有当成纤维细胞与一个Syn$1$-Cre神经元融合时，来自神经元的Cre才会进入共享的细胞质/细胞核，并激活驻留在成纤维细胞中的CAG-LSL-核GFP融合报告基因。直接重编程的成纤维细胞将是tdTomato阳性（谱系阳性）和神经元标记物阳性，但GFP阴性，因为它们从未接收到Syn$1$-Cre。 合格/不合格标准：诱导后，在NeuN和微管相关蛋白$2$ (MAP$2$) 阳性的诱导神经元 (iN) 中，至少$95\\%$为tdTomato阳性和核GFP阴性，通过碘化丙啶流式细胞术检测其DNA含量为$2N$，并通过共聚焦显微镜观察到单个细胞核；少于$1\\%$的iN为核GFP阳性；对至少$100$个iN进行的单细胞RNA测序 (scRNA-seq) 未检测到Syn$1$-Cre转录本，且单核苷酸多态性 (SNP) 基因分型仅与成纤维细胞供体的单倍型匹配。对照组：在仅有成纤维细胞的培养物中，Syn$1$-Cre质粒条件培养基产生$0\\%$的GFP激活；在仅有神经元的培养物中，未检测到tdTomato。如果以下任何一项成立则为不合格：至少$5\\%$的iN为核GFP阳性，至少$2\\%$的iN为多倍体（$>2N$），或成纤维细胞谱系阴性的iN超过$5\\%$。\n\nB. 设计：将一个由神经元特异性启动子（Syn$1$启动子）驱动GFP的基因引入成纤维细胞；重编程后，GFP的表达指示神经元身份。为排除融合，要求成纤维细胞标记物（例如，COL$1$A$1$）的丢失和神经元标记物（例如，TUBB$3$）的获得。合格/不合格标准：如果通过免疫荧光法检测，至少$80\\%$的GFP阳性细胞为TUBB$3$阳性和COL$1$A$1$阴性，则判定为直接转分化；否则，怀疑发生融合。未包含额外的遗传融合捕获系统。\n\nC. 设计：通过对成纤维细胞特异性的Tcf$21$-CreER细胞系进行短暂的他莫昔芬处理来预先标记成纤维细胞，以永久激活来自Rosa26 LSL位点的核蓝色荧光蛋白（BFP）谱系报告基因；此外，在Rosa26的$3'$非翻译区嵌入一个紧凑的CRISPR（Clustered Regularly Interspaced Short Palindromic Repeats）谱系记录条形码，以实现供体特异性的SNP定相。为检测融合，在不同细胞类型间使用分裂绿色荧光蛋白（GFP）系统：成纤维细胞组成性表达胞质GFP$\\_{1-10}$；共培养的皮层神经元在Syn$1$启动子控制下表达胞质GFP$\\_{11}$。只有在融合事件中发生膜融合导致细胞质混合时，才能重构出完整的GFP荧光；突触接触或外泌体不能跨越完整的细胞膜重构胞质分裂GFP。 合格/不合格标准：在NeuN和MAP$2$阳性的iN中，至少$95\\%$为BFP阳性、分裂GFP阴性、单核且DNA含量为$2N$；少于$1\\%$的iN为分裂GFP阳性；对至少$100$个iN进行的单细胞靶向基因分型显示仅有成纤维细胞供体条形码，且不含神经元特异性的私有SNP；对至少$20$个iN进行的膜片钳记录显示出神经元电生理特性，且在成像的胞体中无多核证据。如果以下任何一项成立则为不合格：至少$5\\%$的iN为分裂GFP阳性，至少$2\\%$为多倍体，或至少$5\\%$缺乏成纤维细胞谱系条形码。\n\nD. 设计：在共培养之前，用一种亲脂性染料（DiI）标记成纤维细胞，用另一种不同的染料（DiO）标记神经元；如果两种染料都存在于一个细胞中，则推断发生融合。诱导后，如果至少一半的带神经突起的细胞为DiI阳性和TUBB$3$阳性，则宣布为直接转分化。合格/不合格标准：至少$50\\%$的TUBB$3$阳性细胞必须是DiI阳性和DiO阴性才算合格；否则，判定为发生融合。未包含遗传谱系报告基因、倍性测量和融合特异性遗传捕获系统。", "solution": "首先将验证问题陈述的科学合理性、清晰性和完整性。\n\n**步骤1：提取既定条件**\n\n问题陈述提供了以下信息和定义：\n- **目标**：确定一种科学上有效的双报告基因策略，以在小鼠真皮成纤维细胞向诱导神经元（iN）转化过程中，区分直接转分化和细胞融合假象。\n- **背景**：转化由多西环素诱导型载体上的前神经因子的异位表达驱动。成纤维细胞与原代皮层神经元共培养。\n- **基本原理1（谱系标记）**：位点特异性重组酶，如环化重组（$Cre$）重组酶，在识别位点（例如，$loxP$）催化不可逆重组，产生一种可稳定遗传的永久性脱氧核糖核酸（$DNA$）改变。\n- **基本原理2（真实谱系标记）**：一个有效的谱系标记必须在命运转化*之前*在起始细胞群体中被激活，并且其功能必须独立于与靶细胞命运相关的启动子。\n- **基本原理3（融合的后果）**：细胞融合导致共享的细胞质，从而实现分子互补（例如，分裂报告基因）或由伴侣细胞提供的因子激活报告基因盒（例如，$Cre$作用于$LoxP-STOP-LoxP$或$LSL$盒）。融合通常导致多倍体（DNA含量 $\\ge 2N$，其中$N$是单倍体基因组含量）或多核异核体。相比之下，直接转分化保留了二倍体（$2N$）状态和单个细胞核。\n\n**步骤2：使用提取的既定条件进行验证**\n\n该问题要求基于一系列清晰阐述、正确且基本的分子和细胞生物学原理，对实验设计进行评估。\n- **科学依据**：该问题植根于细胞重编程领域一个真实而关键的挑战。所提供的背景事实——$Cre-loxP$重组机制、谱系追踪系统的要求、中心法则以及细胞融合的细胞学后果——都是标准的、公认的科学原理。没有事实错误或伪科学主张。\n- **问题明确**：问题的结构使其具有确定的答案。它要求根据给定的原理，确定所提供的选项中哪一个构成了具有严格标准的有效实验设计。通过对这些原理的逻辑应用，可以确定一组唯一的正确选项。\n- **客观性**：语言精确且无偏见。它定义了核心概念（`谱系标记`、`细胞融合`、`转分化`）及其预期特征，为评估选项提供了一个清晰的框架。它避免了主观或模棱两可的术语。\n\n**步骤3：结论与行动**\n\n问题陈述科学合理、问题明确且客观。它为严格的科学评估所提出的实验设计提供了充分且一致的基础。该问题有效。现在分析将进入解决阶段。\n\n**正确答案的推导和逐项分析**\n\n一个有效的策略必须满足基于所提供原理的三个核心要求：\n1.  **不可逆的谱系标记**：必须采用一种方法，在重编程过程开始*之前*永久性地标记起始的成纤维细胞。根据原理1，这最好是一种遗传标记，例如由$Cre-loxP$重组产生的标记。\n2.  **特异性融合检测**：必须包含一个仅在细胞融合时才被激活的特异性“捕获”或报告系统，利用原理3中描述的细胞质和细胞核混合。\n3.  **严格和定量的标准**：必须定义定量的、严格的、多模式的合格/不合格标准，包括对谱系标记、融合报告基因以及像倍性和核数这样的细胞学特征的分析（原理3）。\n\n**选项A的评估**\n\n- **实验设计**：\n    1.  **谱系标记**：使用他莫昔芬诱导的$Pdgfra-CreER$驱动子预先标记成纤维细胞，以激活$Rosa26-LSL-tdTomato$报告基因。这是一个永久性的遗传标记，在诱导前在起始群体中激活，满足原理1和2。$tdTomato$的表达独立于神经元命运。\n    2.  **融合检测**：成纤维细胞含有一个$CAG-LSL-nGFP$盒，而共培养的神经元表达来自神经元特异性$Syn1$启动子的$Cre$。成纤维细胞与神经元的融合将把源自神经元的$Cre$蛋白递送到成纤维细胞核内，从而激活原本沉默的核绿色荧光蛋白（$nGFP$）报告基因。根据原理3，这是一个直接且特异性的融合事件遗传捕获系统。\n    3.  **正交验证**：该设计包括倍性分析（$2N$含量）、核计数和单细胞测序（scRNA-seq），以检查$Syn1-Cre$转录本的缺失和仅存在成纤维细胞特异性单核苷酸多态性（SNPs）。这些是强大且独立的抗融合检查方法。\n- **合格/不合格标准**：标准非常严格：$>95\\%$的诱导神经元（iNs）必须是$tdTomato^+$和$nGFP^-$，允许的融合事件少于$<1\\%$。多倍体（$<2\\%$）和谱系标记丢失（$<5\\%$）的容许率也很严格。对照组是适当的。\n- **结论**：该选项描述了一个稳健、多层次的实验设计，完全符合所有既定原理。它结合了永久性谱系追踪、特异性遗传融合捕获系统以及严格、定量的验证方法。这是一个科学上有效的策略。**正确**。\n\n**选项B的评估**\n\n- **实验设计**：\n    1.  **谱系标记**：该设计缺乏一个真正的谱系标记。它建议使用一个$Syn1-GFP$报告基因，该报告基因是被靶神经元命运*激活*的。这违反了原理2，该原理规定谱系标记必须独立于靶细胞命运的启动子。它无法区分一个重编程的成纤维细胞和一个可能污染培养物的预先存在的神经元。\n    2.  **融合检测**：没有特异性的融合检测机制。该设计仅依赖于神经元标记物（$TUBB3$）的共表达和成纤维细胞标记物（$COL1A1$）的丢失。这是不够的，因为融合衍生的异核体可能表现出相同的标记物谱。\n- **合格/不合格标准**：$80\\%$的$GFP^+$细胞为$TUBB3^+$和$COL1A1^-$的标准很弱，不能为反驳融合提供确凿的证据。\n- **结论**：该设计存在根本性缺陷。它未能实现适当的谱系追踪，并且缺乏特异性的融合报告系统。因此，它不能严格区分转分化和融合。**不正确**。\n\n**选项C的评估**\n\n- **实验设计**：\n    1.  **谱系标记**：使用$Tcf21-CreER$预先标记成纤维细胞以激活$Rosa26-LSL-nBFP$报告基因。这构成了一个永久性的、预先激活的遗传谱系标记。此外，一个CRISPR条形码为供体细胞提供了高分辨率的遗传指纹。这满足了原理1和2。\n    2.  **融合检测**：使用了一个分裂$GFP$系统。成纤维细胞表达$GFP_{1-10}$，神经元表达$GFP_{11}$。融合时的细胞质混合使得$GFP$的两个部分互补并发光。根据原理3，这是一个用于膜融合和细胞质交换的直接、特异性的报告系统。\n    3.  **正交验证**：与选项A类似，该设计包括倍性分析（$2N$含量）、核数（通过膜片钳成像）和单细胞基因分型，以确认仅存在成纤维细胞特异性条形码/SNPs。\n- **合格/不合格标准**：标准是严格且定量的：$>95\\%$的iNs必须是$BFP^+$和分裂GFP阴性，检测到的融合事件少于$<1\\%$。对于融合（$>5\\%$）、多倍体（$>2\\%$）和谱系阴性细胞（$>5\\%$）的失败阈值也是严格的。\n- **结论**：该选项与选项A一样，提出了一个科学合理且严格的策略。它使用了永久性谱系追踪、灵敏的融合报告系统和多种独立验证分析的组合。它完全符合给定的原理。**正确**。\n\n**选项D的评估**\n\n- **实验设计**：\n    1.  **谱系标记**：它使用亲脂性染料（$DiI$）来标记成纤维细胞。这类染料不是永久性的，也不是遗传编码的。它们可以通过细胞分裂（如果发生）而被稀释，会随时间褪色，并且关键的是，可以通过完全融合以外的机制（例如，细胞吞噬、细胞外囊泡）在细胞间转移。这不符合原理1中“不可逆”和“稳定遗传”的谱系标记标准。\n    2.  **融合检测**：它依赖于检测两种不同染料（$DiI$和$DiO$）的共定位。该方法与谱系标记一样，容易受到染料转移的假象影响，并且远不如遗传报告基因特异。\n    3.  **正交验证**：该设计完全忽略了像倍性分析或任何形式的遗传确认等关键检查。\n- **合格/不合格标准**：$>50\\%$的$TUBB3^+$细胞为$DiI^+$和$DiO^-$的标准异常宽松。在科学背景下，一个高达$50\\%$的产出都可能是假象的方案不会被认为是经过严格验证的。\n- **结论**：该策略薄弱、非定量且极易产生假象。它未能使用稳健的谱系追踪或融合检测方法，并为成功设定了不可接受的低标准。**不正确**。", "answer": "$$\\boxed{AC}$$", "id": "2624287"}, {"introduction": "在细胞命运决定的复杂生物学背后，蕴含着优雅的数学原理。基因调控网络常常采用简单的基序，例如相互抑制与自我激活的组合，来创建稳定且可替代的细胞命运。本练习让您能够对这样一个电路进行数学分析，以找到其稳定状态（不动点），展示一个简单的系统如何能够创建一个构成二元命运选择基础的双稳态开关 [@problem_id:2624329]。这种动手计算将抽象的分子网络图与具体、可预测的动态联系起来，为理解细胞如何做出稳健的决策提供了定量基础。", "problem": "在一个通过转录因子交叉调控决定细胞命运的最小模型中，考虑一个对称的双基因回路，其中每个基因协同激活自身的转录，并抑制另一个基因的转录。令 $x(t)$ 和 $y(t)$ 表示两种转录因子的无量纲浓度。该动力学由以下耦合常微分方程 (ODEs) 建模：\n$$\n\\frac{dx}{dt} \\;=\\; \\frac{4\\,x^{2}}{1 + x^{2}} \\cdot \\frac{1}{1 + y^{2}} \\;-\\; x,\\qquad\n\\frac{dy}{dt} \\;=\\; \\frac{4\\,y^{2}}{1 + y^{2}} \\cdot \\frac{1}{1 + x^{2}} \\;-\\; y.\n$$\n这些常微分方程包含了希尔系数为 $2$ 的协同自激活、乘性交叉抑制和线性衰减。所有量均为无量纲。\n\n仅使用核心定义和经过充分检验的原理（例如，不动点是 $\\frac{dx}{dt} = 0$ 和 $\\frac{dy}{dt} = 0$ 的解，线性稳定性由在不动点处计算的雅可比矩阵的特征值决定），完成以下任务：\n\n1. 求解所有满足 $x^{\\ast} \\ge 0$ 和 $y^{\\ast} \\ge 0$ 的不动点 $(x^{\\ast},y^{\\ast})$。\n2. 对每个不动点，计算雅可比矩阵并确定其特征值的符号，以分类其线性稳定性（如果两个特征值都具有负实部，则为渐近稳定）。\n3. 将非负象限中渐近稳定不动点的总数以单个整数形式报告。\n\n将你的最终答案表示为单个整数。无需四舍五入或单位。", "solution": "该问题要求找到给定常微分方程(ODEs)系统的所有非负不动点，并确定它们的线性稳定性，以求出渐近稳定不动点的总数。\n\n该系统由以下方程给出：\n$$ \\frac{dx}{dt} = f(x, y) = \\frac{4x^2}{(1 + x^2)(1 + y^2)} - x $$\n$$ \\frac{dy}{dt} = g(x, y) = \\frac{4y^2}{(1 + y^2)(1 + x^2)} - y $$\n\n步骤1：找到所有不动点 $(x^{\\ast}, y^{\\ast})$\n不动点是满足 $\\frac{dx}{dt} = 0$ 和 $\\frac{dy}{dt} = 0$ 的解。我们受限于 $x^{\\ast} \\ge 0$ 和 $y^{\\ast} \\ge 0$。\n不动点的方程为：\n$$ x \\left( \\frac{4x}{(1 + x^2)(1 + y^2)} - 1 \\right) = 0 $$\n$$ y \\left( \\frac{4y}{(1 + y^2)(1 + x^2)} - 1 \\right) = 0 $$\n\n从第一个方程，我们有两种可能性：$x=0$ 或 $\\frac{4x}{(1+x^2)(1+y^2)} = 1$。\n从第二个方程，我们有两种可能性：$y=0$ 或 $\\frac{4y}{(1+y^2)(1+x^2)} = 1$。\n\n我们分析由此产生的四种情况的非负解。\n\n情况1：$x = 0$ 且 $y = 0$。\n点 $(0,0)$ 显然满足两个方程。因此，$(0,0)$ 是一个不动点。\n\n情况2：$x = 0$ 且 $y \\ne 0$。\n第一个方程得到满足。第二个方程变为 $\\frac{4y}{(1+y^2)(1+0^2)} = 1$，化简为 $4y = 1+y^2$，或 $y^2 - 4y + 1 = 0$。其根为 $y = \\frac{4 \\pm \\sqrt{16-4}}{2} = 2 \\pm \\sqrt{3}$。两个根都是正数。这给出了两个不动点：$(0, 2-\\sqrt{3})$ 和 $(0, 2+\\sqrt{3})$。\n\n情况3：$x \\ne 0$ 且 $y = 0$。\n根据与情况2的对称性，第一个方程变为 $x^2 - 4x + 1 = 0$，解得 $x = 2 \\pm \\sqrt{3}$。这给出了两个不动点：$(2-\\sqrt{3}, 0)$ 和 $(2+\\sqrt{3}, 0)$。\n\n情况4：$x \\ne 0$ 且 $y \\ne 0$。\n不动点方程为：\n$$ (1+x^2)(1+y^2) = 4x $$\n$$ (1+y^2)(1+x^2) = 4y $$\n这意味着 $4x = 4y$，所以 $x=y$。将 $y=x$ 代入第一个方程得到 $(1+x^2)^2 = 4x$，展开为 $x^4 + 2x^2 + 1 = 4x$，或 $x^4 + 2x^2 - 4x + 1 = 0$。\n我们测试整数根，发现 $x=1$ 是一个根： $1^4 + 2(1)^2 - 4(1) + 1 = 0$。\n我们可以从多项式中提出因子 $(x-1)$：$(x-1)(x^3 + x^2 + 3x - 1) = 0$。\n所以，一个解是 $x=1$。我们来分析三次因子 $P(x) = x^3 + x^2 + 3x - 1$。其导数为 $P'(x) = 3x^2 + 2x + 3$。$P'(x)$ 的判别式是 $2^2 - 4(3)(3) = -32 < 0$，所以对所有实数 $x$，$P'(x) > 0$。因此，$P(x)$ 是严格单调递增的，并且只有一个实根。由于 $P(0)=-1$ 且 $P(1)=4$，这个根（我们称之为 $x_s$）位于区间 $(0, 1)$ 内。\n这种情况给出了两个不动点：$(1, 1)$ 和 $(x_s, x_s)$。\n\n总共有 $1+2+2+2=7$ 个不动点在非负象限中：\n1. $P_1 = (0, 0)$\n2. $P_2 = (0, 2-\\sqrt{3})$\n3. $P_3 = (0, 2+\\sqrt{3})$\n4. $P_4 = (2-\\sqrt{3}, 0)$\n5. $P_5 = (2+\\sqrt{3}, 0)$\n6. $P_6 = (1, 1)$\n7. $P_7 = (x_s, x_s)$，其中 $x_s^3+x_s^2+3x_s-1=0$。\n\n步骤2：线性稳定性分析\n我们计算雅可比矩阵 $J(x,y)$:\n$$ J(x,y) = \\begin{pmatrix} \\frac{\\partial f}{\\partial x} & \\frac{\\partial f}{\\partial y} \\\\ \\frac{\\partial g}{\\partial x} & \\frac{\\partial g}{\\partial y} \\end{pmatrix} $$\n偏导数为：\n$\\frac{\\partial f}{\\partial x} = \\frac{8x(1-x^2)}{(1+x^2)^2(1+y^2)} - 1$\n$\\frac{\\partial f}{\\partial y} = \\frac{-8x^2y}{(1+x^2)(1+y^2)^2}$\n$\\frac{\\partial g}{\\partial x} = \\frac{-8y^2x}{(1+y^2)(1+x^2)^2}$\n$\\frac{\\partial g}{\\partial y} = \\frac{8y(1-y^2)}{(1+y^2)^2(1+x^2)} - 1$\n\n在不动点，$\\frac{4x}{(1+x^2)(1+y^2)} = 1$ 或 $x=0$。\n因此 $\\frac{\\partial f}{\\partial x}|_{FP} = \\frac{2(1-x^2)}{x} \\cdot \\frac{4x}{(1+x^2)(1+y^2)} - 1 = \\frac{2(1-x^2)}{x} \\cdot \\frac{1}{1} - 1$. 这个简化不正确。\nLet's use the definition of the fixed point more carefully:\nAt a fixed point $(x, y)$, either $x=0$ or $\\frac{4x}{(1+x^2)(1+y^2)}=1$.\nThe partial derivative is $\\frac{\\partial f}{\\partial x} = \\frac{8x(1+x^2)(1+y^2) - 4x^2(2x)(1+y^2)}{(1+x^2)^2(1+y^2)^2} - 1 = \\frac{4x(1+y^2)[2(1+x^2)-2x^2]}{(1+x^2)^2(1+y^2)^2} - 1 = \\frac{8x}{(1+x^2)^2(1+y^2)} - 1$.\n$\\frac{\\partial f}{\\partial y} = \\frac{-8x^2y}{(1+x^2)(1+y^2)^2}$.\n$\\frac{\\partial g}{\\partial x} = \\frac{-8y^2x}{(1+y^2)(1+x^2)^2}$.\n$\\frac{\\partial g}{\\partial y} = \\frac{8y}{(1+y^2)^2(1+x^2)} - 1$.\n\n- 在 $P_1 = (0,0)$ 处：\n$J(0,0) = \\begin{pmatrix} -1 & 0 \\\\ 0 & -1 \\end{pmatrix}$。特征值为 $\\lambda_1 = -1$, $\\lambda_2 = -1$。两者均为负，所以 $(0,0)$ 是 **渐近稳定的**。\n\n- 在 $P_2 = (0, 2-\\sqrt{3})$ 和 $P_3 = (0, 2+\\sqrt{3})$ 处：\n设不动点为 $(0, y^*)$，其中 $y^{*2}-4y^*+1=0$, or $\\frac{4y^*}{1+y^{*2}}=1$.\n$J(0, y^*) = \\begin{pmatrix} \\frac{8(0)}{...} - 1 & \\frac{-8(0)^2y^*}{...} \\\\ \\frac{-8y^{*2}(0)}{...} & \\frac{8y^*}{(1+y^{*2})^2(1+0^2)} - 1 \\end{pmatrix} = \\begin{pmatrix} -1 & 0 \\\\ 0 & \\frac{8y^*}{(1+y^{*2})^2} - 1 \\end{pmatrix}$.\n特征值为 $\\lambda_1 = -1$ 和 $\\lambda_2 = \\frac{8y^*}{(1+y^{*2})^2} - 1$.\nSince $1+y^{*2}=4y^*$, we have $\\lambda_2 = \\frac{8y^*}{(4y^*)^2} - 1 = \\frac{8y^*}{16y^{*2}} - 1 = \\frac{1}{2y^*} - 1$.\n对于 $y^* = 2-\\sqrt{3} \\approx 0.268$: $\\lambda_2 = \\frac{1}{2(2-\\sqrt{3})} - 1 = \\frac{2+\\sqrt{3}}{2} - 1 = 1 + \\frac{\\sqrt{3}}{2} - 1 = \\frac{\\sqrt{3}}{2} > 0$. $P_2$ 是不稳定的（鞍点）。\n对于 $y^* = 2+\\sqrt{3} \\approx 3.732$: $\\lambda_2 = \\frac{1}{2(2+\\sqrt{3})} - 1 = \\frac{2-\\sqrt{3}}{2} - 1 = 1 - \\frac{\\sqrt{3}}{2} - 1 = -\\frac{\\sqrt{3}}{2} < 0$。两个特征值均为负，所以 $P_3 = (0, 2+\\sqrt{3})$ 是 **渐近稳定的**。\n\n- 在 $P_4 = (2-\\sqrt{3}, 0)$ 和 $P_5 = (2+\\sqrt{3}, 0)$ 处：\n根据与前面分析的对称性，特征值为 $\\lambda_1 = -1$ 和 $\\lambda_2 = \\frac{1}{2x^*} - 1$。\n对于 $x^* = 2-\\sqrt{3}$，$\\lambda_2 > 0$。$P_4$ 是不稳定的。\n对于 $x^* = 2+\\sqrt{3}$，$\\lambda_2 < 0$。两个特征值均为负，所以 $P_5 = (2+\\sqrt{3}, 0)$ 是 **渐近稳定的**。\n\n- 在 $P_6 = (1,1)$ 和 $P_7 = (x_s, x_s)$ 处：\n设不动点为 $(x^*, x^*)$，其中 $(1+x^{*2})^2 = 4x^*$。雅可比矩阵是对称的：$J(x^*,x^*) = \\begin{pmatrix} A & B \\\\ B & A \\end{pmatrix}$。\n$A = \\frac{8x^*}{(1+x^{*2})^3}-1$ 且 $B = \\frac{-8x^{*3}}{(1+x^{*2})^3}$。\n使用 $(1+x^{*2})^2 = 4x^*$，我们可以简化 $A$ 和 $B$：\n$A = \\frac{2(4x^*)}{(1+x^{*2})^3}-1 = \\frac{2(1+x^{*2})^2}{(1+x^{*2})^3}-1 = \\frac{2}{1+x^{*2}}-1 = \\frac{1-x^{*2}}{1+x^{*2}}$。\n$B = \\frac{-2x^{*2}(4x^*)}{(1+x^{*2})^3} = \\frac{-2x^{*2}(1+x^{*2})^2}{(1+x^{*2})^3} = \\frac{-2x^{*2}}{1+x^{*2}}$。\n此矩阵的特征值为 $\\lambda = A \\pm B$。\n$\\lambda_1 = A-B = \\frac{1-x^{*2}}{1+x^{*2}} - \\frac{-2x^{*2}}{1+x^{*2}} = \\frac{1+x^{*2}}{1+x^{*2}} = 1$。\n由于一个特征值为 $\\lambda_1 = 1 > 0$，对角线 $y=x$（其中 $x>0$）上的任何不动点都是不稳定的。这适用于 $P_6=(1,1)$ 和 $P_7=(x_s,x_s)$。为了完整起见，$\\lambda_2 = A+B = \\frac{1-3x^{*2}}{1+x^{*2}}$。对于 $x^*=1$，$\\lambda_2 = -1/2$。对于 $x^*=x_s \\in(0,1)$，由于 $x_s < 1/\\sqrt{3}$（因为$P(1/\\sqrt{3}) > 0$），$\\lambda_2 > 0$。但不稳定性已经由 $\\lambda_1=1$ 确定。\n\n步骤3：结论\n我们总结七个不动点的稳定性：\n1. $P_1 = (0, 0)$: 稳定。\n2. $P_2 = (0, 2-\\sqrt{3})$: 不稳定。\n3. $P_3 = (0, 2+\\sqrt{3})$: 稳定。\n4. $P_4 = (2-\\sqrt{3}, 0)$: 不稳定。\n5. $P_5 = (2+\\sqrt{3}, 0)$: 稳定。\n6. $P_6 = (1, 1)$: 不稳定。\n7. $P_7 = (x_s, x_s)$: 不稳定。\n\n在非负象限中有三个渐近稳定的不动点。这些不动点对应于三种细胞状态：两个基因都关闭（基态），或者一个基因高表达而另一个基因关闭（两种分化状态之一）。\n\n渐近稳定不动点的总数为 $3$。", "answer": "$$\\boxed{3}$$", "id": "2624329"}, {"introduction": "单细胞技术的出现彻底改变了我们描绘发育过程的能力，但静态快照可能隐藏了潜在的动态。RNA速度是一个强大的计算概念，通过检查新转录（unspliced）和成熟（spliced）的 $mRNA$ 之间的平衡来推断细胞的未来状态。在本练习中，您将实现一种算法，从RNA速度向量中计算命运偏好概率，从本质上预测细胞在发育图景上的下一步行动 [@problem_id:2624321]。本练习提供了前沿计算方法的实践经验，使您能够从高维单细胞数据集中提取动态、预测性的见解。", "problem": "现给定一个单细胞状态空间的数学抽象，其中信使核糖核酸(mRNA)动力学产生一个局部速度场，该速度场近似于细胞分子状态的瞬时时间导数。其核心生物学基础是：(i) 分子生物学中心法则（转录为mRNA，再到蛋白质）和 (ii) 经过充分检验的剪接动力学，这两者共同证明了信使核糖核酸(mRNA)速度这一概念的合理性，即其可作为嵌入空间中细胞特征向量时间导数的局部估计。基于这些基本原理，假设细胞在微小时间间隔内的局部未来位移与mRNA速度向量对齐，并且转换更有可能沿着速度与图上邻近状态方向一致的方向发生。\n\n您的任务是编写一个完整的程序，对每个测试用例执行以下步骤，并返回一个从第一性原理推导出的标量命运偏向得分。\n\n基本设置：\n- 给定 $N$ 个细胞在低维状态空间中的嵌入，表示为点 $\\mathbf{x}_i \\in \\mathbb{R}^d$，以及一个相应的速度向量 $\\mathbf{v}_i \\in \\mathbb{R}^d$，该向量近似于从信使核糖核酸(mRNA)动力学推断出的 $\\dfrac{d\\mathbf{x}_i}{dt}$。\n- 在嵌入空间中使用欧几里得距离构建一个 $k$-近邻图；对于指定的索引 $i_0$（零基索引），将其 $k$ 个最近邻居的索引集表示为 $\\mathcal{N}(i_0)$。\n- 对于每个邻居 $j \\in \\mathcal{N}(i_0)$，定义位移向量 $\\Delta_{ij} = \\mathbf{x}_j - \\mathbf{x}_{i_0}$ 及其单位方向 $\\hat{\\Delta}_{ij} = \\dfrac{\\Delta_{ij}}{\\|\\Delta_{ij}\\|_2}$（当 $\\|\\Delta_{ij}\\|_2 > 0$ 时）。如果 $\\|\\Delta_{ij}\\|_2 = 0$，则下文定义的余弦相关性视为零。\n- 定义校正后的速度-方向一致性 $r_{ij}$ 为 $\\mathbf{v}_{i_0}$ 和 $\\Delta_{ij}$ 之间的非负相关性：\n  1. 当两个范数均为正时，计算余弦相似度 $c_{ij} = \\dfrac{\\mathbf{v}_{i_0} \\cdot \\Delta_{ij}}{\\|\\mathbf{v}_{i_0}\\|_2 \\, \\|\\Delta_{ij}\\|_2}$。\n  2. 如果任一范数为零或 $c_{ij} \\le 0$，则设置 $r_{ij} = 0$；否则设置 $r_{ij} = c_{ij}$。\n- 使用逆温度 $\\beta > 0$ 的玻尔兹曼归一化，将非负得分 $\\{r_{ij}\\}_{j \\in \\mathcal{N}(i_0)}$ 转换为 $\\mathcal{N}(i_0)$ 上的概率分布：\n  - 如果 $\\sum_{j \\in \\mathcal{N}(i_0)} r_{ij} = 0$（例如，如果 $\\|\\mathbf{v}_{i_0}\\|_2 = 0$ 或所有投影均为非正值），则在 $k$ 个邻居上定义一个均匀分布：$p_{ij} = \\dfrac{1}{k}$。\n  - 否则，定义 $p_{ij} = \\dfrac{\\exp(\\beta \\, r_{ij})}{\\sum\\limits_{\\ell \\in \\mathcal{N}(i_0)} \\exp(\\beta \\, r_{i\\ell})}$。\n- 每个细胞 $j$ 都有一个簇标签 $g_j \\in \\mathbb{Z}$。两个终末命运由不相交的标签集 $\\mathcal{A}$ 和 $\\mathcal{B}$ 定义。\n- 将索引 $i_0$ 的命运偏向得分定义为\n$$\n\\Delta(i_0;\\mathcal{A},\\mathcal{B}) \\;=\\; \\sum_{j \\in \\mathcal{N}(i_0) \\,\\cap\\, \\{\\,g_j \\in \\mathcal{A}\\,\\}} p_{ij} \\;-\\; \\sum_{j \\in \\mathcal{N}(i_0) \\,\\cap\\, \\{\\,g_j \\in \\mathcal{B}\\,\\}} p_{ij}.\n$$\n该得分位于区间 $[-1,1]$ 内，并解释了细胞 $i_0$ 沿直接图转换路径，在mRNA速度信息指导下对命运 $\\mathcal{A}$ 与命运 $\\mathcal{B}$ 的偏向。\n\n算法约束：\n- 使用欧几里得距离构建指定索引 $i_0$ 的 $k$-近邻。\n- 如果距离相等，按索引升序来解决平局问题。\n- 所有索引均使用零基索引。\n- 输出不涉及任何物理单位。\n\n测试套件：\n实现您的程序，为以下四个独立的测试用例计算 $\\Delta(i_0;\\mathcal{A},\\mathcal{B})$。对于每个测试用例，您将获得嵌入矩阵 $X \\in \\mathbb{R}^{N \\times d}$、速度矩阵 $V \\in \\mathbb{R}^{N \\times d}$、标签向量 $G \\in \\mathbb{Z}^N$、索引 $i_0 \\in \\mathbb{Z}$、邻居数 $k \\in \\mathbb{Z}_{>0}$、逆温度 $\\beta \\in \\mathbb{R}_{>0}$，以及定义 $\\mathcal{A} = \\{a\\}$ 和 $\\mathcal{B} = \\{b\\}$ 的终末标签值 $a \\in \\mathbb{Z}$ 和 $b \\in \\mathbb{Z}$。\n\n- 测试用例 $1$ (一维线，具有清晰的正向流):\n  - $X = \\begin{bmatrix} 0 \\\\ 1 \\\\ 2 \\end{bmatrix}$，视为 $N = 3$, $d = 1$。\n  - $V = \\begin{bmatrix} 1 \\\\ 1 \\\\ 1 \\end{bmatrix}$。\n  - $G = \\begin{bmatrix} 0 \\\\ 2 \\\\ 1 \\end{bmatrix}$。\n  - $i_0 = 1$, $k = 2$, $\\beta = 5.0$, $a = 1$, $b = 0$。\n\n- 测试用例 $2$ (一维，零速度边缘情况):\n  - $X = \\begin{bmatrix} 0 \\\\ 1 \\\\ 2 \\end{bmatrix}$，$N = 3$, $d = 1$。\n  - $V = \\begin{bmatrix} 1 \\\\ 0 \\\\ -1 \\end{bmatrix}$，其中仅 $\\mathbf{v}_{1} = 0$ 有关。\n  - $G = \\begin{bmatrix} 0 \\\\ 2 \\\\ 1 \\end{bmatrix}$。\n  - $i_0 = 1$, $k = 2$, $\\beta = 5.0$, $a = 1$, $b = 0$。\n\n- 测试用例 $3$ (二维，多个正向对齐方向):\n  - $X = \\begin{bmatrix}\n  0 & 0 \\\\\n  1 & 0 \\\\\n  1 & 1 \\\\\n  2 & 0 \\\\\n  2 & 1\n  \\end{bmatrix}$，因此 $N = 5$, $d = 2$。\n  - $V = \\begin{bmatrix}\n  0 & 0 \\\\\n  0 & 0 \\\\\n  1 & -0.8 \\\\\n  0 & 0 \\\\\n  0 & 0\n  \\end{bmatrix}$，其中仅 $\\mathbf{v}_{2} = (1,-0.8)$ 有关。\n  - $G = \\begin{bmatrix} 0 \\\\ 0 \\\\ 2 \\\\ 1 \\\\ 1 \\end{bmatrix}$。\n  - $i_0 = 2$, $k = 4$, $\\beta = 2.0$, $a = 1$, $b = 0$。\n\n- 测试用例 $4$ (二维，包含一个重复位置的邻居，按索引解决平局):\n  - $X = \\begin{bmatrix}\n  0 & 0 \\\\\n  0 & 0 \\\\\n  1 & 0 \\\\\n  0 & 1\n  \\end{bmatrix}$，因此 $N = 4$, $d = 2$。\n  - $V = \\begin{bmatrix}\n  0.5 & 0.5 \\\\\n  0 & 0 \\\\\n  0 & 0 \\\\\n  0 & 0\n  \\end{bmatrix}$，其中仅 $\\mathbf{v}_{0} = (0.5,0.5)$ 有关。\n  - $G = \\begin{bmatrix} 2 \\\\ 2 \\\\ 1 \\\\ 0 \\end{bmatrix}$。\n  - $i_0 = 0$, $k = 3$, $\\beta = 3.0$, $a = 1$, $b = 0$。\n\n要求的程序行为：\n- 对上述每个测试用例，按照要求的方法计算标量 $\\Delta(i_0;\\mathcal{A},\\mathcal{B})$。\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果，结果顺序为测试用例1、测试用例2、测试用例3、测试用例4；例如，形如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$ 的输出。", "solution": "我们从基础生物学原理出发：信使核糖核酸(mRNA)反映了转录状态，而剪接动力学能够对细胞转录组状态的时间导数进行可靠的局部估计，这被称为信使核糖核酸(mRNA)速度。令 $\\mathbf{x}_i \\in \\mathbb{R}^d$ 表示细胞 $i$ 的嵌入状态，$\\mathbf{v}_i \\approx \\dfrac{d\\mathbf{x}_i}{dt}$ 表示其速度。在一个微小的时间间隔 $\\Delta t$ 内，预期的位移约为 $\\Delta \\mathbf{x}_i \\approx \\mathbf{v}_i \\Delta t$，这证明了 $\\mathbf{v}_i$ 的方向编码了流形中的局部优选转换方向。\n\n我们使用欧几里得距离下的 $k$-近邻图来离散化该流形。对于一个中心细胞 $i_0$，每个邻居 $j \\in \\mathcal{N}(i_0)$ 都定义了一个方向 $\\Delta_{ij} = \\mathbf{x}_j - \\mathbf{x}_{i_0}$。为了量化瞬时流 $\\mathbf{v}_{i_0}$ 与指向 $j$ 的方向之间的一致性，我们使用余弦相似度\n$$\nc_{ij} \\;=\\; \\frac{\\mathbf{v}_{i_0} \\cdot \\Delta_{ij}}{\\|\\mathbf{v}_{i_0}\\|_2 \\, \\|\\Delta_{ij}\\|_2},\n$$\n约定如果任一范数为零，则 $c_{ij}$ 视为 $0$。负的余弦值表示速度指向远离邻居 $j$ 的方向。由于在流一致的转换模型中，“逆流”的转换不应具有权重，我们进行校正：\n$$\nr_{ij} \\;=\\; \\max\\{\\, c_{ij}, \\, 0 \\,\\}.\n$$\n为了从 $i_0$ 获得一个概率转换模型，我们采用逆温度为 $\\beta > 0$ 的玻尔兹曼归一化：\n- 如果 $\\sum_{j \\in \\mathcal{N}(i_0)} r_{ij} = 0$，我们统一设置 $p_{ij} = \\dfrac{1}{k}$。这涵盖了诸如 $\\|\\mathbf{v}_{i_0}\\|_2 = 0$ 或所有对齐均为非正值的边缘情况，并编码了关于优选方向的信息缺失。\n- 否则，\n$$\np_{ij} \\;=\\; \\frac{\\exp(\\beta \\, r_{ij})}{\\sum\\limits_{\\ell \\in \\mathcal{N}(i_0)} \\exp(\\beta \\, r_{i\\ell})}.\n$$\n最后，终末命运由不相交的标签集 $\\mathcal{A}$ 和 $\\mathcal{B}$ 表示，命运偏向得分是\n$$\n\\Delta(i_0;\\mathcal{A},\\mathcal{B}) \\;=\\; \\sum_{j \\in \\mathcal{N}(i_0) \\,\\cap\\, \\{\\,g_j \\in \\mathcal{A}\\,\\}} p_{ij} \\;-\\; \\sum_{j \\in \\mathcal{N}(i_0) \\,\\cap\\, \\{\\,g_j \\in \\mathcal{B}\\,\\}} p_{ij},\n$$\n其值在 $[-1,1]$ 之间。接近 $1$ 的值表示对 $\\mathcal{A}$ 有强偏向，接近 $-1$ 表示对 $\\mathcal{B}$ 有强偏向，而接近 $0$ 则表示模糊或平衡。\n\n算法细节：\n- 计算从 $\\mathbf{x}_{i_0}$ 到所有 $\\mathbf{x}_j$ 的欧几里得距离，排除 $j = i_0$，并选择 $k$ 个最小距离。若距离出现平局，按索引升序解决。\n- 对每个选定的邻居 $j$，计算 $\\Delta_{ij}$、其范数和余弦相似度。如上所述进行校正以获得 $r_{ij}$。\n- 如果 $\\sum_j r_{ij} = 0$，则设 $p_{ij} = \\dfrac{1}{k}$；否则应用玻尔兹曼归一化。\n- 使用簇标签计算命运偏向 $\\Delta(i_0;\\mathcal{A},\\mathcal{B})$。\n\n测试用例的合理性评估（从定性到定量的 一致性）：\n\n- 测试用例 1：\n  - $\\mathbf{x}_{1} = 1$，$k=2$ 时的邻居是索引 $0$ 和 $2$，距离相等。$\\mathbf{v}_{1} = 1$ 指向右侧。位移：到 $0$ 的位移是负的，到 $2$ 的位移是正的。因此 $c_{1,0} = -1$, $c_{1,2} = 1$，得到 $r_{1,0} = 0$, $r_{1,2} = 1$。当 $\\beta = 5.0$ 时，概率为 $p_{1,2} = \\dfrac{e^{5}}{e^{5} + e^{0}}$ 和 $p_{1,0} = \\dfrac{e^{0}}{e^{5} + e^{0}}$。命运集为 $\\mathcal{A}=\\{1\\}$ (邻居索引 $2$ 的标签为 $1$) 和 $\\mathcal{B}=\\{0\\}$ (邻居索引 $0$ 的标签为 $0$)，所以\n  $$\n  \\Delta \\approx p_{1,2} - p_{1,0} \\approx \\frac{e^{5} - 1}{e^{5} + 1},\n  $$\n  这个值接近 $1$，具体约为 $0.9866$。\n\n- 测试用例 2：\n  - $\\mathbf{v}_{1} = 0$，因此所有 $c_{1j}$ 都被视为 $0$。在 $k=2$ 个邻居上的均匀分布得出 $p_{1,0} = p_{1,2} = \\dfrac{1}{2}$，因此 $\\Delta = \\dfrac{1}{2} - \\dfrac{1}{2} = 0$。\n\n- 测试用例 3：\n  - $\\mathbf{x}_{2} = (1,1)$，邻居包括方向大致为 $(0,-1)$、$(1,0)$、$(1,-1)$ 的索引，以及一个负向对齐的 $(-1,-1)$。对于 $\\mathbf{v}_2 = (1,-0.8)$，沿着三个有利方向的余弦值为正，其中沿 $(1,-1)$ 方向最大，沿 $(1,0)$ 方向中等，沿 $(0,-1)$ 方向较小。当 $\\beta = 2.0$ 时，softmax 最强调 $(1,-1)$。由于标签为 $\\mathcal{A}=\\{1\\}$ 的细胞在右侧，而标签为 $\\mathcal{B}=\\{0\\}$ 的细胞在左侧或左下方，最终的偏向 $\\Delta$ 为正，但小于 $1$，因为有一个非零概率分配给了属于 $\\mathcal{B}$ 的邻居。数值计算结果约为 $0.458$。\n\n- 测试用例 4：\n  - $\\mathbf{x}_{0} = (0,0)$ 在索引 $1$ 处有一个重复位置的邻居，其位移范数为 $0$，根据规则，其贡献 $r_{0,1} = 0$，因此 $p_{0,1}$ 仅通过玻尔兹曼归一化的基线产生贡献。另外两个邻居 $(1,0)$ 和 $(0,1)$ 与 $\\mathbf{v}_0 = (0.5,0.5)$ 具有相等的正余弦对齐值，因此对于 $\\beta = 3.0$，根据对称性有 $p_{0,2} = p_{0,3}$。由于 $\\mathcal{A}=\\{1\\}$ 捕获了索引 $2$，$\\mathcal{B}=\\{0\\}$ 捕获了索引 $3$，偏向 $\\Delta = p_{0,2} - p_{0,3} = 0$。\n\n程序将精确实现这些计算，并以要求的单行列表格式输出四个标量偏向值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef knn_indices_for_i(X, i0, k):\n    \"\"\"\n    Compute indices of k nearest neighbors of i0 in X using Euclidean distance.\n    Tie-break by ascending index when distances are equal.\n    Exclude i0 from neighbors.\n    \"\"\"\n    xi = X[i0]\n    diffs = X - xi  # shape (N, d)\n    dists = np.sqrt(np.sum(diffs**2, axis=1))  # shape (N,)\n    # Exclude self by setting its distance to +inf\n    dists[i0] = np.inf\n    # Lexsort by (distance, index) to ensure stable tie-breaking by index\n    indices = np.arange(X.shape[0])\n    order = np.lexsort((indices, dists))\n    neighbors = order[:k]\n    return neighbors\n\ndef rectified_cosine(v, d):\n    \"\"\"\n    Compute rectified cosine similarity between vector v and displacement d.\n    Return 0 if either norm is zero or if cosine <= 0.\n    \"\"\"\n    v_norm = np.linalg.norm(v)\n    d_norm = np.linalg.norm(d)\n    if v_norm == 0.0 or d_norm == 0.0:\n        return 0.0\n    cos_sim = float(np.dot(v, d) / (v_norm * d_norm))\n    if cos_sim <= 0.0:\n        return 0.0\n    return cos_sim\n\ndef transition_probabilities(X, V, i0, neighbors, beta):\n    \"\"\"\n    Compute transition probabilities from i0 to given neighbors using\n    rectified cosine similarities and Boltzmann normalization with inverse temperature beta.\n    If all rectified scores are zero (or v is zero), return uniform distribution.\n    \"\"\"\n    v = V[i0]\n    # Compute rectified correlations\n    r = np.array([rectified_cosine(v, X[j] - X[i0]) for j in neighbors], dtype=float)\n    if np.all(r <= 0.0):\n        # Uniform distribution over neighbors\n        p = np.full(len(neighbors), 1.0 / len(neighbors))\n        return p\n    # Boltzmann normalization\n    exps = np.exp(beta * r)\n    Z = np.sum(exps)\n    # Numerical stability: if Z is zero (unlikely), fallback to uniform\n    if Z == 0.0 or not np.isfinite(Z):\n        p = np.full(len(neighbors), 1.0 / len(neighbors))\n    else:\n        p = exps / Z\n    return p\n\ndef fate_bias_delta(p, neighbors, G, a_label, b_label):\n    \"\"\"\n    Compute fate bias Delta = sum_{A} p - sum_{B} p among neighbors\n    based on their labels in G matching a_label and b_label respectively.\n    \"\"\"\n    g_neighbors = G[neighbors]\n    mask_A = (g_neighbors == a_label)\n    mask_B = (g_neighbors == b_label)\n    sum_A = float(np.sum(p[mask_A]))\n    sum_B = float(np.sum(p[mask_B]))\n    return sum_A - sum_B\n\ndef solve():\n    # Define the test cases as specified in the problem statement.\n\n    # Test case 1\n    X1 = np.array([[0.0],\n                   [1.0],\n                   [2.0]], dtype=float)\n    V1 = np.array([[1.0],\n                   [1.0],\n                   [1.0]], dtype=float)\n    G1 = np.array([0, 2, 1], dtype=int)\n    i0_1 = 1\n    k1 = 2\n    beta1 = 5.0\n    a1, b1 = 1, 0\n\n    # Test case 2\n    X2 = np.array([[0.0],\n                   [1.0],\n                   [2.0]], dtype=float)\n    V2 = np.array([[1.0],\n                   [0.0],\n                   [-1.0]], dtype=float)  # Only v at i0=1 matters (zero)\n    G2 = np.array([0, 2, 1], dtype=int)\n    i0_2 = 1\n    k2 = 2\n    beta2 = 5.0\n    a2, b2 = 1, 0\n\n    # Test case 3\n    X3 = np.array([[0.0, 0.0],\n                   [1.0, 0.0],\n                   [1.0, 1.0],\n                   [2.0, 0.0],\n                   [2.0, 1.0]], dtype=float)\n    V3 = np.array([[0.0, 0.0],\n                   [0.0, 0.0],\n                   [1.0, -0.8],\n                   [0.0, 0.0],\n                   [0.0, 0.0]], dtype=float)\n    G3 = np.array([0, 0, 2, 1, 1], dtype=int)\n    i0_3 = 2\n    k3 = 4\n    beta3 = 2.0\n    a3, b3 = 1, 0\n\n    # Test case 4\n    X4 = np.array([[0.0, 0.0],\n                   [0.0, 0.0],\n                   [1.0, 0.0],\n                   [0.0, 1.0]], dtype=float)\n    V4 = np.array([[0.5, 0.5],\n                   [0.0, 0.0],\n                   [0.0, 0.0],\n                   [0.0, 0.0]], dtype=float)\n    G4 = np.array([2, 2, 1, 0], dtype=int)\n    i0_4 = 0\n    k4 = 3\n    beta4 = 3.0\n    a4, b4 = 1, 0\n\n    test_cases = [\n        (X1, V1, G1, i0_1, k1, beta1, a1, b1),\n        (X2, V2, G2, i0_2, k2, beta2, a2, b2),\n        (X3, V3, G3, i0_3, k3, beta3, a3, b3),\n        (X4, V4, G4, i0_4, k4, beta4, a4, b4),\n    ]\n\n    results = []\n    for X, V, G, i0, k, beta, a_label, b_label in test_cases:\n        neighbors = knn_indices_for_i(X, i0, k)\n        p = transition_probabilities(X, V, i0, neighbors, beta)\n        delta = fate_bias_delta(p, neighbors, G, a_label, b_label)\n        results.append(delta)\n\n    # Final print statement in the exact required format.\n    print(f\"[{results[0]},{results[1]},{results[2]},{results[3]}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2624321"}]}