{"hands_on_practices": [{"introduction": "要掌握 Tau-leaping 方法，首先必须理解其核心更新机制。这个练习将带你从最基础的层面入手，为一个简单的可逆二聚化反应推导状态更新方程。通过将化学计量变化与反应事件数相结合，你将亲手构建 Tau-leaping 模拟的基本构件，这对于后续理解更复杂的系统和算法至关重要。[@problem_id:1470711]", "problem": "在系统生物学中，随机模拟算法对于模拟细胞内的生物化学反应网络至关重要，因为在这些网络中，分子数量较少会导致显著的随机涨落。考虑一个蛋白质 $P$ 聚合成二聚体 $P_2$ 的简化模型，这个过程与许多细胞功能相关。\n\n该系统包含两个可逆反应：一个正向二聚化反应，其中两个蛋白质单体形成一个二聚体；以及一个逆向反应，其中一个二聚体解离变回两个单体。这可以表示为：\n$$2P \\underset{k_r}{\\stackrel{k_f}{\\rightleftharpoons}} P_2$$\n其中 $k_f$ 和 $k_r$ 分别是正向和逆向随机速率常数。\n\n在任意时刻 $t$，系统的状态由单体分子数 $N_P(t)$ 和二聚体分子数 $N_{P2}(t)$ 描述。\n\n我们希望使用 Tau-leaping 近似法来模拟该系统的演化，该方法以一个固定的时间步长 $\\tau$ 来推进系统。在此方法中，每个反应通道在时间区间 $[t, t+\\tau]$ 内发生的次数被建模为一个随机变量。设 $K_f$ 是时长为 $\\tau$ 的单个时间步长内发生的正向反应事件（二聚化）的次数，$K_r$ 是逆向反应事件（解离）的次数。\n\n确定在时刻 $t+\\tau$ 时单体和二聚体分子数的更新方程。您的最终答案应包含两个表达式，一个用于 $N_P(t+\\tau)$，另一个用于 $N_{P2}(t+\\tau)$，并用时刻 $t$ 的状态（即 $N_P(t)$ 和 $N_{P2}(t)$）以及反应事件数（$K_f$ 和 $K_r$）来表示。", "solution": "我们用状态向量 $X(t) = \\big(N_{P}(t),\\, N_{P2}(t)\\big)$ 来为系统建模。在 Tau-leaping 方法中，在时长为 $\\tau$ 的时间区间内，状态的变化等于每个反应的化学计量变化乘以该反应在该区间内发生的次数。用 $K_{f}$ 和 $K_{r}$ 分别表示在 $[t, t+\\tau]$ 时间区间内正向和逆向反应事件的发生次数。\n\n对于反应 $2P \\to P_{2}$（正向），化学计量变化向量为\n$$\nv_{f} = \\big(-2,\\; +1\\big),\n$$\n因为每次反应发生会消耗 $2$ 个单体并产生 $1$ 个二聚体。\n\n对于反应 $P_{2} \\to 2P$（逆向），化学计量变化向量为\n$$\nv_{r} = \\big(+2,\\; -1\\big),\n$$\n因为每次反应发生会产生 $2$ 个单体并消耗 $1$ 个二聚体。\n\n于是，Tau-leaping 更新法则为\n$$\nX(t+\\tau) = X(t) + v_{f}\\,K_{f} + v_{r}\\,K_{r}.\n$$\n将各分量明确写出，我们得到\n$$\nN_{P}(t+\\tau) = N_{P}(t) - 2K_{f} + 2K_{r},\n$$\n$$\nN_{P2}(t+\\tau) = N_{P2}(t) + K_{f} - K_{r}.\n$$\n这些就是所求的更新方程，它们用时刻 $t$ 的状态以及在时长为 $\\tau$ 的步长内的反应次数 $K_{f}$ 和 $K_{r}$ 来表示。", "answer": "$$\\boxed{\\begin{pmatrix}N_{P}(t+\\tau) & N_{P2}(t+\\tau)\\end{pmatrix}=\\begin{pmatrix}N_{P}(t)-2K_{f}+2K_{r} & N_{P2}(t)+K_{f}-K_{r}\\end{pmatrix}}$$", "id": "1470711"}, {"introduction": "Tau-leaping 近似的一个关键假设是，在一个时间步 $\\tau$ 内，倾向性函数不会发生显著变化。当这个假设被违背时会发生什么？这个练习是一个警示性的思想实验，通过故意选择一个过大的时间步，你将亲眼见证一个简单的显式 Tau-leaping 算法如何产生非物理性的结果（例如负分子数）。这个实践突出了仔细选择 $\\tau$ 和理解“跳跃条件”在确保模拟有效性方面的重要性。[@problem_id:1470716]", "problem": "一位系统生物学课程的学生正在研究一个单细胞内的简化代谢途径模型。该模型包含两个不可逆的化学反应：底物 $A$ 转化为中间产物 $B$，随后 $B$ 降解。这些反应遵循质量作用动力学：\n1.  $A \\xrightarrow{k_1} B$\n2.  $B \\xrightarrow{k_2} \\emptyset$\n\n系统的状态由物种 $A$ 和 $B$ 的分子数描述，分别记为 $n_A$ 和 $n_B$。这两个反应的倾向函数由 $a_1 = k_1 n_A$ 和 $a_2 = k_2 n_B$ 给出。\n\n该学生决定使用一种基本的显式 Tau-leaping 方法来模拟系统的演化。在此近似中，每个反应 $j$ 在时长为 $\\tau$ 的时间间隔内发生的次数（记为 $N_j$）被确定性地估计为 $N_j = a_j(t) \\cdot \\tau$，其中倾向函数 $a_j(t)$ 是使用该时间间隔开始时（即 $t$ 时刻）的系统状态计算的。\n\n在时间 $t=0$ 时，系统包含 $n_A(0) = 100$ 个分子和 $n_B(0) = 20$ 个分子。速率常数为 $k_1 = 0.05 \\text{ s}^{-1}$ 和 $k_2 = 1.0 \\text{ s}^{-1}$。该学生选择的时间步长为 $\\tau = 10 \\text{ s}$。\n\n计算经过这一个时间步长后物种 B 的分子数 $n_B(\\tau)$。以分子数的形式表达你的答案。", "solution": "各反应及其每次发生所产生的化学计量效应为：对于 $A \\to B$，$\\Delta n_{A}=-1$ 且 $\\Delta n_{B}=+1$；对于 $B \\to \\emptyset$，$\\Delta n_{A}=0$ 且 $\\Delta n_{B}=-1$。在时间 $t$ 的质量作用倾向函数为 $a_{1}(t)=k_{1}n_{A}(t)$ 和 $a_{2}(t)=k_{2}n_{B}(t)$。在显式 Tau-leaping 方法近似中，使用区间开始时的状态，在 $[t,t+\\tau)$ 时间段内反应的发生次数为 $N_{j}=a_{j}(t)\\tau$。\n\n给定 $n_{A}(0)=100$，$n_{B}(0)=20$，$k_{1}=0.05$，$k_{2}=1.0$ 以及 $\\tau=10$，计算初始倾向函数：\n$$\na_{1}(0)=k_{1}n_{A}(0)=0.05\\times 100=5,\\qquad a_{2}(0)=k_{2}n_{B}(0)=1.0\\times 20=20.\n$$\n那么，在该步长内的确定性事件计数为：\n$$\nN_{1}=a_{1}(0)\\tau=5\\times 10=50,\\qquad N_{2}=a_{2}(0)\\tau=20\\times 10=200.\n$$\n使用化学计量关系更新 $n_{B}$，\n$$\nn_{B}(\\tau)=n_{B}(0)+(+1)N_{1}+(-1)N_{2}=20+50-200=-130.\n$$\n这个负值结果表明所选的 Tau-leaping 步长已失效，但它确实是所述近似方法直接导致的结果。", "answer": "$$\\boxed{-130}$$", "id": "1470716"}, {"introduction": "基础的 Tau-leaping 方法虽然高效，但其准确性受限于其一阶近似。我们如何能构建一个更精确的算法呢？这个挑战性的练习将引导你超越基础的泊松步长近似，推导一个二阶校正项。通过构建一个类似于数值积分中梯形法则的随机积分器，你将深入了解提高随机模拟算法准确性的高级技术。[@problem_id:1470747]", "problem": "考虑一个由 $N$ 种化学物种组成的系统，该系统经历 $M$ 个反应通道。系统在时间 $t$ 的状态由分子数量向量 $\\mathbf{X}(t) = (X_1(t), \\dots, X_N(t))^T$ 给出。每个反应通道 $j \\in \\{1, \\dots, M\\}$ 的动力学由其倾向函数 $a_j(\\mathbf{X})$ 和其状态改变向量 $\\mathbf{v}_j$ 描述，该向量是 $N \\times M$ 化学计量矩阵 $\\mathbf{S}$ 的第 $j$ 列。元素 $S_{ik}$ 表示由于反应 $k$ 发生一次而引起的物种 $i$ 的分子数量变化。\n\nGillespie 随机模拟算法 (SSA) 提供了该系统轨迹的精确模拟。然而，对于具有大分子数量的系统，SSA 的计算成本可能高得令人望而却步。显式 Tau-leaping 方法通过以大小为 $\\tau$ 的离散步长推进时间来加速模拟。在其最简单的形式（泊松步长近似）中，每个反应 $j$ 在区间 $[t, t+\\tau]$ 内发生的次数 $K_j$ 从泊松分布 $K_j \\sim \\mathcal{P}(\\lambda_j)$ 中抽取，其均值为 $\\lambda_j = a_j(\\mathbf{X}(t))\\tau$。\n\n这个近似假设倾向函数在区间内保持不变，而随着 $\\tau$ 的增大，这个假设会失效。为了提高准确性，我们可以构建一个类梯形更新规则。这涉及使用区间 $[t, t+\\tau]$ 上的平均倾向函数来近似反应事件的平均发生次数，而不仅仅是使用起始时刻的倾向函数。\n\n你的任务是为反应通道 $j$ 在 Tau-leaping 方法中使用的泊松分布均值推导二阶修正项。假设修正后的均值为 $\\lambda_j^* = a_j(\\mathbf{X}(t))\\tau + \\delta_j$。请找出修正项 $\\delta_j$ 的表达式。\n\n为推导此表达式，你应该使用倾向函数 $a_j$ 的一阶多元泰勒展开来估计其在时间 $t+\\tau$ 的值。该展开所需的状态向量的期望变化，应使用未经修正的一阶泊松步长近似来计算。\n\n请提供修正项 $\\delta_j$ 的一个闭式解析表达式，该表达式应使用 $\\tau$、倾向函数 $a_k(\\mathbf{X}(t))$、化学计量矩阵的元素 $S_{ik}$ 以及倾向函数 $a_j(\\mathbf{X}(t))$ 对物种数量 $X_i$ 的偏导数来表示。", "solution": "我们寻求对反应通道 $j$ 在区间 $[t,t+\\tau]$ 上的平均发生次数进行一个类梯形修正。精确的均值是倾向函数在该区间上的积分，而梯形近似可得\n$$\n\\lambda_{j}^{*} \\approx \\frac{\\tau}{2}\\left(a_{j}(\\mathbf{X}(t)) + \\mathbb{E}\\left[a_{j}(\\mathbf{X}(t+\\tau))\\right]\\right).\n$$\n根据定义 $\\lambda_{j}^{*} = a_{j}(\\mathbf{X}(t))\\tau + \\delta_{j}$，我们有\n$$\n\\delta_{j} = \\frac{\\tau}{2}\\left(\\mathbb{E}\\left[a_{j}(\\mathbf{X}(t+\\tau))\\right]-a_{j}(\\mathbf{X}(t))\\right).\n$$\n为了近似 $a_{j}(\\mathbf{X}(t+\\tau))$，我们使用关于 $\\mathbf{X}(t)$ 的一阶多元泰勒展开：\n$$\na_{j}(\\mathbf{X}(t+\\tau)) \\approx a_{j}(\\mathbf{X}(t)) + \\sum_{i=1}^{N} \\frac{\\partial a_{j}}{\\partial X_{i}}(\\mathbf{X}(t))\\left(X_{i}(t+\\tau) - X_{i}(t)\\right).\n$$\n取期望值，\n$$\n\\mathbb{E}\\left[a_{j}(\\mathbf{X}(t+\\tau))\\right] \\approx a_{j}(\\mathbf{X}(t)) + \\sum_{i=1}^{N} \\frac{\\partial a_{j}}{\\partial X_{i}}(\\mathbf{X}(t))\\,\\mathbb{E}\\left[\\Delta X_{i}\\right],\n$$\n其中 $\\Delta \\mathbf{X} = \\mathbf{X}(t+\\tau)-\\mathbf{X}(t)$。在未经修正的泊松步长 Tau-leaping 方法下，反应次数向量 $\\mathbf{K}$ 的分量为 $K_{k} \\sim \\mathcal{P}(a_{k}(\\mathbf{X}(t))\\tau)$，并且 $\\Delta \\mathbf{X} = \\mathbf{S}\\mathbf{K}$。因此\n$$\n\\mathbb{E}\\left[\\Delta X_{i}\\right] = \\sum_{k=1}^{M} S_{ik}\\,\\mathbb{E}[K_{k}] = \\sum_{k=1}^{M} S_{ik}\\,a_{k}(\\mathbf{X}(t))\\,\\tau.\n$$\n将此结果代入 $\\delta_{j}$ 的表达式中，可得\n$$\n\\delta_{j} = \\frac{\\tau}{2}\\sum_{i=1}^{N} \\frac{\\partial a_{j}}{\\partial X_{i}}(\\mathbf{X}(t)) \\left(\\tau \\sum_{k=1}^{M} S_{ik}\\,a_{k}(\\mathbf{X}(t))\\right)\n= \\frac{\\tau^{2}}{2}\\sum_{i=1}^{N}\\sum_{k=1}^{M} S_{ik}\\,a_{k}(\\mathbf{X}(t))\\,\\frac{\\partial a_{j}}{\\partial X_{i}}(\\mathbf{X}(t)).\n$$\n这就是所求的闭式修正项。", "answer": "$$\\boxed{\\delta_{j}=\\frac{\\tau^{2}}{2}\\sum_{i=1}^{N}\\sum_{k=1}^{M}S_{ik}\\,a_{k}(\\mathbf{X}(t))\\,\\frac{\\partial a_{j}}{\\partial X_{i}}(\\mathbf{X}(t))}$$", "id": "1470747"}]}