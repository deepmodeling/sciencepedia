{"hands_on_practices": [{"introduction": "在进行主成分分析（PCA）后，首要步骤是评估其有效性，而碎石图（scree plot）是完成此任务的主要工具。本练习探讨“平坦”的碎石图揭示了关于数据结构的何种信息，教你如何评估PCA是否成功识别出低维结构，或者数据的方差是否分散在多个维度中，这可能是由噪声或数据内在的高维性所致。这项实践对于培养在得出结论前诊断PCA结果的关键技能至关重要。", "problem": "一位系统生物学研究员正在分析一个来自转录组学实验的大型数据集。该数据集包含在100个肿瘤样本（观测值）中测得的20,000个不同基因（变量）的表达水平。为了探索这个高维数据的潜在结构，该研究员进行了主成分分析（PCA）。\n\n运行分析后，研究员生成了一张碎石图，该图显示了每个主成分解释的总方差比例。他们观察到该图异常平坦：第一个主成分（PC1）仅解释了总方差的3.1%，PC2解释了2.9%，PC3解释了2.8%，并且后续成分所解释的方差呈现出非常缓慢、近乎线性的下降趋势。\n\n基于这一观察，关于这些基因表达数据最恰当的结论是什么？\n\nA. 数据集中的方差分布在许多维度上，这表明数据可能主要由随机噪声主导，或者其内在结构确实是高维的，并且不适合通过线性降维来处理。\nB. 数据具有一个简单的低维结构，但PCA算法由于计算错误而未能正确识别出来。\nC. 所有20,000个基因彼此之间都显示出强的正线性相关，这表明有一个单一的、主导性的生物学通路处于活跃状态。\nD. 前几个主成分保证是生物学上无意义的，因为它们解释的总方差比例太小。\nE. 实验是成功的，并且这100个肿瘤样本在基因表达谱方面彼此几乎完全相同。", "solution": "设数据矩阵为 $X \\in \\mathbb{R}^{n \\times p}$，其中有 $n=100$ 个样本和 $p=20000$ 个基因。将 $X$ 进行列中心化得到 $X_c$后，对变量进行的PCA对应于样本协方差矩阵 $S = \\frac{1}{n-1} X_{c}^{\\top} X_{c} \\in \\mathbb{R}^{p \\times p}$ 的特征分解。将 $S$ 的特征值记为 $\\lambda_{1} \\geq \\lambda_{2} \\geq \\cdots \\geq \\lambda_{p} \\geq 0$。总方差为 $\\operatorname{tr}(S) = \\sum_{i=1}^{p} \\lambda_{i}$，第 $k$ 个主成分解释的方差比例为 $v_{k} = \\frac{\\lambda_{k}}{\\sum_{i=1}^{p} \\lambda_{i}}$。\n\n因为列是中心化的，所以 $\\operatorname{rank}(S) \\leq n-1$，因此最多有 $n-1=99$ 个非零特征值。在一个具有简单低维结构（例如，强低秩信号）的数据集中，人们预期少数几个主要的特征值会远大于其余的特征值，从而产生一个带有清晰“肘部”且对于较小的 $k$ 值有较大 $v_k$ 值的碎石图。相反，当方差分布在许多方向上时，例如对于高维噪声或真正的高维结构，特征值的大小是可比的，碎石图相对平坦，没有占主导地位的主成分。\n\n观察到的碎石图显示 $v_{1} \\approx 0.031$, $v_{2} \\approx 0.029$, $v_{3} \\approx 0.028$，随后是缓慢、近乎线性的下降。这意味着 $\\lambda_{1}, \\lambda_{2}, \\lambda_{3}$ 仅比大部分特征值略大，并且不存在主导的低秩成分。在 $p \\gg n$ 的情况下，当存在弱低维结构或无低维结构时，随机矩阵理论的考虑（例如，类似于噪声的 Marchenko–Pastur 定律的特征值谱）预测谱中不会有大的前导尖峰，这与观察到的平坦碎石图是一致的。\n\n这一观察排除了其他选项：如果所有 $p$ 个基因都呈强正相关，$S$ 将近似为秩一矩阵，并有一个主导特征值，从而得到接近 $1$ 的 $v_1$ 值，这与 $v_{1} \\approx 0.031$ 相矛盾（因此选项C是错误的）。平坦的碎石图并不意味着存在计算错误；考虑到数据的方差结构，PCA的表现是符合预期的（因此选项B没有依据）。前几个主成分解释的方差小，并不能保证它们在生物学上是无意义的；有意义的生物学信息可能存在于解释总方差比例很小的主成分中，尤其是在高维组学数据中（因此选项D是错误的）。如果样本几乎完全相同，总体方差会非常小，但这并不会产生观察到的多个主成分各自解释相似小比例方差的模式；此外，“几乎完全相同”与存在许多可比较的变异方向相矛盾（因此选项E是错误的）。\n\n因此，恰当的结论是，方差分布在许多维度上，这与噪声主导的数据或无法通过线性降维很好捕捉的真正高维结构相一致。", "answer": "$$\\boxed{A}$$", "id": "1428886"}, {"introduction": "如果PCA被认为是有用的，下一步就是解释和利用其输出。主成分的载荷（loadings）提供了权重，可用于概括复杂的基因表达模式。本练习将指导你完成一个具体计算，从PCA载荷和新的样本数据中创建一个“元基因”（metagene）或通路活性得分。通过这项练习，你将明白一个抽象的主成分如何转化为一个具有生物学意义的定量指标。", "problem": "在系统生物学中，主成分分析（PCA）是一种强大的技术，用于降低大型数据集的维度，例如癌症患者的基因表达谱。一个常见的应用是导出一个“元基因得分”，用以概括某一生物通路的活性。\n\n一位研究人员正在研究癌细胞中一个特定的代谢通路，该通路涉及四个关键基因：Gene A、Gene B、Gene C 和 Gene D。他们对一个大型基因表达数据集进行主成分分析，发现第一主成分（PC1）与该通路的整体活性密切相关。他们决定使用 PC1 的载荷作为权重，为新样本创建一个通路活性得分。\n\n这四个基因的 PC1 载荷如下：\n- Gene A: 0.65\n- Gene B: 0.55\n- Gene C: -0.40\n- Gene D: 0.30\n\n现在分析一个新的肿瘤样本，并测量了这四个基因的标准化表达值（z-score）：\n- Gene A: 2.20\n- Gene B: 1.80\n- Gene C: 1.50\n- Gene D: -1.10\n\n该新样本的通路活性得分计算方法为：每个基因的表达值与其对应的 PC1 载荷的乘积之和。请计算这个新肿瘤样本的通路活性得分。将您的最终答案四舍五入到三位有效数字。", "solution": "题目要求我们计算一个新肿瘤样本的“通路活性得分”。该得分的定义是：每个基因的标准化表达值与其相应的第一主成分（PC1）载荷的乘积之和。这等同于计算表达向量和载荷向量的点积。\n\n设 PC1 载荷向量为 $\\mathbf{w}$，基因表达值向量为 $\\mathbf{g}$。\n对于 Gene A、B、C 和 D，其载荷向量 $\\mathbf{w}$ 如下所示：\n$$ \\mathbf{w} = \\begin{pmatrix} 0.65 \\\\ 0.55 \\\\ -0.40 \\\\ 0.30 \\end{pmatrix} $$\n\n新样本的基因表达向量 $\\mathbf{g}$ 如下所示：\n$$ \\mathbf{g} = \\begin{pmatrix} 2.20 \\\\ 1.80 \\\\ 1.50 \\\\ -1.10 \\end{pmatrix} $$\n\n通路活性得分 $S$ 通过点积 $\\mathbf{w} \\cdot \\mathbf{g}$ 计算得出：\n$$ S = \\sum_{i=1}^{4} w_i g_i = w_A g_A + w_B g_B + w_C g_C + w_D g_D $$\n\n现在，我们将给定的数值代入此公式：\n$$ S = (0.65)(2.20) + (0.55)(1.80) + (-0.40)(1.50) + (0.30)(-1.10) $$\n\n我们逐项计算每个乘积：\n- 对于 Gene A: $0.65 \\times 2.20 = 1.43$\n- 对于 Gene B: $0.55 \\times 1.80 = 0.99$\n- 对于 Gene C: $-0.40 \\times 1.50 = -0.60$\n- 对于 Gene D: $0.30 \\times -1.10 = -0.33$\n\n现在，我们将这些乘积相加得到最终得分：\n$$ S = 1.43 + 0.99 - 0.60 - 0.33 $$\n$$ S = 2.42 - 0.60 - 0.33 $$\n$$ S = 1.82 - 0.33 $$\n$$ S = 1.49 $$\n\n题目要求答案保留三位有效数字。计算出的值 $1.49$ 已经有三位有效数字。\n\n因此，通路活性得分为 1.49。", "answer": "$$\\boxed{1.49}$$", "id": "1428922"}, {"introduction": "在PCA图中观察到不同组别（例如，健康与患病）之间的分离是分析的第一步，但这可能仅仅是偶然现象。我们需要一个严谨的统计检验来确认这一观察的显著性。这项高级实践介绍了置换检验（permutation test），这是一种强大的非参数方法，用于评估PCA所发现模式的统计显著性。你将完成整个工作流程：运行PCA，定义一个分离度量，然后通过将观察到的度量与通过随机打乱标签生成的零分布进行比较来计算$p$-值，从而将可视化观察转化为稳健的科学结论。", "problem": "在一项初步的系统生物学研究中，研究人员测量了六个个体中两个基因（基因1，基因2）的表达水平。三个个体来自健康队列（H），另外三个被诊断患有某种特定疾病（D）。表达数据以（基因1，基因2）对的形式记录如下：\n- 健康个体：H1=(1, 5), H2=(2, 5), H3=(1, 4)\n- 患病个体：D1=(5, 1), D2=(5, 2), D3=(4, 1)\n\n为了探究数据中的主要变异轴，研究人员进行了主成分分析 (PCA)。首先，通过减去所有六个个体的平均表达水平来对每个基因的数据进行中心化。然后，确定第一主成分 (PC1)。PC1是样本协方差矩阵中对应最大特征值的归一化特征向量。随后，将所有六个个体的中心化数据投影到PC1上，从而为每个个体获得一个单一的分数。\n\n定义一个分离度量 $\\Delta$，其值为患病组的平均PC1分数与健康组的平均PC1分数之差的绝对值。为了评估观测到的分离是否具有统计显著性，必须计算一个$p$-值。$p$-值定义为：在将三个“患病”标签分配给六个个体的所有可能分配中，导致分离度量 $\\Delta$ 大于或等于从原始H/D标签获得的度量 $\\Delta_{obs}$ 的分配所占的比例。\n\n计算此$p$-值。将最终答案四舍五入到三位有效数字。", "solution": "该问题要求计算一个$p$-值，以评估健康组和患病组沿第一主成分 (PC1) 的分离是否具有统计显著性。这需要执行PCA，然后进行置换检验。\n\n**步骤1：整理数据并计算均值**\n数据矩阵 $X$（样本 $\\times$ 基因）为：\n$$\nX = \\begin{pmatrix}\n1 & 5 \\\\\n2 & 5 \\\\\n1 & 4 \\\\\n5 & 1 \\\\\n5 & 2 \\\\\n4 & 1\n\\end{pmatrix}\n$$\n计算每个基因（列）在所有六个个体中的均值：\n基因1的均值： $\\mu_1 = \\frac{1+2+1+5+5+4}{6} = \\frac{18}{6} = 3$\n基因2的均值： $\\mu_2 = \\frac{5+5+4+1+2+1}{6} = \\frac{18}{6} = 3$\n\n**步骤2：对数据进行中心化**\n从 $X$ 的每一行减去均值向量 $(\\mu_1, \\mu_2) = (3, 3)$，得到中心化数据矩阵 $X_c$：\n$$\nX_c = \\begin{pmatrix}\n1-3 & 5-3 \\\\\n2-3 & 5-3 \\\\\n1-3 & 4-3 \\\\\n5-3 & 1-3 \\\\\n5-3 & 2-3 \\\\\n4-3 & 1-3\n\\end{pmatrix} = \\begin{pmatrix}\n-2 & 2 \\\\\n-1 & 2 \\\\\n-2 & 1 \\\\\n2 & -2 \\\\\n2 & -1 \\\\\n1 & -2\n\\end{pmatrix}\n$$\n\n**步骤3：计算样本协方差矩阵**\n样本协方差矩阵 $C$ 由 $C = \\frac{1}{n-1} X_c^T X_c$ 给出，其中 $n=6$。\n$$\nC = \\frac{1}{5} \\begin{pmatrix} -2 & -1 & -2 & 2 & 2 & 1 \\\\ 2 & 2 & 1 & -2 & -1 & -2 \\end{pmatrix} \\begin{pmatrix}\n-2 & 2 \\\\\n-1 & 2 \\\\\n-2 & 1 \\\\\n2 & -2 \\\\\n2 & -1 \\\\\n1 & -2\n\\end{pmatrix}\n$$\n协方差矩阵的元素为：\n$C_{11} = \\frac{1}{5} ((-2)^2 + (-1)^2 + (-2)^2 + 2^2 + 2^2 + 1^2) = \\frac{1}{5}(4+1+4+4+4+1) = \\frac{18}{5} = 3.6$\n$C_{22} = \\frac{1}{5} (2^2 + 2^2 + 1^2 + (-2)^2 + (-1)^2 + (-2)^2) = \\frac{1}{5}(4+4+1+4+1+4) = \\frac{18}{5} = 3.6$\n$C_{12} = C_{21} = \\frac{1}{5} ((-2)(2) + (-1)(2) + (-2)(1) + (2)(-2) + (2)(-1) + (1)(-2)) = \\frac{1}{5}(-4-2-2-4-2-2) = \\frac{-16}{5} = -3.2$\n所以，协方差矩阵为：\n$$\nC = \\begin{pmatrix} 3.6 & -3.2 \\\\ -3.2 & 3.6 \\end{pmatrix}\n$$\n\n**步骤4：求解特征值和第一主成分 (PC1)**\n为了求特征值 $\\lambda$，我们求解特征方程 $\\det(C - \\lambda I) = 0$：\n$$\n(3.6 - \\lambda)(3.6 - \\lambda) - (-3.2)(-3.2) = 0\n$$\n$$\n(3.6 - \\lambda)^2 = (3.2)^2 = 10.24\n$$\n$$\n3.6 - \\lambda = \\pm 3.2\n$$\n两个特征值为 $\\lambda_1 = 3.6 + 3.2 = 6.8$ 和 $\\lambda_2 = 3.6 - 3.2 = 0.4$。\n第一主成分 (PC1) 是与最大特征值 $\\lambda_1=6.8$ 相关联的特征向量。设该特征向量为 $v_1 = (v_{11}, v_{12})^T$。\n$$\n(C - \\lambda_1 I)v_1 = 0 \\implies \\begin{pmatrix} 3.6-6.8 & -3.2 \\\\ -3.2 & 3.6-6.8 \\end{pmatrix} \\begin{pmatrix} v_{11} \\\\ v_{12} \\end{pmatrix} = \\begin{pmatrix} -3.2 & -3.2 \\\\ -3.2 & -3.2 \\end{pmatrix} \\begin{pmatrix} v_{11} \\\\ v_{12} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n这给出了方程 $-3.2 v_{11} - 3.2 v_{12} = 0$，可以简化为 $v_{11} = -v_{12}$。\n一个未归一化的特征向量是 $(1, -1)^T$。为了将其归一化，我们除以它的模 $\\sqrt{1^2 + (-1)^2} = \\sqrt{2}$。\n所以，第一主成分是 $w_1 = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n\n**步骤5：将中心化数据投影到PC1上**\n每个个体的PC1分数是通过将其中心化数据向量投影到 $w_1$ 上计算得出的：分数 $= X_c \\cdot w_1$。\n- 分数 H1: $(-2, 2) \\cdot \\frac{1}{\\sqrt{2}}(1, -1) = \\frac{1}{\\sqrt{2}}(-2 - 2) = -4/\\sqrt{2}$\n- 分数 H2: $(-1, 2) \\cdot \\frac{1}{\\sqrt{2}}(1, -1) = \\frac{1}{\\sqrt{2}}(-1 - 2) = -3/\\sqrt{2}$\n- 分数 H3: $(-2, 1) \\cdot \\frac{1}{\\sqrt{2}}(1, -1) = \\frac{1}{\\sqrt{2}}(-2 - 1) = -3/\\sqrt{2}$\n- 分数 D1: $(2, -2) \\cdot \\frac{1}{\\sqrt{2}}(1, -1) = \\frac{1}{\\sqrt{2}}(2 + 2) = 4/\\sqrt{2}$\n- 分数 D2: $(2, -1) \\cdot \\frac{1}{\\sqrt{2}}(1, -1) = \\frac{1}{\\sqrt{2}}(2 + 1) = 3/\\sqrt{2}$\n- 分数 D3: $(1, -2) \\cdot \\frac{1}{\\sqrt{2}}(1, -1) = \\frac{1}{\\sqrt{2}}(1 + 2) = 3/\\sqrt{2}$\n六个PC1分数的集合为：$\\{-4/\\sqrt{2}, -3/\\sqrt{2}, -3/\\sqrt{2}, 4/\\sqrt{2}, 3/\\sqrt{2}, 3/\\sqrt{2}\\}$。\n\n**步骤6：计算观测到的分离度量 $\\Delta_{obs}$**\n- 健康组（H1, H2, H3）的平均分数： $\\mu_H = \\frac{1}{3} (-4/\\sqrt{2} - 3/\\sqrt{2} - 3/\\sqrt{2}) = \\frac{-10}{3\\sqrt{2}}$\n- 患病组（D1, D2, D3）的平均分数： $\\mu_D = \\frac{1}{3} (4/\\sqrt{2} + 3/\\sqrt{2} + 3/\\sqrt{2}) = \\frac{10}{3\\sqrt{2}}$\n观测到的分离度量为 $\\Delta_{obs} = |\\mu_D - \\mu_H| = |\\frac{10}{3\\sqrt{2}} - (\\frac{-10}{3\\sqrt{2}})| = \\frac{20}{3\\sqrt{2}}$。\n\n**步骤7：执行置换检验**\n原假设是标签是随机分配的。我们需要找到使得分离度量 $\\Delta_{perm} \\ge \\Delta_{obs}$ 的标签置换所占的比例。将3个“D”标签分配给6个个体的总方式数为 $\\binom{6}{3} = \\frac{6 \\times 5 \\times 4}{3 \\times 2 \\times 1} = 20$。\n\nPC1分数是固定的；我们只置换它们的标签。让我们使用乘以 $\\sqrt{2}$ 简化后的分数：$S = \\{-4, -3, -3, 3, 3, 4\\}$。这些分数的总和为0。\n对于 $S$ 的任意一个划分为两个包含三个元素的组 $G_1$ 和 $G_2$，它们的和分别为 $S_1$ 和 $S_2 = -S_1$。\n这个划分的分离度量是 $\\Delta_{perm} = |\\frac{S_2/3}{\\sqrt{2}} - \\frac{S_1/3}{\\sqrt{2}}| = |\\frac{-S_1 - S_1}{3\\sqrt{2}}| = \\frac{2|S_1|}{3\\sqrt{2}}$。\n我们观测到的分离度量是 $\\Delta_{obs} = \\frac{20}{3\\sqrt{2}}$，这对应于 $|S_1| = 10$。\n\n我们需要找出在20种划分中，有多少种划分使得其中一组分数的和的绝对值 $|S_1| \\ge 10$。\n让我们列出从 $S = \\{-4, -3, -3, 3, 3, 4\\}$ 中选取三个分数的所有可能的和。\n我们想要找到3个元素的组合，其和 $\\le -10$ 或 $\\ge 10$。\n让我们分析一下极端情况：\n- 为了得到最小的和，我们选择三个最小的分数：$\\{-4, -3, -3\\}$。和为-10。这得出 $|S_1|=10$。这个组合对应于原始的标签分配。\n- 为了得到最大的和，我们选择三个最大的分数：$\\{3, 3, 4\\}$。和为10。这得出 $|S_1|=10$。这个组合是第一个组合的补集。\n\n任何其他三个分数的组合将导致和在-10和10之间。例如：\n- $\\{-4, -3, 3\\}$ 的和为-4，所以 $|S_1|=4 < 10$。\n- $\\{-3, -3, 4\\}$ 的和为-2，所以 $|S_1|=2 < 10$。\n\n因此，只有两种组合（标签的置换）导致的分离度量等于观测值：\n1. 第1组分数为 $\\{-4, -3, -3\\}$，第2组分数为 $\\{3, 3, 4\\}$。$|S_1|=10$。\n2. 第1组分数为 $\\{3, 3, 4\\}$，第2组分数为 $\\{-4, -3, -3\\}$。$|S_1|=10$。\n\n没有任何组合导致的分离度量严格大于观测值。\n产生 $\\Delta_{perm} \\ge \\Delta_{obs}$ 的标签分配数量为2。\n\n**步骤8：计算$p$-值**\n$p$-值是“成功”的置换数除以总置换数。\n$$\np = \\frac{\\text{满足 } |S_1| \\ge 10 \\text{ 的置换数}}{\\text{总置换数}} = \\frac{2}{20} = 0.1\n$$\n\n**步骤9：四舍五入最终答案**\n问题要求将答案四舍五入到三位有效数字。\n$p = 0.100$。", "answer": "$$\\boxed{0.100}$$", "id": "1428911"}]}