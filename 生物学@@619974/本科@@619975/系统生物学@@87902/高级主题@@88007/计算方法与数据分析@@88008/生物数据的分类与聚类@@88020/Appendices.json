{"hands_on_practices": [{"introduction": "层次聚类是系统生物学中用于发现数据内在结构的一种基本无监督学习方法，尤其在根据遗传相似性推断物种进化关系时非常有用。本练习将指导你手动执行凝聚式层次聚类的完整连锁法 (complete-linkage)，通过计算和比较距离，逐步构建一个树状图。这个实践能帮助你深入理解聚类算法的内部工作原理，并掌握从距离矩阵到系统发育树的转化过程 [@problem_id:1423409]。", "problem": "一组海洋生物学家正在研究一个新发现的深海热液喷口的微生物生态系统。他们分离出了五个前所未见的细菌物种，标记为 S1、S2、S3、S4 和 S5。为了解它们潜在的进化关系，他们进行了一项遗传分析，并根据其 16S 核糖体 RNA (rRNA) 基因序列的差异计算了一个距离矩阵。矩阵中较大的值表示两个物种之间的遗传差异更大。\n\n得到的距离矩阵如下：\n\n| | S1 | S2 | S3 | S4 | S5 |\n|:--|:--:|:--:|:--:|:--:|:--:|\n| **S1**| 0 | 0.20 | 0.50 | 0.60 | 0.70 |\n| **S2**| 0.20 | 0 | 0.40 | 0.55 | 0.65 |\n| **S3**| 0.50 | 0.40 | 0 | 0.10 | 0.30 |\n| **S4**| 0.60 | 0.55 | 0.10 | 0 | 0.25 |\n| **S5**| 0.70 | 0.65 | 0.30 | 0.25 | 0 |\n\n你的任务是通过执行层次聚类来确定这些物种之间的系统发育关系。具体来说，你必须使用**完全连接凝聚聚类 (complete-linkage agglomerative clustering)** 方法。\n\n所得关系将以树状图 (dendrogram) 的形式表示，它可以以 Newick 格式进行文本描述。在 Newick 格式中，一棵树由嵌套的括号表示。例如，字符串 `((A,B),C);` 表示物种 A 和 B 首先被聚类在一起，然后这个簇再与物种 C 组合。\n\n以下哪个 Newick 格式字符串正确表示了使用完全连接聚类从给定距离矩阵获得的树状图的拓扑结构？\n\nA. `((S1,S2),((S3,S4),S5));`\nB. `((((S3,S4),S5),S2),S1));`\nC. `(((S1,S2),S5),(S3,S4));`\nD. `((S1,S5),((S2,S3),S4));`\nE. `(((S3,S4),S2),(S1,S5));`", "solution": "在完全连接凝聚聚类中，两个簇 $A$ 和 $B$ 之间的距离定义为\n$$\nd_{\\text{complete}}(A,B)=\\max\\{d(i,j): i\\in A,\\ j\\in B\\}.\n$$\n从单元簇 $\\{S1\\},\\{S2\\},\\{S3\\},\\{S4\\},\\{S5\\}$ 和给定的成对距离开始。\n\n1) 识别单元簇中最近的一对。矩阵中最小的项是 $d(S3,S4)=0.10$，所以首先合并 $S3$ 和 $S4$，形成 $C_{34}=\\{S3,S4\\}$。\n\n使用完全连接规则计算 $C_{34}$ 到其余单元簇的距离：\n$$\nd(C_{34},S1)=\\max\\{d(S3,S1),d(S4,S1)\\}=\\max\\{0.50,0.60\\}=0.60,\n$$\n$$\nd(C_{34},S2)=\\max\\{d(S3,S2),d(S4,S2)\\}=\\max\\{0.40,0.55\\}=0.55,\n$$\n$$\nd(C_{34},S5)=\\max\\{d(S3,S5),d(S4,S5)\\}=\\max\\{0.30,0.25\\}=0.30.\n$$\n当前的簇间距离包括 $d(S1,S2)=0.20$， $d(S1,S5)=0.70$， $d(S2,S5)=0.65$，以及上面计算出的三个距离。\n\n2) 当前最小的距离是 $d(S1,S2)=0.20$，所以合并 $S1$ 和 $S2$，形成 $C_{12}=\\{S1,S2\\}$。\n\n计算 $C_{12}$、$C_{34}$ 和 $S5$ 之间的距离：\n$$\nd(C_{12},S5)=\\max\\{d(S1,S5),d(S2,S5)\\}=\\max\\{0.70,0.65\\}=0.70,\n$$\n$$\nd(C_{12},C_{34})=\\max\\{d(S1,S3),d(S1,S4),d(S2,S3),d(S2,S4)\\}\n=\\max\\{0.50,0.60,0.40,0.55\\}=0.60,\n$$\n并且根据之前的计算 $d(C_{34},S5)=0.30$。\n\n3) 当前最小的距离是 $d(C_{34},S5)=0.30$，所以合并形成 $C_{345}=\\{S3,S4,S5\\}$，其结构为 $((S3,S4),S5)$。\n\n4) 现在剩下两个簇：$C_{12}=\\{S1,S2\\}$ 和 $C_{345}=\\{S3,S4,S5\\}$。它们的完全连接距离是\n$$\nd(C_{12},C_{345})=\\max\\{d(S1,S3),d(S1,S4),d(S1,S5),d(S2,S3),d(S2,S4),d(S2,S5)\\}\n=\\max\\{0.50,0.60,0.70,0.40,0.55,0.65\\}=0.70.\n$$\n因此，最终的合并是在 $(S1,S2)$ 和 $((S3,S4),S5)$ 之间。\n\n最终的 Newick 格式拓扑结构是 $((S1,S2),((S3,S4),S5));$，这对应于选项 A。", "answer": "$$\\boxed{A}$$", "id": "1423409"}, {"introduction": "与探索未知分组的聚类不同，分类是一种监督学习技术，它根据已标记的训练数据构建模型，以预测新样本的类别。本练习将带你应用高斯朴素贝叶斯分类器——一种强大而直观的概率模型——来区分不同细胞周期阶段的细胞 [@problem_id:1423429]。你将学习如何利用基因表达数据计算后验概率，并构建一个混淆矩阵来量化分类器的性能，这是评估任何分类模型准确性的关键一步。", "problem": "一位系统生物学家正在开发一个模型，用于将单细胞分为三个不同的细胞周期阶段：阶段1（P1）、阶段2（P2）和阶段3（P3）。该分类基于两个关键调控基因（基因A和基因B）的归一化表达水平。\n\n为此任务选择了高斯朴素贝叶斯分类器。该模型假设在给定的细胞周期阶段，基因A和基因B的表达水平是条件独立的。它还假设每个基因在每个阶段内的表达水平遵循正态（高斯）分布。\n\n从一大组预先分类的细胞中，得出了以下训练数据的统计摘要：\n- 训练细胞总数为1000个。每个阶段的计数为：P1 中有400个细胞，P2 中有350个细胞，P3 中有250个细胞。\n- 每个基因在每个阶段的归一化表达水平的均值（$\\mu$）和标准差（$\\sigma$）在下表中给出。表达水平是无量纲的量。\n\n| 阶段 | 基因 A ($\\mu_A, \\sigma_A$) | 基因 B ($\\mu_B, \\sigma_B$) |\n|---|---|---|\n| P1 | (5.0, 1.0) | (4.0, 1.2) |\n| P2 | (8.0, 1.5) | (6.0, 1.0) |\n| P3 | (6.0, 1.2) | (9.0, 1.5) |\n\n为了评估分类器的性能，收集了一组新的包含6个已知真实阶段的测试细胞。它们的基因表达水平和真实阶段如下：\n\n| 细胞ID | 基因A表达量 | 基因B表达量 | 真实阶段 |\n|---|---|---|---|\n| S1 | 5.5 | 4.5 | P1 |\n| S2 | 7.5 | 5.8 | P2 |\n| S3 | 6.2 | 8.5 | P3 |\n| S4 | 4.8 | 6.5 | P1 |\n| S5 | 8.5 | 8.8 | P2 |\n| S6 | 7.0 | 7.0 | P3 |\n\n对于每个测试细胞，使用训练好的高斯朴素贝叶斯分类器确定其预测阶段。然后，构建分类器在此测试集上性能的混淆矩阵。混淆矩阵应该是一个3x3矩阵，其中行代表真实阶段（按P1、P2、P3的顺序），列代表预测阶段（按P1、P2、P3的顺序）。\n\n按行依次提供混淆矩阵的9个整数元素作为您的最终答案。也就是说，先提供 (真实P1, 预测P1) 的元素，然后是 (真实P1, 预测P2)、(真实P1, 预测P3)，接着是 (真实P2, 预测P1)，依此类推。", "solution": "我们使用高斯朴素贝叶斯分类器对类条件密度进行建模。设类别标签为 $c \\in \\{\\text{P1}, \\text{P2}, \\text{P3}\\}$，特征为基因A和基因B的表达量 $x = (x_{A}, x_{B})$。该模型假设在给定类别的情况下条件独立，并且每个基因服从单变量正态分布：\n$$\np(x \\mid c) \\;=\\; \\prod_{j \\in \\{A,B\\}} \\frac{1}{\\sigma_{c,j}\\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(x_{j}-\\mu_{c,j})^{2}}{2\\sigma_{c,j}^{2}}\\right).\n$$\n根据计数得出的类先验概率为\n$$\n\\pi_{\\text{P1}}=\\frac{400}{1000}=0.4,\\quad \\pi_{\\text{P2}}=\\frac{350}{1000}=0.35,\\quad \\pi_{\\text{P3}}=\\frac{250}{1000}=0.25.\n$$\n对于预测，我们比较（未归一化的）对数后验得分\n$$\ns_{c}(x) \\;=\\; \\ln \\pi_{c} \\;+\\; \\sum_{j \\in \\{A,B\\}} \\left[-\\ln \\sigma_{c,j} \\;-\\; \\frac{(x_{j}-\\mu_{c,j})^{2}}{2\\sigma_{c,j}^{2}} \\right] \\;-\\; \\sum_{j \\in \\{A,B\\}} \\ln \\sqrt{2\\pi}.\n$$\n最后一项 $-\\sum_{j} \\ln \\sqrt{2\\pi}$ 对于固定的 $x$ 在各个类别中是常数，因此在求 argmax 时可以省略。定义\n$$\n\\text{base}_{c} \\;=\\; \\ln \\pi_{c} \\;-\\; \\sum_{j \\in \\{A,B\\}} \\ln \\sigma_{c,j}, \\qquad Q_{c}(x) \\;=\\; \\sum_{j \\in \\{A,B\\}} \\frac{(x_{j}-\\mu_{c,j})^{2}}{2\\sigma_{c,j}^{2}},\n$$\n使得 $s_{c}(x)=\\text{base}_{c} - Q_{c}(x)$，其中忽略了一个与 $c$ 无关的加性常数。\n\n从表格中，参数如下：\n- P1： $(\\mu_{A},\\sigma_{A})=(5.0,1.0)$, $(\\mu_{B},\\sigma_{B})=(4.0,1.2)$,\n- P2： $(\\mu_{A},\\sigma_{A})=(8.0,1.5)$, $(\\mu_{B},\\sigma_{B})=(6.0,1.0)$,\n- P3： $(\\mu_{A},\\sigma_{A})=(6.0,1.2)$, $(\\mu_{B},\\sigma_{B})=(9.0,1.5)$。\n\n计算基础项：\n$$\n\\ln \\pi_{\\text{P1}} = \\ln(0.4) \\approx -0.916291,\\quad -\\sum \\ln \\sigma_{\\text{P1},j} = -\\ln 1.0 - \\ln 1.2 \\approx -0.182322,\\quad \\text{base}_{\\text{P1}} \\approx -1.098613,\n$$\n$$\n\\ln \\pi_{\\text{P2}} = \\ln(0.35) \\approx -1.049822,\\quad -\\sum \\ln \\sigma_{\\text{P2},j} = -\\ln 1.5 - \\ln 1.0 \\approx -0.405465,\\quad \\text{base}_{\\text{P2}} \\approx -1.455287,\n$$\n$$\n\\ln \\pi_{\\text{P3}} = \\ln(0.25) \\approx -1.386294,\\quad -\\sum \\ln \\sigma_{\\text{P3},j} = -\\ln 1.2 - \\ln 1.5 \\approx -0.587787,\\quad \\text{base}_{\\text{P3}} \\approx -1.974081.\n$$\n\n对于每个测试细胞 $x=(x_{A},x_{B})$，计算 $Q_{c}(x)=\\sum_{j} \\frac{(x_{j}-\\mu_{c,j})^{2}}{2\\sigma_{c,j}^{2}}$，然后计算 $s_{c}(x)=\\text{base}_{c}-Q_{c}(x)$；预测具有最大 $s_{c}(x)$ 值的类别。\n\nS1：$(5.5,4.5)$。\n- P1：偏差 $(0.5,0.5)$，方差 $(1.0,1.44)$，\n$$\nQ_{\\text{P1}} = \\frac{0.5^{2}}{2\\cdot 1.0} + \\frac{0.5^{2}}{2\\cdot 1.44} = 0.125 + 0.086806 \\approx 0.211806,\\quad s_{\\text{P1}} \\approx -1.098613 - 0.211806 = -1.310419.\n$$\n- P2：偏差 $(-2.5,-1.5)$，方差 $(2.25,1.0)$，\n$$\nQ_{\\text{P2}} = \\frac{2.5^{2}}{2\\cdot 2.25} + \\frac{1.5^{2}}{2\\cdot 1.0} = 1.388889 + 1.125 = 2.513889,\\quad s_{\\text{P2}} \\approx -1.455287 - 2.513889 = -3.969176.\n$$\n- P3：偏差 $(-0.5,-4.5)$，方差 $(1.44,2.25)$，\n$$\nQ_{\\text{P3}} = \\frac{0.5^{2}}{2\\cdot 1.44} + \\frac{4.5^{2}}{2\\cdot 2.25} = 0.086806 + 4.5 = 4.586806,\\quad s_{\\text{P3}} \\approx -1.974081 - 4.586806 = -6.560887.\n$$\n预测：P1。\n\nS2：$(7.5,5.8)$。\n- P1：偏差 $(2.5,1.8)$，方差 $(1.0,1.44)$，\n$$\nQ_{\\text{P1}} = \\frac{2.5^{2}}{2\\cdot 1.0} + \\frac{1.8^{2}}{2\\cdot 1.44} = 3.125 + 1.125 = 4.25,\\quad s_{\\text{P1}} \\approx -1.098613 - 4.25 = -5.348613.\n$$\n- P2：偏差 $(-0.5,-0.2)$，方差 $(2.25,1.0)$，\n$$\nQ_{\\text{P2}} = \\frac{0.5^{2}}{2\\cdot 2.25} + \\frac{0.2^{2}}{2\\cdot 1.0} = 0.055556 + 0.02 = 0.075556,\\quad s_{\\text{P2}} \\approx -1.455287 - 0.075556 = -1.530843.\n$$\n- P3：偏差 $(1.5,-3.2)$，方差 $(1.44,2.25)$，\n$$\nQ_{\\text{P3}} = \\frac{1.5^{2}}{2\\cdot 1.44} + \\frac{3.2^{2}}{2\\cdot 2.25} = 0.78125 + 2.275556 = 3.056806,\\quad s_{\\text{P3}} \\approx -1.974081 - 3.056806 = -5.030887.\n$$\n预测：P2。\n\nS3：$(6.2,8.5)$。\n- P1：偏差 $(1.2,4.5)$，方差 $(1.0,1.44)$，\n$$\nQ_{\\text{P1}} = \\frac{1.2^{2}}{2\\cdot 1.0} + \\frac{4.5^{2}}{2\\cdot 1.44} = 0.72 + 7.03125 = 7.75125,\\quad s_{\\text{P1}} \\approx -1.098613 - 7.75125 = -8.849863.\n$$\n- P2：偏差 $(-1.8,2.5)$，方差 $(2.25,1.0)$，\n$$\nQ_{\\text{P2}} = \\frac{1.8^{2}}{2\\cdot 2.25} + \\frac{2.5^{2}}{2\\cdot 1.0} = 0.72 + 3.125 = 3.845,\\quad s_{\\text{P2}} \\approx -1.455287 - 3.845 = -5.300287.\n$$\n- P3：偏差 $(0.2,-0.5)$，方差 $(1.44,2.25)$，\n$$\nQ_{\\text{P3}} = \\frac{0.2^{2}}{2\\cdot 1.44} + \\frac{0.5^{2}}{2\\cdot 2.25} = 0.013889 + 0.055556 = 0.0694449,\\quad s_{\\text{P3}} \\approx -1.974081 - 0.0694449 = -2.043526.\n$$\n预测：P3。\n\nS4：$(4.8,6.5)$。\n- P1：偏差 $(-0.2,2.5)$，方差 $(1.0,1.44)$，\n$$\nQ_{\\text{P1}} = \\frac{0.2^{2}}{2\\cdot 1.0} + \\frac{2.5^{2}}{2\\cdot 1.44} = 0.02 + 2.170139 = 2.190139,\\quad s_{\\text{P1}} \\approx -1.098613 - 2.190139 = -3.288752.\n$$\n- P2：偏差 $(-3.2,0.5)$，方差 $(2.25,1.0)$，\n$$\nQ_{\\text{P2}} = \\frac{3.2^{2}}{2\\cdot 2.25} + \\frac{0.5^{2}}{2\\cdot 1.0} = 2.275556 + 0.125 = 2.400556,\\quad s_{\\text{P2}} \\approx -1.455287 - 2.400556 = -3.855843.\n$$\n- P3：偏差 $(-1.2,-2.5)$，方差 $(1.44,2.25)$，\n$$\nQ_{\\text{P3}} = \\frac{1.2^{2}}{2\\cdot 1.44} + \\frac{2.5^{2}}{2\\cdot 2.25} = 0.5 + 1.388889 = 1.888889,\\quad s_{\\text{P3}} \\approx -1.974081 - 1.888889 = -3.862970.\n$$\n预测：P1。\n\nS5：$(8.5,8.8)$。\n- P1：偏差 $(3.5,4.8)$，方差 $(1.0,1.44)$，\n$$\nQ_{\\text{P1}} = \\frac{3.5^{2}}{2\\cdot 1.0} + \\frac{4.8^{2}}{2\\cdot 1.44} = 6.125 + 8 = 14.125,\\quad s_{\\text{P1}} \\approx -1.098613 - 14.125 = -15.223613.\n$$\n- P2：偏差 $(0.5,2.8)$，方差 $(2.25,1.0)$，\n$$\nQ_{\\text{P2}} = \\frac{0.5^{2}}{2\\cdot 2.25} + \\frac{2.8^{2}}{2\\cdot 1.0} = 0.055556 + 3.92 = 3.975556,\\quad s_{\\text{P2}} \\approx -1.455287 - 3.975556 = -5.430843.\n$$\n- P3：偏差 $(2.5,-0.2)$，方差 $(1.44,2.25)$，\n$$\nQ_{\\text{P3}} = \\frac{2.5^{2}}{2\\cdot 1.44} + \\frac{0.2^{2}}{2\\cdot 2.25} = 2.170139 + 0.008889 = 2.179028,\\quad s_{\\text{P3}} \\approx -1.974081 - 2.179028 = -4.153109.\n$$\n预测：P3。\n\nS6：$(7.0,7.0)$。\n- P1：偏差 $(2.0,3.0)$，方差 $(1.0,1.44)$，\n$$\nQ_{\\text{P1}} = \\frac{2.0^{2}}{2\\cdot 1.0} + \\frac{3.0^{2}}{2\\cdot 1.44} = 2 + 3.125 = 5.125,\\quad s_{\\text{P1}} \\approx -1.098613 - 5.125 = -6.223613.\n$$\n- P2：偏差 $(-1.0,1.0)$，方差 $(2.25,1.0)$，\n$$\nQ_{\\text{P2}} = \\frac{1.0^{2}}{2\\cdot 2.25} + \\frac{1.0^{2}}{2\\cdot 1.0} = 0.222222 + 0.5 = 0.722222,\\quad s_{\\text{P2}} \\approx -1.455287 - 0.722222 = -2.177509.\n$$\n- P3：偏差 $(1.0,-2.0)$，方差 $(1.44,2.25)$，\n$$\nQ_{\\text{P3}} = \\frac{1.0^{2}}{2\\cdot 1.44} + \\frac{2.0^{2}}{2\\cdot 2.25} = 0.347222 + 0.888889 = 1.236111,\\quad s_{\\text{P3}} \\approx -1.974081 - 1.236111 = -3.210192.\n$$\n预测：P2。\n\n预测标签：\n- S1: P1；S4: P1（真实阶段均为P1），\n- S2: P2；S5: P3（真实阶段为P2，一个正确，一个被错误分类为P3），\n- S3: P3；S6: P2（真实阶段为P3，一个正确，一个被错误分类为P2）。\n\n构建混淆矩阵，行代表真实阶段（P1, P2, P3），列代表预测阶段（P1, P2, P3）。计数：\n- 真实P1：预测为P1两次，P2零次，P3零次 → $(2,0,0)$。\n- 真实P2：预测为P1零次，P2一次，P3一次 → $(0,1,1)$。\n- 真实P3：预测为P1零次，P2一次，P3一次 → $(0,1,1)$。\n\n按行依次列出，这9个元素是 $2, 0, 0, 0, 1, 1, 0, 1, 1$。", "answer": "$$\\boxed{\\begin{pmatrix} 2 & 0 & 0 \\\\ 0 & 1 & 1 \\\\ 0 & 1 & 1 \\end{pmatrix}}$$", "id": "1423429"}, {"introduction": "在生物数据分析中，算法的选择固然重要，但数据预处理方法的选择同样至关重要，甚至更能决定分析的成败。本练习通过一个基因表达的案例，让你探索不同的数据归一化方案如何影响层次聚类的最终结果 [@problem_id:1423433]。你将亲手计算并比较在原始数据、基因水平标准化和样本水平标准化下，聚类分析是揭示了预期的生物学分组，还是受到了技术性批次效应的干扰，从而深刻理解数据预处理在生物信息学分析中的关键作用。", "problem": "一位分析师正在研究一个小型基因表达数据集，该数据集来自一项旨在测试某种药物效果的实验。实验包含四个样本：来自批次 A 的对照样本 (S1)，来自批次 B 的对照样本 (S2)，来自批次 A 的处理样本 (S3)，以及来自批次 B 的处理样本 (S4)。因此，预期的“生物”分组是 `{S1, S2}` (对照组) 对比 `{S3, S4}` (处理组)，而一个潜在的“批次效应”分组是 `{S1, S3}` (批次 A) 对比 `{S2, S4}` (批次 B)。\n\n两个基因 G1 和 G2 的原始表达数据如下表所示：\n\n| 基因 | S1 | S2 | S3 | S4 |\n|:----:|:--:|:--:|:--:|:--:|\n|  G1  | 1  | 6  | 4  | 9  |\n|  G2  | 4  | 9  | 1  | 6  |\n\n该分析师希望比较不同的数据归一化策略如何影响层次聚类的结果。聚类将使用欧几里得距离作为度量标准和平均连锁法（也称为非加权配对算术平均法，UPGMA）进行。分析师考虑了三种情况：\n1.  **原始数据**：不应用归一化。\n2.  **M1 归一化**：每个基因的表达值分别使用 Z-score 标准化进行转换（即，对每个基因，减去该基因在所有样本中的均值，然后除以其标准差）。\n3.  **M2 归一化**：每个样本的表达值分别使用 Z-score 标准化进行转换（即，对每个样本，减去该样本在所有基因中的均值，然后除以其标准差）。\n\n在此背景下，一组值 $\\{x_1, ..., x_N\\}$（均值为 $\\mu$）的标准差计算公式为 $\\sigma = \\sqrt{\\frac{1}{N}\\sum_{i=1}^{N}(x_i - \\mu)^2}$。\n\n层次聚类的最终结果可以表示为将样本划分为两个不同的组，这对应于在最高层级切割树状图。我们将生物学分组表示为 $P_{bio} = \\{\\{S1, S2\\}, \\{S3, S4\\}\\}$，批次分组表示为 $P_{batch} = \\{\\{S1, S3\\}, \\{S2, S4\\}\\}$。\n\n以下哪个选项正确地指出了（原始数据、M1归一化数据、M2归一化数据）对应的两聚类分组结果？\n\nA. ($P_{batch}$, $P_{batch}$, $P_{bio}$)\nB. ($P_{batch}$, $P_{bio}$, $P_{bio}$)\nC. ($P_{bio}$, $P_{bio}$, $P_{bio}$)\nD. ($P_{batch}$, $P_{batch}$, $P_{batch}$)\nE. ($P_{bio}$, $P_{batch}$, $P_{bio}$)", "solution": "我们将每个样本表示为一个二维向量，其坐标由两个基因的表达值给出。样本 $x,y \\in \\mathbb{R}^{2}$ 之间的欧几里得距离是\n$$\nd(x,y)=\\sqrt{(x_{1}-y_{1})^{2}+(x_{2}-y_{2})^{2}}.\n$$\n两个簇 $A$ 和 $B$ 之间的平均连锁 (UPGMA) 距离是\n$$\nD(A,B)=\\frac{1}{|A||B|}\\sum_{x\\in A}\\sum_{y\\in B}d(x,y).\n$$\n在最高层级切割树状图会得到一个包含两个簇的划分。\n\n原始数据。样本向量为 $S1=(1,4)$, $S2=(6,9)$, $S3=(4,1)$, $S4=(9,6)$。计算所有成对距离：\n$$\n\\begin{aligned}\n&d(S1,S3)=\\sqrt{(1-4)^{2}+(4-1)^{2}}=\\sqrt{18}=3\\sqrt{2},\\\\\n&d(S2,S4)=\\sqrt{(6-9)^{2}+(9-6)^{2}}=\\sqrt{18}=3\\sqrt{2},\\\\\n&d(S1,S2)=\\sqrt{(1-6)^{2}+(4-9)^{2}}=\\sqrt{50}=5\\sqrt{2},\\\\\n&d(S3,S4)=\\sqrt{(4-9)^{2}+(1-6)^{2}}=\\sqrt{50}=5\\sqrt{2},\\\\\n&d(S1,S4)=\\sqrt{(1-9)^{2}+(4-6)^{2}}=\\sqrt{68}=2\\sqrt{17},\\\\\n&d(S2,S3)=\\sqrt{(6-4)^{2}+(9-1)^{2}}=\\sqrt{68}=2\\sqrt{17}.\n\\end{aligned}\n$$\n最小的距离是 $d(S1,S3)=d(S2,S4)=3\\sqrt{2}$，所以首先合并的是批次对。假设我们合并 $A=\\{S1,S3\\}$。与单个样本的平均连锁距离为\n$$\nD(A,S2)=\\frac{d(S1,S2)+d(S3,S2)}{2}=\\frac{5\\sqrt{2}+2\\sqrt{17}}{2},\\quad\nD(A,S4)=\\frac{d(S1,S4)+d(S3,S4)}{2}=\\frac{2\\sqrt{17}+5\\sqrt{2}}{2}.\n$$\n由于 $d(S2,S4)=3\\sqrt{2}$ 小于 $D(A,S2)$ 和 $D(A,S4)$，下一个合并是 $\\{S2,S4\\}$。最终得到的两个簇是 $\\{S1,S3\\}$ 和 $\\{S2,S4\\}$，即 $P_{batch}$。\n\nM1 归一化（按基因进行 Z-score）。对于每个基因 $g$，其表达值为 $x_{g}=\\{x_{g,S1},x_{g,S2},x_{g,S3},x_{g,S4}\\}$，计算\n$$\n\\mu_{g}=\\frac{1}{4}\\sum_{j=1}^{4}x_{g,Sj},\\qquad \\sigma_{g}=\\sqrt{\\frac{1}{4}\\sum_{j=1}^{4}\\left(x_{g,Sj}-\\mu_{g}\\right)^{2}}.\n$$\n对于 G1，$(1,6,4,9)$ 得出 $\\mu_{1}=5$ 和 $\\sigma_{1}=\\sqrt{(16+1+1+16)/4}=\\sqrt{17/2}$。对于 G2，$(4,9,1,6)$ 得出 $\\mu_{2}=5$ 和 $\\sigma_{2}=\\sqrt{17/2}$。因此，变换为\n$$\nx\\mapsto \\left(\\frac{x_{1}-5}{\\sqrt{17/2}},\\frac{x_{2}-5}{\\sqrt{17/2}}\\right),\n$$\n这是一个由 $(5,5)$ 完成的平移（这不改变成对欧几里得距离），随后是一个正因子 $1/\\sqrt{17/2}$ 的各向同性缩放（这将所有距离乘以同一个常数）。因此，所有样本间距离的相对顺序，以及所有平均连锁簇间距离的相对顺序，都得以保持。树状图与原始数据的树状图相同，两聚类分组结果同样是 $P_{batch}$。\n\nM2 归一化（按样本进行 Z-score）。对于每个样本 $Sj$，其向量为 $(a,b)$，计算\n$$\n\\mu=\\frac{a+b}{2},\\qquad \\sigma=\\sqrt{\\frac{1}{2}\\left((a-\\mu)^{2}+(b-\\mu)^{2}\\right)}.\n$$\n由于 $a-\\mu=\\frac{a-b}{2}$ 且 $b-\\mu=-\\frac{a-b}{2}$，我们得到\n$$\n\\sigma=\\sqrt{\\frac{1}{2}\\left(\\frac{(a-b)^{2}}{4}+\\frac{(a-b)^{2}}{4}\\right)}=\\sqrt{\\frac{(a-b)^{2}}{4}}=\\frac{|a-b|}{2},\n$$\nZ-score 分数为\n$$\nz_{a}=\\frac{a-\\mu}{\\sigma}=\\frac{(a-b)/2}{|a-b|/2}=\\operatorname{sign}(a-b),\\quad\nz_{b}=\\frac{b-\\mu}{\\sigma}=-\\operatorname{sign}(a-b).\n$$\n将此应用于样本：\n$$\nS1:(1,4)\\mapsto(-1,1),\\quad S2:(6,9)\\mapsto(-1,1),\\quad S3:(4,1)\\mapsto(1,-1),\\quad S4:(9,6)\\mapsto(1,-1).\n$$\n成对距离为 $d(S1,S2)=0$，$d(S3,S4)=0$，以及 $d(S1,S3)=d(S1,S4)=d(S2,S3)=d(S2,S4)=\\sqrt{(2)^{2}+(-2)^{2}}=2\\sqrt{2}$。最小的距离是生物学配对内部的零距离，所以首先合并的是 $\\{S1,S2\\}$ 和 $\\{S3,S4\\}$。使用平均连锁法，这些零距离的合并会先于任何跨组合并（其距离为 $2\\sqrt{2}$）发生。在两个簇的层级切割树状图，得到 $\\{S1,S2\\}$ 和 $\\{S3,S4\\}$，即 $P_{bio}$。\n\n因此，最终的分组结果是 $(P_{batch}, P_{batch}, P_{bio})$，这对应于选项 A。", "answer": "$$\\boxed{A}$$", "id": "1423433"}]}