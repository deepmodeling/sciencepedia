{"hands_on_practices": [{"introduction": "在处理批次效应时，最有效的策略是“防患于未然”。一个精心设计的实验可以从源头上最小化批次效应与我们关心的生物学信号（例如，处理组与对照组的差异）之间的混淆。本练习将挑战你作为一名实验科学家的思维，通过构建一个“平衡”的设计，确保技术变异不会掩盖真实的生物学发现。[@problem_id:1418479]", "problem": "一个系统生物学研究小组正在进行一项蛋白质组学研究，以识别癌变组织和健康组织之间的蛋白质表达差异。他们收集了20个肿瘤样本(T)和20个健康对照样本(C)。分析将使用质谱仪进行，样本被加载到24孔板上进行处理。由于总共有40个样本，实验必须分两个独立的批次进行，使用两个24孔板（板1和板2）。\n\n已知不同批次之间可能会出现非生物性的系统性变异（例如，由于不同天仪器校准或试剂制备的微小差异）。这被称为“批次效应”。如果无法将我们感兴趣的生物学效应（癌变与健康）与技术性的批次效应区分开来，那么该实验设计就是“混杂”的。\n\n为了最大限度地减少处理效应（T vs. C）和批次效应（板1 vs. 板2）之间的混杂，以下哪种将40个样本分配到两个24孔板的实验设计是最佳的？\n\nA. 将所有20个肿瘤样本(T)放在板1上，所有20个健康对照样本(C)放在板2上。\n\nB. 将40个样本完全随机地分配到两个板上48个可用孔中，随机留下8个空孔。\n\nC. 将10个肿瘤样本(T)和10个健康对照样本(C)放在板1上。将其余的10个肿瘤样本(T)和10个健康对照样本(C)放在板2上。每个板上留下4个空孔。\n\nD. 用12个肿瘤样本(T)和12个健康对照样本(C)完全填满板1。将其余8个肿瘤样本(T)和8个健康对照样本(C)放在板2上。", "solution": "我们使用线性模型和设计列的正交性，来形式化生物学处理（肿瘤与对照）和技术批次（板1与板2）之间的混杂概念。\n\n设有 $N=40$ 个样本。对于样本 $i$ 定义，\n- 处理指标 $x_{i}=1$（如果为肿瘤样本T），$x_{i}=0$（如果为对照样本C），\n- 批次指标 $z_{i}=1$（如果在板1上），$z_{i}=0$（如果在板2上）。\n\n在线性模型 $y_{i}=\\mu+\\tau x_{i}+\\beta z_{i}+\\epsilon_{i}$ 中，如果 $x$ 和 $z$ 的设计列不是正交的，则处理与批次之间存在混杂。一个实用的诊断方法是计算 $x$ 和 $z$ 之间的样本协方差：\n$$\n\\operatorname{Cov}(x,z)\\ \\propto\\ \\bar{xz}-\\bar{x}\\,\\bar{z},\n$$\n其中 $\\bar{x}$、$\\bar{z}$ 和 $\\bar{xz}$ 分别是 $x$、$z$ 和 $xz$ 的样本均值。没有混杂对应于 $\\bar{xz}=\\bar{x}\\,\\bar{z}$，即设计中处理和批次的正交性。用计数表示，令 $n$ 表示总样本数，$n_{1}$ 表示板1上的样本数，$t_{1}$ 表示板1上的肿瘤样本数，我们有\n$$\n\\bar{x}=\\frac{20}{40}=\\frac{1}{2},\\quad \\bar{z}=\\frac{n_{1}}{40},\\quad \\bar{xz}=\\frac{t_{1}}{40}.\n$$\n因此，正交性等价于\n$$\n\\frac{t_{1}}{40}=\\frac{1}{2}\\cdot\\frac{n_{1}}{40}\\quad\\Longleftrightarrow\\quad t_{1}=\\frac{n_{1}}{2},\n$$\n这意味着每个板上的肿瘤和对照样本的比例应与整个研究的比例相同，即一半肿瘤，一半对照。\n\n我们现在评估每个选项。\n\nA. 所有肿瘤样本在板1上，所有对照样本在板2上。这里 $n_{1}=20$，$t_{1}=20$，所以\n$$\n\\bar{xz}=\\frac{20}{40}=\\frac{1}{2},\\quad \\bar{x}\\bar{z}=\\frac{1}{2}\\cdot\\frac{20}{40}=\\frac{1}{4},\n$$\n因此 $\\bar{xz}-\\bar{x}\\bar{z}\\neq 0$。这是完全混杂。\n\nB. 在48个孔中完全随机化，随机留下8个空孔。虽然每个板上肿瘤样本的期望比例等于总体比例，但随机化不能保证在实际分配中 $t_{1}=n_{1}/2$。因此 $\\bar{xz}-\\bar{x}\\bar{z}$ 未必为零，混杂可能会偶然发生。当存在确定性的均衡分配方案时，这不是最优的。\n\nC. 将10个肿瘤样本和10个对照样本放在板1上，10个肿瘤样本和10个对照样本放在板2上，每个板留下4个空孔。这里 $n_{1}=20$，$t_{1}=10$，所以\n$$\n\\bar{xz}=\\frac{10}{40}=\\frac{1}{4},\\quad \\bar{x}\\bar{z}=\\frac{1}{2}\\cdot\\frac{20}{40}=\\frac{1}{4},\n$$\n因此 $\\bar{xz}-\\bar{x}\\bar{z}=0$。处理和批次是正交的，所以没有混杂。此外，批次大小相等，这提高了校正后处理效应估计的精度。\n\nD. 用12个肿瘤样本和12个对照样本填满板1，并将8个肿瘤样本和8个对照样本放在板2上。这里 $n_{1}=24$，$t_{1}=12$，所以\n$$\n\\bar{xz}=\\frac{12}{40}=\\frac{3}{10},\\quad \\bar{x}\\bar{z}=\\frac{1}{2}\\cdot\\frac{24}{40}=\\frac{3}{10},\n$$\n因此 $\\bar{xz}-\\bar{x}\\bar{z}=0$。处理和批次也是正交的，所以没有混杂。但是，在估计经批次校正的处理效应时，与每批数量相等的设计相比，不相等的批次大小降低了效率。\n\n在所提供的选项中，C和D都通过确保每个板内肿瘤与对照的比例相等来消除混杂。在这两者之间，C是最佳的，因为它还平衡了每个板上的总样本数，这在保持零混杂的同时，能产生更高效的估计，并防范与处理无关的板级差异。", "answer": "$$\\boxed{C}$$", "id": "1418479"}, {"introduction": "尽管优秀的实验设计是首选，但在实际研究中有时我们仍然会遇到必须在数据分析阶段处理的批次效应。本练习提供了一个具体的小规模数据集，让你亲手实践一种基础的批次校正方法——均值中心化。通过这个计算过程，你将直观地理解校正算法如何通过数学变换来“对齐”不同批次的数据，从而揭示其背后的核心原理。[@problem_id:1418467]", "problem": "在一项旨在分析癌细胞对新药的转录响应的系统生物学实验中，一名研究人员收集了基因表达数据。由于后勤限制，该实验分两个独立的批次进行。数据采集后，研究人员怀疑存在显著的批次效应，即两次运行之间测量平台的校准有所不同。\n\n下表是两个基因 G1 和 G2 在六个细胞样本中的原始、无单位的基因表达值。样本 S1、S2 和 S3 属于批次1，而样本 S4、S5 和 S6 属于批次2。\n\n| | S1 | S2 | S3 | S4 | S5 | S6 |\n| :---- | :- | :- | :- | :- | :- | :- |\n| **G1**| 5 | 7 | 9 | 12 | 15 | 18 |\n| **G2**| 22 | 30 | 26 | 35 | 41 | 38 |\n\n为校正批次效应，研究人员决定应用逐基因均值调整。这种校正方法对每个基因的数据进行单独调整，使得校正后，每个批次内的平均表达值等于该基因在所有样本中的总体平均表达值。\n\n计算完整的校正后数据矩阵，基因作为行，样本作为列。以 2x6 矩阵的形式呈现你的最终答案。", "solution": "目标是调整每个基因的表达数据，使每个批次内的数值均值等于该基因在所有样本中的总体均值。我们将独立地对每个基因 G1 和 G2 进行此项校正。\n\n设 $x_{g,s}$ 为基因 $g$ 在样本 $s$ 中的表达值。对于批次 $b$ 中的样本，其调整后的值 $x'_{g,s}$ 由以下公式给出：\n$$x'_{g,s} = x_{g,s} + (\\text{Mean}_{g,\\text{overall}} - \\text{Mean}_{g,b})$$\n其中 $\\text{Mean}_{g,b}$ 是基因 $g$ 在批次 $b$ 中的平均表达，而 $\\text{Mean}_{g,\\text{overall}}$ 是基因 $g$ 在所有样本中的平均表达。\n\n**步骤1：对基因 G1 进行校正**\n\n首先，我们计算基因 G1 所需的均值。\nG1 在批次1中的样本为 {5, 7, 9}。批次1的均值为：\n$$ \\text{Mean}_{\\text{G1, Batch 1}} = \\frac{5 + 7 + 9}{3} = \\frac{21}{3} = 7 $$\nG1 在批次2中的样本为 {12, 15, 18}。批次2的均值为：\n$$ \\text{Mean}_{\\text{G1, Batch 2}} = \\frac{12 + 15 + 18}{3} = \\frac{45}{3} = 15 $$\nG1 在所有六个样本中的总体均值为：\n$$ \\text{Mean}_{\\text{G1, overall}} = \\frac{5 + 7 + 9 + 12 + 15 + 18}{6} = \\frac{66}{6} = 11 $$\n现在，我们计算每个批次的调整因子。\n对于批次1，调整因子为：\n$$ \\Delta_1 = \\text{Mean}_{\\text{G1, overall}} - \\text{Mean}_{\\text{G1, Batch 1}} = 11 - 7 = +4 $$\n对于批次2，调整因子为：\n$$ \\Delta_2 = \\text{Mean}_{\\text{G1, overall}} - \\text{Mean}_{\\text{G1, Batch 2}} = 11 - 15 = -4 $$\n我们将这些调整应用于原始的 G1 数据。\n对于批次1 (S1, S2, S3)：\n$$ x'_{\\text{G1,S1}} = 5 + 4 = 9 $$\n$$ x'_{\\text{G1,S2}} = 7 + 4 = 11 $$\n$$ x'_{\\text{G1,S3}} = 9 + 4 = 13 $$\n对于批次2 (S4, S5, S6)：\n$$ x'_{\\text{G1,S4}} = 12 - 4 = 8 $$\n$$ x'_{\\text{G1,S5}} = 15 - 4 = 11 $$\n$$ x'_{\\text{G1,S6}} = 18 - 4 = 14 $$\nG1 校正后的表达行为 [9, 11, 13, 8, 11, 14]。\n\n**步骤2：对基因 G2 进行校正**\n\n接下来，我们对基因 G2 重复此过程。\nG2 在批次1中的样本为 {22, 30, 26}。批次1的均值为：\n$$ \\text{Mean}_{\\text{G2, Batch 1}} = \\frac{22 + 30 + 26}{3} = \\frac{78}{3} = 26 $$\nG2 在批次2中的样本为 {35, 41, 38}。批次2的均值为：\n$$ \\text{Mean}_{\\text{G2, Batch 2}} = \\frac{35 + 41 + 38}{3} = \\frac{114}{3} = 38 $$\nG2 在所有六个样本中的总体均值为：\n$$ \\text{Mean}_{\\text{G2, overall}} = \\frac{22 + 30 + 26 + 35 + 41 + 38}{6} = \\frac{192}{6} = 32 $$\n现在，我们计算 G2 的每个批次的调整因子。\n对于批次1，调整因子为：\n$$ \\Delta_1 = \\text{Mean}_{\\text{G2, overall}} - \\text{Mean}_{\\text{G2, Batch 1}} = 32 - 26 = +6 $$\n对于批次2，调整因子为：\n$$ \\Delta_2 = \\text{Mean}_{\\text{G2, overall}} - \\text{Mean}_{\\text{G2, Batch 2}} = 32 - 38 = -6 $$\n我们将这些调整应用于原始的 G2 数据。\n对于批次1 (S1, S2, S3)：\n$$ x'_{\\text{G2,S1}} = 22 + 6 = 28 $$\n$$ x'_{\\text{G2,S2}} = 30 + 6 = 36 $$\n$$ x'_{\\text{G2,S3}} = 26 + 6 = 32 $$\n对于批次2 (S4, S5, S6)：\n$$ x'_{\\text{G2,S4}} = 35 - 6 = 29 $$\n$$ x'_{\\text{G2,S5}} = 41 - 6 = 35 $$\n$$ x'_{\\text{G2,S6}} = 38 - 6 = 32 $$\nG2 校正后的表达行为 [28, 36, 32, 29, 35, 32]。\n\n**步骤3：组装最终矩阵**\n\n我们现在按要求将 G1 和 G2 的校正行组装成一个最终的 2x6 矩阵。第一行对应 G1，第二行对应 G2。\n$$\n\\text{校正后矩阵} = \\begin{pmatrix}\n9 & 11 & 13 & 8 & 11 & 14 \\\\\n28 & 36 & 32 & 29 & 35 & 32\n\\end{pmatrix}\n$$", "answer": "$$\\boxed{\\begin{pmatrix} 9 & 11 & 13 & 8 & 11 & 14 \\\\ 28 & 36 & 32 & 29 & 35 & 32 \\end{pmatrix}}$$", "id": "1418467"}, {"introduction": "批次校正算法是一把双刃剑：它们在去除不必要的技术噪音方面功能强大，但也存在过度校正、甚至抹去真实生物学信号的风险。因此，校正后的验证步骤至关重要。本练习将引导你思考如何利用已知的生物学知识，例如看家基因（housekeeping genes）和已知的生物标志物（biomarkers），来对校正结果进行可视化检查，以确保技术偏差已被移除，而关键的生物学差异得以保留。[@problem_id:1418485]", "problem": "一位系统生物学研究者正在进行一项转录组学研究，以比较一组患者的肿瘤样本与邻近健康组织样本之间的基因表达谱。由于样本数量庞大，核糖核酸（RNA）的提取和测序分两个独立的实验批次进行。研究者怀疑这引入了“批次效应”——一种混淆数据的、系统性的、非生物学差异。\n\n为了解决这个问题，研究者对基因表达数据应用了一种计算批次校正算法。然而，有人担心该算法可能过于激进，不仅可能移除了不需要的技术性差异，还可能移除了肿瘤与健康组织之间真实的生物学差异。研究者希望进行一次简单的、非统计性的可视化检查，以确保有意义的生物学信号在校正后得以保留。\n\n为此，研究者从先前的文献中确定了两组基因：\n1.  **看家基因（Housekeeping Genes）**：一组已知在大多数细胞类型和条件下（包括肿瘤和健康组织）表达水平稳定的基因。\n2.  **已知癌症生物标志物（Known Cancer Biomarkers）**：一组已知在这种特定类型的肿瘤和健康组织之间存在显著差异表达的基因。\n\n以下哪种方法是确认批次校正过程中保留了目标生物学信号的最合适的可视化检查？\n\nA. 为所有样本生成所有基因的热图，并目视检查两个批次是否形成明显的聚类。如果它们没有聚类，则生物学信号得以保留。\n\nB. 对校正后的数据使用像主成分分析（PCA）这样的降维技术。在前两个主成分上绘制样本点，并根据其生物学分组（肿瘤 vs. 健康）为点着色。如果各组显示出清晰的分离，则生物学信号得以保留。\n\nC. 挑选几个看家基因和几个已知的癌症生物标志物，绘制它们在每个样本中的表达水平。一次保留了生物学信号的成功校正会显示，看家基因在所有样本中的表达水平相似，而已知的癌症生物标志物在肿瘤组和健康组之间仍然显示出明显的表达水平差异，无论其原始批次如何。\n\nD. 对每个基因，计算其在肿瘤组和健康组内的平均表达量。将这些平均值相互对照绘制（肿瘤平均值 vs. 健康平均值）。如果这些点在 $y=x$ 线周围形成一团，则校正不成功。如果它们显著偏离，则生物学信号得以保留。", "solution": "目标是验证批次校正是否已去除与批次相关的非生物学差异，同时保留了肿瘤与健康组织之间的真实生物学差异。一个非统计性的可视化检查应利用先前的生物学知识，并直接评估两个标准：\n1.  预期在不同条件下（如看家基因）保持不变的基因的表达稳定性。\n2.  作为该肿瘤类型生物标志物的基因的已知差异表达的保留情况。\n\n根据这些标准评估每种提议的方法：\n\n- 选项A关注的是在所有基因的热图中，批次是否形成聚类。虽然缺乏批次聚类表明批次效应有所减少，但这并没有解决肿瘤与健康组织之间的生物学信号是否被保留的问题。此外，使用所有基因会稀释检查的效果，因为许多基因与该生物学对比无关。\n\n- 选项B使用PCA，并按肿瘤与健康对样本进行着色。这是一种常见的探索性可视化方法，但是是间接的：即使肿瘤与健康的对比被保留下来，主导的主成分也可能无法捕捉到它，而且分离情况可能受到残余混杂因素的影响。它没有明确地测试已知稳定基因和已知生物标志物的行为，尽管这些基因是可用的，并且对于此目的来说信息最丰富。\n\n- 选项C直接绘制选定的看家基因和已知的癌症生物标志物在所有样本中的表达。一次成功的校正应该使得看家基因在所有样本中具有相似的表达（表明技术性差异已被去除），而已知的生物标志物在不同批次中，肿瘤组和健康组之间仍然显示出明显的表达差异（表明生物学信号已被保留）。这是一种有针对性的、非统计性的、可视化的验证方法，它精确地利用了与目标一致的先验生物学知识。\n\n- 选项D比较每个基因在肿瘤组和健康组的平均值，并将点靠近 $y=x$ 线解释为校正不成功。这个逻辑是有缺陷的，因为大多数基因没有差异表达，即使校正成功，它们也应该位于 $y=x$ 线附近。它也忽略了批次因素，并且没有利用精选的基因集。\n\n因此，考虑到既定目标以及看家基因集和生物标志物基因集的可用性，最合适的可视化检查是使用有针对性的图表来展示看家基因表达的稳定性和已知生物标志物差异表达在不同批次间的保留情况，这在选项C中有详细描述。", "answer": "$$\\boxed{C}$$", "id": "1418485"}]}