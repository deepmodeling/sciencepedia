{"hands_on_practices": [{"introduction": "单细胞RNA测序（scRNA-seq）数据具有极高的维度，包含数万个基因的表达信息。为了有效分析，我们必须在保留关键生物学变异的同时减少数据的复杂性和噪音。这个练习将指导你通过一个基于主成分分析（PCA）的量化模型，学习如何确定最佳的主成分（PCs）数量，从而在捕获真实生物信号和引入技术噪音之间做出关键权衡。[@problem_id:2268292]", "problem": "一位免疫学家正在分析一项单细胞RNA测序 (scRNA-seq) 实验的数据，该实验旨在描绘肿瘤微环境中的免疫细胞图景。分析的第一步是主成分分析 (PCA)，这是一种降维技术，用于识别高维基因表达数据中的主要变异轴。\n\n提出了一个简化模型来描述每个主成分 (PC) 所捕获的方差。第 $i$ 个主成分的总方差 $V_i$ 由生物信号分量 $S_i$ 和随机噪声分量 $N_i$ 组成，即 $V_i = S_i + N_i$。\n\n信号方差源于细胞类型（例如，T细胞与不同巨噬细胞亚型）之间的真实生物学差异，其模型为随主成分序列指数衰减：\n$$S_i = A \\exp(-\\alpha (i-1)) \\quad \\text{for } i \\ge 1$$\n噪声方差源于技术伪影和随机基因表达，假定其对每个主成分的贡献是恒定的：\n$$N_i = N_0$$\n从数据中推导出的该模型参数为：$A = 100$（任意方差单位），$\\alpha = 0.5$ 和 $N_0 = 5$。\n\n为了选择用于下游聚类分析的最佳主成分数量，采用了一种双重策略，以平衡捕获足够的生物信号和避免引入过多噪声。\n1. 确定“肘点”$k_{elbow}$，其定义为满足信号方差小于噪声方差 ($S_k < N_k$) 的最小整数 $k$。认为使用超过此点的主成分主要会增加噪声。\n2. 确定捕获所有可能主成分中至少 $f_S = 0.99$ 比例的*总*生物信号所需的最小主成分数 $k_{signal}$。\n\n用于分析的最终主成分数 $k_{final}$ 被选为这两个值的最大值，即 $k_{final} = \\max(k_{elbow}, k_{signal})$，以确保两个标准都得到满足。\n\n计算 $k_{final}$ 的整数值。", "solution": "给定 $V_{i}=S_{i}+N_{i}$，其中 $S_{i}=A\\exp(-\\alpha(i-1))$ 且 $N_{i}=N_{0}$，参数值为 $A=100$，$\\alpha=0.5$，以及 $N_{0}=5$。我们必须计算 $k_{elbow}$ 和 $k_{signal}$，然后取 $k_{final}=\\max(k_{elbow},k_{signal})$。\n\n肘点 $k_{elbow}$：这是满足 $S_{k}<N_{k}=N_{0}$ 的最小整数 $k$。不等式\n$$\nA\\exp(-\\alpha(k-1))<N_{0}\n$$\n（利用指数和对数函数的单调性）等价于\n$$\n-\\alpha(k-1)<\\ln\\!\\left(\\frac{N_{0}}{A}\\right)\\quad\\Longrightarrow\\quad k-1>-\\frac{1}{\\alpha}\\ln\\!\\left(\\frac{N_{0}}{A}\\right)=\\frac{1}{\\alpha}\\ln\\!\\left(\\frac{A}{N_{0}}\\right).\n$$\n因此，满足此严格不等式的最小整数是\n$$\nk_{elbow}=\\left\\lfloor 1+\\frac{1}{\\alpha}\\ln\\!\\left(\\frac{A}{N_{0}}\\right)\\right\\rfloor+1.\n$$\n代入 $A=100$，$N_{0}=5$ 和 $\\alpha=0.5$ 可得\n$$\n1+\\frac{1}{\\alpha}\\ln\\!\\left(\\frac{A}{N_{0}}\\right)=1+2\\ln(20)\\approx 1+2\\times 2.995732=6.991464,\n$$\n所以 $k_{elbow}=7$。直接计算，$S_{7}=100\\exp(-0.5\\times 6)=100\\exp(-3)\\approx 4.9787<5$，而 $S_{6}=100\\exp(-2.5)\\approx 8.2085>5$，这验证了 $k_{elbow}=7$。\n\n信号覆盖率 $k_{signal}$：令 $r=\\exp(-\\alpha)$。总生物信号是一个几何级数\n$$\nS_{\\text{total}}=\\sum_{i=1}^{\\infty}S_{i}=A\\sum_{j=0}^{\\infty}r^{j}=\\frac{A}{1-r}.\n$$\n前 $k$ 项的部分和是\n$$\n\\sum_{i=1}^{k}S_{i}=A\\frac{1-r^{k}}{1-r}.\n$$\n我们要求\n$$\nA\\frac{1-r^{k}}{1-r}\\ge f_{S}\\frac{A}{1-r}\\quad\\Longleftrightarrow\\quad 1-r^{k}\\ge f_{S}\\quad\\Longleftrightarrow\\quad r^{k}\\le 1-f_{S}.\n$$\n取自然对数（注意 $0<r<1$ 所以 $\\ln r<0$）可得\n$$\nk\\ln r\\le \\ln(1-f_{S})\\quad\\Longrightarrow\\quad k\\ge \\frac{\\ln(1-f_{S})}{\\ln r}.\n$$\n由于 $r=\\exp(-\\alpha)$，$\\ln r=-\\alpha$，所以\n$$\nk\\ge \\frac{\\ln(1-f_{S})}{-\\alpha}.\n$$\n对于 $f_{S}=0.99$ 和 $\\alpha=0.5$，\n$$\nk\\ge \\frac{\\ln(0.01)}{-0.5}=\\frac{-\\ln(100)}{-0.5}=\\frac{-4.605170\\ldots}{-0.5}=9.21034\\ldots,\n$$\n所以最小整数是 $k_{signal}=\\lceil 9.21034\\ldots\\rceil=10$。检验：当 $k=10$ 时，捕获的比例是 $1-r^{10}=1-\\exp(-5)\\approx 0.9933\\ge 0.99$，而当 $k=9$ 时，它是 $1-\\exp(-4.5)\\approx 0.9889<0.99$。\n\n最后，\n$$\nk_{final}=\\max(k_{elbow},k_{signal})=\\max(7,10)=10.\n$$", "answer": "$$\\boxed{10}$$", "id": "2268292"}, {"introduction": "在定义了细胞簇之后，理解其内部的异质性至关重要，而仅仅比较平均表达水平是不够的。小提琴图（Violin plot）能够直观地展示基因表达在整个细胞群中的分布模式，揭示例如促炎因子*TNF*这样的关键基因在不同细胞亚群中的复杂行为。本练习旨在训练你解读这些图表的能力，从表达分布的形状中提取关于细胞状态和响应异质性的深刻生物学见解。[@problem_id:2268290]", "problem": "一个免疫学家团队正在使用单细胞RNA测序（scRNA-seq）技术研究巨噬细胞活化，该技术可以测量成千上万个单个细胞中的基因表达水平。在处理数据后，他们识别出了三个不同的巨噬细胞簇，并将其标记为 Cluster A、Cluster B 和 Cluster C。随后，他们生成了小提琴图，以可视化每个簇内肿瘤坏死因子（*TNF*）基因的表达情况。*TNF*是一种强效的促炎细胞因子。\n\n小提琴图是一种绘制数值数据的方法。“小提琴”的形状代表了数据在不同数值上的概率密度，较宽的部分代表在该表达水平上具有更高频率的细胞。内部的点或线通常标记该簇的表达中位数。\n\n研究人员观察到 *TNF* 基因表达小提琴图具有以下特征：\n\n*   **Cluster A：** 该图宽阔且呈明显的双峰形态，意味着它有两个峰。一个峰接近于零表达，第二个显著的峰则处于高表达水平。表达中位数处于中等水平。\n*   **Cluster B：** 该图非常窄，并集中在高表达水平。该簇中的绝大多数细胞都表现出相似的高水平 *TNF* 表达。\n*   **Cluster C：** 该图宽阔且向零表达水平强烈偏斜。大多数细胞表现出很少或没有 *TNF* 表达，但有一条由表达水平逐渐增高的细胞构成的长“尾巴”。表达中位数非常低。\n\n根据对 *TNF* 表达小提琴图的这些描述，以下哪个陈述提供了最准确的生物学解释？\n\nA. Cluster C 代表了最强的促炎巨噬细胞群体，因为其小提琴图最宽，表明其反应具有多样性。\n\nB. Cluster A 中的细胞正在对促炎刺激做出一致且强烈的反应，其中等水平的 *TNF* 表达中位数表明了这一点。\n\nC. Cluster B 代表了一个高度同质化的巨噬细胞群体，它们正在发动强烈而一致的促炎反应，而 Cluster A 包含一个异质群体，其中有一个强烈反应的细胞亚群。\n\nD. Cluster C 中所有细胞产生的 TNF 蛋白总量可能大于 Cluster B，因为 Cluster C 的分布覆盖了更宽的表达值范围。", "solution": "小提琴图的解释原则：在给定表达值 $x$ 处的宽度反映了在该表达水平上细胞的概率密度 $p(x)$；多个峰表示多峰性；中位数概括了集中趋势；偏度表示长尾的方向。对于通过TNF介导的促炎反应的生物学解释，许多细胞的高表达表明了更强、更一致的活化，而异质性则表明存在混合的反应亚群和无反应亚群。\n\n对于 Cluster A，小提琴图宽且呈双峰形态，一个峰接近零，另一个峰在高表达处，中位数处于中等水平。设 $p_{A}(x)$ 表示其表达分布。两个峰，一个在 $x \\approx 0$ 附近，一个在高的 $x$ 值处，这意味着一个混合模型，包含一个无反应或低反应的亚群和一个强反应的亚群。中等水平的中位数是因为累积分布函数在两个峰之间穿过 $0.5$ 这个点，而不是因为大多数细胞处于中等水平。因此，Cluster A 是异质的，而不是一致地强烈反应。\n\n对于 Cluster B，小提琴图非常窄，并集中在高表达水平。设 $p_{B}(x)$ 围绕一个大的均值 $\\mu_{B}$ 和中位数 $m_{B}$（两者都很高）高度集中，方差很小。这表明几乎所有细胞都有相似的、高的TNF表达；从生物学上讲，这是一个发动强烈而一致的促炎反应的同质群体。\n\n对于 Cluster C，小提琴图宽阔且向零强烈偏斜，有一个长的右尾和一个非常低的中位数。设 $p_{C}(x)$ 在 $x \\approx 0$ 附近权重很大，并向更大的 $x$ 值延伸出长尾。低中位数 $m_{C}$ 和接近零的高密度意味着大多数细胞几乎没有或完全没有TNF表达，只有少数细胞表现出逐渐增高的水平。这表明主要是弱反应或无反应，伴有一小部分较高反应的细胞；变异性（宽度）反映的是异质性，而不是效力。\n\n评估选项：\n- 选项A声称 Cluster C 是最强的，因为其小提琴图最宽。这混淆了变异性与效力。鉴于 $m_{C}$ 非常低，且大部分密度接近于零，Cluster C 并非最强的；其宽度反映的是异质性和长尾，而不是强烈的整体活化。因此A是错误的。\n- 选项B声称 Cluster A 基于中等的中位数而表现出一致且强烈的反应。$p_{A}(x)$ 的双峰性（其中一个峰接近零）与一致的强烈反应相矛盾；中等的中位数是混合了低表达和高表达亚群的结果。因此B是错误的。\n- 选项C指出 Cluster B 是一个高度同质化、强烈反应的群体，而 Cluster A 是一个异质群体，其中包含一个强反应亚群。这与窄且中心位置高的 $p_{B}(x)$ 以及带有高表达亚群的双峰 $p_{A}(x)$ 相匹配。因此C是正确的。\n- 选项D声称，由于 Cluster C 的分布跨度更广，其TNF总产量可能超过 Cluster B。总产量与总和（或均值 $\\mu$ 乘以细胞数）成正比，而不是与范围或宽度成正比。鉴于 Cluster B 的绝大多数细胞都具有高表达（大的 $\\mu_{B}$），而 Cluster C 的大多数细胞表达接近于零（尽管有长尾，但 $\\mu_{C}$ 仍然很小），没有证据支持 Cluster C 会产生更多的总TNF；通过范围进行的论证是有缺陷的。因此D是错误的。\n\n因此，最准确的解释是 Cluster B 是一个具有强烈、一致反应的同质群体，而 Cluster A 是一个异质群体，其中包含一个强烈反应的细胞亚群。", "answer": "$$\\boxed{C}$$", "id": "2268290"}, {"introduction": "为了从功能上表征细胞簇，我们可以超越单个基因，通过整合一组相关基因的表达来创建一个综合性的“模块得分”。这个练习将引导你计算一个“细胞毒性得分” $S_{\\text{cyto}}$，该得分通过比较效应基因（如*GZMB*）与对照管家基因的平均表达来量化T细胞的杀伤潜力。这种方法能让你对不同细胞集群的功能状态进行直接的量化比较，是识别关键功能性细胞亚群的有力工具。[@problem_id:2268244]", "problem": "一位免疫学家正在分析来自肿瘤浸润淋巴细胞（Tumor-Infiltrating Lymphocytes, TILs）的单细胞RNA测序（scRNA-seq）数据集，以了解细胞毒性T细胞的功能状态。在使用统一流形逼近与投影（Uniform Manifold Approximation and Projection, UMAP）进行初步处理和降维后，已识别出两个不同的CD8+ T细胞簇，分别记为簇A和簇B。为定量比较它们的细胞毒性潜能，根据关键基因的表达量，为每个细胞计算了“细胞毒性得分”（$S_{\\text{cyto}}$）。\n\n该得分定义为效应基因集（$G_{\\text{eff}}$）的平均表达量与对照基因集（$G_{\\text{ctrl}}$）的平均表达量之差。计算公式为：\n$$S_{\\text{cyto}} = \\left( \\frac{1}{N_{\\text{eff}}} \\sum_{i \\in G_{\\text{eff}}} E_i \\right) - \\left( \\frac{1}{N_{\\text{ctrl}}} \\sum_{j \\in G_{\\text{ctrl}}} E_j \\right)$$\n其中，$E_k$ 是基因 $k$ 的对数归一化表达值，$N_{\\text{eff}}$ 是效应基因集中的基因数量，$N_{\\text{ctrl}}$ 是对照基因集中的基因数量。表达值和最终得分是无量纲的。\n\n基因集定义如下：\n- 效应基因集，$G_{\\text{eff}} = \\{\\text{GZMB, PRF1, IFNG}\\}$\n- 对照基因集，$G_{\\text{ctrl}} = \\{\\text{ACTB, GAPDH}\\}$\n\n以下是来自每个簇的三个代表性细胞的对数归一化表达值：\n\n**簇A：**\n- 细胞A1：GZMB = 4.5, PRF1 = 5.0, IFNG = 3.1, ACTB = 2.1, GAPDH = 2.3\n- 细胞A2：GZMB = 4.8, PRF1 = 4.7, IFNG = 3.5, ACTB = 2.0, GAPDH = 2.2\n- 细胞A3：GZMB = 4.2, PRF1 = 5.3, IFNG = 3.3, ACTB = 2.2, GAPDH = 2.4\n\n**簇B：**\n- 细胞B1：GZMB = 1.2, PRF1 = 1.5, IFNG = 0.8, ACTB = 2.3, GAPDH = 2.5\n- 细胞B2：GZMB = 0.9, PRF1 = 1.3, IFNG = 0.5, ACTB = 2.1, GAPDH = 2.1\n- 细胞B3：GZMB = 1.4, PRF1 = 1.1, IFNG = 1.0, ACTB = 2.2, GAPDH = 2.4\n\n您的任务是计算簇A的平均细胞毒性得分（$\\bar{S}_A$）和簇B的平均细胞毒性得分（$\\bar{S}_B$）。然后，确定簇A的平均得分与簇B的平均得分之比。\n\n将比值 $\\frac{\\bar{S}_A}{\\bar{S}_B}$ 的最终答案表示为一个数值，并四舍五入到三位有效数字。", "solution": "我们将单个细胞的细胞毒性得分定义为\n$$S_{\\text{cyto}}=\\left(\\frac{1}{N_{\\text{eff}}}\\sum_{i\\in G_{\\text{eff}}}E_{i}\\right)-\\left(\\frac{1}{N_{\\text{ctrl}}}\\sum_{j\\in G_{\\text{ctrl}}}E_{j}\\right),$$\n其中 $N_{\\text{eff}}=3$ 且 $N_{\\text{ctrl}}=2$。\n\n对于簇A：\n- 细胞A1:\n$$S_{\\text{cyto}}(\\text{A1})=\\left(\\frac{4.5+5.0+3.1}{3}\\right)-\\left(\\frac{2.1+2.3}{2}\\right)=\\left(\\frac{12.6}{3}\\right)-\\left(\\frac{4.4}{2}\\right)=4.2-2.2=2.0。$$\n- 细胞A2:\n$$S_{\\text{cyto}}(\\text{A2})=\\left(\\frac{4.8+4.7+3.5}{3}\\right)-\\left(\\frac{2.0+2.2}{2}\\right)=\\left(\\frac{13.0}{3}\\right)-\\left(\\frac{4.2}{2}\\right)=\\frac{13}{3}-2.1=\\frac{67}{30}\\approx 2.233\\ldots。$$\n- 细胞A3:\n$$S_{\\text{cyto}}(\\text{A3})=\\left(\\frac{4.2+5.3+3.3}{3}\\right)-\\left(\\frac{2.2+2.4}{2}\\right)=\\left(\\frac{12.8}{3}\\right)-\\left(\\frac{4.6}{2}\\right)=\\frac{64}{15}-2.3=\\frac{59}{30}\\approx 1.966\\ldots。$$\n簇A的平均值：\n$$\\bar{S}_{A}=\\frac{2.0+\\frac{67}{30}+\\frac{59}{30}}{3}=\\frac{\\frac{60}{30}+\\frac{67}{30}+\\frac{59}{30}}{3}=\\frac{\\frac{186}{30}}{3}=\\frac{31}{15}\\approx 2.066\\ldots。$$\n\n对于簇B：\n- 细胞B1:\n$$S_{\\text{cyto}}(\\text{B1})=\\left(\\frac{1.2+1.5+0.8}{3}\\right)-\\left(\\frac{2.3+2.5}{2}\\right)=\\left(\\frac{3.5}{3}\\right)-2.4=\\frac{7}{6}-\\frac{12}{5}=-\\frac{37}{30}\\approx -1.233\\ldots。$$\n- 细胞B2:\n$$S_{\\text{cyto}}(\\text{B2})=\\left(\\frac{0.9+1.3+0.5}{3}\\right)-\\left(\\frac{2.1+2.1}{2}\\right)=0.9-2.1=-1.2=-\\frac{6}{5}。$$\n- 细胞B3:\n$$S_{\\text{cyto}}(\\text{B3})=\\left(\\frac{1.4+1.1+1.0}{3}\\right)-\\left(\\frac{2.2+2.4}{2}\\right)=\\left(\\frac{3.5}{3}\\right)-2.3=\\frac{7}{6}-\\frac{23}{10}=-\\frac{17}{15}\\approx -1.133\\ldots。$$\n簇B的平均值：\n$$\\bar{S}_{B}=\\frac{-\\frac{37}{30}-\\frac{6}{5}-\\frac{17}{15}}{3}=\\frac{-\\frac{37}{30}-\\frac{36}{30}-\\frac{34}{30}}{3}=\\frac{-\\frac{107}{30}}{3}=-\\frac{107}{90}\\approx -1.188\\ldots。$$\n\n平均值的比值为\n$$\\frac{\\bar{S}_{A}}{\\bar{S}_{B}}=\\frac{\\frac{31}{15}}{-\\frac{107}{90}}=-\\frac{31}{15}\\cdot\\frac{90}{107}=-\\frac{186}{107}\\approx -1.738317\\ldots。$$\n四舍五入到三位有效数字，该比值为$-1.74$。", "answer": "$$\\boxed{-1.74}$$", "id": "2268244"}]}