{"hands_on_practices": [{"introduction": "解析解在辐射传输领域中是验证数值方法和深入理解物理过程的基石。本实践将引导你从第一性原理出发，为一个具有物理代表性的简单系统——一个均匀的、吸收和发射辐射的等温平板——推导其内部的精确辐射强度角分布和边界上的出射热流。这项基础练习旨在强化你对辐射传输方程（RTE）的物理意义、边界条件的应用以及沿特征线求解方法的掌握 [@problem_id:2529717]。", "problem": "一个厚度为 $L$ 的平行平面、均匀、无散射的参与性介质板占据 $0 \\le x \\le L$ 的空间。该板两侧均为真空。折射率为1，界面处的折射可以忽略不计。该介质在均匀温度 $T_0$ 下处于局部热力学平衡 (LTE) 状态，表现出纯吸收和热发射。设光谱吸收系数 $\\kappa_{\\nu}$ 为常数，LTE下的光谱源函数由基尔霍夫定律给出，为 $S_{\\nu} = B_{\\nu}(T_0)$，其中 $B_{\\nu}$ 是频率为 $\\nu$ 时的普朗克函数。考虑光谱比辐射强度 $I_{\\nu}(x,\\mu)$，其中 $\\mu = \\cos\\theta \\in (-1,1)$，$\\theta$ 是从 $+x$ 轴测量的极角（单位为弧度）。没有外部辐照：对于 $\\mu \\in (0,1]$ 有 $I_{\\nu}(0,\\mu) = 0$，对于 $\\mu \\in [-1,0)$ 有 $I_{\\nu}(L,\\mu) = 0$。从参与性介质中沿射线的辐射能量守恒以及LTE下吸收和发射的定义出发，推导以下物理量的精确闭式表达式：\n- 内部角向强度 $I_{\\nu}(x,\\mu)$（分别针对 $\\mu \\in (0,1]$ 和 $\\mu \\in [-1,0)$），以及\n- 从两个边界发出的半球光谱通量，\n$$F_{\\nu,\\text{out}}(0) = 2\\pi \\int_{-1}^{0} \\big(-\\mu\\big)\\, I_{\\nu}(0,\\mu)\\, d\\mu,\\qquad F_{\\nu,\\text{out}}(L) = 2\\pi \\int_{0}^{1} \\mu\\, I_{\\nu}(L,\\mu)\\, d\\mu.$$\n将最终的通量结果用指数积分 $E_3(\\tau)$ 表示，其中光学厚度 $\\tau = \\kappa_{\\nu} L$。你的推导必须从沿特征线的辐射能量守恒开始，不得引用任何预先制表的辐射传输解。将最终表达式用 $B_{\\nu}(T_0)$, $\\kappa_{\\nu}$, $L$ 和 $\\mu$ 表示。最终答案必须是闭式解析表达式。将通量以 $\\mathrm{W\\, m^{-2}\\, Hz^{-1}}$ 为单位表示。不要进行任何数值计算或四舍五入。", "solution": "所述问题在物理和数学上都是合理的、自洽的且适定的。我们将着手求解。\n\n支配辐射能量传输的基本原理是沿射线的能量守恒。在参与性介质中，光谱比辐射强度 $dI_{\\nu}$ 在微分路径长度 $ds$ 上的变化是发射增益和吸收损失的总和。这表示为：\n$$ \\frac{dI_{\\nu}}{ds} = -\\alpha_{\\nu}I_{\\nu} + j_{\\nu} $$\n其中 $\\alpha_{\\nu}$ 是吸收系数，$j_{\\nu}$ 是发射系数。问题指出介质是无散射的，因此没有散射项。在局部热力学平衡 (LTE) 条件下，基尔霍夫定律通过普朗克函数 $B_{\\nu}(T)$ 将发射系数和吸收系数联系起来。对于折射率为1的介质，此关系为 $j_{\\nu} = \\alpha_{\\nu} B_{\\nu}(T)$。问题给出的光谱吸收系数为 $\\kappa_{\\nu}$，它是 $\\alpha_{\\nu}$ 的同义词。因此，$j_{\\nu} = \\kappa_{\\nu} B_{\\nu}(T_0)$，其中温度 $T_0$ 在整个板内是均匀的。\n\n辐射传输方程变为：\n$$ \\frac{dI_{\\nu}}{ds} = -\\kappa_{\\nu}I_{\\nu} + \\kappa_{\\nu}B_{\\nu}(T_0) $$\n对于平行平面几何，沿射线的路径长度 $ds$ 与垂直于板的坐标 $x$ 的关系为 $ds = \\frac{dx}{\\mu}$，其中 $\\mu = \\cos\\theta$，$\\theta$ 是相对于 $+x$ 轴的极角。将此代入方程，得到该问题的一维辐射传输方程 (RTE)：\n$$ \\mu \\frac{dI_{\\nu}(x, \\mu)}{dx} = -\\kappa_{\\nu}I_{\\nu}(x, \\mu) + \\kappa_{\\nu}B_{\\nu}(T_0) $$\n这是一个关于 $I_{\\nu}$ 对 $x$ 的一阶线性常微分方程，我们将在给定的边界条件下求解它。该方程可以重排为：\n$$ \\frac{dI_{\\nu}}{dx} + \\frac{\\kappa_{\\nu}}{\\mu} I_{\\nu} = \\frac{\\kappa_{\\nu}}{\\mu} B_{\\nu}(T_0) $$\n我们使用积分因子法。由于 $\\kappa_{\\nu}$ 和 $\\mu$ 相对于 $x$ 是常数，积分因子为 $\\exp\\left(\\int \\frac{\\kappa_{\\nu}}{\\mu} dx\\right) = \\exp\\left(\\frac{\\kappa_{\\nu}x}{\\mu}\\right)$。将RTE乘以积分因子，得到：\n$$ \\frac{d}{dx}\\left[I_{\\nu}(x,\\mu)\\exp\\left(\\frac{\\kappa_{\\nu}x}{\\mu}\\right)\\right] = \\frac{\\kappa_{\\nu}}{\\mu} B_{\\nu}(T_0) \\exp\\left(\\frac{\\kappa_{\\nu}x}{\\mu}\\right) $$\n对 $x$ 从参考位置 $x_0$ 积分到 $x$：\n$$ I_{\\nu}(x,\\mu)\\exp\\left(\\frac{\\kappa_{\\nu}x}{\\mu}\\right) - I_{\\nu}(x_0,\\mu)\\exp\\left(\\frac{\\kappa_{\\nu}x_0}{\\mu}\\right) = \\int_{x_0}^{x} \\frac{\\kappa_{\\nu}}{\\mu} B_{\\nu}(T_0) \\exp\\left(\\frac{\\kappa_{\\nu}x'}{\\mu}\\right) dx' $$\n由于 $B_{\\nu}(T_0)$ 是常数，积分很简单：\n$$ \\int_{x_0}^{x} \\frac{\\kappa_{\\nu}}{\\mu} B_{\\nu}(T_0) \\exp\\left(\\frac{\\kappa_{\\nu}x'}{\\mu}\\right) dx' = B_{\\nu}(T_0) \\left[\\exp\\left(\\frac{\\kappa_{\\nu}x'}{\\mu}\\right)\\right]_{x_0}^{x} = B_{\\nu}(T_0)\\left[\\exp\\left(\\frac{\\kappa_{\\nu}x}{\\mu}\\right) - \\exp\\left(\\frac{\\kappa_{\\nu}x_0}{\\mu}\\right)\\right] $$\n因此，形式解为：\n$$ I_{\\nu}(x,\\mu) = I_{\\nu}(x_0,\\mu)\\exp\\left(-\\frac{\\kappa_{\\nu}(x-x_0)}{\\mu}\\right) + B_{\\nu}(T_0)\\left[1 - \\exp\\left(-\\frac{\\kappa_{\\nu}(x-x_0)}{\\mu}\\right)\\right] $$\n我们现在对两种不同的传播方向情况应用特定的边界条件。\n\n**第1部分：内部角向强度 $I_{\\nu}(x,\\mu)$**\n\n情况1：辐射沿正向传播，$\\mu \\in (0,1]$。\n辐射起源于 $x=0$ 处的边界。我们设置参考位置 $x_0 = 0$。边界条件为 $I_{\\nu}(0,\\mu)=0$。\n将此代入形式解：\n$$ I_{\\nu}(x,\\mu) = 0 \\cdot \\exp\\left(-\\frac{\\kappa_{\\nu}x}{\\mu}\\right) + B_{\\nu}(T_0)\\left[1 - \\exp\\left(-\\frac{\\kappa_{\\nu}x}{\\mu}\\right)\\right] $$\n$$ I_{\\nu}(x,\\mu) = B_{\\nu}(T_0)\\left[1 - \\exp\\left(-\\frac{\\kappa_{\\nu}x}{\\mu}\\right)\\right] \\quad \\text{for } \\mu \\in (0,1] $$\n\n情况2：辐射沿反向传播，$\\mu \\in [-1,0)$。\n辐射起源于 $x=L$ 处的边界。我们设置参考位置 $x_0 = L$。边界条件为 $I_{\\nu}(L,\\mu)=0$。\n将此代入形式解：\n$$ I_{\\nu}(x,\\mu) = I_{\\nu}(L,\\mu)\\exp\\left(-\\frac{\\kappa_{\\nu}(x-L)}{\\mu}\\right) + B_{\\nu}(T_0)\\left[1 - \\exp\\left(-\\frac{\\kappa_{\\nu}(x-L)}{\\mu}\\right)\\right] $$\n$$ I_{\\nu}(x,\\mu) = 0 \\cdot \\exp\\left(-\\frac{\\kappa_{\\nu}(x-L)}{\\mu}\\right) + B_{\\nu}(T_0)\\left[1 - \\exp\\left(-\\frac{\\kappa_{\\nu}(x-L)}{\\mu}\\right)\\right] $$\n$$ I_{\\nu}(x,\\mu) = B_{\\nu}(T_0)\\left[1 - \\exp\\left(-\\frac{\\kappa_{\\nu}(x-L)}{\\mu}\\right)\\right] \\quad \\text{for } \\mu \\in [-1,0) $$\n注意，对于 $\\mu  0$，由于 $x  L$，指数的参数 $(x-L)/\\mu$ 是正的，这确保了强度在从 $x=L$ 处传播到介质内部时，会从零开始增加。\n\n**第2部分：出射半球光谱通量**\n\n边界 $x=L$ 处的通量：\n$x=L$ 处的出射通量是由沿方向 $\\mu \\in (0,1]$ 传播的辐射引起的。提供的表达式为：\n$$ F_{\\nu,\\text{out}}(L) = 2\\pi \\int_0^1 \\mu I_{\\nu}(L,\\mu) d\\mu $$\n我们使用 $\\mu > 0$ 时 $I_{\\nu}(x,\\mu)$ 的表达式，并在 $x=L$ 处对其求值：\n$$ I_{\\nu}(L,\\mu) = B_{\\nu}(T_0)\\left[1 - \\exp\\left(-\\frac{\\kappa_{\\nu}L}{\\mu}\\right)\\right] $$\n将此代入通量积分：\n$$ F_{\\nu,\\text{out}}(L) = 2\\pi B_{\\nu}(T_0) \\int_0^1 \\mu \\left[1 - \\exp\\left(-\\frac{\\kappa_{\\nu}L}{\\mu}\\right)\\right] d\\mu $$\n$$ F_{\\nu,\\text{out}}(L) = 2\\pi B_{\\nu}(T_0) \\left[ \\int_0^1 \\mu d\\mu - \\int_0^1 \\mu \\exp\\left(-\\frac{\\kappa_{\\nu}L}{\\mu}\\right) d\\mu \\right] $$\n第一个积分是初等的：$\\int_0^1 \\mu d\\mu = \\left[\\frac{\\mu^2}{2}\\right]_0^1 = \\frac{1}{2}$。\n第二个积分与指数积分函数 $E_n(z)$ 有关。一个标准定义是 $E_n(z) = \\int_0^1 u^{n-2} \\exp(-z/u) du$。\n设光学厚度为 $\\tau = \\kappa_{\\nu}L$。该积分为 $\\int_0^1 \\mu \\exp(-\\tau/\\mu) d\\mu$。\n与定义比较，我们令 $u=\\mu$, $z=\\tau$, 以及 $n-2=1$，这意味着 $n=3$。\n因此，$\\int_0^1 \\mu \\exp(-\\tau/\\mu) d\\mu = E_3(\\tau) = E_3(\\kappa_{\\nu}L)$。\n代回后，通量为：\n$$ F_{\\nu,\\text{out}}(L) = 2\\pi B_{\\nu}(T_0) \\left[ \\frac{1}{2} - E_3(\\kappa_{\\nu}L) \\right] = \\pi B_{\\nu}(T_0) \\left[ 1 - 2E_3(\\kappa_{\\nu}L) \\right] $$\n\n边界 $x=0$ 处的通量：\n$x=0$ 处的出射通量是由沿方向 $\\mu \\in [-1,0)$ 传播的辐射引起的。表达式为：\n$$ F_{\\nu,\\text{out}}(0) = 2\\pi \\int_{-1}^0 (-\\mu) I_{\\nu}(0,\\mu) d\\mu $$\n我们使用 $\\mu  0$ 时 $I_{\\nu}(x,\\mu)$ 的表达式，并在 $x=0$ 处对其求值：\n$$ I_{\\nu}(0,\\mu) = B_{\\nu}(T_0)\\left[1 - \\exp\\left(-\\frac{\\kappa_{\\nu}(0-L)}{\\mu}\\right)\\right] = B_{\\nu}(T_0)\\left[1 - \\exp\\left(\\frac{\\kappa_{\\nu}L}{\\mu}\\right)\\right] $$\n为了计算该积分，我们进行变量替换。令 $\\mu' = -\\mu$。则 $d\\mu = -d\\mu'$。积分限从 $[-1,0)$ 变为 $(1,0]$。\n$$ F_{\\nu,\\text{out}}(0) = 2\\pi \\int_1^0 \\mu' I_{\\nu}(0,-\\mu') (-d\\mu') = 2\\pi \\int_0^1 \\mu' I_{\\nu}(0,-\\mu') d\\mu' $$\n用 $\\mu'$ 表示的强度为：\n$$ I_{\\nu}(0,-\\mu') = B_{\\nu}(T_0)\\left[1 - \\exp\\left(-\\frac{\\kappa_{\\nu}L}{\\mu'}\\right)\\right] $$\n将此代入 $F_{\\nu,\\text{out}}(0)$ 的积分：\n$$ F_{\\nu,\\text{out}}(0) = 2\\pi B_{\\nu}(T_0) \\int_0^1 \\mu' \\left[1 - \\exp\\left(-\\frac{\\kappa_{\\nu}L}{\\mu'}\\right)\\right] d\\mu' $$\n这个积分在形式上与 $F_{\\nu,\\text{out}}(L)$ 的积分相同，只是哑积分变量是 $\\mu'$ 而不是 $\\mu$。因此，计算过程是相同的。\n$$ F_{\\nu,\\text{out}}(0) = \\pi B_{\\nu}(T_0) \\left[ 1 - 2E_3(\\kappa_{\\nu}L) \\right] $$\n出射通量相等，$F_{\\nu,\\text{out}}(0) = F_{\\nu,\\text{out}}(L)$，这是由问题的物理对称性所预期的：一个具有对称边界条件的均匀等温板必须从两侧同等地辐射。光谱通量的单位确实是 $\\mathrm{W \\cdot m^{-2} \\cdot Hz^{-1}}$，因为 $B_{\\nu}(T_0)$ 的单位是 $\\mathrm{W \\cdot m^{-2} \\cdot sr^{-1} \\cdot Hz^{-1}}$，而带有因子 $\\mu$ 的立体角积分消除了对球面度的依赖。", "answer": "$$ \\boxed{\\begin{pmatrix} B_{\\nu}(T_0)\\left(1 - \\exp\\left(-\\frac{\\kappa_{\\nu} x}{\\mu}\\right)\\right) \\\\ B_{\\nu}(T_0)\\left(1 - \\exp\\left(-\\frac{\\kappa_{\\nu}(x-L)}{\\mu}\\right)\\right) \\\\ \\pi B_{\\nu}(T_0) \\left( 1 - 2E_3(\\kappa_{\\nu} L) \\right) \\\\ \\pi B_{\\nu}(T_0) \\left( 1 - 2E_3(\\kappa_{\\nu} L) \\right) \\end{pmatrix}} $$", "id": "2529717"}, {"introduction": "虽然解析解 [@problem_id:2529717] 提供了深刻的物理洞察，但对于更复杂的实际问题，数值方法是必不可少的工具。本实践将介绍求解辐射传输方程的主力方法之一——离散纵标法（Discrete Ordinates Method, $S_N$）。你的核心任务不仅是编写一个求解器，更重要的是通过执行严格的网格与角度加密收敛性研究，来验证你的代码的准确性和可靠性，这是计算科学中一项至关重要的技能 [@problem_id:2529728]。", "problem": "考虑厚度为 $L$ 的均匀平行平板中的稳态、一维、灰体辐射传输，其中包含各向同性散射和等温发射。令 $x \\in [0,L]$ 表示位置，$\\mu \\in [-1,1]$ 表示相对于平板法线的方向余弦。比辐射强度 $I(x,\\mu)$ 满足稳态辐射传输方程 (RTE)\n$$\n\\mu \\frac{d I(x,\\mu)}{dx} + \\sigma_t I(x,\\mu) = \\sigma_a B + \\frac{\\sigma_s}{2} \\phi(x),\n$$\n其中 $\\sigma_t = \\sigma_a + \\sigma_s$ 是总消光系数，$\\sigma_a$ 是吸收系数，$\\sigma_s$ 是散射系数，$B$ 是给定的恒定黑体源（等温、灰体），$\\phi(x)$ 是由下式定义的标量通量\n$$\n\\phi(x) = \\int_{-1}^{1} I(x,\\mu) \\, d\\mu.\n$$\n假设边界为真空（无入射辐射）：对于 $\\mu > 0$，有 $I(0,\\mu) = 0$；对于 $\\mu  0$，有 $I(L,\\mu) = 0$。系数 $\\sigma_a$、$\\sigma_s$ 和 $\\sigma_t$ 的单位为 $\\mathrm{m}^{-1}$，$x$ 和 $L$ 的单位为 $\\mathrm{m}$，$B$ 采用一致的辐射单位。\n\n您的任务是：\n- 使用离散纵标法（也称为 $S_N$ 法）对角度进行离散化，在区间 $[-1,1]$ 上采用阶数为 $N_\\mu$ 的高斯-勒让德求积，其节点为 $\\{\\mu_k\\}_{k=1}^{N_\\mu}$，权重为 $\\{w_k\\}_{k=1}^{N_\\mu}$。\n- 使用包含 $N_x$ 个宽度为 $\\Delta x = L/N_x$ 的单元的均匀网格对空间进行离散化，并使用阶梯特征线格式沿特征线演化强度，该格式通过在每个单元内对源项为分段常数的RTE进行精确积分得到。对于每个方向 $\\mu_k$，在有效体积源 $S_i = \\sigma_a B + \\frac{\\sigma_s}{2} \\phi_i$ 被视为常数的单元内，必须通过求解线性常微分方程的单元内精确解来获得单元平均强度 $\\bar I_{i,k}$，并在扫描方向上，在平板两端施加真空边界条件。对于 $\\mu_k > 0$ 和 $\\mu_k  0$，分别从相应的边界开始进行方向扫描。\n- 通过源迭代耦合各向同性散射的角度：给定 $\\{\\bar I_{i,k}^{(m)}\\}$，更新 $\\phi_i^{(m)} = \\sum_{k=1}^{N_\\mu} w_k \\bar I_{i,k}^{(m)}$，然后更新源项 $S_i^{(m)} = \\sigma_a B + \\frac{\\sigma_s}{2}\\phi_i^{(m)}$，并再次扫描以获得 $\\{\\bar I_{i,k}^{(m+1)}\\}$。迭代直至标量通量变化的无穷范数满足 $\\max_i |\\phi_i^{(m+1)} - \\phi_i^{(m)}|  \\varepsilon$。如果需要，您可以使用固定 $\\lambda \\in (0,1]$ 的简单松弛 $\\phi^{(m+1)} \\leftarrow \\lambda \\phi^{(m+1)} + (1-\\lambda)\\phi^{(m)}$。使用 $\\varepsilon = 10^{-8}$。\n- 通过选择最接近 $x^\\star$ 的单元中心来定义平板中心 $x^\\star = L/2$ 处的标量通量。将 $x^\\star$ 处的角度分辨强度定义为向量 $\\{\\bar I_k^\\star\\}_{k=1}^{N_\\mu}$，该向量汇集了 $x^\\star$ 处所有求积节点的单元平均强度。\n\n进行两项加密研究以构建观测收敛阶 (OOC)。\n- 固定角度阶数的网格加密：固定一个高阶角度求积 $N_\\mu^{\\mathrm{ref}}$ 和一个精细空间参考网格 $N_x^{\\mathrm{ref}}$。对于一系列使用相同 $N_\\mu^{\\mathrm{ref}}$ 的较粗 $N_x$ 值，计算 $x^\\star$ 处相对于精细网格上参考解的误差。使用：\n  - 标量通量误差 $e_\\phi(N_x) = \\big|\\phi^\\star(N_x) - \\phi^\\star(N_x^{\\mathrm{ref}})\\big|$。\n  - 强度误差 $e_I(N_x) = \\left(\\frac{\\sum_{k=1}^{N_\\mu^{\\mathrm{ref}}} w_k \\left(\\bar I_k^\\star(N_x) - \\bar I_k^\\star(N_x^{\\mathrm{ref}})\\right)^2}{\\sum_{k=1}^{N_\\mu^{\\mathrm{ref}}} w_k}\\right)^{1/2}$。\n  - 连续两个网格 $N_x^{(c)}$（较粗）和 $N_x^{(f)}$（较细）之间的观测收敛阶为\n    $$\n    p_x = \\frac{\\ln\\left(e(N_x^{(c)})/e(N_x^{(f)})\\right)}{\\ln\\left(h_x^{(c)}/h_x^{(f)}\\right)}, \\quad h_x = \\frac{L}{N_x}。\n    $$\n  使用列表中最精细的两个网格，分别为 $e_\\phi$ 和 $e_I$ 计算 $p_x$。\n- 固定空间分辨率的角度加密：固定一个精细空间网格 $N_x^{\\mathrm{ref}}$ 和一个高阶角度参考 $N_\\mu^{\\mathrm{ref}}$。对于一系列较粗的 $N_\\mu$，计算 $x^\\star$ 处相对于参考解的误差。使用：\n  - 标量通量误差 $e_\\phi(N_\\mu) = \\big|\\phi^\\star(N_\\mu) - \\phi^\\star(N_\\mu^{\\mathrm{ref}})\\big|$。\n  - 强度误差 $e_I(N_\\mu)$ 定义为关于角度的加权 $L^2$ 范数，首先将粗角度强度 $\\{\\bar I_k^\\star(N_\\mu)\\}$ 从其节点 $\\{\\mu_k\\}$ 插值到参考节点 $\\{\\mu_j^{\\mathrm{ref}}\\}$，然后计算\n    $$\n    e_I(N_\\mu) = \\left(\\frac{\\sum_{j=1}^{N_\\mu^{\\mathrm{ref}}} w_j^{\\mathrm{ref}} \\left(\\tilde I^\\star(\\mu_j^{\\mathrm{ref}}; N_\\mu) - \\bar I_j^\\star(N_\\mu^{\\mathrm{ref}})\\right)^2}{\\sum_{j=1}^{N_\\mu^{\\mathrm{ref}}} w_j^{\\mathrm{ref}}}\\right)^{1/2},\n    $$\n    其中 $\\tilde I^\\star(\\mu_j^{\\mathrm{ref}}; N_\\mu)$ 是粗角度强度作为 $\\mu$ 的函数在 $\\mu_j^{\\mathrm{ref}}$ 处的分段线性插值。\n  - 将角度观测阶定义为\n    $$\n    p_\\mu = \\frac{\\ln\\left(e(N_\\mu^{(c)})/e(N_\\mu^{(f)})\\right)}{\\ln\\left(h_\\mu^{(c)}/h_\\mu^{(f)}\\right)}, \\quad h_\\mu = \\frac{1}{N_\\mu}。\n    $$\n  使用列表中最精细的两个角度集，分别为 $e_\\phi$ 和 $e_I$ 计算 $p_\\mu$。\n\n使用以下两种物理上合理的基准情景（单位为 $\\mathrm{m}$ 和 $\\mathrm{m}^{-1}$，$B$ 的单位为任意但一致的辐射单位）。对于每种情景，执行指定的两项加密研究，并计算四个观测收敛阶：标量通量的空间收敛阶、强度的空间收敛阶、标量通量的角度收敛阶、强度的角度收敛阶。\n- 情景 $\\mathcal{A}$（中等光学厚度，中等散射）：$L = 1$, $\\sigma_t = 2$, $\\sigma_s = 1$, $B = 1$。\n- 情景 $\\mathcal{B}$（光学更厚，散射更强）：$L = 1$, $\\sigma_t = 5$, $\\sigma_s = 3.5$, $B = 1$。\n\n为测试套件使用以下离散化参数：\n- 参考分辨率：$N_x^{\\mathrm{ref}} = 400$，$N_\\mu^{\\mathrm{ref}} = 64$。\n- 固定 $N_\\mu^{\\mathrm{ref}}$ 的网格加密列表：$N_x \\in \\{50, 100, 200\\}$。\n- 固定 $N_x^{\\mathrm{ref}}$ 的角度加密列表：$N_\\mu \\in \\{8, 16, 32\\}$。\n- 迭代容差：$\\varepsilon = 10^{-8}$，并且您可以取松弛因子 $\\lambda = 1$。\n\n您的程序必须：\n- 以数值稳定且自洽的方式实现上述方法。\n- 对于每种情景，计算标量通量和强度的观测空间收敛阶 $p_x$（使用 $N_x$ 列表中的两个最精细网格），以及标量通量和强度的观测角度收敛阶 $p_\\mu$（使用 $N_\\mu$ 列表中的两个最高阶角度求积）。\n- 输出一行，包含一个含 8 个浮点数的列表，顺序如下：\n  - $\\left[p_x^{\\phi}(\\mathcal{A}), p_x^{I}(\\mathcal{A}), p_\\mu^{\\phi}(\\mathcal{A}), p_\\mu^{I}(\\mathcal{A}), p_x^{\\phi}(\\mathcal{B}), p_x^{I}(\\mathcal{B}), p_\\mu^{\\phi}(\\mathcal{B}), p_\\mu^{I}(\\mathcal{B})\\right]$。\n不得打印任何其他文本。由于这些是阶数，它们是无量纲的，因此最终输出中不需要物理单位。\n\n角度说明：方向余弦 $\\mu$ 是无量纲的，不需要角度单位。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $\\left[\\text{result}_1,\\text{result}_2,\\dots\\right]$）。", "solution": "问题陈述已被解析和验证。其被认定为具有科学依据、适定、客观且自洽。它描述了辐射传热领域的一个标准基准问题，并概述了其求解和后续收敛性分析的有效数值方法。因此，该问题被认定为有效。\n\n该问题要求数值求解在具有各向同性散射和等温发射的平行平板中稳态、一维、灰体辐射传输方程 (RTE)。比辐射强度 $I(x, \\mu)$ 的控制方程为：\n$$\n\\mu \\frac{d I(x,\\mu)}{dx} + \\sigma_t I(x,\\mu) = \\sigma_a B + \\frac{\\sigma_s}{2} \\int_{-1}^{1} I(x,\\mu') \\, d\\mu' = S(x)\n$$\n其中 $x \\in [0, L]$ 是空间坐标，$\\mu \\in [-1, 1]$ 是方向余弦，$\\sigma_t$ 是消光系数，$\\sigma_a$ 是吸收系数，$\\sigma_s$ 是散射系数，$B$ 是常数黑体源项，$S(x)$ 是总体积源。平板服从真空边界条件，意味着没有辐射从外部进入：\n$$\nI(0, \\mu) = 0 \\quad \\text{for } \\mu > 0, \\quad \\text{and} \\quad I(L, \\mu) = 0 \\quad \\text{for } \\mu  0.\n$$\n求解方法遵循一种结构化的数值方法，涉及角度和空间的离散化，并通过迭代格式进行耦合。\n\n首先，使用离散纵标（$S_N$）法对角度依赖性进行离散化。源项中的积分由阶数为 $N_\\mu$、节点为 $\\{\\mu_k\\}$、权重为 $\\{w_k\\}$ 的高斯-勒让德求积和代替。这将单个积分-微分方程转化为一个包含 $N_\\mu$ 个常微分方程的耦合系统，每个方程对应一个离散方向 $\\mu_k$：\n$$\n\\mu_k \\frac{d I_k(x)}{dx} + \\sigma_t I_k(x) = \\sigma_a B + \\frac{\\sigma_s}{2} \\sum_{j=1}^{N_\\mu} w_j I_j(x), \\quad k=1, \\dots, N_\\mu\n$$\n其中 $I_k(x) \\equiv I(x, \\mu_k)$。\n\n其次，空间域 $[0, L]$ 被离散化为由 $N_x$ 个单元组成的均匀网格，每个单元的宽度为 $\\Delta x = L/N_x$。采用的数值格式是阶梯特征线法。该方法假设总源项在每个单元 $i$ 内是分段常数，取值为 $S_i$。在此假设下，每个方向 $k$ 和单元 $i$ 的常微分方程可以精确求解。令 $I_{\\text{in},k}$ 为单元入射面的强度。在穿过路径长度 $\\Delta x / |\\mu_k|$ 后，出射面的强度 $I_{\\text{out},k}$ 由下式给出：\n$$\nI_{\\text{out},k} = I_{\\text{in},k} \\exp\\left(-\\frac{\\sigma_t \\Delta x}{|\\mu_k|}\\right) + \\frac{S_i}{\\sigma_t} \\left(1 - \\exp\\left(-\\frac{\\sigma_t \\Delta x}{|\\mu_k|}\\right)\\right)\n$$\n迭代更新所需的量是单元平均强度 $\\bar{I}_{i,k}$。通过将 $I_k(x)$ 的单元内精确解在单元宽度 $\\Delta x$上积分，我们得到以下关系：\n$$\n\\bar{I}_{i,k} = I_{\\text{in},k} \\left(\\frac{1 - \\exp(-\\tau_k)}{\\tau_k}\\right) + \\frac{S_i}{\\sigma_t} \\left(1 - \\frac{1 - \\exp(-\\tau_k)}{\\tau_k}\\right)\n$$\n其中 $\\tau_k = \\sigma_t \\Delta x / |\\mu_k|$ 是沿方向 $\\mu_k$ 的单元光学厚度。这些关系构成了输运扫描的基础。\n\n通过散射源项实现的角度间耦合通过源迭代来解决。算法流程如下：\n1. 初始化所有单元 $i=1, \\dots, N_x$ 的标量通量场 $\\phi_i^{(0)}$（例如，初始化为零）。\n2. 对于迭代 $m = 0, 1, 2, \\dots$：\n   a. 计算逐单元常数源项 $S_i^{(m)} = \\sigma_a B + \\frac{\\sigma_s}{2} \\phi_i^{(m)}$。\n   b. 执行一次输运扫描，以找到新的单元平均强度 $\\bar{I}_{i,k}^{(m+1)}$。对于每个方向 $\\mu_k > 0$，使用真空边界条件 $I(0, \\mu_k)=0$ 从 $x=0$ 扫描到 $x=L$（单元索引从 $i=1$ 到 $N_x$）。对于每个 $\\mu_k  0$，使用 $I(L, \\mu_k)=0$ 从 $x=L$ 扫描到 $x=0$（$i$ 从 $N_x$到 1）。在每个单元中，计算出射面强度，该强度成为扫描方向上一个单元的入射强度，并存储单元平均强度。\n   c. 使用新的强度更新每个单元中的标量通量：$\\phi_i^{\\text{new}} = \\sum_{k=1}^{N_\\mu} w_k \\bar{I}_{i,k}^{(m+1)}$。\n   d. 应用 $\\lambda=1$ 的简单松弛，因此 $\\phi_i^{(m+1)} = \\phi_i^{\\text{new}}$。\n   e. 通过比较新旧标量通量场来检查收敛性：$\\max_i |\\phi_i^{(m+1)} - \\phi_i^{(m)}|  \\varepsilon$。如果未收敛，则从步骤 2a 重复。\n\n最后，执行收敛性分析以确定空间和角度离散化的观测收敛阶 (OOC)。这是通过在一系列逐步加密的网格/求积上运行模拟，并将其与高分辨率参考解进行比较来完成的。OOC $p$ 使用两个连续加密级别（一个较粗 (c)，一个较细 (f)）的解，通过以下公式计算：\n$$\np = \\frac{\\ln(e_c / e_f)}{\\ln(h_c / h_f)}\n$$\n其中 $e$ 是误差范数，$h$ 是离散化参数（$\\Delta x$ 或 $1/N_\\mu$）。对于此问题，加密比 $h_c/h_f$ 总是 $2$。平板中心的标量通量 ($e_\\phi$) 和强度 ($e_I$) 的误差按问题中的规定计算。对于角度加密研究，强度误差的计算需要在计算加权均方根误差之前，将粗角度强度剖面分段线性插值到精细参考角度集上。\n\n提供的Python代码实现了这整个过程。一个主函数 `rte_solver` 封装了源迭代和输运扫描逻辑。主函数 `solve` 协调安排每个物理情景的加密研究，为每个所需的 $(N_x, N_\\mu)$ 组合调用 `rte_solver`，计算误差，并最终计算每个情景所要求的四个OOC值。", "answer": "```python\nimport numpy as np\nfrom numpy.polynomial.legendre import leggauss\n\ndef rte_solver(L, sigma_t, sigma_s, B, Nx, Nmu, tol=1e-8, relax=1.0):\n    \"\"\"\n    Solves the 1D RTE using Discrete Ordinates and Step Characteristics.\n\n    Args:\n        L (float): Slab thickness.\n        sigma_t (float): Total extinction coefficient.\n        sigma_s (float): Scattering coefficient.\n        B (float): Blackbody source term.\n        Nx (int): Number of spatial cells.\n        Nmu (int): Order of Gauss-Legendre quadrature.\n        tol (float): Convergence tolerance for source iteration.\n        relax (float): Relaxation factor for source iteration.\n\n    Returns:\n        tuple: (phi_center, I_center, mu, w)\n            - phi_center (float): Scalar flux at the central cell.\n            - I_center (np.ndarray): Angular intensity at the central cell.\n            - mu (np.ndarray): Quadrature nodes (sorted).\n            - w (np.ndarray): Quadrature weights (sorted).\n    \"\"\"\n    sigma_a = sigma_t - sigma_s\n    dx = L / Nx\n\n    # Get Gauss-Legendre quadrature nodes and weights on [-1, 1]\n    mu, w = leggauss(Nmu)\n    \n    # Sort mu for easier separation and for interpolation later.\n    # Weights must be reordered accordingly.\n    idx_sort = np.argsort(mu)\n    mu = mu[idx_sort]\n    w = w[idx_sort]\n\n    neg_mu_idx = np.where(mu  0)[0]\n    pos_mu_idx = np.where(mu > 0)[0]\n\n    phi = np.zeros(Nx)\n    I_avg = np.zeros((Nx, Nmu))\n\n    # Source Iteration\n    for _ in range(4000):  # Maximum iterations\n        phi_old = np.copy(phi)\n        \n        source = sigma_a * B + 0.5 * sigma_s * phi\n        \n        # Transport Sweep\n        # Forward sweep for mu > 0\n        for k in pos_mu_idx:\n            muk = mu[k]\n            tau_cell = sigma_t * dx / muk\n            \n            if tau_cell  1e-6:\n                exp_term_coeff = 1.0 - tau_cell / 2.0\n            else:\n                exp_term_coeff = (1.0 - np.exp(-tau_cell)) / tau_cell\n            \n            exp_tau = np.exp(-tau_cell)\n            source_term_prop = (1.0 - exp_tau) / sigma_t\n            source_term_avg = (1.0 - exp_term_coeff) / sigma_t\n\n            I_face = 0.0  # BC at x=0\n            for i in range(Nx):\n                I_avg[i, k] = source[i] * source_term_avg + I_face * exp_term_coeff\n                I_face = I_face * exp_tau + source[i] * source_term_prop\n        \n        # Backward sweep for mu  0\n        for k in neg_mu_idx:\n            muk = mu[k]\n            tau_cell = sigma_t * dx / abs(muk)\n            \n            if tau_cell  1e-6:\n                exp_term_coeff = 1.0 - tau_cell / 2.0\n            else:\n                exp_term_coeff = (1.0 - np.exp(-tau_cell)) / tau_cell\n            \n            exp_tau = np.exp(-tau_cell)\n            source_term_prop = (1.0 - exp_tau) / sigma_t\n            source_term_avg = (1.0 - exp_term_coeff) / sigma_t\n\n            I_face = 0.0  # BC at x=L\n            for i in range(Nx - 1, -1, -1):\n                I_avg[i, k] = source[i] * source_term_avg + I_face * exp_term_coeff\n                I_face = I_face * exp_tau + source[i] * source_term_prop\n\n        phi_new = np.dot(I_avg, w)\n        \n        phi = relax * phi_new + (1.0 - relax) * phi_old\n        \n        err = np.max(np.abs(phi - phi_old))\n        if err  tol:\n            break\n    \n    idx_center = int(np.round(Nx / 2.0)) - 1\n    \n    phi_center = phi[idx_center]\n    I_center = I_avg[idx_center, :]\n    \n    return phi_center, I_center, mu, w\n\ndef solve():\n    scenarios = [\n        {'L': 1.0, 'sigma_t': 2.0, 'sigma_s': 1.0, 'B': 1.0},  # Scenario A\n        {'L': 1.0, 'sigma_t': 5.0, 'sigma_s': 3.5, 'B': 1.0}, # Scenario B\n    ]\n\n    Nx_ref = 400\n    Nmu_ref = 64\n    Nx_list = [50, 100, 200]\n    Nmu_list = [8, 16, 32]\n    tol = 1e-8\n\n    all_results = []\n\n    for params in scenarios:\n        L, sigma_t, sigma_s, B = params['L'], params['sigma_t'], params['sigma_s'], params['B']\n\n        # Run reference case for both studies\n        phi_ref, I_ref, mu_ref, w_ref = rte_solver(L, sigma_t, sigma_s, B, Nx_ref, Nmu_ref, tol)\n        sum_w_ref = np.sum(w_ref)\n\n        # --- Mesh refinement study ---\n        errors_phi_x = []\n        errors_I_x = []\n        for Nx in Nx_list:\n            phi_center, I_center, _, _ = rte_solver(L, sigma_t, sigma_s, B, Nx, Nmu_ref, tol)\n            \n            e_phi = abs(phi_center - phi_ref)\n            e_I = np.sqrt(np.sum(w_ref * (I_center - I_ref)**2) / sum_w_ref)\n            \n            errors_phi_x.append(e_phi)\n            errors_I_x.append(e_I)\n\n        p_x_phi = np.log(errors_phi_x[-2] / errors_phi_x[-1]) / np.log(2)\n        p_x_I = np.log(errors_I_x[-2] / errors_I_x[-1]) / np.log(2)\n        \n        # --- Angular refinement study ---\n        errors_phi_mu = []\n        errors_I_mu = []\n        for Nmu in Nmu_list:\n            phi_center, I_center, mu_coarse, _ = rte_solver(L, sigma_t, sigma_s, B, Nx_ref, Nmu, tol)\n            \n            e_phi = abs(phi_center - phi_ref)\n            \n            I_interp = np.interp(mu_ref, mu_coarse, I_center)\n            e_I = np.sqrt(np.sum(w_ref * (I_interp - I_ref)**2) / sum_w_ref)\n            \n            errors_phi_mu.append(e_phi)\n            errors_I_mu.append(e_I)\n\n        p_mu_phi = np.log(errors_phi_mu[-2] / errors_phi_mu[-1]) / np.log(2)\n        p_mu_I = np.log(errors_I_mu[-2] / errors_I_mu[-1]) / np.log(2)\n        \n        all_results.extend([p_x_phi, p_x_I, p_mu_phi, p_mu_I])\n\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "2529728"}, {"introduction": "在前一个数值实践 [@problem_id:2529728] 的基础上，本练习将挑战一个更贴近工程实际的课题：非灰体辐射。你将学习使用谱带模型（band model）来处理辐射物性对光谱的依赖性，这是工程计算中的一种常用技术。本实践还特别强调了计算效率，你将设计并实现一种“共享角度扫描”（shared angular sweep）算法，这是一种在专业辐射计算程序中广泛应用的实用技巧，可以显著提高求解多谱带问题的效率 [@problem_id:2529743]。", "problem": "你的任务是推导、阐明和实现一个逐波段离散纵标法 (DOM) 算法，该算法具有共享角度扫描功能，用于求解平行平板中一维、稳态、无散射的辐射传输方程 (RTE)，并强调光谱特性模型与角度求解器之间的耦合。推导必须从基本守恒定律和经过充分检验的物理事实出发，特别是强度的辐射传输平衡和光谱特性的波段模型抽象；除了那些直接源于基本方程和一致离散化选择的推导外，你不得假设或引用任何预先推导的离散化捷径。\n\n物理模型和假设：\n- 考虑一个无量纲厚度为 $L=1$ 的一维平板，空间坐标为 $x \\in [0,1]$，具有方位角对称性，且无折射率梯度。在一个灰体波段 $b$ 中，沿离散方向余弦 $\\mu$ 的主导辐射传输方程 (RTE) 基于辐射强度发射和吸收之间的基本微分平衡。你必须从以下陈述出发：对于每个波段，强度沿射线路径的变化率等于吸收造成的损失加上发射带来的增益。\n- 不考虑散射，因此只存在吸收和发射。\n- 位于 $x=0$ 的左壁和位于 $x=1$ 的右壁是漫射黑体发射器。对于进入介质的强度，施加与指定壁面温度下的黑体发射一致的边界值。\n- 所有量均为无量纲。特别地，定义一个无量纲的类普朗克发射源函数 $B(T)=T^4$，其中 $T$ 是无量纲温度。没有明确的物理单位。所有要求的输出都是无量纲实数。\n\n光谱特性模型与耦合：\n- 使用波段模型。对于一组由 $b \\in \\{1,\\dots,B\\}$ 索引的 $B$ 个光谱波段，每个波段都有一个恒定的吸收系数 $\\kappa_b \\ge 0$ 和一个非负的普朗克分数权重 $w_b$，使得 $\\sum_{b=1}^B w_b = 1$。\n- 发射的波段源强度与 $w_b B(T)$ 成正比，这意味着光谱模型通过 $w_b$ 将每个波段的温度与发射以不同方式耦合，而角度求解器则沿每个方向 $\\mu$ 使用各自的 $\\kappa_b$ 分别传播每个波段的强度。\n- 你的算法必须实现“共享角度扫描”：对于固定的角度集 $\\{\\mu_m, W_m\\}_{m=1}^{N_\\mu}$，针对给定方向索引 $m$ 的空间扫描只执行一次，同时并发地传输所有波段 $\\{b\\}$ 的强度。这确保了几何流和循环结构的复用，同时通过 $\\kappa_b$ 和 $w_b$ 保留了波段的特异性。\n\n角度离散化和通量：\n- 使用离散纵标法 (DOM)，在 $\\mu \\in [-1,1]$ 上采用 $N_\\mu=8$ 阶的 Gauss–Legendre 求积。将节点记为 $\\mu_m$，权重记为 $W_m$。利用方位角对称性，乘以因子 $2\\pi$ 来计算垂直于壁面的辐射热通量。\n- 左壁处的净向外辐射热通量 $q_L$ 定义为离开和进入壁面的强度之差，在所有波段和离散纵标上进行半球、波段积分和方向加权后的总和。用与上述定义一致的无量纲形式表示 $q_L$。\n\n空间离散化和算法约束：\n- 在 $x \\in [0,1]$ 上使用包含 $N_x=200$ 个单元的均匀空间网格。通过在单元中心评估的分段常数近似来处理每个单元内的发射源。沿每个 $\\mu_m$ 的特征线推进必须与此近似一致。通过取解的正确极限来精确处理 $\\kappa_b=0$ 的边界情况，以避免除以零或未定义表达式。\n- 边界条件：对于在 $x=0$ 处的入射方向（即 $\\mu_m>0$ 的方向），入射强度等于左壁温度下的黑体壁面发射。对于在 $x=1$ 处的入射方向（即 $\\mu_m0$ 的方向），入射强度等于右壁温度下的黑体壁面发射。\n- 温度场 $T(x)$ 是等温或线性的，具体由以下每个测试用例指定。当为线性时，设 $T(x)=T_L+(T_R-T_L)\\,x$，其中 $T_L$ 和 $T_R$ 分别是左壁和右壁的温度。\n\n推导任务：\n- 从波段中发射-吸收平衡的 RTE 陈述出发，推导在源项被近似为单元内分段常数时，能够产生一致的一阶推进更新的沿射线单步解。解释波段参数 $\\kappa_b$ 和 $w_b$ 如何与角度求解器耦合，以及如何在不混合波段输运物理的情况下，通过算法实现共享角度扫描。确保你的推导展示了如何从 DOM 强度组装左壁净通量 $q_L$。\n\n编程任务：\n- 实现一个完整、可运行的程序，该程序：\n  1. 构建具有 $N_\\mu=8$ 个节点和权重的 Gauss–Legendre 求积。\n  2. 构建具有 $N_x=200$ 个单元的均匀网格。\n  3. 对于下述每个测试用例，组装温度场 $T(x)$ 和波段数据 $\\{\\kappa_b\\}$、$\\{w_b\\}$，然后执行共享角度扫描，为每个 $\\mu_m$ 并发地推进所有波段的强度。\n  4. 计算并返回左壁处的无量纲净向外辐射热通量 $q_L$，四舍五入到小数点后六位。\n\n测试套件：\n对于每个案例，提供无量纲的左右壁温度 $(T_L,T_R)$、波段吸收系数 $\\{\\kappa_b\\}$、波段权重 $\\{w_b\\}$ 以及温度分布类型。所有波段权重均满足 $\\sum_b w_b = 1$。\n\n- 案例1（平衡健全性检查）：\n  - $T_L = 1$, $T_R = 1$。\n  - $B=2$, $\\{\\kappa_b\\} = [0.1, 1.0]$, $\\{w_b\\}=[0.4, 0.6]$。\n  - 温度分布：等温。\n- 案例2（中度非灰体，线性梯度）：\n  - $T_L = 2$, $T_R = 1$。\n  - $B=3$, $\\{\\kappa_b\\} = [0.05, 0.5, 5.0]$, $\\{w_b\\}=[0.2, 0.5, 0.3]$。\n  - 温度分布：线性。\n- 案例3（跨波段光学薄极限）：\n  - $T_L = 2$, $T_R = 1$。\n  - $B=2$, $\\{\\kappa_b\\} = [10^{-6}, 10^{-3}]$, $\\{w_b\\}=[0.5, 0.5]$。\n  - 温度分布：线性。\n- 案例4（跨波段光学厚极限）：\n  - $T_L = 2$, $T_R = 1$。\n  - $B=2$, $\\{\\kappa_b\\} = [10.0, 50.0]$, $\\{w_b\\}=[0.3, 0.7]$。\n  - 温度分布：线性。\n- 案例5（混合透明与吸收波段）：\n  - $T_L = 2$, $T_R = 1$。\n  - $B=2$, $\\{\\kappa_b\\} = [0.0, 1.0]$, $\\{w_b\\}=[0.5, 0.5]$。\n  - 温度分布：线性。\n\n要求的最终输出格式：\n- 你的程序必须生成单行输出，其中包含五个结果，以逗号分隔的列表形式封装在方括号中，每个 $q_L$ 四舍五入到小数点后六位，并按案例1到5的顺序排列。例如，打印的行应类似于 [$q_1,q_2,q_3,q_4,q_5$]，其中 $q_i$ 是小数点后有六位的五个浮点数。不应打印任何其他文本。", "solution": "对所述问题进行验证。\n\n**步骤1：提取给定条件**\n- **主导方程**：平行平板中一维、稳态、无散射的辐射传输方程 (RTE)，其基本原理是强度沿射线路径的变化率等于吸收造成的损失加上发射带来的增益。\n- **几何结构**：无量纲厚度为 $L=1$ 的一维平板。空间坐标 $x \\in [0,1]$。\n- **假设**：方位角对称性，无折射率梯度，无散射。\n- **边界**：位于 $x=0$ 和 $x=1$ 的壁面是漫射黑体发射器。入射强度的边界条件由壁面温度 $T_L$ 和 $T_R$ 下的黑体发射决定。\n- **无量纲源项**：类普朗克发射源函数为 $B(T) = T^4$。\n- **光谱模型**：具有 $B$ 个波段的波段模型。对每个波段 $b$，有一个恒定的吸收系数 $\\kappa_b \\ge 0$ 和一个普朗克分数权重 $w_b \\ge 0$，使得 $\\sum_{b=1}^B w_b = 1$。\n- **发射项**：波段 $b$ 中发射强度的源项为 $\\kappa_b w_b B(T(x))$。\n- **角度离散化**：离散纵标法 (DOM)，在 $\\mu \\in [-1,1]$ 上采用 $N_\\mu=8$ 阶的 Gauss-Legendre 求积，节点为 $\\mu_m$，权重为 $W_m$。\n- **空间离散化**：包含 $N_x=200$ 个单元的均匀网格。每个单元内的源项采用分段常数近似，在单元中心处计算。\n- **温度场**：$T(x)$ 是等温的，$T(x)=T_L$，或线性的，$T(x)=T_L+(T_R-T_L)x$。\n- **算法约束**：共享角度扫描，即对于固定的角方向 $\\mu_m$，空间扫描执行一次，同时传输所有波段 $\\{b\\}$ 的强度。\n- **输出**：左壁处的无量纲净向外辐射热通量 $q_L$。其定义为 $q_L = 2\\pi \\sum_{b=1}^B \\sum_{m=1}^{N_\\mu} I_{b,m}(x=0) \\mu_m W_m$。\n- **测试用例**：提供了五个不同的测试用例，指定了 $(T_L, T_R)$、波段参数 $\\{\\kappa_b\\}$、$\\{w_b\\}$ 和温度分布类型。\n\n**步骤2：使用提取的给定条件进行验证**\n该问题具有科学依据，基于作为物理学和工程学中输运理论基石的基本辐射传输方程。这些假设（一维、无散射、波段模型）是为创建可解模型而进行的标准且有效的简化。问题是适定的：它指定了一个常微分方程组，具有完全定义的边界条件、域和材料属性，确保了唯一解的存在。规定的数值方法（DOM、分段常数源）是标准且一致的。语言客观而精确。提供了数值解所需的所有数据，且没有内部矛盾。测试用例涵盖了不同的物理机制（平衡、光学薄/厚、混合），这是一个良好构建问题的标志。\n\n**步骤3：结论与行动**\n问题是**有效的**。将提供一个完整、合理的解决方案。\n\n**推导和求解方法**\n\n令 $I_b(x, \\mu)$ 为光谱波段 $b$ 在空间位置 $x$ 沿方向余弦 $\\mu = \\cos\\theta$ 定义的方向上的辐射强度。问题陈述要求我们从辐射束的能量平衡原理出发。强度 $I_b$ 沿路径 $s$ 的变化率是由吸收造成的损失和发射带来的增益所致。\n$$\n\\frac{dI_b}{ds} = -\\text{吸收} + \\text{发射}\n$$\n在一个无散射的吸收-发射介质中，吸收项为 $-\\kappa_b I_b$，其中 $\\kappa_b$ 是波段 $b$ 的吸收系数。发射项由 $\\kappa_b I_{b, \\text{blackbody}}(T)$ 给出，其中 $I_{b, \\text{blackbody}}(T)$ 是温度为 $T$ 时波段 $b$ 内的黑体强度。问题指定其由 $w_b B(T)$ 给出，其中 $B(T)=T^4$ 是总的无量纲黑体发射功率，而 $w_b$ 是波段权重。因此，发射项为 $\\kappa_b w_b T^4$。主导方程是：\n$$\n\\frac{dI_b}{ds} = -\\kappa_b I_b(x, \\mu) + \\kappa_b w_b T(x)^4\n$$\n对于平行平板介质，路径长度微分与空间坐标的关系为 $ds = dx/\\mu$。代入此关系并应用离散纵标法，仅考虑离散方向 $\\{\\mu_m\\}_{m=1}^{N_\\mu}$，我们得到一个常微分方程组，每个波段 $b$ 和方向 $m$ 对应一个方程：\n$$\n\\mu_m \\frac{dI_{b,m}}{dx} = -\\kappa_b I_{b,m}(x) + \\kappa_b w_b T(x)^4\n$$\n其中 $I_{b,m}(x) \\equiv I_b(x, \\mu_m)$。这个方程可以重排为一阶线性常微分方程的标准形式：\n$$\n\\frac{dI_{b,m}}{dx} + \\frac{\\kappa_b}{\\mu_m} I_{b,m}(x) = \\frac{\\kappa_b}{\\mu_m} w_b T(x)^4\n$$\n为了数值求解此方程，我们将空间域 $x \\in [0,1]$ 离散化为 $N_x$ 个宽度均匀的单元 $\\Delta x = 1/N_x$。设单元 $i$ 的范围从 $x_{i-1/2} = (i-1)\\Delta x$ 到 $x_{i+1/2} = i\\Delta x$。问题指定采用分段常数源近似，即假设源项在每个单元 $i$ 内为常数，其值在单元中心 $x_i = (i-0.5)\\Delta x$ 处计算。设单元 $i$ 中波段 $b$ 的常数源为 $S_{b,i} = w_b T(x_i)^4$。单元 $i$ 内的辐射传输方程简化为：\n$$\n\\frac{dI_{b,m}}{dx} + \\frac{\\kappa_b}{\\mu_m} I_{b,m} = \\frac{\\kappa_b}{\\mu_m} S_{b,i}\n$$\n该方程有精确解。考虑一个 $\\mu_m > 0$ 的扫描，从左侧 ($x_{i-1/2}$) 向右侧 ($x_{i+1/2}$) 推进。解为：\n$$\nI_{b,m}(x) = I_{b,m}(x_{i-1/2}) e^{-\\frac{\\kappa_b}{\\mu_m}(x - x_{i-1/2})} + S_{b,i} \\left(1 - e^{-\\frac{\\kappa_b}{\\mu_m}(x - x_{i-1/2})} \\right)\n$$\n在 $x = x_{i+1/2}$ 处对该解求值，得到基于左侧面强度 $I_{b,m,i-1/2}$ 的单元右侧面强度 $I_{b,m,i+1/2}$ 的推进关系：\n$$\nI_{b,m,i+1/2} = I_{b,m,i-1/2} e^{-\\frac{\\kappa_b \\Delta x}{\\mu_m}} + S_{b,i} \\left(1 - e^{-\\frac{\\kappa_b \\Delta x}{\\mu_m}} \\right) \\quad (\\text{对于 } \\mu_m > 0)\n$$\n类似地，对于 $\\mu_m  0$ 的扫描，我们从右侧 ($x_{i+1/2}$) 向左侧 ($x_{i-1/2}$) 推进。解的形式是类似的，得到更新规则：\n$$\nI_{b,m,i-1/2} = I_{b,m,i+1/2} e^{\\frac{\\kappa_b \\Delta x}{\\mu_m}} + S_{b,i} \\left(1 - e^{\\frac{\\kappa_b \\Delta x}{\\mu_m}} \\right) = I_{b,m,i+1/2} e^{-\\frac{\\kappa_b \\Delta x}{|\\mu_m|}} + S_{b,i} \\left(1 - e^{-\\frac{\\kappa_b \\Delta x}{|\\mu_m|}} \\right) \\quad (\\text{对于 } \\mu_m  0)\n$$\n必须处理 $\\kappa_b = 0$ 的边界情况。在这种情况下，RTE 变为 $\\mu_m dI_{b,m}/dx = 0$，意味着 $I_{b,m}$ 是常数。我们推导的推进公式能正确地捕捉到这个极限。当 $\\kappa_b = 0$ 时，指数项变为 $e^0=1$，而源项 $S_{b,i}$ 在原始 RTE 中乘以 $\\kappa_b$，使其为零。更新公式变为 $I_{\\text{out}} = I_{\\text{in}} \\cdot 1 + 0 \\cdot (1 - 1) = I_{\\text{in}}$，这是正确的。使用标准指数函数的实现自然地处理了这种情况，无需显式分支。\n\n**共享角度扫描**算法的结构旨在利用此公式以提高计算效率。关键在于，对于给定的角度扫描，指数项的几何部分 $\\Delta x/|\\mu_m|$ 对所有波段都是共同的。\n算法如下：\n1. 预先计算 Gauss-Legendre 求积节点 $\\mu_m$ 和权重 $W_m$（$m=1, ..., N_\\mu$）。\n2. 预先计算单元中心温度 $T(x_i)$（$i=1, ..., N_x$）。\n3. 初始化左壁的净通量 $q_L = 0$。\n4. 遍历每个离散纵标 $m = 1, ..., N_\\mu$。\n    a. 如果 $\\mu_m > 0$（正向扫描）：\n        i. 根据边界条件，定义左壁（$x=0$）处所有波段 $b=1, ..., B$ 的初始强度向量：$\\mathbf{I}_{\\text{in}} = \\{w_b T_L^4\\}_{b=1}^B$。\n        ii. 将这些出射光线对壁面通量的贡献加入：$q_L \\leftarrow q_L + 2\\pi \\mu_m W_m \\sum_{b=1}^B (w_b T_L^4)$。由于 $\\sum w_b = 1$，这可以简化为 $q_L \\leftarrow q_L + 2\\pi \\mu_m W_m T_L^4$。\n        iii. 注意：对于此问题，我们只需要壁面处的通量，因此对于 $\\mu_m > 0$ 的情况，无需在整个域内进行推进。\n    b. 如果 $\\mu_m  0$（反向扫描）：\n        i. 定义右壁（$x=1$）处所有波段的初始强度向量：$\\mathbf{I}_{\\text{current}} = \\{w_b T_R^4\\}_{b=1}^B$。\n        ii. 从 $i=N_x$ 向下到 $1$ 反向遍历空间单元。\n            - 计算单元中心 $x_i$ 处所有波段的源项向量：$\\mathbf{S}_i = \\{w_b T(x_i)^4\\}_{b=1}^B$。\n            - 计算所有波段的透射因子向量：$\\mathbf{T} = \\{\\exp(-\\kappa_b \\Delta x/|\\mu_m|)\\}_{b=1}^B$。\n            - 同时更新所有波段的强度向量：$\\mathbf{I}_{\\text{current}} \\leftarrow \\mathbf{I}_{\\text{current}} \\odot \\mathbf{T} + \\mathbf{S}_i \\odot (1-\\mathbf{T})$，其中 $\\odot$ 是逐元素乘积。\n        iii. 循环结束后，$\\mathbf{I}_{\\text{current}}$ 包含当前方向 $\\mu_m$ 到达左壁的强度 $\\{I_{b,m}(0)\\}_{b=1}^B$。\n        iv. 将这些入射光线对壁面通量的贡献加入：$q_L \\leftarrow q_L + 2\\pi \\mu_m W_m \\sum_{b=1}^B I_{b,m}(0)$。\n\n左壁处的净向外辐射热通量 $q_L$ 定义为强度在所有立体角上按方向余弦加权的积分。在 DOM 框架下，这表示为：\n$$\nq_L = q(x=0) = 2\\pi \\sum_{b=1}^B \\int_{-1}^1 I_b(0, \\mu) \\mu \\, d\\mu \\approx 2\\pi \\sum_{b=1}^B \\sum_{m=1}^{N_\\mu} I_{b,m}(0) \\mu_m W_m\n$$\n我们可以重排求和顺序以与算法对齐：\n$$\nq_L = 2\\pi \\sum_{m=1}^{N_\\mu} \\mu_m W_m \\left( \\sum_{b=1}^B I_{b,m}(0) \\right)\n$$\n对于 $\\mu_m > 0$，$I_{b,m}(0) = w_b T_L^4$（进入介质的强度的边界条件）。对于 $\\mu_m  0$，$I_{b,m}(0)$ 是从反向扫描计算出的值。上述算法正确地累加了这些项。\n这就完成了一个与所有规定约束一致的数值稳定且高效的算法的推导。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D non-scattering RTE using the Discrete Ordinates Method\n    with shared angular sweeps for multiple spectral bands.\n    \"\"\"\n\n    # --- Problem Constants ---\n    L = 1.0  # Nondimensional slab thickness\n    N_x = 200  # Number of spatial cells\n    N_mu = 8  # Order of Gauss-Legendre quadrature\n\n    # --- Setup Mesh and Quadrature ---\n    dx = L / N_x\n    x_centers = np.linspace(dx / 2, L - dx / 2, N_x)\n    \n    # Gauss-Legendre quadrature nodes (mu) and weights (W) for integral on [-1, 1]\n    mu, W = np.polynomial.legendre.leggauss(N_mu)\n\n    # --- Test Cases ---\n    test_cases = [\n        # Case 1: Equilibrium sanity check\n        {'T_L': 1.0, 'T_R': 1.0, 'kappa_b': [0.1, 1.0], 'w_b': [0.4, 0.6], 'profile': 'isothermal'},\n        # Case 2: Moderate non-gray, linear gradient\n        {'T_L': 2.0, 'T_R': 1.0, 'kappa_b': [0.05, 0.5, 5.0], 'w_b': [0.2, 0.5, 0.3], 'profile': 'linear'},\n        # Case 3: Optically thin limit across bands\n        {'T_L': 2.0, 'T_R': 1.0, 'kappa_b': [1e-6, 1e-3], 'w_b': [0.5, 0.5], 'profile': 'linear'},\n        # Case 4: Optically thick limit across bands\n        {'T_L': 2.0, 'T_R': 1.0, 'kappa_b': [10.0, 50.0], 'w_b': [0.3, 0.7], 'profile': 'linear'},\n        # Case 5: Mixed transparent and absorbing bands\n        {'T_L': 2.0, 'T_R': 1.0, 'kappa_b': [0.0, 1.0], 'w_b': [0.5, 0.5], 'profile': 'linear'},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        T_L = case['T_L']\n        T_R = case['T_R']\n        kappa_b = np.array(case['kappa_b'])\n        w_b = np.array(case['w_b'])\n        \n        # --- Temperature Field ---\n        if case['profile'] == 'isothermal':\n            T_centers = np.full(N_x, T_L)\n        else: # linear\n            T_centers = T_L + (T_R - T_L) * x_centers\n        \n        # --- Nondimensional Source Function B(T) = T^4 ---\n        B_centers = T_centers**4\n\n        # --- Radiative Flux Calculation ---\n        q_L = 0.0\n\n        # Loop over all discrete ordinates (angles)\n        for m in range(N_mu):\n            mu_m = mu[m]\n            W_m = W[m]\n\n            if mu_m > 0:\n                # Forward sweep (x=0 to x=1)\n                # Rays leaving the left wall (x=0) into the medium.\n                # Intensity is prescribed by the black wall boundary condition.\n                # I_b(0) = w_b * B(T_L) = w_b * T_L^4\n                # We can sum over bands using sum(w_b) = 1\n                I_sum_at_wall = T_L**4\n                q_L += 2 * np.pi * mu_m * W_m * I_sum_at_wall\n            \n            else: # mu_m  0\n                # Backward sweep (x=1 to x=0)\n                # Initialize intensity vector for all bands at the right wall (x=1).\n                I_b_current = w_b * (T_R**4)\n                \n                # March across the domain from right to left.\n                # This is a shared angular sweep: one spatial loop updates all bands.\n                for i in range(N_x - 1, -1, -1):\n                    # Source term for all bands at cell center i\n                    S_b = w_b * B_centers[i]\n                    \n                    # Transmission term, vectorized for all bands\n                    # The formulation is stable for kappa_b = 0\n                    transmittance = np.exp(-kappa_b * dx / abs(mu_m))\n                    \n                    # Update intensity for all bands\n                    I_b_current = I_b_current * transmittance + S_b * (1 - transmittance)\n                \n                # I_b_current now holds the intensities at x=0.\n                # Sum intensities over all bands for this direction.\n                I_sum_at_wall = np.sum(I_b_current)\n                q_L += 2 * np.pi * mu_m * W_m * I_sum_at_wall\n        \n        results.append(f\"{q_L:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2529743"}]}