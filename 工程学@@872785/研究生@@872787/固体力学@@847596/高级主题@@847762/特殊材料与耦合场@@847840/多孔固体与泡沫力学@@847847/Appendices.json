{"hands_on_practices": [{"introduction": "多孔材料的力学行为由其微观结构决定。对于开孔泡沫，当其相对密度较低时，其宏观力学响应主要由单元壁（支柱）的弯曲主导。本练习将指导你使用能量法，这是一个从第一性原理出发，将宏观应变能密度与微观尺度下所有支柱的弯曲应变能联系起来的强大工具。通过这个推导，你将掌握建立细胞固体宏观刚度与相对密度之间幂律关系的核心方法 [@problem_id:2660447]。", "problem": "一种各向同性开孔泡沫被建模为一个由完全相同、细长的棱柱形支柱组成的空间填充网络，支柱具有圆形截面，半径为 $r$，长度为 $l$。该泡沫由一种线性弹性各向同性固体材料制成，其杨氏模量为 $E_{s}$，剪切模量为 $G_{s}$，泊松比为 $\\nu_{s}$。该网络是随机的，但在统计上是各向同性的。在小应变极限下，其在简单剪切作用下的宏观变形由单元边（支柱）的弯曲主导。假设支柱是细长的，$r \\ll l$，因此欧拉-伯努利梁理论适用于支柱的弯曲分析。设单位体积内的支柱数量为 $n_{e} = C_{n}/l^{3}$，其中 $C_{n}$ 是一个反映连接性和取向统计的无量纲常数。设泡沫的相对密度为 $\\bar{\\rho} = C_{\\rho}(A/l^{2})$，其中 $A = \\pi r^{2}$，$C_{\\rho}$ 是一个考虑了共用边和节点体积的无量纲几何常数。\n\n使用第一性原理能量论证，将宏观应变能密度与支柱弯曲能之和相等，推导出宏观剪切模量 $G$ 随相对密度变化的标度关系，其形式为 $G/G_{s} \\sim \\alpha \\,\\bar{\\rho}^{n}$，其中 $\\alpha$ 是一个无量纲前置因子，可以表示为 $C_{n}$、$C_{\\rho}$ 和 $\\nu_{s}$ 的函数，而 $n$ 是一个指数。您可以将取向平均的效应视为只贡献了量级为1的无量纲因子，这些因子可以被吸收到 $C_{n}$ 中。请明确说明由宏观剪切应变 $\\gamma$ 在支柱中引起的曲率的中间标度关系，以及单个支柱的弯曲应变能的中间标度关系。然后，讨论您得到的 $G$ 的指数 $n$ 与同一泡沫中宏观杨氏模量 $E$ 随 $\\bar{\\rho}$ 变化的标度关系所对应的指数相比，是相等、更大还是更小，并从相同的第一性原理角度证明您的结论。\n\n最终答案请仅提供指数 $n$，它是一个没有单位的精确整数。", "solution": "首先验证问题，确认其在科学上是合理的、提法明确且客观的。这是一个多孔固体力学领域的标准问题。我们可以开始求解。\n\n推导基于能量平衡原理，即储存在泡沫代表性体积中的宏观应变能密度等于该体积内所有单个支柱储存的应变能之和。\n\n设泡沫承受宏观简单剪切应变 $\\gamma$。宏观弹性应变能密度 $U$ 由下式给出：\n$$U = \\frac{1}{2} G \\gamma^2$$\n其中 $G$ 是泡沫的宏观剪切模量。\n\n该宏观能量在微观层面通过构成泡沫的支柱的变形来储存。问题指出，主导的变形机制是弯曲。宏观应变 $\\gamma$ 会在支柱末端引起横向挠度 $\\delta$。对于长度为 $l$ 的支柱，该挠度与应变和支柱长度成线性比例关系：\n$$\\delta \\propto \\gamma l$$\n此挠度导致支柱弯曲。根据欧拉-伯努利梁理论，细长梁的曲率 $\\kappa$ 与其横向挠度有关。对于长度 $l$ 上的特征挠度 $\\delta$，曲率的标度关系为：\n$$\\kappa \\propto \\frac{\\delta}{l^2}$$\n代入 $\\delta$ 的标度关系，我们得到第一个要求的中间标度关系，即支柱曲率的标度关系：\n$$\\kappa \\propto \\frac{\\gamma l}{l^2} = \\frac{\\gamma}{l}$$\n储存在单个弹性支柱中的弯曲应变能 $U_{strut}$ 由下式给出：\n$$U_{strut} = \\frac{1}{2} \\int_{0}^{l} E_s I_s \\kappa(x)^2 dx$$\n其中 $E_s$ 是制造泡沫的固体材料的杨氏模量，$I_s$ 是支柱截面的截面二次矩。假设沿长度 $l$ 的平均曲率为 $\\kappa$，则每个支柱的应变能标度关系为：\n$$U_{strut} \\propto E_s I_s \\kappa^2 l$$\n这是第二个要求的中间标度关系。代入 $\\kappa$ 的标度关系：\n$$U_{strut} \\propto E_s I_s \\left(\\frac{\\gamma}{l}\\right)^2 l = \\frac{E_s I_s \\gamma^2}{l}$$\n泡沫的单位体积总应变能 $U_{total}$ 是单个支柱的能量与单位体积内支柱数量 $n_e$ 的乘积。根据题目要求，任何取向平均效应都被吸收到无量纲常数中。\n$$U_{total} = n_e U_{strut} \\propto n_e \\frac{E_s I_s \\gamma^2}{l}$$\n令宏观与微观能量密度相等，$U = U_{total}$：\n$$\\frac{1}{2} G \\gamma^2 \\propto n_e \\frac{E_s I_s \\gamma^2}{l}$$\n求解宏观剪切模量 $G$ 可得：\n$$G \\propto \\frac{n_e E_s I_s}{l}$$\n现在，我们引入所提供的几何参数。支柱的数密度为 $n_e = C_n/l^3$。支柱具有半径为 $r$ 的圆形截面，其截面二次矩为 $I_s = \\frac{\\pi r^4}{4}$。因此，$I_s \\propto r^4$。将这些代入 $G$ 的表达式中：\n$$G \\propto \\left(\\frac{C_n}{l^3}\\right) E_s \\frac{r^4}{l} = C_n E_s \\left(\\frac{r}{l}\\right)^4$$\n最后一步是用泡沫的相对密度 $\\bar{\\rho}$ 来表示此标度关系。我们已知 $\\bar{\\rho} = C_{\\rho}(A/l^2)$，其中 $A=\\pi r^2$。这得出：\n$$\\bar{\\rho} = C_{\\rho} \\pi \\left(\\frac{r}{l}\\right)^2$$\n这意味着 $(r/l)^2 \\propto \\bar{\\rho}$，因此 $(r/l)^4 \\propto \\bar{\\rho}^2$。\n将此关系代入我们关于 $G$ 的表达式中：\n$$G \\propto E_s \\bar{\\rho}^2$$\n问题要求以 $G/G_s$ 的形式给出标度关系。使用各向同性弹性固体的关系式 $E_s = 2G_s(1+\\nu_s)$：\n$$G \\propto 2G_s(1+\\nu_s)\\bar{\\rho}^2$$\n两边同除以 $G_s$，我们得到最终的标度形式：\n$$\\frac{G}{G_s} \\propto (1+\\nu_s)\\bar{\\rho}^2$$\n将其与指定形式 $G/G_s \\sim \\alpha \\bar{\\rho}^n$ 进行比较，我们可以确定指数 $n=2$。前置因子 $\\alpha$ 是一个依赖于 $C_n$、$C_\\rho$ 和 $\\nu_s$ 的无量纲常数。\n\n接下来，我们必须将此指数与决定宏观杨氏模量 $E$ 标度关系的指数进行比较。在宏观单轴应变 $\\varepsilon$ 下对 $E$ 的分析是类似的。宏观应变能密度为 $U_E = \\frac{1}{2}E\\varepsilon^2$。变形机制仍然是支柱弯曲。支柱末端挠度现在由应变 $\\varepsilon$ 驱动，因此 $\\delta \\propto \\varepsilon l$。后续步骤完全相同，只是用 $\\varepsilon$ 替换 $\\gamma$。\n支柱曲率的标度关系为 $\\kappa \\propto \\varepsilon/l$。支柱弯曲能的标度关系为 $U_{strut} \\propto E_s I_s \\varepsilon^2/l$。总能量密度的标度关系为 $U_{total} \\propto n_e E_s I_s \\varepsilon^2/l$。\n将 $\\frac{1}{2}E\\varepsilon^2$ 与 $U_{total}$ 相等可得：\n$$E \\propto \\frac{n_e E_s I_s}{l}$$\n这与为 $G$ 推导出的比例关系相同。因此，整个后续推导过程同样成立，得出：\n$$E \\propto E_s \\left(\\frac{r}{l}\\right)^4 \\propto E_s \\bar{\\rho}^2$$\n杨氏模量 $E$ 的标度指数也是 $n=2$。\n因此，剪切模量 $G$ 的指数 $n$ 等于杨氏模量 $E$ 的相应指数。这种相等关系的根本原因在于，如问题所述，支柱弯曲是共同的主导变形机制。对于任何由支柱弯曲主导泡沫弹性响应的加载条件（剪切、拉伸、压缩），宏观模量都将与几何因子 $(r/l)^4$ 成标度关系，而这又对应于与相对密度的平方 $\\bar{\\rho}^2$ 成标度关系。", "answer": "$$\\boxed{2}$$", "id": "2660447"}, {"introduction": "虽然弯曲主导是许多常见泡沫的特征，但它并非最高效的承载机制。通过改变微观结构的拓扑构型，我们可以将力从弯曲传递转变为轴向拉伸或压缩传递，从而显著提高材料的刚度和强度。本练习要求你将一个不稳定的弯曲主导晶格，通过增加支撑构件改造成一个拉伸主导的稳定桁架结构，并推导其刚度和强度随相对密度的标度律指数。这个过程将深刻揭示“结构决定性能”这一核心设计原则 [@problem_id:2660484]。", "problem": "一个由杨氏模量为 $E_{s}$、屈服强度为 $\\sigma_{ys}$ 的线性弹性-理想塑性固体材料制成的周期性开孔晶格，是通过重复一个边长为 $L$ 的立方晶胞构建的。该晶胞包含截面为 $t \\times t$ 的细长棱柱形杆件，其中 $t \\ll L$。节点被理想化为完美销接，晶格沿一个主轴承受微小的单轴应变 $\\epsilon$。相对密度为 $\\bar{\\rho} = \\rho^{*}/\\rho_{s}$，您可以假设 $\\bar{\\rho} \\ll 1$。基准结构是弯曲主导的：在施加的宏观应变下，杆件主要承受弯曲和剪切，而不是轴向拉伸。\n\n要求您通过纯几何修改将该结构转换为拉伸主导结构，而不改变标称杆件长度尺度 $L$ 或杆件厚度与 $L$ 的标度关系。请提出一个具体的修改方案，使晶胞成为静定的（三角化的），从而在施加的宏观应变下，杆件作为二力杆工作。并论证所增加的杆件可以采用相同的厚度尺度 $t$，使得相对密度继续按 $\\bar{\\rho} \\sim (t/L)^{2}$ 的关系标度，直至一个量级为1的几何相关常数。\n\n然后，仅使用基本的梁和桁架力学，推导幂律关系\n$$\n\\frac{E^{*}}{E_{s}} \\sim C_{E}\\,\\bar{\\rho}^{\\,n_{E}}, \\qquad \\frac{\\sigma^{*}}{\\sigma_{ys}} \\sim C_{\\sigma}\\,\\bar{\\rho}^{\\,n_{\\sigma}},\n$$\n中，基准弯曲主导结构和您修改后的拉伸主导结构的标度指数 $n_{E}$ 和 $n_{\\sigma}$。其中 $C_{E}$ 和 $C_{\\sigma}$ 是不依赖于 $\\bar{\\rho}$ 的几何相关常数。在推导过程中，您可以使用以下来自基本结构力学的经过充分验证的结论：对于长度为 $L$、截面积为 $A \\sim t^{2}$、截面二次矩为 $I \\sim t^{4}$ 的细长杆件，其轴向刚度标度为 $k_{\\text{axial}} \\sim E_{s} A / L$，弯曲刚度标度为 $k_{\\text{bend}} \\sim E_{s} I / L^{3}$，轴向屈服力标度为 $F_{y,\\text{axial}} \\sim \\sigma_{ys} A$，弯曲屈服力矩标度为 $M_{y} \\sim \\sigma_{ys} t^{3}$。请在晶胞尺度上使用能量或力平衡论证，并利用定义 $\\bar{\\rho} \\sim V_{\\text{solid}}/V_{\\text{cell}}$（其中 $V_{\\text{solid}} \\sim N A L$，$N$ 为与连接性相关的常数）来建立 $(t/L)$ 与 $\\bar{\\rho}$ 之间的关系。\n\n最后，仅报告修改后的拉伸主导结构的指数，形式为有序对 $[n_{E}^{\\text{new}},\\,n_{\\sigma}^{\\text{new}}]$。请以行矩阵的形式提供您的最终答案。不需要进行数值四舍五入。最终答案必须是无量纲的。", "solution": "在尝试解答之前，对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n-   材料：线性弹性-理想塑性固体，杨氏模量为 $E_{s}$，屈服强度为 $\\sigma_{ys}$。\n-   晶格：周期性开孔，基于边长为 $L$ 的立方晶胞。\n-   杆件：细长棱柱形，方形截面 $t \\times t$，且 $t \\ll L$。\n-   节点：理想化为完美销接。\n-   载荷：沿一个主轴的微小单轴应变 $\\epsilon$。\n-   相对密度：$\\bar{\\rho} = \\rho^{*}/\\rho_{s} \\ll 1$。\n-   基准结构：弯曲主导。\n-   任务1：提出一个几何修改方案，以创建一个静定的拉伸主导结构，而不改变标称杆件长度尺度 $L$ 或杆件厚度 $t$ 的标度关系。论证相对密度标度关系 $\\bar{\\rho} \\sim (t/L)^{2}$。\n-   任务2：根据关系式 $\\frac{E^{*}}{E_{s}} \\sim C_{E}\\,\\bar{\\rho}^{\\,n_{E}}$ 和 $\\frac{\\sigma^{*}}{\\sigma_{ys}} \\sim C_{\\sigma}\\,\\bar{\\rho}^{\\,n_{\\sigma}}$，推导两种结构的标度指数 $n_{E}$ 和 $n_{\\sigma}$。\n-   提供的标度律：\n    -   轴向刚度：$k_{\\text{axial}} \\sim E_{s} A / L$，其中 $A \\sim t^{2}$。\n    -   弯曲刚度：$k_{\\text{bend}} \\sim E_{s} I / L^{3}$，其中 $I \\sim t^{4}$。\n    -   轴向屈服力：$F_{y,\\text{axial}} \\sim \\sigma_{ys} A$。\n    -   弯曲屈服力矩：$M_{y} \\sim \\sigma_{ys} t^{3}$。\n-   相对密度标度：$\\bar{\\rho} \\sim V_{\\text{solid}}/V_{\\text{cell}}$，其中 $V_{\\text{solid}} \\sim N A L$。\n-   最终答案要求：将修改后结构的指数 $[n_{E}^{\\text{new}},\\,n_{\\sigma}^{\\text{new}}]$ 以行矩阵形式报告。\n\n**步骤2：验证**\n问题科学上基于蜂窝固体力学这一成熟领域。问题提法恰当、客观且内部一致。理想销接和细长杆件等假设是晶格结构理论分析中的标准简化。问题提供了进行所需推导的全部必要信息。不存在矛盾、歧义或事实错误。\n\n**步骤3：结论**\n问题有效。将提供解答。\n\n问题要求对一个基准的弯曲主导结构进行修改，使其变为拉伸主导。基准结构是一个边长为 $L$ 的简单立方晶格，其12条边上是销接杆件。这样的结构是一个机构；在载荷作用下，其方形面会发生剪切，迫使杆件弯曲。这就是其弯曲主导行为的根源。\n\n要将其转换为拉伸主导结构，必须对晶胞进行三角化，以创建一个静定桁架。一个简单有效的修改是增加支撑杆件。根据 Maxwell 准则，对于一个有 $j$ 个节点的3D销接框架，其稳定性（静定）需要 $b = 3j - 6$ 个杆件。立方晶胞有 $j=8$ 个节点，因此需要 $b = 3(8) - 6 = 18$ 个杆件。初始晶胞有12个杆件。我们必须增加 $18 - 12 = 6$ 个杆件。这可以通过在立方体的6个面上各增加一根对角杆件来实现。这些增加的杆件长度为 $\\sqrt{2}L$，与标称长度尺度 $L$ 处于同一量级。最终得到的结构是一个刚性框架，其中载荷由杆件中的轴向力承载。\n\n我们必须验证相对密度标度关系是否保持不变。相对密度 $\\bar{\\rho}$ 是固体材料体积与晶胞总体积之比，即 $\\bar{\\rho} = V_{\\text{solid}}/V_{\\text{cell}}$。\n晶胞的体积为 $V_{\\text{cell}} = L^3$。\n假设所有杆件具有相同的截面积 $A \\sim t^2$，则修改后晶胞中的固体体积是原有的12根边杆和6根新增的面-对角杆的体积之和：\n$$V_{\\text{solid}} = 12 \\cdot (A \\cdot L) + 6 \\cdot (A \\cdot \\sqrt{2}L) = (12+6\\sqrt{2}) A L$$\n因此，相对密度为：\n$$\\bar{\\rho} = \\frac{(12+6\\sqrt{2}) A L}{L^3} \\sim \\frac{(12+6\\sqrt{2}) t^2 L}{L^3} = (12+6\\sqrt{2}) \\left(\\frac{t}{L}\\right)^2$$\n因此，相对密度按 $\\bar{\\rho} \\sim (t/L)^2$ 进行标度。与基准情况相比，几何前置因子发生了变化，但幂律依赖关系是相同的。这证实了假设的有效性，并为推导提供了关键关系：\n$$\\frac{t}{L} \\sim \\bar{\\rho}^{\\,1/2}$$\n\n现在，我们推导两种结构的标度指数。宏观杨氏模量为 $E^* = \\sigma^*/\\epsilon$，宏观屈服强度为 $\\sigma^*_y$。\n\n**基准弯曲主导结构**\n\n1.  **等效模量, $E^*$**：\n    宏观应力和应变通过 $\\sigma^* \\sim F/L^2$ 和 $\\epsilon \\sim \\delta/L$ 与晶胞层面的力 $F$ 和位移 $\\delta$ 相关联。这得到 $E^* = \\sigma^*/\\epsilon \\sim F/(L\\delta)$。晶胞的总刚度为 $K_{cell} = F/\\delta$，所以 $E^* \\sim K_{cell}/L$。\n    对于弯曲主导的结构，晶胞的刚度由其组成杆件的弯曲刚度决定。单个杆件抵抗横向载荷的刚度为 $k_{bend} \\sim E_s I / L^3$。晶胞刚度与此同量级，即 $K_{cell} \\sim k_{bend}$。\n    因此，$E^* \\sim \\frac{k_{bend}}{L} \\sim \\frac{E_s I / L^3}{L} = \\frac{E_s I}{L^4}$。\n    考虑到截面二次矩 $I \\sim t^4$，我们得到：\n    $$E^* \\sim E_s \\frac{t^4}{L^4} = E_s \\left(\\frac{t}{L}\\right)^4$$\n    代入 $(t/L) \\sim \\bar{\\rho}^{\\,1/2}$：\n    $$\\frac{E^*}{E_s} \\sim \\left(\\bar{\\rho}^{\\,1/2}\\right)^4 = \\bar{\\rho}^{\\,2}$$\n    因此，对于弯曲主导的情况，指数为 $n_E = 2$。\n\n2.  **等效屈服强度, $\\sigma^*_y$**：\n    当杆件发生塑性屈服时，结构失效。在这种情况下，当杆件中的弯矩达到屈服力矩 $M_y \\sim \\sigma_{ys} t^3$ 时，塑性铰形成，从而引发屈服。杆件中的弯矩通过 $M \\sim F_{strut}L$ 与作用在其上的横向力 $F_{strut}$ 相关。屈服时，力为 $F_{strut,y} \\sim M_y/L \\sim \\sigma_{ys}t^3/L$。作用在晶胞面上的宏观力与此同量级，即 $F \\sim F_{strut,y}$。\n    那么，宏观屈服应力为：\n    $$\\sigma^*_y \\sim \\frac{F}{L^2} \\sim \\frac{\\sigma_{ys}t^3/L}{L^2} = \\sigma_{ys} \\left(\\frac{t}{L}\\right)^3$$\n    代入 $(t/L) \\sim \\bar{\\rho}^{\\,1/2}$：\n    $$\\frac{\\sigma^*_y}{\\sigma_{ys}} \\sim \\left(\\bar{\\rho}^{\\,1/2}\\right)^3 = \\bar{\\rho}^{\\,3/2}$$\n    因此，对于弯曲主导的情况，指数为 $n_\\sigma = 3/2$。\n\n**修改后的拉伸主导结构**\n\n1.  **等效模量, $E^*_{new}$**：\n    在三角化的、拉伸主导的结构中，变形通过杆件的轴向拉伸和压缩发生。典型杆件中的轴向应变 $\\epsilon_{strut}$ 与宏观应变成正比，$\\epsilon_{strut} \\sim \\epsilon$。\n    杆件中的轴向力为 $F_{strut} = \\epsilon_{strut} \\cdot (E_s A)$。根据节点的力平衡，宏观应力 $\\sigma^*$ 与杆件中的应力成正比，$\\sigma^* \\sim F_{strut}/L^2$。\n    $$\\sigma^* \\sim \\frac{\\epsilon_{strut} E_s A}{L^2} \\sim \\frac{\\epsilon E_s A}{L^2}$$\n    等效模量为 $E^*_{new} = \\sigma^*/\\epsilon$：\n    $$E^*_{new} \\sim \\frac{\\epsilon E_s A / L^2}{\\epsilon} = E_s \\frac{A}{L^2}$$\n    考虑到截面积 $A \\sim t^2$：\n    $$E^*_{new} \\sim E_s \\left(\\frac{t}{L}\\right)^2$$\n    代入 $(t/L)^2 \\sim \\bar{\\rho}$：\n    $$\\frac{E^*_{new}}{E_s} \\sim \\bar{\\rho}$$\n    因此，对于新的拉伸主导结构，指数为 $n_{E}^{\\text{new}} = 1$。\n\n2.  **等效屈服强度, $\\sigma^*_{y,new}$**：\n    当杆件中的轴向力达到轴向屈服力 $F_{y,axial} \\sim \\sigma_{ys} A$ 时，发生失效。\n    宏观屈服应力 $\\sigma^*_{y,new}$ 对应于此情况发生时的宏观应力。根据力平衡，$\\sigma^*_{y,new} \\sim F_{y,axial}/L^2$。\n    $$\\sigma^*_{y,new} \\sim \\frac{\\sigma_{ys} A}{L^2}$$\n    考虑到 $A \\sim t^2$：\n    $$\\sigma^*_{y,new} \\sim \\sigma_{ys} \\left(\\frac{t}{L}\\right)^2$$\n    代入 $(t/L)^2 \\sim \\bar{\\rho}$：\n    $$\\frac{\\sigma^*_{y,new}}{\\sigma_{ys}} \\sim \\bar{\\rho}$$\n    因此，对于新的拉伸主导结构，指数为 $n_{\\sigma}^{\\text{new}} = 1$。\n\n所要求的修改后的拉伸主导结构的指数为 $[n_{E}^{\\text{new}}, n_{\\sigma}^{\\text{new}}]$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  1\n\\end{pmatrix}\n}\n$$", "id": "2660484"}, {"introduction": "理论推导为我们理解弯曲主导和拉伸主导行为提供了标度律上的区别，但在实际分析中，我们需要一种定量的方法来诊断变形模式。本练习将引导你使用有限元方法（FEM）对一个周期性单元进行建模，并通过计算轴向拉伸和弯曲变形所存储的弹性能的比例，来确定其主导的变形机制。这不仅能巩固你对不同变形模式的理解，还能让你获得应用计算工具解决多孔材料力学问题的宝贵实践经验 [@problem_id:2660448]。", "problem": "您必须编写一个完整、可运行的程序，该程序使用有限元法 (FEM) 对一个二维周期性梁格单胞进行建模，并计算在给定的宏观应变下，储存在轴向与弯曲变形模式中的弹性势能的比例。您的程序应以最小势能原理为基本依据，且必须通过在配对边界上施加波动场相等的条件来实现周期性边界条件。对于每个指定的测试用例，程序必须返回一个浮点数，该浮点数等于轴向弹性势能与总弹性势能之比，以小数形式表示。\n\n单胞是一个边长为 $L$ 米的正方形。梁网络由以下节点组成（坐标单位为米）：左中点 $\\left(0,\\frac{L}{2}\\right)$、右中点 $\\left(L,\\frac{L}{2}\\right)$、底中点 $\\left(\\frac{L}{2},0\\right)$、顶中点 $\\left(\\frac{L}{2},L\\right)$ 和中心点 $\\left(\\frac{L}{2},\\frac{L}{2}\\right)$。基本拓扑结构包含四根欧拉-伯努利梁：左中点到中心点、右中点到中心点、底中点到中心点以及顶中点到中心点。在某些测试用例中，还存在两根额外的对角梁：底中点到右中点和左中点到顶中点。所有梁均为直棱柱，具有厚度为 $t$ 米、单位平面外宽度的矩形截面。杨氏模量为 $E$ (帕斯卡)。横截面积为 $A = t$ (平方米)，截面二次矩为 $I = t^3/12$ (米的四次方)。所有节点在框架连接意义上均为刚性连接，每个节点有三个自由度：平面内平移 $(u,v)$ (米) 和平面内转动 $\\theta$ (弧度)。\n\n施加一个对应于纯工程剪切 $\\gamma$ 的宏观小应变张量 $\\boldsymbol{\\varepsilon}^{\\text{macro}}$，使得 $\\varepsilon_{xx} = 0$, $\\varepsilon_{yy} = 0$, 且 $\\varepsilon_{xy} = \\varepsilon_{yx} = \\gamma/2$。相关的仿射位移场为 $\\mathbf{u}^{\\text{aff}}(\\mathbf{x}) = \\boldsymbol{\\varepsilon}^{\\text{macro}}\\mathbf{x}$，宏观转动为零。通过将位置 $\\mathbf{x}$ 处的节点位移分解为 $\\mathbf{u}(\\mathbf{x}) = \\mathbf{w}(\\mathbf{x}) + \\mathbf{u}^{\\text{aff}}(\\mathbf{x})$ 来施加周期性边界条件，其中波动场 $\\mathbf{w}(\\mathbf{x})$ 是周期性的。通过将配对边界上的波动自由度约束为相等来实现此条件：\n- 左-右配对：位于 $\\left(0,\\frac{L}{2}\\right)$ 的左中点与位于 $\\left(L,\\frac{L}{2}\\right)$ 的右中点配对，使其波动矢量相等。仿射部分意味着物理位移差等于 $\\left[\\varepsilon_{xx}L,\\varepsilon_{yx}L\\right]^\\top = \\left[0,\\frac{\\gamma L}{2}\\right]^\\top$，转动偏移为零。\n- 底-顶配对：位于 $\\left(\\frac{L}{2},0\\right)$ 的底中点与位于 $\\left(\\frac{L}{2},L\\right)$ 的顶中点配对，使其波动矢量相等。仿射部分意味着物理位移差等于 $\\left[\\varepsilon_{xy}L,\\varepsilon_{yy}L\\right]^\\top = \\left[\\frac{\\gamma L}{2},0\\right]^\\top$，转动偏移为零。\n\n为消除波动场的剩余刚体模态，将中心节点的波动自由度设置为零。使用最小势能原理求解波动场：利用欧拉-伯努利梁理论（包括轴向和弯曲贡献）组装框架的全局刚度矩阵 $\\mathbf{K}$，并通过将总位移矢量表示为 $\\mathbf{d} = \\mathbf{P}\\mathbf{w} + \\mathbf{d}_0$ 来应用周期性约束。其中 $\\mathbf{w}$ 汇集了独立的波动自由度，$\\mathbf{P}$ 将它们映射到所有自由度（包括被约束的重复自由度），$\\mathbf{d}_0$ 包含所有节点的仿射位移（仿射转动为零）。在这些约束条件下，最小化总势能 $U(\\mathbf{d}) = \\frac{1}{2}\\mathbf{d}^\\top \\mathbf{K}\\mathbf{d}$。\n\n求解出 $\\mathbf{d}$ 后，使用标准的欧拉-伯努利梁单元公式在局部坐标系中将单元弹性势能分解为轴向和弯曲两部分。对于长度为 $\\ell$ 且具有方向余弦的梁单元，将全局单元位移矢量转换到局部坐标系，根据相应的纯轴向和纯弯曲局部刚度矩阵计算轴向能量 $U_{\\text{axial}}$ 和弯曲能量 $U_{\\text{bend}}$，然后对所有单元求和以获得 $U_{\\text{axial,tot}}$ 和 $U_{\\text{bend,tot}}$。每个测试用例所需的输出是标量分数\n$$\n\\phi = \\frac{U_{\\text{axial,tot}}}{U_{\\text{axial,tot}} + U_{\\text{bend,tot}}}.\n$$\n\n物理单位：所有距离必须以米为单位，力以牛顿为单位，能量以焦耳为单位，转动以弧度为单位。最终报告的量 $\\phi$ 是无量纲的。角度必须以弧度为单位。您的程序必须将每个报告的 $\\phi$ 四舍五入到 $6$ 位小数。\n\n测试套件和参数：\n- 正方形单胞的边长为 $L = 1.0$ 米。\n- 杨氏模量为 $E = 1.0$ 帕斯卡。\n- 施加的工程剪应变为 $\\gamma = 0.01$ (无量纲)。\n- 四个测试用例由梁的厚度 $t$ (米) 和是否存在对角梁定义：\n    1. $t = 0.01$，无对角梁。\n    2. $t = 0.01$，有对角梁。\n    3. $t = 0.2$，无对角梁。\n    4. $t = 0.001$，无对角梁。\n\n对于每个测试用例，使用与上述相同的节点集，并仅在指定时包含对角梁。当存在时，对角梁连接底中点到右中点以及左中点到顶中点。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 $\\left[\\phi_1,\\phi_2,\\phi_3,\\phi_4\\right]$，其中每个 $\\phi_i$ 均按规定四舍五入到 $6$ 位小数。", "solution": "在尝试求解之前，需对问题进行验证。\n\n### 步骤1：提取已知条件\n- **单胞**：二维周期性方形梁格单胞，边长为 $L$。\n- **节点坐标**：\n    - 左中点：$\\left(0, \\frac{L}{2}\\right)$\n    - 右中点：$\\left(L, \\frac{L}{2}\\right)$\n    - 底中点：$\\left(\\frac{L}{2}, 0\\right)$\n    - 顶中点：$\\left(\\frac{L}{2}, L\\right)$\n    - 中心点：$\\left(\\frac{L}{2}, \\frac{L}{2}\\right)$\n- **基本拓扑**：四根欧拉-伯努利梁，连接四个边中点到中心节点。\n- **可选拓扑**：两根对角梁：底中点到右中点和左中点到顶中点。\n- **梁属性**：\n    - 直棱柱，矩形截面，厚度为 $t$，单位平面外宽度。\n    - 杨氏模量 $E$。\n    - 横截面积 $A = t$。\n    - 截面二次矩 $I = t^3/12$。\n- **自由度 (DOFs)**：每个节点有 $3$ 个自由度：平面内平移 $(u, v)$ 和平面内转动 $\\theta$。所有节点均为刚性连接。\n- **载荷**：宏观小应变张量 $\\boldsymbol{\\varepsilon}^{\\text{macro}}$，对应纯工程剪切 $\\gamma$，其中 $\\varepsilon_{xx} = 0$、$\\varepsilon_{yy} = 0$、$\\varepsilon_{xy} = \\varepsilon_{yx} = \\gamma/2$。\n- **边界条件 (BCs)**：\n    - 节点位移分解：$\\mathbf{u}(\\mathbf{x}) = \\mathbf{w}(\\mathbf{x}) + \\mathbf{u}^{\\text{aff}}(\\mathbf{x})$，其中 $\\mathbf{u}^{\\text{aff}}(\\mathbf{x}) = \\boldsymbol{\\varepsilon}^{\\text{macro}}\\mathbf{x}$。\n    - 波动场 $\\mathbf{w}(\\mathbf{x})$ 是周期性的。\n    - 左中点和右中点节点的波动矢量相等。\n    - 底中点和顶中点节点的波动矢量相等。\n    - 中心节点的波动自由度设置为零。\n- **求解方法**：最小势能原理。位移矢量 $\\mathbf{d}$ 表示为 $\\mathbf{d} = \\mathbf{P}\\mathbf{w} + \\mathbf{d}_0$，并最小化势能 $U(\\mathbf{d}) = \\frac{1}{2}\\mathbf{d}^\\top \\mathbf{K}\\mathbf{d}$。\n- **输出**：分数 $\\phi = \\frac{U_{\\text{axial,tot}}}{U_{\\text{axial,tot}} + U_{\\text{bend,tot}}}$，四舍五入到 $6$ 位小数。\n- **参数**：\n    - $L = 1.0$ 米\n    - $E = 1.0$ 帕斯卡\n    - $\\gamma = 0.01$\n- **测试用例**：\n    1. $t = 0.01$，无对角梁。\n    2. $t = 0.01$，有对角梁。\n    3. $t = 0.2$，无对角梁。\n    4. $t = 0.001$，无对角梁。\n- **最终输出格式**：一个逗号分隔的列表 $\\left[\\phi_1,\\phi_2,\\phi_3,\\phi_4\\right]$。\n\n### 步骤2：使用提取的已知条件进行验证\n分析问题陈述的有效性。\n- **科学依据**：是。该问题是有限元法在周期性结构中的标准应用，这是计算固体力学和多孔材料均质化领域的核心课题。它使用了成熟的欧拉-伯努利梁理论和最小势能原理。\n- **适定性**：是。几何形状、材料属性、载荷和边界条件都已完全指定。对波动场施加的周期性边界条件和固定中心节点波动的约束足以消除波动场的所有刚体模态，确保线性方程组存在唯一且稳定的解。\n- **客观性**：是。该问题使用精确的数学和物理术语进行描述，没有主观或模棱两可的陈述。\n\n经检查，该问题不含验证清单中列出的任何缺陷。它是自洽、一致、科学合理且适定的。\n\n### 步骤3：结论与行动\n问题**有效**。将制定解决方案。\n\n该解决方案采用有限元法 (FEM) 对一个 $2$D 框架结构进行分析。该方法的核心是在周期性边界条件施加的运动学约束下，最小化系统的总势能。\n\n**1. 离散化和自由度**\n单胞被离散化为 $5$ 个节点和一组梁单元。我们为节点分配索引：\n- 节点 $0$: 中心 $(\\frac{L}{2}, \\frac{L}{2})$\n- 节点 $1$: 左中点 $(0, \\frac{L}{2})$\n- 节点 $2$: 右中点 $(L, \\frac{L}{2})$\n- 节点 $3$: 底中点 $(\\frac{L}{2}, 0)$\n- 节点 $4$: 顶中点 $(\\frac{L}{2}, L)$\n\n每个节点 $i$ 有 $3$ 个自由度 (DOFs)：水平位移 $u_i$、竖直位移 $v_i$ 和转动 $\\theta_i$。无约束系统的总自由度数为 $3 \\times 5 = 15$。全局位移矢量为 $\\mathbf{d} = [u_0, v_0, \\theta_0, u_1, v_1, \\theta_1, \\dots, u_4, v_4, \\theta_4]^\\top$。\n\n**2. 单元刚度矩阵**\n对于每个长度为 $\\ell$、杨氏模量为 $E$、横截面积为 $A$、截面二次矩为 $I$ 的欧拉-伯努利梁单元，其局部刚度矩阵 $\\mathbf{k}_e^{\\text{local}}$ 在单元的局部坐标系中（局部 $x'$-轴与梁对齐）建立了节点力、力矩与节点位移、转动之间的关系。这个 $6 \\times 6$ 的矩阵是轴向刚度矩阵 $\\mathbf{k}_{\\text{axial}}^{\\text{local}}$ 和弯曲刚度矩阵 $\\mathbf{k}_{\\text{bend}}^{\\text{local}}$ 的和。\n$$\n\\mathbf{k}_{\\text{axial}}^{\\text{local}} = \\frac{EA}{\\ell}\n\\begin{bmatrix}\n1   0  0  -1  0  0 \\\\\n0   0  0  0  0  0 \\\\\n0   0  0  0  0  0 \\\\\n-1  0  0  1  0  0 \\\\\n0   0  0  0  0  0 \\\\\n0   0  0  0  0  0\n\\end{bmatrix}\n$$\n$$\n\\mathbf{k}_{\\text{bend}}^{\\text{local}} = \\frac{EI}{\\ell^3}\n\\begin{bmatrix}\n0  0  0  0  0  0 \\\\\n0  12  6\\ell  0  -12  6\\ell \\\\\n0  6\\ell  4\\ell^2  0  -6\\ell  2\\ell^2 \\\\\n0  0  0  0  0  0 \\\\\n0  -12  -6\\ell  0  12  -6\\ell \\\\\n0  6\\ell  2\\ell^2  0  -6\\ell  4\\ell^2\n\\end{bmatrix}\n$$\n总的局部刚度矩阵为 $\\mathbf{k}_e^{\\text{local}} = \\mathbf{k}_{\\text{axial}}^{\\text{local}} + \\mathbf{k}_{\\text{bend}}^{\\text{local}}$。\n\n为了组装全局刚度矩阵，每个单元的局部刚度矩阵必须转换到全局坐标系。这通过一个旋转矩阵 $\\mathbf{\\Lambda}_e$ 完成，该矩阵取决于梁单元相对于全局 $x$-轴的角度 $\\alpha$。设 $c = \\cos(\\alpha)$ 和 $s = \\sin(\\alpha)$。\n$$\n\\mathbf{\\Lambda}_e = \\begin{bmatrix}\nc   s  0  0  0  0 \\\\\n-s  c  0  0  0  0 \\\\\n0   0  1  0  0  0 \\\\\n0   0  0  c  s  0 \\\\\n0   0  0  -s  c  0 \\\\\n0   0  0  0  0  1\n\\end{bmatrix}\n$$\n在全局坐标系下的单元刚度矩阵为 $\\mathbf{k}_e^{\\text{global}} = \\mathbf{\\Lambda}_e^\\top \\mathbf{k}_e^{\\text{local}} \\mathbf{\\Lambda}_e$。\n\n**3. 全局刚度矩阵和势能**\n整个结构的全局刚度矩阵 $\\mathbf{K}$ 通过将每个单元的 $\\mathbf{k}_e^{\\text{global}}$ 贡献累加到对应于单元节点索引的适当位置来组装。系统的总弹性势能由 $U = \\frac{1}{2}\\mathbf{d}^\\top \\mathbf{K}\\mathbf{d}$ 给出。\n\n**4. 周期性边界条件和系统简化**\n任意节点 $i$ 的总位移 $\\mathbf{d}_i$ 分解为仿射部分 $\\mathbf{d}^{\\text{aff}}_i$ 和周期性波动部分 $\\mathbf{w}_i$。\n$\\mathbf{d}_i = \\mathbf{d}^{\\text{aff}}_i + \\mathbf{w}_i$。\n仿射位移场为 $\\mathbf{u}^{\\text{aff}}(\\mathbf{x}) = \\boldsymbol{\\varepsilon}^{\\text{macro}}\\mathbf{x}$，对于位于 $(x, y)$ 的节点，给出 $(u^{\\text{aff}}, v^{\\text{aff}}) = (\\varepsilon_{xx}x + \\varepsilon_{yx}y, \\varepsilon_{xy}x + \\varepsilon_{yy}y) = (\\frac{\\gamma}{2}y, \\frac{\\gamma}{2}x)$。仿射转动为零。这定义了包含所有仿射位移的矢量 $\\mathbf{d}_0$。\n\n周期性边界条件约束了波动场：\n- $\\mathbf{w}_2 = \\mathbf{w}_1$ (右中点与左中点绑定)\n- $\\mathbf{w}_4 = \\mathbf{w}_3$ (顶中点与底中点绑定)\n- $\\mathbf{w}_0 = \\mathbf{0}$ (中心波动被固定以消除刚体运动)\n\n因此，独立的波动自由度仅为节点 $1$ 和 $3$ 的自由度。我们定义独立的自由度简化矢量为 $\\mathbf{w} = [\\mathbf{w}_1^\\top, \\mathbf{w}_3^\\top]^\\top$，这是一个 $6 \\times 1$ 的矢量。总位移矢量 $\\mathbf{d}$ 可以用 $\\mathbf{w}$ 表示为 $\\mathbf{d} = \\mathbf{P}\\mathbf{w} + \\mathbf{d}_0$，其中 $\\mathbf{P}$ 是一个 $15 \\times 6$ 的转换矩阵，它将独立自由度映射到全套波动自由度，而 $\\mathbf{d}_0$ 是仿射节点位移的矢量。\n\n**5. 势能最小化**\n将约束后的位移 $\\mathbf{d}$ 代入能量表达式：\n$$\nU(\\mathbf{w}) = \\frac{1}{2}(\\mathbf{P}\\mathbf{w} + \\mathbf{d}_0)^\\top \\mathbf{K} (\\mathbf{P}\\mathbf{w} + \\mathbf{d}_0)\n$$\n为找到平衡状态，我们通过将 $U$ 对 $\\mathbf{w}$ 的导数设为零来最小化 $U$：\n$$\n\\frac{\\partial U}{\\partial \\mathbf{w}} = \\mathbf{P}^\\top \\mathbf{K} (\\mathbf{P}\\mathbf{w} + \\mathbf{d}_0) = 0\n$$\n这产生了一个关于未知独立波动 $\\mathbf{w}$ 的线性方程组：\n$$\n(\\mathbf{P}^\\top \\mathbf{K} \\mathbf{P}) \\mathbf{w} = - \\mathbf{P}^\\top \\mathbf{K} \\mathbf{d}_0\n$$\n令 $\\mathbf{K}_{\\text{eff}} = \\mathbf{P}^\\top \\mathbf{K} \\mathbf{P}$ 为有效刚度矩阵，$\\mathbf{F}_{\\text{eff}} = - \\mathbf{P}^\\top \\mathbf{K} \\mathbf{d}_0$ 为有效力矢量。我们求解这个 $6 \\times 6$ 的系统 $\\mathbf{K}_{\\text{eff}} \\mathbf{w} = \\mathbf{F}_{\\text{eff}}$ 以得到 $\\mathbf{w}$。\n\n**6. 能量计算**\n一旦 $\\mathbf{w}$ 已知，就可以恢复完整的节点位移矢量：$\\mathbf{d} = \\mathbf{P}\\mathbf{w} + \\mathbf{d}_0$。为了找到所需的能量比率，我们遍历每个单元 $e$：\n1. 从 $\\mathbf{d}$ 中提取单元的全局位移矢量 $\\mathbf{d}_e$。\n2. 将其转换到单元的局部坐标系：$\\mathbf{d}_e^{\\text{local}} = \\mathbf{\\Lambda}_e \\mathbf{d}_e$。\n3. 计算单元的轴向和弯曲能量：\n   $U_{e, \\text{axial}} = \\frac{1}{2} (\\mathbf{d}_e^{\\text{local}})^\\top \\mathbf{k}_{\\text{axial}}^{\\text{local}} (\\mathbf{d}_e^{\\text{local}})$\n   $U_{e, \\text{bend}} = \\frac{1}{2} (\\mathbf{d}_e^{\\text{local}})^\\top \\mathbf{k}_{\\text{bend}}^{\\text{local}} (\\mathbf{d}_e^{\\text{local}})$\n4. 将这些能量对所有单元求和，得到 $U_{\\text{axial,tot}}$ 和 $U_{\\text{bend,tot}}$。\n5. 最终的分数计算为 $\\phi = \\frac{U_{\\text{axial,tot}}}{U_{\\text{axial,tot}} + U_{\\text{bend,tot}}}$。\n\n对指定的四个测试用例中的每一个都执行此过程。", "answer": "```python\nimport numpy as np\n\ndef get_beam_local_stiffness(E, A, I, ell):\n    \"\"\"\n    Computes the local axial and bending stiffness matrices for a 2D Euler-Bernoulli beam.\n    \n    Args:\n        E (float): Young's modulus\n        A (float): Cross-sectional area\n        I (float): Second moment of area\n        ell (float): Length of the beam element\n        \n    Returns:\n        tuple: (k_axial_local, k_bend_local), each a 6x6 numpy array.\n    \"\"\"\n    k_axial_local = np.zeros((6, 6))\n    k_bend_local = np.zeros((6, 6))\n\n    if ell > 0:\n        c1 = E * A / ell\n        k_axial_local[0, 0] = c1\n        k_axial_local[0, 3] = -c1\n        k_axial_local[3, 0] = -c1\n        k_axial_local[3, 3] = c1\n\n        c2 = E * I / (ell ** 3)\n        k_bend_local[1, 1] = 12 * c2\n        k_bend_local[1, 2] = 6 * ell * c2\n        k_bend_local[1, 4] = -12 * c2\n        k_bend_local[1, 5] = 6 * ell * c2\n\n        k_bend_local[2, 1] = 6 * ell * c2\n        k_bend_local[2, 2] = 4 * ell**2 * c2\n        k_bend_local[2, 4] = -6 * ell * c2\n        k_bend_local[2, 5] = 2 * ell**2 * c2\n\n        k_bend_local[4, 1] = -12 * c2\n        k_bend_local[4, 2] = -6 * ell * c2\n        k_bend_local[4, 4] = 12 * c2\n        k_bend_local[4, 5] = -6 * ell * c2\n\n        k_bend_local[5, 1] = 6 * ell * c2\n        k_bend_local[5, 2] = 2 * ell**2 * c2\n        k_bend_local[5, 4] = -6 * ell * c2\n        k_bend_local[5, 5] = 4 * ell**2 * c2\n        \n    return k_axial_local, k_bend_local\n\ndef get_transformation_matrix(angle):\n    \"\"\"\n    Computes the 6x6 transformation matrix for a 2D frame element.\n    \"\"\"\n    c = np.cos(angle)\n    s = np.sin(angle)\n    Lambda = np.array([\n        [ c,  s,  0,  0,  0,  0],\n        [-s,  c,  0,  0,  0,  0],\n        [ 0,  0,  1,  0,  0,  0],\n        [ 0,  0,  0,  c,  s,  0],\n        [ 0,  0,  0, -s,  c,  0],\n        [ 0,  0,  0,  0,  0,  1]\n    ])\n    return Lambda\n\ndef calculate_energy_fraction(t, has_diagonals):\n    \"\"\"\n    Performs FEM analysis for one test case and returns the axial energy fraction.\n    \"\"\"\n    # Parameters\n    L = 1.0\n    E = 1.0\n    gamma = 0.01\n\n    A = t\n    I = t**3 / 12.0\n\n    # 1. Define nodes and elements\n    nodes = np.array([\n        [L/2, L/2],  # 0: center\n        [0,   L/2],  # 1: left-mid\n        [L,   L/2],  # 2: right-mid\n        [L/2, 0],    # 3: bottom-mid\n        [L/2, L]     # 4: top-mid\n    ])\n    num_nodes = len(nodes)\n    num_dofs = num_nodes * 3\n\n    elements = [\n        (1, 0), (2, 0), (3, 0), (4, 0) # Base topology\n    ]\n    if has_diagonals:\n        elements.extend([(3, 2), (1, 4)])\n\n    # 2. Assemble global stiffness matrix K\n    K = np.zeros((num_dofs, num_dofs))\n    \n    element_matrices = []\n\n    for n1_idx, n2_idx in elements:\n        n1_coord = nodes[n1_idx]\n        n2_coord = nodes[n2_idx]\n        \n        dx = n2_coord[0] - n1_coord[0]\n        dy = n2_coord[1] - n1_coord[1]\n        ell = np.sqrt(dx**2 + dy**2)\n        angle = np.arctan2(dy, dx)\n        \n        k_axial_local, k_bend_local = get_beam_local_stiffness(E, A, I, ell)\n        k_local = k_axial_local + k_bend_local\n        \n        Lambda = get_transformation_matrix(angle)\n        k_global = Lambda.T @ k_local @ Lambda\n        \n        element_matrices.append({\n            \"nodes\": (n1_idx, n2_idx),\n            \"Lambda\": Lambda,\n            \"k_axial_local\": k_axial_local,\n            \"k_bend_local\": k_bend_local\n        })\n\n        dof_indices = np.array([\n            3*n1_idx, 3*n1_idx+1, 3*n1_idx+2,\n            3*n2_idx, 3*n2_idx+1, 3*n2_idx+2\n        ])\n        \n        for i in range(6):\n            for j in range(6):\n                K[dof_indices[i], dof_indices[j]] += k_global[i, j]\n\n    # 3. Define periodic BCs: d = P*w + d0\n    # Independent DOFs w are fluctuations at nodes 1 and 3 (6 DOFs total)\n    P = np.zeros((num_dofs, 6))\n    P[3:6, 0:3] = np.eye(3)   # w_1 -> w_1 (node 1)\n    P[6:9, 0:3] = np.eye(3)   # w_2 = w_1 (node 2)\n    P[9:12, 3:6] = np.eye(3)  # w_3 -> w_3 (node 3)\n    P[12:15, 3:6] = np.eye(3) # w_4 = w_3 (node 4)\n    # w_0 = 0, so rows 0-2 of P are zero, which is the default.\n\n    d0 = np.zeros(num_dofs)\n    for i in range(num_nodes):\n        x, y = nodes[i]\n        u_aff = gamma / 2.0 * y\n        v_aff = gamma / 2.0 * x\n        d0[3*i] = u_aff\n        d0[3*i+1] = v_aff\n        # d0[3*i+2] = 0 (affine rotation is zero)\n\n    # 4. Solve for independent fluctuations w\n    K_eff = P.T @ K @ P\n    F_eff = -P.T @ K @ d0\n    \n    w = np.linalg.solve(K_eff, F_eff)\n    \n    # 5. Reconstruct full displacement vector d\n    d = P @ w + d0\n    \n    # 6. Calculate energies\n    U_axial_tot = 0.0\n    U_bend_tot = 0.0\n\n    for elem_data in element_matrices:\n        n1_idx, n2_idx = elem_data[\"nodes\"]\n        dof_indices = np.array([\n            3*n1_idx, 3*n1_idx+1, 3*n1_idx+2,\n            3*n2_idx, 3*n2_idx+1, 3*n2_idx+2\n        ])\n        d_e_global = d[dof_indices]\n        \n        Lambda = elem_data[\"Lambda\"]\n        k_axial_local = elem_data[\"k_axial_local\"]\n        k_bend_local = elem_data[\"k_bend_local\"]\n        \n        d_e_local = Lambda @ d_e_global\n        \n        U_e_axial = 0.5 * d_e_local.T @ k_axial_local @ d_e_local\n        U_e_bend = 0.5 * d_e_local.T @ k_bend_local @ d_e_local\n        \n        U_axial_tot += U_e_axial\n        U_bend_tot += U_e_bend\n        \n    total_energy = U_axial_tot + U_bend_tot\n    if total_energy == 0:\n        return 0.0\n        \n    phi = U_axial_tot / total_energy\n    return phi\n\ndef solve():\n    # Test cases: (thickness, has_diagonals)\n    test_cases = [\n        (0.01, False),\n        (0.01, True),\n        (0.2, False),\n        (0.001, False),\n    ]\n\n    results = []\n    for t, has_diagonals in test_cases:\n        phi = calculate_energy_fraction(t, has_diagonals)\n        results.append(phi)\n        \n    # Format the final output string with 6 decimal places.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "2660448"}]}