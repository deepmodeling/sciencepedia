{"hands_on_practices": [{"introduction": "本练习将引导您完成一个典型的有限脉冲响应（FIR）低通滤波器设计流程。您将从以赫兹（Hz）为单位的实际规格出发，学习如何将其转换为标准化的数字频率，并应用凯泽窗（Kaiser window）的设计准则来确定满足所需性能（如通带纹波和阻带衰减）的最小滤波器长度[@problem_id:2871821]。这项实践是数字信号处理中的一项核心技能，它将理论与满足现实世界工程需求的实际设计过程联系起来。", "problem": "给定几个低通滤波器设计任务的规格（以赫兹为单位）。您的目标是将边缘频率转换为以弧度/样本为单位的归一化角频率，然后使用窗函数法确定满足给定波纹约束的最小奇数长度线性相位有限脉冲响应（FIR）低通滤波器。使用凯撒窗法使设计具有确定性。\n\n使用的基本原理：\n- 从赫兹到归一化弧度/样本的离散时间角频率映射定义：$$\\omega = 2\\pi \\frac{f}{f_{\\mathrm{s}}}.$$\n- 理想低通频率响应及其时域脉冲响应，作为矩形频率响应的离散时间傅里叶逆变换。\n- 经过充分检验的基于凯撒窗的设计准则，该准则将允许的波纹和过渡带宽度与最小滤波器阶数联系起来。\n\n设计要求：\n- 对于每个测试用例，使用公式 $$\\omega = 2\\pi \\frac{f}{f_{\\mathrm{s}}}$$ 将通带边缘频率和阻带边缘频率从赫兹转换为以弧度/样本为单位的归一化角频率。将通带边缘表示为 $$\\omega_{\\mathrm{p}}$$，阻带边缘表示为 $$\\omega_{\\mathrm{s}}$$。以弧度/样本为单位报告这些值。\n- 使用凯撒窗法设计一个实数、因果、线性相位的低通FIR（有限脉冲响应）滤波器。滤波器长度 $$L$$ 是抽头数，滤波器阶数为 $$L-1$$。\n- 通带波纹容限以线性绝对偏差 $$\\delta_{\\mathrm{p}}$$ 给出，阻带波纹容限以线性绝对偏差 $$\\delta_{\\mathrm{s}}$$ 给出。为保证同时满足这两个约束，请使用更严格的容限 $$\\delta = \\min(\\delta_{\\mathrm{p}}, \\delta_{\\mathrm{s}})$$。\n- 设过渡带宽度为 $$\\Delta \\omega = \\omega_{\\mathrm{s}} - \\omega_{\\mathrm{p}}$$，理想截止频率为中点 $$\\omega_{\\mathrm{c}} = \\frac{\\omega_{\\mathrm{p}} + \\omega_{\\mathrm{s}}}{2}$$。确定最小奇数长度 $$L$$，使得凯撒窗设计在过渡带宽度为 $$\\Delta \\omega$$ 的情况下满足波纹容限 $$\\delta$$。\n- 强制要求 $$L$$ 必须为奇数（这样群延迟 $$\\frac{L-1}{2}$$ 是一个整数）；如果计算出的最小值为偶数，则将其加 $$1$$。\n\n单位与数值规格：\n- 以弧度/样本为单位报告 $$\\omega_{\\mathrm{p}}$$ 和 $$\\omega_{\\mathrm{s}}$$，精确到小数点后 $$12$$ 位。\n- 将 $$L$$ 报告为整数。\n- 角度单位必须是弧度/样本。\n\n测试套件（每个项目为 $[f_{\\mathrm{s}} \\text{ (Hz)}, f_{\\mathrm{pass}} \\text{ (Hz)}, f_{\\mathrm{stop}} \\text{ (Hz)}, \\delta_{\\mathrm{p}}, \\delta_{\\mathrm{s}}]$）：\n- $$[48000,\\ 5000,\\ 7000,\\ 0.01,\\ 0.001]$$\n- $$[48000,\\ 18000,\\ 19000,\\ 0.005,\\ 0.005]$$\n- $$[44100,\\ 4000,\\ 8000,\\ 0.001,\\ 10^{-5}]$$\n- $$[96000,\\ 20000,\\ 47500,\\ 0.01,\\ 0.01]$$\n\n输出格式：\n- 您的程序应生成单行输出，将所有测试用例的结果聚合为一个列表的列表，其中不含任何空格。\n- 对于每个测试用例，输出一个列表，包含 $$\\omega_{\\mathrm{p}}$$（四舍五入到小数点后 $$12$$ 位）、$$\\omega_{\\mathrm{s}}$$（四舍五入到小数点后 $$12$$ 位）和 $$L$$（一个整数）。\n- 因此，最终输出必须是形如\n  $$[[\\omega_{\\mathrm{p},1},\\omega_{\\mathrm{s},1},L_{1}],[\\omega_{\\mathrm{p},2},\\omega_{\\mathrm{s},2},L_{2}],\\ldots]$$\n  的单行文本，其中每个 $$\\omega_{\\mathrm{p},k}$$ 和 $$\\omega_{\\mathrm{s},k}$$ 是小数点后恰好有 $$12$$ 位的小数，每个 $$L_{k}$$ 是一个整数，并且该行中没有任何空格。", "solution": "所给出的问题陈述是数字信号处理领域的一项标准任务：使用凯撒窗法设计一个有限脉冲响应（FIR）低通滤波器，以满足特定的频域规格。该问题具有科学依据，提法恰当，且所有提供的参数都一致且足以得出一个唯一解。因此，该问题是有效的，我们将着手解决它。\n\n使用窗函数法设计线性相位FIR滤波器涉及用一个合适的窗函数截断所需滤波器的理想脉冲响应。选择凯撒窗是因为它在其傅里叶变换的主瓣宽度（控制滤波器的过渡带宽度）和旁瓣电平（控制通带和阻带波纹）之间提供了极佳的权衡。设计过程是确定性的，依赖于将滤波器规格与所需窗函数参数联系起来的既定经验公式。\n\n确定最小奇数滤波器长度 $L$ 的步骤如下：\n\n1.  **归一化频率**：必须将给定的模拟频率规格转换为以弧度/样本为单位的归一化离散时间角频率，用 $\\omega$ 表示。转换公式为：\n    $$ \\omega = 2\\pi \\frac{f}{f_s} $$\n    其中 $f$ 是以赫兹（Hz）为单位的频率，$f_s$ 是以赫兹为单位的采样频率。我们计算归一化的通带边缘频率 $\\omega_p$ 和阻带边缘频率 $\\omega_s$。\n\n2.  **确定设计规格**：滤波器的性能由其过渡带宽度 $\\Delta\\omega$ 和最大允许波纹 $\\delta$ 来表征。\n    - 过渡带宽度是阻带和通带边缘频率之差：$\\Delta\\omega = \\omega_s - \\omega_p$。\n    - 波纹规格必须同时满足通带（$\\delta_p$）和阻带（$\\delta_s$）的约束。因此，我们选择两者中更严格的一个：$\\delta = \\min(\\delta_p, \\delta_s)$。\n\n3.  **计算所需衰减**：波纹 $\\delta$ 通常以分贝（dB）表示为最小阻带衰减 $A$：\n    $$ A = -20 \\log_{10}(\\delta) $$\n\n4.  **估计最小滤波器阶数**：由 Kaiser 建立的一个经验公式将衰减 $A$ 和过渡带宽度 $\\Delta\\omega$ 与所需的最小滤波器阶数 $N = L-1$ 联系起来：\n    $$ N \\ge \\frac{A - 8}{2.285 \\Delta\\omega} $$\n    由于阶数 $N$ 必须是整数，我们对该公式的结果取上整，以找到所需的最小整数阶数。\n    $$ N_{\\text{min}} = \\left\\lceil \\frac{A - 8}{2.285 \\Delta\\omega} \\right\\rceil $$\n\n5.  **确定滤波器长度并强制执行奇数长度约束**：滤波器长度 $L$ 由 $L = N_{\\text{min}} + 1$ 给出。问题规定滤波器长度必须为奇数，这确保了滤波器为 I 型线性相位滤波器，其群延迟为整数 $(L-1)/2$ 个样本。如果计算出的长度 $L$ 为偶数，则必须将其加 1 以满足此约束。\n\n我们现在将此过程应用于每个测试用例。\n\n**测试用例 1:**\n- 规格：$f_s = 48000$ Hz, $f_{\\text{pass}} = 5000$ Hz, $f_{\\text{stop}} = 7000$ Hz, $\\delta_p = 0.01$, $\\delta_s = 0.001$。\n- 归一化频率：\n  - $\\omega_p = 2\\pi \\frac{5000}{48000} = \\frac{5\\pi}{24} \\approx 0.654498469498$ 弧度/样本。\n  - $\\omega_s = 2\\pi \\frac{7000}{48000} = \\frac{7\\pi}{24} \\approx 0.916297857297$ 弧度/样本。\n- 设计参数：\n  - $\\Delta\\omega = \\omega_s - \\omega_p = \\frac{2\\pi}{24} = \\frac{\\pi}{12}$ 弧度/样本。\n  - $\\delta = \\min(0.01, 0.001) = 0.001$。\n  - $A = -20 \\log_{10}(0.001) = 60$ dB。\n- 滤波器阶数和长度：\n  - $N_{\\text{min}} = \\lceil \\frac{60 - 8}{2.285 \\cdot (\\pi/12)} \\rceil = \\lceil 86.924 \\rceil = 87$。\n  - $L = 87 + 1 = 88$。\n  - $L$ 是偶数，所以必须设置 $L = 88 + 1 = 89$。\n- 结果：$\\omega_p = 0.654498469498$, $\\omega_s = 0.916297857297$, $L = 89$。\n\n**测试用例 2:**\n- 规格：$f_s = 48000$ Hz, $f_{\\text{pass}} = 18000$ Hz, $f_{\\text{stop}} = 19000$ Hz, $\\delta_p = 0.005$, $\\delta_s = 0.005$。\n- 归一化频率：\n  - $\\omega_p = 2\\pi \\frac{18000}{48000} = \\frac{3\\pi}{4} \\approx 2.356194490192$ 弧度/样本。\n  - $\\omega_s = 2\\pi \\frac{19000}{48000} = \\frac{19\\pi}{24} \\approx 2.487094336173$ 弧度/样本。\n- 设计参数：\n  - $\\Delta\\omega = \\omega_s - \\omega_p = \\frac{\\pi}{24}$ 弧度/样本。\n  - $\\delta = \\min(0.005, 0.005) = 0.005$。\n  - $A = -20 \\log_{10}(0.005) \\approx 46.0206$ dB。\n- 滤波器阶数和长度：\n  - $N_{\\text{min}} = \\lceil \\frac{46.0206 - 8}{2.285 \\cdot (\\pi/24)} \\rceil = \\lceil \\frac{38.0206}{0.29911} \\rceil = \\lceil 127.108 \\rceil = 128$。\n  - $L = 128 + 1 = 129$。\n  - $L$ 是奇数，所以长度正确。\n- 结果：$\\omega_p = 2.356194490192$, $\\omega_s = 2.487094336173$, $L = 129$。\n\n**测试用例 3:**\n- 规格：$f_s = 44100$ Hz, $f_{\\text{pass}} = 4000$ Hz, $f_{\\text{stop}} = 8000$ Hz, $\\delta_p = 0.001$, $\\delta_s = 10^{-5}$。\n- 归一化频率：\n  - $\\omega_p = 2\\pi \\frac{4000}{44100} = \\frac{80\\pi}{441} \\approx 0.569865615700$ 弧度/样本。\n  - $\\omega_s = 2\\pi \\frac{8000}{44100} = \\frac{160\\pi}{441} \\approx 1.139731231400$ 弧度/样本。\n- 设计参数：\n  - $\\Delta\\omega = \\omega_s - \\omega_p = \\frac{80\\pi}{441}$ 弧度/样本。\n  - $\\delta = \\min(0.001, 10^{-5}) = 10^{-5}$。\n  - $A = -20 \\log_{10}(10^{-5}) = 100$ dB。\n- 滤波器阶数和长度：\n  - $N_{\\text{min}} = \\lceil \\frac{100 - 8}{2.285 \\cdot (80\\pi/441)} \\rceil = \\lceil \\frac{92}{1.30214} \\rceil = \\lceil 70.653 \\rceil = 71$。\n  - $L = 71 + 1 = 72$。\n  - $L$ 是偶数，所以必须设置 $L = 72 + 1 = 73$。\n- 结果：$\\omega_p = 0.569865615700$, $\\omega_s = 1.139731231400$, $L = 73$。\n\n**测试用例 4:**\n- 规格：$f_s = 96000$ Hz, $f_{\\text{pass}} = 20000$ Hz, $f_{\\text{stop}} = 47500$ Hz, $\\delta_p = 0.01$, $\\delta_s = 0.01$。\n- 归一化频率：\n  - $\\omega_p = 2\\pi \\frac{20000}{96000} = \\frac{5\\pi}{12} \\approx 1.308996938996$ 弧度/样本。\n  - $\\omega_s = 2\\pi \\frac{47500}{96000} = \\frac{95\\pi}{96} \\approx 3.108643110252$ 弧度/样本。\n- 设计参数：\n  - $\\Delta\\omega = \\omega_s - \\omega_p = \\frac{95\\pi}{96} - \\frac{40\\pi}{96} = \\frac{55\\pi}{96}$ 弧度/样本。\n  - $\\delta = \\min(0.01, 0.01) = 0.01$。\n  - $A = -20 \\log_{10}(0.01) = 40$ dB。\n- 滤波器阶数和长度：\n  - $N_{\\text{min}} = \\lceil \\frac{40 - 8}{2.285 \\cdot (55\\pi/96)} \\rceil = \\lceil \\frac{32}{4.11818} \\rceil = \\lceil 7.770 \\rceil = 8$。\n  - $L = 8 + 1 = 9$。\n  - $L$ 是奇数，所以长度正确。\n- 结果：$\\omega_p = 1.308996938996$, $\\omega_s = 3.108643110252$, $L = 9$。\n\n所有计算现已完成。以下代码将实现此逻辑以生成所需的输出。", "answer": "```python\nimport numpy as np\n\n# This problem requires libraries numpy versions 1.23.5 and scipy versions 1.11.4.\n# The calculation can be completed with numpy alone.\n\ndef solve():\n    \"\"\"\n    Calculates the minimum odd-length FIR filter for given lowpass specifications\n    using the Kaiser window design method.\n    \"\"\"\n    \n    # Test cases: [f_s, f_pass, f_stop, delta_p, delta_s]\n    # f_s:         Sampling frequency in Hz\n    # f_pass:      Passband edge frequency in Hz\n    # f_stop:      Stopband edge frequency in Hz\n    # delta_p:     Passband ripple (linear)\n    # delta_s:     Stopband ripple (linear)\n    test_cases = [\n        [48000, 5000, 7000, 0.01, 0.001],\n        [48000, 18000, 19000, 0.005, 0.005],\n        [44100, 4000, 8000, 0.001, 1e-5],\n        [96000, 20000, 47500, 0.01, 0.01],\n    ]\n\n    results = []\n    for case in test_cases:\n        f_s, f_pass, f_stop, delta_p, delta_s = case\n\n        # Step 1: Convert frequencies to normalized angular frequency (rad/sample)\n        omega_p = 2 * np.pi * f_pass / f_s\n        omega_s = 2 * np.pi * f_stop / f_s\n\n        # Step 2: Determine design parameters\n        # Transition width in rad/sample\n        delta_omega = omega_s - omega_p\n        \n        # Use the stricter ripple constraint\n        delta = min(delta_p, delta_s)\n\n        # Step 3: Calculate required attenuation in dB\n        A = -20 * np.log10(delta)\n\n        # Step 4: Estimate minimum filter order N using Kaiser's formula\n        # N = (A - 8) / (2.285 * delta_omega)\n        # Note: Using 8.0 as per Oppenheim  Schafer, for consistency with the derivation.\n        # This is a well-established approximation.\n        if delta_omega == 0:\n            # Avoid division by zero, although not expected in these test cases\n            N_min_float = float('inf')\n        else:\n            N_min_float = (A - 8.0) / (2.285 * delta_omega)\n        \n        N = np.ceil(N_min_float)\n        \n        # Step 5: Determine filter length L and enforce the odd-length constraint\n        L = int(N + 1)\n        if L % 2 == 0:\n            L += 1\n            \n        # Store results with required rounding\n        results.append([omega_p, omega_s, L])\n\n    # Format the final output string exactly as specified in the problem\n    formatted_cases = []\n    for case in results:\n        # Format omega_p and omega_s to exactly 12 decimal places\n        # L is an integer\n        formatted_case = f\"[{case[0]:.12f},{case[1]:.12f},{case[2]}]\"\n        formatted_cases.append(formatted_case)\n    \n    # Final output is a single line, a list of lists, with no spaces.\n    final_output = f\"[{','.join(formatted_cases)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "2871821"}, {"introduction": "窗函数法不仅限于设计低通或带通等频率选择性滤波器，它同样适用于功能更特殊的滤波器，例如微分器。本练习将展示如何通过对理想微分器脉冲响应（其形式为 $h_{d}[n] = \\frac{\\cos(\\pi n)}{n}$）进行截断和加窗来设计一个实用的FIR微分器[@problem_id:2864260]。通过此过程，您将更深入地理解不同窗函数（如汉明窗）在主瓣宽度和旁瓣抑制之间的权衡，以及这种权衡如何影响微分器在整个频带内的逼近精度。", "problem": "考虑使用截断加窗法设计一个线性相位、有限冲激响应（FIR）离散时间微分器。所需微分器的理想频率响应为 $H_{d}(\\omega)=j\\,\\omega$（对于 $-\\pi \\le \\omega \\le \\pi$）。从离散时间傅里叶逆变换（DTFT）的定义 $h_{d}[n]=\\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi} H_{d}(\\omega)\\,e^{j\\omega n}\\,d\\omega$ 出发，按以下步骤进行：\n\n- 从基本原理出发，推导理想冲激响应 $h_{d}[n]$。解释其奇偶（对称）性及其对线性相位和滤波器类型分类的影响。\n- 通过将 $h_{d}[n]$ 截断至索引 $n\\in\\{-M,-M+1,\\dots,0,\\dots,M\\}$ 并应用一个索引为 $k\\in\\{0,1,\\dots,N-1\\}$ 的对称数据窗 $w[k]$（时间平移为 $n=k-M$），构建一个长度为奇数 $N=2M+1$ 的实用FIR微分器。给出通用表达式 $h[k]=w[k]\\,h_{d}[k-M]$。\n- 利用关于窗谱特性和微分器近似误差整形的基本事实，论证在此设计中选择汉明窗的合理性，这涉及主瓣宽度和旁瓣电平之间的权衡，以及这对整个频带上的加权误差 $|H(\\omega)-j\\,\\omega|/\\omega$ 的影响。\n- 对于一个具体的设计，设置长度为 $N=31$，并采用汉明窗 $w[k]=0.54-0.46\\cos\\!\\big(2\\pi k/(N-1)\\big)$（对于 $0\\le k\\le N-1$）。使用截断加窗法计算所得FIR微分器的单个系数 $h[20]$。\n\n将您计算的 $h[20]$ 的最终数值答案四舍五入至八位有效数字。无需物理单位。", "solution": "本题是数字滤波器设计中的一道标准练习题，具体涉及使用窗函数法设计一个有限冲激响应（FIR）微分器。该问题具有科学依据，提法适定，并包含了获得唯一解所需的所有信息。因此，该问题是有效的。我们按顺序逐一解答问题中的各个要点。\n\n首先，我们推导离散时间微分器的理想冲激响应 $h_d[n]$。给定的理想频率响应为 $H_d(\\omega) = j\\omega$（对于 $\\omega \\in [-\\pi, \\pi]$）。理想冲激响应 $h_d[n]$ 通过计算离散时间傅里叶逆变换（DTFT）得到：\n$$ h_d[n] = \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} H_d(\\omega) e^{j\\omega n} d\\omega = \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} (j\\omega) e^{j\\omega n} d\\omega $$\n对于 $n \\neq 0$ 的情况，我们可以使用分部积分法求解此积分，令 $u = j\\omega$ 且 $dv = e^{j\\omega n} d\\omega$。由此可得 $du = j\\,d\\omega$ 且 $v = \\frac{1}{jn}e^{j\\omega n}$。\n$$ h_d[n] = \\frac{1}{2\\pi} \\left[ j\\omega \\left( \\frac{e^{j\\omega n}}{jn} \\right) \\right]_{-\\pi}^{\\pi} - \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} \\left( \\frac{e^{j\\omega n}}{jn} \\right) j\\,d\\omega $$\n$$ h_d[n] = \\frac{1}{2\\pi n} \\left[ \\omega e^{j\\omega n} \\right]_{-\\pi}^{\\pi} - \\frac{1}{2\\pi n} \\int_{-\\pi}^{\\pi} e^{j\\omega n} d\\omega $$\n计算第一项：\n$$ \\frac{1}{2\\pi n} \\left( \\pi e^{j\\pi n} - (-\\pi)e^{-j\\pi n} \\right) = \\frac{1}{2n} \\left( e^{j\\pi n} + e^{-j\\pi n} \\right) = \\frac{\\cos(\\pi n)}{n} $$\n由于 $n$ 是整数，$\\cos(\\pi n) = (-1)^n$。对于 $n \\neq 0$，第二项的计算结果为零：\n$$ -\\frac{1}{2\\pi n} \\left[ \\frac{e^{j\\omega n}}{jn} \\right]_{-\\pi}^{\\pi} = -\\frac{1}{2\\pi j n^2} (e^{j\\pi n} - e^{-j\\pi n}) = -\\frac{\\sin(\\pi n)}{\\pi n^2} = 0 $$\n对于 $n = 0$ 的情况，我们必须直接计算该积分：\n$$ h_d[0] = \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} j\\omega\\, d\\omega = \\frac{j}{2\\pi} \\left[ \\frac{\\omega^2}{2} \\right]_{-\\pi}^{\\pi} = \\frac{j}{4\\pi} (\\pi^2 - (-\\pi)^2) = 0 $$\n因此，理想冲激响应为：\n$$ h_d[n] = \\begin{cases} \\frac{\\cos(\\pi n)}{n},  \\text{for } n \\neq 0 \\\\ 0,  \\text{for } n = 0 \\end{cases} $$\n为了检验 $h_d[n]$ 的奇偶性，我们检查 $n \\neq 0$ 时的 $h_d[-n]$：$h_d[-n] = \\frac{\\cos(\\pi(-n))}{-n} = \\frac{\\cos(\\pi n)}{-n} = -h_d[n]$。由于 $h_d[0]=0$，关系式 $h_d[-n] = -h_d[n]$ 对所有整数 $n$ 成立。此性质意味着 $h_d[n]$ 是一个反对称（奇）序列。由该响应的截断和移位版本构建的FIR滤波器将具有广义线性相位。具体来说，一个长度为奇数 $N=2M+1$ 且具有反对称冲激响应（$h[k] = -h[N-1-k]$）的因果FIR滤波器被归类为III型线性相位滤波器。这类滤波器的频率响应是纯虚数，适用于设计微分器和希尔伯特变换器，这与理想响应 $H_d(\\omega)=j\\omega$ 一致。\n\n第二，我们构建实用的FIR滤波器。理想冲激响应 $h_d[n]$ 是非因果的且长度无限。为了创建一个长度为 $N=2M+1$ 的实用FIR滤波器，我们将 $h_d[n]$ 截断到范围 $n \\in \\{-M, \\dots, M\\}$，然后应用窗函数来平滑突然的截断。将得到的序列平移 $M$ 个采样点使其成为因果序列。对于 $k \\in \\{0, 1, \\dots, N-1\\}$，因果冲激响应 $h[k]$ 由以下表达式给出：\n$$ h[k] = w[k] h_d[k-M] $$\n这里，$w[k]$ 是一个长度为 $N$ 的对称窗（$w[k] = w[N-1-k]$），时间索引根据 $n=k-M$ 进行移位。这种构建方法正确地保留了因果滤波器的反对称特性，即 $h[k] = -h[N-1-k]$，确保了它是一个III型线性相位滤波器。\n\n第三，我们论证选择汉明窗的合理性。时域中的加窗过程对应于频域中的卷积：$H(\\omega) = \\frac{1}{2\\pi} H_d(\\omega) * W(\\omega)$，其中 $W(\\omega)$ 是窗函数的DTFT。近似 $H(\\omega) \\approx H_d(\\omega)$ 的质量取决于 $W(\\omega)$ 的特性。窗设计中的一个主要权衡是在主瓣宽度和旁瓣峰值电平之间。矩形窗（简单截断）具有最窄的主瓣，但其旁瓣非常高（第一个旁瓣在 $-13 \\text{ dB}$）。窄主瓣在 $\\omega=0$ 附近提供了良好的近似精度，但高旁瓣在频带的其余部分引入了大的波纹（吉布斯现象）。汉明窗的主瓣更宽，但实现了明显更好的旁瓣衰减（旁瓣峰值在 $-43 \\text{ dB}$）。对于微分器，近似误差 $|H(\\omega)-j\\omega|$ 在整个频带上都至关重要。加权误差 $|H(\\omega)-j\\omega|/\\omega$ 是一个相对误差度量。高旁瓣会导致误差出现大的振荡，尤其是在较高频率处。通过抑制旁瓣，汉明窗降低了整个频带上的最大近似误差，代价是在 $\\omega=0$ 紧邻区域的精度略有降低。这导致了一个在宽频率范围内表现更均匀的设计，这通常是通用微分器所期望的结果。\n\n最后，我们使用汉明窗计算长度为 $N=31$ 的滤波器的特定系数 $h[20]$。\n给定 $N=31$，我们有一个奇数长度，所以 $N = 2M+1$，这意味着 $2M=30$ 且 $M=15$。滤波器系数的索引范围从 $k=0$ 到 $k=30$。\n汉明窗由 $w[k] = 0.54 - 0.46\\cos\\left(\\frac{2\\pi k}{N-1}\\right)$ 给出，对于 $k \\in \\{0, \\dots, 30\\}$。当 $N-1=30$ 时，表达式为 $w[k] = 0.54 - 0.46\\cos\\left(\\frac{\\pi k}{15}\\right)$。\n冲激响应计算为 $h[k] = w[k] h_d[k-M]$。我们需要计算 $h[20]$。\n对于 $k=20$，理想响应的索引为 $n = k - M = 20 - 15 = 5$。\n理想冲激响应在 $n=5$ 处的值为：\n$$ h_d[5] = \\frac{\\cos(5\\pi)}{5} = \\frac{-1}{5} = -0.2 $$\n接下来，我们计算在 $k=20$ 处的窗值：\n$$ w[20] = 0.54 - 0.46\\cos\\left(\\frac{\\pi \\cdot 20}{15}\\right) = 0.54 - 0.46\\cos\\left(\\frac{4\\pi}{3}\\right) $$\n余弦项的值为 $\\cos(4\\pi/3) = -0.5$。\n$$ w[20] = 0.54 - 0.46(-0.5) = 0.54 + 0.23 = 0.77 $$\n现在，我们可以计算最终的系数值 $h[20]$：\n$$ h[20] = w[20] \\cdot h_d[5] = (0.77) \\cdot (-0.2) = -0.154 $$\n问题要求将结果四舍五入到八位有效数字。精确值为 $-0.154$。用八位有效数字表示，即为 $-0.15400000$。", "answer": "$$\\boxed{-0.15400000}$$", "id": "2864260"}, {"introduction": "在设计窄带滤波器时，理论公式的直接计算可能会遇到严重的数值稳定性问题。本练习探讨了一个关键的实际挑战：当直接计算理想带通滤波器的脉冲响应时，由于两个几乎相等的项相减，会导致灾难性抵消[@problem_id:2871850]。您将通过推导，利用三角恒等式和 $\\operatorname{sinc}$ 函数将原始表达式重写为一个数值上更稳健的形式，从而在保证计算精度的同时，加深对理想滤波器响应特性的理解。", "problem": "您正在使用窗函数法设计一个线性相位有限脉冲响应（FIR）滤波器。设理想频率响应为一个偶实值单位增益带通滤波器，定义为当 $\\omega\\in[\\omega_{1},\\omega_{2}]\\cup[-\\omega_{2},-\\omega_{1}]$ 时 $H_{d}(e^{j\\omega})=1$，其他情况下 $H_{d}(e^{j\\omega})=0$，其中 $0  \\omega_{1}  \\omega_{2}  \\pi$。设滤波器长度 $N$ 为奇数，并将其对称中心表示为 $M=(N-1)/2$。待加窗的中心化理想脉冲响应 $h_{d}[n]$ 定义为 $H_{d}(e^{j\\omega})$ 关于时间索引偏移 $m=n-M$ 的离散时间傅里叶逆变换（DTFT），使得所期望的脉冲响应关于 $m=0$ 偶对称。假设频带参数化为 $\\omega_{1}=\\omega_{0}-\\Delta/2$ 和 $\\omega_{2}=\\omega_{0}+\\Delta/2$，其中 $0  \\Delta \\ll 1$ 且 $0  \\omega_{0}  \\pi-\\Delta/2$（一个以 $\\omega_{0}$ 为中心的窄带）。所有角度均以弧度为单位。\n\n仅从 DTFT 逆变换公式和给定的 $H_{d}(e^{j\\omega})$ 出发，完成以下任务：\n\n1. 推导 $h_{d}[n]$ 关于 $m=n-M$、$\\omega_{0}$ 和 $\\Delta$ 的闭式表达式。仔细分析当 $\\Delta$ 很小时，$m=0$ 和较小 $|m|$ 时的行为，并解释若通过直接减去两个几乎相等的 $\\sin(\\cdot)$ 项来计算该表达式时，数值抵消的来源。然后，使用三角恒等式和洛必达法则（L’Hospital’s rule）将 $h_{d}[n]$改写为对所有整数 $m$（包括 $m=0$）均有效的数值稳定形式。定义 $\\operatorname{sinc}(x)$ 为 $\\sin(x)/x$，并使用 $\\operatorname{sinc}(\\cdot)$ 函数来表示 $h_{d}[n]$，使得该公式在 $\\Delta|m|$ 很小时不会出现灾难性抵消。\n\n2. 使用您得到的稳定表达式，计算极限\n$$\nR(\\omega_{0})=\\lim_{\\Delta\\to 0^{+}}\\frac{h_{d}[M+1]}{h_{d}[M]}.\n$$\n请给出仅含 $\\omega_{0}$ 的单个、精确的闭式表达式作为最终答案。不需要进行数值近似或四舍五入。角度以弧度表示。", "solution": "所述问题具有科学依据，提法恰当，客观且内部一致。它提出了数字信号处理理论中的一个标准任务：推导带通滤波器的理想脉冲响应并分析其性质。该问题是有效的，并且可以通过直接、严谨的方法求解。\n\n我们从第一性原理开始分析。期望的脉冲响应 $h_d[n]$ 被指定为关于对称中心 $M=(N-1)/2$ 偶对称。这意味着我们正在设计一个零相位滤波器，其脉冲响应是索引 $m=n-M$ 的函数，然后应用一个对应于 $M$ 个样本延迟的线性相移以确保因果性。我们用 $h_{d,c}[m]$ 表示这个零相位脉冲响应。根据离散时间傅里叶逆变换（DTFT）的定义，$h_{d,c}[m]$ 由下式给出：\n$$\nh_{d,c}[m] = \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} H_d(e^{j\\omega}) e^{j\\omega m} \\, d\\omega\n$$\n其中 $m = n-M$。问题指出，理想频率响应 $H_d(e^{j\\omega})$ 是一个单位增益带通滤波器，当 $\\omega \\in [\\omega_1, \\omega_2] \\cup [-\\omega_2, -\\omega_1]$ 时等于 $1$，其他情况为 $0$。将其代入积分，我们得到：\n$$\nh_{d,c}[m] = \\frac{1}{2\\pi} \\left( \\int_{-\\omega_2}^{-\\omega_1} e^{j\\omega m} \\, d\\omega + \\int_{\\omega_1}^{\\omega_2} e^{j\\omega m} \\, d\\omega \\right)\n$$\n我们必须计算这个积分。解取决于 $m$ 是否为零。\n\n情况1：$m \\neq 0$。\n指数函数的积分是直接的：\n$$\nh_{d,c}[m] = \\frac{1}{2\\pi} \\left( \\left[ \\frac{e^{j\\omega m}}{jm} \\right]_{-\\omega_2}^{-\\omega_1} + \\left[ \\frac{e^{j\\omega m}}{jm} \\right]_{\\omega_1}^{\\omega_2} \\right)\n$$\n$$\nh_{d,c}[m] = \\frac{1}{2\\pi jm} \\left( (e^{-j\\omega_1 m} - e^{-j\\omega_2 m}) + (e^{j\\omega_2 m} - e^{j\\omega_1 m}) \\right)\n$$\n重新整理各项以组合复指数：\n$$\nh_{d,c}[m] = \\frac{1}{2\\pi jm} \\left( (e^{j\\omega_2 m} - e^{-j\\omega_2 m}) - (e^{j\\omega_1 m} - e^{-j\\omega_1 m}) \\right)\n$$\n使用欧拉恒等式 $\\sin(x) = \\frac{e^{jx} - e^{-jx}}{2j}$，我们简化表达式：\n$$\nh_{d,c}[m] = \\frac{1}{2\\pi jm} \\left( 2j\\sin(\\omega_2 m) - 2j\\sin(\\omega_1 m) \\right)\n$$\n$$\nh_{d,c}[m] = \\frac{1}{\\pi m} (\\sin(\\omega_2 m) - \\sin(\\omega_1 m))\n$$\n\n情况2：$m = 0$。\n在这种情况下，被积函数 $e^{j\\omega m}$ 变为 $e^0=1$。积分变为：\n$$\nh_{d,c}[0] = \\frac{1}{2\\pi} \\left( \\int_{-\\omega_2}^{-\\omega_1} 1 \\, d\\omega + \\int_{\\omega_1}^{\\omega_2} 1 \\, d\\omega \\right)\n$$\n$$\nh_{d,c}[0] = \\frac{1}{2\\pi} \\left( (-\\omega_1 - (-\\omega_2)) + (\\omega_2 - \\omega_1) \\right) = \\frac{1}{2\\pi} (\\omega_2 - \\omega_1 + \\omega_2 - \\omega_1)\n$$\n$$\nh_{d,c}[0] = \\frac{2(\\omega_2 - \\omega_1)}{2\\pi} = \\frac{\\omega_2 - \\omega_1}{\\pi}\n$$\n现在，我们代入给定的参数化 $\\omega_1 = \\omega_0 - \\Delta/2$ 和 $\\omega_2 = \\omega_0 + \\Delta/2$。带宽 $\\omega_2 - \\omega_1$ 就是 $\\Delta$。\n因此对于 $m=0$，我们有 $h_{d,c}[0] = \\Delta/\\pi$。\n对于 $m \\neq 0$，代入参数化得到：\n$$\nh_{d,c}[m] = \\frac{1}{\\pi m} \\left( \\sin\\left(\\left(\\omega_0 + \\frac{\\Delta}{2}\\right)m\\right) - \\sin\\left(\\left(\\omega_0 - \\frac{\\Delta}{2}\\right)m\\right) \\right)\n$$\n这个对 $m \\neq 0$ 有效的表达式，连同 $h_{d,c}[0]=\\Delta/\\pi$，构成了理想脉冲响应的闭式表达式。\n\n我们需要分析数值抵消的来源。当带宽 $\\Delta$ 非常小（$\\Delta \\ll 1$）时，频率 $\\omega_1$ 和 $\\omega_2$ 非常接近。因此，对于任何给定的 $m$，两个正弦函数的参数 $(\\omega_0 + \\Delta/2)m$ 和 $(\\omega_0 - \\Delta/2)m$ 非常接近。在有限精度算术中，直接计算两个几乎相等的数 $\\sin((\\omega_0 + \\Delta/2)m)$ 和 $\\sin((\\omega_0 - \\Delta/2)m)$ 的差，会导致有效数字的损失。这种现象被称为灾难性抵消，它会严重降低结果的数值精度。\n\n为了获得数值稳定的形式，我们应用和差化积三角恒等式：$\\sin(A) - \\sin(B) = 2\\cos\\left(\\frac{A+B}{2}\\right)\\sin\\left(\\frac{A-B}{2}\\right)$。\n设 $A = (\\omega_0 + \\Delta/2)m$ 和 $B = (\\omega_0 - \\Delta/2)m$。那么：\n$$\n\\frac{A+B}{2} = \\frac{(\\omega_0 + \\Delta/2)m + (\\omega_0 - \\Delta/2)m}{2} = \\omega_0 m\n$$\n$$\n\\frac{A-B}{2} = \\frac{(\\omega_0 + \\Delta/2)m - (\\omega_0 - \\Delta/2)m}{2} = \\frac{\\Delta m}{2}\n$$\n将这些代入 $m \\neq 0$ 时的 $h_{d,c}[m]$ 表达式中：\n$$\nh_{d,c}[m] = \\frac{1}{\\pi m} \\left( 2\\cos(\\omega_0 m) \\sin\\left(\\frac{\\Delta m}{2}\\right) \\right)\n$$\n$$\nh_{d,c}[m] = \\frac{2}{\\pi} \\cos(\\omega_0 m) \\frac{\\sin(\\Delta m/2)}{m}\n$$\n这种形式用乘法代替了减法，从而在数值上是稳定的。为了使用 sinc 函数 $\\operatorname{sinc}(x) = \\sin(x)/x$ 来表示，我们重新整理各项：\n$$\nh_{d,c}[m] = \\frac{2}{\\pi} \\cos(\\omega_0 m) \\left(\\frac{\\Delta}{2}\\right) \\frac{\\sin(\\Delta m/2)}{\\Delta m/2}\n$$\n$$\nh_{d,c}[m] = \\frac{\\Delta}{\\pi} \\cos(\\omega_0 m) \\operatorname{sinc}\\left(\\frac{\\Delta m}{2}\\right)\n$$\n这就是稳定化的表达式。为了验证它对所有整数 $m$（包括 $m=0$）都有效，我们可以取 $m \\to 0$ 的极限。正如问题所指出的，这涉及到洛必达法则，该法则已内含在 sinc 函数在其原点的定义中。利用 $\\lim_{x\\to 0} \\operatorname{sinc}(x) = 1$ 这一事实：\n$$\n\\lim_{m\\to 0} h_{d,c}[m] = \\lim_{m\\to 0} \\frac{\\Delta}{\\pi} \\cos(\\omega_0 m) \\operatorname{sinc}\\left(\\frac{\\Delta m}{2}\\right) = \\frac{\\Delta}{\\pi} \\cos(0) \\cdot 1 = \\frac{\\Delta}{\\pi}\n$$\n这个极限与我们直接为 $h_{d,c}[0]$ 计算的值相匹配。因此，表达式 $h_d[n] = \\frac{\\Delta}{\\pi} \\cos(\\omega_0 (n-M)) \\operatorname{sinc}\\left(\\frac{\\Delta (n-M)}{2}\\right)$ 对所有整数 $n$ 都是数值稳定且正确的。这就完成了问题的第一部分。\n\n对于第二部分，我们必须计算极限 $R(\\omega_0) = \\lim_{\\Delta \\to 0^+} \\frac{h_d[M+1]}{h_d[M]}$。\n使用我们得到的 $h_{d,c}[m]$ 的稳定表达式，我们计算分子和分母。\n分母是 $h_d[M] = h_{d,c}[0]$：\n$$\nh_d[M] = \\frac{\\Delta}{\\pi}\n$$\n分子是 $h_d[M+1] = h_{d,c}[1]$（因为 $m=n-M=(M+1)-M=1$）：\n$$\nh_d[M+1] = \\frac{\\Delta}{\\pi} \\cos(\\omega_0 \\cdot 1) \\operatorname{sinc}\\left(\\frac{\\Delta \\cdot 1}{2}\\right) = \\frac{\\Delta}{\\pi} \\cos(\\omega_0) \\operatorname{sinc}\\left(\\frac{\\Delta}{2}\\right)\n$$\n现在，我们构建比率并取极限：\n$$\nR(\\omega_0) = \\lim_{\\Delta \\to 0^+} \\frac{\\frac{\\Delta}{\\pi} \\cos(\\omega_0) \\operatorname{sinc}(\\frac{\\Delta}{2})}{\\frac{\\Delta}{\\pi}}\n$$\n我们消去项 $\\Delta/\\pi$：\n$$\nR(\\omega_0) = \\lim_{\\Delta \\to 0^+} \\cos(\\omega_0) \\operatorname{sinc}\\left(\\frac{\\Delta}{2}\\right)\n$$\n由于 $\\cos(\\omega_0)$ 与 $\\Delta$ 无关，我们可以将其移到极限符号外面：\n$$\nR(\\omega_0) = \\cos(\\omega_0) \\lim_{\\Delta \\to 0^+} \\operatorname{sinc}\\left(\\frac{\\Delta}{2}\\right)\n$$\n当 $\\Delta \\to 0^+$ 时，sinc 函数的参数 $\\Delta/2 \\to 0$。根据定义，$\\lim_{x \\to 0} \\operatorname{sinc}(x) = 1$。因此：\n$$\nR(\\omega_0) = \\cos(\\omega_0) \\cdot 1 = \\cos(\\omega_0)\n$$\n这就是极限的最终精确表达式。", "answer": "$$\n\\boxed{\\cos(\\omega_{0})}\n$$", "id": "2871850"}]}