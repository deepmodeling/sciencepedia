{"hands_on_practices": [{"introduction": "许多高效的快速傅里叶变换（FFT）算法，例如经典的按时间抽取（DIT）FFT，其计算流程并非直观。它们始于一个独特的预处理步骤，即对输入数据进行“位倒序”重排。本练习 ([@problem_id:1717784]) 将通过一个具体的计算，帮助你掌握这一关键的初始环节，为理解FFT的完整蝶形运算结构打下基础。", "problem": "一位嵌入式系统工程师的任务是在内存有限的微控制器上实现一个实时音频频谱分析仪。为实现这一目标，该工程师决定使用基2时间抽取（DIT）快速傅里叶变换（FFT）算法。该算法的第一个关键步骤是在主蝶形运算开始前，对输入的时域样本进行重新排序。这种重新排序是通过将原始序列中索引为 $n$ 的样本 $x[n]$ 放置到乱序序列中新的位置，即索引 $k$ 来完成的。新的索引 $k$ 是通过反转原始索引 $n$ 的二进制表示来找到的。\n\n考虑一个离散时间信号，经过采样后产生一个 $N=8$ 点的序列，记为 $x[n]$，$n=0, 1, 2, ..., 7$。根据DIT-FFT的位反转流程，样本 $x[6]$ 将被移动到重新排序后的输入缓冲区中的一个新索引位置。这个新索引的数值是多少？", "solution": "在一个序列长度为 $N=2^{m}$ 的基2 DIT-FFT中，位反转重排通过反转 $n$ 的 $m$ 位二进制表示，将索引 $n$ 映射到 $k$。形式上，如果 $n=\\sum_{i=0}^{m-1} b_{i} 2^{i}$，其中 $b_{i}\\in\\{0,1\\}$，那么位反转后的索引是\n$$\nk=\\sum_{i=0}^{m-1} b_{i} 2^{m-1-i}.\n$$\n对于 $N=8$，我们有 $m=\\log_{2}(8)=3$。索引 $n=6$ 的3位二进制表示为\n$$\n6=1\\cdot 2^{2}+1\\cdot 2^{1}+0\\cdot 2^{0}\\;\\Rightarrow\\;(110)_{2},\n$$\n所以 $b_{2}=1$，$b_{1}=1$，$b_{0}=0$。反转这三位得到 $(011)_{2}$，其十进制值为\n$$\nk=0\\cdot 2^{2}+1\\cdot 2^{1}+1\\cdot 2^{0}=3.\n$$\n因此，在 $N=8$ 的DIT-FFT位反转重排下，样本 $x[6]$ 被移动到索引 $k=3$。", "answer": "$$\\boxed{3}$$", "id": "1717784"}, {"introduction": "快速傅里叶变换最强大的应用之一是实现快速卷积，这是数字信号处理中的一项核心运算。然而，离散傅里叶变换（DFT）的卷积定理在本质上对应的是“循环卷积”，而非我们通常需要的“线性卷积”。本练习 ([@problem_id:2870696]) 将引导你通过一个具体例子，亲手计算并对比两种卷积的结果，从而深刻理解因变换长度不足而产生的时域混叠现象，并掌握使用补零来确保FFT正确实现线性卷积的关键技术。", "problem": "考虑两个有限长度的离散时间序列 $x[n]$ 和 $h[n]$，其定义为对于所有 $n \\notin \\{0,1,2,3,4\\}$，$x[n] = 0$；对于所有 $n \\notin \\{0,1,2\\}$，$h[n] = 0$。其显式非零样本值为\n- $x[0] = 1$, $x[1] = -1$, $x[2] = 2$, $x[3] = 0$, $x[4] = 1$,\n- $h[0] = 2$, $h[1] = 0$, $h[2] = 3$。\n\n从离散时间域中线性卷积和 $N$点循环卷积的基本定义，以及离散傅里叶变换 (DFT) 的定义及其循环卷积性质出发。不要使用任何未经证明的简化公式。\n\n仅基于这些基础，完成以下任务：\n\n- 计算线性卷积 $y_{\\text{lin}}[k] = \\sum_{m=-\\infty}^{\\infty} x[m]\\,h[k-m]$，对所有其值非零的整数 $k$。\n- 当 $N=6$ 时，计算 $N$点循环卷积 $y_{\\text{circ},N}[k] = \\sum_{m=0}^{N-1} x[(m)]_{N}\\,h[(k-m)]_{N}$，其中 $k \\in \\{0,1,\\dots,N-1\\}$。这里 $[\\cdot]_{N}$ 表示模$N$索引，$x[(n)]_{N}$ 和 $h[(n)]_{N}$ 是将 $x[n]$ 和 $h[n]$ 补零至长度 $N$ 后的长度为$N$的周期性扩展。\n- 使用离散傅里叶变换 (DFT) 及其循环卷积性质，解释为什么 $y_{\\text{circ},6}[k]$ 与 $y_{\\text{lin}}[k]$ 不同，并将此差异解释为当变换长度不足时，由 DFT 引起的周期性扩展所导致的时域混叠。\n- 确定最小的2的幂次变换长度 $N$，使得如果将 $x[n]$ 和 $h[n]$ 都补零到长度 $N$，并通过 $N$点循环卷积（如同基于快速傅里叶变换 (FFT) 的方法所实现的那样）进行卷积，其结果在所有索引上都等于线性卷积，且不产生混叠。\n\n作为最终报告的答案，仅提供这个最小的2的幂次 $N$ 值，以单个整数形式。无需四舍五入。无需单位。", "solution": "首先验证问题是自洽的、有科学依据且定义明确的。所有必要的数据和定义都已提供，背景是标准的数字信号处理理论，任务清晰明确。问题有效。我们开始求解。\n\n问题要求从基本定义出发。我们首先陈述这些定义。\n两个序列是 $x[n]$ 和 $h[n]$。序列 $x[n]$ 仅在 $n \\in \\{0, 1, 2, 3, 4\\}$ 上非零，长度为 $L_x = 5$。序列 $h[n]$ 仅在 $n \\in \\{0, 1, 2\\}$ 上非零，长度为 $L_h = 3$。具体值为：\n$x[n] = \\{1, -1, 2, 0, 1\\}$，对于 $n \\in \\{0, 1, 2, 3, 4\\}$。\n$h[n] = \\{2, 0, 3\\}$，对于 $n \\in \\{0, 1, 2\\}$。\n\n两个离散时间序列 $x[n]$ 和 $h[n]$ 的线性卷积定义为：\n$$ y_{\\text{lin}}[k] = (x * h)[k] = \\sum_{m=-\\infty}^{\\infty} x[m] h[k-m] $$\n结果序列 $y_{\\text{lin}}[k]$ 的长度为 $L_y = L_x + L_h - 1$。\n\n两个长度为$N$的序列 $x_N[n]$ 和 $h_N[n]$ 的$N$点循环卷积定义为：\n$$ y_{\\text{circ},N}[k] = \\sum_{m=0}^{N-1} x_N[m] h_N[(k-m) \\pmod N] $$\n对于 $k \\in \\{0, 1, \\dots, N-1\\}$。序列 $x_N[n]$ 和 $h_N[n]$ 通常是通过将原始序列 $x[n]$ 和 $h[n]$ 补零到长度 $N$ 形成的。\n\n$N$点离散傅里叶变换 (DFT) 的循环卷积性质表明，两个序列循环卷积的DFT是它们各自DFT的乘积：\n$$ \\text{DFT}\\{y_{\\text{circ},N}[n]\\} = \\text{DFT}\\{x_N[n]\\} \\cdot \\text{DFT}\\{h_N[n]\\} $$\n该性质的一个关键推论是连接循环卷积和线性卷积的时域混叠公式。如果 $y_{\\text{lin}}[n]$ 是 $x[n]$ 和 $h[n]$ 的线性卷积，而 $y_{\\text{circ},N}[n]$ 是它们补零版本后的$N$点循环卷积，则：\n$$ y_{\\text{circ},N}[k] = \\sum_{r=-\\infty}^{\\infty} y_{\\text{lin}}[k + rN] \\quad \\text{for } k \\in \\{0, 1, \\dots, N-1\\} $$\n这个关系是我们分析的基础。\n\n**第一部分：线性卷积**\n\n序列的长度为 $L_x = 5$ 和 $L_h = 3$。线性卷积 $y_{\\text{lin}}[k]$ 的长度为 $L_y = L_x + L_h - 1 = 5 + 3 - 1 = 7$。卷积在 $k \\in \\{0, 1, 2, 3, 4, 5, 6\\}$ 上非零。我们计算其值。\n$y_{\\text{lin}}[0] = x[0]h[0] = (1)(2) = 2$。\n$y_{\\text{lin}}[1] = x[0]h[1] + x[1]h[0] = (1)(0) + (-1)(2) = -2$。\n$y_{\\text{lin}}[2] = x[0]h[2] + x[1]h[1] + x[2]h[0] = (1)(3) + (-1)(0) + (2)(2) = 3 + 4 = 7$。\n$y_{\\text{lin}}[3] = x[1]h[2] + x[2]h[1] + x[3]h[0] = (-1)(3) + (2)(0) + (0)(2) = -3$。\n$y_{\\text{lin}}[4] = x[2]h[2] + x[3]h[1] + x[4]h[0] = (2)(3) + (0)(0) + (1)(2) = 6 + 2 = 8$。\n$y_{\\text{lin}}[5] = x[3]h[2] + x[4]h[1] = (0)(3) + (1)(0) = 0$。\n$y_{\\text{lin}}[6] = x[4]h[2] = (1)(3) = 3$。\n因此，线性卷积的结果为序列：\n$y_{\\text{lin}}[k] = \\{2, -2, 7, -3, 8, 0, 3\\}$，对于 $k \\in \\{0, 1, \\dots, 6\\}$。\n\n**第二部分：$N=6$ 的循环卷积**\n\n对于 $N=6$，我们首先将序列 $x[n]$ 和 $h[n]$ 补零到长度6：\n$x_6[n] = \\{1, -1, 2, 0, 1, 0\\}$，对于 $n \\in \\{0, 1, \\dots, 5\\}$。\n$h_6[n] = \\{2, 0, 3, 0, 0, 0\\}$，对于 $n \\in \\{0, 1, \\dots, 5\\}$。\n我们计算 $y_{\\text{circ},6}[k] = \\sum_{m=0}^{5} x_6[m] h_6[(k-m) \\pmod 6]$。\n$y_{\\text{circ},6}[0] = \\sum_{m=0}^{5} x_6[m] h_6[(-m) \\pmod 6] = x_6[0]h_6[0] + x_6[1]h_6[5] + x_6[2]h_6[4] + x_6[3]h_6[3] + x_6[4]h_6[2] + x_6[5]h_6[1] = (1)(2) + (-1)(0) + (2)(0) + (0)(0) + (1)(3) + (0)(0) = 2 + 3 = 5$。\n$y_{\\text{circ},6}[1] = \\sum_{m=0}^{5} x_6[m] h_6[(1-m) \\pmod 6] = x_6[0]h_6[1] + x_6[1]h_6[0] + \\dots = (1)(0) + (-1)(2) = -2$。\n$y_{\\text{circ},6}[2] = \\sum_{m=0}^{5} x_6[m] h_6[(2-m) \\pmod 6] = x_6[0]h_6[2] + x_6[1]h_6[1] + x_6[2]h_6[0] + \\dots = (1)(3) + (-1)(0) + (2)(2) = 3 + 4 = 7$。\n$y_{\\text{circ},6}[3] = x_6[1]h_6[2] + x_6[2]h_6[1] + x_6[3]h_6[0] + \\dots = (-1)(3) + (2)(0) + (0)(2) = -3$。\n$y_{\\text{circ},6}[4] = x_6[2]h_6[2] + x_6[3]h_6[1] + x_6[4]h_6[0] + \\dots = (2)(3) + (0)(0) + (1)(2) = 6 + 2 = 8$。\n$y_{\\text{circ},6}[5] = x_6[3]h_6[2] + x_6[4]h_6[1] + x_6[5]h_6[0] + \\dots = (0)(3) + (1)(0) + (0)(2) = 0$。\n6点循环卷积的结果为序列：\n$y_{\\text{circ},6}[k] = \\{5, -2, 7, -3, 8, 0\\}$，对于 $k \\in \\{0, 1, \\dots, 5\\}$。\n\n**第三部分：差异分析**\n\n将线性卷积 $y_{\\text{lin}}[k] = \\{2, -2, 7, -3, 8, 0, 3\\}$ 与6点循环卷积 $y_{\\text{circ},6}[k] = \\{5, -2, 7, -3, 8, 0\\}$ 进行比较，我们观察到对于 $k \\in \\{1, 2, 3, 4, 5\\}$ 的值是相同的。然而，$y_{\\text{circ},6}[0] = 5$ 而 $y_{\\text{lin}}[0] = 2$。\n这种差异可以通过时域混叠来解释，其基本关系如下：\n$y_{\\text{circ},N}[k] = \\sum_{r=-\\infty}^{\\infty} y_{\\text{lin}}[k + rN]$。\n对于我们 $N=6$ 的情况，该关系为 $y_{\\text{circ},6}[k] = \\sum_{r=-\\infty}^{\\infty} y_{\\text{lin}}[k + 6r]$。\n由于线性卷积 $y_{\\text{lin}}[k]$ 的有限长度为 $L_y=7$，所以这个和中只有很少的非零项。\n对于 $k=0$：\n$y_{\\text{circ},6}[0] = \\dots + y_{\\text{lin}}[-6] + y_{\\text{lin}}[0] + y_{\\text{lin}}[6] + y_{\\text{lin}}[12] + \\dots$。\n由于 $y_{\\text{lin}}[k]$ 在范围 $k \\in \\{0, \\dots, 6\\}$之外为零，这可以简化为：\n$y_{\\text{circ},6}[0] = y_{\\text{lin}}[0] + y_{\\text{lin}}[6] = 2 + 3 = 5$。\n这个计算结果与直接计算出的 $y_{\\text{circ},6}[0]$ 的值完全匹配。这种现象称为时域混叠。线性卷积的长度 $L_y=7$ 大于 DFT 的长度 $N=6$。因此，线性卷积结果中索引为 $k=6$ 的样本（$y_{\\text{lin}}[6]=3$）会“环绕”并加到索引为 $k=6 \\pmod 6 = 0$ 的样本上。\n对于任何其他索引 $k \\in \\{1, \\dots, 5\\}$，和 $\\sum_{r} y_{\\text{lin}}[k+6r]$ 只有一个非零项，即 $y_{\\text{lin}}[k]$ 本身，因为对于任何非零整数 $r$，$k+6r$都会在支撑集 $\\{0, \\dots, 6\\}$ 之外。例如，对于 $k=1$，$y_{\\text{circ},6}[1] = y_{\\text{lin}}[1] = -2$。\n\n**第四部分：最小的2的幂次DFT长度**\n\n为了使用基于FFT的方法（该方法计算循环卷积）来执行线性卷积，我们必须选择一个足够大的DFT长度 $N$ 以避免时域混叠。当且仅当不发生环绕时，循环卷积结果 $y_{\\text{circ},N}[k]$ 才会在 $k \\in \\{0, \\dots, L_y-1\\}$ 上与线性卷积结果 $y_{\\text{lin}}[k]$ 相同。\n这要求变换长度 $N$ 足够大，以容纳线性卷积结果的完整长度 $L_y$。条件是：\n$N \\ge L_y$。\n在我们的问题中，$L_x = 5$ 且 $L_h = 3$，所以线性卷积的长度是 $L_y = L_x + L_h - 1 = 5 + 3 - 1 = 7$。\n因此，所需的最小DFT长度为 $N \\ge 7$。\n\n问题要求满足此条件的最小*2的幂次*变换长度 $N$。这是使用快速傅里叶变换 (FFT) 算法进行高效实现的常见约束。我们必须找到最小的整数 $p$ 使得 $N = 2^p$ 且 $N \\ge 7$。\n我们检查2的幂次：\n$2^1 = 2  7$\n$2^2 = 4  7$\n$2^3 = 8 \\ge 7$\n大于或等于7的最小的2的幂次是8。\n因此，所需的变换长度是 $N=8$。使用这个长度，两个序列都将被补零到长度8，它们的8点DFT相乘，然后8点逆DFT将得到序列 $\\{2, -2, 7, -3, 8, 0, 3, 0\\}$，这正确地表示了补一个零后的线性卷积结果。", "answer": "$$\n\\boxed{8}\n$$", "id": "2870696"}, {"introduction": "在从理论走向实践的过程中，我们必须处理真实世界信号的复杂性。当待分析信号的频率不能精确地落在FFT的某个频率点（bin）上时，其能量会“泄漏”到相邻的频率点中，这种现象被称为频谱泄漏。本练习 ([@problem_id:1717762]) 要求你量化这种泄漏效应，通过计算相邻频率仓的能量比率，从而更深入地理解FFT的分辨率限制以及加窗效应的本质。", "problem": "一位工程师正在分析来自一台大型工业电机的振动信号。在此分析中，信号被建模为一个纯正弦波，$x(t) = \\cos(2\\pi f_c t)$，其中幅度和相位的影响被忽略，因为它们不影响最终所需的比率。该信号由一个模数转换器 (ADC) 以 $f_s = 8000 \\text{ Hz}$ 的采样率进行采样。总共采集 $N = 1024$ 个样本，然后使用快速傅里叶变换 (FFT) 算法进行处理，该算法计算离散傅里叶变换 (DFT)。\n\n电机的真实转动频率产生的振动信号频率为 $f_c = 150.0 \\text{ Hz}$。由于采样时长有限，该频率并不与 1024 点 FFT 的任何一个频率仓精确重合。结果，信号的能量表现为分散在多个频率仓中，这种现象被称为频谱泄漏。\n\n设 $X[k]$ 为 FFT 第 $k$ 个频率仓的复值系数，其中 $k$ 是从 $0$ 到 $N-1$ 的整数。计算真实频率之上相邻频率仓中 FFT 系数的幅值与真实频率之下相邻频率仓中 FFT 系数的幅值之比。具体来说，确定比值 $|X[k_{above}]| / |X[k_{below}]|$ 的值，其中 $k_{below}$ 和 $k_{above}$ 分别是紧邻真实信号频率 $f_c$ 以下和以上的整数频率仓索引。\n\n将你的答案表示为一个四舍五入到三位有效数字的实数。", "solution": "我们对连续时间正弦波 $x(t)=\\cos(2\\pi f_{c}t)$ 进行采样，得到离散时间序列 $x[n]=\\cos\\!\\left(2\\pi \\frac{f_{c}}{f_{s}}n\\right)$，其中 $n=0,\\ldots,N-1$。$N$ 点 DFT 定义为\n$$\nX[k]=\\sum_{n=0}^{N-1}x[n]\\exp\\!\\left(-j\\frac{2\\pi kn}{N}\\right).\n$$\n使用 $x[n]=\\frac{1}{2}\\left(\\exp\\!\\left(j2\\pi \\frac{f_{c}}{f_{s}}n\\right)+\\exp\\!\\left(-j2\\pi \\frac{f_{c}}{f_{s}}n\\right)\\right)$ 和线性性质，\n$$\nX[k]=\\frac{1}{2}X_{+}[k]+\\frac{1}{2}X_{-}[k],\n$$\n其中\n$$\nX_{+}[k]=\\sum_{n=0}^{N-1}\\exp\\!\\left(j2\\pi n\\left(\\frac{f_{c}}{f_{s}}-\\frac{k}{N}\\right)\\right),\\qquad\nX_{-}[k]=\\sum_{n=0}^{N-1}\\exp\\!\\left(-j2\\pi n\\left(\\frac{f_{c}}{f_{s}}+\\frac{k}{N}\\right)\\right).\n$$\n每一项都是一个有限几何级数。设 $\\Delta=\\frac{f_{c}}{f_{s}}-\\frac{k}{N}$。则\n$$\nX_{+}[k]=\\exp\\!\\left(j\\pi (N-1)\\Delta\\right)\\frac{\\sin(\\pi N\\Delta)}{\\sin(\\pi \\Delta)},\n$$\n所以\n$$\n|X_{+}[k]|=\\frac{|\\sin(\\pi N\\Delta)|}{|\\sin(\\pi \\Delta)|}.\n$$\n将单频信号的频率仓位置定义为 $r=\\frac{Nf_{c}}{f_{s}}$，小数偏移量定义为 $\\alpha=r-\\lfloor r\\rfloor\\in(0,1)$。$f_{c}$ 周围的相邻频率仓是 $k_{below}=\\lfloor r\\rfloor$ 和 $k_{above}=\\lfloor r\\rfloor+1$。则\n$$\n\\Delta_{below}=\\frac{f_{c}}{f_{s}}-\\frac{k_{below}}{N}=\\frac{r}{N}-\\frac{\\lfloor r\\rfloor}{N}=\\frac{\\alpha}{N},\\qquad\n\\Delta_{above}=\\frac{f_{c}}{f_{s}}-\\frac{k_{above}}{N}=\\frac{\\alpha-1}{N}=-\\frac{1-\\alpha}{N}.\n$$\n因此，对于接近 $+f_{c}$ 的复指数分量，\n$$\n|X_{+}[k_{below}]|=\\frac{|\\sin(\\pi \\alpha)|}{|\\sin(\\pi \\alpha/N)|},\\qquad\n|X_{+}[k_{above}]|=\\frac{|\\sin(\\pi (1-\\alpha))|}{|\\sin(\\pi (1-\\alpha)/N)|}.\n$$\n使用 $|\\sin(\\pi \\alpha)|=|\\sin(\\pi (1-\\alpha))|$，由主瓣决定的比率为\n$$\nR\\equiv\\frac{|X[k_{above}]|}{|X[k_{below}]|}\\approx\\frac{|X_{+}[k_{above}]|}{|X_{+}[k_{below}]|}=\\frac{\\sin(\\pi \\alpha/N)}{\\sin(\\pi (1-\\alpha)/N)}.\n$$\n现在代入给定参数求 $\\alpha$。当 $f_{s}=8000$，$N=1024$ 且 $f_{c}=150$ 时，\n$$\nr=\\frac{Nf_{c}}{f_{s}}=\\frac{1024\\cdot 150}{8000}=19.2,\\qquad \\alpha=0.2.\n$$\n因此\n$$\nR=\\frac{\\sin\\!\\left(\\pi\\cdot \\frac{0.2}{1024}\\right)}{\\sin\\!\\left(\\pi\\cdot \\frac{0.8}{1024}\\right)}.\n$$\n因为自变量很小，使用 $\\sin(x)\\approx x$ 可得\n$$\nR\\approx\\frac{\\pi\\cdot 0.2/1024}{\\pi\\cdot 0.8/1024}=\\frac{0.2}{0.8}=\\frac{1}{4}=0.25.\n$$\n四舍五入到三位有效数字，该比率为 $0.250$。", "answer": "$$\\boxed{0.250}$$", "id": "1717762"}]}