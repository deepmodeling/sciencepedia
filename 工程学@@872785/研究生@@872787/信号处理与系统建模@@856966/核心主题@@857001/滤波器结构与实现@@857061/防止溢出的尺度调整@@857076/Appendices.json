{"hands_on_practices": [{"introduction": "我们的第一个练习旨在解决定点设计中最基本的挑战：如何将一个信号最好地适配到量化器有限的范围内。我们将推导出一个最优缩放因子，它能充分利用整个动态范围以最大化信号质量，同时避免引入溢出错误。这个练习为后续所有缩放策略奠定了基础。", "problem": "一个实值离散时间信号 $x[n]$ 已知满足边界条件 $|x[n]| \\leq X_{\\max}$，其中给定 $X_{\\max}  0$。在量化之前，该信号通过一个正常数 $s$ 进行缩放，得到 $y[n] = s \\, x[n]$。信号 $y[n]$ 随后被量化为有符号二进制补码定点格式，总字长为 $W$ 位，其中 $W \\geq 2$。该格式包含一个符号位（整数位）和 $W-1$ 个小数位（通常表示为 $Q1.(W-1)$）。在此格式中，可表示的范围是 $[-1, \\, 1 - 2^{-(W-1)}]$，而可表示的最大幅值为 $1 - 2^{-(W-1)}$。\n\n仅使用关于定点表示、均匀舍入量化以及在无溢出约束下通过最大化可容许信号幅值而不超过可表示范围来实现信噪比（SNR）最大化的定义，完成以下任务：\n\n- 推导缩放因子 $s$ 的解析表达式，该表达式在给定 $x[n]$ 的边界条件下，对所有 $n$ 都能最大化信噪比并保证不发生溢出。\n- 假设边界 $X_{\\max}$ 保守了一个因子 $k  1$，意味着 $x[n]$ 的真实最大幅值为 $X_{\\max}/k$。将裕量（headroom）定义为满量程与实际缩放后峰值之间的幅值余量，使用 $20 \\log_{10}(\\cdot)$ 以分贝（dB）表示。推导此裕量关于 $k$ 和 $W$ 的闭式表达式。\n\n将 $s$ 和裕量的最终答案表示为关于 $W$、$X_{\\max}$ 和 $k$ 的闭式符号表达式。以分贝为单位提供裕量。不要进行任何数值计算或舍入。", "solution": "该问题定义明确且科学上合理，允许基于定点数字信号处理的原理直接进行解析求解。我们将按要求分两部分进行推导。\n\n首先，我们推导缩放因子 $s$。\n系统采用有符号二进制补码定点格式，字长为 $W$ 位，包含一个符号位和 $W-1$ 个小数位。问题指明，一个值 $y$ 的可表示数值范围是 $[-1, 1 - 2^{-(W-1)}]$。问题进一步定义了可表示的最大幅值为 $1 - 2^{-(W-1)}$。无溢出条件要求缩放后信号的幅值 $|y[n]|$ 在任何时间索引 $n$ 处都不得超过此值。\n缩放后的信号由 $y[n] = s \\, x[n]$ 给出，其中 $s$ 是一个正常数（$s  0$）。因此，无溢出约束为：\n$$|y[n]| = |s \\, x[n]| = s |x[n]| \\le 1 - 2^{-(W-1)}$$\n这个不等式必须对输入信号 $x[n]$ 的所有可能值都成立。已知输入信号受限于 $|x[n]| \\le X_{\\max}$。为了在所有情况下都保证无溢出条件，我们必须考虑最坏情况，即输入信号达到其最大可能幅值 $|x[n]| = X_{\\max}$。将此代入不等式，得到对缩放因子 $s$ 的约束：\n$$s \\, X_{\\max} \\le 1 - 2^{-(W-1)}$$\n问题指出，最大化信噪比（SNR）是通过最大化可容许的信号幅值来实现的。这对应于选择在满足无溢出约束条件下的最大可能缩放因子 $s$。因此，我们选择 $s$ 使等式成立：\n$$s \\, X_{\\max} = 1 - 2^{-(W-1)}$$\n求解 $s$ 可得到最优缩放因子的表达式：\n$$s = \\frac{1 - 2^{-(W-1)}}{X_{\\max}}$$\n\n其次，我们推导裕量的表达式。\n缩放因子 $s$ 是基于输入信号最大幅值为 $X_{\\max}$ 这一保守假设确定的。现在揭示该边界是保守的，信号的真实最大幅值为 $|x[n]|_{\\text{true\\_max}} = X_{\\max}/k$，其中 $k  1$。\n缩放后信号的实际峰值幅值，我们记为 $|y|_{\\text{peak}}$，是通过将缩放因子 $s$ 应用于输入信号的真实峰值来找到的：\n$$|y|_{\\text{peak}} = s \\cdot |x[n]|_{\\text{true\\_max}} = s \\cdot \\frac{X_{\\max}}{k}$$\n代入我们推导出的 $s$ 的表达式：\n$$|y|_{\\text{peak}} = \\left( \\frac{1 - 2^{-(W-1)}}{X_{\\max}} \\right) \\cdot \\frac{X_{\\max}}{k} = \\frac{1 - 2^{-(W-1)}}{k}$$\n裕量被定义为满量程值与实际缩放后峰值之间的幅值余量，以分贝表示。满量程值 $FS$ 是最大可表示幅值，即 $FS = 1 - 2^{-(W-1)}$。裕量，记为 $H_{\\text{dB}}$，计算为满量程值与实际峰值信号幅值之比的 $20 \\log_{10}$。\n$$H_{\\text{dB}} = 20 \\log_{10}\\left(\\frac{FS}{|y|_{\\text{peak}}}\\right)$$\n代入 $FS$ 和 $|y|_{\\text{peak}}$ 的表达式：\n$$H_{\\text{dB}} = 20 \\log_{10}\\left(\\frac{1 - 2^{-(W-1)}}{\\frac{1 - 2^{-(W-1)}}{k}}\\right)$$\n项 $(1 - 2^{-(W-1)})$ 在分子和分母中被消去，留下一个简单的比率表达式：\n$$H_{\\text{dB}} = 20 \\log_{10}(k)$$\n这个结果表明，以分贝表示的裕量仅取决于初始边界 $X_{\\max}$ 的保守因子 $k$。对比率中的字长 $W$ 的依赖性被消除了，这是缩放方法的逻辑结果。\n因此，两个所需的表达式都已确定。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{1 - 2^{-(W-1)}}{X_{\\max}}  20 \\log_{10}(k) \\end{pmatrix}}$$", "id": "2903048"}, {"introduction": "在实现具有内部存储的系统（例如IIR滤波器）时，缩放问题变得更加微妙。一个对于最终输出安全的缩放因子，可能不足以防止内部计算节点发生溢出。本练习 [@problem_id:2903073] 通过一个直接I型IIR滤波器的实例，揭示了这一关键陷阱，并强调了分析信号路径上每个节点的必要性。", "problem": "考虑一个因果、线性时不变、单输入单输出的离散时间系统，其传递函数为 $H(z) = \\dfrac{1 - r z^{-1}}{1 - p z^{-1}}$，并以规范直接I型结构实现。输入为 $x[n]$，内部前馈加法器节点为 $v[n]$，输出为 $y[n]$。前馈和反馈部分的连接方式为 $v[n] = b_{0} x[n] + b_{1} x[n-1]$（其中 $b_{0} = 1$，$b_{1} = -r$）以及 $y[n] - p\\,y[n-1] = v[n]$。假设系统是有界输入有界输出稳定的，输入对于所有 $n$ 都受限于 $|x[n]| \\leq 1$，并且所有内部信号都必须位于可表示范围 $[-1,1]$ 内。\n\n一种常见的“朴素”全局输入缩放方法使用脉冲响应的 $\\ell_{1}$ 范数，即通过一个正常数 $s$ 来缩放输入，使得对于所有容许输入，通过施加 $s \\leq 1/\\|h\\|_{1}$ 来满足 $|s\\,y[n]| \\leq 1$，其中 $\\|h\\|_{1} = \\sum_{n=-\\infty}^{\\infty} |h[n]|$。在本题中，您将证明这种朴素选择可能会低估直接I型无限脉冲响应（IIR）实现中的内部节点范围，然后相应地更新缩放方法。\n\n使用具体的参数选择 $p = \\dfrac{99}{100}$ 和 $r = \\dfrac{999}{1000}$。仅从线性时不变卷积和序列空间之间诱导范数的基本定义出发，完成以下任务：\n\n1. 对于一般的实数 $p$ 和 $r$（其中 $|p|  1$），推导 $H(z)$ 的脉冲响应 $h[n]$，然后计算给定 $p$ 和 $r$ 下的 $\\|h\\|_{1}$。\n2. 仅使用线性时不变算子的诱导 $\\ell_{\\infty} \\to \\ell_{\\infty}$ 范数的定义以及内部节点 $v[n]$ 相对于 $x[n]$ 的线性关系，推导出一个形式为 $\\sup_{n} |v[n]| \\leq \\gamma \\sup_{n} |x[n]|$ 的界，并为给定的 $p$ 和 $r$ 显式计算 $\\gamma$。\n3. 通过比较您得到的两个界，解释为什么对于给定的 $p$ 和 $r$，朴素选择 $s = 1/\\|h\\|_{1}$ 无法防止内部节点 $v[n]$ 发生溢出。\n4. 更新全局输入缩放规则，以确保对于所有 $n$，都有 $|s\\,y[n]| \\leq 1$ 和 $|s\\,v[n]| \\leq 1$，并为给定的 $p$ 和 $r$ 计算满足条件的最大 $s$。\n\n请以保证 $y[n]$ 和 $v[n]$ 均不发生溢出的最大全局输入缩放因子 $s$ 的精确值作为您的最终答案。不需要四舍五入，也不需要单位。最终答案必须是单个数字或单个闭式解析表达式。", "solution": "对所提供问题的有效性进行了严谨的分析。该问题在科学上基于离散时间信号处理的原理，特别是线性时不变（LTI）系统、其实现以及为防止定点运算中溢出而进行的缩放这一实际问题。给定条件是自洽且一致的。传递函数 $H(z)$ 与给定的差分方程相对应：从 $v[n] = x[n] - r x[n-1]$ 和 $y[n] = p y[n-1] + v[n]$，我们得到 $V(z) = (1 - r z^{-1})X(z)$ 和 $Y(z)(1 - p z^{-1}) = V(z)$，由此得出 $H(z) = Y(z)/X(z) = \\dfrac{1 - r z^{-1}}{1 - p z^{-1}}$。该问题是适定且客观的。\n\n然而，在问题陈述的最后部分存在一个关键的语言缺陷：“计算满足条件的最小 $s$”。缩放因子 $s$ 必须是正数以保持信号方向。能够防止溢出的有效缩放因子 $s$ 的集合是一个形如 $(0, s_{\\text{max}}]$ 的区间。这个集合没有最小元素；其下确界为 $0$，这对应于将信号置零，是一个无信息量的平凡解。在定点实现和信号处理的背景下，目标始终是找到利用全部动态范围而又不引起溢出的*最大*缩放因子 $s_{\\text{max}}$。严格的解释会因其模糊性而使问题无效。我将通过修正此有缺陷的措辞，并求解具有物理和算法意义的量：最大允许缩放因子。\n\n解题过程将根据指定的四个任务进行组织。\n\n1. 推导脉冲响应 $h[n]$ 及其 $\\ell_{1}$ 范数。\n系统的传递函数为 $H(z) = \\dfrac{1 - r z^{-1}}{1 - p z^{-1}}$。对于指定的因果系统，我们可以进行部分分式展开或代数操作。\n$$ H(z) = \\frac{1}{1 - p z^{-1}} - \\frac{r z^{-1}}{1 - p z^{-1}} $$\n对于一个因果系统，$\\frac{1}{1 - a z^{-1}}$ 的Z逆变换是 $a^n u[n]$，其中 $u[n]$ 是亥维赛德阶跃函数。时移特性指出 $z^{-k} G(z)$ 在时域中对应于 $g[n-k]$。应用这些原理：\n$$ h[n] = p^n u[n] - r p^{n-1} u[n-1] $$\n我们可以分段写出这个脉冲响应。当 $n=0$ 时，$h[0] = p^0 u[0] - r p^{-1} u[-1] = 1 \\cdot 1 - r p^{-1} \\cdot 0 = 1$。当 $n \\ge 1$ 时，$h[n] = p^n - r p^{n-1} = p^{n-1}(p-r)$。\n因此，脉冲响应可以表示为：\n$$ h[n] = \\delta[n] + (p-r)p^{n-1}u[n-1] $$\n其中 $\\delta[n]$ 是克罗内克δ函数。问题要求系统是BIBO稳定的，这意味着所有极点必须在单位圆内。唯一的极点在 $z=p$，所以我们要求 $|p|1$。这是给定的。脉冲响应的 $\\ell_{1}$ 范数定义为 $\\|h\\|_{1} = \\sum_{n=-\\infty}^{\\infty} |h[n]|$。\n$$ \\|h\\|_{1} = |h[0]| + \\sum_{n=1}^{\\infty} |h[n]| = |1| + \\sum_{n=1}^{\\infty} |(p-r)p^{n-1}| $$\n$$ \\|h\\|_{1} = 1 + |p-r| \\sum_{n=1}^{\\infty} |p|^{n-1} $$\n这个求和是一个几何级数 $\\sum_{k=0}^{\\infty} |p|^k = \\frac{1}{1-|p|}$，因为 $|p|1$。\n$$ \\|h\\|_{1} = 1 + \\frac{|p-r|}{1-|p|} $$\n对于给定的参数 $p = \\frac{99}{100}$ 和 $r = \\frac{999}{1000}$，由于 $p0$，我们有 $|p|=p$。\n$$ p-r = \\frac{99}{100} - \\frac{999}{1000} = \\frac{990 - 999}{1000} = -\\frac{9}{1000} $$\n$$ |p-r| = \\frac{9}{1000} $$\n$$ 1-|p| = 1 - \\frac{99}{100} = \\frac{1}{100} $$\n将这些值代入 $\\|h\\|_{1}$ 的表达式中：\n$$ \\|h\\|_{1} = 1 + \\frac{\\frac{9}{1000}}{\\frac{1}{100}} = 1 + \\frac{9}{10} = \\frac{19}{10} $$\n\n2. 推导内部节点 $v[n]$ 的界。\n内部节点信号 $v[n]$ 通过差分方程 $v[n] = x[n] - r x[n-1]$ 与输入 $x[n]$ 相关联。这是一个LTI系统。设其脉冲响应为 $h_v[n]$，即输入为 $x[n]=\\delta[n]$ 时的输出 $v[n]$。\n$$ h_v[n] = \\delta[n] - r \\delta[n-1] $$\n该脉冲响应只有两个非零值：$h_v[0] = 1$ 和 $h_v[1] = -r$。\n问题要求一个形如 $\\sup_{n} |v[n]| \\leq \\gamma \\sup_{n} |x[n]|$ 的界。常数 $\\gamma$ 是将 $x[n]$ 映射到 $v[n]$ 的LTI算子的诱导 $\\ell_{\\infty} \\to \\ell_{\\infty}$ 范数。对于脉冲响应为 $h_v[n]$ 的LTI系统，此范数由 $\\|h_v\\|_{1}$ 给出。\n让我们证明这个基本结果。输出由卷积给出：$v[n] = \\sum_{k=-\\infty}^{\\infty} h_v[k] x[n-k]$。\n取绝对值：\n$$ |v[n]| = \\left|\\sum_{k=-\\infty}^{\\infty} h_v[k] x[n-k]\\right| \\leq \\sum_{k=-\\infty}^{\\infty} |h_v[k]| |x[n-k]| $$\n由于对所有 $j$ 都有 $|x[j]| \\leq \\sup_j |x[j]| = \\|x\\|_{\\infty}$：\n$$ |v[n]| \\leq \\sum_{k=-\\infty}^{\\infty} |h_v[k]| \\|x\\|_{\\infty} = \\|h_v\\|_{1} \\|x\\|_{\\infty} $$\n这个不等式必须对所有 $n$ 都成立，因此 $\\sup_n |v[n]| = \\|v\\|_{\\infty} \\leq \\|h_v\\|_{1} \\|x\\|_{\\infty}$。这表明诱导范数 $\\gamma$ 至多为 $\\|h_v\\|_{1}$。为证明相等，必须构造一个 $\\|x\\|_{\\infty}=1$ 的输入 $x[n]$，使得该界可以达到。令 $x_k = \\operatorname{sgn}(h_v[-k])$。在 $n=0$ 时的输出是 $v[0]=\\sum_k h_v[k]x[-k] = \\sum_k h_v[k]\\operatorname{sgn}(h_v[k]) = \\sum_k |h_v[k]| = \\|h_v\\|_1$。因此，该界是紧的，且 $\\gamma = \\|h_v\\|_{1}$。\n我们为我们的系统计算 $\\|h_v\\|_{1}$：\n$$ \\gamma = \\|h_v\\|_{1} = \\sum_{n=-\\infty}^{\\infty} |h_v[n]| = |h_v[0]| + |h_v[1]| = |1| + |-r| = 1 + |r| $$\n对于给定的参数 $r = \\frac{999}{1000}$：\n$$ \\gamma = 1 + \\left|\\frac{999}{1000}\\right| = 1 + \\frac{999}{1000} = \\frac{1999}{1000} $$\n\n3. 朴素缩放方法的失效。\n朴素缩放方法确保对于缩放后的输入 $s\\,x[n]$，输出 $s\\,y[n]$ 不会溢出。当 $|x[n]|\\leq 1$ 时，输出受限于 $|y[n]| \\leq \\|h\\|_{1}\\|x\\|_{\\infty} \\leq \\|h\\|_{1}$。为保证 $|s\\,y[n]| \\leq 1$，必须有 $s\\|h\\|_{1} \\leq 1$，所以 $s \\leq 1/\\|h\\|_{1}$。朴素选择是 $s = 1/\\|h\\|_{1}$。\n对于我们的参数，这个缩放因子是 $s_{\\text{naive}} = \\frac{1}{19/10} = \\frac{10}{19}$。\n现在我们检查在此缩放下的内部节点 $v[n]$。缩放后的内部节点信号为 $v'[n] = s_{\\text{naive}} v[n]$。其幅值受限于：\n$$ |v'[n]| = |s_{\\text{naive}} v[n]| \\leq s_{\\text{naive}} \\|v\\|_{\\infty} \\leq s_{\\text{naive}} \\gamma \\|x\\|_{\\infty} $$\n当 $\\|x\\|_{\\infty} \\leq 1$ 时，$|v'[n]|$ 的最大可能值为 $s_{\\text{naive}}\\gamma$。为防止该节点溢出，我们必须有 $s_{\\text{naive}}\\gamma \\leq 1$。让我们检查这个条件：\n$$ s_{\\text{naive}}\\gamma = \\left(\\frac{10}{19}\\right) \\left(\\frac{1999}{1000}\\right) = \\frac{19990}{19000} = \\frac{1999}{1900} $$\n由于 $1999 > 1900$，我们有 $\\frac{1999}{1900} > 1$。因此，条件 $s_{\\text{naive}}\\gamma \\leq 1$ 被违反了。这表明，仅基于整个系统脉冲响应的朴素缩放选择不足以保证内部节点不溢出。存在一个 $|x[n]|\\le1$ 的输入（具体来说，对于 $r>0$，$x[0]=-1, x[1]=1$ 且其他 $x[n]=0$，以与 $h_v[n]$ 对齐），其内部节点值 $|v'[-1]|$ 将为 $s_{\\text{naive}}(1+r) > 1$。\n\n4. 更新的全局缩放规则。\n为确保任何点都不发生溢出，必须选择缩放因子 $s$ 来保护所有信号。设缩放后的输入为 $s\\,x[n]$，其中 $|x[n]|\\leq 1$。\n缩放后输出的界为 $|s\\,y[n]| \\leq s \\|h\\|_{1}$。我们要求 $s \\|h\\|_{1} \\leq 1$，这意味着 $s \\leq \\frac{1}{\\|h\\|_{1}}$。\n缩放后内部节点的界为 $|s\\,v[n]| \\leq s \\gamma$。我们要求 $s \\gamma \\leq 1$，这意味着 $s \\leq \\frac{1}{\\gamma}$。\n为同时满足这两个约束，$s$ 必须满足：\n$$ s \\leq \\min\\left(\\frac{1}{\\|h\\|_{1}}, \\frac{1}{\\gamma}\\right) $$\n如前所述，目标是选择满足此条件的最大可能 $s$，以最大化信号量化噪声比。这个最大值为：\n$$ s_{\\text{max}} = \\min\\left(\\frac{1}{\\|h\\|_{1}}, \\frac{1}{\\gamma}\\right) $$\n使用之前计算的值：\n$$ \\frac{1}{\\|h\\|_{1}} = \\frac{1}{19/10} = \\frac{10}{19} $$\n$$ \\frac{1}{\\gamma} = \\frac{1}{1999/1000} = \\frac{1000}{1999} $$\n我们必须比较这两个值。\n$$ \\frac{10}{19} \\text{ vs } \\frac{1000}{1999} $$\n交叉相乘得到 $10 \\times 1999 = 19990$ 和 $19 \\times 1000 = 19000$。\n由于 $19000  19990$，我们有 $\\frac{19000}{19 \\times 1999}  \\frac{19990}{19 \\times 1999}$，这意味着 $\\frac{1000}{1999}  \\frac{10}{19}$。\n最严格的约束来自内部节点 $v[n]$。因此，最大缩放因子为：\n$$ s = \\frac{1000}{1999} $$\n这就是问题陈述中被错误地称为“最小”的值。它代表了安全操作的缩放因子的上界。任何在 $(0, 1000/1999]$ 内的 $s$ 都是一个有效的缩放因子。最优选择是该区间中的最大值。", "answer": "$$\\boxed{\\frac{1000}{1999}}$$", "id": "2903073"}, {"introduction": "防止溢出直接关系到硬件资源的分配。这个练习将我们的视角从输入缩放转移到管理计算数据路径内部的“位增长”问题上。通过分析一个FIR滤波器 [@problem_id:2903068]，我们将确定每个处理阶段所需的最小字长，以适应信号动态范围的增长，从而在防止溢出的同时优化硬件效率。", "problem": "一个采用严格串行级联加法器的直接I型有限冲激响应 (FIR) 滤波器以定点运算实现。采样输入信号表示为 $x[n]$，滤波器输出为 $y[n]$。该滤波器有 $4$ 个抽头，其实系数为 $h_0, h_1, h_2, h_3$，并实现为乘积和的形式\n$$\ny[n] \\;=\\; h_0\\,x[n] \\;+\\; h_1\\,x[n-1] \\;+\\; h_2\\,x[n-2] \\;+\\; h_3\\,x[n-3].\n$$\n内部数据通路按如下方式组织为乘法器和加法器的级联。定义乘积节点\n$$\np_k[n] \\;=\\; h_k\\,x[n-k], \\quad k\\in\\{0,1,2,3\\},\n$$\n和中间和\n$$\ns_1[n] \\;=\\; p_0[n] + p_1[n], \\qquad s_2[n] \\;=\\; s_1[n] + p_2[n], \\qquad y[n] \\;=\\; s_2[n] + p_3[n].\n$$\n假设以下事实：\n- 对于所有 $n$，输入幅值有界，满足 $|x[n]| \\leq 0.6$。\n- 系数为 $h_0 = 1.25$，$h_1 = -0.9$，$h_2 = 0.55$，$h_3 = 0.2$。\n- 所有信号均采用有符号二进制补码定点数表示，包含一个符号位、$I$ 个整数幅值位和 $F$ 个小数位。小数精度 $F$ 在每个节点处都相同。\n- 对于所有允许的输入，必须防止每个节点发生溢出；只要防止了溢出，量化误差与本问题无关。\n- 最终输出字长被限制为 $W_{\\mathrm{out}} = 14$ 位（包括符号位和小数位）。不使用饱和运算；因此符号/整数位必须足以容纳最坏情况下的幅值。\n\n总硬件面积成本被建模为与所有非平凡内部节点和输出的实现字长之和成正比，即，\n$$\nA \\;\\propto\\; W_{p_0} + W_{p_1} + W_{p_2} + W_{p_3} + W_{s_1} + W_{s_2} + W_{y},\n$$\n其中 $W_{\\cdot}$ 表示相应节点的实现字长。您可以假设比例常数为正且对所有位都相同，并且系数乘法器被实现为常系数单元，其面积主要由其输出端的数据通路字长决定（因此上述代理指标适用于比较设计）。不允许重定标或重排序运算；只允许在统一的 $F$ 约束和最终输出字长约束 $W_{y} = W_{\\mathrm{out}}$ 的前提下选择字长。\n\n从线性时不变系统的最坏情况界定和定点数动态范围的基本原理出发，确定每个节点的字长 $W_{p_0}, W_{p_1}, W_{p_2}, W_{p_3}, W_{s_1}, W_{s_2}, W_{y}$（每个都是整数位数），以在所述约束下防止每个节点溢出并最小化总硬件面积。请按 $\\bigl(W_{p_0}, W_{p_1}, W_{p_2}, W_{p_3}, W_{s_1}, W_{s_2}, W_{y}\\bigr)$ 的顺序，将最终答案表示为单个行向量。\n\n答案由整数组成，因此无需四舍五入。单位是位。不涉及角度。", "solution": "用户提交了一个问题以供验证和求解。\n\n**问题验证**\n\n**步骤 1：提取已知条件**\n-   滤波器结构：一个采用严格串行级联加法器的 $4$ 抽头直接I型有限冲激响应 (FIR) 滤波器。\n-   滤波器方程：$y[n] = h_0\\,x[n] + h_1\\,x[n-1] + h_2\\,x[n-2] + h_3\\,x[n-3]$。\n-   中间节点：\n    -   乘积节点：$p_k[n] = h_k\\,x[n-k]$，其中 $k\\in\\{0,1,2,3\\}$。\n    -   求和节点：$s_1[n] = p_0[n] + p_1[n]$，$s_2[n] = s_1[n] + p_2[n]$，以及 $y[n] = s_2[n] + p_3[n]$。\n-   输入信号边界：对于所有 $n$，有 $|x[n]| \\leq 0.6$。设此边界为 $X_{\\max} = 0.6$。\n-   滤波器系数：$h_0 = 1.25$，$h_1 = -0.9$，$h_2 = 0.55$，$h_3 = 0.2$。\n-   数字表示法：有符号二进制补码定点数，包含 $1$ 个符号位、$I$ 个整数幅值位和 $F$ 个小数位。总字长为 $W = 1 + I + F$。\n-   约束条件：\n    1.  必须在每个节点（$p_0, p_1, p_2, p_3, s_1, s_2, y$）防止溢出。\n    2.  所有节点的小数位数 $F$ 是统一的。\n    3.  最终输出字长是固定的：$W_y = 14$。\n-   优化目标：最小化总硬件面积成本代理指标 $A \\propto \\sum W_k$，其中求和涵盖所有指定的内部和输出节点：$W_{p_0} + W_{p_1} + W_{p_2} + W_{p_3} + W_{s_1} + W_{s_2} + W_{y}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，是定点数字信号处理系统设计中的一个标准任务。问题提法得当，具有明确的目标函数和一套完整的非矛盾约束。语言客观、精确。因此，该问题被认定为有效。\n\n**步骤 3：结论与行动**\n问题有效。将提供解答。\n\n**问题解答**\n\n目标是为每个节点 $k$ 确定整数字长 $W_k$，以防止溢出并最小化成本函数 $A' = W_{p_0} + W_{p_1} + W_{p_2} + W_{p_3} + W_{s_1} + W_{s_2} + W_{y}$。\n\n一个具有 $I$ 个整数幅值位的有符号二进制补码数可以表示范围在 $[-2^I, 2^I - 2^{-F}]$ 内的值。为防止信号 $v[n]$ 溢出，其值对于所有 $n$ 都必须严格位于此范围内。该条件实际上由信号的最大绝对值 $M = \\max_n |v[n]|$ 决定。为避免溢出，我们必须满足 $M  2^I$。这等价于 $\\log_2(M)  I$。由于 $I$ 必须是整数，所需的最小整数位数 $I_{\\min}$ 由 $I_{\\min} = \\lfloor \\log_2(M) \\rfloor + 1$ 给出（对于 $M > 0$）。对于 $M \\leq 1$，这表明 $I_{\\min}=0$ 是可能的。\n\n每个节点 $k$ 的字长是 $W_k = 1 + I_k + F$。成本函数是 $A' = \\sum_k (1 + I_k + F) = 7 + \\sum_k I_k + 7F$。为了最小化 $A'$，我们必须为每个 $I_k$ 选择可能的最小值，即 $I_{k, \\min}$，并为 $F$ 选择可能的最小值。\n\n过程如下：\n1.  确定每个节点 $k$ 的最坏情况最大绝对值 $M_k$。\n2.  根据每个节点的 $M_k$ 计算所需的最小整数位数 $I_{k, \\min}$。\n3.  使用输出字长的约束 $W_y = 14$ 来确定统一的小数位数 $F$。\n4.  使用确定的 $F$ 和 $I_{k, \\min}$ 计算所有节点的字长 $W_k$。\n\n**1. 最坏情况幅值分析**\n输入有界，满足 $|x[n]| \\leq X_{\\max} = 0.6$。每个节点的最坏情况幅值通过应用三角不等式找到。\n\n对于乘积节点 $p_k[n] = h_k x[n-k]$：\n$M_{p_k} = \\max_n |p_k[n]| = |h_k| \\cdot \\max_n |x[n-k]| = |h_k| X_{\\max}$。\n-   $M_{p_0} = |1.25| \\times 0.6 = 1.25 \\times 0.6 = 0.75$。\n-   $M_{p_1} = |-0.9| \\times 0.6 = 0.9 \\times 0.6 = 0.54$。\n-   $M_{p_2} = |0.55| \\times 0.6 = 0.55 \\times 0.6 = 0.33$。\n-   $M_{p_3} = |0.2| \\times 0.6 = 0.2 \\times 0.6 = 0.12$。\n\n对于求和节点，最坏情况幅值是通过对其输入的幅值求和来找到的，因为可以选择各个延迟输入 $x[n-k]$ 使各项相长相加。\n-   $s_1[n] = p_0[n] + p_1[n]$。\n    $M_{s_1} = \\max_n |s_1[n]| \\leq \\max_n |p_0[n]| + \\max_n |p_1[n]| = M_{p_0} + M_{p_1} = 0.75 + 0.54 = 1.29$。\n-   $s_2[n] = s_1[n] + p_2[n]$。\n    $M_{s_2} = \\max_n |s_2[n]| \\leq \\max_n |s_1[n]| + \\max_n |p_2[n]| = M_{s_1} + M_{p_2} = 1.29 + 0.33 = 1.62$。\n-   $y[n] = s_2[n] + p_3[n]$。\n    $M_y = \\max_n |y[n]| \\leq \\max_n |s_2[n]| + \\max_n |p_3[n]| = M_{s_2} + M_{p_3} = 1.62 + 0.12 = 1.74$。\n\n**2. 最小整数位数计算**\n我们现在使用条件 $M_k  2^{I_{k, \\min}}$ 来为每个节点找到 $I_{k, \\min}$。\n-   $M_{p_0} = 0.75$：因为 $0.75  2^0 = 1$，我们需要 $I_{p_0} \\geq 0$。因此，$I_{p_0, \\min} = 0$。\n-   $M_{p_1} = 0.54$：因为 $0.54  2^0 = 1$，我们需要 $I_{p_1} \\geq 0$。因此，$I_{p_1, \\min} = 0$。\n-   $M_{p_2} = 0.33$：因为 $0.33  2^0 = 1$，我们需要 $I_{p_2} \\geq 0$。因此，$I_{p_2, \\min} = 0$。\n-   $M_{p_3} = 0.12$：因为 $0.12  2^0 = 1$，我们需要 $I_{p_3} \\geq 0$。因此，$I_{p_3, \\min} = 0$。\n-   $M_{s_1} = 1.29$：因为 $2^0 = 1 \\leq 1.29  2^1 = 2$，我们需要 $I_{s_1} \\geq 1$。因此，$I_{s_1, \\min} = 1$。\n-   $M_{s_2} = 1.62$：因为 $2^0 = 1 \\leq 1.62  2^1 = 2$，我们需要 $I_{s_2} \\geq 1$。因此，$I_{s_2, \\min} = 1$。\n-   $M_y = 1.74$：因为 $2^0 = 1 \\leq 1.74  2^1 = 2$，我们需要 $I_y \\geq 1$。因此，$I_{y, \\min} = 1$。\n\n为了最小化成本，我们选择这些最小值：$I_{p_0} = 0$，$I_{p_1} = 0$，$I_{p_2} = 0$，$I_{p_3} = 0$，$I_{s_1} = 1$，$I_{s_2} = 1$ 以及 $I_y = 1$。\n\n**3. 确定小数精度 F**\n输出字长被约束为 $W_y = 14$。我们有 $W_y = 1 + I_y + F$。使用我们对 $I_y$ 的最小选择，我们得到：\n$14 = 1 + I_{y, \\min} + F = 1 + 1 + F = 2 + F$。\n求解 $F$，我们得到 $F = 14 - 2 = 12$。这个统一的小数精度适用于所有节点。\n\n**4. 计算所有节点的字长**\n现在我们使用 $F=12$ 和先前找到的 $I_{k, \\min}$ 值，为每个节点计算字长 $W_k = 1 + I_{k, \\min} + F$。\n-   $W_{p_0} = 1 + I_{p_0, \\min} + F = 1 + 0 + 12 = 13$。\n-   $W_{p_1} = 1 + I_{p_1, \\min} + F = 1 + 0 + 12 = 13$。\n-   $W_{p_2} = 1 + I_{p_2, \\min} + F = 1 + 0 + 12 = 13$。\n-   $W_{p_3} = 1 + I_{p_3, \\min} + F = 1 + 0 + 12 = 13$。\n-   $W_{s_1} = 1 + I_{s_1, \\min} + F = 1 + 1 + 12 = 14$。\n-   $W_{s_2} = 1 + I_{s_2, \\min} + F = 1 + 1 + 12 = 14$。\n-   $W_y = 1 + I_{y, \\min} + F = 1 + 1 + 12 = 14$。这与问题约束一致。\n\n防止溢出并最小化成本函数的字长集合是 $(W_{p_0}, W_{p_1}, W_{p_2}, W_{p_3}, W_{s_1}, W_{s_2}, W_y) = (13, 13, 13, 13, 14, 14, 14)$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n13  13  13  13  14  14  14\n\\end{pmatrix}\n}\n$$", "id": "2903068"}]}