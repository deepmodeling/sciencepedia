## 引言
在数字信号处理的几乎所有实际应用中，信号和系统参数都必须用有限的比特数来表示。这种有限精度表示虽然带来了计算上的可行性，却也引入了不可避免的误差，统称为[有限字长效应](@entry_id:201338)。其中，由乘法运算产生的[乘积量化](@entry_id:190176)和[舍入噪声](@entry_id:202216)是影响系统性能的关键因素。若不加以妥善理解和处理，这些效应可能导致信噪比下降、[频率响应](@entry_id:183149)失真，甚至系统不稳定。因此，对这些[非线性](@entry_id:637147)效应进行精确建模和分析，是设计稳健、高效的数字系统的核心挑战。

本文旨在为读者提供一个关于[乘积量化](@entry_id:190176)与[舍入噪声](@entry_id:202216)的全面指南。我们将分三个层次展开：

首先，在“原理与机制”一章中，我们将深入探讨[量化误差](@entry_id:196306)的根本来源和统计特性，建立并验证广泛使用的[加性白噪声模型](@entry_id:180361)，并分析噪声在线性系统中的传播规律。此外，我们还将讨论系数量化、[溢出](@entry_id:172355)等其他重要的[有限字长效应](@entry_id:201338)。

接着，在“应用与跨学科联系”一章中，我们将理论付诸实践，重点剖析数字滤波器的不同实现结构如何影响噪声性能，并介绍缩放、位分配等实用设计技术。我们还会将视野拓宽至[音频处理](@entry_id:273289)、[图像压缩](@entry_id:156609)和[射电天文学](@entry_id:153213)等领域，展示这些原理的广泛适用性。

最后，“动手实践”部分提供了一系列练习，引导读者将所学知识应用于解决具体的工程问题，从分析单个乘法器到验证完整的滤波器设计，从而巩固理论理解并提升实践能力。

通过这一系统性的学习路径，读者将能够深刻理解[有限字长效应](@entry_id:201338)的本质，并掌握在实际工程中对其进行分析、控制和优化的关键技能。

## 原理与机制

在[数字信号处理](@entry_id:263660)系统中，信号和系统参数的有限精度表示是不可避免的。这种表示引入的[非线性](@entry_id:637147)效应，即量化噪声和舍入误差，是理解和设计高性能数字系统的核心挑战。本章旨在深入探讨这些效应的根本原理和关键机制。我们将从量化误差的基本统计特性出发，建立并验证广泛使用的[加性白噪声模型](@entry_id:180361)，进而分析该噪声在[线性时不变 (LTI) 系统](@entry_id:178866)中的传播与影响。最后，我们将讨论系数灵敏度、[溢出](@entry_id:172355)等其他重要的[有限字长效应](@entry_id:201338)，并比较不同数字表示格式（如定点与浮点）的性能权衡。

### [量化误差](@entry_id:196306)的[统计模型](@entry_id:165873)

量化是将一个连续或高精度[离散集](@entry_id:146023)合中的值映射到一个较小编码字集合的过程。这个过程本质上是[非线性](@entry_id:637147)的，并引入了不可逆的信息损失。我们将[量化误差](@entry_id:196306)定义为量化输出与输入之差，$e = Q(x) - x$。为了分析这种误差，我们首先需要一个精确的数学模型。

考虑一个步长为 $\Delta$ 的[均匀量化器](@entry_id:192441)。最常见的量化操作是**舍入 (rounding)**，它将输入值映射到最近的量化电平。对于一个输入值 $z$，其舍入输出 $\hat{z}$ 可以通过**向下[取整函数](@entry_id:265373) (floor function)** $\lfloor \cdot \rfloor$ 方便地表示 [@problem_id:2893734]：
$$ \hat{z} = Q(z) = \Delta \left\lfloor \frac{z}{\Delta} + \frac{1}{2} \right\rfloor $$
相应的量化误差为：
$$ e_p = \hat{z} - z = \Delta \left\lfloor \frac{z}{\Delta} + \frac{1}{2} \right\rfloor - z $$
这个表达式给出了误差与输入之间精确的、确定性的非[线性关系](@entry_id:267880)。

为了进行随机信号处理分析，我们通常研究误差的统计特性。这需要对输入信号的[概率分布](@entry_id:146404)做出假设。一个常见且有用的假设是，在一个量化单元（例如，对于某个整数 $k$，区间为 $[k\Delta, (k+1)\Delta)$）内，信号的[概率密度函数](@entry_id:140610) (PDF) 是均匀的。基于此假设，我们可以分析不同量化模式下误差的均值和[方差](@entry_id:200758) [@problem_id:2893696]。

1.  **确定性四舍五入 (Deterministic Round-to-Nearest)**：在这种模式下，输入被映射到最近的量化电平。[决策边界](@entry_id:146073)位于相邻电平的中点。如果输入在单个量化单元内[均匀分布](@entry_id:194597)，则误差将在 $[-\Delta/2, \Delta/2]$ 上近似[均匀分布](@entry_id:194597)。其均值为 $\mu_{\text{RN}} = 0$，[方差](@entry_id:200758)为 $\sigma^{2}_{\text{RN}} = \frac{\Delta^2}{12}$。零均值特性使其在许多应用中备受青睐。

2.  **向零截断 (Truncation toward Zero)**：在这种模式下，输入值的小数部分被简单地丢弃，使其向零方向舍入。对于一个位于 $[k\Delta, (k+1)\Delta)$ 内的正输入，输出总是 $k\Delta$。这导致误差 $e = k\Delta - x$ 在 $(-\Delta, 0]$ 上[均匀分布](@entry_id:194597)。因此，截断引入了一个负偏置，其均值为 $\mu_{\text{TR}} = -\frac{\Delta}{2}$。然而，其[方差](@entry_id:200758)与四舍五入相同，为 $\sigma^{2}_{\text{TR}} = \frac{\Delta^2}{12}$。

3.  **[随机舍入](@entry_id:164336) (Stochastic Rounding)**：这种模式将输入 $X$ 随机地映射到相邻的两个量化电平之一，其概率与 $X$ 离这两个电平的距离成反比。例如，若 $X \in [k\Delta, (k+1)\Delta)$，它被映射到 $(k+1)\Delta$ 的概率为 $\frac{X-k\Delta}{\Delta}$，映射到 $k\Delta$ 的概率为 $\frac{(k+1)\Delta-X}{\Delta}$。这种方法的精妙之处在于，误差的条件期望为零：$\mathbb{E}[Y-X | X] = 0$。因此，其无条件均值也为零，$\mu_{\text{SR}} = 0$。然而，由于引入了额外的随机性，其[方差比](@entry_id:162608)确定性舍入更大，为 $\sigma^{2}_{\text{SR}} = \frac{\Delta^2}{6}$。

这些基础结果构成了我们理解和建模[量化噪声](@entry_id:203074)的基石。对于采用四舍五入的系统，误差的零均值和 $\Delta^2/12$ 的[方差](@entry_id:200758)是两个反复出现的关键参数。

### [加性白噪声模型](@entry_id:180361)：假设与验证

虽然[量化误差](@entry_id:196306)与输入信号之间存在确定性的非[线性关系](@entry_id:267880)，但在许多实际场景中，这种关系非常复杂，难以直接分析。因此，信号处理领域发展了一个强大的简化模型——**[加性白噪声模型](@entry_id:180361) (Additive White Noise Model)**。该模型将量化器的输出 $x_q[n]$ 建模为原始输入 $x[n]$ 与一个附加的、统计特性良好的噪声源 $e[n]$ 之和：
$$ x_q[n] = x[n] + e[n] $$
这个模型的有效性取决于对误差序列 $e[n]$ 的一系列关键假设，这些假设在实践中通常只是近似成立 [@problem_id:2893720]。

**标准模型假设**：
1.  **零均值**：误差序列的均值为零，即 $\mathbb{E}\{e[n]\} = 0$。
2.  **恒定[方差](@entry_id:200758)**：误差的[方差](@entry_id:200758)为常数，对于四舍五入，通常取 $\sigma_e^2 = \frac{\Delta^2}{12}$。
3.  **与输入不相关**：误差序列 $e[n]$ 与输入信号序列 $x[n]$ 不相关，即 $\mathbb{E}\{x[n]e[m]\} = 0$ 对所有 $n, m$ 成立。
4.  **[白噪声](@entry_id:145248)**：误差序列本身是一个[白噪声过程](@entry_id:146877)，即其[自相关函数](@entry_id:138327)为[脉冲函数](@entry_id:273257) $R_e[k] = \mathbb{E}\{e[n]e[n-k]\} = \sigma_e^2 \delta[k]$。

在所谓的**高分辨率量化 (high-resolution quantization)** 条件下，这些假设可以被视为一个良好的**近似**。该条件要求量化步长 $\Delta$ 远小于信号幅度的变化范围（即信号的[标准差](@entry_id:153618)）。当一个“繁忙”的、非周期性的宽带信号（如语音或噪声）通过一个精细的量化器时，它会跨越大量的量化单元，使得在每个单元内的位置近似[随机和](@entry_id:266003)均匀。这导致误差序列表现出类似白噪声的特性。然而，对于高度结构化的信号，如纯[正弦波](@entry_id:274998)或稀疏信号，该模型会完全失效。此时，量化误差将与输入信号高度相关，并呈现出周期性，其[频谱](@entry_id:265125)包含离散的[谐波](@entry_id:181533)分量，而非平坦的[白噪声](@entry_id:145248)谱 [@problem_id:2893720]。

为了克服这种局限性，可以使用**[抖动](@entry_id:200248) (dithering)** 技术。[抖动](@entry_id:200248)通过在量化前向输入信号主动添加一个独立的随机噪声，来强制量化误差与输入信号解耦。一种特别有效的方法是**减法[抖动](@entry_id:200248) (subtractive dithering)**。在此方法中，我们在量化前加上一个在 $(-\Delta/2, \Delta/2)$ 上[均匀分布](@entry_id:194597)的随机序列 $v[n]$，然后在量化后再减去同一个 $v[n]$。可以证明，在这种情况下，总的系统误差 $e[n] = (Q(x[n]+v[n]) - v[n]) - x[n]$ **精确地**满足[加性白噪声模型](@entry_id:180361)的所有假设：它与输入信号 $x[n]$ 完全统计独立，是一个零均值、[方差](@entry_id:200758)为 $\Delta^2/12$ 的[白噪声过程](@entry_id:146877) [@problem_id:2893720]。这个强大的理论结果为[量化噪声](@entry_id:203074)分析提供了坚实的数学基础，并且这个原理可以自然地推广到处理向量信号的**[乘积量化](@entry_id:190176)器 (product quantizer)**。如果对一个 $M$ 维向量的每个分量独立地应用减法[抖动](@entry_id:200248)，那么产生的误差向量将是一个零均值、[协方差矩阵](@entry_id:139155)为 $(\Delta^2/12)\mathbf{I}_M$ 的白噪声向量过程 [@problem_id:2893720]。

### [线性时不变系统](@entry_id:276591)中的[舍入噪声](@entry_id:202216)分析

[加性白噪声模型](@entry_id:180361)最常见的应用场景之一是分析[数字滤波器](@entry_id:181052)中由于乘法运算（即**[乘积量化](@entry_id:190176)**）产生的**[舍入噪声](@entry_id:202216) (round-off noise)**。在[定点算术](@entry_id:170136)中，两个 $B$ 位数的乘积需要 $2B$ 位来精确表示。为了将结果存回 $B$ 位寄存器，必须进行量化。这个过程产生的误差可以被建模为在乘法器输出端注入的一个加性[白噪声](@entry_id:145248)源。

考虑一个乘法器，其输入为两个独立的、零均值的宽义平稳[随机过程](@entry_id:159502) $a[n]$ 和 $b[n]$，[方差](@entry_id:200758)分别为 $\sigma_a^2$ 和 $\sigma_b^2$。其精确乘积为 $z[n] = a[n]b[n]$。由于 $a[n]$ 和 $b[n]$ 独立且零均值，乘积信号 $z[n]$ 的均值为零，其功率（[方差](@entry_id:200758)）为 $\mathbb{E}\{z[n]^2\} = \mathbb{E}\{a[n]^2\}\mathbb{E}\{b[n]^2\} = \sigma_a^2\sigma_b^2$。如果乘积被一个步长为 $\Delta_p$ 的量化器舍入，产生的噪声功率为 $\sigma_e^2 = \Delta_p^2/12$。因此，该乘法器的输出[信噪比](@entry_id:185071) (SQNR) 为 [@problem_id:2893766]：
$$ \mathrm{SQNR} = \frac{\mathbb{E}\{z[n]^2\}}{\mathbb{E}\{e_p[n]^2\}} = \frac{\sigma_a^2 \sigma_b^2}{\Delta_p^2 / 12} = \frac{12 \sigma_a^2 \sigma_b^2}{\Delta_p^2} $$

当这些噪声源存在于一个 LTI 系统（如[数字滤波器](@entry_id:181052)）内部时，它们的效应会通过系统传播到输出端。我们可以利用[频域](@entry_id:160070)工具来精确分析这种影响。根据[加性白噪声模型](@entry_id:180361)，量化误差 $e[n]$ 的[自相关函数](@entry_id:138327)为 $R_e[k] = (\Delta^2/12) \delta[k]$。根据[维纳-辛钦定理](@entry_id:188017)，其[功率谱密度](@entry_id:141002) (PSD) 是自相关函数的[离散时间傅里叶变换 (DTFT)](@entry_id:204279)，即一个常数 [@problem_id:2893717]：
$$ S_e(e^{j\omega}) = \frac{\Delta^2}{12} $$
这表明噪声功率[均匀分布](@entry_id:194597)在所有频率上。

当此[白噪声](@entry_id:145248)通过一个频率响应为 $H(e^{j\omega})$ 的 LTI 系统时，输出端的[噪声功率谱密度](@entry_id:274939) $S_y(e^{j\omega})$ 会被系统的幅频响应的平方所“塑造”：
$$ S_y(e^{j\omega}) = S_e(e^{j\omega}) |H(e^{j\omega})|^2 = \frac{\Delta^2}{12} |H(e^{j\omega})|^2 $$
这意味着，如果滤波器在某个频带有很高的增益，那么对应频带的输出噪声也会被放大。

总的输出噪声功率 $\sigma_y^2$ 是输出 PSD 在整个[频域](@entry_id:160070)上的积分。根据[帕塞瓦尔定理](@entry_id:139215)，这等价于在时域中计算噪声源到输出的冲激响应 $h[n]$ 的能量 [@problem_id:2893775]：
$$ \sigma_y^2 = \frac{1}{2\pi} \int_{-\pi}^{\pi} S_y(e^{j\omega}) d\omega = \frac{\Delta^2}{12} \frac{1}{2\pi} \int_{-\pi}^{\pi} |H(e^{j\omega})|^2 d\omega = \frac{\Delta^2}{12} \sum_{n=-\infty}^{\infty} |h[n]|^2 $$
这个公式是分析数字滤波器中[舍入噪声](@entry_id:202216)的核心。它表明，输出噪声[方差](@entry_id:200758)正比于噪声源的[方差](@entry_id:200758)和从噪声注入点到输出的冲激响应的能量（即其 $\ell_2$ 范数的平方）。

对于一个包含多个（例如 $K$ 个）**相互独立**的内部[舍入噪声](@entry_id:202216)源 $w_i[n]$（[方差](@entry_id:200758)为 $\sigma_{w_i}^2$）的复杂系统，由于噪声源之间不相关，总的输出噪声功率就是由每个噪声源独立贡献的功率之和。如果从第 $i$ 个噪声源到输出的冲激响应为 $g_i[n]$，则总输出噪声[方差](@entry_id:200758)为 [@problem_id:2893776]：
$$ \sigma_{y, \text{total}}^2 = \sum_{i=1}^{K} \sigma_{w_i}^2 \left( \sum_{n=-\infty}^{\infty} |g_i[n]|^2 \right) = \sum_{i=1}^{K} \sigma_{w_i}^2 \|g_i\|_2^2 $$
这个叠加原理使得我们可以独立分析每个噪声源的贡献，然后将它们相加，从而极大地简化了对复杂滤波器结构的[噪声分析](@entry_id:261354)。例如，通过计算一个一阶 IIR 滤波器中从内部节点到输出的冲激响应能量，我们可以精确地量化其输出噪声与滤波器系数 $a$ 和 $b$ 的关系 [@problem_id:2893775]。

### 高级主题与其他[有限字长效应](@entry_id:201338)

除了信号的[舍入噪声](@entry_id:202216)，有限字长还会引入其他几种关键效应，这些效应对系统性能有着深远的影响。

#### 定点与[浮点](@entry_id:749453)算术的比较

数字系统主要采用两种算术表示：**定点 (fixed-point)** 和 **浮点 (floating-point)**。它们在处理量化噪声方面有着根本的不同。
- **[定点算术](@entry_id:170136)**的[量化误差](@entry_id:196306)是**绝对的**。其步长 $\Delta$ 是固定的，导致噪声功率 $P_N \approx \Delta^2/12$ 也是恒定的，与信号幅度无关。因此，其[信噪比 (SNR)](@entry_id:271861) 直接随信号功率的增加而提高。
- **浮点算术**的量化误差是**相对的**。其[量化误差](@entry_id:196306)与被量化的数值大小成正比。可以将其建模为[乘性噪声](@entry_id:261463) $y_f = y(1+\varepsilon)$，其中相对误差 $\varepsilon$ 的[方差](@entry_id:200758)是恒定的，例如为 $u^2/3$（$u$ 是单位舍入误差）。这导致噪声功率 $P_N$ 与[信号功率](@entry_id:273924) $P_y$ 成正比。

这种差异导致一个关键的性能权衡：[浮点](@entry_id:749453)算术的 SNR 在很大程度上与信号幅度无关，这使其非常适合处理具有**宽动态范围**的信号。而[定点算术](@entry_id:170136)的 SNR 在信号幅度较小时会急剧恶化。我们可以通过计算两种实现方式下 SNR 相等的临界信号幅度 $A_{\text{eq}}$，来量化这一权衡点 [@problem_id:2893748]。这个临界幅度取决于定点步长 $\Delta$、浮点单位舍入误差 $u$ 以及[系统增益](@entry_id:171911) $|c|$。

#### 系数量化

滤波器的系数（如 $a_i$ 和 $b_i$）也必须被量化，这会导致实现的滤波器偏离其理想设计。这种**系数量化 (coefficient quantization)** 效应会改变滤波器的[频率响应](@entry_id:183149)，甚至可能破坏其稳定性。

我们可以通过对[传递函数](@entry_id:273897) $H(z)$ 进行一阶泰勒展开来分析其对系数误差 $\Delta a_i, \Delta b_i$ 的灵敏度 [@problem_id:2893698]。对于 IIR 滤波器，对[反馈系数](@entry_id:275731)（如 $a_1$）的量化尤其关键，因为它直接影响极点的位置。一个稳定的理想滤波器，其极点位于[单位圆](@entry_id:267290)内，即 $|a_1|  1$。系数量化后，实现的极点变为 $\widehat{a}_1 = a_1 + \Delta a_1$。为了保持**有界输入有界输出 (BIBO) 稳定性**，必须确保 $|\widehat{a}_1|  1$ 对于所有可能的[量化误差](@entry_id:196306) $\Delta a_1$ 都成立。这为[反馈系数](@entry_id:275731)的量化步长 $q_a$ 施加了一个严格的约束。为了保证稳定性，必须满足 [@problem_id:2893698]：
$$ q_a  2(1 - |a_1|) $$
这个不等式表明，当极点越接近单位圆时（$|a_1| \to 1$），对系数量化的要求就越严格，即需要更小的量化步长（更多的比特位）。

#### [溢出](@entry_id:172355)

当计算结果超出了数字系统所能表示的范围时，就会发生**[溢出](@entry_id:172355) (overflow)**。处理溢出的方式主要有两种：饱和 (saturation) 和环绕 (wrap-around)。环绕[溢出](@entry_id:172355)在许多 DSP 处理器中因其实现简单而常见，但它引入了严重的[非线性失真](@entry_id:260858)。

环绕溢出可以将一个大的正数映射为一个负数，其行为可以用模运算来描述。这个操作是一个周期性的[非线性](@entry_id:637147)函数。当一个[正弦信号](@entry_id:196767)通过这种周期性[非线性](@entry_id:637147)时，即使原始信号是纯净的，输出信号中也会产生大量的**杂散音 (spurious tones)**，即出现在基频整数倍上的谐波分量 [@problem_id:2893723]。这些谐波会严重污染信号的[频谱](@entry_id:265125)。

有趣的是，[抖动](@entry_id:200248)技术同样可以用来抑制由环绕[溢出](@entry_id:172355)引起的确定性[非线性](@entry_id:637147)。通过引入适当的[抖动信号](@entry_id:177752)，可以将环绕操作的确定性行为“随机化”。要完全消除由量化和溢出产生的与[信号相关](@entry_id:274796)的误差分量，[抖动信号](@entry_id:177752)的**特征函数** $\Phi_d(\omega)$ 必须在特定频率点上为零。具体来说，为了消除周期为 $\Delta$ 的量化[非线性](@entry_id:637147)，需要满足 $\Phi_d(k \frac{2\pi}{\Delta}) = 0$ 对于所有非零整数 $k$ 成立。一种满足此条件的实用[抖动](@entry_id:200248)是**三角[概率密度函数](@entry_id:140610) (Triangular PDF) [抖动](@entry_id:200248)**，它可以通过将两个独立的、在 $[-\Delta/2, \Delta/2]$ 上[均匀分布](@entry_id:194597)的[随机变量](@entry_id:195330)相加得到。这种[抖动](@entry_id:200248)的[方差](@entry_id:200758)为 $\sigma_d^2 = \Delta^2/6$ [@problem_id:2893723]。这再次展示了[抖动](@entry_id:200248)作为一种强大工具，能够将复杂的确定性[非线性](@entry_id:637147)问题转化为更易于分析的加性随机噪声问题。