{"hands_on_practices": [{"introduction": "平衡截断的整个框架建立在两个基本概念之上：可达性格拉姆矩阵（controllability Gramian）与可观测性格拉姆矩阵（observability Gramian）。这些矩阵分别量化了驱动系统状态所需的能量以及从某个初始状态在输出端可观测到的能量。这项实践 [@problem_id:2854283] 将引导您从两个不同但等价的角度计算这些格拉姆矩阵：一是通过它们作为无限时间积分的形式化定义，二是通过求解代数李雅普诺夫方程（algebraic Lyapunov equation）。通过这两种方法的练习，您将巩固对这一基本联系的理解，并获得支撑模型降阶计算的实践经验。", "problem": "考虑由以下方程定义的连续时间线性时不变 (LTI) 状态空间系统\n$$\\dot{x}(t) = A x(t) + B u(t), \\quad y(t) = C x(t),$$\n其中\n$$A = \\begin{pmatrix} -2  1 \\\\ 0  -3 \\end{pmatrix}, \\quad B = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}, \\quad C = \\begin{pmatrix} 1  2 \\end{pmatrix}.$$\n您需要根据用于平衡截断的状态转移矩阵和能量格拉姆矩阵的第一性原理进行计算。请按以下步骤进行：\n\n1. 仅使用上三角结构和特征值的基本定义来确定矩阵 $A$ 的特征值，从而证明该矩阵是 Hurwitz 矩阵。\n\n2. 从可达性格拉姆矩阵的定义开始\n$$P \\triangleq \\int_{0}^{\\infty} \\exp(A t)\\, B B^{\\top}\\, \\exp(A^{\\top} t)\\, dt,$$\n直接根据矩阵指数的级数定义和三角矩阵指数的基本性质计算 $\\exp(A t)$，并显式计算该积分以获得 $P_{\\mathrm{int}}$ 的闭合形式。\n\n3. 仅使用恒等式 $\\frac{d}{dt}\\exp(A t) = A \\exp(A t)$、乘法法则以及 $A$ 是 Hurwitz 矩阵的事实（因此当 $t \\to \\infty$ 时边界项消失），推导 $P$ 所满足的连续时间 Lyapunov 方程，并代数求解该方程得到 $P_{\\mathrm{lyap}}$。\n\n4. 对可观测性格拉姆矩阵重复步骤 2 和 3\n$$Q \\triangleq \\int_{0}^{\\infty} \\exp(A^{\\top} t)\\, C^{\\top} C\\, \\exp(A t)\\, dt,$$\n通过显式积分得到 $Q_{\\mathrm{int}}$，并通过求解相关的 Lyapunov 方程得到 $Q_{\\mathrm{lyap}}$。\n\n5. 令 $\\|\\cdot\\|_{F}$ 表示由 $\\|M\\|_{F}^{2} \\triangleq \\operatorname{trace}(M^{\\top} M)$ 定义的 Frobenius 范数。计算标量\n$$S \\triangleq \\|P_{\\mathrm{int}} - P_{\\mathrm{lyap}}\\|_{F}^{2} \\;+\\; \\|Q_{\\mathrm{int}} - Q_{\\mathrm{lyap}}\\|_{F}^{2}.$$\n\n请将您的最终答案以单个实数的形式给出。无需四舍五入，也不涉及物理单位。", "solution": "我们从连续时间线性时不变系统开始\n$$\\dot{x}(t) = A x(t) + B u(t), \\quad y(t) = C x(t),$$\n其中\n$$A = \\begin{pmatrix} -2  1 \\\\ 0  -3 \\end{pmatrix}, \\quad B = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}, \\quad C = \\begin{pmatrix} 1  2 \\end{pmatrix}.$$\n\n步骤 1：$A$ 的 Hurwitz 性质。\n由于 $A$ 是上三角矩阵，根据三角矩阵特征值的基本定义，其特征值是其对角线元素。因此特征值为 $\\lambda_{1} = -2$ 和 $\\lambda_{2} = -3$。两者的实部都严格为负，所以 $A$ 是 Hurwitz 矩阵。这保证了定义格拉姆矩阵的积分是收敛的，并且相关的 Lyapunov 方程有唯一的正定解。\n\n步骤 2：通过显式积分计算可达性格拉姆矩阵 $P$。\n我们使用级数定义以及对于上三角 $2 \\times 2$ 矩阵 $A = \\begin{pmatrix} a  b \\\\ 0  d \\end{pmatrix}$ 且 $a \\neq d$ 时的性质来计算状态转移矩阵 $\\exp(A t)$\n$$\\exp(A t) = \\begin{pmatrix} \\exp(a t)  b \\frac{\\exp(a t) - \\exp(d t)}{a - d} \\\\ 0  \\exp(d t) \\end{pmatrix}.$$\n这里 $a = -2$，$d = -3$，$b = 1$，因此\n$$\\exp(A t) = \\begin{pmatrix} \\exp(-2 t)  \\exp(-2 t) - \\exp(-3 t) \\\\ 0  \\exp(-3 t) \\end{pmatrix}.$$\n令 $E_{2}(t) \\triangleq \\exp(-2 t)$ 和 $E_{3}(t) \\triangleq \\exp(-3 t)$，以及 $f(t) \\triangleq E_{2}(t) - E_{3}(t)$。那么\n$$\\exp(A t) = \\begin{pmatrix} E_{2}(t)  f(t) \\\\ 0  E_{3}(t) \\end{pmatrix}, \\quad \\exp(A^{\\top} t) = \\begin{pmatrix} E_{2}(t)  0 \\\\ f(t)  E_{3}(t) \\end{pmatrix}.$$\n定义 $v(t) \\triangleq \\exp(A t) B$。由于 $B = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$，\n$$v(t) = \\begin{pmatrix} E_{2}(t) + f(t) \\\\ E_{3}(t) \\end{pmatrix} = \\begin{pmatrix} 2 E_{2}(t) - E_{3}(t) \\\\ E_{3}(t) \\end{pmatrix}.$$\n因此被积函数是\n$$\\exp(A t) B B^{\\top} \\exp(A^{\\top} t) = v(t) v(t)^{\\top} = \\begin{pmatrix} v_{1}(t)^{2}  v_{1}(t) v_{2}(t) \\\\ v_{1}(t) v_{2}(t)  v_{2}(t)^{2} \\end{pmatrix},$$\n其中 $v_{1}(t) = 2 E_{2}(t) - E_{3}(t)$ 且 $v_{2}(t) = E_{3}(t)$。展开得：\n\\begin{align*}\nv_{1}(t)^{2} = \\left(2 E_{2}(t) - E_{3}(t)\\right)^{2} = 4 E_{2}(t)^{2} - 4 E_{2}(t) E_{3}(t) + E_{3}(t)^{2}, \\\\\nv_{1}(t) v_{2}(t) = \\left(2 E_{2}(t) - E_{3}(t)\\right) E_{3}(t) = 2 E_{2}(t) E_{3}(t) - E_{3}(t)^{2}, \\\\\nv_{2}(t)^{2} = E_{3}(t)^{2}.\n\\end{align*}\n在 $t \\in [0,\\infty)$ 上逐项积分，并使用当 $\\alpha  0$ 时 $\\int_{0}^{\\infty} \\exp(-\\alpha t)\\, dt = \\frac{1}{\\alpha}$，我们得到：\n\\begin{align*}\n\\int_{0}^{\\infty} v_{1}(t)^{2}\\, dt = 4 \\cdot \\frac{1}{4} - 4 \\cdot \\frac{1}{5} + 1 \\cdot \\frac{1}{6} = 1 - \\frac{4}{5} + \\frac{1}{6} = \\frac{11}{30}, \\\\\n\\int_{0}^{\\infty} v_{1}(t) v_{2}(t)\\, dt = 2 \\cdot \\frac{1}{5} - 1 \\cdot \\frac{1}{6} = \\frac{2}{5} - \\frac{1}{6} = \\frac{7}{30}, \\\\\n\\int_{0}^{\\infty} v_{2}(t)^{2}\\, dt = \\frac{1}{6}.\n\\end{align*}\n因此\n$$P_{\\mathrm{int}} = \\begin{pmatrix} \\frac{11}{30}  \\frac{7}{30} \\\\ \\frac{7}{30}  \\frac{1}{6} \\end{pmatrix}.$$\n\n步骤 3：通过 Lyapunov 方程计算可达性格拉姆矩阵 $P$。\n从定义出发\n$$P = \\int_{0}^{\\infty} \\exp(A t) B B^{\\top} \\exp(A^{\\top} t)\\, dt,$$\n使用 $\\frac{d}{dt}\\exp(A t) = A \\exp(A t)$ 和乘法法则对被积函数关于 $t$ 求导：\n\\begin{align*}\n\\frac{d}{dt}\\left(\\exp(A t) B B^{\\top} \\exp(A^{\\top} t)\\right)\n= A \\exp(A t) B B^{\\top} \\exp(A^{\\top} t) + \\exp(A t) B B^{\\top} \\exp(A^{\\top} t) A^{\\top}.\n\\end{align*}\n从 $0$ 积分到 $\\infty$，并利用 $A$ 是 Hurwitz 矩阵（因此 $\\lim_{t \\to \\infty} \\exp(A t) = 0$）和 $\\exp(A 0) = I$，我们得到\n\\begin{align*}\n\\int_{0}^{\\infty} A \\exp(A t) B B^{\\top} \\exp(A^{\\top} t)\\, dt + \\int_{0}^{\\infty} \\exp(A t) B B^{\\top} \\exp(A^{\\top} t) A^{\\top}\\, dt \\\\\n= - \\exp(A 0) B B^{\\top} \\exp(A^{\\top} 0) = - B B^{\\top}.\n\\end{align*}\n识别出积分内的 $P$ 可得到连续时间 Lyapunov 方程\n$$A P + P A^{\\top} + B B^{\\top} = 0.$$\n令 $P = \\begin{pmatrix} p_{11}  p_{12} \\\\ p_{12}  p_{22} \\end{pmatrix}$。计算\n$$A P = \\begin{pmatrix} -2  1 \\\\ 0  -3 \\end{pmatrix} \\begin{pmatrix} p_{11}  p_{12} \\\\ p_{12}  p_{22} \\end{pmatrix} = \\begin{pmatrix} -2 p_{11} + p_{12}  -2 p_{12} + p_{22} \\\\ -3 p_{12}  -3 p_{22} \\end{pmatrix},$$\n$$P A^{\\top} = \\begin{pmatrix} p_{11}  p_{12} \\\\ p_{12}  p_{22} \\end{pmatrix} \\begin{pmatrix} -2  0 \\\\ 1  -3 \\end{pmatrix} = \\begin{pmatrix} -2 p_{11} + p_{12}  -3 p_{12} \\\\ -2 p_{12} + p_{22}  -3 p_{22} \\end{pmatrix}.$$\n求和并加上 $B B^{\\top} = \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix}$ 得到线性方程组\n\\begin{align*}\n-4 p_{11} + 2 p_{12} + 1 = 0, \\\\\n-5 p_{12} + p_{22} + 1 = 0, \\\\\n-6 p_{22} + 1 = 0.\n\\end{align*}\n依次求解：由第三个方程得 $p_{22} = \\frac{1}{6}$。然后第二个方程得出 $-5 p_{12} + \\frac{1}{6} + 1 = 0 \\Rightarrow p_{12} = \\frac{7}{30}$。第一个方程给出 $-4 p_{11} + 2 \\cdot \\frac{7}{30} + 1 = 0 \\Rightarrow p_{11} = \\frac{11}{30}$。因此\n$$P_{\\mathrm{lyap}} = \\begin{pmatrix} \\frac{11}{30}  \\frac{7}{30} \\\\ \\frac{7}{30}  \\frac{1}{6} \\end{pmatrix}.$$\n\n步骤 4：通过显式积分和 Lyapunov 方程计算可观测性格拉姆矩阵 $Q$。\n根据定义，\n$$Q = \\int_{0}^{\\infty} \\exp(A^{\\top} t) C^{\\top} C \\exp(A t)\\, dt.$$\n令 $S \\triangleq C^{\\top} C = \\begin{pmatrix} 1  2 \\\\ 2  4 \\end{pmatrix}$。使用步骤 2 中 $\\exp(A t)$ 和 $\\exp(A^{\\top} t)$ 的表达式，\n$$\\exp(A^{\\top} t) = \\begin{pmatrix} E_{2}(t)  0 \\\\ f(t)  E_{3}(t) \\end{pmatrix}, \\quad \\exp(A t) = \\begin{pmatrix} E_{2}(t)  f(t) \\\\ 0  E_{3}(t) \\end{pmatrix},$$\n我们计算被积函数\n\\begin{align*}\nM(t) \\triangleq \\exp(A^{\\top} t) S \\exp(A t) \\\\\n= \\begin{pmatrix} E_{2}(t)  0 \\\\ f(t)  E_{3}(t) \\end{pmatrix} \\begin{pmatrix} 1  2 \\\\ 2  4 \\end{pmatrix} \\begin{pmatrix} E_{2}(t)  f(t) \\\\ 0  E_{3}(t) \\end{pmatrix}.\n\\end{align*}\n首先从左侧相乘：\n$$\\exp(A^{\\top} t) S = \\begin{pmatrix} E_{2}(t)  2 E_{2}(t) \\\\ f(t) + 2 E_{3}(t)  2 f(t) + 4 E_{3}(t) \\end{pmatrix}.$$\n然后\n\\begin{align*}\nM_{11}(t) = E_{2}(t) \\cdot E_{2}(t) + 2 E_{2}(t) \\cdot 0 = E_{2}(t)^{2}, \\\\\nM_{12}(t) = E_{2}(t) \\cdot f(t) + 2 E_{2}(t) \\cdot E_{3}(t) = E_{2}(t)^{2} + E_{2}(t) E_{3}(t), \\\\\nM_{22}(t) = \\left(f(t) + 2 E_{3}(t)\\right) f(t) + \\left(2 f(t) + 4 E_{3}(t)\\right) E_{3}(t) \\\\\n= f(t)^{2} + 4 E_{3}(t) f(t) + 4 E_{3}(t)^{2}.\n\\end{align*}\n当 $f(t) = E_{2}(t) - E_{3}(t)$ 时，这可以简化为\n\\begin{align*}\nM_{11}(t) = E_{2}(t)^{2}, \\\\\nM_{12}(t) = E_{2}(t)^{2} + E_{2}(t) E_{3}(t), \\\\\nM_{22}(t) = E_{2}(t)^{2} + 2 E_{2}(t) E_{3}(t) + E_{3}(t)^{2}.\n\\end{align*}\n逐项积分：\n\\begin{align*}\n\\int_{0}^{\\infty} E_{2}(t)^{2}\\, dt = \\frac{1}{4}, \\\\\n\\int_{0}^{\\infty} E_{2}(t) E_{3}(t)\\, dt = \\int_{0}^{\\infty} \\exp(-5 t)\\, dt = \\frac{1}{5}, \\\\\n\\int_{0}^{\\infty} \\left(E_{2}(t)^{2} + 2 E_{2}(t) E_{3}(t) + E_{3}(t)^{2}\\right)\\, dt = \\frac{1}{4} + 2 \\cdot \\frac{1}{5} + \\frac{1}{6} = \\frac{49}{60}.\n\\end{align*}\n因此\n$$Q_{\\mathrm{int}} = \\begin{pmatrix} \\frac{1}{4}  \\frac{1}{4} + \\frac{1}{5} \\\\ \\frac{1}{4} + \\frac{1}{5}  \\frac{49}{60} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{4}  \\frac{9}{20} \\\\ \\frac{9}{20}  \\frac{49}{60} \\end{pmatrix}.$$\n\n对于 Lyapunov 方程，使用 $\\frac{d}{dt}\\exp(A^{\\top} t) = A^{\\top} \\exp(A^{\\top} t)$ 和乘法法则对被积函数求导，在 $[0,\\infty)$ 上积分，并利用 Hurwitz 性质消去边界项。这得到\n$$A^{\\top} Q + Q A + C^{\\top} C = 0.$$\n令 $Q = \\begin{pmatrix} q_{11}  q_{12} \\\\ q_{12}  q_{22} \\end{pmatrix}$。计算\n$$A^{\\top} Q = \\begin{pmatrix} -2  0 \\\\ 1  -3 \\end{pmatrix} \\begin{pmatrix} q_{11}  q_{12} \\\\ q_{12}  q_{22} \\end{pmatrix} = \\begin{pmatrix} -2 q_{11}  -2 q_{12} \\\\ q_{11} - 3 q_{12}  q_{12} - 3 q_{22} \\end{pmatrix},$$\n$$Q A = \\begin{pmatrix} q_{11}  q_{12} \\\\ q_{12}  q_{22} \\end{pmatrix} \\begin{pmatrix} -2  1 \\\\ 0  -3 \\end{pmatrix} = \\begin{pmatrix} -2 q_{11}  q_{11} - 3 q_{12} \\\\ -2 q_{12}  q_{12} - 3 q_{22} \\end{pmatrix}.$$\n求和并加上 $C^{\\top} C = \\begin{pmatrix} 1  2 \\\\ 2  4 \\end{pmatrix}$ 得到\n\\begin{align*}\n-4 q_{11} + 1 = 0, \\\\\nq_{11} - 5 q_{12} + 2 = 0, \\\\\n2 q_{12} - 6 q_{22} + 4 = 0.\n\\end{align*}\n求解得 $q_{11} = \\frac{1}{4}$，然后 $-5 q_{12} + \\frac{1}{4} + 2 = 0 \\Rightarrow q_{12} = \\frac{9}{20}$，以及 $2 \\cdot \\frac{9}{20} - 6 q_{22} + 4 = 0 \\Rightarrow q_{22} = \\frac{49}{60}$。因此\n$$Q_{\\mathrm{lyap}} = \\begin{pmatrix} \\frac{1}{4}  \\frac{9}{20} \\\\ \\frac{9}{20}  \\frac{49}{60} \\end{pmatrix}.$$\n\n步骤 5：标量验证度量。\n定义\n$$S \\triangleq \\|P_{\\mathrm{int}} - P_{\\mathrm{lyap}}\\|_{F}^{2} + \\|Q_{\\mathrm{int}} - Q_{\\mathrm{lyap}}\\|_{F}^{2}.$$\n根据步骤 2 和 3，$P_{\\mathrm{int}} = P_{\\mathrm{lyap}}$。根据步骤 4，$Q_{\\mathrm{int}} = Q_{\\mathrm{lyap}}$。因此每个 Frobenius 范数都为零，且\n$$S = 0.$$\n这完成了计算，并验证了两种格拉姆矩阵的积分和 Lyapunov 特征描述是一致的，这与用于模型降阶的平衡截断理论的要求相符。", "answer": "$$\\boxed{0}$$", "id": "2854283"}, {"introduction": "在求出格拉姆矩阵后，下一步是找到一个“平衡”的坐标系，在该坐标系中，可控性与可观测性被同等加权。这可以通过一个特定的相似性变换来实现。这个计算练习 [@problem_id:2854301] 要求您实现平方根法，这是一种利用乔列斯基分解（Cholesky factorization）和奇异值分解（Singular Value Decomposition, SVD）来寻找这种平衡变换的数值稳定算法。通过亲手编写该算法，您不仅能掌握变换的内在机制，还能体会到鲁棒数值线性代数在现代控制工程中的重要作用。", "problem": "给定对称正定矩阵，它们在稳定的连续时间线性时不变（LTI）系统中充当可控性格拉姆矩阵和可观测性格拉姆矩阵。在通过平衡截断进行模型降阶时，会构造一个平衡相似变换，使得在平衡坐标系下，变换后的可控性格拉姆矩阵和可观测性格拉姆矩阵相等且为对角矩阵。您的任务是使用平方根法计算这样一个平衡变换，并数值验证变换后的格拉姆矩阵近似相等且为对角矩阵。\n\n基本原理：\n- 对于一个具有状态矩阵 $A$、输入矩阵 $B$ 和输出矩阵 $C$ 的稳定连续时间线性时不变（LTI）系统，可控性格拉姆矩阵 $P$ 和可观测性格拉姆矩阵 $Q$ 分别是李雅普诺夫方程 $A P + P A^{\\top} + B B^{\\top} = 0$ 和 $A^{\\top} Q + Q A + C^{\\top} C = 0$ 的唯一对称正定解，前提是该系统是最小的（即，可控且可观测），并且 $A$ 是 Hurwitz 矩阵（所有特征值的实部均为负）。\n- 平衡变换是一种相似变换，它使得在变换后的坐标系中 $P$ 和 $Q$ 相等且为对角矩阵。\n- 平方根法仅依赖于 $P$ 和 $Q$ 是对称正定矩阵的性质，使用 Cholesky 分解和奇异值分解（SVD）来构造平衡变换。\n\n您的程序必须：\n- 对于每对给定的 $(P,Q)$，使用平方根法构造一个平衡变换，不得使用任何绕过从 Cholesky 因子和奇异值分解（SVD）推导过程的公式。\n- 构建变换后的格拉姆矩阵 $P_{\\mathrm{bal}} = T P T^{\\top}$ 和 $Q_{\\mathrm{bal}} = T^{-\\top} Q T^{-1}$，其中 $T$ 是您计算出的平衡变换。\n- 计算两个相对误差度量：\n  1. $P_{\\mathrm{bal}}$ 的对角性误差，定义为弗罗贝尼乌斯范数相对非对角能量\n  $$\\varepsilon_{\\mathrm{diag}} = \\dfrac{\\left\\|P_{\\mathrm{bal}} - \\operatorname{diag}\\left(\\operatorname{diag}\\left(P_{\\mathrm{bal}}\\right)\\right)\\right\\|_{F}}{\\left\\|P_{\\mathrm{bal}}\\right\\|_{F}}.$$\n  2. $P_{\\mathrm{bal}}$ 和 $Q_{\\mathrm{bal}}$ 之间的相等性误差，定义为\n  $$\\varepsilon_{\\mathrm{eq}} = \\dfrac{\\left\\|P_{\\mathrm{bal}} - Q_{\\mathrm{bal}}\\right\\|_{F}}{\\left\\|P_{\\mathrm{bal}}\\right\\|_{F}}.$$\n- 对于每个测试用例，如果 $\\varepsilon_{\\mathrm{diag}} \\leq 10^{-8}$ 和 $\\varepsilon_{\\mathrm{eq}} \\leq 10^{-8}$ 同时成立，则输出布尔值 $ \\mathrm{True} $，否则输出 $ \\mathrm{False} $。\n\n测试套件：\n- 案例 1（一般 $2 \\times 2$）：\n  - $P_{1} = \\begin{bmatrix} 3  1 \\\\ 1  1 \\end{bmatrix}$，\n  - $Q_{1} = \\begin{bmatrix} 4  1.2 \\\\ 1.2  1 \\end{bmatrix}$。\n- 案例 2（重复的汉克尔奇异值边界情况，$3 \\times 3$）：\n  - $P_{2} = I_{3}$，\n  - $Q_{2} = 4 I_{3}$。\n- 案例 3（病态但对称正定的情况，$4 \\times 4$）：定义类 Cholesky 下三角因子 $L_{P}$ 和 $L_{Q}$，\n  $$L_{P} = \\begin{bmatrix}\n  10  0  0  0 \\\\\n  2  5  0  0 \\\\\n  0.5  -1  2  0 \\\\\n  0.1  0.2  0.3  1\n  \\end{bmatrix}, \\quad\n  L_{Q} = \\begin{bmatrix}\n  10^{-3}  0  0  0 \\\\\n  0.002  0.2  0  0 \\\\\n  0.001  -0.01  0.05  0 \\\\\n  0  0.001  0.002  0.7\n  \\end{bmatrix},$$\n  并设置 $P_{3} = L_{P} L_{P}^{\\top}$，$Q_{3} = L_{Q} L_{Q}^{\\top}$。\n\n角度单位和物理单位不适用。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含三个案例的结果，格式为用方括号括起来的逗号分隔列表，例如 $[ \\mathrm{True}, \\mathrm{False}, \\mathrm{True} ]$。", "solution": "我们从一个最小的稳定连续时间线性时不变（LTI）系统开始，其可控性格拉姆矩阵 $P$ 和可观测性格拉姆矩阵 $Q$ 是求解连续时间李雅普诺夫方程的对称正定矩阵。平衡截断的目标是找到一个相似变换，使得 $P$ 和 $Q$ 相等且为对角矩阵。平方根法通过以下推理实现这一目标。\n\n原理与推导：\n1. 由于 $P$ 和 $Q$ 是对称正定矩阵，它们可以进行 Cholesky 分解。存在下三角矩阵 $L_{P}$ 和 $L_{Q}$ 使得\n   $$P = L_{P} L_{P}^{\\top}, \\qquad Q = L_{Q} L_{Q}^{\\top}。$$\n   Cholesky 因子的存在性和唯一性（对角线元素符号除外）源于正定性。\n\n2. 考虑乘积\n   $$M = L_{Q}^{\\top} L_{P}。$$\n   计算 $M$ 的奇异值分解（SVD）：\n   $$M = U \\Sigma V^{\\top},$$\n   其中 $U$ 和 $V$ 是正交矩阵，$\\Sigma = \\operatorname{diag}(\\sigma_{1}, \\dots, \\sigma_{n})$，奇异值 $\\sigma_{i}  0$ 是因为 $M$ 是非奇异因子 $L_{Q}^{\\top}$ 和 $L_{P}$ 的乘积，因此也是非奇异的。\n\n3. 通过以下方式定义平衡相似变换 $T$ 及其逆变换 $T^{-1}$\n   $$T = \\Sigma^{-1/2} U^{\\top} L_{Q}^{\\top}, \\qquad T^{-1} = L_{P} V \\Sigma^{-1/2}。$$\n   这些定义是一致的，因为 $\\Sigma$ 是对角矩阵且对角线元素均为正。上述表达式是通过要求变换后的格拉姆矩阵相等且为对角矩阵，并求解一个仅使用 $P$ 和 $Q$ 的平方根（通过它们的 Cholesky 因子）并结合 $M$ 的 SVD 的相似变换而得到的。\n\n4. 验证变换后的格拉姆矩阵相等且为对角矩阵：\n   计算\n   $$P_{\\mathrm{bal}} = T P T^{\\top} = \\left(\\Sigma^{-1/2} U^{\\top} L_{Q}^{\\top}\\right)\\left(L_{P} L_{P}^{\\top}\\right)\\left(L_{Q} U \\Sigma^{-1/2}\\right)。$$\n   将因子分组，\n   $$P_{\\mathrm{bal}} = \\Sigma^{-1/2} U^{\\top} \\left(L_{Q}^{\\top} L_{P}\\right)\\left(L_{Q}^{\\top} L_{P}\\right)^{\\top} U \\Sigma^{-1/2}。$$\n   由于 $L_{Q}^{\\top} L_{P} = U \\Sigma V^{\\top}$，我们有\n   $$(L_{Q}^{\\top} L_{P})(L_{Q}^{\\top} L_{P})^{\\top} = (U \\Sigma V^{\\top})(V \\Sigma U^{\\top}) = U \\Sigma^{2} U^{\\top}。$$\n   因此，\n   $$P_{\\mathrm{bal}} = \\Sigma^{-1/2} U^{\\top} \\left(U \\Sigma^{2} U^{\\top}\\right) U \\Sigma^{-1/2} = \\Sigma^{-1/2} \\Sigma^{2} \\Sigma^{-1/2} = \\Sigma。$$\n   类似地，对于 $T^{-T} = \\Sigma^{-1/2} V^{\\top} L_{P}^{\\top}$，\n   $$Q_{\\mathrm{bal}} = T^{-\\top} Q T^{-1} = \\left(\\Sigma^{-1/2} V^{\\top} L_{P}^{\\top}\\right)\\left(L_{Q} L_{Q}^{\\top}\\right)\\left(L_{P} V \\Sigma^{-1/2}\\right)。$$\n   将因子分组，\n   $$Q_{\\mathrm{bal}} = \\Sigma^{-1/2} V^{\\top} \\left(L_{P}^{\\top} L_{Q}\\right)\\left(L_{P}^{\\top} L_{Q}\\right)^{\\top} V \\Sigma^{-1/2}。$$\n   由于 $L_{P}^{\\top} L_{Q} = (L_{Q}^{\\top} L_{P})^{\\top} = V \\Sigma U^{\\top}$，我们得到\n   $$(L_{P}^{\\top} L_{Q})(L_{P}^{\\top} L_{Q})^{\\top} = (V \\Sigma U^{\\top})(U \\Sigma V^{\\top}) = V \\Sigma^{2} V^{\\top},$$\n   由此\n   $$Q_{\\mathrm{bal}} = \\Sigma^{-1/2} V^{\\top} \\left(V \\Sigma^{2} V^{\\top}\\right) V \\Sigma^{-1/2} = \\Sigma。$$\n   因此，在精确算术中，两个变换后的格拉姆矩阵是相同且为对角矩阵，其对角线元素等于汉克尔奇异值（即 $M$ 的奇异值）。\n\n5. 数值验证度量：\n   在浮点运算中，舍入误差会产生微小的偏差。我们评估\n   $$\\varepsilon_{\\mathrm{diag}} = \\frac{\\left\\|P_{\\mathrm{bal}} - \\operatorname{diag}\\left(\\operatorname{diag}\\left(P_{\\mathrm{bal}}\\right)\\right)\\right\\|_{F}}{\\left\\|P_{\\mathrm{bal}}\\right\\|_{F}}, \\quad \\varepsilon_{\\mathrm{eq}} = \\frac{\\left\\|P_{\\mathrm{bal}} - Q_{\\mathrm{bal}}\\right\\|_{F}}{\\left\\|P_{\\mathrm{bal}}\\right\\|_{F}},$$\n   如果两者都最多为 $10^{-8}$，则宣告成功。\n\n程序实现的算法步骤：\n- 对于每个 $(P,Q)$：计算 Cholesky 因子 $L_{P}$ 和 $L_{Q}$，使得 $P = L_{P} L_{P}^{\\top}$ 和 $Q = L_{Q} L_{Q}^{\\top}$。\n- 构建 $M = L_{Q}^{\\top} L_{P}$ 并计算其奇异值分解（SVD），$M = U \\Sigma V^{\\top}$。\n- 构造 $T = \\Sigma^{-1/2} U^{\\top} L_{Q}^{\\top}$ 和 $T^{-1} = L_{P} V \\Sigma^{-1/2}$。\n- 构建 $P_{\\mathrm{bal}} = T P T^{\\top}$ 和 $Q_{\\mathrm{bal}} = T^{-\\top} Q T^{-1}$。\n- 计算 $\\varepsilon_{\\mathrm{diag}}$ 和 $\\varepsilon_{\\mathrm{eq}}$ 并与 $10^{-8}$ 比较。\n- 对每个案例输出一个布尔值，指示是否两个标准都得到满足。\n\n应用于测试套件：\n- 案例 1：对于 $P_{1} = \\begin{bmatrix} 3  1 \\\\ 1  1 \\end{bmatrix}$ 和 $Q_{1} = \\begin{bmatrix} 4  1.2 \\\\ 1.2  1 \\end{bmatrix}$，该过程产生的 $P_{\\mathrm{bal}}$ 和 $Q_{\\mathrm{bal}}$ 在舍入误差范围内相等，并且在舍入误差范围内为对角矩阵；我们预期两个误差都低于 $10^{-8}$。\n- 案例 2：对于 $P_{2} = I_{3}$ 和 $Q_{2} = 4 I_{3}$，奇异值是重复的；该方法仍然会产生一个具有相等元素的对角矩阵 $\\Sigma$，并且两个变换后的格拉姆矩阵在舍入误差范围内都等于 $\\Sigma$；误差应低于 $10^{-8}$。\n- 案例 3：对于由指定的 $L_{P}$ 和 $L_{Q}$ 构造的病态矩阵 $P_{3}$ 和 $Q_{3}$，同样的恒等式成立；由于矩阵的病态性，误差可能比前两个案例大，但使用稳定的 Cholesky 分解和 SVD，预期误差仍将保持在 $10^{-8}$ 以下。\n\n因此，如果程序实现正确并在标准双精度算术下执行，它将为每个案例输出一个布尔值列表，预期每个值都为 $ \\mathrm{True} $。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg as la\n\ndef balance_sqrt(P: np.ndarray, Q: np.ndarray):\n    \"\"\"\n    Compute the balancing transformation using the square-root method.\n    Returns T, T_inv, and the Hankel singular values (singular values of L_Q^T L_P).\n    \"\"\"\n    # Cholesky factors: P = Lp Lp^T, Q = Lq Lq^T (lower-triangular)\n    Lp = la.cholesky(P, lower=True, check_finite=True)\n    Lq = la.cholesky(Q, lower=True, check_finite=True)\n\n    # SVD of M = Lq^T Lp\n    M = Lq.T @ Lp\n    U, s, Vh = la.svd(M, full_matrices=False, check_finite=True)\n    # Construct diagonal inverse square root of Sigma\n    inv_sqrt_s = 1.0 / np.sqrt(s)\n    inv_sqrt_Sigma = np.diag(inv_sqrt_s)\n\n    # Balancing transformation and its inverse:\n    # T = Sigma^{-1/2} U^T Lq^T\n    # T^{-1} = Lp V Sigma^{-1/2}\n    T = inv_sqrt_Sigma @ U.T @ Lq.T\n    T_inv = Lp @ Vh.T @ inv_sqrt_Sigma\n    return T, T_inv, s\n\ndef transformed_gramians(P: np.ndarray, Q: np.ndarray, T: np.ndarray, T_inv: np.ndarray):\n    \"\"\"\n    Compute P_bal = T P T^T and Q_bal = T^{-T} Q T^{-1}.\n    \"\"\"\n    P_bal = T @ P @ T.T\n    Q_bal = T_inv.T @ Q @ T_inv\n    return P_bal, Q_bal\n\ndef diag_and_equality_errors(P_bal: np.ndarray, Q_bal: np.ndarray):\n    \"\"\"\n    Compute the relative off-diagonal Frobenius norm of P_bal and\n    the relative Frobenius norm of P_bal - Q_bal, both normalized by ||P_bal||_F.\n    \"\"\"\n    # Ensure symmetry numerically\n    P_bal = 0.5 * (P_bal + P_bal.T)\n    Q_bal = 0.5 * (Q_bal + Q_bal.T)\n    # Diagonality error\n    diag_P = np.diag(np.diag(P_bal))\n    denom = la.norm(P_bal, ord='fro')\n    # denom should be > 0 for SPD; guard anyway\n    if denom == 0:\n        denom = 1.0\n    diag_err = la.norm(P_bal - diag_P, ord='fro') / denom\n    # Equality error\n    eq_err = la.norm(P_bal - Q_bal, ord='fro') / denom\n    return diag_err, eq_err\n\ndef solve():\n    # Define the test cases from the problem statement.\n\n    # Case 1: general 2x2 SPD\n    P1 = np.array([[3.0, 1.0],\n                   [1.0, 1.0]], dtype=float)\n    Q1 = np.array([[4.0, 1.2],\n                   [1.2, 1.0]], dtype=float)\n\n    # Case 2: repeated singular values, 3x3\n    P2 = np.eye(3, dtype=float)\n    Q2 = 4.0 * np.eye(3, dtype=float)\n\n    # Case 3: ill-conditioned but SPD via lower-triangular factors, 4x4\n    Lp3 = np.array([\n        [10.0, 0.0, 0.0, 0.0],\n        [ 2.0, 5.0, 0.0, 0.0],\n        [ 0.5,-1.0, 2.0, 0.0],\n        [ 0.1, 0.2, 0.3, 1.0]\n    ], dtype=float)\n    Lq3 = np.array([\n        [1e-3,   0.0,    0.0,   0.0],\n        [0.002,  0.2,    0.0,   0.0],\n        [0.001, -0.01,   0.05,  0.0],\n        [0.0,    0.001,  0.002, 0.7]\n    ], dtype=float)\n    P3 = Lp3 @ Lp3.T\n    Q3 = Lq3 @ Lq3.T\n\n    test_cases = [\n        (P1, Q1),\n        (P2, Q2),\n        (P3, Q3),\n    ]\n\n    tol = 1e-8\n    results = []\n    for P, Q in test_cases:\n        T, T_inv, _ = balance_sqrt(P, Q)\n        P_bal, Q_bal = transformed_gramians(P, Q, T, T_inv)\n        d_err, e_err = diag_and_equality_errors(P_bal, Q_bal)\n        results.append(d_err = tol and e_err = tol)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2854301"}, {"introduction": "成功地对模型进行降阶后，一个关键问题随之而来：这个近似的质量如何？虽然平衡截断为近似误差提供了上界，但理解特定系统属性如何受到影响也同样重要。本练习 [@problem_id:2854310] 邀请您比较一个全阶系统与其经过平衡截断的对应模型的直流（DC）增益，后者是许多系统的一个关键稳态特性。通过此分析，您将看到标准的平衡截断通常不保留直流增益，并能够理解零频率下的实际误差与理论上的$H_{\\infty}$误差界限之间的关系，从而更深入地洞察这种降阶方法的权衡之处。", "problem": "考虑一个稳定的、单输入单输出的连续时间线性时不变 (LTI) 系统，其最小实现的状态空间矩阵为\n$$\nA=\\begin{pmatrix}\n-1  0  0 \\\\\n0  -2  0 \\\\\n0  0  -5\n\\end{pmatrix},\\quad\nB=\\begin{pmatrix}\n2 \\\\ 1 \\\\ -1\n\\end{pmatrix},\\quad\nC=\\begin{pmatrix}\n1  2  5\n\\end{pmatrix},\\quad\nD=0.\n$$\n对该系统的一个平衡实现执行了2阶标准平衡截断。所得降阶模型的状态空间矩阵为\n$$\nA_{r}=\\begin{pmatrix}\n-\\frac{6}{5}  0 \\\\\n0  -\\frac{5}{2}\n\\end{pmatrix},\\quad\nB_{r}=\\begin{pmatrix}\n\\frac{21}{10} \\\\ \\frac{4}{5}\n\\end{pmatrix},\\quad\nC_{r}=\\begin{pmatrix}\n\\frac{9}{10}  \\frac{23}{10}\n\\end{pmatrix},\\quad\nD_{r}=0.\n$$\n用于截断的平衡实现具有汉克尔奇异值 $\\sigma_{1}=3$，$\\sigma_{2}=\\frac{9}{10}$ 和 $\\sigma_{3}=\\frac{4}{25}$。对于一个传递函数为 $G(s)$ 的连续时间 LTI 系统，定义直流 (DC) 增益为零频率值 $G(0)$。仅使用线性系统理论的基本定义和公认事实，从状态空间数据推导直流增益的表达式，并计算原始模型和降阶模型的精确直流增益。然后计算原始模型和降阶模型之间直流增益的绝对差异。\n\n将直流增益的绝对差异作为一个不带单位的精确数值作为最终答案报告。无需四舍五入。在你的推理过程中，还需评论该差异是否与基于被舍弃的汉克尔奇异值的标准平衡截断哈代空间无穷范数（H-无穷）误差界相符，但不要将该评论包含在最终报告的答案中。", "solution": "由状态空间四元组 $(A, B, C, D)$ 定义的连续时间 LTI 系统的传递函数 $G(s)$ 由以下表达式给出：\n$$\nG(s) = C(sI - A)^{-1}B + D\n$$\n其中 $s$ 是复频率变量，$I$ 是相应维度的单位矩阵。\n\n直流 (DC) 增益定义为传递函数在零频率处的值，即 $G(0)$。将 $s=0$ 代入传递函数公式得到：\n$$\nG(0) = C(0 \\cdot I - A)^{-1}B + D = C(-A)^{-1}B + D\n$$\n由于系统是稳定的，矩阵 $A$ 在 $0$ 处没有特征值，因此是可逆的。因此，有 $(-A)^{-1} = -A^{-1}$，直流增益的表达式变为：\n$$\nG(0) = -CA^{-1}B + D\n$$\n我们现在将此公式应用于原始系统和降阶系统。\n\n对于原始系统：\n$A = \\begin{pmatrix} -1  0  0 \\\\ 0  -2  0 \\\\ 0  0  -5 \\end{pmatrix}$， $B = \\begin{pmatrix} 2 \\\\ 1 \\\\ -1 \\end{pmatrix}$， $C = \\begin{pmatrix} 1  2  5 \\end{pmatrix}$， $D=0$。\n对角矩阵 $A$ 的逆矩阵很容易计算：\n$$\nA^{-1} = \\begin{pmatrix} (-1)^{-1}  0  0 \\\\ 0  (-2)^{-1}  0 \\\\ 0  0  (-5)^{-1} \\end{pmatrix} = \\begin{pmatrix} -1  0  0 \\\\ 0  -\\frac{1}{2}  0 \\\\ 0  0  -\\frac{1}{5} \\end{pmatrix}\n$$\n现在，我们计算直流增益 $G(0)$：\n$$\nG(0) = - \\begin{pmatrix} 1  2  5 \\end{pmatrix} \\begin{pmatrix} -1  0  0 \\\\ 0  -\\frac{1}{2}  0 \\\\ 0  0  -\\frac{1}{5} \\end{pmatrix} \\begin{pmatrix} 2 \\\\ 1 \\\\ -1 \\end{pmatrix} + 0\n$$\n首先，计算乘积 $-CA^{-1}$：\n$$\n-CA^{-1} = - \\begin{pmatrix} 1(-1)  2(-\\frac{1}{2})  5(-\\frac{1}{5}) \\end{pmatrix} = - \\begin{pmatrix} -1  -1  -1 \\end{pmatrix} = \\begin{pmatrix} 1  1  1 \\end{pmatrix}\n$$\n然后，计算完整的乘积：\n$$\nG(0) = \\begin{pmatrix} 1  1  1 \\end{pmatrix} \\begin{pmatrix} 2 \\\\ 1 \\\\ -1 \\end{pmatrix} = (1)(2) + (1)(1) + (1)(-1) = 2 + 1 - 1 = 2\n$$\n原始系统的直流增益为 $G(0) = 2$。\n\n对于降阶系统：\n$A_{r} = \\begin{pmatrix} -\\frac{6}{5}  0 \\\\ 0  -\\frac{5}{2} \\end{pmatrix}$， $B_{r} = \\begin{pmatrix} \\frac{21}{10} \\\\ \\frac{4}{5} \\end{pmatrix}$， $C_{r} = \\begin{pmatrix} \\frac{9}{10}  \\frac{23}{10} \\end{pmatrix}$， $D_{r}=0$。\n对角矩阵 $A_{r}$ 的逆矩阵为：\n$$\nA_{r}^{-1} = \\begin{pmatrix} (-\\frac{6}{5})^{-1}  0 \\\\ 0  (-\\frac{5}{2})^{-1} \\end{pmatrix} = \\begin{pmatrix} -\\frac{5}{6}  0 \\\\ 0  -\\frac{2}{5} \\end{pmatrix}\n$$\n现在，我们计算降阶模型的直流增益 $G_{r}(0)$：\n$$\nG_{r}(0) = -C_{r}A_{r}^{-1}B_{r} + D_{r} = - \\begin{pmatrix} \\frac{9}{10}  \\frac{23}{10} \\end{pmatrix} \\begin{pmatrix} -\\frac{5}{6}  0 \\\\ 0  -\\frac{2}{5} \\end{pmatrix} \\begin{pmatrix} \\frac{21}{10} \\\\ \\frac{4}{5} \\end{pmatrix} + 0\n$$\n首先，计算乘积 $-C_{r}A_{r}^{-1}$：\n$$\n-C_{r}A_{r}^{-1} = - \\begin{pmatrix} (\\frac{9}{10})(-\\frac{5}{6})  (\\frac{23}{10})(-\\frac{2}{5}) \\end{pmatrix} = - \\begin{pmatrix} -\\frac{45}{60}  -\\frac{46}{50} \\end{pmatrix} = - \\begin{pmatrix} -\\frac{3}{4}  -\\frac{23}{25} \\end{pmatrix} = \\begin{pmatrix} \\frac{3}{4}  \\frac{23}{25} \\end{pmatrix}\n$$\n然后，计算完整的乘积：\n$$\nG_{r}(0) = \\begin{pmatrix} \\frac{3}{4}  \\frac{23}{25} \\end{pmatrix} \\begin{pmatrix} \\frac{21}{10} \\\\ \\frac{4}{5} \\end{pmatrix} = \\left(\\frac{3}{4}\\right)\\left(\\frac{21}{10}\\right) + \\left(\\frac{23}{25}\\right)\\left(\\frac{4}{5}\\right) = \\frac{63}{40} + \\frac{92}{125}\n$$\n为了将这些分数相加，我们找到一个公分母，即 $\\text{lcm}(40, 125) = \\text{lcm}(2^3 \\cdot 5, 5^3) = 2^3 \\cdot 5^3 = 1000$。\n$$\nG_{r}(0) = \\frac{63 \\cdot 25}{40 \\cdot 25} + \\frac{92 \\cdot 8}{125 \\cdot 8} = \\frac{1575}{1000} + \\frac{736}{1000} = \\frac{1575 + 736}{1000} = \\frac{2311}{1000}\n$$\n降阶系统的直流增益为 $G_{r}(0) = \\frac{2311}{1000}$。\n\n最后，我们计算直流增益的绝对差异：\n$$\n|G(0) - G_{r}(0)| = \\left|2 - \\frac{2311}{1000}\\right| = \\left|\\frac{2000}{1000} - \\frac{2311}{1000}\\right| = \\left|-\\frac{311}{1000}\\right| = \\frac{311}{1000}\n$$\n关于所要求的评论：对于一个稳定的 $n$ 阶系统进行标准平衡截断到 $r  n$ 阶，误差系统 $\\|G - G_r\\|_{H_\\infty}$ 的无穷范数是有界的。其上界为被截断的汉克尔奇异值之和的两倍：\n$$\n\\|G - G_r\\|_{H_\\infty} \\le 2 \\sum_{i=r+1}^n \\sigma_i\n$$\n在本例中，$n=3$ 且 $r=2$，所以只有最小的奇异值 $\\sigma_3$ 被截断。误差界为：\n$$\n\\|G - G_r\\|_{H_\\infty} \\le 2\\sigma_3 = 2 \\left(\\frac{4}{25}\\right) = \\frac{8}{25}\n$$\n无穷范数是传递函数在所有频率上的最大幅值：$\\|H\\|_{H_\\infty} = \\sup_{\\omega \\in \\mathbb{R}} |H(j\\omega)|$。直流增益误差是在特定频率 $\\omega=0$ 处的误差，因此其幅值必须小于或等于误差系统的无穷范数：\n$$\n|G(0) - G_r(0)| \\le \\|G - G_r\\|_{H_\\infty}\n$$\n我们计算出直流增益差异为 $\\frac{311}{1000} = 0.311$。理论误差界为 $\\frac{8}{25} = \\frac{320}{1000} = 0.32$。\n因此，我们有 $0.311 \\le 0.32$，这是一个成立的陈述。计算出的直流增益差异与既定的平衡截断 $H_\\infty$ 误差界一致，并未违反该界限。值得注意的是，直流处的误差非常接近全局误差界。标准平衡截断通常不保持直流增益，这个结果例证了这一事实。", "answer": "$$\\boxed{\\frac{311}{1000}}$$", "id": "2854310"}]}