{"hands_on_practices": [{"introduction": "抽取不仅仅是降低数据率的技术；它也是一种强大的频移工具。本练习将通过分析一个窄带随机过程来探索这一概念，展示混叠如何被有策略地用于实现信号的下变频，并阐明为何预滤波对于分离目标信号分量至关重要。这是数字下变频器 (DDC) 设计中的一个基本概念 [@problem_id:2874145]。", "problem": "一个离散时间、零均值、广义平稳的实值窄带过程 $x[n]$，其功率谱密度 $S_{x}(e^{j\\omega})$ 仅在两个宽度相等、不相交的对称频带上非零且为常数。具体而言，对于某个整数 $M \\geq 2$，令 $0  \\Delta  \\pi/(2M)$ 并定义中心频率为 $\\omega_{0}=\\pi/M$。存在一个常数水平 $S_{b}0$，使得\n$$\nS_{x}(e^{j\\omega}) = S_{b} \\quad \\text{for} \\quad \\omega \\in [\\omega_{0}-\\Delta, \\omega_{0}+\\Delta] \\cup [-\\omega_{0}-\\Delta, -\\omega_{0}+\\Delta],\n$$\n并且在一个 $2\\pi$ 基本周期内的其他地方 $S_{x}(e^{j\\omega})=0$。\n\n考虑以因子 $M$ 进行抽取。在情况 A（无预滤波器）中，形成 $y[n]=x[nM]$。在情况 B（有预滤波器）中，首先将 $x[n]$ 通过一个理想的单边带带通滤波器 $h[n]$，其离散时间频率响应 $H(e^{j\\omega})$ 在 $[\\omega_{0}-\\Delta, \\omega_{0}+\\Delta]$ 上等于 $1$，并在此区间之外等于 $0$（特别地，$H(e^{j\\omega})=0$ 在 $[-\\omega_{0}-\\Delta, -\\omega_{0}+\\Delta]$ 上），然后进行抽取以获得 $z[n]=(h*x)[nM]$。频率变量的单位是弧度。\n\n从第一性原理出发，即功率谱密度的定义（自相关函数的离散时间傅里叶变换）以及一个过程及其抽取后版本的功率谱密度之间的精确关系，推导出：\n\n1. 在两种情况下，抽取后窄带内容出现的由混叠引起的中心频率（单位为弧度）。\n2. 对于 $y[n]$（情况 A）和 $z[n]$（情况 B），其主要混叠频带内包含的总输出功率，每个都表示为仅含 $S_{b}$ 和 $\\Delta$ 的闭式符号表达式。\n\n你的最终答案必须是一个单行矩阵，按顺序包含：混叠后的中心频率，$y[n]$ 的主要频带中的总功率，以及 $z[n]$ 的主要频带中的总功率。不需要数值近似；请提供精确的符号表达式。角度必须以弧度表示。在你的最终方框答案中不要包含任何单位。", "solution": "首先将对问题的科学合理性、一致性和完整性进行验证。\n\n第1步：提取已知条件\n- 一个离散时间、零均值、广义平稳（WSS）的实值窄带过程 $x[n]$。\n- 功率谱密度（PSD）$S_{x}(e^{j\\omega})$ 定义为：\n$$\nS_{x}(e^{j\\omega}) = \\begin{cases} S_{b}  \\text{for } \\omega \\in [\\omega_{0}-\\Delta, \\omega_{0}+\\Delta] \\cup [-\\omega_{0}-\\Delta, -\\omega_{0}+\\Delta] \\\\ 0  \\text{elsewhere in } [-\\pi, \\pi] \\end{cases}\n$$\n- 常数和定义：$M \\geq 2$ 是一个整数，$S_b  0$ 是一个常数，$\\omega_{0} = \\pi/M$，以及 $0  \\Delta  \\pi/(2M)$。\n- 情况 A（无预滤波器）：一个抽取后的信号 $y[n] = x[nM]$。\n- 情况 B（有预滤波器）：通过将 $x[n]$ 经过一个理想单边带带通滤波器 $h[n]$ 形成信号 $v[n] = (h*x)[n]$。该滤波器的频率响应在 $\\omega \\in [\\omega_{0}-\\Delta, \\omega_{0}+\\Delta]$ 上为 $H(e^{j\\omega}) = 1$，在 $[-\\pi, \\pi]$ 的其他地方为 $H(e^{j\\omega})=0$。然后对信号 $v[n]$ 进行抽取，得到 $z[n] = v[nM]$。\n- 任务是推导：\n  1. 两种情况下抽取信号的混叠中心频率。\n  2. $y[n]$ 和 $z[n]$ 的主要混叠频带中的总输出功率，用 $S_b$ 和 $\\Delta$ 表示。\n\n第2步：使用提取的已知条件进行验证\n- **科学依据：**该问题是多速率信号处理中的一个标准练习，涉及功率谱密度、滤波和抽取的概念。所有原理都已成熟。\n- **适定性：**该问题提供了所有必要的信息。约束条件 $0  \\Delta  \\pi/(2M)$ 确保了输入频谱 $S_{x}(e^{j\\omega})$ 中的两个频带不相交，并且不会在 $\\pm\\pi$ 边界处回绕。“理想单边带带通滤波器”一词意味着一个复值冲激响应 $h[n]$，因为其频率响应 $H(e^{j\\omega})$ 不是共轭对称的。措辞“两种情况下的混叠中心频率”如果频率不同，可能会引起歧义。然而，正如解法将展示的，严格的分析表明两种情况下的中心频率是相同的，从而消除了歧义。类似地，“主要混叠频带”是无歧义的，因为在圆形频率轴上，每种情况下抽取后只出现一个合并的频带。\n- **客观性：**问题以精确的数学语言陈述，没有主观论断。\n\n第3步：结论与行动\n该问题是适定的且科学上有效。可以按要求从第一性原理推导出严格的解。\n\n**解法推导**\n\n一个广义平稳过程 $x[n]$ 的功率谱密度与其抽取后版本 $y[n]=x[nM]$ 之间的基本关系由下式给出：\n$$S_y(e^{j\\omega'}) = \\frac{1}{M} \\sum_{k=0}^{M-1} S_x\\left(e^{j\\frac{\\omega' - 2\\pi k}{M}}\\right)$$\n其中 $\\omega'$ 是抽取后信号的频率变量，定义在 $[-\\pi, \\pi]$ 上。由于 $k$ 覆盖了模 $M$ 的所有余数，因此在求和中使用正号的等价公式同样有效。\n\n**第1部分：混叠引起的中心频率**\n\n时域中以因子 $M$ 进行抽取，对应于频域中频率轴按因子 $M$ 进行缩放，随后发生混叠。原始信号 $x[n]$ 中位于 $\\omega$ 的频率分量被映射到抽取信号中的频率 $\\omega' = M\\omega$，然后对其进行模 $2\\pi$ 运算，使其位于 $[-\\pi, \\pi]$ 内。\n\n输入频谱 $S_x(e^{j\\omega})$ 有两个非零频带，中心位于 $\\omega_c = \\pm\\omega_0 = \\pm\\pi/M$。\n\n在**情况 A**中，信号 $x[n]$ 在 $+\\omega_0$ 和 $-\\omega_0$ 处都有频带。\n- 正频率带的中心 $\\omega_0 = \\pi/M$ 被映射到 $\\omega' = M \\cdot (\\pi/M) = \\pi$。\n- 负频率带的中心 $-\\omega_0 = -\\pi/M$ 被映射到 $\\omega' = M \\cdot (-\\pi/M) = -\\pi$。\n\n在**情况 B**中，信号 $x[n]$ 首先通过滤波器 $h[n]$。滤波器的输出 $v[n]$ 的频谱为 $S_v(e^{j\\omega}) = |H(e^{j\\omega})|^2 S_x(e^{j\\omega})$。由于 $H(e^{j\\omega})$ 仅在 $\\omega \\in [\\omega_0 - \\Delta, \\omega_0 + \\Delta]$ 上非零，所以频谱 $S_v(e^{j\\omega})$ 仅在这个正频率带上非零。\n- 这个单一频带的中心 $\\omega_0 = \\pi/M$ 被映射到 $\\omega' = M \\cdot (\\pi/M) = \\pi$。\n\n在离散时间频率分析中，频率 $\\pi$ 和 $-\\pi$ 是相同的。因此，在两种情况下，窄带内容都混叠到一个以 $\\omega' = \\pi$ 弧度为中心的新频带。\n\n**第2部分：总输出功率**\n\n一个频带内的总功率是功率谱密度在该频带上的积分，再除以 $2\\pi$。\n$P = \\frac{1}{2\\pi} \\int_{\\text{频带}} S(e^{j\\omega'}) d\\omega'$。\n\n**情况 A：$y[n]$ 的功率**\n\n功率谱密度 $S_y(e^{j\\omega'})$ 是将混叠公式应用于 $S_x(e^{j\\omega})$ 得到的。我们分析在 $\\pi$ 附近的混叠频带中一个 $\\omega'$ 对应的求和。设 $\\omega' \\in [\\pi - M\\Delta, \\pi) \\cup (-\\pi, -\\pi+M\\Delta]$。我们需要找到哪些 $k \\in \\{0, 1, ..., M-1\\}$ 的值使得参数 $(\\omega' - 2\\pi k)/M$ 落入 $S_x(e^{j\\omega})$ 的支撑集 $[\\omega_0 \\pm \\Delta] \\cup [-\\omega_0 \\pm \\Delta]$ 内。\n\n对于 $\\omega' \\in [\\pi - M\\Delta, \\pi)$，设 $\\omega'=\\pi-\\delta$ 且 $0  \\delta \\le M\\Delta$。\n- 当 $k=0$ 时，参数为 $(\\pi-\\delta)/M = \\pi/M - \\delta/M = \\omega_0 - \\delta/M$。由于 $\\delta/M \\le \\Delta$，此值落在正频带 $[\\omega_0-\\Delta, \\omega_0]$ 内。求和中的项是 $S_b$。\n- 当 $k=1$ 时，参数为 $(\\pi-\\delta-2\\pi)/M = -\\pi/M - \\delta/M = -\\omega_0 - \\delta/M$。此值落在负频带 $[-\\omega_0-\\Delta, -\\omega_0]$ 内。求和中的项是 $S_b$。\n- 对于其他的 $k$，参数落在 $S_x$ 的支撑集之外。\n\n所以对于接近 $\\pi$ 的 $\\omega'$，求和中有两项非零。$y[n]$ 的功率谱密度为：\n$$S_y(e^{j\\omega'}) = \\frac{1}{M}(S_b + S_b) = \\frac{2S_b}{M}$$\n由于 $y[n]$ 是一个实过程，其功率谱密度是偶函数：$S_y(e^{j\\omega'}) = S_y(e^{-j\\omega'})$。混叠频带在圆形频率轴上围绕 $\\omega'=\\pi$ 形成一个宽度为 $2M\\Delta$ 的单一连续区域，具体在 $[-\\pi, -\\pi+M\\Delta] \\cup [\\pi-M\\Delta, \\pi]$ 上。在这整个频带上，功率谱密度为 $\\frac{2S_b}{M}$。\n\n该频带内的总功率 $P_y$ 为：\n$$P_y = \\frac{1}{2\\pi} \\int_{\\text{混叠频带}} S_y(e^{j\\omega'}) d\\omega' = \\frac{1}{2\\pi} \\left(\\frac{2S_b}{M}\\right) \\times (\\text{频带宽度})$$\n$$P_y = \\frac{1}{2\\pi} \\left(\\frac{2S_b}{M}\\right) (2M\\Delta) = \\frac{2 S_b \\Delta}{\\pi}$$\n\n**情况 B：$z[n]$ 的功率**\n\n过程 $v[n]$ 的功率谱密度在 $\\omega \\in [\\omega_0-\\Delta, \\omega_0+\\Delta]$ 上为 $S_v(e^{j\\omega}) = S_b$，在其他地方为零。我们对 $v[n]$ 进行抽取得到 $z[n]$。其功率谱密度为：\n$$S_z(e^{j\\omega'}) = \\frac{1}{M} \\sum_{k=0}^{M-1} S_v\\left(e^{j\\frac{\\omega' - 2\\pi k}{M}}\\right)$$\n仅当 $(\\omega' - 2\\pi k)/M$ 落在 $[\\omega_0 - \\Delta, \\omega_0 + \\Delta]$ 内时，求和才非零。\n- 对于 $\\omega' \\in [\\pi - M\\Delta, \\pi)$，只有 $k=0$ 项有贡献，得到 $S_z(e^{j\\omega'}) = S_b/M$。\n- 对于 $\\omega' \\in [-\\pi, -\\pi+M\\Delta]$，设 $\\omega'=-\\pi+\\delta$ 且 $0  \\delta \\le M\\Delta$。参数变为 $(-\\pi+\\delta-2\\pi k)/M$。当 $k=1$ 时，此值为 $(-\\pi+\\delta-2\\pi)/M = (\\pi+\\delta)/M = \\omega_0+\\delta/M$，该值在 $[\\omega_0, \\omega_0+\\Delta]$ 内。因此只有 $k=M-1$ 项有贡献，得到 $S_z(e^{j\\omega'}) = S_b/M$。\n\n$z[n]$ 的混叠频带与 $y[n]$ 的相同，总宽度为 $2M\\Delta$。然而，该频带上的功率谱密度值为 $S_z(e^{j\\omega'}) = S_b/M$。\n\n该频带内的总功率 $P_z$ 为：\n$$P_z = \\frac{1}{2\\pi} \\int_{\\text{混叠频带}} S_z(e^{j\\omega'}) d\\omega' = \\frac{1}{2\\pi} \\left(\\frac{S_b}{M}\\right) \\times (\\text{频带宽度})$$\n$$P_z = \\frac{1}{2\\pi} \\left(\\frac{S_b}{M}\\right) (2M\\Delta) = \\frac{S_b \\Delta}{\\pi}$$\n\n情况 B 中的预滤波消除了来自负频率带的混叠，导致其功率是情况 A 的一半。\n\n最终答案要求一个行矩阵，按顺序包含三个推导出的量：混叠中心频率、$y[n]$ 的功率和 $z[n]$ 的功率。", "answer": "$$\\boxed{\\begin{pmatrix} \\pi  \\frac{2S_b\\Delta}{\\pi}  \\frac{S_b\\Delta}{\\pi} \\end{pmatrix}}$$", "id": "2874145"}, {"introduction": "与抽取相对应，升采样是提高信号采样率的过程。其核心操作——补零——会在频谱中产生原始信号频谱的不需要的副本，即“镜像”。本练习通过一个具体的、分步的计算，精确地展示了这些镜像出现的位置，以及插值滤波器如何作用于消除它们，从而在更高采样率下重建出期望的信号 [@problem_id:2874155]。", "problem": "考虑离散时间信号 $x[n] = \\cos(\\omega_{0} n)$，其中 $0  \\omega_{0}  \\pi$ 以弧度为单位。该信号通过在连续样本之间插入 $L-1$ 个零点，以整数因子 $L \\geq 2$ 进行上采样，产生 $u[n]$，然后通过一个实现线性插值的零相位有限脉冲响应（FIR）插值器 $h[n]$ 进行滤波。插值器定义为\n$$\nh[n] =\n\\begin{cases}\n1 - \\frac{|n|}{L},  |n|  L,\\\\\n0,  \\text{其他},\n\\end{cases}\n$$\n这是一个实的、偶对称的、长度为 $2L-1$ 的核。假设一个理想化的零相位实现（关于 $n=0$ 的非因果对称）。令 $y[n]$ 表示此上采样-滤波链的输出。角度以弧度为单位。\n\n仅从上采样、线性时不变（LTI）滤波的定义以及离散时间傅里叶变换（DTFT）出发，推导 $y[n]$ 作为余弦实数叠加的完整闭式表达式。您的推导必须明确指出：\n- 上采样操作产生的离散时间输出频率，以及\n- 经过给定 $h[n]$ 线性插值后对应的幅度，\n\n所有这些都应表示为 $\\omega_{0}$ 和 $L$ 的函数。将最终答案表示为 $y[n]$ 的单个解析表达式，该表达式应明确显示输出频率集及其幅度。不需要数值近似。答案以弧度表示。", "solution": "所述问题是有效的。它在科学上基于数字信号处理的原理，问题提法良好，具有唯一且稳定的解，并使用精确的数学语言进行客观表述。所有必要信息均已提供，且没有内部矛盾。因此，我们可以进行形式化推导。\n\n问题要求推导输入信号 $x[n] = \\cos(\\omega_{0} n)$ 经过上采样和滤波后得到的输出信号 $y[n]$。推导将在频域中进行，按规定利用离散时间傅里叶变换（DTFT）。过程如下：首先，我们找到上采样信号 $u[n]$ 作为离散时间正弦波之和的表示。其次，我们确定线性插值器 $h[n]$ 的频率响应。最后，我们利用正弦信号通过线性时不变（LTI）系统时，会根据系统在该正弦波频率处的频率响应进行缩放和相移的性质，来组合这些结果。\n\n设输入信号为 $x[n] = \\cos(\\omega_{0} n)$，其中 $0  \\omega_0  \\pi$。以因子 $L$ 进行上采样涉及在 $x[n]$ 的连续样本之间插入 $L-1$ 个零。得到的信号 $u[n]$ 定义为：\n$$\nu[n] =\n\\begin{cases}\nx[n/L] = \\cos(\\omega_{0} n/L),  \\text{若 } n \\text{ 是 } L \\text{ 的倍数}, \\\\\n0,  \\text{其他}.\n\\end{cases}\n$$\n该信号可以使用脉冲序列更紧凑地表示。当 $n$ 是 $L$ 的倍数时，函数 $\\frac{1}{L}\\sum_{k=0}^{L-1} e^{j(2\\pi k/L)n}$ 的值为 $1$，否则为 $0$。因此，我们可以将 $u[n]$ 写为乘积形式：\n$$\nu[n] = \\cos(\\omega_{0}n/L) \\left( \\frac{1}{L} \\sum_{k=0}^{L-1} e^{j \\frac{2\\pi k}{L} n} \\right)\n$$\n使用欧拉恒等式 $\\cos(\\theta) = \\frac{1}{2}(e^{j\\theta} + e^{-j\\theta})$，我们展开此表达式：\n$$\nu[n] = \\frac{1}{2L} \\left( e^{j\\frac{\\omega_{0}}{L}n} + e^{-j\\frac{\\omega_{0}}{L}n} \\right) \\sum_{k=0}^{L-1} e^{j \\frac{2\\pi k}{L} n} = \\frac{1}{2L} \\sum_{k=0}^{L-1} \\left( e^{j\\left(\\frac{\\omega_{0}+2\\pi k}{L}\\right)n} + e^{j\\left(\\frac{2\\pi k-\\omega_{0}}{L}\\right)n} \\right)\n$$\n我们可以通过令 $m = L-k$（其中 $k \\in \\{1, \\dots, L-1\\}$）来重新排列求和中的第二项。复指数变为 $e^{j\\left(\\frac{2\\pi(L-m)-\\omega_{0}}{L}\\right)n} = e^{j\\left(2\\pi - \\frac{\\omega_{0}+2\\pi m}{L}\\right)n} = e^{-j\\left(\\frac{\\omega_{0}+2\\pi m}{L}\\right)n}$。对 $k$ 从 $0$ 到 $L-1$ 的求和等价于对 $m$ 从 $0$ 到 $L-1$ 的求和。因此，表达式简化为：\n$$\nu[n] = \\frac{1}{L} \\sum_{k=0}^{L-1} \\frac{1}{2} \\left( e^{j\\left(\\frac{\\omega_{0}+2\\pi k}{L}\\right)n} + e^{-j\\left(\\frac{\\omega_{0}+2\\pi k}{L}\\right)n} \\right) = \\frac{1}{L} \\sum_{k=0}^{L-1} \\cos\\left( \\left(\\frac{\\omega_{0}+2\\pi k}{L}\\right) n \\right)\n$$\n这表明上采样信号 $u[n]$ 是 $L$ 个余弦的叠加。上采样操作产生的频率明确确定为：\n$$\n\\Omega_k = \\frac{\\omega_{0}+2\\pi k}{L}, \\quad \\text{对于 } k \\in \\{0, 1, \\dots, L-1\\}\n$$\n接下来，我们确定FIR插值器 $h[n]$ 的频率响应 $H(e^{j\\omega})$。脉冲响应是一个三角脉冲，定义为当 $|n|  L$ 时 $h[n]=1 - |n|/L$。这是一个长度为 $2L-1$ 的标准核。其DTFT是狄利克雷核的平方：\n$$\nH(e^{j\\omega}) = \\frac{1}{L} \\left( \\frac{\\sin(L\\omega/2)}{\\sin(\\omega/2)} \\right)^2\n$$\n由于这是一个零相位滤波器，其频率响应是实的、偶对称的且非负。当一个余弦信号 $\\cos(\\Omega n)$ 通过一个具有频率响应 $H(e^{j\\omega})$ 的LTI系统时，输出是 $H(e^{j\\Omega}) \\cos(\\Omega n)$。我们将此原理应用于上采样信号 $u[n]$ 的每个分量。$u[n]$ 中的第 $k$ 个余弦分量的振幅为 $1/L$，频率为 $\\Omega_k$。因此，输出信号 $y[n]$ 是通过将每个分量乘以滤波器在该频率处的增益得到的：\n$$\ny[n] = \\sum_{k=0}^{L-1} \\frac{1}{L} H(e^{j\\Omega_k}) \\cos(\\Omega_k n)\n$$\n将 $H(e^{j\\omega})$ 和 $\\Omega_k$ 的表达式代入，我们得到第 $k$ 个分量的振幅为：\n$$\nA_k = \\frac{1}{L} \\left[ \\frac{1}{L} \\left( \\frac{\\sin(L\\Omega_k/2)}{\\sin(\\Omega_k/2)} \\right)^2 \\right] = \\frac{1}{L^2} \\left( \\frac{\\sin(L\\frac{\\omega_0+2\\pi k}{2L})}{\\sin(\\frac{\\omega_0+2\\pi k}{2L})} \\right)^2 = \\frac{1}{L^2} \\left( \\frac{\\sin(\\omega_0/2 + k\\pi)}{\\sin(\\frac{\\omega_0+2\\pi k}{2L})} \\right)^2\n$$\n由于 $\\sin(x+k\\pi) = (-1)^k \\sin(x)$，我们有 $\\sin^2(x+k\\pi) = \\sin^2(x)$。因此，分子简化为 $\\sin^2(\\omega_0/2)$。最终的振幅为：\n$$\nA_k = \\frac{1}{L^2} \\frac{\\sin^2(\\omega_{0}/2)}{\\sin^2\\left(\\frac{\\omega_{0}+2\\pi k}{2L}\\right)}\n$$\n将这些振幅代入 $y[n]$ 的表达式，我们得到最终的答案：\n$$\ny[n] = \\sum_{k=0}^{L-1} \\left( \\frac{1}{L^2} \\frac{\\sin^2(\\omega_{0}/2)}{\\sin^2\\left(\\frac{\\omega_{0}+2\\pi k}{2L}\\right)} \\right) \\cos\\left( \\left(\\frac{\\omega_{0}+2\\pi k}{L}\\right) n \\right)\n$$", "answer": "$$\\boxed{y[n] = \\sum_{k=0}^{L-1} \\left( \\frac{1}{L^2} \\frac{\\sin^2(\\omega_{0}/2)}{\\sin^2\\left(\\frac{\\omega_{0}+2\\pi k}{2L}\\right)} \\right) \\cos\\left( \\left(\\frac{\\omega_{0}+2\\pi k}{L}\\right) n \\right)}$$", "id": "2874155"}, {"introduction": "现实世界中的采样率转换通常是异步的，需要实现非整数倍的速率变化。本练习将所有核心概念——抗混叠/抗镜像滤波、实际滤波器设计中的权衡、以及高效实现方法——整合到一个全面的设计问题中。它将指导您根据性能指标（如纹波和误差）来指定系统，并计算必要的资源（滤波器长度、内存），这正是一个真实的工程设计任务的缩影 [@problem_id:2874140]。", "problem": "设计并分析一个通过带动态多相表的加窗sinc有限冲激响应(FIR)核实现的异步采样率转换(SRC)级。该SRC将采样率为 $f_{\\mathrm{i}}$ (单位Hz)的输入离散时间信号映射到采样率为 $f_{\\mathrm{o}}$ (单位Hz)的输出，其转换比率 $r = f_{\\mathrm{o}}/f_{\\mathrm{i}}$ 通常为无理数。该核是理想带限插值的一个截断和加窗近似。动态多相结构使用一个小数延迟相位的查找表，以在重采样引起的瞬时小数延迟处评估核函数。目标是 (i) 确定满足指定通带波纹所需的最小滤波器长度 $N$；(ii) 确定满足指定的最大总通带幅度误差预算所需的最小存储小数延迟相位数 $P$；以及 (iii) 计算存储系数表和输入状态缓冲所需的总内存。\n\n从适用于多速率信号处理和线性时不变FIR滤波器设计的第一性原理出发：\n\n- 理想带限插值由sinc核表征，而实际实现通过对sinc进行截断和加窗获得的有限长度FIR滤波器来近似它。\n- 为避免异步重采样中的混叠和镜像，必须将基带限制在一个对输入和输出采样率都有效的公共通带内。\n- 经典的窗函数设计将可实现的阻带衰减与窗参数和所需的过渡带宽联系起来，从而与最小FIR长度联系起来。\n- 通过有限的相表密度对小数延迟进行量化，会在通带幅度中引入一个额外的偏差，该偏差必须保持在未被通带波纹占用的剩余误差预算之内。\n\n您的程序必须实现基于这些基础推导出的以下逻辑：\n\n1. 确定阻带边缘 $\\Omega_{\\mathrm{s}}$ (单位为弧度/采样点)，并归一化到输入采样网格。证明异步转换的公共基带约束意味着 $\\Omega_{\\mathrm{s}} = \\pi \\min(1, r)$，并选择通带边缘 $\\Omega_{\\mathrm{p}} = \\Omega_{\\mathrm{s}} - \\Delta\\omega$，其中 $\\Delta\\omega$ 是非负的过渡带宽(单位为弧度)。所有角度必须以弧度为单位。\n\n2. 给定通带波纹规格 $\\delta_{\\mathrm{p}}$ (无量纲，使用小数形式而非百分比)和过渡带宽 $\\Delta\\omega$，推导FIR长度 $N$ 的一个下界，以使加窗sinc低通滤波器能够达到指定的波纹。使用一个经过充分测试的窗设计框架，将阻带衰减与 $\\delta_{\\mathrm{p}}$ 和 $\\Delta\\omega$ 联系起来，并由此得到最小整数 $N$。选择 $N$ 为满足该下界的最小奇数。\n\n3. 给定一个最大总通带幅度误差预算 $\\delta_{\\max}$ (无量纲)，在考虑通带波纹后，将剩余误差分配给相表量化，即 $\\delta_{\\mathrm{phase}} = \\delta_{\\max} - \\delta_{\\mathrm{p}}$。使用复指数的小角度边界来为由小数延迟量化(从一个采样点延迟内的 $P$ 个均匀间隔的相位中选择最近邻相位)引起的通带幅度偏差设定上界。推导出 $P$ 的一个充分下界，以保证在 $[0, \\Omega_{\\mathrm{p}}]$ 上的感应偏差不超过 $\\delta_{\\mathrm{phase}}$，然后选择 $P$ 为满足该下界且 $P \\ge 1$ 的最小整数。\n\n4. 假设系数和采样点均使用32位浮点数存储。按如下公式计算总内存(单位为字节)：\n$$\nM = P \\, N \\, B_{\\mathrm{c}} + N \\, B_{\\mathrm{s}},\n$$\n其中每个系数 $B_{\\mathrm{c}} = 4$ 字节，每个状态采样点 $B_{\\mathrm{s}} = 4$ 字节，并且只保留一个长度为 $N$ 的输入延迟线。如果由于 $\\Delta\\omega \\ge \\Omega_{\\mathrm{s}}$ 或 $\\delta_{\\mathrm{phase}} \\le 0$ 导致规格不可行，则该测试用例返回整数$-1$。\n\n所有角度单位必须是弧度。内存必须表示为整数字节。所有波纹和误差预算必须是小数(例如，0.001)，而不是百分比。\n\n将您的解决方案实现为一个完整的、可运行的程序，并将上述设计应用于以下测试套件。每个测试用例是一个元组 $(f_{\\mathrm{i}}, f_{\\mathrm{o}}, \\mathrm{tw}, \\delta_{\\mathrm{p}}, \\delta_{\\max})$，其中 $\\mathrm{tw}$ 是表示为 $\\pi$ 的分数的过渡带宽，因此 $\\Delta\\omega = \\pi \\,\\mathrm{tw}$：\n\n- 测试 1 (顺利的降采样路径): $(48000, 44100, 0.05, 0.001, 0.002)$\n- 测试 2 (顺利的升采样路径): $(44100, 96000, 0.10, 0.0005, 0.0012)$\n- 测试 3 (不可行的误差预算边界): $(48000, 48000, 0.02, 0.0001, 0.0001)$\n- 测试 4 (窄过渡带的强降采样): $(192000, 8000, 0.01, 0.002, 0.005)$\n- 测试 5 (不可行的过渡带宽): $(22050, 11025, 0.60, 0.001, 0.002)$\n\n您的程序必须打印一行，其中包含测试套件的结果，格式为方括号括起来的逗号分隔列表(例如，$[m_1,m_2,m_3,m_4,m_5]$)，其中每个 $m_k$ 是测试 $k$ 的总内存整数(单位为字节)，如果不可行则为-1。", "solution": "对所提供的问题进行了严格的验证。\n\n### 步骤 1: 提取已知条件\n- **输入信号速率**: $f_{\\mathrm{i}}$，单位Hz。\n- **输出信号速率**: $f_{\\mathrm{o}}$，单位Hz。\n- **重采样比率**: $r = f_{\\mathrm{o}}/f_{\\mathrm{i}}$。\n- **核心技术**: 使用带动态多相表的加窗sinc有限冲激响应(FIR)核的异步采样率转换(SRC)。\n- **滤波器长度**: $N$，待定。\n- **多相相位数**: $P$，待定。\n- **通带波纹规格**: $\\delta_{\\mathrm{p}}$ (无量纲)。\n- **最大总通带幅度误差**: $\\delta_{\\max}$ (无量纲)。\n- **过渡带宽**: $\\Delta\\omega$，单位为弧度/采样点，由小数参数 $\\mathrm{tw}$ 导出，即 $\\Delta\\omega = \\pi \\cdot \\mathrm{tw}$。\n- **阻带边缘频率**: $\\Omega_{\\mathrm{s}} = \\pi \\min(1, r)$ 弧度/采样点，归一化到输入采样网格。\n- **通带边缘频率**: $\\Omega_{\\mathrm{p}} = \\Omega_{\\mathrm{s}} - \\Delta\\omega$ 弧度/采样点。\n- **滤波器长度约束**: $N$ 必须是满足设计要求的最小奇数。\n- **相位量化误差预算**: $\\delta_{\\mathrm{phase}} = \\delta_{\\max} - \\delta_{\\mathrm{p}}$。\n- **相表大小约束**: $P$ 必须是满足误差预算 $\\delta_{\\mathrm{phase}}$ 且 $P \\ge 1$ 的最小整数。\n- **存储**: $B_{\\mathrm{c}} = 4$ 字节用于32位浮点系数；$B_{\\mathrm{s}} = 4$ 字节用于32位浮点状态采样点。\n- **总内存计算**: $M = P \\cdot N \\cdot B_{\\mathrm{c}} + N \\cdot B_{\\mathrm{s}}$。\n- **不可行条件**: 如果 $\\Delta\\omega \\ge \\Omega_{\\mathrm{s}}$ 或 $\\delta_{\\mathrm{phase}} \\le 0$，则设计不可行。在此情况下，输出为-1。\n\n### 步骤 2: 验证\n该问题在科学上基于数字信号处理的既定原则，特别是多速率系统和FIR滤波器设计。sinc插值、加窗方法、多相结构和误差预算等概念都是标准的，并且表述准确。该问题是适定的，提供了一条从一组输入到唯一输出的清晰、确定性的路径。它以客观、技术性的语言表述。使用“经过充分测试的窗设计框架”的要求被解释为采用标准的经验公式，其中Kaiser窗设计方程是一个合适且行业标准的选择。关于相表大小的推导，提示建议使用小角度近似，这指向了对相量化误差的标准分析。该问题是自包含的、一致的且可形式化的。\n\n### 步骤 3: 结论\n该问题被判定为**有效**。将基于所述原则开发一个完整的解决方案。\n\n### 解决方案推导\n解决方案是按照问题陈述中指定的步骤顺序推导出来的。\n\n**1. 通带和阻带边缘频率**\n\n异步采样率转换的基础是将离散时间输入信号视为底层连续时间带限信号的样本，然后以新的输出速率重新采样该信号。为防止重采样时发生混叠，信号的带宽必须限制在*输入*和*输出*采样网格的奈奎斯特频率之下。\n输入奈奎斯特频率是每个输入采样点 $\\pi$ 弧度。当映射回输入网格时，输出奈奎斯特频率是每个输入采样点 $\\pi \\cdot (f_{\\mathrm{o}}/f_{\\mathrm{i}}) = \\pi r$ 弧度。因此，信号必须经过低通滤波，其截止频率低于这两个奈奎斯特频率的最小值。这决定了所需抗混叠/抗镜像滤波器的阻带边缘 $\\Omega_{\\mathrm{s}}$，归一化到输入采样率 $f_{\\mathrm{i}}$：\n$$\n\\Omega_{\\mathrm{s}} = \\min(\\pi, \\pi r) = \\pi \\min(1, r)\n$$\n滤波器的通带必须在向阻带过渡开始之前结束。给定指定的过渡带宽 $\\Delta\\omega$，通带边缘频率 $\\Omega_{\\mathrm{p}}$ 为：\n$$\n\\Omega_{\\mathrm{p}} = \\Omega_{\\mathrm{s}} - \\Delta\\omega\n$$\n一个物理上有意义的滤波器需要一个非负的过渡区，因此 $\\Delta\\omega  \\Omega_{\\mathrm{s}}$。如果 $\\Delta\\omega \\ge \\Omega_{\\mathrm{s}}$，通带宽度将为零或负，这是一个不可行的规格。\n\n**2. FIR滤波器长度 $N$**\n\nFIR滤波器近似于理想的砖墙式低通响应。指定了加窗sinc设计。滤波器长度 $N$ 主要由所需的过渡带锐度 $\\Delta\\omega$ 和所需的阻带衰减 $A$ 决定。通带波纹规格 $\\delta_{\\mathrm{p}}$ 用于确定 $A$。对于通过加窗设计的线性相位FIR滤波器，一个合理的近似是通带波纹和阻带波纹相等：$\\delta_{\\mathrm{s}} \\approx \\delta_{\\mathrm{p}}$。以分贝为单位的阻带衰减定义为：\n$$\nA = -20 \\log_{10}(\\delta_{\\mathrm{p}})\n$$\n我们采用Kaiser窗的经验公式，该公式提供了滤波器长度 $N$、过渡带宽 $\\Delta\\omega$ 和衰减 $A$ 之间的关系。所需的滤波器阶数 $M=N-1$ 由下式给出：\n$$\nM \\approx \\frac{A - 8}{2.285 \\Delta\\omega}\n$$\n因此，所需的滤波器长度 $N = M+1$ 为：\n$$\nN \\ge \\frac{A - 8}{2.285 \\Delta\\omega} + 1\n$$\n问题要求 $N$ 为满足此界限的最小*奇数*。这确保了具有整数样本延迟的I型线性相位滤波器。我们计算 $N$ 的浮点数下界，取其上整以找到最小整数长度，如果结果为偶数，则增加到下一个奇数。\n\n**3. 多相表大小 $P$**\n\n总通带幅度误差预算 $\\delta_{\\max}$ 在滤波器的固有通带波纹 $\\delta_{\\mathrm{p}}$ 和由量化小数延迟引入的误差之间分配。为延迟量化剩余的预算为：\n$$\n\\delta_{\\mathrm{phase}} = \\delta_{\\max} - \\delta_{\\mathrm{p}}\n$$\n如果 $\\delta_{\\mathrm{phase}} \\le 0$，则仅滤波器的波纹就耗尽了整个误差预算，使规格不可行。\n\n一个具有 $P$ 个条目的多相表将连续的小数延迟 $\\tau \\in [0, 1)$ 量化为集合 $\\{0, 1/P, \\dots, (P-1)/P\\}$ 中的最近值。小数延迟的最大误差是 $\\Delta\\tau_{\\max} = 1/(2P)$ 个采样点。此时域误差会扰动理想的小数延迟滤波器响应 $e^{-j\\omega\\tau}$。引入的相对误差是 $e^{-j\\omega\\Delta\\tau} - 1$。假设目标通带幅度为1，此复数误差项的幅度可以很好地近似所产生的通带幅度偏差：\n$$\n\\text{Error}(\\omega, \\Delta\\tau) = |e^{-j\\omega\\Delta\\tau} - 1| = \\sqrt{(\\cos(\\omega\\Delta\\tau) - 1)^2 + \\sin^2(\\omega\\Delta\\tau)} = 2|\\sin(\\omega\\Delta\\tau/2)|\n$$\n此误差在通带边缘 $\\omega = \\Omega_{\\mathrm{p}}$ 和最大延迟误差 $|\\Delta\\tau| = 1/(2P)$ 时最大化。为满足规格，我们必须确保此最大误差不超过 $\\delta_{\\mathrm{phase}}$：\n$$\n2\\sin\\left(\\frac{\\Omega_{\\mathrm{p}}}{4P}\\right) \\le \\delta_{\\mathrm{phase}}\n$$\n使用不等式 $\\sin(x) \\le x$ (对于 $x \\ge 0$)，我们推导出一个更易于求解的充分条件：\n$$\n2\\left(\\frac{\\Omega_{\\mathrm{p}}}{4P}\\right) \\le \\delta_{\\mathrm{phase}} \\implies \\frac{\\Omega_{\\mathrm{p}}}{2P} \\le \\delta_{\\mathrm{phase}}\n$$\n由此，我们得到 $P$ 的一个下界：\n$$\nP \\ge \\frac{\\Omega_{\\mathrm{p}}}{2 \\cdot \\delta_{\\mathrm{phase}}}\n$$\n问题要求选择满足此界限的最小整数 $P \\ge 1$。因此，我们计算此下界的上整，并确保其至少为1。\n\n**4. 总内存 $M$**\n\n总内存是系数表和输入信号状态缓冲(延迟线)所需内存的总和。\n- 系数表为 $P$ 个小数相位中的每一个存储 $N$ 个系数。每个系数为 $B_{\\mathrm{c}}=4$ 字节，因此这是 $P \\cdot N \\cdot B_{\\mathrm{c}}$ 字节。\n- 输入状态缓冲必须保存 $N$ 个输入样本的历史记录才能计算一个输出样本。每个样本为 $B_{\\mathrm{s}}=4$ 字节，因此这是 $N \\cdot B_{\\mathrm{s}}$ 字节。\n\n因此，总内存(单位为字节)为：\n$$\nM = P \\cdot N \\cdot B_{\\mathrm{c}} + N \\cdot B_{\\mathrm{s}} = (P \\cdot B_{\\mathrm{c}} + B_{\\mathrm{s}}) \\cdot N\n$$\n这为每个有效的测试用例提供了最终的整数结果。如果在任何阶段发现某个用例不可行，则结果为-1。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Designs an asynchronous SRC stage and calculates the required memory.\n\n    The function implements the logic derived from first principles of multirate\n    signal processing and FIR filter design to determine the minimum filter length N\n    and polyphase table size P, and from them, the total memory M.\n    \"\"\"\n\n    # Test cases: (f_i, f_o, tw, delta_p, delta_max)\n    # f_i, f_o: input/output sampling rates in Hz\n    # tw: transition width as a fraction of pi\n    # delta_p: passband ripple (dimensionless)\n    # delta_max: total passband magnitude error budget (dimensionless)\n    test_cases = [\n        (48000, 44100, 0.05, 0.001, 0.002),\n        (44100, 96000, 0.10, 0.0005, 0.0012),\n        (48000, 48000, 0.02, 0.0001, 0.0001),\n        (192000, 8000, 0.01, 0.002, 0.005),\n        (22050, 11025, 0.60, 0.001, 0.002),\n    ]\n\n    results = []\n    \n    # Storage size in bytes for 32-bit floats\n    B_c = 4  # Bytes per coefficient\n    B_s = 4  # Bytes per state-sample\n\n    for case in test_cases:\n        f_i, f_o, tw, delta_p, delta_max = case\n\n        # Step 1: Determine stopband and passband edges\n        r = f_o / f_i\n        delta_omega = np.pi * tw\n        Omega_s = np.pi * min(1, r)\n\n        # Infeasibility Check 1: Non-positive passband width\n        if delta_omega >= Omega_s:\n            results.append(-1)\n            continue\n            \n        Omega_p = Omega_s - delta_omega\n\n        # Step 3 (part 1): Determine phase quantization error budget\n        delta_phase = delta_max - delta_p\n        \n        # Infeasibility Check 2: Non-positive error budget for phase quantization\n        if delta_phase = 0:\n            results.append(-1)\n            continue\n\n        # Step 2: Determine FIR filter length N using Kaiser window formula\n        # Stopband attenuation in dB\n        A = -20 * np.log10(delta_p)\n        \n        # Kaiser window empirical formula for filter length N\n        # N >= (A - 8) / (2.285 * delta_omega) + 1\n        # The formula applies for A > 8. All test cases satisfy this.\n        n_float = (A - 8) / (2.285 * delta_omega) + 1\n        \n        # N must be the smallest odd integer satisfying the bound\n        N = int(np.ceil(n_float))\n        if N % 2 == 0:\n            N += 1\n\n        # Step 3 (part 2): Determine polyphase table size P\n        # Lower bound for P from passband magnitude error constraint\n        # P >= Omega_p / (2 * delta_phase)\n        p_float = Omega_p / (2 * delta_phase)\n        \n        # P must be the smallest integer >= 1 satisfying the bound\n        P = int(np.ceil(p_float))\n        if P  1:\n            P = 1\n\n        # Step 4: Compute total memory M\n        M = P * N * B_c + N * B_s\n        results.append(int(M))\n\n    # Print the final results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2874140"}]}