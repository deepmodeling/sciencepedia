## 引言
在[非线性](@entry_id:637147)控制理论的宏伟蓝图中，**[相对阶](@entry_id:171358)（Relative Degree）** 扮演着一个至关重要的角色。它不仅是一个数学上的度量，更是连接复杂非线性系统动态与可行控制策略之间的桥梁。对于许多非线性系统，其控制输入与系统输出之间的关系并非直接明了，往往存在着动态延迟。[相对阶](@entry_id:171358)这一概念的提出，正是为了精确量化这种延迟，从而解决了如何系统性地分析并简化这种复杂输入-输出关系的核心知识空白。

掌握[相对阶](@entry_id:171358)是设计高级[非线性](@entry_id:637147)控制器的关键一步，特别是对于**[反馈线性化](@entry_id:163432)**这一强大的技术而言。本文旨在为读者提供一个关于[相对阶](@entry_id:171358)的全面而深入的指南。
- 在**“原理与机制”**一章中，我们将从基础的李导数（Lie derivative）出发，建立[相对阶](@entry_id:171358)的严格数学定义，并详细阐述其计算方法。您将学习到[相对阶](@entry_id:171358)如何揭示系统的内在结构，例如它与[零动态](@entry_id:177017)（zero dynamics）的深刻联系。
- 接着，在**“应用与[交叉](@entry_id:147634)学科联系”**一章中，我们将探索[相对阶](@entry_id:171358)在实际工程问题中的广泛应用。我们将展示它如何作为[输入输出线性化](@entry_id:168215)和轨迹[跟踪控制](@entry_id:170442)的基石，并讨论其在机器人学和自适应控制等[交叉](@entry_id:147634)学科领域中的重要意义。
- 最后，在**“动手实践”**部分，您将通过一系列精心设计的计算和设计练习，将理论知识转化为实践技能，从而真正巩固对[相对阶](@entry_id:171358)的理解。

通过本文的学习，您将能够洞悉非线性系统的深层结构，并掌握利用[相对阶](@entry_id:171358)来分析和设计控制系统的核心能力。

## 原理与机制

本章旨在深入探讨[非线性系统](@entry_id:168347)的[相对阶](@entry_id:171358)（relative degree）这一核心概念。[相对阶](@entry_id:171358)量化了系统的输入对输出的动态影响延迟，是理解和设计[非线性](@entry_id:637147)控制器，特别是实现[反馈线性化](@entry_id:163432)（feedback linearization）的关键。我们将从基本定义出发，系统地阐述其原理、计算方法及其在分析系统内部结构（如[零动态](@entry_id:177017)）中的重要作用。

### 李导数：沿动态流动的变化率

在深入研究[相对阶](@entry_id:171358)之前，我们必须首先掌握一个关键的数学工具：**[李导数](@entry_id:171745) (Lie derivative)**。想象一个[标量场](@entry_id:151443)（scalar field）$h(x)$，例如空间中的温度[分布](@entry_id:182848)，以及一个向量场（vector field）$f(x)$，例如该空间中的流体速度。[李导数](@entry_id:171745) $L_f h(x)$ 描述了当我们跟随由向量场$f$定义的轨迹（或“流”）运动时，标量$h$的[瞬时变化率](@entry_id:141382)。

考虑由自治常微分方程 $\dot{x} = f(x)$ 描述的动态系统。其解，即从初始点$x$开始的轨迹，由流映射 $\phi_t(x)$ 给出。标量函数$h$沿着这条轨迹的值为 $h(\phi_t(x))$。[李导数](@entry_id:171745)被精确定义为这个值在$t=0$时刻对时间的变化率 [@problem_id:2739596]。利用[多变量微积分](@entry_id:147547)中的[链式法则](@entry_id:190743)，我们可以得到其更为实用的计算形式：

$L_f h(x) = \left.\frac{d}{dt} h(\phi_t(x))\right|_{t=0} = \frac{\partial h}{\partial x}(x) f(x) = \nabla h(x)^\top f(x)$

其中 $\nabla h(x)$ 是 $h$ 在点 $x$ 的梯度向量。这个表达式直观地表示了在点 $x$ 处，$h$ 沿着方向 $f(x)$ 的方向导数。

由于 $L_f h(x)$ 本身也是一个[标量场](@entry_id:151443)，我们可以重复应用李导数算子，从而定义**高阶李导数**。迭代定义如下：

- $L_f^0 h(x) := h(x)$
- $L_f^k h(x) := L_f(L_f^{k-1} h(x)) = \frac{\partial (L_f^{k-1} h)}{\partial x}(x) f(x)$, for $k \ge 1$

这个迭代结构是定义和计算[相对阶](@entry_id:171358)的基础。

### [相对阶](@entry_id:171358)：揭示输入-输出关系

现在，我们考虑一个典型的单输入单输出（SISO）输入仿射非线性系统：

$\dot{x} = f(x) + g(x)u, \quad y = h(x)$

其中 $x \in \mathbb{R}^n$ 是状态， $u \in \mathbb{R}$ 是控制输入，$y \in \mathbb{R}$ 是输出。向量场 $f(x)$ 称为**漂移向量场 (drift vector field)**，而 $g(x)$ 称为**控制向量场 (control vector field)**。

一个自然而然的核心问题是：控制输入 $u$ 需要经过多少次对输出 $y$ 的时间求导才能显式地出现？这个次数就是系统的[相对阶](@entry_id:171358)。为了回答这个问题，我们沿着系统轨迹对输出 $y$ 进行时间求导 [@problem_id:2739640]。

利用[链式法则](@entry_id:190743)和[李导数](@entry_id:171745)的定义，$y$ 的一阶时间导数为：

$\dot{y} = \frac{d}{dt}h(x) = \frac{\partial h}{\partial x} \dot{x} = \frac{\partial h}{\partial x} (f(x) + g(x)u)$

$\dot{y} = L_f h(x) + L_g h(x) u$

观察上式，输入 $u$ 出现在一阶导数中的充要条件是其系数 $L_g h(x)$ 不为零。如果在一个感兴趣的区域内 $L_g h(x) = 0$，那么 $\dot{y} = L_f h(x)$，输入 $u$ 在一阶导数中是“不可见”的。此时，我们必须继续求导：

$\ddot{y} = \frac{d}{dt}\dot{y} = \frac{d}{dt}(L_f h(x)) = \frac{\partial(L_f h)}{\partial x} \dot{x}$

$\ddot{y} = \frac{\partial(L_f h)}{\partial x} (f(x) + g(x)u) = L_f(L_f h(x)) + L_g(L_f h(x)) u$

$\ddot{y} = L_f^2 h(x) + L_g L_f h(x) u$

现在，输入 $u$ 出现在[二阶导数](@entry_id:144508)中的充要条件是其系数 $L_g L_f h(x)$ 不为零。这个过程揭示了定义[相对阶](@entry_id:171358)的系统性方法。

### [相对阶](@entry_id:171358)的严格定义

基于上述推导，我们可以给出在点 $x_0$ 处**[相对阶](@entry_id:171358) (relative degree)** 的严格定义 [@problem_id:2739637]。

对于SISO输入[仿射系统](@entry_id:634107)，如果在点 $x_0$ 存在一个最小的正整数 $r \ge 1$，满足以下两个条件：

1.  对于所有整数 $k \in \{0, 1, \dots, r-2\}$，有 $L_g L_f^k h(x_0) = 0$。
2.  $L_g L_f^{r-1} h(x_0) \neq 0$。

那么，我们称系统在点 $x_0$ 的[相对阶](@entry_id:171358)为 $r$。

第一个条件意味着，直到对输出求导 $r-1$ 次，输入 $u$ 的影响都为零。第二个条件 $L_g L_f^{r-1} h(x_0) \neq 0$ 被称为**解耦条件 (decoupling condition)**，它确保了在对输出求导 $r$ 次之后，输入 $u$ 最终以一个非零的系数出现。这个非零系数本身在[反馈线性化](@entry_id:163432)中扮演着至关重要的角色。

在这些条件下，输出的前 $r-1$ 阶导数不依赖于输入 $u$：

$y^{(k)}(x) = L_f^k h(x), \quad \text{其中 } k=1, \dots, r-1$

而第 $r$ 阶导数则是一个关于 $u$ 的仿射表达式：

$y^{(r)}(x) = L_f^r h(x) + L_g L_f^{r-1} h(x) u$

#### 深入理解输出导数的结构

值得强调的是，[相对阶](@entry_id:171358)的定义条件具有深刻的结构意义。在没有任何假设的情况下，对输出进行高阶求导会产生复杂的表达式。例如，$\ddot{y}$ 的完整表达式为 [@problem_id:2739609]：

$\ddot{y} = L_f^2 h + (L_g L_f h + L_f L_g h)u + (L_g^2 h)u^2 + (L_g h)\dot{u}$

这个表达式包含了 $u$ 的高次幂（$u^2$）和 $u$ 的时间导数（$\dot{u}$），这使得控制设计变得异常困难。然而，当[相对阶](@entry_id:171358) $r \ge 2$ 的条件（即 $L_g h(x) \equiv 0$ 在邻域内成立）满足时，上式中的 $L_g^2 h$, $L_f L_g h$ 和 $L_g h$ 项都将变为零。这使得 $\ddot{y}$ 的表达式奇迹般地简化为 $\ddot{y} = L_f^2 h + (L_g L_f h)u$，即一个关于 $u$ 的简单仿射形式。这正是[相对阶](@entry_id:171358)概念如此强大的原因：它为将复杂的[非线性](@entry_id:637147)输入-输出关系简化为[线性形式](@entry_id:276136)提供了精确的条件。

#### 计算实例

让我们通过一个具体的例子来固化这些概念 [@problem_id:2739605]。考虑一个二维系统：

$f(x)=\begin{bmatrix}x_{2}\\ x_{1}^{3}\end{bmatrix}, \quad g(x)=\begin{bmatrix}0\\ 1\end{bmatrix}, \quad h(x)=x_{1}$

首先，我们检查 $r=1$ 的情况，计算 $L_g h(x)$：

$\nabla h(x) = \begin{bmatrix} 1  0 \end{bmatrix}$

$L_g h(x) = \nabla h(x) \cdot g(x) = \begin{bmatrix} 1  0 \end{bmatrix} \begin{bmatrix} 0 \\ 1 \end{bmatrix} = 0$

由于 $L_g h(x) = 0$，[相对阶](@entry_id:171358) $r > 1$。

接下来，我们检查 $r=2$ 的情况。为此，需要计算 $L_g L_f h(x)$。首先计算中间项 $L_f h(x)$：

$L_f h(x) = \nabla h(x) \cdot f(x) = \begin{bmatrix} 1  0 \end{bmatrix} \begin{bmatrix} x_2 \\ x_1^3 \end{bmatrix} = x_2$

现在，我们将 $L_f h(x)$ 视为一个新的[标量场](@entry_id:151443)，并对其应用 $L_g$。令 $\psi(x) = L_f h(x) = x_2$：

$\nabla \psi(x) = \begin{bmatrix} 0  1 \end{bmatrix}$

$L_g L_f h(x) = L_g \psi(x) = \nabla \psi(x) \cdot g(x) = \begin{bmatrix} 0  1 \end{bmatrix} \begin{bmatrix} 0 \\ 1 \end{bmatrix} = 1$

由于 $L_g L_f h(x) = 1 \neq 0$，并且这是第一个非零项，我们得出结论：该系统的[相对阶](@entry_id:171358) $r=2$。

### [相对阶](@entry_id:171358)的理论属性与[反馈线性化](@entry_id:163432)

[相对阶](@entry_id:171358)不仅仅是一个计算指标，它揭示了系统深层的几何结构，并直接关联到控制理论中的一个强大技术——**[反馈线性化](@entry_id:163432) (feedback linearization)**。

#### [相对阶](@entry_id:171358)的界限与坐标变换

一个基础而重要的理论结果是，如果一个 $n$ 维系统的[相对阶](@entry_id:171358) $r$ 存在，那么它必须满足 $1 \le r \le n$ [@problem_id:2739583]。这个界限的背后是深刻的几何原因：可以证明，函数集合 $\{h(x), L_f h(x), \dots, L_f^{r-1} h(x)\}$ 在点 $x_0$ 的[微分](@entry_id:158718)（即它们的梯度）是线性无关的。在一个 $n$ 维空间中，最多只能有 $n$ 个[线性无关](@entry_id:148207)的向量，因此 $r$ 不能超过 $n$。

这组函数的重要性在于它们可以作为新[坐标系](@entry_id:156346)的一部分。考虑如下的[坐标变换](@entry_id:172727)：

$\Phi: x \mapsto z = (\phi_1(x), \phi_2(x), \dots, \phi_n(x))$

其中前 $r$ 个坐标被定义为：

$z_1 = \phi_1(x) = h(x)$
$z_2 = \phi_2(x) = L_f h(x)$
...
$z_r = \phi_r(x) = L_f^{r-1} h(x)$

在这些新坐标下，系统的前 $r$ 个动态方程变得异常简单。对于 $i=1, \dots, r-1$：

$\dot{z}_i = \frac{d}{dt}(L_f^{i-1}h(x)) = L_f^i h(x) + L_g L_f^{i-1} h(x) u$

根据[相对阶](@entry_id:171358)的定义，$L_g L_f^{i-1} h(x)=0$ 对所有 $i \le r-1$ 成立。因此：

$\dot{z}_i = L_f^i h(x) = z_{i+1}$

而第 $r$ 个动态方程为：

$\dot{z}_r = \frac{d}{dt}(L_f^{r-1}h(x)) = L_f^r h(x) + L_g L_f^{r-1} h(x) u$

这个[方程组](@entry_id:193238)清晰地展示了输入-输出关系。我们可以定义一个新的虚拟输入 $v$，并设计一个[状态反馈控制](@entry_id:271611)律 $u$ 来使得 $\dot{z}_r = v$：

$v = L_f^r h(x) + L_g L_f^{r-1} h(x) u$

由于[解耦](@entry_id:637294)条件 $L_g L_f^{r-1} h(x) \neq 0$ 成立，我们可以解出 $u$：

$u = \frac{v - L_f^r h(x)}{L_g L_f^{r-1} h(x)}$

通过这个反馈，系统的输入 $v$ 和输出 $y=z_1$ 之间的关系变成了一个简单的 $r$ 阶积分链：$y^{(r)} = v$。这就是**输入-输出线性化**。

#### [零动态](@entry_id:177017)：系统的内部行为

当[相对阶](@entry_id:171358) $r  n$ 时，我们只对系统的 $r$ 个状态进行了线性化。那么，剩下的 $n-r$ 个状态的动态行为是怎样的呢？这就引出了**[零动态](@entry_id:177017) (zero dynamics)** 的概念 [@problem_id:2739622]。

[零动态](@entry_id:177017)被定义为当系统输出被强制保持为零（即 $y(t) \equiv 0$）时，系统内部的状态演化。为了使 $y(t)$ 恒为零，其所有时间导数也必须为零：$y(t) = \dot{y}(t) = \dots = y^{(r-1)}(t) = 0$。这等价于状态 $x$ 被约束在一个特定的[流形](@entry_id:153038)上，称为**[零动态](@entry_id:177017)[流形](@entry_id:153038) (zero dynamics manifold)** $\mathcal{Z}$：

$\mathcal{Z} = \{ x \in \mathbb{R}^n : h(x) = L_f h(x) = \dots = L_f^{r-1} h(x) = 0 \}$

此外，第 $r$ 阶导数也必须为零，$y^{(r)}(t) = 0$，这决定了维持这种状态所需的特定反馈控制 $u^\star(x)$：

$L_f^r h(x) + L_g L_f^{r-1} h(x) u^\star(x) = 0 \implies u^\star(x) = -\frac{L_f^r h(x)}{L_g L_f^{r-1} h(x)}$

将这个控制律 $u^\star(x)$ 代入原系统方程 $\dot{x} = f(x) + g(x)u^\star(x)$，并把动态限制在[流形](@entry_id:153038) $\mathcal{Z}$ 上，所得到的 $n-r$ 维动态系统就是[零动态](@entry_id:177017)。

例如，对于问题 [@problem_id:2739622] 中的四维系统，我们发现其[相对阶](@entry_id:171358) $r=2$。[零动态](@entry_id:177017)[流形](@entry_id:153038) $\mathcal{Z}$ 由 $x_1=0$ 和 $x_2=0$ 定义。在该[流形](@entry_id:153038)上，系统的内部动态（由状态 $z_1=x_3, z_2=x_4$ 描述）演变为：

$\dot{z}_1 = z_2$
$\dot{z}_2 = -z_1$

这是一个简单的[谐振子](@entry_id:155622)，描述了当系统输出被镇定到零时，内部状态 $x_3$ 和 $x_4$ 的持续[振荡](@entry_id:267781)。

[零动态](@entry_id:177017)的稳定性至关重要。如果[零动态](@entry_id:177017)是稳定的，那么系统被称为**[最小相位](@entry_id:273619) (minimum phase)** 系统。在这种情况下，实现输入-输出线性化的控制律不会导致内部状态发散，从而保证了整个[闭环系统](@entry_id:270770)的稳定性。反之，如果[零动态](@entry_id:177017)不稳定（即**[非最小相位](@entry_id:267340)**），则单纯的输入-输出线性化是危险的。特别地，当 $r=n$ 时，[零动态](@entry_id:177017)的维数是 $n-r=0$，系统没有内部动态。这种情况下，输入-输出线性化等同于对整个系统进行线性化，称为**精确状态[反馈线性化](@entry_id:163432) (exact state feedback linearization)** [@problem_id:2739583]。

### 扩展与实际考量

#### 局部与一致[相对阶](@entry_id:171358)

到目前为止，我们主要讨论在单点 $x_0$ 处的[相对阶](@entry_id:171358)。然而，在实际控制设计中，控制器需要在[状态空间](@entry_id:177074)的一个开放区域 $\mathcal{U}$ 内有效工作。这就需要[相对阶](@entry_id:171358)在该区域内是恒定的，这引出了**一致[相对阶](@entry_id:171358) (uniform relative degree)** 的概念 [@problem_id:2739615]。

一个系统在开集 $\mathcal{U}$ 上具有一致[相对阶](@entry_id:171358) $r$，不仅要求 $r$ 在 $\mathcal{U}$ 内的每一点都相同，还对解耦系数提出了更强的要求：必须存在一个常数 $c0$，使得 $|L_g L_f^{r-1} h(x)| \ge c$ 对所有 $x \in \mathcal{U}$ 成立。这个条件保证了[解耦](@entry_id:637294)系数一致地远离零，从而确保了反馈控制律 $u(x)$ 在整个区域 $\mathcal{U}$ 内是良定义的且不会“爆炸”。

#### 多输入多输出（MIMO）系统

[相对阶](@entry_id:171358)的概念可以自然地推广到具有 $m$ 个输入和 $p$ 个输出的多输入多输出（MIMO）系统 [@problem_id:2739611] [@problem_id:2739633]。

$\dot{x} = f(x) + \sum_{j=1}^{m} g_j(x) u_j, \quad y_i = h_i(x), \quad i \in \{1, \dots, p\}$

在这种情况下，我们为每个输出 $y_i$ 定义一个[相对阶](@entry_id:171358) $r_i$。$r_i$ 是使得至少有一个输入 $u_j$ 显式出现在 $y_i$ 的第 $r_i$ 阶时间导数中的最小求导次数。形式上，$r_i$ 是满足以下条件的最小正整数：

1.  $L_{g_j} L_f^k h_i(x) = 0$ 对所有 $j \in \{1, \dots, m\}$ 和所有 $k \in \{0, \dots, r_i-2\}$ 成立。
2.  至少存在一个 $j \in \{1, \dots, m\}$，使得 $L_{g_j} L_f^{r_i-1} h_i(x) \neq 0$。

我们将所有输出的[相对阶](@entry_id:171358)组合成一个**向量[相对阶](@entry_id:171358) (vector relative degree)** $r=(r_1, \dots, r_p)$。
对每个输出 $y_i$ 求导 $r_i$ 次，我们得到如下的向量形式的输入-输出关系：

$\begin{pmatrix} y_1^{(r_1)} \\ \vdots \\ y_p^{(r_p)} \end{pmatrix} = \begin{pmatrix} L_f^{r_1} h_1(x) \\ \vdots \\ L_f^{r_p} h_p(x) \end{pmatrix} + A(x) \begin{pmatrix} u_1 \\ \vdots \\ u_m \end{pmatrix}$

这里的 $p \times m$ 矩阵 $A(x)$ 被称为**解耦矩阵 (decoupling matrix)**，其元素为：

$[A(x)]_{ij} = L_{g_j} L_f^{r_i-1} h_i(x)$

这个矩阵捕捉了所有输入对所有（已求导的）输出的线性化影响。为了实现输入-输出解耦和线性化，即设计控制律 $u$ 使得 $y_i^{(r_i)} = v_i$（其中 $v_i$ 是新的解耦输入），我们需要能够求解 $u$。这要求解耦矩阵 $A(x)$ 具有[右逆](@entry_id:161498)。一个充分必要条件是 $A(x)$ 具有满行秩，即 $\mathrm{rank}(A(x)) = p$。在输入和输出数量相等的方阵情况（$m=p$）下，这等价于要求 $A(x)$ 是非奇异的（可逆的）。这个条件是[MIMO系统](@entry_id:268566)[反馈线性化](@entry_id:163432)的核心。