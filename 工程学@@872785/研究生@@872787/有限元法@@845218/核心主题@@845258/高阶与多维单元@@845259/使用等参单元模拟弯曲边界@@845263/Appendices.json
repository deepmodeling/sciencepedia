{"hands_on_practices": [{"introduction": "第一个练习是一项基本技能的检验。我们将使用一组定义了抛物线边界的特定节点坐标，并引导您完成推导等参映射及其雅可比行列式（Jacobian）的全过程。这项练习将抽象的雅可比行列式概念变得具体化，并引入了检查映射退化（mapping degeneration）的重要思想，这是衡量网格质量的关键因素[@problem_id:2579770]。", "problem": "考虑一个在等参有限元背景下表示的二维边界，其中一条曲边通过从参数化为 $\\xi \\in [-1,1]$ 的参考边到物理平面的二次映射进行建模。该边上的几何映射使用二次拉格朗日插值，节点位于 $\\xi=-1$、$\\xi=0$ 和 $\\xi=1$ 处，相关的物理坐标分别为 $\\xi=-1$ 处的 $\\mathbf{X}_1=(0,0)$、$\\xi=0$ 处的 $\\mathbf{X}_m=(1,1)$ 和 $\\xi=1$ 处的 $\\mathbf{X}_2=(2,0)$。等参原理要求用于插值的形函数同样被用来定义曲边的几何形状。\n\n仅根据参考区间上二次拉格朗日插值的定义属性，以及边映射雅可比作为度量因子 $J_e(\\xi)=\\left\\|\\frac{\\partial \\mathbf{x}}{\\partial \\xi}\\right\\|$ 的定义，推导 $J_e(\\xi)$ 作为 $\\xi$ 函数的显式表达式。然后，基于此表达式，确定在 $\\xi \\in [-1,1]$ 区间内，度量在 $J_e(\\xi)=0$ 意义下发生退化的值（如果存在）。\n\n请以 $J_e(\\xi)$ 的精确解析表达式作为最终答案。无需四舍五入。", "solution": "该问题要求推导二次曲边的等参映射的雅可比，并分析其潜在的退化。我们首先遵循有限元法中等参单元的基本原理。\n\n物理域中曲边的几何形状（由向量 $\\mathbf{x} = (x, y)$ 表示）是使用与插值场变量相同的形函数从节点坐标插值得到的。这是等参概念的精髓。对于在参考区间 $\\xi \\in [-1, 1]$ 上具有三个节点的二次拉格朗日单元，其映射由下式给出：\n$$ \\mathbf{x}(\\xi) = \\sum_{i=1,m,2} N_i(\\xi) \\mathbf{X}_i $$\n其中 $\\mathbf{X}_i$ 是节点的物理坐标，而 $N_i(\\xi)$ 是二次拉格朗日形函数。节点位于 $\\xi = -1$、$\\xi = 0$ 和 $\\xi = 1$。\n\n形函数必须满足属性 $N_i(\\xi_j) = \\delta_{ij}$，其中 $\\delta_{ij}$ 是克罗内克δ。对应于节点 $1$（在 $\\xi=-1$ 处）、$m$（在 $\\xi=0$ 处）和 $2$（在 $\\xi=1$ 处）的三个二次形函数唯一确定为：\n$$ N_1(\\xi) = \\frac{(\\xi-0)(\\xi-1)}{(-1-0)(-1-1)} = \\frac{1}{2}\\xi(\\xi-1) $$\n$$ N_m(\\xi) = \\frac{(\\xi-(-1))(\\xi-1)}{(0-(-1))(0-1)} = \\frac{(\\xi+1)(\\xi-1)}{-1} = 1-\\xi^2 $$\n$$ N_2(\\xi) = \\frac{(\\xi-(-1))(\\xi-0)}{(1-(-1))(1-0)} = \\frac{1}{2}\\xi(\\xi+1) $$\n\n问题给出了这些节点的物理坐标：$\\mathbf{X}_1 = (0,0)$、$\\mathbf{X}_m = (1,1)$ 和 $\\mathbf{X}_2 = (2,0)$。我们将这些坐标和推导出的形函数代入映射方程：\n$$ \\mathbf{x}(\\xi) = N_1(\\xi)\\mathbf{X}_1 + N_m(\\xi)\\mathbf{X}_m + N_2(\\xi)\\mathbf{X}_2 $$\n$$ \\mathbf{x}(\\xi) = \\left(\\frac{1}{2}\\xi(\\xi-1)\\right) \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} + (1-\\xi^2) \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} + \\left(\\frac{1}{2}\\xi(\\xi+1)\\right) \\begin{pmatrix} 2 \\\\ 0 \\end{pmatrix} $$\n\n我们可以用笛卡尔分量 $x(\\xi)$ 和 $y(\\xi)$ 来表示该映射：\n$$ x(\\xi) = 0 \\cdot N_1(\\xi) + 1 \\cdot N_m(\\xi) + 2 \\cdot N_2(\\xi) = (1-\\xi^2) + 2\\left(\\frac{1}{2}\\xi(\\xi+1)\\right) = 1-\\xi^2 + \\xi^2 + \\xi = \\xi+1 $$\n$$ y(\\xi) = 0 \\cdot N_1(\\xi) + 1 \\cdot N_m(\\xi) + 0 \\cdot N_2(\\xi) = 1-\\xi^2 $$\n所以，曲边的参数表示为 $\\mathbf{x}(\\xi) = (\\xi+1, 1-\\xi^2)$。\n\n边映射的雅可比 $J_e(\\xi)$ 定义为切向量 $\\frac{\\partial \\mathbf{x}}{\\partial \\xi}$ 的模（欧几里得范数）。首先，我们通过对 $\\mathbf{x}(\\xi)$ 的分量关于 $\\xi$ 求导来计算切向量：\n$$ \\frac{\\partial \\mathbf{x}}{\\partial \\xi} = \\left( \\frac{dx}{d\\xi}, \\frac{dy}{d\\xi} \\right) $$\n$$ \\frac{dx}{d\\xi} = \\frac{d}{d\\xi}(\\xi+1) = 1 $$\n$$ \\frac{dy}{d\\xi} = \\frac{d}{d\\xi}(1-\\xi^2) = -2\\xi $$\n因此，切向量为 $\\frac{\\partial \\mathbf{x}}{\\partial \\xi} = (1, -2\\xi)$。\n\n现在，我们计算其范数以求得雅可比 $J_e(\\xi)$：\n$$ J_e(\\xi) = \\left\\| \\frac{\\partial \\mathbf{x}}{\\partial \\xi} \\right\\| = \\sqrt{\\left(\\frac{dx}{d\\xi}\\right)^2 + \\left(\\frac{dy}{d\\xi}\\right)^2} $$\n$$ J_e(\\xi) = \\sqrt{(1)^2 + (-2\\xi)^2} = \\sqrt{1+4\\xi^2} $$\n这是映射雅可比关于参考坐标 $\\xi$ 的显式表达式。\n\n任务的第二部分是找出在 $\\xi \\in [-1,1]$ 区间内度量退化的值，即 $J_e(\\xi) = 0$。我们建立方程：\n$$ \\sqrt{1+4\\xi^2} = 0 $$\n两边平方得：\n$$ 1+4\\xi^2 = 0 $$\n$$ 4\\xi^2 = -\\frac{1}{4} $$\n该方程没有实数解 $\\xi$，因为任何实数的平方都必须是非负的。因此，不存在实数值的 $\\xi$，从而在区间 $[-1,1]$ 内也没有值，使得雅可比为零。对于所有 $\\xi \\in \\mathbb{R}$，该映射都是非退化的。度量因子 $J_e(\\xi)$ 严格为正，其最小值 $J_e(0) = \\sqrt{1}=1$ 出现在参考边的中点处。", "answer": "$$\\boxed{\\sqrt{1+4\\xi^2}}$$", "id": "2579770"}, {"introduction": "既然我们已经能够计算弯曲单元的真实雅可比行列式，我们就可以探究它为何如此关键。本练习[@problem_id:2579730]提出了一个假设场景：一位工程师对弯曲边界使用了一个简化的、恒定的雅可比行列式（这对于弯曲边界是不正确的），并要求您推导出与正确方法相比所产生的精确解析误差。这将使您从定量角度理解曲率如何影响积分，以及使用正确等参列式的重要性。", "problem": "考虑有限元法（FEM）中一个二维等参有限元的平面边界。该边界由参考坐标 $ \\xi \\in [-1,1] $ 通过一个二次等参映射表示，使用了标准的二次拉格朗日形函数 $ L_1(\\xi) = \\frac{\\xi(\\xi-1)}{2} $，$ L_2(\\xi) = 1 - \\xi^2 $ 和 $ L_3(\\xi) = \\frac{\\xi(\\xi+1)}{2} $。物理节点坐标为 $ \\mathbf{x}_1 = (0,0) $，$ \\mathbf{x}_2 = \\left(\\frac{1}{2}, a\\right) $ 和 $ \\mathbf{x}_3 = (1,0) $，其中 $ a \\in \\mathbb{R} $ 是一个控制边界曲率的标量形状参数。一个大小为 $ q $（单位平面外厚度）的恒定线荷载作用在此边界上；该边界传递的总标量荷载是线积分 $ \\int_{\\Gamma} q \\,\\mathrm{d}s $。从等参映射和线积分的定义出发，精确的总荷载等于 $ Q_{\\mathrm{exact}}(a) = \\int_{-1}^{1} q \\, J(\\xi)\\,\\mathrm{d}\\xi $，其中 $ J(\\xi) = \\left\\| \\frac{\\mathrm{d}\\mathbf{r}}{\\mathrm{d}\\xi} \\right\\| $ 是由映射 $ \\mathbf{r}(\\xi) = \\sum_{i=1}^{3} L_i(\\xi)\\,\\mathbf{x}_i $ 引起的线雅可比。\n\n然而，一位工程师应用了一种用于直边界的“朴素”求积法：他在 $ [-1,1] $ 上使用权重为 $ w_1 = w_2 = 1 $、节点为 $ \\xi_{1,2} = \\pm 1/\\sqrt{3} $ 的两点高斯-勒让德求积法（GLQ），但他用常数直边雅可比 $ J_0 = \\frac{\\ell_0}{2} $ 替换了真实的雅可比 $ J(\\xi) $，其中弦长为 $ \\ell_0 = 1 $。这得出了朴素估计值 $ Q_{\\mathrm{naive}} = q \\sum_{i=1}^{2} w_i J_0 $。对于 $ a \\neq 0 $，这个朴素法则忽略了曲率，因此低估了总荷载。\n\n从第一性原理出发，推导朴素法则相对于精确曲边积分的相对低估误差的精确表达式，其定义为\n$$\n\\varepsilon(a) \\equiv \\frac{Q_{\\mathrm{exact}}(a) - Q_{\\mathrm{naive}}}{Q_{\\mathrm{exact}}(a)}。\n$$\n您的推导必须从等参映射、线雅可比和高斯-勒让德求积法则的定义开始。将最终答案以仅含 $ a $ 的单个封闭形式解析表达式报告。无需进行数值计算，最终表达式中不应包含任何单位。", "solution": "该问题已经过验证，被认为是有效的。它科学地基于有限元法的原理，问题设定良好，提供了所有必要信息，并以客观、精确的语言表述。不存在矛盾、歧义或事实错误。因此，我们可以进行推导。\n\n我们的目标是求出相对低估误差，其定义为 $\\varepsilon(a) = \\frac{Q_{\\mathrm{exact}}(a) - Q_{\\mathrm{naive}}}{Q_{\\mathrm{exact}}(a)}$，可以表示为 $\\varepsilon(a) = 1 - \\frac{Q_{\\mathrm{naive}}}{Q_{\\mathrm{exact}}(a)}$。我们将从第一性原理出发，推导 $Q_{\\mathrm{naive}}$ 和 $Q_{\\mathrm{exact}}(a)$ 的表达式。\n\n首先，我们计算朴素荷载估计值 $Q_{\\mathrm{naive}}$。该估计基于直边界的假设，意味着雅可比 $J(\\xi)$ 被一个常数值 $J_0$ 所取代。这个常数雅可比定义为 $J_0 = \\frac{\\ell_0}{2}$，其中 $\\ell_0$ 是边界的弦长。弦长是起始节点 $\\mathbf{x}_1 = (0,0)$ 和终止节点 $\\mathbf{x}_3 = (1,0)$ 之间的直线距离。\n$$\n\\ell_0 = \\|\\mathbf{x}_3 - \\mathbf{x}_1\\| = \\|(1,0) - (0,0)\\| = \\sqrt{(1-0)^{2} + (0-0)^{2}} = 1\n$$\n因此，常数雅可比为 $J_0 = \\frac{1}{2}$。朴素荷载使用权重为 $w_1 = w_2 = 1$ 的两点高斯-勒让德求积法则计算。\n$$\nQ_{\\mathrm{naive}} = q \\sum_{i=1}^{2} w_i J_0 = q(w_1 J_0 + w_2 J_0) = q\\left(1 \\cdot \\frac{1}{2} + 1 \\cdot \\frac{1}{2}\\right) = q(1) = q\n$$\n\n接下来，我们计算精确荷载 $Q_{\\mathrm{exact}}(a) = \\int_{-1}^{1} q \\, J(\\xi)\\,\\mathrm{d}\\xi$。这需要确定真实的、与位置相关的雅可比 $J(\\xi)$。\n边界的等参映射由 $\\mathbf{r}(\\xi) = \\sum_{i=1}^{3} L_i(\\xi)\\mathbf{x}_i$ 给出。代入给定的拉格朗日形函数 $L_1(\\xi) = \\frac{\\xi(\\xi-1)}{2}$，$L_2(\\xi) = 1 - \\xi^2$，$L_3(\\xi) = \\frac{\\xi(\\xi+1)}{2}$ 和节点坐标 $\\mathbf{x}_1 = (0,0)$，$\\mathbf{x}_2 = \\left(\\frac{1}{2}, a\\right)$，$\\mathbf{x}_3 = (1,0)$：\n$$\n\\mathbf{r}(\\xi) = \\frac{\\xi(\\xi-1)}{2}(0,0) + (1-\\xi^2)\\left(\\frac{1}{2}, a\\right) + \\frac{\\xi(\\xi+1)}{2}(1,0)\n$$\n设 $\\mathbf{r}(\\xi) = (x(\\xi), y(\\xi))$。我们求其分量函数：\n$$\nx(\\xi) = \\left(1-\\xi^2\\right)\\frac{1}{2} + \\frac{\\xi(\\xi+1)}{2} = \\frac{1 - \\xi^2 + \\xi^2 + \\xi}{2} = \\frac{1+\\xi}{2}\n$$\n$$\ny(\\xi) = a(1-\\xi^2)\n$$\n沿映射边界的切向向量为 $\\frac{\\mathrm{d}\\mathbf{r}}{\\mathrm{d}\\xi} = \\left(\\frac{\\mathrm{d}x}{\\mathrm{d}\\xi}, \\frac{\\mathrm{d}y}{\\mathrm{d}\\xi}\\right)$。\n$$\n\\frac{\\mathrm{d}x}{\\mathrm{d}\\xi} = \\frac{1}{2}\n$$\n$$\n\\frac{\\mathrm{d}y}{\\mathrm{d}\\xi} = -2a\\xi\n$$\n线雅可比 $J(\\xi)$ 是该切向向量的模：\n$$\nJ(\\xi) = \\left\\| \\frac{\\mathrm{d}\\mathbf{r}}{\\mathrm{d}\\xi} \\right\\| = \\sqrt{\\left(\\frac{\\mathrm{d}x}{\\mathrm{d}\\xi}\\right)^2 + \\left(\\frac{\\mathrm{d}y}{\\mathrm{d}\\xi}\\right)^2} = \\sqrt{\\left(\\frac{1}{2}\\right)^2 + (-2a\\xi)^2} = \\sqrt{\\frac{1}{4} + 4a^2\\xi^2} = \\frac{1}{2}\\sqrt{1+16a^2\\xi^2}\n$$\n现在我们可以通过对弧长元 $q \\, J(\\xi)\\,\\mathrm{d}\\xi$ 进行积分来计算精确荷载 $Q_{\\mathrm{exact}}(a)$：\n$$\nQ_{\\mathrm{exact}}(a) = \\int_{-1}^{1} q J(\\xi)\\,\\mathrm{d}\\xi = q \\int_{-1}^{1} \\frac{1}{2}\\sqrt{1+16a^2\\xi^2}\\,\\mathrm{d}\\xi\n$$\n被积函数是 $\\xi$ 的偶函数，因此我们可以简化在对称区间 $[-1,1]$ 上的积分：\n$$\nQ_{\\mathrm{exact}}(a) = 2 \\cdot q \\int_{0}^{1} \\frac{1}{2}\\sqrt{1+16a^2\\xi^2}\\,\\mathrm{d}\\xi = q \\int_{0}^{1} \\sqrt{1+16a^2\\xi^2}\\,\\mathrm{d}\\xi\n$$\n为计算此积分，我们使用换元法，令 $u = 4a\\xi$，则有 $\\mathrm{d}u = 4a\\,\\mathrm{d}\\xi$。当 $\\xi$ 从 $0$ 到 $1$ 时，$u$ 从 $0$ 到 $4a$。\n$$\nQ_{\\mathrm{exact}}(a) = q \\int_{0}^{4a} \\sqrt{1+u^2} \\frac{\\mathrm{d}u}{4a} = \\frac{q}{4a} \\int_{0}^{4a} \\sqrt{1+u^2}\\,\\mathrm{d}u\n$$\n$\\sqrt{1+u^2}$ 的标准积分为已知：$\\int \\sqrt{1+u^2}\\,\\mathrm{d}u = \\frac{u}{2}\\sqrt{1+u^2} + \\frac{1}{2}\\arcsinh(u) + C$。\n应用从 $0$ 到 $4a$ 的积分限：\n$$\n\\int_{0}^{4a} \\sqrt{1+u^2}\\,\\mathrm{d}u = \\left[\\frac{u}{2}\\sqrt{1+u^2} + \\frac{1}{2}\\arcsinh(u)\\right]_0^{4a} = \\frac{4a}{2}\\sqrt{1+(4a)^2} + \\frac{1}{2}\\arcsinh(4a) - 0 = 2a\\sqrt{1+16a^2} + \\frac{1}{2}\\arcsinh(4a)\n$$\n将此结果代回 $Q_{\\mathrm{exact}}(a)$ 的表达式中：\n$$\nQ_{\\mathrm{exact}}(a) = \\frac{q}{4a} \\left(2a\\sqrt{1+16a^2} + \\frac{1}{2}\\arcsinh(4a)\\right) = q \\left(\\frac{\\sqrt{1+16a^2}}{2} + \\frac{\\arcsinh(4a)}{8a}\\right)\n$$\n此表达式在 $a \\neq 0$ 时有效。对于 $a=0$ 的情况，路径为一条直线，$J(\\xi)=1/2$，所以 $Q_{\\mathrm{exact}}(0) = q \\int_{-1}^1 \\frac{1}{2} d\\xi = q$，这与 $Q_{\\mathrm{naive}}$ 相匹配。我们推导的 $Q_{\\mathrm{exact}}(a)$ 表达式在极限 $a \\to 0$ 时正确地得出了这个结果。\n\n最后，我们组合出相对误差 $\\varepsilon(a)$：\n$$\n\\varepsilon(a) = 1 - \\frac{Q_{\\mathrm{naive}}}{Q_{\\mathrm{exact}}(a)} = 1 - \\frac{q}{q \\left(\\frac{\\sqrt{1+16a^2}}{2} + \\frac{\\arcsinh(4a)}{8a}\\right)}\n$$\n化简分母：\n$$\n\\frac{\\sqrt{1+16a^2}}{2} + \\frac{\\arcsinh(4a)}{8a} = \\frac{4a\\sqrt{1+16a^2} + \\arcsinh(4a)}{8a}\n$$\n将此代回 $\\varepsilon(a)$ 的表达式中：\n$$\n\\varepsilon(a) = 1 - \\frac{1}{\\frac{4a\\sqrt{1+16a^2} + \\arcsinh(4a)}{8a}} = 1 - \\frac{8a}{4a\\sqrt{1+16a^2} + \\arcsinh(4a)}\n$$\n该表达式表示了作为形状参数 $a$ 的函数的相对低估误差。", "answer": "$$\n\\boxed{1 - \\frac{8a}{4a\\sqrt{1+16a^2} + \\arcsinh(4a)}}\n$$", "id": "2579730"}, {"introduction": "最后的练习旨在连接理论与应用。您将实现一个算法，用于组装二次弯曲边界上的边界牵引力向量，这是结构或热分析中的常见任务。这项练习[@problem_id:2579789]将所有先前的概念——形函数、雅可比行列式、法向量和数值积分——融合成一段可工作的代码，将数学公式转化为实用的工程工具。", "problem": "设计并实现一个完整的、可运行的程序，通过循环遍历边界边，在位于每条边上的高斯求积点处计算几何形状、法线和形函数，从而为二维等参二次边界边汇编全局边界牵引力向量。目标是从第一性原理出发，编码实现二阶椭圆边值问题弱形式中出现的边界贡献的汇编过程，这在有限元法 (FEM) 中有所涉及。程序必须从弱形式中的边界项开始，并且除了标准的形函数定义和高斯求积法则外，不得假定任何预先推导的有限元表达式。\n\n请基于以下基本事实进行推导和实现：\n\n- 对全局右侧向量的边界牵引力贡献由测试函数与给定牵引力在诺伊曼边界上的积分给出。在伽辽金方法设置中，对于每个边界边，这会产生单元贡献\n$$\n\\mathbf{f}^{e} = \\int_{\\Gamma_e} \\mathbf{N}^\\top \\, \\bar{\\mathbf{t}} \\, \\mathrm{d}\\Gamma,\n$$\n其中 $\\mathbf{N}$ 是形函数向量，$\\bar{\\mathbf{t}}$ 是单位边界长度上给定的牵引力向量。\n- 对于等参映射，一个二次三节点边界边由母坐标 $s \\in [-1,1]$ 参数化，其二次拉格朗日形函数 $N_1(s)$, $N_2(s)$ 和 $N_3(s)$ 分别与 $s=-1$、$s=0$ 和 $s=1$ 处的节点相关联。物理坐标 $(x(s),y(s))$ 满足\n$$\nx(s) = \\sum_{i=1}^3 N_i(s) \\, x_i, \\quad y(s) = \\sum_{i=1}^3 N_i(s) \\, y_i,\n$$\n沿边的切向向量为\n$$\n\\mathbf{t}(s) = \\frac{\\mathrm{d}\\mathbf{x}}{\\mathrm{d}s} = \\left[\\frac{\\mathrm{d}x}{\\mathrm{d}s}, \\frac{\\mathrm{d}y}{\\mathrm{d}s}\\right]^\\top = \\sum_{i=1}^3 \\frac{\\mathrm{d}N_i}{\\mathrm{d}s}(s)\\, \\mathbf{x}_i.\n$$\n线映射的几何雅可比是范数 $J_{\\Gamma}(s) = \\lVert \\mathbf{t}(s) \\rVert_2$，由切线顺时针旋转定义的单位法线是\n$$\n\\hat{\\mathbf{n}}(s) = \\frac{1}{\\lVert \\mathbf{t}(s) \\rVert_2}\\begin{bmatrix} t_y(s) \\\\ -t_x(s)\\end{bmatrix}.\n$$\n- 在 $[-1,1]$ 上使用3点高斯-勒让德节点和权重的高斯求积法，可以精确积分最高5次的多项式。使用3点高斯-勒让德法则，节点为 $s_1=-\\sqrt{3/5}$、$s_2=0$、$s_3=+\\sqrt{3/5}$，权重为 $w_1=5/9$、$w_2=8/9$、$w_3=5/9$。\n\n您的实现必须对每个边界边遵循以下步骤，然后汇编成一个全局向量：\n\n1. 对于每个具有节点坐标 $(x_i,y_i)$ ($i=1,2,3$) 的边，计算二次线形函数\n$$\nN_1(s) = \\tfrac{1}{2}s(s-1), \\quad N_2(s) = 1 - s^2, \\quad N_3(s) = \\tfrac{1}{2}s(s+1),\n$$\n及其导数\n$$\n\\frac{\\mathrm{d}N_1}{\\mathrm{d}s}(s) = s - \\tfrac{1}{2}, \\quad \\frac{\\mathrm{d}N_2}{\\mathrm{d}s}(s) = -2s, \\quad \\frac{\\mathrm{d}N_3}{\\mathrm{d}s}(s) = s + \\tfrac{1}{2}.\n$$\n2. 在每个权重为 $w_g$ 的高斯点 $s_g$ 处，计算物理点 $(x(s_g),y(s_g))$、切向向量 $\\mathbf{t}(s_g)$、雅可比 $J_{\\Gamma}(s_g)=\\lVert \\mathbf{t}(s_g)\\rVert_2$ 和单位法线 $\\hat{\\mathbf{n}}(s_g) = [t_y,-t_x]^\\top/\\lVert \\mathbf{t}\\rVert_2$。\n3. 在高斯点处评估给定的边界载荷。考虑两种类型的载荷：\n   - 压力载荷：一个标量压力场 $p(x,y)$，其牵引力为 $\\bar{\\mathbf{t}}(x,y) = p(x,y)\\, \\hat{\\mathbf{n}}(s)$。\n   - 直接牵引力：一个明确给定的向量场 $\\bar{\\mathbf{t}}(x,y)$。\n4. 通过数值积分累加单元载荷，\n$$\n\\mathbf{f}^{e} \\approx \\sum_{g=1}^3 \\left( \\mathbf{N}(s_g)^\\top \\otimes \\mathbf{I}_2 \\right)\\bar{\\mathbf{t}}(x(s_g),y(s_g))\\, J_{\\Gamma}(s_g)\\, w_g,\n$$\n并通过对共享节点的贡献求和，将其汇编到全局向量中。使用自由度排序 $[u_x^{(1)}, u_y^{(1)}, u_x^{(2)}, u_y^{(2)}, \\ldots]$，节点按全局标识符升序排列。\n\n实现该算法，并为以下测试套件计算汇编的全局边界牵引力向量。在每个测试中，边以三个节点标识符的列表形式提供，其排序方式保证了由 $[t_y,-t_x]^\\top/\\lVert \\mathbf{t}\\rVert_2$ 定义的法线被一致使用。程序必须在 $[-1,1]$ 上使用3点高斯-勒让德求积法，并且必须将每个输出分量四舍五入到8位小数。\n\n- 测试1（带压力的曲线加直线边界）：节点为\n  - $1:(x,y)=(1,0)$，\n  - $2:(x,y)=(\\sqrt{2}/2,\\sqrt{2}/2)$，\n  - $3:(x,y)=(0,1)$，\n  - $4:(x,y)=(0,0.5)$，\n  - $5:(x,y)=(0,0)$。\n  边界边为 $[1,2,3]$ 和 $[3,4,5]$。压力场为 $p(x,y)=x+y$。牵引力为 $\\bar{\\mathbf{t}}=p\\,\\hat{\\mathbf{n}}$。\n- 测试2（带恒定牵引力的直线单位段）：节点为\n  - $1:(x,y)=(0,0)$，\n  - $2:(x,y)=(0.5,0)$，\n  - $3:(x,y)=(1,0)$。\n  边界边为 $[1,2,3]$。对于所有 $(x,y)$，牵引力为 $\\bar{\\mathbf{t}}(x,y)=[1,0]^\\top$。\n- 测试3（带恒定压力的二次参数曲线）：节点为\n  - $1:(x,y)=(0,0)$，\n  - $2:(x,y)=(0.5,0.25)$，\n  - $3:(x,y)=(1,1)$。\n  边界边为 $[1,2,3]$。压力为 $p(x,y)=2$。牵引力为 $\\bar{\\mathbf{t}}=p\\,\\hat{\\mathbf{n}}$。\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表。每个测试结果必须是一个包含 $2N$ 个浮点数的列表，其中 $N$ 是该测试中的节点数，按节点标识符升序排列，每个节点的分量为 $[F_{x}^{(1)},F_{y}^{(1)},F_{x}^{(2)},F_{y}^{(2)},\\ldots]$。将所有条目四舍五入到8位小数。因此，最终输出必须是以下形式的单行：\n$$\n\\big[ [\\cdots], [\\cdots], [\\cdots] \\big],\n$$\n不含多余的空格（例如，`[[a,b],[c,d],[e,f]]`）。条目 $a,b,c,d,e,f$ 是浮点数。必须恰好有三个内部列表，每个测试一个，顺序与上面指定的测试1、2和3的顺序一致。", "solution": "该问题要求设计并实现一种算法，用于在二维有限元分析中计算全局边界牵引力向量。具体情况涉及等参二次边界单元。整个过程必须从第一性原理推导。\n\n首先，必须验证问题陈述的有效性。\n按要求逐字提取给定条件。\n- 对全局力向量的单元贡献为 $\\mathbf{f}^{e} = \\int_{\\Gamma_e} \\mathbf{N}^\\top \\, \\bar{\\mathbf{t}} \\, \\mathrm{d}\\Gamma$。\n- 测试函数是形函数 $\\mathbf{N} = [N_1, N_2, N_3]$。\n- 给定牵引力是 $\\bar{\\mathbf{t}}$。$\\Gamma_e$ 是边界边。\n- 坐标的等参映射：$x(s) = \\sum_{i=1}^3 N_i(s) \\, x_i, \\quad y(s) = \\sum_{i=1}^3 N_i(s) \\, y_i$。母坐标是 $s \\in [-1,1]$。\n- 二次拉格朗日形函数：$N_1(s) = \\tfrac{1}{2}s(s-1)$, $N_2(s) = 1 - s^2$, $N_3(s) = \\tfrac{1}{2}s(s+1)$。\n- 形函数导数：$\\frac{\\mathrm{d}N_1}{\\mathrm{d}s}(s) = s - \\tfrac{1}{2}$, $\\frac{\\mathrm{d}N_2}{\\mathrm{d}s}(s) = -2s$, $\\frac{\\mathrm{d}N_3}{\\mathrm{d}s}(s) = s + \\tfrac{1}{2}$。\n- 切向向量：$\\mathbf{t}(s) = \\frac{\\mathrm{d}\\mathbf{x}}{\\mathrm{d}s} = \\sum_{i=1}^3 \\frac{\\mathrm{d}N_i}{\\mathrm{d}s}(s)\\, \\mathbf{x}_i$。\n- 线雅可比：$J_{\\Gamma}(s) = \\lVert \\mathbf{t}(s) \\rVert_2$。\n- 单位法线：$\\hat{\\mathbf{n}}(s) = \\frac{1}{\\lVert \\mathbf{t}(s) \\rVert_2}\\begin{bmatrix} t_y(s) \\\\ -t_x(s)\\end{bmatrix}$。\n- 3点高斯-勒让德求积法则：节点 $s_g \\in \\{-\\sqrt{3/5}, 0, \\sqrt{3/5}\\}$，权重 $w_g \\in \\{5/9, 8/9, 5/9\\}$。\n- 载荷类型：压力 $p(x,y)$，其中 $\\bar{\\mathbf{t}}(x,y) = p(x,y)\\, \\hat{\\mathbf{n}}(s)$，以及直接牵引力 $\\bar{\\mathbf{t}}(x,y)$。\n- 提供了具有特定几何形状和载荷的测试用例。\n\n对问题的有效性进行评估。它具有科学依据，是有限元法的标准应用。问题定义明确，提供了清晰的目标和实现该目标所需的所有信息。语言客观且数学上精确。不存在科学上不健全、不完整或模糊不清等缺陷。因此，该问题被认为是有效的。\n\n求解过程如下。单个边界边 $\\Gamma_e$ 对全局力向量的贡献，表示为外牵引力所做虚功的积分。对于伽辽金公式，虚位移使用与解场相同的形函数进行插值，第 j 个自由度 (DOF) 的力向量贡献是第 j 个形函数与牵引力乘积的积分。\n对于一个二维问题，每个节点 i 有两个自由度，分别与 x 和 y 方向的位移相关联。单元上任意点的位移由节点位移 $\\mathbf{d}_i=[u_x^{(i)}, u_y^{(i)}]^\\top$ 插值得到：$\\mathbf{u}(s) = \\sum_{i=1}^{3} N_i(s) \\mathbf{d}_i$。牵引力 $\\bar{\\mathbf{t}}$ 所做的虚功是 $\\delta W_e = \\int_{\\Gamma_e} \\delta \\mathbf{u}^\\top \\bar{\\mathbf{t}} \\, \\mathrm{d}\\Gamma$。代入 $\\delta \\mathbf{u}$ 的插值公式，可得 $\\delta W_e = \\sum_{i=1}^{3} \\delta \\mathbf{d}_i^\\top \\int_{\\Gamma_e} N_i(s) \\bar{\\mathbf{t}}(s) \\, \\mathrm{d}\\Gamma$。$\\mathbf{f}_i^e = \\int_{\\Gamma_e} N_i(s) \\bar{\\mathbf{t}}(s) \\, \\mathrm{d}\\Gamma$ 这个量是节点 i 的 $2 \\times 1$ 力向量贡献。完整的单元力向量 $\\mathbf{f}^e$ 是一个 $6 \\times 1$ 向量，由节点贡献堆叠而成：$\\mathbf{f}^e = [\\mathbf{f}_1^{e\\top}, \\mathbf{f}_2^{e\\top}, \\mathbf{f}_3^{e\\top}]^\\top$。\n\n该积分定义在物理边界边 $\\Gamma_e$ 上。为了计算它，我们执行变量替换，转换到母坐标 $s \\in [-1,1]$。微分弧长元素变换为 $\\mathrm{d}\\Gamma = J_{\\Gamma}(s) \\mathrm{d}s$，其中 $J_{\\Gamma}(s)$ 是从母单元到物理单元映射的雅可比。局部节点 i 的节点力向量变为：\n$$\n\\mathbf{f}_i^e = \\int_{-1}^{1} N_i(s) \\, \\bar{\\mathbf{t}}(s) \\, J_{\\Gamma}(s) \\, \\mathrm{d}s\n$$\n这个积分通常没有解析解，因此采用数值求积。使用提供的 $M=3$ 点高斯求积法则，其节点为 $s_g$，权重为 $w_g$（$g=1, \\ldots, M$）：\n$$\n\\mathbf{f}_i^e \\approx \\sum_{g=1}^{M} w_g \\, N_i(s_g) \\, \\bar{\\mathbf{t}}(s_g) \\, J_{\\Gamma}(s_g)\n$$\n求和是在高斯点上进行的。对于每个高斯点 $s_g$，必须计算以下量：\n1. 形函数 $N_i(s_g)$ 的值及其相对于母坐标的导数 $\\frac{\\mathrm{d}N_i}{\\mathrm{d}s}(s_g)$。\n2. 边上的物理坐标 $\\mathbf{x}(s_g) = [x(s_g), y(s_g)]^\\top$：\n$$\n\\mathbf{x}(s_g) = \\sum_{i=1}^{3} N_i(s_g) \\mathbf{x}_i\n$$\n其中 $\\mathbf{x}_i$ 是单元节点的坐标。\n3. 高斯点处的切向向量 $\\mathbf{t}(s_g) = [t_x(s_g), t_y(s_g)]^\\top$：\n$$\n\\mathbf{t}(s_g) = \\frac{\\mathrm{d}\\mathbf{x}}{\\mathrm{d}s}\\bigg|_{s=s_g} = \\sum_{i=1}^{3} \\frac{\\mathrm{d}N_i}{\\mathrm{d}s}(s_g) \\mathbf{x}_i\n$$\n4. 映射的雅可比 $J_{\\Gamma}(s_g)$，即切向向量的模：\n$$\nJ_{\\Gamma}(s_g) = \\lVert \\mathbf{t}(s_g) \\rVert_2 = \\sqrt{t_x(s_g)^2 + t_y(s_g)^2}\n$$\n5. 朝外的单位法向量 $\\hat{\\mathbf{n}}(s_g)$。根据规定，这是通过对切向向量进行顺时针旋转得到的：\n$$\n\\hat{\\mathbf{n}}(s_g) = \\frac{1}{J_{\\Gamma}(s_g)} \\begin{bmatrix} t_y(s_g) \\\\ -t_x(s_g) \\end{bmatrix}\n$$\n6. 在物理点 $\\mathbf{x}(s_g)$ 处的给定牵引力向量 $\\bar{\\mathbf{t}}(s_g)$。如果载荷是压力 $p(x,y)$，则牵引力垂直于表面：$\\bar{\\mathbf{t}}(s_g) = p(\\mathbf{x}(s_g)) \\hat{\\mathbf{n}}(s_g)$。\n注意，对于压力载荷，力的计算会简化。$\\bar{\\mathbf{t}}(s_g) J_{\\Gamma}(s_g)$ 项变为 $p(\\mathbf{x}(s_g)) \\hat{\\mathbf{n}}(s_g) J_{\\Gamma}(s_g)$。代入 $\\hat{\\mathbf{n}}(s_g)$ 的表达式，雅可比 $J_{\\Gamma}(s_g)$ 被消掉：\n$$\n\\mathbf{f}_i^e \\approx \\sum_{g=1}^{M} w_g \\, N_i(s_g) \\, p(\\mathbf{x}(s_g)) \\begin{bmatrix} t_y(s_g) \\\\ -t_x(s_g) \\end{bmatrix}\n$$\n这种简化在计算上是有利的。\n\n在为每个边界边计算出单元力向量 $\\mathbf{f}^e$ 后，其分量被汇编到全局力向量 $\\mathbf{F}$ 中。这是一个加法过程，由从单元的局部节点索引到网格的全局节点标识符的映射所控制。如果单元 e 的局部节点 i 对应于全局节点 G，则力向量 $\\mathbf{f}_i^e$ 被加到节点 G 的全局力分量上：$\\mathbf{F}_G \\mathrel{+}= \\mathbf{f}_i^e$。\n\n这个过程定义了一个待实现的完整算法。程序将遍历所提供的测试用例。对于每个用例，它初始化一个零值的全局力向量。然后，它循环遍历每个边界边，使用所述的3点高斯求积法计算相应的单元力向量，并将其汇编到全局向量中。最后，全局向量的分量按照指定要求进行四舍五-入和格式化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes global boundary traction vectors for 2D isoparametric quadratic elements.\n    \"\"\"\n\n    # 3-point Gauss-Legendre quadrature on [-1, 1]\n    gauss_points = [-np.sqrt(3.0/5.0), 0.0, np.sqrt(3.0/5.0)]\n    gauss_weights = [5.0/9.0, 8.0/9.0, 5.0/9.0]\n\n    def N(s):\n        \"\"\"Quadratic Lagrange shape functions.\"\"\"\n        return np.array([\n            0.5 * s * (s - 1.0),\n            1.0 - s**2,\n            0.5 * s * (s + 1.0)\n        ])\n\n    def dN_ds(s):\n        \"\"\"Derivatives of quadratic Lagrange shape functions.\"\"\"\n        return np.array([\n            s - 0.5,\n            -2.0 * s,\n            s + 0.5\n        ])\n\n    # Define test cases\n    test_cases = [\n        {\n            \"nodes\": {\n                1: np.array([1.0, 0.0]),\n                2: np.array([np.sqrt(2.0)/2.0, np.sqrt(2.0)/2.0]),\n                3: np.array([0.0, 1.0]),\n                4: np.array([0.0, 0.5]),\n                5: np.array([0.0, 0.0]),\n            },\n            \"edges\": [[1, 2, 3], [3, 4, 5]],\n            \"traction_func\": lambda x, y, n_hat: (x + y) * n_hat # Pressure p(x,y)=x+y\n        },\n        {\n            \"nodes\": {\n                1: np.array([0.0, 0.0]),\n                2: np.array([0.5, 0.0]),\n                3: np.array([1.0, 0.0]),\n            },\n            \"edges\": [[1, 2, 3]],\n            \"traction_func\": lambda x, y, n_hat: np.array([1.0, 0.0]) # Constant traction\n        },\n        {\n            \"nodes\": {\n                1: np.array([0.0, 0.0]),\n                2: np.array([0.5, 0.25]),\n                3: np.array([1.0, 1.0]),\n            },\n            \"edges\": [[1, 2, 3]],\n            \"traction_func\": lambda x, y, n_hat: 2.0 * n_hat # Constant pressure p=2\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        nodes = case[\"nodes\"]\n        edges = case[\"edges\"]\n        traction_func = case[\"traction_func\"]\n        \n        num_nodes = len(nodes)\n        F_global = np.zeros(num_nodes * 2)\n\n        for edge_nodes_ids in edges:\n            # Get coordinates for the 3 nodes of the current edge\n            coords = np.array([nodes[nid] for nid in edge_nodes_ids])\n            \n            f_elemental = np.zeros(6) # Elemental force vector [fx1, fy1, fx2, fy2, fx3, fy3]\n\n            for s_g, w_g in zip(gauss_points, gauss_weights):\n                # Evaluate shape functions and their derivatives at Gauss point\n                N_g = N(s_g)\n                dN_ds_g = dN_ds(s_g)\n\n                # Compute physical coordinates at Gauss point\n                # xy_g = sum(N_i(sg) * x_i)\n                xy_g = N_g @ coords\n\n                # Compute tangent vector\n                # t_g = sum(dN_i/ds(sg) * x_i)\n                t_g = dN_ds_g @ coords\n                tx, ty = t_g\n\n                # Compute Jacobian\n                J_g = np.linalg.norm(t_g)\n                if J_g == 0:\n                    # Avoid division by zero for degenerate elements, though not expected here\n                    continue\n\n                # Compute unit normal vector\n                n_hat = np.array([ty / J_g, -tx / J_g])\n\n                # Evaluate traction vector at Gauss point\n                t_bar = traction_func(xy_g[0], xy_g[1], n_hat)\n\n                # Accumulate contribution to elemental force vector\n                for i in range(3): # Loop over 3 local nodes\n                    force_contribution = N_g[i] * t_bar * J_g * w_g\n                    f_elemental[2*i] += force_contribution[0]\n                    f_elemental[2*i+1] += force_contribution[1]\n            \n            # Assemble elemental vector into global vector\n            for i in range(3):\n                global_node_id = edge_nodes_ids[i]\n                # Map from global node ID to global vector index (0-based)\n                global_dof_idx = 2 * (global_node_id - 1)\n                F_global[global_dof_idx] += f_elemental[2*i]\n                F_global[global_dof_idx + 1] += f_elemental[2*i + 1]\n\n        # Round results and format\n        result_vector = [round(val, 8) for val in F_global]\n        all_results.append(result_vector)\n\n    # Final print statement in the exact required format\n    # Using str.replace to remove spaces for strict formatting\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "2579789"}]}