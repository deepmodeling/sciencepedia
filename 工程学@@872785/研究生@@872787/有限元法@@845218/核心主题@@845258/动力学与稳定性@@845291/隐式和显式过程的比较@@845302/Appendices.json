{"hands_on_practices": [{"introduction": "本练习旨在深入探讨条件稳定性这一基本概念，它是显式时间积分方案的标志性特征。通过分析经典的抛物线型问题——热扩散方程，您将从第一性原理出发，推导出允许的最大时间步长。这项练习 [@problem_id:2545016] 将揭示稳定时间步长（$\\Delta t$）、材料属性（扩散率 $\\kappa$）和空间离散化（网格尺寸 $h$）之间的关键联系，从而让您对 Courant-Friedrichs-Lewy (CFL) 条件有更具体的理解。", "problem": "考虑在 $d$ 维超立方体 $\\Omega=(0,L)^{d}$ 上的线性扩散方程 $u_{t}=\\kappa\\,\\Delta u$，其具有齐次狄利克雷边界条件和常数扩散系数 $\\kappa>0$。设 $V_{h}\\subset H_{0}^{1}(\\Omega)$ 是在每个坐标方向上网格尺寸为 $h=L/N$ 的均匀笛卡尔剖分上的协调有限元空间，由连续分片双线性/三线性张量积多项式（即 $Q_{1}$ 单元）构成，并设 $\\{\\phi_{i}\\}$ 为其节点基。从标准伽辽金方法得到的半离散线法产生常微分方程组 $M\\,\\dot{\\mathbf{U}}(t)+K\\,\\mathbf{U}(t)=\\mathbf{0}$，其中 $M_{ij}=(\\phi_{i},\\phi_{j})_{L^{2}(\\Omega)}$ 和 $K_{ij}=\\kappa\\,(\\nabla\\phi_{i},\\nabla\\phi_{j})_{L^{2}(\\Omega)}$。假设质量矩阵被其行和集中对角近似 $M_{\\ell}$ 替代，从而显式向前欧拉更新具有形式 $\\mathbf{U}^{n+1}=\\mathbf{U}^{n}-\\Delta t\\,M_{\\ell}^{-1}K\\,\\mathbf{U}^{n}$。从以下原理出发：(i) 对于线性系统 $\\dot{\\mathbf{y}}=-A\\,\\mathbf{y}$，向前欧拉法的放大矩阵是 $I-\\Delta t\\,A$，并且对于实数非负谱，稳定性要求对 $A$ 的所有特征值 $\\lambda$ 都有 $|1-\\Delta t\\,\\lambda|\\leq 1$；(ii) 在具有齐次狄利克雷边界条件的均匀笛卡尔网格上，$M_{\\ell}^{-1}K$ 可通过离散正弦变换对角化，其具有实数非负特征值，这些特征值与同一网格上 $\\kappa$ 乘以标准负离散拉普拉斯算子的特征值相一致。请根据 $h$、$d$ 和 $\\kappa$ 推导确保线性稳定性的最大向前欧拉时间步长 $\\Delta t_{\\max}$。您的推导必须明确说明最大特征值 $\\lambda_{\\max}(M_{\\ell}^{-1}K)$ 对 $h$ 和 $d$ 的依赖关系。作为对隐式和显式过程的基于上下文的比较，请在您的推理中简要说明为什么向后欧拉法对此问题不施加此类步长限制，但不要报告任何单独的数值界限。请用一个关于 $h$、$d$ 和 $\\kappa$ 的单一闭式表达式给出您的最终答案 $\\Delta t_{\\max}$。如果指定物理单位，当 $h$ 的单位是米，$\\kappa$ 的单位是平方米/秒时，时间单位应解释为秒。请勿在最终的方框答案中包含单位。", "solution": "所述问题是有效且适定的。它构成了偏微分方程数值方法稳定性分析中的一个标准练习。我们开始推导。\n\n带有质量集中的半离散有限元格式由常微分方程组 $M_{\\ell}\\,\\dot{\\mathbf{U}}(t)+K\\,\\mathbf{U}(t)=\\mathbf{0}$ 给出。这可以写成线性系统的标准形式：\n$$\n\\dot{\\mathbf{U}}(t) = -M_{\\ell}^{-1}K\\,\\mathbf{U}(t)\n$$\n我们确定系统矩阵为 $A = M_{\\ell}^{-1}K$。向前欧拉法在时间上将此系统离散化为：\n$$\n\\frac{\\mathbf{U}^{n+1} - \\mathbf{U}^{n}}{\\Delta t} = -A\\,\\mathbf{U}^{n}\n$$\n这产生了显式更新规则 $\\mathbf{U}^{n+1} = (I - \\Delta t\\,A)\\,\\mathbf{U}^{n}$，其中 $I$ 是单位矩阵。该格式的放大矩阵为 $G = I - \\Delta t\\,A$。\n\n根据所提供的原理(i)，对于具有实数非负特征值谱 $\\{\\lambda_k\\}$ 的系统，稳定性要求放大矩阵所有特征值的幅值都以 1 为界。$G$ 的特征值为 $g_k = 1 - \\Delta t\\,\\lambda_k$。条件是对所有 $k$ 都有 $|1 - \\Delta t\\,\\lambda_k| \\le 1$。由于 $K$ 是对称半正定的，且 $M_{\\ell}$ 是一个具有正元素（集中质量为正）的对角矩阵，因此 $A = M_{\\ell}^{-1}K$ 的特征值 $\\lambda_k$ 是实数且非负的。因此，稳定性条件简化为：\n$$\n-1 \\le 1 - \\Delta t\\,\\lambda_k \\le 1\n$$\n右边的不等式 $1 - \\Delta t\\,\\lambda_k \\le 1$ 意味着 $-\\Delta t\\,\\lambda_k \\le 0$，由于 $\\Delta t > 0$ 和 $\\lambda_k \\ge 0$，该不等式恒成立。左边的不等式 $-1 \\le 1 - \\Delta t\\,\\lambda_k$ 施加了实际的约束：\n$$\n\\Delta t\\,\\lambda_k \\le 2 \\implies \\Delta t \\le \\frac{2}{\\lambda_k}\n$$\n这必须对所有特征值成立。最严格的条件由最大特征值 $\\lambda_{\\max}$ 施加。因此，数值稳定性的条件是：\n$$\n\\Delta t \\le \\frac{2}{\\lambda_{\\max}(A)} \\implies \\Delta t_{\\max} = \\frac{2}{\\lambda_{\\max}(M_{\\ell}^{-1}K)}\n$$\n核心任务是确定 $\\lambda_{\\max}(M_{\\ell}^{-1}K)$。我们使用所提供的原理(ii)，该原理指出，在均匀网格上，对于集中质量的 $Q_1$ 单元，$M_{\\ell}^{-1}K$ 的特征值与在具有齐次狄利克雷边界条件的相同网格上的标准负离散拉普拉斯算子（记为 $-\\Delta_h$）乘以 $\\kappa$ 后的特征值相同。因此，$A$ 的特征值为 $\\lambda(A) = \\kappa\\,\\lambda(-\\Delta_h)$。\n\n我们现在推导在 $d$ 维区域 $\\Omega=(0,L)^{d}$ 上，网格尺寸为 $h=L/N$ 的均匀网格上的算子 $-\\Delta_h$ 的特征值。该算子通过其对网格函数 $v_{j_1, \\dots, j_d}$ 的作用来定义：\n$$\n(-\\Delta_h v)_{\\mathbf{j}} = -\\frac{1}{h^2} \\sum_{k=1}^d (v_{\\mathbf{j}+\\mathbf{e}_k} - 2v_{\\mathbf{j}} + v_{\\mathbf{j}-\\mathbf{e}_k})\n$$\n其中 $\\mathbf{j}=(j_1, \\dots, j_d)$ 是内部网格点的多重指标，$1 \\le j_k \\le N-1$。特征函数是正弦函数的乘积：\n$$\n\\psi_{\\mathbf{m}}(\\mathbf{j}) = \\prod_{k=1}^d \\sin\\left(\\frac{m_k \\pi j_k h}{L}\\right) = \\prod_{k=1}^d \\sin\\left(\\frac{m_k \\pi j_k}{N}\\right)\n$$\n对于模态多重指标 $\\mathbf{m}=(m_1, \\dots, m_d)$ 且 $1 \\le m_k \\le N-1$。由于拉普拉斯算子的可分离性，$d$ 维中的特征值是每个维度特征值的和。对于单个维度，与特征函数 $\\sin(m \\pi j/N)$ 对应的特征值 $\\lambda_m^{(1D)}$ 是：\n$$\n\\lambda_m^{(1D)} = \\frac{2}{h^2} \\left(1 - \\cos\\left(\\frac{m \\pi}{N}\\right)\\right) = \\frac{4}{h^2} \\sin^2\\left(\\frac{m \\pi}{2N}\\right)\n$$\n对 $d$ 个维度求和，模态 $\\mathbf{m}$ 的特征值是：\n$$\n\\lambda_{\\mathbf{m}}^{(dD)} = \\sum_{k=1}^d \\lambda_{m_k}^{(1D)} = \\frac{4}{h^2} \\sum_{k=1}^d \\sin^2\\left(\\frac{m_k \\pi}{2N}\\right)\n$$\n最大特征值 $\\lambda_{\\max}(-\\Delta_h)$ 对应于最高频率模态，其中每个 $m_k$ 取其最大值 $m_k = N-1$。\n$$\n\\lambda_{\\max}(-\\Delta_h) = \\frac{4}{h^2} \\sum_{k=1}^d \\sin^2\\left(\\frac{(N-1)\\pi}{2N}\\right) = \\frac{4d}{h^2} \\sin^2\\left(\\frac{\\pi}{2} - \\frac{\\pi}{2N}\\right) = \\frac{4d}{h^2} \\cos^2\\left(\\frac{\\pi}{2N}\\right)\n$$\n代入 $N=L/h$，我们得到 $\\lambda_{\\max}(-\\Delta_h) = \\frac{4d}{h^2} \\cos^2\\left(\\frac{\\pi h}{2L}\\right)$。问题要求最终答案只用 $h$、$d$ 和 $\\kappa$ 表示。这意味着稳定性界限必须与区域大小 $L$ 无关。一个普遍有效的稳定性界限必须对任何区域大小 $L$ 都成立。因此，我们必须考虑最坏情况，这对应于 $\\lambda_{\\max}$ 的最大可能值。$\\lambda_{\\max}$ 在所有可能的 $L$ 值上的上确界在 $h/L \\to 0$ 时达到：\n$$\n\\sup_{L>0} \\lambda_{\\max}(-\\Delta_h) = \\sup_{L>0} \\frac{4d}{h^2} \\cos^2\\left(\\frac{\\pi h}{2L}\\right) = \\frac{4d}{h^2}\n$$\n因此，系统矩阵 $A=M_{\\ell}^{-1}K$ 的相关最大特征值是：\n$$\n\\lambda_{\\max}(M_{\\ell}^{-1}K) = \\kappa \\cdot \\left(\\frac{4d}{h^2}\\right) = \\frac{4d\\kappa}{h^2}\n$$\n将此代入 $\\Delta t$ 的稳定性条件，得到最大时间步长：\n$$\n\\Delta t_{\\max} = \\frac{2}{\\lambda_{\\max}(M_{\\ell}^{-1}K)} = \\frac{2}{4d\\kappa/h^2} = \\frac{2h^2}{4d\\kappa} = \\frac{h^2}{2d\\kappa}\n$$\n这是扩散方程显式欧拉离散化的众所周知的CFL型条件。\n\n为了比较，考虑隐式向后欧拉法：$\\mathbf{U}^{n+1} = \\mathbf{U}^{n} - \\Delta t\\,A\\,\\mathbf{U}^{n+1}$。更新由 $(I + \\Delta t\\,A)\\,\\mathbf{U}^{n+1} = \\mathbf{U}^{n}$ 给出。放大矩阵是 $G_{BE} = (I + \\Delta t\\,A)^{-1}$。其特征值为 $g_k = (1 + \\Delta t\\,\\lambda_k)^{-1}$。稳定性条件 $|g_k| \\le 1$ 转化为：\n$$\n\\left| \\frac{1}{1 + \\Delta t\\,\\lambda_k} \\right| \\le 1\n$$\n由于 $\\Delta t > 0$ 且 $A$ 的所有特征值 $\\lambda_k$ 都是非负的，分母 $1 + \\Delta t\\,\\lambda_k$ 总是大于或等于 $1$。因此，对于任何 $\\Delta t > 0$ 的选择，不等式 $|g_k| \\le 1$ 都成立。因此，向后欧拉法对于此问题是无条件稳定的，并且不施加基于稳定性的时间步长限制。", "answer": "$$\n\\boxed{\\frac{h^2}{2d\\kappa}}\n$$", "id": "2545016"}, {"introduction": "从扩散问题转向结构动力学，本练习将探讨显式和隐式方法之间一个关键的实践权衡：质量矩阵的构造。显式方法为了计算效率，通常采用对角化的“集中”质量矩阵，而隐式方法则倾向于使用更精确的“一致”质量矩阵。这项练习 [@problem_id:2545080] 要求您通过计算一个振动杆的固有频率误差，来量化这种选择对系统动力学特性的影响，从而揭示计算成本与物理保真度之间的折衷。", "problem": "一根长度为 $L$、横截面积为 $A$、杨氏模量为 $E$、质量密度为 $\\rho$ 的均匀等截面线弹性杆，在两端固定的情况下发生微小纵向振动。其控制方程的强形式为轴向波动方程 $ \\rho A \\,\\ddot{u}(x,t) - \\frac{\\partial}{\\partial x}\\big(EA\\, \\frac{\\partial u}{\\partial x}(x,t)\\big) = 0 $ (对于 $x \\in (0,L)$)，并带有本质边界条件 $u(0,t)=0$ 和 $u(L,t)=0$。考虑使用标准的伽辽金有限元法（FEM）进行空间半离散化，将杆均匀划分为 $N=3$ 个等长单元，并在其上使用连续的分段线性形函数。精确施加本质边界条件，使得唯一的全局未知量是内部节点的位移。\n\n作为背景，许多隐式时间积分方法（例如 Newmark 族方法）使用一致质量矩阵，而许多显式方法（例如中心差分格式）则使用对角集总质量矩阵以避免求解线性系统。质量矩阵的选择会改变离散模态特性。\n\n从强形式乘以一个试函数并在 $(0,L)$ 上积分，同时对刚度项进行分部积分得到的弱形式出发，并在每个单元上使用标准的双节点线性形函数，执行以下步骤，除了由均匀网格和施加的边界条件所产生的特性外，不作任何特殊的正交性假设：\n- 对于一致质量矩阵 $M^{(C)}$ 和通过在单元层面对一致质量进行精确行和集总得到的全对角集总质量矩阵 $M^{(L)}$，推导单元刚度矩阵和质量矩阵，并在施加边界条件后，为 $N=3$ 单元网格组装形式为 $K\\,\\mathbf{u}(t) + M\\,\\ddot{\\mathbf{u}}(t) = \\mathbf{0}$ 的全局半离散系统。\n- 建立相应的广义特征值问题 $K\\,\\boldsymbol{\\phi}^{(C)}=\\omega^{2}\\,M^{(C)}\\,\\boldsymbol{\\phi}^{(C)}$ 和 $K\\,\\boldsymbol{\\phi}^{(L)}=\\omega^{2}\\,M^{(L)}\\,\\boldsymbol{\\phi}^{(L)}$。\n- 以闭合形式计算前 2 个离散角频率 $\\omega_{1}^{(C)}$、$\\omega_{2}^{(C)}$（一致质量）和 $\\omega_{1}^{(L)}$、$\\omega_{2}^{(L)}$（集总质量）。\n\n将模态 $p \\in \\{1,2\\}$ 的相对频率误差定义为\n$$\n\\varepsilon_{p} \\equiv \\frac{\\omega_{p}^{(L)} - \\omega_{p}^{(C)}}{\\omega_{p}^{(C)}},\n$$\n并将前两个离散模态的相对频率误差的最大绝对值定义为\n$$\n\\mathcal{E}_{\\max} \\equiv \\max\\{|\\varepsilon_{1}|,\\,|\\varepsilon_{2}|\\}.\n$$\n\n计算 $\\mathcal{E}_{\\max}$，将其表示为仅包含根式和整数的单一闭合形式解析表达式。不要代入 $E$、$\\rho$、$A$ 或 $L$ 的任何数值；您的最终表达式必须与材料和几何参数无关。将答案表示为无单位的纯数。无需四舍五入。", "solution": "对问题陈述进行了严格审查，认定其有效。该问题具有科学依据、是适定的、客观的，并包含得出唯一解所需的所有信息。此问题是结构动力学有限元分析中的一个标准练习。\n\n均匀杆纵向振动的控制方程的强形式为\n$$ \\rho A \\frac{\\partial^2 u}{\\partial t^2}(x,t) - \\frac{\\partial}{\\partial x}\\left(EA \\frac{\\partial u}{\\partial x}(x,t)\\right) = 0, \\quad x \\in (0,L) $$\n边界条件为 $u(0,t)=0$ 和 $u(L,t)=0$。相应的弱形式是通过乘以一个试函数 $v(x)$ 并进行分部积分得到的：\n$$ \\int_0^L \\rho A v \\ddot{u} \\,dx + \\int_0^L EA \\frac{\\partial v}{\\partial x} \\frac{\\partial u}{\\partial x} \\,dx = 0 $$\n解 $u(x,t)$ 被近似为 $u(x,t) \\approx \\sum_{i} N_i(x) u_i(t)$，其中 $N_i(x)$ 是形函数。这种半离散化导出了矩阵系统 $M \\ddot{\\mathbf{u}} + K \\mathbf{u} = \\mathbf{0}$。\n\n我们首先推导一个长度为 $h$ 的标准 2 节点线性杆单元的单元刚度矩阵和质量矩阵。在局部坐标 $\\xi \\in [0,h]$ 中，形函数为 $N_1(\\xi) = 1 - \\frac{\\xi}{h}$ 和 $N_2(\\xi) = \\frac{\\xi}{h}$。它们的导数为 $N_1'(\\xi) = -\\frac{1}{h}$ 和 $N_2'(\\xi) = \\frac{1}{h}$。\n\n单元刚度矩阵 $k_e$ 的项为 $k_{ij} = \\int_0^h EA N_i' N_j' d\\xi$。\n$$ k_e = \\int_0^h EA \\begin{pmatrix} (-1/h)^2  & (-1/h)(1/h) \\\\ (1/h)(-1/h)  & (1/h)^2 \\end{pmatrix} d\\xi = \\frac{EA}{h} \\begin{pmatrix} 1  & -1 \\\\ -1  & 1 \\end{pmatrix} $$\n\n单元一致质量矩阵 $m_e^{(C)}$ 的项为 $m_{ij}^{(C)} = \\int_0^h \\rho A N_i N_j d\\xi$。\n$$ m_{11}^{(C)} = \\rho A \\int_0^h (1-\\frac{\\xi}{h})^2 d\\xi = \\frac{\\rho A h}{3} $$\n$$ m_{12}^{(C)} = \\rho A \\int_0^h (1-\\frac{\\xi}{h})(\\frac{\\xi}{h}) d\\xi = \\frac{\\rho A h}{6} $$\n$$ m_e^{(C)} = \\frac{\\rho A h}{6} \\begin{pmatrix} 2  & 1 \\\\ 1  & 2 \\end{pmatrix} $$\n\n单元集总质量矩阵 $m_e^{(L)}$ 是通过对 $m_e^{(C)}$ 的各行求和，并将和放在对角线上得到的。每行的和是 $\\frac{\\rho A h}{6}(2+1) = \\frac{\\rho A h}{2}$。\n$$ m_e^{(L)} = \\frac{\\rho A h}{2} \\begin{pmatrix} 1  & 0 \\\\ 0  & 1 \\end{pmatrix} $$\n\n杆被离散化为 $N=3$ 个等长单元，因此单元长度为 $h=L/3$。共有 4 个节点，索引为 0, 1, 2, 3。边界条件 $u(0,t)=0$ 和 $u(L,t)=0$ 意味着节点 0 和节点 3 的位移 $u_0$ 和 $u_3$ 为零。未知自由度是内部节点 1 和 2 的位移，$\\mathbf{u} = [u_1, u_2]^T$。我们组装全局矩阵，然后提取对应于这些自由节点的 $2 \\times 2$ 子系统。\n\n全局刚度矩阵 $K$ 的组装：\n$$ K = \\frac{EA}{h} \\begin{pmatrix} 1+1  & -1 \\\\ -1  & 1+1 \\end{pmatrix} = \\frac{3EA}{L} \\begin{pmatrix} 2  & -1 \\\\ -1  & 2 \\end{pmatrix} $$\n\n全局一致质量矩阵 $M^{(C)}$ 的组装：\n$$ M^{(C)} = \\frac{\\rho A h}{6} \\begin{pmatrix} 2+2  & 1 \\\\ 1  & 2+2 \\end{pmatrix} = \\frac{\\rho A (L/3)}{6} \\begin{pmatrix} 4  & 1 \\\\ 1  & 4 \\end{pmatrix} = \\frac{\\rho A L}{18} \\begin{pmatrix} 4  & 1 \\\\ 1  & 4 \\end{pmatrix} $$\n\n全局集总质量矩阵 $M^{(L)}$ 的组装：\n$$ M^{(L)} = \\frac{\\rho A h}{2} \\begin{pmatrix} 1+1  & 0 \\\\ 0  & 1+1 \\end{pmatrix} = \\frac{\\rho A (L/3)}{2} \\begin{pmatrix} 2  & 0 \\\\ 0  & 2 \\end{pmatrix} = \\frac{\\rho A L}{3} \\begin{pmatrix} 1  & 0 \\\\ 0  & 1 \\end{pmatrix} $$\n\n我们现在求解广义特征值问题 $K \\boldsymbol{\\phi} = \\omega^2 M \\boldsymbol{\\phi}$，即 $\\det(K - \\omega^2 M) = 0$。\n\n对于一致质量，$M = M^{(C)}$，问题是 $\\det(K - (\\omega^{(C)})^2 M^{(C)}) = 0$。令 $\\lambda_C = (\\omega^{(C)})^2$。\n$$ \\det\\left( \\frac{3EA}{L} \\begin{pmatrix} 2  & -1 \\\\ -1  & 2 \\end{pmatrix} - \\lambda_C \\frac{\\rho A L}{18} \\begin{pmatrix} 4  & 1 \\\\ 1  & 4 \\end{pmatrix} \\right) = 0 $$\n我们定义一个常数 $C_0 = \\frac{54E}{\\rho L^2}$。行列式变为：\n$$ \\det\\left( \\frac{C_0}{18} \\frac{\\rho A L}{3} \\begin{pmatrix} 2  & -1 \\\\ -1  & 2 \\end{pmatrix} - \\lambda_C \\frac{\\rho A L}{18} \\begin{pmatrix} 4  & 1 \\\\ 1  & 4 \\end{pmatrix} \\right) = 0 $$\n$$ \\det\\left( C_0 \\begin{pmatrix} 2  & -1 \\\\ -1  & 2 \\end{pmatrix} - \\lambda_C \\begin{pmatrix} 4  & 1 \\\\ 1  & 4 \\end{pmatrix} \\right) = 0 $$\n$$ \\det \\begin{pmatrix} 2C_0 - 4\\lambda_C  & -C_0 - \\lambda_C \\\\ -C_0 - \\lambda_C  & 2C_0 - 4\\lambda_C \\end{pmatrix} = 0 $$\n这得到 $(2C_0 - 4\\lambda_C)^2 - (C_0 + \\lambda_C)^2 = 0$，它给出两个解：\n1. $2C_0 - 4\\lambda_C = C_0 + \\lambda_C \\implies C_0 = 5\\lambda_C \\implies \\lambda_C = C_0/5$。\n2. $2C_0 - 4\\lambda_C = -(C_0 + \\lambda_C) \\implies 3C_0 = 3\\lambda_C \\implies \\lambda_C = C_0$。\n特征值为 $(\\omega_{1}^{(C)})^2 = \\frac{C_0}{5} = \\frac{54}{5} \\frac{E}{\\rho L^2}$ 和 $(\\omega_{2}^{(C)})^2 = C_0 = 54 \\frac{E}{\\rho L^2}$。\n\n对于集总质量，$M = M^{(L)}$，问题是 $\\det(K - (\\omega^{(L)})^2 M^{(L)}) = 0$。令 $\\lambda_L = (\\omega^{(L)})^2$。\n$$ \\det\\left( \\frac{3EA}{L} \\begin{pmatrix} 2  & -1 \\\\ -1  & 2 \\end{pmatrix} - \\lambda_L \\frac{\\rho A L}{3} \\begin{pmatrix} 1  & 0 \\\\ 0  & 1 \\end{pmatrix} \\right) = 0 $$\n这是矩阵 $K$ 的一个标准特征值问题。令 $\\mu$ 为矩阵 $\\begin{pmatrix} 2  & -1 \\\\ -1  & 2 \\end{pmatrix}$ 的特征值。\n$\\det \\begin{pmatrix} 2-\\mu  & -1 \\\\ -1  & 2-\\mu \\end{pmatrix} = (2-\\mu)^2 - 1 = 0 \\implies 2-\\mu = \\pm 1$。\n特征值为 $\\mu_1 = 1$ 和 $\\mu_2 = 3$。\n关系式为 $\\frac{3EA}{L} \\mu = \\lambda_L \\frac{\\rho A L}{3}$，所以 $\\lambda_L = \\mu \\frac{9E}{\\rho L^2}$。\n特征值为 $(\\omega_{1}^{(L)})^2 = 1 \\cdot \\frac{9E}{\\rho L^2} = 9 \\frac{E}{\\rho L^2}$ 和 $(\\omega_{2}^{(L)})^2 = 3 \\cdot \\frac{9E}{\\rho L^2} = 27 \\frac{E}{\\rho L^2}$。\n\n现在我们通过取平方根来计算角频率。所有物理参数均为正。\n$\\omega_{1}^{(C)} = \\sqrt{\\frac{54}{5} \\frac{E}{\\rho L^2}}$，$\\omega_{2}^{(C)} = \\sqrt{54 \\frac{E}{\\rho L^2}}$\n$\\omega_{1}^{(L)} = \\sqrt{9 \\frac{E}{\\rho L^2}} = 3 \\sqrt{\\frac{E}{\\rho L^2}}$，$\\omega_{2}^{(L)} = \\sqrt{27 \\frac{E}{\\rho L^2}}$\n\n模态 $p$ 的相对频率误差为 $\\varepsilon_{p} = \\frac{\\omega_{p}^{(L)} - \\omega_{p}^{(C)}}{\\omega_{p}^{(C)}} = \\frac{\\omega_{p}^{(L)}}{\\omega_{p}^{(C)}} - 1$。\n对于模态 $p=1$：\n$$ \\frac{\\omega_{1}^{(L)}}{\\omega_{1}^{(C)}} = \\frac{\\sqrt{9}}{\\sqrt{54/5}} = \\sqrt{\\frac{9 \\cdot 5}{54}} = \\sqrt{\\frac{45}{54}} = \\sqrt{\\frac{5}{6}} $$\n$$ \\varepsilon_{1} = \\sqrt{\\frac{5}{6}} - 1 $$\n对于模态 $p=2$：\n$$ \\frac{\\omega_{2}^{(L)}}{\\omega_{2}^{(C)}} = \\frac{\\sqrt{27}}{\\sqrt{54}} = \\sqrt{\\frac{27}{54}} = \\sqrt{\\frac{1}{2}} = \\frac{1}{\\sqrt{2}} $$\n$$ \\varepsilon_{2} = \\frac{1}{\\sqrt{2}} - 1 $$\n两个误差都是负的，这符合预期，因为质量集总会降低离散频率。\n\n我们需要计算 $\\mathcal{E}_{\\max} = \\max\\{|\\varepsilon_{1}|,\\,|\\varepsilon_{2}|\\}$。\n$|\\varepsilon_1| = \\left|\\sqrt{\\frac{5}{6}} - 1\\right| = 1 - \\sqrt{\\frac{5}{6}}$。\n$|\\varepsilon_2| = \\left|\\frac{1}{\\sqrt{2}} - 1\\right| = 1 - \\frac{1}{\\sqrt{2}}$。\n为了比较这些值，我们比较 $\\sqrt{5/6}$ 和 $1/\\sqrt{2}$。两边平方得到 $5/6$ 和 $1/2$。\n由于 $\\frac{5}{6} > \\frac{1}{2}$ (因为 $0.833... > 0.5$)，由此可知 $\\sqrt{\\frac{5}{6}} > \\frac{1}{\\sqrt{2}}$。\n这意味着 $1 - \\sqrt{\\frac{5}{6}}  1 - \\frac{1}{\\sqrt{2}}$。\n因此， $|\\varepsilon_1|  |\\varepsilon_2|$，最大误差为 $|\\varepsilon_2|$。\n$$ \\mathcal{E}_{\\max} = |\\varepsilon_2| = 1 - \\frac{1}{\\sqrt{2}} = 1 - \\frac{\\sqrt{2}}{2} = \\frac{2 - \\sqrt{2}}{2} $$\n该表达式是一个纯数，与材料和几何参数无关，符合要求。", "answer": "$$\n\\boxed{\\frac{2 - \\sqrt{2}}{2}}\n$$", "id": "2545080"}, {"introduction": "最后的这项练习将对比提升到了非线性计算力学领域，特别是通过应变软化损伤来模拟材料失效。在这种具有挑战性的场景中，系统刚度可能会发生局部急剧退化，因此数值求解器的鲁棒性至关重要。这个动手编程练习 [@problem_id:2545077] 要求您同时实现一个显式交错格式和一个全隐式格式来模拟损伤演化。通过对比结果，您将亲眼见证显式方法如何导致病态的网格依赖性失稳，而隐式格式则能提供必要的稳定性，以捕捉到具有物理意义的、正则化的响应。", "problem": "考虑一根长度为 $L$、横截面积为 $A$ 的一维杆，在准静态单轴拉伸作用下，采用有限元法（FEM）进行建模。设该杆被划分为 $N$ 个长度为 $h = L/N$ 的等长双节点线性单元，共包含 $N+1$ 个节点。杆的左端（$x=0$）固定（$u(0,t)=0$），右端（$x=L$）施加一个指定的位移 $u(L,t) = \\bar{u}(t)$，该位移在伪时间 $t \\in [0,1]$ 内根据 $\\bar{u}(t) = u_{\\mathrm{final}} \\, t$ 单调增加。在此基准问题中，假设所有物理量均为无量纲单位。\n\n本构行为是带有标量各向同性损伤的线性弹性模型：每个单元内的柯西应力为 $\\sigma = (1-d) \\, E \\, \\varepsilon$，其中 $E$ 是杨氏模量，$\\varepsilon$ 是轴向应变（对于线性形函数，每个单元内为常数），$d \\in [0,1]$ 是内部损伤变量（$d=0$ 表示无损，$d=1$ 表示完全损伤）。损伤演化遵循由弹性应变能释放率驱动的粘性正则化率定则。定义单位体积的弹性应变能释放率为 $Y = \\tfrac{1}{2} E \\, \\varepsilon^2$。对于单元索引 $i \\in \\{0,\\dots,N-1\\}$，局部损伤驱动阈值为 $Y_c(d) = Y_{0,i} \\, (1 - \\beta \\, d)$，其中 $Y_{0,i}$ 是包含确定性小材料缺陷的单元初始阈值，$\\beta0$ 是一个软化斜率参数。使用 $Y_{0,i} = Y_0 \\, \\bigl( 1 + \\epsilon_{\\mathrm{imp}} \\, \\sin( 2\\pi \\, (i + \\tfrac{1}{2})/N ) \\bigr)$，其中缺陷幅值 $\\epsilon_{\\mathrm{imp}} \\ll 1$ 很小。率相关的损伤流动法则为\n$$\n\\eta \\, \\dot{d} = \\langle Y - Y_c(d) \\rangle_{+}, \\quad d \\in [0,1], \\quad \\dot{d} \\ge 0,\n$$\n其中 $\\eta0$ 是粘性（正则化）参数，Macaulay 括号 $\\langle \\cdot \\rangle_{+}$ 表示取正部，不等式 $\\dot{d}\\ge 0$ 保证了损伤的不可逆性。在每个伪时间点，平衡的弱形式是杆件在应力 $\\sigma = (1-d) E \\varepsilon$ 下的标准虚功原理，这导出了组装后的全局线性系统\n$$\n\\mathbf{K}(\\mathbf{d}) \\, \\mathbf{u} = \\mathbf{f},\n$$\n其中 $\\mathbf{K}(\\mathbf{d})$ 是依赖于损伤的全局刚度矩阵，$\\mathbf{u}$ 是节点位移向量，$\\mathbf{f}$ 代表等效于所施加位移边界条件的外部节点荷载。对于不考虑体力的均质杆，可以从单元贡献 $\\mathbf{K}_e(d_e) = \\dfrac{(1 - d_e) \\, E \\, A}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$ 组装 $\\mathbf{K}(\\mathbf{d})$。\n\n现比较两种用于损伤演化的时间积分程序：\n\n- 一种显式交错格式，在每个大小为 $\\Delta t$ 的伪时间步中，基于上一时间步的应变，使用前向欧拉更新来推进 $d$，然后用更新后的 $\\mathbf{K}(\\mathbf{d})$ 求解线性平衡方程，以获得与所施加边界条件一致的新位移场。\n\n- 一种隐式格式，在每个伪时间步中，通过对损伤流动法则使用后向欧拉更新，以耦合方式求解位移和更新后的损伤，并迭代至收敛（例如，通过对耦合系统进行不动点迭代或 Newton 迭代），从而使损伤和位移在时间步结束时保持一致。\n\n你的任务是基于上述基本定义和虚功原理，为以下基准问题严格以无量纲形式实现这两种程序。每个单元使用一个 Gauss 点。使用均匀的截面和材料，参数如下：\n- $L = 1$,\n- $A = 1$,\n- $E = 1$,\n- $Y_0 = 0.03$,\n- $\\beta = 1$,\n- $\\eta = 0.01$,\n- $\\epsilon_{\\mathrm{imp}} = 10^{-3}$,\n- $u_{\\mathrm{final}} = 0.3$。\n\n对于每个时间步，计算加载端 $x=L$ 处的全局反力，该反力是为施加位移边界条件所需的节点反力；在不考虑体力的组装系统中，该反力是与加载节点对应的完整组装刚度矩阵行与收敛位移向量的乘积。对显式和隐式两种程序，追踪反力序列 $\\{F_n\\}_{n=0}^{N_t}$，其中 $N_t = 1/\\Delta t$。\n\n为定量比较这两种程序，为每种程序计算：\n1. 峰值反力 $F_{\\max} = \\max_{0 \\le n \\le N_t} F_n$。\n2. 振荡冗余\n$$\n\\gamma = \\sum_{n=0}^{N_t-1} \\left| F_{n+1} - F_n \\right| \\;-\\; \\left( (F_{\\max} - F_0) + (F_{\\max} - F_{N_t}) \\right),\n$$\n对于完美的单峰（单调递增后单调递减）响应，该值为零；当出现网格相关或时间积分引起的振荡时，该值为正。\n\n设计一个小型测试套件，以揭示显式交错格式中的网格相关不稳定性，并展示隐式正则化的稳定作用。使用以下三个测试用例，每个用例由 $(N, \\Delta t)$ 定义：\n- 测试 $1$：$(N, \\Delta t) = (16, 0.005)$，\n- 测试 $2$：$(N, \\Delta t) = (64, 0.005)$，\n- 测试 $3$：$(N, \\Delta t) = (16, 0.010)$。\n\n对于每个测试用例，在 $t \\in [0,1]$ 范围内使用 $\\bar{u}(t) = u_{\\mathrm{final}} \\, t$ 运行这两种程序。你的程序必须输出单行，其中包含一个含三个项目的列表，每个项目对应一个测试用例，且每个项目均为列表 $[\\gamma_{\\mathrm{explicit}}, \\gamma_{\\mathrm{implicit}}, F_{\\max,\\mathrm{explicit}}, F_{\\max,\\mathrm{implicit}}]$，并严格遵循此顺序。输出必须以 $[[g_{1,E},g_{1,I},F_{1,E},F_{1,I}],[g_{2,E},g_{2,I},F_{2,E},F_{2,I}],[g_{3,E},g_{3,I},F_{3,E},F_{3,I}]]$ 的格式打印为单行，并使用十进制数。\n\n所有量均为无量纲。不使用角度。不需要百分比。最终的打印输出必须是指定列表的列表格式的单行，包含浮点数。解决方案必须是完全自包含的，不需要任何用户输入或外部文件。", "solution": "该问题要求实现并比较两种数值程序（显式和隐式），用于求解一个带材料损伤杆件的准静态单轴拉伸问题。该模型基于有限元法（FEM）。本文档介绍了求解该问题的公式推导和算法设计。所有数学实体均按要求使用 LaTeX 渲染。\n\n首先，我们建立问题的控制方程。杆的长度为 $L=1$，横截面积为 $A=1$，杨氏模量为 $E=1$。它被离散化为 $N$ 个等长的线性有限元，单元长度为 $h=L/N$。\n\n离散化系统的平衡由全局矩阵方程表示：\n$$\n\\mathbf{K}(\\mathbf{d}) \\mathbf{u} = \\mathbf{f}\n$$\n其中 $\\mathbf{u}$ 是 $N+1$ 个节点位移的向量，$\\mathbf{d}$ 是 $N$ 个单元损伤变量的向量，$\\mathbf{K}(\\mathbf{d})$ 是 $(N+1) \\times (N+1)$ 的全局刚度矩阵，$\\mathbf{f}$ 是节点力向量。对于损伤为 $d_e$ 的单元 $e$，其单元刚度矩阵为：\n$$\n\\mathbf{K}_e(d_e) = \\frac{(1 - d_e) E A}{h}\n\\begin{bmatrix}\n1  -1 \\\\\n-1  1\n\\end{bmatrix}\n$$\n边界条件为 $x=0$ 处的固定位移 $u_0 = 0$ 和 $x=L$ 处的指定位移 $u_N = \\bar{u}(t) = u_{\\mathrm{final}} \\cdot t$。我们求解 $N-1$ 个未知的内部节点位移 $\\mathbf{u}_I = [u_1, \\dots, u_{N-1}]^T$。这导出一个简化的 $(N-1) \\times (N-1)$ 三对角线性系统 $\\mathbf{A} \\mathbf{u}_I = \\mathbf{b}$，其中矩阵 $\\mathbf{A}$ 和向量 $\\mathbf{b}$ 依赖于当前的损伤状态 $\\mathbf{d}$。$\\mathbf{A}$ 的非零项为：\n$$\nA_{i,i} = \\frac{(1-d_{i-1})EA}{h} + \\frac{(1-d_{i})EA}{h}, \\quad i=1, \\dots, N-1\n$$\n$$\nA_{i,i-1} = -\\frac{(1-d_{i-1})EA}{h}, \\quad i=2, \\dots, N-1\n$$\n$$\nA_{i,i+1} = -\\frac{(1-d_{i})EA}{h}, \\quad i=1, \\dots, N-2\n$$\n右端向量 $\\mathbf{b}$ 除最后一个分量外均为零：\n$$\nb_{N-1} = \\frac{(1-d_{N-1})EA}{h} \\bar{u}(t)\n$$\n这个三对角系统可以被高效求解。\n\n损伤演化由率定则 $\\eta \\dot{d} = \\langle Y - Y_c(d) \\rangle_{+}$ 控制，其中粘度 $\\eta=0.01$。能量释放率为 $Y = \\frac{1}{2} E \\varepsilon^2$，其中单元 $i$ 的应变为 $\\varepsilon_i = (u_{i+1} - u_i)/h$。损伤阈值为 $Y_c(d) = Y_{0,i}(1 - \\beta d)$，其中 $\\beta=1$。初始阈值 $Y_{0,i}$ 包含一个空间缺陷：\n$$\nY_{0,i} = Y_0 \\left( 1 + \\epsilon_{\\mathrm{imp}} \\sin\\left( \\frac{2\\pi(i + 0.5)}{N} \\right) \\right)\n$$\n其中 $Y_0 = 0.03$ 且 $\\epsilon_{\\mathrm{imp}} = 10^{-3}$。\n\n模拟从 $t=0$ 到 $t=1$ 以大小为 $\\Delta t$ 的离散时间步进行。设时间步的索引为 $n$。\n\n**显式交错格式**\n\n在此程序中，$t_{n+1}$ 时刻的状态是顺序计算的。\n1.  **损伤更新**：对每个单元 $i$，其损伤 $d_{i,n+1}$ 基于 $t_n$ 时刻的状态，使用前向欧拉步计算：\n    $$\n    d_{i,n+1} = d_{i,n} + \\frac{\\Delta t}{\\eta} \\left\\langle \\frac{1}{2}E \\varepsilon_{i,n}^2 - Y_{0,i}(1 - \\beta d_{i,n}) \\right\\rangle_{+}\n    $$\n    其中 $\\varepsilon_{i,n} = (u_{i+1,n} - u_{i,n})/h$。更新后的损伤被约束在区间 $[d_{i,n}, 1]$ 内，以保证不可逆性和物理极限。\n2.  **平衡求解**：使用新的损伤值 $\\mathbf{d}_{n+1}$，组装并求解 $t_{n+1}$ 时刻的位移线性系统：$\\mathbf{A}(\\mathbf{d}_{n+1}) \\mathbf{u}_{I,n+1} = \\mathbf{b}(\\mathbf{d}_{n+1}, \\bar{u}(t_{n+1}))$。这会得出内部位移 $\\mathbf{u}_{I,n+1}$。完整的位移向量为 $\\mathbf{u}_{n+1} = [0, u_{1,n+1}, \\dots, u_{N-1,n+1}, \\bar{u}(t_{n+1})]^T$。\n\n**隐式格式**\n\n此程序使用损伤的后向欧拉格式，在 $t_{n+1}$ 时刻同时求解损伤和位移。这导致在每个时间步都产生一个非线性系统，此处使用不动点（Picard）迭代进行求解。\n对于每个时间步 $n \\to n+1$，我们使用索引 $k$ 进行迭代：\n1.  **初始化**：从新损伤状态的初始猜测开始，例如 $\\mathbf{d}_{n+1}^{(0)} = \\mathbf{d}_n$。\n2.  **不动点迭代**：\n    a. **平衡求解**：给定损伤猜测值 $\\mathbf{d}_{n+1}^{(k)}$，通过求解线性系统 $\\mathbf{A}(\\mathbf{d}_{n+1}^{(k)}) \\mathbf{u}_{I,n+1}^{(k+1)} = \\mathbf{b}(\\mathbf{d}_{n+1}^{(k)}, \\bar{u}(t_{n+1}))$ 来求解位移 $\\mathbf{u}_{n+1}^{(k+1)}$。\n    b. **损伤更新**：使用计算出的位移 $\\mathbf{u}_{n+1}^{(k+1)}$，计算相应的应变 $\\varepsilon_{i,n+1}^{(k+1)}$。然后，通过求解以下隐式方程来更新每个单元的损伤：\n    $$\n    \\eta \\frac{d_{i,n+1}^{(k+1)} - d_{i,n}}{\\Delta t} = \\left\\langle \\frac{1}{2}E \\left(\\varepsilon_{i,n+1}^{(k+1)}\\right)^2 - Y_{0,i}(1 - \\beta d_{i,n+1}^{(k+1)}) \\right\\rangle_{+}\n    $$\n    如果在 $d_{i,n}$ 处求值时 Macaulay 括号中的项为非正，则不发生损伤增长，因此 $d_{i,n+1}^{(k+1)} = d_{i,n}$。否则，该方程对于 $d_{i,n+1}^{(k+1)}$ 是线性的，可以求解：\n    $$\n    d_{i,n+1}^{(k+1)} \\left( \\frac{\\eta}{\\Delta t} - Y_{0,i} \\beta \\right) = \\frac{\\eta}{\\Delta t} d_{i,n} + \\frac{1}{2}E\\left(\\varepsilon_{i,n+1}^{(k+1)}\\right)^2 - Y_{0,i}\n    $$\n    从而得到更新后的损伤：\n    $$\n    d_{i,n+1}^{(k+1)} = \\frac{d_{i,n} + \\frac{\\Delta t}{\\eta} \\left( \\frac{1}{2}E\\left(\\varepsilon_{i,n+1}^{(k+1)}\\right)^2 - Y_{0,i} \\right)}{1 - \\frac{\\Delta t}{\\eta} Y_{0,i} \\beta}\n    $$\n    然后将结果约束在区间 $[d_{i,n}, 1]$ 内。\n    c. **收敛检查**：如果变化量 $\\|\\mathbf{d}_{n+1}^{(k+1)} - \\mathbf{d}_{n+1}^{(k)}\\|$ 小于某个容差，则迭代已收敛。否则，令 $k \\to k+1$ 并重复。\n\n**输出计算**\n\n在每个时间步成功积分后（无论是哪种程序），计算加载端 $x=L$ 处的反力 $F_{n+1}$。根据全局平衡方程，该力对应于 $\\mathbf{K}\\mathbf{u}$ 的最后一行：\n$$\nF_{n+1} = \\frac{(1 - d_{N-1, n+1}) E A}{h} (u_{N, n+1} - u_{N-1, n+1})\n$$\n收集力的历史序列 $\\{F_n\\}_{n=0}^{N_t}$。峰值力 $F_{\\max}$ 是此序列的最大值。振荡冗余 $\\gamma$ 使用其定义进行计算：\n$$\n\\gamma = \\sum_{n=0}^{N_t-1} \\left| F_{n+1} - F_n \\right| - \\left( (F_{\\max} - F_0) + (F_{\\max} - F_{N_t}) \\right)\n$$\n其中 $F_0=0$。对指定的三个测试用例，都使用显式和隐式方法进行这些计算。预期的结果是，对于更精细的网格或更大的时间步，显式方法将显示出数值不稳定性（$\\gamma$ 值较大），而隐式方法将保持稳定。", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to run the benchmark simulations and print the results.\n    \"\"\"\n    # Dimensionless parameters from the problem statement\n    params = {\n        'L': 1.0,\n        'A': 1.0,\n        'E': 1.0,\n        'Y0': 0.03,\n        'beta': 1.0,\n        'eta': 0.01,\n        'eps_imp': 1e-3,\n        'u_final': 0.3\n    }\n    \n    test_cases = [\n        (16, 0.005),  # Test 1\n        (64, 0.005),  # Test 2\n        (16, 0.010),  # Test 3\n    ]\n\n    all_results = []\n    for N, dt in test_cases:\n        F_hist_explicit = run_simulation(N, dt, 'explicit', params)\n        F_hist_implicit = run_simulation(N, dt, 'implicit', params)\n\n        gamma_explicit, F_max_explicit = calculate_metrics(F_hist_explicit)\n        gamma_implicit, F_max_implicit = calculate_metrics(F_hist_implicit)\n        \n        case_results = [gamma_explicit, gamma_implicit, F_max_explicit, F_max_implicit]\n        all_results.append(case_results)\n\n    # Format output as a single line string representation of a list of lists.\n    # e.g., [[val1, val2, ...], [val1, val2, ...]]\n    output_str = '[' + ','.join(['[' + ','.join(map(str, res)) + ']' for res in all_results]) + ']'\n    print(output_str)\n\n\ndef run_simulation(N, dt, method, params):\n    \"\"\"\n    Runs a single simulation for a given configuration (N, dt, method).\n    \"\"\"\n    L, A, E = params['L'], params['A'], params['E']\n    Y0, beta, eta = params['Y0'], params['beta'], params['eta']\n    eps_imp, u_final = params['eps_imp'], params['u_final']\n\n    h = L / N\n    Nt = int(round(1.0 / dt))\n\n    # Element-wise initial damage threshold\n    i_coords = np.arange(N) + 0.5\n    Y0_i = Y0 * (1 + eps_imp * np.sin(2 * np.pi * i_coords / N))\n\n    u = np.zeros(N + 1)\n    d = np.zeros(N)\n    \n    F_history = [0.0]\n\n    for n in range(Nt):\n        t_np1 = (n + 1) * dt\n        u_prescribed = u_final * t_np1\n\n        if method == 'explicit':\n            # Explicit damage update\n            eps_n = (u[1:] - u[:-1]) / h\n            Y_n = 0.5 * E * eps_n**2\n            Yc_n = Y0_i * (1 - beta * d)\n            d_dot = (1 / eta) * np.maximum(0, Y_n - Yc_n)\n            d_np1 = d + d_dot * dt\n            d_np1 = np.minimum(d_np1, 1.0) # Enforce d = 1\n            \n            # Solve for displacement\n            u_np1 = solve_displacements(d_np1, u_prescribed, N, h, A, E)\n\n        elif method == 'implicit':\n            u_np1, d_np1 = solve_implicit_step(u, d, u_prescribed, N, h, dt, params, Y0_i)\n        \n        # Update state variables\n        u = u_np1\n        d = d_np1\n        \n        # Calculate reaction force\n        # A more stable calculation, as d[N-1] could be 1\n        stiffness_last_elem = (1 - d[N-1]) * E * A / h\n        F_np1 = stiffness_last_elem * (u_np1[N] - u_np1[N-1])\n\n        F_history.append(F_np1)\n        \n    return np.array(F_history)\n\ndef solve_displacements(d, u_prescribed, N, h, A, E):\n    \"\"\"\n    Solves the tridiagonal system for internal nodal displacements.\n    \"\"\"\n    u_np1 = np.zeros(N + 1)\n    u_np1[N] = u_prescribed\n\n    if N  1:\n        # Assemble tridiagonal system for internal nodes (1 to N-1)\n        k_elem = (1 - d) * E * A / h\n        \n        diag = k_elem[:-1] + k_elem[1:]\n        upper_diag = -k_elem[1:-1]\n        lower_diag = -k_elem[1:-1]\n        \n        # SciPy's solve_banded format:\n        # ab[0,:] is upper diagonal (shifted)\n        # ab[1,:] is main diagonal\n        # ab[2,:] is lower diagonal (shifted)\n        ab = np.zeros((3, N - 1))\n        ab[0, 1:] = upper_diag\n        ab[1, :] = diag\n        ab[2, :-1] = lower_diag\n        \n        # Assemble RHS vector\n        b = np.zeros(N - 1)\n        b[-1] = k_elem[-1] * u_prescribed\n\n        try:\n            u_internal = solve_banded((1, 1), ab, b)\n            u_np1[1:N] = u_internal\n        except np.linalg.LinAlgError:\n            # If matrix is singular (e.g., full damage), handle gracefully.\n            # This simplified handling assumes failure propagation.\n            u_np1[1:N] = np.linspace(0, u_prescribed, N+1)[1:N]\n\n    return u_np1\n\ndef solve_implicit_step(u_n, d_n, u_prescribed, N, h, dt, params, Y0_i):\n    \"\"\"\n    Solves the coupled system for one implicit time step using fixed-point iteration.\n    \"\"\"\n    E, beta, eta = params['E'], params['beta'], params['eta']\n    \n    # Fixed-point iteration settings\n    max_iter = 100\n    tol = 1e-8\n    \n    # Initial guess\n    d_k = d_n.copy()\n    \n    for _ in range(max_iter):\n        # 1. Solve for displacements with current damage guess d_k\n        u_kp1 = solve_displacements(d_k, u_prescribed, N, h, params['A'], E)\n        \n        # 2. Update damage with new displacements u_kp1\n        eps_kp1 = (u_kp1[1:] - u_kp1[:-1]) / h\n        Y_kp1 = 0.5 * E * eps_kp1**2\n        \n        # Check damage criterion\n        g_at_dn = Y_kp1 - Y0_i * (1 - beta * d_n)\n        \n        d_kp1 = d_n.copy()\n        \n        # Find elements where damage grows\n        idx_growth = g_at_dn  0\n        \n        if np.any(idx_growth):\n            Y0_i_g = Y0_i[idx_growth]\n            d_n_g = d_n[idx_growth]\n            Y_kp1_g = Y_kp1[idx_growth]\n\n            # Solve for d_kp1\n            # d_kp1 * (eta/dt - Y0_i*beta) = eta/dt*d_n + Y_kp1 - Y0_i\n            denom = (eta / dt) - Y0_i_g * beta\n            # Avoid division by zero, although not expected with problem params\n            denom[np.abs(denom)  1e-12] = 1e-12\n            \n            num = (eta / dt) * d_n_g + Y_kp1_g - Y0_i_g\n            d_kp1[idx_growth] = num / denom\n        \n        # Enforce constraints\n        d_kp1 = np.maximum(d_n, np.minimum(d_kp1, 1.0))\n        \n        # 3. Check for convergence\n        if np.linalg.norm(d_kp1 - d_k)  tol * (np.linalg.norm(d_k) + tol):\n            break\n        \n        d_k = d_kp1\n\n    u_np1 = solve_displacements(d_k, u_prescribed, N, h, params['A'], E)\n    return u_np1, d_k\n\n\ndef calculate_metrics(F_history):\n    \"\"\"\n    Calculates the peak force and oscillation excess.\n    \"\"\"\n    if len(F_history)  2:\n        return 0.0, 0.0\n\n    F_max = np.max(F_history)\n    F0 = F_history[0]\n    F_Nt = F_history[-1]\n    \n    sum_abs_diff = np.sum(np.abs(np.diff(F_history)))\n    \n    monotone_path_length = (F_max - F0) + (F_max - F_Nt)\n    \n    gamma = sum_abs_diff - monotone_path_length\n    \n    return gamma, F_max\n\nsolve()\n```", "id": "2545077"}]}