{"hands_on_practices": [{"introduction": "掌握任何数值方法的第一步是理解其理论极限。本练习将引导您从第一性原理出发，为一个简单的一维波动问题推导著名的 Courant–Friedrichs–Lewy (CFL) 条件。通过这个过程，您将建立起对时间步长、单元尺寸和材料属性之间基本关系的深刻理解，为后续更复杂的应用奠定坚实的理论基础。", "problem": "一根长度为 $L$、横截面积恒为 $A$ 的均匀直弹性杆，在小应变情况下，通过线性弹性理论在一维空间中进行建模。设 $E$ 表示杨氏模量，$\\rho$ 表示质量密度。轴向位移 $u(x,t)$ 的控制偏微分方程是由牛顿第二定律和胡克定律推导出的线性波动方程，波速为 $c=\\sqrt{E/\\rho}$。考虑对该杆进行有限元半离散化，使用 $N$ 个尺寸为 $h=L/N$ 的均匀双节点线性单元，在均匀网格上采用质量集中（对协调质量矩阵进行行和对角化），并施加周期性边界条件以消除边界效应。半离散方程的形式为 $\\mathbf{M} \\ddot{\\mathbf{u}}(t) + \\mathbf{K} \\mathbf{u}(t) = \\mathbf{0}$，其中 $\\mathbf{M}$ 是对角矩阵。\n\n时间积分采用显式中心差分格式（也称为蛙跳法）进行。该显式格式的稳定性受 Courant–Friedrichs–Lewy (CFL) 条件控制，该条件取决于半离散系统的最大固有频率，因此也取决于空间离散化。\n\n从第一性原理（牛顿第二定律和有限元半离散模型）以及对所得均匀晶格的模态（傅里叶）分析出发，推导显式中心差分法的最大稳定时间步长 $\\Delta t_{\\max}$ 关于 $h$、$E$ 和 $\\rho$ 的表达式。然后，使用推导出的表达式，根据以下数据计算 $\\Delta t_{\\max}$ 的数值：\n- $E = 210 \\times 10^{9}$,\n- $\\rho = 7800$,\n- $L = 1$,\n- $N = 100$,\n并将最终数值答案以秒为单位表示。将答案四舍五入至四位有效数字。", "solution": "该问题要求推导应用于一维弹性杆有限元半离散化的显式中心差分时间积分格式的稳定性极限。这代表了计算波传播中的一个经典问题。问题陈述已经过验证，被认为是科学上合理、适定且客观的。没有发现任何缺陷。我们开始进行形式推导。\n\n轴向位移 $u(x,t)$ 的控制方程是波动方程：\n$$\n\\frac{\\partial^2 u}{\\partial t^2} = c^2 \\frac{\\partial^2 u}{\\partial x^2}\n$$\n其中波速 $c$ 由 $c = \\sqrt{E/\\rho}$ 给出，$E$ 是杨氏模量，$\\rho$ 是质量密度。\n\n空间域使用 $N$ 个长度为 $h = L/N$ 的均匀线性双节点有限元进行离散化。半离散常微分方程组的形式为 $\\mathbf{M} \\ddot{\\mathbf{u}}(t) + \\mathbf{K} \\mathbf{u}(t) = \\mathbf{0}$。我们必须首先为具有周期性边界条件的均匀网格中的一个代表性节点构建质量矩阵 $\\mathbf{M}$ 和刚度矩阵 $\\mathbf{K}$。\n\n对于长度为 $h$ 的单个线性杆单元，单元刚度矩阵 $k^e$ 和协调质量矩阵由下式给出：\n$$\nk^e = \\frac{AE}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}, \\quad m^e_{\\text{consistent}} = \\frac{\\rho A h}{6} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix}\n$$\n问题指定通过行和对角化进行质量集中。因此，集中单元质量矩阵 $m^e$ 为：\n$$\nm^e = \\frac{\\rho A h}{6} \\begin{pmatrix} 2+1 & 0 \\\\ 0 & 1+2 \\end{pmatrix} = \\frac{\\rho A h}{2} \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}\n$$\n考虑一个通用节点 $j$。它连接两个单元：单元 $(j-1, j)$ 和单元 $(j, j+1)$。由于周期性边界条件，所有节点在拓扑上都是等效的。节点 $j$ 的位移 $u_j$ 的运动方程由这两个单元的贡献组装而成。\n\n与节点 $j$ 相关联的质量 $M_{jj}$ 是来自两个相邻单元贡献的总和：\n$$\nM_{jj} = \\frac{\\rho A h}{2} + \\frac{\\rho A h}{2} = \\rho A h\n$$\n由于集中质量矩阵 $M$ 是对角矩阵，节点 $j$ 方程中的质量项就是 $M_{jj} \\ddot{u}_j = (\\rho A h) \\ddot{u}_j$。\n\n节点 $j$ 的刚度项 $(\\mathbf{K}\\mathbf{u})_j$ 是由单元刚度矩阵组装而成的。节点 $j$ 上的力取决于其自身的位移 $u_j$ 和其相邻节点 $u_{j-1}$ 和 $u_{j+1}$ 的位移。\n$$\n(\\mathbf{K}\\mathbf{u})_j = \\left(\\frac{AE}{h}\\right) [u_j - u_{j+1}] + \\left(\\frac{AE}{h}\\right) [u_j - u_{j-1}] = \\frac{AE}{h} (-u_{j-1} + 2u_j - u_{j+1})\n$$\n结合这些项，节点 $j$ 的运动方程变为：\n$$\n(\\rho A h) \\ddot{u}_j + \\frac{AE}{h} (-u_{j-1} + 2u_j - u_{j+1}) = 0\n$$\n两边除以 $\\rho A h$ 得到：\n$$\n\\ddot{u}_j + \\frac{E}{\\rho h^2} (-u_{j-1} + 2u_j - u_{j+1}) = 0\n$$\n代入 $c^2 = E/\\rho$，我们得到离散晶格方程：\n$$\n\\ddot{u}_j + \\frac{c^2}{h^2} (-u_{j-1} + 2u_j - u_{j+1}) = 0\n$$\n这是原始偏微分方程的一个有限差分近似。\n\n为了找到该半离散系统的固有频率，我们进行模态分析，假设一个形式如下的离散波解（傅里叶模态）：\n$$\nu_j(t) = \\hat{u} \\exp(i(\\omega t - k x_j)) = \\hat{u} \\exp(i(\\omega t - k j h))\n$$\n其中 $\\omega$ 是角频率，$k$ 是波数，$x_j=jh$ 是节点 $j$ 的位置，$\\hat{u}$ 是振幅。时间导数为 $\\dot{u}_j = i\\omega u_j$ 和 $\\ddot{u}_j = -\\omega^2 u_j$。空间关系为 $u_{j-1} = u_j \\exp(ikh)$ 和 $u_{j+1} = u_j \\exp(-ikh)$。\n\n将这些代入晶格方程，得到色散关系：\n$$\n-\\omega^2 u_j + \\frac{c^2}{h^2} (-u_j \\exp(ikh) + 2u_j - u_j \\exp(-ikh)) = 0\n$$\n两边除以 $u_j$（非零）：\n$$\n-\\omega^2 + \\frac{c^2}{h^2} (2 - (\\exp(ikh) + \\exp(-ikh))) = 0\n$$\n使用欧拉恒等式 $2\\cos(kh) = \\exp(ikh) + \\exp(-ikh)$，我们发现：\n$$\n\\omega^2 = \\frac{2c^2}{h^2} (1 - \\cos(kh))\n$$\n应用半角三角恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$：\n$$\n\\omega^2(k) = \\frac{4c^2}{h^2} \\sin^2\\left(\\frac{kh}{2}\\right)\n$$\n因此，角频率是波数 $k$ 的函数：\n$$\n\\omega(k) = \\frac{2c}{h} \\left| \\sin\\left(\\frac{kh}{2}\\right) \\right|\n$$\n显式中心差分格式的稳定性由离散系统的最高固有频率 $\\omega_{\\max}$ 控制。当项 $|\\sin(kh/2)|$ 达到其最大值 $1$ 时，出现该最大频率。这对应于离散网格可以解析的最短波长 $\\lambda_{\\min} = 2h$，此时波数为 $k_{\\max} = \\pi/h$。对于该值，正弦函数的自变量为 $k_{\\max}h/2 = \\pi/2$。\n\n因此，最大固有频率为：\n$$\n\\omega_{\\max} = \\frac{2c}{h} \\left| \\sin\\left(\\frac{\\pi}{2}\\right) \\right| = \\frac{2c}{h}\n$$\n应用于谐振子系统的中心差分（蛙跳）法的稳定性条件是 $\\Delta t \\le 2/\\omega_{\\max}$。因此，最大稳定时间步长 $\\Delta t_{\\max}$ 为：\n$$\n\\Delta t_{\\max} = \\frac{2}{\\omega_{\\max}} = \\frac{2}{2c/h} = \\frac{h}{c}\n$$\n代入 $c = \\sqrt{E/\\rho}$，我们得到最大稳定时间步长关于所需参数的最终表达式：\n$$\n\\Delta t_{\\max} = \\frac{h}{\\sqrt{E/\\rho}} = h \\sqrt{\\frac{\\rho}{E}}\n$$\n这就是针对此特定数值格式的 Courant–Friedrichs–Lewy (CFL) 条件。\n\n我们现在使用所提供的数据计算数值：\n$E = 210 \\times 10^{9} \\, \\text{Pa}$\n$\\rho = 7800 \\, \\text{kg}/\\text{m}^3$\n$L = 1 \\, \\text{m}$\n$N = 100$\n\n首先，我们计算单元尺寸 $h$ 和波速 $c$。\n$$\nh = \\frac{L}{N} = \\frac{1}{100} = 0.01 \\, \\text{m}\n$$\n$$\nc = \\sqrt{\\frac{E}{\\rho}} = \\sqrt{\\frac{210 \\times 10^{9}}{7800}} \\approx 5188.745 \\, \\text{m/s}\n$$\n现在，我们计算最大稳定时间步长 $\\Delta t_{\\max}$：\n$$\n\\Delta t_{\\max} = \\frac{h}{c} = \\frac{0.01}{\\sqrt{\\frac{210 \\times 10^{9}}{7800}}} \\approx \\frac{0.01}{5188.745} \\approx 1.92725 \\times 10^{-6} \\, \\text{s}\n$$\n按要求将结果四舍五入至四位有效数字：\n$$\n\\Delta t_{\\max} \\approx 1.927 \\times 10^{-6} \\, \\text{s}\n$$\n推导和计算到此完成。", "answer": "$$\\boxed{1.927 \\times 10^{-6}}$$", "id": "2557114"}, {"introduction": "理论为我们提供了指引，但数值模拟才是检验真理的试金石。在前一个练习中推导出的稳定性理论，现在将通过编程实践得到验证。本练习要求您编写一个程序来模拟波的传播，并直接观察稳定性边界：通过测试略低于、等于和略高于临界时间步长的值，您将对数值稳定与不稳定的实际表现获得直观的认识。", "problem": "考虑区间 $\\left(0,L\\right)$ 上的一维线性弹性波方程，其两端为齐次狄利克雷边界条件且无外力作用。令 $u\\left(x,t\\right)$ 表示轴向位移，$\\rho$ 为质量密度，$E$ 为杨氏模量，$A$ 为横截面积。其强形式为\n$$\n\\rho A\\,\\frac{\\partial^2 u}{\\partial t^2} - \\frac{\\partial}{\\partial x}\\left(EA\\,\\frac{\\partial u}{\\partial x}\\right) = 0,\\quad x\\in\\left(0,L\\right),\\ t>0,\\quad u\\left(0,t\\right)=u\\left(L,t\\right)=0.\n$$\n令波速为 $c=\\sqrt{E/\\rho}$。\n\n使用标准的伽辽金有限元法，采用包含 $N_e$ 个双节点线性单元的均匀网格和质量集中近似，得到的半离散系统形式如下\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0},\n$$\n其中，在消去边界自由度后，$\\mathbf{M}\\in\\mathbb{R}^{n\\times n}$ 为对角正定矩阵，$\\mathbf{K}\\in\\mathbb{R}^{n\\times n}$ 为对称正定矩阵，$n=N_e-1$ 是内部自由度的数量。考虑在时间步长为 $\\Delta t$ 的均匀时间网格上定义的显式中心差分时间积分格式\n$$\n\\mathbf{u}^{k+1} = 2\\mathbf{u}^k - \\mathbf{u}^{k-1} - \\Delta t^2\\,\\mathbf{M}^{-1}\\mathbf{K}\\,\\mathbf{u}^k,\\quad k\\geq 1,\n$$\n其第一步通过以下方式计算\n$$\n\\mathbf{u}^1 = \\mathbf{u}^0 + \\Delta t\\,\\dot{\\mathbf{u}}^0 + \\frac{\\Delta t^2}{2}\\,\\ddot{\\mathbf{u}}^0,\\quad \\ddot{\\mathbf{u}}^0 = -\\mathbf{M}^{-1}\\mathbf{K}\\,\\mathbf{u}^0.\n$$\n\n您的任务是使用基于上述一维模型构建的典范问题，来验证显式中心差分格式的 Courant–Friedrichs–Lewy (CFL) 稳定性界限。从半离散系统和显式格式的基本定义出发，根据无阻尼、无外力离散系统的谱特性，确定最大稳定时间步长。然后，为每个测试用例计算：\n- 临界时间步长 $\\Delta t_{\\text{crit}}$（单位：秒），\n- 比率 $r=\\Delta t/\\Delta t_{\\text{crit}}$（无量纲），\n- 仅从理论稳定性条件获得的预测稳定性标志 $\\in\\{0,1\\}$，\n- 通过使用显式中心差分格式进行直接模拟获得的观测稳定性标志 $\\in\\{0,1\\}$。\n\n对于观测稳定性，使用以下典范初始条件来创建最坏情况：将初始位移 $\\mathbf{u}^0$ 设置为与矩阵对 $\\left(\\mathbf{K},\\mathbf{M}\\right)$ 的最大广义特征值（即最高离散频率模态）相关的离散特征向量成正比，并将其归一化至单位 $\\mathbf{M}$-范数，同时设置初始速度 $\\dot{\\mathbf{u}}^0=\\mathbf{0}$。将该格式演进指定的步数，如果在模拟时间内位移的最大 $\\mathbf{M}$-范数不超过初始 $\\mathbf{M}$-范数的预设阈值倍数，则宣布该次运行为“观测稳定”。使用等于 $20$ 的阈值因子（无量纲）。所有物理量必须使用国际单位制表示：$L$ 的单位为米，时间的单位为秒，$c$ 的单位为米/秒。以秒为单位报告 $\\Delta t_{\\text{crit}}$。\n\n实现以下测试套件。在所有用例中，取 $A=1$（平方米）、$E=1$（帕斯卡），并选择 $\\rho=E/c^2$ 以使波速恰好为 $c$。在 $x=0$ 和 $x=L$ 处施加齐次狄利克雷边界条件。对于每个用例，构建均匀网格，组装 $\\mathbf{K}$ 和集中的 $\\mathbf{M}$，计算离散谱以确定临界时间步长，按指示选择 $\\Delta t$，并模拟指定的步数。\n\n- 用例 $\\left(1\\right)$：$L=1$（米），$N_e=80$，$c=200$（米/秒），选择 $\\Delta t=0.8\\,\\Delta t_{\\text{crit}}$，并模拟 $4000$ 个时间步长。\n- 用例 $\\left(2\\right)$：$L=1$（米），$N_e=80$，$c=200$（米/秒），选择 $\\Delta t=1.0\\,\\Delta t_{\\text{crit}}$，并模拟 $2000$ 个时间步长。\n- 用例 $\\left(3\\right)$：$L=1$（米），$N_e=80$，$c=200$（米/秒），选择 $\\Delta t=1.05\\,\\Delta t_{\\text{crit}}$，并模拟 $800$ 个时间步长。\n- 用例 $\\left(4\\right)$：$L=1$（米），$N_e=160$，$c=200$（米/秒），选择 $\\Delta t=0.8\\,\\Delta t_{\\text{crit}}$，并模拟 $4000$ 个时间步长。\n\n您的程序必须：\n- 为双节点线性单元的均匀网格组装 $\\mathbf{K}$ 和 $\\mathbf{M}$，\n- 通过消除边界自由度来施加狄利克雷边界条件，\n- 计算 $\\left(\\mathbf{K},\\mathbf{M}\\right)$ 的最大广义特征值，从而得到相应的最高离散角频率，\n- 确定理论临界时间步长和预测的稳定性标志，\n- 构建最高频率特征向量并将其归一化至单位 $\\mathbf{M}$-范数，\n- 在初始速度为零的情况下，运行显式中心差分格式指定的步数，\n- 计算运行期间位移的最大 $\\mathbf{M}$-范数，并使用等于 $20$ 的阈值因子确定观测到的稳定性标志。\n\n每个用例需要生成的数值输出必须是：\n- $\\Delta t_{\\text{crit}}$（单位：秒，浮点数），\n- $r=\\Delta t/\\Delta t_{\\text{crit}}$（浮点数），\n- 预测的稳定性标志，如果理论上稳定则值为 $1$，否则为 $0$，\n- 观测到的稳定性标志，如果模拟被观测为稳定则值为 $1$，否则为 $0$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个 Python 风格的列表，该列表包含四个列表（每个测试用例一个），每个内部列表的形式为 $\\left[\\Delta t_{\\text{crit}}, r, \\text{predicted}, \\text{observed}\\right]$。例如，输出应如下所示：\n$$\n\\left[\\left[d_1,r_1,p_1,o_1\\right],\\left[d_2,r_2,p_2,o_2\\right],\\left[d_3,r_3,p_3,o_3\\right],\\left[d_4,r_4,p_4,o_4\\right]\\right],\n$$\n其中每个 $d_i$ 的单位为秒，每个 $r_i$、$p_i$、$o_i$ 均为无量纲。程序必须完全自包含，且不得读取任何输入。", "solution": "该问题要求验证应用于通过有限元法离散的一维波动方程的显式中心差分时间积分格式的 Courant–Friedrichs–Lewy (CFL) 稳定性条件。解法是通过系统性的、基于原理的方法来推导的。\n\n首先，我们建立理论稳定性判据。半离散系统由无阻尼、无外力的常微分方程组 $\\mathbf{M}\\,\\ddot{\\mathbf{u}} + \\mathbf{K}\\,\\mathbf{u} = \\mathbf{0}$ 给出。该系统的显式中心差分格式为\n$$\n\\mathbf{u}^{k+1} = 2\\mathbf{u}^k - \\mathbf{u}^{k-1} - \\Delta t^2\\,\\mathbf{M}^{-1}\\mathbf{K}\\,\\mathbf{u}^k.\n$$\n为了分析该格式的稳定性，我们考虑单一振荡模态，其位移向量形式为 $\\mathbf{u}(t) = \\mathbf{v}\\,e^{i\\omega t}$。将其代入半离散方程，得到广义特征值问题 $\\mathbf{K}\\mathbf{v} = \\omega^2\\mathbf{M}\\mathbf{v}$，其中 $\\omega$ 是离散系统的固有角频率，$\\mathbf{v}$ 是对应的模态振型。令 $\\lambda = \\omega^2$ 为一个特征值。我们寻求形式为 $\\mathbf{u}^k = g^k\\mathbf{v}$ 的数值解，其中 $g$ 是一个复数放大因子。将此代入差分方程，得到关于 $g$ 的特征二次方程：\n$$\ng^2 - (2 - \\Delta t^2 \\lambda)g + 1 = 0.\n$$\n为使格式稳定，该方程根的模不得超过 1，即 $|g| \\le 1$。如果方程的根是共轭复数，则此条件得以满足，这要求该二次方程的判别式为非正数：\n$$\n(2 - \\Delta t^2 \\lambda)^2 - 4 \\le 0.\n$$\n该不等式可简化为 $-2 \\le 2 - \\Delta t^2 \\lambda \\le 2$，进而得到 $0 \\le \\Delta t^2 \\lambda \\le 4$，或 $\\Delta t \\sqrt{\\lambda} \\le 2$。由于此条件必须对系统的所有模态都成立，因此稳定性由最高频率的模态决定，即 $\\omega_{\\max} = \\sqrt{\\lambda_{\\max}}$。因此，该格式的稳定性条件，也称为 CFL 条件，是：\n$$\n\\Delta t \\le \\frac{2}{\\omega_{\\max}} = \\frac{2}{\\sqrt{\\lambda_{\\max}}}.\n$$\n临界时间步长是最大允许时间步长，$\\Delta t_{\\text{crit}} = 2/\\omega_{\\max}$。当时间步长 $\\Delta t > \\Delta t_{\\text{crit}}$ 时，最高频率模态的数值解将呈指数增长，从而导致不稳定。如果比率 $r = \\Delta t/\\Delta t_{\\text{crit}} \\le 1$，则理论预测的稳定性标志为 $1$，否则为 $0$。\n\n接下来，我们使用有限元法构建系统矩阵 $\\mathbf{M}$ 和 $\\mathbf{K}$。长度为 $L$ 的区域被离散为 $N_e$ 个均匀的双节点线性单元，每个单元的长度为 $h = L/N_e$。对于杨氏模量为 $E$、横截面积为 $A$、质量密度为 $\\rho$ 的单元，其单元刚度矩阵 $\\mathbf{k}^e$ 和集中质量矩阵 $\\mathbf{m}^e$ 分别为：\n$$\n\\mathbf{k}^e = \\frac{EA}{h}\n\\begin{pmatrix}\n1 & -1 \\\\\n-1 & 1\n\\end{pmatrix}, \\quad\n\\mathbf{m}^e = \\frac{\\rho A h}{2}\n\\begin{pmatrix}\n1 & 0 \\\\\n0 & 1\n\\end{pmatrix}.\n$$\n整个网格的全局矩阵通过对每个单元的贡献求和来组装。通过消除与边界节点（节点 $0$ 和节点 $N_e$）对应的行和列，来施加齐次狄利克雷边界条件 $u(0,t)=u(L,t)=0$。这会得到尺寸为 $n \\times n$ 的简化系统矩阵 $\\mathbf{K}$ 和 $\\mathbf{M}$，其中 $n = N_e-1$ 是内部自由自由度的数量。得到的质量矩阵 $\\mathbf{M}$ 是对角矩阵，其元素为 $M_{ii} = \\rho A h$，而刚度矩阵 $\\mathbf{K}$ 是对称三对角矩阵。\n\n数值任务的核心是求解广义特征值问题 $\\mathbf{K}\\mathbf{v} = \\lambda\\mathbf{M}\\mathbf{v}$，以找到其最大特征值 $\\lambda_{\\max}$。这可通过使用数值特征值求解器来完成。已知 $\\lambda_{\\max}$ 后，我们计算 $\\omega_{\\max} = \\sqrt{\\lambda_{\\max}}$ 和 $\\Delta t_{\\text{crit}} = 2/\\omega_{\\max}$。\n\n最后，为了通过经验观察稳定性，我们执行直接时间积分。为了创建一个最大程度激发潜在不稳定模态的最坏情况，初始位移 $\\mathbf{u}^0$ 被设置为与 $\\lambda_{\\max}$ 对应的特征向量 $\\mathbf{v}_{\\max}$。该特征向量被缩放以使其具有单位 $\\mathbf{M}$-范数，即 $\\|\\mathbf{u}^0\\|_{\\mathbf{M}} = \\sqrt{(\\mathbf{u}^0)^T\\mathbf{M}\\mathbf{u}^0} = 1$。初始速度设为零，$\\dot{\\mathbf{u}}^0 = \\mathbf{0}$。时间演化使用中心差分格式计算，并从特殊的第一步开始：\n$$\n\\mathbf{u}^1 = \\mathbf{u}^0 - \\frac{\\Delta t^2}{2}\\mathbf{M}^{-1}\\mathbf{K}\\,\\mathbf{u}^0.\n$$\n在指定步数的模拟过程中，我们监测位移的 $\\mathbf{M}$-范数 $\\|\\mathbf{u}^k\\|_{\\mathbf{M}}$。如果观测到的最大范数未超过初始范数的给定阈值倍数（此处为因子 $20$），则该模拟被宣布为“观测稳定”（标志为 $1$）。如果范数超过此阈值，则该模拟被宣布为不稳定（标志为 $0$）。这个宽松的阈值可以轻易地区分稳定运行的有界响应和不稳定运行的指数增长。对问题陈述中指定的每个测试用例重复此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for CFL stability verification.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, Ne, c, r_target, num_steps)\n        (1.0, 80, 200.0, 0.8, 4000),\n        (1.0, 80, 200.0, 1.0, 2000),\n        (1.0, 80, 200.0, 1.05, 800),\n        (1.0, 160, 200.0, 0.8, 4000),\n    ]\n\n    stability_threshold_factor = 20.0\n    results = []\n\n    for case in test_cases:\n        L, Ne, c, r_target, num_steps = case\n        \n        # Setup physical and mesh parameters\n        E = 1.0\n        A = 1.0\n        rho = E / c**2\n        h = L / Ne\n        n_dof = Ne - 1\n\n        # Assemble stiffness (K) and lumped mass (M) matrices for interior DOFs\n        \n        # M is a diagonal matrix, stored as a 1D array of its diagonal entries\n        # M_ii = rho * A * h for each of the n_dof interior nodes\n        M_diag = np.full(n_dof, rho * A * h)\n        \n        # K is a tridiagonal matrix\n        # Diagonal entries: 2*E*A/h\n        # Off-diagonal entries: -E*A/h\n        main_diag_K = np.full(n_dof, 2 * E * A / h)\n        off_diag_K = np.full(n_dof - 1, -E * A / h)\n        K = np.diag(main_diag_K) + np.diag(off_diag_K, k=1) + np.diag(off_diag_K, k=-1)\n\n        # Solve the generalized eigenvalue problem: K v = lambda M v\n        # Using scipy.linalg.eigh for symmetric matrices. We pass M as a full diagonal matrix.\n        eigenvalues, eigenvectors = eigh(K, np.diag(M_diag))\n        \n        # The largest eigenvalue determines the stability limit\n        lambda_max = eigenvalues[-1]\n        \n        # The highest discrete angular frequency\n        omega_max = np.sqrt(lambda_max)\n        \n        # Compute the theoretical critical time step\n        dt_crit = 2.0 / omega_max\n\n        # --- Predicted Stability ---\n        # The chosen time step for the simulation\n        dt = r_target * dt_crit\n        # Predicted stability flag is 1 if r_target = 1.0\n        predicted_stability = 1 if r_target = 1.0 else 0\n        \n        # --- Observed Stability Simulation ---\n        # Set initial conditions based on the highest frequency mode\n        # The eigenvector corresponding to lambda_max\n        v_max = eigenvectors[:, -1]\n        \n        # Normalize the initial displacement vector u0 to have unit M-norm\n        m_norm_v_max_sq = v_max.T @ (M_diag * v_max)  # M is diagonal\n        u0 = v_max / np.sqrt(m_norm_v_max_sq)\n        \n        # Initial velocity is zero\n        udot0 = np.zeros(n_dof)\n\n        # Pre-calculate matrix for the update step to save computation\n        # Since M is diagonal, its inverse is simple\n        inv_M_diag = 1.0 / M_diag\n        C = dt**2 * (inv_M_diag[:, np.newaxis] * K) # Efficient since inv_M is diagonal\n\n        # First step of central difference scheme (special formula)\n        ddot0 = -(inv_M_diag * (K @ u0))\n        u1 = u0 + dt * udot0 + (dt**2 / 2.0) * ddot0\n        \n        u_prev = u0\n        u_curr = u1\n        \n        # Initial M-norm is 1 by normalization\n        max_m_norm_u = 1.0\n\n        # Main time-stepping loop\n        for k in range(1, num_steps):\n            # Central difference update\n            u_next = 2 * u_curr - u_prev - C @ u_curr\n            \n            u_prev, u_curr = u_curr, u_next\n            \n            # Calculate M-norm of the current displacement\n            current_m_norm_u = np.sqrt(u_curr.T @ (M_diag * u_curr))\n            \n            if current_m_norm_u > max_m_norm_u:\n                max_m_norm_u = current_m_norm_u\n            \n            # Early exit if solution has clearly blown up to avoid overflow/wasted computation\n            if not np.isfinite(max_m_norm_u) or max_m_norm_u > stability_threshold_factor * 10:\n                break\n        \n        # Determine observed stability based on the specified threshold\n        observed_stability = 1 if max_m_norm_u = stability_threshold_factor else 0\n        \n        # Store results for this case\n        results.append([dt_crit, r_target, predicted_stability, observed_stability])\n\n    # Final print statement in the exact required format.\n    print(results)\n\nsolve()\n```", "id": "2557116"}, {"introduction": "在工程实践中，许多问题本质上是非线性的，这意味着材料属性（如切线模量）和波速会在模拟过程中发生变化。本项高级练习将带您进入这一更真实的情境，要求您实现一个自适应时间步长方案来处理非线性材料的动力学问题。通过解决这个问题，您将学会如何将基本的 CFL 原理推广应用，以确保复杂模拟的稳定性和效率。", "problem": "考虑一个长度为 $L$、横截面积为常数 $A$、质量密度为 $\\rho$ 的均匀杆上的一维小应变弹性动力学初始边界值问题。未知位移场 $u(x,t)$ 满足一维空间下无体力的线性动量守恒方程，以及应力 $\\sigma$ 和应变 $\\varepsilon=\\partial u/\\partial x$ 之间的非线性本构关系。具体而言，设本构律为 $\\sigma(\\varepsilon)=E\\,\\varepsilon+\\alpha\\,\\varepsilon^{3}$，其中 $E$ 是一个恒定的参考模量，$\\alpha$ 是一个控制非线性的常数系数。假设切线模量 $E_{\\mathrm{t}}(\\varepsilon)=\\mathrm{d}\\sigma/\\mathrm{d}\\varepsilon=E+3\\alpha\\,\\varepsilon^{2}$ 对于遇到的所有应变都保持严格为正，以使问题保持双曲型。杆具有齐次狄利克雷边界条件 $u(0,t)=0$ 和 $u(L,t)=0$，以及初始条件 $u(x,0)=u_{\\mathrm{amp}}\\sin(\\pi x/L)$ 和 $\\dot{u}(x,0)=0$，其中 $u_{\\mathrm{amp}}$ 为给定振幅。\n\n使用 $N$ 个均匀线性有限元对杆进行离散化，并采用集中质量近似。使用显式中心差分时间积分格式将半离散系统从时间 $t_{n}$ 推进到 $t_{n+1}$，并通过 Courant–Friedrichs–Lewy (CFL) 条件（首次使用时定义缩写）来控制稳定性。瞬时时间步长 $\\Delta t_{n}$ 必须选择为某个固定安全系数 $s$（$0s1$）乘以根据当前状态下非线性材料的线性化计算出的最小单元信号传播时间。在所有时刻强施加狄利克雷边界条件。无外力施加。\n\n你的任务是：\n\n- 从一维平衡律 $\\rho\\,\\ddot{u}=\\partial\\sigma/\\partial x$ 和给定的本构律出发，构建带有集中质量的标准线性有限元半离散方程，以及在当前位移 $u_{n}$ 下由单元贡献组装的相应内力向量。唯一的非线性通过在当前单元应变下的应力计算引入。\n- 以一种在每步都适用于可变时间步长 $\\Delta t_{n}$ 的形式实现显式中心差分更新，并确保其对于光滑解在时间上是二阶精确的。\n- 在每一步，通过应力-应变曲线的斜率从当前状态确定瞬时单元线性波速，并如上所述选择 $\\Delta t_{n}$ 以满足带有安全系数 $s$ 的 Courant–Friedrichs–Lewy (CFL) 稳定性限制。使用此 $\\Delta t_{n}$ 来更新速度和位移。\n- 在整个模拟时域 $[0,T]$ 内，追踪遇到的最小临界时间步长，该步长定义为最小单元信号传播时间（不含安全系数 $s$）在时间上的下确界。以秒为单位报告此最小临界时间步长。\n\n使用以下测试套件，其中所有量均应在国际单位制（SI）下解释。对于每种情况，使用给定的安全系数 $s$ 模拟到指定的最终时间 $T$，并以秒为单位输出遇到的最小临界时间步长（不含安全系数）：\n\n- 情况 1（线性类钢响应，中等细密网格）：$E=2.10\\times 10^{11}$，$\\alpha=0$，$\\rho=7.80\\times 10^{3}$，$L=1$，$A=1$，$N=50$，$T=2.0\\times 10^{-4}$，$u_{\\mathrm{amp}}=1.0\\times 10^{-6}$，$s=0.9$。\n- 情况 2（非线性硬化，更细密网格）：$E=1.0\\times 10^{7}$，$\\alpha=1.0\\times 10^{12}$，$\\rho=1.0\\times 10^{3}$，$L=1$，$A=1$，$N=100$，$T=2.0\\times 10^{-3}$，$u_{\\mathrm{amp}}=5.0\\times 10^{-3}$，$s=0.9$。\n- 情况 3（非线性软化，切线模量仍为正，中等网格）：$E=1.0\\times 10^{7}$，$\\alpha=-5.0\\times 10^{10}$，$\\rho=1.0\\times 10^{3}$，$L=1$，$A=1$，$N=80$，$T=1.0\\times 10^{-3}$，$u_{\\mathrm{amp}}=1.0\\times 10^{-3}$，$s=0.9$。\n- 情况 4（粗网格，线性）：$E=1.0\\times 10^{9}$，$\\alpha=0$，$\\rho=2.0\\times 10^{3}$，$L=1$，$A=1$，$N=2$，$T=1.0\\times 10^{-3}$，$u_{\\mathrm{amp}}=1.0\\times 10^{-4}$，$s=0.9$。\n\n你的程序必须产生单行输出，其中包含四个结果，格式为逗号分隔的浮点数 Python 列表，单位为秒，并按上述情况的顺序排列，例如 $[\\mathrm{result}_{1},\\mathrm{result}_{2},\\mathrm{result}_{3},\\mathrm{result}_{4}]$。", "solution": "该问题陈述是一维非线性弹性动力学中一个适定的初始边界值问题。它具有科学依据，内部一致，并包含构建数值解所需的所有必要信息。物理参数是合理的，指定的数值方法——带集中质量的有限元空间离散和显式中心差分时间积分——是此类问题的标准方法。因此，该问题被认为是有效的，并将提供一个解。\n\n任务是模拟具有非线性应力-应变关系的杆的动力响应，并找出模拟过程中遇到的由 Courant–Friedrichs–Lewy (CFL) 稳定性条件控制的最小临界时间步长。\n\n控制方程是线性动量守恒方程：\n$$\n\\rho \\frac{\\partial^2 u}{\\partial t^2} = \\frac{\\partial \\sigma}{\\partial x}\n$$\n其中 $\\rho$ 是质量密度，$u(x,t)$ 是轴向位移，$\\sigma$ 是轴向应力。本构律为非线性：\n$$\n\\sigma(\\varepsilon) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^3\n$$\n应变为 $\\varepsilon = \\partial u / \\partial x$。\n\n为了使用有限元法（FEM）推导半离散运动方程，我们首先建立弱形式。我们将控制方程乘以一个满足齐次狄利克雷边界条件（即 $v(0)=v(L)=0$）的检验函数 $v(x)$，并在域 $[0, L]$ 上积分：\n$$\n\\int_0^L v \\left( \\rho \\frac{\\partial^2 u}{\\partial t^2} \\right) A \\,dx = \\int_0^L v \\left( \\frac{\\partial \\sigma}{\\partial x} \\right) A \\,dx\n$$\n这里，$A$ 是恒定的横截面积。总力是关键，所以我们考虑像 $\\int \\sigma A \\, dx$ 这样的力学量。对右侧应用分部积分得到：\n$$\n\\int_0^L v \\rho A \\ddot{u} \\,dx = [v A \\sigma]_0^L - \\int_0^L \\frac{\\partial v}{\\partial x} A \\sigma \\,dx\n$$\n边界项 $[v A \\sigma]_0^L$ 因为 $v(0) = v(L) = 0$ 而消失。因此弱形式为：\n$$\n\\int_0^L v \\rho A \\ddot{u} \\,dx + \\int_0^L \\frac{\\partial v}{\\partial x} A \\sigma\\left(\\frac{\\partial u}{\\partial x}\\right) \\,dx = 0\n$$\n\n我们将域离散为 $N$ 个长度为 $h=L/N$ 的均匀线性有限元。位移场近似为 $u(x,t) \\approx \\sum_{i=0}^N N_i(x) d_i(t)$，其中 $N_i(x)$ 是线性“帽”形基函数，$d_i(t)$ 是节点位移。将此近似代入弱形式，得到半离散方程组：\n$$\n\\mathbf{M}\\ddot{\\mathbf{d}}(t) + \\mathbf{f}_{\\text{int}}(\\mathbf{d}(t)) = \\mathbf{0}\n$$\n其中 $\\mathbf{d}$ 是节点位移向量，$\\mathbf{M}$ 是质量矩阵，$\\mathbf{f}_{\\text{int}}$ 是内力向量。\n\n问题指定了集中质量近似。对于均匀网格，内部节点 $i$ 的质量是两个相邻单元质量的一半之和，即对于 $i=1, \\dots, N-1$，$m_i = \\rho A h$。边界节点获得此质量的一半，$m_0=m_N=\\rho A h/2$。质量矩阵 $\\mathbf{M}$ 是对角矩阵，对角线上的值为这些质量值。\n\n内力向量 $\\mathbf{f}_{\\text{int}}$ 由单元贡献组装而成。对于连接节点 $i$ 和 $i+1$ 的线性单元 $e$，应变 $\\varepsilon^{(e)}$ 是恒定的：\n$$\n\\varepsilon^{(e)} = \\frac{d_{i+1} - d_i}{h}\n$$\n单元内的应力 $\\sigma^{(e)}$ 也是恒定的：\n$$\n\\sigma^{(e)} = E\\varepsilon^{(e)} + \\alpha(\\varepsilon^{(e)})^3\n$$\n该单元对节点 $i$ 和 $i+1$ 的内力贡献为 $\\begin{bmatrix} -A\\sigma^{(e)} \\\\ A\\sigma^{(e)} \\end{bmatrix}$。内部节点 $i$ 上的全局内力是其左侧单元（单元 $i-1$）和右侧单元（单元 $i$）的力之和：\n$$\nf_{\\text{int}, i} = A\\sigma^{(i-1)} - A\\sigma^{(i)}\n$$\n其中 $\\sigma^{(i-1)}$ 是节点 $i-1$ 和 $i$ 之间单元的应力，$\\sigma^{(i)}$ 是节点 $i$ 和 $i+1$ 之间单元的应力。\n\n对于时间积分，我们使用显式中心差分格式，特别是蛙跳格式，它具有二阶精度且适用于可变时间步长。设 $\\mathbf{d}_n$、$\\mathbf{v}_n$ 和 $\\mathbf{a}_n$ 分别为时间 $t_n$ 时的位移、速度和加速度向量。速度在半时间步 $t_{n \\pm 1/2}$ 上计算。更新过程如下：\n1.  更新速度：$\\mathbf{v}_{n+1/2} = \\mathbf{v}_{n-1/2} + \\mathbf{a}_n \\Delta t_n$\n2.  更新位移：$\\mathbf{d}_{n+1} = \\mathbf{d}_n + \\mathbf{v}_{n+1/2} \\Delta t_n$\n其中 $\\mathbf{a}_n = -\\mathbf{M}^{-1}\\mathbf{f}_{\\text{int}}(\\mathbf{d}_n)$。该格式需要一个第一步的“启动”过程，因为我们已知 $\\mathbf{d}_0$ 和 $\\mathbf{v}_0$。我们首先根据 $\\mathbf{d}_0$ 计算 $\\mathbf{a}_0$，并确定初始时间步长 $\\Delta t_0$。然后通过后退一步找到第一个半步的速度：$\\mathbf{v}_{-1/2} = \\mathbf{v}_0 - \\mathbf{a}_0 \\Delta t_0/2$。\n\n这个显式格式的稳定性由 Courant–Friedrichs–Lewy (CFL) 条件控制，该条件要求数值依赖域必须包含物理依赖域。对于一维波动方程，这意味着在一个时间步长 $\\Delta t$ 内，信息传播的距离不能超过一个单元长度 $h$：\n$$\n\\Delta t \\le \\frac{h}{c}\n$$\n其中 $c$ 是波传播速度。在我们的非线性材料中，波速取决于切线模量 $E_t = d\\sigma/d\\varepsilon$：\n$$\nc(\\varepsilon) = \\sqrt{\\frac{E_t(\\varepsilon)}{\\rho}} = \\sqrt{\\frac{E + 3\\alpha\\varepsilon^2}{\\rho}}\n$$\n由于应变 $\\varepsilon$ 在不同单元间变化，并随时间变化，波速在空间和时间上也是可变的。为确保整个系统的稳定性，时间步长 $\\Delta t_n$ 必须根据时间 $t_n$ 时任何单元中存在的最大波速来选择：\n$$\nc_{\\max, n} = \\max_{e \\in \\{1,\\dots,N\\}} \\left\\{ c^{(e)}(\\varepsilon_n^{(e)}) \\right\\}\n$$\n在时间 $t_n$ 的临界时间步长为 $\\Delta t_{\\text{crit}, n} = h / c_{\\max, n}$。实际使用的时间步长为 $\\Delta t_n = s \\cdot \\Delta t_{\\text{crit}, n}$，其中 $s$ 是安全系数（$0  s  1$）。\n\n总体算法如下：\n1.  初始化节点位置、集中质量 $\\mathbf{m}$、初始位移 $\\mathbf{d}_0$ 和初始速度 $\\mathbf{v}_0$。\n2.  计算初始加速度 $\\mathbf{a}_0 = -\\mathbf{M}^{-1}\\mathbf{f}_{\\text{int}}(\\mathbf{d}_0)$。\n3.  根据 $\\mathbf{d}_0$ 中的应变计算初始临界时间步长 $\\Delta t_{\\text{crit}, 0}$。令 $\\Delta t_0 = s \\cdot \\Delta t_{\\text{crit}, 0}$。\n4.  执行启动步骤：$\\mathbf{v}_{-1/2} = \\mathbf{v}_0 - \\mathbf{a}_0 \\Delta t_0/2$。\n5.  初始化一个列表，用于存储所有遇到的临界时间步长，以 $\\Delta t_{\\text{crit}, 0}$ 开始。\n6.  对时间步 $n=0, 1, 2, \\dots$ 进行循环，直到总时间 $t$ 达到最终时间 $T$：\n    a. 根据 $\\mathbf{d}_n$ 的应变确定当前最大波速 $c_{\\max, n}$。\n    b. 计算临界时间步长 $\\Delta t_{\\text{crit}, n} = h / c_{\\max, n}$ 并记录它。\n    c. 设置时间步长 $\\Delta t_n = s \\cdot \\Delta t_{\\text{crit}, n}$，如有必要则进行调整以确保正好在 $T$ 时刻结束。\n    d. 将速度更新到下一个半步：$\\mathbf{v}_{n+1/2} = \\mathbf{v}_{n-1/2} + \\mathbf{a}_n \\Delta t_n$。\n    e. 将位移更新到下一个完整步：$\\mathbf{d}_{n+1} = \\mathbf{d}_n + \\mathbf{v}_{n+1/2} \\Delta t_n$。\n    f. 强施加狄利克雷边界条件：$d_{0, n+1} = 0$，$d_{N, n+1} = 0$。\n    g. 计算新的内力 $\\mathbf{f}_{\\text{int}}(\\mathbf{d}_{n+1})$ 和加速度 $\\mathbf{a}_{n+1}$。强施加 $a_{0, n+1}=a_{N, n+1}=0$。\n    h. 推进时间 $t_{n+1} = t_n + \\Delta t_n$。\n7.  模拟结束后，报告记录的临界时间步长列表中的最小值。\n这个过程将为四个测试用例中的每一个实现。", "answer": "```python\nimport numpy as np\n\ndef run_simulation(E, alpha, rho, L, A, N, T, u_amp, s):\n    \"\"\"\n    Solves the 1D nonlinear elastodynamics problem for one set of parameters.\n\n    Args:\n        E (float): Reference modulus.\n        alpha (float): Nonlinearity coefficient.\n        rho (float): Mass density.\n        L (float): Bar length.\n        A (float): Cross-sectional area.\n        N (int): Number of finite elements.\n        T (float): Final simulation time.\n        u_amp (float): Amplitude of initial displacement.\n        s (float): CFL safety factor.\n\n    Returns:\n        float: The minimum encountered critical time step.\n    \"\"\"\n    \n    # 1. Discretization and Material Properties\n    h = L / N\n    num_nodes = N + 1\n    x_nodes = np.linspace(0, L, num_nodes)\n\n    # Lumped mass vector\n    m_lumped = np.full(num_nodes, rho * A * h)\n    m_lumped[0] = rho * A * h / 2.0\n    m_lumped[-1] = rho * A * h / 2.0\n    \n    # Pre-calculate inverse of mass for acceleration computation\n    m_inv = 1.0 / m_lumped\n    m_inv[0] = 0.0  # Boundary nodes have prescribed motion (zero acceleration)\n    m_inv[-1] = 0.0\n\n    # Helper functions for acceleration and wave speed\n    def compute_acceleration(d_vec):\n        strains = (d_vec[1:] - d_vec[:-1]) / h\n        stresses = E * strains + alpha * strains**3\n        \n        f_int = np.zeros(num_nodes)\n        # Internal forces on interior nodes\n        f_int[1:-1] = A * (stresses[:-1] - stresses[1:])\n        \n        return -f_int * m_inv\n\n    def compute_max_wavespeed(d_vec):\n        strains = (d_vec[1:] - d_vec[:-1]) / h\n        # Tangent modulus E_t = E + 3*alpha*epsilon^2\n        tangent_moduli = E + 3.0 * alpha * strains**2\n        \n        if np.any(tangent_moduli = 0):\n            # This check is for robustness; problem statement assumes E_t > 0\n            raise ValueError(\"Non-positive tangent modulus encountered. Problem is no longer hyperbolic.\")\n            \n        wave_speeds_sq = tangent_moduli / rho\n        return np.sqrt(np.max(wave_speeds_sq))\n\n    # 2. Initial Conditions\n    d = u_amp * np.sin(np.pi * x_nodes / L)\n    v = np.zeros(num_nodes)\n    \n    d[0], d[-1] = 0.0, 0.0 # B.C.\n\n    # 3. Kick-start the central difference scheme\n    a = compute_acceleration(d)\n    \n    c_max_initial = compute_max_wavespeed(d)\n    dt_crit_initial = h / c_max_initial\n    dt = s * dt_crit_initial\n\n    # v at step -1/2 for the leapfrog integrator\n    v_half = v - a * dt / 2.0\n    \n    # 4. Time-stepping loop\n    t = 0.0\n    critical_dt_history = [dt_crit_initial]\n    \n    a_curr = a\n\n    while t  T:\n        # Determine current time step\n        c_max = compute_max_wavespeed(d)\n        dt_crit = h / c_max\n        critical_dt_history.append(dt_crit)\n        \n        dt = s * dt_crit\n        if t + dt > T:\n            dt = T - t\n\n        # Leapfrog integration step\n        v_half = v_half + a_curr * dt\n        d = d + v_half * dt\n        \n        # Enforce boundary conditions strongly\n        d[0], d[-1] = 0.0, 0.0\n\n        a_curr = compute_acceleration(d)\n        t += dt\n\n    return min(critical_dt_history)\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # (E, alpha, rho, L, A, N, T, u_amp, s)\n    test_cases = [\n        (2.10e11, 0.0, 7.80e3, 1.0, 1.0, 50, 2.0e-4, 1.0e-6, 0.9),\n        (1.0e7, 1.0e12, 1.0e3, 1.0, 1.0, 100, 2.0e-3, 5.0e-3, 0.9),\n        (1.0e7, -5.0e10, 1.0e3, 1.0, 1.0, 80, 1.0e-3, 1.0e-3, 0.9),\n        (1.0e9, 0.0, 2.0e3, 1.0, 1.0, 2, 1.0e-3, 1.0e-4, 0.9),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(results)\n\nsolve()\n\n```", "id": "2557122"}]}