{"hands_on_practices": [{"introduction": "牛顿-拉夫逊方法的二次收敛性依赖于一致性切线刚度矩阵 ($K_T$) 的正确实现。推导或编码中的一个微小错误都可能导致难以调试的缓慢收敛或发散。本实践将指导您实现一个“切线检验” [@problem_id:2583316]，它通过有限差分将解析切线矩阵与数值近似值进行比较。这项验证是开发稳健的非线性有限元代码不可或缺的技能。", "problem": "考虑一个具有线性形函数和非线性本构关系的双节点一维杆有限元。假设所有量均为无量纲。设节点位移向量为 $u \\in \\mathbb{R}^2$，单元长度为 $L  0$，横截面积为 $A  0$。对于该单元，Green-Lagrange 应变简化为一个常工程应变 $\\varepsilon = B u$，其中常应变-位移矩阵为 $B = \\left[-\\dfrac{1}{L}, \\dfrac{1}{L}\\right]$。Cauchy 应力由光滑非线性定律 $\\sigma(\\varepsilon) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^3$ 建模，其中 $E  0$ 是一个线性刚度参数，$\\alpha \\ge 0$ 控制非线性程度。内力向量由虚功原理给出，$f_{\\mathrm{int}}(u) = \\int_{0}^{L} B^\\mathsf{T} \\sigma(\\varepsilon)\\, A\\, \\mathrm{d}x$，残差为 $R(u) = f_{\\mathrm{int}}(u) - f_{\\mathrm{ext}}$，其中 $f_{\\mathrm{ext}}\\in\\mathbb{R}^2$ 是外部节点荷载向量。求解 $R(u)=0$ 的 Newton-Raphson 方法使用一致切线（雅可比矩阵）$K_T(u) = \\dfrac{\\partial R}{\\partial u}(u)$。\n\n您的任务是编写一个程序，实现一个单元测试，通过与 $R(u)$ 在随机扰动方向下的中心有限差分方向导数进行比较，来验证切线 $K_T(u)$ 的一致性。该测试必须使用一个可复现的随机方向和一个理论上合理的步长。具体来说：\n\n- 从上述定义出发，仅利用双节点线性单元的 $B$ 为常数、$\\varepsilon = B u$、$f_{\\mathrm{int}}(u) = \\int_{0}^{L} B^\\mathsf{T} \\sigma(\\varepsilon)\\, A\\, \\mathrm{d}x$ 和 $\\sigma(\\varepsilon) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^3$ 这些事实，推导出用 $E$、$\\alpha$、$A$、$L$ 和 $u$ 表示的 $R(u)$ 和 $K_T(u)$。\n- 实现一个形式为\n$$\n\\frac{R(u + h\\,p) - R(u - h\\,p)}{2\\,h} \\approx K_T(u)\\,p,\n$$\n的中心有限差分检验，其中 $p \\in \\mathbb{R}^2$ 是用固定种子生成的随机单位向量（方向），$h  0$ 是根据浮点误差分析选择的步长。使用相对误差\n$$\ne = \\frac{\\left\\| \\frac{R(u + h\\,p) - R(u - h\\,p)}{2\\,h} - K_T(u)\\,p \\right\\|_2}{\\max\\left(1,\\;\\left\\| K_T(u)\\,p \\right\\|_2\\right)}\n$$\n如果对于指定的相对容差 $\\text{rtol}$ 有 $e \\le \\text{rtol}$，则声明测试通过。\n- 基于标准的中心差分截断误差与舍入误差的平衡来选择 $h$，并根据浮点机器精度 $\\varepsilon_{\\mathrm{mach}}$ 和残差的预期曲率尺度来证明您对 $h$ 和 $\\text{rtol}$ 的选择是合理的。\n\n假设量是无量纲的，如果出现任何角度，则默认为弧度（此处未使用角度）。使用以下测试套件（每个案例提供 $(E,\\alpha,A,L,u,f_{\\mathrm{ext}})$），其中所有数字都是无量纲的：\n\n- 案例 A（线性理想情况）：$E = 100$，$\\alpha = 0$， $A = 1$， $L = 1$， $u = [\\,0.2,\\,0.8\\,]^\\top$， $f_{\\mathrm{ext}} = [\\,0,\\,0\\,]^\\top$。\n- 案例 B（中等非线性）：$E = 200$，$\\alpha = 50$， $A = 2$， $L = 3$， $u = [\\,0.01,\\,0.03\\,]^\\top$， $f_{\\mathrm{ext}} = [\\,1,\\,-1\\,]^\\top$。\n- 案例 C（强非线性及更大幅值的应变）：$E = 10$，$\\alpha = 2000$， $A = 0.8$， $L = 1.5$， $u = [\\,0.3,\\,-0.2\\,]^\\top$， $f_{\\mathrm{ext}} = [\\,-0.5,\\,0.2\\,]^\\top$。\n- 案例 D（零位移）：$E = 150$，$\\alpha = 500$， $A = 1.2$， $L = 2.5$， $u = [\\,0,\\,0\\,]^\\top$， $f_{\\mathrm{ext}} = [\\,0,\\,0\\,]^\\top$。\n\n使用固定的随机种子，以使每次运行时随机方向 $p$ 都相同。对所有案例使用单一的相对容差 $\\text{rtol}$，并通过分析证明其合理性。您的程序必须为每个案例输出一个布尔结果，指示测试是否通过。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，“[True,False,True,True]”）。", "solution": "我们从具有线性形函数的双节点一维杆单元的虚功原理开始。常应变-位移矩阵为 $B = \\left[-\\dfrac{1}{L}, \\dfrac{1}{L}\\right]$，因此应变为 $\\varepsilon = B u$。本构关系为 $\\sigma(\\varepsilon) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^3$。内力遵循虚功原理的表述\n$$\nf_{\\mathrm{int}}(u) \\equiv \\int_0^L B^\\mathsf{T}\\,\\sigma(\\varepsilon)\\,A\\,\\mathrm{d}x.\n$$\n对于一个线性双节点单元，$B$ 和 $\\varepsilon$ 在整个单元上是常数，因此积分简化为\n$$\nf_{\\mathrm{int}}(u) = B^\\mathsf{T}\\,\\sigma(\\varepsilon)\\,A\\, \\int_0^L \\mathrm{d}x = B^\\mathsf{T}\\,\\sigma(\\varepsilon)\\,A\\,L.\n$$\n因此，残差为\n$$\nR(u) = f_{\\mathrm{int}}(u) - f_{\\mathrm{ext}} = B^\\mathsf{T}\\,\\sigma(Bu)\\,A\\,L - f_{\\mathrm{ext}}.\n$$\n为了构成一致切线，我们将 $R(u)$ 对 $u$ 求导。注意到 $R(u)$ 仅通过 $\\sigma(Bu)$ 依赖于 $u$，我们应用链式法则：\n$$\nK_T(u) \\equiv \\frac{\\partial R}{\\partial u}(u) = B^\\mathsf{T}\\,\\frac{\\mathrm{d}\\sigma}{\\mathrm{d}\\varepsilon}\\bigg|_{\\varepsilon=Bu}\\,B\\,A\\,L.\n$$\n由于 $\\sigma(\\varepsilon) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^3$，其导数为\n$$\n\\frac{\\mathrm{d}\\sigma}{\\mathrm{d}\\varepsilon} = E + 3\\,\\alpha\\,\\varepsilon^2.\n$$\n因此 $2\\times 2$ 的切线矩阵为\n$$\nK_T(u) = \\left(E + 3\\,\\alpha\\,(Bu)^2\\right)\\,A\\,L\\,\\left(B^\\mathsf{T} B\\right).\n$$\n当 $B = \\left[-\\dfrac{1}{L}, \\dfrac{1}{L}\\right]$ 时，我们有\n$$\nB^\\mathsf{T} B = \n\\begin{bmatrix}\n\\frac{1}{L^2}  -\\frac{1}{L^2} \\\\\n-\\frac{1}{L^2}  \\frac{1}{L^2}\n\\end{bmatrix},\n$$\n所以明确地\n$$\nK_T(u) = \\left(E + 3\\,\\alpha\\,\\varepsilon^2\\right)\\,A\\,\\frac{1}{L}\\,\n\\begin{bmatrix}\n1  -1\\\\\n-1  1\n\\end{bmatrix},\n\\quad \\text{with} \\quad \\varepsilon = \\frac{u_2 - u_1}{L}.\n$$\n\n为了验证 $K_T(u)$ 的一致性，我们将其与 $R(u)$ 的中心有限差分方向导数进行比较。对于单位方向 $p \\in \\mathbb{R}^2$ 和步长 $h > 0$，中心差分近似为\n$$\nD_h R(u; p) \\equiv \\frac{R(u + h\\,p) - R(u - h\\,p)}{2\\,h}.\n$$\n通过将 $R$ 在 $u$ 点沿方向 $p$ 进行泰勒展开，可以表明中心差分公式会消去展开式中的偶数阶导数项，从而得出\n$$\nD_h R(u; p) = K_T(u)\\,p + \\mathcal{O}(h^2).\n$$\n在浮点运算中，相消和舍入会引入一个阶为 $\\mathcal{O}\\!\\left(\\frac{\\varepsilon_{\\mathrm{mach}}}{h}\\right)$ 的额外误差项，其中 $\\varepsilon_{\\mathrm{mach}}$ 是机器精度。因此，总误差的行为类似于\n$$\n\\|D_h R(u; p) - K_T(u)\\,p\\|_2 \\approx C_1\\,h^2 + C_2\\,\\frac{\\varepsilon_{\\mathrm{mach}}}{h},\n$$\n其中 $C_1$ 和 $C_2$ 是由高阶导数和幅值决定的、与问题相关的常数。平衡这些项表明，选择 $h$ 的量级应为 $h \\sim \\varepsilon_{\\mathrm{mach}}^{1/3}$，并可附加一个反映 $\\|u\\|_2$ 的比例因子。因此我们选择\n$$\nh = \\varepsilon_{\\mathrm{mach}}^{1/3}\\,\\max\\!\\left(1,\\;\\|u\\|_2\\right),\n$$\n这可以在不同位移幅值的案例中同时控制截断误差和舍入误差。\n\n我们测量相对误差\n$$\ne = \\frac{\\left\\| D_h R(u;p) - K_T(u)\\,p \\right\\|_2}{\\max\\left(1,\\;\\left\\| K_T(u)\\,p \\right\\|_2\\right)},\n$$\n如果 $e \\le \\text{rtol}$ 则声明通过。对于双精度浮点数，$\\varepsilon_{\\mathrm{mach}} \\approx 2.22\\times 10^{-16}$，所以 $\\varepsilon_{\\mathrm{mach}}^{1/3} \\approx 6\\times 10^{-6}$。在纯线性情况下，中心差分在精确算术中是精确的，观测到的误差受舍入误差限制，通常接近 $\\mathcal{O}(10^{-11})$ 或更小。在非线性情况下，截断项与 $h^2$ 和一个由高阶导数决定的曲率大小成比例。此处 $\\sigma''(\\varepsilon) = 6\\,\\alpha\\,\\varepsilon$，因此对于中等应变和高达 2000 的 $\\alpha$ 值，当 $h \\approx 6\\times 10^{-6}$ 时，截断项贡献的保守界在相对意义上约为 $10^{-7}$ 到 $10^{-8}$，具体取决于 $K_T(u)\\,p$ 的大小。为了在所提供的测试套件中保持鲁棒性，包括具有更大 $|\\varepsilon|$ 的强非线性情况，我们设定一个单一容差\n$$\n\\text{rtol} = 10^{-6},\n$$\n这可以轻松地容纳最坏情况下的截断估计，同时又足够严格以检测不一致性。\n\n程序中实现的算法步骤：\n- 对于每个测试案例，解析 $(E,\\alpha,A,L,u,f_{\\mathrm{ext}})$。\n- 定义 $B = \\left[-\\dfrac{1}{L}, \\dfrac{1}{L}\\right]$，计算 $\\varepsilon = B u$，计算 $\\sigma(\\varepsilon) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^3$，然后计算 $R(u) = B^\\mathsf{T}\\,\\sigma(\\varepsilon)\\,A\\,L - f_{\\mathrm{ext}}$。\n- 计算 $K_T(u) = B^\\mathsf{T}\\,(E + 3\\,\\alpha\\,\\varepsilon^2)\\,B\\,A\\,L$。\n- 使用固定种子生成一个可复现的随机方向 $p$ 并将其归一化为单位长度。\n- 选择 $h = \\varepsilon_{\\mathrm{mach}}^{1/3}\\,\\max(1,\\|u\\|_2)$。\n- 计算 $D_h R(u;p)$ 和相对误差 $e$，并检查 $e \\le \\text{rtol}$。\n- 为每个案例在单行中输出一个布尔值，并用方括号列表形式表示。\n\n最终输出是像“[True,True,True,True]”这样的一行。这个单元测试设计通过一个精度受控的有限差分检验来验证 Newton-Raphson 一致切线 $K_T(u)$，其容差的合理性基于浮点极限和截断误差分析。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef residual(u, E, alpha, A, L, f_ext):\n    \"\"\"\n    Compute residual R(u) = f_int(u) - f_ext for a 2-node 1D bar element\n    with nonlinear constitutive law sigma = E*eps + alpha*eps^3.\n    \"\"\"\n    # B = [-1/L, 1/L]\n    B = np.array([-1.0 / L, 1.0 / L])\n    eps = float(B @ u)\n    sigma = E * eps + alpha * (eps ** 3)\n    f_int = (A * L) * (B[:, None] * sigma)  # B^T * sigma * A * L; shape (2,1)\n    # Convert to 1D array and subtract external load\n    return f_int.ravel() - f_ext\n\ndef tangent(u, E, alpha, A, L):\n    \"\"\"\n    Compute consistent tangent K_T(u) = B^T * (d sigma/d eps) * B * A * L\n    where d sigma/d eps = E + 3*alpha*eps^2.\n    \"\"\"\n    B = np.array([-1.0 / L, 1.0 / L])\n    eps = float(B @ u)\n    dsig = E + 3.0 * alpha * (eps ** 2)\n    K = (A * L) * dsig * np.outer(B, B)\n    return K\n\ndef central_diff_check(u, params, rng, rtol):\n    \"\"\"\n    Perform central difference directional derivative check:\n    (R(u+h p) - R(u-h p))/(2h) ~ K(u) p\n    Returns True if relative error = rtol.\n    \"\"\"\n    E, alpha, A, L, f_ext = params\n    # Random direction p, normalized\n    p = rng.standard_normal(size=2)\n    nrm = np.linalg.norm(p)\n    if nrm == 0.0:\n        p = np.array([1.0, 0.0])\n    else:\n        p = p / nrm\n\n    # Step size selection: h = eps^(1/3) * max(1, ||u||)\n    eps_mach = np.finfo(float).eps\n    h_base = eps_mach ** (1.0 / 3.0)\n    scale = max(1.0, float(np.linalg.norm(u)))\n    h = h_base * scale\n\n    Ru_ph = residual(u + h * p, E, alpha, A, L, f_ext)\n    Ru_mh = residual(u - h * p, E, alpha, A, L, f_ext)\n    cd = (Ru_ph - Ru_mh) / (2.0 * h)\n\n    K = tangent(u, E, alpha, A, L)\n    Kp = K @ p\n\n    num = np.linalg.norm(cd - Kp)\n    den = max(1.0, np.linalg.norm(Kp))\n    rel_err = num / den\n    return rel_err = rtol\n\ndef solve():\n    # Define test cases as specified in the problem statement.\n    # Each case: (E, alpha, A, L, u, f_ext)\n    test_cases = [\n        (100.0, 0.0, 1.0, 1.0, np.array([0.2, 0.8]), np.array([0.0, 0.0])),            # Case A\n        (200.0, 50.0, 2.0, 3.0, np.array([0.01, 0.03]), np.array([1.0, -1.0])),         # Case B\n        (10.0, 2000.0, 0.8, 1.5, np.array([0.3, -0.2]), np.array([-0.5, 0.2])),         # Case C\n        (150.0, 500.0, 1.2, 2.5, np.array([0.0, 0.0]), np.array([0.0, 0.0])),           # Case D\n    ]\n\n    # Relative tolerance justified by truncation and roundoff analysis.\n    rtol = 1e-6\n\n    # Fixed random seed for reproducibility.\n    rng = np.random.default_rng(123456)\n\n    results = []\n    for (E, alpha, A, L, u, f_ext) in test_cases:\n        params = (E, alpha, A, L, f_ext)\n        ok = central_diff_check(u, params, rng, rtol)\n        results.append(ok)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2583316"}, {"introduction": "在实际应用中，牛顿法有时会表现出收敛缓慢，即所谓的“停滞”现象，这可能导致算法过早终止。仅仅观察残差范数的缓慢下降不足以做出正确诊断。本实践提供了一组迭代数据，要求您不仅通过残差，还通过分析残差向量与牛顿更新步之间的夹角，来判断终止是否合理 [@problem_id:2583291]。这个练习将磨练您解读求解器行为和诊断复杂收敛问题的能力。", "problem": "您正在求解一个非线性有限元平衡问题，其定义为寻找一个位移向量 $u \\in \\mathbb{R}^n$，使得残差 $R(u) = f_{\\mathrm{int}}(u) - f_{\\mathrm{ext}}$ 满足 $R(u) = 0$，其中 $f_{\\mathrm{int}}(u)$ 是内力向量，$f_{\\mathrm{ext}}$ 是外载荷向量。牛顿-拉夫逊 (NR) 方法通过求解线性化系统 $K_T(u_k)\\,\\Delta u_k = -R(u_k)$，然后进行更新 $u_{k+1} = u_k + \\Delta u_k$ 来更新 $u_k$，其中 $K_T(u_k)$ 是切线刚度矩阵。假设在报告的迭代步中，$K_T(u_k)$ 是对称正定的，并且没有使用线搜索或信赖域全局化方法。\n\n一个代码由于“停滞”规则而提前终止：如果相对残差在连续两次迭代中的减小量小于 $20\\%$，它就会停止。在某一次运行中，终止发生在 $k=2$ 处。在 $k=0,1,2$ 处测得的量为：\n- 在 $k=0$ 处：$\\|R(u_0)\\| = 10.0$，$\\|\\Delta u_0\\| = 0.90$，$R(u_0)^{\\mathsf{T}}\\Delta u_0 = -1.70$。\n- 在 $k=1$ 处：$\\|R(u_1)\\| = 8.50$，$\\|\\Delta u_1\\| = 0.70$，$R(u_1)^{\\mathsf{T}}\\Delta u_1 = -4.165$。\n- 在 $k=2$ 处：$\\|R(u_2)\\| = 7.40$，$\\|\\Delta u_2\\| = 0.78$，$R(u_2)^{\\mathsf{T}}\\Delta u_2 = -5.68$。\n\n考虑 $\\|R(u_k)\\|$ 的下降速率以及 $R(u_k)$ 和 $\\Delta u_k$ 之间的夹角 $\\phi_k$，其定义为 $\\cos \\phi_k = \\dfrac{R(u_k)^{\\mathsf{T}}\\Delta u_k}{\\|R(u_k)\\|\\,\\|\\Delta u_k\\|}$。严格基于这些数据以及应用于具有对称正定切线刚度的非线性有限元的牛顿-拉夫逊方法的第一性原理特性，哪种诊断最合理？\n\nA. 在 $k=2$ 处终止为时过早：尽管到目前为止残差下降缓慢，但夹角越来越钝以及 $\\cos \\phi_2$ 接近 $-1$ 表明牛顿步越来越接近与 $R(u_k)$ 反平行；预计再进行一次迭代将使 $\\|R(u_k)\\|$ 大幅下降。\n\nB. 在 $k=2$ 处终止并不过早：$R(u_k)^{\\mathsf{T}}\\Delta u_k$ 为负最多只能保证单调线性下降，因此继续迭代不会显著改善收敛性。\n\nC. 在 $k=2$ 处终止并不过早：因为对所有 $k$ 都有 $R(u_k)^{\\mathsf{T}}\\Delta u_k  0$，迭代步沿着与 $R(u_k)$ 相反的方向移动，这标志着发散；算法应被停止。\n\nD. 在 $k=2$ 处终止是合理的，因为出现了停滞：角度与牛顿-拉夫逊方法无关，因为牛顿步不是残差范数的下降方向，所以只应考虑残差的下降情况。", "solution": "对问题陈述进行验证。\n\n**第 1 步：提取已知条件**\n-   平衡问题是寻找一个位移向量 $u \\in \\mathbb{R}^n$，使得残差 $R(u) = f_{\\mathrm{int}}(u) - f_{\\mathrm{ext}} = 0$。\n-   迭代方法是牛顿-拉夫逊 (NR) 方法。\n-   NR 更新步通过求解线性系统 $K_T(u_k)\\,\\Delta u_k = -R(u_k)$，然后进行更新 $u_{k+1} = u_k + \\Delta u_k$ 来定义。\n-   $K_T(u_k)$ 是在迭代步 $u_k$ 处的切线刚度矩阵。\n-   假设：对于报告的迭代步，$K_T(u_k)$ 是一个对称正定 (SPD) 矩阵。\n-   假设：未使用线搜索或信赖域全局化（即采用完整步长）。\n-   终止规则：如果相对残差在连续两次迭代中的减小量小于 $20\\%$，则代码停止。\n-   终止发生在迭代 $k=2$ 处。\n-   在 $k=0$ 处的数据：$\\|R(u_0)\\| = 10.0$，$\\|\\Delta u_0\\| = 0.90$，$R(u_0)^{\\mathsf{T}}\\Delta u_0 = -1.70$。\n-   在 $k=1$ 处的数据：$\\|R(u_1)\\| = 8.50$，$\\|\\Delta u_1\\| = 0.70$，$R(u_1)^{\\mathsf{T}}\\Delta u_1 = -4.165$。\n-   在 $k=2$ 处的数据：$\\|R(u_2)\\| = 7.40$，$\\|\\Delta u_2\\| = 0.78$，$R(u_2)^{\\mathsf{T}}\\Delta u_2 = -5.68$。\n-   $R(u_k)$ 和 $\\Delta u_k$ 之间的夹角 $\\phi_k$ 定义为 $\\cos \\phi_k = \\dfrac{R(u_k)^{\\mathsf{T}}\\Delta u_k}{\\|R(u_k)\\|\\,\\|\\Delta u_k\\|}$。\n\n**第 2 步：使用提取的已知条件进行验证**\n该问题描述了牛顿-拉夫逊方法在通过有限元方法构建的非线性固体力学问题中的标准应用。这些概念、方程和假设（$K_T$ 是对称正定的）在该领域是标准的。所提供的数据是数值性的且自洽的。问题是客观的，要求根据所提供的数据和既定原则进行诊断。问题具有科学依据，提法得当，且客观。未发现任何缺陷。\n\n**第 3 步：结论和措施**\n问题有效。将推导解答。\n\n**推导与分析**\n\n首先，我们验证所述的终止条件是否已满足。终止规则要求相对残差减小量 $1 - \\frac{\\|R(u_{k+1})\\|}{\\|R(u_k)\\|}$ 在连续两次迭代中小于 $0.20$。\n\n对于第一次迭代（$k=0 \\to k=1$）：\n下降因子为 $\\frac{\\|R(u_1)\\|}{\\|R(u_0)\\|} = \\frac{8.50}{10.0} = 0.85$。\n相对减小量为 $1 - 0.85 = 0.15$，即 $15\\%$。由于 $15\\%  20\\%$，这是第一次满足停滞标准的迭代。\n\n对于第二次迭代（$k=1 \\to k=2$）：\n下降因子为 $\\frac{\\|R(u_2)\\|}{\\|R(u_1)\\|} = \\frac{7.40}{8.50} \\approx 0.8706$。\n相对减小量为 $1 - 0.8706 \\approx 0.1294$，即约 $12.9\\%$。由于 $12.9\\%  20\\%$，这是第二次连续满足停滞标准的迭代。\n因此，在 $k=2$ 处终止符合规定的规则。问题是这次终止在科学上是合理的还是为时过早。\n\n接下来，我们使用所提供的数据分析收敛行为。残差 $R(u_k)$ 和牛顿步 $\\Delta u_k$ 之间的夹角 $\\phi_k$ 提供了关键的洞见。我们计算每次迭代的 $\\cos \\phi_k$。\n\n对于 $k=0$：\n$$ \\cos \\phi_0 = \\frac{R(u_0)^{\\mathsf{T}}\\Delta u_0}{\\|R(u_0)\\|\\,\\|\\Delta u_0\\|} = \\frac{-1.70}{10.0 \\times 0.90} = \\frac{-1.70}{9.0} \\approx -0.1889 $$\n\n对于 $k=1$：\n$$ \\cos \\phi_1 = \\frac{R(u_1)^{\\mathsf{T}}\\Delta u_1}{\\|R(u_1)\\|\\,\\|\\Delta u_1\\|} = \\frac{-4.165}{8.50 \\times 0.70} = \\frac{-4.165}{5.95} = -0.7 $$\n\n对于 $k=2$：\n$$ \\cos \\phi_2 = \\frac{R(u_2)^{\\mathsf{T}}\\Delta u_2}{\\|R(u_2)\\|\\,\\|\\Delta u_2\\|} = \\frac{-5.68}{7.40 \\times 0.78} = \\frac{-5.68}{5.772} \\approx -0.9841 $$\n\n计算揭示了一个强烈的趋势：$\\cos \\phi_k$ 逐渐趋近于 $-1$。这意味着夹角 $\\phi_k$ 正在趋近 $\\pi$ 弧度（$180^\\circ$），牛顿步向量 $\\Delta u_k$ 变得越来越与残差向量 $R(u_k)$ 反平行。\n\n让我们从第一性原理分析其意义。\n在保守系统中，残差是势能泛函 $\\Pi(u)$ 的梯度，因此 $R(u) = \\nabla \\Pi(u)$。势能的最速下降方向是 $-\\nabla \\Pi(u) = -R(u)$。牛顿步由 $\\Delta u_k = -K_T(u_k)^{-1} R(u_k)$ 给出。$\\cos \\phi_k \\to -1$ 的趋势表明，牛顿方向 $\\Delta u_k$ 正在与最速下降方向 $-R(u_k)$ 对齐。这表明牛顿步正在成为一个几乎理想的最小化势能的搜索方向。虽然最初的几步收敛缓慢（可能是由于搜索方向不佳，如 $\\cos \\phi_0$ 的小幅值所示），但搜索方向的质量显著提高。在接近最优的方向上采取一步，极有可能使残差大幅减小，特别是因为牛顿法还提供了具有物理意义的步长。鉴于搜索方向质量的显著改善，到目前为止的缓慢收敛并不能预示未来的性能。简单的停滞检查忽略了这一关键信息。\n\n**选项评估**\n\nA. **在 $k=2$ 处终止为时过早：尽管到目前为止残差下降缓慢，但夹角越来越钝以及 $\\cos \\phi_2$ 接近 $-1$ 表明牛顿步越来越接近与 $R(u_k)$ 反平行；预计再进行一次迭代将使 $\\|R(u_k)\\|$ 大幅下降。**\n该陈述正确地指出了角度变钝且 $\\cos \\phi_k \\to -1$ 的趋势。它正确地将其解释为牛顿步 $\\Delta u_k$ 变得几乎与残差 $R(u_k)$ 反平行。根据上述分析，这种对齐意味着高质量的搜索方向，因此可以合理地预期下一步残差将大幅减小。因此，终止为时过早的结论是完全合理的。\n结论是 **正确**。\n\nB. **在 $k=2$ 处终止并不过早：$R(u_k)^{\\mathsf{T}}\\Delta u_k$ 为负最多只能保证单调线性下降，因此继续迭代不会显著改善收敛性。**\n该陈述存在根本性错误。条件 $R(u_k)^{\\mathsf{T}}\\Delta u_k  0$ 是 $K_T(u_k)$ 对称正定假设的直接结果：$R(u_k)^{\\mathsf{T}}\\Delta u_k = R(u_k)^{\\mathsf{T}}(-K_T(u_k)^{-1} R(u_k)) = -R(u_k)^{\\mathsf{T}}K_T(u_k)^{-1} R(u_k)  0$。此条件意味着 $\\Delta u_k$ 是势能的下降方向。它是收敛的先决条件，而不是对其速率的限制。牛顿-拉夫逊方法以其在解附近的二次收敛速率而闻名，这比线性收敛快得多。声称此条件“最多”保证线性下降是错误的。\n结论是 **不正确**。\n\nC. **在 $k=2$ 处终止并不过早：因为对所有 $k$ 都有 $R(u_k)^{\\mathsf{T}}\\Delta u_k  0$，迭代步沿着与 $R(u_k)$ 相反的方向移动，这标志着发散；算法应被停止。**\n该陈述表明对下降方法有严重的误解。我们寻求找到使 $R(u)=0$ 的 $u$。当 $R(u_k) \\neq 0$ 时，我们必须采取一个试图减小残差的步长 $\\Delta u_k$。朝着“与 $R(u_k)$ 相反”的方向移动（即，在方向 $\\Delta u_k$上，其在 $R(u_k)$ 上的投影为负，意味着 $R(u_k)^{\\mathsf{T}}\\Delta u_k  0$），正是下降方法为达到（势能的）最小值所需要的。此条件是收敛的信号，而非发散的信号。\n结论是 **不正确**。\n\nD. **在 $k=2$ 处终止是合理的，因为出现了停滞：角度与牛顿-拉夫逊方法无关，因为牛顿步不是残差范数的下降方向，所以只应考虑残差的下降情况。**\n该陈述包含一个关键的谬误。牛顿步 $\\Delta u_k$ *是* 标量函数 $g(u) = \\frac{1}{2}\\|R(u)\\|^2 = \\frac{1}{2}R(u)^{\\mathsf{T}}R(u)$ 的一个下降方向。$g(u)$ 的梯度是 $\\nabla g(u) = (\\nabla R(u))^{\\mathsf{T}}R(u) = K_T(u)^{\\mathsf{T}}R(u)$。根据 $K_T$ 的对称性，$\\nabla g(u) = K_T(u)R(u)$。$g(u)$ 在 $u_k$ 处沿方向 $\\Delta u_k$ 的方向导数为：\n$$ (\\nabla g(u_k))^{\\mathsf{T}} \\Delta u_k = (K_T(u_k)R(u_k))^{\\mathsf{T}} \\Delta u_k = R(u_k)^{\\mathsf{T}} K_T(u_k)^{\\mathsf{T}} \\Delta u_k = R(u_k)^{\\mathsf{T}} (K_T(u_k) \\Delta u_k) $$\n使用 NR 方程 $K_T(u_k)\\Delta u_k = -R(u_k)$，我们得到：\n$$ (\\nabla g(u_k))^{\\mathsf{T}} \\Delta u_k = R(u_k)^{\\mathsf{T}} (-R(u_k)) = -\\|R(u_k)\\|^2 $$\n由于只要我们还未收敛，$\\|R(u_k)\\|^2  0$，所以方向导数是严格为负的。这证明了牛顿方向是残差范数的下降方向。声称它不是，因此角度无关紧要的说法是错误的。角度是搜索方向质量的关键指标。\n结论是 **不正确**。", "answer": "$$\\boxed{A}$$", "id": "2583291"}, {"introduction": "标准的荷载控制牛顿-拉夫逊法在遇到平衡路径上的极限点（如突跳或回弹现象）时会失效，因为在这些点上切线刚度矩阵会变得奇异。弧长法是一种先进的路径跟踪技术，旨在追踪此类复杂的平衡路径。本实践要求您手动执行一次 Crisfield 型弧长法的校正迭代，让您具体理解线性化的平衡方程和弧长约束是如何耦合和同时求解的 [@problem_id:2583322]。", "problem": "一个两杆桁架被建模为两个平行、共轴的轴向弹簧，它们连接一个刚性基座和一个具有单个广义位移自由度 $u$（向下为正）的顶部单节点。在小位移运动学下，每根杆 $i \\in \\{1,2\\}$ 都遵循非线性轴向力-伸长关系 $N_i(a_i) = k_i a_i + \\beta_i a_i^3$。因此，对于此单自由度构型，$a_1 = a_2 = u$，组集后的内节点力为 $f_{\\mathrm{int}}(u) = \\sum_{i=1}^{2} N_i(u)$。外荷载通过一个标量荷载因子 $\\lambda$ 乘以一个固定的参考荷载 $\\hat{P}$ 来施加，即 $f_{\\mathrm{ext}} = \\lambda \\hat{P}$。\n\n你将在 Crisfield 型球面弧长法中执行一次 Newton–Raphson 校正迭代。使用以下数据：\n- 本构参数：$k_1 = 2$， $k_2 = 1$， $\\beta_1 = 1$， $\\beta_2 = 0$。\n- 参考荷载：$\\hat{P} = 5$。\n- 在荷载步 $n \\to n+1$ 的当前迭代点：$(u_k,\\lambda_k) = (1.0,\\,0.5)$。\n- 上一个荷载步的最后收敛状态：$(u_n,\\lambda_n) = (0.7,\\,0.4)$。\n- 弧长参数：半径 $\\Delta s = 0.6$，荷载缩放 $\\alpha = 2$。\n\n从虚功原理及其有限元残差 $R(u,\\lambda) = f_{\\mathrm{int}}(u) - \\lambda \\hat{P}$ 出发，并采用球面弧长约束\n$$\ng(\\Delta u,\\Delta \\lambda) \\equiv \\Delta u^2 + \\alpha^2 \\Delta \\lambda^2 - \\Delta s^2 = 0,\n$$\n其中 $\\Delta u = u - u_n$ 和 $\\Delta \\lambda = \\lambda - \\lambda_n$，在围绕 $(u_k,\\lambda_k)$ 的单次校正迭代中执行以下操作：\n- 推导平衡方程的 Newton–Raphson 线性化形式，以获得校正量 $(\\delta u,\\delta \\lambda)$ 和残差 $R(u_k,\\lambda_k)$ 之间的关系。\n- 将弧长约束在 $(\\Delta u_k,\\Delta \\lambda_k) = (u_k - u_n,\\lambda_k - \\lambda_n)$ 处线性化，以获得关于 $(\\delta u,\\delta \\lambda)$ 的线性关系。\n- 组集得到的关于 $(\\delta u,\\delta \\lambda)$ 的 $2 \\times 2$ 线性系统并求解。\n\n将荷载因子的标量校正量 $\\delta \\lambda$ 作为你的最终答案。提供精确值，不要四舍五入。由于 $\\lambda$ 是无量纲的，因此不需要单位。", "solution": "该问题需要进行验证。\n\n**步骤1：提取已知条件**\n- 模型：具有单个自由度 $u$ 的两个平行轴向弹簧。\n- 第 i 根杆的本构律：$N_i(a_i) = k_i a_i + \\beta_i a_i^3$。\n- 运动学：$a_1 = a_2 = u$。\n- 内力：$f_{\\mathrm{int}}(u) = \\sum_{i=1}^{2} N_i(u)$。\n- 外力：$f_{\\mathrm{ext}} = \\lambda \\hat{P}$。\n- 残差：$R(u,\\lambda) = f_{\\mathrm{int}}(u) - \\lambda \\hat{P}$。\n- 弧长约束：$g(\\Delta u,\\Delta \\lambda) \\equiv \\Delta u^2 + \\alpha^2 \\Delta \\lambda^2 - \\Delta s^2 = 0$。\n- 增量定义：$\\Delta u = u - u_n$， $\\Delta \\lambda = \\lambda - \\lambda_n$。\n- 参数：\n  - $k_1 = 2$， $k_2 = 1$。\n  - $\\beta_1 = 1$， $\\beta_2 = 0$。\n  - $\\hat{P} = 5$。\n  - 当前迭代点（第 $k$ 次迭代）：$(u_k,\\lambda_k) = (1.0,\\,0.5)$。\n  - 最后收敛状态（第 $n$ 步）：$(u_n,\\lambda_n) = (0.7,\\,0.4)$。\n  - 弧长参数：$\\Delta s = 0.6$， $\\alpha = 2$。\n- 任务：为 $(\\delta u, \\delta \\lambda)$ 执行一次 Newton-Raphson 校正迭代，并报告 $\\delta \\lambda$。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据（关键）：** 该问题描述了一个经典的单自由度系统，该系统具有三次材料非线性，并使用 Newton-Raphson 方法结合 Crisfield 型球面弧长约束进行分析。这是计算非线性力学中的一个标准和基本课题。该公式在科学上是合理的。\n- **适定性：** 所有必要的数据和本构关系都已提供。目标明确陈述。该问题是自洽的，其结构可以为所求量产生唯一解，前提是系统的雅可比矩阵非奇异。\n- **客观性（关键）：** 该问题以精确的数学和工程术语陈述，没有任何主观性或模糊性。\n\n**步骤3：结论与行动**\n问题有效。我们继续进行求解。\n\n校正迭代旨在寻找一个从当前迭代点 $(u_k, \\lambda_k)$ 到新迭代点 $(u_{k+1}, \\lambda_{k+1}) = (u_k + \\delta u, \\lambda_k + \\delta \\lambda)$ 的更新量 $(\\delta u, \\delta \\lambda)$。这个更新量通过线性化非线性控制方程组来确定，该方程组由平衡残差方程和弧长约束方程组成。\n\n首先，我们为给定系统构建具体的内力表达式。\n每根杆的力为 $N_1(u) = k_1 u + \\beta_1 u^3$ 和 $N_2(u) = k_2 u + \\beta_2 u^3$。\n代入给定参数：\n$N_1(u) = 2u + 1u^3 = 2u + u^3$。\n$N_2(u) = 1u + 0u^3 = u$。\n总内力是两力之和：\n$f_{\\mathrm{int}}(u) = N_1(u) + N_2(u) = (2u + u^3) + u = 3u + u^3$。\n\n平衡残差为 $R(u,\\lambda) = f_{\\mathrm{int}}(u) - \\lambda \\hat{P}$。\n使用给定参数，这变为：\n$R(u,\\lambda) = 3u + u^3 - 5\\lambda$。\n\nNewton-Raphson 方法将条件 $R(u_{k+1}, \\lambda_{k+1}) = 0$ 在当前迭代点 $(u_k, \\lambda_k)$ 附近线性化。\n$R(u_k + \\delta u, \\lambda_k + \\delta \\lambda) \\approx R(u_k, \\lambda_k) + \\frac{\\partial R}{\\partial u}\\bigg|_{(u_k, \\lambda_k)} \\delta u + \\frac{\\partial R}{\\partial \\lambda}\\bigg|_{(u_k, \\lambda_k)} \\delta \\lambda = 0$。\n这可以写成：\n$K_{T,k} \\delta u - \\hat{P} \\delta \\lambda = -R_k$，\n其中 $K_{T,k}$ 是在 $u_k$ 处的切线刚度，$R_k$ 是在 $(u_k, \\lambda_k)$ 处的残差。\n\n我们在 $(u_k, \\lambda_k) = (1.0, 0.5)$ 处计算必要的项：\n切线刚度是内力的导数：\n$K_T(u) = \\frac{d f_{\\mathrm{int}}}{du} = \\frac{d}{du}(3u + u^3) = 3 + 3u^2$。\n在 $u_k=1.0$ 处，刚度为 $K_{T,k} = 3 + 3(1.0)^2 = 6$。\n在当前迭代点的残差为：\n$R_k = R(1.0, 0.5) = 3(1.0) + (1.0)^3 - 5(0.5) = 3 + 1 - 2.5 = 1.5$。\n关于 $\\lambda$ 的导数是 $-\\hat{P} = -5$。\n代入这些值，线性化的平衡方程为：\n$6 \\delta u - 5 \\delta \\lambda = -1.5$。（方程1）\n\n接下来，我们线性化弧长约束方程。约束必须由更新后的状态 $(u_{k+1}, \\lambda_{k+1})$ 满足。相对于上一个收敛状态 $(u_n, \\lambda_n)$ 的增量为：\n$\\Delta u_{k+1} = u_{k+1} - u_n = (u_k - u_n) + \\delta u = \\Delta u_k + \\delta u$。\n$\\Delta \\lambda_{k+1} = \\lambda_{k+1} - \\lambda_n = (\\lambda_k - \\lambda_n) + \\delta \\lambda = \\Delta \\lambda_k + \\delta \\lambda$。\n约束为 $g(\\Delta u_{k+1}, \\Delta \\lambda_{k+1}) = (\\Delta u_k + \\delta u)^2 + \\alpha^2 (\\Delta \\lambda_k + \\delta \\lambda)^2 - \\Delta s^2 = 0$。\n我们将此方程对 $(\\delta u, \\delta \\lambda)$ 在 $(\\delta u, \\delta \\lambda)=(0,0)$ 附近进行线性化：\n$g_k + \\frac{\\partial g}{\\partial (\\delta u)}\\bigg|_k \\delta u + \\frac{\\partial g}{\\partial (\\delta \\lambda)}\\bigg|_k \\delta \\lambda = 0$。\n各项为：\n当前总增量：\n$\\Delta u_k = u_k - u_n = 1.0 - 0.7 = 0.3$。\n$\\Delta \\lambda_k = \\lambda_k - \\lambda_n = 0.5 - 0.4 = 0.1$。\n在当前迭代点计算的约束值为：\n$g_k = (\\Delta u_k)^2 + \\alpha^2 (\\Delta \\lambda_k)^2 - \\Delta s^2 = (0.3)^2 + (2)^2 (0.1)^2 - (0.6)^2 = 0.09 + 4(0.01) - 0.36 = 0.13 - 0.36 = -0.23$。\n偏导数为：\n$\\frac{\\partial g}{\\partial (\\delta u)}\\bigg|_k = 2(\\Delta u_k + \\delta u)|_{\\delta u=0} = 2\\Delta u_k = 2(0.3) = 0.6$。\n$\\frac{\\partial g}{\\partial (\\delta \\lambda)}\\bigg|_k = 2\\alpha^2(\\Delta \\lambda_k + \\delta \\lambda)|_{\\delta \\lambda=0} = 2\\alpha^2\\Delta \\lambda_k = 2(2)^2(0.1) = 2(4)(0.1) = 0.8$。\n线性化的约束方程为：\n$0.6 \\delta u + 0.8 \\delta \\lambda = -g_k = -(-0.23) = 0.23$。（方程2）\n\n我们现在得到一个关于 $(\\delta u, \\delta \\lambda)$ 的 $2 \\times 2$ 线性系统：\n1. $6 \\delta u - 5 \\delta \\lambda = -1.5$\n2. $0.6 \\delta u + 0.8 \\delta \\lambda = 0.23$\n\n为求解该系统，我们可以将方程2乘以10以消除小数表示：\n2'. $6 \\delta u + 8 \\delta \\lambda = 2.3$\n现在，我们从方程2'中减去方程1：\n$(6 \\delta u + 8 \\delta \\lambda) - (6 \\delta u - 5 \\delta \\lambda) = 2.3 - (-1.5)$。\n$8 \\delta \\lambda + 5 \\delta \\lambda = 2.3 + 1.5$。\n$13 \\delta \\lambda = 3.8$。\n求解 $\\delta \\lambda$：\n$\\delta \\lambda = \\frac{3.8}{13} = \\frac{38}{130} = \\frac{19}{65}$。\n\n所求量是荷载因子的标量校正量 $\\delta \\lambda$。", "answer": "$$\\boxed{\\frac{19}{65}}$$", "id": "2583322"}]}