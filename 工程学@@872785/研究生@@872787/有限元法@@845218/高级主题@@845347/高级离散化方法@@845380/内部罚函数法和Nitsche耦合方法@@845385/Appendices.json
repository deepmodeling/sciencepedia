{"hands_on_practices": [{"introduction": "在将内部罚方法或Nitsche方法付诸实践时，首要挑战在于正确构建离散格式中的界面积分项。这些项是连接不同单元、施加边界条件以及确保方法稳定性和一致性的核心。本练习旨在检验你对对称内部罚(SIPG)和Nitsche方法在界面上耦合公式的理解，特别是如何处理法向量的朝向、保证公式的对称性，并最终得到一个不依赖于特定网格几何细节的稳健实现。[@problem_id:2569501]", "problem": "考虑在多面体区域 $\\Omega \\subset \\mathbb{R}^d$ 上具有 Dirichlet 边界数据的标量扩散模型问题：\n$$\n-\\nabla \\cdot (\\kappa \\nabla u) = f \\quad \\text{in } \\Omega, \n\\qquad\nu = g \\quad \\text{on } \\Gamma_D = \\partial \\Omega,\n$$\n其中 $\\kappa(x) > 0$ 在一个形态规则的单纯形或六面体网格 $\\mathcal{T}_h$ 上是分片常数。令 $\\mathcal{F}_h^{\\mathrm{int}}$ 表示内部面的集合，$\\mathcal{F}_h^{\\mathrm{D}}$ 表示 $\\Gamma_D$ 上边界面的集合。考虑在 $\\mathcal{T}_h$ 上次数 $\\le p \\ge 1$ 的分片多项式组成的间断 Galerkin (DG) 有限元空间 $V_h$。\n\n面的实现约定。对于由单元 $K_L$ 和 $K_R$ 共享的每个内部面 $F \\in \\mathcal{F}_h^{\\mathrm{int}}$，存储一个从 $K_L$ 指向 $K_R$ 的任意但固定的单位法向量 $\\boldsymbol{n}_F$。定义 $u_L := u|_{K_L}$ 和 $u_R := u|_{K_R}$ 为在 $F$ 上的迹。定义标量跳跃和向量平均为\n$$\n[w] := u_L - u_R, \n\\qquad\n\\{\\boldsymbol{\\phi}\\} := \\tfrac{1}{2}\\left( \\boldsymbol{\\phi}_L + \\boldsymbol{\\phi}_R \\right),\n$$\n对于在 $F$ 上有良定义迹的任意向量场 $\\boldsymbol{\\phi}$。在边界-面 $F \\in \\mathcal{F}_h^{\\mathrm{D}}$ 上，令 $\\boldsymbol{n}$ 表示 $\\Omega$ 的外单位法向量，并使用相同的跳跃/平均记号，约定在边界-面上只有一个来自内部的迹。\n\n令 $h_F$ 表示面直径，并假设一个形式为 $\\eta_F \\simeq C_{\\mathrm{IP}} \\,\\overline{\\kappa}_F \\, p^2$ 的逐面罚参数，其中 $\\overline{\\kappa}_F$ 是一个依赖于网格和系数的正平均值（例如，在内部面上是算术平均 $\\overline{\\kappa}_F := \\tfrac{1}{2}(\\kappa|_{K_L}+\\kappa|_{K_R})$，在边界-面上是 $\\overline{\\kappa}_F := \\kappa|_K$），且 $C_{\\mathrm{IP}} > 0$ 是一个足够大的常数。在全文中，双线性和线性形式通过对单元体积项和面项求和来组装。\n\n问题。对于双线性形式 $a_h(\\cdot,\\cdot)$ 和线性形式 $\\ell_h(\\cdot)$ 的面贡献，以下哪种方案能在上述跳跃/平均约定下，为内部面上的对称内部罚 Galerkin (SIPG) 方法和 Dirichlet 边界-面上的 Nitsche 方法，产生一个方向无关、对称且伴随一致的耦合？\n\nA. 内部面 $F \\in \\mathcal{F}_h^{\\mathrm{int}}$:\n$$\na_F(u,v) \\;=\\; -\\int_F \\{\\kappa \\nabla u\\}\\cdot \\boldsymbol{n}_F \\,[v] \\;-\\; \\int_F \\{\\kappa \\nabla v\\}\\cdot \\boldsymbol{n}_F \\,[u] \\;+\\; \\int_F \\frac{\\eta_F}{h_F}\\,[u]\\,[v].\n$$\nDirichlet 边界-面 $F \\in \\mathcal{F}_h^{\\mathrm{D}}$ (Nitsche):\n$$\na_F(u,v) \\;=\\; -\\int_F \\kappa \\nabla u \\cdot \\boldsymbol{n}\\, v \\;-\\; \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, u \\;+\\; \\int_F \\frac{\\eta_F}{h_F}\\, u\\, v,\n$$\n$$\n\\ell_F(v) \\;=\\; \\int_F \\frac{\\eta_F}{h_F}\\, g\\, v \\;-\\; \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, g.\n$$\n\nB. 内部面 $F \\in \\mathcal{F}_h^{\\mathrm{int}}$:\n$$\na_F(u,v) \\;=\\; -\\int_F \\{\\kappa \\nabla u \\cdot \\boldsymbol{n}_{\\mathrm{out}}\\}\\,[v] \\;-\\; \\int_F \\{\\kappa \\nabla v \\cdot \\boldsymbol{n}_{\\mathrm{out}}\\}\\,[u] \\;+\\; \\int_F \\frac{\\eta_F}{h_F}\\,[u]\\,[v],\n$$\n其中 $\\{\\kappa \\nabla u \\cdot \\boldsymbol{n}_{\\mathrm{out}}\\} := \\tfrac{1}{2}\\big(\\kappa_L \\nabla u_L \\cdot \\boldsymbol{n}_{L\\!,F} + \\kappa_R \\nabla u_R \\cdot \\boldsymbol{n}_{R\\!,F}\\big)$ 使用 $K_L$ 和 $K_R$ 在 $F$ 上的外法向量 $\\boldsymbol{n}_{L\\!,F}$ 和 $\\boldsymbol{n}_{R\\!,F}$。 Dirichlet 边界-面 $F \\in \\mathcal{F}_h^{\\mathrm{D}}$:\n$$\na_F(u,v) \\;=\\; -\\int_F \\kappa \\nabla u \\cdot \\boldsymbol{n}\\, v \\;-\\; \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, u \\;+\\; \\int_F \\frac{\\eta_F}{h_F}\\, u\\, v,\n\\qquad\n\\ell_F(v) \\;=\\; \\int_F \\frac{\\eta_F}{h_F}\\, g\\, v \\;-\\; \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, g.\n$$\n\nC. 内部面 $F \\in \\mathcal{F}_h^{\\mathrm{int}}$:\n$$\na_F(u,v) \\;=\\; -\\int_F \\{\\kappa \\nabla u\\}\\cdot \\boldsymbol{n}_F \\,[v] \\;+\\; \\int_F \\frac{\\eta_F}{h_F}\\,[u]\\,[v],\n$$\n即，省略含有 $\\{\\kappa \\nabla v\\}$ 的项。 Dirichlet 边界-面 $F \\in \\mathcal{F}_h^{\\mathrm{D}}$:\n$$\na_F(u,v) \\;=\\; -\\int_F \\kappa \\nabla u \\cdot \\boldsymbol{n}\\, v \\;+\\; \\int_F \\frac{\\eta_F}{h_F}\\, u\\, v,\n\\qquad\n\\ell_F(v) \\;=\\; \\int_F \\frac{\\eta_F}{h_F}\\, g\\, v.\n$$\n\nD. 内部面 $F \\in \\mathcal{F}_h^{\\mathrm{int}}$:\n$$\na_F(u,v) \\;=\\; -\\int_F \\{\\kappa \\nabla u\\}\\cdot \\boldsymbol{n}_F \\,[v] \\;-\\; \\int_F \\{\\kappa \\nabla v\\}\\cdot \\boldsymbol{n}_F \\,[u] \\;+\\; \\int_F \\eta_F\\, h_F\\,[u]\\,[v],\n$$\n即，罚项按 $h_F$ 而非 $h_F^{-1}$ 缩放。 Dirichlet 边界-面 $F \\in \\mathcal{F}_h^{\\mathrm{D}}$:\n$$\na_F(u,v) \\;=\\; \\int_F \\kappa \\nabla u \\cdot \\boldsymbol{n}\\, v \\;+\\; \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, u \\;+\\; \\int_F \\eta_F\\, h_F\\, u\\, v,\n\\qquad\n\\ell_F(v) \\;=\\; \\int_F \\eta_F\\, h_F\\, g\\, v \\;+\\; \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, g.\n$$\n\n选择在所述约定和要求下正确的选项（可能有一个或多个正确答案）。", "solution": "任务是为一个标量扩散问题的间断 Galerkin 方法，识别其面贡献的正确公式。要求的性质是该公式方向无关、对称且伴随一致。该方法在内部面上应为对称内部罚 Galerkin (SIPG) 方法，在 Dirichlet 边界条件上应为对称 Nitsche 方法。\n\n首先，让我们从第一性原理推导正确的公式。\n\n出发点是网格 $\\mathcal{T}_h$ 中每个单元 $K$ 上的弱形式。我们将偏微分方程 $-\\nabla \\cdot (\\kappa \\nabla u) = f$ 乘以一个试探函数 $v \\in V_h$ 并在 $K$ 上积分：\n$$\n-\\int_K (\\nabla \\cdot (\\kappa \\nabla u)) v \\, d\\boldsymbol{x} = \\int_K f v \\, d\\boldsymbol{x}\n$$\n对左侧应用分部积分（格林第一恒等式），得到：\n$$\n\\int_K \\kappa \\nabla u \\cdot \\nabla v \\, d\\boldsymbol{x} - \\int_{\\partial K} (\\kappa \\nabla u \\cdot \\boldsymbol{n}_K) v \\, ds = \\int_K f v \\, d\\boldsymbol{x}\n$$\n其中 $\\boldsymbol{n}_K$ 是单元 $K$ 边界 $\\partial K$ 的外单位法向量。\n\n对所有单元 $K \\in \\mathcal{T}_h$ 求和，得到全局公式：\n$$\n\\sum_{K \\in \\mathcal{T}_h} \\int_K \\kappa \\nabla u \\cdot \\nabla v \\, d\\boldsymbol{x} - \\sum_{K \\in \\mathcal{T}_h} \\int_{\\partial K} (\\kappa \\nabla u \\cdot \\boldsymbol{n}_K) v \\, ds = \\int_\\Omega f v \\, d\\boldsymbol{x}\n$$\n单元边界上的积分可以分解为来自内部面 $\\mathcal{F}_h^{\\mathrm{int}}$ 和边界-面 $\\mathcal{F}_h^{\\mathrm{D}}$ 的贡献。这就是引入 DG 方法的数值通量的地方。\n\n**内部面 ($F \\in \\mathcal{F}_h^{\\mathrm{int}}$)**\n\n对于由两个单元 $K_L$ 和 $K_R$ 共享的内部面 $F$，单元边界上的和包含两项。根据从 $K_L$ 指向 $K_R$ 的固定法向量 $\\boldsymbol{n}_F$ 的给定约定，$K_L$ 的外法向量是 $\\boldsymbol{n}_{L,F} = \\boldsymbol{n}_F$，$K_R$ 的外法向量是 $\\boldsymbol{n}_{R,F} = -\\boldsymbol{n}_F$。在 $F$ 上的边界积分变为：\n$$\n\\int_F (\\kappa \\nabla u_L \\cdot \\boldsymbol{n}_{L,F}) v_L \\, ds + \\int_F (\\kappa \\nabla u_R \\cdot \\boldsymbol{n}_{R,F}) v_R \\, ds = \\int_F ((\\kappa \\nabla u_L \\cdot \\boldsymbol{n}_F) v_L - (\\kappa \\nabla u_R \\cdot \\boldsymbol{n}_F) v_R) \\, ds\n$$\n使用跳跃 $[w] := w_L - w_R$ 和平均 $\\{\\boldsymbol{\\phi}\\} := \\frac{1}{2}(\\boldsymbol{\\phi}_L + \\boldsymbol{\\phi}_R)$ 的定义，以及恒等式 $[ab] = \\{a\\}[b] + [a]\\{b\\}$，被积函数可以写成 $[(\\kappa \\nabla u \\cdot \\boldsymbol{n}_F) v] = \\{\\kappa \\nabla u \\cdot \\boldsymbol{n}_F\\}[v] + [\\kappa \\nabla u \\cdot \\boldsymbol{n}_F]\\{v\\}$。对于精确解 $u$，通量是连续的，即 $[\\kappa \\nabla u \\cdot \\boldsymbol{n}_F] = 0$。因此，对于精确解，分部积分得到的边界项简化为 $\\sum_{F \\in \\mathcal{F}_h^{\\mathrm{int}}} \\int_F \\{\\kappa \\nabla u \\cdot \\boldsymbol{n}_F\\}[v] \\, ds$。\n\n间断 Galerkin 公式用数值通量项替代了分部积分得到的边界项。为了伴随一致性，对于精确解的公式必须恢复原始的弱形式。项 $-\\int_F \\{\\kappa \\nabla u \\cdot \\boldsymbol{n}_F\\}[v]$ 是一致性项。\n\n对于必须对称的 SIPG 方法，我们必须加上相应的“伴随”项，该项通过交换 $u$ 和 $v$ 得到：$-\\int_F \\{\\kappa \\nabla v \\cdot \\boldsymbol{n}_F\\}[u]$。\n最后，为了保证稳定性（矫顽性），添加一个罚项，该项惩罚解的跳跃：$+\\int_F \\frac{\\eta_F}{h_F} [u][v]$。该项是对称的，并且对于精确解（其 $[u]=0$）为零，从而保持了一致性。\n\n结合这些，得到内部面 $F$ 的 SIPG 双线性形式：\n$$\na_F(u,v) = -\\int_F \\{\\kappa \\nabla u\\}\\cdot \\boldsymbol{n}_F \\,[v] - \\int_F \\{\\kappa \\nabla v\\}\\cdot \\boldsymbol{n}_F \\,[u] + \\int_F \\frac{\\eta_F}{h_F}\\,[u]\\,[v]\n$$\n该形式由构造可知是对称的。我们必须验证其方向无关性。如果我们翻转法向量，$\\boldsymbol{n}_F \\to -\\boldsymbol{n}_F$，则标签 $L$ 和 $R$ 会互换。这意味着 $[w] \\to -[w]$ 且 $\\{\\boldsymbol{\\phi}\\} \\to \\{\\boldsymbol{\\phi}\\}$。\n第一项变为 $-\\int_F \\{\\kappa \\nabla u\\}\\cdot (-\\boldsymbol{n}_F) \\,(-[v]) = -\\int_F \\{\\kappa \\nabla u\\}\\cdot \\boldsymbol{n}_F \\,[v]$。\n第二项同样是不变的。\n第三项变为 $\\int_F \\frac{\\eta_F}{h_F} (-[u])(-[v]) = \\int_F \\frac{\\eta_F}{h_F} [u][v]$。\n所有项都是不变的。因此，该公式是方向无关的。\n\n**Dirichlet 边界-面 ($F \\in \\mathcal{F}_h^{\\mathrm{D}}$)**\n\nNitsche 方法弱地施加边界条件 $u=g$。我们需要一个对称、伴随一致的公式。出发点是分部积分得到的边界项 $-\\int_F (\\kappa \\nabla u \\cdot \\boldsymbol{n}) v \\, ds$，其中 $\\boldsymbol{n}$ 是 $\\Omega$ 的外单位法向量。\n\n1.  **一致性项**：包含项 $-\\int_F (\\kappa \\nabla u \\cdot \\boldsymbol{n}) v$ 以确保与原始偏微分方程的一致性。\n2.  **对称项**：为了使公式对称，我们加上伴随项 $-\\int_F (\\kappa \\nabla v \\cdot \\boldsymbol{n}) u$。\n3.  **罚项**：为了稳定性，加上一个罚项 $+\\int_F \\frac{\\eta_F}{h_F} u v$。\n\n结合这些，来自边界-面的双线性形式贡献是：\n$$\na_F(u,v) = -\\int_F \\kappa \\nabla u \\cdot \\boldsymbol{n}\\, v - \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, u + \\int_F \\frac{\\eta_F}{h_F}\\, u\\, v\n$$\n该形式由构造可知是对称的。线性形式 $\\ell_F(v)$ 源于纳入边界数据 $g$。在完整公式的对称项和罚项中，我们将试探函数 $u$ 替换为给定的数据 $g$。然后将相应的项移到最终方程 $a_h(u,v) = \\ell_h(v)$ 的右侧。\n方程的完整边界-面贡献是：\n$-\\int_F \\kappa \\nabla u \\cdot \\boldsymbol{n}\\, v - \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, g + \\int_F \\frac{\\eta_F}{h_F}(u-g)v$。\n展开此式：$-\\int_F \\kappa \\nabla u \\cdot \\boldsymbol{n}\\, v - \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, g + \\int_F \\frac{\\eta_F}{h_F}u v - \\int_F \\frac{\\eta_F}{h_F}g v$。\n关于 $u$ 的线性项构成了 $a_F(u,v)$。仅涉及数据 ($g$) 和测试函数 ($v$) 的项构成了 $-\\ell_F(v)$。\n因此，线性形式是：\n$$\n\\ell_F(v) = \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, g - \\int_F \\frac{\\eta_F}{h_F} g v\n$$\n等等，我的推导给出了一个不同的符号。让我通过添加一个对于精确解为零的项来重新推导，这是一种更稳健的方法。\n从精确解 $u$ 的一致性方程开始：\n$\\sum_K \\int_K \\kappa \\nabla u \\cdot \\nabla v - \\sum_{F \\in \\mathcal{F}_h^{\\mathrm{int}}} \\int_F \\{\\kappa \\nabla u \\cdot \\boldsymbol{n}_F\\}[v] - \\sum_{F \\in \\mathcal{F}_h^{\\mathrm{D}}} \\int_F (\\kappa \\nabla u \\cdot \\boldsymbol{n})v = \\int_\\Omega f v$。\n我们加上以下各项，对于精确解 $u$（因为在 $\\Gamma_D$ 上 $u=g$），它们的和为零：\n$0 = \\sum_{F \\in \\mathcal{F}_h^{\\mathrm{D}}} \\left( -\\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}(u-g) + \\int_F \\frac{\\eta_F}{h_F}(u-g)v \\right)$。\n将此式加到一致性方程中，我们可以识别出 $a_h(u,v)$ 和 $\\ell_h(v)$。\n带有试探函数 $u$ 的项是：\n$$\na_F(u,v) = -\\int_F \\kappa \\nabla u \\cdot \\boldsymbol{n}\\, v - \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, u + \\int_F \\frac{\\eta_F}{h_F}\\, u\\, v\n$$\n带有数据 $g$ 的项是：\n$$\n+\\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, g - \\int_F \\frac{\\eta_F}{h_F} gv\n$$\n这些项移到右侧时，就构成了 $\\ell_F(v)$。符号会改变：\n$$\n\\ell_F(v) = -\\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, g + \\int_F \\frac{\\eta_F}{h_F} gv\n$$\n这个关于 $a_F(u,v)$ 和 $\\ell_F(v)$ 的公式是标准的对称 Nitsche 方法。\n\n现在我们来评估给定的选项。\n\n**选项 A:**\n-   **内部面:** $a_F(u,v) = -\\int_F \\{\\kappa \\nabla u\\}\\cdot \\boldsymbol{n}_F \\,[v] - \\int_F \\{\\kappa \\nabla v\\}\\cdot \\boldsymbol{n}_F \\,[u] + \\int_F \\frac{\\eta_F}{h_F}\\,[u]\\,[v]$。这与我们推导出的 SIPG 公式相匹配，该公式是对称、方向无关且伴随一致的。\n-   **Dirichlet 边界-面:**\n    $a_F(u,v) = -\\int_F \\kappa \\nabla u \\cdot \\boldsymbol{n}\\, v - \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, u + \\int_F \\frac{\\eta_F}{h_F}\\, u\\, v$。这与我们推导出的对称 Nitsche 双线性形式相匹配。\n    $\\ell_F(v) = \\int_F \\frac{\\eta_F}{h_F}\\, g\\, v - \\int_F \\kappa \\nabla v \\cdot \\boldsymbol{n}\\, g$。这也与我们推导出的线性形式相匹配。\n此选项中的所有形式都是正确的。\n结论：**正确**。\n\n**选项 B:**\n-   **内部面:** 该公式使用 $\\{\\kappa \\nabla u \\cdot \\boldsymbol{n}_{\\mathrm{out}}\\} := \\tfrac{1}{2}\\big(\\kappa_L \\nabla u_L \\cdot \\boldsymbol{n}_{L\\!,F} + \\kappa_R \\nabla u_R \\cdot \\boldsymbol{n}_{R\\!,F}\\big)$。使用 $\\boldsymbol{n}_{L\\!,F}=\\boldsymbol{n}_F$ 和 $\\boldsymbol{n}_{R\\!,F}=-\\boldsymbol{n}_F$，这变为 $\\tfrac{1}{2}(\\kappa_L \\nabla u_L - \\kappa_R \\nabla u_R) \\cdot \\boldsymbol{n}_F = \\tfrac{1}{2}[\\kappa \\nabla u]\\cdot\\boldsymbol{n}_F$。对于精确解，通量是连续的，所以 $[\\kappa \\nabla u \\cdot \\boldsymbol{n}_F]=0$。该项将消失，但一致性项需要通量的平均值 $\\{\\kappa \\nabla u \\cdot \\boldsymbol{n}_F\\}$，而它不为零。因此，该公式不是伴随一致的。\n结论：**不正确**。\n\n**选项 C:**\n-   **内部面:** $a_F(u,v) = -\\int_F \\{\\kappa \\nabla u\\}\\cdot \\boldsymbol{n}_F \\,[v] + \\int_F \\frac{\\eta_F}{h_F}\\,[u]\\,[v]$。此形式缺少对称化项 $-\\int_F \\{\\kappa \\nabla v\\}\\cdot \\boldsymbol{n}_F \\,[u]$，因此不是对称的。这对应于 NIPG（非对称内部罚 Galerkin）方法。问题要求一个对称的方法。\n-   **Dirichlet 边界-面:** 双线性形式 $a_F(u,v)$ 同样缺少其对称化项。它不是对称的。\n结论：**不正确**。\n\n**选项 D:**\n-   **内部面:** 罚项被给出为 $\\int_F \\eta_F\\, h_F\\,[u]\\,[v]$。缩放因子是 $h_F$，而不是正确的 $h_F^{-1}$。对于二阶椭圆问题，罚项必须与面直径的倒数成比例，以平衡梯度项并确保稳定性（以及最优收敛率）。这种缩放是不正确的。\n-   **Dirichlet 边界-面:** $a_F(u,v)$ 中一致性项和对称项的符号是正的，这是不正确的，并且违反了一致性。罚项也具有错误的缩放 $h_F$。线性形式 $\\ell_F(v)$ 的符号也不正确。\n结论：**不正确**。\n\n基于详细分析，只有选项 A 提供了满足所有规定要求的正确公式。", "answer": "$$\\boxed{A}$$", "id": "2569501"}, {"introduction": "理论的正确性是数值实现成功的基石，但在复杂的编程实践中，微小的错误可能导致难以察觉的系统性偏差。本练习通过一个常见的编码错误——在相邻单元的共享界面上使用不一致的法向量——来探讨其深远影响。通过分析这个假设情景，你将从基本物理原理（如通量守恒和作用力与反作用力定律）出发，深刻理解为何精确的几何处理对维持数值格式的稳定性和物理一致性至关重要。[@problem_id:2635704]", "problem": "考虑一个有界域 $\\Omega \\subset \\mathbb{R}^d$，它被划分为一个协调的单元网格。设两个相邻单元 $K^+$ 和 $K^-$ 共享一个内部面（二维情况下为边）$e = \\partial K^+ \\cap \\partial K^-$。分别用 $n^+$ 和 $n^-$ 表示从 $K^+$ 和 $K^-$ 看向 $e$ 的单位外法向量，因此几何相容性要求为 $n^- = -\\,n^+$。您正在为一个标量扩散偏微分方程（PDE）或线性弹性问题实现有限元方法（FEM）。标量扩散方程的通量为 $q = -\\,\\kappa \\nabla u$，其中 $\\kappa > 0$ 是标量电导率。线性弹性问题的 Cauchy 应力为 $\\sigma = \\mathbb{C} : \\varepsilon(u)$，面力为 $t = \\sigma n$，其中 $\\mathbb{C}$ 是一个对称正定的四阶弹性张量，$\\varepsilon(u) = \\tfrac{1}{2}(\\nabla u + \\nabla u^\\top)$ 是小应变张量。在每个单元上，近似解 $u_h$ 由标准的协调形函数和相关的节点值构造，因此 $u_h$ 在 $e$ 上是连续的，但 $\\nabla u_h$（以及因此产生的 $q_h$ 或 $\\sigma_h$）可能是间断的。\n\n一个常见的后处理任务，也是几种弱形式的一个组成部分，是计算内部面 $e$ 上由形函数梯度导出的法向通量或面力，例如扩散问题中的 $q_h \\cdot n$ 或弹性问题中的 $t_h = \\sigma_h n$，并使用它们来组装边界或内部面的贡献。假设一个编码错误导致在共享内部面上的法向量方向不一致：在 $e$ 上，没有按单元使用各自的外法向量 $n^\\pm$，而是在两侧的所有计算和组装中都使用了相同的单位法向量 $n_e$（也就是说，实现实际上在 $e$ 上采用了 $n^+ = n^- = n_e$）。\n\n仅使用第一性原理（散度定理、虚功原理和守恒定律），分析这种不一致性对計算和组装内部面上由形函数梯度导出的通量或面力所带来的后果。选择所有正确的陈述。\n\nA. 在标量扩散情况下，如果在 $e$ 上使用 $n^+ = n^- = n_e$ 来计算和求和法向通量 $q_h \\cdot n$ 的单元贡献，那么两个贡献将会相加而不是抵消。这会产生一个虚假的非零净界面通量，违反了局部守恒定律，并且即使 $u_h$ 能重现精确的仿射解，也可能破坏诸如分片检验（patch test）之类的验证测试。\n\nB. 在线性弹性问题中，当从 $\\sigma_h n$ 形成和组装内部界面面力时，在 $e$ 上使用 $n^+ = n^- = n_e$ 会保持精确的单元间力平衡，因为 $\\sigma_h$ 是对称的，且面力仅取决于应力而与法向量方向无关。\n\nC. 由基于 $\\nabla$ 的项的体积分构建的单元内部刚度贡献与面的法向量选择无关，但任何在内部面上显式涉及 $n$ 的公式或后处理步骤（例如，Neumann 数据施加、罚函数或 Nitsche 耦合项、或通量/面力平衡），如果在离散层面不强制执行 $n^+ = -\\,n^-$，就可能失去对称性或相容性。\n\nD. 在间断 Galerkin（DG）或混合公式中，如果在 $e$ 上使用跳跃和平均算子，例如 $\\llbracket u \\rrbracket = u^+ n^+ + u^- n^-$ 和平均 $\\{ \\cdot \\}$，未能保持 $n^- = -\\,n^+$ 会破坏作为界面抵消基础的反对称性。结果，界面项可能会注入或移除人为的能量，使得双线性形式失去矫顽性（noncoercive），即使 $\\kappa$ 和 $\\mathbb{C}$ 是正定的。\n\nE. 对于协调形函数，因为 $u_h$ 在 $e$ 上是连续的，计算出的 $\\nabla u_h$ 几乎处处连续，所以在 $e$ 上选择 $n^+ = n^- = n_e$ 会导致来自两侧的面力或通量大小相等、方向相反，并在组装时抵消。因此，无论 $e$ 上的法向量方向如何，内部平衡都会自动得到满足。", "solution": "问题陈述需要经过验证。\n\n**第1步：提取已知条件**\n- 域：一个有界域 $\\Omega \\subset \\mathbb{R}^d$，被划分为一个协调网格。\n- 单元：两个相邻单元 $K^+$ 和 $K^-$。\n- 界面：一个内部面 $e = \\partial K^+ \\cap \\partial K^-$。\n- 法向量（正确）：在 $e$ 上的单位外法向量 $n^+$（来自 $K^+$）和 $n^-$（来自 $K^-$）。\n- 几何相容性：$n^- = -\\,n^+$。\n- 物理1（扩散）：标量PDE，通量为 $q = -\\,\\kappa \\nabla u$，其中电导率 $\\kappa > 0$。\n- 物理2（弹性）：线性弹性，Cauchy 应力为 $\\sigma = \\mathbb{C} : \\varepsilon(u)$，面力为 $t = \\sigma n$。$\\mathbb{C}$ 是一个对称正定的四阶弹性张量，小应变张量为 $\\varepsilon(u) = \\tfrac{1}{2}(\\nabla u + \\nabla u^\\top)$。\n- FEM 近似：使用协调形函数，因此近似解 $u_h$ 在 $e$ 上是连续的。其梯度 $\\nabla u_h$（及派生量 $q_h$, $\\sigma_h$）可能是间断的。\n- 编码错误：在共享内部面 $e$ 上，两侧的计算使用相同的单位法向量 $n_e$，即 $n^+ = n^- = n_e$。\n- 任务：基于第一性原理，分析此错误对涉及内部面上通量或面力计算的后果。\n\n**第2步：使用提取的已知条件进行验证**\n- **科学依据：** 该问题牢固地植根于有限元方法（FEM）应用于连续介质力学（扩散和弹性）的理论。网格、单元、形函数、连续性、法向量、通量和面力的概念都是标准的。所描述的编码错误是 FEM 代码开发中一个合理且常见的错误。\n- **适定性：** 该问题是适定的。它要求基于已建立的物理和数学原理（散度定理、守恒定律），分析一个特定、明确定义的错误的后果。\n- **客观性：** 语言精确、技术性强，没有主观或模糊的陈述。所有术语都是计算科学与工程领域的标准术语。\n\n**第3步：结论与行动**\n问题陈述是有效的。这是一个关于数值方法实现基本方面的清晰、科学上合理且适定的问题。将继续进行求解。\n\n**从第一性原理推导**\n控制界面上通量和面力平衡的核心原理是守恒。对于一个通量为 $F$ 的量，其守恒律 $\\nabla \\cdot F = f$ 在单元 $K$ 上的弱形式通常通过乘以一个检验函数 $v$ 并积分得到。使用散度定理，我们有：\n$$ \\int_K (\\nabla \\cdot F) v \\, dV = \\int_{\\partial K} (F \\cdot n_K) v \\, dS - \\int_K F \\cdot \\nabla v \\, dV = \\int_K f v \\, dV $$\n此处，$n_K$ 是边界 $\\partial K$ 的单位外法向量。当我们通过对所有单元的贡献求和来组装全局系统时，单元 $K^+$ 和 $K^-$ 之间的共享内部面 $e$ 上的项为\n$$ \\int_e (F^+ \\cdot n^+) v \\, dS + \\int_e (F^- \\cdot n^-) v \\, dS $$\n其中 $F^+$ 和 $F^-$ 分别是从 $K^+$ 和 $K^-$ 内部计算的通量。使用正确的几何条件 $n^- = -\\,n^+$，该和变为：\n$$ \\int_e (F^+ - F^-) \\cdot n^+ v \\, dS $$\n该项表示跨界面法向通量跳跃的弱形式。对于满足 PDE 的精确解，在没有界面源的情况下，此跳跃为零。\n\n在线性弹性中，其原理是牛顿第三定律（作用力-反作用力），这是线动量守恒的结果。在任何界面上，一个物体施加于另一个物体的面力向量 $t$ 必须与第二个物体施加于第一个物体的面力大小相等、方向相反。在离散层面，于面 $e$ 上，这意味着面力向量之和应为零：\n$$ t_h^+ + t_h^- = \\sigma_h^+ n^+ + \\sigma_h^- n^- = 0 $$\n使用 $n^- = -\\,n^+$，这要求 $(\\sigma_h^+ - \\sigma_h^-)n^+ = 0$。\n\n指定的编码错误用单个法向量 $n_e$ 替换了正确的法向量 $n^+$ 和 $n^-$。\n通量和变为 $\\int_e (F^+ + F^-) \\cdot n_e v \\, dS$。\n面力和变为 $\\sigma_h^+ n_e + \\sigma_h^- n_e = (\\sigma_h^+ + \\sigma_h^-) n_e$。\n这些错误的形式计算了通量/应力张量之*和*在单个法向量上的投影，而不是物理原理所要求的*差*。这个根本性错误使得任何基于界面平衡的计算都无效。\n\n**逐项分析**\n\n**A. 在标量扩散情况下，如果在 $e$ 上使用 $n^+ = n^- = n_e$ 来计算和求和法向通量 $q_h \\cdot n$ 的单元贡献，那么两个贡献将会相加而不是抵消。这会产生一个虚假的非零净界面通量，违反了局部守恒定律，并且即使 $u_h$ 能重现精确的仿射解，也可能破坏诸如分片检验（patch test）之类的验证测试。**\n\n在扩散情况下，通量为 $q_h = -\\kappa \\nabla u_h$。正确评估跨界面的净通量需要对来自两侧的贡献求和：$\\int_e q_h^+ \\cdot n^+ dS$ 和 $\\int_e q_h^- \\cdot n^- dS$。因为 $n^- = -\\,n^+$，这个过程正确地形成了一个差值 $\\int_e (q_h^+ - q_h^-) \\cdot n^+ dS$，表示通量跳跃。在存在错误 $n^+ = n^- = n_e$ 的情况下，和变为 $\\int_e (q_h^+ + q_h^-) \\cdot n_e dS$。此表达式表示投影通量之和，而非其差值。因此，本应相减的贡献实际上相加了。这在界面上产生了一个虚假的净通量，违反了局部守恒原理（即流入界面点的净通量为零）。对于一个具有仿射解 $u(x) = c \\cdot x + d$ 的分片检验，梯度 $\\nabla u_h$ 是常数，所以 $q_h$ 处处为常数（$q_h^+ = q_h^-$）。错误的和是 $\\int_e 2 q_h \\cdot n_e dS$，这通常是非零的，导致依赖于界面通量相容性的测试失败。\n\n结论：**正确**。\n\n**B. 在线性弹性问题中，当从 $\\sigma_h n$ 形成和组装内部界面面力时，在 $e$ 上使用 $n^+ = n^- = n_e$ 会保持精确的单元间力平衡，因为 $\\sigma_h$ 是对称的，且面力仅取决于应力而与法向量方向无关。**\n\n内部界面上的力平衡（平衡）要求面力大小相等、方向相反：$t_h^+ + t_h^- = 0$。使用正确的法向量，这表示为 $\\sigma_h^+ n^+ + \\sigma_h^- n^- = 0 \\implies (\\sigma_h^+ - \\sigma_h^-)n^+ = 0$。在存在错误 $n^+ = n^- = n_e$ 的情况下，平衡性检查将涉及对计算出的面力向量求和：$\\sigma_h^+ n_e + \\sigma_h^- n_e = (\\sigma_h^+ + \\sigma_h^-)n_e$。由于 $\\nabla u_h$ 在 $e$ 上是间断的，应力张量 $\\sigma_h$ 也是间断的，意味着 $\\sigma_h^+ \\neq \\sigma_h^-$。它们的和 $(\\sigma_h^+ + \\sigma_h^-)$ 通常是一个非零张量，所以得到的向量不是零向量。力平衡被违反。Cauchy 应力张量的对称性 $\\sigma_h = \\sigma_h^\\top$ 是角动量守恒的结果，与界面上线动量守恒的满足无关。关于面力“仅取决于应力而与法向量方向无关”的说法是明显错误的；根据定义，面力是 $t = \\sigma n$。\n\n结论：**不正确**。\n\n**C. 由基于 $\\nabla$ 的项的体积分构建的单元内部刚度贡献与面的法向量选择无关，但任何在内部面上显式涉及 $n$ 的公式或后处理步骤（例如，Neumann 数据施加、罚函数或 Nitsche 耦合项、或通量/面力平衡），如果在离散层面不强制执行 $n^+ = -\\,n^-$，就可能失去对称性或相容性。**\n\n这个陈述有两个部分。首先，单元刚度矩阵的贡献是通过在单元域 $K$ 上的体积分计算的，例如扩散问题的 $K_{ij}^K = \\int_K \\kappa \\nabla N_i \\cdot \\nabla N_j dV$ 或弹性问题的 $K_{ij}^K = \\int_K \\varepsilon(N_i) : \\mathbb{C} : \\varepsilon(N_j) dV$。这些积分不涉及面法向量 $n$，因此不受此错误的影响。这部分是正确的。其次，任何显式使用面法向量进行界面计算的方法都会受到影响。这包括稳定化方法（罚函数/Nitsche）、基于通量跳跃的误差估计器以及通量/面力恢复方案。这些方法需要计算界面项。*相容性*属性要求当代入精确解时这些项为零。如在 A 和 B 的分析中所示，法向量的错误导致计算和而不是差，这对于精确解不为零。某些公式（例如，对称内部罚函数 Galerkin，Nitsche 方法）中的*对称性*属性是通过精心组合界面上涉及 $u$ 和 $v$ 的项而导出的，这依赖于正确的 $n^- = -\\,n^+$ 关系。改变这一点会破坏对称性所需的代数结构。这部分也是正确的。\n\n结论：**正确**。\n\n**D. 在间断 Galerkin（DG）或混合公式中，如果在 $e$ 上使用跳跃和平均算子，例如 $\\llbracket u \\rrbracket = u^+ n^+ + u^- n^-$ 和平均 $\\{ \\cdot \\}$，未能保持 $n^- = -\\,n^+$ 会破坏作为界面抵消基础的反对称性。结果，界面项可能会注入或移除人为的能量，使得双线性形式失去矫頑性（noncoercive），即使 $\\kappa$ 和 $\\mathbb{C}$ 是正定的。**\n\nDG 及相关方法建立在界面上跳跃算子 $\\llbracket \\cdot \\rrbracket$ 和平均算子 $\\{ \\cdot \\}$ 的精确定义之上。对于向量 $\\tau$，跳跃是 $\\llbracket \\tau \\rrbracket = \\tau^+ \\cdot n^+ + \\tau^- \\cdot n^-$。对于标量 $u$，跳跃通常写为 $[u] = u^+ - u^-$。这些定义都以 $n^- = -\\,n^+$ 为前提。如果出现 $n^+ = n^- = n_e$ 的错误，向量跳跃算子将变为 $\\llbracket \\tau \\rrbracket_{err} = (\\tau^+ + \\tau^-) \\cdot n_e = 2 \\{\\tau\\} \\cdot n_e$。跳跃算子被错误地转换为了平均算子。DG 方法的整个代数框架，特别是那些由对所有单元求和散度定理而产生的恒等式，都依赖于法向量的“反对称性”。这种结构对于证明稳定性（矫頑性）和相容性至关重要。如该错误所示，破坏这种结构意味着双线性形式可能不再是矫顽的（正定的），这可能导致奇异的刚度矩阵和无唯一解。人工能量的注入或移除是一个非守恒、不相容公式的直接后果。\n\n结论：**正确**。\n\n**E. 对于协调形函数，因为 $u_h$ 在 $e$ 上是连续的，计算出的 $\\nabla u_h$ 几乎处处连续，所以在 $e$ 上选择 $n^+ = n^- = n_e$ 会导致来自两侧的面力或通量大小相等、方向相反，并在组装时抵消。因此，无论 $e$ 上的法向量方向如何，内部平衡都会自动得到满足。**\n\n这个陈述基于一个根本性的误解。对于标准的 $C^0$ 连续（协调）有限元，解 $u_h$ 在单元边界上是连续的，但其梯度 $\\nabla u_h$ 是内在间断的。$\\nabla u_h$ 通常是分片多项式（例如，对于线性单元是分片常数），并在界面 $e$ 上有跳跃。“几乎处处连续”这个说法虽然正确但具有误導性；间断点恰好存在于本问题所关注的界面上。因为 $\\nabla u_h$ 是间断的，所以通量 $q_h$ 和应力 $\\sigma_h$ 也是间斷的。因此，该错误产生“大小相等、方向相反”的面力或通量的前提是错误的。如在 A 和 B 的分析中所示，结果是一个非零的和，而不是抵消。内部平衡没有被强制执行。\n\n结论：**不正确**。", "answer": "$$\\boxed{ACD}$$", "id": "2635704"}, {"introduction": "在实际应用中，罚参数的选择是一个微妙的权衡：它必须足够大以保证数值稳定性，但过大的罚参数又可能恶化矩阵的条件数并降低精度。本练习将引导你实现一个自适应罚参数算法，这是一种更精巧的策略，它根据局部解的质量动态调整罚参数大小。你将基于后处理的均衡通量信息，编写一个程序来计算对称内部罚(SIP)和Nitsche方法中的罚参数，亲身体验如何将理论需求与实际计算相结合，以开发出更高效、更智能的有限元方法。[@problem_id:2569500]", "problem": "您的任务是设计并实现一个算法，以基于平衡通量信息自适应调整间断 Galerkin (dG) 方法的对称内部罚 (SIP) 参数和 Nitsche 方法的边界罚。考虑在区域 $\\Omega \\subset \\mathbb{R}^d$ 上的一个形状规则的网格 $\\mathcal{T}_h$ 上的标量扩散模型问题，其扩散系数为 $\\kappa(\\boldsymbol{x})$，网格骨架为 $\\mathcal{E}_h$。对于一个内部面 $e \\in \\mathcal{E}_h$，令 $h_e$ 表示一个代表性的面尺寸，$p_e$ 为相邻单元上的局部多项式次数，并根据标准约定定义算术跳跃和平均。对于 SIP 方法，罚项以如下形式出现\n$$\n\\sum_{e \\in \\mathcal{E}_h} \\int_e \\sigma_e \\frac{\\kappa_e}{h_e} \\, [[u_h]] \\, [[v_h]] \\, \\mathrm{d}s,\n$$\n其中 $\\sigma_e$ 是一个无量纲的稳定化参数，$\\kappa_e$ 是一个有效的面扩散系数。对于 Dirichlet 边界上的 Nitsche 边界耦合，使用了一个类似的罚项 $\\int_{\\partial \\Omega_D} \\sigma_e \\frac{\\kappa_e}{h_e} \\, u_h \\, v_h \\, \\mathrm{d}s$。\n\n基本出发点是：\n- 形状规则网格上的离散迹不等式：存在一个依赖于面的常数 $C_{\\mathrm{tr}}$，使得对于单元 $K$ 上任意次数为 $p_e$ 的多项式 $v_h$（其中 $e \\subset \\partial K$ 是 $K$ 的一个面），都有\n$$\n\\| v_h \\|_{L^2(e)}^2 \\le C_{\\mathrm{tr}} \\frac{(p_e + 1)^2}{h_e} \\, \\| v_h \\|_{L^2(K)}^2.\n$$\n- 当罚项按 $\\sigma_e \\frac{\\kappa_e}{h_e}$ 进行缩放时，若满足以下条件，则 SIP 形式的矫顽性得到保证（在不考虑普适的形状规则性常数和维度相关因子的前提下）：\n$$\n\\sigma_e \\ge C_{\\mathrm{tr}} (p_e + 1)^2,\n$$\n- 一个平衡通量 $\\hat{\\boldsymbol{q}} \\in H(\\mathrm{div};\\Omega)$ 是一个经过后处理的通量场，它在单元上是局部守恒的，并且与数值解一致。它在面上的法向跳跃提供了一个鲁棒的残差度量。对于一个具有单位法向量 $\\boldsymbol{n}_e$ 的内部面 $e$，定义一个通量残差大小 $r_e := \\| [[ \\hat{\\boldsymbol{q}} \\cdot \\boldsymbol{n}_e ]] \\|_{L^2(e)}$。对于一个 Dirichlet 边界面 $e \\subset \\partial \\Omega_D$，定义 $r_e := \\| \\hat{\\boldsymbol{q}} \\cdot \\boldsymbol{n} - t_e \\|_{L^2(e)}$，其中 $t_e$ 是目标边界牵引力，此处由数值提供。对于内部面，令 $j_e := \\| [[u_h]] \\|_{L^2(e)}$；对于 Dirichlet 边界面，令 $j_e := \\| u_h \\|_{L^2(e)}$。\n\n您必须基于这些基础，推导出一个针对 $\\sigma_e$ 的量纲一致的自适应规则，该规则需保持矫顽性下限，并使 $\\sigma_e$ 与一个归一化的通量不平衡量成比例增加。该自适应规则必须使用以下结构：\n- 对于内部面，令 $\\kappa_e$ 为相邻扩散系数的调和平均值，即\n$$\n\\kappa_e = \\frac{2 \\kappa^- \\kappa^+}{\\kappa^- + \\kappa^+},\n$$\n对于边界面，设置 $\\kappa_e = \\kappa^-$。\n- 令最小稳定化水平为\n$$\n\\sigma_{\\min,e} := C_{\\mathrm{tr}} (p_e + 1)^2.\n$$\n- 令归一化的不平衡量为\n$$\n\\phi_e := \\min \\left\\{ \\frac{h_e \\, r_e}{\\kappa_e \\, (j_e + \\delta)}, \\, \\phi_{\\max} \\right\\},\n$$\n其中有一个小的正常数正则化项 $\\delta$ 以防止除以零，以及一个上限 $\\phi_{\\max}$ 以防止无界增长。\n- 令最终的自适应罚项为\n$$\n\\sigma_e := \\sigma_{\\min,e} \\left( 1 + \\theta \\, \\phi_e \\right).\n$$\n\n您的程序必须使用常数 $C_{\\mathrm{tr}} = 1$、$\\theta = 2.5$、$\\phi_{\\max} = 10$ 和 $\\delta = 10^{-12}$，为给定的测试套件计算 $\\sigma_e$。所有计算都是无量纲且纯数学的，不涉及物理单位。\n\n测试套件：\n- 测试用例 1 (均匀扩散，中等残差，内部面)：\n  - 边由元组 $(h_e, p_e, \\kappa^-, \\kappa^+, r_e, j_e)$ 描述：\n    - $(0.25, 1, 1.0, 1.0, 0.02, 0.20)$,\n    - $(0.25, 1, 1.0, 1.0, 0.01, 0.15)$,\n    - $(0.25, 1, 1.0, 1.0, 0.005, 0.10)$.\n- 测试用例 2 (混合次数、网格尺寸和扩散对比度，内部面)：\n  - $(0.10, 2, 1.0, 1.0, 0.20, 0.05)$,\n  - $(0.10, 3, 5.0, 0.2, 0.05, 0.10)$,\n  - $(0.05, 1, 0.5, 0.5, 0.10, 0.01)$,\n  - $(0.20, 1, 1.0, 1.0, 0.00, 0.20)$.\n- 测试用例 3 (通过 Nitsche 方法处理的 Dirichlet 边界和具有小尺寸的内部边，高次情况)：\n  - 对于 Dirichlet 边界面，通过将第二个扩散系数设为 0 来表示；元组被解释为 $(h_e, p_e, \\kappa^-, 0, r_e, j_e)$：\n    - $(0.05, 2, 2.0, 0, 0.10, 0.00)$,\n  - 内部边：\n    - $(0.01, 1, 1.0, 1.0, 0.01, 0.05)$,\n    - $(0.20, 4, 10.0, 10.0, 0.20, 1.00)$.\n\n要求：\n- 实现上面指定的自适应公式，按所给顺序为每个测试用例计算罚项 $\\sigma_e$ 列表。\n- 严格按照给定的常数 $C_{\\mathrm{tr}} = 1$、$\\theta = 2.5$、$\\phi_{\\max} = 10$ 和 $\\delta = 10^{-12}$ 使用。\n- 程序必须生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果是一个浮点数列表，四舍五入到六位小数。例如，输出格式必须类似于\n$[ [\\sigma_{1,1}, \\sigma_{1,2}], [\\sigma_{2,1}], [\\sigma_{3,1}, \\sigma_{3,2}] ]$\n其中填充了实际数值，并四舍五入到六位小数。", "solution": "所提出的问题是一个有效且适定的计算任务，其理论基础是偏微分方程的数值方法。它要求为罚参数 $\\sigma_e$ 实现一个自适应算法，该参数用于对称内部罚间断 Galerkin (SIP-dG) 方法和施加 Dirichlet 边界条件的 Nitsche 方法。所提供的公式在科学上是合理的、内部一致的，并包含得出唯一解所需的所有必要信息。我们将着手对该计算算法进行合理的推导。\n\n目标是为有限元网格中的一组面（或在 $\\mathbb{R}^2$ 中为边）计算稳定化参数 $\\sigma_e$。此参数对于确保离散问题的稳定性（或更正式地说，矫顽性）至关重要。该自适应策略旨在基于解质量的局部指标（特别是后处理数值通量的不平衡性）来调整 $\\sigma_e$。\n\n罚参数设计的基础在于离散迹不等式，对于一个单元 $K$ 及其面 $e$，该不等式表述为\n$$\n\\| v_h \\|_{L^2(e)}^2 \\le C_{\\mathrm{tr}} \\frac{(p_e + 1)^2}{h_e} \\, \\| v_h \\|_{L^2(K)}^2\n$$\n其中 $v_h$ 是一个次数为 $p_e$ 的多项式，$h_e$ 是面尺寸，而 $C_{\\mathrm{tr}}$ 是一个依赖于单元形状规则性的常数。为保证 SIP-dG 双线性形式的矫顽性，罚参数 $\\sigma_e$ 必须足够大，以控制由解跨面跳跃产生的项。这便引出了条件 $\\sigma_e \\ge C_{\\mathrm{tr}} (p_e + 1)^2$。因此，问题定义了一个最小允许罚参数：\n$$\n\\sigma_{\\min,e} := C_{\\mathrm{tr}} (p_e + 1)^2\n$$\n这可作为确保理论稳定性的基线。对于给定的问题，$C_{\\mathrm{tr}} = 1$，所以 $\\sigma_{\\min,e} = (p_e + 1)^2$。\n\n自适应算法的核心是根据局部数值误差来增强此基线罚项。平衡通量 $\\hat{\\boldsymbol{q}}$ 为此类误差提供了一个鲁棒的度量，它是一个满足局部守恒性质的后处理向量场。该通量法向分量在内部面 $e$ 上的跳跃大小，记为 $r_e = \\| [[ \\hat{\\boldsymbol{q}} \\cdot \\boldsymbol{n}_e ]] \\|_{L^2(e)}$，量化了局部通量的不平衡。较大的 $r_e$ 表明局部近似较差。\n\n为使该指标在自适应调整 $\\sigma_e$ 时有用，必须将其无量纲化并进行适当缩放。所提出的自适应规则引入了一个归一化的不平衡指标 $\\phi_e$。该指标将通量残差 $r_e$ 与同一面上的解跳跃 $j_e = \\| [[u_h]] \\|_{L^2(e)}$ 联系起来。其公式为：\n$$\n\\phi_e := \\min \\left\\{ \\frac{h_e \\, r_e}{\\kappa_e \\, (j_e + \\delta)}, \\, \\phi_{\\max} \\right\\}\n$$\n在此，$\\kappa_e$ 是面上的有效扩散系数，它适当地用解跳跃来缩放通量残差。由于 $r_e$ 的单位在积分意义上近似为 $[\\kappa][u]/[L]$，而 $j_e$ 的单位是 $[u]$，因此 $h_e / \\kappa_e$ 项确保了该比率是无量纲的。当解跳跃 $j_e$ 接近于零时（这种情况可能发生），小的正则化参数 $\\delta > 0$ 可以防止除以零。参数 $\\phi_{\\max}$ 为自适应贡献提供了一个上界（或称“上限”），以防止罚项 $\\sigma_e$ 变得过大，因为这可能会恶化全局系统矩阵的条件数。\n\n最后，自适应罚参数 $\\sigma_e$ 通过使用此不平衡指标来增强最小罚项 $\\sigma_{\\min,e}$ 而构建：\n$$\n\\sigma_e := \\sigma_{\\min,e} \\left( 1 + \\theta \\, \\phi_e \\right)\n$$\n参数 $\\theta$ 控制自适应响应的强度。当 $\\theta=0$ 时，将恢复为最小的非自适应罚项。正的 $\\theta$ 会在通量不平衡度高的区域增强稳定性。\n\n对于具有给定参数 $(h_e, p_e, \\kappa^-, \\kappa^+, r_e, j_e)$ 的每个面 $e$，使用指定的常数 $C_{\\mathrm{tr}} = 1$、$\\theta = 2.5$、$\\phi_{\\max} = 10$ 和 $\\delta = 10^{-12}$，计算过程如下：\n\n1.  **计算有效扩散系数 $\\kappa_e$**：\n    -   对于内部面，其中相邻单元的扩散系数为 $\\kappa^-$ 和 $\\kappa^+$，使用调和平均值：$\\kappa_e = \\frac{2 \\kappa^- \\kappa^+}{\\kappa^- + \\kappa^+}$。这是精确捕捉两种不同介质间有效传导率的标准选择。\n    -   对于由 $\\kappa^+=0$ 代表的边界面，该参数取自单个相邻单元：$\\kappa_e = \\kappa^-$。\n\n2.  **计算最小罚项 $\\sigma_{\\min,e}$**：\n    -   使用局部多项式次数 $p_e$ 和 $C_{\\mathrm{tr}} = 1$，计算 $\\sigma_{\\min,e} = (p_e + 1)^2$。\n\n3.  **计算归一化的不平衡量 $\\phi_e$**：\n    -   计算比率 $\\frac{h_e \\, r_e}{\\kappa_e \\, (j_e + \\delta)}$。\n    -   应用上限：$\\phi_e = \\min\\left(\\frac{h_e \\, r_e}{\\kappa_e \\, (j_e + \\delta)}, \\phi_{\\max}\\right)$。\n\n4.  **计算最终的自适应罚项 $\\sigma_e$**：\n    -   组合以上分量：$\\sigma_e = \\sigma_{\\min,e} (1 + \\theta \\, \\phi_e)$。\n\n此算法将应用于测试套件中指定的每个面，以生成所需的数值结果。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the adaptive penalty parameter sigma_e for a suite of test cases\n    based on the provided formulation for discontinuous Galerkin and Nitsche methods.\n    \"\"\"\n\n    # Constants provided in the problem statement.\n    C_TR = 1.0\n    THETA = 2.5\n    PHI_MAX = 10.0\n    DELTA = 1e-12\n\n    # Test suite defined in the problem.\n    test_cases = [\n        # Test case 1 (uniform diffusion, moderate residuals, interior faces)\n        [\n            (0.25, 1, 1.0, 1.0, 0.02, 0.20),\n            (0.25, 1, 1.0, 1.0, 0.01, 0.15),\n            (0.25, 1, 1.0, 1.0, 0.005, 0.10)\n        ],\n        # Test case 2 (mixed degrees, mesh sizes, and diffusion contrast, interior faces)\n        [\n            (0.10, 2, 1.0, 1.0, 0.20, 0.05),\n            (0.10, 3, 5.0, 0.2, 0.05, 0.10),\n            (0.05, 1, 0.5, 0.5, 0.10, 0.01),\n            (0.20, 1, 1.0, 1.0, 0.00, 0.20)\n        ],\n        # Test case 3 (Dirichlet boundary, high-degree case)\n        [\n            (0.05, 2, 2.0, 0.0, 0.10, 0.00),  # Dirichlet boundary face\n            (0.01, 1, 1.0, 1.0, 0.01, 0.05),  # Interior face\n            (0.20, 4, 10.0, 10.0, 0.20, 1.00) # Interior face\n        ]\n    ]\n\n    def calculate_sigma_e(h_e, p_e, kappa_minus, kappa_plus, r_e, j_e):\n        \"\"\"\n        Calculates the adaptive penalty parameter sigma_e for a single face.\n        \n        Args:\n            h_e (float): Face size.\n            p_e (int): Local polynomial degree.\n            kappa_minus (float): Diffusion coefficient in one element.\n            kappa_plus (float): Diffusion coefficient in the other; 0 for boundary.\n            r_e (float): Flux residual norm.\n            j_e (float): Solution jump norm.\n            \n        Returns:\n            float: The calculated penalty parameter sigma_e.\n        \"\"\"\n        \n        # Step 1: Compute Effective Diffusion kappa_e\n        if kappa_plus == 0.0:  # Boundary face\n            kappa_e = kappa_minus\n        else:  # Interior face\n            # Harmonic mean, check for zero denominator though problem data avoids this.\n            if kappa_minus + kappa_plus == 0:\n                 kappa_e = 0\n            else:\n                 kappa_e = (2 * kappa_minus * kappa_plus) / (kappa_minus + kappa_plus)\n\n        # Step 2: Compute Minimum Penalty sigma_min_e\n        sigma_min_e = C_TR * (p_e + 1)**2\n\n        # Step 3: Compute Normalized Disequilibrium phi_e\n        denominator = kappa_e * (j_e + DELTA)\n        if denominator == 0:\n            # This case happens if kappa_e is zero. Assign large number to be capped by PHI_MAX.\n            raw_phi = float('inf')\n        else:\n            raw_phi = (h_e * r_e) / denominator\n        \n        phi_e = min(raw_phi, PHI_MAX)\n        \n        # Step 4: Compute Final Adaptive Penalty sigma_e\n        sigma_e = sigma_min_e * (1 + THETA * phi_e)\n        \n        return sigma_e\n\n    all_results = []\n    for case in test_cases:\n        case_results = []\n        for face_params in case:\n            sigma_e = calculate_sigma_e(*face_params)\n            case_results.append(sigma_e)\n        all_results.append(case_results)\n\n    # Format the output to six decimal places and the required string structure.\n    formatted_results = []\n    for case_res in all_results:\n        rounded_vals = [f\"{val:.6f}\" for val in case_res]\n        formatted_results.append(f'[{\",\".join(rounded_vals)}]')\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2569500"}]}