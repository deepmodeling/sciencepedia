{"hands_on_practices": [{"introduction": "在谱元法中，一项基本任务是离散化微分算子，例如拉普拉斯算子。这个练习将指导你为一维热传导方程构建谱元质量矩阵 ($M$) 和刚度矩阵 ($K$)，并通过分析所得系统的广义特征值，理解这对于确定显式时间步进格式的数值稳定性至关重要 ([@problem_id:2597942])。", "problem": "对多项式次数 $N$，使用 Legendre–Gauss–Lobatto (LGL) 配置点，在参考单元 $[-1,1]$ 上构建一维谱元法 (SEM)。考虑单位系数扩散方程 $u_{t} = u_{xx}$ 的齐次 Dirichlet 边界值问题；使用节点 Lagrange 基 $\\{\\ell_{j}(x)\\}_{j=0}^{N}$ 对其进行 Galerkin 半离散化，得到质量矩阵 $M$（元素为 $M_{ij} = \\int_{-1}^{1} \\ell_{i}(x)\\,\\ell_{j}(x)\\,dx$）和刚度矩阵 $K$（元素为 $K_{ij} = \\int_{-1}^{1} \\ell_{i}'(x)\\,\\ell_{j}'(x)\\,dx$）。在使用 LGL 求积的 SEM 配置设置中，积分由 LGL 法则近似计算。通过消除与端点相关的边界自由度，在 $x=-1$ 和 $x=1$ 处施加齐次 Dirichlet 边界条件。完全在单个参考单元 $[-1,1]$ 上进行操作，系数为单位值且无源项。\n\n从基本原理出发，从 $u_{t} = u_{xx}$ 的弱形式开始，即，寻找 $u$ 使得对于所有容许的测试函数 $v$，满足\n$$\n\\int_{-1}^{1} v(x)\\,u_{t}(x,t)\\,dx + \\int_{-1}^{1} v_{x}(x)\\,u_{x}(x,t)\\,dx = 0,\n$$\n并推导出半离散系统 $M\\,\\dot{\\mathbf{u}} + K\\,\\mathbf{u} = 0$，其中 $\\mathbf{u}$ 集合了（消除边界节点后的）节点未知数。LGL 节点 $\\{x_{i}\\}_{i=0}^{N}$ 是端点 $x_{0}=-1, x_{N}=1$ 以及由 Legendre 多项式 $P_{N}'(x)$ 在 $(-1,1)$ 内的根给出的 $N-1$ 个内部点。LGL 求积权重 $\\{w_{i}\\}_{i=0}^{N}$ 满足 $w_{i} = \\dfrac{2}{N(N+1)\\,[P_{N}(x_{i})]^{2}}$。使用 LGL 节点上的节点 Lagrange 基和配置求积法，在 $[-1,1]$ 上构建 $M$ 和 $K$。\n\n在完整节点集上形成 $M$ 和 $K$ 之后，通过限制到内部索引 $\\{1,2,\\dots,N-1\\}$ 来施加齐次 Dirichlet 边界条件。将限制于内部的矩阵表示为 $M_{\\mathrm{int}}$ 和 $K_{\\mathrm{int}}$。设广义特征值 $\\{\\lambda_{j}\\}$ 由 $K_{\\mathrm{int}}\\mathbf{v}_{j} = \\lambda_{j}\\,M_{\\mathrm{int}}\\mathbf{v}_{j}$ 定义。$M_{\\mathrm{int}}\\dot{\\mathbf{u}} + K_{\\mathrm{int}}\\mathbf{u} = 0$ 的显式向前 Euler 时间离散化为 $\\mathbf{u}^{n+1} = \\mathbf{u}^{n} - \\Delta t\\,M_{\\mathrm{int}}^{-1}K_{\\mathrm{int}}\\mathbf{u}^{n}$，并且当且仅当时间步长满足 $\\Delta t \\le \\dfrac{2}{\\max_{j}\\lambda_{j}}$ 时是稳定的。你必须计算并报告的就是这个限制条件。\n\n您的任务是：\n- 对于给定的多项式次数 $N$，构建 $[-1,1]$ 上的 LGL 节点及相应的权重。\n- 使用配置 LGL 求积法组装 SEM 质量矩阵 $M$，这将使 $M$ 成为对角矩阵，其对角线元素等于求积权重。\n- 将 SEM 刚度矩阵 $K$ 组装为梯度项的 LGL 求积，其由 $K = D^{\\top} W D$ 给出，其中 $D$ 是节点微分矩阵，元素为 $D_{ij} = \\ell_{j}'(x_{i})$，$W = \\mathrm{diag}(w_{0},\\dots,w_{N})$ 是求积权重的对角矩阵。\n- 通过消除第一个和最后一个自由度来施加齐次 Dirichlet 边界条件，得到 $M_{\\mathrm{int}}$ 和 $K_{\\mathrm{int}}$。\n- 分别计算 $M_{\\mathrm{int}}$ 和 $K_{\\mathrm{int}}$ 的特征值，并计算 $(K_{\\mathrm{int}}, M_{\\mathrm{int}})$ 的广义特征值 $\\{\\lambda_{j}\\}$。\n- 根据广义谱计算向前 Euler 时间步长限制 $\\Delta t_{\\max} = \\dfrac{2}{\\max_{j}\\lambda_{j}}$。\n\n测试套件和输出规范：\n- 在单个单元 $[-1,1]$ 上使用三个测试用例，多项式次数为 $N \\in \\{2,6,10\\}$。\n- 对于每个测试用例，计算并报告以下实数列表：$[N, \\min\\operatorname{eig}(M_{\\mathrm{int}}), \\max\\operatorname{eig}(M_{\\mathrm{int}}), \\min\\operatorname{eig}(K_{\\mathrm{int}}), \\max\\operatorname{eig}(K_{\\mathrm{int}}), \\max_{j}\\lambda_{j}, \\Delta t_{\\max}]$。\n- 您的程序应生成单行输出，其中包含一个无空格、逗号分隔的列表的列表形式的结果，例如，对于三个用例，它必须看起来像 $[[\\cdots],[\\cdots],[\\cdots]]$。\n\n角度单位和物理单位不适用；所有量都是无量纲实数。所有输出必须是数值，并以标准十进制表示法出现。程序必须是完全自包含的，不得读取任何输入，并且必须严格遵守在单行打印中指定的最终输出格式。", "solution": "所提出的问题是计算科学领域的一个标准且适定的练习，具体涉及抛物型偏微分方程的谱元法。它具有科学依据，逻辑上一致，并且为其求解提供了所有必要的条件和定义。因此，我们将着手进行求解。\n\n问题始于具有单位扩散系数的一维热扩散方程，给定为\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial^2 u}{\\partial x^2}\n$$\n在域 $\\Omega = [-1, 1]$ 上，服从齐次 Dirichlet 边界条件 $u(-1, t) = 0$ 和 $u(1, t) = 0$。在有限元或谱元公式化中的第一步是推导弱形式。我们将方程乘以一个满足相同齐次边界条件的足够光滑的测试函数 $v(x)$，并在域 $\\Omega$ 上积分：\n$$\n\\int_{-1}^{1} v(x) u_t(x,t) \\, dx = \\int_{-1}^{1} v(x) u_{xx}(x,t) \\, dx.\n$$\n对右侧应用分部积分，并利用测试函数 $v(x)$ 在边界处为零（$v(-1)=v(1)=0$）的事实，我们得到弱形式。寻找 $u(x,t)$ 使得对于所有容许的测试函数 $v(x)$：\n$$\n\\int_{-1}^{1} v(x) u_t(x,t) \\, dx + \\int_{-1}^{1} v_x(x) u_x(x,t) \\, dx = 0.\n$$\n谱元法将解 $u(x,t)$ 近似为基函数的线性组合。具体来说，我们使用基于一组配置点 $\\{x_j\\}_{j=0}^{N}$ 的 $N$ 次节点展开式：\n$$\nu(x,t) \\approx u_h(x,t) = \\sum_{j=0}^{N} u_j(t) \\ell_j(x),\n$$\n其中 $u_j(t) = u_h(x_j,t)$ 是表示节点上解的随时间变化的系数，而 $\\{\\ell_j(x)\\}_{j=0}^{N}$ 是满足 $\\ell_j(x_i) = \\delta_{ij}$ 的 Lagrange 基多项式集合，这里 $\\delta_{ij}$ 是 Kronecker δ。测试函数 $v(x)$ 选自同一空间，即 $v(x) = \\ell_i(x)$，对于 $i=0, \\dots, N$。\n\n将 $u_h$ 的展开式代入弱形式，并使用 $\\ell_i(x)$ 作为测试函数，我们得到一个关于未知系数 $\\mathbf{u}(t) = [u_0(t), \\dots, u_N(t)]^T$ 的常微分方程组：\n$$\n\\sum_{j=0}^{N} \\left( \\int_{-1}^{1} \\ell_i(x) \\ell_j(x) \\, dx \\right) \\frac{d u_j}{dt} + \\sum_{j=0}^{N} \\left( \\int_{-1}^{1} \\ell_i'(x) \\ell_j'(x) \\, dx \\right) u_j(t) = 0, \\quad \\text{for } i=0, \\dots, N.\n$$\n这就是半离散系统 $M\\dot{\\mathbf{u}} + K\\mathbf{u} = \\mathbf{0}$，其中质量矩阵 $M$ 和刚度矩阵 $K$ 的元素为：\n$$\nM_{ij} = \\int_{-1}^{1} \\ell_i(x) \\ell_j(x) \\, dx, \\quad \\quad K_{ij} = \\int_{-1}^{1} \\ell_i'(x) \\ell_j'(x) \\, dx.\n$$\n在谱元法中，这些积分不是精确计算的。相反，它们是使用数值求积法来近似的。Legendre-Gauss-Lobatto (LGL) 求积法的选择是核心。一个 $N$ 阶 LGL 求积法则使用 $N+1$ 个点 $\\{x_k\\}_{k=0}^N$ 和相应的权重 $\\{w_k\\}_{k=0}^N$。函数 $f(x)$ 的积分近似为：\n$$\n\\int_{-1}^{1} f(x) \\, dx \\approx \\sum_{k=0}^{N} f(x_k) w_k.\n$$\n该求积对于次数最高为 $2N-1$ 的多项式是精确的。LGL 节点 $\\{x_k\\}$ 是 $(1-x^2)P_N'(x)$ 的根，其中 $P_N(x)$ 是 $N$ 次 Legendre 多项式。这个集合包括端点 $x_0 = -1$ 和 $x_N = 1$。权重由公式 $w_k = \\frac{2}{N(N+1)[P_N(x_k)]^2}$ 给出。\n\n当我们将此求积应用于质量矩阵元素时，并且因为 Lagrange 基函数本身是在求积点上使用的，我们有 $\\ell_j(x_k) = \\delta_{jk}$。这导致了一个显著的简化：\n$$\nM_{ij} = \\int_{-1}^{1} \\ell_i(x) \\ell_j(x) \\, dx \\approx \\sum_{k=0}^{N} w_k \\ell_i(x_k) \\ell_j(x_k) = \\sum_{k=0}^{N} w_k \\delta_{ik} \\delta_{jk} = w_i \\delta_{ij}.\n$$\n质量矩阵 $M$ 变为对角矩阵，其对角线上是求积权重：$M = \\mathrm{diag}(w_0, \\dots, w_N)$。这是 SEM 的一个决定性优势，通常称为“质量集中”(mass lumping)。\n\n刚度矩阵的元素也以类似方式近似：\n$$\nK_{ij} = \\int_{-1}^{1} \\ell_i'(x) \\ell_j'(x) \\, dx \\approx \\sum_{k=0}^{N} w_k \\ell_i'(x_k) \\ell_j'(x_k).\n$$\n如果我们定义节点微分矩阵 $D$ 其元素为 $D_{ki} = \\ell_i'(x_k)$，以及一个对角权重矩阵 $W = \\mathrm{diag}(w_0, \\dots, w_N)$，则刚度矩阵可以简洁地表示为 $K = D^T W D$。对于 LGL 节点，微分矩阵 $D$ 的元素具有已知的解析形式：\n$$\nD_{ij} = \\ell_j'(x_i) = \\begin{cases} \\frac{P_N(x_i)}{P_N(x_j)} \\frac{1}{x_i - x_j} & i \\neq j \\\\ -\\frac{N(N+1)}{4} & i=j=0 \\\\ \\frac{N(N+1)}{4} & i=j=N \\\\ 0 & i=j \\in \\{1, \\dots, N-1\\} \\end{cases}\n$$\n\n齐次 Dirichlet 边界条件 $u(-1,t)=0$ 和 $u(1,t)=0$ 意味着边界节点处的系数 $u_0(t)$ 和 $u_N(t)$ 在所有时间都固定为零。我们通过删除矩阵 $M$ 和 $K$ 的第一行和最后一行以及第一列和最后一列来施加此条件。这产生了内部系统：\n$$\nM_{\\mathrm{int}} \\dot{\\mathbf{u}}_{\\mathrm{int}} + K_{\\mathrm{int}} \\mathbf{u}_{\\mathrm{int}} = \\mathbf{0},\n$$\n其中 $\\mathbf{u}_{\\mathrm{int}} = [u_1, \\dots, u_{N-1}]^T$，而 $M_{\\mathrm{int}}$ 和 $K_{\\mathrm{int}}$ 是对应于内部自由度的 $(N-1) \\times (N-1)$ 子矩阵。\n\n为了分析时间步进格式的稳定性，我们考虑系统的特征值。该方程可以重写为 $\\dot{\\mathbf{u}}_{\\mathrm{int}} = -M_{\\mathrm{int}}^{-1} K_{\\mathrm{int}} \\mathbf{u}_{\\mathrm{int}}$。向前 Euler 方法将其离散化为：\n$$\n\\mathbf{u}_{\\mathrm{int}}^{n+1} = \\mathbf{u}_{\\mathrm{int}}^n - \\Delta t \\, M_{\\mathrm{int}}^{-1} K_{\\mathrm{int}} \\mathbf{u}_{\\mathrm{int}}^n = (I - \\Delta t \\, M_{\\mathrm{int}}^{-1} K_{\\mathrm{int}}) \\mathbf{u}_{\\mathrm{int}}^n.\n$$\n为了保持稳定，放大矩阵 $G = I - \\Delta t \\, M_{\\mathrm{int}}^{-1} K_{\\mathrm{int}}$ 的谱半径不得超过 $1$。$G$ 的特征值是 $1 - \\Delta t \\lambda_j$，其中 $\\lambda_j$ 是矩阵对 $(K_{\\mathrm{int}}, M_{\\mathrm{int}})$ 的广义特征值，满足 $K_{\\mathrm{int}}\\mathbf{v}_j = \\lambda_j M_{\\mathrm{int}}\\mathbf{v}_j$。由于 $M_{\\mathrm{int}}$ 和 $K_{\\mathrm{int}}$ 是对称正定的，特征值 $\\lambda_j$ 是实数且为正。对所有 $j$ 成立的稳定性条件 $|1 - \\Delta t \\lambda_j| \\le 1$ 变为 $-1 \\le 1 - \\Delta t \\lambda_j \\le 1$，可简化为 $0 \\le \\Delta t \\lambda_j \\le 2$。这必须对最大特征值成立，从而导出稳定性极限：\n$$\n\\Delta t \\le \\frac{2}{\\lambda_{\\mathrm{max}}},\n$$\n其中 $\\lambda_{\\mathrm{max}} = \\max_j \\lambda_j$。\n\n所需的计算步骤如下：\n1. 对于给定的多项式次数 $N$，计算 $N-1$ 个内部 LGL 节点作为 $P_N'(x)$ 的根，并通过包含 $-1$ 和 $1$ 形成 $N+1$ 个节点的完整集合。\n2. 计算相应的 $N+1$ 个 LGL 权重 $w_k$。\n3. 构建 $(N-1) \\times (N-1)$ 的内部质量矩阵 $M_{\\mathrm{int}}$，它是一个对角矩阵，其元素为 $\\{w_1, \\dots, w_{N-1}\\}$。\n4. 构建完整的 $(N+1) \\times (N+1)$ 微分矩阵 $D$，然后构建完整的刚度矩阵 $K = D^T W D$。提取 $(N-1) \\times (N-1)$ 的内部子矩阵 $K_{\\mathrm{int}}$。\n5. 计算 $M_{\\mathrm{int}}$ 和 $K_{\\mathrm{int}}$ 的标准特征值。$M_{\\mathrm{int}}$ 的特征值是其对角线元素。\n6. 求解广义特征值问题 $K_{\\mathrm{int}}\\mathbf{v} = \\lambda M_{\\mathrm{int}}\\mathbf{v}$ 以找到广义谱 $\\{\\lambda_j\\}$。\n7. 确定最大广义特征值 $\\lambda_{\\max}$ 并计算临界时间步长 $\\Delta t_{\\max} = 2 / \\lambda_{\\max}$。\n这个严谨的程序将为指定的测试用例实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Constructs and analyzes a 1D Spectral Element Method for the diffusion equation\n    on the reference element [-1, 1] for various polynomial degrees N.\n    \"\"\"\n    \n    test_cases = [2, 6, 10]\n    all_results = []\n\n    for N in test_cases:\n        # Step 1: Compute LGL nodes and weights\n        # The interior LGL nodes are the roots of the derivative of the N-th Legendre polynomial.\n        L_N = np.polynomial.legendre.Legendre.basis(N)\n        L_N_prime = L_N.deriv(1)\n        interior_nodes = L_N_prime.roots()\n        \n        # The full set of nodes includes the endpoints -1 and 1.\n        # Nodes must be sorted.\n        nodes = np.concatenate(([-1.0], np.sort(interior_nodes), [1.0]))\n        \n        # Compute LGL weights\n        # w_i = 2 / (N*(N+1) * L_N(x_i)^2)\n        weights = 2.0 / (N * (N + 1.0) * (L_N(nodes)**2))\n        \n        # Step 2: Assemble the differentiation matrix D\n        # D_ij = l_j'(x_i)\n        D = np.zeros((N + 1, N + 1))\n        L_N_vals_at_nodes = L_N(nodes)\n        \n        for i in range(N + 1):\n            for j in range(N + 1):\n                if i == j:\n                    if i == 0:\n                        D[i, j] = -N * (N + 1) / 4.0\n                    elif i == N:\n                        D[i, j] = N * (N + 1) / 4.0\n                    else:\n                        D[i, j] = 0.0\n                else:\n                    D[i, j] = L_N_vals_at_nodes[i] / (L_N_vals_at_nodes[j] * (nodes[i] - nodes[j]))\n\n        # Step 3: Assemble Mass and Stiffness matrices M and K\n        # The collocated mass matrix M is diagonal with weights on the diagonal.\n        M = np.diag(weights)\n        # The stiffness matrix K is given by D^T * W * D, where W = M.\n        K = D.T @ M @ D\n        \n        # Step 4: Impose homogeneous Dirichlet boundary conditions.\n        # This is done by taking the interior submatrices (indices 1 to N-1).\n        if N > 1:\n            M_int = M[1:-1, 1:-1]\n            K_int = K[1:-1, 1:-1]\n        else: # Trivial case for N=1 (no interior nodes)\n            M_int = np.array([])\n            K_int = np.array([])\n        \n        # Step 5: Compute eigenvalues of M_int and K_int\n        # Eigenvalues of M_int are its diagonal entries as it's a diagonal matrix.\n        if N > 1:\n            eig_M_int = np.diag(M_int)\n            min_eig_M = np.min(eig_M_int)\n            max_eig_M = np.max(eig_M_int)\n\n            # Eigenvalues of K_int (symmetric matrix)\n            eig_K_int = np.linalg.eigvalsh(K_int)\n            min_eig_K = np.min(eig_K_int)\n            max_eig_K = np.max(eig_K_int)\n\n            # Step 6: Compute generalized eigenvalues\n            # Solve K_int * v = lambda * M_int * v\n            # scipy.linalg.eigh is suitable for symmetric/Hermitian generalized eigenvalue problems.\n            gen_eigvals = eigh(K_int, M_int, eigvals_only=True)\n            max_gen_eig = np.max(gen_eigvals)\n            \n            # Step 7: Compute the Forward Euler time step restriction\n            dt_max = 2.0 / max_gen_eig\n        else: # Handle N=1 case where matrices are empty\n            min_eig_M, max_eig_M, min_eig_K, max_eig_K, max_gen_eig, dt_max = (np.nan,)*6\n            \n        case_results = [\n            float(N),\n            min_eig_M,\n            max_eig_M,\n            min_eig_K,\n            max_eig_K,\n            max_gen_eig,\n            dt_max\n        ]\n        \n        # Format the sublist without spaces\n        formatted_sublist = f\"[{','.join(map(str, case_results))}]\"\n        all_results.append(formatted_sublist)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n\n```", "id": "2597942"}, {"introduction": "真实世界的问题很少能恰好适用于简单的参考区间 $[-1,1]$。此练习介绍了一种关键技术——等参映射，它使用相同的基函数来表示解和单元的几何形状。掌握这项技术，便可将参考单元上开发的强大方法应用于复杂的物理域 ([@problem_id:2597909])。", "problem": "考虑参考区间 $[-1,1]$ 上的一个一维谱元，其节点 $\\{\\xi_i\\}_{i=0}^{N}$ 选为高斯-洛巴托-勒让德 (GLL) 节点。定义拉格朗日插值基 $\\{\\ell_i(\\xi)\\}_{i=0}^{N}$，其满足条件 $\\ell_i(\\xi_j)=\\delta_{ij}$。从参考坐标 $\\xi$ 到物理坐标 $x$ 的等参映射定义为 $x(\\xi)=\\sum_{i=0}^{N} X_i \\,\\ell_i(\\xi)$，其中 $\\{X_i\\}_{i=0}^{N}$ 是物理节点坐标。\n\n任务：\n1) 从节点 $\\{\\xi_i\\}_{i=0}^{N}$ 上的拉格朗日插值多项式的定义出发，推导雅可比 $J(\\xi)=\\dfrac{dx}{d\\xi}$ 关于 $\\{X_i\\}$ 和导数 $\\{\\ell_i'(\\xi)\\}$ 的显式表达式。\n\n2) 仅使用微积分中的一维换元定理和链式法则，推导标量函数 $f(x)$ 在物理单元 $K=x([-1,1])$ 上的积分变换规则，即将：\n$$\n\\int_{K} f(x)\\,dx \\quad \\text{用} \\quad \\int_{-1}^{1} \\cdots \\, d\\xi \\text{ 的形式表示。}\n$$\n请明确指出 $J(\\xi)$ 所扮演的角色。\n\n3) 考虑 $N=2$ 的特殊情况，其中 GLL 节点为 $\\xi_0=-1$, $\\xi_1=0$, $\\xi_2=1$，物理节点坐标为 $X_0=0$, $X_1=1$, $X_2=3$。对于函数 $f(x)=x^2$，计算物理积分的精确值：\n$$\nI \\;=\\; \\int_{x(-1)}^{x(1)} x^2\\,dx\n$$\n通过变换到参考区间 $[-1,1]$ 并精确计算所得表达式。最终答案应为一个不带单位的实数，且不要四舍五入。", "solution": "首先对问题陈述进行严格验证，以确保其科学和逻辑上的完整性。\n\n已知条件如下：\n- 参考区间 $[-1,1]$ 上的一个一维谱元。\n- 节点为高斯-洛巴托-勒让德 (GLL) 节点 $\\{\\xi_i\\}_{i=0}^{N}$。\n- 基函数为满足性质 $\\ell_i(\\xi_j)=\\delta_{ij}$ 的拉格朗日插值多项式 $\\{\\ell_i(\\xi)\\}_{i=0}^{N}$。\n- 从参考坐标 $\\xi$ 到物理坐标 $x$ 的等参映射由 $x(\\xi)=\\sum_{i=0}^{N} X_i \\,\\ell_i(\\xi)$ 给出，其中 $\\{X_i\\}_{i=0}^{N}$ 是物理节点坐标。\n- 对于任务3，给定 $N=2$，GLL 节点为 $\\xi_0=-1$, $\\xi_1=0$, $\\xi_2=1$。\n- 对应的物理节点坐标为 $X_0=0$, $X_1=1$, $X_2=3$。\n- 待积分函数为 $f(x)=x^2$。\n\n该问题具有科学依据，是有限元和谱元文献中的标准提法。此问题是适定的，已提供推导所需表达式和计算最终值的所有必要信息。其语言客观而精确。该问题没有逻辑矛盾、事实错误或任何其他可能使其无效的缺陷。因此，我们着手求解。\n\n任务1：推导雅可比 $J(\\xi)$ 的显式表达式。\n\n从参考坐标 $\\xi$到物理坐标 $x$ 的一维变换的雅可比定义为 $J(\\xi) = \\frac{dx}{d\\xi}$。该映射由等参公式给出：\n$$\nx(\\xi) = \\sum_{i=0}^{N} X_i \\, \\ell_i(\\xi)\n$$\n为求雅可比，我们将此表达式对 $\\xi$ 求导。物理节点坐标 $\\{X_i\\}$ 相对于参考坐标 $\\xi$ 是常数。微分运算是线性的，因此我们可以对求和逐项求导：\n$$\nJ(\\xi) = \\frac{d}{d\\xi} \\left( \\sum_{i=0}^{N} X_i \\, \\ell_i(\\xi) \\right)\n$$\n对求和中的每一项应用导数，得到：\n$$\nJ(\\xi) = \\sum_{i=0}^{N} X_i \\, \\frac{d\\ell_i}{d\\xi}(\\xi)\n$$\n使用撇号表示法表示导数，即 $\\ell_i'(\\xi) = \\frac{d\\ell_i}{d\\xi}(\\xi)$，则雅可比的表达式为：\n$$\nJ(\\xi) = \\sum_{i=0}^{N} X_i \\, \\ell_i'(\\xi)\n$$\n\n任务2：推导标量函数 $f(x)$ 积分的变换规则。\n\n我们需要变换标量函数 $f(x)$ 在物理单元 $K = x([-1,1])$ 上的积分。该积分为 $\\int_{K} f(x)\\,dx$。域 $K$ 对应于区间 $[x(-1), x(1)]$。我们使用微积分中的一维换元定理。变换由映射 $x=x(\\xi)$ 给出。微分元 $dx$ 通过链式法则与微分元 $d\\xi$ 相关联：\n$$\ndx = \\frac{dx}{d\\xi} \\, d\\xi = J(\\xi) \\, d\\xi\n$$\n当积分变量从 $x$ 变为 $\\xi$ 时，积分限也必须进行变换。物理域 $K$ 从 $x_{start} = x(-1)$ 延伸到 $x_{end} = x(1)$。这些分别对应于参考域的界限 $\\xi=-1$ 和 $\\xi=1$。将 $x=x(\\xi)$、$dx=J(\\xi)d\\xi$ 和新的积分限代入积分，得到变换规则：\n$$\n\\int_{x(-1)}^{x(1)} f(x) \\, dx = \\int_{-1}^{1} f(x(\\xi)) \\, J(\\xi) \\, d\\xi\n$$\n雅可比 $J(\\xi)$ 的作用是作为一个缩放因子，它将物理域中的长度微元 $dx$ 与参考域中的长度微元 $d\\xi$ 联系起来。它解释了映射在每一点 $\\xi$ 处的局部拉伸 ($|J(\\xi)| > 1$)、压缩 ($|J(\\xi)|  1$) 或方向反转 ($J(\\xi)  0$)。对于一个有效的、非退化的单元映射，雅可比在单元内部不得为零。\n\n任务3：计算指定情况下的积分精确值。\n\n我们有 $N=2$，节点为 $\\xi_0=-1$, $\\xi_1=0$, $\\xi_2=1$。我们首先构造拉格朗日基多项式 $\\{\\ell_i(\\xi)\\}_{i=0}^{2}$：\n$$\n\\ell_0(\\xi) = \\frac{(\\xi - \\xi_1)(\\xi - \\xi_2)}{(\\xi_0 - \\xi_1)(\\xi_0 - \\xi_2)} = \\frac{(\\xi - 0)(\\xi - 1)}{(-1 - 0)(-1 - 1)} = \\frac{\\xi(\\xi-1)}{2} = \\frac{1}{2}\\xi^2 - \\frac{1}{2}\\xi\n$$\n$$\n\\ell_1(\\xi) = \\frac{(\\xi - \\xi_0)(\\xi - \\xi_2)}{(\\xi_1 - \\xi_0)(\\xi_1 - \\xi_2)} = \\frac{(\\xi - (-1))(\\xi - 1)}{(0 - (-1))(0 - 1)} = \\frac{(\\xi+1)(\\xi-1)}{-1} = 1 - \\xi^2\n$$\n$$\n\\ell_2(\\xi) = \\frac{(\\xi - \\xi_0)(\\xi - \\xi_1)}{(\\xi_2 - \\xi_0)(\\xi_2 - \\xi_1)} = \\frac{(\\xi - (-1))(\\xi - 0)}{(1 - (-1))(1 - 0)} = \\frac{(\\xi+1)\\xi}{2} = \\frac{1}{2}\\xi^2 + \\frac{1}{2}\\xi\n$$\n接下来，我们使用物理节点坐标 $X_0=0$、$X_1=1$ 和 $X_2=3$ 构造等参映射 $x(\\xi)$：\n$$\nx(\\xi) = X_0\\ell_0(\\xi) + X_1\\ell_1(\\xi) + X_2\\ell_2(\\xi)\n$$\n$$\nx(\\xi) = (0)\\left(\\frac{1}{2}\\xi^2 - \\frac{1}{2}\\xi\\right) + (1)(1 - \\xi^2) + (3)\\left(\\frac{1}{2}\\xi^2 + \\frac{1}{2}\\xi\\right)\n$$\n$$\nx(\\xi) = 1 - \\xi^2 + \\frac{3}{2}\\xi^2 + \\frac{3}{2}\\xi = \\frac{1}{2}\\xi^2 + \\frac{3}{2}\\xi + 1\n$$\n我们在节点处验证该映射：$x(-1) = \\frac{1}{2} - \\frac{3}{2} + 1 = 0 = X_0$， $x(0) = 1 = X_1$， $x(1) = \\frac{1}{2} + \\frac{3}{2} + 1 = 3 = X_2$。该映射是正确的。\n\n现在，我们计算雅可比 $J(\\xi)$：\n$$\nJ(\\xi) = \\frac{dx}{d\\xi} = \\frac{d}{d\\xi}\\left(\\frac{1}{2}\\xi^2 + \\frac{3}{2}\\xi + 1\\right) = \\xi + \\frac{3}{2}\n$$\n待计算的积分是 $I = \\int_{x(-1)}^{x(1)} x^2\\,dx = \\int_{0}^{3} x^2\\,dx$。\n我们将此积分变换到参考区间 $[-1,1]$：\n$$\nI = \\int_{-1}^{1} (x(\\xi))^2 \\, J(\\xi) \\, d\\xi\n$$\n代入 $x(\\xi)$ 和 $J(\\xi)$ 的表达式：\n$$\nI = \\int_{-1}^{1} \\left(\\frac{1}{2}\\xi^2 + \\frac{3}{2}\\xi + 1\\right)^2 \\left(\\xi + \\frac{3}{2}\\right) d\\xi\n$$\n我们注意到，项 $\\xi + \\frac{3}{2}$ 正是括号内项的导数，即 $J(\\xi) = \\frac{dx(\\xi)}{d\\xi}$。这允许直接换元。令 $u = x(\\xi) = \\frac{1}{2}\\xi^2 + \\frac{3}{2}\\xi + 1$。则 $du = (\\xi + \\frac{3}{2})d\\xi = J(\\xi)d\\xi$。我们还必须根据此换元改变积分限：\n- 当 $\\xi = -1$ 时，$u = x(-1) = 0$。\n- 当 $\\xi = 1$ 时，$u = x(1) = 3$。\n\n该积分变换如下：\n$$\nI = \\int_{u(\\xi=-1)}^{u(\\xi=1)} u^2 \\, du = \\int_{0}^{3} u^2 \\, du\n$$\n这是一个易于计算的平凡积分：\n$$\nI = \\left[ \\frac{u^3}{3} \\right]_{0}^{3} = \\frac{3^3}{3} - \\frac{0^3}{3} = \\frac{27}{3} = 9\n$$\n这个结果可以通过在物理空间中直接积分来验证，从而证实我们过程的正确性：\n$$\n\\int_{0}^{3} x^2 \\, dx = \\left[ \\frac{x^3}{3} \\right]_{0}^{3} = \\frac{3^3}{3} = 9\n$$\n计算过程一致且正确。", "answer": "$$\n\\boxed{9}\n$$", "id": "2597909"}, {"introduction": "从线性偏微分方程过渡到非线性方程（如伯格斯方程）会引入新的数值挑战。这个练习揭示了谱方法中的一个关键问题：混叠误差，它源于非线性项的不精确表示。通过比较简单的配置点法和更严谨的完全积分伽辽金法，你将理解为什么后者对于保持物理守恒律至关重要 ([@problem_id:2597924])。", "problem": "考虑单个参考谱元上的守恒形式的一维无粘伯格斯方程，\n$$\n\\partial_t u + \\partial_x \\left(\\tfrac{1}{2} u^2\\right) = 0,\\quad x\\in[-1,1],\n$$\n及其通过谱元法（SEM）进行的连续伽辽金离散化。使用 $N=6$ 次的多项式空间，在Gauss–Lobatto–Legendre（GLL）节点上采用拉格朗日基函数。设 $\\{\\ell_i(x)\\}_{i=0}^{N}$ 是与 $N+1$ 个GLL节点 $\\{x_i\\}_{i=0}^{N}$ 相关的节点基函数。定义节点向量 $u\\in\\mathbb{R}^{N+1}$，其分量为 $u_i = u(x_i)$。物理通量为 $f(u)=\\tfrac{1}{2}u^2$。\n\n你必须使用两种策略计算并比较对流残差：\n\n1. 欠积分（配置）残差：令 $D\\in\\mathbb{R}^{(N+1)\\times(N+1)}$ 为微分矩阵，其元素为 $D_{ij} = \\ell_j'(x_i)$。定义\n$$\nr^{\\mathrm{UI}} = D\\, f(u),\n$$\n其中 $f(u)$ 是按分量计算的，即 $[f(u)]_i = \\tfrac{1}{2} u_i^2$。\n\n2. 全积分（伽辽金）残差：使用通过超积分计算的精确弱形式。令一致质量矩阵为\n$$\nM_{ij} = \\int_{-1}^{1} \\ell_i(x)\\,\\ell_j(x)\\,dx,\n$$\n并定义载荷向量\n$$\ng_i = -\\int_{-1}^{1} \\ell_i'(x)\\, f\\!\\left(u_h(x)\\right)\\,dx,\\quad u_h(x)=\\sum_{k=0}^{N} u_k \\ell_k(x).\n$$\n通过求解以下方程组获得全积分残差 $r^{\\mathrm{FI}}\\in\\mathbb{R}^{N+1}$\n$$\nM\\, r^{\\mathrm{FI}} = g.\n$$\n所有单元级积分必须通过在 $[-1,1]$ 上使用 $Q=200$ 个点的高斯-勒让德求积法来计算；为此问题的目的，这种超积分应被视为数值上精确的。基函数在求积节点上的所有导数必须从拉格朗日基函数一致地计算，而不是通过有限差分。\n\n能量量化。离散能量为\n$$\nE_h(u) = \\tfrac{1}{2} u^\\top M\\, u.\n$$\n对于一个残差 $r$，定义瞬时能量生成率（仅由对流项引起）为\n$$\n\\dot E_h(u;r) = u^\\top M\\, r.\n$$\n在周期性域上并使用精确积分，对流项不应改变能量，因此全积分残差应满足 $\\dot E_h(u;r^{\\mathrm{FI}})\\approx 0$。\n\n差异度量。使用质量加权的 $L^2$ 范数来量化 $r^{\\mathrm{FI}}$ 和 $r^{\\mathrm{UI}}$ 之间的差异，\n$$\n\\|r^{\\mathrm{FI}}-r^{\\mathrm{UI}}\\|_{M} = \\sqrt{(r^{\\mathrm{FI}}-r^{\\mathrm{UI}})^\\top M\\, (r^{\\mathrm{FI}}-r^{\\mathrm{UI}})}.\n$$\n\n在单个程序中实现计算，无需用户输入。使用以下初始数据测试集，由其节点值 $u_i=u(x_i)$ 表示：\n- 情况 A（三角函数，周期性）：$u(x) = \\sin(\\pi x) + \\tfrac{1}{2}\\sin(2\\pi x)$。\n- 情况 B（低次多项式）：$u(x) = x^3 - x$。\n- 情况 C（最高阶勒让德多项式）：$u(x) = P_6(x)$，其中 $P_6$ 是 6 次勒让德多项式。\n\n对于每种情况，计算并报告三个量：\n- 质量加权差异 $\\|r^{\\mathrm{FI}}-r^{\\mathrm{UI}}\\|_{M}$。\n- 欠积分能量生成率 $\\dot E_h(u;r^{\\mathrm{UI}})$。\n- 全积分能量生成率 $\\dot E_h(u;r^{\\mathrm{FI}})$。\n\n所有计算都是无量纲的。输出规范：你的程序应生成单行输出，包含九个结果，顺序如下\n$$\n[\\|r^{\\mathrm{FI}}-r^{\\mathrm{UI}}\\|_{M}^{(A)},\\ \\dot E_h^{(A)}(u;r^{\\mathrm{UI}}),\\ \\dot E_h^{(A)}(u;r^{\\mathrm{FI}}),\\ \\|r^{\\mathrm{FI}}-r^{\\mathrm{UI}}\\|_{M}^{(B)},\\ \\dot E_h^{(B)}(u;r^{\\mathrm{UI}}),\\ \\dot E_h^{(B)}(u;r^{\\mathrm{FI}}),\\ \\|r^{\\mathrm{FI}}-r^{\\mathrm{UI}}\\|_{M}^{(C)},\\ \\dot E_h^{(C)}(u;r^{\\mathrm{UI}}),\\ \\dot E_h^{(C)}(u;r^{\\mathrm{FI}})],\n$$\n四舍五入到 $10$ 位小数，并以逗号分隔的列表形式打印，用方括号括起来（例如，$[0.1234567890,0.0,0.0,\\dots]$）。不应打印任何附加文本。", "solution": "用户提供了一个有效的问题陈述。任务是使用谱元法（SEM）在参考单元 $x\\in[-1,1]$ 上，计算并比较一维无粘伯格斯方程 $\\partial_t u + \\partial_x (\\frac{1}{2} u^2) = 0$ 中对流项的两种不同离散化方法。问题的核心在于区分计算效率高但非守恒的配置格式与计算成本更高但守恒的伽辽金格式。该分析对于理解非线性偏微分方程高阶方法的数值稳定性和守恒性至关重要。\n\n解决方案是通过为一个 $N=6$ 次的多项式逼近实现单单元谱元法代码的必要组件来构建的。\n\n首先，我们建立离散化框架。解 $u(x,t)$ 被一个多项式 $u_h(x,t) \\in \\mathcal{P}_N$ 逼近，$\\mathcal{P}_N$ 是次数最多为 $N$ 的多项式空间。在节点谱元法中，这个多项式由其在一组 $N+1$ 个求积节点上的值表示。对于此问题，使用Gauss–Lobatto–Legendre（GLL）节点 $\\{x_i\\}_{i=0}^{N}$。这些节点是多项式 $(1-x^2)P_N'(x)$ 的根，其中 $P_N(x)$ 是 $N$ 次勒让德多项式。对于 $N=6$，这在区间 $[-1,1]$ 上给出 7 个节点。\n\n多项式逼近 $u_h(x,t)$ 在定义于这些GLL节点上的拉格朗日多项式基 $\\{\\ell_j(x)\\}_{j=0}^{N}$ 中表示：\n$$\nu_h(x,t) = \\sum_{j=0}^{N} u_j(t) \\ell_j(x)\n$$\n其中 $u_j(t) = u_h(x_j,t)$ 是解的节点值，并且基函数满足基数性质 $\\ell_j(x_i) = \\delta_{ij}$。\n\n两种残差计算策略定义如下：\n\n1.  **欠积分（配置）残差, $r^{\\mathrm{UI}}$**：此方法源于在GLL节点上配置偏微分方程的强形式。将 $u_h$ 代入偏微分方程，我们得到一个残差 $R(x) = \\partial_t u_h + \\partial_x f(u_h)$。我们要求对于所有节点 $i=0, \\dots, N$，都有 $R(x_i)=0$。该方程的空间部分产生了指定的残差。空间导数 $\\partial_x$ 被微分矩阵 $D$ 的作用所取代，其元素为 $D_{ij} = \\ell_j'(x_i)$。非线性通量 $f(u) = \\frac{1}{2}u^2$ 在节点上逐点计算，即 $[f(u)]_i = f(u_i)$。半离散方程变为 $\\dot{u}_i + [D f(u)]_i = 0$。因此，对流残差定义为：\n    $$\n    r^{\\mathrm{UI}} = D f(u)\n    $$\n    该格式计算效率高，因为它仅涉及矩阵-向量乘积。然而，通过仅在节点 $f(u(x_i))$ 处计算来处理非线性项 $f(u_h(x))$，实际上是隐式地使用GLL求积来积分弱形式中的非线性项。由于 $f(u_h(x))$ 的次数为 $2N$，这种求积是不精确的，并会引入混叠误差，通常表现为违反守恒律。\n\n2.  **全积分（伽辽金）残差, $r^{\\mathrm{FI}}$**：此方法源自偏微分方程的弱形式。我们将偏微分方程乘以一个测试函数 $v_h(x) \\in \\mathcal{P}_N$（这里是基函数 $\\ell_i(x)$）并在域上积分：\n    $$\n    \\int_{-1}^{1} \\ell_i(x) \\partial_t u_h(x) \\,dx + \\int_{-1}^{1} \\ell_i(x) \\partial_x f(u_h(x)) \\,dx = 0\n    $$\n    第一项给出了质量矩阵的贡献：$\\sum_{j=0}^N \\dot{u}_j \\int_{-1}^1 \\ell_i(x) \\ell_j(x) \\,dx = [M \\dot{u}]_i$。第二项通过分部积分法处理：$\\int_{-1}^1 \\ell_i \\partial_x f(u_h) \\,dx = [\\ell_i f(u_h)]_{-1}^1 - \\int_{-1}^1 \\ell_i'(x) f(u_h(x)) \\,dx$。对于全局域上的连续伽辽金方法，边界项用于强制执行单元间的连续性或物理边界条件。如此处所考虑的单个单元上，并遵循问题定义，我们关注内部积分部分，它定义了向量 $g$：\n    $$\n    g_i = -\\int_{-1}^{1} \\ell_i'(x) f(u_h(x)) \\, dx\n    $$\n    半离散系统为 $M \\dot{u} = -g$。问题通过关系式 $M r^{\\mathrm{FI}} = g$ 来定义全积分残差 $r^{\\mathrm{FI}}$。为避免混叠，质量矩阵 $M_{ij} = \\int \\ell_i \\ell_j \\,dx$ 和载荷向量 $g_i$ 的积分都必须以足够的精度计算。问题指定了使用 $Q=200$ 个点的高斯-勒让德求积，对于所涉及的多项式次数，这被视为数值上精确的。\n\n为了分析守恒性质，我们考察离散动能 $E_h = \\frac{1}{2} u^\\top M u$ 的变化率。其时间导数为 $\\dot{E}_h = u^\\top M \\dot{u}$。在我们的背景下，如果我们忽略边界通量，空间残差 $r$ 等价于 $-\\dot{u}$。问题将与残差 $r$ 相关的能量生成率定义为 $\\dot{E}_h(u;r) = u^\\top M r$。\n对于全积分残差，此速率为 $\\dot{E}_h(u; r^{\\mathrm{FI}}) = u^\\top M r^{\\mathrm{FI}} = u^\\top g$。展开此式，我们得到：\n$$\n\\dot{E}_h(u; r^{\\mathrm{FI}}) = \\sum_{i=0}^N u_i g_i = \\sum_{i=0}^N u_i \\left( -\\int_{-1}^1 \\ell_i'(x) f(u_h(x)) dx \\right) = -\\int_{-1}^1 \\left( \\sum_{i=0}^N u_i \\ell_i'(x) \\right) f(u_h(x)) dx\n$$\n认识到 $\\sum_i u_i \\ell_i'(x) = u_h'(x)$ 且 $f(u_h) = \\frac{1}{2}u_h^2$，积分变为：\n$$\n\\dot{E}_h(u; r^{\\mathrm{FI}}) = -\\int_{-1}^1 u_h'(x) \\left(\\frac{1}{2}u_h(x)^2\\right) dx = -\\int_{-1}^1 \\frac{d}{dx}\\left(\\frac{1}{6}u_h(x)^3\\right) dx = -\\left[\\frac{1}{6}u_h(x)^3\\right]_{-1}^{1} = \\frac{1}{6}\\left(u_h(-1)^3 - u_h(1)^3\\right)\n$$\n这表明能量变化完全由边界处的通量引起。对于提供的所有三个测试用例，$u_h(-1)^3 = u_h(1)^3$，因此我们期望 $\\dot{E}_h(u; r^{\\mathrm{FI}})$ 在数值精度范围内为零。相比之下，由于配置方法固有的混叠误差，$\\dot{E}_h(u; r^{\\mathrm{UI}}) = u^\\top M r^{\\mathrm{UI}}$ 通常为非零。\n\n两个残差之间的差异使用质量加权范数 $\\|r^{\\mathrm{FI}}-r^{\\mathrm{UI}}\\|_{M} = \\sqrt{(r^{\\mathrm{FI}}-r^{\\mathrm{UI}})^\\top M (r^{\\mathrm{FI}}-r^{\\mathrm{UI}})}$ 来量化，这代表了空间中自然能量范数的差异。\n\n计算过程如下：\n1.  计算 $N=6$ 时的 $N+1$ 个GLL节点。\n2.  构建谱元法微分矩阵 $D \\in \\mathbb{R}^{(N+1)\\times(N+1)}$。\n3.  建立一个具有 $Q=200$ 个点的高阶高斯-勒让德求积法则。\n4.  在 $Q$ 个求积点上计算拉格朗日基函数 $\\ell_j(x)$ 及其导数 $\\ell_j'(x)$ 的值。\n5.  使用这些值通过数值求积计算一致质量矩阵 $M$。\n6.  对于每个测试用例：\n    a. 通过在GLL节点上计算给定函数的值来确定节点解向量 $u$。\n    b. 计算配置残差 $r^{\\mathrm{UI}} = D f(u)$。\n    c. 通过高阶求积法则积分 $-\\ell_i'(x)f(u_h(x))$ 来计算伽辽金载荷向量 $g$。\n    d. 求解线性系统 $M r^{\\mathrm{FI}} = g$ 以找到伽辽金残差 $r^{\\mathrm{FI}}$。\n    e. 计算三个所需的量：$\\|r^{\\mathrm{FI}}-r^{\\mathrm{UI}}\\|_{M}$、$\\dot{E}_h(u;r^{\\mathrm{UI}})$ 和 $\\dot{E}_h(u;r^{\\mathrm{FI}})$。\n然后收集结果并按规定格式化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import roots_jacobi, eval_legendre\n\ndef get_gll_nodes(n):\n    \"\"\"\n    Computes the N+1 Gauss-Lobatto-Legendre nodes on [-1, 1].\n    \"\"\"\n    if n == 0:\n        return np.array([0.0])\n    if n == 1:\n        return np.array([-1.0, 1.0])\n    \n    # Interior nodes are roots of P_n'(x), which are roots of Jacobi P_{n-1}^{(1,1)}(x)\n    interior_nodes, _ = roots_jacobi(n - 1, 1, 1)\n    nodes = np.concatenate(([-1.0], np.sort(interior_nodes), [1.0]))\n    return nodes\n\ndef get_diff_matrix(n, nodes):\n    \"\"\"\n    Computes the (N+1)x(N+1) differentiation matrix D_ij = l'_j(x_i).\n    \"\"\"\n    D = np.zeros((n + 1, n + 1))\n    pn_vals_at_nodes = eval_legendre(n, nodes)\n    \n    for i in range(n + 1):\n        for j in range(n + 1):\n            if i == j:\n                if i == 0:\n                    D[i, j] = -n * (n + 1) / 4.0\n                elif i == n:\n                    D[i, j] = n * (n + 1) / 4.0\n                else:\n                    D[i, j] = 0.0\n            else:\n                D[i, j] = pn_vals_at_nodes[i] / (pn_vals_at_nodes[j] * (nodes[i] - nodes[j]))\n    return D\n\ndef lagrange_basis_poly(nodes, j):\n    \"\"\"\n    Returns a polynomial object for the j-th Lagrange basis function l_j(x).\n    \"\"\"\n    p = np.polynomial.Polynomial([1.0])\n    for k, node_k in enumerate(nodes):\n        if k == j:\n            continue\n        p = p * np.polynomial.Polynomial([-node_k, 1.0]) / (nodes[j] - node_k)\n    return p\n\ndef evaluate_basis_at_quad_points(nodes, quad_points):\n    \"\"\"\n    Evaluates all Lagrange basis functions and their derivatives at quadrature points.\n    Returns L, L_prime where L[q,j] = l_j(z_q) and L_prime[q,j] = l'_j(z_q).\n    \"\"\"\n    n_nodes = len(nodes)\n    n_quad = len(quad_points)\n    \n    L = np.zeros((n_quad, n_nodes))\n    L_prime = np.zeros((n_quad, n_nodes))\n    \n    for j in range(n_nodes):\n        lj = lagrange_basis_poly(nodes, j)\n        lj_prime = lj.deriv()\n        L[:, j] = lj(quad_points)\n        L_prime[:, j] = lj_prime(quad_points)\n        \n    return L, L_prime\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem as specified.\n    \"\"\"\n    N = 6  # Polynomial degree\n    Q = 200 # Number of quadrature points for 'exact' integration\n\n    # 1. Setup SEM components\n    gll_nodes = get_gll_nodes(N)\n    diff_matrix_D = get_diff_matrix(N, gll_nodes)\n    \n    # 2. Setup high-order quadrature\n    gl_quad_points, gl_quad_weights = np.polynomial.legendre.leggauss(Q)\n    \n    # 3. Evaluate basis functions and derivatives at quadrature points\n    L_mat, L_prime_mat = evaluate_basis_at_quad_points(gll_nodes, gl_quad_points)\n    \n    # 4. Compute consistent mass matrix M using high-order quadrature\n    # M_ij = integral(l_i * l_j dx) ~ sum_q w_q * l_i(z_q) * l_j(z_q)\n    M = (L_mat.T * gl_quad_weights) @ L_mat\n\n    # 5. Define test cases\n    test_cases = {\n        'A': lambda x: np.sin(np.pi * x) + 0.5 * np.sin(2 * np.pi * x),\n        'B': lambda x: x**3 - x,\n        'C': lambda x: eval_legendre(N, x)\n    }\n    \n    results = []\n    \n    for case_id in ['A', 'B', 'C']:\n        # Get nodal values for the current test case\n        u_func = test_cases[case_id]\n        u_nodal = u_func(gll_nodes)\n        \n        # Flux at nodes\n        f_u_nodal = 0.5 * u_nodal**2\n        \n        # Compute under-integrated (collocation) residual\n        r_UI = diff_matrix_D @ f_u_nodal\n        \n        # Compute fully integrated (Galerkin) residual\n        # Reconstruct u_h and f(u_h) at quadrature points\n        u_h_at_quad = L_mat @ u_nodal\n        f_uh_at_quad = 0.5 * u_h_at_quad**2\n        \n        # Compute load vector g\n        # g_i = - integral( l'_i * f(u_h) dx ) ~ - sum_q w_q * l'_i(z_q) * f(u_h(z_q))\n        g = -L_prime_mat.T @ (gl_quad_weights * f_uh_at_quad)\n\n        # Solve M * r_FI = g\n        r_FI = np.linalg.solve(M, g)\n        \n        # --- Compute required quantities ---\n        \n        # Mass-weighted difference norm ||r_FI - r_UI||_M\n        r_diff = r_FI - r_UI\n        diff_norm_sq = r_diff.T @ M @ r_diff\n        diff_norm = np.sqrt(diff_norm_sq)\n        \n        # Under-integrated energy production rate\n        E_dot_UI = u_nodal.T @ M @ r_UI\n        \n        # Fully integrated energy production rate\n        E_dot_FI = u_nodal.T @ M @ r_FI\n        \n        results.extend([diff_norm, E_dot_UI, E_dot_FI])\n\n    # Format output to 10 decimal places as specified\n    formatted_results = [f\"{val:.10f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2597924"}]}