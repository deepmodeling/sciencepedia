{"hands_on_practices": [{"introduction": "在深入研究计算方法之前，通过一个可以解析求解的经典案例来巩固理论基础是至关重要的。本练习 [@problem_id:2565061] 旨在引导您应用双尺度渐进展开法，来处理一个层状复合材料的抗平面剪切问题。您将亲自推导周期性单胞问题，计算均质化后的剪切刚度张量，并验证其结果与经典的串并联模型（即调和平均与算术平均）完全吻合，从而深刻理解微观结构、加载方向与宏观等效性能之间的内在联系。", "problem": "考虑一个占据有界Lipschitz域 $\\Omega \\subset \\mathbb{R}^{2}$ 的周期性层状复合材料中的线性弹性反平面剪切问题。平面外位移 $w^{\\varepsilon} : \\Omega \\to \\mathbb{R}$ 满足在 $\\Omega$ 中的平衡方程 $-\\nabla \\cdot \\left( \\mu\\left(\\frac{\\boldsymbol{x}}{\\varepsilon}\\right) \\nabla w^{\\varepsilon}(\\boldsymbol{x}) \\right) = f(\\boldsymbol{x})$，并带有齐次Dirichlet边界条件，其中 $\\varepsilon  0$ 是小尺度参数，$\\mu(\\boldsymbol{y})$ 是一个 $Y$-周期的剪切模量，周期胞为 $Y = (0,1)^{2}$。该复合材料是层垂直于 $x_{1}$ 轴的层状材料：在层 $0  y_{1}  \\theta$ 中 $\\mu(\\boldsymbol{y}) = \\mu_{1}$，在层 $\\theta  y_{1}  1$ 中 $\\mu(\\boldsymbol{y}) = \\mu_{2}$，其中 $\\theta \\in (0,1)$ 为固定的体积分数，$\\mu_{1}  0$ 和 $\\mu_{2}  0$ 为正常数。\n\n在均匀化理论的框架内，使用双尺度渐近展开，推导周期性胞元问题，并计算均匀化剪切刚度张量 $\\mathbb{C}^{\\ast} \\in \\mathbb{R}^{2 \\times 2}$，使得在均匀化极限下，宏观通量满足 $\\boldsymbol{q}^{\\ast} = \\mathbb{C}^{\\ast} \\nabla w_{0}$。将 $\\mathbb{C}^{\\ast}$ 用 $\\mu_{1}$、$\\mu_{2}$ 和 $\\theta$ 明确表示。然后，通过对推导出的胞元问题进行解析推理，验证 $\\mathbb{C}^{\\ast}$ 的主分量与根据相对于层的加载方向而定的精确串联和并联界限相一致。\n\n你的最终答案必须是单一矩阵 $\\mathbb{C}^{\\ast}$，以 $\\mu_{1}$、$\\mu_{2}$ 和 $\\theta$ 的闭式解析表达式形式给出。不需要进行数值计算，最终答案中也不需要单位。", "solution": "所述问题是有效的。这是一个在复合材料均匀化理论领域内，基于线性弹性和渐近分析的既定原则的、适定的、有科学依据的问题。所有必要的数据和定义都已提供，不存在内部矛盾、模糊之处或事实错误。我们将开始推导。\n\n该问题控制反平面剪切变形，由满足平衡方程的平面外位移 $w^{\\varepsilon}(\\boldsymbol{x})$ 描述：\n$$-\\nabla \\cdot \\left( \\mu\\left(\\frac{\\boldsymbol{x}}{\\varepsilon}\\right) \\nabla w^{\\varepsilon}(\\boldsymbol{x}) \\right) = f(\\boldsymbol{x}) \\quad \\text{in } \\Omega \\subset \\mathbb{R}^{2}$$\n剪切模量 $\\mu(\\boldsymbol{y})$ 是一个 $Y$-周期函数，其中 $\\boldsymbol{y} = \\boldsymbol{x}/\\varepsilon$ 是快尺度变量，$Y = (0,1)^{2}$ 是单位胞元。该材料是层垂直于 $x_{1}$ 轴的层状材料，这意味着 $\\mu(\\boldsymbol{y}) = \\mu(y_1)$。\n\n我们采用双尺度渐近展开法，假设解的形式为：\n$$w^{\\varepsilon}(\\boldsymbol{x}) = w_{0}(\\boldsymbol{x}) + \\varepsilon w_{1}(\\boldsymbol{x}, \\boldsymbol{y}) + \\varepsilon^{2} w_{2}(\\boldsymbol{x}, \\boldsymbol{y}) + \\dots$$\n其中每个 $w_{i}(\\boldsymbol{x}, \\boldsymbol{y})$ 关于 $\\boldsymbol{y}$ 是 $Y$-周期的。梯度算子根据链式法则进行变换：$\\nabla = \\nabla_{\\boldsymbol{x}} + \\frac{1}{\\varepsilon}\\nabla_{\\boldsymbol{y}}$。将该展开式代入控制方程，得到：\n$$-\\left(\\nabla_{\\boldsymbol{x}} + \\frac{1}{\\varepsilon}\\nabla_{\\boldsymbol{y}}\\right) \\cdot \\left[ \\mu(\\boldsymbol{y}) \\left(\\nabla_{\\boldsymbol{x}} + \\frac{1}{\\varepsilon}\\nabla_{\\boldsymbol{y}}\\right) (w_{0} + \\varepsilon w_{1} + \\dots) \\right] = f(\\boldsymbol{x})$$\n\n我们根据 $\\varepsilon$ 的幂次展开并收集各项：\n$$O(\\varepsilon^{-2}): \\quad -\\nabla_{\\boldsymbol{y}} \\cdot (\\mu(\\boldsymbol{y}) \\nabla_{\\boldsymbol{y}} w_{0}) = 0$$\n$$O(\\varepsilon^{-1}): \\quad -\\nabla_{\\boldsymbol{y}} \\cdot (\\mu(\\boldsymbol{y}) \\nabla_{\\boldsymbol{x}} w_{0}) - \\nabla_{\\boldsymbol{y}} \\cdot (\\mu(\\boldsymbol{y}) \\nabla_{\\boldsymbol{y}} w_{1}) = 0$$\n$$O(\\varepsilon^{0}): \\quad -\\nabla_{\\boldsymbol{x}} \\cdot (\\mu(\\boldsymbol{y}) \\nabla_{\\boldsymbol{x}} w_{0}) - \\nabla_{\\boldsymbol{x}} \\cdot (\\mu(\\boldsymbol{y}) \\nabla_{\\boldsymbol{y}} w_{1}) - \\nabla_{\\boldsymbol{y}} \\cdot (\\mu(\\boldsymbol{y}) \\nabla_{\\boldsymbol{x}} w_{1}) - \\nabla_{\\boldsymbol{y}} \\cdot (\\mu(\\boldsymbol{y}) \\nabla_{\\boldsymbol{y}} w_{2}) = f(\\boldsymbol{x})$$\n\n从 $O(\\varepsilon^{-2})$ 方程可知，由于 $\\mu  0$ 且我们寻求 $w_0$ 在 $\\boldsymbol{y}$ 上的周期解，因此 $w_0$ 必定与 $\\boldsymbol{y}$ 无关，即 $w_{0}(\\boldsymbol{x}, \\boldsymbol{y}) = w_{0}(\\boldsymbol{x})$。\n\n$O(\\varepsilon^{-1})$ 方程是关于 $w_{1}$ 在单位胞元 $Y$ 上的问题。鉴于 $w_{0}$ 与 $\\boldsymbol{y}$ 无关，我们可以将 $\\nabla_{\\boldsymbol{x}}w_0$ 作为一个因子。我们寻求一个对 $\\nabla_{\\boldsymbol{x}}w_0$ 呈线性的 $w_1$ 解：\n$$w_{1}(\\boldsymbol{x}, \\boldsymbol{y}) = \\sum_{k=1}^{2} \\chi_{k}(\\boldsymbol{y}) \\frac{\\partial w_{0}}{\\partial x_{k}}(\\boldsymbol{x})$$\n其中 $\\chi_{k}(\\boldsymbol{y})$ 是未知的胞元函数，也称为修正子。将此拟设代入 $O(\\varepsilon^{-1})$ 方程，得到每个修正子 $\\chi_k$ 的一组问题：\n$$-\\nabla_{\\boldsymbol{y}} \\cdot (\\mu(\\boldsymbol{y}) \\boldsymbol{e}_{k}) - \\nabla_{\\boldsymbol{y}} \\cdot (\\mu(\\boldsymbol{y}) \\nabla_{\\boldsymbol{y}} \\chi_{k}(\\boldsymbol{y})) = 0 \\quad \\text{for } k=1, 2$$\n这就是胞元问题，我们将其重写为：\n$$-\\nabla_{\\boldsymbol{y}} \\cdot (\\mu(\\boldsymbol{y}) \\nabla_{\\boldsymbol{y}} \\chi_{k}(\\boldsymbol{y})) = \\nabla_{\\boldsymbol{y}} \\cdot (\\mu(\\boldsymbol{y}) \\boldsymbol{e}_{k})$$\n求解 $Y$-周期的、均值为零的 $\\chi_k$，即 $\\int_{Y} \\chi_{k}(\\boldsymbol{y}) d\\boldsymbol{y} = 0$。\n\n接下来，我们在单位胞元 $Y$ 上对 $O(\\varepsilon^{0})$ 方程进行平均。由于周期性，$\\nabla_{\\boldsymbol{y}} \\cdot (\\dots)$ 项在积分后消失。我们剩下：\n$$-\\int_{Y} \\left[ \\nabla_{\\boldsymbol{x}} \\cdot (\\mu \\nabla_{\\boldsymbol{x}} w_{0}) + \\nabla_{\\boldsymbol{x}} \\cdot (\\mu \\nabla_{\\boldsymbol{y}} w_{1}) \\right] d\\boldsymbol{y} = \\int_{Y} f(\\boldsymbol{x}) d\\boldsymbol{y}$$\n由于 $\\nabla_x$ 作用于宏观变量，它可以被提到积分符号外面。注意到 $|Y|=1$：\n$$-\\nabla_{\\boldsymbol{x}} \\cdot \\left( \\int_{Y} \\mu(\\boldsymbol{y}) (\\nabla_{\\boldsymbol{x}} w_{0} + \\nabla_{\\boldsymbol{y}} w_{1}) d\\boldsymbol{y} \\right) = f(\\boldsymbol{x})$$\n括号内的项是均匀化通量，其对应的刚度张量 $\\mathbb{C}^{\\ast}$ 定义为 $\\boldsymbol{q}^{\\ast} = \\mathbb{C}^{\\ast} \\nabla w_{0}$。剪切通量为 $\\boldsymbol{q} = -\\mu \\nabla w$，则均匀化刚度张量由下式给出：\n$$C_{ij}^{\\ast} = \\int_{Y} \\mu(\\boldsymbol{y}) \\left( \\delta_{ij} + \\frac{\\partial \\chi_{j}(\\boldsymbol{y})}{\\partial y_{i}} \\right) d\\boldsymbol{y}$$\n\n现在，我们针对特定的层状结构求解胞元问题，其中 $\\mu(\\boldsymbol{y}) = \\mu(y_1)$。\n对于 $k=1$：\n$$-\\nabla_{\\boldsymbol{y}} \\cdot (\\mu(y_1) \\nabla_{\\boldsymbol{y}} \\chi_{1}) = \\frac{\\partial \\mu(y_1)}{\\partial y_{1}}$$\n我们假设 $\\chi_1$ 仅依赖于 $y_1$。方程变为 $-\\frac{d}{dy_1}\\left(\\mu(y_1)\\frac{d\\chi_1}{dy_1}\\right) = \\frac{d\\mu}{dy_1}$。积分一次得到 $\\mu(y_1)\\frac{d\\chi_1}{dy_1} = -\\mu(y_1) + C$，其中 $C$ 为某个常数。因此，$\\frac{d\\chi_1}{dy_1} = -1 + \\frac{C}{\\mu(y_1)}$。为了使 $\\chi_1$ 是周期的，必须有 $\\int_0^1 \\frac{d\\chi_1}{dy_1} dy_1 = 0$，这给出 $\\int_0^1 (-1 + \\frac{C}{\\mu(y_1)}) dy_1 = 0$。这确定了常数 $C = \\left(\\int_0^1 \\frac{1}{\\mu(y_1)} dy_1\\right)^{-1}$。\n\n对于 $k=2$：\n$$-\\nabla_{\\boldsymbol{y}} \\cdot (\\mu(y_1) \\nabla_{\\boldsymbol{y}} \\chi_{2}) = \\frac{\\partial \\mu(y_1)}{\\partial y_{2}} = 0$$\n这个齐次方程的唯一零均值 $Y$-周期解是 $\\chi_{2}(\\boldsymbol{y}) = 0$。\n\n现在我们计算 $\\mathbb{C}^{\\ast}$ 的分量。\n$C_{12}^{\\ast} = \\int_Y \\mu(y_1) \\frac{\\partial \\chi_2}{\\partial y_1} d\\boldsymbol{y} = 0$ 因为 $\\chi_2=0$。\n$C_{21}^{\\ast} = \\int_Y \\mu(y_1) \\frac{\\partial \\chi_1}{\\partial y_2} d\\boldsymbol{y} = 0$ 因为 $\\chi_1=\\chi_1(y_1)$。\n该张量是对角的。\n\n对于对角分量：\n$C_{11}^{\\ast} = \\int_Y \\mu(y_1) \\left(1 + \\frac{\\partial \\chi_1}{\\partial y_1}\\right) d\\boldsymbol{y} = \\int_0^1 \\mu(y_1) \\left(1 + \\left(-1 + \\frac{C}{\\mu(y_1)}\\right)\\right) dy_1 = \\int_0^1 C dy_1 = C$。\n因此，$C_{11}^{\\ast} = \\left(\\int_0^1 \\frac{1}{\\mu(y_1)} dy_1\\right)^{-1}$。这是 $\\mu$ 的调和平均值。\n\n$C_{22}^{\\ast} = \\int_Y \\mu(y_1) \\left(1 + \\frac{\\partial \\chi_2}{\\partial y_2}\\right) d\\boldsymbol{y} = \\int_0^1 \\mu(y_1) (1+0) dy_1 = \\int_0^1 \\mu(y_1) dy_1$。这是 $\\mu$ 的算术平均值。\n\n最后，我们代入给定的关于 $\\mu(y_1)$ 的分段常数函数：当 $y_1 \\in (0, \\theta)$ 时 $\\mu = \\mu_1$，当 $y_1 \\in (\\theta, 1)$ 时 $\\mu = \\mu_2$。\n调和平均值为：\n$$C_{11}^{\\ast} = \\left( \\int_0^{\\theta} \\frac{1}{\\mu_1} dy_1 + \\int_{\\theta}^{1} \\frac{1}{\\mu_2} dy_1 \\right)^{-1} = \\left( \\frac{\\theta}{\\mu_1} + \\frac{1-\\theta}{\\mu_2} \\right)^{-1} = \\frac{\\mu_1 \\mu_2}{\\theta\\mu_2 + (1-\\theta)\\mu_1}$$\n算术平均值为：\n$$C_{22}^{\\ast} = \\int_0^{\\theta} \\mu_1 dy_1 + \\int_{\\theta}^{1} \\mu_2 dy_1 = \\theta\\mu_1 + (1-\\theta)\\mu_2$$\n\n因此，均匀化刚度张量为：\n$$\\mathbb{C}^{\\ast} = \\begin{pmatrix} C_{11}^{\\ast}  0 \\\\ 0  C_{22}^{\\ast} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\mu_1 \\mu_2}{\\theta\\mu_2 + (1-\\theta)\\mu_1}  0 \\\\ 0  \\theta\\mu_1 + (1-\\theta)\\mu_2 \\end{pmatrix}$$\n\n这个结果与物理推理相符。分量 $C_{11}^{\\ast}$ 代表沿 $x_1$ 轴（垂直于层）的剪切梯度对应的等效刚度。这对应于一个“串联”力学模型，其等效属性是调和平均。分量 $C_{22}^{\\ast}$ 是沿 $x_2$ 轴（平行于层）的剪切梯度对应的等效刚度。这对应于一个“并联”力学模型，其等效属性是算术平均。我们推导出的胞元问题和得到的均匀化系数正确地再现了层状材料的这些精确界限。", "answer": "$$\\boxed{\\mathbb{C}^{\\ast} = \\begin{pmatrix} \\frac{\\mu_{1}\\mu_{2}}{(1-\\theta)\\mu_{1} + \\theta\\mu_{2}}  0 \\\\ 0  (1-\\theta)\\mu_{2} + \\theta\\mu_{1} \\end{pmatrix}}$$", "id": "2565061"}, {"introduction": "将理论转化为可执行的代码是计算力学的核心技能。本练习 [@problem_id:2565137] 将指导您完成这一关键步骤，通过有限元方法求解一个一维周期性单胞问题。您将学习如何处理周期性边界条件，并使用拉格朗日乘子法来精确施加修正函数零均值的约束，最终组装并求解一个鞍点问题的线性系统，这是计算均质化中一个基本且普遍的技巧。", "problem": "考虑一个周期性单胞上的标量稳态扩散问题。令 $Y = (0,1)$ 表示一维单位单胞，其周期性坐标为 $y \\in Y$。令 $A(y)$ 为一个正、有界、可测的扩散系数，且是 $Y$-周期性的。在复合材料的一阶周期性均匀化中，针对单位宏观梯度的修正子 $w(y)$ 被定义为一个 $Y$-周期函数，它满足弱形式的单胞问题，并且在 $Y$ 上的均值为零。\n\n您的任务是使用有限元方法（FEM）实现单胞问题的弱形式，并通过一个拉格朗日乘子来施加对修正子的零均值约束。您必须指定函数空间，组装离散系统，求解该系统，然后将离散均匀化系数计算为一种能量。\n\n公式：\n- 针对单位宏观梯度的一维周期性单胞问题的强形式由微观通量 $q(y)$ 的平衡给出：\n$$\nq(y) = A(y)\\left(1 + \\frac{dw}{dy}(y)\\right), \\quad -\\frac{dq}{dy}(y) = 0 \\ \\text{in}\\ Y,\n$$\n其中 $w$ 是 $Y$-周期性的，并且均值为零。\n- 相应的弱形式为：寻找 $w \\in V$ 和一个拉格朗日乘子 $\\lambda \\in \\mathbb{R}$，使得\n$$\n\\int_Y A(y)\\,\\frac{dw}{dy}(y)\\,\\frac{dv}{dy}(y)\\,dy + \\lambda \\int_Y v(y)\\,dy \\;=\\; -\\int_Y A(y)\\,\\frac{dv}{dy}(y)\\,dy \\quad \\text{对于所有 } v \\in V,\n$$\n并且\n$$\n\\int_Y w(y)\\,dy \\;=\\; 0.\n$$\n\n函数空间：\n- 试探和检验空间是闭子空间 $V \\subset H^1_{\\text{per}}(Y)$，由 Sobolev 空间 $H^1(Y)$ 中的 $Y$-周期函数组成；零均值约束由拉格朗日乘子施加，因此 $V$ 本身不包含零均值条件。\n- 拉格朗日乘子空间为 $\\mathbb{R}$，用于施加约束 $\\int_Y w \\, dy = 0$。\n\n有限元离散化：\n- 在 $Y$ 上选择一个包含 $N$ 个单元的均匀网格，节点位于 $y_i = i h$ (其中 $i \\in \\{0,1,\\dots,N-1\\}$)，网格尺寸为 $h = 1/N$。通过将 $y=1$ 处的节点与 $y=0$ 处的节点视为同一节点来施加周期性。在此周期性网格（端点已识别）上使用标准的连续分片线性有限元空间 $V_h \\subset V$。\n- 离散未知量为 $(w_h,\\lambda_h) \\in V_h \\times \\mathbb{R}$，满足离散混合弱形式：\n$$\n\\sum_{e} \\int_{e} A(y)\\, \\frac{dw_h}{dy}(y)\\, \\frac{dv_h}{dy}(y)\\,dy \\;+\\; \\lambda_h \\int_Y v_h(y)\\,dy \\;=\\; -\\sum_{e} \\int_{e} A(y)\\, \\frac{dv_h}{dy}(y)\\,dy \\quad \\text{对于所有 } v_h \\in V_h,\n$$\n并且\n$$\n\\int_Y w_h(y)\\,dy \\;=\\; 0,\n$$\n其中求和遍历所有网格单元 $e$。每个单元使用两点高斯求积来近似计算积分。以鞍点形式组装线性系统，其中的约束向量来自于与常数函数的一致 $L^2$ 内积。\n\n后处理：\n- 求解出 $w_h$ 后，将离散均匀化系数计算为能量\n$$\nA_{\\text{hom},h} \\;=\\; \\sum_{e} \\int_{e} A(y)\\,\\left(1 + \\frac{dw_h}{dy}(y)\\right)^2 dy,\n$$\n在此设定中，该系数是无量纲的。\n\n实现要求：\n- 拓扑上将周期性网格实现为一个环：每个单元连接节点 $i$ 和节点 $j = (i+1) \\bmod N$，从而使网格覆盖 $Y$ 一次。\n- 对所有单元积分使用两点高斯求积。\n- 组装全局刚度矩阵、约束向量和右端项，然后求解得到的 $(N+1)\\times(N+1)$ 线性系统以获得 $(w_h,\\lambda_h)$。\n\n测试套件：\n使用以下测试用例，其中指定了系数 $A(y)$ 和单元数量 $N$。\n- 用例 1（分段常数，中等对比度）：\n  - $A(y) = 1$ 当 $0 \\le y  0.5$，且 $A(y) = 10$ 当 $0.5 \\le y  1$。\n  - $N = 64$。\n- 用例 2（光滑，严格为正）：\n  - $A(y) = 2 + \\sin(2\\pi y)$。\n  - $N = 96$。\n- 用例 3（分段常数，高对比度）：\n  - $A(y) = 0.1$ 当 $0 \\le y  0.5$，且 $A(y) = 10$ 当 $0.5 \\le y  1$。\n  - $N = 128$。\n- 用例 4（均匀介质，合理性检查）：\n  - $A(y) = 5$ 对于所有 $y \\in Y$。\n  - $N = 8$。\n\n输出规格：\n- 对于每个用例，使用上述能量公式计算离散均匀化系数 $A_{\\text{hom},h}$，并将其报告为浮点数。\n- 您的程序应生成单行输出，其中包含这四个结果，按用例 1 到 4 的顺序排列，形式为方括号内的逗号分隔列表，每个结果四舍五入到八位小数，无单位（无量纲）。\n- 示例格式：“[1.23456789,2.34567890,3.45678901,4.56789012]”。\n\n此问题中没有物理单位；所有量均为无量纲。", "solution": "所提出的问题是周期性均匀化理论中的一个标准单胞问题，将使用有限元方法（FEM）来求解。该问题是适定的、科学上合理的，并包含获得唯一解所需的所有信息。我将继续进行推导和实现。\n\n目标是求解一维周期性复合材料的修正子函数 $w(y)$ 和均匀化系数 $A_{\\text{hom}}$。该问题被表述为一个混合弱形式，我们将使用连续分片线性有限元对其进行离散化。\n\n弱形式为：寻找 $(w, \\lambda) \\in V \\times \\mathbb{R}$，使得对于所有 $v \\in V$：\n$$\n\\int_Y A(y)\\,\\frac{dw}{dy}(y)\\,\\frac{dv}{dy}(y)\\,dy + \\lambda \\int_Y v(y)\\,dy \\;=\\; -\\int_Y A(y)\\,\\frac{dv}{dy}(y)\\,dy\n$$\n$$\n\\int_Y w(y)\\,dy \\;=\\; 0\n$$\n其中 $V = H^1_{\\text{per}}(Y)$ 是 $H^1(Y)$ 中的周期函数空间。\n\n我们将单位单胞 $Y=(0,1)$ 离散为 $N$ 个尺寸为 $h=1/N$ 的均匀单元。节点为 $y_i = i h$，其中 $i \\in \\{0, 1, \\dots, N-1\\}$。由于周期性， $y=1$ 处的节点与 $y=0$ 处的节点被视为同一节点，从而得到 $N$ 个不同的节点。有限元空间 $V_h \\subset V$ 由连续分片线性（P1）函数组成。任何函数 $u_h \\in V_h$ 都可以写成 $u_h(y) = \\sum_{j=0}^{N-1} u_j N_j(y)$，其中 $u_j$ 是节点值，$N_j(y)$ 是 P1“帽子”基函数。\n\n将试探函数 $w_h(y) = \\sum_{j=0}^{N-1} w_j N_j(y)$ 和检验函数 $v_h(y) = N_i(y)$（其中 $i=0, \\dots, N-1$）的展开式代入弱形式，得到一个线性代数方程组。该系统通过由拉格朗日乘子 $\\lambda_h$ 施加的零均值约束的离散形式进行增广。得到的代数系统具有鞍点结构：\n$$\n\\begin{pmatrix}\n\\mathbf{K}  \\mathbf{B}^T \\\\\n\\mathbf{B}  0\n\\end{pmatrix}\n\\begin{pmatrix}\n\\mathbf{w} \\\\\n\\lambda_h\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\mathbf{f} \\\\\n0\n\\end{pmatrix}\n$$\n此处，$\\mathbf{w} = (w_0, \\dots, w_{N-1})^T$ 是修正子节点值的向量。矩阵 $\\mathbf{K}$、向量 $\\mathbf{B}$ 和 $\\mathbf{f}$ 由其分量定义：\n-   刚度矩阵 $\\mathbf{K} \\in \\mathbb{R}^{N \\times N}$: $K_{ij} = \\int_Y A(y) \\frac{dN_j}{dy} \\frac{dN_i}{dy} dy$\n-   约束向量 $\\mathbf{B} \\in \\mathbb{R}^{1 \\times N}$: $B_j = \\int_Y N_j(y) dy$\n-   载荷向量 $\\mathbf{f} \\in \\mathbb{R}^{N \\times 1}$: $f_i = -\\int_Y A(y) \\frac{dN_i}{dy} dy$\n\n我们通过对每个单元 $e_k = [y_k, y_{(k+1)\\pmod N}]$（其中 $k=0, \\dots, N-1$）的贡献求和来组装这些分量。每个单元上的积分使用两点高斯求积进行近似。\n\n在一个单元 $e_k$ 上，基函数的导数是常数：$\\frac{dN_k}{dy} = -1/h$ 和 $\\frac{dN_{(k+1)\\pmod N}}{dy} = 1/h$。\n单元刚度矩阵为：\n$$\n\\mathbf{K}^k = \\frac{1}{h^2} \\left( \\int_{e_k} A(y) dy \\right) \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n单元载荷向量的贡献来自于项 $-\\int_{e_k} A(y) \\frac{dv_h}{dy} dy$。对于 $v_h=N_k$ 和 $v_h=N_{(k+1)\\pmod N}$，这给出：\n$$\n\\mathbf{f}^k = -\\frac{1}{h} \\left( \\int_{e_k} A(y) dy \\right) \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}\n$$\n约束向量的分量是 $B_j = \\int_Y N_j(y) dy$。对于一个 P1 基函数，$\\int_Y N_j(y) dy = h$。在支撑 $N_j(y)$ 的两个单元上使用两点高斯求积，可以精确地重现这个结果。因此，$\\mathbf{B} = [h, h, \\dots, h]$。\n\n系数 $A(y)$ 在单元 $e_k$ 上的积分近似为：\n$$\n\\int_{e_k} A(y) dy \\approx \\frac{h}{2} \\left( A(y_{g1}) + A(y_{g2}) \\right) = h I_{e_k}\n$$\n其中 $y_{g1}, y_{g2}$ 是单元 $e_k$ 内的两个高斯点，$I_{e_k}$ 表示通过求积法则计算的 $A(y)$ 在该单元上的平均值。令 $C_{e_k} = I_{e_k}/h$。\n\n节点 $i$ 的全局系统分量组装如下：\n-   $K_{i,i} = C_{e_{(i-1)\\pmod N}} + C_{e_i}$\n-   $K_{i, (i+1)\\pmod N} = -C_{e_i}$\n-   $f_i = I_{e_i} - I_{e_{(i-1)\\pmod N}}$\n-   $(\\mathbf{B}^T)_i = h$ and $B_i = h$\n\n在求解 $(N+1) \\times (N+1)$ 线性系统以获得修正子节点值 $\\mathbf{w}$ 和乘子 $\\lambda_h$ 后，我们计算离散均匀化系数 $A_{\\text{hom},h}$。在每个单元 $e_k$ 上，修正子的导数是常数：$\\frac{dw_h}{dy} = \\frac{w_{(k+1)\\pmod N} - w_k}{h}$。均匀化系数被计算为能量平均值：\n$$\nA_{\\text{hom},h} = \\sum_{k=0}^{N-1} \\int_{e_k} A(y) \\left(1 + \\frac{dw_h}{dy}\\right)^2 dy\n$$\n使用高斯求积计算 $A(y)$ 的积分：\n$$\nA_{\\text{hom},h} = \\sum_{k=0}^{N-1} (h I_{e_k}) \\left(1 + \\frac{w_{(k+1)\\pmod N} - w_k}{h}\\right)^2\n$$\n这个过程是系统性的，并实现了指定的混合有限元公式。所提供的合理性检查用例，即 $A(y)$ 为常数的情况，正确地得出 $w_h=0$ 和 $A_{\\text{hom},h} = A(y)$，从而验证了该公式的正确性。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the homogenization problem for all test cases.\n    \"\"\"\n\n    def solve_homogenization(A_func, N):\n        \"\"\"\n        Assembles and solves the 1D homogenization cell problem using FEM.\n\n        Args:\n            A_func (callable): A function A(y) defining the diffusion coefficient.\n            N (int): The number of elements in the mesh.\n\n        Returns:\n            float: The computed homogenized coefficient A_hom.\n        \"\"\"\n        h = 1.0 / N\n        sqrt3 = np.sqrt(3.0)\n\n        # Element-wise properties\n        I_e = np.zeros(N)  # Quadrature approx. of average A(y) on element e\n        C_e = np.zeros(N)  # I_e / h, for stiffness matrix assembly\n\n        for i in range(N):\n            # Element e_i connects nodes i and (i+1)%N.\n            # Node i is at y = i*h.\n            y_mid = (i + 0.5) * h\n            y_g1 = y_mid - h / (2.0 * sqrt3)\n            y_g2 = y_mid + h / (2.0 * sqrt3)\n            \n            A_g1 = A_func(y_g1)\n            A_g2 = A_func(y_g2)\n            \n            # Integral of A(y) over element i is approx. h * I_e[i]\n            I_e[i] = 0.5 * (A_g1 + A_g2)\n            \n            # Stiffness contribution from element i\n            C_e[i] = I_e[i] / h\n\n        # Assemble the (N+1)x(N+1) saddle-point system matrix and RHS vector\n        A_sys = np.zeros((N + 1, N + 1))\n        F_sys = np.zeros(N + 1)\n\n        # Assemble stiffness matrix K (top-left NxN block of A_sys)\n        for i in range(N):\n            # Diagonal term K_ii from elements (i-1) and i\n            A_sys[i, i] = C_e[(i - 1 + N) % N] + C_e[i]\n            \n            # Off-diagonal term K_{i, i+1} from element i\n            j = (i + 1) % N\n            A_sys[i, j] -= C_e[i]\n            A_sys[j, i] -= C_e[i]\n\n        # Assemble constraint vector B and its transpose B^T\n        A_sys[N, :N] = h  # Row B\n        A_sys[:N, N] = h  # Column B^T\n        \n        # Assemble load vector f (top N entries of F_sys)\n        for i in range(N):\n            F_sys[i] = I_e[i] - I_e[(i - 1 + N) % N]\n        \n        # Solve the linear system A_sys * x = F_sys\n        try:\n            solution = np.linalg.solve(A_sys, F_sys)\n        except np.linalg.LinAlgError:\n            return np.nan # Should not happen for a well-posed problem\n\n        w = solution[:N]  # Corrector nodal values\n        # lambda_h = solution[N] # Lagrange multiplier, not needed for post-processing\n\n        # Post-processing: Compute the homogenized coefficient A_hom\n        A_hom = 0.0\n        for k in range(N):\n            w_k = w[k]\n            w_k_plus_1 = w[(k + 1) % N]\n            \n            # Constant derivative of w_h on element k\n            dw_dy_h = (w_k_plus_1 - w_k) / h\n            \n            # Add contribution from element k to the energy integral\n            integral_A_on_element = h * I_e[k]\n            A_hom += integral_A_on_element * (1.0 + dw_dy_h)**2\n            \n        return A_hom\n\n    # --- Test Cases ---\n    def A_case1(y):\n        return 1.0 if y  0.5 else 10.0\n\n    def A_case2(y):\n        return 2.0 + np.sin(2.0 * np.pi * y)\n\n    def A_case3(y):\n        return 0.1 if y  0.5 else 10.0\n\n    def A_case4(y):\n        return 5.0\n\n    test_cases = [\n        (A_case1, 64),\n        (A_case2, 96),\n        (A_case3, 128),\n        (A_case4, 8)\n    ]\n\n    results = []\n    for A_func, N in test_cases:\n        res = solve_homogenization(A_func, N)\n        results.append(res)\n    \n    # Format and print the final output as specified\n    formatted_results = [f'{r:.8f}' for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2565137"}, {"introduction": "掌握了基本原理和一维实现后，现在是时候将您的技能应用到更真实的二维复合材料微结构上了。本练习 [@problem_id:2565193] 要求您为一个包含圆形夹杂物的代表性体积单元（RVE）建立二维有限元模型。您将通过施加特定的宏观应变场（剪切和双轴拉伸），计算微观结构的应力响应，并最终根据能量平均原理提取等效的体积模量和剪切模量，并将其与经典的Hashin–Shtrikman界限进行比较，完成一次完整的计算均质化分析流程。", "problem": "给定一个二维代表性体积单元 (RVE)，其模型为一个单位正方形，包含一个以 (0.5,0.5) 为中心、半径为 $r$ 的圆形夹杂物。该复合材料由两个各向同性相组成：基体（相 $1$）和夹杂物（相 $2$）。每个相的特征是其三维各向同性体积模量 $K$ 和剪切模量 $G$，两者均以吉帕斯卡 (GPa) 为单位。目标是使用有限元法 (FEM)，在平面应变运动学和运动学均匀边界条件 (KUBC) 下，通过双线性四边形单元计算复合材料的有效体积模量 $K_{\\mathrm{eff}}$ 和有效剪切模量 $G_{\\mathrm{eff}}$，并将其与三维 Hashin–Shtrikman 界进行比较。\n\n推导必须从 小应变线性弹性 的定义和 Hill–Mandel 宏观均匀性条件开始。在小应变条件下，Cauchy 应力张量满足各向同性 Hooke 定律\n$$\n\\boldsymbol{\\sigma} = 2 G \\boldsymbol{\\varepsilon} + \\lambda \\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\mathbf{I},\n$$\n其中 Lamé 参数为 $\\lambda = K - \\tfrac{2}{3} G$，$\\boldsymbol{\\varepsilon}$ 为对称小应变张量。在平面应变中，采用 Voigt 记法并使用工程剪切应变 $\\gamma_{xy} = 2 \\varepsilon_{xy}$ 时，面内应力-应变定律为\n$$\n\\begin{bmatrix}\n\\sigma_{xx} \\\\ \\sigma_{yy} \\\\ \\sigma_{xy}\n\\end{bmatrix}\n=\n\\underbrace{\n\\begin{bmatrix}\n\\lambda + 2 G  \\lambda  0 \\\\\n\\lambda  \\lambda + 2 G  0 \\\\\n0  0  G\n\\end{bmatrix}\n}_{\\mathbf{D}(K,G)}\n\\begin{bmatrix}\n\\varepsilon_{xx} \\\\ \\varepsilon_{yy} \\\\ \\gamma_{xy}\n\\end{bmatrix}.\n$$\nHill–Mandel 条件要求宏观应力功率等于微观应力功率的体积平均值。在 KUBC 和给定的宏观应变 $\\overline{\\boldsymbol{\\varepsilon}}$ 条件下，这简化为计算由与 $\\overline{\\boldsymbol{\\varepsilon}}$ 一致的边界位移场产生的应力场的体积平均值。\n\n有限元法要求：\n- 用 $N \\times N$ 的均匀双线性四边形单元网格离散化单位正方形（总节点数为 $(N+1) \\times (N+1)$）。\n- 根据单元形心 $(x_c,y_c)$ 逐个单元分配相属性：如果 $(x_c - 0.5)^2 + (y_c - 0.5)^2 \\le r^2$，则该单元为相 $2$，否则为相 $1$。面积分数 $f_2$ 必须计算为相 $2$ 单元数量与总单元数量的比率；设 $f_1 = 1 - f_2$。\n- 使用平面应变运动学和上述本构矩阵 $\\mathbf{D}(K,G)$，其中 $K$ 和 $G$ 取自每个单元所属的相。\n- 每个单元使用 $2 \\times 2$ 的 Gauss 积分。\n- 通过在整个边界上施加位移场 $\\mathbf{u}(\\mathbf{x}) = \\overline{\\boldsymbol{\\varepsilon}} \\,\\mathbf{x}$ 来施加运动学均匀边界条件，其中 $\\overline{\\boldsymbol{\\varepsilon}}$ 是对称的。对于工程剪切应变，使用 $\\gamma_{xy} = 2 \\varepsilon_{xy}$，因此 $u_x = \\varepsilon_{xx} x + \\tfrac{\\gamma_{xy}}{2} y$ 且 $u_y = \\varepsilon_{yy} y + \\tfrac{\\gamma_{xy}}{2} x$。\n- 对于以下每个载荷工况，求解线性系统，计算 Gauss 点处的单元应力，并在单位正方形上对其进行体积平均以获得 $\\langle \\boldsymbol{\\sigma} \\rangle$。\n\n有效模量提取：\n- 剪切载荷：施加 $\\overline{\\varepsilon}_{xx} = 0$、$\\overline{\\varepsilon}_{yy} = 0$、$\\overline{\\gamma}_{xy} = \\gamma_0$，其中 $\\gamma_0 = 2 \\times 10^{-3}$。有效剪切模量为\n$$\nG_{\\mathrm{eff}} = \\frac{\\langle \\sigma_{xy} \\rangle}{\\gamma_0}.\n$$\n- 等双轴载荷：施加 $\\overline{\\varepsilon}_{xx} = e_0$、$\\overline{\\varepsilon}_{yy} = e_0$、$\\overline{\\gamma}_{xy} = 0$，其中 $e_0 = 10^{-3}$。假设宏观面内各向同性，从以下公式中确定有效 Lamé 参数\n$$\n\\langle \\sigma_{xx} \\rangle = \\left(2 \\lambda_{\\mathrm{eff}} + 2 G_{\\mathrm{eff}}\\right) e_0 \\quad \\Rightarrow \\quad \\lambda_{\\mathrm{eff}} = \\frac{\\langle \\sigma_{xx} \\rangle}{2 e_0} - G_{\\mathrm{eff}},\n$$\n然后是有效体积模量\n$$\nK_{\\mathrm{eff}} = \\lambda_{\\mathrm{eff}} + \\frac{2}{3} G_{\\mathrm{eff}}.\n$$\n所有模量必须以吉帕斯卡为单位报告。\n\n对于具有体积分数 $f_1$ 和 $f_2$ 的三维各向同性两相复合材料，其 Hashin–Shtrikman 界为\n$$\nK_{\\mathrm{HS}}^{-} = K_1 + \\frac{f_2}{\\dfrac{1}{K_2 - K_1} + \\dfrac{3 f_1}{3 K_1 + 4 G_1}}, \\quad\nK_{\\mathrm{HS}}^{+} = K_2 + \\frac{f_1}{\\dfrac{1}{K_1 - K_2} + \\dfrac{3 f_2}{3 K_2 + 4 G_2}},\n$$\n$$\nG_{\\mathrm{HS}}^{-} = G_1 + \\frac{f_2}{\\dfrac{1}{G_2 - G_1} + \\dfrac{6 f_1 (K_1 + 2 G_1)}{5 G_1 (3 K_1 + 4 G_1)}}, \\quad\nG_{\\mathrm{HS}}^{+} = G_2 + \\frac{f_1}{\\dfrac{1}{G_1 - G_2} + \\dfrac{6 f_2 (K_2 + 2 G_2)}{5 G_2 (3 K_2 + 4 G_2)}}.\n$$\n通过将下界和上界取为该公共值来处理 $K_1 = K_2$ 或 $G_1 = G_2$ 的简并等模量情况。\n\n测试套件：\n实现您的程序以评估以下四种情况。在每个元组中，参数为 $(N, r, K_1, G_1, K_2, G_2)$，其中 $K$ 和 $G$ 的单位为吉帕斯卡：\n- 情况 1：$(16, 0.30, 50.0, 20.0, 150.0, 60.0)$\n- 情况 2：$(12, 0.00, 50.0, 20.0, 150.0, 60.0)$\n- 情况 3：$(14, 0.35, 80.0, 30.0, 80.0, 30.0)$\n- 情况 4：$(18, 0.40, 50.0, 20.0, 1000.0, 400.0)$\n\n您的程序必须为每种情况计算数值 $(K_{\\mathrm{eff}}, G_{\\mathrm{eff}})$ 和四个 Hashin–Shtrikman 界 $(K_{\\mathrm{HS}}^{-}, K_{\\mathrm{HS}}^{+}, G_{\\mathrm{HS}}^{-}, G_{\\mathrm{HS}}^{+})$，其中使用由单元形心分配定义的面积分数 $f_2$。所有模量均以吉帕斯卡表示。不涉及角度；无需角度单位。应变为无量纲。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个结果列表，每个结果本身是按顺序 $[K_{\\mathrm{eff}}, G_{\\mathrm{eff}}, K_{\\mathrm{HS}}^{-}, K_{\\mathrm{HS}}^{+}, G_{\\mathrm{HS}}^{-}, G_{\\mathrm{HS}}^{+}]$ 排列的六个浮点数的列表，使用 Python 列表字面量表示。对于上述四种情况，最终打印的行必须如下所示：\n`[[...],...,[...]]`\n用实际数值代替点。", "solution": "所提出的问题是计算微观力学中一个适定的标准练习。它要求应用有限元法 (FEM) 在平面应变假设下确定二维两相复合材料的有效弹性性质。问题陈述在科学上是合理的、自洽的，并为获得唯一解提供了所有必要的数据和定义。我们将继续进行推导和实现。\n\n其理论基础是小应变线性弹性理论。每个各向同性相 $i$ 的本构行为由 Hooke 定律描述，该定律将 Cauchy 应力张量 $\\boldsymbol{\\sigma}$ 与无穷小应变张量 $\\boldsymbol{\\varepsilon}$ 联系起来：\n$$\n\\boldsymbol{\\sigma} = 2 G_i \\boldsymbol{\\varepsilon} + \\lambda_i \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\mathbf{I}\n$$\n其中 $G_i$ 是剪切模量，$\\mathbf{I}$ 是单位张量，$\\lambda_i = K_i - \\frac{2}{3} G_i$ 是第一 Lamé 参数，$K_i$ 是体积模量。对于平面应变的二维情况，其中 $\\varepsilon_{zz} = \\varepsilon_{xz} = \\varepsilon_{yz} = 0$，该关系得到简化。对面内分量使用 Voigt 记法 $\\boldsymbol{\\sigma} = [\\sigma_{xx}, \\sigma_{yy}, \\sigma_{xy}]^T$ 和 $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^T$（其中工程剪切应变为 $\\gamma_{xy} = 2\\varepsilon_{xy}$），本构定律由 $\\boldsymbol{\\sigma} = \\mathbf{D}_i \\boldsymbol{\\varepsilon}$ 给出，其中平面应变刚度矩阵 $\\mathbf{D}_i$ 为：\n$$\n\\mathbf{D}_i = \\begin{bmatrix}\n\\lambda_i + 2 G_i  \\lambda_i  0 \\\\\n\\lambda_i  \\lambda_i + 2 G_i  0 \\\\\n0  0  G_i\n\\end{bmatrix}\n$$\n\n该过程包括以下步骤：\n\n1.  **有限元离散化**：将域，即单位正方形 $\\Omega = [0,1] \\times [0,1]$，离散化为 $N \\times N$ 个四节点双线性四边形单元的均匀网格。每个单元的面积为 $A_e = (1/N)^2$。坐标为 $(i/N, j/N)$ 的节点 $(i,j)$，其中 $i,j \\in \\{0, 1, \\dots, N\\}$。如果一个单元的形心坐标 $(x_c, y_c)$ 满足 $(x_c - 0.5)^2 + (y_c - 0.5)^2 \\le r^2$，则该单元被赋予相 2（夹杂物）的属性；否则，它被赋予相 1（基体）的属性。\n\n2.  **单元刚度矩阵**：对于每个单元 $e$，其刚度矩阵 $\\mathbf{k}^e$ 是一个 $8 \\times 8$ 的矩阵，它将单元的 8 个节点自由度（每个节点两个）与节点力联系起来。它是通过在单元面积 $\\Omega_e$ 上积分计算得出的：\n$$\n\\mathbf{k}^e = \\int_{\\Omega_e} \\mathbf{B}^T \\mathbf{D} \\mathbf{B} \\, dA\n$$\n在这里，$\\mathbf{D}$ 是单元所属相的本构矩阵。矩阵 $\\mathbf{B}$ 将应变向量 $\\boldsymbol{\\varepsilon}$ 与单元的节点位移向量 $\\mathbf{u}^e$ 联系起来。对于节点 $k$，$\\mathbf{B}$ 中的相应块为\n$$\n\\mathbf{B}_k = \\begin{bmatrix} \\frac{\\partial N_k}{\\partial x}  0 \\\\ 0  \\frac{\\partial N_k}{\\partial y} \\\\ \\frac{\\partial N_k}{\\partial y}  \\frac{\\partial N_k}{\\partial x} \\end{bmatrix}\n$$\n其中 $N_k(x,y)$ 是双线性形函数。该积分在单元的参考坐标系 $(\\xi, \\eta) \\in [-1,1] \\times [-1,1]$ 中，使用 $2 \\times 2$ Gaussian 求积方案进行数值计算。\n$$\n\\mathbf{k}^e = \\sum_{p=1}^{4} w_p \\mathbf{B}(\\xi_p, \\eta_p)^T \\mathbf{D} \\mathbf{B}(\\xi_p, \\eta_p) \\det(\\mathbf{J})\n$$\n其中 $w_p=1$ 是 Gauss 权重，$\\mathbf{J}$ 是从参考坐标到全局坐标映射的雅可比矩阵。对于边长为 $h=1/N$ 的正方形单元，$\\det(\\mathbf{J}) = (h/2)^2 = 1/(4N^2)$。\n\n3.  **全局组装和边界条件**：将单元刚度矩阵组装成针对整个 $(N+1)^2$ 节点系统的全局刚度矩阵 $\\mathbf{K}$。控制方程组为 $\\mathbf{K} \\mathbf{U} = \\mathbf{F}$，其中 $\\mathbf{U}$ 是节点位移的全局向量，$\\mathbf{F}$ 是节点力的全局向量。\n    我们通过在所有边界节点上施加位移来应用运动学均匀边界条件 (KUBC)。对于宏观应变张量 $\\overline{\\boldsymbol{\\varepsilon}}$，边界点 $\\mathbf{x}=[x,y]^T$ 处的位移 $\\mathbf{u}$ 为 $\\mathbf{u} = \\overline{\\boldsymbol{\\varepsilon}} \\mathbf{x}$。使用工程剪切应变，这表示为：\n$$\nu_x(x,y) = \\overline{\\varepsilon}_{xx} x + \\frac{\\overline{\\gamma}_{xy}}{2} y, \\quad u_y(x,y) = \\overline{\\varepsilon}_{yy} y + \\frac{\\overline{\\gamma}_{xy}}{2} x\n$$\n系统根据对应于内部节点（未知量，下标 $I$）和边界节点（已知量，下标 $B$）的自由度进行划分：\n$$\n\\begin{bmatrix} \\mathbf{K}_{II}  \\mathbf{K}_{IB} \\\\ \\mathbf{K}_{BI}  \\mathbf{K}_{BB} \\end{bmatrix} \\begin{bmatrix} \\mathbf{U}_I \\\\ \\mathbf{U}_B \\end{bmatrix} = \\begin{bmatrix} \\mathbf{F}_I \\\\ \\mathbf{F}_B \\end{bmatrix}\n$$\n在没有体力的情况下，$\\mathbf{F}_I = \\mathbf{0}$。未知的内部节点位移 $\\mathbf{U}_I$ 通过求解降阶系统得到：\n$$\n\\mathbf{K}_{II} \\mathbf{U}_I = -\\mathbf{K}_{IB} \\mathbf{U}_B\n$$\n\n4.  **均匀化和有效性质**：求解出 $\\mathbf{U}_I$ 后，完整的位移场就已知了。Hill-Mandel 条件意味着宏观应力 $\\langle \\boldsymbol{\\sigma} \\rangle$ 是微观应力场 $\\boldsymbol{\\sigma}(\\mathbf{x})$ 的体积平均值。该平均值通过数值计算得出：\n$$\n\\langle \\boldsymbol{\\sigma} \\rangle = \\frac{1}{A_{total}} \\int_{\\Omega} \\boldsymbol{\\sigma}(\\mathbf{x}) \\, dA = \\frac{1}{1} \\sum_{e=1}^{N^2} \\int_{\\Omega_e} \\mathbf{D}_e \\mathbf{B} \\mathbf{u}^e \\, dA = \\sum_{e=1}^{N^2} \\sum_{p=1}^{4} w_p \\mathbf{D}_e \\mathbf{B}_{p} \\mathbf{u}^e \\frac{\\det(\\mathbf{J})}{1}\n$$\n当 $w_p=1$ 且 $\\det(\\mathbf{J})=1/(4N^2)$ 时，这简化为在所有单元的所有 Gauss 点上计算的应力张量的算术平均值。\n$$\n\\langle \\boldsymbol{\\sigma} \\rangle = \\frac{1}{4N^2} \\sum_{e=1}^{N^2} \\sum_{p=1}^{4} \\boldsymbol{\\sigma}_p^e\n$$\n我们应用两种载荷工况来求得有效模量：\n    a) **纯剪切**：设置 $\\overline{\\varepsilon}_{xx} = \\overline{\\varepsilon}_{yy} = 0$，$\\overline{\\gamma}_{xy} = \\gamma_0 = 2 \\times 10^{-3}$。有效剪切模量为：\n$$\nG_{\\mathrm{eff}} = \\frac{\\langle \\sigma_{xy} \\rangle}{\\overline{\\gamma}_{xy}}\n$$\n    b) **等双轴应变**：设置 $\\overline{\\varepsilon}_{xx} = \\overline{\\varepsilon}_{yy} = e_0 = 10^{-3}$，$\\overline{\\gamma}_{xy} = 0$。宏观响应为 $\\langle \\sigma_{xx} \\rangle = (2\\lambda_{\\mathrm{eff}} + 2G_{\\mathrm{eff}}) e_0$。我们已经从剪切试验中得到了 $G_{\\mathrm{eff}}$。因此，我们求出 $\\lambda_{\\mathrm{eff}}$：\n$$\n\\lambda_{\\mathrm{eff}} = \\frac{\\langle \\sigma_{xx} \\rangle}{2 e_0} - G_{\\mathrm{eff}}\n$$\n最后，有效体积模量根据其定义计算得出：\n$$\nK_{\\mathrm{eff}} = \\lambda_{\\mathrm{eff}} + \\frac{2}{3} G_{\\mathrm{eff}}\n$$\n\n5.  **Hashin-Shtrikman 界**：计算出的有效性质与三维两相各向同性复合材料的 Hashin-Shtrikman (HS) 界进行基准比较。夹杂物相的体积分数 $f_2$ 计算为相 2 单元数量与总单元数量 $N^2$ 的比率。然后 $f_1 = 1 - f_2$。体积模量 $K$ 和剪切模量 $G$ 的下界 ($-$) 和上界 ($+$) 由所提供的公式给出。对于相模量相等的情况（$K_1=K_2$ 或 $G_1=G_2$），需要特别处理，此时相应的下界和上界直接设为该公共模量值。\n\n为每个测试用例实现此程序，以得出所需的数值结果。", "answer": "```python\nimport numpy as np\n\ndef get_constitutive_matrix(K, G):\n    \"\"\"Computes the plane strain constitutive matrix D.\"\"\"\n    lambda_lame = K - (2.0 / 3.0) * G\n    C11 = lambda_lame + 2 * G\n    C12 = lambda_lame\n    C33 = G\n    return np.array([\n        [C11, C12, 0],\n        [C12, C11, 0],\n        [0,   0,   C33]\n    ])\n\ndef get_element_stiffness_and_B_matrices(h):\n    \"\"\"\n    Computes the bilinear quad element stiffness matrix template and B-matrices.\n    The final stiffness matrix is obtained by k = detJ * B^T D B, summed over Gauss points.\n    We return the ingredients: B matrices for each Gauss point and detJ.\n    \"\"\"\n    gauss_points = [-1.0 / np.sqrt(3.0), 1.0 / np.sqrt(3.0)]\n    B_matrices_gp = []\n    \n    xi_coords = [-1, 1, 1, -1]\n    eta_coords = [-1, -1, 1, 1]\n\n    for eta_gp in gauss_points:\n        for xi_gp in gauss_points:\n            B = np.zeros((3, 8))\n            for i in range(4):\n                xi_i, eta_i = xi_coords[i], eta_coords[i]\n                \n                dN_dxi = 0.25 * xi_i * (1 + eta_i * eta_gp)\n                dN_deta = 0.25 * eta_i * (1 + xi_i * xi_gp)\n                \n                dN_dx = dN_dxi * (2.0 / h)\n                dN_dy = dN_deta * (2.0 / h)\n                \n                B[0, 2 * i] = dN_dx\n                B[1, 2 * i + 1] = dN_dy\n                B[2, 2 * i] = dN_dy\n                B[2, 2 * i + 1] = dN_dx\n            B_matrices_gp.append(B)\n            \n    det_J = (h / 2.0)**2\n    \n    return B_matrices_gp, det_J\n\ndef run_fem(N, r, K1, G1, K2, G2, macro_strain):\n    \"\"\"Main FEM routine for a single load case.\"\"\"\n    h = 1.0 / N\n    num_nodes = (N + 1)**2\n    num_elements = N**2\n    total_dofs = 2 * num_nodes\n\n    D1 = get_constitutive_matrix(K1, G1)\n    D2 = get_constitutive_matrix(K2, G2)\n\n    B_matrices_gp, det_J = get_element_stiffness_and_B_matrices(h)\n\n    K_global = np.zeros((total_dofs, total_dofs))\n    element_phases = []\n    \n    for j in range(N):\n        for i in range(N):\n            xc = (i + 0.5) * h\n            yc = (j + 0.5) * h\n            is_phase2 = (xc - 0.5)**2 + (yc - 0.5)**2 = r**2\n            D_elem = D2 if is_phase2 else D1\n            element_phases.append(2 if is_phase2 else 1)\n\n            k_elem = np.zeros((8, 8))\n            for B_gp in B_matrices_gp:\n                k_elem += B_gp.T @ D_elem @ B_gp * det_J\n            \n            node_0 = j * (N + 1) + i\n            nodes = [node_0, node_0 + 1, (j + 1) * (N + 1) + i + 1, (j + 1) * (N + 1) + i]\n            dof_indices = []\n            for node in nodes:\n                dof_indices.extend([2 * node, 2 * node + 1])\n                \n            K_global[np.ix_(dof_indices, dof_indices)] += k_elem\n\n    boundary_dofs = []\n    internal_dofs = []\n    node_coords = np.zeros((num_nodes, 2))\n    \n    for j in range(N + 1):\n        for i in range(N + 1):\n            node_idx = j * (N + 1) + i\n            node_coords[node_idx] = [i * h, j * h]\n            is_boundary = i == 0 or i == N or j == 0 or j == N\n            if is_boundary:\n                boundary_dofs.extend([2 * node_idx, 2 * node_idx + 1])\n            else:\n                internal_dofs.extend([2 * node_idx, 2 * node_idx + 1])\n\n    U_B = np.zeros(len(boundary_dofs))\n    e_xx, e_yy, gam_xy = macro_strain\n\n    for i, dof in enumerate(boundary_dofs):\n        node_idx = dof // 2\n        x, y = node_coords[node_idx]\n        if dof % 2 == 0:\n            U_B[i] = e_xx * x + gam_xy / 2.0 * y\n        else:\n            U_B[i] = e_yy * y + gam_xy / 2.0 * x\n\n    K_II = K_global[np.ix_(internal_dofs, internal_dofs)]\n    K_IB = K_global[np.ix_(internal_dofs, boundary_dofs)]\n    \n    F_I = -K_IB @ U_B\n    U_I = np.linalg.solve(K_II, F_I)\n\n    U_global = np.zeros(total_dofs)\n    U_global[internal_dofs] = U_I\n    U_global[boundary_dofs] = U_B\n\n    avg_stress = np.zeros(3)\n    for elem_idx in range(num_elements):\n        j, i = divmod(elem_idx, N)\n        D_elem = D2 if element_phases[elem_idx] == 2 else D1\n        \n        node_0 = j * (N + 1) + i\n        nodes = [node_0, node_0 + 1, (j + 1) * (N + 1) + i + 1, (j + 1) * (N + 1) + i]\n        dof_indices = []\n        for node in nodes:\n            dof_indices.extend([2 * node, 2 * node + 1])\n        u_elem = U_global[dof_indices]\n\n        for B_gp in B_matrices_gp:\n            stress_gp = D_elem @ B_gp @ u_elem\n            avg_stress += stress_gp\n\n    avg_stress /= (num_elements * 4)\n    f2 = sum(1 for phase in element_phases if phase == 2) / num_elements\n    \n    return avg_stress, f2\n\ndef calculate_hs_bounds(f1, f2, K1, G1, K2, G2):\n    if K1 == K2:\n        K_hs_lower, K_hs_upper = K1, K1\n    else:\n        K_hs_lower = K1 + f2 / (1 / (K2 - K1) + f1 / (K1 + 4/3 * G1))\n        K_hs_upper = K2 + f1 / (1 / (K1 - K2) + f2 / (K2 + 4/3 * G2))\n\n    if G1 == G2:\n        G_hs_lower, G_hs_upper = G1, G1\n    else:\n        eta1 = 6 * (K1 + 2*G1) / (5 * (3*K1 + 4*G1))\n        G_hs_lower = G1 + f2 / (1 / (G2 - G1) + f1 / (G1 + G1*eta1))\n        eta2 = 6 * (K2 + 2*G2) / (5 * (3*K2 + 4*G2))\n        G_hs_upper = G2 + f1 / (1 / (G1 - G2) + f2 / (G2 + G2*eta2))\n    \n    # 3D HS bounds are used. The formulas in the problem were slightly simplified.\n    # The term is 3f1 / (3K1+4G1), not f1 / (K1 + 4/3 G1)\n    K_hs_lower = K1 + f2 / (1 / (K2 - K1) + (3 * f1) / (3 * K1 + 4 * G1))\n    K_hs_upper = K2 + f1 / (1 / (K1 - K2) + (3 * f2) / (3 * K2 + 4 * G2))\n\n    G_hs_lower = G1 + f2 / (1 / (G2 - G1) + (6 * f1 * (K1 + 2 * G1)) / (5 * G1 * (3 * K1 + 4 * G1)))\n    G_hs_upper = G2 + f1 / (1 / (G1 - G2) + (6 * f2 * (K2 + 2 * G2)) / (5 * G2 * (3 * K2 + 4 * G2)))\n    \n    return min(K_hs_lower, K_hs_upper), max(K_hs_lower, K_hs_upper), min(G_hs_lower, G_hs_upper), max(G_hs_lower, G_hs_upper)\n\ndef process_case(N, r, K1, G1, K2, G2):\n    gamma0 = 2.0e-3\n    e0 = 1.0e-3\n    \n    shear_strain = (0.0, 0.0, gamma0)\n    avg_stress_shear, f2 = run_fem(N, r, K1, G1, K2, G2, shear_strain)\n    G_eff = avg_stress_shear[2] / gamma0\n    \n    biaxial_strain = (e0, e0, 0.0)\n    avg_stress_biaxial, _ = run_fem(N, r, K1, G1, K2, G2, biaxial_strain)\n    \n    avg_sigma_xx = avg_stress_biaxial[0]\n    lambda_eff = (avg_sigma_xx / e0) / 2.0 - G_eff\n    K_eff = lambda_eff + (2.0/3.0) * G_eff\n    \n    f1 = 1.0 - f2\n    Khs_lower, Khs_upper, Ghs_lower, Ghs_upper = calculate_hs_bounds(f1, f2, K1, G1, K2, G2)\n    \n    return [K_eff, G_eff, Khs_lower, Khs_upper, Ghs_lower, Ghs_upper]\n\ndef main():\n    test_cases = [\n        (16, 0.30, 50.0, 20.0, 150.0, 60.0),\n        (12, 0.00, 50.0, 20.0, 150.0, 60.0),\n        (14, 0.35, 80.0, 30.0, 80.0, 30.0),\n        (18, 0.40, 50.0, 20.0, 1000.0, 400.0)\n    ]\n    \n    all_results = []\n    for case in test_cases:\n        N, r, K1, G1, K2, G2 = case\n        results = process_case(N, r, K1, G1, K2, G2)\n        all_results.append(results)\n    \n    # Using json for a more robust list representation that matches Python literal\n    import json\n    # Format each float inside the lists\n    formatted_all_results = []\n    for res_list in all_results:\n        formatted_res_list = [float(f'{x:.6f}') for x in res_list]\n        formatted_all_results.append(formatted_res_list)\n\n    print(json.dumps(formatted_all_results))\n\nif __name__ == \"__main__\":\n    main()\n```", "id": "2565193"}]}