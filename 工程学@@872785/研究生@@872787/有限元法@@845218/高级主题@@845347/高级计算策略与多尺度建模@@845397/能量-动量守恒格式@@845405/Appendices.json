{"hands_on_practices": [{"introduction": "在连续介质力学中，诺特定理保证了空间平移不变性导致线性动量守恒。然而，当我们使用有限元等方法将系统离散化时，这些基本对称性并不总能自动保持。本练习提供了一个鲜明的例子：通过特意使用一个非对称质量矩阵，我们将分析证明系统线性动量如何不再守恒，并导致非物理性的漂移。这个实践强调了在数值模型中保持力学基本几何与代数结构的关键重要性。[@problem_id:2555617]", "problem": "考虑一个由有限元法（FEM）产生的两自由度线性弹性系统的半离散运动方程：\n$$\nM\\,\\ddot{u}(t) + K\\,u(t) = 0,\n$$\n其中 $u(t) \\in \\mathbb{R}^2$。刚度矩阵对应于连接两个节点的单个线性弹簧，\n$$\nK = k \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}, \\quad k0,\n$$\n它在由下式生成的刚体平动下保持不变\n$$\nc = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix},\n$$\n因此有 $K\\,c = 0$。质量矩阵被刻意选为非对称形式，\n$$\nM = m \\begin{pmatrix} 1  0 \\\\ \\alpha  1 \\end{pmatrix}, \\quad m0,\\ \\alpha \\in \\mathbb{R}\\setminus\\{0\\}.\n$$\n采用标准动能\n$$\nT(\\dot{u}) = \\tfrac{1}{2}\\,\\dot{u}^{\\mathsf{T}}\\,\\mathrm{sym}(M)\\,\\dot{u}, \\quad \\mathrm{sym}(M) := \\tfrac{1}{2}\\,(M+M^{\\mathsf{T}}),\n$$\n并定义与刚体平动相关的总线性动量为\n$$\nP(t) := c^{\\mathsf{T}}\\,\\frac{\\partial T}{\\partial \\dot{u}} = c^{\\mathsf{T}}\\,\\mathrm{sym}(M)\\,\\dot{u}(t).\n$$\n从牛顿第二定律和这些定义出发，在不借助任何专门的能量-动量时间积分器的情况下，完成以下任务：\n\n- 解析地验证当 $\\alpha \\neq 0$ 时，动量守恒所需的对称性被 $M$ 破坏，因此即使 $K\\,c=0$，$P(t)$ 也不随时间保持恒定。\n\n- 对于特定的初始条件\n$$\nu(0) = \\begin{pmatrix} A \\\\ -A \\end{pmatrix}, \\quad \\dot{u}(0) = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix},\n$$\n其中 $A \\neq 0$，推导出一个用 $A$、$m$、$k$、$\\alpha$ 和 $t$ 表示的 $P(t)$ 的闭式表达式。\n\n将你的最终答案表示为仅包含 $A$、$m$、$k$、$\\alpha$ 和 $t$ 的单个 $P(t)$ 解析表达式。最终表达式中不要包含单位。", "solution": "首先对问题进行验证。\n\n逐字提取已知条件：\n- 半离散运动方程为 $M\\,\\ddot{u}(t) + K\\,u(t) = 0$，其中 $u(t) \\in \\mathbb{R}^2$。\n- 刚度矩阵为 $K = k \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$，其中 $k0$。\n- 刚体平动生成元为 $c = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n- 刚度矩阵的一个性质是 $K\\,c = 0$。\n- 质量矩阵为 $M = m \\begin{pmatrix} 1  0 \\\\ \\alpha  1 \\end{pmatrix}$，其中 $m0$ 且 $\\alpha \\in \\mathbb{R}\\setminus\\{0\\}$。\n- 动能为 $T(\\dot{u}) = \\tfrac{1}{2}\\,\\dot{u}^{\\mathsf{T}}\\,\\mathrm{sym}(M)\\,\\dot{u}$，其中 $\\mathrm{sym}(M) := \\tfrac{1}{2}\\,(M+M^{\\mathsf{T}})$。\n- 总线性动量定义为 $P(t) := c^{\\mathsf{T}}\\,\\frac{\\partial T}{\\partial \\dot{u}} = c^{\\mathsf{T}}\\,\\mathrm{sym}(M)\\,\\dot{u}(t)$。\n- 初始条件为 $u(0) = \\begin{pmatrix} A \\\\ -A \\end{pmatrix}$ 和 $\\dot{u}(0) = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$，其中 $A \\neq 0$。\n\n该问题具有科学依据、提法恰当且客观。这是计算力学中的一个标准理论问题，旨在阐释离散系统中动量守恒的条件。使用非对称质量矩阵是展示守恒性失效的一个关键特征，而这正是问题要求分析的内容。所有数据和定义均已给出，不存在矛盾。该问题是有效的。\n\n我们继续解答，根据要求分为两个部分。\n\n第 1 部分：验证动量 $P(t)$ 的非守恒性。\n定义的线性动量 $P(t)$ 的变化率通过对时间求导得到：\n$$\n\\dot{P}(t) = \\frac{d}{dt} \\left( c^{\\mathsf{T}}\\,\\mathrm{sym}(M)\\,\\dot{u}(t) \\right) = c^{\\mathsf{T}}\\,\\mathrm{sym}(M)\\,\\ddot{u}(t)\n$$\n运动方程为 $M\\ddot{u} = -Ku$。我们用 $c^{\\mathsf{T}}$ 左乘：\n$$\nc^{\\mathsf{T}}M\\ddot{u} = -c^{\\mathsf{T}}Ku\n$$\n问题指出 $Kc=0$。由于 $K$ 是对称的（$K=K^{\\mathsf{T}}$），因此有 $c^{\\mathsf{T}}K = (Kc)^{\\mathsf{T}} = 0^{\\mathsf{T}}$。所以，对于任何 $u(t)$，右侧都为零，从而得到：\n$$\nc^{\\mathsf{T}}M\\ddot{u} = 0\n$$\n这是运动方程对加速度 $\\ddot{u}$ 施加的约束。现在，我们将其与 $\\dot{P}(t)$ 联系起来。我们将质量矩阵 $M$ 分解为其对称部分和反对称部分：$M = \\mathrm{sym}(M) + \\mathrm{skew}(M)$，其中 $\\mathrm{skew}(M) = \\frac{1}{2}(M-M^{\\mathsf{T}})$。\n将此代入约束条件得到：\n$$\nc^{\\mathsf{T}}(\\mathrm{sym}(M) + \\mathrm{skew}(M))\\ddot{u} = 0 \\implies c^{\\mathsf{T}}\\mathrm{sym}(M)\\ddot{u} + c^{\\mathsf{T}}\\mathrm{skew}(M)\\ddot{u} = 0\n$$\n注意到第一项是 $\\dot{P}(t)$，我们发现：\n$$\n\\dot{P}(t) = -c^{\\mathsf{T}}\\mathrm{skew}(M)\\ddot{u}\n$$\n为了使动量 $P(t)$ 守恒，$\\dot{P}(t)$ 对于系统的任何解都必须恒为零。这要求 $c^{\\mathsf{T}}\\mathrm{skew}(M)\\ddot{u} = 0$。我们来计算这一项。$M$ 的反对称部分为：\n$$\n\\mathrm{skew}(M) = \\frac{1}{2}\\left( m \\begin{pmatrix} 1  0 \\\\ \\alpha  1 \\end{pmatrix} - m \\begin{pmatrix} 1  \\alpha \\\\ 0  1 \\end{pmatrix} \\right) = \\frac{m}{2} \\begin{pmatrix} 0  -\\alpha \\\\ \\alpha  0 \\end{pmatrix}\n$$\n现在我们计算向量 $c^{\\mathsf{T}}\\mathrm{skew}(M)$：\n$$\nc^{\\mathsf{T}}\\mathrm{skew}(M) = \\begin{pmatrix} 1  1 \\end{pmatrix} \\frac{m}{2} \\begin{pmatrix} 0  -\\alpha \\\\ \\alpha  0 \\end{pmatrix} = \\frac{m}{2} \\begin{pmatrix} \\alpha  -\\alpha \\end{pmatrix} = \\frac{m\\alpha}{2} \\begin{pmatrix} 1  -1 \\end{pmatrix}\n$$\n将此代入 $\\dot{P}(t)$ 的表达式中：\n$$\n\\dot{P}(t) = -\\frac{m\\alpha}{2} \\begin{pmatrix} 1  -1 \\end{pmatrix} \\ddot{u} = -\\frac{m\\alpha}{2} (\\ddot{u}_1(t) - \\ddot{u}_2(t))\n$$\n由于给定 $m0$ 和 $\\alpha \\neq 0$，动量守恒要求在所有时间里都有 $\\ddot{u}_1(t) = \\ddot{u}_2(t)$。这种节点加速度相等的条件通常不被系统的解所满足。例如，计算 $t=0$ 时的加速度，我们有 $\\ddot{u}(0) = -M^{-1}Ku(0)$。\n$$\nM^{-1} = \\frac{1}{m} \\begin{pmatrix} 1  0 \\\\ -\\alpha  1 \\end{pmatrix}\n$$\n$$\nKu(0) = k \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} \\begin{pmatrix} A \\\\ -A \\end{pmatrix} = k \\begin{pmatrix} 2A \\\\ -2A \\end{pmatrix}\n$$\n$$\n\\ddot{u}(0) = -\\frac{1}{m} \\begin{pmatrix} 1  0 \\\\ -\\alpha  1 \\end{pmatrix} k \\begin{pmatrix} 2A \\\\ -2A \\end{pmatrix} = -\\frac{2Ak}{m} \\begin{pmatrix} 1 \\\\ -\\alpha-1 \\end{pmatrix}\n$$\n那么 $\\ddot{u}_1(0) - \\ddot{u}_2(0) = -\\frac{2Ak}{m}(1 - (-\\alpha-1)) = -\\frac{2Ak}{m}(2+\\alpha)$。除非 $A=0$（平凡解）、$k=0$（不允许）或 $\\alpha=-2$，否则该值不为零。对于一般的 $\\alpha \\neq -2$，加速度分量是不同的。因此，$\\dot{P}(t)$ 不恒为零，动量 $P(t)$ 不守恒。验证完成。\n\n第 2 部分：推导 $P(t)$ 的闭式表达式。\n我们必须找到给定初始条件下的显式解 $u(t)$。我们寻找形如 $u(t) = v e^{i\\omega t}$ 的模态解，这导出了广义特征值问题 $(K - \\omega^2 M)v=0$。其特征方程为 $\\det(K - \\omega^2 M) = 0$。\n$$\nK - \\omega^2 M = \\begin{pmatrix} k - m\\omega^2  -k \\\\ -k - m\\alpha\\omega^2  k - m\\omega^2 \\end{pmatrix}\n$$\n$$\n\\det(K - \\omega^2 M) = (k - m\\omega^2)^2 - (-k)(-k - m\\alpha\\omega^2) = k^2 - 2km\\omega^2 + m^2\\omega^4 - (k^2+km\\alpha\\omega^2) = 0\n$$\n$$\nm^2\\omega^4 - (2km + km\\alpha)\\omega^2 = 0 \\implies m\\omega^2(m\\omega^2 - k(2+\\alpha)) = 0\n$$\n这给出了两个频率的平方：$\\omega_1^2 = 0$（刚体模态）和 $\\omega_2^2 = \\frac{k(2+\\alpha)}{m}$。我们记 $\\omega_0^2 = \\omega_2^2$。\n对应于 $\\omega_1^2=0$ 的特征向量是 $v_1=c=\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n对应于 $\\omega_2^2=\\omega_0^2$ 的特征向量 $v_2$ 由 $(K-\\omega_0^2 M)v_2=0$ 求得。根据第一行：\n$(k-m\\omega_0^2)v_{2,1} - k v_{2,2} = 0 \\implies v_{2,2} = (1-\\frac{m\\omega_0^2}{k})v_{2,1} = (1-(2+\\alpha))v_{2,1} = -(1+\\alpha)v_{2,1}$。我们选择 $v_2 = \\begin{pmatrix} 1 \\\\ -(1+\\alpha) \\end{pmatrix}$。\n通解是这些模态的叠加（假设 $\\omega_0^2 \\neq 0$，即 $\\alpha \\neq -2$）：\n$$\nu(t) = (C_1t + C_2)v_1 + (C_3\\cos(\\omega_0 t) + C_4\\sin(\\omega_0 t))v_2\n$$\n应用初始条件 $u(0)=\\begin{pmatrix} A \\\\ -A \\end{pmatrix}$ 和 $\\dot{u}(0)=\\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$：\n$$\nu(0) = C_2\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} + C_3\\begin{pmatrix} 1 \\\\ -(1+\\alpha) \\end{pmatrix} = \\begin{pmatrix} A \\\\ -A \\end{pmatrix}\n$$\n这给出了线性系统 $C_2+C_3=A$ 和 $C_2-(1+\\alpha)C_3 = -A$。求解得到 $C_3 = \\frac{2A}{2+\\alpha}$ 和 $C_2 = \\frac{A\\alpha}{2+\\alpha}$。\n接下来，我们求速度：\n$$\n\\dot{u}(t) = C_1 v_1 + \\omega_0(-C_3\\sin(\\omega_0 t)+C_4\\cos(\\omega_0 t))v_2\n$$\n$$\n\\dot{u}(0) = C_1 v_1 + \\omega_0 C_4 v_2 = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n由于 $v_1$ 和 $v_2$ 是线性无关的（对于 $\\alpha \\neq -2$），我们必有 $C_1=0$ 和 $C_4=0$。\n$\\dot{u}(t)$ 的特解是：\n$$\n\\dot{u}(t) = -\\omega_0 C_3 \\sin(\\omega_0 t) v_2 = -\\omega_0 \\frac{2A}{2+\\alpha} \\sin(\\omega_0 t) \\begin{pmatrix} 1 \\\\ -(1+\\alpha) \\end{pmatrix}\n$$\n现在我们计算 $P(t) = c^{\\mathsf{T}}\\,\\mathrm{sym}(M)\\,\\dot{u}(t)$：\n$$\n\\mathrm{sym}(M) = m \\begin{pmatrix} 1  \\alpha/2 \\\\ \\alpha/2  1 \\end{pmatrix}\n$$\n$$\nc^{\\mathsf{T}}\\mathrm{sym}(M) = \\begin{pmatrix} 1  1 \\end{pmatrix} m \\begin{pmatrix} 1  \\alpha/2 \\\\ \\alpha/2  1 \\end{pmatrix} = m \\begin{pmatrix} 1+\\alpha/2  1+\\alpha/2 \\end{pmatrix} = m\\frac{2+\\alpha}{2}\\begin{pmatrix} 1  1 \\end{pmatrix}\n$$\n$$\nP(t) = m\\frac{2+\\alpha}{2}\\begin{pmatrix} 1  1 \\end{pmatrix} \\left( -\\omega_0 \\frac{2A}{2+\\alpha} \\sin(\\omega_0 t) \\begin{pmatrix} 1 \\\\ -(1+\\alpha) \\end{pmatrix} \\right)\n$$\n项 $(2+\\alpha)$ 消去（此步骤在极限 $\\alpha \\to -2$ 时也有效，我们已单独分析过该情况，得出 $P(t)=0$，与最终公式一致）：\n$$\nP(t) = m\\frac{1}{2} \\left( -2A\\omega_0 \\sin(\\omega_0 t)  \\right) \\left( (1)(1) + (1)(-(1+\\alpha)) \\right)\n$$\n$$\nP(t) = -m A \\omega_0 \\sin(\\omega_0 t) (1 - 1 - \\alpha) = -m A \\omega_0 \\sin(\\omega_0 t) (-\\alpha)\n$$\n$$\nP(t) = m \\alpha A \\omega_0 \\sin(\\omega_0 t)\n$$\n代入 $\\omega_0 = \\sqrt{\\frac{k(2+\\alpha)}{m}}$：\n$$\nP(t) = m \\alpha A \\sqrt{\\frac{k(2+\\alpha)}{m}} \\sin\\left(\\sqrt{\\frac{k(2+\\alpha)}{m}}t\\right)\n$$\n$$\nP(t) = \\alpha A \\sqrt{mk(2+\\alpha)} \\sin\\left(\\sqrt{\\frac{k(2+\\alpha)}{m}}t\\right)\n$$\n此表达式是 $P(t)$ 的闭式解。它对任何 $\\alpha \\in \\mathbb{R}\\setminus\\{0\\}$ 都有效，当 $2+\\alpha  0$ 时，将平方根和正弦函数解释为复变函数。如果 $2+\\alpha=0$，该表达式正确地计算为 $0$。", "answer": "$$\n\\boxed{\\alpha A \\sqrt{m k (2+\\alpha)} \\sin\\left(\\sqrt{\\frac{k(2+\\alpha)}{m}}t\\right)}\n$$", "id": "2555617"}, {"introduction": "在看了一个糟糕的离散化如何违反守恒定律之后，我们现在转向一个正面例子，它展示了真正的能量-动量 (EM) 格式的关键特性。这些格式经过专门设计，能够精确地保持与力学系统基本对称性相关的动量映射的守恒律。在本练习中, 我们将分析一个经历刚体旋转的四面体单元，并证明离散角动量被能量-动量积分器完美守恒。这一特性对于非线性动力学的长期模拟至关重要，因为它能防止伪能量的累积，确保物理上正确的行为。[@problem_id:2555623]", "problem": "考虑一个在三维空间中进行刚体运动的四节点 (4-node) 四面体有限应变单元。节点位于以下空间位置\n$$\n\\mathbf{x}_1 = (1,\\,1,\\,1),\\quad\n\\mathbf{x}_2 = (-1,\\,-1,\\,1),\\quad\n\\mathbf{x}_3 = (-1,\\,1,\\,-1),\\quad\n\\mathbf{x}_4 = (1,\\,-1,\\,-1),\n$$\n使得质心位于原点。每个节点带有一个集中质量 $m$，因此总离散质量为 $M = 4m$。该运动是绕原点的刚体转动，其角速度矢量 $\\boldsymbol{\\Omega}$ 为常数，即 $\\mathbf{x}(t) = \\mathbf{R}(t)\\,\\mathbf{X}$，其中 $\\mathbf{R}(t) \\in \\mathrm{SO}(3)$ 且 $\\dot{\\mathbf{R}}(t) = \\boldsymbol{\\Omega}\\times \\mathbf{R}(t)$，因此对于 $a=1,2,3,4$，节点速度满足 $\\mathbf{v}_a(t) = \\boldsymbol{\\Omega} \\times \\mathbf{x}_a(t)$。\n\n时间积分采用一种基于运动学中心点法则的能量-动量守恒格式，\n$$\n\\mathbf{x}_a^{n+1} = \\mathbf{x}_a^{n} + \\Delta t\\,\\mathbf{v}_a^{n+\\frac{1}{2}},\\qquad \\mathbf{v}_a^{n+\\frac{1}{2}} = \\frac{\\mathbf{v}_a^{n+1}+\\mathbf{v}_a^{n}}{2},\n$$\n以及离散动量平衡\n$$\nm\\left(\\mathbf{v}_a^{n+1} - \\mathbf{v}_a^{n}\\right) = \\Delta t\\left(\\mathbf{f}_{a,\\mathrm{int}}^{n+\\frac{1}{2}} + \\mathbf{f}_{a,\\mathrm{ext}}^{n+\\frac{1}{2}}\\right),\n$$\n其中无外部载荷 $\\mathbf{f}_{a,\\mathrm{ext}}^{n+\\frac{1}{2}}=\\mathbf{0}$。內节点力 $\\mathbf{f}_{a,\\mathrm{int}}^{n+\\frac{1}{2}}$ 由一种能量-动量一致的算法应力计算得出，这样，在无外部载荷且为刚体运动的情况下，它们产生的合力与合力矩均为零：\n$$\n\\sum_{a=1}^{4}\\mathbf{f}_{a,\\mathrm{int}}^{n+\\frac{1}{2}}=\\mathbf{0},\\qquad \\sum_{a=1}^{4}\\mathbf{x}_a^{n+\\frac{1}{2}}\\times \\mathbf{f}_{a,\\mathrm{int}}^{n+\\frac{1}{2}}=\\mathbf{0}.\n$$\n\n将第 $n$ 步时绕原点的离散角动量定义为\n$$\n\\mathbf{L}^n := \\sum_{a=1}^{4} m\\,\\mathbf{x}_a^{n}\\times \\mathbf{v}_a^{n}.\n$$\n\n任务：\n1) 从刚体运动学关系 $\\mathbf{v}_a^{n}=\\boldsymbol{\\Omega}\\times \\mathbf{x}_a^{n}$ 和离散角动量的定义出发，为给定的节点位置推导 $\\mathbf{L}^n$ 的封闭形式表达式，以 $m$ 和 $\\boldsymbol{\\Omega}$ 表示。\n\n2) 仅使用中心点运动学关系、离散动量平衡以及所述的能量-动量一致內力的性质，证明对于这种无外部载荷的刚体运动，有 $\\mathbf{L}^{n+1}=\\mathbf{L}^{n}$。\n\n将离散角动量矢量的最终答案以 $m$ 和 $\\boldsymbol{\\Omega}$ 的符号形式表示。不需要进行数值取整，最终表达式中也不应包含单位。", "solution": "该问题陈述具有科学依据，提法得当且客观。这是计算力学中的一个标准问题，特别是在非线性弹性动力学的数值积分格式分析中。所有必要的数据和定义都已提供，不存在内部矛盾或事实错误。该问题有效可解。\n\n解答根据问题任务分为两部分。\n\n任务 $1$：推导离散角动量 $\\mathbf{L}^n$。\n\n时间步 $n$ 的离散角动量定义为各个节点质量绕原点的动量矩之和：\n$$\n\\mathbf{L}^n := \\sum_{a=1}^{4} m\\,\\mathbf{x}_a^{n}\\times \\mathbf{v}_a^{n}\n$$\n该运动被指定为绕原点的刚体转动，其角速度矢量 $\\boldsymbol{\\Omega}$ 为常数。因此，每个节点的速度由以下运动学关系给出：\n$$\n\\mathbf{v}_a^{n} = \\boldsymbol{\\Omega} \\times \\mathbf{x}_a^{n}\n$$\n将此速度表达式代入角动量的定义中，我们得到：\n$$\n\\mathbf{L}^n = \\sum_{a=1}^{4} m\\,\\mathbf{x}_a^{n}\\times (\\boldsymbol{\\Omega} \\times \\mathbf{x}_a^{n})\n$$\n我们应用矢量三重积恒等式 $\\mathbf{a} \\times (\\mathbf{b} \\times \\mathbf{c}) = \\mathbf{b}(\\mathbf{a} \\cdot \\mathbf{c}) - \\mathbf{c}(\\mathbf{a} \\cdot \\mathbf{b})$，其中 $\\mathbf{a} = \\mathbf{x}_a^n$，$\\mathbf{b} = \\boldsymbol{\\Omega}$，$\\mathbf{c} = \\mathbf{x}_a^n$。这得到：\n$$\n\\mathbf{x}_a^{n}\\times (\\boldsymbol{\\Omega} \\times \\mathbf{x}_a^{n}) = \\boldsymbol{\\Omega}(\\mathbf{x}_a^{n} \\cdot \\mathbf{x}_a^{n}) - \\mathbf{x}_a^{n}(\\mathbf{x}_a^{n} \\cdot \\boldsymbol{\\Omega})\n$$\n将此结果代回 $\\mathbf{L}^n$ 的表达式，并提出常数质量 $m$，得到：\n$$\n\\mathbf{L}^n = m \\sum_{a=1}^{4} \\left[ \\boldsymbol{\\Omega}|\\mathbf{x}_a^{n}|^2 - \\mathbf{x}_a^{n}(\\mathbf{x}_a^{n} \\cdot \\boldsymbol{\\Omega}) \\right]\n$$\n这可以写成离散惯性张量 $\\mathbf{J}^n$ 的形式，即 $\\mathbf{L}^n = \\mathbf{J}^n \\boldsymbol{\\Omega}$。惯性张量由下式给出：\n$$\n\\mathbf{J}^n = m \\sum_{a=1}^{4} \\left( |\\mathbf{x}_a^{n}|^2 \\mathbf{I} - \\mathbf{x}_a^{n} \\otimes \\mathbf{x}_a^{n} \\right)\n$$\n其中 $\\mathbf{I}$ 是 $3 \\times 3$ 单位张量。由于运动是刚性转动，每个节点到原点的距离是恒定的。我们可以使用给定的节点位置计算 $\\mathbf{J}^n$ 的分量，不失一般性地，我们可以将其表示为 $\\mathbf{x}_a$。\n节点位置为：\n$\\mathbf{x}_1 = (1,1,1)$，$\\mathbf{x}_2 = (-1,-1,1)$，$\\mathbf{x}_3 = (-1,1,-1)$，以及 $\\mathbf{x}_4 = (1,-1,-1)$。\n\n首先，我们计算每个位置矢量的模的平方：\n$|\\mathbf{x}_1|^2 = 1^2 + 1^2 + 1^2 = 3$\n$|\\mathbf{x}_2|^2 = (-1)^2 + (-1)^2 + 1^2 = 3$\n$|\\mathbf{x}_3|^2 = (-1)^2 + 1^2 + (-1)^2 = 3$\n$|\\mathbf{x}_4|^2 = 1^2 + (-1)^2 + (-1)^2 = 3$\n模的平方和为 $\\sum_{a=1}^{4} |\\mathbf{x}_a|^2 = 4 \\times 3 = 12$。\n\n接下来，我们计算并矢积之和 $\\sum_{a=1}^{4} \\mathbf{x}_a \\otimes \\mathbf{x}_a$。这是一个 $3 \\times 3$ 矩阵，其 $(i,j)$ 分量为 $\\sum_{a=1}^{4} x_{a,i} x_{a,j}$。\n对角分量为：\n$\\sum x_a^2 = 1^2 + (-1)^2 + (-1)^2 + 1^2 = 4$\n$\\sum y_a^2 = 1^2 + (-1)^2 + 1^2 + (-1)^2 = 4$\n$\\sum z_a^2 = 1^2 + 1^2 + (-1)^2 + (-1)^2 = 4$\n非对角分量为：\n$\\sum x_a y_a = (1)(1) + (-1)(-1) + (-1)(1) + (1)(-1) = 1+1-1-1 = 0$\n$\\sum x_a z_a = (1)(1) + (-1)(1) + (-1)(-1) + (1)(-1) = 1-1+1-1 = 0$\n$\\sum y_a z_a = (1)(1) + (-1)(1) + (1)(-1) + (-1)(-1) = 1-1-1+1 = 0$\n因此，并矢积之和是一个对角矩阵：\n$$\n\\sum_{a=1}^{4} \\mathbf{x}_a \\otimes \\mathbf{x}_a = \\begin{pmatrix} 4  0  0 \\\\ 0  4  0 \\\\ 0  0  4 \\end{pmatrix} = 4\\mathbf{I}\n$$\n现在我们组装惯性张量：\n$$\n\\mathbf{J} = m \\left( \\left(\\sum_{a=1}^{4} |\\mathbf{x}_a|^2\\right) \\mathbf{I} - \\sum_{a=1}^{4} \\mathbf{x}_a \\otimes \\mathbf{x}_a \\right) = m \\left( 12\\mathbf{I} - 4\\mathbf{I} \\right) = 8m\\mathbf{I}\n$$\n由于惯性张量是球形张量（单位张量的标量倍），它在旋转下是不变的。因此，对所有 $n$ 都有 $\\mathbf{J}^n = \\mathbf{J} = 8m\\mathbf{I}$。于是角动量为：\n$$\n\\mathbf{L}^n = \\mathbf{J}^n \\boldsymbol{\\Omega} = (8m\\mathbf{I})\\boldsymbol{\\Omega} = 8m\\boldsymbol{\\Omega}\n$$\n\n任务 $2$：证明角动量守恒，即 $\\mathbf{L}^{n+1}=\\mathbf{L}^{n}$。\n\n我们需要证明在一个时间步长内离散角动量的变化量 $\\mathbf{L}^{n+1} - \\mathbf{L}^{n}$ 为零。\n$$\n\\mathbf{L}^{n+1} - \\mathbf{L}^{n} = \\sum_{a=1}^{4} m \\left( \\mathbf{x}_a^{n+1} \\times \\mathbf{v}_a^{n+1} - \\mathbf{x}_a^{n} \\times \\mathbf{v}_a^{n} \\right)\n$$\n我们使用中心点法则的定义。令 $\\mathbf{x}_a^{n+\\frac{1}{2}} = \\frac{\\mathbf{x}_a^{n+1}+\\mathbf{x}_a^{n}}{2}$ 和 $\\mathbf{v}_a^{n+\\frac{1}{2}} = \\frac{\\mathbf{v}_a^{n+1}+\\mathbf{v}_a^{n}}{2}$。\n根据运动学更新法则，有 $\\mathbf{x}_a^{n+1} - \\mathbf{x}_a^{n} = \\Delta t\\,\\mathbf{v}_a^{n+\\frac{1}{2}}$。\n我们用中心点的值来表示起点和终点的值：\n$\\mathbf{x}_a^{n+1} = \\mathbf{x}_a^{n+\\frac{1}{2}} + \\frac{\\Delta t}{2}\\mathbf{v}_a^{n+\\frac{1}{2}}$\n$\\mathbf{x}_a^{n} = \\mathbf{x}_a^{n+\\frac{1}{2}} - \\frac{\\Delta t}{2}\\mathbf{v}_a^{n+\\frac{1}{2}}$\n$\\mathbf{v}_a^{n+1} = \\mathbf{v}_a^{n+\\frac{1}{2}} + \\frac{1}{2}(\\mathbf{v}_a^{n+1} - \\mathbf{v}_a^{n})$\n$\\mathbf{v}_a^{n} = \\mathbf{v}_a^{n+\\frac{1}{2}} - \\frac{1}{2}(\\mathbf{v}_a^{n+1} - \\mathbf{v}_a^{n})$\n让我们计算差值项 $\\mathbf{x}_a^{n+1} \\times \\mathbf{v}_a^{n+1} - \\mathbf{x}_a^{n} \\times \\mathbf{v}_a^{n}$：\n$$\n\\left(\\mathbf{x}_a^{n+\\frac{1}{2}} + \\frac{\\Delta t}{2}\\mathbf{v}_a^{n+\\frac{1}{2}}\\right) \\times \\left(\\mathbf{v}_a^{n+\\frac{1}{2}} + \\frac{1}{2}(\\mathbf{v}_a^{n+1} - \\mathbf{v}_a^{n})\\right) - \\left(\\mathbf{x}_a^{n+\\frac{1}{2}} - \\frac{\\Delta t}{2}\\mathbf{v}_a^{n+\\frac{1}{2}}\\right) \\times \\left(\\mathbf{v}_a^{n+\\frac{1}{2}} - \\frac{1}{2}(\\mathbf{v}_a^{n+1} - \\mathbf{v}_a^{n})\\right)\n$$\n展开叉积并利用性质 $\\mathbf{v} \\times \\mathbf{v} = \\mathbf{0}$，我们看到许多项相互抵消。第一项的展开式为：\n$\\mathbf{x}_a^{n+\\frac{1}{2}} \\times \\mathbf{v}_a^{n+\\frac{1}{2}} + \\frac{1}{2}\\mathbf{x}_a^{n+\\frac{1}{2}} \\times (\\mathbf{v}_a^{n+1} - \\mathbf{v}_a^{n}) + \\frac{\\Delta t}{4}\\mathbf{v}_a^{n+\\frac{1}{2}} \\times (\\mathbf{v}_a^{n+1} - \\mathbf{v}_a^{n})$\n第二项的展开式为：\n$\\mathbf{x}_a^{n+\\frac{1}{2}} \\times \\mathbf{v}_a^{n+\\frac{1}{2}} - \\frac{1}{2}\\mathbf{x}_a^{n+\\frac{1}{2}} \\times (\\mathbf{v}_a^{n+1} - \\mathbf{v}_a^{n}) + \\frac{\\Delta t}{4}\\mathbf{v}_a^{n+\\frac{1}{2}} \\times (\\mathbf{v}_a^{n+1} - \\mathbf{v}_a^{n})$\n从第一个展开式中减去第二个展开式得到：\n$$\n\\mathbf{x}_a^{n+1} \\times \\mathbf{v}_a^{n+1} - \\mathbf{x}_a^{n} \\times \\mathbf{v}_a^{n} = \\mathbf{x}_a^{n+\\frac{1}{2}} \\times (\\mathbf{v}_a^{n+1} - \\mathbf{v}_a^{n})\n$$\n现在，我们将此结果代回总角动量变化的表达式中：\n$$\n\\mathbf{L}^{n+1} - \\mathbf{L}^{n} = \\sum_{a=1}^{4} m \\left[ \\mathbf{x}_a^{n+\\frac{1}{2}} \\times (\\mathbf{v}_a^{n+1} - \\mathbf{v}_a^{n}) \\right]\n$$\n我们使用所给的、无外部力的离散动量平衡方程：\n$$\nm(\\mathbf{v}_a^{n+1} - \\mathbf{v}_a^{n}) = \\Delta t\\,\\mathbf{f}_{a,\\mathrm{int}}^{n+\\frac{1}{2}}\n$$\n将此代入角动量变化的方程中：\n$$\n\\mathbf{L}^{n+1} - \\mathbf{L}^{n} = \\sum_{a=1}^{4} \\mathbf{x}_a^{n+\\frac{1}{2}} \\times (\\Delta t\\,\\mathbf{f}_{a,\\mathrm{int}}^{n+\\frac{1}{2}}) = \\Delta t \\sum_{a=1}^{4} \\mathbf{x}_a^{n+\\frac{1}{2}} \\times \\mathbf{f}_{a,\\mathrm{int}}^{n+\\frac{1}{2}}\n$$\n问题陈述提供了能量-动量一致內力在刚体运动下的一个关键性质：它们绕中点构型产生的合力矩为零。\n$$\n\\sum_{a=1}^{4}\\mathbf{x}_a^{n+\\frac{1}{2}}\\times \\mathbf{f}_{a,\\mathrm{int}}^{n+\\frac{1}{2}}=\\mathbf{0}\n$$\n因此，角动量的变化为：\n$$\n\\mathbf{L}^{n+1} - \\mathbf{L}^{n} = \\Delta t \\cdot \\mathbf{0} = \\mathbf{0}\n$$\n这证明了 $\\mathbf{L}^{n+1} = \\mathbf{L}^{n}$。对于这种刚体运动，该格式能精确地保持离散角动量守恒。这个守恒的角动量的最终表达式即为任务 1 的结果。令 $\\boldsymbol{\\Omega} = \\begin{pmatrix} \\Omega_1  \\Omega_2  \\Omega_3 \\end{pmatrix}^T$ 为角速度分量的列矢量。角动量矢量为 $\\mathbf{L}^n = 8m\\boldsymbol{\\Omega}$。", "answer": "$$\n\\boxed{8m\\boldsymbol{\\Omega}}\n$$", "id": "2555623"}, {"introduction": "理论推导提供了基础，但通过实施并观察数值格式的行为来获得完整理解是必不可少的。最后的这个动手实践将引导你对一维弹性杆进行一次完整的数值研究。你将实现一个有限元模型，并使用梯形法则——一种对线性系统而言能量守恒的、简单而强大的时间积分器。通过进行网格细化研究，你将从数值上验证两个关键属性：位移场和应力场向精确解的收敛性，以及该格式出色的长期能量稳定性。[@problem_id:2555590]", "problem": "考虑使用有限元法（FEM）求解均质杆的一维线性弹性动力学问题。设杆占据区间 $x \\in (0,L)$，其密度为 $\\rho$，杨氏模量为 $E$，横截面积为常数 $A$。未知位移场为 $u(x,t)$。控制方程为二阶双曲型系统\n$$\n\\rho A \\, \\frac{\\partial^2 u}{\\partial t^2}(x,t) - \\frac{\\partial}{\\partial x}\\Big(E A \\, \\frac{\\partial u}{\\partial x}(x,t)\\Big) = 0 \\quad \\text{for } x \\in (0,L), \\ t  0,\n$$\n其齐次狄利克雷边界条件为 $u(0,t)=0$ 和 $u(L,t)=0$，初始条件为 $u(x,0)=u_0(x)$ 和 $v(x,0)=\\frac{\\partial u}{\\partial t}(x,0)=v_0(x)$。假设无量纲参数 $L=1$，$\\rho=1$，$E=1$ 和 $A=1$，因此波速为 $c=\\sqrt{E/\\rho}=1$。使用精确的初始条件 $u_0(x)=\\sin(\\pi x)$ 和 $v_0(x)=0$，这将产生精确解\n$$\nu_{\\text{exact}}(x,t)=\\sin(\\pi x)\\cos(\\pi t), \\qquad \\sigma_{\\text{exact}}(x,t)=E \\, \\frac{\\partial u_{\\text{exact}}}{\\partial x}(x,t)=\\pi \\cos(\\pi x)\\cos(\\pi t).\n$$\n\n您的任务是使用标准伽辽金法和线性单元对空间问题进行离散化，得到半离散的二阶系统\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0},\n$$\n其中 $\\mathbf{M}$ 是对称正定的一致质量矩阵，$\\mathbf{K}$ 是对称正定的刚度矩阵。然后，使用基于梯形（平均加速度）法则的能量-动量守恒格式，在均匀时间步长 $\\Delta t$ 上进行时间积分。设半离散总能量为\n$$\n\\mathcal{E}(t) = \\tfrac{1}{2}\\,\\dot{\\mathbf{u}}(t)^{\\top}\\mathbf{M}\\,\\dot{\\mathbf{u}}(t) + \\tfrac{1}{2}\\,\\mathbf{u}(t)^{\\top}\\mathbf{K}\\,\\mathbf{u}(t).\n$$\n使用此方法，进行网格细化研究，以数值方式验证以下两点：\n- 随着单元数量的增加，位移场和应力场收敛到精确解。\n- 不存在伪能量注入，这通过离散总能量 $\\mathcal{E}(t)$ 随时间的近乎不变性来量化。\n\n从基本平衡律和弹性动力学的标准弱形式出发，构建空间离散化。使用梯形时间积分器，已知该方法对无阻尼线性系统能够守恒离散能量和线性动量，但不要在未从该方法的定义推导的情况下，假设任何特定的位移和速度更新公式。通过消除相应的自由度来施加齐次狄利克雷边界条件。\n\n在最终时间 $T$ 定义以下离散误差度量：\n- 由一致质量矩阵内积度量的位移误差，\n$$\ne_u = \\sqrt{(\\mathbf{u}_h(T)-\\mathbf{u}_{\\text{exact}}(T))^{\\top}\\mathbf{M}_{\\text{full}}\\,(\\mathbf{u}_h(T)-\\mathbf{u}_{\\text{exact}}(T))},\n$$\n其中 $\\mathbf{M}_{\\text{full}}$ 是施加边界条件前的完整一致质量矩阵，$\\mathbf{u}_h(T)$ 是计算得到的节点场（包括狄利克雷节点处的零值），$\\mathbf{u}_{\\text{exact}}(T)$ 是精确的节点场。\n- 在域上以类 $L^2$ 范数度量的应力误差，\n$$\ne_{\\sigma} = \\bigg(\\int_0^L \\big(\\sigma_h(x,T)-\\sigma_{\\text{exact}}(x,T)\\big)^2\\,dx\\bigg)^{1/2},\n$$\n其中 $\\sigma_h(x,T)=E\\,\\partial u_h/\\partial x$ 是分段常数的有限元应力。每个单元使用足够精确的高斯求积法来数值计算该积分。\n- 在时间区间 $[0,T]$ 上的相对最大能量漂移，\n$$\n\\delta_{\\max} = \\max_{0 \\le n \\le N_t}\\frac{\\big|\\mathcal{E}(t_n)-\\mathcal{E}(0)\\big|}{\\mathcal{E}(0)},\n$$\n其中 $t_n=n\\,\\Delta t$ 且 $N_t=T/\\Delta t$。\n\n测试套件。使用以下三个无量纲测试用例：\n- 用例1（粗网格）：单元数 $N=10$，时间步长 $\\Delta t=0.001$，最终时间 $T=1.0$。\n- 用例2（中等网格）：单元数 $N=20$，时间步长 $\\Delta t=0.001$，最终时间 $T=1.0$。\n- 用例3（细网格）：单元数 $N=40$，时间步长 $\\Delta t=0.001$，最终时间 $T=1.0$。\n\n对于每个用例，计算 $e_u$、$e_{\\sigma}$ 和 $\\delta_{\\max}$。此外，报告布尔值\n- $b_u$，如果位移误差随着网格从 $N=10$ 到 $N=20$ 再到 $N=40$ 的细化而严格减小，则为 $\\text{True}$；\n- $b_{\\sigma}$，如果应力误差在同样的细化序列中严格减小，则为 $\\text{True}$；\n- $b_{\\mathcal{E}}$，如果所有三个用例都满足 $\\delta_{\\max} \\le 10^{-10}$，则为 $\\text{True}$。\n\n所有量均为无量纲。您的程序必须实现均匀网格上线性单元的 $\\mathbf{M}$ 和 $\\mathbf{K}$ 矩阵的组装，施加齐次狄利克雷边界条件，使用梯形法则进行时间步进，计算定义的误差，并汇总整个测试套件的结果。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表，列表包含以下 12 个条目：\n$$\n\\big[e_u(N{=}10), \\ e_u(N{=}20), \\ e_u(N{=}40), \\ e_{\\sigma}(N{=}10), \\ e_{\\sigma}(N{=}20), \\ e_{\\sigma}(N{=}40), \\ \\delta_{\\max}(N{=}10), \\ \\delta_{\\max}(N{=}20), \\ \\delta_{\\max}(N{=}40), \\ b_u, \\ b_{\\sigma}, \\ b_{\\mathcal{E}}\\big].\n$$", "solution": "所呈现的问题是计算弹性动力学中一个标准的、适定的初边值问题。所有参数、条件和目标都定义清晰且科学合理。该问题可作为一个验证练习，用于验证使用能量守恒时间积分方案的一维波动方程的有限元实现。验证已通过，我们可以继续进行求解。\n\n解的构建遵循以下顺序：\n1. 控制偏微分方程的弱形式推导。\n2. 使用带有线性基函数的伽辽金有限元法进行空间离散化，得到半离散的常微分方程组。\n3. 使用梯形法则（平均加速度法）对半离散系统进行时间积分，这是一种针对线性系统的能量守恒格式。\n4. 指定用于计算所需误差度量的算法。\n\n**1. 弱形式**\n\n均质杆的一维弹性动力学控制方程为\n$$\n\\rho A \\, \\frac{\\partial^2 u}{\\partial t^2} - \\frac{\\partial}{\\partial x}\\Big(E A \\, \\frac{\\partial u}{\\partial x}\\Big) = 0 \\quad \\text{for } x \\in (0,L), \\ t  0.\n$$\n这里，$u(x,t)$ 是轴向位移，$\\rho$ 是材料密度，$A$ 是横截面积，$E$ 是杨氏模量。\n为了推导弱形式，我们将方程乘以一个满足齐次狄利克雷边界条件（即 $w(0)=0$ 和 $w(L)=0$）的足够光滑的检验函数 $w(x)$。然后我们在空间域 $[0,L]$ 上进行积分：\n$$\n\\int_0^L w(x) \\left( \\rho A \\, \\frac{\\partial^2 u}{\\partial t^2} - \\frac{\\partial}{\\partial x}\\Big(E A \\, \\frac{\\partial u}{\\partial x}\\Big) \\right) dx = 0.\n$$\n对第二项应用分部积分法得到：\n$$\n\\int_0^L \\rho A w \\ddot{u} \\,dx + \\int_0^L E A \\frac{\\partial w}{\\partial x} \\frac{\\partial u}{\\partial x} \\,dx - \\left[ w \\Big(E A \\frac{\\partial u}{\\partial x}\\Big) \\right]_0^L = 0.\n$$\n边界项 $\\left[ w (E A u') \\right]_0^L$ 因为检验函数 $w$ 在 $x=0$ 和 $x=L$ 处为零而消失。得到的弱形式为：寻找 $u(x,t)$，使得对于所有容许的检验函数 $w(x)$，\n$$\n\\int_0^L \\rho A w \\ddot{u} \\,dx + \\int_0^L E A w' u' \\,dx = 0.\n$$\n\n**2. 空间离散化（有限元法）**\n\n我们将域 $[0,L]$ 离散化为 $N$ 个等长度 $h = L/N$ 的线性有限元。在这个离散空间内，位移场被近似为基函数 $N_j(x)$ 的线性组合：\n$$\nu_h(x,t) = \\sum_{j=0}^{N} u_j(t) N_j(x),\n$$\n其中 $u_j(t)$ 是节点 $j$ 处的位移，$N_j(x)$ 是线性“帽”函数，它在节点 $j$ 处为 1，在所有其他节点处为 0。\n根据伽辽金法，检验函数 $w(x)$ 从与试探函数相同的空间中选取，即 $w(x) = N_i(x)$，其中 $i=0, 1, \\dots, N$。将近似解 $u_h(x,t)$ 代入弱形式，并对每个 $i=0, \\dots, N$ 选择 $w(x) = N_i(x)$，得到一个常微分方程组：\n$$\n\\sum_{j=0}^{N} \\left( \\int_0^L \\rho A N_i N_j dx \\right) \\ddot{u}_j(t) + \\sum_{j=0}^{N} \\left( \\int_0^L E A N_i' N_j' dx \\right) u_j(t) = 0.\n$$\n这就是半离散系统 $\\mathbf{M}_{\\text{full}}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}_{\\text{full}}\\,\\mathbf{u}(t) = \\mathbf{0}$，其中 $\\mathbf{u}(t)$ 是节点位移向量 $[u_0(t), \\dots, u_N(t)]^T$，完整质量矩阵和刚度矩阵的项为：\n$$\n(\\mathbf{M}_{\\text{full}})_{ij} = \\int_0^L \\rho A N_i(x) N_j(x) \\,dx \\qquad (\\text{一致质量矩阵})\n$$\n$$\n(\\mathbf{K}_{\\text{full}})_{ij} = \\int_0^L E A N_i'(x) N_j'(x) \\,dx \\qquad (\\text{刚度矩阵})\n$$\n对于长度为 $h$、无量纲参数为 $\\rho=A=E=1$ 的单个线性单元，其局部单元质量矩阵和刚度矩阵为：\n$$\n\\mathbf{m}^e = \\frac{h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}, \\quad \\mathbf{k}^e = \\frac{1}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}.\n$$\n这些单元矩阵被组装成全局矩阵 $\\mathbf{M}_{\\text{full}}$ 和 $\\mathbf{K}_{\\text{full}}$。通过从这些矩阵中移除第一行和最后一行以及第一列和最后一列，来施加齐次狄利克雷边界条件 $u_0(t)=0$ 和 $u_N(t)=0$。得到的简化系统是 $\\mathbf{M}\\,\\ddot{\\mathbf{d}}(t) + \\mathbf{K}\\,\\mathbf{d}(t) = \\mathbf{0}$，其中 $\\mathbf{d}(t) = [u_1(t), \\dots, u_{N-1}(t)]^T$ 是未知内部节点位移的向量，$\\mathbf{M}$ 和 $\\mathbf{K}$ 是 $(N-1) \\times (N-1)$ 的简化矩阵，它们是对称且正定的。\n\n**3. 时间离散化（梯形法则）**\n\n半离散系统使用梯形法则（也称为平均加速度法或参数为 $\\gamma=1/2$, $\\beta=1/4$ 的 Newmark 方法）进行时间积分。对于一个时间步长 $\\Delta t$，从时间 $t_n$ 到 $t_{n+1}$ 的位移 $\\mathbf{d}$ 和速度 $\\mathbf{v} = \\dot{\\mathbf{d}}$ 的更新由下式给出：\n$$\n\\mathbf{d}_{n+1} = \\mathbf{d}_n + \\Delta t \\, \\mathbf{v}_n + \\frac{\\Delta t^2}{2} \\left( (1-2\\beta)\\ddot{\\mathbf{d}}_n + 2\\beta \\ddot{\\mathbf{d}}_{n+1} \\right)\n$$\n$$\n\\mathbf{v}_{n+1} = \\mathbf{v}_n + \\Delta t \\left( (1-\\gamma)\\ddot{\\mathbf{d}}_n + \\gamma \\ddot{\\mathbf{d}}_{n+1} \\right)\n$$\n当 $\\gamma=1/2$ 和 $\\beta=1/4$ 时，并使用运动方程 $\\mathbf{M}\\ddot{\\mathbf{d}}_{n+1} = -\\mathbf{K}\\mathbf{d}_{n+1}$，我们可以推导出更新格式。我们首先重新排列位移更新公式来求解 $\\ddot{\\mathbf{d}}_{n+1}$：\n$$ \\ddot{\\mathbf{d}}_{n+1} = \\frac{4}{\\Delta t^2}(\\mathbf{d}_{n+1} - \\mathbf{d}_n - \\Delta t \\mathbf{v}_n) - \\ddot{\\mathbf{d}}_n. $$\n将此代入 $t_{n+1}$ 时刻的运动方程：\n$$ \\mathbf{M} \\left( \\frac{4}{\\Delta t^2}(\\mathbf{d}_{n+1} - \\mathbf{d}_n - \\Delta t \\mathbf{v}_n) - \\ddot{\\mathbf{d}}_n \\right) + \\mathbf{K}\\mathbf{d}_{n+1} = \\mathbf{0}. $$\n重新排列以求解未知量 $\\mathbf{d}_{n+1}$：\n$$ \\left(\\mathbf{M} + \\frac{\\Delta t^2}{4}\\mathbf{K}\\right) \\mathbf{d}_{n+1} = \\mathbf{M} \\left( \\mathbf{d}_n + \\Delta t \\mathbf{v}_n + \\frac{\\Delta t^2}{4}\\ddot{\\mathbf{d}}_n \\right). $$\n使用 $\\mathbf{M}\\ddot{\\mathbf{d}}_n = -\\mathbf{K}\\mathbf{d}_n$，右侧简化为：\n$$ \\left(\\mathbf{M} + \\frac{\\Delta t^2}{4}\\mathbf{K}\\right) \\mathbf{d}_{n+1} = \\mathbf{M} (\\mathbf{d}_n + \\Delta t \\mathbf{v}_n) - \\frac{\\Delta t^2}{4} \\mathbf{K} \\mathbf{d}_n. $$\n在每个时间步，我们求解这个线性系统以得到 $\\mathbf{d}_{n+1}$。一旦找到 $\\mathbf{d}_{n+1}$，就更新加速度 $\\ddot{\\mathbf{d}}_{n+1}$ 和速度 $\\mathbf{v}_{n+1}$。初始条件是问题陈述中给出的 $\\mathbf{d}_0$ 和 $\\mathbf{v}_0$，而 $\\ddot{\\mathbf{d}}_0$ 通过求解 $\\mathbf{M}\\ddot{\\mathbf{d}}_0 = -\\mathbf{K}\\mathbf{d}_0$ 得到。\n\n该方法是无条件稳定的，并且对于线性系统能精确守恒离散能量 $\\mathcal{E}(t) = \\tfrac{1}{2}\\,\\mathbf{v}(t)^{\\top}\\mathbf{M}\\,\\mathbf{v}(t) + \\tfrac{1}{2}\\,\\mathbf{d}(t)^{\\top}\\mathbf{K}\\,\\mathbf{d}(t)$，这意味着在精确算术中 $\\mathcal{E}(t_{n+1}) = \\mathcal{E}(t_n)$。\n\n**4. 误差计算**\n\n- **位移误差 ($e_u$):** 在最终时间 $T$，我们将计算出的内部解 $\\mathbf{d}(T)$ 的前后分别添加零，以代表狄利克雷节点，从而形成大小为 ($N+1$) 的完整数值解向量 $\\mathbf{u}_h(T)$。精确解向量 $\\mathbf{u}_{\\text{exact}}(T)$ 是通过在所有节点 $i=0, \\dots, N$ 上计算 $u_{\\text{exact}}(x_i, T)$ 得到的。然后使用由完整质量矩阵导出的能量范数计算误差：\n$e_u = \\sqrt{(\\mathbf{u}_h(T)-\\mathbf{u}_{\\text{exact}}(T))^{\\top}\\mathbf{M}_{\\text{full}}\\,(\\mathbf{u}_h(T)-\\mathbf{u}_{\\text{exact}}(T))}$。\n\n- **应力误差 ($e_{\\sigma}$):** 数值应力 $\\sigma_h(x,T)$ 在每个单元 $e$ 上是分段常数。在节点 $j-1$ 和 $j$ 之间的单元上，它由 $\\sigma_h^e(T) = E (u_j(T) - u_{j-1}(T))/h$ 给出。类 $L^2$ 误差的平方是每个单元上积分的总和：\n$e_{\\sigma}^2 = \\sum_{e=1}^N \\int_{x_{e-1}}^{x_e} (\\sigma_h^e(T)-\\sigma_{\\text{exact}}(x,T))^2\\,dx$。每个积分都使用高精度数值求积法（例如 `scipy.integrate.quad` 中实现的 Gauss-Kronrod 方法）进行计算。\n\n- **能量漂移 ($\\delta_{\\max}$):** 在每个时间步 $t_n$，计算离散总能量 $\\mathcal{E}(t_n)$。初始能量 $\\mathcal{E}(0)$ 根据初始条件计算。然后在整个模拟历史中找到最大相对漂移：\n$\\delta_{\\max} = \\max_{0 \\le n \\le N_t} \\frac{|\\mathcal{E}(t_n)-\\mathcal{E}(0)|}{|\\mathcal{E}(0)|}$。一个小的 $\\delta_{\\max}$ 值表示时间积分器引入的伪能量注入或耗散可以忽略不计。\n\n随着 $N$ 的增加，$e_u$ 和 $e_\\sigma$ 的收敛性证明了空间离散化的准确性，而接近于零的 $\\delta_{\\max}$ 值证实了时间格式的能量守恒特性。", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve\nfrom scipy.sparse.linalg import splu\nfrom scipy.sparse import csc_matrix\nfrom scipy.integrate import quad\n\ndef solve_problem():\n    \"\"\"\n    Solves the 1D elastodynamics problem using FEM and an energy-conserving\n    time integrator, performing a mesh refinement study as specified.\n    \"\"\"\n    # Nondimensional parameters\n    L = 1.0\n    E = 1.0\n    rho = 1.0\n    A = 1.0\n\n    # Test suite from the problem statement\n    test_cases = [\n        {'N': 10, 'dt': 0.001, 'T': 1.0},\n        {'N': 20, 'dt': 0.001, 'T': 1.0},\n        {'N': 40, 'dt': 0.001, 'T': 1.0}\n    ]\n\n    results_eu = []\n    results_esigma = []\n    results_dmax = []\n\n    for case in test_cases:\n        N = case['N']\n        dt = case['dt']\n        T = case['T']\n        \n        h = L / N\n        num_nodes = N + 1\n        num_dofs_full = num_nodes\n        num_dofs_reduced = N - 1\n\n        # 1. Spatial Discretization: Assemble M and K matrices\n        M_full = np.zeros((num_dofs_full, num_dofs_full))\n        K_full = np.zeros((num_dofs_full, num_dofs_full))\n\n        m_e = (rho * A * h / 6.0) * np.array([[2, 1], [1, 2]])\n        k_e = (E * A / h) * np.array([[1, -1], [-1, 1]])\n\n        for i in range(N):\n            nodes = [i, i + 1]\n            M_full[np.ix_(nodes, nodes)] += m_e\n            K_full[np.ix_(nodes, nodes)] += k_e\n\n        # 2. Apply homogeneous Dirichlet BCs\n        M = M_full[1:-1, 1:-1]\n        K = K_full[1:-1, 1:-1]\n\n        # 3. Initial Conditions\n        x_coords_full = np.linspace(0, L, num_nodes)\n        x_coords_reduced = x_coords_full[1:-1]\n\n        u0_reduced = np.sin(np.pi * x_coords_reduced)\n        v0_reduced = np.zeros(num_dofs_reduced)\n        \n        # Initial acceleration: M*a0 = -K*u0\n        a0_reduced = solve(M, -K @ u0_reduced)\n\n        # 4. Time Integration (Trapezoidal Rule / Newmark beta=1/4, gamma=1/2)\n        u_n, v_n, a_n = u0_reduced, v0_reduced, a0_reduced\n\n        # Effective stiffness matrix for time stepping\n        A_eff = M + (dt**2 / 4.0) * K\n        # Use sparse LU factorization for efficiency\n        A_eff_splu = splu(csc_matrix(A_eff))\n\n        num_steps = int(round(T / dt))\n        energies = []\n        \n        # Calculate initial energy\n        E_kin0 = 0.5 * v_n.T @ M @ v_n\n        E_pot0 = 0.5 * u_n.T @ K @ u_n\n        E0 = E_kin0 + E_pot0\n        energies.append(E0)\n\n        for _ in range(num_steps):\n            # Form right-hand side vector\n            rhs = M @ (u_n + dt * v_n) - (dt**2 / 4.0) * K @ u_n\n            \n            # Solve for next displacement\n            u_next = A_eff_splu.solve(rhs)\n\n            # Update acceleration and velocity\n            a_next = (4.0 / dt**2) * (u_next - u_n - dt * v_n) - a_n\n            v_next = v_n + (dt / 2.0) * (a_n + a_next)\n            \n            u_n, v_n, a_n = u_next, v_next, a_next\n\n            # Store energy for drift calculation\n            E_kin = 0.5 * v_n.T @ M @ v_n\n            E_pot = 0.5 * u_n.T @ K @ u_n\n            energies.append(E_kin + E_pot)\n\n        # 5. Error Calculation at time T\n        \n        # Displacement error e_u\n        u_h_final_full = np.concatenate(([0], u_n, [0]))\n        u_exact_final_full = np.sin(np.pi * x_coords_full) * np.cos(np.pi * T)\n        error_vec_u = u_h_final_full - u_exact_final_full\n        e_u = np.sqrt(error_vec_u.T @ M_full @ error_vec_u)\n        results_eu.append(e_u)\n\n        # Stress error e_sigma\n        total_sq_stress_error = 0.0\n        for i in range(N):\n            u_left, u_right = u_h_final_full[i], u_h_final_full[i+1]\n            sigma_h = N * (u_right - u_left) # E=1, h=1/N\n            \n            def sigma_exact_func(x):\n                return np.pi * np.cos(np.pi * x) * np.cos(np.pi * T)\n\n            def integrand(x):\n                return (sigma_h - sigma_exact_func(x))**2\n\n            integral_val, _ = quad(integrand, x_coords_full[i], x_coords_full[i+1])\n            total_sq_stress_error += integral_val\n\n        e_sigma = np.sqrt(total_sq_stress_error)\n        results_esigma.append(e_sigma)\n\n        # Energy drift delta_max\n        energies = np.array(energies)\n        if E0 == 0:\n            delta_max = 0.0 \n        else:\n            delta_max = np.max(np.abs(energies - E0)) / np.abs(E0)\n        results_dmax.append(delta_max)\n\n    # 6. Boolean Checks\n    b_u = results_eu[2]  results_eu[1] and results_eu[1]  results_eu[0]\n    b_sigma = results_esigma[2]  results_esigma[1] and results_esigma[1]  results_esigma[0]\n    b_E = all(d = 1e-10 for d in results_dmax)\n\n    # Final output formatting\n    final_list = results_eu + results_esigma + results_dmax + [b_u, b_sigma, b_E]\n    \n    # Format the floats to a consistent representation to avoid printing issues.\n    formatted_list = [f\"{x:.6e}\" if isinstance(x, float) else str(x) for x in final_list]\n    \n    print(f\"[{','.join(formatted_list)}]\")\n\nsolve_problem()\n```", "id": "2555590"}]}