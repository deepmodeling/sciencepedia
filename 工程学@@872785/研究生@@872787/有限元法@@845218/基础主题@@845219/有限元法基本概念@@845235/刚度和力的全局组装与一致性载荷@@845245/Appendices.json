{"hands_on_practices": [{"introduction": "本节的第一个练习将引导您完成有限元分析的基本步骤。通过从一个简单一维杆的虚功原理出发 [@problem_id:2562929]，我们将推导单元刚度矩阵和一致荷载向量，将它们组装成一个全局系统，并求解节点位移。这个练习旨在巩固组装过程的核心机制。", "problem": "一根等截面杆沿 $x$ 轴放置，占据区间 $x \\in [0, L]$，其中 $L = 2\\,\\mathrm{m}$。该杆具有恒定的横截面积 $A = 1.0 \\times 10^{-4}\\,\\mathrm{m}^{2}$ 和杨氏模量 $E = 200\\,\\mathrm{GPa}$。该杆承受一个作用于正 $x$ 方向的均布轴向载荷（单位长度的体力）$q(x) = q_{0}$，其中 $q_{0} = 1000\\,\\mathrm{N/m}$，以及一个在 $x=L$ 处施加于正 $x$ 方向的附加末端牵引力 $t_{L} = 500\\,\\mathrm{N}$。左端位移固定，$u(0) = 0$。\n\n以虚功原理和小应变线弹性理论为唯一出发点，使用有限元法（FEM）将杆离散为两个等长的两节点线性单元。对于每个单元：\n- 推导单元刚度矩阵和由均布载荷 $q_{0}$ 引起的一致单元载荷向量，\n- 组装全局刚度矩阵和全局力向量（包括末端牵引力的贡献），\n- 施加本质边界条件并求解节点位移。\n\n最后，计算右端位移 $u(L)$。将答案四舍五入至四位有效数字，并以 $\\mathrm{mm}$ 为单位表示。您的最终答案必须是一个实数。", "solution": "问题陈述经过验证。\n\n**第1步：提取已知条件**\n- 区域：沿 $x$ 轴的等截面杆，$x \\in [0, L]$。\n- 长度：$L = 2\\,\\mathrm{m}$。\n- 横截面积：$A = 1.0 \\times 10^{-4}\\,\\mathrm{m}^{2}$。\n- 杨氏模量：$E = 200\\,\\mathrm{GPa} = 200 \\times 10^{9}\\,\\mathrm{N/m^2}$。\n- 均布轴向载荷：$q(x) = q_{0} = 1000\\,\\mathrm{N/m}$。\n- 末端牵引力：$t_{L} = 500\\,\\mathrm{N}$ 于 $x=L$ 处。\n- 边界条件：$u(0) = 0$。\n- 离散化：两个等长的两节点线性单元。\n- 要求方法：虚功原理。\n- 要求输出：单元刚度矩阵、一致单元载荷向量、全局组装系统、节点位移，以及 $u(L)$ 的最终值（以 $\\mathrm{mm}$ 为单位，四舍五入到四位有效数字）。\n\n**第2步：使用提取的已知条件进行验证**\n- **科学依据：** 该问题是一维线弹性和有限元法的标准应用，基于完善的虚功原理。所有物理量和材料属性均为标准值。该问题在科学上是合理的。\n- **适定性：** 该问题是一个二阶常微分方程的适定边值问题。本质边界条件（$u(0)=0$）和自然边界条件（载荷）的组合确保了唯一解的存在。\n- **客观性：** 问题陈述使用了精确、定量和无歧义的语言。\n- **完整性与一致性：** 提供了求得唯一解所需的所有必要参数（$L, A, E, q_{0}, t_{L}$）和边界条件。数据是自洽的且量纲正确。不存在矛盾。\n\n**第3步：结论与行动**\n该问题是有效的，因为它具有科学依据、适定性、客观性和完整性。将提供解答。\n\n一维弹性杆的虚功原理如下：\n$$\n\\int_{0}^{L} \\delta\\epsilon(x) \\sigma(x) A \\, dx = \\int_{0}^{L} \\delta u(x) q(x) \\, dx + \\sum_{i} \\delta u(x_i) F_i\n$$\n其中 $\\delta u$ 是虚位移，$\\delta\\epsilon = \\frac{d(\\delta u)}{dx}$ 是虚应变，$\\sigma$ 是应力。此处的点力 $F_i$ 包括在 $x=L$ 处的末端牵引力 $t_L$。使用线弹性本构关系 $\\sigma(x) = E \\epsilon(x) = E \\frac{du}{dx}$，弱形式为：\n$$\n\\int_{0}^{L} E A \\frac{d(\\delta u)}{dx} \\frac{du}{dx} \\, dx = \\int_{0}^{L} \\delta u(x) q_0 \\, dx + \\delta u(L) t_{L}\n$$\n杆被离散为两个等长单元。每个单元的长度为 $l_e = L/2 = 2/2 = 1\\,\\mathrm{m}$。共有三个节点：节点1在 $x=0$ 处，节点2在 $x=1$ 处，节点3在 $x=2$ 处。\n\n对于一个从局部坐标 $\\xi=0$ 延伸到 $\\xi=l_e$ 的通用两节点线性单元，位移场 $u^{(e)}(\\xi)$ 由节点位移 $\\mathbf{d}^{(e)} = [u_i, u_j]^T$ 插值得到：\n$$\nu^{(e)}(\\xi) = N_1(\\xi) u_i + N_2(\\xi) u_j = \\mathbf{N}(\\xi) \\mathbf{d}^{(e)}\n$$\n线性形函数为 $N_1(\\xi) = 1 - \\frac{\\xi}{l_e}$ 和 $N_2(\\xi) = \\frac{\\xi}{l_e}$。\n应变为 $\\epsilon^{(e)}(\\xi) = \\frac{du^{(e)}}{d\\xi} = \\begin{bmatrix} -\\frac{1}{l_e}  \\frac{1}{l_e} \\end{bmatrix} \\mathbf{d}^{(e)} = \\mathbf{B} \\mathbf{d}^{(e)}$。\n\n单元刚度矩阵 $\\mathbf{k}^{(e)}$ 从内虚功推导得出：\n$$\n\\mathbf{k}^{(e)} = \\int_{0}^{l_e} \\mathbf{B}^T (EA) \\mathbf{B} \\, d\\xi\n$$\n由于 $\\mathbf{B}$、$E$ 和 $A$ 在单元内是常数：\n$$\n\\mathbf{k}^{(e)} = EA l_e \\mathbf{B}^T \\mathbf{B} = E A l_e \\begin{bmatrix} -1/l_e \\\\ 1/l_e \\end{bmatrix} \\begin{bmatrix} -1/l_e  1/l_e \\end{bmatrix} = \\frac{EA}{l_e} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}\n$$\n由均布载荷 $q_0$ 引起的一致单元载荷向量 $\\mathbf{f}_q^{(e)}$ 从外虚功推导得出：\n$$\n\\mathbf{f}_q^{(e)} = \\int_{0}^{l_e} \\mathbf{N}^T q_0 \\, d\\xi = q_0 \\int_{0}^{l_e} \\begin{bmatrix} 1 - \\xi/l_e \\\\ \\xi/l_e \\end{bmatrix} d\\xi = q_0 \\begin{bmatrix} l_e/2 \\\\ l_e/2 \\end{bmatrix} = \\frac{q_0 l_e}{2} \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}\n$$\n对于本问题，$E = 200 \\times 10^9\\,\\mathrm{N/m^2}$，$A = 1.0 \\times 10^{-4}\\,\\mathrm{m^2}$，$l_e=1\\,\\mathrm{m}$，以及 $q_0 = 1000\\,\\mathrm{N/m}$。\n轴向刚度为 $EA = (200 \\times 10^9) \\times (1.0 \\times 10^{-4}) = 2 \\times 10^7\\,\\mathrm{N}$。\n对于两个单元（$e=1, 2$），刚度矩阵为：\n$$\n\\mathbf{k}^{(1)} = \\mathbf{k}^{(2)} = \\frac{2 \\times 10^7}{1} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix} = 2 \\times 10^7 \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix} \\,\\mathrm{N/m}\n$$\n每个单元的一致载荷向量为：\n$$\n\\mathbf{f}_q^{(1)} = \\mathbf{f}_q^{(2)} = \\frac{1000 \\times 1}{2} \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix} = \\begin{bmatrix} 500 \\\\ 500 \\end{bmatrix} \\,\\mathrm{N}\n$$\n现在，我们组装 $3 \\times 3$ 的全局刚度矩阵 $\\mathbf{K}$ 和 $3 \\times 1$ 的全局力向量 $\\mathbf{F}$。\n单元1连接节点1和2。单元2连接节点2和3。\n$$\n\\mathbf{K} = \\frac{EA}{l_e} \\begin{bmatrix} 1  -1  0 \\\\ -1  1+1  -1 \\\\ 0  -1  1 \\end{bmatrix} = 2 \\times 10^7 \\begin{bmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{bmatrix} \\,\\mathrm{N/m}\n$$\n全局力向量 $\\mathbf{F}$ 是均布载荷贡献 $\\mathbf{F}_q$ 和点载荷贡献 $\\mathbf{F}_t$ 的总和。\n$$\n\\mathbf{F}_q = \\begin{bmatrix} (\\mathbf{f}_q^{(1)})_1 \\\\ (\\mathbf{f}_q^{(1)})_2 + (\\mathbf{f}_q^{(2)})_1 \\\\ (\\mathbf{f}_q^{(2)})_2 \\end{bmatrix} = \\begin{bmatrix} 500 \\\\ 500+500 \\\\ 500 \\end{bmatrix} = \\begin{bmatrix} 500 \\\\ 1000 \\\\ 500 \\end{bmatrix} \\,\\mathrm{N}\n$$\n末端牵引力 $t_L = 500\\,\\mathrm{N}$ 是节点3处的一个点载荷。\n$$\n\\mathbf{F}_t = \\begin{bmatrix} 0 \\\\ 0 \\\\ 500 \\end{bmatrix} \\,\\mathrm{N}\n$$\n总的全局力向量是：\n$$\n\\mathbf{F} = \\mathbf{F}_q + \\mathbf{F}_t = \\begin{bmatrix} 500 \\\\ 1000 \\\\ 500 \\end{bmatrix} + \\begin{bmatrix} 0 \\\\ 0 \\\\ 500 \\end{bmatrix} = \\begin{bmatrix} 500 \\\\ 1000 \\\\ 1000 \\end{bmatrix} \\,\\mathrm{N}\n$$\n全局方程组为 $\\mathbf{K}\\mathbf{U} = \\mathbf{F}$，其中 $\\mathbf{U}=[U_1, U_2, U_3]^T$：\n$$\n2 \\times 10^7 \\begin{bmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{bmatrix} \\begin{bmatrix} U_1 \\\\ U_2 \\\\ U_3 \\end{bmatrix} = \\begin{bmatrix} 500 \\\\ 1000 \\\\ 1000 \\end{bmatrix}\n$$\n我们施加本质边界条件 $u(0)=0$，这意味着 $U_1=0$。我们通过移除与固定自由度对应的第一行和第一列来对矩阵进行分块。关于未知位移 $U_2$ 和 $U_3$ 的方程组变为：\n$$\n2 \\times 10^7 \\begin{bmatrix} 2  -1 \\\\ -1  1 \\end{bmatrix} \\begin{bmatrix} U_2 \\\\ U_3 \\end{bmatrix} = \\begin{bmatrix} 1000 \\\\ 1000 \\end{bmatrix}\n$$\n这等价于以下方程组：\n$$\n\\begin{cases}\n2U_2 - U_3 = \\frac{1000}{2 \\times 10^7} = 0.5 \\times 10^{-4} \\\\\n-U_2 + U_3 = \\frac{1000}{2 \\times 10^7} = 0.5 \\times 10^{-4}\n\\end{cases}\n$$\n将两个方程相加，得出：\n$$\n(2U_2 - U_3) + (-U_2 + U_3) = 0.5 \\times 10^{-4} + 0.5 \\times 10^{-4}\n$$\n$$\nU_2 = 1.0 \\times 10^{-4}\\,\\mathrm{m}\n$$\n将 $U_2$ 代入第二个方程：\n$$\n-(1.0 \\times 10^{-4}) + U_3 = 0.5 \\times 10^{-4}\n$$\n$$\nU_3 = (1.0 \\times 10^{-4}) + (0.5 \\times 10^{-4}) = 1.5 \\times 10^{-4}\\,\\mathrm{m}\n$$\n右端的位移为 $u(L) = U_3$。\n$$\nu(L) = 1.5 \\times 10^{-4}\\,\\mathrm{m}\n$$\n转换为毫米：\n$$\nu(L) = 1.5 \\times 10^{-4} \\times 1000\\,\\mathrm{mm} = 0.15\\,\\mathrm{mm}\n$$\n按要求四舍五入到四位有效数字：\n$$\nu(L) = 0.1500\\,\\mathrm{mm}\n$$", "answer": "$$\n\\boxed{0.1500}\n$$", "id": "2562929"}, {"introduction": "在掌握了基础技能之后，这个练习将引入更符合实际的复杂情况，例如分段变化的材料属性和空间变化的荷载 [@problem_id:2538126]。本练习的主要教学目标是学习如何计算约束节点处的反作用力，并利用全局静力平衡原理来验证解的正确性。这在任何实际工程分析中都是一个至关重要的验证步骤。", "problem": "考虑一根沿$x$轴放置的直细杆，占据区间$x \\in [0,L]$，处于小应变、线弹性、准静态、一维轴向变形状态。该杆的杨氏模量$E$沿其长度为常数，横截面积$A(x)$为分段常数。它承受单位体积轴向体力$b(x)$以及在自由端施加的指定轴向点力。左端$x=0$处为固定端（本质Dirichlet边界条件），右端$x=L$处承受牵引力载荷（Neumann边界条件）。采用符号约定，$+x$方向的力为正，位移$u(x)$沿$+x$方向测量。\n\n将该杆离散化为两个等长的双节点线性杆单元（一维线性有限元），并从虚功原理和线性形函数的定义出发，使用有限元法（FEM）组装全局系统。不要调用任何预打包的“快捷”公式；相反，通过计算必要的积分来推导单元刚度矩阵和等效单元载荷向量。\n\n杆的数据如下：\n- 长度：$L = 2\\,\\mathrm{m}$，节点位于$x_1 = 0\\,\\mathrm{m}$、$x_2 = 1\\,\\mathrm{m}$和$x_3 = 2\\,\\mathrm{m}$。\n- 杨氏模量：$E = 2.10 \\times 10^{11}\\,\\mathrm{Pa}$。\n- 横截面积：当$x \\in [0,1]$时，$A(x) = 2.0 \\times 10^{-4}\\,\\mathrm{m}^2$；当$x \\in [1,2]$时，$A(x) = 1.2 \\times 10^{-4}\\,\\mathrm{m}^2$。\n- 单位体积体力：$b(x) = b_0 + b_1 x$，其中$b_0 = 2.0 \\times 10^{7}\\,\\mathrm{N/m}^3$，$b_1 = 1.0 \\times 10^{7}\\,\\mathrm{N/m}^4$。\n- 在$x=L$处施加的轴向点力：$\\bar{T} = 1.50 \\times 10^{4}\\,\\mathrm{N}$，方向为$+x$方向。\n- 本质边界条件：$u(0) = 0$。\n\n任务：\n1. 从一维轴向变形的虚功原理出发，为一个长度为$\\ell$、在单元上具有恒定$E$和$A$、且$b(x)$如上所述但限制在单元域内的通用双节点线性杆单元，推导其单元刚度矩阵和由体力引起的等效单元载荷向量。\n2. 为所述的双单元网格组装全局刚度矩阵和全局载荷向量，包括在$x=L$处右端点力的贡献。\n3. 施加在$x=0$处的本质边界条件，求解未知节点位移。\n4. 使用组装好的全局算子和解出的位移向量，根据约束节点$x=0$处的离散平衡方程计算该节点的反力。然后，通过检查在$x=0$处的反力、体力合力$\\int_0^L A(x)\\,b(x)\\,dx$以及施加的端点力$\\bar{T}$的代数和在所采用的符号约定下是否为零，来验证整个杆的全局平衡。\n\n请提供您最终答案中$x=0$处的反力，以千牛（kN）为单位表示，并四舍五入到四位有效数字。仅报告以kN为单位的数值（最终的方框答案中不要包含单位）。", "solution": "在尝试任何解答之前，需要对问题陈述进行验证。\n\n步骤 1：提取已知条件\n- **定义域**：位于区间$x \\in [0,L]$上，长度为$L=2\\,\\mathrm{m}$的直杆。\n- **离散化**：两个等长的双节点线性杆单元。节点位于$x_1=0\\,\\mathrm{m}$、$x_2=1\\,\\mathrm{m}$和$x_3=2\\,\\mathrm{m}$。单元1跨越$[0,1]$，单元2跨越$[1,2]$。每个单元的长度为$\\ell_e = 1\\,\\mathrm{m}$。\n- **材料属性**：杨氏模量为常数，$E = 2.10 \\times 10^{11}\\,\\mathrm{Pa}$。\n- **几何属性**：横截面积是分段常数：当$x \\in [0,1]$时，$A(x) = A_1 = 2.0 \\times 10^{-4}\\,\\mathrm{m}^2$；当$x \\in [1,2]$时，$A(x) = A_2 = 1.2 \\times 10^{-4}\\,\\mathrm{m}^2$。\n- **载荷**：\n    - 单位体积轴向体力：$b(x) = b_0 + b_1 x$，其中$b_0 = 2.0 \\times 10^{7}\\,\\mathrm{N/m}^3$，$b_1 = 1.0 \\times 10^{7}\\,\\mathrm{N/m}^4$。\n    - 在$x=L$处的轴向点力：$\\bar{T} = 1.50 \\times 10^{4}\\,\\mathrm{N}$。\n- **边界条件**：\n    - 本质 (Dirichlet) 边界条件，在$x=0$处：$u(0) = 0$。\n    - 自然 (Neumann) 边界条件，在$x=L$处：牵引力载荷，由$\\bar{T}$体现。\n- **符号约定**：位移$u(x)$和力在$+x$方向为正。\n\n步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，是有限元法在线弹性静力学一维问题中的标准应用。这是一个适定问题，具有足够的数据和防止刚体运动的边界条件，从而确保了唯一解。语言客观、精确。数据在量纲上是一致的，对于承受显著载荷的钢杆来说是物理上合理的。该问题需要详细的推导和计算，因此并非微不足道。它没有违反任何无效性标准。\n\n步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n有限元法公式从一维弹性体的虚功原理 (PVW) 开始：\n$$ \\int_{0}^{L} \\delta\\epsilon \\sigma A \\,dx = \\int_{0}^{L} \\delta u \\, b A \\,dx + \\sum_i \\delta u_i P_i $$\n其中$\\sigma$是轴向应力，$\\epsilon$是轴向应变，$u$是轴向位移，$b$是单位体积体力，$A$是横截面积，$P_i$是点载荷。对于线弹性体，$\\sigma = E\\epsilon$。应变为$\\epsilon = du/dx$。\n\n一个双节点线性单元定义在局部域$x' \\in [0, \\ell_e]$上。单元内的位移场$u(x')$是通过线性形函数$N_1(x')$和$N_2(x')$从节点位移$d_1^e, d_2^e$插值得到的：\n$$ u(x') = N_1(x')d_1^e + N_2(x')d_2^e = \\mathbf{N}(x')\\mathbf{d}^e $$\n其中$N_1(x') = 1 - x'/\\ell_e$和$N_2(x') = x'/\\ell_e$。应变由下式给出：\n$$ \\epsilon(x') = \\frac{du}{dx'} = \\frac{d\\mathbf{N}}{dx'}\\mathbf{d}^e = \\mathbf{B}\\mathbf{d}^e = \\begin{bmatrix} -\\frac{1}{\\ell_e}  \\frac{1}{\\ell_e} \\end{bmatrix} \\mathbf{d}^e $$\n虚量为$\\delta u = \\mathbf{N}\\delta\\mathbf{d}^e$和$\\delta\\epsilon = \\mathbf{B}\\delta\\mathbf{d}^e$。\n\n**任务 1：推导单元刚度矩阵和载荷向量**\n\n单元刚度矩阵$\\mathbf{k}^e$从内虚功项推导得出：\n$$ \\delta\\mathbf{d}^{eT} \\mathbf{k}^e \\mathbf{d}^e = \\int_{0}^{\\ell_e} \\delta\\epsilon^T E \\epsilon A \\,dx' = \\int_{0}^{\\ell_e} (\\delta\\mathbf{d}^{eT}\\mathbf{B}^T) E (\\mathbf{B}\\mathbf{d}^e) A \\,dx' $$\n由于$\\delta\\mathbf{d}^e$是任意的，我们有：\n$$ \\mathbf{k}^e = \\int_{0}^{\\ell_e} \\mathbf{B}^T E A \\mathbf{B} \\,dx' $$\n对于具有恒定$E$和$A$的单元：\n$$ \\mathbf{k}^e = EA \\int_{0}^{\\ell_e} \\begin{bmatrix} -1/\\ell_e \\\\ 1/\\ell_e \\end{bmatrix} \\begin{bmatrix} -1/\\ell_e  1/\\ell_e \\end{bmatrix} \\,dx' = EA \\int_{0}^{\\ell_e} \\frac{1}{\\ell_e^2}\\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} \\,dx' = \\frac{EA}{\\ell_e}\\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} $$\n由体力产生的等效单元载荷向量$\\mathbf{f}_b^e$从体力的外虚功推导得出：\n$$ \\delta\\mathbf{d}^{eT} \\mathbf{f}_b^e = \\int_{0}^{\\ell_e} \\delta u \\, b A \\,dx' = \\int_{0}^{\\ell_e} (\\delta\\mathbf{d}^{eT}\\mathbf{N}^T) b(x') A \\,dx' $$\n$$ \\mathbf{f}_b^e = \\int_{0}^{\\ell_e} A \\mathbf{N}^T b(x') \\,dx' $$\n体力$b(x)$在全局坐标中定义。设一个单元始于全局坐标$x_{start}$。全局坐标为$x = x_{start} + x'$。因此，$b(x') = b_0 + b_1(x_{start} + x')$。\n$$ \\mathbf{f}_b^e = A \\int_0^{\\ell_e} \\begin{pmatrix} 1 - x'/\\ell_e \\\\ x'/\\ell_e \\end{pmatrix} (b_0 + b_1 x_{start} + b_1 x') \\,dx' $$\n计算第一个分量的积分：\n$$ f_{b,1}^e = A \\int_0^{\\ell_e} \\left( b_0+b_1 x_{start} + b_1 x' - \\frac{x'}{\\ell_e}(b_0+b_1 x_{start}) - \\frac{b_1 (x')^2}{\\ell_e} \\right) dx' \\\\ = A \\left[ (b_0+b_1 x_{start})x' + \\frac{b_1 (x')^2}{2} - \\frac{(x')^2}{2\\ell_e}(b_0+b_1 x_{start}) - \\frac{b_1 (x')^3}{3\\ell_e} \\right]_0^{\\ell_e} \\\\ = A\\ell_e \\left[ (b_0+b_1 x_{start}) + \\frac{b_1\\ell_e}{2} - \\frac{1}{2}(b_0+b_1 x_{start}) - \\frac{b_1\\ell_e}{3} \\right] \\\\ = A\\ell_e \\left[ \\frac{1}{2}(b_0+b_1 x_{start}) + \\frac{1}{6}b_1\\ell_e \\right] $$\n计算第二个分量的积分：\n$$ f_{b,2}^e = A \\int_0^{\\ell_e} \\left( \\frac{x'}{\\ell_e}(b_0+b_1 x_{start}) + \\frac{b_1 (x')^2}{\\ell_e} \\right) dx' \\\\ = A \\left[ \\frac{(x')^2}{2\\ell_e}(b_0+b_1 x_{start}) + \\frac{b_1 (x')^3}{3\\ell_e} \\right]_0^{\\ell_e} \\\\ = A\\ell_e \\left[ \\frac{1}{2}(b_0+b_1 x_{start}) + \\frac{1}{3}b_1\\ell_e \\right] $$\n\n**任务 2：组装全局系统**\n\n该杆有2个单元和3个节点。我们来计算每个单元的矩阵。两个单元的长度均为$\\ell_e = 1\\,\\mathrm{m}$。\n\n*单元 1 (节点 1-2):* $x \\in [0,1]$，所以$x_{start}^{(1)}=0$。$A_1 = 2.0 \\times 10^{-4}\\,\\mathrm{m}^2$。\n$$ \\frac{EA_1}{\\ell_1} = \\frac{(2.10 \\times 10^{11}\\,\\mathrm{Pa})(2.0 \\times 10^{-4}\\,\\mathrm{m}^2)}{1\\,\\mathrm{m}} = 4.2 \\times 10^7\\,\\mathrm{N/m} $$\n$$ \\mathbf{k}^{(1)} = 4.2 \\times 10^7 \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} $$\n对于载荷向量，其中$b_0=2\\times 10^7, b_1=1\\times 10^7$：\n$$ f_{b,1}^{(1)} = (2.0 \\times 10^{-4})(1) \\left[ \\frac{1}{2}(2\\times 10^7) + \\frac{1}{6}(1\\times 10^7)(1) \\right] = 2\\times 10^{-4} \\left[ \\frac{7}{6}\\times 10^7 \\right] = \\frac{7000}{3}\\,\\mathrm{N} $$\n$$ f_{b,2}^{(1)} = (2.0 \\times 10^{-4})(1) \\left[ \\frac{1}{2}(2\\times 10^7) + \\frac{1}{3}(1\\times 10^7)(1) \\right] = 2\\times 10^{-4} \\left[ \\frac{4}{3}\\times 10^7 \\right] = \\frac{8000}{3}\\,\\mathrm{N} $$\n\n*单元 2 (节点 2-3):* $x \\in [1,2]$，所以$x_{start}^{(2)}=1$。$A_2 = 1.2 \\times 10^{-4}\\,\\mathrm{m}^2$。\n$$ \\frac{EA_2}{\\ell_2} = \\frac{(2.10 \\times 10^{11}\\,\\mathrm{Pa})(1.2 \\times 10^{-4}\\,\\mathrm{m}^2)}{1\\,\\mathrm{m}} = 2.52 \\times 10^7\\,\\mathrm{N/m} $$\n$$ \\mathbf{k}^{(2)} = 2.52 \\times 10^7 \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} $$\n对于载荷向量：\n$$ f_{b,1}^{(2)} = (1.2 \\times 10^{-4})(1) \\left[ \\frac{1}{2}(2\\times 10^7 + 1\\times 10^7(1)) + \\frac{1}{6}(1\\times 10^7)(1) \\right] \\\\ = 1.2 \\times 10^{-4} \\left[ \\frac{3}{2}\\times 10^7 + \\frac{1}{6}\\times 10^7 \\right] = 1.2 \\times 10^{-4} \\left[ \\frac{10}{6}\\times 10^7 \\right] = 2000\\,\\mathrm{N} $$\n$$ f_{b,2}^{(2)} = (1.2 \\times 10^{-4})(1) \\left[ \\frac{1}{2}(2\\times 10^7 + 1\\times 10^7(1)) + \\frac{1}{3}(1\\times 10^7)(1) \\right] \\\\ = 1.2 \\times 10^{-4} \\left[ \\frac{3}{2}\\times 10^7 + \\frac{1}{3}\\times 10^7 \\right] = 1.2 \\times 10^{-4} \\left[ \\frac{11}{6}\\times 10^7 \\right] = 2200\\,\\mathrm{N} $$\n全局刚度矩阵$\\mathbf{K}$组装如下：\n$$ \\mathbf{K} = \\begin{pmatrix} k_{11}^{(1)}  k_{12}^{(1)}  0 \\\\ k_{21}^{(1)}  k_{22}^{(1)} + k_{11}^{(2)}  k_{12}^{(2)} \\\\ 0  k_{21}^{(2)}  k_{22}^{(2)} \\end{pmatrix} = 10^7 \\begin{pmatrix} 4.2  -4.2  0 \\\\ -4.2  4.2 + 2.52  -2.52 \\\\ 0  -2.52  2.52 \\end{pmatrix} \\\\ = 10^7 \\begin{pmatrix} 4.2  -4.2  0 \\\\ -4.2  6.72  -2.52 \\\\ 0  -2.52  2.52 \\end{pmatrix} $$\n全局载荷向量$\\mathbf{F}$是组装后的体力向量$\\mathbf{F}_b$和点载荷向量$\\mathbf{F}_p$的和。\n$$ \\mathbf{F}_b = \\begin{pmatrix} f_{b,1}^{(1)} \\\\ f_{b,2}^{(1)} + f_{b,1}^{(2)} \\\\ f_{b,2}^{(2)} \\end{pmatrix} = \\begin{pmatrix} 7000/3 \\\\ 8000/3 + 2000 \\\\ 2200 \\end{pmatrix} = \\begin{pmatrix} 7000/3 \\\\ 14000/3 \\\\ 2200 \\end{pmatrix}\\,\\mathrm{N} $$\n$$ \\mathbf{F}_p = \\begin{pmatrix} 0 \\\\ 0 \\\\ \\bar{T} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 15000 \\end{pmatrix}\\,\\mathrm{N} $$\n$$ \\mathbf{F} = \\mathbf{F}_b + \\mathbf{F}_p = \\begin{pmatrix} 7000/3 \\\\ 14000/3 \\\\ 2200 + 15000 \\end{pmatrix} = \\begin{pmatrix} 7000/3 \\\\ 14000/3 \\\\ 17200 \\end{pmatrix}\\,\\mathrm{N} $$\n\n**任务 3：求解节点位移**\n\n全局方程组为$\\mathbf{K}\\mathbf{U} = \\mathbf{F}$。本质边界条件是$u_1 = 0$。我们对系统进行分区，以求解未知位移$u_2$和$u_3$。\n$$ 10^7 \\begin{pmatrix} 6.72  -2.52 \\\\ -2.52  2.52 \\end{pmatrix} \\begin{pmatrix} u_2 \\\\ u_3 \\end{pmatrix} = \\begin{pmatrix} 14000/3 \\\\ 17200 \\end{pmatrix} $$\n将两个方程相加，得到一个关于$u_2$的简单方程：\n$$ 10^7 (6.72 - 2.52) u_2 = \\frac{14000}{3} + 17200 \\\\ 4.2 \\times 10^7 u_2 = \\frac{14000 + 51600}{3} = \\frac{65600}{3} \\\\ u_2 = \\frac{65600}{3 \\times 4.2 \\times 10^7} = \\frac{65600}{12.6 \\times 10^7} \\approx 5.206349 \\times 10^{-4}\\,\\mathrm{m} $$\n从简化系统的第二个方程，我们求得$u_3$：\n$$ 10^7 (-2.52 u_2 + 2.52 u_3) = 17200 \\implies u_3 - u_2 = \\frac{17200}{2.52 \\times 10^7} \\approx 6.825397 \\times 10^{-4}\\,\\mathrm{m} \\\\ u_3 = u_2 + 6.825397 \\times 10^{-4} \\approx 5.206349 \\times 10^{-4} + 6.825397 \\times 10^{-4} \\approx 1.203175 \\times 10^{-3}\\,\\mathrm{m} $$\n位移向量为$\\mathbf{U} \\approx \\begin{pmatrix} 0  5.206 \\times 10^{-4}  1.203 \\times 10^{-3} \\end{pmatrix}^T\\,\\mathrm{m}$。\n\n**任务 4：计算反力并验证平衡**\n\n固定节点1处的反力$R_1$可从全局方程组$\\mathbf{R} = \\mathbf{K}\\mathbf{U} - \\mathbf{F}$的第一行求得。\n$$ R_1 = K_{11}u_1 + K_{12}u_2 + K_{13}u_3 - F_1 $$\n在$u_1=0$和$K_{13}=0$的条件下：\n$$ R_1 = K_{12}u_2 - F_1 = (-4.2 \\times 10^7)u_2 - \\frac{7000}{3} $$\n代入$u_2$的表达式：\n$$ R_1 = (-4.2 \\times 10^7) \\left( \\frac{65600}{3 \\times 4.2 \\times 10^7} \\right) - \\frac{7000}{3} = -\\frac{65600}{3} - \\frac{7000}{3} = -\\frac{72600}{3} = -24200\\,\\mathrm{N} $$\n负号表示该力作用在$-x$方向。\n\n为验证全局平衡，我们将作用在杆上的所有外力相加。由分布体力产生的总力为：\n$$ F_{body} = \\int_0^L A(x)b(x)\\,dx = \\int_0^1 A_1(b_0+b_1x)\\,dx + \\int_1^2 A_2(b_0+b_1x)\\,dx $$\n$$ \\int_0^1 (2\\times 10^{-4})(2\\times 10^7+1\\times 10^7 x)\\,dx = (2\\times 10^{-4})[2\\times 10^7 x + 0.5\\times 10^7 x^2]_0^1 = 5000\\,\\mathrm{N} $$\n$$ \\int_1^2 (1.2\\times 10^{-4})(2\\times 10^7+1\\times 10^7 x)\\,dx = (1.2\\times 10^{-4})[2\\times 10^7 x + 0.5\\times 10^7 x^2]_1^2 = 4200\\,\\mathrm{N} $$\n总体力$F_{body} = 5000 + 4200 = 9200\\,\\mathrm{N}$。\n所有外力的总和为：\n$$ \\sum F_{ext} = R_1 + F_{body} + \\bar{T} = -24200\\,\\mathrm{N} + 9200\\,\\mathrm{N} + 15000\\,\\mathrm{N} = 0 $$\n全局平衡得到满足，这验证了计算的正确性。\n\n在$x=0$处的反力为$-24200\\,\\mathrm{N}$。以千牛为单位，即$-24.2\\,\\mathrm{kN}$。四舍五入到四位有效数字，其值为$-24.20\\,\\mathrm{kN}$。", "answer": "$$\\boxed{-24.20}$$", "id": "2538126"}, {"introduction": "最后一个练习将从手动计算过渡到计算机编程实现。我们将探讨如何将抽象的组装过程转化为代码，并比较标准的串行“散布相加”方法与一种基于图着色的无冲突、并行友好的方法 [@problem_id:2562921]。这个练习有助于深入理解支撑高性能有限元软件的数据结构和算法。", "problem": "您的任务是使用有限元法（FEM）为一维轴向杆实现刚度矩阵和考虑一致分布荷载的全局力向量的全局组装。此问题必须从控制微分方程的弱形式出发，依据第一原理进行求解。您必须实现两种组装策略，并在一套测试中验证它们的数值等价性：（i）标准的串行散加组装；（ii）一种通过图着色和归约实现的并行友好、无冲突的组装。\n\n控制物理和数学基础：\n- 考虑一个占据区间 $x \\in [0,L]$ 的等截面杆，在小轴向变形下，其轴向位移场为 $u(x)$。本构律为线性弹性，杨氏模量为 $E$，横截面积为 $A$。分布轴向荷载为 $q(x)$，可在单元上表示为分段线性函数。\n- 在一维情况下，平衡的强形式为 $-\\dfrac{d}{dx}\\left(E A \\dfrac{du}{dx}\\right) = q(x)$ on $x \\in (0,L)$，其中符号约定与正拉伸荷载一致。\n- 弱形式（虚功原理）为：找到 $u \\in \\mathcal{U}$，使得对于所有虚位移 $v \\in \\mathcal{V}$，\n$$\n\\int_0^L E A \\dfrac{du}{dx} \\dfrac{dv}{dx} \\, dx \\;=\\; \\int_0^L q(x) v(x) \\, dx \\;+\\; \\left. t(x) v(x) \\right|_{\\partial \\Omega_N},\n$$\n其中 $t(x)$ 表示在 Neumann 边界 $\\partial \\Omega_N$ 上给定的边界力，而 Dirichlet 边界条件则通过在 $\\partial \\Omega_D$ 上指定 $u$ 来施加。\n\n离散化要求：\n- 在每个跨越 $[x_i, x_j]$ 的单元 $e$ 上使用线性形函数，其局部节点值为 $u_i$ 和 $u_j$，单元长度为 $L_e = x_j - x_i$。对于 $\\xi \\in [0,1]$，使用 $N_1(\\xi) = 1 - \\xi$ 和 $N_2(\\xi) = \\xi$，从弱形式推导出的单元刚度矩阵必须为\n$$\n\\mathbf{K}^{(e)} = \\dfrac{E A}{L_e} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}.\n$$\n- 对于单元上线性变化的分布荷载，其在 $x_i$ 和 $x_j$ 的节点值分别为 $q_i$ 和 $q_j$，其一致节点荷载向量必须通过对荷载的虚功进行积分得到，\n$$\n\\mathbf{f}^{(e)} = \\int_{x_i}^{x_j} \\begin{bmatrix} N_1(x) \\\\ N_2(x) \\end{bmatrix} q(x) \\, dx \\;=\\; \\dfrac{L_e}{6} \\begin{bmatrix} 2 q_i + q_j \\\\ q_i + 2 q_j \\end{bmatrix}.\n$$\n- 节点集中荷载（如果有的话）直接组装到全局力向量中。给定位移（Dirichlet 条件）必须通过将全局系统划分为自由和固定自由度来施加，并求解简化后的线性系统。然后在受约束的自由度上恢复反作用力。\n\n待实现的组装策略：\n- 策略 S（串行）：遍历所有单元，计算 $\\mathbf{K}^{(e)}$ 和 $\\mathbf{f}^{(e)}$，并将它们散加到全局数组 $\\mathbf{K}$ 和 $\\mathbf{f}$ 中。\n- 策略 P（并行友好）：对单元邻接图进行图着色，使得相同颜色的单元不共享节点。对于一维链，两种颜色足矣：对于单元索引 $e$，颜色为 $c = (e \\bmod 2)$。对每种颜色独立地组装部分全局刚度和力，然后归约（求和）这些部分数组以获得 $\\mathbf{K}$ 和 $\\mathbf{f}$。这种方法在保持确定性和无竞争条件的同时，模拟了并行组装。\n\n求解与验证：\n- 对于策略 S 和 P，求解全局位移向量 $\\mathbf{u}$ 和在受约束自由度上的反作用力向量 $\\mathbf{r} = \\mathbf{K} \\mathbf{u} - \\mathbf{f}$。验证它们在数值容差范围内的等价性。\n- 使用国际单位制（SI）：长度单位为米，力为牛顿，杨氏模量为帕斯卡，面积为平方米，位移为米。尽管程序内部以米为单位计算位移，但您为测试套件报告的最终输出是表示策略之间等价性的布尔值；因此输出中不需要单位。\n\n需在程序内部实现的无输入测试套件：\n- 所有网格均匀，节点位于 $x_k = k \\, L / n_e$，其中 $k \\in \\{0,\\dots,n_e\\}$，$n_e$ 是单元数量。对于每个测试用例，请完全按照列出的参数进行实现。\n\n- 测试用例 A（正常路径）：$L = 3.0$，$E = 2.10 \\times 10^{11}$，$A = 1.0 \\times 10^{-4}$，$n_e = 6$，所有节点的分布荷载节点值 $q(x_k) = 1000.0$，Dirichlet 边界 $u(0) = 0.0$，无其他荷载。\n- 测试用例 B（线性变化荷载）：$L = 2.0$，$E = 7.0 \\times 10^{10}$，$A = 2.0 \\times 10^{-4}$，$n_e = 5$，所有节点的分布荷载节点值 $q(x_k) = 500.0 \\, x_k / L$，Dirichlet 边界 $u(0) = 0.0$，无其他荷载。\n- 测试用例 C（两端固定，均匀荷载）：$L = 1.0$，$E = 2.00 \\times 10^{11}$，$A = 1.0 \\times 10^{-4}$，$n_e = 1$，所有节点的分布荷载节点值 $q(x_k) = 100.0$，Dirichlet 边界 $u(0) = 0.0$ 和 $u(L) = 0.0$，无其他荷载。\n- 测试用例 D（仅有点荷载）：$L = 5.0$，$E = 1.00 \\times 10^{11}$，$A = 3.0 \\times 10^{-4}$，$n_e = 10$，所有节点的分布荷载节点值 $q(x_k) = 0.0$，在中间节点 $k = 5$ 处有 $1000.0$ 的节点集中荷载，Dirichlet 边界 $u(0) = 0.0$。\n- 测试用例 E（符号变化的分布荷载，两端固定）：$L = 1.0$，$E = 1.50 \\times 10^{11}$，$A = 5.0 \\times 10^{-4}$，$n_e = 2$，分布荷载节点值 $q(x_0) = 1000.0$，$q(x_1) = -500.0$，$q(x_2) = 1000.0$，Dirichlet 边界 $u(0) = 0.0$ 和 $u(L) = 0.0$，无其他荷载。\n\n您的程序必须做到：\n- 对于每个测试用例，使用策略 S 和策略 P 构建全局刚度矩阵和力向量；求解位移并恢复反作用力；然后检查两种策略得到的全局刚度矩阵、全局力向量、位移向量和反作用力向量是否在严格的数值容差内相等。\n- 您的程序应生成单行输出，其中包含一个以方括号括起来的逗号分隔列表的结果（例如，\"[resultA,resultB,resultC,resultD,resultE]\"），其中每个条目都是一个布尔值，表示策略 S 和 P 在该测试用例中是否产生了数值上等价的结果。\n\n重要实现说明：\n- 网格是一维的，每个节点只有一个自由度。\n- 一致分布荷载必须在单元级别上根据 $q(x)$ 的节点值精确计算。\n- 通过将系统划分为自由集和固定集来应用 Dirichlet 约束；求解简化系统；并在受约束的自由度上计算反作用力 $\\mathbf{r} = \\mathbf{K}\\mathbf{u} - \\mathbf{f}$。\n- 在比较策略之间的数组时，使用不宽于 $10^{-9}$ 的相对容差和不宽于 $10^{-9}$ 的绝对容差。\n\n最终输出格式必须为单行：\n- 一个带有布尔值的列表字面量，每个测试用例一个，按上述固定的 A, B, C, D, E 顺序排列，无任何附加文本。", "solution": "所提出的问题是在一维轴向杆的有限元分析中，实现并验证两种不同的全局刚度矩阵和全局力向量的组装策略。验证要求证明标准串行组装与基于图着色的并行友好组装之间的数值等价性。该问题定义明确，科学上合理，并提供了一套清晰的测试用例以供验证。\n\n我们从虚功原理出发，它提供了控制平衡方程的弱形式。对于一个轴向位移为 $u(x)$、杨氏模量为 $E$、横截面积为 $A$、并受到分布轴向荷载 $q(x)$ 的一维杆，其弱形式表述为：找到一个位移场 $u$，它来自于一个可容许空间 $\\mathcal{U}$，使得对于所有来自于合适变分空间 $\\mathcal{V}$ 的虚位移 $v$，以下积分方程成立：\n$$\n\\int_0^L E A \\frac{du}{dx} \\frac{dv}{dx} \\, dx = \\int_0^L q(x) v(x) \\, dx + \\left[ t(x) v(x) \\right]_{\\partial \\Omega_N}\n$$\n这里，左手边代表内部虚功，右手边代表由分布荷载 $q(x)$ 和 Neumann 边界 $\\partial \\Omega_N$ 上的边界力 $t(x)$ 所做的外部虚功。\n\n在有限元法中，我们将域 $[0, L]$ 离散化为一系列单元。在每个单元 $e$ 内，位移场 $u^{(e)}(x)$ 由节点位移 $\\mathbf{u}^{(e)}$ 和形函数 $\\mathbf{N}^{(e)}(x)$ 的线性组合来近似：\n$$\nu^{(e)}(x) = \\mathbf{N}^{(e)}(x) \\mathbf{u}^{(e)} = \\sum_{i=1}^{2} N_i^{(e)}(x) u_i^{(e)}\n$$\n对于一个跨越 $[x_i, x_j]$ 且长度为 $L_e = x_j - x_i$ 的双节点线性单元，我们使用局部坐标 $\\xi = (x - x_i) / L_e \\in [0, 1]$。线性形函数为 $N_1(\\xi) = 1 - \\xi$ 和 $N_2(\\xi) = \\xi$。位移梯度则为：\n$$\n\\frac{du^{(e)}}{dx} = \\frac{d\\mathbf{N}^{(e)}}{dx} \\mathbf{u}^{(e)} = \\mathbf{B}^{(e)} \\mathbf{u}^{(e)}\n$$\n其中 $\\mathbf{B}^{(e)} = [-\\frac{1}{L_e}, \\frac{1}{L_e}]$ 是应变-位移矩阵。\n\n将有限元近似代入弱形式并考虑单个单元，我们得到单元刚度矩阵 $\\mathbf{K}^{(e)}$ 和单元一致力向量 $\\mathbf{f}^{(e)}$。刚度矩阵由内部虚功项推导而来：\n$$\n\\mathbf{K}^{(e)} = \\int_0^{L_e} E A (\\mathbf{B}^{(e)})^T \\mathbf{B}^{(e)} \\, dx = E A L_e \\left(\\frac{1}{L_e}\\right)^2 \\begin{bmatrix} -1 \\\\ 1 \\end{bmatrix} \\begin{bmatrix} -1  1 \\end{bmatrix} = \\frac{E A}{L_e} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}\n$$\n一致力向量来自于分布荷载 $q(x)$ 的虚功。如果 $q(x)$ 本身也使用具有节点值 $q_i$ 和 $q_j$ 的相同线性形函数来近似，即 $q(x) = q_i N_1(x) + q_j N_2(x)$，则积分为：\n$$\n\\mathbf{f}^{(e)} = \\int_{x_i}^{x_j} (\\mathbf{N}(x))^T q(x) \\, dx = \\int_0^1 (\\mathbf{N}(\\xi))^T (q_i N_1(\\xi) + q_j N_2(\\xi)) L_e \\, d\\xi\n$$\n计算此积分可得到指定的一致荷载向量：\n$$\n\\mathbf{f}^{(e)} = \\frac{L_e}{6} \\begin{bmatrix} 2 q_i + q_j \\\\ q_i + 2 q_j \\end{bmatrix}\n$$\n全局方程组 $\\mathbf{K} \\mathbf{u} = \\mathbf{f}$ 是通过组装这些单元级的贡献而形成的。\n\n**组装策略 S（串行）**：这是传统方法。遍历每个单元 $e = 0, \\dots, n_e-1$。对每个单元，计算 $\\mathbf{K}^{(e)}$ 和 $\\mathbf{f}^{(e)}$。使用将局部节点号（1, 2）映射到全局节点号（$i, j$）的单元连接性数组，将单元矩阵的条目“散加”到全局矩阵中。对于一维链，单元 $e$ 连接全局节点 $e$ 和 $e+1$。\n\n**组装策略 P（并行友好）**：该策略旨在避免在多个单元并发处理的并行执行环境中出现竞争条件。如果两个单元共享一个节点，它们就无法在没有内存写入锁的情况下同时组装，这会引入开销。图着色提供了一种解决方案。单元邻接图（其中节点是单元，边连接共享节点的单元）被着色，使得没有两个相邻的单元具有相同的颜色。对于一维单元链，此图是一条简单路径，是二分图，因此仅需两种颜色。\n算法过程如下：\n1.  根据单元索引对其进行着色：颜色 $c = e \\pmod 2$。\n2.  将两个部分全局刚度矩阵和力向量 $\\mathbf{K}_0, \\mathbf{f}_0$ 和 $\\mathbf{K}_1, \\mathbf{f}_1$ 初始化为零。\n3.  将所有颜色为 0 的单元（索引 $0, 2, 4, \\dots$）组装到 $\\mathbf{K}_0$ 和 $\\mathbf{f}_0$ 中。由于没有两个偶数索引的单元共享节点，此步骤是“易于并行化”的。\n4.  类似地，将所有颜色为 1 的单元（索引 $1, 3, 5, \\dots$）组装到 $\\mathbf{K}_1$ 和 $\\mathbf{f}_1$ 中。此步骤也是可并行化的。\n5.  最终的全局系统通过归约（求和）步骤得到：$\\mathbf{K} = \\mathbf{K}_0 + \\mathbf{K}_1$ 和 $\\mathbf{f} = \\mathbf{f}_0 + \\mathbf{f}_1$。\n在数学上，两种策略执行相同的加法，只是顺序不同。它们必须在浮点精度范围内产生相同的结果。\n\n为了求解该系统，我们通过划分系统来应用 Dirichlet 边界条件。将全局自由度（DOFs）划分为自由自由度集合 $\\mathbf{u}_f$ 和给定自由度集合 $\\mathbf{u}_p$。全局系统被重新排序为：\n$$\n\\begin{bmatrix} \\mathbf{K}_{ff}  \\mathbf{K}_{fp} \\\\ \\mathbf{K}_{pf}  \\mathbf{K}_{pp} \\end{bmatrix}\n\\begin{Bmatrix} \\mathbf{u}_f \\\\ \\mathbf{u}_p \\end{Bmatrix}\n=\n\\begin{Bmatrix} \\mathbf{f}_f \\\\ \\mathbf{f}_p \\end{Bmatrix}\n$$\n未知位移 $\\mathbf{u}_f$ 通过求解从第一个块行导出的简化线性系统来找到：\n$$\n\\mathbf{K}_{ff} \\mathbf{u}_f = \\mathbf{f}_f - \\mathbf{K}_{fp} \\mathbf{u}_p\n$$\n在求解 $\\mathbf{u}_f$ 后，完整的位移向量 $\\mathbf{u}$ 就已知了。反作用力 $\\mathbf{r}$ 是在支座处为维持给定位移所需的净力。它们根据完整系统方程计算为残差：\n$$\n\\mathbf{r} = \\mathbf{K} \\mathbf{u} - \\mathbf{f}\n$$\n$\\mathbf{r}$ 的非零项对应于给定的自由度。\n\n该实现将为每个测试用例执行策略 S 和策略 P，然后使用严格的数值容差比较得到的全局矩阵 $\\mathbf{K}$、全局力向量 $\\mathbf{f}$、位移向量 $\\mathbf{u}$ 和反作用力向量 $\\mathbf{r}$。\n\n```python\nimport numpy as np\nimport scipy.linalg\n\ndef fem_solver(params, strategy):\n    \"\"\"\n    Solves a 1D axial bar problem using the Finite Element Method.\n\n    Args:\n        params (dict): A dictionary containing all problem parameters.\n        strategy (str): The assembly strategy to use, either 'S' (serial) or 'P' (parallel-friendly).\n\n    Returns:\n        tuple: A tuple containing the global stiffness matrix (K), global force vector (f),\n               global displacement vector (u), and global reaction vector (r).\n    \"\"\"\n    L = params['L']\n    E = params['E']\n    A = params['A']\n    ne = params['ne']\n    q_vals = params['q_vals']\n    point_loads = params.get('point_loads', {})\n    bcs = params.get('bcs', {})\n\n    num_nodes = ne + 1\n    num_dofs = num_nodes\n    \n    # 1. Mesh Generation\n    nodes = np.linspace(0, L, num_nodes)\n    Le = L / ne\n\n    # 2. Assembly\n    if strategy == 'S':\n        # Strategy S: Serial Scatter-Add\n        K = np.zeros((num_dofs, num_dofs))\n        f = np.zeros(num_dofs)\n        for e in range(ne):\n            # Element properties\n            Ke = (E * A / Le) * np.array([[1, -1], [-1, 1]])\n            \n            # Consistent load vector\n            q_i = q_vals[e]\n            q_j = q_vals[e + 1]\n            fe = (Le / 6) * np.array([2 * q_i + q_j, q_i + 2 * q_j])\n            \n            # Connectivity\n            dof_map = [e, e + 1]\n            \n            # Assembly\n            for i in range(2):\n                f[dof_map[i]] += fe[i]\n                for j in range(2):\n                    K[dof_map[i], dof_map[j]] += Ke[i, j]\n\n    elif strategy == 'P':\n        # Strategy P: Parallel-friendly Graph Coloring\n        K0 = np.zeros((num_dofs, num_dofs))\n        f0 = np.zeros(num_dofs)\n        K1 = np.zeros((num_dofs, num_dofs))\n        f1 = np.zeros(num_dofs)\n\n        # Color 0 elements (even indices)\n        for e in range(0, ne, 2):\n            Ke = (E * A / Le) * np.array([[1, -1], [-1, 1]])\n            q_i, q_j = q_vals[e], q_vals[e + 1]\n            fe = (Le / 6) * np.array([2 * q_i + q_j, q_i + 2 * q_j])\n            dof_map = [e, e + 1]\n            \n            for i in range(2):\n                f0[dof_map[i]] += fe[i]\n                for j in range(2):\n                    K0[dof_map[i], dof_map[j]] += Ke[i, j]\n        \n        # Color 1 elements (odd indices)\n        for e in range(1, ne, 2):\n            Ke = (E * A / Le) * np.array([[1, -1], [-1, 1]])\n            q_i, q_j = q_vals[e], q_vals[e + 1]\n            fe = (Le / 6) * np.array([2 * q_i + q_j, q_i + 2 * q_j])\n            dof_map = [e, e + 1]\n            \n            for i in range(2):\n                f1[dof_map[i]] += fe[i]\n                for j in range(2):\n                    K1[dof_map[i], dof_map[j]] += Ke[i, j]\n\n        # Reduction\n        K = K0 + K1\n        f = f0 + f1\n    else:\n        raise ValueError(\"Unknown strategy\")\n\n    # 3. Apply Point Loads\n    for dof, load_value in point_loads.items():\n        f[dof] += load_value\n\n    # 4. Apply Boundary Conditions via Partitioning\n    all_dofs = list(range(num_dofs))\n    prescribed_dofs = sorted(list(bcs.keys()))\n    free_dofs = sorted(list(set(all_dofs) - set(prescribed_dofs)))\n\n    u = np.zeros(num_dofs)\n    for dof, val in bcs.items():\n        u[dof] = val\n\n    K_ff = K[np.ix_(free_dofs, free_dofs)]\n    K_fp = K[np.ix_(free_dofs, prescribed_dofs)]\n    f_f = f[free_dofs]\n    u_p = u[prescribed_dofs]\n\n    # 5. Solve for free DOFs\n    if len(free_dofs) > 0:\n        rhs = f_f - K_fp @ u_p\n        u_f = scipy.linalg.solve(K_ff, rhs)\n        u[free_dofs] = u_f\n\n    # 6. Compute Reactions\n    r = K @ u - f\n\n    return K, f, u, r\n\ndef solve():\n    \"\"\"\n    Defines and runs the test suite, comparing the results of the two assembly strategies.\n    \"\"\"\n    \n    # Test case definitions\n    # Case A: Happy path\n    L_A, ne_A = 3.0, 6\n    nodes_A = np.linspace(0, L_A, ne_A + 1)\n    q_A = 1000.0 * np.ones_like(nodes_A)\n    \n    # Case B: Linearly varying load\n    L_B, ne_B = 2.0, 5\n    nodes_B = np.linspace(0, L_B, ne_B + 1)\n    q_B = 500.0 * nodes_B / L_B\n    \n    # Case C: Both ends fixed\n    L_C, ne_C = 1.0, 1\n    nodes_C = np.linspace(0, L_C, ne_C + 1)\n    q_C = 100.0 * np.ones_like(nodes_C)\n    \n    # Case D: Point load only\n    L_D, ne_D = 5.0, 10\n    nodes_D = np.linspace(0, L_D, ne_D + 1)\n    q_D = np.zeros_like(nodes_D)\n    \n    # Case E: Sign-changing load, both ends fixed\n    L_E, ne_E = 1.0, 2\n    q_E = np.array([1000.0, -500.0, 1000.0])\n\n    test_cases = [\n        # Case A\n        {'L': L_A, 'E': 2.10e11, 'A': 1.0e-4, 'ne': ne_A, 'q_vals': q_A, 'bcs': {0: 0.0}},\n        # Case B\n        {'L': L_B, 'E': 7.0e10, 'A': 2.0e-4, 'ne': ne_B, 'q_vals': q_B, 'bcs': {0: 0.0}},\n        # Case C\n        {'L': L_C, 'E': 2.00e11, 'A': 1.0e-4, 'ne': ne_C, 'q_vals': q_C, 'bcs': {0: 0.0, ne_C: 0.0}},\n        # Case D\n        {'L': L_D, 'E': 1.00e11, 'A': 3.0e-4, 'ne': ne_D, 'q_vals': q_D, 'bcs': {0: 0.0}, 'point_loads': {5: 1000.0}},\n        # Case E\n        {'L': L_E, 'E': 1.50e11, 'A': 5.0e-4, 'ne': ne_E, 'q_vals': q_E, 'bcs': {0: 0.0, ne_E: 0.0}},\n    ]\n\n    results = []\n    TOL = {'rtol': 1e-9, 'atol': 1e-9}\n\n    for params in test_cases:\n        K_S, f_S, u_S, r_S = fem_solver(params, 'S')\n        K_P, f_P, u_P, r_P = fem_solver(params, 'P')\n        \n        k_equiv = np.allclose(K_S, K_P, **TOL)\n        f_equiv = np.allclose(f_S, f_P, **TOL)\n        u_equiv = np.allclose(u_S, u_P, **TOL)\n        r_equiv = np.allclose(r_S, r_P, **TOL)\n        \n        # All comparisons must be true for the test to pass.\n        results.append(k_equiv and f_equiv and u_equiv and r_equiv)\n\n    # Format the output as specified. Boolean values will be converted to lowercase 'true'/'false'.\n    print(f\"[{','.join(map(str, results))}]\".lower())\n\nsolve()\n```", "answer": "[true,true,true,true,true]", "id": "2562921"}]}