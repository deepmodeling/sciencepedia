{"hands_on_practices": [{"introduction": "在有限元方法中，核心思想是将复杂问题分解为在简单几何单元（如下面练习中的三角形）上的可管理子问题。此练习将指导您完成一个基本但至关重要的任务：为单个单元推导和计算刚度矩阵 [@problem_id:2589003]。通过这个过程，您将把抽象的弱形式方程转化为具体的数值矩阵，这是连接有限元理论与实际计算的桥梁。", "problem": "考虑在有界多边形域 $\\Omega \\subset \\mathbb{R}^{2}$ 上的具有齐次狄利克雷（Dirichlet）边界条件的标量泊松（Poisson）模型问题：求 $u \\in H_{0}^{1}(\\Omega)$ 使得\n$$\n\\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, dx \\;=\\; \\int_{\\Omega} f v \\, dx \\quad \\text{对所有 } v \\in H_{0}^{1}(\\Omega).\n$$\n设 $\\mathcal{T}_{h}$ 是 $\\Omega$ 的一个协调单纯三角剖分，其单元为非退化三角形 $K$。设 $V_{h} \\subset H_{0}^{1}(\\Omega)$ 是标准连续分片仿射（即多项式次数为1）有限元空间，其基函数为通常的节点（拉格朗日，Lagrange）基 $\\{\\phi_{a}\\}$。对于每个具有局部节点基 $\\{\\phi_{1},\\phi_{2},\\phi_{3}\\}$ 的单元 $K \\in \\mathcal{T}_{h}$，单元（局部）刚度矩阵的元素为\n$$\na_{ij}^{K} \\;=\\; \\int_{K} \\nabla \\phi_{i} \\cdot \\nabla \\phi_{j} \\, dx, \\quad i,j \\in \\{1,2,3\\}.\n$$\n你的任务是：\n\n1) 仅从弱形式和连续分片仿射有限元空间的定义出发，推导局部刚度矩阵元素 $a_{ij}^{K}$ 的表达式，并解释为什么它们仅取决于 $K$ 上的 $\\nabla \\phi_{i}$ 和 $\\nabla \\phi_{j}$。\n\n2) 引入从参考三角形 $\\hat{K} = \\operatorname{conv}\\{(0,0),(1,0),(0,1)\\}$ 到单元 $K$ 的仿射映射 $F_{K}: \\hat{K} \\to K$，该映射由 $x = F_{K}(\\hat{x}) = B_{K} \\hat{x} + x_{1}$ 给出，其中 $x_{1}$ 是 $K$ 的一个顶点，$B_{K}$ 是一个 $2 \\times 2$ 的雅可比（Jacobian）矩阵，其列向量由从 $x_{1}$ 出发的 $K$ 的边向量给出。使用链式法则和积分的换元公式，推导 $a_{ij}^{K}$ 关于 $\\nabla_{\\hat{x}} \\hat{\\phi}_{i}$、$B_{K}^{-1}$、$B_{K}^{-T}$ 和 $|\\det B_{K}|$ 的参考单元表达式，其中 $\\hat{\\phi}_{i}$ 是参考单元基函数。\n\n3) 对于顶点为\n$$\nx_{1} = (0,0), \\quad x_{2} = (2,0), \\quad x_{3} = (0,1)\n$$\n的特定单元 $K$，精确计算单个元素 $a_{12}^{K}$。以精确数值（不进行四舍五入）报告你的最终答案。不需要单位。", "solution": "该问题陈述被认为是有效的，因为它代表了有限元方法中的一个标准理论练习。它在数学上是适定的，有科学依据且内部一致。我们开始进行解答。\n\n问题分为三个部分。我们将按顺序进行解答。\n\n1) 首先，我们的任务是推导局部刚度矩阵元素 $a_{ij}^{K}$ 的表达式，并解释被积函数的结构。有限元空间 $V_{h}$ 被定义为连续分片仿射函数的空间。这意味着对于任何函数 $u_h \\in V_{h}$，其在特定三角形单元 $K \\in \\mathcal{T}_{h}$ 上的限制是空间坐标 $x = (x_1, x_2)$ 的一个仿射函数。也就是说，对于 $x \\in K$，\n$$\nu_h|_K(x) = c_1 x_1 + c_2 x_2 + c_3\n$$\n其中 $c_1, c_2, c_3$ 是一些常数，它们取决于单元 $K$ 和函数 $u_h$。\n\n空间 $V_{h}$ 的节点基函数 $\\{\\phi_{i}\\}$ 本身也是 $V_{h}$ 的成员。因此，对于每个基函数 $\\phi_i$，其在单元 $K$ 上的限制 $\\phi_i|_K$ 是一个仿射函数。这样一个函数的梯度是\n$$\n\\nabla \\phi_i|_K = \\nabla (c_{i,1} x_1 + c_{i,2} x_2 + c_{i,3}) = \\begin{pmatrix} c_{i,1} \\\\ c_{i,2} \\end{pmatrix}.\n$$\n这个梯度在整个单元 $K$ 上是一个常向量。\n\n局部刚度矩阵元素 $a_{ij}^{K}$ 定义为\n$$\na_{ij}^{K} = \\int_{K} \\nabla \\phi_{i} \\cdot \\nabla \\phi_{j} \\, dx.\n$$\n被积函数是两个基函数梯度 $\\nabla \\phi_{i}$ 和 $\\nabla \\phi_{j}$ 的点积。由于 $\\nabla \\phi_i$ 和 $\\nabla \\phi_j$ 在单元 $K$ 上都是常向量，它们的点积 $\\nabla \\phi_i|_K \\cdot \\nabla \\phi_j|_K$ 在 $K$ 上是一个常标量值。因为被积函数是常数，积分就变成了这个常数值与积分区域的测度（面积）的乘积：\n$$\na_{ij}^{K} = (\\nabla \\phi_i|_K \\cdot \\nabla \\phi_j|_K) \\int_{K} 1 \\, dx = (\\nabla \\phi_i|_K \\cdot \\nabla \\phi_j|_K) \\, |K|,\n$$\n其中 $|K|$ 表示三角形 $K$ 的面积。这个表达式表明 $a_{ij}^{K}$ 的值仅取决于基函数 $\\phi_i$ 和 $\\phi_j$ 在单元 $K$ 上的（常数）梯度以及该单元的面积。\n\n2) 其次，我们推导在参考单元 $\\hat{K}$ 上的 $a_{ij}^{K}$ 的表达式。仿射映射由 $x = F_{K}(\\hat{x}) = B_{K} \\hat{x} + x_{1}$ 给出，它将参考三角形 $\\hat{K}$ 映射到物理单元 $K$。物理单元和参考单元上的基函数通过 $\\phi_i(x) = \\hat{\\phi}_i(\\hat{x})$ 相关联，其中 $x=F_K(\\hat{x})$。这意味着 $\\phi_i(x) = \\hat{\\phi}_i(F_K^{-1}(x))$。\n\n为了变换梯度，我们使用链式法则。设 $\\hat{x} = F_K^{-1}(x)$。$\\phi_i$ 关于物理坐标 $x$ 的梯度是\n$$\n\\nabla_x \\phi_i(x) = (\\nabla_x \\hat{x})^T \\nabla_{\\hat{x}} \\hat{\\phi}_i(\\hat{x}).\n$$\n项 $\\nabla_x \\hat{x}$ 是逆映射的雅可比矩阵 $J_{F_K^{-1}}$。一个已知的结果是，逆映射的雅可比矩阵是正向映射雅可比矩阵的逆矩阵：$J_{F_K^{-1}} = (J_{F_K})^{-1}$。正向映射 $F_K(\\hat{x}) = B_K \\hat{x} + x_1$ 的雅可比矩阵就是矩阵 $B_K$。因此，$J_{F_K^{-1}} = B_K^{-1}$。\n\n将此代入链式法则表达式，我们得到梯度向量的变换：\n$$\n\\nabla_x \\phi_i = (B_K^{-1})^T \\nabla_{\\hat{x}} \\hat{\\phi}_i = B_K^{-T} \\nabla_{\\hat{x}} \\hat{\\phi}_i.\n$$\n现在，我们可以用参考坐标来表示被积函数中的点积：\n$$\n\\nabla_x \\phi_{i} \\cdot \\nabla_x \\phi_{j} = (B_{K}^{-T} \\nabla_{\\hat{x}} \\hat{\\phi}_{i}) \\cdot (B_{K}^{-T} \\nabla_{\\hat{x}} \\hat{\\phi}_{j}).\n$$\n使用恒等式 $A\\vec{u} \\cdot A\\vec{v} = (A\\vec{u})^T (A\\vec{v}) = \\vec{u}^T A^T A \\vec{v}$，这变成：\n$$\n\\nabla_x \\phi_{i} \\cdot \\nabla_x \\phi_{j} = (\\nabla_{\\hat{x}} \\hat{\\phi}_{i})^T (B_K^{-T})^T B_K^{-T} (\\nabla_{\\hat{x}} \\hat{\\phi}_{j}) = (\\nabla_{\\hat{x}} \\hat{\\phi}_{i})^T B_K^{-1} B_K^{-T} (\\nabla_{\\hat{x}} \\hat{\\phi}_{j}).\n$$\n最后，我们将换元公式应用于积分本身：\n$$\ndx = |\\det(J_{F_K})| \\, d\\hat{x} = |\\det(B_K)| \\, d\\hat{x}.\n$$\n将被变换的被积函数和微分元代入 $a_{ij}^{K}$ 的定义中，我们得到参考单元的表达式：\n$$\na_{ij}^{K} = \\int_{\\hat{K}} \\left[ (\\nabla_{\\hat{x}} \\hat{\\phi}_{i})^T B_K^{-1} B_K^{-T} (\\nabla_{\\hat{x}} \\hat{\\phi}_{j}) \\right] |\\det(B_K)| \\, d\\hat{x}.\n$$\n这就是所要求的关于 $\\nabla_{\\hat{x}} \\hat{\\phi}_{i}$、$B_{K}^{-1}$、$B_{K}^{-T}$ 和 $|\\det B_{K}|$ 的表达式。\n\n3) 第三，我们计算顶点为 $x_{1} = (0,0)$、$x_{2} = (2,0)$ 和 $x_{3} = (0,1)$ 的单元 $K$ 的特定元素 $a_{12}^{K}$。我们利用第一部分中建立的在物理单元上的直接方法。\n$$\na_{12}^{K} = (\\nabla \\phi_1|_K \\cdot \\nabla \\phi_2|_K) \\, |K|.\n$$\n单元 $K$ 是一个顶点在 $(0,0)$、$(2,0)$ 和 $(0,1)$ 的直角三角形。其面积为 $|K| = \\frac{1}{2} \\times \\text{底} \\times \\text{高} = \\frac{1}{2} \\times 2 \\times 1 = 1$。\n\n接下来，我们在 $K$ 上求基函数 $\\phi_1$ 和 $\\phi_2$ 的梯度。基函数 $\\phi_i|_K(x,y) = ax+by+c$ 由性质 $\\phi_i(x_j) = \\delta_{ij}$ 定义。\n\n求 $\\phi_1(x,y)$：\n它必须满足 $\\phi_1(x_1) = 1$, $\\phi_1(x_2) = 0$, $\\phi_1(x_3) = 0$。\n1. $\\phi_1(0,0) = a(0) + b(0) + c = 1 \\implies c = 1$。\n2. $\\phi_1(2,0) = a(2) + b(0) + c = 0 \\implies 2a + 1 = 0 \\implies a = -1/2$。\n3. $\\phi_1(0,1) = a(0) + b(1) + c = 0 \\implies b + 1 = 0 \\implies b = -1$。\n因此，$\\phi_1(x,y) = -\\frac{1}{2}x - y + 1$。其梯度在 $K$ 上是常数：$\\nabla \\phi_1 = (-\\frac{1}{2}, -1)$。\n\n求 $\\phi_2(x,y)$：\n它必须满足 $\\phi_2(x_1) = 0$, $\\phi_2(x_2) = 1$, $\\phi_2(x_3) = 0$。\n1. $\\phi_2(0,0) = a(0) + b(0) + c = 0 \\implies c = 0$。\n2. $\\phi_2(2,0) = a(2) + b(0) + c = 1 \\implies 2a = 1 \\implies a = 1/2$。\n3. $\\phi_2(0,1) = a(0) + b(1) + c = 0 \\implies b = 0$。\n因此，$\\phi_2(x,y) = \\frac{1}{2}x$。其梯度在 $K$ 上是常数：$\\nabla \\phi_2 = (\\frac{1}{2}, 0)$。\n\n现在，我们计算梯度的点积：\n$$\n\\nabla \\phi_1 \\cdot \\nabla \\phi_2 = \\begin{pmatrix} -1/2 \\\\ -1 \\end{pmatrix} \\cdot \\begin{pmatrix} 1/2 \\\\ 0 \\end{pmatrix} = \\left(-\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right) + (-1)(0) = -\\frac{1}{4}.\n$$\n最后，我们计算 $a_{12}^{K}$：\n$$\na_{12}^{K} = \\left(-\\frac{1}{4}\\right) \\times |K| = \\left(-\\frac{1}{4}\\right) \\times 1 = -\\frac{1}{4}.\n$$\n该元素的精确值为 $-\\frac{1}{4}$。", "answer": "$$\n\\boxed{-\\frac{1}{4}}\n$$", "id": "2589003"}, {"introduction": "一个成功的有限元分析不仅需要正确的数学公式，还需要高质量的网格。这个练习探讨了网格几何形状与数值解的物理合理性之间一个微妙但重要的联系。您将通过一个精心设计的思想实验，研究非钝角条件（或Delaunay条件）为何如此重要，并看到违反此条件如何导致违反离散极值原理的非物理结果 [@problem_id:2588983]。", "problem": "考虑在多边形域 $\\Omega \\subset \\mathbb{R}^{2}$ 上的拉普拉斯方程 $-\\Delta u = 0$，其在边界 $\\partial \\Omega$ 上满足狄利克雷边界条件 $u = g$。设 $\\mathcal{T}_{h}$ 是 $\\Omega$ 的一个协调三角剖分，并设 $V_{h}$ 是关于 $\\mathcal{T}_{h}$ 的连续分片仿射函数空间。假设该三角剖分包含一条连接两个内部顶点 $p$ 和 $q$ 的内部边，且该边恰好被两个三角形 $T_{\\alpha}$ 和 $T_{\\beta}$ 共享。设这两个三角形中与边 $\\overline{pq}$ 相对的角分别为 $\\alpha$ 和 $\\beta$。进一步假设 $\\alpha + \\beta  \\pi$（一种内部的、非Delaunay构型）。\n\n设 $\\mathcal{N}_{p}$ 表示通过一条边与 $p$ 直接相连的边界顶点集合，设 $\\mathcal{N}_{q}$ 表示通过一条边与 $q$ 直接相连的边界顶点集合。施加狄利克雷数据，使得在 $\\mathcal{N}_{p}$ 中的所有顶点处 $g=1$，在 $\\mathcal{N}_{q}$ 中的所有顶点处 $g=0$，而在 $\\partial \\Omega$ 的其他地方 $g$ 是任意的（这些其他的边界值不会直接耦合到 $p$ 和 $q$ 处的方程中，因为它们不通过边与 $p$ 或 $q$ 邻接）。\n\n仅从弱形式和分片仿射基函数的定义出发，推导由节点值 $u_{p}$ 和 $u_{q}$ 满足的，用余切权重表示的 $2 \\times 2$ 线性系统。引入记号\n$$\nw := \\frac{1}{2}\\big(\\cot \\alpha + \\cot \\beta\\big), \\quad\nA := \\sum_{b \\in \\mathcal{N}_{p}} w_{pb}, \\quad\nB := \\sum_{b \\in \\mathcal{N}_{q}} w_{qb},\n$$\n其中对于 $\\Omega$ 内部的任意边 $\\overline{ij}$，其在两个关联三角形中的对角分别为 $\\theta_{1}$ 和 $\\theta_{2}$，则边权重为 $w_{ij} := \\frac{1}{2}\\big(\\cot \\theta_{1} + \\cot \\theta_{2}\\big)$；对于边界边 $\\overline{ib}$，其在唯一关联三角形中的内角为 $\\theta$，则 $w_{ib} := \\frac{1}{2}\\cot \\theta$。\n\n符号求解所得的 $2 \\times 2$ 系统，并提供用 $A$、$B$ 和 $w$ 表示的 $u_{p}$ 的精确表达式。您必须以单个闭式解析表达式的形式给出最终答案。然后，使用您的表达式解释为什么条件 $\\alpha + \\beta  \\pi$（等价于 $w  0$）会导致 $u_{p}  1$，从而为离散极值原理 (DMP) 提供一个反例。最后，简要讨论两种基于网格优化的、可以防止此类违背情况的补救措施。最终答案必须是您推导出的 $u_p$ 的精确表达式。", "solution": "所述问题具有科学依据、是适定且客观的。这是分析椭圆型偏微分方程有限元方法 (FEM) 中的一个标准问题。所有必要信息均已提供且内部一致。因此，我们开始推导。\n\n该问题的强形式是带狄利克雷边界条件的拉普拉斯方程：\n$$\n\\begin{cases}\n    -\\Delta u = 0  \\text{in } \\Omega \\\\\n    u = g  \\text{on } \\partial\\Omega\n\\end{cases}\n$$\n相应的弱形式是寻找 $u \\in H^1(\\Omega)$，使得 $u|_{\\partial\\Omega} = g$，且对于所有测试函数 $v \\in H_0^1(\\Omega)$，下式成立：\n$$\n\\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x} = 0\n$$\n在有限元方法中，我们在有限维子空间 $V_h \\subset H^1(\\Omega)$ 中寻找近似解 $u_h$。空间 $V_h$ 被给定为在 $\\Omega$ 的一个协调三角剖分 $\\mathcal{T}_h$ 上的连续分片仿射函数空间。解 $u_h$ 可以写成节点基函数 $\\phi_i$ 的线性组合：\n$$\nu_h(\\mathbf{x}) = \\sum_{i \\in \\mathcal{I}} u_i \\phi_i(\\mathbf{x})\n$$\n其中 $\\mathcal{I}$ 是三角剖分中所有顶点的集合，$u_i$ 是解的节点值。基函数 $\\phi_i$ 是 $V_h$ 中的唯一函数，满足对于所有顶点 $p_j$，有 $\\phi_i(p_j) = \\delta_{ij}$。\n\n离散弱形式是寻找 $u_h \\in V_h$，使得对于所有边界顶点 $b$，有 $u_h(b) = g(b)$，并且对于所有内部顶点 $p_j$：\n$$\n\\int_{\\Omega} \\nabla u_h \\cdot \\nabla \\phi_j \\, d\\mathbf{x} = 0\n$$\n代入 $u_h$ 的展开式，我们得到一个关于内部顶点处未知节点值 $u_i$ 的线性系统。对于一个内部顶点 $p_j$，方程为：\n$$\n\\sum_{i \\in \\mathcal{I}} u_i \\int_{\\Omega} \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, d\\mathbf{x} = 0\n$$\n积分 $\\int_{\\Omega} \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, d\\mathbf{x}$ 构成了刚度矩阵 $K$ 的第 $(j, i)$ 个元素。只有当顶点 $p_i$ 和 $p_j$ 在三角剖分中通过一条边相连时，该积分才非零。著名的线性有限元余切公式指出，对于一条被两个三角形共享、其对角分别为 $\\theta_1$ 和 $\\theta_2$ 的边 $\\overline{p_i p_j}$，刚度矩阵中相应的非对角元素为：\n$$\nK_{ji} = \\int_{\\Omega} \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, d\\mathbf{x} = -\\frac{1}{2}(\\cot\\theta_1 + \\cot\\theta_2) = -w_{ij}\n$$\n对角元素由 $K_{jj} = \\sum_{i \\in \\mathcal{N}(j)} w_{ij}$ 给出，其中 $\\mathcal{N}(j)$ 是与 $p_j$ 邻接的顶点集合。因此，节点 $p_j$ 的方程可以写为：\n$$\nu_j \\left( \\sum_{i \\in \\mathcal{N}(j)} w_{ij} \\right) + \\sum_{i \\in \\mathcal{N}(j), i \\neq j} u_i (-w_{ij}) = 0\n$$\n这可以简化为紧凑形式：\n$$\n\\sum_{i \\in \\mathcal{N}(j)} w_{ij} (u_j - u_i) = 0\n$$\n我们现在将此公式应用于两个指定的内部顶点 $p$ 和 $q$。\n\n对于顶点 $p$，其邻点是顶点 $q$ 和边界顶点集 $\\mathcal{N}_p$。方程为：\n$$\nw_{pq}(u_p - u_q) + \\sum_{b \\in \\mathcal{N}_p} w_{pb}(u_p - u_b) = 0\n$$\n使用给定的定义和边界条件：\n- 内部边 $\\overline{pq}$ 的权重为 $w_{pq} = \\frac{1}{2}(\\cot \\alpha + \\cot \\beta) = w$。\n- 边界值为 $u_b = g(b) = 1$ 对所有 $b \\in \\mathcal{N}_p$ 成立。\n- 连接 $p$ 与边界的边的权重之和为 $\\sum_{b \\in \\mathcal{N}_p} w_{pb} = A$。\n\n将这些代入 $p$ 的方程中：\n$$\nw(u_p - u_q) + \\sum_{b \\in \\mathcal{N}_p} w_{pb}(u_p - 1) = 0\n$$\n$$\nw(u_p - u_q) + (u_p - 1)\\sum_{b \\in \\mathcal{N}_p} w_{pb} = 0\n$$\n$$\nw(u_p - u_q) + A(u_p - 1) = 0\n$$\n$$\n(w+A)u_p - w u_q = A \\quad (1)\n$$\n\n对于顶点 $q$，其邻点是顶点 $p$ 和边界顶点集 $\\mathcal{N}_q$。方程为：\n$$\nw_{qp}(u_q - u_p) + \\sum_{b \\in \\mathcal{N}_q} w_{qb}(u_q - u_b) = 0\n$$\n使用给定的定义和边界条件：\n- 权重为 $w_{qp} = w_{pq} = w$。\n- 边界值为 $u_b = g(b) = 0$ 对所有 $b \\in \\mathcal{N}_q$ 成立。\n- 连接 $q$ 与边界的边的权重之和为 $\\sum_{b \\in \\mathcal{N}_q} w_{qb} = B$。\n\n将这些代入 $q$ 的方程中：\n$$\nw(u_q - u_p) + \\sum_{b \\in \\mathcal{N}_q} w_{qb}(u_q - 0) = 0\n$$\n$$\nw(u_q - u_p) + u_q \\sum_{b \\in \\mathcal{N}_q} w_{qb} = 0\n$$\n$$\nw(u_q - u_p) + B u_q = 0\n$$\n$$\n-w u_p + (w+B) u_q = 0 \\quad (2)\n$$\n\n方程 $(1)$ 和 $(2)$ 构成了关于节点值 $u_p$ 和 $u_q$ 的 $2 \\times 2$ 线性系统：\n$$\n\\begin{pmatrix}\nw+A  -w \\\\\n-w  w+B\n\\end{pmatrix}\n\\begin{pmatrix}\nu_p \\\\\nu_q\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nA \\\\\n0\n\\end{pmatrix}\n$$\n为了求解该系统以得到 $u_p$，我们使用克莱姆法则。系数矩阵的行列式为：\n$$\n\\det(K) = (w+A)(w+B) - (-w)(-w) = w^2 + wB + wA + AB - w^2 = w(A+B) + AB\n$$\n求解 $u_p$ 的矩阵行列式为：\n$$\n\\det(K_p) = \\det \\begin{pmatrix} A  -w \\\\ 0  w+B \\end{pmatrix} = A(w+B) - 0 = A(w+B)\n$$\n因此 $u_p$ 的解为：\n$$\nu_p = \\frac{\\det(K_p)}{\\det(K)} = \\frac{A(w+B)}{w(A+B)+AB}\n$$\n\n现在，我们分析这个结果来证明其违背了离散极值原理 (DMP)。DMP 要求任何内部节点上的解都应被边界上的最小值和最大值所界定。在这里，指定的边界值为 $0$ 和 $1$。如果 $u_p  1$ 或 $u_p  0$，就发生了 DMP 违背。我们将证明 $u_p  1$。\n\n条件 $\\alpha + \\beta  \\pi$（其中 $\\alpha, \\beta \\in (0, \\pi)$）意味着 $\\cot \\alpha + \\cot \\beta  0$。这是因为如果一个角（比如 $\\alpha$）是钝角（$\\alpha  \\pi/2$），其对应的余切值为负。如果另一个角 $\\beta$ 是锐角且满足 $\\alpha+\\beta  \\pi$，那么 $\\beta  \\pi-\\alpha$。由于 $\\cot$ 函数在 $(0, \\pi)$ 上是递减的，我们有 $\\cot \\beta  \\cot(\\pi-\\alpha) = -\\cot\\alpha$。因此，$\\cot\\alpha + \\cot\\beta  0$。这直接意味着 $w = \\frac{1}{2}(\\cot \\alpha + \\cot \\beta)  0$。\n\n让我们考察 $u_p - 1$ 的表达式：\n$$\nu_p - 1 = \\frac{A(w+B)}{w(A+B)+AB} - 1 = \\frac{Aw + AB - (wA + wB + AB)}{w(A+B)+AB} = \\frac{-wB}{w(A+B)+AB}\n$$\n为证明 $u_p  1$，我们必须证明 $u_p - 1  0$。\n量 $A$ 和 $B$ 是边权重的和。对于一个形状合理的网格，边界边所对的内角是锐角，使其余切值为正。因此，我们假设 $w_{pb}  0$ 和 $w_{qb}  0$，这意味着 $A  0$ 和 $B  0$。\n在 $w  0$ 和 $B  0$ 的情况下，分子 $-wB$ 是正的。\n分母是 $D = \\det(K) = w(A+B) + AB$。对于整个有限元问题要是适定的并有唯一解，内部节点的刚度矩阵 $K$ 必须是正定的。一个对称的 $2 \\times 2$ 矩阵是正定的，如果其迹和行列式都为正。因此，其行列式 $D$ 必须为正。\n由于分子 $-wB$ 为正，分母 $D$ 也为正，我们得出结论：\n$$\nu_p - 1 = \\frac{-wB}{D}  0 \\implies u_p  1\n$$\n指定的狄利克雷数据的最大值为 $1$。内部顶点处的节点值 $u_p$ 超过此最大值的事实直接违背了离散极值原理。这种违背是由非Delaunay条件 $\\alpha+\\beta  \\pi$ 引起的，该条件导致刚度矩阵中出现一个正的非对角元素 $-w$，从而使其不再是一个 M-矩阵。\n\n两种基于网格优化的补救措施可以防止此类违背：\n1. **Delaunay网格剖分**：最直接的补救措施是确保三角剖分 $\\mathcal{T}_h$ 是一个 Delaunay 三角剖分。对于 Delaunay 三角剖分中的任意内部边，其对角之和小于或等于 $\\pi$。这确保了 $\\cot \\alpha + \\cot \\beta \\ge 0$，从而得到非负的权重 $w \\ge 0$。当所有边权重都非负时，刚度矩阵的所有非对角元素都非正，使其成为一个 M-矩阵。此属性足以保证 DMP。Delaunay 网格可以使用诸如前沿推进法等算法生成，或从一组点构建（例如，Bowyer-Watson 算法），也可以通过边翻转算法将现有网格转换为 Delaunay 网格。\n2. **网格质量改进（平滑）**：网格平滑算法（如拉普拉斯平滑）通过重新定位内部顶点来改善三角形质量。例如，将一个顶点移动到其邻点的几何中心，倾向于使三角形更接近等边，从而增加它们的最小角。这个过程通常会消除非常大的角和像所描述的那样的非Delaunay构型。通过改善局部几何形状，这些方法有效地强制施加了一个“软”的类Delaunay条件，从而恢复了 DMP 的有效性。", "answer": "$$\n\\boxed{\\frac{A(w+B)}{w(A+B)+AB}}\n$$", "id": "2588983"}, {"introduction": "精确施加边界条件与离散化控制方程本身同等重要。这个练习将分析一种常用的技术——罚函数法，并揭示其应用中涉及的数学权衡。通过在一个简单的一维问题上进行分析，您将精确地推导出系统矩阵的条件数如何依赖于罚参数 $\\gamma$，从而理解在实践中选择合适罚参数所面临的挑战 [@problem_id:2588975]。", "problem": "考虑区间 $\\Omega = (0,1)$ 上的一维泊松方程，\n$$\n- u''(x) = f(x) \\quad \\text{在 } (0,1) \\text{ 内},\n$$\n其齐次狄利克雷边界条件为 $u(0) = 0$ 和 $u(1) = 0$。我们不强加狄利克雷边界条件，而是在弱形式中使用罚方法：对于罚参数 $\\gamma  0$，通过边界项 $\\gamma \\big(u(0) v(0) + u(1) v(1)\\big)$ 增广双线性形式。\n\n在具有$2$个单元和节点 $x_1 = 0$、$x_2 = \\tfrac{1}{2}$ 和 $x_3 = 1$ 的均匀网格上，使用连续分片线性有限元进行离散化。令 $\\{\\varphi_i\\}_{i=1}^3$ 为标准节点基。从第一性原理（弱形式的分部积分、有限元空间的定义以及单元矩阵的组装）出发，推导由此罚分公式产生的 $3 \\times 3$ 对称正定（SPD）线性系统矩阵 $A(\\gamma)$。然后，仅使用基本定义（对称矩阵的特征值和SPD矩阵的二范数条件数的定义），确定二范数条件数 $\\kappa_2\\!\\left(A(\\gamma)\\right)$ 作为 $\\gamma$ 的函数的精确闭式表达式。\n\n您的最终答案必须是关于 $\\gamma$ 的 $\\kappa_2\\!\\left(A(\\gamma)\\right)$ 的单一闭式解析表达式。不需要数值近似或四舍五入。", "solution": "用户希望我解决一个有限元方法领域的问题。\n\n### 第 1 步：问题验证\n\n问题陈述的验证如下：\n\n-   **已知条件提取**：\n    1.  **控制方程**：定义域 $\\Omega = (0,1)$ 上的一维泊松方程 $-u''(x) = f(x)$。\n    2.  **边界条件**：齐次狄利克雷条件 $u(0) = 0$ 和 $u(1) = 0$。\n    3.  **数值方法**：边界条件采用罚方法处理。\n    4.  **双线性形式修正**：标准双线性形式通过项 $\\gamma \\big(u(0) v(0) + u(1) v(1)\\big)$ 进行增广，其中 $\\gamma  0$ 是一个罚参数。\n    5.  **离散化**：连续分片线性有限元。\n    6.  **网格**：一个包含2个单元的均匀网格，节点位于 $x_1 = 0$、$x_2 = \\frac{1}{2}$ 和 $x_3 = 1$。\n    7.  **基函数**：标准节点基函数 $\\{\\varphi_i\\}_{i=1}^3$。\n    8.  **任务1**：推导 $3 \\times 3$ 对称正定（SPD）线性系统矩阵 $A(\\gamma)$。\n    9.  **任务2**：使用基本定义，确定二范数条件数 $\\kappa_2(A(\\gamma))$ 作为 $\\gamma$ 的函数的精确闭式表达式。\n\n-   **验证结论**：\n    该问题是**有效的**。它在科学上基于数值分析和有限元方法的原理。问题是适定的，提供了推导唯一、有意义解所需的所有信息。语言客观而精确。该问题是应用罚方法和分析所得刚度矩阵的标准练习，并且没有任何指定的无效性缺陷。\n\n### 第 2 步：问题求解\n\n该问题将通过以下步骤解决：首先推导弱形式，然后使用指定的有限元基对其进行离散化以构建系统矩阵 $A(\\gamma)$，最后通过求其特征值来计算其二范数条件数。\n\n**1. 带罚方法的弱形式**\n\n泊松方程的强形式为：\n$$ -u''(x) = f(x), \\quad x \\in (0,1) $$\n为得到弱形式，我们乘以一个测试函数 $v \\in H^1(0,1)$ 并在定义域 $\\Omega = (0,1)$ 上积分：\n$$ -\\int_0^1 u''(x)v(x) \\,dx = \\int_0^1 f(x)v(x) \\,dx $$\n对左侧应用分部积分得到：\n$$ \\int_0^1 u'(x)v'(x) \\,dx - \\big[u'(x)v(x)\\big]_0^1 = \\int_0^1 f(x)v(x) \\,dx $$\n问题指定狄利克雷边界条件需用罚方法处理。这涉及增广弱形式的双线性形式。标准双线性形式为 $a(u,v) = \\int_0^1 u'(x)v'(x) \\,dx$。指定的罚项为 $\\gamma \\big(u(0)v(0) + u(1)v(1)\\big)$。\n\n增广后的双线性形式，记为 $a_\\gamma(u,v)$，是：\n$$ a_\\gamma(u,v) = \\int_0^1 u'(x)v'(x) \\,dx + \\gamma u(0)v(0) + \\gamma u(1)v(1) $$\n线性形式为 $L(v) = \\int_0^1 f(x)v(x) \\,dx$。使用罚方法的弱形式是：寻找 $u \\in H^1(0,1)$，使得对于所有测试函数 $v \\in H^1(0,1)$：\n$$ a_\\gamma(u,v) = L(v) $$\n\n**2. 有限元离散化与矩阵组装**\n\n我们将定义域 $\\Omega = (0,1)$ 离散化为两个等长 $h = \\frac{1}{2}$ 的线性单元。节点位于 $x_1 = 0$、$x_2 = \\frac{1}{2}$ 和 $x_3 = 1$。有限元解 $u_h(x)$ 和测试函数 $v_h(x)$ 表示为标准节点基函数 $\\{\\varphi_i\\}_{i=1}^3$ 的线性组合：\n$$ u_h(x) = \\sum_{j=1}^3 c_j \\varphi_j(x), \\quad v_h(x) = \\sum_{i=1}^3 d_i \\varphi_i(x) $$\n其中 $c_j$ 是解的未知节点值，$c_j = u_h(x_j)$。通过为 $i=1,2,3$ 设置 $v_h = \\varphi_i$ 来获得离散系统。这导出了线性系统 $A(\\gamma) \\mathbf{c} = \\mathbf{F}$，其中矩阵 $A(\\gamma)$ 的元素由下式给出：\n$$ A_{ij} = a_\\gamma(\\varphi_j, \\varphi_i) = \\int_0^1 \\varphi'_j(x)\\varphi'_i(x) \\,dx + \\gamma \\varphi_j(0)\\varphi_i(0) + \\gamma \\varphi_j(1)\\varphi_i(1) $$\n矩阵 $A(\\gamma)$ 可以表示为标准刚度矩阵 $K$ 和一个罚矩阵 $P$ 的和：$A(\\gamma) = K + P$。\n\n**2a. 刚度矩阵 $K$**\n\n刚度矩阵的元素为 $K_{ij} = \\int_0^1 \\varphi'_j(x)\\varphi'_i(x) \\,dx$。对于长度为 $h$ 的一维线性单元，单元刚度矩阵为 $k^e = \\frac{1}{h}\\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$。\n这里，$h = \\frac{1}{2}$，所以 $\\frac{1}{h} = 2$。\n对于两个单元 $\\Omega_1 = (0, \\frac{1}{2})$ 和 $\\Omega_2 = (\\frac{1}{2}, 1)$，单元刚度矩阵都是 $k^e = \\begin{pmatrix} 2  -2 \\\\ -2  2 \\end{pmatrix}$。\n将这些组装成全局 $3 \\times 3$ 刚度矩阵 $K$：\n-   单元 $1$（节点 $1, 2$）：对左上角的 $2 \\times 2$ 子块贡献 $\\begin{pmatrix} 2  -2 \\\\ -2  2 \\end{pmatrix}$。\n-   单元 $2$（节点 $2, 3$）：对右下角的 $2 \\times 2$ 子块贡献 $\\begin{pmatrix} 2  -2 \\\\ -2  2 \\end{pmatrix}$。\n将贡献相加：\n$$ K = \\begin{pmatrix} 2  -2  0 \\\\ -2  2+2  -2 \\\\ 0  -2  2 \\end{pmatrix} = \\begin{pmatrix} 2  -2  0 \\\\ -2  4  -2 \\\\ 0  -2  2 \\end{pmatrix} $$\n\n**2b. 罚矩阵 $P$**\n\n罚矩阵的元素为 $P_{ij} = \\gamma \\varphi_j(0)\\varphi_i(0) + \\gamma \\varphi_j(1)\\varphi_i(1)$。节点基函数具有性质 $\\varphi_i(x_j) = \\delta_{ij}$。边界节点是 $x_1=0$ 和 $x_3=1$。\n-   $\\varphi_1(0)=1$, $\\varphi_1(1)=0$\n-   $\\varphi_2(0)=0$, $\\varphi_2(1)=0$\n-   $\\varphi_3(0)=0$, $\\varphi_3(1)=1$\n使用这些值：\n-   $P_{11} = \\gamma(\\varphi_1(0)^2 + \\varphi_1(1)^2) = \\gamma(1^2 + 0^2) = \\gamma$\n-   $P_{33} = \\gamma(\\varphi_3(0)^2 + \\varphi_3(1)^2) = \\gamma(0^2 + 1^2) = \\gamma$\n所有其他元素 $P_{ij}$ 均为零，因为乘积中至少有一个基函数在两个边界上都为零。例如，$P_{12} = \\gamma(\\varphi_2(0)\\varphi_1(0) + \\varphi_2(1)\\varphi_1(1)) = \\gamma(0 \\cdot 1 + 0 \\cdot 0) = 0$。\n罚矩阵是：\n$$ P = \\begin{pmatrix} \\gamma  0  0 \\\\ 0  0  0 \\\\ 0  0  \\gamma \\end{pmatrix} $$\n\n**2c. 最终系统矩阵 $A(\\gamma)$**\n\n将刚度矩阵和罚矩阵相加：\n$$ A(\\gamma) = K + P = \\begin{pmatrix} 2  -2  0 \\\\ -2  4  -2 \\\\ 0  -2  2 \\end{pmatrix} + \\begin{pmatrix} \\gamma  0  0 \\\\ 0  0  0 \\\\ 0  0  \\gamma \\end{pmatrix} = \\begin{pmatrix} 2+\\gamma  -2  0 \\\\ -2  4  -2 \\\\ 0  -2  2+\\gamma \\end{pmatrix} $$\n这就是所求的 $3 \\times 3$ 对称正定矩阵。\n\n**3. 条件数计算**\n\n对于对称正定矩阵，二范数条件数定义为其最大特征值与最小特征值之比：$\\kappa_2(A(\\gamma)) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}}$。我们必须通过求解特征方程 $\\det(A(\\gamma) - \\lambda I) = 0$ 来找到 $A(\\gamma)$ 的特征值。\n$$ \\det \\begin{pmatrix} 2+\\gamma-\\lambda  -2  0 \\\\ -2  4-\\lambda  -2 \\\\ 0  -2  2+\\gamma-\\lambda \\end{pmatrix} = 0 $$\n沿第一行展开行列式：\n$$ (2+\\gamma-\\lambda)((4-\\lambda)(2+\\gamma-\\lambda) - 4) - (-2)(-2(2+\\gamma-\\lambda)) = 0 $$\n$$ (2+\\gamma-\\lambda) \\left[ (4-\\lambda)(2+\\gamma-\\lambda) - 4 - 4 \\right] = 0 $$\n$$ (2+\\gamma-\\lambda) \\left[ (4-\\lambda)(2+\\gamma-\\lambda) - 8 \\right] = 0 $$\n这个方程直接给出一个特征值，并为另外两个特征值提供了一个二次方程。\n-   情况 1：$2+\\gamma-\\lambda = 0 \\implies \\lambda_1 = 2+\\gamma$。\n-   情况 2：$(4-\\lambda)(2+\\gamma-\\lambda) - 8 = 0$。\n    $$ 8 + 4\\gamma - 4\\lambda - 2\\lambda - \\gamma\\lambda + \\lambda^2 - 8 = 0 $$\n    $$ \\lambda^2 - (6+\\gamma)\\lambda + 4\\gamma = 0 $$\n使用求根公式来找到另外两个特征值 $\\lambda_2$ 和 $\\lambda_3$：\n$$ \\lambda = \\frac{(6+\\gamma) \\pm \\sqrt{(6+\\gamma)^2 - 4(1)(4\\gamma)}}{2} = \\frac{6+\\gamma \\pm \\sqrt{36+12\\gamma+\\gamma^2 - 16\\gamma}}{2} $$\n$$ \\lambda = \\frac{6+\\gamma \\pm \\sqrt{\\gamma^2 - 4\\gamma + 36}}{2} $$\n三个特征值是：\n$$ \\lambda_1 = 2+\\gamma $$\n$$ \\lambda_{2,3} = \\frac{6+\\gamma \\pm \\sqrt{\\gamma^2 - 4\\gamma + 36}}{2} $$\n为了找到 $\\lambda_{\\min}$ 和 $\\lambda_{\\max}$，我们对这三个特征值进行排序。通过仔细比较（如思考过程中详述），对于任何 $\\gamma  0$，$\\lambda_1=2+\\gamma$ 的值位于另外两个特征值之间。\n最小的特征值是：\n$$ \\lambda_{\\min} = \\frac{6+\\gamma - \\sqrt{\\gamma^2 - 4\\gamma + 36}}{2} $$\n最大的特征值是：\n$$ \\lambda_{\\max} = \\frac{6+\\gamma + \\sqrt{\\gamma^2 - 4\\gamma + 36}}{2} $$\n条件数是这两个特征值之比：\n$$ \\kappa_2(A(\\gamma)) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} = \\frac{\\frac{6+\\gamma + \\sqrt{\\gamma^2 - 4\\gamma + 36}}{2}}{\\frac{6+\\gamma - \\sqrt{\\gamma^2 - 4\\gamma + 36}}{2}} $$\n$$ \\kappa_2(A(\\gamma)) = \\frac{6+\\gamma + \\sqrt{\\gamma^2 - 4\\gamma + 36}}{6+\\gamma - \\sqrt{\\gamma^2 - 4\\gamma + 36}} $$\n这就是条件数作为 $\\gamma$ 函数的精确闭式表达式。", "answer": "$$\\boxed{\\frac{6+\\gamma + \\sqrt{\\gamma^2 - 4\\gamma + 36}}{6+\\gamma - \\sqrt{\\gamma^2 - 4\\gamma + 36}}}$$", "id": "2588975"}]}