{"hands_on_practices": [{"introduction": "二进制加法是所有数字计算的核心。在深入研究更复杂的设计之前，掌握基础的逐位加法和进位传播机制至关重要。通过这个练习 ([@problem_id:1913349])，你将实践两个无符号二进制数相加的基本过程，这为你理解更高级的算术逻辑单元 (ALU) 的工作原理奠定了坚实的基础。", "problem": "在一个数字系统中，需要将两个4位无符号二进制数 $A = 1011_2$ 和 $B = 0110_2$ 相加。该运算由一个二进制加法器电路执行，其产生的结果可能需要超过4位才能完全表示。\n\n确定表示 $A$ 和 $B$ 完全和的5位无符号二进制数。", "solution": "问题要求计算两个4位无符号二进制数 $A = 1011_2$ 和 $B = 0110_2$ 的和。我们需要找出这次加法的5位结果。我们将 $A$ 的各位表示为 $A_3A_2A_1A_0$，$B$ 的各位表示为 $B_3B_2B_1B_0$，其中下标表示比特位（0为最低有效位）。和将是一个5位数，我们可以表示为 $S_4S_3S_2S_1S_0$。\n\n我们从右到左逐列进行加法运算，并记录每个阶段的进位。设 $C_i$ 为第 $i$ 列的输入进位。\n\n**第1步：第0列（最低有效位）**\n我们将最右边的位相加，$A_0$ 和 $B_0$。没有初始输入进位，所以 $C_0 = 0$。\n$S_0 = A_0 + B_0 + C_0 = 1 + 0 + 0 = 1$。\n到下一列的输出进位 $C_1$ 为 0，因为和小于2。\n- 和位：$S_0 = 1$\n- 输出进位：$C_1 = 0$\n\n**第2步：第1列**\n我们将位 $A_1$ 和 $B_1$ 与前一步的输入进位 $C_1$ 相加。\n$S_1 = A_1 + B_1 + C_1 = 1 + 1 + 0 = 2$。\n在二进制中，$2_{10}$ 表示为 $10_2$。和位是该结果的最低有效位（LSB），输出进位是最高有效位（MSB）。\n- 和位：$S_1 = 0$\n- 输出进位：$C_2 = 1$\n\n**第3步：第2列**\n我们将位 $A_2$ 和 $B_2$ 与输入进位 $C_2$ 相加。\n$S_2 = A_2 + B_2 + C_2 = 0 + 1 + 1 = 2$。\n同样，$2_{10} = 10_2$。\n- 和位：$S_2 = 0$\n- 输出进位：$C_3 = 1$\n\n**第4步：第3列（输入的最高有效位）**\n我们将位 $A_3$ 和 $B_3$ 与输入进位 $C_3$ 相加。\n$S_3 = A_3 + B_3 + C_3 = 1 + 0 + 1 = 2$。\n再一次，$2_{10} = 10_2$。\n- 和位：$S_3 = 0$\n- 输出进位：$C_4 = 1$\n\n**第5步：第4列（最终进位）**\n最终的和需要第5位，它就是最后一列的输出进位 $C_4$。\n- 和位：$S_4 = C_4 = 1$\n\n**第6步：组合最终结果**\n我们将和位 $S_4S_3S_2S_1S_0$ 组合起来，形成5位结果。\n结果是 $10001_2$。\n\n我们可以将加法过程可视化如下：\n```\n  111   (Carries)\n  1011  (A)\n+ 0110  (B)\n-------\n 10001  (Sum)\n```\n因此，表示 $A=1011_2$ 和 $B=0110_2$ 之和的5位无符号二进制数是 $10001_2$。", "answer": "$$\\boxed{10001}$$", "id": "1913349"}, {"introduction": "在现实世界的计算机中，数字是用固定位宽的二进制数表示的，这引入了表示范围的限制。当两个正数相加的结果超出了这个范围时，就会发生“溢出”错误，这是一个在处理器设计中必须处理的关键问题。本练习 ([@problem_id:1913336]) 模拟了一个 8 位处理器中的有符号数加法，让你亲身体验如何检测溢出，并理解其对计算结果准确性的影响。", "problem": "一个简单的 8 位微处理器使用二进制补码表示法处理整数。该处理器的状态寄存器包含一个溢出标志位，记为 `V`。如果算术运算的结果超出了 8 位有符号整数的可表示范围，则 `V` 置为 1，否则置为 0。\n\n考虑两个 8 位寄存器 `R1` 和 `R2`，它们加载了以下二进制值：\n`R1` = $01011100_2$\n`R2` = $00110010_2$\n\n执行一条 `ADD R3, R1, R2` 指令，该指令计算 `R1` 和 `R2` 中值的和，并将 8 位结果存储在第三个寄存器 `R3` 中。\n\n确定存储在 `R3` 中的最终二进制值以及溢出标志位 `V` 的最终状态。\n\n从以下选项中选择正确的一项。\n\nA. 结果 = $10001110_2$，V = 1\n\nB. 结果 = $10001110_2$，V = 0\n\nC. 结果 = $01111110_2$，V = 0\n\nD. 结果 = $10011110_2$，V = 1\n\nE. 结果 = $10011110_2$，V = 0", "solution": "我们考虑 8 位二进制补码运算。其可表示范围为 $-2^{7}$ 到 $2^{7}-1$，即 $-128$ 到 $127$。当两个操作数符号相同而结果符号不同时，加法会发生溢出。这等效于，进入最高有效位的进位与从该位产生的进位不同。\n\n给定 $R1=01011100_{2}$ 和 $R2=00110010_{2}$，两者的最高有效位均为 $0$，因此它们都是正数。\n\n从最低有效位 $b_{0}$ 到最高有效位 $b_{7}$，逐位计算带有进位的 8 位和：\n\n- $b_{0}$: $0+0=0$，向 $b_{1}$ 的进位为 $0$。\n- $b_{1}$: $0+1=1$，向 $b_{2}$ 的进位为 $0$。\n- $b_{2}$: $1+0=1$，向 $b_{3}$ 的进位为 $0$。\n- $b_{3}$: $1+0=1$，向 $b_{4}$ 的进位为 $0$。\n- $b_{4}$: $1+1=0$，向 $b_{5}$ 的进位为 $1$。\n- $b_{5}$: $0+1+1=0$，向 $b_{6}$ 的进位为 $1$。\n- $b_{6}$: $1+0+1=0$，向 $b_{7}$ 的进位为 $1$。\n- $b_{7}$: $0+0+1=1$，产生的进位为 $0$。\n\n因此，8 位的结果是 $10001110_{2}$。\n\n对于溢出标志位 $V$，使用进位法：进入 $b_{7}$ 的进位等于 $1$，而从 $b_{7}$ 产生的进位等于 $0$，所以 $V=1$。等效地，两个输入都是正数（符号位为 $0$），而结果是负数（符号位为 $1$），因此发生了溢出。\n\n因此，正确的选项是 结果 $=10001110_{2}$ 且 $V=1$，这对应于选项 A。", "answer": "$$\\boxed{A}$$", "id": "1913336"}, {"introduction": "为了追求极致的速度和能效，现代电路设计有时会打破常规，采用“近似计算”的策略，即用可接受的微小误差换取显著的性能提升。这个高级练习 ([@problem_id:1913331]) 将带你分析一个经过简化的 8 位近似加法器的设计，它通过切断进位链来加速运算。通过计算其最坏情况误差和平均误差，你将能深入理解在硬件设计中，精度与性能之间的权衡。", "problem": "在近似计算领域，数字电路被有意简化，以牺牲少量计算精度来换取速度和功率效率的显著提升。考虑一个特殊的8位近似无符号加法器的设计。该加法器接收两个8位无符号输入 `A = A_7A_6A_5A_4A_3A_2A_1A_0` 和 `B = B_7B_6B_5B_4B_3B_2B_1B_0`，并产生一个8位的和 `S = S_7S_6S_5S_4S_3S_2S_1S_0`。\n\n该加法器的操作根据位的权重分为两部分：\n\n1.  **低位部分（最低有效位）：** 对于低4位（第0到3位），加法器执行标准的、完全精确的二进制加法。它计算出4位的和 `S_3S_2S_1S_0` 和一个进位输出信号，我们称之为 `C_4`，在标准加法器中，该信号将作为第5位位置的进位输入。\n\n2.  **高位部分（最高有效位）：** 对于高4位（第4到7位），为了性能，设计被激进地简化以打断进位链。来自低位部分的进位输出 `C_4` 被丢弃，不用于高位部分的计算。此外，高位部分和的各位是通过简单的位运算逻辑计算的：对于从4到7的每一位 `i`，对应的和位 `S_i` 计算为 `S_i = A_i \\oplus B_i`，其中 `\\oplus` 表示异或（XOR）运算。\n\n你的任务是分析这个近似加法器的误差特性。具体来说，你必须确定两个关键指标：\n\n-   **最坏情况误差：** 真实算术和 `(A + B)` 与近似加法器计算的和之间的最大可能绝对差。\n-   **平均误差：** 误差 `(真实和 - 近似和)` 的期望值，假设输入 `A` 和 `B` 是从所有可能的8位无符号整数集合中独立且均匀随机选择的。\n\n提供这两个数值。请以精确数值（例如，整数或分数）的形式给出你的答案。", "solution": "设 $A=16H_{A}+L_{A}$ 且 $B=16H_{B}+L_{B}$，其中 $H_{A},H_{B}\\in\\{0,\\dots,15\\}$ 是高4位整数，$L_{A},L_{B}\\in\\{0,\\dots,15\\}$ 是低4位整数。设 $L_{S}=(L_{A}+L_{B})\\bmod 16$ 且 $C_{4}=\\left\\lfloor (L_{A}+L_{B})/16\\right\\rfloor\\in\\{0,1\\}$。精确的和为\n$$\nT=A+B=16(H_{A}+H_{B}+C_{4})+L_{S}.\n$$\n近似加法器输出\n$$\nS_{\\mathrm{apx}}=16U+L_{S},\\quad U=H_{A}\\oplus H_{B}.\n$$\n因此（有符号）误差为\n$$\nE=T-S_{\\mathrm{apx}}=16\\big(H_{A}+H_{B}+C_{4}-U\\big).\n$$\n使用对所有非负整数 $x,y$ 均成立的位运算恒等式：\n$$\nx+y=(x\\oplus y)+2\\,(x\\,\\mathrm{AND}\\,y).\n$$\n令 $x=H_{A}$ 且 $y=H_{B}$，我们得到\n$$\nH_{A}+H_{B}-U=2\\,(H_{A}\\,\\mathrm{AND}\\,H_{B}),\n$$\n因此\n$$\nE=16\\big(2\\,(H_{A}\\,\\mathrm{AND}\\,H_{B})+C_{4}\\big).\n$$\n\n最坏情况误差。由于可以通过合适地选择 $L_{A},L_{B}$ 来使 $C_{4}$ 取0或1，最坏情况即使得 $2\\,(H_{A}\\,\\mathrm{AND}\\,H_{B})+C_{4}$ 最大化。对于 $H_{A},H_{B}\\in\\{0,\\dots,15\\}$，$(H_{A}\\,\\mathrm{AND}\\,H_{B})$ 的最大值为15，当 $H_{A}=H_{B}=15$ 时取得。取 $C_{4}=1$ 得到\n$$\n\\max|E|=16\\big(2\\cdot 15+1\\big)=16\\cdot 31=496.\n$$\n\n平均误差。当 $H_{A},H_{B}$ 和 $L_{A},L_{B}$ 是独立均匀分布时，我们有\n$$\n\\mathbb{E}[E]=16\\big(2\\,\\mathbb{E}[H_{A}\\,\\mathrm{AND}\\,H_{B}]+\\mathbb{E}[C_{4}]\\big),\n$$\n且独立性意味着 $\\mathbb{E}[H_{A}\\,\\mathrm{AND}\\,H_{B}]$ 与 $\\mathbb{E}[C_{4}]$ 相互独立。\n\n对于在 $\\{0,\\dots,15\\}$ 上均匀分布的 $H_{A},H_{B}$，按位分解AND运算。对于位 $k\\in\\{0,1,2,3\\}$，当两位都为1时，产生 $2^{k}$ 的贡献，这种情况发生的概率为 $(1/2)\\cdot(1/2)=1/4$。因此\n$$\n\\mathbb{E}[H_{A}\\,\\mathrm{AND}\\,H_{B}]=\\sum_{k=0}^{3}2^{k}\\cdot\\frac{1}{4}=\\frac{1}{4}(1+2+4+8)=\\frac{15}{4}.\n$$\n对于 $C_{4}$，当 $L_{A},L_{B}$ 在 $\\{0,\\dots,15\\}$ 上均匀分布时，$C_{4}=1$ 当且仅当 $L_{A}+L_{B}\\geq 16$。和为 $s$ 的数对数量，在 $0\\leq s\\leq 15$ 时为 $s+1$，在 $16\\leq s\\leq 30$ 时为 $31-s$。因此\n$$\n\\mathbb{P}(C_{4}=1)=\\frac{1}{256}\\sum_{s=16}^{30}(31-s)=\\frac{1}{256}\\sum_{t=1}^{15}t=\\frac{120}{256}=\\frac{15}{32},\n$$\n所以 $\\mathbb{E}[C_{4}]=\\frac{15}{32}$。因此\n$$\n\\mathbb{E}[E]=16\\left(2\\cdot\\frac{15}{4}+\\frac{15}{32}\\right)=16\\left(\\frac{30}{4}+\\frac{15}{32}\\right)=16\\cdot\\frac{255}{32}=\\frac{255}{2}.\n$$\n\n因此，最坏情况绝对误差是 $496$，而平均有符号误差 $\\mathbb{E}[T-S_{\\mathrm{apx}}]$ 是 $\\frac{255}{2}$。", "answer": "$$\\boxed{\\begin{pmatrix}496  \\frac{255}{2}\\end{pmatrix}}$$", "id": "1913331"}]}