{"hands_on_practices": [{"introduction": "静态时序分析（Static Timing Analysis, STA）的核心目标之一是确保数字电路能够在其目标时钟频率下可靠地运行。决定电路最高速度的关键因素是建立时间（setup time）约束，它要求数据信号必须在时钟有效沿到达之前稳定下来。此练习将引导你完成一个基本但至关重要的计算：确定一条典型数据路径的最高工作频率，其中考虑了逻辑门延迟、寄存器时序特性以及时钟偏斜（clock skew）这一实际效应[@problem_id:1963736]。", "problem": "在数字电路设计中，静态时序分析（Static Timing Analysis, STA）是一个关键过程，用于验证电路是否满足其时序约束，而无需实际仿真输入向量。STA 的一项关键任务是确定最大工作频率。\n\n考虑一个同步数字电路路径，它位于两个上升沿触发的寄存器之间，即寄存器 A（源）和寄存器 B（目标）。两个寄存器都由相同的时钟源驱动。从寄存器 A 输出的数据在到达寄存器 B 的数据输入端之前，会经过一个组合逻辑块。该组合逻辑块由一个双输入与门组成，其输出馈入一个三输入或门，该或门的输出再驱动一个反相器，反相器的输出连接到寄存器 B 的数据输入端。\n\n电路元件的时序参数如下：\n- 寄存器时钟到Q端延迟（$t_{cq}$）：0.7 ns\n- 寄存器建立时间（$t_{su}$）：1.1 ns\n- 寄存器保持时间（$t_{h}$）：0.5 ns\n- 双输入与门的传播延迟（$t_{AND2}$）：0.6 ns\n- 三输入或门的传播延迟（$t_{OR3}$）：0.8 ns\n- 反相器的传播延迟（$t_{INV}$）：0.3 ns\n\n由于芯片上的布线差异，寄存器之间存在时钟偏斜（$t_{skew}$）。时钟信号到达寄存器 B 的时间比到达寄存器 A 的时间晚 0.2 ns。\n\n计算该电路路径正常工作的最大可能时钟频率。以兆赫兹（MHz）为单位表示答案，并四舍五入到三位有效数字。", "solution": "我们分析从寄存器 A（发起端）经过组合逻辑到寄存器 B（捕获端）的单条同步路径，两者都在同一时钟沿触发，且存在正的捕获时钟偏斜。相关的时序约束是决定最大时钟频率的建立时间约束和保证正确性的保持时间约束。\n\n首先，计算从寄存器 A 输出端到寄存器 B 输入端的总组合逻辑传播延迟。该逻辑由一个双输入与门、一个三输入或门和一个反相器串联组成。我们将组合路径延迟定义为\n$$\nt_{\\text{pd,comb}}=t_{\\text{AND2}}+t_{\\text{OR3}}+t_{\\text{INV}}.\n$$\n代入给定值，\n$$\nt_{\\text{pd,comb}}=0.6\\ \\text{ns}+0.8\\ \\text{ns}+0.3\\ \\text{ns}=1.7\\ \\text{ns}.\n$$\n\n对于考虑时钟偏斜的建立时间，所需的时钟周期满足\n$$\nT_{\\text{clk}}\\geq t_{cq}+t_{\\text{pd,comb}}+t_{su}-t_{\\text{skew}},\n$$\n其中，当捕获时钟（在寄存器 B）比发起时钟（在寄存器 A）晚到达时，$t_{\\text{skew}}$ 取正值，这会放宽建立时间的要求。已知 $t_{cq}=0.7\\ \\text{ns}$，$t_{\\text{pd,comb}}=1.7\\ \\text{ns}$，$t_{su}=1.1\\ \\text{ns}$，以及 $t_{\\text{skew}}=0.2\\ \\text{ns}$，\n$$\nT_{\\text{clk}}\\geq 0.7+1.7+1.1-0.2=3.3\\ \\text{ns}.\n$$\n因此，最小的时钟周期为 $T_{\\min}=3.3\\ \\text{ns}$，最大时钟频率为\n$$\nf_{\\max}=\\frac{1}{T_{\\min}}=\\frac{1}{3.3\\ \\text{ns}}=0.30303\\ldots\\ \\text{GHz}=303.03\\ldots\\ \\text{MHz}.\n$$\n四舍五入到三位有效数字，得到 $f_{\\max}=303\\ \\text{MHz}$。\n\n为了完整性，我们验证保持时间约束。考虑时钟偏斜的保持时间要求是 $t_{cq,min} + t_{comb,min} \\ge t_h + t_{skew}$。我们使用给定的 $t_{cq}$ 作为 $t_{cq,min}$（0.7 ns），并采用一个保守的最短路径延迟界限 $t_{comb,min} \\geq 0$。代入数值，我们得到 $0.7\\ \\text{ns} + 0 \\geq 0.5\\ \\text{ns} + 0.2\\ \\text{ns}$，即 $0.7\\ \\text{ns} \\geq 0.7\\ \\text{ns}$。该条件得到满足，因此保持时间不会限制频率。所以，最大工作频率由上面计算的建立时间约束决定。", "answer": "$$\\boxed{303}$$", "id": "1963736"}, {"introduction": "在确保了电路的性能（最高频率）之后，我们必须同样关注其功能的正确性，这正是保持时间（hold time）约束的作用。与建立时间违例不同，保持时间违例会导致电路在任何时钟频率下都发生功能错误。本练习将让你扮演时序分析工程师的角色，诊断并修复一个保持时间违例问题，这是确保设计稳健性的关键技能[@problem_id:1963767]。你将学习如何处理“快路径”（fast path）问题，并了解通过插入缓冲器来增加延迟是解决此类问题的常用方法。", "problem": "一位数字设计工程师正在对现场可编程门阵列（FPGA）内的同步数据路径进行静态时序分析（STA）。该路径由一个源D型触发器（FF1）、一个组合逻辑块和一个目标D型触发器（FF2）组成。两个触发器都是上升沿触发，并由相同的理想系统时钟驱动，这意味着它们之间没有时钟偏斜。\n\n路径中各组件的时序特性如下：\n- 系统时钟周期（$T_{clk}$）：1.0 ns\n- FF1的时钟到Q端延迟（$T_{c \\to q}$）：最小值为120 ps，最大值为200 ps。\n- 组合逻辑的传播延迟（$T_{logic}$）：最小值为80 ps，最大值为150 ps。\n- FF2的建立时间要求（$T_{su}$）：150 ps。\n- FF2的保持时间要求（$T_{h}$）：250 ps。\n\n该工程师的分析正确地识别出此路径中存在保持时间违例。为了解决此问题，将在组合逻辑块中插入特殊的非反相缓冲单元以增加延迟。为了确保满足保持时间要求，必须在数据路径中添加的最小延迟量是多少？答案以皮秒（ps）表示。", "solution": "目标是确定为解决保持时间违例问题需要在数据路径中添加的最小延迟。\n\n首先，让我们理解同步数字电路中的保持时间约束。触发器的保持时间（$T_h$）是指在有效时钟沿到达*之后*，数据输入（D）必须保持稳定的最短时间。如果由源触发器在同一时钟沿锁存的来自前一状态的数据，过快地通过组合逻辑，在保持时间结束前就覆盖了目标触发器的输入，就会发生违例。这被称为“快路径”问题。\n\n因此，保持时间分析必须使用数据路径的最小可能延迟。数据可以到达目标触发器（FF2）输入端的最早时间，是源触发器（FF1）的最小时钟到Q端延迟与互连组合逻辑的最小传播延迟之和。\n\n设 $T_{arrival, min}$ 为数据到达 FF2 输入端的最早时间。\n$$T_{arrival, min} = T_{c \\to q, min} + T_{logic, min}$$\n根据题目描述，我们有：\n$T_{c \\to q, min} = 120 \\text{ ps}$\n$T_{logic, min} = 80 \\text{ ps}$\n\n代入这些值：\n$$T_{arrival, min} = 120 \\text{ ps} + 80 \\text{ ps} = 200 \\text{ ps}$$\n\n保持时间约束要求这个最早到达时间必须大于或等于 FF2 的保持时间要求（$T_h$）。\n保持时间裕量（$S_h$）是实际到达时间与保持条件所需到达时间之间的差值。\n$$S_h = T_{arrival, min} - T_h$$\nFF2的保持时间要求为 $T_h = 250 \\text{ ps}$。\n$$S_h = 200 \\text{ ps} - 250 \\text{ ps} = -50 \\text{ ps}$$\n负的保持时间裕量表示存在违例。裕量的大小，50 ps，表示数据路径快了 50 ps。数据在允许变化之前 50 ps 就已在 FF2 的输入端发生了变化。\n\n为了修复这个违例，我们必须向数据路径中添加延迟，例如通过插入缓冲器。设所需的最小附加延迟为 $T_{add}$。新的最早到达时间 $T'_{arrival, min}$ 将是：\n$$T'_{arrival, min} = T_{arrival, min} + T_{add}$$\n为了满足保持时间约束，新的保持时间裕量必须大于或等于零。为了找到最小的附加延迟，我们将新的裕量设为恰好为零。\n$$S'_{h} = T'_{arrival, min} - T_h = 0$$\n$$(T_{arrival, min} + T_{add}) - T_h = 0$$\n求解 $T_{add}$：\n$$T_{add} = T_h - T_{arrival, min}$$\n代入已知值：\n$$T_{add} = 250 \\text{ ps} - 200 \\text{ ps} = 50 \\text{ ps}$$\n或者，最小附加延迟必须等于负裕量的大小：\n$$T_{add} = |S_h| = |-50 \\text{ ps}| = 50 \\text{ ps}$$\n因此，为了修复保持时间违例，必须在数据路径中添加至少 50 ps 的延迟。其他参数（$T_{clk}$、最大延迟和 $T_{su}$）与建立时间分析相关，与保持时间分析无关，因此在本计算中未使用。", "answer": "$$\\boxed{50}$$", "id": "1963767"}, {"introduction": "建立时间和保持时间实际上对组合逻辑的延迟施加了双向约束：逻辑路径不能太慢，以免违反建立时间；同时也不能太快，以免违反保持时间。这两个相互制约的条件共同定义了一个“合法”的时序窗口。这个综合性练习将挑战你确定一个组合逻辑模块的允许延迟范围，从而深刻理解建立时间与保持时间之间的相互作用，以及它们如何共同保证电路的正确运行[@problem_id:1963715]。", "problem": "一个工程团队正在为一款高性能四旋翼无人机的惯性测量单元 (IMU) 设计一个定制的专用集成电路 (ASIC)。该设计中的一个关键数据路径由一个发射寄存器、一个组合逻辑块和一个捕获寄存器组成。该路径对于实时处理传感器数据至关重要。为使电路正常工作，它必须满足时序约束，不能有任何建立时间或保持时间违例。\n\n整个电路由一个理想的时钟网络驱动，这意味着发射寄存器和捕获寄存器之间没有时钟偏斜。时钟具有一个固定的周期 $T_{clk}$。这些寄存器被建模为D型触发器，全部来自同一个标准单元库，并共享以下特性：时钟到Q端延迟为 $t_{cq}$，建立时间要求为 $t_{su}$，保持时间要求为 $t_h$。组合逻辑块的延迟用 $t_{comb}$ 表示。\n\n所使用的工艺节点的具体时序参数如下：\n- 时钟周期, $T_{clk} = 2000 \\text{ ps}$\n- 时钟到Q端延迟, $t_{cq} = 80 \\text{ ps}$\n- 建立时间, $t_{su} = 110 \\text{ ps}$\n- 保持时间, $t_h = 95 \\text{ ps}$\n\n为确保可靠运行，组合逻辑延迟 $t_{comb}$ 必须落在特定的允许范围 $[t_{comb, min}, t_{comb, max}]$ 内。请确定组合逻辑块的最小和最大允许延迟的数值。\n\n请将您的最终答案表示为一对数值 $t_{comb, min}$ 和 $t_{comb, max}$，并按此顺序排列。这些值必须以皮秒 (ps) 为单位。", "solution": "对于一个从发射寄存器经过组合逻辑到捕获寄存器且时钟偏斜为零的同步路径，其时序约束包括建立时间约束和保持时间约束。\n\n对于建立时间约束，在一个时钟边沿发射的数据必须在下一个时钟边沿之前到达捕获寄存器并满足建立时间要求。在零时钟偏斜的情况下，这可以表示为：\n$$\nt_{cq} + t_{comb} + t_{su} \\leq T_{clk}.\n$$\n求解 $t_{comb}$ 可得出最大允许组合延迟：\n$$\nt_{comb,\\,max} = T_{clk} - t_{cq} - t_{su}.\n$$\n\n对于保持时间约束，新发射的数据相对于同一个时钟边沿不能过早到达捕获寄存器的输入端。在零时钟偏斜的情况下，这可以表示为：\n$$\nt_{cq} + t_{comb} \\geq t_{h}.\n$$\n求解 $t_{comb}$ 可得出最小允许组合延迟：\n$$\nt_{comb,\\,min} = t_{h} - t_{cq}.\n$$\n\n代入给定的数值 $T_{clk} = 2000\\,\\text{ps}$、$t_{cq} = 80\\,\\text{ps}$、$t_{su} = 110\\,\\text{ps}$ 和 $t_{h} = 95\\,\\text{ps}$：\n$$\nt_{comb,\\,max} = 2000 - 80 - 110 = 1810\\,\\text{ps},\n$$\n$$\nt_{comb,\\,min} = 95 - 80 = 15\\,\\text{ps}.\n$$\n\n因此，组合逻辑延迟的允许范围是 $[15\\,\\text{ps}, 1810\\,\\text{ps}]$。", "answer": "$$\\boxed{\\begin{pmatrix} 15  1810 \\end{pmatrix}}$$", "id": "1963715"}]}