{"hands_on_practices": [{"introduction": "将算法状态机（ASM）图转化为硬件实现的第一步，是为状态寄存器推导出正确的激励逻辑。这个练习将带你实践这一核心技能，通过一个简单的双状态控制器，重点关注如何根据状态转移条件，为特定的触发器（T触发器）计算出输入激励方程 [@problem_id:1957163]。掌握这一基本功，是理解状态机硬件实现的关键。", "problem": "一个简单的时序电路被设计用来控制一个自动阀门。该控制器的行为由一个双状态算法状态机（ASM）图描述。这两个状态是 `CLOSED`（关闭）和 `OPEN`（打开）。机器的状态存储在单个T触发器中，其中触发器的输出（用 $Q$ 表示）代表状态。状态分配如下：`CLOSED` 对应于 $Q=0$，`OPEN` 对应于 $Q=1$。\n\n控制器有一个二进制输入 $S$（代表'Start'，启动）和一个二进制输出 $V$（代表'Valve'，阀门）。时序行为定义如下：\n\n1.  当处于 `CLOSED` 状态（$Q=0$）时，控制器监视输入 $S$。如果 $S=0$，它保持在 `CLOSED` 状态。如果 $S=1$，它在下一个时钟沿转换到 `OPEN` 状态。\n2.  当处于 `OPEN` 状态（$Q=1$）时，控制器再次监视输入 $S$。如果 $S=1$，它保持在 `OPEN` 状态。如果 $S=0$，它在下一个时钟沿转换回 `CLOSED` 状态。\n\n输出 $V$ 是一个摩尔（Moore）型输出，当且仅当控制器处于 `OPEN` 状态时，其为高电平（$V=1$）。否则，$V=0$。\n\n您的任务是确定T触发器输入（$T$）和系统输出（$V$）的正确逻辑表达式。表达式应以状态变量 $Q$ 和输入 $S$ 表示。\n\n选择正确提供 $T$ 的激励方程和 $V$ 的输出方程的选项。在下面的选项中，符号 `A'` 表示 NOT A（非A），`A+B` 表示 A OR B（A或B），并列 `AB` 表示 A AND B（A与B），以及 `A⊕B` 表示 A XOR B（A异或B）。\n\nA. `T = S`, `V = Q`\nB. `T = Q'S`, `V = Q`\nC. `T = Q + S`, `V = S`\nD. `T = Q ⊕ S`, `V = Q`\nE. `T = QS`, `V = Q ⊕ S`", "solution": "根据ASM描述，次态仅取决于输入 $S$：\n- 如果 $S=0$，次态是 $\\text{CLOSED}$，即 $Q^{+}=0$。\n- 如果 $S=1$，次态是 $\\text{OPEN}$，即 $Q^{+}=1$。\n这些条件与现态 $Q$ 无关，因此次态函数为\n$$Q^{+}=S.$$\n\n对于T触发器，其特性方程为\n$$Q^{+}=T \\oplus Q.$$\n求解 $T$ 得到激励方程：\n$$T=Q \\oplus Q^{+}.$$\n代入 $Q^{+}=S$ 得\n$$T=Q \\oplus S.$$\n\n输出 $V$ 是一个摩尔型输出，仅在 $\\text{OPEN}$ 状态（对应于 $Q=1$）时为高电平，因此\n$$V=Q.$$\n\n与给定选项比较，这对应于选项 D：$T=Q \\oplus S$，$V=Q$。", "answer": "$$\\boxed{D}$$", "id": "1957163"}, {"introduction": "在数字系统设计中，验证和调试与从零开始设计同等重要。这个练习将让你扮演一位设计验证工程师，面对一个有缺陷的电路实现 [@problem_id:1957138]。你的任务是运用你对 ASM 图和时序逻辑的理解，通过对比规范和实际电路行为，精确定位并诊断出设计中的单一逻辑错误。", "problem": "一位工程师正在使用算法状态机（ASM）图设计一个时序电路，用于检测特定的可重叠输入序列 `101`。该电路是一个米利（Mealy）型状态机，具有单个二进制输入 $X$ 和单个二进制输出 $Z$。仅当检测到 `101` 序列的最后一个 `1` 时，在此时钟周期内，输出 $Z$ 应为 `1`。机器的状态存储在两个 D 型触发器 $Q_1$ 和 $Q_0$ 中。\n\nASM 图定义如下：\n-   **状态 S0 (二进制 `Q1Q0=00`):** 初始或复位状态。如果输入 $X=0$，机器保持在状态 `S0`。如果 $X=1$，它转换到状态 `S1`。在此状态下，输出 $Z$ 始终为 `0`。\n-   **状态 S1 (二进制 `Q1Q0=01`):** 此状态表示上一个输入是 `1`。如果输入 $X=0$，机器转换到状态 `S2`。如果 $X=1$，它保持在 `S1`（因为序列变为 `...11`）。在此状态下，输出 $Z$ 始终为 `0`。\n-   **状态 S2 (二进制 `Q1Q0=10`):** 此状态表示已接收到序列 `10`。如果输入 $X=0$，序列被中断，机器复位到 `S0`。如果 $X=1$，目标序列 `101` 完成；机器转换到状态 `S1`（因为这最后一个 `1` 可以是新序列的开始），并且在此转换期间输出 $Z$ 被置为 `1`。\n-   状态 `Q1Q0=11` 未被使用，可作为无关项处理。\n\n一位初级工程师提出了一个使用触发器和标准逻辑门的实现方案。下面给出了触发器输入（$D_1$、$D_0$）和输出（$Z$）的建议逻辑方程。然而，实现中存在一个错误，对应于一个不正确的逻辑门。\n\n建议方程：\n1.  `D1 = Q1' Q0 X`\n2.  `D0 = X`\n3.  `Z = Q1 Q0' X`\n\n通过从 ASM 图规范中推导正确的逻辑方程，从以下选项中找出建议实现中的唯一错误组件。\n\nA. 用于生成输出 `Z` 的 3 输入与门。\nB. 为 `D1` 门生成 `Q1'` 的反相器。\nC. 用于生成次态输入 `D1` 的 3 输入与门。\nD. 为 `Z` 门生成 `Q0'` 的反相器。\nE. 从输入 `X` 到次态输入 `D0` 的直接连线。", "solution": "我们使用指定的编码 $S0 \\equiv Q_{1}Q_{0}=00$，$S1 \\equiv 01$，$S2 \\equiv 10$（其中 $11$ 未使用），将 ASM 规范转换为次态和输出方程。\n\n根据 ASM 图：\n- 从 $S0$ ($Q_{1}Q_{0}=00$) 出发：如果 $X=0$，次态为 $00$；如果 $X=1$，次态为 $01$。\n- 从 $S1$ ($Q_{1}Q_{0}=01$) 出发：如果 $X=0$，次态为 $10$；如果 $X=1$，次态为 $01$。\n- 从 $S2$ ($Q_{1}Q_{0}=10$) 出发：如果 $X=0$，次态为 $00$；如果 $X=1$，次态为 $01$。\n\n米利输出仅在完成 $101$ 的转换时置位，即当处于状态 $S2$ 且 $X=1$ 时，因此 $Z=1$ 当且仅当 $(Q_{1},Q_{0},X)=(1,0,1)$。\n\n推导 $D_{1}$（$Q_{1}$ 的次态值）。$D_{1}=1$ 恰好在次态为 $S2$ ($10$) 时成立。根据状态图，这仅在现态为 $S1$ 且输入 $X=0$ 时发生，即当 $Q_{1}=0$，$Q_{0}=1$，$X=0$ 时。因此，\n$$\nD_{1} = Q_{1}'\\,Q_{0}\\,X' \\, .\n$$\n\n推导 $D_{0}$（$Q_{0}$ 的次态值）。$D_{0}=1$ 恰好在次态为 $S1$ ($01$) 时成立。根据状态图，对于 $\\{S0,S1,S2\\}$ 中的任何现态，只要 $X=1$，其次态就是 $S1$。因此，\n$$\nD_{0} = X \\, .\n$$\n\n推导输出 $Z$。根据上述米利定义，$Z=1$ 仅当处于状态 $S2$ ($Q_{1}=1$, $Q_{0}=0$) 且 $X=1$ 时成立，因此\n$$\nZ = Q_{1}\\,Q_{0}'\\,X \\, .\n$$\n\n与建议的方程进行比较：\n1. 建议的 $D_{1} = Q_{1}'\\,Q_{0}\\,X$ 与正确的 $D_{1} = Q_{1}'\\,Q_{0}\\,X'$ 对比。建议的表达式在需要 $X'$ 的地方使用了 $X$，因此不正确。\n2. 建议的 $D_{0} = X$ 与正确结果匹配，因此是正确的。\n3. 建议的 $Z = Q_{1}\\,Q_{0}'\\,X$ 与正确结果匹配，因此是正确的。\n\n因此，唯一的错误组件是用于生成 $D_{1}$ 的 3 输入与门，它本应以 $Q_{1}'$，$Q_{0}$ 和 $X'$ 作为输入，但却用 $X$ 代替了 $X'$ 来实现。\n\n因此，正确选项是 C。", "answer": "$$\\boxed{C}$$", "id": "1957138"}, {"introduction": "本练习将带你进入一个更高级和抽象的设计领域：硬件形式化验证。你将不再设计一个简单的控制器，而是设计一个能够自动检查其他状态机实现是否正确的“等价性检查器”[@problem_id:1957176]。这个挑战性的问题引入了状态编码映射、不匹配检测和“粘性”错误状态等高级概念，反映了现代数字集成电路设计中确保功能正确性的核心任务。", "problem": "在数字电路的形式化验证领域，确保一个综合后的硬件实现，即被测设计 (DUT)，与一个可信的“黄金”参考模型在功能上等价是至关重要的。您的任务是设计这样一个验证系统中的一个关键组件：一个同步硬件等价性检查器。\n\n这个检查器本身是一个有限状态机 (FSM)，我们称之为 `FSM_C`。它通过在每个时钟周期观察黄金模型 `FSM_G` 和被测设计 `FSM_D` 的状态向量来工作。`FSM_G` 和 `FSM_D` 都被假定与同一个时钟 `CLK` 同步，并由同一个高电平有效的同步 `RESET` 信号复位。\n\n`FSM_G` 的状态由一个 `W_G` 位的向量 `G` 表示，而 `FSM_D` 的状态由一个 `W_D` 位的向量 `D` 表示。请注意，状态编码甚至状态位数可能不同（即 `W_G` 不一定等于 `W_D`）。\n\n为了协调不同的状态编码，该检查器可以访问一个预加载的只读存储器块，称为等价性映射存储器 (EMM)。在本问题中，EMM被视为一个组合逻辑块。当来自黄金模型的 `W_G` 位状态向量 `G` 被用作 EMM 的地址时，该存储器会输出一个 (`W_D` + 1) 位的值。该输出包括：\n1.  一个 1 位的有效性标志位 `V`。`V=1` 表示状态 `G` 在 `FSM_D` 中有一个有效的对应状态。`V=0` 表示 `G` 在 `FSM_D` 中没有等价状态，这代表了一个根本性的实现缺陷。\n2.  一个 `W_D` 位的期望状态向量 `D_{equiv}`。如果 `V=1`，这是 `FSM_D` 为了被认为与 `FSM_G` 的状态 `G` 等价而 *应该* 处于的状态向量。如果 `V=0`，`D_{equiv}` 的值是未定义的，不得依赖。\n\n检查器 FSM `FSM_C` 必须按以下行为进行设计：\n-   它有一个单一的状态保持元件，由状态变量 `Q_C` 表示。`Q_C=0` 代表 `NORMAL`（正常）工作状态，`Q_C=1` 代表永久性的 `FAULT`（故障）状态。\n-   它有一个单一的输出信号 `ERROR`，其值直接等于其当前状态 `Q_C`。\n-   在 `RESET` 信号有效时（`RESET=1`），`FSM_C` 必须进入 `NORMAL` 状态（`Q_C=0`）。`FSM_G` 和 `FSM_D` 也被假定复位到它们的初始等价状态。\n-   在 `CLK` 的每个上升沿（当 `RESET=0` 时），`FSM_C` 必须检查是否存在等价性违规。如果以下任一条件为真，则发生违规：\n    a) 当前的黄金状态 `G` 映射到 EMM 中的一个无效条目（即 `V=0`）。\n    b) 当前的黄金状态 `G` 有一个有效的映射（`V=1`），但 DUT 的实际状态 `D` 与期望的等价状态 `D_{equiv}` 不匹配。\n-   如果检测到违规，`FSM_C` 必须转换到 `FAULT` 状态（`Q_C=1`）。\n-   一旦进入 `FAULT` 状态，`FSM_C` 必须在所有后续时钟周期中保持该状态，无论其输入如何，直到下一次 `RESET` 事件发生。\n\n您的任务是推导检查器下一状态 `Q_{C, next}` 的单一、完整的布尔逻辑方程，该方程是其当前状态 `Q_C`、主输入 `RESET`、DUT 的状态向量 `D` 以及 EMM 的输出 `V` 和 `D_{equiv}` 的函数。请使用标准的布尔运算符：非 (`\\overline{A}`), 与 (`\\land`), 或 (`\\lor`), 和异或 (`\\oplus`)。对向量位使用索引表示法（例如 `D_i`）。", "solution": "我们将该检查器建模为一个具有单个状态位 $Q_{C}$ 和高电平有效同步复位 $RESET$ 的同步 FSM。所要求的行为意味着：\n- 当 $RESET=1$ 时，下一状态必须为 $0$，无论其他输入如何：$Q_{C,\\text{next}}=0$。\n- 当 $RESET=0$ 时，如果检查器已处于 $FAULT$ 状态（$Q_{C}=1$）或在当前周期内检测到违规，它必须进入或保持在 $FAULT$ 状态。\n\n为了避免在 $V=0$ 时依赖未定义的 $D_{equiv}$，我们精确定义违规条件：\n- 条件 (a)：无效的映射条目，表示为 $\\overline{V}$。\n- 条件 (b)：映射有效 $V=1$ 但 $D \\neq D_{equiv}$。位级不匹配可以通过异或的或运算来捕获：\n$$\nM \\equiv \\bigvee_{i=0}^{W_{D}-1} \\left( D_{i} \\oplus (D_{equiv})_{i} \\right).\n$$\n为确保在 $V=0$ 时不依赖于 $(D_{equiv})_{i}$，用 $V$ 来门控 $M$。因此，违规谓词为\n$$\n\\text{VIOL} \\equiv \\overline{V} \\lor \\left( V \\land M \\right)\n= \\overline{V} \\lor \\left( V \\land \\bigvee_{i=0}^{W_{D}-1} \\left( D_{i} \\oplus (D_{equiv})_{i} \\right) \\right).\n$$\n\n结合同步复位和粘性故障行为，得到下一状态方程：\n- 如果 $RESET=1$，$Q_{C,\\text{next}}=0$。\n- 如果 $RESET=0$，$Q_{C,\\text{next}} = Q_{C} \\lor \\text{VIOL}$。\n\n这得出了单一的布尔表达式\n$$\nQ_{C,\\text{next}} = \\overline{RESET} \\land \\left( Q_{C} \\lor \\overline{V} \\lor \\left( V \\land \\bigvee_{i=0}^{W_{D}-1} \\left( D_{i} \\oplus (D_{equiv})_{i} \\right) \\right) \\right).\n$$\n该表达式仅使用 $\\overline{(\\cdot)}$、$\\land$、$\\lor$ 和 $\\oplus$，按要求对向量位进行索引，并保持在 $V=0$ 时对 $D_{equiv}$ 的独立性。", "answer": "$$\\boxed{\\overline{RESET} \\land \\left( Q_{C} \\lor \\overline{V} \\lor \\left( V \\land \\bigvee_{i=0}^{W_{D}-1} \\left( D_{i} \\oplus (D_{equiv})_{i} \\right) \\right) \\right)}$$", "id": "1957176"}]}