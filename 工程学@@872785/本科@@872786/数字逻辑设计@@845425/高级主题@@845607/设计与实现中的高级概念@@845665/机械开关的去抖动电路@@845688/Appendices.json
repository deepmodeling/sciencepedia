{"hands_on_practices": [{"introduction": "对抗开关抖动最直接的方法之一是使用简单的硬件滤波器。本练习将聚焦于设计一个由电阻和电容组成的 ($RC$) 低通滤波器，它利用电容器的充电时间来平滑抖动产生的噪声信号。通过这个练习 [@problem_id:1926770]，你将学会如何计算所需的电容值，以确保滤波器的时间常数足以吸收抖动，从而为数字逻辑电路提供一个干净的信号。", "problem": "一位电子爱好者正在制作一个定制的街机摇杆。所使用的按钮是机械式的，并表现出一种称为“触点抖动”的现象，即激活开关时，其电触点会反弹数次，然后才稳定在闭合状态。这会产生一个噪声信号，可能被摇杆的数字控制器误解为多次快速的按钮按下。\n\n为了解决这个问题，为每个按钮实现了一个简单的硬件去抖电路。该电路由一个上拉电阻和一个电容器组成，构成一个电阻-电容 (RC) 低通滤波器。上拉电阻的阻值为 $R = 10.0 \\text{ k}\\Omega$。开关制造商的数据手册规定，触点抖动持续时间 $t_{bounce}$ 不会超过 $5.0 \\text{ ms}$。对于这种类型的滤波器，一个可靠的工程准则是将其时间常数 $\\tau$ 设置为最大抖动持续时间的三倍以上，以确保为数字逻辑充分平滑电压波动。\n\n根据指定的准则，计算构建此去抖电路所需的最小电容 $C$。将您的答案以微法拉 ($\\mu\\text{F}$) 为单位表示，并四舍五入到三位有效数字。", "solution": "RC 去抖电路的时间常数由物理关系 $\\tau = R C$ 定义。设计准则要求时间常数至少是最大抖动持续时间的三倍：\n$$\n\\tau \\geq 3\\,t_{\\text{bounce}}.\n$$\n结合这些可以得出所需的电容：\n$$\nC \\geq \\frac{3\\,t_{\\text{bounce}}}{R}.\n$$\n将给定值代入国际单位制，即 $t_{\\text{bounce}} = 5.0 \\times 10^{-3}\\ \\text{s}$ 和 $R = 10.0 \\times 10^{3}\\ \\Omega$：\n$$\nC_{\\min} = \\frac{3 \\times 5.0 \\times 10^{-3}}{10.0 \\times 10^{3}}\\ \\text{F} = \\frac{15.0 \\times 10^{-3}}{10.0 \\times 10^{3}}\\ \\text{F} = 1.5 \\times 10^{-6}\\ \\text{F}.\n$$\n转换为微法拉，$1.5 \\times 10^{-6}\\ \\text{F} = 1.50\\ \\mu\\text{F}$，四舍五入到三位有效数字。", "answer": "$$\\boxed{1.50}$$", "id": "1926770"}, {"introduction": "在现代数字系统中，用软件或专用数字硬件来处理抖动比纯模拟方案更常见、更灵活。接下来的练习将介绍同步去抖方法，即通过系统时钟周期性地对开关状态进行采样。这个问题 [@problem_id:1926805] 将指导你计算需要多少个连续的稳定采样周期才能可靠地确认一次按键操作，这是固件和 FPGA 开发中的一项基本技能。", "problem": "在设计消费电子设备的数字接口时，使用一个机械按钮作为主要输入。已知机械开关会表现出一种称为“触点抖动”的现象，即在按下或释放时，物理触点会在短时间内相互反弹，导致一系列快速、虚假的电信号跳变。为了滤除这种噪声并防止单次按钮按下产生多次错误输入，实现了一个同步去抖动电路。\n\n该电路在稳定的系统时钟的每个上升沿对开关的状态进行采样。只有当输入信号在一个新的、稳定的逻辑电平上保持至少若干个连续的时钟周期时，状态变化才被认为是有效的。\n\n已知系统时钟频率为 $f_{clk} = 1 \\text{ kHz}$，且所用特定型号按钮的最大指定触点抖动时间为 $t_{bounce} = 10 \\text{ ms}$，请确定去抖动电路必须记录的最小连续稳定采样整数次数 $N$，以可靠地验证新的开关状态。", "solution": "设系统时钟周期为 $T_{clk} = \\frac{1}{f_{clk}}$。如果电路需要 $N$ 次连续的稳定采样来验证一个新状态，那么从第一次到第 $N$ 次确认采样之间经过的时间是 $(N-1)T_{clk}$（因为 $N$ 次采样之间有 $N-1$ 个采样间隔）。为了保证在抖动间隔完全结束之前不会发生验证，我们要求这段经过的时间至少等于最大抖动时间：\n$$\n(N-1)T_{clk} \\ge t_{bounce}.\n$$\n求解 $N$ 可得\n$$\nN \\ge 1 + \\frac{t_{bounce}}{T_{clk}} = 1 + t_{bounce} f_{clk}.\n$$\n因此，满足要求的最小整数是\n$$\nN = \\left\\lceil 1 + t_{bounce} f_{clk} \\right\\rceil.\n$$\n当 $f_{clk} = 1 \\times 10^{3}$ 且 $t_{bounce} = 10 \\times 10^{-3}$ 时，\n$$\nt_{bounce} f_{clk} = 10 \\quad \\Rightarrow \\quad N = \\left\\lceil 1 + 10 \\right\\rceil = 11.\n$$", "answer": "$$\\boxed{11}$$", "id": "1926805"}, {"introduction": "同步去抖电路的成功依赖于精确的时序控制，而这又取决于是否使用了正确的逻辑元件。虽然同步计数器的概念很直观，但选择何种存储元件来对输入信号进行采样却至关重要。本练习 [@problem_id:1926788] 提出了一个常见的设计错误场景——使用电平敏感的锁存器而非边沿触发的触发器——并要求你分析由此导致的失效模式。这将加深你对同步电路设计核心原则的理解。", "problem": "一位工程师的任务是为一个使用机械式单刀双掷 (SPDT) 开关的控制面板设计一个稳健的数字输入系统。当开关被拨动时，其内部触点会发生抖动，抖动持续时间最长可达 $T_{bounce}$，在进入稳定状态（逻辑 `0` 或逻辑 `1`）之前产生一系列不希望的电脉冲。为了滤除这种噪声，提出了一个同步去抖动电路。\n\n这种电路的标准实现是使用一个正边沿触发的 D 型触发器来采样开关的状态。开关输出连接到触发器的 D 输入端，采样时钟连接到时钟输入端。采样时钟的周期 $T_{clk}$ 被有意地设置为远大于 $T_{bounce}$。\n\n为了使用更简单的逻辑元件，工程师用一个电平敏感（透明）的 D 型锁存器替换了边沿触发的 D 型触发器。锁存器的 D 输入连接到开关，其门控（使能）输入连接到同一个采样时钟。该 D 型锁存器被配置为当时钟信号为 `HIGH` 时是透明的（即其输出 `Q` 跟随其输入 `D`），而当时钟信号变为 `LOW` 时锁存（保持）输入值。采样时钟的占空比为 50%。\n\n尽管时钟周期 $T_{clk}$ 远大于最大抖动持续时间 $T_{bounce}$，但使用 D 型锁存器的新电路却无法产生一个始终干净、无抖动的输出信号。下列哪个陈述最能描述这种失败的主要原因？\n\nA. 电路变得极易出现亚稳态，即锁存器的输出无限振荡或稳定在一个无效的电压电平，因为抖动的输入信号在时钟下降沿附近违反了锁存器的建立时间和保持时间要求。\n\nB. 如果开关拨动及其后续的抖动周期恰好发生在采样时钟为 `HIGH` 的时间间隔内，来自开关的抖动脉冲可以直接穿过锁存器传播到其输出端。\n\nC. D 型锁存器的静态功耗远高于 D 型触发器，导致过热和热失控，从而破坏输出信号。\n\nD. 电路在第一次拨动开关时工作正常，但之后锁存器的输出会永久地卡在该状态，无法响应任何后续的开关拨动。\n\nE. 锁存器的内部逻辑总是会反转开关的稳定状态，导致去抖动后的输出与预期的开关位置在逻辑上相反。", "solution": "问题要求找出将 D 型触发器替换为 D 型锁存器的同步去抖动电路的主要失效机制。我们来分析正确设计和错误设计的行为。\n\n首先，让我们理解开关抖动现象。当一个机械开关被拨动时，物理触点并不会形成一个干净、单一的连接。相反，它们会在短时间内相互反弹，这个时间为 `T_bounce`，导致电信号在 `HIGH` 和 `LOW` 之间快速交替，然后才稳定到最终的稳定状态。去抖动电路的目标是忽略这些瞬态抖动，并产生一个单一、干净的状态转换。\n\n现在，考虑使用正边沿触发的 D 型触发器的标准正确设计。这种类型的触发器是一个同步元件，它只在某个特定的瞬时时刻——即时钟信号的上升沿——采样其 `D` 输入并将其传输到 `Q` 输出。然后，输出 `Q` 会在整个时钟周期内保持这个值，直到下一个上升沿到来。由于时钟周期 `T_{clk}` 远大于抖动持续时间 `T_{bounce}`，因此可以保证在下一个时钟沿到达时，开关信号已经稳定到其新的稳定值。因此，触发器采样到一个稳定、正确的值，其输出在整个时钟周期内保持干净和稳定，成功地滤除了抖动。\n\n接下来，我们分析使用电平敏感 D 型锁存器的错误设计。D 型锁存器的行为与 D 型触发器不同。如问题所述，当其门控（使能）输入为 `HIGH` 时，锁存器是透明的。“透明”意味着输出 `Q` 直接且连续地跟随输入 `D`。只有当门控输入变为 `LOW` 时，锁存器才保持其值。占空比为 50% 的时钟信号连接到这个门控输入。这意味着在时钟周期的一半时间，即 `T_{clk}/2` 内，锁存器处于透明模式。\n\n这就是失败之处。问题指出 `T_{clk}` 远大于 `T_{bounce}`，但这并不排除抖动事件在任何特定时间发生。如果用户拨动开关，并且整个抖动事件（持续时间 `T_{bounce}`）恰好落在时钟为 `HIGH` 的 `T_{clk}/2` 时间间隔内，那么锁存器将是透明的。在此期间，来自抖动开关在 `D` 输入端的 `HIGH` 和 `LOW` 脉冲的快速序列将直接通过锁存器传递到 `Q` 输出。因此，“去抖动器”的输出将与其输入一样充满噪声。该电路完全没有达到其滤除抖动的目的。这种情况与选项 B 的描述完全一致。\n\n让我们评估其他选项：\n- A: 尽管在同步器电路中，当建立/保持时间被违反时，亚稳态是一个确实需要关注的问题，但它并非此处主要的、最常见的失效模式。最直接、最确定的失效是由于锁存器的透明性。在时钟为 `HIGH` 的阶段信号直接通过是一种必然的失效模式，而由特定时序违规引起的亚稳态则是一个概率性问题。\n- C: 在这种应用场景下，锁存器和触发器之间的功耗差异通常不足以导致热失控，这也不是一个主要的功能性故障。它是一个次要特性。\n- D: D 型锁存器不会被永久卡住。当时钟为 `HIGH` 时，它跟随其输入。当时钟为 `LOW` 时，它保持最后一个值，但在下一个周期会再次更新。它不会永久卡住。\n- E: 标准的 D 型锁存器是一个非反相元件。其 `Q` 输出反映的是 `D` 输入，而不是其反相。反相行为需要不同的电路配置。\n\n因此，主要且最根本的故障是锁存器的透明性，它允许抖动噪声在时钟为 `HIGH` 时通过。", "answer": "$$\\boxed{B}$$", "id": "1926788"}]}