{"hands_on_practices": [{"introduction": "为了真正掌握进位传播延迟，我们首先需要精确识别导致最坏情况延迟的条件。这个练习将挑战你分析一个组合式加法/减法器，并确定哪些特定的输入操作数和控制信号会产生最长的进位链。通过这个过程，你将加深对进位“传播”条件的理解，这是所有高性能加法器设计的基础 ([@problem_id:1917943])。", "problem": "一个12位数字算术单元被设计用于对两个无符号12位操作数$A$和$B$执行加法和减法。该单元的核心是一个12位纹波进位加法器 (RCA)。运算由单个控制信号`SUB`控制。\n\n电路实现如下：\n- 当`SUB = 0`时，该单元执行加法，计算$S = A + B$。\n- 当`SUB = 1`时，该单元执行减法，使用2的补码方法计算$S = A - B$。\n\n为了实现这种双重功能，一层逻辑门会修改输入到RCA的信号。RCA的两个12位输入是$X$和$Y$，初始进位是$C_{\\text{in}}$。这些输入由$A$、$B$和`SUB`决定如下：\n- 对于从0到11的每一位$i$，RCA的输入位$Y_i$由$Y_i = B_i \\oplus \\text{SUB}$给出。\n- 另一个RCA输入就是$X=A$。\n- RCA的初始进位是$C_{\\text{in}} = \\text{SUB}$。\n\n电路的总传播延迟由最长信号路径决定。在RCA中，最坏情况的延迟发生在进位信号必须传播通过每一个全加器阶段时。\n\n下列控制信号`SUB`和12位操作数$A$和$B$ (以十六进制给出) 的哪种组合会导致电路表现出其可能的最大传播延迟？选择所有有效选项。\n\nA. `SUB = 0`, `A = 0x000`, `B = 0xFFF`\n\nB. `SUB = 1`, `A = 0x555`, `B = 0xAAA`\n\nC. `SUB = 1`, `A = 0xFFF`, `B = 0xFFF`\n\nD. `SUB = 1`, `A = 0x000`, `B = 0x001`\n\nE. `SUB = 1`, `A = 0x000`, `B = 0x000`", "solution": "这个12位单元在$\\text{SUB} = 0$时实现$S = A + B$，在$\\text{SUB} = 1$时实现$S = A + \\overline{B} + 1$，其方法是向纹波进位加法器 (RCA) 输入$X = A$、$Y_{i} = B_{i} \\oplus \\text{SUB}$以及$C_{\\text{in}} = \\text{SUB}$。\n\n对于每个全加器阶段$i$，定义传播信号和生成信号：\n$$P_{i} = X_{i} \\oplus Y_{i}, \\quad G_{i} = X_{i} Y_{i}$$\n进位递归关系是：\n$$C_{i+1} = G_{i} \\lor \\left(P_{i} C_{i}\\right)$$\nRCA的最大传播延迟发生在进位必须纹波穿过每个阶段时，即当一个进位进入第0级（通过$C_{\\text{in}} = 1$或$G_{0} = 1$）并且对于所有级$P_i = 1$时，这样$C_{i+1} = C_{i}$在整个过程中都成立。因此，所需的条件是：\n- 在最低有效位端有一个进位源：$C_{0} = 1$或$G_{0} = 1$。\n- 对于所有的$i \\in \\{0,\\dots,11\\}$，$P_{i} = 1$且$G_{i} = 0$，这样进位就可以传播而不会被阻塞或重新生成。\n\n用$A$、$B$和$\\text{SUB}$来计算$P_{i}$：\n$$P_{i} = X_{i} \\oplus Y_{i} = A_{i} \\oplus (B_{i} \\oplus \\text{SUB}) = (A_{i} \\oplus B_{i}) \\oplus \\text{SUB}$$\n\n情况$\\text{SUB} = 1$：\n那么\n$$P_{i} = (A_{i} \\oplus B_{i}) \\oplus 1$$\n因此，当且仅当$A_{i} \\oplus B_{i} = 0$时$P_{i} = 1$，即对于每一个$i$都有$A_{i} = B_{i}$。因此，按位$A = B$保证了对于所有的$i$都有$P_{i} = 1$。同时，$C_{0} = \\text{SUB} = 1$，提供了初始进位。此外，由于$Y_{i} = B_{i} \\oplus 1 = \\overline{B_{i}}$，生成信号为\n$$G_{i} = A_{i} Y_{i} = A_{i}\\,\\overline{B_{i}}$$\n如果$A_{i} = B_{i}$，那么对于所有的$i$都有$G_{i} = 0$。因此，当$\\text{SUB} = 1$且$A = B$时，我们有对于所有的$i$，$P_{i} = 1$且$G_{i} = 0$，并且$C_{0} = 1$，所以进位会纹波穿过所有12个阶段，从而达到最大延迟。\n\n评估给定的$\\text{SUB} = 1$选项：\n- 选项 B：$A = 0x555$，$B = 0xAAA$是按位取反的关系，所以$A \\oplus B$全是1。那么对于所有的$i$，$P_{i} = (1) \\oplus 1 = 0$，所以没有进位传播链；不是最坏情况。\n- 选项 C：$A = 0xFFF$，$B = 0xFFF$导致$A = B$，所以对于所有的$i$，$P_{i} = 1$且$G_{i} = 0$，同时$C_{0} = 1$；这是最坏情况。\n- 选项 D：$A = 0x000$，$B = 0x001$导致$A \\neq B$，具体来说$P_{0} = 0$并且对于$i \\geq 1$有$P_{i} = 1$。在$C_{0} = 1$的情况下，第一级的$P_{0} = 0$和$G_{0} = 0$，所以$C_{1} = 0$；进位被立即阻塞，不会纹波传播；不是最坏情况。\n- 选项 E：$A = 0x000$，$B = 0x000$导致$A = B$，因此和选项C一样，$P_{i} = 1$，$G_{i} = 0$，并且$C_{0} = 1$；这是最坏情况。\n\n情况$\\text{SUB} = 0$：\n那么$Y = B$，$C_{0} = 0$，并且\n$$P_{i} = A_{i} \\oplus B_{i}, \\quad G_{i} = A_{i} B_{i}$$\n要在$C_{0} = 0$的情况下获得完整的12级纹波传播，我们需要$G_{0} = 1$来产生$C_{1} = 1$，并且对于所有的$i \\geq 1$，$P_{i} = 1$，$G_{i} = 0$。评估给定的选项：\n- 选项 A：$A = 0x000$，$B = 0xFFF$导致对于所有的$i$，$P_{i} = 1$且$G_{i} = 0$，但是$C_{0} = 0$且$G_{0} = 0$，所以没有产生初始进位；没有进位在链中纹波传播；不是最坏情况。\n\n因此，只有当$\\text{SUB} = 1$且$A = B$的选项才能达到最大延迟。在所提供的选项中，它们是选项C和E。", "answer": "$$\\boxed{CE}$$", "id": "1917943"}, {"introduction": "识别出问题后，下一步自然是寻找解决方案。这个实践将带你从基本的行波进位加法器 (RCA) 过渡到一种更快的结构——进位选择加法器 (Carry-Select Adder)。通过比较这两种设计的延迟，你将亲手计算出架构优化如何能显著打破性能瓶颈，体会到并行计算在加速算术逻辑单元中的力量 ([@problem_id:1917908])。", "problem": "在数字逻辑设计中，算术电路的速度通常受限于进位传播。考虑一个单位全加器（FA）作为基本构建模块。对于此特定技术，一个全加器产生稳定和输出与稳定进位输出的传播延迟是相同的，我们将其表示为$t_{\\text{FA}}$。该延迟从其三个输入（$A_i$、$B_i$、$C_{\\text{in}}$）中最后一个稳定下来的时刻开始测量。\n\n通过级联8个这样的全加器，构建了一个8位行波进位加法器（RCA）。这个8位行波进位加法器的最坏情况传播延迟，从所有输入位（$A_{0..7}$、$B_{0..7}$）和初始进位输入（$C_0$）都稳定到最高有效和位（$S_7$）稳定的时刻，测量值为16.0 ns。\n\n为了提高性能，这个8位加法器被重新设计为进位选择加法器。这8位被分成两个4位块：一个低位块（第0-3位）和一个高位块（第4-7位）。低位块用一个4位行波进位加法器实现。高位块使用两个并行的4位行波进位加法器实现——一个假设来自低位块的进位输入为0来计算结果，另一个假设进位输入为1。然后，一组2选1多路复用器（MUX）为高位块的和位（$S_{4..7}$）和最终进位输出（$C_8$）选择正确的结果。所有这些多路复用器的选择信号是来自低位块的实际进位输出（$C_4$）。\n\n一个2选1多路复用器的传播延迟，从其选择输入到其输出测量，是全加器延迟的一半，即$t_{\\text{MUX}} = 0.5 \\times t_{\\text{FA}}$。相比之下，从多路复用器的数据输入到其输出的延迟被认为是可忽略的。\n\n计算这个8位进位选择加法器的新的最坏情况传播延迟。答案以纳秒为单位，并四舍五入到三位有效数字。", "solution": "全加器的和与进位的相同传播延迟表示为$t_{\\text{FA}}$。在一个$n$位行波进位加法器（RCA）中，最高有效和位$S_{n-1}$的最坏情况时间是进位穿过前$n-1$级所需的时间，再加上一个$t_{\\text{FA}}$以产生最终的和：\n$$t_{\\text{RCA}\\rightarrow S_{n-1}}=(n-1)t_{\\text{FA}}+t_{\\text{FA}}=n\\,t_{\\text{FA}}$$\n对于给定的8位RCA，到$S_{7}$的测量最坏情况延迟为$16.0$ ns，因此\n$$8\\,t_{\\text{FA}}=16.0\\ \\text{ns}\\ \\Rightarrow\\ t_{\\text{FA}}=2.0\\ \\text{ns}$$\n对于分成两个4位块的进位选择加法器：\n- 低位的4位RCA在以下时间后产生$C_{4}$\n$$t_{\\text{low}}=4\\,t_{\\text{FA}}$$\n- 每个高位的4位RCA（假设进位输入为0或1）在内部三次进位行波传播和最终求和之后产生$S_{7}$，即\n$$t_{\\text{upper\\_data}}=4\\,t_{\\text{FA}}$$\n- 2选1多路复用器的选择输入到输出延迟为\n$$t_{\\text{MUX}}=0.5\\times t_{\\text{FA}}$$\n加法器输出端的$S_{7}$在正确的高位和值出现在MUX数据输入端，并且选择信号（$C_{4}$）已通过MUX传播之后才可用。由于MUX的数据输入到输出延迟可忽略不计，到$S_{7}$的总最坏情况延迟是\n$$t_{\\text{CSA}\\rightarrow S_{7}}=\\max\\!\\big(4\\,t_{\\text{FA}},\\ 4\\,t_{\\text{FA}}+0.5\\,t_{\\text{FA}}\\big)=4.5\\,t_{\\text{FA}}$$\n代入$t_{\\text{FA}}=2.0$ ns，\n$$t_{\\text{CSA}\\rightarrow S_{7}}=4.5\\times 2.0\\ \\text{ns}=9.00\\ \\text{ns}$$\n四舍五入到三位有效数字，结果为$9.00$。", "answer": "$$\\boxed{9.00}$$", "id": "1917908"}, {"introduction": "除了优化硬件以避免延迟，我们还可以设计逻辑电路来主动分析延迟的发生条件。这个练习要求你设计一个布尔电路，它能判断一个4位加法器的最终进位输出是否依赖于初始进位，即是否存在一条贯穿所有位的进位传播路径。这不仅是对进位传播理论的深刻检验，也是一个将时序行为转化为纯粹逻辑表达式的绝佳实践 ([@problem_id:1917960])。", "problem": "一个标准的4位行波进位加法器接收两个4位数字$A = A_3A_2A_1A_0$和$B = B_3B_2B_1B_0$以及一个初始进位输入$c_0$作为输入。它产生一个4位的和$S = S_3S_2S_1S_0$和一个最终的进位输出$c_4$。该加法器由四个全加器级联而成，其中第$i$级的进位输出$c_{i+1}$成为第$i+1$级的进位输入。\n\n加法器的总传播延迟与输入有关。最长的延迟路径决定了最坏情况下的性能，它发生在进位信号必须传播通过所有四个级联时，这使得最终的进位输出$c_4$依赖于初始的进位输入$c_0$。在许多其他情况下，$c_4$的值完全由输入位$A$和$B$决定，而与$c_0$的值无关。可以设计一个逻辑电路来检测这种情况。\n\n推导一个检测信号$D$的简化布尔表达式。如果最终进位输出$c_4$与初始进位输入$c_0$无关，则该信号应为逻辑“1”，否则为“0”。你的最终表达式应该只用输入位$A_i$和$B_i$来表示。使用标准的布尔代数表示法（例如，乘积表示与，'+'表示或，上划线表示非）。", "solution": "令$g_{i} = A_{i}B_{i}$（生成）和$p_{i} = A_{i}\\overline{B_{i}} + \\overline{A_{i}}B_{i}$（传播）。对于一个全加器，进位递归关系是\n$$c_{i+1} = g_{i} + p_{i}c_{i}$$\n通过迭代，\n$$c_{4} = g_{3} + p_{3}g_{2} + p_{3}p_{2}g_{1} + p_{3}p_{2}p_{1}g_{0} + p_{3}p_{2}p_{1}p_{0}c_{0}$$\n定义组生成和组传播\n$$G \\equiv g_{3} + p_{3}g_{2} + p_{3}p_{2}g_{1} + p_{3}p_{2}p_{1}g_{0}, \\quad P \\equiv p_{3}p_{2}p_{1}p_{0}$$\n这样\n$$c_{4} = G + P c_{0}$$\n最终进位输出$c_{4}$与$c_{0}$无关，当且仅当$c_{0}$的系数对所有输入都为零，即$P=0$，或者（在这种情况下逻辑上等价）如果$G=1$使得无论$c_{0}$为何值，$c_{4}$都强制为1。然而，当$P=1$（所有四级都传播）时，每个$g_{i}=0$，所以$G=0$。因此，无关性条件简化为\n$$D = \\overline{P} = \\overline{p_{3}p_{2}p_{1}p_{0}}$$\n将$p_{i}$仅用$A_{i},B_{i}$表示，并应用德摩根定律，得到\n$$\\overline{p_{i}} = \\overline{A_{i}\\overline{B_{i}} + \\overline{A_{i}}B_{i}} = (A_{i} + \\overline{B_{i}})(\\overline{A_{i}} + B_{i}) = A_{i}B_{i} + \\overline{A_{i}}\\overline{B_{i}}$$\n因此，\n$$D = \\overline{p_{3}} + \\overline{p_{2}} + \\overline{p_{1}} + \\overline{p_{0}} = (A_{3}B_{3} + \\overline{A_{3}}\\overline{B_{3}}) + (A_{2}B_{2} + \\overline{A_{2}}\\overline{B_{2}}) + (A_{1}B_{1} + \\overline{A_{1}}\\overline{B_{1}}) + (A_{0}B_{0} + \\overline{A_{0}}\\overline{B_{0}})$$\n这个$D$等于逻辑1，当且仅当不是所有四个级都传播时，即当且仅当$c_{4}$与$c_{0}$无关时。", "answer": "$$\\boxed{(A_{3}B_{3}+\\overline{A_{3}}\\overline{B_{3}})+(A_{2}B_{2}+\\overline{A_{2}}\\overline{B_{2}})+(A_{1}B_{1}+\\overline{A_{1}}\\overline{B_{1}})+(A_{0}B_{0}+\\overline{A_{0}}\\overline{B_{0}})}$$", "id": "1917960"}]}