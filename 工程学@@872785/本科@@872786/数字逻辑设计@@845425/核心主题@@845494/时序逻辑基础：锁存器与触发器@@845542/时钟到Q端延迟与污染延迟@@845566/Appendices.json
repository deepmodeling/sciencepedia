{"hands_on_practices": [{"introduction": "在分析复杂的数字电路之前，我们必须首先理解如何确定单个基本元件的时序参数。本练习提供了一个从实验数据中测量时钟到Q端污染延迟（$t_{ccq}$）的实践场景，将理论定义与实际元件特性表征联系起来。通过这个练习，你将学会区分信号*开始*变化的时刻（与 $t_{ccq}$ 相关）和信号完全稳定的时刻（与传播延迟 $t_{pcq}$ 相关）。", "problem": "一位数字系统工程师正在测定一个定制设计的上升沿触发D型触发器的时序参数。数据输入D稳定保持在逻辑“1”状态，而触发器的输出Q初始处于逻辑“0”状态。工程师使用高精度示波器记录了围绕时钟信号CLK的单个上升沿发生的事件的时序。\n\n测量结果如下：\n- CLK信号的上升沿精确地发生在时间 $t_{clk} = 12.350$ 纳秒 (ns)。\n- 在时钟沿之后，输出Q开始从逻辑“0”向逻辑“1”转换。这一转换开始的瞬间，即输出不再保证为其旧值的时刻，被测量为 $t_{start} = 12.485$ ns。\n- 输出Q被测量到在时间 $t_{stable} = 12.710$ ns 时，在新的逻辑“1”状态完全建立并稳定。\n\n根据这些实验测量结果，确定该触发器的时钟到Q端的污染延迟 ($t_{ccq}$)。请以皮秒 (ps) 为单位表示你的答案。", "solution": "时钟到Q端的污染延迟定义为有效时钟沿之后，输出 $Q$ 可能开始偏离其先前值的最早时间点。因此，\n$$t_{ccq} = t_{start} - t_{clk}.$$\n使用测量得到的时间，\n$$t_{ccq} = 12.485\\ \\text{ns} - 12.350\\ \\text{ns} = 0.135\\ \\text{ns}.$$\n使用 $1\\ \\text{ns} = 10^{3}\\ \\text{ps}$ 将纳秒转换为皮秒，\n$$t_{ccq} = 0.135\\ \\text{ns} \\times \\frac{10^{3}\\ \\text{ps}}{1\\ \\text{ns}} = 135\\ \\text{ps}.$$", "answer": "$$\\boxed{135}$$", "id": "1921462"}, {"introduction": "理解了基本参数的测量后，让我们来看一个实际应用。污染延迟在时序分析中最重要的作用之一是防止保持时间违例，这种违例可能导致灾难性的电路故障。这个练习 [@problem_id:1921437] 模拟了一个常见的设计挑战：由于污染延迟过短和时钟偏斜，数据路径“过快”从而导致了保持时间违例。本题将引导你完成计算所需额外延迟并插入缓冲器来修复违例的整个过程，这是一种标准的工业界设计技术。", "problem": "在一个同步数字电路中，数据通过一个组合逻辑块从源触发器（FF1）传输到目标触发器（FF2）。两个触发器都是上升沿触发，并由相同的时钟源驱动。然而，由于时钟分配网络中的差异，它们之间存在时钟偏斜。\n\n该电路的相关时序参数如下：\n- 从源触发器（FF1）的时钟输入到 Q 输出的污染延迟为 $t_{cd,FF1} = 115 \\text{ ps}$。\n- 通过组合逻辑块的最小路径延迟（污染延迟）为 $t_{cd,logic} = 140 \\text{ ps}$。\n- 目标触发器（FF2）的保持时间要求为 $t_{hold} = 380 \\text{ ps}$。\n- 时钟信号到达目标触发器（FF2）的时间比到达源触发器（FF1）的时间*晚* $t_{skew} = 75 \\text{ ps}$。\n\n分析表明，这种配置会导致保持时间违例。为了纠正此问题，将在组合逻辑和 FF2 之间的数据路径中串联插入若干个相同的同相缓冲器。每个缓冲器的污染延迟为 $t_{cd,buf} = 55 \\text{ ps}$。\n\n确定为解决保持时间违例问题所需插入的最小整数缓冲器数量 $N$。", "solution": "该问题要求计算修复同步电路中保持时间违例所需的最小缓冲器数量。\n\n首先，我们必须建立电路的保持时间约束。保持时间约束确保目标触发器（FF2）输入端的数据在时钟沿到达后能保持稳定一定时间（$t_{hold}$）。数据在源触发器（FF1）的时钟沿之后开始变化，并沿着数据路径传播。这个变化必须在 FF2 的保持时间窗口结束之前不能到达其输入端。\n\n让我们将时钟到达 FF1 的时间记为 $T_{C1}$，到达 FF2 的时间记为 $T_{C2}$。\nFF2 输入端的数据必须保持稳定直到时间 $T_{C2} + t_{hold}$。\n来自 FF1 的数据在 $T_{C1}$ 时钟沿之后开始变化并沿着路径传播。新数据能够到达 FF2 输入端的最早时间是数据路径上所有污染延迟的总和。\n新数据到达 FF2 输入端的最早时间是 $T_{C1} + t_{cd,FF1} + t_{cd,logic}$。\n\n如果新数据到达的最早时间晚于保持时间窗口关闭的时间，那么保持时间条件就得到满足：\n$$T_{C1} + t_{cd,FF1} + t_{cd,logic} \\ge T_{C2} + t_{hold}$$\n\n时钟偏斜 $t_{skew}$ 指的是 FF2 的时钟比 FF1 的时钟晚到的时间。这意味着 $T_{C2} = T_{C1} + t_{skew}$。将此代入不等式：\n$$T_{C1} + t_{cd,FF1} + t_{cd,logic} \\ge (T_{C1} + t_{skew}) + t_{hold}$$\n\n通过消去两侧的 $T_{C1}$ 来简化，我们得到了此场景下的通用保持时间约束：\n$$t_{cd,FF1} + t_{cd,logic} \\ge t_{hold} + t_{skew}$$\n\n让我们使用给定的参数检查电路的初始状态：\n- 数据路径的总污染延迟，$t_{cd,path} = t_{cd,FF1} + t_{cd,logic} = 115 \\text{ ps} + 140 \\text{ ps} = 255 \\text{ ps}$。\n- 要求数据保持稳定的时间，$t_{required} = t_{hold} + t_{skew} = 380 \\text{ ps} + 75 \\text{ ps} = 455 \\text{ ps}$。\n\n现在我们检查约束 $t_{cd,path} \\ge t_{required}$ 是否满足：\n$$255 \\text{ ps} \\ge 455 \\text{ ps}$$\n这个不等式不成立，这证实了存在保持时间违例。保持时间裕量为 $Slack_{hold} = 255 \\text{ ps} - 455 \\text{ ps} = -200 \\text{ ps}$。违例的量值为 $200 \\text{ ps}$。这意味着数据路径太快，我们需要增加至少 $200 \\text{ ps}$ 的延迟。\n\n为了解决这个问题，我们在数据路径中插入 $N$ 个缓冲器。每个缓冲器增加 $t_{cd,buf}$ 的污染延迟。新的数据路径总污染延迟 $t'_{cd,path}$ 变为：\n$$t'_{cd,path} = t_{cd,FF1} + t_{cd,logic} + N \\times t_{cd,buf}$$\n\n新的保持时间约束是：\n$$t'_{cd,path} \\ge t_{hold} + t_{skew}$$\n代入新路径延迟的表达式：\n$$t_{cd,FF1} + t_{cd,logic} + N \\times t_{cd,buf} \\ge t_{hold} + t_{skew}$$\n\n我们需要找到满足这个不等式的最小整数 $N$。我们可以重新整理不等式来求解 $N$：\n$$N \\times t_{cd,buf} \\ge (t_{hold} + t_{skew}) - (t_{cd,FF1} + t_{cd,logic})$$\n$$N \\ge \\frac{(t_{hold} + t_{skew}) - (t_{cd,FF1} + t_{cd,logic})}{t_{cd,buf}}$$\n\n代入数值：\n$$N \\ge \\frac{(380 \\text{ ps} + 75 \\text{ ps}) - (115 \\text{ ps} + 140 \\text{ ps})}{55 \\text{ ps}}$$\n$$N \\ge \\frac{455 \\text{ ps} - 255 \\text{ ps}}{55 \\text{ ps}}$$\n$$N \\ge \\frac{200 \\text{ ps}}{55 \\text{ ps}}$$\n$$N \\ge 3.6363...$$\n\n由于缓冲器的数量 $N$ 必须是整数，我们需要找到大于或等于 $3.6363...$ 的最小整数。这可以通过对该值取上整来实现。\n$$N_{min} = \\lceil 3.6363... \\rceil = 4$$\n\n因此，必须插入最少 4 个缓冲器来修复保持时间违例。\n让我们验证这个答案。当 $N=4$ 时，增加的延迟为 $4 \\times 55 \\text{ ps} = 220 \\text{ ps}$。\n新的路径污染延迟为 $t'_{cd,path} = 255 \\text{ ps} + 220 \\text{ ps} = 475 \\text{ ps}$。\n需要检查的条件是 $t'_{cd,path} \\ge t_{hold} + t_{skew}$：\n$$475 \\text{ ps} \\ge 455 \\text{ ps}$$\n这个条件成立，所以使用 4 个缓冲器解决了违例问题。如果使用 3 个缓冲器，增加的延迟将是 $3 \\times 55 = 165$ ps，总路径延迟为 $255 + 165 = 420$ ps，小于所要求的 455 ps。因此，3 个缓冲器是不够的。", "answer": "$$\\boxed{4}$$", "id": "1921437"}, {"introduction": "最后，我们将通过一个综合性分析来收尾，这个分析过程反映了真实世界中数字系统的设计流程。这最后一个练习 [@problem_id:1921488] 集成了所有核心时序参数——传播延迟（$t_{pcq}$）、污染延迟（$t_{ccq}$）、建立时间（$t_{setup}$）和保持时间（$t_{hold}$）——来确定一个同步流水线的最高性能。通过分析多条时序路径，你将学习如何识别限制时钟频率的关键路径，并确保整个电路能够可靠地运行。", "problem": "正在设计一款定制数字信号处理器（DSP）芯片中的一个专用处理单元。该单元的核心由一个带反馈环路的两级同步流水线组成。第一级是一个触发器 FF1，第二级是一个触发器 FF2。FF1 的输出连接到组合逻辑块 Logic1 的输入，其输出再馈入 FF2 的输入。FF2 的输出连接到第二个组合逻辑块 Logic2 的输入，后者再反馈回 FF1 的输入，形成闭环。\n\n所有触发器都是相同的上升沿触发 D 型触发器，具有以下时序特性：\n- 建立时间, $t_{setup} = 60 \\text{ ps}$\n- 保持时间, $t_{hold} = 35 \\text{ ps}$\n- 传播延迟 (时钟到 Q), $t_{pcq} = 80 \\text{ ps}$\n- 污染延迟 (时钟到 Q), $t_{ccq} = 45 \\text{ ps}$\n\n两个组合逻辑块具有以下延迟特性：\n- 逻辑块 1 (在 FF1 和 FF2 之间):\n  - 最大传播延迟, $t_{comb1,max} = 350 \\text{ ps}$\n  - 最小污染延迟, $t_{comb1,min} = 150 \\text{ ps}$\n- 逻辑块 2 (在 FF2 和 FF1 之间):\n  - 最大传播延迟, $t_{comb2,max} = 200 \\text{ ps}$\n  - 最小污染延迟, $t_{comb2,min} = 120 \\text{ ps}$\n\n为确保可靠运行，电路时序必须满足所有路径上的建立时间和保持时间约束。计算该电路可能的最大时钟频率。答案以千兆赫兹（GHz）为单位，并四舍五入到三位有效数字。", "solution": "我们分析两个寄存器到寄存器路径的同步时序约束，并从最严格的建立时间约束中确定最大时钟频率，同时确保满足保持时间约束。所有触发器都相同，并在同一个上升沿被触发，且未指定时钟偏斜，因此我们假设时钟偏斜为零。\n\n对于从发送触发器到捕获触发器的路径，建立时间约束为\n$$\nT \\geq t_{pcq} + t_{comb,\\max} + t_{setup}.\n$$\n保持时间约束为\n$$\nt_{ccq} + t_{comb,\\min} \\geq t_{hold}.\n$$\n\n有两条路径：\n\n1) 路径 FF1 → Logic1 → FF2：\n- 建立时间约束：\n$$\nT \\geq t_{pcq} + t_{comb1,\\max} + t_{setup} = 80\\,\\text{ps} + 350\\,\\text{ps} + 60\\,\\text{ps} = 490\\,\\text{ps}.\n$$\n- 保持时间约束：\n$$\nt_{ccq} + t_{comb1,\\min} = 45\\,\\text{ps} + 150\\,\\text{ps} = 195\\,\\text{ps} \\geq 35\\,\\text{ps},\n$$\n该约束得到满足。\n\n2) 路径 FF2 → Logic2 → FF1：\n- 建立时间约束：\n$$\nT \\geq t_{pcq} + t_{comb2,\\max} + t_{setup} = 80\\,\\text{ps} + 200\\,\\text{ps} + 60\\,\\text{ps} = 340\\,\\text{ps}.\n$$\n- 保持时间约束：\n$$\nt_{ccq} + t_{comb2,\\min} = 45\\,\\text{ps} + 120\\,\\text{ps} = 165\\,\\text{ps} \\geq 35\\,\\text{ps},\n$$\n该约束得到满足。\n\n所需的最小周期是所有路径中建立时间约束的最大值：\n$$\nT_{\\min} = \\max\\{490\\,\\text{ps},\\,340\\,\\text{ps}\\} = 490\\,\\text{ps}.\n$$\n因此，最大时钟频率为\n$$\nf_{\\max} = \\frac{1}{T_{\\min}} = \\frac{1}{490\\,\\text{ps}} = \\frac{10^{12}}{490}\\,\\text{Hz} \\approx 2.04\\,\\text{GHz}.\n$$\n以千兆赫兹为单位，四舍五入到三位有效数字，其值为 $2.04$。", "answer": "$$\\boxed{2.04}$$", "id": "1921488"}]}