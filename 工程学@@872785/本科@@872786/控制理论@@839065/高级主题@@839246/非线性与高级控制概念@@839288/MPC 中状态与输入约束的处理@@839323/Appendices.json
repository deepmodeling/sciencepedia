{"hands_on_practices": [{"introduction": "在模型预测控制（MPC）中，首要任务是将系统的物理限制转化为优化求解器能够理解的数学语言。本练习将关注一种常见且重要的约束类型：控制输入的变化率约束，这对于确保执行器的平稳运行和减少磨损至关重要。通过这个练习，你将亲手实践如何将一个随时间变化的系列不等式，转化为 MPC 求解器所要求的标准矩阵形式 [@problem_id:1579671]。", "problem": "一位工程师正在为四旋翼飞行器开发一个控制器，该控制器使用模型预测控制（MPC），这是一种在未来时间区间内优化控制行为的策略。为确保平稳稳定的飞行，限制电机推力增加的速度至关重要。\n\n工程师考虑的预测时域为 $N=3$。在当前时间 $t$ 待确定的未来控制输入（电机推力指令）序列由向量 $U = [u_0, u_1, u_2]^T$ 表示，其中 $u_k$ 代表在时间步 $t+k$ 的控制输入。在前一个时间步 $t-1$ 施加的控制输入是已知的，并表示为 $u_{t-1}$。\n\n对电机推力增长率的约束由以下不等式给出：\n$$u(k) - u(k-1) \\leq \\Delta u_{\\max}$$\n其中 $\\Delta u_{\\max}$ 是一个正的常数，表示连续时间步之间允许的最大推力增量。该约束必须在预测时域内的每一步都成立。\n\n为了在标准的二次规划求解器中使用，这组线性不等式必须转换为矩阵形式 $A_{\\text{rate}} U \\leq b_{\\text{rate}}$。\n\n你的任务是确定增广矩阵 $M = [A_{\\text{rate}} | b_{\\text{rate}}]$，该矩阵表示给定预测时域下这整套速率约束。竖线表示矩阵增广。用 $\\Delta u_{\\max}$ 和 $u_{t-1}$ 表示你的答案。", "solution": "目标是将预测时域为 $N=3$ 的输入变化率约束集表示为矩阵形式 $A_{\\text{rate}} U \\leq b_{\\text{rate}}$，然后找出相应的增广矩阵 $M = [A_{\\text{rate}} | b_{\\text{rate}}]$。\n\n决策变量向量是时域内的未来控制输入序列：\n$$U = \\begin{pmatrix} u_0 \\\\ u_1 \\\\ u_2 \\end{pmatrix}$$\n增长率的约束由 $u(k) - u(k-1) \\leq \\Delta u_{\\max}$ 给出。我们必须将此约束应用于预测时域中的每一步，从第一个未来步骤（$k=0$）到最后一个（$k=N-1=2$）。\n\n**步骤1：展开每个时间步的约束。**\n\n对于时域中的第一个时间步（$k=0$）：\n控制输入为 $u_0$。前一个控制输入是在时间 $t-1$ 施加的，即已知值 $u_{t-1}$。\n约束为：\n$$u_0 - u_{t-1} \\leq \\Delta u_{\\max}$$\n\n对于时域中的第二个时间步（$k=1$）：\n控制输入为 $u_1$。时域内的前一个控制输入是 $u_0$。\n约束为：\n$$u_1 - u_0 \\leq \\Delta u_{\\max}$$\n\n对于时域中的第三个时间步（$k=2$）：\n控制输入为 $u_2$。时域内的前一个控制输入是 $u_1$。\n约束为：\n$$u_2 - u_1 \\leq \\Delta u_{\\max}$$\n\n**步骤2：将不等式重新整理成标准形式。**\n\n我们需要整理每个不等式，使涉及决策变量（$u_0, u_1, u_2$）的项位于左侧，而常数和已知值位于右侧。\n\n第一个不等式 $u_0 - u_{t-1} \\leq \\Delta u_{\\max}$ 变为：\n$$u_0 \\leq \\Delta u_{\\max} + u_{t-1}$$\n用完整向量 $U$ 来表示：\n$$(1)u_0 + (0)u_1 + (0)u_2 \\leq \\Delta u_{\\max} + u_{t-1}$$\n\n第二个不等式 $u_1 - u_0 \\leq \\Delta u_{\\max}$ 已经是合适的形式。\n用完整向量 $U$ 来表示：\n$$(-1)u_0 + (1)u_1 + (0)u_2 \\leq \\Delta u_{\\max}$$\n\n第三个不等式 $u_2 - u_1 \\leq \\Delta u_{\\max}$ 也已经是合适的形式。\n用完整向量 $U$ 来表示：\n$$(0)u_0 + (-1)u_1 + (1)u_2 \\leq \\Delta u_{\\max}$$\n\n**步骤3：构造矩阵 $A_{\\text{rate}}$ 和 $b_{\\text{rate}}$。**\n\n现在我们可以将这三个不等式组合成矩阵方程 $A_{\\text{rate}} U \\leq b_{\\text{rate}}$。矩阵 $A_{\\text{rate}}$ 由每个不等式中 $u_0, u_1, u_2$ 的系数构成，向量 $b_{\\text{rate}}$ 由右侧的值构成。\n\n$$\n\\begin{pmatrix}\n1  & 0  & 0 \\\\\n-1 & 1  & 0 \\\\\n0  & -1 & 1\n\\end{pmatrix}\n\\begin{pmatrix}\nu_0 \\\\\nu_1 \\\\\nu_2\n\\end{pmatrix}\n\\leq\n\\begin{pmatrix}\n\\Delta u_{\\max} + u_{t-1} \\\\\n\\Delta u_{\\max} \\\\\n\\Delta u_{\\max}\n\\end{pmatrix}\n$$\n\n由此，我们可以确定：\n$$A_{\\text{rate}} = \\begin{pmatrix} 1  & 0  & 0 \\\\ -1 & 1  & 0 \\\\ 0  & -1 & 1 \\end{pmatrix}$$\n$$b_{\\text{rate}} = \\begin{pmatrix} \\Delta u_{\\max} + u_{t-1} \\\\ \\Delta u_{\\max} \\\\ \\Delta u_{\\max} \\end{pmatrix}$$\n\n**步骤4：构造增广矩阵 $M$。**\n\n最后一步是构造增广矩阵 $M = [A_{\\text{rate}} | b_{\\text{rate}}]$，方法是将向量 $b_{\\text{rate}}$ 作为最后一列放置在矩阵 $A_{\\text{rate}}$ 旁边。\n\n$$M = [A_{\\text{rate}} | b_{\\text{rate}}] = \\begin{pmatrix} 1 & 0 & 0 & \\Delta u_{\\max} + u_{t-1} \\\\ -1 & 1 & 0 & \\Delta u_{\\max} \\\\ 0 & -1 & 1 & \\Delta u_{\\max} \\end{pmatrix}$$\n这就是所求的增广矩阵。", "answer": "$$\\boxed{\\begin{pmatrix} 1 & 0 & 0 & \\Delta u_{\\max} + u_{t-1} \\\\ -1 & 1 & 0 & \\Delta u_{\\max} \\\\ 0 & -1 & 1 & \\Delta u_{\\max} \\end{pmatrix}}$$", "id": "1579671"}, {"introduction": "在学习了如何构建约束之后，我们现在探讨一个由此产生的关键问题：可行性。这个思想实验揭示了，即使我们拥有全部的控制权限，满足状态约束也并非总是可能，它可能完全取决于系统的初始状态 [@problem_id:1579647]。理解这一概念对于设计不会意外失效的鲁棒 MPC 控制器至关重要。", "problem": "一名工程师的任务是为一个安全关键系统设计控制器。该系统的状态 $x(k)$ 在离散时间步 $k$ 上根据以下线性方程演化：\n$$x(k+1) = \\alpha x(k) + \\beta u(k)$$\n系统参数给定为 $\\alpha = 0.5$ 和 $\\beta = 1$。控制器施加的控制输入 $u(k)$ 受到物理约束的限制，即 $|u(k)| \\le u_{\\max}$，其中 $u_{\\max} = 1$。\n\n一项关键的操作要求是，系统状态必须在一段有限时间内保持在某个最小阈值之上。具体来说，在时间步 $k = 1, 2, 3, 4$，状态 $x(k)$ 必须满足约束 $x(k) \\ge x_{\\min}$。最小阈值指定为 $x_{\\min} = 2.5$。请注意，此状态约束不适用于初始状态 $x(0)$。\n\n您的任务是确定初始状态 $x(0)$ 的最小可能值，使得存在一个有效的控制序列 $u(0), u(1), u(2), u(3)$，能够在该要求的时间段内成功地将系统状态维持在指定的约束范围内。请以单个数值形式提供答案。", "solution": "我们给定线性时不变离散时间系统 $x(k+1)=\\alpha x(k)+\\beta u(k)$，其中 $\\alpha=\\frac{1}{2}$，$\\beta=1$，且输入约束为 $|u(k)|\\leq u_{\\max}$，其中 $u_{\\max}=1$。状态必须在 $k=1,2,3,4$ 时满足 $x(k)\\geq x_{\\min}$，其中 $x_{\\min}=\\frac{5}{2}$。初始状态 $x(0)$ 不受约束，我们寻求最小的 $x(0)$，使得存在一个序列 $u(0),u(1),u(2),u(3)$，该序列满足输入边界条件并在 $k=1,2,3,4$ 时保持 $x(k)\\geq \\frac{5}{2}$。\n\n在时间 $k$ 的状态是 $x(0)$ 和输入的函数：\n$$\nx(k)=\\alpha^{k}x(0)+\\sum_{i=0}^{k-1}\\alpha^{k-1-i}\\beta\\,u(i).\n$$\n由于 $\\alpha>0$ 且 $\\beta>0$，所以 $x(k)$ 对于每个 $u(i)$ 都是递增的。因此，为了在给定 $x(0)$ 的情况下最大化 $x(k)$，我们为所有 $i$ 选择 $u(i)=u_{\\max}=1$。这个选择使得满足下限约束所需的 $x(0)$ 最小化。\n\n当 $u(i)=1$ 且 $\\alpha=\\frac{1}{2}$ 时, 我们得到\n$$\nx(k)=\\left(\\frac{1}{2}\\right)^{k}x(0)+\\sum_{j=0}^{k-1}\\left(\\frac{1}{2}\\right)^{j}\n=\\left(\\frac{1}{2}\\right)^{k}x(0)+\\frac{1-\\left(\\frac{1}{2}\\right)^{k}}{1-\\frac{1}{2}}\n=\\left(\\frac{1}{2}\\right)^{k}x(0)+2-2^{1-k}.\n$$\n对 $k=1,2,3,4$ 施加约束 $x(k)\\geq \\frac{5}{2}$，可得\n$$\n\\left(\\frac{1}{2}\\right)^{k}x(0)+2-2^{1-k}\\geq \\frac{5}{2}\n\\;\\;\\Longleftrightarrow\\;\\;\n\\left(\\frac{1}{2}\\right)^{k}x(0)\\geq \\frac{1}{2}+2^{1-k}\n\\;\\;\\Longleftrightarrow\\;\\;\nx(0)\\geq 2^{k-1}+2.\n$$\n因此，对 $x(0)$ 的约束集是\n$$\nx(0)\\geq 2^{k-1}+2 \\quad \\text{for } k=1,2,3,4,\n$$\n即\n$$\nx(0)\\geq 3,\\quad x(0)\\geq 4,\\quad x(0)\\geq 6,\\quad x(0)\\geq 10.\n$$\n最严格的要求是 $x(0)\\geq 10$。选择 $x(0)=10$ 并且对 $k=0,1,2,3$ 取 $u(k)=1$，可以得到 $x(1),x(2),x(3),x(4)\\geq \\frac{5}{2}$，其中 $x(4)$ 恰好等于 $\\frac{5}{2}$。因此，最小的可行初始状态是 $10$。", "answer": "$$\\boxed{10}$$", "id": "1579647"}, {"introduction": "认识到硬约束可能导致 MPC 问题无解之后 [@problem_id:1579647]，我们现在转向一种实用的解决方案：软约束。本练习探讨了如何通过在成本函数中引入“松弛”变量和惩罚项，使控制器能够优雅地处理那些可能暂时违反约束的情况。这里的关键是理解如何调整惩罚权重，因为它直接关系到严格遵守约束与其他控制目标（如跟踪精度和能耗）之间的权衡 [@problem_id:1579686]。", "problem": "一个模型预测控制（MPC）系统被设计用于调节大型数据中心中服务器的温度。其主要目标是使服务器的核心温度 $T(t)$ 尽可能接近目标温度 $T_{target}$。为防止硬件损坏，存在一个关键的操作约束，即温度不得超过最大值 $T_{max}$。\n\n为了增强鲁棒性并防止在无法找到满足所有约束的解（即避免不可行性）时控制器失效，这个温度上限被实现为一个软约束。该约束在数学上表示为 $T(t) \\le T_{max} + \\epsilon(t)$，其中 $\\epsilon(t) \\ge 0$ 是一个非负的松弛变量，用于量化违背约束的程度。\n\nMPC的成本函数，即控制器在预测时域 $N$ 内寻求最小化的函数，包含一个惩罚这种违背的项：\n$$J = \\sum_{k=0}^{N-1} \\left( (T(t+k|t) - T_{target})^2 + \\gamma u(t+k|t)^2 \\right) + \\rho \\epsilon(t)^2$$\n在这个方程中，$u(t)$ 是控制作用（例如，风扇速度），$\\gamma$ 是控制努力的常数权重，而 $\\rho > 0$ 是与松弛变量相关的惩罚权重。\n\n下列哪个陈述最准确地描述了惩罚权重 $\\rho$ 的选择对温度控制系统行为的定性影响？\n\nA. 一个非常大的 $\\rho$ 会使软约束的行为类似于硬约束，严格执行 $T \\le T_{max}$，但可能导致激进、高能耗的控制动作。一个非常小的 $\\rho$ 会使控制器变得宽容，如果这样做能降低控制努力或更好地跟踪 $T_{target}$，则常会允许温度超过 $T_{max}$。\n\nB. 一个非常大的 $\\rho$ 会使控制器变得宽容，允许频繁的温度违规，而一个非常小的 $\\rho$ 则会严格执行约束，其行为几乎等同于硬约束。\n\nC. $\\rho$ 的值对温度约束是否被违背没有显著影响；其主要作用是确保优化问题能被标准的二次规划求解器解决。\n\nD. 一个非常大的 $\\rho$ 总是更可取的，因为它保证温度永远不会超过 $T_{max}$，而一个非常小的 $\\rho$ 总会导致系统不稳定和热失控。\n\nE. 选择一个非常小的 $\\rho$ 是最优的，因为它最小化了总成本函数 $J$ 并保证了最平滑的控制动作，而一个非常大的 $\\rho$ 则增加了MPC优化问题变得不可行的风险。", "solution": "我们考虑最小化成本的MPC问题\n$$J=\\sum_{k=0}^{N-1}\\left( \\left(T(t+k|t)-T_{target}\\right)^{2}+\\gamma\\, u(t+k|t)^{2}\\right)+\\rho\\, \\epsilon(t)^{2}$$\n其约束条件为温度的软约束和松弛变量的非负性：\n$T(t+k|t)\\leq T_{max}+\\epsilon(t)$, $\\epsilon(t)\\geq 0,$\n以及系统动力学和任何输入约束。惩罚权重 $\\rho>0$ 乘以松弛变量 $\\epsilon(t)$ 上的二次惩罚项，该松弛变量衡量了温度上限被放宽了多少。\n\n为了分析 $\\rho$ 的定性影响，我们考察关于松弛变量的KKT条件。为约束 $T(t+k|t)-T_{max}-\\epsilon(t)\\leq 0$ 引入拉格朗日乘子 $\\mu_{k}\\geq 0$，为约束 $-\\epsilon(t)\\leq 0$ 引入拉格朗日乘子 $\\nu\\geq 0$。拉格朗日函数中依赖于 $\\epsilon(t)$ 的部分是\n$$\\mathcal{L}_{\\epsilon}=\\rho\\, \\epsilon(t)^{2}+\\sum_{k=0}^{N-1}\\mu_{k}\\left(T(t+k|t)-T_{max}-\\epsilon(t)\\right)+\\nu\\left(-\\epsilon(t)\\right).$$\n关于 $\\epsilon(t)$ 的平稳性条件是\n$$\\frac{\\partial \\mathcal{L}_{\\epsilon}}{\\partial \\epsilon(t)}=2\\rho\\, \\epsilon(t)-\\sum_{k=0}^{N-1}\\mu_{k}-\\nu=0.$$\n互补松弛条件是\n$$\\mu_{k}\\left(T(t+k|t)-T_{max}-\\epsilon(t)\\right)=0\\quad \\text{for all }k,\\qquad \\nu\\, \\epsilon(t)=0.$$\n从平稳性条件可知，对于固定的乘子 $\\mu_{k}$ 和 $\\nu$，增加 $\\rho$ 会迫使 $\\epsilon(t)$ 减小，因为 $2\\rho\\, \\epsilon(t)$ 必须平衡非负和 $\\sum_{k}\\mu_{k}+\\nu$。在极限 $\\rho\\to \\infty$ 的情况下，任何正的 $\\epsilon(t)$ 都会变得代价极高，因此优化器将选择控制动作 $u(t+k|t)$ 和跟踪妥协 $T(t+k|t)$ 来使 $\\epsilon(t)$ 尽可能小，理想情况下，只要硬约束在动态上是可行的，就使 $\\epsilon(t)=0$。这使得软约束在MPC中常用的定性意义上表现得像一个硬约束：强烈不鼓励违背约束，只有在硬约束问题动态不可行时才会发生。\n\n相反，当 $\\rho\\to 0^{+}$ 时，松弛惩罚项从目标函数中消失，因此只要这样做能减少跟踪误差项 $(T(t+k|t)-T_{target})^{2}$ 或控制努力 $\\gamma\\, u(t+k|t)^{2}$，优化器就倾向于使用 $\\epsilon(t)>0$。这使得控制器对于违背温度上限变得宽容，接受温度超过 $T_{max}$ 以实现更低的控制努力或更好的设定点跟踪。\n\n关于控制的激进性，当 $\\rho$ 很大时，优化器通过从下方强制执行 $T(t+k|t)\\approx T_{max}$ 来避免松弛，这通常需要更大的控制动作 $u(t+k|t)$ 来抑制扰动或使温度远离边界。这倾向于增加控制能量项 $\\gamma \\sum u(t+k|t)^{2}$，导致更激进的控制。当 $\\rho$ 很小时，优化器可以接受温度违规而不是消耗控制努力，通常会产生更平滑、能量更低的输入，但违规会更频繁或更严重。\n\n评估这些陈述：\nA. 这与分析相符：一个非常大的 $\\rho$ 会使软约束在实践中表现得像一个硬约束（取决于动态可行性），通常以更高的控制努力为代价；一个非常小的 $\\rho$ 如果有助于跟踪或减少努力，则会使违规更有可能发生。\nB. 这颠倒了大 $\\rho$ 和小 $\\rho$ 的作用，是错误的。\nC. 这是错误的，因为 $\\rho$ 直接调整了约束违背与其他成本之间的权衡；它显著影响违规是否发生。\nD. 这是错误的，因为如果硬约束问题在动态上不可行，一个非常大的 $\\rho$ 也无法保证零违规，并且它本身并不意味着小 $\\rho$ 会导致不稳定。\nE. 这是错误的，因为一旦考虑了全部权衡，选择一个非常小的 $\\rho$ 通常不会最小化 $J$，也不能在所有情况下保证最平滑的控制，并且不会增加不可行的风险；引入软约束是为了保持可行性，而不是危害它。\n\n因此，最准确的定性描述是 A。", "answer": "$$\\boxed{A}$$", "id": "1579686"}]}