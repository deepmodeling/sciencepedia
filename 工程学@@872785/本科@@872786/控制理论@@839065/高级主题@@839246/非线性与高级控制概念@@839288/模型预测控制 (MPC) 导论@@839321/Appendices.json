{"hands_on_practices": [{"introduction": "模型预测控制（MPC）的核心在于其“预测”能力。在决定最佳控制动作之前，控制器必须能够根据系统模型和一系列假设的控制输入，预见系统未来的状态。这个练习将带你实践这一基本步骤，通过一个简单的热力学系统模型，计算在给定恒定控制输入下，系统未来几个时间步的温度变化。[@problem_id:1583625]", "problem": "一位工程师正在为一个大型、隔热良好的腔室开发一种简单的开环控制策略，该腔室的热力学动态可以用一个离散时间线性系统来建模。系统状态是在时间步 $k$ 时，温度与期望设定点的偏差 $T_k$。系统的演化由以下方程描述：\n$$T_{k+1} = T_k + \\beta u_k$$\n其中 $u_k$ 是在时间步 $k$ 时加热元件的控制输入，$\\beta$ 是一个代表系统热增益的常数。\n\n测得初始温度偏差为 $T_0 = 10.0$ 摄氏度。已知热增益为 $\\beta = 0.25$ 摄氏度/加热器单位。为了测试系统响应，工程师决定施加一个恒定的控制序列，即在所有时间步中 $u_k = 8.0$ 加热器单位。\n\n作为设计更高级控制器（如模型预测控制器）的初步步骤，工程师需要预测系统在这种简单控制序列下的未来状态。计算预测时域为三个时间步的预测状态轨迹，该轨迹由温度偏差 $\\{T_1, T_2, T_3\\}$ 组成。\n\n提供轨迹的三个数值，单位为摄氏度。", "solution": "我们已知离散时间线性系统的更新方程\n$$T_{k+1} = T_{k} + \\beta u_{k}。$$\n通过重复代入，时间步 $k$ 的状态可以写成初始条件与累积输入之和：\n$$T_{k} = T_{0} + \\beta \\sum_{i=0}^{k-1} u_{i}。$$\n对于所有 $i$ 都有恒定输入 $u_{i} = u$ 的情况，该式可简化为\n$$T_{k} = T_{0} + k \\beta u。$$\n\n代入给定值 $T_{0} = 10.0$，$\\beta = 0.25$ 和 $u = 8.0$，首先计算每一步的增量：\n$$\\beta u = 0.25 \\times 8.0 = 2.0。$$\n因此，\n$$T_{1} = 10.0 + 1 \\times 2.0 = 12.0,$$\n$$T_{2} = 10.0 + 2 \\times 2.0 = 14.0,$$\n$$T_{3} = 10.0 + 3 \\times 2.0 = 16.0。$$\n因此，预测轨迹 $\\{T_{1}, T_{2}, T_{3}\\}$ 为 $\\{12.0, 14.0, 16.0\\}$。", "answer": "$$\\boxed{\\begin{pmatrix}12.0 & 14.0 & 16.0\\end{pmatrix}}$$", "id": "1583625"}, {"introduction": "仅仅预测未来是不够的；控制的目标是主动引导未来朝着期望的方向发展。模型预测控制通过优化一个成本函数来实现这一目标，该函数量化了控制性能的好坏。在这个练习中，你将为一个卫星电池充电模型计算最优控制输入，目标是在最小化控制能耗的同时，使电池状态在预测期末尽可能接近理想值。[@problem_id:1583584]", "problem": "描述卫星电池荷电状态（SoC）偏差的简化模型由以下离散时间线性系统给出：\n$$x_{k+1} = a x_k + b u_k$$\n其中，$x_k$ 是在时间步 $k$ 时与标称 SoC 的偏差（以百分点计），$u_k$ 是在区间 $[k, k+1)$ 内施加的控制作用（与充电/放电电流成比例），单位为控制单位。该系统的特征参数为 $a = 0.8$ 和 $b = 1.0$。\n\n为了调节 SoC，采用了一种模型预测控制（MPC）策略。在当前时间步 $k=0$ 时，控制器在一个长度为 $N=2$ 时间步的预测时域上求解一个优化问题。目标是找到一个控制作用序列 $\\{u_0, u_1\\}$，以最小化成本函数 $J$。该函数惩罚控制能量消耗以及终端状态与期望值零的偏差。成本函数定义为：\n$$J = p_w x_2^2 + \\sum_{j=0}^{1} r_w u_j^2$$\n此处，$x_2$ 是预测时域末端的预测状态偏差。权重因子给定为：控制能量消耗的权重 $r_w = 1.0$，终端状态惩罚的权重 $p_w = 5.0$。\n\n给定初始 SoC 偏差 $x_0 = 10.0$，确定 MPC 控制器将在时间步 $k=0$ 时应用的最优初始控制作用 $u_0$。\n\n您的答案请以控制单位表示，并四舍五入到三位有效数字。", "solution": "系统为 $x_{k+1} = a x_{k} + b u_{k}$，在时域 $N=2$ 上的成本由 $J = p_{w} x_{2}^{2} + \\sum_{j=0}^{1} r_{w} u_{j}^{2}$ 给出。在 $k=0$ 且初始状态为 $x_{0}$ 时，预测的状态为\n$$\nx_{1} = a x_{0} + b u_{0}, \\quad x_{2} = a x_{1} + b u_{1} = a^{2} x_{0} + a b u_{0} + b u_{1}.\n$$\n成本函数变为\n$$\nJ = p_{w}\\left(a^{2} x_{0} + a b u_{0} + b u_{1}\\right)^{2} + r_{w}\\left(u_{0}^{2} + u_{1}^{2}\\right).\n$$\n为了最小化 $J$ 关于 $u_{0}$ 和 $u_{1}$ 的值，将其偏导数设为零。首先，\n$$\n\\frac{\\partial J}{\\partial u_{1}} = 2 p_{w} x_{2} \\frac{\\partial x_{2}}{\\partial u_{1}} + 2 r_{w} u_{1} = 2 p_{w} x_{2} b + 2 r_{w} u_{1} = 0,\n$$\n这得到\n$$\nu_{1} = - \\frac{p_{w} b}{r_{w}} x_{2}.\n$$\n由于 $x_{2} = a^{2} x_{0} + a b u_{0} + b u_{1}$，代入此 $u_{1}$ 以求解用 $x_{0}$ 和 $u_{0}$ 表示的 $u_{1}$：\n$$\nu_{1} = - \\frac{p_{w} b}{r_{w}} \\left(a^{2} x_{0} + a b u_{0} + b u_{1}\\right)\n\\;\\Rightarrow\\;\nu_{1} \\left(1 + \\frac{p_{w} b^{2}}{r_{w}}\\right) = - \\frac{p_{w} b}{r_{w}} \\left(a^{2} x_{0} + a b u_{0}\\right),\n$$\n因此\n$$\nu_{1} = - \\frac{p_{w} b}{r_{w} + p_{w} b^{2}} \\left(a^{2} x_{0} + a b u_{0}\\right).\n$$\n这就得到了用 $x_{0}$ 和 $u_{0}$ 表示的 $x_{2}$：\n$$\nx_{2} = a^{2} x_{0} + a b u_{0} + b u_{1}\n= \\left(1 - \\frac{p_{w} b^{2}}{r_{w} + p_{w} b^{2}}\\right)\\left(a^{2} x_{0} + a b u_{0}\\right)\n= \\frac{r_{w}}{r_{w} + p_{w} b^{2}} \\left(a^{2} x_{0} + a b u_{0}\\right).\n$$\n接下来，\n$$\n\\frac{\\partial J}{\\partial u_{0}} = 2 p_{w} x_{2} \\frac{\\partial x_{2}}{\\partial u_{0}} + 2 r_{w} u_{0}\n= 2 p_{w} x_{2} (a b) + 2 r_{w} u_{0} = 0,\n$$\n所以\n$$\nu_{0} = - \\frac{p_{w} a b}{r_{w}} x_{2}.\n$$\n代入 $x_{2}$ 的表达式：\n$$\nu_{0} = - \\frac{p_{w} a b}{r_{w}} \\cdot \\frac{r_{w}}{r_{w} + p_{w} b^{2}} \\left(a^{2} x_{0} + a b u_{0}\\right)\n= - \\frac{p_{w} a b}{r_{w} + p_{w} b^{2}} \\left(a^{2} x_{0} + a b u_{0}\\right).\n$$\n求解 $u_{0}$：\n$$\nu_{0} \\left(1 + \\frac{p_{w} a^{2} b^{2}}{r_{w} + p_{w} b^{2}}\\right)\n= - \\frac{p_{w} a^{3} b}{r_{w} + p_{w} b^{2}} x_{0}\n\\;\\Rightarrow\\;\nu_{0} = - \\frac{p_{w} a^{3} b}{r_{w} + p_{w} b^{2} + p_{w} a^{2} b^{2}} x_{0}.\n$$\n因此，最优的初始控制作用是\n$$\nu_{0}^{\\star} = - \\frac{p_{w} a^{3} b}{r_{w} + p_{w} b^{2} (1 + a^{2})} x_{0}.\n$$\n代入 $a = 0.8$，$b = 1.0$，$p_{w} = 5.0$，$r_{w} = 1.0$ 和 $x_{0} = 10.0$：\n$$\na^{3} = 0.512, \\quad 1 + a^{2} = 1.64, \\quad r_{w} + p_{w} b^{2} (1 + a^{2}) = 1.0 + 5.0 \\times 1.64 = 9.2,\n$$\n所以\n$$\nu_{0}^{\\star} = - \\frac{5.0 \\times 0.512 \\times 1.0}{9.2} \\times 10.0 = - 2.782608695\\ldots\n$$\n四舍五入到三位有效数字，\n$$\nu_{0}^{\\star} \\approx - 2.78.\n$$", "answer": "$$\\boxed{-2.78}$$", "id": "1583584"}, {"introduction": "在设计MPC控制器时，一个关键的实践环节是“调校”，即调整成本函数中各项的权重，以实现期望的系统行为。这些权重决定了控制器在“紧密跟踪目标”和“节省控制能量”之间的权衡。本题通过一个自动驾驶车道保持系统的对比场景，帮助你建立关于权重如何影响控制策略（是倾向于“激进”还是“平稳”）的直观理解。[@problem_id:1583614]", "problem": "一个汽车工程团队正在为一辆自动驾驶汽车开发车道保持辅助系统。该系统采用模型预测控制（MPC）策略来调节车辆相对于车道中心线的横向位置。MPC的核心是一个成本函数 $J$，该函数在每个时间步被最小化，以确定最优的转向角。对于该系统，成本函数定义为：\n$$J = \\sum_{k=0}^{N-1} (x_k^T Q x_k + u_k^T R u_k)$$\n在这里，$k$ 是长度为 $N$ 的预测时域上的离散时间索引。项 $x_k$ 表示状态误差，主要是车辆与车道中心线的横向偏差。项 $u_k$ 表示控制输入，即指令的转向角变化。为简化初始调试阶段， $Q$ 和 $R$ 是正标量权重因子。大的 $Q$ 会重罚偏离车道中心线的行为，而大的 $R$ 会重罚大或急剧的转向变化。\n\n该团队在一段直路上进行了两次测试运行，Alpha和Beta，使用了不同的权重 $Q$ 和 $R$ 调校。\n\n**情景Alpha：** 控制器进行频繁且激进的转向修正。观察者注意到行驶有些颠簸，但数据显示车辆以非常高的精度跟踪中心线，偏差很少超过几厘米。\n\n**情景Beta：** 控制器进行平稳、柔和的转向调整。据报告，乘坐体验非常舒适。数据显示，在修正过程中，车辆被允许偏离中心线稍远一些，偏差有时会达到几十厘米，然后才被轻柔地引导回来。\n\n根据这些观察结果，哪种情景可能被调校为输入权重 $R$ 相对于状态误差权重 $Q$ 大得多，为什么？\n\nA. 情景Alpha，因为实现高精度跟踪需要一个相对较大的 $R$ 值。\n\nB. 情景Beta，因为一个相对较大的 $R$ 值会迫使控制器在其修正中更具攻击性。\n\nC. 情景Alpha，因为一个相对较大的 $R$ 值会惩罚状态误差，从而导致关注跟踪性能。\n\nD. 情景Beta，因为一个相对较大的 $R$ 值会惩罚控制输入，从而导致更平稳、更保守的动作。\n\nE. 结果与 $R$ 对 $Q$ 的比率无关，主要取决于预测时域 $N$。", "solution": "我们给定一个MPC的阶段成本\n$$J=\\sum_{k=0}^{N-1}\\left(x_{k}^{T}Qx_{k}+u_{k}^{T}Ru_{k}\\right),$$\n在这个调试阶段，$Q>0$ 和 $R>0$ 是标量。优化器在通过施加控制 $u_k$ 来减小状态误差 $x_k$ 与惩罚 $u_k$ 的大小之间进行权衡。较大的 $Q$ 更强调减小 $|x_{k}|$，而较大的 $R$ 更强调保持 $|u_{k}|$ 较小。\n\n为了明确对 $Q$ 和 $R$ 的依赖关系，考虑一个线性预测模型 $x_{k+1}=Ax_{k}+Bu_{k}$ 的标准离散时间线性二次调节器结构。最优的MPC控制律（对于无约束情况）形式为\n$$u_{k}=-Kx_{k},$$\n其中\n$$K=\\left(R+B^{T}PB\\right)^{-1}B^{T}PA,$$\n并且 $P$ 是离散里卡提方程的唯一半正定解\n$$P=Q+A^{T}PA-A^{T}PB\\left(R+B^{T}PB\\right)^{-1}B^{T}PA.$$\n从这些表达式中，可以得出定性依赖关系：\n- 如果 $R$ 增加（$Q$ 固定），那么 $\\left(R+B^{T}PB\\right)^{-1}$ 的量级减小，从而使 $K$ 减小。较小的 $K$ 意味着对于给定的 $|x_k|$，$|u_k|$ 更小，这导致更平滑、更保守的控制动作，并允许在强力修正发生前出现更大的瞬态 $|x_k|$。\n- 如果 $Q$ 增加（$R$ 固定），那么 $P$ 增加，从而使 $K$ 增加。较大的 $K$ 意味着对于给定的 $x_k$，控制 $u_k$ 更具攻击性，能更快地减小 $|x_k|$，但代价是更大、更频繁的控制努力。\n\n将这些效应映射到情景中：\n- 情景Alpha表现出频繁、激进的转向和非常小的偏差，这与相对于 $Q$ 而言较小的 $R$ （即大的 $K$ 和对 $x_k$ 的积极调节）相一致。\n- 情景Beta表现出平滑、柔和的转向，并允许在修正前有较大的偏差，这与相对于 $Q$ 而言较大的 $R$ （即小的 $K$ 和保守的控制努力）相一致。\n\n因此，被调校为输入权重 $R$ 相对于 $Q$ 大得多的情景是情景Beta，因为大的 $R$ 会惩罚控制输入，并产生更平滑、更保守的动作，即使这会允许更大的临时状态偏差。\n\n选项A、B和C与 $R$ 和 $Q$ 在成本函数中的作用相矛盾：$R$ 惩罚的是输入而非状态误差，并且更大的 $R$ 不会迫使控制器进行激进的修正。选项E是错误的，因为尽管预测时域 $N$ 会影响性能，但 $R$ 与 $Q$ 的比率直接决定了控制器的攻击性和平滑度，正如 $K$ 对 $Q$ 和 $R$ 的依赖关系所示。", "answer": "$$\\boxed{D}$$", "id": "1583614"}]}