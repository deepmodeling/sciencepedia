{"hands_on_practices": [{"introduction": "后退域控制（RHC）的精髓在于其预测和优化的能力。为了掌握这一核心思想，我们从最基本的情景入手。这个练习将 RHC 分解为其最基本的组成部分：针对一个非常简单的系统，在单个时间步内计算最优控制动作。通过这个实践 [@problem_id:1603975]，你将亲手体验如何通过最小化一个成本函数来找到当前时刻的最佳决策，这是理解更复杂 RHC 应用的基石。", "problem": "一个自主智能体沿单条线性轨道的位置由离散时间状态方程 $x_{k+1} = x_k + u_k$ 描述，其中 $x_k$ 是其在时间步 $k$ 的位置，$u_k$ 是在该步施加的控制输入。所有量均为无量纲。该智能体从初始位置 $x_0 = 5$ 开始。\n\n目标是在初始时间步 $k=0$ 选择一个控制输入 $u_0$，以最小化单步时间范围内的性能成本函数。成本函数定义为 $J = x_1^2 + u_0^2$，其中 $x_1$ 是下一时间步的位置，$u_0$ 是控制输入。\n\n计算使该成本函数 $J$ 最小的控制输入 $u_0$ 的数值。", "solution": "离散时间动态方程由 $x_{k+1} = x_{k} + u_{k}$ 给出。在 $k=0$ 时，我们得到 $x_{1} = x_{0} + u_{0}$。已知 $x_{0} = 5$，我们有\n$$\nx_{1} = 5 + u_{0}.\n$$\n单步时间范围内的成本函数为\n$$\nJ(u_{0}) = x_{1}^{2} + u_{0}^{2} = (5 + u_{0})^{2} + u_{0}^{2}.\n$$\n为了最小化关于 $u_{0}$ 的 $J$，我们求导并令其为零。使用链式法则和微分的线性性质，\n$$\n\\frac{dJ}{du_{0}} = 2(5 + u_{0}) \\cdot 1 + 2u_{0} = 10 + 2u_{0} + 2u_{0} = 10 + 4u_{0}.\n$$\n为求最优解，将一阶导数设为零：\n$$\n10 + 4u_{0} = 0 \\quad \\Rightarrow \\quad 4u_{0} = -10 \\quad \\Rightarrow \\quad u_{0} = -\\frac{10}{4} = -\\frac{5}{2}.\n$$\n二阶导数是\n$$\n\\frac{d^{2}J}{du_{0}^{2}} = 2 + 2 = 4 > 0,\n$$\n这证实了该临界点是一个极小值点。因此，使 $J$ 最小化的控制输入是 $u_{0} = -\\frac{5}{2}$。", "answer": "$$\\boxed{-\\frac{5}{2}}$$", "id": "1603975"}, {"introduction": "在第一个练习中，我们只考虑了未来一个时间步。然而，RHC 的真正威力在于其能够预见并规划更远的未来。这个练习 [@problem_id:1603959] 将引导你完成一项关键的推导：将系统在更长预测时域内的未来状态预测，打包成一个紧凑的矩阵方程。掌握这个公式化的预测模型是实现一个完整 MPC 控制器算法的必要步骤，它将为解决更复杂的优化问题奠定数学基础。", "problem": "模型预测控制（Model Predictive Control），也称为滚动时域控制（Receding Horizon Control, RHC），其基本任务是预测系统状态的未来演变。该预测用于在有限时间窗口内优化控制动作。\n\n考虑一个离散时间线性时不变（LTI）系统，其动态特性由状态空间方程描述：\n$$x_{k+1} = A x_k + B u_k$$\n其中 $k$ 是离散时间索引，$x_k \\in \\mathbb{R}^n$ 是状态向量，$u_k \\in \\mathbb{R}^m$ 是控制输入向量，$A \\in \\mathbb{R}^{n \\times n}$ 和 $B \\in \\mathbb{R}^{n \\times m}$ 是常数系统矩阵。\n\n设预测时域为正整数 $N$。我们将在该时域内，从当前时刻 $k$ 的已知状态 $x_k$ 开始的预测状态序列，定义为堆叠的列向量：\n$$\\mathbf{X}_k = \\begin{pmatrix} x_{k+1|k} \\\\ x_{k+2|k} \\\\ \\vdots \\\\ x_{k+N|k} \\end{pmatrix}$$\n其中 $x_{k+j|k}$ 表示使用在时刻 $k$ 可用的信息计算出的在时刻 $k+j$ 的预测状态。\n\n类似地，我们将计划的未来控制输入序列定义为堆叠的列向量：\n$$\\mathbf{U}_k = \\begin{pmatrix} u_k \\\\ u_{k+1} \\\\ \\vdots \\\\ u_{k+N-1} \\end{pmatrix}$$\n\n你的任务是推导并将预测状态向量 $\\mathbf{X}_k$ 表示为当前状态 $x_k$ 和未来控制输入向量 $\\mathbf{U}_k$ 的线性函数。结果应以紧凑的矩阵-向量形式表示。", "solution": "我们从离散时间 LTI 动态方程 $x_{k+1}=A x_{k}+B u_{k}$ 出发，通过使用输入 $u_{k},u_{k+1},\\ldots,u_{k+N-1}$ 和已知的当前状态 $x_{k}$ 向前迭代状态方程来计算开环预测。前几个预测状态为\n$$\nx_{k+1|k}=A x_{k}+B u_{k},\n$$\n$$\nx_{k+2|k}=A x_{k+1|k}+B u_{k+1}=A\\left(A x_{k}+B u_{k}\\right)+B u_{k+1}=A^{2} x_{k}+A B u_{k}+B u_{k+1},\n$$\n$$\nx_{k+3|k}=A x_{k+2|k}+B u_{k+2}=A\\left(A^{2} x_{k}+A B u_{k}+A B u_{k+1}\\right)+B u_{k+2}=A^{3} x_{k}+A^{2} B u_{k}+A B u_{k+1}+B u_{k+2}.\n$$\n通过归纳法，对于 $j \\in \\{1,\\ldots,N\\}$ 的通用 $j$ 步预测为\n$$\nx_{k+j|k}=A^{j} x_{k}+\\sum_{i=0}^{j-1} A^{j-1-i} B\\, u_{k+i}.\n$$\n将这 $N$ 个预测状态堆叠成向量 $\\mathbf{X}_{k}=\\begin{pmatrix}x_{k+1|k} \\\\ x_{k+2|k} \\\\ \\vdots \\\\ x_{k+N|k}\\end{pmatrix}$，并将输入堆叠成 $\\mathbf{U}_{k}=\\begin{pmatrix}u_{k} \\\\ u_{k+1} \\\\ \\vdots \\\\ u_{k+N-1}\\end{pmatrix}$，得到紧凑的矩阵-向量形式\n$$\n\\mathbf{X}_{k}=\\underbrace{\\begin{pmatrix}\nA \\\\\nA^{2} \\\\\n\\vdots \\\\\nA^{N}\n\\end{pmatrix}}_{\\text{size }(N n)\\times n} x_{k}+\\underbrace{\\begin{pmatrix}\nB  & 0  & \\cdots  & 0 \\\\\nA B  & B  & \\cdots  & 0 \\\\\n\\vdots  & \\vdots  & \\ddots  & \\vdots \\\\\nA^{N-1} B  & A^{N-2} B  & \\cdots  & B\n\\end{pmatrix}}_{\\text{size }(N n)\\times(N m)} \\mathbf{U}_{k},\n$$\n该形式是关于 $x_{k}$ 和 $\\mathbf{U}_{k}$ 的线性函数，并且其输入矩阵具有标准的下三角块托普利茨（Toeplitz）结构。", "answer": "$$\\boxed{\\mathbf{X}_{k}=\\begin{pmatrix}\nA \\\\\nA^{2} \\\\\n\\vdots \\\\\nA^{N}\n\\end{pmatrix} x_{k}+\\begin{pmatrix}\nB  & 0  & \\cdots  & 0 \\\\\nA B  & B  & \\cdots  & 0 \\\\\n\\vdots  & \\vdots  & \\ddots  & \\vdots \\\\\nA^{N-1} B  & A^{N-2} B  & \\cdots  & B\n\\end{pmatrix} \\mathbf{U}_{k}}$$", "id": "1603959"}, {"introduction": "理论计算和模型构建固然重要，但 RHC 在工业界大放异彩的关键在于其处理各种操作限制的卓越能力。这个练习 [@problem_id:1583595] 将我们带入一个实际的工业场景，探讨硬约束和软约束之间的关键区别。通过分析这个案例，你将学会如何判断哪些限制是绝不能违反的（硬约束），哪些是代表期望目标但允许有一定灵活性的（软约束），这是设计鲁棒且高效的 MPC 系统时必须掌握的核心技能。", "problem": "一家生物制药公司正在为生物反应器中的一个敏感发酵过程设计控制系统。该控制器采用模型预测控制 (MPC) 策略来调节过程。必须管理两个关键的过程变量：内部温度 $T$ 和以pH值衡量的酸度。\n\n发酵的产物是一种精细的蛋白质，如果温度超过临界值 $T_{max} = 38.0^\\circ\\text{C}$，它就会发生不可逆的变性并被破坏。任何对该温度限制的违反，无论多么微小或短暂，都会导致整批产品的完全损失。\n\n反应的最佳pH值为 $pH_{opt} = 7.2$。偏离该值是不希望看到的，因为它会降低反应速率和最终产量。然而，这些影响并非灾难性的；过程可以恢复，并且如果为了满足其他操作目标（例如维持温度约束），小的、暂时的偏离是可以容忍的。\n\n您的任务是确定温度约束 ($T \\le T_{max}$) 和期望的pH水平 (保持 pH 接近 $pH_{opt}$) 应如何在MPC控制器核心的优化问题中进行建模。\n\n下列哪项描述了最合适的建模方式？\n\nA. 温度限制应为硬约束，pH目标应为软约束。\n\nB. 温度限制应为软约束，pH目标应为硬约束。\n\nC. 温度限制和pH目标都应作为硬约束实施。\n\nD. 温度限制和pH目标都应作为软约束实施。\n\nE. 温度限制应作为软约束实施，pH目标应为无约束目标。", "solution": "在模型预测控制中，在任何情况下都不能违反的约束必须建模为硬约束，这意味着可行集排除了任何违反情况。那些违反是可容忍但不希望发生的约束被建模为软约束，通常通过引入松弛变量并在目标函数中惩罚其值，或者等效地，在阶段成本中直接惩罚偏差。\n\n根据过程描述：\n- 任何对温度限制的违反都会导致整批产品的完全损失。这对应于对任何违反行为的有效无限惩罚，因此温度约束必须作为硬不等式约束来强制执行，在整个预测时域内的所有步骤中：\n$$\nT(k+i) \\le T_{max} \\quad \\text{for all } i \\in \\{0,\\dots,N-1\\}.\n$$\n- $pH$值偏离$pH_{opt}$的情况是可容忍的，并且是性能权衡的一部分，因此应将其视为软约束。这可以通过在成本函数中直接惩罚偏差，或通过引入带有松弛变量的软约束来建模。一个标准的MPC成本函数可能包含对偏差的二次惩罚：\n$$\nJ = \\sum_{i=0}^{N-1} \\left( w_{pH} \\left|\\mathrm{pH}(k+i) - pH_{opt}\\right|^{2} + w_{u} \\|\\Delta u(k+i)\\|^{2} \\right),\n$$\n受限于系统动力学和上述硬温度约束。或者，可以写一个带有松弛变量 $\\sigma(k+i) \\ge 0$ 的软约束：\n$$\n\\left|\\mathrm{pH}(k+i) - pH_{opt}\\right| \\le \\sigma(k+i),\n$$\n并在成本函数中增加一个惩罚项，例如\n$$\nJ_{\\text{soft}} = \\sum_{i=0}^{N-1} \\lambda \\,\\sigma(k+i)^{2},\n$$\n同样，将 $T(k+i) \\le T_{max}$ 作为硬约束强制执行。\n\n评估各个选项：\n- A符合上述分析：温度为硬约束，pH为软约束。\n- B将温度设为软约束，pH设为硬约束，这与温度违规的灾难性后果相矛盾。\n- C将两者都设为硬约束，这会因不允许在pH上进行有益的权衡而不必要地限制了可行性。\n- D将两者都设为软约束，这有导致灾难性温度违规的风险。\n- E将温度设为软约束，这是不可接受的，并且甚至没有将pH作为软约束，从而移除了对pH的显式约束指导。\n\n因此，最合适的建模方式是 A。", "answer": "$$\\boxed{A}$$", "id": "1583595"}]}