{"hands_on_practices": [{"introduction": "功率谱密度 (PSD) 的一个最基本应用是确定信号的总功率。这个练习将通过一个混合频谱信号的例子，来实践维纳-辛钦定理的一个关键推论：对功率谱密度在所有频率上进行积分，即可得到信号的总平均功率。通过处理一个同时包含连续谱（如噪声）和离散谱（如正弦音）的信号 [@problem_id:1742996]，你将加深对PSD物理意义的理解。", "problem": "一个实值广义平稳随机过程 $X(t)$ 被用于为一个通信信号建模。其功率谱密度 (PSD)，记为 $S_{XX}(\\omega)$，由一个连续部分和一个离散部分组成。总功率谱密度由以下和式给出：$S_{XX}(\\omega) = S_c(\\omega) + S_d(\\omega)$。\n\n连续部分 $S_c(\\omega)$ 代表一个带限噪声或数据分量，由一个矩形函数描述：\n$$\nS_c(\\omega) = \\begin{cases} A  \\text{if } |\\omega| \\leq \\omega_1 \\\\ 0  \\text{if } |\\omega| > \\omega_1 \\end{cases}\n$$\n\n离散部分 $S_d(\\omega)$ 代表一对正弦导频音，由两个狄拉克δ函数描述：\n$$\nS_d(\\omega) = B \\left( \\delta(\\omega - \\omega_2) + \\delta(\\omega + \\omega_2) \\right)\n$$\n\n此处，$A$、$B$、$\\omega_1$ 和 $\\omega_2$ 均为正实数常量，且条件 $\\omega_2 > \\omega_1$ 确保了导频音在连续频带之外。函数 $\\delta(\\cdot)$ 是狄拉克δ函数。\n\n求随机过程 $X(t)$ 的总平均功率。答案请用常量 $A$、$B$ 和 $\\omega_1$ 的解析表达式表示。", "solution": "对于一个定义在角频率 $\\omega$ 上的、具有双边功率谱密度 $S_{XX}(\\omega)$ 的实广义平稳过程，根据 Wiener–Khinchin 定理，其自相关函数为\n$$\nR_{X}(\\tau) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} S_{XX}(\\omega)\\,\\exp(j\\omega \\tau)\\,d\\omega.\n$$\n总平均功率是均方值 $P = R_{X}(0)$，因此\n$$\nP = R_{X}(0) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} S_{XX}(\\omega)\\,d\\omega.\n$$\n当 $S_{XX}(\\omega) = S_{c}(\\omega) + S_{d}(\\omega)$ 时，积分可以分开：\n$$\nP = \\frac{1}{2\\pi}\\left(\\int_{-\\infty}^{\\infty} S_{c}(\\omega)\\,d\\omega + \\int_{-\\infty}^{\\infty} S_{d}(\\omega)\\,d\\omega\\right).\n$$\n对于连续的矩形部分，\n$$\n\\int_{-\\infty}^{\\infty} S_{c}(\\omega)\\,d\\omega = \\int_{-\\omega_{1}}^{\\omega_{1}} A\\,d\\omega = 2A\\omega_{1}.\n$$\n对于离散部分，使用 $\\int_{-\\infty}^{\\infty} \\delta(\\omega-\\omega_{0})\\,d\\omega = 1$，\n$$\n\\int_{-\\infty}^{\\infty} S_{d}(\\omega)\\,d\\omega = B\\left(\\int_{-\\infty}^{\\infty} \\delta(\\omega-\\omega_{2})\\,d\\omega + \\int_{-\\infty}^{\\infty} \\delta(\\omega+\\omega_{2})\\,d\\omega\\right) = 2B.\n$$\n因此，\n$$\nP = \\frac{1}{2\\pi}\\left(2A\\omega_{1} + 2B\\right) = \\frac{A\\omega_{1} + B}{\\pi}.\n$$\n位置 $\\omega_{2}$ 不影响功率，因为每个狄拉克δ函数在所有 $\\omega$ 上的积分都为1；条件 $\\omega_{2} > \\omega_{1}$ 只确保了频谱上的分离。", "answer": "$$\\boxed{\\frac{A\\omega_{1}+B}{\\pi}}$$", "id": "1742996"}, {"introduction": "线性滤波器是改变信号频谱特性的基本工具。本练习探讨了当白噪声——一种在所有频率上都具有恒定功率谱的信号——通过一个简单的数字平均滤波器时，其功率谱密度会发生怎样的变化 [@problem_id:1324417]。这个过程清晰地展示了滤波器如何通过其频率响应来“塑造”信号的功率谱，这是数字信号处理中用于降噪和信号整形的核心概念。", "problem": "在一个简单的数字信号处理应用中，一个含噪信号被建模为一个离散时间广义平稳过程 $W[n]$，其中 $n$ 是整数时间索引。该过程具有零均值，其自相关函数为 $R_W[k] = \\sigma^2 \\delta[k]$，其中 $\\sigma^2$ 是过程的恒定方差，$\\delta[k]$ 是克罗内克δ函数。这种类型的信号通常被称为离散时间白噪声。\n\n该噪声通过一个简单的数字平均滤波器，产生一个输出序列 $Y[n]$。滤波器的操作由以下方程定义：\n$$Y[n] = \\frac{1}{2}(W[n] + W[n-1])$$\n输出信号 $Y[n]$ 的统计特性与输入 $W[n]$ 的不同。确定输出过程的功率谱密度，记为 $S_Y(e^{j\\omega})$。变量 $\\omega$ 代表归一化角频率，单位为弧度/样本。您的最终表达式应以噪声方差 $\\sigma^2$ 和角频率 $\\omega$ 表示。", "solution": "问题要求解一个具有白噪声输入的线性系统的输出信号功率谱密度（PSD）$S_Y(e^{j\\omega})$。对于一个线性时不变（LTI）系统，输入功率谱密度 $S_W(e^{j\\omega})$ 和输出功率谱密度 $S_Y(e^{j\\omega})$ 之间的关系由以下公式给出：\n$$S_Y(e^{j\\omega}) = |H(e^{j\\omega})|^2 S_W(e^{j\\omega})$$\n其中 $H(e^{j\\omega})$ 是系统的频率响应。\n\n首先，我们确定输入白噪声过程 $W[n]$ 的功率谱密度。功率谱密度是自相关函数 $R_W[k]$ 的离散时间傅里叶变换（DTFT）。问题中说明 $R_W[k] = \\sigma^2 \\delta[k]$。\n$$S_W(e^{j\\omega}) = \\sum_{k=-\\infty}^{\\infty} R_W[k] e^{-j\\omega k} = \\sum_{k=-\\infty}^{\\infty} \\sigma^2 \\delta[k] e^{-j\\omega k}$$\n根据克罗内克δ函数的筛选性质，该和仅在 $k=0$ 时非零。\n$$S_W(e^{j\\omega}) = \\sigma^2 e^{-j\\omega \\cdot 0} = \\sigma^2$$\n因此，输入功率谱密度在所有频率上都是常数。\n\n接下来，我们确定系统的频率响应 $H(e^{j\\omega})$。该系统由差分方程 $Y[n] = \\frac{1}{2}(W[n] + W[n-1])$ 描述。这是一个LTI系统。其冲激响应 $h[n]$ 是当输入为克罗内克δ函数 $W[n] = \\delta[n]$ 时的输出。\n$$h[n] = \\frac{1}{2}(\\delta[n] + \\delta[n-1])$$\n这意味着冲激响应有两个非零值：$h[0] = 1/2$ 和 $h[1] = 1/2$。频率响应 $H(e^{j\\omega})$ 是 $h[n]$ 的DTFT：\n$$H(e^{j\\omega}) = \\sum_{n=-\\infty}^{\\infty} h[n] e^{-j\\omega n} = h[0]e^{-j\\omega \\cdot 0} + h[1]e^{-j\\omega \\cdot 1}$$\n$$H(e^{j\\omega}) = \\frac{1}{2}(1) + \\frac{1}{2} e^{-j\\omega} = \\frac{1}{2}(1 + e^{-j\\omega})$$\n\n现在，我们必须求频率响应的幅度平方 $|H(e^{j\\omega})|^2$。一个简便的方法是提取一个复指数项：\n$$H(e^{j\\omega}) = \\frac{1}{2} e^{-j\\omega/2} (e^{j\\omega/2} + e^{-j\\omega/2})$$\n使用欧拉公式 $e^{j\\theta} + e^{-j\\theta} = 2\\cos(\\theta)$，我们可以简化该表达式：\n$$H(e^{j\\omega}) = \\frac{1}{2} e^{-j\\omega/2} \\left(2\\cos\\left(\\frac{\\omega}{2}\\right)\\right) = e^{-j\\omega/2} \\cos\\left(\\frac{\\omega}{2}\\right)$$\n幅度平方则为：\n$$|H(e^{j\\omega})|^2 = \\left|e^{-j\\omega/2} \\cos\\left(\\frac{\\omega}{2}\\right)\\right|^2 = |e^{-j\\omega/2}|^2 \\left|\\cos\\left(\\frac{\\omega}{2}\\right)\\right|^2$$\n由于对于任意实数 $\\phi$，都有 $|e^{-j\\phi}|=1$，且余弦函数为实数，因此这可以简化为：\n$$|H(e^{j\\omega})|^2 = (1)^2 \\cos^2\\left(\\frac{\\omega}{2}\\right) = \\cos^2\\left(\\frac{\\omega}{2}\\right)$$\n\n最后，我们将 $S_W(e^{j\\omega})$ 和 $|H(e^{j\\omega})|^2$ 的表达式代入输入-输出功率谱密度关系式中：\n$$S_Y(e^{j\\omega}) = |H(e^{j\\omega})|^2 S_W(e^{j\\omega}) = \\left(\\cos^2\\left(\\frac{\\omega}{2}\\right)\\right) (\\sigma^2)$$\n重新整理得到输出功率谱密度的最终表达式。", "answer": "$$\\boxed{\\sigma^2 \\cos^2\\left(\\frac{\\omega}{2}\\right)}$$", "id": "1324417"}, {"introduction": "从理论到实践的跨越中，我们会遇到由有限数据长度和离散傅里叶变换 (DFT) 引起的效应，频谱泄漏便是其中最关键的现象之一。这个编程练习将指导你通过分析一个纯正弦波来亲手验证和量化频谱泄漏 [@problem_id:2429045]。通过对比信号频率与DFT频率分辨率匹配和不匹配的情况，你将直观地理解为何信号的能量会“泄漏”到相邻的频率仓中，以及加窗技术如何帮助缓解这一问题。", "problem": "给定一个经过均匀时间采样的纯正弦波，您的任务是使用离散傅里叶变换 (DFT) 进行功率谱密度估计，以展示频谱泄漏现象。从基本定义开始：一个长度为 $N$ 的离散时间序列 $x[n]$ 的离散傅里叶变换 (DFT) 为 $X[k] = \\sum_{n=0}^{N-1} x[n] e^{-j 2\\pi kn/N}$，其中 $k \\in \\{0,1,\\dots,N-1\\}$，$j$ 是虚数单位。采样频率为 $F_s$，因此采样间隔为 $\\Delta t = 1/F_s$，DFT 频率分辨率为 $\\Delta f = F_s/N$。加窗操作由一个实数序列 $w[n]$ 定义，该序列逐点应用于 $x[n]$，产生 $x_w[n]=w[n]x[n]$。使用离散时间能量守恒（Parseval 关系）以及这些定义，构建一个具有适当窗函数功率归一化的功率谱密度 (PSD) 的单边周期图估计器。所有三角函数的参数必须以弧度为单位。\n\n您的程序必须：\n- 构建离散时间信号 $x[n] = \\sin(2\\pi f_0 n / F_s)$，其中 $n \\in \\{0,1,\\dots,N-1\\}$。\n- 应用选定的窗函数 $w[n]$（矩形窗 $w[n]=1$ 或汉宁窗 $w[n] = \\tfrac{1}{2}\\left(1 - \\cos\\left(\\tfrac{2\\pi n}{N-1}\\right)\\right)$）以形成 $x_w[n]=w[n]x[n]$。\n- 计算一个 $N$ 点 DFT（无零填充），并为频率 $f_k = k \\Delta f$（其中 $k \\in \\{0,1,\\dots,\\tfrac{N}{2}\\}$）形成一个单边周期图 PSD 估计 $P[k]$，使用基于窗函数均方值的窗函数功率归一化。确保当 $N$ 为偶数时，单边谱通过将严格位于直流 (DC) 和奈奎斯特频率之间的频率仓的功率加倍，来正确地计入被舍弃的负频率内容。\n- 将泄漏比 $\\mathcal{L}$ 定义为位于峰值周围主瓣之外的单边谱总功率的比例，其中主瓣在操作上定义为 PSD 值在峰值的 $-6$ 分贝范围内的频率仓集合。用符号表示：找到峰值频率仓索引 $k_{\\max}$ 使得 $P[k_{\\max}]$ 为最大值；定义主瓣索引集合 $\\mathcal{M} = \\{k : 10 \\log_{10}(P[k]/P[k_{\\max}]) \\ge -6\\}$；然后计算泄漏比为 $\\mathcal{L} = 1 - \\dfrac{\\sum_{k \\in \\mathcal{M}} P[k]}{\\sum_{k} P[k]}$。分贝转换使用 $10 \\log_{10}(\\cdot)$ 应用于功率比。\n- 对于每个测试用例，输出泄漏比，形式为一个浮点数。正弦波振幅为 $1$。\n\n测试套件：\n- 用例 1（非整数频率仓，矩形窗）：$F_s = 1024 \\,\\mathrm{Hz}$，$N = 1024$，$f_0 = 128.5 \\,\\mathrm{Hz}$，窗类型“rectangular”。\n- 用例 2（非整数频率仓，汉宁窗）：$F_s = 1024 \\,\\mathrm{Hz}$，$N = 1024$，$f_0 = 128.5 \\,\\mathrm{Hz}$，窗类型“Hann”。\n- 用例 3（精确频率仓，矩形窗）：$F_s = 1024 \\,\\mathrm{Hz}$，$N = 1024$，$f_0 = 128.0 \\,\\mathrm{Hz}$，窗类型“rectangular”。\n- 用例 4（小偏移，矩形窗）：$F_s = 1024 \\,\\mathrm{Hz}$，$N = 1024$，$f_0 = 128.01 \\,\\mathrm{Hz}$，窗类型“rectangular”。\n- 用例 5（短记录，非整数频率仓，矩形窗）：$F_s = 256 \\,\\mathrm{Hz}$，$N = 256$，$f_0 = 50.3 \\,\\mathrm{Hz}$，窗类型“rectangular”。\n\n角度单位要求：所有用于三角函数的角度必须是弧度。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含上述五个用例的泄漏比，按所列顺序排列，格式为用方括号括起来的逗号分隔列表，每个泄漏比四舍五入到六位小数，例如，“$[0.123456,0.234567,0.345678,0.456789,0.567890]$”。", "solution": "所提出的问题是计算物理学领域，特别是数字信号处理领域中一个有效且适定的练习。它要求在不同条件下，根据纯正弦信号的周期图估计来计算频谱泄漏。所提供的定义是标准且自洽的，从而能够得出一个直接而明确的解决方案。\n\n解决方案从第一性原理开始，系统地进行。\n\n**1. 信号与加窗模型**\n\n离散时间信号是一个振幅为 $A=1$ 的纯正弦波，在 $N$ 个点上以频率 $F_s$ 进行采样。该信号定义为：\n$$x[n] = \\sin\\left(\\frac{2\\pi f_0 n}{F_s}\\right), \\quad n \\in \\{0, 1, \\dots, N-1\\}$$\n其中 $f_0$ 是正弦波的频率。\n\n该信号随后乘以一个窗函数 $w[n]$，以产生加窗信号 $x_w[n]$：\n$$x_w[n] = w[n] x[n]$$\n问题指定了两种窗类型：\n- **矩形窗**：$w[n] = 1$ 对所有 $n$。\n- **汉宁窗**：$w[n] = \\frac{1}{2}\\left(1 - \\cos\\left(\\frac{2\\pi n}{N-1}\\right)\\right)$。\n\n**2. 功率谱估计**\n\n问题的核心是构建一个经过适当归一化的单边功率谱。我们从加窗信号的离散傅里叶变换 (DFT) 开始：\n$$X_w[k] = \\sum_{n=0}^{N-1} x_w[n] e^{-j 2\\pi kn/N}$$\n\n为确保估计的功率与窗函数的增益无关，我们必须对频谱进行归一化。离散信号的 Parseval 定理将信号在时域中的能量与其在频域中的能量联系起来：\n$$\\sum_{n=0}^{N-1} |x_w[n]|^2 = \\frac{1}{N} \\sum_{k=0}^{N-1} |X_w[k]|^2$$\n加窗信号在 $N$ 个采样点上的平均功率是 $P_{\\text{avg},w} = \\frac{1}{N} \\sum_{n=0}^{N-1} |x_w[n]|^2$。因此：\n$$P_{\\text{avg},w} = \\frac{1}{N^2} \\sum_{k=0}^{N-1} |X_w[k]|^2$$\n原始信号 $x[n]$ 的平均功率与加窗信号的平均功率相关。对于正弦信号，加窗过程会按等于窗函数均方值的因子缩放功率。因此，原始信号的估计平均功率 $P_{\\text{avg},x}$ 为：\n$$P_{\\text{avg},x} = \\frac{P_{\\text{avg},w}}{\\frac{1}{N}\\sum_{n=0}^{N-1} w[n]^2} = \\frac{N}{\\sum_{n=0}^{N-1} w[n]^2} P_{\\text{avg},w}$$\n让我们将窗权重平方和表示为 $S_2 = \\sum_{n=0}^{N-1} w[n]^2$。原始信号的估计总功率为：\n$$P_{\\text{total}} = P_{\\text{avg},x} = \\frac{N}{S_2} \\left( \\frac{1}{N^2} \\sum_{k=0}^{N-1} |X_w[k]|^2 \\right) = \\frac{1}{S_2 N} \\sum_{k=0}^{N-1} |X_w[k]|^2$$\n对于实值输入信号 $x[n]$，其 DFT 是共轭对称的：$X_w[k] = X_w^*[N-k]$。这意味着 $|X_w[k]|^2 = |X_w[N-k]|^2$。我们可以为 $k \\in \\{0, 1, \\dots, N/2\\}$ 构建一个保持总功率不变的单边功率谱 $P[k]$。对双边谱的求和可以重写为（对于偶数 $N$）：\n$$\\sum_{k=0}^{N-1} |X_w[k]|^2 = |X_w[0]|^2 + |X_w[N/2]|^2 + 2\\sum_{k=1}^{N/2-1} |X_w[k]|^2$$\n我们定义单边功率谱 $P[k]$，使其总和等于总平均功率 $P_{\\text{total}}$。$P[k]$ 的分量是包含在每个频率仓 $k$ 中的功率：\n$$P[k] = \\begin{cases} \\frac{1}{S_2 N} |X_w[k]|^2  \\text{对于 } k=0 \\text{ 和 } k=N/2 \\\\ \\frac{2}{S_2 N} |X_w[k]|^2  \\text{对于 } k=1, 2, \\dots, N/2-1 \\end{cases}$$\n总和 $\\sum_{k=0}^{N/2} P[k]$ 正确地得出了原始信号的总平均功率。鉴于 $x[n]$ 是一个振幅为 $A=1$ 的正弦波，其真实平均功率为 $A^2/2 = 1/2$。我们的估计量 $\\sum P[k]$ 将近似于此值。\n\n**3. 泄漏比计算**\n\n频谱泄漏比 $\\mathcal{L}$ 定义为位于频谱峰值主瓣之外的总功率的比例。\n首先，我们找到功率谱的最大值 $P_{\\max} = \\max_k P[k]$。主瓣在操作上定义为功率在峰值的 $-6$ 分贝范围内的频率仓集合 $\\mathcal{M}$：\n$$\\mathcal{M} = \\left\\{k \\mid 10 \\log_{10}\\left(\\frac{P[k]}{P_{\\max}}\\right) \\ge -6\\right\\}$$\n这个不等式等价于 $P[k] \\ge P_{\\max} \\cdot 10^{-0.6}$。\n\n主瓣中的总功率是 $P_{\\text{lobe}} = \\sum_{k \\in \\mathcal{M}} P[k]$。整个频谱的总功率是 $P_{\\text{total}} = \\sum_{k=0}^{N/2} P[k]$。\n然后泄漏比计算如下：\n$$\\mathcal{L} = 1 - \\frac{P_{\\text{lobe}}}{P_{\\text{total}}}$$\n\n对每个测试用例实施此程序，以确定在指定条件下的泄漏比。", "answer": "```python\n# 完整且可运行的 Python 3 代码如下。\n# 导入的库必须符合指定的执行环境。\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    计算正弦信号在不同加窗和频率条件下的频谱泄漏比。\n    \"\"\"\n    # 根据题目要求定义测试用例。\n    test_cases = [\n        # (采样频率, 采样点数, 信号频率, 窗类型)\n        (1024.0, 1024, 128.5, \"rectangular\"),\n        (1024.0, 1024, 128.5, \"Hann\"),\n        (1024.0, 1024, 128.0, \"rectangular\"),\n        (1024.0, 1024, 128.01, \"rectangular\"),\n        (256.0, 256, 50.3, \"rectangular\"),\n    ]\n\n    results = []\n    for case in test_cases:\n        Fs, N, f0, window_type = case\n        \n        # 1. 生成信号\n        # 构建N个采样点的时间向量。\n        n = np.arange(N)\n        # 生成振幅为1的正弦信号。\n        x = np.sin(2 * np.pi * f0 * n / Fs)\n\n        # 2. 加窗\n        # 应用指定的窗函数。\n        if window_type == \"rectangular\":\n            w = np.ones(N)\n        elif window_type == \"Hann\":\n            # 根据题目定义: w[n] = 1/2 * (1 - cos(2*pi*n / (N-1)))\n            w = 0.5 * (1 - np.cos(2 * np.pi * n / (N - 1)))\n        \n        x_w = x * w\n\n        # 3. N点DFT\n        # 计算加窗信号的DFT。\n        X_w = np.fft.fft(x_w, n=N)\n\n        # 4. 单边功率谱估计\n        # 所有测试用例的N均为偶数。单边谱有 N/2 + 1 个点。\n        num_freq_bins = N // 2 + 1\n        X_w_mag_sq = np.abs(X_w[0:num_freq_bins])**2\n        \n        # 计算窗函数的平方和用于归一化。\n        S2 = np.sum(w**2)\n        \n        # 初始化功率谱数组。\n        P = np.zeros(num_freq_bins)\n        \n        # 归一化确保 P[k] 的总和约等于真实信号功率 (0.5)。\n        # 直流和奈奎斯特频率仓的归一化常数。\n        norm_const_dc_nyquist = 1.0 / (S2 * N)\n        # 其他频率仓的归一化常数（因单边谱而加倍）。\n        norm_const_other = 2.0 / (S2 * N)\n\n        # 计算 k=1 到 k=N/2 - 1 频率仓的功率。\n        P[1:-1] = norm_const_other * X_w_mag_sq[1:-1]\n        \n        # 计算直流 (k=0) 和奈奎斯特 (k=N/2) 频率仓的功率。\n        P[0] = norm_const_dc_nyquist * X_w_mag_sq[0]\n        P[-1] = norm_const_dc_nyquist * X_w_mag_sq[-1]\n\n        # 5. 计算泄漏比\n        P_total = np.sum(P)\n        \n        # 处理总功率在数值上为零的理想情况。\n        if P_total  1e-15:\n            leakage_ratio = 0.0\n        else:\n            P_max = np.max(P)\n            # 主瓣定义为所有功率在峰值-6dB范围内的频率仓。\n            # 这对应于 10**(-6.0 / 10.0) 的线性幅度比。\n            db_threshold_ratio = 10**(-6.0 / 10.0)\n            main_lobe_mask = P >= P_max * db_threshold_ratio\n            \n            # 对主瓣内的功率求和。\n            P_lobe = np.sum(P[main_lobe_mask])\n            \n            # 泄漏比是主瓣之外的功率所占的比例。\n            leakage_ratio = 1.0 - (P_lobe / P_total)\n            \n        results.append(leakage_ratio)\n\n    # 最终的打印语句，格式完全符合要求。\n    # 将每个结果格式化为六位小数。\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "2429045"}]}