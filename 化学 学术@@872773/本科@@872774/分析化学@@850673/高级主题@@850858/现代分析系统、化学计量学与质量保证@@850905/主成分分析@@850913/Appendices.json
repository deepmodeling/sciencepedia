{"hands_on_practices": [{"introduction": "主成分分析 (PCA) 的主要应用之一是降低高维数据集（如光谱数据）的复杂性。其核心思想是保留少数几个能够捕捉大部分数据总方差的主成分，从而在简化数据的同时保留关键信息。这个练习 [@problem_id:1461616] 将让你亲身体验 PCA 工作流程中一个常见且至关重要的步骤：如何根据“累计解释方差”来决定保留多少个主成分才足以代表原始数据。", "problem": "在一家分析化学实验室，一位研究人员正在开发一种新型的生物可降解聚合物混合物。为了表征不同配方中的组成和分子间相互作用，她使用傅里叶变换红外光谱（FT-IR）技术收集光谱数据。所得数据集庞大而复杂，包含数百个高度相关的变量（不同波数下的吸光度）。为了简化数据并识别最主要的变化来源，她采用了一种称为主成分分析（PCA）的化学计量学技术。\n\nPCA 算法将原始数据转换为一组新的不相关变量，称为主成分（PCs）。每个后续的主成分解释了原始数据集中递减的总方差量。前六个主成分所解释的总方差百分比如下：\n\n- 主成分1：61.45%\n- 主成分2：22.81%\n- 主成分3：8.03%\n- 主成分4：4.12%\n- 主成分5：2.57%\n- 主成分6：0.88%\n\n在化学计量学中，通常的做法是仅保留解释数据大部分方差所必需的主成分数量，从而在保留基本信息的同时降低维度。请确定必须保留的最少主成分数量，以解释 FT-IR 数据集中至少 98% 的总方差。", "solution": "目标是找到解释至少 98% 总方差所需的最少主成分（PCs）数量。为此，我们必须计算逐个添加主成分时所解释的累积方差百分比，并在累积总和首次达到或超过 98% 时停止。\n\n每个主成分解释的方差百分比如下：\n- 主成分1：61.45%\n- 主成分2：22.81%\n- 主成分3：8.03%\n- 主成分4：4.12%\n- 主成分5：2.57%\n- 主成分6：0.88%\n\n让我们逐步计算累积方差。\n\n第1步：仅考虑第一个主成分（PC1）。\n累积方差为 61.45%。\n这小于 98%，因此我们需要更多的主成分。\n\n第2步：加上第二个主成分（PC2）。\n累积方差是 PC1 和 PC2 方差的总和。\n累积方差 = 61.45% + 22.81% = 84.26%。\n这小于 98%，因此我们需要更多的主成分。\n\n第3步：加上第三个主成分（PC3）。\n累积方差是 PC1、PC2 和 PC3 方差的总和。\n累积方差 = 84.26% + 8.03% = 92.29%。\n这小于 98%，因此我们需要更多的主成分。\n\n第4步：加上第四个主成分（PC4）。\n累积方差是 PC1、PC2、PC3 和 PC4 方差的总和。\n累积方差 = 92.29% + 4.12% = 96.41%。\n这仍然小于 98%，因此我们需要更多的主成分。\n\n第5步：加上第五个主成分（PC5）。\n累积方差是 PC1、PC2、PC3、PC4 和 PC5 方差的总和。\n累积方差 = 96.41% + 2.57% = 98.98%。\n这个值 98.98% 大于所要求的 98% 的阈值。\n\n因此，必须保留的最少主成分数量是 5。我们不需要考虑 PC6，因为条件已经满足。", "answer": "$$\\boxed{5}$$", "id": "1461616"}, {"introduction": "在应用 PCA 之前，数据预处理是至关重要的一步，其中“均值中心化”是不可或缺的。PCA 旨在寻找数据集*相对于其自身中心*的方差最大方向。这个练习 [@problem_id:1383917] 是一个思想实验，它清晰地揭示了如果省略均值中心化会发生什么严重的错误。你会发现，所得到的“主成分”将不再描述数据的内部结构，而是被数据在坐标系中的绝对位置所主导，从而失去分析意义。", "problem": "一位分析师正在研究一个包含三个二维数据点的数据集：$P_1 = (99, 98)$，$P_2 = (100, 100)$ 和 $P_3 = (101, 102)$。他们打算使用主成分分析 (PCA)，一种降维技术，来寻找数据中方差最大的方向。\n\n寻找主成分的标准教科书流程如下：\n1.  计算数据点的均值向量（质心）$\\boldsymbol{\\mu}$。\n2.  通过从每个数据点 $\\mathbf{p}_i$ 中减去 $\\boldsymbol{\\mu}$ 来对数据进行均值中心化，得到中心化后的点 $\\mathbf{p}'_i = \\mathbf{p}_i - \\boldsymbol{\\mu}$。\n3.  计算中心化后数据的协方差矩阵 $C$。对于 $N$ 个数据点，协方差矩阵由 $C = \\frac{1}{N-1} \\sum_{i=1}^{N} \\mathbf{p}'_i (\\mathbf{p}'_i)^T$ 给出。\n4.  主成分是协方差矩阵 $C$ 的归一化特征向量。第一个主成分是对应于最大特征值的特征向量。\n\n我们用 $\\mathbf{v}_{\\text{correct}}$ 表示使用此正确流程找到的第一个主成分向量。\n\n现在，考虑一个有缺陷的流程，其中分析师忘记了对数据进行均值中心化（即，他们跳过了步骤 2）。在这个不正确的方法中，他们直接从原始（未中心化的）数据点 $\\mathbf{p}_i$ 计算一个矩阵 $S$：\n$$S = \\sum_{i=1}^{3} \\mathbf{p}_i (\\mathbf{p}_i)^T$$\n然后他们找到 $S$ 的对应于最大特征值的特征向量，并称之为“第一主成分”。我们用 $\\mathbf{v}_{\\text{incorrect}}$ 表示这个错误得到的向量。\n\n下列哪个陈述最准确地描述了向量 $\\mathbf{v}_{\\text{incorrect}}$ 的方向？\n\nA. $\\mathbf{v}_{\\text{incorrect}}$ 近似平行于向量 $\\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n\nB. $\\mathbf{v}_{\\text{incorrect}}$ 近似平行于向量 $\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n\nC. $\\mathbf{v}_{\\text{incorrect}}$ 近似平行于向量 $\\begin{pmatrix} -2 \\\\ 1 \\end{pmatrix}$。\n\nD. $\\mathbf{v}_{\\text{incorrect}}$ 近似为零向量。\n\nE. $\\mathbf{v}_{\\text{incorrect}}$ 与 $\\mathbf{v}_{\\text{correct}}$ 相同。", "solution": "问题要求我们确定在省略了关键的均值中心化步骤时，数据集的第一个主成分的方向，并将其与提供的选项进行比较。我们将分析正确和不正确的两种流程。数据点以列向量形式给出：$\\mathbf{p}_1 = \\begin{pmatrix} 99 \\\\ 98 \\end{pmatrix}$，$\\mathbf{p}_2 = \\begin{pmatrix} 100 \\\\ 100 \\end{pmatrix}$ 和 $\\mathbf{p}_3 = \\begin{pmatrix} 101 \\\\ 102 \\end{pmatrix}$。\n\n首先，我们分析正确的流程以理解方差的真实方向。\n步骤 1：计算均值向量 $\\boldsymbol{\\mu}$。\n$$ \\boldsymbol{\\mu} = \\frac{1}{3}(\\mathbf{p}_1 + \\mathbf{p}_2 + \\mathbf{p}_3) = \\frac{1}{3} \\begin{pmatrix} 99+100+101 \\\\ 98+100+102 \\end{pmatrix} = \\frac{1}{3} \\begin{pmatrix} 300 \\\\ 300 \\end{pmatrix} = \\begin{pmatrix} 100 \\\\ 100 \\end{pmatrix} $$\n步骤 2：对数据点进行均值中心化 $\\mathbf{p}'_i = \\mathbf{p}_i - \\boldsymbol{\\mu}$。\n$$ \\mathbf{p}'_1 = \\begin{pmatrix} 99 \\\\ 98 \\end{pmatrix} - \\begin{pmatrix} 100 \\\\ 100 \\end{pmatrix} = \\begin{pmatrix} -1 \\\\ -2 \\end{pmatrix} $$\n$$ \\mathbf{p}'_2 = \\begin{pmatrix} 100 \\\\ 100 \\end{pmatrix} - \\begin{pmatrix} 100 \\\\ 100 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} $$\n$$ \\mathbf{p}'_3 = \\begin{pmatrix} 101 \\\\ 102 \\end{pmatrix} - \\begin{pmatrix} 100 \\\\ 100 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} $$\n步骤 3：计算协方差矩阵 $C = \\frac{1}{N-1} \\sum_{i=1}^{N} \\mathbf{p}'_i (\\mathbf{p}'_i)^T$。这里 $N=3$。\n$$ C = \\frac{1}{2} \\left[ \\begin{pmatrix} -1 \\\\ -2 \\end{pmatrix} \\begin{pmatrix} -1  -2 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} \\begin{pmatrix} 0  0 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} \\begin{pmatrix} 1  2 \\end{pmatrix} \\right] $$\n$$ C = \\frac{1}{2} \\left[ \\begin{pmatrix} 1  2 \\\\ 2  4 \\end{pmatrix} + \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix} + \\begin{pmatrix} 1  2 \\\\ 2  4 \\end{pmatrix} \\right] = \\frac{1}{2} \\begin{pmatrix} 2  4 \\\\ 4  8 \\end{pmatrix} = \\begin{pmatrix} 1  2 \\\\ 2  4 \\end{pmatrix} $$\n步骤 4：求 $C$ 的特征向量。特征方程为 $\\det(C - \\lambda I) = 0$。\n$$ (1-\\lambda)(4-\\lambda) - (2)(2) = 0 \\implies 4 - 5\\lambda + \\lambda^2 - 4 = 0 \\implies \\lambda(\\lambda-5) = 0 $$\n特征值为 $\\lambda_1 = 5$ 和 $\\lambda_2 = 0$。第一个主成分 $\\mathbf{v}_{\\text{correct}}$ 是对应于较大特征值 $\\lambda_1=5$ 的特征向量。\n$$ (C-5I)\\mathbf{v} = \\mathbf{0} \\implies \\begin{pmatrix} 1-5  2 \\\\ 2  4-5 \\end{pmatrix} \\begin{pmatrix} v_x \\\\ v_y \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} \\implies \\begin{pmatrix} -4  2 \\\\ 2  -1 \\end{pmatrix} \\begin{pmatrix} v_x \\\\ v_y \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} $$\n这给出了方程 $-4v_x + 2v_y = 0$，可以简化为 $v_y = 2v_x$。因此，特征向量是 $\\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$ 的任何标量倍。所以，$\\mathbf{v}_{\\text{correct}}$ 平行于 $\\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。这与选项 A 匹配。然而，问题问的是 $\\mathbf{v}_{\\text{incorrect}}$。\n\n现在，我们分析不正确的流程。矩阵 $S$ 是根据原始数据点计算的：$S = \\sum_{i=1}^{3} \\mathbf{p}_i (\\mathbf{p}_i)^T$。\n我们将 $\\mathbf{p}_i = \\boldsymbol{\\mu} + \\mathbf{p}'_i$ 代入 $S$ 的表达式中：\n$$ S = \\sum_{i=1}^{3} (\\boldsymbol{\\mu} + \\mathbf{p}'_i) (\\boldsymbol{\\mu} + \\mathbf{p}'_i)^T = \\sum_{i=1}^{3} (\\boldsymbol{\\mu}\\boldsymbol{\\mu}^T + \\boldsymbol{\\mu}(\\mathbf{p}'_i)^T + \\mathbf{p}'_i\\boldsymbol{\\mu}^T + \\mathbf{p}'_i(\\mathbf{p}'_i)^T) $$\n分配求和：\n$$ S = \\sum_{i=1}^{3} \\boldsymbol{\\mu}\\boldsymbol{\\mu}^T + \\boldsymbol{\\mu}\\left(\\sum_{i=1}^{3} \\mathbf{p}'_i\\right)^T + \\left(\\sum_{i=1}^{3} \\mathbf{p}'_i\\right)\\boldsymbol{\\mu}^T + \\sum_{i=1}^{3} \\mathbf{p}'_i(\\mathbf{p}'_i)^T $$\n根据中心化数据的定义，$\\sum_{i=1}^{3} \\mathbf{p}'_i = \\mathbf{0}$。所以中间两项消失了。\n$$ S = N\\boldsymbol{\\mu}\\boldsymbol{\\mu}^T + \\sum_{i=1}^{3} \\mathbf{p}'_i(\\mathbf{p}'_i)^T $$\n根据 $C$ 的定义，我们有 $\\sum \\mathbf{p}'_i(\\mathbf{p}'_i)^T = (N-1)C$。\n$$ S = N\\boldsymbol{\\mu}\\boldsymbol{\\mu}^T + (N-1)C $$\n现在我们可以计算这个和的两个部分。\n$$ N\\boldsymbol{\\mu}\\boldsymbol{\\mu}^T = 3 \\begin{pmatrix} 100 \\\\ 100 \\end{pmatrix} \\begin{pmatrix} 100  100 \\end{pmatrix} = 3 \\begin{pmatrix} 10000  10000 \\\\ 10000  10000 \\end{pmatrix} = \\begin{pmatrix} 30000  30000 \\\\ 30000  30000 \\end{pmatrix} $$\n$$ (N-1)C = 2C = 2 \\begin{pmatrix} 1  2 \\\\ 2  4 \\end{pmatrix} = \\begin{pmatrix} 2  4 \\\\ 4  8 \\end{pmatrix} $$\n将这两个矩阵相加得到 $S$：\n$$ S = \\begin{pmatrix} 30000  30000 \\\\ 30000  30000 \\end{pmatrix} + \\begin{pmatrix} 2  4 \\\\ 4  8 \\end{pmatrix} = \\begin{pmatrix} 30002  30004 \\\\ 30004  30008 \\end{pmatrix} $$\n第一项 $N\\boldsymbol{\\mu}\\boldsymbol{\\mu}^T$ 的矩阵元素远大于第二项 $(N-1)C$ 的元素。矩阵 $S$ 由 $N\\boldsymbol{\\mu}\\boldsymbol{\\mu}^T$ 主导。像 $\\boldsymbol{\\mu}\\boldsymbol{\\mu}^T$ 这样的秩为1的矩阵，其主特征向量就是向量 $\\boldsymbol{\\mu}$ 本身。因为扰动项 $(N-1)C$ 相比之下很小，所以 $S$ 的主特征向量将非常接近于 $N\\boldsymbol{\\mu}\\boldsymbol{\\mu}^T$ 的主特征向量。\n$N\\boldsymbol{\\mu}\\boldsymbol{\\mu}^T$ 的主特征向量是 $\\boldsymbol{\\mu} = \\begin{pmatrix} 100 \\\\ 100 \\end{pmatrix}$，它平行于 $\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n因此，$\\mathbf{v}_{\\text{incorrect}}$ 必定近似平行于 $\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n\n这从概念上解释了为什么忘记对数据进行均值中心化是有问题的：得到的“主成分”主要指向从原点到数据云质心的方向，而不是沿着数据内部方差的方向。\n\n将我们的结果与给定的选项进行比较：\nA. $\\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$：这是 $\\mathbf{v}_{\\text{correct}}$ 的方向。\nB. $\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$：这是均值向量 $\\boldsymbol{\\mu}$ 的方向，我们确定它主导了 $\\mathbf{v}_{\\text{incorrect}}$。\nC. $\\begin{pmatrix} -2 \\\\ 1 \\end{pmatrix}$：这个向量与 $\\mathbf{v}_{\\text{correct}}$ 正交，代表了中心化后数据的第二个主成分。\nD. 零向量：主成分是一个方向，必须是非零向量。\nE. 与 $\\mathbf{v}_{\\text{correct}}$ 相同：这显然是错误的，因为 $\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$ 不平行于 $\\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n\n因此，向量 $\\mathbf{v}_{\\text{incorrect}}$ 近似平行于 $\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。", "answer": "$$\\boxed{B}$$", "id": "1383917"}, {"introduction": "真实的实验数据很少是完美的，常常包含异常值。由于 PCA 的目标是最大化方差，因此它对远离数据中心的点（即异常值）天生敏感，因为这些点对总方差的贡献不成比例地大。通过这个练习 [@problem_id:1946323]，你将能够量化一个单一异常值对 PCA 结果产生的巨大影响。这对于正确解释分析结果和认识异常值检测的重要性，是一堂至关重要的实践课。", "problem": "一位数据科学家正在分析一个二维数据集 $D_0$，它由位于一个以原点为中心的矩形顶点上的四个数据点组成：$p_1 = (L, w)$，$p_2 = (L, -w)$，$p_3 = (-L, w)$ 和 $p_4 = (-L, -w)$，其中 $L=3$ 且 $w=1$。主成分分析 (PCA) 的目标是找到数据集中方差最大的正交方向。方差最大的方向被称为第一主成分。\n\n突然，一个新的数据点，即离群点 $p_5 = (10, 10)$，被添加到数据集中，形成了一个新的数据集 $D_1 = D_0 \\cup \\{p_5\\}$。这个新点远离原始的点簇。\n\n计算原始数据集 $D_0$ 的第一主成分方向与新数据集 $D_1$ 的第一主成分方向之间的夹角。答案以度为单位，并四舍五入到三位有效数字。", "solution": "第一主成分 (PC1) 的方向是协方差矩阵对应其最大特征值的特征向量。对于一组均值为 $\\mu$ 的点 $\\{p_{i}\\}$，其（缩放后的）协方差矩阵为\n$$\n\\Sigma=\\frac{1}{n}\\sum_{i=1}^{n}(p_{i}-\\mu)(p_{i}-\\mu)^{T},\n$$\n其特征向量给出了 PCA 的方向（整体的标量因子不影响方向）。\n\n对于 $D_{0}$，这四个点是 $p_{1}=(3,1)$，$p_{2}=(3,-1)$，$p_{3}=(-3,1)$，$p_{4}=(-3,-1)$。根据对称性，均值为 $\\mu_{0}=(0,0)$。那么\n$$\n\\Sigma_{0}=\\frac{1}{4}\\sum_{i=1}^{4}p_{i}p_{i}^{T}=\\begin{pmatrix}9  0 \\\\ 0  1\\end{pmatrix}.\n$$\n因此，特征值为 $9$ 和 $1$，其特征向量分别沿着 x 轴和 y 轴。所以，$D_{0}$ 的 PC1 方向是沿着 x 轴的（相对于 x 轴的角度为 $0$）。\n\n对于 $D_{1}=D_{0}\\cup\\{(10,10)\\}$，其均值为\n$$\n\\mu_{1}=\\frac{1}{5}\\left[(3,1)+(3,-1)+(-3,1)+(-3,-1)+(10,10)\\right]=(2,2).\n$$\n将这些点中心化后得到\n$$\nq_{1}=(1,-1),\\quad q_{2}=(1,-3),\\quad q_{3}=(-5,-1),\\quad q_{4}=(-5,-3),\\quad q_{5}=(8,8).\n$$\n构造散布矩阵\n$$\nM=\\sum_{i=1}^{5}q_{i}q_{i}^{T}=\\begin{pmatrix}116  80 \\\\ 80  84\\end{pmatrix},\n$$\n注意到 $\\Sigma_{1}=\\frac{1}{5}M$ 与 $M$ 有相同的特征向量。令 $$A=\\begin{pmatrix}a  b \\\\ b  d\\end{pmatrix},$$ 其中 $a=116$, $b=80$, $d=84$。对于一个 $2\\times 2$ 的对称矩阵，其最大特征值对应的特征向量相对于 x 轴的角度 $\\theta$ 满足\n$$\n\\tan(2\\theta)=\\frac{2b}{a-d}.\n$$\n代入数值得到\n$$\n\\tan(2\\theta)=\\frac{2\\cdot 80}{116-84}=\\frac{160}{32}=5,\n$$\n所以\n$$\n2\\theta=\\arctan(5),\\quad \\theta=\\frac{1}{2}\\arctan(5).\n$$\n因此，$D_{0}$ 的 PC1（x 轴）与 $D_{1}$ 的 PC1 之间的夹角是 $\\theta$。转换为度，\n$$\n\\theta_{\\text{deg}}=\\frac{180}{\\pi}\\cdot\\frac{1}{2}\\arctan(5).\n$$\n数值上，$\\arctan(5)$ 以度为单位约等于 $78.6900675$，因此\n$$\n\\theta_{\\text{deg}}\\approx \\frac{1}{2}\\times 78.6900675=39.3450338,\n$$\n四舍五入到三位有效数字后是 $39.3$。", "answer": "$$\\boxed{39.3}$$", "id": "1946323"}]}