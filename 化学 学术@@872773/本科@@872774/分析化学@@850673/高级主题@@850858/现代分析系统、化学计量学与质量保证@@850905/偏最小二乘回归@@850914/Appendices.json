{"hands_on_practices": [{"introduction": "在构建任何定量模型后，第一个关键步骤是评估其性能。我们需要一个指标来量化模型的预测值与已知的真实值之间的吻合程度，而校正均方根误差 (RMSEC) 正是用于此目的的一个基础且广泛使用的统计量。这项练习将提供计算 RMSEC 的实践机会，这是评估任何校准模型拟合优度的核心技能。[@problem_id:1459311]", "problem": "一位分析化学家正在开发一种使用光谱学的快速质量控制方法，用于测量药物制剂中关键活性成分的浓度。使用偏最小二乘（PLS）回归建立了一个校准模型，这是一种将光谱数据与分析物浓度相关联的多变量统计方法。为了评估该校准模型的性能，测量了五个已知准确浓度的标准样品。然后，PLS模型对这五个相同样品的浓度进行预测。实际（参考）浓度和PLS预测的浓度如下所示。\n\n实际浓度 (mg/mL):\n1.25, 1.40, 1.52, 1.68, 1.81\n\n预测浓度 (mg/mL):\n1.22, 1.43, 1.55, 1.65, 1.83\n\n计算该模型的校准均方根误差（RMSEC）。答案以 mg/mL 为单位表示，并将最终结果四舍五入至三位有效数字。", "solution": "校准均方根误差（RMSEC）是用于评估校准模型性能的指标，它通过量化校准集中已知（实际）值与模型预测值之间的平均差异来计算。\n\nRMSEC的计算公式为：\n$$\n\\text{RMSEC} = \\sqrt{\\frac{\\sum_{i=1}^{n} (y_{i, \\text{actual}} - y_{i, \\text{predicted}})^{2}}{n}}\n$$\n其中 $y_{i, \\text{actual}}$ 是第 $i$ 个样品的实际浓度，$y_{i, \\text{predicted}}$ 是模型对第 $i$ 个样品预测的浓度，$n$ 是校准集中的样品总数。\n\n在本题中，我们有 $n=5$ 个样品。让我们计算每个样品的差值平方。\n\n步骤 1：计算每个样品的差值（$y_{i, \\text{actual}} - y_{i, \\text{predicted}}$）。\n- 样品 1: $1.25 - 1.22 = 0.03$ mg/mL\n- 样品 2: $1.40 - 1.43 = -0.03$ mg/mL\n- 样品 3: $1.52 - 1.55 = -0.03$ mg/mL\n- 样品 4: $1.68 - 1.65 = 0.03$ mg/mL\n- 样品 5: $1.81 - 1.83 = -0.02$ mg/mL\n\n步骤 2：将每个差值进行平方。\n- 样品 1: $(0.03)^{2} = 0.0009$ $(\\text{mg/mL})^2$\n- 样品 2: $(-0.03)^{2} = 0.0009$ $(\\text{mg/mL})^2$\n- 样品 3: $(-0.03)^{2} = 0.0009$ $(\\text{mg/mL})^2$\n- 样品 4: $(0.03)^{2} = 0.0009$ $(\\text{mg/mL})^2$\n- 样品 5: $(-0.02)^{2} = 0.0004$ $(\\text{mg/mL})^2$\n\n步骤 3：将差值的平方相加（误差平方和，SSE）。\n$$\n\\sum_{i=1}^{5} (y_{i, \\text{actual}} - y_{i, \\text{predicted}})^{2} = 0.0009 + 0.0009 + 0.0009 + 0.0009 + 0.0004 = 0.0040 \\ (\\text{mg/mL})^2\n$$\n\n步骤 4：将总和除以样品数量 $n=5$，求得均方误差（MSE）。\n$$\n\\text{MSE} = \\frac{0.0040}{5} = 0.0008 \\ (\\text{mg/mL})^2\n$$\n\n步骤 5：对均方误差（MSE）取平方根，求得 RMSEC。\n$$\n\\text{RMSEC} = \\sqrt{0.0008} \\approx 0.02828427... \\ \\text{mg/mL}\n$$\n\n步骤 6：按要求将最终答案四舍五入至三位有效数字。\n第一位有效数字是 2，第二位是 8，第三位是 2。下一位数字是 8，大于或等于 5，因此我们将最后一位有效数字向上取整。\n$$\n\\text{RMSEC} \\approx 0.0283 \\ \\text{mg/mL}\n$$", "answer": "$$\\boxed{0.0283}$$", "id": "1459311"}, {"introduction": "一个较高的误差值（如 RMSEC）告诉我们模型表现不佳，但并未解释其原因。在模型开发中，一个常见的陷阱是选择了错误的模型复杂度。这项练习通过分析一个仅使用过少潜变量构建的 PLS 模型，来探讨欠拟合和过拟合的概念。学会根据误差指标诊断欠拟合，对于优化 PLS 模型并找到简单性与预测能力之间的最佳平衡至关重要。[@problem_id:1459317]", "problem": "一位分析化学家正在使用偏最小二乘 (PLS) 回归建立一个定量模型，以确定液体配方中活性药物成分 (API) 的浓度。该模型使用近红外 (NIR) 光谱作为预测变量 ($X$)，并使用已知的 API 浓度作为响应变量 ($Y$)。\n\n该化学家仅使用一个潜变量建立了一个初始 PLS 模型。为了评估其性能，他们计算了训练数据集上的校准均方根误差 (RMSEC) 和独立验证数据集上的预测均方根误差 (RMSEP)。该化学家观察到 RMSEC 和 RMSEP 都高得不可接受，并且它们的值彼此非常接近。\n\n基于这一观察，以下哪个陈述为模型性能不佳提供了最可能的诊断？\n\nA. 模型对训练数据过拟合，因为它捕获的是随机噪声，而不是光谱与浓度之间的系统关系。\n\nB. 模型对数据欠拟合，因为单个潜变量不足以捕获光谱数据中与浓度相关的复杂方差。\n\nC. 验证集中的浓度超出了校准集中使用的浓度范围，使得准确预测变得不可能。\n\nD. NIR 光谱主要由随机仪器噪声主导，该噪声远大于与 API 相关的信号，因此无法建立有意义的模型。", "solution": "这个问题的目标是根据来自校准和验证数据集的误差指标，诊断偏最小二乘 (PLS) 回归模型的性能。\n\n首先，让我们理解关键概念。PLS 是一种多元回归技术，它对一组预测变量（$X$，光谱）和一个或多个响应变量（$Y$，浓度）之间的关系进行建模。它通过构建一组正交的潜变量 (LVs) 来实现这一点，这些潜变量是原始预测变量的线性组合。选择这些 LV 是为了最大化 $X$ 和 $Y$ 之间的协方差。\n\nPLS 模型中使用的潜变量数量决定了其复杂性。\n- 潜变量太少的模型是一个简单的模型。它可能不够复杂，无法捕获数据中所有与预测相关的系统性变异。这种情况被称为**欠拟合 (underfitting)**。欠拟合的模型在其训练数据上表现不佳，在新的、未见过的数据上也表现不佳。欠拟合的一个关键特征是，训练集上的误差（例如，校准均方根误差，RMSEC）很高，并且独立测试集上的误差（例如，预测均方根误差，RMSEP）也很高，且其量级与训练误差相似 (RMSEC ≈ RMSEP)。\n\n- 潜变量太多的模型是一个过于复杂的模型。它不仅开始拟合训练数据中有系统性、有意义的变异，还开始拟合随机噪声。这种情况被称为**过拟合 (overfitting)**。过拟合的模型在训练数据上表现极好（RMSEC 非常低），但在新的、未见过的数据上表现不佳，因为它在训练集中学到的噪声在新数据中并不存在。过拟合的一个关键特征是 RMSEC 非常低，而 RMSEP 则显著更高。\n\n在所描述的场景中，化学家仅用一个潜变量建立了一个 PLS 模型。他们发现 RMSEC 和 RMSEP 都很高，并且数值上彼此接近。这种模式——在训练集和验证集上都有高误差——是欠拟合模型的典型标志。该模型过于简单，无法充分描述 NIR 光谱与 API 浓度之间的关系。单个潜变量不足以捕获必要的信息。\n\n让我们评估给定的选项：\n\nA. 模型过拟合。这是不正确的。过拟合的特征是 RMSEC 非常低而 RMSEP 很高，这与观察到的 RMSEC 和 RMSEP 都很高且相似的情况相矛盾。过拟合通常发生在使用了*太多*潜变量时，而不是太少。\n\nB. 模型欠拟合。这是正确的。观察到高且相似的 RMSEC 和 RMSEP 是欠拟合模型的明确标志。单个潜变量很可能不足以捕获复杂配方中与 API 浓度相关的光谱特征。\n\nC. 验证集的浓度超出了校准范围。虽然这肯定会导致高 RMSEP（一个外推问题），但这并不能解释为什么校准集上的 RMSEC 也高得不可接受。高 RMSEC 表明模型未能描述训练数据本身，这指向了根本的模型缺陷（欠拟合），而不仅仅是验证集的问题。\n\nD. 数据主要由噪声主导，因此不可能建立模型。虽然高噪声会降低模型性能，但给出的诊断信息（RMSEC ≈ RMSEP 且两者都很高）明确指出欠拟合是*这个特定模型构建*（仅使用一个 LV）的主要问题。一个更复杂的模型（具有更多 LV）很可能能够从噪声中提取信号并表现得更好。这个选项暗示数据是无用的，这是一个比证据所能支持的更为极端的结论。最直接的诊断是模型的复杂性太低。\n\n因此，最准确的诊断是模型对数据欠拟合。", "answer": "$$\\boxed{B}$$", "id": "1459317"}, {"introduction": "一旦建立了稳健的 PLS 模型，它就可以用于分析新的未知样品。然而，我们还必须判断这些新样品在模型的适用范围内是否“有效”。这项练习介绍了两个强大的诊断工具——霍特林 $T^2$ 统计量和 Q 残差，它们有助于区分不同类型的异常样品。理解这些统计量能让化学家判断一个样品是极端情况（例如浓度极高）还是包含了模型未涵盖的现象（例如存在干扰物），这对于可靠的质量控制至关重要。[@problem_id:1459316]", "problem": "一位分析化学家正在使用偏最小二乘 (PLS) 回归开发多变量校准模型。目标是利用近红外 (NIR) 光谱仪的数据来预测药物片剂中活性药物成分 (API) 的浓度。该模型是使用一组已知的 API 浓度范围为 1.0 mg/g 到 5.0 mg/g 的校准标准品建立的。\n\n建立 PLS 模型后，该化学家使用它来分析两个新的未知生产样品，标记为样品 X 和样品 Y。计算这些样品的诊断统计数据，并与模型建立的 95% 置信限进行比较：\n\n- **样品 X**：其霍特林 (Hotelling) $T^2$ 值显著*高于*置信限，但其 Q 残差值远*低于*置信限。\n- **样品 Y**：其霍特林 (Hotelling) $T^2$ 值远*低于*置信限，但其 Q 残差值显著*高于*置信限。\n\n根据这些诊断结果，以下哪个陈述为样品 X 和样品 Y 提供了化学和统计上最合理的解释？\n\nA. 样品 X 可能是一个有效样品，其 API 浓度超出了模型的校准范围（例如，显著高于 5.0 mg/g），而样品 Y 可能含有一种未建模的化学干扰物，或者其光谱受到了校准集中不存在的物理差异的影响（例如，不同的粒径）。\n\nB. 样品 Y 可能是一个有效样品，其 API 浓度超出了模型的校准范围，而样品 X 可能含有一种未建模的化学干扰物或在错误的仪器条件下测量。\n\nC. 样品 X 的高 $T^2$ 值表明它是一个极端样品，验证了模型在极限情况下的预测能力，而样品 Y 的高 Q 残差表明其 API 浓度非常接近校准集的平均值。\n\nD. 两个样品都被认为是异常值，必须丢弃。样品 X 的高 $T^2$ 值表明其测量中存在过多的随机噪声，而样品 Y 的高 Q 残差表明其测量过程中仪器波长对准存在系统误差。\n\nE. 样品 X 的低 Q 残差表明其 API 浓度为零，而样品 Y 的高 Q 残差表明其 API 浓度恰好是校准集的平均值。", "solution": "我们在 PLS 潜空间中对近红外光谱进行建模。对于一个具有 $A$ 个潜变量的校准模型，其 $X$ 块（光谱）被建模为\n$$\nX \\approx T P^{\\top}, \n$$\n其中得分矩阵 $T \\in \\mathbb{R}^{n \\times A}$，载荷矩阵 $P \\in \\mathbb{R}^{p \\times A}$。对于一个新的样品光谱 $x \\in \\mathbb{R}^{p}$，其在训练好的模型下的得分向量 $t \\in \\mathbb{R}^{A}$ 可以计算为\n$$\nt = x W \\left(P^{\\top} W\\right)^{-1},\n$$\n其中 $W \\in \\mathbb{R}^{p \\times A}$ 是来自 PLS 模型的 $X$ 权重。从模型子空间重构 $x$ 为\n$$\n\\hat{x} = t P^{\\top},\n$$\n其残差（与模型子空间正交）为\n$$\ne = x - \\hat{x}.\n$$\n然后定义两个标准诊断统计量。建模子空间中的霍特林统计量为\n$$\nT^{2} = t^{\\top} S_{T}^{-1} t,\n$$\n其中 $S_{T} \\in \\mathbb{R}^{A \\times A}$ 是校准得分的协方差矩阵。一个大的 $T^{2}$ 值表明 $t$ 相对于校准得分分布而言是极端的（高杠杆率），但仍在建模的子空间内。正交残差度量（Q残差或平方预测误差）为\n$$\nQ = e^{\\top} e = \\left\\|x - \\hat{x}\\right\\|^{2},\n$$\n它量化了模型子空间未能捕捉到的 $x$ 中的方差。置信水平为 $\\alpha$（此处 $\\alpha=0.95$）的置信限 $T^{2}_{\\alpha}$ 和 $Q_{\\alpha}$ 是从校准集中确定的。\n\n解释从这些定义出发：\n1) 样品 X 具有 $T^{2} > T^{2}_{0.95}$ 和 $Q  Q_{0.95}$。条件 $Q  Q_{0.95}$ 意味着 $e^{\\top} e$ 很小，因此 $x$ 能被建模的子空间很好地表示，并且不包含显著的未建模光谱结构。条件 $T^{2} > T^{2}_{0.95}$ 意味着 $t$ 是模型所张成的潜空间中的一个极值点。在为预测 API 浓度而建立的 PLS 模型中，主导的潜变量捕捉了光谱与 API 浓度之间的协方差。因此，在得分上是极值但仍能被模型很好地描述，这与沿着建模的浓度方向进行外推最一致，即一个有效的样品光谱，其 API 浓度位于校准范围的边缘或之外（例如，大于 5.0 mg/g 的上限）。\n\n2) 样品 Y 具有 $T^{2}  T^{2}_{0.95}$ 和 $Q > Q_{0.95}$。条件 $T^{2}  T^{2}_{0.95}$ 意味着，在建模的子空间中，$t$ 不是极值；它位于校准得分分布的中心附近，因此并不表示沿着建模方向存在异常高或低的 API 浓度。条件 $Q > Q_{0.95}$ 意味着存在与模型子空间正交的大量残差方差，即校准模型未捕捉到的光谱特征。从化学和物理角度来看，这指向一种未建模的干扰物，或样品/测量条件与校准集相比存在系统性差异（例如，不同的粒径分布、水分、基线或光程差异，或仪器差异）。\n\n这些结论排除了其他选项：\n- 将高 $T^{2}$ 归因于随机噪声是不正确的，因为随机噪声主要贡献给 $Q$，而不是对建模子空间内的杠杆率产生影响。\n- 将高 $Q$ 解释为浓度接近校准平均值是不正确的；$Q$ 衡量的是拟合不足，而不是在建模浓度方向上的位置。\n- 低 $Q$ 并不意味着浓度为零；它只表明光谱能被模型子空间很好地描述。\n\n因此，化学和统计上合理的解释是，样品 X 是一个沿着建模的 API 浓度方向的有效但极端的样品（可能超出了校准范围），而样品 Y 可能由于存在干扰物或与校准集相比的物理差异而表现出未建模的光谱方差。\n\n因此，正确选项是 A。", "answer": "$$\\boxed{A}$$", "id": "1459316"}]}