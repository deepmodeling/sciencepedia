{"hands_on_practices": [{"introduction": "对于由相同粒子组成的体系，其能量不应依赖于我们如何标记这些粒子，这是量子力学的一条基本对称性原理。任何物理上有效的势能面（PES）都必须遵守这种置换不变性。这个练习 [@problem_id:2908410] 将通过一个简化的模型，清晰地展示违反该原理会导致的非物理后果，例如能量简并的分裂。理解这一点是掌握神经网络势（NNP）结构设计背后动机的关键第一步。", "problem": "在针对氢分子阳离子 $\\mathrm{H}_3^+$ 的玻恩-奥本海默（BO）近似中，其精确势能面（PES）$E_{\\mathrm{BO}}(\\{\\mathbf{R}_i\\})$ 在三个相同的氢核位置 $\\{\\mathbf{R}_1,\\mathbf{R}_2,\\mathbf{R}_3\\}$ 的任意置换下保持不变。现在考虑一个学习得到的神经网络势（NNP），该势通过在平移不变但按索引排序的描述符上使用按原子索引的线性贡献，从而违反了置换不变性。具体来说，对于核位置 $\\{\\mathbf{R}_i\\}_{i=1}^3 \\subset \\mathbb{R}^3$，定义中心化坐标 $\\mathbf{s}_i = \\mathbf{R}_i - \\frac{1}{3}\\sum_{j=1}^3 \\mathbf{R}_j$，并设预测能量为\n$$\nE_{\\boldsymbol{\\theta}}(\\mathbf{R}_1,\\mathbf{R}_2,\\mathbf{R}_3) = b + \\sum_{i=1}^{3} \\mathbf{u}_i \\cdot \\mathbf{s}_i,\n$$\n其中 $b \\in \\mathbb{R}$ 是一个标量偏置，$\\mathbf{u}_i \\in \\mathbb{R}^3$ 是独立的、按原子索引的权重向量，$\\mathbf{u}_i = (u_{ix},u_{iy},u_{iz})$。该模型在构造上是平移不变的，但除非 $\\mathbf{u}_1=\\mathbf{u}_2=\\mathbf{u}_3$，否则它不是置换不变的。\n\n考虑在 $z=0$ 平面内边长为 $R>0$ 的等边三角形构型，其实验室坐标系下的坐标如下：\n$$\n\\mathbf{R}_1 = (0,0,0),\\quad \\mathbf{R}_2 = (R,0,0),\\quad \\mathbf{R}_3 = \\left(\\frac{R}{2}, \\frac{\\sqrt{3}R}{2}, 0\\right).\n$$\n定义两个物理上等同但标签不同的输入：构型 $\\mathcal{G}_A$ 使用给定的标签 $(1,2,3)$，而构型 $\\mathcal{G}_B$ 是通过置换标签 $1 \\leftrightarrow 2$（即 $(2,1,3)$）得到的。因为 $\\mathrm{H}_3^+$ 有三个相同的核，所以 $E_{\\mathrm{BO}}$ 必须满足 $E_{\\mathrm{BO}}(\\mathcal{G}_A)=E_{\\mathrm{BO}}(\\mathcal{G}_B)$。然而，模型 $E_{\\boldsymbol{\\theta}}$ 不必满足此条件。\n\n从 BO 哈密顿量的置换对称性和上述 $E_{\\boldsymbol{\\theta}}$ 的定义出发，推导出预测的简并分裂\n$$\n\\Delta E \\equiv E_{\\boldsymbol{\\theta}}(\\mathcal{G}_A) - E_{\\boldsymbol{\\theta}}(\\mathcal{G}_B)\n$$\n关于 $R$ 和权重分量 $u_{ix},u_{iy},u_{iz}$ 的闭式解析表达式。将您的最终答案表示为单个简化的解析表达式。不要对结果进行数值计算或四舍五入。最终表达式不需要单位。", "solution": "在继续之前，对问题进行验证。\n\n第1步：提取已知条件。\n- 系统是氢分子阳离子 $\\mathrm{H}_3^+$。\n- 玻恩-奥本海默（BO）势能面（PES）是 $E_{\\mathrm{BO}}(\\{\\mathbf{R}_i\\})$。\n- $E_{\\mathrm{BO}}$ 在位置 $\\{\\mathbf{R}_1,\\mathbf{R}_2,\\mathbf{R}_3\\}$ 的任意置换下保持不变。\n- 一个学习得到的神经网络势（NNP）定义为 $E_{\\boldsymbol{\\theta}}(\\mathbf{R}_1,\\mathbf{R}_2,\\mathbf{R}_3) = b + \\sum_{i=1}^{3} \\mathbf{u}_i \\cdot \\mathbf{s}_i$。\n- $b \\in \\mathbb{R}$ 是一个标量偏置。\n- $\\mathbf{u}_i \\in \\mathbb{R}^3$ 是独立的、按原子索引的权重向量，$\\mathbf{u}_i = (u_{ix},u_{iy},u_{iz})$。\n- 中心化坐标是 $\\mathbf{s}_i = \\mathbf{R}_i - \\frac{1}{3}\\sum_{j=1}^3 \\mathbf{R}_j$。\n- 该模型是平移不变的，但不一定是置换不变的。\n- 在 $z=0$ 平面内给定一个边长为 $R>0$ 的等边三角形构型，其坐标为：$\\mathbf{R}_1 = (0,0,0)$, $\\mathbf{R}_2 = (R,0,0)$, $\\mathbf{R}_3 = \\left(\\frac{R}{2}, \\frac{\\sqrt{3}R}{2}, 0\\right)$。\n- 构型 $\\mathcal{G}_A$ 对应于给定的标签 $(1,2,3)$。\n- 构型 $\\mathcal{G}_B$ 对应于通过置换标签 $1 \\leftrightarrow 2$ 得到的标签 $(2,1,3)$。\n- 目标是推导简并分裂 $\\Delta E \\equiv E_{\\boldsymbol{\\theta}}(\\mathcal{G}_A) - E_{\\boldsymbol{\\theta}}(\\mathcal{G}_B)$ 的表达式。\n\n第2步：验证。\n该问题具有科学依据，是适定且客观的。它利用了量子化学（玻恩-奥本海默近似、势能面、置换对称性）和机器学习（神经网络势、输入特征）中的标准概念。所提出的模型虽然简单，但它是一个有效的数学构造，用于展示对称性破缺的后果，而这是该领域的一个关键课题。所有术语的定义都明确无歧义，所需信息是完整的，且前提是一致的。该问题是一个可形式化和可验证的数学练习，而不是一个琐碎或不适定的问题。\n\n第3步：结论。\n该问题有效。将提供解答。\n\n目标是计算简并分裂 $\\Delta E$，其定义为：\n$$\n\\Delta E \\equiv E_{\\boldsymbol{\\theta}}(\\mathcal{G}_A) - E_{\\boldsymbol{\\theta}}(\\mathcal{G}_B)\n$$\n对于一组给定的原子位置 $\\{\\mathbf{R}_1, \\mathbf{R}_2, \\mathbf{R}_3\\}$，模型预测的能量是：\n$$\nE_{\\boldsymbol{\\theta}}(\\mathbf{R}_1,\\mathbf{R}_2,\\mathbf{R}_3) = b + \\sum_{i=1}^{3} \\mathbf{u}_i \\cdot \\mathbf{s}_i\n$$\n其中 $\\mathbf{s}_i = \\mathbf{R}_i - \\mathbf{R}_{\\text{COM}}$ 是中心化坐标，$\\mathbf{R}_{\\text{COM}} = \\frac{1}{3}\\sum_{j=1}^3 \\mathbf{R}_j$ 是核中心。权重向量 $\\mathbf{u}_i$ 按原子标签索引。\n\n首先，我们计算构型 $\\mathcal{G}_A$ 的能量。其坐标为 $\\mathbf{R}_1^{(A)} = (0,0,0)$、$\\mathbf{R}_2^{(A)} = (R,0,0)$ 和 $\\mathbf{R}_3^{(A)} = \\left(\\frac{R}{2}, \\frac{\\sqrt{3}R}{2}, 0\\right)$。\n位置中心是：\n$$\n\\mathbf{R}_{\\text{COM}} = \\frac{1}{3}\\left[ (0,0,0) + (R,0,0) + \\left(\\frac{R}{2}, \\frac{\\sqrt{3}R}{2}, 0\\right) \\right] = \\frac{1}{3}\\left(\\frac{3R}{2}, \\frac{\\sqrt{3}R}{2}, 0\\right) = \\left(\\frac{R}{2}, \\frac{\\sqrt{3}R}{6}, 0\\right)\n$$\n构型 $\\mathcal{G}_A$ 的中心化坐标是：\n$$\n\\mathbf{s}_1^{(A)} = \\mathbf{R}_1^{(A)} - \\mathbf{R}_{\\text{COM}} = (0,0,0) - \\left(\\frac{R}{2}, \\frac{\\sqrt{3}R}{6}, 0\\right) = \\left(-\\frac{R}{2}, -\\frac{\\sqrt{3}R}{6}, 0\\right)\n$$\n$$\n\\mathbf{s}_2^{(A)} = \\mathbf{R}_2^{(A)} - \\mathbf{R}_{\\text{COM}} = (R,0,0) - \\left(\\frac{R}{2}, \\frac{\\sqrt{3}R}{6}, 0\\right) = \\left(\\frac{R}{2}, -\\frac{\\sqrt{3}R}{6}, 0\\right)\n$$\n$$\n\\mathbf{s}_3^{(A)} = \\mathbf{R}_3^{(A)} - \\mathbf{R}_{\\text{COM}} = \\left(\\frac{R}{2}, \\frac{\\sqrt{3}R}{2}, 0\\right) - \\left(\\frac{R}{2}, \\frac{\\sqrt{3}R}{6}, 0\\right) = \\left(0, \\frac{\\sqrt{3}R}{2} - \\frac{\\sqrt{3}R}{6}, 0\\right) = \\left(0, \\frac{\\sqrt{3}R}{3}, 0\\right)\n$$\n因此，构型 $\\mathcal{G}_A$ 的能量为：\n$$\nE_{\\boldsymbol{\\theta}}(\\mathcal{G}_A) = b + \\mathbf{u}_1 \\cdot \\mathbf{s}_1^{(A)} + \\mathbf{u}_2 \\cdot \\mathbf{s}_2^{(A)} + \\mathbf{u}_3 \\cdot \\mathbf{s}_3^{(A)}\n$$\n接下来，我们考虑构型 $\\mathcal{G}_B$，它是通过置换 $\\mathcal{G}_A$ 的标签 $1 \\leftrightarrow 2$ 得到的。构型 $\\mathcal{G}_B$ 的坐标为 $\\mathbf{R}_1^{(B)} = \\mathbf{R}_2^{(A)}$、$\\mathbf{R}_2^{(B)} = \\mathbf{R}_1^{(A)}$ 和 $\\mathbf{R}_3^{(B)} = \\mathbf{R}_3^{(A)}$。位置向量的集合是相同的，所以中心 $\\mathbf{R}_{\\text{COM}}$ 保持不变。中心化坐标计算为 $\\mathbf{s}_i^{(B)} = \\mathbf{R}_i^{(B)} - \\mathbf{R}_{\\text{COM}}$。\n$$\n\\mathbf{s}_1^{(B)} = \\mathbf{R}_1^{(B)} - \\mathbf{R}_{\\text{COM}} = \\mathbf{R}_2^{(A)} - \\mathbf{R}_{\\text{COM}} = \\mathbf{s}_2^{(A)}\n$$\n$$\n\\mathbf{s}_2^{(B)} = \\mathbf{R}_2^{(B)} - \\mathbf{R}_{\\text{COM}} = \\mathbf{R}_1^{(A)} - \\mathbf{R}_{\\text{COM}} = \\mathbf{s}_1^{(A)}\n$$\n$$\n\\mathbf{s}_3^{(B)} = \\mathbf{R}_3^{(B)} - \\mathbf{R}_{\\text{COM}} = \\mathbf{R}_3^{(A)} - \\mathbf{R}_{\\text{COM}} = \\mathbf{s}_3^{(A)}\n$$\n模型的权重 $\\mathbf{u}_i$ 与原子索引固定，而不是与它们的位置固定。因此，构型 $\\mathcal{G}_B$ 的能量为：\n$$\nE_{\\boldsymbol{\\theta}}(\\mathcal{G}_B) = b + \\mathbf{u}_1 \\cdot \\mathbf{s}_1^{(B)} + \\mathbf{u}_2 \\cdot \\mathbf{s}_2^{(B)} + \\mathbf{u}_3 \\cdot \\mathbf{s}_3^{(B)}\n$$\n代入上面找到的关系：\n$$\nE_{\\boldsymbol{\\theta}}(\\mathcal{G}_B) = b + \\mathbf{u}_1 \\cdot \\mathbf{s}_2^{(A)} + \\mathbf{u}_2 \\cdot \\mathbf{s}_1^{(A)} + \\mathbf{u}_3 \\cdot \\mathbf{s}_3^{(A)}\n$$\n现在我们计算分裂 $\\Delta E$：\n$$\n\\Delta E = E_{\\boldsymbol{\\theta}}(\\mathcal{G}_A) - E_{\\boldsymbol{\\theta}}(\\mathcal{G}_B) = \\left(b + \\mathbf{u}_1 \\cdot \\mathbf{s}_1^{(A)} + \\mathbf{u}_2 \\cdot \\mathbf{s}_2^{(A)} + \\mathbf{u}_3 \\cdot \\mathbf{s}_3^{(A)}\\right) - \\left(b + \\mathbf{u}_1 \\cdot \\mathbf{s}_2^{(A)} + \\mathbf{u}_2 \\cdot \\mathbf{s}_1^{(A)} + \\mathbf{u}_3 \\cdot \\mathbf{s}_3^{(A)}\\right)\n$$\n偏置 $b$ 和原子3的项相互抵消，剩下：\n$$\n\\Delta E = \\mathbf{u}_1 \\cdot \\mathbf{s}_1^{(A)} + \\mathbf{u}_2 \\cdot \\mathbf{s}_2^{(A)} - \\mathbf{u}_1 \\cdot \\mathbf{s}_2^{(A)} - \\mathbf{u}_2 \\cdot \\mathbf{s}_1^{(A)}\n$$\n这个表达式可以通过组合权重向量来重新排列：\n$$\n\\Delta E = (\\mathbf{u}_1 - \\mathbf{u}_2) \\cdot \\mathbf{s}_1^{(A)} - (\\mathbf{u}_1 - \\mathbf{u}_2) \\cdot \\mathbf{s}_2^{(A)}\n$$\n$$\n\\Delta E = (\\mathbf{u}_1 - \\mathbf{u}_2) \\cdot (\\mathbf{s}_1^{(A)} - \\mathbf{s}_2^{(A)})\n$$\n我们现在计算向量差 $(\\mathbf{s}_1^{(A)} - \\mathbf{s}_2^{(A)})$：\n$$\n\\mathbf{s}_1^{(A)} - \\mathbf{s}_2^{(A)} = \\left(-\\frac{R}{2}, -\\frac{\\sqrt{3}R}{6}, 0\\right) - \\left(\\frac{R}{2}, -\\frac{\\sqrt{3}R}{6}, 0\\right) = \\left(-\\frac{R}{2} - \\frac{R}{2}, -\\frac{\\sqrt{3}R}{6} + \\frac{\\sqrt{3}R}{6}, 0 - 0\\right) = (-R, 0, 0)\n$$\n最后，我们计算点积：\n$$\n\\Delta E = (u_{1x}-u_{2x}, u_{1y}-u_{2y}, u_{1z}-u_{2z}) \\cdot (-R, 0, 0)\n$$\n$$\n\\Delta E = (u_{1x}-u_{2x})(-R) + (u_{1y}-u_{2y})(0) + (u_{1z}-u_{2z})(0)\n$$\n$$\n\\Delta E = -R(u_{1x}-u_{2x}) = R(u_{2x}-u_{1x})\n$$\n这是预测的简并分裂的最终闭式表达式。它表明，对于这种特定的置换和构型，置换不变性的违反仅取决于边长 $R$ 和与被置换原子相关的权重向量的 $x$ 分量之差。对于一个置换不变的势，$\\mathbf{u}_1 = \\mathbf{u}_2$，这正确地意味着 $\\Delta E = 0$。", "answer": "$$\n\\boxed{R(u_{2x} - u_{1x})}\n$$", "id": "2908410"}, {"introduction": "在物理学中，由势能函数派生出的力场必须是保守场，这意味着沿任何闭合路径所做的功都为零。这个练习 [@problem_id:2908468] 探讨了一个假设情景：如果直接对力进行机器学习建模，而忽略其必须源于一个标量势的约束，将会发生什么。通过计算一个非保守力场沿闭合路径的功，我们能够量化其非物理效应，这凸显了坚持从单一标量势能 $E$ 导出力的基本原则（即 $\\mathbf{F} = -\\nabla E$）的重要性。", "problem": "在构建神经网络势能面（NN-PES）的力匹配方法中，通常的做法是直接回归力，而不显式地积分一个标量能量。然而，从标量势导出的物理力必须是保守的。考虑一个玩具二维内部坐标空间，其坐标为 $\\mathbf{q} = (q_{1}, q_{2})$，单位为原子单位（长度为玻尔），表示参考几何结构附近构型空间的一个局部区域。假设一个仅基于力的回归产生了一个线性模型\n$$\n\\mathbf{F}(\\mathbf{q}) = \\mathbf{W}\\,\\mathbf{q}, \\quad \\text{其中} \\quad \\mathbf{W} = \\alpha \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix},\n$$\n其中 $\\alpha$ 是一个常数。这种形式可能源于对局域力残差的无约束最小二乘拟合，并且不保证是可积的。\n\n仅使用保守场和作为线积分的功的基本定义，完成以下任务：\n\n1. 从第一性原理出发，论证 $\\mathbf{F}(\\mathbf{q})$ 是否可以是该域上任何标量能量 $E(\\mathbf{q})$ 的负梯度。\n\n2. 考虑由圆 $q_{1}^{2} + q_{2}^{2} = R^{2}$ 定义的闭合曲线 $C$，该圆以原点为中心，逆时针遍历一次。计算功\n$$\n\\oint_{C} \\mathbf{F}(\\mathbf{q}) \\cdot d\\mathbf{q}\n$$\n用 $\\alpha$ 和 $R$ 表示。\n\n3. 对 $\\alpha = 1$ Hartree/bohr$^{2}$ 和 $R = 1$ bohr 的情况，计算你的结果。最终的功以哈特里（Hartree）为单位表示。无需四舍五入。", "solution": "该问题要求分析给定的二维力场 $\\mathbf{F}(\\mathbf{q})$，以确定其是否保守，并计算沿特定闭合路径所做的功。\n\n首先，我们必须明确表示出力矢量 $\\mathbf{F}(\\mathbf{q})$ 的分量。力场定义为 $\\mathbf{F}(\\mathbf{q}) = \\mathbf{W}\\mathbf{q}$，其中 $\\mathbf{q} = \\begin{pmatrix} q_{1} \\\\ q_{2} \\end{pmatrix}$，矩阵 $\\mathbf{W}$ 由 $\\alpha \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$ 给出。\n执行矩阵-向量乘法：\n$$\n\\mathbf{F}(\\mathbf{q}) = \\alpha \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix} \\begin{pmatrix} q_{1} \\\\ q_{2} \\end{pmatrix} = \\alpha \\begin{pmatrix} q_{2} \\\\ -q_{1} \\end{pmatrix} = \\begin{pmatrix} \\alpha q_{2} \\\\ -\\alpha q_{1} \\end{pmatrix}\n$$\n所以，力场的分量是 $F_{1}(q_{1}, q_{2}) = \\alpha q_{2}$ 和 $F_{2}(q_{1}, q_{2}) = -\\alpha q_{1}$。\n\n第一个任务是确定该力场是否可以表示为标量势能函数 $E(q_{1}, q_{2})$ 的负梯度，即 $\\mathbf{F} = -\\nabla E$。一个矢量场在一个单连通域（如整个平面 $\\mathbb{R}^{2}$）上是梯度场（即是保守场）的必要条件是其旋度必须为零。对于二维矢量场 $\\mathbf{F} = (F_{1}, F_{2})$，此条件简化为从势函数导出的混合偏导数相等：\n$$\n\\frac{\\partial F_{1}}{\\partial q_{2}} = \\frac{\\partial F_{2}}{\\partial q_{1}}\n$$\n这是 Clairaut 定理的直接推论，假设势 $E$ 是二阶连续可微的，因为 $\\frac{\\partial}{\\partial q_{2}}(-\\frac{\\partial E}{\\partial q_{1}}) = \\frac{\\partial}{\\partial q_{1}}(-\\frac{\\partial E}{\\partial q_{2}})$。\n让我们对给定的力场检验这个条件。\n我们计算偏导数：\n$$\n\\frac{\\partial F_{1}}{\\partial q_{2}} = \\frac{\\partial}{\\partial q_{2}}(\\alpha q_{2}) = \\alpha\n$$\n$$\n\\frac{\\partial F_{2}}{\\partial q_{1}} = \\frac{\\partial}{\\partial q_{1}}(-\\alpha q_{1}) = -\\alpha\n$$\n为使该条件成立，我们必须有 $\\alpha = -\\alpha$，这意味着 $2\\alpha = 0$，或 $\\alpha = 0$。如果 $\\alpha \\neq 0$，该条件不成立。问题背景，特别是 $\\mathbf{W}$ 的非零结构，意味着 $\\alpha$ 是一个非零参数。因此，力场 $\\mathbf{F}(\\mathbf{q})$ 是非保守的，不能是任何标量能量 $E(\\mathbf{q})$ 的负梯度。\n\n第二个任务是计算力场沿由 $q_{1}^{2} + q_{2}^{2} = R^{2}$ 定义的、逆时针遍历的闭合圆形路径 $C$ 所做的功。功 $W$ 由线积分给出：\n$$\nW = \\oint_{C} \\mathbf{F}(\\mathbf{q}) \\cdot d\\mathbf{q}\n$$\n为了计算这个积分，我们首先对路径 $C$ 进行参数化。半径为 $R$ 的圆的标准逆时针参数化是：\n$$\n\\mathbf{q}(t) = (q_{1}(t), q_{2}(t)) = (R \\cos(t), R \\sin(t)) \\quad \\text{对于 } t \\in [0, 2\\pi]\n$$\n微分位移矢量 $d\\mathbf{q}$ 通过对 $\\mathbf{q}(t)$ 关于参数 $t$ 求导得到：\n$$\nd\\mathbf{q} = \\frac{d\\mathbf{q}}{dt} dt = \\left( \\frac{d}{dt}(R \\cos(t)), \\frac{d}{dt}(R \\sin(t)) \\right) dt = (-R \\sin(t), R \\cos(t)) dt\n$$\n接下来，我们计算路径 $C$ 上的力场 $\\mathbf{F}$：\n$$\n\\mathbf{F}(\\mathbf{q}(t)) = (\\alpha q_{2}(t), -\\alpha q_{1}(t)) = (\\alpha R \\sin(t), -\\alpha R \\cos(t))\n$$\n现在我们计算点积 $\\mathbf{F}(\\mathbf{q}(t)) \\cdot \\frac{d\\mathbf{q}}{dt}$：\n$$\n\\mathbf{F} \\cdot \\frac{d\\mathbf{q}}{dt} = (\\alpha R \\sin(t), -\\alpha R \\cos(t)) \\cdot (-R \\sin(t), R \\cos(t))\n$$\n$$\n= (\\alpha R \\sin(t))(-R \\sin(t)) + (-\\alpha R \\cos(t))(R \\cos(t))\n$$\n$$\n= -\\alpha R^{2} \\sin^{2}(t) - \\alpha R^{2} \\cos^{2}(t) = -\\alpha R^{2} (\\sin^{2}(t) + \\cos^{2}(t)) = -\\alpha R^{2}\n$$\n功的积分于是变为：\n$$\nW = \\int_{0}^{2\\pi} (-\\alpha R^{2}) dt = -\\alpha R^{2} \\int_{0}^{2\\pi} dt = -\\alpha R^{2} [t]_{0}^{2\\pi} = -\\alpha R^{2} (2\\pi - 0)\n$$\n$$\nW = -2\\pi \\alpha R^{2}\n$$\n这个结果表明，对于任何 $\\alpha \\neq 0$ 和 $R > 0$，沿闭合回路所做的功非零。这从功的基本定义出发，提供了一个独立且明确的证明，证明了该力场是非保守的，从而证实了第一部分的结论。\n\n第三个任务是针对特定值 $\\alpha = 1$ Hartree/bohr$^{2}$ 和 $R = 1$ bohr 计算这个功。将这些值代入我们关于 $W$ 的表达式中：\n$$\nW = -2\\pi (1 \\text{ Hartree/bohr}^{2}) (1 \\text{ bohr})^{2}\n$$\n单位正确地组合以产生能量：\n$$\n\\text{Hartree} \\cdot \\text{bohr}^{-2} \\cdot \\text{bohr}^{2} = \\text{Hartree}\n$$\n功的数值是：\n$$\nW = -2\\pi\n$$\n结果以哈特里（Hartree）为单位，符合要求。", "answer": "$$\\boxed{-2\\pi}$$", "id": "2908468"}, {"introduction": "在理解了置换不变性和力的保守性这两个关键的物理约束之后，我们现在可以构建一个能够自然满足这些约束的现代模型。这个练习 [@problem_id:2908437] 提供了一个消息传递神经网络（一种图神经网络）单次前向传播的实践操作。通过逐步完成计算，您将看到这种架构如何通过原子间的消息传递和聚合来内在地保证置换不变性，并最终得到一个总能量，从而可以导出保守力。", "problem": "要求您实现单层消息传递网络的一次确定性前向传播，以在玻恩–奥本海默近似下逼近原子势能面。该模型应为一个简单的平移和旋转不变架构，通过汇集每个原子的贡献，将原子核几何结构映射到一个标量总能量。数学设计受以下基本原理约束：(1) 在玻恩–奥本海默近似下，势能面仅取决于原子核的坐标和电荷；(2) 通过仅使用两两原子间的距离来强制实现对全局平移和旋转的不变性；(3) 总能量是每个原子贡献的总和。您必须使用规定的标量和张量操作以及提供的数值参数来实现完整的计算，并为每个测试用例返回一个单行输出，其中包含所有中间消息、更新后的特征以及汇集后的能量。\n\n下面使用的所有数学实体都用 LaTeX 定义，必须严格遵守。\n\n定义和参数：\n- 隐藏特征维度：$d_h = 2$。\n- 初始嵌入（无量纲）：\n  - 氢 $\\left(Z = 1\\right)$: $\\mathbf{h}_{\\mathrm{H}} = \\begin{bmatrix} 0.40 \\\\ -0.10 \\end{bmatrix}$。\n  - 碳 $\\left(Z = 6\\right)$: $\\mathbf{h}_{\\mathrm{C}} = \\begin{bmatrix} 0.00 \\\\ 0.50 \\end{bmatrix}$。\n  - 氧 $\\left(Z = 8\\right)$: $\\mathbf{h}_{\\mathrm{O}} = \\begin{bmatrix} 0.80 \\\\ 0.20 \\end{bmatrix}$。\n- 从原子 $j$ 到原子 $i$ 的有向消息：\n  - 令 $\\mathbf{h}_j \\in \\mathbb{R}^{2}$ 为原子 $j$ 的当前隐藏特征。\n  - 线性消息预激活：$\\mathbf{z}_{j} = \\mathbf{W}_m \\mathbf{h}_j + \\mathbf{b}_m$，其中\n    $$\\mathbf{W}_m = \\begin{bmatrix} 0.60  -0.20 \\\\ 0.15  0.30 \\end{bmatrix}, \\quad \\mathbf{b}_m = \\begin{bmatrix} 0.05 \\\\ -0.05 \\end{bmatrix}.$$\n  - 非线性：$\\phi(\\cdot) = \\tanh(\\cdot)$ 按元素应用，因此 $\\tilde{\\mathbf{m}}_{j} = \\phi(\\mathbf{z}_{j})$。\n  - 原子 $i$ 和 $j$ 的位置为 $\\mathbf{r}_i, \\mathbf{r}_j \\in \\mathbb{R}^{3}$（单位为埃），它们之间的距离为 $r_{ij} = \\lVert \\mathbf{r}_i - \\mathbf{r}_j \\rVert_2$。\n  - 径向滤波器（高斯函数）：$f(r) = \\exp\\!\\left(-\\dfrac{(r - \\mu)^2}{2 \\sigma^2}\\right)$，其中 $\\mu = 1.00$ 埃，$\\sigma = 0.50$ 埃。\n  - 有向消息：$\\mathbf{m}_{i \\leftarrow j} = f(r_{ij}) \\cdot \\tilde{\\mathbf{m}}_{j}$。\n- 原子 $i$ 的消息聚合：$\\mathbf{m}_i = \\sum_{j \\neq i} \\mathbf{m}_{i \\leftarrow j}$。\n- 原子 $i$ 的更新规则：\n  - 拼接 $\\mathbf{h}_i$ 和 $\\mathbf{m}_i$ 形成 $\\mathbf{u}_i = \\begin{bmatrix} \\mathbf{h}_i \\\\ \\mathbf{m}_i \\end{bmatrix} \\in \\mathbb{R}^{4}$。\n  - 线性更新：$\\mathbf{q}_i = \\mathbf{W}_u \\mathbf{u}_i + \\mathbf{b}_u$，其中\n    $$\\mathbf{W}_u = \\begin{bmatrix} 0.50  0.10  0.20  -0.30 \\\\ -0.40  0.25  0.10  0.15 \\end{bmatrix}, \\quad \\mathbf{b}_u = \\begin{bmatrix} 0.00 \\\\ 0.10 \\end{bmatrix}.$$\n  - 非线性更新特征：$\\mathbf{h}_i' = \\phi(\\mathbf{q}_i)$，其中 $\\phi = \\tanh$ 按元素应用。\n- 逐原子能量读出和汇集：\n  - 读出权重和偏置：$\\mathbf{v} = \\begin{bmatrix} 1.50 \\\\ -0.50 \\end{bmatrix}$ 和 $c = -0.20$。\n  - 逐原子能量：$e_i = \\mathbf{v}^\\top \\mathbf{h}_i' + c$，单位为电子伏特。\n  - 总能量：$E = \\sum_i e_i$，单位为电子伏特。\n\n约束条件：\n- 包括所有 $i \\neq j$ 的有向消息（无自消息）。\n- 严格使用提供的参数。\n- 所有 $\\tanh$ 操作均使用双曲正切函数。\n- 所有距离必须以埃（ångström）为单位计算，总能量必须以电子伏特（electronvolts）为单位报告。\n\n每个测试用例的所需输出：\n- 一个扁平化的所有有向消息分量列表，顺序固定：按索引升序遍历原子 $i$，对每个 $i$ 按索引升序遍历发送者 $j$（其中 $j \\neq i$）；在每个有向消息向量内，按分量索引升序排列分量。\n- 一个扁平化的更新后特征 $\\mathbf{h}_i'$ 列表，按原子索引升序和分量索引升序排列。\n- 标量总能量 $E$。\n- 将所有浮点输出四舍五入到 $6$ 位小数。\n\n最终输出格式：\n- 您的程序必须生成一个单行，其中包含一个类似 JSON 的列表表示（不含空格），该列表包含每个用例的结果。\n- 每个用例的结果是一个包含三个元素的列表：扁平化的有向消息列表、扁平化的更新后特征列表和标量能量。\n- 例如，一个有效的输出行格式为：$[\\;[[m\\_1,\\dots],[h\\_1,\\dots],E\\_1],\\;[[m\\_2,\\dots],[h\\_2,\\dots],E\\_2]\\;]$，其中所有数字均按规定四舍五入。\n\n测试套件：\n- 案例 $1$（线性三原子分子）：原子 $\\left[ Z_1, Z_2, Z_3 \\right] = \\left[ 1, 6, 8 \\right]$，位置（单位：埃）\n  $$\\mathbf{r}_1 = \\begin{bmatrix} 0.00 \\\\ 0.00 \\\\ 0.00 \\end{bmatrix}, \\quad \\mathbf{r}_2 = \\begin{bmatrix} 1.10 \\\\ 0.00 \\\\ 0.00 \\end{bmatrix}, \\quad \\mathbf{r}_3 = \\begin{bmatrix} 2.30 \\\\ 0.00 \\\\ 0.00 \\end{bmatrix}.$$\n- 案例 $2$（双原子氢分子）：原子 $\\left[ Z_1, Z_2 \\right] = \\left[ 1, 1 \\right]$，位置\n  $$\\mathbf{r}_1 = \\begin{bmatrix} 0.00 \\\\ 0.00 \\\\ 0.00 \\end{bmatrix}, \\quad \\mathbf{r}_2 = \\begin{bmatrix} 0.74 \\\\ 0.00 \\\\ 0.00 \\end{bmatrix}.$$\n- 案例 $3$（单个氧原子）：原子 $\\left[ Z_1 \\right] = \\left[ 8 \\right]$，位置\n  $$\\mathbf{r}_1 = \\begin{bmatrix} 0.00 \\\\ 0.00 \\\\ 0.00 \\end{bmatrix}.$$\n\n不涉及角度单位。能量必须以电子伏特表示。您的程序应生成单行输出，其中包含一个类似JSON的列表（无空格），列表中的每个元素对应于上面列出的一个测试用例，并且每个测试用例由一个列表表示，该列表包含：扁平化的有向消息、扁平化的更新后特征和标量总能量，所有数值均四舍五入到 $6$ 位小数。", "solution": "问题陈述是有效的。它提出了一个定义明确、自成一体的计算任务，该任务基于计算化学中的既定原理，特别是神经网络势能面的构建。所有必需的参数、初始条件和数学运算都得到了明确无误的规定。任务是为三个给定的分子体系实现一个简单的消息传递神经网络的单次前向传播。\n\n解决方案是通过为每个测试用例系统地实现规定的操作序列来制定的。对于一个给定的含 $N$ 个原子的体系，总体过程如下：\n1.  根据每个原子 $i$ 的原子序数 $Z_i$ 初始化其隐藏特征向量 $\\mathbf{h}_i \\in \\mathbb{R}^{d_h}$。\n2.  对于 $i, j \\in \\{1,\\dots,N\\}$ 且 $i \\neq j$，计算所有有向消息 $\\mathbf{m}_{i \\leftarrow j}$。\n3.  聚合每个原子 $i$ 的传入消息以获得 $\\mathbf{m}_i$。\n4.  将每个原子的隐藏特征向量从 $\\mathbf{h}_i$ 更新为 $\\mathbf{h}_i'$。\n5.  从每个更新后的特征向量 $\\mathbf{h}_i'$ 中读出原子能量贡献 $e_i$。\n6.  将原子能量相加以获得总势能 $E = \\sum_i e_i$。\n\n提供的参数如下：\n- 隐藏特征维度：$d_h = 2$。\n- 初始嵌入：$\\mathbf{h}_{\\mathrm{H}} = \\begin{bmatrix} 0.40 \\\\ -0.10 \\end{bmatrix}$, $\\mathbf{h}_{\\mathrm{C}} = \\begin{bmatrix} 0.00 \\\\ 0.50 \\end{bmatrix}$, $\\mathbf{h}_{\\mathrm{O}} = \\begin{bmatrix} 0.80 \\\\ 0.20 \\end{bmatrix}$。\n- 消息线性层：$\\mathbf{W}_m = \\begin{bmatrix} 0.60  -0.20 \\\\ 0.15  0.30 \\end{bmatrix}$, $\\mathbf{b}_m = \\begin{bmatrix} 0.05 \\\\ -0.05 \\end{bmatrix}$。\n- 更新线性层：$\\mathbf{W}_u = \\begin{bmatrix} 0.50  0.10  0.20  -0.30 \\\\ -0.40  0.25  0.10  0.15 \\end{bmatrix}$, $\\mathbf{b}_u = \\begin{bmatrix} 0.00 \\\\ 0.10 \\end{bmatrix}$。\n- 能量读出：$\\mathbf{v} = \\begin{bmatrix} 1.50 \\\\ -0.50 \\end{bmatrix}$, $c = -0.20$。\n- 径向滤波器：$\\mu = 1.00$ 埃, $\\sigma = 0.50$ 埃。\n- 非线性：$\\phi(x) = \\tanh(x)$。\n\n计算按以下详细步骤进行。\n\n**步骤 1：消息生成**\n对于每对不同的原子有序对 $(i, j)$，计算一个有向消息 $\\mathbf{m}_{i \\leftarrow j}$。此消息取决于发送原子 $j$ 的特征向量 $\\mathbf{h}_j$ 和原子间的距离 $r_{ij}$。\n\n首先，从发送者当前的特征 $\\mathbf{h}_j$ 创建一个“基础”消息 $\\tilde{\\mathbf{m}}_j$。这涉及一个线性变换，然后是一个按元素的双曲正切非线性函数 $\\phi(\\cdot) = \\tanh(\\cdot)$。\n$$\n\\mathbf{z}_{j} = \\mathbf{W}_m \\mathbf{h}_j + \\mathbf{b}_m\n$$\n$$\n\\tilde{\\mathbf{m}}_{j} = \\phi(\\mathbf{z}_{j})\n$$\n然后，这个基础消息被一个径向滤波器函数 $f(r_{ij})$ 调制，该函数取决于原子间距离 $r_{ij} = \\lVert \\mathbf{r}_i - \\mathbf{r}_j \\rVert_2$。该滤波器是一个以 $\\mu$ 为中心、标准差为 $\\sigma$ 的高斯函数。\n$$\nf(r_{ij}) = \\exp\\!\\left(-\\frac{(r_{ij} - \\mu)^2}{2 \\sigma^2}\\right)\n$$\n从原子 $j$到原子 $i$ 的最终有向消息是滤波器值与基础消息的乘积。\n$$\n\\mathbf{m}_{i \\leftarrow j} = f(r_{ij}) \\cdot \\tilde{\\mathbf{m}}_{j}\n$$\n所有计算出的有向消息 $\\mathbf{m}_{i \\leftarrow j}$ 都被收集并按照输出格式的要求扁平化为一个列表。\n\n**步骤 2：消息聚合**\n对每个原子 $i$，将其从所有其他原子 $j$ 接收到的传入消息相加，形成一个单一的聚合消息向量 $\\mathbf{m}_i \\in \\mathbb{R}^{d_h}$。\n$$\n\\mathbf{m}_i = \\sum_{j \\neq i} \\mathbf{m}_{i \\leftarrow j}\n$$\n如果一个原子没有邻居（例如，单原子体系），这个和为空，其值为零向量，即 $\\mathbf{m}_i = \\mathbf{0}$。\n\n**步骤 3：特征更新**\n每个原子的隐藏特征向量 $\\mathbf{h}_i$ 使用其当前特征和聚合消息 $\\mathbf{m}_i$ 更新为 $\\mathbf{h}_i'$。首先，$\\mathbf{h}_i$ 和 $\\mathbf{m}_i$ 被拼接起来形成一个向量 $\\mathbf{u}_i \\in \\mathbb{R}^{2 d_h}$。\n$$\n\\mathbf{u}_i = \\begin{bmatrix} \\mathbf{h}_i \\\\ \\mathbf{m}_i \\end{bmatrix}\n$$\n这个拼接后的向量随后通过另一次线性变换和按元素的非线性函数，生成更新后的特征向量 $\\mathbf{h}_i'$。\n$$\n\\mathbf{q}_i = \\mathbf{W}_u \\mathbf{u}_i + \\mathbf{b}_u\n$$\n$$\n\\mathbf{h}_i' = \\phi(\\mathbf{q}_i)\n$$\n所有更新后的特征向量 $\\mathbf{h}_i'$ 的分量被收集并扁平化为第二个列表。\n\n**步骤 4：能量读出和汇集**\n最后一步是计算总势能 $E$。这是通过首先基于每个原子更新后的特征向量 $\\mathbf{h}_i'$ 为其分配一个标量能量贡献 $e_i$ 来完成的。一个线性读出层将 $\\mathbf{h}_i'$ 映射到 $e_i$。\n$$\ne_i = \\mathbf{v}^\\top \\mathbf{h}_i' + c\n$$\n体系的总势能是所有原子能量贡献的总和。\n$$\nE = \\sum_i e_i\n$$\n总能量 $E$ 是给定原子构型的最终输出值。\n\n对提供的三个测试用例中的每一个都执行这些步骤。对于单原子情况（案例3），消息生成和聚合步骤产生零消息，更新完全基于初始原子特征，这是所定义模型的正确且一致的结果。所有数值结果在格式化为最终输出字符串之前都四舍五入到 $6$ 位小数。", "answer": "[[[-0.048969,0.097694,0.015464,0.004395],[0.294471,-0.019600,0.020580,0.005847],[0.237243,-0.015790,-0.028445,0.056743]],[0.188373,0.076865,0.203975,0.002824,0.170669,0.127419],-0.222718],[[0.298516,-0.019869],[0.298516,-0.019869]],[0.119799,0.144498,0.119799,0.144498],-0.191008],[[],[0.244919,-0.103980],-0.161678]]", "id": "2908437"}]}