{"hands_on_practices": [{"introduction": "在子系统密度泛函理论中，一个核心挑战源于近似交换相关泛函所固有的离域误差，这常常导致子系统间出现非物理的非整电荷分布。为了深入理解这一复杂现象的根源，本练习提供了一个极简化的精确可解模型[@problem_id:2893026]。通过求解该模型，您将亲手揭示近似泛函能量对电子数的平滑凸性是如何直接导致电荷离域的，从而为理解和解决这一问题奠定坚实的理论基础。", "problem": "考虑两个弱相互作用的子系统 $A$ 和 $B$，在科恩-尚密度泛函理论 (KS-DFT) 的框架下，使用冻结密度嵌入 (FDE) 方法进行处理。设总电子数固定为 $N=N_{A}^{0}+N_{B}^{0}$，其中 $N_{A}^{0}$ 和 $N_{B}^{0}$ 是整数。我们使用一个最小二能级模型来分析电荷转移，该模型中只保留了每个子系统的前线（最高占据/最低未占据）响应，并且子系统间的相互作用以净电荷转移的二次惩罚项形式引入。假设以下具有物理动机且科学上标准的要素：\n\n- 精确基态能量作为电子数的函数是分段线性的，在整数点处存在折点（导数不连续性）。相反，缺少导数不连续性的近似密度泛函在每个整数附近的电子数函数是光滑且严格凸的。\n- 在此最小模型中，我们将每个孤立子系统在其整数 $N_{i}^{0}$ 附近的光滑近似能量，通过其在电子转移量 $\\Delta N$ 上的二阶泰勒展开进行参数化，\n  $$E_{A}(N_{A}^{0}+\\Delta N)=E_{A}(N_{A}^{0})+\\mu_{A}\\,\\Delta N+\\frac{1}{2}\\eta_{A}\\,(\\Delta N)^{2},$$\n  $$E_{B}(N_{B}^{0}-\\Delta N)=E_{B}(N_{B}^{0})-\\mu_{B}\\,\\Delta N+\\frac{1}{2}\\eta_{B}\\,(\\Delta N)^{2},$$\n  其中 $i\\in\\{A,B\\}$，$\\mu_{i}$ 是 $E_{i}(N_{i})$ 在 $N_{i}^{0}$ 处的左导数（光滑近似下的子系统化学势），$\\eta_{i}>0$ 是相应的曲率（化学硬度）。\n- 惩罚电荷分离的嵌入介导的相互作用，其主导项由一个二次项表示，\n  $$U_{\\text{emb}}(\\Delta N)=\\kappa\\,(\\Delta N)^{2},$$\n  其中 $\\kappa>0$ 概括了 FDE 中的长程静电作用和非加和动能/交换-相关刚度。\n\n因此，总模型能量作为从 $B$ 到 $A$ 的电子转移量 $\\Delta N$ 的函数为\n$$E_{\\text{tot}}(\\Delta N)=E_{A}(N_{A}^{0}+\\Delta N)+E_{B}(N_{B}^{0}-\\Delta N)+U_{\\text{emb}}(\\Delta N)。$$\n\n仅使用基态变分原理和化学势作为能量对电子数的导数的定义，确定在这个光滑（无导数不连续性）模型中使 $E_{\\text{tot}}(\\Delta N)$ 最小化的平衡电子转移量 $\\Delta N^{\\ast}$。将最终答案表示为关于 $\\mu_{A}$、$\\mu_{B}$、$\\eta_{A}$、$\\eta_{B}$ 和 $\\kappa$ 的闭式解析表达式。不允许使用除上述声明之外的任何额外假设。请以单个解析表达式的形式提供您的最终答案。", "solution": "该问题陈述经过了严格验证，被认为是有效的。其科学基础在于科恩-尚密度泛函理论 (KS-DFT) 和冻结密度嵌入 (FDE) 的原理，问题是适定的，并且没有矛盾或歧义。它提出了一个标准的、尽管是简化的子系统间电荷转移模型，可以使用微积分的基本原理解答。\n\n目标是找到使系统总能量 $E_{\\text{tot}}(\\Delta N)$ 最小化的平衡电子转移量，记为 $\\Delta N^{\\ast}$。变分原理规定，该最小值对应于总能量对变分参数 $\\Delta N$ 的一阶导数为零的点。\n\n系统的总能量由各个子系统的能量与嵌入相互作用能之和给出：\n$$E_{\\text{tot}}(\\Delta N) = E_{A}(N_{A}^{0}+\\Delta N) + E_{B}(N_{B}^{0}-\\Delta N) + U_{\\text{emb}}(\\Delta N)$$\n\n我们将各项的给定二次模型代入：\n$$E_{A}(N_{A}^{0}+\\Delta N) = E_{A}(N_{A}^{0})+\\mu_{A}\\,\\Delta N+\\frac{1}{2}\\eta_{A}\\,(\\Delta N)^{2}$$\n$$E_{B}(N_{B}^{0}-\\Delta N) = E_{B}(N_{B}^{0})-\\mu_{B}\\,\\Delta N+\\frac{1}{2}\\eta_{B}\\,(\\Delta N)^{2}$$\n$$U_{\\text{emb}}(\\Delta N) = \\kappa\\,(\\Delta N)^{2}$$\n\n合并这些项，得到总能量的完整表达式：\n$$E_{\\text{tot}}(\\Delta N) = \\left( E_{A}(N_{A}^{0})+\\mu_{A}\\,\\Delta N+\\frac{1}{2}\\eta_{A}\\,(\\Delta N)^{2} \\right) + \\left( E_{B}(N_{B}^{0})-\\mu_{B}\\,\\Delta N+\\frac{1}{2}\\eta_{B}\\,(\\Delta N)^{2} \\right) + \\kappa\\,(\\Delta N)^{2}$$\n\n为简化起见，我们按 $\\Delta N$ 的幂次对各项进行分组。$E_{A}(N_{A}^{0})$ 和 $E_{B}(N_{B}^{0})$ 项相对于 $\\Delta N$ 是常数。\n$$E_{\\text{tot}}(\\Delta N) = \\left( E_{A}(N_{A}^{0}) + E_{B}(N_{B}^{0}) \\right) + (\\mu_{A} - \\mu_{B})\\,\\Delta N + \\left( \\frac{1}{2}\\eta_{A} + \\frac{1}{2}\\eta_{B} + \\kappa \\right)(\\Delta N)^{2}$$\n$$E_{\\text{tot}}(\\Delta N) = C + (\\mu_{A} - \\mu_{B})\\,\\Delta N + \\frac{1}{2}(\\eta_{A} + \\eta_{B} + 2\\kappa)(\\Delta N)^{2}$$\n其中 $C = E_{A}(N_{A}^{0}) + E_{B}(N_{B}^{0})$ 是一个常数。\n\n为求最小值，我们将 $E_{\\text{tot}}(\\Delta N)$ 对 $\\Delta N$ 求导，并令结果为零：\n$$\\frac{dE_{\\text{tot}}}{d(\\Delta N)} = \\frac{d}{d(\\Delta N)}\\left[ C + (\\mu_{A} - \\mu_{B})\\,\\Delta N + \\frac{1}{2}(\\eta_{A} + \\eta_{B} + 2\\kappa)(\\Delta N)^{2} \\right] = 0$$\n$$\\frac{dE_{\\text{tot}}}{d(\\Delta N)} = (\\mu_{A} - \\mu_{B}) + (\\eta_{A} + \\eta_{B} + 2\\kappa)\\,\\Delta N = 0$$\n\n我们求解这个关于平衡转移量 $\\Delta N = \\Delta N^{\\ast}$ 的线性方程：\n$$(\\eta_{A} + \\eta_{B} + 2\\kappa)\\,\\Delta N^{\\ast} = -(\\mu_{A} - \\mu_{B})$$\n$$\\Delta N^{\\ast} = \\frac{-(\\mu_{A} - \\mu_{B})}{\\eta_{A} + \\eta_{B} + 2\\kappa}$$\n$$\\Delta N^{\\ast} = \\frac{\\mu_{B} - \\mu_{A}}{\\eta_{A} + \\eta_{B} + 2\\kappa}$$\n\n为确认此驻点为最小值点，我们计算总能量的二阶导数：\n$$\\frac{d^{2}E_{\\text{tot}}}{d(\\Delta N)^{2}} = \\frac{d}{d(\\Delta N)}\\left[ (\\mu_{A} - \\mu_{B}) + (\\eta_{A} + \\eta_{B} + 2\\kappa)\\,\\Delta N \\right]$$\n$$\\frac{d^{2}E_{\\text{tot}}}{d(\\Delta N)^{2}} = \\eta_{A} + \\eta_{B} + 2\\kappa$$\n问题陈述指明化学硬度 $\\eta_{A}$ 和 $\\eta_{B}$ 为正，嵌入刚度 $\\kappa$ 也为正。因此，和 $\\eta_{A} + \\eta_{B} + 2\\kappa$ 严格为正。正的二阶导数确认了函数 $E_{\\text{tot}}(\\Delta N)$ 是凸函数，且所确定的值 $\\Delta N^{\\ast}$ 对应于一个唯一的全局最小值。这个结果在物理上是合理的：电荷转移由化学势差 $(\\mu_{B} - \\mu_{A})$ 驱动，并受到子系统硬度之和以及嵌入惩罚的阻碍。", "answer": "$$\\boxed{\\frac{\\mu_{B} - \\mu_{A}}{\\eta_{A} + \\eta_{B} + 2\\kappa}}$$", "id": "2893026"}, {"introduction": "理解了离域误差的理论根源后，下一步是探索在实践中如何构建和实现不同的嵌入方案来处理子系统间的相互作用。本练习[@problem_id:2893048]是一个动手编程任务，要求您在一个简化的 一维模型中，从头构建并比较两种主流的嵌入方法：基于势的嵌入（FDE）和基于投影的嵌入。通过亲手实现这些方法并观察它们在不同重叠程度下的行为，您将对它们的操作机制、优缺点以及如何体现泡利（Pauli）排斥原理获得直观而深刻的认识。", "problem": "考虑一个用于冻结密度嵌入（FDE）和基于投影的嵌入的一维玩具模型，该模型捕捉了子系统嵌入的基本机制，同时在计算上易于处理且自洽。我们使用原子单位（能量单位为哈特里，长度单位为玻尔）。子系统密度泛函理论将总电子密度划分为两个子系统，分别表示为子系统A和环境B，其实空间密度为 $n_{A}(x)$ 和 $n_{B}(x)$。在该模型中，子系统A受到其自身的外部势作用，并嵌入在冻结的环境密度 $n_{B}(x)$ 中。您将计算当基于势的FDE和基于投影的嵌入在相同冻结密度下构建时，两者最低嵌入轨道能量之间的差异。\n\n基本和建模假设：\n- 在具有狄利克雷边界条件的一维域上，对子系统A使用类Kohn–Sham单粒子方程。动能算符是原子单位下的标准非相对论算符，$T = -\\tfrac{1}{2} \\tfrac{d^{2}}{dx^{2}}$。\n- 使用一个玩具式的局域无轨道动能泛函来定义驱动嵌入势的非加和动能贡献。具体来说，令非相互作用动能近似为 $T_{s}[n] = \\alpha \\int n(x)^{2} \\, dx$，其中 $\\alpha > 0$ 是一个给定常数。其泛函导数为 $\\delta T_{s}/\\delta n = 2 \\alpha n(x)$。对A-子系统势的非加和动能贡献则为\n$$\nv_{\\mathrm{nadd}}^{\\mathrm{kin}}[n_{A},n_{B}](x) = \\frac{\\delta}{\\delta n_{A}(x)}\\left( T_{s}[n_{A}+n_{B}] - T_{s}[n_{A}] \\right) = 2 \\alpha n_{B}(x).\n$$\n- 忽略库仑（哈特里）和交换相关项，因此唯一的嵌入贡献是上述的非加和动能项。\n- 对于基于投影的嵌入，强制子系统A的轨道与给定的环境轨道 $\\varphi_{B}(x)$ 正交，该环境轨道为一个单电子再现了环境密度 $n_{B}(x)$，即 $\\varphi_{B}(x) = \\sqrt{n_{B}(x)}$（实数且非负）。这通过一个强度为 $\\lambda \\ge 0$ 的能级移动投影算子来强制执行，产生一个加和算符 $\\lambda \\hat{P}_{B}$，其中 $\\hat{P}_{B} = |\\varphi_{B}\\rangle \\langle \\varphi_{B}|$。\n\n离散化和算符：\n- 考虑一个长度为 $L$ 的有限一维盒子，在 $x=0$ 和 $x=L$ 处具有狄利克雷边界条件。用一个包含端点的 $N_{\\mathrm{tot}}$ 个点的均匀网格来离散化该区间，间距为 $\\Delta x = L/(N_{\\mathrm{tot}}-1)$。仅在 $N = N_{\\mathrm{tot}}-2$ 个内部点上进行计算，表示为 $\\{ x_{i} \\}_{i=1}^{N}$。\n- 使用标准的三点二阶有限差分近似在内部网格上离散化动能算符 $T$ (对应 $-\\tfrac{1}{2} \\tfrac{d^{2}}{dx^{2}}$)：\n$$\nT_{ii} = \\frac{1}{\\Delta x^{2}}, \\quad T_{i,i\\pm 1} = -\\frac{1}{2 \\Delta x^{2}}.\n$$\n- 将乘法势 $v(x)$ 表示为对角矩阵 $V = \\mathrm{diag}\\big(v(x_{1}),\\dots,v(x_{N})\\big)$。\n- 将到 $\\varphi_{B}$ 上的能级移动投影算子以离散形式表示为\n$$\nP_{B} = \\Delta x \\, \\boldsymbol{\\varphi}_{B} \\boldsymbol{\\varphi}_{B}^{\\mathsf{T}},\n$$\n其中 $\\boldsymbol{\\varphi}_{B}$ 是值 $\\varphi_{B}(x_{i})$ 的向量，并已归一化以满足离散条件 $\\sum_{i=1}^{N} \\varphi_{B}(x_{i})^{2} \\Delta x = 1$。此选择确保 $P_{B} \\boldsymbol{\\varphi}_{B} = \\boldsymbol{\\varphi}_{B}$ 并且 $P_{B}$ 作为关于 $\\Delta x$ 加权内积的正确投影算子。\n\n子系统要素：\n- 将子系统A的外部势定义为一个以 $c_{A}$ 为中心的吸引性高斯势阱：\n$$\nv_{A}^{\\mathrm{ext}}(x) = -V_{0} \\exp\\!\\left( -\\frac{(x-c_{A})^{2}}{2 \\sigma_{v}^{2}} \\right).\n$$\n- 将环境密度 $n_{B}(x)$ 定义为一个以 $c_{B}$ 为中心的归一化高斯函数：\n$$\nn_{B}(x) = \\frac{N_{B}}{\\sqrt{2\\pi} \\sigma_{n}} \\exp\\!\\left( -\\frac{(x-c_{B})^{2}}{2 \\sigma_{n}^{2}} \\right),\n$$\n其中 $N_{B}=1$ 个电子，通过缩放在有限网格上进行归一化，使得 $\\sum_{i=1}^{N} n_{B}(x_{i}) \\Delta x = 1$。令 $\\varphi_{B}(x) = \\sqrt{n_{B}(x)}$，并在需要时重新归一化以满足上述离散归一化条件。\n\n嵌入哈密顿量与目标量：\n- 用于子系统A的基于势的FDE使用哈密顿量\n$$\nH_{\\mathrm{pot}} = T + \\mathrm{diag}\\!\\big(v_{A}^{\\mathrm{ext}}(x)\\big) + \\mathrm{diag}\\!\\big(2\\alpha \\, n_{B}(x)\\big).\n$$\n- 用于子系统A的基于投影的嵌入使用\n$$\nH_{\\mathrm{proj}} = T + \\mathrm{diag}\\!\\big(v_{A}^{\\mathrm{ext}}(x)\\big) + \\lambda P_{B}.\n$$\n- 令 $\\varepsilon_{\\mathrm{pot}}$ 和 $\\varepsilon_{\\mathrm{proj}}$ 分别表示 $H_{\\mathrm{pot}}$ 和 $H_{\\mathrm{proj}}$ 的最低本征值（基态轨道能量）。计算其差值\n$$\n\\Delta \\varepsilon = \\varepsilon_{\\mathrm{pot}} - \\varepsilon_{\\mathrm{proj}}.\n$$\n\n数值参数与测试套件：\n- 将全局参数固定为 $L = 20.0$，$N_{\\mathrm{tot}} = 220$，$V_{0} = 8.0$，$\\sigma_{v} = 0.6$，$\\sigma_{n} = 0.7$，$\\alpha = 1.0$。将子系统中心对称分布于盒子中点 $L/2$ 两侧，间距为 $d$，即 $c_{A} = L/2 - d/2$ 和 $c_{B} = L/2 + d/2$。\n- 对于每个测试用例，给定一对 $(d,\\lambda)$，您必须计算 $\\Delta \\varepsilon$（以哈特里为单位，作为浮点数）。使用以下四个测试用例：\n    1. $(d,\\lambda) = (4.0, 50.0)$。\n    2. $(d,\\lambda) = (10.0, 50.0)$。\n    3. $(d,\\lambda) = (1.5, 50.0)$。\n    4. $(d,\\lambda) = (4.0, 0.0)$。\n这些分别涵盖了中等重叠情况、弱重叠情况、强重叠情况以及无投影的边缘情况。\n\n程序要求：\n- 完全按照上述规定构建离散化的算符，求解两个对称本征值问题以获得每个测试用例的 $\\varepsilon_{\\mathrm{pot}}$ 和 $\\varepsilon_{\\mathrm{proj}}$，并计算 $\\Delta \\varepsilon$。\n- 所有能量均以哈特里表示。您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[$x_{1}$,$x_{2}$,$x_{3}$,$x_{4}$]”），其中每个条目是相应测试用例的浮点数 $\\Delta \\varepsilon$。将每个条目四舍五入到 $6$ 位小数。", "solution": "所提出的问题是量子化学中一个有效且适定的计算练习。它要求在一个简化的一维玩具模型内，对两种不同的嵌入方法——基于势的冻结密度嵌入（FDE）和基于投影的嵌入——进行数值实现和比较。所有参数、方程和数值方案都已明确定义，从而可以得到唯一且可验证的解。该问题在科学上基于子系统密度泛函理论的原理。\n\n目标是计算子系统A的两个不同嵌入哈密顿量的最低轨道能量之差，即 $\\Delta \\varepsilon = \\varepsilon_{\\mathrm{pot}} - \\varepsilon_{\\mathrm{proj}}$。此处，$\\varepsilon_{\\mathrm{pot}}$ 是基于势的FDE哈密顿量 $H_{\\mathrm{pot}}$ 的最低本征值，而 $\\varepsilon_{\\mathrm{proj}}$ 是基于投影的嵌入哈密顿量 $H_{\\mathrm{proj}}$ 的最低本征值。该计算必须针对四个指定的测试用例进行，每个用例由一对参数 $(d, \\lambda)$ 定义。\n\n求解方法如下：\n\n首先，我们建立离散化的一维实空间网格。系统被限制在长度为 $L=20.0$ 的盒子中。该域被离散化为 $N_{\\mathrm{tot}}=220$ 个等距点。计算在 $N = N_{\\mathrm{tot}}-2 = 218$ 个内部网格点 $\\{x_i\\}_{i=1}^{N}$ 上执行。网格间距为 $\\Delta x = L / (N_{\\mathrm{tot}}-1)$。内部网格点坐标的向量表示为 $\\mathbf{x}$。\n\n其次，我们在此离散网格上构建算符的矩阵表示。所有矩阵的维度均为 $N \\times N$。\n动能算符 $T = -\\frac{1}{2}\\frac{d^2}{dx^2}$ 使用中心有限差分格式进行离散化，得到一个实对称三对角矩阵 $\\mathbf{T}$，其元素为：\n$$\nT_{ij} =\n\\begin{cases}\n1 / (\\Delta x)^2  \\text{若 } i=j \\\\\n-1 / (2 (\\Delta x)^2)  \\text{若 } |i-j|=1 \\\\\n0  \\text{其他情况}\n\\end{cases}\n$$\n\n对于每个由间距 $d$ 和投影强度 $\\lambda$ 定义的测试用例，我们构建所需的势和投影算子：\n1.  子系统中心设置为 $c_{A} = L/2 - d/2$ 和 $c_{B} = L/2 + d/2$。\n2.  子系统A的外部势 $v_{A}^{\\mathrm{ext}}(x) = -V_{0} \\exp(-\\frac{(x-c_{A})^{2}}{2 \\sigma_{v}^{2}})$，在每个网格点 $x_i$ 上求值，形成一个向量 $\\mathbf{v}_{A}^{\\mathrm{ext}}$。这表示为一个对角矩阵 $\\mathbf{V}_{A}^{\\mathrm{ext}} = \\mathrm{diag}(\\mathbf{v}_{A}^{\\mathrm{ext}})$。参数固定为 $V_0=8.0$ 和 $\\sigma_v=0.6$。\n3.  环境密度 $n_{B}(x)$ 被建模为一个以 $c_B$ 为中心、宽度为 $\\sigma_n=0.7$ 的高斯函数。首先在网格上对其求值，然后进行数值归一化，使得离散积分 $\\sum_{i=1}^{N} n_{B}(x_i) \\Delta x = 1$。得到的向量表示为 $\\mathbf{n}_{B}$。\n4.  基于势的嵌入贡献由非加和动能势 $v_{\\mathrm{nadd}}^{\\mathrm{kin}}(x) = 2 \\alpha n_{B}(x)$ 定义，其中 $\\alpha=1.0$。这表示为一个对角矩阵 $\\mathbf{V}_{\\mathrm{nadd}}^{\\mathrm{kin}} = \\mathrm{diag}(2 \\alpha \\mathbf{n}_{B})$。\n5.  基于投影的嵌入算子需要环境轨道 $\\boldsymbol{\\varphi}_{B}$ 及相应的投影算子 $\\mathbf{P}_{B}$。轨道定义为 $\\boldsymbol{\\varphi}_{B} = \\sqrt{\\mathbf{n}_{B}}$。由于 $\\mathbf{n}_{B}$ 已经通过 $\\Delta x$ 加权归一化为总和为1，$\\boldsymbol{\\varphi}_{B}$ 自动满足所需的归一化条件 $\\sum_{i=1}^{N} \\varphi_{B}(x_i)^2 \\Delta x = 1$。然后投影矩阵构造为 $\\mathbf{P}_{B} = \\Delta x \\, \\boldsymbol{\\varphi}_{B} \\boldsymbol{\\varphi}_{B}^{\\mathsf{T}}$，其中 $\\boldsymbol{\\varphi}_{B}^{\\mathsf{T}}$ 是列向量 $\\boldsymbol{\\varphi}_{B}$ 的转置。\n\n第三，我们组装两个哈密顿矩阵：\n基于势的FDE哈密顿量为：\n$$\nH_{\\mathrm{pot}} = \\mathbf{T} + \\mathbf{V}_{A}^{\\mathrm{ext}} + \\mathbf{V}_{\\mathrm{nadd}}^{\\mathrm{kin}} = \\mathbf{T} + \\mathrm{diag}(\\mathbf{v}_{A}^{\\mathrm{ext}} + 2 \\alpha \\mathbf{n}_{B})\n$$\n基于投影的嵌入哈密顿量为：\n$$\nH_{\\mathrm{proj}} = \\mathbf{T} + \\mathbf{V}_{A}^{\\mathrm{ext}} + \\lambda \\mathbf{P}_{B}\n$$\n$H_{\\mathrm{pot}}$ 和 $H_{\\mathrm{proj}}$ 都是实对称矩阵。\n\n第四，我们求解每个哈密顿量的本征值问题。最低本征值 $\\varepsilon_{\\mathrm{pot}}$ 和 $\\varepsilon_{\\mathrm{proj}}$ 对应于每种嵌入方案的基态轨道能量。通过数值对角化 $H_{\\mathrm{pot}}$ 和 $H_{\\mathrm{proj}}$ 并从所得谱中提取最小本征值来找到这些值。此任务使用针对对称矩阵的标准数值线性代数程序。\n\n最后，对于每对 $(d, \\lambda)$，目标量计算为差值 $\\Delta \\varepsilon = \\varepsilon_{\\mathrm{pot}} - \\varepsilon_{\\mathrm{proj}}$。对所有四个测试用例重复此过程，以生成最终的结果列表。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D embedding problem for the given test cases.\n    \"\"\"\n\n    # --- Global parameters ---\n    L = 20.0\n    N_tot = 220\n    V0 = 8.0\n    sigma_v = 0.6\n    sigma_n = 0.7\n    alpha = 1.0\n\n    # --- Grid setup ---\n    N = N_tot - 2\n    delta_x = L / (N_tot - 1)\n    x_grid = np.linspace(delta_x, L - delta_x, N)\n\n    # --- Construct Kinetic Energy Matrix T ---\n    diag_val = 1.0 / (delta_x**2)\n    off_diag_val = -0.5 / (delta_x**2)\n    \n    T = (np.diag(np.full(N, diag_val)) + \n         np.diag(np.full(N - 1, off_diag_val), k=1) +\n         np.diag(np.full(N - 1, off_diag_val), k=-1))\n\n    # --- Test cases from the problem statement ---\n    test_cases = [\n        (4.0, 50.0),   # 1. Moderate overlap\n        (10.0, 50.0),  # 2. Weak overlap\n        (1.5, 50.0),   # 3. Strong overlap\n        (4.0, 0.0),    # 4. No projection\n    ]\n\n    results = []\n\n    for d, lam in test_cases:\n        # --- Construct potential- and density-related terms for the current case ---\n        \n        # 1. Subsystem centers\n        c_A = L / 2.0 - d / 2.0\n        c_B = L / 2.0 + d / 2.0\n\n        # 2. Subsystem A external potential vector\n        v_A_ext = -V0 * np.exp(-((x_grid - c_A)**2) / (2.0 * sigma_v**2))\n\n        # 3. Environment density vector n_B (normalized on the grid)\n        n_B_unnormalized = np.exp(-((x_grid - c_B)**2) / (2.0 * sigma_n**2))\n        norm_const_n = np.sum(n_B_unnormalized) * delta_x\n        n_B = n_B_unnormalized / norm_const_n\n\n        # 4. Environment orbital vector phi_B\n        # This is automatically normalized due to n_B's normalization\n        phi_B = np.sqrt(n_B)\n\n        # --- Assemble Hamiltonians ---\n\n        # 1. Potential-based Hamiltonian (H_pot)\n        v_nad_kin = 2.0 * alpha * n_B\n        H_pot = T + np.diag(v_A_ext + v_nad_kin)\n\n        # 2. Projection-based Hamiltonian (H_proj)\n        P_B = delta_x * np.outer(phi_B, phi_B)\n        H_proj = T + np.diag(v_A_ext) + lam * P_B\n\n        # --- Solve eigenvalue problems for lowest eigenvalue ---\n        # np.linalg.eigvalsh is efficient for symmetric matrices and returns sorted eigenvalues\n        \n        eps_pot = np.linalg.eigvalsh(H_pot)[0]\n        eps_proj = np.linalg.eigvalsh(H_proj)[0]\n\n        # --- Compute the difference and store the result ---\n        delta_eps = eps_pot - eps_proj\n        results.append(delta_eps)\n\n    # --- Final print statement in the exact required format ---\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "2893048"}, {"introduction": "子系统DFT领域的终极目标之一是开发出精确且普适的非加和动能泛函，而这至今仍是一个活跃的研究前沿。本练习[@problem_id:2892989]将挑战您以研究者的视角思考问题，评估多种用于构建非加和动能势的机器学习策略。您的任务不是进行计算，而是进行“设计”：通过辨析不同方案如何整合或违背已知的物理约束（如标度关系、守恒律等），您将锻炼在现代计算化学研究中至关重要的模型设计与批判性思维能力。", "problem": "您正在构建一个机器学习模型，用于子系统密度泛函理论 (DFT) 中的冻结密度嵌入 (FDE)，以近似非加和非相互作用动能势 $v_{T_s}^{\\mathrm{nadd}}[\\rho_A,\\rho_B](\\mathbf r)$，其中 $T_s^{\\mathrm{nadd}}[\\rho_A,\\rho_B] \\equiv T_s[\\rho_A+\\rho_B]-T_s[\\rho_A]-T_s[\\rho_B]$，$v_{T_s}^{\\mathrm{nadd}}[\\rho_A,\\rho_B](\\mathbf r)$ 是在固定环境密度 $\\rho_B(\\mathbf r)$ 的情况下，对活性子系统密度 $\\rho_A(\\mathbf r)$ 的泛函导数。请考虑以下任何合理的 $v_{T_s}^{\\mathrm{nadd}}$ 近似都应满足的、基于基本原理的精确和结构性条件：\n- 均匀坐标标度变换：对于 $\\rho_\\gamma(\\mathbf r) \\equiv \\gamma^3 \\rho(\\gamma\\mathbf r)$，非相互作用动能的标度变换关系为 $T_s[\\rho_\\gamma]=\\gamma^2 T_s[\\rho]$，这意味着 $T_s^{\\mathrm{nadd}}[\\rho_{A,\\gamma},\\rho_{B,\\gamma}]=\\gamma^2 T_s^{\\mathrm{nadd}}[\\rho_A,\\rho_B]$，相应地，$v_{T_s}^{\\mathrm{nadd}}[\\rho_{A,\\gamma},\\rho_{B,\\gamma}](\\mathbf r)$ 必须按 $\\gamma^2$ 进行标度变换。\n- 单轨道（等轨道）极限：在总密度可被单个占据轨道有效描述的区域，非相互作用动能简化为 von Weizsäcker 形式，因此泡利贡献消失，非加和泡利势必须趋近于零；总的非加和动能势在该区域趋近于其 von Weizsäcker 对应项。\n- 尺寸一致性和非重叠性：如果 $\\rho_A$ 和 $\\rho_B$ 在某个区域具有不相交的支撑集或可忽略的重叠，则 $T_s^{\\mathrm{nadd}}[\\rho_A,\\rho_B] \\to 0$，因此 $v_{T_s}^{\\mathrm{nadd}}[\\rho_A,\\rho_B](\\mathbf r) \\to 0$（局部）。\n- 欧几里得不变性：从密度到势的映射具有平移和旋转不变性。\n- 泛函可积性：预测的势应该为某个标量非加和动能的泛函导数，这意味着二阶泛函导数的对称性（在离散化网格上，预测的势对密度的雅可比矩阵应该是对称的）。\n\n您将仅使用由子系统密度及其导数构建的局域或半局域描述符。在以下机器学习流程中，哪一个最能强制执行上述约束，同时在实践中保持可训练性？\n\nA. 使用一个物理启发的神经网络，该网络预测一个无量纲校正场，该校正场乘以一个费米波矢平方前因子，并添加到一个平滑的解析基线上，同时使用约束感知损失和平滑重叠门控：\n- 输入：由总密度 $\\rho \\equiv \\rho_A+\\rho_B$ 和在 $\\mathbf r$ 处的子系统分辨量构建的局域标量不变量，包括 $\\rho$、$\\nabla\\rho$、$\\nabla^2\\rho$、Kohn–Sham 动能密度 $\\tau$，以及约化的无量纲指标，如 $s \\equiv \\lvert \\nabla \\rho \\rvert /(2 k_F \\rho)$、$q \\equiv \\nabla^2\\rho/(4 k_F^2 \\rho)$、等轨道指标 $\\alpha \\equiv (\\tau-\\tau_W)/\\tau_{\\mathrm{unif}}$，以及划分分辨的分数 $x_A \\equiv \\rho_A/\\rho$、$x_B \\equiv \\rho_B/\\rho$ 和一个重叠指标 $\\eta \\equiv \\rho_A \\rho_B/\\rho^2$，其中 $k_F \\equiv (3\\pi^2\\rho)^{1/3}$。通过 $x_A$ 和 $x_B$ 包含活性与环境的不对称性。\n- 架构和输出：通过一个平滑激活函数（例如，softplus）预测一个无量纲场 $g(\\mathbf r)\\ge 0$，并设置\n$$v_{T_s}^{\\mathrm{nadd,\\,ML}}(\\mathbf r) \\,=\\, v_W^{\\mathrm{nadd}}(\\mathbf r)\\;+\\; k_F(\\mathbf r)^2\\, \\underbrace{\\sigma(\\eta(\\mathbf r))\\,g(\\text{descriptors at }\\mathbf r)}_{\\Delta v_P^{\\mathrm{nadd}}(\\mathbf r)},$$\n其中 $v_W^{\\mathrm{nadd}}$ 是一个基于 von Weizsäcker 的非加和基线，$\\sigma$ 是一个平滑门控函数，满足 $\\sigma(0)=0$ 和 $\\sigma(1)\\le 1$ 以强制执行非重叠消失，而 $\\Delta v_P^{\\mathrm{nadd}}$ 表示一个非加和泡利校正，该校正被 $\\alpha$ 掩蔽，使得在等轨道极限下 $\\Delta v_P^{\\mathrm{nadd}}\\to 0$。\n- 损失函数：结合了 (i) 对通过密度到势反演获得的参考 $v_{T_s}^{\\mathrm{nadd,\\,ref}}$ 的逐点监督，(ii) 一个强制沿密度路径的线积分重现参考 $T_s^{\\mathrm{nadd}}$ 的能量一致性项，(iii) 一个促进离散化雅可比矩阵 $\\delta v/\\delta \\rho_A$ 对称性的可积性惩罚项，以及 (iv) 在 $\\eta\\to 0$ 时将输出驱动至零的尺寸一致性正则化。通过均匀坐标标度变换进行数据增强，以强制执行精确的 $\\gamma^2$ 标度关系。\n- 不变性：所有描述符都是欧几里得运动下的标量不变量；$k_F^2$ 前因子确保了正确的单位和标度关系。\n\nB. 使用一个仅含梯度描述符的模型，该模型具有最小的物理先验，并纯粹依赖数据增强：\n- 输入：仅 $\\mathbf r$ 处的 $\\nabla \\rho_A$、$\\nabla \\rho_B$ 及其大小；不使用 $\\rho$ 或 $\\tau$。\n- 架构和输出：一个神经网络直接输出 $v_{T_s}^{\\mathrm{nadd}}(\\mathbf r)$，乘以一个 $k_F(\\mathbf r)$ 前因子以设定单位，没有任何基线或掩蔽。\n- 损失函数：对参考 $v_{T_s}^{\\mathrm{nadd}}$ 的均方误差，加上激进的数据增强，包括对密度的随机旋转、平移和均匀标度变换；没有能量一致性或可积性项。\n\nC. 对体素化密度使用一个三维卷积网络，以捕捉非局域性而无需显式约束：\n- 输入：固定域上 $\\rho_A(\\mathbf r)$ 和 $\\rho_B(\\mathbf r)$ 的体素网格。\n- 架构和输出：一个 U-Net 在网格上生成 $v_{T_s}^{\\mathrm{nadd}}(\\mathbf r)$；平移不变性由卷积处理；没有显式的前因子或基线；ReLU 激活函数允许正输出和负输出。\n- 损失函数：势水平的误差与一个全局标量惩罚的组合，该惩罚通过预测的势与 $\\rho_A$ 之间的简单点积代理来匹配 $T_s^{\\mathrm{nadd}}$；没有显式的均匀标度变换或单轨道约束。\n\nD. 使用一个带有硬区域划分的解析切换混合模型：\n- 输入：仅基于总密度的约化梯度 $s(\\mathbf r)$ 和 $q(\\mathbf r)$；没有子系统分辨的描述符，如 $x_A$ 或 $\\rho_B$。\n- 架构和输出：定义一个带有固定阈值 $\\varepsilon$ 的硬切换 $\\theta(\\eta(\\mathbf r)-\\varepsilon)$，当 $\\eta  \\varepsilon$ 时设置 $v_{T_s}^{\\mathrm{nadd}}(\\mathbf r)=0$，否则使用\n$$v_{T_s}^{\\mathrm{nadd}}(\\mathbf r)=k_F(\\mathbf r)\\, f_\\theta\\!\\left(s(\\mathbf r),q(\\mathbf r)\\right),$$\n其中 $f_\\theta$ 是一个为拟合参考数据而训练的小型神经网络；单轨道区域通过将 $f_\\theta$ 替换为一个模拟 von Weizsäcker 行为的常数来处理；没有显式的能量一致性或可积性惩罚。\n\n哪个选项在使用局域描述符的同时，最好地满足了为 $v_{T_s}^{\\mathrm{nadd}}[\\rho_A,\\rho_B](\\mathbf r)$ 列出的约束，并强制执行了已知的精确约束？\n\nA. 选项 A 中的流程。\n\nB. 选项 B 中的流程。\n\nC. 选项 C 中的流程。\n\nD. 选项 D 中的流程。", "solution": "问题陈述描述了计算量子化学中的一项任务：为非加和非相互作用动能势 $v_{T_s}^{\\mathrm{nadd}}[\\rho_A,\\rho_B](\\mathbf r)$ 构建机器学习模型，该势是子系统密度泛函理论 (DFT) 中的一个核心量。在尝试给出解答之前，应对该陈述进行验证。\n\n**问题验证**\n\n**步骤 1：提取的已知条件**\n-   目标量：非加和非相互作用动能势，$v_{T_s}^{\\mathrm{nadd}}[\\rho_A,\\rho_B](\\mathbf r)$。\n-   相应能量的定义：$T_s^{\\mathrm{nadd}}[\\rho_A,\\rho_B] \\equiv T_s[\\rho_A+\\rho_B]-T_s[\\rho_A]-T_s[\\rho_B]$。\n-   势的定义：$v_{T_s}^{\\mathrm{nadd}}[\\rho_A,\\rho_B](\\mathbf r)$ 是 $T_s^{\\mathrm{nadd}}[\\rho_A,\\rho_B]$ 对活性子系统密度 $\\rho_A(\\mathbf r)$ 在固定环境密度 $\\rho_B(\\mathbf r)$ 下的泛函导数。这意味着 $v_{T_s}^{\\mathrm{nadd}}[\\rho_A,\\rho_B] = v_s[\\rho_A+\\rho_B] - v_s[\\rho_A]$，其中 $v_s[\\rho] = \\delta T_s[\\rho]/\\delta\\rho$。\n-   有效近似的约束条件：\n    1.  **均匀坐标标度变换**：对于标度变换后的密度 $\\rho_\\gamma(\\mathbf r) \\equiv \\gamma^3 \\rho(\\gamma\\mathbf r)$，动能的标度关系为 $T_s[\\rho_\\gamma]=\\gamma^2 T_s[\\rho]$。这导致了势的标度关系。问题陈述这要求 $v_{T_s}^{\\mathrm{nadd}}[\\rho_{A,\\gamma},\\rho_{B,\\gamma}](\\mathbf r)$ 按 $\\gamma^2$ 进行标度变换。正确、精确的关系是 $v_{T_s}^{\\mathrm{nadd}}[\\rho_{A,\\gamma},\\rho_{B,\\gamma}](\\mathbf r) = \\gamma^2 v_{T_s}^{\\mathrm{nadd}}[\\rho_A,\\rho_B](\\gamma\\mathbf r)$。问题中的措辞略有不精确，但在 DFT 泛函设计的背景下，其意图是可辨别的。\n    2.  **单轨道极限**：在由单个轨道主导的区域，动能的泡利分量消失，$v_{T_s}^{\\mathrm{nadd}}$ 必须趋近于其 von Weizsäcker 对应项 $v_W^{\\mathrm{nadd}}$。\n    3.  **尺寸一致性和非重叠性**：对于空间上分离、密度 $\\rho_A$ 和 $\\rho_B$ 不重叠的子系统，$T_s^{\\mathrm{nadd}} \\to 0$，因此 $v_{T_s}^{\\mathrm{nadd}}(\\mathbf r) \\to 0$。\n    4.  **欧几里得不变性**：模型必须对坐标系的平移和旋转保持不变。\n    5.  **泛函可积性**：势 $v_{T_s}^{\\mathrm{nadd}}$ 必须是真正的泛函导数，这意味着其对密度的二阶泛函导数是对称的：$\\frac{\\delta v_{T_s}^{\\mathrm{nadd}}(\\mathbf r)}{\\delta \\rho_A(\\mathbf r')} = \\frac{\\delta v_{T_s}^{\\mathrm{nadd}}(\\mathbf r')}{\\delta \\rho_A(\\mathbf r)}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据。非加和动能和势的定义在 FDE-DFT 中是标准的。列举的约束是精确的非相互作用动能泛函已经确立的基本性质。该问题是良定的，要求对四种提出的方法根据这些明确的标准进行比较评估。语言是客观和技术性的。坐标标度变换定律对势的措辞上存在的微小不精确并非致命缺陷，因为其意图的物理要求在该领域是标准的且被理解。因此，该问题被认为是有效的。\n\n**步骤 3：推导与评估**\n我现在将对每个提出的机器学习流程进行批判性分析。一个正确且实用的模型必须将这些物理约束作为其设计的核心支柱，而不是事后添加。\n\n**选项 A 的分析**\n该流程提出了一种复杂的、物理启发的方案。\n-   **输入**：它使用了一套全面的标量描述符。这些描述符包括总密度性质（$\\rho$, $\\nabla\\rho$, $\\nabla^2\\rho$, $\\tau$），以及至关重要的子系统分辨描述符（$x_A$, $x_B$, $\\eta$）。这些描述符都是标量不变量，通过构造正确地强制了**欧几里得不变性**。包含等轨道指标 $\\alpha \\equiv (\\tau-\\tau_W)/\\tau_{\\mathrm{unif}}$ 提供了一种识别和正确处理**单轨道极限**的机制。重叠指标 $\\eta \\equiv \\rho_A \\rho_B/\\rho^2$ 对于强制**非重叠极限**至关重要。同时使用 $x_A$ 和 $x_B$ 允许模型捕捉 $v_{T_s}^{\\mathrm{nadd}}$ 定义中固有的不对称性。这套输入非常出色。\n-   **架构**：输出形式 $v_{T_s}^{\\mathrm{nadd,\\,ML}}(\\mathbf r) \\,=\\, v_W^{\\mathrm{nadd}}(\\mathbf r)\\;+\\; k_F(\\mathbf r)^2\\, \\Delta v_P^{\\mathrm{nadd}}(\\mathbf r)$ 在物理上是敏锐的。它将势分解为一个已知的解析基线（$v_W^{\\mathrm{nadd}}$），该基线能正确捕捉一个极限，以及一个学习到的泡利校正项（$\\Delta v_P^{\\mathrm{nadd}}$）。前因子 $k_F(\\mathbf r)^2 \\propto \\rho(\\mathbf r)^{2/3}$ 具有正确的能量量纲，并确保势项在**均匀坐标标度变换**下正确变换。门控函数 $\\sigma(\\eta(\\mathbf r))$ 满足 $\\sigma(0)=0$，显式地强制了**非重叠极限**。描述意味着模型被训练以使泡利项在单轨道极限下（当 $\\alpha \\to 0$ 时）消失，这是正确的行为。\n-   **损失函数**：损失函数是多方面的，直接针对物理一致性。除了简单的逐点精度 (i)，它还包括通过线积分实现的能量一致性项 (ii) 和对雅可比矩阵不对称性的惩罚项 (iii)，这两者都直接解决了**泛函可积性**这一困难的约束。强制非重叠极限 (iv) 的正则化提供了进一步的鲁棒性。\n-   **对 A 的结论**：这个流程非常出色。它通过智能特征工程、物理驱动的模型架构（归纳偏置）以及全面的、约束感知的损失函数的组合，系统地解决了所有必需的物理约束。这是真正的科学机器学习的标志。**正确**。\n\n**选项 B 的分析**\n该流程代表了一种天真的“黑箱”方法。\n-   **输入**：仅使用 $\\nabla \\rho_A$ 和 $\\nabla \\rho_B$ 是没有意义的。首先，它们是向量。模型将不得不从数据增强中学习旋转不变性，这是一个效率极低的过程。使用标量不变量更为优越。其次，忽略密度 $\\rho_A, \\rho_B$ 本身，以及局域动能密度，丢弃了最基本的信息。没有密度就不可能正确地建模系统。\n-   **架构**：使用 $k_F(\\mathbf r) \\propto \\rho(\\mathbf r)^{1/3}$ 前因子是一个灾难性的错误。如前所述，动能势具有能量的单位，并且必须按 $\\gamma^2$ 进行标度变换。这个前因子给出了错误的单位，并导致势按 $\\gamma^1$ 进行标度变换，违反了**均匀坐标标度变换**约束。没有为单轨道或非重叠极限设置基线或特殊处理。\n-   **损失函数**：一个简单的均方误差损失加上数据增强是一种蛮力方法，无法施加像**泛函可积性**这样微妙但至关重要的约束。\n-   **对 B 的结论**：这种方法在其输入的选取和数学结构上都存在根本性缺陷。它违反了标度变换约束，并忽略了大多数其他物理原理。**不正确**。\n\n**选项 C 的分析**\n该流程使用三维卷积神经网络 (CNN)。\n-   **输入**：使用 $\\rho_A$ 和 $\\rho_B$ 的体素网格使模型变为非局域的，因为每个输出点都依赖于由 CNN 感受野定义的输入点邻域。这违反了使用“局域或半局域描述符”的前提。虽然 CNN 很强大，但它们并非灵丹妙药。\n-   **架构**：虽然 CNN 强制了平移不变性，但它们并非天生具有旋转不变性。从数据增强中学习三维旋转的**欧几里得不变性**是出了名的困难和数据密集型。缺乏明确的标度变换前因子或物理基线，迫使网络仅从数据中学习这些复杂的物理定律，这是低效且不可靠的。\n-   **损失函数**：提出的全局能量惩罚，一个简单的点积，是对实际能量-势关系的粗糙且不正确的代理，并且不能强制**泛函可积性**。该流程缺乏针对单轨道、非重叠和标度变换约束的显式机制。\n-   **对 C 的结论**：这种方法抛弃了现代 DFT 中物理驱动的、基于描述符的框架，转而采用一种通用的图像处理架构。它在强制关键不变性和物理极限方面效率低下，并且违反了问题陈述中声明的“使用局域/半局域描述符”的方法。**不正确**。\n\n**选项 D 的分析**\n该流程尝试了一种解析-机器学习混合方法，但构思不佳。\n-   **输入**：最严重的缺陷是仅使用基于总密度 $\\rho = \\rho_A + \\rho_B$ 的描述符。势 $v_{T_s}^{\\mathrm{nadd}} = v_s[\\rho_A+\\rho_B] - v_s[\\rho_A]$ 明确地依赖于 $\\rho_A$ 和 $\\rho_B$ 之间的区别。一个只“看到”总密度的模型无法区分，例如，平凡划分 $(\\rho_A, \\rho_B) = (\\rho, 0)$ 和一个非平凡划分 $(\\rho_A, \\rho_B) = (\\rho/2, \\rho/2)$。在这些情况下，势是截然不同的，但这个模型会预测相同的输出。这是一个致命的概念性错误。\n-   **架构**：使用硬切换 $\\theta(\\eta - \\varepsilon)$ 在数值上是有问题的，因为它是不可微的，可能导致训练不稳定。平滑的门控函数要优越得多。此外，与选项 B 一样，它使用了不正确的标度变换前因子 $k_F(\\mathbf r)$ 而不是 $k_F(\\mathbf r)^2$，违反了**均匀坐标标度变换**约束。\n-   **损失函数**：缺少对**泛函可积性**或能量一致性的惩罚是另一个主要弱点。\n-   **对 D 的结论**：这种方法根本不可行。输入不足以定义问题，标度变换是错误的，架构选择也很差。**不正确**。\n\n**结论**\n选项 A 描述了一个精心设计的流程，以尊重问题的所有基本物理和数学约束。其“物理启发”的理念，将物理驱动的解析形式与灵活的神经网络以及一个强制约束的损失函数相结合，代表了该领域的最新技术水平。其他选项包含严重的概念性错误，从不正确的标度变换定律和不足的输入，到天真地依赖数据增强来学习深层的物理原理。一个严肃的实践者只会考虑选项 A 中概述的方法。", "answer": "$$\\boxed{A}$$", "id": "2892989"}]}