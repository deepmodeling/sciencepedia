{"hands_on_practices": [{"introduction": "在深入研究戴维森对角化之前，掌握所有迭代子空间方法的基本原理至关重要。这些方法通过在一个精心构造的子空间内解决一个更小的特征值问题，来近似求解大型矩阵的特征对。兰索斯（Lanczos）算法是一种基础技术，它为此目的生成一个称为克雷洛夫（Krylov）子空间的最优子空间。通过亲手完成兰索斯迭代的几个步骤 ([@problem_id:2900289])，您将具体理解投影矩阵是如何形成的，以及里兹（Ritz）对如何为真实特征对提供逐步改进的近似值，为理解戴维森方法更高级的特性打下坚实的基础。", "problem": "考虑由下式定义的厄米哈密顿矩阵 $H \\in \\mathbb{R}^{4 \\times 4}$\n$$\nH=\\begin{pmatrix}\n2  -1  0  0\\\\\n-1  2  -1  0\\\\\n0  -1  2  -1\\\\\n0  0  -1  2\n\\end{pmatrix}.\n$$\n从归一化初始向量 $v_{1}=\\begin{pmatrix}1  0  0  0\\end{pmatrix}^{\\mathsf{T}}$ 开始，执行 $2$ 步兰索斯迭代，为Krylov子空间 $\\mathcal{K}_{2}(H,v_{1})=\\operatorname{span}\\{v_{1},Hv_{1}\\}$ 构建标准正交基 $V_{2}=\\begin{pmatrix}v_{1}  v_{2}\\end{pmatrix}$，并构建投影三对角矩阵 $T_{2}=V_{2}^{\\mathsf{T}} H V_{2}$。然后，使用Rayleigh-Ritz (RR)过程，计算Ritz对 $(\\theta_{i},y_{i})$（其中 $i\\in\\{1,2\\}$），其中 $\\theta_{i}$ 和 $u_{i}$ 是 $T_{2}$ 的特征对，且 $y_{i}=V_{2}u_{i}$。对于每个Ritz对，构建残差向量 $r_{i}=Hy_{i}-\\theta_{i}y_{i}$。\n\n报告经过 $2$ 步兰索斯迭代后，与最低Ritz值对应的残差的欧几里得范数 $\\|r_{\\min}\\|_{2}$ 作为你的最终答案。将最终答案表示为精确表达式（不要四舍五入）。", "solution": "问题陈述需要经过验证。\n\n**步骤 1：提取已知条件**\n- 厄米哈密顿矩阵 $H \\in \\mathbb{R}^{4 \\times 4}$ 为：\n$$\nH=\\begin{pmatrix}\n2  -1  0  0\\\\\n-1  2  -1  0\\\\\n0  -1  2  -1\\\\\n0  0  -1  2\n\\end{pmatrix}\n$$\n- 归一化初始向量为 $v_{1}=\\begin{pmatrix}1  0  0  0\\end{pmatrix}^{\\mathsf{T}}$。\n- 需要执行的 Lanczos 迭代次数为 $2$。\n- 任务是为 Krylov 子空间 $\\mathcal{K}_{2}(H,v_{1})$ 构建标准正交基 $V_{2}=\\begin{pmatrix}v_{1}  v_{2}\\end{pmatrix}$，构建投影矩阵 $T_{2}=V_{2}^{\\mathsf{T}} H V_{2}$，计算 Ritz 对，并求出与最低 Ritz 值对应的残差向量的欧几里得范数。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，因为它涉及 Lanczos 算法，这是数值线性代数中用于寻找厄米矩阵特征值的标准和基本方法。矩阵 $H$ 是一个著名的对称三对角矩阵（一个 Toeplitz 矩阵），代表一个离散二阶导数算子，这在物理学和工程问题中很常见。所有需要的数据（$H$、$v_{1}$、步数）都已提供，并且该问题在数学上是适定的和自洽的。初始向量 $v_{1}$ 确实是归一化的，因为 $\\|v_1\\|_2 = \\sqrt{1^2+0^2+0^2+0^2} = 1$。不存在矛盾、歧义或事实不准确之处。该问题是计算科学中的一个标准练习。\n\n**步骤 3：结论与行动**\n问题有效。将构建一个解决方案。\n\n兰索斯算法生成一系列标准正交向量 $v_{j}$ 和一个三对角矩阵 $T_{k}$，其元素由以下递归关系定义：\n$w'_{j} = H v_{j} - \\sum_{i=1}^{j} (v_{i}^{\\mathsf{T}}H v_{j}) v_{i}$。对于厄米矩阵 $H$ 的三项递推关系，这可以简化为：\n$\\beta_{j+1} v_{j+1} = H v_{j} - \\alpha_{j} v_{j} - \\beta_{j} v_{j-1}$，其中 $\\alpha_{j} = v_{j}^{\\mathsf{T}} H v_{j}$ 且 $\\beta_{j+1} = \\| H v_{j} - \\alpha_{j} v_{j} - \\beta_{j} v_{j-1} \\|_{2}$。我们从 $\\beta_{1}=0$ 和 $v_{0}=0$ 开始。\n\n**兰索斯迭代的第 1 步 ($j=1$):**\n初始向量为 $v_{1} = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix}^{\\mathsf{T}}$。\n首先，我们计算向量 $w_1 = H v_{1}$：\n$$\nw_{1} = H v_{1} = \\begin{pmatrix} 2  -1  0  0\\\\ -1  2  -1  0\\\\ 0  -1  2  -1\\\\ 0  0  -1  2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$T$ 的第一个对角元素是 $\\alpha_{1}$：\n$$\n\\alpha_{1} = v_{1}^{\\mathsf{T}} w_{1} = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix} \\begin{pmatrix} 2 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = 2\n$$\n接下来，我们计算下一个未归一化的向量：\n$$\nw'_{1} = w_{1} - \\alpha_{1} v_{1} = \\begin{pmatrix} 2 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} - 2 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$T$ 的第一个次对角元素是 $\\beta_{2}$，即 $w'_{1}$ 的范数：\n$$\n\\beta_{2} = \\| w'_{1} \\|_{2} = \\sqrt{0^2 + (-1)^2 + 0^2 + 0^2} = 1\n$$\n第二个兰索斯向量 $v_{2}$ 是通过对 $w'_{1}$ 进行归一化得到的：\n$$\nv_{2} = \\frac{w'_{1}}{\\beta_{2}} = \\frac{1}{1} \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n\n**兰索斯迭代的第 2 步 ($j=2$):**\n我们计算 $w_2 = H v_{2}$：\n$$\nw_{2} = H v_{2} = \\begin{pmatrix} 2  -1  0  0\\\\ -1  2  -1  0\\\\ 0  -1  2  -1\\\\ 0  0  -1  2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ -2 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n$T$ 的第二个对角元素是 $\\alpha_{2}$：\n$$\n\\alpha_{2} = v_{2}^{\\mathsf{T}} w_{2} = \\begin{pmatrix} 0  -1  0  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -2 \\\\ 1 \\\\ 0 \\end{pmatrix} = 2\n$$\n下一个未归一化向量的迭代是 $w'_{2} = w_2 - \\alpha_2 v_2 - \\beta_2 v_1$：\n$$\nw'_{2} = \\begin{pmatrix} 1 \\\\ -2 \\\\ 1 \\\\ 0 \\end{pmatrix} - 2 \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} - 1 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1-0-1 \\\\ -2-(-2)-0 \\\\ 1-0-0 \\\\ 0-0-0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n下一个次对角元素是 $\\beta_{3}$：\n$$\n\\beta_{3} = \\| w'_{2} \\|_{2} = \\sqrt{0^2 + 0^2 + 1^2 + 0^2} = 1\n$$\n由于我们只需要 $2$ 步，过程到此终止。Krylov 子空间 $\\mathcal{K}_{2}(H, v_1)$ 的标准正交基是 $V_{2} = \\begin{pmatrix} v_{1}  v_{2} \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  -1 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix}$。\n\n投影的 $2 \\times 2$ 三对角矩阵 $T_{2}$ 是：\n$$\nT_{2} = \\begin{pmatrix} \\alpha_{1}  \\beta_{2} \\\\ \\beta_{2}  \\alpha_{2} \\end{pmatrix} = \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}\n$$\n\n**Rayleigh-Ritz 过程：**\n我们求解 $T_2$ 的特征对 $(\\theta_i, u_i)$。特征方程为 $\\det(T_2 - \\theta I) = 0$：\n$$\n\\det \\begin{pmatrix} 2-\\theta  1 \\\\ 1  2-\\theta \\end{pmatrix} = (2-\\theta)^2 - 1 = 0\n$$\n这得到 $2-\\theta = \\pm 1$，因此 Ritz 值为 $\\theta_{1} = 2-1 = 1$ 和 $\\theta_{2} = 2+1 = 3$。\n最低 Ritz 值为 $\\theta_{\\min} = \\theta_1 = 1$。\n\n现在我们求 $T_2$ 对应于 $\\theta_1 = 1$ 的特征向量 $u_1$：\n$$\n(T_{2} - \\theta_{1}I) u_{1} = \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix} \\begin{pmatrix} u_{11} \\\\ u_{12} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n这得到 $u_{11} + u_{12} = 0$，所以 $u_{11} = -u_{12}$。一个未归一化的特征向量是 $\\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n归一化的特征向量是 $u_{1} = \\frac{1}{\\sqrt{1^2+(-1)^2}} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n\n对应的 Ritz 向量 $y_1$ 是 $y_1 = V_2 u_1$：\n$$\ny_{1} = V_{2} u_{1} = \\begin{pmatrix} 1  0 \\\\ 0  -1 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix} \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n\n**残差计算：**\nRitz 对 $(\\theta_1, y_1)$ 的残差向量是 $r_{1} = Hy_{1} - \\theta_{1}y_{1}$。\n首先，计算 $Hy_1$：\n$$\nHy_{1} = \\begin{pmatrix} 2  -1  0  0\\\\ -1  2  -1  0\\\\ 0  -1  2  -1\\\\ 0  0  -1  2 \\end{pmatrix} \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 2(1) - 1(1) \\\\ -1(1) + 2(1) \\\\ 0(1) - 1(1) \\\\ 0 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ -1 \\\\ 0 \\end{pmatrix}\n$$\n现在，计算残差向量 $r_1$：\n$$\nr_{1} = Hy_{1} - \\theta_{1}y_{1} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ -1 \\\\ 0 \\end{pmatrix} - 1 \\cdot \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1-1 \\\\ 1-1 \\\\ -1-0 \\\\ 0-0 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 0 \\\\ 0 \\\\ -1 \\\\ 0 \\end{pmatrix}\n$$\n问题要求这个残差向量的欧几里得范数 $\\|r_{1}\\|_{2}$：\n$$\n\\|r_{1}\\|_{2} = \\left\\| \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 0 \\\\ 0 \\\\ -1 \\\\ 0 \\end{pmatrix} \\right\\|_{2} = \\frac{1}{\\sqrt{2}} \\sqrt{0^2 + 0^2 + (-1)^2 + 0^2} = \\frac{1}{\\sqrt{2}}\n$$\n\n另外，兰索斯算法的一个性质指出，对于一个 Ritz 对 $(\\theta_i, y_i=V_k u_i)$，其残差的范数由 $\\|r_i\\|_2 = \\beta_{k+1} |u_{i,k}|$ 给出，其中 $u_{i,k}$ 是 $T_k$ 对应特征向量的最后一个分量。在我们的例子中，$k=2$，所以我们需要 $\\|r_1\\|_2 = \\beta_3 |u_{1,2}|$。\n我们计算出 $\\beta_{3} = 1$。对应于 $\\theta_1=1$ 的特征向量是 $u_1 = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。最后一个分量是 $u_{1,2} = -1/\\sqrt{2}$。\n因此，残差的范数是：\n$$\n\\|r_{1}\\|_{2} = (1) \\left| -\\frac{1}{\\sqrt{2}} \\right| = \\frac{1}{\\sqrt{2}}\n$$\n这证实了通过直接计算得到的结果。", "answer": "$$\\boxed{\\frac{1}{\\sqrt{2}}}$$", "id": "2900289"}, {"introduction": "对于量子化学中常见的对角占优矩阵，戴维森方法相较于兰索斯类型的方法有所改进。其关键创新在于使用预处理器（preconditioner）来生成一个校正向量，该向量能更有效地指向所期望的特征向量。本练习 ([@problem_id:2900262]) 分解了戴维森算法的单次迭代，重点关注其核心机制：计算残差、应用对角预处理器形成校正向量，并通过在新的扩展子空间中求解问题来更新里兹值。完成此练习将揭开戴维森迭代的神秘面纱，向您精确展示试验向量在每一步中是如何被优化以加速收敛的。", "problem": "一个厄米矩阵 $A$ 是在一个正交原子轨道基组中电子哈密顿量的一个小亚块。考虑以下实对称 $4 \\times 4$ 矩阵\n$$\nA=\\begin{pmatrix}\n1  \\tfrac{1}{5}  0  0\\\\[4pt]\n\\tfrac{1}{5}  2  \\tfrac{3}{10}  0\\\\[4pt]\n0  \\tfrac{3}{10}  3  \\tfrac{2}{5}\\\\[4pt]\n0  0  \\tfrac{2}{5}  4\n\\end{pmatrix}.\n$$\n假设 Davidson 对角化的当前子空间包含一个单一的归一化试探向量 $u=\\begin{pmatrix}1  0  0  0\\end{pmatrix}^{\\mathsf{T}}$，用于近似基态特征向量。令相关的 Ritz 值 $\\theta$ 由瑞利商 $\\theta=\\dfrac{u^{\\mathsf{T}}Au}{u^{\\mathsf{T}}u}$ 定义。使用 Rayleigh–Ritz 过程的第一性原理和残差 $r$ 的定义，执行一个 Davidson 展开步骤，该步骤使用对角预处理器 $D=\\operatorname{diag}(A)$ 形成校正向量 $t$，将 $t$ 与当前子空间正交化，然后在增广子空间中进行 Rayleigh–Ritz 提取。\n\n你的任务是：\n- 从试探对 $(\\theta,u)$ 计算残差 $r$。\n- 使用对角预处理器 $D=\\operatorname{diag}(A)$ 和位移 $\\theta$ 构造标准的 Davidson 校正 $t$。\n- 将 $t$ 与当前子空间 $\\operatorname{span}\\{u\\}$ 正交化，将其归一化以获得单位向量 $w$，并形成双列基 $W=[u\\;w]$。\n- 构建投影的 $2\\times 2$ Rayleigh–Ritz 矩阵 $B=W^{\\mathsf{T}}AW$ 并提取其最小特征值作为更新后的基态 Ritz 值。\n\n在这单次 Davidson 展开步骤之后，更新后的最小 Ritz 值是多少？请用精确的解析表达式表示你的最终答案。不要四舍五入。", "solution": "该问题陈述经证实具有科学依据、提法恰当、客观且自成体系。它描述了 Davidson 对角化算法一步的标准应用，这是一种用于寻找大矩阵特征值的成熟迭代方法，常用于量子化学。所有必要的数据和定义都已提供，不存在不一致或含糊之处。我们将继续进行解答。\n\n该问题要求执行 Davidson 迭代过程的一个步骤，以精化给定矩阵 $A$ 的最低特征值的估计。将按规定步骤进行。\n\n给定的实对称矩阵为\n$$\nA = \\begin{pmatrix}\n1  \\frac{1}{5}  0  0 \\\\\n\\frac{1}{5}  2  \\frac{3}{10}  0 \\\\\n0  \\frac{3}{10}  3  \\frac{2}{5} \\\\\n0  0  \\frac{2}{5}  4\n\\end{pmatrix}\n$$\n初始子空间由单个归一化试探向量张成\n$$\nu = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n由于 $u$ 是归一化的，所以 $u^{\\mathsf{T}}u = 1$。\n\n首先，我们计算初始 Ritz 值 $\\theta$，即当前试探向量 $u$ 的瑞利商。\n$$\n\\theta = \\frac{u^{\\mathsf{T}}Au}{u^{\\mathsf{T}}u} = u^{\\mathsf{T}}Au\n$$\n我们计算乘积 $Au$：\n$$\nAu = \\begin{pmatrix}\n1  \\frac{1}{5}  0  0 \\\\\n\\frac{1}{5}  2  \\frac{3}{10}  0 \\\\\n0  \\frac{3}{10}  3  \\frac{2}{5} \\\\\n0  0  \\frac{2}{5}  4\n\\end{pmatrix}\n\\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} =\n\\begin{pmatrix} 1 \\\\ \\frac{1}{5} \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n那么，Ritz 值 $\\theta$ 是：\n$$\n\\theta = u^{\\mathsf{T}}(Au) = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ \\frac{1}{5} \\\\ 0 \\\\ 0 \\end{pmatrix} = 1\n$$\n特征值的初始近似为 $\\theta = 1$。\n\n接下来，我们计算与当前 Ritz 对 $(\\theta, u)$ 相关联的残差向量 $r$。\n$$\nr = Au - \\theta u = \\begin{pmatrix} 1 \\\\ \\frac{1}{5} \\\\ 0 \\\\ 0 \\end{pmatrix} - 1 \\cdot \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\frac{1}{5} \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n\n下一步是通过近似求解校正方程 $(A - \\theta I)t = -r$ 来计算校正向量 $t$。在 Davidson 方法中，矩阵 $(A - \\theta I)$ 由其对角线近似，从而得到预处理器 $(D - \\theta I)$，其中 $D = \\operatorname{diag}(A)$。\n$$\nD = \\operatorname{diag}(1, 2, 3, 4)\n$$\n校正方程变为 $(D - \\theta I)t = -r$。\n$$\n\\left( \\begin{pmatrix} 1  0  0  0 \\\\ 0  2  0  0 \\\\ 0  0  3  0 \\\\ 0  0  0  4 \\end{pmatrix} - 1 \\cdot \\begin{pmatrix} 1  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  1 \\end{pmatrix} \\right) t = -r\n$$\n$$\n\\begin{pmatrix} 0  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  2  0 \\\\ 0  0  0  3 \\end{pmatrix} t = -\\begin{pmatrix} 0 \\\\ \\frac{1}{5} \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$t = (t_1, t_2, t_3, t_4)^{\\mathsf{T}}$ 的分量通过 $t_i = -r_i / (D_{ii} - \\theta)$ 求得。对于索引 $i=1$，分母 $D_{11}-\\theta = 1-1=0$。由于相应的残差分量 $r_1$ 也为 $0$，因此该分量形式上是未定义的。标准的 Davidson 过程要求校正向量与当前解向量 $u$ 正交。由于 $u$ 是第一个规范基向量，此条件意味着 $t_1 = 0$。对于其他分量：\n$$\nt_2 = \\frac{-r_2}{D_{22}-\\theta} = \\frac{-1/5}{2-1} = -\\frac{1}{5}\n$$\n$$\nt_3 = \\frac{-r_3}{D_{33}-\\theta} = \\frac{-0}{3-1} = 0\n$$\n$$\nt_4 = \\frac{-r_4}{D_{44}-\\theta} = \\frac{-0}{4-1} = 0\n$$\n因此校正向量是\n$$\nt = \\begin{pmatrix} 0 \\\\ -1/5 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n现在，我们必须将校正向量 $t$ 与当前基（仅包含 $u$）进行正交化。我们使用 Gram-Schmidt 过程。令正交化后的向量为 $t'$。\n$$\nt' = t - (u^{\\mathsf{T}}t)u\n$$\n内积为\n$$\nu^{\\mathsf{T}}t = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ -1/5 \\\\ 0 \\\\ 0 \\end{pmatrix} = 0\n$$\n由于 $t$ 已经与 $u$ 正交，我们有 $t' = t$。然后我们将此向量归一化以获得新的基向量 $w$。\n$$\n\\|t'\\| = \\sqrt{0^2 + \\left(-\\frac{1}{5}\\right)^2 + 0^2 + 0^2} = \\frac{1}{5}\n$$\n$$\nw = \\frac{t'}{\\|t'\\|} = \\frac{1}{1/5} \\begin{pmatrix} 0 \\\\ -1/5 \\\\ 0 \\\\ 0 \\end{pmatrix} = 5 \\begin{pmatrix} 0 \\\\ -1/5 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n新的、扩展的正交基为 $\\{u, w\\}$。我们用这些向量作为列来构成矩阵 $W$。\n$$\nW = \\begin{bmatrix} u  w \\end{bmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  -1 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix}\n$$\n我们现在构建投影的 $2 \\times 2$ Rayleigh-Ritz 矩阵 $B = W^{\\mathsf{T}}AW$。\n首先，我们计算 $AW$：\n$$\nAW = A \\begin{pmatrix} 1  0 \\\\ 0  -1 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 1  -\\frac{1}{5} \\\\ \\frac{1}{5}  -2 \\\\ 0  -\\frac{3}{10} \\\\ 0  0 \\end{pmatrix}\n$$\n然后我们计算 $B$：\n$$\nB = W^{\\mathsf{T}} (AW) = \\begin{pmatrix} 1  0  0  0 \\\\ 0  -1  0  0 \\end{pmatrix} \\begin{pmatrix} 1  -\\frac{1}{5} \\\\ \\frac{1}{5}  -2 \\\\ 0  -\\frac{3}{10} \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 1  -\\frac{1}{5} \\\\ -\\frac{1}{5}  2 \\end{pmatrix}\n$$\n最后一步是通过求解特征方程 $\\det(B - \\lambda I) = 0$ 来找到 $B$ 的特征值。\n$$\n\\det \\begin{pmatrix} 1-\\lambda  -\\frac{1}{5} \\\\ -\\frac{1}{5}  2-\\lambda \\end{pmatrix} = (1-\\lambda)(2-\\lambda) - \\left(-\\frac{1}{5}\\right)^2 = 0\n$$\n$$\n\\lambda^2 - 3\\lambda + 2 - \\frac{1}{25} = 0\n$$\n$$\n\\lambda^2 - 3\\lambda + \\frac{50 - 1}{25} = 0\n$$\n$$\n\\lambda^2 - 3\\lambda + \\frac{49}{25} = 0\n$$\n我们求解这个关于 $\\lambda$ 的二次方程：\n$$\n\\lambda = \\frac{-(-3) \\pm \\sqrt{(-3)^2 - 4(1)\\left(\\frac{49}{25}\\right)}}{2(1)} = \\frac{3 \\pm \\sqrt{9 - \\frac{196}{25}}}{2}\n$$\n$$\n\\lambda = \\frac{3 \\pm \\sqrt{\\frac{225 - 196}{25}}}{2} = \\frac{3 \\pm \\sqrt{\\frac{29}{25}}}{2} = \\frac{3 \\pm \\frac{\\sqrt{29}}{5}}{2}\n$$\n两个特征值是 $\\lambda_1 = \\frac{3}{2} + \\frac{\\sqrt{29}}{10}$ 和 $\\lambda_2 = \\frac{3}{2} - \\frac{\\sqrt{29}}{10}$。\n问题要求更新后的最小 Ritz 值，它对应于 $B$ 的最小特征值。即 $\\lambda_2$。\n$$\n\\lambda_{\\min} = \\frac{3}{2} - \\frac{\\sqrt{29}}{10}\n$$\n这是经过一次 Davidson 展开步骤后基态特征值的更新估计。", "answer": "$$\\boxed{\\frac{3}{2} - \\frac{\\sqrt{29}}{10}}$$", "id": "2900262"}, {"introduction": "在实际的量子化学计算中，原子轨道通常构成非正交基组。这导致了广义特征值问题 $H c = \\theta S c$，其中 $S$ 是非单位的重叠矩阵。标准的戴维森算法必须进行调整以处理这种更复杂的形式。这个实践练习 ([@problem_id:2900312]) 将指导您完成必要的修改，包括广义瑞利商（Rayleigh quotient）、相应残差的构建，以及至关重要的考虑了 $S$ 矩阵的对角预处理器 $(D - \\theta S)^{-1}$。通过应用这些步骤，您将学会如何为电子结构理论中无处不在的各类特征值问题正确实现戴维森方法，包括处理预处理器中为保证数值稳定性而引入的近奇异点的重要步骤。", "problem": "给定一个在非正交原子轨道（AO）基组下的广义对称特征值问题，其中重叠矩阵用 $S$ 表示，哈密顿（或类 Fock）矩阵用 $H$ 表示。该广义特征值问题旨在求解一对 $(\\theta, c)$，使得\n$$\nH c = \\theta S c,\n$$\n其中 $S$ 是对称正定矩阵，$H$ 是对称矩阵。在 Davidson 方法中，子空间扩展向量由当前 Ritz 对的残差和一个近似移位算子逆的预处理器构造而成。你的任务是：从第一性原理出发，推导广义特征值问题的残差构造方法；论证在非正交基中使用对角预处理器的合理性；使用对角预处理器实现一个考虑 $S$ 的 Davidson 步骤；并为一小组测试用例计算子空间扩展向量。\n\n您必须使用的基本根据和定义：\n- 向量 $c$ 关于 $(H, S)$ 的广义瑞利商定义为\n$$\n\\theta(c) = \\frac{c^{\\mathsf{T}} H c}{c^{\\mathsf{T}} S c}.\n$$\n- 与广义特征值问题的 $(\\theta, c)$ 相关的残差是\n$$\nr = H c - \\theta S c.\n$$\n- 在 Davidson 方法中，我们通过使用一个在 AO 基中近似 $H$ 的对角矩阵 $D$ 来近似算子 $H - \\theta S$ 的逆。在非正交 AO 基中，一个考虑 $S$ 的对角预处理器通过一个对角矩阵的逆来近似 $(H - \\theta S)^{-1}$，该对角矩阵的元素为 $D_{ii} - \\theta S_{ii}$，并逐元素应用。\n\n需要实现的算法任务：\n1. 对于每个测试用例，输入对称矩阵 $H \\in \\mathbb{R}^{n \\times n}$、对称正定矩阵 $S \\in \\mathbb{R}^{n \\times n}$、对角近似 $D \\in \\mathbb{R}^{n}$（除非另有规定，否则为 $H$ 的对角线）以及一个非零向量 $c \\in \\mathbb{R}^{n}$。\n2. 计算广义瑞利商\n$$\n\\theta = \\frac{c^{\\mathsf{T}} H c}{c^{\\mathsf{T}} S c}.\n$$\n3. 计算残差\n$$\nr = H c - \\theta S c.\n$$\n4. 构造逐元素分母\n$$\n\\delta_i = D_{ii} - \\theta S_{ii}.\n$$\n5. 为了安全地对接近零的分母求逆，应用一个带阻尼参数 $\\tau > 0$ 的幅度限制：定义有效分母 $\\tilde{\\delta}_i$ 如下\n- 如果 $|\\delta_i| \\ge \\tau$，则设 $\\tilde{\\delta}_i = \\delta_i$。\n- 如果 $|\\delta_i|  \\tau$ 且 $\\delta_i > 0$，则设 $\\tilde{\\delta}_i = \\tau$。\n- 如果 $|\\delta_i|  \\tau$ 且 $\\delta_i  0$，则设 $\\tilde{\\delta}_i = -\\tau$。\n- 如果 $\\delta_i = 0$，则设 $\\tilde{\\delta}_i = \\tau$。\n6. 计算考虑 $S$ 的 Davidson 子空间扩展向量，其值为带负号的预处理后残差，\n$$\nt_i = - \\frac{r_i}{\\tilde{\\delta}_i}, \\quad i = 1, \\dots, n.\n$$\n在此任务中不执行任何正交化；返回原始的预处理校正量 $t$。\n\n数值稳定性要求：\n- 在所有情况下，除非另有说明，否则使用阻尼参数 $\\tau = 10^{-4}$。\n\n测试套件：\n实现您的程序，为以下各种情况计算向量 $t$。所有矩阵和向量都已明确给出。下面出现的每个数字都应被视为标准双精度算术中的实数标量。\n\n- 情况 A（基准，尺寸 $3 \\times 3$）：\n  - $H = \\begin{bmatrix} 1.2  0.1  0.0 \\\\ 0.1  0.9  0.05 \\\\ 0.0  0.05  1.5 \\end{bmatrix}$,\n    $S = \\begin{bmatrix} 1.0  0.02  0.0 \\\\ 0.02  1.0  0.01 \\\\ 0.0  0.01  1.0 \\end{bmatrix}$,\n    $D = \\operatorname{diag}(1.2, 0.9, 1.5)$,\n    $c = \\begin{bmatrix} 0.6 \\\\ 0.3 \\\\ 0.2 \\end{bmatrix}$,\n    $\\tau = 10^{-4}$.\n- 情况 B（近奇异分母，尺寸 $3 \\times 3$）：\n  - $H = \\operatorname{diag}(1.0, 2.0, 3.0)$,\n    $S = I_{3}$,\n    $D = \\operatorname{diag}(1.0, 2.0, 3.0)$,\n    $c = \\begin{bmatrix} 0.01 \\\\ 1.0 \\\\ 0.01 \\end{bmatrix}$,\n    $\\tau = 10^{-4}$.\n- 情况 C（带非对角元素的非正交重叠，尺寸 $3 \\times 3$）：\n  - $H = \\begin{bmatrix} 1.8  0.3  0.2 \\\\ 0.3  1.1  0.4 \\\\ 0.2  0.4  1.6 \\end{bmatrix}$,\n    $S = \\begin{bmatrix} 1.0  0.2  0.0 \\\\ 0.2  1.0  0.1 \\\\ 0.0  0.1  1.0 \\end{bmatrix}$,\n    $D = \\operatorname{diag}(1.8, 1.1, 1.6)$,\n    $c = \\begin{bmatrix} 0.3 \\\\ -0.4 \\\\ 0.5 \\end{bmatrix}$,\n    $\\tau = 10^{-4}$.\n- 情况 D（有显著重叠的小系统，尺寸 $2 \\times 2$）：\n  - $H = \\begin{bmatrix} 0.7  0.05 \\\\ 0.05  1.9 \\end{bmatrix}$,\n    $S = \\begin{bmatrix} 1.0  0.3 \\\\ 0.3  1.0 \\end{bmatrix}$,\n    $D = \\operatorname{diag}(0.7, 1.9)$,\n    $c = \\begin{bmatrix} 1.0 \\\\ 0.2 \\end{bmatrix}$,\n    $\\tau = 10^{-4}$.\n- 情况 E（精确特征向量，零残差检查，尺寸 $2 \\times 2$）：\n  - $H = \\operatorname{diag}(1.0, 3.0)$,\n    $S = I_{2}$,\n    $D = \\operatorname{diag}(1.0, 3.0)$,\n    $c = \\begin{bmatrix} 1.0 \\\\ 0.0 \\end{bmatrix}$,\n    $\\tau = 10^{-4}$.\n\n您的程序应使用上述过程计算每种情况下的向量 $t$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表，列表中的每个元素本身也是一个列表，代表给定情况下的子空间扩展向量 $t$，其顺序与上面列出的顺序相同。例如，输出格式应如下所示：\n`[ [t^{(A)}_1, t^{(A)}_2, \\dots], [t^{(B)}_1, \\dots], \\dots ]`。\n- 所有条目均使用标准浮点小数表示法。不涉及任何物理单位。", "solution": "所提出的问题是数值线性代数中一个精确且表述清晰的练习，具体涉及使用 Davidson 迭代法求解广义对称特征值问题的一个步骤。它在科学上是合理的，逻辑上是一致的，并为得出唯一解提供了所有必要信息。我们将给出一个完整且有理有据的解法。\n\n许多量子化学计算（例如 Hartree-Fock 方法）的核心任务是求解广义特征值问题：\n$$\nH c = \\theta S c\n$$\n在这里，$H$ 是哈密顿（或 Fock）矩阵，它是对称的；$S$ 是非正交原子轨道基的重叠矩阵，它是对称正定的。特征值 $\\theta$ 对应于轨道能量，特征向量 $c$ 代表构成 分子轨道的原子轨道的系数。\n\n对于大尺寸系统，对完整矩阵进行直接对角化的计算成本过高。因此，通常采用迭代方法，例如 Davidson 提出的方法。这些方法通过构建一个​​小型子空间，在该子空间内求解特征值问题，然后用一个新向量系统地扩展该子空间，该新向量有望有效地改进对所求特征对的近似。\n\n让我们假设我们有一个对特征向量的当前近似，用向量 $c$ 表示。该近似的质量通过广义瑞利商进行评估：\n$$\n\\theta = \\theta(c) = \\frac{c^{\\mathsf{T}} H c}{c^{\\mathsf{T}} S c}\n$$\n对于给定的试探向量 $c$，这个值 $\\theta$ 是特征值的最佳可能近似。相应的残差向量 $r$ 量化了该近似对 $(\\theta, c)$ 在特征方程中的误差：\n$$\nr = H c - \\theta S c\n$$\n如果 $c$ 是一个精确的特征向量，残差 $r$ 将是零向量。非零残差表明该近似必须得到改进。Davidson 方法的核心思想是计算一个校正向量 $\\delta c$，使得 $c + \\delta c$ 成为对真实特征向量更好的近似。\n\n精确的校正量 $\\delta c$ 应满足方程 $H(c + \\delta c) = \\theta_{\\text{exact}} S(c + \\delta c)$，该方程是非线性的且难以求解。一种称为校正方程的线性近似，是通过要求新向量 $c + \\delta c$ 满足使用当前近似特征值 $\\theta$ 的原始方程而导出的：\n$$\nH(c + \\delta c) = \\theta S (c + \\delta c)\n$$\n重新整理可得：\n$$\n(H - \\theta S) \\delta c = - (H c - \\theta S c) = -r\n$$\n这为校正量提供了一个线性系统：$\\delta c = -(H - \\theta S)^{-1} r$。然而，求解该系统的计算成本与原始问题一样高昂。Davidson 方法的创新之处在于用一个更简单、可逆的算子（称为预处理器）来近似算子 $(H - \\theta S)^{-1}$。\n\n在典型的原子轨道基中，哈密顿矩阵 $H$ 通常是对角占优的，这意味着对角元素的量级远大于非对角元素。这表明 $H$ 的对角线（我们记为 $D$）是 $H$ 的一个合理的一阶近似。遵循这一逻辑，我们仅用其对角分量来近似算子 $(H - \\theta S)$。这就引出了所谓的考虑 $S$ 的对角预处理器。矩阵 $(H - \\theta S)$ 由一个对角矩阵 $P$ 近似，其元素为：\n$$\nP_{ii} = D_{ii} - \\theta S_{ii}\n$$\n该对角矩阵的逆可以轻易地计算出来：$(P^{-1})_{ii} = 1/P_{ii}$。将此预处理器应用于残差，即可得到新的子空间扩展向量，问题中将其表示为 $t$：\n$$\nt_i = -\\frac{r_i}{D_{ii} - \\theta S_{ii}}\n$$\n该向量 $t$ 是预处理后的残差。它被用于在 Davidson 算法的下一次迭代中扩展子空间。\n\n当分母 $\\delta_i = D_{ii} - \\theta S_{ii}$ 接近于零时，会出现一个关键问题。这种情况发生在当前瑞利商 $\\theta$ 接近某个近似特征值 $D_{ii}/S_{ii}$ 时。此时，相应分量 $t_i$ 的大小可能会变得过大，导致迭代过程中的数值不稳定性。为防止这种情况，我们采用一种正则化技术。引入一个小的正阻尼参数 $\\tau$。分母 $\\delta_i$ 被“限制”，使其绝对值不小于 $\\tau$。有效分母 $\\tilde{\\delta}_i$ 定义如下：\n- 如果 $|\\delta_i| \\ge \\tau$，$\\tilde{\\delta}_i = \\delta_i$。\n- 如果 $|\\delta_i|  \\tau$，则将该值推至允许区间的边界，并保持其符号。对于 $\\delta_i > 0$，$\\tilde{\\delta}_i = \\tau$；对于 $\\delta_i  0$，$\\tilde{\\delta}_i = -\\tau$。\n- 特殊情况 $\\delta_i = 0$ 通过设置 $\\tilde{\\delta}_i = \\tau$ 来处理。\n\n这种限制过程确保了校正向量 $t$ 的量级保持在合理范围内，从而稳定了 Davidson 方法的收敛性。\n\n按照规定，单个 Davidson 步骤的完整算法如下：\n1.  给定 $H$、$S$、$D$、一个非零向量 $c$ 和一个阻尼参数 $\\tau$。\n2.  计算广义瑞利商：$\\theta = (c^{\\mathsf{T}} H c) / (c^{\\mathsf{T}} S c)$。\n3.  计算残差向量：$r = H c - \\theta S c$。\n4.  构造对角预处理器的分母：对每个 $i$ 计算 $\\delta_i = D_{ii} - \\theta S_{ii}$。\n5.  使用参数 $\\tau$ 应用幅度限制，以获得稳定化的分母 $\\tilde{\\delta}_i$。\n6.  计算子空间扩展向量：$t_i = -r_i / \\tilde{\\delta}_i$。\n\n这个稳健的程序构成了一次 Davidson 特征求解器迭代的核心，我们现在将为给定的测试用例实现它。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by computing the S-aware Davidson subspace expansion\n    vector for a suite of test cases.\n    \"\"\"\n\n    def compute_expansion_vector(H, S, D, c, tau):\n        \"\"\"\n        Computes the S-aware Davidson subspace expansion vector for a single case.\n\n        Args:\n            H (np.ndarray): The Hamiltonian matrix.\n            S (np.ndarray): The overlap matrix.\n            D (np.ndarray): The diagonal approximation of H.\n            c (np.ndarray): The current approximate eigenvector.\n            tau (float): The damping parameter for the preconditioner.\n\n        Returns:\n            np.ndarray: The computed subspace expansion vector t.\n        \"\"\"\n        # 1. Ensure inputs are numpy arrays for consistent operations.\n        H = np.asarray(H, dtype=float)\n        S = np.asarray(S, dtype=float)\n        D = np.asarray(D, dtype=float)\n        c = np.asarray(c, dtype=float)\n\n        # 2. Compute the generalized Rayleigh quotient theta.\n        c_T_H_c = c.T @ H @ c\n        c_T_S_c = c.T @ S @ c\n        \n        # Avoid division by zero if c is the zero vector, though problem states non-zero.\n        if c_T_S_c == 0:\n            # This case is not expected with valid inputs (S is SPD, c is non-zero)\n            # but as a safeguard, we can define theta as 0 or handle the error.\n            # A zero residual will result if Hc is also zero.\n            theta = 0.0\n        else:\n            theta = c_T_H_c / c_T_S_c\n\n        # 3. Compute the residual r.\n        r = H @ c - theta * (S @ c)\n\n        # 4. Form the elementwise denominators for the preconditioner.\n        # S.diagonal() extracts the main diagonal of the overlap matrix S.\n        denominators = D - theta * S.diagonal()\n\n        # 5. Apply magnitude clamping with the damping parameter tau.\n        tilde_denominators = np.zeros_like(denominators)\n        for i, delta in enumerate(denominators):\n            if abs(delta) >= tau:\n                tilde_denominators[i] = delta\n            else:\n                if delta == 0:\n                    tilde_denominators[i] = tau\n                elif delta > 0:\n                    tilde_denominators[i] = tau\n                else: # delta  0\n                    tilde_denominators[i] = -tau\n\n        # 6. Compute the subspace expansion vector t.\n        # We must handle the case where tilde_denominators can still be zero,\n        # although the logic above prevents this for non-zero tau.\n        # The elementwise division is safe.\n        t = -r / tilde_denominators\n        \n        return t\n\n    # Define the test cases from the problem statement.\n    tau_global = 1e-4\n\n    test_cases = [\n        # Case A\n        (\n            [[1.2, 0.1, 0.0], [0.1, 0.9, 0.05], [0.0, 0.05, 1.5]],\n            [[1.0, 0.02, 0.0], [0.02, 1.0, 0.01], [0.0, 0.01, 1.0]],\n            [1.2, 0.9, 1.5],\n            [0.6, 0.3, 0.2],\n            tau_global\n        ),\n        # Case B\n        (\n            [[1.0, 0.0, 0.0], [0.0, 2.0, 0.0], [0.0, 0.0, 3.0]],\n            [[1.0, 0.0, 0.0], [0.0, 1.0, 0.0], [0.0, 0.0, 1.0]],\n            [1.0, 2.0, 3.0],\n            [0.01, 1.0, 0.01],\n            tau_global\n        ),\n        # Case C\n        (\n            [[1.8, 0.3, 0.2], [0.3, 1.1, 0.4], [0.2, 0.4, 1.6]],\n            [[1.0, 0.2, 0.0], [0.2, 1.0, 0.1], [0.0, 0.1, 1.0]],\n            [1.8, 1.1, 1.6],\n            [0.3, -0.4, 0.5],\n            tau_global\n        ),\n        # Case D\n        (\n            [[0.7, 0.05], [0.05, 1.9]],\n            [[1.0, 0.3], [0.3, 1.0]],\n            [0.7, 1.9],\n            [1.0, 0.2],\n            tau_global\n        ),\n        # Case E\n        (\n            [[1.0, 0.0], [0.0, 3.0]],\n            [[1.0, 0.0], [0.0, 1.0]],\n            [1.0, 3.0],\n            [1.0, 0.0],\n            tau_global\n        )\n    ]\n\n    results = []\n    for case in test_cases:\n        H_case, S_case, D_case, c_case, tau_case = case\n        t_vector = compute_expansion_vector(H_case, S_case, D_case, c_case, tau_case)\n        results.append(t_vector.tolist())\n\n    # Final print statement in the exact required format.\n    # The default string representation of a list of lists matches the required format.\n    print(str(results).replace(\" \", \"\"))\n```", "id": "2900312"}]}