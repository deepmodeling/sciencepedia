{"hands_on_practices": [{"introduction": "虽然解析梯度方法提供了高精度和高效率，但理解其数值对应方法——有限差分法，对任何计算化学家来说都至关重要。第一个实践将探讨数值微分的基本挑战：如何在数学近似带来的截断误差与有限精度运算产生的舍入误差之间取得平衡。通过推导最佳步长，您将更深刻地体会到数值计算的精妙之处，并理解为何需要发展更复杂的解析梯度技术 [@problem_id:2874113]。", "problem": "在波恩-奥本海默量子化学中，沿着单一内坐标 $R$ 的分子力分量为 $F(R)=-\\frac{dE(R)}{dR}$，其中 $E(R)$ 是在固定核坐标下的电子能量。假设 $E(R)$ 足够光滑，您使用中心有限差分估计量\n$$\nG_{h}(R)\\;=\\;\\frac{E(R+h)\\;-\\;E(R-h)}{2h}.\n$$\n来近似导数 $\\frac{dE(R)}{dR}$。\n假设存在两种独立的误差来源：\n- 截断误差源于泰勒级数余项，其随 $h$ 的变化尺度为 $\\mathcal{O}(h^{2})$。\n- 数值噪声的产生是由于每次计算的能量值 $E(R\\pm h)$ 都受到一个由浮点舍入和不完全自洽场 (SCF) 收敛引起的加性误差的污染。通过假设计算出的能量为 $\\tilde{E}(R\\pm h)=E(R\\pm h)+\\delta_{\\pm}$，且 $|\\delta_{\\pm}|\\le \\sigma_{E}$ 来对此建模，其中 $\\sigma_{E}$ 是一个已知的绝对能量误差界限，它整合了机器舍入和 SCF 残差。\n\n仅从 $E(R\\pm h)$ 关于 $R$ 的带有积分形式余项的泰勒展开和上述噪声模型出发，推导出 $G_{h}(R)$ 中总误差大小的主阶表达式，该表达式是 $h$、$E^{(3)}(R)$ 和 $\\sigma_{E}$ 的函数。然后，确定使该主阶误差最小化的步长 $h$。将您的最终答案表示为最优步长 $h_{\\text{opt}}$ 的单个闭式解析表达式，用 $\\sigma_{E}$ 和 $E^{(3)}(R)$ 表示。不要代入数值，最终表达式中也不要包含单位。", "solution": "该问题要求为能量导数的中心有限差分近似推导一个最优步长 $h_{\\text{opt}}$。推导过程必须考虑两种相互竞争的误差来源：有限差分公式固有的截断误差和能量计算产生的数值噪声。总误差必须首先表示为步长 $h$ 的函数，然后必须最小化该函数以找到最优的 $h$。\n\n待近似的量是能量的一阶导数 $E'(R) = \\frac{dE(R)}{dR}$。该量的中心有限差分估计量由 $D_h(R) = \\frac{E(R+h) - E(R-h)}{2h}$ 给出。注意，力是 $F(R) = -E'(R)$，所以我们计算的是 $-F(R)$ 的近似值。我们导数计算中的总误差是包含数值噪声的计算值与导数真值之间的差。\n\n让我们首先确定截断误差 $\\epsilon_{\\text{trunc}}$。这个误差是使用精确能量的有限差分近似与真导数之间的差：$\\epsilon_{\\text{trunc}}(h) = D_h(R) - E'(R)$。题目要求我们使用带有积分形式余项的泰勒级数展开。对于一个足够光滑的函数 $E(R)$，$E(R+h)$ 和 $E(R-h)$ 关于 $R$ 直到二阶项的展开式为：\n$$\nE(R+h) = E(R) + E'(R)h + \\frac{E''(R)}{2!}h^2 + \\frac{1}{2!} \\int_R^{R+h} (R+h-t)^2 E^{(3)}(t) dt\n$$\n$$\nE(R-h) = E(R) - E'(R)h + \\frac{E''(R)}{2!}h^2 + \\frac{1}{2!} \\int_R^{R-h} (R-h-t)^2 E^{(3)}(t) dt\n$$\n从第一个方程中减去第二个方程，得到：\n$$\nE(R+h) - E(R-h) = 2E'(R)h + \\frac{1}{2} \\left( \\int_R^{R+h} (R+h-t)^2 E^{(3)}(t) dt - \\int_R^{R-h} (R-h-t)^2 E^{(3)}(t) dt \\right)\n$$\n两边除以 $2h$ 以构成有限差分表达式 $D_h(R)$：\n$$\nD_h(R) = E'(R) + \\frac{1}{4h} \\left( \\int_R^{R+h} (R+h-t)^2 E^{(3)}(t) dt - \\int_R^{R-h} (R-h-t)^2 E^{(3)}(t) dt \\right)\n$$\n因此，截断误差为：\n$$\n\\epsilon_{\\text{trunc}}(h) = \\frac{1}{4h} \\left( \\int_R^{R+h} (R+h-t)^2 E^{(3)}(t) dt - \\int_R^{R-h} (R-h-t)^2 E^{(3)}(t) dt \\right)\n$$\n为了找到主阶行为，我们假设 $h$ 很小。对于积分区间 $[R-h, R+h]$ 内的 $t$，我们可以用区间中心点的值 $E^{(3)}(R)$ 来近似三阶导数 $E^{(3)}(t)$，即 $E^{(3)}(t) \\approx E^{(3)}(R)$。这是合理的，因为我们假设函数 $E(R)$ 是光滑的。\n$$\n\\epsilon_{\\text{trunc}}(h) \\approx \\frac{E^{(3)}(R)}{4h} \\left( \\int_R^{R+h} (R+h-t)^2 dt - \\int_R^{R-h} (R-h-t)^2 dt \\right)\n$$\n积分计算结果为：\n$$\n\\int_R^{R+h} (R+h-t)^2 dt = \\left[ -\\frac{(R+h-t)^3}{3} \\right]_R^{R+h} = 0 - \\left(-\\frac{h^3}{3}\\right) = \\frac{h^3}{3}\n$$\n$$\n\\int_R^{R-h} (R-h-t)^2 dt = \\left[ -\\frac{(R-h-t)^3}{3} \\right]_R^{R-h} = 0 - \\left(-\\frac{(-h)^3}{3}\\right) = -\\frac{h^3}{3}\n$$\n将这些结果代回 $\\epsilon_{\\text{trunc}}(h)$ 的表达式中：\n$$\n\\epsilon_{\\text{trunc}}(h) \\approx \\frac{E^{(3)}(R)}{4h} \\left( \\frac{h^3}{3} - \\left(-\\frac{h^3}{3}\\right) \\right) = \\frac{E^{(3)}(R)}{4h} \\left( \\frac{2h^3}{3} \\right) = \\frac{E^{(3)}(R)}{6}h^2\n$$\n主阶截断误差的大小为 $|\\epsilon_{\\text{trunc}}(h)| \\approx \\frac{|E^{(3)}(R)|}{6}h^2$。\n\n接下来，我们分析由数值噪声引起的误差。计算得到的梯度估计量 $\\tilde{G}_h(R)$ 使用了被误差 $\\delta_{\\pm}$ 污染的能量：\n$$\n\\tilde{G}_h(R) = \\frac{\\tilde{E}(R+h) - \\tilde{E}(R-h)}{2h} = \\frac{(E(R+h) + \\delta_+) - (E(R-h) + \\delta_-)}{2h}\n$$\n$$\n\\tilde{G}_h(R) = \\frac{E(R+h) - E(R-h)}{2h} + \\frac{\\delta_+ - \\delta_-}{2h} = D_h(R) + \\epsilon_{\\text{noise}}(h)\n$$\n由数值噪声引起的误差是 $\\epsilon_{\\text{noise}}(h) = \\frac{\\delta_+ - \\delta_-}{2h}$。我们已知单个能量误差大小的上限为：$|\\delta_{\\pm}| \\le \\sigma_E$。我们寻求噪声误差大小 $|\\epsilon_{\\text{noise}}(h)|$ 的界限：\n$$\n|\\epsilon_{\\text{noise}}(h)| = \\left| \\frac{\\delta_+ - \\delta_-}{2h} \\right| = \\frac{|\\delta_+ - \\delta_-|}{2h}\n$$\n使用三角不等式，有 $|\\delta_+ - \\delta_-| \\le |\\delta_+| + |-\\delta_-| = |\\delta_+| + |\\delta_-|$。最坏情况发生在误差符号相反且大小达到最大值时：\n$$\n|\\epsilon_{\\text{noise}}(h)| \\le \\frac{|\\delta_+| + |\\delta_-|}{2h} \\le \\frac{\\sigma_E + \\sigma_E}{2h} = \\frac{2\\sigma_E}{2h} = \\frac{\\sigma_E}{h}\n$$\n计算得到的梯度中的总误差为 $\\epsilon_{\\text{total}} = \\tilde{G}_h(R) - E'(R) = \\epsilon_{\\text{trunc}}(h) + \\epsilon_{\\text{noise}}(h)$。总误差的大小由各个误差贡献的大小之和所限定（同样根据三角不等式）：\n$$\n|\\epsilon_{\\text{total}}(h)| \\le |\\epsilon_{\\text{trunc}}(h)| + |\\epsilon_{\\text{noise}}(h)|\n$$\n我们使用主阶截断误差和最坏情况下的噪声误差来定义总误差函数 $\\mathcal{E}(h)$：\n$$\n\\mathcal{E}(h) = \\frac{|E^{(3)}(R)|}{6}h^2 + \\frac{\\sigma_E}{h}\n$$\n为了找到使该总误差最小化的步长 $h$，我们将 $\\mathcal{E}(h)$ 对 $h$ 求导，并令结果为零：\n$$\n\\frac{d\\mathcal{E}(h)}{dh} = \\frac{d}{dh} \\left( \\frac{|E^{(3)}(R)|}{6}h^2 + \\sigma_E h^{-1} \\right) = 2 \\frac{|E^{(3)}(R)|}{6}h - \\sigma_E h^{-2} = \\frac{|E^{(3)}(R)|}{3}h - \\frac{\\sigma_E}{h^2}\n$$\n将导数设为零以求得最优步长 $h_{\\text{opt}}$：\n$$\n\\frac{|E^{(3)}(R)|}{3}h_{\\text{opt}} - \\frac{\\sigma_E}{h_{\\text{opt}}^2} = 0\n$$\n$$\n\\frac{|E^{(3)}(R)|}{3}h_{\\text{opt}} = \\frac{\\sigma_E}{h_{\\text{opt}}^2}\n$$\n$$\nh_{\\text{opt}}^3 = \\frac{3\\sigma_E}{|E^{(3)}(R)|}\n$$\n解出 $h_{\\text{opt}}$ 得到：\n$$\nh_{\\text{opt}} = \\left( \\frac{3\\sigma_E}{|E^{(3)}(R)|} \\right)^{\\frac{1}{3}}\n$$\n二阶导数 $\\frac{d^2\\mathcal{E}}{dh^2} = \\frac{|E^{(3)}(R)|}{3} + \\frac{2\\sigma_E}{h^3}$，对于正的 $h$、$\\sigma_E$ 和非零的 $E^{(3)}(R)$ 恒为正，这证实了该 $h$ 值对应于误差函数的最小值。使用绝对值 $|E^{(3)}(R)|$ 是必要的，以确保步长 $h_{\\text{opt}}$ 是一个实数且为正。", "answer": "$$\n\\boxed{\\left( \\frac{3\\sigma_{E}}{|E^{(3)}(R)|} \\right)^{\\frac{1}{3}}}\n$$", "id": "2874113"}, {"introduction": "从一般原理转向具体应用，我们现在关注分子几何本身的导数。几何优化通常在一组内坐标（如键长、键角和二面角）中进行，这比在笛卡尔坐标中更高效。本练习将引导您完成二面角对笛卡尔坐标的解析微分，这是一项颇具挑战性的任务，它不仅需要巧妙运用矢量微积分，还会揭示在工业级软件中必须处理的重要几何奇异点问题 [@problem_id:2874054]。", "problem": "在量子化学中用于几何优化的内坐标中，与四个原子 $\\,i,j,k,l\\,$ 相关的二面角 $\\,\\phi(i,j,k,l)\\,$ 是平面 $\\, (i,j,k)\\,$ 和平面 $\\, (j,k,l)\\,$ 之间的带符号夹角，其符号由关于从 $\\,j\\,$ 到 $\\,k\\,$ 的键矢量的右手定则确定。设笛卡尔坐标位置为 $\\,\\mathbf{r}_i,\\mathbf{r}_j,\\mathbf{r}_k,\\mathbf{r}_l \\in \\mathbb{R}^3$。定义键矢量 $\\,\\mathbf{b}_1 = \\mathbf{r}_j - \\mathbf{r}_i\\,$, $\\,\\mathbf{b}_2 = \\mathbf{r}_k - \\mathbf{r}_j\\,$ 和 $\\,\\mathbf{b}_3 = \\mathbf{r}_l - \\mathbf{r}_k\\,$。定义平面法向量 $\\,\\mathbf{u} = \\mathbf{b}_1 \\times \\mathbf{b}_2\\,$ 和 $\\,\\mathbf{v} = \\mathbf{b}_2 \\times \\mathbf{b}_3\\,$。二面角的一个平滑带符号定义是 $\\,\\phi = \\arctan2(\\beta,\\alpha)\\,$，其中 $\\,\\alpha = \\mathbf{u}\\cdot\\mathbf{v}\\,$ 且 $\\,\\beta = \\|\\mathbf{b}_2\\|\\,(\\mathbf{b}_1\\cdot \\mathbf{v})\\,$，这里 $\\,\\arctan2(y,x)\\,$ 返回一个角度，其正切值为 $\\,y/x\\,$ 且该角度位于正确的象限。\n\n任务：\n1. 从这些定义出发，仅使用标准矢量微积分和微分恒等式，推导出一阶微分 $\\,\\mathrm{d}\\phi\\,$，用 $\\,\\mathrm{d}\\mathbf{r}_i, \\mathrm{d}\\mathbf{r}_j, \\mathrm{d}\\mathbf{r}_k, \\mathrm{d}\\mathbf{r}_l\\,$ 表示。通过 $\\,\\mathrm{d}\\alpha\\,$ 和 $\\,\\mathrm{d}\\beta\\,$ 表达 $\\,\\mathrm{d}\\phi\\,$，然后通过 $\\,\\mathrm{d}\\mathbf{b}_1, \\mathrm{d}\\mathbf{b}_2, \\mathrm{d}\\mathbf{b}_3\\,$ 用笛卡尔坐标的微分来表示。你可以使用乘积法则 $\\,\\mathrm{d}(\\mathbf{a}\\cdot\\mathbf{b}) = \\mathrm{d}\\mathbf{a}\\cdot\\mathbf{b} + \\mathbf{a}\\cdot\\mathrm{d}\\mathbf{b}\\,$ 和 $\\,\\mathrm{d}(\\mathbf{a}\\times\\mathbf{b}) = \\mathrm{d}\\mathbf{a}\\times\\mathbf{b} + \\mathbf{a}\\times\\mathrm{d}\\mathbf{b}\\,$，以及 $\\,\\mathrm{d}\\|\\mathbf{b}_2\\| = (\\mathbf{b}_2\\cdot \\mathrm{d}\\mathbf{b}_2)/\\|\\mathbf{b}_2\\|\\,$。\n2. 使用你得到的 $\\,\\mathrm{d}\\phi\\,$ 的通用表达式，识别当原子变为共线时，解析导数 $\\,\\partial \\phi/\\partial \\mathbf{r}_a\\,$（对于 $\\,a\\in\\{i,j,k,l\\}$）的奇异条件。描述哪些共线情况会导致奇异行为，以及这在你的公式中是如何体现的。\n3. 将你的通用结果应用于以下具体几何构型（所有坐标单位为埃）：$\\,\\mathbf{r}_i = (0,0,0)\\,$, $\\,\\mathbf{r}_j=(1,0,0)\\,$, $\\,\\mathbf{r}_k=(1,1,0)\\,$, $\\,\\mathbf{r}_l=(1,1,1)\\,$。计算在此几何构型下的单个笛卡尔偏导数 $\\,\\partial \\phi / \\partial z_i\\,$。以弧度/埃为单位表示该导数。提供精确值（不要四舍五入）。", "solution": "该问题提法明确，具有科学依据，并包含了进行完整推导和计算所需的所有信息。这是理论化学中一个关于分子结构优化所需的几何导数的标准问题。我们开始解答。\n\n二面角 $\\,\\phi\\,$ 定义为 $\\,\\phi = \\arctan2(\\beta, \\alpha)\\,$，其中 $\\,\\alpha = \\mathbf{u} \\cdot \\mathbf{v}\\,$ 且 $\\,\\beta = \\|\\mathbf{b}_2\\| (\\mathbf{b}_1 \\cdot \\mathbf{v})\\,$。矢量 $\\,\\mathbf{u} = \\mathbf{b}_1 \\times \\mathbf{b}_2\\,$ 和 $\\,\\mathbf{v} = \\mathbf{b}_2 \\times \\mathbf{b}_3\\,$ 分别是平面 $\\,(i,j,k)\\,$ 和 $\\,(j,k,l)\\,$ 的法向量。键矢量为 $\\,\\mathbf{b}_1 = \\mathbf{r}_j - \\mathbf{r}_i\\,$, $\\,\\mathbf{b}_2 = \\mathbf{r}_k - \\mathbf{r}_j\\,$ 和 $\\,\\mathbf{b}_3 = \\mathbf{r}_l - \\mathbf{r}_k\\,$。\n\n首先，我们建立 $\\,\\alpha, \\beta, \\mathbf{u}, \\mathbf{v}\\,$ 之间的一个关键关系。矢量四重积给出 $\\,\\mathbf{u} \\times \\mathbf{v} = (\\mathbf{b}_1 \\times \\mathbf{b}_2) \\times (\\mathbf{b}_2 \\times \\mathbf{b}_3) = ((\\mathbf{b}_1 \\times \\mathbf{b}_2)\\cdot\\mathbf{b}_3)\\mathbf{b}_2 - ((\\mathbf{b}_1 \\times \\mathbf{b}_2)\\cdot\\mathbf{b}_2)\\mathbf{b}_3\\,$。由于 $(\\mathbf{b}_1 \\times \\mathbf{b}_2)\\cdot\\mathbf{b}_2 = 0$，此恒等式要求叉积所在的平面相交。使用标量三重积恒等式 $\\,[\\mathbf{A},\\mathbf{B},\\mathbf{C}] = \\mathbf{A}\\cdot(\\mathbf{B}\\times\\mathbf{C}) = (\\mathbf{A}\\times\\mathbf{B})\\cdot\\mathbf{C}\\,$，该恒等式简化为 $\\,\\mathbf{u} \\times \\mathbf{v} = [\\mathbf{b}_1, \\mathbf{b}_2, \\mathbf{b}_3] \\mathbf{b}_2 = (\\mathbf{b}_1 \\cdot \\mathbf{v}) \\mathbf{b}_2\\,$。代入 $\\,\\beta\\,$ 的定义，我们发现 $\\,\\mathbf{u} \\times \\mathbf{v} = \\frac{\\beta}{\\|\\mathbf{b}_2\\|} \\mathbf{b}_2\\,$。该矢量的模的平方是 $\\,\\|\\mathbf{u} \\times \\mathbf{v}\\|^2 = \\frac{\\beta^2}{\\|\\mathbf{b}_2\\|^2} \\|\\mathbf{b}_2\\|^2 = \\beta^2\\,$。此外，$\\,\\|\\mathbf{u} \\times \\mathbf{v}\\|^2 = \\|\\mathbf{u}\\|^2 \\|\\mathbf{v}\\|^2 \\sin^2(\\phi) = \\|\\mathbf{u}\\|^2 \\|\\mathbf{v}\\|^2 - (\\mathbf{u} \\cdot \\mathbf{v})^2 = \\|\\mathbf{u}\\|^2 \\|\\mathbf{v}\\|^2 - \\alpha^2\\,$。因此，我们得到重要关系 $\\,\\alpha^2 + \\beta^2 = \\|\\mathbf{u}\\|^2 \\|\\mathbf{v}\\|^2\\,$。\n\n**任务1：微分 $\\,\\mathrm{d}\\phi\\,$ 的推导**\n\n$\\,\\phi = \\arctan2(\\beta, \\alpha)\\,$ 的微分由以下标准公式给出：\n$$\n\\mathrm{d}\\phi = \\frac{\\alpha\\,\\mathrm{d}\\beta - \\beta\\,\\mathrm{d}\\alpha}{\\alpha^2 + \\beta^2} = \\frac{\\alpha\\,\\mathrm{d}\\beta - \\beta\\,\\mathrm{d}\\alpha}{\\|\\mathbf{u}\\|^2 \\|\\mathbf{v}\\|^2}\n$$\n我们现在必须用键矢量 $\\,\\mathrm{d}\\mathbf{b}_1, \\mathrm{d}\\mathbf{b}_2, \\mathrm{d}\\mathbf{b}_3\\,$ 的微分来表示 $\\,\\mathrm{d}\\alpha\\,$ 和 $\\,\\mathrm{d}\\beta\\,$。\n使用给定的乘积法则：\n$$\n\\mathrm{d}\\alpha = \\mathrm{d}(\\mathbf{u}\\cdot\\mathbf{v}) = \\mathrm{d}\\mathbf{u}\\cdot\\mathbf{v} + \\mathbf{u}\\cdot\\mathrm{d}\\mathbf{v}\n$$\n$$\n\\mathrm{d}\\beta = \\mathrm{d}(\\|\\mathbf{b}_2\\|(\\mathbf{b}_1\\cdot\\mathbf{v})) = \\mathrm{d}\\|\\mathbf{b}_2\\|(\\mathbf{b}_1\\cdot\\mathbf{v}) + \\|\\mathbf{b}_2\\|\\mathrm{d}(\\mathbf{b}_1\\cdot\\mathbf{v}) = \\frac{\\mathbf{b}_2\\cdot\\mathrm{d}\\mathbf{b}_2}{\\|\\mathbf{b}_2\\|}(\\mathbf{b}_1\\cdot\\mathbf{v}) + \\|\\mathbf{b}_2\\|(\\mathrm{d}\\mathbf{b}_1\\cdot\\mathbf{v} + \\mathbf{b}_1\\cdot\\mathrm{d}\\mathbf{v})\n$$\n法向量的微分是：\n$$\n\\mathrm{d}\\mathbf{u} = \\mathrm{d}(\\mathbf{b}_1\\times\\mathbf{b}_2) = \\mathrm{d}\\mathbf{b}_1\\times\\mathbf{b}_2 + \\mathbf{b}_1\\times\\mathrm{d}\\mathbf{b}_2\n$$\n$$\n\\mathrm{d}\\mathbf{v} = \\mathrm{d}(\\mathbf{b}_2\\times\\mathbf{b}_3) = \\mathrm{d}\\mathbf{b}_2\\times\\mathbf{b}_3 + \\mathbf{b}_2\\times\\mathrm{d}\\mathbf{b}_3\n$$\n将这些代入 $\\,\\mathrm{d}\\alpha\\,$ 和 $\\,\\mathrm{d}\\beta\\,$，并对每个 $\\,\\mathrm{d}\\mathbf{b}_n\\,$ 合并项：\n$\\mathrm{d}\\alpha = (\\mathrm{d}\\mathbf{b}_1 \\times \\mathbf{b}_2)\\cdot\\mathbf{v} + (\\mathbf{b}_1 \\times \\mathrm{d}\\mathbf{b}_2)\\cdot\\mathbf{v} + \\mathbf{u}\\cdot(\\mathrm{d}\\mathbf{b}_2 \\times \\mathbf{b}_3) + \\mathbf{u}\\cdot(\\mathbf{b}_2 \\times \\mathrm{d}\\mathbf{b}_3) = (\\mathbf{b}_2\\times\\mathbf{v})\\cdot \\mathrm{d}\\mathbf{b}_1 + ((\\mathbf{v}\\times\\mathbf{b}_1)+(\\mathbf{b}_3\\times\\mathbf{u}))\\cdot \\mathrm{d}\\mathbf{b}_2 + (\\mathbf{u}\\times\\mathbf{b}_2)\\cdot \\mathrm{d}\\mathbf{b}_3$。\n\n$\\mathrm{d}\\beta = \\|\\mathbf{b}_2\\|(\\mathbf{v}\\cdot\\mathrm{d}\\mathbf{b}_1) + \\left(\\frac{(\\mathbf{b}_1\\cdot\\mathbf{v})\\mathbf{b}_2}{\\|\\mathbf{b}_2\\|} + \\|\\mathbf{b}_2\\|\\mathbf{b}_1\\cdot(\\mathrm{d}\\mathbf{b}_2\\times\\mathbf{b}_3)\\right)\\cdot \\mathrm{d}\\mathbf{b}_2 [\\text{部分}] + \\|\\mathbf{b}_2\\|\\mathbf{b}_1\\cdot(\\mathbf{b}_2\\times\\mathrm{d}\\mathbf{b}_3)$。\n不，这个展开过于复杂。让我们完整地展开 $\\mathrm{d}\\beta$：\n$\\mathrm{d}\\beta = \\frac{\\beta}{\\|\\mathbf{b}_2\\|^2(\\mathbf{b}_1\\cdot\\mathbf{v})}(\\mathbf{b}_2\\cdot\\mathrm{d}\\mathbf{b}_2)(\\mathbf{b}_1\\cdot\\mathbf{v}) + \\|\\mathbf{b}_2\\|(\\mathrm{d}\\mathbf{b}_1\\cdot\\mathbf{v}) + \\|\\mathbf{b}_2\\|\\mathbf{b}_1\\cdot(\\mathrm{d}\\mathbf{b}_2\\times\\mathbf{b}_3+\\mathbf{b}_2\\times\\mathrm{d}\\mathbf{b}_3)$。\n使用 $\\beta = \\|\\mathbf{b}_2\\|(\\mathbf{b}_1\\cdot\\mathbf{v})$，这可以简化为：\n$\\mathrm{d}\\beta = \\frac{\\beta}{\\|\\mathbf{b}_2\\|^2}(\\mathbf{b}_2\\cdot\\mathrm{d}\\mathbf{b}_2) + \\|\\mathbf{b}_2\\|(\\mathbf{v}\\cdot\\mathrm{d}\\mathbf{b}_1) + \\|\\mathbf{b}_2\\|((\\mathbf{b}_3\\times\\mathbf{b}_1)\\cdot\\mathrm{d}\\mathbf{b}_2) + \\|\\mathbf{b}_2\\|((\\mathbf{b}_1\\times\\mathbf{b}_2)\\cdot\\mathrm{d}\\mathbf{b}_3)$。\n\n全微分为 $\\,\\mathrm{d}\\phi = \\sum_{n=1}^3 \\mathbf{C}_{\\mathbf{b}_n}\\cdot \\mathrm{d}\\mathbf{b}_n\\,$，其中 $\\,\\mathbf{C}_{\\mathbf{b}_n} = \\frac{\\alpha \\mathbf{B}_n - \\beta \\mathbf{A}_n}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2}\\,$。这里 $\\,\\mathbf{A}_n\\,$ 和 $\\,\\mathbf{B}_n\\,$ 是 $\\,\\mathrm{d}\\alpha\\,$ 和 $\\,\\mathrm{d}\\beta\\,$ 展开式中 $\\,\\mathrm{d}\\mathbf{b}_n\\,$ 的矢量系数。\n\n让我们使用矢量恒等式来求解 $\\,\\mathbf{C}_{\\mathbf{b}_1}\\,$ 和 $\\,\\mathbf{C}_{\\mathbf{b}_3}\\,$。\n对于 $\\,\\mathbf{C}_{\\mathbf{b}_1}\\,$：$\\mathbf{A}_1 = \\mathbf{b}_2\\times\\mathbf{v}$ 和 $\\mathbf{B}_1 = \\|\\mathbf{b}_2\\|\\mathbf{v}$。\n$\\mathbf{C}_{\\mathbf{b}_1} = \\frac{\\alpha(\\|\\mathbf{b}_2\\|\\mathbf{v}) - \\beta(\\mathbf{b}_2\\times\\mathbf{v})}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2} = \\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2}(\\alpha\\mathbf{v}-(\\mathbf{b}_1\\cdot\\mathbf{v})(\\mathbf{b}_2\\times\\mathbf{v}))$。\n我们使用恒等式 $\\,\\mathbf{v}\\times(\\mathbf{v}\\times\\mathbf{u}) = (\\mathbf{v}\\cdot\\mathbf{u})\\mathbf{v} - \\|\\mathbf{v}\\|^2\\mathbf{u} = \\alpha\\mathbf{v}-\\|\\mathbf{v}\\|^2\\mathbf{u}\\,$。\n另外，$\\,\\mathbf{v}\\times(\\mathbf{v}\\times\\mathbf{u}) = \\mathbf{v}\\times(-\\mathbf{u}\\times\\mathbf{v}) = \\mathbf{v}\\times(-\\frac{\\beta}{\\|\\mathbf{b}_2\\|}\\mathbf{b}_2) = \\frac{\\beta}{\\|\\mathbf{b}_2\\|}(\\mathbf{b}_2\\times\\mathbf{v}) = (\\mathbf{b}_1\\cdot\\mathbf{v})(\\mathbf{b}_2\\times\\mathbf{v})\\,$。\n令两个表达式相等得到 $\\,\\alpha\\mathbf{v}-(\\mathbf{b}_1\\cdot\\mathbf{v})(\\mathbf{b}_2\\times\\mathbf{v}) = \\|\\mathbf{v}\\|^2\\mathbf{u}\\,$。\n将此代入 $\\,\\mathbf{C}_{\\mathbf{b}_1}\\,$ 得到：\n$$\n\\mathbf{C}_{\\mathbf{b}_1} = \\frac{\\|\\mathbf{b}_2\\|(\\|\\mathbf{v}\\|^2\\mathbf{u})}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2} = \\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{u}\\|^2}\\mathbf{u}\n$$\n对于 $\\,\\mathbf{C}_{\\mathbf{b}_3}\\,$：$\\mathbf{A}_3 = \\mathbf{u}\\times\\mathbf{b}_2$ 和 $\\mathbf{B}_3 = \\|\\mathbf{b}_2\\|\\mathbf{u}$。\n$\\mathbf{C}_{\\mathbf{b}_3} = \\frac{\\alpha(\\|\\mathbf{b}_2\\|\\mathbf{u}) - \\beta(\\mathbf{u}\\times\\mathbf{b}_2)}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2} = \\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2}(\\alpha\\mathbf{u}-(\\mathbf{b}_1\\cdot\\mathbf{v})(\\mathbf{u}\\times\\mathbf{b}_2))\\,$.\n使用一个类似的恒等式 $\\,\\mathbf{u}\\times(\\mathbf{u}\\times\\mathbf{v}) = (\\mathbf{u}\\cdot\\mathbf{v})\\mathbf{u}-\\|\\mathbf{u}\\|^2\\mathbf{v} = \\alpha\\mathbf{u}-\\|\\mathbf{u}\\|^2\\mathbf{v}\\,$。\n并且 $\\,\\mathbf{u}\\times(\\mathbf{u}\\times\\mathbf{v}) = \\mathbf{u}\\times(\\frac{\\beta}{\\|\\mathbf{b}_2\\|}\\mathbf{b}_2) = \\frac{\\beta}{\\|\\mathbf{b}_2\\|}(\\mathbf{u}\\times\\mathbf{b}_2) = (\\mathbf{b}_1\\cdot\\mathbf{v})(\\mathbf{u}\\times\\mathbf{b}_2)\\,$。\n这得到 $\\,\\alpha\\mathbf{u}-(\\mathbf{b}_1\\cdot\\mathbf{v})(\\mathbf{u}\\times\\mathbf{b}_2) = \\|\\mathbf{u}\\|^2\\mathbf{v}\\,$。\n将此代入 $\\,\\mathbf{C}_{\\mathbf{b}_3}\\,$ 得到：\n$$\n\\mathbf{C}_{\\mathbf{b}_3} = \\frac{\\|\\mathbf{b}_2\\|(\\|\\mathbf{u}\\|^2\\mathbf{v})}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2} = \\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{v}\\|^2}\\mathbf{v}\n$$\n系数 $\\,\\mathbf{C}_{\\mathbf{b}_2}\\,$ 更为复杂，但根据平移不变性，我们有力 $\\,\\nabla_i + \\nabla_j + \\nabla_k + \\nabla_l = \\mathbf{0}\\,$。\n全微分为：\n$$\n\\mathrm{d}\\phi = \\left(\\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{u}\\|^2}\\mathbf{u}\\right)\\cdot \\mathrm{d}\\mathbf{b}_1 + \\mathbf{C}_{\\mathbf{b}_2}\\cdot \\mathrm{d}\\mathbf{b}_2 + \\left(\\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{v}\\|^2}\\mathbf{v}\\right)\\cdot \\mathrm{d}\\mathbf{b}_3\n$$\n代入 $\\,\\mathrm{d}\\mathbf{b}_1 = \\mathrm{d}\\mathbf{r}_j - \\mathrm{d}\\mathbf{r}_i\\,$, $\\,\\mathrm{d}\\mathbf{b}_2=\\mathrm{d}\\mathbf{r}_k - \\mathrm{d}\\mathbf{r}_j\\,$, $\\,\\mathrm{d}\\mathbf{b}_3=\\mathrm{d}\\mathbf{r}_l - \\mathrm{d}\\mathbf{r}_k\\,$ 得到 $\\,\\mathrm{d}\\phi = \\sum_{a=i,j,k,l} \\frac{\\partial\\phi}{\\partial\\mathbf{r}_a}\\cdot\\mathrm{d}\\mathbf{r}_a\\,$。梯度为：\n$$\n\\frac{\\partial\\phi}{\\partial\\mathbf{r}_i} = -\\mathbf{C}_{\\mathbf{b}_1} = -\\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{u}\\|^2}\\mathbf{u}\n$$\n$$\n\\frac{\\partial\\phi}{\\partial\\mathbf{r}_l} = \\mathbf{C}_{\\mathbf{b}_3} = \\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{v}\\|^2}\\mathbf{v}\n$$\n$$\n\\frac{\\partial\\phi}{\\partial\\mathbf{r}_j} = \\mathbf{C}_{\\mathbf{b}_1} - \\mathbf{C}_{\\mathbf{b}_2} \\quad , \\quad \\frac{\\partial\\phi}{\\partial\\mathbf{r}_k} = \\mathbf{C}_{\\mathbf{b}_2} - \\mathbf{C}_{\\mathbf{b}_3}\n$$\n\n**任务2：奇异条件**\n\n解析导数 $\\,\\frac{\\partial\\phi}{\\partial\\mathbf{r}_a}\\,$ 包含分母 $\\,\\|\\mathbf{u}\\|^2\\,$ 和 $\\,\\|\\mathbf{v}\\|^2\\,$。如果其中任何一个为零，就会出现奇异点。\n$\\,\\|\\mathbf{u}\\| = \\|\\mathbf{b}_1 \\times \\mathbf{b}_2\\| = 0\\,$ 当且仅当矢量 $\\,\\mathbf{b}_1 = \\mathbf{r}_j - \\mathbf{r}_i\\,$ 和 $\\,\\mathbf{b}_2 = \\mathbf{r}_k - \\mathbf{r}_j\\,$ 共线。这对应于原子 $\\,i, j, k\\,$ 位于同一直线上。\n类似地，$\\,\\|\\mathbf{v}\\| = \\|\\mathbf{b}_2 \\times \\mathbf{b}_3\\| = 0\\,$ 当且仅当矢量 $\\,\\mathbf{b}_2 = \\mathbf{r}_k - \\mathbf{r}_j\\,$ 和 $\\,\\mathbf{b}_3 = \\mathbf{r}_l - \\mathbf{r}_k\\,$ 共线。这对应于原子 $\\,j, k, l\\,$ 位于同一直线上。\n\n当原子 $\\,i,j,k\\,$ 共线时，$\\,\\mathbf{u} = \\mathbf{0}\\,$。这导致 $\\,\\alpha = \\mathbf{u}\\cdot\\mathbf{v} = 0\\,$。此外，$\\,\\beta = \\|\\mathbf{b}_2\\|(\\mathbf{b}_1\\cdot\\mathbf{v}) = \\|\\mathbf{b}_2\\|(\\mathbf{b}_1\\cdot(\\mathbf{b}_2\\times\\mathbf{b}_3)) = \\|\\mathbf{b}_2\\|((\\mathbf{b}_1\\times\\mathbf{b}_2)\\cdot\\mathbf{b}_3) = \\|\\mathbf{b}_2\\|(\\mathbf{u}\\cdot\\mathbf{b}_3)=0\\,$。\n在这种情况下，原始微分表达式的分母 $\\,\\alpha^2+\\beta^2\\,$ 变为 $\\,0\\,$。这表明存在一个奇异点，在此处二面角本身没有明确定义，因此其导数也未定义。\n同样的逻辑适用于当原子 $\\,j,k,l\\,$ 共线时，这将导致 $\\,\\mathbf{v}=\\mathbf{0}\\,$，并因此导致 $\\,\\alpha=0\\,$ 和 $\\,\\beta=0\\,$。\n因此，只要序列 $\\,(i,j,k,l)\\,$ 中的任意三个连续原子变为共线，二面角的解析导数就是奇异的。\n\n**任务3：特定几何构型的计算**\n\n给定笛卡尔坐标：$\\,\\mathbf{r}_i = (0,0,0)\\,$, $\\,\\mathbf{r}_j=(1,0,0)\\,$, $\\,\\mathbf{r}_k=(1,1,0)\\,$ 和 $\\,\\mathbf{r}_l=(1,1,1)\\,$。我们需要计算偏导数 $\\,\\partial \\phi / \\partial z_i\\,$。这是梯度矢量 $\\,\\frac{\\partial \\phi}{\\partial \\mathbf{r}_i}\\,$ 的 $\\,z\\,$ 分量。\n\n首先，我们计算此几何构型所需的矢量：\n1. 键矢量：\n$$\n\\mathbf{b}_1 = \\mathbf{r}_j - \\mathbf{r}_i = (1,0,0) - (0,0,0) = (1,0,0)\n$$\n$$\n\\mathbf{b}_2 = \\mathbf{r}_k - \\mathbf{r}_j = (1,1,0) - (1,0,0) = (0,1,0)\n$$\n2. $\\,\\mathbf{b}_2\\,$ 的模：\n$$\n\\|\\mathbf{b}_2\\| = \\sqrt{0^2 + 1^2 + 0^2} = 1\n$$\n3. 法向量 $\\,\\mathbf{u}\\,$：\n$$\n\\mathbf{u} = \\mathbf{b}_1 \\times \\mathbf{b}_2 = (1,0,0) \\times (0,1,0) = \\begin{vmatrix} \\mathbf{i} & \\mathbf{j} & \\mathbf{k} \\\\ 1 & 0 & 0 \\\\ 0 & 1 & 0 \\end{vmatrix} = (0,0,1)\n$$\n4. $\\,\\mathbf{u}\\,$ 的模的平方：\n$$\n\\|\\mathbf{u}\\|^2 = 0^2 + 0^2 + 1^2 = 1\n$$\n相对于原子 $\\,i\\,$ 坐标的梯度由任务1中推导的公式给出：\n$$\n\\frac{\\partial \\phi}{\\partial \\mathbf{r}_i} = -\\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{u}\\|^2}\\mathbf{u}\n$$\n代入计算出的值：\n$$\n\\frac{\\partial \\phi}{\\partial \\mathbf{r}_i} = -\\frac{1}{1}(0,0,1) = (0,0,-1)\n$$\n该梯度矢量的分量是关于原子 $\\,i\\,$ 的笛卡尔坐标的偏导数：\n$$\n\\frac{\\partial \\phi}{\\partial \\mathbf{r}_i} = \\left(\\frac{\\partial \\phi}{\\partial x_i}, \\frac{\\partial \\phi}{\\partial y_i}, \\frac{\\partial \\phi}{\\partial z_i}\\right)\n$$\n因此，所需的特定偏导数是该矢量的 $\\,z\\,$ 分量：\n$$\n\\frac{\\partial \\phi}{\\partial z_i} = -1\n$$\n坐标单位是埃，因此导数的单位是弧度/埃。", "answer": "$$\\boxed{-1}$$", "id": "2874054"}, {"introduction": "任何*从头算*计算的核心都是电子排斥积分（ERI）。因此，能量的解析梯度最终依赖于这些基本构件的解析导数。最后的实践将深入到这一最基础的层面，展示 ERI 导数如何与 Boys 函数 $F_n(T)$ 的导数相关联。您不仅会推导出一个关键的解析关系，还将直面数值稳定性这一关键问题，从而设计一个能够避免常见陷阱并确保结果准确的稳健计算方案 [@problem_id:2874088]。", "problem": "考虑分别以原子核 $\\mathbf{A}$ 和 $\\mathbf{B}$ 为中心、指数为 $\\alpha$ 和 $\\beta$ 的原始高斯型轨道。根据高斯乘积定理，两个分别以 $\\mathbf{A}$ 和 $\\mathbf{B}$ 为中心的高斯函数的乘积，可以写成一个以复合中心 $\\mathbf{P}$ 为中心、指数为 $\\zeta = \\alpha + \\beta$ 的高斯函数，再乘以一个与 $\\mathbf{A}$ 和 $\\mathbf{B}$ 有关的高斯前因子。在推导高斯函数上的电子排斥积分（electron repulsion integral, ERI）的解析表达式的标准过程中，会遇到定义Boys函数的一维径向积分，其形式如下：\n$$\nF_{n}(T) \\equiv \\int_{0}^{1} t^{2n} \\exp\\!\\big(-T t^{2}\\big)\\,\\mathrm{d}t,\n$$\n其中 $n \\in \\mathbb{N}_{0}$ 且 $T \\ge 0$ 是一个标量，它依赖于高斯指数和核间距，例如，$T = \\rho\\,|\\mathbf{P}-\\mathbf{Q}|^{2}$，其中 $\\rho = \\frac{\\alpha \\beta}{\\alpha + \\beta}$，而 $\\mathbf{P}, \\mathbf{Q}$ 分别是通过对电子1和电子2的坐标使用高斯乘积定理得到的复合中心。\n\n在解析能量梯度和Hessian矩阵中，会出现ERI对核笛卡尔坐标的导数。通过链式法则，对ERI求导会引入 $F_{n}(T)$ 对 $T$ 的导数，并乘以 $T$ 对核坐标的导数。从上述 $F_{n}(T)$ 的基本定义和高斯积分的标准性质出发，完成以下任务：\n\n- 解释为什么ERI对核坐标的导数必然包含因子 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 乘以 $T$ 的导数。\n- 严格从 $F_{n}(T)$ 的定义积分出发，推导一个用Boys函数表示的 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 的闭合形式表达式。\n- 分析 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 的直接微分恒等式在小 $T$（即 $T \\to 0$）和大 $T$（即 $T \\to \\infty$）区域的数值稳定性，并指出任何潜在的有效数字损失。\n- 构建一个稳定的 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 计算方案，该方案在小 $T$ 时能避免灾难性抵消，在大 $T$ 时能保持精度。你的方案应仅依赖于可从积分定义推导出的、经过充分检验的展开式和递推关系，即：\n  - 用于小 $T$ 的 $F_{n}(T)$ 的麦克劳林级数，\n  - $F_{n}(T)$ 的大 $T$ 渐近形式，\n  - 以及一个连接 $F_{n+1}(T)$ 和 $F_{n}(T)$ 的方向稳定的三项递推关系。\n解释递推的哪个方向是稳定的及其原因，以及如何结合初始化和递推来覆盖所有 $T$ 的取值范围。\n\n作为最终答案，提供你推导出的用Boys函数表示的 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 的单一闭合形式解析表达式。不需要进行数值计算，也不需要单位，因为 $F_{n}(T)$ 是无量纲的。请将你的最终答案表示为单个解析表达式。", "solution": "所提出的问题是量子化学中分子积分解析理论的一个标准的、明确定义的练习。它具有科学依据，是客观的，并包含了进行严格分析所需的充分信息。我们将按要求进行推导和讨论。\n\n首先，我们阐述为什么电子排斥积分（ERI）对核坐标的导数必须涉及Boys函数 $F_n(T)$ 的导数。一个涉及四个高斯基函数的ERI写作 $(\\mu\\nu|\\lambda\\sigma)$。根据高斯乘积定理，两个高斯函数（例如 $\\phi_{\\mu}$ 和 $\\phi_{\\nu}$）的乘积可以表示为一个以新点 $\\mathbf{P}$ 为中心的单个高斯函数。ERI随后简化为对两个以 $\\mathbf{P}$ 和 $\\mathbf{Q}$ 为中心的新电荷分布的双电子积分。该积分最终表示为有限项之和，其中每一项都是某个常数与一个Boys函数 $F_n(T)$ 的乘积。自变量 $T$ 由 $T = \\rho |\\mathbf{P}-\\mathbf{Q}|^2$ 给出，其中 $\\rho$ 是高斯指数的函数，而中心 $\\mathbf{P}$ 和 $\\mathbf{Q}$ 是原始核坐标 $\\{\\mathbf{R}_A\\}$ 的函数。\n因此，任何ERI都可以通过其对自变量 $T_k$ 的依赖性，示意性地写成核坐标 $\\mathbf{R}_A$ 的函数：\n$$\n\\text{ERI}(\\{\\mathbf{R}_A\\}) = \\sum_k C_k F_{n_k}(T_k(\\{\\mathbf{R}_A\\}))\n$$\n其中 $C_k$ 是同样依赖于核坐标的系数。当对核位置的某个笛卡尔分量（例如 $R_{A,x}$）求导时，必须应用链式法则：\n$$\n\\frac{\\partial (\\text{ERI})}{\\partial R_{A,x}} = \\sum_k \\left( \\frac{\\partial C_k}{\\partial R_{A,x}} F_{n_k}(T_k) + C_k \\frac{\\mathrm{d}F_{n_k}}{\\mathrm{d}T_k} \\frac{\\partial T_k}{\\partial R_{A,x}} \\right)\n$$\n中心 $\\mathbf{P}$ 和 $\\mathbf{Q}$ 是核坐标的加权平均，因此它们的位置，以及它们之间的距离 $|\\mathbf{P}-\\mathbf{Q}|$，都依赖于 $\\{\\mathbf{R}_A\\}$。因此，项 $\\frac{\\partial T_k}{\\partial R_{A,x}}$ 通常不为零。这使得导数 $\\frac{\\mathrm{d}F_{n_k}}{\\mathrm{d}T_k}$ 的出现成为解析梯度理论的必然结果。\n\n接下来，我们推导 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 的闭合形式表达式。我们从Boys函数的积分定义开始：\n$$\nF_{n}(T) = \\int_{0}^{1} t^{2n} \\exp(-T t^{2})\\,\\mathrm{d}t\n$$\n在积分域内且对于 $T \\ge 0$，被积函数及其对 $T$ 的偏导数都是 $t$ 和 $T$ 的连续函数。因此，我们可以在积分号下求导（莱布尼茨积分法则）：\n$$\n\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T} = \\frac{\\mathrm{d}}{\\mathrm{d}T} \\int_{0}^{1} t^{2n} \\exp(-T t^{2})\\,\\mathrm{d}t = \\int_{0}^{1} \\frac{\\partial}{\\partial T} \\left( t^{2n} \\exp(-T t^{2}) \\right) \\,\\mathrm{d}t\n$$\n被积函数的偏导数为：\n$$\n\\frac{\\partial}{\\partial T} \\left( t^{2n} \\exp(-T t^{2}) \\right) = t^{2n} \\left( -t^2 \\exp(-T t^{2}) \\right) = -t^{2n+2} \\exp(-T t^{2})\n$$\n将其代回积分中，得到：\n$$\n\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T} = \\int_{0}^{1} (-1) t^{2(n+1)} \\exp(-T t^{2}) \\,\\mathrm{d}t = - \\int_{0}^{1} t^{2(n+1)} \\exp(-T t^{2}) \\,\\mathrm{d}t\n$$\n通过观察可知，所得积分即为 $F_{n+1}(T)$ 的定义。因此，我们得到了这个简洁而基本的关系式：\n$$\n\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T} = -F_{n+1}(T)\n$$\n\n我们现在来分析使用此恒等式的数值稳定性。该恒等式本身是精确的。任何数值不稳定性都源于计算 $F_{n+1}(T)$ 所使用的方法。一个常见但有缺陷的方法是使用Boys函数的向上递推关系，该关系可通过分部积分法推导得出：\n$$\nF_{n+1}(T) = \\frac{(2n+1)F_n(T) - \\exp(-T)}{2T}\n$$\n如果已知一个精确的 $F_n(T)$ 值，并使用此公式计算 $F_{n+1}(T)$，可能会发生严重的有效数字损失，尤其是在 $T$ 值较大时。在该区域，$\\exp(-T)$ 极小，$F_n(T)$ 也变得很小。分子涉及两个数字 $(2n+1)F_n(T)$ 和 $\\exp(-T)$ 的相减，它们的大小可能相近，从而导致灾难性抵消。随后的除以 $2T$ 会进一步传播任何误差。因此，向上递推在数值上是不稳定的，在计算Boys函数序列时必须避免使用。“直接微分恒等式”本身只有在与不稳定的 $F_{n+1}(T)$ 计算方法相结合时才是不稳定的。\n\n最后，我们构建一个稳定的 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 计算方案，这等同于构建一个稳定的 $F_{n+1}(T)$ 计算方案。该策略根据 $T$ 的值进行划分。\n\n对于小 $T$：\n$F_n(T)$ 的麦克劳林级数展开式是通过展开其定义积分中的指数项得到的：\n$$\nF_n(T) = \\int_{0}^{1} t^{2n} \\sum_{k=0}^{\\infty} \\frac{(-Tt^2)^k}{k!} \\,\\mathrm{d}t = \\sum_{k=0}^{\\infty} \\frac{(-T)^k}{k!} \\int_{0}^{1} t^{2n+2k} \\,\\mathrm{d}t = \\sum_{k=0}^{\\infty} \\frac{(-T)^k}{k! (2n+2k+1)}\n$$\n对于小 $T$，这是一个各项迅速递减的交错级数，它在数值上是稳定的且收敛迅速。要计算 $\\frac{\\mathrm{d}F_n}{\\mathrm{d}T} = -F_{n+1}(T)$，只需使用 $F_{n+1}(T)$ 自身的麦克劳林级数来计算它：\n$$\nF_{n+1}(T) = \\sum_{k=0}^{\\infty} \\frac{(-T)^k}{k! (2n+2k+3)}\n$$\n对于低于某个阈值（例如 $T < 10$）的 $T$，此方法是稳健的。\n\n对于大 $T$：\n级数展开变得不适用。取而代之，我们使用向下递推关系，这是稳定的方向。通过重新整理先前展示的递推关系，我们得到：\n$$\nF_{n}(T) = \\frac{2T F_{n+1}(T) + \\exp(-T)}{2n+1}\n$$\n该关系式对于递减的 $n$ 是稳定的，因为除以因子 $2n+1$ 会抑制任何误差的传播。要计算一组Boys函数 $\\{ F_k(T) \\}_{k=0}^{N_{max}}$，需要从一个足够大的索引 $M > N_{max}$ 开始，使得 $F_M(T)$ 可以被精确近似。对于大 $T$ 的渐近形式是 $F_M(T) \\sim \\frac{(2M-1)!!\\sqrt{\\pi}}{2^{M+1}} T^{-M-1/2}$。对于足够大的 $M$，可以简单地将 $F_M(T) = 0$ 作为初始猜测值。\n稳定的计算流程如下：\n1. 选择一个远高于所需最高索引 $n+1$ 的起始索引 $M$。一个典型的选择是 $M \\approx n_{max} + T$。\n2. 用 $F_M(T) = 0$ 进行初始化。\n3. 使用关系式 $F_{k-1}(T) = \\frac{2TF_k(T) + \\exp(-T)}{2k-1}$ 从 $k=M$ 向下递推到 $k=1$，生成一个未归一化的序列 $\\{F'_{k}(T)\\}$。\n4. 精确计算 $F_0(T)$ 的值。对于非零的 $T$，其值由 $F_0(T) = \\frac{\\sqrt{\\pi}}{2\\sqrt{T}}\\text{erf}(\\sqrt{T})$ 给出，该值本身可以通过诸如大 $T$ 的连分式展开等稳定方法计算。\n5. 从向下递推得到的未归一化值 $F'_0(T)$ 与真实值 $F_0(T)$ 成正比。归一化常数为 $C = F'_0(T) / F_0(T)$。\n6. 对整个序列重新定标：$F_k(T) = F'_k(T) / C$，适用于所有需要的 $k$，包括 $k=n+1$。\n7. 所需的导数则由 $-F_{n+1}(T)$ 给出，该值通过此稳定流程计算得到。\n\n这种混合方案，结合了用于小 $T$ 的麦克劳林级数和用于大 $T$ 的归一化向下递推，为在整个定义域 $T \\ge 0$ 上评估Boys函数及其对 $T$ 的导数提供了一种数值稳健的方法。", "answer": "$$\n\\boxed{-F_{n+1}(T)}\n$$", "id": "2874088"}]}