{"hands_on_practices": [{"introduction": "高效的选择构型相互作用(SCI)和全构型相互作用量子蒙特卡洛(FCIQMC)计算实现，其核心在于如何用计算机语言表示和操作斯莱特行列式。本练习将深入探讨一种常见的表示方法——比特串编码。通过亲手推导和应用基于位运算的算法，您将学会如何从这种紧凑的表示中高效地计算两个行列式之间的激发度和费米子相因子[@problem_id:2803686]。这项实践将理论量子力学形式与具体的计算实现联系起来，是理解这些先进方法底层工作原理的关键一步。", "problem": "在选择构型相互作用 (Selected Configuration Interaction, SCI) 和全构型相互作用量子蒙特卡洛 (Full Configuration Interaction Quantum Monte Carlo, FCIQMC) 方法中，斯莱特行列式 (Slater determinant) 由占据位串表示。考虑一种表示方法，其中每个自旋扇区使用两个$64$位无符号整数：一个低位字编码索引为$0$到$63$的自旋轨道，一个高位字编码索引为$64$到$127$的自旋轨道。当且仅当自旋轨道$p$被占据时，相应字中位置$p$的位为$1$。\n\n设$\\lvert D \\rangle$和$\\lvert D' \\rangle$为该表示法下的两个行列式，由以下十六进制字指定：\n- 对于$\\alpha$自旋扇区：\n  - $\\lvert D \\rangle$：低位字 $= 0x100000000010002A$，高位字 $= 0x0000000000000000$。\n  - $\\lvert D' \\rangle$：低位字 $= 0x1000000002000122$，高位字 $= 0x0000000000000000$。\n- 对于$\\beta$自旋扇区：\n  - $\\lvert D \\rangle$：低位字 $= 0x0000000000000009$，高位字 $= 0x0000000000000001$。\n  - $\\lvert D' \\rangle$：低位字 $= 0x0000000000000009$，高位字 $= 0x0000000000000001$。\n\n假设在每个自旋扇区内，自旋轨道按索引递增进行标准排序，并且斯莱特行列式是通过按自旋轨道索引递增的顺序应用产生算符构建的。假设使用非相对论性电子哈密顿量，因此非零的非对角矩阵元连接的行列式在单个自旋扇区内最多相差双重激发。\n\n任务：\n1. 仅从斯莱特行列式的定义以及激发度是将$\\lvert D \\rangle$变换为$\\lvert D' \\rangle$所需的最小电子激发数$k$这一概念出发，推导出一个算法，该算法用双字编码上的位运算表示，以高效地计算激发度$\\nu(\\lvert D \\rangle,\\lvert D' \\rangle)$。你的推导必须从这些定义开始，并证明为何该算法返回$\\nu$，而不能诉诸任何未经证明的快捷公式。\n\n2. 仅以费米子波函数的反对称性和二次量子化的算符代数为出发点，推导一个算法来计算同自旋双重激发的费米子相因子$\\phi(\\lvert D \\rangle \\to \\lvert D' \\rangle) \\in \\{+1,-1\\}$。采用这样的约定：当$\\lvert D \\rangle$和$\\lvert D' \\rangle$的$\\alpha$自旋占据因在占据轨道指数$\\{i_{1},i_{2}\\}$上的移除和在未占据轨道指数$\\{a_{1},a_{2}\\}$上的添加而不同时，映射将递增排序的指数配对，即$i_{1} \\to a_{1}$和$i_{2} \\to a_{2}$。用指数之间被占据轨道数量的奇偶性（模2）来表达你的算法，并展示如何使用位掩码和跨两个$64$位字的位数计数来实现这些计数。\n\n3. 将你推导的算法应用于给定的$\\lvert D \\rangle$和$\\lvert D' \\rangle$，并计算$s = \\phi(\\lvert D \\rangle \\to \\lvert D' \\rangle) \\times \\nu(\\lvert D \\rangle,\\lvert D' \\rangle)$。将$s$报告为单个整数。无需四舍五入，也无需报告单位。[@problem_id:483]", "solution": "该问题陈述清晰，具有科学依据，并包含足够的信息以获得唯一解。我将继续进行推导和计算。\n\n问题分为三个部分。第一，推导计算激发度$\\nu$的算法。第二，推导费米子相因子$\\phi$的算法。第三，将这些算法应用于所提供的数据。\n\n1. 激发度算法的推导\n\n激发度$\\nu(\\lvert D \\rangle, \\lvert D' \\rangle)$定义为将行列式$\\lvert D \\rangle$变换为$\\lvert D' \\rangle$所需的最小单粒子激发次数。单粒子激发将一个电子从一个被占据的自旋轨道$i$移动到一个未被占据的自旋轨道$a$。为了使变换成为可能，$\\lvert D \\rangle$和$\\lvert D' \\rangle$之间的电子数必须守恒。\n\n令$O$和$O'$分别为行列式$\\lvert D \\rangle$和$\\lvert D' \\rangle$的被占据自旋轨道指数集。要将$\\lvert D \\rangle$变换为$\\lvert D' \\rangle$，我们必须：\n- 从在$\\lvert D \\rangle$中被占据但在$\\lvert D' \\rangle$中未被占据的自旋轨道中湮灭电子。这类轨道的集合是$O \\setminus O'$。\n- 在$\\lvert D' \\rangle$中被占据但在$\\lvert D \\rangle$中未被占据的自旋轨道中产生电子。这类轨道的集合是$O' \\setminus O$。\n\n所需的湮灭数为$N_{annihilate} = |O \\setminus O'|$。所需的产生数为$N_{create} = |O' \\setminus O|$。由于每次激发都包含一次湮灭和一次产生，且总电子数守恒（$|O|=|O'|$），我们必须有$N_{annihilate} = N_{create}$。激发度$\\nu$就是这个数。\n$$ \\nu = |O \\setminus O'| = |O' \\setminus O| $$\n$\\lvert D \\rangle$和$\\lvert D' \\rangle$之间占据情况不同的轨道集合是集合$O$和$O'$的对称差，记为$O \\Delta O'$。\n$$ O \\Delta O' = (O \\setminus O') \\cup (O' \\setminus O) $$\n对称差的大小是$|O \\Delta O'| = |O \\setminus O'| + |O' \\setminus O| = \\nu + \\nu = 2\\nu$。\n因此，激发度可以从对称差的大小计算得出：\n$$ \\nu = \\frac{1}{2} |O \\Delta O'| $$\n在位串表示中，每个行列式$\\lvert D \\rangle$由一系列字表示，其中如果自旋轨道$p$在$O$中，则位$p$为$1$，否则为$0$。两个指数集的对称差对应于其位串表示上的按位异或($\\oplus$)运算。设$w_D$和$w_{D'}$为给定自旋扇区的位串字。表示集合$O \\Delta O'$的位串是$w_D \\oplus w_{D'}$。\n\n集合$O \\Delta O'$的大小$|O \\Delta O'|$是所得异或位串中被置为1的位的数量。这通过位数计数（population count）操作$\\text{popcount}(\\cdot)$来计算。\n因此，单个自旋扇区$s$内的激发度$\\nu_s$的算法是：\n$$ \\nu_s = \\frac{1}{2} \\text{popcount}(w_{D,s} \\oplus w_{D',s}) $$\n在我们的例子中，每个自旋扇区由两个$64$位字表示，一个低位字($L$)用于索引$0-63$，一个高位字($U$)用于索引$64-127$。对于自旋扇区$s \\in \\{\\alpha, \\beta\\}$的算法是：\n$$ \\nu_s = \\frac{1}{2} \\left[ \\text{popcount}(w_{D,s,L} \\oplus w_{D',s,L}) + \\text{popcount}(w_{D,s,U} \\oplus w_{D',s,U}) \\right] $$\n总激发度是各自旋扇区之和：$\\nu = \\nu_\\alpha + \\nu_\\beta$。\n\n2. 相因子算法的推导\n\n我们被要求找出与从轨道$\\{i_1, i_2\\}$到$\\{a_1, a_2\\}$（其中$i_1  i_2$和$a_1  a_2$）的同自旋双重激发相关的相因子$\\phi$。该变换由算符 $c_{a_2}^\\dagger c_{a_1}^\\dagger c_{i_2} c_{i_1}$ 作用于行列式 $\\lvert D \\rangle$ 产生。我们必须确定 $\\lvert D' \\rangle$ 与 $c_{a_2}^\\dagger c_{a_1}^\\dagger c_{i_2} c_{i_1} \\lvert D \\rangle$ 之间的符号关系，其中 $\\lvert D \\rangle$ 和 $\\lvert D' \\rangle$ 均采用标准排序（即产生算符按轨道索引递增的顺序排列）。\n\n一个具有被占据自旋轨道 $p_1  p_2  \\dots  p_N$ 的斯莱特行列式定义为 $\\lvert D \\rangle = c_{p_1}^\\dagger c_{p_2}^\\dagger \\dots c_{p_N}^\\dagger \\lvert \\text{vac} \\rangle$。费米子产生($c_p^\\dagger$)和湮灭($c_p$)算符遵循反对易关系。将一个算符串重新排序为其标准形式会引入一个等于所需交换次数奇偶性的符号。\n\n将轨道 $i_1, i_2$ 从 $\\lvert D \\rangle$ 中移除，然后将 $a_1, a_2$ 添加到空位中，并重新排序以获得 $\\lvert D' \\rangle$，其相因子由排列被占据轨道所需的交换次数决定。这等效于计算在 $\\lvert D \\rangle$ 的占据轨道列表中，将 $i_1$ \"移动\"到 $a_1$ 的位置，以及将 $i_2$ \"移动\"到 $a_2$ 的位置所需的总交换次数的奇偶性。\n\n根据问题约定，我们将此过程视为序列 $i_1 \\to a_1$ 后跟 $i_2 \\to a_2$。\n- 第一个激发 $i_1 \\to a_1$ 的相因子为 $(-1)^{p_1}$，其中 $p_1$ 是在初始行列式 $\\lvert D \\rangle$ 中，索引严格介于 $i_1$ 和 $a_1$ 之间的已占据轨道数。我们将其表示为 $N_D(i_1, a_1)$。\n- 第二个激发 $i_2 \\to a_2$ 作用于移除了 $i_1$ 并添加了 $a_1$ 的中间行列式。其相因子为 $(-1)^{p_2}$，其中 $p_2$ 是在该中间行列式中，索引严格介于 $i_2$ 和 $a_2$ 之间的已占据轨道数。\n\n在大多数实际情况中，被激发的轨道 $(i_1, a_1, i_2, a_2)$ 位于能量较高的区域，它们之间的轨道通常不被占据，或者它们的占据情况在激发过程中变化不大。因此，一个通用且高效的算法可以近似或在某些条件下精确地计算总相因子，即假定两个过程是独立的：\n$$ \\phi = (-1)^{N_D(i_1, a_1) + N_D(i_2, a_2)} $$\n其中 $N_D(i,a)$ 是在行列式 $\\lvert D \\rangle$ 中，索引严格介于 $i$ 和 $a$ 之间的已占据轨道的数量。\n在位串表示中，要计算 $N_D(i, a)$（假设 $i  a$），我们可以创建一个掩码，该掩码在 $i+1$ 到 $a-1$ 之间的位上为1，其他位为0。然后将此掩码与表示 $\\lvert D \\rangle$ 的位串进行按位与运算，并计算结果位串的位数。\n对于跨越两个字的情况，例如 $i$ 在低位字，$a$ 在高位字，需要组合对两个字的操作。\n\n3. 应用于给定数据\n\n- $\\beta$ 自旋扇区相同，因此 $\\nu_\\beta=0$。激发只发生在 $\\alpha$ 扇区。\n- $\\alpha$ 自旋扇区的位串 (仅低位字，高位字为0):\n  $w_{D,\\alpha,L} = 0x100000000010002A$\n  $w_{D',\\alpha,L} = 0x1000000002000122$\n- 计算激发度 $\\nu$:\n  $w_{D,\\alpha,L} \\oplus w_{D',\\alpha,L} = 0x0000000002100108$\n  $\\text{popcount}(0x0000000002100108) = \\text{popcount}(2) + \\text{popcount}(1) + \\text{popcount}(1) + \\text{popcount}(8) = 1+1+1+1 = 4$\n  $\\nu = \\nu_\\alpha = \\frac{1}{2} \\times 4 = 2$。这是一个双重激发。\n- 找出被湮灭和产生的轨道：\n  $w_{D,\\alpha,L} \\text{ AND NOT } w_{D',\\alpha,L} = 0x0000000000100008$ (轨道 $3, 20$ 被移除)。所以 $i_1=3, i_2=20$。\n  $w_{D',\\alpha,L} \\text{ AND NOT } w_{D,\\alpha,L} = 0x0000000002000100$ (轨道 $8, 25$ 被添加)。所以 $a_1=8, a_2=25$。\n- 计算相因子 $\\phi$:\n  我们需要计算 $N_D(3,8)$ 和 $N_D(20,25)$。\n  $N_D(3,8)$ 是 $w_{D,\\alpha,L}$ 中索引在 $4,5,6,7$ 上的位数。\n  $w_{D,\\alpha,L} = 0x...2A = ...00101010$。占据的轨道有1, 3, 5, 20, 60。在区间 $(3,8)$ 中，只有轨道5被占据。所以 $N_D(3,8) = 1$。\n  使用位运算：掩码是 `((1UL  8) - 1) ^ ((1UL  4) - 1)`，即从位4到7为1。\n  $N_D(3,8) = \\text{popcount}(w_{D,\\alpha,L} \\text{ AND } 0xF0) = \\text{popcount}(0x20) = 1$。\n  $N_D(20,25)$ 是 $w_{D,\\alpha,L}$ 中索引在 $21,22,23,24$ 上的位数。\n  在区间 $(20,25)$ 中没有被占据的轨道。所以 $N_D(20,25)=0$。\n- 总相移指数为 $p = N_D(3,8) + N_D(20,25) = 1 + 0 = 1$。\n- 相因子 $\\phi = (-1)^1 = -1$。\n- 最终结果 $s = \\phi \\times \\nu = (-1) \\times 2 = -2$。", "answer": "$$\\boxed{-2}$$", "id": "2803686"}, {"introduction": "在理解了行列式的静态表示后，我们转向其在FCIQMC算法中的动态演化。本练习将引导您手动完成一个完整的FCIQMC算法时间步。通过为一个微型系统执行具体的派生(spawning)、死亡/克隆(death/cloning)和湮灭(annihilation)事件，您将对行走子(walker)布居如何随机地采样FCI空间并投影出基态波函数获得一个具体而深入的理解[@problem_id:2803677]。", "problem": "在一个由两个斯莱特行列式 $\\lvert D_{0} \\rangle$ 和 $\\lvert D_{1} \\rangle$ 构成的最小选择组态相互作用 (Selected CI) 子空间中，考虑全组态相互作用量子蒙特卡洛 (Full CI Quantum Monte Carlo, FCIQMC) 的虚时随机投影动力学。该子空间中的有效哈密顿矩阵具有非零元素 $H_{00}=-1.0$、$H_{11}=+0.5$ 和 $H_{01}=H_{10}=+0.2$，单位均为哈特里 (Hartree)。离散时间步长为 $\\delta \\tau = 0.1$，固定的粒子数控制移位为 $S=-0.8$ (单位均为哈特里)。\n\n在此步开始时，行走者 (walker) 分布为：\n- 在 $\\lvert D_{0} \\rangle$ 上：3个正符号行走者和1个负符号行走者。\n- 在 $\\lvert D_{1} \\rangle$ 上：1个负符号行走者。\n\n采用标准的FCIQMC更新规则进行一个时间步长的演化，规则和顺序如下：\n- 派生 (Spawning)：对于行列式 $i$ 上的每个行走者，在这个双行列式模型中，以概率 $p_{\\mathrm{gen}}(j \\mid i)=1$ 选择一个相连的行列式 $j$。以概率 $p_{\\mathrm{s}}(j \\leftarrow i)=\\delta \\tau \\left| H_{ji} \\right|$ 提议向 $j$ 派生一个子代。如果派生成功，子代的符号为 $s_{\\mathrm{child}}=-\\mathrm{sgn}(H_{ji})\\, s_{\\mathrm{parent}}$。\n- 死亡/克隆 (Death/Cloning)：对于行列式 $i$ 上的每个母代行走者，以概率 $p_{\\mathrm{d}}(i)=\\delta \\tau \\left( H_{ii}-S \\right)$ 应用对角事件。如果 $p_{\\mathrm{d}}(i) \\ge 0$，则行走者以概率 $p_{\\mathrm{d}}(i)$ 死亡。如果 $p_{\\mathrm{d}}(i)0$，则以概率 $-p_{\\mathrm{d}}(i)$ 创建一个克隆体（具有相同的符号和行列式）。\n- 湮灭 (Annihilation)：在完成母代行走者的派生和死亡/克隆之后，将每个行列式上的所有贡献（原始幸存者、派生的子代和克隆体）相加，并通过局部抵消符号相反的行走者来进行湮灭。\n\n使用以下在 $\\left[0,1\\right)$ 区间内独立的均匀分布随机数来决定每个伯努利事件的结果：\n- 从 $\\lvert D_{0} \\rangle$ 到 $\\lvert D_{1} \\rangle$ 的派生尝试，针对四个初始行走者，按顺序：正符号-a 使用 0.4，正符号-b 使用 0.015，正符号-c 使用 0.8，负符号-a 使用 0.010。\n- 从 $\\lvert D_{1} \\rangle$ 到 $\\lvert D_{0} \\rangle$ 对其初始行走者的派生尝试：$0.70$。\n- 在 $\\lvert D_{0} \\rangle$ 上对同样的四个初始行走者按同样顺序进行的死亡/克隆事件：$0.010$、$0.50$、$0.50$、$0.30$。\n- 在 $\\lvert D_{1} \\rangle$ 上对其初始行走者的死亡事件：$0.50$。\n\n以 $\\lvert D_{0} \\rangle$ 为参考的投影能量估计量定义为\n$$\nE_{\\mathrm{proj}} \\equiv \\frac{\\sum_{j \\in \\{0,1\\}} H_{0j} \\, N_{j}}{N_{0}},\n$$\n其中 $N_{j}$ 是湮灭后 $\\lvert D_{j} \\rangle$ 上的带符号行走者数量。计算这一个时间步长内投影能量估计量的变化，\n$$\n\\Delta E_{\\mathrm{proj}} \\equiv E_{\\mathrm{proj}}^{\\text{after}} - E_{\\mathrm{proj}}^{\\text{before}},\n$$\n并以哈特里为单位给出精确值作为最终答案（不要四舍五入）。最终答案必须是单个数字。", "solution": "该问题陈述经核实具有科学依据、问题定义清晰且客观。它提供了一套完整且一致的数据和规则，用于执行标准全组态相互作用量子蒙特卡洛（FCIQMC）模拟的单确定性步骤。该问题是理论化学原理的直接且可形式化的应用。因此，将提供解答。\n\n目标是在一个时间步长 $\\delta \\tau = 0.1$ 内，计算投影能量的变化 $\\Delta E_{\\mathrm{proj}} = E_{\\mathrm{proj}}^{\\text{after}} - E_{\\mathrm{proj}}^{\\text{before}}$。\n\n首先，我们确定初始状态，并计算此步之前的投影能量 $E_{\\mathrm{proj}}^{\\text{before}}$。\n在斯莱特行列式 $\\lvert D_{0} \\rangle$ 和 $\\lvert D_{1} \\rangle$ 上的初始带符号行走者数量为：\n- $N_{0}^{\\text{before}} = (+1) \\times 3 + (-1) \\times 1 = 2$\n- $N_{1}^{\\text{before}} = (+1) \\times 0 + (-1) \\times 1 = -1$\n\n投影能量估计量定义为 $E_{\\mathrm{proj}} \\equiv \\frac{\\sum_{j} H_{0j} \\, N_{j}}{N_{0}}$。相关的哈密顿矩阵元素为 $H_{00}=-1.0$ 和 $H_{01}=+0.2$。\n初始投影能量为：\n$$\nE_{\\mathrm{proj}}^{\\text{before}} = \\frac{H_{00} N_{0}^{\\text{before}} + H_{01} N_{1}^{\\text{before}}}{N_{0}^{\\text{before}}} = \\frac{(-1.0)(2) + (0.2)(-1)}{2} = \\frac{-2.0 - 0.2}{2} = \\frac{-2.2}{2} = -1.1\n$$\n\n接下来，我们根据指定的规则模拟一个时间步长，顺序为派生、死亡/克隆和湮灭。\n\n派生步骤：\n从行列式 $\\lvert D_{i} \\rangle$ 到 $\\lvert D_{j} \\rangle$ 的派生以概率 $p_{\\mathrm{s}}(j \\leftarrow i) = \\delta \\tau \\left| H_{ji} \\right|$ 发生。派生子代的符号为 $s_{\\mathrm{child}} = -\\mathrm{sgn}(H_{ji}) s_{\\mathrm{parent}}$。\n\n- 从 $\\lvert D_{0} \\rangle$ 到 $\\lvert D_{1} \\rangle$ 的派生：\n  概率为 $p_{\\mathrm{s}}(1 \\leftarrow 0) = \\delta \\tau \\left| H_{10} \\right| = (0.1) |+0.2| = 0.02$。\n  符号规则为 $s_{\\mathrm{child}} = -\\mathrm{sgn}(+0.2) s_{\\mathrm{parent}} = -s_{\\mathrm{parent}}$。\n  $\\lvert D_{0} \\rangle$ 上有4个母代行走者：3个正符号（p-a、p-b、p-c）和1个负符号（n-a）。我们将每个行走者与其随机数 $u$ 进行比较。\n  1. 行走者 p-a ($u=0.4$)：$0.4 \\ge 0.02$。不派生。\n  2. 行走者 p-b ($u=0.015$)：$0.015  0.02$。发生派生。母代为正符号，因此在 $\\lvert D_{1} \\rangle$ 上创建一个负符号子代。\n  3. 行走者 p-c ($u=0.8$)：$0.8 \\ge 0.02$。不派生。\n  4. 行走者 n-a ($u=0.010$)：$0.010  0.02$。发生派生。母代为负符号，因此在 $\\lvert D_{1} \\rangle$ 上创建一个正符号子代。\n  总计，从 $\\lvert D_{0} \\rangle$ 的派生在 $\\lvert D_{1} \\rangle$ 上创建了一个正符号和一个负符号的行走者。\n\n- 从 $\\lvert D_{1} \\rangle$ 到 $\\lvert D_{0} \\rangle$ 的派生：\n  概率为 $p_{\\mathrm{s}}(0 \\leftarrow 1) = \\delta \\tau \\left| H_{01} \\right| = (0.1) |+0.2| = 0.02$。\n  符号规则为 $s_{\\mathrm{child}} = -\\mathrm{sgn}(+0.2) s_{\\mathrm{parent}} = -s_{\\mathrm{parent}}$。\n  $\\lvert D_{1} \\rangle$ 上有1个负符号的母代行走者。\n  1. 行走者 ($u=0.70$)：$0.70 \\ge 0.02$。不派生。\n  没有行走者派生到 $\\lvert D_{0} \\rangle$ 上。\n\n死亡/克隆步骤：\n此步骤应用于原始的母代行走者。事件概率为 $p_{\\mathrm{d}}(i) = \\delta \\tau (H_{ii} - S)$，其中 $S = -0.8$。\n\n- 在 $\\lvert D_{0} \\rangle$ 上：\n  概率为 $p_{\\mathrm{d}}(0) = (0.1) \\left( H_{00} - S \\right) = (0.1)(-1.0 - (-0.8)) = (0.1)(-0.2) = -0.02$。\n  由于 $p_{\\mathrm{d}}(0)  0$，克隆以概率 $-p_{\\mathrm{d}}(0) = 0.02$ 发生。\n  我们将 $\\lvert D_{0} \\rangle$ 上的4个母代行走者与其随机数 $u$ 进行比较。\n  1. 行走者 p-a ($u=0.010$)：$0.010  0.02$。创建克隆体。一个新的正符号行走者出现在 $\\lvert D_{0} \\rangle$ 上。\n  2. 行走者 p-b ($u=0.50$)：$0.50 \\ge 0.02$。不克隆。\n  3. 行走者 p-c ($u=0.50$)：$0.50 \\ge 0.02$。不克隆。\n  4. 行走者 n-a ($u=0.30$)：$0.30 \\ge 0.02$。不克隆。\n  原始的4个行走者幸存下来，一个正符号克隆体被添加到 $\\lvert D_{0} \\rangle$ 上。\n\n- 在 $\\lvert D_{1} \\rangle$ 上：\n  概率为 $p_{\\mathrm{d}}(1) = (0.1) \\left( H_{11} - S \\right) = (0.1)(0.5 - (-0.8)) = (0.1)(1.3) = 0.13$。\n  由于 $p_{\\mathrm{d}}(1) \\ge 0$，死亡以概率 $0.13$ 发生。\n  我们将 $\\lvert D_{1} \\rangle$ 上的1个负符号母代行走者与其随机数 $u=0.50$ 进行比较。\n  1. 行走者 ($u=0.50$)：$0.50 \\ge 0.13$。该行走者幸存。\n  $\\lvert D_{1} \\rangle$ 上的原始负符号行走者幸存。\n\n湮灭步骤：\n现在我们将每个行列式上的所有行走者（幸存者、克隆体、派生子代）相加，并湮灭符号相反的配对。\n\n- 在 $\\lvert D_{0} \\rangle$ 上：\n  - 原始幸存者：3个正符号，1个负符号。\n  - 派生子代：0。\n  - 克隆体：1个正符号。\n  - 湮灭前总数：$(3+1)$ 个正符号，1个负符号 = 4个正符号，1个负符号。\n  - 湮灭：$4 - 1 = 3$ 个正符号行走者剩余。\n  - 最终的带符号数量为 $N_{0}^{\\text{after}} = +3$。\n\n- 在 $\\lvert D_{1} \\rangle$ 上：\n  - 原始幸存者：1个负符号。\n  - 派生子代：1个正符号，1个负符号。\n  - 克隆体：0。\n  - 湮灭前总数：1个正符号，$(1+1)$ 个负符号 = 1个正符号，2个负符号。\n  - 湮灭：$2 - 1 = 1$ 个负符号行走者剩余。\n  - 最终的带符号数量为 $N_{1}^{\\text{after}} = -1$。\n\n最后，我们计算此步之后的投影能量 $E_{\\mathrm{proj}}^{\\text{after}}$ 及其变化量 $\\Delta E_{\\mathrm{proj}}$。\n$$\nE_{\\mathrm{proj}}^{\\text{after}} = \\frac{H_{00} N_{0}^{\\text{after}} + H_{01} N_{1}^{\\text{after}}}{N_{0}^{\\text{after}}} = \\frac{(-1.0)(3) + (0.2)(-1)}{3} = \\frac{-3.0 - 0.2}{3} = -\\frac{3.2}{3}\n$$\n投影能量的变化为：\n$$\n\\Delta E_{\\mathrm{proj}} = E_{\\mathrm{proj}}^{\\text{after}} - E_{\\mathrm{proj}}^{\\text{before}} = \\left(-\\frac{3.2}{3}\\right) - (-1.1) = -\\frac{3.2}{3} + \\frac{1.1}{1}\n$$\n为了将其表示为精确分数：\n$$\n\\Delta E_{\\mathrm{proj}} = -\\frac{32}{30} + \\frac{11}{10} = -\\frac{32}{30} + \\frac{33}{30} = \\frac{33 - 32}{30} = \\frac{1}{30}\n$$\n这一个时间步长内投影能量估计量的变化恰好是 $\\frac{1}{30}$ 哈特里。", "answer": "$$\\boxed{\\frac{1}{30}}$$", "id": "2803677"}, {"introduction": "进行模拟只是成功的一半，最终目标是从随机过程中提取出具有可靠误差棒的物理量。本练习介绍了FCIQMC等方法生成的时间序列数据中一个至关重要的概念：自相关性。通过推导和应用“分块法”(blocking method)，您将学会如何计算样本均值的真实统计方差，这是任何随机方法实践者都必须掌握的核心技能[@problem_id:2803682]。", "problem": "在选择组态相互作用 (SCI) 和全组态相互作用量子蒙特卡罗 (FCIQMC) 中，我们经常监测一个投影能量时间序列 $\\{O_t\\}_{t=1}^{N}$。该序列是在离散的虚时迭代中获得的，迭代之间由固定的虚时步长 $\\delta \\tau$（以原子单位 (a.u.) 计）分隔。假设 $\\{O_t\\}$ 是精确投影能量的一个广义平稳、无偏估计量，具有有限方差 $\\sigma^{2} = \\operatorname{Var}(O_t)$ 和自协方差函数 $C(k) = \\mathbb{E}[(O_t - \\mu)(O_{t+k} - \\mu)]$，其中 $\\mu = \\mathbb{E}[O_t]$，$k$ 是整数延迟。\n\n1) 定义离散时间序列 $\\{O_t\\}$ 的归一化自相关函数 $\\rho(k)$ 和积分自相关时间 $\\tau_{\\mathrm{int}}$。\n\n2) 仅使用第 (1) 部分的定义、$\\{O_t\\}$ 的平稳性，以及一种分块分析构造（其中数据被划分为 $M$ 个长度为 $b$ 的不重叠连续块，因此 $N = M b$），推导样本均值 $\\bar{O} = \\frac{1}{N}\\sum_{t=1}^{N} O_t$ 的方差在大 $N$ 情况下的表达式，用 $\\sigma^{2}$ 和 $\\tau_{\\mathrm{int}}$ 表示。您的推导必须遵循以下步骤：(i) 构建块平均值 $\\bar{O}^{(b)}_j = \\frac{1}{b}\\sum_{t=(j-1)b+1}^{jb} O_t$，(ii) 用 $\\operatorname{Var}(\\bar{O}^{(b)}_j)$ 和 $M$ 表示 $\\operatorname{Var}(\\bar{O})$，以及 (iii) 取块大小 $b$ 相对于相关长度为大的极限，使得块间相关性可以忽略不计，从而获得对 $\\tau_{\\mathrm{int}}$ 的闭式依赖关系。\n\n3) 考虑一个 FCIQMC 计算，其中投影能量时间序列的归一化自相关函数可以很好地由单指数衰减 $\\rho(k) = \\exp(-k\\,\\delta \\tau/\\tau_{c})$ 描述，其中 $\\tau_{c}$ 是一个特征衰减时间。设 $\\delta \\tau = 0.001$ a.u.，$\\tau_{c} = 0.01$ a.u.，$N = 10^{6}$ 次迭代，每次迭代的方差 $\\sigma^{2} = 0.09$ 平方哈特里 (Ha$^{2}$)。使用您推导的结果，计算样本均值的方差 $\\operatorname{Var}(\\bar{O})$。将您的答案四舍五入到四位有效数字。用平方哈特里 (Ha$^{2}$) 表示您的最终结果。", "solution": "所述问题具有科学依据，提法恰当，且无矛盾之处。它是在蒙特卡罗模拟的时间序列数据统计分析方面的一个标准练习，虽然并非微不足道，但却是计算理论化学中的一个基本课题。因此，我将给出一个完整的解答。\n\n1) 离散时间序列 $\\{O_t\\}$ 的统计量定义：\n\n对于广义平稳过程，归一化自相关函数 $\\rho(k)$ 定义为自协方差函数 $C(k)$ 除以过程的方差。方差是零延迟时的自协方差，即 $C(0)$。\n给定 $C(k) = \\mathbb{E}[(O_t - \\mu)(O_{t+k} - \\mu)]$ 和 $\\sigma^{2} = \\operatorname{Var}(O_t) = C(0)$，归一化自相关函数为：\n$$\n\\rho(k) = \\frac{C(k)}{C(0)} = \\frac{C(k)}{\\sigma^{2}}\n$$\n根据定义，$\\rho(0) = 1$。由于平稳性，$C(k) = C(-k)$，这意味着 $\\rho(k) = \\rho(-k)$。\n\n积分自相关时间 $\\tau_{\\mathrm{int}}$ 量化了产生一个统计上独立的数据点所需的模拟步数。对于离散时间序列，它通过对归一化自相关函数的求和来定义。一个与接下来的分块分析一致的标准定义是：\n$$\n\\tau_{\\mathrm{int}} = \\frac{1}{2} + \\sum_{k=1}^{\\infty} \\rho(k)\n$$\n这个量 $\\tau_{\\mathrm{int}}$ 是无量纲的，表示以延迟步长 $k$ 为单位的自相关时间。\n\n2) 样本均值 $\\bar{O}$ 的方差推导：\n\n推导按照指定的步骤进行。\n整个时间序列的样本均值为 $\\bar{O} = \\frac{1}{N}\\sum_{t=1}^{N} O_t$。\n\n(i) 数据被划分为 $M$ 个长度为 $b$ 的不重叠块，其中 $N=Mb$。第 $j$ 个块的块平均值由下式给出：\n$$\n\\bar{O}^{(b)}_j = \\frac{1}{b}\\sum_{t=(j-1)b+1}^{jb} O_t\n$$\n总体样本均值 $\\bar{O}$ 可以表示为这些块平均值的平均值：\n$$\n\\bar{O} = \\frac{1}{N}\\sum_{t=1}^{N} O_t = \\frac{1}{Mb}\\sum_{j=1}^{M} \\sum_{t=(j-1)b+1}^{jb} O_t = \\frac{1}{M}\\sum_{j=1}^{M} \\left( \\frac{1}{b}\\sum_{t=(j-1)b+1}^{jb} O_t \\right) = \\frac{1}{M}\\sum_{j=1}^{M} \\bar{O}^{(b)}_j\n$$\n\n(ii) 样本均值的方差 $\\operatorname{Var}(\\bar{O})$ 现在可以用块平均值来表示：\n$$\n\\operatorname{Var}(\\bar{O}) = \\operatorname{Var}\\left(\\frac{1}{M}\\sum_{j=1}^{M} \\bar{O}^{(b)}_j\\right) = \\frac{1}{M^2} \\operatorname{Var}\\left(\\sum_{j=1}^{M} \\bar{O}^{(b)}_j\\right) = \\frac{1}{M^2} \\sum_{j=1}^{M}\\sum_{l=1}^{M} \\operatorname{Cov}(\\bar{O}^{(b)}_j, \\bar{O}^{(b)}_l)\n$$\n\n(iii) 在块大小 $b$ 很大的极限下，特别是当 $b$ 远大于序列的相关长度时，对于 $j \\neq l$，块平均值 $\\bar{O}^{(b)}_j$ 和 $\\bar{O}^{(b)}_l$ 变得统计上独立。这意味着它们的协方差可以忽略不计：对于 $j \\neq l$，$\\operatorname{Cov}(\\bar{O}^{(b)}_j, \\bar{O}^{(b)}_l) \\approx 0$。因此，双重求和简化为关于方差的单个求和：\n$$\n\\operatorname{Var}(\\bar{O}) \\approx \\frac{1}{M^2} \\sum_{j=1}^{M} \\operatorname{Var}(\\bar{O}^{(b)}_j)\n$$\n由于原始序列 $\\{O_t\\}$ 是平稳的，块平均值的统计特性与块索引 $j$ 无关。因此，对于所有 $j$，$\\operatorname{Var}(\\bar{O}^{(b)}_j) = \\operatorname{Var}(\\bar{O}^{(b)})$。表达式简化为：\n$$\n\\operatorname{Var}(\\bar{O}) \\approx \\frac{1}{M^2} M \\operatorname{Var}(\\bar{O}^{(b)}) = \\frac{1}{M} \\operatorname{Var}(\\bar{O}^{(b)})\n$$\n接下来，我们必须找到 $\\operatorname{Var}(\\bar{O}^{(b)})$ 的表达式。对于一个通用块（我们省略索引 $j$）：\n$$\n\\operatorname{Var}(\\bar{O}^{(b)}) = \\operatorname{Var}\\left(\\frac{1}{b}\\sum_{t=1}^{b} O_t\\right) = \\frac{1}{b^2} \\sum_{t=1}^{b}\\sum_{s=1}^{b} \\operatorname{Cov}(O_t, O_s)\n$$\n利用平稳性属性 $\\operatorname{Cov}(O_t, O_s) = C(|t-s|)$，我们有：\n$$\n\\operatorname{Var}(\\bar{O}^{(b)}) = \\frac{1}{b^2} \\sum_{t=1}^{b}\\sum_{s=1}^{b} C(|t-s|)\n$$\n这个双重求和可以通过将具有相同延迟 $k = t-s$ 的项分组来重写。对于一个延迟 $k$，有 $b-|k|$ 个这样的项对。\n$$\n\\operatorname{Var}(\\bar{O}^{(b)}) = \\frac{1}{b^2} \\sum_{k=-(b-1)}^{b-1} (b-|k|) C(k) = \\frac{1}{b^2} \\left( b C(0) + \\sum_{k=1}^{b-1} 2(b-k)C(k) \\right)\n$$\n除以 $b$ 并使用 $C(k) = \\sigma^2 \\rho(k)$：\n$$\n\\operatorname{Var}(\\bar{O}^{(b)}) = \\frac{\\sigma^2}{b} \\left( 1 + 2 \\sum_{k=1}^{b-1} (1-\\frac{k}{b}) \\rho(k) \\right)\n$$\n将此代入我们关于 $\\operatorname{Var}(\\bar{O})$ 的表达式并使用 $N=Mb$：\n$$\n\\operatorname{Var}(\\bar{O}) \\approx \\frac{1}{M} \\left[ \\frac{\\sigma^2}{b} \\left( 1 + 2 \\sum_{k=1}^{b-1} (1-\\frac{k}{b}) \\rho(k) \\right) \\right] = \\frac{\\sigma^2}{N} \\left( 1 + 2 \\sum_{k=1}^{b-1} (1-\\frac{k}{b}) \\rho(k) \\right)\n$$\n对于一个大的块大小 $b$，当 $k \\ll b$ 时 $\\rho(k) \\to 0$，则对于所有相关的 $k$，$k/b$ 项变得可以忽略不计，并且求和上限可以扩展到无穷大。\n$$\n\\operatorname{Var}(\\bar{O}) \\approx \\frac{\\sigma^2}{N} \\left( 1 + 2 \\sum_{k=1}^{\\infty} \\rho(k) \\right)\n$$\n使用第 (1) 部分中 $\\tau_{\\mathrm{int}}$ 的定义，其中 $\\sum_{k=1}^{\\infty} \\rho(k) = \\tau_{\\mathrm{int}} - \\frac{1}{2}$，我们得到最终的大 $N$ 表达式：\n$$\n\\operatorname{Var}(\\bar{O}) \\approx \\frac{\\sigma^2}{N} \\left( 1 + 2 (\\tau_{\\mathrm{int}} - \\frac{1}{2}) \\right) = \\frac{\\sigma^2}{N} (1 + 2\\tau_{\\mathrm{int}} - 1) = \\frac{2\\sigma^2 \\tau_{\\mathrm{int}}}{N}\n$$\n\n3) 针对特定 FCIQMC 情况的计算：\n\n给定 $\\rho(k) = \\exp(-k\\,\\delta \\tau/\\tau_{c})$。我们首先计算和 $\\sum_{k=1}^{\\infty} \\rho(k)$。这是一个几何级数：\n$$\n\\sum_{k=1}^{\\infty} \\rho(k) = \\sum_{k=1}^{\\infty} \\left( \\exp(-\\frac{\\delta \\tau}{\\tau_{c}}) \\right)^k\n$$\n几何级数 $\\sum_{k=1}^{\\infty} r^k$ 的和是 $\\frac{r}{1-r}$（对于 $|r|1$）。这里，$r = \\exp(-\\frac{\\delta \\tau}{\\tau_{c}})$。\n$$\n\\sum_{k=1}^{\\infty} \\rho(k) = \\frac{\\exp(-\\frac{\\delta \\tau}{\\tau_{c}})}{1 - \\exp(-\\frac{\\delta \\tau}{\\tau_{c}})}\n$$\n将此代入方差的表达式：\n$$\n\\operatorname{Var}(\\bar{O}) = \\frac{\\sigma^2}{N} \\left( 1 + 2 \\frac{\\exp(-\\frac{\\delta \\tau}{\\tau_{c}})}{1 - \\exp(-\\frac{\\delta \\tau}{\\tau_{c}})} \\right) = \\frac{\\sigma^2}{N} \\left( \\frac{1 - \\exp(-\\frac{\\delta \\tau}{\\tau_{c}}) + 2\\exp(-\\frac{\\delta \\tau}{\\tau_{c}})}{1 - \\exp(-\\frac{\\delta \\tau}{\\tau_{c}})} \\right)\n$$\n$$\n\\operatorname{Var}(\\bar{O}) = \\frac{\\sigma^2}{N} \\left( \\frac{1 + \\exp(-\\frac{\\delta \\tau}{\\tau_{c}})}{1 - \\exp(-\\frac{\\delta \\tau}{\\tau_{c}})} \\right)\n$$\n这个表达式等价于 $\\frac{\\sigma^2}{N} \\coth\\left(\\frac{\\delta\\tau}{2\\tau_c}\\right)$。现在，我们代入给定的数值：$\\delta \\tau = 0.001$ a.u.，$\\tau_{c} = 0.01$ a.u.，$N = 10^{6}$，以及 $\\sigma^{2} = 0.09$ Ha$^{2}$。\n\n双曲余切的自变量是：\n$$\n\\frac{\\delta\\tau}{2\\tau_c} = \\frac{0.001}{2 \\times 0.01} = \\frac{0.001}{0.02} = 0.05\n$$\n样本均值的方差是：\n$$\n\\operatorname{Var}(\\bar{O}) = \\frac{0.09}{10^{6}} \\coth(0.05)\n$$\n我们计算 $\\coth(0.05)$ 的值：\n$$\n\\coth(0.05) \\approx 20.016675\n$$\n因此，\n$$\n\\operatorname{Var}(\\bar{O}) = (0.09 \\times 10^{-6}) \\times 20.016675 \\approx 1.80150075 \\times 10^{-6} \\text{ Ha}^{2}\n$$\n将此结果四舍五入到四位有效数字，得到：\n$$\n\\operatorname{Var}(\\bar{O}) \\approx 1.802 \\times 10^{-6} \\text{ Ha}^{2}\n$$\n这个结果表明，即使有大量的样本（$10^6$），数据点之间的相关性（由 $\\tau_{\\mathrm{int}} \\approx 10$ 表示）也显著增大了均值的方差，相比之下，在不相关的情况下，方差将是 $\\sigma^2/N = 9 \\times 10^{-8}$。", "answer": "$$\n\\boxed{1.802 \\times 10^{-6}}\n$$", "id": "2803682"}]}