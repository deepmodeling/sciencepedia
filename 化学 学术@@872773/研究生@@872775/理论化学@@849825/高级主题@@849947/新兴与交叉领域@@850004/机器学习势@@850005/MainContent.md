## 引言
原子尺度的模拟是理解和设计新材料与化学过程的基石。然而，该领域长期面临着一个核心挑战：在计算精度与效率之间取得平衡。[第一性原理方法](@entry_id:268553)（如密度泛函理论）虽然精确，但其高昂的计算成本限制了其在时间和空间尺度上的应用；而[经典力场](@entry_id:747367)虽然高效，但其精度和可迁移性往往不足以描述复杂的化学环境。[机器学习势](@entry_id:183033)（MLP）的出现，为解决这一难题提供了革命性的途径。它通过学习高精度量子力学数据，构建能够以接近[经典力场](@entry_id:747367)的速度、却达到从头算精度的原子间相互作用模型，极大地扩展了我们模拟复杂系统的能力。

本文旨在为读者提供一个关于[机器学习势](@entry_id:183033)的全面而深入的指南。在接下来的内容中，我们将首先在“原理与机制”一章中，深入剖析支撑MLP的物理学基石和关键技术架构。随后，我们将在“应用与跨学科连接”一章中，展示MLP如何在[材料科学](@entry_id:152226)、化学和生物物理等领域解决实际问题。最后，通过“动手实践”部分，读者将有机会思考一些关键的实践挑战。现在，让我们从构建一个有效[机器学习势](@entry_id:183033)所必须遵循的基本原理开始。

## 原理与机制

在引言章节之后，我们现在深入探讨[机器学习势](@entry_id:183033)（Machine Learning Potentials, MLPs）的核心科学原理和关键实现机制。本章旨在为读者构建一个坚实的理论基础，阐明这些数据驱动模型如何根植于物理学的基本定律，并介绍当前领域中几种主流的技术路径。我们将从第一性原理出发，系统性地剖析[势能面](@entry_id:147441)的定义、其必须满足的对称性要求、实现[线性标度](@entry_id:197235)计算的[局域性原理](@entry_id:753741)，直至具体的模型架构和训练策略。

### 相互作用势的基本原则

任何有效的原子间相互作用势，无论是解析形式还是机器学习模型，都必须忠实地反映其所描述的物理系统的基本属性。这些属性构成了模型构建的基石。

#### 玻恩-奥本海默[势能面](@entry_id:147441)：学习的目标

[机器学习势](@entry_id:183033)的核心任务是精确、高效地近似计算系统的**玻恩-奥本海默（Born-Oppenheimer, BO）[势能面](@entry_id:147441)（Potential Energy Surface, PES）**。[势能面](@entry_id:147441) $V(\mathbf{R})$ 是一个标量函数，它将系统的[原子核](@entry_id:167902)构型（即所有[原子核](@entry_id:167902)的位置向量集合 $\mathbf{R} = \{\mathbf{r}_1, \mathbf{r}_2, \dots, \mathbf{r}_N\}$）映射到一个唯一的势能值。这个势能决定了在给定构型下[原子核](@entry_id:167902)所受的力，从而主导了[原子核](@entry_id:167902)的运动。

BO[势能面](@entry_id:147441)的概念源于**玻恩–奥本海默近似**。该近似的核心物理思想是，由于[原子核](@entry_id:167902)的质量远大于电子的质量（$m_{\mathrm{n}} \gg m_{\mathrm{e}}$），电子的运动速度比[原子核](@entry_id:167902)快得多。因此，可以认为电子能够瞬时地适应[原子核](@entry_id:167902)位置的任何变化。这允许我们将电子和[原子核](@entry_id:167902)的运动解耦：对于一个固定的（“夹持”的）[原子核](@entry_id:167902)构型 $\mathbf{R}$，我们可以求解只包含电子自由度的**[电子薛定谔方程](@entry_id:177999)**：
$$
\hat{H}_{\mathrm{el}}(\mathbf{r}; \mathbf{R}) \psi_k(\mathbf{r}; \mathbf{R}) = E_{\mathrm{el},k}(\mathbf{R}) \psi_k(\mathbf{r}; \mathbf{R})
$$
其中，$\hat{H}_{\mathrm{el}}$ 是[电子哈密顿量](@entry_id:177588)，它包括电子动能、[电子-电子相互作用](@entry_id:139900)以及给定[原子核](@entry_id:167902)构型下的电子-[原子核](@entry_id:167902)相互作用。

求解该方程会得到一系列对应不同电子态（$k=0, 1, 2, \dots$）的电子能级 $E_{\mathrm{el},k}(\mathbf{R})$。在[绝热近似](@entry_id:143074)下，系统在[演化过程](@entry_id:175749)中始终保持在同一个电子态上，通常是[基态](@entry_id:150928)（$k=0$）。BO[势能面](@entry_id:147441) $V(\mathbf{R})$ 就是由[基态](@entry_id:150928)电子能量 $E_{\mathrm{el},0}(\mathbf{R})$ 加上在该构型下被视为常数的经典[原子核](@entry_id:167902)-[原子核](@entry_id:167902)排斥能 $V_{\mathrm{nn}}(\mathbf{R})$ 构成的：
$$
V(\mathbf{R}) = E_{\mathrm{el},0}(\mathbf{R}) + V_{\mathrm{nn}}(\mathbf{R})
$$
这个 $V(\mathbf{R})$ 正是[机器学习势](@entry_id:183033)旨在学习和重现的[目标函数](@entry_id:267263) [@problem_id:2784636]。

值得注意的是，许多[电子结构计算](@entry_id:748901)软件报告的“电子能量”可能仅仅是[电子薛定谔方程](@entry_id:177999)的[本征值](@entry_id:154894) $E_{\mathrm{el},0}(\mathbf{R})$，并未包含 $V_{\mathrm{nn}}(\mathbf{R})$。在这种情况下，构建完整的[势能面](@entry_id:147441)需要手动将两者相加。此外，[势能面](@entry_id:147441) $V(\mathbf{R})$ 是一个定义在零开尔文温度下的力学量，必须与系统的[热力学](@entry_id:141121)量，如亥姆霍兹自由能 $F(T,V,N)$ 严格区分开。自由能依赖于温度 $T$，并且包含了[原子核](@entry_id:167902)的动能贡献和熵的贡献，它是一个统计平均量，而非单一构型的属性 [@problem_id:2784636]。此框架的有效性依赖于若干关键假设，包括BO近似、[绝热近似](@entry_id:143074)（即忽略不同电子态之间的[非绝热耦合](@entry_id:198018)）以及通常忽略对角BO修正（DBOC）。

#### 基本对称性：物理定律的约束

物理定律[对势能](@entry_id:203104)面 $E(\mathbf{R})$（为简洁起见，我们在此后用 $E$ 代替 $V$）施加了严格的对称性约束。一个物理上合理的势函数必须尊重这些对称性。

1.  **[平移不变性](@entry_id:195885) (Translational Invariance)**：将整个系统在空间中进行任意刚性平移，其势能不应改变。这意味着能量只依赖于原子间的相对位置，而非其在空间中的绝对位置。

2.  **[旋转不变性](@entry_id:137644) (Rotational Invariance)**：将整个系统在空间中进行任意刚性旋转，其势能也不应改变。这意味着能量只依赖于原子间的相对位置所构成的内部几何结构（如键长、键角等），而非其在空间中的绝对朝向。

综合平移和[旋转不变性](@entry_id:137644)，我们可以说，对于任何[正交矩阵](@entry_id:169220) $R \in \mathrm{O}(3)$（代表旋转或旋转反演）和任意平移向量 $\mathbf{t} \in \mathbb{R}^3$，[势能函数](@entry_id:200753)必须满足：
$$
E(\{\mathbf{r}_i\}_{i=1}^N) = E(\{R\mathbf{r}_i + \mathbf{t}\}_{i=1}^N)
$$
例如，在真空中移动或旋转一个甲烷（$\mathrm{CH_4}$）分子，其[势能](@entry_id:748988)保持不变 [@problem_id:2784640]。

3.  **[置换不变性](@entry_id:753356) (Permutational Invariance)**：根据量子力学原理，同种类型的原子是不可区分的。因此，交换任意两个同种原子的标签（索引），系统的总能量必须保持不变。如果 $\pi$ 是一个只在同种原子[子集](@entry_id:261956)内部交换索引的[置换](@entry_id:136432)操作，则：
$$
E(\{\mathbf{r}_i\}_{i=1}^N) = E(\{\mathbf{r}_{\pi(i)}\}_{i=1}^N)
$$
例如，对于一个水分子（$\mathrm{H_2O}$），交换两个氢原子的标签不会改变其能量。值得强调的是，这种对称性严格限于**相同化学种类**的原子之间，交换不同元素（如 $\mathrm{Na}$ 和 $\mathrm{Cl}$）会产生一个物理上完全不同的构型，其能量也会截然不同 [@problem_id:2784640]。

这些能量的对称性要求直接决定了力的变换性质。力是能量对位置的负梯度，$\mathbf{F}_i = -\nabla_{\mathbf{r}_i} E$。从这个关系可以推导出，如果能量是平移和旋转不变的，那么力矢量必须是**等变（equivariant）**的。具体而言：

-   **[平移等变性](@entry_id:636340)**：全局平移不改变原子间的相对位置，因此力矢量保持不变。
-   **旋转[等变性](@entry_id:636671)**：如果将整个系统旋转一个矩阵 $R$，那么每个原子上的力矢量也必须随之旋转相同的 $R$。
-   **[置换](@entry_id:136432)[等变性](@entry_id:636671)**：如果交换两个同种原子 $i$ 和 $j$ 的标签，那么它们各自所受的力矢量也必须相应地交换。

形式上，对于[刚体运动](@entry_id:193355)，力的[等变性](@entry_id:636671)可以表示为 [@problem_id:2784640] [@problem_id:2648604] [@problem_id:2648650]：
$$
\mathbf{F}_i(\{R\mathbf{r}_j + \mathbf{t}\}_{j=1}^N) = R \mathbf{F}_i(\{\mathbf{r}_j\}_{j=1}^N)
$$
而对于[置换](@entry_id:136432)，力的[等变性](@entry_id:636671)为：
$$
\mathbf{F}_{\pi(i)}(\{\mathbf{r}_{\pi(j)}\}_{j=1}^N) = \mathbf{F}_i(\{\mathbf{r}_j\}_{j=1}^N)
$$
一个常见的误解是认为力也应该是旋转不变的，这是错误的。不变性（invariance）意味着量本身不变，而[等变性](@entry_id:636671)（equivariance）意味着量以与坐标相同的方式变换。力是矢量，因此它必须是旋转等变的，而非不变的 [@problem_id:2784640]。任何一个成功的MLP架构都必须通过其设计来严格保证能量的[不变性](@entry_id:140168)和力的[等变性](@entry_id:636671)。

### [局域性原理](@entry_id:753741)：实现[线性标度](@entry_id:197235)化的途径

为了模拟包含成千上万甚至数百万个原子的大尺度系统，计算成本必须与系统大小 $N$ 呈线性关系，即所谓的**[线性标度](@entry_id:197235)（linear scaling）**。这要求总能量的计算可以分解为对每个原子的独立（或近似独立）的贡献求和。

#### 总能量的原子贡献分解

现代MLP架构的一个核心思想是将系统的总能量 $E$ 分解为各个原子能量贡献 $\varepsilon_i$ 的总和 [@problem_id:2784673]：
$$
E \approx \sum_{i=1}^{N} \varepsilon_i
$$
其中，$\varepsilon_i$ 被假定为原子 $i$ 的“原子能量”，它只依赖于该原子周围的**局域化学环境（local chemical environment）**。这种分解是MLP能够实现**[广延性](@entry_id:144932)（extensivity）**或**尺寸一致性（size-consistency）**的关键。[广延性](@entry_id:144932)指的是，对于两个相距足够远、彼此不相互作用的子系统 $A$ 和 $B$，其总能量应等于两个子系统能量之和，即 $E(A \cup B) = E(A) + E(B)$。在原子[能量分解](@entry_id:193582)的框架下，只要子系统 $A$ 和 $B$ 之间的距离大于局域环境的定义范围，那么 $A$ 中任何原子的局域环境就不受 $B$ 的影响（反之亦然），其原子能量贡献 $\varepsilon_i$ 保持不变，从而自然地满足了[广延性](@entry_id:144932)要求。

#### 局域性的物理基础：科恩的“[近视](@entry_id:178989)”原理

将总[能量分解](@entry_id:193582)为局域贡献的假设并非凭空捏造，它有着深刻的物理基础，即[凝聚态物理学](@entry_id:140205)家 Walter Kohn 提出的**电子“[近视](@entry_id:178989)”原理（principle of nearsightedness）** [@problem_id:2648636]。该原理指出，对于一个具有[能隙](@entry_id:191975)的系统，局域的扰动（例如移动一个原子）对[电子结构](@entry_id:145158)的影响会随着距离的增加而指数衰减。

这个原理的数学体现是[单体密度矩阵](@entry_id:161726) $\rho(\mathbf{r}, \mathbf{r}')$ 的衰减行为。密度矩阵描述了位于 $\mathbf{r}$ 的电子与位于 $\mathbf{r}'$ 的电子之间的量子关联。

-   在**绝缘体和[半导体](@entry_id:141536)**中，由于存在非零的电子[能隙](@entry_id:191975)，密度矩阵会随着距离 $|\mathbf{r}-\mathbf{r}'|$ 的增加而**指数衰减**：$|\rho(\mathbf{r}, \mathbf{r}')| \sim \exp(-\gamma |\mathbf{r}-\mathbf{r}'|)$。这意味着电子结构具有很强的局域性，一个原子的能量贡献确实主要由其近邻决定。这为在这些材料中使用有限[截断半径](@entry_id:136708)的局域模型提供了坚实的理论依据。

-   在零温（$T=0 \, \mathrm{K}$）的**金属**中，情况则有所不同。由于[费米面](@entry_id:137798)处没有[能隙](@entry_id:191975)，电子态是“临界”的，密度矩阵的衰减遵循较慢的**[幂律](@entry_id:143404)**形式，并伴有所谓的[弗里德尔振荡](@entry_id:146905)。这意味着扰动可以产生长程效应，严格的局域性假设不再成立。

-   然而，在有限[电子温度](@entry_id:180280)（$T > 0 \, \mathrm{K}$）下，[费米-狄拉克分布](@entry_id:138909)的“热涂抹”效应使得[费米面](@entry_id:137798)不再是一个尖锐的边界。这种平滑性恢复了[密度矩阵](@entry_id:139892)的**指数衰减**特性，尽管其衰减长度可能很大。因此，对于在有限温度下模拟的金属体系，局域模型再次变得物理上合理 [@problem_id:2648636]。

#### 局域性的实践：[截断半径](@entry_id:136708)与平滑截断函数

在实践中，局域性是通过定义一个**[截断半径](@entry_id:136708) (cutoff radius)** $r_c$ 来实现的。在计算原子 $i$ 的能量贡献 $\varepsilon_i$ 时，我们只考虑那些与原子 $i$ 的距离小于 $r_c$ 的邻居原子。

简单地在 $r_c$ 处进行硬截断（即当原子间距 $r$ 越过 $r_c$ 时，相互作用突然从有变为无）会在[势能面](@entry_id:147441)上引入不连续性。能量的[不连续性](@entry_id:144108)会导致无穷大的力，这对[分子动力学](@entry_id:147283)（MD）模拟是灾难性的。因此，必须使用**平滑的截断函数 (smooth cutoff/switching function)** $s(r)$ 来确保相互作用在 $r_c$ 附近平滑地过渡到零 [@problem_id:2648588]。一个典型的截断函数在某个内半径 $r_{\mathrm{on}}$ 以内为1，在 $r_c$ 以外为0，并在两者之间平滑过渡。

截断函数的平滑程度至关重要：
-   **能量连续性 ($C^0$)**：要求 $s(r_c)=0$。这可以确保当原子对的距离达到 $r_c$ 时，能量平滑地变为零。
-   **力的连续性 ($C^1$)**：要求能量的一阶导数在 $r_c$ 处也为零。对于一个依赖于截断函数 $s(r)$ 的势能项，这通常要求 $s(r_c)=0$ 和 $s'(r_c)=0$。力的[不连续性](@entry_id:144108)等同于一个瞬时[冲量](@entry_id:178343)，会严重破坏MD模拟中的[能量守恒](@entry_id:140514)，导致数值不稳定。
-   **[海森矩阵](@entry_id:139140)连续性 ($C^2$)**：要求能量的[二阶导数](@entry_id:144508)在 $r_c$ 处也为零，这通常要求 $s(r_c)=s'(r_c)=s''(r_c)=0$。海森矩阵的连续性可以避免在截断区域引入人为的高频[振动](@entry_id:267781)，从而提高积分步长的稳定性 [@problem_id:2648588]。

因此，一个高质量的MLP必须使用至少保证力连续（$C^1$）的平滑截断方案。一个常见的选择是基于余弦的函数，例如：
$$
f_c(r) = \begin{cases} \frac{1}{2}\left[\cos\left(\frac{\pi r}{r_c}\right)+1\right]  & \text{if } r \le r_c \\ 0 & \text{if } r > r_c \end{cases}
$$
这个函数及其[一阶导数](@entry_id:749425)在 $r=r_c$ 处均为零 [@problem_id:2784613]。

### [机器学习势](@entry_id:183033)的架构

满足上述物理原理的MLP架构主要分为两大类：基于不变性描述符的模型和等变模型。

#### 基于[不变性](@entry_id:140168)描述符的模型

这类模型采取一种两步策略：首先，将每个原子的局域环境用一组精心设计的、本身就满足平移、旋转和[置换不变性](@entry_id:753356)的**描述符（descriptors）**或**[对称函数](@entry_id:177113)（symmetry functions）** $\mathbf{G}_i$ 来表示；然后，将这个描述符向量作为输入，送入一个标准的回归模型（如[神经网](@entry_id:276355)络或[高斯过程](@entry_id:182192)）来预测原子能量 $\varepsilon_i$。

##### [Behler-Parrinello](@entry_id:177243) [神经网](@entry_id:276355)络 (BPNN)

[Behler-Parrinello](@entry_id:177243) [神经网](@entry_id:276355)络是这类模型的开创性代表 [@problem_id:2784673]。其核心架构如下：
1.  总[能量分解](@entry_id:193582)为原子贡献之和：$E = \sum_i \varepsilon_i$。
2.  每个原子的能量 $\varepsilon_i$ 由一个只与该[原子化](@entry_id:155635)学元素种类 $Z_i$ 相关的独立[神经网](@entry_id:276355)络 $f^{(Z_i)}$ 预测。
3.  该[神经网](@entry_id:276355)络的输入是描述原子 $i$ 局域环境的[对称函数](@entry_id:177113)向量 $\mathbf{G}_i$。
$$
\varepsilon_i = f^{(Z_i)}(\mathbf{G}_i(\mathbf{R}, \mathbf{Z}))
$$
这种架构的巧妙之处在于，所有的对称性要求都已经被“预处理”并编码到[对称函数](@entry_id:177113) $\mathbf{G}_i$ 的构造中。[神经网](@entry_id:276355)络本身无需“学习”对称性，只需学习从[不变性](@entry_id:140168)描述符到能量的复杂函数关系即可。这个框架中的不变性和[广延性](@entry_id:144932)来自于描述符的设计和加和式的架构，而非特定的[回归模型](@entry_id:163386)。因此，将原子[神经网](@entry_id:276355)络替换为其他回归模型，如[高斯过程回归](@entry_id:276025)（Gaussian Process Regression），同样可以保留这些基本性质 [@problem_id:2784673]。

##### 构造不变性描述符：[对称函数](@entry_id:177113)

Behler和Parrinello提出了一系列基于原子间距离和角度的[对称函数](@entry_id:177113)。最常见的两种是 [@problem_id:2784613]：

-   **[径向对称](@entry_id:141658)函数 ($G^2$)**：用于描述中心原子 $i$ 周围的径向邻居[分布](@entry_id:182848)。其形式通常为一系列高斯函数的和，每个[高斯函数](@entry_id:261394)探测一个特定的距离壳层：
    $$
    G^2_i = \sum_{j \neq i} \exp(-\eta (R_{ij} - R_s)^2) f_c(R_{ij})
    $$
    其中 $R_{ij}$ 是原子 $i,j$ 之间的距离，$\eta$ 和 $R_s$ 是控制[高斯函数](@entry_id:261394)宽度和中心的可调参数，$f_c(R_{ij})$ 是平滑截断函数。通过使用多组不同的 $(\eta, R_s)$ 参数，可以生成一个能够分辨不同径向[分布](@entry_id:182848)的描述符向量。对所有邻居 $j$ 求和保证了对邻居原子标签的[置换不变性](@entry_id:753356)。

-   **角向[对称函数](@entry_id:177113) ($G^4$)**：用于描述中心原子 $i$ 周围的角向邻居[分布](@entry_id:182848)，它依赖于原子三元组 $(i, j, k)$。其通用形式为：
    $$
    G^4_i = 2^{1-\zeta} \sum_{j \neq i, k > j, k \neq i} (1 + \lambda \cos\theta_{ijk})^\zeta \exp(-\eta [R_{ij}^2 + R_{ik}^2 + R_{jk}^2]) f_c(R_{ij}) f_c(R_{ik})
    $$
    其中 $\theta_{ijk}$ 是以原子 $i$ 为顶点的键角，$\lambda \in \{+1, -1\}$ 和 $\zeta \geq 0$ 是可调参数，用于构建一个能够分辨不同角向结构的[基函数](@entry_id:170178)集。指数项对三元组的尺寸进行加权。对所有唯一的邻居对 $(j, k)$ 求和保证了[置换不变性](@entry_id:753356)。

由于这些函数完全由标量（距离和[点积](@entry_id:149019)）构成，它们天然地满足平移和[旋转不变性](@entry_id:137644)。

##### 构造[不变性](@entry_id:140168)描述符：SOAP

**[原子位置的光滑重叠](@entry_id:754987) (Smooth Overlap of Atomic Positions, SOAP)** 是另一种功能强大且广泛使用的描述符 [@problem_id:2784653]。SOAP的构造过程更为系统化：

1.  **构建邻居密度**：在中心原子周围，为每个邻居原子 $j$ 放置一个三维[高斯函数](@entry_id:261394)。将所有邻居的高斯函数求和，便得到一个平滑的**邻居原子密度场** $\rho(\mathbf{r})$。
    $$
    \rho(\mathbf{r}) = \sum_i f_c(|\mathbf{R}_i|)\, \left(2\pi \sigma^2\right)^{-3/2} \exp\left(-\dfrac{\|\mathbf{r}-\mathbf{R}_i\|^2}{2\sigma^2}\right)
    $$

2.  **展开到球谐基**：将这个密度场 $\rho(\mathbf{r})$ 在一个由[径向基函数](@entry_id:754004) $g_n(r)$ 和球谐函数 $Y_{lm}(\hat{\mathbf{r}})$ 构成的完备正交基上展开，得到一系列展开系数 $c_{nlm}$。
    $$
    c_{nlm} = \int_{0}^{r_c} dr\, r^2 \int d\hat{\mathbf{r}}\, g_n(r)\, Y_{lm}^*(\hat{\mathbf{r}})\, \rho(\mathbf{r})
    $$

3.  **构造[旋转不变量](@entry_id:170459)**：展开系数 $c_{nlm}$ 在旋转下会以复杂的方式变换（它们是球谐张量的分量）。为了获得[旋转不变量](@entry_id:170459)，可以构建这些系数的二次组合，即**[功率谱](@entry_id:159996) (power spectrum)**：
    $$
    p_{n n' l} = \sum_{m=-l}^{l} c_{n l m}\, c_{n' l m}^*
    $$
    根据Wigner D矩阵的[幺正性](@entry_id:138773)质，可以证明这个[功率谱](@entry_id:159996)在三维旋转下是严格不变的。由这些 $p_{n n' l}$ 元素构成的向量就是最终的[SOAP描述符](@entry_id:189760)。它系统地编码了原子环境的径向和角向信息，并天然满足所有必需的对称性。

#### 等变模型

与先构造[不变量](@entry_id:148850)再进行回归的思路不同，**等变模型 (Equivariant Models)**，特别是基于图神经网络（GNNs）的模型，在网络的每一层都保持物理上的[等变性](@entry_id:636671)。这类模型直接处理矢量的几何信息，而不是在输入端就将其抛弃。

其核心思想是 [@problem_id:2648604]：

1.  **等变特征表示**：将原子（图节点）的特征表示为不同阶的球谐张量，它们在旋转下通过Wigner D矩阵进行变换。例如，标量是0阶张量（$l=0$），矢量是1阶张量（$l=1$），更高阶的几何信息可以表示为更高阶的张量。

2.  **等变消息传递**：在消息传递步骤中，一个原子（接收者）从其邻居（发送者）接收信息。这个信息是通过将发送者的特征（类型为 $l_1$ 的张量）与连接它们的相对位置矢量（其方向可以用球谐函数 $Y_{lm}$ 表示，类型为 $l_2$）进行**[张量积](@entry_id:140694)（tensor product）**来构造的。

3.  **[张量积](@entry_id:140694)的约化**：得到的[张量积](@entry_id:140694)是一个[可约表示](@entry_id:137110)，需要通过**克莱布施-戈登系数 (Clebsch-Gordan coefficients)** 将其分解为一系列不可约表示（新的球谐张量）。这个过程保证了新生成的特征（消息）仍然具有明确的、等变的旋转性质。

4.  **对称性处理**：
    -   **[平移等变性](@entry_id:636340)**通过仅使用原子间的相对位置矢量 $\mathbf{r}_{ij} = \mathbf{r}_j - \mathbf{r}_i$ 作为几何输入来保证。
    -   **旋转[等变性](@entry_id:636671)**通过上述的张量积和约化过程在每一步都得到严格保证。
    -   **反演[等变性](@entry_id:636671)**（构成完整的E(3)群）可以通过追踪每个特征的宇称（parity）并遵守[宇称选择定则](@entry_id:203598)来处理。

最终，通过一系列等变的消息传递和更新步骤，网络可以预测出一个旋转不变的总能量（一个0阶张量）和旋转等变的力（一系列1阶张量）。这类模型因其严谨的对称性处理和对几何信息的有效利用而成为当前研究的前沿。

### 训练与高级议题

构建了模型架构后，还需要考虑如何有效地训练模型以及模型的内在局限性。

#### 基于力的训练与[可积性](@entry_id:142415)

虽然可以直接在能量上训练MLP，但包含力的信息进行训练通常能获得更高的精度和更好的泛化能力。一个至关重要的概念是**可积性（integrability）** [@problem_id:2648650]。

在物理上，[力场](@entry_id:147325)必须是**保守的（conservative）**，这意味着做功与路径无关，并且存在一个标量[势能函数](@entry_id:200753) $E$，使得力是其负梯度，即 $\mathbf{F} = -\nabla E$。一个等价的数学条件是[力场的旋度](@entry_id:174409)（curl）为零，$\nabla \times \mathbf{F} = \mathbf{0}$。

当MLP架构遵循“能量模型”（即模型直接预测标量能量 $E_\theta$，然后通过[自动微分](@entry_id:144512)获得力 $\mathbf{F}_\theta = -\nabla E_\theta$）时，可积性是**通过构造来保证的**。因为任何[标量场的梯度](@entry_id:270765)的旋度恒为零，所以这样得到的[力场](@entry_id:147325)天然是保守的。

相反，如果采用“力模型”（即直接训练一个模型来预测矢量[力场](@entry_id:147325) $\mathbf{F}_\phi$），而没有施加任何约束，那么得到的[力场](@entry_id:147325)通常是非保守的（$\nabla \times \mathbf{F}_\phi \neq \mathbf{0}$）。在微正则系综（NVE）的MD模拟中使用这样的[非保守力](@entry_id:163431)，会导致系统总能量出现系统性的漂移，即使使用高精度的辛[积分算法](@entry_id:192581)也无法避免，因为[能量守恒](@entry_id:140514)这个基本前提已经不存在了。因此，从一个标量势能推导力是保证物理一致性和模拟稳定性的关键 [@problem_id:2648650]。

#### 局域性的局限：长程相互作用

尽管[局域性原理](@entry_id:753741)是MLP成功的关键，但它也构成了其主要局限性。许多重要的物理相互作用本质上是**长程的（long-range）**，无法被一个有限的、通常只有几到十几埃的[截断半径](@entry_id:136708)所完全描述 [@problem_id:2648601]。

-   **长程静电相互作用**：离子和[极性分子](@entry_id:144673)之间的[库仑相互作用](@entry_id:747947)按 $1/r$ 衰减，其衰减速度非常慢。在周期性边界条件下的[凝聚相模拟](@entry_id:747661)中，正确处理[静电相互作用](@entry_id:166363)需要像埃瓦尔德求和（Ewald summation）这样的技术，它将相互作用分为实空间和倒易空间两部分，本质上是求解[泊松方程](@entry_id:143763)，这是一种全局计算。一个严格局域的MLP无法捕捉到这种由整个[晶格](@entry_id:196752)或模拟盒子贡献的集体效应。

-   **极化效应**：当一个分子或离子置于[电场](@entry_id:194326)中时，其[电荷分布](@entry_id:144400)会发生变化，产生[诱导偶极](@entry_id:143340)子。这个[诱导偶极](@entry_id:143340)子自身又会产生[电场](@entry_id:194326)，进而影响其他粒子。这种**多体极化效应**是自洽的、非局域的。一个粒子的[诱导偶极矩](@entry_id:262417)依赖于系统中所有其他[电荷](@entry_id:275494)和偶极子产生的[电场](@entry_id:194326)。因此，一个纯局域的模型无法描述这种贯穿整个系统的响应。

对于需要精确描述[长程相互作用](@entry_id:140725)的体系（如[离子晶体](@entry_id:138598)、水溶液、极性有机材料等），通常需要采用**[混合方法](@entry_id:163463)**：使用MLP来描述短程的、复杂的量子力学效应，同时用物理上明确的解析模型（如点电荷的埃瓦尔德求和、[色散](@entry_id:263750)修正项等）来处理长程部分 [@problem_id:2648636]。

#### 不确定性量化

机器学习模型做出的预测总是伴随着不确定性。理解和量化这种不确定性对于评估模型的可靠性、指导[主动学习](@entry_id:157812)以改进模型至关重要。在MLP的背景下，总不确定性可以分解为两种主要类型 [@problem_id:2784631]：

-   **认知不确定性 (Epistemic Uncertainty)**：也称为[模型不确定性](@entry_id:265539)或知识不确定性。它源于我们对真实[势能面](@entry_id:147441)的了解有限，因为我们只有有限的训练数据。在训练数据稀疏或缺乏的构型空间区域，多种不同的[势能面](@entry_id:147441)函数都可能与现有数据兼容，导致模型预测的高度不确定性。这种不确定性是**可以减少的**，通过增加该区域的训练数据，可以帮助模型“下定决心”。在实践中，认知不确定性通常通过模型集成（ensemble）的方法来估计，即训练多个具有不同随机初始化的模型，其预测值的[方差](@entry_id:200758)就反映了[认知不确定性](@entry_id:149866)的大小。

-   **偶然不确定性 (Aleatoric Uncertainty)**：也称为数据不确定性或内在不确定性。它代表了数据生成过程本身固有的噪声或随机性。即使我们拥有无限多的数据，这种不确定性也无法消除。在[第一性原理计算](@entry_id:198754)中，偶然[不确定性的来源](@entry_id:164809)可能包括：[量子蒙特卡洛](@entry_id:144383)（QMC）计算的[统计误差](@entry_id:755391)、[自洽场](@entry_id:136549)（SCF）迭代的收敛阈值、金属体系中[k点取样](@entry_id:177715)的不完全性等。这种噪声的大小可能依赖于原子构型本身（即[异方差性](@entry_id:136378)）。偶然不确定性通常通过让模型直接预测一个[概率分布](@entry_id:146404)的参数（例如，高斯分布的均值和[方差](@entry_id:200758)）来建模。

例如，在预测一个远离[训练集](@entry_id:636396)的过渡态结构时，**认知不确定性**可能会占主导地位。而在使用有统计噪声的QMC数据进行训练时，如果QMC的[统计误差](@entry_id:755391)很大，那么**偶然不确定性**可能成为总不确定性的主要来源 [@problem_id:2784631]。区分这两种不确定性对于构建稳健和可信的MLP至关重要。