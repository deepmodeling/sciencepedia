{"hands_on_practices": [{"introduction": "密度泛函理论的精髓在于将电子密度 $n$ 作为基本变量。为了构建密度泛函，理论家们常常从最简单的理想化模型——均匀电子气——入手。这个模型为发展最基础的局域密度近似（LDA）提供了精确的解析解。通过完成这个练习 [@problem_id:2453886]，你将亲手推导非相互作用动能 $T_s[n]$ 和交换能 $E_x[n]$ 这两个关键的能量项如何依赖于电子密度，从而深刻理解 LDA 泛函的理论基石。", "problem": "考虑一个三维均匀电子气（常称为电子胶模型 (jellium)）：在热力学极限下，大量自旋非极化的电子占据一个体积为 $V$、具有周期性边界条件的立方体盒子，其数密度为常数 $n_{0}$。在哈特里原子单位制中进行计算，即 $\\hbar=m_{e}=e=4\\pi\\varepsilon_{0}=1$。在 Kohn–Sham 密度泛函理论 (DFT) 中，无相互作用动能泛函 $T_{s}[n]$ 定义为可再现密度 $n(\\mathbf{r})$ 的无相互作用参考体系的基态动能，而交换能泛函 $E_{x}[n]$ 定义为该参考体系的福克交换能。\n\n对于均匀密度 $n(\\mathbf{r})=n_{0}$，假设自旋简并度为 $g_{s}=2$，确定 $T_{s}[n_{0}]$ 和 $E_{x}[n_{0}]$ 对 $n_{0}$ 和 $V$ 的精确依赖关系。将您的最终答案表示为一个包含两个元素的行矩阵，其中按顺序包含以哈特里原子单位表示的 $T_{s}[n_{0}]$ 和 $E_{x}[n_{0}]$。无需进行四舍五入。", "solution": "所述问题是有效的。这是一个关于均匀电子气（也称为电子胶模型 (jellium)）的固态物理和密度泛函理论中的典型问题。其前提在科学上是合理的，问题是适定的，并且提供了所有必要的信息。我们将开始求解。\n\n问题要求解出在体积 $V$ 中密度为常数 $n_0$ 的均匀电子气的无相互作用动能泛函 $T_s[n_0]$ 和交换能泛函 $E_x[n_0]$。我们在哈特里原子单位制下进行计算，其中 $\\hbar = m_e = e = 4\\pi\\varepsilon_0 = 1$。给定的自旋简并度为 $g_s=2$。\n\n首先，我们确定无相互作用动能 $T_s[n_0]$。根据定义，这是一个具有基态密度 $n_0$ 的无相互作用电子体系的动能。对于均匀气体，无相互作用参考体系就是一个无相互作用的费米子气体。基态是通过填充单粒子能级直至费米能来构建的。\n\n在体积为 $V=L^3$、具有周期性边界条件的立方体盒子中，电子的单粒子波函数是平面波：\n$$\n\\psi_{\\mathbf{k}}(\\mathbf{r}) = \\frac{1}{\\sqrt{V}} \\exp(i\\mathbf{k} \\cdot \\mathbf{r})\n$$\n相应的动能为：\n$$\n\\epsilon_{\\mathbf{k}} = \\frac{\\hbar^2 |\\mathbf{k}|^2}{2m_e} = \\frac{|\\mathbf{k}|^2}{2}\n$$\n在基态下，所有波矢模 $|\\mathbf{k}|$ 小于等于费米波矢 $k_F$ 的态都被占据。电子总数 $N$ 通过 $N = n_0 V$ 与密度 $n_0$ 相关。在热力学极限下，对离散 $\\mathbf{k}$ 态的求和可以替换为在 $\\mathbf{k}$ 空间中的积分：\n$$\n\\sum_{\\mathbf{k}} \\to V \\int \\frac{d^3\\mathbf{k}}{(2\\pi)^3}\n$$\n电子总数可以通过对 $\\mathbf{k}$ 空间中费米球的体积进行积分，再乘以自旋简并度 $g_s=2$ 来求得：\n$$\nN = g_s V \\int_{|\\mathbf{k}| \\le k_F} \\frac{d^3\\mathbf{k}}{(2\\pi)^3} = 2V \\left( \\frac{4\\pi k_F^3}{3(2\\pi)^3} \\right) = V \\frac{k_F^3}{3\\pi^2}\n$$\n由此，我们建立了密度 $n_0 = N/V$ 和费米波矢 $k_F$ 之间的关系：\n$$\nn_0 = \\frac{k_F^3}{3\\pi^2} \\implies k_F = (3\\pi^2 n_0)^{1/3}\n$$\n总的无相互作用动能 $T_s[n_0]$ 是所有被占据态的能量之和：\n$$\nT_s[n_0] = g_s \\sum_{|\\mathbf{k}| \\le k_F} \\epsilon_{\\mathbf{k}} = g_s V \\int_{|\\mathbf{k}| \\le k_F} \\frac{|\\mathbf{k}|^2}{2} \\frac{d^3\\mathbf{k}}{(2\\pi)^3}\n$$\n代入 $g_s=2$ 并在 $\\mathbf{k}$ 空间中切换到球坐标（$d^3\\mathbf{k} = 4\\pi |\\mathbf{k}|^2 d|\\mathbf{k}|$），积分变为：\n$$\nT_s[n_0] = 2 V \\frac{4\\pi}{(2\\pi)^3} \\int_0^{k_F} \\frac{k^2}{2} k^2 dk = \\frac{V}{\\pi^2} \\int_0^{k_F} \\frac{k^4}{2} dk = \\frac{V}{2\\pi^2} \\left[ \\frac{k^5}{5} \\right]_0^{k_F} = \\frac{V k_F^5}{10\\pi^2}\n$$\n最后，我们将 $k_F$ 用 $n_0$ 的表达式代入：\n$$\nT_s[n_0] = \\frac{V}{10\\pi^2} \\left[ (3\\pi^2 n_0)^{1/3} \\right]^5 = \\frac{V}{10\\pi^2} (3\\pi^2)^{5/3} n_0^{5/3} = \\frac{3^{5/3}\\pi^{10/3}}{10\\pi^2} V n_0^{5/3} = \\frac{3}{10}(3\\pi^2)^{2/3} V n_0^{5/3}\n$$\n这就是对均匀密度求值的著名 Thomas-Fermi 动能泛函。\n\n接下来，我们确定交换能 $E_x[n_0]$。对于均匀电子气，由局域密度近似 (Local Density Approximation, LDA) 给出的交换能是精确的。LDA 交换能泛函由下式给出：\n$$\nE_x^{\\text{LDA}}[n] = \\int e_x^{\\text{unif}}(n(\\mathbf{r})) d^3\\mathbf{r}\n$$\n其中 $e_x^{\\text{unif}}(n)$ 是密度为 $n$ 的均匀、自旋非极化电子气的单位体积交换能。该量的标准表达式为：\n$$\ne_x^{\\text{unif}}(n) = - C_x n^{4/3}\n$$\n其中常数 $C_x$ 由下式给出：\n$$\nC_x = \\frac{3}{4} \\left(\\frac{3}{\\pi}\\right)^{1/3}\n$$\n对于所讨论的体系，密度是恒定的，$n(\\mathbf{r}) = n_0$。因此，交换能为：\n$$\nE_x[n_0] = \\int -C_x n_0^{4/3} d^3\\mathbf{r} = -C_x n_0^{4/3} \\int d^3\\mathbf{r} = -C_x V n_0^{4/3}\n$$\n代入 $C_x$ 的表达式：\n$$\nE_x[n_0] = -\\frac{3}{4} \\left(\\frac{3}{\\pi}\\right)^{1/3} V n_0^{4/3}\n$$\n这就是均匀电子气的精确交换能。\n\n我们按要求将两个结果合并成一个行矩阵。\n第一个元素是 $T_s[n_0] = \\frac{3}{10}(3\\pi^2)^{2/3} V n_0^{5/3}$。\n第二个元素是 $E_x[n_0] = -\\frac{3}{4}(\\frac{3}{\\pi})^{1/3} V n_0^{4/3}$。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{3}{10}(3\\pi^{2})^{2/3} V n_{0}^{5/3}  - \\frac{3}{4} \\left(\\frac{3}{\\pi}\\right)^{1/3} V n_{0}^{4/3} \\end{pmatrix}}\n$$", "id": "2453886"}, {"introduction": "尽管近似的密度泛函在实践中非常强大，但理解其内在的局限性对于进行可靠的科学研究至关重要。一个常见的病态问题是离域误差（delocalization error），它源于近似泛函对分数电子数系统行为的错误描述。这个练习 [@problem_id:2768061] 引入了精确泛函必须满足的分数电荷能量分段线性条件，并通过一个简洁而深刻的理论模型，让你定量分析一个泛函偏离此线性行为的程度，从而揭示离域误差的根源。", "problem": "考虑在密度泛函理论（DFT）框架下一个被拉伸、有效解离的双原子分子 $A\\!-\\!B$。根据Hohenberg–Kohn定理和分数粒子数的系综变分原理，作为电子数 $N$ 的函数，精确的基态能量 $E(N)$ 在相邻整数之间是分段线性的。在解离极限下，这意味着对于一个可以驻留在碎片 $A$ 或 $B$ 上的额外电子，其精确能量是两个整数电荷态之间的直线插值，并且与分数电荷如何在碎片之间分布无关。\n\n相比之下，诸如广义梯度近似（GGA）之类的半局域近似通常会表现出离域误差，具体表现为 $E(N)$ 对分段线性的凸偏离。为了以一种最小且具有物理动机的方式对此进行建模，假设当一个额外的电子以分数占据数 $q \\in [0,1]$ 分布在碎片 $A$ 上（以及 $1-q$ 在碎片 $B$ 上）时，该额外电子的碎片分辨GGA能量贡献为\n$$\nE_{i}(N_{i}) \\;=\\; E_{i}(0) \\;+\\; \\mu_{i}\\,N_{i} \\;-\\; \\frac{\\kappa}{2}\\,N_{i}\\left(1-N_{i}\\right), \\quad i\\in\\{A,B\\},\n$$\n其中 $N_{A}=q$ 且 $N_{B}=1-q$，$\\mu_{i}$ 是碎片化学势（位能参数），它设定了对电子增加的线性响应，而 $\\kappa0$ 是一个曲率参数，表征了GGA典型的凸偏离。该额外电子的总GGA能量是 $E_{\\text{GGA}}(q)=E_{A}(q)+E_{B}(1-q)$ 的和。\n\n将半占据时的分段线性偏离定义为\n$$\n\\Delta_{\\text{PL}} \\;=\\; E_{\\text{GGA}}\\!\\left(\\tfrac{1}{2}\\right) \\;-\\; \\frac{1}{2}\\Big(E_{\\text{GGA}}(0) + E_{\\text{GGA}}(1)\\Big).\n$$\n\n从系综变分原理和上述 $E_{i}(N_{i})$ 模型出发，推导一个仅用 $\\kappa$ 表示的 $\\Delta_{\\text{PL}}$ 的显式闭合表达式。能量以哈特里（Hartree）为单位。您的最终答案必须是单一的解析表达式。不需要四舍五入。", "solution": "该问题要求为密度泛函理论（DFT）中离域误差的一个模型推导分段线性偏离 $\\Delta_{\\text{PL}}$ 的显式表达式。该偏离定义为\n$$\n\\Delta_{\\text{PL}} \\;=\\; E_{\\text{GGA}}\\!\\left(\\frac{1}{2}\\right) \\;-\\; \\frac{1}{2}\\Big(E_{\\text{GGA}}(0) + E_{\\text{GGA}}(1)\\Big).\n$$\n总能量 $E_{\\text{GGA}}(q)$ 是具有分数电子占据数 $N_{A}=q$ 的碎片 $A$ 和具有占据数 $N_{B}=1-q$ 的碎片 $B$ 的能量之和。问题给出了每个碎片 $i \\in \\{A, B\\}$ 的能量模型为\n$$\nE_{i}(N_{i}) \\;=\\; E_{i}(0) \\;+\\; \\mu_{i}\\,N_{i} \\;-\\; \\frac{\\kappa}{2}\\,N_{i}\\left(1-N_{i}\\right).\n$$\n我们的第一步是构建总能量 $E_{\\text{GGA}}(q)$ 的表达式。\n根据定义，$E_{\\text{GGA}}(q) = E_{A}(N_{A}) + E_{B}(N_{B})$，其中 $N_{A}=q$ 且 $N_{B}=1-q$。\n代入每个碎片的给定模型：\n$$\nE_{A}(q) \\;=\\; E_{A}(0) \\;+\\; \\mu_{A}\\,q \\;-\\; \\frac{\\kappa}{2}\\,q(1-q)\n$$\n$$\nE_{B}(1-q) \\;=\\; E_{B}(0) \\;+\\; \\mu_{B}(1-q) \\;-\\; \\frac{\\kappa}{2}(1-q)\\big(1-(1-q)\\big) \\;=\\; E_{B}(0) \\;+\\; \\mu_{B}(1-q) \\;-\\; \\frac{\\kappa}{2}(1-q)q\n$$\n将这两个贡献相加得到总能量：\n$$\nE_{\\text{GGA}}(q) \\;=\\; \\left( E_{A}(0) + \\mu_{A}\\,q - \\frac{\\kappa}{2}\\,q(1-q) \\right) + \\left( E_{B}(0) + \\mu_{B}(1-q) - \\frac{\\kappa}{2}\\,q(1-q) \\right)\n$$\n$$\nE_{\\text{GGA}}(q) \\;=\\; E_{A}(0) + E_{B}(0) + \\mu_{A}\\,q + \\mu_{B}(1-q) - \\kappa\\,q(1-q)\n$$\n该表达式描述了系统的能量作为电荷分布参数 $q$ 的函数。为了计算 $\\Delta_{\\text{PL}}$，我们必须在 $q=0$、$q=1$ 和 $q=\\frac{1}{2}$ 处计算 $E_{\\text{GGA}}(q)$ 的值。\n\n对于 $q=0$，额外的电子完全在碎片 $B$ 上：\n$$\nE_{\\text{GGA}}(0) \\;=\\; E_{A}(0) + E_{B}(0) + \\mu_{A}(0) + \\mu_{B}(1-0) - \\kappa(0)(1-0) \\;=\\; E_{A}(0) + E_{B}(0) + \\mu_{B}\n$$\n\n对于 $q=1$，额外的电子完全在碎片 $A$ 上：\n$$\nE_{\\text{GGA}}(1) \\;=\\; E_{A}(0) + E_{B}(0) + \\mu_{A}(1) + \\mu_{B}(1-1) - \\kappa(1)(1-1) \\;=\\; E_{A}(0) + E_{B}(0) + \\mu_{A}\n$$\n这两个值代表了整数电荷态的能量。项 $\\frac{1}{2}\\Big(E_{\\text{GGA}}(0) + E_{\\text{GGA}}(1)\\Big)$ 是这些态之间在中间点 $q=\\frac{1}{2}$ 处的直线插值的值。\n$$\n\\frac{1}{2}\\Big(E_{\\text{GGA}}(0) + E_{\\text{GGA}}(1)\\Big) \\;=\\; \\frac{1}{2}\\Big( (E_{A}(0) + E_{B}(0) + \\mu_{B}) + (E_{A}(0) + E_{B}(0) + \\mu_{A}) \\Big)\n$$\n$$\n\\frac{1}{2}\\Big(E_{\\text{GGA}}(0) + E_{\\text{GGA}}(1)\\Big) \\;=\\; E_{A}(0) + E_{B}(0) + \\frac{1}{2}(\\mu_{A} + \\mu_{B})\n$$\n\n接下来，我们计算半离域情况 $q=\\frac{1}{2}$ 的能量：\n$$\nE_{\\text{GGA}}\\!\\left(\\frac{1}{2}\\right) \\;=\\; E_{A}(0) + E_{B}(0) + \\mu_{A}\\left(\\frac{1}{2}\\right) + \\mu_{B}\\left(1-\\frac{1}{2}\\right) - \\kappa\\left(\\frac{1}{2}\\right)\\left(1-\\frac{1}{2}\\right)\n$$\n$$\nE_{\\text{GGA}}\\!\\left(\\frac{1}{2}\\right) \\;=\\; E_{A}(0) + E_{B}(0) + \\frac{1}{2}\\mu_{A} + \\frac{1}{2}\\mu_{B} - \\kappa\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\n$$\n$$\nE_{\\text{GGA}}\\!\\left(\\frac{1}{2}\\right) \\;=\\; E_{A}(0) + E_{B}(0) + \\frac{1}{2}(\\mu_{A} + \\mu_{B}) - \\frac{\\kappa}{4}\n$$\n最后，我们将这些表达式代回 $\\Delta_{\\text{PL}}$ 的定义中。\n$$\n\\Delta_{\\text{PL}} \\;=\\; E_{\\text{GGA}}\\!\\left(\\frac{1}{2}\\right) \\;-\\; \\frac{1}{2}\\Big(E_{\\text{GGA}}(0) + E_{\\text{GGA}}(1)\\Big)\n$$\n$$\n\\Delta_{\\text{PL}} \\;=\\; \\left( E_{A}(0) + E_{B}(0) + \\frac{1}{2}(\\mu_{A} + \\mu_{B}) - \\frac{\\kappa}{4} \\right) - \\left( E_{A}(0) + E_{B}(0) + \\frac{1}{2}(\\mu_{A} + \\mu_{B}) \\right)\n$$\n项 $E_{A}(0)$、$E_{B}(0)$ 和 $\\frac{1}{2}(\\mu_{A} + \\mu_{B})$ 相互抵消，留下一个仅依赖于曲率参数 $\\kappa$ 的简单表达式。\n$$\n\\Delta_{\\text{PL}} \\;=\\; -\\frac{\\kappa}{4}\n$$\n这个结果与单个碎片的性质 $\\mu_{A}$、$\\mu_{B}$、$E_{A}(0)$ 和 $E_{B}(0)$ 无关，因为这些参数定义了能量曲线的线性部分。量 $\\Delta_{\\text{PL}}$ 衡量了非线性程度，在本模型中它完全由 $\\kappa$ 决定。由于给定 $\\kappa0$，偏离 $\\Delta_{\\text{PL}}$ 是负的，这是凸函数的数学特征，正确地表示了在近似DFT中离域态的伪稳定化。", "answer": "$$\n\\boxed{-\\frac{\\kappa}{4}}\n$$", "id": "2768061"}, {"introduction": "密度泛函理论的优雅与计算化学的实际挑战在自洽场（SCF）迭代过程中交汇。简单地迭代求解 Kohn-Sham 方程往往会导致数值不稳定，使得计算无法收敛。这个练习 [@problem_id:2768007] 深入探讨了实现收敛的数值技巧，通过推导并应用迭代子空间中的直接翻转（DIIS）方法——一种广泛用于加速收敛的算法，让你掌握从理论原理到高效计算实践的关键桥梁。", "problem": "考虑 Kohn–Sham 密度泛函理论中关于基态电子密度的不动点问题，其表述为寻找一个密度 $n(\\mathbf{r})$ 满足 $n(\\mathbf{r}) = \\mathcal{F}[n](\\mathbf{r})$，其中 $\\mathcal{F}$ 是 Kohn–Sham 映射，它将输入密度映射到在该输入密度产生的有效势下，通过求解单粒子 Kohn–Sham 方程得到的输出密度。设与试探密度 $n$ 相关的残差为 $r[n](\\mathbf{r}) = \\mathcal{F}[n](\\mathbf{r}) - n(\\mathbf{r})$。在离散化表示中，将残差写为向量 $r \\in \\mathbb{R}^{N}$，并假设一个对称正定预处理器 $M \\in \\mathbb{R}^{N \\times N}$ 定义了加权内积 $\\langle x, y \\rangle_{M} = x^{\\mathsf{T}} M y$ 和诱导范数 $\\|x\\|_{M} = \\sqrt{x^{\\mathsf{T}} M x}$。\n\n给定一组过去的试探密度 $\\{n_{i}\\}_{i=1}^{k}$ 及其相关的残差 $\\{r_{i}\\}_{i=1}^{k}$，我们希望构造一个外推密度 $n^{\\ast} = \\sum_{i=1}^{k} c_{i} n_{i}$，其系数满足仿射约束 $\\sum_{i=1}^{k} c_{i} = 1$。假设残差在该子空间上是局部仿射的，因此 $r[n^{\\ast}] \\approx \\sum_{i=1}^{k} c_{i} r_{i}$。\n\n任务：\n- 在不引用任何黑箱公式的情况下，从基本层面上简要解释预处理（通过 $M$ 起作用）和 Pulay/迭代子空间直接求逆 (DIIS) 加速如何改善自洽场 (SCF) 的收敛性。\n- 仅从不动点表述、残差的定义以及上述 $M$-加权范数出发，建立并推导出一阶最优性条件。这些条件是针对系数向量 $c = (c_{1},\\dots,c_{k})^{\\mathsf{T}}$ 的，该向量在约束 $\\sum_{i=1}^{k} c_{i} = 1$ 下最小化 $\\| \\sum_{i=1}^{k} c_{i} r_{i} \\|_{M}^{2}$。你的推导应得出 $c$ 关于 $\\{r_{i}\\}$ 和 $M$ 的闭式表达式。\n\n现在特化到 $k=2$ 的情况，在一个二维离散化中，有\n$$\nr_{1} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}, \\quad\nr_{2} = \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}, \\quad\nM = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}.\n$$\n计算 DIIS 系数 $c_{1}$ 和 $c_{2}$，它们在仿射约束下最小化外推残差的 $M$-范数。将你的最终答案表示为单个行向量 $(c_{1}\\; c_{2})$，并使用精确形式。不要四舍五入。", "solution": "所提出的问题是适定的，有科学依据的，并包含了完整解答所需的所有信息。我们将着手进行分析。\n\n自洽场 (SCF) 过程旨在解决一个非线性不动点问题，在 Kohn-Sham 密度泛函理论的背景下，即 $n(\\mathbf{r}) = \\mathcal{F}[n](\\mathbf{r})$。简单的迭代替换，即所谓的简单混合法，通常无法收敛。这种失败通常是由于所谓的电荷振荡（charge sloshing）引起的，即电子密度在迭代过程中在系统的不同区域之间不稳定地振荡。在数学上，这对应于映射 $\\mathcal{F}$ 的雅可比矩阵具有模大于1的特征值，导致误差分量被放大。\n\n迭代子空间直接求逆 (DIIS) 方法，也称为 Pulay 混合法，提供了一种稳健的补救措施。它是一种外推技术，而不是简单的混合方案。DIIS 不仅仅使用最后一次迭代的结果，而是考虑了 $k$ 个先前试探密度 $\\{n_i\\}$ 及其相关残差 $\\{r_i\\}$ 的历史记录。其核心假设是残差映射在由这些迭代向量张成的子空间上是近似仿射的。然后，DIIS 通过寻找一组系数 $\\{c_i\\}$ 来构造一个新的试探密度 $n^{\\ast} = \\sum_{i=1}^{k} c_{i} n_{i}$，这组系数在归一化约束 $\\sum_{i=1}^{k} c_i = 1$ 下，最小化相应的外推残差 $\\sum_{i=1}^{k} c_{i} r_{i}$ 的范数。该过程在密度的仿射子空间中寻找一个点，该点最接近满足不动点条件 $r[n]=\\mathcal{F}[n]-n=0$。通过从历史记录中构建这个“最佳”猜测，DIIS 能有效地识别并抑制困扰简单方法的振荡误差模式，从而带来显著改善的、通常是超线性的收敛。\n\n预处理解决了这样一个事实：并非残差向量的所有分量对收敛都同等重要。标准的欧几里得范数同等对待所有分量，这在物理上是朴素的。在许多系统，特别是大型或非均匀系统中，存在收敛非常缓慢的电荷涨落“软”模式（例如长波变化）。预处理器 $M$ 是一个对称正定矩阵，用于定义加权范数 $\\|r\\|_M^2 = r^{\\mathsf{T}} M r$。一个精心选择的预处理器能近似系统静态介电矩阵的逆或残差映射的雅可比矩阵。通过最小化残差的 $M$-加权范数，DIIS 过程更加侧重于抑制物理上最软、最棘手的误差模式，从而加速误差中最持久分量的收敛。\n\n我们现在推导最优系数 $c_i$ 的表达式。问题是在约束 $\\sum_{i=1}^{k} c_{i} = 1$ 下最小化目标函数 $f(c) = \\| \\sum_{i=1}^{k} c_{i} r_{i} \\|_{M}^{2}$。设 $c$ 为系数的列向量 $(c_1, \\dots, c_k)^{\\mathsf{T}}$，设 $R$ 是一个 $N \\times k$ 矩阵，其列是残差向量 $\\{r_i\\}_{i=1}^k$。残差的线性组合可以写为 $Rc$。\n\n目标函数为\n$$f(c) = (Rc)^{\\mathsf{T}} M (Rc) = c^{\\mathsf{T}} (R^{\\mathsf{T}} M R) c$$\n我们定义 $k \\times k$ 矩阵 $B = R^{\\mathsf{T}} M R$。该矩阵的元素由 $B_{ij} = r_i^{\\mathsf{T}} M r_j = \\langle r_i, r_j \\rangle_M$ 给出。约束可以写为 $\\mathbf{1}^{\\mathsf{T}} c = 1$，其中 $\\mathbf{1}$ 是一个全为1的 $k \\times 1$ 列向量。\n\n我们使用拉格朗日乘子法来解决这个约束优化问题。拉格朗日函数是：\n$$\\mathcal{L}(c, \\lambda) = c^{\\mathsf{T}} B c - \\lambda (\\mathbf{1}^{\\mathsf{T}} c - 1)$$\n通过将关于 $c$ 和 $\\lambda$ 的梯度设为零，可以找到一阶最优性条件。\n关于向量 $c$ 的梯度是：\n$$\\nabla_c \\mathcal{L} = 2Bc - \\lambda\\mathbf{1} = 0$$\n这得到 $2Bc = \\lambda\\mathbf{1}$。由于 $M$ 是正定的，并且我们假设向量 $\\{r_i\\}$ 是线性无关的，因此矩阵 $B$ 也是正定的，因而是可逆的。所以我们可以写出：\n$$c = \\frac{\\lambda}{2} B^{-1} \\mathbf{1}$$\n对 $\\lambda$ 的导数只是恢复了约束条件：\n$$\\frac{\\partial \\mathcal{L}}{\\partial \\lambda} = -(\\mathbf{1}^{\\mathsf{T}} c - 1) = 0 \\implies \\mathbf{1}^{\\mathsf{T}} c = 1$$\n将 $c$ 的表达式代入约束方程，我们可以求出拉格朗日乘子：\n$$\\mathbf{1}^{\\mathsf{T}} \\left( \\frac{\\lambda}{2} B^{-1} \\mathbf{1} \\right) = 1$$\n$$\\frac{\\lambda}{2} (\\mathbf{1}^{\\mathsf{T}} B^{-1} \\mathbf{1}) = 1 \\implies \\frac{\\lambda}{2} = \\frac{1}{\\mathbf{1}^{\\mathsf{T}} B^{-1} \\mathbf{1}}$$\n最后，我们将 $\\frac{\\lambda}{2}$ 的这个表达式代回 $c$ 的方程中：\n$$c = \\frac{B^{-1} \\mathbf{1}}{\\mathbf{1}^{\\mathsf{T}} B^{-1} \\mathbf{1}}$$\n这就是最优 DIIS 系数的闭式表达式。\n\n现在，我们特化到给定的 $k=2$ 的情况：\n$$\nr_{1} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}, \\quad\nr_{2} = \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}, \\quad\nM = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}\n$$\n首先，我们计算 $2 \\times 2$ 矩阵 $B$ 的元素：\n$$B_{11} = r_1^{\\mathsf{T}} M r_1 = \\begin{pmatrix} 1  2 \\end{pmatrix} \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} 2  2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = (2)(1) + (2)(2) = 6$$\n$$B_{12} = r_1^{\\mathsf{T}} M r_2 = \\begin{pmatrix} 1  2 \\end{pmatrix} \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 2  2 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} = (2)(-1) + (2)(1) = 0$$\n$$B_{21} = r_2^{\\mathsf{T}} M r_1 = B_{12} = 0 \\text{ (根据对称性)}$$\n$$B_{22} = r_2^{\\mathsf{T}} M r_2 = \\begin{pmatrix} -1  1 \\end{pmatrix} \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} -2  1 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} = (-2)(-1) + (1)(1) = 3$$\n矩阵 $B$ 是：\n$$B = \\begin{pmatrix} 6  0 \\\\ 0  3 \\end{pmatrix}$$\n它的逆矩阵很容易计算：\n$$B^{-1} = \\begin{pmatrix} \\frac{1}{6}  0 \\\\ 0  \\frac{1}{3} \\end{pmatrix}$$\n我们现在应用推导出的公式计算 $c = (c_1, c_2)^{\\mathsf{T}}$，其中 $\\mathbf{1} = (1, 1)^{\\mathsf{T}}$。\n首先，计算分子 $B^{-1} \\mathbf{1}$：\n$$B^{-1} \\mathbf{1} = \\begin{pmatrix} \\frac{1}{6}  0 \\\\ 0  \\frac{1}{3} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{6} \\\\ \\frac{1}{3} \\end{pmatrix}$$\n接下来，计算分母 $\\mathbf{1}^{\\mathsf{T}} B^{-1} \\mathbf{1}$：\n$$\\mathbf{1}^{\\mathsf{T}} B^{-1} \\mathbf{1} = \\begin{pmatrix} 1  1 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{6} \\\\ \\frac{1}{3} \\end{pmatrix} = \\frac{1}{6} + \\frac{1}{3} = \\frac{1}{6} + \\frac{2}{6} = \\frac{3}{6} = \\frac{1}{2}$$\n于是系数向量 $c$ 为：\n$$c = \\frac{\\begin{pmatrix} \\frac{1}{6} \\\\ \\frac{1}{3} \\end{pmatrix}}{\\frac{1}{2}} = 2 \\begin{pmatrix} \\frac{1}{6} \\\\ \\frac{1}{3} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{3} \\\\ \\frac{2}{3} \\end{pmatrix}$$\n因此，最优系数为 $c_1 = \\frac{1}{3}$ 和 $c_2 = \\frac{2}{3}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{3}  \\frac{2}{3}\n\\end{pmatrix}\n}\n$$", "id": "2768007"}]}