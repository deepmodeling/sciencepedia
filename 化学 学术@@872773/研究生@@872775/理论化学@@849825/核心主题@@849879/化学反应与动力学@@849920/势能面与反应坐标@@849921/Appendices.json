{"hands_on_practices": [{"introduction": "理解化学反应动力学的第一步是分析势能面的拓扑结构。这个练习将从最简单的一维双势阱模型入手，通过计算势能函数的一阶和二阶导数来定位过渡态。这个过程将引出过渡态的一个关键特征——虚频率——它代表了沿反应坐标的不稳定运动模式[@problem_id:2952096]。掌握这种基本分析是处理更复杂多维势能面的必要前提。", "problem": "考虑一个一维反应坐标 $q$，其处于一个由四次函数 $V(q)=a q^{4}-b q^{2}$（其中 $a0$ 且 $b0$）描述的对称双势阱势能面上。令 $m$ 表示与沿反应坐标 $q$ 的运动相关联的恒定有效质量。沿反应坐标的过渡态（也称为鞍点）被定义为 $V(q)$ 的一个驻点，在该点处沿 $q$ 方向的曲率为负。从驻点的定义和牛顿第二定律 $m\\,d^{2}q/dt^{2}=-\\,dV/dq$ 出发，并利用 $V(q)$ 在过渡态坐标 $q^{\\ddagger}$ 附近的二阶泰勒展开，确定坐标 $q^{\\ddagger}$ 以及表征过渡态附近不稳定模式的相应虚角频率 $\\omega^{\\ddagger}$。请将最终答案表示为单行向量 $\\big(q^{\\ddagger},\\,\\omega^{\\ddagger}\\big)$ 的形式，仅使用 $a$、$b$ 和 $m$ 的符号形式表达，并省略单位。不要包含任何数值近似。", "solution": "所述问题是有效的。这是一个经典力学和物理化学中的适定问题，基于势能面上反应动力学的标准理论框架。所有术语都得到了明确定义，并提供了足够的信息来推导出唯一解。\n\n势能面 $V(q)$ 由一维四次函数给出：\n$$V(q) = a q^{4} - b q^{2}$$\n其中 $a  0$ 且 $b  0$。这些参数确保了这是一个对称双势阱，其两个极小值点被一个能垒隔开。\n\n首先，我们必须确定势的驻点。驻点是力（即势的梯度）为零的位置。我们计算 $V(q)$ 对反应坐标 $q$ 的一阶导数，并令其为零：\n$$\\frac{dV}{dq} = \\frac{d}{dq}(a q^{4} - b q^{2}) = 4 a q^{3} - 2 b q$$\n令 $\\frac{dV}{dq} = 0$：\n$$4 a q^{3} - 2 b q = 0$$\n$$2q(2aq^2 - b) = 0$$\n该方程给出了驻点坐标的三个解：\n$$q = 0$$\n和\n$$q^{2} = \\frac{b}{2a} \\implies q = \\pm\\sqrt{\\frac{b}{2a}}$$\n\n接下来，我们必须通过考察这些驻点上势的曲率来区分极小值点（稳态）和过渡态（鞍点）。曲率由二阶导数 $V''(q)$ 给出。\n$$V''(q) = \\frac{d^{2}V}{dq^{2}} = \\frac{d}{dq}(4 a q^{3} - 2 b q) = 12 a q^{2} - 2 b$$\n我们计算 $V''(q)$ 在每个驻点的值：\n1.  对于 $q=0$：\n    $$V''(0) = 12 a (0)^{2} - 2 b = -2b$$\n    由于 $b  0$，曲率 $V''(0)$ 为负。根据定义，沿反应坐标曲率为负的驻点即为过渡态。因此，过渡态的坐标为 $q^{\\ddagger} = 0$。\n\n2.  对于 $q = \\pm\\sqrt{\\frac{b}{2a}}$：\n    $$V''\\left(\\pm\\sqrt{\\frac{b}{2a}}\\right) = 12 a \\left(\\frac{b}{2a}\\right) - 2b = 6b - 2b = 4b$$\n    由于 $b  0$，曲率为正。这些点对应于势能极小值点。\n\n在确定了过渡态坐标为 $q^{\\ddagger}=0$ 后，我们现在来确定该点附近运动的特征频率。一个有效质量为 $m$ 的粒子沿坐标 $q$ 的运动方程由牛顿第二定律给出：\n$$m \\frac{d^{2}q}{dt^{2}} = -\\frac{dV}{dq}$$\n在过渡态 $q^{\\ddagger}$ 附近，我们可以使用围绕 $q^{\\ddagger}$ 的二阶泰勒级数展开来近似势 $V(q)$：\n$$V(q) \\approx V(q^{\\ddagger}) + \\frac{dV}{dq}\\bigg|_{q=q^{\\ddagger}}(q-q^{\\ddagger}) + \\frac{1}{2}\\frac{d^{2}V}{dq^{2}}\\bigg|_{q=q^{\\ddagger}}(q-q^{\\ddagger})^{2}$$\n在驻点处，$\\frac{dV}{dq}\\big|_{q=q^{\\ddagger}} = 0$。令 $\\delta q = q - q^{\\ddagger}$。势变为：\n$$V(q) \\approx V(q^{\\ddagger}) + \\frac{1}{2}V''(q^{\\ddagger})(\\delta q)^{2}$$\n那么，过渡态附近的力为：\n$$-\\frac{dV}{dq} \\approx -V''(q^{\\ddagger})(\\delta q)$$\n将此力代入运动方程：\n$$m \\frac{d^{2}(\\delta q)}{dt^{2}} = -V''(q^{\\ddagger})(\\delta q)$$\n这可以重写为：\n$$\\frac{d^{2}(\\delta q)}{dt^{2}} + \\left(\\frac{V''(q^{\\ddagger})}{m}\\right)(\\delta q) = 0$$\n这是振子方程的标准形式 $\\frac{d^{2}x}{dt^{2}} + \\omega^{2}x = 0$，其中角频率的平方为 $\\omega^{2} = \\frac{V''(q^{\\ddagger})}{m}$。\n在过渡态 $q^{\\ddagger}=0$ 处，我们得到 $V''(0) = -2b$。代入该值：\n$$(\\omega^{\\ddagger})^{2} = \\frac{-2b}{m}$$\n因此，角频率 $\\omega^{\\ddagger}$ 是虚数，这是鞍点处不稳定模式的特征，表示从过渡态的指数发散，而非稳定振荡。\n$$\\omega^{\\ddagger} = \\sqrt{\\frac{-2b}{m}} = i\\sqrt{\\frac{2b}{m}}$$\n其中 $i$ 是虚数单位。\n\n问题要求坐标 $q^{\\ddagger}$ 和虚角频率 $\\omega^{\\ddagger}$。我们已经求得：\n$$q^{\\ddagger} = 0$$\n$$\\omega^{\\ddagger} = i\\sqrt{\\frac{2b}{m}}$$\n最终答案以单行向量的形式呈现。", "answer": "$$ \\boxed{ \\begin{pmatrix} 0  i\\sqrt{\\frac{2b}{m}} \\end{pmatrix} } $$", "id": "2952096"}, {"introduction": "在理论上理解了过渡态的定义之后，一个核心的实践问题是如何在复杂的高维势能面上通过计算找到它。这个练习将深入探讨“爬山微动弹性带”(CI-NEB)方法的内部机制，这是一种广泛用于定位反应路径和过渡态的算法。通过将势能梯度分解为平行和垂直于路径切线的两个分量，你将推导出驱动最高能量“构象珠”精确收敛到鞍点的特定力学规则[@problem_id:2661533]。这个练习将理论概念与计算实践联系起来，让你亲身体验寻找过渡态的强大数值方法。", "problem": "考虑一个定义在无量纲内坐标 $\\mathbf{R} = (x, y)$ 上的二维势能面 (PES)，由标量函数 $V(x,y)$ 定义。反应路径的链态表示使用一组离散的图像 $\\{\\mathbf{R}_i\\}$，这些图像通过人工弹簧连接，以保持沿路径大致均匀的间距。微动弹性带 (NEB) 方法通过将来自势能面的真实力与沿路径切线的弹簧力相结合，同时投影垂直于路径的真实力，从而使这些图像收敛到最小能量路径 (MEP) 上。爬山图像 NEB (CI-NEB) 改进方法从能量最高的图像中移除了弹簧力，并反转了沿路径切线的真实力的符号，从而使该图像能够攀升至鞍点，同时仍然沿垂直于路径的方向下降。\n\n任务 A (推导)：从标量函数 $V(\\mathbf{R})$ 上的最速下降基本原理出发，以及将任意向量 $\\mathbf{a}$ 分解为平行和垂直于给定单位向量 $\\hat{\\boldsymbol{\\tau}}$ 的分量，\n$$\n\\mathbf{a}^{\\parallel} = (\\mathbf{a}\\cdot\\hat{\\boldsymbol{\\tau}})\\,\\hat{\\boldsymbol{\\tau}}, \\quad \\mathbf{a}^{\\perp} = \\mathbf{a} - \\mathbf{a}^{\\parallel},\n$$\n推导能量最高图像 $k$ 的显式爬山图像 NEB 更新规则，用势能面梯度 $\\nabla V(\\mathbf{R}_k)$ 和在图像 $k$ 处沿离散路径定义的单位切线 $\\hat{\\boldsymbol{\\tau}}_k$ 来表示。您的推导应清楚地说明力的平行和垂直分量是如何处理的。\n\n任务 B (解析单步更新)：考虑无量纲势能面\n$$\nV(x,y) = \\left(x^2 - 1\\right)^2 + 2\\,y^2,\n$$\n以及一条具有三个图像的离散路径，\n$$\n\\mathbf{R}_0 = (-1,\\,0), \\quad \\mathbf{R}_1 = \\left(\\tfrac{1}{2},\\,\\tfrac{1}{3}\\right), \\quad \\mathbf{R}_2 = (1,\\,0).\n$$\n将内部图像 $\\mathbf{R}_1$ 视为爬山图像。使用内部图像处单位切线的对称有限差分定义，\n$$\n\\hat{\\boldsymbol{\\tau}}_1 = \\frac{\\mathbf{R}_2 - \\mathbf{R}_0}{\\left\\lVert \\mathbf{R}_2 - \\mathbf{R}_0 \\right\\rVert},\n$$\n并使用您在任务 A 中推导的爬山图像 NEB 更新规则，以步长 $\\alpha = \\tfrac{1}{6}$ 执行一次显式最速下降更新步骤：\n$$\n\\mathbf{R}_1^{\\text{new}} = \\mathbf{R}_1 + \\alpha\\,\\mathbf{F}^{\\text{CI}}_1,\n$$\n其中 $\\mathbf{F}^{\\text{CI}}_1$ 是您推导的爬山图像 NEB 力。将最终更新的坐标表示为精确的有理数。无需四舍五入。将最终答案报告为一个包含 $x_{\\text{new}}$ 和 $y_{\\text{new}}$（按此顺序）的 $1\\times 2$ 行向量。坐标是无量纲的，因此不需要物理单位。", "solution": "所提出的问题是计算物理化学中的一个有效练习，测试了爬山图像微动弹性带 (CI-NEB) 力的概念推导及其实际应用。该问题陈述清晰，科学上合理，并包含了唯一解所需的所有信息。\n\n首先，我们处理任务 A：推导爬山图像的 CI-NEB 更新规则。对于势能面 $V(\\mathbf{R})$ 上的任何图像，在最速下降协议下的目标是沿着真实力 $\\mathbf{F}_{\\text{true}}$ 的方向移动，该力定义为势的负梯度：\n$$\n\\mathbf{F}_{\\text{true}}(\\mathbf{R}) = -\\nabla V(\\mathbf{R})\n$$\n标准的微动弹性带 (NEB) 方法修改此力以找到最小能量路径 (MEP)。对于图像 $\\mathbf{R}_k$，这涉及投影掉平行于路径的真实力分量和垂直于路径的弹簧力分量。目的是防止图像向下滑动并保持均匀间距。\n\n爬山图像改进方法，CI-NEB，对能量最高的图像（此处指定为图像 $k$）应用一种特殊的力规则。该图像的目标不是沿着 MEP，而是沿着 MEP 攀升至鞍点的精确位置。根据问题描述，这通过对力配方的两项修改来实现：\n$1$. 完全移除爬山图像的弹簧力。这是合乎逻辑的，因为我们不再关心它相对于其邻居的间距，而只关心它相对于势能面的位置。\n$2$. 平行于路径切线 $\\hat{\\boldsymbol{\\tau}}_k$ 的真实力分量被反转。这迫使图像沿路径方向“上坡”移动。垂直于路径的真实力分量被保留，确保图像继续在所有其他方向上“下坡”弛豫，从而停留在 MEP 上。\n\n我们通过将真实力 $\\mathbf{F}_{\\text{true}}(\\mathbf{R}_k)$ 分解为相对于局部单位路径切线 $\\hat{\\boldsymbol{\\tau}}_k$ 的平行和垂直分量来将其形式化。使用所提供的投影公式：\n$$\n\\mathbf{F}_{\\text{true}}^{\\parallel} = (\\mathbf{F}_{\\text{true}}(\\mathbf{R}_k) \\cdot \\hat{\\boldsymbol{\\tau}}_k) \\hat{\\boldsymbol{\\tau}}_k\n$$\n$$\n\\mathbf{F}_{\\text{true}}^{\\perp} = \\mathbf{F}_{\\text{true}}(\\mathbf{R}_k) - \\mathbf{F}_{\\text{true}}^{\\parallel}\n$$\nCI-NEB 力 $\\mathbf{F}_k^{\\text{CI}}$ 是通过反转平行分量并加上原始的垂直分量来构造的：\n$$\n\\mathbf{F}_k^{\\text{CI}} = -\\mathbf{F}_{\\text{true}}^{\\parallel} + \\mathbf{F}_{\\text{true}}^{\\perp}\n$$\n代入 $\\mathbf{F}_{\\text{true}}^{\\perp}$ 的表达式：\n$$\n\\mathbf{F}_k^{\\text{CI}} = -\\mathbf{F}_{\\text{true}}^{\\parallel} + (\\mathbf{F}_{\\text{true}}(\\mathbf{R}_k) - \\mathbf{F}_{\\text{true}}^{\\parallel}) = \\mathbf{F}_{\\text{true}}(\\mathbf{R}_k) - 2\\mathbf{F}_{\\text{true}}^{\\parallel}\n$$\n现在，代入真实力及其平行分量关于势梯度 $\\nabla V(\\mathbf{R}_k)$ 的定义：\n$$\n\\mathbf{F}_k^{\\text{CI}} = -\\nabla V(\\mathbf{R}_k) - 2 \\left( (-\\nabla V(\\mathbf{R}_k)) \\cdot \\hat{\\boldsymbol{\\tau}}_k \\right) \\hat{\\boldsymbol{\\tau}}_k\n$$\n这简化为爬山图像力的最终表达式：\n$$\n\\mathbf{F}_k^{\\text{CI}} = -\\nabla V(\\mathbf{R}_k) + 2 (\\nabla V(\\mathbf{R}_k) \\cdot \\hat{\\boldsymbol{\\tau}}_k) \\hat{\\boldsymbol{\\tau}}_k\n$$\n这个推导出的力引导图像沿着切线 $\\hat{\\boldsymbol{\\tau}}_k$ 向上移动势能梯度，同时引导它在垂直于 $\\hat{\\boldsymbol{\\tau}}_k$ 的空间中沿着梯度向下移动。\n\n接下来，我们处理任务 B：将此公式应用于单步更新。给定的势能面是：\n$$\nV(x,y) = \\left(x^2 - 1\\right)^2 + 2\\,y^2\n$$\n路径由三个图像定义：$\\mathbf{R}_0 = (-1,\\,0)$、$\\mathbf{R}_1 = \\left(\\frac{1}{2},\\,\\frac{1}{3}\\right)$ 和 $\\mathbf{R}_2 = (1,\\,0)$。图像 $\\mathbf{R}_1$ 被指定为爬山图像。\n\n首先，我们使用所提供的对称有限差分公式计算爬山图像处的单位切向量 $\\hat{\\boldsymbol{\\tau}}_1$：\n$$\n\\hat{\\boldsymbol{\\tau}}_1 = \\frac{\\mathbf{R}_2 - \\mathbf{R}_0}{\\left\\lVert \\mathbf{R}_2 - \\mathbf{R}_0 \\right\\rVert}\n$$\n向量差为 $\\mathbf{R}_2 - \\mathbf{R}_0 = (1 - (-1), 0 - 0) = (2, 0)$。\n该向量的范数为 $\\left\\lVert (2, 0) \\right\\rVert = \\sqrt{2^2 + 0^2} = 2$。\n因此，单位切线为 $\\hat{\\boldsymbol{\\tau}}_1 = \\frac{(2, 0)}{2} = (1, 0)$。它是正 $x$ 方向的单位向量。\n\n其次，我们计算势的梯度 $\\nabla V(x,y)$：\n$$\n\\frac{\\partial V}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ (x^2 - 1)^2 + 2y^2 \\right] = 2(x^2 - 1)(2x) = 4x^3 - 4x\n$$\n$$\n\\frac{\\partial V}{\\partial y} = \\frac{\\partial}{\\partial y} \\left[ (x^2 - 1)^2 + 2y^2 \\right] = 4y\n$$\n所以，$\\nabla V(x,y) = (4x^3 - 4x, 4y)$。\n\n第三，我们计算在爬山图像位置 $\\mathbf{R}_1 = \\left(\\frac{1}{2}, \\frac{1}{3}\\right)$ 处的梯度：\n$$\n\\nabla V(\\mathbf{R}_1) = \\left( 4\\left(\\frac{1}{2}\\right)^3 - 4\\left(\\frac{1}{2}\\right), 4\\left(\\frac{1}{3}\\right) \\right) = \\left( 4\\left(\\frac{1}{8}\\right) - 2, \\frac{4}{3} \\right) = \\left( \\frac{1}{2} - 2, \\frac{4}{3} \\right) = \\left( -\\frac{3}{2}, \\frac{4}{3} \\right)\n$$\n\n第四，我们使用推导出的爬山图像力 $\\mathbf{F}_1^{\\text{CI}}$ 的公式：\n$$\n\\mathbf{F}_1^{\\text{CI}} = -\\nabla V(\\mathbf{R}_1) + 2 (\\nabla V(\\mathbf{R}_1) \\cdot \\hat{\\boldsymbol{\\tau}}_1) \\hat{\\boldsymbol{\\tau}}_1\n$$\n我们需要点积 $\\nabla V(\\mathbf{R}_1) \\cdot \\hat{\\boldsymbol{\\tau}}_1$：\n$$\n\\left( -\\frac{3}{2}, \\frac{4}{3} \\right) \\cdot (1, 0) = -\\frac{3}{2}\n$$\n现在我们组装力向量：\n$$\n\\mathbf{F}_1^{\\text{CI}} = -\\left( -\\frac{3}{2}, \\frac{4}{3} \\right) + 2 \\left( -\\frac{3}{2} \\right) (1, 0)\n$$\n$$\n\\mathbf{F}_1^{\\text{CI}} = \\left( \\frac{3}{2}, -\\frac{4}{3} \\right) - 3 (1, 0) = \\left( \\frac{3}{2}, -\\frac{4}{3} \\right) - (3, 0)\n$$\n$$\n\\mathbf{F}_1^{\\text{CI}} = \\left( \\frac{3}{2} - 3, -\\frac{4}{3} - 0 \\right) = \\left( -\\frac{3}{2}, -\\frac{4}{3} \\right)\n$$\n\n最后，我们使用给定的步长 $\\alpha = \\frac{1}{6}$ 对 $\\mathbf{R}_1$ 执行最速下降更新：\n$$\n\\mathbf{R}_1^{\\text{new}} = \\mathbf{R}_1 + \\alpha\\,\\mathbf{F}^{\\text{CI}}_1\n$$\n$$\n\\mathbf{R}_1^{\\text{new}} = \\left(\\frac{1}{2}, \\frac{1}{3}\\right) + \\frac{1}{6} \\left( -\\frac{3}{2}, -\\frac{4}{3} \\right)\n$$\n$$\n\\mathbf{R}_1^{\\text{new}} = \\left(\\frac{1}{2}, \\frac{1}{3}\\right) + \\left( -\\frac{3}{12}, -\\frac{4}{18} \\right) = \\left(\\frac{1}{2}, \\frac{1}{3}\\right) + \\left( -\\frac{1}{4}, -\\frac{2}{9} \\right)\n$$\n我们分别计算新坐标：\n$$\nx_{\\text{new}} = \\frac{1}{2} - \\frac{1}{4} = \\frac{2}{4} - \\frac{1}{4} = \\frac{1}{4}\n$$\n$$\ny_{\\text{new}} = \\frac{1}{3} - \\frac{2}{9} = \\frac{3}{9} - \\frac{2}{9} = \\frac{1}{9}\n$$\n爬山图像的更新坐标为 $\\mathbf{R}_1^{\\text{new}} = \\left(\\frac{1}{4}, \\frac{1}{9}\\right)$。结果必须以 $1\\times 2$ 行向量的形式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{4}  \\frac{1}{9}\n\\end{pmatrix}\n}\n$$", "id": "2661533"}, {"introduction": "将一个复杂的化学反应简化为一个或几个“反应坐标”是理论化学中的常用策略，但我们如何定量地评估一个给定坐标的优劣呢？本练习介绍了一种源于信息论的强大方法，通过计算候选反应坐标 $\\xi$ 与反应结果 $r$（反应性或非反应性）之间的互信息 $I(\\xi; r)$ 来解决此问题。这个练习要求你编写程序，利用非参数方法从模拟数据中估计互信息，从而让你掌握一种前沿的、数据驱动的工具来验证和比较不同的反应坐标模型[@problem_id:2796786]。", "problem": "给定一个从分子动力学轨迹快照中提取的标量候选反应坐标 $\\xi$ 和一个二元指示符 $r \\in \\{0,1\\}$，该指示符表示轨迹是反应性的（$r=1$）还是非反应性的（$r=0$）。请从第一性原理出发，编写一个程序来估计候选坐标 $\\xi$ 和反应性 $r$ 之间的互信息 $I(\\xi; r)$，以此作为 $\\xi$ 作为反应坐标的充分性的定量度量。请使用自然对数，以便所有信息量都以奈特（nats）为单位表示。\n\n您的算法必须从互信息基于熵的定义出发，并从数据中估计条件结构，而不对分布作参数形式的假设。为使估计器具有鲁棒性且由数据驱动，请实现一种非参数方法，该方法通过对邻近样本进行平滑平均来处理给定坐标下的反应性条件概率，并使用“留一法”机制来减轻过拟合。边际二元熵必须根据反应性标签的观测频率进行估计。\n\n您的程序必须为每个提供的测试用例计算 $I(\\xi; r)$，并返回一个浮点数列表（单位为奈特）。所有对数都必须是自然对数。最终报告的数字必须四舍五入到六位小数。\n\n测试套件规范（通过固定随机种子实现完全确定性）。使用单个共享数据集 $(\\{x_i\\}_{i=1}^N, \\{r_i\\}_{i=1}^N)$ 来定义 $r$，然后评估四个不同的候选坐标 $\\xi$：\n\n- 全局参数：\n  - 样本数量 $N = 2000$。\n  - 随机种子 $s = 12345$。\n  - 基础潜在坐标 $x_i \\sim \\mathcal{N}(0,1)$，对于 $i \\in \\{1,\\dots,N\\}$ 独立。\n  - 反应概率 $\\pi_i = \\left(1 + \\exp\\left(-\\beta x_i - b\\right)\\right)^{-1}$，其中 $\\beta = 5.0$ 且 $b = 0.0$。\n  - 二元反应性 $r_i \\sim \\mathrm{Bernoulli}(\\pi_i)$，以 $x_i$ 为条件独立。\n- 待评估的候选坐标：\n  1. 情况A（信息性）：$\\xi^{(A)}_i = x_i$。\n  2. 情况B（带噪声的信息性）：$\\xi^{(B)}_i = x_i + \\sigma \\eta_i$，其中 $\\eta_i \\sim \\mathcal{N}(0,1)$ 与所有其他变量独立，且 $\\sigma = 0.7$。\n  3. 情况C（独立）：$\\xi^{(C)}_i = z_i$，其中 $z_i \\sim \\mathcal{N}(0,1)$ 与 $(x_i, r_i)$ 独立。\n  4. 情况D（退化）：对所有 $i$，$\\xi^{(D)}_i = 0$。\n\n为确保普适的可复现性，估计器设计约束如下：\n- 从标量坐标和二元标签之间互信息的基于熵的定义出发，并将其简化，以分离出以坐标为条件的二元熵项。\n- 根据样本比例 $\\hat{p} = \\frac{1}{N}\\sum_{i=1}^N r_i$ 估计 $r$ 的边际二元熵。\n- 通过对在观测值 $\\xi_i$ 处评估的条件概率 $\\mathbb{P}(r=1 \\mid \\xi=x)$ 进行平滑、数据驱动的近似，来估计条件二元熵。使用“留一法”核平均，其中高斯核为 $K(u) = \\exp\\left(-\\frac{1}{2}u^2\\right)$，带宽 $h$ 由规则 $h = 1.06 \\, s_\\xi \\, N^{-1/5}$ 设定，其中 $s_\\xi$ 是 $\\{\\xi_i\\}$ 的样本标准差。如果 $s_\\xi = 0$，则使用 $h = 1.0$。对于每个 $i$，通过对 $j \\neq i$ 进行加权平均来近似 $\\mathbb{P}(r=1 \\mid \\xi=\\xi_i)$，权重与 $K\\!\\left(\\frac{\\xi_i - \\xi_j}{h}\\right)$成正比，然后将在这些概率上计算出的二元熵在所有 $i$ 上取平均，以近似条件熵。为避免数值问题，将概率裁剪到开区间 $(\\varepsilon, 1-\\varepsilon)$ 内，其中 $\\varepsilon = 10^{-12}$。\n- 通过将最终互信息估计中的负值（如果因数值误差而出现）替换为 $0$ 来强制其非负性。\n- 所有对数计算必须以 $e$ 为底，以便互信息以奈特为单位。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，顺序为 $\\left[I\\!\\left(\\xi^{(A)}; r\\right), I\\!\\left(\\xi^{(B)}; r\\right), I\\!\\left(\\xi^{(C)}; r\\right), I\\!\\left(\\xi^{(D)}; r\\right)\\right]$，每个条目四舍五入到六位小数（例如，$\\left[0.693147,0.350000,0.000100,0.000000\\right]$）。单位是奈特。\n\n您的解决方案必须是一个完整的、可运行的程序，该程序按规定生成数据集（使用给定的随机种子），根据上述估计器约束计算四个互信息值，并严格按照要求的格式打印结果。", "solution": "该问题要求估计标量候选反应坐标 $\\xi$ 与二元反应性指示符 $r \\in \\{0, 1\\}$ 之间的互信息 $I(\\xi; r)$。该估计必须从给定数据集中以非参数方式执行。\n\n两个随机变量（在此为 $\\xi$ 和 $r$）之间互信息的基本定义是：在已知一个变量的情况下，另一个变量不确定性的减少量。用香农熵表示为：\n$$\nI(\\xi; r) = H(r) - H(r \\mid \\xi)\n$$\n其中 $H(r)$ 是反应性 $r$ 的边际熵，$H(r \\mid \\xi)$ 是给定坐标 $\\xi$ 时 $r$ 的条件熵。所有信息论量均使用自然对数计算，因此单位为奈特（nats）。\n\n我们将通过从提供的数据 $\\{(\\xi_i, r_i)\\}_{i=1}^N$ 中估计右侧的每一项来构建 $I(\\xi; r)$ 的估计器。\n\n首先，我们估计边际熵 $H(r)$。变量 $r$ 服从参数为 $p = \\mathbb{P}(r=1)$ 的伯努利分布。该分布的熵为：\n$$\nH(r) = -p \\ln(p) - (1-p) \\ln(1-p)\n$$\n我们使用反应性轨迹的样本频率 $\\hat{p}$ 来估计概率 $p$：\n$$\n\\hat{p} = \\frac{1}{N} \\sum_{i=1}^N r_i\n$$\n边际熵的估计器 $\\hat{H}(r)$ 则为：\n$$\n\\hat{H}(r) = -\\hat{p} \\ln(\\hat{p}) - (1-\\hat{p}) \\ln(1-\\hat{p})\n$$\n如果 $\\hat{p}=0$ 或 $\\hat{p}=1$，熵恰好为 $0$。\n\n其次，我们估计条件熵 $H(r \\mid \\xi)$。根据定义，这是以 $\\xi$ 的特定值为条件的 $r$ 的熵的期望值：\n$$\nH(r \\mid \\xi) = \\mathbb{E}_{\\xi} \\left[ H(r \\mid \\xi=x) \\right]\n$$\n内部项 $H(r \\mid \\xi=x)$ 是参数为 $p(x) = \\mathbb{P}(r=1 \\mid \\xi=x)$ 的伯努利分布的熵。我们用观测数据点 $\\{\\xi_i\\}_{i=1}^N$ 上的样本均值来近似对 $\\xi$ 的期望：\n$$\n\\hat{H}(r \\mid \\xi) = \\frac{1}{N} \\sum_{i=1}^N \\hat{H}(r \\mid \\xi=\\xi_i)\n$$\n为了计算这个值，我们需要为每个数据点 $i$ 估计条件概率 $p_i = p(\\xi_i) = \\mathbb{P}(r=1 \\mid \\xi=\\xi_i)$。问题指定了一个非参数的、“留一法”核平均（Nadaraya-Watson）估计器。对于每个点 $\\xi_i$，条件概率 $\\hat{p}_i$ 通过所有其他点 $j \\ne i$ 的反应性 $r_j$ 的加权平均来估计：\n$$\n\\hat{p}_i = \\frac{\\sum_{j \\ne i} K\\left(\\frac{\\xi_i - \\xi_j}{h}\\right) r_j}{\\sum_{j \\ne i} K\\left(\\frac{\\xi_i - \\xi_j}{h}\\right)}\n$$\n核函数 $K(u)$ 是标准高斯核，$K(u) = \\exp\\left(-\\frac{1}{2}u^2\\right)$。带宽 $h$ 控制估计的平滑度，由 Silverman 经验法则确定：\n$$\nh = 1.06 \\, s_\\xi \\, N^{-1/5}\n$$\n其中 $s_\\xi$ 是坐标值 $\\{\\xi_i\\}_{i=1}^N$ 的样本标准差，计算时除数为 $N-1$。如果 $s_\\xi = 0$，则使用固定带宽 $h=1.0$。这种情况发生在退化坐标 $\\xi^{(D)}$。\n\n利用每个点的估计值 $\\hat{p}_i$，每个点的条件熵贡献计算如下：\n$$\n\\hat{H}(r \\mid \\xi=\\xi_i) = -\\hat{p}_i \\ln(\\hat{p}_i) - (1-\\hat{p}_i) \\ln(1-\\hat{p}_i)\n$$\n为防止因 $\\ln(0)$ 引起的数值不稳定性，估计的概率 $\\hat{p}_i$ 被裁剪到区间 $[\\varepsilon, 1-\\varepsilon]$ 内，其中 $\\varepsilon = 10^{-12}$。这些值的平均值给出了最终估计 $\\hat{H}(r \\mid \\xi)$。\n\n最后，互信息的估计器为：\n$$\n\\hat{I}(\\xi; r) = \\hat{H}(r) - \\hat{H}(r \\mid \\xi)\n$$\n由于数值近似误差，该值可能略为负。由于互信息根据定义必须为非负，最终估计通过取 $\\max(0, \\hat{I}(\\xi; r))$ 进行校正。\n\n算法流程如下：\n1.  生成一个包含 $N=2000$ 个样本的基础数据集。这包括生成一个潜在坐标 $x_i \\sim \\mathcal{N}(0,1)$，通过一个 logistic 函数（其中 $\\beta=5.0, b=0.0$）计算反应概率 $\\pi_i$，并采样二元反应性 $r_i \\sim \\mathrm{Bernoulli}(\\pi_i)$。通过固定随机种子使该过程具有确定性。\n2.  从此基础数据集构建四个候选坐标：\n    - 情况 A（信息性）：$\\xi^{(A)}_i = x_i$。\n    - 情况 B（带噪声）：$\\xi^{(B)}_i = x_i + 0.7 \\eta_i$，其中 $\\eta_i \\sim \\mathcal{N}(0,1)$。\n    - 情况 C（非信息性）：$\\xi^{(C)}_i = z_i$，其中 $z_i \\sim \\mathcal{N}(0,1)$。\n    - 情况 D（退化）：$\\xi^{(D)}_i = 0$。\n3.  对于四个坐标 $(\\xi, r)$ 中的每一个，应用上述互信息估计过程。\n4.  收集四个得到的互信息值，四舍五入到六位小数，并以要求的格式呈现。\n\n该方法提供了一种鲁棒的、数据驱动的方式来量化和比较不同标量变量预测二元结果的能力，这是分子模拟分析中的常见任务。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Generates data, evaluates four candidate reaction coordinates by estimating\n    their mutual information with reactivity, and prints the results.\n    \"\"\"\n    # Global parameters for data generation\n    N = 2000\n    s = 12345\n    beta = 5.0\n    b = 0.0\n    sigma = 0.7  # For noisy coordinate\n    epsilon = 1e-12 # For clipping probabilities\n\n    # --- Data Generation ---\n    # Fix the random seed for reproducibility\n    rng = np.random.default_rng(s)\n    \n    # Generate latent coordinate and reactivity\n    # x_i ~ N(0,1)\n    x = rng.normal(loc=0.0, scale=1.0, size=N)\n    \n    # pi_i = (1 + exp(-beta * x_i - b))^-1\n    pi = 1.0 / (1.0 + np.exp(-beta * x - b))\n    \n    # r_i ~ Bernoulli(pi_i)\n    r = rng.binomial(1, pi, size=N)\n\n    # --- Candidate Coordinates ---\n    # Case A: Informative\n    xi_A = x\n    # Case B: Noisy informative\n    eta = rng.normal(loc=0.0, scale=1.0, size=N)\n    xi_B = x + sigma * eta\n    # Case C: Independent\n    z = rng.normal(loc=0.0, scale=1.0, size=N)\n    xi_C = z\n    # Case D: Degenerate\n    xi_D = np.zeros(N)\n\n    candidate_coordinates = [xi_A, xi_B, xi_C, xi_D]\n    results = []\n\n    def estimate_mi(xi, r):\n        \"\"\"\n        Estimates the mutual information I(xi; r) using a nonparametric\n        leave-one-out kernel density estimator.\n        \"\"\"\n        n_samples = len(r)\n\n        # 1. Estimate marginal entropy H(r)\n        p_hat = np.mean(r)\n        if p_hat == 0.0 or p_hat == 1.0:\n            h_r = 0.0\n        else:\n            h_r = -p_hat * np.log(p_hat) - (1.0 - p_hat) * np.log(1.0 - p_hat)\n\n        # 2. Estimate conditional entropy H(r|xi)\n        # 2a. Calculate bandwidth h\n        # Use sample standard deviation (ddof=1) as is standard for statistical estimation\n        s_xi = np.std(xi, ddof=1)\n        if s_xi == 0.0:\n            h = 1.0\n        else:\n            h = 1.06 * s_xi * (n_samples ** -0.2)\n\n        # 2b. Calculate conditional probabilities p(r=1|xi) using leave-one-out\n        #     Nadaraya-Watson estimator in vectorized form.\n        # Create a pairwise distance matrix (xi_i - xi_j)\n        diff_matrix = xi[:, np.newaxis] - xi[np.newaxis, :]\n        \n        # Compute Gaussian kernel on these distances\n        kernel_matrix = np.exp(-0.5 * (diff_matrix / h) ** 2)\n        \n        # Apply leave-one-out by setting diagonal to zero\n        np.fill_diagonal(kernel_matrix, 0.0)\n        \n        # Calculate numerator and denominator for all points\n        numerator = kernel_matrix @ r\n        denominator = np.sum(kernel_matrix, axis=1)\n        \n        # Initialize conditional probabilities with the marginal mean as a fallback\n        p_cond = np.full(n_samples, p_hat)\n        \n        # Compute conditional probability where denominator is non-zero\n        valid_mask = denominator  epsilon\n        p_cond[valid_mask] = numerator[valid_mask] / denominator[valid_mask]\n\n        # 2c. Clip probabilities for numerical stability\n        p_cond_clipped = np.clip(p_cond, epsilon, 1.0 - epsilon)\n\n        # 2d. Calculate entropy for each conditional distribution\n        h_cond_per_point = -p_cond_clipped * np.log(p_cond_clipped) - \\\n                           (1.0 - p_cond_clipped) * np.log(1.0 - p_cond_clipped)\n        \n        # 2e. Average over all points to get H(r|xi)\n        h_r_given_xi = np.mean(h_cond_per_point)\n\n        # 3. Calculate Mutual Information I(xi; r) = H(r) - H(r|xi)\n        mi = h_r - h_r_given_xi\n        \n        # Enforce non-negativity\n        return max(0.0, mi)\n\n    for xi in candidate_coordinates:\n        mi_val = estimate_mi(xi, r)\n        results.append(mi_val)\n\n    # Format output as specified, rounding to 6 decimal places with fixed format.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2796786"}]}