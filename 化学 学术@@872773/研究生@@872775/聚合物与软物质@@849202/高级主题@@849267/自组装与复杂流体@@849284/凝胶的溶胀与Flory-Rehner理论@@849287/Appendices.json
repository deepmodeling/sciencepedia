{"hands_on_practices": [{"introduction": "Flory-Rehner 理论的核心在于混合自由能与网络弹性自由能之间的平衡。这个练习旨在通过一个实际的计算问题，加深我们对这一核心平衡的理解。通过将抽象的 Flory-Huggins 相互作用参数 $\\chi$ 与更具物理直观性的溶解度参数 $\\delta$ 联系起来，我们不仅可以预测凝胶在不同溶剂中的溶胀行为，还能练习在高溶胀极限下进行渐近分析的关键技巧 ([@problem_id:2930303])。", "problem": "将一个轻度交联的不可压缩聚合物网络分别与两种不同的纯溶剂（标记为溶剂1和溶剂2）接触，使其达到溶胀平衡。该聚合物是各向同性的，其链统计服从高斯分布，且有限延伸性可以忽略。溶剂浴压力为环境压力，且不施加外部渗透压。设$T$表示绝对温度，$R$表示普适气体常数。设$\\nu_{e}$为单位干聚合物体积内弹性活性网络链的有效数密度。两种溶剂的摩尔体积相同，均为$v_{s}$。聚合物的溶解度参数为$\\delta_{p}$，而两种溶剂的溶解度参数分别为$\\delta_{1}$和$\\delta_{2}$。假设溶剂$i$的Flory–Huggins相互作用参数可由下式估算\n$$\n\\chi_{i} \\approx \\frac{v_{s}}{R T}\\left(\\delta_{p}-\\delta_{i}\\right)^{2}, \\quad i \\in \\{1,2\\}.\n$$\n在体积不可压缩可加性的假设下，将在溶胀凝胶中的聚合物体积分数定义为$\\phi$，将平衡体积溶胀比定义为$Q^{\\ast} \\equiv \\phi^{-1}$。\n\n从Flory–Huggins混合自由能和高斯网络弹性自由能出发，基于凝胶中溶剂化学势与纯溶剂库中溶剂化学势相等的条件，施加平衡条件。在高溶胀极限 $\\phi \\ll 1$ 的情况下，系统地推导出在溶剂$i$中平衡聚合物体积分数$\\phi_{i}^{\\ast}$的主导阶标度形式，并由此获得平衡溶胀比之比$Q_{1}^{\\ast}/Q_{2}^{\\ast}$关于$\\delta_{p}$、$\\delta_{1}$、$\\delta_{2}$、$v_{s}$、$R$和$T$的解析表达式。\n\n以$Q_{1}^{\\ast}/Q_{2}^{\\ast}$的单个闭式表达式的形式给出您的最终结果。请勿代入任何数值。最终答案以无单位形式表示。", "solution": "合适的基本出发点是不可压缩各向同性凝胶的Flory–Huggins混合自由能与高斯网络弹性自由能之和。设$V$为溶胀凝胶体积，$V_{0}$为干聚合物体积。聚合物体积分数为$\\phi = V_{0}/V$（不可压缩性），溶胀比为$Q = V/V_{0} = \\phi^{-1}$。\n\n对于长链聚合物溶液（其中聚合物平动熵可忽略不计），混合对无量纲渗透压（相对于$R T$）的贡献由经过充分检验的Flory–Huggins形式给出\n$$\n\\frac{\\Pi_{\\mathrm{mix}}}{R T} = -\\frac{1}{v_{s}}\\left[\\ln\\left(1-\\phi\\right)+\\phi+\\chi\\,\\phi^{2}\\right],\n$$\n其中$\\chi$是Flory–Huggins相互作用参数。对于主拉伸比为$\\lambda$的各向同性形变，高斯网络弹性给出的弹性自由能密度为$f_{\\mathrm{el}} = \\frac{1}{2} R T \\nu_{e}\\left(\\lambda^{2}+\\lambda^{2}+\\lambda^{2}-3-2\\ln \\lambda^{3}\\right)$，并且在不可压缩性和仿射形变的条件下，$\\lambda$和$\\phi$之间的关系为$\\lambda = (V/V_{0})^{1/3} = \\phi^{-1/3}$。相应的弹性对渗透压的贡献为\n$$\n\\frac{\\Pi_{\\mathrm{el}}}{R T} = -\\nu_{e}\\left(\\phi^{1/3}-\\frac{\\phi}{2}\\right).\n$$\n在环境压力下与纯溶剂库达到平衡时，总渗透压为零，即$\\Pi_{\\mathrm{mix}}+\\Pi_{\\mathrm{el}} = 0$。两边乘以$v_{s}$并重新整理，Flory–Rehner平衡条件可写为\n$$\n\\ln\\left(1-\\phi\\right)+\\phi+\\chi\\,\\phi^{2} + \\nu_{e} v_{s}\\left(\\phi^{1/3}-\\frac{\\phi}{2}\\right) = 0.\n$$\n我们现在在高溶胀极限 $\\phi \\ll 1$ 下分析这个隐式方程。将对数项展开至二阶：$\\ln(1-\\phi) = -\\phi - \\phi^{2}/2 + \\mathcal{O}(\\phi^{3})$。代入平衡条件并在小$\\phi$下保留主导项，得到\n$$\n\\left(-\\phi - \\frac{\\phi^{2}}{2}\\right) + \\phi + \\chi\\,\\phi^{2} + \\nu_{e} v_{s}\\left(\\phi^{1/3} - \\frac{\\phi}{2}\\right) \\approx 0.\n$$\n$\\phi$的线性项相互抵消，在剩余项中，对于足够小的$\\phi$，弹性项$\\nu_{e} v_{s}\\,\\phi^{1/3}$远大于$\\nu_{e} v_{s}\\,(\\phi/2)$。因此，主导阶的平衡关系为\n$$\n\\left(\\chi - \\frac{1}{2}\\right)\\phi^{2} + \\nu_{e} v_{s}\\,\\phi^{1/3} \\approx 0.\n$$\n对于良溶剂，$\\chi  1/2$，因此我们重新整理得到\n$$\n\\nu_{e} v_{s}\\,\\phi^{1/3} \\approx \\left(\\frac{1}{2} - \\chi\\right)\\phi^{2},\n$$\n化简为\n$$\n\\phi^{5/3} \\approx \\frac{\\nu_{e} v_{s}}{\\frac{1}{2} - \\chi}.\n$$\n因此，主导阶的平衡聚合物体积分数为\n$$\n\\phi^{\\ast} \\approx \\left(\\frac{\\nu_{e} v_{s}}{\\frac{1}{2} - \\chi}\\right)^{3/5},\n$$\n以及相应的平衡溶胀比为\n$$\nQ^{\\ast} = \\phi^{\\ast\\, -1} \\approx \\left(\\frac{\\frac{1}{2} - \\chi}{\\nu_{e} v_{s}}\\right)^{3/5}.\n$$\n对于两种溶剂，$v_{s}$、$\\nu_{e}$和$T$均相同，但相互作用参数$\\chi_{1}$和$\\chi_{2}$不同，其平衡溶胀比之比为\n$$\n\\frac{Q_{1}^{\\ast}}{Q_{2}^{\\ast}} \\approx \\left(\\frac{\\frac{1}{2} - \\chi_{1}}{\\frac{1}{2} - \\chi_{2}}\\right)^{3/5}.\n$$\n引用所述的关于Flory–Huggins相互作用参数的溶解度参数估算式，\n$$\n\\chi_{i} \\approx \\frac{v_{s}}{R T}\\left(\\delta_{p}-\\delta_{i}\\right)^{2}, \\quad i \\in \\{1,2\\},\n$$\n我们将其代入该比值，得到所需的闭式表达式：\n$$\n\\frac{Q_{1}^{\\ast}}{Q_{2}^{\\ast}} \\approx \\left[\\frac{\\frac{1}{2} - \\frac{v_{s}}{R T}\\left(\\delta_{p}-\\delta_{1}\\right)^{2}}{\\frac{1}{2} - \\frac{v_{s}}{R T}\\left(\\delta_{p}-\\delta_{2}\\right)^{2}}\\right]^{3/5}.\n$$\n该表达式表明，在其他条件相同的情况下，溶解度参数更接近聚合物的溶剂（这使得$(\\delta_{p}-\\delta_{i})^{2}$更小，从而$\\chi_{i}$更小）会产生更大的因子$\\frac{1}{2}-\\chi_{i}$，因此在这种高溶胀极限下，会得到更大的平衡溶胀比$Q_{i}^{\\ast}$。", "answer": "$$\\boxed{\\left[\\dfrac{\\tfrac{1}{2}-\\dfrac{v_{s}}{R T}\\left(\\delta_{p}-\\delta_{1}\\right)^{2}}{\\tfrac{1}{2}-\\dfrac{v_{s}}{R T}\\left(\\delta_{p}-\\delta_{2}\\right)^{2}}\\right]^{\\tfrac{3}{5}}}$$", "id": "2930303"}, {"introduction": "许多先进的软材料，尤其是在生物医学领域中的水凝胶，都是对环境（如 pH 值）敏感的聚电解质。对于这类系统，经典 Flory-Rehner 理论需要扩展才能准确描述其行为。本练习引导我们从基本原理出发，将唐南（Donnan）平衡的静电效应和酸碱解离的化学平衡整合到热力学框架中，从而构建一个更全面的模型 ([@problem_id:2930238])。通过编写程序来求解由此产生的非线性耦合方程，你将获得处理复杂多物理场问题的宝贵实践经验。", "problem": "考虑一个带有单质子酸基团的化学交联弱聚电解质凝胶，其可根据反应 $\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^+ + \\mathrm{A}^-$ 解离。该网络在恒定的温度和压力下，与一个含有对称单价盐和水的大型水库处于平衡状态。假设理想混合，并忽略除静电和化学平衡之外的特定离子效应。使用以下基本依据：\n\n1. 凝胶内部的电中性：单位凝胶体积内所有电荷的总和必须为零。如果 $z_i$ 和 $c_i^{\\mathrm{in}}$ 分别表示凝胶内可移动离子种类 $i$ 的价态和浓度，且由网络引起的固定电荷密度为 $-c_f$（负号是因为去质子化的酸基团是阴离子），则 $\\sum_i z_i c_i^{\\mathrm{in}} - c_f = 0$。\n\n2. 单价离子的 Donnan 分配：凝胶边界两侧的电化学势相等意味着 $c_i^{\\mathrm{in}} = c_i^{\\mathrm{res}} \\exp(-z_i \\psi_D)$，其中 $\\psi_D \\equiv e \\Delta \\psi/(k_{\\mathrm{B}} T)$ 是无量纲的 Donnan 电势，$e$ 是元电荷，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是温度，$c_i^{\\mathrm{res}}$ 是水库中的浓度。\n\n3. 束缚基团的酸解离（以浓度近似活度的 Henderson-Hasselbalch 方程）：电离度 $\\alpha$ 满足 $\\alpha/(1-\\alpha) = K_a/[ \\mathrm{H}^+]_{\\mathrm{in}}$，其中 $K_a$ 是酸解离常数，$[\\mathrm{H}^+]_{\\mathrm{in}}$ 是凝胶内的氢离子浓度。\n\n4. 水库中水的自电离：$K_w = [\\mathrm{H}^+]_{\\mathrm{res}} [\\mathrm{OH}^-]_{\\mathrm{res}}$，其中 $K_w$ 是水的离子积，水库中的 pH 值为 $pH_{\\mathrm{res}} = -\\log_{10} [\\mathrm{H}^+]_{\\mathrm{res}}$。\n\n5. 由网络引起的固定电荷密度：如果每单位干聚合物体积的可滴定酸位点的摩尔浓度为 $C_A^{\\mathrm{dry}}$（单位为 $\\mathrm{mol/L_{polymer}}$），凝胶内的聚合物体积分数为 $\\phi$（无量纲），则每单位凝胶体积的电离固定电荷浓度为 $c_f = \\alpha \\, C_A^{\\mathrm{dry}} \\, \\phi$。\n\n假设对称单价盐在水库中的浓度为 $c_s$（单位为 $\\mathrm{mol/L}$）。令 $[\\mathrm{H}^+]_{\\mathrm{res}} = 10^{-pH_{\\mathrm{res}}}$，$[\\mathrm{OH}^-]_{\\mathrm{res}} = K_w / [\\mathrm{H}^+]_{\\mathrm{res}}$，并使用 Donnan 关系式 $[\\mathrm{H}^+]_{\\mathrm{in}} = [\\mathrm{H}^+]_{\\mathrm{res}} \\exp(-\\psi_D)$ 和 $[\\mathrm{OH}^-]_{\\mathrm{in}} = [\\mathrm{OH}^-]_{\\mathrm{res}} \\exp(+\\psi_D)$。对于盐离子，$c_+^{\\mathrm{in}} = c_s \\exp(-\\psi_D)$ 且 $c_-^{\\mathrm{in}} = c_s \\exp(+\\psi_D)$。将这些与电中性条件和酸解离关系式结合，以获得一个关于 $\\psi_D$ 的非线性标量方程，该方程通过 $[\\mathrm{H}^+]_{\\mathrm{in}}$ 与 $\\alpha$ 耦合。自洽地求解此方程，以得到作为 $pH_{\\mathrm{res}}$ 和 $\\phi$ 函数的 $\\alpha$。\n\n实现一个程序，对下面的每个测试用例，通过求解上述方程计算电离度 $\\alpha$。使用以下常数和单位：\n\n- 所有浓度（包括 $K_a$、$c_s$、$C_A^{\\mathrm{dry}}$）必须以 $\\mathrm{mol/L}$ 表示。\n- 聚合物体积分数 $\\phi$ 是无量纲的。\n- 水库酸度 $pH_{\\mathrm{res}}$ 是无量纲的十进对数值。\n- 使用 $K_w = 10^{-14}$，单位为 $\\mathrm{(mol/L)^2}$（对应于标准环境条件）。\n- Donnan 因子 $\\psi_D$ 如上定义，是无量纲的；您的算法可以直接使用 $\\psi_D$ 和指数玻尔兹曼因子。\n\n您的程序必须使用一个稳健的区间求根方法来求解 $\\psi_D$，然后计算 $\\alpha = 1/(1 + [\\mathrm{H}^+]_{\\mathrm{in}}/K_a)$，其中 $[\\mathrm{H}^+]_{\\mathrm{in}} = 10^{-pH_{\\mathrm{res}}} \\exp(-\\psi_D)$。为了数值稳定性，您应该将 $\\psi_D$ 界定在一个有限区间内，以保证电中性函数的符号会发生变化。\n\n测试套件（每个元组为 $(K_a, pH_{\\mathrm{res}}, c_s, \\phi, C_A^{\\mathrm{dry}})$，单位均如上所述）：\n- 案例 A（一般情况）：$(10^{-5}, 7.0, 0.1, 0.05, 10.0)$\n- 案例 B（无外加盐）：$(10^{-5}, 7.0, 0.0, 0.05, 10.0)$\n- 案例 C（酸性水库）：$(10^{-6}, 3.0, 0.1, 0.05, 10.0)$\n- 案例 D（碱性水库，稀凝胶）：$(10^{-4}, 10.0, 0.01, 0.01, 10.0)$\n- 案例 E（高聚合物分数，较低位点密度）：$(10^{-5}, 7.0, 0.1, 0.3, 8.0)$\n\n要求的最终输出：\n- 对于每个测试用例，输出计算出的 $\\alpha$ 作为开区间 $[0,1]$ 内的小数，四舍五入到小数点后六位。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序与上面的测试套件一致（例如，$[\\alpha_A,\\alpha_B,\\alpha_C,\\alpha_D,\\alpha_E]$）。", "solution": "该问题要求在指定的平衡条件下，确定弱聚电解质凝胶的电离度 $\\alpha$。在进行求解之前，必须对问题陈述进行严格的验证。\n\n根据科学基础、适定性和客观性的要求对该问题进行审查。\n所提出的模型基于已确立的离子分配的 Donnan 平衡原理、带电介质内部的电中性原理以及酸解离的标准化学平衡（Henderson-Hasselbalch 方程）。这些概念构成了聚电解质物理化学的基石，并且完全是科学上合理的。所提供的测试用例参数——酸解离常数（$K_a$）、pH 值、盐浓度（$c_s$）、聚合物体积分数（$\\phi$）和固定电荷密度（$C_A^{\\mathrm{dry}}$）——对于此类系统而言，处于物理上现实的范围内。\n\n该问题是适定的。它要求为无量纲的 Donnan 电势 $\\psi_D$ 建立一个单一的非线性标量方程，然后进行数值求解。该方程的推导及其解的存在性和唯一性证明证实了可以获得有意义的结果。指令清晰、客观，并提供了所有必要的信息，没有留下任何歧义的空间。该问题是自洽且内部一致的。\n\n结论是该问题是**有效的**。现在将给出解答。\n\n核心任务是求解凝胶的平衡状态，该状态由电离度 $\\alpha$ 表征。此量与凝胶和水库之间的静电势差（Donnan 电势 $\\Delta \\psi$）耦合，我们用其无量纲形式表示，即 $\\psi_D = e \\Delta \\psi / (k_B T)$。通过施加凝胶内部局部电中性的条件来找到解。\n\n电中性条件指出，每单位体积内所有电荷的总和必须为零。对电荷平衡有贡献的物种包括来自水库的可移动离子（质子 $\\text{H}^+$、氢氧根离子 $\\text{OH}^-$ 和盐离子）以及聚合物网络上的固定电荷（$\\text{A}^-$）。对于水库浓度为 $c_s$ 的对称单价盐，阳离子和阴离子的价态分别为 $z_+ = +1$ 和 $z_- = -1$。电中性方程为：\n$$ (+1)[\\text{H}^+]_{\\text{in}} + (+1)c_+^{\\text{in}} + (-1)[\\text{OH}^-]_{\\text{in}} + (-1)c_-^{\\text{in}} - c_f = 0 $$\n其中 $c_i^{\\text{in}}$ 表示物种 $i$ 在凝胶内的浓度，$c_f$ 是网络上已电离酸基团的浓度。\n\n凝胶内可移动离子的浓度通过 Donnan 平衡关系式与它们在水库中的浓度（$c_i^{\\text{res}}$）相关联：\n$$ c_i^{\\text{in}} = c_i^{\\text{res}} \\exp(-z_i \\psi_D) $$\n水库中的浓度为：$[\\text{H}^+]_{\\text{res}} = 10^{-pH_{\\text{res}}}$，$[\\text{OH}^-]_{\\text{res}} = K_w / [\\text{H}^+]_{\\text{res}}$，$c_+^{\\text{res}} = c_s$，以及 $c_-^{\\text{res}} = c_s$。应用 Donnan 关系式可得：\n$$ [\\text{H}^+]_{\\text{in}} = [\\text{H}^+]_{\\text{res}} e^{-\\psi_D} $$\n$$ [\\text{OH}^-]_{\\text{in}} = [\\text{OH}^-]_{\\text{res}} e^{\\psi_D} $$\n$$ c_+^{\\text{in}} = c_s e^{-\\psi_D} $$\n$$ c_-^{\\text{in}} = c_s e^{\\psi_D} $$\n将这些代入电中性方程，得到：\n$$ \\left( [\\text{H}^+]_{\\text{res}} + c_s \\right) e^{-\\psi_D} - \\left( [\\text{OH}^-]_{\\text{res}} + c_s \\right) e^{\\psi_D} - c_f = 0 $$\n\n固定电荷浓度 $c_f$ 源于聚合物网络上酸基团的解离。它由 $c_f = \\alpha C_A^{\\mathrm{dry}} \\phi$ 给出，其中 $\\alpha$ 是电离度，$C_A^{\\mathrm{dry}}$ 是每单位干聚合物体积的可滴定酸位点浓度，$\\phi$ 是聚合物体积分数。\n\n电离度 $\\alpha$ 由酸解离平衡控制，该平衡取决于凝胶内部的局部质子浓度 $[\\text{H}^+]_{\\text{in}}$。该关系由 Henderson-Hasselbalch 型方程给出：\n$$ \\frac{\\alpha}{1-\\alpha} = \\frac{K_a}{[\\text{H}^+]_{\\text{in}}} $$\n这可以重新整理以将 $\\alpha$ 表示为 $[\\text{H}^+]_{\\text{in}}$ 的函数：\n$$ \\alpha = \\frac{K_a}{K_a + [\\text{H}^+]_{\\text{in}}} $$\n由于 $[\\text{H}^+]_{\\text{in}}$ 本身依赖于 $\\psi_D$，因此 $\\alpha$ 成为 $\\psi_D$ 的函数：\n$$ \\alpha(\\psi_D) = \\frac{K_a}{K_a + [\\text{H}^+]_{\\text{res}} e^{-\\psi_D}} $$\n\n通过将 $c_f$ 和 $\\alpha(\\psi_D)$ 的表达式代入电中性方程，我们得到一个关于未知数 $\\psi_D$ 的单一非线性标量方程：\n$$ f(\\psi_D) = \\left( [\\text{H}^+]_{\\text{res}} + c_s \\right) e^{-\\psi_D} - \\left( [\\text{OH}^-]_{\\text{res}} + c_s \\right) e^{\\psi_D} - \\frac{K_a C_A^{\\mathrm{dry}} \\phi}{K_a + [\\text{H}^+]_{\\text{res}} e^{-\\psi_D}} = 0 $$\n该方程必须对 $\\psi_D$ 进行数值求解。函数 $f(\\psi_D)$ 是连续且单调递减的，因为其导数 $f'(\\psi_D)$ 对所有 $\\psi_D \\in \\mathbb{R}$ 都是严格为负的。此外，$\\lim_{\\psi_D \\to -\\infty} f(\\psi_D) = +\\infty$ 且 $\\lim_{\\psi_D \\to +\\infty} f(\\psi_D) = -\\infty$。这些性质保证了唯一根的存在。\n\n数值策略如下：\n1.  对于每组参数 $(K_a, pH_{\\mathrm{res}}, c_s, \\phi, C_A^{\\mathrm{dry}})$，首先计算恒定的水库浓度：$[\\text{H}^+]_{\\text{res}} = 10^{-pH_{\\text{res}}}$ 和 $[\\text{OH}^-]_{\\text{res}} = 10^{-14} / [\\text{H}^+]_{\\text{res}}$。\n2.  定义如上推导的函数 $f(\\psi_D)$。\n3.  采用一个稳健的区间求根算法，例如 Brent's 方法，来找到方程 $f(\\psi_D) = 0$ 的唯一根 $\\psi_D^*$。一个足够大的搜索区间，如 $[-50, 50]$，将可靠地包含该根。\n4.  一旦确定了根 $\\psi_D^*$，使用 Donnan 电势的值计算电离度 $\\alpha$：\n$$ \\alpha = \\frac{K_a}{K_a + [\\text{H}^+]_{\\text{res}} e^{-\\psi_D^*}} $$\n5.  每个案例的最终结果是此 $\\alpha$ 值，按要求格式化。\n\n此过程为求解提供了完整而正确的路径。实现将精确遵循此算法。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves for the degree of ionization alpha for a series of polyelectrolyte gel test cases.\n    \"\"\"\n    # Define constants\n    K_w = 1e-14  # Ionic product of water in (mol/L)^2\n\n    # Test cases: (K_a, pH_res, c_s, phi, C_A_dry)\n    # Units: K_a (mol/L), pH_res (-), c_s (mol/L), phi (-), C_A_dry (mol/L_polymer)\n    test_cases = [\n        (1e-5, 7.0, 0.1, 0.05, 10.0),    # Case A\n        (1e-5, 7.0, 0.0, 0.05, 10.0),    # Case B\n        (1e-6, 3.0, 0.1, 0.05, 10.0),    # Case C\n        (1e-4, 10.0, 0.01, 0.01, 10.0),   # Case D\n        (1e-5, 7.0, 0.1, 0.3, 8.0)       # Case E\n    ]\n\n    results = []\n    \n    # Bracket for root-finding. Analysis shows the function is monotonic and crosses\n    # zero, so a wide bracket is safe. Physically, |psi_D|  20 is rare.\n    psi_d_bracket = [-50.0, 50.0]\n\n    for case in test_cases:\n        K_a, pH_res, c_s, phi, C_A_dry = case\n\n        # Step 1: Calculate reservoir concentrations\n        H_res = 10**(-pH_res)\n        OH_res = K_w / H_res\n\n        # Step 2: Define the electroneutrality function f(psi_D) = 0\n        def electroneutrality_func(psi_d):\n            \"\"\"\n            This function represents the electroneutrality condition inside the gel.\n            The root of this function is the equilibrium Donnan potential.\n            f(psi_d) = (sum of positive charges) - (sum of negative charges)\n            \"\"\"\n            exp_neg_psi = np.exp(-psi_d)\n            exp_pos_psi = np.exp(psi_d)\n            \n            # Term 1: Mobile positive ions (H+ and salt cations)\n            positive_mobile_charge = (H_res + c_s) * exp_neg_psi\n            \n            # Term 2: Mobile negative ions (OH- and salt anions)\n            negative_mobile_charge = (OH_res + c_s) * exp_pos_psi\n\n            # Term 3: Fixed negative charges on the polymer network\n            # alpha(psi_d) = K_a / (K_a + H_in) where H_in = H_res * exp(-psi_d)\n            # c_f = alpha * C_A_dry * phi\n            fixed_charge_density = (K_a * C_A_dry * phi) / (K_a + H_res * exp_neg_psi)\n            \n            return positive_mobile_charge - negative_mobile_charge - fixed_charge_density\n\n        # Step 3: Find the root for psi_D\n        try:\n            psi_d_root = brentq(electroneutrality_func, psi_d_bracket[0], psi_d_bracket[1])\n        except ValueError:\n            # This should not happen if the analysis of the function is correct.\n            # Handle potential failure for robustness.\n            results.append(float('nan'))\n            continue\n\n        # Step 4: Calculate the degree of ionization alpha\n        H_in = H_res * np.exp(-psi_d_root)\n        alpha = K_a / (K_a + H_in)\n        \n        # Step 5: Store the result, rounded to six decimal places\n        results.append(round(alpha, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2930238"}, {"introduction": "在科学研究中，一个核心任务是从宏观的实验数据中提取微观模型的参数。这个练习将 Flory-Rehner 理论置于一个实际的数据分析场景中，要求我们解决一个“反问题”：即利用凝胶在混合溶剂中的溶胀数据来推断聚合物与各溶剂组分之间的相互作用参数。通过构建加权最小二乘估计器并评估参数的可识别性，你将掌握定量数据分析、误差传递和模型验证等在现代科学研究中不可或缺的技能 ([@problem_id:2930302])。", "problem": "当交联聚合物网络（凝胶）浸入小分子溶剂浴中时，由于混合热力学和网络弹性的平衡，它会发生溶胀。考虑一个处于恒定温度下的凝胶，浸在一个由两种理想小分子溶剂（标记为组分1和组分2）组成的大溶剂浴中，其溶剂浴摩尔分数分别为 $x_1$ 和 $x_2 = 1 - x_1$。令 $\\phi$ 表示平衡时溶胀凝胶中的聚合物体积分数。假设模型包含以下要素。\n\n- 混合自由能密度由 Flory-Huggins (FH) 理论描述，凝胶弹性由高斯网络弹性理论描述。在这些假设下，凝胶在单位活度的大量小分子溶剂浴中溶胀的 Flory-Rehner (FR) 平衡条件可以写为以下典范形式\n$$\n\\ln(1 - \\phi) + \\phi + \\chi_{\\mathrm{eff}}\\, \\phi^2 + C \\left(\\phi^{1/3} - \\frac{\\phi}{2}\\right) = 0,\n$$\n其中 $C$ 是一个已知的正常数，与溶剂参考摩尔体积和弹性活性网络链密度的乘积成正比，而 $\\chi_{\\mathrm{eff}}$ 是聚合物所感受到的溶剂浴的有效聚合物-溶剂相互作用参数。\n- 有效相互作用参数被建模为各组分的线性组成平均值，\n$$\n\\chi_{\\mathrm{eff}} = x_1 \\chi_{P1} + x_2 \\chi_{P2},\n$$\n其中 $\\chi_{P1}$ 和 $\\chi_{P2}$ 分别是聚合物与组分1和组分2之间的特定组分的 Flory-Huggins 相互作用参数。\n\n你的任务是建立并求解一个反问题，以从在不同溶剂浴组成下进行的多次溶胀测量 $(x_{1,j}, \\phi_j)$ 中估计 $(\\chi_{P1}, \\chi_{P2})$。你还必须在 $\\phi$ 存在实验噪声的情况下，量化 $(\\chi_{P1}, \\chi_{P2})$ 的可辨识性。\n\n从上述 Flory-Rehner 平衡条件出发，完成以下步骤。\n\n1) 推导一个显式表达式，该表达式分离出一个标量函数 $y(\\phi)$，使得对于每次测量 $j$，\n$$\ny(\\phi_j) \\approx x_{1,j}\\,\\chi_{P1} + x_{2,j}\\,\\chi_{P2},\n$$\n在给定的模型假设下成立。目标是将该反问题转化为一个关于未知数 $(\\chi_{P1}, \\chi_{P2})$ 的线性回归问题。\n\n2) 推导在 $\\phi_j$ 处求值的灵敏度 $\\frac{dy}{d\\phi}$，并使用一阶（线性）误差传播，表示变换后响应的近似标准差 $\\sigma_{y,j}$，\n$$\n\\sigma_{y,j} \\approx \\left|\\frac{dy}{d\\phi}(\\phi_j)\\right| \\sigma_{\\phi,j},\n$$\n在给定 $\\phi_j$ 的已知测量标准差 $\\sigma_{\\phi,j}$ 的情况下。\n\n3) 提出并实现一个用于估计 $(\\chi_{P1}, \\chi_{P2})$ 的加权最小二乘估计器，使用权重 $w_j = 1/\\sigma_{y,j}^2$。计算参数协方差矩阵，其值为加权法向矩阵的逆矩阵，并提取估计值的标准误差，其值为协方差矩阵对角线元素的平方根。\n\n4) 定义一个同时取决于实验设计的几何结构和噪声水平的可辨识性准则，如下所示。令 $\\mathbf{X}$ 为一个 $N \\times 2$ 的设计矩阵，其列为 $[x_{1,j}]$ 和 $[x_{2,j}]$，并令 $\\mathbf{W} = \\mathrm{diag}(w_1,\\dots,w_N)$。构建加权设计矩阵 $\\mathbf{X}_w = \\mathbf{W}^{1/2}\\mathbf{X}$ 并计算其谱条件数 $\\kappa = \\kappa_2(\\mathbf{X}_w)$。如果以下两条均成立，则声明参数对 $(\\chi_{P1}, \\chi_{P2})$ 是可辨识的：\n- $\\kappa \\le 10^4$，\n- 每个参数的估计标准误差小于 $0.05$。\n否则，声明其为不可辨识。\n\n本问题中的所有量均为无量纲。\n\n在一个程序中实现上述估计器和可辨识性测试，该程序处理以下测试套件。对于每个测试用例，您将获得弹性常数 $C$、溶剂浴摩尔分数 $x_1$ 的列表、相应的测量聚合物体积分数 $\\phi$，以及该用例中所有数据点的通用测量标准差 $\\sigma_\\phi$。\n\n使用以下测试套件。\n- 测试用例 A（组成分布良好，低噪声）：\n  - $C = 0.005$，\n  - $x_1 = [0.05, 0.25, 0.50, 0.75, 0.95]$,\n  - $\\phi = [0.220, 0.180, 0.140, 0.110, 0.095]$,\n  - $\\sigma_\\phi = 0.003$。\n- 测试用例 B（组成分布狭窄，中等噪声）：\n  - $C = 0.005$，\n  - $x_1 = [0.45, 0.48, 0.52, 0.55]$,\n  - $\\phi = [0.142, 0.141, 0.139, 0.138]$,\n  - $\\sigma_\\phi = 0.004$。\n- 测试用例 C（数据量最少，较高噪声）：\n  - $C = 0.005$，\n  - $x_1 = [0.20, 0.80]$,\n  - $\\phi = [0.190, 0.100]$,\n  - $\\sigma_\\phi = 0.010$。\n\n对于每个测试用例，您的程序必须计算：\n- 加权最小二乘估计值 $\\widehat{\\chi}_{P1}$ 和 $\\widehat{\\chi}_{P2}$，\n- $\\mathbf{X}_w$ 的谱条件数 $\\kappa$，\n- 作为布尔值的可辨识性判定。\n\n最终输出格式：\n- 对于每个测试用例，返回一个形式为 $[\\widehat{\\chi}_{P1}, \\widehat{\\chi}_{P2}, \\kappa, \\text{identifiable}]$ 的列表，其中前三个条目是保留六位小数的浮点数，最后一个条目是布尔值。\n- 将三个测试用例的结果汇总到一个列表中，并精确打印一行包含此列表的 Python 列表字面量形式。例如，一个有效的输出形状是\n$[[\\text{float},\\text{float},\\text{float},\\text{bool}],[\\text{float},\\text{float},\\text{float},\\text{bool}],[\\text{float},\\text{float},\\text{float},\\text{bool}]]$。", "solution": "问题陈述在科学上是合理的、良定的，并为后续步骤提供了所有必要信息。它基于已建立的关于聚合物凝胶溶胀的 Flory-Rehner 理论，这是聚合物物理学中的一个标准课题。任务涉及一系列逻辑连贯的推导和数值实现，构成了一个有效且有实质内容的问题。\n\n解题过程按要求分四个阶段进行：1) 线性回归模型的推导，2) 误差传播公式的推导，3) 加权最小二乘估计器的说明，以及 4) 可辨识性准则的定义。\n\n**1. 模型的线性化**\n出发点是凝胶在溶剂浴中溶胀的 Flory-Rehner (FR) 平衡条件：\n$$\n\\ln(1 - \\phi) + \\phi + \\chi_{\\mathrm{eff}}\\, \\phi^2 + C \\left(\\phi^{1/3} - \\frac{\\phi}{2}\\right) = 0\n$$\n在此，$\\phi$ 是聚合物体积分数，$C$ 是一个弹性常数，$\\chi_{\\mathrm{eff}}$ 是有效的聚合物-溶剂相互作用参数。问题陈述指出，对于一个摩尔分数为 $x_1$ 和 $x_2=1-x_1$ 的二元溶剂混合物，有效相互作用参数被建模为线性平均值：\n$$\n\\chi_{\\mathrm{eff}} = x_1 \\chi_{P1} + x_2 \\chi_{P2}\n$$\n其中 $\\chi_{P1}$ 和 $\\chi_{P2}$ 是待估计的参数。\n\n为了将其转化为一个线性回归问题，我们必须从 FR 方程中分离出 $\\chi_{\\mathrm{eff}}$。假设 $\\phi \\neq 0$，我们可以如下重新整理各项：\n$$\n\\chi_{\\mathrm{eff}}\\, \\phi^2 = -\\left[ \\ln(1 - \\phi) + \\phi + C \\left(\\phi^{1/3} - \\frac{\\phi}{2}\\right) \\right]\n$$\n两边同除以 $\\phi^2$，得到一个用可测量 $\\phi$ 和已知常数 $C$ 表示 $\\chi_{\\mathrm{eff}}$ 的表达式。我们将其定义为变换后的响应变量 $y(\\phi)$：\n$$\ny(\\phi) = -\\frac{1}{\\phi^2} \\left[ \\ln(1 - \\phi) + \\phi + C \\left(\\phi^{1/3} - \\frac{\\phi}{2}\\right) \\right]\n$$\n对于每次测量 $j$，我们可以计算一个值 $y_j = y(\\phi_j)$。通过将其与 $\\chi_{\\mathrm{eff},j}$ 的模型相结合，我们得到了所需的线性关系：\n$$\ny(\\phi_j) \\approx x_{1,j}\\,\\chi_{P1} + (1-x_{1,j})\\,\\chi_{P2}\n$$\n该方程具有线性模型的形式，从而可以使用线性回归技术来估计未知参数 $\\chi_{P1}$ 和 $\\chi_{P2}$。\n\n**2. 误差传播**\n$\\phi_j$ 的实验测量值会受到噪声的影响，其特征是标准差 $\\sigma_{\\phi,j}$。这种不确定性会传播到计算出的响应变量 $y_j$ 中。使用一阶泰勒展开（线性误差传播），$y_j$ 的方差由下式给出：\n$$\n\\sigma_{y,j}^2 \\approx \\left(\\frac{dy}{d\\phi}\\bigg|_{\\phi_j}\\right)^2 \\sigma_{\\phi,j}^2 \\implies \\sigma_{y,j} \\approx \\left|\\frac{dy}{d\\phi}(\\phi_j)\\right| \\sigma_{\\phi,j}\n$$\n为了应用该公式，我们必须计算导数 $\\frac{dy}{d\\phi}$。我们可以将 $y(\\phi)$ 写为：\n$$\ny(\\phi) = -\\phi^{-2}\\ln(1-\\phi) - \\phi^{-1} - C \\phi^{-5/3} + \\frac{C}{2}\\phi^{-1}\n$$\n逐项对 $\\phi$ 求导可得：\n$$\n\\frac{dy}{d\\phi} = \\left( 2\\phi^{-3}\\ln(1-\\phi) + \\frac{\\phi^{-2}}{1-\\phi} \\right) + \\phi^{-2} + \\frac{5C}{3}\\phi^{-8/3} - \\frac{C}{2}\\phi^{-2}\n$$\n合并具有共同代数结构的项，得到灵敏度的最终表达式：\n$$\n\\frac{dy}{d\\phi} = \\frac{2\\ln(1 - \\phi)}{\\phi^3} + \\frac{2-\\phi}{\\phi^2(1-\\phi)} - \\frac{C}{2\\phi^2} + \\frac{5C}{3\\phi^{8/3}}\n$$\n当在每个测量值 $\\phi_j$ 处计算该导数值时，我们就可以估计变换后响应的标准差 $\\sigma_{y,j}$。\n\n**3. 加权最小二乘 (WLS) 估计**\n包含 $N$ 次测量的线性系统可以写成矩阵形式 $\\mathbf{y} \\approx \\mathbf{X}\\boldsymbol{\\beta}$，其中：\n- $\\mathbf{y} = [y(\\phi_1), \\dots, y(\\phi_N)]^T$ 是变换后响应的向量。\n- $\\mathbf{X}$ 是 $N \\times 2$ 的设计矩阵，其第 $j$ 行为 $[x_{1,j}, 1-x_{1,j}]$。\n- $\\boldsymbol{\\beta} = [\\chi_{P1}, \\chi_{P2}]^T$ 是未知参数的向量。\n\n由于不确定性 $\\sigma_{y,j}$ 不一致，噪声是异方差的。合适的估计器是加权最小二乘 (WLS)，它为方差较小的数据点赋予更大的权重。权重为 $w_j = 1/\\sigma_{y,j}^2$，构成对角权重矩阵 $\\mathbf{W} = \\mathrm{diag}(w_j)$。\n\n参数的 WLS 估计值 $\\widehat{\\boldsymbol{\\beta}}$ 由法向方程组的解给出：\n$$\n\\widehat{\\boldsymbol{\\beta}} = (\\mathbf{X}^T \\mathbf{W} \\mathbf{X})^{-1} \\mathbf{X}^T \\mathbf{W} \\mathbf{y}\n$$\n该估计中的统计不确定性由参数协方差矩阵反映，对于 WLS，该矩阵是加权法向矩阵的逆：\n$$\n\\mathrm{Cov}(\\widehat{\\boldsymbol{\\beta}}) = (\\mathbf{X}^T \\mathbf{W} \\mathbf{X})^{-1}\n$$\n估计参数的标准误差 $\\sigma_{\\widehat{\\chi}_{P1}}$ 和 $\\sigma_{\\widehat{\\chi}_{P2}}$ 是该协方差矩阵对角线元素的平方根。\n\n**4. 可辨识性准则**\n可靠地确定 $\\chi_{P1}$ 和 $\\chi_{P2}$ 的能力取决于两个因素：实验设计（即 $x_1$ 值的分布范围）和噪声水平。\n- **数值稳定性：** 最小二乘问题的条件通过加权设计矩阵 $\\mathbf{X}_w = \\mathbf{W}^{1/2}\\mathbf{X}$ 的谱条件数 $\\kappa = \\kappa_2(\\mathbf{X}_w)$ 来评估。一个大的 $\\kappa$ 值表示 $\\mathbf{X}_w$ 的列近似线性相关，使得解对数据中的微小扰动高度敏感。问题指定了一个阈值 $\\kappa \\le 10^4$。\n- **统计显著性：** 只有当估计参数的标准误差相对于其量值较小时，这些参数才有意义。问题规定每个参数的标准误差必须小于 $0.05$。\n\n当且仅当两个条件都满足时，即 $\\kappa \\le 10^4$ 且两个标准误差均小于 $0.05$，参数对 $(\\chi_{P1}, \\chi_{P2})$ 被认为是可辨识的。\n\n**算法摘要**\n对于每个测试用例，执行以下步骤：\n1.  使用提供的数据 $(\\phi_j, C)$，通过推导出的 $y(\\phi)$ 公式计算变换后响应的向量 $\\mathbf{y}$。\n2.  计算灵敏度向量 $\\frac{d\\mathbf{y}}{d\\phi}$ 并传播测量误差 $\\sigma_\\phi$ 以求得响应误差 $\\sigma_{y,j}$。\n3.  计算权重 $w_j=1/\\sigma_{y,j}^2$ 并构建设计矩阵 $\\mathbf{X}$ 和权重矩阵 $\\mathbf{W}$。\n4.  求解 WLS 系统以获得参数估计值 $\\widehat{\\boldsymbol{\\beta}} = [\\widehat{\\chi}_{P1}, \\widehat{\\chi}_{P2}]^T$。\n5.  计算参数协方差矩阵并提取标准误差。\n6.  构建加权设计矩阵 $\\mathbf{X}_w$ 并计算其谱条件数 $\\kappa$。\n7.  应用双重可辨识性准则来确定参数是否可辨识。\n8.  按规定收集并格式化结果。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for Flory-Huggins parameters from swelling data using weighted least squares\n    and assesses parameter identifiability.\n    \"\"\"\n\n    test_cases = [\n        {\n            'C': 0.005,\n            'x1': [0.05, 0.25, 0.50, 0.75, 0.95],\n            'phi': [0.220, 0.180, 0.140, 0.110, 0.095],\n            'sigma_phi': 0.003\n        },\n        {\n            'C': 0.005,\n            'x1': [0.45, 0.48, 0.52, 0.55],\n            'phi': [0.142, 0.141, 0.139, 0.138],\n            'sigma_phi': 0.004\n        },\n        {\n            'C': 0.005,\n            'x1': [0.20, 0.80],\n            'phi': [0.190, 0.100],\n            'sigma_phi': 0.010\n        }\n    ]\n\n    all_results = []\n\n    for case_data in test_cases:\n        C = case_data['C']\n        x1_vec = np.array(case_data['x1'])\n        phi_vec = np.array(case_data['phi'])\n        sigma_phi = case_data['sigma_phi']\n        \n        # Step 1: Calculate the transformed response variable y(phi)\n        term_log = np.log(1 - phi_vec)\n        term_elastic = C * (phi_vec**(1/3) - phi_vec / 2)\n        y_vec = -(term_log + phi_vec + term_elastic) / phi_vec**2\n        \n        # Step 2: Calculate the sensitivity dy/dphi and propagate error\n        dydphi_vec = (2 * np.log(1 - phi_vec) / phi_vec**3 +\n                      (2 - phi_vec) / (phi_vec**2 * (1 - phi_vec)) -\n                      C / (2 * phi_vec**2) +\n                      5 * C / (3 * phi_vec**(8/3)))\n        sigma_y_vec = np.abs(dydphi_vec) * sigma_phi\n        \n        # Step 3: Set up and solve the Weighted Least Squares problem\n        w_vec = 1 / sigma_y_vec**2\n        W = np.diag(w_vec)\n        \n        x2_vec = 1 - x1_vec\n        X = np.stack([x1_vec, x2_vec], axis=1)\n        \n        # Normal matrix for WLS\n        X_T_W_X = X.T @ W @ X\n        \n        # Right-hand side vector\n        X_T_W_y = X.T @ W @ y_vec\n        \n        # It is assumed the matrix is invertible for the given test cases.\n        # Solve for parameter estimates\n        beta_hat = np.linalg.solve(X_T_W_X, X_T_W_y)\n        chi_P1_hat, chi_P2_hat = beta_hat\n        \n        # Calculate covariance matrix and standard errors\n        cov_beta = np.linalg.inv(X_T_W_X)\n        std_err = np.sqrt(np.diag(cov_beta))\n        \n        # Step 4: Assess identifiability\n        W_sqrt = np.diag(np.sqrt(w_vec))\n        X_w = W_sqrt @ X\n        kappa = np.linalg.cond(X_w, p=2)\n        \n        # Apply identifiability criteria\n        is_identifiable = (kappa = 1e4) and (std_err[0]  0.05) and (std_err[1]  0.05)\n        \n        result = [\n            round(chi_P1_hat, 6),\n            round(chi_P2_hat, 6),\n            round(kappa, 6),\n            bool(is_identifiable)\n        ]\n        all_results.append(result)\n\n    print(f\"{all_results}\")\n\nsolve()\n```", "id": "2930302"}]}