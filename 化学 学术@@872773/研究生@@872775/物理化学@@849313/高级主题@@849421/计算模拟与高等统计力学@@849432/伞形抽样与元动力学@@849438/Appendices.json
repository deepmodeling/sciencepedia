{"hands_on_practices": [{"introduction": "在我们运用高级方法计算自由能之前，我们必须首先从第一性原理出发，理解其确切含义。这项练习将通过一个简单的、可解析求解的系统，引导你严格推导平均力势（PMF）。它将约束系综平均的抽象概念与可测量的平均力联系起来，而后者正是在许多增强采样方法中我们所估计的量。这项练习构成了我们理解和应用伞形采样与元动力学等方法的理论基石 [@problem_id:2685152]。", "problem": "考虑一个二维经典系统，其笛卡尔坐标为$x$和$y$，温度为$T$，逆温度为$\\beta = 1/(k_{B}T)$，势能为\n$$\nU(x,y) \\;=\\; \\tfrac{1}{2}\\,k_{x}\\,x^{2} \\;+\\; \\tfrac{1}{2}\\,k_{y}\\,\\bigl(y - \\alpha\\,x\\bigr)^{2},\n$$\n其中 $k_{x}  0$，$k_{y}  0$ 和 $\\alpha$ 是常数。令集体变量为笛卡尔坐标 $s(x,y) = x$。沿着$s$的平均力势$F(s)$是通过在固定$s$下的约束（条件）平衡系综定义的，其定义不确定一个可加常数。热力学积分恒等式将自由能差与约束平均广义力联系起来，其形式为\n$$\nF(b) - F(a) \\;=\\; \\int_{a}^{b} \\mathrm{d}s \\,\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s},\n$$\n其中对于笛卡尔集体变量$s=x$，应将$\\tfrac{\\partial U}{\\partial s}$解释为在超曲面$x=s$上求值的$\\tfrac{\\partial U}{\\partial x}$。\n\n从正则系综和条件期望的定义出发，完成以下任务：\n\n1. 将固定$s$下可观测量$A(x,y)$的约束系综平均$\\langle A \\rangle_{s}$定义为组态积分的比值，该比值明确包含用于强制执行完整约束$s(x,y)=s$的狄拉克δ函数。仔细考虑将完整组态空间积分限制在超曲面$s(x,y)=s$上时出现的适当的曲面测度。将你的定义应用于当前的笛卡尔坐标情况，并尽可能地简化它。\n\n2. 使用你的定义，以闭合形式计算该系统的约束平均$\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s}$，并保持所有参数为符号形式。\n\n3. 使用热力学积分求得$F(s)$，选择参考点使得$F(0)=0$，从而$F(s)$被唯一确定。将你的最终答案表示为$k_{x}$和$s$的闭合形式解析表达式。最终表达式中不要包含单位。", "solution": "该问题陈述具有科学依据，提法恰当且客观。它提出了一个统计力学中的标准理论问题，涉及计算具有二次势能函数的系统的平均力势。所有必要的参数和条件都已给出，任务的逻辑结构清晰。该问题是有效的，我们将着手解决。\n\n解答按照问题陈述的要求分为三个部分。\n\n1. 约束系综平均的定义。\n\n可观测量$A(q)$的正则系综平均由下式给出，其中$q$代表所有坐标的集合：\n$$\n\\langle A \\rangle = \\frac{\\int A(q) \\exp(-\\beta U(q)) \\, dq}{\\int \\exp(-\\beta U(q)) \\, dq},\n$$\n其中$U(q)$是势能，$\\beta = 1/(k_{B}T)$是逆温度，积分遍及整个组态空间。\n\n为了定义在集体变量$s(q)$的固定值$s$下的约束系综平均$\\langle A \\rangle_{s}$，我们必须将组态空间限制在由完整约束$s(q)=s$定义的超曲面上。这在形式上是通过引入狄拉克δ函数$\\delta(s(q)-s)$来实现的。在约束系综中，找到系统处于特定组态$q$的概率密度与$\\exp(-\\beta U(q)) \\delta(s(q)-s)$成正比。\n\n因此，可观测量$A(q)$的约束系综平均定义为积分的比值：\n$$\n\\langle A \\rangle_{s} = \\frac{\\int A(q) \\exp(-\\beta U(q)) \\delta(s(q)-s) \\, dq}{\\int \\exp(-\\beta U(q)) \\delta(s(q)-s) \\, dq}.\n$$\n在当前情况下，组态由笛卡尔坐标$q=(x,y)$指定，因此$dq=dx\\,dy$。集体变量为$s(x,y)=x$。因此约束为$x=s$，δ函数为$\\delta(x-s)$。\n\n将这些代入一般定义中，我们得到：\n$$\n\\langle A \\rangle_{s} = \\frac{\\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} A(x,y) \\exp[-\\beta U(x,y)] \\delta(x-s) \\, dx \\, dy}{\\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\exp[-\\beta U(x,y)] \\delta(x-s) \\, dx \\, dy}.\n$$\n我们现在可以利用狄拉克δ函数的筛选性质，$\\int f(x) \\delta(x-s) \\, dx = f(s)$，来对$x$进行积分。这得到：\n$$\n\\langle A \\rangle_{s} = \\frac{\\int_{-\\infty}^{\\infty} A(s,y) \\exp[-\\beta U(s,y)] \\, dy}{\\int_{-\\infty}^{\\infty} \\exp[-\\beta U(s,y)] \\, dy}.\n$$\n这是在这种笛卡尔坐标情况下约束平均的简化定义。在超曲面$x=s$上的曲面测度元$d\\Sigma$就是$dy$。一般的曲面元包含一个雅可比因子，$d\\Sigma = |\\nabla s|^{-1} dq_s$，其中$dq_s$是曲面的体积元。这里，$s(x,y)=x$，所以$\\nabla s = (1,0)$且$|\\nabla s| = 1$。雅可比因子为1，这与我们的直接简化结果一致。\n\n2. 约束平均广义力的计算。\n\n沿集体变量$s=x$的广义力是$\\frac{\\partial U}{\\partial s}$，这被解释为在超曲面$x=s$上求值的$\\frac{\\partial U}{\\partial x}$。首先，我们计算势能$U(x,y) = \\tfrac{1}{2}\\,k_{x}\\,x^{2} + \\tfrac{1}{2}\\,k_{y}\\,(y - \\alpha\\,x)^{2}$的偏导数：\n$$\n\\frac{\\partial U}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ \\tfrac{1}{2}\\,k_{x}\\,x^{2} + \\tfrac{1}{2}\\,k_{y}\\,(y - \\alpha\\,x)^{2} \\right] = k_{x}\\,x + k_{y}(y-\\alpha x)(-\\alpha) = k_{x}\\,x - \\alpha k_{y}(y - \\alpha x).\n$$\n我们需要计算约束平均$\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s}$。被平均的可观测量是将$\\frac{\\partial U}{\\partial x}$的表达式中的$x$替换为$s$：\n$$\nA(s,y) = \\left. \\frac{\\partial U}{\\partial x} \\right|_{x=s} = k_{x}s - \\alpha k_{y}(y - \\alpha s).\n$$\n使用第1部分的定义，平均值为：\n$$\n\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s} = \\frac{\\int_{-\\infty}^{\\infty} [k_{x}s - \\alpha k_{y}(y - \\alpha s)] \\exp[-\\beta U(s,y)] \\, dy}{\\int_{-\\infty}^{\\infty} \\exp[-\\beta U(s,y)] \\, dy},\n$$\n其中$U(s,y) = \\tfrac{1}{2}\\,k_{x}\\,s^{2} + \\tfrac{1}{2}\\,k_{y}\\,(y - \\alpha s)^{2}$。项$\\exp[-\\beta (\\tfrac{1}{2} k_x s^2)]$相对于积分变量$y$是一个常数，将从分子和分母中约去。表达式简化为：\n$$\n\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s} = \\frac{\\int_{-\\infty}^{\\infty} [k_{x}s - \\alpha k_{y}(y - \\alpha s)] \\exp[-\\beta \\tfrac{1}{2} k_{y}(y-\\alpha s)^2] \\, dy}{\\int_{-\\infty}^{\\infty} \\exp[-\\beta \\tfrac{1}{2} k_{y}(y-\\alpha s)^2] \\, dy}.\n$$\n我们可以将其分成两项：\n$$\n\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s} = \\frac{\\int_{-\\infty}^{\\infty} k_{x}s \\exp[\\dots] \\, dy}{\\int_{-\\infty}^{\\infty} \\exp[\\dots] \\, dy} - \\frac{\\int_{-\\infty}^{\\infty} \\alpha k_{y}(y - \\alpha s) \\exp[\\dots] \\, dy}{\\int_{-\\infty}^{\\infty} \\exp[\\dots] \\, dy}.\n$$\n对于第一项，$k_x s$是一个常数，所以它可以从积分中提出来，然后与分母约去，剩下$k_x s$。对于第二项，我们考虑积分$\\int_{-\\infty}^{\\infty} (y - \\alpha s) \\exp[-\\beta \\tfrac{1}{2} k_{y}(y-\\alpha s)^2] \\, dy$。令$z = y - \\alpha s$，则$dy = dz$。积分变为$\\int_{-\\infty}^{\\infty} z \\exp(-\\frac{\\beta k_y}{2} z^2) \\, dz$。被积函数$f(z) = z \\exp(-C z^2)$（其中$C = \\frac{\\beta k_y}{2}  0$）是$z$的奇函数。奇函数在对称区间$(-\\infty, \\infty)$上的积分为零。因此，第二项为零。\n综合结果，约束平均力为：\n$$\n\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s} = k_{x}s.\n$$\n\n3. 通过热力学积分求得平均力势$F(s)$。\n\n平均力势$F(s)$是通过从一个参考点开始，沿着集体变量对平均力进行积分得到的。热力学积分恒等式如下：\n$$\nF(b) - F(a) = \\int_{a}^{b} \\bigl\\langle \\tfrac{\\partial U}{\\partial s'} \\bigr\\rangle_{s'} \\, ds'.\n$$\n我们设$a=0$和$b=s$，并使用第2部分的结果，$\\bigl\\langle \\tfrac{\\partial U}{\\partial s'} \\bigr\\rangle_{s'} = k_{x}s'$。\n$$\nF(s) - F(0) = \\int_{0}^{s} k_{x}s' \\, ds'.\n$$\n执行这个基本积分：\n$$\n\\int_{0}^{s} k_{x}s' \\, ds' = k_{x} \\left[ \\frac{(s')^{2}}{2} \\right]_{0}^{s} = k_{x} \\left( \\frac{s^{2}}{2} - \\frac{0^{2}}{2} \\right) = \\frac{1}{2}k_{x}s^{2}.\n$$\n所以，我们有$F(s) - F(0) = \\frac{1}{2}k_{x}s^{2}$。问题指定了参考值$F(0)=0$，这唯一地确定了平均力势。\n代入$F(0)=0$得到最终表达式：\n$$\nF(s) = \\frac{1}{2}k_{x}s^{2}.\n$$\n这个结果与参数$\\alpha$和$k_y$无关。这是因为对于任何固定的$x=s$，对$y$自由度积分对自由能的贡献是一个与$s$无关的常数。这个常数被吸收到平均力势的参考值中。平均力势（PMF）对$s$的依赖性完全来自于势能中不能通过对其他自由度积分而平均掉的部分。在这种情况下，就是$\\frac{1}{2}k_x x^2$这一项。", "answer": "$$\\boxed{\\frac{1}{2} k_{x} s^{2}}$$", "id": "2685152"}, {"introduction": "在建立了理论基础之后，我们转向一个在实际模拟中常见的实践挑战：处理周期性集体变量，例如二面角。这项练习探讨了在处理此类系统时，设置模拟和分析数据的正确程序。如果未能正确考虑变量的环形拓扑结构，可能会在结果中引入严重的谬误。这项实践强调了确保获得连续且具有物理意义的自由能曲线所必需的关键步骤 [@problem_id:2685124]。", "problem": "使用一个定义在圆环 $S^1$ 上的单一扭转集合变量 (CV) $s(\\mathbf{x})$（例如，一个二面角），通过伞形积分从一组 $M$ 个偏置模拟中计算一维平均力势 (PMF) $F(s)$。该扭转角在主区间 $s \\in [-\\pi,\\pi)$ 内报告，并且在物理上是 $2\\pi$ 周期性的。在每个窗口 $i \\in \\{1,\\dots,M\\}$ 中，一个力常数为 $k$ 的谐波伞形偏置势以 $s_{i}$ 为中心，然后从偏置数据中估计沿 $s$ 的无偏平均力，并对其进行积分以恢复 $F(s)$。\n\n从 PMF 满足 $F(s) = -k_{\\mathrm{B}}T \\ln P(s) + C$ 的统计力学定义出发，其中 $P(s)$ 是由笛卡尔坐标上的玻尔兹曼分布导出的 $s$ 的边缘概率密度，$C$ 是一个任意常数。回想一下，$s$ 存在于一个紧流形 $S^1$ 上，因此除了 $F(s)$ 中的加性常数外，$P(s)$ 和 $F(s)$ 都必须是 $2\\pi$ 周期性的。此外，$F(s)$ 将通过对从偏置模拟中获得的平均力 $-\\mathrm{d}F/\\mathrm{d}s$ 的连续估计值沿圆环进行积分来恢复。\n\n在伞形积分中，为了保证一致地处理周期性CV，并确保重建的 $F(s)$ 具有连续性和正确的周期性边界条件，以下哪些程序是必要且充分的？选择所有适用的选项。\n\nA. 在每个窗口中使用圆环上的最小镜像角位移来定义谐波伞形偏置，例如 $\\Delta s = \\mathrm{atan2}\\!\\left(\\sin(s - s_{0}), \\cos(s - s_{0})\\right)$，并使用 $U_{\\mathrm{bias}}(s) = \\tfrac{1}{2}k\\,\\Delta s^{2}$，以便偏置及其导数在 $s=\\pm\\pi$ 处是连续的，并且靠近 $-\\pi$ 和 $+\\pi$ 的窗口在 $S^1$ 上重叠。\n\nB. 在 $[-\\pi,\\pi)$ 上获得 PMF 导数的连续估计值 $\\widehat{F}'(s)$ 后，通过移除任何净漂移来强制施加周期性边界，例如将 $\\widehat{F}'(s)$ 替换为 $\\widehat{F}'(s) - \\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi}\\widehat{F}'(u)\\,\\mathrm{d}u$，使得 $\\int_{-\\pi}^{\\pi}\\widehat{F}'(s)\\,\\mathrm{d}s = 0$，然后进行积分并选择加性常数以使 $F(-\\pi)=F(\\pi)$。\n\nC. 在 $[-\\pi,\\pi)$ 中构建直方图和力估计，不将计数或力在端点处环绕处理，并丢弃在一个时间步内穿过 $s=\\pi$ 的样本以避免重复计数；数据的损失由其他窗口补偿。\n\nD. 在估计平均力之前，将角度时间序列解开到 $\\mathbb{R}$ 上的一个单调坐标上，在 $\\mathbb{R}$ 上积分以在扩展域中获得 $F(s)$，最后将结果模 $2\\pi$ 折叠回 $[-\\pi,\\pi)$；无论采样覆盖范围或平滑选择如何，这种折叠都能保证周期性。\n\nE. 当平滑含噪的力或自由能估计值时，使用 $s$ 的周期性表示（例如，截断的傅里叶级数基 $\\sum_{n=-N}^{N} c_{n} e^{\\mathrm{i} n s}$ 或 $S^1$ 上的 von Mises 核），而不是 $\\mathbb{R}$ 上的非周期性多项式或高斯核，从而通过构造来强制实现连续性和 $2\\pi$ 周期性。", "solution": "问题要求找出在伞形积分计算中一致地处理周期性集合变量 (CV) $s$ 的必要且充分的程序，以确保得到的平均力势 (PMF) $F(s)$ 是连续且具有正确的周期性。CV $s$ 定义在圆环 $S^1$ 上，这是一个紧流形，并被取值在区间 $[-\\pi, \\pi)$ 内。\n\n此类系统的 PMF 的基本性质源于其定义 $F(s) = -k_{\\mathrm{B}}T \\ln P(s) + C$，其中 $P(s)$ 是概率密度。由于 CV 是 $2\\pi$ 周期性的，构型空间在拓扑上是一个圆环。因此，概率密度必须是周期性的，$P(s)=P(s+2\\pi)$。因此，除了任意的加性常数 $C$ 外，PMF 也必须是周期性的，$F(s) = F(s+2\\pi)$。这意味着 PMF 的导数，即平均力 $F'(s) = \\mathrm{d}F/\\mathrm{d}s$，也必须是一个 $2\\pi$ 周期函数。一个函数 $G(s)$ 是一个周期函数的导数的必要条件是它在一个周期上的积分必须为零。在我们的情况下，这意味着 $\\int_{-\\pi}^{\\pi} F'(s) \\mathrm{d}s = F(\\pi) - F(-\\pi) = 0$。\n\n我们现在将根据这些基本要求来评估每个提议的程序。\n\nA. 在每个窗口中使用圆环上的最小镜像角位移来定义谐波伞形偏置，例如 $\\Delta s = \\mathrm{atan2}\\!\\left(\\sin(s - s_{0}), \\cos(s - s_{0})\\right)$，并使用 $U_{\\mathrm{bias}}(s) = \\tfrac{1}{2}k\\,\\Delta s^{2}$，以便偏置及其导数在 $s=\\pm\\pi$ 处是连续的，并且靠近 $-\\pi$ 和 $+\\pi$ 的窗口在 $S^{1}$ 上重叠。\n\n这个程序解决了偏置模拟的设置问题。使用适用于圆环的距离度量，例如最小镜像角位移，是绝对必要的。如果使用简单的差值 $s-s_0$，一个中心在 $s_i = -\\pi+\\delta$ 的窗口和另一个中心在 $s_j = \\pi-\\delta$ 的窗口（对于小的 $\\delta  0$）将被视为相距很远，距离接近 $2\\pi$。在拓扑上，在圆环 $S^1$ 上，它们是相邻的，相距 $2\\delta$。最小镜像约定正确地反映了 CV 空间的拓扑结构，确保了靠近 $[-\\pi, \\pi)$ 区间任意边界的窗口能够正确重叠。这对于采样跨越边界的过渡区域并获得连续的概率分布估计至关重要。\n\n然而，该陈述包含一个事实错误。势能形式 $U_{\\mathrm{bias}}(s) = \\frac{1}{2}k(\\Delta s)^2$，其中 $\\Delta s = \\mathrm{atan2}(\\sin(s-s_0), \\cos(s-s_0))$，其导数不是连续的。位移 $\\Delta s$ 在 $s = s_0 + (2n+1)\\pi$ 处是不连续的，它在 $\\pi$ 和 $-\\pi$ 之间跳跃。势能 $U_{\\mathrm{bias}}$ 是连续的，因为 $(\\pm\\pi)^2 = \\pi^2$。偏置力 $F_{\\mathrm{bias}} = -\\mathrm{d}U_{\\mathrm{bias}}/\\mathrm{d}s = -k \\Delta s (\\mathrm{d}(\\Delta s)/\\mathrm{d}s) = -k \\Delta s$，在这一点上是不连续的。对于一个类谐波、光滑、周期性的势能，一个更好的选择是余弦函数，$U_{\\mathrm{bias}}(s) = k'(1-\\cos(s-s_0))$，它在 $|s-s_0|$ 很小时是谐波的。\n\n尽管示例中存在这种不精确性，但其核心原则——使用圆环上的距离来定义偏置势——是正确且必要的。没有这一点，整个采样方案在根本上就是有缺陷的。我们应将该选项解释为支持这一核心原则。\n\n结论：**正确**。\n\nB. 在 $[-\\pi,\\pi)$ 上获得 PMF 导数的连续估计值 $\\widehat{F}'(s)$ 后，通过移除任何净漂移来强制施加周期性边界，例如将 $\\widehat{F}'(s)$ 替换为 $\\widehat{F}'(s) - \\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi}\\widehat{F}'(u)\\,\\mathrm{d}u$，使得 $\\int_{-\\pi}^{\\pi}\\widehat{F}'(s)\\,\\mathrm{d}s = 0$，然后进行积分并选择加性常数以使 $F(-\\pi)=F(\\pi)$。\n\n这个程序解决了估计的平均力 $\\widehat{F}'(s)$ 的积分问题。如前所述，为了使 PMF $F(s)$ 成为圆环上的一个有效的、单值的函数，它在一个完整周期内的变化必须为零，即 $\\int_{-\\pi}^{\\pi} F'(s)\\mathrm{d}s = 0$。由于有限采样和其他数值误差，任何估计的平均力 $\\widehat{F}'(s)$ 很可能不满足这个条件，即 $\\int_{-\\pi}^{\\pi} \\widehat{F}'(s)\\mathrm{d}s = \\mathcal{E} \\neq 0$。对这个有缺陷的力剖面进行积分会得到一个在边界处有不连续性的 PMF：$\\widehat{F}(\\pi) - \\widehat{F}(-\\pi) = \\mathcal{E}$。提议的修正定义了一个新的力剖面，$F'_{\\text{corr}}(s) = \\widehat{F}'(s) - \\bar{F}'$，其中 $\\bar{F}' = \\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi}\\widehat{F}'(u)\\mathrm{d}u$ 是平均力，或称“漂移”。修正后力的积分为 $\\int_{-\\pi}^{\\pi} F'_{\\text{corr}}(s)\\mathrm{d}s = \\int_{-\\pi}^{\\pi} \\widehat{F}'(s)\\mathrm{d}s - \\int_{-\\pi}^{\\pi} \\bar{F}'\\mathrm{d}s = \\mathcal{E} - (2\\pi)\\bar{F}' = \\mathcal{E} - (2\\pi)\\frac{\\mathcal{E}}{2\\pi} = 0$。这个程序正确且必要地强制施加了在闭合路径上状态函数的物理约束。这是任何用于周期性变量的伞形积分方案中一个标准且关键的步骤。\n\n结论：**正确**。\n\nC. 在 $[-\\pi,\\pi)$ 中构建直方图和力估计，不将计数或力在端点处环绕处理，并丢弃在一个时间步内穿过 $s=\\pi$ 的样本以避免重复计数；数据的损失由其他窗口补偿。\n\n这个程序在根本上是错误的，并且会导致严重的假象。通过“不环绕计数”将域 $[-\\pi, \\pi)$ 视为一个不连通的线段，忽略了 CV 的周期性。它未能将在物理上相邻的区域（即靠近 $-\\pi$ 和 $+\\pi$ 的区域）进行采样的模拟信息结合起来。仅此一点就会在重建的 PMF 中造成一个大的不连续性。此外，“丢弃穿过 $s=\\pi$ 的样本”会引入严重的偏倚。这等同于在任意边界处放置一个人工的、无限高的势垒。这会系统地从系综中移除有效的轨迹，破坏关于跃迁动力学和平衡分布的信息，并将导致一个在 $s=\\pi$ 处带有虚假势垒的完全错误的 PMF。这个程序与正确的处理方法背道而驰。\n\n结论：**不正确**。\n\nD. 在估计平均力之前，将角度时间序列解开到 $\\mathbb{R}$ 上的一个单调坐标上，在 $\\mathbb{R}$ 上积分以在扩展域中获得 $F(s)$，最后将结果模 $2\\pi$ 折叠回 $[-\\pi,\\pi)$；无论采样覆盖范围或平滑选择如何，这种折叠都能保证周期性。\n\n解开非周期性时间序列是数据处理的一个有效的第一步，因为它可以避免重复的最小镜像计算，从而简化一些后续计算。然而，由于其最终的声明，整个程序是有缺陷的。“折叠”结果（即，从扩展的实线上取位于 $[-\\pi, \\pi)$ 内的 PMF 片段 $F_{\\text{ext}}(s)$）并不能“保证”周期性。周期性要求 $F(-\\pi) = F(\\pi)$。如果扩展的 PMF 存在系统性漂移，使得 $F_{\\text{ext}}(s+2\\pi) \\neq F_{\\text{ext}}(s)$，那么折叠后的片段将表现出不连续性，$F_{\\text{ext}}(\\pi) \\neq F_{\\text{ext}}(-\\pi)$。这种漂移由于统计误差而很常见。在最终的剖面被认为是有效的之前，必须在数据上主动强制施加周期性（例如，在解开的坐标上使用选项 B 或 E 中的方法）。折叠步骤本身不提供这样的保证。这个说法是错误的，使得该程序不充分。\n\n结论：**不正确**。\n\nE. 当平滑含噪的力或自由能估计值时，使用 $s$ 的周期性表示（例如，截断的傅里叶级数基 $\\sum_{n=-N}^{N} c_{n} e^{\\mathrm{i} n s}$ 或 $S^{1}$ 上的 von Mises 核），而不是 $\\mathbb{R}$ 上的非周期性多项式或高斯核，从而通过构造来强制实现连续性和 $2\\pi$ 周期性。\n\n来自模拟的原始数据本质上是含噪的。通常采用平滑或拟合程序来获得平均力或 PMF 的清晰表示。如果对区间 $[-\\pi, \\pi)$ 上的数据应用非周期性平滑函数（例如，在 $\\mathbb{R}$ 上定义的标准多项式或高斯核），平滑后的函数在端点处的值和导数通常不匹配，即 $f(-\\pi) \\neq f(\\pi)$ 和 $f'(-\\pi) \\neq f'(\\pi)$。这在任意边界处引入了一个虚假的接缝，违反了系统的物理原理。相反，使用本身就是周期性的函数基（如傅里叶级数），或使用周期性核（如 von Mises 分布），可以保证得到的平滑函数是周期性的，并且其导数在所有阶（对于傅里叶级数）或指定阶上都是连续的。这在数据分析阶段直接强制施加了问题的正确拓扑结构。如果平滑是工作流程的一部分，则此方法对于保持物理一致性是必要的。\n\n结论：**正确**。\n\n总之，一个完整且稳健的方案需要：尊重周期性拓扑的正确采样 (A)，对平均力强制施加零积分约束以确保 PMF 是一个状态函数 (B)，以及在任何数据平滑中使用能感知周期性的方法以避免引入边界假象 (E)。这三个程序，在模拟和分析的适当阶段应用，对于一致性处理是必要的。", "answer": "$$\\boxed{ABE}$$", "id": "2685124"}, {"introduction": "在前述理论和实践基础之上，这最后一个练习将深入探讨分析良温元动力学（Well-Tempered Metadynamics）模拟结果的一个高级方面。它演示了如何量化一个关键的系统误差来源——即有限宽度的“高斯山”——如何影响重建自由能曲面的准确性。这项练习旨在培养一种批判性思维，从仅仅生成一个平均力势曲线，提升到理解并评估其精度和潜在的局限性 [@problem_id:2685048]。", "problem": "一个一维的集体变量 $s$ 被用来描述一个分子系统在温度 $T$ 下的缓慢转变。沿 $s$ 的平均力势（自由能）由正则边缘分布 $P_{0}(s)$ 定义，通过 $F(s) = -\\beta^{-1} \\ln P_{0}(s) + C$ 给出，其中 $\\beta = (k_{B} T)^{-1}$ 且 $k_{B}$ 是玻尔兹曼常数。进行了一次偏置因子 $\\gamma  1$ 的良温元动力学（Well-Tempered Metadynamics, WTMetaD）模拟，在 $s$ 上沉积宽度为 $\\sigma$ 的高斯势垒，并假设其收敛到一个静态偏置势 $V_{\\infty}(s)$。\n\n从正则定义出发，并利用 WTMetaD 中长时间静态分布沿 $s$ 满足 $P_{V}(s) \\propto \\left[P_{0}(s)\\right]^{1/\\gamma}$ 这一已知性质，执行以下操作：\n\n1. 在极限 $\\sigma \\to 0$ 下，推导 $F(s)$ 和 $V_{\\infty}(s)$ 之间的关系，并写出一个用 $V_{\\infty}(s)$、$\\gamma$ 和 $\\beta$ 表示的显式重构公式 $F_{\\mathrm{rec}}(s)$，结果可相差一个加性常数。\n\n2. 将有限的势垒宽度 $\\sigma$ 视为引起 $\\exp(-\\beta F)$ 的高斯卷积，并在一维情况下，进行小 $\\sigma$ 展开至领先的非平凡阶，以获得朴素重构（忽略 $\\sigma$）与真实 $F(s)$ 之间的依赖于 $s$ 的系统偏差 $\\Delta(s)$。您的推导必须从定义式\n$$\nF_{\\sigma}(s) \\equiv -\\beta^{-1} \\ln \\int_{-\\infty}^{\\infty} \\mathrm{d}s' \\, \\exp\\!\\left[-\\beta F(s')\\right] \\, \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\!\\left[-\\frac{(s-s')^{2}}{2\\sigma^{2}}\\right] + C',\n$$\n开始，并通过对足够光滑的 $F(s)$ 有效的、受控的 $\\sigma$ 泰勒展开来进行。\n\n3. 考虑特定的双势阱自由能\n$$\nF(s) = \\Delta U \\left(\\frac{s^{4}}{4 a^{4}} - \\frac{s^{2}}{2 a^{2}}\\right) + C'',\n$$\n其势阱位于 $s=\\pm a$，势垒位于 $s=0$。使用您对 $\\Delta(s)$ 的结果，计算通过朴素 WTMetaD 重构（忽略有限 $\\sigma$）获得的势垒高度的有符号系统误差，定义为\n$$\n\\delta \\Delta F^{\\ddagger} \\equiv \\big[F_{\\mathrm{naive}}(0) - F_{\\mathrm{true}}(0)\\big] - \\big[F_{\\mathrm{naive}}(a) - F_{\\mathrm{true}}(a)\\big].\n$$\n使用参数 $\\Delta U = 12\\,\\mathrm{kJ\\,mol^{-1}}$，$a = 0.25\\,\\mathrm{nm}$，$\\sigma = 0.05\\,\\mathrm{nm}$，$T = 300\\,\\mathrm{K}$，以及 $\\gamma = 10$。\n\n将您对 $\\delta \\Delta F^{\\ddagger}$ 的最终答案以 $\\mathrm{kJ\\,mol^{-1}}$ 为单位表示，并四舍五入至三位有效数字。", "solution": "所提出的问题在统计力学和增强采样模拟理论的框架内是有效的、有科学依据的且适定的。我们将分三部分进行解答。\n\n平均力势（PMF）$F(s)$ 与沿集体变量 $s$ 的正则概率分布 $P_{0}(s)$ 之间的基本关系由 $F(s) = -\\beta^{-1} \\ln P_{0}(s) + C$ 给出，其中 $\\beta = (k_{B} T)^{-1}$ 且 $C$ 是一个任意常数。这等价于 $P_{0}(s) \\propto \\exp(-\\beta F(s))$。\n在收敛的良温元动力学（WTMetaD）模拟中，由于存在静态偏置势 $V_{\\infty}(s)$，系统采样一个修正的概率分布 $P_{V}(s)$。该分布由 $P_{V}(s) \\propto \\exp(-\\beta[F(s) + V_{\\infty}(s)])$ 给出。问题陈述了 WTMetaD 的关键性质：$P_{V}(s) \\propto [P_{0}(s)]^{1/\\gamma}$，其中 $\\gamma$ 是偏置因子。\n\n第一部分：在理想极限（$\\sigma \\to 0$）下推导 $F(s)$ 的重构公式。\n\n我们令偏置分布 $P_{V}(s)$ 的两种表达式相等：\n$$\n\\exp(-\\beta[F(s) + V_{\\infty}(s)]) \\propto \\left[\\exp(-\\beta F(s))\\right]^{1/\\gamma} = \\exp\\left(-\\frac{\\beta}{\\gamma} F(s)\\right)\n$$\n对两边取自然对数，得到势能之间的一个线性关系，可相差一个加性常数：\n$$\n-\\beta[F(s) + V_{\\infty}(s)] = -\\frac{\\beta}{\\gamma} F(s) + \\mathrm{const.}\n$$\n我们重排此方程，以求解用收敛的偏置势 $V_{\\infty}(s)$ 表示的 PMF $F(s)$。\n$$\n\\beta V_{\\infty}(s) = -\\frac{\\beta}{\\gamma} F(s) + \\beta F(s) + \\mathrm{const'} = \\beta F(s) \\left(1 - \\frac{1}{\\gamma}\\right) + \\mathrm{const'}\n$$\n$$\nV_{\\infty}(s) = \\left(\\frac{\\gamma - 1}{\\gamma}\\right) F(s) + \\mathrm{const''}\n$$\n这表明，收敛的偏置势在相差一个缩放因子和常数的情况下，等于真实 PMF 的负值，这符合预期，因为偏置势的建立是为了抵消自由能形貌。通过反转此关系，可得到自由能的重构公式 $F_{\\mathrm{rec}}(s)$：\n$$\nF_{\\mathrm{rec}}(s) = \\frac{\\gamma}{\\gamma - 1} V_{\\infty}(s) + \\mathrm{const'''}\n$$\n这就是所求的重构公式，在无限窄高斯势垒（$\\sigma \\to 0$）的极限下有效。\n\n第二部分：推导有限 $\\sigma$ 的系统偏差 $\\Delta(s)$。\n\n对于有限的高斯宽度 $\\sigma$，沉积的偏置势并不能完美抵消真实的 PMF。相反，它抵消的是一个“平滑”或卷积过的 PMF 版本。被重构的有效 PMF，我们称之为朴素重构 $F_{\\mathrm{naive}}(s)$，是这个卷积 PMF $F_{\\sigma}(s)$ 的一个估计量。问题将 $F_{\\sigma}(s)$ 定义为：\n$$\nF_{\\sigma}(s) = -\\beta^{-1} \\ln \\int_{-\\infty}^{\\infty} \\mathrm{d}s' \\, \\exp[-\\beta F(s')] \\, \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\left[-\\frac{(s-s')^{2}}{2\\sigma^{2}}\\right] + C'\n$$\n该积分表示 $g(s) = \\exp[-\\beta F(s)]$ 与高斯核 $K_{\\sigma}(s)$ 的卷积。我们通过对 $F(s')$ 在 $s' = s$ 附近进行泰勒展开来分析这个积分。令 $u = s' - s$。\n$$\nF(s') = F(s) + F'(s) u + \\frac{1}{2} F''(s) u^{2} + O(u^{3})\n$$\n将此代入积分：\n$$\nI(s) = \\int_{-\\infty}^{\\infty} \\mathrm{d}u \\, \\exp\\left[-\\beta \\left(F(s) + F'(s) u + \\frac{1}{2} F''(s) u^{2} + \\dots\\right)\\right] \\, \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\left[-\\frac{u^{2}}{2\\sigma^{2}}\\right]\n$$\n提出与 $u$ 无关的项：\n$$\nI(s) = \\exp[-\\beta F(s)] \\int_{-\\infty}^{\\infty} \\mathrm{d}u \\, \\exp\\left[-\\beta \\left(F'(s) u + \\frac{1}{2} F''(s) u^{2} + \\dots\\right)\\right] \\frac{\\exp\\left[-u^{2}/(2\\sigma^{2})\\right]}{\\sqrt{2\\pi}\\,\\sigma}\n$$\n对于小 $\\sigma$，高斯核在 $u=0$ 处急剧达到峰值，所以我们可以对另一个指数项进行小 $u$ 展开：\n$$\n\\exp\\left[-\\beta \\left(F'(s) u + \\frac{1}{2} F''(s) u^{2} + \\dots\\right)\\right] \\approx 1 - \\beta F'(s) u + \\left( \\frac{1}{2} \\beta^{2} [F'(s)]^{2} - \\frac{1}{2} \\beta F''(s) \\right) u^{2} + \\dots\n$$\n积分变成了此展开式在均值为 $0$、方差为 $\\sigma^{2}$ 的高斯分布下的期望值。该分布的矩为 $\\langle u \\rangle = 0$，$\\langle u^{2} \\rangle = \\sigma^{2}$，$\\langle u^{3} \\rangle = 0$ 等。\n$$\nI(s) \\approx \\exp[-\\beta F(s)] \\left( 1 - \\beta F'(s) \\langle u \\rangle + \\left( \\frac{1}{2} \\beta^{2} [F'(s)]^{2} - \\frac{1}{2} \\beta F''(s) \\right) \\langle u^{2} \\rangle \\right)\n$$\n$$\nI(s) \\approx \\exp[-\\beta F(s)] \\left( 1 + \\frac{\\sigma^{2}}{2} \\left( \\beta^{2} [F'(s)]^{2} - \\beta F''(s) \\right) \\right)\n$$\n现在我们将此代回 $F_{\\sigma}(s)$ 的表达式中：\n$$\nF_{\\sigma}(s) \\approx -\\beta^{-1} \\ln \\left[ \\exp[-\\beta F(s)] \\left( 1 + \\frac{\\sigma^{2}}{2} \\left( \\beta^{2} [F'(s)]^{2} - \\beta F''(s) \\right) \\right) \\right] + C'\n$$\n使用 $\\ln(ab) = \\ln(a) + \\ln(b)$ 以及对于小 $x$ 的近似 $\\ln(1+x) \\approx x$：\n$$\nF_{\\sigma}(s) \\approx -\\beta^{-1} \\left[ -\\beta F(s) + \\ln \\left( 1 + \\frac{\\sigma^{2}}{2} \\left( \\beta^{2} [F'(s)]^{2} - \\beta F''(s) \\right) \\right) \\right] + C'\n$$\n$$\nF_{\\sigma}(s) \\approx F(s) - \\beta^{-1} \\left[ \\frac{\\sigma^{2}}{2} \\left( \\beta^{2} [F'(s)]^{2} - \\beta F''(s) \\right) \\right] + C''\n$$\n$$\nF_{\\sigma}(s) \\approx F(s) + \\frac{\\sigma^{2}}{2} \\left( F''(s) - \\beta [F'(s)]^{2} \\right) + C''\n$$\n系统偏差为 $\\Delta(s) = F_{\\mathrm{naive}}(s) - F_{\\mathrm{true}}(s)$。由于 $F_{\\mathrm{naive}}(s) \\approx F_{\\sigma}(s)$ 且 $F_{\\mathrm{true}}(s) = F(s)$，我们有：\n$$\n\\Delta(s) = \\frac{\\sigma^{2}}{2} \\left( F''(s) - \\beta [F'(s)]^{2} \\right)\n$$\n这是领先的非平凡阶（$\\sigma^2$）修正。\n\n第三部分：计算势垒高度的有符号系统误差。\n\n势垒高度的误差定义为 $\\delta \\Delta F^{\\ddagger} \\equiv [F_{\\mathrm{naive}}(0) - F_{\\mathrm{true}}(0)] - [F_{\\mathrm{naive}}(a) - F_{\\mathrm{true}}(a)]$。这等于 $\\Delta(0) - \\Delta(a)$。\n给定的 PMF 是 $F(s) = \\Delta U (\\frac{s^{4}}{4 a^{4}} - \\frac{s^{2}}{2 a^{2}}) + C''$。我们计算它的一阶和二阶导数：\n$$\nF'(s) = \\Delta U \\left( \\frac{s^{3}}{a^{4}} - \\frac{s}{a^{2}} \\right)\n$$\n$$\nF''(s) = \\Delta U \\left( \\frac{3s^{2}}{a^{4}} - \\frac{1}{a^{2}} \\right)\n$$\n我们在势垒顶部（$s=0$）和势阱中（$s=a$）计算这些导数：\n在 $s=0$ 处：\n$F'(0) = 0$\n$F''(0) = \\Delta U (0 - \\frac{1}{a^{2}}) = -\\frac{\\Delta U}{a^{2}}$\n在 $s=a$ 处：\n$F'(a) = \\Delta U (\\frac{a^{3}}{a^{4}} - \\frac{a}{a^{2}}) = 0$\n$F''(a) = \\Delta U (\\frac{3a^{2}}{a^{4}} - \\frac{1}{a^{2}}) = \\Delta U (\\frac{3}{a^{2}} - \\frac{1}{a^{2}}) = \\frac{2\\Delta U}{a^{2}}$\n现在我们使用第二部分的公式计算 $\\Delta(0)$ 和 $\\Delta(a)$：\n$$\n\\Delta(0) = \\frac{\\sigma^{2}}{2} \\left( F''(0) - \\beta [F'(0)]^{2} \\right) = \\frac{\\sigma^{2}}{2} \\left( -\\frac{\\Delta U}{a^{2}} - 0 \\right) = -\\frac{\\sigma^{2} \\Delta U}{2 a^{2}}\n$$\n$$\n\\Delta(a) = \\frac{\\sigma^{2}}{2} \\left( F''(a) - \\beta [F'(a)]^{2} \\right) = \\frac{\\sigma^{2}}{2} \\left( \\frac{2\\Delta U}{a^{2}} - 0 \\right) = \\frac{\\sigma^{2} \\Delta U}{a^{2}}\n$$\n注意，由于我们是在 PMF 的驻点处评估误差，包含 $\\beta$ 的项消失了。\n势垒高度的系统误差是：\n$$\n\\delta \\Delta F^{\\ddagger} = \\Delta(0) - \\Delta(a) = -\\frac{\\sigma^{2} \\Delta U}{2 a^{2}} - \\frac{\\sigma^{2} \\Delta U}{a^{2}} = -\\frac{3 \\sigma^{2} \\Delta U}{2 a^{2}}\n$$\n现在，我们代入给定的数值：$\\Delta U = 12\\,\\mathrm{kJ\\,mol^{-1}}$，$a = 0.25\\,\\mathrm{nm}$，以及 $\\sigma = 0.05\\,\\mathrm{nm}$。\n$$\n\\delta \\Delta F^{\\ddagger} = -\\frac{3 \\times (0.05\\,\\mathrm{nm})^{2} \\times (12\\,\\mathrm{kJ\\,mol^{-1}})}{2 \\times (0.25\\,\\mathrm{nm})^{2}}\n$$\n$$\n\\delta \\Delta F^{\\ddagger} = -\\frac{3 \\times 0.0025}{2 \\times 0.0625} \\times 12\\,\\mathrm{kJ\\,mol^{-1}} = -\\frac{3}{2} \\left(\\frac{0.05}{0.25}\\right)^{2} \\times 12\\,\\mathrm{kJ\\,mol^{-1}}\n$$\n$$\n\\delta \\Delta F^{\\ddagger} = -\\frac{3}{2} \\left(\\frac{1}{5}\\right)^{2} \\times 12\\,\\mathrm{kJ\\,mol^{-1}} = -\\frac{3}{2} \\times \\frac{1}{25} \\times 12\\,\\mathrm{kJ\\,mol^{-1}}\n$$\n$$\n\\delta \\Delta F^{\\ddagger} = -\\frac{36}{50}\\,\\mathrm{kJ\\,mol^{-1}} = -0.72\\,\\mathrm{kJ\\,mol^{-1}}\n$$\n四舍五入到三位有效数字，最终结果是 $-0.720\\,\\mathrm{kJ\\,mol^{-1}}$。负号表示有限的高斯势垒宽度导致对自由能势垒高度的系统性低估。", "answer": "$$\n\\boxed{-0.720}\n$$", "id": "2685048"}]}