{"hands_on_practices": [{"introduction": "著名的 Landau-Zener 公式是在无限时间等近似条件下对一个简化模型的解析解。本练习提供了一种直接检验该公式的方法：通过数值求解底层的含时薛定谔方程（TDSE）。这项实践通过模拟量子系统穿过避开交叉区域的动力学过程，帮助我们建立直观理解，并验证其向解析极限的收敛性。[@problem_id:2652123]", "problem": "考虑时间相关的薛定谔方程 (Time-Dependent Schrödinger Equation, TDSE) $i \\hbar \\, \\frac{d}{dt}\\psi(t) = H(t)\\,\\psi(t)$，它描述了与化学反应网络中的非绝热跃迁相关的双能级系统，并在无量纲单位中进行计算，其中 $\\hbar = 1$。Landau–Zener 模型在非绝热基中指定了一个线性含时哈密顿量，如下所示\n$$\nH(t) = \\begin{pmatrix}\n\\frac{v t}{2}  \\Delta \\\\\n\\Delta  -\\frac{v t}{2}\n\\end{pmatrix},\n$$\n其中 $v > 0$ 是非绝热能量的恒定斜率差，$\\Delta > 0$ 是不含时的非绝热耦合。令 $\\psi(t)$ 是一个归一化的双分量态矢量。取 $t=-t_{\\max}$ 时的初始条件为第一个非绝热态，即 $\\psi(-t_{\\max}) = (1,0)^{\\top}$。\n\n您的任务是为 TDSE 实现一个数值积分器，即在有限时间区间 $t \\in [-t_{\\max}, t_{\\max}]$ 上求解\n$$\ni \\frac{d}{dt}\\psi(t) = H(t)\\psi(t),\n$$\n并计算数值 Landau–Zener 跃迁概率 $P_{\\mathrm{num}}(\\Delta, v, t_{\\max})$，其定义为在 $t=+t_{\\max}$ 时占据初始非绝热态的概率：\n$$\nP_{\\mathrm{num}}(\\Delta, v, t_{\\max}) = \\left|\\psi_1(t_{\\max})\\right|^2,\n$$\n其中 $\\psi_1$ 是 $\\psi$ 在非绝热基中的第一个分量。\n\n从第一性原理（TDSE 和给定的哈密顿量）出发，推导如何计算 $P_{\\mathrm{num}}$ 以及当 $t_{\\max} \\to \\infty$ 时的预期渐进行为。使用一个适用于光滑、非刚性复值系统的高精度自适应积分器。为保证数值稳定性和科学真实性，请确保在事后验证范数守恒（允许存在微小的数值误差），并使用能够观察到在 $t_{\\max}$ 上渐进收敛的容差。\n\n为了验证当 $\\pm t_{\\max} \\to \\infty$ 时向解析 Landau–Zener 极限的收敛性，定义绝对误差\n$$\n\\varepsilon(\\Delta, v, t_{\\max}) = \\left| P_{\\mathrm{num}}(\\Delta, v, t_{\\max}) - P_{\\mathrm{LZ}}(\\Delta, v) \\right|,\n$$\n其中 $P_{\\mathrm{LZ}}(\\Delta, v)$ 是指定哈密顿量的闭式 Landau–Zener 概率。尽管在您的推导中不得使用简便公式，但在您的解中推导出解析的 $P_{\\mathrm{LZ}}(\\Delta, v)$ 后，您的程序可以对其进行求值以计算 $\\varepsilon$。\n\n实现一个程序，为以下参数三元组 $(\\Delta, v, t_{\\max})$ 的测试套件计算 $\\varepsilon$：\n- $(\\Delta, v, t_{\\max}) = (0.5, 1.0, 6.0)$,\n- $(\\Delta, v, t_{\\max}) = (0.5, 1.0, 10.0)$,\n- $(\\Delta, v, t_{\\max}) = (0.5, 1.0, 14.0)$,\n- $(\\Delta, v, t_{\\max}) = (1.0, 0.5, 8.0)$,\n- $(\\Delta, v, t_{\\max}) = (1.0, 0.5, 12.0)$,\n- $(\\Delta, v, t_{\\max}) = (1.0, 0.5, 16.0)$,\n- $(\\Delta, v, t_{\\max}) = (0.1, 1.5, 6.0)$,\n- $(\\Delta, v, t_{\\max}) = (0.1, 1.5, 10.0)$,\n- $(\\Delta, v, t_{\\max}) = (0.1, 1.5, 14.0)$。\n\n为覆盖率而设计：\n- 前三种情况是具有中等耦合和速度的一般场景，用于评估基本收敛性。\n- 接下来的三种情况探测绝热区（较大的 $\\Delta$ 和较小的 $v$），其中跃迁概率很小，用于测试积分器在小概率附近的精度。\n- 最后三种情况探测非绝热区（较小的 $\\Delta$ 和较大的 $v$），其中跃迁概率接近于 1，用于测试边界附近的稳定性。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[r_1,r_2,\\ldots,r_9]$），其中每个 $r_k$ 是为第 $k$ 个参数三元组计算出的绝对误差 $\\varepsilon$，表示为一个无单位（无量纲）的浮点数。", "solution": "所提出的问题是计算量子动力学中的一个有效练习。它在科学上基于成熟的 Landau-Zener 非绝热跃迁模型，这是化学动力学和物理学中的一个基本概念。该问题是适定的，提供了一套完整的参数、一个清晰的微分方程、一个明确的初始条件以及一个待计算的特定量。所有术语都得到了明确的定义，并且设置在数学和物理上是一致的。因此，我们将着手进行求解。\n\n问题的核心是在无量纲单位（$\\hbar=1$）下求解一个双能级量子系统的时间相关薛定谔方程 (TDSE)。TDSE 由以下公式给出：\n$$\ni \\frac{d}{dt}\\psi(t) = H(t)\\psi(t)\n$$\n态矢量是一个双分量复矢量，$\\psi(t) = \\begin{pmatrix} \\psi_1(t) \\\\ \\psi_2(t) \\end{pmatrix}$，而含时哈密顿量 $H(t)$ 由以下矩阵给出：\n$$\nH(t) = \\begin{pmatrix}\n\\frac{v t}{2}  \\Delta \\\\\n\\Delta  -\\frac{v t}{2}\n\\end{pmatrix}\n$$\n其中 $v > 0$ 和 $\\Delta > 0$ 是实数参数。该哈密顿矩阵是厄米矩阵，这确保了时间演化算符是幺正的，并且态矢量的范数 $\\|\\psi(t)\\|^2 = |\\psi_1(t)|^2 + |\\psi_2(t)|^2$ 是一个守恒量。\n\n为了准备数值积分，我们可以将该方程写成一阶常微分方程 (ODE) 组。矩阵方程展开为：\n$$\ni \\frac{d\\psi_1}{dt} = \\frac{v t}{2} \\psi_1(t) + \\Delta \\psi_2(t)\n$$\n$$\ni \\frac{d\\psi_2}{dt} = \\Delta \\psi_1(t) - \\frac{v t}{2} \\psi_2(t)\n$$\n对于标准的数值 ODE 求解器，我们将系统表示为 $\\frac{d\\vec{y}}{dt} = \\vec{f}(t, \\vec{y})$ 的形式。将 TDSE 乘以 $-i$（并使用 $1/i = -i$），我们得到：\n$$\n\\frac{d\\psi}{dt} = -i H(t) \\psi(t)\n$$\n这是一个关于复变量 $\\psi_1(t)$ 和 $\\psi_2(t)$ 的由两个耦合的线性一阶 ODE 组成的系统。我们必须在时间区间 $t \\in [-t_{\\max}, t_{\\max}]$ 上求解此系统，初始条件为 $\\psi(-t_{\\max}) = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$。\n\n该问题要求使用一个适用于光滑、非刚性系统的高精度自适应积分器。哈密顿量的系数是关于 $t$ 的线性函数，这使得系统是光滑的。它不是刚性的。因此，高阶 Runge-Kutta 方法，例如 $8(5,3)$ 阶的 Dormand-Prince 方法 (DOP853)，是一个绝佳的选择。现代科学库，例如 Python 中的 `scipy.integrate.solve_ivp`，可以直接对复值 ODE 系统进行积分，这大大简化了实现过程。我们将设置严格的绝对和相对容差（例如 $10^{-13}$），以确保来自数值积分方案的误差远小于因使用有限时间区间 $[-t_{\\max}, t_{\\max}]$ 而产生的物理误差。\n\n在数值积分之后，我们获得最终时刻的态矢量 $\\psi(t_{\\max})$。问题将数值概率 $P_{\\mathrm{num}}$ 定义为发现系统处于其初始非绝热态的概率，该概率由态矢量第一个分量的模的平方给出：\n$$\nP_{\\mathrm{num}}(\\Delta, v, t_{\\max}) = |\\psi_1(t_{\\max})|^2\n$$\n\n为了计算误差 $\\varepsilon$，我们必须将此数值结果与著名的解析 Landau-Zener 概率 $P_{\\mathrm{LZ}}(\\Delta, v)$ 进行比较，后者对应于 $t_{\\max} \\to \\infty$ 的极限。该公式的推导考虑了系统的绝热能级，它们是 $H(t)$ 的瞬时本征值。这些本征值可以通过特征方程 $\\det(H(t) - E I) = 0$ 求得，得出：\n$$\nE_{\\pm}(t) = \\pm \\sqrt{\\left(\\frac{v t}{2}\\right)^2 + \\Delta^2}\n$$\n这些能级在 $t=0$ 处形成一个避免交叉，最小能隙为 $2\\Delta$。在 $t \\to -\\infty$ 时的初始态是非绝热态 $|\\phi_1\\rangle = (1, 0)^{\\top}$。此时，对角元 $H_{11}(t) = vt/2 \\to -\\infty$，所以 $|\\phi_1\\rangle$ 对应于较低的绝热本征态 $E_{-}(t)$。在一个完全绝热的演化中（无限慢的变化，$v \\to 0$），系统将保持在较低的能面上，并在 $t \\to +\\infty$ 时演化成非绝热态 $|\\phi_2\\rangle = (0, 1)^{\\top}$，因为对于大的正 $t$，$H_{22}(t) = -vt/2$ 是较低的能量。\n\n然而，对于有限的速率 $v > 0$，存在非绝热跃迁的概率，系统在避免交叉处“跳跃”到较高的绝热能面 $E_{+}(t)$。这对应于系统保持在初始非绝热态 $|\\phi_1\\rangle$。这种跃迁的概率，也正是初始非绝热态的存活概率，由 Landau-Zener 公式给出：\n$$\nP_{\\mathrm{LZ}}(\\Delta, v) = \\exp\\left(-\\frac{2\\pi \\Delta^2}{\\hbar v}\\right)\n$$\n在我们的无量纲单位中 $\\hbar=1$，该公式变为：\n$$\nP_{\\mathrm{LZ}}(\\Delta, v) = \\exp\\left(-\\frac{2\\pi \\Delta^2}{v}\\right)\n$$\n然后，绝对误差 $\\varepsilon$ 计算如下：\n$$\n\\varepsilon(\\Delta, v, t_{\\max}) = \\left| P_{\\mathrm{num}}(\\Delta, v, t_{\\max}) - P_{\\mathrm{LZ}}(\\Delta, v) \\right|\n$$\n数值实现将遍历所提供的测试用例，对每组 $(\\Delta, v, t_{\\max})$ 进行积分，计算 $P_{\\mathrm{num}}$，将其与解析的 $P_{\\mathrm{LZ}}$ 进行比较，并存储产生的绝对误差 $\\varepsilon$。作为对数值积分质量的最终验证，应检查最终态矢量 $\\|\\psi(t_{\\max})\\|$ 的范数是否在小容差内为 1，以确认模拟的量子演化的幺正性。对于固定的 $(\\Delta, v)$ 对，当 $t_{\\max}$ 增加时 $\\varepsilon$ 的减小将证明有限时间数值解向渐近解析结果的收敛。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Computes the absolute error between the numerical solution of the\n    time-dependent Schrödinger equation for a two-level Landau-Zener system\n    and the analytic Landau-Zener transition probability.\n    \"\"\"\n    \n    # Test cases are given as tuples of (delta, v, t_max).\n    test_cases = [\n        (0.5, 1.0, 6.0),\n        (0.5, 1.0, 10.0),\n        (0.5, 1.0, 14.0),\n        (1.0, 0.5, 8.0),\n        (1.0, 0.5, 12.0),\n        (1.0, 0.5, 16.0),\n        (0.1, 1.5, 6.0),\n        (0.1, 1.5, 10.0),\n        (0.1, 1.5, 14.0),\n    ]\n\n    results = []\n\n    def schrodinger_rhs(t, psi, delta, v):\n        \"\"\"\n        Defines the right-hand side of the TDSE in the form dy/dt = f(t, y).\n        The equation is d(psi)/dt = -i * H(t) * psi.\n        \n        Args:\n            t (float): Time.\n            psi (np.ndarray): State vector [psi_1, psi_2], complex-valued.\n            delta (float): Diabatic coupling.\n            v (float): Difference in slopes of diabatic energies.\n            \n        Returns:\n            np.ndarray: The time derivative of the state vector.\n        \"\"\"\n        # The Hamiltonian H(t) is [[v*t/2, delta], [delta, -v*t/2]].\n        H00 = 0.5 * v * t\n        H11 = -H00\n        H01 = delta\n        H10 = delta\n        \n        psi1, psi2 = psi\n        \n        # d(psi)/dt = -i * H * psi\n        d_psi1_dt = -1j * (H00 * psi1 + H01 * psi2)\n        d_psi2_dt = -1j * (H10 * psi1 + H11 * psi2)\n        \n        return np.array([d_psi1_dt, d_psi2_dt])\n\n    for delta, v, t_max in test_cases:\n        # Initial condition: psi(-t_max) = [1, 0]^T\n        psi0 = np.array([1.0 + 0.0j, 0.0 + 0.0j])\n        \n        # Time interval for integration\n        t_span = [-t_max, t_max]\n        \n        # Perform high-accuracy numerical integration using a high-order method.\n        # Tolerances are set to be very strict to ensure the numerical error\n        # from the integrator is negligible compared to the physical error\n        # from the finite time interval.\n        sol = solve_ivp(\n            fun=schrodinger_rhs,\n            t_span=t_span,\n            y0=psi0,\n            args=(delta, v),\n            method='DOP853',  # High-order adaptive Runge-Kutta method\n            rtol=1e-13,\n            atol=1e-13\n        )\n        \n        # Extract the final state vector at t = t_max\n        psi_final = sol.y[:, -1]\n        \n        # A posteriori check for norm preservation (optional but good practice)\n        # The norm should be 1 for unitary evolution.\n        norm = np.linalg.norm(psi_final)\n        if not np.isclose(norm, 1.0, rtol=1e-9, atol=1e-9):\n             # This block is for verification and would not typically be in\n             # production code unless for debugging.\n             # In a strict setting, this might even raise an error.\n             print(f\"Warning: Norm preservation failed for case ({delta}, {v}, {t_max}). Norm = {norm}\")\n\n        # Numerical probability P_num is |psi_1(t_max)|^2\n        p_num = np.abs(psi_final[0])**2\n        \n        # Analytic Landau-Zener probability P_LZ = exp(-2*pi*delta^2 / v)\n        # for a transition that remains on the diabatic curve (and jumps\n        # between adiabatic curves). With h_bar = 1.\n        p_lz = np.exp(-2.0 * np.pi * delta**2 / v)\n        \n        # Compute the absolute error\n        error = np.abs(p_num - p_lz)\n        results.append(error)\n\n    # Format the output as a comma-separated list in brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2652123"}, {"introduction": "在真实的化学体系中，分子并非都以相同的速度运动。为了计算宏观速率常数，我们需要将微观跃迁概率在速度的热分布上进行平均。本练习演示了将微观理论与实验可观测量联系起来的关键一步，并采用一种强大的数值技术（高斯-拉盖尔积分）来处理这个具有挑战性的积分。[@problem_id:2652090]", "problem": "本题要求你计算朗道-齐纳跃迁概率在麦克斯韦-玻尔兹曼速度分布下的热平均值，并为此设计一个数值稳定的求积方案。考虑一个具有约化质量 $\\mu$ 的一维反应坐标和一个线性避免交叉，其特征为非绝热耦合 $V$（能量单位）和恒定的斜率差大小 $|\\Delta F|$（力的单位）。对于以速率 $v \\equiv \\dot{R} > 0$ 穿过避免交叉的轨迹，其朗道-齐纳非绝热跃迁概率由经过充分检验的朗道-齐纳公式给出\n$$\nP_{\\mathrm{LZ}}(v) \\;=\\; \\exp\\!\\left( - \\frac{2\\pi V^2}{\\hbar\\, v\\, |\\Delta F|} \\right),\n$$\n其中 $\\hbar$ 是约化普朗克常数。在绝对温度 $T$ 下，沿反应坐标的正速率 $v > 0$ 的热分布可通过对一维麦克斯韦-玻尔兹曼分布进行通量加权得到，从而产生归一化权重\n$$\nw_T(v) \\;=\\; \\frac{\\mu}{k_{\\mathrm{B}} T}\\, v \\, \\exp\\!\\left( - \\frac{\\mu v^2}{2 k_{\\mathrm{B}} T} \\right),\n$$\n其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数。$P_{\\mathrm{LZ}}$ 的热平均因此为\n$$\n\\langle P_{\\mathrm{LZ}} \\rangle_T \\;=\\; \\int_{0}^{\\infty} P_{\\mathrm{LZ}}(v)\\, w_T(v)\\, dv,\n$$\n这是一个无量纲数。\n\n你的任务是：\n1) 从上述定义和变量替换 $t = \\frac{\\mu v^2}{2 k_{\\mathrm{B}} T}$ 出发，推导出一个积分形式，该形式能与权重函数为 $\\exp(-t)$（在 $[0,\\infty)$ 上）的经典高斯求积法则自然配对，并解释为何这种映射能改善小速率和大速率下的数值稳定性。\n2) 基于该映射，提出并实现一个数值稳定的求积方案来计算 $\\langle P_{\\mathrm{LZ}} \\rangle_T$。你的实现必须是自包含的，且不要求任何输入。使用具有 $N=64$ 和 $N=128$ 个节点的高斯-拉盖尔求积法来生成一个近似值和一个后验误差估计。将用 $N=128$ 个节点计算的近似值作为最终值报告，并将 $N=128$ 节点和 $N=64$ 节点结果之间的绝对差作为误差估计。误差估计必须是一个非负浮点数。\n3) 使用以下常数和单位：\n- $\\hbar$ 单位为 $\\mathrm{J\\,s}$，\n- $k_{\\mathrm{B}}$ 单位为 $\\mathrm{J/K}$，\n- $\\mu$ 单位为 $\\mathrm{kg}$，\n- $|\\Delta F|$ 单位为 $\\mathrm{N}$，\n- $V$ 单位为 $\\mathrm{J}$，\n- $T$ 单位为 $\\mathrm{K}$。\n所有计算必须在国际单位制（SI）中进行。最终的热平均 $\\langle P_{\\mathrm{LZ}} \\rangle_T$ 是无量纲的，因此输出值不需要单位。\n4) 对于数值计算，使用物理上合理的固定参数 $\\mu = 1.0\\times 10^{-26}~\\text{kg}$ 和 $|\\Delta F| = 1.0\\times 10^{-9}~\\text{N}$。使用以下 $(T, V)$ 参数集的测试套件，以确保覆盖各种情形：\n- 情况1（中等温度，弱耦合）：$T = 300~\\text{K}$，$V = 1.0\\times 10^{-22}~\\text{J}$。\n- 情况2（中等温度，中等耦合）：$T = 300~\\text{K}$，$V = 5.0\\times 10^{-22}~\\text{J}$。\n- 情况3（较低温度，相同中等耦合）：$T = 100~\\text{K}$，$V = 5.0\\times 10^{-22}~\\text{J}$。\n- 情况4（较高温度，强耦合）：$T = 1000~\\text{K}$，$V = 1.0\\times 10^{-21}~\\text{J}$。\n- 情况5（低温，非常强的耦合）：$T = 50~\\text{K}$，$V = 5.0\\times 10^{-21}~\\text{J}$。\n- 情况6（极高温度，极弱耦合）：$T = 2000~\\text{K}$，$V = 1.0\\times 10^{-23}~\\text{J}$。\n5) 要求的最终输出格式：你的程序必须打印单行，包含一个 Python 风格的六项列表，每个项目是一个双元素浮点数列表，顺序为 $[\\langle P_{\\mathrm{LZ}} \\rangle_T, \\text{err}]$。每个浮点数使用八位有效数字。例如，两个案例的有效输出看起来像 [[0.12345679,1.234e-08],[0.98765432,2.468e-09]]（你的输出应在单个列表中包含所有六个案例）。不应打印任何额外文本。\n\n所有结果都是无量纲浮点数，并且必须按规定以八位有效数字打印。此问题中不涉及角度，因此不需要指定角度单位。", "solution": "问题陈述已经过严格验证，被认为是科学上合理、良定且无歧义的。它基于量子力学和统计力学的既定原理，特别是朗道-齐纳理论和麦克斯韦-玻尔兹曼分布。唯一解所需的所有参数和条件均已提供。因此，我们可以进行推导和数值求解。\n\n目标是计算朗道-齐纳跃迁概率的热平均值 $\\langle P_{\\mathrm{LZ}} \\rangle_T$：\n$$\n\\langle P_{\\mathrm{LZ}} \\rangle_T = \\int_{0}^{\\infty} P_{\\mathrm{LZ}}(v)\\, w_T(v)\\, dv\n$$\n其组成部分是朗道-齐纳概率，\n$$\nP_{\\mathrm{LZ}}(v) = \\exp\\!\\left( - \\frac{2\\pi V^2}{\\hbar\\, v\\, |\\Delta F|} \\right)\n$$\n以及通量加权的速度分布，\n$$\nw_T(v) = \\frac{\\mu}{k_{\\mathrm{B}} T}\\, v \\, \\exp\\!\\left( - \\frac{\\mu v^2}{2 k_{\\mathrm{B}} T} \\right)\n$$\n其中 $v$ 是速率，$V$ 是非绝热耦合，$|\\Delta F|$ 是力差，$\\mu$ 是约化质量，$T$ 是温度，$\\hbar$ 和 $k_{\\mathrm{B}}$ 分别是约化普朗克常数和玻尔兹曼常数。完整的积分为：\n$$\n\\langle P_{\\mathrm{LZ}} \\rangle_T = \\int_{0}^{\\infty} \\exp\\!\\left( - \\frac{2\\pi V^2}{\\hbar v |\\Delta F|} \\right) \\frac{\\mu v}{k_{\\mathrm{B}} T} \\exp\\!\\left( - \\frac{\\mu v^2}{2 k_{\\mathrm{B}} T} \\right) dv\n$$\n问题要求进行变量替换，换为无量纲能量 $t = \\frac{\\mu v^2}{2 k_{\\mathrm{B}} T}$。我们来推导积分的变换。微分 $dt$ 通过对 $v$ 求导得到：\n$$\ndt = \\frac{d}{dv} \\left( \\frac{\\mu v^2}{2 k_{\\mathrm{B}} T} \\right) dv = \\frac{2\\mu v}{2 k_{\\mathrm{B}} T} dv = \\frac{\\mu v}{k_{\\mathrm{B}} T} dv\n$$\n这一项 $\\frac{\\mu v}{k_{\\mathrm{B}} T} dv$ 直接出现在被积函数中。麦克斯韦-玻尔兹曼指数项变换为 $\\exp\\!\\left( - \\frac{\\mu v^2}{2 k_{\\mathrm{B}} T} \\right) = \\exp(-t)$。因此，加权微分元 $w_T(v)dv$ 简化为：\n$$\nw_T(v) dv = \\left[ \\exp\\!\\left( - \\frac{\\mu v^2}{2 k_{\\mathrm{B}} T} \\right) \\right] \\left( \\frac{\\mu v}{k_{\\mathrm{B}} T} dv \\right) = e^{-t} dt\n$$\n积分限保持不变，因为 $v \\in [0, \\infty)$ 映射到 $t \\in [0, \\infty)$。接下来，我们将 $P_{\\mathrm{LZ}}(v)$ 项表示为 $t$ 的函数。根据 $t$ 的定义，对于 $v>0$，速度 $v$ 由 $v = \\sqrt{\\frac{2 k_{\\mathrm{B}} T t}{\\mu}}$ 给出。将其代入 $P_{\\mathrm{LZ}}(v)$：\n$$\nP_{\\mathrm{LZ}}(t) = \\exp\\!\\left( - \\frac{2\\pi V^2}{\\hbar |\\Delta F|} \\left(\\sqrt{\\frac{2 k_{\\mathrm{B}} T t}{\\mu}}\\right)^{-1} \\right) = \\exp\\!\\left( - \\frac{2\\pi V^2}{\\hbar |\\Delta F|} \\sqrt{\\frac{\\mu}{2 k_{\\mathrm{B}} T}} \\frac{1}{\\sqrt{t}} \\right)\n$$\n为简化此表达式，我们引入一个无量纲参数 $\\gamma$，它包含了系统的所有物理参数：\n$$\n\\gamma = \\frac{2\\pi V^2}{\\hbar |\\Delta F|} \\sqrt{\\frac{\\mu}{2 k_{\\mathrm{B}} T}}\n$$\n根据这个定义，$P_{\\mathrm{LZ}}(t)$ 变为 $\\exp(-\\gamma/\\sqrt{t})$。因此，完整的变换后的积分为：\n$$\n\\langle P_{\\mathrm{LZ}} \\rangle_T = \\int_{0}^{\\infty} \\exp\\left(-\\frac{\\gamma}{\\sqrt{t}}\\right) e^{-t} dt\n$$\n该积分是高斯-拉盖尔求积法的典范形式 $\\int_0^\\infty f(t) e^{-t} dt$，其中待由多项式逼近的函数是 $f(t) = \\exp(-\\gamma/\\sqrt{t})$。\n\n这种变换不仅仅是为了数学上的便利；它是确保数值稳定性和准确性的关键一步。\n1.  **隔离主导衰减：** 麦克斯韦-玻尔兹曼分布包含 $\\exp(-\\frac{\\mu v^2}{2 k_{\\mathrm{B}} T})$ 项，该项导致高速率下的快速衰减。这一项成为高斯-拉盖尔求积的权重函数 $e^{-t}$。通过将此权重函数纳入求积法则的节点和权重中，数值方法可以集中精力逼近更平滑、非衰减的函数 $f(t)$。这比必须解析原始被积函数完整峰状结构的通用积分器效率高得多。\n2.  **缓解奇点：** 原始被积函数包含项 $P_{\\mathrm{LZ}}(v) \\propto \\exp(-\\text{const}/v)$，在 $v=0$ 处有一个本性奇点。尽管整个被积函数在 $v=0$ 时趋于零，但函数在原点附近的极度平坦性对基于多项式的逼近方法构成了挑战。映射到 $f(t) = \\exp(-\\gamma/\\sqrt{t})$ 改变了原点附近的行为。虽然当 $t \\to 0^+$ 时 $f(t)$ 也极其平坦，但将问题转化为标准的高斯-拉盖尔形式，使我们能够使用一种专门的求积法，其节点针对 $e^{-t}$ 权重进行了优化配置，从而确保了稳健的计算。\n\n数值计算使用高斯-拉盖尔求积法进行。该积分通过加权和来近似：\n$$\n\\int_0^\\infty f(t) e^{-t} dt \\approx \\sum_{i=1}^{N} w_i f(t_i)\n$$\n这里，$t_i$ 和 $w_i$ 是 $N$ 点求积的节点和权重，由第 $N$ 阶拉盖尔多项式 $L_N(t)$ 的根导出。这些值通过标准的高精度数值库获得。按照规定，我们计算 $N=64$ 个点 ($I_{64}$) 和 $N=128$ 个点 ($I_{128}$) 的近似值。最终报告的值是 $I_{128}$，后验误差估计是绝对差 $|I_{128} - I_{64}|$。对六个指定的 $(T, V)$ 参数集中的每一个都执行此过程，使用 `scipy.constants` 中的基本物理常数和问题提供的参数，所有单位均为 SI 单位。", "answer": "```python\nimport numpy as np\nfrom scipy import constants\nfrom scipy.special import roots_laguerre\n\ndef solve():\n    \"\"\"\n    Computes the thermally averaged Landau-Zener transition probability\n    using Gauss-Laguerre quadrature.\n    \"\"\"\n\n    # Fundamental constants from scipy in SI units.\n    hbar = constants.hbar\n    k_B = constants.k\n\n    # Fixed physical parameters from the problem statement in SI units.\n    mu = 1.0e-26  # kg\n    delta_F_abs = 1.0e-9  # N\n\n    # Test cases defined in the problem statement as (T, V) pairs.\n    # T is in Kelvin, V is in Joules.\n    test_cases = [\n        (300.0, 1.0e-22),   # Case 1\n        (300.0, 5.0e-22),   # Case 2\n        (100.0, 5.0e-22),   # Case 3\n        (1000.0, 1.0e-21),  # Case 4\n        (50.0, 5.0e-21),    # Case 5\n        (2000.0, 1.0e-23)   # Case 6\n    ]\n\n    results = []\n\n    # Number of nodes for Gauss-Laguerre quadrature.\n    N_low = 64\n    N_high = 128\n\n    # Pre-compute nodes and weights to avoid repeated calculations if they were constant.\n    # However, since we define f(t) within the loop, pre-computation of nodes/weights\n    # for each N is better done once.\n    nodes_64, weights_64 = roots_laguerre(N_low)\n    nodes_128, weights_128 = roots_laguerre(N_high)\n\n    for T, V in test_cases:\n        # Calculate the dimensionless parameter gamma.\n        gamma = (2.0 * np.pi * V**2) / (hbar * delta_F_abs) * np.sqrt(mu / (2.0 * k_B * T))\n\n        # Define the function f(t) = exp(-gamma / sqrt(t)) to be integrated.\n        # The quadrature nodes t_i from roots_laguerre are strictly positive,\n        # so no division by zero will occur.\n        def f(t, current_gamma):\n            return np.exp(-current_gamma / np.sqrt(t))\n\n        # Perform Gauss-Laguerre quadrature for N=64.\n        # The sum is sum(w_i * f(t_i)).\n        integral_64 = np.sum(weights_64 * f(nodes_64, gamma))\n\n        # Perform Gauss-Laguerre quadrature for N=128.\n        integral_128 = np.sum(weights_128 * f(nodes_128, gamma))\n\n        # The final value is the more accurate N=128 result.\n        value = integral_128\n        # The error estimate is the absolute difference between the two approximations.\n        error = np.abs(integral_128 - integral_64)\n\n        results.append([value, error])\n\n    # Format the output string according to the problem specification.\n    # Each float must be represented with eight significant digits.\n    # The '.8g' format specifier is suitable for this purpose.\n    formatted_results = []\n    for val, err in results:\n        formatted_results.append(f\"[{val:.8g},{err:.8g}]\")\n    \n    # Print the final result in a single line as a Python-style list of lists.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2652090"}, {"introduction": "像 Landau-Zener 这样的理论描述了跃迁的*概率*。而像“最少切换面跳跃”（FSSH）这样的模拟方法则利用这个概率来决定势能面之间的跳跃*是否*发生。本练习解决了一个关键问题：当跳跃确实发生时，我们必须如何调整原子核的动量以保证总能量守恒？这是实现非绝热分子动力学模拟的一个基本而实际的方面。[@problem_id:2652129]", "problem": "在一个多维化学反应网络中，一条反应轨迹在 Landau–Zener 表面跳跃框架内进行处理，以解释在避免交叉点处绝热电子态之间的非绝热跃迁。考虑在原子核构型为 $\\mathbf{R}$ 时，从绝热态 $i$ 到绝热态 $j$ 的单次跳跃尝试，其中绝热势分别为 $V_{i}(\\mathbf{R})$ 和 $V_{j}(\\mathbf{R})$。设跳跃时的势能变化为 $\\Delta V \\equiv V_{j}(\\mathbf{R}) - V_{i}(\\mathbf{R})$。跳跃前的原子核动量为 $\\mathbf{p}$，原子核质量矩阵为 $M = \\mathrm{diag}(m_{1},\\dots,m_{N})$。原子核动能为 $K(\\mathbf{p}) = \\frac{1}{2}\\,\\mathbf{p}^{\\mathsf{T}} M^{-1} \\mathbf{p}$。在 $\\mathbf{R}$ 处，两个绝热态之间的非绝热耦合向量为 $\\mathbf{d}_{ij}(\\mathbf{R})$。在一个保持总能量守恒且只改变沿非绝热耦合方向的动量分量的“最少切换表面跳跃”(Fewest Switches Surface Hopping, FSSH) 更新中，定义了质量度规归一化的耦合方向\n$$\n\\hat{\\mathbf{d}} \\equiv \\frac{\\mathbf{d}_{ij}}{\\sqrt{\\mathbf{d}_{ij}^{\\mathsf{T}} M^{-1} \\mathbf{d}_{ij}}} \\quad \\text{以便} \\quad \\hat{\\mathbf{d}}^{\\mathsf{T}} M^{-1} \\hat{\\mathbf{d}} = 1,\n$$\n以及相应的平行原子核速度分量\n$$\nc \\equiv \\hat{\\mathbf{d}}^{\\mathsf{T}} M^{-1} \\mathbf{p}.\n$$\n假设跳跃（如果被接受）通过一个与 $\\hat{\\mathbf{d}}$ 平行的动量变化 $\\Delta \\mathbf{p}$ 来实现，即 $\\Delta \\mathbf{p} = \\alpha\\,\\hat{\\mathbf{d}}$（其中 $\\alpha$ 是某个标量），选择 $\\alpha$ 以在固定的 $\\mathbf{R}$ 处强制总能量守恒：\n$$\n\\frac{1}{2}\\,(\\mathbf{p}+\\Delta \\mathbf{p})^{\\mathsf{T}} M^{-1} (\\mathbf{p}+\\Delta \\mathbf{p}) + V_{j}(\\mathbf{R})\n\\;=\\;\n\\frac{1}{2}\\,\\mathbf{p}^{\\mathsf{T}} M^{-1} \\mathbf{p} + V_{i}(\\mathbf{R}).\n$$\n在此设定下：\n- 当跳跃被接受时，推导跳跃后动量 $\\mathbf{p}'$ 的封闭形式表达式，该表达式用 $\\mathbf{p}$、$\\hat{\\mathbf{d}}$、$c$ 和 $\\Delta V$ 表示，并遵循以下约定：沿 $\\hat{\\mathbf{d}}$ 方向的跳跃后速度分量保持 $c$ 的符号，同时最小化为满足能量守恒所需的量值变化。\n- 推导一个标量表达式，当该表达式为负时，表示由于沿耦合方向的动能不足，必须拒绝该跳跃。\n\n将最终答案以单行矩阵的形式给出，其第一个条目是 $\\mathbf{p}'$ 的符号表达式，第二个条目是其负值表示拒绝跳跃的标量表达式。请以符号形式表示答案；不要代入数值，也不要包含单位。", "solution": "所述问题具有科学依据，提法恰当，且内容自洽。它描述了“最少切换表面跳跃”（FSSH）算法中动量调整的标准程序，该算法是非绝热分子动力学模拟的基石。质量加权度规、能量守恒以及对动量更新的约束的定义与理论化物理学中的既有文献一致。因此，该问题是有效的，我将着手解决。\n\n系统在状态 $i$ 的总能量为 $E = K(\\mathbf{p}) + V_{i}(\\mathbf{R})$。跳跃到状态 $j$ 后，新的动量为 $\\mathbf{p}'$，总能量为 $E' = K(\\mathbf{p}') + V_{j}(\\mathbf{R})$。问题要求总能量守恒，所以 $E' = E$。\n$$K(\\mathbf{p}') + V_{j}(\\mathbf{R}) = K(\\mathbf{p}) + V_{i}(\\mathbf{R})$$\n使用动能的定义 $K(\\mathbf{p}) = \\frac{1}{2}\\mathbf{p}^{\\mathsf{T}} M^{-1} \\mathbf{p}$ 和跳跃后动量 $\\mathbf{p}' = \\mathbf{p} + \\Delta \\mathbf{p}$，我们可以将能量守恒方程写为：\n$$\\frac{1}{2}(\\mathbf{p} + \\Delta \\mathbf{p})^{\\mathsf{T}} M^{-1} (\\mathbf{p} + \\Delta \\mathbf{p}) - \\frac{1}{2}\\mathbf{p}^{\\mathsf{T}} M^{-1} \\mathbf{p} = V_{i}(\\mathbf{R}) - V_{j}(\\mathbf{R})$$\n设 $\\Delta V = V_{j}(\\mathbf{R}) - V_{i}(\\mathbf{R})$。方程变为：\n$$\\frac{1}{2}(\\mathbf{p} + \\Delta \\mathbf{p})^{\\mathsf{T}} M^{-1} (\\mathbf{p} + \\Delta \\mathbf{p}) - \\frac{1}{2}\\mathbf{p}^{\\mathsf{T}} M^{-1} \\mathbf{p} = -\\Delta V$$\n我们展开第一项。由于质量矩阵 $M$ 是对角矩阵，其逆矩阵 $M^{-1}$ 是对称的。因此，$\\mathbf{x}^{\\mathsf{T}} M^{-1} \\mathbf{y} = \\mathbf{y}^{\\mathsf{T}} M^{-1} \\mathbf{x}$。\n$$\\frac{1}{2}(\\mathbf{p}^{\\mathsf{T}} M^{-1} \\mathbf{p} + 2\\Delta \\mathbf{p}^{\\mathsf{T}} M^{-1} \\mathbf{p} + \\Delta \\mathbf{p}^{\\mathsf{T}} M^{-1} \\Delta \\mathbf{p}) - \\frac{1}{2}\\mathbf{p}^{\\mathsf{T}} M^{-1} \\mathbf{p} = -\\Delta V$$\n$$\\Delta \\mathbf{p}^{\\mathsf{T}} M^{-1} \\mathbf{p} + \\frac{1}{2}\\Delta \\mathbf{p}^{\\mathsf{T}} M^{-1} \\Delta \\mathbf{p} = -\\Delta V$$\n问题陈述动量变化平行于质量度规归一化的耦合方向 $\\hat{\\mathbf{d}}$，即 $\\Delta \\mathbf{p} = \\alpha \\hat{\\mathbf{d}}$（其中 $\\alpha$ 是某个标量）。将此代入方程：\n$$(\\alpha \\hat{\\mathbf{d}})^{\\mathsf{T}} M^{-1} \\mathbf{p} + \\frac{1}{2}(\\alpha \\hat{\\mathbf{d}})^{\\mathsf{T}} M^{-1} (\\alpha \\hat{\\mathbf{d}}) = -\\Delta V$$\n$$\\alpha (\\hat{\\mathbf{d}}^{\\mathsf{T}} M^{-1} \\mathbf{p}) + \\frac{1}{2}\\alpha^2 (\\hat{\\mathbf{d}}^{\\mathsf{T}} M^{-1} \\hat{\\mathbf{d}}) = -\\Delta V$$\n我们已知定义 $c \\equiv \\hat{\\mathbf{d}}^{\\mathsf{T}} M^{-1} \\mathbf{p}$ 和 $\\hat{\\mathbf{d}}^{\\mathsf{T}} M^{-1} \\hat{\\mathbf{d}} = 1$。代入这些定义可将方程简化为关于 $\\alpha$ 的二次方程：\n$$\\alpha c + \\frac{1}{2}\\alpha^2 = -\\Delta V$$\n$$\\frac{1}{2}\\alpha^2 + c\\alpha + \\Delta V = 0$$\n使用求根公式解出 $\\alpha$ 得到两个可能的解：\n$$\\alpha = \\frac{-c \\pm \\sqrt{c^2 - 4(\\frac{1}{2})(\\Delta V)}}{2(\\frac{1}{2})} = -c \\pm \\sqrt{c^2 - 2\\Delta V}$$\n\n为了使动量变化 $\\Delta \\mathbf{p}$ 具有物理意义（即为一个实值向量），标量 $\\alpha$ 必须是实数。这要求二次方程的判别式为非负：\n$c^2 - 2\\Delta V \\ge 0$\n如果此条件不满足，则不存在能够使能量守恒的实数解 $\\alpha$，因此必须拒绝该跳跃。所以，其值为负即表示必须拒绝跳跃的标量表达式是 $c^2 - 2\\Delta V$。这就完成了问题的第二部分。\n\n对于第一部分，我们必须确定选择 $\\alpha$ 的两个解中的哪一个。问题指定了一个约定：沿 $\\hat{\\mathbf{d}}$ 方向的跳跃后速度分量必须保持跳跃前分量 $c$ 的符号。\n设跳跃后动量为 $\\mathbf{p}' = \\mathbf{p} + \\alpha \\hat{\\mathbf{d}}$。沿 $\\hat{\\mathbf{d}}$ 方向的跳跃后速度分量为 $c'$：\n$$c' \\equiv \\hat{\\mathbf{d}}^{\\mathsf{T}} M^{-1} \\mathbf{p}' = \\hat{\\mathbf{d}}^{\\mathsf{T}} M^{-1} (\\mathbf{p} + \\alpha \\hat{\\mathbf{d}}) = (\\hat{\\mathbf{d}}^{\\mathsf{T}} M^{-1} \\mathbf{p}) + \\alpha (\\hat{\\mathbf{d}}^{\\mathsf{T}} M^{-1} \\hat{\\mathbf{d}}) = c + \\alpha$$\n代入 $\\alpha$ 的两个解：\n$$c'_{1} = c + (-c + \\sqrt{c^2 - 2\\Delta V}) = \\sqrt{c^2 - 2\\Delta V}$$\n$$c'_{2} = c + (-c - \\sqrt{c^2 - 2\\Delta V}) = -\\sqrt{c^2 - 2\\Delta V}$$\n根据定义，平方根是非负的。因此，$c'_{1} \\ge 0$ 且 $c'_{2} \\le 0$。约定要求 $\\mathrm{sgn}(c') = \\mathrm{sgn}(c)$，其中 $\\mathrm{sgn}$ 是符号函数。\n- 如果 $c > 0$，我们必须选择 $c'$ 的非负解，所以 $c' = c'_{1}$。这对应于选择 $\\alpha_1 = -c + \\sqrt{c^2 - 2\\Delta V}$。\n- 如果 $c  0$，我们必须选择 $c'$ 的非正解，所以 $c' = c'_{2}$。这对应于选择 $\\alpha_2 = -c - \\sqrt{c^2 - 2\\Delta V}$。\n- 如果 $c = 0$，约定要求 $c'=0$。这仅在 $c^2 - 2\\Delta V = 0$ 时才可能，即 $\\Delta V = 0$。在这种情况下，$\\alpha$ 的两个解都为零。\n\n这三种情况可以使用符号函数 $\\mathrm{sgn}(c)$ 统一为 $c'$ 的单个表达式：\n$$c' = \\mathrm{sgn}(c) \\sqrt{c^2 - 2\\Delta V}$$\n从 $c' = c + \\alpha$，我们找到满足该约定的 $\\alpha$ 的唯一值：\n$$\\alpha = c' - c = -c + \\mathrm{sgn}(c) \\sqrt{c^2 - 2\\Delta V}$$\n最后，跳跃后动量 $\\mathbf{p}'$ 由下式给出：\n$$\\mathbf{p}' = \\mathbf{p} + \\alpha \\hat{\\mathbf{d}} = \\mathbf{p} + \\left( -c + \\mathrm{sgn}(c) \\sqrt{c^2 - 2 \\Delta V} \\right) \\hat{\\mathbf{d}}$$\n这就提供了跳跃被接受时跳跃后动量的封闭形式表达式。\n\n问题还提到了最小化量值变化的条件。动量的量值变化为 $\\|\\Delta \\mathbf{p}\\|$，它与 $|\\alpha|$ 成正比。仔细分析证实，保持 $c$ 符号的 $\\alpha$ 选择与最小化 $|\\alpha|$ 的选择是相同的，因此这两个约定是一致的。\n\n现在已经推导出所要求的两个表达式。第一个是跳跃后动量 $\\mathbf{p}'$。第二个是标量表达式 $c^2-2\\Delta V$，其负值表示跳跃被拒绝。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\mathbf{p} + \\left( -c + \\mathrm{sgn}(c) \\sqrt{c^2 - 2 \\Delta V} \\right) \\hat{\\mathbf{d}}  c^2 - 2 \\Delta V\n\\end{pmatrix}\n}\n$$", "id": "2652129"}]}