{"hands_on_practices": [{"introduction": "提交子概率（committor probability），通常记为 $q_i$，是表征稀有事件路径的核心物理量。它定义了系统从任意中间态 $i$ 出发，在返回反应物区域 $A$ 之前到达产物区域 $B$ 的概率。本练习将引导我们为一个简单但极具启发性的一维连续时间马尔可夫链模型，从第一性原理出发解析地推导提交子概率。通过求解这个模型，我们不仅能掌握求解提交子方程的基本数学技巧，还能深刻理解它是如何由系统各状态间的跃迁速率决定的。[@problem_id:2667193]", "problem": "考虑一个定义在线性链上的连续时间马尔可夫链 (CTMC)，该链包含 $N+1$ 个状态，标记为 $\\{0,1,2,\\dots,N\\}$，且仅允许最近邻转移。对于每个内部状态 $i \\in \\{1,2,\\dots,N-1\\}$，向右转移的速率为 $k_{i,i+1}  0$，向左转移的速率为 $k_{i,i-1}  0$。状态 $0$ 和 $N$ 分别是吸收集 $A$ 和 $B$，在稀有事件采样情境中代表反应物盆和产物盆。定义提交者概率 $q_i$ 为从状态 $i$ 出发，过程在到达 $A$ 之前先到达 $B$ 的概率。\n\n仅使用 CTMC 的随机动力学基本原理以及提交者概率作为吸收概率的定义，推导所有 $i \\in \\{0,1,\\dots,N\\}$ 的提交者概率 $q_i$ 的解析表达式，并满足边界条件 $q_0 = 0$ 和 $q_N = 1$。然后，假设过程从一个指定的内部状态 $i_0 \\in \\{1,2,\\dots,N-1\\}$ 开始，计算在到达 $A$ 之前先到达 $B$ 的分裂概率（该概率等于 $q_{i_0}$），并将其表示为关于速率 $k_{i,i\\pm 1}$ 和下标的单个闭式表达式。请将最终答案表示为单个解析表达式。无需进行数值计算或四舍五入。", "solution": "所述问题具有科学依据，是适定且客观的。这是一个随机过程理论中的标准问题，具体涉及一维连续时间马尔可夫链到达概率的计算。我将开始进行其形式化推导。\n\n该系统是一个定义在离散状态空间 $\\mathcal{S} = \\{0, 1, 2, \\dots, N\\}$ 上的连续时间马尔可夫链。状态 $0$ 和 $N$ 是吸收态，分别代表集合 $A$ 和 $B$。对于任意内部状态 $i \\in \\{1, 2, \\dots, N-1\\}$，仅允许向相邻状态 $i-1$ 和 $i+1$ 转移，其速率分别为 $k_{i,i-1}  0$ 和 $k_{i,i+1}  0$。\n\n提交者概率 $q_i$ 是指从状态 $i$ 开始的随机过程在到达状态 $0$ 之前先到达状态 $N$ 的概率。根据定义，对于吸收边界，我们有以下条件：\n$$q_0 = 0$$\n$$q_N = 1$$\n\n对于任意内部状态 $i \\in \\{1, 2, \\dots, N-1\\}$，我们可以通过对第一次跳跃事件进行条件分析来建立 $q_i$ 的方程。离开状态 $i$ 的总速率为 $K_i = k_{i,i+1} + k_{i,i-1}$。下一次转移到状态 $i+1$ 的概率为 $p_{i,i+1} = \\frac{k_{i,i+1}}{K_i}$，转移到状态 $i-1$ 的概率为 $p_{i,i-1} = \\frac{k_{i,i-1}}{K_i}$。\n\n根据全概率定律，$q_i$ 是其后继状态的提交者概率的加权平均，其中权重为各自的转移概率：\n$$q_i = q_{i+1} \\cdot p_{i,i+1} + q_{i-1} \\cdot p_{i,i-1}$$\n代入概率的表达式：\n$$q_i = q_{i+1} \\frac{k_{i,i+1}}{k_{i,i+1} + k_{i,i-1}} + q_{i-1} \\frac{k_{i,i-1}}{k_{i,i+1} + k_{i,i-1}}$$\n两边同乘以分母 $(k_{i,i+1} + k_{i,i-1})$ 可得：\n$$q_i (k_{i,i+1} + k_{i,i-1}) = q_{i+1} k_{i,i+1} + q_{i-1} k_{i,i-1}$$\n这就是提交者概率的后向主方程。我们可以重排此方程以揭示一个更简单的结构。\n$$q_i k_{i,i+1} - q_{i+1} k_{i,i+1} = q_{i-1} k_{i,i-1} - q_i k_{i,i-1}$$\n$$-k_{i,i+1}(q_{i+1} - q_i) = -k_{i,i-1}(q_i - q_{i-1})$$\n$$k_{i,i+1}(q_{i+1} - q_i) = k_{i,i-1}(q_i - q_{i-1})$$\n此方程对所有 $i \\in \\{1, 2, \\dots, N-1\\}$ 成立。我们定义差分 $\\Delta_j = q_{j+1} - q_j$，其中 $j \\in \\{0, 1, \\dots, N-1\\}$。对于 $i \\in \\{1, 2, \\dots, N-1\\}$，上述方程可以写成：\n$$k_{i,i+1} \\Delta_i = k_{i,i-1} \\Delta_{i-1}$$\n这给出了差分 $\\Delta_i$ 的一个一阶递推关系：\n$$\\Delta_i = \\frac{k_{i,i-1}}{k_{i,i+1}} \\Delta_{i-1}$$\n我们可以通过迭代来解这个递推关系。当 $i=1$ 时，我们有 $\\Delta_1 = \\frac{k_{1,0}}{k_{1,2}} \\Delta_0$。当 $i=2$ 时，我们有 $\\Delta_2 = \\frac{k_{2,1}}{k_{2,3}} \\Delta_1 = \\frac{k_{2,1}}{k_{2,3}} \\frac{k_{1,0}}{k_{1,2}} \\Delta_0$。\n通过归纳法，对于 $j \\in \\{1, \\dots, N-1\\}$，$\\Delta_j$ 的通解为：\n$$\\Delta_j = \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right) \\Delta_0$$\n如果我们采纳标准约定，即空积（对于 $j=0$）等于 $1$，则该表达式对 $j=0$ 也成立。\n\n现在，我们可以通过对这些差分求和来表示 $q_i$。使用伸缩求和法：\n$$q_i - q_0 = \\sum_{j=0}^{i-1} (q_{j+1} - q_j) = \\sum_{j=0}^{i-1} \\Delta_j$$\n由于边界条件为 $q_0 = 0$，我们有：\n$$q_i = \\sum_{j=0}^{i-1} \\Delta_j = \\sum_{j=0}^{i-1} \\left( \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right) \\Delta_0 \\right)$$\n将常数 $\\Delta_0$ 提取出来：\n$$q_i = \\Delta_0 \\sum_{j=0}^{i-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)$$\n未知常数 $\\Delta_0 = q_1 - q_0 = q_1$ 可以通过应用第二个边界条件 $q_N=1$ 来确定。我们在上述表达式中令 $i=N$：\n$$q_N = 1 = \\Delta_0 \\sum_{j=0}^{N-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)$$\n由此，我们解出 $\\Delta_0$：\n$$\\Delta_0 = \\frac{1}{\\sum_{j=0}^{N-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)}$$\n将 $\\Delta_0$ 的这个表达式代回 $q_i$ 的方程，我们得到对于任意状态 $i \\in \\{0, 1, \\dots, N\\}$ 的提交者概率的通解：\n$$q_i = \\frac{\\sum_{j=0}^{i-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)}{\\sum_{j=0}^{N-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)}$$\n当 $i=0$ 时，分子中的和式为空，其值为 $0$，得到 $q_0=0$。当 $i=N$ 时，分子和分母相同，得到 $q_N=1$。两个边界条件都得到满足。\n\n问题要求的是从内部状态 $i_0 \\in \\{1, 2, \\dots, N-1\\}$ 出发，在到达 $A$ 之前先到达 $B$ 的分裂概率。根据定义，此概率为 $q_{i_0}$。因此，最终的解析表达式可通过在通解中令 $i=i_0$ 得到。", "answer": "$$\n\\boxed{\n\\frac{\\sum_{j=0}^{i_0-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)}{\\sum_{j=0}^{N-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)}\n}\n$$", "id": "2667193"}, {"introduction": "过渡态理论（Transition State Theory, TST）为化学反应速率的计算提供了一个优雅而强大的框架，但其有效性依赖于一个关键假设：穿越分割面的轨迹绝不回头。这个练习旨在通过一个二维谐波势垒模型，定量地探讨当这个“无重穿”假设被违背时会发生什么。我们将推导当分割面偏离最优位置时，TST计算出的速率会如何系统性地高估真实速率，这个过程将加深我们对反应坐标选择重要性的理解。[@problem_id:2667175]", "problem": "考虑一个鞍点附近的越垒的二维哈密顿模型，这是化学动力学和反应网络中稀有事件越垒的标准局域模型。哈密顿量为\n$$\nH(x,y,p_x,p_y) \\;=\\; \\frac{p_x^2}{2m} \\;+\\; \\frac{p_y^2}{2m} \\;+\\; V(x,y),\n$$\n其二次势能为\n$$\nV(x,y) \\;=\\; E^{\\ddagger} \\;-\\; \\frac{1}{2} m \\lambda^2 x^2 \\;+\\; \\frac{1}{2} m \\omega^2 y^2,\n$$\n其中 $m0$ 是质量，$\\lambda0$ 是沿 $x$ 方向的（不稳定）势垒频率，$\\omega0$ 是沿 $y$ 方向的（稳定）频率，$E^{\\ddagger}$ 是垒顶能量。系统处于温度 $T$ 的热平衡状态，因此初始条件从麦克斯韦-玻尔兹曼分布中抽取，其逆温度为 $\\beta = 1/(k_B T)$，其中 $k_B$ 是玻尔兹曼常数。\n\n在过渡态理论（TST）中，速率常数通过穿过一个分隔面的平衡正通量来估计。对于此谐波鞍点，精确的无重穿分隔面是 $x=0$ 平面且 $p_x$ 为正。假设改用一个次优的平面分隔面，由相对于不稳定 $x$ 轴成 $\\theta\\in(-\\pi/2,\\pi/2)$ 角的单位法向量 $\\boldsymbol{n}=(\\cos\\theta,\\sin\\theta)$ 定义，即\n$$\n\\boldsymbol{n}\\cdot\\boldsymbol{q} \\;=\\; \\cos\\theta\\,x \\;+\\; \\sin\\theta\\,y \\;=\\; 0,\n$$\n且法向动量分量 $p_n = \\boldsymbol{n}\\cdot\\boldsymbol{p}  0$ 为正。令 $k_{\\mathrm{TST}}(\\theta)$ 表示使用此倾斜分隔面的TST估计值，令 $k_{\\mathrm{true}}$ 表示谐波模型的精确速率，由于 $x=0$ 表面在此模型中是无重穿的，因此 $k_{\\mathrm{true}}$ 等于 $k_{\\mathrm{TST}}(0)$。\n\n仅使用正则麦克斯韦-玻尔兹曼分布、鞍点附近的哈密顿动力学以及过渡态理论的平衡正通量定义（不使用任何预先推导的透射系数），推导乘性偏差因子\n$$\nb(\\theta) \\;=\\; \\frac{k_{\\mathrm{TST}}(\\theta)}{k_{\\mathrm{true}}}\n$$\n对于上述具有未对准分隔面的谐波势垒。您的推导必须从穿过分隔面的相空间通量积分开始，并通过显式的高斯积分进行。指出谐波鞍点通量积分收敛时 $\\theta$ 需要满足的任何条件。\n\n以 $\\lambda$、$\\omega$ 和 $\\theta$ 的单个闭式解析表达式形式提供您的最终答案 $b(\\theta)$。无需进行数值计算，最终答案中不应包含单位。", "solution": "该问题要求在一个二维谐波鞍点模型中，使用未对准的分隔面进行过渡态理论（TST）速率计算时，推导乘性偏差因子 $b(\\theta) = k_{\\mathrm{TST}}(\\theta)/k_{\\mathrm{true}}$。真实速率 $k_{\\mathrm{true}}$ 对应于使用 $\\theta=0$ 处的最优分隔面的TST速率，因此 $k_{\\mathrm{true}} = k_{\\mathrm{TST}}(0)$。因此，偏差因子为 $b(\\theta) = k_{\\mathrm{TST}}(\\theta)/k_{\\mathrm{TST}}(0)$。\n\nTST速率常数与穿过分隔面的平衡通量成正比。由于我们计算的是同一系统的两个速率常数之比，出现在完整TST表达式分母中的反应物配分函数将会抵消。因此，我们只需要计算通量积分本身的比率。\n\n穿过由 $f(\\boldsymbol{q})=0$ 定义的分隔面的平衡通量 $\\Phi$ 由相空间积分给出：\n$$\n\\Phi = \\int d\\boldsymbol{p} \\int d\\boldsymbol{q} \\; \\delta(f(\\boldsymbol{q})) \\; (\\boldsymbol{v} \\cdot \\boldsymbol{n}) \\; \\Theta(\\boldsymbol{v} \\cdot \\boldsymbol{n}) \\; \\frac{\\exp(-\\beta H(\\boldsymbol{p}, \\boldsymbol{q}))}{Z_{\\text{total}}}\n$$\n其中 $\\boldsymbol{v}=\\boldsymbol{p}/m$ 是速度，$\\boldsymbol{n}$ 是表面的单位法向量，$\\Theta$ 是亥维赛德阶跃函数， $H$ 是哈密顿量，$\\beta = 1/(k_B T)$。总配分函数 $Z_{\\text{total}}$ 是一个常数，将在比率中被抵消。因此，我们可以处理一个与通量成正比的量，省略配分函数归一化。\n\n指定的分隔面是一个由 $\\boldsymbol{n}\\cdot\\boldsymbol{q} = x\\cos\\theta + y\\sin\\theta = 0$ 定义的平面，其法向量为 $\\boldsymbol{n}=(\\cos\\theta,\\sin\\theta)$。相应的法向速度分量为 $v_n = (\\boldsymbol{p}\\cdot\\boldsymbol{n})/m = (p_x\\cos\\theta + p_y\\sin\\theta)/m$。对于给定角度 $\\theta$ 的通量积分，我们记为 $\\Phi(\\theta)$，其表达式为：\n$$\n\\Phi(\\theta) \\propto \\int dp_x dp_y dx dy \\; \\delta(x\\cos\\theta + y\\sin\\theta) \\; \\frac{p_x\\cos\\theta + p_y\\sin\\theta}{m} \\; \\Theta(p_x\\cos\\theta + p_y\\sin\\theta) \\; \\exp(-\\beta H)\n$$\n其中哈密顿量为 $H = \\frac{p_x^2 + p_y^2}{2m} + E^{\\ddagger} - \\frac{1}{2} m \\lambda^2 x^2 + \\frac{1}{2} m \\omega^2 y^2$。\n\n为了简化积分，我们对坐标系进行旋转。设新坐标为位置坐标 $(q_n, q_s)$ 和动量坐标 $(p_n, p_s)$，分别与法向量 $\\boldsymbol{n}=(\\cos\\theta, \\sin\\theta)$ 和切向量 $\\boldsymbol{s}=(-\\sin\\theta, \\cos\\theta)$ 对齐。\n变换关系为：\n$q_n = x\\cos\\theta + y\\sin\\theta$\n$q_s = -x\\sin\\theta + y\\cos\\theta$\n$x = q_n\\cos\\theta - q_s\\sin\\theta$\n$y = q_n\\sin\\theta + q_s\\cos\\theta$\n\n对动量而言：\n$p_n = p_x\\cos\\theta + p_y\\sin\\theta$\n$p_s = -p_x\\sin\\theta + p_y\\cos\\theta$\n此变换的雅可比行列式为1，因此 $dx dy dp_x dp_y = dq_n dq_s dp_n dp_s$。动能变为 $\\frac{p_x^2+p_y^2}{2m} = \\frac{p_n^2+p_s^2}{2m}$。分隔面现在简化为 $q_n = 0$，通量条件为 $p_n  0$。\n\nδ函数 $\\delta(x\\cos\\theta + y\\sin\\theta)$ 变为 $\\delta(q_n)$。对 $q_n$ 的积分使得被积函数其余部分中的 $q_n=0$。当 $q_n=0$ 时，势能项 $V(x,y)$ 变为 $q_s$ 的函数：\n$$\nV(q_n=0, q_s) = E^{\\ddagger} - \\frac{1}{2} m \\lambda^2 (-q_s\\sin\\theta)^2 + \\frac{1}{2} m \\omega^2 (q_s\\cos\\theta)^2 \\\\\n= E^{\\ddagger} + \\frac{1}{2} m (\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta) q_s^2\n$$\n新坐标系下的通量积分 $\\Phi(\\theta)$ 为：\n$$\n\\Phi(\\theta) \\propto \\int dp_n dp_s dq_s dq_n \\; \\delta(q_n) \\; \\frac{p_n}{m} \\; \\Theta(p_n) \\; \\exp\\left(-\\beta \\left[ \\frac{p_n^2+p_s^2}{2m} + V(q_n=0, q_s) \\right]\\right)\n$$\n对 $q_n$ 积分并代入势能后，积分分离为：\n$$\n\\Phi(\\theta) \\propto \\frac{\\exp(-\\beta E^{\\ddagger})}{m} \\left( \\int_0^{\\infty} dp_n \\, p_n \\exp\\left(-\\frac{\\beta p_n^2}{2m}\\right) \\right) \\left( \\int_{-\\infty}^{\\infty} dp_s \\, \\exp\\left(-\\frac{\\beta p_s^2}{2m}\\right) \\right) \\left( \\int_{-\\infty}^{\\infty} dq_s \\, \\exp\\left(-\\frac{\\beta m}{2}(\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta)q_s^2\\right) \\right)\n$$\n我们计算这三个标准积分：\n1.  对 $p_n$ 的积分：令 $u = \\beta p_n^2 / (2m)$，则 $du = (\\beta p_n / m) dp_n$。\n    $$ \\int_0^{\\infty} p_n \\exp\\left(-\\frac{\\beta p_n^2}{2m}\\right) dp_n = \\frac{m}{\\beta} \\int_0^{\\infty} e^{-u} du = \\frac{m}{\\beta} $$\n2.  对 $p_s$ 的积分是一个高斯积分：\n    $$ \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta}{2m} p_s^2\\right) dp_s = \\sqrt{\\frac{2\\pi m}{\\beta}} $$\n3.  对 $q_s$ 的积分也是一个高斯积分。为了使该积分收敛，指数中的二次项系数必须为正：$\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta  0$。这意味着 $\\omega^2  \\lambda^2 \\tan^2\\theta$，或 $|\\tan\\theta|  \\omega/\\lambda$。这是TST通量积分为有限值时 $\\theta$ 需满足的条件。假设此条件成立：\n    $$ \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta m}{2}(\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta)q_s^2\\right) dq_s = \\sqrt{\\frac{2\\pi}{\\beta m (\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta)}} $$\n\n综合这些结果，通量 $\\Phi(\\theta)$ 正比于：\n$$\n\\Phi(\\theta) \\propto \\frac{\\exp(-\\beta E^{\\ddagger})}{m} \\cdot \\frac{m}{\\beta} \\cdot \\sqrt{\\frac{2\\pi m}{\\beta}} \\cdot \\sqrt{\\frac{2\\pi}{\\beta m (\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta)}}\n$$\n$$\n\\Phi(\\theta) \\propto \\frac{2\\pi \\exp(-\\beta E^{\\ddagger})}{\\beta^2 \\sqrt{\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta}}\n$$\n我们关心的是比率 $b(\\theta) = \\Phi(\\theta)/\\Phi(0)$。我们通过在上述表达式中令 $\\theta=0$ 来求得 $\\Phi(0)$：\n$$\n\\Phi(0) \\propto \\frac{2\\pi \\exp(-\\beta E^{\\ddagger})}{\\beta^2 \\sqrt{\\omega^2 \\cos^2(0) - \\lambda^2 \\sin^2(0)}} = \\frac{2\\pi \\exp(-\\beta E^{\\ddagger})}{\\beta^2 \\omega}\n$$\n偏差因子即为该比率：\n$$\nb(\\theta) = \\frac{\\Phi(\\theta)}{\\Phi(0)} = \\frac{\\frac{2\\pi \\exp(-\\beta E^{\\ddagger})}{\\beta^2 \\sqrt{\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta}}}{\\frac{2\\pi \\exp(-\\beta E^{\\ddagger})}{\\beta^2 \\omega}} = \\frac{\\omega}{\\sqrt{\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta}}\n$$\n这就是乘性偏差因子的最终表达式。它大于或等于1，反映了非最优分隔面允许重穿，而TST错误地将其计为反应事件，从而高估了速率。\n此计算有效的条件是倾斜表面的通量积分收敛，即 $|\\tan\\theta|  \\omega/\\lambda$。", "answer": "$$\n\\boxed{\\frac{\\omega}{\\sqrt{\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta}}}\n$$", "id": "2667175"}, {"introduction": "前向通量采样（Forward Flux Sampling, FFS）是一种强大的路径采样算法，它通过将稀有事件分解为一系列可能性更高的步骤来高效计算速率，巧妙地规避了定义单一过渡态的难题。这个综合性练习将理论与实践相结合，要求我们首先从基本定义出发，构思一个完整的FFS计算方案。随后，我们将这个方案付诸实践，利用给定的模拟数据计算真实的反应速率，这完美模拟了计算化学研究中分析和处理稀有事件数据的过程。[@problem_id:2667199]", "problem": "考虑一个由化学主方程 (CME) 控制的连续时间马尔可夫跳跃过程，该过程具有两个长寿命的吸引盆，记为状态 $A$ 和状态 $B$，以及一个序参量 $\\lambda(x)$，该序参量沿着从 $A$ 到 $B$ 的典型反应轨迹单调增加。假设在到 $B$ 的稀有跃迁的时间尺度上，系统具有平稳性，即 $A$ 盆内的概率分布不随时间变化。前向通量采样 (Forward Flux Sampling, FFS) 是一种稀有事件采样策略，它将稀有的 $A \\to B$ 跃迁分解为 $A$ 和 $B$ 之间序参量空间中的一系列界面，并使用经验频率来估计跃迁速率。\n\n您必须从以下基本定义出发：\n- 稳态通量是单位物理时间内指定事件的期望数量。如果在物理时间 $T$（以秒为单位）内观测到事件计数为 $c$，则经验通量为 $c/T$，单位为 $\\text{s}^{-1}$。\n- 在指定替代事件发生之前发生成功事件的条件概率，是指从条件集开始的独立重启试验中，观测到的成功次数与总试验次数之比。\n\n任务 A (概念性)：仅从这些定义和 CME 的马尔可夫性质出发，为具有序参量 $\\lambda(x)$ 的双稳态反应网络指定一个有效的用于估计 $A \\to B$ 跃迁速率的前向通量采样 (FFS) 协议。您的描述必须明确：\n- 一系列界面 $\\lambda_0, \\lambda_1, \\dots, \\lambda_M$ 的作用，其中 $\\lambda_0$ 刚过 $A$，而 $\\lambda_M$ 定义了进入 $B$ 的入口。\n- 测量从 $A$ 出发到 $\\lambda_0$ 的稳态首次穿越通量的过程。\n- 在每个界面 $\\lambda_i$ 处，使用从 $\\lambda_i$ 开始的独立试验来估计在返回 $A$ 之前到达 $\\lambda_{i+1}$ 的条件分裂概率的过程。\n- 确保经验频率是底层通量和条件概率的有效估计量的独立性和初始化要求。\n\n任务 B (计算性)：仅使用上述基本原理，推导一个以 $\\text{s}^{-1}$ 为单位的 $A \\to B$ 跃迁速率的估计量，该估计量用以下各项表示：\n- 在观测时间 $T$（以秒为单位）内，从 $A$ 出发首次穿越 $\\lambda_0$ 的测量计数 $c$。\n- 对于每个界面索引 $i \\in \\{0,1,\\dots,M-1\\}$，在 $\\lambda_i$ 处开始的试验次数 $n_i$，以及其中在返回 $A$ 之前到达 $\\lambda_{i+1}$ 的试验次数 $s_i$。\n\n实现一个程序，计算以下每个测试用例的估计跃迁速率。对于每个用例，使用经验频率 $c/T$作为通量，使用经验频率 $s_i/n_i$ 作为每个条件概率，然后将指定序列中所有界面的这些值相乘。如果任何 $s_i = 0$ 且 $n_i  0$，则根据经验频率的定义，该用例的估计值为 $0$。如果 $c=0$，则估计值为 $0$，因为经验通量为 $0$。假设所有给定的 $n_i$ 均为严格正数，并且 $0 \\le s_i \\le n_i$ 成立。\n\n将所有最终数值答案以 $\\text{s}^{-1}$ 为单位表示为浮点数。\n\n测试套件：\n- 用例 $1$：$T = 10^7$ 秒, $c = 500$, $M = 4$, $n = \\{2000, 1500, 1000, 800\\}$, $s = \\{600, 180, 36, 18\\}$。\n- 用例 $2$：$T = 5 \\times 10^6$ 秒, $c = 50$, $M = 1$, $n = \\{1000\\}$, $s = \\{5\\}$。\n- 用例 $3$：$T = 10^7$ 秒, $c = 1000$, $M = 3$, $n = \\{1000, 500, 500\\}$, $s = \\{400, 0, 250\\}$。\n- 用例 $4$：$T = 10^6$ 秒, $c = 0$, $M = 2$, $n = \\{100, 100\\}$, $s = \\{12, 3\\}$。\n- 用例 $5$：$T = 2 \\times 10^8$ 秒, $c = 1200$, $M = 6$, $n = \\{5000, 4000, 3000, 2500, 2000, 1500\\}$, $s = \\{250, 80, 24, 6, 2, 1\\}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用例 1 到 5 的估计速率，形式为逗号分隔的列表，并用方括号括起来，顺序如上所示（例如，$[r_1,r_2,r_3,r_4,r_5]$），其中每个 $r_i$ 是以 $\\text{s}^{-1}$ 为单位的浮点数。不要包含任何附加文本。", "solution": "所提出的问题是稀有事件采样理论中一个良定且有科学依据的练习。它要求从第一性原理出发，推导并应用前向通量采样 (FFS) 速率常数估计量。问题陈述完整、一致，并遵循随机化学动力学的既定框架。我们将开始解答。\n\n基本目标是为一个由连续时间马尔可夫跳跃过程描述其动力学的系统，估计从亚稳态 $A$ 到另一状态 $B$ 的跃迁速率常数，记为 $k_{AB}$。该跃迁是一个稀有事件，这意味着在直接模拟中进行观测在计算上是不可行的。FFS通过将稀有跃迁路径分解为一系列更可能发生的小步骤来解决这个问题。\n\n$k_{AB}$ 速率常数代表了从状态 $A$ 开始并成功跃迁到状态 $B$ 的轨迹的稳态通量。FFS 的核心原理是将这个总通量表示为一个初始通量与一系列条件概率的乘积。我们来将其形式化。\n\n我们使用序参量 $\\lambda(x)$ 来定义状态 $A$ 和 $B$，其中 $x$ 是系统的状态向量。状态 $A$ 是跃迁起源的吸引盆，状态 $B$ 是目标盆。我们引入由序参量定义的一系列非重叠界面：$\\lambda_0, \\lambda_1, \\dots, \\lambda_M$。状态 $A$ 定义为 $\\lambda(x)  \\lambda_0$ 的区域，状态 $B$ 定义为 $\\lambda(x) \\ge \\lambda_M$ 的区域。界面的排序方式为 $\\lambda_0  \\lambda_1  \\dots  \\lambda_M$。如果一条轨迹的序参量降至 $\\lambda_0$ 以下，则认为它已返回到 $A$。\n\n跃迁速率 $k_{AB}$可以写成两项的乘积：\n$k_{AB} = \\Phi_0 \\times P(B|\\lambda_0)$\n这里，$\\Phi_0$ 是源于状态 $A$ 并穿过第一个界面 $\\lambda_0$ 的轨迹的稳态通量。项 $P(B|\\lambda_0)$ 是一个条件概率，表示一条刚从 $A$ 穿过 $\\lambda_0$ 的轨迹，将在返回状态 $A$（即穿过 $\\lambda_0$ 返回）之前继续前进到达状态 $B$（即穿过 $\\lambda_M$）的概率。\n\n由于过程的马尔可夫性质，概率 $P(B|\\lambda_0)$ 可以因式分解为一系列连续界面之间的条件概率的乘积。一条从 $\\lambda_{i-1}$ 到达界面 $\\lambda_i$ 的轨迹已经“忘记”了其到达 $\\lambda_i$ 之前的历史。因此，继续前进到 $\\lambda_{i+1}$ 的概率仅取决于其当前状态。这使我们可以写出：\n$P(B|\\lambda_0) = P(\\lambda_1|\\lambda_0) \\times P(\\lambda_2|\\lambda_1) \\times \\dots \\times P(\\lambda_M|\\lambda_{M-1})$\n其中 $P(\\lambda_{i+1}|\\lambda_i)$ 是从界面 $\\lambda_i$ 开始的轨迹在返回状态 $A$ 之前到达界面 $\\lambda_{i+1}$ 的条件概率。将这些表达式组合起来，得到 FFS 的核心方程：\n$$k_{AB} = \\Phi_0 \\prod_{i=0}^{M-1} P(\\lambda_{i+1}|\\lambda_i)$$\n\nFFS 算法是一个旨在估计此乘积中每一项的数值程序。它包括两个主要阶段。\n\n**阶段 1：初始通量 $\\Phi_0$ 的测量**\n此阶段处理第一项 $\\Phi_0$。\n- 进行一次长时间的模拟，系统在状态 $A$ 内初始化并达到平衡。设此次模拟的总物理时长为 $T$。\n- 我们监控序参量 $\\lambda(x(t))$。每次轨迹在状态 $A$ 中（其中 $\\lambda(x)  \\lambda_0$）后，正向穿过界面 $\\lambda_0$（即 $\\lambda(x)$ 变为 $\\ge \\lambda_0$），就记录一次事件。\n- 设在时间 $T$ 内此类首次穿越事件的总计数为 $c$。\n- 根据所提供的经验通量定义，$\\Phi_0$ 的估计量为：\n$$\\Phi_0 \\approx \\frac{c}{T}$$\n在 $A$ 盆内的平稳性假设对于确保此时间平均频率是稳态通量的有效估计量至关重要。系统在 $c$ 次穿越瞬间的构型被保存下来。这些构型代表了在从 $A$ 到达的条件下，位于界面 $\\lambda_0$ 上的状态系综，它们将作为下一阶段的起点。\n\n**阶段 2：条件概率 $P(\\lambda_{i+1}|\\lambda_i)$ 的估计**\n此阶段估计条件概率的乘积。这是一个迭代过程，从界面 $\\lambda_i$ 到 $\\lambda_{i+1}$ 进行，其中 $i = 0, 1, \\dots, M-1$。\n- **对于 $i=0$**：为估计 $P(\\lambda_1|\\lambda_0)$，我们执行一组 $n_0$ 次独立试验。每次试验都从界面 $\\lambda_0$ 上的一个构型开始。这些初始构型从阶段 1 中收集的集合中抽取。通过使用不同的起始构型，以及必要时使用不同的随机数种子，我们确保这些试验是马尔可夫过程的独立实现。\n- $n_0$ 次试验中的每一次都运行，直到轨迹到达 $\\lambda_1$（“成功”）或通过反向穿过 $\\lambda_0$ 返回状态 $A$（“失败”）。\n- 成功试验的次数 $s_0$ 被计数。根据所提供的条件概率定义，估计量为：\n$$P(\\lambda_1|\\lambda_0) \\approx \\frac{s_0}{n_0}$$\n- 系统在成功到达 $\\lambda_1$ 瞬间的构型被保存下来。这些构型构成了下一次迭代的起始池。\n\n- **对于 $i  0$**：对从 $1$ 到 $M-1$ 的每个后续界面 $i$ 重复此过程。为估计 $P(\\lambda_{i+1}|\\lambda_i)$，我们从界面 $\\lambda_i$ 上的构型开始执行 $n_i$ 次独立试验。这些起始构型是从前一次迭代的成功终点集合中抽取的（即，从 $\\lambda_{i-1}$ 到达 $\\lambda_i$ 的试验中）。\n- 我们计算成功的次数 $s_i$，即在返回 $A$ 之前到达 $\\lambda_{i+1}$ 的试验次数。\n- 条件概率的估计量为：\n$$P(\\lambda_{i+1}|\\lambda_i) \\approx \\frac{s_i}{n_i}$$\n这个迭代过程生成了一个轨迹级联，逐步弥合 $A$ 和 $B$ 之间的差距，其中轨迹的数量在每个界面根据分裂概率进行剪枝。\n\n**速率常数的最终估计量 (任务 B)**\n通过将通量和每个条件概率的经验估计量代入 FFS 核心方程，我们得到估计的 $A \\to B$ 跃迁速率的最终表达式。\n给定：\n- 在观测时间 $T$ 内的首次穿越计数 $c$。\n- 对于每个界面索引 $i \\in \\{0, 1, \\dots, M-1\\}$，试验次数 $n_i$ 和成功次数 $s_i$。\n\n速率常数 $k_{AB}$ 的估计量是：\n$$k_{AB}^{\\text{est}} = \\left(\\frac{c}{T}\\right) \\times \\left(\\frac{s_0}{n_0}\\right) \\times \\left(\\frac{s_1}{n_1}\\right) \\times \\dots \\times \\left(\\frac{s_{M-1}}{n_{M-1}}\\right)$$\n这可以紧凑地写为：\n$$k_{AB}^{\\text{est}} = \\frac{c}{T} \\prod_{i=0}^{M-1} \\frac{s_i}{n_i}$$\n这个表达式就是所要求的结果。它是直接从通量和条件概率的基本定义，并结合马尔可夫性质所允许的分解推导出来的。如果 $c=0$，经验通量为 $0$，因此速率估计值为 $0$。类似地，如果对于某个 $n_i0$ 有 $s_i=0$，则相应的经验概率为 $0$，这使得整个乘积以及速率估计值等于 $0$。这与经验观察到在界面 $\\lambda_i$ 之外没有找到成功路径是一致的。这就是需要实现的公式。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Forward Flux Sampling (FFS) transition rate estimate\n    for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a dictionary containing the required parameters.\n    test_cases = [\n        # Case 1\n        {\n            \"T\": 1e7, \"c\": 500, \"M\": 4, \n            \"n\": np.array([2000, 1500, 1000, 800]), \n            \"s\": np.array([600, 180, 36, 18])\n        },\n        # Case 2\n        {\n            \"T\": 5e6, \"c\": 50, \"M\": 1, \n            \"n\": np.array([1000]), \n            \"s\": np.array([5])\n        },\n        # Case 3\n        {\n            \"T\": 1e7, \"c\": 1000, \"M\": 3, \n            \"n\": np.array([1000, 500, 500]), \n            \"s\": np.array([400, 0, 250])\n        },\n        # Case 4\n        {\n            \"T\": 1e6, \"c\": 0, \"M\": 2, \n            \"n\": np.array([100, 100]), \n            \"s\": np.array([12, 3])\n        },\n        # Case 5\n        {\n            \"T\": 2e8, \"c\": 1200, \"M\": 6, \n            \"n\": np.array([5000, 4000, 3000, 2500, 2000, 1500]), \n            \"s\": np.array([250, 80, 24, 6, 2, 1])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        T = case[\"T\"]\n        c = case[\"c\"]\n        n = case[\"n\"]\n        s = case[\"s\"]\n        \n        # The FFS rate estimator is k_est = (c/T) * product(s_i / n_i).\n        \n        # Calculate the initial flux, Phi_0 = c / T.\n        # If c is 0, the flux is 0, and the final rate estimate is 0.\n        if c == 0:\n            results.append(0.0)\n            continue\n            \n        initial_flux = c / T\n        \n        # Calculate the product of conditional probabilities, P = product(s_i / n_i).\n        # According to the problem, all n_i are strictly positive.\n        # If any s_i is 0, the product will be 0, and the rate is 0.\n        # The np.prod function on an empty array returns 1, which is correct for M=0.\n        # Here we compute the probabilities s_i/n_i and then their product.\n        probabilities = s / n\n        prob_product = np.prod(probabilities)\n        \n        # The final rate is the product of the initial flux and the probability product.\n        rate_estimate = initial_flux * prob_product\n        results.append(rate_estimate)\n\n    # Print the final results in the specified format. The output is a single\n    # line containing a comma-separated list of floating-point numbers\n    # enclosed in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2667199"}]}