{"hands_on_practices": [{"introduction": "计算平均首达时间（MFPT）的基础是第一步分析法，这是一种强大的概率推理工具。这项练习将通过一个最简单的双态系统，向您介绍如何应用该方法，将一个复杂的时间演化问题分解为对下一步可能发生的事件的条件分析。掌握这个基础案例将为您理解更复杂的网络打下核心直觉。[@problem_id:2654448]", "problem": "考虑一个具有 $2$ 个状态（标记为 $1$ 和 $2$）的可逆单分子反应网络，代表化学物质的相互转化 $X_1 \\rightleftharpoons X_2$。该动力学过程被建模为一个连续时间马尔可夫链 (CTMC)，其从状态 $1$ 到状态 $2$ 的转移速率为常数 $k_{12}$，从状态 $2$ 到状态 $1$ 的转移速率为常数 $k_{21}$。假设采用标准的马尔可夫跳跃过程假设：等待时间呈指数分布，其参数等于当前状态所有出射速率之和，且转移过程无记忆性。\n\n定义平均首达时间 (MFPT) $T_i$ 为从状态 $i$ 出发首次到达状态 $2$ 的期望时间。利用基于指数等待时间和马尔可夫性质定义的首步分析法，推导一个关于 $T_1$ 的方程，并求解该方程以获得用 $k_{12}$ 和 $k_{21}$ 表示的闭式表达式。清晰地陈述你所施加的任何边界条件，并从物理上证明其合理性。\n\n将 $T_1$ 的最终答案以秒为单位，用 $k_{12}$ 和 $k_{21}$ 表示成一个单一的闭式解析表达式。不要四舍五入。", "solution": "在尝试求解之前，需对问题陈述进行验证。\n\n首先，从问题陈述中逐字提取已知条件：\n- 一个具有 $2$ 个状态（标记为 $1$ 和 $2$）的可逆单分子反应网络。\n- 该网络代表相互转化 $X_1 \\rightleftharpoons X_2$。\n- 该动力学过程被建模为一个连续时间马尔可夫链 (CTMC)。\n- 从状态 $1$ 到状态 $2$ 的转移速率是一个常数 $k_{12}$。\n- 从状态 $2$ 到状态 $1$ 的转移速率是一个常数 $k_{21}$。\n- 采用标准的马尔可夫跳跃过程假设：等待时间呈指数分布且转移过程无记忆性。\n- 平均首达时间 (MFPT) $T_i$ 是从状态 $i$ 出发首次到达状态 $2$ 的期望时间。\n- 任务是使用首步分析法推导一个关于 $T_1$ 的方程并求解。\n\n其次，根据所需标准对问题进行验证。\n- **科学依据：** 该问题基于连续时间马尔可夫链的标准理论，这是化学动力学和随机过程中的一个基本工具。平均首达时间的概念及其通过首步分析法的推导是标准的、完善的程序。该问题在科学上是合理的。\n- **适定性：** 该问题对一个双态 CTMC 进行了完整描述，并要求一个特定的、可计算的量 ($T_1$)。此计算所需的所有必要参数 ($k_{12}$) 均已提供。该问题是适定的，并有唯一解。\n- **客观性：** 该问题使用精确、无歧义的数学和科学术语进行陈述。它不含主观或推测性内容。\n\n该问题没有违反任何指定的无效标准。这是一个化学动力学中的标准、可形式化的问题。速率 $k_{21}$ 虽然已给出，但对于计算 *到* 状态 $2$ 的首达时间来说是无关紧要的，因为根据定义，过程在首次到达此目标状态时即停止。这并不构成矛盾，而是此类问题的共同特征，旨在考验学生识别相关信息的能力。\n\n结论是该问题是 **有效的**。将提供解答。\n\n目标是求系统从状态 $1$ 出发到状态 $2$ 的平均首达时间 (MFPT)。设系统在时间 $t$ 的状态为 $X(t) \\in \\{1, 2\\}$。从状态 $i$ 到状态 $j$ 的 MFPT 记为 $T_{i \\to j}$。在这里，我们关心的是 $T_{1 \\to 2}$，问题中记为 $T_1$。形式上，$T_i = E[\\tau_2 | X(0) = i]$，其中 $\\tau_2 = \\inf\\{t \\ge 0 : X(t) = 2\\}$ 是到状态 $2$ 的首达时间。\n\n所采用的方法是首步分析法，即对无穷小时间间隔 $\\Delta t$ 内发生的第一个事件进行条件分析。\n\n首先，我们建立边界条件。问题要求的是首次到达状态 $2$ 的期望时间。如果过程从状态 $2$ 开始 (即 $i=2$)，那么它在时间 $t=0$ 时已经到达了目标状态。因此，所用时间为零。边界条件是：\n$$T_2 = 0$$\n\n现在，我们推导关于 $T_1$ 的方程。考虑系统在时间 $t=0$ 时从状态 $1$ 开始。我们分析在一个小时间间隔 $[0, \\Delta t]$ 内的过程。根据 CTMC 的性质，在此时间间隔内从状态 $1$ 转移到状态 $2$ 的概率为 $k_{12} \\Delta t + o(\\Delta t)$，其中 $o(\\Delta t)$ 代表比 $\\Delta t$更快趋于零的项。相应地，停留在状态 $1$ 的概率是 $1 - k_{12} \\Delta t + o(\\Delta t)$。\n\n根据全期望定律，我们可以将 $T_1$ 写成基于在第一个时间间隔 $\\Delta t$ 内发生的情况的条件期望之和：\n$$T_1 = E[\\tau_2 | \\text{jump to } 2 \\text{ in } \\Delta t] P(\\text{jump to } 2 \\text{ in } \\Delta t) + E[\\tau_2 | \\text{no jump in } \\Delta t] P(\\text{no jump in } \\Delta t)$$\n\n我们来分析每一项：\n1. 如果在 $\\Delta t$ 内发生从状态 $1$ 到状态 $2$ 的跳跃，则经过的时间约为 $\\Delta t$。一旦进入状态 $2$，到达状态 $2$ 的剩余期望时间为 $T_2$。这种情况下总的期望时间是 $\\Delta t + T_2$。\n2. 如果没有发生跳跃，则经过的时间为 $\\Delta t$。由于马尔可夫过程的无记忆性，系统仍处于状态 $1$，从此刻起到达状态 $2$ 的剩余期望时间仍然是 $T_1$。这种情况下总的期望时间是 $\\Delta t + T_1$。\n\n将这些项及其各自的概率代入方程，得到：\n$$T_1 = (\\Delta t + T_2)(k_{12} \\Delta t + o(\\Delta t)) + (\\Delta t + T_1)(1 - k_{12} \\Delta t + o(\\Delta t))$$\n\n现在，我们代入边界条件 $T_2=0$：\n$$T_1 = (\\Delta t)(k_{12} \\Delta t + o(\\Delta t)) + (\\Delta t + T_1)(1 - k_{12} \\Delta t + o(\\Delta t))$$\n展开表达式：\n$$T_1 = k_{12} (\\Delta t)^2 + \\Delta t \\cdot o(\\Delta t) + \\Delta t - k_{12} T_1 \\Delta t + T_1 \\cdot o(\\Delta t) + T_1 - k_{12} T_1 \\Delta t + T_1 \\cdot o(\\Delta t)$$\n我们合并同类项，并认识到 $(\\Delta t)^2$ 项和 $o(\\Delta t)$ 项是更高阶的，可以合并为一个单一的 $o(\\Delta t)$ 项：\n$$T_1 = T_1 + \\Delta t - k_{12} T_1 \\Delta t + o(\\Delta t)$$\n两边同时减去 $T_1$ 得到：\n$$0 = \\Delta t - k_{12} T_1 \\Delta t + o(\\Delta t)$$\n整个方程除以 $\\Delta t$ (对于 $\\Delta t \\neq 0$)：\n$$0 = 1 - k_{12} T_1 + \\frac{o(\\Delta t)}{\\Delta t}$$\n取极限 $\\Delta t \\to 0$，根据定义，项 $\\frac{o(\\Delta t)}{\\Delta t}$ 趋于 $0$。这就得到了关于 $T_1$ 的最终线性方程：\n$$1 - k_{12} T_1 = 0$$\n这就是问题所要求的关于 $T_1$ 的方程。求解 $T_1$ 很简单：\n$$k_{12} T_1 = 1$$\n$$T_1 = \\frac{1}{k_{12}}$$\n\n这个结果在物理上是直观的。系统处于状态 $1$，唯一的逃逸路径通向目标状态 $2$。在状态 $1$ 的等待时间呈指数分布，速率参数为 $k_{12}$。该指数分布的均值为 $1/k_{12}$。因此，离开状态 $1$（从而首次到达状态 $2$）的平均时间恰好是 $1/k_{12}$。速率 $k_{21}$ 是无关的，因为该过程被定义为一旦到达状态 $2$ 就停止，这使得状态 $2$ 在这个特定计算中成为一个吸收态。如果速率 $k_{12}$ 和 $k_{21}$ 的单位是秒的倒数 ($s^{-1}$)，那么 $T_1$ 的单位将是秒。", "answer": "$$\\boxed{\\frac{1}{k_{12}}}$$", "id": "2654448"}, {"introduction": "现实世界中的反应网络通常包含多个中间态和反应路径。这项练习将第一步分析法推广到一个系统性的、基于矩阵的普适方法，它直接源于倒向科尔莫戈罗夫方程。这种方法使我们能够为任何有限状态网络建立一个线性方程组来求解平均首达时间，从而将动力学问题转化为一个标准的线性代数问题。[@problem_id:2654482]", "problem": "考虑一个连续时间马尔可夫链 (CTMC)，该链模拟了具有中间错误处理途径的单分子转化过程。状态空间由四种化学状态组成：$S_0$ (天然反应物)，$S_1$ (活化中间体)，$S_2$ (错误处理的中间体) 和 $S_3$ (最终产物)。产物状态 $S_3$ 是吸收态。跃迁及其速率 (单位为 $\\mathrm{s}^{-1}$) 如下：\n- $S_0 \\to S_1$，速率为 $k_1 = 2$，\n- $S_0 \\to S_2$，速率为 $k_2 = 1$，\n- $S_1 \\to S_0$，速率为 $k_{-1} = 1$，\n- $S_1 \\to S_3$，速率为 $k_3 = 1$，\n- $S_2 \\to S_1$，速率为 $k_4 = 3$，\n- $S_2 \\to S_3$，速率为 $k_5 = 2$。\n\n生成元矩阵 $Q$ (行和列按 $S_0,S_1,S_2,S_3$ 排序) 为\n$$\nQ \\;=\\;\n\\begin{pmatrix}\n-(k_1+k_2)  k_1  k_2  0 \\\\\nk_{-1}  -(k_{-1}+k_3)  0  k_3 \\\\\n0  k_4  -(k_4+k_5)  k_5 \\\\\n0  0  0  0\n\\end{pmatrix}.\n$$\n\n从 CTMC 生成元的基本定义和关于期望击中时间的后向 (Kolmogorov) 方程出发，推导控制从每个瞬时态到吸收态 $S_3$ 的平均首达时间 (MFPT) 的线性系统。然后，求解该线性系统以获得瞬时态 $S_0,S_1,S_2$ 的 MFPT 向量 $\\mathbf{m}$。简要地从物理角度解释 $\\mathbf{m}$ 中的每个条目。仅报告从 $S_0$ 开始到吸收态的 MFPT 作为你的最终答案。以秒为单位，精确表达你的最终答案 (不要四舍五入)。在你的最终答案框中不要包含单位。", "solution": "该问题是有效的，因为它在应用于化学动力学的连续时间马尔可夫链的标准框架内提出了一个适定问题。所有必要的参数和定义都已提供，并且没有科学或逻辑上的矛盾。\n\n设连续时间马尔可夫链 (CTMC) 的状态空间为 $S = \\{S_0, S_1, S_2, S_3\\}$。瞬时态集合为 $I = \\{S_0, S_1, S_2\\}$，吸收态集合为 $A = \\{S_3\\}$。我们需要求解到吸收态 $S_3$ 的平均首达时间 (MFPT)。设 $m_i$ 为从状态 $S_i \\in I$ 开始到集合 $A$ 的 MFPT。根据定义，从吸收态到其自身的 MFPT 为零，因此 $m_3 = 0$。\n\n瞬时态的 MFPT 由后向 Kolmogorov 方程决定。对于任何瞬时态 $S_i \\in I$，我们可以通过对离开状态 $S_i$ 的第一次跃迁进行条件化来推导 $m_i$ 的方程。直到第一次跃迁的时间 $\\tau_i$ 是一个指数随机变量，其速率为 $\\lambda_i = -q_{ii} = \\sum_{j \\neq i} q_{ij}$，其中 $q_{ij}$ 是生成元矩阵 $Q$ 的元素。这次跃迁到状态 $S_j$ 的概率是 $p_{ij} = q_{ij} / \\lambda_i$。利用全期望定律和马尔可夫过程的无记忆性，MFPT $m_i$ 可以表示为在状态 $S_i$ 的平均等待时间与从后续状态到吸收态的期望时间之和：\n$$\nm_i = E[\\tau_i] + \\sum_{j \\in S} p_{ij} m_j = \\frac{1}{\\lambda_i} + \\sum_{j \\in S} \\frac{q_{ij}}{\\lambda_i} m_j\n$$\n两边乘以 $\\lambda_i = -q_{ii}$ 得到：\n$$\n\\lambda_i m_i = 1 + \\sum_{j \\in S} q_{ij} m_j\n$$\n$$\n-q_{ii} m_i = 1 + \\sum_{j \\neq i} q_{ij} m_j\n$$\n整理各项，我们得到：\n$$\n1 + \\sum_{j \\neq i} q_{ij} m_j + q_{ii} m_i = 0\n$$\n由于 $\\sum_j q_{ij} = 0$，这变为：\n$$\n1 + \\sum_{j \\in S} q_{ij} m_j = 0\n$$\n该方程组对每个瞬时态 $S_i \\in I$ 都成立。我们可以将求和分为瞬时态和吸收态两部分：\n$$\n1 + \\sum_{j \\in I} q_{ij} m_j + \\sum_{j \\in A} q_{ij} m_j = 0\n$$\n由于对于所有 $j \\in A$都有 $m_j=0$，该方程简化为：\n$$\n\\sum_{j \\in I} q_{ij} m_j = -1 \\quad \\text{for each } S_i \\in I\n$$\n这可以写成矩阵形式。设 $\\mathbf{m}$ 是瞬时态 MFPT 的列向量，$\\mathbf{m} = \\begin{pmatrix} m_0 \\\\ m_1 \\\\ m_2 \\end{pmatrix}$。设 $Q_T$ 是生成元矩阵 $Q$ 中对应于瞬时态 $I$ 之间跃迁的子矩阵。该方程组为：\n$$\nQ_T \\mathbf{m} = -\\mathbf{1}\n$$\n其中 $\\mathbf{1}$ 是一个全为 1 的列向量。\n\n根据题目描述，瞬时态集合为 $\\{S_0, S_1, S_2\\}$，并且生成元矩阵已给出。子矩阵 $Q_T$ 由 $Q$ 的前三行和前三列组成：\n$$\nQ_T =\n\\begin{pmatrix}\n-(k_1+k_2)  k_1  k_2 \\\\\nk_{-1}  -(k_{-1}+k_3)  0 \\\\\n0  k_4  -(k_4+k_5)\n\\end{pmatrix}\n$$\n我们已知速率常数：$k_1 = 2 \\, \\mathrm{s}^{-1}$，$k_2 = 1 \\, \\mathrm{s}^{-1}$，$k_{-1} = 1 \\, \\mathrm{s}^{-1}$，$k_3 = 1 \\, \\mathrm{s}^{-1}$，$k_4 = 3 \\, \\mathrm{s}^{-1}$ 和 $k_5 = 2 \\, \\mathrm{s}^{-1}$。\n将这些值代入矩阵 $Q_T$：\n$k_1+k_2 = 2+1 = 3$\n$k_{-1}+k_3 = 1+1 = 2$\n$k_4+k_5 = 3+2 = 5$\n所以，矩阵 $Q_T$ 是：\n$$\nQ_T =\n\\begin{pmatrix}\n-3  2  1 \\\\\n1  -2  0 \\\\\n0  3  -5\n\\end{pmatrix}\n$$\n需要求解的关于 $\\mathbf{m} = (m_0, m_1, m_2)^T$ 的线性系统是：\n$$\n\\begin{pmatrix}\n-3  2  1 \\\\\n1  -2  0 \\\\\n0  3  -5\n\\end{pmatrix}\n\\begin{pmatrix}\nm_0 \\\\\nm_1 \\\\\nm_2\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-1 \\\\\n-1 \\\\\n-1\n\\end{pmatrix}\n$$\n这对应于以下线性方程组：\n1. $-3m_0 + 2m_1 + m_2 = -1$\n2. $m_0 - 2m_1 = -1$\n3. $3m_1 - 5m_2 = -1$\n\n从方程 (2) 中，我们可以用 $m_1$ 表示 $m_0$：\n$m_0 = 2m_1 - 1$\n从方程 (3) 中，我们可以用 $m_1$ 表示 $m_2$：\n$5m_2 = 3m_1 + 1 \\implies m_2 = \\frac{3m_1 + 1}{5}$\n\n现在，我们将 $m_0$ 和 $m_2$ 的表达式代入方程 (1)：\n$$\n-3(2m_1 - 1) + 2m_1 + \\left(\\frac{3m_1 + 1}{5}\\right) = -1\n$$\n$$\n-6m_1 + 3 + 2m_1 + \\frac{3m_1 + 1}{5} = -1\n$$\n$$\n-4m_1 + 3 + \\frac{3m_1 + 1}{5} = -1\n$$\n为了消去分数，我们将整个方程乘以 $5$：\n$$\n-20m_1 + 15 + (3m_1 + 1) = -5\n$$\n$$\n-17m_1 + 16 = -5\n$$\n$$\n-17m_1 = -21\n$$\n$$\nm_1 = \\frac{21}{17}\n$$\n现在我们可以求出 $m_0$ 和 $m_2$：\n$$\nm_0 = 2m_1 - 1 = 2\\left(\\frac{21}{17}\\right) - 1 = \\frac{42}{17} - \\frac{17}{17} = \\frac{25}{17}\n$$\n$$\nm_2 = \\frac{3m_1 + 1}{5} = \\frac{3\\left(\\frac{21}{17}\\right) + 1}{5} = \\frac{\\frac{63}{17} + \\frac{17}{17}}{5} = \\frac{\\frac{80}{17}}{5} = \\frac{80}{17 \\cdot 5} = \\frac{16}{17}\n$$\n瞬时态的 MFPT 向量为 $\\mathbf{m} = \\begin{pmatrix} 25/17 \\\\ 21/17 \\\\ 16/17 \\end{pmatrix}$。\n\n每个条目的简要物理学解释：\n- $m_0 = 25/17 \\approx 1.47 \\, \\mathrm{s}$：这是系统从天然反应物态 $S_0$ 开始，转化成最终产物 $S_3$ 所需的平均时间。\n- $m_1 = 21/17 \\approx 1.24 \\, \\mathrm{s}$：这是系统从活化中间体 $S_1$ 开始，到达产物态 $S_3$ 所需的平均时间。\n- $m_2 = 16/17 \\approx 0.94 \\, \\mathrm{s}$：这是系统从错误处理的中间体 $S_2$ 开始，到达产物态 $S_3$ 所需的平均时间。\n\n$m_2  m_1  m_0$ 这个排序在物理上是直观的。初始态 $S_0$ 离产物最远，因为它必须首先跃迁到一个中间态 ($S_1$ 或 $S_2$)。错误处理的中间态 $S_2$ 的 MFPT 最短，因为它有很高的总离开速率 ($5 \\, \\mathrm{s}^{-1}$) 和一个相对较高的直接转化为产物的速率 ($k_5 = 2 \\, \\mathrm{s}^{-1}$)。活化态 $S_1$ 的 MFPT 比 $S_2$ 长，因为它的总离开速率较低 ($2 \\, \\mathrm{s}^{-1}$)，并且存在非零概率返回到离目标更远的初始态 $S_0$。\n\n问题要求的是从 $S_0$ 开始到吸收态的 MFPT，即 $m_0$。", "answer": "$$\\boxed{\\frac{25}{17}}$$", "id": "2654482"}, {"introduction": "除了追踪单条反应路径，我们还可以从系统整体动力学的角度来理解平均首达时间。本练习引入了准稳态分布（QSD）的概念，它描述了系统在被吸收前长时间停留在瞬态集中的概率分布。您将学习到，从准稳态分布出发的平均首达时间与系统最慢的弛豫模式直接相关，而这可以通过计算反应网络生成元矩阵的特征值来高效地确定，为分析大型复杂系统提供了强有力的计算工具。[@problem_id:2654449]", "problem": "考虑一个定义在有限状态空间上的连续时间马尔可夫链（CTMC），其生成元矩阵 $Q$ 被划分为一个瞬时集 $T$ 和一个吸收集 $A$。要求在瞬时集 $T$ 上的准稳态分布（QSD）下，仅利用柯尔莫哥洛夫前向方程的基本定义以及瞬时类上子生成元的性质，估计从瞬时集到吸收的平均首达时间（MFPT）。你的任务是从第一性原理出发，推导出一个数学上可靠的方法来计算支撑在 $T$ 上的 QSD，并利用该分布下适当的平均离开率来估计 MFPT。然后，将此方法实现为一个程序，该程序接受一组预定义的测试用例并返回 MFPT 值。\n\n定义与假设：\n- 设 $Q$ 为 CTMC 的生成元矩阵，其元素 $q_{ij}$ 的单位为 $\\mathrm{s}^{-1}$。\n- 状态空间被划分为 $S = T \\cup A$，其中 $T$ 为瞬时状态集，$A$ 为吸收状态集。一旦过程进入 $A$，它将永远停留在那里。\n- 子生成元 $Q_{TT}$ 是将 $Q$ 限制在瞬时状态 $T$ 上所得到的主子矩阵。\n- 准稳态分布（QSD）是过程以未被吸收为条件下的平稳分布。MFPT 应以秒为单位报告。\n\n程序要求：\n1. 仅从柯尔莫哥洛夫前向方程和准稳态的定义出发，推导刻画 $T$ 上 QSD 的关系以及相关的存活概率指数衰减率。基于此推导，设计一个算法以实现以下功能：\n   - 为每个测试用例构建 $Q_{TT}$。\n   - 使用 $Q_{TT}$ 的适当谱特征来计算 $T$ 上的 QSD。\n   - 计算在 QSD 下从 $T$ 离开的相应平均离开率。\n   - 使用平均离开率估计在 QSD 下从 $T$ 到 $A$ 的 MFPT。\n2. 实现该算法并将其应用于下面的测试套件。所有 MFPT 均以秒为单位表示，并四舍五入到六位小数的浮点数。\n3. 输出格式：你的程序应生成单行输出，其中包含所有测试用例的 MFPT 结果，形式为方括号内以逗号分隔的列表（例如 $[x_1,x_2,x_3]$），不含多余的空格或文本。\n\n测试套件（每个测试用例指定了所有非零转移率 $q_{ij}$，单位为 $\\mathrm{s}^{-1}$；任何未列出的条目均为 $0$；对角线元素满足生成元约束，即 $Q$ 的每行之和为 $0$）：\n\n- 测试用例 1：\n  - 状态：$S = \\{0,1,2,3\\}$，其中 $T = \\{0,1,2\\}$ 且 $A = \\{3\\}$。\n  - 非零非对角线转移率：\n    - 从状态 0：$q_{0,1} = 2.0$, $q_{0,2} = 1.0$, $q_{0,3} = 0.5$。\n    - 从状态 1：$q_{1,0} = 1.0$, $q_{1,2} = 3.0$, $q_{1,3} = 0.2$。\n    - 从状态 2：$q_{2,0} = 0.1$, $q_{2,1} = 0.5$, $q_{2,3} = 0.3$。\n    - 状态 3 是吸收态：其在 $Q$ 中的整行为 $0$。\n\n- 测试用例 2：\n  - 状态：$S = \\{0,1,2,3\\}$，其中 $T = \\{0,1\\}$ 且 $A = \\{2,3\\}$。\n  - 非零非对角线转移率：\n    - 从状态 0：$q_{0,1} = 4.0$, $q_{0,2} = 0.5$, $q_{0,3} = 0.5$。\n    - 从状态 1：$q_{1,0} = 1.0$, $q_{1,2} = 0.1$, $q_{1,3} = 2.0$。\n    - 状态 2 和 3 是吸收态：它们的行为 $0$。\n\n- 测试用例 3：\n  - 状态：$S = \\{0,1,2,3\\}$，其中 $T = \\{0,1,2\\}$ 且 $A = \\{3\\}$。\n  - 非零非对角线转移率：\n    - 从状态 0：$q_{0,1} = 0.2$, $q_{0,2} = 0.1$, $q_{0,3} = 0.01$。\n    - 从状态 1：$q_{1,0} = 0.15$, $q_{1,2} = 0.1$, $q_{1,3} = 0.02$。\n    - 从状态 2：$q_{2,0} = 0.05$, $q_{2,1} = 0.1$, $q_{2,3} = 0.03$。\n    - 状态 3 是吸收态：其行为 $0$。\n\n- 测试用例 4（只有一个瞬时状态的边界情况）：\n  - 状态：$S = \\{0,1\\}$，其中 $T = \\{0\\}$ 且 $A = \\{1\\}$。\n  - 非零非对角线转移率：\n    - 从状态 0：$q_{0,1} = 7.5$。\n    - 状态 1 是吸收态：其行为 $0$。\n\n实现细节：\n- 构建每个完整的生成元矩阵 $Q$，其对角线元素的定义应使每行之和为 $0$。\n- 为每个案例提取 $Q_{TT}$。\n- 使用从第一性原理推导出的谱特征来获得 $T$ 上的 QSD 和相应的平均离开率。以秒为单位估计 MFPT，并四舍五入到六位小数。\n- 最终输出格式：单行形式为 $[m_1,m_2,m_3,m_4]$，其中每个 $m_i$ 是测试用例 $i$ 的 MFPT，如上所述，以秒为单位并四舍五入到六位小数。", "solution": "所述问题具有科学依据、提法明确、客观且自成体系。它提出了连续时间马尔可夫链理论中一个标准但并非无足轻重的问题，要求从第一性原理推导出解决方案。为测试用例提供的数据是完整且一致的。因此，该问题是有效的，我们可以着手解决。\n\n目标是确定从瞬时状态集 $T$到吸收状态集 $A$ 的平均首达时间（MFPT），其前提是系统已在 $T$ 上稳定到准稳态分布（QSD）。我们将从柯尔莫哥洛夫前向方程开始推导该方法。\n\n设 $p_i(t)$ 是系统在时间 $t$ 处于状态 $i$ 的概率。对于一个生成元矩阵为 $Q$ 的连续时间马尔可夫链，概率向量 $p(t)$ 的时间演化由柯尔莫哥洛夫前向方程（写为行向量形式）决定：\n$$\n\\frac{d p(t)}{dt} = p(t) Q\n$$\n设状态空间 $S$ 被划分为瞬时集 $T$ 和吸收集 $A$。我们可以相应地对向量 $p(t)$ 和矩阵 $Q$ 进行分块：\n$$\np(t) = [p_T(t) \\quad p_A(t)] \\quad \\text{and} \\quad Q = \\begin{pmatrix} Q_{TT}  Q_{TA} \\\\ \\mathbf{0}  \\mathbf{0} \\end{pmatrix}\n$$\n这里，$p_T(t)$ 是状态在 $T$ 中的概率向量，$Q_{TT}$ 是 $T$ 内部转移的子生成元，$Q_{TA}$ 是从 $T$ 到 $A$ 转移的速率矩阵。从 $A$ 返回到 $T$ 的子矩阵为零，因为 $A$ 是吸收集。瞬时状态的微分方程为：\n$$\n\\frac{d p_T(t)}{dt} = p_T(t) Q_{TT}\n$$\n存活概率 $S(t)$ 是指在时间 $t$ 过程尚未被吸收的概率：\n$$\nS(t) = \\sum_{i \\in T} p_i(t)\n$$\n准稳态分布（QSD），我们用行向量 $\\pi = (\\pi_i)_{i \\in T}$ 表示，是在未发生吸收的条件下 $T$ 上的条件概率分布。对于一个已经演化了很长时间的过程，QSD 由以下极限定义：\n$$\n\\pi_i = \\lim_{t \\to \\infty} P(X(t)=i | X(t) \\in T) = \\lim_{t \\to \\infty} \\frac{p_i(t)}{S(t)}\n$$\n在准稳态机制下，条件概率 $\\pi_i$ 不随时间变化。这意味着对于大的 $t$，无条件概率必须具有 $p_i(t) = \\pi_i S(t)$ 的形式（对于 $i \\in T$）。\n\n现在我们将此关系代入瞬时状态的前向方程中。对于每个 $i \\in T$：\n$$\n\\frac{d p_i(t)}{dt} = \\frac{d}{dt} (\\pi_i S(t)) = \\pi_i \\frac{dS(t)}{dt}\n$$\n前向方程同样给出：\n$$\n\\frac{d p_i(t)}{dt} = \\sum_{j \\in T} p_j(t) q_{ji} = \\sum_{j \\in T} (\\pi_j S(t)) q_{ji} = S(t) \\sum_{j \\in T} \\pi_j q_{ji} = S(t) (\\pi Q_{TT})_i\n$$\n令 $\\frac{d p_i(t)}{dt}$ 的两个表达式相等，我们得到：\n$$\n\\pi_i \\frac{dS(t)}{dt} = S(t) (\\pi Q_{TT})_i\n$$\n整理得：\n$$\n\\frac{1}{S(t)} \\frac{dS(t)}{dt} = \\frac{(\\pi Q_{TT})_i}{\\pi_i}\n$$\n左侧与状态 $i$ 无关。因此，右侧对于所有 $i \\in T$ 也必须是一个常数。我们用 $-\\lambda_0$ 表示这个常数。\n$$\n\\frac{1}{S(t)} \\frac{dS(t)}{dt} = -\\lambda_0 \\implies S(t) = S(0) e^{-\\lambda_0 t}\n$$\n这表明存活概率以速率 $\\lambda_0  0$呈指数衰减。常数 $\\lambda_0$ 是从准稳态吸收的速率。关于 $\\pi$ 的关系变为：\n$$\n(\\pi Q_{TT})_i = -\\lambda_0 \\pi_i \\quad \\text{for all } i \\in T\n$$\n以向量形式表示，这是子生成元 $Q_{TT}$ 的左特征值方程：\n$$\n\\pi Q_{TT} = -\\lambda_0 \\pi\n$$\n该方程确立了 QSD $\\pi$ 是 $Q_{TT}$ 对应于特征值 $-\\lambda_0$ 的左特征向量。根据不可约 Metzler 矩阵（对于一个连通的瞬时类，$Q_{TT}$ 就是这种矩阵）的 Perron-Frobenius 定理，存在一个唯一的实特征值，其值大于任何其他特征值的实部。这就是主特征值，其对应的左特征向量所有分量均为正。在我们的情境中，这个特征值是 $-\\lambda_0$，其特征向量是 QSD $\\pi$（归一化后）。因此，$-\\lambda_0$ 是 $Q_{TT}$ 的具有最大实部（即最接近零）的特征值。\n\n对于从 QSD 开始的过程，其吸收时间 $\\tau_A$ 的概率密度函数由 $f(t) = -\\frac{dS(t)}{dt} = \\lambda_0 e^{-\\lambda_0 t}$ 给出。这是一个速率为 $\\lambda_0$ 的指数分布。该分布的均值即为 QSD 下的 MFPT：\n$$\n\\text{MFPT}_{QSD} = \\mathbb{E}[\\tau_A] = \\frac{1}{\\lambda_0}\n$$\n由于 $\\lambda_0 = -(-\\lambda_0)$，其中 $-\\lambda_0$ 是 $Q_{TT}$ 的主特征值，我们可以写成：\n$$\n\\text{MFPT}_{QSD} = \\frac{1}{-(-\\lambda_0)} = -\\frac{1}{\\lambda_{principal}}\n$$\n其中 $\\lambda_{principal}$ 是 $Q_{TT}$ 的主特征值。\n\n此推导提供了一种直接且高效的算法来计算 QSD 下的 MFPT：\n1. 对于给定的系统，根据指定的转移率构建子生成元矩阵 $Q_{TT}$。对角线元素的设置应使完整的生成元矩阵 $Q$ 的每行之和为零，即 $q_{ii} = -\\sum_{j \\neq i} q_{ij}$。\n2. 计算矩阵 $Q_{TT}$ 的所有特征值。\n3. 识别主特征值 $\\lambda_{principal}$，即具有最大实部的特征值。对于一个不可约的瞬时类，该特征值将是实数且为负。\n4. 然后，MFPT 计算为 $-1 / \\lambda_{principal}$。由于速率单位是 $\\mathrm{s}^{-1}$，因此结果的单位是秒。\n\n此过程绕过了对 QSD 特征向量的显式计算，因为基本信息已包含在主特征值中。我们现在将实现此算法。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the mean first passage time (MFPT) under the quasi-stationary\n    distribution for several continuous-time Markov chain models.\n    \"\"\"\n\n    test_cases = [\n        {\n            # Test case 1\n            \"T\": {0, 1, 2},\n            \"A\": {3},\n            \"rates\": {  # Nonzero off-diagonal q_ij\n                0: {1: 2.0, 2: 1.0, 3: 0.5},\n                1: {0: 1.0, 2: 3.0, 3: 0.2},\n                2: {0: 0.1, 1: 0.5, 3: 0.3},\n            },\n        },\n        {\n            # Test case 2\n            \"T\": {0, 1},\n            \"A\": {2, 3},\n            \"rates\": {\n                0: {1: 4.0, 2: 0.5, 3: 0.5},\n                1: {0: 1.0, 2: 0.1, 3: 2.0},\n            },\n        },\n        {\n            # Test case 3\n            \"T\": {0, 1, 2},\n            \"A\": {3},\n            \"rates\": {\n                0: {1: 0.2, 2: 0.1, 3: 0.01},\n                1: {0: 0.15, 2: 0.1, 3: 0.02},\n                2: {0: 0.05, 1: 0.1, 3: 0.03},\n            },\n        },\n        {\n            # Test case 4\n            \"T\": {0},\n            \"A\": {1},\n            \"rates\": {\n                0: {1: 7.5},\n            },\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        transient_states = sorted(list(case[\"T\"]))\n        absorbing_states = sorted(list(case[\"A\"]))\n        all_states = sorted(list(case[\"T\"] | case[\"A\"]))\n        \n        num_states = len(all_states)\n        state_map = {s: i for i, s in enumerate(all_states)}\n        \n        Q = np.zeros((num_states, num_states))\n        \n        # Populate the generator matrix Q\n        for from_state, transitions in case[\"rates\"].items():\n            i = state_map[from_state]\n            row_sum = 0\n            for to_state, rate in transitions.items():\n                j = state_map[to_state]\n                if i != j:\n                    Q[i, j] = rate\n                    row_sum += rate\n            Q[i, i] = -row_sum\n\n        # Extract the transient subgenerator Q_TT\n        transient_indices = [state_map[s] for s in transient_states]\n        Q_TT = Q[np.ix_(transient_indices, transient_indices)]\n\n        # Find the eigenvalues of Q_TT\n        eigenvalues = np.linalg.eigvals(Q_TT)\n        \n        # The principal eigenvalue is the one with the largest real part\n        lambda_principal = np.max(np.real(eigenvalues))\n        \n        # The MFPT is the negative reciprocal of the principal eigenvalue\n        mfpt = -1.0 / lambda_principal\n        \n        results.append(f\"{mfpt:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2654449"}]}