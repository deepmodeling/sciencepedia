{"hands_on_practices": [{"introduction": "A cornerstone of pharmacology is quantifying the relationship between the concentration of a ligand and the biological response it elicits. This practice guides you through deriving the classic dose-response model from the fundamental law of mass action, connecting the abstract concepts of affinity and efficacy to the measurable parameters $EC_{50}$ and $E_{\\max}$. By implementing this model computationally, you will simulate and analyze how different classes of antagonists alter the agonist response, providing a practical foundation for interpreting pharmacological data ([@problem_id:2576249]).", "problem": "You are tasked with constructing, fitting, and interpreting a receptor pharmacology dose–response model from first principles appropriate to ionotropic and metabotropic receptor signaling. Begin from the law of mass action and the definition of receptor occupancy for a single agonist binding event, and the concept of linear stimulus–response coupling at low downstream saturation. Your derivation must define a saturating, monotonic mapping from agonist concentration to effect that is consistent with ionotropic channel opening probability or first-order metabotropic cascade activation, and that contains two identifiable parameters: the maximal effect $E_{\\max}$ (arbitrary response units) and the half-maximally effective concentration $EC_{50}$ (in molar, M). Do not assume any pre-formed “shortcut” formulas; derive the model you intend to implement from these fundamentals.\n\nThen implement a program that uses your derived model as the data-generating process to produce noiseless dose–response datasets and, using nonlinear least squares, estimates $E_{\\max}$ and $EC_{50}$ for each dataset. Finally, quantify the pharmacological interpretation that a noncompetitive antagonist reduces $E_{\\max}$ without changing $EC_{50}$, while a competitive antagonist increases $EC_{50}$ without changing $E_{\\max}$.\n\nBase facts you may assume:\n- Law of mass action for a single binding site.\n- Receptor occupancy proportional to effect when downstream transduction is not saturated.\n- For competitive antagonism at a fixed antagonist concentration, the dose ratio defined in classical pharmacology is greater than $1$, increasing the agonist concentration required for the same occupancy.\n- For noncompetitive antagonism that reduces the maximal signaling capacity, the maximum attainable effect is reduced at all agonist concentrations while the concentration for half-maximal effect is not altered.\n\nData generation and test suite:\n- Use the following agonist concentration grid (in molar, M) for all scenarios: $\\left[1\\times 10^{-10},\\,3\\times 10^{-10},\\,1\\times 10^{-9},\\,3\\times 10^{-9},\\,1\\times 10^{-8},\\,3\\times 10^{-8},\\,1\\times 10^{-7},\\,3\\times 10^{-7},\\,1\\times 10^{-6},\\,3\\times 10^{-6},\\,1\\times 10^{-5},\\,3\\times 10^{-5},\\,1\\times 10^{-4}\\right]$.\n- Generate noiseless effects using your derived two-parameter occupancy-based transduction model with the following true parameters for four scenarios:\n  - Scenario $\\mathrm{S1}$ (ionotropic control): $EC_{50} = 3.0\\times 10^{-8}\\,\\mathrm{M}$, $E_{\\max} = 1.0$ (arbitrary units).\n  - Scenario $\\mathrm{S2}$ (ionotropic with noncompetitive antagonist present at a fixed concentration): $EC_{50} = 3.0\\times 10^{-8}\\,\\mathrm{M}$ (unchanged from $\\mathrm{S1}$), $E_{\\max} = 0.5$ (reduced relative to $\\mathrm{S1}$).\n  - Scenario $\\mathrm{S3}$ (ionotropic with competitive antagonist present at a fixed concentration): $EC_{50} = 1.2\\times 10^{-7}\\,\\mathrm{M}$ (a $4.0$-fold rightward shift relative to $\\mathrm{S1}$), $E_{\\max} = 1.0$ (unchanged relative to $\\mathrm{S1}$).\n  - Scenario $\\mathrm{S4}$ (metabotropic baseline boundary case): $EC_{50} = 1.0\\times 10^{-4}\\,\\mathrm{M}$, $E_{\\max} = 1.0$.\n\nParameter estimation:\n- For each scenario, fit your two-parameter model to the generated dataset by nonlinear least squares to estimate $EC_{50}$ (in $\\mathrm{M}$) and $E_{\\max}$ (arbitrary units).\n- Impose positivity constraints on both $EC_{50}$ and $E_{\\max}$ during fitting.\n\nInterpretation checks:\n- Compute the following booleans using a relative tolerance of $\\tau = 0.05$:\n  - $b_{\\mathrm{nc}\\_EC50\\_\\mathrm{unchanged}}$: $\\left|\\dfrac{\\widehat{EC_{50}}(\\mathrm{S2})}{\\widehat{EC_{50}}(\\mathrm{S1})}-1\\right| \\le \\tau$.\n  - $b_{\\mathrm{nc}\\_Emax\\_\\mathrm{decrease}}$: $\\widehat{E_{\\max}}(\\mathrm{S2}) < \\widehat{E_{\\max}}(\\mathrm{S1})\\times (1-\\tau)$.\n  - $b_{\\mathrm{comp}\\_EC50\\_\\mathrm{increase}}$: $\\widehat{EC_{50}}(\\mathrm{S3}) > \\widehat{EC_{50}}(\\mathrm{S1}) \\times (1+\\tau)$.\n  - $b_{\\mathrm{comp}\\_Emax\\_\\mathrm{unchanged}}$: $\\left|\\dfrac{\\widehat{E_{\\max}}(\\mathrm{S3})}{\\widehat{E_{\\max}}(\\mathrm{S1})}-1\\right| \\le \\tau$.\n\nAngle units are not applicable. Physical units: report all $EC_{50}$ values in $\\mathrm{M}$ and all $E_{\\max}$ values in the same arbitrary response units as used to generate the data. Do not apply any percentage sign; when comparing relative differences, treat them as pure decimal ratios.\n\nRequired final output format:\n- Your program should produce a single line of output containing a comma-separated Python-style list with the following entries in order:\n  - $\\widehat{EC_{50}}(\\mathrm{S1})$, $\\widehat{E_{\\max}}(\\mathrm{S1})$, $\\widehat{EC_{50}}(\\mathrm{S2})$, $\\widehat{E_{\\max}}(\\mathrm{S2})$, $\\widehat{EC_{50}}(\\mathrm{S3})$, $\\widehat{E_{\\max}}(\\mathrm{S3})$, $\\widehat{EC_{50}}(\\mathrm{S4})$, $\\widehat{E_{\\max}}(\\mathrm{S4})$, $b_{\\mathrm{nc}\\_EC50\\_\\mathrm{unchanged}}$, $b_{\\mathrm{nc}\\_Emax\\_\\mathrm{decrease}}$, $b_{\\mathrm{comp}\\_EC50\\_\\mathrm{increase}}$, $b_{\\mathrm{comp}\\_Emax\\_\\mathrm{unchanged}}$.\n- The first eight entries must be floats representing the estimates in the units specified above. The last four entries must be booleans computed as defined above.\n- Example schematic (not actual values): $\\left[ \\widehat{EC_{50}}(\\mathrm{S1}), \\widehat{E_{\\max}}(\\mathrm{S1}), \\ldots, b_{\\mathrm{comp}\\_Emax\\_\\mathrm{unchanged}} \\right]$.", "solution": "The problem posed is valid, scientifically grounded, and well-posed. It requires the derivation of a fundamental pharmacological model from first principles and its application in a computational context. This is a standard and valuable exercise in quantitative bioscience. We shall proceed with the solution.\n\nThe primary task is to derive the dose-response relationship for a single agonist binding to a population of receptors. The derivation must start from the law of mass action and the principle of linear stimulus-response coupling.\n\nLet the agonist be denoted by $L$ (ligand) and the receptor by $R$. The binding reaction is reversible:\n$$\nR + L \\underset{k_{off}}{\\stackrel{k_{on}}{\\rightleftharpoons}} LR\n$$\nwhere $k_{on}$ is the association rate constant and $k_{off}$ is the dissociation rate constant. At equilibrium, the rate of formation of the ligand-receptor complex $LR$ equals the rate of its dissociation:\n$$\nk_{on} [R] [L] = k_{off} [LR]\n$$\nHere, $[X]$ denotes the concentration of species $X$. This equality allows us to define the equilibrium dissociation constant, $K_D$, a measure of the ligand's binding affinity for the receptor:\n$$\nK_D = \\frac{k_{off}}{k_{on}} = \\frac{[R][L]}{[LR]}\n$$\nA lower $K_D$ value corresponds to a higher binding affinity.\n\nThe total concentration of receptors, $[R_{tot}]$, is the sum of free receptors, $[R]$, and ligand-bound receptors, $[LR]$:\n$$\n[R_{tot}] = [R] + [LR]\n$$\nThe fractional occupancy, $p$, is the proportion of receptors bound by the ligand:\n$$\np = \\frac{[LR]}{[R_{tot}]}\n$$\nTo express occupancy as a function of ligand concentration $[L]$, we first express $[R]$ in terms of $[LR]$, $[L]$, and $K_D$:\n$$\n[R] = \\frac{K_D [LR]}{[L]}\n$$\nSubstituting this into the equation for $[R_{tot}]$:\n$$\n[R_{tot}] = \\frac{K_D [LR]}{[L]} + [LR] = [LR] \\left( \\frac{K_D}{[L]} + 1 \\right) = [LR] \\left( \\frac{K_D + [L]}{[L]} \\right)\n$$\nWe can rearrange this to express $[LR]$ in terms of $[R_{tot}]$ and $[L]$:\n$$\n[LR] = [R_{tot}] \\frac{[L]}{K_D + [L]}\n$$\nSubstituting this expression into the definition of fractional occupancy $p$ yields the Hill-Langmuir equation:\n$$\np = \\frac{[LR]}{[R_{tot}]} = \\frac{[R_{tot}] \\frac{[L]}{K_D + [L]}}{[R_{tot}]} = \\frac{[L]}{K_D + [L]}\n$$\nThis equation describes the hyperbolic dependence of receptor occupancy on ligand concentration.\n\nThe problem assumes a linear stimulus-response coupling, meaning the observed biological effect, $E$, is directly proportional to the concentration of the activated receptor complex, $[LR]$:\n$$\nE = c \\cdot [LR]\n$$\nwhere $c$ is a transduction coefficient. The maximal effect, $E_{\\max}$, is attained when all receptors are occupied, i.e., at saturating ligand concentration where $[LR] = [R_{tot}]$. Thus:\n$$\nE_{\\max} = c \\cdot [R_{tot}]\n$$\nThis allows us to write $c = E_{\\max} / [R_{tot}]$. Substituting this and the expression for $[LR]$ into the effect equation:\n$$\nE = \\left( \\frac{E_{\\max}}{[R_{tot}]} \\right) \\left( [R_{tot}] \\frac{[L]}{K_D + [L]} \\right) = E_{\\max} \\frac{[L]}{K_D + [L]}\n$$\nThe model is requested in terms of the half-maximally effective concentration, $EC_{50}$, which is the concentration of ligand that produces an effect equal to $E_{\\max}/2$. Setting $E = E_{\\max}/2$ and denoting the corresponding concentration as $[L]_{50}$:\n$$\n\\frac{E_{\\max}}{2} = E_{\\max} \\frac{[L]_{50}}{K_D + [L]_{50}}\n$$\nAssuming $E_{\\max} \\neq 0$, we can simplify:\n$$\n\\frac{1}{2} = \\frac{[L]_{50}}{K_D + [L]_{50}} \\implies K_D + [L]_{50} = 2[L]_{50} \\implies K_D = [L]_{50}\n$$\nTherefore, in this simple system, $EC_{50} = K_D$. We can now write the final form of the two-parameter dose-response model. Letting $x$ represent the ligand concentration, the effect $E(x)$ is:\n$$\nE(x) = E_{\\max} \\frac{x}{EC_{50} + x}\n$$\nThis derived model is a saturating, monotonic function as required and will be used for both data generation and fitting.\n\nThe implementation will follow a clear procedure. First, a Python function for the derived model will be defined. For each of the four specified scenarios, noiseless data will be generated using this function and the provided true parameters. Then, `scipy.optimize.curve_fit` will be employed to perform a nonlinear least squares fit of the model to the generated data, yielding estimates for $E_{\\max}$ and $EC_{50}$. Positivity constraints for both parameters will be enforced using the `bounds` argument. Finally, the estimated parameters from scenarios S1, S2, and S3 will be used to compute the required boolean checks to validate the pharmacological principles of noncompetitive and competitive antagonism, using the specified tolerance $\\tau = 0.05$. The complete set of results will be formatted into a single line of output as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Derives, fits, and interprets a pharmacological dose-response model from first principles.\n    \"\"\"\n    # Define the derived two-parameter dose-response model function.\n    # The order of parameters (Emax, EC50) is important for curve_fit.\n    def model(x, Emax, EC50):\n        \"\"\"\n        Standard two-parameter Hill-Langmuir model.\n        E(x) = Emax * x / (EC50 + x)\n        \"\"\"\n        # Using np.divide for safe division, x is treated as array.\n        return Emax * np.divide(x, EC50 + x)\n\n    # Agonist concentration grid (in molar, M)\n    x_concentrations = np.array([\n        1e-10, 3e-10, 1e-9, 3e-9, 1e-8, 3e-8, 1e-7, 3e-7,\n        1e-6, 3e-6, 1e-5, 3e-5, 1e-4\n    ])\n\n    # True parameters for the four scenarios\n    # Format: (EC50 in M, Emax in arbitrary units)\n    scenarios = {\n        'S1': {'EC50': 3.0e-8, 'Emax': 1.0},\n        'S2': {'EC50': 3.0e-8, 'Emax': 0.5},\n        'S3': {'EC50': 1.2e-7, 'Emax': 1.0},\n        'S4': {'EC50': 1.0e-4, 'Emax': 1.0}\n    }\n\n    estimated_params = {}\n    \n    # Process each scenario: generate data and fit the model\n    for name, params in scenarios.items():\n        true_ec50 = params['EC50']\n        true_emax = params['Emax']\n\n        # Generate noiseless effect data\n        y_effects = model(x_concentrations, true_emax, true_ec50)\n\n        # Set initial guesses for the parameters (Emax, EC50)\n        p0 = [np.max(y_effects) if np.max(y_effects) > 0 else 1.0, np.median(x_concentrations)]\n\n        # Set positivity bounds for Emax and EC50\n        # The bounds are ([lower_Emax, lower_EC50], [upper_Emax, upper_EC50])\n        bounds = ([0, 0], [np.inf, np.inf])\n\n        # Perform nonlinear least squares fitting\n        # popt contains the optimal parameters: [est_Emax, est_EC50]\n        popt, _ = curve_fit(model, x_concentrations, y_effects, p0=p0, bounds=bounds)\n        \n        est_emax, est_ec50 = popt\n\n        # Store the estimated parameters\n        estimated_params[name] = {'EC50': est_ec50, 'Emax': est_emax}\n\n    # Retrieve estimated parameters for interpretation checks\n    est_ec50_s1 = estimated_params['S1']['EC50']\n    est_emax_s1 = estimated_params['S1']['Emax']\n    est_ec50_s2 = estimated_params['S2']['EC50']\n    est_emax_s2 = estimated_params['S2']['Emax']\n    est_ec50_s3 = estimated_params['S3']['EC50']\n    est_emax_s3 = estimated_params['S3']['Emax']\n\n    # Define the tolerance for boolean checks\n    tau = 0.05\n\n    # Compute the boolean interpretation checks\n    # Noncompetitive antagonism checks (S2 vs S1)\n    b_nc_EC50_unchanged = abs(est_ec50_s2 / est_ec50_s1 - 1) = tau\n    b_nc_Emax_decrease = est_emax_s2  est_emax_s1 * (1 - tau)\n\n    # Competitive antagonism checks (S3 vs S1)\n    b_comp_EC50_increase = est_ec50_s3 > est_ec50_s1 * (1 + tau)\n    b_comp_Emax_unchanged = abs(est_emax_s3 / est_emax_s1 - 1) = tau\n\n    # Collect all results in the specified order: EC50, Emax for S1, S2, S3, S4, then booleans\n    final_results = [\n        estimated_params['S1']['EC50'], estimated_params['S1']['Emax'],\n        estimated_params['S2']['EC50'], estimated_params['S2']['Emax'],\n        estimated_params['S3']['EC50'], estimated_params['S3']['Emax'],\n        estimated_params['S4']['EC50'], estimated_params['S4']['Emax'],\n        b_nc_EC50_unchanged,\n        b_nc_Emax_decrease,\n        b_comp_EC50_increase,\n        b_comp_Emax_unchanged\n    ]\n    \n    # Format the final output string as a Python-style list, as required.\n    # The default string representation of floats and booleans is used.\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n\n```", "id": "2576249"}, {"introduction": "The immediate function of an activated ionotropic receptor is to create a pathway for ions to cross the cell membrane. The magnitude and direction of this ion flow are not fixed; they are governed by the electrochemical driving force. This exercise requires you to derive the current-voltage relationship for a single channel from first principles and apply the Goldman-Hodgkin-Katz equation to determine the reversal potential. Through this, you will quantitatively explore how shifts in physiological ion gradients, a common occurrence in active neural tissue, directly modulate the efficacy of ionotropic receptor signaling ([@problem_id:2576223]).", "problem": "A ligand-gated ionotropic receptor in a mammalian neuron is permeable to monovalent cations sodium and potassium with equal unit permeability. When bound by agonist, the channel switches to an open state with a constant single-channel conductance. Consider the following physiological conditions:\n\n- Absolute temperature: $T = 310\\,\\mathrm{K}$.\n- Universal gas constant: $R = 8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$.\n- Faraday constant: $F = 96485\\,\\mathrm{C\\,mol^{-1}}$.\n- Intracellular concentrations: $[\\mathrm{Na}^{+}]_{\\mathrm{i}} = 12\\,\\mathrm{mM}$ and $[\\mathrm{K}^{+}]_{\\mathrm{i}} = 140\\,\\mathrm{mM}$.\n- Baseline extracellular concentrations: $[\\mathrm{Na}^{+}]_{\\mathrm{o}} = 145\\,\\mathrm{mM}$ and $[\\mathrm{K}^{+}]_{\\mathrm{o}} = 5\\,\\mathrm{mM}$.\n- Perturbed extracellular potassium: $[\\mathrm{K}^{+}]_{\\mathrm{o}} = 25\\,\\mathrm{mM}$ (all other quantities unchanged).\n- Relative permeabilities in the open state: $P_{\\mathrm{Na}}:P_{\\mathrm{K}} = 1:1$.\n- Open-state single-channel conductance: $g = 20\\,\\mathrm{pS}$.\n- Membrane potential during receptor activation: $V_{m} = -60\\,\\mathrm{mV}$.\n\nUsing only foundational principles, proceed in two steps:\n\n1) Starting from the definition of an ohmic conductor and the definition of a reversal potential as the membrane potential at which the net current through the open channel is zero, derive an explicit linear relation between the open-state single-channel current $i$, the conductance $g$, the membrane potential $V_{m}$, and the reversal potential $E_{\\mathrm{rev}}$.\n\n2) Starting from the constant-field (Goldman–Hodgkin–Katz (GHK)) framework for independent ion movement in a spatially uniform electric field and enforcing the zero-current condition for a mixed $\\mathrm{Na}^{+}/\\mathrm{K}^{+}$-permeable channel, derive the symbolic expression for the reversal potential $E_{\\mathrm{rev}}$ in terms of $R$, $T$, $F$, $P_{\\mathrm{Na}}$, $P_{\\mathrm{K}}$, and the intra- and extracellular ion activities (assume activities equal concentrations). Then, evaluate $E_{\\mathrm{rev}}$ numerically under the baseline and perturbed extracellular potassium conditions given above.\n\nDefine the ionotropic receptor “efficacy” at fixed agonist occupancy as the absolute value of the open-state single-channel current $|i|$ at the specified $V_{m}$. Compute the efficacy ratio\n$$\n\\mathcal{R} \\equiv \\frac{|i|_{\\,[\\mathrm{K}^{+}]_{\\mathrm{o}}=25\\,\\mathrm{mM}}}{|i|_{\\,[\\mathrm{K}^{+}]_{\\mathrm{o}}=5\\,\\mathrm{mM}}}.\n$$\nExpress the final efficacy ratio as a dimensionless number and round your answer to four significant figures.", "solution": "The problem statement is scientifically grounded, well-posed, objective, and contains sufficient information for a unique solution. The conditions are physiologically plausible. I will proceed with the solution as requested.\n\nThe problem requires a two-step derivation and calculation.\n\nStep 1: Derivation of the linear current-voltage relationship.\nAn ohmic conductor is characterized by a linear relationship between current $I$ and voltage $V$, as described by Ohm's law: $I = G V$, where $G$ is the conductance. For an ion channel embedded in a cell membrane, the flow of ions, which constitutes the current $i$, is driven by the electrochemical potential difference across the membrane. This driving force is the difference between the membrane potential, $V_{m}$, and the reversal potential, $E_{\\mathrm{rev}}$. The reversal potential is the specific membrane potential at which there is no net flow of ions through the channel, and thus the current is zero.\n\nThe driving force is therefore $(V_{m} - E_{\\mathrm{rev}})$. Applying the principle of Ohm's law to a single channel with conductance $g$, the single-channel current $i$ is directly proportional to this driving force:\n$$\ni = g (V_{m} - E_{\\mathrm{rev}})\n$$\nThis is the explicit linear relation between the single-channel current $i$, the conductance $g$, the membrane potential $V_{m}$, and the reversal potential $E_{\\mathrm{rev}}$. It correctly predicts that if $V_{m} = E_{\\mathrm{rev}}$, the current $i = g (E_{\\mathrm{rev}} - E_{\\mathrm{rev}}) = 0$, consistent with the provided definition of a reversal potential.\n\nStep 2: Derivation of the reversal potential and calculation of the efficacy ratio.\nThe Goldman–Hodgkin–Katz (GHK) framework models ion flux under a constant electric field across the membrane. The reversal potential $E_{\\mathrm{rev}}$ for a channel permeable to multiple ion species is the membrane potential at which the total net current across the membrane is zero. For a channel permeable to monovalent cations $\\mathrm{Na}^{+}$ and $\\mathrm{K}^{+}$, the total current $I_{\\mathrm{total}}$ is the sum of the individual ionic currents, $I_{\\mathrm{Na}}$ and $I_{\\mathrm{K}}$. The zero-current condition is $I_{\\mathrm{total}} = I_{\\mathrm{Na}} + I_{\\mathrm{K}} = 0$.\n\nUnder the constant-field assumption, the GHK current equation for an ion species $j$ with positive charge $z_j=+1$ is given by:\n$$\nI_j = P_j \\frac{F^2 V_m}{RT} \\frac{[j]_{\\mathrm{i}} - [j]_{\\mathrm{o}} \\exp(\\frac{F V_m}{RT})}{1 - \\exp(\\frac{F V_m}{RT})}\n$$\nwhere $P_j$ is the permeability, $R$ is the universal gas constant, $T$ is the absolute temperature, and $F$ is the Faraday constant.\n\nAt the reversal potential, $V_m = E_{\\mathrm{rev}}$, the total current is zero:\n$$\nP_{\\mathrm{Na}} \\frac{F^2 E_{\\mathrm{rev}}}{RT} \\frac{[\\mathrm{Na}^{+}]_{\\mathrm{i}} - [\\mathrm{Na}^{+}]_{\\mathrm{o}} \\exp(\\frac{F E_{\\mathrm{rev}}}{RT})}{1 - \\exp(\\frac{F E_{\\mathrm{rev}}}{RT})} + P_{\\mathrm{K}} \\frac{F^2 E_{\\mathrm{rev}}}{RT} \\frac{[\\mathrm{K}^{+}]_{\\mathrm{i}} - [\\mathrm{K}^{+}]_{\\mathrm{o}} \\exp(\\frac{F E_{\\mathrm{rev}}}{RT})}{1 - \\exp(\\frac{F E_{\\mathrm{rev}}}{RT})} = 0\n$$\nAssuming $E_{\\mathrm{rev}} \\ne 0$, we can cancel the common prefactor $\\frac{F^2 E_{\\mathrm{rev}}}{RT} \\frac{1}{1 - \\exp(\\frac{F E_{\\mathrm{rev}}}{RT})}$. This leaves:\n$$\nP_{\\mathrm{Na}} \\left( [\\mathrm{Na}^{+}]_{\\mathrm{i}} - [\\mathrm{Na}^{+}]_{\\mathrm{o}} \\exp\\left(\\frac{F E_{\\mathrm{rev}}}{RT}\\right) \\right) + P_{\\mathrm{K}} \\left( [\\mathrm{K}^{+}]_{\\mathrm{i}} - [\\mathrm{K}^{+}]_{\\mathrm{o}} \\exp\\left(\\frac{F E_{\\mathrm{rev}}}{RT}\\right) \\right) = 0\n$$\nRearranging the terms to solve for $E_{\\mathrm{rev}}$:\n$$\nP_{\\mathrm{Na}}[\\mathrm{Na}^{+}]_{\\mathrm{i}} + P_{\\mathrm{K}}[\\mathrm{K}^{+}]_{\\mathrm{i}} = \\left( P_{\\mathrm{Na}}[\\mathrm{Na}^{+}]_{\\mathrm{o}} + P_{\\mathrm{K}}[\\mathrm{K}^{+}]_{\\mathrm{o}} \\right) \\exp\\left(\\frac{F E_{\\mathrm{rev}}}{RT}\\right)\n$$\n$$\n\\exp\\left(\\frac{F E_{\\mathrm{rev}}}{RT}\\right) = \\frac{P_{\\mathrm{Na}}[\\mathrm{Na}^{+}]_{\\mathrm{i}} + P_{\\mathrm{K}}[\\mathrm{K}^{+}]_{\\mathrm{i}}}{P_{\\mathrm{Na}}[\\mathrm{Na}^{+}]_{\\mathrm{o}} + P_{\\mathrm{K}}[\\mathrm{K}^{+}]_{\\mathrm{o}}}\n$$\nThe GHK voltage equation is typically expressed with extracellular concentrations in the numerator. By inverting the argument of the logarithm, we get the standard form:\n$$\nE_{\\mathrm{rev}} = \\frac{RT}{F} \\ln \\left( \\frac{P_{\\mathrm{Na}}[\\mathrm{Na}^{+}]_{\\mathrm{o}} + P_{\\mathrm{K}}[\\mathrm{K}^{+}]_{\\mathrm{o}}}{P_{\\mathrm{Na}}[\\mathrm{Na}^{+}]_{\\mathrm{i}} + P_{\\mathrm{K}}[\\mathrm{K}^{+}]_{\\mathrm{i}}} \\right)\n$$\nGiven the relative permeabilities $P_{\\mathrm{Na}}:P_{\\mathrm{K}} = 1:1$, we can set $P_{\\mathrm{Na}} = P_{\\mathrm{K}} = P$. The permeability constant $P$ then cancels from the expression:\n$$\nE_{\\mathrm{rev}} = \\frac{RT}{F} \\ln \\left( \\frac{[\\mathrm{Na}^{+}]_{\\mathrm{o}} + [\\mathrm{K}^{+}]_{\\mathrm{o}}}{[\\mathrm{Na}^{+}]_{\\mathrm{i}} + [\\mathrm{K}^{+}]_{\\mathrm{i}}} \\right)\n$$\nWe first evaluate the thermal voltage term $\\frac{RT}{F}$:\n$$\n\\frac{RT}{F} = \\frac{(8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}) (310\\,\\mathrm{K})}{96485\\,\\mathrm{C\\,mol^{-1}}} \\approx 0.026707\\,\\mathrm{V} = 26.707\\,\\mathrm{mV}\n$$\nNow we compute $E_{\\mathrm{rev}}$ for the two specified conditions.\n\nCondition 1 (Baseline): $[\\mathrm{K}^{+}]_{\\mathrm{o}} = 5\\,\\mathrm{mM}$.\nIntracellular concentrations are $[\\mathrm{Na}^{+}]_{\\mathrm{i}} = 12\\,\\mathrm{mM}$ and $[\\mathrm{K}^{+}]_{\\mathrm{i}} = 140\\,\\mathrm{mM}$. Extracellular concentrations are $[\\mathrm{Na}^{+}]_{\\mathrm{o}} = 145\\,\\mathrm{mM}$ and $[\\mathrm{K}^{+}]_{\\mathrm{o}} = 5\\,\\mathrm{mM}$.\n$$\nE_{\\mathrm{rev},1} = \\left(\\frac{RT}{F}\\right) \\ln \\left( \\frac{145 + 5}{12 + 140} \\right) = \\left(\\frac{RT}{F}\\right) \\ln \\left( \\frac{150}{152} \\right) \\approx (26.707\\,\\mathrm{mV}) \\times (-0.013245) \\approx -0.3538\\,\\mathrm{mV}\n$$\nCondition 2 (Perturbed): $[\\mathrm{K}^{+}]_{\\mathrm{o}} = 25\\,\\mathrm{mM}$.\nExtracellular potassium is elevated while other concentrations remain unchanged.\n$$\nE_{\\mathrm{rev},2} = \\left(\\frac{RT}{F}\\right) \\ln \\left( \\frac{145 + 25}{12 + 140} \\right) = \\left(\\frac{RT}{F}\\right) \\ln \\left( \\frac{170}{152} \\right) \\approx (26.707\\,\\mathrm{mV}) \\times (0.11195) \\approx 2.990\\,\\mathrm{mV}\n$$\nThe efficacy is defined as the absolute value of the single-channel current, $|i|$, at $V_{m} = -60\\,\\mathrm{mV}$. The single-channel conductance is $g = 20\\,\\mathrm{pS}$.\nUsing the linear I-V relation derived in Step 1, $i = g(V_{m} - E_{\\mathrm{rev}})$, the efficacy is $|i| = |g(V_{m} - E_{\\mathrm{rev}})| = g|V_{m} - E_{\\mathrm{rev}}|$.\n\nThe efficacy ratio $\\mathcal{R}$ is defined as:\n$$\n\\mathcal{R} \\equiv \\frac{|i|_{\\,[\\mathrm{K}^{+}]_{\\mathrm{o}}=25\\,\\mathrm{mM}}}{|i|_{\\,[\\mathrm{K}^{+}]_{\\mathrm{o}}=5\\,\\mathrm{mM}}} = \\frac{|i_{2}|}{|i_{1}|}\n$$\nSubstituting the expression for $|i|$:\n$$\n\\mathcal{R} = \\frac{g|V_{m} - E_{\\mathrm{rev},2}|}{g|V_{m} - E_{\\mathrm{rev},1}|} = \\frac{|V_{m} - E_{\\mathrm{rev},2}|}{|V_{m} - E_{\\mathrm{rev},1}|}\n$$\nThe conductance $g$ cancels. We substitute the values for $V_m$, $E_{\\mathrm{rev},1}$, and $E_{\\mathrm{rev},2}$ (all in mV):\n$$\n\\mathcal{R} = \\frac{|-60 - 2.990|}{|-60 - (-0.3538)|} = \\frac{|-62.990|}{|-59.6462|} = \\frac{62.990}{59.6462} \\approx 1.05606\n$$\nRounding to four significant figures, the final efficacy ratio is $1.056$.", "answer": "$$\\boxed{1.056}$$", "id": "2576223"}, {"introduction": "In the nervous system, fast synaptic transmission via ionotropic receptors is constantly being shaped by slower, modulatory metabotropic signals. This advanced computational practice challenges you to integrate these two signaling modalities into a unified neuronal model. You will simulate how the activation of a metabotropic receptor, by downregulating a key potassium current, amplifies a neuron's response to an ionotropic excitatory input. This exercise provides a powerful demonstration of neuromodulation, revealing how cellular excitability and spike probability are dynamically controlled by the crosstalk between different receptor systems ([@problem_id:2576253]).", "problem": "You are to model crosstalk between ionotropic and metabotropic signaling in a single-compartment neuron using first principles of membrane biophysics. The neuron receives an excitatory postsynaptic conductance transient mediated by an ionotropic receptor and expresses a voltage-gated M-type potassium current that is downregulated by muscarinic M1 receptor activation. Your goal is to derive an algorithm from the membrane charge conservation law and gating kinetics and then implement it to estimate spike probabilities under different levels of muscarinic modulation of the M-current. The final output must be a single line containing a list of the spike probabilities for the provided test cases, each rounded to three decimals.\n\nStart from the following fundamental biophysical definitions and laws:\n- The membrane equation (charge conservation): $$C \\frac{dV}{dt} = -I_{\\text{L}} - I_{\\text{M}} + I_{\\text{syn}} + I_{\\text{noise}},$$ where $C$ is the membrane capacitance, $V$ is the membrane potential, $I_{\\text{L}}$ is the leak current, $I_{\\text{M}}$ is the M-type potassium current, $I_{\\text{syn}}$ is the synaptic current mediated by ionotropic receptors, and $I_{\\text{noise}}$ is stochastic background current.\n- Leak current: $$I_{\\text{L}} = g_{\\text{L}} \\left(V - E_{\\text{L}}\\right),$$ with leak conductance $g_{\\text{L}}$ and leak reversal potential $E_{\\text{L}}$.\n- M-current (KCNQ/Kv7-mediated): $$I_{\\text{M}} = g_{\\text{M,eff}}\\, w \\left(V - E_{\\text{K}}\\right),$$ where $g_{\\text{M,eff}} = \\alpha g_{\\text{M,base}}$ is the effective M-conductance after muscarinic M1 receptor (M1 muscarinic acetylcholine receptor) activation scales the baseline M-conductance $g_{\\text{M,base}}$ by a dimensionless factor $\\alpha \\in [0,1]$, $w$ is the M-gate activation variable, and $E_{\\text{K}}$ is the potassium reversal potential. The M-gate obeys first-order kinetics: $$\\frac{dw}{dt} = \\frac{w_{\\infty}(V) - w}{\\tau_w}, \\quad w_{\\infty}(V) = \\frac{1}{1 + \\exp\\left(-\\frac{V - V_{1/2}}{k_w}\\right)}.$$\n- Ionotropic synaptic current (consider an AMPA-like receptor): $$I_{\\text{syn}} = g_{\\text{syn,peak}}\\, s(t)\\, \\left(E_{\\text{A}} - V\\right),$$ where $g_{\\text{syn,peak}}$ is the peak synaptic conductance and $E_{\\text{A}}$ is the synaptic reversal potential. The conductance activation $s(t)$ is a difference-of-exponentials normalized to unit peak: $$s(t) = \\begin{cases} 0,  t  t_0, \\\\ \\dfrac{e^{-\\frac{t - t_0}{\\tau_d}} - e^{-\\frac{t - t_0}{\\tau_r}}}{e^{-\\frac{t_p}{\\tau_d}} - e^{-\\frac{t_p}{\\tau_r}}},  t \\ge t_0, \\end{cases}$$ with rise time constant $\\tau_r$, decay time constant $\\tau_d$, onset time $t_0$, and the peak time $$t_p = \\frac{\\tau_r \\tau_d}{\\tau_d - \\tau_r}\\,\\ln\\!\\left(\\frac{\\tau_d}{\\tau_r}\\right).$$\n- The stochastic background current is modeled as Gaussian white noise: $$I_{\\text{noise}}(t) = \\sigma_I \\sqrt{\\Delta t}\\, \\xi(t),$$ where $\\sigma_I$ is a noise intensity in units of current per square root time, $\\Delta t$ is the simulation time step, and $\\xi(t)$ are independent standard normal random variables.\n\nImplement a forward Euler discretization for both $V$ and $w$ with time step $\\Delta t$ over a total simulation window $T$:\n- $$V_{n+1} = V_n + \\frac{\\Delta t}{C}\\left(-g_{\\text{L}}\\left(V_n - E_{\\text{L}}\\right) - g_{\\text{M,eff}}\\, w_n \\left(V_n - E_{\\text{K}}\\right) + g_{\\text{syn,peak}}\\, s(t_n)\\, \\left(E_{\\text{A}} - V_n\\right) + I_{\\text{noise},n}\\right),$$\n- $$w_{n+1} = w_n + \\Delta t \\frac{w_{\\infty}(V_n) - w_n}{\\tau_w}.$$\n\nInitial conditions: $$V(0) = E_{\\text{L}}, \\quad w(0) = w_{\\infty}(E_{\\text{L}}).$$\n\nDefine a spike as the first upward threshold crossing where $V$ crosses from below to at or above a fixed threshold $V_{\\text{th}}$ at any time during the window. For each parameter set, run $N_{\\text{trials}}$ statistically independent trials with different noise realizations (but identical deterministic parameters) and estimate the spike probability as the fraction of trials with at least one spike. Use fixed random seeds per test case to ensure deterministic output.\n\nUse the following fixed parameter values and units throughout:\n- Capacitance $C = 0.2\\,\\text{nF}$,\n- Leak conductance $g_{\\text{L}} = 5\\,\\text{nS}$,\n- Baseline M-conductance $g_{\\text{M,base}} = 60\\,\\text{nS}$,\n- Leak reversal $E_{\\text{L}} = -65\\,\\text{mV}$,\n- Potassium reversal $E_{\\text{K}} = -90\\,\\text{mV}$,\n- AMPA reversal $E_{\\text{A}} = 0\\,\\text{mV}$,\n- M-gate parameters $V_{1/2} = -35\\,\\text{mV}$, $k_w = 10\\,\\text{mV}$, $\\tau_w = 50\\,\\text{ms}$,\n- Synaptic kinetics: $t_0 = 20\\,\\text{ms}$, $\\tau_r = 0.5\\,\\text{ms}$, $\\tau_d = 5\\,\\text{ms}$,\n- Noise intensity $\\sigma_I = 0.06\\,\\text{nA}\\cdot \\text{ms}^{-1/2}$,\n- Time step $\\Delta t = 0.025\\,\\text{ms}$, total time $T = 80\\,\\text{ms}$,\n- Spike threshold $V_{\\text{th}} = -52\\,\\text{mV}$,\n- Trials per test case $N_{\\text{trials}} = 400$.\n\nTest suite (five parameter sets), each specified by the ordered pair $(\\alpha, g_{\\text{syn,peak}})$ with $g_{\\text{syn,peak}}$ in nanosiemens:\n1. $(\\alpha = 1.0,\\, g_{\\text{syn,peak}} = 2.0)$\n2. $(\\alpha = 0.3,\\, g_{\\text{syn,peak}} = 2.0)$\n3. $(\\alpha = 1.0,\\, g_{\\text{syn,peak}} = 5.0)$\n4. $(\\alpha = 0.1,\\, g_{\\text{syn,peak}} = 0.5)$\n5. $(\\alpha = 0.1,\\, g_{\\text{syn,peak}} = 0.0)$\n\nFor each test case, set the random number generator seed deterministically to ensure reproducibility by using seeds $1$, $2$, $3$, $4$, and $5$ in the same order as above.\n\nYour program must:\n- Simulate the stochastic dynamics for each test case,\n- Compute the fraction of trials that produce at least one spike in the interval $[0, T]$,\n- Report the spike probabilities as decimals (not percentages), each rounded to three decimals.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, \"[$p_1$,$p_2$,$p_3$,$p_4$,$p_5$]\". Each $p_i$ must be a decimal rounded to three digits after the decimal point in standard rounding, with no additional text or spaces.", "solution": "The problem statement has been rigorously validated and is determined to be valid. It is a well-posed problem in computational biophysics, grounded in the established theoretical framework of neuronal dynamics. It presents a clear, complete, and scientifically sound set of an ordinary differential equation coupled with a stochastic differential equation to model neuronal behavior. All parameters, initial conditions, and numerical methods are specified without ambiguity.\n\nThe objective is to compute the probability of a neuron generating an action potential (a \"spike\") in response to a synaptic input, while being under the influence of a neuromodulatory current. This is a classic question of neuronal excitability. The solution requires the numerical integration of the system's governing equations.\n\nThe state of the neuron is described by two variables: the membrane potential $V(t)$ and the activation variable for the M-type potassium current, $w(t)$. Their dynamics are governed by the following system of differential equations derived from the principle of charge conservation across the cell membrane and first-order gating kinetics:\n$$C \\frac{dV}{dt} = -I_{\\text{L}} - I_{\\text{M}} + I_{\\text{syn}} + I_{\\text{noise}}$$\n$$\\frac{dw}{dt} = \\frac{w_{\\infty}(V) - w}{\\tau_w}$$\nSubstituting the expressions for the individual currents as provided, the full system is:\n$$C \\frac{dV}{dt} = -g_{\\text{L}}(V - E_{\\text{L}}) - \\alpha g_{\\text{M,base}} w (V - E_{\\text{K}}) + g_{\\text{syn,peak}} s(t) (E_{\\text{A}} - V) + I_{\\text{noise}}(t)$$\n$$ \\frac{dw}{dt} = \\frac{1}{\\tau_w} \\left( \\frac{1}{1 + \\exp\\left(-\\frac{V - V_{1/2}}{k_w}\\right)} - w \\right) $$\nHere, the metabotropic modulation is captured by the parameter $\\alpha$, which scales the maximum conductance of the M-current, $g_{\\text{M,base}}$. A smaller $\\alpha$ corresponds to stronger muscarinic inhibition of the M-current, which is an outward, hyperpolarizing current. Thus, smaller $\\alpha$ values are expected to increase neuronal excitability. The ionotropic input is represented by the synaptic current $I_{\\text{syn}}$.\n\nTo solve this system numerically, we discretize time with a step $\\Delta t$. The problem specifies the forward Euler method. For a time step $n$, where $t_n = n \\Delta t$, the state variables $(V_{n+1}, w_{n+1})$ are calculated from their values at the previous step, $(V_n, w_n)$:\n$$V_{n+1} = V_n + \\frac{\\Delta t}{C} \\left( -g_{\\text{L}}(V_n - E_{\\text{L}}) - \\alpha g_{\\text{M,base}} w_n (V_n - E_{\\text{K}}) + g_{\\text{syn,peak}} s(t_n) (E_{\\text{A}} - V_n) + I_{\\text{noise},n} \\right)$$\n$$w_{n+1} = w_n + \\frac{\\Delta t}{\\tau_w} \\left( w_{\\infty}(V_n) - w_n \\right)$$\nThe stochastic noise current at each step, $I_{\\text{noise},n}$, is given by $I_{\\text{noise},n} = \\sigma_I \\sqrt{\\Delta t} \\, \\xi_n$, where $\\xi_n$ is a random variable drawn from a standard normal distribution, $\\mathcal{N}(0,1)$. This term introduces randomness into the voltage dynamics.\n\nThe algorithmic procedure to estimate the spike probability for each test case is as follows:\n1.  **Initialization**: For each test case defined by $(\\alpha, g_{\\text{syn,peak}})$, the corresponding random number generator seed is set to ensure reproducibility. The simulation time vector and the synaptic conductance profile $s(t)$ are pre-computed for efficiency.\n2.  **Monte Carlo Simulation**: A set of $N_{\\text{trials}} = 400$ independent simulations is conducted. For computational efficiency, these trials are simulated in parallel using vectorization. State vectors $\\mathbf{V}$ and $\\mathbf{w}$, each of size $N_{\\text{trials}}$, are initialized with the resting conditions: $V(0) = E_{\\text{L}}$ and $w(0) = w_{\\infty}(E_{\\text{L}})$.\n3.  **Time-Stepping Loop**: The simulation proceeds by iterating through discrete time steps from $t=0$ to $t=T$. At each step $n$:\n    a. The state vectors $\\mathbf{V}$ and $\\mathbf{w}$ are updated according to the discretized Euler equations.\n    b. A vector of $N_{\\text{trials}}$ independent Gaussian random numbers is generated for the noise term.\n    c. A spike event is detected for any trial where the voltage $V$ crosses the threshold $V_{\\text{th}}$ in an upward direction (i.e., $V_n \\ge V_{\\text{th}}$ and $V_{n-1}  V_{\\text{th}}$). A boolean array tracks which trials have spiked.\n4.  **Probability Estimation**: After completing the time loop for all trials, the spike probability is calculated as the total number of trials that exhibited at least one spike, divided by the total number of trials, $N_{\\text{trials}}$.\n5.  **Output Formatting**: The computed probability is rounded to three decimal places. This process is repeated for all five test cases, and the results are collected into the specified output format.\n\nThis structured numerical experiment allows for a quantitative assessment of how metabotropic modulation of the M-current ($\\alpha$) interacts with ionotropic synaptic input ($g_{\\text{syn,peak}}$) to control the likelihood of neuronal firing. The implementation follows these principles precisely.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates a single-compartment neuron model to estimate spike probabilities\n    under varying neuromodulatory and synaptic conditions.\n    \"\"\"\n    \n    # Fixed biophysical and simulation parameters\n    C = 0.2          # Membrane capacitance (nF)\n    g_L = 5.0        # Leak conductance (nS)\n    g_M_base = 60.0  # Baseline M-conductance (nS)\n    E_L = -65.0      # Leak reversal potential (mV)\n    E_K = -90.0      # Potassium reversal potential (mV)\n    E_A = 0.0        # Synaptic reversal potential (mV)\n    V_12 = -35.0     # M-gate half-activation voltage (mV)\n    k_w = 10.0       # M-gate slope factor (mV)\n    tau_w = 50.0     # M-gate time constant (ms)\n    t0 = 20.0        # Synaptic input onset time (ms)\n    tau_r = 0.5      # Synaptic rise time constant (ms)\n    tau_d = 5.0      # Synaptic decay time constant (ms)\n    sigma_I = 0.06   # Noise intensity (nA * ms^(-1/2))\n    dt = 0.025       # Simulation time step (ms)\n    T = 80.0         # Total simulation time (ms)\n    V_th = -52.0     # Spike threshold (mV)\n    N_trials = 400   # Number of trials per test case\n\n    # Define the test suite: (alpha, g_syn_peak in nS)\n    test_cases = [\n        (1.0, 2.0),\n        (0.3, 2.0),\n        (1.0, 5.0),\n        (0.1, 0.5),\n        (0.1, 0.0),\n    ]\n    seeds = [1, 2, 3, 4, 5]\n    \n    results = []\n\n    # Pre-calculate time vector and synaptic conductance waveform s(t)\n    time_vec = np.arange(0, T, dt)\n    \n    # Calculate peak time and normalization factor for synaptic conductance\n    tp = (tau_r * tau_d) / (tau_d - tau_r) * np.log(tau_d / tau_r)\n    norm_factor = np.exp(-tp / tau_d) - np.exp(-tp / tau_r)\n    \n    s_t = np.zeros_like(time_vec)\n    mask = time_vec >= t0\n    t_shifted = time_vec[mask] - t0\n    s_t[mask] = (np.exp(-t_shifted / tau_d) - np.exp(-t_shifted / tau_r)) / norm_factor\n\n    # M-gate activation function\n    def w_infinity(V):\n        return 1.0 / (1.0 + np.exp(-(V - V_12) / k_w))\n\n    # Loop through each test case\n    for i, (alpha, g_syn_peak) in enumerate(test_cases):\n        seed = seeds[i]\n        np.random.seed(seed)\n        \n        # --- Vectorized simulation for N_trials ---\n        \n        # Initial conditions for all trials\n        V = np.full(N_trials, E_L)\n        w = np.full(N_trials, w_infinity(E_L))\n        \n        # Effective M-conductance for the current case\n        g_M_eff = alpha * g_M_base\n        \n        # Boolean array to track which trials have spiked\n        spiked_trials = np.zeros(N_trials, dtype=bool)\n\n        # Main simulation loop over time steps\n        for n in range(len(time_vec)):\n            V_prev = V.copy()\n\n            # Update M-gate activation variable w for all trials\n            w = w + (dt / tau_w) * (w_infinity(V) - w)\n            \n            # Calculate currents for all trials\n            I_L = g_L * (V - E_L)\n            I_M = g_M_eff * w * (V - E_K)\n            I_syn = g_syn_peak * s_t[n] * (E_A - V)\n            I_noise = sigma_I * np.sqrt(dt) * np.random.randn(N_trials)\n            \n            # Update membrane potential V for all trials\n            dV = (dt / C) * (-I_L - I_M + I_syn + I_noise)\n            V = V + dV\n            \n            # Detect new spikes (upward threshold crossing)\n            # Only check trials that have not spiked yet to avoid redundant work\n            not_yet_spiked = ~spiked_trials\n            new_spikes = (V_prev[not_yet_spiked]  V_th)  (V[not_yet_spiked] >= V_th)\n            spiked_trials[not_yet_spiked] = new_spikes\n\n        # Calculate spike probability as the fraction of spiked trials\n        spike_prob = np.sum(spiked_trials) / N_trials\n        \n        # Append the rounded result\n        results.append(round(spike_prob, 3))\n    \n    # Format and print the final output as a single line\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2576253"}]}