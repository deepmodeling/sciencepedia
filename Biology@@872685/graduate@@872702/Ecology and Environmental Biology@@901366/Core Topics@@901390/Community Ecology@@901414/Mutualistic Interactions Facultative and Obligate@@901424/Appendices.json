{"hands_on_practices": [{"introduction": "The distinction between facultative and obligate mutualism is fundamental, yet it requires a precise mathematical formulation to be useful in predictive models. This first exercise challenges you to connect the biological definition of obligate dependence—the inability to persist without a partner—to the basic demographic parameters of a population model. By analyzing a species' per-capita growth rate when it is rare, you will derive the threshold condition for obligate mutualism and calculate the minimum partner density required for survival, providing a solid quantitative foundation for the concept. [@problem_id:2511278]", "problem": "Consider two interacting species, indexed by $i$ and $j$, that engage in a trophic mutualism. Let $N_i$ and $N_j$ denote their respective population densities (e.g., individuals per unit area). At low density of species $i$, assume its per capita growth rate is well-approximated by the additive contributions of density-independent births, density-independent deaths, weak intraspecific self-limitation, and a saturating mutualistic benefit provided by species $j$:\n$$\n\\frac{1}{N_i}\\frac{dN_i}{dt}\n\\;=\\;\nr_i \\;-\\; c_i \\;-\\; b_i N_i \\;+\\; \\frac{\\beta_{ij} N_j}{1 + h_{ij} N_j},\n$$\nwhere $r_i > 0$ is the baseline per capita birth rate, $c_i > 0$ is the baseline per capita mortality rate, $b_i > 0$ is the intraspecific self-limitation coefficient for species $i$, $\\beta_{ij} > 0$ sets the initial slope of the mutualistic benefit of partner $j$, and $h_{ij} > 0$ is a saturation parameter that limits the per capita mutualistic gain to an asymptote as $N_j$ grows large. For the purpose of determining the minimal partner density required to prevent decline when species $i$ is rare, you may use the standard rare-invader approximation that the term $b_i N_i$ is negligible as $N_i \\to 0$.\n\nUsing only fundamental demographic definitions and the provided functional form, do the following:\n\n- Using the definition that a species is obligately dependent on its partner if it declines in the partner’s absence when rare, explain why the condition $r_i - c_i  0$ implies obligate dependence of species $i$ on species $j$.\n- Compute the minimal partner density $N_j^\\ast$ such that the per capita growth rate of species $i$ is exactly zero when $N_i \\to 0$. Express $N_j^\\ast$ as a closed-form symbolic expression in terms of $r_i$, $c_i$, $\\beta_{ij}$, and $h_{ij}$. If evaluated numerically, $N_j^\\ast$ should be expressed in the same units as $N_j$ (e.g., individuals per unit area). Do not include units in the final boxed expression.", "solution": "The problem presented is a standard exercise in theoretical ecology concerning the dynamics of mutualistic interactions. It is scientifically grounded, well-posed, and contains all necessary information for a complete solution. We will proceed directly to the analysis.\n\nThe per capita growth rate of species $i$ is given by the equation:\n$$\n\\frac{1}{N_i}\\frac{dN_i}{dt}\n\\;=\\;\nr_i \\;-\\; c_i \\;-\\; b_i N_i \\;+\\; \\frac{\\beta_{ij} N_j}{1 + h_{ij} N_j}\n$$\nHere, $r_i$ is the per capita birth rate, $c_i$ is the per capita mortality rate, $b_i N_i$ represents intraspecific competition, and the final term is the saturating benefit from the mutualist partner, species $j$.\n\nFirst, we must explain why the condition $r_i - c_i  0$ implies that species $i$ is an obligate mutualist with respect to species $j$. The definition provided is that a species is obligately dependent if it declines in its partner's absence when rare. Let us formalize this definition using the given model.\n\"In its partner's absence\" implies that the density of species $j$ is zero, $N_j = 0$.\n\"When rare\" implies that the density of species $i$ is infinitesimally small, $N_i \\to 0$. Under this condition, the problem statement specifies that the intraspecific self-limitation term, $b_i N_i$, is negligible and can be set to zero.\n\nWe substitute these two conditions, $N_j=0$ and $N_i \\to 0$, into the per capita growth rate equation:\n$$\n\\left. \\frac{1}{N_i}\\frac{dN_i}{dt} \\right|_{N_j=0, N_i \\to 0} \\;=\\; r_i - c_i - b_i(0) + \\frac{\\beta_{ij} (0)}{1 + h_{ij} (0)}\n$$\nThis simplifies to:\n$$\n\\left. \\frac{1}{N_i}\\frac{dN_i}{dt} \\right|_{N_j=0, N_i \\to 0} \\;=\\; r_i - c_i\n$$\nThe term $r_i - c_i$ is the intrinsic rate of natural increase (or decrease) for species $i$ in the absence of both its mutualist partner and density-dependent effects. For the population to decline (i.e., $\\frac{dN_i}{dt}  0$), its per capita growth rate must be negative. Given that $N_i$ is a positive density, this requires $\\frac{1}{N_i}\\frac{dN_i}{dt}  0$. Therefore, the condition for population decline in the absence of the partner is precisely $r_i - c_i  0$. This demonstrates that if the baseline mortality rate $c_i$ exceeds the baseline birth rate $r_i$, the species cannot sustain itself without the benefit conferred by its mutualist partner and is, by definition, an obligate mutualist.\n\nNext, we compute the minimal partner density $N_j^\\ast$ required for species $i$ to have a zero per capita growth rate when it is rare. We again apply the rare-invader approximation, $N_i \\to 0$, which allows us to neglect the $b_i N_i$ term. We are seeking the density $N_j = N_j^\\ast$ at which the per capita growth rate is exactly zero.\nThe equation becomes:\n$$\n0 \\;=\\; r_i - c_i + \\frac{\\beta_{ij} N_j^\\ast}{1 + h_{ij} N_j^\\ast}\n$$\nTo solve for $N_j^\\ast$, we rearrange the equation. It is algebraically convenient to express the initial growth deficit as a positive quantity. As established, for an obligate mutualist, $r_i - c_i  0$, which means $c_i - r_i > 0$.\n$$\nc_i - r_i \\;=\\; \\frac{\\beta_{ij} N_j^\\ast}{1 + h_{ij} N_j^\\ast}\n$$\nThis equation has a biologically meaningful solution ($N_j^\\ast > 0$) only if the left-hand side is positive, reaffirming that this minimal density concept is relevant only for obligate mutualists. We proceed with the algebraic manipulation:\n$$\n(c_i - r_i)(1 + h_{ij} N_j^\\ast) \\;=\\; \\beta_{ij} N_j^\\ast\n$$\nDistributing the term on the left-hand side:\n$$\n(c_i - r_i) + (c_i - r_i)h_{ij} N_j^\\ast \\;=\\; \\beta_{ij} N_j^\\ast\n$$\nWe collect all terms containing $N_j^\\ast$ on one side of the equation:\n$$\nc_i - r_i \\;=\\; \\beta_{ij} N_j^\\ast - (c_i - r_i)h_{ij} N_j^\\ast\n$$\nFactoring out $N_j^\\ast$:\n$$\nc_i - r_i \\;=\\; N_j^\\ast \\left( \\beta_{ij} - (c_i - r_i)h_{ij} \\right)\n$$\nFinally, we isolate $N_j^\\ast$ by dividing by its coefficient. For a positive solution $N_j^\\ast > 0$ to exist, the denominator must also be positive, since the numerator $c_i - r_i$ is positive. This implies the condition $\\beta_{ij} > (c_i - r_i)h_{ij}$, which means the maximum possible mutualistic benefit, $\\beta_{ij}/h_{ij}$, must exceed the intrinsic population deficit, $c_i - r_i$. Assuming this condition holds, the expression for the minimal partner density is:\n$$\nN_j^\\ast \\;=\\; \\frac{c_i - r_i}{\\beta_{ij} - (c_i - r_i)h_{ij}}\n$$\nThis is the required closed-form symbolic expression for the minimal partner density.", "answer": "$$\n\\boxed{\\frac{c_i - r_i}{\\beta_{ij} - h_{ij} (c_i - r_i)}}\n$$", "id": "2511278"}, {"introduction": "Ecological interactions are not static; their nature can change depending on the environmental context. This practice moves from a general population model to a specific, mechanistic scenario of microbial cross-feeding, a common form of mutualism in nature. You will use the principles of chemostat theory and Monod kinetics to explore how external resource availability can fundamentally alter a species' dependence on its partner, transforming an obligate relationship into a facultative one. This problem highlights the crucial role of the abiotic environment in shaping biotic interactions. [@problem_id:2511263]", "problem": "Two microbial species, species $A$ and species $B$, engage in obligate cross-feeding in a continuous-flow chemostat. Species $A$ requires metabolite $X$ for growth and releases metabolite $Y$ as a byproduct; species $B$ requires metabolite $Y$ for growth and releases metabolite $X$ as a byproduct. In the absence of any external inflow of $X$ and $Y$, neither species can persist alone, and coexistence is maintained by reciprocal exchange of metabolites. Now an external inflow provides both metabolites via a single feed stream with total inflow concentration $S$ that is partitioned as $pS$ for metabolite $X$ and $(1-p)S$ for metabolite $Y$, where $0  p  1$. The chemostat operates at a constant dilution rate $D$.\n\nAssume Monod growth with maintenance for each species on its required metabolite: $\\mu_{A}(X)=\\mu_{A,\\max}\\dfrac{X}{K_{A}+X}-m_{A}$ and $\\mu_{B}(Y)=\\mu_{B,\\max}\\dfrac{Y}{K_{B}+Y}-m_{B}$, where $\\mu_{i,\\max}$ is the maximum specific growth rate, $K_{i}$ is the half-saturation constant, and $m_{i}$ is the maintenance rate for $i\\in\\{A,B\\}$. Biomass dynamics follow chemostat mass balance, so for species $i$ in isolation its biomass satisfies $\\dfrac{dN_{i}}{dt}=N_{i}\\big(\\mu_{i}(R)-D\\big)$, where $R$ is the concentration of the required metabolite in the reactor. Resource dynamics follow $\\dfrac{dR}{dt}=D(R_{\\text{in}}-R)-\\text{uptake}+\\text{production}$, but when a species is alone the production of its required metabolite by the partner is absent and the production term for $R$ is irrelevant.\n\nStarting from these fundamentals and the steady-state condition for a positive biomass equilibrium in a chemostat (net growth equals dilution), derive the break-even metabolite concentration $R_{i}^{\\ast}$ required for species $i$ to persist alone when its required metabolite is supplied at inflow concentration $R_{\\text{in}}$. Then, using the fact that $X$ and $Y$ are supplied at $R_{\\text{in}}^{(X)}=pS$ and $R_{\\text{in}}^{(Y)}=(1-p)S$, determine the minimal total inflow $S_{\\min}$ that converts the interaction into facultative mutualism, meaning that each species can persist in isolation solely from the external inflow.\n\nUse the following parameter values, which are biologically plausible for microbes in a chemostat: $\\mu_{A,\\max}=0.90\\ \\mathrm{h}^{-1}$, $K_{A}=6.0\\ \\mu\\mathrm{M}$, $m_{A}=0.05\\ \\mathrm{h}^{-1}$; $\\mu_{B,\\max}=1.20\\ \\mathrm{h}^{-1}$, $K_{B}=4.0\\ \\mu\\mathrm{M}$, $m_{B}=0.08\\ \\mathrm{h}^{-1}$; dilution rate $D=0.20\\ \\mathrm{h}^{-1}$; and partition $p=0.60$. Report your final numerical value for $S_{\\min}$ in micromolar, rounding to four significant figures.", "solution": "The problem requires the determination of the minimal total inflow concentration $S_{\\min}$ of two metabolites, $X$ and $Y$, that allows two microbial species, $A$ and $B$, to persist independently in a chemostat. This condition corresponds to the transition from an obligate mutualism, sustained by cross-feeding, to a facultative mutualism, where external resource supply is sufficient for survival.\n\nFirst, we must derive the break-even concentration of a limiting resource, $R_{i}^{\\ast}$, required for a species $i$ to persist in a chemostat. The dynamics of the biomass $N_{i}$ of species $i$ are given by the standard chemostat model:\n$$\n\\frac{dN_{i}}{dt} = N_{i} \\left( \\mu_{i}(R_{i}) - D \\right)\n$$\nwhere $R_{i}$ is the concentration of the limiting resource for species $i$, $D$ is the constant dilution rate, and $\\mu_{i}(R_{i})$ is the specific growth rate. For a persistent, non-trivial steady state where the biomass concentration $N_{i}^{\\ast} > 0$, the net growth rate must be zero. This requires that the specific growth rate must exactly balance the dilution rate:\n$$\n\\mu_{i}(R_{i}^{\\ast}) - D = 0\n$$\nThe problem provides the growth rate function as Monod kinetics with a maintenance energy term:\n$$\n\\mu_{i}(R_{i}) = \\mu_{i,\\max} \\frac{R_{i}}{K_{i} + R_{i}} - m_{i}\n$$\nwhere $\\mu_{i,\\max}$ is the maximum specific growth rate, $K_{i}$ is the half-saturation constant, and $m_{i}$ is the maintenance rate. Substituting this expression into the steady-state condition yields:\n$$\n\\mu_{i,\\max} \\frac{R_{i}^{\\ast}}{K_{i} + R_{i}^{\\ast}} - m_{i} = D\n$$\nWe solve this equation for $R_{i}^{\\ast}$:\n$$\n\\mu_{i,\\max} \\frac{R_{i}^{\\ast}}{K_{i} + R_{i}^{\\ast}} = D + m_{i}\n$$\n$$\n\\frac{R_{i}^{\\ast}}{K_{i} + R_{i}^{\\ast}} = \\frac{D + m_{i}}{\\mu_{i,\\max}}\n$$\nThis relation is physically meaningful only if $\\mu_{i,\\max} > D + m_{i}$, which means the maximum growth rate must exceed the total loss rate from dilution and maintenance. Rearranging to solve for $R_{i}^{\\ast}$:\n$$\nR_{i}^{\\ast} = \\left( \\frac{D + m_{i}}{\\mu_{i,\\max}} \\right) (K_{i} + R_{i}^{\\ast})\n$$\n$$\nR_{i}^{\\ast} \\left( 1 - \\frac{D + m_{i}}{\\mu_{i,\\max}} \\right) = K_{i} \\left( \\frac{D + m_{i}}{\\mu_{i,\\max}} \\right)\n$$\n$$\nR_{i}^{\\ast} \\left( \\frac{\\mu_{i,\\max} - (D + m_{i})}{\\mu_{i,\\max}} \\right) = K_{i} \\left( \\frac{D + m_{i}}{\\mu_{i,\\max}} \\right)\n$$\n$$\nR_{i}^{\\ast} = K_{i} \\frac{D + m_{i}}{\\mu_{i,\\max} - D - m_{i}}\n$$\nThis is the general expression for the break-even concentration. For a species to persist, the inflow concentration of its limiting resource, $R_{\\text{in}}$, must be greater than this break-even concentration $R_{i}^{\\ast}$. The threshold for persistence is $R_{\\text{in}} \\ge R_{i}^{\\ast}$.\n\nThe interaction becomes facultative when each species can persist in isolation. This requires the persistence condition to be met for both species simultaneously. For species $A$, which requires metabolite $X$, and species $B$, which requires metabolite $Y$, we must have:\n$$\nR_{\\text{in}}^{(X)} \\geq X^{\\ast}\n$$\n$$\nR_{\\text{in}}^{(Y)} \\geq Y^{\\ast}\n$$\nwhere $X^{\\ast}$ and $Y^{\\ast}$ are the break-even concentrations for species $A$ and $B$, respectively.\n\nWe now calculate $X^{\\ast}$ and $Y^{\\ast}$ using the provided parameters.\nFor species $A$: $\\mu_{A,\\max} = 0.90\\ \\mathrm{h}^{-1}$, $K_{A} = 6.0\\ \\mu\\mathrm{M}$, $m_{A} = 0.05\\ \\mathrm{h}^{-1}$, and $D = 0.20\\ \\mathrm{h}^{-1}$.\n$$\nX^{\\ast} = K_{A} \\frac{D + m_{A}}{\\mu_{A,\\max} - D - m_{A}} = (6.0) \\frac{0.20 + 0.05}{0.90 - (0.20 + 0.05)} = (6.0) \\frac{0.25}{0.65} = \\frac{1.5}{0.65} = \\frac{30}{13}\\ \\mu\\mathrm{M}\n$$\nFor species $B$: $\\mu_{B,\\max} = 1.20\\ \\mathrm{h}^{-1}$, $K_{B} = 4.0\\ \\mu\\mathrm{M}$, $m_{B} = 0.08\\ \\mathrm{h}^{-1}$, and $D = 0.20\\ \\mathrm{h}^{-1}$.\n$$\nY^{\\ast} = K_{B} \\frac{D + m_{B}}{\\mu_{B,\\max} - D - m_{B}} = (4.0) \\frac{0.20 + 0.08}{1.20 - (0.20 + 0.08)} = (4.0) \\frac{0.28}{0.92} = \\frac{1.12}{0.92} = \\frac{28}{23}\\ \\mu\\mathrm{M}\n$$\nThe inflow concentrations are given as partitions of a total inflow $S$: $R_{\\text{in}}^{(X)} = pS$ and $R_{\\text{in}}^{(Y)} = (1-p)S$, with $p=0.60$. The persistence conditions become:\n$$\npS \\geq X^{\\ast} \\implies S \\geq \\frac{X^{\\ast}}{p}\n$$\n$$\n(1-p)S \\geq Y^{\\ast} \\implies S \\geq \\frac{Y^{\\ast}}{1-p}\n$$\nTo satisfy both inequalities, $S$ must be at least as large as the maximum of the two lower bounds. The minimal total inflow $S_{\\min}$ is therefore:\n$$\nS_{\\min} = \\max\\left(\\frac{X^{\\ast}}{p}, \\frac{Y^{\\ast}}{1-p}\\right)\n$$\nSubstituting the values $p=0.60$, $X^{\\ast} = 30/13\\ \\mu\\mathrm{M}$, and $Y^{\\ast} = 28/23\\ \\mu\\mathrm{M}$:\n$$\n\\frac{X^{\\ast}}{p} = \\frac{30/13}{0.60} = \\frac{30}{13 \\times 0.60} = \\frac{30}{7.8} = \\frac{50}{13}\\ \\mu\\mathrm{M} \\approx 3.84615\\ \\mu\\mathrm{M}\n$$\n$$\n\\frac{Y^{\\ast}}{1-p} = \\frac{28/23}{1 - 0.60} = \\frac{28/23}{0.40} = \\frac{28}{23 \\times 0.40} = \\frac{28}{9.2} = \\frac{70}{23}\\ \\mu\\mathrm{M} \\approx 3.04348\\ \\mu\\mathrm{M}\n$$\nComparing the two values, it is clear that the first one is larger:\n$$\nS_{\\min} = \\max\\left(\\frac{50}{13}, \\frac{70}{23}\\right) = \\frac{50}{13}\\ \\mu\\mathrm{M}\n$$\nThe problem requires a numerical value for $S_{\\min}$ in micromolar, rounded to four significant figures.\n$$\nS_{\\min} = \\frac{50}{13} \\approx 3.8461538...\n$$\nRounding to four significant figures yields $3.846$.", "answer": "$$\n\\boxed{3.846}\n$$", "id": "2511263"}, {"introduction": "While theoretical models provide clear-cut definitions, real-world ecological data are invariably noisy and incomplete, making a definitive classification of a mutualism challenging. This final practice bridges the gap between theory and empirical research by introducing a modern, powerful statistical approach for dealing with this uncertainty. You will implement a Bayesian hierarchical model to evaluate the evidence for obligate versus facultative mutualism from simulated field data, learning how to formally quantify the probability of competing ecological hypotheses in a rigorous, data-driven manner. [@problem_id:2511253]", "problem": "Consider a species that interacts mutualistically with a partner. Across multiple ecological sites and two experimental conditions—partner absent and partner present—you observe replicate estimates of its per capita growth rate. Assume that per capita growth is measured as a dimensionless daily rate; the final outputs in this problem are probabilities and therefore unitless decimals. Distinguish between two ecological hypotheses for the species: obligate mutualism versus facultative mutualism. We formalize these hypotheses using a Bayesian hierarchical model grounded in two fundamental bases: (i) the definition that an obligate mutualist has nonpositive expected growth without its partner, while a facultative mutualist has nonnegative expected growth without its partner; (ii) the well-tested assumption that aggregated ecological growth measurements under repeated sampling are well approximated by Gaussian (normal) distributions at multiple hierarchical levels due to the Central Limit Theorem (CLT).\n\nModel the data as follows. For each site index $s \\in \\{1,\\dots,S\\}$, condition indicator $c \\in \\{0,1\\}$ with $c=0$ denoting partner absent and $c=1$ denoting partner present, and replicate index $r \\in \\{1,\\dots,n_{s,c}\\}$,\n$$\ny_{s,c,r} \\mid m_{s,c}, \\sigma^2 \\sim \\mathcal{N}(m_{s,c}, \\sigma^2),\n$$\n$$\nm_{s,c} \\mid \\mu_c, \\tau_c^2 \\sim \\mathcal{N}(\\mu_c, \\tau_c^2).\n$$\nHere $y_{s,c,r}$ is the growth observation, $m_{s,c}$ is the latent site-level mean for condition $c$, $\\mu_c$ is the across-site mean for condition $c$, $\\sigma^2$ is the known within-site measurement variance, and $\\tau_c^2$ is the known between-site variance for condition $c$. Let the prior for the across-site mean under partner present be the same under both hypotheses and constrained to be positive,\n$$\n\\mu_1 \\sim \\mathcal{N}(m_1, s_1^2) \\text{ truncated to } (0,\\infty).\n$$\nFor the across-site mean under partner absent, use a truncated normal prior that encodes each hypothesis:\n- Obligate mutualism hypothesis $\\mathcal{M}_{\\mathrm{obl}}$: \n$$\n\\mu_0 \\sim \\mathcal{N}(m_0, s_0^2) \\text{ truncated to } (-\\infty, 0].\n$$\n- Facultative mutualism hypothesis $\\mathcal{M}_{\\mathrm{fac}}$:\n$$\n\\mu_0 \\sim \\mathcal{N}(m_0, s_0^2) \\text{ truncated to } [0, \\infty).\n$$\nLet the prior probability of the obligate hypothesis be $\\pi \\in (0,1)$ and the facultative hypothesis be $1-\\pi$. Because the prior and likelihood for $\\mu_1$ are identical under the two hypotheses, the Bayes factor that compares $\\mathcal{M}_{\\mathrm{obl}}$ to $\\mathcal{M}_{\\mathrm{fac}}$ depends only on the partner-absent data ($c=0$). Define the site-level sample mean for partner-absent data as\n$$\n\\bar{y}_{s,0} = \\frac{1}{n_{s,0}} \\sum_{r=1}^{n_{s,0}} y_{s,0,r},\n$$\nwith effective variance\n$$\nV_{s,0} = \\tau_0^2 + \\frac{\\sigma^2}{n_{s,0}}.\n$$\nThen the marginalized likelihood of the set $\\{\\bar{y}_{s,0}\\}_{s=1}^{S}$ under an untruncated normal prior $\\mu_0 \\sim \\mathcal{N}(m_0, s_0^2)$ is available in closed form. If we write\n$$\na = \\sum_{s=1}^{S} \\frac{1}{V_{s,0}}, \\quad b = \\sum_{s=1}^{S} \\frac{\\bar{y}_{s,0}}{V_{s,0}}, \\quad c = \\sum_{s=1}^{S} \\frac{\\bar{y}_{s,0}^2}{V_{s,0}},\n$$\nthen the untruncated posterior for $\\mu_0$ is $\\mathcal{N}(m_n, s_n^2)$ with\n$$\ns_n^2 = \\frac{1}{a + \\frac{1}{s_0^2}}, \\quad m_n = s_n^2 \\left(b + \\frac{m_0}{s_0^2}\\right).\n$$\nLet $\\phi(\\cdot)$ and $\\Phi(\\cdot)$ denote the standard normal probability density function and cumulative distribution function, respectively. The marginal likelihood under a truncated prior equals the untruncated marginal likelihood multiplied by a ratio of normalizing constants for the truncated normal prior and the truncated normal posterior, which are $\\Phi$-terms evaluated at the truncation boundaries. Concretely, if $\\mathcal{L}_{\\mathrm{untr}}$ denotes the untruncated marginal likelihood of $\\{\\bar{y}_{s,0}\\}$ given $(m_0, s_0^2)$, then\n$$\n\\mathcal{L}_{\\mathrm{obl}} = \\mathcal{L}_{\\mathrm{untr}} \\cdot \\frac{\\Phi\\!\\left(\\frac{0 - m_n}{s_n}\\right)}{\\Phi\\!\\left(\\frac{0 - m_0}{s_0}\\right)}, \\quad\n\\mathcal{L}_{\\mathrm{fac}} = \\mathcal{L}_{\\mathrm{untr}} \\cdot \\frac{1 - \\Phi\\!\\left(\\frac{0 - m_n}{s_n}\\right)}{1 - \\Phi\\!\\left(\\frac{0 - m_0}{s_0}\\right)}.\n$$\nFinally, the posterior probability that the species is obligate is given by Bayes’s theorem:\n$$\n\\mathbb{P}(\\mathcal{M}_{\\mathrm{obl}} \\mid \\text{data}) = \\frac{\\pi \\, \\mathcal{L}_{\\mathrm{obl}}}{\\pi \\, \\mathcal{L}_{\\mathrm{obl}} + (1-\\pi) \\, \\mathcal{L}_{\\mathrm{fac}}}.\n$$\n\nYour task is to implement a program that computes $\\mathbb{P}(\\mathcal{M}_{\\mathrm{obl}} \\mid \\text{data})$ for a small test suite of datasets. For each dataset, you are given the partner-absent and partner-present replicate observations by site (use the partner-present data only to acknowledge that conditions exist; it cancels from the comparison given the identical specification under both hypotheses), along with the known parameters $(\\sigma, \\tau_0, m_0, s_0, \\pi)$. All answers must be decimals and unitless. The required final output format is a single line containing a list of the posterior probabilities for the obligate hypothesis for each dataset, rounded to $6$ decimal places, as a comma-separated list enclosed in square brackets (for example, $[0.731000,0.502345]$).\n\nUse the following test suite. Each dataset contains site-wise replicate observations under partner-absent ($c=0$) and partner-present ($c=1$) conditions. In all cases, take $\\tau_1$ and the prior on $\\mu_1$ to be identical across hypotheses, so that the contribution of $c=1$ cancels and does not enter the computation. You must use only the partner-absent data for the computation described above.\n\n- Dataset A (clear obligate-like pattern): $\\sigma = 0.05$, $\\tau_0 = 0.10$, $m_0 = 0.0$, $s_0 = 0.5$, $\\pi = 0.5$.\n  - Sites and replicates, partner absent ($c=0$):\n    - Site $1$: $[-0.32,-0.28,-0.30]$\n    - Site $2$: $[-0.12,-0.08,-0.10]$\n    - Site $3$: $[-0.22,-0.25,-0.18]$\n  - Sites and replicates, partner present ($c=1$) [included for completeness; does not affect comparison]:\n    - Site $1$: $[0.55,0.62,0.58]$\n    - Site $2$: $[0.41,0.37,0.44]$\n    - Site $3$: $[0.66,0.61,0.63]$\n\n- Dataset B (clear facultative-like pattern): $\\sigma = 0.05$, $\\tau_0 = 0.10$, $m_0 = 0.0$, $s_0 = 0.5$, $\\pi = 0.5$.\n  - Partner absent ($c=0$):\n    - Site $1$: $[0.22,0.18,0.25]$\n    - Site $2$: $[0.35,0.29,0.31]$\n    - Site $3$: $[0.12,0.15,0.17]$\n  - Partner present ($c=1$):\n    - Site $1$: $[0.48,0.52,0.50]$\n    - Site $2$: $[0.62,0.58,0.60]$\n    - Site $3$: $[0.40,0.43,0.41]$\n\n- Dataset C (ambiguous near-zero pattern with fewer replicates): $\\sigma = 0.10$, $\\tau_0 = 0.10$, $m_0 = 0.0$, $s_0 = 0.5$, $\\pi = 0.5$.\n  - Partner absent ($c=0$):\n    - Site $1$: $[-0.03,0.01]$\n    - Site $2$: $[0.02,-0.01]$\n    - Site $3$: $[0.00,0.03]$\n  - Partner present ($c=1$):\n    - Site $1$: $[0.25,0.28]$\n    - Site $2$: $[0.30,0.34]$\n    - Site $3$: $[0.26,0.29]$\n\n- Dataset D (boundary case: high noise and single replicate per site): $\\sigma = 0.20$, $\\tau_0 = 0.15$, $m_0 = 0.0$, $s_0 = 0.5$, $\\pi = 0.5$.\n  - Partner absent ($c=0$):\n    - Site $1$: $[0.10]$\n    - Site $2$: $[-0.05]$\n    - Site $3$: $[0.02]$\n    - Site $4$: $[-0.01]$\n  - Partner present ($c=1$):\n    - Site $1$: $[0.20]$\n    - Site $2$: $[0.18]$\n    - Site $3$: $[0.22]$\n    - Site $4$: $[0.19]$\n\nYour program should produce a single line of output containing the posterior probabilities for $\\mathcal{M}_{\\mathrm{obl}}$ for the four datasets, in the exact format $[p_A,p_B,p_C,p_D]$, where each $p_{\\cdot}$ is rounded to $6$ decimal places.", "solution": "We formalize the ecological decision between obligate and facultative mutualism using a Bayesian hierarchical normal model with truncated priors reflecting the core ecological definitions: an obligate mutualist has nonpositive expected growth without its partner, while a facultative mutualist has nonnegative expected growth without its partner. The modeling begins with Gaussian likelihoods for replicate observations, justified by the Central Limit Theorem (CLT), and Gaussian random effects for site-level means.\n\nStep $1$: Likelihood reduction via site means. For partner-absent data ($c=0$), for each site $s$ with $n_{s,0}$ replicates, define the sample mean $\\bar{y}_{s,0} = \\frac{1}{n_{s,0}} \\sum_{r=1}^{n_{s,0}} y_{s,0,r}$. Integrating the site-level mean $m_{s,0}$ from the hierarchical model\n$$\ny_{s,0,r} \\mid m_{s,0} \\sim \\mathcal{N}(m_{s,0}, \\sigma^2), \\quad m_{s,0} \\mid \\mu_0 \\sim \\mathcal{N}(\\mu_0, \\tau_0^2)\n$$\nleads to the independent marginal distribution for site means\n$$\n\\bar{y}_{s,0} \\mid \\mu_0 \\sim \\mathcal{N}\\!\\left(\\mu_0, V_{s,0}\\right), \\quad V_{s,0} = \\tau_0^2 + \\frac{\\sigma^2}{n_{s,0}}.\n$$\nThe within-site sums of squares contribute multiplicative constants that are the same under both hypotheses and thus cancel in model comparison; sufficiency is carried by the $\\bar{y}_{s,0}$ and $V_{s,0}$.\n\nStep $2$: Conjugate update under an untruncated prior. Suppose $\\mu_0 \\sim \\mathcal{N}(m_0, s_0^2)$ without truncation. Define precision-weighted summaries\n$$\na = \\sum_{s=1}^{S} \\frac{1}{V_{s,0}}, \\quad b = \\sum_{s=1}^{S} \\frac{\\bar{y}_{s,0}}{V_{s,0}}, \\quad c = \\sum_{s=1}^{S} \\frac{\\bar{y}_{s,0}^2}{V_{s,0}}.\n$$\nBy normal-normal conjugacy, the untruncated posterior for $\\mu_0$ is $\\mathcal{N}(m_n, s_n^2)$ with\n$$\ns_n^2 = \\frac{1}{a + \\frac{1}{s_0^2}}, \\quad m_n = s_n^2 \\left(b + \\frac{m_0}{s_0^2}\\right).\n$$\nThe untruncated marginal likelihood (evidence) is obtained by integrating the product of the Gaussian likelihood and Gaussian prior over $\\mu_0$. Accounting for normalizing constants explicitly, the untruncated evidence equals\n$$\n\\mathcal{L}_{\\mathrm{untr}} = \\left[\\prod_{s=1}^{S} \\frac{1}{\\sqrt{2\\pi V_{s,0}}}\\right] \\cdot \\sqrt{\\frac{s_n^2}{s_0^2}} \\cdot \\exp\\!\\left\\{-\\frac{1}{2}\\left[c + \\frac{m_0^2}{s_0^2} - s_n^2\\left(b + \\frac{m_0}{s_0^2}\\right)^2\\right]\\right\\}.\n$$\nThis arises from completing the square in the exponent and integrating a Gaussian over $\\mu_0$:\n$$\n\\int \\exp\\!\\left(-\\frac{1}{2}\\left[(a+\\frac{1}{s_0^2})\\mu_0^2 - 2\\left(b + \\frac{m_0}{s_0^2}\\right)\\mu_0 + c + \\frac{m_0^2}{s_0^2}\\right]\\right) \\frac{d\\mu_0}{\\sqrt{2\\pi s_0^2}} = \\sqrt{\\frac{s_n^2}{s_0^2}} \\exp\\!\\left(-\\frac{1}{2}\\left[c + \\frac{m_0^2}{s_0^2} - \\frac{\\left(b + \\frac{m_0}{s_0^2}\\right)^2}{\\frac{1}{s_n^2}}\\right]\\right),\n$$\nand $\\frac{1}{s_n^2} = a + \\frac{1}{s_0^2}$.\n\nStep $3$: Truncated priors and the evidence ratio. Under a truncated normal prior on $\\mu_0$, the prior density equals the untruncated normal density divided by a normalizing constant (a tail probability of a Gaussian), and the posterior density is the untruncated posterior Gaussian divided by the corresponding posterior tail probability. Therefore, the truncated-prior marginal likelihood equals the untruncated marginal likelihood multiplied by the ratio of the posterior truncation normalizer to the prior truncation normalizer. For truncation set $A = (-\\infty, 0]$, the normalizers are $\\Phi\\!\\left(\\frac{0 - m}{s}\\right)$ for a Gaussian $\\mathcal{N}(m,s^2)$. Consequently,\n$$\n\\mathcal{L}_{\\mathrm{obl}} = \\mathcal{L}_{\\mathrm{untr}} \\cdot \\frac{\\Phi\\!\\left(\\frac{0 - m_n}{s_n}\\right)}{\\Phi\\!\\left(\\frac{0 - m_0}{s_0}\\right)}.\n$$\nFor truncation set $A = [0, \\infty)$, the normalizers are $1 - \\Phi\\!\\left(\\frac{0 - m}{s}\\right)$, giving\n$$\n\\mathcal{L}_{\\mathrm{fac}} = \\mathcal{L}_{\\mathrm{untr}} \\cdot \\frac{1 - \\Phi\\!\\left(\\frac{0 - m_n}{s_n}\\right)}{1 - \\Phi\\!\\left(\\frac{0 - m_0}{s_0}\\right)}.\n$$\nBecause the partner-present parameter $\\mu_1$ has the same truncated prior under both hypotheses and the same likelihood structure, its contribution cancels in the Bayes factor between $\\mathcal{M}_{\\mathrm{obl}}$ and $\\mathcal{M}_{\\mathrm{fac}}$. Thus only $c=0$ data enter the odds.\n\nStep $4$: Posterior model probability. With prior probability $\\pi$ on $\\mathcal{M}_{\\mathrm{obl}}$, Bayes’s theorem yields\n$$\n\\mathbb{P}(\\mathcal{M}_{\\mathrm{obl}} \\mid \\text{data}) = \\frac{\\pi \\, \\mathcal{L}_{\\mathrm{obl}}}{\\pi \\, \\mathcal{L}_{\\mathrm{obl}} + (1-\\pi) \\, \\mathcal{L}_{\\mathrm{fac}}}.\n$$\nFor numerical stability, compute all likelihoods in log-space and use the log-sum-exp trick. Specifically, define\n$$\n\\ell_{\\mathrm{untr}} = \\log \\mathcal{L}_{\\mathrm{untr}} = -\\frac{1}{2} \\sum_{s=1}^{S} \\log(2\\pi V_{s,0}) + \\frac{1}{2}\\left(\\log s_n^2 - \\log s_0^2\\right) - \\frac{1}{2}\\left[c + \\frac{m_0^2}{s_0^2} - s_n^2 \\left(b + \\frac{m_0}{s_0^2}\\right)^2\\right],\n$$\nthen\n$$\n\\ell_{\\mathrm{obl}} = \\ell_{\\mathrm{untr}} + \\log \\Phi\\!\\left(\\frac{0 - m_n}{s_n}\\right) - \\log \\Phi\\!\\left(\\frac{0 - m_0}{s_0}\\right),\n$$\n$$\n\\ell_{\\mathrm{fac}} = \\ell_{\\mathrm{untr}} + \\log\\!\\left(1 - \\Phi\\!\\left(\\frac{0 - m_n}{s_n}\\right)\\right) - \\log\\!\\left(1 - \\Phi\\!\\left(\\frac{0 - m_0}{s_0}\\right)\\right).\n$$\nFinally,\n$$\n\\log \\text{num} = \\log \\pi + \\ell_{\\mathrm{obl}}, \\quad \\log \\text{alt} = \\log (1-\\pi) + \\ell_{\\mathrm{fac}},\n$$\n$$\n\\mathbb{P}(\\mathcal{M}_{\\mathrm{obl}} \\mid \\text{data}) = \\frac{\\exp(\\log \\text{num})}{\\exp(\\log \\text{num}) + \\exp(\\log \\text{alt})}.\n$$\n\nStep $5$: Algorithm. For each dataset:\n- Compute site-wise means $\\bar{y}_{s,0}$ and counts $n_{s,0}$ from the partner-absent replicates.\n- Compute $V_{s,0} = \\tau_0^2 + \\sigma^2 / n_{s,0}$, then $(a,b,c)$, and $(s_n^2, m_n)$.\n- Compute $\\ell_{\\mathrm{untr}}$, $\\ell_{\\mathrm{obl}}$, $\\ell_{\\mathrm{fac}}$, and the posterior probability using the log-sum-exp approach.\n- Round the result to $6$ decimals.\n\nEdge cases in the provided test suite include clear separation (Dataset A and Dataset B), ambiguity near the ecological threshold at zero (Dataset C), and low-information settings with high noise and single replicates (Dataset D). These probe how the hierarchical pooling and the truncation-based ecological constraints combine to yield principled posterior probabilities rather than deterministic classifications.\n\nThe final program implements this procedure for all four datasets and prints a single line: $[p_A,p_B,p_C,p_D]$, where each $p_{\\cdot}$ is rounded to $6$ decimals.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef log_untruncated_evidence(ybars, ns, sigma, tau0, m0, s0):\n    \"\"\"\n    Compute log L_untr for partner-absent data under hierarchical normal model\n    with known sigma, tau0, and untruncated prior mu0 ~ N(m0, s0^2).\n    Uses sufficient statistics of site means and their variances.\n    \"\"\"\n    ybars = np.array(ybars, dtype=float)\n    ns = np.array(ns, dtype=float)\n    Vs = tau0**2 + (sigma**2) / ns  # Effective variances for site means\n    inv_Vs = 1.0 / Vs\n\n    a = np.sum(inv_Vs)\n    b = np.sum(ybars * inv_Vs)\n    c = np.sum((ybars ** 2) * inv_Vs)\n\n    inv_s0_sq = 1.0 / (s0 ** 2)\n    sn2 = 1.0 / (a + inv_s0_sq)\n    mn = sn2 * (b + m0 * inv_s0_sq)\n\n    # Log of untruncated evidence\n    # sum log(2π V_s)\n    sum_log_terms = np.sum(np.log(2.0 * np.pi * Vs))\n    term_const = -0.5 * sum_log_terms\n    term_scale = 0.5 * (np.log(sn2) - np.log(s0 ** 2))\n    quad = -0.5 * (c + (m0 ** 2) * inv_s0_sq - sn2 * (b + m0 * inv_s0_sq) ** 2)\n    logL = term_const + term_scale + quad\n    return logL, mn, np.sqrt(sn2)\n\ndef log_truncation_ratio(m, s, m0, s0, side):\n    \"\"\"\n    Compute log of the ratio of truncation normalizers Posterior/Prior\n    for side in {'le0', 'ge0'} corresponding to (-inf, 0] or [0, inf).\n    \"\"\"\n    # Compute prior and posterior tail CDFs at 0\n    if side == 'le0':\n        # (-inf, 0]\n        post_tail = norm.logcdf((0.0 - m) / s)\n        prior_tail = norm.logcdf((0.0 - m0) / s0)\n    elif side == 'ge0':\n        # [0, inf) - log(1 - Phi)\n        # Use logsf for numerical stability\n        post_tail = norm.logsf((0.0 - m) / s)  # log(1 - Phi)\n        prior_tail = norm.logsf((0.0 - m0) / s0)\n    else:\n        raise ValueError(\"side must be 'le0' or 'ge0'\")\n    return post_tail - prior_tail\n\ndef posterior_prob_obligate(absent_sites, sigma, tau0, m0, s0, pi_obl):\n    \"\"\"\n    Compute P(obligate | data) given:\n    - absent_sites: list of lists of replicates per site under c=0\n    - sigma: known within-site sd\n    - tau0: known between-site sd for c=0\n    - m0, s0: prior mean and sd for mu0 (before truncation)\n    - pi_obl: prior probability of obligate hypothesis\n    \"\"\"\n    # Compute site means and counts\n    ybars = []\n    ns = []\n    for reps in absent_sites:\n        arr = np.array(reps, dtype=float)\n        ybars.append(float(np.mean(arr)))\n        ns.append(int(len(arr)))\n    # Untruncated evidence and posterior params\n    logL_untr, mn, sn = log_untruncated_evidence(ybars, ns, sigma, tau0, m0, s0)\n    # Truncation ratios for obligate (=0) and facultative (=0)\n    log_ratio_obl = log_truncation_ratio(mn, sn, m0, s0, side='le0')\n    log_ratio_fac = log_truncation_ratio(mn, sn, m0, s0, side='ge0')\n    logL_obl = logL_untr + log_ratio_obl\n    logL_fac = logL_untr + log_ratio_fac\n    # Posterior model probability using log-sum-exp\n    log_num = np.log(pi_obl) + logL_obl\n    log_alt = np.log(1.0 - pi_obl) + logL_fac\n    # Normalize\n    m = max(log_num, log_alt)\n    denom = m + np.log(np.exp(log_num - m) + np.exp(log_alt - m))\n    p_obl = np.exp(log_num - denom)\n    return p_obl\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case: (absent_sites, present_sites, sigma, tau0, m0, s0, pi)\n    # present_sites included for completeness; not used in computation.\n    test_cases = [\n        (\n            [[-0.32, -0.28, -0.30],\n             [-0.12, -0.08, -0.10],\n             [-0.22, -0.25, -0.18]],\n            [[0.55, 0.62, 0.58],\n             [0.41, 0.37, 0.44],\n             [0.66, 0.61, 0.63]],\n            0.05, 0.10, 0.0, 0.5, 0.5\n        ),\n        (\n            [[0.22, 0.18, 0.25],\n             [0.35, 0.29, 0.31],\n             [0.12, 0.15, 0.17]],\n            [[0.48, 0.52, 0.50],\n             [0.62, 0.58, 0.60],\n             [0.40, 0.43, 0.41]],\n            0.05, 0.10, 0.0, 0.5, 0.5\n        ),\n        (\n            [[-0.03, 0.01],\n             [0.02, -0.01],\n             [0.00, 0.03]],\n            [[0.25, 0.28],\n             [0.30, 0.34],\n             [0.26, 0.29]],\n            0.10, 0.10, 0.0, 0.5, 0.5\n        ),\n        (\n            [[0.10],\n             [-0.05],\n             [0.02],\n             [-0.01]],\n            [[0.20],\n             [0.18],\n             [0.22],\n             [0.19]],\n            0.20, 0.15, 0.0, 0.5, 0.5\n        ),\n    ]\n\n    results = []\n    for case in test_cases:\n        absent_sites, present_sites, sigma, tau0, m0, s0, pi = case\n        p = posterior_prob_obligate(absent_sites, sigma, tau0, m0, s0, pi)\n        # Round to 6 decimal places\n        results.append(f\"{p:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2511253"}]}