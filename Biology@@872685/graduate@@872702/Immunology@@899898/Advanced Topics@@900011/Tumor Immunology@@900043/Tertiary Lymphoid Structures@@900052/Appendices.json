{"hands_on_practices": [{"introduction": "Tertiary lymphoid structures are dynamic entities, not static collections of cells. Their existence and function depend on the continuous recruitment of lymphocytes from circulation. This exercise [@problem_id:2895372] allows you to build a quantitative model for this crucial influx process. By applying basic principles of probability to the multi-step cascade of lymphocyte extravasation (rolling, adhesion, and transmigration), you will connect macroscopic physiological parameters to the microscopic events that populate and sustain a TLS.", "problem": "Consider a single High Endothelial Venule (HEV) feeding a mature Tertiary Lymphoid Structure (TLS) in steady state. Blood carrying circulating lymphocytes with mean number concentration $c_b$ (cells per unit volume) flows through the HEV at volumetric rate $Q$ (volume per unit time). Each lymphocyte that traverses the HEV undergoes a sequence of three stochastic steps required for entry into the TLS parenchyma: selectin-mediated rolling, integrin-mediated firm adhesion, and diapedesis (transendothelial migration). Let the probability that a lymphocyte successfully completes rolling be $p_r$, conditional adhesion given rolling be $p_a$, and conditional diapedesis given adhesion be $p_t$. Assume (i) stationarity and ergodicity over the time window of interest, (ii) independence at the level of individual cells, and (iii) that $p_r$, $p_a$, and $p_t$ are time-invariant and reflect the integrated effect of local chemokine and adhesion receptor presentation.\n\nStarting from conservation of cell number (cell flux equals volumetric flow multiplied by concentration) and the basic rules of probability for sequential events, derive a closed-form expression for the expected entry rate $J_{\\mathrm{in}}$ of lymphocytes into the TLS (cells per unit time) in terms of $Q$, $c_b$, $p_r$, $p_a$, and $p_t$. Then evaluate $J_{\\mathrm{in}}$ numerically for the following physiologically plausible parameter values:\n- Volumetric blood flow: $Q = 1.2\\,\\mu\\mathrm{L}\\,\\mathrm{min}^{-1}$,\n- Circulating lymphocyte concentration: $c_{b} = 2.5 \\times 10^{6}\\,\\mathrm{cells}\\,\\mathrm{mL}^{-1}$,\n- Rolling probability: $p_{r} = 0.35$,\n- Adhesion probability: $p_{a} = 0.60$,\n- Transmigration probability: $p_{t} = 0.70$.\n\nExpress your final numerical answer for $J_{\\mathrm{in}}$ in units of cells per minute and round your answer to three significant figures. Do not include the derivation formula in your final answer; report only the computed value.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- Mean number concentration of circulating lymphocytes: $c_{b}$\n- Volumetric blood flow rate through the High Endothelial Venule (HEV): $Q$\n- Probability of successful lymphocyte rolling: $p_{r}$\n- Conditional probability of firm adhesion given successful rolling: $p_{a}$\n- Conditional probability of diapedesis given successful adhesion: $p_{t}$\n- Assumptions: (i) stationarity and ergodicity, (ii) independence of individual cells, (iii) time-invariance of probabilities $p_{r}$, $p_{a}$, $p_{t}$.\n- Numerical values:\n  - $Q = 1.2\\,\\mu\\mathrm{L}\\,\\mathrm{min}^{-1}$\n  - $c_{b} = 2.5 \\times 10^{6}\\,\\mathrm{cells}\\,\\mathrm{mL}^{-1}$\n  - $p_{r} = 0.35$\n  - $p_{a} = 0.60$\n  - $p_{t} = 0.70$\n- Objective: Derive a closed-form expression for the expected lymphocyte entry rate $J_{\\mathrm{in}}$ and compute its value in cells per minute, rounded to three significant figures.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is assessed for validity.\n- **Scientifically Grounded**: The problem describes lymphocyte extravasation using a standard multi-step probabilistic model (rolling, adhesion, diapedesis), which is a cornerstone of immunology and biophysics. The model is a simplification but is based on established scientific principles. It is sound.\n- **Well-Posed**: The problem provides all necessary parameters and a clear objective. The relationship between flux, concentration, and probability is well-defined, leading to a unique solution. It is well-posed.\n- **Objective**: The language is technical and precise, free of subjective or ambiguous terminology.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically valid, self-contained, and well-posed. It is free from the enumerated flaws. A solution will be derived.\n\nThe derivation proceeds from first principles as required. The total flux of lymphocytes, denoted $J_{\\mathrm{total}}$, represents the total number of lymphocytes passing through the HEV per unit time. This is given by the product of the volumetric flow rate $Q$ and the mean number concentration of lymphocytes $c_{b}$.\n$$J_{\\mathrm{total}} = Q c_{b}$$\nThis expression is based on the principle of conservation of cell number for a fluid in motion.\n\nFor a single lymphocyte to enter the Tertiary Lymphoid Structure (TLS) parenchyma, it must successfully complete a sequence of three stochastic events: rolling, adhesion, and diapedesis (transmigration). The problem states these are sequential and provides the relevant probabilities. Let $R$ be the event of successful rolling, $A$ be the event of successful adhesion, and $T$ be the event of successful transmigration. The given probabilities are:\n- $P(R) = p_{r}$\n- $P(A|R) = p_{a}$ (adhesion is conditional on rolling)\n- $P(T|A \\cap R) = p_{t}$ (diapedesis is conditional on both prior steps, adhesion and rolling)\n\nThe probability of a single lymphocyte successfully completing the entire sequence, $p_{\\mathrm{entry}}$, is the probability of the joint event $R \\cap A \\cap T$. Using the chain rule for conditional probabilities:\n$$p_{\\mathrm{entry}} = P(R \\cap A \\cap T) = P(T|A \\cap R) P(A|R) P(R)$$\nSubstituting the given symbolic probabilities:\n$$p_{\\mathrm{entry}} = p_{t} p_{a} p_{r}$$\nThe expected entry rate of lymphocytes into the TLS, $J_{\\mathrm{in}}$, is the total flux of arriving lymphocytes multiplied by the probability that any individual lymphocyte successfully completes the entry sequence. This follows from the assumption of cell independence and stationarity.\n$$J_{\\mathrm{in}} = J_{\\mathrm{total}} \\times p_{\\mathrm{entry}}$$\nSubstituting the expressions for $J_{\\mathrm{total}}$ and $p_{\\mathrm{entry}}$ yields the final closed-form expression:\n$$J_{\\mathrm{in}} = Q c_{b} p_{r} p_{a} p_{t}$$\nNow, we must evaluate this expression numerically using the provided parameters. A critical step is to ensure dimensional consistency.\nThe given values are:\n- $Q = 1.2\\,\\mu\\mathrm{L}\\,\\mathrm{min}^{-1}$\n- $c_{b} = 2.5 \\times 10^{6}\\,\\mathrm{cells}\\,\\mathrm{mL}^{-1}$\n- $p_{r} = 0.35$\n- $p_{a} = 0.60$\n- $p_{t} = 0.70$\n\nThe volume units for $Q$ ($\\mu\\mathrm{L}$) and $c_{b}$ ($\\mathrm{mL}$) are inconsistent. We must convert them to a common unit. We convert $Q$ from $\\mu\\mathrm{L}\\,\\mathrm{min}^{-1}$ to $\\mathrm{mL}\\,\\mathrm{min}^{-1}$, using the conversion factor $1\\,\\mathrm{mL} = 1000\\,\\mu\\mathrm{L} = 10^{3}\\,\\mu\\mathrm{L}$.\n$$Q = 1.2\\,\\mu\\mathrm{L}\\,\\mathrm{min}^{-1} = 1.2 \\times \\frac{1}{10^{3}}\\,\\mathrm{mL}\\,\\mathrm{min}^{-1} = 1.2 \\times 10^{-3}\\,\\mathrm{mL}\\,\\mathrm{min}^{-1}$$\nNow, substitute the numerical values into the derived formula for $J_{\\mathrm{in}}$.\n$$J_{\\mathrm{in}} = (1.2 \\times 10^{-3}\\,\\mathrm{mL}\\,\\mathrm{min}^{-1}) \\times (2.5 \\times 10^{6}\\,\\mathrm{cells}\\,\\mathrm{mL}^{-1}) \\times (0.35) \\times (0.60) \\times (0.70)$$\nFirst, we compute the product of the flow rate and concentration:\n$$Q c_{b} = (1.2 \\times 10^{-3}) \\times (2.5 \\times 10^{6})\\,\\mathrm{cells}\\,\\mathrm{min}^{-1} = 3.0 \\times 10^{3}\\,\\mathrm{cells}\\,\\mathrm{min}^{-1}$$\nNext, we compute the product of the probabilities:\n$$p_{r} p_{a} p_{t} = 0.35 \\times 0.60 \\times 0.70 = 0.21 \\times 0.70 = 0.147$$\nFinally, we compute the expected entry rate $J_{\\mathrm{in}}$:\n$$J_{\\mathrm{in}} = (3.0 \\times 10^{3}\\,\\mathrm{cells}\\,\\mathrm{min}^{-1}) \\times 0.147 = 441\\,\\mathrm{cells}\\,\\mathrm{min}^{-1}$$\nThe problem requires the answer to be rounded to three significant figures. The calculated value $441$ already has three significant figures. We must express it in the specified scientific notation format $a \\times 10^b$ where $1 \\le |a| < 10$.\n$$J_{\\mathrm{in}} = 441 = 4.41 \\times 10^{2}\\,\\mathrm{cells}\\,\\mathrm{min}^{-1}$$\nThis is the final numerical answer.", "answer": "$$\\boxed{4.41 \\times 10^{2}}$$", "id": "2895372"}, {"introduction": "A defining feature of a TLS is its organized architecture, with B cells clustering into follicles. This spatial arrangement is not random; it is orchestrated by stable gradients of chemokines. This practice [@problem_id:2895378] explores the biophysical underpinnings of this organization through a reaction-diffusion model. You will derive how the physical properties of a chemokine—its diffusion rate through tissue and its rate of decay—interact to establish a characteristic length scale, providing a tangible, physical basis for the observed size of a B cell follicle.", "problem": "Tertiary lymphoid structures (TLS) organize B cell follicles through gradients of C-X-C motif chemokine ligand 13 (CXCL13) established in extracellular matrix (ECM). Consider a one-dimensional tissue half-space $x \\geq 0$ in which CXCL13 is produced by a planar stromal layer at $x=0$, imposing a fixed concentration $C(0)=C_0$, and is degraded in the ECM by first-order processes with rate constant $k$. Assume no advection, homogeneous medium, and that away from $x=0$ there is no volumetric source of CXCL13. Using only Fick’s first law and conservation of mass with a first-order sink, derive the steady-state concentration profile $C(x)$ for $x>0$ and identify the characteristic length scale $\\lambda$ that controls the spatial decay. Then, given the measured diffusion coefficient $D=9.0 \\times 10^{-11}\\ \\mathrm{m^{2}\\ s^{-1}}$ and first-order decay constant $k=1.0 \\times 10^{-3}\\ \\mathrm{s^{-1}}$ for CXCL13 in ECM, and an observed TLS B cell follicle radius $R_{\\mathrm{obs}}=2.25 \\times 10^{-4}\\ \\mathrm{m}$, compute the dimensionless ratio $R_{\\mathrm{obs}}/\\lambda$. Express the final answer as a pure number (unitless) and round to three significant figures.", "solution": "The problem as stated is scientifically sound, well-posed, and contains sufficient information for a unique solution. It describes a classical one-dimensional reaction-diffusion system at steady state, a fundamental model in chemical physics and biology. We will now proceed with the derivation and calculation.\n\nThe conservation of mass for the chemokine C-X-C motif chemokine ligand 13 (CXCL13) in a one-dimensional system is described by the partial differential equation:\n$$\n\\frac{\\partial C}{\\partial t} = -\\frac{\\partial J}{\\partial x} + S\n$$\nwhere $C(x,t)$ is the concentration of CXCL13 at position $x$ and time $t$, $J(x,t)$ is the diffusive flux, and $S$ is the net rate of production (source minus sink).\n\nThe problem states that there is no advection and the medium is homogeneous. The diffusive flux $J$ is given by Fick's first law:\n$$\nJ = -D \\frac{\\partial C}{\\partial x}\n$$\nwhere $D$ is the constant diffusion coefficient.\n\nThe problem specifies degradation by a first-order process with rate constant $k$, and no volumetric source for $x > 0$. Thus, the sink term is $-kC$ and the source term is $0$. The net rate of production is $S = -kC$.\n\nSubstituting the expressions for $J$ and $S$ into the conservation equation gives the reaction-diffusion equation:\n$$\n\\frac{\\partial C}{\\partial t} = -\\frac{\\partial}{\\partial x}\\left(-D \\frac{\\partial C}{\\partial x}\\right) - kC = D \\frac{\\partial^2 C}{\\partial x^2} - kC\n$$\n\nThe problem asks for the steady-state concentration profile, which means the concentration does not change with time, i.e., $\\frac{\\partial C}{\\partial t} = 0$. The governing equation reduces to a second-order ordinary differential equation (ODE):\n$$\nD \\frac{d^2 C}{d x^2} - k C = 0\n$$\nThis can be rewritten as:\n$$\n\\frac{d^2 C}{d x^2} - \\frac{k}{D} C = 0\n$$\nThis is a linear, homogeneous ODE with constant coefficients. The characteristic equation is $r^2 - \\frac{k}{D} = 0$, which has two real roots: $r = \\pm\\sqrt{\\frac{k}{D}}$. The general solution is therefore:\n$$\nC(x) = A_{1} \\exp\\left(x\\sqrt{\\frac{k}{D}}\\right) + A_{2} \\exp\\left(-x\\sqrt{\\frac{k}{D}}\\right)\n$$\nwhere $A_{1}$ and $A_{2}$ are constants to be determined by the boundary conditions.\n\nThe boundary conditions are:\n1. A fixed concentration $C_{0}$ at the source plane $x=0$: $C(0) = C_{0}$.\n2. The concentration must remain physically realistic for a large distance from the source. In the half-space $x \\geq 0$, the concentration cannot grow infinitely as $x \\to \\infty$. This implies that the term with the positive exponent, which diverges as $x \\to \\infty$, must be zero. Therefore, we must set $A_{1}=0$.\n\nApplying the first boundary condition with $A_{1}=0$:\n$$\nC(0) = A_{2} \\exp(0) = A_{2} = C_{0}\n$$\nThus, the steady-state concentration profile is:\n$$\nC(x) = C_{0} \\exp\\left(-x\\sqrt{\\frac{k}{D}}\\right)\n$$\nThis solution describes an exponential decay of the chemokine concentration away from the source plane. The characteristic length scale, $\\lambda$, is the distance over which the concentration decreases by a factor of $e$. By comparing our solution to the general form $C(x) = C_0 \\exp(-x/\\lambda)$, we identify $\\lambda$ as:\n$$\n\\lambda = \\sqrt{\\frac{D}{k}}\n$$\nNow, we must compute the value of this characteristic length scale $\\lambda$ and then the dimensionless ratio $R_{\\mathrm{obs}}/\\lambda$.\n\nThe given parameters are:\nDiffusion coefficient, $D = 9.0 \\times 10^{-11} \\ \\mathrm{m^2 \\ s^{-1}}$.\nFirst-order decay constant, $k = 1.0 \\times 10^{-3} \\ \\mathrm{s^{-1}}$.\nObserved B cell follicle radius, $R_{\\mathrm{obs}} = 2.25 \\times 10^{-4} \\ \\mathrm{m}$.\n\nFirst, we calculate $\\lambda$:\n$$\n\\lambda = \\sqrt{\\frac{9.0 \\times 10^{-11} \\ \\mathrm{m^2 \\ s^{-1}}}{1.0 \\times 10^{-3} \\ \\mathrm{s^{-1}}}} = \\sqrt{9.0 \\times 10^{-8} \\ \\mathrm{m^2}} = 3.0 \\times 10^{-4} \\ \\mathrm{m}\n$$\nNext, we compute the required dimensionless ratio:\n$$\n\\frac{R_{\\mathrm{obs}}}{\\lambda} = \\frac{2.25 \\times 10^{-4} \\ \\mathrm{m}}{3.0 \\times 10^{-4} \\ \\mathrm{m}} = \\frac{2.25}{3.0} = 0.75\n$$\nThe problem demands the final answer be rounded to three significant figures.\n$$\n0.75 \\rightarrow 0.750\n$$\nThis ratio indicates that the observed size of the B cell follicle is a substantial fraction, precisely $75\\%$, of the characteristic length of the chemokine gradient.", "answer": "$$\\boxed{0.750}$$", "id": "2895378"}, {"introduction": "While microscopy can reveal the apparent segregation of B and T cells in a TLS, rigorous scientific claims demand objective, quantitative analysis. This advanced computational practice [@problem_id:2895404] introduces a powerful method to achieve this. You will implement a fundamental tool from spatial statistics, the cross-type Ripley’s K-function, to move beyond qualitative description and generate a robust metric for cellular segregation. This exercise bridges the gap between biological observation and statistical validation, a critical skill in modern quantitative biology.", "problem": "You are given a quantitative task grounded in the study of Tertiary Lymphoid Structures (TLS) in immunology: model the spatial segregation or co-localization of B cells and T cells within a circular TLS and quantify deviations from spatial randomness. Represent the TLS as a two-dimensional circular observation window of radius $R$ (in arbitrary length units, abbreviated as a.l.u.), and represent cell positions as points of two types: B cells and T cells.\n\nFundamental basis and definitions to use:\n- In a homogeneous spatial Poisson point process (Complete Spatial Randomness, abbreviated as CSR), the expected number of neighbors within a distance $r$ of a typical point grows proportionally to the area $\\pi r^2$. For two independent types with constant intensities, the cross-type neighbor expectation scales with the intensity of the target type and $\\pi r^2$.\n- Let $\\lambda_B$ and $\\lambda_T$ denote the (constant) intensities of B cells and T cells, respectively, defined as counts per unit area.\n- The cross-type Ripley’s $K$ function, denoted $K_{BT}(r)$, is defined as the expected number of T-cell neighbors within distance $r$ of a typical B cell, divided by $\\lambda_T$. Under independence of types with homogeneity, $K_{BT}(r) = \\pi r^2$.\n- A variance-stabilizing transformation $L_{BT}(r) = \\sqrt{K_{BT}(r)/\\pi}$ is often used, so that under independence $L_{BT}(r) - r$ is expected to be $0$.\n\nProblem requirements:\n1) Derive and implement from first principles a consistent estimator for the cross-type function $K_{BT}(r)$ for two point types in a circular observation window. Use a border (reduced-sample) edge correction appropriate for a circular window: for each radius $r$, only B-cell “focal” points whose entire circle of radius $r$ lies within the observation window may contribute neighbors, and normalize by the T-cell intensity. Let $A$ denote the window area. Your estimator must use:\n   - $\\hat{\\lambda}_T = N_T / A$ where $N_T$ is the number of T cells and $A = \\pi R^2$.\n   - For each radius $r$, only include B cells whose distance to the circular boundary is at least $r$; let the count of such B cells be $N_B^*(r)$.\n   - Count, for each such eligible B cell, the number of T cells within Euclidean distance $r$.\n2) Compute $L_{BT}(r) = \\sqrt{ K_{BT}(r) / \\pi }$ and the deviation $\\Delta(r) = L_{BT}(r) - r$.\n3) Define a scalar segregation summary statistic as the arithmetic mean of $\\Delta(r)$ across a supplied discrete grid of radii $\\{r_k\\}$. Report this mean deviation in a.l.u. Intuitively, negative values indicate segregation (avoidance), positive values indicate attraction (co-localization), and values near zero indicate consistency with independence at the examined scales.\n4) Synthetic data generation must be implemented as specified in the test suite. All random number generation must be seeded exactly as specified to ensure reproducibility.\n5) Numerical units: All distances and coordinates are in arbitrary length units (a.l.u.). Your program must output the mean deviation in a.l.u., rounded to six decimal places for each test case.\n\nTest suite (three scenarios probing different behaviors):\n- Test case $1$ (independence/CSR baseline):\n  - Seed: $12345$\n  - Window radius: $R = 1.0$ a.l.u.\n  - Counts: $N_B = 150$, $N_T = 150$\n  - Generation: Draw B and T points independently and uniformly in the circle of radius $R$.\n  - Radii grid: $ \\{ 0.05, 0.10, 0.15, 0.20, 0.25, 0.30 \\} $ a.l.u.\n\n- Test case $2$ (segregation: two separated clusters):\n  - Seed: $202357$\n  - Window radius: $R = 1.0$ a.l.u.\n  - Counts: $N_B = 150$, $N_T = 150$\n  - Generation: Draw B points from a bivariate normal distribution with mean $(-0.4, 0.0)$ and standard deviation $0.12$ (isotropic), rejecting and resampling any point falling outside the circle of radius $R$ until exactly $N_B$ are accepted. Draw T points analogously with mean $(+0.4, 0.0)$ and standard deviation $0.12$, using the same rejection rule.\n  - Radii grid: $ \\{ 0.05, 0.10, 0.15, 0.20, 0.25, 0.30 \\} $ a.l.u.\n\n- Test case $3$ (attraction: T cells aggregate around B cells):\n  - Seed: $98765$\n  - Window radius: $R = 1.0$ a.l.u.\n  - Counts: $N_B = 150$, $N_T = 150$\n  - Generation: First draw $N_B$ B points uniformly in the circle of radius $R$. Then generate T points by repeatedly selecting a B point uniformly at random and adding an independent bivariate normal offset with mean $(0,0)$ and standard deviation $0.06$ (isotropic). Reject and resample any T point that falls outside the circle until exactly $N_T$ are accepted.\n  - Radii grid: $ \\{ 0.05, 0.10, 0.15, 0.20, 0.25, 0.30 \\} $ a.l.u.\n\nAlgorithmic outputs:\n- For each test case, compute the mean of $ \\Delta(r) $ over the supplied radii grid. Each output must be a floating-point number (in a.l.u.) rounded to six decimal places.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\"), in the same order as the test cases ($1$ then $2$ then $3$).", "solution": "The problem statement is subjected to validation and is found to be scientifically grounded, well-posed, and objective. It presents a clear, formalizable task in spatial statistics applied to immunology, with all necessary parameters and definitions provided. There are no contradictions, ambiguities, or violations of scientific principles. The problem is therefore deemed **valid**, and a complete solution follows.\n\nThe core of this problem is to implement a specific estimator for the cross-type Ripley's K-function, denoted $K_{BT}(r)$, to analyze the spatial relationship between two cell populations—B cells and T cells—within a circular domain representing a Tertiary Lymphoid Structure (TLS). We will quantify the deviation from spatial independence using a summary statistic derived from this function.\n\nFirst, we formalize the estimator from first principles as required. Let the set of B-cell positions be $B = \\{\\mathbf{x}_i\\}_{i=1}^{N_B}$ and the T-cell positions be $T = \\{\\mathbf{y}_j\\}_{j=1}^{N_T}$, where $\\mathbf{x}_i, \\mathbf{y}_j \\in \\mathbb{R}^2$. The observation window is a circular disk $W$ of radius $R$ centered at the origin, with area $A = \\pi R^2$. The intensity (number of points per unit area) of T cells is estimated as $\\hat{\\lambda}_T = N_T / A$.\n\nThe problem specifies a border (or reduced-sample) edge correction. For a given analysis radius $r$, only B cells that are sufficiently far from the boundary of $W$ are used as focal points for counting neighbors. This ensures that the entire neighborhood of radius $r$ around each focal point is contained within the observation window, avoiding the need to estimate unobserved neighbors. For a circular window of radius $R$, a point $\\mathbf{x}_i$ is an eligible focal point if its distance from the origin satisfies $||\\mathbf{x}_i|| \\le R - r$.\n\nLet $N_B^*(r)$ be the number of such eligible B cells for a given radius $r$:\n$$ N_B^*(r) = \\sum_{i=1}^{N_B} \\mathbb{I}(||\\mathbf{x}_i|| \\le R - r) $$\nwhere $\\mathbb{I}(\\cdot)$ is the indicator function, which is $1$ if its argument is true and $0$ otherwise. We assume $N_B^*(r) > 0$ for all radii $r$ in the analysis grid, which is a reasonable assumption given the problem parameters.\n\nThe estimator for the cross-type K-function, $\\hat{K}_{BT}(r)$, is defined as the average number of T cells found within distance $r$ of an eligible B cell, normalized by the T-cell intensity $\\hat{\\lambda}_T$. The formula is:\n$$ \\hat{K}_{BT}(r) = \\frac{1}{\\hat{\\lambda}_T N_B^*(r)} \\sum_{i=1}^{N_B} \\sum_{j=1}^{N_T} \\mathbb{I}(||\\mathbf{x}_i - \\mathbf{y}_j|| \\le r) \\mathbb{I}(||\\mathbf{x}_i|| \\le R-r) $$\nSubstituting $\\hat{\\lambda}_T = N_T / A$ and rearranging, we obtain the computational formula:\n$$ \\hat{K}_{BT}(r) = \\frac{A}{N_T N_B^*(r)} \\sum_{\\{\\mathbf{x}_i : ||\\mathbf{x}_i|| \\le R-r\\}} \\left( \\sum_{j=1}^{N_T} \\mathbb{I}(||\\mathbf{x}_i - \\mathbf{y}_j|| \\le r) \\right) $$\n\nNext, we apply the variance-stabilizing transformation to obtain the $L$-function, which linearizes the K-function under the null hypothesis of Complete Spatial Randomness (CSR) and independence of the two point processes.\n$$ \\hat{L}_{BT}(r) = \\sqrt{\\frac{\\hat{K}_{BT}(r)}{\\pi}} $$\nUnder CSR, the theoretical expectation is $L_{BT}(r) = r$. Therefore, the deviation from this expectation, $\\Delta(r)$, provides a measure of clustering or segregation at scale $r$.\n$$ \\hat{\\Delta}(r) = \\hat{L}_{BT}(r) - r $$\nPositive values of $\\hat{\\Delta}(r)$ suggest attraction or co-localization, while negative values suggest segregation or avoidance. Values near $0$ are consistent with spatial independence.\n\nFinally, the problem requires a single summary statistic, which is the arithmetic mean of $\\hat{\\Delta}(r)$ over a discrete grid of radii $\\{r_k\\}_{k=1}^M$:\n$$ \\bar{\\Delta} = \\frac{1}{M} \\sum_{k=1}^M \\hat{\\Delta}(r_k) $$\n\nThe implementation will proceed as follows for each test case:\n1.  Initialize a pseudo-random number generator with the specified seed to ensure reproducibility.\n2.  Generate the point patterns for $N_B$ B cells and $N_T$ T cells according to the rules for each case (uniform, segregated bimodal, or attraction). This involves rejection sampling to ensure all points lie within the circular window of radius $R$.\n3.  For each radius $r_k$ in the provided grid:\n    a. Determine the set of eligible B cells by selecting those with $||\\mathbf{x}_i|| \\le R-r_k$.\n    b. If the number of eligible B cells $N_B^*(r_k)$ is $0$, the estimator is undefined. However, given the parameters, this is not expected to occur.\n    c. For each eligible B cell, count the number of T cells within a Euclidean distance of $r_k$.\n    d. Sum these counts over all eligible B cells.\n    e. Compute $\\hat{K}_{BT}(r_k)$, $\\hat{L}_{BT}(r_k)$, and $\\hat{\\Delta}(r_k)$ using the derived formulae.\n4.  Compute the arithmetic mean of all calculated $\\hat{\\Delta}(r_k)$ values. This mean value is the final result for the test case, which will be reported rounded to six decimal places.\n\nThis systematic procedure correctly translates the theoretical principles of spatial point process analysis into a concrete computational algorithm, satisfying all requirements of the problem statement.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.spatial.distance import cdist\n\ndef generate_uniform_in_circle(rng, n, r_max):\n    \"\"\"Generates n points uniformly distributed in a circle of radius r_max.\"\"\"\n    # To generate uniformly, sample radius-squared uniformly, and angle uniformly.\n    # r = R * sqrt(u1), theta = 2*pi*u2\n    mag = r_max * np.sqrt(rng.random(size=n))\n    angle = 2 * np.pi * rng.random(size=n)\n    x = mag * np.cos(angle)\n    y = mag * np.sin(angle)\n    return np.column_stack((x, y))\n\ndef generate_bvn_rejection(rng, n, r_max, mean, std):\n    \"\"\"Generates n points from a bivariate normal distribution, rejecting points\n    outside a circle of radius r_max.\"\"\"\n    points = []\n    cov = [[std**2, 0], [0, std**2]]\n    while len(points) < n:\n        # Generate a batch of points to be more efficient\n        batch_size = n - len(points)\n        candidates = rng.multivariate_normal(mean, cov, size=batch_size)\n        norms = np.linalg.norm(candidates, axis=1)\n        accepted = candidates[norms <= r_max]\n        points.extend(accepted)\n    return np.array(points[:n])\n\ndef generate_attraction_rejection(rng, n_b, n_t, r_max, offset_std):\n    \"\"\"Generates B-cells uniformly, then T-cells clustered around B-cells.\"\"\"\n    b_cells = generate_uniform_in_circle(rng, n_b, r_max)\n    t_cells = []\n    cov = [[offset_std**2, 0], [0, offset_std**2]]\n    while len(t_cells) < n_t:\n        # Select a random B-cell as a center\n        center_b_cell = b_cells[rng.integers(0, n_b)]\n        # Add a normal offset\n        offset = rng.multivariate_normal([0, 0], cov)\n        candidate_t = center_b_cell + offset\n        # Reject if outside the circle\n        if np.linalg.norm(candidate_t) <= r_max:\n            t_cells.append(candidate_t)\n    return b_cells, np.array(t_cells)\n\ndef calculate_mean_deviation(case):\n    \"\"\"\n    Orchestrates data generation and calculation for a single test case.\n    \"\"\"\n    seed = case['seed']\n    R = case['R']\n    N_B = case['N_B']\n    N_T = case['N_T']\n    radii_grid = case['radii_grid']\n    \n    rng = np.random.default_rng(seed)\n\n    if case['id'] == 1: # Independence/CSR\n        b_cells = generate_uniform_in_circle(rng, N_B, R)\n        t_cells = generate_uniform_in_circle(rng, N_T, R)\n    elif case['id'] == 2: # Segregation\n        b_cells = generate_bvn_rejection(rng, N_B, R, mean=[-0.4, 0.0], std=0.12)\n        t_cells = generate_bvn_rejection(rng, N_T, R, mean=[0.4, 0.0], std=0.12)\n    elif case['id'] == 3: # Attraction\n        b_cells, t_cells = generate_attraction_rejection(rng, N_B, N_T, R, offset_std=0.06)\n\n    area = np.pi * R**2\n    lambda_T_hat = N_T / area\n\n    delta_values = []\n    for r in radii_grid:\n        # 1. Identify eligible B-cells (focal points)\n        b_cell_norms = np.linalg.norm(b_cells, axis=1)\n        eligible_mask = b_cell_norms <= (R - r)\n        eligible_b_cells = b_cells[eligible_mask]\n        N_B_star = eligible_b_cells.shape[0]\n\n        if N_B_star == 0:\n            # Estimator is undefined. This is not expected for the given problem parameters.\n            # If it happened, one might return np.nan and use np.nanmean later.\n            # For this problem, we assume N_B_star > 0.\n            continue\n            \n        # 2. Calculate pairwise distances from eligible B-cells to all T-cells\n        dist_matrix = cdist(eligible_b_cells, t_cells)\n\n        # 3. Sum neighbor counts over all eligible B-cells\n        total_neighbors = np.sum(dist_matrix <= r)\n        \n        # 4. Calculate K_BT(r) estimator\n        # The factor 1/lambda_T is A/N_T.\n        # The sum over eligible points is total_neighbors / N_B_star\n        K_BT_hat = (area / N_T) * (total_neighbors / N_B_star)\n        \n        # 5. Calculate L_BT(r) and Delta(r)\n        L_BT_hat = np.sqrt(K_BT_hat / np.pi)\n        delta_r = L_BT_hat - r\n        delta_values.append(delta_r)\n\n    # 6. Compute the mean of Delta(r) values\n    mean_delta = np.mean(delta_values)\n    return mean_delta\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final output.\n    \"\"\"\n    test_cases = [\n        {\n            \"id\": 1,\n            \"seed\": 12345,\n            \"R\": 1.0,\n            \"N_B\": 150,\n            \"N_T\": 150,\n            \"radii_grid\": [0.05, 0.10, 0.15, 0.20, 0.25, 0.30]\n        },\n        {\n            \"id\": 2,\n            \"seed\": 202357,\n            \"R\": 1.0,\n            \"N_B\": 150,\n            \"N_T\": 150,\n            \"radii_grid\": [0.05, 0.10, 0.15, 0.20, 0.25, 0.30]\n        },\n        {\n            \"id\": 3,\n            \"seed\": 98765,\n            \"R\": 1.0,\n            \"N_B\": 150,\n            \"N_T\": 150,\n            \"radii_grid\": [0.05, 0.10, 0.15, 0.20, 0.25, 0.30]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_mean_deviation(case)\n        results.append(result)\n\n    # Format the final output string\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2895404"}]}