{"hands_on_practices": [{"introduction": "The Banff classification is the international language used to interpret transplant biopsies, providing a standardized framework for diagnosis. This exercise [@problem_id:2850468] challenges you to act as a transplant immunologist, integrating histological scores and serological data to decipher the specific type and severity of rejection in a kidney allograft. Mastering this systematic approach is essential for accurate diagnosis and for understanding the interplay between cellular and humoral immunity.", "problem": "A kidney allograft recipient at $3$ months post-transplant presents with a rise in serum creatinine and proteinuria. There is no clinical evidence of infection. A for-cause biopsy is read using Banff lesion scores as follows: interstitial inflammation $i=2$, tubulitis $t=2$, intimal arteritis $v=0$, glomerulitis $g=1$, peritubular capillaritis $ptc=2$. Staining for complement component C4d is negative by both immunofluorescence (IF) and immunohistochemistry (IHC). Single-antigen bead testing detects Human Leukocyte Antigen (HLA) class II donor-specific antibodies (DSA). There are no chronic glomerular double contours on light microscopy and no electron microscopic evidence of duplicated glomerular basement membranes; no other chronic scarring scores are elevated.\n\nUsing only foundational immunologic principles of allograft rejection (cellular versus humoral pathways) and the definitional criteria of the Banff classification (lesion definitions and diagnostic thresholds), determine the most accurate rejection phenotype. Select the single best option and be prepared to justify how each required criterion is or is not fulfilled.\n\nOptions:\nA. Acute T-cell–mediated rejection (TCMR), Banff grade IA, only\n\nB. Active antibody-mediated rejection (ABMR), C4d-negative, only\n\nC. Mixed rejection: acute T-cell–mediated rejection (TCMR) Banff grade IA and active antibody-mediated rejection (ABMR), C4d-negative\n\nD. Chronic active antibody-mediated rejection (ABMR)\n\nE. No rejection; borderline or nonspecific changes only", "solution": "The problem statement must first be subject to rigorous validation to ensure it is scientifically sound, self-contained, and well-posed.\n\n**Step 1: Extract Givens**\nThe following data are provided in the problem statement:\n-   **Recipient**: Kidney allograft recipient.\n-   **Time Post-Transplant**: $3$ months.\n-   **Clinical Presentation**: Rise in serum creatinine and proteinuria.\n-   **Exclusion**: No clinical evidence of infection.\n-   **Biopsy Lesion Scores (Banff classification)**:\n    -   Interstitial inflammation: $i=2$ (inflammation in $26-50$% of cortical area).\n    -   Tubulitis: $t=2$ ($5-10$ mononuclear cells per tubular cross-section).\n    -   Intimal arteritis: $v=0$ (no intimal arteritis).\n    -   Glomerulitis: $g=1$ (glomerular inflammation in $25-75$% of glomeruli).\n    -   Peritubular capillaritis: $ptc=2$ ($>10$% of capillaries with $\\geq 3$ luminal cells).\n-   **Immunohistochemistry/Immunofluorescence**:\n    -   Complement component C4d is negative.\n-   **Serology**:\n    -   Presence of Human Leukocyte Antigen (HLA) class II donor-specific antibodies (DSA).\n-   **Chronicity Markers**:\n    -   No chronic glomerular double contours on light microscopy.\n    -   No electron microscopic evidence of duplicated glomerular basement membranes.\n    -   No other chronic scarring scores are elevated.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, rooted in the established field of transplant immunology and pathology. It utilizes the internationally standardized Banff classification for allograft pathology, a cornerstone of diagnosis and research in transplantation. The provided clinical scenario and histopathological scores represent a realistic and frequently encountered case in clinical practice. The language is precise and objective. The question is well-posed, providing all necessary information (histology scores, serology, and C4d status) to arrive at a diagnosis using the Banff criteria. The problem is self-contained and free of contradictions or ambiguities.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. A definitive solution can be derived by applying the Banff classification diagnostic criteria.\n\n**Derivation of Solution**\n\nThe objective is to determine the most accurate rejection phenotype by systematically evaluating the provided data against the formal Banff criteria for T-cell-mediated rejection (TCMR) and antibody-mediated rejection (ABMR).\n\n**1. Assessment for T-cell–mediated Rejection (TCMR)**\nThe diagnosis of acute TCMR relies on evidence of inflammation in the tubulointerstitium and arteries.\n-   **Acute TCMR Grade IA**: Requires significant interstitial inflammation ($i=2$ or $i=3$) and moderate tubulitis ($t=2$).\n    -   The given scores are $i=2$ and $t=2$.\n    -   These scores precisely meet the criteria for Acute TCMR, Grade IA.\n-   **Acute TCMR Grade IB**: Requires significant interstitial inflammation ($i=2$ or $i=3$) and severe tubulitis ($t=3$). This is not met.\n-   **Acute TCMR Grades II and III**: Require evidence of intimal arteritis ($v>0$).\n    -   The given score is $v=0$.\n    -   Therefore, higher grades of TCMR are excluded.\n\nBased on the scores $i=2$ and $t=2$, there is a clear diagnosis of **Acute TCMR, Grade IA**.\n\n**2. Assessment for Antibody-mediated Rejection (ABMR)**\nThe diagnosis of active ABMR requires that three criteria are met simultaneously:\n\n-   **Criterion 1: Histologic evidence of acute tissue injury.**\n    This includes one or more of the following:\n    -   Microvascular inflammation, defined as a sum of glomerulitis and peritubular capillaritis scores $(g + ptc) \\geq 2$.\n    -   Intimal or transmural arteritis ($v > 0$).\n    -   Acute thrombotic microangiopathy.\n    In this case, the scores are $g=1$ and $ptc=2$. The sum is $g + ptc = 1 + 2 = 3$.\n    Since $3 \\geq 2$, the criterion for significant microvascular inflammation is met.\n\n-   **Criterion 2: Evidence of current/recent antibody interaction with vascular endothelium.**\n    This includes one or more of the following:\n    -   Linear C4d staining in peritubular capillaries.\n    -   At least moderate microvascular inflammation ($g+ptc \\geq 2$), in the absence of C4d positivity.\n    -   Increased expression of gene transcripts indicative of endothelial injury (not provided, but not essential given the other findings).\n    The problem states that C4d staining is negative. However, the microvascular inflammation score is $g+ptc=3$, which is $\\geq 2$. According to the Banff criteria, this level of inflammation is sufficient to meet Criterion 2 even when C4d is negative. This is the definition of **$C4d$-negative ABMR**.\n\n-   **Criterion 3: Serologic evidence of circulating donor-specific antibodies (DSA).**\n    The problem explicitly states that HLA class II DSAs are detected. This criterion is met.\n\nSince all three criteria are satisfied, there is a concurrent diagnosis of **Active Antibody-Mediated Rejection, C4d-negative**.\n\n**3. Assessment for Chronic Rejection**\nThe diagnosis of chronic active ABMR requires evidence of chronic tissue injury, primarily transplant glomerulopathy (TG), which is defined pathologically by glomerular basement membrane duplication (double contours), scored as $cg > 0$.\n-   The problem explicitly states there are \"no chronic glomerular double contours on light microscopy and no electron microscopic evidence of duplicated glomerular basement membranes\" and \"no other chronic scarring scores are elevated.\"\n-   This means $cg=0$ and other chronicity scores are absent.\n-   Therefore, a diagnosis of chronic active ABMR is excluded. The process is entirely active.\n\n**Conclusion**\nThe recipient's biopsy fulfills the diagnostic criteria for both Acute TCMR, Grade IA, and Active ABMR, C4d-negative. When criteria for both rejection types are met in the same specimen, the diagnosis is **Mixed Rejection**.\n\n**Option-by-Option Analysis**\n\n-   **A. Acute T-cell–mediated rejection (TCMR), Banff grade IA, only**: **Incorrect**. This diagnosis is incomplete. While the criteria for TCMR are met, this option ignores the compelling evidence for concurrent ABMR: significant microvascular inflammation ($g+ptc=3$) in the presence of DSA.\n-   **B. Active antibody-mediated rejection (ABMR), C4d-negative, only**: **Incorrect**. This diagnosis is also incomplete. While the criteria for active $C4d$-negative ABMR are met, this option ignores the tubulointerstitial inflammation ($i=2$, $t=2$) that is diagnostic of TCMR Grade IA.\n-   **C. Mixed rejection: acute T-cell–mediated rejection (TCMR) Banff grade IA and active antibody-mediated rejection (ABMR), C4d-negative**: **Correct**. This is the most accurate and complete diagnosis, as it accounts for all the provided histopathological and serological findings. The biopsy shows clear, independent evidence for both cellular and humoral rejection pathways occurring simultaneously.\n-   **D. Chronic active antibody-mediated rejection (ABMR)**: **Incorrect**. The problem explicitly states the absence of chronic changes, particularly the lack of glomerular basement membrane duplication ($cg = 0$), which is a hallmark of chronic ABMR.\n-   **E. No rejection; borderline or nonspecific changes only**: **Incorrect**. The histopathological scores are not borderline. The combination of $i=2$ and $t=2$ is diagnostic for TCMR Grade IA. The combination of $g=1$, $ptc=2$, and positive DSA is diagnostic for active ABMR. These are definitive findings, not borderline or nonspecific.", "answer": "$$\\boxed{C}$$", "id": "2850468"}, {"introduction": "Clinical decisions in transplantation are rarely black and white; they are made by weighing probabilities based on imperfect information. This practice [@problem_id:2850452] introduces a fundamental tool for quantitative reasoning: Bayes' theorem. By calculating how a positive crossmatch result updates the initial risk of rejection, you will gain a deeper appreciation for how clinicians formally integrate new test data to refine a patient's prognosis and make more informed decisions.", "problem": "A kidney transplant candidate with a history of multiple pregnancies and prior sensitizing transfusions has a clinically estimated pretest probability of clinically significant preformed donor-specific alloantibody leading to antibody-mediated graft rejection (ABMR) in the immediate post-transplant period equal to $p_{0} = 0.30$. She undergoes a Flow Cytometric Crossmatch (FCXM) using donor T cells, which, for the purpose of detecting ABMR caused by preformed donor-specific antibody (DSA), has sensitivity $S_{e} = 0.93$ and specificity $S_{p} = 0.85$. The FCXM returns a positive result.\n\nStarting from the definitions of conditional probability, sensitivity, and specificity, and without assuming any unmentioned properties of the test or population, derive the expression for the post-test probability of ABMR given a positive FCXM and compute its numerical value. Express your final answer as a decimal (not a percentage), rounded to four significant figures.", "solution": "The problem as stated is subjected to validation.\n\nGivens are extracted verbatim:\n1.  Pretest probability of clinically significant preformed donor-specific alloantibody leading to antibody-mediated graft rejection (ABMR), $p_{0} = 0.30$.\n2.  Sensitivity of the Flow Cytometric Crossmatch (FCXM), $S_{e} = 0.93$.\n3.  Specificity of the FCXM, $S_{p} = 0.85$.\n4.  The FCXM result is positive.\n5.  Derive the expression for the post-test probability of ABMR given a positive FCXM.\n6.  Compute the numerical value, rounded to four significant figures.\n\nValidation proceeds:\nThe problem is scientifically grounded, utilizing standard principles of Bayesian inference as applied in medical diagnostics. The concepts of pretest probability (prevalence), sensitivity, and specificity are fundamental to biostatistics. The problem is well-posed, providing all necessary information to compute a unique post-test probability. The language is objective and precise. Therefore, the problem is deemed valid and a solution is warranted.\n\nWe begin by defining the events. Let $D$ be the event that the patient has the condition, which is the presence of clinically significant preformed donor-specific alloantibody leading to ABMR. Let $T^+$ be the event that the FCXM test returns a positive result. The complement of $D$, denoted $D^c$, is the event that the patient does not have the condition.\n\nThe problem provides the following probabilities:\nThe pretest probability, or prior probability, of having the condition is given as $p_{0}$.\n$$P(D) = p_{0} = 0.30$$\nFrom this, the probability of not having the condition is:\n$$P(D^c) = 1 - P(D) = 1 - p_{0} = 1 - 0.30 = 0.70$$\n\nThe sensitivity, $S_{e}$, is the probability of a positive test result given that the patient has the condition.\n$$S_{e} = P(T^{+} | D) = 0.93$$\nThe specificity, $S_{p}$, is the probability of a negative test result given that the patient does not have the condition.\n$$S_{p} = P(T^{-} | D^c) = 0.85$$\nFrom the definition of specificity, we can determine the probability of a positive test result given the patient does not have the condition (a false positive). This is the complement of specificity.\n$$P(T^{+} | D^c) = 1 - P(T^{-} | D^c) = 1 - S_{p} = 1 - 0.85 = 0.15$$\n\nThe objective is to find the post-test probability of having the condition given a positive test result, which is the conditional probability $P(D | T^{+})$. We derive this using the fundamental definition of conditional probability, which states:\n$$P(D | T^{+}) = \\frac{P(D \\cap T^{+})}{P(T^{+})}$$\nThe numerator, $P(D \\cap T^{+})$, is the joint probability of having the condition and testing positive. It can be rewritten using the multiplication rule of probability:\n$$P(D \\cap T^{+}) = P(T^{+} | D) P(D)$$\nThe denominator, $P(T^{+})$, is the total probability of obtaining a positive test result. We express this using the law of total probability, summing over all possible states of the condition (present or absent):\n$$P(T^{+}) = P(T^{+} | D) P(D) + P(T^{+} | D^c) P(D^c)$$\nSubstituting these expressions back into the formula for $P(D | T^{+})$ gives Bayes' theorem:\n$$P(D | T^{+}) = \\frac{P(T^{+} | D) P(D)}{P(T^{+} | D) P(D) + P(T^{+} | D^c) P(D^c)}$$\nThis is the required general expression. Now, we substitute the symbolic terms given in the problem statement: $p_{0}$, $S_{e}$, and $S_{p}$.\n$$P(D | T^{+}) = \\frac{S_{e} \\cdot p_{0}}{S_{e} \\cdot p_{0} + (1 - S_{p}) \\cdot (1 - p_{0})}$$\nThis is the derived analytical expression for the post-test probability.\n\nWe now proceed to compute the numerical value by substituting the given data:\n$$p_{0} = 0.30$$\n$$S_{e} = 0.93$$\n$$S_{p} = 0.85$$\nPlugging these values into our derived formula:\n$$P(D | T^{+}) = \\frac{0.93 \\cdot 0.30}{(0.93 \\cdot 0.30) + (1 - 0.85) \\cdot (1 - 0.30)}$$\nFirst, we compute the terms in the numerator and denominator.\nNumerator:\n$$S_{e} \\cdot p_{0} = 0.93 \\cdot 0.30 = 0.279$$\nDenominator:\n$$(S_{e} \\cdot p_{0}) + ((1 - S_{p}) \\cdot (1 - p_{0})) = (0.279) + (0.15 \\cdot 0.70)$$\n$$(S_{e} \\cdot p_{0}) + ((1 - S_{p}) \\cdot (1 - p_{0})) = 0.279 + 0.105 = 0.384$$\nFinally, we compute the ratio:\n$$P(D | T^{+}) = \\frac{0.279}{0.384}$$\n$$P(D | T^{+}) \\approx 0.7265625$$\nThe problem requires the answer to be rounded to four significant figures.\n$$P(D | T^{+}) \\approx 0.7266$$\nThus, the post-test probability of the patient having the condition that leads to ABMR, given the positive FCXM result, is approximately $0.7266$.", "answer": "$$\\boxed{0.7266}$$", "id": "2850452"}, {"introduction": "Graft rejection is not a static event but a dynamic process unfolding over days, months, or years, driven by complex feedback loops within the immune system. This advanced exercise [@problem_id:2850420] invites you to build a computational model that simulates the interplay between T cells, B cells, antibodies, and the graft. By manipulating key immune parameters, you can directly observe how the same underlying system can give rise to the distinct clinical trajectories of hyperacute, acute, and chronic rejection.", "problem": "You are to formalize and simulate a mechanistic ordinary differential equation model of graft rejection, starting from first principles of mass-action-like immune kinetics and clonal selection dynamics, to classify rejection trajectories as hyperacute, acute, or chronic. Your program must implement the system, integrate it over time, and return a discrete classification for each provided parameter set.\n\nModel states and interpretation:\n- $E(t)$: normalized graft alloantigen expression (dimensionless, range $0$ to $1$).\n- $T(t)$: activated effector T cell population (arbitrary normalized units, dimensionless).\n- $B(t)$: activated B cell/plasma cell population (arbitrary normalized units, dimensionless).\n- $A(t)$: donor-specific antibody titer (arbitrary normalized units, dimensionless).\n- $D(t)$: cumulative graft damage index (arbitrary normalized units, dimensionless).\n\nFundamental base and modeling assumptions:\n- Clonal selection and activation are driven by antigen recognition; activation rates saturate with antigen according to a Michaelis–Menten-like term $E/(K_E + E)$ and, for B cells, require T cell help via a saturating factor $T/(K_T + T)$.\n- Antibody and T cells mediate graft injury via interactions proportional to their levels and available antigen-bearing tissue. Tissue damage accumulates but is partially repaired at a rate proportional to existing damage (first-order repair), while chronic remodeling introduces a slow positive feedback that increases damage accumulation as $D$ grows.\n- Antigen availability declines due to natural turnover, antibody-mediated clearance of antigen-bearing endothelium, and T cell cytotoxicity, with rates proportional to $A E$ and $T E$ respectively.\n\nDynamics to implement:\nFor time $t$ in days, the model is:\n$$\n\\frac{dT}{dt} = s_T \\frac{E}{K_E + E} - d_T T,\n\\quad\n\\frac{dB}{dt} = s_B \\frac{E}{K_E + E} \\frac{T}{K_T + T} - d_B B,\n$$\n$$\n\\frac{dA}{dt} = p_A B - d_A A,\n\\quad\n\\frac{dE}{dt} = -k_{\\mathrm{clear}} A E - k_{\\mathrm{Tkill}} T E - k_{\\mathrm{base}} E,\n$$\n$$\n\\frac{dD}{dt} = q_T T E + q_A A E + \\alpha_{\\mathrm{remod}} D - r_{\\mathrm{repair}} D.\n$$\n\nInitial conditions and time horizon:\n- $E(0) = 1$,\n- $T(0) = 0$,\n- $B(0) = 0$,\n- $A(0) = A_0$ (specified per test case),\n- $D(0) = 0$.\nSimulate from $t = 0$ to $t_{\\max} = 200$ days.\n\nBase parameter values (per day where applicable):\n- $s_T = 0.8$, $s_B = 0.4$,\n- $K_E = 0.5$, $K_T = 0.5$,\n- $d_T = 0.3$, $d_B = 0.2$,\n- $p_A = 0.6$, $d_A = 0.1$,\n- $k_{\\mathrm{clear}} = 0.3$, $k_{\\mathrm{Tkill}} = 0.2$, $k_{\\mathrm{base}} = 0.01$,\n- $q_T = 0.05$, $q_A = 0.6$,\n- $r_{\\mathrm{repair}} = 0.01$, $\\alpha_{\\mathrm{remod}} = 0.002$.\n\nClassification rule:\n- Let $D_{\\mathrm{th}} = 1.0$ be the damage threshold for clinical rejection.\n- Define $t_{\\mathrm{cross}}$ as the earliest time $t$ such that $D(t) \\ge D_{\\mathrm{th}}$ within $[0, t_{\\max}]$.\n- If no such time exists in $[0, t_{\\max}]$, return $0$ (no rejection within the observation window).\n- If $t_{\\mathrm{cross}} &lt; 1$, return $1$ (hyperacute rejection).\n- If $1 \\le t_{\\mathrm{cross}} &lt; 30$, return $2$ (acute rejection).\n- If $30 \\le t_{\\mathrm{cross}} \\le 200$, return $3$ (chronic rejection).\n\nInstructions and units:\n- Time must be in days throughout the simulation. All rates are per day. The cumulative damage threshold $D_{\\mathrm{th}}$ is dimensionless. Your program should compute $t_{\\mathrm{cross}}$ in days and apply the classification rule above.\n\nTest suite (five parameter sets):\n- Case $1$ (Hyperacute with pre-formed donor-specific antibodies): overrides $A_0 = 3.0$.\n- Case $2$ (Acute cellular dominated): overrides $s_T = 1.2$, $q_T = 0.12$, $s_B = 0.2$, $A_0 = 0.0$.\n- Case $3$ (Chronic trajectory with slow remodeling): overrides $s_T = 0.2$, $s_B = 0.3$, $q_T = 0.02$, $q_A = 0.05$, $p_A = 0.15$, $d_A = 0.15$, $\\alpha_{\\mathrm{remod}} = 0.01$, $A_0 = 0.0$.\n- Case $4$ (Operational tolerance/no rejection): overrides $s_T = 0.08$, $s_B = 0.08$, $q_T = 0.005$, $q_A = 0.01$, $p_A = 0.3$, $r_{\\mathrm{repair}} = 0.05$, $k_{\\mathrm{base}} = 0.1$, $A_0 = 0.0$.\n- Case $5$ (Acute humoral dominated): overrides $s_B = 1.0$, $p_A = 0.8$, $s_T = 0.6$, $A_0 = 0.0$.\n\nAlgorithmic requirements:\n- Implement the system of ordinary differential equations and numerically integrate it over the interval $[0, 200]$ days for each parameter set.\n- Detect $t_{\\mathrm{cross}}$ and compute the classification integer according to the rule above.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\").\n\nYour final output must be a list of exactly five integers, corresponding to the five test cases in the order presented above.", "solution": "The problem has been analyzed and is determined to be valid.\n\n**1. Problem Validation**\n\nThe givens are extracted verbatim as required.\n\n**Givens:**\n- State variables: $E(t)$, $T(t)$, $B(t)$, $A(t)$, $D(t)$.\n- System of ordinary differential equations (ODEs):\n$$\n\\frac{dT}{dt} = s_T \\frac{E}{K_E + E} - d_T T\n$$\n$$\n\\frac{dB}{dt} = s_B \\frac{E}{K_E + E} \\frac{T}{K_T + T} - d_B B\n$$\n$$\n\\frac{dA}{dt} = p_A B - d_A A\n$$\n$$\n\\frac{dE}{dt} = -k_{\\mathrm{clear}} A E - k_{\\mathrm{Tkill}} T E - k_{\\mathrm{base}} E\n$$\n$$\n\\frac{dD}{dt} = q_T T E + q_A A E + \\alpha_{\\mathrm{remod}} D - r_{\\mathrm{repair}} D\n$$\n- Initial conditions: $E(0) = 1$, $T(0) = 0$, $B(0) = 0$, $A(0) = A_0$, $D(0) = 0$.\n- Time horizon: $t \\in [0, 200]$ days.\n- Base parameters:\n  - $s_T = 0.8$, $s_B = 0.4$\n  - $K_E = 0.5$, $K_T = 0.5$\n  - $d_T = 0.3$, $d_B = 0.2$\n  - $p_A = 0.6$, $d_A = 0.1$\n  - $k_{\\mathrm{clear}} = 0.3$, $k_{\\mathrm{Tkill}} = 0.2$, $k_{\\mathrm{base}} = 0.01$\n  - $q_T = 0.05$, $q_A = 0.6$\n  - $r_{\\mathrm{repair}} = 0.01$, $\\alpha_{\\mathrm{remod}} = 0.002$\n- Classification rule:\n  - Damage threshold $D_{\\mathrm{th}} = 1.0$.\n  - $t_{\\mathrm{cross}}$ is the earliest time $t$ such that $D(t) \\ge D_{\\mathrm{th}}$.\n  - No crossing in $[0, 200]$: return $0$.\n  - $t_{\\mathrm{cross}} < 1$: return $1$ (hyperacute).\n  - $1 \\le t_{\\mathrm{cross}} < 30$: return $2$ (acute).\n  - $30 \\le t_{\\mathrm{cross}} \\le 200$: return $3$ (chronic).\n- Test cases: $5$ sets of parameter overrides are provided.\n\n**Validation Verdict:**\nThe problem is scientifically grounded, well-posed, objective, and self-contained.\n- **Scientific Grounding**: The model is based on established principles of chemical and immune kinetics, specifically mass-action and Michaelis-Menten saturation, to represent clonal selection and effector function. This is a standard and plausible approach in mathematical immunology.\n- **Well-Posedness**: The problem defines a system of initial value problems for ordinary differential equations. The right-hand-side functions are continuous and locally Lipschitz, which guarantees existence and uniqueness of solutions. The classification criteria are unambiguous.\n- **Completeness and Consistency**: All necessary parameters, initial conditions, and rules are explicitly provided. The units (days, per day, dimensionless) are consistently applied throughout the model.\n- **No other flaws** as per the checklist are detected. The problem is a standard numerical simulation and analysis task, not trivial, and formalizable.\n\nThe problem is valid. A solution will be constructed.\n\n**2. Solution Methodology**\n\nThe core of the problem is to solve a system of $5$ coupled, nonlinear ordinary differential equations for $5$ different parameter sets and classify the resulting trajectories.\n\nThe state of the system at any time $t$ is represented by a vector $y(t) = [T(t), B(t), A(t), E(t), D(t)]^T$. The dynamics are given by $\\frac{dy}{dt} = f(t, y, P)$, where $f$ is the set of functions defined in the problem and $P$ is the set of parameters.\n\nThe numerical solution will be obtained by integrating this system over the time interval $[0, 200]$ days. For this purpose, we will use the `solve_ivp` function from the `scipy.integrate` library, which is a robust and adaptive ODE solver.\n\nFor each test case, the following steps are performed:\n1.  The base set of parameters is updated with the specific overrides for the current case.\n2.  The initial condition vector $y(0) = [T(0), B(0), A(0), E(0), D(0)]^T = [0, 0, A_0, 1, 0]$ is constructed, where $A_0$ is specified for the case.\n3.  The crucial step is to determine the time of rejection, $t_{\\mathrm{cross}}$, defined as the first time $t$ when the cumulative damage $D(t)$ reaches the threshold $D_{\\mathrm{th}} = 1.0$. The most accurate and efficient method to find this is to use the event detection capability of `solve_ivp`. An event function, $g(t, y) = D(t) - D_{\\mathrm{th}} = y_5(t) - 1.0$, is defined. The solver is configured to find the roots of this function where the value crosses from negative to positive.\n4.  The output of the solver will contain the time(s) at which the event occurred. If no event is detected within the simulation interval $[0, 200]$, it implies no rejection, and the classification is $0$.\n5.  If an event is detected, $t_{\\mathrm{cross}}$ is the first time recorded. This value is then used to classify the rejection type according to the provided rules:\n    - $t_{\\mathrm{cross}} < 1$ day: classification $1$ (hyperacute).\n    - $1 \\le t_{\\mathrm{cross}} < 30$ days: classification $2$ (acute).\n    - $30 \\le t_{\\mathrm{cross}} \\le 200$ days: classification $3$ (chronic).\n6.  This process is repeated for all five test cases, and the resulting integer classifications are collected. The final output is a list of these five integers.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the graft rejection ODE model for five test cases and classifies the outcomes.\n    \"\"\"\n    # Base parameter values as specified in the problem statement.\n    base_params = {\n        's_T': 0.8, 's_B': 0.4,\n        'K_E': 0.5, 'K_T': 0.5,\n        'd_T': 0.3, 'd_B': 0.2,\n        'p_A': 0.6, 'd_A': 0.1,\n        'k_clear': 0.3, 'k_Tkill': 0.2, 'k_base': 0.01,\n        'q_T': 0.05, 'q_A': 0.6,\n        'r_repair': 0.01, 'alpha_remod': 0.002,\n        'D_th': 1.0\n    }\n\n    # Test cases defined by their overrides to the base parameters.\n    test_cases = [\n        # Case 1 (Hyperacute)\n        {'A_0': 3.0},\n        # Case 2 (Acute cellular)\n        {'s_T': 1.2, 'q_T': 0.12, 's_B': 0.2, 'A_0': 0.0},\n        # Case 3 (Chronic)\n        {'s_T': 0.2, 's_B': 0.3, 'q_T': 0.02, 'q_A': 0.05, \n         'p_A': 0.15, 'd_A': 0.15, 'alpha_remod': 0.01, 'A_0': 0.0},\n        # Case 4 (No rejection)\n        {'s_T': 0.08, 's_B': 0.08, 'q_T': 0.005, 'q_A': 0.01, 'p_A': 0.3,\n         'r_repair': 0.05, 'k_base': 0.1, 'A_0': 0.0},\n        # Case 5 (Acute humoral)\n        {'s_B': 1.0, 'p_A': 0.8, 's_T': 0.6, 'A_0': 0.0}\n    ]\n\n    def ode_system(t, y, p):\n        \"\"\"\n        Defines the system of ordinary differential equations.\n        y is the state vector [T, B, A, E, D].\n        p is the dictionary of parameters.\n        \"\"\"\n        T, B, A, E, D = y\n        \n        # Ensure state variables remain non-negative, which they should naturally\n        # due to the model structure, but this is a safeguard.\n        T = max(0, T); B = max(0, B); A = max(0, A); E = max(0, E); D = max(0, D)\n\n        # Michaelis-Menten saturation terms\n        e_saturation = E / (p['K_E'] + E)\n        t_saturation = T / (p['K_T'] + T)\n\n        # Derivatives\n        dT_dt = p['s_T'] * e_saturation - p['d_T'] * T\n        dB_dt = p['s_B'] * e_saturation * t_saturation - p['d_B'] * B\n        dA_dt = p['p_A'] * B - p['d_A'] * A\n        # Antigen expression change includes a factor of E in all terms\n        dE_dt = (-p['k_clear'] * A - p['k_Tkill'] * T - p['k_base']) * E\n        # Damage dynamics\n        dD_dt = (p['q_T'] * T + p['q_A'] * A) * E + p['alpha_remod'] * D - p['r_repair'] * D\n\n        return [dT_dt, dB_dt, dA_dt, dE_dt, dD_dt]\n\n    def damage_threshold_event(t, y, p):\n        \"\"\"Event function to detect when damage D crosses the threshold D_th.\"\"\"\n        return y[4] - p['D_th']\n    \n    # Event should trigger when damage crosses D_th from below.\n    damage_threshold_event.direction = 1  \n    # Do not terminate integration upon event detection.\n    damage_threshold_event.terminal = False \n\n    results = []\n    \n    for case_config in test_cases:\n        # Create a parameter set for the current simulation\n        params = base_params.copy()\n        params.update(case_config)\n\n        # Initial conditions\n        A0 = params.pop('A_0', 0.0) # Extract A0 and remove from main params dict\n        y0 = [0.0, 0.0, A0, 1.0, 0.0]  # T, B, A, E, D\n\n        # Time span for the simulation\n        t_span = [0.0, 200.0]\n\n        # Numerically integrate the ODE system\n        sol = solve_ivp(\n            ode_system, \n            t_span, \n            y0, \n            args=(params,), \n            events=damage_threshold_event,\n            dense_output=True\n        )\n\n        t_cross = None\n        if sol.t_events[0].size > 0:\n            # The first time the threshold is crossed\n            t_cross = sol.t_events[0][0]\n\n        # Apply classification logic\n        if t_cross is None:\n            classification = 0  # No rejection\n        elif t_cross  1.0:\n            classification = 1  # Hyperacute\n        elif 1.0 = t_cross  30.0:\n            classification = 2  # Acute\n        else: # 30.0 = t_cross = 200.0\n            classification = 3  # Chronic\n\n        results.append(classification)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2850420"}]}