{"hands_on_practices": [{"introduction": "The exceptional polymorphism of Major Histocompatibility Complex (MHC) loci is thought to be driven by a tangible survival advantage. This exercise provides a quantitative framework to explore this advantage by modeling how MHC heterozygosity expands an individual's peptide presentation repertoire. By applying the principle of inclusion-exclusion to a simplified probabilistic model, you will calculate the fold-change in peptide presentation capacity, $\\mathcal{F} = P_{\\mathrm{het}}/P_{\\mathrm{hom}}$, when moving from a homozygous to a heterozygous state, revealing the diminishing but significant returns of increased allelic diversity.", "problem": "Human Leukocyte Antigen (HLA) class I molecules encoded within the Major Histocompatibility Complex (MHC) present intracellular peptides to cytotoxic T lymphocytes. Consider a model in which each distinct HLA class I allele presents a given random peptide with a small probability, reflecting its peptide-binding motif breadth. Let there be $3$ classical class I loci (HLA-A, HLA-B, HLA-C), and assume the following for a randomly sampled peptide from a large, well-mixed pool of potential $9$-mer peptides:\n(1) For a homozygous individual at a locus, there is effectively $1$ unique allele at that locus; for a heterozygous individual, there are $2$ distinct alleles at that locus.\n(2) For any single allele at locus $\\ell \\in \\{A,B,C\\}$, the probability of presenting the peptide is $p_{\\ell}$. Use $p_{A} = 0.010$, $p_{B} = 0.015$, and $p_{C} = 0.005$.\n(3) For two different alleles at the same locus, the probability that both present the same peptide equals $\\lambda_{\\mathrm{within}}\\,p_{\\ell}^{2}$, with $\\lambda_{\\mathrm{within}} = 1.4$. For two alleles from different loci $\\ell \\neq m$, the probability that both present the same peptide equals $\\lambda_{\\mathrm{between}}\\,p_{\\ell}\\,p_{m}$, with $\\lambda_{\\mathrm{between}} = 1.1$.\n(4) The events “allele $i$ presents the peptide” are rare and approximately independent beyond pairwise correlations captured by $\\lambda_{\\mathrm{within}}$ and $\\lambda_{\\mathrm{between}}$. You may approximate the probability that at least one allele presents the peptide by truncating the inclusion–exclusion expansion at second order in the $p_{\\ell}$.\n\nUsing only first principles of probability (the inclusion–exclusion principle for unions of rare events) and the assumptions above, compute the fold-change $\\mathcal{F}$ in the expected fraction of unique peptides presented when moving from a fully homozygous genotype at all $3$ loci (one unique allele at each of HLA-A, HLA-B, HLA-C) to a fully heterozygous genotype at all $3$ loci (two distinct alleles at each locus). That is, let $P_{\\mathrm{hom}}$ be the approximate probability a random peptide is presented by at least one allele in the homozygous case, and let $P_{\\mathrm{het}}$ be the corresponding probability in the heterozygous case; report $\\mathcal{F} = P_{\\mathrm{het}}/P_{\\mathrm{hom}}$. Round your final answer to $4$ significant figures.\n\nIn your reasoning, begin from the definition of the probability of a union of events and justify the second-order truncation. Explain how heterozygosity at a single locus expands its locus-level presentation probability and why, across loci, pairwise overlap leads to diminishing returns as more alleles are added. The final reported $\\mathcal{F}$ must be a single real number as specified above.", "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It is a valid exercise in applied probability theory, modeling a fundamental concept in immunogenetics. All necessary data and constraints for a unique solution are provided. We may therefore proceed with the derivation.\n\nThe core of this problem lies in calculating the probability of a union of events. Let $\\{E_i\\}_{i=1}^N$ be a set of $N$ events, where $E_i$ is the event that allele $i$ presents a given peptide. The probability that at least one of these alleles presents the peptide is the probability of their union, $P(\\cup_{i=1}^N E_i)$. The Principle of Inclusion-Exclusion (PIE) provides an exact formula for this probability:\n$$ P\\left(\\bigcup_{i=1}^N E_i\\right) = \\sum_{i=1}^N P(E_i) - \\sum_{1 \\le i < j \\le N} P(E_i \\cap E_j) + \\sum_{1 \\le i < j < k \\le N} P(E_i \\cap E_j \\cap E_k) - \\dots + (-1)^{N-1} P\\left(\\bigcap_{i=1}^N E_i\\right) $$\nThe problem specifies that the individual presentation probabilities, $p_{\\ell}$, are small, and that the events are \"rare.\" This justifies truncating the PIE series at the second-order term. The higher-order terms involve products of three or more small probabilities (e.g., $p_A p_B p_C$), which are negligible compared to the first-order ($p_\\ell$) and second-order ($p_\\ell p_m$) terms. The approximation is thus:\n$$ P\\left(\\bigcup_{i=1}^N E_i\\right) \\approx \\sum_{i=1}^N P(E_i) - \\sum_{1 \\le i < j \\le N} P(E_i \\cap E_j) $$\nThis approximation states that the total probability is the sum of individual probabilities, corrected for the pairwise overlaps to avoid double-counting.\n\nWe must compute this probability for two cases: a fully homozygous individual and a fully heterozygous individual.\n\nCase 1: Fully Homozygous Individual ($P_{\\mathrm{hom}}$)\nA fully homozygous individual has one unique allele at each of the three loci: HLA-A, HLA-B, and HLA-C. Let us denote these alleles as $A_1$, $B_1$, and $C_1$. The events of interest are $E_{A_1}$, $E_{B_1}$, and $E_{C_1}$. The probability that at least one allele presents the peptide is $P_{\\mathrm{hom}} = P(E_{A_1} \\cup E_{B_1} \\cup E_{C_1})$.\n\nApplying the second-order PIE approximation:\n$$ P_{\\mathrm{hom}} \\approx P(E_{A_1}) + P(E_{B_1}) + P(E_{C_1}) - \\left( P(E_{A_1} \\cap E_{B_1}) + P(E_{A_1} \\cap E_{C_1}) + P(E_{B_1} \\cap E_{C_1}) \\right) $$\nFrom the problem statement:\n- The first-order probabilities are $P(E_{A_1}) = p_A$, $P(E_{B_1}) = p_B$, and $P(E_{C_1}) = p_C$.\n- The second-order (intersection) probabilities involve alleles from different loci. Thus, we use the rule for between-loci interactions:\n$P(E_{A_1} \\cap E_{B_1}) = \\lambda_{\\mathrm{between}} p_A p_B$\n$P(E_{A_1} \\cap E_{C_1}) = \\lambda_{\\mathrm{between}} p_A p_C$\n$P(E_{B_1} \\cap E_{C_1}) = \\lambda_{\\mathrm{between}} p_B p_C$\n\nSubstituting these into the expression for $P_{\\mathrm{hom}}$:\n$$ P_{\\mathrm{hom}} \\approx (p_A + p_B + p_C) - \\lambda_{\\mathrm{between}}(p_A p_B + p_A p_C + p_B p_C) $$\n\nCase 2: Fully Heterozygous Individual ($P_{\\mathrm{het}}$)\nA fully heterozygous individual has two distinct alleles at each locus: $\\{A_1, A_2\\}$, $\\{B_1, B_2\\}$, and $\\{C_1, C_2\\}$. This gives a total of $N=6$ alleles. The probability that at least one allele presents the peptide is $P_{\\mathrm{het}} = P(E_{A_1} \\cup E_{A_2} \\cup E_{B_1} \\cup E_{B_2} \\cup E_{C_1} \\cup E_{C_2})$.\n\nApplying the second-order PIE approximation:\n$$ P_{\\mathrm{het}} \\approx \\sum_{i=1}^6 P(E_i) - \\sum_{1 \\le i < j \\le 6} P(E_i \\cap E_j) $$\nWe evaluate the two sums separately.\n\nThe sum of first-order probabilities:\n$$ \\sum P(E_i) = P(E_{A_1}) + P(E_{A_2}) + P(E_{B_1}) + P(E_{B_2}) + P(E_{C_1}) + P(E_{C_2}) $$\n$$ \\sum P(E_i) = p_A + p_A + p_B + p_B + p_C + p_C = 2(p_A + p_B + p_C) $$\nThis linear scaling demonstrates that doubling the number of alleles doubles the sum of their individual presentation probabilities.\n\nThe sum of second-order (pairwise) intersection probabilities:\nThis sum has $\\binom{6}{2}=15$ terms. We group them by the type of interaction.\n- **Within-locus pairs**: These are pairs of alleles from the same locus. There are $3$ such pairs: $(A_1, A_2)$, $(B_1, B_2)$, and $(C_1, C_2)$.\nThe sum of their intersection probabilities is:\n$P(E_{A_1} \\cap E_{A_2}) + P(E_{B_1} \\cap E_{B_2}) + P(E_{C_1} \\cap E_{C_2}) = \\lambda_{\\mathrm{within}}p_A^2 + \\lambda_{\\mathrm{within}}p_B^2 + \\lambda_{\\mathrm{within}}p_C^2 = \\lambda_{\\mathrm{within}}(p_A^2 + p_B^2 + p_C^2)$.\n- **Between-locus pairs**: These are pairs of alleles from different loci.\n    - Pairs between locus A and B: There are $2 \\times 2 = 4$ such pairs. For each, the intersection probability is $\\lambda_{\\mathrm{between}}p_A p_B$. The total contribution is $4\\lambda_{\\mathrm{between}}p_A p_B$.\n    - Pairs between locus A and C: Similarly, $4$ pairs with a total contribution of $4\\lambda_{\\mathrm{between}}p_A p_C$.\n    - Pairs between locus B and C: Similarly, $4$ pairs with a total contribution of $4\\lambda_{\\mathrm{between}}p_B p_C$.\nThe total sum for between-locus pairs is $4\\lambda_{\\mathrm{between}}(p_A p_B + p_A p_C + p_B p_C)$.\n\nCombining all second-order terms:\n$$ \\sum_{i < j} P(E_i \\cap E_j) = \\lambda_{\\mathrm{within}}(p_A^2 + p_B^2 + p_C^2) + 4\\lambda_{\\mathrm{between}}(p_A p_B + p_A p_C + p_B p_C) $$\n\nSubstituting the sums back into the expression for $P_{\\mathrm{het}}$:\n$$ P_{\\mathrm{het}} \\approx 2(p_A + p_B + p_C) - \\left[ \\lambda_{\\mathrm{within}}(p_A^2 + p_B^2 + p_C^2) + 4\\lambda_{\\mathrm{between}}(p_A p_B + p_A p_C + p_B p_C) \\right] $$\nThis expression reveals the \"diminishing returns\" of adding more alleles. While the first-order term doubles compared to the homozygous case, the subtractive second-order correction term grows more than quadratically (from $3$ pairwise terms to $15$), preventing the total probability from doubling. Heterozygosity at a locus (e.g., A) increases the locus-level probability from $p_A$ to $2p_A - \\lambda_{\\mathrm{within}}p_A^2$, which is less than $2p_A$ due to overlap in peptide recognition.\n\nCalculation of the Fold-Change $\\mathcal{F}$\nWe are given the values: $p_A = 0.010$, $p_B = 0.015$, $p_C = 0.005$, $\\lambda_{\\mathrm{within}} = 1.4$, and $\\lambda_{\\mathrm{between}} = 1.1$.\n\nFirst, calculate intermediate sums:\n- $S_1 = p_A + p_B + p_C = 0.010 + 0.015 + 0.005 = 0.030$\n- $S_{2,\\mathrm{cross}} = p_A p_B + p_A p_C + p_B p_C = (0.010)(0.015) + (0.010)(0.005) + (0.015)(0.005) = 0.00015 + 0.00005 + 0.000075 = 0.000275$\n- $S_{2,\\mathrm{sq}} = p_A^2 + p_B^2 + p_C^2 = (0.010)^2 + (0.015)^2 + (0.005)^2 = 0.0001 + 0.000225 + 0.000025 = 0.00035$\n\nNow compute $P_{\\mathrm{hom}}$:\n$$ P_{\\mathrm{hom}} \\approx S_1 - \\lambda_{\\mathrm{between}}S_{2,\\mathrm{cross}} = 0.030 - (1.1)(0.000275) = 0.030 - 0.0003025 = 0.0296975 $$\n\nNext, compute $P_{\\mathrm{het}}$:\n$$ P_{\\mathrm{het}} \\approx 2S_1 - \\left[ \\lambda_{\\mathrm{within}}S_{2,\\mathrm{sq}} + 4\\lambda_{\\mathrm{between}}S_{2,\\mathrm{cross}} \\right] $$\n$$ P_{\\mathrm{het}} \\approx 2(0.030) - \\left[ (1.4)(0.00035) + 4(1.1)(0.000275) \\right] $$\n$$ P_{\\mathrm{het}} \\approx 0.060 - \\left[ 0.00049 + 4(0.0003025) \\right] $$\n$$ P_{\\mathrm{het}} \\approx 0.060 - \\left[ 0.00049 + 0.00121 \\right] $$\n$$ P_{\\mathrm{het}} \\approx 0.060 - 0.0017 = 0.0583 $$\n\nFinally, compute the fold-change $\\mathcal{F}$:\n$$ \\mathcal{F} = \\frac{P_{\\mathrm{het}}}{P_{\\mathrm{hom}}} = \\frac{0.0583}{0.0296975} \\approx 1.963116... $$\nRounding to $4$ significant figures as required, we obtain $\\mathcal{F} = 1.963$.\nThis result quantifies the significant, though not doubled, immunological advantage conferred by MHC heterozygosity in terms of the breadth of the peptide repertoire that can be presented.", "answer": "$$ \\boxed{1.963} $$", "id": "2899414"}, {"introduction": "To uncover the evolutionary forces shaping MHC diversity, population geneticists test for deviations from neutral expectations. This practice challenges you to apply a foundational statistical tool, the Hardy–Weinberg exact test, to a hypothetical population's genotype data at the HLA-B locus. By deriving the conditional probability of observing a certain number of heterozygotes and calculating a precise $p$-value, you will learn how to formally assess whether observed genotype patterns are consistent with random mating or suggest the action of forces like selection or inbreeding.", "problem": "A molecular epidemiology study of the Major Histocompatibility Complex (MHC) in a small island population genotyped the Human Leukocyte Antigen (HLA)-B locus in $n$ unrelated diploid individuals under a biallelic aggregation scheme that collapses the many HLA-B alleles into two functionally distinct categories, denoted $B1$ and $B2$, based on shared peptide-binding motifs. Although HLA-B is highly polymorphic, this aggregation yields a tractable test of Hardy–Weinberg equilibrium (HWE), appropriate when evaluating deviations attributable to selection or assortative mating that act at the motif level. The data are: $n = 6$ individuals with observed genotype counts $B1/B1 = 3$, $B1/B2 = 1$, and $B2/B2 = 2$. The corresponding allele counts are $M_{B1} = 7$ and $M_{B2} = 5$ among $2n = 12$ gene copies.\n\nStarting from the random union of gametes model for HWE and conditioning on the observed total number of $B1$ alleles, $M_{B1} = M$, treat each allocation of the $M$ copies of the $B1$ allele among the $2n$ gene copies as equally likely under equilibrium. Derive from first principles the conditional probability mass function for the number of heterozygotes, $H$, in a sample of $n$ diploids given $M$ and $n$. Use this to compute the two-sided HWE exact $p$-value for the observed data, defined as the sum of conditional probabilities of all heterozygote counts $h$ whose conditional probability under HWE is less than or equal to that of the observed heterozygote count. Then briefly interpret whether any deviation (heterozygote deficiency or excess) is compatible with inbreeding or with selection at HLA-B.\n\nReport only the $p$-value as your final numerical answer, rounded to four significant figures. No units are required.", "solution": "The problem requires the validation of a dataset against Hardy-Weinberg equilibrium (HWE) using a conditional exact test, followed by an interpretation of the findings.\n\nFirst, the validity of the problem statement must be assessed.\n\n**Step 1: Extract Givens**\n- Sample size (number of diploid individuals): $n = 6$.\n- Allele categories at the HLA-B locus: $B1$ and $B2$.\n- Observed genotype counts: $3$ individuals of genotype $B1/B1$, $1$ individual of genotype $B1/B2$, and $2$ individuals of genotype $B2/B2$.\n- Observed allele counts: $M_{B1} = 7$ and $M_{B2} = 5$.\n- Total number of gene copies in the sample: $2n = 12$.\n- The test is to be conditioned on the observed total number of $B1$ alleles, $M \\equiv M_{B1} = 7$.\n- The model assumes that under the null hypothesis of HWE, each allocation of the $M$ copies of the $B1$ allele among the $2n$ gene copies is equally likely.\n- The two-sided $p$-value is defined as the sum of conditional probabilities of all possible heterozygote counts, $h$, for which the conditional probability is less than or equal to that of the observed heterozygote count.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is well-defined and scientifically grounded in the field of population genetics. The data provided are internally consistent: the total number of individuals is $3+1+2=6$, which matches $n=6$. The count of the $B1$ allele is $2 \\times (\\text{count of } B1/B1) + 1 \\times (\\text{count of } B1/B2) = 2 \\times 3 + 1 = 7$, matching $M_{B1}$. The count of the $B2$ allele is $2 \\times (\\text{count of } B2/B2) + 1 \\times (\\text{count of } B1/B2) = 2 \\times 2 + 1 = 5$, matching $M_{B2}$. The total number of alleles is $7+5=12$, which equals $2n$. The specified statistical procedure, the conditional exact test for HWE, is a standard method for analyzing genotype count data, especially with small sample sizes. The problem does not violate any scientific principles, is not incomplete or contradictory, and is posed objectively.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n**Derivation of the Conditional Probability Mass Function**\n\nLet $H$ be the random variable representing the number of heterozygotes ($B1/B2$) in a sample of $n$ individuals. We are asked to find the conditional probability mass function $P(H=h | n, M)$, where $n$ is the number of individuals and $M$ is the count of the $B1$ allele.\n\nUnder the null hypothesis of HWE, and conditioning on the observed allele counts, we consider all possible ways to arrange the $M$ copies of the $B1$ allele and the $2n-M$ copies of the $B2$ allele among the $2n$ available gene slots (two for each of the $n$ individuals). The total number of distinct arrangements of these alleles is given by the binomial coefficient for choosing the positions of the $M$ $B1$ alleles:\n$$ N_{total} = \\binom{2n}{M} $$\nThis constitutes the size of our sample space.\n\nNext, we must determine the number of these arrangements that result in exactly $h$ heterozygotes. Let this number be $N(H=h)$.\nAn individual is heterozygous if they possess one $B1$ and one $B2$ allele.\nFor a sample to contain exactly $h$ heterozygotes, the following must hold:\n1. We must choose $h$ individuals out of the total $n$ to be heterozygous. The number of ways to do this is $\\binom{n}{h}$.\n2. For each of these $h$ chosen individuals, one gene copy must be $B1$ and the other must be $B2$. For each individual, there are two gene slots. The $B1$ can be in the first slot and $B2$ in the second, or vice versa. Thus, for each heterozygous individual, there are $2$ ways to arrange the alleles. For $h$ such individuals, there are $2^h$ possible arrangements.\n3. The remaining $n-h$ individuals must be homozygous.\n4. The $h$ heterozygotes account for $h$ copies of the $B1$ allele and $h$ copies of the $B2$ allele. This leaves $M-h$ copies of $B1$ and $(2n-M)-h$ copies of $B2$ to be distributed among the $n-h$ homozygous individuals.\n5. The remaining $M-h$ copies of the $B1$ allele must form $\\frac{M-h}{2}$ homozygous $B1/B1$ individuals. For this to be an integer, $M$ and $h$ must have the same parity.\n6. The remaining $(2n-M)-h$ copies of the $B2$ allele must form $\\frac{2n-M-h}{2}$ homozygous $B2/B2$ individuals. For this to be an integer, $2n-M$ and $h$ must have the same parity, which is the same condition as the previous point.\n7. From the $n-h$ individuals designated as homozygous, we must select $\\frac{M-h}{2}$ of them to be $B1/B1$. The number of ways to do this is $\\binom{n-h}{(M-h)/2}$. The remaining $\\frac{2n-M-h}{2}$ individuals are then, by necessity, of genotype $B2/B2$.\n\nCombining these steps, the total number of arrangements corresponding to $h$ heterozygotes is the product of the number of ways for each step:\n$$ N(H=h) = \\binom{n}{h} \\binom{n-h}{\\frac{M-h}{2}} 2^h $$\nThe conditional probability of observing $h$ heterozygotes is the ratio of $N(H=h)$ to $N_{total}$:\n$$ P(H=h | n, M) = \\frac{\\binom{n}{h} \\binom{n-h}{(M-h)/2} 2^h}{\\binom{2n}{M}} $$\nThis is the required probability mass function, valid for values of $h$ where all terms are well-defined (i.e., arguments of binomial coefficients are non-negative integers and $h$ has the same parity as $M$).\n\n**Calculation of the p-value for the Observed Data**\n\nThe given data are: $n=6$, $M=7$, and the observed number of heterozygotes is $h_{obs}=1$. The total number of gene copies is $2n=12$.\nThe support of the distribution for $H$ is determined by the constraints: $0 \\le h \\le n=6$; $h \\le M=7$; $h \\le 2n-M=5$. Also, $h$ must have the same parity as $M=7$, so $h$ must be odd. Therefore, the possible values for $h$ are $\\{1, 3, 5\\}$.\n\nThe denominator of the PMF is:\n$$ \\binom{2n}{M} = \\binom{12}{7} = \\frac{12!}{7!5!} = \\frac{12 \\times 11 \\times 10 \\times 9 \\times 8}{5 \\times 4 \\times 3 \\times 2 \\times 1} = 792 $$\nNow we calculate the probability for each possible value of $h \\in \\{1, 3, 5\\}$.\n\nFor $h=1$:\n$$ P(H=1) = \\frac{\\binom{6}{1} \\binom{6-1}{(7-1)/2} 2^1}{\\binom{12}{7}} = \\frac{\\binom{6}{1} \\binom{5}{3} 2^1}{792} = \\frac{6 \\times 10 \\times 2}{792} = \\frac{120}{792} $$\n\nFor $h=3$:\n$$ P(H=3) = \\frac{\\binom{6}{3} \\binom{6-3}{(7-3)/2} 2^3}{\\binom{12}{7}} = \\frac{\\binom{6}{3} \\binom{3}{2} 2^3}{792} = \\frac{20 \\times 3 \\times 8}{792} = \\frac{480}{792} $$\n\nFor $h=5$:\n$$ P(H=5) = \\frac{\\binom{6}{5} \\binom{6-5}{(7-5)/2} 2^5}{\\binom{12}{7}} = \\frac{\\binom{6}{5} \\binom{1}{1} 2^5}{792} = \\frac{6 \\times 1 \\times 32}{792} = \\frac{192}{792} $$\nAs a check, the probabilities must sum to $1$: $\\frac{120+480+192}{792} = \\frac{792}{792} = 1$. The distribution is correct.\n\nThe observed heterozygote count is $h_{obs}=1$. The probability of this observation under the null hypothesis is $P(H=1) = 120/792$.\nThe two-sided $p$-value is the sum of probabilities of all outcomes that are as likely or less likely than the observed outcome. We compare the probabilities:\n$P(H=1) = 120/792$\n$P(H=3) = 480/792$\n$P(H=5) = 192/792$\nThe only outcome with probability less than or equal to $P(H=1)$ is $h=1$ itself.\nThus, the $p$-value is:\n$$ p\\text{-value} = P(H=1) = \\frac{120}{792} = \\frac{5}{33} $$\nConverting to a decimal, $5 \\div 33 \\approx 0.151515...$.\nRounding to four significant figures gives $0.1515$.\n\n**Interpretation**\nThe expected number of heterozygotes under HWE is $E[H] = \\sum h P(H=h) = 1(\\frac{120}{792}) + 3(\\frac{480}{792}) + 5(\\frac{192}{792}) = \\frac{120 + 1440 + 960}{792} = \\frac{2520}{792} = \\frac{35}{11} \\approx 3.18$.\nThe observed count of $h_{obs}=1$ is substantially lower than the expected count, indicating a heterozygote deficiency. Such a deficiency can be caused by several factors, including inbreeding (which increases homozygosity) or selection against heterozygotes (underdominance). While heterozygote advantage (balancing selection) is typically expected at HLA loci, the data points towards an opposing trend. However, the calculated $p$-value of $0.1515$ is greater than the conventional significance threshold of $0.05$. Therefore, despite the apparent heterozygote deficiency, the observed data are not statistically inconsistent with the null hypothesis of Hardy-Weinberg equilibrium. The deviation can plausibly be attributed to random sampling variation in this small sample.", "answer": "$$\\boxed{0.1515}$$", "id": "2899450"}, {"introduction": "The maintenance of MHC polymorphism is an active, dynamic process, often attributed to balancing selection from co-evolving pathogens. This computational exercise allows you to model this phenomenon directly by simulating allele frequency dynamics under time-varying selection pressures. You will implement a discrete-time model to track the trajectory of an allele frequency, $p_t$, and apply the principles of invasion analysis to determine the conditions under which fluctuating selection leads to a stable, protected polymorphism.", "problem": "Consider a single-locus, two-allele ($A$ and $a$), diploid population with random mating in discrete, non-overlapping generations. Genotype-specific viabilities vary over time due to pathogen turnover modeled as a periodic environmental sequence. Let $p_t$ be the frequency of allele $A$ after selection at generation $t$. Assume Hardy–Weinberg proportions before selection each generation. If in generation $t$ the environment is $e_t$ with genotype viabilities $w_{AA}(t)$, $w_{Aa}(t)$, and $w_{aa}(t)$, then the standard discrete-time viability-selection update holds:\n$$\n\\bar{w}_t \\equiv p_t^2\\,w_{AA}(t) + 2\\,p_t\\,(1-p_t)\\,w_{Aa}(t) + (1-p_t)^2\\,w_{aa}(t),\n$$\n$$\np_{t+1} \\;=\\; \\frac{p_t^2\\,w_{AA}(t) + p_t\\,(1-p_t)\\,w_{Aa}(t)}{\\bar{w}_t}.\n$$\n\nAssume time-heterogeneous selection induced by pathogen turnover is periodic with period $L$, so that $e_{t+L}=e_t$ and $w_{XY}(t+L)=w_{XY}(t)$ for $XY\\in\\{AA,Aa,aa\\}$. A protected polymorphism is said to persist if, in the deterministic model, each allele increases in frequency when rare over one full period of environmental change. Under the assumption that when an allele is rare almost all copies are in heterozygotes, the invasion multiplier for allele $A$ when rare across one period is\n$$\nG_A \\;=\\; \\prod_{k=0}^{L-1} \\frac{w_{Aa}(k)}{w_{aa}(k)},\n$$\nand for allele $a$ when rare is\n$$\nG_a \\;=\\; \\prod_{k=0}^{L-1} \\frac{w_{Aa}(k)}{w_{AA}(k)}.\n$$\nA sufficient and necessary condition for a protected polymorphism in this periodic, deterministic setting is $G_A > 1$ and $G_a > 1$.\n\nTask: Write a complete program that, for each test case below, performs both of the following:\n- Predicts the trajectory of $p_t$ using the discrete-time update for $T$ generations given initial frequency $p_0$ and the specified environment schedule, and reports $p_T$ rounded to $6$ decimal places.\n- Determines whether a protected polymorphism persists by evaluating the strict inequalities $G_A > 1$ and $G_a > 1$ over one full period; report this as an integer, with $1$ indicating a protected polymorphism and $0$ otherwise.\n\nImportant implementation details:\n- The environmental schedule is periodic and given as an ordered list of distinct environmental states. One step in time advances to the next state in the list, and after the last state, the sequence repeats from the beginning.\n- All genotype viabilities are strictly positive real numbers.\n- For numerical stability, you may treat strict inequalities with a tolerance $\\varepsilon = 10^{-12}$; that is, test $G_A > 1 + \\varepsilon$ and $G_a > 1 + \\varepsilon$.\n- There are no physical units in this problem.\n- Angles and percentages do not appear in this problem.\n\nTest suite (four cases), each specified by its period-$L$ environment list, initial frequency $p_0$, and generation count $T$:\n- Case $1$ (temporal variation without per-state heterozygote advantage): period $L=2$ with\n  - Environment $E_1$: $(w_{AA}, w_{Aa}, w_{aa}) = (0.9, 1.0, 1.1)$,\n  - Environment $E_2$: $(w_{AA}, w_{Aa}, w_{aa}) = (1.1, 1.0, 0.9)$.\n  Use $p_0 = 0.2$ and $T = 100$.\n- Case $2$ (neutral boundary case): period $L=1$ with\n  - Environment $E$: $(w_{AA}, w_{Aa}, w_{aa}) = (1.0, 1.0, 1.0)$.\n  Use $p_0 = 0.3$ and $T = 100$.\n- Case $3$ (directional selection favoring $A$ over the full cycle): period $L=3$ with\n  - Environment $E_1$: $(w_{AA}, w_{Aa}, w_{aa}) = (1.2, 1.05, 0.8)$,\n  - Environment $E_2$: $(w_{AA}, w_{Aa}, w_{aa}) = (1.1, 1.0, 0.9)$,\n  - Environment $E_3$: $(w_{AA}, w_{Aa}, w_{aa}) = (1.3, 1.05, 0.7)$.\n  Use $p_0 = 0.4$ and $T = 100$.\n- Case $4$ (overdominance across all states): period $L=2$ with\n  - Environment $E_1$: $(w_{AA}, w_{Aa}, w_{aa}) = (0.9, 1.2, 0.8)$,\n  - Environment $E_2$: $(w_{AA}, w_{Aa}, w_{aa}) = (0.8, 1.2, 0.9)$.\n  Use $p_0 = 0.01$ and $T = 80$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the four cases as a comma-separated list enclosed in square brackets. Each case’s result must itself be a two-element list formatted as $[p_T,flag]$, where $p_T$ is rounded to $6$ decimal places and $flag$ is either $1$ or $0$. Do not include any spaces anywhere in the output.\n- For example, the overall format must be\n  $[[p_{T,1},flag_1],[p_{T,2},flag_2],[p_{T,3},flag_3],[p_{T,4},flag_4]]$.", "solution": "The problem statement presented is a standard exercise in theoretical population genetics, concerning the dynamics of a single diploid locus with two alleles under temporally fluctuating viability selection. All provided equations, definitions, and parameters are internally consistent and grounded in established scientific principles. The model is a canonical representation of selection in a periodic environment, and the conditions for a protected polymorphism via invasion analysis are correct. The problem is therefore deemed valid, well-posed, and scientifically sound. I will proceed with a full solution.\n\nThe solution requires two distinct computations for each test case: a determination of long-term stability and a direct simulation of the system's trajectory.\n\nFirst, we analyze the condition for a protected polymorphism. This condition ensures that both alleles, $A$ and $a$, will increase in frequency when they are rare, thus preventing their loss from the population and maintaining genetic diversity. The analysis relies on linearizing the dynamics at the boundaries of the state space, where one allele is nearly fixed (e.g., $p_t \\to 0$ or $p_t \\to 1$). The growth rate of a rare allele over one full environmental cycle of length $L$ is given by its invasion multiplier.\n\nFor allele $A$ to invade a population of $aa$ individuals, its geometric mean fitness, assessed when it appears in heterozygotes ($Aa$), must exceed the geometric mean fitness of the resident homozygotes ($aa$) over the cycle. The per-generation growth factor when $A$ is rare ($p_t \\to 0$) is approximately $\\lambda_A(t) = w_{Aa}(t) / w_{aa}(t)$. The invasion multiplier over one cycle is the product of these growth factors:\n$$\nG_A = \\prod_{k=0}^{L-1} \\lambda_A(k) = \\prod_{k=0}^{L-1} \\frac{w_{Aa}(k)}{w_{aa}(k)}\n$$\nSymmetrically, for allele $a$ to invade a population of $AA$ individuals, its invasion multiplier $G_a$ must be greater than one:\n$$\nG_a = \\prod_{k=0}^{L-1} \\lambda_a(k) = \\prod_{k=0}^{L-1} \\frac{w_{Aa}(k)}{w_{AA}(k)}\n$$\nA protected polymorphism is maintained if and only if both alleles can invade when rare, which translates to the conditions $G_A > 1$ and $G_a > 1$. The problem specifies using a numerical tolerance $\\varepsilon = 10^{-12}$ for this strict inequality. The algorithm will compute these two products and check if both $G_A > 1 + \\varepsilon$ and $G_a > 1 + \\varepsilon$ are satisfied, setting a binary flag accordingly.\n\nSecond, we must compute the allele frequency trajectory for $T$ generations. This is a direct numerical simulation of the discrete-time dynamical system. Given the frequency of allele $A$ as $p_t$ before the selection of generation $t$, the zygotic genotype frequencies under random mating are given by Hardy-Weinberg proportions: $p_t^2$ for $AA$, $2p_t(1-p_t)$ for $Aa$, and $(1-p_t)^2$ for $aa$. After selection with genotype-specific viabilities $w_{AA}(t)$, $w_{Aa}(t)$, and $w_{aa}(t)$, the frequency of allele $A$ in the next generation, $p_{t+1}$, is given by the recurrence relation:\n$$\np_{t+1} = \\frac{p_t^2 w_{AA}(t) + p_t(1-p_t)w_{Aa}(t)}{p_t^2 w_{AA}(t) + 2p_t(1-p_t)w_{Aa}(t) + (1-p_t)^2w_{aa}(t)}\n$$\nThe viabilities $w_{XY}(t)$ are determined by the environmental state at generation $t$, which follows a periodic schedule of length $L$. The environment at generation $t$ corresponds to state $k = t \\pmod L$.\n\nThe algorithm for this part is as follows:\n1. Initialize the allele frequency with the given value $p_0$.\n2. Iterate for $t$ from $0$ to $T-1$.\n3. In each generation $t$, determine the environmental state $k = t \\pmod L$ and retrieve the corresponding viabilities $\\{w_{AA}(k), w_{Aa}(k), w_{aa}(k)\\}$.\n4. Substitute the current allele frequency $p_t$ and the viabilities into the recurrence relation to compute $p_{t+1}$.\n5. Update the frequency: $p_t \\leftarrow p_{t+1}$.\n6. After $T$ iterations, the final frequency is $p_T$. This value is to be reported, rounded to six decimal places.\n\nThe implementation will process each test case by performing these two calculations and formatting the results as specified. All floating-point arithmetic will be performed using $64$-bit precision to ensure numerical accuracy.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the population genetics problem for a series of test cases.\n    For each case, it determines if a protected polymorphism persists and\n    simulates the allele frequency trajectory.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Temporal variation without per-state heterozygote advantage\n        {\n            \"L\": 2,\n            \"environments\": [(0.9, 1.0, 1.1), (1.1, 1.0, 0.9)],\n            \"p0\": 0.2,\n            \"T\": 100\n        },\n        # Case 2: Neutral boundary case\n        {\n            \"L\": 1,\n            \"environments\": [(1.0, 1.0, 1.0)],\n            \"p0\": 0.3,\n            \"T\": 100\n        },\n        # Case 3: Directional selection favoring A over the full cycle\n        {\n            \"L\": 3,\n            \"environments\": [(1.2, 1.05, 0.8), (1.1, 1.0, 0.9), (1.3, 1.05, 0.7)],\n            \"p0\": 0.4,\n            \"T\": 100\n        },\n        # Case 4: Overdominance across all states\n        {\n            \"L\": 2,\n            \"environments\": [(0.9, 1.2, 0.8), (0.8, 1.2, 0.9)],\n            \"p0\": 0.01,\n            \"T\": 80\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        p0 = case[\"p0\"]\n        T = case[\"T\"]\n        L = case[\"L\"]\n        environments = case[\"environments\"]\n        epsilon = 1e-12\n\n        # Part 1: Determine if a protected polymorphism persists.\n        # This requires calculating the invasion multipliers G_A and G_a.\n        ratios_A = [np.float64(env[1]) / np.float64(env[2]) for env in environments]\n        G_A = np.prod(ratios_A)\n        \n        ratios_a = [np.float64(env[1]) / np.float64(env[0]) for env in environments]\n        G_a = np.prod(ratios_a)\n\n        polymorphism_flag = 1 if (G_A > 1.0 + epsilon and G_a > 1.0 + epsilon) else 0\n\n        # Part 2: Predict the trajectory of p_t using discrete-time updates.\n        p_t = np.float64(p0)\n        \n        for t in range(T):\n            env_idx = t % L\n            w_AA, w_Aa, w_aa = environments[env_idx]\n            \n            w_AA_np, w_Aa_np, w_aa_np = np.float64(w_AA), np.float64(w_Aa), np.float64(w_aa)\n            \n            # Calculate mean fitness (w_bar).\n            p_t_sq = p_t * p_t\n            one_minus_p = 1.0 - p_t\n            w_bar = p_t_sq * w_AA_np + 2.0 * p_t * one_minus_p * w_Aa_np + one_minus_p * one_minus_p * w_aa_np\n            \n            # Update allele frequency p_{t+1}.\n            if w_bar == 0.0:\n                # This case is not expected as viabilities are strictly positive.\n                # If it occurred, the frequency would not change.\n                p_t = p_t\n            else:\n                numerator = p_t_sq * w_AA_np + p_t * one_minus_p * w_Aa_np\n                p_t = numerator / w_bar\n        \n        p_T = p_t\n        \n        # Format the result string for the current case.\n        # The p_T:.6f format specifier rounds the value to 6 decimal places.\n        result_str = f\"[{p_T:.6f},{polymorphism_flag}]\"\n        results.append(result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2899427"}]}