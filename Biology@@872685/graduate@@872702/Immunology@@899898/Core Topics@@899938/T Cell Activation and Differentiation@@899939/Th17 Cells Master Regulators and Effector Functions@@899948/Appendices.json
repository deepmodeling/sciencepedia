{"hands_on_practices": [{"introduction": "To truly understand the Th17 lineage, we must begin at the heart of its regulatory network: the cytokine signaling that triggers differentiation. This exercise explores the dynamics of the critical Interleukin-6 (IL-6) signaling pathway, where the phosphorylation of the transcription factor STAT3 is controlled by a negative feedback loop involving SOCS3. By modeling this system with ordinary differential equations and solving for its steady state, you will gain a quantitative appreciation for how a cell interprets a constant stimulus to establish a stable internal state, a foundational step in lineage commitment [@problem_id:2896006].", "problem": "T helper 17 (Th17) lineage commitment depends on interleukin-6 (IL-6)–driven phosphorylation of Signal Transducer and Activator of Transcription 3 (STAT3), with negative feedback through Suppressor of Cytokine Signaling 3 (SOCS3). Consider a well-mixed Th17-primed cell population under constant IL-6 stimulation in which the following lumped-parameter mass-action ordinary differential equations model the dynamics of phosphorylated STAT3 and SOCS3 concentrations. Let $P(t)$ denote phosphorylated STAT3 (pSTAT3) concentration, $C(t)$ denote SOCS3 concentration, and $T_{\\mathrm{tot}}$ denote the conserved total STAT3 concentration. The governing equations are\n$$\n\\frac{dP}{dt} \\;=\\; k_{p}\\, I \\,\\bigl(T_{\\mathrm{tot}} - P\\bigr) \\;-\\; \\Bigl(k_{d} \\;+\\; k_{s}\\, C\\Bigr)\\, P,\n$$\n$$\n\\frac{dC}{dt} \\;=\\; k_{b} \\;+\\; k_{sp}\\, P \\;-\\; k_{deg}\\, C,\n$$\nwhere $I$ is the constant IL-6 concentration. The first equation represents IL-6–dependent phosphorylation of nonphosphorylated STAT3 balanced by dephosphorylation and SOCS3-mediated inhibition; the second represents SOCS3 production with a basal term and pSTAT3-induced term balanced by degradation. Assume the following parameter values, which are physiologically plausible for an in vitro Th17 polarization assay:\n- $I = 5 \\ \\mathrm{nM}$,\n- $T_{\\mathrm{tot}} = 100 \\ \\mathrm{nM}$,\n- $k_{p} = 0.02 \\ \\mathrm{nM}^{-1}\\,\\mathrm{min}^{-1}$,\n- $k_{d} = 0.05 \\ \\mathrm{min}^{-1}$,\n- $k_{s} = 0.02 \\ \\mathrm{nM}^{-1}\\,\\mathrm{min}^{-1}$,\n- $k_{b} = 0.5 \\ \\mathrm{nM}\\,\\mathrm{min}^{-1}$,\n- $k_{sp} = 0.5 \\ \\mathrm{min}^{-1}$,\n- $k_{deg} = 0.1 \\ \\mathrm{min}^{-1}$.\n\nStarting from core definitions of mass-action signaling kinetics and the steady-state concept for ordinary differential equations, derive an explicit expression for the steady-state concentration $P^{\\ast}$ of phosphorylated STAT3 in terms of the given parameters, and then compute its numerical value for the specified parameter set. Express your final answer as a single number in nanomolar, and round your answer to four significant figures.", "solution": "The problem provides a system of two coupled ordinary differential equations describing the dynamics of phosphorylated STAT3, denoted by $P(t)$, and SOCS3, denoted by $C(t)$. Our objective is to determine the steady-state concentration of phosphorylated STAT3, which we will call $P^{\\ast}$.\n\nThe governing equations are:\n$$\n\\frac{dP}{dt} = k_{p}\\, I \\,(T_{\\mathrm{tot}} - P) - (k_{d} + k_{s}\\, C)\\, P\n$$\n$$\n\\frac{dC}{dt} = k_{b} + k_{sp}\\, P - k_{deg}\\, C\n$$\n\nThe steady state of a dynamical system is defined as the state where all time derivatives are equal to zero. This corresponds to the point where the concentrations of all species no longer change over time. Therefore, we must set $\\frac{dP}{dt} = 0$ and $\\frac{dC}{dt} = 0$. Let $P^{\\ast}$ and $C^{\\ast}$ be the concentrations at steady state. The system of differential equations reduces to a system of algebraic equations:\n$$\n0 = k_{p}\\, I \\,(T_{\\mathrm{tot}} - P^{\\ast}) - (k_{d} + k_{s}\\, C^{\\ast})\\, P^{\\ast} \\quad (1)\n$$\n$$\n0 = k_{b} + k_{sp}\\, P^{\\ast} - k_{deg}\\, C^{\\ast} \\quad (2)\n$$\n\nWe can solve this system to find an explicit expression for $P^{\\ast}$. First, we isolate $C^{\\ast}$ from equation $(2)$:\n$$\nk_{deg}\\, C^{\\ast} = k_{b} + k_{sp}\\, P^{\\ast}\n$$\n$$\nC^{\\ast} = \\frac{k_{b} + k_{sp}\\, P^{\\ast}}{k_{deg}}\n$$\nThis expression relates the steady-state concentration of SOCS3 directly to the steady-state concentration of phosphorylated STAT3.\n\nNext, we substitute this expression for $C^{\\ast}$ into equation $(1)$. This eliminates $C^{\\ast}$ and yields a single equation in terms of $P^{\\ast}$:\n$$\n0 = k_{p}\\, I \\,(T_{\\mathrm{tot}} - P^{\\ast}) - \\left( k_{d} + k_{s} \\left( \\frac{k_{b} + k_{sp}\\, P^{\\ast}}{k_{deg}} \\right) \\right) P^{\\ast}\n$$\n\nTo derive the explicit expression for $P^{\\ast}$, we must rearrange this equation into a standard polynomial form. We expand the terms:\n$$\n0 = k_{p}\\, I \\,T_{\\mathrm{tot}} - k_{p}\\, I \\,P^{\\ast} - k_{d}\\, P^{\\ast} - \\frac{k_{s}}{k_{deg}} (k_{b} + k_{sp}\\, P^{\\ast}) P^{\\ast}\n$$\n$$\n0 = k_{p}\\, I \\,T_{\\mathrm{tot}} - (k_{p}\\, I + k_{d})\\, P^{\\ast} - \\frac{k_{s} k_{b}}{k_{deg}}\\, P^{\\ast} - \\frac{k_{s} k_{sp}}{k_{deg}}\\, (P^{\\ast})^{2}\n$$\n\nWe group the terms by powers of $P^{\\ast}$ to form a quadratic equation of the form $a(P^{\\ast})^{2} + bP^{\\ast} + c = 0$:\n$$\n\\left(\\frac{k_{s} k_{sp}}{k_{deg}}\\right) (P^{\\ast})^{2} + \\left(k_{p}\\, I + k_{d} + \\frac{k_{s} k_{b}}{k_{deg}}\\right) P^{\\ast} - k_{p}\\, I \\,T_{\\mathrm{tot}} = 0\n$$\n\nThe coefficients of this quadratic equation are:\n$a = \\frac{k_{s} k_{sp}}{k_{deg}}$\n$b = k_{p}\\, I + k_{d} + \\frac{k_{s} k_{b}}{k_{deg}}$\n$c = -k_{p}\\, I \\,T_{\\mathrm{tot}}$\n\nThe solution for $P^{\\ast}$ is given by the quadratic formula:\n$$\nP^{\\ast} = \\frac{-b \\pm \\sqrt{b^{2} - 4ac}}{2a}\n$$\nSince all parameters ($k$'s, $I$, $T_{\\mathrm{tot}}$) are physically defined as positive quantities, the coefficients $a$ and $b$ are positive, while the coefficient $c$ is negative. The term under the square root, the discriminant $\\Delta = b^{2} - 4ac$, is therefore guaranteed to be positive ($b^{2} > 0$ and $-4ac > 0$), ensuring two distinct real roots.\n\nThe two roots are $P^{\\ast}_{1} = \\frac{-b + \\sqrt{b^{2} - 4ac}}{2a}$ and $P^{\\ast}_{2} = \\frac{-b - \\sqrt{b^{2} - 4ac}}{2a}$. Since $P^{\\ast}$ represents a concentration, it must be a non-negative quantity. As $a>0$ and $b>0$, the second root $P^{\\ast}_{2}$ is unambiguously negative and therefore physically meaningless. The only valid solution is the positive root:\n$$\nP^{\\ast} = \\frac{-b + \\sqrt{b^{2} - 4ac}}{2a}\n$$\nSubstituting the expressions for $a$, $b$, and $c$, we arrive at the explicit symbolic expression for $P^{\\ast}$:\n$$\nP^{\\ast} = \\frac{-\\left(k_{p} I + k_{d} + \\frac{k_{s} k_{b}}{k_{deg}}\\right) + \\sqrt{\\left(k_{p} I + k_{d} + \\frac{k_{s} k_{b}}{k_{deg}}\\right)^{2} + 4\\left(\\frac{k_{s} k_{sp}}{k_{deg}}\\right)(k_{p} I T_{\\mathrm{tot}})}}{2\\left(\\frac{k_{s} k_{sp}}{k_{deg}}\\right)}\n$$\n\nNow, we compute the numerical value by substituting the given parameter values:\n$I = 5$\n$T_{\\mathrm{tot}} = 100$\n$k_{p} = 0.02$\n$k_{d} = 0.05$\n$k_{s} = 0.02$\n$k_{b} = 0.5$\n$k_{sp} = 0.5$\n$k_{deg} = 0.1$\n\nFirst, calculate the numerical values of the coefficients $a$, $b$, and $c$:\n$a = \\frac{(0.02)(0.5)}{0.1} = \\frac{0.01}{0.1} = 0.1$\n$b = (0.02)(5) + 0.05 + \\frac{(0.02)(0.5)}{0.1} = 0.1 + 0.05 + 0.1 = 0.25$\n$c = -(0.02)(5)(100) = -(0.1)(100) = -10$\n\nThe quadratic equation for $P^{\\ast}$ is:\n$$\n0.1 (P^{\\ast})^{2} + 0.25 P^{\\ast} - 10 = 0\n$$\n\nUsing the quadratic formula for the physically relevant root:\n$$\nP^{\\ast} = \\frac{-0.25 + \\sqrt{(0.25)^{2} - 4(0.1)(-10)}}{2(0.1)}\n$$\n$$\nP^{\\ast} = \\frac{-0.25 + \\sqrt{0.0625 + 4}}{0.2}\n$$\n$$\nP^{\\ast} = \\frac{-0.25 + \\sqrt{4.0625}}{0.2}\n$$\n$$\nP^{\\ast} \\approx \\frac{-0.25 + 2.0155644}{0.2} = \\frac{1.7655644}{0.2} \\approx 8.827822\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\nP^{\\ast} \\approx 8.828\n$$\nThe unit of concentration is nanomolar (nM), consistent with the units of the given parameters.", "answer": "$$\n\\boxed{8.828}\n$$", "id": "2896006"}, {"introduction": "Moving from a model of a single pathway to the complexity of a whole cell, this exercise tackles the practical challenge of identifying Th17 cells within a mixed population using high-throughput data. This computational problem simulates the analysis of single-cell gene expression measurements, a cornerstone of modern immunology, where you will apply your knowledge of lineage-defining genes like $RORC$ and $IL17A$. You will develop a rule-based classification algorithm and, critically, learn to estimate its reliability by calculating a false discovery rate, providing hands-on experience with the bioinformatic and statistical methods used to navigate large biological datasets [@problem_id:2896095].", "problem": "You are given single-cell expression measurements for seven lineage-informative genes in human cluster of differentiation 4 (CD4) T cells: RAR-related orphan receptor C (RORC), interleukin 17A (IL17A), interferon gamma (IFNG), interleukin 4 (IL4), forkhead box P3 (FOXP3), B-cell lymphoma 6 (BCL6), and C-C chemokine receptor 6 (CCR6). It is widely accepted that T helper 17 (Th17) cells are characterized by the master regulator RAR-related orphan receptor C (RORC; RORγt), effector cytokine interleukin 17A (IL17A), and the trafficking receptor C-C chemokine receptor 6 (CCR6), whereas interferon gamma (IFNG), interleukin 4 (IL4), forkhead box P3 (FOXP3), and B-cell lymphoma 6 (BCL6) mark T helper 1, T helper 2, regulatory T cells, and T follicular helper cells, respectively. Assume each gene’s expression per cell is a nonnegative real number in arbitrary normalized units.\n\nStarting from these widely accepted facts, define a mathematically explicit, lineage-consistent decision rule to classify Th17 cells using indicator functions and a score, and then estimate the false discovery rate as a target-decoy proxy. Use the following constructs:\n\n- For each cell indexed by $i$, define Th17-evidence\n$$\nE_{T}(i) = \\mathbf{1}\\{\\text{RORC}_i \\ge \\tau_R\\} + \\mathbf{1}\\{\\text{IL17A}_i \\ge \\tau_{17}\\} + \\mathbf{1}\\{\\text{CCR6}_i \\ge \\tau_C\\},\n$$\nand conflicting-evidence\n$$\nE_{C}(i) = \\mathbf{1}\\{\\text{IFNG}_i \\ge \\tau_1\\} + \\mathbf{1}\\{\\text{IL4}_i \\ge \\tau_2\\} + \\mathbf{1}\\{\\text{FOXP3}_i \\ge \\tau_F\\} + \\mathbf{1}\\{\\text{BCL6}_i \\ge \\tau_B\\}.\n$$\nHere $\\mathbf{1}\\{\\cdot\\}$ is the indicator function that equals $1$ if its argument is true and $0$ otherwise. The score for Th17 classification is\n$$\nS(i) = E_{T}(i) - E_{C}(i).\n$$\n\n- Classify cell $i$ as Th17 if and only if $S(i) \\ge s^\\ast$ and $E_{T}(i) \\ge 2$, where $s^\\ast$ is a specified integer threshold.\n\n- Define a decoy score that inverts evidence as\n$$\nS_{d}(i) = E_{C}(i) - E_{T}(i).\n$$\nCount a cell as a decoy-positive if and only if $S_{d}(i) \\ge s^\\ast$ and $E_{C}(i) \\ge 2$.\n\n- For a dataset, if $N_{+}$ is the number of Th17-classified cells and $N_{d}$ is the number of decoy-positive cells, define the estimated false discovery rate as\n$$\n\\widehat{\\mathrm{FDR}} = \n\\begin{cases}\n0.0, & \\text{if } N_{+} = 0,\\\\\n\\min\\left(1.0, \\dfrac{N_{d}}{N_{+}}\\right), & \\text{if } N_{+} \\ge 1.\n\\end{cases}\n$$\nReport $\\widehat{\\mathrm{FDR}}$ as a decimal number (not a percentage).\n\nImplement a program that, for each test case below, takes the gene expression matrix (rows are cells, columns are genes in the fixed order [RORC, IL17A, IFNG, IL4, FOXP3, BCL6, CCR6]), the thresholds $\\tau_R$, $\\tau_{17}$, $\\tau_C$, $\\tau_1$, $\\tau_2$, $\\tau_F$, $\\tau_B$, and the score cutoff $s^\\ast$, and returns, for each test case, the integer count $N_{+}$ and the decimal $\\widehat{\\mathrm{FDR}}$ rounded to $6$ decimal places.\n\nTest Suite (each dataset is a list of rows; each row has $7$ entries in the fixed gene order):\n\n- Test case $1$ (happy path; mixed phenotypes):\n  - Thresholds: $\\tau_R = 4.0$, $\\tau_{17} = 3.5$, $\\tau_C = 3.0$, $\\tau_1 = 2.5$, $\\tau_2 = 2.0$, $\\tau_F = 2.0$, $\\tau_B = 2.5$, $s^\\ast = 1$.\n  - Data matrix:\n    $$\n    \\begin{aligned}\n    &[6.0,\\, 5.0,\\, 0.5,\\, 0.2,\\, 0.3,\\, 0.5,\\, 4.5],\\\\\n    &[5.0,\\, 3.6,\\, 3.0,\\, 1.0,\\, 0.5,\\, 1.0,\\, 3.2],\\\\\n    &[1.0,\\, 0.2,\\, 6.0,\\, 0.5,\\, 0.5,\\, 0.3,\\, 1.0],\\\\\n    &[1.0,\\, 0.3,\\, 0.5,\\, 0.4,\\, 5.0,\\, 0.5,\\, 0.8],\\\\\n    &[0.8,\\, 0.4,\\, 0.5,\\, 0.5,\\, 0.6,\\, 5.0,\\, 0.6],\\\\\n    &[4.2,\\, 3.8,\\, 0.3,\\, 0.1,\\, 0.4,\\, 0.2,\\, 2.0],\\\\\n    &[2.0,\\, 0.5,\\, 0.6,\\, 0.6,\\, 0.5,\\, 0.5,\\, 3.5],\\\\\n    &[4.5,\\, 4.0,\\, 3.0,\\, 2.2,\\, 0.4,\\, 0.5,\\, 3.4]\n    \\end{aligned}\n    $$\n\n- Test case $2$ (boundary conditions; equality to thresholds):\n  - Thresholds: $\\tau_R = 4.0$, $\\tau_{17} = 3.5$, $\\tau_C = 3.0$, $\\tau_1 = 2.5$, $\\tau_2 = 2.0$, $\\tau_F = 2.0$, $\\tau_B = 2.5$, $s^\\ast = 1$.\n  - Data matrix:\n    $$\n    \\begin{aligned}\n    &[4.0,\\, 3.5,\\, 0.0,\\, 0.0,\\, 0.0,\\, 0.0,\\, 3.0],\\\\\n    &[4.0,\\, 3.5,\\, 2.5,\\, 0.0,\\, 0.0,\\, 0.0,\\, 3.0],\\\\\n    &[0.0,\\, 0.0,\\, 2.5,\\, 2.0,\\, 2.0,\\, 2.5,\\, 0.0],\\\\\n    &[0.0,\\, 0.0,\\, 0.0,\\, 0.0,\\, 0.0,\\, 0.0,\\, 0.0],\\\\\n    &[4.1,\\, 3.6,\\, 0.0,\\, 0.0,\\, 0.0,\\, 2.5,\\, 3.1]\n    \\end{aligned}\n    $$\n\n- Test case $3$ (edge case; no Th17 classifications):\n  - Thresholds: $\\tau_R = 4.0$, $\\tau_{17} = 3.5$, $\\tau_C = 3.0$, $\\tau_1 = 2.5$, $\\tau_2 = 2.0$, $\\tau_F = 2.0$, $\\tau_B = 2.5$, $s^\\ast = 1$.\n  - Data matrix:\n    $$\n    \\begin{aligned}\n    &[0.5,\\, 0.5,\\, 3.5,\\, 0.5,\\, 0.5,\\, 0.5,\\, 0.5],\\\\\n    &[0.5,\\, 0.4,\\, 0.5,\\, 0.5,\\, 3.2,\\, 0.5,\\, 0.5],\\\\\n    &[0.4,\\, 0.3,\\, 0.5,\\, 0.5,\\, 0.5,\\, 3.5,\\, 0.5],\\\\\n    &[0.5,\\, 0.4,\\, 0.5,\\, 2.1,\\, 0.5,\\, 0.5,\\, 0.5]\n    \\end{aligned}\n    $$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where for each test case you output first the integer $N_{+}$ and then the decimal $\\widehat{\\mathrm{FDR}}$ rounded to $6$ decimal places. The order must be test case $1$, then test case $2$, then test case $3$. For example, the format must be $[\\text{N}_{+}^{(1)},\\widehat{\\mathrm{FDR}}^{(1)},\\text{N}_{+}^{(2)},\\widehat{\\mathrm{FDR}}^{(2)},\\text{N}_{+}^{(3)},\\widehat{\\mathrm{FDR}}^{(3)}]$.", "solution": "The task is to classify cells as T helper $17$ (Th17) based on single-cell gene expression data and to estimate the false discovery rate (FDR) of this classification using a target-decoy strategy. The solution involves a systematic application of the provided definitions for each cell in a given dataset.\n\nThe analysis proceeds in the following sequential steps for each provided test case. A test case consists of a gene expression matrix, a set of expression thresholds, and a score cutoff.\n\n**Step 1: Data Structuring and Parameter Definition**\n\nFor each test case, we are given a data matrix where each row $i$ represents a single cell and each column corresponds to a specific gene. The gene order is fixed: [RORC, IL17A, IFNG, IL4, FOXP3, BCL6, CCR6]. The expression of gene $j$ in cell $i$ is denoted by a non-negative real number, which we can represent as $D_{i,j}$.\n\nWe are also given $7$ expression thresholds, one for each gene: $\\tau_R$, $\\tau_{17}$, $\\tau_C$, $\\tau_1$, $\\tau_2$, $\\tau_F$, $\\tau_B$. Finally, an integer score threshold $s^\\ast$ is provided.\n\n**Step 2: Calculation of Evidence Scores for Each Cell**\n\nFor each cell $i$, we must compute two intermediate scores: the Th17-evidence, $E_{T}(i)$, and the conflicting-evidence, $E_{C}(i)$.\n\nThe Th17-evidence, $E_{T}(i)$, is the count of Th17-associated genes expressed above their respective thresholds. The three Th17 marker genes are RORC, IL17A, and CCR6. Using the indicator function $\\mathbf{1}\\{\\cdot\\}$, which is $1$ if the condition is true and $0$ otherwise, $E_{T}(i)$ is defined as:\n$$\nE_{T}(i) = \\mathbf{1}\\{D_{i, \\text{RORC}} \\ge \\tau_R\\} + \\mathbf{1}\\{D_{i, \\text{IL17A}} \\ge \\tau_{17}\\} + \\mathbf{1}\\{D_{i, \\text{CCR6}} \\ge \\tau_C\\}\n$$\nThe value of $E_{T}(i)$ is an integer in the range $[0, 3]$.\n\nThe conflicting-evidence, $E_{C}(i)$, is the count of genes associated with other T-cell lineages expressed above their thresholds. These four genes are IFNG, IL4, FOXP3, and BCL6. The score $E_{C}(i)$ is defined as:\n$$\nE_{C}(i) = \\mathbf{1}\\{D_{i, \\text{IFNG}} \\ge \\tau_1\\} + \\mathbf{1}\\{D_{i, \\text{IL4}} \\ge \\tau_2\\} + \\mathbf{1}\\{D_{i, \\text{FOXP3}} \\ge \\tau_F\\} + \\mathbf{1}\\{D_{i, \\text{BCL6}} \\ge \\tau_B\\}\n$$\nThe value of $E_{C}(i)$ is an integer in the range $[0, 4]$.\n\n**Step 3: Calculation of Target and Decoy Scores**\n\nUsing the evidence scores, we calculate a target score $S(i)$ for Th17 classification and a decoy score $S_{d}(i)$.\n\nThe target score $S(i)$ rewards Th17-evidence and penalizes conflicting-evidence:\n$$\nS(i) = E_{T}(i) - E_{C}(i)\n$$\n\nThe decoy score $S_{d}(i)$ inverts this logic, rewarding conflicting-evidence and penalizing Th17-evidence. This is a crucial component of the target-decoy methodology, as it is designed to model the behavior of false positives.\n$$\nS_{d}(i) = E_{C}(i) - E_{T}(i)\n$$\nNote that $S_{d}(i) = -S(i)$.\n\n**Step 4: Cell Classification and Counting**\n\nWith the scores calculated, we classify each cell. We maintain two counters: $N_{+}$, the number of cells classified as Th17 (target hits), and $N_{d}$, the number of cells classified as decoy-positives (decoy hits).\n\nA cell $i$ is classified as a Th17 cell if and only if two conditions are met simultaneously:\n$1$. The target score $S(i)$ is greater than or equal to the score threshold $s^\\ast$.\n$2$. The Th17-evidence $E_{T}(i)$ is at least $2$. This ensures that the cell expresses at least two of the three key Th17 markers.\nIf both conditions hold, we increment the counter $N_{+}$.\n\nA cell $i$ is counted as a decoy-positive if and only if a parallel set of conditions are met:\n$1$. The decoy score $S_{d}(i)$ is greater than or equal to the score threshold $s^\\ast$.\n$2$. The conflicting-evidence $E_{C}(i)$ is at least $2$. This mirrors the logic of the target classification, requiring strong evidence for the \"decoy\" state.\nIf both conditions hold, we increment the counter $N_{d}$.\n\nThis process is repeated for every cell in the dataset to obtain the total counts $N_{+}$ and $N_{d}$.\n\n**Step 5: Estimation of the False Discovery Rate ($\\widehat{\\mathrm{FDR}}$)**\n\nThe final step is to calculate the estimated FDR, $\\widehat{\\mathrm{FDR}}$, using the total counts $N_{+}$ and $N_{d}$. The formula is defined as:\n$$\n\\widehat{\\mathrm{FDR}} = \n\\begin{cases}\n0.0, & \\text{if } N_{+} = 0,\\\\\n\\min\\left(1.0, \\dfrac{N_{d}}{N_{+}}\\right), & \\text{if } N_{+} \\ge 1.\n\\end{cases}\n$$\nThe ratio $N_{d}/N_{+}$ provides an estimate of the proportion of false positives among the target hits. The $\\min(1.0, \\cdot)$ function caps the FDR at a maximum value of $1.0$, which is conventional. The special case for $N_{+} = 0$ avoids division by zero and correctly states that if no targets are found, no false discoveries are made.\n\nThe implementation will apply this entire procedure to each test case, using vectorized operations in NumPy for efficiency. For each case, we will compute the integer count $N_{+}$ and the $\\widehat{\\mathrm{FDR}}$ value, rounded to $6$ decimal places as required. The results from all test cases are then concatenated into a single output list.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis on all test cases and print the results.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"thresholds\": (4.0, 3.5, 3.0, 2.5, 2.0, 2.0, 2.5),\n            \"s_star\": 1,\n            \"data\": [\n                [6.0, 5.0, 0.5, 0.2, 0.3, 0.5, 4.5],\n                [5.0, 3.6, 3.0, 1.0, 0.5, 1.0, 3.2],\n                [1.0, 0.2, 6.0, 0.5, 0.5, 0.3, 1.0],\n                [1.0, 0.3, 0.5, 0.4, 5.0, 0.5, 0.8],\n                [0.8, 0.4, 0.5, 0.5, 0.6, 5.0, 0.6],\n                [4.2, 3.8, 0.3, 0.1, 0.4, 0.2, 2.0],\n                [2.0, 0.5, 0.6, 0.6, 0.5, 0.5, 3.5],\n                [4.5, 4.0, 3.0, 2.2, 0.4, 0.5, 3.4]\n            ]\n        },\n        {\n            \"thresholds\": (4.0, 3.5, 3.0, 2.5, 2.0, 2.0, 2.5),\n            \"s_star\": 1,\n            \"data\": [\n                [4.0, 3.5, 0.0, 0.0, 0.0, 0.0, 3.0],\n                [4.0, 3.5, 2.5, 0.0, 0.0, 0.0, 3.0],\n                [0.0, 0.0, 2.5, 2.0, 2.0, 2.5, 0.0],\n                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],\n                [4.1, 3.6, 0.0, 0.0, 0.0, 2.5, 3.1]\n            ]\n        },\n        {\n            \"thresholds\": (4.0, 3.5, 3.0, 2.5, 2.0, 2.0, 2.5),\n            \"s_star\": 1,\n            \"data\": [\n                [0.5, 0.5, 3.5, 0.5, 0.5, 0.5, 0.5],\n                [0.5, 0.4, 0.5, 0.5, 3.2, 0.5, 0.5],\n                [0.4, 0.3, 0.5, 0.5, 0.5, 3.5, 0.5],\n                [0.5, 0.4, 0.5, 2.1, 0.5, 0.5, 0.5]\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        data_matrix = np.array(case[\"data\"])\n        thresholds = case[\"thresholds\"]\n        s_star = case[\"s_star\"]\n\n        n_plus, fdr_hat = calculate_metrics(data_matrix, thresholds, s_star)\n        \n        results.append(str(n_plus))\n        results.append(f\"{fdr_hat:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_metrics(data_matrix, thresholds, s_star):\n    \"\"\"\n    Calculates N_plus and FDR_hat for a given dataset and parameters.\n\n    Args:\n        data_matrix (np.ndarray): Gene expression matrix (cells x genes).\n        thresholds (tuple): A tuple of 7 gene expression thresholds.\n        s_star (int): The score cutoff for classification.\n\n    Returns:\n        tuple: A tuple containing (N_plus, FDR_hat).\n    \"\"\"\n    # Unpack thresholds\n    # Gene order: [RORC, IL17A, IFNG, IL4, FOXP3, BCL6, CCR6]\n    tau_R, tau_17, tau_C, tau_1, tau_2, tau_F, tau_B = thresholds\n    \n    # Gene column indices\n    RORC_IDX, IL17A_IDX, IFNG_IDX, IL4_IDX, FOXP3_IDX, BCL6_IDX, CCR6_IDX = 0, 1, 2, 3, 4, 5, 6\n\n    # Calculate Th17-evidence (E_T) vectorially for all cells\n    E_T = (\n        (data_matrix[:, RORC_IDX] >= tau_R).astype(int) +\n        (data_matrix[:, IL17A_IDX] >= tau_17).astype(int) +\n        (data_matrix[:, CCR6_IDX] >= tau_C).astype(int)\n    )\n\n    # Calculate conflicting-evidence (E_C) vectorially for all cells\n    E_C = (\n        (data_matrix[:, IFNG_IDX] >= tau_1).astype(int) +\n        (data_matrix[:, IL4_IDX] >= tau_2).astype(int) +\n        (data_matrix[:, FOXP3_IDX] >= tau_F).astype(int) +\n        (data_matrix[:, BCL6_IDX] >= tau_B).astype(int)\n    )\n\n    # Calculate target score (S) and decoy score (S_d)\n    S = E_T - E_C\n    S_d = E_C - E_T\n\n    # Count Th17-classified cells (N_plus)\n    # Condition: S >= s_star AND E_T >= 2\n    th17_mask = (S >= s_star) & (E_T >= 2)\n    N_plus = np.sum(th17_mask)\n\n    # Count decoy-positive cells (N_d)\n    # Condition: S_d >= s_star AND E_C >= 2\n    decoy_mask = (S_d >= s_star) & (E_C >= 2)\n    N_d = np.sum(decoy_mask)\n    \n    # Calculate estimated False Discovery Rate (FDR_hat)\n    if N_plus == 0:\n        fdr_hat = 0.0\n    else:\n        fdr_hat = min(1.0, N_d / N_plus)\n    \n    return int(N_plus), fdr_hat\n\nsolve()\n```", "id": "2896095"}, {"introduction": "Once a Th17 cell is differentiated, its defining purpose is to orchestrate an immune response, often by recruiting other cells to sites of inflammation. This practice models a quintessential Th17 effector function: the recruitment of neutrophils. By applying principles of transport phenomena to a chemokine gradient driven by Th17 activity, you will connect molecular secretion to a quantifiable, tissue-level outcome, calculating the physical flux of neutrophils across a barrier and developing an intuition for how these cells shape the inflammatory microenvironment [@problem_id:2896017].", "problem": "T helper 17 (Th17) cells secrete Interleukin-17A (IL-17A), which induces C-X-C motif chemokine ligand 1 (CXCL1) production by endothelial and stromal cells, establishing gradients that recruit neutrophils. Consider a one-dimensional endothelial monolayer of thickness $L$ separating a vascular lumen (at $x=0$) from the abluminal tissue (at $x=L$). The measured CXCL1 concentrations are $C(0)=C_{0}$ at the luminal side and $C(L)=C_{L}$ at the abluminal side, with $C_{L} > C_{0}$. Neutrophil motion is modeled as the sum of Fickian random motility and chemotaxis toward CXCL1, with constitutive flux\n$$\nJ(x) \\;=\\; -D\\,\\frac{\\partial n}{\\partial x} \\;+\\; \\chi\\, n\\, \\frac{\\partial C}{\\partial x},\n$$\nwhere $n(x)$ is the neutrophil number density, $D$ is the random motility coefficient, and $\\chi$ is the chemotactic coefficient. Assume steady state (no accumulation), so $J$ is constant across $0 \\le x \\le L$. Assume linear profiles across the thin layer: $\\partial C/\\partial x \\approx (C_{L}-C_{0})/L$ and $\\partial n/\\partial x \\approx (n_{L}-n_{0})/L$, where $n_{0}=n(0)$ and $n_{L}=n(L)$. The abluminal side is a perfect sink for neutrophils, so $n_{L}=0$. Close the chemotactic term by approximating the multiplicative $n$ as the layer-average $n_{\\mathrm{avg}} \\equiv (n_{0}+n_{L})/2$.\n\nUse the following measured and material parameters:\n- Endothelial thickness $L = 4\\,\\mu\\mathrm{m}$.\n- CXCL1 concentrations $C_{0} = 10\\,\\mathrm{nM}$ and $C_{L} = 80\\,\\mathrm{nM}$.\n- Neutrophil random motility $D = 3.0\\,\\mu\\mathrm{m}^{2}\\,\\mathrm{min}^{-1}$.\n- Chemotactic coefficient $\\chi = 3.2 \\times 10^{-9}\\,\\mathrm{m}^{5}\\,\\mathrm{s}^{-1}\\,\\mathrm{mol}^{-1}$.\n- Luminal neutrophil number density $n_{0} = 5.0 \\times 10^{12}\\,\\mathrm{cells}\\,\\mathrm{m}^{-3}$.\n\nStarting from mass conservation and the constitutive flux above, derive the steady net neutrophil flux from lumen to tissue and compute its numerical value using the thin-layer linear approximations described. Express the final flux in units of cells $\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$. Round your answer to three significant figures.", "solution": "The net neutrophil flux $J$ is given by the constitutive equation:\n$$\nJ = -D\\,\\frac{\\partial n}{\\partial x} + \\chi\\, n\\, \\frac{\\partial C}{\\partial x}\n$$\nThe problem states that under steady-state conditions, this flux $J$ is constant across the layer thickness $L$. We are instructed to use several approximations to evaluate this constant flux.\n\nFirst, we apply the linear profile approximation for the neutrophil density gradient:\n$$\n\\frac{\\partial n}{\\partial x} \\approx \\frac{n(L) - n(0)}{L} = \\frac{n_{L} - n_{0}}{L}\n$$\nSecond, we apply the linear profile approximation for the chemokine concentration gradient:\n$$\n\\frac{\\partial C}{\\partial x} \\approx \\frac{C(L) - C(0)}{L} = \\frac{C_{L} - C_{0}}{L}\n$$\nThird, we apply the closure approximation for the multiplicative neutrophil density $n$ in the chemotactic term, replacing it with the layer-average density $n_{\\mathrm{avg}}$:\n$$\nn \\approx n_{\\mathrm{avg}} = \\frac{n_{0} + n_{L}}{2}\n$$\nSubstituting these three approximations into the flux equation gives an expression for the constant flux $J$:\n$$\nJ \\approx -D \\left(\\frac{n_{L} - n_{0}}{L}\\right) + \\chi \\left(\\frac{n_{0} + n_{L}}{2}\\right) \\left(\\frac{C_{L} - C_{0}}{L}\\right)\n$$\nThe problem specifies that the abluminal side is a perfect sink for neutrophils, which translates to the boundary condition $n_{L} = n(L) = 0$. Substituting $n_{L}=0$ into the expression for $J$:\n$$\nJ \\approx -D \\left(\\frac{0 - n_{0}}{L}\\right) + \\chi \\left(\\frac{n_{0} + 0}{2}\\right) \\left(\\frac{C_{L} - C_{0}}{L}\\right)\n$$\nSimplifying this expression yields the formula for the net flux:\n$$\nJ \\approx \\frac{D n_{0}}{L} + \\frac{\\chi n_{0} (C_{L} - C_{0})}{2L}\n$$\nThis can be factored as:\n$$\nJ \\approx \\frac{n_{0}}{L} \\left( D + \\frac{\\chi}{2} (C_{L} - C_{0}) \\right)\n$$\nThe first term, $\\frac{D n_{0}}{L}$, represents the flux due to Fickian random motility (diffusion) down the neutrophil density gradient. The second term, $\\frac{\\chi n_{0} (C_{L} - C_{0})}{2L}$, represents the flux due to chemotaxis up the CXCL1 concentration gradient.\n\nTo compute the numerical value, we must first convert all parameters to a consistent system of units, specifically SI units (meters, seconds, moles), to obtain the flux in cells $\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$.\n\n- $L = 4\\,\\mu\\mathrm{m} = 4 \\times 10^{-6}\\,\\mathrm{m}$.\n- $C_{0} = 10\\,\\mathrm{nM} = 10 \\times 10^{-9}\\,\\mathrm{mol/L}$. With $1\\,\\mathrm{L} = 10^{-3}\\,\\mathrm{m}^{3}$, we have $C_{0} = 10 \\times 10^{-9}\\,\\mathrm{mol} / (10^{-3}\\,\\mathrm{m}^{3}) = 1.0 \\times 10^{-5}\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$.\n- $C_{L} = 80\\,\\mathrm{nM} = 80 \\times 10^{-6}\\,\\mathrm{mol}\\,\\mathrm{m}^{-3} = 8.0 \\times 10^{-5}\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$.\n- $D = 3.0\\,\\mu\\mathrm{m}^{2}\\,\\mathrm{min}^{-1}$. With $1\\,\\mu\\mathrm{m} = 10^{-6}\\,\\mathrm{m}$ and $1\\,\\mathrm{min} = 60\\,\\mathrm{s}$, we have $D = 3.0 \\frac{(10^{-6}\\,\\mathrm{m})^{2}}{60\\,\\mathrm{s}} = \\frac{3.0 \\times 10^{-12}}{60}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1} = 5.0 \\times 10^{-14}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$.\n- $\\chi = 3.2 \\times 10^{-9}\\,\\mathrm{m}^{5}\\,\\mathrm{s}^{-1}\\,\\mathrm{mol}^{-1}$.\n- $n_{0} = 5.0 \\times 10^{12}\\,\\mathrm{cells}\\,\\mathrm{m}^{-3}$.\n\nNow we substitute these values into the derived expression for $J$.\nFirst, calculate the term inside the parentheses:\n$$\n\\Delta C = C_{L} - C_{0} = (8.0 \\times 10^{-5} - 1.0 \\times 10^{-5})\\,\\mathrm{mol}\\,\\mathrm{m}^{-3} = 7.0 \\times 10^{-5}\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}\n$$\nThe chemotactic part of the parenthesis is:\n$$\n\\frac{\\chi}{2} (C_{L} - C_{0}) = \\frac{3.2 \\times 10^{-9}\\,\\mathrm{m}^{5}\\,\\mathrm{s}^{-1}\\,\\mathrm{mol}^{-1}}{2} \\times (7.0 \\times 10^{-5}\\,\\mathrm{mol}\\,\\mathrm{m}^{-3})\n$$\n$$\n= (1.6 \\times 10^{-9}) \\times (7.0 \\times 10^{-5})\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1} = 11.2 \\times 10^{-14}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1} = 1.12 \\times 10^{-13}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}\n$$\nNow, sum with the motility coefficient $D$:\n$$\nD + \\frac{\\chi}{2} (C_{L} - C_{0}) = (5.0 \\times 10^{-14}) + (11.2 \\times 10^{-14})\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1} = 16.2 \\times 10^{-14}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1} = 1.62 \\times 10^{-13}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}\n$$\nFinally, calculate the flux $J$:\n$$\nJ \\approx \\frac{5.0 \\times 10^{12}\\,\\mathrm{cells}\\,\\mathrm{m}^{-3}}{4 \\times 10^{-6}\\,\\mathrm{m}} \\left( 1.62 \\times 10^{-13}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1} \\right)\n$$\n$$\nJ \\approx (1.25 \\times 10^{18}\\,\\mathrm{cells}\\,\\mathrm{m}^{-4}) \\times (1.62 \\times 10^{-13}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1})\n$$\n$$\nJ \\approx (1.25 \\times 1.62) \\times 10^{18-13}\\,\\mathrm{cells}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}\n$$\n$$\nJ \\approx 2.025 \\times 10^{5}\\,\\mathrm{cells}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}\n$$\nRounding the result to three significant figures, we get $2.03 \\times 10^{5}$.", "answer": "$$\n\\boxed{2.03 \\times 10^{5}}\n$$", "id": "2896017"}]}