{"hands_on_practices": [{"introduction": "The diversification of animal body plans during the Cambrian was not unconstrained; it was governed by fundamental laws of physics. For early, soft-bodied organisms, the ability to absorb nutrients and oxygen from the environment was a critical factor limiting their size and complexity. This exercise challenges you to explore these biophysical limits by modeling nutrient delivery via diffusion in two idealized body plans: a simple planar organism and a more complex tubular organism with a proto-gut [@problem_id:2615118]. By deriving the maximum viable size for each, you will gain a quantitative appreciation for the immense selective advantage conferred by the evolution of an internal digestive tract, a key innovation that paved the way for larger and more complex animal forms.", "problem": "During the Ediacaran–Cambrian transition, competing body plans faced strong biophysical constraints on nutrient uptake. Consider two idealized oxygen- or glucose-limited organisms with identical tissue properties: a planar, gutless organism and a tubular organism with an internal lumen (a proto-gut). In both cases, assume a constant molecular diffusion coefficient $D$, a uniform volumetric uptake rate $q$ by living tissue, an external nutrient concentration $C_0$ at surfaces exposed to seawater, and a minimum intracellular concentration $C_{\\min}$ required for viability. Ignore convection and assume steady state. Use Fick’s first law $J = - D \\nabla C$ and steady-state mass conservation $\\nabla \\cdot J = - q$ as the fundamental base.\n\nPlanar model (gutless): The organism is a slab of tissue of total thickness $2 a$ with both faces in contact with seawater at concentration $C_0$. The interior consumes nutrient uniformly at rate $q$. Viability requires $C(x) \\ge C_{\\min}$ for all $x \\in [-a, a]$.\n\nTubular model (with gut): The organism is a cylindrical annulus of living tissue with outer radius $R$ and an internal fluid-filled lumen of radius $r_i$ that is continuously supplied at concentration $C_0$ (for example, by ciliary mixing or peristalsis). The outer surface at $r = R$ is also exposed to seawater at concentration $C_0$. The tissue in $r \\in [r_i, R]$ consumes nutrient uniformly at rate $q$. Viability requires $C(r) \\ge C_{\\min}$ for all $r \\in [r_i, R]$.\n\nTasks:\n1) For the planar model, derive the maximum half-thickness $a_{\\max}$ consistent with viability in terms of $D$, $q$, $C_0$, and $C_{\\min}$.\n2) For the tubular model, derive the maximum outer radius $R_{\\max}$ as a function of $r_i$, $D$, $q$, $C_0$, and $C_{\\min}$.\n3) Let the lumen occupy a fixed fraction of the outer radius, $r_i = \\alpha R$ with $\\alpha \\in (0, 1)$. Define $\\rho(\\alpha) = R_{\\max}/a_{\\max}$. Show that $\\rho(\\alpha)$ is independent of $D$, $q$, $C_0$, and $C_{\\min}$, and evaluate $\\rho(\\alpha)$ for $\\alpha = 0.5$. Round your answer to four significant figures. Explain briefly, based on your derivation, how the result informs selective pressures on the evolution of an internal gut during the Cambrian radiation of animal phyla. Your final reported quantity must be the single real-valued number $\\rho(0.5)$.", "solution": "The problem is scientifically grounded, utilizing the principles of diffusion-reaction physics to model biological constraints. We will solve it systematically.\n\nThe fundamental governing equation is derived from combining Fick's first law, $J = -D \\nabla C$, with the steady-state mass conservation law, $\\nabla \\cdot J = -q$. For a constant diffusion coefficient $D$, this yields the Poisson equation:\n$$ \\nabla^2 C = \\frac{q}{D} $$\n\n**1. Planar Model**\nFor a one-dimensional slab ($x \\in [-a, a]$), the Laplacian is $\\nabla^2 = \\frac{d^2}{dx^2}$. Integrating the governing equation $\\frac{d^2 C}{dx^2} = \\frac{q}{D}$ twice gives the general solution:\n$$ C(x) = \\frac{q}{2D}x^2 + K_1 x + K_2 $$\nThe boundary conditions are $C(a) = C_0$ and $C(-a) = C_0$. Applying these yields $K_1 = 0$ and $K_2 = C_0 - \\frac{qa^2}{2D}$. The concentration profile is:\n$$ C(x) = C_0 - \\frac{q}{2D}(a^2 - x^2) $$\nThe minimum concentration occurs at the center, $x=0$. The viability condition is $C(0) \\ge C_{\\min}$. The maximum half-thickness, $a_{\\max}$, is achieved when $C(0) = C_{\\min}$.\n$$ C_0 - C_{\\min} = \\frac{q}{2D}a_{\\max}^2 \\implies a_{\\max} = \\sqrt{\\frac{2D(C_0 - C_{\\min})}{q}} $$\n\n**2. Tubular Model**\nFor a cylindrical annulus ($r \\in [r_i, R]$), the Laplacian in cylindrical coordinates is $\\nabla^2 = \\frac{1}{r}\\frac{d}{dr}\\left(r\\frac{dC}{dr}\\right)$. Integrating the governing equation twice gives:\n$$ C(r) = \\frac{q}{4D}r^2 + K_3 \\ln(r) + K_4 $$\nThe boundary conditions are $C(r_i) = C_0$ and $C(R) = C_0$. Applying these gives the concentration profile:\n$$ C(r) = C_0 + \\frac{q}{4D}(r^2 - R^2) - \\frac{q}{4D}\\frac{R^2 - r_i^2}{\\ln(R/r_i)}\\ln(r/R) $$\nThe minimum concentration occurs where the gradient $\\frac{dC}{dr}=0$. The location of the minimum, $r_{\\min}$, is given by:\n$$ r_{\\min}^2 = \\frac{R^2 - r_i^2}{2\\ln(R/r_i)} $$\nThe maximum outer radius $R_{\\max}$ is found when $C(r_{\\min}) = C_{\\min}$. Let $\\Delta C = C_0 - C_{\\min}$. Substituting $r_{\\min}$ into the profile gives the condition:\n$$ \\Delta C = \\frac{q}{4D} \\left[ R_{\\max}^2 - r_{\\min}^2\\left(1 + 2\\ln\\frac{R_{\\max}}{r_{\\min}}\\right) \\right] $$\nThis equation implicitly defines $R_{\\max}$ as a function of $r_i$ and the other parameters.\n\n**3. Ratio and Evaluation**\nWe set $r_i = \\alpha R_{\\max}$ and solve for the ratio $\\rho(\\alpha) = R_{\\max}/a_{\\max}$. From the planar case, $a_{\\max}^2 = \\frac{2D\\Delta C}{q}$. From the tubular case, we can write $R_{\\max}^2 = \\frac{4D\\Delta C}{q} \\cdot S(\\alpha)^{-1}$, where $S(\\alpha)$ is the bracketed term dependent on $\\alpha$:\n$$ S(\\alpha) = 1 - \\frac{r_{\\min}^2}{R_{\\max}^2}\\left(1 + 2\\ln\\frac{R_{\\max}}{r_{\\min}}\\right) = 1 - \\frac{1-\\alpha^2}{2\\ln(1/\\alpha)}\\left(1 + \\ln\\left[\\frac{2\\ln(1/\\alpha)}{1-\\alpha^2}\\right]\\right) $$\nThe squared ratio is:\n$$ \\rho^2(\\alpha) = \\frac{R_{\\max}^2}{a_{\\max}^2} = \\frac{(4D\\Delta C/q) \\cdot S(\\alpha)^{-1}}{(2D\\Delta C/q)} = 2 \\cdot S(\\alpha)^{-1} $$\nThis expression depends only on $\\alpha$, as required.\nFor $\\alpha = 0.5$, we evaluate $S(0.5)$:\n$$ S(0.5) = 1 - \\frac{1-(0.5)^2}{2\\ln(2)}\\left(1 + \\ln\\left[\\frac{2\\ln(2)}{1-(0.5)^2}\\right]\\right) \\approx 0.12664 $$\nTherefore, $\\rho^2(0.5) = 2 / 0.12664 \\approx 15.792$.\n$$ \\rho(0.5) = \\sqrt{15.792} \\approx 3.974 $$\nThe result $\\rho(0.5) \\approx 3.974$ signifies that a tubular organism can achieve an outer radius nearly 4 times the half-thickness of a similarly constrained planar organism. This dramatic increase in potential body size conferred by an internal gut, which effectively doubles the surface area for nutrient exchange, represents a powerful biophysical advantage. It would have created intense selective pressure favouring the evolution of such internal structures, providing a key explanation for the rapid diversification of complex animal body plans.", "answer": "$$\\boxed{3.974}$$", "id": "2615118"}, {"introduction": "The Cambrian Explosion is famously described as an explosion of form, but how do scientists move from fossils and characters to a quantitative measure of this morphological 'disparity'? This hands-on practice guides you through the complete workflow of a morphometric analysis to do just that [@problem_id:2615231]. Starting with a raw character-taxon matrix, you will first compute a pairwise distance matrix between taxa and then implement Principal Coordinates Analysis (PCoA) from first principles. By calculating disparity as the sum of sample variances along the first $k$ principal coordinate axes, you will gain a practical understanding of how abstract concepts like 'morphospace' are operationalized to test hypotheses about macroevolutionary patterns.", "problem": "You are studying morphological disparity among early arthropods associated with the Cambrian explosion using character-taxon matrices. Morphological disparity is operationalized here as the sum of sample variances along the first $k$ principal coordinate axes obtained from a Principal Coordinates Analysis (PCoA) of inter-taxon distances. Your task is to implement the complete pipeline from first principles, without invoking any black-box dimensionality reduction routine, and compute a disparity metric for several test cases.\n\nStarting from core definitions:\n- A character-taxon matrix encodes discrete morphological characters for taxa. Entries are unordered multistate integers, with missing observations denoted by a special missing symbol.\n- The pairwise distance between two taxa is defined as the proportion of characters that differ among the characters that are comparable (that is, neither missing). This is a normalized Hamming distance appropriate for unordered discrete characters.\n- Principal Coordinates Analysis (also known as classical multidimensional scaling) embeds objects in a Euclidean space given a dissimilarity matrix by a double-centering transformation followed by an eigendecomposition.\n- Morphological disparity is computed as the sum of sample variances along the first $k$ principal coordinate axes, where axes are ordered by descending eigenvalue. If fewer than $k$ axes have positive eigenvalues, only the positive-eigenvalue axes contribute to the sum.\n\nImplement the following, adhering strictly to these principles:\n- Compute a symmetric distance matrix between taxa where the distance between taxa $i$ and $j$ is the number of characters in which they differ divided by the number of comparable characters. If the number of comparable characters is zero, define the distance as $0$ for that pair.\n- Perform Principal Coordinates Analysis from first principles: use the standard double-centering transformation on the squared distance matrix to obtain an inner-product matrix, then obtain coordinates by eigendecomposition. Treat very small negative eigenvalues due to numerical error as zero by applying a non-negativity tolerance. Order axes by descending eigenvalues. Do not call any pre-built PCoA or multidimensional scaling function.\n- Compute the disparity for a given $k$ as the sum of sample variances along the first $k$ axes. The sample variance along axis $j$ must be computed from the coordinate scores for the $n$ taxa as the unbiased variance, and it is directly related to the eigenvalues of the centered inner-product matrix.\n\nAngle units do not apply. There are no physical units. All outputs are real-valued numbers and must be reported as decimal floats.\n\nYour program must implement these steps and run on the following test suite. Each test case consists of a character-taxon matrix with missing values indicated by the symbol “?” and a value of $k$. Rows correspond to taxa and columns to characters. The states are unordered. All numbers below are literal entries of the matrices. You must hard-code these test cases into your program.\n\n- Test case A (moderate disparity, some missing data), with $k = 3$:\n  - Matrix with $6$ taxa and $10$ characters:\n    - Row $1$: $[0,1,2,1,0,?,1,0,2,1]$\n    - Row $2$: $[0,1,2,0,0,?,1,1,2,0]$\n    - Row $3$: $[1,1,1,0,1,0,1,1,2,?]$\n    - Row $4$: $[1,0,1,0,1,0,0,1,1,?]$\n    - Row $5$: $[0,0,2,1,0,1,1,0,2,1]$\n    - Row $6$: $[0,1,2,1,0,1,1,0,2,1]$\n\n- Test case B (low variation, some redundancy), with $k = 2$:\n  - Matrix with $5$ taxa and $6$ characters:\n    - Row $1$: $[0,0,0,0,0,0]$\n    - Row $2$: $[0,0,0,0,0,1]$\n    - Row $3$: $[0,0,0,0,1,1]$\n    - Row $4$: $[0,0,0,0,1,1]$\n    - Row $5$: $[0,0,0,0,0,0]$\n\n- Test case C (high contrast states), with $k = 10$:\n  - Matrix with $4$ taxa and $8$ characters:\n    - Row $1$: $[0,1,0,1,0,1,0,1]$\n    - Row $2$: $[1,0,1,0,1,0,1,0]$\n    - Row $3$: $[0,0,0,0,0,0,0,0]$\n    - Row $4$: $[1,1,1,1,1,1,1,1]$\n\n- Test case D (edge case with structured missingness), with $k = 3$:\n  - Matrix with $4$ taxa and $6$ characters:\n    - Row $1$: $[0,1,?,1,2,?]$\n    - Row $2$: $[0,?,2,1,2,1]$\n    - Row $3$: $[?,1,2,?,2,1]$\n    - Row $4$: $[0,1,2,1,?,1]$\n\nComputational details and constraints:\n- Let $n$ be the number of taxa. Construct an $n \\times n$ distance matrix with zeros on the diagonal and symmetric off-diagonal entries defined as above.\n- Implement Principal Coordinates Analysis from first principles via double-centering of the squared distance matrix followed by eigendecomposition. Use only basic linear algebra operations available in common numerical libraries.\n- When computing disparity, if $k$ exceeds the number of strictly positive eigenvalues, sum only over those axes with positive eigenvalues; axes with non-positive eigenvalues contribute $0$.\n- Apply a numerical tolerance so that eigenvalues smaller than a small threshold are treated as zero to avoid spurious negative contributions; choose a non-negativity tolerance that is small relative to the largest eigenvalue in each case.\n\nFinal output specification:\n- For each test case, compute a single real number: the disparity value defined as the sum of sample variances along the first $k$ axes.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, \"[$r_1,r_2,r_3,r_4$]\"), where each $r_i$ is the floating-point result for the corresponding test case. Format each $r_i$ to exactly $6$ digits after the decimal point.\n\nYour implementation should be general, but you must hard-code the test matrices and corresponding $k$ values given above. The program must not read any input.", "solution": "The problem presented is valid. It is scientifically grounded in the field of morphometrics, specifically in the quantitative analysis of biological disparity using character-taxon matrices. The methodology, employing a specific distance metric and Principal Coordinates Analysis (PCoA), is a standard and well-established procedure. The problem is well-posed, with all definitions, data, and constraints clearly specified, permitting a unique and verifiable solution.\n\nThe task is to compute a morphological disparity metric for several test cases. This metric is defined as the sum of sample variances along the first $k$ principal coordinate axes derived from a PCoA. The entire procedure will be implemented from first principles as specified.\n\nThe solution is implemented in three main steps:\n1.  Construction of a pairwise inter-taxon distance matrix.\n2.  Execution of Principal Coordinates Analysis (PCoA) via double-centering and eigendecomposition.\n3.  Calculation of the disparity metric from the resulting eigenvalues.\n\n**Step 1: Pairwise Distance Matrix Construction**\n\nGiven a character-taxon matrix with $n$ taxa (rows) and $m$ characters (columns), the first step is to compute the $n \\times n$ symmetric distance matrix $D$. The matrix entries are $d_{ij}$, representing the distance between taxon $i$ and taxon $j$. For discrete, unordered character states, the distance is defined as the proportion of characters that differ, calculated only over the set of comparable characters. A character is comparable for two taxa if it is not missing in either taxon.\n\nLet $x_{ic}$ be the state of character $c$ for taxon $i$. A special symbol, '?', denotes a missing observation. The distance $d_{ij}$ is given by the formula:\n$$\nd_{ij} = \\frac{N_{\\text{diff}}}{N_{\\text{comp}}}\n$$\nwhere $N_{\\text{diff}}$ is the number of comparable characters for which the states differ between taxon $i$ and taxon $j$, and $N_{\\text{comp}}$ is the total number of comparable characters for the pair.\nFormally, let $I(\\cdot)$ be the indicator function. The number of differing characters is:\n$$\nN_{\\text{diff}}(i, j) = \\sum_{c=1}^{m} I(x_{ic} \\neq x_{jc} \\land x_{ic} \\neq \\text{'?'} \\land x_{jc} \\neq \\text{'?'})\n$$\nThe number of comparable characters is:\n$$\nN_{\\text{comp}}(i, j) = \\sum_{c=1}^{m} I(x_{ic} \\neq \\text{'?'} \\land x_{jc} \\neq \\text{'?'})\n$$\nIf $N_{\\text{comp}}(i, j) = 0$, the distance $d_{ij}$ is defined to be $0$. By definition, the distance of any taxon to itself is $d_{ii} = 0$. The resulting matrix $D$ is symmetric, i.e., $d_{ij} = d_{ji}$.\n\n**Step 2: Principal Coordinates Analysis (PCoA)**\n\nPCoA, or classical multidimensional scaling, is a method to represent objects in a low-dimensional Euclidean space based on a dissimilarity matrix. The procedure starts with the distance matrix $D$ from Step 1.\n\nFirst, the distance matrix $D$ is converted into a matrix of squared distances, $D^{(2)}$, where $(D^{(2)})_{ij} = d_{ij}^2$.\n\nSecond, this matrix is double-centered to produce an inner-product matrix $B$. Double-centering effectively translates the origin of the coordinate system to the centroid of the configuration of points. The transformation is given by:\n$$\nB = -\\frac{1}{2} J D^{(2)} J\n$$\nwhere $J$ is the $n \\times n$ centering matrix defined as:\n$$\nJ = I - \\frac{1}{n} \\mathbf{1}\\mathbf{1}^T\n$$\nHere, $I$ is the $n \\times n$ identity matrix and $\\mathbf{1}$ is an $n \\times 1$ column vector of ones. The matrix $B$ is a Gram matrix, meaning its entries $b_{ij}$ are the inner products of the vectors representing the centered taxa in the target Euclidean space.\n\nThird, an eigendecomposition is performed on the symmetric matrix $B$:\n$$\nB = Q \\Lambda Q^T\n$$\nwhere $Q$ is an orthogonal matrix whose columns are the eigenvectors of $B$, and $\\Lambda$ is a diagonal matrix whose diagonal entries are the corresponding eigenvalues $\\lambda_1, \\lambda_2, \\dots, \\lambda_n$. The eigenvalues are sorted in descending order: $\\lambda_1 \\ge \\lambda_2 \\ge \\dots \\ge \\lambda_n$. The principal coordinate scores for the $n$ taxa are given by the columns of the matrix $X = Q \\sqrt{\\Lambda^+}$, where $\\Lambda^+$ includes only the positive eigenvalues. Due to numerical floating-point inaccuracies, very small negative eigenvalues may arise; these are treated as zero by applying a small tolerance threshold (e.g., $10^{-12}$).\n\n**Step 3: Disparity Calculation**\n\nThe morphological disparity is operationalized as the sum of the sample variances of the coordinate scores along the first $k$ principal axes. The (unbiased) sample variance of the scores on the $j$-th axis is directly related to the $j$-th eigenvalue of the matrix $B$. For a set of $n$ scores $x_{1j}, x_{2j}, \\dots, x_{nj}$ on axis $j$, which are centered such that their mean is zero, the sample variance is:\n$$\n\\text{Var}_j = \\frac{1}{n-1} \\sum_{i=1}^{n} x_{ij}^2\n$$\nA fundamental property of PCoA is that the sum of the squared scores on an axis is equal to the corresponding eigenvalue: $\\sum_{i=1}^{n} x_{ij}^2 = \\lambda_j$. Therefore, the sample variance for axis $j$ simplifies to:\n$$\n\\text{Var}_j = \\frac{\\lambda_j}{n-1}\n$$\nThe total disparity for a given parameter $k$ is the sum of these variances over the first $k$ axes that have positive eigenvalues. Let $p$ be the number of positive eigenvalues. The number of axes to sum over is $k' = \\min(k, p)$. The disparity, $S_k$, is then:\n$$\nS_k = \\sum_{j=1}^{k'} \\text{Var}_j = \\sum_{j=1}^{k'} \\frac{\\lambda_j}{n-1} = \\frac{1}{n-1} \\sum_{j=1}^{k'} \\lambda_j\n$$\nThis formula provides a direct and efficient way to compute the disparity metric from the eigenvalues of the double-centered inner-product matrix.", "answer": "[0.106318,0.026667,0.437500,0.088398]", "id": "2615231"}, {"introduction": "Beyond documenting the 'what' of the Cambrian fossil record, a central goal of evolutionary biology is to reconstruct the 'how' and 'when' of character evolution. What did the last common ancestor of all bilaterian animals look like? Was it segmented? This practice introduces you to the powerful technique of ancestral state reconstruction, a cornerstone of modern phylogenetic comparative methods [@problem_id:2615156]. You will apply a continuous-time Markov chain (CTMC) model to a metazoan phylogeny to infer the ancestral states of key characters like symmetry and segmentation. This exercise will provide you with direct experience in probabilistic modeling on phylogenies, revealing how scientists combine fossil data, extant species, and evolutionary models to peer back in time and test hypotheses about the earliest chapters of animal evolution.", "problem": "You are given a rooted phylogeny of Metazoa (animals) with branch lengths and observed tip states for two discrete morphological characters central to comparative zoology of the Cambrian explosion and the origin of animal phyla: symmetry and segmentation. Your task is to implement maximum likelihood ancestral state reconstruction under a continuous-time Markov chain to infer, for each test condition, the marginal probability that the last common ancestor of the Bilateria clade had bilateral symmetry and that it was segmented.\n\nFundamental base. Use the following principles and facts:\n- A character evolving along a phylogeny can be modeled as a time-homogeneous continuous-time Markov chain (CTMC) with generator matrix $Q$, so that the transition probability matrix over time $t$ is $P(t) = \\exp(Qt)$, where $\\exp$ denotes the matrix exponential.\n- For a $2$-state symmetric model (state $0$ and state $1$) with equal forward and reverse instantaneous rates $q$ (that is, $Q = \\begin{bmatrix} -q & q \\\\ q & -q \\end{bmatrix}$), the transition probabilities $P(t)$ follow from $P(t)=\\exp(Qt)$.\n- The probability of observed tip data given an internal state is computed by Felsenstein’s pruning algorithm, which multiplies, at each node, the conditional likelihoods contributed by its descendants.\n- The marginal posterior at a focal internal node combines the downward (from descendants) and upward (from the rest of the tree given the root prior) messages and is normalized to sum to $1$.\n\nDo not use any shortcut formulas not derivable from these bases as the starting point of your implementation; derive what you need from the above facts.\n\nPhylogeny. The rooted binary tree has the following topology and branch lengths (in arbitrary time units). Each line is “parent → child: branch length.” Internal node names are for description; your program should compute the most recent common ancestor (MRCA) programmatically.\n- Internal node n1 (Ctenophora + Cnidaria) → Ctenophora: $0.1$; n1 → Cnidaria: $0.1$.\n- Internal node n2 (Placozoa + n1) → Placozoa: $0.2$; n2 → n1: $0.1$.\n- Internal node n3 (Porifera + n2) → Porifera: $0.3$; n3 → n2: $0.2$.\n- Root’s left child is n3: root → n3: $0.5$.\n- Internal node n4 (Arthropoda + Nematoda) → Arthropoda: $0.1$; n4 → Nematoda: $0.1$.\n- Internal node n5 (Annelida + Mollusca) → Annelida: $0.1$; n5 → Mollusca: $0.1$.\n- Internal node n6 (n4 + n5) → n4: $0.2$; n6 → n5: $0.2$.\n- Internal node n7 (n6 + Chordata), which is the Bilateria MRCA, → n6: $0.3$; n7 → Chordata: $0.6$.\n- Root’s right child is n7: root → n7: $0.2$.\n\nTip taxa are Porifera, Placozoa, Ctenophora, Cnidaria (non-bilaterians) and Arthropoda, Nematoda, Annelida, Mollusca, Chordata (bilaterians). The MRCA of Bilateria is the MRCA of the set {Arthropoda, Nematoda, Annelida, Mollusca, Chordata}.\n\nCharacters and coding. Each tip taxon is coded for two characters as follows:\n- Symmetry: state $0$ for radial or asymmetric and state $1$ for bilateral. Coding: Porifera $0$, Placozoa $0$, Ctenophora $0$, Cnidaria $0$, Arthropoda $1$, Nematoda $1$, Annelida $1$, Mollusca $1$, Chordata $1$.\n- Segmentation: state $0$ for absent and state $1$ for present. Coding: Porifera $0$, Placozoa $0$, Ctenophora $0$, Cnidaria $0$, Arthropoda $1$, Nematoda $0$, Annelida $1$, Mollusca $0$, Chordata $1$.\n\nModel. Treat the two characters as independent $2$-state symmetric CTMCs, each with its own instantaneous rate $q$ and its own root prior distribution $\\pi = (\\pi_0, \\pi_1)$, where $\\pi_0$ is the prior probability of state $0$ and $\\pi_1$ is the prior probability of state $1$ at the root.\n\nComputation. For each character, compute:\n- The downward conditional likelihoods at every node using Felsenstein’s pruning algorithm.\n- The upward messages from the root prior to every node by dynamic programming over the tree.\n- The marginal posterior at the Bilateria MRCA node as the elementwise product of its downward likelihood vector and its upward message vector, normalized to sum to $1$.\n- Extract the probability for the biologically relevant state ($1$ for bilateral symmetry and $1$ for segmented) as a decimal number.\n\nTest suite. Run your program on the following four parameter sets. For each set, report a pair of floats: the probability that the Bilateria MRCA is bilateral for the symmetry character, and the probability that it is segmented for the segmentation character. Report values rounded to six decimal places (decimals, no percentage sign).\n- Case $1$: symmetry rate $q_{\\mathrm{sym}} = 10^{-6}$, segmentation rate $q_{\\mathrm{seg}} = 10^{-6}$, root priors $\\pi_{\\mathrm{sym}} = (0.5, 0.5)$ and $\\pi_{\\mathrm{seg}} = (0.5, 0.5)$.\n- Case $2$: $q_{\\mathrm{sym}} = 0.05$, $q_{\\mathrm{seg}} = 0.2$, $\\pi_{\\mathrm{sym}} = (0.9, 0.1)$ and $\\pi_{\\mathrm{seg}} = (0.9, 0.1)$.\n- Case $3$: $q_{\\mathrm{sym}} = 1.0$, $q_{\\mathrm{seg}} = 1.0$, $\\pi_{\\mathrm{sym}} = (0.5, 0.5)$ and $\\pi_{\\mathrm{seg}} = (0.5, 0.5)$.\n- Case $4$: $q_{\\mathrm{sym}} = 10.0$, $q_{\\mathrm{seg}} = 5.0$, $\\pi_{\\mathrm{sym}} = (0.5, 0.5)$ and $\\pi_{\\mathrm{seg}} = (0.5, 0.5)$.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list of four inner two-element lists in the same order as the test suite, with no spaces, enclosed in square brackets. For example: \"[[a,b],[c,d],[e,f],[g,h]]\", where each of $a,b,c,d,e,f,g,h$ is a float rounded to six decimal places.", "solution": "We model each character as a $2$-state continuous-time Markov chain (CTMC) on a fixed rooted phylogeny. The states are denoted $0$ and $1$, with a symmetric instantaneous rate matrix $Q = \\begin{bmatrix} -q & q \\\\ q & -q \\end{bmatrix}$, where $q > 0$ is the instantaneous transition rate. The transition probability matrix over time $t$ is $P(t) = \\exp(Qt)$. For a $2$-state symmetric model, we can diagonalize $Q$ to obtain a closed form:\n$$\nP(t) \\;=\\; \\begin{bmatrix}\n\\frac{1 + e^{-2qt}}{2} & \\frac{1 - e^{-2qt}}{2} \\\\\n\\frac{1 - e^{-2qt}}{2} & \\frac{1 + e^{-2qt}}{2}\n\\end{bmatrix},\n$$\nwhich follows directly from the matrix exponential of $Q$ and is consistent with the Markov property and time-homogeneity.\n\nGiven a rooted binary tree with branch lengths and observed tip states, we compute the likelihood of the observations conditioned on internal node states using Felsenstein’s pruning algorithm. Let $L_v = (L_v(0), L_v(1))$ denote the conditional likelihood vector at node $v$, defined as the probability of the observed data in the subtree rooted at $v$ given that $v$ is in state $0$ or $1$, respectively. For a leaf $v$ with observed state $x_v \\in \\{0,1\\}$, we set $L_v(x_v) = 1$ and $L_v(1 - x_v) = 0$. For an internal node $v$ with children $c_1$ and $c_2$ and branch lengths $t_1$ and $t_2$ to those children, respectively, and with transition matrices $P_1 = P(t_1)$ and $P_2 = P(t_2)$, the postorder recursion is\n$$\nL_v(s) \\;=\\; \\left(\\sum_{s_1 \\in \\{0,1\\}} P_1(s, s_1) \\, L_{c_1}(s_1)\\right) \\cdot \\left(\\sum_{s_2 \\in \\{0,1\\}} P_2(s, s_2) \\, L_{c_2}(s_2)\\right),\n$$\nfor $s \\in \\{0,1\\}$. This computes, for each possible state $s$ at node $v$, the likelihood of the descendant data.\n\nTo obtain marginal posterior probabilities at an internal node $u$, it is not sufficient to use only the downward (descendant) information $L_u$; we must also incorporate information from the rest of the tree via an upward message. Let $U_v = (U_v(0), U_v(1))$ denote the probability of the data outside the subtree rooted at $v$ given the state at $v$. At the root $r$, the upward message is the root prior distribution $U_r = \\pi = (\\pi_0, \\pi_1)$. For a child $c$ of a parent $p$ with branch length $t_{pc}$ and transition matrix $P_{pc} = P(t_{pc})$, and letting $S$ denote the set of siblings of $c$, the upward message at $c$ is computed from the upward message at $p$ and the downward messages of $S$:\n$$\nU_c(s_c) \\;=\\; \\sum_{s_p \\in \\{0,1\\}} U_p(s_p) \\left[ \\prod_{w \\in S} \\left(\\sum_{s_w \\in \\{0,1\\}} P_{pw}(s_p, s_w) \\, L_w(s_w)\\right) \\right] \\cdot P_{pc}(s_p, s_c).\n$$\nThis formula propagates non-descendant information to the child by accounting for the contributions of siblings at the parent. We compute $U$ for all nodes by a preorder traversal starting at the root.\n\nThe marginal posterior at node $u$ is then proportional to the elementwise product of its downward likelihood and upward message:\n$$\n\\tilde{\\gamma}_u(s) \\;=\\; L_u(s) \\cdot U_u(s), \\quad s \\in \\{0,1\\},\n$$\nand normalized to obtain\n$$\n\\gamma_u(s) \\;=\\; \\frac{\\tilde{\\gamma}_u(s)}{\\tilde{\\gamma}_u(0) + \\tilde{\\gamma}_u(1)}.\n$$\nThis yields the posterior probability that node $u$ is in state $s$ given all observed tips and the model. Because the two characters are assumed independent, we compute these probabilities separately for symmetry and segmentation, each with its specified instantaneous rate $q$ and root prior $\\pi$.\n\nThe phylogeny is a rooted binary tree with specified branch lengths. The MRCA of Bilateria is the most recent common ancestor of the set $\\{\\text{Arthropoda}, \\text{Nematoda}, \\text{Annelida}, \\text{Mollusca}, \\text{Chordata}\\}$. The program computes the MRCA programmatically by intersecting ancestor sets of these tips.\n\nTest suite and outputs. For each of the four parameter sets:\n- Case $1$ uses $q_{\\mathrm{sym}} = 10^{-6}$ and $q_{\\mathrm{seg}} = 10^{-6}$ with $\\pi_{\\mathrm{sym}} = (0.5, 0.5)$ and $\\pi_{\\mathrm{seg}} = (0.5, 0.5)$. With such small rates, the posterior at the Bilateria MRCA for symmetry is expected to concentrate near state $1$ (bilateral) because all bilaterian tips are bilateral. For segmentation, with three segmented bilaterians out of five and non-bilaterian outgroups unsegmented, the more parsimonious explanation under tiny rates is a segmented bilaterian ancestor with subsequent losses, leading to a posterior favoring state $1$.\n- Case $2$ uses $q_{\\mathrm{sym}} = 0.05$ and $q_{\\mathrm{seg}} = 0.2$ with biased priors $\\pi = (0.9, 0.1)$ that favor state $0$ at the root. The posterior balances the data against the prior; symmetry remains driven by the concentrated bilaterian signal, while segmentation is moderated by both the higher rate and the prior bias.\n- Case $3$ uses $q_{\\mathrm{sym}} = 1.0$ and $q_{\\mathrm{seg}} = 1.0$ with uniform priors, producing posteriors influenced by both topology and branch lengths; symmetry still favors bilateral at the Bilateria MRCA, whereas segmentation reflects conflicting signals among bilaterians.\n- Case $4$ uses high rates $q_{\\mathrm{sym}} = 10.0$ and $q_{\\mathrm{seg}} = 5.0$ with uniform priors. High rates drive $P(t)$ towards the stationary distribution, so the posterior at internal nodes tends toward $\\approx (0.5, 0.5)$ in the absence of extremely short branches; thus both posteriors approach $0.5$ for state $1$.\n\nFor each case, the program computes the marginal posterior probability that the Bilateria MRCA is in state $1$ for symmetry (bilateral) and in state $1$ for segmentation (segmented), rounds each to six decimal places, and prints a single line of the form \"[[a,b],[c,d],[e,f],[g,h]]\" as required.", "answer": "[[0.999998,0.999912],[0.970222,0.627962],[0.900821,0.551694],[0.509748,0.500000]]", "id": "2615156"}]}