{"hands_on_practices": [{"introduction": "The birth-death process is a cornerstone of macroevolutionary modeling, allowing us to quantify diversification dynamics through speciation ($\\lambda$) and extinction ($\\mu$) rates. A central tenet of the key innovation hypothesis is that a novel trait directly alters these rates. This exercise provides foundational practice in translating a hypothetical scenario about an innovation's impact into a quantitative change in the net diversification rate, $r = \\lambda - \\mu$, which is the most direct measure of a clade's expected proliferative success [@problem_id:2584172].", "problem": "In comparative macroevolution across animals and plants, key innovations can alter speciation and extinction rates and thereby change the net diversification rate of a clade. Consider a clade evolving under a time-homogeneous birth–death process in which solitary lineages have baseline speciation rate $\\lambda_{0}$ and extinction rate $\\mu_{0}$. A key innovation corresponding to sociality arises and, relative to the solitary baseline, increases the speciation rate by a fraction $0.10$ and decreases the extinction rate by a fraction $0.30$. Empirical estimates for the solitary baseline in this clade are $\\lambda_{0}=0.35$ and $\\mu_{0}=0.20$.\n\nAssume that the effect of sociality on rates is multiplicative relative to the solitary baseline. Define the expected change in net diversification due to sociality as the difference between the social and solitary net diversification rates, where net diversification is defined in the standard macroevolutionary sense. Compute this expected change as a single real number. Express the final change in the net diversification rate using units of per million years, but do not include units in your boxed answer. No rounding is required.", "solution": "The problem is well-posed and scientifically sound, resting upon the standard time-homogeneous birth–death process, a fundamental model in macroevolutionary biology. All necessary parameters and definitions are provided, allowing for a direct and unambiguous calculation. We shall proceed with the derivation.\n\nThe net diversification rate, denoted by the symbol $r$, is defined as the difference between the speciation rate, $\\lambda$, and the extinction rate, $\\mu$.\n$$r = \\lambda - \\mu$$\nFor the solitary state, which serves as the baseline, the net diversification rate is $r_0$, defined by the given baseline parameters $\\lambda_0$ and $\\mu_0$.\n$$r_0 = \\lambda_0 - \\mu_0$$\nFor the social state, a key innovation has altered the baseline rates. The new speciation rate, $\\lambda_s$, is stated to be an increase by a fraction of $0.10$ relative to the baseline. As this effect is multiplicative, we have:\n$$\\lambda_s = \\lambda_0 \\times (1 + 0.10) = 1.1 \\lambda_0$$\nSimilarly, the new extinction rate, $\\mu_s$, is a decrease by a fraction of $0.30$ relative to the baseline. This gives:\n$$\\mu_s = \\mu_0 \\times (1 - 0.30) = 0.7 \\mu_0$$\nThe net diversification rate for the social state, $r_s$, is therefore:\n$$r_s = \\lambda_s - \\mu_s = 1.1 \\lambda_0 - 0.7 \\mu_0$$\nThe problem requires the computation of the expected change in net diversification due to sociality. This quantity, which we shall denote as $\\Delta r$, is the difference between the social and solitary net diversification rates.\n$$\\Delta r = r_s - r_0$$\nSubstituting the expressions for $r_s$ and $r_0$:\n$$\\Delta r = (1.1 \\lambda_0 - 0.7 \\mu_0) - (\\lambda_0 - \\mu_0)$$\nWe simplify this expression by collecting terms with $\\lambda_0$ and $\\mu_0$:\n$$\\Delta r = (1.1 \\lambda_0 - \\lambda_0) + (\\mu_0 - 0.7 \\mu_0)$$\n$$\\Delta r = (1.1 - 1) \\lambda_0 + (1 - 0.7) \\mu_0$$\n$$\\Delta r = 0.1 \\lambda_0 + 0.3 \\mu_0$$\nThis is the general expression for the change in the net diversification rate. Now, we substitute the provided empirical estimates for the baseline parameters: $\\lambda_0 = 0.35$ and $\\mu_0 = 0.20$.\n$$\\Delta r = 0.1 \\times 0.35 + 0.3 \\times 0.20$$\nPerforming the multiplication:\n$$\\Delta r = 0.035 + 0.060$$\nThe final result is obtained by summation:\n$$\\Delta r = 0.095$$\nThe expected change in the net diversification rate is $0.095$ events per lineage per million years. The problem asks for this as a single real number.", "answer": "$$\\boxed{0.095}$$", "id": "2584172"}, {"introduction": "After hypothesizing that a key innovation caused a shift in diversification rates, we must statistically evaluate the evidence. Is a more complex model that includes a rate shift a better fit to our data than a simpler, constant-rate model? This practice introduces Bayesian model comparison, a powerful framework for weighing evidence between competing evolutionary scenarios. By calculating and interpreting the Bayes factor from model evidences [@problem_id:2584203], you will learn a fundamental skill for testing macroevolutionary hypotheses with phylogenetic data.", "problem": "A macroevolutionary study of a large angiosperm clade evaluates whether a putative key innovation (e.g., the origin of floral nectar spurs) is associated with a single shift in diversification rate. Two nested birth–death models are compared using Bayesian model comparison with equal prior odds: model $\\mathcal{M}_{0}$ assumes a constant diversification rate across the phylogeny (no shift), and model $\\mathcal{M}_{1}$ allows a single diversification rate shift coincident with the inferred origin of the key innovation. Marginal likelihoods (model evidences) are estimated via a thermodynamic integration procedure and summarized as log-evidences: $\\log \\mathcal{Z}_{1} = -1234.5$ for $\\mathcal{M}_{1}$ and $\\log \\mathcal{Z}_{0} = -1240.9$ for $\\mathcal{M}_{0}$. Using first-principles Bayesian model comparison starting from the definition of marginal likelihood and the definition of the Bayes factor as a ratio of model evidences, compute the Bayes factor in favor of $\\mathcal{M}_{1}$ relative to $\\mathcal{M}_{0}$. Then, based on widely used interpretive conventions in Bayesian model selection, briefly state whether the evidence for a single diversification rate shift associated with the key innovation is weak, moderate, strong, or decisive. Report the Bayes factor as a dimensionless ratio rounded to three significant figures.", "solution": "The problem requires the computation and interpretation of a Bayes factor to compare two competing macroevolutionary models, $\\mathcal{M}_{1}$ and $\\mathcal{M}_{0}$, based on their provided log-evidences. We proceed from the fundamental principles of Bayesian model comparison.\n\nLet $D$ denote the observed data, in this case, the phylogenetic tree and any associated character data. The posterior probability of a model $\\mathcal{M}_{i}$ is given by Bayes' theorem:\n$$P(\\mathcal{M}_{i}|D) = \\frac{P(D|\\mathcal{M}_{i}) P(\\mathcal{M}_{i})}{P(D)}$$\nwhere $P(D|\\mathcal{M}_{i})$ is the marginal likelihood or model evidence, $P(\\mathcal{M}_{i})$ is the prior probability of the model, and $P(D)$ is a normalizing constant.\n\nTo compare two models, $\\mathcal{M}_{1}$ and $\\mathcal{M}_{0}$, we examine the ratio of their posterior probabilities, known as the posterior odds:\n$$\\frac{P(\\mathcal{M}_{1}|D)}{P(\\mathcal{M}_{0}|D)} = \\frac{P(D|\\mathcal{M}_{1})}{P(D|\\mathcal{M}_{0})} \\times \\frac{P(\\mathcal{M}_{1})}{P(\\mathcal{M}_{0})}$$\nThis relationship can be stated as: Posterior Odds = Bayes Factor $\\times$ Prior Odds.\n\nThe Bayes factor, denoted $B_{10}$, is the ratio of the marginal likelihoods:\n$$B_{10} = \\frac{P(D|\\mathcal{M}_{1})}{P(D|\\mathcal{M}_{0})}$$\nThe problem provides the model evidences in the notation $\\mathcal{Z}_{i}$, where $\\mathcal{Z}_{i} \\equiv P(D|\\mathcal{M}_{i})$. Thus, the Bayes factor in favor of $\\mathcal{M}_{1}$ over $\\mathcal{M}_{0}$ is:\n$$B_{10} = \\frac{\\mathcal{Z}_{1}}{\\mathcal{Z}_{0}}$$\nThe problem supplies the log-evidences, $\\log \\mathcal{Z}_{1}$ and $\\log \\mathcal{Z}_{0}$. In the context of Bayesian statistics and methods like thermodynamic integration, the notation '$\\log$' conventionally refers to the natural logarithm, $\\ln$. We will proceed under this standard and necessary assumption.\n\nTo compute $B_{10}$, we first take the natural logarithm of the expression:\n$$\\ln(B_{10}) = \\ln\\left(\\frac{\\mathcal{Z}_{1}}{\\mathcal{Z}_{0}}\\right) = \\ln(\\mathcal{Z}_{1}) - \\ln(\\mathcal{Z}_{0})$$\nThe provided values are $\\ln(\\mathcal{Z}_{1}) = -1234.5$ and $\\ln(\\mathcal{Z}_{0}) = -1240.9$. Substituting these values into the equation:\n$$\\ln(B_{10}) = -1234.5 - (-1240.9) = -1234.5 + 1240.9 = 6.4$$\nTo find the Bayes factor $B_{10}$, we exponentiate the result:\n$$B_{10} = \\exp(\\ln(B_{10})) = \\exp(6.4)$$\nCalculating the numerical value:\n$$B_{10} \\approx 601.845$$\nThe problem requires the answer to be rounded to three significant figures.\n$$B_{10} \\approx 602$$\nThe Bayes factor is a dimensionless ratio. A value of $B_{10} \\approx 602$ indicates that the observed data are approximately $602$ times more probable under model $\\mathcal{M}_{1}$ (with a rate shift) than under model $\\mathcal{M}_{0}$ (with a constant rate).\n\nFor interpretation, we use established conventions, such as the scale proposed by Kass and Raftery (1995). On this scale, a Bayes factor $B_{10}  150$ is considered to provide \"very strong\" or \"decisive\" evidence in favor of model $\\mathcal{M}_{1}$. Since our calculated value is $B_{10} \\approx 602$, which is substantially greater than $150$, the evidence for a single diversification rate shift associated with the key innovation is decisive. An alternative view using the quantity $2\\ln(B_{10})$ yields $2 \\times 6.4 = 12.8$. A value greater than $10$ on this scale is also considered decisive evidence, confirming our conclusion.", "answer": "$$\\boxed{602}$$", "id": "2584203"}, {"introduction": "In nature, diversification is rarely driven by a single trait in isolation, and species data are not independent due to shared ancestry. Phylogenetic Generalized Least Squares (PGLS) is a robust statistical method that addresses both issues, allowing us to test for the effect of a key innovation while controlling for other confounding variables and accounting for the phylogenetic non-independence of lineages. This advanced exercise [@problem_id:2584221] delves into the mathematical engine of PGLS, providing a hands-on opportunity to understand how regression coefficients are estimated in a phylogenetic context.", "problem": "A clade of $n=50$ species is analyzed to test whether a binary key innovation ($K$, presence $=1$, absence $=0$) is associated with higher net diversification rate ($y$), controlling for a standardized continuous covariate ($Z$, e.g., log body size). You fit a phylogenetic generalized least squares (PGLS) regression with design matrix $X$ whose columns are the intercept, $K$, and $Z$, and with a phylogenetic covariance matrix $V$ of compound-symmetry form arising from shared ancestry under a Brownian-motion-like model with constant shared component:\n$$\nV \\;=\\; \\sigma^{2}\\big[(1-\\alpha) I_{n} + \\alpha J_{n}\\big],\n$$\nwhere $I_{n}$ is the $n\\times n$ identity matrix, $J_{n}=\\mathbf{1}\\mathbf{1}^{\\top}$ is the $n\\times n$ all-ones matrix, $\\sigma^{2}=1$, $\\alpha=\\tfrac{1}{4}$, and $\\mathbf{1}$ is the $n$-vector of ones. Assume the following empirically established summary properties of the predictors:\n- Balance and orthogonality: $\\sum_{i=1}^{n} K_{i}=25$, $\\sum_{i=1}^{n} K_{i}^{2}=25$, $\\sum_{i=1}^{n} Z_{i}=0$, $\\sum_{i=1}^{n} K_{i}Z_{i}=0$.\n- Standardization of $Z$: $\\sum_{i=1}^{n} Z_{i}^{2}=100$.\n\nYou are given the following sufficient statistics relating the response to the predictors:\n- $\\sum_{i=1}^{n} y_{i}=125$,\n- $\\sum_{i=1}^{n} K_{i}y_{i}=75$,\n- $\\sum_{i=1}^{n} Z_{i}y_{i}=100$.\n\nUsing first principles of generalized least squares (derive what you need from the definitions of weighted least squares and properties of rank-one updated matrices), compute the PGLS coefficient vector $\\hat{\\beta}$ for the regression of $y$ on the intercept, $K$, and $Z$ under the covariance $V$. Then provide a brief interpretation of the estimated effect of the key innovation on diversification, conditional on $Z$.\n\nReport the final coefficient vector in the order $(\\text{intercept}, K, Z)$ as a row matrix, with exact values and without units. Do not round.", "solution": "The problem statement is validated as scientifically grounded, well-posed, objective, and internally consistent. It presents a standard problem in phylogenetic comparative methods, specifically the estimation of regression coefficients using Phylogenetic Generalized Least Squares (PGLS). All data required for a unique solution are provided. We may therefore proceed with the derivation.\n\nThe specified model is a PGLS regression of the form $y = X\\beta + \\epsilon$, where $\\epsilon \\sim \\mathcal{N}(0, V)$. The vector of regression coefficients $\\beta$ is estimated by the generalized least squares (GLS) estimator:\n$$\n\\hat{\\beta} = (X^{\\top}V^{-1}X)^{-1}X^{\\top}V^{-1}y\n$$\nThe problem requires computing $\\hat{\\beta} = (\\hat{\\beta}_{\\text{intercept}}, \\hat{\\beta}_K, \\hat{\\beta}_Z)^{\\top}$.\n\nThe design matrix $X$ is an $n \\times 3$ matrix whose columns are the intercept vector $\\mathbf{1}$, the key innovation vector $K$, and the covariate vector $Z$. The number of species is $n=50$.\n$$\nX = \\begin{bmatrix} \\mathbf{1}  K  Z \\end{bmatrix}\n$$\nThe covariance matrix $V$ is given by $V = \\sigma^{2}\\big[(1-\\alpha) I_{n} + \\alpha J_{n}\\big]$, with $\\sigma^2=1$ and $\\alpha=\\frac{1}{4}$. Thus,\n$$\nV = \\frac{3}{4} I_{n} + \\frac{1}{4} J_{n} = \\frac{3}{4} I_n + \\frac{1}{4} \\mathbf{1}\\mathbf{1}^{\\top}\n$$\nThis matrix has the structure of a constant matrix plus a rank-one matrix. Its inverse can be found using the Sherman-Morrison-Woodbury formula. For a matrix of the form $A = c_1 I + c_2 \\mathbf{u}\\mathbf{v}^{\\top}$, its inverse is $A^{-1} = \\frac{1}{c_1} I - \\frac{c_2}{c_1(c_1 + c_2\\mathbf{v}^{\\top}\\mathbf{u})} \\mathbf{u}\\mathbf{v}^{\\top}$.\nHere, $c_1 = \\frac{3}{4}$, $c_2 = \\frac{1}{4}$, and $\\mathbf{u}=\\mathbf{v}=\\mathbf{1}$. The inner product is $\\mathbf{1}^{\\top}\\mathbf{1} = n = 50$.\nThe inverse is:\n$$\nV^{-1} = \\frac{1}{3/4}I_n - \\frac{1/4}{(3/4)(3/4 + (1/4) \\cdot 50)} J_n = \\frac{4}{3}I_n - \\frac{1/4}{(3/4)(53/4)} J_n = \\frac{4}{3}I_n - \\frac{1/4}{159/16} J_n\n$$\n$$\nV^{-1} = \\frac{4}{3}I_n - \\frac{4}{159}J_n\n$$\nLet us denote the coefficients of $V^{-1}$ as $v_1 = \\frac{4}{3}$ and $v_2 = -\\frac{4}{159}$.\n\nNext, we compute the matrix $M = X^{\\top}V^{-1}X$. The entries of this $3 \\times 3$ matrix are given by $M_{ij} = X_i^{\\top}V^{-1}X_j$, where $X_1=\\mathbf{1}$, $X_2=K$, and $X_3=Z$.\n$$\nX_i^{\\top} V^{-1} X_j = X_i^{\\top}(v_1 I_n + v_2 J_n)X_j = v_1 X_i^{\\top}X_j + v_2 X_i^{\\top}J_n X_j = v_1 (X_i^{\\top}X_j) + v_2 (X_i^{\\top}\\mathbf{1})(\\mathbf{1}^{\\top}X_j)\n$$\nWe use the provided summary statistics: $\\sum_{i=1}^{n} K_{i}=25$, $\\sum_{i=1}^{n} K_{i}^{2}=25$, $\\sum_{i=1}^{n} Z_{i}=0$, $\\sum_{i=1}^{n} K_{i}Z_{i}=0$, $\\sum_{i=1}^{n} Z_{i}^{2}=100$. Note that $X_i^{\\top}X_j = \\sum_{k=1}^n (X_i)_k (X_j)_k$ and $X_i^{\\top}\\mathbf{1} = \\sum_{k=1}^n (X_i)_k$.\n\n$M_{11} = \\mathbf{1}^{\\top}V^{-1}\\mathbf{1} = v_1(\\mathbf{1}^{\\top}\\mathbf{1}) + v_2(\\mathbf{1}^{\\top}\\mathbf{1})(\\mathbf{1}^{\\top}\\mathbf{1}) = v_1 n + v_2 n^2 = (v_1 + n v_2)n$.\n$v_1 + n v_2 = \\frac{4}{3} + 50(-\\frac{4}{159}) = \\frac{4 \\cdot 53 - 200}{159} = \\frac{212 - 200}{159} = \\frac{12}{159} = \\frac{4}{53}$.\n$M_{11} = 50 \\cdot \\frac{4}{53} = \\frac{200}{53}$.\n\n$M_{12} = \\mathbf{1}^{\\top}V^{-1}K = v_1(\\mathbf{1}^{\\top}K) + v_2(\\mathbf{1}^{\\top}\\mathbf{1})(\\mathbf{1}^{\\top}K) = (v_1 + n v_2)(\\sum K_i) = \\frac{4}{53} \\cdot 25 = \\frac{100}{53}$.\n$M_{21} = M_{12}$.\n\n$M_{22} = K^{\\top}V^{-1}K = v_1(K^{\\top}K) + v_2(K^{\\top}\\mathbf{1})(\\mathbf{1}^{\\top}K) = v_1(\\sum K_i^2) + v_2(\\sum K_i)^2 = \\frac{4}{3}(25) - \\frac{4}{159}(25)^2 = \\frac{100}{3} - \\frac{2500}{159} = \\frac{100 \\cdot 53 - 2500}{159} = \\frac{5300-2500}{159} = \\frac{2800}{159}$.\n\n$M_{13} = \\mathbf{1}^{\\top}V^{-1}Z = (v_1 + n v_2)(\\sum Z_i) = \\frac{4}{53} \\cdot 0 = 0$.\n$M_{31} = M_{13} = 0$.\n\n$M_{23} = K^{\\top}V^{-1}Z = v_1(\\sum K_i Z_i) + v_2(\\sum K_i)(\\sum Z_i) = v_1(0) + v_2(25)(0) = 0$.\n$M_{32} = M_{23} = 0$.\n\n$M_{33} = Z^{\\top}V^{-1}Z = v_1(\\sum Z_i^2) + v_2(\\sum Z_i)^2 = v_1(100) + v_2(0)^2 = \\frac{4}{3} \\cdot 100 = \\frac{400}{3}$.\n\nThe matrix $M = X^{\\top}V^{-1}X$ is:\n$$\nM = \\begin{pmatrix} \\frac{200}{53}  \\frac{100}{53}  0 \\\\ \\frac{100}{53}  \\frac{2800}{159}  0 \\\\ 0  0  \\frac{400}{3} \\end{pmatrix}\n$$\nNow we compute the vector $b = X^{\\top}V^{-1}y$.\n$b_1 = \\mathbf{1}^{\\top}V^{-1}y = (v_1+nv_2)\\sum y_i = \\frac{4}{53} \\cdot 125 = \\frac{500}{53}$.\n$b_2 = K^{\\top}V^{-1}y = v_1(\\sum K_i y_i) + v_2(\\sum K_i)(\\sum y_i) = \\frac{4}{3}(75) - \\frac{4}{159}(25)(125) = 100 - \\frac{12500}{159} = \\frac{15900-12500}{159} = \\frac{3400}{159}$.\n$b_3 = Z^{\\top}V^{-1}y = v_1(\\sum Z_i y_i) + v_2(\\sum Z_i)(\\sum y_i) = \\frac{4}{3}(100) + v_2(0)(125) = \\frac{400}{3}$.\n\nThe vector is $b = (\\frac{500}{53}, \\frac{3400}{159}, \\frac{400}{3})^{\\top}$.\n\nWe solve the system $M\\hat{\\beta} = b$. Due to the block-diagonal structure of $M$, we can solve for $\\hat{\\beta}_Z$ independently.\n$M_{33}\\hat{\\beta}_Z = b_3 \\implies \\frac{400}{3}\\hat{\\beta}_Z = \\frac{400}{3} \\implies \\hat{\\beta}_Z = 1$.\n\nFor the remaining coefficients $(\\hat{\\beta}_0, \\hat{\\beta}_K)$, we solve the system:\n$$\n\\begin{pmatrix} \\frac{200}{53}  \\frac{100}{53} \\\\ \\frac{100}{53}  \\frac{2800}{159} \\end{pmatrix} \\begin{pmatrix} \\hat{\\beta}_0 \\\\ \\hat{\\beta}_K \\end{pmatrix} = \\begin{pmatrix} \\frac{500}{53} \\\\ \\frac{3400}{159} \\end{pmatrix}\n$$\nWrite all denominators as $159$: $\\frac{200}{53}=\\frac{600}{159}$, $\\frac{100}{53}=\\frac{300}{159}$, $\\frac{500}{53}=\\frac{1500}{159}$.\n$$\n\\begin{pmatrix} \\frac{600}{159}  \\frac{300}{159} \\\\ \\frac{300}{159}  \\frac{2800}{159} \\end{pmatrix} \\begin{pmatrix} \\hat{\\beta}_0 \\\\ \\hat{\\beta}_K \\end{pmatrix} = \\begin{pmatrix} \\frac{1500}{159} \\\\ \\frac{3400}{159} \\end{pmatrix}\n$$\nMultiplying by $159$ and dividing by $100$ simplifies the system to:\n$$\n\\begin{pmatrix} 6  3 \\\\ 3  28 \\end{pmatrix} \\begin{pmatrix} \\hat{\\beta}_0 \\\\ \\hat{\\beta}_K \\end{pmatrix} = \\begin{pmatrix} 15 \\\\ 34 \\end{pmatrix}\n$$\nThe first equation is $6\\hat{\\beta}_0 + 3\\hat{\\beta}_K = 15$, or $2\\hat{\\beta}_0 + \\hat{\\beta}_K = 5$. This gives $\\hat{\\beta}_K = 5 - 2\\hat{\\beta}_0$.\nSubstituting into the second equation $3\\hat{\\beta}_0 + 28\\hat{\\beta}_K = 34$:\n$3\\hat{\\beta}_0 + 28(5 - 2\\hat{\\beta}_0) = 34$\n$3\\hat{\\beta}_0 + 140 - 56\\hat{\\beta}_0 = 34$\n$-53\\hat{\\beta}_0 = -106$\n$\\hat{\\beta}_0 = 2$.\nThen, $\\hat{\\beta}_K = 5 - 2(2) = 1$.\n\nThe PGLS coefficient vector is $\\hat{\\beta} = (\\hat{\\beta}_0, \\hat{\\beta}_K, \\hat{\\beta}_Z) = (2, 1, 1)$.\n\nInterpretation: The coefficient $\\hat{\\beta}_K = 1$ quantifies the effect of the key innovation on the net diversification rate, controlling for the covariate $Z$. Since $K$ is a binary variable representing absence ($K=0$) or presence ($K=1$), the estimated value $\\hat{\\beta}_K=1$ indicates that the presence of the key innovation is associated with an increase of $1$ unit in the net diversification rate compared to its absence, holding body size ($Z$) constant. This suggests a positive relationship between the innovation and diversification.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2  1  1\n\\end{pmatrix}\n}\n$$", "id": "2584221"}]}