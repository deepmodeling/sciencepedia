{"hands_on_practices": [{"introduction": "A foundational decision in any microbiome study is the choice of sequencing methodology, as it dictates the resolution of the data and the types of biological questions that can be answered. This exercise challenges you to compare the two dominant approaches—$16\\mathrm{S}$ rRNA amplicon sequencing and shotgun metagenomics—by reasoning from fundamental molecular principles [@problem_id:2617770]. By evaluating their respective strengths and weaknesses in contrasting host environments, you will develop the critical thinking skills needed to design robust and cost-effective microbiome experiments.", "problem": "A comparative study aims to characterize and interpret microbiomes across two host systems: an omnivorous fish gut (high microbial biomass, luminal content available) and the oak leaf phyllosphere (low microbial biomass, high host cell abundance, chloroplast-rich). The investigators must choose between ribosomal RNA amplicon sequencing targeting the bacterial $16\\mathrm{S}$ ribosomal RNA (rRNA) gene and shotgun metagenomic sequencing of total deoxyribonucleic acid (DNA). They want to draw reliable inferences about taxonomic composition and potential functional capacity, and they are aware that in the plant system a substantial fraction of DNA originates from host nuclei, mitochondria, and chloroplasts.\n\nFrom fundamental bases in molecular biology and ecology, reason to the most appropriate choice(s). Use these foundations without assuming any specialized prior formulae: the Central Dogma of molecular biology, the structure and conservation of ribosomal RNA genes with variable regions enabling taxonomic discrimination, the principles of polymerase chain reaction (PCR) amplification and primer annealing specificity, the fact that shotgun metagenomics sequences random DNA fragments without locus-specific amplification, and that the $16\\mathrm{S}$ rRNA gene copy number varies among bacterial and archaeal genomes. Assume that in the plant samples, plastid and mitochondrial loci homologous to bacterial $16\\mathrm{S}$ are abundant and that host DNA cannot be physically depleted perfectly. Also recognize that fungal community members in plants are often prominent and are better profiled with Internal Transcribed Spacer (ITS) markers than with bacterial $16\\mathrm{S}$.\n\nWhich option best distinguishes $16\\mathrm{S}$ rRNA amplicon sequencing from shotgun metagenomics in terms of taxonomic and functional resolution, key biases, and recommends when each is appropriate for the fish gut versus the oak phyllosphere, given the constraints above?\n\nA. $16\\mathrm{S}$ rRNA amplicon sequencing provides strain-level resolution and direct measurement of metabolic genes with minimal bias, because PCR amplifies a highly conserved locus, so co-amplification of host organellar sequences is negligible. Therefore, choose $16\\mathrm{S}$ amplicons for the oak leaves and shotgun metagenomics for the fish gut because plant host DNA is less problematic than animal host DNA.\n\nB. $16\\mathrm{S}$ rRNA amplicon sequencing typically resolves taxa at genus to species level but is limited for strain discrimination and functional inference, and is biased by primer mismatches and variation in $16\\mathrm{S}$ rRNA gene copy number; it is also susceptible to plant plastid and mitochondrial co-amplification unless blocking strategies are used. Shotgun metagenomics can achieve species to strain resolution and directly recover gene repertoires and pathways but is limited by high host DNA fractions in low-biomass samples. Thus, use shotgun metagenomics for the fish gut where microbial biomass is high and host DNA proportion is lower, and use $16\\mathrm{S}$ rRNA amplicons (with organelle-blocking oligonucleotides and, for fungi, ITS) for the oak phyllosphere unless robust host depletion and deep sequencing budgets enable shotgun.\n\nC. $16\\mathrm{S}$ rRNA amplicon sequencing uniformly profiles bacteria, archaea, and fungi at similar resolution and is largely free from copy-number bias; it is therefore preferred for plant roots over ITS. Shotgun metagenomics cannot be used for functional inference without complete reference genomes, so it is generally inferior for the fish gut where many uncultured taxa exist.\n\nD. Primer mismatch biases affect shotgun metagenomics and $16\\mathrm{S}$ rRNA amplicon sequencing equally, so method choice is driven only by desired endpoint: use shotgun for taxonomy and $16\\mathrm{S}$ rRNA amplicons for function. In plants, chloroplast DNA does not interfere with either approach because it can always be fully removed computationally, so shotgun is optimal for the oak phyllosphere.\n\nE. $16\\mathrm{S}$ rRNA amplicon sequencing avoids biases in archaeal-rich animal guts and yields direct pathway abundances via imputation, while shotgun metagenomics is preferable in leaves because chloroplast genomes are sufficiently divergent from bacteria to prevent interference and host reads do not affect downstream inferences after alignment filtering. Therefore, select $16\\mathrm{S}$ rRNA amplicons for the fish gut and shotgun metagenomics for the oak phyllosphere.", "solution": "The problem requires a critical comparison of two DNA sequencing methodologies—$16\\mathrm{S}$ ribosomal RNA (rRNA) amplicon sequencing and shotgun metagenomic sequencing—for characterizing microbial communities in two distinct environments: a high-biomass fish gut and a low-biomass, high-host-DNA plant phyllosphere. The evaluation must be based on fundamental principles of molecular biology and ecology provided in the problem statement.\n\nFirst, let us analyze the core characteristics of each method based on the stated principles.\n\n**Method 1: $16\\mathrm{S}$ rRNA Amplicon Sequencing**\nThis technique is based on the Polymerase Chain Reaction (PCR) to selectively amplify a specific marker gene, the $16\\mathrm{S}$ rRNA gene for bacteria and archaea. The primers target conserved regions of this gene, which flank variable regions. The sequences of these variable regions are then used for taxonomic identification.\n\n1.  **Taxonomic Resolution**: The information contained within a fragment of the $16\\mathrm{S}$ rRNA gene is generally sufficient for classification to the genus level, and sometimes the species level. However, because it is only a single, partial gene, it lacks the resolution to reliably distinguish between very closely related species or to differentiate strains within a species.\n2.  **Functional Inference**: This method sequences *only* the $16\\mathrm{S}$ rRNA gene. It provides no direct information about the functional genes (e.g., for metabolism, antibiotic resistance) present in the organisms' genomes. Functional potential can be *inferred* or *imputed* based on the taxonomic profile by referencing known genomes of related taxa, but this is an indirect prediction, not a direct measurement of the gene content in the sample.\n3.  **Biases and Limitations**:\n    a.  **PCR Primer Bias**: The primers used for PCR may not anneal with equal efficiency to the DNA of all taxa. Mismatches between primer and target sequences can lead to differential amplification, causing some taxa to be over-represented and others to be under-represented or missed entirely.\n    b.  **Gene Copy Number Variation**: As stated, the number of copies of the $16\\mathrm{S}$ rRNA gene varies among prokaryotic genomes (from $1$ to more than $15$). Organisms with higher copy numbers will produce more amplicons, leading to an overestimation of their relative abundance in the community. This is a significant source of quantitative bias.\n    c.  **Host and Organellar Contamination**: The problem correctly states that mitochondria and chloroplasts are of bacterial origin and possess their own ribosomes with rRNA genes homologous to the bacterial $16\\mathrm{S}$ rRNA gene. In samples with a high ratio of host-to-microbial cells, such as the oak leaf phyllosphere, \"universal\" bacterial primers can amplify these abundant organellar sequences, potentially overwhelming the signal from the true microbial community. Specialized strategies, such as using blocking oligonucleotides that bind to and prevent the amplification of organellar DNA, are often necessary.\n    d.  **Taxonomic Scope**: Standard $16\\mathrm{S}$ rRNA primers are designed for bacteria and archaea. They do not target eukaryotes, such as fungi. As stated, profiling fungal communities requires a different marker, typically the Internal Transcribed Spacer (ITS) region.\n\n**Method 2: Shotgun Metagenomic Sequencing**\nThis method involves sequencing the total DNA extracted from a sample without targeting any specific gene. DNA is randomly fragmented and sequenced, providing a sample of all the genetic material present.\n\n1.  **Taxonomic Resolution**: By sequencing fragments from entire genomes, this method provides much richer data for taxonomic classification. It can enable high-resolution identification down to the species and even strain level, often by assembling genomes from the metagenomic data (Metagenome-Assembled Genomes or MAGs) or by using a wider array of single-copy marker genes.\n2.  **Functional Inference**: This is the primary strength of shotgun metagenomics. It directly sequences the functional genes of the community, providing a comprehensive profile of the metabolic potential, or \"gene repertoire.\" This is a direct measurement, not an inference.\n3.  **Biases and Limitations**:\n    a.  **Host DNA Contamination**: This is the principal challenge. Since the sequencing is random, the proportion of reads from any given source reflects its proportion in the initial DNA pool. In a low-biomass sample dominated by host DNA (like the oak leaf), the vast majority of sequencing effort and cost will be expended on sequencing host DNA, leaving very few reads and thus insufficient coverage for the microbial genomes. As the problem states, physical depletion of host DNA is imperfect, and while computational removal of host reads is possible, it cannot recover the lost sequencing depth for the microbial fraction.\n    b.  **Bias Avoidance**: This method avoids the specific PCR primer and $16\\mathrm{S}$ copy-number biases inherent to amplicon sequencing.\n\n**Application to the Host Systems**\n\n*   **Fish Gut Sample**: Characterized by \"high microbial biomass.\" This high ratio of microbial-to-host DNA makes it an excellent candidate for shotgun metagenomics. The method will yield high-resolution taxonomic data and, crucially, direct functional information about the gut microbiome's metabolic capabilities. This is often the goal of gut microbiome research. While $16\\mathrm{S}$ sequencing could be done, it would provide significantly less information.\n*   **Oak Leaf Phyllosphere Sample**: Characterized by \"low microbial biomass\" and \"high host cell abundance, chloroplast-rich.\" Here, the overwhelming proportion of host and organellar DNA makes shotgun metagenomics prohibitively expensive and inefficient. Most reads would be non-microbial. The more pragmatic approach is $16\\mathrm{S}$ rRNA amplicon sequencing. This method uses PCR to enrich for the microbial signal. However, one must address the co-amplification of abundant chloroplast and mitochondrial $16\\mathrm{S}$-like genes, which necessitates the use of blocking oligonucleotides. To account for the prominent fungal community mentioned, a parallel analysis using ITS amplicon sequencing would be required for a complete picture.\n\nNow we evaluate the given options based on this analysis.\n\n**A. $16\\mathrm{S}$ rRNA amplicon sequencing provides strain-level resolution and direct measurement of metabolic genes with minimal bias, because PCR amplifies a highly conserved locus, so co-amplification of host organellar sequences is negligible. Therefore, choose $16\\mathrm{S}$ amplicons for the oak leaves and shotgun metagenomics for the fish gut because plant host DNA is less problematic than animal host DNA.**\nThis statement is fundamentally flawed. $16\\mathrm{S}$ sequencing does not provide strain-level resolution or direct functional data. It is known for significant biases (primer and copy number). Co-amplification of organellar DNA is a major, not negligible, problem in plants. The assertion that plant host DNA is \"less problematic\" is baseless and contradicts the problem setup for the phyllosphere. **Incorrect**.\n\n**B. $16\\mathrm{S}$ rRNA amplicon sequencing typically resolves taxa at genus to species level but is limited for strain discrimination and functional inference, and is biased by primer mismatches and variation in $16\\mathrm{S}$ rRNA gene copy number; it is also susceptible to plant plastid and mitochondrial co-amplification unless blocking strategies are used. Shotgun metagenomics can achieve species to strain resolution and directly recover gene repertoires and pathways but is limited by high host DNA fractions in low-biomass samples. Thus, use shotgun metagenomics for the fish gut where microbial biomass is high and host DNA proportion is lower, and use $16\\mathrm{S}$ rRNA amplicons (with organelle-blocking oligonucleotides and, for fungi, ITS) for the oak phyllosphere unless robust host depletion and deep sequencing budgets enable shotgun.**\nThis statement is a precise and accurate summary of the state of the art. It correctly describes the resolution, functional capacity, and biases of $16\\mathrm{S}$ sequencing. It correctly identifies the strengths and limitations of shotgun metagenomics. Most importantly, it makes the correct, reasoned recommendations for each biological system, including the necessary technical considerations (blocking oligos, ITS for fungi) for the challenging plant sample. **Correct**.\n\n**C. $16\\mathrm{S}$ rRNA amplicon sequencing uniformly profiles bacteria, archaea, and fungi at similar resolution and is largely free from copy-number bias; it is therefore preferred for plant roots over ITS. Shotgun metagenomics cannot be used for functional inference without complete reference genomes, so it is generally inferior for the fish gut where many uncultured taxa exist.**\nThis statement contains multiple falsehoods. $16\\mathrm{S}$ primers do not target fungi; ITS markers are used for that. $16\\mathrm{S}$ sequencing is subject to major copy-number bias. Shotgun metagenomics provides functional data by annotating genes against functional databases, which does not require complete reference genomes. It is actually a superior tool for studying uncultured taxa. **Incorrect**.\n\n**D. Primer mismatch biases affect shotgun metagenomics and $16\\mathrm{S}$ rRNA amplicon sequencing equally, so method choice is driven only by desired endpoint: use shotgun for taxonomy and $16\\mathrm{S}$ rRNA amplicons for function. In plants, chloroplast DNA does not interfere with either approach because it can always be fully removed computationally, so shotgun is optimal for the oak phyllosphere.**\nThis statement is catastrophically wrong. Primer mismatch bias is a hallmark of PCR-based methods like $16\\mathrm{S}$ sequencing, not shotgun metagenomics. The roles are reversed: $16\\mathrm{S}$ is for taxonomy (with limits), shotgun is for both high-res taxonomy and function. Computational removal of host/organelle reads from shotgun data does not solve the problem of wasted sequencing coverage, making it suboptimal for the oak leaf. **Incorrect**.\n\n**E. $16\\mathrm{S}$ rRNA amplicon sequencing avoids biases in archaeal-rich animal guts and yields direct pathway abundances via imputation, while shotgun metagenomics is preferable in leaves because chloroplast genomes are sufficiently divergent from bacteria to prevent interference and host reads do not affect downstream inferences after alignment filtering. Therefore, select $16\\mathrm{S}$ rRNA amplicons for the fish gut and shotgun metagenomics for the oak phyllosphere.**\nThis statement is incorrect. $16\\mathrm{S}$ sequencing has known biases against archaea. Imputation yields predicted, not direct, pathway abundances. The premise that shotgun metagenomics is preferable in leaves is flawed; the vast amount of host DNA is the key issue, and filtering it post-sequencing leads to drastically reduced microbial data. The final recommendation is the opposite of the correct one. **Incorrect**.\n\nBased on a rigorous analysis grounded in the provided principles, option B is the only one that presents a scientifically sound and complete comparison and recommendation.", "answer": "$$\\boxed{B}$$", "id": "2617770"}, {"introduction": "High-throughput sequencing experiments inherently produce a variable number of reads per sample, posing a significant challenge for comparative analyses. A common historical approach has been rarefaction—subsampling all libraries to a uniform depth—but this method is statistically flawed. This exercise guides you through a first-principles evaluation of how rarefaction impacts the bias and variance of diversity estimates [@problem_id:2617801]. Mastering this topic is essential for moving beyond outdated practices and adopting statistically robust methods for analyzing compositional data.", "problem": "A comparative study of gut microbiomes from two vertebrate host lineages with distinct physiologies measures amplicon sequence variant counts per sample by high-throughput sequencing. For each sample, the observed counts over taxa are generated by a multinomial sampling process with total reads $N$ and underlying true relative abundances $\\mathbf{p} = (p_1,\\dots,p_S)$, where $S$ is the total number of taxa in the regional pool. Investigators wish to compare within-sample diversity between host lineages using richness and Shannon diversity, while acknowledging that sequencing depth differs across samples.\n\nConsider the following foundational base:\n- Multinomial sampling: if $X_i$ denotes the count for taxon $i$ in a sample with total reads $N$, then $(X_1,\\dots,X_S) \\sim \\mathrm{Multinomial}(N,\\mathbf{p})$ and $\\hat{p}_i = X_i/N$ is the plug-in estimate of $p_i$.\n- Rarefaction: equalizing library sizes by subsampling without replacement to a fixed depth $n^\\star < N$ is equivalent to drawing $(R_1,\\dots,R_S)$ from a multivariate hypergeometric distribution conditional on $(X_1,\\dots,X_S)$, and then using $R_i/n^\\star$ in place of $\\hat{p}_i$.\n- Law of total variance: for any random variable $Y$ and conditioning variable $Z$, $\\mathrm{Var}(Y) = \\mathbb{E}[\\mathrm{Var}(Y \\mid Z)] + \\mathrm{Var}(\\mathbb{E}[Y \\mid Z])$.\n- Observed richness in a multinomial sample of size $n$ has expectation $\\sum_{i=1}^S \\left(1 - (1-p_i)^n\\right)$, which is strictly increasing in $n$ for any $p_i \\in (0,1)$.\n- The Shannon entropy of the true community is $H = -\\sum_{i=1}^S p_i \\log p_i$. The plug-in estimator based on empirical proportions has a negative small-sample bias that worsens as $n$ decreases, a consequence of the concavity of the logarithm.\n\nUsing only these principles, evaluate how rarefaction affects the variance and bias of richness and Shannon diversity estimates across samples with heterogeneous $N$. Then, select the option that both correctly characterizes these effects and proposes a statistically principled alternative that preserves sample-size differences while controlling for compositionality in microbiome data.\n\nWhich option is most appropriate?\n\nA. Rarefaction equalizes $N$ and therefore reduces variance in richness and Shannon estimates; by discarding reads it also removes low-abundance noise and eliminates bias. It should be preferred in all cases.\n\nB. Rarefaction introduces an extra hypergeometric sampling stage that inflates variance, and by reducing $n$ it increases negative bias in plug-in Shannon estimates and reduces expected observed richness; instead, retain all counts and model them with a multinomial or Dirichlet–multinomial likelihood including sample-specific library size as an offset, estimate alpha diversity using coverage-standardized Hill numbers, and address compositionality with log-ratio transforms (for example, centered log-ratio) or validated reference frames; this preserves differences in $N$ without discarding data.\n\nC. Rarefaction leaves bias unchanged because it is an unbiased resampling scheme and typically lowers variance in diversity estimates; a better alternative is total-sum scaling to relative abundances followed by Euclidean analysis, which controls compositionality by making all vectors sum to $1$.\n\nD. Rarefaction reduces bias by removing rare taxa that are mostly sequencing errors; a superior approach is to filter all low-count taxa and then compare observed richness with standard $t$-tests using the filtered data.\n\nE. Rarefaction increases variance but also eliminates compositional effects by matching depths; an alternative is to always rarefy to the minimum $N$ observed and analyze untransformed proportions, because compositionality is no longer a concern when depths are equalized.", "solution": "The problem requires an evaluation of rarefaction using the provided statistical principles.\n\n**Analysis of Rarefaction:**\n1.  **Effect on Variance:** Rarefaction introduces an additional hypergeometric sampling stage. According to the Law of Total Variance ($\\mathrm{Var}(Y) = \\mathbb{E}[\\mathrm{Var}(Y \\mid Z)] + \\mathrm{Var}(\\mathbb{E}[Y \\mid Z])$), this additional random process inflates the total variance of the diversity estimate. Discarding data makes the estimates less precise.\n2.  **Effect on Bias:** The provided principles state that expected observed richness is an increasing function of sample size, and the negative bias of the Shannon estimator worsens as sample size decreases. Since rarefaction reduces sample size from $N$ to a smaller $n^\\star$, it systematically reduces expected richness and increases the negative bias of Shannon diversity estimates.\n\nTherefore, rarefaction is a statistically flawed method that discards data, inflates variance, and increases bias. A principled alternative should use all data and properly account for library size and compositionality.\n\n**Evaluation of Options:**\n-   Option A is incorrect because rarefaction inflates variance and increases bias; it does not reduce or eliminate them.\n-   Option B is correct. It accurately identifies the statistical flaws of rarefaction (inflated variance, increased bias) and correctly describes the modern, statistically sound alternatives: using all counts in models that account for library size (e.g., as an offset), using coverage-standardized diversity measures, and applying log-ratio transformations to handle compositionality.\n-   Option C is incorrect. It misstates the effects on bias and variance. Its proposed alternative (total-sum scaling with Euclidean analysis) is known to be invalid for compositional data.\n-   Option D is incorrect. Its premise about bias reduction is false, and its proposed alternative (ad-hoc filtering) is not statistically principled.\n-   Option E is incorrect. It correctly identifies the variance inflation but falsely claims rarefaction eliminates compositional effects, which are an inherent property of the data regardless of sequencing depth.", "answer": "$$\\boxed{B}$$", "id": "2617801"}, {"introduction": "To truly understand the role of the microbiome, we must move beyond cataloging taxa to modeling their collective functions. Flux Balance Analysis (FBA) is a powerful computational framework for predicting metabolic activity and growth based on the principle of mass balance under environmental constraints. In this practice, you will construct and solve a stoichiometric model of a simple cross-feeding microbial community, a common motif in host-associated ecosystems [@problem_id:2617800]. This exercise provides a practical entry point into the world of systems biology, demonstrating how to formalize and test hypotheses about metabolic interactions within the microbiome.", "problem": "You are modeling a minimal, scientifically plausible, stoichiometric community metabolic network for a cross-feeding microbial pair living in a host-associated environment. Microbe $1$ ferments glucose to lactate and requires acetate to build biomass; Microbe $2$ oxidizes lactate to acetate using oxygen and also forms its own biomass from lactate. The host imposes constraints on nutrient supply and on how quickly extracellular acetate and lactate can be cleared. Use the steady-state mass balance formulation and Flux Balance Analysis (FBA) to predict the specific growth rates of both microbes under several host-imposed constraints.\n\nFundamental base to use:\n- Steady-state mass balance for metabolites given by $$S \\, v = 0,$$ where $S$ is the stoichiometric matrix and $v$ is the vector of reaction fluxes.\n- Linear bounds on reaction fluxes to represent uptake limits and host clearance capacities.\n- Linear programming to maximize a linear community objective function (sum of growth rates).\n\nNetwork specification:\n- Metabolites are divided into extracellular and intracellular pools. Extracellular metabolites: $\\mathrm{Glc_e}$, $\\mathrm{Lac_e}$, $\\mathrm{Ace_e}$, $\\mathrm{NH4_e}$, $\\mathrm{O2_e}$, $\\mathrm{CO2_e}$. Intracellular pools for Microbe $1$: $\\mathrm{Glc1}$, $\\mathrm{Lac1}$, $\\mathrm{Ace1}$, $\\mathrm{NH4\\_1}$, $\\mathrm{ATP1}$, $\\mathrm{ADP1}$, $\\mathrm{Pi1}$, $\\mathrm{B1}$. Intracellular pools for Microbe $2$: $\\mathrm{Lac2}$, $\\mathrm{Ace2}$, $\\mathrm{NH4\\_2}$, $\\mathrm{O2\\_2}$, $\\mathrm{ATP2}$, $\\mathrm{ADP2}$, $\\mathrm{Pi2}$, $\\mathrm{B2}$.\n- Reactions (all are irreversible with lower bound $0$ and large upper bound unless otherwise specified):\n\nExternal supply and host clearance:\n1. $\\mathrm{Glc\\_src}: \\quad \\varnothing \\rightarrow \\mathrm{Glc\\_e}$ with $0 \\le v \\le G$.\n2. $\\mathrm{O2\\_src}: \\quad \\varnothing \\rightarrow \\mathrm{O2\\_e}$ with $0 \\le v \\le O$.\n3. $\\mathrm{NH4\\_src}: \\quad \\varnothing \\rightarrow \\mathrm{NH4\\_e}$ with $0 \\le v \\le N$, where $N$ is a large number (set $N = 10^6$).\n4. $\\mathrm{Ace\\_sink}: \\quad \\mathrm{Ace\\_e} \\rightarrow \\varnothing$ with $0 \\le v \\le A$.\n5. $\\mathrm{Lac\\_sink}: \\quad \\mathrm{Lac\\_e} \\rightarrow \\varnothing$ with $0 \\le v \\le L$.\n6. $\\mathrm{CO2\\_sink}: \\quad \\mathrm{CO2\\_e} \\rightarrow \\varnothing$ with $0 \\le v \\le 10^6$.\n\nTransport for Microbe $1$:\n7. $\\mathrm{M1\\_Glc\\_upt}: \\quad \\mathrm{Glc\\_e} \\rightarrow \\mathrm{Glc1}$.\n8. $\\mathrm{M1\\_Ace\\_upt}: \\quad \\mathrm{Ace\\_e} \\rightarrow \\mathrm{Ace1}$.\n9. $\\mathrm{M1\\_Lac\\_sec}: \\quad \\mathrm{Lac1} \\rightarrow \\mathrm{Lac\\_e}$.\n10. $\\mathrm{M1\\_NH4\\_upt}: \\quad \\mathrm{NH4\\_e} \\rightarrow \\mathrm{NH4\\_1}$.\n\nTransport for Microbe $2$:\n11. $\\mathrm{M2\\_Lac\\_upt}: \\quad \\mathrm{Lac\\_e} \\rightarrow \\mathrm{Lac2}$.\n12. $\\mathrm{M2\\_Ace\\_sec}: \\quad \\mathrm{Ace2} \\rightarrow \\mathrm{Ace\\_e}$.\n13. $\\mathrm{M2\\_O2\\_upt}: \\quad \\mathrm{O2\\_e} \\rightarrow \\mathrm{O2\\_2}$.\n14. $\\mathrm{M2\\_NH4\\_upt}: \\quad \\mathrm{NH4\\_e} \\rightarrow \\mathrm{NH4\\_2}$.\n\nInternal metabolism Microbe $1$:\n15. $\\mathrm{M1\\_ferm}: \\quad \\mathrm{Glc1} + 2\\,\\mathrm{ADP1} + 2\\,\\mathrm{Pi1} \\rightarrow 2\\,\\mathrm{Lac1} + 2\\,\\mathrm{ATP1}$.\n16. $\\mathrm{M1\\_assim}: \\quad \\mathrm{Ace1} + \\mathrm{ATP1} \\rightarrow \\mathrm{B1} + \\mathrm{ADP1} + \\mathrm{Pi1}$.\n17. $\\mathrm{M1\\_biomass}: \\quad \\mathrm{B1} + \\mathrm{NH4\\_1} + \\mathrm{ATP1} \\rightarrow \\mathrm{ADP1} + \\mathrm{Pi1}$, the flux of this reaction is the specific growth rate $\\mu_1$ of Microbe $1$ in $\\mathrm{h}^{-1}$.\n18. $\\mathrm{M1\\_ATPM}: \\quad \\mathrm{ATP1} \\rightarrow \\mathrm{ADP1} + \\mathrm{Pi1}$ with lower bound $0$ and large upper bound.\n\nInternal metabolism Microbe $2$:\n19. $\\mathrm{M2\\_ox}: \\quad \\mathrm{Lac2} + \\mathrm{O2\\_2} + 3\\,\\mathrm{ADP2} + 3\\,\\mathrm{Pi2} \\rightarrow \\mathrm{Ace2} + 3\\,\\mathrm{ATP2} + \\mathrm{CO2\\_e}$.\n20. $\\mathrm{M2\\_bioprec}: \\quad \\mathrm{Lac2} + \\mathrm{ATP2} \\rightarrow \\mathrm{B2} + \\mathrm{ADP2} + \\mathrm{Pi2} + \\mathrm{CO2\\_e}$.\n21. $\\mathrm{M2\\_biomass}: \\quad \\mathrm{B2} + \\mathrm{NH4\\_2} + \\mathrm{ATP2} \\rightarrow \\mathrm{ADP2} + \\mathrm{Pi2}$, the flux of this reaction is the specific growth rate $\\mu_2$ of Microbe $2$ in $\\mathrm{h}^{-1}$.\n22. $\\mathrm{M2\\_ATPM}: \\quad \\mathrm{ATP2} \\rightarrow \\mathrm{ADP2} + \\mathrm{Pi2}$ with lower bound $0$ and large upper bound.\n\nObjective:\n- Maximize the community growth rate given by $$\\text{maximize } \\mu_1 + \\mu_2,$$ subject to $$S\\,v = 0$$ and the bounds above. Interpret $\\mu_1$ as the flux of $\\mathrm{M1\\_biomass}$ and $\\mu_2$ as the flux of $\\mathrm{M2\\_biomass}$, in $\\mathrm{h}^{-1}$.\n\nTest suite and parameters:\nLet the host supplies and clearances be given for four cases as tuples $(G,O,A,L)$, where $G$ is maximum glucose supply, $O$ is maximum oxygen supply, $A$ is maximum acetate clearance capacity, and $L$ is maximum lactate clearance capacity, all in consistent flux units per hour. Use $N = 10^6$ for ammonium supply in all cases.\n\n- Case $1$: $(G,O,A,L) = (10,10,5,5)$.\n- Case $2$: $(G,O,A,L) = (10,0,5,100)$.\n- Case $3$: $(G,O,A,L) = (2,10,0.1,0.1)$.\n- Case $4$: $(G,O,A,L) = (50,100,20,20)$.\n\nFinal output format:\n- Your program should produce a single line of output containing a list of four items, one per test case, where each item is a two-element list $[\\mu_1,\\mu_2]$ with each value rounded to six decimal places. For example: `[[x_1,y_1],[x_2,y_2],[x_3,y_3],[x_4,y_4]]` with no extra spaces.", "solution": "The core principle of FBA is the assumption of a pseudo-steady state for the intracellular metabolite concentrations. This leads to the mass balance equation for all metabolites in the system:\n$$S \\cdot \\mathbf{v} = \\mathbf{0}$$\nwhere $S$ is the stoichiometric matrix of dimensions $m \\times n$ ($m$ metabolites, $n$ reactions), and $\\mathbf{v}$ is the vector of $n$ reaction fluxes. The entries $S_{ij}$ of the matrix represent the stoichiometric coefficient of metabolite $i$ in reaction $j$. A positive coefficient indicates production, and a negative coefficient indicates consumption.\n\nThe system is further constrained by thermodynamic and environmental limitations, which are expressed as lower and upper bounds on the individual fluxes:\n$$ \\mathbf{v}_{lb} \\le \\mathbf{v} \\le \\mathbf{v}_{ub} $$\nFor irreversible reactions, the lower bound is typically $0$. The upper bounds are determined by factors such as enzyme capacity, nutrient availability from the host ($G$, $O$), or host clearance capacity ($A$, $L$).\n\nThe biological objective, in this case, maximizing community growth, is formulated as a linear objective function to be maximized:\n$$ Z = \\mathbf{c}^T \\cdot \\mathbf{v} $$\nwhere $\\mathbf{c}$ is a vector that selects the flux(es) of interest. Here, we wish to maximize $\\mu_1 + \\mu_2$, where $\\mu_1$ is the flux of the biomass reaction for Microbe 1 ($v_{\\text{M1\\_biomass}}$) and $\\mu_2$ is the flux of the biomass reaction for Microbe 2 ($v_{\\text{M2\\_biomass}}$).\n\nCombining these elements yields a standard LP problem:\n$$ \\begin{aligned} \\text{maximize} \\quad & \\mathbf{c}^T \\cdot \\mathbf{v} \\\\ \\text{subject to} \\quad & S \\cdot \\mathbf{v} = \\mathbf{0} \\\\ & \\mathbf{v}_{lb} \\le \\mathbf{v} \\le \\mathbf{v}_{ub} \\end{aligned} $$\nStandard LP solvers typically perform minimization. Thus, we will minimize $-Z = -\\mathbf{c}^T \\cdot \\mathbf{v}$.\n\nTo solve the specific problem, we first construct the stoichiometric matrix $S$ from the $22$ given reactions and $22$ metabolites. The metabolites and reactions are ordered systematically to define the rows and columns of $S$. Let the metabolites be ordered as: $6$ extracellular ($\\mathrm{Glc_e}$, $\\mathrm{Lac_e}$, $\\mathrm{Ace_e}$, $\\mathrm{NH4_e}$, $\\mathrm{O2_e}$, $\\mathrm{CO2_e}$), followed by $8$ for Microbe 1 ($\\mathrm{Glc1}$, $\\mathrm{Lac1}$, ..., $\\mathrm{B1}$), and $8$ for Microbe 2 ($\\mathrm{Lac2}$, $\\mathrm{Ace2}$, ..., $\\mathrm{B2}$). Let the reactions be ordered as they are listed in the problem statement. The resulting $S$ is a $22 \\times 22$ matrix.\n\nFor example, the mass balance for the extracellular lactate ($\\mathrm{Lac_e}$) involves its secretion by Microbe 1 ($v_9$), its clearance by the host ($v_5$), and its uptake by Microbe 2 ($v_{11}$). The corresponding row in the $S \\cdot \\mathbf{v} = \\mathbf{0}$ equation is:\n$$ +1 \\cdot v_9 - 1 \\cdot v_5 - 1 \\cdot v_{11} = 0 $$\n\nThe objective vector $\\mathbf{c}$ is constructed to represent the maximization of $\\mu_1 + \\mu_2$. Given that $\\mu_1$ is the flux of reaction $17$ ($v_{17}$) and $\\mu_2$ is the flux of reaction $21$ ($v_{21}$), we want to maximize $v_{17} + v_{21}$. For a minimization solver, the objective vector $\\mathbf{c}$ will be a vector of zeros, with $-1$ at the positions corresponding to $v_{17}$ and $v_{21}$.\n\nThe flux bounds are defined for each test case. All reactions are given as irreversible, so all lower bounds are $0$. The upper bounds are specified as follows:\n- $v_1 \\le G$\n- $v_2 \\le O$\n- $v_3 \\le N = 10^6$\n- $v_4 \\le A$\n- $v_5 \\le L$\n- $v_6 \\le 10^6$\n- All other reaction fluxes ($v_7$ through $v_{22}$) are given a large upper bound, for which we use $10^6$, consistent with the non-limiting supply of ammonium.\n\nFor each of the four test cases $(G, O, A, L)$, we assemble the corresponding flux bounds vector $\\mathbf{v}_{ub}$ and solve the defined LP problem using a numerical solver, specifically `scipy.optimize.linprog`. The resulting optimal flux vector $\\mathbf{v}^*$ provides the solution. The growth rates $\\mu_1$ and $\\mu_2$ are then extracted from this vector as $v_{17}^*$ and $v_{21}^*$, respectively. The final values are rounded to six decimal places as required. The provided Python code implements this entire procedure.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the Flux Balance Analysis problem for the microbial community.\n    \"\"\"\n    # Test cases as tuples (G, O, A, L)\n    test_cases = [\n        (10, 10, 5, 5),\n        (10, 0, 5, 100),\n        (2, 10, 0.1, 0.1),\n        (50, 100, 20, 20),\n    ]\n\n    # There are 22 metabolites and 22 reactions.\n    num_metabolites = 22\n    num_reactions = 22\n    \n    # Stoichiometric matrix S (22x22)\n    S = np.zeros((num_metabolites, num_reactions))\n\n    # Metabolite indices (0-based)\n    met_map = {\n        'Glc_e': 0, 'Lac_e': 1, 'Ace_e': 2, 'NH4_e': 3, 'O2_e': 4, 'CO2_e': 5,\n        'Glc1': 6, 'Lac1': 7, 'Ace1': 8, 'NH4_1': 9, 'ATP1': 10, 'ADP1': 11, 'Pi1': 12, 'B1': 13,\n        'Lac2': 14, 'Ace2': 15, 'NH4_2': 16, 'O2_2': 17, 'ATP2': 18, 'ADP2': 19, 'Pi2': 20, 'B2': 21\n    }\n\n    # Reaction indices (0-based)\n    rxn_map = {\n        'Glc_src': 0, 'O2_src': 1, 'NH4_src': 2, 'Ace_sink': 3, 'Lac_sink': 4, 'CO2_sink': 5,\n        'M1_Glc_upt': 6, 'M1_Ace_upt': 7, 'M1_Lac_sec': 8, 'M1_NH4_upt': 9,\n        'M2_Lac_upt': 10, 'M2_Ace_sec': 11, 'M2_O2_upt': 12, 'M2_NH4_upt': 13,\n        'M1_ferm': 14, 'M1_assim': 15, 'M1_biomass': 16, 'M1_ATPM': 17,\n        'M2_ox': 18, 'M2_bioprec': 19, 'M2_biomass': 20, 'M2_ATPM': 21\n    }\n\n    # Reaction definitions: S[met_idx, rxn_idx] = stoich_coeff\n    # 1. Glc_src: -> Glc_e\n    S[met_map['Glc_e'], rxn_map['Glc_src']] = 1\n    # 2. O2_src: -> O2_e\n    S[met_map['O2_e'], rxn_map['O2_src']] = 1\n    # 3. NH4_src: -> NH4_e\n    S[met_map['NH4_e'], rxn_map['NH4_src']] = 1\n    # 4. Ace_sink: Ace_e -> \n    S[met_map['Ace_e'], rxn_map['Ace_sink']] = -1\n    # 5. Lac_sink: Lac_e ->\n    S[met_map['Lac_e'], rxn_map['Lac_sink']] = -1\n    # 6. CO2_sink: CO2_e ->\n    S[met_map['CO2_e'], rxn_map['CO2_sink']] = -1\n    # 7. M1_Glc_upt: Glc_e -> Glc1\n    S[met_map['Glc_e'], rxn_map['M1_Glc_upt']] = -1\n    S[met_map['Glc1'], rxn_map['M1_Glc_upt']] = 1\n    # 8. M1_Ace_upt: Ace_e -> Ace1\n    S[met_map['Ace_e'], rxn_map['M1_Ace_upt']] = -1\n    S[met_map['Ace1'], rxn_map['M1_Ace_upt']] = 1\n    # 9. M1_Lac_sec: Lac1 -> Lac_e\n    S[met_map['Lac1'], rxn_map['M1_Lac_sec']] = -1\n    S[met_map['Lac_e'], rxn_map['M1_Lac_sec']] = 1\n    # 10. M1_NH4_upt: NH4_e -> NH4_1\n    S[met_map['NH4_e'], rxn_map['M1_NH4_upt']] = -1\n    S[met_map['NH4_1'], rxn_map['M1_NH4_upt']] = 1\n    # 11. M2_Lac_upt: Lac_e -> Lac2\n    S[met_map['Lac_e'], rxn_map['M2_Lac_upt']] = -1\n    S[met_map['Lac2'], rxn_map['M2_Lac_upt']] = 1\n    # 12. M2_Ace_sec: Ace2 -> Ace_e\n    S[met_map['Ace2'], rxn_map['M2_Ace_sec']] = -1\n    S[met_map['Ace_e'], rxn_map['M2_Ace_sec']] = 1\n    # 13. M2_O2_upt: O2_e -> O2_2\n    S[met_map['O2_e'], rxn_map['M2_O2_upt']] = -1\n    S[met_map['O2_2'], rxn_map['M2_O2_upt']] = 1\n    # 14. M2_NH4_upt: NH4_e -> NH4_2\n    S[met_map['NH4_e'], rxn_map['M2_NH4_upt']] = -1\n    S[met_map['NH4_2'], rxn_map['M2_NH4_upt']] = 1\n    # 15. M1_ferm: Glc1 + 2 ADP1 + 2 Pi1 -> 2 Lac1 + 2 ATP1\n    S[met_map['Glc1'], rxn_map['M1_ferm']] = -1\n    S[met_map['ADP1'], rxn_map['M1_ferm']] = -2\n    S[met_map['Pi1'], rxn_map['M1_ferm']] = -2\n    S[met_map['Lac1'], rxn_map['M1_ferm']] = 2\n    S[met_map['ATP1'], rxn_map['M1_ferm']] = 2\n    # 16. M1_assim: Ace1 + ATP1 -> B1 + ADP1 + Pi1\n    S[met_map['Ace1'], rxn_map['M1_assim']] = -1\n    S[met_map['ATP1'], rxn_map['M1_assim']] = -1\n    S[met_map['B1'], rxn_map['M1_assim']] = 1\n    S[met_map['ADP1'], rxn_map['M1_assim']] = 1\n    S[met_map['Pi1'], rxn_map['M1_assim']] = 1\n    # 17. M1_biomass: B1 + NH4_1 + ATP1 -> ADP1 + Pi1\n    S[met_map['B1'], rxn_map['M1_biomass']] = -1\n    S[met_map['NH4_1'], rxn_map['M1_biomass']] = -1\n    S[met_map['ATP1'], rxn_map['M1_biomass']] = -1\n    S[met_map['ADP1'], rxn_map['M1_biomass']] = 1\n    S[met_map['Pi1'], rxn_map['M1_biomass']] = 1\n    # 18. M1_ATPM: ATP1 -> ADP1 + Pi1\n    S[met_map['ATP1'], rxn_map['M1_ATPM']] = -1\n    S[met_map['ADP1'], rxn_map['M1_ATPM']] = 1\n    S[met_map['Pi1'], rxn_map['M1_ATPM']] = 1\n    # 19. M2_ox: Lac2 + O2_2 + 3 ADP2 + 3 Pi2 -> Ace2 + 3 ATP2 + CO2_e\n    S[met_map['Lac2'], rxn_map['M2_ox']] = -1\n    S[met_map['O2_2'], rxn_map['M2_ox']] = -1\n    S[met_map['ADP2'], rxn_map['M2_ox']] = -3\n    S[met_map['Pi2'], rxn_map['M2_ox']] = -3\n    S[met_map['Ace2'], rxn_map['M2_ox']] = 1\n    S[met_map['ATP2'], rxn_map['M2_ox']] = 3\n    S[met_map['CO2_e'], rxn_map['M2_ox']] = 1\n    # 20. M2_bioprec: Lac2 + ATP2 -> B2 + ADP2 + Pi2 + CO2_e\n    S[met_map['Lac2'], rxn_map['M2_bioprec']] = -1\n    S[met_map['ATP2'], rxn_map['M2_bioprec']] = -1\n    S[met_map['B2'], rxn_map['M2_bioprec']] = 1\n    S[met_map['ADP2'], rxn_map['M2_bioprec']] = 1\n    S[met_map['Pi2'], rxn_map['M2_bioprec']] = 1\n    S[met_map['CO2_e'], rxn_map['M2_bioprec']] = 1\n    # 21. M2_biomass: B2 + NH4_2 + ATP2 -> ADP2 + Pi2\n    S[met_map['B2'], rxn_map['M2_biomass']] = -1\n    S[met_map['NH4_2'], rxn_map['M2_biomass']] = -1\n    S[met_map['ATP2'], rxn_map['M2_biomass']] = -1\n    S[met_map['ADP2'], rxn_map['M2_biomass']] = 1\n    S[met_map['Pi2'], rxn_map['M2_biomass']] = 1\n    # 22. M2_ATPM: ATP2 -> ADP2 + Pi2\n    S[met_map['ATP2'], rxn_map['M2_ATPM']] = -1\n    S[met_map['ADP2'], rxn_map['M2_ATPM']] = 1\n    S[met_map['Pi2'], rxn_map['M2_ATPM']] = 1\n\n    # Objective function: maximize mu1 + mu2, which means minimize -(mu1 + mu2)\n    # mu1 is v_M1_biomass (rxn 16), mu2 is v_M2_biomass (rxn 20)\n    c = np.zeros(num_reactions)\n    c[rxn_map['M1_biomass']] = -1\n    c[rxn_map['M2_biomass']] = -1\n\n    # Equality constraints S*v = 0\n    b_eq = np.zeros(num_metabolites)\n\n    # N is defined as 10^6\n    N = 10**6\n    large_bound = 10**6\n    \n    results = []\n    mu1_idx = rxn_map['M1_biomass']\n    mu2_idx = rxn_map['M2_biomass']\n\n    for G, O, A, L in test_cases:\n        # Bounds for fluxes: 0 <= v <= ub. All reactions are irreversible.\n        bounds = [(0, large_bound)] * num_reactions\n        bounds[rxn_map['Glc_src']] = (0, G)\n        bounds[rxn_map['O2_src']] = (0, O)\n        bounds[rxn_map['NH4_src']] = (0, N)\n        bounds[rxn_map['Ace_sink']] = (0, A)\n        bounds[rxn_map['Lac_sink']] = (0, L)\n        bounds[rxn_map['CO2_sink']] = (0, large_bound) # Was specified as 10^6\n\n        res = linprog(c, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n        if res.success:\n            mu1 = res.x[mu1_idx] if res.x[mu1_idx] > 1e-9 else 0.0\n            mu2 = res.x[mu2_idx] if res.x[mu2_idx] > 1e-9 else 0.0\n            results.append([mu1, mu2])\n        else:\n            # Append null result if optimization fails\n            results.append([0.0, 0.0])\n    \n    # Format the final output string\n    output_parts = [f\"[{r[0]:.6f},{r[1]:.6f}]\" for r in results]\n    print(f\"[{','.join(output_parts)}]\")\n\nsolve()\n```", "id": "2617800"}]}