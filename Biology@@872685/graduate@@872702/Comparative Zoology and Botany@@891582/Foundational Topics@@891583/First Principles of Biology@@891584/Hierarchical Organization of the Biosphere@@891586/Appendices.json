{"hands_on_practices": [{"introduction": "The hierarchical organization of the biosphere begins with its fundamental units: species. However, delineating species can be a complex challenge, especially in cases like ring species where populations are geographically connected. This practice provides a hands-on introduction to modern species delimitation by applying a Bayesian statistical framework to genetic data [@problem_id:2580969]. You will derive and implement a model from first principles to compute a Bayes factor, which quantifies the evidence for a two-species model versus a single-species model, offering a powerful way to make objective, evidence-based conclusions about biological organization at its most foundational level.", "problem": "You are studying the hierarchical organization of the biosphere at the species level by comparing two alternative hypotheses for how diploid genotypes are organized across space in a salamander ring species scenario. The two hypotheses are: $H_1$ (one species): both geographic groups are a single panmictic species sharing the same allele frequency at each locus; $H_2$ (two species): the two geographic groups are distinct species with independent allele frequencies at each locus. Use fundamental population genetic modeling assumptions that within each species, diploid individuals conform to Hardy–Weinberg Equilibrium (HWE), and that across unlinked loci, data are independent given the allele frequencies. Under HWE, allele counts are sufficient statistics for genotype data. Assume a Beta prior $\\mathrm{Beta}(\\alpha,\\beta)$ on the allele frequency for each species at each locus, with $\\alpha=\\beta=1$ (uniform prior on allele frequency). For each locus $\\ell$, let the data be $k_{1\\ell}$ successes (allele $A$) out of $m_{1\\ell}$ total Bernoulli trials (chromosomes) in group $1$, and $k_{2\\ell}$ out of $m_{2\\ell}$ in group $2$.\n\nStarting only from the following foundations:\n- The binomial sampling model for allele counts under Hardy–Weinberg Equilibrium (HWE).\n- The Beta prior $\\mathrm{Beta}(\\alpha,\\beta)$ on the allele frequency parameter $p$.\n- The Beta function identity $\\mathrm{B}(x,y)=\\dfrac{\\Gamma(x)\\Gamma(y)}{\\Gamma(x+y)}$ and its role in conjugate Beta–Binomial integrals.\n- Conditional independence across unlinked loci.\n\nDerive the marginal likelihood under $H_1$ and under $H_2$ for one locus by analytically integrating out allele frequencies, then derive the Bayes factor (BF), defined as $B_{21}=\\dfrac{P(D\\mid H_2)}{P(D\\mid H_1)}$, across multiple loci as a product of per-locus ratios. Your program must compute, for each test case, the total evidence across all loci as $\\log_{10} B_{21}$.\n\nTest suite. For each test case below, each locus is specified as a quadruple $(k_1,m_1,k_2,m_2)$ using allele counts (for diploids, $m_i$ is twice the number of sampled individuals). All loci are unlinked, and use $\\alpha=\\beta=1$. Compute $\\log_{10} B_{21}$ for each case, rounding to $6$ decimal places.\n\n- Test case $1$ (strong terminal divergence, consistent with distinct terminal forms in a ring species):\n  - Loci: $(4,4,0,4)$, $(4,4,0,4)$, $(3,4,1,4)$, $(4,4,0,4)$, $(3,4,1,4)$.\n- Test case $2$ (little divergence, consistent with a single species along the ring interior):\n  - Loci: $(2,4,2,4)$, $(1,4,1,4)$, $(3,4,3,4)$, $(2,4,2,4)$, $(2,4,2,4)$.\n- Test case $3$ (intermediate divergence, representing partial differentiation at the contact zone):\n  - Loci: $(3,4,2,4)$, $(2,4,1,4)$, $(3,4,2,4)$, $(2,4,1,4)$, $(2,4,2,4)$.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each entry equal to $\\log_{10} B_{21}$ for one test case, rounded to $6$ decimal places, in the same order as above. For example, an acceptable format is [$x_1,x_2,x_3$] where each $x_i$ is a float with exactly $6$ digits after the decimal point. No other output is permitted.", "solution": "The problem as stated is subjected to rigorous validation. All provided assumptions and data are explicit and self-contained. The framework is grounded in fundamental principles of population genetics and Bayesian statistics, specifically utilizing the Beta-Binomial conjugate model, which is standard for analyzing allele count data. The problem is well-posed, with a unique solution derivable from the provided information. The hypotheses to be compared, $H_1$ and $H_2$, are clearly defined and mutually exclusive models for the observed data. The objective is unambiguous and requires a standard calculation in Bayesian model selection. Therefore, the problem is deemed valid and a formal solution will now be derived.\n\nThe task is to compute the Bayes factor, $B_{21}$, which compares two hypotheses for population structure. Let $D$ be the observed data, which consists of allele counts across $L$ unlinked loci. For each locus $\\ell \\in \\{1, \\dots, L\\}$, the data are $D_\\ell = (k_{1\\ell}, m_{1\\ell}, k_{2\\ell}, m_{2\\ell})$, where $k_{i\\ell}$ is the count of allele '$A$' out of $m_{i\\ell}$ total alleles sampled from geographic group $i$.\n\nThe Bayes factor is defined as the ratio of the marginal likelihoods of the data under the two hypotheses:\n$$ B_{21} = \\frac{P(D \\mid H_2)}{P(D \\mid H_1)} $$\nSince the loci are unlinked, the data are conditionally independent across loci given a hypothesis. Thus, the total Bayes factor is the product of the per-locus Bayes factors:\n$$ B_{21} = \\prod_{\\ell=1}^{L} \\frac{P(D_\\ell \\mid H_2)}{P(D_\\ell \\mid H_1)} = \\prod_{\\ell=1}^{L} B_{21, \\ell} $$\nThe required output is the logarithm base $10$ of this quantity, which is the sum of the per-locus log Bayes factors:\n$$ \\log_{10}(B_{21}) = \\sum_{\\ell=1}^{L} \\log_{10}(B_{21, \\ell}) $$\nWe proceed by deriving the marginal likelihood for a single locus $\\ell$. We will omit the subscript $\\ell$ for clarity in this section.\n\nThe marginal likelihood, or evidence, for a model is obtained by integrating the likelihood function over the prior distribution of the parameters. The general form is $P(D \\mid H) = \\int P(D \\mid \\theta, H) P(\\theta \\mid H) d\\theta$.\nThe sampling distribution for allele counts is Binomial. For a sample of size $m$ with an allele frequency $p$, the probability of observing $k$ copies of the allele is:\n$$ P(k \\mid m, p) = \\binom{m}{k} p^k (1-p)^{m-k} $$\nThe prior distribution for the allele frequency $p$ is a Beta distribution:\n$$ P(p \\mid \\alpha, \\beta) = \\frac{p^{\\alpha-1} (1-p)^{\\beta-1}}{B(\\alpha, \\beta)} $$\nwhere $B(\\alpha, \\beta) = \\frac{\\Gamma(\\alpha)\\Gamma(\\beta)}{\\Gamma(\\alpha+\\beta)}$ is the Beta function. The problem specifies a uniform prior, which corresponds to setting hyperparameters $\\alpha=1$ and $\\beta=1$.\n\n**Marginal Likelihood under $H_1$ (One Species):**\nUnder $H_1$, both groups share a single allele frequency $p$. The data from both groups, $D = (k_1, m_1, k_2, m_2)$, can be pooled. The total number of successes is $k_{tot} = k_1 + k_2$ and the total number of trials is $m_{tot} = m_1 + m_2$. The likelihood of the data given $p$ is:\n$$ P(D \\mid p, H_1) = P(k_1 \\mid m_1, p) P(k_2 \\mid m_2, p) = \\binom{m_1}{k_1} p^{k_1} (1-p)^{m_1-k_1} \\binom{m_2}{k_2} p^{k_2} (1-p)^{m_2-k_2} $$\n$$ P(D \\mid p, H_1) = \\binom{m_1}{k_1} \\binom{m_2}{k_2} p^{k_{tot}} (1-p)^{m_{tot}-k_{tot}} $$\nThe marginal likelihood is the integral of the likelihood over the prior on $p$:\n$$ P(D \\mid H_1) = \\int_0^1 \\binom{m_1}{k_1} \\binom{m_2}{k_2} p^{k_{tot}} (1-p)^{m_{tot}-k_{tot}} \\frac{p^{\\alpha-1} (1-p)^{\\beta-1}}{B(\\alpha, \\beta)} dp $$\n$$ P(D \\mid H_1) = \\frac{\\binom{m_1}{k_1} \\binom{m_2}{k_2}}{B(\\alpha, \\beta)} \\int_0^1 p^{k_{tot}+\\alpha-1} (1-p)^{m_{tot}-k_{tot}+\\beta-1} dp $$\nRecognizing the integral as the definition of the Beta function, we obtain the Beta-Binomial probability:\n$$ P(D \\mid H_1) = \\binom{m_1}{k_1} \\binom{m_2}{k_2} \\frac{B(k_{tot}+\\alpha, m_{tot}-k_{tot}+\\beta)}{B(\\alpha, \\beta)} $$\n\n**Marginal Likelihood under $H_2$ (Two Species):**\nUnder $H_2$, the two groups have independent allele frequencies, $p_1$ and $p_2$, each with an independent prior $P(p_i \\mid \\alpha, \\beta) = \\mathrm{Beta}(\\alpha, \\beta)$. The likelihood factorizes, and so does the marginal likelihood integral:\n$$ P(D \\mid H_2) = \\left( \\int_0^1 P(k_1 \\mid m_1, p_1) P(p_1) dp_1 \\right) \\times \\left( \\int_0^1 P(k_2 \\mid m_2, p_2) P(p_2) dp_2 \\right) $$\nEach term is a separate Beta-Binomial calculation:\n$$ P(D \\mid H_2) = \\left( \\binom{m_1}{k_1} \\frac{B(k_1+\\alpha, m_1-k_1+\\beta)}{B(\\alpha, \\beta)} \\right) \\times \\left( \\binom{m_2}{k_2} \\frac{B(k_2+\\alpha, m_2-k_2+\\beta)}{B(\\alpha, \\beta)} \\right) $$\n\n**Bayes Factor for a Single Locus:**\nWe now form the ratio for $B_{21, \\ell}$. The binomial coefficient terms $\\binom{m_1}{k_1}$ and $\\binom{m_2}{k_2}$ cancel, as does one $B(\\alpha, \\beta)$ term:\n$$ B_{21} = \\frac{P(D \\mid H_2)}{P(D \\mid H_1)} = \\frac{B(k_1+\\alpha, m_1-k_1+\\beta) \\cdot B(k_2+\\alpha, m_2-k_2+\\beta)}{B(\\alpha, \\beta) \\cdot B(k_1+k_2+\\alpha, m_1+m_2-k_1-k_2+\\beta)} $$\nFor the specified uniform prior, $\\alpha=1$ and $\\beta=1$. This simplifies the expression, as $B(1, 1) = \\frac{\\Gamma(1)\\Gamma(1)}{\\Gamma(2)} = 1$.\n$$ B_{21} = \\frac{B(k_1+1, m_1-k_1+1) \\cdot B(k_2+1, m_2-k_2+1)}{B(k_1+k_2+1, m_1+m_2-k_1-k_2+1)} $$\nTo avoid numerical instability with very large or small numbers from factorials, computation must be performed in log-space using the log-gamma function, $\\ln \\Gamma(x)$. The natural logarithm of the Beta function is $\\ln B(x, y) = \\ln \\Gamma(x) + \\ln \\Gamma(y) - \\ln \\Gamma(x+y)$. The natural logarithm of the per-locus Bayes factor is:\n$$ \\ln(B_{21, \\ell}) = \\ln B(k_{1\\ell}+1, m_{1\\ell}-k_{1\\ell}+1) + \\ln B(k_{2\\ell}+1, m_{2\\ell}-k_{2\\ell}+1) - \\ln B(k_{1\\ell}+k_{2\\ell}+1, m_{1\\ell}+m_{2\\ell}-k_{1\\ell}-k_{2\\ell}+1) $$\nThe total log Bayes factor across all loci is the sum of these per-locus terms:\n$$ \\ln(B_{21}) = \\sum_{\\ell=1}^{L} \\ln(B_{21, \\ell}) $$\nFinally, to obtain the result in base $10$, we use the change of base formula:\n$$ \\log_{10}(B_{21}) = \\frac{\\ln(B_{21})}{\\ln(10)} $$\nThe algorithm is to iterate through each test case, and for each case, iterate through its loci. For each locus, calculate $\\ln(B_{21, \\ell})$ using the above formula with log-gamma functions. Sum these values, convert to base $10$, and report the result.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import gammaln\n\ndef solve():\n    \"\"\"\n    Computes the log10 Bayes Factor (B_21) for species delimitation\n    based on allele count data across multiple loci.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each locus is a tuple (k1, m1, k2, m2).\n    test_cases = [\n        # Test case 1 (strong terminal divergence)\n        [\n            (4, 4, 0, 4),\n            (4, 4, 0, 4),\n            (3, 4, 1, 4),\n            (4, 4, 0, 4),\n            (3, 4, 1, 4),\n        ],\n        # Test case 2 (little divergence)\n        [\n            (2, 4, 2, 4),\n            (1, 4, 1, 4),\n            (3, 4, 3, 4),\n            (2, 4, 2, 4),\n            (2, 4, 2, 4),\n        ],\n        # Test case 3 (intermediate divergence)\n        [\n            (3, 4, 2, 4),\n            (2, 4, 1, 4),\n            (3, 4, 2, 4),\n            (2, 4, 1, 4),\n            (2, 4, 2, 4),\n        ],\n    ]\n\n    # Hyperparameters for the Beta prior. a=b=1 corresponds to a uniform prior.\n    alpha = 1.0\n    beta = 1.0\n\n    def calculate_ln_B21_for_locus(k1, m1, k2, m2, a, b):\n        \"\"\"\n        Calculates the natural logarithm of the Bayes Factor B_21 for a single locus.\n        B_21 = P(Data|H2) / P(Data|H1)\n        \"\"\"\n        # Calculate log of Beta function, ln B(x, y) = gammaln(x) + gammaln(y) - gammaln(x+y)\n\n        # Numerator of B_21: Product of Beta functions for H2 (two independent species)\n        # ln( B(k1+a, m1-k1+b) * B(k2+a, m2-k2+b) )\n        ln_num = (gammaln(k1 + a) + gammaln(m1 - k1 + b) - gammaln(m1 + a + b)) + \\\n                 (gammaln(k2 + a) + gammaln(m2 - k2 + b) - gammaln(m2 + a + b))\n\n        # Denominator of B_21: Product of Beta functions for H1 (one species, pooled data)\n        # ln( B(a,b) * B(k1+k2+a, m1+m2-k1-k2+b) )\n        k_tot = k1 + k2\n        m_tot = m1 + m2\n        ln_den = (gammaln(a) + gammaln(b) - gammaln(a + b)) + \\\n                 (gammaln(k_tot + a) + gammaln(m_tot - k_tot + b) - gammaln(m_tot + a + b))\n        \n        # ln(B_21) = ln(numerator) - ln(denominator)\n        ln_B21 = ln_num - ln_den\n        return ln_B21\n\n    results = []\n    for case_loci in test_cases:\n        total_ln_B21 = 0.0\n        for locus in case_loci:\n            k1, m1, k2, m2 = locus\n            total_ln_B21 += calculate_ln_B21_for_locus(k1, m1, k2, m2, alpha, beta)\n        \n        # Convert total natural log Bayes Factor to log base 10\n        log10_B21 = total_ln_B21 / np.log(10)\n        \n        # Format the result to 6 decimal places\n        results.append(f\"{log10_B21:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2580969"}, {"introduction": "Moving up the hierarchy, species assemble into communities governed by a web of interactions. This exercise guides you through the construction and analysis of a trophic network, a model that represents the feeding relationships in an ecosystem. You will build a community interaction matrix from the ground up, using allometric principles where the body size of an organism dictates its role as predator or prey [@problem_id:2580979]. By analyzing the stability of this system, you will gain insight into how individual-level traits, like body mass, scale up to determine emergent properties of entire communities, such as their persistence and resilience.", "problem": "You are asked to formalize an allometric trophic network and assess the local stability of a feasible equilibrium of a community governed by generalized Lotka–Volterra dynamics. Build everything from first principles given below and implement a program that computes the dominant real-part eigenvalue of the community Jacobian and a boolean stability verdict for several test cases.\n\nFundamental base:\n- Generalized Lotka–Volterra (GLV) population dynamics: for each species index $i \\in \\{1,\\dots,S\\}$ with abundance $x_i(t)$, the dynamics are\n$$\n\\frac{d x_i}{d t} \\;=\\; x_i \\left( r_i + \\sum_{j=1}^{S} a_{ij} x_j \\right).\n$$\n- Local stability of an equilibrium $(x_1^\\ast,\\dots,x_S^\\ast)$ with $x_i^\\ast > 0$ requires that all eigenvalues of the Jacobian matrix at that equilibrium have strictly negative real parts.\n- The Jacobian of the GLV system at a feasible equilibrium satisfies\n$$\nJ \\;=\\; \\mathrm{diag}(x^\\ast) \\, A,\n$$\nbecause at equilibrium one has $r_i + \\sum_{j} a_{ij} x_j^\\ast = 0$ for each $i$, hence $J_{ij} = x_i^\\ast a_{ij}$ for all $i,j$.\n\nAllometric construction of the interaction matrix:\n- You are given body masses $M_i$ (in kilograms) for $i \\in \\{1,\\dots,S\\}$. Define a directed trophic adjacency $L_{ij} \\in \\{0,1\\}$ by the body-mass ratio rule\n$$\nL_{ij} \\;=\\; \\begin{cases}\n1, & \\text{if } i \\neq j \\text{ and } \\dfrac{M_i}{M_j} \\ge \\theta,\\\\\n0, & \\text{otherwise,}\n\\end{cases}\n$$\nmeaning species $i$ consumes species $j$ if and only if the mass ratio threshold $\\theta$ is met.\n- Let $b_0 > 0$ be a base interaction scale, $\\alpha \\in \\mathbb{R}$ an allometric exponent, and $e \\in (0,1]$ a biomass conversion efficiency. For each consumer–resource link with $L_{ij}=1$ and ratio $R_{ij} = M_i/M_j$, define the per-capita effect magnitudes\n$$\nb_{ij} \\;=\\; b_0 \\, R_{ij}^{\\alpha}.\n$$\n- Assemble the interaction matrix $A \\in \\mathbb{R}^{S \\times S}$ with predator–prey sign structure:\n$$\na_{ij} \\;=\\; \\begin{cases}\n+ e \\, b_{ij}, & \\text{if } L_{ij}=1 \\text{ (effect of prey } j \\text{ on predator } i),\\\\\n- b_{ji}, & \\text{if } L_{ji}=1 \\text{ (effect of predator } j \\text{ on prey } i),\\\\\n0, & \\text{otherwise,}\n\\end{cases}\n$$\nand intraspecific self-regulation\n$$\na_{ii} \\;=\\; - s,\n$$\nfor a given $s > 0$ (assumed identical across species in this problem).\n\nAllometric equilibrium anchoring:\n- Assume a feasible equilibrium abundance scaling motivated by Damuth’s law: for constants $c>0$ and $\\beta>0$,\n$$\nx_i^\\ast \\;=\\; c \\, M_i^{-\\beta}.\n$$\n- Define the intrinsic rates $r \\in \\mathbb{R}^S$ by enforcing feasibility at $x^\\ast$: set\n$$\nr \\;=\\; - A \\, x^\\ast,\n$$\nso that $x^\\ast$ is an equilibrium of the GLV system by construction.\n\nStability objective:\n- Compute $J = \\mathrm{diag}(x^\\ast) A$, then compute the spectrum of $J$. Let $\\lambda_{\\max}$ denote the maximum real part among all eigenvalues of $J$. The equilibrium is locally asymptotically stable if and only if $\\lambda_{\\max} < 0$.\n\nAlgorithmic task:\n- For each test case below, construct $L$, then $A$, then $x^\\ast$, then $r$, then $J$, and finally compute $\\lambda_{\\max}$ and a boolean stability verdict $S$ defined as $S=\\text{True}$ if $\\lambda_{\\max} < -\\varepsilon$ and $S=\\text{False}$ otherwise, where $\\varepsilon = 10^{-9}$ is a strict numerical tolerance.\n- Report for each case the pair $[S, \\lambda_{\\max}]$, with $\\lambda_{\\max}$ rounded to $6$ decimal places.\n\nPhysical and numerical units:\n- Body mass inputs $M_i$ are in kilograms. No output quantity requires physical units.\n\nAngle unit:\n- No angles are involved.\n\nOutput format:\n- Your program should produce a single line of output containing a single top-level list of length equal to the number of test cases. Each element must be a two-element list $[S_i,\\lambda_i]$, where $S_i$ is a boolean and $\\lambda_i$ is a floating-point number rounded to $6$ decimal places. For example: $[[\\text{True},-0.123456],[\\text{False},0.010000]]$.\n\nTest suite:\nUse the following four test cases. Each case provides $S$, the masses $\\{M_i\\}_{i=1}^S$ in kilograms, and parameters $(\\theta, b_0, \\alpha, e, s, c, \\beta)$.\n\n- Case $1$ (baseline chain, moderate coupling):\n  - $S = 4$\n  - $M = [\\,0.01,\\,0.1,\\,1,\\,10\\,]$\n  - $\\theta = 10$, $b_0 = 0.05$, $\\alpha = 0.25$, $e = 0.2$, $s = 1.0$, $c = 1000$, $\\beta = 0.75$\n- Case $2$ (stronger coupling on same topology):\n  - $S = 4$\n  - $M = [\\,0.01,\\,0.1,\\,1,\\,10\\,]$\n  - $\\theta = 10$, $b_0 = 0.5$, $\\alpha = 0.25$, $e = 0.2$, $s = 1.0$, $c = 1000$, $\\beta = 0.75$\n- Case $3$ (sparser trophic links via a higher threshold):\n  - $S = 4$\n  - $M = [\\,0.01,\\,0.1,\\,1,\\,10\\,]$\n  - $\\theta = 100$, $b_0 = 0.5$, $\\alpha = 0.25$, $e = 0.2$, $s = 1.0$, $c = 1000$, $\\beta = 0.75$\n- Case $4$ (wider mass spectrum, altered exponents and self-regulation):\n  - $S = 5$\n  - $M = [\\,0.002,\\,0.02,\\,0.2,\\,2,\\,20\\,]$\n  - $\\theta = 10$, $b_0 = 0.2$, $\\alpha = 0.5$, $e = 0.3$, $s = 1.2$, $c = 800$, $\\beta = 0.75$\n\nThe program must implement the construction exactly as stated and output a single line with the list $[[S_1,\\lambda_1], [S_2,\\lambda_2], [S_3,\\lambda_3], [S_4,\\lambda_4]]$, where each $\\lambda_i$ is rounded to $6$ decimal places.", "solution": "The problem statement is subjected to validation.\n\nGivens are extracted as follows:\n1.  **System Dynamics**: The Generalized Lotka–Volterra (GLV) equations describe the population dynamics for $S$ species with abundances $x_i(t)$:\n    $$ \\frac{d x_i}{d t} = x_i \\left( r_i + \\sum_{j=1}^{S} a_{ij} x_j \\right) $$\n    for each species $i \\in \\{1, \\dots, S\\}$.\n2.  **Equilibrium and Stability**: An equilibrium $x^\\ast = (x_1^\\ast, \\dots, x_S^\\ast)$ with all $x_i^\\ast > 0$ is locally asymptotically stable if all eigenvalues of the Jacobian matrix $J$ evaluated at $x^\\ast$ have strictly negative real parts.\n3.  **Jacobian Matrix**: At a feasible equilibrium, the Jacobian is given by $J = \\mathrm{diag}(x^\\ast) A$, where $A$ is the interaction matrix. This follows from the equilibrium condition $r_i + \\sum_{j=1}^{S} a_{ij} x_j^\\ast = 0$.\n4.  **Trophic Network Structure**: A directed adjacency matrix $L \\in \\{0, 1\\}^{S \\times S}$ is defined using body masses $M_i$ and a threshold $\\theta$:\n    $$ L_{ij} = \\begin{cases} 1, & \\text{if } i \\neq j \\text{ and } \\frac{M_i}{M_j} \\ge \\theta \\\\ 0, & \\text{otherwise} \\end{cases} $$\n5.  **Interaction Matrix Construction**:\n    -   Per-capita interaction magnitudes for a link $L_{ij}=1$ are $b_{ij} = b_0 (M_i/M_j)^{\\alpha}$, with $b_0 > 0$ and $\\alpha \\in \\mathbb{R}$.\n    -   The interaction matrix $A \\in \\mathbb{R}^{S \\times S}$ is defined by:\n        $$ a_{ij} = \\begin{cases} + e \\, b_{ij}, & \\text{if } L_{ij}=1 \\\\ - b_{ji}, & \\text{if } L_{ji}=1 \\\\ 0, & \\text{otherwise} \\end{cases} \\quad \\text{for } i \\neq j $$\n        and intraspecific competition $a_{ii} = -s$ for a given $s > 0$. The parameter $e \\in (0,1]$ is the biomass conversion efficiency.\n6.  **Equilibrium Abundance**: A feasible equilibrium $x^\\ast$ is assumed to follow an allometric scaling law:\n    $$ x_i^\\ast = c \\, M_i^{-\\beta} $$\n    for constants $c > 0$ and $\\beta > 0$. The intrinsic growth rates are set to $r = -A x^\\ast$ to ensure $x^\\ast$ is an equilibrium.\n7.  **Computational Objective**:\n    -   Compute the Jacobian $J = \\mathrm{diag}(x^\\ast) A$.\n    -   Determine the maximum real part of the eigenvalues of $J$, denoted $\\lambda_{\\max}$.\n    -   The stability verdict $S$ is $\\text{True}$ if $\\lambda_{\\max} < -\\varepsilon$ and $\\text{False}$ otherwise, with a numerical tolerance of $\\varepsilon = 10^{-9}$.\n    -   Report the pair $[S, \\lambda_{\\max}]$ for each test case, with $\\lambda_{\\max}$ rounded to $6$ decimal places.\n8.  **Test Cases**: Four distinct test cases are provided, specifying all necessary parameters $(S, \\{M_i\\}, \\theta, b_0, \\alpha, e, s, c, \\beta)$.\n\nValidation reveals the problem is scientifically grounded, well-posed, and objective. It is based on established principles of theoretical ecology (Lotka-Volterra dynamics, allometric scaling) and dynamical systems theory (local stability analysis). The problem provides a complete, unambiguous, and self-consistent set of instructions and parameters, forming a well-defined computational task. No scientific, logical, or mathematical flaws are detected. The problem is therefore deemed **valid**.\n\nThe solution proceeds by constructing the required mathematical objects in a stepwise manner, as specified.\n\nThe process begins with the given body masses $\\{M_i\\}_{i=1}^S$ and parameters for each test case.\n\nFirst, we construct the trophic adjacency matrix $L$. For each pair of distinct species $(i, j)$, we compute the mass ratio $R_{ij} = M_i/M_j$. If $R_{ij} \\ge \\theta$, then species $i$ consumes species $j$, and we set the matrix element $L_{ij} = 1$. Otherwise, $L_{ij} = 0$. The condition $i \\neq j$ ensures no self-consumption. For the given test sets, where all masses are distinct and $\\theta > 1$, it is impossible for both $L_{ij}=1$ and $L_{ji}=1$ to hold simultaneously for any pair $(i, j)$.\n\nSecond, we construct the community interaction matrix $A \\in \\mathbb{R}^{S \\times S}$. The diagonal elements are set to represent intraspecific competition: $a_{ii} = -s$. For the off-diagonal elements, we first compute the per-capita interaction magnitudes $b_{ij} = b_0 R_{ij}^{\\alpha}$ for all pairs $(i, j)$ where a trophic link exists ($L_{ij} = 1$). The elements of $A$ are then populated according to the predator-prey dynamics:\n-   If $L_{ij} = 1$ (species $i$ eats species $j$), the effect of prey $j$ on predator $i$ is positive: $a_{ij} = +e \\cdot b_{ij}$.\n-   Conversely, the effect of predator $i$ on prey $j$ is negative. This corresponds to an element $a_{ji}$, for which the relevant trophic link is $L_{ij}=1$. The problem statement implies that for the term $a_{ji}$, the link is from $i$ to $j$, i.e., $L_{ij}=1$. The rule is stated as $a_{ij} = -b_{ji}$ if $L_{ji}=1$. Thus, for a pair $(i, j)$ where $i$ eats $j$, we have $a_{ij} = e b_{ij}$ and $a_{ji} = -b_{ij}$.\n\nThird, we determine the equilibrium abundance vector $x^\\ast$. This is calculated directly from the allometric scaling law, $x_i^\\ast = c M_i^{-\\beta}$ for each species $i$.\n\nFourth, we construct the Jacobian matrix $J$ of the system at the equilibrium $x^\\ast$. As specified, $J = \\mathrm{diag}(x^\\ast) A$. The $(i, j)$-th element of the Jacobian is therefore $J_{ij} = x_i^\\ast a_{ij}$. The diagonal elements are $J_{ii} = x_i^\\ast a_{ii} = -s x_i^\\ast$. The off-diagonal elements are $J_{ij} = x_i^\\ast a_{ij}$ for $i \\neq j$.\n\nFinally, we perform the stability analysis. We compute the set of eigenvalues $\\{\\lambda_k\\}_{k=1}^S$ of the matrix $J$. The local stability of the equilibrium is determined by the sign of the maximum real part of these eigenvalues, $\\lambda_{\\max} = \\max_k \\{ \\mathrm{Re}(\\lambda_k) \\}$. The equilibrium is locally asymptotically stable if and only if $\\lambda_{\\max} < 0$. We apply the strict numerical criterion provided: the stability verdict $S$ is $\\text{True}$ if $\\lambda_{\\max} < -10^{-9}$, and $\\text{False}$ otherwise.\n\nThis procedure is applied to each of the four test cases to obtain the final results.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the stability of allometric trophic networks for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"case_id\": 1,\n            \"S\": 4,\n            \"M\": np.array([0.01, 0.1, 1, 10]),\n            \"params\": {\"theta\": 10.0, \"b0\": 0.05, \"alpha\": 0.25, \"e\": 0.2, \"s\": 1.0, \"c\": 1000.0, \"beta\": 0.75}\n        },\n        {\n            \"case_id\": 2,\n            \"S\": 4,\n            \"M\": np.array([0.01, 0.1, 1, 10]),\n            \"params\": {\"theta\": 10.0, \"b0\": 0.5, \"alpha\": 0.25, \"e\": 0.2, \"s\": 1.0, \"c\": 1000.0, \"beta\": 0.75}\n        },\n        {\n            \"case_id\": 3,\n            \"S\": 4,\n            \"M\": np.array([0.01, 0.1, 1, 10]),\n            \"params\": {\"theta\": 100.0, \"b0\": 0.5, \"alpha\": 0.25, \"e\": 0.2, \"s\": 1.0, \"c\": 1000.0, \"beta\": 0.75}\n        },\n        {\n            \"case_id\": 4,\n            \"S\": 5,\n            \"M\": np.array([0.002, 0.02, 0.2, 2, 20]),\n            \"params\": {\"theta\": 10.0, \"b0\": 0.2, \"alpha\": 0.5, \"e\": 0.3, \"s\": 1.2, \"c\": 800.0, \"beta\": 0.75}\n        }\n    ]\n\n    results = []\n    epsilon = 1e-9\n\n    for case in test_cases:\n        S = case[\"S\"]\n        M = case[\"M\"]\n        p = case[\"params\"]\n        \n        # Step 1: Construct trophic adjacency matrix L\n        # R_ij = M_i / M_j. Using numpy broadcasting for efficiency.\n        R = M[:, np.newaxis] / M\n        L = (R >= p[\"theta\"]).astype(float)\n        np.fill_diagonal(L, 0) # Enforce i != j\n\n        # Step 2: Construct interaction matrix A\n        A = np.zeros((S, S))\n        \n        # Calculate per-capita interaction magnitudes b_ij\n        b = p[\"b0\"] * (R ** p[\"alpha\"])\n        \n        # Populate off-diagonal elements of A based on L\n        # a_ij = +e * b_ij for predator i on prey j (L_ij = 1)\n        # a_ji = -b_ij for predator i on prey j (L_ij = 1)\n        # We can vectorize this: A_predator_gain = e * (b * L)\n        # A_prey_loss = -(b * L).T\n        A = p[\"e\"] * (b * L) - (b * L).T\n\n        # Set diagonal elements for intraspecific self-regulation\n        np.fill_diagonal(A, -p[\"s\"])\n\n        # Step 3: Construct equilibrium abundance vector x*\n        x_star = p[\"c\"] * (M ** -p[\"beta\"])\n\n        # Step 4: Construct the Jacobian matrix J = diag(x*) @ A\n        J = np.diag(x_star) @ A\n        \n        # Step 5: Compute eigenvalues and determine stability\n        eigenvalues = np.linalg.eigvals(J)\n        lambda_max = np.max(np.real(eigenvalues))\n        \n        is_stable = lambda_max < -epsilon\n        \n        results.append([is_stable, round(lambda_max, 6)])\n\n    # Format output as a single string\n    output_str = \"[\" + \",\".join([f\"[{str(r[0]).lower()},{r[1]:.6f}]\" for r in results]) + \"]\"\n    print(output_str)\n\nsolve()\n```", "id": "2580979"}, {"introduction": "At broader spatial scales, communities exhibit robust macroecological patterns. Among the most famous is the species–area relationship, a power law that describes how the number of species $S$ increases with area $A$ according to $S = c A^{z}$. This practice focuses on using this relationship as a tool for comparative analysis [@problem_id:2581017]. By fitting this model to data from different taxonomic groups—plants and birds—and statistically testing for differences in the scaling exponent $z$, you can draw inferences about their contrasting ecological and evolutionary dynamics, such as dispersal ability and habitat specialization, across an entire archipelago.", "problem": "In comparative zoology and botany, the hierarchical organization of the biosphere implies that species richness aggregates from local populations to communities and up to archipelagos. A widely observed macroecological regularity linking community-level richness to spatial scale is the species–area relationship, assumed here to follow the power law $S = c A^{z}$, where $S$ is species richness, $A$ is island area, $c$ is a taxon- and region-specific constant, and $z$ is the area-scaling exponent that encapsulates dispersal limitation and habitat specialization across the island hierarchy. Consider an archipelago where the natural logarithm of area $x = \\ln(A)$ and the natural logarithm of species richness $y = \\ln(S)$ were measured for two taxa, vascular plants and land birds, across $6$ islands each. For each taxon, a separate ordinary least squares (OLS, ordinary least squares) regression of $y$ on $x$ is to be fit under the linear model $y = \\alpha + z x + \\varepsilon$, where $\\varepsilon$ are independent, mean-zero, homoscedastic, normally distributed errors within each taxon.\n\nThe raw data have been reduced to centered sums of squares and cross-products for the two groups (all quantities computed after centering $x$ and $y$ by their group-specific means):\n- Plants: $n_{p} = 6$, $S_{xx,p} = 20.0$, $S_{xy,p} = 5.8$, $S_{yy,p} = 1.762$.\n- Birds: $n_{b} = 6$, $S_{xx,b} = 20.0$, $S_{xy,b} = 3.8$, $S_{yy,b} = 0.802$.\n\nAssume that the error variances are equal between taxa. Using only these summary statistics, fit the log–log species–area relationship separately for plants and birds to estimate the exponents $z_{p}$ and $z_{b}$, then test whether the exponents differ by computing the $t$-statistic for the null hypothesis $H_{0}: z_{p} - z_{b} = 0$ against the two-sided alternative. Use the pooled OLS residual variance across the two regressions and the usual degrees of freedom implied by separate fits.\n\nReport the value of the $t$-statistic as a pure number without units, rounded to four significant figures.", "solution": "The problem as stated is scientifically sound and computationally tractable. It draws upon established principles in macroecology—specifically, the species-area relationship—and employs standard statistical methods for parameter estimation and hypothesis testing in the context of linear regression. All necessary summary statistics are provided, the objective is clearly defined, and there are no internal contradictions. Therefore, the problem is valid, and a solution will be provided.\n\nThe problem requires a statistical test of the null hypothesis $H_{0}: z_{p} - z_{b} = 0$ against the two-sided alternative $H_{A}: z_{p} - z_{b} \\neq 0$, where $z_{p}$ and $z_{b}$ are the true scaling exponents for plants and birds, respectively. This is a test for the difference between two regression coefficients from two independent linear regressions.\n\nThe species-area relationship is given by the power law $S = c A^{z}$. Taking the natural logarithm of both sides linearizes the model:\n$$ \\ln(S) = \\ln(c) + z \\ln(A) $$\nThis corresponds to the linear regression model $y = \\alpha + z x + \\varepsilon$, where $y = \\ln(S)$, $x = \\ln(A)$, $\\alpha = \\ln(c)$, and $\\varepsilon$ is the error term.\n\nThe ordinary least squares (OLS) estimator for the slope coefficient $z$ is given by:\n$$ \\hat{z} = \\frac{S_{xy}}{S_{xx}} $$\nwhere $S_{xy} = \\sum_{i=1}^{n} (x_i - \\bar{x})(y_i - \\bar{y})$ and $S_{xx} = \\sum_{i=1}^{n} (x_i - \\bar{x})^2$.\n\nFirst, we estimate the slope coefficients for plants ($\\hat{z}_{p}$) and birds ($\\hat{z}_{b}$) using the provided summary statistics.\nFor plants:\n$$ \\hat{z}_{p} = \\frac{S_{xy,p}}{S_{xx,p}} = \\frac{5.8}{20.0} = 0.29 $$\nFor birds:\n$$ \\hat{z}_{b} = \\frac{S_{xy,b}}{S_{xx,b}} = \\frac{3.8}{20.0} = 0.19 $$\n\nThe $t$-statistic for testing the difference between two independent regression coefficients is:\n$$ t = \\frac{(\\hat{z}_{p} - \\hat{z}_{b}) - (z_{p} - z_{b})_{0}}{\\text{SE}(\\hat{z}_{p} - \\hat{z}_{b})} $$\nUnder the null hypothesis $H_{0}$, the expected difference $(z_{p} - z_{b})_{0}$ is $0$. The standard error of the difference, $\\text{SE}(\\hat{z}_{p} - \\hat{z}_{b})$, is derived from the variances of the individual estimators. Since the two regressions are independent, the variance of the difference is the sum of the variances:\n$$ \\text{Var}(\\hat{z}_{p} - \\hat{z}_{b}) = \\text{Var}(\\hat{z}_{p}) + \\text{Var}(\\hat{z}_{b}) $$\nThe variance of a slope estimator $\\hat{z}$ is $\\text{Var}(\\hat{z}) = \\frac{\\sigma^2}{S_{xx}}$. The problem states to assume equal error variances for the two taxa, i.e., $\\sigma_{p}^2 = \\sigma_{b}^2 = \\sigma^2$. We must estimate this common variance using a pooled estimator, $s_{pool}^2$. The standard error of the difference is then:\n$$ \\text{SE}(\\hat{z}_{p} - \\hat{z}_{b}) = \\sqrt{s_{pool}^2 \\left( \\frac{1}{S_{xx,p}} + \\frac{1}{S_{xx,b}} \\right)} $$\nThe pooled variance, $s_{pool}^2$, is calculated by summing the residual sum of squares ($RSS$) from each regression and dividing by the sum of their respective degrees of freedom ($df$). For a simple linear regression with $n$ observations, the degrees of freedom for the residuals is $df = n-2$. The $RSS$ for a single regression is given by $RSS = S_{yy} - \\frac{S_{xy}^2}{S_{xx}}$.\n\nWe compute the $RSS$ for each taxon:\nFor plants:\n$$ RSS_{p} = S_{yy,p} - \\frac{(S_{xy,p})^2}{S_{xx,p}} = 1.762 - \\frac{(5.8)^2}{20.0} = 1.762 - \\frac{33.64}{20.0} = 1.762 - 1.682 = 0.08 $$\nThe degrees of freedom for plants is $df_{p} = n_{p} - 2 = 6-2=4$.\n\nFor birds:\n$$ RSS_{b} = S_{yy,b} - \\frac{(S_{xy,b})^2}{S_{xx,b}} = 0.802 - \\frac{(3.8)^2}{20.0} = 0.802 - \\frac{14.44}{20.0} = 0.802 - 0.722 = 0.08 $$\nThe degrees of freedom for birds is $df_{b} = n_{b} - 2 = 6-2=4$.\n\nNow, we compute the pooled variance $s_{pool}^2$:\n$$ s_{pool}^2 = \\frac{RSS_{p} + RSS_{b}}{df_{p} + df_{b}} = \\frac{0.08 + 0.08}{4 + 4} = \\frac{0.16}{8} = 0.02 $$\nWith the pooled variance, we can calculate the standard error of the difference:\n$$ \\text{SE}(\\hat{z}_{p} - \\hat{z}_{b}) = \\sqrt{0.02 \\left( \\frac{1}{20.0} + \\frac{1}{20.0} \\right)} = \\sqrt{0.02 \\left( \\frac{2}{20.0} \\right)} = \\sqrt{0.02 \\times 0.1} = \\sqrt{0.002} $$\nFinally, we compute the $t$-statistic:\n$$ t = \\frac{\\hat{z}_{p} - \\hat{z}_{b}}{\\text{SE}(\\hat{z}_{p} - \\hat{z}_{b})} = \\frac{0.29 - 0.19}{\\sqrt{0.002}} = \\frac{0.10}{\\sqrt{0.002}} $$\nCalculating the numerical value:\n$$ t \\approx \\frac{0.10}{0.04472135955} \\approx 2.236067977 $$\nRounding to four significant figures as required by the problem statement, we obtain $t = 2.236$. This statistic would be compared to a critical value from a $t$-distribution with $df_{p} + df_{b} = 8$ degrees of freedom to determine statistical significance. The question, however, only asks for the value of the statistic itself.", "answer": "$$\n\\boxed{2.236}\n$$", "id": "2581017"}]}