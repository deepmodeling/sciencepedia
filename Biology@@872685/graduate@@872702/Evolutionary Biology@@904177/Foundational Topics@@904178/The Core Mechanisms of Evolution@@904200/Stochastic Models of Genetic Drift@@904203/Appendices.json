{"hands_on_practices": [{"introduction": "The Wright-Fisher model is a cornerstone of population genetics, and understanding its mechanics begins with its probabilistic foundation. This exercise challenges you to derive the one-step transition probabilities from first principles, translating the biological assumptions of random sampling into a precise mathematical statement. Mastering this derivation ensures a deep understanding of how genetic drift is modeled as a stochastic sampling process and provides the building block for all further analysis.", "problem": "Consider a neutral, biallelic locus with alleles $A$ and $a$ evolving in a diploid Wright–Fisher population of constant size $N$. Generations are non-overlapping, there is random mating, no selection, no mutation, and no migration. Let $X_t$ denote the number of copies of allele $A$ among the $2N$ gene copies in generation $t$. Conditional on $X_t=i$, define the allele-$A$ frequency as $p=i/(2N)$. The next generation is formed by sampling $2N$ gene copies independently with replacement from the parental gene pool, consistent with random mating and Mendelian segregation under neutrality.\n\nStarting from these model assumptions alone and first principles of finite sampling, derive the exact one-step transition probability mass function for $X_{t+1}$ conditional on $X_t=i$. Your final answer must be a single closed-form analytic expression for $\\Pr(X_{t+1}=k \\mid X_t=i)$ as a function of $N$, $i$, and $k$, using only elementary functions and standard combinatorial quantities.\n\nExpress your answer as a single algebraic expression. Do not provide an inequality or an equation to be solved. No rounding is required.", "solution": "The problem statement has been subjected to rigorous validation. It is a standard, well-posed problem in theoretical population genetics, grounded in established principles of stochastic modeling. All necessary data and conditions are provided, and there are no scientific or logical inconsistencies. The task is to derive the one-step transition probability for the Wright-Fisher model from first principles, which is a fundamental exercise. We shall now proceed with this derivation.\n\nThe state of the population at generation $t$ is given by $X_t = i$, where $i$ is the number of copies of allele $A$ in a total gene pool of size $2N$. The value of $i$ can range from $0$ to $2N$. From this, the frequency of allele $A$ in the parental gene pool is precisely $p = \\frac{i}{2N}$. The frequency of the other allele, $a$, is $1-p = 1 - \\frac{i}{2N} = \\frac{2N-i}{2N}$.\n\nThe problem states that the gene pool for the subsequent generation, $t+1$, is formed by sampling $2N$ gene copies independently and with replacement from the gene pool of generation $t$. This sampling scheme is the defining characteristic of the Wright-Fisher model. The process of drawing one gene copy for the next generation can be modeled as a single trial. We must perform $2N$ such trials to form the new generation.\n\nLet us define a \"success\" for a single trial as the event that the drawn gene copy is of allele type $A$. Since the sampling is performed with replacement, the probability of success for each trial is constant and independent of the outcomes of all other trials. This probability is equal to the frequency of allele $A$ in the parental gene pool, which is $p = \\frac{i}{2N}$.\n\nWe are interested in the probability that the next generation contains exactly $k$ copies of allele $A$. This is equivalent to asking for the probability of obtaining exactly $k$ successes in a sequence of $n = 2N$ independent Bernoulli trials, where the probability of success in each trial is $p = \\frac{i}{2N}$.\n\nThis is, by definition, a problem described by the binomial distribution. The probability mass function (PMF) for a binomial random variable $K$ with parameters $n$ (number of trials) and $p$ (probability of success) is given by the formula:\n$$ \\Pr(K=k) = \\binom{n}{k} p^k (1-p)^{n-k} $$\nwhere $k$ is the number of successes sought, and $\\binom{n}{k}$ is the binomial coefficient, which counts the number of ways to choose $k$ successful trials out of $n$ total trials.\n\nTo derive the specific transition probability $\\Pr(X_{t+1}=k \\mid X_t=i)$, we substitute the parameters of the Wright-Fisher model into the general binomial PMF:\n1.  The number of trials is the total number of gene copies in the new generation, so $n = 2N$.\n2.  The number of successes is the desired number of $A$ alleles in the new generation, so the variable is $k$. The range of possible values for $k$ is $0, 1, 2, \\dots, 2N$.\n3.  The probability of success for each trial is the frequency of allele $A$ in the parent generation, $p = \\frac{i}{2N}$.\n4.  The probability of failure (drawing an allele $a$) is $1-p = 1 - \\frac{i}{2N} = \\frac{2N-i}{2N}$.\n\nSubstituting these values into the binomial PMF yields the one-step transition probability for the Wright-Fisher model:\n$$ \\Pr(X_{t+1}=k \\mid X_t=i) = \\binom{2N}{k} \\left(\\frac{i}{2N}\\right)^k \\left(\\frac{2N-i}{2N}\\right)^{2N-k} $$\nThis expression represents the probability of transitioning from a state with $i$ copies of allele $A$ to a state with $k$ copies in a single generation. It is a closed-form analytical expression using standard combinatorial quantities, as required. This completes the derivation from first principles.", "answer": "$$\n\\boxed{\\binom{2N}{k} \\left(\\frac{i}{2N}\\right)^k \\left(\\frac{2N-i}{2N}\\right)^{2N-k}}\n$$", "id": "2753551"}, {"introduction": "Building on the sampling framework explored in the previous practice [@problem_id:2753551], this exercise focuses on a key summary statistic: the variance of allele frequency change, $\\operatorname{Var}(\\Delta p \\mid p_t)$, in a single generation. Deriving this expression is a critical step toward quantifying the magnitude of genetic drift and serves as the gateway to the powerful diffusion approximation. This practice sharpens your ability to extract essential statistical properties from a stochastic model.", "problem": "Consider a single biallelic neutral locus in a classical Wright–Fisher model for a diploid population of constant census size $N$ with non-overlapping generations, random mating, and no selection, mutation, or migration. At generation $t$, the population allele frequency of allele $A$ is $p_t \\in [0,1]$. Each generation is formed by sampling $2N$ gametes independently with replacement from the parental gene pool, where each sampled gamete is of type $A$ with probability $p_t$.\n\nDefine the next-generation allele frequency by $p_{t+1}$ and the single-generation change by $\\Delta p \\equiv p_{t+1} - p_t$. Starting strictly from the generative sampling mechanism of the Wright–Fisher model and basic properties of the binomial distribution and variance under affine transformations, derive the exact conditional variance $\\operatorname{Var}(\\Delta p \\mid p_t, N)$ as a closed-form expression in terms of $p_t$ and $N$. Do not invoke diffusion approximations or asymptotic limits; compute the finite-$N$ result exactly. Express your final answer as a single analytic expression. No rounding is required and no units are involved.", "solution": "The problem as stated is subjected to validation.\n\nStep 1: Extract Givens.\n- Model: Classical Wright–Fisher model.\n- Population: Diploid, constant census size $N$.\n- Generations: Non-overlapping.\n- Mating: Random.\n- Locus: Single biallelic neutral locus (allele $A$).\n- Evolutionary forces: No selection, mutation, or migration.\n- Allele frequency at generation $t$: $p_t \\in [0,1]$.\n- Generative mechanism: At each generation, $2N$ gametes are sampled independently with replacement from the parental gene pool.\n- Sampling probability: The probability of sampling an $A$ allele is $p_t$.\n- Next-generation allele frequency: $p_{t+1}$.\n- Single-generation change in allele frequency: $\\Delta p \\equiv p_{t+1} - p_t$.\n- Objective: Derive the exact conditional variance $\\operatorname{Var}(\\Delta p \\mid p_t, N)$.\n- Constraints: The derivation must use only the generative sampling mechanism, basic properties of the binomial distribution, and properties of variance under affine transformations. It must be an exact, closed-form expression for finite $N$, without invoking diffusion approximations or asymptotic limits.\n\nStep 2: Validate Using Extracted Givens.\nThe problem statement is scientifically grounded, well-posed, and objective. It describes a standard, fundamental model in population genetics (the Wright–Fisher model) and asks for the derivation of a classical result. All terms are precisely defined, and the necessary information is provided. The problem is not based on any factual unsoundness, it is not metaphorical, it is not incomplete or contradictory, it does not describe unrealistic conditions within its theoretical framework, it is not ill-posed, it is scientifically verifiable, and it is not a \"pseudo-profound\" question. The problem is valid.\n\nStep 3: Verdict and Action.\nThe problem is valid. A full derivation will be provided.\n\nThe derivation proceeds from the fundamental sampling process defined in the problem statement.\nLet $X_{t+1}$ be the random variable representing the number of copies of allele $A$ in the population at generation $t+1$. The total number of alleles at the locus is $2N$ because the population is diploid with size $N$.\nAccording to the Wright–Fisher model's generative mechanism, these $2N$ alleles for generation $t+1$ are obtained by sampling with replacement from the gene pool of generation $t$. The frequency of allele $A$ in the parental gene pool is $p_t$.\nTherefore, each of the $2N$ draws is an independent Bernoulli trial with a success probability of $p_t$ (where \"success\" is defined as drawing an $A$ allele). The total number of successes, $X_{t+1}$, in $2N$ independent Bernoulli trials follows a binomial distribution. We write this conditional distribution as:\n$$\nX_{t+1} \\mid p_t \\sim \\text{Binomial}(n=2N, p=p_t)\n$$\nThe allele frequency at generation $t+1$, denoted as $p_{t+1}$, is by definition the number of $A$ alleles divided by the total number of alleles in the population.\n$$\np_{t+1} = \\frac{X_{t+1}}{2N}\n$$\nWe are asked to find the conditional variance of the change in allele frequency, $\\operatorname{Var}(\\Delta p \\mid p_t, N)$, where $\\Delta p = p_{t+1} - p_t$.\nLet us first compute the conditional variance of the next-generation allele frequency, $\\operatorname{Var}(p_{t+1} \\mid p_t, N)$.\nWe use the property of variance under a scalar transformation, which states that for a random variable $Y$ and a constant $c$, $\\operatorname{Var}(cY) = c^2 \\operatorname{Var}(Y)$. In our case, $Y = X_{t+1}$ and the constant is $c = \\frac{1}{2N}$.\n$$\n\\operatorname{Var}(p_{t+1} \\mid p_t, N) = \\operatorname{Var}\\left(\\frac{X_{t+1}}{2N} \\mid p_t, N\\right) = \\left(\\frac{1}{2N}\\right)^2 \\operatorname{Var}(X_{t+1} \\mid p_t, N)\n$$\nThe variance of a binomial random variable $Z \\sim \\text{Binomial}(n, p)$ is given by $\\operatorname{Var}(Z) = np(1-p)$.\nApplying this to $X_{t+1}$, we have:\n$$\n\\operatorname{Var}(X_{t+1} \\mid p_t, N) = (2N) p_t (1 - p_t)\n$$\nSubstituting this result into the expression for the variance of $p_{t+1}$:\n$$\n\\operatorname{Var}(p_{t+1} \\mid p_t, N) = \\frac{1}{(2N)^2} [2N p_t (1 - p_t)] = \\frac{2N p_t (1 - p_t)}{4N^2} = \\frac{p_t(1 - p_t)}{2N}\n$$\nNow, we consider the quantity of interest, $\\operatorname{Var}(\\Delta p \\mid p_t, N)$.\n$$\n\\Delta p = p_{t+1} - p_t\n$$\nThe variance of this difference must be computed conditional on $p_t$. In this conditional context, $p_t$ is a fixed, non-random quantity. It is the state of the system from which the transition occurs.\nWe use the property of variance under a constant shift, which states that for a random variable $Y$ and a constant $k$, $\\operatorname{Var}(Y - k) = \\operatorname{Var}(Y)$.\nHere, $Y = p_{t+1}$ and the constant is $k = p_t$.\nTherefore,\n$$\n\\operatorname{Var}(\\Delta p \\mid p_t, N) = \\operatorname{Var}(p_{t+1} - p_t \\mid p_t, N) = \\operatorname{Var}(p_{t+1} \\mid p_t, N)\n$$\nThis establishes that the variance of the change in allele frequency is equal to the variance of the next-generation's allele frequency.\nCombining our results, we arrive at the final expression:\n$$\n\\operatorname{Var}(\\Delta p \\mid p_t, N) = \\frac{p_t(1 - p_t)}{2N}\n$$\nThis is the exact, closed-form expression for the conditional variance of the one-generation change in allele frequency in the Wright–Fisher model, derived strictly from the model's generative process and basic statistical principles as required.", "answer": "$$\n\\boxed{\\frac{p_t(1 - p_t)}{2N}}\n$$", "id": "2753537"}, {"introduction": "This practice transitions from analytical derivation to computational simulation, a vital skill in modern population genetics. You will implement the Wright-Fisher diffusion equation, the continuous-time approximation of the discrete model analyzed previously [@problem_id:2753551] [@problem_id:2753537]. By numerically solving the underlying stochastic differential equation (SDE), you will gain practical experience with how long-term evolutionary trajectories under drift, selection, and mutation are simulated and learn to manage crucial numerical issues like stability and boundary conditions.", "problem": "You are to implement a numerical simulator for the Wright–Fisher diffusion with selection and bidirectional mutation, using an Euler–Maruyama discretization of a stochastic differential equation. The allele-frequency process is modeled as a one-dimensional Itô diffusion for the allele-$1$ frequency $p_t \\in [0,1]$ with drift and diffusion coefficients arising from classical population genetics. The model assumptions are:\n\n- There is a constant effective population size $N_e > 0$.\n- There is genic selection with selection coefficient $s \\in \\mathbb{R}$ acting on allele $1$.\n- There are mutation rates $u \\ge 0$ from allele $1$ to allele $0$ and $v \\ge 0$ from allele $0$ to allele $1$.\n- The Wright–Fisher diffusion has drift $a(p)$ and diffusion $b(p)$ given by\n  $$ a(p) = s\\,p\\,(1-p) + v\\,(1-p) - u\\,p, \\qquad b(p) = \\frac{p\\,(1-p)}{2\\,N_e}. $$\n- The stochastic differential equation (in Itô form) for $p_t$ is\n  $$ \\mathrm{d}p_t = a(p_t)\\,\\mathrm{d}t + \\sqrt{b(p_t)}\\,\\mathrm{d}W_t, $$\n  where $W_t$ is a standard Wiener process.\n\nYour task is to:\n\n1. From the above model specification (which is the fundamental base), implement a single-path Euler–Maruyama time discretization to simulate $p_t$ on a uniform grid $t_n = n\\,\\Delta t$ for $n=0,1,\\dots, T/\\Delta t$ with a given initial condition $p_0 \\in [0,1]$. Use independent standard normal increments for each time step.\n2. Enforce state constraints as follows:\n   - After each Euler–Maruyama step, project the state back into the closed interval $[0,1]$ by clamping if it leaves the interval, i.e., replace any proposal $\\tilde p$ by $\\min\\{\\max\\{\\tilde p,0\\},1\\}$.\n   - If $u = 0$ and $v = 0$ (no mutation), then treat $p=0$ and $p=1$ as absorbing boundaries: once the process reaches $p=0$ or $p=1$, it stays there for all subsequent steps. If mutation is nonzero (i.e., $u>0$ or $v>0$), do not absorb.\n3. Discuss numerical stability in your internal design and choose $\\Delta t$ values in the test suite that reflect both stable and potentially unstable regimes near $p=0$ and $p=1$. The numerical method should be robust in the sense that it terminates and returns a value in $[0,1]$ for all specified test cases.\n\nUse the following test suite. For each test case, simulate a single trajectory with the specified parameters, using the provided pseudorandom seed for reproducibility. Return the final allele frequency at time $T$ (i.e., at $t = T$) as a decimal fraction rounded to exactly six digits after the decimal point.\n\n- Test case $1$ (happy path, neutral, interior start): $N_e = 10000$, $s = 0$, $u = 0$, $v = 0$, $p_0 = 0.5$, $T = 1.0$, $\\Delta t = 0.0005$, seed $= 12345$.\n- Test case $2$ (near $0$ with weak positive selection and tiny forward mutation): $N_e = 5000$, $s = 0.01$, $u = 0$, $v = 0.00001$, $p_0 = 0.001$, $T = 2.0$, $\\Delta t = 0.0005$, seed $= 2021$.\n- Test case $3$ (near $1$ with negative selection and mutation away from allele $1$): $N_e = 5000$, $s = -0.02$, $u = 0.00002$, $v = 0$, $p_0 = 0.999$, $T = 1.5$, $\\Delta t = 0.0005$, seed $= 2022$.\n- Test case $4$ (coarser time step to probe stability): $N_e = 2000$, $s = 0$, $u = 0$, $v = 0$, $p_0 = 0.3$, $T = 1.0$, $\\Delta t = 0.01$, seed $= 7$.\n- Test case $5$ (small $N_e$ with symmetric mutation and stronger drift): $N_e = 50$, $s = 0$, $u = 0.001$, $v = 0.001$, $p_0 = 0.5$, $T = 0.5$, $\\Delta t = 0.0005$, seed $= 4242$.\n\nFinal output format:\n\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For example, the output must look like\n  $$ [x_1,x_2,x_3,x_4,x_5], $$\n  where each $x_i$ is the final allele frequency for test case $i$, rounded to six digits after the decimal point and expressed as a decimal fraction (no percentage sign).\n\nNo user input is required or allowed. The output should be deterministic given the seeds above. All results must be within the closed interval $[0,1]$ by construction.", "solution": "The problem posed is the numerical simulation of the Wright–Fisher diffusion, a fundamental stochastic process in population genetics that models the evolution of allele frequencies under mutation, selection, and genetic drift. The task is to implement the Euler–Maruyama method to solve the corresponding stochastic differential equation (SDE). The validity of the problem statement is confirmed, as it is scientifically grounded in established theory, well-posed with all necessary parameters provided, and objectively formulated as a computational task.\n\nThe evolution of the allele frequency, denoted by $p_t$, is described by the one-dimensional Itô SDE:\n$$\n\\mathrm{d}p_t = a(p_t)\\,\\mathrm{d}t + \\sqrt{b(p_t)}\\,\\mathrm{d}W_t\n$$\nwhere $W_t$ is a standard Wiener process. The drift coefficient $a(p)$ and the diffusion coefficient $b(p)$ encapsulate the deterministic and stochastic forces, respectively.\n\nThe drift term, $a(p) = s\\,p\\,(1-p) + v\\,(1-p) - u\\,p$, models the systematic changes in allele frequency. The term $s\\,p\\,(1-p)$ represents genic selection, where $s$ is the selection coefficient. The terms $v\\,(1-p)$ and $-u\\,p$ represent mutation from allele $0$ to allele $1$ (at rate $v$) and from allele $1$ to allele $0$ (at rate $u$), respectively.\n\nThe diffusion term, $b(p) = \\frac{p\\,(1-p)}{2\\,N_e}$, models the random fluctuations due to finite population size, known as genetic drift. The magnitude of these fluctuations is inversely proportional to the effective population size $N_e$.\n\nTo simulate a trajectory of this process, we discretize time into steps of size $\\Delta t$, such that $t_n = n\\,\\Delta t$. The Euler–Maruyama scheme approximates the SDE by the recurrence relation:\n$$\np_{n+1} = p_n + a(p_n)\\,\\Delta t + \\sqrt{b(p_n)}\\,\\Delta W_n\n$$\nwhere $p_n \\approx p(t_n)$ and $\\Delta W_n = W_{t_{n+1}} - W_{t_n}$ is an increment of the Wiener process. These increments are independent and identically distributed normal random variables with mean $0$ and variance $\\Delta t$. We can therefore write $\\Delta W_n = \\sqrt{\\Delta t}\\,Z_n$, where $Z_n$ is a standard normal random variable, $Z_n \\sim \\mathcal{N}(0, 1)$.\n\nSubstituting the expressions for $a(p)$, $b(p)$, and $\\Delta W_n$, the full update rule for a proposed next state $\\tilde{p}_{n+1}$ is:\n$$\n\\tilde{p}_{n+1} = p_n + \\left( s\\,p_n\\,(1-p_n) + v\\,(1-p_n) - u\\,p_n \\right)\\Delta t + \\sqrt{\\frac{p_n\\,(1-p_n)}{2\\,N_e}}\\sqrt{\\Delta t}\\,Z_n\n$$\n\nA critical aspect of this numerical simulation is handling the state space boundaries at $p=0$ and $p=1$. The allele frequency is, by definition, confined to the interval $[0,1]$. However, the stochastic term in the Euler–Maruyama step can cause $\\tilde{p}_{n+1}$ to fall outside this interval, which is mathematically and biologically nonsensical. This is a common artifact of this numerical scheme.\nTo ensure the process remains within its valid domain, two rules are enforced:\n\n1.  **Clamping**: After each step, the proposed value $\\tilde{p}_{n+1}$ is projected back onto the interval $[0,1]$. This is achieved by the operation $p_{n+1} = \\max(0, \\min(1, \\tilde{p}_{n+1}))$. This method is robust and ensures that the state variable always remains valid.\n\n2.  **Absorbing Boundaries**: In the absence of mutation ($u=0$ and $v=0$), the boundaries $p=0$ and $p=1$ represent fixation of one allele. At these points, both the drift $a(p)$ and the diffusion variance $b(p)$ are zero. Thus, once the frequency reaches $0$ or $1$, it is \"absorbed\" and cannot change further. In the simulation, if $p_n$ is $0$ or $1$ under these conditions, it remains fixed for all subsequent time steps. When mutation is present ($u>0$ or $v>0$), the boundaries are no longer absorbing. For example, at $p=0$, the drift becomes $a(0)=v>0$, pushing the frequency back into the interval $(0,1]$. A similar effect occurs at $p=1$ with $a(1)=-u<0$. The clamping mechanism correctly handles this \"reflection\" (more accurately, re-entry) from the boundaries.\n\nNumerical stability is a concern, particularly with larger time steps $\\Delta t$. A large $\\Delta t$ increases the variance of the stochastic increment, making large, non-physical jumps more probable. Test case $4$ explores this with a $\\Delta t$ that is $20$ times larger than in other cases. While analytical stability conditions exist, the specified clamping procedure provides a pragmatic and robust solution that prevents the simulation from failing, at the cost of potentially introducing a small bias if the time step is excessively large relative to the dynamics.\n\nThe algorithm for a single simulation path is as follows:\n1.  Initialize parameters: $N_e, s, u, v, p_0, T, \\Delta t$, and the seed for a pseudo-random number generator.\n2.  Set the initial allele frequency $p = p_0$.\n3.  Calculate the total number of time steps, $N_{\\text{steps}} = \\text{round}(T / \\Delta t)$.\n4.  Iterate $N_{\\text{steps}}$ times:\n    a.  If $u=0$, $v=0$, and $p=0$ or $p=1$, the state is absorbed; the simulation for this path can terminate, returning the current value of $p$.\n    b.  Calculate the drift $a(p)$ and the diffusion standard deviation factor $\\sigma_p = \\sqrt{p(1-p)/(2N_e)}$.\n    c.  Generate a standard normal random number $Z \\sim \\mathcal{N}(0,1)$.\n    d.  Compute the next proposed state: $\\tilde{p} = p + a(p)\\Delta t + \\sigma_p \\sqrt{\\Delta t} Z$.\n    e.  Apply the clamping rule: $p = \\max(0, \\min(1, \\tilde{p}))$.\n5.  After the loop terminates, the final value of $p$ is the result, $p_T$.\n\nThis procedure will be applied to each test case to generate the required results.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the suite of Wright-Fisher diffusion simulations.\n    \"\"\"\n\n    test_cases = [\n        # (Ne, s, u, v, p0, T, dt, seed)\n        (10000, 0.0, 0.0, 0.0, 0.5, 1.0, 0.0005, 12345),\n        (5000, 0.01, 0.0, 0.00001, 0.001, 2.0, 0.0005, 2021),\n        (5000, -0.02, 0.00002, 0.0, 0.999, 1.5, 0.0005, 2022),\n        (2000, 0.0, 0.0, 0.0, 0.3, 1.0, 0.01, 7),\n        (50, 0.0, 0.001, 0.001, 0.5, 0.5, 0.0005, 4242),\n    ]\n\n    results = []\n    for params in test_cases:\n        final_p = simulate_wf_diffusion(*params)\n        # Format the result to exactly six decimal places.\n        results.append(f\"{final_p:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef simulate_wf_diffusion(Ne, s, u, v, p0, T, dt, seed):\n    \"\"\"\n    Simulates a single path of the Wright-Fisher diffusion using Euler-Maruyama.\n\n    Args:\n        Ne (int): Effective population size.\n        s (float): Selection coefficient.\n        u (float): Mutation rate from allele 1 to 0.\n        v (float): Mutation rate from allele 0 to 1.\n        p0 (float): Initial allele frequency.\n        T (float): Total simulation time.\n        dt (float): Time step size.\n        seed (int): Seed for the pseudo-random number generator.\n\n    Returns:\n        float: The final allele frequency at time T.\n    \"\"\"\n    \n    # Initialize the pseudo-random number generator for reproducibility.\n    rng = np.random.default_rng(seed)\n\n    # Current allele frequency.\n    p = p0\n    \n    # Calculate the number of steps, ensuring it is an integer.\n    # Using round() is robust against floating-point inaccuracies.\n    num_steps = int(round(T / dt))\n    \n    # Pre-calculate sqrt(dt) for efficiency in the loop.\n    sqrt_dt = np.sqrt(dt)\n\n    # Check for absorbing boundaries case at the start.\n    is_absorbing = (u == 0.0 and v == 0.0)\n\n    for _ in range(num_steps):\n        # Handle absorbing boundaries if applicable.\n        if is_absorbing and (p == 0.0 or p == 1.0):\n            # If the state is absorbed, it remains fixed.\n            break\n\n        # Calculate drift coefficient a(p).\n        drift_a = s * p * (1 - p) + v * (1 - p) - u * p\n\n        # Calculate diffusion coefficient b(p).\n        # This will be zero if p=0 or p=1, correctly nullifying the stochastic term.\n        diffusion_b_term = np.sqrt(p * (1 - p) / (2 * Ne))\n\n        # Generate a standard normal random increment.\n        Z = rng.normal(0, 1)\n\n        # Euler-Maruyama step.\n        # The stochastic increment is sqrt(b(p)) * dW = sqrt(b(p)) * Z * sqrt(dt).\n        p_tilde = p + drift_a * dt + diffusion_b_term * Z * sqrt_dt\n        \n        # Enforce state constraints [0, 1] by clamping.\n        p = min(max(p_tilde, 0.0), 1.0)\n    \n    return p\n\n# Execute the simulation.\nsolve()\n```", "id": "2753540"}]}