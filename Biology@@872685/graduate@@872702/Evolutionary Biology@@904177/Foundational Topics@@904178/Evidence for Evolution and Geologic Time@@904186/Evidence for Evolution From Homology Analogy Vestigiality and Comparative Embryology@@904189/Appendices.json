{"hands_on_practices": [{"introduction": "The concept of homology is not a statement of faith, but a scientific hypothesis that can be rigorously tested. This exercise puts this principle into practice using the classic evolutionary transition of the vertebrate jaw joint into the mammalian middle ear ossicles. By translating the competing hypotheses of homology versus analogy into explicit, mutually exclusive character-coding schemes, you will use the principle of parsimony to determine which explanation is better supported by the anatomical data on a given phylogeny [@problem_id:2706069]. This practice demonstrates how abstract evolutionary scenarios can be formalized and evaluated quantitatively.", "problem": "A central inference in evolutionary biology is that putative homologies are supported when an explicit, character-level hypothesis explaining observed anatomical distributions across taxa requires fewer evolutionary changes than competing, mutually exclusive codings that deny homology. Consider the well-documented transformation of the primary jaw joint (articular–quadrate) in non-mammalian vertebrates to the mammalian middle-ear ossicles (malleus–incus), which is historically interpreted as a homologous transformation based on comparative embryology and development. You will evaluate two mutually exclusive character-coding schemes that encapsulate the two alternative hypotheses and compute the minimum number of steps each requires on a fixed phylogeny using unordered parsimony.\n\nUse the following rooted phylogeny in Newick format (root at Actinopterygian): \"(Actinopterygian,(Amphibian,(Reptile,(Cynodont,(Monotreme,Therian)))))\". The terminal taxa are: Actinopterygian, Amphibian, Reptile, Cynodont, Monotreme, Therian. Assume equal weights and unordered character evolution.\n\nThe observed comparative anatomy and development are as follows. In Actinopterygian, Amphibian, and Reptile, the primary jaw joint is between articular and quadrate, and there are no separate middle-ear malleus and incus. In Cynodont (a non-mammalian synapsid), a transitional condition retains an articular–quadrate jaw joint albeit reduced, with no fully detached middle-ear ossicles. In Monotreme and Therian mammals, the jaw joint is dentary–squamosal and the middle ear possesses malleus and incus derived from the first pharyngeal arch.\n\nConstruct two mutually exclusive character-coding schemes capturing the competing hypotheses, then compute the minimum number of steps required for each coding on the given tree using Fitch parsimony:\n\n- Hypothesis $H_{1}$ (homology): The mammalian malleus–incus are homologous to the non-mammalian articular–quadrate. Code a single unordered binary character $C^{(H_{1})}$ with state $0$ denoting “the element functions as the primary jaw joint (articular–quadrate)” and state $1$ denoting “the same element functions as middle-ear ossicles (malleus–incus).” For Cynodont, use a polymorphic state $ \\{0,1\\} $ to reflect the transitional condition.\n\n- Hypothesis $H_{2}$ (non-homology/analogy): The mammalian malleus–incus are neomorphic and not homologous to the articular–quadrate. Under this hypothesis, represent the observations with two independent unordered binary characters: $C_{A}$ coding presence ($1$) versus absence ($0$) of the articular–quadrate jaw bones, and $C_{M}$ coding presence ($1$) versus absence ($0$) of the malleus–incus. Define the parsimony score for $H_{2}$ as the sum of the minimum steps for $C_{A}$ and $C_{M}$.\n\nExplicitly specify the terminal states you assign under each coding, then compute the minimum number of steps on the given tree using unordered Fitch parsimony with equal weights. Report your final result as a row matrix $\\begin{pmatrix} s_{H_{1}} & s_{H_{2}} \\end{pmatrix}$, where $s_{H_{1}}$ is the minimum number of steps for $C^{(H_{1})}$ and $s_{H_{2}}$ is the sum of minimum steps for $C_{A}$ and $C_{M}$. No rounding is required. The final answer must be a single row matrix with no units.", "solution": "The problem is subjected to validation before any attempt at a solution.\n\nStep 1: Extraction of Givens.\n- **Phylogeny:** A rooted tree given in Newick format as \"(Actinopterygian,(Amphibian,(Reptile,(Cynodont,(Monotreme,Therian)))))\". The root is at the branch leading to Actinopterygian.\n- **Terminal Taxa:** Actinopterygian, Amphibian, Reptile, Cynodont, Monotreme, Therian.\n- **Methodology:** Unordered Fitch parsimony with equal character state weights. The parsimony score is the minimum number of evolutionary steps (state changes).\n- **Anatomical Observations:**\n    - Actinopterygian, Amphibian, Reptile: Possess an articular-quadrate primary jaw joint; lack separate malleus-incus middle-ear ossicles.\n    - Cynodont: Possesses a reduced articular-quadrate jaw joint and no fully detached middle-ear ossicles. This is defined as a transitional condition.\n    - Monotreme, Therian: Possess a dentary-squamosal jaw joint and malleus-incus middle-ear ossicles.\n- **Hypothesis $H_{1}$ (Homology):**\n    - A single unordered binary character, $C^{(H_{1})}$.\n    - State $0$: The homologous element functions as the primary jaw joint (articular-quadrate).\n    - State $1$: The homologous element functions as middle-ear ossicles (malleus-incus).\n    - Cynodont is coded with a polymorphic state $\\{0,1\\}$.\n- **Hypothesis $H_{2}$ (Non-homology/Analogy):**\n    - Two independent unordered binary characters, $C_{A}$ and $C_{M}$.\n    - Character $C_{A}$: Presence ($1$) versus absence ($0$) of the articular-quadrate jaw bones.\n    - Character $C_{M}$: Presence ($1$) versus absence ($0$) of the malleus-incus middle-ear ossicles.\n    - The parsimony score for $H_{2}$, denoted as $s_{H_{2}}$, is the sum of the minimum steps for $C_{A}$ and $C_{M}$.\n- **Objective:** Compute the minimum number of steps for each hypothesis, $s_{H_{1}}$ and $s_{H_{2}}$, and report them as a row matrix $\\begin{pmatrix} s_{H_{1}} & s_{H_{2}} \\end{pmatrix}$.\n\nStep 2: Validation of Problem Statement.\n- **Scientific Grounding:** The problem is scientifically grounded. It presents a classic example of macroevolutionary transformation (jaw joint to ear ossicles) and employs a standard quantitative method in phylogenetics (parsimony) to evaluate competing hypotheses of homology. The phylogeny and anatomical data are consistent with established paleontological and comparative anatomical knowledge.\n- **Well-Posedness:** The problem is well-posed. It provides a fixed tree, explicitly defined character-coding schemes, and a deterministic algorithm (Fitch parsimony) for which a unique minimum step count exists. All necessary information is provided.\n- **Objectivity:** The problem is objective, requiring a formal calculation based on provided data and rules, free of subjective interpretation or opinion.\n\nStep 3: Verdict.\nThe problem is valid. It is a well-defined exercise in phylogenetic character analysis. A solution will now be computed.\n\nThe core of the task is to calculate the minimum number of character-state changes (the parsimony score) for two competing hypotheses on a given phylogeny. The phylogeny can be represented with labeled internal nodes for clarity. Let the internal nodes be $N_{1}$, $N_{2}$, $N_{3}$, and $N_{4}$.\n- $N_{1}$: Most recent common ancestor (MRCA) of Monotreme and Therian.\n- $N_{2}$: MRCA of Cynodont and $N_{1}$.\n- $N_{3}$: MRCA of Reptile and $N_{2}$.\n- $N_{4}$: MRCA of Amphibian and $N_{3}$.\nThe root of the tree is the MRCA of Actinopterygian and $N_{4}$.\n\nThe calculation will employ the Fitch algorithm. In the first (bottom-up) pass, for each internal node $k$ with daughter nodes $i$ and $j$ having state sets $S_{i}$ and $S_{j}$, the state set for $k$ is $S_{k} = S_{i} \\cap S_{j}$ if the intersection is non-empty. If the intersection is empty ($S_{i} \\cap S_{j} = \\emptyset$), then $S_{k} = S_{i} \\cup S_{j}$, and one step (a change) is added to the total length of the tree.\n\n**Analysis of Hypothesis $H_{1}$ (Homology)**\n\nUnder $H_{1}$, we use a single character $C^{(H_{1})}$.\n- **State Assignment:**\n    - Actinopterygian: State $0$ (jaw joint function).\n    - Amphibian: State $0$.\n    - Reptile: State $0$.\n    - Cynodont: State $\\{0,1\\}$ (polymorphic/transitional).\n    - Monotreme: State $1$ (ear ossicle function).\n    - Therian: State $1$.\n\n- **Fitch Algorithm (Bottom-up Pass):**\n    1.  **Node $N_{1}$ (parent of Monotreme, Therian):** $S_{Monotreme}=\\{1\\}$, $S_{Therian}=\\{1\\}$. The intersection is $S_{Monotreme} \\cap S_{Therian} = \\{1\\}$, which is non-empty. Thus, $S_{N_{1}}=\\{1\\}$. Steps = $0$.\n    2.  **Node $N_{2}$ (parent of Cynodont, $N_{1}$):** $S_{Cynodont}=\\{0,1\\}$, $S_{N_{1}}=\\{1\\}$. The intersection is $S_{Cynodont} \\cap S_{N_{1}} = \\{0,1\\} \\cap \\{1\\} = \\{1\\}$, which is non-empty. Thus, $S_{N_{2}}=\\{1\\}$. Steps remain $0$.\n    3.  **Node $N_{3}$ (parent of Reptile, $N_{2}$):** $S_{Reptile}=\\{0\\}$, $S_{N_{2}}=\\{1\\}$. The intersection is $S_{Reptile} \\cap S_{N_{2}} = \\{0\\} \\cap \\{1\\} = \\emptyset$, which is empty. Thus, $S_{N_{3}} = S_{Reptile} \\cup S_{N_{2}} = \\{0\\} \\cup \\{1\\} = \\{0,1\\}$. A step is counted. Steps = $1$.\n    4.  **Node $N_{4}$ (parent of Amphibian, $N_{3}$):** $S_{Amphibian}=\\{0\\}$, $S_{N_{3}}=\\{0,1\\}$. The intersection is $S_{Amphibian} \\cap S_{N_{3}} = \\{0\\} \\cap \\{0,1\\} = \\{0\\}$, which is non-empty. Thus, $S_{N_{4}}=\\{0\\}$. Steps remain $1$.\n    5.  **Root Node (parent of Actinopterygian, $N_{4}$):** $S_{Actinopterygian}=\\{0\\}$, $S_{N_{4}}=\\{0\\}$. The intersection is $S_{Actinopterygian} \\cap S_{N_{4}} = \\{0\\}$, which is non-empty. Thus, $S_{Root}=\\{0\\}$. Steps remain $1$.\n\nThe total minimum number of steps for hypothesis $H_{1}$ is $s_{H_{1}} = 1$. This single change represents the evolutionary transition of the element's function from a jaw joint to an ear ossicle.\n\n**Analysis of Hypothesis $H_{2}$ (Non-homology)**\n\nUnder $H_{2}$, we analyze two independent characters, $C_{A}$ and $C_{M}$, and sum their scores.\n\n**Character $C_{A}$: Presence($1$)/Absence($0$) of Articular-Quadrate Jaw Bones.**\n- **State Assignment:**\n    - Actinopterygian: $1$ (present).\n    - Amphibian: $1$ (present).\n    - Reptile: $1$ (present).\n    - Cynodont: $1$ (present, albeit reduced).\n    - Monotreme: $0$ (absent).\n    - Therian: $0$ (absent).\n\n- **Fitch Algorithm for $C_{A}$:**\n    1.  **Node $N_{1}$:** $S_{Monotreme}=\\{0\\}$, $S_{Therian}=\\{0\\}$. Intersection is $\\{0\\}$. $S_{N_{1}}=\\{0\\}$. Steps = $0$.\n    2.  **Node $N_{2}$:** $S_{Cynodont}=\\{1\\}$, $S_{N_{1}}=\\{0\\}$. Intersection is empty. $S_{N_{2}} = \\{0\\} \\cup \\{1\\} = \\{0,1\\}$. Steps = $1$.\n    3.  **Node $N_{3}$:** $S_{Reptile}=\\{1\\}$, $S_{N_{2}}=\\{0,1\\}$. Intersection is $\\{1\\}$. $S_{N_{3}}=\\{1\\}$. Steps remain $1$.\n    4.  **Node $N_{4}$:** $S_{Amphibian}=\\{1\\}$, $S_{N_{3}}=\\{1\\}$. Intersection is $\\{1\\}$. $S_{N_{4}}=\\{1\\}$. Steps remain $1$.\n    5.  **Root Node:** $S_{Actinopterygian}=\\{1\\}$, $S_{N_{4}}=\\{1\\}$. Intersection is $\\{1\\}$. $S_{Root}=\\{1\\}$. Steps remain $1$.\nThe minimum number of steps for $C_{A}$ is $1$. This step represents the loss of the articular-quadrate jaw joint.\n\n**Character $C_{M}$: Presence($1$)/Absence($0$) of Malleus-Incus Ossicles.**\n- **State Assignment:**\n    - Actinopterygian: $0$ (absent).\n    - Amphibian: $0$ (absent).\n    - Reptile: $0$ (absent).\n    - Cynodont: $0$ (absent, \"no fully detached... ossicles\").\n    - Monotreme: $1$ (present).\n    - Therian: $1$ (present).\n\n- **Fitch Algorithm for $C_{M}$:**\n    1.  **Node $N_{1}$:** $S_{Monotreme}=\\{1\\}$, $S_{Therian}=\\{1\\}$. Intersection is $\\{1\\}$. $S_{N_{1}}=\\{1\\}$. Steps = $0$.\n    2.  **Node $N_{2}$:** $S_{Cynodont}=\\{0\\}$, $S_{N_{1}}=\\{1\\}$. Intersection is empty. $S_{N_{2}} = \\{0\\} \\cup \\{1\\} = \\{0,1\\}$. Steps = $1$.\n    3.  **Node $N_{3}$:** $S_{Reptile}=\\{0\\}$, $S_{N_{2}}=\\{0,1\\}$. Intersection is $\\{0\\}$. $S_{N_{3}}=\\{0\\}$. Steps remain $1$.\n    4.  **Node $N_{4}$:** $S_{Amphibian}=\\{0\\}$, $S_{N_{3}}=\\{0\\}$. Intersection is $\\{0\\}$. $S_{N_{4}}=\\{0\\}$. Steps remain $1$.\n    5.  **Root Node:** $S_{Actinopterygian}=\\{0\\}$, $S_{N_{4}}=\\{0\\}$. Intersection is $\\{0\\}$. $S_{Root}=\\{0\\}$. Steps remain $1$.\nThe minimum number of steps for $C_{M}$ is $1$. This step represents the neomorphic origin of the malleus-incus complex.\n\nThe total parsimony score for hypothesis $H_{2}$ is the sum of the scores for the two characters:\n$s_{H_{2}} = \\text{score}(C_{A}) + \\text{score}(C_{M}) = 1 + 1 = 2$.\n\n**Final Result**\nThe minimum number of steps required under the homology hypothesis is $s_{H_{1}} = 1$. The minimum number of steps required under the non-homology hypothesis is $s_{H_{2}} = 2$. The problem asks for the result as a row matrix $\\begin{pmatrix} s_{H_{1}} & s_{H_{2}} \\end{pmatrix}$.\nSubstituting the calculated values, we obtain the final matrix.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & 2\n\\end{pmatrix}\n}\n$$", "id": "2706069"}, {"introduction": "Evidence for evolution is abundant at the molecular level, where vestigial structures manifest as non-functional 'pseudogenes.' Detecting this loss of function requires moving beyond simple sequence inspection to a quantitative analysis of evolutionary rates. This problem introduces the ratio of nonsynonymous ($d_{N}$) to synonymous ($d_{S}$) substitution rates, or $\\omega$, as a key metric for diagnosing selective pressures on a gene [@problem_id:2706009]. You will calculate this ratio for an opsin gene in a nocturnal primate, a classic scenario for sensory gene loss, and interpret the result to distinguish between complete pseudogenization and simple relaxation of constraint.", "problem": "A single-copy long-wavelength-sensitive opsin coding sequence from $6$ primate species (four Haplorhini with intact vision genes and two Strepsirrhini, of which one is a nocturnal species with evidence of loss-of-function mutations) is aligned without gaps relative to the inferred ancestral reading frame. Orthology is supported by conserved exon–intron structure and synteny (homology), and the nocturnal strepsirrhine lineage shows a frameshift and two premature stop codons consistent with vestigialization (pseudogenization). For the coding region of length $L$ codons, the codon-degeneracy analysis yields a total of $S = 300$ synonymous sites and $N = 600$ nonsynonymous sites (so $S+N=900$ nucleotide sites) that are comparable across lineages.\n\nA maximum parsimony (MP) reconstruction of changes mapped onto the species tree identifies substitutions uniquely occurring on the branch leading to the nocturnal strepsirrhine lineage after its split from its closest sampled relative. On this branch, there are $D_{S} = 60$ synonymous differences and $D_{N} = 120$ nonsynonymous differences. For the set of other branches leading to species with intact genes, the aggregate mapping shows a strong excess of synonymous over nonsynonymous changes, consistent with purifying selection (data provided for context only; you are not required to compute ratios for those branches).\n\nUsing the standard framework in which the observed proportions of synonymous and nonsynonymous differences per site are corrected for multiple hits under the Jukes–Cantor model as in the Nei–Gojobori approach, compute the ratio of the nonsynonymous to synonymous substitution rates, $d_{N}/d_{S}$ (often denoted $\\omega$), specifically for the nocturnal strepsirrhine branch. Then, based on first principles of how $\\omega$ behaves under purifying selection, neutrality, and positive selection, reason whether the calculated value is more consistent with pseudogenization (neutral evolution following loss of function) or merely relaxed constraint without complete loss of function. Do not assume any shortcut formulas beyond the standard correction and definitions.\n\nReport the numerical value of $d_{N}/d_{S}$ for the nocturnal strepsirrhine branch as a pure number with no units, rounded to $3$ significant figures.", "solution": "The problem statement has been subjected to a strict validation process.\n\n**Step 1: Extracted Givens**\n- Sequence type: single-copy long-wavelength-sensitive opsin coding sequence.\n- Species: $6$ primates.\n- Total synonymous sites: $S = 300$.\n- Total nonsynonymous sites: $N = 600$.\n- Analysis is for the branch leading to a nocturnal strepsirrhine lineage.\n- Synonymous differences on this branch: $D_{S} = 60$.\n- Nonsynonymous differences on this branch: $D_{N} = 120$.\n- Correction model: Jukes-Cantor model, as in the Nei-Gojobori approach.\n- Required computation: The ratio $\\omega = d_{N}/d_{S}$.\n- Required interpretation: Whether the value of $\\omega$ is more consistent with pseudogenization or relaxed constraint.\n- Required output format: Numerical value rounded to $3$ significant figures.\n\n**Step 2: Validation Using Extracted Givens**\n- **Scientifically Grounded:** The problem is based on fundamental and standard principles of molecular phylogenetics and evolutionary genetics, specifically the analysis of selective pressures on protein-coding genes. The concepts of synonymous ($S$) and nonsynonymous ($N$) sites, substitutions ($d_S$, $d_N$), the Jukes-Cantor correction, and the interpretation of the $\\omega$ ratio are all central to the field. The biological context (pseudogenization of a vision gene in a nocturnal animal) is a classic, well-documented evolutionary phenomenon.\n- **Well-Posed:** All necessary data ($S, N, D_S, D_N$) are provided. The methodology is clearly specified (Nei-Gojobori with Jukes-Cantor correction). The question is unambiguous and leads to a unique, derivable solution.\n- **Objective:** The problem is stated using precise, quantitative language and is free of subjective or non-scientific claims.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, well-posed, and objective. It contains no logical contradictions, ambiguities, or factual errors. Therefore, the problem is deemed **valid**. A full solution will be provided.\n\nThe task is to compute the ratio of the nonsynonymous substitution rate ($d_N$) to the synonymous substitution rate ($d_S$), denoted by $\\omega$, for a specific lineage and to interpret the result in the context of molecular evolution.\n\nFirst, we compute the observed proportion of synonymous differences ($p_S$) and nonsynonymous differences ($p_N$) on the branch leading to the nocturnal strepsirrhine. These proportions are the number of observed differences divided by the total number of available sites in each category.\n\nThe given values are:\nNumber of synonymous sites, $S = 300$.\nNumber of synonymous differences, $D_S = 60$.\nNumber of nonsynonymous sites, $N = 600$.\nNumber of nonsynonymous differences, $D_N = 120$.\n\nThe proportion of synonymous differences is:\n$$ p_S = \\frac{D_S}{S} = \\frac{60}{300} = 0.2 $$\nThe proportion of nonsynonymous differences is:\n$$ p_N = \\frac{D_N}{N} = \\frac{120}{600} = 0.2 $$\n\nNext, these observed proportions must be corrected for multiple substitutions at the same site, which are not directly observable. The problem specifies the use of the Jukes-Cantor (JC69) model for this correction. The JC69 formula estimates the number of substitutions per site, $d$, from the observed proportion of different sites, $p$, as:\n$$ d = -\\frac{3}{4} \\ln\\left(1 - \\frac{4}{3}p\\right) $$\nThis formula is applied independently to both the synonymous and nonsynonymous categories.\n\nThe corrected rate of synonymous substitutions per synonymous site, $d_S$, is:\n$$ d_S = -\\frac{3}{4} \\ln\\left(1 - \\frac{4}{3}p_S\\right) = -\\frac{3}{4} \\ln\\left(1 - \\frac{4}{3}(0.2)\\right) $$\nThe corrected rate of nonsynonymous substitutions per nonsynonymous site, $d_N$, is:\n$$ d_N = -\\frac{3}{4} \\ln\\left(1 - \\frac{4}{3}p_N\\right) = -\\frac{3}{4} \\ln\\left(1 - \\frac{4}{3}(0.2)\\right) $$\n\nBecause the proportions of differences are identical ($p_S = p_N = 0.2$), the application of the same correction function to both must yield identical corrected rates:\n$$ d_S = d_N $$\n\nThe ratio $\\omega = d_N/d_S$ is therefore:\n$$ \\omega = \\frac{d_N}{d_S} = 1 $$\nWhen rounded to $3$ significant figures as requested, the value is $1.00$.\n\nNow for the interpretation. The ratio $\\omega = d_N/d_S$ is a critical indicator of the selective pressure acting on a protein-coding gene. The theoretical expectations for $\\omega$ are as follows:\n- $\\omega < 1$: Purifying (negative) selection. Nonsynonymous mutations are deleterious and are removed by selection, leading to a lower rate of nonsynonymous substitution compared to synonymous (neutral) substitution. This is an indicator of functional constraint.\n- $\\omega \\approx 1$: Neutral evolution. There is no selective pressure on the protein sequence. Nonsynonymous mutations are neither favored nor disfavored and accumulate at the same rate as synonymous mutations. This is the definitive signature of a pseudogene or a gene that has completely lost its function.\n- $\\omega > 1$: Positive (diversifying) selection. Nonsynonymous mutations are advantageous and are fixed by selection at a higher rate than synonymous mutations. This is an indicator of adaptive evolution.\n\nThe calculated value for the nocturnal strepsirrhine branch is $\\omega = 1.00$. This result is perfectly consistent with the hypothesis of neutral evolution. The biological context provides strong evidence for this: the opsin gene is in a nocturnal species (where color vision is less critical) and shows molecular evidence of being non-functional (frameshift, stop codons), i.e., it is a pseudogene. In a pseudogene, the selective constraint to maintain a specific amino acid sequence is lost. Consequently, nonsynonymous mutations are no longer deleterious and accumulate at the neutral rate, which is the same as the rate for synonymous mutations. Hence, $d_N$ becomes equal to $d_S$, and $\\omega$ is expected to be $1$.\n\nThe alternative interpretation, 'merely relaxed constraint without complete loss of function,' would imply that selection is weaker but not absent. This would lead to a value of $\\omega$ greater than what is observed under strong constraint but still significantly less than $1$. The observed value of $\\omega = 1.00$ is strong evidence for complete loss of function and subsequent pseudogenization, not simply relaxed constraint.", "answer": "$$ \\boxed{1.00} $$", "id": "2706009"}, {"introduction": "Analogy, or convergent evolution, is the independent evolution of similar traits in different lineages. However, simply observing similarity is not enough; we must statistically demonstrate that this similarity is greater than what would be expected from shared ancestry alone. This practice introduces a powerful model-based approach using Phylogenetic Generalized Least Squares (PGLS) to test for convergence in a continuous trait [@problem_id:2706067]. By comparing a model of simple Brownian motion drift against a model that includes a convergent 'pull' for succulent plants, you will learn how to formally quantify the evidence for analogy in a phylogenetic context.", "problem": "You are given a scenario in which multiple plant lineages have independently evolved succulent morphology. Your task is to formalize, implement, and evaluate a comparative analysis that quantifies whether the observed morphological similarity is more consistent with phylogenetically structured drift under Brownian Motion (BM) or with constrained convergence producing a shared mean shift across unrelated succulent lineages. The analysis must be framed as a model comparison between two Gaussian models for a continuous trait on a fixed phylogenetic correlation structure.\n\nUse the following fundamental base: the continuous trait at the tips of a phylogeny under Brownian Motion (BM) follows a multivariate normal distribution with a covariance proportional to the matrix of shared evolutionary times from the root to the most recent common ancestor (Most Recent Common Ancestor (MRCA)) of each pair of species. Phylogenetic Generalized Least Squares (PGLS) models specify linear predictors for the mean while retaining the BM covariance. Bayesian Information Criterion (BIC) can be used to approximate Bayes factors between models, which can then be converted into posterior model probabilities under equal model priors. All implementation details must follow from these bases; do not assume any additional shortcuts beyond them.\n\nDefine the two models as follows, using standard notations for linear models and multivariate normal distributions. Let the number of species be $n$, the observed trait vector be $\\mathbf{y} \\in \\mathbb{R}^{n}$, and the phylogenetic shared-time matrix be $\\mathbf{S} \\in \\mathbb{R}^{n \\times n}$, which is symmetric and positive definite. Let $\\mathbf{1}$ denote the $n$-vector of ones, and let $\\mathbf{g} \\in \\{0,1\\}^{n}$ be the indicator vector that encodes the \"succulent\" regime ($1$ for succulent, $0$ otherwise). Consider:\n- Model $\\mathcal{M}_{\\mathrm{BM}}$ (Brownian drift only): mean $\\mathbb{E}[\\mathbf{y}] = \\beta_{0} \\mathbf{1}$ and covariance $\\mathrm{Var}(\\mathbf{y}) = \\sigma^{2} \\mathbf{S}$.\n- Model $\\mathcal{M}_{\\mathrm{CC}}$ (constrained convergence as a shared mean shift for succulents): mean $\\mathbb{E}[\\mathbf{y}] = \\beta_{0} \\mathbf{1} + \\beta_{1} \\mathbf{g}$ and covariance $\\mathrm{Var}(\\mathbf{y}) = \\sigma^{2} \\mathbf{S}$.\n\nYour program must, for each test case below, compute:\n1. The maximum-likelihood fit of each model using Phylogenetic Generalized Least Squares (PGLS).\n2. The maximized log-likelihood under each model using the multivariate normal density with the fitted parameters.\n3. The Bayesian Information Criterion (BIC) for each model with $k$ equal to the number of free mean parameters plus the variance scale parameter $\\sigma^2$ (that is, $k = 2$ for $\\mathcal{M}_{\\mathrm{BM}}$ and $k = 3$ for $\\mathcal{M}_{\\mathrm{CC}}$).\n4. The Bayes factor approximation using BIC, with\n   $$ \\mathrm{BF}_{10} \\approx \\exp\\left(\\frac{\\mathrm{BIC}_{0} - \\mathrm{BIC}_{1}}{2}\\right), $$\n   where subscript $0$ refers to $\\mathcal{M}_{\\mathrm{BM}}$ and subscript $1$ refers to $\\mathcal{M}_{\\mathrm{CC}}$.\n5. The posterior probability for $\\mathcal{M}_{\\mathrm{BM}}$ under equal model priors,\n   $$ \\Pr(\\mathcal{M}_{\\mathrm{BM}} \\mid \\text{data}) = \\frac{1}{1 + \\mathrm{BF}_{10}}. $$\n\nReport, for each test case, a single float: $\\Pr(\\mathcal{M}_{\\mathrm{BM}} \\mid \\text{data})$, rounded to six decimal places.\n\nTest Suite. For all cases below, the shared-time matrix $\\mathbf{S}$ is constructed from an ultrametric phylogeny with total root-to-tip time $T = 1$, so that $S_{ii} = 1$ for all $i$, and $S_{ij}$ equals the time from the root to the MRCA of taxa $i$ and $j$. All values are unitless. The species are ordered as listed, and vectors are in the same order.\n\n- Case A (happy path, strong convergent signal across unrelated lineages). Number of species $n = 8$. Two major clades split at time $t = 0$, each with an internal split at time $t = 0.4$, and terminal splits at time $t = 0.7$, yielding sibling shared times of $0.7$, shared times of $0.4$ within a major clade but different subclades, and $0$ across major clades. Species: $\\{\\mathrm{A},\\mathrm{B},\\mathrm{C},\\mathrm{D},\\mathrm{E},\\mathrm{F},\\mathrm{G},\\mathrm{H}\\}$. Succulent indicator $\\mathbf{g}_{A} = [\\,0,1,0,0,0,0,1,0\\,]^{\\top}$. Trait vector $\\mathbf{y}_{A} = [\\,0.9,3.1,1.2,0.8,1.1,1.0,2.9,1.2\\,]^{\\top}$. The $\\mathbf{S}_{A}$ matrix has:\n  - Diagonal entries $S_{ii} = 1.0$.\n  - For sibling pairs $(\\mathrm{A},\\mathrm{B})$, $(\\mathrm{C},\\mathrm{D})$, $(\\mathrm{E},\\mathrm{F})$, $(\\mathrm{G},\\mathrm{H})$, set $S_{ij} = 0.7$.\n  - For within-clade but not siblings: $(\\mathrm{A},\\mathrm{C})$, $(\\mathrm{A},\\mathrm{D})$, $(\\mathrm{B},\\mathrm{C})$, $(\\mathrm{B},\\mathrm{D})$, and $(\\mathrm{E},\\mathrm{G})$, $(\\mathrm{E},\\mathrm{H})$, $(\\mathrm{F},\\mathrm{G})$, $(\\mathrm{F},\\mathrm{H})$, set $S_{ij} = 0.4$.\n  - All other off-diagonals $S_{ij} = 0.0$.\n  Explicitly,\n  $$ \\mathbf{y}_{A} = \\begin{bmatrix} 0.9 \\\\ 3.1 \\\\ 1.2 \\\\ 0.8 \\\\ 1.1 \\\\ 1.0 \\\\ 2.9 \\\\ 1.2 \\end{bmatrix}, \\quad\n     \\mathbf{g}_{A} = \\begin{bmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{bmatrix}. $$\n\n- Case B (boundary-like, data consistent with Brownian drift and no convergent mean shift). Same $\\mathbf{S}$ and $\\mathbf{g}$ structure as Case A. Trait vector $\\mathbf{y}_{B} = [\\,1.1,1.0,0.95,1.05,1.2,0.9,1.05,1.1\\,]^{\\top}$. Explicitly,\n  $$ \\mathbf{y}_{B} = \\begin{bmatrix} 1.1 \\\\ 1.0 \\\\ 0.95 \\\\ 1.05 \\\\ 1.2 \\\\ 0.9 \\\\ 1.05 \\\\ 1.1 \\end{bmatrix}, \\quad\n     \\mathbf{g}_{B} = \\begin{bmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{bmatrix}. $$\n\n- Case C (edge case, small tree with two unrelated succulents). Number of species $n = 4$. Two disjoint sibling pairs $(\\mathrm{A},\\mathrm{B})$ and $(\\mathrm{C},\\mathrm{D})$ with sibling shared time $0.8$ and MRCA at the root across pairs with shared time $0.0$. Succulent indicator $\\mathbf{g}_{C} = [\\,0,1,1,0\\,]^{\\top}$. Trait vector $\\mathbf{y}_{C} = [\\,1.0,2.6,2.4,0.9\\,]^{\\top}$. The $\\mathbf{S}_{C}$ matrix has diagonal entries $1.0$, off-diagonals $0.8$ within sibling pairs, and $0.0$ across pairs. Explicitly,\n  $$ \\mathbf{y}_{C} = \\begin{bmatrix} 1.0 \\\\ 2.6 \\\\ 2.4 \\\\ 0.9 \\end{bmatrix}, \\quad\n     \\mathbf{g}_{C} = \\begin{bmatrix} 0 \\\\ 1 \\\\ 1 \\\\ 0 \\end{bmatrix}. $$\n\nImplementation and Output Requirements.\n- Your program must implement the maximum-likelihood Phylogenetic Generalized Least Squares fits for both models for each test case, the corresponding maximized log-likelihoods under the multivariate normal, BIC values, the BIC-approximated Bayes factor $\\mathrm{BF}_{10}$, and the posterior probability $\\Pr(\\mathcal{M}_{\\mathrm{BM}} \\mid \\text{data})$ under equal priors.\n- For each of the three cases, output a single float equal to $\\Pr(\\mathcal{M}_{\\mathrm{BM}} \\mid \\text{data})$, rounded to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[\\mathrm{result}_{A},\\mathrm{result}_{B},\\mathrm{result}_{C}]$.", "solution": "The problem presents a task of model selection in the field of quantitative evolutionary biology. It is scientifically sound, well-posed, and contains all necessary information for a unique, verifiable solution. The methods prescribed—Phylogenetic Generalized Least Squares (PGLS), Maximum Likelihood (ML) estimation, and model comparison via the Bayesian Information Criterion (BIC)—are standard and appropriate for the question. The problem is therefore deemed valid and a solution will be provided.\n\nThe core of this analysis is to compare two statistical models describing the evolution of a continuous trait $\\mathbf{y}$ on a phylogeny. The phylogeny imposes a structure of non-independence among the data points (species traits), which is captured by the covariance matrix $\\mathbf{S}$. The trait vector $\\mathbf{y}$ for $n$ species is thus modeled as a single draw from a multivariate normal distribution, $\\mathbf{y} \\sim \\mathcal{N}(\\boldsymbol{\\mu}, \\sigma^2 \\mathbf{S})$. The two models differ in their formulation of the mean vector $\\boldsymbol{\\mu}$.\n\nModel $\\mathcal{M}_{\\mathrm{BM}}$ represents the null hypothesis of evolution by simple Brownian drift. The expected trait value is constant across all species, governed by a single parameter $\\beta_0$. The mean vector is $\\mathbb{E}[\\mathbf{y}] = \\beta_{0} \\mathbf{1}$, where $\\mathbf{1}$ is a vector of ones. This is a linear model $\\mathbf{y} = \\mathbf{X}_0 \\boldsymbol{\\beta}_0 + \\boldsymbol{\\epsilon}$, with a design matrix $\\mathbf{X}_0 = \\mathbf{1}$ of size $n \\times 1$.\n\nModel $\\mathcal{M}_{\\mathrm{CC}}$ represents the alternative hypothesis of constrained convergence, where species in the \"succulent\" group are hypothesized to share a different mean trait value. This is modeled as a mean shift. The mean vector is $\\mathbb{E}[\\mathbf{y}] = \\beta_{0} \\mathbf{1} + \\beta_{1} \\mathbf{g}$, where $\\mathbf{g}$ is the indicator vector for the succulent regime. This is a linear model $\\mathbf{y} = \\mathbf{X}_1 \\boldsymbol{\\beta}_1 + \\boldsymbol{\\epsilon}$, with a design matrix $\\mathbf{X}_1 = [\\mathbf{1} \\quad \\mathbf{g}]$ of size $n \\times 2$.\n\nFor a general PGLS model $\\mathbf{y} \\sim \\mathcal{N}(\\mathbf{X}\\boldsymbol{\\beta}, \\sigma^2 \\mathbf{S})$, the Maximum Likelihood (ML) parameters are found using the principles of Generalized Least Squares. The ML estimator for the regression coefficients $\\boldsymbol{\\beta}$ is:\n$$ \\hat{\\boldsymbol{\\beta}} = (\\mathbf{X}^{\\top} \\mathbf{S}^{-1} \\mathbf{X})^{-1} \\mathbf{X}^{\\top} \\mathbf{S}^{-1} \\mathbf{y} $$\nGiven this $\\hat{\\boldsymbol{\\beta}}$, the ML estimator for the variance parameter $\\sigma^2$ is:\n$$ \\hat{\\sigma}^2 = \\frac{1}{n} (\\mathbf{y} - \\mathbf{X}\\hat{\\boldsymbol{\\beta}})^{\\top} \\mathbf{S}^{-1} (\\mathbf{y} - \\mathbf{X}\\hat{\\boldsymbol{\\beta}}) $$\nThe maximized log-likelihood of the model, $\\ln(\\hat{L})$, is given by the multivariate normal log-probability density function evaluated at these ML estimates:\n$$ \\ln(\\hat{L}) = -\\frac{n}{2}\\ln(2\\pi) - \\frac{n}{2}\\ln(\\hat{\\sigma}^2) - \\frac{1}{2}\\ln(\\det(\\mathbf{S})) - \\frac{n}{2} $$\nWe will compute these values for both models, $\\mathcal{M}_{\\mathrm{BM}}$ (indexed by $0$) and $\\mathcal{M}_{\\mathrm{CC}}$ (indexed by $1$).\n\nModel selection is performed using the Bayesian Information Criterion (BIC), which provides an approximation to the marginal likelihood of a model, penalizing for complexity:\n$$ \\mathrm{BIC} = k \\ln(n) - 2 \\ln(\\hat{L}) $$\nwhere $k$ is the number of estimated parameters. For $\\mathcal{M}_{\\mathrm{BM}}$, we estimate $\\beta_0$ and $\\sigma^2$, so $k_0 = 2$. For $\\mathcal{M}_{\\mathrm{CC}}$, we estimate $\\beta_0$, $\\beta_1$, and $\\sigma^2$, so $k_1 = 3$.\n\nThe BIC values are used to approximate the Bayes Factor $\\mathrm{BF}_{10}$, which compares the evidence for model $\\mathcal{M}_{\\mathrm{CC}}$ against $\\mathcal{M}_{\\mathrm{BM}}$:\n$$ \\mathrm{BF}_{10} \\approx \\exp\\left(\\frac{\\mathrm{BIC}_{0} - \\mathrm{BIC}_{1}}{2}\\right) $$\nA value of $\\mathrm{BF}_{10} > 1$ indicates that the data provide more evidence for $\\mathcal{M}_{\\mathrm{CC}}$ than for $\\mathcal{M}_{\\mathrm{BM}}$.\n\nFinally, assuming equal prior probabilities for the two models, i.e., $\\Pr(\\mathcal{M}_{\\mathrm{BM}}) = \\Pr(\\mathcal{M}_{\\mathrm{CC}}) = 0.5$, the posterior probability of the simpler model, $\\mathcal{M}_{\\mathrm{BM}}$, is calculated as:\n$$ \\Pr(\\mathcal{M}_{\\mathrm{BM}} \\mid \\text{data}) = \\frac{\\Pr(\\text{data} \\mid \\mathcal{M}_{\\mathrm{BM}})}{\\Pr(\\text{data} \\mid \\mathcal{M}_{\\mathrm{BM}}) + \\Pr(\\text{data} \\mid \\mathcal{M}_{\\mathrm{CC}})} = \\frac{1}{1 + \\frac{\\Pr(\\text{data} \\mid \\mathcal{M}_{\\mathrm{CC}})}{\\Pr(\\text{data} \\mid \\mathcal{M}_{\\mathrm{BM}})}} = \\frac{1}{1 + \\mathrm{BF}_{10}} $$\nThe following program implements this entire procedure for each of the specified test cases. It involves constructing the necessary matrices, calculating the ML parameters and log-likelihood for each model, computing the BIC values, and finally deriving the posterior probability of model $\\mathcal{M}_{\\mathrm{BM}}$.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the posterior probability of a Brownian Motion model of trait evolution\n    compared to a constrained convergence model using PGLS and BIC-approximated Bayes Factors.\n    \"\"\"\n\n    def compute_bic(y_vec, S, X, k):\n        \"\"\"\n        Computes the Bayesian Information Criterion for a PGLS model.\n        \n        Args:\n            y_vec (np.ndarray): The n x 1 trait vector.\n            S (np.ndarray): The n x n phylogenetic shared-time matrix.\n            X (np.ndarray): The n x p design matrix.\n            k (int): The number of free parameters in the model.\n            \n        Returns:\n            float: The BIC value for the model.\n        \"\"\"\n        n = y_vec.shape[0]\n        try:\n            # Perform PGLS parameter estimation using numerically stable np.linalg.solve\n            S_inv = np.linalg.inv(S)\n            Xt_Sinv_X = X.T @ S_inv @ X\n            Xt_Sinv_y = X.T @ S_inv @ y_vec\n            beta_hat = np.linalg.solve(Xt_Sinv_X, Xt_Sinv_y)\n\n            # Compute the ML estimate of the variance parameter\n            residuals = y_vec - X @ beta_hat\n            sigma2_hat = (residuals.T @ S_inv @ residuals) / n\n            sigma2_hat_val = sigma2_hat.item()\n\n            if sigma2_hat_val <= 0:\n                # A non-positive variance estimate implies model pathologies.\n                # Return a large BIC to heavily penalize such a fit.\n                return np.inf\n\n            # Compute the maximized log-likelihood using the derived ML parameters\n            _sign, log_det_S = np.linalg.slogdet(S)\n            log_L_hat = -n/2 * np.log(2 * np.pi) - n/2 * np.log(sigma2_hat_val) - 0.5 * log_det_S - n/2\n\n            # Compute and return the BIC\n            bic = k * np.log(n) - 2 * log_L_hat\n            return bic\n        except np.linalg.LinAlgError:\n            # This occurs if a matrix is singular, indicating a failure to fit the model.\n            return np.inf\n\n    def analyze_case(y, g, S):\n        \"\"\"\n        Analyzes a single test case to compute the posterior probability of the BM model.\n        \n        Args:\n            y (np.ndarray): 1D array of trait values.\n            g (np.ndarray): 1D array of succulent indicators.\n            S (np.ndarray): The phylogenetic shared-time matrix.\n            \n        Returns:\n            float: The posterior probability of the BM model.\n        \"\"\"\n        n = len(y)\n        y_vec = y.reshape(-1, 1)\n        g_vec = g.reshape(-1, 1)\n\n        # Model M_BM (Brownian Motion)\n        X_bm = np.ones((n, 1))\n        # k_bm = 2 parameters: beta_0, sigma^2\n        k_bm = 2\n        bic_bm = compute_bic(y_vec, S, X_bm, k_bm)\n\n        # Model M_CC (Constrained Convergence)\n        X_cc = np.hstack([np.ones((n, 1)), g_vec])\n        # k_cc = 3 parameters: beta_0, beta_1, sigma^2\n        k_cc = 3\n        bic_cc = compute_bic(y_vec, S, X_cc, k_cc)\n\n        if np.isinf(bic_bm) or np.isinf(bic_cc):\n            if np.isinf(bic_bm) and not np.isinf(bic_cc):\n                return 0.0\n            elif not np.isinf(bic_bm) and np.isinf(bic_cc):\n                return 1.0\n            else: # Both failed, result is undefined\n                return np.nan\n\n        # Calculate Bayes Factor BF_10 (M_CC vs M_BM) from BIC values\n        # BF_10 = exp((BIC_0 - BIC_1) / 2)\n        bf_10 = np.exp((bic_bm - bic_cc) / 2.0)\n\n        # Calculate posterior probability of M_BM assuming equal priors\n        prob_bm = 1.0 / (1.0 + bf_10)\n\n        return prob_bm\n\n    # Define test cases from the problem statement\n    # Case A: Strong convergent signal\n    y_A = np.array([0.9, 3.1, 1.2, 0.8, 1.1, 1.0, 2.9, 1.2])\n    g_A = np.array([0, 1, 0, 0, 0, 0, 1, 0])\n    S_A = np.array([\n        [1.0, 0.7, 0.4, 0.4, 0.0, 0.0, 0.0, 0.0],\n        [0.7, 1.0, 0.4, 0.4, 0.0, 0.0, 0.0, 0.0],\n        [0.4, 0.4, 1.0, 0.7, 0.0, 0.0, 0.0, 0.0],\n        [0.4, 0.4, 0.7, 1.0, 0.0, 0.0, 0.0, 0.0],\n        [0.0, 0.0, 0.0, 0.0, 1.0, 0.7, 0.4, 0.4],\n        [0.0, 0.0, 0.0, 0.0, 0.7, 1.0, 0.4, 0.4],\n        [0.0, 0.0, 0.0, 0.0, 0.4, 0.4, 1.0, 0.7],\n        [0.0, 0.0, 0.0, 0.0, 0.4, 0.4, 0.7, 1.0]\n    ])\n\n    # Case B: Data consistent with BM drift\n    y_B = np.array([1.1, 1.0, 0.95, 1.05, 1.2, 0.9, 1.05, 1.1])\n    g_B = g_A\n    S_B = S_A\n\n    # Case C: Small tree, strong signal\n    y_C = np.array([1.0, 2.6, 2.4, 0.9])\n    g_C = np.array([0, 1, 1, 0])\n    S_C = np.array([\n        [1.0, 0.8, 0.0, 0.0],\n        [0.8, 1.0, 0.0, 0.0],\n        [0.0, 0.0, 1.0, 0.8],\n        [0.0, 0.0, 0.8, 1.0]\n    ])\n\n    test_cases = [\n        (y_A, g_A, S_A),\n        (y_B, g_B, S_B),\n        (y_C, g_C, S_C)\n    ]\n\n    results = []\n    for y, g, S in test_cases:\n        result = analyze_case(y, g, S)\n        # Format the result to six decimal places, as per rounding requirement\n        formatted_result = \"{:.6f}\".format(result)\n        results.append(formatted_result)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2706067"}]}