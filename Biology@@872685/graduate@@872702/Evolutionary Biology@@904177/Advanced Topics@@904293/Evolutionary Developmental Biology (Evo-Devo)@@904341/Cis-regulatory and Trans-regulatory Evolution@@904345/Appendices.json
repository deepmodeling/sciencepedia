{"hands_on_practices": [{"introduction": "This practice forms the bedrock of analyzing regulatory evolution. By leveraging a classic F1 hybrid experimental design, you will learn to quantitatively partition the divergence in a gene's expression level into its distinct `cis` and `trans`-regulatory components. This exercise emphasizes first-principles thinking, guiding you through the essential steps of handling real-world complexities like library size normalization and sequencing mapping bias [@problem_id:2696998].", "problem": "You are studying a single gene in two diverged haploid strains, denoted strain $P$ and strain $Q$. Messenger Ribonucleic Acid (mRNA) abundance is quantified by Ribonucleic Acid sequencing (RNA-seq) in $P$ and $Q$ (with replicate libraries and known library sizes), allele-specific expression (ASE) is measured in first filial generation (F1) hybrids, and a heterozygous genomic Deoxyribonucleic Acid (gDNA) control is used to quantify mapping bias. Assume the following foundational modeling principles.\n\n- Central Dogma and expression measurement: RNA-seq read counts for a given gene are proportional to underlying mRNA abundance, modulated by library size. Between-replicate stochasticity in measured abundance on the logarithmic scale is well approximated by a homoscedastic log-normal model across strains for this gene.\n\n- Cis versus trans effects: Let $E_{P}$ and $E_{Q}$ be the mean mRNA abundances of the gene in strains $P$ and $Q$ grown in the same environment. On the natural logarithm scale, assume an additive model $\\ln(E_{P}) - \\ln(E_{Q}) = \\gamma + \\tau$, where $\\gamma$ is the cis-regulatory log-effect (allele-specific, shared trans environment) and $\\tau$ is the trans-regulatory log-effect (background-specific, shared across alleles).\n\n- F1 hybrid logic for ASE: In an F1 hybrid where both alleles experience the same trans environment, the log ratio of allele-specific abundances equals $\\gamma$. Due to sequence mapping bias, observed ASE read counts are distorted by an unknown multiplicative mapping bias factor $b$ favoring one allele, so that the expected odds of reads mapping to the $P$ allele versus the $Q$ allele are multiplied by $b$.\n\n- Likelihood assumptions: For parental samples, the log-normal model implies that the maximum likelihood estimate (MLE) of $\\ln(E_{P}/E_{Q})$ equals the difference between the mean logarithms of library-size-normalized counts across replicates in $P$ and $Q$. For ASE in the F1, treating mapped allele counts as binomially sampled reads with odds proportional to true allele-specific abundance times mapping bias, the MLE of the cis odds equals the observed allele odds divided by $b$. The gDNA control (equal underlying allele copy number) provides an MLE of $b$ as the observed gDNA allele odds.\n\nData for this gene:\n- Parental RNA-seq for $P$: replicate counts $(y_{P,1},y_{P,2},y_{P,3}) = (120, 150, 90)$ with corresponding library sizes $(L_{P,1},L_{P,2},L_{P,3}) = (10 \\times 10^{6}, 12 \\times 10^{6}, 8 \\times 10^{6})$ total mapped reads.\n- Parental RNA-seq for $Q$: replicate counts $(y_{Q,1},y_{Q,2},y_{Q,3}) = (60, 70, 65)$ with corresponding library sizes $(L_{Q,1},L_{Q,2},L_{Q,3}) = (11 \\times 10^{6}, 9 \\times 10^{6}, 10 \\times 10^{6})$ total mapped reads.\n- F1 hybrid ASE counts for this gene: reads assigned to allele $P$ equal $260$, to allele $Q$ equal $140$.\n- Heterozygous gDNA control for this locus: reads assigned to allele $P$ equal $5200$, to allele $Q$ equal $4800$.\n\nUsing only the modeling assumptions above and first-principles likelihood reasoning, compute the maximum likelihood estimate of the trans-regulatory log-effect $\\tau$ (natural logarithm base), defined by $\\ln(E_{P}/E_{Q}) = \\gamma + \\tau$. Express your final answer as a single real number. Round your final answer to four significant figures.", "solution": "The problem is valid. It is scientifically grounded in the principles of evolutionary and functional genomics, specifically the decomposition of gene expression divergence into cis- and trans-regulatory components. The problem provides a clear, self-contained set of assumptions, data, and definitions, allowing for a unique solution to be derived through logical and mathematical reasoning.\n\nThe objective is to compute the maximum likelihood estimate (MLE) of the trans-regulatory log-effect, denoted as $\\tau$. The fundamental model provided is an additive decomposition on the natural logarithm scale:\n$$ \\ln(E_{P}) - \\ln(E_{Q}) = \\gamma + \\tau $$\nwhere $E_{P}$ and $E_{Q}$ are the mean mRNA abundances in strains $P$ and $Q$, $\\gamma$ is the cis-regulatory log-effect, and $\\tau$ is the trans-regulatory log-effect.\n\nBy the invariance property of maximum likelihood estimators, the MLE for $\\tau$, denoted $\\hat{\\tau}$, is given by:\n$$ \\hat{\\tau} = \\widehat{\\ln(E_{P}/E_{Q})} - \\hat{\\gamma} $$\nThis requires us to first compute the MLE for the total expression log-ratio, $\\widehat{\\ln(E_{P}/E_{Q})}$, and the MLE for the cis-regulatory log-effect, $\\hat{\\gamma}$.\n\nStep 1: Estimate the total expression log-ratio, $\\widehat{\\ln(E_{P}/E_{Q})}$.\nThe problem states that the MLE of $\\ln(E_{P}/E_{Q})$ is the difference between the mean logarithms of library-size-normalized counts. Let $y_{S,i}$ be the read count and $L_{S,i}$ be the library size for replicate $i$ of strain $S \\in \\{P, Q\\}$. The library-size-normalized expression for a given replicate is $n_{S,i} = y_{S,i} / L_{S,i}$.\nThe MLE is then:\n$$ \\widehat{\\ln(E_{P}/E_{Q})} = \\frac{1}{3} \\sum_{i=1}^{3} \\ln(n_{P,i}) - \\frac{1}{3} \\sum_{i=1}^{3} \\ln(n_{Q,i}) = \\frac{1}{3} \\ln \\left( \\frac{\\prod_{i=1}^{3} n_{P,i}}{\\prod_{i=1}^{3} n_{Q,i}} \\right) $$\nThe data for strain $P$ are counts $(y_{P,1}, y_{P,2}, y_{P,3}) = (120, 150, 90)$ and library sizes $(L_{P,1}, L_{P,2}, L_{P,3}) = (10 \\times 10^{6}, 12 \\times 10^{6}, 8 \\times 10^{6})$.\nThe data for strain $Q$ are counts $(y_{Q,1}, y_{Q,2}, y_{Q,3}) = (60, 70, 65)$ and library sizes $(L_{Q,1}, L_{Q,2}, L_{Q,3}) = (11 \\times 10^{6}, 9 \\times 10^{6}, 10 \\times 10^{6})$.\nThe ratio of the products of normalized counts can be computed noting that the scaling factor of $(10^6)^3$ in the denominator of both products will cancel out:\n$$ \\frac{\\prod n_{P,i}}{\\prod n_{Q,i}} = \\frac{ (120/10) \\cdot (150/12) \\cdot (90/8) }{ (60/11) \\cdot (70/9) \\cdot (65/10) } = \\frac{1687.5}{27300/99} = \\frac{167062.5}{27300} = \\frac{4455}{728} $$\nTherefore, the MLE for the total expression log-ratio is:\n$$ \\widehat{\\ln(E_{P}/E_{Q})} = \\frac{1}{3} \\ln\\left(\\frac{4455}{728}\\right) $$\n\nStep 2: Estimate the cis-regulatory log-effect, $\\hat{\\gamma}$.\nThe cis-effect $\\gamma$ is the log-ratio of allele-specific abundances in the F1 hybrid. Observed allele-specific read counts are biased by a factor $b$. The problem states that the MLE of the true cis-odds, $\\exp(\\gamma)$, is the observed allele odds from ASE divided by the MLE of the bias, $\\hat{b}$.\nFirst, we estimate $\\hat{b}$ from the heterozygous gDNA control. In gDNA, the true allele copy number ratio is $1:1$. The model implies that $\\hat{b}$ is equal to the observed gDNA allele odds.\nGiven gDNA counts for alleles $P$ and $Q$ are $N_{P,gDNA} = 5200$ and $N_{Q,gDNA} = 4800$:\n$$ \\hat{b} = \\frac{N_{P,gDNA}}{N_{Q,gDNA}} = \\frac{5200}{4800} = \\frac{52}{48} = \\frac{13}{12} $$\nNext, we use the F1 hybrid ASE counts: $N_{P,ASE} = 260$ and $N_{Q,ASE} = 140$. The observed ASE odds are:\n$$ \\frac{N_{P,ASE}}{N_{Q,ASE}} = \\frac{260}{140} = \\frac{13}{7} $$\nThe MLE of the cis-odds is then:\n$$ \\exp(\\hat{\\gamma}) = \\frac{N_{P,ASE}/N_{Q,ASE}}{\\hat{b}} = \\frac{13/7}{13/12} = \\frac{13}{7} \\times \\frac{12}{13} = \\frac{12}{7} $$\nTaking the natural logarithm gives the MLE for the cis-regulatory log-effect:\n$$ \\hat{\\gamma} = \\ln\\left(\\frac{12}{7}\\right) $$\n\nStep 3: Estimate the trans-regulatory log-effect, $\\hat{\\tau}$.\nWe now substitute the estimates for the total and cis-regulatory effects into the main equation:\n$$ \\hat{\\tau} = \\widehat{\\ln(E_{P}/E_{Q})} - \\hat{\\gamma} = \\frac{1}{3} \\ln\\left(\\frac{4455}{728}\\right) - \\ln\\left(\\frac{12}{7}\\right) $$\nTo find the numerical value, we compute the terms:\n$$ \\widehat{\\ln(E_{P}/E_{Q})} = \\frac{1}{3} \\ln\\left(\\frac{4455}{728}\\right) \\approx \\frac{1}{3} \\ln(6.119505...) \\approx \\frac{1.811481...}{3} \\approx 0.6038270 $$\n$$ \\hat{\\gamma} = \\ln\\left(\\frac{12}{7}\\right) \\approx \\ln(1.714285...) \\approx 0.5389965 $$\nSubtracting these values gives:\n$$ \\hat{\\tau} \\approx 0.6038270 - 0.5389965 = 0.0648305 $$\nRounding the result to four significant figures gives $0.06483$.", "answer": "$$\\boxed{0.06483}$$", "id": "2696998"}, {"introduction": "Moving from mean effects to their variation, this practice explores how to decompose the *variance* of expression divergence. You will implement a computational model that partitions the total expression variance into contributions from `cis` effects, `trans` effects, and their covariance, a crucial step for identifying patterns like canalization or compensatory evolution. This coding exercise will solidify your understanding of the additive model of regulatory effects and its statistical power [@problem_id:2696994].", "problem": "You are given a conceptual model for gene expression in two diverged lineages and their first-filial hybrid. The goal is to design a program that computes, for each test case, a principled decomposition of the observed divergence in expression into components attributable to cis-regulatory differences, trans-regulatory differences, and their covariance, using only fundamental definitions and experimental design logic from regulatory genetics.\n\nFundamental base:\n- In the Central Dogma of molecular biology, transcriptional output is governed by the interplay between local deoxyribonucleic acid sequence features (cis-regulatory elements) and diffusible cellular factors (trans-acting regulators). For a focal gene, assume that the expression level in a given genotype-factor background factors multiplicatively into a cis contribution and a trans contribution. That is, in a parent from lineage $1$, expression is the product of a cis term characteristic of the allele carried by lineage $1$ and a trans term characteristic of the cellular environment of lineage $1$. Similarly for lineage $2$.\n- In a first-filial hybrid between lineages $1$ and $2$, both alleles experience the same trans environment, but retain their lineage-specific cis-regulatory sequences.\n- A multiplicative model of contributions can be linearized by taking natural logarithms, converting multiplicative effects into additive effects, which simplifies contrasts and variance decomposition.\n\nDefinitions to be implemented from first principles:\n- Let $P1_i$ and $P2_i$ denote replicate $i$ measurements of expression from the parent of lineage $1$ and the parent of lineage $2$, respectively.\n- Let $A1_i$ and $A2_i$ denote replicate $i$ allele-specific expression measurements in the first-filial hybrid, from the allele derived from lineage $1$ and lineage $2$, respectively. All logarithms to be used are natural logarithms.\n- For each replicate $i$, define three additive quantities on the log scale that must be derivable based on the above experimental design and fundamental base:\n  - The total between-parent log divergence $d_i$.\n  - A log-scale quantity that isolates the cis-regulatory difference $c_i$ using the fact that both alleles in the hybrid share the same trans environment.\n  - A log-scale quantity isolating the trans-regulatory difference $t_i$ using the fact that trans acts globally and that total divergence arises from both cis and trans.\n- Across replicates, compute unbiased sample variances and covariance using the standard definitions with denominator $(n-1)$, where $n$ is the number of replicates:\n  - The sample variance of $d_i$ is $\\mathrm{Var}(d)$, the sample variance of $c_i$ is $\\mathrm{Var}(c)$, the sample variance of $t_i$ is $\\mathrm{Var}(t)$, and the sample covariance is $\\mathrm{Cov}(c,t)$.\n- Use the algebra of variances for sums of random variables to express $\\mathrm{Var}(d)$ in terms of $\\mathrm{Var}(c)$, $\\mathrm{Var}(t)$, and $\\mathrm{Cov}(c,t)$, and then compute the following fractions as decimal numbers (not percentages):\n  - $f_{\\mathrm{cis}} = \\mathrm{Var}(c) / \\mathrm{Var}(d)$\n  - $f_{\\mathrm{trans}} = \\mathrm{Var}(t) / \\mathrm{Var}(d)$\n  - $f_{\\mathrm{cov}} = 2\\,\\mathrm{Cov}(c,t) / \\mathrm{Var}(d)$\nThese three fractions should sum to $1$ up to rounding error when $\\mathrm{Var}(d) > 0$.\n\nFor each test case, your program must:\n- Compute the replicate-wise quantities $d_i$, $c_i$, $t_i$ using the natural logarithm and the experimental design logic stated above.\n- Compute the sample means $\\overline{c}$ and $\\overline{t}$, the unbiased sample covariance $\\mathrm{Cov}(c,t)$, and the fractions $f_{\\mathrm{cis}}$, $f_{\\mathrm{trans}}$, $f_{\\mathrm{cov}}$ as defined above.\n- Round all returned floating-point numbers to six decimal places.\n\nAngle units are not applicable. No physical units are required.\n\nTest suite:\nEach test case is defined by four equally long lists of positive numbers, representing $P1_i$, $P2_i$, $A1_i$, $A2_i$ over replicates $i = 1,\\dots,n$. Use the natural logarithm throughout.\n\n- Test case $1$ (general case with moderate divergence):\n  - $P1 = [182.211, 181.2375, 173.115]$\n  - $P2 = [100, 90, 105]$\n  - $A1 = [179.018, 181.359, 169.415]$\n  - $A2 = [120, 110, 130]$\n\n- Test case $2$ (boundary case with essentially pure trans-regulatory divergence, no allele-specific difference in the hybrid):\n  - $P1 = [150, 160, 99]$\n  - $P2 = [100, 80, 90]$\n  - $A1 = [120, 100, 105]$\n  - $A2 = [120, 100, 105]$\n\n- Test case $3$ (boundary case with essentially pure cis-regulatory divergence, parental difference equals allele-specific divergence in the hybrid):\n  - $P1 = [117, 165, 130]$\n  - $P2 = [90, 110, 100]$\n  - $A1 = [130, 180, 195]$\n  - $A2 = [100, 120, 150]$\n\n- Test case $4$ (compensatory cis and trans with negative covariance and approximately constant total divergence):\n  - $P1 = [149.182, 164.100, 134.264]$\n  - $P2 = [100, 110, 90]$\n  - $A1 = [255.0966, 146.600, 214.333]$\n  - $A2 = [140, 120, 130]$\n\nRequired final output format:\n- Your program should produce a single line of output containing a list of length $4$, where each element corresponds to one test case in order.\n- Each element must be a list of six floating-point numbers rounded to six decimal places, in the following order: $[\\,\\overline{c},\\,\\overline{t},\\,f_{\\mathrm{cis}},\\,f_{\\mathrm{trans}},\\,f_{\\mathrm{cov}},\\,\\mathrm{Cov}(c,t)\\,]$.\n- The entire output must be printed as a single line representing a Python-like nested list using square brackets, for example: $\"[[x_{11},x_{12},\\dots,x_{16}],[x_{21},\\dots,x_{26}],\\dots]\"$, with no additional text.", "solution": "The problem requires the decomposition of gene expression divergence between two lineages into components attributable to cis- and trans-regulatory evolution. The provided conceptual model is a standard framework in evolutionary genomics, positing that gene expression is a multiplicative function of cis-acting elements and trans-acting factors. This problem is scientifically grounded and mathematically well-posed. We will proceed by first formalizing the model and then deriving the necessary quantities from first principles.\n\nThe model assumes that for a given gene, the expression level $E$ is the product of a cis-regulatory contribution, $C$, and a trans-regulatory contribution, $T$.\n$$E = C \\cdot T$$\nThis multiplicative relationship is linearized by taking the natural logarithm, which transforms the model into an additive one.\n$$\\ln(E) = \\ln(C) + \\ln(T)$$\nThis additive form is more suitable for analysis and variance decomposition. Let us denote log-transformed quantities with lowercase letters, e.g., $c = \\ln(C)$.\n\nWe are provided with expression data from four sources for each replicate $i$: parent of lineage $1$ ($P1_i$), parent of lineage $2$ ($P2_i$), allele from lineage $1$ in the F1 hybrid ($A1_i$), and allele from lineage $2$ in the F1 hybrid ($A2_i$). We can map these experimental measurements to the log-additive model. Let $c_1$ and $c_2$ be the cis-regulatory effects of alleles from lineages $1$ and $2$, respectively. Let $t_1$ and $t_2$ be the trans-regulatory environments of the parent lineages $1$ and $2$, and let $h$ be the common trans-regulatory environment in the F1 hybrid. For a given replicate $i$, we can write:\n$$ \\ln(P1_i) = c_{1,i} + t_{1,i} $$\n$$ \\ln(P2_i) = c_{2,i} + t_{2,i} $$\n$$ \\ln(A1_i) = c_{1,i} + h_i $$\n$$ \\ln(A2_i) = c_{2,i} + h_i $$\nThe subscript $i$ indicates that each replicate measurement has its own realization of these underlying effects, accounting for biological and technical variability.\n\nThe problem requires the computation of three quantities for each replicate $i$: total divergence $d_i$, cis-regulatory divergence $c_i$, and trans-regulatory divergence $t_i$.\n\n$1$. The total log-divergence between parents, $d_i$, is defined as the difference in their log-expression levels.\n$$ d_i = \\ln(P1_i) - \\ln(P2_i) = (c_{1,i} - c_{2,i}) + (t_{1,i} - t_{2,i}) $$\nThis quantity represents the total divergence accumulated between the two lineages, comprising both cis and trans effects.\n\n$2$. The cis-regulatory divergence, $c_i$, is isolated by comparing the expression of the two different alleles ($A1_i$ and $A2_i$) within the same hybrid trans-environment ($h_i$). Any difference must be due to cis-regulatory sequences.\n$$ c_i = \\ln(A1_i) - \\ln(A2_i) = (c_{1,i} + h_i) - (c_{2,i} + h_i) = c_{1,i} - c_{2,i} $$\nThis expression correctly isolates the difference between the cis-regulatory effects of the two alleles.\n\n$3$. The trans-regulatory divergence, $t_i$, is the portion of the total divergence not explained by cis-effects. Given the additive nature of the log-transformed model, where $d_i$ is the sum of total cis and trans divergences, we have $d_i = c_i + t_i$. Therefore, we can find $t_i$ by subtraction:\n$$ t_i = d_i - c_i = (\\ln(P1_i) - \\ln(P2_i)) - (\\ln(A1_i) - \\ln(A2_i)) $$\nSubstituting the model components confirms that this isolates the divergence in trans-environments.\n$$ t_i = \\left( (c_{1,i} - c_{2,i}) + (t_{1,i} - t_{2,i}) \\right) - (c_{1,i} - c_{2,i}) = t_{1,i} - t_{2,i} $$\n\nWith the replicate-wise vectors $\\{c_i\\}$ and $\\{t_i\\}$ for $i=1, \\dots, n$ computed, we proceed to the statistical analysis. We compute the sample means $\\overline{c}$ and $\\overline{t}$, and the unbiased sample variances and covariance using the denominator $(n-1)$:\n$$ \\overline{c} = \\frac{1}{n} \\sum_{i=1}^{n} c_i \\quad\\quad \\overline{t} = \\frac{1}{n} \\sum_{i=1}^{n} t_i $$\n$$ \\mathrm{Var}(c) = \\frac{1}{n-1} \\sum_{i=1}^{n} (c_i - \\overline{c})^2 $$\n$$ \\mathrm{Var}(t) = \\frac{1}{n-1} \\sum_{i=1}^{n} (t_i - \\overline{t})^2 $$\n$$ \\mathrm{Cov}(c,t) = \\frac{1}{n-1} \\sum_{i=1}^{n} (c_i - \\overline{c})(t_i - \\overline{t}) $$\nThe variance of the total divergence, $\\mathrm{Var}(d)$, is also required. Since $d_i = c_i + t_i$, from the properties of variance we have:\n$$ \\mathrm{Var}(d) = \\mathrm{Var}(c+t) = \\mathrm{Var}(c) + \\mathrm{Var}(t) + 2\\mathrm{Cov}(c,t) $$\nThe final step is to decompose this total variance into fractional contributions from cis-divergence, trans-divergence, and their covariance. The fractions are defined as:\n$$ f_{\\mathrm{cis}} = \\frac{\\mathrm{Var}(c)}{\\mathrm{Var}(d)} $$\n$$ f_{\\mathrm{trans}} = \\frac{\\mathrm{Var}(t)}{\\mathrm{Var}(d)} $$\n$$ f_{\\mathrm{cov}} = \\frac{2\\mathrm{Cov}(c,t)}{\\mathrm{Var}(d)} $$\nBy definition, these fractions must sum to $1$. The algorithm will compute these quantities for each test case provided. The implementation will use `numpy` for vectorized calculations of logarithms, differences, means, variances, and covariances, ensuring adherence to the specified statistical definitions (e.g., using a delta degree of freedom of $1$ for unbiased sample estimates). All final floating-point results will be rounded to six decimal places as required.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the decomposition of gene expression divergence into cis, trans,\n    and covariance components for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (\n            [182.211, 181.2375, 173.115], # P1\n            [100, 90, 105], # P2\n            [179.018, 181.359, 169.415], # A1\n            [120, 110, 130], # A2\n        ),\n        (\n            [150, 160, 99], # P1\n            [100, 80, 90], # P2\n            [120, 100, 105], # A1\n            [120, 100, 105], # A2\n        ),\n        (\n            [117, 165, 130], # P1\n            [90, 110, 100], # P2\n            [130, 180, 195], # A1\n            [100, 120, 150], # A2\n        ),\n        (\n            [149.182, 164.100, 134.264], # P1\n            [100, 110, 90], # P2\n            [255.0966, 146.600, 214.333], # A1\n            [140, 120, 130], # A2\n        ),\n    ]\n\n    all_results = []\n    for P1, P2, A1, A2 in test_cases:\n        # Convert lists to numpy arrays for vectorized operations.\n        P1_arr = np.array(P1, dtype=np.float64)\n        P2_arr = np.array(P2, dtype=np.float64)\n        A1_arr = np.array(A1, dtype=np.float64)\n        A2_arr = np.array(A2, dtype=np.float64)\n\n        # Take natural logarithms.\n        log_P1 = np.log(P1_arr)\n        log_P2 = np.log(P2_arr)\n        log_A1 = np.log(A1_arr)\n        log_A2 = np.log(A2_arr)\n\n        # Compute replicate-wise quantities d, c, and t.\n        # d: total log-divergence between parents.\n        # c: cis-regulatory log-divergence from allele-specific expression in hybrid.\n        # t: trans-regulatory log-divergence derived from the additive model.\n        d = log_P1 - log_P2\n        c = log_A1 - log_A2\n        t = d - c\n\n        # Compute sample means.\n        mean_c = np.mean(c)\n        mean_t = np.mean(t)\n        \n        # Compute unbiased sample variances (ddof=1 for n-1 denominator).\n        # Check for case with n=1, where variance is not defined.\n        n = len(P1)\n        if n  2:\n            # According to problem constraints (n=3), this block is not reached.\n            # Define behavior for this edge case if necessary.\n            # Here we can set variances to 0, which would lead to NaN for fractions.\n            var_d = 0.0\n            var_c = 0.0\n            var_t = 0.0\n            cov_ct = 0.0\n        else:\n            var_d = np.var(d, ddof=1)\n            var_c = np.var(c, ddof=1)\n            var_t = np.var(t, ddof=1)\n            # Compute unbiased sample covariance matrix.\n            cov_matrix = np.cov(c, t, ddof=1)\n            cov_ct = cov_matrix[0, 1]\n\n        # Calculate fractional contributions to variance.\n        # Handle division by zero if Var(d) is zero.\n        if var_d == 0.0:\n            # If total divergence is constant, fractions are not well-defined.\n            # This indicates either no variation or perfect compensation.\n            # Depending on context, interpretation varies. In this problem,\n            # test cases are designed to have Var(d) > 0.\n            f_cis, f_trans, f_cov = np.nan, np.nan, np.nan\n        else:\n            f_cis = var_c / var_d\n            f_trans = var_t / var_d\n            f_cov = 2 * cov_ct / var_d\n\n        # Assemble the list of results for the current test case.\n        result = [mean_c, mean_t, f_cis, f_trans, f_cov, cov_ct]\n        \n        # Round all values to six decimal places.\n        rounded_result = [round(x, 6) for x in result]\n        all_results.append(rounded_result)\n\n    # Final print statement in the exact required format.\n    # The str() representation of a list includes spaces after commas.\n    # The requirement seems to want no spaces, so we remove them.\n    # Example: \"[[v1,v2],[v3,v4]]\"\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "2696994"}, {"introduction": "Why do `cis` and `trans` effects evolve in the first place? This practice takes you from measurement to mechanism by building a theoretical model based on evolutionary first principles. By formalizing the concepts of stabilizing selection on gene expression and pleiotropic costs, you will derive how a `cis`-regulatory element is expected to evolve in response to a given `trans`-acting cellular environment, providing a fitness-based explanation for phenomena like compensatory evolution [@problem_id:2697006].", "problem": "Consider a single diploid gene whose messenger ribonucleic acid (mRNA) expression deviation from its lineage-specific optimum is additively determined by a cis-acting component and a trans-acting component. Let the deviation of expression from the optimum be denoted by $E - E^{*}$, where $E^{*}$ is the optimal expression level for viability. In each lineage $i \\in \\{1,2\\}$, let the trans-acting background shift expression by $t_{i}$ (a constant for that lineage due to constraints from its effects on many other genes), and let the evolvable cis-acting modification at the focal gene be $c_{i}$. Assume the following widely used structure for fitness:\n- Stabilizing selection on expression around the optimum is Gaussian with curvature $S0$, so the expression-related component of fitness is $\\exp\\!\\big(-\\tfrac{S}{2}(E-E^{*})^{2}\\big)$.\n- Cis-regulatory changes incur pleiotropic costs that scale quadratically with their magnitude with coefficient $\\alpha0$, contributing a multiplicative factor $\\exp\\!\\big(-\\tfrac{\\alpha}{2}c_{i}^{2}\\big)$.\n- Trans-regulatory backgrounds incur pleiotropic costs that scale quadratically with their magnitude with coefficient $\\gamma0$, contributing a multiplicative factor $\\exp\\!\\big(-\\tfrac{\\gamma}{2}t_{i}^{2}\\big)$; however, $t_{i}$ is externally constrained in lineage $i$ by selection on other genes (i.e., when optimizing $c_{i}$ within lineage $i$, treat $t_{i}$ as constant).\n\nWithin each lineage $i$, expression deviation is $E-E^{*}=c_{i}+t_{i}$, and total fitness for the focal gene and pleiotropic penalties is the product of the three factors above.\n\nNow consider a cross between the two lineages to form a first filial generation (F1) hybrid. In the F1, assume:\n- The trans-acting environment is codominant and additive, yielding a hybrid trans effect of $(t_{1}+t_{2})/2$.\n- Each allele retains its own cis-regulatory sequence, and allelic contributions to total expression are equal in dosage, so the cis contribution to the hybrid’s total expression is the average $(c_{1}+c_{2})/2$.\n\nAssuming that in each parental lineage $i$ the cis modifier $c_{i}$ has evolved to maximize total fitness given $t_{i}$, derive a closed-form expression, in terms of $S$, $\\alpha$, $t_{1}$, and $t_{2}$ only, for the deviation of the F1 hybrid’s mean expression from the optimum, $(E_{\\mathrm{F1}}-E^{*})$. Provide your final answer as a single simplified analytic expression with no units.", "solution": "The problem statement presented is scientifically grounded, well-posed, and internally consistent. It describes a standard theoretical model in evolutionary genetics concerning the balance of selective forces on gene expression. We shall proceed with its formal solution.\n\nThe total fitness, $W_i$, for a diploid individual in lineage $i \\in \\{1, 2\\}$ is given as the product of three components: stabilizing selection on expression level, pleiotropic costs of cis-regulation, and pleiotropic costs of the trans-regulatory background. It is expressed as:\n$$\nW_i(c_i) = \\exp\\left(-\\frac{S}{2}(E-E^{*})^{2}\\right) \\exp\\left(-\\frac{\\alpha}{2}c_{i}^{2}\\right) \\exp\\left(-\\frac{\\gamma}{2}t_{i}^{2}\\right)\n$$\nwhere $c_i$ is the cis-acting modification and $t_i$ is the trans-acting background effect. The deviation from optimal expression is given by the additive model $E-E^{*} = c_i + t_i$. Substituting this into the fitness function yields:\n$$\nW_i(c_i) = \\exp\\left(-\\frac{S}{2}(c_i + t_i)^{2} - \\frac{\\alpha}{2}c_{i}^{2} - \\frac{\\gamma}{2}t_{i}^{2}\\right)\n$$\nTo find the value of $c_i$ that maximizes fitness, we can equivalently maximize the log-fitness, $w_i(c_i) = \\ln(W_i(c_i))$, as the logarithm is a strictly monotonic function.\n$$\nw_i(c_i) = -\\frac{S}{2}(c_i + t_i)^{2} - \\frac{\\alpha}{2}c_{i}^{2} - \\frac{\\gamma}{2}t_{i}^{2}\n$$\nThe problem states that $c_i$ evolves to maximize fitness for a given, constant $t_i$. Therefore, we find the maximum of $w_i(c_i)$ by taking its derivative with respect to $c_i$ and setting it to zero. The term involving $\\gamma$ is constant with respect to $c_i$ and thus does not influence the optimization.\n$$\n\\frac{d w_i}{d c_i} = \\frac{d}{d c_i} \\left( -\\frac{S}{2}(c_i + t_i)^{2} - \\frac{\\alpha}{2}c_{i}^{2} \\right) = -S(c_i + t_i) - \\alpha c_i\n$$\nSetting the derivative to zero defines the optimal cis-acting modification, which we denote $c_i^*$:\n$$\n-S(c_i^* + t_i) - \\alpha c_i^* = 0\n$$\n$$\n-S t_i = S c_i^* + \\alpha c_i^*\n$$\n$$\n-S t_i = (S + \\alpha) c_i^*\n$$\nSolving for $c_i^*$ gives:\n$$\nc_i^* = -\\frac{S}{S + \\alpha} t_i\n$$\nThis result is a maximum because the second derivative, $\\frac{d^2 w_i}{d c_i^2} = -S - \\alpha$, is strictly negative for the given conditions $S > 0$ and $\\alpha > 0$. This expression for the optimal cis-effect applies to both parental lineages, $i=1$ and $i=2$. Thus, we have:\n$$\nc_1^* = -\\frac{S}{S + \\alpha} t_1 \\quad \\text{and} \\quad c_2^* = -\\frac{S}{S + \\alpha} t_2\n$$\nNext, we consider the first filial generation (F1) hybrid. The problem specifies that the trans-acting environment is additive, resulting in a hybrid trans-effect of $t_{\\mathrm{F1}} = \\frac{t_1 + t_2}{2}$. Similarly, the cis-contribution to total expression is the average of the parental alleles, $c_{\\mathrm{F1}} = \\frac{c_1 + c_2}{2}$. The total expression deviation from the optimum in the F1 hybrid is the sum of these effects:\n$$\nE_{\\mathrm{F1}}-E^{*} = c_{\\mathrm{F1}} + t_{\\mathrm{F1}} = \\frac{c_1 + c_2}{2} + \\frac{t_1 + t_2}{2}\n$$\nWe must use the optimal values $c_1^*$ and $c_2^*$ for the parental cis-effects, as the problem assumes the parental lineages have evolved to their respective fitness maxima. Substituting the expressions for $c_1^*$ and $c_2^*$:\n$$\nE_{\\mathrm{F1}}-E^{*} = \\frac{1}{2}\\left(-\\frac{S}{S + \\alpha} t_1 - \\frac{S}{S + \\alpha} t_2\\right) + \\frac{t_1 + t_2}{2}\n$$\nWe can factor out common terms:\n$$\nE_{\\mathrm{F1}}-E^{*} = -\\frac{S}{2(S + \\alpha)}(t_1 + t_2) + \\frac{1}{2}(t_1 + t_2)\n$$\n$$\nE_{\\mathrm{F1}}-E^{*} = \\left(1 - \\frac{S}{S + \\alpha}\\right)\\left(\\frac{t_1 + t_2}{2}\\right)\n$$\nSimplifying the expression in the first parenthesis:\n$$\n1 - \\frac{S}{S + \\alpha} = \\frac{S + \\alpha}{S + \\alpha} - \\frac{S}{S + \\alpha} = \\frac{S + \\alpha - S}{S + \\alpha} = \\frac{\\alpha}{S + \\alpha}\n$$\nSubstituting this simplified term back into the equation for the F1 expression deviation gives the final result:\n$$\nE_{\\mathrm{F1}}-E^{*} = \\left(\\frac{\\alpha}{S + \\alpha}\\right)\\left(\\frac{t_1 + t_2}{2}\\right) = \\frac{\\alpha(t_1 + t_2)}{2(S + \\alpha)}\n$$\nThis expression is in terms of the required parameters $S$, $\\alpha$, $t_1$, and $t_2$ only.", "answer": "$$\n\\boxed{\\frac{\\alpha(t_1 + t_2)}{2(S + \\alpha)}}\n$$", "id": "2697006"}]}