{"hands_on_practices": [{"introduction": "This first practice establishes the cornerstone of virulence evolution: the trade-off hypothesis. We will model a scenario where increased virulence, while shortening the infectious period, also impacts host behavior by reducing contact rates due to illness. Your task is to mathematically formalize this trade-off by deriving the selection gradient on virulence, a key tool from adaptive dynamics for predicting the direction of evolution [@problem_id:2710055]. This exercise will sharpen your ability to translate biological assumptions into a quantitative fitness landscape.", "problem": "Consider an acute, directly transmitted pathogen in a closed host population on the short outbreak timescale (ignore host births and natural deaths). The pathogen’s virulence, denoted by $\\alpha$, increases symptom severity and induces bedrest that reduces the per-capita contact rate to a differentiable function $c(\\alpha)$ with $c'(\\alpha)  0$. Assume the per-contact transmission probability is a constant $p$ that is independent of $\\alpha$. Infected hosts recover at rate $\\gamma$ and are removed by disease-induced mortality at rate $\\alpha$, so the total per-capita removal rate is $\\gamma + \\alpha$. Let $S(t)$, $I(t)$, and $R(t)$ denote the numbers of susceptible, infected, and recovered hosts, respectively, and let $N = S(t) + I(t) + R(t)$ be the constant population size. Assume frequency-dependent (standard incidence) transmission on the invasion timescale so that the force of infection is $\\lambda(t) = \\frac{c(\\alpha) p}{N} I(t)$.\n\nThe epidemic dynamics are given by\n$$\n\\frac{dS}{dt} = - \\frac{c(\\alpha) p}{N} S I, \\quad\n\\frac{dI}{dt} = \\frac{c(\\alpha) p}{N} S I - (\\gamma + \\alpha) I, \\quad\n\\frac{dR}{dt} = \\gamma I.\n$$\n\nStarting from the definitions of the basic reproduction number and invasion fitness in a fully susceptible host population (that is, at the disease-free state with $S \\approx N$), derive a selection gradient for $\\alpha$ defined as the derivative of the natural logarithm of the basic reproduction number with respect to $\\alpha$. Your derivation must explicitly show how symptom-induced bedrest enters via $c(\\alpha)$ and how removal occurs via $\\gamma + \\alpha$. Provide your final result as a single closed-form analytical expression $g(\\alpha)$ in terms of $c(\\alpha)$, $c'(\\alpha)$, $\\gamma$, and $\\alpha$. Do not introduce any additional parameters beyond those defined here. The final answer must be the expression for $g(\\alpha)$ only, with no words or units.", "solution": "The problem requires the derivation of the selection gradient, $g(\\alpha)$, for the pathogen's virulence, $\\alpha$. The selection gradient is defined as the derivative of the natural logarithm of the pathogen's invasion fitness with respect to the trait $\\alpha$. On the short timescale of an epidemic invasion into a fully susceptible population, the appropriate measure of fitness is the basic reproduction number, $R_0$.\n\nFirst, we must derive an expression for the basic reproduction number, $R_0(\\alpha)$, as a function of virulence. $R_0$ is defined as the expected number of secondary infections produced by a single infectious individual introduced into a completely susceptible population. It is the product of three quantities: the rate at which an infected individual makes effective (transmission-causing) contacts, the number of susceptible individuals per contact, and the average duration of the infectious period. In a frequency-dependent model, this simplifies to the product of the transmission rate per infected individual and the average duration of infectiousness.\n\nThe rate of new infections is given by the term $\\frac{c(\\alpha) p}{N} S I$. The rate of new infections generated per infected individual is therefore $\\frac{c(\\alpha) p S}{N}$. At the start of an epidemic, the population is considered fully susceptible, so we take the limit $S \\to N$. In this limit, the transmission rate per infected individual becomes $\\frac{c(\\alpha) p N}{N} = c(\\alpha) p$.\n\nThe dynamics of the infected class are given by $\\frac{dI}{dt} = \\frac{c(\\alpha) p}{N} S I - (\\gamma + \\alpha) I$. The term $(\\gamma + \\alpha)I$ represents the total rate at which individuals are removed from the infected class, either by recovery (at rate $\\gamma$) or by disease-induced mortality (at rate $\\alpha$). The per-capita removal rate is thus $\\gamma + \\alpha$. The average duration of the infectious period is the reciprocal of this rate, which is $\\frac{1}{\\gamma + \\alpha}$.\n\nCombining these components, the basic reproduction number is the product of the transmission rate and the infectious duration:\n$$\nR_0(\\alpha) = (c(\\alpha) p) \\times \\left(\\frac{1}{\\gamma + \\alpha}\\right) = \\frac{c(\\alpha) p}{\\gamma + \\alpha}\n$$\nThis expression represents the pathogen's fitness at the point of invasion.\n\nThe problem defines the selection gradient, $g(\\alpha)$, as the derivative of the natural logarithm of $R_0(\\alpha)$ with respect to $\\alpha$.\n$$\ng(\\alpha) \\equiv \\frac{d}{d\\alpha} \\ln(R_0(\\alpha))\n$$\nWe substitute the expression for $R_0(\\alpha)$ into this definition.\n$$\ng(\\alpha) = \\frac{d}{d\\alpha} \\ln\\left(\\frac{c(\\alpha) p}{\\gamma + \\alpha}\\right)\n$$\nUsing the properties of the logarithm, we can expand the expression to simplify differentiation:\n$$\n\\ln\\left(\\frac{c(\\alpha) p}{\\gamma + \\alpha}\\right) = \\ln(c(\\alpha)) + \\ln(p) - \\ln(\\gamma + \\alpha)\n$$\nNow, we differentiate this expression term by term with respect to $\\alpha$:\n$$\ng(\\alpha) = \\frac{d}{d\\alpha} \\left[ \\ln(c(\\alpha)) + \\ln(p) - \\ln(\\gamma + \\alpha) \\right]\n$$\n$$\ng(\\alpha) = \\frac{d}{d\\alpha}\\ln(c(\\alpha)) + \\frac{d}{d\\alpha}\\ln(p) - \\frac{d}{d\\alpha}\\ln(\\gamma + \\alpha)\n$$\nWe evaluate each derivative:\n1.  For the first term, we apply the chain rule: $\\frac{d}{d\\alpha}\\ln(c(\\alpha)) = \\frac{1}{c(\\alpha)} \\cdot c'(\\alpha) = \\frac{c'(\\alpha)}{c(\\alpha)}$.\n2.  For the second term, $p$ is a constant with respect to $\\alpha$, so its derivative is zero: $\\frac{d}{d\\alpha}\\ln(p) = 0$.\n3.  For the third term, we again use the chain rule: $\\frac{d}{d\\alpha}\\ln(\\gamma + \\alpha) = \\frac{1}{\\gamma + \\alpha} \\cdot \\frac{d}{d\\alpha}(\\gamma + \\alpha) = \\frac{1}{\\gamma + \\alpha} \\cdot (0 + 1) = \\frac{1}{\\gamma + \\alpha}$.\n\nSubstituting these results back into the expression for $g(\\alpha)$:\n$$\ng(\\alpha) = \\frac{c'(\\alpha)}{c(\\alpha)} + 0 - \\frac{1}{\\gamma + \\alpha}\n$$\nThis simplifies to the final closed-form expression for the selection gradient:\n$$\ng(\\alpha) = \\frac{c'(\\alpha)}{c(\\alpha)} - \\frac{1}{\\gamma + \\alpha}\n$$\nThis expression quantifies the net selective pressure on virulence. The term $\\frac{c'(\\alpha)}{c(\\alpha)}$ represents the marginal fitness change through the effect of virulence on the contact rate, while the term $-\\frac{1}{\\gamma + \\alpha}$ represents the marginal fitness change through the effect of virulence on the duration of the infectious period. The derivation is complete.", "answer": "$$\n\\boxed{\\frac{c'(\\alpha)}{c(\\alpha)} - \\frac{1}{\\gamma + \\alpha}}\n$$", "id": "2710055"}, {"introduction": "This exercise challenges the simple assumption that virulence always hinders transmission by exploring a different ecological context. We will investigate a vector-borne disease where sicker hosts paradoxically become more attractive to vectors, creating a positive link between virulence $\\alpha$ and the biting rate $a(\\alpha)$. This practice introduces the powerful next-generation matrix framework to calculate pathogen fitness, represented by the basic reproduction number $R_0$, and allows us to determine the optimal, or \"evolutionarily singular,\" level of virulence from the pathogen's perspective [@problem_id:2710115].", "problem": "Consider a vector-borne pathogen in a host–vector system with dynamics that can be approximated near the disease-free equilibrium by the following biological ingredients. Hosts experience background mortality at rate $\\mu$, recover at rate $\\gamma$, and suffer additional disease-induced mortality (virulence) at rate $\\alpha$. Vectors suffer background mortality at rate $\\delta$. Let $m$ denote the vector-to-host ratio. Each vector bites at rate $a(\\alpha)$, which depends on host symptoms through virulence $\\alpha$, with $da/d\\alpha0$. Let $\\beta_{VH}$ be the per-bite transmission probability from vector to host and $\\beta_{HV}$ be the per-bite transmission probability from host to vector. Assume a rare pathogen in a demographically steady host–vector system, so that susceptible hosts and vectors are approximately at their demographic equilibria, and assume frequency-independent biting. Use the next-generation (invasion) framework as the fundamental base: the basic reproduction number $R_0$ is the dominant eigenvalue of the next-generation operator that maps one generation of infections to the next.\n\n1) Using these assumptions and the next-generation framework, derive $R_0(\\alpha)$ as a function of $a(\\alpha)$, $\\beta_{VH}$, $\\beta_{HV}$, $m$, $\\delta$, $\\gamma$, $\\mu$, and $\\alpha$. Your derivation must start from the definitions of the per-capita infection production of hosts by vectors and of vectors by hosts, together with the average infectious durations.\n\n2) Define the selection gradient on virulence as the derivative of the invasion fitness with respect to $\\alpha$ evaluated at rarity. Under the standard assumption that, in this ecological setting, selection on a rare pathogen strain maximizes $R_0(\\alpha)$, compute $\\frac{d}{d\\alpha}\\ln R_0(\\alpha)$ explicitly in terms of $a(\\alpha)$ and its derivative.\n\n3) Now impose a specific, symptom-induced attractiveness function $a(\\alpha)=a_0\\left(1+k\\alpha\\right)^p$ with $a_00$, $k0$, and $p0$, and assume $p\\neq \\frac{1}{2}$. Solve analytically for the evolutionarily singular virulence $\\alpha^{\\ast}$ satisfying $\\frac{d}{d\\alpha}\\ln R_0(\\alpha^{\\ast})=0$. Express your final answer as a single closed-form expression in terms of $a_0$, $k$, $p$, $\\gamma$, and $\\mu$ only (note that $a_0$ will cancel). No numerical evaluation is required. Provide only the expression for $\\alpha^{\\ast}$ as your final answer.", "solution": "The problem statement is coherent, scientifically grounded in established epidemiological and evolutionary theory, and quantitatively well-posed. I will therefore proceed with the required derivations.\n\nThe solution is structured in three parts as requested.\n\nPart 1: Derivation of the basic reproduction number $R_0(\\alpha)$.\n\nWe use the next-generation matrix framework to derive $R_0$. The system involves two infectious compartments: infected hosts ($I_H$) and infected vectors ($I_V$). The next-generation matrix $K$ is given by $K = F V^{-1}$, where $F$ is the matrix of new infection rates and $V$ is the matrix of transfer rates between compartments (including removal). $R_0$ is the spectral radius of $K$.\n\nThe rates of new infections are:\n-   New host infections produced by the vector population: The total rate of biting by the vector population ($mN_H$ vectors total) is $a(\\alpha)mN_H$. Since we consider a rare pathogen, we assume almost all hosts ($N_H$) are susceptible. The rate of new infections per infected vector is $a(\\alpha)\\beta_{VH}S_H/N_H \\approx a(\\alpha)\\beta_{VH}$ since $S_H \\approx N_H$.\n-   New vector infections produced by the host population: The rate at which susceptible vectors are infected by a single infectious host is $m a(\\alpha) \\beta_{HV}$. This is because a single host is associated with $m$ vectors, each biting at rate $a(\\alpha)$.\n\nLet the state vector of infectious individuals be $(I_H, I_V)^T$. The matrix $F$ of new infections is:\n$$\nF = \\begin{pmatrix}\n0  a(\\alpha) \\beta_{VH} \\\\\nm a(\\alpha) \\beta_{HV}  0\n\\end{pmatrix}\n$$\nThe transfer matrix $V$ describes the rates at which individuals leave the infectious classes.\n-   Infected hosts ($I_H$) are removed by background mortality at rate $\\mu$, recovery at rate $\\gamma$, and disease-induced mortality (virulence) at rate $\\alpha$. The total removal rate for an infected host is $\\gamma + \\mu + \\alpha$.\n-   Infected vectors ($I_V$) are removed by background mortality at rate $\\delta$. They do not recover.\n\nThe matrix $V$ is therefore a diagonal matrix of these rates:\n$$\nV = \\begin{pmatrix}\n\\gamma + \\mu + \\alpha  0 \\\\\n0  \\delta\n\\end{pmatrix}\n$$\nThe inverse of $V$ gives the mean duration in each infectious state:\n$$\nV^{-1} = \\begin{pmatrix}\n\\frac{1}{\\gamma + \\mu + \\alpha}  0 \\\\\n0  \\frac{1}{\\delta}\n\\end{pmatrix}\n$$\nThe next-generation matrix $K = F V^{-1}$ is:\n$$\nK = \\begin{pmatrix}\n0  a(\\alpha) \\beta_{VH} \\\\\nm a(\\alpha) \\beta_{HV}  0\n\\end{pmatrix}\n\\begin{pmatrix}\n\\frac{1}{\\gamma + \\mu + \\alpha}  0 \\\\\n0  \\frac{1}{\\delta}\n\\end{pmatrix}\n= \\begin{pmatrix}\n0  \\frac{a(\\alpha) \\beta_{VH}}{\\delta} \\\\\n\\frac{m a(\\alpha) \\beta_{HV}}{\\gamma + \\mu + \\alpha}  0\n\\end{pmatrix}\n$$\nThe basic reproduction number, $R_0$, is the dominant eigenvalue (spectral radius) of $K$. The eigenvalues $\\lambda$ are solutions to $\\det(K - \\lambda I) = 0$:\n$$\n\\det \\begin{pmatrix}\n-\\lambda  \\frac{a(\\alpha) \\beta_{VH}}{\\delta} \\\\\n\\frac{m a(\\alpha) \\beta_{HV}}{\\gamma + \\mu + \\alpha}  -\\lambda\n\\end{pmatrix} = \\lambda^2 - \\left(\\frac{a(\\alpha) \\beta_{VH}}{\\delta}\\right)\\left(\\frac{m a(\\alpha) \\beta_{HV}}{\\gamma + \\mu + \\alpha}\\right) = 0\n$$\nThis gives $\\lambda^2 = \\frac{m a(\\alpha)^2 \\beta_{VH} \\beta_{HV}}{\\delta(\\gamma + \\mu + \\alpha)}$. The dominant eigenvalue is the positive square root:\n$$\nR_0(\\alpha) = \\sqrt{\\frac{m a(\\alpha)^2 \\beta_{VH} \\beta_{HV}}{\\delta(\\gamma + \\mu + \\alpha)}} = a(\\alpha) \\sqrt{\\frac{m \\beta_{VH} \\beta_{HV}}{\\delta(\\gamma + \\mu + \\alpha)}}\n$$\n\nPart 2: Computation of the selection gradient $\\frac{d}{d\\alpha}\\ln R_0(\\alpha)$.\n\nThe selection gradient on virulence $\\alpha$ is found by differentiating the logarithm of the fitness proxy, $R_0(\\alpha)$, with respect to $\\alpha$. First, we compute $\\ln R_0(\\alpha)$:\n$$\n\\ln R_0(\\alpha) = \\ln \\left( a(\\alpha) \\sqrt{\\frac{m \\beta_{VH} \\beta_{HV}}{\\delta(\\gamma + \\mu + \\alpha)}} \\right)\n$$\nUsing properties of logarithms, we separate the terms:\n$$\n\\ln R_0(\\alpha) = \\ln(a(\\alpha)) + \\frac{1}{2} \\ln \\left( \\frac{m \\beta_{VH} \\beta_{HV}}{\\delta} \\right) - \\frac{1}{2} \\ln(\\gamma + \\mu + \\alpha)\n$$\nNow, we differentiate with respect to $\\alpha$. The term $\\frac{1}{2}\\ln\\left(\\frac{m \\beta_{VH} \\beta_{HV}}{\\delta}\\right)$ is constant with respect to $\\alpha$ and its derivative is $0$.\n$$\n\\frac{d}{d\\alpha}\\ln R_0(\\alpha) = \\frac{d}{d\\alpha}\\ln(a(\\alpha)) - \\frac{d}{d\\alpha}\\left(\\frac{1}{2} \\ln(\\gamma + \\mu + \\alpha)\\right)\n$$\nApplying the chain rule, $\\frac{d}{dx}\\ln(u(x)) = \\frac{u'(x)}{u(x)}$, we obtain:\n$$\n\\frac{d}{d\\alpha}\\ln R_0(\\alpha) = \\frac{a'(\\alpha)}{a(\\alpha)} - \\frac{1}{2(\\gamma + \\mu + \\alpha)}\n$$\nwhere $a'(\\alpha) = \\frac{da}{d\\alpha}$. This expression represents the selection gradient on virulence. It balances the marginal benefit of increasing virulence (increased biting rate, the first term) against the marginal cost (increased mortality and thus shorter infectious period, the second term).\n\nPart 3: Solving for the evolutionarily singular virulence $\\alpha^{\\ast}$.\n\nThe evolutionarily singular virulence, $\\alpha^{\\ast}$, is a value of $\\alpha$ where the selection gradient is zero. We set the expression from Part 2 to zero:\n$$\n\\frac{a'(\\alpha^{\\ast})}{a(\\alpha^{\\ast})} - \\frac{1}{2(\\gamma + \\mu + \\alpha^{\\ast})} = 0\n$$\n$$\n\\frac{a'(\\alpha^{\\ast})}{a(\\alpha^{\\ast})} = \\frac{1}{2(\\gamma + \\mu + \\alpha^{\\ast})}\n$$\nWe are given the specific function $a(\\alpha) = a_0(1+k\\alpha)^p$. First, we compute its derivative $a'(\\alpha)$:\n$$\na'(\\alpha) = \\frac{d}{d\\alpha} \\left[ a_0(1+k\\alpha)^p \\right] = a_0 \\cdot p(1+k\\alpha)^{p-1} \\cdot k = a_0 k p (1+k\\alpha)^{p-1}\n$$\nNext, we compute the ratio $\\frac{a'(\\alpha)}{a(\\alpha)}$:\n$$\n\\frac{a'(\\alpha)}{a(\\alpha)} = \\frac{a_0 k p (1+k\\alpha)^{p-1}}{a_0(1+k\\alpha)^p} = \\frac{kp}{1+k\\alpha}\n$$\nNote that the parameter $a_0$ cancels, as indicated in the problem statement. Substituting this result into the equilibrium condition for $\\alpha^{\\ast}$:\n$$\n\\frac{kp}{1+k\\alpha^{\\ast}} = \\frac{1}{2(\\gamma + \\mu + \\alpha^{\\ast})}\n$$\nWe now solve this equation for $\\alpha^{\\ast}$.\n$$\n2kp(\\gamma + \\mu + \\alpha^{\\ast}) = 1(1+k\\alpha^{\\ast})\n$$\n$$\n2kp(\\gamma + \\mu) + 2kp\\alpha^{\\ast} = 1 + k\\alpha^{\\ast}\n$$\nRearranging the terms to isolate $\\alpha^{\\ast}$:\n$$\n2kp\\alpha^{\\ast} - k\\alpha^{\\ast} = 1 - 2kp(\\gamma + \\mu)\n$$\n$$\n\\alpha^{\\ast}(2kp - k) = 1 - 2kp(\\gamma + \\mu)\n$$\n$$\n\\alpha^{\\ast} k(2p - 1) = 1 - 2kp(\\gamma + \\mu)\n$$\nGiven the constraint $p \\neq \\frac{1}{2}$, the term $2p - 1$ is non-zero, so we can divide by it to find the unique expression for $\\alpha^{\\ast}$:\n$$\n\\alpha^{\\ast} = \\frac{1 - 2kp(\\gamma + \\mu)}{k(2p - 1)}\n$$\nThis is the final analytical expression for the evolutionarily singular virulence.", "answer": "$$\n\\boxed{\\frac{1 - 2kp(\\gamma + \\mu)}{k(2p - 1)}}\n$$", "id": "2710115"}, {"introduction": "Moving from analysis to design, this final practice demonstrates how evolutionary theory can directly inform public health strategy. You will use a computational model of adaptive dynamics to design a temporary intervention that steers a pathogen's evolution from a highly virulent state to a more benign one. This problem requires synthesizing the concepts of selection gradients and evolutionary bistability to find the minimal intervention duration needed to push the pathogen's trait across a critical threshold, locking it into a low-virulence basin of attraction [@problem_id:2710106].", "problem": "Consider a pathogen evolving its virulence trait $ \\alpha \\in \\mathbb{R}_{\\ge 0} $ in a large host population, under the standard separation-of-timescales assumption that ecological dynamics equilibrate fast relative to evolutionary change. Under Adaptive Dynamics (AD), the canonical equation assumes that the trait dynamics follow a gradient ascent of invasion fitness $ W(\\alpha; p) $ with respect to $ \\alpha $, scaled by a positive constant $ \\kappa $ that absorbs mutation rate, mutational variance, and population size. Specifically, suppose the evolutionary dynamics are given by\n$$\n\\frac{d \\alpha}{dt} \\;=\\; \\kappa \\, g(\\alpha; p(t)), \\quad \\text{where } g(\\alpha; p) \\equiv \\frac{\\partial W(\\alpha; p)}{\\partial \\alpha}.\n$$\nAssume that the invasion fitness $ W(\\alpha; p) $ is approximated by the logarithm of the basic reproduction number,\n$$\nW(\\alpha; p) \\;=\\; \\ln R_0(\\alpha; p) \\;=\\; \\ln \\beta(\\alpha; p) \\;-\\; \\ln(\\alpha + \\gamma + d),\n$$\nwith recovery rate $ \\gamma  0 $ and background mortality $ d \\ge 0 $, both constant. The transmission rate $ \\beta(\\alpha; p) $ reflects two routes of transmission with opposing virulence dependencies: a community-contact route that declines with virulence due to reduced host mobility, and a caregiver-contact route that increases with virulence due to higher symptom-driven contact intensity. Let\n$$\n\\beta(\\alpha; p) \\;=\\; \\beta_c \\, (1-p) \\, v(\\alpha)\\, m(\\alpha) \\;+\\; \\beta_h \\, p \\, v(\\alpha)\\, h(\\alpha),\n$$\nwhere $ p \\in [0,1] $ is a controllable environment parameter (e.g., the fraction of contact occurring in caregiver settings modulated by interventions), $ \\beta_c  0 $ and $ \\beta_h  0 $ are route-specific coefficients, and the within-host and contact functions are\n$$\nv(\\alpha) \\;=\\; \\frac{\\alpha}{\\alpha + K}, \\quad\nm(\\alpha) \\;=\\; \\frac{1}{1 + \\alpha/M}, \\quad\nh(\\alpha) \\;=\\; \\frac{\\alpha}{\\alpha + H},\n$$\nwith $ K0 $, $ M0 $, and $ H0 $. The combination $ v(\\alpha) m(\\alpha) $ yields a hump-shaped community-contact contribution, while $ v(\\alpha) h(\\alpha) $ yields an increasing-saturating caregiver-contact contribution.\n\nInterventions are modeled by time-variation in $ p(t) $ using a single rectangular pulse:\n$$\np(t) \\;=\\; \\begin{cases}\np_{\\mathrm{hi}},  0 \\le t  T,\\\\\np_{\\mathrm{lo}},  t \\ge T,\n\\end{cases}\n$$\nwhere $ p_{\\mathrm{lo}} $ is the baseline environment and $ p_{\\mathrm{hi}} $ is the intervention setting. The goal is to exploit transient selection during the pulse to push the system from a high-virulence basin of attraction to a low-virulence basin of attraction under the baseline $ p_{\\mathrm{lo}} $.\n\nAn evolutionary steady state (ESS) at a fixed $ p $ satisfies $ g(\\alpha^*; p) = 0 $. Stability under the gradient flow above is determined by the sign of $ \\partial g/\\partial \\alpha $: a root is locally attracting (stable) if $ \\partial g/\\partial \\alpha  0 $ and repelling (unstable) if $ \\partial g/\\partial \\alpha  0 $. Under some parameter regimes, the baseline $ p_{\\mathrm{lo}} $ admits bistability with two stable ESS (a low-virulence $ \\alpha_{\\mathrm{L}} $ and a high-virulence $ \\alpha_{\\mathrm{H}} $) separated by an unstable equilibrium $ \\alpha_{\\mathrm{U}} $. Starting from an initial trait $ \\alpha(0)=\\alpha_0 $ in the high-virulence basin ($ \\alpha_0  \\alpha_{\\mathrm{U}} $), a sufficiently long pulse $ T $ at $ p_{\\mathrm{hi}} $ can move $ \\alpha(t) $ below $ \\alpha_{\\mathrm{U}} $, after which baseline dynamics drive $ \\alpha(t) $ toward $ \\alpha_{\\mathrm{L}} $.\n\nYour tasks are:\n- Implement the trait dynamics $ d\\alpha/dt = \\kappa \\, g(\\alpha; p(t)) $, where $ g(\\alpha;p) = \\partial W/\\partial \\alpha $ and $ W(\\alpha;p) = \\ln \\beta(\\alpha;p) - \\ln(\\alpha+\\gamma+d) $, using a reliable numerical differentiation for $ g $ and a fixed-step explicit Runge–Kutta integrator for time-stepping.\n- Given baseline $ p_{\\mathrm{lo}} $, compute all ESS by scanning $ \\alpha \\in [\\alpha_{\\min}, \\alpha_{\\max}] $ for sign changes in $ g(\\alpha; p_{\\mathrm{lo}}) $ and locate roots by robust bracketing. Classify each root's stability via a numerical estimate of $ \\partial g/\\partial \\alpha $.\n- If the baseline is bistable with three ESS (low stable, middle unstable, high stable), define the basin-separating threshold as the unstable equilibrium $ \\alpha_{\\mathrm{U}} $. Otherwise, define a target threshold $ \\alpha_{\\mathrm{goal}} $ (provided per test case) that represents a practical low-virulence target. In the bistable case, success is achieved if the post-intervention trajectory ends with $ \\alpha_{\\text{end}}  \\alpha_{\\mathrm{U}} $ (equivalently, in the low basin); in the monostable case, success is achieved if $ \\alpha_{\\text{end}} \\le \\alpha_{\\mathrm{goal}} $.\n- Design a schedule by computing the minimal pulse duration $ T^{\\star} \\in [0, T_{\\max}] $ that achieves success, if any. Use bisection on $ T $ to a specified tolerance, with failure reported as $ -1.0 $ if success is not achievable within $ [0, T_{\\max}] $.\n- For each tested $ T $, integrate the dynamics with $ p(t) $ as above from $ t=0 $ to $ t = T + T_{\\mathrm{relax}} $, where $ T_{\\mathrm{relax}} $ is a sufficiently large relaxation time at baseline $ p_{\\mathrm{lo}} $ to approach the post-pulse basin. Use a fixed step $ \\Delta t $ for numerical integration and handle the lower bound $ \\alpha_{\\min} $ by reflecting or clamping to avoid nonphysical negative values.\n\nUse the following fixed model parameters across all tests:\n- $ \\beta_c = 3.0 $, $ \\beta_h = 9.0 $,\n- $ K = 0.2 $, $ M = 0.5 $, $ H = 0.1 $,\n- $ \\gamma = 0.3 $, $ d = 0.0 $,\n- $ \\kappa $ varies by test case as specified,\n- $ \\alpha_{\\min} = 10^{-6} $, $ \\alpha_{\\max} = 5.0 $,\n- numerical differentiation step $ \\varepsilon = 10^{-6} $,\n- time step $ \\Delta t = 0.05 $, relaxation time $ T_{\\mathrm{relax}} = 800.0 $,\n- root scan resolution $ N_{\\alpha} = 1000 $.\n\nRequired outputs:\n- For each test case, return a floating-point minimal pulse duration $ T^{\\star} $ in the interval $ [0, T_{\\max}] $ rounded by standard string formatting (no explicit rounding constraint), or $ -1.0 $ if not achievable.\n\nTest suite (each test case is a tuple specifying $ (\\alpha_0, p_{\\mathrm{lo}}, p_{\\mathrm{hi}}, \\kappa, T_{\\max}, \\alpha_{\\mathrm{goal}}) $):\n- Case $ 1 $ (happy-path bistability, strong intervention): $ (1.5, 0.25, 0.85, 0.04, 500.0, 0.5) $.\n- Case $ 2 $ (insufficient intervention amplitude): $ (1.5, 0.25, 0.50, 0.04, 500.0, 0.5) $.\n- Case $ 3 $ (near threshold initial condition): $ (0.6, 0.25, 0.85, 0.04, 500.0, 0.5) $.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the three cases as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\").\n- All outputs must be real numbers (floating-point), using decimal notation.\n\nNote: No physical units are required; all quantities are dimensionless or in arbitrary consistent units. Angles are not used. Percentages, if any, must be expressed as decimals in $ [0,1] $ as already specified.", "solution": "The problem presented is a well-posed and scientifically grounded exercise in evolutionary modeling. It requires the analysis of a pathogen's virulence evolution under a specific intervention scenario. The task is to determine the minimum intervention a duration required to steer the evolutionary trajectory from an undesirable high-virulence equilibrium to a more benign low-virulence state. The problem is valid, and a solution will be constructed based on the principles of adaptive dynamics and numerical analysis.\n\nThe analysis proceeds in several stages:\n1.  Formulation of the evolutionary dynamics.\n2.  Identification and stability analysis of evolutionary steady states (ESS).\n3.  Numerical simulation of the trait trajectory under a pulsed intervention.\n4.  Optimization of the intervention duration.\n\nThe evolutionary dynamics of the virulence trait, denoted by $\\alpha \\in \\mathbb{R}_{\\ge 0}$, are governed by the canonical equation of adaptive dynamics:\n$$\n\\frac{d \\alpha}{dt} = \\kappa \\, g(\\alpha; p(t))\n$$\nwhere $\\kappa$ is a positive constant representing the speed of evolution, and $g(\\alpha; p)$ is the selection gradient. This gradient is the partial derivative of the invasion fitness $W(\\alpha; p)$ with respect to the trait $\\alpha$:\n$$\ng(\\alpha; p) \\equiv \\frac{\\partial W(\\alpha; p)}{\\partial \\alpha}\n$$\nThe invasion fitness is defined as the natural logarithm of the basic reproduction number, $R_0(\\alpha; p)$:\n$$\nW(\\alpha; p) = \\ln R_0(\\alpha; p) = \\ln \\beta(\\alpha; p) - \\ln(\\alpha + \\gamma + d)\n$$\nHere, $\\beta(\\alpha; p)$ is the virulence- and environment-dependent transmission rate, $\\gamma$ is the host recovery rate, and $d$ is the background mortality rate. The environment is modulated by a control parameter $p(t)$.\n\nThe transmission rate $\\beta(\\alpha; p)$ is a weighted sum of two components: a community-contact route and a caregiver-contact route.\n$$\n\\beta(\\alpha; p) = \\beta_c \\, (1-p) \\, v(\\alpha)\\, m(\\alpha) + \\beta_h \\, p \\, v(\\alpha)\\, h(\\alpha)\n$$\nThe component functions are defined as:\n$$\nv(\\alpha) = \\frac{\\alpha}{\\alpha + K}, \\quad m(\\alpha) = \\frac{1}{1 + \\alpha/M}, \\quad h(\\alpha) = \\frac{\\alpha}{\\alpha + H}\n$$\nThese forms model a hump-shaped dependence on virulence for community transmission and an increasing, saturating dependence for caregiver-associated transmission. The parameter $p$ shifts the selective pressure between these two regimes.\n\nAn evolutionary steady state, or ESS, $\\alpha^*$, is a trait value where the selection gradient is zero, i.e., $g(\\alpha^*; p) = 0$. The local stability of an ESS is determined by the sign of the second derivative of the fitness function, or equivalently, the sign of $\\frac{\\partial g}{\\partial \\alpha}$ at $\\alpha^*$:\n-   If $\\frac{\\partial g}{\\partial \\alpha}(\\alpha^*)  0$, the ESS is locally stable (an evolutionary attractor).\n-   If $\\frac{\\partial g}{\\partial \\alpha}(\\alpha^*)  0$, the ESS is unstable (an evolutionary repellor).\n\nFor certain parameter values, the system can exhibit bistability under the baseline environment $p_{\\mathrm{lo}}$, meaning there are two stable ESSs, $\\alpha_{\\mathrm{L}}$ (low virulence) and $\\alpha_{\\mathrm{H}}$ (high virulence), separated by one unstable ESS, $\\alpha_{\\mathrm{U}}$. The intervention strategy consists of applying a temporary pulse of a different environment, $p_{\\mathrm{hi}}$, for a duration $T$.\n$$\np(t) = \\begin{cases}\np_{\\mathrm{hi}},  0 \\le t  T, \\\\\np_{\\mathrm{lo}},  t \\ge T.\n\\end{cases}\n$$\nThe objective is to find the minimum pulse duration $T^{\\star}$ that is sufficient to push the trait value $\\alpha(t)$ from the basin of attraction of $\\alpha_{\\mathrm{H}}$ (where $\\alpha(0) = \\alpha_0 > \\alpha_{\\mathrm{U}}$) into the basin of attraction of $\\alpha_{\\mathrm{L}}$. Success is achieved if the trait value at the end of a long relaxation period, $\\alpha_{\\mathrm{end}} = \\alpha(T + T_{\\mathrm{relax}})$, is in the low-virulence basin. In a bistable system, this means $\\alpha_{\\mathrm{end}}  \\alpha_{\\mathrm{U}}$. If the system is monostable, success is defined by $\\alpha_{\\mathrm{end}} \\le \\alpha_{\\mathrm{goal}}$.\n\nThe implementation plan is as follows:\n\nFirst, for a given test case with baseline environment $p_{\\mathrm{lo}}$, we must characterize the evolutionary landscape. This is accomplished by numerically locating all ESSs in the range $[\\alpha_{\\min}, \\alpha_{\\max}]$. We compute the selection gradient $g(\\alpha; p_{\\mathrm{lo}})$ over a fine grid of $\\alpha$ values. Roots of $g$ are located by identifying sign changes and then refining the location using a robust numerical root-finding algorithm, such as Brent's method. The stability of each root $\\alpha^*$ is then determined by numerically evaluating the sign of $\\frac{\\partial g}{\\partial \\alpha}$ at $\\alpha^*$. This analysis reveals whether the system is bistable and identifies the basin-separating unstable equilibrium $\\alpha_{\\mathrm{U}}$.\n\nSecond, we must simulate the system's trajectory for a given pulse duration $T$. The differential equation for $\\alpha(t)$ will be integrated numerically. A fixed-step, fourth-order Runge-Kutta (RK4) method is a suitable and standard choice. The integration proceeds from $t=0$ to $t = T + T_{\\mathrm{relax}}$. For $t \\in [0, T)$, the parameter is $p = p_{\\mathrm{hi}}$; for $t \\in [T, T + T_{\\mathrm{relax}}]$, it reverts to $p = p_{\\mathrm{lo}}$. The selection gradient $g(\\alpha; p)$ required at each step of the RK4 integrator will be computed using a central finite difference approximation of the derivative of $W(\\alpha; p)$ with a small step size $\\varepsilon$. During integration, the trait value is constrained to be no less than $\\alpha_{\\min}$ by clamping.\n\nThird, to find the minimal successful pulse duration $T^{\\star}$, we employ a bisection search over the interval $[0, T_{\\max}]$. A function `check_success(T)` is defined, which performs the full simulation for a pulse of duration $T$ and returns true if the final state $\\alpha_{\\mathrm{end}}$ meets the success criterion. The bisection algorithm proceeds as follows:\n1. Initialize search bounds: $T_{\\mathrm{low}} = 0$, $T_{\\mathrm{high}} = T_{\\max}$.\n2. First, check for trivial failure: If `check_success(T_max)` is false, no solution exists in the given range, and $T^{\\star} = -1.0$.\n3. Then, check for trivial success: If `check_success(0)` is true, no intervention is needed, and $T^{\\star} = 0.0$.\n4. Otherwise, iterate for a sufficient number of steps (e.g., $100$) to achieve high precision:\n    a. Set $T_{\\mathrm{mid}} = (T_{\\mathrm{low}} + T_{\\mathrm{high}}) / 2$.\n    b. If `check_success(T_mid)` is true, a shorter pulse might also work, so we update $T_{\\mathrm{high}} = T_{\\mathrm{mid}}$.\n    c. If `check_success(T_mid)` is false, a longer pulse is necessary, so we update $T_{\\mathrm{low}} = T_{\\mathrm{mid}}$.\nThe final value of $T_{\\mathrm{high}}$ provides a tight upper bound on the minimal required duration $T^{\\star}$. This procedure is applied to each test case to generate the required outputs.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import optimize\n\n# --- Model Definition ---\n\n# Fixed model parameters provided in the problem statement.\nMODEL_PARAMS = {\n    'beta_c': 3.0, 'beta_h': 9.0,\n    'K': 0.2, 'M': 0.5, 'H': 0.1,\n    'gamma': 0.3, 'd': 0.0,\n    'alpha_min': 1e-6, 'alpha_max': 5.0,\n    'epsilon': 1e-6, # For numerical differentiation\n    'dt': 0.05,\n    'T_relax': 800.0,\n    'N_alpha': 1000 # Root scan resolution\n}\n\ndef v(alpha, K):\n    \"\"\"Component function v(alpha)\"\"\"\n    return alpha / (alpha + K)\n\ndef m(alpha, M):\n    \"\"\"Component function m(alpha)\"\"\"\n    return 1.0 / (1.0 + alpha / M)\n\ndef h(alpha, H):\n    \"\"\"Component function h(alpha)\"\"\"\n    return alpha / (alpha + H)\n\ndef beta(alpha, p, params):\n    \"\"\"Transmission rate beta(alpha, p)\"\"\"\n    term_c = params['beta_c'] * (1 - p) * v(alpha, params['K']) * m(alpha, params['M'])\n    term_h = params['beta_h'] * p * v(alpha, params['K']) * h(alpha, params['H'])\n    return term_c + term_h\n\ndef W(alpha, p, params):\n    \"\"\"Invasion fitness W(alpha, p)\"\"\"\n    # Clamp alpha to avoid log(0) or division by zero issues in beta\n    alpha_clamped = np.maximum(alpha, params['alpha_min'])\n    \n    beta_val = beta(alpha_clamped, p, params)\n    \n    # Check for invalid beta values\n    if np.any(beta_val = 0):\n        # Return a large negative number for fitness to penalize non-physical regions\n        return -np.inf\n        \n    return np.log(beta_val) - np.log(alpha_clamped + params['gamma'] + params['d'])\n\ndef g(alpha, p, params):\n    \"\"\"Selection gradient g(alpha, p) = dW/dalpha, via numerical differentiation.\"\"\"\n    eps = params['epsilon']\n    return (W(alpha + eps/2, p, params) - W(alpha - eps/2, p, params)) / eps\n\ndef dg_dalpha(alpha, p, params):\n    \"\"\"Derivative of selection gradient dg/dalpha for stability analysis.\"\"\"\n    eps = params['epsilon']\n    return (g(alpha + eps/2, p, params) - g(alpha - eps/2, p, params)) / eps\n\n# --- Analysis and Simulation ---\n\ndef find_ess(p, params):\n    \"\"\"Finds and classifies evolutionary steady states (ESS) for a given p.\"\"\"\n    alpha_grid = np.linspace(params['alpha_min'], params['alpha_max'], params['N_alpha'])\n    g_vals = g(alpha_grid, p, params)\n    \n    # Find brackets for roots where g(alpha) changes sign\n    sign_changes = np.where(np.diff(np.sign(g_vals)))[0]\n    \n    ess_points = []\n    for i in sign_changes:\n        a, b = alpha_grid[i], alpha_grid[i+1]\n        try:\n            # Brent's method is robust for root finding within a bracket\n            root = optimize.brentq(g, a, b, args=(p, params))\n            stability_metric = dg_dalpha(root, p, params)\n            if stability_metric  0:\n                stability = 'stable'\n            elif stability_metric  0:\n                stability = 'unstable'\n            else:\n                stability = 'neutral'\n            ess_points.append({'alpha': root, 'stability': stability})\n        except ValueError:\n            # brentq fails if g(a) and g(b) don't have opposite signs, which can happen with numerical precision issues\n            continue\n            \n    return ess_points\n\ndef run_simulation(alpha0, T_pulse, p_lo, p_hi, kappa, params):\n    \"\"\"Simulates trait dynamics using a fixed-step RK4 integrator.\"\"\"\n    total_time = T_pulse + params['T_relax']\n    num_steps = int(np.ceil(total_time / params['dt']))\n    dt = params['dt'] # Use the fixed time step from params\n    \n    alpha = float(alpha0)\n    t = 0.0\n    \n    for _ in range(num_steps):\n        # Determine current environmental parameter p\n        current_p = p_hi if t  T_pulse else p_lo\n        \n        # RK4 integration step\n        k1 = kappa * g(alpha, current_p, params)\n        k2 = kappa * g(alpha + dt/2 * k1, current_p, params)\n        k3 = kappa * g(alpha + dt/2 * k2, current_p, params)\n        k4 = kappa * g(alpha + dt * k3, current_p, params)\n        \n        alpha_new = alpha + (dt / 6.0) * (k1 + 2*k2 + 2*k3 + k4)\n        \n        # Clamp alpha to prevent non-physical negative values\n        alpha = max(alpha_new, params['alpha_min'])\n        \n        t += dt\n        \n    return alpha\n\n# --- Main Solver Logic ---\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and find the minimal pulse duration.\n    \"\"\"\n    test_cases = [\n        # (alpha0, p_lo, p_hi, kappa, T_max, alpha_goal)\n        (1.5, 0.25, 0.85, 0.04, 500.0, 0.5), # Case 1\n        (1.5, 0.25, 0.50, 0.04, 500.0, 0.5), # Case 2\n        (0.6, 0.25, 0.85, 0.04, 500.0, 0.5), # Case 3\n    ]\n\n    results = []\n\n    for case in test_cases:\n        alpha0, p_lo, p_hi, kappa, T_max, alpha_goal = case\n        \n        # 1. Analyze baseline environment to determine stability and success threshold\n        ess_points = find_ess(p_lo, MODEL_PARAMS)\n        stable_ess = sorted([e['alpha'] for e in ess_points if e['stability'] == 'stable'])\n        unstable_ess = [e['alpha'] for e in ess_points if e['stability'] == 'unstable']\n        \n        is_bistable = (len(stable_ess) == 2 and len(unstable_ess) == 1)\n        \n        if is_bistable:\n            # Unstable point is the basin separator\n            success_threshold = unstable_ess[0]\n        else:\n            # Use the provided goal for monostable or other cases\n            success_threshold = alpha_goal\n\n        # 2. Define success checker function for bisection\n        memo = {}\n        def check_success(T):\n            if T in memo:\n                return memo[T]\n            \n            alpha_end = run_simulation(alpha0, T, p_lo, p_hi, kappa, MODEL_PARAMS)\n            \n            is_successful = False\n            if is_bistable:\n                # For bistable systems, success is crossing to the low-virulence basin\n                if alpha_end  success_threshold:\n                    is_successful = True\n            else:\n                # For monostable, success is reaching the target\n                if alpha_end = success_threshold:\n                    is_successful = True\n            \n            memo[T] = is_successful\n            return is_successful\n\n        # 3. Use bisection to find minimal pulse duration T_star\n        # Check boundaries first\n        if not check_success(T_max):\n            T_star = -1.0\n        elif check_success(0):\n            T_star = 0.0\n        else:\n            # Perform bisection\n            low_T, high_T = 0.0, T_max\n            # 100 iterations give high precision: T_max / 2^100\n            for _ in range(100):\n                mid_T = (low_T + high_T) / 2\n                if check_success(mid_T):\n                    high_T = mid_T\n                else:\n                    low_T = mid_T\n            T_star = high_T\n        \n        results.append(T_star)\n\n    # Print results in the required format\n    print(f\"[{','.join(f'{r:.7f}' for r in results)}]\")\n\n# Run the solver when the script is executed\nsolve()\n```", "id": "2710106"}]}