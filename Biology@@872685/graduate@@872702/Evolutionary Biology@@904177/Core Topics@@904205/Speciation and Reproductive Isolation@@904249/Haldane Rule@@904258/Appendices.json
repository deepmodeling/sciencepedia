{"hands_on_practices": [{"introduction": "Haldane's rule describes a pattern of hybrid dysfunction, but the expression of genetic incompatibilities is not always absolute and can be influenced by external factors. This exercise explores a scenario where hybrid inviability is conditional on environmental stress, a classic example of a genotype-by-environment interaction. By analyzing this case [@problem_id:1935970], you will practice applying the rule to more complex, realistic scenarios and learn to distinguish the underlying genetic pattern from its environment-dependent expression, a critical skill for interpreting data from both controlled lab experiments and variable natural populations.", "problem": "Haldane's rule is an observation in evolutionary biology stating that if in a species hybrid only one sex is inviable or sterile, that sex is more likely to be the heterogametic one (the one with two different sex chromosomes, e.g., XY in mammals and many insects).\n\nConsider two closely related species of river-dwelling fish that utilize an XY sex-determination system, where males are the heterogametic sex (XY) and females are the homogametic sex (XX). In a laboratory setting, scientists successfully create F1 hybrids by crossing a male of species A with a female of species B.\n\nThe resulting hybrid offspring show a peculiar pattern of viability. Both male and female hybrids are fully viable and appear healthy when raised in well-aerated, high-oxygen water. However, when the dissolved oxygen level in the water is lowered to mimic stressful conditions found in stagnant pools in their natural habitat, all of the hybrid males die before reaching maturity. The hybrid females, under these same low-oxygen conditions, show no increase in mortality and remain fully viable.\n\nBased on this scenario, which of the following statements provides the most accurate assessment?\n\nA. Yes, this is an example of Haldane's rule because the negative fitness effect (inviability) is expressed exclusively in the heterogametic sex, even though it is conditional on the environment.\n\nB. No, this is not an example of Haldane's rule because the rule requires hybrid inviability or sterility to be absolute and not dependent on environmental factors.\n\nC. No, this is not an example of Haldane's rule because the inviability is caused by an environmental stressor (low oxygen), not by genetic incompatibility.\n\nD. Yes, this is a partial example of Haldane's rule, but it would only be a full example if the female hybrids also became inviable under even more extreme low-oxygen conditions.\n\nE. It is impossible to say whether this is an example of Haldane's rule without first identifying the specific genes responsible for oxygen metabolism in these fish.", "solution": "We begin by recalling Haldane’s rule: in interspecific hybrids, when only one sex suffers reduced fitness (sterility or inviability), it is typically the heterogametic sex. In taxa with an $XY$ system, males are the heterogametic sex ($XY$) and females are the homogametic sex ($XX$). The rule addresses patterns of hybrid dysfunction and is agnostic about whether the phenotype is constant across environments; many documented cases show environment- or context-dependent expression of hybrid incompatibilities.\n\nIn the scenario, the cross between species A male and species B female produces $F_{1}$ hybrids. Under high oxygen, both hybrid sexes are viable. Under low oxygen, hybrid males (the heterogametic $XY$ sex) die before maturity (inviability), whereas hybrid females ($XX$) remain viable. Thus, the hybrid inviability is sex-specific and targets the heterogametic sex.\n\nHaldane’s rule concerns the pattern that the heterogametic sex is more likely to exhibit hybrid sterility or inviability. It does not require that the effect be absolute across all environments; conditional or environment-dependent expression still conforms to the rule, because the pattern of sex-limited hybrid dysfunction is the relevant criterion. Mechanistically, this is consistent with recessive or partially recessive incompatibilities on the $X$ chromosome being unmasked in $XY$ hybrids, potentially exacerbated by environmental stress (a genotype-by-environment interaction). Therefore:\n- Statement A is accurate: it recognizes that the negative fitness effect is confined to the heterogametic sex and allows for environmental conditionality.\n- Statement B is incorrect: Haldane’s rule does not require environment-independent, absolute inviability or sterility.\n- Statement C is incorrect: the observation of sex-specific hybrid inviability under stress is consistent with genetic incompatibilities whose effects are revealed or magnified by environmental conditions; environmental dependence does not negate Haldane’s rule.\n- Statement D is incorrect: Haldane’s rule does not require that females also become inviable under more extreme conditions; that would contradict the rule’s core prediction.\n- Statement E is incorrect: identification of the specific genes is not required to assess whether the observed pattern aligns with Haldane’s rule.\n\nThus, the most accurate assessment is A.", "answer": "$$\\boxed{A}$$", "id": "1935970"}, {"introduction": "To move beyond observing Haldane's rule to understanding its cause, we must model the underlying genetic mechanisms. The most widely accepted explanation is the dominance theory, which posits that negative fitness effects arise from recessive alleles on the X chromosome that are unmasked in the hemizygous heterogametic sex. This exercise [@problem_id:2721024] challenges you to formalize this verbal argument into a quantitative model, a foundational skill in theoretical evolutionary genetics. By deriving how F1 hybrid dysfunction scales with parameters like the dominance coefficient ($h$) and the fraction of X-linked substitutions ($\\alpha$), you will gain a deeper, mechanistic appreciation for the \"large X-effect\" in speciation.", "problem": "In the classical Dobzhansky–Muller incompatibility (DMI) framework, postzygotic isolation arises from epistatic interactions between derived alleles fixed in different lineages. Consider a pair of lineages that have accumulated many derived substitutions distributed across the genome. Let a fraction $\\alpha \\in [0,1]$ of derived substitutions be on the $X$ chromosome and a fraction $(1-\\alpha)$ on the autosomes. Assume:\n- All pairwise DMIs form by pairing one derived allele from one lineage with one derived allele from the other lineage, with equal probability across loci and equal effect size per DMI when both interacting derived alleles are fully expressed.\n- The heterogametic sex is $XY$, and we evaluate dysfunction in the $F_{1}$ male from a cross where the mother is from lineage $1$ and the father is from lineage $2$.\n- In the $F_{1}$, autosomal derived alleles are heterozygous and express a fraction $h \\in [0,1]$ of their fully expressed effect (dominance coefficient $h$), whereas $X$-linked derived alleles in $F_{1}$ males are hemizygous and thus fully expressed (effective dominance equal to $1$). Assume $X$–$X$ DMIs do not contribute in $F_{1}$ males because only one maternal $X$ is present.\n- Let the per-DMI effect size under full expression be normalized to $1$, so that expected dysfunction is proportional to the sum of expression factors over realized DMIs.\n\nUnder these assumptions:\n- The probability a random DMI is autosome–autosome ($A\\!-\\!A$) is $(1-\\alpha)^{2}$, and its expression factor in the $F_{1}$ male is $h^{2}$.\n- The probability a random DMI is $X\\!-\\!A$ is $2\\alpha(1-\\alpha)$, and its expression factor in the $F_{1}$ male is $h$.\n- The probability a random DMI is $X\\!-\\!X$ is $\\alpha^{2}$, and its expression factor in the $F_{1}$ male is $0$.\n\nDefine the expected fractional contribution of recessive $X$-linked DMIs to $F_{1}$ male dysfunction as the proportion of total $F_{1}$ dysfunction that is attributable to $X\\!-\\!A$ DMIs relative to the total from both $X\\!-\\!A$ and $A\\!-\\!A$ classes. Derive a closed-form expression for this fraction as a function of $\\alpha$ and $h$. Provide your final answer as a simplified analytic expression in terms of $\\alpha$ and $h$ only. No numerical evaluation is required and no units are needed.", "solution": "The objective is to derive an expression for the fractional contribution of $X$-autosome ($X-A$) incompatibilities to the total hybrid dysfunction in $F_{1}$ males.\n\nLet $D$ denote the expected dysfunction. According to the problem, this is proportional to the sum of expression factors over all realized DMIs. We can express the contributions from each class of DMI by weighting the probability of each class by its corresponding expression factor. Let $D_{A-A}$, $D_{X-A}$, and $D_{X-X}$ be the expected dysfunction contributions from autosome-autosome, $X$-autosome, and $X-X$ DMIs, respectively. The proportionality constant is irrelevant for a fractional contribution and can be set to $1$.\n\nThe probability of an $A-A$ DMI is given as $(1-\\alpha)^{2}$, and its expression factor in $F_1$ males is $h^2$. Thus, the expected dysfunction from this class is:\n$$D_{A-A} = (1-\\alpha)^{2} h^{2}$$\n\nThe probability of an $X-A$ DMI is $2\\alpha(1-\\alpha)$, and its expression factor is $h$, as the autosomal allele is heterozygous and the $X$-linked allele is hemizygous (fully expressed). The expected dysfunction is:\n$$D_{X-A} = 2\\alpha(1-\\alpha)h$$\n\nThe probability of an $X-X$ DMI is $\\alpha^{2}$, but its expression factor in $F_1$ males is $0$ because the male possesses only a single $X$ chromosome from the maternal lineage. Therefore:\n$$D_{X-X} = \\alpha^{2} \\cdot 0 = 0$$\n\nThe total expected dysfunction in the $F_1$ male, $D_{total}$, is the sum of the contributions from all classes:\n$$D_{total} = D_{A-A} + D_{X-A} + D_{X-X}$$\n$$D_{total} = (1-\\alpha)^{2} h^{2} + 2\\alpha(1-\\alpha)h + 0$$\n$$D_{total} = (1-\\alpha)^{2} h^{2} + 2\\alpha(1-\\alpha)h$$\n\nThe problem defines the target quantity, let us call it $F$, as the proportion of total $F_1$ dysfunction attributable to $X-A$ DMIs relative to the total from both $X-A$ and $A-A$ classes. This is mathematically expressed as the ratio of the dysfunction from $X-A$ DMIs to the total dysfunction.\n$$F = \\frac{D_{X-A}}{D_{total}} = \\frac{D_{X-A}}{D_{A-A} + D_{X-A}}$$\n\nSubstituting the expressions for $D_{X-A}$ and $D_{total}$:\n$$F = \\frac{2\\alpha(1-\\alpha)h}{(1-\\alpha)^{2} h^{2} + 2\\alpha(1-\\alpha)h}$$\n\nTo simplify this expression, we can factor out the common term $h(1-\\alpha)$ from the numerator and the denominator. This is permissible for the biologically relevant parameter space where $\\alpha \\in [0, 1)$ and $h \\in (0, 1]$. If $h=0$ or $\\alpha=1$, the total dysfunction is zero, and the fraction is undefined as $\\frac{0}{0}$. The simplified expression will represent the general case.\n$$F = \\frac{h(1-\\alpha)(2\\alpha)}{h(1-\\alpha)[(1-\\alpha)h + 2\\alpha]}$$\n\nCanceling the common factor $h(1-\\alpha)$ yields the final simplified expression:\n$$F = \\frac{2\\alpha}{(1-\\alpha)h + 2\\alpha}$$\n\nThis is the closed-form expression for the fractional contribution of $X-A$ DMIs to total $F_1$ male dysfunction as a function of the fraction of $X$-linked substitutions, $\\alpha$, and the dominance coefficient of autosomal loci, $h$.", "answer": "$$\\boxed{\\frac{2\\alpha}{(1-\\alpha)h + 2\\alpha}}$$", "id": "2721024"}, {"introduction": "Theoretical models provide clear predictions, but how do we test them with empirical data? This final exercise [@problem_id:2720969] bridges the gap between theory and modern practice by presenting a core task in speciation genomics: using population-level ancestry data to infer selection. By implementing a maximum likelihood estimation framework to analyze patterns of introgression, you will learn how to quantify sex-specific selection against introgressed X-chromosome ancestry. This practice provides a hands-on approach to using genomic data to test the quantitative predictions derived from models of Haldane's rule.", "problem": "You are given a simplified but principled model to infer sex-specific selection against introgressed ancestry on the X chromosome (denoted as X) consistent with Haldane's rule. The inference is based on genome-wide ancestry proportions, sex labels, and observed haploid ancestry states at an X-linked locus. The core principle you must use is standard deterministic viability selection on allele frequencies.\n\nFoundational base:\n- Let $p$ be the pre-selection probability that a randomly chosen haploid X-linked allele in an individual is derived from source population $\\mathsf{A}$. Under neutrality, $p$ equals the individual's genome-wide ancestry proportion $q$ from population $\\mathsf{A}$.\n- Under viability selection, the post-selection allele frequency $p^{\\prime}$ among surviving haploid alleles is given by $p^{\\prime} = \\dfrac{p \\, w_{\\mathsf{A}}}{p \\, w_{\\mathsf{A}} + (1 - p) \\, w_{\\mathsf{B}}}$, where $w_{\\mathsf{A}}$ and $w_{\\mathsf{B}}$ are the relative fitness values associated with alleles from populations $\\mathsf{A}$ and $\\mathsf{B}$, respectively. This is the canonical selection-weighted normalization from basic population genetics. Assume $w_{\\mathsf{B}} = 1$ and $w_{\\mathsf{A}} = 1 - s_{z}$, with $z \\in \\{0,1\\}$ encoding sex, $z = 0$ for females and $z = 1$ for males.\n- Therefore, the probability that a sampled haploid X-linked allele carried by an individual with genome-wide ancestry $q$ and sex $z$ is from population $\\mathsf{A}$ after selection is\n$$\n\\pi(q,z;s_f,s_m) \\equiv \\frac{q \\, (1 - s_z)}{q \\, (1 - s_z) + (1 - q)},\n$$\nwhere $s_0 = s_f$ and $s_1 = s_m$ are the unknown sex-specific selection coefficients against the introgressed X-linked ancestry from population $\\mathsf{A}$.\n\nStatistical model:\n- For each haploid X-linked observation $j$, you are given an individual's genome-wide ancestry proportion $q_j \\in [0,1]$, sex $z_j \\in \\{0,1\\}$, and a binary haploid ancestry indicator $y_j \\in \\{0,1\\}$ for an X-linked locus, where $y_j = 1$ denotes ancestry from population $\\mathsf{A}$ and $y_j = 0$ denotes ancestry from population $\\mathsf{B}$.\n- Assume independent Bernoulli sampling with success probability $\\pi(q_j,z_j;s_f,s_m)$. The log-likelihood to be maximized is\n$$\n\\ell(s_f,s_m) = \\sum_{j=1}^{n} \\left[ y_j \\, \\log \\pi(q_j,z_j;s_f,s_m) + (1 - y_j) \\, \\log \\left(1 - \\pi(q_j,z_j;s_f,s_m)\\right) \\right].\n$$\n- The parameters must satisfy $0 \\le s_f < 1$ and $0 \\le s_m < 1$.\n\nTask:\n- Implement Maximum Likelihood Estimation (MLE) to obtain the estimates $\\hat{s}_f$ and $\\hat{s}_m$ by maximizing $\\ell(s_f,s_m)$ subject to the bounds above. Use a numerical optimizer with bound constraints.\n- Decide whether the estimates are consistent with Haldane's rule for male heterogamety (males are the heterogametic sex), which predicts stronger selection against introgressed X ancestry in males than in females. Define a decision threshold $\\tau = 0.05$ and declare the data as consistent with Haldane's rule if and only if $\\hat{s}_m - \\hat{s}_f > \\tau$.\n\nNumerical and output requirements:\n- Report $\\hat{s}_m$ and $\\hat{s}_f$ rounded to three decimal places. No physical units are involved.\n- For each test case, return a list with three elements: the rounded $\\hat{s}_m$ (float), the rounded $\\hat{s}_f$ (float), and a boolean for the Haldane decision as specified above.\n- Your program should produce a single line of output containing the results as a comma-separated list of the three per-case lists, enclosed in square brackets (for example, \"[[sm1,sf1,flag1],[sm2,sf2,flag2],[sm3,sf3,flag3]]\"). No other text should be printed.\n- Your program must not read any input; it must use the embedded test suite below.\n\nTest suite:\n- In all cases, sex is encoded as $z = 0$ for females and $z = 1$ for males. The lists are aligned by index, so the $j$-th entries across the three lists correspond to the same observation.\n\nCase 1 (reduced X introgression in males; representative of Haldane's rule):\n- $q$ list: $[0.3,\\, 0.3,\\, 0.4,\\, 0.4,\\, 0.5,\\, 0.5,\\, 0.6,\\, 0.6,\\, 0.7,\\, 0.7,\\, 0.8,\\, 0.8,\\, 0.9,\\, 0.9]$\n- $z$ list: $[0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1]$\n- $y$ list: $[0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1]$\n\nCase 2 (no sex difference; near-neutral behavior):\n- $q$ list: $[0.2,\\, 0.2,\\, 0.4,\\, 0.4,\\, 0.5,\\, 0.5,\\, 0.6,\\, 0.6,\\, 0.8,\\, 0.8]$\n- $z$ list: $[0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1]$\n- $y$ list: $[0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1]$\n\nCase 3 (boundary-like behavior; strong male-specific selection):\n- $q$ list: $[0.1,\\, 0.1,\\, 0.49,\\, 0.49,\\, 0.51,\\, 0.51,\\, 0.9,\\, 0.9,\\, 0.96,\\, 0.96,\\, 0.98,\\, 0.98]$\n- $z$ list: $[0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1]$\n- $y$ list: $[0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1]$\n\nDefinition and decision rule:\n- Let $\\widehat{s}_m$ and $\\widehat{s}_f$ denote the MLEs for males and females, respectively; define $\\tau = 0.05$. Declare \"consistent with Haldane's rule\" if $\\widehat{s}_m - \\widehat{s}_f > \\tau$; otherwise, declare \"not consistent.\"\n- Round $\\widehat{s}_m$ and $\\widehat{s}_f$ to three decimal places in the final output.\n\nYour program must implement the MLE, apply it to all three cases, and print a single line of the specified aggregated output format.", "solution": "The objective is to find the Maximum Likelihood Estimates (MLEs) of $s_f$ and $s_m$ by maximizing the log-likelihood function $\\ell(s_f, s_m)$. Standard numerical optimizers are designed to minimize a function, so we will equivalently minimize the negative log-likelihood, $L(s_f, s_m) = -\\ell(s_f, s_m)$.\n\nA critical observation is that the log-likelihood function is separable with respect to the parameters $s_f$ and $s_m$. The probability $\\pi(q, z; s_f, s_m)$ depends only on $s_f$ if $z=0$ (female) and only on $s_m$ if $z=1$ (male).\nLet $J_f = \\{j \\mid z_j = 0\\}$ be the set of indices for female observations and $J_m = \\{j \\mid z_j = 1\\}$ for male observations. The log-likelihood can be written as a sum of two independent components:\n$$\n\\ell(s_f, s_m) = \\ell_f(s_f) + \\ell_m(s_m)\n$$\nwhere\n$$\n\\ell_f(s_f) = \\sum_{j \\in J_f} \\left[ y_j \\, \\log \\pi(q_j,0;s_f,s_m) + (1-y_j) \\log(1 - \\pi(q_j,0;s_f,s_m)) \\right]\n$$\n$$\n\\ell_m(s_m) = \\sum_{j \\in J_m} \\left[ y_j \\, \\log \\pi(q_j,1;s_f,s_m) + (1-y_j) \\log(1 - \\pi(q_j,1;s_f,s_m)) \\right]\n$$\nThis separability allows us to optimize for $s_f$ and $s_m$ independently by solving two one-dimensional optimization problems.\n\nLet's simplify the objective function for a generic selection coefficient $s$ and its corresponding data subset $(q_k, y_k)$. The probability is $\\pi_k = \\frac{q_k (1 - s)}{q_k (1 - s) + (1 - q_k)} = \\frac{q_k(1-s)}{1-q_k s}$. Consequently, $1-\\pi_k = \\frac{1-q_k}{1-q_k s}$.\nThe log-likelihood contribution from observation $k$ is:\n$$\ny_k \\log(\\pi_k) + (1-y_k) \\log(1-\\pi_k) = y_k \\log\\left(\\frac{q_k(1-s)}{1-q_k s}\\right) + (1-y_k) \\log\\left(\\frac{1-q_k}{1-q_k s}\\right)\n$$\n$$\n= y_k (\\log q_k + \\log(1-s) - \\log(1-q_k s)) + (1-y_k)(\\log(1-q_k) - \\log(1-q_k s))\n$$\n$$\n= (y_k \\log q_k + (1-y_k)\\log(1-q_k)) + y_k \\log(1-s) - \\log(1-q_k s)\n$$\nFor maximization with respect to $s$, the term $(y_k \\log q_k + (1-y_k)\\log(1-q_k))$ is a constant and can be ignored. Summing over all relevant observations, the task is to maximize $\\sum_k \\left[ y_k \\log(1-s) - \\log(1-q_k s) \\right]$.\nThis is equivalent to minimizing the negative of this expression:\n$$\nL(s) = \\sum_k \\left[ \\log(1-q_k s) - y_k \\log(1-s) \\right]\n$$\nThis simplified negative log-likelihood function is numerically stable and efficient to compute. We will minimize this function for $s_f$ using the female data and for $s_m$ using the male data. The optimization will be performed using a numerical scalar optimizer with bounds $(0, 1)$, as the constraints are $0 \\le s < 1$. The boundary case $s=0$ corresponds to neutrality. A value of $s \\ge 1$ is biologically nonsensical as it implies zero or negative fitness, and a value of $s<0$ implies positive selection for the introgressed allele. The provided bounds are appropriate.\n\nThe algorithm is as follows for each test case:\n1.  Partition the data $(q, z, y)$ into a female subset $(q_f, y_f)$ and a male subset $(q_m, y_m)$.\n2.  Define the objective function $L(s; q_{\\text{data}}, y_{\\text{data}}) = \\sum_k [\\log(1-q_k s) - y_k \\log(1-s)]$.\n3.  Numerically minimize $L(s_f; q_f, y_f)$ with respect to $s_f$ over the interval $[0, 1)$ to find the MLE $\\hat{s}_f$.\n4.  Numerically minimize $L(s_m; q_m, y_m)$ with respect to $s_m$ over the interval $[0, 1)$ to find the MLE $\\hat{s}_m$.\n5.  Use the unrounded estimates to evaluate the Haldane's rule condition: $\\hat{s}_m - \\hat{s}_f > \\tau = 0.05$.\n6.  Round $\\hat{s}_m$ and $\\hat{s}_f$ to three decimal places.\n7.  Compile the results into the specified list format `[rounded_sm, rounded_sf, boolean_decision]`.\nThis procedure is repeated for all test cases, and the final results are aggregated into a single list.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves the Haldane's rule inference problem for the given test cases.\n    \"\"\"\n    # Test cases as provided in the problem statement.\n    test_cases = [\n        # Case 1: reduced X introgression in males; representative of Haldane's rule\n        {\n            \"q\": [0.3, 0.3, 0.4, 0.4, 0.5, 0.5, 0.6, 0.6, 0.7, 0.7, 0.8, 0.8, 0.9, 0.9],\n            \"z\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"y\": [0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1]\n        },\n        # Case 2: no sex difference; near-neutral behavior\n        {\n            \"q\": [0.2, 0.2, 0.4, 0.4, 0.5, 0.5, 0.6, 0.6, 0.8, 0.8],\n            \"z\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"y\": [0, 0, 0, 0, 0, 0, 1, 1, 1, 1]\n        },\n        # Case 3: boundary-like behavior; strong male-specific selection\n        {\n            \"q\": [0.1, 0.1, 0.49, 0.49, 0.51, 0.51, 0.9, 0.9, 0.96, 0.96, 0.98, 0.98],\n            \"z\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"y\": [0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1]\n        }\n    ]\n\n    tau = 0.05\n    results = []\n\n    for case_data in test_cases:\n        q = np.array(case_data[\"q\"])\n        z = np.array(case_data[\"z\"])\n        y = np.array(case_data[\"y\"])\n\n        # Partition data into female (z=0) and male (z=1) subsets\n        female_mask = (z == 0)\n        male_mask = (z == 1)\n\n        q_f, y_f = q[female_mask], y[female_mask]\n        q_m, y_m = q[male_mask], y[male_mask]\n\n        def neg_log_lik(s, q_arr, y_arr):\n            \"\"\"\n            Calculates the simplified negative log-likelihood to be minimized.\n            L(s) = sum(log(1 - q_k*s) - y_k*log(1 - s))\n            \"\"\"\n            # If no data for a sex, likelihood is flat, s=0 is the neutral default.\n            if len(q_arr) == 0:\n                return 0.0\n            \n            # log(1-s) -> -inf as s->1. If any y_k=1, -y_k*log(1-s) -> +inf,\n            # which correctly penalizes s=1.\n            # np.log handles the vectorization automatically.\n            term1 = np.sum(np.log(1 - q_arr * s))\n            term2 = np.sum(y_arr * np.log(1 - s))\n            return term1 - term2\n\n        # --- Estimate s_f for females ---\n        # If no female data, MLE for s_f is taken as 0 (neutrality).\n        if len(q_f) > 0:\n            res_f = minimize_scalar(\n                lambda s: neg_log_lik(s, q_f, y_f),\n                bounds=(0, 1),\n                method='bounded'\n            )\n            s_f_hat = res_f.x\n        else:\n            s_f_hat = 0.0\n\n        # --- Estimate s_m for males ---\n        # If no male data, MLE for s_m is taken as 0.\n        if len(q_m) > 0:\n            res_m = minimize_scalar(\n                lambda s: neg_log_lik(s, q_m, y_m),\n                bounds=(0, 1),\n                method='bounded'\n            )\n            s_m_hat = res_m.x\n        else:\n            s_m_hat = 0.0\n            \n        # Decision for Haldane's rule using unrounded estimates\n        is_haldane = (s_m_hat - s_f_hat) > tau\n\n        # Round estimates for reporting\n        s_m_rounded = round(s_m_hat, 3)\n        s_f_rounded = round(s_f_hat, 3)\n\n        results.append([s_m_rounded, s_f_rounded, is_haldane])\n\n    # Format the final output string exactly as specified.\n    # The default str() representation of a list of lists matches the required format.\n    # e.g., [[0.1, 0.2, True], [0.3, 0.4, False]]\n    # However, to be certain about no extra spaces, we build it manually.\n    sub_lists_str = [f\"[{r[0]},{r[1]},{'True' if r[2] else 'False'}]\" for r in results]\n    final_output_str = f\"[{','.join(sub_lists_str)}]\"\n\n    print(final_output_str.replace(\" \", \"\"))\n\nsolve()\n```", "id": "2720969"}]}