{"hands_on_practices": [{"introduction": "To study speciation quantitatively, we must first translate experimental outcomes into standardized metrics of reproductive isolation. This foundational exercise guides you through calculating the strength of different reproductive barriers—from mating behavior to hybrid viability—using hypothetical crossing data. By applying the standard multiplicative framework, you will learn to partition total isolation into its prezygotic and postzygotic components, a crucial skill for comparing the architecture of isolation across different species pairs [@problem_id:2839957].", "problem": "A comparative crossing experiment quantifies the strength of prezygotic and postzygotic reproductive barriers between two species relative to a conspecific baseline. Use the following foundational definitions.\n\n1. Stage-specific reproductive isolation (Reproductive Isolation, RI) at a given stage is defined as the proportional reduction in the heterospecific transition probability relative to the conspecific baseline transition probability at that same stage. If $p_{\\mathrm{H},i}$ is the heterospecific probability of progressing through stage $i$ (conditional on having reached stage $i$) and $p_{\\mathrm{C},i}$ is the corresponding conspecific baseline probability, then the isolation component at stage $i$ is $I_i = 1 - \\dfrac{p_{\\mathrm{H},i}}{p_{\\mathrm{C},i}}$.\n2. The cumulative reproductive isolation across stages is defined multiplicatively as $I_{\\mathrm{total}} = 1 - \\prod_{i} (1 - I_i)$, which is equivalent to one minus the product of the heterospecific-to-conspecific transition ratios across all stages.\n\nYou are provided with the following counts from standardized assays:\n\n- Heterospecific (interspecific) series: mating attempts $100$, copulations $60$, fertilizations $10$, viable offspring $4$.\n- Conspecific baseline series: mating attempts $100$, copulations $95$, fertilizations $90$, viable offspring $85$.\n\nDefine four stages and compute their isolation components using the above framework:\n- Mating (encounter/opportunity): from baseline opportunity to mating attempts.\n- Copulation (premating behavioral/mechanical): from attempts to copulations.\n- Gametic (postmating prezygotic): from copulations to fertilizations.\n- Intrinsic viability (postzygotic): from fertilizations to viable offspring.\n\nThen compute the cumulative isolation $I_{\\mathrm{total}}$ using the multiplicative framework.\n\nReport only the cumulative isolation $I_{\\mathrm{total}}$ as a unitless decimal rounded to four significant figures.", "solution": "The problem statement is scientifically sound, logically consistent, and provides sufficient information for a unique solution. The framework for quantifying reproductive isolation ($RI$) is standard in the field of evolutionary genetics. We shall proceed with the calculation.\n\nThe problem defines four discrete stages in the reproductive process and requires the calculation of stage-specific and cumulative reproductive isolation. Let subscript $H$ denote the heterospecific cross and $C$ denote the conspecific cross. The count data for each stage transition is as follows:\n\n- Heterospecific series:\n  - Initial mating attempts: $N_{\\mathrm{attempts, H}} = 100$\n  - Copulations: $N_{\\mathrm{copulations, H}} = 60$\n  - Fertilizations: $N_{\\mathrm{fertilizations, H}} = 10$\n  - Viable offspring: $N_{\\mathrm{offspring, H}} = 4$\n\n- Conspecific series:\n  - Initial mating attempts: $N_{\\mathrm{attempts, C}} = 100$\n  - Copulations: $N_{\\mathrm{copulations, C}} = 95$\n  - Fertilizations: $N_{\\mathrm{fertilizations, C}} = 90$\n  - Viable offspring: $N_{\\mathrm{offspring, C}} = 85$\n\nThe transition probability for a given stage $i$, $p_i$, is the ratio of the number of individuals successfully completing the stage to the number of individuals entering the stage.\n\nThe four stages are defined as:\n1.  **Mating ($I_1$)**: From baseline opportunity to mating attempts.\n2.  **Copulation ($I_2$)**: From attempts to copulations.\n3.  **Gametic ($I_3$)**: From copulations to fertilizations.\n4.  **Intrinsic viability ($I_4$)**: From fertilizations to viable offspring.\n\nWe first calculate the conditional transition probabilities ($p_{\\mathrm{H},i}$ and $p_{\\mathrm{C},i}$) for each stage $i$.\n\n**Stage 1: Mating**\nThe problem defines this stage as the transition from a \"baseline opportunity\" to \"mating attempts\". The number of mating attempts for both series is given as $100$. Let the unstated number of baseline opportunities be $N_{opp}$. As this initial condition is identical for both experimental series, the probabilities are $p_{\\mathrm{H},1} = \\frac{100}{N_{opp}}$ and $p_{\\mathrm{C},1} = \\frac{100}{N_{opp}}$. The ratio $\\frac{p_{\\mathrm{H},1}}{p_{\\mathrm{C},1}} = 1$. The isolation component is $I_1 = 1 - \\frac{p_{\\mathrm{H},1}}{p_{\\mathrm{C},1}} = 1 - 1 = 0$. This indicates no isolation at this stage, as expected from a controlled experimental design.\n\n**Stage 2: Copulation**\nThis is the probability of copulation, given a mating attempt.\n$$ p_{\\mathrm{H},2} = \\frac{N_{\\mathrm{copulations, H}}}{N_{\\mathrm{attempts, H}}} = \\frac{60}{100} = 0.6 $$\n$$ p_{\\mathrm{C},2} = \\frac{N_{\\mathrm{copulations, C}}}{N_{\\mathrm{attempts, C}}} = \\frac{95}{100} = 0.95 $$\n\n**Stage 3: Gametic**\nThis is the probability of fertilization, given a copulation.\n$$ p_{\\mathrm{H},3} = \\frac{N_{\\mathrm{fertilizations, H}}}{N_{\\mathrm{copulations, H}}} = \\frac{10}{60} = \\frac{1}{6} $$\n$$ p_{\\mathrm{C},3} = \\frac{N_{\\mathrm{fertilizations, C}}}{N_{\\mathrm{copulations, C}}} = \\frac{90}{95} = \\frac{18}{19} $$\n\n**Stage 4: Intrinsic Viability**\nThis is the probability of producing a viable offspring, given a fertilization.\n$$ p_{\\mathrm{H},4} = \\frac{N_{\\mathrm{offspring, H}}}{N_{\\mathrm{fertilizations, H}}} = \\frac{4}{10} = 0.4 $$\n$$ p_{\\mathrm{C},4} = \\frac{N_{\\mathrm{offspring, C}}}{N_{\\mathrm{fertilizations, C}}} = \\frac{85}{90} = \\frac{17}{18} $$\n\nThe cumulative reproductive isolation, $I_{\\mathrm{total}}$, is defined as:\n$$ I_{\\mathrm{total}} = 1 - \\prod_{i=1}^{4} (1 - I_i) $$\nwhere $I_i = 1 - \\frac{p_{\\mathrm{H},i}}{p_{\\mathrm{C},i}}$. This means $(1 - I_i) = \\frac{p_{\\mathrm{H},i}}{p_{\\mathrm{C},i}}$.\nTherefore, the formula for cumulative isolation can be expressed as:\n$$ I_{\\mathrm{total}} = 1 - \\left( \\frac{p_{\\mathrm{H},1}}{p_{\\mathrm{C},1}} \\times \\frac{p_{\\mathrm{H},2}}{p_{\\mathrm{C},2}} \\times \\frac{p_{\\mathrm{H},3}}{p_{\\mathrm{C},3}} \\times \\frac{p_{\\mathrm{H},4}}{p_{\\mathrm{C},4}} \\right) $$\nThe product of the ratios of conditional probabilities is equivalent to the ratio of the total probabilities of success across all stages. Let $P_H$ and $P_C$ be the total probabilities of producing a viable offspring from a baseline opportunity.\n$$ P_{\\mathrm{H}} = p_{\\mathrm{H},1} \\times p_{\\mathrm{H},2} \\times p_{\\mathrm{H},3} \\times p_{\\mathrm{H},4} = \\frac{100}{N_{opp}} \\times \\frac{60}{100} \\times \\frac{10}{60} \\times \\frac{4}{10} = \\frac{4}{N_{opp}} $$\n$$ P_{\\mathrm{C}} = p_{\\mathrm{C},1} \\times p_{\\mathrm{C},2} \\times p_{\\mathrm{C},3} \\times p_{\\mathrm{C},4} = \\frac{100}{N_{opp}} \\times \\frac{95}{100} \\times \\frac{90}{95} \\times \\frac{85}{90} = \\frac{85}{N_{opp}} $$\nThe product term in the equation for $I_{\\mathrm{total}}$ simplifies to:\n$$ \\prod_{i=1}^{4} (1 - I_i) = \\frac{P_H}{P_C} = \\frac{4/N_{opp}}{85/N_{opp}} = \\frac{4}{85} $$\nThis result can also be obtained by simply taking the ratio of the final number of viable offspring, since the initial number of opportunities was the same for both series.\n\nNow we compute the final value for $I_{\\mathrm{total}}$:\n$$ I_{\\mathrm{total}} = 1 - \\frac{4}{85} = \\frac{85 - 4}{85} = \\frac{81}{85} $$\nConverting this fraction to a decimal gives:\n$$ I_{\\mathrm{total}} = 0.952941176... $$\nThe problem requires the answer to be rounded to four significant figures. The fifth significant figure is $4$, so we do not round up the fourth digit.\n$$ I_{\\mathrm{total}} \\approx 0.9529 $$\nThis value represents a $95.29\\%$ reduction in reproductive success for the heterospecific cross relative to the conspecific baseline.", "answer": "$$\\boxed{0.9529}$$", "id": "2839957"}, {"introduction": "Postzygotic isolation often arises from negative epistatic interactions between genes that have diverged in different lineages, a concept known as a Dobzhansky-Muller incompatibility (DMI). This practice moves from measurement to mechanism, challenging you to model the population genetic consequences of a classic recessive-by-recessive DMI. By tracking gamete and genotype frequencies across two generations, you will derive the expected frequency of inviable hybrids, providing a concrete understanding of how genetic incompatibilities manifest in a hybrid population [@problem_id:2746200].", "problem": "In a large, panmictic contact zone between two diverged lineages, consider a postzygotic Dobzhansky–Muller incompatibility (DMI) involving two unlinked loci, with alleles $A/a$ at locus $1$ and $B/b$ at locus $2$. The incompatibility is recessive-by-recessive: only zygotes with genotype $aa\\,bb$ are inviable; all other genotypes are fully viable. One lineage is fixed for genotype $aa\\,BB$ and the other is fixed for genotype $AA\\,bb$. At time $t=0$, reproductively mature adults are a mixture of the two parental genotypes: a fraction $p$ are $aa\\,BB$ and a fraction $(1-p)$ are $AA\\,bb$. There is random mating (no prezygotic isolation), discrete generations, equal sex ratio, no selection prior to the realization of inviability at the zygote stage, Mendelian segregation, and independent assortment with recombination fraction $r \\in [0, \\tfrac{1}{2}]$ between the two loci in double heterozygotes.\n\nDefine “generation $1$” as the zygotes produced by the initial mating of the mixed parental pool at $t=0$, and “generation $2$” as the zygotes produced by random mating among the viable adults that arose from generation $1$. Using only the above assumptions and fundamental principles of Mendelian inheritance and recombination, derive a closed-form analytic expression for the expected proportion of inviable $aa\\,bb$ hybrids among generation $2$ zygotes as a function of $p$ and $r$. Express your final answer as a simplified expression. No rounding is required.", "solution": "The problem statement is subjected to validation prior to any attempt at a solution.\n\nStep 1: Extract Givens.\n- System: A large, panmictic population in a contact zone.\n- Genetic basis: A postzygotic Dobzhansky–Muller incompatibility (DMI) involving two loci.\n- Locus 1 alleles: $A, a$.\n- Locus 2 alleles: $B, b$.\n- Incompatibility: Recessive-by-recessive.\n- Inviable genotype: $aa\\,bb$.\n- Viable genotypes: All other eight genotypes are fully viable.\n- Parental lineages: One is fixed for genotype $aa\\,BB$, the other is fixed for genotype $AA\\,bb$.\n- Initial population composition at time $t=0$: A fraction $p$ of adults are $aa\\,BB$, and a fraction $(1-p)$ are $AA\\,bb$.\n- Mating: Random (panmixia), no prezygotic isolation.\n- Life cycle: Discrete generations.\n- Demography: Equal sex ratio.\n- Selection: Occurs only at the zygote stage (inviability of $aa\\,bb$); no other selection occurs.\n- Inheritance: Mendelian segregation and independent assortment with a specified recombination fraction $r \\in [0, \\frac{1}{2}]$ between the two loci in double heterozygotes.\n- Definition of generations: \"Generation $1$\" are the zygotes from the initial mating at $t=0$; \"Generation $2$\" are the zygotes from random mating of viable adults from Generation $1$.\n- Objective: Derive the expected proportion of inviable $aa\\,bb$ zygotes in Generation $2$ as a function of $p$ and $r$.\n\nStep 2: Validate Using Extracted Givens.\n- **Scientific Grounding**: The problem is well-grounded in the established theory of evolutionary genetics, specifically the Dobzhansky–Muller model of hybrid incompatibility. All concepts—panmixia, Mendelian inheritance, recombination, and selection—are fundamental to population genetics.\n- **Well-Posedness**: The problem is well-posed. It provides all necessary parameters ($p$, $r$) and clear definitions to allow for the derivation of a unique analytical solution. The objective is stated unambiguously.\n- **Objectivity**: The problem is stated in precise, objective, and quantitative terms.\n\nStep 3: Verdict and Action.\nThe problem is scientifically sound, self-contained, and logically consistent. No flaws are identified. The problem is deemed **valid**. We shall proceed with the derivation.\n\nThe objective is to calculate the frequency of the inviable genotype $aa\\,bb$ among the zygotes of Generation $2$. We proceed with a step-by-step analysis of the population's genetic composition across generations.\n\nFirst, we consider the parental population at $t=0$, which we designate as Generation $0$. This population consists of two types of individuals with the following frequencies:\n- Genotype $aa\\,BB$: frequency $p$.\n- Genotype $AA\\,bb$: frequency $(1-p)$.\n\nThese individuals mate randomly to produce Generation $1$ zygotes. Random mating in a large population is equivalent to the random fusion of gametes from the gamete pool. The gametes produced by the Generation $0$ population are:\n- Individuals of genotype $aa\\,BB$ produce only $aB$ gametes. Their contribution to the gamete pool is $p$.\n- Individuals of genotype $AA\\,bb$ produce only $Ab$ gametes. Their contribution to the gamete pool is $(1-p)$.\nThus, the gamete pool consists of two gamete types: $aB$ with frequency $p$, and $Ab$ with frequency $(1-p)$.\n\nThe zygotes of Generation $1$ are formed by the random union of these gametes. The resulting genotype frequencies are:\n- Frequency of $aa\\,BB$ = (Freq $aB$) $\\times$ (Freq $aB$) = $p \\times p = p^2$.\n- Frequency of $AA\\,bb$ = (Freq $Ab$) $\\times$ (Freq $Ab$) = $(1-p) \\times (1-p) = (1-p)^2$.\n- Frequency of $Aa\\,Bb$ = (Freq $aB$) $\\times$ (Freq $Ab$) + (Freq $Ab$) $\\times$ (Freq $aB$) = $p(1-p) + (1-p)p = 2p(1-p)$.\nThe sum of these frequencies is $p^2 + (1-p)^2 + 2p(1-p) = (p + (1-p))^2 = 1$, as expected.\n\nAccording to the problem, only the $aa\\,bb$ genotype is inviable. None of the Generation $1$ zygote genotypes ($aa\\,BB$, $AA\\,bb$, $Aa\\,Bb$) match this description. Therefore, all Generation $1$ zygotes are fully viable and survive to reproductive maturity. The frequencies of adults in Generation $1$ are identical to the zygote frequencies:\n- Freq($aa\\,BB$) = $p^2$.\n- Freq($AA\\,bb$) = $(1-p)^2$.\n- Freq($Aa\\,Bb$) = $2p(1-p)$.\n\nThese Generation $1$ adults now mate randomly to produce Generation $2$ zygotes. To find the genotype frequencies in Generation $2$, we must first determine the composition of the gamete pool produced by the Generation $1$ adults.\n\n- Individuals of genotype $aa\\,BB$ (frequency $p^2$) produce only $aB$ gametes.\n- Individuals of genotype $AA\\,bb$ (frequency $(1-p)^2$) produce only $Ab$ gametes.\n- Individuals of genotype $Aa\\,Bb$ (frequency $2p(1-p)$) are double heterozygotes. These individuals were formed from the fusion of an $aB$ gamete and an $Ab$ gamete. This specifies their linkage phase as repulsion (trans). For such individuals, meiosis produces four types of gametes. The parental gametes are $aB$ and $Ab$, and the recombinant gametes are $ab$ and $AB$. The recombination fraction is given as $r$.\n  - Frequency of parental gametes ($aB$, $Ab$) = $1-r$. Each is produced at a frequency of $\\frac{1-r}{2}$.\n  - Frequency of recombinant gametes ($ab$, $AB$) = $r$. Each is produced at a frequency of $\\frac{r}{2}$.\n\nNow, we calculate the total frequency of each gamete type in the pool produced by all Generation $1$ adults. We are interested in the frequency of the $aa\\,bb$ genotype in Generation $2$, which is formed by the fusion of two $ab$ gametes. We therefore only need to calculate the frequency of the $ab$ gamete.\n\nThe $ab$ gamete is produced only by the $Aa\\,Bb$ double heterozygotes.\n- Contribution to $ab$ gamete frequency from $aa\\,BB$ individuals: $0$.\n- Contribution to $ab$ gamete frequency from $AA\\,bb$ individuals: $0$.\n- Contribution to $ab$ gamete frequency from $Aa\\,Bb$ individuals: (frequency of $Aa\\,Bb$ adults) $\\times$ (frequency of $ab$ gametes produced by them)\n  $$ \\text{Freq}(ab)_{\\text{contribution}} = (2p(1-p)) \\times \\left(\\frac{r}{2}\\right) = p(1-p)r $$\nThe total frequency of the $ab$ gamete in the gamete pool of Generation $1$ is therefore:\n$$ \\text{Freq}(ab) = p(1-p)r $$\n\nThe frequency of the inviable genotype $aa\\,bb$ in the Generation $2$ zygote population is obtained by the random fusion of gametes. Since the population is panmictic and the sex ratio is equal, the frequency of an $ab$ egg is equal to the frequency of an $ab$ sperm, both being $\\text{Freq}(ab)$. The frequency of the zygote $aa\\,bb$ is the product of these frequencies:\n$$ \\text{Freq}(aa\\,bb)_{\\text{Gen 2}} = \\text{Freq}(ab) \\times \\text{Freq}(ab) = (\\text{Freq}(ab))^2 $$\nSubstituting the expression for $\\text{Freq}(ab)$:\n$$ \\text{Freq}(aa\\,bb)_{\\text{Gen 2}} = (p(1-p)r)^2 = p^2(1-p)^2r^2 $$\n\nThis closed-form analytic expression represents the expected proportion of inviable $aa\\,bb$ hybrids among Generation $2$ zygotes as a function of the initial mixing proportion $p$ and the recombination fraction $r$. The expression is already in its simplified form.", "answer": "$$ \\boxed{p^2(1-p)^2r^2} $$", "id": "2746200"}, {"introduction": "The evolution of prezygotic isolation can be driven by selection against the production of low-fitness hybrids, a process called reinforcement. This advanced computational exercise tasks you with building a simulation model from the ground up to investigate the conditions under which reinforcement can occur. By implementing a two-deme, two-locus model incorporating selection, migration, assortative mating, and recombination, you will explore the dynamic interplay of evolutionary forces that can lead to the strengthening of reproductive barriers [@problem_id:2746132].", "problem": "You are asked to implement and analyze a deterministic, two-deme, two-locus model of reinforcement in which a preference allele increases assortative mating by a locally adaptive isolation trait. Your task is to build a complete, runnable program that simulates the recursion for genotype frequencies under viability selection, assortative mating, recombination, and migration, and then uses it to evaluate whether reinforcement occurs for several parameter sets. The model and success criterion must be implemented exactly as stated below, and the program must output the results for the provided test suite as a single line in the specified format.\n\nModel structure and assumptions:\n- There are two demes, indexed by $d \\in \\{1,2\\}$, with symmetric migration of fraction $m$ per generation.\n- There are two loci, each with two alleles:\n  - Trait locus $T$ with alleles $A$ and $a$. The trait is locally adaptive: in deme $1$, $A$ is favored; in deme $2$, $a$ is favored.\n  - Preference locus $P$ with alleles $P$ and $p$. The allele $P$ increases assortative mating with respect to the trait phenotype and carries a direct fecundity cost $c$ in females.\n- Haplotypes are the ordered pairs of alleles across the two loci. Enumerate the four haplotypes as $h=0:\\,AP$, $h=1:\\,Ap$, $h=2:\\,aP$, $h=3:\\,ap$.\n- Diplotypes are unordered pairs of haplotypes $(i,j)$ with $0 \\le i \\le j \\le 3$. There are $10$ distinct diplotypes: $(0,0)$, $(0,1)$, $(0,2)$, $(0,3)$, $(1,1)$, $(1,2)$, $(1,3)$, $(2,2)$, $(2,3)$, $(3,3)$.\n- Life cycle per generation in each deme:\n  1. Adults produce gametes via meiosis with recombination rate $r$ between the two loci.\n  2. Mating occurs with assortative preference expressed in females that carry at least one $P$ allele, followed by zygote formation.\n  3. Viability selection acts on zygotes based on the trait locus $T$ with selection coefficient $s$ and dominance $h$.\n  4. Juvenile post-selection individuals migrate symmetrically between the two demes with fraction $m$ and then become the next generation of adults.\n\nDetailed components:\n- Recombination and gamete production. Given a diplotype $(i,j)$:\n  - If $i=j$, the gamete is haplotype $i$ with probability $1$.\n  - If $(i,j)$ is not a double heterozygote, recombination has no effect and each of the two haplotypes is transmitted with probability $1/2$.\n  - If $(i,j)$ is a double heterozygote, which occurs only for $(0,3)$ and $(1,2)$:\n    - For $(0,3)$ (coupling phase), the nonrecombinant gametes $0$ and $3$ occur with probability $(1-r)/2$ each, and recombinant gametes $1$ and $2$ occur with probability $r/2$ each.\n    - For $(1,2)$ (repulsion phase), the nonrecombinant gametes $1$ and $2$ occur with probability $(1-r)/2$ each, and recombinant gametes $0$ and $3$ occur with probability $r/2$ each.\n- Assortative mating. Define the female’s mating phenotype $M$ from her $T$-genotype by complete dominance: a female diplotype has $M=1$ if at least one $A$ allele is present, and $M=0$ otherwise. Females carrying at least one $P$ allele weight male mates whose $T$-haplotype matches $M$ by a factor $1+\\alpha$ relative to nonmatching male haplotypes (which have weight $1$). Females without $P$ mate randomly (all male haplotypes have weight $1$). The direct cost $c$ reduces the total reproductive output of $P$-bearing females by a factor $(1-c)$ (applied multiplicatively to their zygote contributions).\n- Viability selection. In deme $1$, fitnesses by trait genotype are $w(AA)=1$, $w(Aa)=1-hs$, $w(aa)=1-s$. In deme $2$, the roles of $A$ and $a$ are swapped: $w(aa)=1$, $w(Aa)=1-hs$, $w(AA)=1-s$. Selection acts on zygotes multiplicatively according to these fitnesses, followed by renormalization so that frequencies sum to $1$.\n- Migration. After selection, a fraction $m$ of individuals in each deme is replaced by migrants from the other deme.\n\nLinkage disequilibrium and reinforcement success criterion:\n- Within each deme, define the male gamete haplotype frequency vector $\\mathbf{g}=(g_0,g_1,g_2,g_3)$ prior to mating. The standard gametic linkage disequilibrium between the $A$ allele at $T$ and the $P$ allele at $P$ is\n  $$ D = g_0 g_3 - g_1 g_2. $$\n- To measure association between $P$ and the locally favored trait allele, define $L_{\\text{local}}$ as $L_{\\text{local}}=D$ in deme $1$ (where $A$ is locally favored) and $L_{\\text{local}}=-D$ in deme $2$ (where $a$ is locally favored).\n- Let $p_P^{(d)}$ be the frequency of allele $P$ among adults in deme $d$.\n- Given a total number of generations $G$ and an averaging window $K$ with $K \\le G$, define reinforcement success to occur if both of the following hold:\n  - $p_P^{(1)} \\ge \\theta$ and $p_P^{(2)} \\ge \\theta$ at generation $G$ for a specified threshold $\\theta$.\n  - The average of $L_{\\text{local}}$ over the last $K$ generations is strictly positive in both demes.\n- Use $\\theta=0.8$, $G=800$, and $K=100$.\n\nInitialization:\n- Initialize each deme in Hardy–Weinberg and linkage equilibrium with specified allele frequencies at $T$ and $P$. Let the initial preference allele frequency be $p_P(0)=10^{-3}$ in both demes. Let the initial trait allele frequencies be $p_A^{(1)}(0)=0.9$ in deme $1$ and $p_A^{(2)}(0)=0.1$ in deme $2$. This implies initial haplotype frequencies in deme $d$ are\n  $$ f(AP)=p_A^{(d)}(0)\\,p_P(0),\\quad f(Ap)=p_A^{(d)}(0)\\,[1-p_P(0)], $$\n  $$ f(aP)=[1-p_A^{(d)}(0)]\\,p_P(0),\\quad f(ap)=[1-p_A^{(d)}(0)]\\,[1-p_P(0)], $$\n  and initial diplotype frequencies are the unordered zygote frequencies under random mating: for haplotypes $i<j$, frequency $2 f_i f_j$, and for $i=j$, frequency $f_i^2$.\n\nComputational tasks:\n- Implement the above life cycle exactly to construct the deterministic recursion of diplotype frequencies in each deme.\n- At each generation, compute:\n  - The adult diplotype frequencies in both demes after migration.\n  - The male gamete haplotype frequencies in both demes from these adult diplotypes (these are used to compute $D$ per deme).\n  - The preference allele frequency $p_P^{(d)}$ among adults per deme.\n- Track the time series of $L_{\\text{local}}$ over generations and compute its average over the last $K$ generations for each deme.\n\nTest suite:\nFor each test case, use $h=0.5$, $G=800$, $K=100$, initial $p_P(0)=10^{-3}$, $p_A^{(1)}(0)=0.9$, $p_A^{(2)}(0)=0.1$, and threshold $\\theta=0.8$. The parameters vary across cases as tuples $(s,m,r,\\alpha,c)$:\n- Case $1$: $(0.2,\\,0.05,\\,0.01,\\,2.0,\\,0.01)$\n- Case $2$: $(0.2,\\,0.05,\\,0.5,\\,2.0,\\,0.01)$\n- Case $3$: $(0.2,\\,0.2,\\,0.01,\\,2.0,\\,0.01)$\n- Case $4$: $(0.2,\\,0.05,\\,0.01,\\,0.1,\\,0.01)$\n\nOutput specification:\n- For each of the above four cases, compute a boolean indicating reinforcement success as defined. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[True,False,True,False]\") in the same order as the test suite cases.\n\nAngle units and physical units are not applicable to this problem. All numeric outputs must be booleans; no unit conversion is required.", "solution": "The problem statement poses a well-defined task in theoretical population genetics. It is scientifically grounded, internally consistent, and specified with sufficient detail to permit a unique numerical solution. I will therefore proceed with a formal derivation of the model's recursion equations, followed by the implementation.\n\nThe model describes the evolution of a two-locus, two-allele system in a two-deme population. The state of the system at any given generation $t$ is fully specified by the frequencies of the $10$ possible diplotypes in each of the two demes. Let $X_{d,k}(t)$ be the frequency of diplotype $k$ in deme $d \\in \\{1,2\\}$ at the beginning of generation $t$ (i.e., among adults). The haplotypes are enumerated as $0: AP$, $1: Ap$, $2: aP$, $3: ap$. The $10$ unordered diplotypes $(i,j)$ with $i \\le j$ are indexed by $k \\in \\{0, \\dots, 9\\}$.\n\nThe transition from generation $t$ to $t+1$ follows a sequence of deterministic steps: gamete production, mating, viability selection, and migration. We will formulate the recursion for each step. For clarity, we will describe the process for a single deme, omitting the index $d$ where context allows.\n\n**Initialization (Generation $t=0$)**\nThe system is initialized in Hardy-Weinberg and linkage equilibrium. The initial allele frequencies for the trait allele $A$ are $p_A^{(1)}(0) = 0.9$ and $p_A^{(2)}(0) = 0.1$. The initial preference allele frequency is $p_P(0) = 10^{-3}$ in both demes.\nThe initial haplotype frequencies $f_{d,i}(0)$ in deme $d$ are products of allele frequencies:\n$$ f_{d,0}(0) = p_A^{(d)}(0) p_P(0) \\quad (AP) $$\n$$ f_{d,1}(0) = p_A^{(d)}(0) (1-p_P(0)) \\quad (Ap) $$\n$$ f_{d,2}(0) = (1-p_A^{(d)}(0)) p_P(0) \\quad (aP) $$\n$$ f_{d,3}(0) = (1-p_A^{(d)}(0)) (1-p_P(0)) \\quad (ap) $$\nThe initial diplotype frequencies $X_{d,k}(0)$ are given by Hardy-Weinberg proportions. For a diplotype corresponding to the pair of haplotypes $(i,j)$:\n$$ X_{d,(i,j)}(0) = \\begin{cases} (f_{d,i}(0))^2 & \\text{if } i=j \\\\ 2 f_{d,i}(0) f_{d,j}(0) & \\text{if } i \\neq j \\end{cases} $$\n\n**The Life Cycle Recursion: $X(t) \\to X(t+1)$**\n\n**Step 1: Gamete Production (Meiosis)**\nFrom the adult diplotype frequencies $X_k(t)$, we determine the gamete pool composition. Let $\\Gamma_{k \\to i}(r)$ be the probability that a diplotype $k$ produces a gamete of haplotype $i$, with recombination rate $r$. The frequency of haplotype $i$ in the gamete pool, $g_i(t)$, is:\n$$ g_i(t) = \\sum_{k=0}^{9} X_k(t) \\Gamma_{k \\to i}(r) $$\nThe probabilities $\\Gamma_{k \\to i}(r)$ depend on whether the diplotype is a double heterozygote. For diplotype $(j,l)$:\n- If $j=l$, $\\Gamma_{(j,j) \\to i}(r) = \\delta_{ij}$.\n- If $(j,l)$ is a single heterozygote, $\\Gamma_{(j,l) \\to i}(r) = \\frac{1}{2}(\\delta_{ij} + \\delta_{il})$.\n- For the coupling double heterozygote $(0,3)$, $\\Gamma_{(0,3) \\to 0}(r) = \\Gamma_{(0,3) \\to 3}(r) = \\frac{1-r}{2}$ and $\\Gamma_{(0,3) \\to 1}(r) = \\Gamma_{(0,3) \\to 2}(r) = \\frac{r}{2}$.\n- For the repulsion double heterozygote $(1,2)$, $\\Gamma_{(1,2) \\to 1}(r) = \\Gamma_{(1,2) \\to 2}(r) = \\frac{1-r}{2}$ and $\\Gamma_{(1,2) \\to 0}(r) = \\Gamma_{(1,2) \\to 3}(r) = \\frac{r}{2}$.\n\nThis gamete pool $g_i$ serves as the male gamete pool for mating.\n\n**Step 2: Mating and Zygote Formation**\nThis is the most complex step. Females are partitioned into three groups:\n1.  $G_{rand}$: Females with genotype $pp$ (diplotypes formed from haplotypes $1$ and $3$). They mate randomly.\n2.  $G_{pref,A}$: Females with at least one $P$ allele and T-phenotype $A$ (at least one $A$ allele). They prefer male gametes with an $A$ allele.\n3.  $G_{pref,a}$: Females with at least one $P$ allele and T-phenotype $a$ (genotype $aa$). They prefer male gametes with an $a$ allele.\n\nFor each group $\\mathcal{G} \\in \\{G_{rand}, G_{pref,A}, G_{pref,a}\\}$, we compute its frequency $F_{\\mathcal{G}} = \\sum_{k \\in \\mathcal{G}} X_k(t)$ and its female gamete production frequencies $g_i^{(\\mathcal{G}, \\text{fem})} = \\frac{1}{F_{\\mathcal{G}}} \\sum_{k \\in \\mathcal{G}} X_k(t) \\Gamma_{k \\to i}(r)$.\n\nThe effective male gamete frequencies perceived by each female group are:\n- For $G_{rand}$ females: $g_i^{(\\text{male, rand})} = g_i$.\n- For $G_{pref,A}$ females, male gametes with $A$ (haplotypes $0,1$) are preferred by factor $1+\\alpha$. The normalization constant is $W_A = (g_0+g_1)(1+\\alpha) + (g_2+g_3)$.\n  $$ g_i^{(\\text{male, prefA})} = \\begin{cases} g_i(1+\\alpha)/W_A & \\text{if } i \\in \\{0,1\\} \\\\ g_i/W_A & \\text{if } i \\in \\{2,3\\} \\end{cases} $$\n- For $G_{pref,a}$ females, male gametes with $a$ (haplotypes $2,3$) are preferred. The normalization constant is $W_a = (g_0+g_1) + (g_2+g_3)(1+\\alpha)$.\n  $$ g_i^{(\\text{male, prefa})} = \\begin{cases} g_i/W_a & \\text{if } i \\in \\{0,1\\} \\\\ g_i(1+\\alpha)/W_a & \\text{if } i \\in \\{2,3\\} \\end{cases} $$\n\nThe frequency of zygote $(i,j)$ formed by a female group $\\mathcal{G}$ is $Z_{ij}^{(\\mathcal{G})} = g_i^{(\\mathcal{G}, \\text{fem})} g_j^{(\\mathcal{G}, \\text{male})} + g_j^{(\\mathcal{G}, \\text{fem})} g_i^{(\\mathcal{G}, \\text{male})}$ for $i \\ne j$, and $Z_{ii}^{(\\mathcal{G})} = g_i^{(\\mathcal{G}, \\text{fem})} g_i^{(\\mathcal{G}, \\text{male})}$ for $i=j$.\n\nThe total unnormalized frequency of zygote diplotype $k$ corresponding to $(i,j)$ is the sum of contributions from all female groups, accounting for the direct cost $c$ on preference:\n$$ Z'_k = F_{rand} Z_{ij}^{(G_{rand})} + (1-c)F_{pref,A} Z_{ij}^{(G_{pref,A})} + (1-c)F_{pref,a} Z_{ij}^{(G_{pref,a})} $$\nThese frequencies are then normalized to sum to $1$: $Z_k = Z'_k / \\sum_j Z'_j$. This gives the vector of zygote frequencies before selection.\n\n**Step 3: Viability Selection**\nSelection acts on zygotes based on their T-locus genotype. Let $w_k^{(d)}$ be the fitness of diplotype $k$ in deme $d$.\n- In deme $1$: $w(\\text{AA})=1$, $w(\\text{Aa})=1-hs$, $w(\\text{aa})=1-s$.\n- In deme $2$: $w(\\text{aa})=1$, $w(\\text{Aa})=1-hs$, $w(\\text{AA})=1-s$.\nThe frequency of each diplotype $k$ after selection is $Z''_k = Z_k w_k^{(d)}$. These are renormalized to yield the post-selection, pre-migration juvenile frequencies, $X'_{d,k}$:\n$$ X'_{d,k} = \\frac{Z''_k}{\\sum_j Z''_j} $$\n\n**Step 4: Migration**\nSymmetric migration at rate $m$ occurs between the two demes. The adult frequencies for the next generation $t+1$ are:\n$$ X_{1,k}(t+1) = (1-m)X'_{1,k} + m X'_{2,k} $$\n$$ X_{2,k}(t+1) = (1-m)X'_{2,k} + m X'_{1,k} $$\nThis completes the recursion for one generation.\n\n**Evaluation of Reinforcement**\nThe simulation is run for $G=800$ generations. At each generation, we calculate two quantities for each deme $d$:\n1.  The frequency of the preference allele, $p_P^{(d)}$, is calculated from the adult diplotype frequencies $X_{d,k}(t+1)$. A diplotype $(i,j)$ contributes $0$, $0.5$, or $1$ to the allele count depending on whether $0$, $1$, or $2$ of its constituent haplotypes are of type $P$ (i.e., $0$ or $2$).\n2.  The linkage disequilibrium, $L_{\\text{local}}$. First, calculate the male gamete frequencies $g_{d,i}$ from the adult frequencies $X_{d,k}(t+1)$. Then, the gametic linkage disequilibrium is $D_d = g_{d,0}g_{d,3} - g_{d,1}g_{d,2}$. The measure of local association is $L_{\\text{local}}^{(1)} = D_1$ and $L_{\\text{local}}^{(2)} = -D_2$.\n\nReinforcement is successful if, at generation $G=800$:\n1.  $p_P^{(1)}(G) \\ge \\theta$ and $p_P^{(2)}(G) \\ge \\theta$, where $\\theta=0.8$.\n2.  The average of $L_{\\text{local}}^{(d)}$ over the last $K=100$ generations is strictly positive for both demes ($d=1,2$).\n\nThe provided program implements this full recursion and evaluation criterion.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print results.\n    \"\"\"\n    # Test cases: (s, m, r, alpha, c)\n    test_cases = [\n        (0.2, 0.05, 0.01, 2.0, 0.01),\n        (0.2, 0.05, 0.5, 2.0, 0.01),\n        (0.2, 0.2, 0.01, 2.0, 0.01),\n        (0.2, 0.05, 0.01, 0.1, 0.01),\n    ]\n\n    h = 0.5\n    G = 800\n    K = 100\n    theta = 0.8\n    pP0 = 1e-3\n    pA0_d1 = 0.9\n    pA0_d2 = 0.1\n\n    results = []\n    for params in test_cases:\n        s, m, r, alpha, c = params\n        success = run_simulation(s, m, r, alpha, c, h, G, K, theta, pP0, pA0_d1, pA0_d2)\n        results.append(success)\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation(s, m, r, alpha, c, h, G, K, theta, pP0, pA0_d1, pA0_d2):\n    \"\"\"\n    Runs the two-deme, two-locus simulation for a given set of parameters.\n    \"\"\"\n\n    # Haplotypes: 0:AP, 1:Ap, 2:aP, 3:ap\n    # Diplotypes: 10 unordered pairs of haplotypes\n    DIPLO_MAP = [(0, 0), (0, 1), (0, 2), (0, 3), (1, 1), (1, 2), (1, 3), (2, 2), (2, 3), (3, 3)]\n    DIPLO_INDICES = {pair: i for i, pair in enumerate(DIPLO_MAP)}\n\n    # Pre-calculate diplotype properties\n    P_CONTENTS = np.array([1.0, 0.5, 1.0, 0.5, 0.0, 0.5, 0.0, 1.0, 0.5, 0.0])\n    \n    # T-genotype: 0=AA, 1=Aa, 2=aa\n    T_GENOTYPES = np.zeros(10, dtype=int)\n    for k, (i, j) in enumerate(DIPLO_MAP):\n        a_alleles = ((i // 2) % 2) + ((j // 2) % 2) # 0 for A, 1 for a; so AP/Ap is 0, aP/ap is 1. (0+0, 0+1, 1+1)\n        T_GENOTYPES[k] = a_alleles\n\n    w1 = np.array([1.0, 1.0 - h * s, 1.0 - s])\n    w2 = np.array([1.0 - s, 1.0 - h * s, 1.0])\n    W_sel = np.array([w1[T_GENOTYPES], w2[T_GENOTYPES]])\n\n    # Female group masks\n    has_A_mask = T_GENOTYPES  2\n    has_P_mask = P_CONTENTS > 0\n    \n    group_rand_mask = ~has_P_mask\n    group_prefA_mask = has_P_mask  has_A_mask\n    group_prefa_mask = has_P_mask  ~has_A_mask\n\n    # Gamete production matrices\n    # For a diplotype, gives vector of [g0, g1, g2, g3] produced\n    gamete_prod_matrix = np.zeros((10, 4))\n    for k, (i, j) in enumerate(DIPLO_MAP):\n        if k == DIPLO_INDICES[(0, 3)]: # AP/ap\n            gamete_prod_matrix[k, :] = [(1-r)/2, r/2, r/2, (1-r)/2]\n        elif k == DIPLO_INDICES[(1, 2)]: # Ap/aP\n            gamete_prod_matrix[k, :] = [r/2, (1-r)/2, (1-r)/2, r/2]\n        else:\n            if i == j:\n                gamete_prod_matrix[k, i] = 1.0\n            else:\n                gamete_prod_matrix[k, i] = 0.5\n                gamete_prod_matrix[k, j] = 0.5\n\n    # Initialization\n    X = np.zeros((2, 10))\n    pA0s = [pA0_d1, pA0_d2]\n    for d in range(2):\n        pA0 = pA0s[d]\n        f_hap = np.array([\n            pA0 * pP0,            # AP\n            pA0 * (1 - pP0),      # Ap\n            (1 - pA0) * pP0,    # aP\n            (1 - pA0) * (1 - pP0) # ap\n        ])\n        for k, (i, j) in enumerate(DIPLO_MAP):\n            if i == j:\n                X[d, k] = f_hap[i] ** 2\n            else:\n                X[d, k] = 2 * f_hap[i] * f_hap[j]\n\n    # Track L_local\n    L_local_history = np.zeros((G, 2))\n\n    # Main simulation loop\n    for t in range(G):\n        X_post_selection = np.zeros((2, 10))\n        \n        # --- Life cycle in each deme ---\n        for d in range(2):\n            Xd = X[d, :]\n            \n            # 1. Gamete production\n            g_male = Xd @ gamete_prod_matrix\n\n            # 2. Mating and zygote formation\n            Z_prime = np.zeros(10)\n\n            # Group 1: Random mating (pp females)\n            F_rand = np.sum(Xd[group_rand_mask])\n            if F_rand > 0:\n                g_fem_rand = (Xd[group_rand_mask] @ gamete_prod_matrix[group_rand_mask, :]) / F_rand\n                Z_rand = np.outer(g_fem_rand, g_male)\n                Z_prime_rand = np.zeros(10)\n                for k, (i, j) in enumerate(DIPLO_MAP):\n                    Z_prime_rand[k] = Z_rand[i, j] + Z_rand[j, i] if i != j else Z_rand[i, i]\n                Z_prime += F_rand * Z_prime_rand\n\n            # Group 2: Preferential mating, phenotype A\n            F_prefA = np.sum(Xd[group_prefA_mask])\n            if F_prefA > 0:\n                g_fem_prefA = (Xd[group_prefA_mask] @ gamete_prod_matrix[group_prefA_mask, :]) / F_prefA\n                \n                g_match_A = g_male[0] + g_male[1]\n                g_nonmatch_A = g_male[2] + g_male[3]\n                W_A = g_match_A * (1 + alpha) + g_nonmatch_A\n                if W_A > 0:\n                    g_eff_A = np.array([\n                        g_male[0]*(1+alpha)/W_A, g_male[1]*(1+alpha)/W_A,\n                        g_male[2]/W_A, g_male[3]/W_A\n                    ])\n                    Z_A = np.outer(g_fem_prefA, g_eff_A)\n                    Z_prime_A = np.zeros(10)\n                    for k, (i,j) in enumerate(DIPLO_MAP):\n                       Z_prime_A[k] = Z_A[i,j] + Z_A[j,i] if i != j else Z_A[i,i]\n                    Z_prime += (1-c) * F_prefA * Z_prime_A\n\n            # Group 3: Preferential mating, phenotype a\n            F_prefa = np.sum(Xd[group_prefa_mask])\n            if F_prefa > 0:\n                g_fem_prefa = (Xd[group_prefa_mask] @ gamete_prod_matrix[group_prefa_mask, :]) / F_prefa\n                \n                g_match_a = g_male[2] + g_male[3]\n                g_nonmatch_a = g_male[0] + g_male[1]\n                W_a = g_match_a * (1 + alpha) + g_nonmatch_a\n                if W_a > 0:\n                    g_eff_a = np.array([\n                        g_male[0]/W_a, g_male[1]/W_a,\n                        g_male[2]*(1+alpha)/W_a, g_male[3]*(1+alpha)/W_a\n                    ])\n                    Z_a = np.outer(g_fem_prefa, g_eff_a)\n                    Z_prime_a = np.zeros(10)\n                    for k, (i,j) in enumerate(DIPLO_MAP):\n                       Z_prime_a[k] = Z_a[i,j] + Z_a[j,i] if i != j else Z_a[i,i]\n                    Z_prime += (1-c) * F_prefa * Z_prime_a\n\n            Z_sum = np.sum(Z_prime)\n            Z = Z_prime / Z_sum if Z_sum > 0 else Z_prime\n\n            # 3. Viability selection\n            Z_post_sel = Z * W_sel[d, :]\n            Z_post_sel_sum = np.sum(Z_post_sel)\n            X_prime_d = Z_post_sel / Z_post_sel_sum if Z_post_sel_sum > 0 else Z_post_sel\n            X_post_selection[d, :] = X_prime_d\n\n        # 4. Migration\n        X_new = np.zeros((2, 10))\n        X_new[0, :] = (1 - m) * X_post_selection[0, :] + m * X_post_selection[1, :]\n        X_new[1, :] = (1 - m) * X_post_selection[1, :] + m * X_post_selection[0, :]\n        X = X_new\n\n        # Calculate and store L_local\n        for d in range(2):\n            gametes_adult = X[d, :] @ gamete_prod_matrix\n            D = gametes_adult[0] * gametes_adult[3] - gametes_adult[1] * gametes_adult[2]\n            L_local_history[t, d] = D if d == 0 else -D\n\n    # Evaluate success criterion\n    pP_d1 = np.sum(X[0, :] * P_CONTENTS)\n    pP_d2 = np.sum(X[1, :] * P_CONTENTS)\n    \n    pP_success = pP_d1 >= theta and pP_d2 >= theta\n    \n    L_local_avg_d1 = np.mean(L_local_history[-K:, 0])\n    L_local_avg_d2 = np.mean(L_local_history[-K:, 1])\n    \n    L_local_success = L_local_avg_d1 > 0 and L_local_avg_d2 > 0\n\n    return pP_success and L_local_success\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "2746132"}]}