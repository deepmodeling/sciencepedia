{"hands_on_practices": [{"introduction": "To study the evolution of species barriers, we must first be able to measure them. This exercise introduces the standard quantitative framework for calculating the strength of reproductive isolation ($RI$) from experimental cross data. By comparing the success of heterospecific crosses to a conspecific baseline at successive life stages, you will learn how to calculate both stage-specific isolation components and the total cumulative isolation, illustrating the powerful multiplicative nature of sequential barriers [@problem_id:2839957].", "problem": "A comparative crossing experiment quantifies the strength of prezygotic and postzygotic reproductive barriers between two species relative to a conspecific baseline. Use the following foundational definitions.\n\n1. Stage-specific reproductive isolation (Reproductive Isolation, RI) at a given stage is defined as the proportional reduction in the heterospecific transition probability relative to the conspecific baseline transition probability at that same stage. If $p_{\\mathrm{H},i}$ is the heterospecific probability of progressing through stage $i$ (conditional on having reached stage $i$) and $p_{\\mathrm{C},i}$ is the corresponding conspecific baseline probability, then the isolation component at stage $i$ is $I_i = 1 - \\dfrac{p_{\\mathrm{H},i}}{p_{\\mathrm{C},i}}$.\n2. The cumulative reproductive isolation across stages is defined multiplicatively as $I_{\\mathrm{total}} = 1 - \\prod_{i} (1 - I_i)$, which is equivalent to one minus the product of the heterospecific-to-conspecific transition ratios across all stages.\n\nYou are provided with the following counts from standardized assays:\n\n- Heterospecific (interspecific) series: mating attempts $100$, copulations $60$, fertilizations $10$, viable offspring $4$.\n- Conspecific baseline series: mating attempts $100$, copulations $95$, fertilizations $90$, viable offspring $85$.\n\nDefine four stages and compute their isolation components using the above framework:\n- Mating (encounter/opportunity): from baseline opportunity to mating attempts.\n- Copulation (premating behavioral/mechanical): from attempts to copulations.\n- Gametic (postmating prezygotic): from copulations to fertilizations.\n- Intrinsic viability (postzygotic): from fertilizations to viable offspring.\n\nThen compute the cumulative isolation $I_{\\mathrm{total}}$ using the multiplicative framework.\n\nReport only the cumulative isolation $I_{\\mathrm{total}}$ as a unitless decimal rounded to four significant figures.", "solution": "The problem statement is scientifically sound, logically consistent, and provides sufficient information for a unique solution. The framework for quantifying reproductive isolation ($RI$) is standard in the field of evolutionary genetics. We shall proceed with the calculation.\n\nThe problem defines four discrete stages in the reproductive process and requires the calculation of stage-specific and cumulative reproductive isolation. Let subscript $H$ denote the heterospecific cross and $C$ denote the conspecific cross. The count data for each stage transition is as follows:\n\n- Heterospecific series:\n  - Initial mating attempts: $N_{\\mathrm{attempts, H}} = 100$\n  - Copulations: $N_{\\mathrm{copulations, H}} = 60$\n  - Fertilizations: $N_{\\mathrm{fertilizations, H}} = 10$\n  - Viable offspring: $N_{\\mathrm{offspring, H}} = 4$\n\n- Conspecific series:\n  - Initial mating attempts: $N_{\\mathrm{attempts, C}} = 100$\n  - Copulations: $N_{\\mathrm{copulations, C}} = 95$\n  - Fertilizations: $N_{\\mathrm{fertilizations, C}} = 90$\n  - Viable offspring: $N_{\\mathrm{offspring, C}} = 85$\n\nThe transition probability for a given stage $i$, $p_i$, is the ratio of the number of individuals successfully completing the stage to the number of individuals entering the stage.\n\nThe four stages are defined as:\n1.  **Mating ($I_1$)**: From baseline opportunity to mating attempts.\n2.  **Copulation ($I_2$)**: From attempts to copulations.\n3.  **Gametic ($I_3$)**: From copulations to fertilizations.\n4.  **Intrinsic viability ($I_4$)**: From fertilizations to viable offspring.\n\nWe first calculate the conditional transition probabilities ($p_{\\mathrm{H},i}$ and $p_{\\mathrm{C},i}$) for each stage $i$.\n\n**Stage 1: Mating**\nThe problem defines this stage as the transition from a \"baseline opportunity\" to \"mating attempts\". The number of mating attempts for both series is given as $100$. Let the unstated number of baseline opportunities be $N_{opp}$. As this initial condition is identical for both experimental series, the probabilities are $p_{\\mathrm{H},1} = \\frac{100}{N_{opp}}$ and $p_{\\mathrm{C},1} = \\frac{100}{N_{opp}}$. The ratio $\\frac{p_{\\mathrm{H},1}}{p_{\\mathrm{C},1}} = 1$. The isolation component is $I_1 = 1 - \\frac{p_{\\mathrm{H},1}}{p_{\\mathrm{C},1}} = 1 - 1 = 0$. This indicates no isolation at this stage, as expected from a controlled experimental design.\n\n**Stage 2: Copulation**\nThis is the probability of copulation, given a mating attempt.\n$$ p_{\\mathrm{H},2} = \\frac{N_{\\mathrm{copulations, H}}}{N_{\\mathrm{attempts, H}}} = \\frac{60}{100} = 0.6 $$\n$$ p_{\\mathrm{C},2} = \\frac{N_{\\mathrm{copulations, C}}}{N_{\\mathrm{attempts, C}}} = \\frac{95}{100} = 0.95 $$\n\n**Stage 3: Gametic**\nThis is the probability of fertilization, given a copulation.\n$$ p_{\\mathrm{H},3} = \\frac{N_{\\mathrm{fertilizations, H}}}{N_{\\mathrm{copulations, H}}} = \\frac{10}{60} = \\frac{1}{6} $$\n$$ p_{\\mathrm{C},3} = \\frac{N_{\\mathrm{fertilizations, C}}}{N_{\\mathrm{copulations, C}}} = \\frac{90}{95} = \\frac{18}{19} $$\n\n**Stage 4: Intrinsic Viability**\nThis is the probability of producing a viable offspring, given a fertilization.\n$$ p_{\\mathrm{H},4} = \\frac{N_{\\mathrm{offspring, H}}}{N_{\\mathrm{fertilizations, H}}} = \\frac{4}{10} = 0.4 $$\n$$ p_{\\mathrm{C},4} = \\frac{N_{\\mathrm{offspring, C}}}{N_{\\mathrm{fertilizations, C}}} = \\frac{85}{90} = \\frac{17}{18} $$\n\nThe cumulative reproductive isolation, $I_{\\mathrm{total}}$, is defined as:\n$$ I_{\\mathrm{total}} = 1 - \\prod_{i=1}^{4} (1 - I_i) $$\nwhere $I_i = 1 - \\frac{p_{\\mathrm{H},i}}{p_{\\mathrm{C},i}}$. This means $(1 - I_i) = \\frac{p_{\\mathrm{H},i}}{p_{\\mathrm{C},i}}$.\nTherefore, the formula for cumulative isolation can be expressed as:\n$$ I_{\\mathrm{total}} = 1 - \\left( \\frac{p_{\\mathrm{H},1}}{p_{\\mathrm{C},1}} \\times \\frac{p_{\\mathrm{H},2}}{p_{\\mathrm{C},2}} \\times \\frac{p_{\\mathrm{H},3}}{p_{\\mathrm{C},3}} \\times \\frac{p_{\\mathrm{H},4}}{p_{\\mathrm{C},4}} \\right) $$\nThe product of the ratios of conditional probabilities is equivalent to the ratio of the total probabilities of success across all stages. Let $P_H$ and $P_C$ be the total probabilities of producing a viable offspring from a baseline opportunity.\n$$ P_{\\mathrm{H}} = p_{\\mathrm{H},1} \\times p_{\\mathrm{H},2} \\times p_{\\mathrm{H},3} \\times p_{\\mathrm{H},4} = \\frac{100}{N_{opp}} \\times \\frac{60}{100} \\times \\frac{10}{60} \\times \\frac{4}{10} = \\frac{4}{N_{opp}} $$\n$$ P_{\\mathrm{C}} = p_{\\mathrm{C},1} \\times p_{\\mathrm{C},2} \\times p_{\\mathrm{C},3} \\times p_{\\mathrm{C},4} = \\frac{100}{N_{opp}} \\times \\frac{95}{100} \\times \\frac{90}{95} \\times \\frac{85}{90} = \\frac{85}{N_{opp}} $$\nThe product term in the equation for $I_{\\mathrm{total}}$ simplifies to:\n$$ \\prod_{i=1}^{4} (1 - I_i) = \\frac{P_H}{P_C} = \\frac{4/N_{opp}}{85/N_{opp}} = \\frac{4}{85} $$\nThis result can also be obtained by simply taking the ratio of the final number of viable offspring, since the initial number of opportunities was the same for both series.\n\nNow we compute the final value for $I_{\\mathrm{total}}$:\n$$ I_{\\mathrm{total}} = 1 - \\frac{4}{85} = \\frac{85 - 4}{85} = \\frac{81}{85} $$\nConverting this fraction to a decimal gives:\n$$ I_{\\mathrm{total}} = 0.952941176... $$\nThe problem requires the answer to be rounded to four significant figures. The fifth significant figure is $4$, so we do not round up the fourth digit.\n$$ I_{\\mathrm{total}} \\approx 0.9529 $$\nThis value represents a $95.29\\%$ reduction in reproductive success for the heterospecific cross relative to the conspecific baseline.", "answer": "$$\\boxed{0.9529}$$", "id": "2839957"}, {"introduction": "Once postzygotic isolation is quantified, the next step is to understand its genetic architecture. This practice explores the classic Dobzhansky-Muller model, the cornerstone theory for the evolution of hybrid incompatibilities. By deriving the expected fitness consequences of a recessive-recessive genetic incompatibility across different hybrid generations ($F_1$, $F_2$, and backcrosses), you will gain a deep, mechanistic understanding of how negative epistatic interactions between loci can build up in allopatry and cause postzygotic isolation upon secondary contact [@problem_id:2733099].", "problem": "Consider a diploid organism with two biallelic loci, denoted by alleles $A/a$ and $B/b$. Two allopatric parental populations are fixed for different derived alleles at these loci: population $P_{1}$ is fixed for $A A b b$ and population $P_{2}$ is fixed for $a a B B$. Assume standard Mendelian meiosis, random mating where specified, and no viability selection other than a two-locus Dobzhansky–Muller incompatibility (DMI) that is recessive in its effect at both loci. By \"recessive–recessive DMI,\" we mean that the incompatibility reduces relative fitness by a fraction $s$ only in individuals that are homozygous for both derived alleles $A$ and $B$, i.e., genotype $A A B B$ has relative fitness $1 - s$, while all other genotypes have relative fitness $1$. The two loci reside on the same chromosome with recombination fraction $r \\in [0,1/2]$ between them. \n\nCross the parental populations to produce $F_{1}$ hybrids, then produce $F_{2}$ by random mating among $F_{1}$ individuals. Also produce two backcrosses by mating $F_{1}$ individuals to each parental population ($F_{1} \\times P_{1}$ and $F_{1} \\times P_{2}$). Under the assumptions above and ignoring all other evolutionary forces, derive the expected mean relative fitness for each of the four cross types: $F_{1}$, $F_{2}$, backcross to $P_{1}$, and backcross to $P_{2}$, as functions of $s$ and $r$. \n\nExpress your final answer as a single row matrix in the order $\\big(F_{1}, F_{2}, \\text{backcross to } P_{1}, \\text{backcross to } P_{2}\\big)$. Do not round. Use only the symbols $s$ and $r$ and rational numbers in your expressions.\n\nFinally, briefly interpret whether the pattern you derive is consistent with empirical expectations for recessive–recessive DMIs across these cross types, but do not include this interpretation in your final numerical answer.", "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the principles of population and evolutionary genetics, specifically the Dobzhansky–Muller model of postzygotic isolation. The problem is well-posed, objective, and self-contained, with all necessary parameters and conditions clearly defined. There are no contradictions, ambiguities, or factual unsoundness. Thus, a solution will be derived.\n\nThe objective is to find the expected mean relative fitness, $\\bar{w}$, for four types of crosses. The mean relative fitness of a population is given by the sum of the fitness of each genotype weighted by its frequency: $\\bar{w} = \\sum_{i} f_{i} w_{i}$.\nThe problem specifies a recessive-recessive Dobzhansky–Muller incompatibility (DMI), where only the genotype $A A B B$ has reduced relative fitness, $w_{AABB} = 1 - s$. All other genotypes have a relative fitness of $1$. The mean fitness can therefore be calculated as:\n$$ \\bar{w} = (1 - f(A A B B)) \\times 1 + f(A A B B) \\times (1 - s) = 1 - f(A A B B) + f(A A B B) - s \\cdot f(A A B B) $$\n$$ \\bar{w} = 1 - s \\cdot f(A A B B) $$\nThe problem thus reduces to finding the expected frequency of the $A A B B$ genotype, $f(A A B B)$, in each of the specified generations. The parental populations are $P_{1}$ with genotype $A A b b$ and $P_{2}$ with genotype $a a B B$.\n\nFirst, we consider the $F_{1}$ generation. This generation is produced by crossing the two parental populations: $P_{1}(A A b b) \\times P_{2}(a a B B)$. The $P_{1}$ parent produces only $A b$ gametes, and the $P_{2}$ parent produces only $a B$ gametes. Consequently, all individuals in the $F_{1}$ generation will have the genotype $A a B b$. The frequency of the $A A B B$ genotype is therefore $f_{F1}(A A B B) = 0$. The mean relative fitness of the $F_{1}$ generation is:\n$$ \\bar{w}_{F1} = 1 - s \\cdot f_{F1}(A A B B) = 1 - s \\cdot 0 = 1 $$\n\nSecond, we analyze the $F_{2}$ generation, produced by randomly mating $F_{1}$ individuals: $F_{1}(A a B b) \\times F_{1}(A a B b)$. The $F_{1}$ individuals are heterozygous at both loci with the alleles in repulsion phase (or trans), since their genotype is formed from $A b$ and $a B$ gametes. The chromosomal arrangement is thus $A b / a B$. The recombination fraction between the loci is $r$. An $F_{1}$ individual produces four types of gametes with the following frequencies:\n- Parental gametes: $f(A b) = \\frac{1-r}{2}$ and $f(a B) = \\frac{1-r}{2}$.\n- Recombinant gametes: $f(A B) = \\frac{r}{2}$ and $f(a b) = \\frac{r}{2}$.\nThe incompatible genotype $A A B B$ is formed by the fusion of two $A B$ gametes. Under random mating, the expected frequency of this genotype is the product of the gamete frequencies:\n$$ f_{F2}(A A B B) = f(A B) \\times f(A B) = \\left(\\frac{r}{2}\\right) \\left(\\frac{r}{2}\\right) = \\frac{r^{2}}{4} $$\nThe mean relative fitness of the $F_{2}$ generation is:\n$$ \\bar{w}_{F2} = 1 - s \\cdot f_{F2}(A A B B) = 1 - s \\frac{r^{2}}{4} $$\n\nThird, we examine the backcross to the $P_{1}$ parent (BC1), which is the cross $F_{1}(A a B b) \\times P_{1}(A A b b)$. To produce an offspring with the $A A B B$ genotype, it must inherit an $A B$ gamete from each parent. The $P_{1}$ parent has genotype $A A b b$ and can only produce $A b$ gametes. It cannot provide a $B$ allele. Therefore, it is impossible to form a $B B$ homozygote, and thus impossible to form the $A A B B$ genotype. The frequency of the $A A B B$ genotype is $f_{BC1}(A A B B) = 0$. The mean relative fitness is:\n$$ \\bar{w}_{BC1} = 1 - s \\cdot f_{BC1}(A A B B) = 1 - s \\cdot 0 = 1 $$\n\nFourth, we examine the backcross to the $P_{2}$ parent (BC2), which is the cross $F_{1}(A a B b) \\times P_{2}(a a B B)$. To produce an offspring with the $A A B B$ genotype, the offspring must be homozygous for the $A$ allele. This requires inheriting an $A$ allele from each parent. The $P_{2}$ parent has genotype $a a B B$ and can only produce $a B$ gametes. It cannot provide an $A$ allele. Therefore, it is impossible to form an $A A$ homozygote, and thus impossible to form the $A A B B$ genotype. The frequency of the $A A B B$ genotype is $f_{BC2}(A A B B) = 0$. The mean relative fitness is:\n$$ \\bar{w}_{BC2} = 1 - s \\cdot f_{BC2}(A A B B) = 1 - s \\cdot 0 = 1 $$\n\nIn summary, the expected mean relative fitness for the four crosses are $(\\bar{w}_{F1}, \\bar{w}_{F2}, \\bar{w}_{BC1}, \\bar{w}_{BC2})$.\n\nFinally, for the interpretation, the derived pattern of fitness—no reduction in the $F_{1}$ or backcross generations, but a reduction in the $F_{2}$—is the quintessential signature of a recessive-recessive DMI. The $F_{1}$ is shielded by heterozygosity. The backcrosses are shielded because each parental population is homozygous for an ancestral allele (at one of the two loci), which prevents the formation of the doubly derived homozygous genotype ($A A B B$). Fitness breakdown occurs only in the $F_{2}$ generation, where recombination can produce $A B$ gametes that can then combine to form the incompatible $A A B B$ genotype. The severity of this breakdown depends on the recombination rate $r$, being most severe for unlinked loci ($r=1/2$) and absent for completely linked loci ($r=0$). This theoretical pattern is the benchmark expectation for this type of genetic incompatibility and is consistent with empirical findings in speciation genetics.", "answer": "$$ \\boxed{ \\begin{pmatrix} 1  1 - \\frac{s r^{2}}{4}  1  1 \\end{pmatrix} } $$", "id": "2733099"}, {"introduction": "Moving from theoretical models to empirical discovery requires tools that can pinpoint the specific genetic changes causing isolation. This exercise simulates the analysis of modern RNA-sequencing data to dissect the evolution of gene regulation, a common source of hybrid problems. You will learn how to use allele-specific expression in hybrids to distinguish between cis- and trans-regulatory divergence, and to flag genes showing potential regulatory incompatibilities or hybrid misexpression, providing a direct link between molecular evolution and the phenotype of reproductive isolation [@problem_id:2733077].", "problem": "You are given simplified Ribonucleic Acid sequencing (RNA-seq) read count summaries for a set of loci, each measured in two parental species and as allele-specific counts in their first-generation hybrid. The goal is to classify regulatory divergence into cis-regulatory, trans-regulatory, or both, using allele-specific expression, and to flag potential regulatory incompatibilities that could contribute to reproductive isolation.\n\nFundamental base and assumptions:\n- Gene expression is regulated by both cis-acting elements linked to the gene and trans-acting factors such as diffusible transcription factors. In an F1 hybrid, the two alleles of a locus experience a shared trans environment; therefore, any consistent difference in their allele-specific expression within the hybrid reflects cis-regulatory divergence. Differences in total expression between parental species that are not recapitulated by allele-specific differences in the hybrid reflect trans-regulatory divergence.\n- Work on a logarithmic base-$2$ scale for ratios and differences to make fold changes additive. To avoid undefined ratios when any count is zero, add a pseudocount $p = 0.5$ to every count before any ratio or logarithm is taken.\n\nInput per test locus:\n- Parental totals: $E_1$ (species $1$), $E_2$ (species $2$).\n- Hybrid allele-specific counts: $H_1$ (reads from allele of species $1$), $H_2$ (reads from allele of species $2$).\n\nOperational thresholds:\n- Effect detection threshold $\\tau = 0.32$ on the log base-$2$ scale (approximately a $1.25$-fold change). Effects below $\\tau$ in magnitude are considered negligible.\n- Strong compensatory flag threshold $\\tau_c = 0.8$ on the log base-$2$ scale (approximately a $1.74$-fold change) for both cis and trans when they oppose each other.\n- Hybrid misexpression threshold $\\theta = 0.58$ on the log base-$2$ scale (approximately a $1.5$-fold deviation from the mid-parent).\n\nTasks to implement:\n- Derive on the log base-$2$ scale the interspecific expression difference between parents from $E_1$ and $E_2$, the within-hybrid allelic expression difference from $H_1$ and $H_2$, and infer the trans component as the amount of interspecific difference not explained by the within-hybrid allelic difference. Use the conceptual foundations stated above and the shared-trans environment property of the hybrid to motivate your decomposition.\n- Classify regulatory divergence per locus using these rules:\n  - If neither cis nor trans effects meet $\\tau$, output code $0$ (no detectable divergence).\n  - If only cis meets $\\tau$, output code $1$ (cis-only).\n  - If only trans meets $\\tau$, output code $2$ (trans-only).\n  - If both meet $\\tau$ and have the same sign, output code $3$ (both, reinforcing).\n  - If both meet $\\tau$ and have opposite signs, output code $4$ (both, compensatory).\n- Flag potential regulatory incompatibility per locus with a binary indicator $r \\in \\{0,1\\}$ using:\n  - Set $r = 1$ if both cis and trans meet $\\tau_c$ and have opposite signs (strong compensatory divergence), or if hybrid total expression deviates from the mid-parent value by at least $\\theta$ on the log base-$2$ scale.\n  - Otherwise set $r = 0$.\n- Definitions for hybrid total and mid-parent:\n  - Hybrid total $H_T = H_1 + H_2$.\n  - Mid-parent $M = (E_1 + E_2)/2$.\n\nTest suite:\nProvide outputs for the following loci, each as a tuple $(E_1,E_2,H_1,H_2)$ with integer counts:\n- Case $1$: $(200,100,120,60)$.\n- Case $2$: $(100,200,80,80)$.\n- Case $3$: $(400,100,150,50)$.\n- Case $4$: $(180,120,40,160)$.\n- Case $5$: $(100,100,50,50)$.\n- Case $6$: $(0,100,0,50)$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each result is a two-element list $[c,r]$ where $c$ is the classification code and $r$ is the incompatibility flag for the corresponding test case, in the same order as listed above. For example, the overall output must look like $[[c_1,r_1],[c_2,r_2],\\dots]$ with integer entries only.", "solution": "The problem requires the classification of regulatory divergence for a gene based on a quantitative analysis of its expression levels in two parental species and their F1 hybrid. The methodology is grounded in the established principles of gene regulation, which provide a formal framework for dissecting the genetic basis of expression differences. The entire analysis will be conducted on a logarithmic base-$2$ scale, as this correctly linearizes the multiplicative effects of regulatory elements and normalizes the distribution of fold-changes.\n\nFirst, the theoretical foundation must be established. The expression level of a gene, measured here by RNA-seq read counts, is determined by the combined effects of *cis*-acting regulatory elements (e.g., promoters, enhancers) physically linked to the gene's DNA sequence, and *trans*-acting regulatory factors (e.g., transcription factors) that are diffusible within the cell. We can model the expression level, $E$, as a product of the contributions from the cis-regulatory allele, $C$, and the trans-regulatory environment, $T$. For two species, species $1$ and species $2$, their respective expression levels, $E_1$ and $E_2$, are given by:\n$$E_1 = C_1 \\cdot T_1$$\n$$E_2 = C_2 \\cdot T_2$$\nIn a first-generation (F1) hybrid organism, the alleles from both parental species, denoted by their specific read counts $H_1$ and $H_2$, are co-expressed in a common cellular environment. This shared environment possesses a single, unified set of *trans*-acting factors, $T_H$. Therefore, the allele-specific expression levels in the hybrid are:\n$$H_1 = C_1 \\cdot T_H$$\n$$H_2 = C_2 \\cdot T_H$$\nThis shared *trans* environment in the hybrid is the critical feature that allows for the separation of *cis* and *trans* effects. To avoid singularities when count data is zero and to stabilize variance, a pseudocount $p=0.5$ is added to all raw counts ($E_1, E_2, H_1, H_2$) before any logarithmic transformation or ratio is computed. Let primed variables denote these pseudocount-adjusted values (e.g., $E'_1 = E_1 + p$).\n\nWe now derive the quantities representing the regulatory effects. All calculations are on a $\\log_2$ scale.\n\n1.  **Cis-regulatory divergence ($D_{cis}$)**: The difference in expression between the two alleles within the hybrid is due solely to differences in their linked *cis*-regulatory elements, as the *trans* environment $T_H$ is identical for both. The $\\log_2$-ratio of allele-specific expression in the hybrid thus isolates the *cis*-effect:\n    $$D_{cis} = \\log_2\\left(\\frac{H'_1}{H'_2}\\right) = \\log_2\\left(\\frac{C_1 \\cdot T_H}{C_2 \\cdot T_H}\\right) = \\log_2\\left(\\frac{C_1}{C_2}\\right)$$\n    The operational formula is:\n    $$D_{cis} = \\log_2\\left(\\frac{H_1 + p}{H_2 + p}\\right)$$\n\n2.  **Trans-regulatory divergence ($D_{trans}$)**: The total divergence in expression between the parental species, $D_{total}$, is the sum of *cis* and *trans* effects:\n    $$D_{total} = \\log_2\\left(\\frac{E'_1}{E'_2}\\right) = \\log_2\\left(\\frac{C_1 \\cdot T_1}{C_2 \\cdot T_2}\\right) = \\log_2\\left(\\frac{C_1}{C_2}\\right) + \\log_2\\left(\\frac{T_1}{T_2}\\right) = D_{cis} + \\log_2\\left(\\frac{T_1}{T_2}\\right)$$\n    The *trans*-regulatory divergence is defined as the difference between the species' *trans* environments, $\\log_2(T_1/T_2)$. By rearranging the above equation, we can infer this *trans*-effect as the portion of the total interspecific divergence not explained by the *cis*-effect:\n    $$D_{trans} = D_{total} - D_{cis} = \\log_2\\left(\\frac{E_1 + p}{E_2 + p}\\right) - \\log_2\\left(\\frac{H_1 + p}{H_2 + p}\\right)$$\n\nWith these definitions, we proceed to the algorithmic classification. For each locus, given as a tuple $(E_1, E_2, H_1, H_2)$, we perform the following steps:\n\nI. **Calculate Effects**: Compute $D_{cis}$ and $D_{trans}$ using the formulas above with pseudocount $p=0.5$.\n\nII. **Classify Divergence**: Compare the absolute magnitudes of $D_{cis}$ and $D_{trans}$ to the effect detection threshold $\\tau = 0.32$. A classification code $c$ is assigned based on the following logic:\n    - If $|D_{cis}|  \\tau$ and $|D_{trans}|  \\tau$, then $c=0$ (no significant divergence).\n    - If $|D_{cis}| \\ge \\tau$ and $|D_{trans}|  \\tau$, then $c=1$ (*cis*-only divergence).\n    - If $|D_{cis}|  \\tau$ and $|D_{trans}| \\ge \\tau$, then $c=2$ (*trans*-only divergence).\n    - If $|D_{cis}| \\ge \\tau$ and $|D_{trans}| \\ge \\tau$:\n        - If $D_{cis} \\cdot D_{trans} \\ge 0$, then $c=3$ (both effects, reinforcing).\n        - If $D_{cis} \\cdot D_{trans}  0$, then $c=4$ (both effects, compensatory).\n\nIII. **Flag Potential Incompatibility**: A binary flag $r \\in \\{0, 1\\}$ is set to $1$ if the locus shows signs of regulatory incompatibility, which can contribute to reproductive isolation. This flag is set based on two conditions:\n    1.  **Strong Compensatory Divergence**: This occurs when large-magnitude *cis* and *trans* effects evolve in opposing directions. Such a pattern can maintain conserved expression levels in parental species but lead to misexpression in hybrids where parental *cis* and *trans* elements are mismatched. The condition is met if $|D_{cis}| \\ge \\tau_c$ and $|D_{trans}| \\ge \\tau_c$ and their signs are opposite, where $\\tau_c=0.8$.\n    2.  **Hybrid Misexpression**: This is a direct observation of aberrant expression in the hybrid. It is quantified by comparing the total hybrid expression, $H_T = H_1 + H_2$, to the mid-parent expression level, $M = (E_1 + E_2) / 2$. The expression is considered misexpressed if the $\\log_2$-ratio deviates significantly from zero. The condition is met if $|\\log_2((H_T + p) / (M + p))| \\ge \\theta$, where $\\theta=0.58$.\n\nIf either of these conditions is met, the incompatibility flag is set to $r=1$; otherwise, it remains $r=0$. This procedure provides a systematic and biologically principled method for analyzing the evolution of gene regulation from allele-specific expression data.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes RNA-seq count data to classify regulatory divergence and flag potential\n    incompatibilities according to the problem specification.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (200, 100, 120, 60),  # Case 1\n        (100, 200, 80, 80),   # Case 2\n        (400, 100, 150, 50),  # Case 3\n        (180, 120, 40, 160),  # Case 4\n        (100, 100, 50, 50),   # Case 5\n        (0, 100, 0, 50),     # Case 6\n    ]\n\n    # Operational parameters\n    p = 0.5      # Pseudocount\n    tau = 0.32   # Effect detection threshold\n    tau_c = 0.8  # Strong compensatory flag threshold\n    theta = 0.58 # Hybrid misexpression threshold\n\n    results = []\n    for case in test_cases:\n        E1, E2, H1, H2 = case\n\n        # Add pseudocounts to all raw counts\n        E1_p = E1 + p\n        E2_p = E2 + p\n        H1_p = H1 + p\n        H2_p = H2 + p\n\n        # 1. Calculate cis- and trans-regulatory effects\n        # Cis-effect from allele-specific expression in hybrid\n        d_cis = np.log2(H1_p / H2_p)\n        \n        # Total effect from parental expression\n        d_total = np.log2(E1_p / E2_p)\n        \n        # Trans-effect is inferred\n        d_trans = d_total - d_cis\n\n        # 2. Classify regulatory divergence\n        abs_cis = abs(d_cis)\n        abs_trans = abs(d_trans)\n\n        cis_is_significant = abs_cis = tau\n        trans_is_significant = abs_trans = tau\n\n        c = -1 # Classification code\n        if not cis_is_significant and not trans_is_significant:\n            c = 0  # No detectable divergence\n        elif cis_is_significant and not trans_is_significant:\n            c = 1  # Cis-only\n        elif not cis_is_significant and trans_is_significant:\n            c = 2  # Trans-only\n        else:  # Both are significant\n            if d_cis * d_trans = 0:\n                c = 3  # Both, reinforcing\n            else:\n                c = 4  # Both, compensatory\n\n        # 3. Flag for potential regulatory incompatibility\n        r = 0  # Incompatibility flag\n\n        # Condition 1: Strong compensatory divergence\n        is_strong_compensatory = (\n            abs_cis = tau_c and\n            abs_trans = tau_c and\n            d_cis * d_trans  0\n        )\n\n        # Condition 2: Hybrid misexpression\n        HT = H1 + H2\n        M = (E1 + E2) / 2\n        \n        # Denominator M+p is always  0 for non-negative counts E1, E2 and p  0.\n        # Numerator HT+p is also always  0.\n        misexpression_index = np.log2((HT + p) / (M + p))\n        \n        is_misexpressed = abs(misexpression_index) = theta\n        \n        if is_strong_compensatory or is_misexpressed:\n            r = 1\n\n        results.append([c, r])\n\n    # Final print statement in the exact required format.\n    # The map converts each sublist [c,r] to its string representation.\n    # The outer join then puts them together with commas.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "2733077"}]}