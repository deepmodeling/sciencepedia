{"hands_on_practices": [{"introduction": "Modern phylogenetics employs a nested hierarchy of nucleotide substitution models, with the General Time Reversible (GTR) model serving as a comprehensive framework. Understanding how this general model can be simplified to more constrained models, like the Felsenstein 1981 (F81) model, is fundamental to model selection and interpretation. This exercise [@problem_id:1951098] challenges you to identify the precise parametric constraints that connect these two important models, reinforcing your understanding of their underlying assumptions.", "problem": "In the field of molecular evolution, various models are used to describe how nucleotide sequences change over time. The General Time Reversible (GTR) model is a highly parameterized model that provides a framework from which many simpler models can be derived. The GTR model is defined by two sets of parameters:\n1.  The equilibrium frequencies of the four nucleotides (A, C, G, T), denoted as $\\pi_A, \\pi_C, \\pi_G, \\pi_T$.\n2.  A set of six distinct relative rate parameters for substitutions between pairs of nucleotides: $r_{AC}$ (for A↔C), $r_{AG}$ (for A↔G), $r_{AT}$ (for A↔T), $r_{CG}$ (for C↔G), $r_{CT}$ (for C↔T), and $r_{GT}$ (for G↔T).\n\nThe Felsenstein 1981 (F81) model is a less complex model. It retains the parameterization for unequal base frequencies but simplifies the substitution process. Specifically, it assumes that the rate of substitution from any nucleotide *i* to any other nucleotide *j* depends only on the equilibrium frequency of the target nucleotide, $\\pi_j$, and not on the identity of the original nucleotide *i*.\n\nWhich of the following sets of constraints, when applied to the GTR model's parameters, results in the F81 model?\n\nA. The equilibrium base frequencies must all be equal: $\\pi_A = \\pi_C = \\pi_G = \\pi_T = 0.25$.\n\nB. All relative substitution rate parameters must be equal to one another: $r_{AC} = r_{AG} = r_{AT} = r_{CG} = r_{CT} = r_{GT}$.\n\nC. The rates for transitions ($r_{AG}, r_{CT}$) are equal to each other, and the rates for transversions ($r_{AC}, r_{AT}, r_{CG}, r_{GT}$) are equal to each other, but the transition rate may differ from the transversion rate.\n\nD. Both the equilibrium base frequencies and all relative substitution rates must be equal.\n\nE. All relative substitution rates related to transitions ($r_{AG}$ and $r_{CT}$) must be zero, while transversion rates can be non-zero.", "solution": "In the General Time Reversible (GTR) model, the instantaneous rate matrix has off-diagonal entries, for nucleotides $i \\neq j$, given by\n$$\nq_{ij} = r_{ij}\\,\\pi_{j},\n$$\nwhere $r_{ij} = r_{ji}$ are six symmetric relative rate parameters and $\\pi_{j}$ are the equilibrium frequencies. The diagonal terms satisfy\n$$\nq_{ii} = -\\sum_{j \\neq i} q_{ij}.\n$$\nThe Felsenstein 1981 (F81) model specifies that the substitution rate from nucleotide $i$ to nucleotide $j$ depends only on the target frequency $\\pi_{j}$ and not on $i$. Equivalently, there exists a single rate scalar $\\alpha$ such that, for all $i \\neq j$,\n$$\nq_{ij}^{\\mathrm{F81}} = \\alpha\\,\\pi_{j}.\n$$\nComparing this with the GTR parameterization $q_{ij} = r_{ij}\\,\\pi_{j}$, the F81 form is obtained precisely when all relative rates are equal to the same constant:\n$$\nr_{AC} = r_{AG} = r_{AT} = r_{CG} = r_{CT} = r_{GT} = \\alpha,\n$$\nup to an overall scaling that is typically fixed by a normalization (such as setting the expected rate to one). This constraint leaves the equilibrium frequencies $\\pi_{A}, \\pi_{C}, \\pi_{G}, \\pi_{T}$ unrestricted, as required by F81.\n\nTherefore, the set of constraints that reduces GTR to F81 is that all six relative substitution rate parameters are equal to one another, which corresponds to option B. Option A would force equal base frequencies and is not required by F81. Option C yields a transition/transversion distinction (HKY-like), not F81. Option D reduces further to the Jukes–Cantor case. Option E eliminates transitions and does not match F81.", "answer": "$$\\boxed{B}$$", "id": "1951098"}, {"introduction": "One of the most critical applications of substitution models is to correct for unobserved substitutions and estimate the true evolutionary distance between sequences. This practice [@problem_id:2739950] guides you through the foundational derivation of the Jukes-Cantor (JC69) distance estimator, starting from the model's rate matrix. By working through this derivation, you will bridge the gap between the abstract theory of Markov chains and a concrete, widely used tool for quantifying evolutionary divergence.", "problem": "Two homologous deoxyribonucleic acid (DNA) sequences of length $n$ evolved from a common ancestor under the Jukes–Cantor $1969$ (JC69) continuous-time Markov chain (CTMC) nucleotide substitution model. The JC69 generator (rate) matrix is $Q$ with off-diagonal entries $Q_{ij}=\\alpha$ for $i\\neq j$ and diagonal entries $Q_{ii}=-3\\alpha$, where $\\alpha0$ and the stationary distribution is uniform over the $4$ nucleotides. Assume sites evolve independently and identically and that the two lineages separating the sequences have identical substitution process parameters and are time-homogeneous.\n\nLet the total evolutionary path length between the two sequences be measured by the branch length $d$, defined as the expected number of substitutions per site accumulated along the combined path separating the two sequences. An empirical alignment yields an observed Hamming difference count $k$ out of $n$ sites, so the observed proportion of differences is $p=k/n$.\n\nStarting only from the CTMC definition and the JC69 generator $Q$ (and without using any pre-derived transition probability formulas), perform the following:\n\n- Derive the transition probability matrix $P(t)=\\exp(Qt)$ by diagonalizing $Q$ and use the semigroup property to express the probability that two homologous nucleotides sampled at the tips differ as a function of $d$.\n- Using a binomial sampling model for the site-pattern counts across $n$ sites, write the likelihood of $d$ given the observed $p$ and derive the maximum-likelihood estimator $\\hat{d}$ as an explicit function of $p$.\n- Determine the domain of $p$ for which $\\hat{d}$ is real-valued and finite, and characterize the boundary behavior.\n- Using a second-order Delta method about the true difference probability, obtain the leading-order (in $1/n$) finite-sample bias $\\operatorname{Bias}(\\hat{d})$ as a function of $d$ and $n$, and state its sign for $d0$.\n\nProvide only the analytical expression for the estimator $\\hat{d}$ as your final answer. Do not include any units. No rounding is required.", "solution": "The problem statement constitutes a well-posed and scientifically grounded exercise in theoretical molecular evolution. It contains all necessary information, is internally consistent, and addresses a fundamental concept: the estimation of evolutionary distance from sequence data under the Jukes-Cantor $1969$ model. We may therefore proceed with the derivation.\n\nThe Jukes-Cantor $1969$ (JC69) model is defined by the instantaneous rate matrix $Q$. For a state space of $4$ nucleotides $\\{A, C, G, T\\}$, the matrix $Q$ has elements $Q_{ij} = \\alpha$ for any distinct states $i, j$ and $Q_{ii} = -3\\alpha$. The parameter $\\alpha  0$ is the rate of substitution to any particular different nucleotide. The matrix $Q$ can be written as:\n$$\nQ = \\begin{pmatrix} -3\\alpha  \\alpha  \\alpha  \\alpha \\\\ \\alpha  -3\\alpha  \\alpha  \\alpha \\\\ \\alpha  \\alpha  -3\\alpha  \\alpha \\\\ \\alpha  \\alpha  \\alpha  -3\\alpha \\end{pmatrix}\n$$\nThis can be expressed compactly using the $4 \\times 4$ identity matrix $I$ and the $4 \\times 4$ matrix of all ones, $J$. Specifically, $Q = \\alpha J - 4\\alpha I = \\alpha(J - 4I)$.\n\nFirst, we derive the transition probability matrix $P(t) = \\exp(Qt)$. To do this, we diagonalize $Q$. The eigenvalues of $J$ are $4$ (with multiplicity $1$, corresponding to the eigenvector $\\mathbf{1} = (1, 1, 1, 1)^T$) and $0$ (with multiplicity $3$). The eigenvalues of $Q$ are therefore $\\lambda_1 = \\alpha(4 - 4) = 0$ and $\\lambda_2 = \\alpha(0 - 4) = -4\\alpha$ (with multiplicity $3$).\n\nSince $I$ and $J$ commute, we can write $\\exp(Qt) = \\exp(\\alpha Jt - 4\\alpha It) = \\exp(\\alpha Jt)\\exp(-4\\alpha It)$. The second term is simply $\\exp(-4\\alpha t)I$. For the first term, we use the Taylor series expansion of the matrix exponential. We note that $J^k = 4^{k-1}J$ for $k \\ge 1$.\n$$\n\\exp(\\alpha Jt) = I + \\sum_{k=1}^{\\infty} \\frac{(\\alpha t)^k J^k}{k!} = I + \\sum_{k=1}^{\\infty} \\frac{(\\alpha t)^k 4^{k-1} J}{k!} = I + \\frac{J}{4} \\sum_{k=1}^{\\infty} \\frac{(4\\alpha t)^k}{k!} = I + \\frac{J}{4}(\\exp(4\\alpha t) - 1)\n$$\nCombining the terms, we get the transition matrix $P(t)$:\n$$\nP(t) = \\left( I + \\frac{J}{4}(\\exp(4\\alpha t) - 1) \\right) \\exp(-4\\alpha t) = \\exp(-4\\alpha t)I + \\frac{1}{4}(1 - \\exp(-4\\alpha t))J\n$$\nFrom this expression, we can write the probabilities for any nucleotide to remain unchanged, $P_{ii}(t)$, or to change to a specific different nucleotide, $P_{ij}(t)$ for $i \\neq j$:\n$$\nP_{ii}(t) = \\exp(-4\\alpha t) + \\frac{1}{4}(1 - \\exp(-4\\alpha t)) = \\frac{1}{4} + \\frac{3}{4}\\exp(-4\\alpha t)\n$$\n$$\nP_{ij}(t) = \\frac{1}{4}(1 - \\exp(-4\\alpha t)) \\quad (i \\neq j)\n$$\n\nNext, we find the probability, $p_d$, that two homologous nucleotides are different at the tips of the two lineages. The lineages diverge from a common ancestor and each evolves for time $t$. The process is assumed to start from the stationary distribution $\\pi = (\\frac{1}{4}, \\frac{1}{4}, \\frac{1}{4}, \\frac{1}{4})^T$ at the root. By the independence of the two lineages conditional on the ancestral state, the probability of observing the same nucleotide $i$ at both tips is:\n$$\nP(\\text{same } i) = \\sum_{k=A,C,G,T} \\pi_k P_{ki}(t) P_{ki}(t) = \\frac{1}{4}\\sum_{k=A,C,G,T} (P_{ki}(t))^2\n$$\nDue to the symmetry of the JC69 model, this sum is independent of $i$. Let's compute it for some $i_0$:\n$$\n\\sum_{k} (P_{ki_0}(t))^2 = (P_{i_0 i_0}(t))^2 + 3(P_{j i_0}(t))^2 \\quad (j \\neq i_0)\n$$\nSubstituting the expressions for $P_{ii}(t)$ and $P_{ij}(t)$:\n$$\n\\sum_{k} (P_{ki_0}(t))^2 = \\left(\\frac{1}{4} + \\frac{3}{4}e^{-4\\alpha t}\\right)^2 + 3\\left(\\frac{1}{4} - \\frac{1}{4}e^{-4\\alpha t}\\right)^2 = \\frac{1}{16} \\left[ (1+6e^{-4\\alpha t}+9e^{-8\\alpha t}) + 3(1-2e^{-4\\alpha t}+e^{-8\\alpha t}) \\right]\n$$\n$$\n= \\frac{1}{16} [1+6e^{-4\\alpha t}+9e^{-8\\alpha t} + 3-6e^{-4\\alpha t}+3e^{-8\\alpha t}] = \\frac{1}{16}[4+12e^{-8\\alpha t}] = \\frac{1}{4}(1+3e^{-8\\alpha t})\n$$\nThe total probability of the two sites being identical is the sum over all four possible identical states:\n$$\nP(\\text{same}) = \\sum_{i=A,C,G,T} P(\\text{same } i) = 4 \\times \\left( \\frac{1}{4} \\cdot \\frac{1}{4}(1+3e^{-8\\alpha t}) \\right) = \\frac{1}{4}(1+3e^{-8\\alpha t})\n$$\nThe probability of the sites being different, $p_d$, is therefore:\n$$\np_d = 1 - P(\\text{same}) = 1 - \\frac{1}{4}(1+3e^{-8\\alpha t}) = \\frac{3}{4} - \\frac{3}{4}e^{-8\\alpha t} = \\frac{3}{4}(1 - \\exp(-8\\alpha t))\n$$\nThe evolutionary distance $d$ is defined as the expected number of substitutions per site along the combined path. The rate of substitution out of any state is $-Q_{ii} = 3\\alpha$. The expected number of substitutions along one branch of time $t$ is $3\\alpha t$. The total distance for two such branches is $d = 3\\alpha t + 3\\alpha t = 6\\alpha t$. From this, we have $\\alpha t = d/6$, so $8\\alpha t = 4d/3$. Substituting this into the expression for $p_d$:\n$$\np_d = f(d) = \\frac{3}{4}\\left(1 - \\exp\\left(-\\frac{4}{3}d\\right)\\right)\n$$\n\nNow we derive the maximum-likelihood estimator (MLE) for $d$. The number of observed differences, $k$, in an alignment of length $n$ is modeled as a binomial random variable, $k \\sim \\text{Binomial}(n, p_d)$. The likelihood is $L(d; k, n) \\propto p_d^k (1-p_d)^{n-k}$. The MLE for the binomial proportion parameter $p_d$ is the observed proportion of differences, $\\hat{p}_d = k/n = p$. By the invariance property of MLEs, the MLE for $d$, denoted $\\hat{d}$, is found by inverting the function $f(d)$ and evaluating it at $p$.\n$$\np = \\frac{3}{4}\\left(1 - \\exp\\left(-\\frac{4}{3}\\hat{d}\\right)\\right)\n$$\n$$\n\\frac{4}{3}p = 1 - \\exp\\left(-\\frac{4}{3}\\hat{d}\\right)\n$$\n$$\n\\exp\\left(-\\frac{4}{3}\\hat{d}\\right) = 1 - \\frac{4}{3}p\n$$\n$$\n-\\frac{4}{3}\\hat{d} = \\ln\\left(1 - \\frac{4}{3}p\\right)\n$$\n$$\n\\hat{d} = -\\frac{3}{4}\\ln\\left(1 - \\frac{4}{3}p\\right)\n$$\nThis expression is the required maximum-likelihood estimator for the Jukes-Cantor distance.\n\nThe estimator $\\hat{d}$ is real-valued and finite provided the argument of the logarithm is positive: $1 - \\frac{4}{3}p  0$, which implies $p  \\frac{3}{4}$. As the observed proportion $p$ is non-negative, the domain is $p \\in [0, \\frac{3}{4})$.\nAt the boundary $p \\to 0^+$, $\\hat{d} \\to -\\frac{3}{4}\\ln(1) = 0$.\nAt the boundary $p \\to (\\frac{3}{4})^-$, the argument of the logarithm approaches $0^+$, so $\\ln(\\cdot) \\to -\\infty$, and $\\hat{d} \\to +\\infty$. This indicates mutational saturation.\n\nFinally, we analyze the finite-sample bias using the second-order Delta method. Let $g(p) = \\hat{d}(p)$. The bias is approximately $\\text{Bias}(\\hat{d}) \\approx \\frac{1}{2} \\text{Var}(p) g''(p_d)$, where $p_d$ is the true probability of difference. The variance of the sample proportion $p$ is $\\text{Var}(p) = \\frac{p_d(1-p_d)}{n}$. The derivatives are:\n$$\ng'(p) = \\frac{1}{1 - \\frac{4}{3}p} \\quad \\text{and} \\quad g''(p) = \\frac{4}{3}\\left(1 - \\frac{4}{3}p\\right)^{-2}\n$$\nSince $p_d \\in [0, \\frac{3}{4})$, it is clear that $g''(p_d)  0$ for all valid $p_d$. The bias is then:\n$$\n\\operatorname{Bias}(\\hat{d}) \\approx \\frac{1}{2} \\frac{p_d(1-p_d)}{n} \\frac{4}{3} \\frac{1}{(1 - \\frac{4}{3}p_d)^2} = \\frac{2}{3n} \\frac{p_d(1-p_d)}{(1 - \\frac{4}{3}p_d)^2}\n$$\nFor any $d0$, we have $p_d \\in (0, \\frac{3}{4})$, which means $p_d  0$ and $1-p_d  0$. All terms in the expression are positive for any finite $n$. Therefore, the leading-order bias is positive for $d  0$, implying that the MLE $\\hat{d}$ tends to overestimate the true distance $d$ for finite sample sizes. This is a consequence of Jensen's inequality applied to the convex function $g(p)$.", "answer": "$$\\boxed{-\\frac{3}{4}\\ln\\left(1 - \\frac{4}{3}p\\right)}$$", "id": "2739950"}, {"introduction": "The engine of modern maximum likelihood phylogenetics is the ability to calculate the probability of observing sequence data given a specific tree and substitution model. This intensive calculation exercise [@problem_id:2739922] demystifies this process by having you manually apply Felsenstein's pruning algorithm to compute the likelihood for a single site on a four-taxon tree. This practice provides invaluable insight into the core computational step performed by phylogenetic software, connecting model parameters, branch lengths, and data in a tangible way.", "problem": "Consider a four-taxon phylogeny evolving under the Hasegawa–Kishino–Yano 1985 (HKY85) nucleotide substitution model. Assume a continuous-time, time-homogeneous Markov process with stationary base frequencies $\\pi_A=\\pi_C=\\pi_G=\\pi_T=0.25$ and transition/transversion rate ratio $\\kappa=3$. The instantaneous rate matrix $Q=(q_{ij})$ has off-diagonal entries $q_{ij}=\\mu\\,\\kappa\\,\\pi_j$ for purine–purine or pyrimidine–pyrimidine transitions and $q_{ij}=\\mu\\,\\pi_j$ for transversions, with the diagonal entries chosen so that each row sums to $0$. The overall rate scalar $\\mu$ is set so that the expected substitution rate under stationarity is $1$, and branch lengths are measured in expected substitutions per site.\n\nThe unrooted tree topology is $((1,2),(3,4))$. The pendant branch lengths are $t_1=0.3$ to taxon $1$, $t_2=0.4$ to taxon $2$, $t_3=0.2$ to taxon $3$, and $t_4=0.5$ to taxon $4$. The internal branch connecting the two internal nodes has length $t_5=0.1$. At the leaves, the observed site pattern is $1{:}\\,A$, $2{:}\\,G$, $3{:}\\,A$, $4{:}\\,G$.\n\nUsing the pruning algorithm of Felsenstein with a root placed at the midpoint of the internal branch (so that the two edges from the root to the internal nodes each have length $t_5/2$) and the stationary prior $\\pi$ at the root, compute the site likelihood under the HKY85 model for this single site. Your calculation must:\n- Start from the definition of the HKY85 $Q$ and its scaling constraint.\n- Use the implied transition probabilities along each branch as determined by $Q$.\n- Explicitly show the numerical values of the two internal-node partial likelihood vectors and the two rootward “messages” from those nodes before summation at the root.\n\nRound your final site likelihood to six significant figures. Express your final answer as a pure number with no units.", "solution": "The problem statement is critically evaluated and determined to be valid. It is scientifically grounded in the principles of molecular evolution, specifically the HKY85 model and Felsenstein's pruning algorithm. The problem is well-posed, with all necessary parameters, data, and constraints provided for a unique solution. The language is objective and precise.\n\nThe problem requires the calculation of the site likelihood for a given phylogenetic tree and observed nucleotide data. The process involves several steps: defining the rate matrix, calculating transition probabilities, and applying the pruning algorithm.\n\nFirst, we construct the instantaneous rate matrix $Q=(q_{ij})$ for the HKY85 model. The stationary base frequencies are uniform: $\\pi_A=\\pi_C=\\pi_G=\\pi_T=0.25$. The transition/transversion rate ratio is $\\kappa=3$. The off-diagonal entries are $q_{ij}=\\mu\\,\\kappa\\,\\pi_j$ for transitions (purine-purine or pyrimidine-pyrimidine) and $q_{ij}=\\mu\\,\\pi_j$ for transversions.\nThe rates of change are:\nTransition rate ($A \\leftrightarrow G$, $C \\leftrightarrow T$): $\\mu \\kappa \\pi_j = \\mu \\cdot 3 \\cdot 0.25 = 0.75\\mu$.\nTransversion rate (all others): $\\mu \\pi_j = \\mu \\cdot 0.25 = 0.25\\mu$.\nThe diagonal entries $q_{ii}$ are defined by the requirement that row sums are zero: $q_{ii} = -\\sum_{j\\neq i} q_{ij}$. For any base $i$, there is one transition and two transversions possible. For example, from $A$, there is a transition to $G$ and transversions to $C$ and $T$.\nSo, $q_{AA} = -(q_{AC}+q_{AG}+q_{AT}) = -(\\mu\\pi_C + \\mu\\kappa\\pi_G + \\mu\\pi_T) = -\\mu(0.25 + 3 \\cdot 0.25 + 0.25) = -1.25\\mu$.\nBy symmetry of the stationary frequencies, all diagonal elements are identical.\nThe rate scalar $\\mu$ is set such that the expected number of substitutions per site is $1$. This rate is calculated as $-\\sum_i \\pi_i q_{ii} = -\\sum_i 0.25(-1.25\\mu) = 4 \\cdot 0.25 \\cdot 1.25\\mu = 1.25\\mu$.\nSetting $1.25\\mu=1$ gives $\\mu = 1/1.25 = 0.8$.\nSubstituting $\\mu=0.8$ into the rates:\nTransition rate: $0.75 \\cdot 0.8 = 0.6$.\nTransversion rate: $0.25 \\cdot 0.8 = 0.2$.\nDiagonal rate: $-1.25 \\cdot 0.8 = -1$.\nThe scaled rate matrix $Q$, with bases ordered $(A, C, G, T)$, is:\n$$\nQ = \\begin{pmatrix} -1  0.2  0.6  0.2 \\\\ 0.2  -1  0.2  0.6 \\\\ 0.6  0.2  -1  0.2 \\\\ 0.2  0.6  0.2  -1 \\end{pmatrix}\n$$\nThe transition probability matrix for a branch of length $t$ is $P(t) = \\exp(Qt)$. For this specific form of $Q$ (K2P, a special case of HKY85), the probabilities can be calculated via spectral decomposition. The eigenvalues of $Q$ are $\\lambda_0=0$, $\\lambda_1=-0.8$, and $\\lambda_2=-1.6$ (with multiplicity $2$). The substitution probabilities are:\n$p_1(t) \\equiv P_{ii}(t) = 0.25 + 0.25 \\exp(-0.8 t) + 0.5 \\exp(-1.6 t)$ (no change)\n$p_s(t) \\equiv P_{ij}(t)_{\\text{transition}} = 0.25 + 0.25 \\exp(-0.8 t) - 0.5 \\exp(-1.6 t)$\n$p_v(t) \\equiv P_{ij}(t)_{\\text{transversion}} = 0.25 - 0.25 \\exp(-0.8 t)$\n\nThe pruning algorithm is performed on the rooted tree. The root $R$ is placed at the midpoint of the internal branch, creating two internal nodes, $N_5$ (ancestor of leaves $1, 2$) and $N_6$ (ancestor of leaves $3, 4$). The branch lengths are $t_{R,N_5} = t_{R,N_6} = t_5/2 = 0.05$. Other branch lengths are $t_1=0.3$, $t_2=0.4$, $t_3=0.2$, $t_4=0.5$. The observed data are $S_1=A, S_2=G, S_3=A, S_4=G$.\n\nThe partial likelihood vector at a node $k$, $L_k = (L_k(A), L_k(C), L_k(G), L_k(T))^T$, gives the probability of the observed data in the subtree subtended by $k$, conditional on the state at $k$.\nAt the leaves, $L_i(S) = \\delta_{S,S_i}$.\n$L_1=(1,0,0,0)^T$, $L_2=(0,0,1,0)^T$, $L_3=(1,0,0,0)^T$, $L_4=(0,0,1,0)^T$.\n\nThe partial likelihood vector at internal node $N_5$ is calculated from its children, leaves $1$ and $2$. For a state $S \\in \\{A,C,G,T\\}$ at $N_5$:\n$L_{N_5}(S) = (\\sum_{S_1} P_{SS_1}(t_1)L_1(S_1)) \\cdot (\\sum_{S_2} P_{SS_2}(t_2)L_2(S_2)) = P_{SA}(t_1=0.3) \\cdot P_{SG}(t_2=0.4)$.\nWe calculate the probabilities for $t=0.3$ and $t=0.4$:\n$p_1(0.3) \\approx 0.75605$, $p_s(0.3) \\approx 0.13726$, $p_v(0.3) \\approx 0.05334$\n$p_1(0.4) \\approx 0.69518$, $p_s(0.4) \\approx 0.16789$, $p_v(0.4) \\approx 0.06846$\n$L_{N_5}(A) = p_1(0.3) p_s(0.4) \\approx 0.12693$\n$L_{N_5}(C) = p_v(0.3) p_v(0.4) \\approx 0.00365$\n$L_{N_5}(G) = p_s(0.3) p_1(0.4) \\approx 0.09542$\n$L_{N_5}(T) = p_v(0.3) p_v(0.4) \\approx 0.00365$\nThus, the partial likelihood vector at node $N_5$ is $L_{N_5} \\approx (0.12693, 0.00365, 0.09542, 0.00365)^T$.\n\nSimilarly, for node $N_6$ with children leaves $3$ and $4$:\n$L_{N_6}(S) = P_{SA}(t_3=0.2) \\cdot P_{SG}(t_4=0.5)$.\nProbabilities for $t=0.2$ and $t=0.5$:\n$p_1(0.2) \\approx 0.82611$, $p_s(0.2) \\approx 0.09996$, $p_v(0.2) \\approx 0.03696$\n$p_1(0.5) \\approx 0.64224$, $p_s(0.5) \\approx 0.19292$, $p_v(0.5) \\approx 0.08242$\n$L_{N_6}(A) = p_1(0.2) p_s(0.5) \\approx 0.15936$\n$L_{N_6}(C) = p_v(0.2) p_v(0.5) \\approx 0.00305$\n$L_{N_6}(G) = p_s(0.2) p_1(0.5) \\approx 0.06420$\n$L_{N_6}(T) = p_v(0.2) p_v(0.5) \\approx 0.00305$\nThe partial likelihood vector at node $N_6$ is $L_{N_6} \\approx (0.15936, 0.00305, 0.06420, 0.00305)^T$.\n\nNext, we compute the \"messages\" from nodes $N_5$ and $N_6$ to the root $R$. The branch length is $t=0.05$.\nThe message from $N_5$ for a state $S_R$ at the root is $M_{N_5 \\to R}(S_R) = \\sum_{S_5} P_{S_R S_5}(0.05) L_{N_5}(S_5)$.\nProbabilities for $t=0.05$: $p_1(0.05) \\approx 0.95175$, $p_s(0.05) \\approx 0.02865$, $p_v(0.05) \\approx 0.00980$.\n$M_{N_5 \\to R}(A) = p_1(0.05)L_{N_5}(A) + p_s(0.05)L_{N_5}(G) + p_v(0.05)(L_{N_5}(C)+L_{N_5}(T)) \\approx 0.12361$\n$M_{N_5 \\to R}(G) = p_s(0.05)L_{N_5}(A) + p_1(0.05)L_{N_5}(G) + p_v(0.05)(L_{N_5}(C)+L_{N_5}(T)) \\approx 0.09453$\n$M_{N_5 \\to R}(C) = p_v(0.05)(L_{N_5}(A)+L_{N_5}(G)) + p_1(0.05)L_{N_5}(C) + p_s(0.05)L_{N_5}(T) \\approx 0.00576$\n$M_{N_5 \\to R}(T) = p_v(0.05)(L_{N_5}(A)+L_{N_5}(G)) + p_s(0.05)L_{N_5}(C) + p_1(0.05)L_{N_5}(T) \\approx 0.00576$\nThe rootward message from $N_5$ is $M_{N_5 \\to R} \\approx (0.12361, 0.00576, 0.09453, 0.00576)^T$.\n\nThe message from $N_6$ is $M_{N_6 \\to R}(S_R) = \\sum_{S_6} P_{S_R S_6}(0.05) L_{N_6}(S_6)$.\n$M_{N_6 \\to R}(A) = p_1(0.05)L_{N_6}(A) + p_s(0.05)L_{N_6}(G) + p_v(0.05)(L_{N_6}(C)+L_{N_6}(T)) \\approx 0.15357$\n$M_{N_6 \\to R}(G) = p_s(0.05)L_{N_6}(A) + p_1(0.05)L_{N_6}(G) + p_v(0.05)(L_{N_6}(C)+L_{N_6}(T)) \\approx 0.06572$\n$M_{N_6 \\to R}(C) = p_v(0.05)(L_{N_6}(A)+L_{N_6}(G)) + p_1(0.05)L_{N_6}(C) + p_s(0.05)L_{N_6}(T) \\approx 0.00518$\n$M_{N_6 \\to R}(T) = p_v(0.05)(L_{N_6}(A)+L_{N_6}(G)) + p_s(0.05)L_{N_6}(C) + p_1(0.05)L_{N_6}(T) \\approx 0.00518$\nThe rootward message from $N_6$ is $M_{N_6 \\to R} \\approx (0.15357, 0.00518, 0.06572, 0.00518)^T$.\n\nFinally, the total likelihood is the sum over all root states $S_R$, weighted by the prior probabilities $\\pi(S_R)=0.25$:\n$L = \\sum_{S_R} \\pi(S_R) M_{N_5 \\to R}(S_R) M_{N_6 \\to R}(S_R)$.\n$L = 0.25 \\times [M_{N_5 \\to R}(A)M_{N_6 \\to R}(A) + M_{N_5 \\to R}(C)M_{N_6 \\to R}(C) + M_{N_5 \\to R}(G)M_{N_6 \\to R}(G) + M_{N_5 \\to R}(T)M_{N_6 \\to R}(T)]$\n$L \\approx 0.25 \\times [(0.12361)(0.15357) + (0.00576)(0.00518) + (0.09453)(0.06572) + (0.00576)(0.00518)]$\n$L \\approx 0.25 \\times [0.018983 + 0.000030 + 0.006212 + 0.000030] = 0.25 \\times 0.025255$\n$L \\approx 0.00631375$\n\nRounding to six significant figures, the site likelihood is $0.00631375$. Higher precision calculation gives $L \\approx 0.00631373$.\nFinal answer is $0.00631373$.", "answer": "$$\\boxed{0.00631373}$$", "id": "2739922"}]}