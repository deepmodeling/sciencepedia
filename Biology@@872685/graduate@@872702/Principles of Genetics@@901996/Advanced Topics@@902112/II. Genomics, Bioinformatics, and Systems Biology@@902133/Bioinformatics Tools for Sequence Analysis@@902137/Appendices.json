{"hands_on_practices": [{"introduction": "Before we can analyze sequences, we must first understand the quality of our raw data. This exercise [@problem_id:2793662] demystifies the FASTQ format by guiding you through the process of converting ASCII quality characters into their underlying Phred scores and, ultimately, into concrete base-calling error probabilities. Mastering this fundamental conversion is the first step toward robust downstream bioinformatics analysis.", "problem": "A single-end deoxyribonucleic acid (DNA) read from a next-generation sequencing instrument is encoded in the FASTQ format. The read’s quality line contains the following $10$ American Standard Code for Information Interchange (ASCII) characters:\n$$\\texttt{IFHE=BD@?A}.$$\nAssume Sanger Phred$+33$ encoding is used, so that the numeric Phred quality score $Q_{i}$ at position $i$ is given by\n$$Q_{i} = \\mathrm{code}(c_{i}) - 33,$$\nwhere $\\mathrm{code}(c_{i})$ denotes the ASCII integer code of character $c_{i}$. The Phred quality score is defined by\n$$Q_{i} = -10 \\log_{10}(p_{i}),$$\nwhere $p_{i}$ is the probability that the base call at position $i$ is incorrect. The expected number of base-calling errors in the read is defined as the sum of the per-base error probabilities across the read.\n\nTo avoid any need to recall ASCII codes, use the following character-to-code mapping for the characters present in this quality string:\n- $\\mathrm{code}(\\texttt{I})=73$, $\\mathrm{code}(\\texttt{F})=70$, $\\mathrm{code}(\\texttt{H})=72$, $\\mathrm{code}(\\texttt{E})=69$, $\\mathrm{code}(\\texttt{=})=61$,\n- $\\mathrm{code}(\\texttt{B})=66$, $\\mathrm{code}(\\texttt{D})=68$, $\\mathrm{code}(\\texttt{@})=64$, $\\mathrm{code}(\\texttt{?})=63$, $\\mathrm{code}(\\texttt{A})=65$.\n\nUsing only the definitions above and first principles of probability, compute the expected number of errors for this read. Report your final answer as a single real number, rounded to four significant figures. Do not include any units in your final answer.", "solution": "The task requires mapping FASTQ quality characters to numeric Phred scores and then to base error probabilities, followed by summing those probabilities to obtain the expected error count. The foundational definitions we will use are:\n- The Sanger Phred$+33$ encoding: for character $c_{i}$, the numeric Phred score is $Q_{i}=\\mathrm{code}(c_{i})-33$.\n- The definition of the Phred score: $Q_{i}=-10\\log_{10}(p_{i})$, which implies the error probability is $p_{i}=10^{-Q_{i}/10}$.\n- Linearity of expectation: the expected number of errors across the read equals $\\sum_{i=1}^{n} p_{i}$, irrespective of dependence structure.\n\nStep 1: Compute numeric Phred scores. Using $Q_{i}=\\mathrm{code}(c_{i})-33$ and the provided ASCII codes:\n- For $\\texttt{I}$: $Q=73-33=40$.\n- For $\\texttt{F}$: $Q=70-33=37$.\n- For $\\texttt{H}$: $Q=72-33=39$.\n- For $\\texttt{E}$: $Q=69-33=36$.\n- For $\\texttt{=}$: $Q=61-33=28$.\n- For $\\texttt{B}$: $Q=66-33=33$.\n- For $\\texttt{D}$: $Q=68-33=35$.\n- For $\\texttt{@}$: $Q=64-33=31$.\n- For $\\texttt{?}$: $Q=63-33=30$.\n- For $\\texttt{A}$: $Q=65-33=32$.\n\nThus, the sequence of $Q_{i}$ is\n$$40,\\,37,\\,39,\\,36,\\,28,\\,33,\\,35,\\,31,\\,30,\\,32.$$\n\nStep 2: Convert Phred scores to error probabilities. From $Q_{i}=-10\\log_{10}(p_{i})$ we obtain\n$$p_{i}=10^{-Q_{i}/10}.$$\nCompute $p_{i}$ for each $Q_{i}$:\n- $Q=40$: $p=10^{-4}=0.0001$.\n- $Q=37$: $p=10^{-3.7}\\approx 1.995262315\\times 10^{-4}$.\n- $Q=39$: $p=10^{-3.9}\\approx 1.258925412\\times 10^{-4}$.\n- $Q=36$: $p=10^{-3.6}\\approx 2.511886432\\times 10^{-4}$.\n- $Q=28$: $p=10^{-2.8}\\approx 1.584893192\\times 10^{-3}$.\n- $Q=33$: $p=10^{-3.3}\\approx 5.011872336\\times 10^{-4}$.\n- $Q=35$: $p=10^{-3.5}\\approx 3.162277660\\times 10^{-4}$.\n- $Q=31$: $p=10^{-3.1}\\approx 7.943282347\\times 10^{-4}$.\n- $Q=30$: $p=10^{-3}=1.000000000\\times 10^{-3}$.\n- $Q=32$: $p=10^{-3.2}\\approx 6.309573445\\times 10^{-4}$.\n\nStep 3: Sum the error probabilities to obtain the expected number of errors $E$:\n\n$$\n\\begin{aligned}\nE&=\\sum_{i=1}^{10} p_{i}\\\\\n&\\approx 0.001584893192+0.001000000000+0.0007943282347+0.0006309573445+0.0005011872336\\\\\n&\\quad+0.0003162277660+0.0002511886432+0.0001995262315+0.0001258925412+0.0001000000000\\\\\n&\\approx 0.0055042011867.\n\\end{aligned}\n$$\n\n\nStep 4: Round to four significant figures. The value $0.0055042011867$ has leading digits $5.504$ in scientific notation $5.5042011867\\times 10^{-3}$. Rounding to four significant figures yields $0.005504$.\n\nTherefore, the expected number of errors in the read, rounded to four significant figures, is $0.005504$.", "answer": "$$\\boxed{0.005504}$$", "id": "2793662"}, {"introduction": "Identifying regions of similarity between two sequences is a cornerstone of bioinformatics, revealing potential functional or evolutionary relationships. The Smith-Waterman algorithm provides a rigorous method for finding the best possible local alignment. In this practice [@problem_id:2793645], you will manually construct the dynamic programming matrix to develop a deep, first-principles understanding of how this iconic algorithm works.", "problem": "You are studying local sequence similarity under a substitution model that distinguishes transitions from transversions, a practice motivated by the differing mutation rates observed under the principles of genetics. Consider the deoxyribonucleic acid (DNA) sequences $X$ and $Y$:\n- $X = \\text{AGTCTGAC}$\n- $Y = \\text{GTTCTGCA}$\n\nUse the Smith–Waterman local alignment algorithm with a linear gap model to compute an optimal local alignment between substrings of $X$ and $Y$. The substitution scoring function $s(x,y)$ is defined on nucleotides $x,y \\in \\{\\text{A},\\text{C},\\text{G},\\text{T}\\}$ as follows:\n- If $x = y$, then $s(x,y) = +3$.\n- If $(x,y)$ is a transition (A$\\leftrightarrow$G or C$\\leftrightarrow$T), then $s(x,y) = -1$.\n- If $(x,y)$ is a transversion (all other mismatches), then $s(x,y) = -2$.\n\nUse a constant gap penalty $g = -2$ per gap (linear, not affine).\n\nTasks:\n1. Construct the dynamic programming (DP) matrix for Smith–Waterman and determine the optimal local alignment(s) between substrings of $X$ and $Y$ under the scoring scheme above. Report the aligned substrings you obtain (including any indels) and the corresponding optimal Smith–Waterman score.\n2. For your final numeric answer, enter only the optimal Smith–Waterman local alignment score (no units, no additional text). No rounding is required because all scores are integers.\n\nYour reasoning should begin from the definition of local alignment optimality and the Smith–Waterman DP recurrence, not from any pre-stated closed-form shortcuts. The biological assumptions should be scientifically realistic and consistent with empirical mutation patterns, and all steps must preserve the rigorous definition of local alignment optimality. The final answer must be a single real number.", "solution": "The task is to compute the optimal local alignment between the DNA sequences $X = \\text{AGTCTGAC}$ and $Y = \\text{GTTCTGCA}$ using the Smith–Waterman algorithm. The problem specifies a scoring scheme that differentiates between transitions and transversions, and a linear gap penalty.\n\nThe Smith–Waterman algorithm utilizes dynamic programming to find the optimal local alignment. A matrix, $H$, of size $(n+1) \\times (m+1)$ is constructed, where $m$ and $n$ are the lengths of sequences $X$ and $Y$, respectively. Each entry $H_{i,j}$ stores the maximum score of an alignment ending at position $i$ of sequence $Y$ and position $j$ of sequence $X$.\n\nThe matrix is initialized with $H_{i,0} = 0$ for $0 \\le i \\le n$ and $H_{0,j} = 0$ for $0 \\le j \\le m$. The remaining entries are computed using the following recurrence relation for $1 \\le i \\le n$ and $1 \\le j \\le m$:\n$$H_{i,j} = \\max \\begin{cases} 0 \\\\ H_{i-1,j-1} + s(y_i, x_j) \\\\ H_{i-1,j} + g \\\\ H_{i,j-1} + g \\end{cases}$$\nHere, $x_j$ is the $j$-th character of $X$, $y_i$ is the $i$-th character of $Y$, $s(y_i, x_j)$ is the substitution score, and $g = -2$ is the gap penalty. The $0$ in the recurrence allows for the start of a new local alignment at any position.\n\nThe scoring matrix $s(x,y)$ based on the problem's rules is as follows:\n$$\n\\begin{array}{c|rrrr}\ns(x,y) & \\text{A} & \\text{C} & \\text{G} & \\text{T} \\\\\n\\hline\n\\text{A} & +3 & -2 & -1 & -2 \\\\\n\\text{C} & -2 & +3 & -2 & -1 \\\\\n\\text{G} & -1 & -2 & +3 & -2 \\\\\n\\text{T} & -2 & -1 & -2 & +3\n\\end{array}\n$$\n\nWith $X = \\text{AGTCTGAC}$ and $Y = \\text{GTTCTGCA}$, we construct the $9 \\times 9$ dynamic programming matrix $H$.\n\n$$\nH = \\begin{array}{c|c|cccccccc}\n& & \\ _{j=0} & \\text{A}_{j=1} & \\text{G}_{j=2} & \\text{T}_{j=3} & \\text{C}_{j=4} & \\text{T}_{j=5} & \\text{G}_{j=6} & \\text{A}_{j=7} & \\text{C}_{j=8} \\\\\n\\hline\n\\ _{i=0} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\\\\n\\text{G}_{i=1} & 0 & 0 & 3 & 1 & 0 & 0 & 3 & 1 & 0 \\\\\n\\text{T}_{i=2} & 0 & 0 & 1 & 6 & 4 & 3 & 1 & 1 & 0 \\\\\n\\text{T}_{i=3} & 0 & 0 & 0 & 4 & 5 & 7 & 5 & 3 & 1 \\\\\n\\text{C}_{i=4} & 0 & 0 & 0 & 2 & 7 & 5 & 5 & 3 & 6 \\\\\n\\text{T}_{i=5} & 0 & 0 & 0 & 3 & 5 & 10 & 8 & 6 & 4 \\\\\n\\text{G}_{i=6} & 0 & 0 & 3 & 1 & 3 & 8 & 13 & 11 & 9 \\\\\n\\text{C}_{i=7} & 0 & 0 & 1 & 2 & 4 & 6 & 11 & 11 & 14 \\\\\n\\text{A}_{i=8} & 0 & 3 & 1 & 0 & 2 & 4 & 9 & 14 & 12 \\\\\n\\end{array}\n$$\n\nThe optimal local alignment score is the maximum value in the matrix $H$, which is $14$. This value appears at two positions: $H_{7,8}$ and $H_{8,7}$. We perform a traceback from each position to find the corresponding optimal alignment(s). The traceback proceeds from the cell with the maximum score to a cell with a score of $0$, following the path that generated the scores.\n\n**Traceback 1: Starting from $H_{7,8} = 14$**\nThe alignment is constructed in reverse order.\n1.  $(i,j)=(7,8)$: $H_{7,8}=14$. $y_7=\\text{C}, x_8=\\text{C}$. Score is from $H_{6,7} + s(\\text{C},\\text{C}) = 11 + 3 = 14$. Diagonal move. Align C with C.\n2.  $(i,j)=(6,7)$: $H_{6,7}=11$. $y_6=\\text{G}, x_7=\\text{A}$. Score is from $H_{6,6} + g = 13 - 2 = 11$. Horizontal move. Align $x_7=A$ with a gap.\n3.  $(i,j)=(6,6)$: $H_{6,6}=13$. $y_6=\\text{G}, x_6=\\text{G}$. Score is from $H_{5,5} + s(\\text{G},\\text{G}) = 10 + 3 = 13$. Diagonal move. Align G with G.\n4.  $(i,j)=(5,5)$: $H_{5,5}=10$. $y_5=\\text{T}, x_5=\\text{T}$. Score is from $H_{4,4} + s(\\text{T},\\text{T}) = 7 + 3 = 10$. Diagonal move. Align T with T.\n5.  $(i,j)=(4,4)$: $H_{4,4}=7$. $y_4=\\text{C}, x_4=\\text{C}$. Score is from $H_{3,3} + s(\\text{C},\\text{C}) = 4 + 3 = 7$. Diagonal move. Align C with C.\n6.  $(i,j)=(3,3)$: $H_{3,3}=4$. $y_3=\\text{T}, x_3=\\text{T}$. Score is from $H_{2,2} + s(\\text{T},\\text{T}) = 1 + 3 = 4$. Diagonal move. Align T with T.\n7.  $(i,j)=(2,2)$: $H_{2,2}=1$. $y_2=\\text{T}, x_2=\\text{G}$. Score is from $H_{1,2} + g = 3 - 2 = 1$. Vertical move. Align $y_2=T$ with a gap.\n8.  $(i,j)=(1,2)$: $H_{1,2}=3$. $y_1=\\text{G}, x_2=\\text{G}$. Score is from $H_{0,1} + s(\\text{G},\\text{G}) = 0 + 3 = 3$. Diagonal move. Align G with G.\nThe traceback terminates at $H_{0,1} = 0$.\n\nThis traceback yields the alignment of substrings $X' = x_2 \\ldots x_8 = \\text{GTCTGAC}$ and $Y' = y_1 \\ldots y_7 = \\text{GTTCTGC}$.\nAlignment 1:\n-   X: $\\text{G - T C T G A C}$\n-   Y: $\\text{G T T C T G - C}$\nScore: $s(\\text{G},\\text{G}) + g + s(\\text{T},\\text{T}) + s(\\text{C},\\text{C}) + s(\\text{T},\\text{T}) + s(\\text{G},\\text{G}) + g + s(\\text{C},\\text{C}) = 3 - 2 + 3 + 3 + 3 + 3 - 2 + 3 = 14$.\n\n**Traceback 2: Starting from $H_{8,7} = 14$**\n1.  $(i,j)=(8,7)$: $H_{8,7}=14$. $y_8=\\text{A}, x_7=\\text{A}$. Score is from $H_{7,6} + s(\\text{A},\\text{A}) = 11 + 3 = 14$. Diagonal move. Align A with A.\n2.  $(i,j)=(7,6)$: $H_{7,6}=11$. $y_7=\\text{C}, x_6=\\text{G}$. Score is from $H_{6,6} + g = 13 - 2 = 11$. Vertical move. Align $y_7=C$ with a gap.\n3.  The path from $H_{6,6}=13$ is identical to the one in Traceback 1, ending at $H_{0,1}=0$. The sub-alignment from this point is:\n    -   X: $\\text{G - T C T G}$\n    -   Y: $\\text{G T T C T G}$\n\nThis traceback yields the alignment of substrings $X' = x_2 \\ldots x_7 = \\text{GTCTGA}$ and $Y' = y_1 \\ldots y_8 = \\text{GTTCTGCA}$.\nAlignment 2:\n-   X: $\\text{G - T C T G - A}$\n-   Y: $\\text{G T T C T G C A}$\nScore: $s(\\text{G},\\text{G}) + g + s(\\text{T},\\text{T}) + s(\\text{C},\\text{C}) + s(\\text{T},\\text{T}) + s(\\text{G},\\text{G}) + g + s(\\text{A},\\text{A}) = 3 - 2 + 3 + 3 + 3 + 3 - 2 + 3 = 14$.\n\nBoth tracebacks confirm that the optimal local alignment score is $14$. The problem asks for the optimal score as the final answer.", "answer": "$$\\boxed{14}$$", "id": "2793645"}, {"introduction": "Once an alignment is computed, it must be stored in a standardized, compact format. This practice [@problem_id:2793654] challenges you to act as a bioinformatics parser, decoding an alignment from the widely-used SAM format's CIGAR and MD tags. By reconstructing the alignment and calculating the edit distance, you will gain practical fluency in interpreting the outputs of modern alignment tools.", "problem": "You are given an alignment scenario using the Sequence Alignment/Map (SAM) format, including the Concise Idiosyncratic Gapped Alignment Report (CIGAR) string and the Mismatch Descriptor (MD) tag. The goal is to reconstruct, from first principles, the aligned read relative to a provided reference segment, enumerate the mismatches and insertions/deletions (indels), and compute the minimal Levenshtein edit distance implied by this alignment. Use only the core definitions of alignment operations and the semantics of the CIGAR string and MD tag.\n\nThe data are:\n- Reference segment (length $25$): TGCTAACGTCCATGACTAAGCTGAC\n- Read sequence (SEQ field): AATGCTAGCGTCTATTGACTACTAACGGC\n- CIGAR string: `2S12M1I6M2D5M3S`\n- MD tag string: `5A4C7^AG2G2`\n\nAssume standard SAM conventions: \n- `M` consumes one reference base and one read base and may be a match or a mismatch.\n- `I` consumes read bases only.\n- `D` consumes reference bases only.\n- `S` (soft-clip) consumes read bases only and is not part of the aligned core.\n- The MD tag encodes the run-lengths of matches to the reference (as decimal numbers), the reference bases at mismatches (as letters), and deletions from the read with a leading caret `^` followed by the deleted reference sequence.\n\nTasks:\n1. Using the CIGAR and MD tag definitions and the provided sequences, reconstruct the aligned read relative to the reference segment (you may annotate the alignment with matches, mismatches, and gaps). Identify the reference-indexed positions (from $1$ to $25$) at which mismatches occur and specify the corresponding reference bases at those positions.\n2. Identify the lengths and locations (in reference coordinates) of any deletions and the lengths and locations (in read coordinates relative to the aligned core) of any insertions implied by the CIGAR and MD.\n3. Using the definition of the Levenshtein edit distance as the minimum number of single-base substitutions, insertions, and deletions required to transform one string into the other under the given alignment, compute the total edit distance between the aligned read and the consumed reference segment. Count each single-base mismatch as $1$, each inserted base as $1$, and each deleted reference base as $1$. Exclude soft-clipped bases from this count.\n\nReport only the final numerical value of the edit distance as your answer. Do not include units. No rounding instruction is necessary, as the result is an integer.", "solution": "The problem requires the calculation of an edit distance based on a given sequence alignment, which is described using the standard Sequence Alignment/Map (SAM) format conventions, specifically the CIGAR string and the MD tag. The procedure is to first validate the provided information for consistency and then systematically count the number of substitutions, insertions, and deletions implied by the alignment, excluding any soft-clipped bases.\n\nThe provided data are:\n- Reference segment sequence: `TGCTAACGTCCATGACTAAGCTGAC`\n- Reference segment length: $L_{\\text{ref}} = 25$\n- Read sequence: `AATGCTAGCGTCTATTGACTACTAACGGC`\n- Read sequence length: $L_{\\text{read}} = 29$\n- CIGAR string: `2S12M1I6M2D5M3S`\n- MD tag string: `5A4C7^AG2G2`\n\nFirst, I will verify the consistency of the CIGAR string with the lengths of the reference and read sequences.\nThe total number of bases consumed from the reference is determined by the sum of lengths of the `M` (match/mismatch) and `D` (deletion) operations.\n$$ L_{\\text{ref, CIGAR}} = 12 (\\text{M}) + 6 (\\text{M}) + 2 (\\text{D}) + 5 (\\text{M}) = 25 $$\nThis matches the provided reference segment length, $L_{\\text{ref}} = 25$.\n\nThe total number of bases consumed from the read sequence is determined by the sum of lengths of the `S` (soft-clip), `M` (match/mismatch), and `I` (insertion) operations.\n$$ L_{\\text{read, CIGAR}} = 2 (\\text{S}) + 12 (\\text{M}) + 1 (\\text{I}) + 6 (\\text{M}) + 5 (\\text{M}) + 3 (\\text{S}) = 29 $$\nThis matches the provided read sequence length, $L_{\\text{read}} = 29$. The data are self-consistent.\n\nThe problem defines the edit distance as the sum of single-base substitutions, insertions, and deletions required to transform the aligned portion of the reference into the aligned portion of the read. Soft-clipped bases are explicitly excluded from this calculation. The aligned portion is described by the CIGAR operations between the leading and trailing `S` operations. We can determine the count for each type of edit operation directly from the CIGAR and MD strings.\n\n1.  **Counting Substitutions (Mismatches):**\n    Substitutions occur within the `M` operations where the reference and read bases do not match. The MD tag provides the most direct method for counting these. The MD tag format specifies mismatches as single letters representing the reference base at the mismatched position.\n    The MD tag is `5A4C7^AG2G2`.\n    The single letters not preceded by a caret (`^`) are `A`, `C`, and `G`. Each of these signifies one single-base substitution.\n    Therefore, the total number of substitutions is $N_{\\text{sub}} = 3$.\n\n2.  **Counting Insertions:**\n    Insertions correspond to bases present in the read but not in the reference. These are encoded by the `I` operation in the CIGAR string.\n    The CIGAR string is `2S12M1I6M2D5M3S`.\n    There is one insertion operation, `1I`. The length of this operation is $1$.\n    Therefore, the total number of inserted bases is $N_{\\text{ins}} = 1$.\n\n3.  **Counting Deletions:**\n    Deletions correspond to bases present in the reference but not in the read. These are encoded by the `D` operation in the CIGAR string.\n    The CIGAR string contains one deletion operation, `2D`. The length of this operation is $2$.\n    Therefore, the total number of deleted bases is $N_{\\text{del}} = 2$.\n    This is also corroborated by the MD tag, where `^AG` indicates a deletion of two bases (`A` and `G`) from the reference.\n\nThe total Levenshtein-like edit distance, as specified by the problem for this fixed alignment, is the sum of these counts.\n$$ \\text{Edit Distance} = N_{\\text{sub}} + N_{\\text{ins}} + N_{\\text{del}} $$\nSubstituting the values derived:\n$$ \\text{Edit Distance} = 3 + 1 + 2 = 6 $$\n\nTo provide complete verification, one can reconstruct the full alignment.\nReference: `TGCTAACGTCCATGACTAAGCTGAC`\nRead: `AATGCTAGCGTCTATTGACTACTAACGGC`\n\nAlignment visualization (core part, excluding soft-clips):\n```\nRef:   TGCTAACGTCCA-TGACTAAGCTGAC\nRead:  TGCTAGCGTCTATTGACTA--CTAAC\n```\nThe number of mismatches, insertions, and deletions can be counted from the alignment:\n- Mismatches: $3$ occurrences.\n- Insertions: $1$ occurrence.\n- Deletions: $2$ occurrences.\nThe sum remains $3 + 1 + 2 = 6$. The calculation is correct.", "answer": "$$\\boxed{6}$$", "id": "2793654"}]}