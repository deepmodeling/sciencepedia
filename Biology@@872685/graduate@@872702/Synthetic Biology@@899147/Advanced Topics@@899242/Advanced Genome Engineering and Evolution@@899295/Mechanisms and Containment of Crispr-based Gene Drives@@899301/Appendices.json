{"hands_on_practices": [{"introduction": "The unique power of a CRISPR-based gene drive originates from its ability to manipulate the fundamental rules of inheritance. This first exercise takes you to the heart of the drive mechanism: gamete formation in a single heterozygous individual. By applying the law of total probability, you will build a mathematical model that translates the key molecular events—allelic cutting ($c$), homology-directed repair ($h$), and non-homologous end joining ($n$)—into a quantitative prediction of the frequencies of drive ($D$), wild-type ($W$), and resistant ($R$) alleles in the gametes. Mastering this foundational calculation is the essential first step toward understanding and predicting how a gene drive will behave in a larger population.", "problem": "An engineered Clustered Regularly Interspaced Short Palindromic Repeats (CRISPR) gene drive allele, denoted $D$, is inserted at a locus such that it encodes a CRISPR-associated (Cas) nuclease and a guide that targets the wild-type allele, denoted $W$, at the homologous locus. The $D$ allele is recoded at the target site so that it is not recognized and not cut by the nuclease it expresses. Consider a diploid germline cell that is heterozygous $D/W$ at this locus. Assume the following well-tested facts as the fundamental base for your reasoning: (i) under Mendelian segregation, each homologous chromosome is transmitted to a gamete with probability $1/2$, and (ii) CRISPR-induced double-strand breaks at the $W$ allele, when they occur prior to meiosis, are repaired either by Homology-Directed Repair (HDR) using the $D$ allele as a template or by Non-Homologous End Joining (NHEJ), which generates a mutation at the target site that is resistant to further cutting; call such an allele $R$.\n\nModel the process as follows. Conditional on a gamete inheriting the chromosome that initially carried $W$ in the $D/W$ germline cell:\n- With probability $c$, a double-strand break is induced at $W$ before meiosis. Conditional on such a break, repair proceeds by HDR with probability $h$ (which converts $W$ to $D$) or by NHEJ with probability $n$ (which converts $W$ to $R$). Assume $h+n=1$.\n- With probability $1-c$, no break occurs and the allele remains $W$.\n\nAssume the chromosome carrying $D$ is never cut and is transmitted intact when inherited. Using only the law of total probability combined with the Mendelian segregation fact described above, derive the expected distribution of haploid gamete genotypes ($D,R,W$) produced by this $D/W$ germline cell, expressed as a row vector of probabilities in terms of $c$, $h$, and $n$.\n\nExpress your final answer as a single row vector in the order ($D,R,W$), fully simplified. No numerical evaluation or rounding is required, and no units are involved.", "solution": "The problem statement must first be subjected to rigorous validation.\n\nStep 1: Extraction of Givens.\n- Alleles are defined as $D$ (drive), $W$ (wild-type), and $R$ (resistant).\n- The initial organism is a diploid germline cell, heterozygous $D/W$.\n- Fact (i): Mendelian segregation dictates that each homologous chromosome is transmitted to a gamete with probability $1/2$.\n- The chromosome carrying the $D$ allele is transmitted intact.\n- The process for the chromosome initially carrying the $W$ allele is as follows:\n- With probability $c$, a double-strand break occurs at the locus.\n- Conditional on a break, repair by Homology-Directed Repair (HDR) occurs with probability $h$, converting $W$ to $D$.\n- Conditional on a break, repair by Non-Homologous End Joining (NHEJ) occurs with probability $n$, converting $W$ to $R$.\n- It is given that $h+n=1$.\n- With probability $1-c$, no break occurs, and the allele remains $W$.\n- The objective is to derive the expected distribution of haploid gamete genotypes $(D, R, W)$ in terms of $c$, $h$, and $n$.\n\nStep 2: Validation Using Extracted Givens.\n- Scientific Grounding: The problem describes a simplified but standard and scientifically accepted model of a CRISPR-based homing gene drive. The concepts of HDR, NHEJ, allelic conversion, and resistance are fundamental to gene drive technology. The model is a valid abstraction used in synthetic biology and population genetics. It is not based on pseudoscience or factual inaccuracies.\n- Well-Posedness: The problem is well-posed. It provides all necessary parameters ($c$, $h$, $n$) and a clear objective: to calculate a probability distribution. The use of symbolic parameters rather than numerical values is standard in theoretical modeling. The problem structure allows for a unique solution based on the principles of probability theory.\n- Objectivity: The language is precise, technical, and free of subjective or ambiguous terminology.\n\nStep 3: Verdict and Action.\nThe problem is scientifically grounded, well-posed, objective, and internally consistent. It is a valid exercise in applying fundamental probability theory to a model from synthetic biology. Therefore, I will proceed to derive the solution.\n\nThe derivation of the gamete genotype distribution from a heterozygous $D/W$ individual is as follows. We must calculate the total probability for a gamete to inherit each of the three possible alleles: $D$, $R$, or $W$. This requires application of the law of total probability, considering the two possible chromosomal origins for the gamete.\n\nLet $C_D$ be the event that a gamete inherits the chromosome that initially carried the $D$ allele.\nLet $C_W$ be the event that a gamete inherits the chromosome that initially carried the $W$ allele.\n\nAccording to Mendelian segregation, the probabilities of these events are:\n$$P(C_D) = \\frac{1}{2}$$\n$$P(C_W) = \\frac{1}{2}$$\n\nThe problem states that the $D$ allele on its original chromosome is stable. Thus, if a gamete inherits this chromosome (event $C_D$), the allele will be $D$. The conditional probabilities are:\n$$P(\\text{gamete is } D \\mid C_D) = 1$$\n$$P(\\text{gamete is } R \\mid C_D) = 0$$\n$$P(\\text{gamete is } W \\mid C_D) = 0$$\n\nNow, we must consider the outcome when a gamete inherits the chromosome that initially carried the $W$ allele (event $C_W$). The $W$ allele can be converted to $D$ or $R$, or it can remain as $W$. The probabilities for the final state of this allele are given by the sequence of events described in the problem.\n- The allele on the $C_W$ chromosome becomes $D$ if and only if a break occurs (probability $c$) and is repaired by HDR (probability $h$). The probability of this joint event is the product of the probabilities:\n$$P(\\text{gamete is } D \\mid C_W) = c \\times h = ch$$\n- The allele on the $C_W$ chromosome becomes $R$ if and only if a break occurs (probability $c$) and is repaired by NHEJ (probability $n$). The probability of this joint event is:\n$$P(\\text{gamete is } R \\mid C_W) = c \\times n = cn$$\n- The allele on the $C_W$ chromosome remains $W$ if and only if no break occurs (probability $1-c$):\n$$P(\\text{gamete is } W \\mid C_W) = 1-c$$\nNote that these three outcomes for the $C_W$ chromosome are mutually exclusive and exhaustive: $ch + cn + (1-c) = c(h+n) + 1-c = c(1) + 1-c = 1$.\n\nWe can now find the total probability for each gamete genotype using the law of total probability: $P(G) = P(G \\mid C_D)P(C_D) + P(G \\mid C_W)P(C_W)$, where $G$ is the gamete genotype.\n\n1.  Probability of a $D$ gamete, $P(D)$:\n$$P(D) = P(\\text{gamete is } D \\mid C_D)P(C_D) + P(\\text{gamete is } D \\mid C_W)P(C_W)$$\n$$P(D) = (1) \\times \\frac{1}{2} + (ch) \\times \\frac{1}{2} = \\frac{1+ch}{2}$$\n\n2.  Probability of an $R$ gamete, $P(R)$:\n$$P(R) = P(\\text{gamete is } R \\mid C_D)P(C_D) + P(\\text{gamete is } R \\mid C_W)P(C_W)$$\n$$P(R) = (0) \\times \\frac{1}{2} + (cn) \\times \\frac{1}{2} = \\frac{cn}{2}$$\n\n3.  Probability of a $W$ gamete, $P(W)$:\n$$P(W) = P(\\text{gamete is } W \\mid C_D)P(C_D) + P(\\text{gamete is } W \\mid C_W)P(C_W)$$\n$$P(W) = (0) \\times \\frac{1}{2} + (1-c) \\times \\frac{1}{2} = \\frac{1-c}{2}$$\n\nThe expected distribution of haploid gamete genotypes $(D, R, W)$ is the row vector of these probabilities.\nThe final distribution is $\\left( \\frac{1+ch}{2}, \\frac{cn}{2}, \\frac{1-c}{2} \\right)$.\nThe sum of these probabilities is $\\frac{1+ch}{2} + \\frac{cn}{2} + \\frac{1-c}{2} = \\frac{1+ch+cn+1-c}{2} = \\frac{2+c(h+n)-c}{2} = \\frac{2+c(1)-c}{2} = \\frac{2}{2} = 1$, which confirms the validity of the distribution.\nThe problem asks for the answer in terms of $c$, $h$, and $n$, so no further substitution is required.", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{1+ch}{2} & \\frac{cn}{2} & \\frac{1-c}{2} \\end{pmatrix}}$$", "id": "2749933"}, {"introduction": "Having modeled how a drive biases inheritance at the individual level [@problem_id:2749933], we now scale up to the population. This practice addresses the most critical question for any gene drive: under what conditions will it successfully spread? You will derive the invasion threshold, a crucial relationship that pits the drive's conversion efficiency ($c$) against the fitness costs ($s, h$) it imposes on its host. This exercise introduces the powerful technique of linear stability analysis, allowing you to determine if a rare drive allele will increase in frequency, providing a clear, quantitative criterion for the potential success or failure of a drive system.", "problem": "A population geneticist is modeling a homing-based Clustered Regularly Interspaced Short Palindromic Repeats (CRISPR) gene drive that biases inheritance by cutting the wild-type allele and copying itself during gametogenesis. Consider a large, randomly mating, panmictic diploid population with two alleles at a single locus: a drive allele $D$ and a wild-type allele $W$. Let $p_t$ be the frequency of $D$ among adults in generation $t$. Assume the following mechanistic and fitness details:\n\n- Life cycle: adults produce gametes, zygotes form by random union of gametes, and then viability selection acts before adulthood.\n- Gene drive mechanism in heterozygous adults ($W D$): in the germline, the wild-type allele is cut and converted to $D$ with probability $c \\in [0,1]$. If conversion occurs, all gametes from that meiosis carry $D$; if conversion fails, Mendelian segregation applies.\n- No resistant alleles are formed, there is no embryo cutting, and there is no sex-specificity.\n- Viability selection: adult fitnesses are $1$ for $W W$, $1 - h s$ for $W D$, and $1 - s$ for $D D$, where $s \\in [0,1)$ is the homozygous fitness cost and $h \\in [0,1]$ is the dominance parameter.\n\nWorking from these assumptions and standard random-mating population genetics (Hardy–Weinberg proportions before selection, and proportional genotype survival under viability selection), derive the critical conversion probability $c^{\\ast}$ as a function of $h$ and $s$ such that the drive allele $D$ increases in frequency when rare, i.e., $p_{t+1} > p_t$ as $p_t \\to 0$, if and only if $c > c^{\\ast}$. Express your final result as a single closed-form analytic expression for $c^{\\ast}$ in terms of $h$ and $s$. No numerical approximation or rounding is required.", "solution": "The problem as stated is scientifically grounded, mathematically well-posed, and free of contradiction or ambiguity. It presents a standard model in theoretical population genetics for a homing-based gene drive. We shall therefore proceed with its solution.\n\nThe objective is to derive the critical conversion probability $c^{\\ast}$ that allows the drive allele $D$ to increase in frequency when it is rare. This is a problem of local stability analysis around the fixed point where the frequency of $D$, denoted by $p_t$, is zero. The allele $D$ invades the population if and only if the trivial equilibrium $p_t = 0$ is unstable.\n\nLet $p_t$ be the frequency of the drive allele $D$ and $1-p_t$ be the frequency of the wild-type allele $W$ among adults in generation $t$. Assuming a large, panmictic population, the genotype frequencies at the start of the life cycle (adults of generation $t$) are given by Hardy-Weinberg proportions:\n- Frequency of $WW$ adults: $(1-p_t)^2$\n- Frequency of $WD$ adults: $2p_t(1-p_t)$\n- Frequency of $DD$ adults: $p_t^2$\n\nThe first step is to determine the frequency of the $D$ allele in the gamete pool produced by these adults.\n- $DD$ adults produce only $D$ gametes.\n- $WW$ adults produce only $W$ gametes.\n- In heterozygous $WD$ adults, the drive mechanism acts. With probability $c$, the $W$ allele is converted to $D$, and the individual produces $100\\%$ $D$ gametes. With probability $1-c$, standard Mendelian segregation occurs, and the individual produces $50\\%$ $D$ gametes and $50\\%$ $W$ gametes.\nTherefore, the average proportion of $D$ gametes produced by a $WD$ heterozygote is $c \\cdot 1 + (1-c) \\cdot \\frac{1}{2} = \\frac{1+c}{2}$.\n\nThe frequency of the $D$ allele in the gamete pool, which we denote as $p'$, is the sum of contributions from each genotype, weighted by their frequencies:\n$$p' = (p_t^2) \\cdot (1) + (2p_t(1-p_t)) \\cdot \\left(\\frac{1+c}{2}\\right) + ((1-p_t)^2) \\cdot (0)$$\n$$p' = p_t^2 + p_t(1-p_t)(1+c)$$\n$$p' = p_t^2 + p_t(1+c) - p_t^2(1+c)$$\n$$p' = p_t + c p_t - c p_t^2 = p_t + c p_t (1-p_t)$$\nThis equation gives the allele frequency after the drive mechanism but before selection.\n\nNext, zygotes for generation $t+1$ are formed by the random union of these gametes. The genotype frequencies in zygotes are again given by Hardy-Weinberg proportions, based on the gamete frequency $p'$:\n- Frequency of $WW$ zygotes: $(1-p')^2$\n- Frequency of $WD$ zygotes: $2p'(1-p')$\n- Frequency of $DD$ zygotes: $(p')^2$\n\nThese zygotes are subject to viability selection with fitnesses $w_{WW}=1$, $w_{WD}=1-hs$, and $w_{DD}=1-s$. The frequencies of genotypes among adults of generation $t+1$ are proportional to their zygotic frequencies multiplied by their respective fitnesses.\nThe mean fitness of the population, $\\bar{w}$, is the sum of these weighted frequencies:\n$$\\bar{w} = (1-p')^2 w_{WW} + 2p'(1-p') w_{WD} + (p')^2 w_{DD}$$\n$$\\bar{w} = (1-p')^2 + 2p'(1-p')(1-hs) + (p')^2(1-s)$$\n\nThe frequency of the $D$ allele among adults in generation $t+1$, denoted $p_{t+1}$, is calculated from the post-selection genotype frequencies. The number of $D$ alleles is proportional to $2 \\times (\\text{freq } DD) + 1 \\times (\\text{freq } WD)$. The total number of alleles is proportional to $2 \\times \\bar{w}$.\n$$p_{t+1} = \\frac{(p')^2(1-s) + p'(1-p')(1-hs)}{\\bar{w}}$$\n$$p_{t+1} = \\frac{p'(p'(1-s) + (1-p')(1-hs))}{\\bar{w}}$$\n$$p_{t+1} = \\frac{p'(1-hs + p'(hs-s))}{\\bar{w}}$$\nThis is the full recurrence relation for the allele frequency.\n\nTo find the condition for the drive to increase when rare, we analyze the stability of the equilibrium $p_t=0$. The drive invades if the Jacobian of the map $p_t \\mapsto p_{t+1}$, evaluated at $p_t=0$, is greater than $1$. This Jacobian is the eigenvalue $\\lambda = \\left. \\frac{dp_{t+1}}{dp_t} \\right|_{p_t=0}$.\n\nUsing the chain rule, $\\frac{dp_{t+1}}{dp_t} = \\frac{dp_{t+1}}{dp'} \\frac{dp'}{dp_t}$. We evaluate this at $p_t=0$.\nFirst, we find $\\frac{dp'}{dp_t}$:\n$$p' = p_t + cp_t - cp_t^2$$\n$$\\frac{dp'}{dp_t} = 1+c-2cp_t$$\nAt $p_t=0$, we have $\\left. \\frac{dp'}{dp_t} \\right|_{p_t=0} = 1+c$. Also note that at $p_t=0$, $p'=0$.\n\nNext, we find $\\frac{dp_{t+1}}{dp'}$. Let $N(p') = p'(1-hs + p'(hs-s))$ and $D(p')=\\bar{w}$. Then $p_{t+1} = \\frac{N(p')}{D(p')}$.\nBy the quotient rule, $\\frac{dp_{t+1}}{dp'} = \\frac{N'(p')D(p') - N(p')D'(p')}{[D(p')]^2}$.\nWe evaluate this at $p'=0$ (since $p_t=0 \\implies p'=0$).\nAt $p'=0$:\n$N(0) = 0$.\n$D(0) = (1-0)^2 + 2(0)(1)(1-hs) + (0)^2(1-s) = 1$.\nThe expression for the derivative simplifies to $\\left. \\frac{dp_{t+1}}{dp'} \\right|_{p'=0} = \\frac{N'(0)D(0) - N(0)D'(0)}{[D(0)]^2} = \\frac{N'(0) \\cdot 1 - 0}{1^2} = N'(0)$.\n\nWe compute $N'(p')$:\n$N'(p') = \\frac{d}{dp'}\\left[ p'(1-hs) + (p')^2(hs-s) \\right] = (1-hs) + 2p'(hs-s)$.\nAt $p'=0$, $N'(0) = 1-hs$.\nThus, $\\left. \\frac{dp_{t+1}}{dp'} \\right|_{p'=0} = 1-hs$.\n\nCombining these results, the eigenvalue $\\lambda$ is:\n$$\\lambda = \\left. \\frac{dp_{t+1}}{dp_t} \\right|_{p_t=0} = \\left( \\left. \\frac{dp_{t+1}}{dp'} \\right|_{p'=0} \\right) \\left( \\left. \\frac{dp'}{dp_t} \\right|_{p_t=0} \\right) = (1-hs)(1+c)$$\n\nThe allele $D$ increases in frequency when rare if and only if $\\lambda > 1$.\n$$(1-hs)(1+c) > 1$$\nGiven that $h \\in [0,1]$ and $s \\in [0,1)$, we have $hs < 1$, which means $1-hs$ is a positive quantity. We can therefore divide by it without changing the inequality's direction.\n$$1+c > \\frac{1}{1-hs}$$\n$$c > \\frac{1}{1-hs} - 1$$\n$$c > \\frac{1 - (1-hs)}{1-hs}$$\n$$c > \\frac{hs}{1-hs}$$\nThis inequality defines the condition for the drive to invade. The critical conversion probability, $c^{\\ast}$, is the threshold value at which this condition becomes an equality.\n$$c^{\\ast} = \\frac{hs}{1-hs}$$\nThus, the drive allele will increase in frequency when rare if and only if its conversion probability $c$ exceeds this critical value $c^{\\ast}$.", "answer": "$$\\boxed{\\frac{hs}{1 - hs}}$$", "id": "2749889"}, {"introduction": "Analytical models, like the one used to find the invasion threshold in [@problem_id:2749889], provide fundamental insights but often rely on simplifying assumptions. To evaluate the real-world performance and safety of gene drives, we turn to computational simulation. This final practice challenges you to implement a population dynamics simulator and use it to perform a sensitivity analysis on various temporal containment strategies, such as split-drives and daisy-chains. By testing these strategies across a range of uncertain biological parameters ($c, h, s$), you will gain hands-on experience with the methods used to assess the robustness and potential failure modes of engineered biological systems, a vital step in responsible development.", "problem": "Consider a single, randomly mating diploid population with two alleles at a locus: a CRISPR-based homing gene drive allele, denoted $D$, and a wild-type allele, denoted $W$. Let $x_t$ be the frequency of allele $D$ among zygotes at generation $t$. Assume classical Hardy–Weinberg proportions among zygotes and viability selection characterized by a selection coefficient $s$ and a dominance coefficient $h$ such that the genotype fitnesses are $w_{DD} = 1 - s$, $w_{DW} = 1 - h s$, and $w_{WW} = 1$. Following selection, assume that during gametogenesis, a $D/W$ heterozygote undergoes homing (conversion) with time-dependent conversion probability $c_t \\in [0,1]$, resulting in super-Mendelian transmission of $D$. Under these assumptions, the allele-frequency update $x_{t} \\mapsto x_{t+1}$ is defined by first computing post-selection genotype frequencies and then computing the expected transmission of $D$ from each genotype class. The goal is to implement this dynamical system and use it to evaluate containment strategies that modulate the temporal profile of $c_t$.\n\nYou are to implement three containment strategies, each defining $c_t$ as a function of time and auxiliary state variables, and to assess robustness to uncertainty in $c$, $h$, and $s$ via a grid-based sensitivity analysis. All quantities representing proportions or probabilities (including allele frequencies and probabilities of conversion) must be treated as unitless decimals in $[0,1]$.\n\nBase definitions to use:\n- Pre-selection genotype frequencies at generation $t$ are $f_{DD} = x_t^2$, $f_{DW} = 2 x_t (1 - x_t)$, and $f_{WW} = (1 - x_t)^2$.\n- Post-selection, the unnormalized genotype frequencies are $g_{DD} = w_{DD} f_{DD}$, $g_{DW} = w_{DW} f_{DW}$, $g_{WW} = w_{WW} f_{WW}$, with mean fitness $\\overline{w} = g_{DD} + g_{DW} + g_{WW}$. The normalized post-selection frequencies are $p_{DD} = g_{DD}/\\overline{w}$, $p_{DW} = g_{DW}/\\overline{w}$, and $p_{WW} = g_{WW}/\\overline{w}$.\n- The expected fraction of allele $D$ transmitted by a $D/W$ heterozygote is $\\frac{1}{2} (1 + c_t)$, while a $D/D$ homozygote transmits allele $D$ with probability $1$, and a $W/W$ homozygote transmits allele $D$ with probability $0$.\n- Therefore, the allele frequency update is\n$$\nx_{t+1} \\;=\\; p_{DD} \\cdot 1 \\;+\\; p_{DW} \\cdot \\frac{1}{2} (1 + c_t) \\;+\\; p_{WW} \\cdot 0 \\, .\n$$\n\nContainment strategies to model:\n- Strategy S1 (split-drive homing): Two unlinked components are released. Let $q_t$ denote the frequency of the endonuclease component required for homing. Assume $q_{t+1} = (1 - \\lambda)\\, q_t$ with $q_0 = x_0$ and $\\lambda \\in [0,1]$ representing aggregate loss due to segregation and any additional burden. The effective conversion probability is $c_t = c \\cdot q_t$.\n- Strategy S2 (daisy-chain homing): A daisy-chain of length $L \\in \\mathbb{N}$ is used to progressively limit homing. Approximate a deterministic linear attrition of homing activity: $c_t = c \\cdot \\max\\{0,\\, 1 - t/L\\}$ for integer $t \\ge 0$.\n- Strategy S3 (threshold-reliant homing): Homing activity is constant, $c_t = c$, and containment is achieved by releasing below the nominal invasion threshold $\\hat{x}^{(0)}$ computed under nominal parameters $(c_0,h_0,s_0)$ as any interior fixed point of the map $x \\mapsto x_{t+1}$ (i.e., a solution $\\hat{x}^{(0)} \\in (0,1)$ of $x_{t+1} - x = 0$ under $(c_0,h_0,s_0)$). If no such interior fixed point exists, take $\\hat{x}^{(0)} = 0$.\n\nFailure modes to detect for each simulation run with specific $(c,h,s)$:\n- FM1 (unintended fixation): $\\max_{0 \\le t \\le G} x_t \\ge x_{\\mathrm{fix}}$.\n- FM2 (undesired persistence): $x_G \\ge x_{\\mathrm{persist}}$ and FM1 is false.\n- FM3 (threshold breach; only for S3): with nominal threshold $\\hat{x}^{(0)}$ computed at $(c_0,h_0,s_0)$, if $x_0 < \\hat{x}^{(0)}$ but there exists $t \\in \\{0,\\dots,G\\}$ such that $x_t \\ge \\hat{x}^{(0)}$.\n\nA simulation run is deemed a failure if any of the applicable failure modes is true.\n\nSensitivity analysis specification:\n- For each test case, define rectangular uncertainty ranges for $(c,h,s)$ as $[c_{\\min}, c_{\\max}] \\times [h_{\\min}, h_{\\max}] \\times [s_{\\min}, s_{\\max}]$.\n- Use a full-factorial grid with $N_c = N_h = N_s = 5$ evenly spaced values per parameter over the corresponding interval, producing $5 \\times 5 \\times 5 = 125$ parameter triplets.\n- For each triplet, simulate the dynamics for $G$ generations using the specified strategy with its auxiliary parameters and initial conditions, and assess failure.\n- Report the failure probability as a float equal to the number of failures divided by $125$.\n\nNumerical specifications common to all test cases:\n- Use $x_{\\mathrm{fix}} = 0.95$ and $x_{\\mathrm{persist}} = 0.05$.\n- Use $x_t$ and all probabilities as decimals in $[0,1]$.\n- Simulations must clip $x_t$ to the closed interval $[10^{-12}, 1 - 10^{-12}]$ at each step to avoid numerical issues.\n- For S3, compute $\\hat{x}^{(0)}$ numerically by scanning $x \\in [10^{-6}, 1 - 10^{-6}]$ with a fine grid to detect sign changes in $x_{t+1} - x$, and refine by bisection on the first detected interior root. If none is found, set $\\hat{x}^{(0)} = 0$.\n\nTest suite:\n- Case $1$ (S1: split-drive, moderate parameters):\n  - Strategy: S1 with $\\lambda = 0.2$, $G = 150$, $x_0 = 0.05$.\n  - Uncertainty ranges: $c \\in [0.80, 0.95]$, $h \\in [0.00, 0.60]$, $s \\in [0.05, 0.20]$.\n- Case $2$ (S2: daisy-chain, moderate to high homing):\n  - Strategy: S2 with $L = 6$, $G = 150$, $x_0 = 0.10$.\n  - Uncertainty ranges: $c \\in [0.85, 0.99]$, $h \\in [0.30, 0.70]$, $s \\in [0.10, 0.30]$.\n- Case $3$ (S3: threshold reliance under high cost):\n  - Strategy: S3 with $G = 300$, $x_0 = 0.10$ and nominal parameters $(c_0,h_0,s_0) = (0.55, 0.80, 0.90)$ to compute $\\hat{x}^{(0)}$.\n  - Uncertainty ranges: $c \\in [0.45, 0.65]$, $h \\in [0.60, 1.00]$, $s \\in [0.70, 1.00]$.\n- Case $4$ (S1: split-drive, boundary case with weak homing and high cost):\n  - Strategy: S1 with $\\lambda = 0.30$, $G = 150$, $x_0 = 0.05$.\n  - Uncertainty ranges: $c \\in [0.05, 0.25]$, $h \\in [0.00, 0.50]$, $s \\in [0.40, 0.60]$.\n\nYour program must:\n- Implement the allele-frequency update from first principles described above.\n- Implement the three containment strategies as defined.\n- For each test case, perform the $5 \\times 5 \\times 5$ grid sensitivity analysis and compute the failure probability (a float).\n- Produce a single line of output containing the four failure probabilities, in order for Cases $1$ through $4$, rounded to $3$ decimal places, as a comma-separated list enclosed in square brackets. For example, the output format must be exactly like $[r_1,r_2,r_3,r_4]$ where each $r_i$ is a float formatted to $3$ decimal places.", "solution": "The problem requires a computational analysis of containment strategies for CRISPR-based gene drives. The foundation of this analysis is a population genetics model describing the evolution of the drive allele frequency, $x_t$, over discrete generations $t$. We shall first derive the governing equation and then outline the implementation of the specified strategies and the sensitivity analysis.\n\n**1. Derivation of the Allele Frequency Update Equation**\n\nWe model a large, randomly mating diploid population with two alleles: a drive allele $D$ and a wild-type allele $W$. The state of the system at generation $t$ is the frequency of the $D$ allele, $x_t$.\n\nThe life cycle is modeled in two stages: viability selection followed by gamete formation with homing.\n\n**Stage 1: Viability Selection**\nAt the zygote stage, assuming Hardy-Weinberg equilibrium, the genotype frequencies are:\n-   $f_{DD} = x_t^2$\n-   $f_{DW} = 2 x_t (1 - x_t)$\n-   $f_{WW} = (1 - x_t)^2$\n\nThese zygotes are subject to viability selection. The relative fitnesses are given as $w_{DD} = 1 - s$, $w_{DW} = 1 - h s$, and $w_{WW} = 1$, where $s$ is the selection coefficient and $h$ is the dominance coefficient. The frequencies of genotypes that survive to adulthood are proportional to the product of their initial frequency and their fitness. The mean fitness of the population, $\\overline{w}_t$, normalizes these frequencies:\n$$ \\overline{w}_t = f_{DD} w_{DD} + f_{DW} w_{DW} + f_{WW} w_{WW} = x_t^2 (1-s) + 2 x_t (1 - x_t) (1-hs) + (1 - x_t)^2 $$\nThe post-selection genotype frequencies are therefore:\n-   $p_{DD} = \\frac{x_t^2 (1-s)}{\\overline{w}_t}$\n-   $p_{DW} = \\frac{2 x_t (1 - x_t) (1-hs)}{\\overline{w}_t}$\n-   $p_{WW} = \\frac{(1 - x_t)^2}{\\overline{w}_t}$\n\n**Stage 2: Gametogenesis and Homing**\nDuring gamete formation, individuals produce haploid gametes. The transmission of the $D$ allele is biased in heterozygotes due to the homing mechanism.\n-   A $DD$ individual produces only $D$ gametes. The proportion of $D$ is $1$.\n-   A $WW$ individual produces only $W$ gametes. The proportion of $D$ is $0$.\n-   A $DW$ heterozygote undergoes homing with a time-dependent probability $c_t$. Without homing, it would produce $D$ and $W$ gametes in a $1:1$ ratio. Homing converts the $W$ allele to a $D$ allele, so the $D$ gamete is produced with an enhanced probability. The expected fraction of $D$ gametes from a $DW$ individual is $\\frac{1}{2} (1-c_t) + 1 \\cdot c_t = \\frac{1+c_t}{2}$. This simplifies the source statement's expression to $\\frac{1}{2} \\cdot 1 + \\frac{1}{2} \\cdot c_t = \\frac{1+c_t}{2}$.\n\n**The Recurrence Relation**\nThe allele frequency in the next generation, $x_{t+1}$, is the sum of the contributions from each post-selection genotype class, weighted by their frequencies:\n$$ x_{t+1} = p_{DD} \\cdot 1 + p_{DW} \\cdot \\frac{1+c_t}{2} + p_{WW} \\cdot 0 $$\nSubstituting the expressions for $p_{DD}$ and $p_{DW}$ yields the complete update equation:\n$$ x_{t+1} = \\frac{x_t^2 (1-s) + 2 x_t (1 - x_t) (1-hs) \\left( \\frac{1+c_t}{2} \\right)}{\\overline{w}_t} $$\n$$ x_{t+1} = \\frac{x_t^2 (1-s) + x_t (1 - x_t) (1-hs) (1+c_t)}{x_t^2 (1-s) + 2 x_t (1 - x_t) (1-hs) + (1 - x_t)^2} $$\nThis equation is the core of the simulation. A numerical clipping mechanism will be applied at each step, ensuring $x_t \\in [10^{-12}, 1 - 10^{-12}]$, to prevent floating-point errors near the boundaries of $0$ and $1$.\n\n**2. Containment Strategies and Sensitivity Analysis**\n\nThe problem specifies three containment strategies, which are different models for the temporal evolution of the conversion probability $c_t$:\n-   **S1 (Split-Drive):** The conversion efficacy depends on the frequency $q_t$ of a co-released, unlinked endonuclease component. $c_t = c \\cdot q_t$, where $c$ is a base conversion rate and $q_t$ decays as $q_{t+1} = (1-\\lambda)q_t$ with initial condition $q_0=x_0$.\n-   **S2 (Daisy-Chain):** The drive construct is designed to lose its homing capability over a fixed number of generations $L$. This is modeled as a linear decay: $c_t = c \\cdot \\max\\{0, 1 - t/L\\}$.\n-   **S3 (Threshold-Reliance):** The conversion rate is constant, $c_t=c$. Containment is attempted by releasing the drive at a frequency $x_0$ below a theoretical invasion threshold $\\hat{x}^{(0)}$. This threshold is an unstable interior fixed point of the dynamics under a nominal set of parameters $(c_0, h_0, s_0)$. It is found by numerically solving $x_{t+1}(x) - x = 0$ for $x \\in (0,1)$. We will implement a numerical root-finding procedure based on scanning followed by bisection. If no interior root is found, $\\hat{x}^{(0)} = 0$.\n\nFor each strategy, a sensitivity analysis is conducted to assess its robustness. A $5 \\times 5 \\times 5$ grid of parameters $(c, h, s)$ is generated over specified uncertainty ranges. For each of the $125$ parameter sets, the system is simulated, and the outcome is classified as a \"failure\" based on the following criteria:\n-   **FM1 (Fixation):** $\\max_{0 \\le t \\le G} x_t \\ge x_{\\mathrm{fix}} = 0.95$.\n-   **FM2 (Persistence):** $x_G \\ge x_{\\mathrm{persist}} = 0.05$ and FM1 is not met.\n-   **FM3 (Threshold Breach, S3 only):** If $x_0 < \\hat{x}^{(0)}$, a failure occurs if $\\max_{0 \\le t \\le G} x_t \\ge \\hat{x}^{(0)}$.\n\nA simulation run is a failure if any applicable mode is triggered. The final result for each test case is the failure probability, which is the total number of failed runs divided by $125$.\n\nThe implementation will follow a modular structure. A core function will compute $x_{t+1}$ from $x_t$. Helper functions will manage the simulation loop for each strategy and check for failure modes. A top-level function will orchestrate the sensitivity analysis for each of the four test cases and format the final output.", "answer": "```python\nimport numpy as np\n\n# --- Global Constants and Numerical Specifications ---\nX_FIX = 0.95\nX_PERSIST = 0.05\nCLIP_MIN = 1e-12\nCLIP_MAX = 1.0 - 1e-12\n\ndef update_xt(xt, ct, s, h):\n    \"\"\"\n    Calculates the allele frequency for the next generation, x_{t+1}.\n    This function implements the core recurrence relation.\n    \"\"\"\n    if xt <= 0.0:\n        return 0.0\n    if xt >= 1.0:\n        return 1.0\n\n    # Hardy-Weinberg frequencies\n    f_DD = xt**2\n    f_DW = 2 * xt * (1 - xt)\n    f_WW = (1 - xt)**2\n\n    # Fitnesses\n    w_DD = 1 - s\n    w_DW = 1 - h * s\n    w_WW = 1\n\n    # Mean fitness\n    w_bar = f_DD * w_DD + f_DW * w_DW + f_WW * w_WW\n\n    if w_bar <= 0:\n        return xt\n    \n    # Post-selection frequencies\n    p_DD = (f_DD * w_DD) / w_bar\n    p_DW = (f_DW * w_DW) / w_bar\n    \n    # Homing and allele transmission\n    xt_plus_1 = p_DD * 1.0 + p_DW * 0.5 * (1.0 + ct)\n    \n    # Numerical clipping\n    xt_plus_1 = np.clip(xt_plus_1, CLIP_MIN, CLIP_MAX)\n    \n    return xt_plus_1\n\ndef bisection(func, a, b, tol=1e-9, max_iter=100):\n    \"\"\"\n    A simple bisection method to find a root of func in [a, b].\n    \"\"\"\n    fa = func(a)\n    fb = func(b)\n    if fa * fb >= 0:\n        # This should not happen if the interval is chosen correctly from scanning.\n        return None\n\n    for _ in range(max_iter):\n        c = (a + b) / 2.0\n        fc = func(c)\n        if abs(fc) < tol or (b - a) / 2.0 < tol:\n            return c\n        if fa * fc < 0:\n            b, fb = c, fc\n        else:\n            a, fa = c, fc\n    return (a + b) / 2.0\n\ndef compute_s3_threshold(c0, h0, s0):\n    \"\"\"\n    Computes the nominal invasion threshold for Strategy S3.\n    \"\"\"\n    def fixed_point_func(x):\n        return update_xt(x, c0, s0, h0) - x\n\n    # Scan for an interior root\n    scan_points = np.linspace(1e-6, 1.0 - 1e-6, 10001)\n    f_vals = np.array([fixed_point_func(x) for x in scan_points])\n    \n    # Find first sign change from positive to negative, indicating an unstable fixed point\n    # Drive increases if f(x) > 0 for small x.\n    for i in range(len(scan_points) - 1):\n        if f_vals[i] > 0 and f_vals[i+1] <= 0:\n            root = bisection(fixed_point_func, scan_points[i], scan_points[i+1])\n            if root is not None:\n                return root\n            \n    return 0.0\n\ndef run_simulation(strategy, params, c, h, s, x_hat0=None):\n    \"\"\"\n    Runs a single simulation for a given strategy and parameter set.\n    Returns True if a failure occurs, False otherwise.\n    \"\"\"\n    x0 = params['x0']\n    G = params['G']\n\n    x_hist = np.zeros(G + 1)\n    x_hist[0] = x0\n    \n    # Strategy-specific initialization\n    if strategy == 'S1':\n        q_hist = np.zeros(G + 1)\n        q_hist[0] = x0\n        lambda_val = params['lambda']\n    \n    for t in range(G):\n        # Determine current conversion probability ct\n        if strategy == 'S1':\n            ct = c * q_hist[t]\n        elif strategy == 'S2':\n            L = params['L']\n            ct = c * max(0.0, 1.0 - t / L)\n        elif strategy == 'S3':\n            ct = c\n        else:\n            raise ValueError(f\"Unknown strategy: {strategy}\")\n\n        # Update allele frequency\n        x_hist[t+1] = update_xt(x_hist[t], ct, s, h)\n\n        # Update auxiliary variables\n        if strategy == 'S1':\n            q_hist[t+1] = (1.0 - lambda_val) * q_hist[t]\n\n    # Check for failure modes\n    max_x = np.max(x_hist)\n    x_G = x_hist[G]\n\n    fm1 = (max_x >= X_FIX)\n    fm2 = (x_G >= X_PERSIST) and not fm1\n    \n    failure = fm1 or fm2\n\n    if strategy == 'S3':\n        if x_hat0 and x0 < x_hat0:\n            fm3 = max_x >= x_hat0\n            failure = failure or fm3\n            \n    return failure\n\ndef analyze_case(case_data):\n    \"\"\"\n    Performs sensitivity analysis for a single test case.\n    \"\"\"\n    strategy = case_data['strategy']\n    params = case_data['params']\n    c_range, h_range, s_range = case_data['ranges']\n    \n    c_vals = np.linspace(c_range[0], c_range[1], 5)\n    h_vals = np.linspace(h_range[0], h_range[1], 5)\n    s_vals = np.linspace(s_range[0], s_range[1], 5)\n    \n    x_hat0 = None\n    if strategy == 'S3':\n        c0, h0, s0 = case_data['nominal_params']\n        x_hat0 = compute_s3_threshold(c0, h0, s0)\n\n    failure_count = 0\n    total_runs = 125  # 5*5*5\n    \n    for c_i in c_vals:\n        for h_j in h_vals:\n            for s_k in s_vals:\n                if run_simulation(strategy, params, c_i, h_j, s_k, x_hat0=x_hat0):\n                    failure_count += 1\n    \n    return failure_count / total_runs\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run analyses, and print results.\n    \"\"\"\n    test_cases = [\n        {\n            \"id\": 1,\n            \"strategy\": \"S1\",\n            \"params\": {\"lambda\": 0.2, \"G\": 150, \"x0\": 0.05},\n            \"ranges\": ([0.80, 0.95], [0.00, 0.60], [0.05, 0.20]),\n        },\n        {\n            \"id\": 2,\n            \"strategy\": \"S2\",\n            \"params\": {\"L\": 6, \"G\": 150, \"x0\": 0.10},\n            \"ranges\": ([0.85, 0.99], [0.30, 0.70], [0.10, 0.30]),\n        },\n        {\n            \"id\": 3,\n            \"strategy\": \"S3\",\n            \"params\": {\"G\": 300, \"x0\": 0.10},\n            \"nominal_params\": (0.55, 0.80, 0.90),\n            \"ranges\": ([0.45, 0.65], [0.60, 1.00], [0.70, 1.00]),\n        },\n        {\n            \"id\": 4,\n            \"strategy\": \"S1\",\n            \"params\": {\"lambda\": 0.30, \"G\": 150, \"x0\": 0.05},\n            \"ranges\": ([0.05, 0.25], [0.00, 0.50], [0.40, 0.60]),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        failure_prob = analyze_case(case)\n        results.append(failure_prob)\n        \n    print(f\"[{','.join(f'{r:.3f}' for r in results)}]\")\n\nsolve()\n```", "id": "2749949"}]}