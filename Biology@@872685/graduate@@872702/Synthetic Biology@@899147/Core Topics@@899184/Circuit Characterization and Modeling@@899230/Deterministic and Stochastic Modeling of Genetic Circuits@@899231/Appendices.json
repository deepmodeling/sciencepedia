{"hands_on_practices": [{"introduction": "Deterministic models based on the law of mass action provide the bedrock for quantitative biology, allowing us to predict the average concentrations of molecular species at steady state. This first practice exercise challenges you to apply these principles to a detailed model of gene expression, starting from the multi-step process of transcription initiation [@problem_id:2728827]. By deriving the steady-state protein concentration from the underlying reaction rate constants, you will solidify your skills in setting up and solving systems of algebraic equations that describe biochemical networks.", "problem": "Consider a single-copy bacterial promoter driving expression of a protein via a three-state transcription initiation cycle under deterministic mass-action kinetics. The promoter states are free promoter, closed complex, and open complex. RNA polymerase (RNAP) binding and isomerization steps are modeled explicitly; productive initiation produces one messenger ribonucleic acid (mRNA) and returns the promoter to the free state, releasing RNAP back to the solution. Assume well-mixed conditions and a constant bulk RNAP concentration because RNAP is in large excess over the promoter.\n\nThe promoter-state reaction scheme is:\n- Free promoter $F$ binds RNAP $R$ to form a closed complex $C$: $F + R \\xrightarrow{k_1} C$.\n- Closed complex dissociates: $C \\xrightarrow{k_{-1}} F + R$.\n- Closed complex isomerizes to the open complex $O$: $C \\xrightarrow{k_2} O$.\n- Open complex reverts to closed complex: $O \\xrightarrow{k_{-2}} C$.\n- Open complex undergoes productive initiation, yielding one mRNA and resetting the promoter: $O \\xrightarrow{k_3} F + R + \\text{mRNA}$.\n\nLet the total promoter concentration be $[G_{\\mathrm{tot}}]$, with $[F] + [C] + [O] = [G_{\\mathrm{tot}}]$. Let $[R]$ be the constant RNAP concentration. The mRNA and protein dynamics follow:\n- mRNA production rate equals $k_3 [O]$. mRNA degrades with first-order rate constant $\\gamma_m$.\n- Protein is translated from mRNA with first-order rate constant $k_{\\mathrm{tl}}$ and is diluted/degraded with first-order rate constant $\\gamma_p$.\n\nStarting from the law of mass action and mass conservation, derive the steady-state open-complex concentration $[O]^*$ in terms of $k_1, k_{-1}, k_2, k_{-2}, k_3, [R]$, and $[G_{\\mathrm{tot}}]$ by solving the steady-state balance of promoter states. Then, use $[O]^*$ to compute the steady-state protein concentration $[P]^*$.\n\nUse the following scientifically plausible parameter values:\n- $k_1 = 1.0 \\times 10^{-3}$ (nM$^{-1}$ s$^{-1}$)\n- $k_{-1} = 0.1$ (s$^{-1}$)\n- $k_2 = 10$ (s$^{-1}$)\n- $k_{-2} = 1$ (s$^{-1}$)\n- $k_3 = 0.5$ (s$^{-1}$)\n- $[R] = 1000$ (nM)\n- $[G_{\\mathrm{tot}}] = 1$ (nM)\n- $\\gamma_m = 2.0 \\times 10^{-3}$ (s$^{-1}$)\n- $k_{\\mathrm{tl}} = 3.0 \\times 10^{-2}$ (s$^{-1}$)\n- $\\gamma_p = 2.0 \\times 10^{-4}$ (s$^{-1}$)\n\nExpress the final steady-state protein concentration $[P]^*$ in micromolar. Round your answer to three significant figures.", "solution": "The problem statement is subjected to validation and is found to be scientifically grounded, well-posed, and objective. It describes a standard model of gene expression using deterministic mass-action kinetics, a fundamental approach in quantitative biology. All necessary parameters and constraints are provided, and no contradictions or ambiguities are present. Therefore, we proceed with a rigorous derivation of the solution.\n\nThe dynamics of the promoter states—free ($[F]$), closed complex ($[C]$), and open complex ($[O]$)—are described by a system of ordinary differential equations (ODEs) based on the law of mass action. The concentration of RNA polymerase, $[R]$, is assumed to be constant.\n\n$$\n\\frac{d[F]}{dt} = -k_1 [F][R] + k_{-1}[C] + k_3[O]\n$$\n$$\n\\frac{d[C]}{dt} = k_1 [F][R] - (k_{-1} + k_2)[C] + k_{-2}[O]\n$$\n$$\n\\frac{d[O]}{dt} = k_2[C] - (k_{-2} + k_3)[O]\n$$\n\nThe total concentration of promoter, $[G_{\\mathrm{tot}}]$, is conserved:\n$$\n[F] + [C] + [O] = [G_{\\mathrm{tot}}]\n$$\n\nTo find the steady-state concentrations, we set the time derivatives to zero. Let the steady-state concentrations be denoted with an asterisk ($*$). From the ODE for $[O]$, we have:\n$$\n0 = k_2[C]^* - (k_{-2} + k_3)[O]^*\n$$\nThis allows us to express $[C]^*$ in terms of $[O]^*$:\n$$\n[C]^* = \\frac{k_{-2} + k_3}{k_2} [O]^*\n$$\n\nNext, from the steady-state ODE for $[C]$, we have:\n$$\n0 = k_1 [F]^*[R] - (k_{-1} + k_2)[C]^* + k_{-2}[O]^*\n$$\nSubstituting the expression for $[C]^*$ allows us to solve for $[F]^*$ in terms of $[O]^*$:\n$$\nk_1 [F]^*[R] = (k_{-1} + k_2)[C]^* - k_{-2}[O]^* = (k_{-1} + k_2)\\left(\\frac{k_{-2} + k_3}{k_2}\\right)[O]^* - k_{-2}[O]^*\n$$\n$$\nk_1 [F]^*[R] = \\frac{(k_{-1} + k_2)(k_{-2} + k_3) - k_2 k_{-2}}{k_2} [O]^* = \\frac{k_{-1}k_{-2} + k_{-1}k_3 + k_2 k_3}{k_2} [O]^*\n$$\n$$\n[F]^* = \\frac{k_{-1}k_{-2} + k_{-1}k_3 + k_2 k_3}{k_1 k_2 [R]} [O]^*\n$$\n\nNow, we enforce the conservation law for the total promoter concentration:\n$$\n[F]^* + [C]^* + [O]^* = [G_{\\mathrm{tot}}]\n$$\nSubstituting the expressions for $[F]^*$ and $[C]^*$ gives an equation solely in terms of $[O]^*$:\n$$\n\\left( \\frac{k_{-1}k_{-2} + k_{-1}k_3 + k_2 k_3}{k_1 k_2 [R]} \\right)[O]^* + \\left( \\frac{k_{-2} + k_3}{k_2} \\right)[O]^* + [O]^* = [G_{\\mathrm{tot}}]\n$$\nFactoring out $[O]^*$ and solving for it yields the steady-state open-complex concentration:\n$$\n[O]^* \\left( \\frac{k_{-1}k_{-2} + k_{-1}k_3 + k_2 k_3 + k_1[R](k_{-2}+k_3) + k_1k_2[R]}{k_1 k_2 [R]} \\right) = [G_{\\mathrm{tot}}]\n$$\n$$\n[O]^* = \\frac{[G_{\\mathrm{tot}}] k_1 k_2 [R]}{k_{-1}k_{-2} + k_{-1}k_3 + k_2 k_3 + k_1[R](k_{-2}+k_3) + k_1k_2[R]}\n$$\n\nThe dynamics of mRNA ($[m]$) and protein ($[P]$) concentrations are given by:\n$$\n\\frac{d[m]}{dt} = k_3 [O] - \\gamma_m [m]\n$$\n$$\n\\frac{d[P]}{dt} = k_{\\mathrm{tl}} [m] - \\gamma_p [P]\n$$\nAt steady state, their derivatives are also zero.\nFrom the mRNA equation:\n$$\nk_3 [O]^* = \\gamma_m [m]^* \\implies [m]^* = \\frac{k_3}{\\gamma_m} [O]^*\n$$\nFrom the protein equation:\n$$\nk_{\\mathrm{tl}} [m]^* = \\gamma_p [P]^* \\implies [P]^* = \\frac{k_{\\mathrm{tl}}}{\\gamma_p} [m]^*\n$$\nSubstituting the expression for $[m]^*$, we find the steady-state protein concentration $[P]^*$ in terms of $[O]^*$:\n$$\n[P]^* = \\frac{k_{\\mathrm{tl}}}{\\gamma_p} \\left( \\frac{k_3}{\\gamma_m} [O]^* \\right) = \\frac{k_{\\mathrm{tl}} k_3}{\\gamma_p \\gamma_m} [O]^*\n$$\nBy substituting the full expression for $[O]^*$, we obtain the final analytical solution for $[P]^*$.\n\nWe now substitute the provided parameter values:\n$k_1 = 1.0 \\times 10^{-3}$ nM$^{-1}$ s$^{-1}$, $k_{-1} = 0.1$ s$^{-1}$, $k_2 = 10$ s$^{-1}$, $k_{-2} = 1$ s$^{-1}$, $k_3 = 0.5$ s$^{-1}$, $[R] = 1000$ nM, $[G_{\\mathrm{tot}}] = 1$ nM, $\\gamma_m = 2.0 \\times 10^{-3}$ s$^{-1}$, $k_{\\mathrm{tl}} = 3.0 \\times 10^{-2}$ s$^{-1}$, and $\\gamma_p = 2.0 \\times 10^{-4}$ s$^{-1}$.\n\nFirst, we compute the denominator of the expression for $[O]^*$:\nThe term $k_1[R] = (1.0 \\times 10^{-3}) \\times 1000 = 1.0$ s$^{-1}$.\nThe denominator is $D = k_{-1}k_{-2} + k_{-1}k_3 + k_2 k_3 + k_1[R](k_{-2}+k_3) + k_1[R]k_2$.\n$D = (0.1)(1) + (0.1)(0.5) + (10)(0.5) + (1.0)(1 + 0.5) + (1.0)(10)$\n$D = 0.1 + 0.05 + 5.0 + 1.5 + 10.0 = 16.65$ s$^{-2}$.\n\nNext, we compute the numerator of the expression for $[O]^*$:\n$N_O = [G_{\\mathrm{tot}}] k_1 k_2 [R] = (1) \\times (1.0 \\times 10^{-3}) \\times (10) \\times (1000) = 10$ nM s$^{-2}$.\n\nThe steady-state open complex concentration is:\n$$\n[O]^* = \\frac{N_O}{D} = \\frac{10}{16.65} \\text{ nM}\n$$\n\nFinally, we compute the steady-state protein concentration $[P]^*$:\n$$\n[P]^* = \\frac{k_{\\mathrm{tl}} k_3}{\\gamma_p \\gamma_m} [O]^* = \\frac{(3.0 \\times 10^{-2})(0.5)}{(2.0 \\times 10^{-4})(2.0 \\times 10^{-3})} \\times \\frac{10}{16.65} \\text{ nM}\n$$\n$$\n[P]^* = \\frac{1.5 \\times 10^{-2}}{4.0 \\times 10^{-7}} \\times \\frac{10}{16.65} \\text{ nM} = 37500 \\times \\frac{10}{16.65} \\text{ nM}\n$$\n$$\n[P]^* = \\frac{375000}{16.65} \\text{ nM} \\approx 22522.52 \\text{ nM}\n$$\n\nThe problem requires the final answer in micromolar ($\\mu$M). Since $1$ $\\mu$M $= 1000$ nM, we must divide our result by $1000$:\n$$\n[P]^* \\approx \\frac{22522.52}{1000} \\text{ } \\mu\\text{M} \\approx 22.52252 \\text{ } \\mu\\text{M}\n$$\nRounding to three significant figures, as required, gives the final answer.\n$$\n[P]^* \\approx 22.5 \\text{ } \\mu\\text{M}\n$$", "answer": "$$\n\\boxed{22.5}\n$$", "id": "2728827"}, {"introduction": "While deterministic models are powerful, they describe a system's average behavior and can miss critical dynamics driven by randomness, or 'noise,' at the molecular level. This is especially true for nonlinear systems like genetic switches, which can exhibit bistability. This conceptual problem explores the profound difference between deterministic and stochastic predictions for a genetic toggle switch initialized at its unstable point, revealing why stochastic models are essential for understanding cell-fate decisions and heterogeneity [@problem_id:1492568].", "problem": "Consider a simplified model for a symmetric genetic toggle switch, a fundamental circuit in synthetic biology. The system involves two proteins, U and V, that mutually repress each other's synthesis. The dynamics of their concentrations, denoted by $u(t)$ and $v(t)$, can be described by a set of deterministic ordinary differential equations:\n\n$$\n\\frac{du}{dt} = \\frac{\\alpha}{1 + v^n} - \\gamma u\n$$\n$$\n\\frac{dv}{dt} = \\frac{\\alpha}{1 + u^n} - \\gamma v\n$$\n\nHere, $\\alpha  0$ is the maximum production rate, $\\gamma  0$ is the first-order degradation rate constant, and the Hill coefficient $n  1$ quantifies the strength of the repression. For certain choices of these parameters, the system is bistable, possessing two distinct stable steady states corresponding to one protein being highly expressed and the other repressed, e.g., (high $u$, low $v$) and (low $u$, high $v$). In addition to these two stable states, there exists a single unstable steady state, $(u^*, v^*)$, which is symmetric, satisfying $u^* = v^*$.\n\nImagine we can initialize the system exactly at this unstable steady state, i.e., $(u(0), v(0)) = (u^*, v^*)$. We wish to compare the long-term behavior (as $t \\to \\infty$) predicted by two different modeling paradigms:\n\n1.  A **deterministic model**, which is governed by the exact differential equations shown above.\n2.  A **stochastic model**, which treats the individual synthesis and degradation events as discrete, random processes. This model inherently includes the effects of intrinsic molecular noise.\n\nWhich of the following statements most accurately contrasts the long-term predictions of these two models starting from the unstable steady state?\n\nA. Both the deterministic and stochastic models predict that the system will remain at the unstable steady state $(u^*, v^*)$ indefinitely.\n\nB. The deterministic model predicts the system will evolve to a state where both concentrations are zero, i.e., $(u,v) = (0,0)$. The stochastic model predicts the system will move to one of the two stable states.\n\nC. The deterministic model predicts the system will remain at $(u^*, v^*)$ indefinitely. In contrast, the stochastic model predicts that due to intrinsic noise, the system will inevitably be pushed away from this point and will evolve towards one of the two stable states with equal probability.\n\nD. The stochastic model predicts the system will remain at $(u^*, v^*)$ indefinitely. In contrast, the deterministic model predicts the system will evolve to one of the two stable states.\n\nE. Both models predict that the system will evolve towards one of the two stable steady states with equal probability.", "solution": "We analyze the deterministic dynamics defined by\n$$\n\\frac{du}{dt} = \\frac{\\alpha}{1 + v^{n}} - \\gamma u, \\qquad\n\\frac{dv}{dt} = \\frac{\\alpha}{1 + u^{n}} - \\gamma v,\n$$\nwith parameters $\\alpha0$, $\\gamma0$, and $n1$. A steady state $(u^{*},v^{*})$ satisfies\n$$\n\\frac{\\alpha}{1 + (v^{*})^{n}} - \\gamma u^{*} = 0, \\qquad\n\\frac{\\alpha}{1 + (u^{*})^{n}} - \\gamma v^{*} = 0.\n$$\nBy symmetry, the unstable steady state satisfies $u^{*}=v^{*}$ and thus solves\n$$\n\\gamma u^{*} = \\frac{\\alpha}{1 + (u^{*})^{n}}.\n$$\nFor the deterministic model, the governing vector field is smooth, so the initial value problem has a unique solution for any initial condition by the Picard–Lindelöf theorem. If the initial condition equals an equilibrium, i.e., $(u(0),v(0))=(u^{*},v^{*})$ with $f(u^{*},v^{*})=(0,0)$, then the constant trajectory $(u(t),v(t)) \\equiv (u^{*},v^{*})$ satisfies the differential equations and, by uniqueness, is the only solution. Therefore, the deterministic model predicts that starting exactly at $(u^{*},v^{*})$ the system remains there for all $t \\geq 0$, despite the equilibrium being unstable to perturbations.\n\nTo characterize the instability, we linearize about $(u^{*},v^{*})$. The Jacobian is\n$$\nJ(u,v) =\n\\begin{pmatrix}\n\\frac{\\partial}{\\partial u}\\left(\\frac{\\alpha}{1+v^{n}} - \\gamma u\\right)  \\frac{\\partial}{\\partial v}\\left(\\frac{\\alpha}{1+v^{n}} - \\gamma u\\right) \\\\\n\\frac{\\partial}{\\partial u}\\left(\\frac{\\alpha}{1+u^{n}} - \\gamma v\\right)  \\frac{\\partial}{\\partial v}\\left(\\frac{\\alpha}{1+u^{n}} - \\gamma v\\right)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-\\gamma  -\\alpha \\frac{n v^{n-1}}{(1+v^{n})^{2}} \\\\\n-\\alpha \\frac{n u^{n-1}}{(1+u^{n})^{2}}  -\\gamma\n\\end{pmatrix}.\n$$\nAt $u^{*}=v^{*}$, the off-diagonal entries are equal, so with\n$$\nk \\equiv \\alpha \\frac{n (u^{*})^{n-1}}{(1+(u^{*})^{n})^{2}},\n$$\nwe have\n$$\nJ(u^{*},v^{*}) =\n\\begin{pmatrix}\n-\\gamma  -k \\\\\n-\\,k  -\\gamma\n\\end{pmatrix}.\n$$\nThe eigenvalues are $\\lambda_{1}=-\\gamma-k$ and $\\lambda_{2}=-\\gamma+k$. In the bistable regime, one eigenvalue is positive, i.e., $-\\gamma + k  0$, making $(u^{*},v^{*})$ an unstable saddle: infinitesimal perturbations generically leave the equilibrium along the unstable eigendirection. However, without any perturbation and starting exactly at the equilibrium, the deterministic trajectory stays at $(u^{*},v^{*})$ indefinitely.\n\nIn contrast, the stochastic model treats synthesis and degradation as discrete random events governed by propensities that remain nonzero at the concentrations corresponding to $(u^{*},v^{*})$. Hence, there is no absorbing stochastic state corresponding to the deterministic unstable steady state. Intrinsic noise produces fluctuations that immediately displace the system from the separatrix defined by $u=v$. Because the system and initial condition are symmetric, these fluctuations are unbiased with respect to the two basins of attraction. Therefore, the stochastic dynamics will with equal probability move toward the neighborhood of either of the two stable steady states. Over sufficiently long times and in finite systems, rare noise-induced transitions between the two stable states can occur, but the immediate implication from starting at the unstable fixed point is that intrinsic noise drives escape and, by symmetry, the two outcomes occur with equal probability.\n\nTherefore, the correct contrast is that the deterministic model remains at $(u^{*},v^{*})$ indefinitely, while the stochastic model, due to intrinsic noise, departs from this point and evolves to one of the two stable states with equal probability.\n\nThe most accurate option is C.", "answer": "$$\\boxed{C}$$", "id": "1492568"}, {"introduction": "To move from conceptual understanding to quantitative prediction of stochastic dynamics, we need robust computational tools. The Gillespie Stochastic Simulation Algorithm (SSA) is a cornerstone method that generates exact trajectories of a chemical system as described by the Chemical Master Equation. In this exercise, you will implement the SSA to simulate how a bistable genetic circuit responds to a transient environmental signal, a model for developmental plasticity [@problem_id:2630111]. This practice will build your skills in simulating first-passage times and analyzing the probabilistic outcomes of noisy biological processes.", "problem": "A bistable gene regulatory network can generate discrete alternative phenotypes (polyphenisms) through mutual repression between two transcription factors. Developmental plasticity arises when a transient environmental input biases the system toward one stable state or the other. Consider a minimal model of a mutually repressing toggle switch comprising two molecular species, denoted by $X$ and $Y$ (copy numbers in molecules), with synthesis and first-order degradation reactions. The effective synthesis propensities are repressed by the antagonist via a Hill function, and an environmental pulse transiently increases the synthesis propensity of $X$. The goal is to compute, using exact stochastic simulation in the Stochastic Simulation Algorithm (SSA) of Daniel T. Gillespie, the distribution of first-passage switching times into the $X$-high state in response to a transient pulse, and to summarize it per parameter set.\n\nFundamental base:\n- Chemical Master Equation (CME): Reaction events for a well-mixed system at constant volume and temperature follow a continuous-time Markov process with state-dependent propensities, and exact sample paths are generated by the Stochastic Simulation Algorithm (SSA).\n- For a given state, the waiting time to the next reaction is exponentially distributed with rate equal to the sum of propensities, and the reaction identity is chosen proportional to its propensity.\n- Hill repression is a well-tested phenomenological rule in gene regulation: repression of a target synthesis rate by an antagonist with copy number $Z$ is modeled as $1/\\left(1+\\left(Z/K\\right)^n\\right)$ where $K$ is a dissociation parameter and $n$ is a Hill coefficient.\n\nModel specification:\n- Species: $X$, $Y$ (nonnegative integers, molecules).\n- Reactions and propensities at time $t$ and state $\\left(X,Y\\right)$:\n  - $R_1$: $X \\to X+1$ with propensity\n    $$ a_1\\left(X,Y,t\\right) \\;=\\; \\frac{k_X\\left(t\\right)}{1+\\left(\\frac{Y}{K}\\right)^n}.$$\n  - $R_2$: $X \\to X-1$ with propensity\n    $$ a_2\\left(X,Y,t\\right) \\;=\\; d_X \\, X.$$\n  - $R_3$: $Y \\to Y+1$ with propensity\n    $$ a_3\\left(X,Y,t\\right) \\;=\\; \\frac{k_Y}{1+\\left(\\frac{X}{K}\\right)^n}.$$\n  - $R_4$: $Y \\to Y-1$ with propensity\n    $$ a_4\\left(X,Y,t\\right) \\;=\\; d_Y \\, Y.$$\n- Environmental pulse: \n  $$ k_X\\left(t\\right) \\;=\\; \\begin{cases}\n  p \\, k_{X,0}  \\text{if } 0 \\le t  T_p,\\\\\n  k_{X,0}  \\text{if } t \\ge T_p,\n  \\end{cases} $$\n  with pulse factor $p \\ge 1$ and pulse duration $T_p$ (both specified per test case). The parameter $k_Y$ is time invariant.\n- Initial condition: $t=0$, $X\\left(0\\right)=X_0$, $Y\\left(0\\right)=Y_0$ with $X_0 - Y_0 \\le -h$ (i.e., initially in the $Y$-high basin with a margin $h$).\n- Switching time definition (first-passage): the switching time $\\tau$ is the first time $t$ such that $X(t) - Y(t) \\ge h$, where $h$ is a positive threshold (in molecules). If no such time occurs before a maximum simulation time $T_{\\max}$, the run is deemed non-switching.\n\nUnits:\n- Time is in minutes, reaction rate constants $k_{X,0}$, $k_Y$ are in molecules per minute, degradation constants $d_X$, $d_Y$ are in per minute, $K$ and $h$ are in molecules. The output mean switching time must be reported in minutes. The fraction of switched runs must be reported as a decimal (not a percentage).\n\nComputation protocol:\n- For each parameter set (test case), simulate $N$ independent SSA trajectories, each up to time $T_{\\max}$ or until switching occurs. Let $M$ be the number of trajectories that switch. Compute:\n  - Fraction switched $f = M/N$ (decimal).\n  - Mean switching time $\\bar{\\tau} = \\left(\\sum_{i=1}^{M} \\tau_i\\right)/M$ in minutes, computed over only the switching trajectories. If $M=0$, define $\\bar{\\tau} = -1.0$ by convention.\n- Randomness control: Use a fixed base seed $s_0$ for reproducibility and independent streams per trajectory. For test case index $i$ (starting at $0$) and replicate index $j$ (starting at $0$), seed the pseudo-random number generator for that replicate with \n  $$ s_{i,j} \\;=\\; s_0 \\;+\\; 104729\\, i \\;+\\; 10007\\, j, $$\n  where $104729$ and $10007$ are fixed integers. All uniform random variates used by SSA must be generated from this seeded stream.\n- Rounding: Report $f$ and $\\bar{\\tau}$ rounded to three decimal places.\n\nTest suite:\nUse the following four parameter sets, each with $N=64$ replicates and base seed $s_0 = 1357911$. All other parameters not explicitly varied are identical across cases. Specifically:\n- Shared parameters for all cases:\n  - $k_{X,0} = 12.0$ molecules/minute,\n  - $k_Y = 12.0$ molecules/minute,\n  - $d_X = 0.2$ per minute,\n  - $d_Y = 0.2$ per minute,\n  - $K = 40$ molecules,\n  - $n = 2$ (dimensionless Hill coefficient),\n  - $h = 20$ molecules,\n  - $X_0 = 10$ molecules,\n  - $Y_0 = 90$ molecules,\n  - $T_{\\max} = 200.0$ minutes,\n  - $N = 64$,\n  - $s_0 = 1357911$.\n- Case $0$ (happy path): $p = 3.0$, $T_p = 10.0$ minutes.\n- Case $1$ (boundary/weak pulse): $p = 1.5$, $T_p = 10.0$ minutes.\n- Case $2$ (no pulse control): $p = 1.0$, $T_p = 0.0$ minutes.\n- Case $3$ (strong/brief pulse): $p = 4.0$, $T_p = 5.0$ minutes.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of pairs $\\left[f,\\bar{\\tau}\\right]$ for the cases in order $0,1,2,3$, enclosed in square brackets, with no whitespace. For example, the syntactic shape must be \n  $$\\left[\\left[f_0,\\bar{\\tau}_0\\right],\\left[f_1,\\bar{\\tau}_1\\right],\\left[f_2,\\bar{\\tau}_2\\right],\\left[f_3,\\bar{\\tau}_3\\right]\\right],$$\n  with both $f_i$ and $\\bar{\\tau}_i$ rounded to three decimal places and $\\bar{\\tau}_i$ equal to $-1.0$ if no switching was observed in case $i$.", "solution": "We derive an exact stochastic simulation and a computable definition of first-passage switching times in a bistable toggle switch subject to a transient environmental pulse, using the foundational principles of the Chemical Master Equation (CME) and the Stochastic Simulation Algorithm (SSA).\n\nPrincipled modeling of bistability and environmental control:\n- In a well-mixed volume at constant temperature, the CME models the time evolution of the probability distribution over molecular counts. Each reaction channel is a Poisson process with an instantaneous hazard equal to its propensity. Exact sample paths can be generated with the SSA of Daniel T. Gillespie.\n- Mutual repression is captured via Hill-type repression. If species $Y$ represses $X$, then the effective synthesis rate of $X$ is $k_X\\left(t\\right)\\,/\\left(1+\\left(\\frac{Y}{K}\\right)^n\\right)$, where $K$ is a dissociation parameter and $n$ is a Hill coefficient. Bistability in the deterministic analog can occur for sufficiently strong nonlinearity, and in the stochastic setting, the system exhibits metastable states corresponding to $X$-dominant and $Y$-dominant phenotypes. This provides a quantitative basis for polyphenism: the environment can transiently modify parameters to bias state occupancy.\n- Here, the environment acts as a transient pulse that multiplies the synthesis propensity of $X$ by a factor $p$ during a window $0 \\le t  T_p$.\n\nReaction system and propensities:\n- We model four reactions: synthesis and degradation for each of $X$ and $Y$.\n- The propensities at state $\\left(X,Y\\right)$ and time $t$ are\n  $$ a_1\\left(X,Y,t\\right) \\;=\\; \\frac{k_X\\left(t\\right)}{1+\\left(\\frac{Y}{K}\\right)^n}, \\quad a_2\\left(X,Y,t\\right) \\;=\\; d_X X, $$\n  $$ a_3\\left(X,Y,t\\right) \\;=\\; \\frac{k_Y}{1+\\left(\\frac{X}{K}\\right)^n}, \\quad a_4\\left(X,Y,t\\right) \\;=\\; d_Y Y, $$\n  with $k_X\\left(t\\right) = p\\,k_{X,0}$ for $0 \\le t  T_p$ and $k_X\\left(t\\right) = k_{X,0}$ otherwise. The Hill coefficient $n$ is dimensionless, and $K$ is in molecules, consistent with $X$ and $Y$ being discrete counts.\n\nExact stochastic simulation (Gillespie SSA):\n- Given propensities $a_1,\\dots,a_4$, the total propensity is $a_0 = \\sum_{r=1}^{4} a_r$. The CME implies that the waiting time $\\Delta t$ to the next reaction is exponentially distributed with rate $a_0$, so we can sample it as \n  $$ \\Delta t \\;=\\; \\frac{1}{a_0} \\ln\\left(\\frac{1}{u_1}\\right), $$\n  where $u_1 \\sim \\text{Uniform}\\left(0,1\\right)$. The reaction index $r$ is chosen by drawing $u_2 \\sim \\text{Uniform}\\left(0,1\\right)$ and selecting the smallest $r$ such that $\\sum_{q=1}^{r} a_q \\ge u_2 a_0$. The state is updated by the stoichiometric change of reaction $r$, and time advances by $\\Delta t$. This process is repeated until a stopping condition is met.\n- The algorithm above is exact for the CME and is therefore the correct foundation for sampling switching times.\n\nSwitching time definition and detection:\n- We define the switching time as the first-passage time to the set $\\{ (X,Y): X-Y \\ge h \\}$ starting from $X_0 - Y_0 \\le -h$. Because the SSA produces a right-continuous piecewise-constant sample path that jumps at reaction times, we detect switching immediately after a reaction update at time $t$ if $X-Y \\ge h$ holds.\n- If no switching occurs by $T_{\\max}$, the trajectory is classified as non-switching.\n\nMonte Carlo estimation for each parameter set:\n- For each test case, we run $N$ independent replicates. Let $M$ be the number of replicates that switch and $\\tau_1,\\dots,\\tau_M$ the corresponding switching times. We compute the fraction switched $f = M/N$ and the conditional mean switching time $\\bar{\\tau} = \\left(\\sum_{i=1}^M \\tau_i\\right)/M$ in minutes. If $M=0$ we adopt the convention $\\bar{\\tau}=-1.0$ to avoid undefined division.\n- To ensure reproducibility and independence of replicates, we deterministically seed each replicate’s pseudo-random number generator (PRNG). Using a fixed base seed $s_0$ and coprime offsets, we choose\n  $$ s_{i,j} \\;=\\; s_0 \\;+\\; 104729\\, i \\;+\\; 10007\\, j, $$\n  where $i \\in \\{0,1,2,3\\}$ is the test-case index and $j \\in \\{0,\\dots,N-1\\}$ is the replicate index. This provides independent streams while preserving full reproducibility.\n\nAlgorithmic steps:\n- For each case $i$:\n  - For each replicate $j$:\n    1. Initialize $\\left(t,X,Y\\right) \\leftarrow \\left(0,X_0,Y_0\\right)$; if $X-Y \\ge h$, record $\\tau=0$ and continue to next replicate.\n    2. Loop:\n       - Compute $k_X\\left(t\\right)$ from the pulse rule and the propensities $a_1,\\dots,a_4$.\n       - Compute $a_0 = \\sum_{r=1}^4 a_r$.\n       - Draw $u_1,u_2$ from the uniform distribution $\\text{Uniform}\\left(0,1\\right)$ using the PRNG with seed $s_{i,j}$.\n       - Set $\\Delta t = \\left(1/a_0\\right)\\ln\\left(1/u_1\\right)$ and choose reaction $r$ by cumulative sums versus $u_2 a_0$.\n       - Update $\\left(X,Y\\right)$ and $t \\leftarrow t + \\Delta t$.\n       - If $X-Y \\ge h$, set $\\tau = t$ and stop the loop; if $t \\ge T_{\\max}$, mark non-switching and stop.\n  - Aggregate $M$, $f = M/N$, and $\\bar{\\tau}$ (with $\\bar{\\tau}=-1.0$ if $M=0$).\n  - Round $f$ and $\\bar{\\tau}$ to three decimal places.\n- Output the results as a single line: a list of four pairs $\\left[f,\\bar{\\tau}\\right]$ for cases $0,1,2,3$ with no whitespace.\n\nScientific realism and connection to developmental plasticity:\n- The toggle switch with Hill repression is an established minimal model for bistable gene circuits. Stochasticity in gene expression induces fluctuations that can lead to probabilistic switching. A transient environmental pulse that modifies $k_X\\left(t\\right)$ temporarily shifts the landscape, biasing the system toward the $X$-high phenotype. The computed distribution of first-passage times identifies how pulse intensity and duration modulate polyphenic outcomes.\n- The test suite covers a happy path (moderate pulse promotes frequent switching), a boundary case (weak pulse yields rare switching), a control (no pulse, effectively testing spontaneous switching within the imposed time horizon), and a strong/brief pulse ensuring fast and frequent switching.\n\nNumerical specification for the test suite:\n- Shared parameters: $k_{X,0}=12.0$, $k_Y=12.0$, $d_X=0.2$, $d_Y=0.2$, $K=40$, $n=2$, $h=20$, $X_0=10$, $Y_0=90$, $T_{\\max}=200.0$, $N=64$, $s_0=1357911$. Pulse parameters per case:\n  - Case $0$: $p=3.0$, $T_p=10.0$.\n  - Case $1$: $p=1.5$, $T_p=10.0$.\n  - Case $2$: $p=1.0$, $T_p=0.0$.\n  - Case $3$: $p=4.0$, $T_p=5.0$.\nAll times are in minutes, rate constants are in molecules per minute or per minute as appropriate, and molecule counts are dimensionless integers. The final output is formatted as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef hill_repression(z, K, n):\n    # Returns 1 / (1 + (z/K)^n) as a float\n    return 1.0 / (1.0 + (float(z) / float(K)) ** float(n))\n\ndef gillespie_switch_time(params, rng):\n    # Unpack parameters\n    kX0 = params[\"kX0\"]\n    kY = params[\"kY\"]\n    dX = params[\"dX\"]\n    dY = params[\"dY\"]\n    K = params[\"K\"]\n    n = params[\"n\"]\n    p = params[\"pulse_factor\"]\n    Tp = params[\"pulse_duration\"]\n    h = params[\"h\"]\n    Tmax = params[\"Tmax\"]\n    X = int(params[\"X0\"])\n    Y = int(params[\"Y0\"])\n\n    t = 0.0\n\n    # Immediate check: already in X-dominant state by threshold?\n    if X - Y = h:\n        return 0.0  # switched at time 0\n\n    # Safety cap on maximum reaction events to avoid runaway loops (should not trigger)\n    max_events = 10_000_000\n    event_count = 0\n\n    while t  Tmax and event_count  max_events:\n        # Compute time-dependent kX(t) due to pulse\n        kXt = (p * kX0) if t  Tp else kX0\n\n        # Compute propensities\n        a1 = kXt * hill_repression(Y, K, n)       # X synthesis\n        a2 = dX * X                                # X degradation\n        a3 = kY * hill_repression(X, K, n)         # Y synthesis\n        a4 = dY * Y                                # Y degradation\n\n        a0 = a1 + a2 + a3 + a4\n\n        # If a0 is zero (should not occur with given params), stop\n        if a0 = 0.0:\n            break\n\n        # Draw two uniforms\n        u1 = rng.random()\n        while u1 = 0.0:\n            u1 = rng.random()\n        u2 = rng.random()\n\n        # Time to next event\n        dt = (1.0 / a0) * np.log(1.0 / u1)\n        t_next = t + dt\n\n        # Determine which reaction fires\n        thresh = u2 * a0\n        # Cumulative sum\n        c = a1\n        if thresh  c:\n            # X synthesis\n            X += 1\n        else:\n            c += a2\n            if thresh  c:\n                # X degradation\n                if X  0:\n                    X -= 1\n            else:\n                c += a3\n                if thresh  c:\n                    # Y synthesis\n                    Y += 1\n                else:\n                    # Y degradation\n                    if Y  0:\n                        Y -= 1\n\n        # Advance time\n        t = t_next\n        event_count += 1\n\n        # Check switching condition after state update\n        if X - Y = params[\"h\"]:\n            return t\n\n    # If loop ends without switching before Tmax, return None\n    return None\n\ndef simulate_case(case_params, case_index, N, base_seed):\n    switch_times = []\n    for j in range(N):\n        # Independent, reproducible seed per replicate\n        seed = int(base_seed + 104729 * case_index + 10007 * j)\n        rng = np.random.default_rng(seed)\n        tau = gillespie_switch_time(case_params, rng)\n        if tau is not None:\n            switch_times.append(tau)\n\n    M = len(switch_times)\n    f = M / float(N)\n    if M == 0:\n        mean_tau = -1.0\n    else:\n        mean_tau = float(np.mean(switch_times))\n\n    # Round to three decimals for reporting\n    f_rounded = round(f, 3)\n    mean_tau_rounded = round(mean_tau, 3)\n    return f_rounded, mean_tau_rounded\n\ndef solve():\n    # Shared parameters\n    shared = {\n        \"kX0\": 12.0,        # molecules/min\n        \"kY\": 12.0,         # molecules/min\n        \"dX\": 0.2,          # per min\n        \"dY\": 0.2,          # per min\n        \"K\": 40,            # molecules\n        \"n\": 2,             # Hill coefficient\n        \"h\": 20,            # molecules\n        \"X0\": 10,           # molecules\n        \"Y0\": 90,           # molecules\n        \"Tmax\": 200.0       # minutes\n    }\n\n    # Test suite cases\n    test_cases = [\n        # Case 0: happy path\n        {\n            **shared,\n            \"pulse_factor\": 3.0,\n            \"pulse_duration\": 10.0\n        },\n        # Case 1: boundary/weak pulse\n        {\n            **shared,\n            \"pulse_factor\": 1.5,\n            \"pulse_duration\": 10.0\n        },\n        # Case 2: no pulse control\n        {\n            **shared,\n            \"pulse_factor\": 1.0,\n            \"pulse_duration\": 0.0\n        },\n        # Case 3: strong/brief pulse\n        {\n            **shared,\n            \"pulse_factor\": 4.0,\n            \"pulse_duration\": 5.0\n        }\n    ]\n\n    N = 64\n    base_seed = 1357911\n\n    results = []\n    for i, params in enumerate(test_cases):\n        f, mt = simulate_case(params, i, N, base_seed)\n        results.append((f, mt))\n\n    # Produce exact required format: [[f0,mt0],[f1,mt1],[f2,mt2],[f3,mt3]]\n    out = \"[\" + \",\".join(f\"[{f:.3f},{mt:.3f}]\" for (f, mt) in results) + \"]\"\n    print(out)\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2630111"}]}