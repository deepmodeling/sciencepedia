{"hands_on_practices": [{"introduction": "After identifying distinct cell clusters, a key task in single-cell analysis is to interpret what defines them. Averages can be misleading; to truly understand a cluster's identity, we must examine the full distribution of gene expression. This exercise focuses on interpreting violin plots, a fundamental visualization that reveals the density of cells at different expression levels. By learning to read the shape, width, and peaks of these plots, you can decipher complex biological stories, such as distinguishing a uniform cellular response from a state of heterogeneity involving mixed populations of responding and non-responding cells [@problem_id:2268290].", "problem": "A team of immunologists is studying macrophage activation using single-cell RNA sequencing (scRNA-seq), a technique that measures gene expression levels in thousands of individual cells. After processing their data, they identified three distinct clusters of macrophages, which they labeled Cluster A, Cluster B, and Cluster C. They then generated violin plots to visualize the expression of the gene for Tumor Necrosis Factor (*TNF*), a potent pro-inflammatory cytokine, within each cluster.\n\nA violin plot is a method of plotting numerical data. The shape of the \"violin\" represents the probability density of the data at different values, with wider sections representing a higher frequency of cells expressing the gene at that level. A dot or line inside typically marks the median expression for the cluster.\n\nThe researchers observed the following characteristics for the *TNF* gene expression violin plots:\n\n*   **Cluster A:** The plot is broad and distinctly bimodal, meaning it has two peaks. One peak is near zero expression, and a second, substantial peak is at a high expression level. The median expression is moderate.\n*   **Cluster B:** The plot is very narrow and centered at a high expression level. The vast majority of cells in this cluster show a similar, high level of *TNF* expression.\n*   **Cluster C:** The plot is wide and strongly skewed towards zero expression. Most cells show little to no *TNF* expression, but there is a long \"tail\" of cells with progressively higher expression levels. The median expression is very low.\n\nBased on these descriptions of the violin plots for *TNF* expression, which of the following statements provides the most accurate biological interpretation?\n\nA. Cluster C represents the most potent pro-inflammatory macrophage population because its violin plot is the widest, indicating a diverse response.\n\nB. The cells in Cluster A are uniformly and strongly responding to a pro-inflammatory stimulus, as indicated by its moderate median *TNF* expression.\n\nC. Cluster B represents a highly homogeneous population of macrophages mounting a strong, consistent pro-inflammatory response, while Cluster A contains a heterogeneous population with a subset of strongly responding cells.\n\nD. The total amount of TNF protein produced by all cells in Cluster C is likely greater than that produced by Cluster B, because Cluster C's distribution covers a wider range of expression values.", "solution": "Interpretation principles for violin plots: the width at a given expression value $x$ reflects the probability density $p(x)$ of cells at that expression level; multiple peaks indicate multimodality; the median summarizes central tendency; skewness indicates the direction of a long tail. For biological interpretation of pro-inflammatory response via TNF, higher expression across many cells indicates stronger and more consistent activation, while heterogeneity indicates mixed responding and non-responding subpopulations.\n\nFor Cluster A, the violin is broad and bimodal with one peak near zero and another at high expression, and the median is moderate. Let $p_{A}(x)$ denote the expression distribution. The two modes, one near $x \\approx 0$ and one at a high $x$, imply a mixture model with a subpopulation of non- or low-responders and a subpopulation of strong responders. The moderate median arises because the cumulative distribution function crosses $0.5$ between the two modes, not because most cells are at a moderate level. Therefore, Cluster A is heterogeneous, not uniformly strongly responding.\n\nFor Cluster B, the violin is very narrow and centered at a high expression level. Let $p_{B}(x)$ be tightly concentrated with small variance around a large mean $\\mu_{B}$ and median $m_{B}$, both high. This indicates that nearly all cells have similar, high TNF expression; biologically, this is a homogeneous population mounting a strong, consistent pro-inflammatory response.\n\nFor Cluster C, the violin is wide and strongly skewed toward zero, with a long right tail and a very low median. Let $p_{C}(x)$ be heavily weighted near $x \\approx 0$ with a long tail to larger $x$. The low median $m_{C}$ and high density near zero imply that most cells have little to no TNF expression, with only a minority showing progressively higher levels. This indicates predominantly weak or absent response with a small subset of higher responders; variability (width) reflects heterogeneity, not potency.\n\nEvaluate the options:\n- Option A claims Cluster C is the most potent because its violin is widest. This confuses variability with potency. Given $m_{C}$ is very low and most density is near zero, Cluster C is not the most potent; the width reflects heterogeneity and a tail, not strong overall activation. Thus A is incorrect.\n- Option B claims Cluster A is uniformly and strongly responding based on a moderate median. The bimodality of $p_{A}(x)$ with a peak near zero contradicts uniform strong response; the moderate median is a consequence of mixing low and high subpopulations. Thus B is incorrect.\n- Option C states Cluster B is a highly homogeneous, strongly responding population, while Cluster A is heterogeneous with a subset of strong responders. This matches the narrow, high-centered $p_{B}(x)$ and the bimodal $p_{A}(x)$ with a high-expression subpopulation. Thus C is correct.\n- Option D claims the total TNF from Cluster C likely exceeds Cluster B because Câ€™s distribution spans a wider range. Total production is proportional to the sum (or mean $\\mu$ times cell count), not the range or width. Given Cluster B has high expression for the vast majority of cells (large $\\mu_{B}$), whereas Cluster C has most cells near zero (small $\\mu_{C}$ despite a tail), it is not supported that Cluster C would produce more total TNF; the justification via range is flawed. Thus D is incorrect.\n\nTherefore, the most accurate interpretation is that Cluster B is homogeneous with a strong, consistent response, and Cluster A is heterogeneous with a subset of strongly responding cells.", "answer": "$$\\boxed{C}$$", "id": "2268290"}, {"introduction": "To capture the complexity of a biological process, immunologists often look beyond single genes and instead assess the coordinated activity of a whole set of functionally related genes. This concept can be formalized by calculating a \"signature score,\" which condenses the expression of multiple genes into a single, quantitative metric for a cell's functional state. This practice demonstrates how to calculate such a score to measure the cytotoxic potential of T-cells, providing a powerful method to overlay functional information onto clustering results and directly compare the activity of different cell populations [@problem_id:2268244].", "problem": "An immunologist is analyzing a single-cell RNA sequencing (scRNA-seq) dataset from Tumor-Infiltrating Lymphocytes (TILs) to understand the functional states of cytotoxic T-cells. After initial processing and dimensionality reduction using Uniform Manifold Approximation and Projection (UMAP), two distinct clusters of CD8+ T-cells, denoted Cluster A and Cluster B, have been identified. To quantitatively compare their cytotoxic potential, a \"Cytotoxicity Score\" ($S_{\\text{cyto}}$) is calculated for each individual cell based on the expression of key genes.\n\nThe score is defined as the difference between the mean expression of an effector gene set ($G_{\\text{eff}}$) and the mean expression of a control gene set ($G_{\\text{ctrl}}$). The formula is:\n$$S_{\\text{cyto}} = \\left( \\frac{1}{N_{\\text{eff}}} \\sum_{i \\in G_{\\text{eff}}} E_i \\right) - \\left( \\frac{1}{N_{\\text{ctrl}}} \\sum_{j \\in G_{\\text{ctrl}}} E_j \\right)$$\nwhere $E_k$ is the log-normalized expression value for gene $k$, $N_{\\text{eff}}$ is the number of genes in the effector set, and $N_{\\text{ctrl}}$ is the number of genes in the control set. The expression values and the resulting score are dimensionless.\n\nThe gene sets are defined as:\n- Effector gene set, $G_{\\text{eff}} = \\{\\text{GZMB, PRF1, IFNG}\\}$\n- Control gene set, $G_{\\text{ctrl}} = \\{\\text{ACTB, GAPDH}\\}$\n\nBelow are the log-normalized expression values for three representative cells from each cluster:\n\n**Cluster A:**\n- Cell A1: GZMB = 4.5, PRF1 = 5.0, IFNG = 3.1, ACTB = 2.1, GAPDH = 2.3\n- Cell A2: GZMB = 4.8, PRF1 = 4.7, IFNG = 3.5, ACTB = 2.0, GAPDH = 2.2\n- Cell A3: GZMB = 4.2, PRF1 = 5.3, IFNG = 3.3, ACTB = 2.2, GAPDH = 2.4\n\n**Cluster B:**\n- Cell B1: GZMB = 1.2, PRF1 = 1.5, IFNG = 0.8, ACTB = 2.3, GAPDH = 2.5\n- Cell B2: GZMB = 0.9, PRF1 = 1.3, IFNG = 0.5, ACTB = 2.1, GAPDH = 2.1\n- Cell B3: GZMB = 1.4, PRF1 = 1.1, IFNG = 1.0, ACTB = 2.2, GAPDH = 2.4\n\nYour task is to calculate the average cytotoxicity score for Cluster A ($\\bar{S}_A$) and the average cytotoxicity score for Cluster B ($\\bar{S}_B$). Then, determine the ratio of the average score of Cluster A to that of Cluster B.\n\nExpress your final answer for the ratio $\\frac{\\bar{S}_A}{\\bar{S}_B}$ as a numerical value, rounded to three significant figures.", "solution": "We define the per-cell cytotoxicity score as\n$$S_{\\text{cyto}}=\\left(\\frac{1}{N_{\\text{eff}}}\\sum_{i\\in G_{\\text{eff}}}E_{i}\\right)-\\left(\\frac{1}{N_{\\text{ctrl}}}\\sum_{j\\in G_{\\text{ctrl}}}E_{j}\\right),$$\nwith $N_{\\text{eff}}=3$ and $N_{\\text{ctrl}}=2$.\n\nFor Cluster A:\n- Cell A1:\n$$S_{\\text{cyto}}(\\text{A1})=\\left(\\frac{4.5+5.0+3.1}{3}\\right)-\\left(\\frac{2.1+2.3}{2}\\right)=\\left(\\frac{12.6}{3}\\right)-\\left(\\frac{4.4}{2}\\right)=4.2-2.2=2.0.$$\n- Cell A2:\n$$S_{\\text{cyto}}(\\text{A2})=\\left(\\frac{4.8+4.7+3.5}{3}\\right)-\\left(\\frac{2.0+2.2}{2}\\right)=\\left(\\frac{13.0}{3}\\right)-\\left(\\frac{4.2}{2}\\right)=\\frac{13}{3}-2.1=\\frac{67}{30}\\approx 2.233\\ldots.$$\n- Cell A3:\n$$S_{\\text{cyto}}(\\text{A3})=\\left(\\frac{4.2+5.3+3.3}{3}\\right)-\\left(\\frac{2.2+2.4}{2}\\right)=\\left(\\frac{12.8}{3}\\right)-\\left(\\frac{4.6}{2}\\right)=\\frac{64}{15}-2.3=\\frac{59}{30}\\approx 1.966\\ldots.$$\nAverage for Cluster A:\n$$\\bar{S}_{A}=\\frac{2.0+\\frac{67}{30}+\\frac{59}{30}}{3}=\\frac{\\frac{60}{30}+\\frac{67}{30}+\\frac{59}{30}}{3}=\\frac{\\frac{186}{30}}{3}=\\frac{31}{15}\\approx 2.066\\ldots.$$\n\nFor Cluster B:\n- Cell B1:\n$$S_{\\text{cyto}}(\\text{B1})=\\left(\\frac{1.2+1.5+0.8}{3}\\right)-\\left(\\frac{2.3+2.5}{2}\\right)=\\left(\\frac{3.5}{3}\\right)-2.4=\\frac{7}{6}-\\frac{12}{5}=-\\frac{37}{30}\\approx -1.233\\ldots.$$\n- Cell B2:\n$$S_{\\text{cyto}}(\\text{B2})=\\left(\\frac{0.9+1.3+0.5}{3}\\right)-\\left(\\frac{2.1+2.1}{2}\\right)=0.9-2.1=-1.2=-\\frac{6}{5}.$$\n- Cell B3:\n$$S_{\\text{cyto}}(\\text{B3})=\\left(\\frac{1.4+1.1+1.0}{3}\\right)-\\left(\\frac{2.2+2.4}{2}\\right)=\\left(\\frac{3.5}{3}\\right)-2.3=\\frac{7}{6}-\\frac{23}{10}=-\\frac{17}{15}\\approx -1.133\\ldots.$$\nAverage for Cluster B:\n$$\\bar{S}_{B}=\\frac{-\\frac{37}{30}-\\frac{6}{5}-\\frac{17}{15}}{3}=\\frac{-\\frac{37}{30}-\\frac{36}{30}-\\frac{34}{30}}{3}=\\frac{-\\frac{107}{30}}{3}=-\\frac{107}{90}\\approx -1.188\\ldots.$$\n\nThe ratio of the averages is\n$$\\frac{\\bar{S}_{A}}{\\bar{S}_{B}}=\\frac{\\frac{31}{15}}{-\\frac{107}{90}}=-\\frac{31}{15}\\cdot\\frac{90}{107}=-\\frac{186}{107}\\approx -1.738317\\ldots.$$\nRounded to three significant figures, the ratio is $-1.74$.", "answer": "$$\\boxed{-1.74}$$", "id": "2268244"}, {"introduction": "The immense number of genes measured in scRNA-seq presents a major analytical challenge, often referred to as the \"curse of dimensionality.\" Principal Component Analysis (PCA) is a cornerstone technique used to reduce this complexity, but its effectiveness hinges on a critical choice: how many principal components (PCs) to retain for downstream analysis. Using too few PCs can obscure subtle but real biological differences, while using too many can introduce technical noise that creates artificial distinctions. This exercise provides a concrete, mathematical framework for navigating this trade-off, illustrating how to select an optimal number of PCs by balancing the retention of biological signal against the exclusion of noise [@problem_id:2268292].", "problem": "An immunologist is analyzing data from a single-cell RNA sequencing (scRNA-seq) experiment designed to characterize the immune cell landscape within a tumor microenvironment. The initial step in the analysis is Principal Component Analysis (PCA), a dimensionality reduction technique used to identify the major axes of variation in the high-dimensional gene expression data.\n\nA simplified model is proposed to describe the variance captured by each principal component (PC). The total variance of the $i$-th PC, $V_i$, is composed of a biological signal component, $S_i$, and a random noise component, $N_i$, such that $V_i = S_i + N_i$.\n\nThe signal variance, which arises from true biological differences between cell types (e.g., T-cells vs. different macrophage subtypes), is modeled to decay exponentially for successive PCs:\n$$S_i = A \\exp(-\\alpha (i-1)) \\quad \\text{for } i \\ge 1$$\nThe noise variance, arising from technical artifacts and stochastic gene expression, is assumed to contribute a constant amount to each PC:\n$$N_i = N_0$$\nThe parameters for this model, derived from the data, are: $A = 100$ (in arbitrary units of variance), $\\alpha = 0.5$, and $N_0 = 5$.\n\nTo select the optimal number of PCs for downstream clustering, a two-part strategy is employed to balance capturing sufficient biological signal against including excessive noise.\n1.  Determine the 'elbow point', $k_{elbow}$, defined as the minimum integer $k$ for which the signal variance is smaller than the noise variance ($S_k  N_k$). Using PCs beyond this point is thought to predominantly add noise.\n2.  Determine the minimum number of PCs, $k_{signal}$, required to capture at least a fraction $f_S = 0.99$ of the *total* biological signal available across all possible PCs.\n\nThe final number of PCs to be used in the analysis, $k_{final}$, is chosen as the maximum of these two values, i.e., $k_{final} = \\max(k_{elbow}, k_{signal})$, to ensure both criteria are met.\n\nCalculate the integer value of $k_{final}$.", "solution": "We are given $V_{i}=S_{i}+N_{i}$ with $S_{i}=A\\exp(-\\alpha(i-1))$ and $N_{i}=N_{0}$, where $A=100$, $\\alpha=0.5$, and $N_{0}=5$. We must compute $k_{elbow}$ and $k_{signal}$, then take $k_{final}=\\max(k_{elbow},k_{signal})$.\n\nElbow point $k_{elbow}$: This is the minimum integer $k$ such that $S_{k}N_{k}=N_{0}$. The inequality\n$$\nA\\exp(-\\alpha(k-1))N_{0}\n$$\nis equivalent (using the monotonicity of the exponential and logarithm) to\n$$\n-\\alpha(k-1)\\ln\\!\\left(\\frac{N_{0}}{A}\\right)\\quad\\Longrightarrow\\quad k-1-\\frac{1}{\\alpha}\\ln\\!\\left(\\frac{N_{0}}{A}\\right)=\\frac{1}{\\alpha}\\ln\\!\\left(\\frac{A}{N_{0}}\\right).\n$$\nThus the minimal integer satisfying the strict inequality is\n$$\nk_{elbow}=\\left\\lfloor 1+\\frac{1}{\\alpha}\\ln\\!\\left(\\frac{A}{N_{0}}\\right)\\right\\rfloor+1.\n$$\nSubstituting $A=100$, $N_{0}=5$, and $\\alpha=0.5$ gives\n$$\n1+\\frac{1}{\\alpha}\\ln\\!\\left(\\frac{A}{N_{0}}\\right)=1+2\\ln(20)\\approx 1+2\\times 2.995732=6.991464,\n$$\nso $k_{elbow}=7$. Directly, $S_{7}=100\\exp(-0.5\\times 6)=100\\exp(-3)\\approx 4.97875$, while $S_{6}=100\\exp(-2.5)\\approx 8.20855$, confirming $k_{elbow}=7$.\n\nSignal coverage $k_{signal}$: Let $r=\\exp(-\\alpha)$. The total biological signal is the geometric series\n$$\nS_{\\text{total}}=\\sum_{i=1}^{\\infty}S_{i}=A\\sum_{j=0}^{\\infty}r^{j}=\\frac{A}{1-r}.\n$$\nThe partial sum through $k$ is\n$$\n\\sum_{i=1}^{k}S_{i}=A\\frac{1-r^{k}}{1-r}.\n$$\nWe require\n$$\nA\\frac{1-r^{k}}{1-r}\\ge f_{S}\\frac{A}{1-r}\\quad\\Longleftrightarrow\\quad 1-r^{k}\\ge f_{S}\\quad\\Longleftrightarrow\\quad r^{k}\\le 1-f_{S}.\n$$\nTaking natural logarithms (noting $0r1$ so $\\ln r0$) gives\n$$\nk\\ln r\\le \\ln(1-f_{S})\\quad\\Longrightarrow\\quad k\\ge \\frac{\\ln(1-f_{S})}{\\ln r}.\n$$\nWith $r=\\exp(-\\alpha)$, $\\ln r=-\\alpha$, so\n$$\nk\\ge \\frac{\\ln(1-f_{S})}{-\\alpha}.\n$$\nFor $f_{S}=0.99$ and $\\alpha=0.5$,\n$$\nk\\ge \\frac{\\ln(0.01)}{-0.5}=\\frac{-\\ln(100)}{-0.5}=\\frac{-4.605170\\ldots}{-0.5}=9.21034\\ldots,\n$$\nso the minimal integer is $k_{signal}=\\lceil 9.21034\\ldots\\rceil=10$. Check: the captured fraction at $k=10$ is $1-r^{10}=1-\\exp(-5)\\approx 0.9933\\ge 0.99$, while at $k=9$ it is $1-\\exp(-4.5)\\approx 0.98890.99$.\n\nFinally,\n$$\nk_{final}=\\max(k_{elbow},k_{signal})=\\max(7,10)=10.\n$$", "answer": "$$\\boxed{10}$$", "id": "2268292"}]}