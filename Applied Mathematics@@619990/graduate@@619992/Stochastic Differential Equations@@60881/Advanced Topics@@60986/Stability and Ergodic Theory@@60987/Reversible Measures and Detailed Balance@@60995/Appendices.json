{"hands_on_practices": [{"introduction": "This first exercise goes to the heart of detailed balance for linear systems. You will work with the Ornstein-Uhlenbeck (OU) process, a cornerstone model in physics and finance, to derive the fundamental algebraic condition for reversibility from first principles [@problem_id:2994321]. This practice solidifies the connection between the Fokker–Planck equation, the Lyapunov equation for the stationary covariance, and the symmetry properties that guarantee a process satisfies detailed balance.", "problem": "Consider the $d$-dimensional Ornstein–Uhlenbeck (OU) process defined by the stochastic differential equation\n$$\n\\mathrm{d}X_{t} \\,=\\, - B X_{t} \\,\\mathrm{d}t \\,+\\, \\sqrt{2}\\, \\sigma \\,\\mathrm{d}W_{t},\n$$\nwhere $B \\in \\mathbb{R}^{d \\times d}$ has eigenvalues with strictly positive real parts (so that the process admits a unique invariant measure), $\\sigma \\in \\mathbb{R}^{d \\times m}$ is a constant matrix, $W_{t}$ is a standard $m$-dimensional Wiener process, and $Q := \\sigma \\sigma^{\\top} \\in \\mathbb{R}^{d \\times d}$ is symmetric positive definite. Let $S \\in \\mathbb{R}^{d \\times d}$ denote the covariance matrix of the invariant Gaussian measure for $X_{t}$.\n\nStarting from first principles in stochastic differential equations and statistical mechanics, namely:\n- the stationary Fokker–Planck equation for diffusion with constant diffusion matrix,\n- the definition of detailed balance as vanishing stationary probability current, and\n- the characterization of $S$ for OU processes via the continuous-time Lyapunov equation,\nderive necessary and sufficient conditions on the pair of matrices $(B,Q)$ under which the OU process is reversible with respect to its invariant Gaussian measure. Your derivation must explicitly connect reversibility to a symmetry condition involving $B$ and $Q$, and relate it to the Lyapunov equation for $S$.\n\nThen, under those conditions, determine the closed-form expression for the invariant covariance $S$ in terms of $B$ and $Q$.\n\nProvide your final answer as a single closed-form analytic matrix expression for $S$ (no equations or inequalities, and no units). Do not round the answer.", "solution": "The problem statement is validated as scientifically grounded, well-posed, objective, and complete. It presents a standard, solvable problem in the theory of stochastic processes.\n\nThe Ornstein-Uhlenbeck (OU) process is described by the stochastic differential equation (SDE):\n$$\n\\mathrm{d}X_{t} \\,=\\, -B X_{t} \\,\\mathrm{d}t \\,+\\, \\sqrt{2} \\sigma \\,\\mathrm{d}W_{t}\n$$\nThis is a linear SDE of the form $\\mathrm{d}X_t = b(X_t) \\mathrm{d}t + \\Sigma(X_t) \\mathrm{d}W_t$, where the drift vector is $b(x) = -Bx$ and the diffusion matrix is $\\Sigma(x) = \\sqrt{2}\\sigma$. The problem specifies that $\\sigma$ is a constant matrix.\n\nThe corresponding stationary Fokker-Planck equation describes the time evolution of the probability density function $p(x)$ of the process. In the stationary state, $\\frac{\\partial p}{\\partial t} = 0$, and the equation reduces to the statement that the divergence of the probability current $J(x)$ is zero: $\\nabla \\cdot J(x) = 0$. The probability current is given by:\n$$\nJ(x) = b(x)p(x) - \\nabla \\cdot (D p(x))\n$$\nwhere $D$ is the diffusion tensor, defined as $D = \\frac{1}{2} \\Sigma \\Sigma^{\\top}$. For this process, we have:\n$$\nD = \\frac{1}{2} (\\sqrt{2}\\sigma)(\\sqrt{2}\\sigma)^{\\top} = \\frac{1}{2} (2 \\sigma\\sigma^{\\top}) = \\sigma\\sigma^{\\top} = Q\n$$\nSince $Q$ is a constant matrix, the gradient term simplifies to $\\nabla \\cdot (Q p(x)) = Q \\nabla p(x)$. The probability current is therefore:\n$$\nJ(x) = -B x p(x) - Q \\nabla p(x)\n$$\n\nThe condition for reversibility, or detailed balance, is a stronger condition than stationarity. It requires the stationary probability current to be identically zero for all $x$: $J(x)=0$. Applying this to our expression for the current gives:\n$$\n-B x p(x) - Q \\nabla p(x) = 0\n$$\n\nThe problem states that the process admits a unique invariant Gaussian measure. The probability density function $p(x)$ of this measure is of the form:\n$$\np(x) = C \\exp\\left(-\\frac{1}{2} x^{\\top} S^{-1} x\\right)\n$$\nwhere $S$ is the symmetric positive definite covariance matrix of the stationary distribution and $C$ is a normalization constant. To use the detailed balance condition, we need the gradient of $p(x)$:\n$$\n\\nabla p(x) = p(x) \\nabla \\left(-\\frac{1}{2} x^{\\top} S^{-1} x\\right)\n$$\nUsing the identity for the gradient of a quadratic form, $\\nabla(x^{\\top} A x) = (A+A^{\\top})x$, and the fact that $S^{-1}$ is symmetric, we find:\n$$\n\\nabla(x^{\\top} S^{-1} x) = 2 S^{-1} x\n$$\nThus, the gradient of the log-probability is $\\nabla \\left(-\\frac{1}{2} x^{\\top} S^{-1} x\\right) = -S^{-1}x$. This gives:\n$$\n\\nabla p(x) = -p(x) S^{-1} x\n$$\n\nNow, we substitute this expression for $\\nabla p(x)$ back into the detailed balance condition, $J(x) = 0$:\n$$\n-B x p(x) - Q(-p(x) S^{-1} x) = 0\n$$\nFor any $x$ where $p(x) > 0$, we can divide by $p(x)$ to obtain:\n$$\n-B x + Q S^{-1} x = 0 \\quad \\implies \\quad (Q S^{-1} - B)x = 0\n$$\nSince this equation must hold for all $x \\in \\mathbb{R}^d$, the matrix factor must be the zero matrix:\n$$\nQ S^{-1} - B = 0 \\quad \\implies \\quad B = Q S^{-1}\n$$\nAssuming $B$ is invertible (which is guaranteed as all its eigenvalues have strictly positive real parts), we can write $S$ in terms of $B$ and $Q$. Right-multiplying by $S$ gives the condition for reversibility in terms of $B$, $Q$, and $S$:\n$$\nBS = Q\n$$\n\nThis condition must be reconciled with the general equation for the stationary covariance matrix $S$. For any OU process of the given form, the stationary covariance matrix $S$ is the unique, symmetric, positive definite solution to the continuous-time Lyapunov equation:\n$$\nBS + SB^{\\top} = 2Q\n$$\nThis equation holds regardless of whether the process is reversible.\n\nFor the process to be reversible, its covariance matrix $S$ must satisfy both the reversibility condition $BS = Q$ and the Lyapunov equation. Substituting $BS=Q$ into the Lyapunov equation gives:\n$$\nQ + SB^{\\top} = 2Q \\quad \\implies \\quad SB^{\\top} = Q\n$$\nTherefore, in the reversible case, the Lyapunov equation effectively splits into two simpler conditions:\n$$\nBS = Q \\quad \\text{and} \\quad SB^{\\top} = Q\n$$\nEquating these two expressions for $Q$ yields $BS = SB^{\\top}$. This is a symmetry condition on the matrix $B$ with respect to the inner product defined by $S$. To obtain a condition purely on the given matrices $B$ and $Q$, we can use $S = B^{-1}Q$ (from $BS=Q$). Substituting this into the second equation, $SB^{\\top}=Q$, gives:\n$$\n(B^{-1}Q)B^{\\top} = Q\n$$\nLeft-multiplying by $B$ gives the necessary condition for reversibility:\n$$\nQB^{\\top} = BQ\n$$\nThis condition states that $B$ and $Q$ must commute in a specific way. It can be interpreted as $B$ being self-adjoint with respect to the inner product induced by $Q^{-1}$.\n\nTo show this condition is also sufficient, we assume $BQ = QB^{\\top}$ and demonstrate that the process is reversible. The stationary covariance $S$ is the unique symmetric positive definite solution to the Lyapunov equation $BS + SB^{\\top} = 2Q$. We must show that if $BQ = QB^{\\top}$, this solution $S$ also satisfies the reversibility condition $BS=Q$.\nLet's propose the candidate solution $S_{p} = B^{-1}Q$.\nFirst, we check if $S_{p}$ is symmetric under the assumption $BQ = QB^{\\top}$:\n$$\nS_{p}^{\\top} = (B^{-1}Q)^{\\top} = Q^{\\top}(B^{-1})^{\\top} = Q(B^{\\top})^{-1}\n$$\nFor $S_{p}$ to be symmetric, we need $B^{-1}Q = Q(B^{\\top})^{-1}$. Left-multiplying by $B$ and right-multiplying by $B^{\\top}$ shows that this is equivalent to $QB^{\\top} = BQ$, our assumed condition. Thus, $S_p$ is symmetric.\nSecond, we check if $S_{p}$ solves the Lyapunov equation under our assumption:\n$$\nBS_{p} + S_{p}B^{\\top} = B(B^{-1}Q) + (B^{-1}Q)B^{\\top} = Q + B^{-1}(QB^{\\top})\n$$\nUsing the assumption $QB^{\\top}=BQ$, the expression becomes:\n$$\nQ + B^{-1}(BQ) = Q + (B^{-1}B)Q = Q + IQ = 2Q\n$$\nSo, $S_{p} = B^{-1}Q$ is indeed the unique symmetric solution to the Lyapunov equation. Therefore, the actual covariance matrix is $S = B^{-1}Q$.\nFinally, for this $S$, we check the reversibility condition $BS=Q$:\n$$\nBS = B(B^{-1}Q) = Q\n$$\nThe condition is satisfied. Thus, the condition $BQ = QB^{\\top}$ is both necessary and sufficient for the OU process to be reversible.\n\nThe second part of the problem asks for the closed-form expression for the invariant covariance $S$ under these conditions. As shown in the sufficiency proof above, when the reversibility condition $BQ = QB^{\\top}$ holds, the stationary covariance matrix $S$ that solves the Lyapunov equation is given by:\n$$\nS = B^{-1}Q\n$$\nThis is the required closed-form expression.", "answer": "$$\n\\boxed{B^{-1}Q}\n$$", "id": "2994321"}, {"introduction": "Understanding a concept often involves studying its absence. This practice presents a system that is stationary but demonstrably *not* reversible, allowing you to dissect the anatomy of irreversibility [@problem_id:2994291]. By analyzing a 2D process with a rotational component, you will see how non-zero stationary currents manifest and learn to decompose the system's generator into its symmetric (reversible) and anti-symmetric (irreversible) parts, providing a quantitative measure of the departure from detailed balance.", "problem": "Consider a two-dimensional Ornstein–Uhlenbeck diffusion process defined by the stochastic differential equation (SDE)\n$$\n\\mathrm{d}X_{t} \\;=\\; - B \\, X_{t} \\,\\mathrm{d}t \\;+\\; \\sqrt{2} \\, \\mathrm{d}W_{t},\n$$\nwhere $X_{t} \\in \\mathbb{R}^{2}$, $W_{t}$ is a standard two-dimensional Brownian motion, and $B \\in \\mathbb{R}^{2 \\times 2}$ is the constant drift matrix\n$$\nB \\;=\\; \\begin{pmatrix} 1 & -\\omega \\\\ \\omega & 1 \\end{pmatrix}\n$$\nwith parameter $\\omega \\in \\mathbb{R} \\setminus \\{0\\}$. The generator $\\mathcal{L}$ acting on twice continuously differentiable functions $f \\colon \\mathbb{R}^{2} \\to \\mathbb{R}$ is\n$$\n\\mathcal{L} f(x) \\;=\\; - (B x) \\cdot \\nabla f(x) \\;+\\; \\Delta f(x),\n$$\nwhere $\\Delta$ is the Laplacian. Let $\\pi$ denote a candidate stationary density for this process and recall that stationarity is defined by the steady-state Fokker–Planck equation $\\mathcal{L}^{*} \\pi = 0$, where $\\mathcal{L}^{*}$ is the adjoint with respect to Lebesgue measure, and that reversibility (detailed balance) is defined by the self-adjointness of $\\mathcal{L}$ in $L^{2}(\\pi)$ with respect to the inner product $\\langle f, g \\rangle_{\\pi} = \\int_{\\mathbb{R}^{2}} f g \\, \\pi$.\n\nStarting from these foundations:\n- Determine a stationary density of Gaussian form $\\pi(x) \\propto \\exp\\!\\big(-\\tfrac{1}{2} x^{\\top} \\Sigma^{-1} x\\big)$ and identify the covariance $\\Sigma$ that solves the steady-state condition.\n- Using the detailed balance definition, verify that the process is stationary but not reversible by establishing the failure of the corresponding symmetry condition and explain how this is connected to the noncommutation $B Q \\neq Q B^{\\top}$ with diffusion matrix $Q = I$.\n- Decompose the generator $\\mathcal{L}$ into the sum of a symmetric part and an antisymmetric part with respect to the $L^{2}(\\pi)$ inner product, and extract the antisymmetric component arising from the drift. Quantify the antisymmetric part by computing the Frobenius norm of its coefficient matrix.\n\nYour final answer must be the exact symbolic expression for the Frobenius norm of the antisymmetric part’s coefficient matrix, expressed as a function of the parameter $\\omega$. No rounding is required. No units are to be provided in the final answer.", "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective. It concerns a standard two-dimensional Ornstein-Uhlenbeck process, and all concepts such as the generator, Fokker-Planck equation, and detailed balance are well-defined within the theory of stochastic differential equations.\n\nThe problem is addressed in three parts: first, determining the stationary density; second, analyzing its reversibility; and third, decomposing the generator to quantify the antisymmetric component.\n\n**1. Stationary Density**\n\nThe given stochastic differential equation (SDE) is a linear Ornstein-Uhlenbeck process:\n$$\n\\mathrm{d}X_{t} = -B X_{t} \\mathrm{d}t + \\sqrt{2} \\mathrm{d}W_{t}\n$$\nwhere $X_{t} \\in \\mathbb{R}^{2}$, $B = \\begin{pmatrix} 1 & -\\omega \\\\ \\omega & 1 \\end{pmatrix}$, and $W_{t}$ is a standard two-dimensional Brownian motion. The SDE is of the form $\\mathrm{d}X_{t} = b(X_t)\\mathrm{d}t + \\sigma \\mathrm{d}W_{t}$ with drift $b(x) = -Bx$ and diffusion matrix $\\sigma = \\sqrt{2}I$. The matrix $Q$ related to the diffusion term is defined by $2Q = \\sigma \\sigma^{\\top}$. Here, $\\sigma \\sigma^{\\top} = (\\sqrt{2}I)(\\sqrt{2}I)^{\\top} = 2I$, which implies $Q=I$.\n\nThe process admits a stationary Gaussian distribution $\\pi(x) \\propto \\exp(-\\frac{1}{2} x^{\\top} \\Sigma^{-1} x)$ if the drift matrix $B$ is stable, i.e., all its eigenvalues have positive real parts. The characteristic equation for $B$ is $\\det(B - \\lambda I) = 0$, which gives $(1-\\lambda)^2 - (-\\omega)(\\omega) = (1-\\lambda)^2 + \\omega^2 = 0$. The eigenvalues are $\\lambda = 1 \\pm i\\omega$. The real part of both eigenvalues is $1 > 0$, so a unique stationary distribution exists.\n\nThe covariance matrix $\\Sigma$ of this stationary distribution is the unique symmetric positive-definite solution to the continuous-time Lyapunov equation:\n$$\nB \\Sigma + \\Sigma B^{\\top} = 2Q\n$$\nSubstituting $B$ and $Q=I$, we have:\n$$\n\\begin{pmatrix} 1 & -\\omega \\\\ \\omega & 1 \\end{pmatrix} \\Sigma + \\Sigma \\begin{pmatrix} 1 & \\omega \\\\ -\\omega & 1 \\end{pmatrix} = 2 \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}\n$$\nLet $\\Sigma = \\begin{pmatrix} a & c \\\\ c & b \\end{pmatrix}$ be a symmetric matrix. The Lyapunov equation becomes:\n$$\n\\begin{pmatrix} 1 & -\\omega \\\\ \\omega & 1 \\end{pmatrix} \\begin{pmatrix} a & c \\\\ c & b \\end{pmatrix} + \\begin{pmatrix} a & c \\\\ c & b \\end{pmatrix} \\begin{pmatrix} 1 & \\omega \\\\ -\\omega & 1 \\end{pmatrix} = \\begin{pmatrix} 2 & 0 \\\\ 0 & 2 \\end{pmatrix}\n$$\n$$\n\\begin{pmatrix} a - c\\omega & c - b\\omega \\\\ a\\omega + c & c\\omega + b \\end{pmatrix} + \\begin{pmatrix} a - c\\omega & a\\omega + c \\\\ c - b\\omega & c\\omega + b \\end{pmatrix} = \\begin{pmatrix} 2 & 0 \\\\ 0 & 2 \\end{pmatrix}\n$$\n$$\n\\begin{pmatrix} 2(a - c\\omega) & (a-b)\\omega + 2c \\\\ (a-b)\\omega + 2c & 2(c\\omega + b) \\end{pmatrix} = \\begin{pmatrix} 2 & 0 \\\\ 0 & 2 \\end{pmatrix}\n$$\nThis yields a system of linear equations for $a, b, c$:\n1. $a - c\\omega = 1$\n2. $(a-b)\\omega + 2c = 0$\n3. $c\\omega + b = 1$\n\nFrom (1) and (3), we get $a = 1 + c\\omega$ and $b = 1 - c\\omega$. Substituting these into (2):\n$$\n((1+c\\omega) - (1-c\\omega))\\omega + 2c = (2c\\omega)\\omega + 2c = 2c\\omega^2 + 2c = 2c(\\omega^2 + 1) = 0\n$$\nSince the problem states $\\omega \\in \\mathbb{R} \\setminus \\{0\\}$, we have $\\omega^2+1 > 0$. Therefore, $c=0$. Substituting $c=0$ back into the expressions for $a$ and $b$ gives $a=1$ and $b=1$.\nThus, the covariance matrix is $\\Sigma = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} = I$. The stationary density is a standard two-dimensional Gaussian:\n$$\n\\pi(x) = \\frac{1}{2\\pi} \\exp\\left(-\\frac{1}{2} x^{\\top} x\\right)\n$$\n\n**2. Stationarity and Non-Reversibility**\n\nThe existence of a unique solution $\\Sigma=I$ to the Lyapunov equation confirms that the process is stationary with the determined Gaussian density $\\pi(x)$.\n\nA diffusion process is reversible (satisfies detailed balance) with respect to its stationary measure $\\pi$ if and only if its generator $\\mathcal{L}$ is self-adjoint in the Hilbert space $L^2(\\pi)$. For an Ornstein-Uhlenbeck process with stationary covariance $\\Sigma$, this condition simplifies to the matrix equation:\n$$\nB\\Sigma = (\\B\\Sigma)^{\\top} = \\Sigma^{\\top}B^{\\top}\n$$\nSince $\\Sigma$ is symmetric ($\\Sigma = \\Sigma^{\\top}$), this is equivalent to $B\\Sigma = \\Sigma B^{\\top}$. In our case, with $\\Sigma=I$, the condition for reversibility becomes $B = B^{\\top}$.\nLet's check this condition:\n$$\nB = \\begin{pmatrix} 1 & -\\omega \\\\ \\omega & 1 \\end{pmatrix}, \\quad B^{\\top} = \\begin{pmatrix} 1 & \\omega \\\\ -\\omega & 1 \\end{pmatrix}\n$$\nFor $B = B^{\\top}$, we must have $-\\omega = \\omega$, which implies $2\\omega=0$, so $\\omega=0$. However, the problem specifies that $\\omega \\in \\mathbb{R} \\setminus \\{0\\}$. Therefore, $B \\neq B^{\\top}$, and the process is not reversible. This non-symmetry is directly linked to the non-commutation property mentioned in the problem, as for $Q=I$, the condition for reversibility $B Q = Q B^{\\top}$ is manifestly $B=B^{\\top}$.\n\n**3. Decomposition of the Generator**\n\nThe generator of the process is $\\mathcal{L}f(x) = - (Bx) \\cdot \\nabla f(x) + \\Delta f(x)$. We can decompose $\\mathcal{L}$ into a symmetric part $\\mathcal{L}_S$ and an antisymmetric part $\\mathcal{L}_A$ with respect to the $L^2(\\pi)$ inner product. This decomposition is based on splitting the drift vector $b(x)$ into a reversible (gradient) part and an irreversible (solenoidal) part.\n$$\nb(x) = D \\nabla \\ln \\pi(x) + j(x)\n$$\nwhere $D = \\frac{1}{2}\\sigma\\sigma^{\\top} = I$ is the diffusion tensor, $D \\nabla \\ln \\pi$ is the reversible drift, and $j(x)$ is the irreversible drift. The generator is then $\\mathcal{L}f = (D \\nabla \\ln \\pi + j(x)) \\cdot \\nabla f + \\Delta f$. The components are:\n- Symmetric part: $\\mathcal{L}_S f = \\frac{1}{\\pi} \\nabla \\cdot (\\pi D \\nabla f) = (D \\nabla \\ln \\pi) \\cdot \\nabla f + \\Delta f$ (since $\\text{tr}(D)=2, \\nabla \\cdot (D \\nabla f) = \\Delta f$)\n- Antisymmetric part: $\\mathcal{L}_A f = j(x) \\cdot \\nabla f$\n\nFor our process, we have $b(x) = -Bx$ and $\\nabla \\ln \\pi(x) = -x$. The irreversible drift $j(x)$ is:\n$$\nj(x) = b(x) - D \\nabla \\ln \\pi(x) = -Bx - I(-x) = -Bx + x = (I-B)x\n$$\nThe antisymmetric part of the generator arising from the drift is therefore $\\mathcal{L}_A f(x) = ((I-B)x) \\cdot \\nabla f(x)$. The \"coefficient matrix\" of this antisymmetric component is the matrix $A$ such that $j(x) = Ax$.\n$$\nA = I - B = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} - \\begin{pmatrix} 1 & -\\omega \\\\ \\omega & 1 \\end{pmatrix} = \\begin{pmatrix} 0 & \\omega \\\\ -\\omega & 0 \\end{pmatrix}\n$$\nThis is a skew-symmetric matrix, as expected for an irreversible drift. To quantify this part, we compute its Frobenius norm $\\|A\\|_F$.\n$$\n\\|A\\|_F = \\sqrt{\\sum_{i=1}^{2}\\sum_{j=1}^{2} |A_{ij}|^2} = \\sqrt{0^2 + \\omega^2 + (-\\omega)^2 + 0^2} = \\sqrt{2\\omega^2}\n$$\nSince $\\omega$ is a real number, this simplifies to:\n$$\n\\|A\\|_F = \\sqrt{2}|\\omega|\n$$\nThis value gives a measure of the strength of the non-reversible part of the dynamics.", "answer": "$$\\boxed{\\sqrt{2}|\\omega|}$$", "id": "2994291"}, {"introduction": "Bridging the gap between continuous-time theory and computational practice is a vital skill. In this final exercise, you will first act as a designer, engineering the precise drift term required to make a stochastic differential equation with state-dependent diffusion reversible with respect to a target measure [@problem_id:2994264]. You will then implement a numerical scheme to verify that the discretized dynamics approximately satisfy the detailed balance condition, offering a powerful lesson in model construction and validation.", "problem": "Consider the one-dimensional Itô Stochastic Differential Equation (SDE)\n$$\ndX_t = b(X_t)\\,dt + \\sqrt{2\\,a(X_t)}\\,dW_t,\n$$\nwhere $W_t$ is a standard Brownian Motion (BM), $a(x) > 0$ is a given twice continuously differentiable diffusion coefficient, and $b(x)$ is a drift to be chosen. Let $\\pi(x)$ be a strictly positive, continuously differentiable target density on $\\mathbb{R}$, and let $\\mathsf{L}$ be the infinitesimal generator acting on smooth functions $f$,\n$$\n\\mathsf{L} f(x) = a(x)\\,f''(x) + b(x)\\,f'(x).\n$$\nWe say that $\\pi(x)\\,dx$ is a reversible measure for the diffusion with generator $\\mathsf{L}$ if the detailed balance condition holds, equivalently if $\\mathsf{L}$ is self-adjoint in $L^2(\\pi)$ on a suitable domain, meaning\n$$\n\\int_{\\mathbb{R}} f(x)\\,\\mathsf{L}g(x)\\,\\pi(x)\\,dx = \\int_{\\mathbb{R}} g(x)\\,\\mathsf{L}f(x)\\,\\pi(x)\\,dx\n$$\nfor sufficiently smooth, compactly supported $f$ and $g$.\n\nYour tasks are:\n\n1. Starting from the requirement that $\\mathsf{L}$ be self-adjoint in $L^2(\\pi)$, derive an explicit expression for the drift $b(x)$ in terms of $a(x)$ and $\\pi(x)$ that ensures reversibility. Do not assume any special form for $a(x)$ or $\\pi(x)$ beyond what is stated above.\n\n2. Specialize to the explicit nonconstant diffusion coefficient\n$$\na(x) = 1 + \\alpha x^2,\n$$\nwhere $\\alpha > 0$ is a parameter, and to the target density\n$$\n\\pi(x) \\propto e^{-V(x)}, \\quad V(x) = \\tfrac{1}{2}x^2.\n$$\nUsing your result from part 1, compute the closed-form expression of $b(x)$ for this choice of $a(x)$ and $\\pi(x)$.\n\n3. For small time step $\\Delta t > 0$, approximate the short-time transition kernel by the Gaussian density\n$$\np_{\\Delta t}(x,y) \\approx \\frac{1}{\\sqrt{4\\pi\\,a(x)\\,\\Delta t}}\\exp\\!\\left(-\\frac{\\big(y - x - b(x)\\,\\Delta t\\big)^2}{4\\,a(x)\\,\\Delta t}\\right),\n$$\nwhich results from an Euler–Maruyama local approximation. Define the detailed-balance log-ratio error at $(x,y)$ for step $\\Delta t$ by\n$$\n\\varepsilon_{\\mathrm{db}}(x,y;\\Delta t) = \\log \\pi(x) + \\log p_{\\Delta t}(x,y) - \\log \\pi(y) - \\log p_{\\Delta t}(y,x).\n$$\nFor each test case described below, compute the maximum absolute error\n$$\nE_{\\max} = \\max_{x \\in \\mathcal{X}} \\max_{k \\in \\{-2,-1,0,1,2\\}} \\left| \\varepsilon_{\\mathrm{db}}\\big(x, x + k\\,\\sigma(x);\\Delta t\\big) \\right|,\n$$\nwhere $\\sigma(x) = \\sqrt{2\\,a(x)\\,\\Delta t}$ and $\\mathcal{X}$ is a uniformly spaced grid on $[-X_{\\max},X_{\\max}]$ of $N$ points with $N \\ge 201$. This metric captures the degree to which the short-time Gaussian kernel approximately satisfies detailed balance with respect to $\\pi$. Report $E_{\\max}$ as a floating-point number for each test case.\n\nScientific realism requirement: use the stated approximation and do not introduce boundary conditions; the domain is $\\mathbb{R}$ and the Gaussian kernel is taken as written. No physical units are involved.\n\nTest suite and output specification:\n- Use the following five test cases, each specified by $(\\alpha,\\Delta t,X_{\\max})$:\n    1. $(0.5, 10^{-3}, 3)$,\n    2. $(0.5, 10^{-4}, 3)$,\n    3. $(1.0, 10^{-3}, 3)$,\n    4. $(0.1, 10^{-3}, 3)$,\n    5. $(0.5, 5\\cdot 10^{-3}, 6)$.\n- For each test case, compute $E_{\\max}$ as described above, with $N=401$ grid points.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\"), in the order of the test cases above. Each \"result\" is the corresponding $E_{\\max}$ as a floating-point number.\n\nThe final answer must be a complete, runnable program that performs the derivation-dependent computations described and outputs the results in the specified format.", "solution": "The problem is assessed to be valid. It is scientifically grounded in the theory of stochastic differential equations, well-posed, objective, and contains all necessary information for a complete solution.\n\nThe solution proceeds in three parts as requested.\n\n### Part 1: Derivation of the Reversibility Drift\n\nWe are tasked with finding the drift coefficient $b(x)$ that makes the infinitesimal generator $\\mathsf{L}$ self-adjoint in the space $L^2(\\pi)$. The generator is given by\n$$ \\mathsf{L} f(x) = a(x)f''(x) + b(x)f'(x) $$\nand the condition for self-adjointness (reversibility with respect to the measure $\\pi(x)dx$) is\n$$ \\int_{\\mathbb{R}} f(x)\\,\\mathsf{L}g(x)\\,\\pi(x)\\,dx = \\int_{\\mathbb{R}} g(x)\\,\\mathsf{L}f(x)\\,\\pi(x)\\,dx $$\nfor all sufficiently smooth functions $f$ and $g$ with compact support.\n\nLet's analyze the left-hand side (LHS) of the self-adjointness condition:\n$$ \\text{LHS} = \\int_{\\mathbb{R}} f(x)\\,(a(x)g''(x) + b(x)g'(x))\\,\\pi(x)\\,dx $$\n$$ \\text{LHS} = \\int_{\\mathbb{R}} f(x)a(x)\\pi(x)\\,g''(x)\\,dx + \\int_{\\mathbb{R}} f(x)b(x)\\pi(x)\\,g'(x)\\,dx $$\nWe apply integration by parts to both terms. Since $f$ and $g$ have compact support, all boundary terms at $\\pm\\infty$ vanish.\n\nFor the first term, we integrate by parts twice:\n$$ \\int_{\\mathbb{R}} [f(x)a(x)\\pi(x)]\\,g''(x)\\,dx = - \\int_{\\mathbb{R}} [f(x)a(x)\\pi(x)]'\\,g'(x)\\,dx = \\int_{\\mathbb{R}} [f(x)a(x)\\pi(x)]''\\,g(x)\\,dx $$\nFor the second term, we integrate by parts once:\n$$ \\int_{\\mathbb{R}} [f(x)b(x)\\pi(x)]\\,g'(x)\\,dx = - \\int_{\\mathbb{R}} [f(x)b(x)\\pi(x)]'\\,g(x)\\,dx $$\nCombining these, the LHS becomes:\n$$ \\text{LHS} = \\int_{\\mathbb{R}} \\left( [f(x)a(x)\\pi(x)]'' - [f(x)b(x)\\pi(x)]' \\right) g(x)\\,dx $$\nThe right-hand side (RHS) of the self-adjointness condition is:\n$$ \\text{RHS} = \\int_{\\mathbb{R}} g(x)\\,\\mathsf{L}f(x)\\,\\pi(x)\\,dx = \\int_{\\mathbb{R}} g(x)\\,(a(x)f''(x) + b(x)f'(x))\\,\\pi(x)\\,dx $$\nFor the integral equality to hold for any arbitrary (compactly supported, smooth) function $g(x)$, the integrands must be equal:\n$$ [f(x)a(x)\\pi(x)]'' - [f(x)b(x)\\pi(x)]' = (a(x)f''(x) + b(x)f'(x))\\,\\pi(x) $$\nLet's expand the derivatives on the left side, using prime notation for differentiation with respect to $x$:\n$$ ( (fa\\pi)' )' - (fb\\pi)' = (f'a\\pi + f(a\\pi)')' - (f'b\\pi + f(b\\pi)') $$\n$$ = (f''a\\pi + f'(a\\pi)' + f'(a\\pi)' + f(a\\pi)'') - (f'b\\pi + f(b\\pi)') $$\n$$ = f''a\\pi + 2f'(a\\pi)' + f(a\\pi)'' - f'b\\pi - f(b\\pi)' $$\n$$ = (a\\pi)f'' + (2(a\\pi)' - b\\pi)f' + ((a\\pi)'' - (b\\pi)')f $$\nNow we equate this with the RHS, which is $(a\\pi)f'' + (b\\pi)f'$. This equality must hold for arbitrary $f$, which means we can equate the coefficients of $f''$, $f'$, and $f$:\n\\begin{itemize}\n    \\item Coefficient of $f''$: $a\\pi = a\\pi$. This is consistent.\n    \\item Coefficient of $f'$: $2(a\\pi)' - b\\pi = b\\pi \\implies 2(a\\pi)' = 2b\\pi \\implies b\\pi = (a\\pi)'$.\n    \\item Coefficient of $f$: $(a\\pi)'' - (b\\pi)' = 0$.\n\\end{itemize}\nThe condition from the coefficient of $f'$ gives $b(x)\\pi(x) = (a(x)\\pi(x))'$. If we substitute this into the condition from the coefficient of $f$, we get $(a\\pi)'' - ((a\\pi)')' = 0$, which is an identity. Thus, the sole condition required for self-adjointness is $b\\pi = (a\\pi)'$.\n\nSolving for $b(x)$, we find:\n$$ b(x) = \\frac{(a(x)\\pi(x))'}{\\pi(x)} = \\frac{a'(x)\\pi(x) + a(x)\\pi'(x)}{\\pi(x)} = a'(x) + a(x)\\frac{\\pi'(x)}{\\pi(x)} $$\nSince $\\pi(x) > 0$, we can express the last term using the logarithmic derivative, $(\\log \\pi(x))' = \\pi'(x)/\\pi(x)$. The final expression for the drift is:\n$$ b(x) = a'(x) + a(x)(\\log \\pi(x))' $$\n\n### Part 2: Specialization to the Given Forms\n\nWe are given the specific diffusion coefficient and target density:\n$$ a(x) = 1 + \\alpha x^2, \\quad \\text{with } \\alpha > 0 $$\n$$ \\pi(x) \\propto e^{-V(x)}, \\quad \\text{with } V(x) = \\tfrac{1}{2}x^2 $$\nFirst, we compute the required derivatives. The derivative of $a(x)$ is:\n$$ a'(x) = \\frac{d}{dx}(1 + \\alpha x^2) = 2\\alpha x $$\nFor the target density, we have $\\pi(x) = C e^{-x^2/2}$ for some normalization constant $C$. We need the logarithmic derivative:\n$$ \\log \\pi(x) = \\log(C e^{-x^2/2}) = \\log C - \\frac{1}{2}x^2 $$\n$$ (\\log \\pi(x))' = \\frac{d}{dx}\\left(\\log C - \\frac{1}{2}x^2\\right) = -x $$\nNow, we substitute these expressions into the formula for $b(x)$ derived in Part 1:\n$$ b(x) = a'(x) + a(x)(\\log \\pi(x))' $$\n$$ b(x) = (2\\alpha x) + (1 + \\alpha x^2)(-x) $$\n$$ b(x) = 2\\alpha x - x - \\alpha x^3 $$\n$$ b(x) = (2\\alpha - 1)x - \\alpha x^3 $$\nThis is the closed-form expression for the drift $b(x)$ that ensures reversibility for the given $a(x)$ and $\\pi(x)$.\n\n### Part 3: Numerical Computation Scheme\n\nThe task is to compute the maximum absolute detailed-balance log-ratio error $E_{\\max}$ for an Euler-Maruyama approximation of the SDE. The error metric is defined as:\n$$ E_{\\max} = \\max_{x \\in \\mathcal{X}} \\max_{k \\in \\{-2,-1,0,1,2\\}} \\left| \\varepsilon_{\\mathrm{db}}\\big(x, x + k\\,\\sigma(x);\\Delta t\\big) \\right| $$\nwhere $\\sigma(x) = \\sqrt{2a(x)\\Delta t}$ and $\\mathcal{X}$ is a grid of $N=401$ points on $[-X_{\\max}, X_{\\max}]$. The log-ratio error is:\n$$ \\varepsilon_{\\mathrm{db}}(x,y;\\Delta t) = \\log \\pi(x) + \\log p_{\\Delta t}(x,y) - \\log \\pi(y) - \\log p_{\\Delta t}(y,x) $$\nUsing $\\log \\pi(x) = -x^2/2 + \\text{const}$ and the given Gaussian approximation for the transition kernel $p_{\\Delta t}$, the error can be written out explicitly as:\n$$ \\varepsilon_{\\mathrm{db}}(x,y;\\Delta t) = \\left(-\\frac{x^2}{2}\\right) - \\left(-\\frac{y^2}{2}\\right) + \\left(-\\frac{1}{2}\\log(4\\pi a(x)\\Delta t) - \\frac{(y - x - b(x)\\Delta t)^2}{4a(x)\\Delta t}\\right) - \\left(-\\frac{1}{2}\\log(4\\pi a(y)\\Delta t) - \\frac{(x - y - b(y)\\Delta t)^2}{4a(y)\\Delta t}\\right) $$\nThe terms involving $4\\pi\\Delta t$ in the logarithms cancel. Rearranging the remaining terms gives the expression to be implemented:\n$$ \\varepsilon_{\\mathrm{db}}(x,y;\\Delta t) = \\frac{y^2 - x^2}{2} + \\frac{1}{2}\\log\\left(\\frac{a(y)}{a(x)}\\right) - \\frac{(y - x - b(x)\\Delta t)^2}{4a(x)\\Delta t} + \\frac{(x - y - b(y)\\Delta t)^2}{4a(y)\\Delta t} $$\nThe algorithm for each test case $(\\alpha, \\Delta t, X_{\\max})$ is as follows:\n1.  Define the functions $a(x) = 1 + \\alpha x^2$ and $b(x) = (2\\alpha - 1)x - \\alpha x^3$.\n2.  Create a uniform grid $\\mathcal{X}$ of $N=401$ points from $-X_{\\max}$ to $X_{\\max}$.\n3.  Initialize a variable `max_error` to $0$.\n4.  Iterate through each point $x$ in the grid $\\mathcal{X}$.\n5.  For each $x$, iterate through $k \\in \\{-2, -1, 1, 2\\}$ (note that for $k=0$, $y=x$ and $\\varepsilon_{\\mathrm{db}}=0$, so it can be skipped).\n6.  Calculate $\\sigma(x) = \\sqrt{2a(x)\\Delta t}$ and the neighbor point $y = x + k\\sigma(x)$.\n7.  Compute $\\varepsilon_{\\mathrm{db}}(x,y;\\Delta t)$ using the formula above.\n8.  Update `max_error = max(max_error, abs(epsilon_db))`.\n9.  After the loops complete, the value of `max_error` is the result $E_{\\max}$ for the test case.\nThe following Python code implements this procedure for the specified test suite.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum detailed-balance log-ratio error for a set of test cases.\n    \"\"\"\n    \n    # Test suite: each case is (alpha, delta_t, X_max)\n    test_cases = [\n        (0.5, 1e-3, 3.0),\n        (0.5, 1e-4, 3.0),\n        (1.0, 1e-3, 3.0),\n        (0.1, 1e-3, 3.0),\n        (0.5, 5e-3, 6.0),\n    ]\n\n    # Grid parameters\n    N = 401\n    k_values = [-2, -1, 1, 2] # k=0 gives trivial zero error\n\n    results = []\n\n    for alpha, dt, X_max in test_cases:\n        \n        # Define the specialized functions a(x) and b(x)\n        def a(x, alpha_val=alpha):\n            return 1.0 + alpha_val * x**2\n\n        def b(x, alpha_val=alpha):\n            return (2.0 * alpha_val - 1.0) * x - alpha_val * x**3\n\n        # Create the spatial grid\n        x_grid = np.linspace(-X_max, X_max, N)\n        \n        max_abs_error_case = 0.0\n\n        for x in x_grid:\n            # Calculate a(x) and b(x) at the grid point\n            a_x = a(x)\n            b_x = b(x)\n            \n            # The standard deviation of the local Gaussian approximation step\n            sigma_x = np.sqrt(2.0 * a_x * dt)\n\n            for k in k_values:\n                y = x + k * sigma_x\n                \n                # Calculate a(y) and b(y) at the neighbor point\n                a_y = a(y)\n                b_y = b(y)\n\n                # Calculate the detailed-balance log-ratio error epsilon_db\n                # epsilon_db = log(pi(x) * p(x,y)) - log(pi(y) * p(y,x))\n                # log pi(z) = -z^2/2 + const. The constants cancel.\n                \n                # log(pi(x)/pi(y))\n                term_pi_ratio = (y**2 - x**2) / 2.0\n                \n                # log(p_xy/p_yx) contains two parts: normalization and exponent\n                # Part 1: log of the ratio of normalization factors\n                # log(sqrt(4*pi*a(y)*dt) / sqrt(4*pi*a(x)*dt)) = 0.5 * log(a(y)/a(x))\n                term_norm_ratio = 0.5 * np.log(a_y / a_x)\n                \n                # Part 2: Difference of exponents\n                # exp_xy = - (y - x - b_x*dt)^2 / (4*a_x*dt)\n                # exp_yx = - (x - y - b_y*dt)^2 / (4*a_y*dt)\n                term_exp_diff = -((y - x - b_x * dt)**2) / (4.0 * a_x * dt) - (-((x - y - b_y * dt)**2) / (4.0 * a_y * dt))\n                \n                epsilon_db = term_pi_ratio + term_norm_ratio + term_exp_diff\n\n                if np.abs(epsilon_db) > max_abs_error_case:\n                    max_abs_error_case = np.abs(epsilon_db)\n        \n        results.append(max_abs_error_case)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```", "id": "2994264"}]}