{"hands_on_practices": [{"introduction": "The reflection principle is a powerful tool for analyzing the extrema of Brownian motion. This first exercise provides hands-on practice with its most direct and fundamental application: deriving the joint probability distribution of the running maximum $M_t$ and the terminal position $B_t$. Mastering this derivation is a crucial first step, as the resulting joint density is a cornerstone for many other results in the field, including the analysis of more complex path properties.", "problem": "Let $\\{B_{s}\\}_{0 \\leq s \\leq t}$ be a standard Brownian motion starting at $B_{0}=0$, and let $M_{t} := \\sup_{0 \\leq s \\leq t} B_{s}$ denote its running maximum up to time $t>0$. Using only the defining properties of Brownian motion (independent, stationary increments and Gaussian transition kernels) together with the reflection principle for Brownian paths, derive the joint probability density function (PDF) of $(M_{t}, B_{t})$. Then, by taking the appropriate ratio of the joint PDF and the marginal PDF of $M_{t}$, show that the conditional law of $B_{t}$ given $M_{t}=m$ is supported on $(-\\infty, m]$ and is given by an explicit expression that can be interpreted as a simple exponential tilt of a Gaussian. Your final answer should be the closed-form expression for the conditional density $f_{B_{t}\\,|\\,M_{t}=m}(x)$ as a function of $x$, $m$, and $t$, written in its simplest form. No numerical approximation is required; provide the exact analytic expression. Ensure that the support restriction is encoded directly in your expression (for example, using an indicator function).", "solution": "The problem asks for the derivation of the conditional probability density function (PDF) of the position of a standard Brownian motion $B_t$ at time $t$, given that its running maximum up to time $t$, $M_t = \\sup_{0 \\leq s \\leq t} B_s$, is equal to a certain value $m$.\n\nLet $\\{B_s\\}_{s \\ge 0}$ be a standard one-dimensional Brownian motion starting at $B_0=0$. Its defining properties include having stationary and independent increments, and $B_t \\sim N(0, t)$, meaning its position at time $t$ follows a normal distribution with mean $0$ and variance $t$. The PDF of $B_t$ is given by $f_{B_t}(x) = \\frac{1}{\\sqrt{2\\pi t}} \\exp(-\\frac{x^2}{2t})$.\n\nThe running maximum is $M_t = \\sup_{0 \\leq s \\leq t} B_s$. We are asked to find the conditional PDF $f_{B_t | M_t=m}(x)$. The standard approach to finding a conditional density is via the formula $f_{Y|X=x}(y) = \\frac{f_{X,Y}(x,y)}{f_X(x)}$. We will therefore first derive the joint PDF of $(M_t, B_t)$, denoted $f_{M_t, B_t}(m,x)$, and the marginal PDF of $M_t$, denoted $f_{M_t}(m)$.\n\nThe key tool for this derivation is the reflection principle for Brownian motion. For any level $a>0$, the reflection principle states that the probability of a Brownian path reaching the level $a$ by time $t$ and ending at a value $x \\le a$ is equal to the probability of the path ending at the reflected value $2a-x$. Formally, for $a>0$ and $x \\le a$:\n$$P(M_t \\ge a, B_t \\le x) = P(B_t \\ge 2a-x)$$\nNote that since Brownian paths are continuous, the event $\\{M_t > a\\}$ is the same as $\\{M_t \\ge a\\}$ up to a set of probability zero.\n\nFirst, we find the joint cumulative distribution function (CDF) $F_{M_t, B_t}(m,x) = P(M_t \\le m, B_t \\le x)$. By definition, $B_t \\le M_t$, so this probability is zero if $x > m$. We thus consider the case where $x \\le m$ and $m \\ge 0$.\nUsing the law of total probability, we can write:\n$$P(B_t \\le x) = P(M_t \\le m, B_t \\le x) + P(M_t > m, B_t \\le x)$$\nRearranging this gives:\n$$P(M_t \\le m, B_t \\le x) = P(B_t \\le x) - P(M_t > m, B_t \\le x)$$\nApplying the reflection principle to the second term with $a=m$:\n$$P(M_t \\le m, B_t \\le x) = P(B_t \\le x) - P(B_t \\ge 2m-x)$$\nLet $\\Phi$ be the CDF of the standard normal distribution $N(0,1)$. Since $B_t/\\sqrt{t} \\sim N(0,1)$, we have $P(B_t \\le z) = \\Phi(z/\\sqrt{t})$. The joint CDF for $x \\le m$ is:\n$$F_{M_t, B_t}(m,x) = \\Phi\\left(\\frac{x}{\\sqrt{t}}\\right) - \\left(1 - \\Phi\\left(\\frac{2m-x}{\\sqrt{t}}\\right)\\right)$$\n\nTo find the joint PDF $f_{M_t, B_t}(m,x)$, we differentiate the CDF with respect to $x$ and then $m$.\n$$f_{M_t, B_t}(m,x) = \\frac{\\partial^2}{\\partial m \\partial x} F_{M_t, B_t}(m,x)$$\nFirst, differentiating with respect to $x$, and letting $\\phi(z) = \\Phi'(z)$ be the standard normal PDF:\n\\begin{align*}\n\\frac{\\partial}{\\partial x} F_{M_t, B_t}(m,x) &= \\frac{\\partial}{\\partial x} \\left[ \\Phi\\left(\\frac{x}{\\sqrt{t}}\\right) - 1 + \\Phi\\left(\\frac{2m-x}{\\sqrt{t}}\\right) \\right] \\\\\n&= \\frac{1}{\\sqrt{t}}\\phi\\left(\\frac{x}{\\sqrt{t}}\\right) + \\frac{1}{\\sqrt{t}}\\phi\\left(\\frac{2m-x}{\\sqrt{t}}\\right) \\cdot (-1) \\\\\n&= f_{B_t}(x) - f_{B_t}(2m-x)\n\\end{align*}\nNow, we differentiate this expression with respect to $m$:\n\\begin{align*}\nf_{M_t, B_t}(m,x) &= \\frac{\\partial}{\\partial m} \\left( f_{B_t}(x) - f_{B_t}(2m-x) \\right) \\\\\n&= 0 - \\frac{d}{du}f_{B_t}(u)\\bigg|_{u=2m-x} \\cdot \\frac{\\partial(2m-x)}{\\partial m} \\\\\n&= -f'_{B_t}(2m-x) \\cdot 2\n\\end{align*}\nThe derivative of the Gaussian PDF $f_{B_t}(u) = \\frac{1}{\\sqrt{2\\pi t}} \\exp(-u^2/2t)$ is $f'_{B_t}(u) = -\\frac{u}{t} f_{B_t}(u)$.\nSubstituting this in, we get:\n$$f_{M_t, B_t}(m,x) = -2 \\left(-\\frac{2m-x}{t} f_{B_t}(2m-x)\\right) = \\frac{2(2m-x)}{t} f_{B_t}(2m-x)$$\nSubstituting the expression for $f_{B_t}$:\n$$f_{M_t, B_t}(m,x) = \\frac{2(2m-x)}{t} \\frac{1}{\\sqrt{2\\pi t}} \\exp\\left(-\\frac{(2m-x)^2}{2t}\\right) = \\frac{2(2m-x)}{\\sqrt{2\\pi t^3}} \\exp\\left(-\\frac{(2m-x)^2}{2t}\\right)$$\nThis density is for $m \\ge 0$ and $x \\le m$. It is zero otherwise.\n\nNext, we find the marginal PDF of the maximum, $f_{M_t}(m)$, by integrating the joint PDF over all possible values of $x$, i.e., $x \\in (-\\infty, m]$. For $m \\ge 0$:\n$$f_{M_t}(m) = \\int_{-\\infty}^{m} f_{M_t, B_t}(m,x) \\,dx = \\int_{-\\infty}^{m} \\frac{2(2m-x)}{t\\sqrt{2\\pi t}} \\exp\\left(-\\frac{(2m-x)^2}{2t}\\right) \\,dx$$\nLet $u = \\frac{(2m-x)^2}{2t}$. Then $du = \\frac{2(2m-x)(-1)}{2t} \\,dx = -\\frac{2m-x}{t} \\,dx$.\nThe limits of integration change from $x \\to -\\infty$ to $u \\to \\infty$, and from $x=m$ to $u = \\frac{(2m-m)^2}{2t} = \\frac{m^2}{2t}$.\n$$f_{M_t}(m) = \\frac{2}{\\sqrt{2\\pi t}} \\int_{\\infty}^{m^2/(2t)} \\exp(-u) (-du) = \\frac{2}{\\sqrt{2\\pi t}} \\int_{m^2/(2t)}^{\\infty} \\exp(-u) \\,du$$\n$$f_{M_t}(m) = \\frac{2}{\\sqrt{2\\pi t}} [-\\exp(-u)]_{m^2/(2t)}^{\\infty} = \\frac{2}{\\sqrt{2\\pi t}} \\left(0 - \\left(-\\exp\\left(-\\frac{m^2}{2t}\\right)\\right)\\right)$$\n$$f_{M_t}(m) = \\frac{2}{\\sqrt{2\\pi t}} \\exp\\left(-\\frac{m^2}{2t}\\right) = \\sqrt{\\frac{2}{\\pi t}} \\exp\\left(-\\frac{m^2}{2t}\\right)$$\nThis is the well-known PDF for the running maximum of a Brownian motion, valid for $m \\ge 0$.\n\nFinally, we compute the conditional PDF $f_{B_t|M_t=m}(x)$ for $m>0$ and $x \\le m$:\n$$f_{B_{t}\\,|\\,M_{t}=m}(x) = \\frac{f_{M_t, B_t}(m,x)}{f_{M_t}(m)} = \\frac{\\frac{2(2m-x)}{t\\sqrt{2\\pi t}} \\exp\\left(-\\frac{(2m-x)^2}{2t}\\right)}{\\frac{2}{\\sqrt{2\\pi t}} \\exp\\left(-\\frac{m^2}{2t}\\right)}$$\n$$f_{B_{t}\\,|\\,M_{t}=m}(x) = \\frac{2m-x}{t} \\exp\\left(-\\frac{(2m-x)^2}{2t} + \\frac{m^2}{2t}\\right)$$\nLet's simplify the term in the exponent:\n$$\\frac{m^2 - (2m-x)^2}{2t} = \\frac{m^2 - (4m^2 - 4mx + x^2)}{2t} = \\frac{-x^2 + 4mx - 3m^2}{2t}$$\nThe quadratic in the numerator can be factored: $-x^2+4mx-3m^2 = -(x^2-4mx+3m^2) = -(x-m)(x-3m)$.\nSo the conditional density is:\n$$f_{B_{t}\\,|\\,M_{t}=m}(x) = \\frac{2m-x}{t} \\exp\\left(-\\frac{(x-m)(x-3m)}{2t}\\right)$$\nThis expression is valid for $x \\le m$. For $x>m$, the density is $0$. We encode this using an indicator function $\\mathbf{1}_{x \\le m}$. The problem's hint about an \"exponential tilt of a Gaussian\" can be seen by rewriting the exponent as $\\frac{-(x-m)^2+2m(x-m)}{2t}$, which separates into a Gaussian-like term centered at $m$ and an exponential tilting term. The pre-factor $(2m-x)/t$ is necessary for normalization. This expression is the complete and exact conditional density.", "answer": "$$\n\\boxed{\\frac{2m-x}{t} \\exp\\left(-\\frac{(x-m)(x-3m)}{2t}\\right) \\mathbf{1}_{x \\le m}}\n$$", "id": "2993824"}, {"introduction": "Building on the probabilistic results of the reflection principle, this exercise demonstrates how to integrate geometric insights with the analytical machinery of martingale theory. You will apply the Optional Stopping Theorem to a carefully chosen stopped Brownian motion to establish a deep connection between path-dependent expectations and hitting time probabilities. This practice is essential for developing a flexible problem-solving approach that combines different pillars of stochastic calculus.", "problem": "Let $\\{B_t\\}_{t\\ge 0}$ be a standard Brownian motion (also called a Wiener process), with $B_0=0$. Fix $a>0$ and define the first hitting time $T_a:=\\inf\\{s\\ge 0:\\, B_s=a\\}$ and the running maximum $M_t:=\\sup_{0\\le s\\le t} B_s$. Consider the bounded stopping time $\\tau:=T_a\\wedge t$ for a given $t>0$. Using that $\\{B_t\\}_{t\\ge 0}$ is a martingale and the Optional Stopping Theorem (OST) at $\\tau$, combine (i) a decomposition of $B_{\\tau}$ into disjoint events $\\{T_a\\le t\\}$ and $\\{T_a>t\\}$ with (ii) the reflection principle for Brownian motion relating the event $\\{M_t\\ge a\\}$ to the one-dimensional Gaussian tail of $B_t$. Based on these ingredients, which of the following statements must hold? Here $\\Phi$ denotes the cumulative distribution function of a standard normal random variable.\n\nA. $\\mathbb{E}\\big[B_t\\,\\mathbf{1}_{\\{T_a>t\\}}\\big]\\,=\\,-a\\,\\mathbb{P}(T_a\\le t)$.\n\nB. $\\mathbb{P}(T_a\\le t)\\,=\\,\\mathbb{P}(B_t\\ge a)$.\n\nC. $\\mathbb{P}(T_a\\le t)\\,=\\,2\\big(1-\\Phi(a/\\sqrt{t})\\big)$.\n\nD. $\\mathbb{E}\\big[B_t\\,\\mathbf{1}_{\\{T_a>t\\}}\\big]\\,=\\,-\\,\\mathbb{E}\\big[B_t\\,\\mathbf{1}_{\\{B_t\\ge a\\}}\\big]$.\n\nE. $\\mathbb{E}\\big[B_t\\,\\mathbf{1}_{\\{T_a>t\\}}\\big]\\,=\\,-\\,2a\\,\\mathbb{P}(B_t\\ge a)$.\n\nF. $\\mathbb{E}\\big[B_{T_a\\wedge t}\\big]\\,=\\,a\\,\\mathbb{P}(T_a\\le t)$.\n\nSelect all that apply, and justify your choices from first principles without invoking any unproven shortcut formulas.", "solution": "The problem statement is scientifically sound and well-posed. We shall proceed by deriving the consequences of the given principles and then evaluating each statement.\n\nLet $\\{B_t\\}_{t \\ge 0}$ be a standard one-dimensional Brownian motion starting at $B_0 = 0$. For a fixed constant $a > 0$, the first hitting time is $T_a = \\inf\\{s \\ge 0: B_s = a\\}$. We consider the stopping time $\\tau = T_a \\wedge t = \\min(T_a, t)$ for a given $t > 0$.\n\nFirst, we apply the Optional Stopping Theorem (OST). The process $\\{B_t\\}_{t \\ge 0}$ is a martingale with respect to its natural filtration. The stopping time $\\tau$ is bounded above by the fixed time $t$, so $\\tau \\le t$. Therefore, the conditions for the OST are met, and we have:\n$$\n\\mathbb{E}[B_{\\tau}] = \\mathbb{E}[B_0]\n$$\nSince $B_0 = 0$, this implies:\n$$\n\\mathbb{E}[B_{T_a \\wedge t}] = 0\n$$\n\nNext, we decompose this expectation over the disjoint events $\\{T_a \\le t\\}$ and $\\{T_a > t\\}$. The union of these events is the entire sample space.\n$$\n\\mathbb{E}[B_{T_a \\wedge t}] = \\mathbb{E}[B_{T_a \\wedge t} \\cdot \\mathbf{1}_{\\{T_a \\le t\\}}] + \\mathbb{E}[B_{T_a \\wedge t} \\cdot \\mathbf{1}_{\\{T_a > t\\}}] = 0\n$$\nLet's analyze each term:\n1.  On the event $\\{T_a \\le t\\}$, the stopping time is $\\tau = T_a$. By definition of $T_a$ and the continuity of Brownian motion paths, $B_{\\tau} = B_{T_a} = a$. Thus, the first term is:\n    $$\n    \\mathbb{E}[B_{T_a} \\cdot \\mathbf{1}_{\\{T_a \\le t\\}}] = \\mathbb{E}[a \\cdot \\mathbf{1}_{\\{T_a \\le t\\}}] = a\\,\\mathbb{P}(T_a \\le t)\n    $$\n2.  On the event $\\{T_a > t\\}$, the stopping time is $\\tau = t$. Thus, $B_{\\tau} = B_t$. The second term is:\n    $$\n    \\mathbb{E}[B_t \\cdot \\mathbf{1}_{\\{T_a > t\\}}]\n    $$\n\nSubstituting these back into the decomposed expectation equation gives:\n$$\na\\,\\mathbb{P}(T_a \\le t) + \\mathbb{E}[B_t\\,\\mathbf{1}_{\\{T_a > t\\}}] = 0\n$$\nThis directly implies the relationship:\n$$\n\\mathbb{E}[B_t\\,\\mathbf{1}_{\\{T_a > t\\}}] = -a\\,\\mathbb{P}(T_a \\le t)\n$$\n\nNow, we introduce the reflection principle. The event that the running maximum $M_t = \\sup_{0 \\le s \\le t} B_s$ is greater than or equal to $a$ is identical to the event that level $a$ is hit by time $t$. That is, $\\{M_t \\ge a\\} = \\{T_a \\le t\\}$. The reflection principle states that for any $a > 0$:\n$$\n\\mathbb{P}(M_t \\ge a) = 2\\,\\mathbb{P}(B_t \\ge a)\n$$\nTherefore, we have:\n$$\n\\mathbb{P}(T_a \\le t) = 2\\,\\mathbb{P}(B_t \\ge a)\n$$\nWe know that $B_t$ is a normally distributed random variable with mean $0$ and variance $t$, i.e., $B_t \\sim \\mathcal{N}(0, t)$. Let $Z = B_t/\\sqrt{t}$ be a standard normal random variable, $Z \\sim \\mathcal{N}(0, 1)$. The cumulative distribution function (CDF) of $Z$ is denoted by $\\Phi$.\n$$\n\\mathbb{P}(B_t \\ge a) = \\mathbb{P}\\left(\\frac{B_t}{\\sqrt{t}} \\ge \\frac{a}{\\sqrt{t}}\\right) = \\mathbb{P}\\left(Z \\ge \\frac{a}{\\sqrt{t}}\\right) = 1 - \\Phi\\left(\\frac{a}{\\sqrt{t}}\\right)\n$$\nCombining this with the reflection principle yields:\n$$\n\\mathbb{P}(T_a \\le t) = 2\\left(1 - \\Phi\\left(\\frac{a}{\\sqrt{t}}\\right)\\right)\n$$\n\nWith these fundamental results established, we can now evaluate each option.\n\n**A. $\\mathbb{E}\\big[B_t\\,\\mathbf{1}_{\\{T_a>t\\}}\\big]\\,=\\,-a\\,\\mathbb{P}(T_a\\le t)$**\nAs derived above from the Optional Stopping Theorem applied to $B_{T_a \\wedge t}$, we found $a\\,\\mathbb{P}(T_a \\le t) + \\mathbb{E}[B_t\\,\\mathbf{1}_{\\{T_a > t\\}}] = 0$. Rearranging this gives precisely the statement in this option.\nVerdict: **Correct**.\n\n**B. $\\mathbb{P}(T_a\\le t)\\,=\\,\\mathbb{P}(B_t\\ge a)$**\nThe reflection principle states $\\mathbb{P}(T_a \\le t) = 2\\,\\mathbb{P}(B_t \\ge a)$. Since $a > 0$ and $t > 0$, we have $\\mathbb{P}(B_t \\ge a) > 0$. Thus, a factor of $2$ is missing.\nVerdict: **Incorrect**.\n\n**C. $\\mathbb{P}(T_a\\le t)\\,=\\,2\\big(1-\\Phi(a/\\sqrt{t})\\big)$**\nThis is a direct consequence of combining the reflection principle with the distribution of $B_t$. As shown in our preliminary derivation: $\\mathbb{P}(T_a \\le t) = 2\\,\\mathbb{P}(B_t \\ge a) = 2\\left(1 - \\Phi\\left(\\frac{a}{\\sqrt{t}}\\right)\\right)$.\nVerdict: **Correct**.\n\n**D. $\\mathbb{E}\\big[B_t\\,\\mathbf{1}_{\\{T_a>t\\}}\\big]\\,=\\,-\\,\\mathbb{E}\\big[B_t\\,\\mathbf{1}_{\\{B_t\\ge a\\}}\\big]$**\nFrom option A, we have $\\mathbb{E}[B_t\\,\\mathbf{1}_{\\{T_a>t\\}}] = -a\\,\\mathbb{P}(T_a \\le t)$. Using the reflection principle, this becomes $\\mathbb{E}[B_t\\,\\mathbf{1}_{\\{T_a>t\\}}] = -2a\\,\\mathbb{P}(B_t \\ge a)$. So the statement is equivalent to asking if $2a\\,\\mathbb{P}(B_t \\ge a) = \\mathbb{E}[B_t\\,\\mathbf{1}_{\\{B_t \\ge a\\}}]$.\nLet's compute the right-hand side. The probability density function of $B_t$ is $f(x) = \\frac{1}{\\sqrt{2\\pi t}} e^{-x^2/(2t)}$.\n$$\n\\mathbb{E}[B_t\\,\\mathbf{1}_{\\{B_t \\ge a\\}}] = \\int_a^\\infty x \\frac{1}{\\sqrt{2\\pi t}} e^{-x^2/(2t)} dx\n$$\nUsing the substitution $u = x^2/(2t)$, we get $du = (x/t)dx$, so $xdx=tdu$.\n$$\n\\int_a^\\infty x f(x) dx = \\frac{1}{\\sqrt{2\\pi t}} \\int_{a^2/(2t)}^\\infty e^{-u} (t\\,du) = \\frac{t}{\\sqrt{2\\pi t}} \\left[-e^{-u}\\right]_{a^2/(2t)}^\\infty = \\sqrt{\\frac{t}{2\\pi}} e^{-a^2/(2t)}\n$$\nSo the identity in question is $2a\\,\\mathbb{P}(B_t \\ge a) = \\sqrt{\\frac{t}{2\\pi}} e^{-a^2/(2t)}$. Let $z=a/\\sqrt{t}$. The identity is $2z\\sqrt{t}\\,(1-\\Phi(z)) = \\sqrt{\\frac{t}{2\\pi}} e^{-z^2/2}$.\nThis simplifies to $2z(1-\\Phi(z)) = \\frac{1}{\\sqrt{2\\pi}} e^{-z^2/2} = \\phi(z)$, where $\\phi$ is the standard normal PDF. This equality does not hold in general.\nVerdict: **Incorrect**.\n\n**E. $\\mathbb{E}\\big[B_t\\,\\mathbf{1}_{\\{T_a>t\\}}\\big]\\,=\\,-\\,2a\\,\\mathbb{P}(B_t\\ge a)$**\nThis comes from combining our previous results. From option A, we know $\\mathbb{E}[B_t\\,\\mathbf{1}_{\\{T_a > t\\}}] = -a\\,\\mathbb{P}(T_a \\le t)$. From the reflection principle, $\\mathbb{P}(T_a \\le t) = 2\\,\\mathbb{P}(B_t \\ge a)$. Substituting the second identity into the first gives the desired statement.\nVerdict: **Correct**.\n\n**F. $\\mathbb{E}\\big[B_{T_a\\wedge t}\\big]\\,=\\,a\\,\\mathbb{P}(T_a\\le t)$**\nAs established from the Optional Stopping Theorem, $\\mathbb{E}[B_{T_a \\wedge t}] = \\mathbb{E}[B_0] = 0$. The right-hand side, $a\\,\\mathbb{P}(T_a \\le t)$, is strictly positive since $a > 0$ and $\\mathbb{P}(T_a \\le t) > 0$ for $t > 0$. Therefore, $0 \\ne a\\,\\mathbb{P}(T_a \\le t)$. The quantity $a\\,\\mathbb{P}(T_a \\le t)$ is one of the terms in the decomposition of the expectation of $B_{T_a \\wedge t}$, not the expectation itself.\nVerdict: **Incorrect**.", "answer": "$$\\boxed{ACE}$$", "id": "2993858"}, {"introduction": "This final practice serves as a capstone, guiding you to one of the most celebrated and non-intuitive results for Brownian motion: the arcsine law for the time of the maximum, $\\tau_t$. The exercise leverages the joint density of $(M_t, B_t)$ derived in a previous practice [@problem_id:2993824] within a sophisticated path decomposition argument rooted in the strong Markov property. Successfully completing this derivation provides a deep appreciation for the exotic temporal structure of Brownian paths.", "problem": "Let $\\{B_{u}\\}_{u \\ge 0}$ be a standard one-dimensional Brownian motion with $B_{0} = 0$. For a fixed $t > 0$, define the running maximum $M_{t} := \\sup_{0 \\le u \\le t} B_{u}$ and the (almost surely unique) time of the maximum $\\tau_{t} := \\inf\\{u \\in [0,t] : B_{u} = M_{t}\\}$. Let $\\varphi_{t}(y) := (2\\pi t)^{-1/2} \\exp(-y^{2}/(2t))$ denote the Gaussian probability density function at time $t$.\n\nUsing only fundamental properties of Brownian motion (independent and stationary increments, symmetry, and the reflection principle), answer the following:\n\n- Derive from first principles an explicit formula for the joint density $f_{M_{t},B_{t}}(m,x)$ for $m > 0$ and $x \\le m$.\n\n- Establish a path decomposition at the maximum time showing that there exists a deterministic function $c(\\cdot)$ such that for $s \\in (0,t)$ and $m > 0$,\n$$\nf_{M_{t},\\tau_{t}}(m,s) \\;=\\; f_{M_{s},B_{s}}(m,m)\\, c(t-s).\n$$\nExplain why $c(\\cdot)$ depends only on the length of the post-maximum interval and not on $m$ or $s$, and determine $c(\\cdot)$ by consistency.\n\n- Using this decomposition together with the derived joint density $f_{M_{t},B_{t}}$, obtain the marginal density of $\\tau_{t}$ on $(0,t)$ as a closed-form analytic expression.\n\nYour final answer should be the closed-form expression for the marginal density $f_{\\tau_{t}}(s)$ for $s \\in (0,t)$. No rounding is required and no physical units are involved. Express the final answer as a single analytic expression.", "solution": "We begin with the fundamental properties of standard Brownian motion: independent and stationary increments, symmetry, and the reflection principle. Fix $t > 0$. Define $M_{t} := \\sup_{0 \\le u \\le t} B_{u}$ and consider $f_{M_{t},B_{t}}(m,x)$ for $m > 0$ and $x \\le m$.\n\nStep 1: Joint density $f_{M_{t},B_{t}}(m,x)$ via reflection principle. For $x < m$, the reflection principle asserts that\n$$\n\\mathbb{P}(M_{t} \\ge m,\\, B_{t} \\in \\mathrm{d}x) \\;=\\; \\mathbb{P}(B_{t} \\in \\mathrm{d}(2m - x)),\n$$\nbecause each path that crosses $m$ before time $t$ and ends at $x$ is mapped bijectively, by reflection at the first hitting time of $m$, to a path that ends at $2m - x$. Consequently,\n$$\n\\mathbb{P}(M_{t} \\ge m,\\, B_{t} \\in \\mathrm{d}x) \\;=\\; \\varphi_{t}(2m - x)\\,\\mathrm{d}x, \\qquad x \\le m,\\; m > 0.\n$$\nDifferentiating with respect to $m$ yields the joint density of $(M_{t},B_{t})$:\n\\begin{align*}\nf_{M_{t},B_{t}}(m,x)\n&= -\\frac{\\partial}{\\partial m}\\Big[\\varphi_{t}(2m - x)\\Big] \\\\\n&= -\\Big(2\\cdot \\frac{\\partial}{\\partial y}\\varphi_{t}(y)\\Big)\\Big|_{y = 2m - x} \\\\\n&= -2\\Big(-\\frac{(2m - x)}{t}\\Big)\\varphi_{t}(2m - x) \\\\\n&= \\frac{2(2m - x)}{t}\\,\\varphi_{t}(2m - x), \\qquad m > 0,\\; x \\le m.\n\\end{align*}\nEquivalently,\n$$\nf_{M_{t},B_{t}}(m,x) \\;=\\; \\frac{2(2m - x)}{\\sqrt{2\\pi}\\, t^{3/2}} \\exp\\!\\Big(-\\frac{(2m - x)^{2}}{2t}\\Big), \\qquad m > 0,\\; x \\le m.\n$$\nAs a consistency check, integrating over $x \\le m$ recovers the marginal density of $M_{t}$:\n\\begin{align*}\n\\int_{-\\infty}^{m} f_{M_{t},B_{t}}(m,x)\\,\\mathrm{d}x\n&= \\int_{u=m}^{\\infty} \\frac{2u}{t}\\,\\varphi_{t}(u)\\,\\mathrm{d}u \\quad (u = 2m - x) \\\\\n&= \\Big[-2\\,\\varphi_{t}(u)\\Big]_{u=m}^{\\infty}\n= 2\\,\\varphi_{t}(m),\n\\end{align*}\nwhich is the well-known consequence of the reflection principle $\\mathbb{P}(M_{t} \\in \\mathrm{d}m) = 2\\,\\varphi_{t}(m)\\,\\mathbf{1}_{\\{m>0\\}}\\,\\mathrm{d}m$.\n\nStep 2: Path decomposition at the maximum time and factorization of $f_{M_{t},\\tau_{t}}$. Define $\\tau_{t} := \\inf\\{u \\in [0,t] : B_{u} = M_{t}\\}$, the (a.s. unique) time at which the overall maximum is achieved. Consider $s \\in (0,t)$ and $m > 0$. On the event $\\{\\tau_{t} = s,\\; M_{t} = m\\}$ we have $B_{s} = m$ and $M_{s} = m$, and the pre-maximum path $\\{B_{u}\\}_{0 \\le u \\le s}$ has endpoint equal to its running supremum. By the strong Markov property at time $s$ and stationary increments, the post-$s$ process $\\{B_{s+u} - B_{s}\\}_{0 \\le u \\le t-s}$ is an independent standard Brownian motion started at $0$. The condition that the overall maximum occurs at time $s$ means that the post-$s$ segment does not exceed $0$ in its supremum (relative to $B_{s}$), i.e., its supremum is attained at $u=0$. In density terms, there is a boundary effect at $0$, and the contribution of the post-maximum segment depends only on the length $t-s$. Therefore, there exists a deterministic function $c(\\cdot)$ such that\n$$\nf_{M_{t},\\tau_{t}}(m,s) \\;=\\; f_{M_{s},B_{s}}(m,m)\\, c(t-s), \\qquad s \\in (0,t),\\; m > 0,\n$$\nwhere\n$$\nf_{M_{s},B_{s}}(m,m) \\;=\\; \\frac{2m}{s}\\,\\varphi_{s}(m) \\;=\\; \\frac{2m}{\\sqrt{2\\pi}\\, s^{3/2}} \\exp\\!\\Big(-\\frac{m^{2}}{2s}\\Big).\n$$\nThe factor $c(t-s)$ captures the post-maximum contribution and, by independence and scaling, depends only on the duration $t-s$.\n\nStep 3: Compute the marginal law of $\\tau_{t}$. For $s \\in (0,t)$, the event $\\{\\tau_{t} \\le s\\}$ is equivalent to the event that the running maximum achieved up to time $s$ is greater than or equal to the maximum achieved on the remaining interval $(s,t]$, relative to the level $B_{s}$. By independent increments and time-reversal symmetry of Brownian motion, this can be stated as:\n$$\n\\mathbb{P}(\\tau_{t} \\le s)\n\\;=\\; \\mathbb{P}\\big(M_{s} \\ge \\widetilde{M}_{t-s}\\big),\n$$\nwhere $\\widetilde{M}_{t-s}$ is an independent copy of $M_{t-s}$.\nA transparent evaluation uses scaling: write $M_{s} \\stackrel{d}{=} \\sqrt{s}\\,|Z|$ and $\\widetilde{M}_{t-s} \\stackrel{d}{=} \\sqrt{t-s}\\,|W|$, where $Z,W$ are i.i.d. standard normal random variables. Then\n$$\n\\mathbb{P}(\\tau_t \\le s) = \\mathbb{P}\\big(\\sqrt{s}\\,|Z| \\ge \\sqrt{t-s}\\,|W|\\big) = \\mathbb{P}\\left(\\frac{Z^2}{W^2} \\ge \\frac{t-s}{s}\\right).\n$$\nThis event is equivalent to $\\frac{Z^2}{Z^2+W^2} \\ge \\frac{t-s}{t}$. The random variable $U = \\frac{Z^2}{Z^2+W^2}$ is known to have a Beta($\\frac{1}{2},\\frac{1}{2}$) distribution (the arcsine distribution on $[0,1]$), whose CDF is $F_U(u) = \\frac{2}{\\pi}\\arcsin(\\sqrt{u})$. The probability is thus:\n\\begin{align*}\n\\mathbb{P}(\\tau_t \\le s) = \\mathbb{P}\\left(U \\ge \\frac{t-s}{t}\\right) = 1 - F_U\\left(\\frac{t-s}{t}\\right) \\\\\n= 1 - \\frac{2}{\\pi}\\arcsin\\left(\\sqrt{\\frac{t-s}{t}}\\right).\n\\end{align*}\nUsing the identity $\\arcsin(x)+\\arccos(x)=\\pi/2$, and since $\\arccos(\\sqrt{y}) = \\arcsin(\\sqrt{1-y})$, this becomes:\n$$\n\\mathbb{P}(\\tau_t \\le s) = \\frac{2}{\\pi}\\arccos\\left(\\sqrt{\\frac{t-s}{t}}\\right) = \\frac{2}{\\pi}\\arcsin\\left(\\sqrt{1 - \\left(\\frac{t-s}{t}\\right)}\\right) = \\frac{2}{\\pi}\\arcsin\\left(\\sqrt{\\frac{s}{t}}\\right).\n$$\nDifferentiating with respect to $s$ yields the marginal density of $\\tau_{t}$:\n\\begin{align*}\nf_{\\tau_{t}}(s)\n= \\frac{\\mathrm{d}}{\\mathrm{d}s}\\left[\\frac{2}{\\pi}\\,\\arcsin\\!\\Big(\\sqrt{\\frac{s}{t}}\\Big)\\right]\n= \\frac{2}{\\pi} \\cdot \\frac{1}{\\sqrt{1 - \\frac{s}{t}}} \\cdot \\frac{1}{2 t \\sqrt{\\frac{s}{t}}} \\\\\n= \\frac{1}{\\pi} \\cdot \\frac{1}{\\sqrt{s(t-s)}}, \\qquad s \\in (0,t).\n\\end{align*}\nThis is the arcsine law for the time of the maximum.\n\nStep 4: Identify $c(\\cdot)$ and the joint law $f_{M_{t},\\tau_{t}}$. From the factorization\n$$\nf_{M_{t},\\tau_{t}}(m,s) \\;=\\; f_{M_{s},B_{s}}(m,m)\\, c(t-s),\n$$\nwe integrate over $m  0$ to obtain $f_{\\tau_{t}}(s)$:\n\\begin{align*}\nf_{\\tau_{t}}(s)\n= \\int_{0}^{\\infty} f_{M_{s},B_{s}}(m,m)\\, c(t-s)\\,\\mathrm{d}m\n= c(t-s) \\int_{0}^{\\infty} \\frac{2m}{s}\\,\\varphi_{s}(m)\\,\\mathrm{d}m.\n\\end{align*}\nCompute the integral:\n\\begin{align*}\n\\int_{0}^{\\infty} \\frac{2m}{s}\\,\\varphi_{s}(m)\\,\\mathrm{d}m\n= \\frac{2}{s} \\cdot \\frac{1}{\\sqrt{2\\pi s}} \\int_{0}^{\\infty} m \\exp\\!\\Big(-\\frac{m^{2}}{2s}\\Big)\\,\\mathrm{d}m \\\\\n= \\frac{2}{s \\sqrt{2\\pi s}} \\cdot s\n= \\frac{2}{\\sqrt{2\\pi s}} = \\sqrt{\\frac{2}{\\pi s}}.\n\\end{align*}\nMatching with $f_{\\tau_{t}}(s) = \\frac{1}{\\pi \\sqrt{s(t-s)}}$ gives\n$$\nc(t-s)\\cdot \\sqrt{\\frac{2}{\\pi s}} \\;=\\; \\frac{1}{\\pi \\sqrt{s(t-s)}}\n\\quad\\Longrightarrow\\quad\nc(T) \\;=\\; \\frac{1}{\\sqrt{2\\pi T}}, \\quad T = t - s.\n$$\nTherefore, the joint density of $(M_{t},\\tau_{t})$ is\n$$\nf_{M_{t},\\tau_{t}}(m,s)\n\\;=\\;\n\\frac{2m}{s}\\,\\varphi_{s}(m)\\cdot \\frac{1}{\\sqrt{2\\pi (t-s)}}\n\\;=\\;\n\\frac{m}{\\pi\\, s^{3/2}\\, \\sqrt{t-s}} \\exp\\!\\Big(-\\frac{m^{2}}{2s}\\Big),\n\\qquad m  0,\\; s \\in (0,t),\n$$\nand its marginal in $s$ is the arcsine density found above:\n$$\nf_{\\tau_{t}}(s) \\;=\\; \\frac{1}{\\pi \\sqrt{s(t-s)}}, \\qquad s \\in (0,t).\n$$\n\nThis completes the derivation based on the reflection principle, the joint density of $(M_{t},B_{t})$, and a path decomposition at the maximum time.", "answer": "$$\\boxed{\\frac{1}{\\pi \\sqrt{s(t-s)}}}$$", "id": "2993800"}]}