{"hands_on_practices": [{"introduction": "Our journey into the practical application of sensitivity analysis begins with Delta, the most fundamental of the Option Greeks. Delta, denoted as $\\Delta$, measures the rate of change of an option's price with respect to a small change in the price of the underlying asset. This exercise [@problem_id:3069345] will guide you through the derivation of Delta for a European call option from first principles, starting with the risk-neutral valuation formula. Mastering this derivation is a crucial first step, as it establishes the core mathematical technique of differentiating under the expectation sign, a method that forms the foundation for calculating many other financial sensitivities.", "problem": "Let $(\\Omega,\\mathcal{F},(\\mathcal{F}_{\\tau})_{\\tau \\ge 0},\\mathbb{Q})$ be a filtered probability space supporting a standard Brownian motion $W$ under the risk-neutral measure $\\mathbb{Q}$. Consider an underlying asset price process $(S_{\\tau})_{\\tau \\ge 0}$ that satisfies the Black–Scholes–Merton (BSM) stochastic differential equation under $\\mathbb{Q}$,\n$$\n\\mathrm{d}S_{\\tau} = r S_{\\tau}\\,\\mathrm{d}\\tau + \\sigma S_{\\tau}\\,\\mathrm{d}W_{\\tau},\n$$\nwith constant risk-free rate $r \\ge 0$, constant volatility $\\sigma  0$, and current time $t \\in [0,T)$ with $S_t = S  0$. Let $\\tau := T - t$. The time-$t$ price of a European call option with strike $K  0$ and maturity $T$ is given by the risk-neutral valuation formula\n$$\nC(t,S) = \\exp(-r \\tau)\\,\\mathbb{E}^{\\mathbb{Q}}\\!\\left[(S_T - K)^{+}\\,\\big|\\,S_t = S\\right].\n$$\nUsing only the BSM model and risk-neutral pricing as the fundamental base, derive the option Delta, defined as\n$$\n\\Delta(t,S) := \\frac{\\partial C}{\\partial S}(t,S),\n$$\nas a closed-form analytic expression in terms of $S$, $K$, $r$, $\\sigma$, $t$, $T$, and the standard normal cumulative distribution function (CDF). You may assume that interchanging differentiation and expectation is justified by dominated convergence. Present your final answer as a single analytic expression. No rounding is required and no units are necessary.", "solution": "The problem is to derive the option Delta, $\\Delta(t,S) := \\frac{\\partial C}{\\partial S}(t,S)$, for a European call option within the Black–Scholes–Merton (BSM) framework.\n\nFirst, we perform a validation of the problem statement.\n\n**Step 1: Extract Givens**\n- Filtered Probability Space: $(\\Omega,\\mathcal{F},(\\mathcal{F}_{\\tau})_{\\tau \\ge 0},\\mathbb{Q})$\n- Brownian Motion: $W$ is a standard Brownian motion under the risk-neutral measure $\\mathbb{Q}$.\n- Asset Price Process SDE: $\\mathrm{d}S_{\\tau} = r S_{\\tau}\\,\\mathrm{d}\\tau + \\sigma S_{\\tau}\\,\\mathrm{d}W_{\\tau}$ for $\\tau \\ge 0$.\n- Risk-Free Rate: $r \\ge 0$, constant.\n- Volatility: $\\sigma  0$, constant.\n- Current Time: $t \\in [0,T)$.\n- Maturity Time: $T$.\n- Current Asset Price: $S_t = S  0$.\n- Strike Price: $K  0$.\n- Time to Maturity: $\\tau := T - t$.\n- Call Option Price Formula: $C(t,S) = \\exp(-r \\tau)\\,\\mathbb{E}^{\\mathbb{Q}}\\!\\left[(S_T - K)^{+}\\,\\big|\\,S_t = S\\right]$.\n- Definition of Delta: $\\Delta(t,S) := \\frac{\\partial C}{\\partial S}(t,S)$.\n- Assumption: Interchanging differentiation and expectation is justified by dominated convergence.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, well-posed, and objective. It is a standard derivation in financial mathematics, based on the canonical Black–Scholes–Merton model. All necessary information, including the underlying asset's stochastic differential equation, the risk-neutral pricing formula, and all relevant parameters, are provided. The definitions are clear and unambiguous. The problem is self-contained, consistent, and does not violate any scientific or mathematical principles.\n\n**Step 3: Verdict and Action**\nThe problem is valid. We proceed with the derivation.\n\nThe price of the European call option at time $t$ is given by\n$$\nC(t,S) = \\exp(-r(T-t))\\,\\mathbb{E}^{\\mathbb{Q}}\\!\\left[(S_T - K)^{+}\\,\\big|\\,S_t = S\\right]\n$$\nThe option Delta is defined as the partial derivative of the option price with respect to the underlying asset price $S$:\n$$\n\\Delta(t,S) = \\frac{\\partial C}{\\partial S}(t,S) = \\frac{\\partial}{\\partial S} \\left( \\exp(-r(T-t))\\,\\mathbb{E}^{\\mathbb{Q}}\\!\\left[(S_T - K)^{+}\\,\\big|\\,S_t = S\\right] \\right)\n$$\nSince the discount factor $\\exp(-r(T-t))$ does not depend on $S$, and we are given that we can interchange differentiation and expectation, we have:\n$$\n\\Delta(t,S) = \\exp(-r(T-t))\\,\\mathbb{E}^{\\mathbb{Q}}\\!\\left[\\frac{\\partial}{\\partial S} (S_T - K)^{+}\\,\\bigg|\\,S_t = S\\right]\n$$\nTo evaluate the derivative inside the expectation, we first need the relationship between the asset price at maturity, $S_T$, and its price at time $t$, $S_t=S$. The given SDE describes a geometric Brownian motion. Its solution is:\n$$\nS_T = S_t \\exp\\left( \\left(r - \\frac{1}{2}\\sigma^2\\right)(T-t) + \\sigma (W_T - W_t) \\right)\n$$\nGiven $S_t = S$, we can write $S_T$ as $S_T = S \\cdot X$, where $X = \\exp\\left( \\left(r - \\frac{1}{2}\\sigma^2\\right)(T-t) + \\sigma (W_T - W_t) \\right)$ is a random variable whose distribution does not depend on $S$. We use the chain rule to differentiate the payoff $(S_T - K)^{+}$ with respect to $S$:\n$$\n\\frac{\\partial}{\\partial S} (S_T - K)^{+} = \\frac{\\partial}{\\partial S} (S \\cdot X - K)^{+} = \\frac{\\partial (S \\cdot X - K)^{+}}{\\partial(S \\cdot X - K)} \\cdot \\frac{\\partial (S \\cdot X - K)}{\\partial S}\n$$\nThe derivative of the function $f(y) = (y-K)^+$ is the Heaviside step function, which is $1$ if $yK$ and $0$ if $yK$. At $y=K$, the derivative is undefined, but this is a single point and has zero probability mass for a continuous random variable $S_T$, so we can neglect it in the expectation. Therefore, $\\frac{\\partial (S_T - K)^{+}}{\\partial S_T} = \\mathbb{I}(S_T  K)$, where $\\mathbb{I}(\\cdot)$ is the indicator function. The second part of the chain rule gives $\\frac{\\partial (S \\cdot X - K)}{\\partial S} = X = \\frac{S_T}{S}$.\nCombining these results:\n$$\n\\frac{\\partial}{\\partial S} (S_T - K)^{+} = \\mathbb{I}(S_T  K) \\cdot \\frac{S_T}{S}\n$$\nSubstituting this back into the expression for $\\Delta$:\n$$\n\\Delta(t,S) = \\exp(-r(T-t))\\,\\mathbb{E}^{\\mathbb{Q}}\\!\\left[ \\mathbb{I}(S_T  K) \\frac{S_T}{S} \\right] = \\frac{\\exp(-r(T-t))}{S} \\mathbb{E}^{\\mathbb{Q}}\\!\\left[ S_T \\, \\mathbb{I}(S_T  K) \\right]\n$$\nNow we must evaluate the expectation $\\mathbb{E}^{\\mathbb{Q}}\\![ S_T \\, \\mathbb{I}(S_T  K) ]$. Under the risk-neutral measure $\\mathbb{Q}$, we know that $\\ln(S_T)$ is normally distributed. Let $\\tau = T-t$. Then $\\ln(S_T) \\sim \\mathcal{N}\\left(\\ln S + (r - \\frac{1}{2}\\sigma^2)\\tau, \\sigma^2\\tau\\right)$.\nThe expectation can be written as an integral over the log-normal probability density function $p(s_T)$ of $S_T$:\n$$\n\\mathbb{E}^{\\mathbb{Q}}\\!\\left[ S_T \\, \\mathbb{I}(S_T  K) \\right] = \\int_K^\\infty s_T \\, p(s_T) \\, \\mathrm{d}s_T\n$$\nLet $y = \\ln(s_T)$. Then $s_T = \\exp(y)$ and $\\mathrm{d}s_T = \\exp(y)\\mathrm{d}y$. The variable $y$ is normally distributed with mean $m = \\ln S + (r - \\frac{1}{2}\\sigma^2)\\tau$ and variance $v^2 = \\sigma^2\\tau$. Let $g(y)$ be the PDF of this normal distribution.\n$$\n\\int_{\\ln K}^\\infty \\exp(y) \\, g(y) \\, \\mathrm{d}y = \\int_{\\ln K}^\\infty \\exp(y) \\frac{1}{\\sqrt{2\\pi v^2}} \\exp\\left(-\\frac{(y-m)^2}{2v^2}\\right) \\mathrm{d}y\n$$\nWe combine the exponential terms by completing the square in the exponent:\n$y - \\frac{(y-m)^2}{2v^2} = -\\frac{y^2 - 2ym + m^2 - 2v^2y}{2v^2} = -\\frac{y^2 - 2y(m+v^2) + m^2}{2v^2}$.\nCompleting the square for $y^2 - 2y(m+v^2)$:\n$y^2 - 2y(m+v^2) = (y-(m+v^2))^2 - (m+v^2)^2$.\nThe exponent becomes: $-\\frac{(y-(m+v^2))^2 - (m+v^2)^2 + m^2}{2v^2} = -\\frac{(y-(m+v^2))^2}{2v^2} + \\frac{2mv^2 + v^4}{2v^2} = -\\frac{(y-(m+v^2))^2}{2v^2} + m + \\frac{v^2}{2}$.\nThe term $\\exp(m + \\frac{v^2}{2})$ is constant with respect to $y$. Let's evaluate it:\n$m + \\frac{v^2}{2} = \\left(\\ln S + (r - \\frac{1}{2}\\sigma^2)\\tau\\right) + \\frac{\\sigma^2\\tau}{2} = \\ln S + r\\tau$.\nSo, $\\exp\\left(m + \\frac{v^2}{2}\\right) = \\exp(\\ln S + r\\tau) = S\\exp(r\\tau)$.\nThe expectation becomes:\n$$\nS\\exp(r\\tau) \\int_{\\ln K}^\\infty \\frac{1}{\\sqrt{2\\pi v^2}} \\exp\\left(-\\frac{(y-(m+v^2))^2}{2v^2}\\right) \\mathrm{d}y\n$$\nThe integral represents the probability $\\mathbb{Q}(Y'  \\ln K)$, where $Y'$ is a normally distributed random variable with mean $m' = m+v^2 = \\ln S + (r+\\frac{1}{2}\\sigma^2)\\tau$ and variance $v^2 = \\sigma^2\\tau$.\nLet $N(\\cdot)$ denote the cumulative distribution function (CDF) of the standard normal distribution. We standardize the variable to compute the probability:\n$$\n\\mathbb{Q}(Y'  \\ln K) = \\mathbb{Q}\\left(\\frac{Y' - m'}{v}  \\frac{\\ln K - m'}{v}\\right) = 1 - N\\left(\\frac{\\ln K - m'}{v}\\right) = N\\left(-\\frac{\\ln K - m'}{v}\\right)\n$$\n$$\n= N\\left(\\frac{m' - \\ln K}{v}\\right) = N\\left(\\frac{\\ln S + (r+\\frac{1}{2}\\sigma^2)\\tau - \\ln K}{\\sigma\\sqrt{\\tau}}\\right) = N\\left(\\frac{\\ln(S/K) + (r+\\frac{1}{2}\\sigma^2)\\tau}{\\sigma\\sqrt{\\tau}}\\right)\n$$\nThis is the standard definition of $N(d_1)$, where $d_1 = \\frac{\\ln(S/K) + (r+\\frac{1}{2}\\sigma^2)\\tau}{\\sigma\\sqrt{\\tau}}$.\nSo, we have found that $\\mathbb{E}^{\\mathbb{Q}}\\!\\left[ S_T \\, \\mathbb{I}(S_T  K) \\right] = S\\exp(r\\tau)N(d_1)$.\nFinally, we substitute this back into our expression for $\\Delta(t,S)$:\n$$\n\\Delta(t,S) = \\frac{\\exp(-r\\tau)}{S} \\left(S\\exp(r\\tau)N(d_1)\\right) = N(d_1)\n$$\nSubstituting $\\tau = T - t$, we arrive at the final expression.", "answer": "$$\\boxed{N\\left(\\frac{\\ln\\left(\\frac{S}{K}\\right) + \\left(r + \\frac{1}{2}\\sigma^2\\right)(T-t)}{\\sigma\\sqrt{T-t}}\\right)}$$", "id": "3069345"}, {"introduction": "Having established the methodology for deriving a primary Greek, we now explore how sensitivity changes with different financial products. This practice [@problem_id:3069280] focuses on deriving Vega ($\\mathcal{V}$), the sensitivity to volatility, for a cash-or-nothing binary option. Unlike the vanilla options you may be familiar with, binary options have a discontinuous payoff, which dramatically alters their risk profile. By working through this problem, you will discover how the capped payoff can even lead to a negative Vega, providing deep insight into how payoff structure is a critical determinant of an option's sensitivity to market parameters.", "problem": "Consider a financial market where the underlying asset price process $\\{S_{t}\\}_{t \\ge 0}$ under the risk-neutral probability measure $\\mathbb{Q}$ follows the geometric Brownian motion specified by the stochastic differential equation $\\,\\mathrm{d}S_{t} = (r - q) S_{t} \\,\\mathrm{d}t + \\sigma S_{t} \\,\\mathrm{d}W_{t}$, where $r$ is the constant risk-free rate, $q$ is the continuous dividend yield, $\\sigma$ is the constant volatility, and $\\{W_{t}\\}_{t \\ge 0}$ is a standard Brownian motion. Consider a cash-or-nothing digital (binary) call option that pays $1$ unit of cash at maturity $T$ if $S_{T}  K$, and $0$ otherwise.\n\nStarting from the risk-neutral valuation principle and the distribution of $S_{T}$ induced by the given stochastic differential equation, derive from first principles an analytic expression for the Vega (the sensitivity of the option price with respect to $\\sigma$) of this binary call. Then evaluate this Vega for the parameter set $S_{0} = 100$, $K = 110$, $r = 0.05$, $q = 0.02$, $\\sigma = 0.2$, and $T = 1$. Round your final numerical result to $4$ significant figures.\n\nIn your derivation, clearly articulate the assumptions used and how the discontinuity of the payoff at the strike $K$ affects the sign and qualitative behavior of Vega in comparison with a vanilla European call option written on the same underlying and with the same parameters.", "solution": "The price of a derivative at time $t=0$, denoted $C_0$, is given by the risk-neutral valuation principle as the discounted expected value of its future payoff under the risk-neutral probability measure $\\mathbb{Q}$. For the cash-or-nothing digital call option with maturity $T$ and strike price $K$, the payoff is $1$ if the terminal asset price $S_T$ is greater than $K$, and $0$ otherwise. This payoff can be written using an indicator function, $I(S_T  K)$. The option price is therefore:\n$$ C_0 = \\exp(-rT) \\mathbb{E}^{\\mathbb{Q}}[I(S_T  K) | \\mathcal{F}_0] $$\nThe expectation of an indicator function is the probability of the event it indicates. Therefore, the option price is the discounted probability of the option finishing in-the-money under the risk-neutral measure $\\mathbb{Q}$:\n$$ C_0 = \\exp(-rT) \\mathbb{Q}(S_T  K) $$\nTo compute this probability, we must first determine the distribution of $S_T$. The asset price follows the stochastic differential equation for a geometric Brownian motion under $\\mathbb{Q}$:\n$$ \\mathrm{d}S_{t} = (r - q) S_{t} \\,\\mathrm{d}t + \\sigma S_{t} \\,\\mathrm{d}W_{t} $$\nThe solution to this SDE for $S_T$ given the initial price $S_0$ is:\n$$ S_T = S_0 \\exp\\left( \\left(r - q - \\frac{1}{2}\\sigma^2\\right)T + \\sigma W_T \\right) $$\nwhere $W_T$ is a random variable from a normal distribution with mean $0$ and variance $T$, i.e., $W_T \\sim \\mathcal{N}(0, T)$, under the measure $\\mathbb{Q}$. Consequently, the natural logarithm of $S_T$ is normally distributed:\n$$ \\ln(S_T) \\sim \\mathcal{N}\\left(\\ln(S_0) + \\left(r - q - \\frac{1}{2}\\sigma^2\\right)T, \\sigma^2 T\\right) $$\nWe can now calculate the probability $\\mathbb{Q}(S_T  K)$:\n$$ \\mathbb{Q}(S_T  K) = \\mathbb{Q}(\\ln(S_T)  \\ln(K)) $$\nTo express this in terms of the standard normal cumulative distribution function (CDF), $N(x)$, we standardize the random variable $\\ln(S_T)$:\n$$ \\mathbb{Q}\\left(\\frac{\\ln(S_T) - \\left(\\ln(S_0) + \\left(r - q - \\frac{1}{2}\\sigma^2\\right)T\\right)}{\\sigma\\sqrt{T}}  \\frac{\\ln(K) - \\left(\\ln(S_0) + \\left(r - q - \\frac{1}{2}\\sigma^2\\right)T\\right)}{\\sigma\\sqrt{T}}\\right) $$\nLet $Z$ be a standard normal random variable, $Z \\sim \\mathcal{N}(0,1)$. The expression becomes:\n$$ \\mathbb{Q}(Z  -d_2) = \\mathbb{Q}(Z  d_2) = N(d_2) $$\nwhere we have defined $d_2$ in the standard Black-Scholes-Merton convention:\n$$ d_2 = \\frac{\\ln(S_0/K) + (r - q - \\frac{1}{2}\\sigma^2)T}{\\sigma\\sqrt{T}} $$\nSubstituting this probability back into the price formula, we obtain the price of the digital call option:\n$$ C_0 = \\exp(-rT) N(d_2) $$\nVega, denoted by $\\mathcal{V}$, is the first partial derivative of the option price with respect to the volatility, $\\sigma$. We apply the chain rule to the expression for $C_0$:\n$$ \\mathcal{V} = \\frac{\\partial C_0}{\\partial \\sigma} = \\frac{\\partial}{\\partial \\sigma} \\left[ \\exp(-rT) N(d_2) \\right] = \\exp(-rT) \\frac{\\partial N(d_2)}{\\partial \\sigma} $$\n$$ \\mathcal{V} = \\exp(-rT) N'(d_2) \\frac{\\partial d_2}{\\partial \\sigma} $$\nThe derivative of the standard normal CDF, $N'(x)$, is the standard normal probability density function (PDF), $n(x) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-\\frac{x^2}{2})$. Thus:\n$$ \\mathcal{V} = \\exp(-rT) n(d_2) \\frac{\\partial d_2}{\\partial \\sigma} $$\nNext, we compute the partial derivative of $d_2$ with respect to $\\sigma$:\n$$ d_2 = \\frac{\\ln(S_0/K) + (r-q)T}{\\sigma\\sqrt{T}} - \\frac{1}{2}\\sigma\\sqrt{T} $$\n$$ \\frac{\\partial d_2}{\\partial \\sigma} = -\\frac{\\ln(S_0/K) + (r-q)T}{\\sigma^2\\sqrt{T}} - \\frac{1}{2}\\sqrt{T} $$\nTo simplify this expression, we introduce the standard parameter $d_1$:\n$$ d_1 = \\frac{\\ln(S_0/K) + (r - q + \\frac{1}{2}\\sigma^2)T}{\\sigma\\sqrt{T}} = \\frac{\\ln(S_0/K) + (r-q)T}{\\sigma\\sqrt{T}} + \\frac{1}{2}\\sigma\\sqrt{T} $$\nFrom this definition, we have the identity $d_2 = d_1 - \\sigma\\sqrt{T}$. We can also express $\\frac{\\partial d_2}{\\partial \\sigma}$ in terms of $d_1$. Rearranging the formula for $d_1$:\n$$ \\frac{\\ln(S_0/K) + (r-q)T}{\\sigma\\sqrt{T}} = d_1 - \\frac{1}{2}\\sigma\\sqrt{T} $$\nSubstituting this into the expression for $\\frac{\\partial d_2}{\\partial \\sigma}$:\n$$ \\frac{\\partial d_2}{\\partial \\sigma} = -\\frac{1}{\\sigma}\\left(d_1 - \\frac{1}{2}\\sigma\\sqrt{T}\\right) - \\frac{1}{2}\\sqrt{T} = -\\frac{d_1}{\\sigma} + \\frac{1}{2}\\sqrt{T} - \\frac{1}{2}\\sqrt{T} = -\\frac{d_1}{\\sigma} $$\nSubstituting this simplified derivative back into the formula for Vega, we arrive at the final analytic expression:\n$$ \\mathcal{V} = \\exp(-rT) n(d_2) \\left(-\\frac{d_1}{\\sigma}\\right) = -\\exp(-rT) \\frac{d_1}{\\sigma} n(d_2) $$\nThe underlying assumptions for this derivation are those of the Black-Scholes-Merton model: the asset price follows a geometric Brownian motion, trading is continuous, there are no transaction costs or taxes, and the risk-free rate, dividend yield, and volatility are constant and known.\n\nQualitatively, the behavior of this Vega is distinct from that of a vanilla European call option due to the discontinuous nature of the digital option's payoff. For a vanilla call, Vega is always positive, as increased volatility broadens the distribution of $S_T$, increasing the value of the unlimited upside potential while the downside loss is floored. For the digital call, the payoff is capped at $1$. The sign of Vega, $\\mathcal{V} = -\\exp(-rT) \\frac{d_1}{\\sigma} n(d_2)$, is determined by the sign of $-d_1$ since all other terms are positive.\n1. When the option is out-of-the-money ($S_0  K$), it is more likely that $\\ln(S_0/K)  0$, which often leads to $d_1  0$. In this case, Vega is positive. An increase in volatility increases the probability that the asset price will rise above the strike $K$, increasing the option's value.\n2. When the option is in-the-money ($S_0  K$), it is more likely that $\\ln(S_0/K)  0$, leading to $d_1  0$. In this case, Vega is negative. The option is already likely to pay off. An increase in volatility increases the probability that the asset price might fall below the strike $K$, which would result in a zero payoff. This increased risk of a zero payoff decreases the option's value.\nThe magnitude of Vega is largest when the option is near-the-money, as this is where changes in volatility have the most significant impact on the probability of finishing in- or out-of-the-money. This is reflected by the $n(d_2)$ term, which is the PDF of a standard normal distribution and peaks when $d_2=0$.\n\nWe now evaluate this Vega for the given parameters: $S_{0} = 100$, $K = 110$, $r = 0.05$, $q = 0.02$, $\\sigma = 0.2$, and $T = 1$.\nFirst, calculate $d_1$ and $d_2$:\n$$ \\ln\\left(\\frac{S_0}{K}\\right) = \\ln\\left(\\frac{100}{110}\\right) \\approx -0.09531018 $$\n$$ d_1 = \\frac{-0.09531018 + (0.05 - 0.02 + \\frac{1}{2}(0.2)^2) \\times 1}{0.2 \\sqrt{1}} = \\frac{-0.09531018 + 0.05}{0.2} = \\frac{-0.04531018}{0.2} = -0.2265509 $$\n$$ d_2 = d_1 - \\sigma\\sqrt{T} = -0.2265509 - 0.2\\sqrt{1} = -0.4265509 $$\nSince $d_1  0$, Vega will be positive, as expected for this out-of-the-money option.\nNext, we calculate the standard normal PDF, $n(d_2)$:\n$$ n(d_2) = n(-0.4265509) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{(-0.4265509)^2}{2}\\right) \\approx 0.364250 $$\nFinally, we compute Vega:\n$$ \\mathcal{V} = -\\exp(-0.05 \\times 1) \\frac{-0.2265509}{0.2} (0.364250) $$\n$$ \\mathcal{V} \\approx -(0.95122942) \\times (-1.1327545) \\times (0.364250) \\approx 0.392471 $$\nRounding to $4$ significant figures, the result is $0.3925$.", "answer": "$$\\boxed{0.3925}$$", "id": "3069280"}, {"introduction": "While analytical formulas for Greeks are powerful, many derivatives do not have simple closed-form solutions, necessitating the use of numerical methods. This final practice [@problem_id:3069321] bridges the gap between theory and computation by tasking you with building a Monte Carlo estimator for Vega. You will implement a finite difference scheme, a widely used technique in computational finance, and employ variance reduction using common random numbers. This hands-on exercise provides a window into the practical challenges of quantitative analysis, particularly the trade-off between the estimator's bias and its variance.", "problem": "Consider a European call option written on an underlying asset whose price process $\\{S_t\\}_{t \\ge 0}$ follows the Black–Scholes stochastic differential equation (SDE) under the risk-neutral measure: \n$$\ndS_t = r S_t \\, dt + \\sigma S_t \\, dW_t,\n$$\nwhere $r$ is the constant risk-free interest rate, $\\sigma$ is the constant volatility, and $\\{W_t\\}_{t \\ge 0}$ is a standard Brownian motion. Let $S_0$ denote the initial asset price and $T$ the time to maturity. The terminal price $S_T$ is lognormally distributed and can be represented as \n$$\nS_T = S_0 \\exp\\left((r - \\tfrac{1}{2}\\sigma^2)T + \\sigma \\sqrt{T} Z\\right),\n$$\nwhere $Z \\sim \\mathcal{N}(0,1)$ is a standard normal random variable. The discounted European call payoff at maturity is \n$$\nX(\\sigma) = e^{-rT} \\max(S_T - K, 0),\n$$\nwhere $K$ is the strike price. The option value $C(\\sigma)$ is the risk-neutral expectation $C(\\sigma) = \\mathbb{E}[X(\\sigma)]$. Define the sensitivity $\\nu$ (vega) as \n$$\n\\nu = \\frac{\\partial C(\\sigma)}{\\partial \\sigma}.\n$$\n\nYour task is to implement a Monte Carlo finite difference estimator for $\\nu$ using a forward difference scheme, based on simulating under $\\sigma$ and $\\sigma + \\varepsilon$. Use common random numbers so that the same standard normal draws $Z_i$ are reused for both $\\sigma$ and $\\sigma+\\varepsilon$. For a given number of independent and identically distributed samples $\\{Z_i\\}_{i=1}^N$, define the pathwise difference \n$$\nD_i(\\varepsilon) = \\frac{X_i(\\sigma+\\varepsilon) - X_i(\\sigma)}{\\varepsilon},\n$$\nwhere $X_i(\\cdot)$ is the discounted payoff computed using $Z_i$. The estimator is the sample mean \n$$\n\\widehat{\\nu}(\\varepsilon) = \\frac{1}{N} \\sum_{i=1}^N D_i(\\varepsilon),\n$$\nand the variance of the estimator is the sample variance of $D_i(\\varepsilon)$ divided by $N$, that is \n$$\n\\widehat{\\mathrm{Var}}[\\widehat{\\nu}(\\varepsilon)] = \\frac{1}{N} \\cdot \\widehat{\\mathrm{Var}}[D_i(\\varepsilon)],\n$$\nwhere the sample variance $\\widehat{\\mathrm{Var}}[D_i(\\varepsilon)]$ uses the unbiased estimator with Bessel's correction.\n\nStarting from the given SDE, derive the analytical expression for $\\nu$ in the Black–Scholes framework, and use it to compute the bias $\\widehat{\\nu}(\\varepsilon) - \\nu$. Discuss the bias–variance trade-off in $\\varepsilon$ based on the leading-order behavior implied by Taylor expansion and the structure of the Monte Carlo estimator with common random numbers.\n\nImplement a complete, runnable program that:\n- Simulates using the representation of $S_T$ above.\n- Uses common random numbers for each pair $(\\sigma,\\sigma+\\varepsilon)$.\n- Computes, for each test case, the tuple of four values \n$$\n\\left[\\widehat{\\nu}(\\varepsilon), \\nu, \\widehat{\\nu}(\\varepsilon) - \\nu, \\widehat{\\mathrm{Var}}[\\widehat{\\nu}(\\varepsilon)]\\right],\n$$\nin that order.\n\nUse the following test suite with fixed parameters $S_0 = 100$, $K = 100$, $r = 0.05$, $\\sigma = 0.2$, $T = 1.0$, and $N = 200000$ independent samples, and vary $\\varepsilon$ across the set $\\{0.1, 0.01, 0.0001, 0.000001\\}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets (e.g., \"[[case1_result1,case1_result2,case1_result3,case1_result4],[case2_result1,...],...]\"). No physical units are involved; all quantities are real numbers. Angles do not appear in the problem. Percentages are not used; express all numerical values as real numbers.", "solution": "The problem is assessed to be valid. It is scientifically grounded in the Black–Scholes model of financial mathematics, well-posed with a complete set of parameters and a clear objective, and free from any subjective or contradictory statements.\n\n### 1. Analytical Derivation of Vega ($\\nu$)\n\nThe value of a European call option $C$ at time $t=0$ in the Black–Scholes model is given by:\n$$\nC = S_0 \\Phi(d_1) - K e^{-rT} \\Phi(d_2)\n$$\nwhere $\\Phi(\\cdot)$ is the cumulative distribution function (CDF) of the standard normal distribution, $S_0$ is the initial asset price, $K$ is the strike price, $r$ is the risk-free rate, $T$ is the time to maturity, and $\\sigma$ is the volatility. The terms $d_1$ and $d_2$ are defined as:\n$$\nd_1 = \\frac{\\ln(S_0/K) + (r + \\frac{1}{2}\\sigma^2)T}{\\sigma\\sqrt{T}}\n$$\n$$\nd_2 = d_1 - \\sigma\\sqrt{T}\n$$\nVega, denoted by $\\nu$, is the first partial derivative of the option price $C$ with respect to the volatility $\\sigma$:\n$$\n\\nu = \\frac{\\partial C}{\\partial \\sigma}\n$$\nTo compute this, we apply the chain rule. Let $\\phi(\\cdot)$ be the probability density function (PDF) of the standard normal distribution, such that $\\frac{d\\Phi(x)}{dx} = \\phi(x)$.\n$$\n\\frac{\\partial C}{\\partial \\sigma} = S_0 \\frac{\\partial \\Phi(d_1)}{\\partial \\sigma} - K e^{-rT} \\frac{\\partial \\Phi(d_2)}{\\partial \\sigma} = S_0 \\phi(d_1) \\frac{\\partial d_1}{\\partial \\sigma} - K e^{-rT} \\phi(d_2) \\frac{\\partial d_2}{\\partial \\sigma}\n$$\nNext, we find the partial derivatives of $d_1$ and $d_2$ with respect to $\\sigma$. For $d_1$, we can rewrite it as:\n$$\nd_1 = \\frac{\\ln(S_0/K) + rT}{\\sigma\\sqrt{T}} + \\frac{\\sigma\\sqrt{T}}{2}\n$$\nThe derivative is:\n$$\n\\frac{\\partial d_1}{\\partial \\sigma} = -\\frac{\\ln(S_0/K) + rT}{\\sigma^2\\sqrt{T}} + \\frac{\\sqrt{T}}{2}\n$$\nFor $d_2$, the derivative is:\n$$\n\\frac{\\partial d_2}{\\partial \\sigma} = \\frac{\\partial}{\\partial \\sigma} (d_1 - \\sigma\\sqrt{T}) = \\frac{\\partial d_1}{\\partial \\sigma} - \\sqrt{T}\n$$\nNow we substitute these into the expression for $\\nu$:\n$$\n\\nu = S_0 \\phi(d_1) \\frac{\\partial d_1}{\\partial \\sigma} - K e^{-rT} \\phi(d_2) \\left(\\frac{\\partial d_1}{\\partial \\sigma} - \\sqrt{T}\\right)\n$$\nA key identity in the Black–Scholes framework is $S_0 \\phi(d_1) = K e^{-rT} \\phi(d_2)$. We can prove this by examining the relationship between $\\phi(d_1)$ and $\\phi(d_2)$:\n$$\n\\phi(d_2) = \\phi(d_1 - \\sigma\\sqrt{T}) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{(d_1 - \\sigma\\sqrt{T})^2}{2}\\right) = \\phi(d_1) \\exp\\left(d_1\\sigma\\sqrt{T} - \\frac{\\sigma^2T}{2}\\right)\n$$\nThe exponent can be simplified:\n$$\nd_1\\sigma\\sqrt{T} - \\frac{\\sigma^2T}{2} = \\left(\\ln(S_0/K) + rT + \\frac{\\sigma^2T}{2}\\right) - \\frac{\\sigma^2T}{2} = \\ln(S_0/K) + rT\n$$\nThus, $\\exp\\left(d_1\\sigma\\sqrt{T} - \\frac{\\sigma^2T}{2}\\right) = \\exp(\\ln(S_0/K) + rT) = \\frac{S_0}{K}e^{rT}$.\nSubstituting this back, we get $\\phi(d_2) = \\phi(d_1) \\frac{S_0}{K}e^{rT}$, which confirms the identity $K e^{-rT} \\phi(d_2) = S_0 \\phi(d_1)$.\n\nUsing this identity, the expression for $\\nu$ simplifies significantly:\n$$\n\\nu = S_0 \\phi(d_1) \\frac{\\partial d_1}{\\partial \\sigma} - S_0 \\phi(d_1) \\left(\\frac{\\partial d_1}{\\partial \\sigma} - \\sqrt{T}\\right)\n$$\n$$\n\\nu = S_0 \\phi(d_1) \\frac{\\partial d_1}{\\partial \\sigma} - S_0 \\phi(d_1) \\frac{\\partial d_1}{\\partial \\sigma} + S_0 \\phi(d_1) \\sqrt{T}\n$$\nThis gives the final analytical expression for Vega:\n$$\n\\nu = S_0 \\sqrt{T} \\phi(d_1)\n$$\n\n### 2. Bias–Variance Trade-off Analysis\n\nThe Monte Carlo estimator for Vega is given by $\\widehat{\\nu}(\\varepsilon) = \\frac{1}{N} \\sum_{i=1}^N D_i(\\varepsilon)$, where $D_i(\\varepsilon) = \\frac{X_i(\\sigma+\\varepsilon) - X_i(\\sigma)}{\\varepsilon}$. The expected value of the estimator is:\n$$\n\\mathbb{E}[\\widehat{\\nu}(\\varepsilon)] = \\mathbb{E}\\left[\\frac{X(\\sigma+\\varepsilon) - X(\\sigma)}{\\varepsilon}\\right] = \\frac{\\mathbb{E}[X(\\sigma+\\varepsilon)] - \\mathbb{E}[X(\\sigma)]}{\\varepsilon} = \\frac{C(\\sigma+\\varepsilon) - C(\\sigma)}{\\varepsilon}\n$$\nThe true Vega is $\\nu = C'(\\sigma)$. The bias of the estimator is the difference between its expected value and the true value:\n$$\n\\text{Bias}[\\widehat{\\nu}(\\varepsilon)] = \\mathbb{E}[\\widehat{\\nu}(\\varepsilon)] - \\nu = \\frac{C(\\sigma+\\varepsilon) - C(\\sigma)}{\\varepsilon} - C'(\\sigma)\n$$\nBy applying a Taylor expansion to $C(\\sigma+\\varepsilon)$ around $\\sigma$, assuming $C$ is sufficiently smooth:\n$$\nC(\\sigma+\\varepsilon) = C(\\sigma) + C'(\\sigma)\\varepsilon + \\frac{1}{2} C''(\\sigma)\\varepsilon^2 + O(\\varepsilon^3)\n$$\nSubstituting this into the bias expression:\n$$\n\\text{Bias}[\\widehat{\\nu}(\\varepsilon)] = \\frac{C(\\sigma) + C'(\\sigma)\\varepsilon + \\frac{1}{2} C''(\\sigma)\\varepsilon^2 + \\dots - C(\\sigma)}{\\varepsilon} - C'(\\sigma) = \\frac{1}{2} C''(\\sigma)\\varepsilon + O(\\varepsilon^2)\n$$\nThe bias is of order $O(\\varepsilon)$. This demonstrates that as the finite difference step $\\varepsilon$ is reduced, the bias of the estimator decreases linearly, approaching zero as $\\varepsilon \\to 0$.\n\nThe variance of the estimator is:\n$$\n\\mathrm{Var}[\\widehat{\\nu}(\\varepsilon)] = \\mathrm{Var}\\left[\\frac{1}{N} \\sum_{i=1}^N D_i(\\varepsilon)\\right] = \\frac{1}{N} \\mathrm{Var}[D_i(\\varepsilon)]\n$$\nwhere $\\mathrm{Var}[D_i(\\varepsilon)] = \\frac{1}{\\varepsilon^2} \\mathrm{Var}[X_i(\\sigma+\\varepsilon) - X_i(\\sigma)]$. The use of Common Random Numbers (CRN) is critical here. The same underlying random variable $Z_i$ is used to generate both $X_i(\\sigma)$ and $X_i(\\sigma+\\varepsilon)$, making them strongly positively correlated.\n$$\n\\mathrm{Var}[X_i(\\sigma+\\varepsilon) - X_i(\\sigma)] = \\mathrm{Var}[X_i(\\sigma+\\varepsilon)] + \\mathrm{Var}[X_i(\\sigma)] - 2\\mathrm{Cov}[X_i(\\sigma+\\varepsilon), X_i(\\sigma)]\n$$\nAs $\\varepsilon \\to 0$, $X_i(\\sigma+\\varepsilon)$ approaches $X_i(\\sigma)$, and their covariance approaches the variance of $X_i(\\sigma)$. A first-order Taylor expansion reveals the behavior: $X_i(\\sigma+\\varepsilon) - X_i(\\sigma) \\approx \\frac{\\partial X_i(\\sigma)}{\\partial \\sigma} \\varepsilon$.\nTherefore, $\\mathrm{Var}[X_i(\\sigma+\\varepsilon) - X_i(\\sigma)] \\approx \\varepsilon^2 \\mathrm{Var}[\\frac{\\partial X_i(\\sigma)}{\\partial \\sigma}]$.\nThis implies that $\\mathrm{Var}[D_i(\\varepsilon)] \\approx \\mathrm{Var}[\\frac{\\partial X_i(\\sigma)}{\\partial \\sigma}]$, which is a constant, independent of $\\varepsilon$. Thus, with CRN, the variance of the estimator, $\\mathrm{Var}[\\widehat{\\nu}(\\varepsilon)]$, is of order $O(1/N)$ and should be relatively stable as $\\varepsilon$ changes. Without CRN, the covariance term would be zero, and the variance term would be proportional to $1/\\varepsilon^2$, diverging as $\\varepsilon \\to 0$.\n\nThe trade-off arises from these two competing effects. To minimize the total error, typically measured by the Mean Squared Error (MSE), $\\text{MSE} = \\text{Bias}^2 + \\text{Variance}$, we must balance bias and variance.\n$$\n\\text{MSE}[\\widehat{\\nu}(\\varepsilon)] \\approx \\left(\\frac{1}{2} C''(\\sigma)\\varepsilon\\right)^2 + \\frac{1}{N}\\mathrm{Var}\\left[\\frac{\\partial X(\\sigma)}{\\partial \\sigma}\\right]\n$$\nTheoretically, smaller $\\varepsilon$ is always better for reducing bias. However, in finite-precision arithmetic, as $\\varepsilon$ becomes extremely small, the numerator $X_i(\\sigma+\\varepsilon) - X_i(\\sigma)$ suffers from catastrophic cancellation—the subtraction of two nearly identical floating-point numbers. This loss of significant digits can introduce substantial numerical noise, causing the practical variance of the estimator to increase for very small $\\varepsilon$. Therefore, there is an optimal choice of $\\varepsilon$ that balances the systematic bias from the finite difference approximation and the numerical variance amplified by finite precision.\n\n### 3. Implementation Plan\n\nThe program will implement the Monte Carlo simulation as described. For each value of $\\varepsilon$ in the test suite:\n1.  A fixed set of $N = 200000$ standard normal random numbers $\\{Z_i\\}_{i=1}^N$ will be generated. This ensures the use of common random numbers.\n2.  Two sets of terminal prices, $S_T(\\sigma)$ and $S_T(\\sigma+\\varepsilon)$, will be computed using the provided lognormal formula and the common $Z_i$.\n3.  The corresponding discounted payoffs, $X_i(\\sigma)$ and $X_i(\\sigma+\\varepsilon)$, are calculated.\n4.  The pathwise differences $D_i(\\varepsilon)$ are computed.\n5.  The Monte Carlo estimate $\\widehat{\\nu}(\\varepsilon)$ is calculated as the mean of $D_i(\\varepsilon)$.\n6.  The analytical Vega $\\nu$ is computed using the derived formula $\\nu = S_0 \\sqrt{T} \\phi(d_1)$. This requires `scipy.stats.norm.pdf`.\n7.  The bias $\\widehat{\\nu}(\\varepsilon) - \\nu$ is determined.\n8.  The variance of the estimator, $\\widehat{\\mathrm{Var}}[\\widehat{\\nu}(\\varepsilon)]$, is computed as the sample variance of $D_i(\\varepsilon)$ (with Bessel's correction, $ddof=1$) divided by $N$.\n9.  The four resulting values are stored as a list. All results are then formatted into the required output string.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes the Monte Carlo finite difference estimator for Vega and compares it\n    to the analytical Black-Scholes Vega for a European call option.\n    \"\"\"\n    # Fixed parameters from the problem statement\n    S0 = 100.0\n    K = 100.0\n    r = 0.05\n    sigma = 0.2\n    T = 1.0\n    N = 200000\n\n    # Test cases for epsilon\n    epsilon_values = [0.1, 0.01, 0.0001, 0.000001]\n\n    # Use a fixed seed for the random number generator for reproducibility\n    rng = np.random.default_rng(seed=42)\n\n    # Calculate analytical Vega (this is constant for all test cases)\n    d1_analytical = (np.log(S0 / K) + (r + 0.5 * sigma**2) * T) / (sigma * np.sqrt(T))\n    vega_analytical = S0 * np.sqrt(T) * norm.pdf(d1_analytical)\n\n    all_results = []\n\n    # Generate common random numbers once for all epsilon values to ensure\n    # that the base random draws are consistent across simulations.\n    # The problem implies CRN per (sigma, sigma+eps) pair, which is what we do\n    # inside the loop. Generating Z inside ensures independence between epsilon cases.\n    for eps in epsilon_values:\n        # Generate N standard normal random variables (Common Random Numbers)\n        Z = rng.standard_normal(N)\n\n        # 1. Calculate terminal prices for sigma\n        drift_sigma = (r - 0.5 * sigma**2) * T\n        diffusion_sigma = sigma * np.sqrt(T) * Z\n        S_T_sigma = S0 * np.exp(drift_sigma + diffusion_sigma)\n\n        # 2. Calculate terminal prices for sigma + epsilon\n        sigma_eps = sigma + eps\n        drift_sigma_eps = (r - 0.5 * sigma_eps**2) * T\n        diffusion_sigma_eps = sigma_eps * np.sqrt(T) * Z\n        S_T_sigma_eps = S0 * np.exp(drift_sigma_eps + diffusion_sigma_eps)\n\n        # 3. Calculate discounted payoffs\n        discount_factor = np.exp(-r * T)\n        payoff_sigma = discount_factor * np.maximum(S_T_sigma - K, 0)\n        payoff_sigma_eps = discount_factor * np.maximum(S_T_sigma_eps - K, 0)\n\n        # 4. Calculate pathwise differences\n        D_eps = (payoff_sigma_eps - payoff_sigma) / eps\n\n        # 5. Compute the Monte Carlo Vega estimator\n        vega_hat = np.mean(D_eps)\n\n        # 6. Compute the bias\n        bias = vega_hat - vega_analytical\n        \n        # 7. Compute the variance of the estimator\n        # This is the sample variance of D_eps (with Bessel's correction)\n        # divided by N, as per the problem description.\n        var_of_estimator = np.var(D_eps, ddof=1) / N\n\n        current_result = [vega_hat, vega_analytical, bias, var_of_estimator]\n        all_results.append(current_result)\n\n    # Format the final output string as a comma-separated list of lists\n    # e.g., \"[[r1_c1, r2_c1, ...], [r1_c2, r2_c2, ...]]\"\n    # Using str() on a list automatically includes brackets and spaces.\n    # The required format is strict.\n    output_str = \"[\" + \",\".join([str(res) for res in all_results]) + \"]\"\n    \n    # Print the final output in the exact required format.\n    print(output_str)\n\nsolve()\n```", "id": "3069321"}]}