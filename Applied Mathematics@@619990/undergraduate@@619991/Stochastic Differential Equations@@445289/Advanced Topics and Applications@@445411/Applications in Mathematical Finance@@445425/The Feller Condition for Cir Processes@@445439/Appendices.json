{"hands_on_practices": [{"introduction": "The behavior of a one-dimensional diffusion process near a boundary is mathematically encoded in its scale function. This exercise provides a foundational, hands-on calculation of the scale density, $s'(x)$, for the CIR process [@problem_id:3080478]. By isolating the behavior of $s'(x)$ near the origin, you will uncover the key term that governs whether the boundary at zero is accessible, laying the groundwork for understanding the Feller condition from first principles.", "problem": "Consider the Cox–Ingersoll–Ross (CIR) diffusion on $\\mathbb{R}_{+}$ defined by the stochastic differential equation\n$$\ndX_{t}=\\kappa\\left(\\theta - X_{t}\\right)\\,dt+\\sigma \\sqrt{X_{t}}\\,dW_{t},\n$$\nwith parameters $\\kappa0$, $\\theta0$, and $\\sigma0$, where $W_{t}$ is a standard Brownian motion. For this diffusion, consider the scale density derivative defined by\n$$\ns'(x)=\\exp\\left\\{-\\int^{x}\\frac{2\\kappa(\\theta - y)}{\\sigma^{2} y}\\,dy\\right\\},\\quad x0.\n$$\nCompute this integral and simplify $s'(x)$ to a power–exponential form that isolates its behavior near $x=0$, namely express it in the form\n$$\ns'(x)=C\\,x^{\\alpha}\\,\\exp(\\beta x),\n$$\nfor some explicit exponents $\\alpha$ and $\\beta$, where $C0$ is an arbitrary normalization constant. Express your final answer as a single closed-form expression for $s'(x)$ in terms of $\\kappa$, $\\theta$, $\\sigma$, and $x$. No rounding is required and no units are involved.", "solution": "The user wants to find a simplified expression for the scale density derivative of the Cox–Ingersoll–Ross (CIR) process.\n\n### Step 1: Extract Givens\n- The SDE for the CIR process is $dX_{t}=\\kappa\\left(\\theta - X_{t}\\right)\\,dt+\\sigma \\sqrt{X_{t}}\\,dW_{t}$.\n- Parameters are $\\kappa0$, $\\theta0$, $\\sigma0$.\n- The domain of the process is $\\mathbb{R}_{+}$ ($x0$).\n- The scale density derivative is given by $s'(x)=\\exp\\left\\{-\\int^{x}\\frac{2\\kappa(\\theta - y)}{\\sigma^{2} y}\\,dy\\right\\}$, for $x0$.\n- The target form for the simplified expression is $s'(x)=C\\,x^{\\alpha}\\,\\exp(\\beta x)$, where $C0$ is an arbitrary normalization constant.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is a standard mathematical calculation within the theory of stochastic differential equations. All definitions and parameters are standard and clearly stated. The requested calculation is well-defined and leads to a unique functional form. There are no scientific inconsistencies, contradictions, or ambiguities.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be derived.\n\n### Derivation\nWe are tasked with computing and simplifying the expression for the scale density derivative, $s'(x)$, of a CIR process. The given formula is\n$$\ns'(x)=\\exp\\left\\{-\\int^{x}\\frac{2\\kappa(\\theta - y)}{\\sigma^{2} y}\\,dy\\right\\}\n$$\nwhere $\\kappa$, $\\theta$, and $\\sigma$ are positive constants and the domain for $x$ is $x0$.\n\nOur first step is to evaluate the indefinite integral in the exponent. Let the integral be denoted by $I(x)$:\n$$\nI(x) = \\int^{x}\\frac{2\\kappa(\\theta - y)}{\\sigma^{2} y}\\,dy\n$$\nWe can simplify the integrand by splitting the fraction:\n$$\n\\frac{2\\kappa(\\theta - y)}{\\sigma^{2} y} = \\frac{2\\kappa\\theta}{\\sigma^{2}y} - \\frac{2\\kappa y}{\\sigma^{2}y} = \\frac{2\\kappa\\theta}{\\sigma^{2}y} - \\frac{2\\kappa}{\\sigma^{2}}\n$$\nNow, we can integrate this expression term by term with respect to $y$. The parameters $\\kappa$, $\\theta$, and $\\sigma$ are constants.\n$$\nI(x) = \\int^{x} \\left( \\frac{2\\kappa\\theta}{\\sigma^{2}y} - \\frac{2\\kappa}{\\sigma^{2}} \\right) dy\n$$\n$$\nI(x) = \\frac{2\\kappa\\theta}{\\sigma^{2}} \\int^{x} \\frac{1}{y}\\,dy - \\frac{2\\kappa}{\\sigma^{2}} \\int^{x} 1\\,dy\n$$\nSince the domain of the process is $x0$, the integration variable $y$ is also positive. Therefore, the integral of $1/y$ is $\\ln(y)$.\n$$\nI(x) = \\frac{2\\kappa\\theta}{\\sigma^{2}} \\ln(x) - \\frac{2\\kappa}{\\sigma^{2}} x + K_{1}\n$$\nHere, $K_{1}$ is the constant of integration. The notation $\\int^x$ for an indefinite integral implies that the lower bound of integration is an arbitrary point, and the choice of this point is absorbed into this constant.\n\nNow, we substitute this result back into the expression for $s'(x)$:\n$$\ns'(x) = \\exp\\left\\{ - \\left( \\frac{2\\kappa\\theta}{\\sigma^{2}} \\ln(x) - \\frac{2\\kappa}{\\sigma^{2}} x + K_{1} \\right) \\right\\}\n$$\nDistributing the negative sign in the exponent gives:\n$$\ns'(x) = \\exp\\left\\{ -\\frac{2\\kappa\\theta}{\\sigma^{2}} \\ln(x) + \\frac{2\\kappa}{\\sigma^{2}} x - K_{1} \\right\\}\n$$\nUsing the property of the exponential function, $\\exp(a+b) = \\exp(a)\\exp(b)$, we can break this into a product of three terms:\n$$\ns'(x) = \\exp\\left(-\\frac{2\\kappa\\theta}{\\sigma^{2}} \\ln(x)\\right) \\cdot \\exp\\left(\\frac{2\\kappa}{\\sigma^{2}} x\\right) \\cdot \\exp(-K_{1})\n$$\nWe simplify the first term using the identity $a \\ln(b) = \\ln(b^a)$, which implies $\\exp(a \\ln(b)) = b^a$:\n$$\n\\exp\\left(-\\frac{2\\kappa\\theta}{\\sigma^{2}} \\ln(x)\\right) = x^{-\\frac{2\\kappa\\theta}{\\sigma^{2}}}\n$$\nThe constant term $\\exp(-K_{1})$ is an arbitrary positive constant, as specified in the problem statement. We shall denote it by $C$:\n$$\nC = \\exp(-K_1)\n$$\nSubstituting these simplified parts back into the expression for $s'(x)$, we obtain:\n$$\ns'(x) = C \\, x^{-\\frac{2\\kappa\\theta}{\\sigma^{2}}} \\, \\exp\\left(\\frac{2\\kappa}{\\sigma^{2}} x\\right)\n$$\nThis expression is in the desired power–exponential form $s'(x)=C\\,x^{\\alpha}\\,\\exp(\\beta x)$, with the exponents identified as:\n$$\n\\alpha = -\\frac{2\\kappa\\theta}{\\sigma^{2}}\n$$\n$$\n\\beta = \\frac{2\\kappa}{\\sigma^{2}}\n$$\nThe problem asks for the single closed-form expression for $s'(x)$. This is our final result.", "answer": "$$\n\\boxed{C x^{-\\frac{2\\kappa\\theta}{\\sigma^{2}}} \\exp\\left(\\frac{2\\kappa}{\\sigma^{2}} x\\right)}\n$$", "id": "3080478"}, {"introduction": "The Feller condition has profound implications for the path properties of the CIR process, determining whether the process can ever reach zero. This practice problem makes this abstract concept concrete by asking you to calculate the probability of the process hitting an upper level $L$ before hitting the zero boundary [@problem_id:3041826]. Solving the associated Kolmogorov backward equation will demonstrate how the solution, and the required boundary conditions, change dramatically depending on whether the Feller index $\\nu = \\frac{2\\kappa\\theta}{\\sigma^2}$ is greater than or less than one.", "problem": "Consider the Cox–Ingersoll–Ross (CIR) process defined by the stochastic differential equation (SDE)\n$$\ndX_t=\\kappa\\big(\\theta-X_t\\big)\\,dt+\\sigma\\sqrt{X_t}\\,dW_t,\n$$\nwhere $\\kappa0$, $\\theta0$, and $\\sigma0$ are constants, and $W_t$ is a standard one-dimensional Brownian motion (BM). Define the Feller index\n$$\n\\nu:=\\frac{2\\kappa\\theta}{\\sigma^2}.\n$$\nFix a level $L0$, and for $x\\in(0,L)$ define the two-sided hitting times\n$$\n\\tau_0:=\\inf\\{t\\ge 0:X_t=0\\},\\qquad \\tau_L:=\\inf\\{t\\ge 0:X_t=L\\}.\n$$\nLet\n$$\nu(x):=\\mathbb{P}_x\\big(\\tau_L\\tau_0\\big),\n$$\nthe probability that the process started at $X_0=x$ hits $L$ before hitting $0$. Your tasks are:\n- Using the Kolmogorov backward equation (KBE) for one-dimensional diffusions, and the boundary classification of the origin for the CIR process in terms of the Feller index $\\nu$, determine the correct boundary condition to impose at $x=0$ for the backward equation that $u$ satisfies in $(0,L)$, explicitly stating how it depends on whether $\\nu1$ or $\\nu\\ge 1$.\n- Starting from first principles (the generator associated with the given SDE and the KBE), derive the ordinary differential equation (ODE) satisfied by $u(x)$ on $(0,L)$ and solve it subject to the boundary condition at $x=0$ you determined and the boundary condition at $x=L$ that is implied by the definition of $u$.\n\nExpress your final answer for $u(x)$ as a single closed-form analytic expression valid for all $x\\in(0,L)$ and all parameter regimes, making explicit its dependence on $\\nu$, $\\kappa$, $\\theta$, and $\\sigma$. No numerical approximation is required.", "solution": "The problem asks for the probability $u(x) = \\mathbb{P}_x(\\tau_L  \\tau_0)$ for a Cox–Ingersoll–Ross (CIR) process, where $\\tau_0$ and $\\tau_L$ are the first hitting times of the levels $0$ and $L$ respectively.\n\nFirst, we validate the problem statement.\nThe givens are:\n1.  The SDE for the CIR process: $dX_t=\\kappa(\\theta-X_t)\\,dt+\\sigma\\sqrt{X_t}\\,dW_t$, with constants $\\kappa0$, $\\theta0$, $\\sigma0$.\n2.  The Feller index: $\\nu := \\frac{2\\kappa\\theta}{\\sigma^2}$.\n3.  The domain for the starting point $x$ is $(0,L)$, where $L0$.\n4.  The hitting times: $\\tau_0:=\\inf\\{t\\ge 0:X_t=0\\}$ and $\\tau_L:=\\inf\\{t\\ge 0:X_t=L\\}$.\n5.  The function to be found: $u(x):=\\mathbb{P}_x(\\tau_L\\tau_0)$.\n\nThe problem is scientifically grounded, as it deals with a standard, well-studied stochastic process (CIR) and a fundamental quantity (hitting probability). It is well-posed and objective. The problem is valid.\n\nWe proceed with the solution, which consists of two main parts as requested.\n\nPart 1: Derivation of the ODE and Boundary Conditions\n\nFor a one-dimensional Itô diffusion $dX_t = a(X_t)dt + b(X_t)dW_t$, the infinitesimal generator $\\mathcal{A}$ is given by\n$$\n\\mathcal{A}f(x) = a(x)f'(x) + \\frac{1}{2}b(x)^2 f''(x).\n$$\nFor the CIR process, the drift is $a(x) = \\kappa(\\theta-x)$ and the diffusion coefficient is $b(x) = \\sigma\\sqrt{x}$. The generator is:\n$$\n\\mathcal{A}f(x) = \\kappa(\\theta-x)f'(x) + \\frac{1}{2}\\sigma^2 x f''(x).\n$$\nThe probability $u(x) = \\mathbb{P}_x(\\tau_L  \\tau_0)$ is the solution to the Kolmogorov backward equation (KBE) for the process killed upon exiting the interval $(0,L)$. The KBE is $\\mathcal{A}u(x)=0$ for $x \\in (0,L)$. This gives the second-order linear ordinary differential equation (ODE):\n$$\n\\frac{1}{2}\\sigma^2 x u''(x) + \\kappa(\\theta - x) u'(x) = 0.\n$$\nThe boundary conditions are determined by the definition of $u(x)$ and the behavior of the process at the boundaries.\nThe boundary condition at $x=L$ is straightforward. If the process starts at $X_0=L$, it has already hit level $L$ at time $t=0$. Since $L0$, it has not yet hit $0$. Thus, $\\tau_L = 0$ and $\\tau_0  0$, which means the event $\\tau_L  \\tau_0$ occurs with probability $1$. Therefore,\n$$\nu(L)=1.\n$$\nThe boundary condition at $x=0$ is more subtle and depends on the Feller index $\\nu = \\frac{2\\kappa\\theta}{\\sigma^2}$. We must classify the boundary at $0$ using Feller's test. The scale density function $s'(x)$ is given by\n$$\ns'(x) = \\exp\\left(-\\int \\frac{2a(y)}{b(y)^2} dy\\right) = \\exp\\left(-\\int \\frac{2\\kappa(\\theta-y)}{\\sigma^2 y} dy\\right).\n$$\nThe integral is\n$$\n\\int \\left(\\frac{2\\kappa\\theta}{\\sigma^2y} - \\frac{2\\kappa}{\\sigma^2}\\right) dy = \\frac{2\\kappa\\theta}{\\sigma^2}\\ln(y) - \\frac{2\\kappa}{\\sigma^2}y = \\nu \\ln(y) - \\frac{2\\kappa}{\\sigma^2}y.\n$$\nThus, the scale density is\n$$\ns'(x) = \\exp\\left(-\\nu \\ln(x) + \\frac{2\\kappa}{\\sigma^2}x\\right) = x^{-\\nu} \\exp\\left(\\frac{2\\kappa}{\\sigma^2}x\\right).\n$$\nThe nature of the boundary at $0$ depends on the integrability of $s'(x)$ near $0$. We examine $\\int_0^c s'(y)dy$ for some small $c0$. As $y\\to 0$, $e^{(2\\kappa/\\sigma^2)y} \\to 1$, so the convergence is determined by the convergence of $\\int_0^c y^{-\\nu}dy$. This integral converges if and only if $-\\nu  -1$, which is equivalent to $\\nu  1$.\n\nCase 1: $\\nu  1$.\nThe integral of the scale density converges. The boundary at $0$ is regular. This means that the process started at $x0$ can reach the origin in finite time with positive probability. If the process hits $0$, the condition $\\tau_L  \\tau_0$ is false. Therefore, as the starting point $x$ approaches $0$, the probability of hitting $L$ before $0$ must vanish. This implies the boundary condition:\n$$\nu(0)=0.\n$$\n\nCase 2: $\\nu \\ge 1$.\nThe integral of the scale density diverges. The boundary at $0$ is an entrance boundary, which means it is inaccessible from the interior of the domain $(0,\\infty)$. For a process started at $X_0=x0$, the probability of ever hitting the origin is zero, i.e., $\\mathbb{P}_x(\\tau_0 = \\infty)=1$.\nConsequently, the event $\\tau_L  \\tau_0$ is equivalent to the event $\\tau_L  \\infty$. Since the CIR process is mean-reverting towards $\\theta0$, it does not escape to $+\\infty$, and it will eventually hit any level $L$ with probability $1$. Thus, for any $x \\in (0, L)$, we have $u(x)=1$.\nFrom the perspective of the ODE, the inaccessibility of the boundary at $x=0$ implies that we do not impose a value condition like $u(0)=c$. Instead, the physical requirement is that the solution $u(x)$ remains bounded as $x \\to 0$. As we will see, this condition is sufficient to determine the unique solution.\n\nPart 2: Solving the ODE\n\nThe general solution to $\\mathcal{A}u(x)=0$ is $u(x) = C_1 S(x) + C_2$, where $S(x) = \\int^x s'(y)dy$ is the scale function. Let us write the general solution as:\n$$\nu(x) = C_1 \\int_c^x y^{-\\nu} \\exp\\left(\\frac{2\\kappa}{\\sigma^2} y\\right) dy + C_2,\n$$\nfor some arbitrary constant $c \\in (0,L)$.\n\nCase 1: $\\nu  1$.\nThe boundary conditions are $u(0)=0$ and $u(L)=1$. We can choose the lower limit of integration to be $0$, because the integral converges.\n$$\nu(x) = C_1 \\int_0^x y^{-\\nu} \\exp\\left(\\frac{2\\kappa}{\\sigma^2} y\\right) dy + C_2.\n$$\nFrom $u(0)=0$, we get $C_1 \\cdot 0 + C_2 = 0$, so $C_2=0$.\nThe solution is $u(x) = C_1 \\int_0^x y^{-\\nu} \\exp\\left(\\frac{2\\kappa}{\\sigma^2} y\\right) dy$.\nFrom $u(L)=1$, we determine $C_1$:\n$$\n1 = C_1 \\int_0^L y^{-\\nu} \\exp\\left(\\frac{2\\kappa}{\\sigma^2} y\\right) dy \\implies C_1 = \\left(\\int_0^L y^{-\\nu} \\exp\\left(\\frac{2\\kappa}{\\sigma^2} y\\right) dy\\right)^{-1}.\n$$\nSo, for $\\nu  1$, the solution is\n$$\nu(x) = \\frac{\\int_0^x y^{-\\nu} \\exp\\left(\\frac{2\\kappa}{\\sigma^2} y\\right) dy}{\\int_0^L y^{-\\nu} \\exp\\left(\\frac{2\\kappa}{\\sigma^2} y\\right) dy}.\n$$\n\nCase 2: $\\nu \\ge 1$.\nThe boundary condition at $x=0$ is that $u(x)$ must be bounded as $x\\to 0^+$.\nThe integral $\\int_c^x y^{-\\nu} e^{\\frac{2\\kappa}{\\sigma^2} y} dy = - \\int_x^c y^{-\\nu} e^{\\frac{2\\kappa}{\\sigma^2} y} dy$. Since $\\nu \\ge 1$, the integral $\\int_0^c y^{-\\nu} e^{\\frac{2\\kappa}{\\sigma^2} y} dy$ diverges to $+\\infty$. This means that as $x \\to 0^+$, the term $\\int_c^x y^{-\\nu} \\dots dy$ diverges to $-\\infty$.\nFor $u(x) = C_1 \\int_c^x y^{-\\nu} \\dots dy + C_2$ to remain bounded, we must set $C_1=0$.\nThis leaves $u(x)=C_2$. Applying the other boundary condition, $u(L)=1$, gives $C_2=1$.\nThus, for $\\nu \\ge 1$, the solution is $u(x)=1$.\n\nFinal Expression\nWe now express the solution for $\\nu1$ in terms of standard special functions. The integral is related to the confluent hypergeometric function of the first kind, $M(a,b,z) = {}_1F_1(a;b;z)$. A relevant integral representation is:\n$$\n\\int_0^z t^{\\alpha-1} e^t dt = \\frac{z^\\alpha}{\\alpha} M(\\alpha, \\alpha+1, z), \\quad \\text{for } \\alpha0.\n$$\nOur integral is $\\int_0^x y^{-\\nu} \\exp(cy) dy$ where $c = \\frac{2\\kappa}{\\sigma^2}$. Let $t=cy$, so $y=t/c$ and $dy=dt/c$.\n$$\n\\int_0^{cx} (t/c)^{-\\nu} e^t (dt/c) = c^{\\nu-1} \\int_0^{cx} t^{-\\nu} e^t dt.\n$$\nUsing the representation with $\\alpha=1-\\nu$ (which is positive since $\\nu  1$) and $z=cx$, this becomes:\n$$\nc^{\\nu-1} \\frac{(cx)^{1-\\nu}}{1-\\nu} M(1-\\nu, 2-\\nu, cx) = \\frac{x^{1-\\nu}}{1-\\nu} M(1-\\nu, 2-\\nu, \\frac{2\\kappa}{\\sigma^2}x).\n$$\nApplying this to both numerator and denominator of the expression for $u(x)$:\n$$\nu(x) = \\frac{\\frac{x^{1-\\nu}}{1-\\nu} M(1-\\nu, 2-\\nu, \\frac{2\\kappa}{\\sigma^2}x)}{\\frac{L^{1-\\nu}}{1-\\nu} M(1-\\nu, 2-\\nu, \\frac{2\\kappa}{\\sigma^2}L)} = \\left(\\frac{x}{L}\\right)^{1-\\nu} \\frac{M(1-\\nu, 2-\\nu, \\frac{2\\kappa}{\\sigma^2}x)}{M(1-\\nu, 2-\\nu, \\frac{2\\kappa}{\\sigma^2}L)}.\n$$\nThis is the solution for $\\nu1$. As a check, as $\\nu \\to 1^-$, let $\\epsilon = 1-\\nu \\to 0^+$. Using the fact that $M(\\epsilon, 1+\\epsilon, z) \\to M(0,1,z)=1$, we find that $u(x) \\to (\\frac{x}{L})^0 \\frac{1}{1} = 1$, which matches the solution for $\\nu \\ge 1$. The function $u(x)$ is continuous in the parameter $\\nu$ at $\\nu=1$.\n\nCombining the two cases, the complete solution is:\n$$\nu(x) =\n\\begin{cases}\n\\displaystyle \\left(\\frac{x}{L}\\right)^{1-\\nu} \\frac{M(1-\\nu, 2-\\nu, \\frac{2\\kappa}{\\sigma^2}x)}{M(1-\\nu, 2-\\nu, \\frac{2\\kappa}{\\sigma^2}L)}  \\text{if } \\nu  1 \\\\\n1  \\text{if } \\nu \\ge 1\n\\end{cases}\n$$\nwhere $\\nu = \\frac{2\\kappa\\theta}{\\sigma^2}$ and $M(a,b,z)$ is Kummer's confluent hypergeometric function.", "answer": "$$\n\\boxed{\nu(x) =\n\\begin{cases}\n\\left(\\frac{x}{L}\\right)^{1-\\frac{2\\kappa\\theta}{\\sigma^2}} \\frac{M\\left(1-\\frac{2\\kappa\\theta}{\\sigma^2}, 2-\\frac{2\\kappa\\theta}{\\sigma^2}, \\frac{2\\kappa}{\\sigma^2}x\\right)}{M\\left(1-\\frac{2\\kappa\\theta}{\\sigma^2}, 2-\\frac{2\\kappa\\theta}{\\sigma^2}, \\frac{2\\kappa}{\\sigma^2}L\\right)}  \\text{if } \\frac{2\\kappa\\theta}{\\sigma^2}  1 \\\\\n1  \\text{if } \\frac{2\\kappa\\theta}{\\sigma^2} \\ge 1\n\\end{cases}\n}\n$$", "id": "3041826"}, {"introduction": "Bridging theory with application, this exercise explores the practical challenges of simulating a CIR process. While the Feller condition guarantees positivity for the theoretical continuous-time process, simple numerical methods can fail to uphold this crucial property. You are tasked with deriving a more robust drift-implicit numerical scheme that inherently preserves non-negativity [@problem_id:3080496]. This practice highlights the important distinction between continuous and discrete models and the techniques required for accurate financial modeling.", "problem": "Consider the Cox–Ingersoll–Ross (CIR) short-rate model, defined as the stochastic differential equation (SDE)\n$$\ndX_t \\;=\\; \\kappa\\,(\\theta - X_t)\\,dt \\;+\\; \\sigma\\,\\sqrt{X_t}\\,dW_t,\\qquad X_0 \\ge 0,\n$$\nwhere $\\kappa0$, $\\theta\\ge 0$, and $\\sigma\\ge 0$ are parameters, and $(W_t)_{t\\ge 0}$ is a standard Brownian motion. It is known that the so-called Feller condition $2\\,\\kappa\\,\\theta \\ge \\sigma^2$ ensures strict positivity of the exact solution for all $t0$ whenever $X_00$.\n\nYour task is to construct a one-step drift-implicit scheme that preserves non-negativity by treating both the mean-reverting drift and the square-root diffusion in an implicit manner at the next time step. Work on a uniform time grid with step size $\\Delta t0$, and denote the Brownian increment by $\\Delta W_n := W_{t_{n+1}}-W_{t_n}$ with $\\Delta W_n \\sim \\mathcal{N}(0,\\Delta t)$ independent across steps. Starting from the SDE and basic time discretization principles (left-point and right-point approximations for stochastic integrals, and the chain rule for solving scalar quadratics), derive the exact closed-form one-step update mapping $\\varphi$ such that $X_{n+1}=\\varphi(X_n,\\Delta W_n)$ for the drift-implicit square-root scheme.\n\nThen, using your derived expression, reason from first principles to assess when the update is strictly positive in a single step, and explain how this compares with the strict positivity of the exact process under the Feller condition $2\\,\\kappa\\,\\theta \\ge \\sigma^2$. In your discussion, contrast this with the behavior of a full-truncation explicit scheme in terms of non-negativity versus strict positivity.\n\nImportant: Provide, as your final answer, the single closed-form analytic expression for the map $\\varphi(x,\\Delta W)$ in terms of $\\kappa$, $\\theta$, $\\sigma$, $\\Delta t$, $x$, and $\\Delta W$. No inequalities or additional commentary should be included in the final answer. Do not round your expression.", "solution": "The problem requires the derivation and analysis of a one-step drift-implicit numerical scheme for the Cox–Ingersoll–Ross (CIR) process that also treats the diffusion term implicitly. The CIR process is described by the stochastic differential equation (SDE):\n$$\ndX_t = \\kappa(\\theta - X_t)dt + \\sigma\\sqrt{X_t}dW_t\n$$\nwith parameters $\\kappa  0$, $\\theta \\ge 0$, $\\sigma \\ge 0$ and initial condition $X_0 \\ge 0$.\n\nFirst, we derive the map $\\varphi$ such that $X_{n+1} = \\varphi(X_n, \\Delta W_n)$ on a uniform time grid $t_n = n\\Delta t$. The integral form of the SDE over the interval $[t_n, t_{n+1}]$ is:\n$$\nX_{t_{n+1}} - X_{t_n} = \\int_{t_n}^{t_{n+1}} \\kappa(\\theta - X_s)ds + \\int_{t_n}^{t_{n+1}} \\sigma\\sqrt{X_s}dW_s\n$$\nLet $X_n$ be the numerical approximation of $X_{t_n}$. A drift-implicit scheme that also treats the diffusion implicitly means we approximate the integrands using their values at the right endpoint of the interval, $t_{n+1}$. This is a backward Euler type of approximation.\nThe drift integral is approximated as:\n$$\n\\int_{t_n}^{t_{n+1}} \\kappa(\\theta - X_s)ds \\approx \\kappa(\\theta - X_{n+1})\\Delta t\n$$\nThe stochastic integral is approximated as:\n$$\n\\int_{t_n}^{t_{n+1}} \\sigma\\sqrt{X_s}dW_s \\approx \\sigma\\sqrt{X_{n+1}}\\int_{t_n}^{t_{n+1}}dW_s = \\sigma\\sqrt{X_{n+1}}\\Delta W_n\n$$\nwhere $\\Delta W_n = W_{t_{n+1}} - W_{t_n}$. Substituting these approximations into the integral form of the SDE gives the discrete update equation for $X_{n+1}$:\n$$\nX_{n+1} - X_n = \\kappa(\\theta - X_{n+1})\\Delta t + \\sigma\\sqrt{X_{n+1}}\\Delta W_n\n$$\nThis is an implicit equation for $X_{n+1}$. To solve for $X_{n+1}$, we rearrange the terms:\n$$\nX_{n+1} + \\kappa X_{n+1}\\Delta t - \\sigma\\sqrt{X_{n+1}}\\Delta W_n - (X_n + \\kappa\\theta\\Delta t) = 0\n$$\n$$\n(1 + \\kappa\\Delta t)X_{n+1} - (\\sigma\\Delta W_n)\\sqrt{X_{n+1}} - (X_n + \\kappa\\theta\\Delta t) = 0\n$$\nThis is a quadratic equation for the variable $\\sqrt{X_{n+1}}$. Let $Y = \\sqrt{X_{n+1}}$. Since $X_{n+1}$ must be a non-negative quantity, we must have $Y \\ge 0$. The equation becomes:\n$$\n(1 + \\kappa\\Delta t)Y^2 - (\\sigma\\Delta W_n)Y - (X_n + \\kappa\\theta\\Delta t) = 0\n$$\nThis is a quadratic equation of the form $aY^2 + bY + c = 0$, with coefficients:\n$a = 1 + \\kappa\\Delta t$\n$b = -\\sigma\\Delta W_n$\n$c = -(X_n + \\kappa\\theta\\Delta t)$\n\nThe solution for $Y$ is given by the quadratic formula $Y = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$.\nThe discriminant is $D = b^2 - 4ac = (-\\sigma\\Delta W_n)^2 - 4(1 + \\kappa\\Delta t)(- (X_n + \\kappa\\theta\\Delta t))$:\n$$\nD = \\sigma^2(\\Delta W_n)^2 + 4(1 + \\kappa\\Delta t)(X_n + \\kappa\\theta\\Delta t)\n$$\nGiven the parameter constraints $\\kappa  0$, $\\theta \\ge 0$ and the fact that $X_n \\ge 0$ and $\\Delta t  0$, the term $(1 + \\kappa\\Delta t)(X_n + \\kappa\\theta\\Delta t)$ is always non-negative. Therefore, the discriminant $D$ is always non-negative, and real roots for $Y$ are guaranteed. The solutions are:\n$$\nY = \\frac{\\sigma\\Delta W_n \\pm \\sqrt{\\sigma^2(\\Delta W_n)^2 + 4(1 + \\kappa\\Delta t)(X_n + \\kappa\\theta\\Delta t)}}{2(1 + \\kappa\\Delta t)}\n$$\nWe require $Y = \\sqrt{X_{n+1}} \\ge 0$. The denominator $2(1 + \\kappa\\Delta t)$ is strictly positive. Let us analyze the sign of the numerator for the two roots. The square root term satisfies $\\sqrt{D} \\ge \\sqrt{\\sigma^2(\\Delta W_n)^2} = |\\sigma\\Delta W_n|$.\nThe root with the negative sign gives a numerator $\\sigma\\Delta W_n - \\sqrt{D} \\le \\sigma\\Delta W_n - |\\sigma\\Delta W_n|$, which is always non-positive. This would lead to $Y \\le 0$.\nThe root with the positive sign gives a numerator $\\sigma\\Delta W_n + \\sqrt{D} \\ge \\sigma\\Delta W_n + |\\sigma\\Delta W_n|$, which is always non-negative. This leads to $Y \\ge 0$.\nTherefore, to ensure non-negativity, we must choose the positive root:\n$$\n\\sqrt{X_{n+1}} = \\frac{\\sigma\\Delta W_n + \\sqrt{\\sigma^2(\\Delta W_n)^2 + 4(1 + \\kappa\\Delta t)(X_n + \\kappa\\theta\\Delta t)}}{2(1 + \\kappa\\Delta t)}\n$$\nSquaring both sides gives the expression for $X_{n+1}$. Expressed as the requested map $\\varphi(x, \\Delta W)$, where $x$ represents the state at the beginning of the step and $\\Delta W$ is the Brownian increment, we have:\n$$\nX_{n+1} = \\varphi(x, \\Delta W) = \\left( \\frac{\\sigma\\Delta W + \\sqrt{\\sigma^2(\\Delta W)^2 + 4(1 + \\kappa\\Delta t)(x + \\kappa\\theta\\Delta t)}}{2(1 + \\kappa\\Delta t)} \\right)^2\n$$\n\nNext, we analyze the strict positivity of this scheme. Since $X_{n+1}$ is a square, non-negativity ($X_{n+1} \\ge 0$) is guaranteed by construction, provided $X_n \\ge 0$. The scheme is strictly positive, $X_{n+1}  0$, if and only if the term inside the square is non-zero. The denominator is non-zero. The numerator becomes zero if and only if:\n$$\n\\sigma\\Delta W_n + \\sqrt{\\sigma^2(\\Delta W_n)^2 + 4(1 + \\kappa\\Delta t)(X_n + \\kappa\\theta\\Delta t)} = 0\n$$\nThis requires $\\sigma\\Delta W_n \\le 0$ and, after squaring and rearranging, $4(1 + \\kappa\\Delta t)(X_n + \\kappa\\theta\\Delta t) = 0$. Since $1 + \\kappa\\Delta t  0$, this implies $X_n + \\kappa\\theta\\Delta t = 0$. Given the non-negativity of all terms, this can only occur if $X_n=0$ and $\\theta=0$.\nThus, if $X_n  0$, the term $X_n + \\kappa\\theta\\Delta t$ is strictly positive, meaning the numerator is strictly positive, and consequently $X_{n+1}  0$. The scheme unconditionally preserves strict positivity. If $X_n=0$, $X_{n+1}$ will be strictly positive as long as $\\theta  0$. The process escapes the zero boundary in one step if $\\theta0$.\n\nThis behavior is stronger than that of the continuous-time CIR process. The exact solution $X_t$ is guaranteed to be strictly positive for all $t  0$ (if $X_0  0$) only if the Feller condition $2\\kappa\\theta \\ge \\sigma^2$ is met. If $2\\kappa\\theta  \\sigma^2$, the process can hit zero with positive probability. In contrast, the derived numerical scheme preserves strict positivity for any set of parameters $\\kappa0, \\theta\\ge 0, \\sigma\\ge 0$ and any time step $\\Delta t0$. The implicit treatment of the diffusion term is the reason for this robust property, as it effectively prevents the stochastic term from driving the process to or below zero.\n\nFinally, we contrast this with a full-truncation explicit scheme, which is typically defined as:\n$$\nX_{n+1} = \\max\\left(0, X_n + \\kappa(\\theta - X_n)\\Delta t + \\sigma\\sqrt{X_n}\\Delta W_n\\right)\n$$\nThis explicit scheme guarantees non-negativity by direct truncation. However, whenever the argument of the $\\max$ function is negative, the scheme sets $X_{n+1}$ to exactly $0$. This creates an artificial \"sticky\" boundary where the process can be absorbed at zero for one or more time steps, a behavior that may not be present in the true process, especially when the Feller condition holds. The implicit scheme, by contrast, naturally guarantees non-negativity through its algebraic structure and only allows the process to touch zero under specific and limited conditions ($X_n=0, \\theta=0$), thereby providing a more faithful representation of the process dynamics near the boundary.", "answer": "$$\\boxed{\\left( \\frac{\\sigma \\Delta W + \\sqrt{\\sigma^2 (\\Delta W)^2 + 4(1 + \\kappa \\Delta t)(x + \\kappa \\theta \\Delta t)}}{2(1 + \\kappa \\Delta t)} \\right)^2}$$", "id": "3080496"}]}