{"hands_on_practices": [{"introduction": "To truly understand adaptive step-size control, we must first look under the hood at a single step. The core idea is to measure our own error as we go, much like a carpenter who measures twice before cutting once. This practice [@problem_id:2158593] guides you through the fundamental mechanism of error estimation using the step-doubling technique, a common strategy where we compare the result of one large step against two smaller ones to decide if our step size is appropriate.", "problem": "In the numerical solution of Ordinary Differential Equations (ODEs), adaptive step size control is a crucial technique for balancing accuracy and computational efficiency. The core idea is to adjust the step size, $h$, at each step to keep the local truncation error within a desired tolerance.\n\nConsider the initial value problem given by the ODE $y'(t) = y(t)$ with the initial condition $y(0) = 1$. We will attempt to take a single step forward from $t_0=0$ using the forward Euler method, $y_{n+1} = y_n + h f(t_n, y_n)$.\n\nTo estimate the local error, we employ a common strategy: we compute the solution at $t_0+h_0$ in two different ways. First, we compute it using a single step of size $h_0$, which we will call $y_1$. Second, we compute it using two successive steps of size $h_0/2$, which we will call $y_1^*$. The absolute difference, $E = |y_1 - y_1^*|$, serves as an estimate of the local error for the step of size $h_0$.\n\nThe new, \"optimal\" step size, $h_{\\text{new}}$, can then be determined using the formula for a first-order method:\n$$h_{\\text{new}} = \\rho h_0 \\left( \\frac{\\text{TOL}}{E} \\right)^{1/2}$$\nwhere $\\rho$ is a safety factor and $\\text{TOL}$ is the desired absolute error tolerance.\n\nGiven the following parameters:\n- Initial trial step size: $h_0 = 0.2$\n- Desired absolute error tolerance: $\\text{TOL} = 0.005$\n- Safety factor: $\\rho = 0.9$\n\nCalculate the new step size, $h_{\\text{new}}$, suggested by this procedure. Round your final answer to three significant figures.", "solution": "We have the ODE $y'(t)=y(t)$ with $y(0)=1$, and use the forward Euler method $y_{n+1}=y_{n}+h f(t_{n},y_{n})$.\n\nWith one step of size $h_{0}=0.2$ from $t_{0}=0$:\n$$\ny_{1}=y_{0}+h_{0} f(t_{0},y_{0})=1+0.2\\cdot 1=1.2.\n$$\n\nWith two successive steps of size $h_{0}/2=0.1$:\nFirst half-step:\n$$\ny_{1/2}=y_{0}+\\frac{h_{0}}{2} f(t_{0},y_{0})=1+0.1\\cdot 1=1.1.\n$$\nSecond half-step:\n$$\ny_{1}^{*}=y_{1/2}+\\frac{h_{0}}{2} f\\left(t_{0}+\\frac{h_{0}}{2},y_{1/2}\\right)=1.1+0.1\\cdot 1.1=1.21.\n$$\n\nThe error estimate is\n$$\nE=|y_{1}-y_{1}^{*}|=|1.2-1.21|=0.01.\n$$\n\nFor a first-order method, the new step size is\n$$\nh_{\\text{new}}=\\rho h_{0}\\left(\\frac{\\text{TOL}}{E}\\right)^{1/2}\n=0.9\\cdot 0.2\\left(\\frac{0.005}{0.01}\\right)^{1/2}\n=0.18\\left(0.5\\right)^{1/2}\n=\\frac{0.18}{\\sqrt{2}}\n\\approx 0.127.\n$$\n\nRounded to three significant figures, the suggested new step size is $0.127$.", "answer": "$$\\boxed{0.127}$$", "id": "2158593"}, {"introduction": "Adaptive solvers provide a powerful knob to turn: the error tolerance, often denoted as $\\text{TOL}$. But how does tightening this tolerance in the quest for higher accuracy affect the total computational cost? This exercise [@problem_id:2158591] shifts our focus from the mechanics of a single step to the efficiency of the entire integration, exploring the crucial scaling relationship between desired precision and the total number of steps a solver must take.", "problem": "A computational scientist is tasked with numerically solving a well-behaved Ordinary Differential Equation (ODE) over a fixed integration interval. For this purpose, they employ a fourth-order adaptive step-size solver. The core feature of this solver is its ability to adjust the step size, $h$, at each point in the integration to maintain the estimated local truncation error, $E_{local}$, at a level close to a user-defined tolerance, $\\epsilon$. For this specific fourth-order method, a fundamental property is that the local truncation error is proportional to the fifth power of the step size, which can be expressed as $E_{local} \\propto h^{5}$.\n\nInitially, the scientist runs the simulation and obtains a satisfactory solution using a tolerance value of $\\epsilon_{initial}$. To significantly improve the precision of the result for a validation study, they decide to re-run the entire simulation with a much stricter tolerance, setting the new tolerance to $\\epsilon_{final} = \\epsilon_{initial} / 1000$.\n\nAssuming that the constant of proportionality between the local error and the step size remains approximately the same throughout the integration, calculate the theoretical multiplicative factor by which the total number of steps required to solve the ODE over the same interval is expected to increase. Express your answer as a numerical value rounded to three significant figures.", "solution": "Let the local truncation error be $E_{local}$ and the step size be $h$. The problem states that for the fourth-order solver, the local error is proportional to the fifth power of the step size. We can write this relationship as:\n$$E_{local} = C h^{5}$$\nwhere $C$ is a constant of proportionality that depends on the specific ODE being solved and the derivatives of its solution.\n\nThe adaptive step-size algorithm adjusts $h$ so that the local error $E_{local}$ remains approximately equal to the user-defined tolerance $\\epsilon$. Therefore, we can set $E_{local} \\approx \\epsilon$:\n$$\\epsilon \\approx C h^{5}$$\n\nFrom this relationship, we can express the step size $h$ as a function of the tolerance $\\epsilon$:\n$$h^{5} \\approx \\frac{\\epsilon}{C} \\implies h \\approx \\left(\\frac{\\epsilon}{C}\\right)^{1/5}$$\nThis shows that the step size $h$ is proportional to the one-fifth power of the tolerance, $h \\propto \\epsilon^{1/5}$.\n\nThe total number of steps, $N$, required to integrate over a fixed interval of length $L$ is given by $N = L / h_{avg}$, where $h_{avg}$ is the average step size. Assuming $h$ is representative of the average step size, the number of steps is inversely proportional to the step size:\n$$N \\propto \\frac{1}{h}$$\n\nNow we can relate the number of steps $N$ directly to the tolerance $\\epsilon$. Since $N \\propto 1/h$ and $h \\propto \\epsilon^{1/5}$, we have:\n$$N \\propto \\frac{1}{\\epsilon^{1/5}} \\quad \\text{or} \\quad N \\propto \\epsilon^{-1/5}$$\n\nWe are asked to find the multiplicative factor by which the total number of steps increases, which is the ratio of the final number of steps, $N_{final}$, to the initial number of steps, $N_{initial}$. Using the proportionality we just derived:\n$$\\frac{N_{final}}{N_{initial}} = \\frac{k \\cdot (\\epsilon_{final})^{-1/5}}{k \\cdot (\\epsilon_{initial})^{-1/5}} = \\left(\\frac{\\epsilon_{final}}{\\epsilon_{initial}}\\right)^{-1/5}$$\nwhere $k$ is the constant of proportionality.\n\nThe problem states that the tolerance is decreased by a factor of 1000, so $\\epsilon_{final} = \\epsilon_{initial} / 1000$. This means the ratio $\\frac{\\epsilon_{final}}{\\epsilon_{initial}} = \\frac{1}{1000}$. Substituting this into our equation for the ratio of steps:\n$$\\frac{N_{final}}{N_{initial}} = \\left(\\frac{1}{1000}\\right)^{-1/5} = (1000)^{1/5}$$\n\nNow we compute the numerical value:\n$$(1000)^{1/5} = (10^3)^{1/5} = 10^{3/5} = 10^{0.6}$$\nUsing a calculator to evaluate this expression:\n$$10^{0.6} \\approx 3.9810717...$$\n\nThe problem requires the answer to be rounded to three significant figures. The first three significant figures are 3, 9, and 8. The fourth significant figure is 1, which is less than 5, so we round down.\nThe multiplicative factor is approximately 3.98.", "answer": "$$\\boxed{3.98}$$", "id": "2158591"}, {"introduction": "While powerful, adaptive methods are not infallible, and their behavior can be subtle, especially in complex systems. In systems with multiple dynamic modes—some decaying rapidly, others growing slowly—the very definition of \"error\" can influence the solver's focus. This thought experiment [@problem_id:2158607] reveals a potential pitfall where the standard error measurement can be dominated by a harmless, fast-decaying part of the solution, inadvertently allowing a dangerous, unstable part to grow undetected.", "problem": "Consider a two-dimensional linear system of ordinary differential equations (ODEs) described by $\\vec{y}'(t) = A \\vec{y}(t)$, with $\\vec{y}(t) = \\begin{pmatrix} y_1(t) \\\\ y_2(t) \\end{pmatrix}$. The constant matrix $A$ is given by\n$$\nA = \\frac{1}{2} \\begin{pmatrix} -L+\\epsilon & -L-\\epsilon \\\\ -L-\\epsilon & -L+\\epsilon \\end{pmatrix},\n$$\nwhere $L$ and $\\epsilon$ are positive real constants satisfying $L \\gg \\epsilon$. The system evolves from the initial state $\\vec{y}(0) = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$.\n\nThis system possesses one stable mode that decays exponentially and one unstable mode that grows exponentially. The exact solution can be decomposed as $\\vec{y}(t) = \\vec{y}_s(t) + \\vec{y}_u(t)$, where $\\vec{y}_s(t)$ represents the stable part of the solution (i.e., $\\vec{y}_s(t) \\to \\vec{0}$ as $t \\to \\infty$) and $\\vec{y}_u(t)$ represents the unstable part.\n\nWhen solving such a system numerically with an adaptive step-size method, the algorithm estimates the local error at each step. For many methods, this local error estimate is proportional to the second derivative of the solution, $\\vec{y}''(t)$. A common step-size control strategy aims to keep the magnitude of this error vector, measured by the infinity norm $\\|\\vec{y}''(t)\\|_\\infty$, below a certain tolerance. This strategy can be problematic if the contribution from the unstable mode to this norm is negligible, as the algorithm may fail to control the growth of global error in that mode.\n\nLet the unstable part of the error estimator vector be defined as $\\vec{\\delta}_{unstable}(t) = \\vec{y}_u''(t)$. We want to find the time at which the contribution of the unstable mode to the error estimate becomes significant. Determine the time $t^*$ at which the infinity norm of the unstable contribution is exactly half of the infinity norm of the total error estimator vector. That is, find $t^*$ such that\n$$\n\\|\\vec{\\delta}_{unstable}(t^*)\\|_\\infty = \\frac{1}{2} \\|\\vec{y}''(t^*)\\|_\\infty.\n$$\nExpress your answer as a closed-form analytic expression in terms of $L$ and $\\epsilon$.", "solution": "We analyze the linear system $\\vec{y}'(t)=A\\vec{y}(t)$ with\n$$\nA=\\frac{1}{2}\\begin{pmatrix}-L+\\epsilon & -L-\\epsilon\\\\ -L-\\epsilon & -L+\\epsilon\\end{pmatrix}.\n$$\nIntroduce the symmetric matrices $J=\\begin{pmatrix}1 & 1\\\\ 1 & 1\\end{pmatrix}$ and $K=\\begin{pmatrix}1 & -1\\\\ -1 & 1\\end{pmatrix}$ so that $A=-\\frac{L}{2}J+\\frac{\\epsilon}{2}K$. The vectors $v_{s}=\\begin{pmatrix}1\\\\ 1\\end{pmatrix}$ and $v_{u}=\\begin{pmatrix}1\\\\ -1\\end{pmatrix}$ are eigenvectors since $Jv_{s}=2v_{s}$, $Kv_{s}=0$, $Jv_{u}=0$, $Kv_{u}=2v_{u}$. Hence\n$$\nA v_{s}=-L v_{s},\\qquad A v_{u}=\\epsilon v_{u},\n$$\nso the eigenvalues are $\\lambda_{s}=-L$ (stable) and $\\lambda_{u}=\\epsilon$ (unstable).\n\nDecompose the initial condition $\\vec{y}(0)=\\begin{pmatrix}1\\\\ 0\\end{pmatrix}$ as $\\vec{y}(0)=c_{s}v_{s}+c_{u}v_{u}$. Solving $\\begin{pmatrix}1\\\\ 0\\end{pmatrix}=c_{s}\\begin{pmatrix}1\\\\ 1\\end{pmatrix}+c_{u}\\begin{pmatrix}1\\\\ -1\\end{pmatrix}$ gives $c_{s}+c_{u}=1$ and $c_{s}-c_{u}=0$, hence $c_{s}=c_{u}=\\frac{1}{2}$. The exact solution is\n$$\n\\vec{y}(t)=\\frac{1}{2}\\exp(-Lt)\\,v_{s}+\\frac{1}{2}\\exp(\\epsilon t)\\,v_{u}.\n$$\nFor a linear homogeneous system with constant coefficients, $\\vec{y}''(t)=A^{2}\\vec{y}(t)$, and for each mode, differentiation multiplies by the eigenvalue. Therefore\n$$\n\\vec{y}''(t)=\\frac{1}{2}L^{2}\\exp(-Lt)\\,v_{s}+\\frac{1}{2}\\epsilon^{2}\\exp(\\epsilon t)\\,v_{u}.\n$$\nThe unstable part of the error estimator is $\\vec{\\delta}_{unstable}(t)=\\vec{y}_{u}''(t)=\\frac{1}{2}\\epsilon^{2}\\exp(\\epsilon t)\\,v_{u}$. Since $\\|v_{u}\\|_{\\infty}=1$, we have\n$$\n\\|\\vec{\\delta}_{unstable}(t)\\|_{\\infty}=\\frac{1}{2}\\epsilon^{2}\\exp(\\epsilon t).\n$$\nThe total error estimator vector has components\n$$\n\\vec{y}''(t)=\\frac{1}{2}\\begin{pmatrix}L^{2}\\exp(-Lt)+\\epsilon^{2}\\exp(\\epsilon t)\\\\ L^{2}\\exp(-Lt)-\\epsilon^{2}\\exp(\\epsilon t)\\end{pmatrix}.\n$$\nDefine $X=L^{2}\\exp(-Lt)$ and $Y=\\epsilon^{2}\\exp(\\epsilon t)$. Then the components are $\\frac{1}{2}(X+Y)$ and $\\frac{1}{2}(X-Y)$, hence\n$$\n\\|\\vec{y}''(t)\\|_{\\infty}=\\max\\!\\left(\\frac{1}{2}(X+Y),\\,\\frac{1}{2}|X-Y|\\right).\n$$\nFor $X\\ge 0$ and $Y\\ge 0$, the inequality $X+Y\\ge |X-Y|$ implies\n$$\n\\|\\vec{y}''(t)\\|_{\\infty}=\\frac{1}{2}(X+Y)=\\frac{1}{2}\\left(L^{2}\\exp(-Lt)+\\epsilon^{2}\\exp(\\epsilon t)\\right).\n$$\nWe require $t^{*}$ such that\n$$\n\\|\\vec{\\delta}_{unstable}(t^{*})\\|_{\\infty}=\\frac{1}{2}\\|\\vec{y}''(t^{*})\\|_{\\infty}.\n$$\nSubstituting the expressions gives\n$$\n\\frac{1}{2}\\epsilon^{2}\\exp(\\epsilon t^{*})=\\frac{1}{2}\\cdot\\frac{1}{2}\\left(L^{2}\\exp(-Lt^{*})+\\epsilon^{2}\\exp(\\epsilon t^{*})\\right),\n$$\nwhich simplifies to\n$$\n2\\,\\epsilon^{2}\\exp(\\epsilon t^{*})=L^{2}\\exp(-Lt^{*})+\\epsilon^{2}\\exp(\\epsilon t^{*})\\quad\\Longrightarrow\\quad \\epsilon^{2}\\exp(\\epsilon t^{*})=L^{2}\\exp(-Lt^{*}).\n$$\nTaking natural logarithms yields\n$$\n2\\ln\\epsilon+\\epsilon t^{*}=2\\ln L - L t^{*}\\quad\\Longrightarrow\\quad (L+\\epsilon)t^{*}=2\\ln\\!\\left(\\frac{L}{\\epsilon}\\right).\n$$\nTherefore,\n$$\nt^{*}=\\frac{2\\,\\ln\\!\\left(\\frac{L}{\\epsilon}\\right)}{L+\\epsilon}.\n$$\nThis is a closed-form analytic expression in terms of $L$ and $\\epsilon$.", "answer": "$$\\boxed{\\frac{2\\,\\ln\\!\\left(\\frac{L}{\\epsilon}\\right)}{L+\\epsilon}}$$", "id": "2158607"}]}