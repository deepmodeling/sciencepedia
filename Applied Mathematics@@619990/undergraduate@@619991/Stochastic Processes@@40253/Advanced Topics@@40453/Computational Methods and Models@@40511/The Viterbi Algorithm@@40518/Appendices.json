{"hands_on_practices": [{"introduction": "To begin, letâ€™s ground our understanding of the Viterbi algorithm with a classic application. This problem [@problem_id:1664280] requires you to act like a meteorologist trying to deduce the underlying atmospheric conditions from a series of weather observations. By applying the Viterbi algorithm step-by-step, you will practice the core mechanics of initialization, recursion, and backtracking to uncover the most probable sequence of hidden states, providing a solid foundation for more complex scenarios.", "problem": "A simplified meteorological model describes the daily weather using a Hidden Markov Model (HMM). The weather on any given day is determined by an unobservable, or \"hidden,\" atmospheric pressure state, which can be either 'High-Pressure' (H) or 'Low-Pressure' (L). The observable weather condition can be 'Sunny' (S), 'Cloudy' (C), or 'Rainy' (R).\n\nThe model is defined by the following probabilities:\n\n**1. Initial State Probabilities (for Day 1):**\n*   The probability that Day 1 begins in a High-Pressure state is $0.6$.\n*   The probability that Day 1 begins in a Low-Pressure state is $0.4$.\n\n**2. State Transition Probabilities (from one day to the next):**\n*   Probability of transitioning from High-Pressure to High-Pressure: $0.7$\n*   Probability of transitioning from High-Pressure to Low-Pressure: $0.3$\n*   Probability of transitioning from Low-Pressure to Low-Pressure: $0.6$\n*   Probability of transitioning from Low-Pressure to High-Pressure: $0.4$\n\n**3. Emission Probabilities (probability of an observed weather condition given the hidden pressure state):**\n*   Given a High-Pressure state:\n    *   Probability of 'Sunny': $0.8$\n    *   Probability of 'Cloudy': $0.15$\n    *   Probability of 'Rainy': $0.05$\n*   Given a Low-Pressure state:\n    *   Probability of 'Sunny': $0.1$\n    *   Probability of 'Cloudy': $0.4$\n    *   Probability of 'Rainy': $0.5$\n\nAn observer records the following sequence of weather conditions over three consecutive days: Day 1: 'Sunny', Day 2: 'Cloudy', Day 3: 'Rainy'.\n\nBased on this observed sequence and the model parameters, determine the most likely sequence of hidden atmospheric pressure states for these three days.\n\nA. H-H-H\n\nB. H-H-L\n\nC. H-L-L\n\nD. L-H-L\n\nE. L-L-H\n\nF. L-L-L", "solution": "We model the hidden atmospheric pressure states as $H$ and $L$, and the observed sequence over three days is $S, C, R$. Using the Viterbi algorithm, define\n$$\n\\delta_{t}(i)=\\max_{q_{1},\\dots,q_{t-1}} P(q_{1},\\dots,q_{t}=i, O_{1},\\dots,O_{t}),\n$$\nwith initial probabilities $\\pi_{H}=0.6$, $\\pi_{L}=0.4$, transition probabilities $a_{HH}=0.7$, $a_{HL}=0.3$, $a_{LL}=0.6$, $a_{LH}=0.4$, and emission probabilities $b_{H}(S)=0.8$, $b_{H}(C)=0.15$, $b_{H}(R)=0.05$, $b_{L}(S)=0.1$, $b_{L}(C)=0.4$, $b_{L}(R)=0.5$.\n\nInitialization for $t=1$ with $O_{1}=S$:\n$$\n\\delta_{1}(H)=\\pi_{H} b_{H}(S)=0.6\\cdot 0.8=0.48,\\qquad \\delta_{1}(L)=\\pi_{L} b_{L}(S)=0.4\\cdot 0.1=0.04.\n$$\n\nRecursion for $t=2$ with $O_{2}=C$:\n$$\n\\delta_{2}(H)=\\max\\{\\delta_{1}(H)a_{HH},\\,\\delta_{1}(L)a_{LH}\\}\\,b_{H}(C)=\\max\\{0.48\\cdot 0.7,\\,0.04\\cdot 0.4\\}\\cdot 0.15=0.336\\cdot 0.15=0.0504,\n$$\nso the backpointer is from $H$. Similarly,\n$$\n\\delta_{2}(L)=\\max\\{\\delta_{1}(H)a_{HL},\\,\\delta_{1}(L)a_{LL}\\}\\,b_{L}(C)=\\max\\{0.48\\cdot 0.3,\\,0.04\\cdot 0.6\\}\\cdot 0.4=0.144\\cdot 0.4=0.0576,\n$$\nso the backpointer is from $H$.\n\nRecursion for $t=3$ with $O_{3}=R$:\n$$\n\\delta_{3}(H)=\\max\\{\\delta_{2}(H)a_{HH},\\,\\delta_{2}(L)a_{LH}\\}\\,b_{H}(R)=\\max\\{0.0504\\cdot 0.7,\\,0.0576\\cdot 0.4\\}\\cdot 0.05=0.03528\\cdot 0.05=0.001764,\n$$\nso the backpointer is from $H$. Also,\n$$\n\\delta_{3}(L)=\\max\\{\\delta_{2}(H)a_{HL},\\,\\delta_{2}(L)a_{LL}\\}\\,b_{L}(R)=\\max\\{0.0504\\cdot 0.3,\\,0.0576\\cdot 0.6\\}\\cdot 0.5=0.03456\\cdot 0.5=0.01728,\n$$\nso the backpointer is from $L$.\n\nTermination selects the final state by maximizing $\\delta_{3}$:\n$$\n\\delta_{3}(L)=0.01728>\\delta_{3}(H)=0.001764,\n$$\nthus the most likely final state is $L$. Backtracking using the stored backpointers yields the sequence $q_{3}=L$, $q_{2}=L$, $q_{1}=H$, i.e., $H$-$L$-$L$, which corresponds to option C.", "answer": "$$\\boxed{C}$$", "id": "1664280"}, {"introduction": "After mastering the basic application, it is crucial to understand the algorithm's subtleties. This exercise [@problem_id:1664330] presents a hypothetical digital communication system designed to illustrate a phenomenon known as the \"label bias problem.\" Your task is to see how the structure of a Hidden Markov Model can lead the Viterbi algorithm to prefer certain paths, not just based on probabilities, but on the number of possible transitions from a state. This practice develops a more critical and nuanced perspective on the algorithm's behavior in real-world modeling.", "problem": "A simplified digital communication system uses a Hidden Markov Model (HMM) to interpret a sequence of received signals. The system's internal state, which represents the channel's noise characteristics, is not directly observable. The model is defined as follows:\n\n- **Set of States**: $Q = \\{S_A, S_B, S_C, S_D\\}$\n- **Set of Observations**: $O = \\{x, y\\}$\n\n- **Initial State Probabilities ($\\pi$)**: The system can start in state $S_A$ or $S_B$ with equal likelihood.\n  - $\\pi(S_A) = 0.5$\n  - $\\pi(S_B) = 0.5$\n\n- **State Transition Probabilities ($A$)**:\n  - $P(S_C | S_A) = 1.0$\n  - $P(S_C | S_B) = 0.5$\n  - $P(S_D | S_B) = 0.5$\n  - All other transition probabilities from $S_A$ and $S_B$ are zero. States $S_C$ and $S_D$ are considered terminal for sequences of length 2.\n\n- **Emission Probabilities ($B$)**:\n  - $P(x | S_A) = 0.9$ and $P(y | S_A) = 0.1$\n  - $P(x | S_B) = 0.9$ and $P(y | S_B) = 0.1$\n  - $P(y | S_C) = 0.9$ and $P(x | S_C) = 0.1$\n  - $P(y | S_D) = 1.0$ and $P(x | S_D) = 0.0$\n\nGiven the observation sequence $(x, y)$, determine the most probable sequence of hidden states that generated these observations by applying the Viterbi algorithm.\n\nWhich of the following is the most likely state sequence?\nA. $(S_A, S_C)$\n\nB. $(S_B, S_C)$\n\nC. $(S_B, S_D)$\n\nD. $(S_A, S_D)$", "solution": "We apply the Viterbi algorithm to the observation sequence $(x,y)$ with initial states restricted to $S_{A}$ and $S_{B}$ and second-step states restricted to $S_{C}$ and $S_{D}$ because only transitions $S_{A}\\to S_{C}$ and $S_{B}\\to \\{S_{C},S_{D}\\}$ are permitted and $S_{C},S_{D}$ are terminal at length $2$.\n\nInitialization (time $t=1$, observation $x$):\n$$\n\\delta_{1}(S_{A})=\\pi(S_{A})\\,b_{S_{A}}(x)=0.5\\times 0.9=0.45,\\quad\n\\delta_{1}(S_{B})=\\pi(S_{B})\\,b_{S_{B}}(x)=0.5\\times 0.9=0.45.\n$$\n\nRecursion (time $t=2$, observation $y$):\nFor $S_{C}$,\n$$\n\\delta_{2}(S_{C})=\\max\\big(\\delta_{1}(S_{A})\\,a_{S_{A}S_{C}},\\ \\delta_{1}(S_{B})\\,a_{S_{B}S_{C}}\\big)\\,b_{S_{C}}(y)\n=\\max\\big(0.45\\times 1.0,\\ 0.45\\times 0.5\\big)\\times 0.9\n=\\max(0.45,0.225)\\times 0.9=0.405,\n$$\nwith backpointer to $S_{A}$.\n\nFor $S_{D}$,\n$$\n\\delta_{2}(S_{D})=\\max\\big(\\delta_{1}(S_{A})\\,a_{S_{A}S_{D}},\\ \\delta_{1}(S_{B})\\,a_{S_{B}S_{D}}\\big)\\,b_{S_{D}}(y)\n=\\max\\big(0.45\\times 0,\\ 0.45\\times 0.5\\big)\\times 1.0\n=\\max(0,0.225)\\times 1.0=0.225,\n$$\nwith backpointer to $S_{B}$.\n\nTermination and backtrack:\n$$\n\\max\\big(\\delta_{2}(S_{C}),\\delta_{2}(S_{D})\\big)=\\max(0.405,0.225)=0.405 \\text{ at } S_{C},\n$$\nso the most likely final state is $S_{C}$, and the backpointer gives the previous state $S_{A}$. The most probable state sequence is $(S_{A},S_{C})$, which corresponds to option A.", "answer": "$$\\boxed{A}$$", "id": "1664330"}, {"introduction": "This final practice challenges you to adapt the Viterbi algorithm to solve a more complex problem with specific constraints. In this scenario [@problem_id:1345434], you must find the most likely state sequence for a chemical reactor, with the added global condition that a particular state must occur a precise number of times. This requires modifying the standard dynamic programming approach by augmenting the state representation, a powerful technique that demonstrates the flexibility of the algorithm's underlying principles and prepares you for advanced problem-solving.", "problem": "A chemical reactor's condition is monitored using a simplified model based on a Hidden Markov Model (HMM). The reactor can be in one of three hidden states: $S_1$ (Low), $S_2$ (Medium), or $S_3$ (High). At each discrete time step, a sensor records the reactor's external temperature, which can be one of three observable states: $O_1$ (Cool), $O_2$ (Warm), or $O_3$ (Hot).\n\nThe HMM is defined by the following parameters:\n\n1.  **Initial State Probabilities ($\\pi$)**: The probabilities of the system starting in each state at time $t=1$.\n    $\\pi_1 = P(q_1=S_1) = 0.6$\n    $\\pi_2 = P(q_1=S_2) = 0.2$\n    $\\pi_3 = P(q_1=S_3) = 0.2$\n\n2.  **State Transition Probability Matrix ($A$)**: The matrix $A = [a_{ij}]$ where $a_{ij} = P(q_{t+1}=S_j | q_t=S_i)$ is the probability of transitioning from state $S_i$ to state $S_j$.\n    $$\n    A = \\begin{pmatrix}\n    0.7 & 0.2 & 0.1 \\\\\n    0.3 & 0.4 & 0.3 \\\\\n    0.1 & 0.3 & 0.6\n    \\end{pmatrix}\n    $$\n\n3.  **Emission Probability Matrix ($B$)**: The matrix $B = [b_j(k)]$ where $b_j(k) = P(v_t=O_k | q_t=S_j)$ is the probability of observing $O_k$ when the system is in state $S_j$.\n    $$\n    B = \\begin{pmatrix}\n    0.80 & 0.15 & 0.05 \\\\\n    0.20 & 0.60 & 0.20 \\\\\n    0.05 & 0.15 & 0.80\n    \\end{pmatrix}\n    $$\n    Here, rows correspond to hidden states ($S_1, S_2, S_3$) and columns correspond to observations ($O_1, O_2, O_3$). For example, $b_1(2) = P(v_t=O_2|q_t=S_1) = 0.15$.\n\nA sequence of $T=4$ observations has been recorded: $V = (O_1, O_2, O_2, O_3)$, which corresponds to (Cool, Warm, Warm, Hot). For a safety analysis, it is necessary to determine the most probable sequence of hidden states that could have generated this observation sequence, subject to the global constraint that the reactor must have been in the `Medium` state ($S_2$) for exactly $k=2$ time steps.\n\nCalculate the probability of this single most probable state sequence. Round your final answer to four significant figures.", "solution": "The problem asks for the probability of the most likely hidden state sequence given an observation sequence, under a global constraint on the number of times a specific state appears. The standard Viterbi algorithm finds the most probable path but cannot handle such global constraints. We must modify the dynamic programming approach by augmenting the state definition.\n\nLet the hidden states be $\\{S_1, S_2, S_3\\}$ and the observation sequence be $V = (v_1, v_2, v_3, v_4)$, where $v_1=O_1, v_2=O_2, v_3=O_2, v_4=O_3$. The special state is $S_2$, and the constraint is that it must appear exactly $k=2$ times in the path of length $T=4$.\n\nWe define a new dynamic programming variable, $\\delta_t(j, m)$, as the maximum probability of any path of length $t$ that ends in state $S_j$, generates the first $t$ observations $v_1, ..., v_t$, and contains exactly $m$ occurrences of the special state $S_2$.\n\nThe recursion is structured as follows:\n\n**1. Initialization (t=1):**\nThe observation is $v_1=O_1$.\nThe count $m$ is 1 if the state is $S_2$, and 0 otherwise.\n$\\delta_1(j, m) = \\pi_j \\cdot b_j(v_1)$\n- For $j=1$ (state $S_1$, not special), $m=0$:\n$\\delta_1(1, 0) = \\pi_1 \\cdot b_1(O_1) = 0.6 \\cdot 0.8 = 0.48$\n- For $j=2$ (state $S_2$, special), $m=1$:\n$\\delta_1(2, 1) = \\pi_2 \\cdot b_2(O_1) = 0.2 \\cdot 0.2 = 0.04$\n- For $j=3$ (state $S_3$, not special), $m=0$:\n$\\delta_1(3, 0) = \\pi_3 \\cdot b_3(O_1) = 0.2 \\cdot 0.05 = 0.01$\nAll other $\\delta_1(j, m)$ values are zero.\n\n**2. Recursion (t=2, 3, 4):**\nFor $t > 1$, we compute $\\delta_t(j, m)$ based on the values at $t-1$.\nThe count of special states $m$ either increments or stays the same.\n- If the current state $S_j$ is **not** the special state $S_2$ (i.e., $j=1$ or $j=3$): The count $m$ does not change from the previous step.\n$$ \\delta_t(j, m) = b_j(v_t) \\cdot \\max_{i=1,2,3} \\left[ \\delta_{t-1}(i, m) \\cdot a_{ij} \\right] $$\n- If the current state $S_j$ **is** the special state $S_2$ (i.e., $j=2$): The count $m$ must have been $m-1$ at the previous step.\n$$ \\delta_t(2, m) = b_2(v_t) \\cdot \\max_{i=1,2,3} \\left[ \\delta_{t-1}(i, m-1) \\cdot a_{i2} \\right] $$\n\nLet's compute the table step by step.\n\n**Time t=2 (Observation $v_2=O_2$):**\n- $\\delta_2(1, m=0)$: (Not special) $b_1(O_2)=0.15$. Comes from $m=0$ at $t=1$.\n$\\delta_2(1, 0) = 0.15 \\cdot \\max[\\delta_1(1,0)a_{11}, \\delta_1(3,0)a_{31}] = 0.15 \\cdot \\max[0.48 \\cdot 0.7, 0.01 \\cdot 0.1] = 0.15 \\cdot 0.336 = 0.0504$\n- $\\delta_2(1, m=1)$: (Not special) $b_1(O_2)=0.15$. Comes from $m=1$ at $t=1$.\n$\\delta_2(1, 1) = 0.15 \\cdot \\max[\\delta_1(2,1)a_{21}] = 0.15 \\cdot [0.04 \\cdot 0.3] = 0.0018$\n- $\\delta_2(2, m=1)$: (Special) $b_2(O_2)=0.6$. Comes from $m=0$ at $t=1$.\n$\\delta_2(2, 1) = 0.6 \\cdot \\max[\\delta_1(1,0)a_{12}, \\delta_1(3,0)a_{32}] = 0.6 \\cdot \\max[0.48 \\cdot 0.2, 0.01 \\cdot 0.3] = 0.6 \\cdot 0.096 = 0.0576$\n- $\\delta_2(2, m=2)$: (Special) $b_2(O_2)=0.6$. Comes from $m=1$ at $t=1$.\n$\\delta_2(2, 2) = 0.6 \\cdot \\max[\\delta_1(2,1)a_{22}] = 0.6 \\cdot [0.04 \\cdot 0.4] = 0.0096$\n- $\\delta_2(3, m=0)$: (Not special) $b_3(O_2)=0.15$. Comes from $m=0$ at $t=1$.\n$\\delta_2(3, 0) = 0.15 \\cdot \\max[\\delta_1(1,0)a_{13}, \\delta_1(3,0)a_{33}] = 0.15 \\cdot \\max[0.48 \\cdot 0.1, 0.01 \\cdot 0.6] = 0.15 \\cdot 0.048 = 0.0072$\n- $\\delta_2(3, m=1)$: (Not special) $b_3(O_2)=0.15$. Comes from $m=1$ at $t=1$.\n$\\delta_2(3, 1) = 0.15 \\cdot \\max[\\delta_1(2,1)a_{23}] = 0.15 \\cdot [0.04 \\cdot 0.3] = 0.0018$\n\n**Time t=3 (Observation $v_3=O_2$):**\n- $\\delta_3(1, m=1)$: (Not special, from $m=1$ at t=2) $b_1(O_2)=0.15$.\n$\\delta_3(1, 1) = 0.15 \\cdot \\max[\\delta_2(1,1)a_{11}, \\delta_2(2,1)a_{21}, \\delta_2(3,1)a_{31}] = 0.15 \\cdot \\max[0.0018 \\cdot 0.7, 0.0576 \\cdot 0.3, 0.0018 \\cdot 0.1] = 0.15 \\cdot \\max[0.00126, 0.01728, 0.00018] = 0.15 \\cdot 0.01728 = 0.002592$\n- $\\delta_3(1, m=2)$: (Not special, from $m=2$ at t=2) $b_1(O_2)=0.15$.\n$\\delta_3(1, 2) = 0.15 \\cdot \\max[\\delta_2(2,2)a_{21}] = 0.15 \\cdot [0.0096 \\cdot 0.3] = 0.000432$\n- $\\delta_3(2, m=1)$: (Special, from $m=0$ at t=2) $b_2(O_2)=0.6$.\n$\\delta_3(2, 1) = 0.6 \\cdot \\max[\\delta_2(1,0)a_{12}, \\delta_2(3,0)a_{32}] = 0.6 \\cdot \\max[0.0504 \\cdot 0.2, 0.0072 \\cdot 0.3] = 0.6 \\cdot 0.01008 = 0.006048$\n- $\\delta_3(2, m=2)$: (Special, from $m=1$ at t=2) $b_2(O_2)=0.6$.\n$\\delta_3(2, 2) = 0.6 \\cdot \\max[\\delta_2(1,1)a_{12}, \\delta_2(2,1)a_{22}, \\delta_2(3,1)a_{32}] = 0.6 \\cdot \\max[0.0018 \\cdot 0.2, 0.0576 \\cdot 0.4, 0.0018 \\cdot 0.3] = 0.6 \\cdot \\max[0.00036, 0.02304, 0.00054] = 0.6 \\cdot 0.02304 = 0.013824$\n- $\\delta_3(3, m=1)$: (Not special, from $m=1$ at t=2) $b_3(O_2)=0.15$.\n$\\delta_3(3, 1) = 0.15 \\cdot \\max[\\delta_2(1,1)a_{13}, \\delta_2(2,1)a_{23}, \\delta_2(3,1)a_{33}] = 0.15 \\cdot \\max[0.0018 \\cdot 0.1, 0.0576 \\cdot 0.3, 0.0018 \\cdot 0.6] = 0.15 \\cdot 0.01728 = 0.002592$\n- $\\delta_3(3, m=2)$: (Not special, from $m=2$ at t=2) $b_3(O_2)=0.15$.\n$\\delta_3(3, 2) = 0.15 \\cdot \\max[\\delta_2(2,2)a_{23}] = 0.15 \\cdot [0.0096 \\cdot 0.3] = 0.000432$\n(We also compute other values like $\\delta_3(j,0)$, $\\delta_3(j,3)$, but they are not needed for the final $k=2$ calculation.)\n\n**Time t=4 (Observation $v_4=O_3$):**\nWe are interested in paths with exactly $k=2$ occurrences of $S_2$. We only need to compute $\\delta_4(j, 2)$.\n\n- $\\delta_4(1, 2)$: (Not special, from $m=2$ at t=3) $b_1(O_3)=0.05$.\n$\\delta_4(1, 2) = 0.05 \\cdot \\max[\\delta_3(1,2)a_{11}, \\delta_3(2,2)a_{21}, \\delta_3(3,2)a_{31}] = 0.05 \\cdot \\max[0.000432 \\cdot 0.7, 0.013824 \\cdot 0.3, 0.000432 \\cdot 0.1] = 0.05 \\cdot \\max[0.0003024, 0.0041472, 0.0000432] = 0.05 \\cdot 0.0041472 = 0.00020736$\n\n- $\\delta_4(2, 2)$: (Special, from $m=1$ at t=3) $b_2(O_3)=0.2$.\n$\\delta_4(2, 2) = 0.2 \\cdot \\max[\\delta_3(1,1)a_{12}, \\delta_3(2,1)a_{22}, \\delta_3(3,1)a_{32}] = 0.2 \\cdot \\max[0.002592 \\cdot 0.2, 0.006048 \\cdot 0.4, 0.002592 \\cdot 0.3] = 0.2 \\cdot \\max[0.0005184, 0.0024192, 0.0007776] = 0.2 \\cdot 0.0024192 = 0.00048384$\n\n- $\\delta_4(3, 2)$: (Not special, from $m=2$ at t=3) $b_3(O_3)=0.8$.\n$\\delta_4(3, 2) = 0.8 \\cdot \\max[\\delta_3(1,2)a_{13}, \\delta_3(2,2)a_{23}, \\delta_3(3,2)a_{33}] = 0.8 \\cdot \\max[0.000432 \\cdot 0.1, 0.013824 \\cdot 0.3, 0.000432 \\cdot 0.6] = 0.8 \\cdot \\max[0.0000432, 0.0041472, 0.0002592] = 0.8 \\cdot 0.0041472 = 0.00331776$\n\n**3. Termination:**\nThe probability of the most likely path satisfying the constraint is the maximum of the probabilities of all paths of length $T=4$ that contain exactly $k=2$ special states.\n$P^* = \\max_{j=1,2,3} \\delta_4(j, k=2)$\n$P^* = \\max[\\delta_4(1, 2), \\delta_4(2, 2), \\delta_4(3, 2)]$\n$P^* = \\max[0.00020736, 0.00048384, 0.00331776] = 0.00331776$\n\nRounding to four significant figures, we get $0.003318$.\nIn scientific notation, this is $3.318 \\times 10^{-3}$.", "answer": "$$\\boxed{3.318 \\times 10^{-3}}$$", "id": "1345434"}]}