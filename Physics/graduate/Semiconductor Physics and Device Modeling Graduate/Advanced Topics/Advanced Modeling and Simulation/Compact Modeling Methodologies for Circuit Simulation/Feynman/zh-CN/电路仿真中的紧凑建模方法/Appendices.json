{
    "hands_on_practices": [
        {
            "introduction": "紧凑建模的核心挑战之一，是将理想化的晶体管内部物理与可在外部端测量的行为精确地联系起来。真实器件总是受到寄生元件的影响，例如源极和漏极区域的串联电阻。本练习将指导您完成一个基础推导，理解这些外部电阻如何改变表观的小信号参数，例如跨导 ($g_m$) 和输出电导 ($g_{ds}$)，从而对器件与电路的相互作用建立至关重要的认识。",
            "id": "3734170",
            "problem": "考虑一个三端金属-氧化物-半导体场效应晶体管 (MOSFET)，其由一个在给定工作点线性化的准静态紧凑模型描述，得到本征增量跨导 $g_{m}$ 和本征增量输出电导 $g_{ds}$。假设栅极和体电极电流可忽略不计，因此只有漏极和源极导电通路承载电流。外部源极和漏极端子分别通过串联电阻 $R_{s}$ 和 $R_{d}$ 连接到本征源极和漏极。设小信号外部栅极电压为 $v_{g}$，小信号外部漏极电压为 $v_{d}$，且外部源极为小信号参考点（零）。用 $i_{d}$ 表示在外部漏极端子上测量的小信号漏极电流。\n\n从适用于紧凑模型的基本电路定律和定义出发，即 Kirchhoff 定律、串联电阻的 Ohm 定律以及晶体管沟道的本征小信号二端口描述，推导串联电阻 $R_{s}$ 和 $R_{d}$ 如何改变内部电压并反馈到沟道上，从而产生在外部端子上观察到的表观跨导和输出电导。将 $g_{m}$ 和 $g_{ds}$ 视为工作点线性化后的常数，并忽略体跨导。\n\n您的任务是获得在外部端子上测量的表观跨导 $g_{m,\\mathrm{app}}$ 和表观输出电导 $g_{out,\\mathrm{app}}$ 的闭式解析表达式，该表达式以 $g_{m}$、$g_{ds}$、$R_{s}$ 和 $R_{d}$ 表示。将您的最终答案表示为包含 $g_{m,\\mathrm{app}}$ 和 $g_{out,\\mathrm{app}}$ 的单行矩阵。最终答案中无需进行数值计算，也无需包含单位。",
            "solution": "以下是推导过程：\n- 定义小信号等效电路，包括本征和外部的节点与元件。\n- 定义本征和外部的电压与电流。使用相对于公共源极端子 ($v_s=0$) 的电位。\n- 写出本征晶体管的本构关系：$i_d = g_m v_{g's'} + g_{ds} v_{d's'}$。\n- 使用欧姆定律写出外部电阻的关系式：$v_{s'} = i_d R_s$ 和 $v_{d'} = v_d - i_d R_d$。\n- 将本征电压与外部电压关联起来：$v_{g's'} = v_g - v_{s'}$ 和 $v_{d's'} = v_{d'} - v_{s'}$。由于栅极电流为零，本征栅极与外部栅极的电位相同 ($v_{g'} = v_g$)。\n- 将所有这些代入主本构方程，得到一个关联 $i_d$、$v_g$ 和 $v_d$ 的方程。\n- 进行代数运算，将方程整理为 $i_d = (\\text{...})v_g + (\\text{...})v_d$ 的形式。\n- 根据定义确定表观参数：$g_{m,\\text{app}} = \\frac{\\partial i_d}{\\partial v_g}$ 和 $g_{out,\\text{app}} = \\frac{\\partial i_d}{\\partial v_d}$。这些是 $v_g$ 和 $v_d$ 的系数。\n- 给出 $g_{m,\\text{app}}$ 和 $g_{out,\\text{app}}$ 的最终表达式。",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{g_{m}}{1 + g_{m} R_{s} + g_{ds} (R_{s} + R_{d})}  & \\frac{g_{ds}}{1 + g_{m} R_{s} + g_{ds} (R_{s} + R_{d})} \\end{pmatrix}}$$"
        },
        {
            "introduction": "像SPICE这样的电路模拟器的收敛稳定性在很大程度上依赖于模型方程的连续可微性。然而，物理描述常常涉及非光滑操作，如绝对值或最大/最小值函数，这可能导致模拟器的牛顿-拉夫逊求解器中断。本练习展示了一种强大且广泛使用的技术来克服此问题，即用光滑近似替换这些尖锐函数，并指导您量化在数值鲁棒性与模型精度之间所做的权衡。",
            "id": "3734155",
            "problem": "考虑一个用于鲁棒电路仿真的金属-氧化物-半导体场效应晶体管（MOSFET）紧凑模型，该仿真采用牛顿-拉夫逊（NR）方法，其中要求一阶导数相对于端口电压的连续性以确保稳定收敛。紧凑模型中非光滑行为的一个常见来源是使用绝对值运算 $|x|$ 以及最小值或最大值算子 $\\min(x,y)$ 和 $\\max(x,y)$，例如在相对于 $V_{ds}$ 对称化沟道输运或通过 $\\max(0, V_{gs}-V_{th})$ 强制反型电荷 $Q_{\\mathrm{inv}}$ 非负的公式中。为了消除导数不连续性同时保持物理单调性，通常用光滑近似来代替这些非光滑运算。具体来说，考虑用光滑近似（有时称为“软绝对值”函数）来代替绝对值函数 $|x|$\n$$\ng_{a}(x) = \\frac{1}{a}\\,\\ln\\!\\big(2\\cosh(a x)\\big),\n$$\n其中 $a>0$ 是一个平滑参数，其单位与 $x$ 的单位成反比，$\\cosh(\\cdot)$ 是双曲余弦函数。这种替换在紧凑建模方法学中被广泛使用，因为 $g_{a}(x)$ 是无穷次可微的凸函数，而 $|x|$ 是凸函数但在 $x=0$ 处不可微。从微积分的第一性原理和双曲函数的性质出发，推导近似误差的上确界范数的闭式表达式\n$$\nE_{\\max}(a) = \\sup_{x\\in\\mathbb{R}} \\left|\\,g_{a}(x) - |x|\\,\\right|.\n$$\n您的推导不得假设或引用任何预先推导的误差界。请根据 $\\cosh(\\cdot)$ 和 $\\ln(\\cdot)$ 的定义以及凸函数和偶函数的标准性质进行推导。将您的最终答案表示为关于 $a$ 的单个精确解析表达式。无需进行数值四舍五入。最终表达式中不要包含单位。",
            "solution": "目标是求近似误差的上确界范数，定义为\n$$\nE_{\\max}(a) = \\sup_{x\\in\\mathbb{R}} \\left|\\,g_{a}(x) - |x|\\,\\right|\n$$\n其中 $g_{a}(x)$ 是绝对值函数 $|x|$ 的光滑近似，由下式给出\n$$\ng_{a}(x) = \\frac{1}{a}\\,\\ln\\!\\big(2\\cosh(a x)\\big)\n$$\n其中平滑参数 $a>0$。\n\n我们定义误差函数 $E(x,a) = g_{a}(x) - |x|$。问题是确定 $|E(x,a)|$ 在所有 $x \\in \\mathbb{R}$ 上的上确界。\n\n首先，我们分析所涉及函数的性质。绝对值函数 $|x|$ 是一个偶函数，即 $|-x|=|x|$。双曲余弦函数定义为 $\\cosh(z) = \\frac{1}{2}(\\exp(z) + \\exp(-z))$，它也是一个偶函数，因为 $\\cosh(-z) = \\cosh(z)$。因此，光滑近似 $g_{a}(x)$ 是 $x$ 的一个偶函数：\n$$\ng_{a}(-x) = \\frac{1}{a}\\,\\ln\\!\\big(2\\cosh(a (-x))\\big) = \\frac{1}{a}\\,\\ln\\!\\big(2\\cosh(ax)\\big) = g_{a}(x)\n$$\n由于 $g_{a}(x)$ 和 $|x|$ 都是偶函数，它们的差，即误差函数 $E(x,a)$，也是一个偶函数。这种对称性使我们可以将分析限制在定义域 $x \\ge 0$ 上，因为 $x < 0$ 时的行为将是其镜像。对于 $x \\ge 0$，我们有 $|x|=x$。\n\n让我们为 $x \\ge 0$ 推导 $E(x,a)$ 的简化表达式。代入 $\\cosh(\\cdot)$ 的定义：\n$$\nE(x,a) = \\frac{1}{a}\\,\\ln\\!\\left(2 \\cdot \\frac{\\exp(ax)+\\exp(-ax)}{2}\\right) - x\n$$\n$$\nE(x,a) = \\frac{1}{a}\\,\\ln\\!\\big(\\exp(ax)+\\exp(-ax)\\big) - x\n$$\n我们可以从对数的参数中提出因子 $\\exp(ax)$：\n$$\nE(x,a) = \\frac{1}{a}\\,\\ln\\!\\big(\\exp(ax)(1+\\exp(-2ax))\\big) - x\n$$\n使用对数性质 $\\ln(uv) = \\ln(u) + \\ln(v)$：\n$$\nE(x,a) = \\frac{1}{a}\\,\\big[\\ln(\\exp(ax)) + \\ln(1+\\exp(-2ax))\\big] - x\n$$\n由于 $\\ln(\\exp(z))=z$：\n$$\nE(x,a) = \\frac{1}{a}\\,\\big[ax + \\ln(1+\\exp(-2ax))\\big] - x\n$$\n$$\nE(x,a) = x + \\frac{1}{a}\\ln(1+\\exp(-2ax)) - x\n$$\n$$\nE(x,a) = \\frac{1}{a}\\ln(1+\\exp(-2ax))\n$$\n这就是 $x \\ge 0$ 时误差的表达式。\n\n现在我们需要确定 $E(x,a)$ 的符号。给定参数 $a>0$。在分析域 $x \\ge 0$ 内，指数 $-2ax \\le 0$。这意味着 $\\exp(-2ax) \\in (0, 1]$。因此，对数的参数 $1+\\exp(-2ax)$ 位于区间 $(1, 2]$ 内。由于当 $z>1$ 时 $\\ln(z) > 0$，我们有 $\\ln(1+\\exp(-2ax)) \\ge 0$。因为 $a>0$，所以对于所有 $x \\ge 0$，$E(x,a) \\ge 0$。\n由于 $E(x,a)$ 是一个偶函数，因此对于所有 $x \\in \\mathbb{R}$，$E(x,a) \\ge 0$。这证明了光滑近似 $g_a(x)$ 总是大于或等于 $|x|$，即它从上方近似 $|x|$。\n这个发现简化了我们的任务，因为误差上的绝对值变得多余了：\n$$\n|E(x,a)| = |g_a(x) - |x|| = g_a(x) - |x| = E(x,a)\n$$\n问题现在简化为求 $E(x,a)$ 在 $x \\in \\mathbb{R}$ 上的上确界。\n$$\nE_{\\max}(a) = \\sup_{x\\in\\mathbb{R}} E(x,a)\n$$\n由于 $E(x,a)$ 的偶对称性，其在 $\\mathbb{R}$ 上的上确界与在 $[0, \\infty)$ 上的上确界相同。\n$$\nE_{\\max}(a) = \\sup_{x \\ge 0} E(x,a) = \\sup_{x \\ge 0} \\left( \\frac{1}{a}\\ln(1+\\exp(-2ax)) \\right)\n$$\n为了找到这个上确界，我们通过考察 $E(x,a)$ 对 $x$ 的一阶导数来分析其在 $x \\ge 0$ 上的单调性。设 $f(x) = E(x,a)$。\n$$\nf'(x) = \\frac{d}{dx} \\left[ \\frac{1}{a}\\ln(1+\\exp(-2ax)) \\right]\n$$\n使用链式法则：\n$$\nf'(x) = \\frac{1}{a} \\cdot \\frac{1}{1+\\exp(-2ax)} \\cdot \\frac{d}{dx}(1+\\exp(-2ax))\n$$\n$$\nf'(x) = \\frac{1}{a} \\cdot \\frac{1}{1+\\exp(-2ax)} \\cdot (-2a\\exp(-2ax))\n$$\n$$\nf'(x) = -\\frac{2\\exp(-2ax)}{1+\\exp(-2ax)}\n$$\n对于 $x>0$ 和 $a>0$，项 $\\exp(-2ax)$ 是严格为正的。因此，分子 $-2\\exp(-2ax)$ 是严格为负的，分母 $1+\\exp(-2ax)$ 是严格为正的。这意味着对于所有 $x > 0$，$f'(x) < 0$。\n一个在一阶导数为负的区间上的函数在该区间上是严格递减的。因此，$E(x,a)$ 是 $x$ 在 $[0, \\infty)$ 上的一个严格递减函数。\n\n一个在闭区间 $[0, \\infty)$ 上的严格递减函数的上确界必定在最左端的点达到，即 $x=0$。\n因此，最大误差是误差函数在 $x=0$ 处的值。\n$$\nE_{\\max}(a) = E(0,a) = \\frac{1}{a}\\ln(1+\\exp(-2a \\cdot 0))\n$$\n$$\nE_{\\max}(a) = \\frac{1}{a}\\ln(1+\\exp(0))\n$$\n$$\nE_{\\max}(a) = \\frac{1}{a}\\ln(1+1)\n$$\n$$\nE_{\\max}(a) = \\frac{1}{a}\\ln(2)\n$$\n这就是近似误差的上确界范数的闭式表达式。\n作为最后的检验，我们可以计算当 $x \\to \\infty$ 时误差的极限：\n$$\n\\lim_{x\\to\\infty} E(x,a) = \\lim_{x\\to\\infty} \\frac{1}{a}\\ln(1+\\exp(-2ax)) = \\frac{1}{a}\\ln(1+0) = 0\n$$\n由于函数从其在 $x=0$ 处的最大值递减至 $0$ (当 $x \\to \\infty$ 时)，因此在 $x=0$ 处的值确实是上确界。最大近似误差发生在原始函数 $|x|$ 的不可微点处，这对于平滑近似来说是符合直觉的。",
            "answer": "$$\n\\boxed{\\frac{\\ln(2)}{a}}\n$$"
        },
        {
            "introduction": "一个高质量的紧凑模型不仅要描述器件行为，更必须建立在物理一致性的基础上才能保证其可靠性。本练习让您扮演模型验证工程师的角色，任务是实现对基本物理定律的自动化检查：电容互易性、Gummel对称性和电荷守恒。通过测试不同的假设模型，您将获得识别常见陷阱的实践经验，并学会在模型部署前确保其物理上的健全性。",
            "id": "3734152",
            "problem": "您的任务是构建一个程序，对用于半导体器件电路仿真的紧凑模型执行一致性检查。背景是多端准静态基于电荷的紧凑模型，其中终端电荷是终端电压的函数。您的检查必须评估确保电路仿真器中物理合理性和数值稳定性的数学特性：电容互易性、Gummel对称性和电荷守恒。所有计算都必须使用国际单位制（SI），电压单位为伏特（V），电荷单位为库仑（C），电流单位为安培（A），电容单位为法拉（F）。尽管程序的最终输出是无量纲的布尔值，但内部计算必须一致地使用这些单位。\n\n基本原理：\n- 设该器件有以 $\\{g,d,s,b\\}$ 索引的终端，分别对应栅极、漏极、源极和体极。终端电压表示为 $V_g$、$V_d$、$V_s$ 和 $V_b$。\n- 在准静态基于电荷的紧凑模型中，终端电荷 $Q_i(V_g,V_d,V_s,V_b)$ 可以直接定义，也可以通过标量能量函数 $E(V_g,V_d,V_s,V_b)$ 以 $Q_i = -\\partial E/\\partial V_i$ 的方式定义。\n- 混合（交叉）电容定义为 $C_{ij} = -\\partial Q_i/\\partial V_j$，其中 $i \\neq j$。\n- 如果 $Q_i$ 是从一个足够平滑的标量能量 $E$ 推导出来的，那么根据混合偏导数的相等性，可以预期互易性 $C_{ij} = C_{ji}$。\n- 如果模型是规范不变的，即能量仅取决于电压差，则多端器件的电荷守恒成立。此时 $\\sum_{i \\in \\{g,d,s,b\\}} Q_i = 0$。\n- Gummel对称性测试（GST）用于对称的双端导电路径（例如，金属-氧化物-半导体场效应晶体管（MOSFET）中漏极和源极之间的沟道），检查在对称偏置附近，漏极电流 $I_d$ 是否是漏源电压 $V_{ds} = V_d - V_s$ 的奇函数；具体来说，当所有其他偏置保持固定时，$I_d(V_{ds}) \\approx -I_d(-V_{ds})$（这反映了在对称器件中交换漏极和源极下的不变性）。\n\n您的程序必须实现以下检查：\n1.  电容互易性：在指定的中心偏置点，使用中心差分格式数值计算 $C_{gd} = -\\partial Q_g/\\partial V_d$ 和 $C_{dg} = -\\partial Q_d/\\partial V_g$，并返回一个布尔值，指示是否满足 $|C_{gd} - C_{dg}| \\le \\tau_C$，容差 $\\tau_C = 1\\times 10^{-14}\\ \\mathrm{F}$。\n2.  Gummel对称性：在固定的 $V_g$ 和 $V_b$下，评估 $V_{ds} = +\\Delta$ 和 $V_{ds} = -\\Delta$ 时的 $I_d$，并返回一个布尔值，指示是否满足 $|I_d(+\\Delta) + I_d(-\\Delta)| \\le \\tau_I$，容差 $\\tau_I = 1\\times 10^{-12}\\ \\mathrm{A}$，$\\Delta = 0.1\\ \\mathrm{V}$。\n3.  电荷守恒：在指定的偏置点网格上，计算 $\\max |Q_g + Q_d + Q_s + Q_b|$，并返回一个布尔值，指示该最大值是否 $\\le \\tau_Q$，容差 $\\tau_Q = 1\\times 10^{-20}\\ \\mathrm{C}$。\n\n数值方法：\n- 在中心偏置点 $(V_g^\\star,V_d^\\star,V_s^\\star,V_b^\\star)$ 使用中心有限差分（FD）近似计算偏导数，步长为 $\\Delta V_g = 0.1\\ \\mathrm{V}$ 和 $\\Delta V_d = 0.1\\ \\mathrm{V}$：\n  - $-\\partial Q_g/\\partial V_d \\approx -\\dfrac{Q_g(V_d^\\star+\\Delta V_d) - Q_g(V_d^\\star-\\Delta V_d)}{2\\,\\Delta V_d}$，在 $V_g=V_g^\\star$、$V_b=V_b^\\star$、$V_s=V_s^\\star$ 处求值。\n  - $-\\partial Q_d/\\partial V_g \\approx -\\dfrac{Q_d(V_g^\\star+\\Delta V_g) - Q_d(V_g^\\star-\\Delta V_g)}{2\\,\\Delta V_g}$，在 $V_d=V_d^\\star$、$V_b=V_b^\\star$、$V_s=V_s^\\star$ 处求值。\n\n测试套件和数据集：\n您必须在一个偏置网格上评估四个独立的数据集案例。该网格为：\n- 栅极电压集：$V_g \\in \\{0.8,\\,0.9,\\,1.0\\}\\ \\mathrm{V}$。\n- 漏极电压集：$V_d \\in \\{-0.1,\\,0.0,\\,0.1\\}\\ \\mathrm{V}$。\n- 源极电压：$V_s = 0.0\\ \\mathrm{V}$。\n- 体极电压：$V_b = -0.2\\ \\mathrm{V}$。\n\n中心偏置为 $V_g^\\star=0.9\\ \\mathrm{V}$、$V_d^\\star=0.0\\ \\mathrm{V}$、$V_s^\\star=0.0\\ \\mathrm{V}$、$V_b^\\star=-0.2\\ \\mathrm{V}$。\n\n对于以下每个案例，定义 $x = V_g - V_s$，$y = V_d - V_s$ 和 $z = V_b - V_s$。\n\n案例1（基于能量的一致性模型）：\n- 定义一个能量函数\n$$\nE(x,y,z) = \\tfrac{1}{2}C_{gs}x^2 + \\tfrac{1}{2}C_{ds}y^2 + \\tfrac{1}{2}C_{bs}z^2 + C_{gd}xy + C_{gb}xz + C_{db}yz + \\tfrac{1}{4}\\alpha\\,x^2 y^2,\n$$\n其中常数 $C_{gs}=1.0\\times 10^{-12}\\ \\mathrm{F}$、$C_{ds}=5.0\\times 10^{-13}\\ \\mathrm{F}$、$C_{bs}=2.0\\times 10^{-13}\\ \\mathrm{F}$、$C_{gd}=1.0\\times 10^{-13}\\ \\mathrm{F}$、$C_{gb}=5.0\\times 10^{-14}\\ \\mathrm{F}$、$C_{db}=2.0\\times 10^{-14}\\ \\mathrm{F}$ 以及 $\\alpha=5.0\\times 10^{-13}\\ \\mathrm{F}/\\mathrm{V}^2$。\n- 终端电荷为 $Q_g = -\\partial E/\\partial V_g = -\\partial E/\\partial x$、$Q_d = -\\partial E/\\partial V_d = -\\partial E/\\partial y$、$Q_b = -\\partial E/\\partial V_b = -\\partial E/\\partial z$，以及通过链式法则得到的 $Q_s = -\\partial E/\\partial V_s$。\n- 漏极电流定义为 $y$ 的对称奇函数：$I_d = k\\,(x - V_{\\mathrm{th}})\\,y$，其中 $k = 1.0\\times 10^{-5}\\ \\mathrm{S}$ 且 $V_{\\mathrm{th}} = 0.6\\ \\mathrm{V}$。\n\n案例2（具有非互易交叉依赖的直接电荷定义）：\n- 定义\n$$\nQ_g(x,y,z) = -\\big(a\\,x + b\\,y + e\\,z + \\beta\\,x\\,y^2\\big),\\quad\nQ_d(x,y,z) = -\\big(c\\,y + d\\,x + f\\,z + \\gamma\\,x^2\\,y\\big),\n$$\n其中 $a=1.0\\times 10^{-12}\\ \\mathrm{F}$、$b=2.0\\times 10^{-13}\\ \\mathrm{F}$、$e=5.0\\times 10^{-14}\\ \\mathrm{F}$、$c=5.0\\times 10^{-13}\\ \\mathrm{F}$、$d=5.0\\times 10^{-14}\\ \\mathrm{F}$、$f=2.0\\times 10^{-14}\\ \\mathrm{F}$、$\\beta=3.0\\times 10^{-13}\\ \\mathrm{F}/\\mathrm{V}^2$ 以及 $\\gamma=5.0\\times 10^{-13}\\ \\mathrm{F}/\\mathrm{V}^2$。设 $Q_b(x,y,z) = -(g\\,z + h\\,x + i\\,y)$，其中 $g=2.0\\times 10^{-13}\\ \\mathrm{F}$、$h=5.0\\times 10^{-14}\\ \\mathrm{F}$、$i=2.0\\times 10^{-14}\\ \\mathrm{F}$，并通过 $Q_s = -(Q_g + Q_d + Q_b)$ 来定义 $Q_s$，这样总电荷通过构造总和为零。漏极电流与案例1相同：$I_d = k\\,(x - V_{\\mathrm{th}})\\,y$。\n- 这种构造故意违反了 $g$ 和 $d$ 之间的互易性，因为 $-\\partial Q_g/\\partial V_d$ 和 $-\\partial Q_d/\\partial V_g$ 不匹配。\n\n案例3（基于能量的电荷但明确违反电荷守恒）：\n- 使用与案例1相同的能量 $E$ 和 $Q_g,Q_d,Q_b$。定义 $Q_s$ 为 $Q_s = -(Q_g + Q_d + Q_b) + \\delta_Q$，其中 $\\delta_Q = 1.0\\times 10^{-13}\\ \\mathrm{C}$，从而破坏电荷守恒。漏极电流保持为 $I_d = k\\,(x - V_{\\mathrm{th}})\\,y$。\n\n案例4（基于能量的电荷，但电流违反Gummel对称性）：\n- 使用与案例1相同的能量 $E$ 和电荷 $Q_g,Q_d,Q_b$，并定义 $Q_s = -(Q_g + Q_d + Q_b)$ 以保持电荷守恒。定义漏极电流为 $I_d = k\\,(x - V_{\\mathrm{th}})\\,y + \\eta\\,y^2$，其中 $\\eta = 1.0\\times 10^{-6}\\ \\mathrm{A}/\\mathrm{V}^2$，这增加了一个关于 $y$ 的偶函数分量，从而违反了Gummel对称性。\n\n实现要求：\n- 您的程序必须遵循上述数值方法和容差，为每个案例独立地评估三个布尔值：互易性、Gummel对称性和电荷守恒。\n- 您的程序必须生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表。顺序必须是\n$[\\mathrm{rec}_1,\\mathrm{gum}_1,\\mathrm{chg}_1,\\mathrm{rec}_2,\\mathrm{gum}_2,\\mathrm{chg}_2,\\mathrm{rec}_3,\\mathrm{gum}_3,\\mathrm{chg}_3,\\mathrm{rec}_4,\\mathrm{gum}_4,\\mathrm{chg}_4]$，\n其中 $\\mathrm{rec}_k$ 是案例 $k$ 的互易性布尔值，$\\mathrm{gum}_k$ 是案例 $k$ 的Gummel对称性布尔值，$\\mathrm{chg}_k$ 是案例 $k$ 的电荷守恒布尔值。",
            "solution": "该问题要求实现一个程序，对一个四端半导体器件的四种不同准静态基于电荷的紧凑模型执行三项基本的一致性检查。这些检查包括电容互易性、沟道电流的Gummel对称性以及总电荷守恒。当在电路仿真软件中使用紧凑模型时，这些特性对于确保其物理合理性和数值表现良好至关重要。解决方案涉及为每个测试案例定义数学模型，实现数值检查程序，并将这些检查应用于每个模型。\n\n**1. 原理与数值检查**\n\n该器件有四个终端：栅极（g）、漏极（d）、源极（s）和体极（b），对应电压为 $V_g, V_d, V_s, V_b$，电荷为 $Q_g, Q_d, Q_s, Q_b$。\n\n- **电容互易性**：对于一个模型，如果其终端电荷由标量能量势 $E(V_g, V_d, V_s, V_b)$ 通过 $Q_i = -\\partial E / \\partial V_i$ 导出，那么 $E$ 的混合偏导数必须相等（克莱罗定理）。这意味着跨导电容的互易性，$C_{ij} = -\\partial Q_i / \\partial V_j$ 和 $C_{ji} = -\\partial Q_j / \\partial V_i$。具体到栅极和漏极，必须有 $C_{gd} = C_{dg}$。\n该检查通过在一个中心偏置点 $(V_g^\\star, V_d^\\star, V_s^\\star, V_b^\\star)$ 使用中心有限差分近似计算 $C_{gd}$ 和 $C_{dg}$ 之间的差值，并将其与容差 $\\tau_C$ 比较，来数值验证此属性。\n$$C_{gd} = -\\frac{\\partial Q_g}{\\partial V_d} \\approx -\\frac{Q_g(V_d^\\star+\\Delta V_d) - Q_g(V_d^\\star-\\Delta V_d)}{2\\Delta V_d}$$\n$$C_{dg} = -\\frac{\\partial Q_d}{\\partial V_g} \\approx -\\frac{Q_d(V_g^\\star+\\Delta V_g) - Q_d(V_g^\\star-\\Delta V_g)}{2\\Delta V_g}$$\n条件是 $|C_{gd} - C_{dg}| \\le \\tau_C$，其中 $\\tau_C = 1 \\times 10^{-14}\\ \\mathrm{F}$，$\\Delta V_g = 0.1\\ \\mathrm{V}$，$\\Delta V_d = 0.1\\ \\mathrm{V}$。\n\n- **Gummel对称性**：对于对称器件结构（例如，漏极和源极可互换的MOSFET），当器件在线性区且 $V_{ds}=0$ 附近工作时，漏极电流 $I_d$ 应该是漏源电压 $V_{ds} = V_d - V_s$ 的奇函数。这意味着 $I_d(V_{ds}) = -I_d(-V_{ds})$，或者 $I_d(V_{ds}) + I_d(-V_{ds}) = 0$。\n该检查通过计算在 $V_{ds} = +\\Delta$ 和 $V_{ds} = -\\Delta$（其中 $\\Delta = 0.1\\ \\mathrm{V}$）时的 $I_d$，同时保持其他终端电压固定，来评估此属性。条件是 $|I_d(V_{ds}=+\\Delta) + I_d(V_{ds}=-\\Delta)| \\le \\tau_I$，其中 $\\tau_I = 1 \\times 10^{-12}\\ \\mathrm{A}$。\n\n- **电荷守恒**：基于电荷的模型必须遵守电荷守恒，即所有终端电荷的总和必须为零，$\\sum_i Q_i = 0$。此属性是底层能量函数规范不变性的结果，即能量仅取决于终端之间的电压差。\n该检查通过在一系列偏置点网格上计算 $\\sum_i Q_i$ 并确保该总和的最大绝对值低于容差 $\\tau_Q$ 来验证这一点。条件是 $\\max |\\sum_i Q_i| \\le \\tau_Q$，其中 $\\tau_Q = 1 \\times 10^{-20}\\ \\mathrm{C}$。\n\n**2. 模型定义**\n\n模型根据电压差 $x = V_g - V_s$，$y = V_d - V_s$ 和 $z = V_b - V_s$ 定义。\n\n- **案例1（基准一致性模型）**：此模型源于一个能量函数，通过构造确保了互易性和电荷守恒。\n  - 能量：$E(x,y,z) = \\tfrac{1}{2}C_{gs}x^2 + \\tfrac{1}{2}C_{ds}y^2 + \\tfrac{1}{2}C_{bs}z^2 + C_{gd}xy + C_{gb}xz + C_{db}yz + \\tfrac{1}{4}\\alpha x^2 y^2$。\n  - 电荷通过求导得到，例如 $Q_g = -\\partial E/\\partial x = -(C_{gs}x + C_{gd}y + C_{gb}z + \\tfrac{1}{2}\\alpha x y^2)$。由于能量函数仅取决于电压差，如果 $Q_s$ 使用链式法则正确导出，电荷守恒 $\\sum Q_i = 0$ 就能得到保证：$Q_s = - \\partial E / \\partial V_s = \\partial E / \\partial x + \\partial E / \\partial y + \\partial E / \\partial z = -(Q_g+Q_d+Q_b)$。\n  - 电流：$I_d = k(x-V_{\\mathrm{th}})y$，这是 $y$ 的奇函数，因此满足Gummel对称性。\n  - 预期此案例将通过所有三项检查。\n\n- **案例2（非互易模型）**：电荷函数被直接定义，选择的系数旨在违反互易性。\n  - 电荷：$Q_g = -(a x + b y + \\dots)$，$Q_d = -(c y + d x + \\dots)$，其中交叉项的系数不相等（线性部分的 $b \\neq d$）。特别地，该模型被设计为 $-\\partial Q_g / \\partial y \\neq -\\partial Q_d / \\partial x$。\n  - $Q_s$ 被定义为 $Q_s = -(Q_g+Q_d+Q_b)$，因此通过构造满足电荷守恒。\n  - 电流与案例1相同，因此满足Gummel对称性。\n  - 预期此案例将无法通过互易性检查，但能通过其他两项检查。\n\n- **案例3（不守恒电荷模型）**：基于案例1，但故意破坏了电荷守恒。\n  - 电荷 $Q_g, Q_d, Q_b$ 与案例1中相同。\n  - $Q_s$ 被定义为 $Q_s = -(Q_g+Q_d+Q_b) + \\delta_Q$，其中 $\\delta_Q = 1 \\times 10^{-13}\\ \\mathrm{C}$。因此总电荷始终为 $\\sum Q_i = \\delta_Q$。\n  - 预期此案例将仅在电荷守恒检查中失败。\n\n- **案例4（Gummel非对称模型）**：基于案例1，但修改了电流模型以违反Gummel对称性。\n  - 所有电荷与案例1相同，因此满足互易性和电荷守恒。\n  - 电流：$I_d = k(x-V_{\\mathrm{th}})y + \\eta y^2$。增加的 $\\eta y^2$ 项是 $y=V_{ds}$ 的偶函数，破坏了奇对称性。\n  - 预期此案例将仅在Gummel对称性检查中失败。\n\n**3. 实现策略**\n\n该解决方案使用Python实现。为四个案例中的每一个都定义了一个类（class），封装了各自的模型参数，并提供了计算终端电荷（$Q_g, Q_d, Q_s, Q_b$）和漏极电流（$I_d$）作为终端电压函数的成员方法（methods）。\n\n三个独立的函数实现这些检查：`check_reciprocity`、`check_gummel` 和 `check_charge_conservation`。这些函数接收一个模型对象作为输入，并根据问题陈述中指定的规范执行数值计算，返回一个布尔结果。\n\n主函数 `solve` 负责协调整个过程。它为所有四个案例初始化模型对象。然后，它遍历每个模型，应用三个检查函数，并收集十二个布尔结果。最后，它将这些结果格式化为所需的单行字符串输出。这种模块化设计确保了在实施指定的验证程序时的清晰性、可重用性和正确性。例如，案例2的解析互易性检查依赖于比较 $-\\partial Q_g/\\partial y = b+2\\beta xy$ 和 $-\\partial Q_d/\\partial x = d+2\\gamma xy$。在中心偏置点，其中 $y=V_d-V_s=0.0-0.0=0$，这简化为比较 $b=2.0\\times 10^{-13}\\ \\mathrm{F}$ 和 $d=5.0\\times 10^{-14}\\ \\mathrm{F}$。它们的差值 $1.5\\times 10^{-13}\\ \\mathrm{F}$ 超过了容差 $\\tau_C=1\\times 10^{-14}\\ \\mathrm{F}$，正确地预测了互易性的 `False` 结果。代码通过数值计算证实了这一预测。",
            "answer": "```python\nimport numpy as np\n\n# Tolerances and constants from the problem statement\nTAU_C = 1e-14  # F\nTAU_I = 1e-12  # A\nTAU_Q = 1e-20  # C\nDELTA_V_G = 0.1  # V\nDELTA_V_D = 0.1  # V\nDELTA_GST = 0.1  # V for Gummel Symmetry Test\n\n# Central bias point\nV_STAR = (0.9, 0.0, 0.0, -0.2)  # (Vg, Vd, Vs, Vb)\n\n# Bias grid for charge conservation check\nV_G_GRID = [0.8, 0.9, 1.0]\nV_D_GRID = [-0.1, 0.0, 0.1]\nV_S_GRID = 0.0\nV_B_GRID = -0.2\n\n\nclass ModelCase1:\n    \"\"\"Case 1: Energy-based, consistent model.\"\"\"\n    def __init__(self):\n        self.Cgs = 1.0e-12\n        self.Cds = 5.0e-13\n        self.Cbs = 2.0e-13\n        self.Cgd = 1.0e-13\n        self.Cgb = 5.0e-14\n        self.Cdb = 2.0e-14\n        self.alpha = 5.0e-13\n        self.k = 1.0e-5\n        self.Vth = 0.6\n\n    def _get_xyz(self, Vg, Vd, Vs, Vb):\n        x = Vg - Vs\n        y = Vd - Vs\n        z = Vb - Vs\n        return x, y, z\n\n    def Qg(self, Vg, Vd, Vs, Vb):\n        x, y, z = self._get_xyz(Vg, Vd, Vs, Vb)\n        return -(self.Cgs * x + self.Cgd * y + self.Cgb * z + 0.5 * self.alpha * x * y**2)\n\n    def Qd(self, Vg, Vd, Vs, Vb):\n        x, y, z = self._get_xyz(Vg, Vd, Vs, Vb)\n        return -(self.Cds * y + self.Cgd * x + self.Cdb * z + 0.5 * self.alpha * x**2 * y)\n\n    def Qb(self, Vg, Vd, Vs, Vb):\n        x, y, z = self._get_xyz(Vg, Vd, Vs, Vb)\n        return -(self.Cbs * z + self.Cgb * x + self.Cdb * y)\n\n    def Qs(self, Vg, Vd, Vs, Vb):\n        qg = self.Qg(Vg, Vd, Vs, Vb)\n        qd = self.Qd(Vg, Vd, Vs, Vb)\n        qb = self.Qb(Vg, Vd, Vs, Vb)\n        return -(qg + qd + qb)\n\n    def Id(self, Vg, Vd, Vs, Vb):\n        x, y, _ = self._get_xyz(Vg, Vd, Vs, Vb)\n        return self.k * (x - self.Vth) * y\n\n\nclass ModelCase2:\n    \"\"\"Case 2: Direct charge definitions with nonreciprocal cross-dependence.\"\"\"\n    def __init__(self):\n        self.a = 1.0e-12; self.b = 2.0e-13; self.e = 5.0e-14\n        self.c = 5.0e-13; self.d = 5.0e-14; self.f = 2.0e-14\n        self.g = 2.0e-13; self.h = 5.0e-14; self.i = 2.0e-14\n        self.beta = 3.0e-13; self.gamma = 5.0e-13\n        self.k = 1.0e-5; self.Vth = 0.6\n\n    def _get_xyz(self, Vg, Vd, Vs, Vb):\n        x = Vg - Vs; y = Vd - Vs; z = Vb - Vs\n        return x, y, z\n\n    def Qg(self, Vg, Vd, Vs, Vb):\n        x, y, z = self._get_xyz(Vg, Vd, Vs, Vb)\n        return -(self.a * x + self.b * y + self.e * z + self.beta * x * y**2)\n\n    def Qd(self, Vg, Vd, Vs, Vb):\n        x, y, z = self._get_xyz(Vg, Vd, Vs, Vb)\n        return -(self.c * y + self.d * x + self.f * z + self.gamma * x**2 * y)\n\n    def Qb(self, Vg, Vd, Vs, Vb):\n        x, y, z = self._get_xyz(Vg, Vd, Vs, Vb)\n        return -(self.g * z + self.h * x + self.i * y)\n\n    def Qs(self, Vg, Vd, Vs, Vb):\n        qg = self.Qg(Vg, Vd, Vs, Vb)\n        qd = self.Qd(Vg, Vd, Vs, Vb)\n        qb = self.Qb(Vg, Vd, Vs, Vb)\n        return -(qg + qd + qb)\n\n    def Id(self, Vg, Vd, Vs, Vb):\n        x, y, _ = self._get_xyz(Vg, Vd, Vs, Vb)\n        return self.k * (x - self.Vth) * y\n\n\nclass ModelCase3(ModelCase1):\n    \"\"\"Case 3: Energy-based charges with explicit charge conservation violation.\"\"\"\n    def __init__(self):\n        super().__init__()\n        self.delta_Q = 1.0e-13\n\n    def Qs(self, Vg, Vd, Vs, Vb):\n        # Override Qs to break charge conservation\n        qg = self.Qg(Vg, Vd, Vs, Vb)\n        qd = self.Qd(Vg, Vd, Vs, Vb)\n        qb = self.Qb(Vg, Vd, Vs, Vb)\n        return -(qg + qd + qb) + self.delta_Q\n\n\nclass ModelCase4(ModelCase1):\n    \"\"\"Case 4: Energy-based charges, Gummel symmetry violation in current.\"\"\"\n    def __init__(self):\n        super().__init__()\n        self.eta = 1.0e-6\n\n    def Id(self, Vg, Vd, Vs, Vb):\n        # Override Id to break Gummel symmetry\n        x, y, _ = self._get_xyz(Vg, Vd, Vs, Vb)\n        return self.k * (x - self.Vth) * y + self.eta * y**2\n\n\ndef check_reciprocity(model, V_star, dV_g, dV_d, tau_c):\n    \"\"\"Checks for C_gd = C_dg.\"\"\"\n    Vg_s, Vd_s, Vs_s, Vb_s = V_star\n    \n    # Calculate C_gd = -dQg/dVd\n    qg_plus = model.Qg(Vg_s, Vd_s + dV_d, Vs_s, Vb_s)\n    qg_minus = model.Qg(Vg_s, Vd_s - dV_d, Vs_s, Vb_s)\n    C_gd = -(qg_plus - qg_minus) / (2 * dV_d)\n    \n    # Calculate C_dg = -dQd/dVg\n    qd_plus = model.Qd(Vg_s + dV_g, Vd_s, Vs_s, Vb_s)\n    qd_minus = model.Qd(Vg_s - dV_g, Vd_s, Vs_s, Vb_s)\n    C_dg = -(qd_plus - qd_minus) / (2 * dV_g)\n    \n    return abs(C_gd - C_dg) = tau_c\n\ndef check_gummel(model, V_star, delta, tau_i):\n    \"\"\"Checks if Id is an odd function of Vds.\"\"\"\n    Vg_s, _, Vs_s, Vb_s = V_star\n    \n    # Since Vds = Vd - Vs, and we typically hold Vs=0, we vary Vd\n    # Problem text implies fixed Vg, Vb, Vs from central bias, where Vs=0\n    Id_plus = model.Id(Vg_s, Vs_s + delta, Vs_s, Vb_s)\n    Id_minus = model.Id(Vg_s, Vs_s - delta, Vs_s, Vb_s)\n    \n    return abs(Id_plus + Id_minus) = tau_i\n\ndef check_charge_conservation(model, Vg_grid, Vd_grid, Vs, Vb, tau_q):\n    \"\"\"Checks if sum of charges is zero over a bias grid.\"\"\"\n    max_abs_q_sum = 0\n    for vg in Vg_grid:\n        for vd in Vd_grid:\n            qg = model.Qg(vg, vd, Vs, Vb)\n            qd = model.Qd(vg, vd, Vs, Vb)\n            qs = model.Qs(vg, vd, Vs, Vb)\n            qb = model.Qb(vg, vd, Vs, Vb)\n            q_sum = qg + qd + qs + qb\n            if abs(q_sum) > max_abs_q_sum:\n                max_abs_q_sum = abs(q_sum)\n    \n    return max_abs_q_sum = tau_q\n\ndef solve():\n    \"\"\"Main function to run all checks on all cases.\"\"\"\n    \n    test_cases = [\n        ModelCase1(),\n        ModelCase2(),\n        ModelCase3(),\n        ModelCase4()\n    ]\n    \n    results = []\n    for model in test_cases:\n        # 1. Reciprocity check\n        rec_pass = check_reciprocity(model, V_STAR, DELTA_V_G, DELTA_V_D, TAU_C)\n        results.append(rec_pass)\n        \n        # 2. Gummel symmetry check\n        gum_pass = check_gummel(model, V_STAR, DELTA_GST, TAU_I)\n        results.append(gum_pass)\n        \n        # 3. Charge conservation check\n        chg_pass = check_charge_conservation(model, V_G_GRID, V_D_GRID, V_S_GRID, V_B_GRID, TAU_Q)\n        results.append(chg_pass)\n\n    # Format output as specified\n    # Python's str(True) -> 'True', str(False) -> 'False'\n    print(f\"[{','.join(str(r) for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}