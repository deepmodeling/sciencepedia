{
    "hands_on_practices": [
        {
            "introduction": "紧凑模型的核心是描述晶体管沟道的内在物理行为。然而，在实际器件中，我们测量到的是包含了寄生效应的外部特性。本练习将引导你处理一个关键的非理想效应：源极和漏极的串联电阻。你将通过推导来理解这些寄生电阻如何影响在外部端子上测得的表观跨导（$g_{m}$）和输出电导（$g_{ds}$），这是连接内在模型与实际测量数据的关键一步。",
            "id": "3734170",
            "problem": "考虑一个三端金属-氧化物-半导体场效应晶体管 (MOSFET)，其由一个准静态紧凑模型描述。该模型在给定的工作点线性化，得到本征增量跨导 $g_{m}$ 和本征增量输出电导 $g_{ds}$。假设栅极和体电流可忽略不计，因此只有漏极和源极导电通路承载电流。外部源极和漏极端子分别通过串联电阻 $R_{s}$ 和 $R_{d}$ 连接到本征源极和漏极。设小信号外部栅极电压为 $v_{g}$，小信号外部漏极电压为 $v_{d}$，外部源极为小信号参考端（零电位）。用 $i_{d}$ 表示在外部漏极端子测得的小信号漏极电流。\n\n从适用于紧凑模型的基本电路定律和定义出发，即基尔霍夫定律、串联电阻的欧姆定律以及晶体管沟道的本征小信号二端口描述，推导串联电阻 $R_{s}$ 和 $R_{d}$ 如何改变内部电压并反馈到沟道上，从而产生在外部端子上观察到的表观跨导和输出电导。将 $g_{m}$ 和 $g_{ds}$ 视为工作点线性化后的常数，并忽略体跨导。\n\n你的任务是，根据 $g_{m}$、$g_{ds}$、$R_{s}$ 和 $R_{d}$，求出在外部端子上测量的表观跨导 $g_{m,\\mathrm{app}}$ 和表观输出电导 $g_{out,\\mathrm{app}}$ 的闭式解析表达式。将你的最终答案表示为一个包含 $g_{m,\\mathrm{app}}$ 和 $g_{out,\\mathrm{app}}$ 的单行矩阵。无需进行数值计算，最终答案中也无需包含单位。",
            "solution": "*   陈述问题验证过程。\n    *   列出已知条件。\n    *   根据检查清单确认有效性。\n*   开始推导。\n*   定义小信号等效电路，包括本征和外部节点及元件。\n*   定义本征和外部电压及电流。使用相对于公共源极端子（$v_s=0$）的电位。\n*   写出本征晶体管的本构关系：$i_d = g_m v_{g's'} + g_{ds} v_{d's'}$。\n*   使用欧姆定律写出外部电阻的关系式：$v_{s'} = i_d R_s$ 和 $v_{d'} = v_d - i_d R_d$。\n*   将本征电压与外部电压关联起来：$v_{g's'} = v_g - v_{s'}$ 和 $v_{d's'} = v_{d'} - v_{s'}$。由于栅极电流为零，本征栅极与外部栅极处于相同电位（$v_{g'} = v_g$）。\n*   将所有这些代入主本构方程，得到一个关联 $i_d$、$v_g$ 和 $v_d$ 的方程。\n*   通过代数运算将方程整理为 $i_d = (\\text{...})v_g + (\\text{...})v_d$ 的形式。\n*   根据定义确定表观参数：$g_{m,\\text{app}} = \\frac{\\partial i_d}{\\partial v_g}$ 和 $g_{out,\\text{app}} = \\frac{\\partial i_d}{\\partial v_d}$。这些是 $v_g$ 和 $v_d$ 的系数。\n*   给出 $g_{m,\\mathrm{app}}$ 和 $g_{out,\\mathrm{app}}$ 的最终表达式。\n*   结束 `",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{g_{m}}{1 + g_{m} R_{s} + g_{ds} (R_{s} + R_{d})}  \\frac{g_{ds}}{1 + g_{m} R_{s} + g_{ds} (R_{s} + R_{d})} \\end{pmatrix}}$$"
        },
        {
            "introduction": "一个物理上准确的模型必须在数值上同样稳健，才能在电路仿真器中可靠地使用。诸如 SPICE 之类的仿真器依赖于牛顿-拉弗森等数值求解算法，如果模型方程导致数值溢出或存在不连续的导数，这些算法可能会失败。本练习将解决一个典型问题：如何安全地对呈指数增长的亚阈值电流进行建模。你将学习实现一个“安全指数”函数，它可以在不牺牲模型连续性的前提下防止数值溢出，从而确保仿真过程的鲁棒性。",
            "id": "3734192",
            "problem": "在电路仿真的紧凑建模中，一项核心任务是以一种物理上一致且对 SPICE (Simulation Program with Integrated Circuit Emphasis) 类引擎中使用的 Newton-Raphson 求解器在数值上稳健的方式来表示亚阈值导通。在长沟道、弱反型极限下，漏极电流可以很好地由 Boltzmann 统计驱动的形式建模，该形式随一个无量纲参数呈指数关系变化。定义无量纲亚阈值参数为 $x \\equiv \\frac{q\\,(V_{gs}-V_{th})}{n\\,k_{B}\\,T}$，其中 $q$ 是元电荷，$V_{gs}$ 是栅源电压，$V_{th}$ 是阈值电压，$n$ 是亚阈值斜率因子，$k_{B}$ 是 Boltzmann 常数，$T$ 是绝对温度。相应的亚阈值电流可以写成 $I_{D} = I_{0}\\,\\exp(x)$ 的形式，其中 $I_{0}$ 是一个不依赖于 $x$ 的指前因子。\n\n在实践中，当 $x$ 为较大的正数时，直接使用 $\\exp(x)$ 可能导致双精度算术溢出并使雅可比矩阵不稳定。为了在保持求解器稳健性的同时防止溢出，请实现一个“安全指数”函数 $f(x)$，该函数具有以下性质：\n1) 对于 $x \\le x_{c}$，$f(x) = \\exp(x)$，其中 $x_{c}$ 是一个选定的连续性阈值。\n2) $f(x)$ 在 $x = x_{c}$ 处连续可微（即，在连接点处 $C^{1}$ 连续）。\n3) 对于 $x \\ge x_{c}$，$f(x)$ 的增长速度不超过 $x$ 的线性增长。\n\n仅从这些约束和 $x$ 的定义出发，构造一个唯一的在 $x \\ge x_{c}$ 时为仿射函数且在 $x_{c}$ 处满足连续性和可微性条件的分段函数 $f(x)$。然后，通过推导当 $\\exp(x)$ 被 $f(x)$ 替换时亚阈值电流的相对误差来量化建模精度的权衡，该误差定义为 $\\varepsilon(x) \\equiv \\frac{f(x)-\\exp(x)}{\\exp(x)}$，并在一个大的参数值 $x = x_{\\max}$ 处进行评估。\n\n取 $x_{c} = $ $40$ 和 $x_{\\max} = $ $50$。计算 $\\varepsilon(x_{\\max})$ 的值并以纯数（无单位）形式给出最终值。将您的答案四舍五入到四位有效数字。",
            "solution": "在尝试求解之前，对问题陈述进行验证。\n\n### 第 1 步：提取已知条件\n-   无量纲亚阈值参数的定义：$x \\equiv \\frac{q\\,(V_{gs}-V_{th})}{n\\,k_{B}\\,T}$。\n-   亚阈值电流的形式：$I_{D} = I_{0}\\,\\exp(x)$。\n-   “安全指数”函数 $f(x)$ 的性质：\n    1.  对于 $x \\le x_{c}$，$f(x) = \\exp(x)$。\n    2.  $f(x)$ 在 $x = x_{c}$ 处连续可微（$C^{1}$）。\n    3.  对于 $x \\ge x_{c}$，$f(x)$ 是仿射函数。这是对所述条件“$f(x)$ 的增长速度不超过线性”的一个具体实现。\n-   相对误差的定义：$\\varepsilon(x) \\equiv \\frac{f(x)-\\exp(x)}{\\exp(x)}$。\n-   参数的数值：$x_{c} = 40$ 和 $x_{\\max} = 50$。\n-   目标：计算 $\\varepsilon(x_{\\max})$ 的值并四舍五入到四位有效数字。\n\n### 第 2 步：使用提取的已知条件进行验证\n-   **科学依据**：该问题在半导体器件物理和电路仿真的数值方法方面有充分的依据。亚阈值电流模型是 MOSFET 理论中的一个基本概念。使用分段函数来替换大参数下的指数函数（一种线性化或“钳位”技术）是类 SPICE 仿真器中为避免数值溢出和提高 Newton-Raphson 算法收敛稳健性而使用的标准实用方法。\n-   **适定性**：该问题是适定的。所提供的约束足以唯一确定当 $x \\ge x_{c}$ 时的仿射函数。具体而言，在点 $x=x_{c}$ 处的函数连续性（$C^0$）和一阶导数连续性（$C^1$）的要求提供了两个方程，用于求解仿射函数的两个未知参数（斜率和截距）。\n-   **客观性和清晰性**：问题陈述使用了精确、客观且无歧义的数学和技术语言。没有主观因素。\n-   **完整性和一致性**：该问题是自洽且一致的。所有必要的定义和约束都已提供，足以构造函数 $f(x)$ 并计算所需的误差。\n\n### 第 3 步：结论和行动\n该问题被判定为**有效**。它是应用数学中一个与电气工程和紧凑建模领域相关的标准练习。可以继续进行求解过程。\n\n### 解题推导\n\n“安全指数”函数 $f(x)$ 是分段定义的。对于 $x \\le x_{c}$，它就是 $\\exp(x)$。对于 $x \\ge x_{c}$，它是一个仿射函数，我们可以写成一般形式 $g(x) = Ax + B$。常数 $A$ 和 $B$ 必须被确定。\n\n$f(x)$ 的完整定义是：\n$$\nf(x) = \\begin{cases}\n\\exp(x)  \\text{if } x \\le x_{c} \\\\\nAx + B  \\text{if } x  x_{c}\n\\end{cases}\n$$\n\n问题要求 $f(x)$ 在连接点 $x = x_{c}$ 处连续可微（$C^1$）。这带来了两个条件：\n1.  **函数连续性（$C^0$）**：两部分函数在 $x = x_{c}$ 处的值必须相等。\n    $$\n    \\lim_{x \\to x_{c}^-} f(x) = \\lim_{x \\to x_{c}^+} f(x)\n    $$\n    $$\n    \\exp(x_{c}) = Ax_{c} + B\n    $$\n    这是我们得到的关于 $A$ 和 $B$ 的第一个方程。\n\n2.  **一阶导数连续性（$C^1$）**：两部分函数在 $x = x_{c}$ 处的导数必须相等。\n    首先，我们求出每一部分的导数：\n    $$\n    f'(x) = \\begin{cases}\n    \\frac{d}{dx}\\exp(x) = \\exp(x)  \\text{if } x  x_{c} \\\\\n    \\frac{d}{dx}(Ax + B) = A  \\text{if } x  x_{c}\n    \\end{cases}\n    $$\n    令 $x = x_{c}$ 处的导数相等：\n    $$\n    \\lim_{x \\to x_{c}^-} f'(x) = \\lim_{x \\to x_{c}^+} f'(x)\n    $$\n    $$\n    \\exp(x_{c}) = A\n    $$\n    这直接给出了斜率 $A$ 的值。\n\n现在，我们将 $A$ 的值代入第一个方程（由函数连续性得出），解出截距 $B$：\n$$\n\\exp(x_{c}) = (\\exp(x_{c}))\\,x_{c} + B\n$$\n$$\nB = \\exp(x_{c}) - x_{c}\\,\\exp(x_{c}) = \\exp(x_{c})\\,(1 - x_{c})\n$$\n\n找到 $A$ 和 $B$ 后，我们可以写出当 $x > x_{c}$ 时 $f(x)$ 仿射部分的显式形式：\n$$\nf(x) = Ax+B = \\exp(x_{c})\\,x + \\exp(x_{c})\\,(1 - x_{c})\n$$\n这可以更紧凑地写为：\n$$\nf(x) = \\exp(x_c)(x - x_c + 1) \\quad \\text{for } x > x_c\n$$\n这是在 $x_c$ 点处保持 $C^1$ 连续性的 $\\exp(x)$ 的唯一仿射延拓。\n\n接下来，我们推导在 $x = x_{\\max}$ 处的相对误差 $\\varepsilon(x)$。其定义为：\n$$\n\\varepsilon(x) = \\frac{f(x) - \\exp(x)}{\\exp(x)} = \\frac{f(x)}{\\exp(x)} - 1\n$$\n给定 $x_{\\max} = 50$ 和 $x_{c} = 40$。由于 $x_{\\max} > x_{c}$，我们必须使用 $f(x_{\\max})$ 的仿射表达式：\n$$\n\\varepsilon(x_{\\max}) = \\frac{\\exp(x_{c})\\,(x_{\\max} - x_{c} + 1)}{\\exp(x_{\\max})} - 1\n$$\n利用指数的性质 $\\frac{\\exp(a)}{\\exp(b)} = \\exp(a-b)$，表达式可简化为：\n$$\n\\varepsilon(x_{\\max}) = \\exp(x_{c} - x_{\\max})\\,(x_{\\max} - x_{c} + 1) - 1\n$$\n\n现在，我们代入给定的数值，$x_{c} = 40$ 和 $x_{\\max} = 50$：\n$$\nx_{c} - x_{\\max} = 40 - 50 = -10\n$$\n$$\nx_{\\max} - x_{c} + 1 = 50 - 40 + 1 = 11\n$$\n将这些值代入误差表达式：\n$$\n\\varepsilon(50) = \\exp(-10)\\,(11) - 1\n$$\n我们现在计算数值：\n$\\exp(-10)$ 的值约为 $4.53999297 \\times 10^{-5}$。\n$$\n\\varepsilon(50) \\approx (4.53999297 \\times 10^{-5}) \\times 11 - 1\n$$\n$$\n\\varepsilon(50) \\approx 0.000499399227 - 1\n$$\n$$\n\\varepsilon(50) \\approx -0.99950060077\n$$\n问题要求将答案四舍五入到四位有效数字。该值为 $-0.9995$。\n负号表示线性近似 $f(x)$ 显著低估了当 $x > x_c$ 时 $\\exp(x)$ 的真实值，这是符合预期的。接近 $1$（或 $100\\%$）的量值表明，对于 $x=50$，$\\exp(x)$ 远大于 $f(x)$，这也是符合预期的，因为指数函数的增长速度远快于线性函数。",
            "answer": "$$\n\\boxed{-0.9995}\n$$"
        },
        {
            "introduction": "在确保了模型的数值稳定性后，最后也是至关重要的一步是验证其物理一致性。一个不符合基本物理原理的模型，即使在数值上稳定，也无法准确预测电路行为。本练习将指导你实现对紧凑模型进行质量保证所需的一系列关键测试。你将通过编写程序来检验电容互易性、Gummel 对称性和电荷守恒，从而学会如何诊断和识别模型中常见的物理缺陷。",
            "id": "3734152",
            "problem": "您的任务是构建一个程序，对用于半导体器件电路仿真的紧凑模型执行一致性检查。背景是多端准静态基于电荷的紧凑模型，其中终端电荷是终端电压的函数。您的检查必须评估确保电路仿真器中物理合理性和数值稳定性的数学属性：电容互易性、Gummel对称性和电荷守恒。所有计算必须使用国际单位制（SI），电压单位为伏特（V），电荷单位为库仑（C），电流单位为安培（A），电容单位为法拉（F）。尽管程序的最终输出是无量纲的布尔值，但内部计算必须始终使用这些单位。\n\n基本原理：\n- 设器件有由 $\\{g,d,s,b\\}$ 索引的终端，分别对应栅极、漏极、源极和体。终端电压表示为 $V_g$、$V_d$、$V_s$ 和 $V_b$。\n- 在准静态基于电荷的紧凑模型中，终端电荷 $Q_i(V_g,V_d,V_s,V_b)$ 可以直接定义，也可以通过标量能量函数 $E(V_g,V_d,V_s,V_b)$ 由 $Q_i = -\\partial E/\\partial V_i$ 定义。\n- 混合（交叉）电容定义为 $C_{ij} = -\\partial Q_i/\\partial V_j$，其中 $i \\neq j$。\n- 如果 $Q_i$ 是从一个足够平滑的标量能量 $E$ 导出的，那么根据混合偏导数的相等性，可以预期互易性 $C_{ij} = C_{ji}$。\n- 对于多端器件，如果模型是规范不变的，即能量仅取决于电压差，则电荷守恒成立。此时 $\\sum_{i \\in \\{g,d,s,b\\}} Q_i = 0$。\n- 针对对称双端导电路径（例如，金属-氧化物-半导体场效应晶体管（MOSFET）的漏极和源极之间的沟道）的Gummel对称性测试（GST）检查漏极电流 $I_d$ 在对称偏置附近是否是漏源电压 $V_{ds} = V_d - V_s$ 的奇函数；具体来说，当所有其他偏置保持固定时，$I_d(V_{ds}) \\approx -I_d(-V_{ds})$（这反映了在对称器件中交换漏极和源极下的不变性）。\n\n您的程序必须实现以下检查：\n1. 电容互易性：在指定的中心偏置点，使用中心差分格式数值计算 $C_{gd} = -\\partial Q_g/\\partial V_d$ 和 $C_{dg} = -\\partial Q_d/\\partial V_g$，并返回一个布尔值，指示是否满足 $|C_{gd} - C_{dg}| \\le \\tau_C$，容差 $\\tau_C = 1\\times 10^{-14}\\ \\mathrm{F}$。\n2. Gummel对称性：在固定的 $V_g$ 和 $V_b$ 下，评估 $V_{ds} = +\\Delta$ 和 $V_{ds} = -\\Delta$ 时的 $I_d$，并返回一个布尔值，指示是否满足 $|I_d(+\\Delta) + I_d(-\\Delta)| \\le \\tau_I$，容差 $\\tau_I = 1\\times 10^{-12}\\ \\mathrm{A}$ 且 $\\Delta = 0.1\\ \\mathrm{V}$。\n3. 电荷守恒：在指定的偏置点网格上，计算 $\\max |Q_g + Q_d + Q_s + Q_b|$，并返回一个布尔值，指示该最大值是否 $\\le \\tau_Q$，容差 $\\tau_Q = 1\\times 10^{-20}\\ \\mathrm{C}$。\n\n数值方法：\n- 在中心偏置点 $(V_g^\\star,V_d^\\star,V_s^\\star,V_b^\\star)$ 使用中心有限差分（FD）近似来计算偏导数，步长为 $\\Delta V_g = 0.1\\ \\mathrm{V}$ 和 $\\Delta V_d = 0.1\\ \\mathrm{V}$：\n  - $-\\partial Q_g/\\partial V_d \\approx -\\dfrac{Q_g(V_d^\\star+\\Delta V_d) - Q_g(V_d^\\star-\\Delta V_d)}{2\\,\\Delta V_d}$，在 $V_g=V_g^\\star$、$V_b=V_b^\\star$、$V_s=V_s^\\star$ 时计算。\n  - $-\\partial Q_d/\\partial V_g \\approx -\\dfrac{Q_d(V_g^\\star+\\Delta V_g) - Q_d(V_g^\\star-\\Delta V_g)}{2\\,\\Delta V_g}$，在 $V_d=V_d^\\star$、$V_b=V_b^\\star$、$V_s=V_s^\\star$ 时计算。\n\n测试套件和数据集：\n您必须在一个偏置网格上评估四个独立的数据集案例。该网格为：\n- 栅极电压集：$V_g \\in \\{0.8,\\,0.9,\\,1.0\\}\\ \\mathrm{V}$。\n- 漏极电压集：$V_d \\in \\{-0.1,\\,0.0,\\,0.1\\}\\ \\mathrm{V}$。\n- 源极电压：$V_s = 0.0\\ \\mathrm{V}$。\n- 体电压：$V_b = -0.2\\ \\mathrm{V}$。\n\n中心偏置为 $V_g^\\star=0.9\\ \\mathrm{V}$，$V_d^\\star=0.0\\ \\mathrm{V}$，$V_s^\\star=0.0\\ \\mathrm{V}$，$V_b^\\star=-0.2\\ \\mathrm{V}$。\n\n对于下面的每个案例，定义 $x = V_g - V_s$、$y = V_d - V_s$ 和 $z = V_b - V_s$。\n\n案例1（基于能量的一致模型）：\n- 定义一个能量函数\n$$\nE(x,y,z) = \\tfrac{1}{2}C_{gs}x^2 + \\tfrac{1}{2}C_{ds}y^2 + \\tfrac{1}{2}C_{bs}z^2 + C_{gd}xy + C_{gb}xz + C_{db}yz + \\tfrac{1}{4}\\alpha\\,x^2 y^2\n$$\n其中常数 $C_{gs}=1.0\\times 10^{-12}\\ \\mathrm{F}$、$C_{ds}=5.0\\times 10^{-13}\\ \\mathrm{F}$、$C_{bs}=2.0\\times 10^{-13}\\ \\mathrm{F}$、$C_{gd}=1.0\\times 10^{-13}\\ \\mathrm{F}$、$C_{gb}=5.0\\times 10^{-14}\\ \\mathrm{F}$、$C_{db}=2.0\\times 10^{-14}\\ \\mathrm{F}$ 以及 $\\alpha=5.0\\times 10^{-13}\\ \\mathrm{F}/\\mathrm{V}^2$。\n- 终端电荷为 $Q_g = -\\partial E/\\partial V_g = -\\partial E/\\partial x$、$Q_d = -\\partial E/\\partial V_d = -\\partial E/\\partial y$、$Q_b = -\\partial E/\\partial V_b = -\\partial E/\\partial z$，以及通过链式法则得到的 $Q_s = -\\partial E/\\partial V_s$。\n- 漏极电流定义为 $y$ 的对称奇函数：$I_d = k\\,(x - V_{\\mathrm{th}})\\,y$，其中 $k = 1.0\\times 10^{-5}\\ \\mathrm{S}$ 且 $V_{\\mathrm{th}} = 0.6\\ \\mathrm{V}$。\n\n案例2（具有非互易交叉依赖的直接电荷定义）：\n- 定义\n$$\nQ_g(x,y,z) = -\\big(a\\,x + b\\,y + e\\,z + \\beta\\,x\\,y^2\\big),\\quad Q_d(x,y,z) = -\\big(c\\,y + d\\,x + f\\,z + \\gamma\\,x^2\\,y\\big)\n$$\n其中 $a=1.0\\times 10^{-12}\\ \\mathrm{F}$、$b=2.0\\times 10^{-13}\\ \\mathrm{F}$、$e=5.0\\times 10^{-14}\\ \\mathrm{F}$、$c=5.0\\times 10^{-13}\\ \\mathrm{F}$、$d=5.0\\times 10^{-14}\\ \\mathrm{F}$、$f=2.0\\times 10^{-14}\\ \\mathrm{F}$、$\\beta=3.0\\times 10^{-13}\\ \\mathrm{F}/\\mathrm{V}^2$ 以及 $\\gamma=5.0\\times 10^{-13}\\ \\mathrm{F}/\\mathrm{V}^2$。设 $Q_b(x,y,z) = -(g\\,z + h\\,x + i\\,y)$，其中 $g=2.0\\times 10^{-13}\\ \\mathrm{F}$、$h=5.0\\times 10^{-14}\\ \\mathrm{F}$、$i=2.0\\times 10^{-14}\\ \\mathrm{F}$，并通过 $Q_s = -(Q_g + Q_d + Q_b)$ 定义 $Q_s$，从而通过构造使总电荷之和为零。漏极电流与案例1相同：$I_d = k\\,(x - V_{\\mathrm{th}})\\,y$。\n- 这种构造故意违背了 $g$ 和 $d$ 之间的互易性，因为 $-\\partial Q_g/\\partial V_d$ 和 $-\\partial Q_d/\\partial V_g$ 不匹配。\n\n案例3（基于能量的电荷，但有显式电荷守恒违背）：\n- 使用与案例1中相同的能量 $E$ 以及 $Q_g,Q_d,Q_b$。通过 $Q_s = -(Q_g + Q_d + Q_b) + \\delta_Q$ 定义 $Q_s$，其中 $\\delta_Q = 1.0\\times 10^{-13}\\ \\mathrm{C}$，从而打破电荷守恒。漏极电流仍为 $I_d = k\\,(x - V_{\\mathrm{th}})\\,y$。\n\n案例4（基于能量的电荷，电流中存在Gummel对称性违背）：\n- 使用与案例1中相同的能量 $E$ 和电荷 $Q_g,Q_d,Q_b$，并定义 $Q_s = -(Q_g + Q_d + Q_b)$ 以保持电荷守恒。将漏极电流定义为 $I_d = k\\,(x - V_{\\mathrm{th}})\\,y + \\eta\\,y^2$，其中 $\\eta = 1.0\\times 10^{-6}\\ \\mathrm{A}/\\mathrm{V}^2$，这增加了一个关于 $y$ 的偶函数分量，从而违背了Gummel对称性。\n\n实现要求：\n- 您的程序必须遵循上述数值方法和容差，为每个案例独立评估三个布尔值：互易性、Gummel对称性和电荷守恒。\n- 您的程序必须生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。顺序必须是：\n$[\\mathrm{rec}_1,\\mathrm{gum}_1,\\mathrm{chg}_1,\\mathrm{rec}_2,\\mathrm{gum}_2,\\mathrm{chg}_2,\\mathrm{rec}_3,\\mathrm{gum}_3,\\mathrm{chg}_3,\\mathrm{rec}_4,\\mathrm{gum}_4,\\mathrm{chg}_4]$，\n其中 $\\mathrm{rec}_k$ 是案例 $k$ 的互易性布尔值，$\\mathrm{gum}_k$ 是案例 $k$ 的Gummel对称性布尔值，$\\mathrm{chg}_k$ 是案例 $k$ 的电荷守恒布尔值。",
            "solution": "该问题要求实现一个程序，对一个四端半导体器件的四种不同的准静态基于电荷的紧凑模型执行三个基本的一致性检查。这些检查包括电容互易性、沟道电流的Gummel对称性以及总电荷守恒。这些属性对于确保紧凑模型在电路仿真软件中使用时具有物理上的合理性和数值上的良好表现至关重要。解决方案涉及为每个测试案例定义数学模型，实现数值检查程序，并将这些检查应用于每个模型。\n\n**1. 原理与数值检查**\n\n该器件有四个终端：栅极(g)、漏极(d)、源极(s)和体(b)，对应电压为 $V_g, V_d, V_s, V_b$，电荷为 $Q_g, Q_d, Q_s, Q_b$。\n\n- **电容互易性**：对于一个模型，如果其终端电荷通过标量能量势 $E(V_g, V_d, V_s, V_b)$ 由 $Q_i = -\\partial E / \\partial V_i$ 导出，那么 $E$ 的混合偏导数必须相等（克莱罗定理）。这意味着跨导电容的互易性，$C_{ij} = -\\partial Q_i / \\partial V_j$ 和 $C_{ji} = -\\partial Q_j / \\partial V_i$。具体到栅极和漏极终端，必须有 $C_{gd} = C_{dg}$。\n该检查通过在一个中心偏置点 $(V_g^\\star, V_d^\\star, V_s^\\star, V_b^\\star)$，使用中心有限差分近似计算 $C_{gd}$ 和 $C_{dg}$ 之间的差值，并将其与容差 $\\tau_C$进行比较，从而对该属性进行数值验证。\n$$C_{gd} = -\\frac{\\partial Q_g}{\\partial V_d} \\approx -\\frac{Q_g(V_d^\\star+\\Delta V_d) - Q_g(V_d^\\star-\\Delta V_d)}{2\\Delta V_d}$$\n$$C_{dg} = -\\frac{\\partial Q_d}{\\partial V_g} \\approx -\\frac{Q_d(V_g^\\star+\\Delta V_g) - Q_d(V_g^\\star-\\Delta V_g)}{2\\Delta V_g}$$\n条件是 $|C_{gd} - C_{dg}| \\le \\tau_C$，其中 $\\tau_C = 1 \\times 10^{-14}\\ \\mathrm{F}$，$\\Delta V_g = 0.1\\ \\mathrm{V}$，且 $\\Delta V_d = 0.1\\ \\mathrm{V}$。\n\n- **Gummel对称性**：对于一个对称的器件结构（例如，MOSFET中漏极和源极可互换），当器件工作在 $V_{ds}=0$ 附近的线性区时，漏极电流 $I_d$ 应该是漏源电压 $V_{ds} = V_d - V_s$ 的奇函数。这意味着 $I_d(V_{ds}) = -I_d(-V_{ds})$，或 $I_d(V_{ds}) + I_d(-V_{ds}) = 0$。\n该检查通过在保持其他终端电压固定的情况下，计算 $V_{ds} = +\\Delta$ 和 $V_{ds} = -\\Delta$ （其中 $\\Delta = 0.1\\ \\mathrm{V}$）时的 $I_d$ 来评估此属性。条件是 $|I_d(V_{ds}=+\\Delta) + I_d(V_{ds}=-\\Delta)| \\le \\tau_I$，其中 $\\tau_I = 1 \\times 10^{-12}\\ \\mathrm{A}$。\n\n- **电荷守恒**：一个基于电荷的模型必须守恒电荷，意味着所有终端电荷的总和必须为零，即 $\\sum_i Q_i = 0$。此属性是底层能量函数规范不变性的结果，即能量仅取决于终端之间的电压差。\n该检查通过在一个偏置点网格上计算 $\\sum_i Q_i$，并确保此和的最大绝对值低于容差 $\\tau_Q$ 来验证这一点。条件是 $\\max |\\sum_i Q_i| \\le \\tau_Q$，其中 $\\tau_Q = 1 \\times 10^{-20}\\ \\mathrm{C}$。\n\n**2. 模型定义**\n\n模型根据电压差 $x = V_g - V_s$、$y = V_d - V_s$ 和 $z = V_b - V_s$ 进行定义。\n\n- **案例1（基准一致模型）**：此模型由一个能量函数导出，通过构造确保了互易性和电荷守恒。\n  - 能量：$E(x,y,z) = \\tfrac{1}{2}C_{gs}x^2 + \\tfrac{1}{2}C_{ds}y^2 + \\tfrac{1}{2}C_{bs}z^2 + C_{gd}xy + C_{gb}xz + C_{db}yz + \\tfrac{1}{4}\\alpha x^2 y^2$。\n  - 电荷通过微分求得，例如 $Q_g = -\\partial E/\\partial x = -(C_{gs}x + C_{gd}y + C_{gb}z + \\tfrac{1}{2}\\alpha x y^2)$。由于能量函数仅取决于电压差，如果使用链式法则正确推导 $Q_s$，则电荷守恒 $\\sum Q_i = 0$ 得到保证：$Q_s = - \\partial E / \\partial V_s = \\partial E / \\partial x + \\partial E / \\partial y + \\partial E / \\partial z = -(Q_g+Q_d+Q_b)$。\n  - 电流：$I_d = k(x-V_{\\mathrm{th}})y$，它是 $y$ 的奇函数，因此满足Gummel对称性。\n  - 预期此案例将通过所有三个检查。\n\n- **案例2（非互易模型）**：电荷函数被直接定义，选择的系数旨在违反互易性。\n  - 电荷：$Q_g = -(a x + b y + \\dots)$，$Q_d = -(c y + d x + \\dots)$，其中交叉项的系数不相等（对于线性部分，$b \\neq d$）。具体来说，它被设计为 $-\\partial Q_g / \\partial y \\neq -\\partial Q_d / \\partial x$。\n  - $Q_s$ 定义为 $Q_s = -(Q_g+Q_d+Q_b)$，因此通过构造满足电荷守恒。\n  - 电流与案例1相同，因此Gummel对称性成立。\n  - 预期此案例将无法通过互易性检查，但会通过其他两项检查。\n\n- **案例3（电荷不守恒模型）**：基于案例1，但故意打破了电荷守恒。\n  - 电荷 $Q_g, Q_d, Q_b$ 与案例1相同。\n  - $Q_s$ 定义为 $Q_s = -(Q_g+Q_d+Q_b) + \\delta_Q$，其中 $\\delta_Q = 1 \\times 10^{-13}\\ \\mathrm{C}$。因此，总电荷始终为 $\\sum Q_i = \\delta_Q$。\n  - 预期此案例仅无法通过电荷守恒检查。\n\n- **案例4（Gummel非对称模型）**：基于案例1，但修改了电流模型以违反Gummel对称性。\n  - 所有电荷均与案例1相同，因此互易性和电荷守恒成立。\n  - 电流：$I_d = k(x-V_{\\mathrm{th}})y + \\eta y^2$。添加的 $\\eta y^2$ 项是 $y=V_{ds}$ 的偶函数，打破了奇对称性。\n  - 预期此案例仅无法通过Gummel对称性检查。\n\n**3. 实现策略**\n\n解决方案在Python中实现。为四个案例中的每一个都定义了一个类，封装了各自的模型参数，并提供了计算终端电荷（$Q_g, Q_d, Q_s, Q_b$）和漏极电流（$I_d$）作为终端电压函数的方法。\n\n三个独立的函数实现这些检查：`check_reciprocity`、`check_gummel` 和 `check_charge_conservation`。这些函数接收一个模型对象作为输入，并根据问题陈述中指定的方式执行数值计算，返回一个布尔结果。\n\n主函数 `solve` 负责协调整个过程。它为所有四个案例初始化模型对象。然后，它遍历每个模型，应用三个检查函数，并收集十二个产生的布尔值。最后，它将这些结果格式化为所需的单行字符串输出。这种模块化设计确保了在实现指定的验证过程时的清晰性、可重用性和正确性。例如，案例2的解析互易性检查依赖于比较 $-\\partial Q_g/\\partial y = b+2\\beta xy$ 与 $-\\partial Q_d/\\partial x = d+2\\gamma xy$。在中心偏置点，其中 $y=V_d-V_s=0.0-0.0=0$，这简化为比较 $b=2.0\\times 10^{-13}\\ \\mathrm{F}$ 和 $d=5.0\\times 10^{-14}\\ \\mathrm{F}$。它们的差值 $1.5\\times 10^{-13}\\ \\mathrm{F}$ 超过了容差 $\\tau_C=1\\times 10^{-14}\\ \\mathrm{F}$，正确预测了互易性的结果为 `False`。代码通过数值计算证实了这一预测。",
            "answer": "```python\nimport numpy as np\n\n# Tolerances and constants from the problem statement\nTAU_C = 1e-14  # F\nTAU_I = 1e-12  # A\nTAU_Q = 1e-20  # C\nDELTA_V_G = 0.1  # V\nDELTA_V_D = 0.1  # V\nDELTA_GST = 0.1  # V for Gummel Symmetry Test\n\n# Central bias point\nV_STAR = (0.9, 0.0, 0.0, -0.2)  # (Vg, Vd, Vs, Vb)\n\n# Bias grid for charge conservation check\nV_G_GRID = [0.8, 0.9, 1.0]\nV_D_GRID = [-0.1, 0.0, 0.1]\nV_S_GRID = 0.0\nV_B_GRID = -0.2\n\n\nclass ModelCase1:\n    \"\"\"Case 1: Energy-based, consistent model.\"\"\"\n    def __init__(self):\n        self.Cgs = 1.0e-12\n        self.Cds = 5.0e-13\n        self.Cbs = 2.0e-13\n        self.Cgd = 1.0e-13\n        self.Cgb = 5.0e-14\n        self.Cdb = 2.0e-14\n        self.alpha = 5.0e-13\n        self.k = 1.0e-5\n        self.Vth = 0.6\n\n    def _get_xyz(self, Vg, Vd, Vs, Vb):\n        x = Vg - Vs\n        y = Vd - Vs\n        z = Vb - Vs\n        return x, y, z\n\n    def Qg(self, Vg, Vd, Vs, Vb):\n        x, y, z = self._get_xyz(Vg, Vd, Vs, Vb)\n        return -(self.Cgs * x + self.Cgd * y + self.Cgb * z + 0.5 * self.alpha * x * y**2)\n\n    def Qd(self, Vg, Vd, Vs, Vb):\n        x, y, z = self._get_xyz(Vg, Vd, Vs, Vb)\n        return -(self.Cds * y + self.Cgd * x + self.Cdb * z + 0.5 * self.alpha * x**2 * y)\n\n    def Qb(self, Vg, Vd, Vs, Vb):\n        x, y, z = self._get_xyz(Vg, Vd, Vs, Vb)\n        return -(self.Cbs * z + self.Cgb * x + self.Cdb * y)\n\n    def Qs(self, Vg, Vd, Vs, Vb):\n        qg = self.Qg(Vg, Vd, Vs, Vb)\n        qd = self.Qd(Vg, Vd, Vs, Vb)\n        qb = self.Qb(Vg, Vd, Vs, Vb)\n        return -(qg + qd + qb)\n\n    def Id(self, Vg, Vd, Vs, Vb):\n        x, y, _ = self._get_xyz(Vg, Vd, Vs, Vb)\n        return self.k * (x - self.Vth) * y\n\n\nclass ModelCase2:\n    \"\"\"Case 2: Direct charge definitions with nonreciprocal cross-dependence.\"\"\"\n    def __init__(self):\n        self.a = 1.0e-12; self.b = 2.0e-13; self.e = 5.0e-14\n        self.c = 5.0e-13; self.d = 5.0e-14; self.f = 2.0e-14\n        self.g = 2.0e-13; self.h = 5.0e-14; self.i = 2.0e-14\n        self.beta = 3.0e-13; self.gamma = 5.0e-13\n        self.k = 1.0e-5; self.Vth = 0.6\n\n    def _get_xyz(self, Vg, Vd, Vs, Vb):\n        x = Vg - Vs; y = Vd - Vs; z = Vb - Vs\n        return x, y, z\n\n    def Qg(self, Vg, Vd, Vs, Vb):\n        x, y, z = self._get_xyz(Vg, Vd, Vs, Vb)\n        return -(self.a * x + self.b * y + self.e * z + self.beta * x * y**2)\n\n    def Qd(self, Vg, Vd, Vs, Vb):\n        x, y, z = self._get_xyz(Vg, Vd, Vs, Vb)\n        return -(self.c * y + self.d * x + self.f * z + self.gamma * x**2 * y)\n\n    def Qb(self, Vg, Vd, Vs, Vb):\n        x, y, z = self._get_xyz(Vg, Vd, Vs, Vb)\n        return -(self.g * z + self.h * x + self.i * y)\n\n    def Qs(self, Vg, Vd, Vs, Vb):\n        qg = self.Qg(Vg, Vd, Vs, Vb)\n        qd = self.Qd(Vg, Vd, Vs, Vb)\n        qb = self.Qb(Vg, Vd, Vs, Vb)\n        return -(qg + qd + qb)\n\n    def Id(self, Vg, Vd, Vs, Vb):\n        x, y, _ = self._get_xyz(Vg, Vd, Vs, Vb)\n        return self.k * (x - self.Vth) * y\n\n\nclass ModelCase3(ModelCase1):\n    \"\"\"Case 3: Energy-based charges with explicit charge conservation violation.\"\"\"\n    def __init__(self):\n        super().__init__()\n        self.delta_Q = 1.0e-13\n\n    def Qs(self, Vg, Vd, Vs, Vb):\n        # Override Qs to break charge conservation\n        qg = self.Qg(Vg, Vd, Vs, Vb)\n        qd = self.Qd(Vg, Vd, Vs, Vb)\n        qb = self.Qb(Vg, Vd, Vs, Vb)\n        return -(qg + qd + qb) + self.delta_Q\n\n\nclass ModelCase4(ModelCase1):\n    \"\"\"Case 4: Energy-based charges, Gummel symmetry violation in current.\"\"\"\n    def __init__(self):\n        super().__init__()\n        self.eta = 1.0e-6\n\n    def Id(self, Vg, Vd, Vs, Vb):\n        # Override Id to break Gummel symmetry\n        x, y, _ = self._get_xyz(Vg, Vd, Vs, Vb)\n        return self.k * (x - self.Vth) * y + self.eta * y**2\n\n\ndef check_reciprocity(model, V_star, dV_g, dV_d, tau_c):\n    \"\"\"Checks for C_gd = C_dg.\"\"\"\n    Vg_s, Vd_s, Vs_s, Vb_s = V_star\n    \n    # Calculate C_gd = -dQg/dVd\n    qg_plus = model.Qg(Vg_s, Vd_s + dV_d, Vs_s, Vb_s)\n    qg_minus = model.Qg(Vg_s, Vd_s - dV_d, Vs_s, Vb_s)\n    C_gd = -(qg_plus - qg_minus) / (2 * dV_d)\n    \n    # Calculate C_dg = -dQd/dVg\n    qd_plus = model.Qd(Vg_s + dV_g, Vd_s, Vs_s, Vb_s)\n    qd_minus = model.Qd(Vg_s - dV_g, Vd_s, Vs_s, Vb_s)\n    C_dg = -(qd_plus - qd_minus) / (2 * dV_g)\n    \n    return abs(C_gd - C_dg) = tau_c\n\ndef check_gummel(model, V_star, delta, tau_i):\n    \"\"\"Checks if Id is an odd function of Vds.\"\"\"\n    Vg_s, _, Vs_s, Vb_s = V_star\n    \n    # Since Vds = Vd - Vs, and we typically hold Vs=0, we vary Vd\n    # Problem text implies fixed Vg, Vb, Vs from central bias, where Vs=0\n    Id_plus = model.Id(Vg_s, Vs_s + delta, Vs_s, Vb_s)\n    Id_minus = model.Id(Vg_s, Vs_s - delta, Vs_s, Vb_s)\n    \n    return abs(Id_plus + Id_minus) = tau_i\n\ndef check_charge_conservation(model, Vg_grid, Vd_grid, Vs, Vb, tau_q):\n    \"\"\"Checks if sum of charges is zero over a bias grid.\"\"\"\n    max_abs_q_sum = 0\n    for vg in Vg_grid:\n        for vd in Vd_grid:\n            qg = model.Qg(vg, vd, Vs, Vb)\n            qd = model.Qd(vg, vd, Vs, Vb)\n            qs = model.Qs(vg, vd, Vs, Vb)\n            qb = model.Qb(vg, vd, Vs, Vb)\n            q_sum = qg + qd + qs + qb\n            if abs(q_sum)  max_abs_q_sum:\n                max_abs_q_sum = abs(q_sum)\n    \n    return max_abs_q_sum = tau_q\n\ndef solve():\n    \"\"\"Main function to run all checks on all cases.\"\"\"\n    \n    test_cases = [\n        ModelCase1(),\n        ModelCase2(),\n        ModelCase3(),\n        ModelCase4()\n    ]\n    \n    results = []\n    for model in test_cases:\n        # 1. Reciprocity check\n        rec_pass = check_reciprocity(model, V_STAR, DELTA_V_G, DELTA_V_D, TAU_C)\n        results.append(rec_pass)\n        \n        # 2. Gummel symmetry check\n        gum_pass = check_gummel(model, V_STAR, DELTA_GST, TAU_I)\n        results.append(gum_pass)\n        \n        # 3. Charge conservation check\n        chg_pass = check_charge_conservation(model, V_G_GRID, V_D_GRID, V_S_GRID, V_B_GRID, TAU_Q)\n        results.append(chg_pass)\n\n    # Format output as specified\n    # Python's str(True) -> 'True', str(False) -> 'False'\n    # The required output is lowercase bools, so we convert.\n    formatted_results = [str(r).lower() for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n# The problem asks for boolean output, e.g. 'True' or 'False'. But the example format `[rec_1,...]`\n# implies a specific string representation. The last sentence implies boolean values.\n# However, to be safe and match potential test cases that expect lowercase, let's adjust the output.\n# A final check of the problem description just says \"boolean value\". Python's `str()` on a bool is capitalized.\n# The user might not have specified lowercase. Let's stick to standard Python string conversion.\ndef solve_final():\n    \"\"\"Main function to run all checks on all cases.\"\"\"\n    \n    test_cases = [\n        ModelCase1(),\n        ModelCase2(),\n        ModelCase3(),\n        ModelCase4()\n    ]\n    \n    results = []\n    for model in test_cases:\n        rec_pass = check_reciprocity(model, V_STAR, DELTA_V_G, DELTA_V_D, TAU_C)\n        results.append(rec_pass)\n        gum_pass = check_gummel(model, V_STAR, DELTA_GST, TAU_I)\n        results.append(gum_pass)\n        chg_pass = check_charge_conservation(model, V_G_GRID, V_D_GRID, V_S_GRID, V_B_GRID, TAU_Q)\n        results.append(chg_pass)\n\n    # The problem description's example format `[rec_1,...]` is ambiguous about case.\n    # Sticking to standard `str(bool)` which is `True`/`False`\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve_final()\n```"
        }
    ]
}