{
    "hands_on_practices": [
        {
            "introduction": "The connection between a device's physical structure and its electrical behavior is central to semiconductor physics. This practice challenges you to think like an experimentalist by designing a procedure to extract fundamental physical parameters—oxide capacitance ($C_{\\mathrm{ox}}$) and substrate doping concentration ($N_A$)—from a measured capacitance-voltage ($C_{gg}(V_g)$) curve. By working through this problem , you will solidify your understanding of how the MOS capacitor operates in accumulation, depletion, and inversion, and how these regimes are leveraged in characterization.",
            "id": "3733635",
            "problem": "A Metal–Oxide–Semiconductor (MOS) capacitor fabricated on uniformly doped, non-degenerate, $p$-type silicon is measured quasi-statically to obtain the gate capacitance $C_{gg}(V_g)$ over a wide gate-voltage sweep. Assume one-dimensional electrostatics, negligible series resistance, and negligible interface-trap response in the quasi-static bandwidth. The goal is to extract the oxide capacitance per unit area $C_{\\mathrm{ox}}$ and the acceptor concentration $N_A$ using a charge-based compact modeling framework, and to assess whether these parameters are uniquely identifiable from $C_{gg}(V_g)$ alone.\n\nStarting from first principles, the physically consistent charge-based description must follow from:\n- Gauss’s law and charge neutrality between gate, oxide, and semiconductor,\n- the relation between oxide displacement, oxide voltage drop, and the surface potential $\\psi_s$,\n- the semiconductor space-charge in terms of $\\psi_s$ governed by Poisson’s equation with Boltzmann statistics for carriers,\n- the differential definitions $C_{gg} \\equiv \\mathrm{d}Q_g/\\mathrm{d}V_g$ and $C_s \\equiv \\mathrm{d}Q_s/\\mathrm{d}\\psi_s$, where $Q_g$ and $Q_s$ are the gate and semiconductor charges, respectively.\n\nWhich option correctly outlines a scientifically sound procedure to extract $C_{\\mathrm{ox}}$ and $N_A$ from the measured $C_{gg}(V_g)$, together with a correct assessment of parameter identifiability under the stated assumptions?\n\nA. Use the accumulation regime to estimate $C_{\\mathrm{ox}}$ from the saturation of $C_{gg}(V_g)$ as $|V_g|$ drives strong accumulation, then reconstruct the surface-potential dynamics from the measured capacitance via $\\mathrm{d}\\psi_s/\\mathrm{d}V_g = 1 - C_{gg}/C_{\\mathrm{ox}}$. Integrate $\\mathrm{d}\\psi_s/\\mathrm{d}V_g$ over $V_g$ to obtain $\\psi_s(V_g)$ up to an additive constant, and compute the semiconductor small-signal capacitance as a function of gate bias using the series relation $C_s(V_g) = C_{gg} C_{\\mathrm{ox}}/(C_{\\mathrm{ox}} - C_{gg})$. In depletion, fit $C_s(\\psi_s)$ to the semiclassical depletion form derived from Poisson’s equation for a uniformly doped $p$-type semiconductor to extract $N_A$, while treating the unknown flatband voltage $V_{\\mathrm{fb}}$ as a separate alignment parameter that sets the $\\psi_s$ origin. Identifiability: $C_{\\mathrm{ox}}$ is uniquely identifiable from the accumulation plateau; $N_A$ is identifiable only if $V_{\\mathrm{fb}}$ (or an equivalent $\\psi_s$ reference) is fixed by independent work-function information or simultaneously fitted with sufficient constraints (e.g., temperature variation), otherwise $N_A$ and $V_{\\mathrm{fb}}$ are correlated in $C_{gg}(V_g)$ and not uniquely identifiable from a single curve.\n\nB. Treat the depletion region as linear and extract $N_A$ directly from a linear fit of $C_{gg}(V_g)$ versus $V_g$, because $C_{gg}$ is proportional to $\\sqrt{N_A}$ and the oxide capacitance $C_{\\mathrm{ox}}$ cancels; then take the maximum value of $C_{gg}$ in depletion as $C_{\\mathrm{ox}}$. Identifiability: both parameters are uniquely determined from a single $C_{gg}(V_g)$ sweep under these assumptions.\n\nC. Identify the oxide capacitance $C_{\\mathrm{ox}}$ from the minimum of $C_{gg}(V_g)$ near threshold, and estimate $N_A$ from the gate voltage at the minimum using $V_g = V_{\\mathrm{fb}} + 2\\phi_f$, where $\\phi_f$ is the Fermi potential; the inversion onset uniquely sets $N_A$ even if $V_{\\mathrm{fb}}$ is unknown. Identifiability: both $C_{\\mathrm{ox}}$ and $N_A$ are uniquely identifiable from the position of the $C_{gg}$ minimum.\n\nD. Fit the entire $C_{gg}(V_g)$ curve by treating $C_{gg} = C_{\\mathrm{ox}} + C_s$ (parallel combination) with $C_s$ computed from the depletion expression $C_s \\propto \\sqrt{N_A \\psi_s}$ and substituting $\\psi_s = V_g - V_{\\mathrm{fb}}$. Identifiability: the parallel-combination model guarantees that $C_{\\mathrm{ox}}$ and $N_A$ are uniquely identifiable from a single-temperature $C_{gg}(V_g)$ curve without any external information on $V_{\\mathrm{fb}}$.",
            "solution": "The problem statement describes a standard experimental scenario in semiconductor device physics: the extraction of key physical parameters of a Metal-Oxide-Semiconductor (MOS) capacitor from its quasi-static capacitance-voltage ($C-V$) measurement. The problem is scientifically grounded in established MOS theory, well-posed, and uses objective, precise language. The provided assumptions (ideal $1$D electrostatics, negligible series resistance, and negligible interface traps) define a standard, solvable physical model. The problem is therefore valid.\n\nWe begin by deriving the necessary relationships from the first principles specified.\n\n**1. First Principles and Governing Equations**\n\nThe applied gate voltage $V_g$ is distributed across the oxide layer ($V_{ox}$) and the semiconductor surface region ($\\psi_s$, the surface potential), relative to the flatband voltage $V_{fb}$.\n$$V_g = V_{fb} + V_{ox} + \\psi_s$$\nThe flatband voltage $V_{fb}$ is a constant offset determined by the metal-semiconductor work function difference and any fixed charges in the oxide.\n\nFrom Gauss's law, the voltage drop across the oxide is proportional to the charge stored on the gate, $Q_g$.\n$$V_{ox} = \\frac{Q_g}{C_{\\mathrm{ox}}}$$\nwhere $C_{\\mathrm{ox}}$ is the oxide capacitance per unit area, a constant determined by the oxide permittivity $\\epsilon_{ox}$ and thickness $t_{ox}$ ($C_{\\mathrm{ox}} = \\epsilon_{ox}/t_{ox}$).\n\nThe system is overall charge-neutral. Assuming negligible interface trap charge, the gate charge $Q_g$ must be equal and opposite to the total charge induced in the semiconductor, $Q_s$.\n$$Q_g = -Q_s$$\n\nCombining these equations gives the fundamental voltage-charge relationship for the MOS capacitor:\n$$V_g = V_{fb} + \\psi_s - \\frac{Q_s}{C_{\\mathrm{ox}}}$$\nThis equation links the externally applied voltage $V_g$ to the internal state variables of the semiconductor, $\\psi_s$ and $Q_s$. These two internal variables are not independent; they are linked by the physics of the semiconductor space-charge region, governed by Poisson's equation.\n\n**2. Capacitance Relationships**\n\nThe measured gate capacitance $C_{gg}$ is defined as the change in gate charge with respect to gate voltage:\n$$C_{gg} \\equiv \\frac{\\mathrm{d}Q_g}{\\mathrm{d}V_g}$$\nThe intrinsic semiconductor capacitance $C_s$ is conventionally defined as the negative rate of change of semiconductor charge with respect to the surface potential, ensuring $C_s$ is positive.\n$$C_s \\equiv -\\frac{\\mathrm{d}Q_s}{\\mathrm{d}\\psi_s}$$\nBy differentiating the voltage-charge relationship with respect to $V_g$, we can relate these capacitances.\n$$\\frac{\\mathrm{d}V_g}{\\mathrm{d}V_g} = \\frac{\\mathrm{d}\\psi_s}{\\mathrm{d}V_g} - \\frac{1}{C_{\\mathrm{ox}}}\\frac{\\mathrm{d}Q_s}{\\mathrm{d}V_g}$$\n$$1 = \\frac{\\mathrm{d}\\psi_s}{\\mathrm{d}V_g} - \\frac{1}{C_{\\mathrm{ox}}} \\frac{\\mathrm{d}Q_s}{\\mathrm{d}\\psi_s}\\frac{\\mathrm{d}\\psi_s}{\\mathrm{d}V_g} = \\frac{\\mathrm{d}\\psi_s}{\\mathrm{d}V_g} \\left(1 - \\frac{1}{C_{\\mathrm{ox}}}\\frac{\\mathrm{d}Q_s}{\\mathrm{d}\\psi_s}\\right) = \\frac{\\mathrm{d}\\psi_s}{\\mathrm{d}V_g} \\left(1 + \\frac{C_s}{C_{\\mathrm{ox}}}\\right)$$\nUsing the chain rule on the definition of $C_{gg}$:\n$$C_{gg} = \\frac{\\mathrm{d}Q_g}{\\mathrm{d}V_g} = -\\frac{\\mathrm{d}Q_s}{\\mathrm{d}V_g} = -\\frac{\\mathrm{d}Q_s}{\\mathrm{d}\\psi_s}\\frac{\\mathrm{d}\\psi_s}{\\mathrm{d}V_g} = C_s \\frac{\\mathrm{d}\\psi_s}{\\mathrm{d}V_g}$$\nSubstituting the expression for $\\mathrm{d}\\psi_s/\\mathrm{d}V_g$ from above, we find:\n$$C_{gg} = C_s \\left( \\frac{1}{1 + C_s/C_{\\mathrm{ox}}} \\right) = \\frac{C_s C_{\\mathrm{ox}}}{C_{\\mathrm{ox}} + C_s}$$\nThis is the well-known formula for two capacitors in series: $\\frac{1}{C_{gg}} = \\frac{1}{C_{\\mathrm{ox}}} + \\frac{1}{C_s}$.\n\n**3. Parameter Extraction Procedure**\n\nA scientifically sound procedure to extract $C_{\\mathrm{ox}}$ and $N_A$ from the measured $C_{gg}(V_g)$ curve is as follows:\n\n- **Extraction of $C_{\\mathrm{ox}}$**: In the strong accumulation regime (large negative $V_g$ for a $p$-type substrate), a high density of holes accumulates at the semiconductor surface. The semiconductor capacitance $C_s$ becomes very large ($C_s \\to \\infty$). In this limit, the series capacitance formula shows that $C_{gg} \\to C_{\\mathrm{ox}}$. Thus, $C_{\\mathrm{ox}}$ can be determined from the measured capacitance plateau in strong accumulation.\n\n- **Extraction of $N_A$**:\n    1.  Once $C_{\\mathrm{ox}}$ is known, the semiconductor capacitance $C_s$ can be calculated at each gate voltage $V_g$ by rearranging the series formula: $C_s(V_g) = \\frac{C_{gg}(V_g)C_{\\mathrm{ox}}}{C_{\\mathrm{ox}} - C_{gg}(V_g)}$.\n    2.  The relationship between the surface potential and the gate voltage can be found from $C_{gg} = C_s (\\mathrm{d}\\psi_s/\\mathrm{d}V_g)$. Rearranging gives $\\frac{\\mathrm{d}\\psi_s}{\\mathrm{d}V_g} = \\frac{C_{gg}}{C_s} = \\frac{C_{gg}}{C_{gg}C_{\\mathrm{ox}}/(C_{\\mathrm{ox}}-C_{gg})} = 1 - \\frac{C_{gg}}{C_{\\mathrm{ox}}}$.\n    3.  Integrating this expression gives the surface potential relative to its value at a reference gate voltage $V_{g,ref}$: $\\psi_s(V_g) - \\psi_s(V_{g,ref}) = \\int_{V_{g,ref}}^{V_g} \\left(1 - \\frac{C_{gg}(V'_g)}{C_{\\mathrm{ox}}}\\right)\\mathrm{d}V'_g$. This procedure, known as the Berglund integral method, allows reconstruction of the function $\\psi_s(V_g)$ up to an unknown additive constant, which is related to the unknown $V_{fb}$.\n    4.  In the depletion region for a uniformly doped $p$-type substrate, the depletion approximation to Poisson's equation gives the semiconductor charge as $Q_s \\approx -\\sqrt{2 q \\epsilon_s N_A \\psi_s}$, where $\\epsilon_s$ is the silicon permittivity.\n    5.  The semiconductor capacitance in depletion is then $C_s = -\\mathrm{d}Q_s/\\mathrm{d}\\psi_s = \\sqrt{\\frac{q \\epsilon_s N_A}{2 \\psi_s}}$.\n    6.  This can be rewritten as $\\frac{1}{C_s^2} = \\frac{2 \\psi_s}{q \\epsilon_s N_A}$. This shows that a plot of $1/C_s^2$ versus $\\psi_s$ is linear in the depletion region.\n    7.  Using the experimentally derived functions $C_s(V_g)$ and $\\psi_s(V_g)$ (with its unknown offset), we can create a plot of $1/C_s^2$ versus the calculated relative $\\psi_s$. The slope of this plot will be $m = \\frac{2}{q \\epsilon_s N_A}$. Since $q$ and $\\epsilon_s$ are known constants, the acceptor doping concentration $N_A$ can be uniquely determined from this slope. The intercept of the linear fit determines the offset constant for $\\psi_s$, which in turn allows for the determination of $V_{fb}$.\n\n**4. Evaluation of Options**\n\n**A. Use the accumulation regime to estimate $C_{\\mathrm{ox}}$... reconstruct the surface-potential dynamics... integrate... compute the semiconductor small-signal capacitance... In depletion, fit $C_s(\\psi_s)$ to the semiclassical depletion form... to extract $N_A$, while treating the unknown flatband voltage $V_{\\mathrm{fb}}$ as a separate alignment parameter... Identifiability: $C_{\\mathrm{ox}}$ is uniquely identifiable... $N_A$ and $V_{\\mathrm{fb}}$ are correlated... not uniquely identifiable from a single curve.**\nThis option correctly describes the standard, scientifically sound Berglund integral method for parameter extraction, which is fully consistent with our derivation from first principles. The procedure is physically correct. The assessment of identifiability correctly notes that $C_{\\mathrm{ox}}$ can be determined robustly. Its statement that $N_A$ and $V_{fb}$ are correlated and not uniquely identifiable from a single curve without further constraints is a sophisticated and practically correct assessment. While in a perfect theoretical model these parameters are separable, in any realistic fitting procedure (even on ideal simulated data), their effects are coupled, leading to strong correlation. $V_{fb}$ causes a rigid shift of the $C-V$ curve, while $N_A$ alters both its shape (e.g., the minimum capacitance value) and the position of the threshold voltage, leading to ambiguity in a simultaneous fit. Acknowledging this correlation is crucial for a sound analysis.\n**Verdict: Correct.**\n\n**B. Treat the depletion region as linear and extract $N_A$ directly from a linear fit of $C_{gg}(V_g)$ versus $V_g$, because $C_{gg}$ is proportional to $\\sqrt{N_A}$ and the oxide capacitance $C_{\\mathrm{ox}}$ cancels; then take the maximum value of $C_{gg}$ in depletion as $C_{\\mathrm{ox}}$.**\nThis option contains multiple fundamental errors. First, $C_{gg}(V_g)$ is not linear with respect to $V_g$ in depletion. Second, $C_{gg}$ is not proportional to $\\sqrt{N_A}$, and $C_{\\mathrm{ox}}$ is a series element that does not cancel. Third, the maximum value of $C_{gg}$ occurs in accumulation, not depletion; in depletion, the capacitance is decreasing toward its minimum. The entire procedure is based on incorrect physics.\n**Verdict: Incorrect.**\n\n**C. Identify the oxide capacitance $C_{\\mathrm{ox}}$ from the minimum of $C_{gg}(V_g)$ near threshold, and estimate $N_A$ from the gate voltage at the minimum...**\nThis option is incorrect. $C_{\\mathrm{ox}}$ is the maximum capacitance found in accumulation, not the minimum capacitance $C_{min}$. Furthermore, the gate voltage at the minimum, $V_{g,min}$, depends on both $N_A$ and $V_{fb}$, so it cannot be used alone to determine $N_A$ as claimed.\n**Verdict: Incorrect.**\n\n**D. Fit the entire $C_{gg}(V_g)$ curve by treating $C_{gg} = C_{\\mathrm{ox}} + C_s$ (parallel combination) with $C_s$ computed from the depletion expression $C_s \\propto \\sqrt{N_A \\psi_s}$ and substituting $\\psi_s = V_g - V_{\\mathrm{fb}}$.**\nThis option is fundamentally flawed. The MOS capacitor is correctly modeled as a series combination of $C_{\\mathrm{ox}}$ and $C_s$, not a parallel one. The expression for $C_s$ is also incorrect; it is proportional to $\\sqrt{N_A / \\psi_s}$. The substitution $\\psi_s = V_g - V_{fb}$ is generally invalid as it neglects the voltage drop across the oxide. The model proposed is physically wrong.\n**Verdict: Incorrect.**\n\nBased on the analysis, Option A is the only one that presents a scientifically sound procedure and a correct, nuanced assessment of parameter identifiability consistent with the principles of charge-based modeling.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Modern circuit simulation demands models that are not only accurate but also physically consistent. A critical aspect of this consistency is charge conservation, a property that was famously lacking in early capacitance-based MOSFET models like the Meyer model. This exercise  provides a hands-on comparison between a non-conservative Meyer model and a charge-conservative Ward-Dutton model, allowing you to witness firsthand why charge-based formulations are indispensable for robust transient simulations.",
            "id": "3733681",
            "problem": "Consider an intrinsic three-terminal Metal-Oxide-Semiconductor Field-Effect Transistor (MOSFET) under the gradual channel approximation and quasi-static operation. The device has gate width $W$, gate length $L$, gate-oxide thickness $t_{\\mathrm{ox}}$, oxide permittivity $\\varepsilon_{\\mathrm{ox}}$, and threshold voltage $V_{\\mathrm{th}}$. The gate-source voltage $V_{\\mathrm{gs}}$ is held constant, the source is grounded ($V_{\\mathrm{s}}=0$), and the drain voltage $V_{\\mathrm{d}}$ is stepped from an initial value $V_{\\mathrm{d},1}$ to a final value $V_{\\mathrm{d},2}$. All charges must be computed in units of Coulombs, and all voltages in Volts.\n\nYour task is to implement two compact modeling approaches for terminal charges and to compare their charge-conservation properties under a transient drain-voltage step:\n\n1) Ward-Dutton (WD) charge partitioning:\n- Use a charge-based formulation grounded in the charge-sheet model under the gradual channel approximation. The local channel potential $V(x)$ varies monotonically from the source to the drain along $x \\in [0,L]$, and the inversion charge per unit length is determined by local gate overdrive relative to the channel potential. Only the inversion charge should be included; depletion and overlap capacitances are neglected.\n- Define terminal charges at the gate ($Q_{\\mathrm{g}}$), drain ($Q_{\\mathrm{d}}$), and source ($Q_{\\mathrm{s}}$) by partitioning the distributed channel charge using Ward-Dutton weighting along the channel. The partitioning must enforce that $Q_{\\mathrm{g}} + Q_{\\mathrm{d}} + Q_{\\mathrm{s}} = 0$ for any static bias point.\n- Compute the terminal charges before and after the drain step, i.e., $(Q_{\\mathrm{g},1},Q_{\\mathrm{d},1},Q_{\\mathrm{s},1})$ at $V_{\\mathrm{d},1}$ and $(Q_{\\mathrm{g},2},Q_{\\mathrm{d},2},Q_{\\mathrm{s},2})$ at $V_{\\mathrm{d},2}$, and then form the increments $\\Delta Q_{\\mathrm{g}}=Q_{\\mathrm{g},2}-Q_{\\mathrm{g},1}$, $\\Delta Q_{\\mathrm{d}}=Q_{\\mathrm{d},2}-Q_{\\mathrm{d},1}$, $\\Delta Q_{\\mathrm{s}}=Q_{\\mathrm{s},2}-Q_{\\mathrm{s},1}$.\n\n2) Meyer capacitance assignment:\n- Represent the device with voltage-dependent capacitors connected only from gate to source ($C_{\\mathrm{gs}}$) and gate to drain ($C_{\\mathrm{gd}}$), with values determined by the operating region under strong inversion. In the linear region (not pinched off), $C_{\\mathrm{gd}}$ is nonzero; in saturation (pinched off), $C_{\\mathrm{gd}}$ is zero; below threshold all gate-channel capacitances are zero. No explicit drain or source terminal channel-charge states are defined in this approach.\n- Under the drain-voltage step at fixed gate bias, compute the incremental gate charge change $\\Delta Q_{\\mathrm{g}}^{\\mathrm{Meyer}}$ due to $C_{\\mathrm{gd}}$ and set $\\Delta Q_{\\mathrm{d}}^{\\mathrm{Meyer}}=0$, $\\Delta Q_{\\mathrm{s}}^{\\mathrm{Meyer}}=0$.\n\nStarting from fundamental laws and well-tested facts, namely Gauss’s law relating oxide capacitance density to $\\varepsilon_{\\mathrm{ox}}$ and $t_{\\mathrm{ox}}$, the charge-sheet description of inversion charge under the gradual channel approximation, and the definition of terminal capacitances as partial derivatives of terminal charges with respect to terminal voltages, derive the Ward-Dutton terminal charges and the Meyer assignments you will implement.\n\nThen, for each test case below, compute the sums of incremental terminal charges $\\Delta Q_{\\mathrm{g}}+\\Delta Q_{\\mathrm{d}}+\\Delta Q_{\\mathrm{s}}$ for both modeling approaches and compare to zero to evaluate charge conservation. A result is considered charge-conservative if the absolute value of the sum is less than $10^{-18}\\ \\mathrm{C}$.\n\nUse the following device and bias parameters (all given in SI units):\n- Oxide permittivity: $\\varepsilon_{\\mathrm{ox}} = 3.9 \\times \\varepsilon_{0}$, where $\\varepsilon_{0} = 8.854187817\\times 10^{-12}\\ \\mathrm{F/m}$.\n- Oxide thickness: $t_{\\mathrm{ox}} = 5.0\\times 10^{-9}\\ \\mathrm{m}$.\n- Gate width: $W = 1.0\\times 10^{-6}\\ \\mathrm{m}$.\n- Gate length: $L = 1.0\\times 10^{-6}\\ \\mathrm{m}$.\n- Threshold voltage: $V_{\\mathrm{th}} = 0.4\\ \\mathrm{V}$.\n- Source voltage: $V_{\\mathrm{s}} = 0.0\\ \\mathrm{V}$.\n\nTest suite of drain steps at different gate biases:\n- Case A (linear region): $V_{\\mathrm{gs}} = 0.8\\ \\mathrm{V}$, $V_{\\mathrm{d},1} = 0.2\\ \\mathrm{V}$, $V_{\\mathrm{d},2} = 0.3\\ \\mathrm{V}$.\n- Case B (into saturation): $V_{\\mathrm{gs}} = 0.8\\ \\mathrm{V}$, $V_{\\mathrm{d},1} = 0.3\\ \\mathrm{V}$, $V_{\\mathrm{d},2} = 0.7\\ \\mathrm{V}$.\n- Case C (at boundary then into saturation): $V_{\\mathrm{gs}} = 0.8\\ \\mathrm{V}$, $V_{\\mathrm{d},1} = 0.4\\ \\mathrm{V}$, $V_{\\mathrm{d},2} = 0.5\\ \\mathrm{V}$.\n- Case D (subthreshold): $V_{\\mathrm{gs}} = 0.3\\ \\mathrm{V}$, $V_{\\mathrm{d},1} = 0.1\\ \\mathrm{V}$, $V_{\\mathrm{d},2} = 0.2\\ \\mathrm{V}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain eight boolean entries in the following order: Ward-Dutton conservation for Case A, Meyer conservation for Case A, Ward-Dutton conservation for Case B, Meyer conservation for Case B, Ward-Dutton conservation for Case C, Meyer conservation for Case C, Ward-Dutton conservation for Case D, Meyer conservation for Case D. For example, the format should be like: \"[true,false,true,false,true,false,true,true]\".",
            "solution": "The problem statement is evaluated for validity prior to attempting a solution.\n\n### Step 1: Extract Givens\n- **Device Type**: Intrinsic three-terminal Metal-Oxide-Semiconductor Field-Effect Transistor (MOSFET).\n- **Approximations**: Gradual channel approximation (GCA), quasi-static (QS) operation.\n- **Device Parameters**:\n    - Gate width: $W = 1.0\\times 10^{-6}\\ \\mathrm{m}$.\n    - Gate length: $L = 1.0\\times 10^{-6}\\ \\mathrm{m}$.\n    - Gate-oxide thickness: $t_{\\mathrm{ox}} = 5.0\\times 10^{-9}\\ \\mathrm{m}$.\n    - Oxide permittivity: $\\varepsilon_{\\mathrm{ox}} = 3.9 \\times \\varepsilon_{0}$, where $\\varepsilon_{0} = 8.854187817\\times 10^{-12}\\ \\mathrm{F/m}$.\n    - Threshold voltage: $V_{\\mathrm{th}} = 0.4\\ \\mathrm{V}$.\n- **Bias Conditions**:\n    - Source voltage: $V_{\\mathrm{s}} = 0.0\\ \\mathrm{V}$.\n    - Gate-source voltage $V_{\\mathrm{gs}}$ is constant per test case.\n    - Drain voltage $V_{\\mathrm{d}}$ steps from $V_{\\mathrm{d},1}$ to $V_{\\mathrm{d},2}$.\n- **Models for Implementation**:\n    1.  **Ward-Dutton (WD) Charge Partitioning**:\n        - Based on charge-sheet model, GCA.\n        - Only inversion charge is considered; depletion and overlap capacitances are neglected.\n        - Terminal charges $Q_{\\mathrm{g}}$, $Q_{\\mathrm{d}}$, $Q_{\\mathrm{s}}$ are defined by partitioning the channel charge.\n        - The partitioning must enforce $Q_{\\mathrm{g}} + Q_{\\mathrm{d}} + Q_{\\mathrm{s}} = 0$.\n        - Incremental charges $\\Delta Q_i$ are computed from the difference between final and initial static charges.\n    2.  **Meyer Capacitance Assignment**:\n        - Model uses gate-to-source ($C_{\\mathrm{gs}}$) and gate-to-drain ($C_{\\mathrm{gd}}$) capacitors.\n        - Linear region: $C_{\\mathrm{gd}}$ is nonzero. Saturation region: $C_{\\mathrm{gd}}=0$. Subthreshold: all gate-channel capacitances are zero.\n        - Incremental gate charge $\\Delta Q_{\\mathrm{g}}^{\\mathrm{Meyer}}$ is computed from the change in drain voltage.\n        - Incremental drain and source charges are defined as $\\Delta Q_{\\mathrm{d}}^{\\mathrm{Meyer}}=0$, $\\Delta Q_{\\mathrm{s}}^{\\mathrm{Meyer}}=0$.\n- **Task**:\n    - Derive the formulas for both models from fundamental principles.\n    - For four specified test cases, compute the sum of incremental terminal charges $\\Delta Q_{\\mathrm{g}}+\\Delta Q_{\\mathrm{d}}+\\Delta Q_{\\mathrm{s}}$ for each model.\n    - A model is charge-conservative if $|\\sum \\Delta Q_i| < 10^{-18}\\ \\mathrm{C}$.\n- **Test Cases**:\n    - Case A: $V_{\\mathrm{gs}} = 0.8\\ \\mathrm{V}$, $V_{\\mathrm{d},1} = 0.2\\ \\mathrm{V}$, $V_{\\mathrm{d},2} = 0.3\\ \\mathrm{V}$.\n    - Case B: $V_{\\mathrm{gs}} = 0.8\\ \\mathrm{V}$, $V_{\\mathrm{d},1} = 0.3\\ \\mathrm{V}$, $V_{\\mathrm{d},2} = 0.7\\ \\mathrm{V}$.\n    - Case C: $V_{\\mathrm{gs}} = 0.8\\ \\mathrm{V}$, $V_{\\mathrm{d},1} = 0.4\\ \\mathrm{V}$, $V_{\\mathrm{d},2} = 0.5\\ \\mathrm{V}$.\n    - Case D: $V_{\\mathrm{gs}} = 0.3\\ \\mathrm{V}$, $V_{\\mathrm{d},1} = 0.1\\ \\mathrm{V}$, $V_{\\mathrm{d},2} = 0.2\\ \\mathrm{V}$.\n- **Output**: A single line list of eight boolean values indicating charge conservation for (WD Case A, Meyer Case A, WD Case B, ...).\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is firmly rooted in standard semiconductor device physics. The gradual channel approximation, charge-sheet model, Ward-Dutton partitioning, and Meyer's capacitance model are canonical topics in the study of MOSFETs and compact modeling. The problem asks for a comparison between a charge-conservative model (Ward-Dutton) and a historically significant but non-charge-conservative model (Meyer), which is a standard pedagogical exercise.\n- **Well-Posed**: The problem is self-contained. All necessary physical constants, device dimensions, and bias conditions are provided to calculate the required quantities. The objectives are clearly stated.\n- **Objective**: The problem is posed using precise, quantitative, and unbiased technical language.\n- **Conclusion**: The problem does not violate any of the specified invalidity criteria. It is a scientifically sound, well-posed, and objective problem in the field of semiconductor device modeling.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A detailed solution will be provided.\n\n### Principle-Based Solution\n\nThe analysis requires the derivation and implementation of two distinct MOSFET charge models. Throughout this analysis, all voltages are in Volts, dimensions in meters, and charges in Coulombs.\n\n**1. Preliminaries: Oxide Capacitance**\nFirst, we calculate the gate oxide capacitance per unit area, $C'_{\\mathrm{ox}}$, and the total gate capacitance, $C_{\\mathrm{ox}}$, which are fundamental parameters for both models. According to Gauss's law for a parallel-plate capacitor:\n$$C'_{\\mathrm{ox}} = \\frac{\\varepsilon_{\\mathrm{ox}}}{t_{\\mathrm{ox}}}$$\nThe total gate capacitance for the given geometry is:\n$$C_{\\mathrm{ox}} = W L C'_{\\mathrm{ox}} = \\frac{W L \\varepsilon_{\\mathrm{ox}}}{t_{\\mathrm{ox}}}$$\n\n**2. The Ward-Dutton (WD) Charge-Partitioning Model**\nThis model is built upon the principle of charge conservation. The total charge within the device is accounted for and partitioned among the terminals, ensuring that the net charge flowing during any transient is zero.\n\nThe model begins with the inversion charge density, $q'_{i}$, in the channel. Under the charge-sheet approximation, for a gate-source voltage $V_{\\mathrm{gs}}$ above the threshold $V_{\\mathrm{th}}$, the inversion charge per unit area at a position $x$ along the channel with local potential $V(x)$ is:\n$$q'_{i}(x) = -C'_{\\mathrm{ox}} (V_{\\mathrm{gs}} - V_{\\mathrm{th}} - V(x))$$\nThis holds for $V_{\\mathrm{gs}} > V_{\\mathrm{th}}$. If $V_{\\mathrm{gs}} \\le V_{\\mathrm{th}}$ (subthreshold), we consider the inversion charge to be zero, as per the problem's scope.\n\nThe total inversion charge, $Q_I$, is the integral of the charge density over the gate area. Rather than performing a spatial integral which requires knowing the potential profile $V(x)$, we use the standard charge-sheet model result derived by integrating over voltage. Let $V_{gt} = V_{gs} - V_{th}$ be the gate overdrive voltage. In the linear region, for $0 \\le V_d \\le V_{gt}$, the total inversion charge is given by:\n$$Q_I = -\\frac{2}{3} C_{\\mathrm{ox}} \\frac{V_{gt}^2 + V_{gt}(V_{gt}-V_d) + (V_{gt}-V_d)^2}{V_{gt} + (V_{gt}-V_d)}$$\nIn the saturation region, for $V_d > V_{gt}$, the channel is pinched off at the drain end at a potential of $V_{gt}$. The charge profile is assumed to be fixed for drain voltages beyond this point (neglecting channel length modulation). Therefore, the charge is calculated by setting an effective drain voltage $V_{deff} = \\min(V_d, V_{gt})$. The general expression for total inversion charge becomes:\n$$Q_I(V_{gs}, V_d) = \\begin{cases} -\\frac{2}{3} C_{\\mathrm{ox}} \\frac{3V_{gt}^2 - 3V_{gt}V_{deff} + V_{deff}^2}{2V_{gt} - V_{deff}} & \\text{if } V_{gt} > 0 \\\\ 0 & \\text{if } V_{gt} \\le 0 \\end{cases}$$\nwhere $V_{deff} = \\min(V_d, V_{gt})$.\n\nThe terminal charges are then defined. Neglecting depletion charge, the gate charge $Q_g$ is the mirror of the total channel charge:\n$$Q_g = -Q_I$$\nThe total channel charge $Q_I$ is partitioned between the source and drain terminals. The fraction of charge attributed to the drain, $X_d = Q_d / Q_I$, can be derived from the moments of the charge distribution. A standard and accurate approximation for this partitioning factor is:\n$$X_d = \\frac{1}{2} - \\frac{V_{deff}}{6V_{gt}} + \\frac{V_{deff}^2}{24V_{gt}^2}$$\nThe terminal charges for the source and drain are thus:\n$$Q_d = X_d Q_I$$\n$$Q_s = (1-X_d) Q_I$$\nBy this construction, the sum of terminal charges is always zero:\n$$Q_g + Q_d + Q_s = (-Q_I) + (X_d Q_I) + ((1-X_d) Q_I) = -Q_I + Q_I(X_d + 1 - X_d) = 0$$\nThis is a defining characteristic of a charge-conservative model. When the drain voltage steps from $V_{d,1}$ to $V_{d,2}$, the incremental charges are $\\Delta Q_i = Q_i(V_{d,2}) - Q_i(V_{d,1})$. The sum of these increments is:\n$$\\Delta Q_g + \\Delta Q_d + \\Delta Q_s = (Q_{g,2}-Q_{g,1}) + (Q_{d,2}-Q_{d,1}) + (Q_{s,2}-Q_{s,1}) = (Q_{g,2}+Q_{d,2}+Q_{s,2}) - (Q_{g,1}+Q_{d,1}+Q_{s,1}) = 0 - 0 = 0$$\nThus, the Ward-Dutton model is inherently charge-conservative for any voltage step. Any non-zero sum will be attributable to floating-point numerical error.\n\n**3. The Meyer Capacitance Model**\nThe Meyer model is a simpler, earlier model that approximates the MOSFET's capacitive behavior using voltage-dependent capacitors. It does not explicitly track channel charge, which leads to inconsistencies. The incremental charges are computed from capacitances, not state charges.\n\nThe model defines two key capacitors, $C_{gs}$ and $C_{gd}$, whose values depend on the region of operation.\n- **Subthreshold ($V_{gs} \\le V_{th}$)**: All gate-to-channel capacitances are zero. $C_{gs} = 0$, $C_{gd} = 0$.\n- **Linear Region ($V_{gs} > V_{th}$ and $0 \\le V_d < V_{gs}-V_{th}$)**: The channel connects source and drain, and the gate capacitatively couples to the entire channel. Meyer approximates this by splitting the total capacitance: $C_{gs} = C_{gd} = \\frac{1}{2} C_{\\mathrm{ox}}$.\n- **Saturation Region ($V_{gs} > V_{th}$ and $V_d \\ge V_{gs}-V_{th}$)**: The channel is pinched off at the drain. The gate's influence over the drain end of the channel is considered to be zero. Thus, $C_{gd} = 0$. The gate-to-source capacitance is often approximated as $C_{gs} = \\frac{2}{3} C_{\\mathrm{ox}}$.\n\nThe problem involves a drain voltage step at constant $V_{gs}$. The incremental gate charge is the integral of the gate-drain capacitance over the voltage step:\n$$\\Delta Q_g^{\\mathrm{Meyer}} = \\int_{V_{d,1}}^{V_{d,2}} C_{gd}(V_d') dV_d'$$\nThe problem explicitly defines the other incremental charges:\n$$\\Delta Q_d^{\\mathrm{Meyer}} = 0$$\n$$\\Delta Q_s^{\\mathrm{Meyer}} = 0$$\nThe sum of incremental charges is therefore $\\sum \\Delta Q_i = \\Delta Q_g^{\\mathrm{Meyer}}$.\nLet $V_{dsat} = V_{gs} - V_{th}$. The integral for $\\Delta Q_g^{\\mathrm{Meyer}}$ becomes a piecewise calculation:\n- If the step is entirely in the linear region ($V_{d,2} < V_{dsat}$): $\\Delta Q_g^{\\mathrm{Meyer}} = \\int_{V_{d,1}}^{V_{d,2}} \\frac{1}{2}C_{\\mathrm{ox}} dV_d' = \\frac{1}{2}C_{\\mathrm{ox}}(V_{d,2}-V_{d,1})$.\n- If the step is entirely in saturation ($V_{d,1} \\ge V_{dsat}$): $\\Delta Q_g^{\\mathrm{Meyer}} = \\int_{V_{d,1}}^{V_{d,2}} 0 \\ dV_d' = 0$.\n- If the step crosses from linear to saturation ($V_{d,1} < V_{dsat} \\le V_{d,2}$): $\\Delta Q_g^{\\mathrm{Meyer}} = \\int_{V_{d,1}}^{V_{dsat}} \\frac{1}{2}C_{\\mathrm{ox}} dV_d' + \\int_{V_{dsat}}^{V_{d,2}} 0 \\ dV_d' = \\frac{1}{2}C_{\\mathrm{ox}}(V_{dsat}-V_{d,1})$.\n- If the device is in subthreshold ($V_{gs} \\le V_{th}$): $C_{gd}=0$, so $\\Delta Q_g^{\\mathrm{Meyer}} = 0$.\n\nThe sum of incremental charges in the Meyer model is non-zero whenever $\\Delta Q_g^{\\mathrm{Meyer}}$ is non-zero. This failure to conserve charge, known as the \"charge pump\" problem, is a famous deficiency of the model.\n\n**4. Analysis of Test Cases**\n- **Case A (Linear):** $V_{gs}=0.8$, $V_d: 0.2 \\to 0.3$. $V_{gt} = 0.4$. The device stays in the linear region. WD is conservative by construction. Meyer will have a non-zero $\\Delta Q_g$ and thus fail the conservation test.\n- **Case B (Into Saturation):** $V_{gs}=0.8$, $V_d: 0.3 \\to 0.7$. $V_{gt}=0.4$. The device transitions from linear to saturation. WD is conservative. Meyer will have a non-zero $\\Delta Q_g$ from the linear portion of the step and fail.\n- **Case C (At Boundary):** $V_{gs}=0.8$, $V_d: 0.4 \\to 0.5$. $V_{gt}=0.4$. The device starts at the saturation boundary and moves deeper into saturation. WD is conservative. In the WD model, $V_{deff}=0.4$ for both points, so all $\\Delta Q_i$ are zero. For Meyer, the entire step is in saturation where $C_{gd}=0$, so $\\Delta Q_g=0$. Meyer appears conservative for this specific case.\n- **Case D (Subthreshold):** $V_{gs}=0.3$, $V_d: 0.1 \\to 0.2$. $V_{gt}=-0.1$. The device is off. Both models define all charges/capacitances as zero. Both will show perfect charge conservation ($\\sum \\Delta Q_i = 0$).\n\nThe implementation will confirm these theoretical predictions.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the MOSFET charge conservation problem for Ward-Dutton and Meyer models.\n    \"\"\"\n    # Device and physical constants (SI units)\n    EPS0 = 8.854187817e-12  # F/m, vacuum permittivity\n    EPS_OX = 3.9 * EPS0      # Oxide permittivity\n    T_OX = 5.0e-9            # m, oxide thickness\n    W = 1.0e-6               # m, gate width\n    L = 1.0e-6               # m, gate length\n    V_TH = 0.4               # V, threshold voltage\n\n    # Calculated parameter: total gate oxide capacitance\n    C_ox = (W * L * EPS_OX) / T_OX\n\n    # Test suite: (Vgs, Vd1, Vd2)\n    test_cases = [\n        (0.8, 0.2, 0.3),  # Case A\n        (0.8, 0.3, 0.7),  # Case B\n        (0.8, 0.4, 0.5),  # Case C\n        (0.3, 0.1, 0.2),  # Case D\n    ]\n\n    results = []\n    \n    # --- Helper function for Ward-Dutton charge calculation ---\n    def calculate_wd_charges(V_gs, V_d, V_th, C_ox_val):\n        \"\"\"\n        Calculates terminal charges (Qg, Qd, Qs) using the Ward-Dutton model.\n        \"\"\"\n        V_gt = V_gs - V_th\n        if V_gt = 0:  # Subthreshold\n            return 0.0, 0.0, 0.0\n\n        # Effective drain voltage for saturation\n        V_deff = min(V_d, V_gt)\n\n        # Numerator and denominator for the total inversion charge formula\n        # Q_I = -2/3 * C_ox * (V_gt^2 + V_gt*V_gtd + V_gtd^2) / (V_gt + V_gtd)\n        # where V_gtd = V_gt - V_deff\n        num_qi = 3 * V_gt**2 - 3 * V_gt * V_deff + V_deff**2\n        den_qi = 2 * V_gt - V_deff\n        \n        # Handle potential division by zero if V_gt is very small, although\n        # V_gt > 0 is checked above. A robust check for den_qi near zero.\n        if abs(den_qi)  1e-12:\n            # This limit corresponds to V_d -> 2*V_gt, which is not physical\n            # within the GCA model. Returning zero is a safe fallback.\n            return 0.0, 0.0, 0.0\n\n        Q_I = - (2.0/3.0) * C_ox_val * (num_qi / den_qi)\n\n        # Gate charge\n        Q_g = -Q_I\n\n        # Drain partitioning factor (X_d = Qd/QI)\n        # using a standard second-order expansion\n        X_d = 0.5 - V_deff / (6.0 * V_gt) + V_deff**2 / (24.0 * V_gt**2)\n        \n        # Drain and Source charges\n        Q_d = X_d * Q_I\n        Q_s = (1.0 - X_d) * Q_I\n        \n        return Q_g, Q_d, Q_s\n\n    # --- Helper function for Meyer model incremental charge calculation ---\n    def calculate_meyer_delta_qg(V_gs, V_d1, V_d2, V_th, C_ox_val):\n        \"\"\"\n        Calculates the incremental gate charge Delta_Qg using the Meyer model.\n        \"\"\"\n        V_gt = V_gs - V_th\n        if V_gt = 0:  # Subthreshold\n            return 0.0\n        \n        V_dsat = V_gt\n        delta_qg = 0.0\n\n        # The integration path is from V_d1 to V_d2\n        V_start = min(V_d1, V_d2)\n        V_end = max(V_d1, V_d2)\n        sign = 1.0 if V_d2 > V_d1 else -1.0\n\n        # Integrate C_gd over the voltage step\n        \n        # Portion of the step in the linear region\n        if V_start  V_dsat:\n            v_lin_end = min(V_end, V_dsat)\n            delta_v_lin = v_lin_end - V_start\n            delta_qg += 0.5 * C_ox_val * delta_v_lin\n        \n        # The Meyer model has C_gd=0 in saturation, so there is no contribution\n        # to the integral for Vd >= Vdsat.\n\n        return sign * delta_qg\n\n    # --- Main loop to process test cases ---\n    for V_gs, V_d1, V_d2 in test_cases:\n        \n        # Ward-Dutton Model\n        Qg1_wd, Qd1_wd, Qs1_wd = calculate_wd_charges(V_gs, V_d1, V_TH, C_ox)\n        Qg2_wd, Qd2_wd, Qs2_wd = calculate_wd_charges(V_gs, V_d2, V_TH, C_ox)\n        \n        delta_Qg_wd = Qg2_wd - Qg1_wd\n        delta_Qd_wd = Qd2_wd - Qd1_wd\n        delta_Qs_wd = Qs2_wd - Qs1_wd\n        \n        sum_delta_q_wd = delta_Qg_wd + delta_Qd_wd + delta_Qs_wd\n        \n        # Meyer Model\n        delta_Qg_meyer = calculate_meyer_delta_qg(V_gs, V_d1, V_d2, V_TH, C_ox)\n        delta_Qd_meyer = 0.0\n        delta_Qs_meyer = 0.0\n        \n        sum_delta_q_meyer = delta_Qg_meyer + delta_Qd_meyer + delta_Qs_meyer\n\n        # Append boolean results based on the conservation criterion\n        conservation_threshold = 1.0e-18\n        results.append(str(abs(sum_delta_q_wd)  conservation_threshold).lower())\n        results.append(str(abs(sum_delta_q_meyer)  conservation_threshold).lower())\n        \n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "This advanced practice integrates the core principles of charge-based modeling into a complete transient simulation. Starting from a set of smooth, physically-based expressions for terminal charges, you will derive the full capacitance matrix ($C_{ij}$) and implement a simulation to compute the device's current response to time-varying voltages. This exercise  demonstrates the power of the charge-based approach, where charge conservation is guaranteed by the model's structure, ensuring physically realistic results in dynamic circuit analysis.",
            "id": "3733665",
            "problem": "You are tasked to implement a physics-consistent transient simulation of a three-terminal charge-based compact model with terminals gate $g$, drain $d$, and source $s$, starting entirely from terminal charges and their voltage derivatives. The device is defined by smooth, bias-dependent terminal charges $Q_g(V)$, $Q_d(V)$, and $Q_s(V)$ that exactly sum to zero for all terminal voltages $V=(V_g,V_d,V_s)$, ensuring charge neutrality. From these charges, the capacitance matrix entries are defined by $C_{ij}(V)=-\\frac{\\partial Q_i}{\\partial V_j}$, and the terminal currents are defined by $I_i(t)=\\sum_{j\\in\\{g,d,s\\}}C_{ij}(V(t))\\,\\frac{dV_j}{dt}$.\n\nThe model uses the following physically plausible and self-consistent charge partitions:\n- Total inversion charge magnitude\n$$Q_{\\mathrm{inv}}(V)=C_0\\,V_\\sigma\\,\\ln\\!\\bigl(1+\\exp(x)\\bigr),\\quad x=\\frac{V_g-V_t-\\gamma\\,V_{ds}}{V_\\sigma},\\quad V_{ds}=V_d-V_s,$$\nwith $C_0$ an effective gate-channel capacitance parameter in $\\mathrm{F}$, $V_\\sigma$ a smoothing voltage in $\\mathrm{V}$, $V_t$ a threshold-like voltage in $\\mathrm{V}$, and $\\gamma$ a dimensionless drain-coupling factor.\n- Smooth charge partition\n$$\\alpha(V_{ds})=\\tfrac{1}{2}\\bigl(1+\\tanh(\\tfrac{V_{ds}}{V_a})\\bigr),$$\nwith $V_a$ a smoothing voltage in $\\mathrm{V}$.\n- Overlap charges modeled as linear capacitors between gate-drain and gate-source:\n$$Q_{gd}^{\\mathrm{ov}}=C_{gd}\\,(V_g-V_d),\\qquad Q_{gs}^{\\mathrm{ov}}=C_{gs}\\,(V_g-V_s),$$\nwith $C_{gd}$ and $C_{gs}$ in $\\mathrm{F}$.\n\nDefine terminal charges as\n- Gate charge:\n$$Q_g=Q_{\\mathrm{inv}}+Q_{gd}^{\\mathrm{ov}}+Q_{gs}^{\\mathrm{ov}},$$\n- Drain charge:\n$$Q_d=-\\alpha\\,Q_{\\mathrm{inv}}-Q_{gd}^{\\mathrm{ov}},$$\n- Source charge:\n$$Q_s=-(1-\\alpha)\\,Q_{\\mathrm{inv}}-Q_{gs}^{\\mathrm{ov}}.$$\nBy construction, $Q_g+Q_d+Q_s=0$ for all biases.\n\nYou must:\n- Derive analytically all needed partial derivatives $\\frac{\\partial Q_i}{\\partial V_j}$ and thus compute $C_{ij}(V)$ for $i\\in\\{g,d,s\\}$ and $j\\in\\{g,d,s\\}$.\n- Simulate the transient using uniform time discretization with step $\\Delta t$ and signals $V_g(t)$ and $V_d(t)$ given below, while keeping $V_s(t)=0$ for all $t$. Compute $I_g(t)$, $I_d(t)$, and $I_s(t)$ at every time step using the definition $I_i(t)=\\sum_{j}C_{ij}(V(t))\\,\\frac{dV_j}{dt}$ with finite-difference approximation for $\\frac{dV_j}{dt}$.\n- Verify charge conservation at every time step by checking $I_g(t)+I_d(t)+I_s(t)=0$ within a numerical tolerance. The numerical tolerance to accept conservation per time step must be defined as\n$$\\tau(t)=\\max\\bigl(10^{-12},\\,10^{-9}\\,\\max(|I_g(t)|,|I_d(t)|,|I_s(t)|)\\bigr)\\ \\mathrm{A}.$$\n- All computed currents must be in $\\mathrm{A}$, voltages in $\\mathrm{V}$, time in $\\mathrm{s}$, capacitances in $\\mathrm{F}$, and charges in $\\mathrm{C}$. The derivative $\\frac{dV_j}{dt}$ must be evaluated in $\\mathrm{V}/\\mathrm{s}$ using uniform finite differences.\n\nTransient definitions, all in continuous time and implemented on a uniform grid:\n- Gate voltage $V_g(t)$ is a linear ramp from $V_{g0}$ to $V_{g1}$ over total duration $T$, i.e., $V_g(t)=V_{g0}+r_g\\,t$ with $r_g=(V_{g1}-V_{g0})/T$.\n- Drain voltage $V_d(t)$ is a step at time $t_{\\mathrm{step}}$ from $V_{d0}$ to $V_{d1}$, i.e., $V_d(t)=V_{d0}$ for $tt_{\\mathrm{step}}$ and $V_d(t)=V_{d1}$ for $t\\ge t_{\\mathrm{step}}$.\n- Source voltage is fixed at $V_s(t)=0$ for all $t$.\n\nStarting from the above definitions and physical base, derive the necessary expressions, implement the transient simulation, and test charge conservation for the following four parameter sets forming the test suite. Each test case specifies $(C_0,C_{gd},C_{gs},V_t,\\gamma,V_\\sigma,V_a,V_{g0},V_{g1},V_{d0},V_{d1},T,t_{\\mathrm{step}},\\Delta t)$, all in SI units:\n1. Happy-path case with moderate nonlinearity:\n   - $C_0=1.0\\times 10^{-12}$, $C_{gd}=2.0\\times 10^{-13}$, $C_{gs}=3.0\\times 10^{-13}$,\n   - $V_t=0.35$, $\\gamma=0.6$, $V_\\sigma=0.04$, $V_a=0.08$,\n   - $V_{g0}=0.0$, $V_{g1}=1.0$, $V_{d0}=0.0$, $V_{d1}=0.5$,\n   - $T=1.0\\times 10^{-9}$, $t_{\\mathrm{step}}=0.4\\times 10^{-9}$, $\\Delta t=1.0\\times 10^{-12}$.\n2. Boundary case with gate held constant and drain stepping strongly:\n   - $C_0=2.0\\times 10^{-12}$, $C_{gd}=1.0\\times 10^{-13}$, $C_{gs}=1.5\\times 10^{-13}$,\n   - $V_t=0.30$, $\\gamma=0.5$, $V_\\sigma=0.05$, $V_a=0.10$,\n   - $V_{g0}=0.8$, $V_{g1}=0.8$, $V_{d0}=0.0$, $V_{d1}=1.0$,\n   - $T=2.0\\times 10^{-9}$, $t_{\\mathrm{step}}=1.0\\times 10^{-9}$, $\\Delta t=1.0\\times 10^{-12}$.\n3. Edge case with decreasing gate and negative drain step:\n   - $C_0=5.0\\times 10^{-13}$, $C_{gd}=5.0\\times 10^{-14}$, $C_{gs}=8.0\\times 10^{-14}$,\n   - $V_t=0.40$, $\\gamma=0.8$, $V_\\sigma=0.03$, $V_a=0.05$,\n   - $V_{g0}=1.0$, $V_{g1}=0.0$, $V_{d0}=0.2$, $V_{d1}=-0.3$,\n   - $T=5.0\\times 10^{-10}$, $t_{\\mathrm{step}}=2.5\\times 10^{-10}$, $\\Delta t=5.0\\times 10^{-13}$.\n4. Near-threshold, very small drain step and sharp partition:\n   - $C_0=1.0\\times 10^{-12}$, $C_{gd}=1.0\\times 10^{-14}$, $C_{gs}=2.0\\times 10^{-14}$,\n   - $V_t=0.33$, $\\gamma=0.7$, $V_\\sigma=0.02$, $V_a=0.01$,\n   - $V_{g0}=0.30$, $V_{g1}=0.35$, $V_{d0}=0.01$, $V_{d1}=0.02$,\n   - $T=1.0\\times 10^{-9}$, $t_{\\mathrm{step}}=0.6\\times 10^{-9}$, $\\Delta t=2.0\\times 10^{-12}$.\n\nFor each test case, implement the transient, compute the currents in amperes, and check at every time step that $I_g+I_d+I_s$ is within $\\pm \\tau(t)$. Your program must output a single line containing a comma-separated list enclosed in brackets, where each entry is a boolean indicating whether all time steps of that test case passed the charge conservation check, in the order of the test suite. For example, the output format must be like $[\\mathrm{True},\\mathrm{False},\\mathrm{True},\\mathrm{True}]$ if those were the results for the four cases. No other output is allowed on the line.",
            "solution": "The user requires the implementation of a transient simulation for a three-terminal charge-based compact model. The process involves validating the problem, deriving the necessary analytical expressions for the capacitance matrix, implementing the simulation loop, and verifying charge conservation at each time step.\n\n### Problem Validation\n\n1.  **Extract Givens**:\n    *   **Terminals**: Gate ($g$), Drain ($d$), Source ($s$).\n    *   **Voltages**: $V = (V_g, V_d, V_s)$.\n    *   **Charge Neutrality**: $Q_g(V) + Q_d(V) + Q_s(V) = 0$ for all $V$.\n    *   **Capacitance Matrix**: $C_{ij}(V) = -\\frac{\\partial Q_i}{\\partial V_j}$.\n    *   **Terminal Currents**: $I_i(t) = \\frac{dQ_i}{dt} = \\sum_{j \\in \\{g,d,s\\}} C_{ij}(V(t)) \\frac{dV_j}{dt}$.\n    *   **Inversion Charge Magnitude**: $Q_{\\mathrm{inv}}(V) = C_0 V_\\sigma \\ln(1+\\exp(x))$, with $x = \\frac{V_g - V_t - \\gamma V_{ds}}{V_\\sigma}$ and $V_{ds} = V_d - V_s$.\n    *   **Charge Partition Function**: $\\alpha(V_{ds}) = \\frac{1}{2}(1 + \\tanh(\\frac{V_{ds}}{V_a}))$.\n    *   **Overlap Charges**: $Q_{gd}^{\\mathrm{ov}} = C_{gd}(V_g - V_d)$ and $Q_{gs}^{\\mathrm{ov}} = C_{gs}(V_g - V_s)$.\n    *   **Terminal Charges**:\n        *   $Q_g = Q_{\\mathrm{inv}} + Q_{gd}^{\\mathrm{ov}} + Q_{gs}^{\\mathrm{ov}}$\n        *   $Q_d = -\\alpha Q_{\\mathrm{inv}} - Q_{gd}^{\\mathrm{ov}}$\n        *   $Q_s = -(1-\\alpha) Q_{\\mathrm{inv}} - Q_{gs}^{\\mathrm{ov}}$\n    *   **Transient Conditions**:\n        *   $V_g(t) = V_{g0} + \\frac{V_{g1}-V_{g0}}{T}t$ (linear ramp).\n        *   $V_d(t) = V_{d0}$ for $t  t_{\\mathrm{step}}$, $V_{d1}$ for $t \\ge t_{\\mathrm{step}}$ (step).\n        *   $V_s(t) = 0$ (grounded).\n    *   **Simulation Method**: Uniform time discretization with step $\\Delta t$. Finite differences for $\\frac{dV_j}{dt}$.\n    *   **Conservation Check**: $|I_g(t)+I_d(t)+I_s(t)| \\le \\tau(t)$, where $\\tau(t) = \\max(10^{-12}, 10^{-9} \\max(|I_g(t)|, |I_d(t)|, |I_s(t)|))$.\n    *   **Test Cases**: Four sets of parameters are provided.\n\n2.  **Validate Using Extracted Givens**:\n    *   **Scientifically Grounded**: The problem is well-grounded in semiconductor device physics and compact modeling. The charge definitions are standard (e.g., EKV or PSP model style), using a smooth inversion charge function and a smooth partitioning function. The current definition is fundamental ($I = dQ/dt$). The charge neutrality condition ($Q_g+Q_d+Q_s=0$) is explicitly satisfied by construction.\n    *   **Well-Posed**: The problem is well-posed. The inputs are clearly defined, and the task is to perform a direct time-domain simulation, which, given the smooth nature of the functions, will produce a unique and stable numerical solution.\n    *   **Objective**: The problem uses precise mathematical and physical language, with all terms defined and no subjective elements.\n    *   **Completeness**: All required parameters, equations, and simulation conditions are provided for each test case.\n    *   **Consistency**: The internal logic is consistent. For example, the definition of terminal charges correctly sums to zero.\n\n3.  **Verdict and Action**:\n    The problem is valid. It is a standard and well-defined exercise in computational electronics. I will proceed with the analytical derivation and numerical implementation.\n\n### Analytical Derivation of the Capacitance Matrix\n\nThe capacitance matrix elements are $C_{ij} = -\\frac{\\partial Q_i}{\\partial V_j}$. We must compute the partial derivatives of each terminal charge with respect to each terminal voltage. Since $V_s=0$, we have $V_{ds} = V_d$ and $V_{gs} = V_g$. The independent voltages are $V_g$ and $V_d$. However, for a general and robust formulation, we first derive with respect to $V_g$, $V_d$, and $V_s$.\n\n**Intermediate Derivatives**:\n1.  Let $S(x) = \\ln(1+e^x)$. Its derivative is the sigmoid function, $\\frac{dS}{dx} = \\frac{e^x}{1+e^x} = \\sigma(x)$.\n    $Q_{\\mathrm{inv}} = C_0 V_\\sigma S(x)$ where $x = \\frac{V_g - V_t - \\gamma(V_d-V_s)}{V_\\sigma}$.\n    *   $\\frac{\\partial Q_{\\mathrm{inv}}}{\\partial V_g} = \\frac{\\partial Q_{\\mathrm{inv}}}{\\partial x} \\frac{\\partial x}{\\partial V_g} = (C_0 V_\\sigma \\sigma(x)) (\\frac{1}{V_\\sigma}) = C_0\\sigma(x)$.\n    *   $\\frac{\\partial Q_{\\mathrm{inv}}}{\\partial V_d} = \\frac{\\partial Q_{\\mathrm{inv}}}{\\partial x} \\frac{\\partial x}{\\partial V_d} = (C_0 V_\\sigma \\sigma(x)) (\\frac{-\\gamma}{V_\\sigma}) = -\\gamma C_0\\sigma(x)$.\n    *   $\\frac{\\partial Q_{\\mathrm{inv}}}{\\partial V_s} = \\frac{\\partial Q_{\\mathrm{inv}}}{\\partial x} \\frac{\\partial x}{\\partial V_s} = (C_0 V_\\sigma \\sigma(x)) (\\frac{\\gamma}{V_\\sigma}) = \\gamma C_0\\sigma(x)$.\n\n2.  $\\alpha(V_{ds}) = \\frac{1}{2}(1 + \\tanh(\\frac{V_{ds}}{V_a}))$ with $V_{ds} = V_d - V_s$.\n    *   $\\frac{\\partial \\alpha}{\\partial V_d} = \\frac{1}{2V_a}\\mathrm{sech}^2(\\frac{V_{ds}}{V_a}) \\frac{\\partial V_{ds}}{\\partial V_d} = \\frac{1}{2V_a}\\mathrm{sech}^2(\\frac{V_{ds}}{V_a})$. Let's denote this $\\alpha'_{V_{ds}}$.\n    *   $\\frac{\\partial \\alpha}{\\partial V_s} = \\alpha'_{V_{ds}} \\frac{\\partial V_{ds}}{\\partial V_s} = -\\alpha'_{V_{ds}}$.\n    *   $\\frac{\\partial \\alpha}{\\partial V_g} = 0$.\n\n3.  Overlap charges:\n    *   $Q_{gd}^{\\mathrm{ov}} = C_{gd}(V_g - V_d) \\implies \\frac{\\partial Q_{gd}^{\\mathrm{ov}}}{\\partial V_g} = C_{gd}$, $\\frac{\\partial Q_{gd}^{\\mathrm{ov}}}{\\partial V_d} = -C_{gd}$.\n    *   $Q_{gs}^{\\mathrm{ov}} = C_{gs}(V_g - V_s) \\implies \\frac{\\partial Q_{gs}^{\\mathrm{ov}}}{\\partial V_g} = C_{gs}$, $\\frac{\\partial Q_{gs}^{\\mathrm{ov}}}{\\partial V_s} = -C_{gs}$.\n\n**Terminal Charge Derivatives ($\\frac{\\partial Q_i}{\\partial V_j}$)**:\nUsing the chain and product rules:\n*   **Gate Charge**: $Q_g = Q_{\\mathrm{inv}} + Q_{gd}^{\\mathrm{ov}} + Q_{gs}^{\\mathrm{ov}}$\n    *   $\\frac{\\partial Q_g}{\\partial V_g} = \\frac{\\partial Q_{\\mathrm{inv}}}{\\partial V_g} + \\frac{\\partial Q_{gd}^{\\mathrm{ov}}}{\\partial V_g} + \\frac{\\partial Q_{gs}^{\\mathrm{ov}}}{\\partial V_g} = C_0\\sigma(x) + C_{gd} + C_{gs}$.\n    *   $\\frac{\\partial Q_g}{\\partial V_d} = \\frac{\\partial Q_{\\mathrm{inv}}}{\\partial V_d} + \\frac{\\partial Q_{gd}^{\\mathrm{ov}}}{\\partial V_d} = -\\gamma C_0\\sigma(x) - C_{gd}$.\n    *   $\\frac{\\partial Q_g}{\\partial V_s} = \\frac{\\partial Q_{\\mathrm{inv}}}{\\partial V_s} + \\frac{\\partial Q_{gs}^{\\mathrm{ov}}}{\\partial V_s} = \\gamma C_0\\sigma(x) - C_{gs}$.\n\n*   **Drain Charge**: $Q_d = -\\alpha Q_{\\mathrm{inv}} - Q_{gd}^{\\mathrm{ov}}$\n    *   $\\frac{\\partial Q_d}{\\partial V_g} = -\\alpha \\frac{\\partial Q_{\\mathrm{inv}}}{\\partial V_g} - \\frac{\\partial Q_{gd}^{\\mathrm{ov}}}{\\partial V_g} = -\\alpha C_0\\sigma(x) - C_{gd}$.\n    *   $\\frac{\\partial Q_d}{\\partial V_d} = -\\frac{\\partial \\alpha}{\\partial V_d} Q_{\\mathrm{inv}} - \\alpha \\frac{\\partial Q_{\\mathrm{inv}}}{\\partial V_d} - \\frac{\\partial Q_{gd}^{\\mathrm{ov}}}{\\partial V_d} = -\\alpha'_{V_{ds}} Q_{\\mathrm{inv}} - \\alpha(-\\gamma C_0\\sigma(x)) - (-C_{gd}) = -\\alpha'_{V_{ds}} Q_{\\mathrm{inv}} + \\alpha\\gamma C_0\\sigma(x) + C_{gd}$.\n    *   $\\frac{\\partial Q_d}{\\partial V_s} = -\\frac{\\partial \\alpha}{\\partial V_s} Q_{\\mathrm{inv}} - \\alpha \\frac{\\partial Q_{\\mathrm{inv}}}{\\partial V_s} = -(-\\alpha'_{V_{ds}}) Q_{\\mathrm{inv}} - \\alpha(\\gamma C_0\\sigma(x)) = \\alpha'_{V_{ds}} Q_{\\mathrm{inv}} - \\alpha\\gamma C_0\\sigma(x)$.\n\n*   **Source Charge**: $Q_s = -(1-\\alpha)Q_{\\mathrm{inv}} - Q_{gs}^{\\mathrm{ov}}$\n    *   $\\frac{\\partial Q_s}{\\partial V_g} = -(1-\\alpha)\\frac{\\partial Q_{\\mathrm{inv}}}{\\partial V_g} - \\frac{\\partial Q_{gs}^{\\mathrm{ov}}}{\\partial V_g} = -(1-\\alpha)C_0\\sigma(x) - C_{gs}$.\n    *   $\\frac{\\partial Q_s}{\\partial V_d} = - \\frac{\\partial (1-\\alpha)}{\\partial V_d} Q_{\\mathrm{inv}} - (1-\\alpha) \\frac{\\partial Q_{\\mathrm{inv}}}{\\partial V_d} = \\alpha'_{V_{ds}} Q_{\\mathrm{inv}} - (1-\\alpha)(-\\gamma C_0\\sigma(x)) = \\alpha'_{V_{ds}} Q_{\\mathrm{inv}} + (1-\\alpha)\\gamma C_0\\sigma(x)$.\n    *   $\\frac{\\partial Q_s}{\\partial V_s} = - \\frac{\\partial (1-\\alpha)}{\\partial V_s} Q_{\\mathrm{inv}} - (1-\\alpha) \\frac{\\partial Q_{\\mathrm{inv}}}{\\partial V_s} - \\frac{\\partial Q_{gs}^{\\mathrm{ov}}}{\\partial V_s} = -(-\\alpha'_{V_{ds}})Q_{\\mathrm{inv}} - (1-\\alpha)(\\gamma C_0\\sigma(x)) - (-C_{gs}) = \\alpha'_{V_{ds}} Q_{\\mathrm{inv}} - (1-\\alpha)\\gamma C_0\\sigma(x) + C_{gs}$.\n\nAs a mandatory consistency check, we confirm that the sum of derivatives with respect to any voltage is zero, e.g., $\\sum_{i} \\frac{\\partial Q_i}{\\partial V_g} = (C_0\\sigma(x) + C_{gd} + C_{gs}) + (-\\alpha C_0\\sigma(x) - C_{gd}) + (-(1-\\alpha)C_0\\sigma(x) - C_{gs}) = C_0\\sigma(x)(1-\\alpha-(1-\\alpha)) = 0$. This confirms the column-sum-to-zero property of the capacitance matrix will hold, which is the basis for charge conservation.\n\n### Simulation Algorithm\nFor each test case:\n1.  Define model parameters.\n2.  Create a uniform time grid $t$ from $0$ to $T$ with step $\\Delta t$.\n3.  Generate the voltage waveforms $V_g(t)$, $V_d(t)$, and $V_s(t)$ on the time grid. $V_s(t)$ is identically zero.\n4.  Iterate through time steps $k = 1, 2, \\dots, N$.\n5.  At each time step $t_k$:\n    a.  Determine the current voltages $V_g(t_k)$, $V_d(t_k)$, and $V_s(t_k)=0$.\n    b.  Compute the time derivatives $\\frac{dV_j}{dt}$ using a backward finite difference: $\\frac{dV_j}{dt}|_{t_k} \\approx \\frac{V_j(t_k) - V_j(t_{k-1})}{\\Delta t}$.\n    c.  Evaluate all nine elements of the capacitance matrix $C_{ij}(V(t_k))$ using the analytical formulas derived above. For numerical stability, $Q_{\\mathrm{inv}}$'s logarithmic term $\\ln(1+e^x)$ is computed as `numpy.logaddexp(0, x)`.\n    d.  Calculate the terminal currents $I_i(t_k) = \\sum_j C_{ij}(V(t_k)) \\frac{dV_j}{dt}|_{t_k}$.\n    e.  Verify charge conservation: check if $|I_g(t_k) + I_d(t_k) + I_s(t_k)| \\le \\tau(t_k)$.\n6.  If the conservation check fails at any time step, the entire test case is marked as failed.\n7.  The final output is a list of booleans, one for each test case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to run transient simulations for all test cases.\n    \"\"\"\n    test_cases = [\n        # 1. Happy-path case\n        (1.0e-12, 2.0e-13, 3.0e-13, 0.35, 0.6, 0.04, 0.08, 0.0, 1.0, 0.0, 0.5, 1.0e-9, 0.4e-9, 1.0e-12),\n        # 2. Boundary case, constant gate\n        (2.0e-12, 1.0e-13, 1.5e-13, 0.30, 0.5, 0.05, 0.10, 0.8, 0.8, 0.0, 1.0, 2.0e-9, 1.0e-9, 1.0e-12),\n        # 3. Edge case, decreasing gate, negative drain\n        (5.0e-13, 5.0e-14, 8.0e-14, 0.40, 0.8, 0.03, 0.05, 1.0, 0.0, 0.2, -0.3, 5.0e-10, 2.5e-10, 5.0e-13),\n        # 4. Near-threshold, small signals\n        (1.0e-12, 1.0e-14, 2.0e-14, 0.33, 0.7, 0.02, 0.01, 0.30, 0.35, 0.01, 0.02, 1.0e-9, 0.6e-9, 2.0e-12),\n    ]\n\n    def _run_simulation(params):\n        \"\"\"\n        Performs the transient simulation for a single test case.\n        Returns True if charge conservation holds for all time steps, False otherwise.\n        \"\"\"\n        C0, Cgd, Cgs, Vt, gamma, Vsigma, Va, Vg0, Vg1, Vd0, Vd1, T, t_step, dt = params\n\n        # 1. Set up time grid and voltage signals\n        num_steps = int(round(T / dt))\n        t = np.linspace(0, T, num_steps + 1)\n\n        # Gate voltage: linear ramp\n        if T > 0 and Vg0 != Vg1:\n            rg = (Vg1 - Vg0) / T\n            Vg_t = Vg0 + rg * t\n        else:\n            Vg_t = np.full_like(t, Vg0)\n\n        # Drain voltage: step function\n        Vd_t = np.full_like(t, Vd0)\n        step_idx = np.searchsorted(t, t_step, side='left')\n        Vd_t[step_idx:] = Vd1\n\n        # Source voltage: grounded\n        Vs_t = np.zeros_like(t)\n\n        conservation_passed_all_steps = True\n        for k in range(1, num_steps + 1):\n            Vg_k, Vd_k, Vs_k = Vg_t[k], Vd_t[k], Vs_t[k]\n            Vg_prev, Vd_prev, Vs_prev = Vg_t[k-1], Vd_t[k-1], Vs_t[k-1]\n\n            # 2. Compute voltage derivatives via backward finite difference\n            dVg_dt = (Vg_k - Vg_prev) / dt\n            dVd_dt = (Vd_k - Vd_prev) / dt\n            dVs_dt = (Vs_k - Vs_prev) / dt  # This is always 0\n\n            # 3. Evaluate capacitance matrix C_ij at time t_k\n            Vds_k = Vd_k - Vs_k\n\n            # Helper variables for C-matrix\n            x = (Vg_k - Vt - gamma * Vds_k) / Vsigma\n            sx = 1.0 / (1.0 + np.exp(-x))  # Sigmoid function sigma(x)\n\n            y_a = Vds_k / Va\n            tanh_ya = np.tanh(y_a)\n            \n            alpha = 0.5 * (1.0 + tanh_ya)\n            # Derivative of alpha w.r.t Vds\n            dalpha_dVds = (0.5 / Va) * (1.0 - tanh_ya**2)\n            \n            # Use numerically stable logaddexp(0,x) for log(1+exp(x))\n            Q_inv = C0 * Vsigma * np.logaddexp(0, x)\n\n            # dQ_i/dV_j derivatives\n            dQg_dVg = C0*sx + Cgd + Cgs\n            dQg_dVd = -gamma*C0*sx - Cgd\n            dQg_dVs = gamma*C0*sx - Cgs\n\n            dQd_dVg = -alpha*C0*sx - Cgd\n            dQd_dVd = -dalpha_dVds*Q_inv + alpha*gamma*C0*sx + Cgd\n            dQd_dVs = dalpha_dVds*Q_inv - alpha*gamma*C0*sx\n\n            dQs_dVg = -(1-alpha)*C0*sx - Cgs\n            dQs_dVd = dalpha_dVds*Q_inv + (1-alpha)*gamma*C0*sx\n            dQs_dVs = -dalpha_dVds*Q_inv - (1-alpha)*gamma*C0*sx + Cgs\n\n            # Capacitance matrix C_ij = -dQ_i/dV_j\n            C_gg, C_gd, C_gs = -dQg_dVg, -dQg_dVd, -dQg_dVs\n            C_dg, C_dd, C_ds = -dQd_dVg, -dQd_dVd, -dQd_dVs\n            C_sg, C_sd, C_ss = -dQs_dVg, -dQs_dVd, -dQs_dVs\n\n            # 4. Calculate terminal currents\n            I_g = C_gg * dVg_dt + C_gd * dVd_dt + C_gs * dVs_dt\n            I_d = C_dg * dVg_dt + C_dd * dVd_dt + C_ds * dVs_dt\n            I_s = C_sg * dVg_dt + C_sd * dVd_dt + C_ss * dVs_dt\n\n            # 5. Verify charge conservation\n            I_sum = I_g + I_d + I_s\n            max_I_abs = max(abs(I_g), abs(I_d), abs(I_s), 1e-15) # Avoid max of zero\n            tolerance = max(1e-12, 1e-9 * max_I_abs)\n\n            if abs(I_sum) > tolerance:\n                conservation_passed_all_steps = False\n                break\n\n        return conservation_passed_all_steps\n\n    results = []\n    for case_params in test_cases:\n        result = _run_simulation(case_params)\n        results.append(str(result).lower())\n\n    # Format output as a single line: [Bool,Bool,...]\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}