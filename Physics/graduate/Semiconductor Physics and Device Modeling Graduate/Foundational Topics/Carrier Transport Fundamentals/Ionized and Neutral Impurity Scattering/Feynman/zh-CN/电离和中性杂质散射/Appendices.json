{
    "hands_on_practices": [
        {
            "introduction": "电离杂质的长程库仑势会被周围可移动的载流子所改变。这项实践练习  将指导你完成德拜屏蔽长度的基本推导，它是量化这种屏蔽效应的关键参数，也是 Brooks-Herring 模型的核心。掌握这一推导过程，你将深刻理解载流子浓度和温度如何影响散射强度。",
            "id": "3756942",
            "problem": "一个处于均匀温度 $T$ 下的掺杂半导体含有可移动载流子，其总平衡密度为 $n$（平衡电子和空穴密度之和）。该材料是非简并的，因此载流子服从 Maxwell–Boltzmann 统计，并且其静电学特性可以在线性响应范围内描述。主晶格提供了一个空间均匀的介电环境，其特征在于介电常数 $\\varepsilon=\\varepsilon_0 \\varepsilon_r$，其中 $\\varepsilon_0$ 是真空介电常数，$\\varepsilon_r$ 是相对介电常数。\n\n考虑在原点引入一个电荷量为 $Z e$ 的弱的、静态的点状离子。从关联静电势 $\\phi(\\mathbf{r})$ 与电荷密度的 Poisson 方程出发，并利用局域载流子密度对静电势的 Maxwell–Boltzmann 依赖关系，通过显式地求出由 $\\phi(\\mathbf{r})$ 引起的可移动电荷密度的一阶变化，来推导控制 $\\phi(\\mathbf{r})$ 的线性化方程。由此，确定在非简并极限下的屏蔽波矢 $k_D$，并给出用 $e$、$n$、$\\varepsilon_0$、$\\varepsilon_r$、$k_B$ 和 $T$ 表示的 $k_D^2$ 的闭合形式解析表达式。\n\n最后，在电离杂质散射的背景下，简要解释 $k_D$ 如何依赖于 $T$ 和 $n$，重点关注 $T$ 和 $n$ 的变化如何改变屏蔽库仑势的空间范围，从而影响长程散射的定性强度。将 $k_D^2$ 的最终结果表示为单个解析表达式。无需进行数值计算。",
            "solution": "该问题是有效的，因为它具有科学依据，提法恰当且客观，是半导体物理学中的一个标准推导。\n\n我们从 Poisson 方程开始，该方程将静电势 $\\phi(\\mathbf{r})$ 与具有均匀介电常数 $\\varepsilon = \\varepsilon_0 \\varepsilon_r$ 的介质中的总电荷密度 $\\rho_{\\text{total}}(\\mathbf{r})$ 联系起来：\n$$\n\\nabla^2 \\phi(\\mathbf{r}) = -\\frac{\\rho_{\\text{total}}(\\mathbf{r})}{\\varepsilon}\n$$\n总电荷密度是固定的点状离子的电荷密度 $\\rho_{\\text{ion}}(\\mathbf{r})$ 与可移动载流子密度的感生变化 $\\delta\\rho_{\\text{mobile}}(\\mathbf{r})$ 之和。位于原点、电荷量为 $Z e$ 的固定离子由 Dirac delta 函数表示：\n$$\n\\rho_{\\text{ion}}(\\mathbf{r}) = Z e \\delta(\\mathbf{r})\n$$\n可移动载流子由电子和空穴组成。在没有微扰势 $\\phi(\\mathbf{r})$ 的情况下，半导体是电中性的，具有均匀的平衡电子密度 $n_0$ 和空穴密度 $p_0$。题目指出，可移动载流子的总平衡密度为 $n = n_0 + p_0$。\n\n当存在电势 $\\phi(\\mathbf{r})$ 时，电子的局域密度 $n(\\mathbf{r})$ 和空穴的局域密度 $p(\\mathbf{r})$ 会被调制。由于载流子是非简并的，它们的局域密度由 Maxwell–Boltzmann 统计描述：\n$$\nn(\\mathbf{r}) = n_0 \\exp\\left(\\frac{e \\phi(\\mathbf{r})}{k_B T}\\right)\n$$\n$$\np(\\mathbf{r}) = p_0 \\exp\\left(-\\frac{e \\phi(\\mathbf{r})}{k_B T}\\right)\n$$\n其中 $-e$ 是电子电荷，$k_B$ 是 Boltzmann 常数，$T$ 是绝对温度。因此，局域可移动电荷密度为：\n$$\n\\rho_{\\text{mobile}}(\\mathbf{r}) = e(p(\\mathbf{r}) - n(\\mathbf{r})) = e \\left[ p_0 \\exp\\left(-\\frac{e \\phi(\\mathbf{r})}{k_B T}\\right) - n_0 \\exp\\left(\\frac{e \\phi(\\mathbf{r})}{k_B T}\\right) \\right]\n$$\n题目指明我们处于线性响应范围内，这对应于弱电势，即 $|e \\phi(\\mathbf{r})| \\ll k_B T$。这使得对指数函数进行一阶 Taylor 展开是合理的，即对于小的 $x$，有 $\\exp(x) \\approx 1 + x$。应用此线性化可得：\n$$\n\\rho_{\\text{mobile}}(\\mathbf{r}) \\approx e \\left[ p_0 \\left(1 - \\frac{e \\phi(\\mathbf{r})}{k_B T}\\right) - n_0 \\left(1 + \\frac{e \\phi(\\mathbf{r})}{k_B T}\\right) \\right]\n$$\n$$\n\\rho_{\\text{mobile}}(\\mathbf{r}) \\approx e(p_0 - n_0) - \\frac{e^2}{k_B T}(p_0 + n_0) \\phi(\\mathbf{r})\n$$\n第一项 $e(p_0 - n_0)$ 代表背景可移动电荷密度，它被固定的电离掺杂剂所补偿，以确保体材料的整体电中性。可移动电荷密度的变化 $\\delta\\rho_{\\text{mobile}}(\\mathbf{r})$ 是第二项，它是由电势 $\\phi(\\mathbf{r})$ 感生的。这就是题目所要求的显式一阶变化：\n$$\n\\delta\\rho_{\\text{mobile}}(\\mathbf{r}) = -\\frac{e^2(p_0 + n_0)}{k_B T} \\phi(\\mathbf{r})\n$$\n使用给定的定义 $n = n_0 + p_0$，上式变为：\n$$\n\\delta\\rho_{\\text{mobile}}(\\mathbf{r}) = -\\frac{n e^2}{k_B T} \\phi(\\mathbf{r})\n$$\n用于 Poisson 方程的总电荷密度为 $\\rho_{\\text{total}}(\\mathbf{r}) = \\rho_{\\text{ion}}(\\mathbf{r}) + \\delta\\rho_{\\text{mobile}}(\\mathbf{r})$。将此式以及 $\\delta\\rho_{\\text{mobile}}(\\mathbf{r})$ 的表达式代入 Poisson 方程，我们得到：\n$$\n\\nabla^2 \\phi(\\mathbf{r}) = -\\frac{1}{\\varepsilon} \\left( Z e \\delta(\\mathbf{r}) - \\frac{n e^2}{k_B T} \\phi(\\mathbf{r}) \\right)\n$$\n整理各项，我们得到线性化的、被屏蔽的 Poisson 方程：\n$$\n\\nabla^2 \\phi(\\mathbf{r}) - \\frac{n e^2}{\\varepsilon k_B T} \\phi(\\mathbf{r}) = -\\frac{Z e}{\\varepsilon} \\delta(\\mathbf{r})\n$$\n该方程具有一般形式 $\\nabla^2 \\phi - k_D^2 \\phi = -\\rho_{\\text{ext}}/\\varepsilon$。通过直接比较，我们可以确定屏蔽波矢的平方 $k_D^2$ 为：\n$$\nk_D^2 = \\frac{n e^2}{\\varepsilon k_B T}\n$$\n代入介电常数的表达式 $\\varepsilon = \\varepsilon_0 \\varepsilon_r$，我们得到 $k_D^2$ 的最终闭合形式表达式：\n$$\nk_D^2 = \\frac{n e^2}{\\varepsilon_0 \\varepsilon_r k_B T}\n$$\n量 $k_D$ 是 Debye 屏蔽波矢，其倒数 $\\lambda_D = 1/k_D$ 是 Debye 屏蔽长度。被屏蔽的 Poisson 方程的解是 Yukawa 势或屏蔽库仑势，$\\phi(r) \\propto (1/r) \\exp(-k_D r)$，这表明在大于 $\\lambda_D$ 的距离上，电势会迅速衰减。\n\n$k_D$ 对温度 $T$ 和总可移动载流子密度 $n$ 的依赖关系在电离杂质散射的背景下有清晰的物理解释。\n1.  **对 $n$ 的依赖性**：$k_D \\propto \\sqrt{n}$。可移动载流子密度 $n$ 的增加导致 $k_D$ 的增加，从而导致屏蔽长度 $\\lambda_D$ 的减小。当有更多的可移动电荷可用时，对杂质离子的库仑势的屏蔽就更有效，其影响被限制在更小的空间区域内。这使得电势变得更短程，从而削弱了长程散射的有效性。\n2.  **对 $T$ 的依赖性**：$k_D \\propto 1/\\sqrt{T}$。温度 $T$ 的升高为可移动载流子提供了更大的热能（动能）。结果，载流子形成的屏蔽云变得更弥散，屏蔽效果也较差。这对应于 $k_D$ 的减小和屏蔽长度 $\\lambda_D$ 的增加。电势变得更长程，然而，由于载流子动能的增加，它们受到的偏转更小，这主导并导致了总散射强度的减弱。",
            "answer": "$$\n\\boxed{\\frac{n e^2}{\\varepsilon_0 \\varepsilon_r k_B T}}\n$$"
        },
        {
            "introduction": "虽然像 Erginsoy 这样的简单模型很有用，但真实的散射过程是能量依赖的。这项高级练习  挑战你使用量子散射理论，特别是第一玻恩近似，来分析高能量下载流子在短程势场中的散射。通过推导迁移率在高温下的依赖关系，你将揭示简单模型的局限性，并体会到更严格理论处理的必要性。",
            "id": "3756953",
            "problem": "考虑半导体中的三维非简并电子气，其导带为抛物线形，特征有效质量为 $m^{\\ast}$。电子与密度为 $N_{\\mathrm{N}}$（不依赖于温度）的中性杂质发生弹性散射。每个杂质被建模为一个球对称的短程高斯势 $V(r) = V_{0} \\exp(-r^{2}/a^{2})$，其特征范围为 $a$，幅度为 $V_{0}$。$|V_{0}|$ 足够小，以至于在高载流子能量下产生弱散射。假设高能极限对应于 $k a \\gg 1$，其中 $k(E) = \\sqrt{2 m^{\\ast} E}/\\hbar$ 是动能为 $E$ 的电子波矢。电子系综在温度 $T$ 下遵循麦克斯韦-玻尔兹曼能量分布，其他散射机制可以忽略。\n\n从基本散射理论和半经典输运定义出发，完成以下任务：\n1. 在一阶玻恩近似下，确定势 $V(r)$ 的输运截面的渐近高能依赖关系，并通过中性杂质动量弛豫率推导出弛豫时间 $\\tau(E)$ 相应的能量依赖关系。利用此结果，求出非简并电子气的中性杂质限制迁移率 $\\mu_{\\mathrm{N}}(T)$ 的渐近高温依赖关系。\n2. 使用弹性散射的分波相移表示，分析弱散射、高能极限下的输运截面，并证明其能量标度关系与玻恩近似的结果一致。\n\n回答以下问题：在高温极限 $k a \\gg 1$下，中性杂质限制迁移率遵循幂律关系 $\\mu_{\\mathrm{N}}(T) \\propto T^{p}$。指数 $p$ 的精确值是多少？请用一个无单位的精确数表示最终答案。无需四舍五入。",
            "solution": "我们从量子散射和半经典输运的基本要素开始。对于球对称势的弹性散射，一阶玻恩近似给出的散射振幅 $f(\\theta)$ 用势 $V(\\mathbf{r})$ 的傅里叶变换 $V(\\mathbf{q})$ 表示，其中 $\\mathbf{q}$ 是动量转移：\n$$\nf(\\theta) = -\\frac{m^{\\ast}}{2\\pi \\hbar^{2}}\\, V(\\mathbf{q}), \\quad \\mathbf{q} = \\mathbf{k}_{\\mathrm{f}} - \\mathbf{k}_{\\mathrm{i}}, \\quad q = |\\mathbf{q}| = 2 k \\sin\\!\\left(\\frac{\\theta}{2}\\right).\n$$\n微分截面为 $d\\sigma/d\\Omega = |f(\\theta)|^{2}$。对于各向同性散射中的动量弛豫，输运截面为\n$$\n\\sigma_{\\mathrm{tr}}(E) = \\int d\\Omega\\, \\left(1 - \\cos\\theta\\right) \\frac{d\\sigma}{d\\Omega}.\n$$\n对于高斯势 $V(r) = V_{0} \\exp(-r^{2}/a^{2})$，其傅里叶变换为\n$$\nV(\\mathbf{q}) = \\int d^{3}r\\, V_{0} \\exp\\!\\left(-\\frac{r^{2}}{a^{2}}\\right) \\exp(i \\mathbf{q}\\cdot \\mathbf{r}) \n= V_{0}\\, \\pi^{3/2} a^{3}\\, \\exp\\!\\left(-\\frac{a^{2} q^{2}}{4}\\right).\n$$\n因此，\n$$\n\\frac{d\\sigma}{d\\Omega} = \\left|\\frac{m^{\\ast}}{2\\pi \\hbar^{2}} V(\\mathbf{q})\\right|^{2} \n= \\frac{(m^{\\ast})^{2}}{4\\pi^{2} \\hbar^{4}}\\, V_{0}^{2}\\, \\pi^{3} a^{6}\\, \\exp\\!\\left(-\\frac{a^{2} q^{2}}{2}\\right).\n$$\n引入 $u = \\sin(\\theta/2)$，这样 $q = 2 k u$，$\\cos\\theta = 1 - 2u^{2}$，以及 $\\sin\\theta d\\theta = 4u du$。那么\n$$\n\\sigma_{\\mathrm{tr}}(E) \n= \\frac{(m^{\\ast})^{2} V_{0}^{2} \\pi^{3} a^{6}}{4\\pi^{2} \\hbar^{4}} \n\\int d\\Omega\\, \\left(1 - \\cos\\theta\\right) \\exp\\!\\left(-\\frac{a^{2} q^{2}}{2}\\right)\n= \\frac{(m^{\\ast})^{2} V_{0}^{2} \\pi^{3} a^{6}}{4\\pi^{2} \\hbar^{4}} \\cdot 2\\pi \\int_{0}^{\\pi} d\\theta\\, \\sin\\theta\\, \\left(1-\\cos\\theta\\right)\\, \\exp\\!\\left(-2 (k a)^{2} \\sin^{2}\\!\\frac{\\theta}{2}\\right).\n$$\n使用上述变量替换和恒等式，\n$$\n\\sigma_{\\mathrm{tr}}(E)\n= \\frac{(m^{\\ast})^{2} V_{0}^{2} \\pi^{3} a^{6}}{4\\pi^{2} \\hbar^{4}} \\cdot 2\\pi \\int_{0}^{1} 8u^3 \\exp\\!\\left(-2 (k a)^{2} u^{2}\\right) du\n= \\frac{(m^{\\ast})^{2} V_{0}^{2} \\pi^{3} a^{6}}{4\\pi^{2} \\hbar^{4}} \\cdot 16\\pi \\int_{0}^{1} u^{3} \\exp\\!\\left(-\\beta u^{2}\\right) du,\n$$\n其中 $\\beta \\equiv 2 (k a)^{2}$。计算该积分：\n$$\n\\int_{0}^{1} u^{3} \\exp\\!\\left(-\\beta u^{2}\\right) du = \\frac{1}{2} \\int_{0}^{1} t \\exp(-\\beta t)\\, dt = \\frac{1}{2}\\left[\\frac{1}{\\beta^{2}} - \\exp(-\\beta)\\left(\\frac{1}{\\beta} + \\frac{1}{\\beta^{2}}\\right)\\right].\n$$\n因此，\n$$\n\\sigma_{\\mathrm{tr}}(E) = \\frac{(m^{\\ast})^{2} V_{0}^{2} a^{6}}{\\hbar^{4}} \\cdot 2\\pi^{2} \\left[\\frac{1}{\\beta^{2}} - \\exp(-\\beta)\\left(\\frac{1}{\\beta} + \\frac{1}{\\beta^{2}}\\right)\\right], \\quad \\beta = 2 (k a)^{2}.\n$$\n在高能极限 $k a \\gg 1$ 下，我们有 $\\exp(-\\beta) \\to 0$，得到渐近标度关系\n$$\n\\sigma_{\\mathrm{tr}}(E) \\sim \\frac{(m^{\\ast})^{2} V_{0}^{2} a^{6}}{\\hbar^{4}} \\cdot 2\\pi^{2} \\cdot \\frac{1}{\\beta^{2}}\n= \\frac{(m^{\\ast})^{2} V_{0}^{2} a^{6}}{\\hbar^{4}} \\cdot 2\\pi^{2} \\cdot \\frac{1}{4 (k a)^{4}}\n= \\frac{\\pi^{2} (m^{\\ast})^{2} V_{0}^{2} a^{2}}{2 \\hbar^{4}} \\cdot \\frac{1}{k^{4}}.\n$$\n因此，由于 $E \\propto k^{2}$，\n$$\n\\sigma_{\\mathrm{tr}}(E) \\propto E^{-2}.\n$$\n对于弹性、各向同性的中性杂质散射，动量弛豫率为\n$$\n\\frac{1}{\\tau(E)} = N_{\\mathrm{N}}\\, v(E)\\, \\sigma_{\\mathrm{tr}}(E), \\quad v(E) = \\sqrt{\\frac{2E}{m^{\\ast}}} \\propto E^{1/2}.\n$$\n因此，\n$$\n\\frac{1}{\\tau(E)} \\propto E^{1/2}\\, E^{-2} = E^{-3/2} \\quad \\Rightarrow \\quad \\tau(E) \\propto E^{3/2}.\n$$\n对于抛物线形能带中的非简并电子气，由单一散射机制限制的漂移迁移率随温度的标度关系取决于 $\\tau(E)$ 的能量依赖性，因为电导率涉及加权平均 $\\int dE\\, E^{3/2}\\, \\tau(E)\\, \\exp(-E/k_{B}T)$，而载流子密度的标度关系为 $\\int dE\\, E^{1/2}\\, \\exp(-E/k_{B}T)$。具体来说，设 $\\tau(E) \\propto E^{s}$；则\n$$\n\\mu_{\\mathrm{N}}(T) \\propto \\frac{\\int_{0}^{\\infty} dE\\, E^{3/2}\\, E^{s}\\, \\exp(-E/k_{B}T)}{(k_{B}T) \\int_{0}^{\\infty} dE\\, E^{1/2}\\, \\exp(-E/k_{B}T)} \\propto (k_{B}T)^{s}.\n$$\n当 $s = 3/2$ 时，我们得到\n$$\n\\mu_{\\mathrm{N}}(T) \\propto T^{3/2}.\n$$\n\n我们现在通过相移形式理论来验证这种能量标度关系。对于弹性散射，输运截面可以用分波相移 $\\delta_{l}(k)$ 表示为\n$$\n\\sigma_{\\mathrm{tr}}(E) = \\frac{4\\pi}{k^{2}} \\sum_{l=0}^{\\infty} (l+1)\\, \\sin^{2}\\!\\left(\\delta_{l+1}(k) - \\delta_{l}(k)\\right).\n$$\n在适用于小 $|V_{0}|$（以及高能 $k a \\gg 1$）的弱散射极限下，我们有 $\\delta_{l} \\ll 1$，并且可以使用 $\\sin^{2}(\\delta_{l+1}-\\delta_{l}) \\approx (\\delta_{l+1}-\\delta_{l})^{2}$。对于范围为 $a$ 的短程势，显著的相移出现在碰撞参数 $b \\sim (l+1/2)/k \\lesssim a$ 的分波中，即对于 $l$ 直到 $l_{\\max} \\sim k a$。在这个范围内，相移随 $l$ 平滑变化，因此我们可以用导数来近似其差值：\n$$\n\\delta_{l+1} - \\delta_{l} \\approx \\frac{\\partial \\delta}{\\partial l} \\sim \\frac{\\partial \\delta}{\\partial b}\\, \\frac{\\partial b}{\\partial l} \\sim \\frac{1}{k}\\, \\frac{\\partial \\delta}{\\partial b}.\n$$\n此外，对于高能下的弱短程势，$\\delta$ 的量级本身的标度关系为 $\\delta \\sim \\alpha(k) \\, g(b/a)$，其中 $\\alpha(k) \\propto 1/k$ 且 $g$ 是无量纲的，因为沿轨迹累积的散射相位与 $V$ 的积分除以局域动量成正比，经过适当的无量纲化后产生一个因子 $1/k$。因此，\n$$\n\\delta_{l+1} - \\delta_{l} \\sim \\frac{1}{k^{2}} \\times \\text{(一个关于 } b/a \\text{ 的无量纲函数)}.\n$$\n代入输运截面表达式，对 $(l+1) (\\delta_{l+1}-\\delta_{l})^{2}$ 的求和主要贡献来自于 $l \\sim k a$ 的项，得到\n$$\n\\sigma_{\\mathrm{tr}}(E) \\sim \\frac{4\\pi}{k^{2}} \\sum_{l \\lesssim k a} (l+1)\\, \\left(\\frac{C}{k^{2}}\\right)^{2} \\sim \\frac{4\\pi}{k^{2}} \\cdot \\left(\\frac{1}{k^{4}}\\right) \\sum_{l \\lesssim k a} (l+1) \\sim \\frac{4\\pi}{k^{2}} \\cdot \\left(\\frac{1}{k^{4}}\\right) \\cdot (k a)^{2} \\sim \\frac{\\text{常数} \\cdot a^{2}}{k^{4}},\n$$\n其中 $C$ 是由势的形状决定的无量纲振幅，并且我们对大的 $k a$ 使用了 $\\sum_{l \\lesssim k a} (l+1) \\sim (k a)^{2}/2$。这与上面推导出的玻恩近似的渐近标度关系 $\\sigma_{\\mathrm{tr}}(E) \\propto k^{-4} \\propto E^{-2}$ 相符。输运率于是遵循 $1/\\tau(E) \\propto v(E) \\sigma_{\\mathrm{tr}}(E) \\propto E^{1/2} E^{-2} = E^{-3/2}$，在非简并、高温极限下再次得到 $\\tau(E) \\propto E^{3/2}$，因此 $\\mu_{\\mathrm{N}}(T) \\propto T^{3/2}$。\n\n因此，一阶玻恩近似和相移形式理论都表明，中性杂质限制迁移率表现出高温幂律标度关系\n$$\n\\mu_{\\mathrm{N}}(T) \\propto T^{p}, \\quad p = \\frac{3}{2},\n$$\n这表明 Erginsoy 模型在高载流子能量下预测的温度无关性被打破。",
            "answer": "$$\\boxed{\\frac{3}{2}}$$"
        },
        {
            "introduction": "散射的理论模型是预测性器件模拟（如蒙特卡洛方法）的基础。这项实践练习  将理论与计算联系起来，要求你推导并实现一个算法，以根据屏蔽库仑散射定律随机抽样散射角。这个练习展示了如何将一个物理的散射截面转化为一个强大模拟工具中的工作组件。",
            "id": "3756952",
            "problem": "您的任务是推导并实现一个精确的、基于反演的采样器，用于蒙特卡罗（MC）输运模拟中电离杂质散射的极向散射角。考虑一个波矢大小为 $k$ 的载流子，在第一次玻恩近似下，被屏蔽库仑（汤川）势进行弹性散射。微分散射截面，在一个常数预因子之内，与 $(q^2 + q_s^2)^{-2}$ 成正比，其中动量转移为 $q = 2 k \\sin(\\theta/2)$，$q_s$ 是屏蔽波矢。由于柱对称性，方位角 $\\phi$ 在 $[0,2\\pi)$ 上均匀分布，而极角 $\\theta \\in [0,\\pi]$ 具有一个非平凡的分布，该分布由立体角上的累积分布导出，使用标准的立体角测度 $d\\Omega = \\sin\\theta \\, d\\theta \\, d\\phi$。\n\n从基本定义和经过充分检验的事实出发：\n- 散射角的概率密度与微分截面乘以立体角测度成正比。\n- $\\theta$ 的累积分布函数（CDF）$C(\\theta)$ 是该密度从 $0$ 到 $\\theta$ 的归一化累积积分。\n- 逆变换采样需要对 $u = C(\\theta)$ 进行反演，其中 $u$ 是在 $[0,1]$ 上均匀分布的随机数。\n\n您的任务是：\n1) 推导极角 $\\theta$ 的归一化累积分布函数 $C(\\theta)$，用 $k$ 和 $q_s$ 表示，并利用给定的依赖关系 $q = 2 k \\sin(\\theta/2)$ 显式地对 $\\phi$ 和 $\\theta$ 进行积分。然后推导出一个闭式反演公式 $\\theta(u;k,q_s)$，该公式将一个在 $[0,1]$ 上的均匀分布随机变量 $u$ 映射到一个散射角 $\\theta \\in [0,\\pi]$。\n2) 设计一个数值稳定的算法来实现这个反演公式，仔细处理 $u$ 非常接近 $0$ 或 $1$ 的边界情况。您的算法必须以弧度为单位返回 $\\theta$。\n3) 实现一个完整的程序，该程序为一个小的参数集 $(k,q_s)$ 测试套件和指定的 $u$ 值列表计算 $\\theta$，并将结果打印在单行上。\n\n物理单位：\n- 波矢大小 $k$ 和屏蔽波矢 $q_s$ 必须以 $\\text{m}^{-1}$ 为单位提供。\n- 散射角 $\\theta$ 必须以弧度表示。\n\n角度单位：\n- 所有角度必须是弧度。\n\n测试套件：\n- 共有 $3$ 个测试用例。对于每个用例，计算与给定的 $u$ 值相对应的 $\\theta$ 值列表。请严格使用以下参数和输入：\n  - 用例 $1$（中等屏蔽）：$k = 1.0 \\times 10^9 \\, \\text{m}^{-1}$，$q_s = 5.0 \\times 10^8 \\, \\text{m}^{-1}$，以及 $u$ 值 $[0.0, 0.25, 0.5, 0.75, 1.0]$。\n  - 用例 $2$（弱屏蔽）：$k = 1.0 \\times 10^{10} \\, \\text{m}^{-1}$，$q_s = 1.0 \\times 10^8 \\, \\text{m}^{-1}$，以及 $u$ 值 $[1.0 \\times 10^{-12}, 1.0 \\times 10^{-6}, 0.1, 0.9, 0.999999999999]$。\n  - 用例 $3$（强屏蔽）：$k = 1.0 \\times 10^8 \\, \\text{m}^{-1}$，$q_s = 1.0 \\times 10^{11} \\, \\text{m}^{-1}$，以及 $u$ 值 $[0.2, 0.4, 0.6, 0.8]$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含结果，格式为以逗号分隔的列表的列表，并用方括号括起来，其中每个内部列表对应一个测试用例，并按给定顺序包含指定 $u$ 值的 $\\theta$ 值（以弧度为单位）。例如，打印的行必须如下所示：\n  - $[[\\theta_{1,1},\\theta_{1,2},\\dots],[\\theta_{2,1},\\dots],[\\theta_{3,1},\\dots]]$\n- 每个 $\\theta$ 都必须是浮点数。打印的值中不要包含单位。",
            "solution": "该问题要求推导并实现一个精确的、基于反演的采样器，用于从屏蔽库仑势中弹性散射的载流子的极向散射角 $\\theta$。该过程始于验证问题陈述，我们发现其科学上合理、适定且完整。因此，我们可以继续进行推导和求解。\n\n这个问题的基础是微分散射截面。对于第一次玻恩近似中的屏蔽库仑势，它与 $(q^2 + q_s^2)^{-2}$ 成正比。载流子散射到立体角元 $d\\Omega$ 的概率 $dP$ 与微分截面 $\\frac{d\\sigma}{d\\Omega}$ 成正比：\n$$ dP \\propto \\frac{d\\sigma}{d\\Omega} d\\Omega \\propto (q^2 + q_s^2)^{-2} d\\Omega $$\n球坐标中的立体角元是 $d\\Omega = \\sin\\theta \\, d\\theta \\, d\\phi$，其中 $\\theta \\in [0, \\pi]$ 是极角，$\\phi \\in [0, 2\\pi)$ 是方位角。弹性散射的动量转移矢量大小由 $q = 2 k \\sin(\\theta/2)$ 给出，其中 $k$ 是载流子波矢的大小。\n\n代入这些表达式，概率分布为：\n$$ dP(\\theta, \\phi) \\propto \\left( (2k \\sin(\\theta/2))^2 + q_s^2 \\right)^{-2} \\sin\\theta \\, d\\theta \\, d\\phi $$\n由于该表达式不依赖于方位角 $\\phi$，我们可以通过对 $\\phi \\in [0, 2\\pi)$ 进行积分来找到 $\\theta$ 的概率分布。这个积分产生一个因子 $2\\pi$，它是一个常数，可以被吸收到比例常数中。因此，极角 $\\theta$ 的概率密度函数（PDF），记为 $f(\\theta)$，由下式给出：\n$$ f(\\theta) \\propto \\left( 4k^2 \\sin^2(\\theta/2) + q_s^2 \\right)^{-2} \\sin\\theta $$\n\n下一步是推导累积分布函数（CDF）$C(\\theta)$，即 PDF 从 $0$ 到 $\\theta$ 的归一化积分：\n$$ C(\\theta) = \\frac{\\int_0^\\theta f(\\theta') \\, d\\theta'}{\\int_0^\\pi f(\\theta') \\, d\\theta'} = \\frac{\\int_0^\\theta \\left( 4k^2 \\sin^2(\\theta'/2) + q_s^2 \\right)^{-2} \\sin\\theta' \\, d\\theta'}{\\int_0^\\pi \\left( 4k^2 \\sin^2(\\theta'/2) + q_s^2 \\right)^{-2} \\sin\\theta' \\, d\\theta'} $$\n为了计算这些积分，我们进行换元。令 $v = \\sin^2(\\theta'/2)$。其微分为 $dv = \\sin(\\theta'/2)\\cos(\\theta'/2) \\, d\\theta' = \\frac{1}{2}\\sin\\theta' \\, d\\theta'$。因此，$\\sin\\theta' \\, d\\theta' = 2 \\, dv$。$\\theta'$ 从 $0$ 到 $\\theta$ 的积分限对应于 $v$ 从 $\\sin^2(0) = 0$ 到 $\\sin^2(\\theta/2)$。\n\n令 $I(\\theta)$ 为分子中未归一化的累积积分：\n$$ I(\\theta) = \\int_0^{\\sin^2(\\theta/2)} \\left( 4k^2 v + q_s^2 \\right)^{-2} 2 \\, dv $$\n这是一个标准积分。令 $w = 4k^2 v + q_s^2$，则 $dw = 4k^2 dv$。\n$$ I(\\theta) = 2 \\int_{v=0}^{v=\\sin^2(\\theta/2)} w^{-2} \\frac{dw}{4k^2} = \\frac{1}{2k^2} \\left[ -w^{-1} \\right]_{v=0}^{v=\\sin^2(\\theta/2)} $$\n$$ I(\\theta) = \\frac{1}{2k^2} \\left[ -\\frac{1}{4k^2 v + q_s^2} \\right]_0^{\\sin^2(\\theta/2)} = \\frac{1}{2k^2} \\left( -\\frac{1}{4k^2 \\sin^2(\\theta/2) + q_s^2} - (-\\frac{1}{q_s^2}) \\right) $$\n$$ I(\\theta) = \\frac{1}{2k^2} \\left( \\frac{1}{q_s^2} - \\frac{1}{4k^2 \\sin^2(\\theta/2) + q_s^2} \\right) $$\n简化括号中的表达式：\n$$ I(\\theta) = \\frac{1}{2k^2} \\left( \\frac{4k^2 \\sin^2(\\theta/2)}{q_s^2 (4k^2 \\sin^2(\\theta/2) + q_s^2)} \\right) = \\frac{2\\sin^2(\\theta/2)}{q_s^2 (4k^2 \\sin^2(\\theta/2) + q_s^2)} $$\n\n归一化常数是总积分 $I(\\pi)$。当 $\\theta' = \\pi$ 时，我们有 $\\sin^2(\\pi/2) = 1$：\n$$ I(\\pi) = \\frac{2(1)}{q_s^2 (4k^2 (1) + q_s^2)} = \\frac{2}{q_s^2(4k^2 + q_s^2)} $$\nCDF 是比率 $C(\\theta) = I(\\theta) / I(\\pi)$：\n$$ C(\\theta) = \\frac{\\frac{2\\sin^2(\\theta/2)}{q_s^2 (4k^2 \\sin^2(\\theta/2) + q_s^2)}}{\\frac{2}{q_s^2(4k^2 + q_s^2)}} = \\sin^2(\\theta/2) \\frac{4k^2 + q_s^2}{4k^2 \\sin^2(\\theta/2) + q_s^2} $$\n作为检验，$C(0) = 0$ 且 $C(\\pi) = 1 \\cdot \\frac{4k^2+q_s^2}{4k^2+q_s^2} = 1$，符合要求。\n\n推导的最后一步是对此函数求逆，以便用于逆变换采样。我们设 $u = C(\\theta)$，其中 $u$ 是来自均匀分布 $U[0,1]$ 的随机变量，然后求解 $\\theta$。为清晰起见，令 $S = \\sin^2(\\theta/2)$。\n$$ u = S \\frac{4k^2 + q_s^2}{4k^2 S + q_s^2} $$\n$$ u(4k^2 S + q_s^2) = S(4k^2 + q_s^2) $$\n$$ 4k^2 u S + u q_s^2 = 4k^2 S + S q_s^2 $$\n$$ u q_s^2 = S(4k^2 + q_s^2 - 4k^2 u) = S(4k^2(1-u) + q_s^2) $$\n$$ S = \\sin^2(\\theta/2) = \\frac{u q_s^2}{4k^2(1-u) + q_s^2} $$\n为了得到一个更紧凑且数值上更有利的形式，我们可以将分子和分母同除以 $q_s^2$，并引入无量纲参数 $\\beta = (2k/q_s)^2 = 4k^2/q_s^2$：\n$$ \\sin^2(\\theta/2) = \\frac{u}{(4k^2/q_s^2)(1-u)+1} = \\frac{u}{1+\\beta(1-u)} $$\n由于 $\\theta \\in [0, \\pi]$，所以 $\\theta/2 \\in [0, \\pi/2]$，且 $\\sin(\\theta/2)$ 是非负的。我们可以取平方根，然后取反正弦：\n$$ \\sin(\\theta/2) = \\sqrt{\\frac{u}{1+\\beta(1-u)}} $$\n$$ \\theta(u; k, q_s) = 2 \\arcsin\\left(\\sqrt{\\frac{u}{1+\\beta(1-u)}}\\right) $$\n这就是所求的闭式反演公式。\n\n对于算法设计而言，这个公式是数值稳定的。当 $u \\to 0$ 时，$\\theta \\to 0$；当 $u \\to 1$ 时，$\\theta \\to \\pi$。对于 $u \\in (0,1)$，平方根的参数严格介于 $0$ 和 $1$ 之间，确保了 $\\arcsin$ 函数是良定义的。实现将直接使用此公式。将使用 `numpy` 库提供的矢量化操作来高效地为 $u$ 值列表计算角度。为了形式上的正确性，对 $u=0$ 和 $u=1$ 进行了特殊处理，尽管该公式在这些极限处是鲁棒的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n\n    def calculate_theta(k, qs, u_values):\n        \"\"\"\n        Calculates the polar scattering angle theta for ionized impurity scattering\n        using the derived inverse CDF formula.\n\n        Args:\n            k (float): The magnitude of the incident wavevector in m^-1.\n            qs (float): The screening wavevector in m^-1.\n            u_values (list): A list of uniform random variates in [0, 1].\n\n        Returns:\n            list: A list of calculated theta values in radians.\n        \"\"\"\n        # Convert input list to a numpy array for vectorized calculations.\n        # Use np.float64 for high precision, important for values close to 0 or 1.\n        u_values = np.array(u_values, dtype=np.float64)\n\n        if qs == 0.0:\n            # The derivation assumes a screened potential (qs > 0). The unscreened case\n            # (Rutherford scattering, qs = 0) has a divergent total cross section.\n            raise ValueError(\"Screening wavevector qs must be positive.\")\n\n        # Calculate the dimensionless parameter beta = (2k/qs)^2.\n        # This form is numerically stable.\n        beta = (2.0 * k / qs)**2\n\n        # The inversion formula is theta = 2 * arcsin(sqrt(u / (1 + beta * (1 - u)))).\n        # We can implement this for all u values at once.\n        # np.ones_like ensures that 1-u is calculated with high precision where u is close to 1.\n        one_minus_u = np.ones_like(u_values) - u_values\n        \n        # Denominator of the argument of the square root\n        denominator = 1.0 + beta * one_minus_u\n        \n        # The argument inside the square root\n        sqrt_arg = u_values / denominator\n\n        # While mathematically sqrt_arg should be in [0, 1], floating point\n        # arithmetic could produce values slightly outside this range.\n        # np.clip ensures the argument for np.sqrt is non-negative.\n        sqrt_arg = np.clip(sqrt_arg, 0.0, 1.0)\n\n        # Calculate theta values\n        theta_values = 2.0 * np.arcsin(np.sqrt(sqrt_arg))\n\n        return theta_values.tolist()\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\"k\": 1.0e9, \"qs\": 5.0e8, \"u\": [0.0, 0.25, 0.5, 0.75, 1.0]},\n        {\"k\": 1.0e10, \"qs\": 1.0e8, \"u\": [1.0e-12, 1.0e-6, 0.1, 0.9, 0.999999999999]},\n        {\"k\": 1.0e8, \"qs\": 1.0e11, \"u\": [0.2, 0.4, 0.6, 0.8]},\n    ]\n    \n    all_results = []\n    for case in test_cases:\n        k_val = case[\"k\"]\n        qs_val = case[\"qs\"]\n        u_vals = case[\"u\"]\n        \n        theta_results = calculate_theta(k_val, qs_val, u_vals)\n        all_results.append(theta_results)\n\n    # Format the final output string according to the specified format:\n    # [[theta_1,1,...],[theta_2,1,...],...]\n    # without extra spaces.\n    inner_lists_str = []\n    for res_list in all_results:\n        # Convert each float in the list to its string representation\n        # and join with commas.\n        inner_str = \",\".join(map(str, res_list))\n        inner_lists_str.append(f\"[{inner_str}]\")\n    \n    final_output_str = f\"[{','.join(inner_lists_str)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}