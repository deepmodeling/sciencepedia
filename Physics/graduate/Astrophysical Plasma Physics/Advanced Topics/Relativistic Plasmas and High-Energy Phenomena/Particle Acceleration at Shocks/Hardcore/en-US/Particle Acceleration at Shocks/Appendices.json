{
    "hands_on_practices": [
        {
            "introduction": "Before we can understand how particles are accelerated, we must first master the fundamental physics of the shock itself. This exercise  grounds your understanding in the Rankine-Hugoniot jump conditions, which are derived from the first principles of mass, momentum, and energy conservation. By deriving the relationships between upstream and downstream plasma properties, you will build a solid foundation for analyzing the environment where diffusive shock acceleration operates.",
            "id": "4222705",
            "problem": "A steady, plane-parallel, nonradiative collisionless shock propagates into a weakly magnetized astrophysical plasma in which the magnetic field is dynamically negligible for the jump conditions. Treat the plasma as a single-component ideal monatomic gas with adiabatic index $\\gamma$, and assume the upstream state (region $1$) is uniform with mass density $\\rho_{1}$, pressure $P_{1}$, and bulk flow speed $u_{1}$ in the shock frame. The downstream state (region $2$) has density $\\rho_{2}$, pressure $P_{2}$, and flow speed $u_{2}$. Define the upstream sonic Mach number as $M_{1} \\equiv u_{1}/c_{s1}$ with $c_{s1}^{2} = \\gamma P_{1}/\\rho_{1}$, the compression ratio as $r \\equiv \\rho_{2}/\\rho_{1}$, and the temperature ratio as $T_{2}/T_{1}$, with $P = n k_{B} T$ and $n$ the number density.\n\nStarting only from conservation of mass, momentum, and energy across the shock and the ideal-gas equation of state, derive expressions for the compression ratio $r$ and the temperature ratio $T_{2}/T_{1}$ as functions of $\\gamma$ and $M_{1}$. Then evaluate these expressions for a nonradiative shock with $\\gamma = 5/3$ and $M_{1} = 20$.\n\nExpress both $r$ and $T_{2}/T_{1}$ as dimensionless numbers and round your answers to six significant figures.",
            "solution": "The problem is to derive the compression ratio $r$ and temperature ratio $T_2/T_1$ for a steady, plane-parallel shock from the fundamental conservation laws of fluid dynamics, and then to evaluate these quantities for specific given parameters. The plasma is treated as an ideal monatomic gas. The derivation starts from the Rankine-Hugoniot jump conditions, which express the conservation of mass, momentum, and energy across the shock front.\n\nLet the upstream state be denoted by subscript $1$ and the downstream state by subscript $2$. In the rest frame of the shock, the conservation laws are:\n$1$. Conservation of mass flux:\n$$ \\rho_1 u_1 = \\rho_2 u_2 $$\n$2$. Conservation of momentum flux:\n$$ P_1 + \\rho_1 u_1^2 = P_2 + \\rho_2 u_2^2 $$\n$3$. Conservation of energy flux:\n$$ \\frac{1}{2} u_1^2 + h_1 = \\frac{1}{2} u_2^2 + h_2 $$\nwhere $\\rho$ is the mass density, $u$ is the fluid speed, $P$ is the pressure, and $h$ is the specific enthalpy. For an ideal gas with adiabatic index $\\gamma$, the specific enthalpy is given by $h = \\frac{\\gamma}{\\gamma-1}\\frac{P}{\\rho}$.\n\nThe problem defines the compression ratio as $r \\equiv \\rho_2 / \\rho_1$. From the mass conservation equation, we can express the downstream velocity $u_2$ in terms of the upstream velocity $u_1$ and the compression ratio $r$:\n$$ u_2 = \\frac{\\rho_1}{\\rho_2} u_1 = \\frac{u_1}{r} $$\n\nNext, we rearrange the momentum conservation equation to solve for the pressure difference:\n$$ P_2 - P_1 = \\rho_1 u_1^2 - \\rho_2 u_2^2 $$\nSubstituting $u_2 = u_1/r$ and $\\rho_2 = r\\rho_1$:\n$$ P_2 - P_1 = \\rho_1 u_1^2 - (r\\rho_1)\\left(\\frac{u_1}{r}\\right)^2 = \\rho_1 u_1^2 - \\frac{\\rho_1 u_1^2}{r} = \\rho_1 u_1^2 \\left(1 - \\frac{1}{r}\\right) $$\nTo express this in terms of the upstream Mach number $M_1 \\equiv u_1 / c_{s1}$, where $c_{s1}^2 = \\gamma P_1 / \\rho_1$, we divide by $P_1$:\n$$ \\frac{P_2}{P_1} - 1 = \\frac{\\rho_1 u_1^2}{P_1} \\left(1 - \\frac{1}{r}\\right) $$\nUsing $c_{s1}^2$, we can write $\\rho_1/P_1 = \\gamma/c_{s1}^2$. Thus, $\\frac{\\rho_1 u_1^2}{P_1} = \\frac{\\gamma u_1^2}{c_{s1}^2} = \\gamma M_1^2$.\nThis gives a relation for the pressure ratio:\n$$ \\frac{P_2}{P_1} = 1 + \\gamma M_1^2 \\left(1 - \\frac{1}{r}\\right) \\quad (*)$$\n\nNow we use the energy conservation equation. Substituting the expression for specific enthalpy:\n$$ \\frac{1}{2} u_1^2 + \\frac{\\gamma}{\\gamma-1}\\frac{P_1}{\\rho_1} = \\frac{1}{2} u_2^2 + \\frac{\\gamma}{\\gamma-1}\\frac{P_2}{\\rho_2} $$\nSubstitute $u_2 = u_1/r$ and $\\rho_2 = r\\rho_1$:\n$$ \\frac{1}{2} u_1^2 + \\frac{\\gamma}{\\gamma-1}\\frac{P_1}{\\rho_1} = \\frac{1}{2} \\frac{u_1^2}{r^2} + \\frac{\\gamma}{\\gamma-1}\\frac{P_2}{r\\rho_1} $$\nTo simplify, we multiply the entire equation by $2\\rho_1$:\n$$ \\rho_1 u_1^2 + \\frac{2\\gamma}{\\gamma-1}P_1 = \\frac{\\rho_1 u_1^2}{r^2} + \\frac{2\\gamma}{(\\gamma-1)r}P_2 $$\nDivide by $P_1$ and substitute $\\rho_1 u_1^2 / P_1 = \\gamma M_1^2$:\n$$ \\gamma M_1^2 + \\frac{2\\gamma}{\\gamma-1} = \\frac{\\gamma M_1^2}{r^2} + \\frac{2\\gamma}{(\\gamma-1)r} \\frac{P_2}{P_1} $$\nDivide by $\\gamma$:\n$$ M_1^2 + \\frac{2}{\\gamma-1} = \\frac{M_1^2}{r^2} + \\frac{2}{r(\\gamma-1)} \\frac{P_2}{P_1} \\quad (**) $$\n\nNow we have a system of two equations, $(*)$ and $(**)$, with two unknowns, $r$ and $P_2/P_1$. We solve for $r$ by substituting the expression for $P_2/P_1$ from $(*)$ into $(**)$:\n$$ M_1^2 + \\frac{2}{\\gamma-1} = \\frac{M_1^2}{r^2} + \\frac{2}{r(\\gamma-1)} \\left[ 1 + \\gamma M_1^2 \\left(1 - \\frac{1}{r}\\right) \\right] $$\n$$ M_1^2 + \\frac{2}{\\gamma-1} = \\frac{M_1^2}{r^2} + \\frac{2}{r(\\gamma-1)} + \\frac{2\\gamma M_1^2}{r(\\gamma-1)} - \\frac{2\\gamma M_1^2}{r^2(\\gamma-1)} $$\nMultiply the entire equation by $r^2(\\gamma-1)$ to clear denominators:\n$$ r^2(\\gamma-1)M_1^2 + 2r^2 = (\\gamma-1)M_1^2 + 2r + 2\\gamma r M_1^2 - 2\\gamma M_1^2 $$\nRearrange this into a quadratic equation of the form $Ar^2 + Br + C = 0$:\n$$ r^2 [(\\gamma-1)M_1^2 + 2] - r[2 + 2\\gamma M_1^2] + [2\\gamma M_1^2 - (\\gamma-1)M_1^2] = 0 $$\n$$ r^2 [(\\gamma-1)M_1^2 + 2] - 2r(1 + \\gamma M_1^2) + (\\gamma+1)M_1^2 = 0 $$\nThis quadratic equation for $r$ has two solutions. One is the trivial \"no-shock\" solution, $r=1$ (i.e., $\\rho_2 = \\rho_1$). We can verify this by substitution:\nFor $r=1$: $[(\\gamma-1)M_1^2 + 2] - [2 + 2\\gamma M_1^2] + (\\gamma+1)M_1^2 = (\\gamma-1-2\\gamma+\\gamma+1)M_1^2 + (2-2) = 0$.\nSince $r=1$ is a root, we can find the other root, which corresponds to the physical shock solution, using the property that for a quadratic $Ax^2+Bx+C=0$ with roots $x_1, x_2$, the product of roots is $x_1 x_2 = C/A$.\nHere, $1 \\cdot r = C/A$, so the physical compression ratio is:\n$$ r = \\frac{(\\gamma+1)M_1^2}{2 + (\\gamma-1)M_1^2} $$\n\nNext, we derive the temperature ratio $T_2/T_1$. For an ideal gas, the equation of state is $P=nk_BT$, where $n$ is the number density. Since $n = \\rho/m$ where $m$ is the mean particle mass, $P = (\\rho/m)k_B T$. Therefore, $T$ is proportional to $P/\\rho$. The temperature ratio is:\n$$ \\frac{T_2}{T_1} = \\frac{P_2/\\rho_2}{P_1/\\rho_1} = \\frac{P_2}{P_1} \\frac{\\rho_1}{\\rho_2} = \\frac{1}{r}\\frac{P_2}{P_1} $$\nWe use the expression for $P_2/P_1$ from equation $(*)$ and our derived formula for $r$:\n$$ 1 - \\frac{1}{r} = 1 - \\frac{2 + (\\gamma-1)M_1^2}{(\\gamma+1)M_1^2} = \\frac{(\\gamma+1)M_1^2 - 2 - (\\gamma-1)M_1^2}{(\\gamma+1)M_1^2} = \\frac{2M_1^2 - 2}{(\\gamma+1)M_1^2} $$\nSubstituting this into the expression for the pressure ratio:\n$$ \\frac{P_2}{P_1} = 1 + \\gamma M_1^2 \\left( \\frac{2(M_1^2 - 1)}{(\\gamma+1)M_1^2} \\right) = 1 + \\frac{2\\gamma(M_1^2 - 1)}{\\gamma+1} = \\frac{\\gamma+1 + 2\\gamma M_1^2 - 2\\gamma}{\\gamma+1} = \\frac{2\\gamma M_1^2 - (\\gamma-1)}{\\gamma+1} $$\nFinally, we find the temperature ratio:\n$$ \\frac{T_2}{T_1} = \\frac{1}{r} \\frac{P_2}{P_1} = \\left( \\frac{2 + (\\gamma-1)M_1^2}{(\\gamma+1)M_1^2} \\right) \\left( \\frac{2\\gamma M_1^2 - (\\gamma-1)}{\\gamma+1} \\right) $$\n\nNow, we evaluate these expressions for a monatomic gas ($\\gamma = 5/3$) and an upstream Mach number of $M_1=20$.\nFirst, we find the values of constants:\n$\\gamma = 5/3$\n$M_1 = 20 \\implies M_1^2 = 400$\n$\\gamma+1 = 5/3 + 1 = 8/3$\n$\\gamma-1 = 5/3 - 1 = 2/3$\n\nCalculate the compression ratio $r$:\n$$ r = \\frac{(\\frac{8}{3})(400)}{2 + (\\frac{2}{3})(400)} = \\frac{3200/3}{2 + 800/3} = \\frac{3200/3}{(6+800)/3} = \\frac{3200}{806} = \\frac{1600}{403} \\approx 3.9702233... $$\nRounding to six significant figures, $r = 3.97022$.\n\nCalculate the temperature ratio $T_2/T_1$. We first find the pressure ratio $P_2/P_1$:\n$$ \\frac{P_2}{P_1} = \\frac{2(\\frac{5}{3})(400) - (\\frac{2}{3})}{8/3} = \\frac{4000/3 - 2/3}{8/3} = \\frac{3998/3}{8/3} = \\frac{3998}{8} = \\frac{1999}{4} = 499.75 $$\nThen, we find the temperature ratio:\n$$ \\frac{T_2}{T_1} = \\frac{P_2/P_1}{r} = \\frac{1999/4}{1600/403} = \\frac{1999 \\times 403}{4 \\times 1600} = \\frac{805597}{6400} = 125.87453125 $$\nRounding to six significant figures, $T_2/T_1 = 125.875$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 3.97022  125.875 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "A central question in high-energy astrophysics is determining the maximum energy, $E_{\\max}$, to which particles can be accelerated by sources like supernova remnants. This practice  challenges you to apply diffusive shock acceleration theory to estimate this limit by comparing the particle acceleration timescale with the accelerator's age and size. By working through this calculation, you will forge a tangible link between abstract theory and the observable constraints of cosmic accelerators.",
            "id": "4222646",
            "problem": "A young Supernova Remnant (SNR) drives a quasi-parallel collisionless shock with upstream flow speed $u_1$ into a magnetized plasma of upstream magnetic field strength $B$. Consider proton acceleration by diffusive shock acceleration under the Bohm limit. Assume a strong shock with compression ratio $r=4$, isotropic scattering upstream and downstream with equal scalar diffusion coefficients, and treat the protons as ultra-relativistic so that their speed $v \\approx c$ and energy $E \\approx p c$, where $p$ is momentum. Work in Gaussian centimeter–gram–second (cgs) units and adopt $e=4.803204712\\times 10^{-10}\\,\\mathrm{statC}$ and $c=2.99792458\\times 10^{10}\\,\\mathrm{cm\\,s^{-1}}$. The finite accelerator age provides an upper bound by the condition $t_{\\mathrm{acc}}(E) \\le t$, and confinement provides the Hillas bound by the condition $r_g(E) \\le R$, where $R$ is the characteristic size of the accelerator. The Bohm diffusion coefficient is defined by $\\,\\kappa_{\\mathrm{B}}=(1/3)\\,r_g\\,v\\,$ and the relativistic gyroradius is defined by $\\,r_g= p c/(Z e B)\\,$ for charge number $Z$.\n\nStarting from these fundamentals and the standard diffusive shock acceleration framework, derive the age-limited maximum energy $E_{\\mathrm{age}}$ of protons ($Z=1$) as a function of $t$, $u_1$, and $B$ under the Bohm limit, and determine the Hillas confinement limit $E_{\\mathrm{H}}$ using $R\\simeq u_1 t$. Evaluate both for the SNR parameters $t=1000\\,\\mathrm{yr}$, $u_1=5000\\,\\mathrm{km\\,s^{-1}}$, and $B=100\\,\\mu\\mathrm{G}$. Take the effective maximum energy to be the smaller of the two limits, $E_{\\max}=\\min(E_{\\mathrm{age}},E_{\\mathrm{H}})$. Express the final energy in $\\mathrm{eV}$ and round your answer to three significant figures.",
            "solution": "The primary task is to derive the age-limited maximum energy, $E_{\\mathrm{age}}$, and the confinement-limited maximum energy, $E_{\\mathrm{H}}$, for protons accelerated at an SNR shock.\n\n**1. Derivation of the Age-Limited Maximum Energy ($E_{\\mathrm{age}}$)**\n\nThe maximum energy is limited by the age of the accelerator, $t$, through the condition $t_{\\mathrm{acc}}(E_{\\mathrm{age}}) \\le t$. We consider the equality case, $t_{\\mathrm{acc}}(E_{\\mathrm{age}}) = t$. The characteristic acceleration time, $t_{\\mathrm{acc}}$, in the standard DSA framework is given by:\n$$\nt_{\\mathrm{acc}}(E) = \\frac{3}{u_1 - u_2} \\left( \\frac{\\kappa_1}{u_1} + \\frac{\\kappa_2}{u_2} \\right)\n$$\nwhere $u_1$ and $u_2$ are the upstream and downstream flow speeds in the shock frame, and $\\kappa_1$ and $\\kappa_2$ are the diffusion coefficients in the respective regions.\n\nWe are given a strong shock with compression ratio $r = u_1/u_2 = 4$. Thus, $u_2 = u_1/4$. The velocity difference is $u_1 - u_2 = u_1 - u_1/4 = \\frac{3}{4}u_1$.\nWe are also given that the diffusion coefficients are equal, $\\kappa_1 = \\kappa_2 = \\kappa$. Substituting these into the expression for $t_{\\mathrm{acc}}$:\n$$\nt_{\\mathrm{acc}}(E) = \\frac{3}{\\frac{3}{4}u_1} \\left( \\frac{\\kappa}{u_1} + \\frac{\\kappa}{u_1/4} \\right) = \\frac{4}{u_1} \\left( \\frac{\\kappa}{u_1} + \\frac{4\\kappa}{u_1} \\right) = \\frac{4}{u_1} \\left( \\frac{5\\kappa}{u_1} \\right) = \\frac{20\\kappa}{u_1^2}\n$$\nThe problem specifies acceleration under the Bohm limit, where the diffusion coefficient is $\\kappa = \\kappa_{\\mathrm{B}} = \\frac{1}{3}r_g v$. For ultra-relativistic protons, $v \\approx c$. The gyroradius for a proton ($Z=1$) in Gaussian cgs units is given by $r_g = \\frac{pc}{eB}$. Since the protons are ultra-relativistic, $E \\approx pc$, so $r_g = \\frac{E}{eB}$.\nSubstituting these into the expression for $\\kappa$:\n$$\n\\kappa(E) = \\frac{1}{3} \\left(\\frac{E}{eB}\\right) c = \\frac{Ec}{3eB}\n$$\nNow we substitute this energy-dependent diffusion coefficient back into the expression for $t_{\\mathrm{acc}}(E)$:\n$$\nt_{\\mathrm{acc}}(E) = \\frac{20}{u_1^2} \\left(\\frac{Ec}{3eB}\\right) = \\frac{20Ec}{3u_1^2eB}\n$$\nThe age limit is found by setting $t_{\\mathrm{acc}}(E_{\\mathrm{age}}) = t$:\n$$\nt = \\frac{20E_{\\mathrm{age}}c}{3u_1^2eB}\n$$\nSolving for $E_{\\mathrm{age}}$ gives:\n$$\nE_{\\mathrm{age}} = \\frac{3}{20} \\frac{u_1^2 e B t}{c}\n$$\n\n**2. Derivation of the Hillas Confinement Limit ($E_{\\mathrm{H}}$)**\n\nThe Hillas limit is determined by the condition that the particle gyroradius, $r_g$, must be smaller than the characteristic size of the accelerator, $R$. The maximum energy corresponds to the equality $r_g(E_{\\mathrm{H}}) = R$.\nWe are given the relation $R \\simeq u_1 t$. Using the definition of the gyroradius for a relativistic proton, $r_g = E/(eB)$, the Hillas condition becomes:\n$$\n\\frac{E_{\\mathrm{H}}}{eB} = u_1 t\n$$\nSolving for $E_{\\mathrm{H}}$:\n$$\nE_{\\mathrm{H}} = e B u_1 t\n$$\n\n**3. Determination of the Maximum Energy ($E_{\\max}$)**\n\nThe effective maximum energy is the minimum of the two limits: $E_{\\max} = \\min(E_{\\mathrm{age}}, E_{\\mathrm{H}})$. To compare them, we can compute their ratio:\n$$\n\\frac{E_{\\mathrm{age}}}{E_{\\mathrm{H}}} = \\frac{\\frac{3}{20} \\frac{u_1^2 e B t}{c}}{e B u_1 t} = \\frac{3}{20} \\frac{u_1}{c}\n$$\nFor a typical SNR shock, the shock speed $u_1$ is non-relativistic, i.e., $u_1 \\ll c$. Therefore, the ratio $\\frac{u_1}{c}$ is a small number, and $E_{\\mathrm{age}} \\ll E_{\\mathrm{H}}$. The acceleration is limited by the age of the SNR, not by the confinement size.\nThus, $E_{\\max} = E_{\\mathrm{age}}$.\n\n**4. Numerical Evaluation**\n\nWe now evaluate $E_{\\max} = E_{\\mathrm{age}}$ using the provided parameters in cgs units.\nFirst, we convert the parameters to the cgs system:\n- $t = 1000\\,\\mathrm{yr} = 1000 \\times 365.25 \\times 24 \\times 3600\\,\\mathrm{s} = 3.15576 \\times 10^{10}\\,\\mathrm{s}$.\n- $u_1 = 5000\\,\\mathrm{km\\,s^{-1}} = 5000 \\times 10^5\\,\\mathrm{cm\\,s^{-1}} = 5 \\times 10^8\\,\\mathrm{cm\\,s^{-1}}$.\n- $B = 100\\,\\mu\\mathrm{G} = 100 \\times 10^{-6}\\,\\mathrm{G} = 10^{-4}\\,\\mathrm{G}$.\nThe constants are:\n- $e = 4.803204712 \\times 10^{-10}\\,\\mathrm{statC}$.\n- $c = 2.99792458 \\times 10^{10}\\,\\mathrm{cm\\,s^{-1}}$.\n\nWe calculate $E_{\\max}$ in ergs:\n$$\nE_{\\max} = E_{\\mathrm{age}} = \\frac{3}{20} \\frac{u_1^2 e B t}{c}\n$$\n$$\nE_{\\max} = \\frac{3}{20} \\frac{(5 \\times 10^8\\,\\mathrm{cm\\,s^{-1}})^2 (4.8032 \\times 10^{-10}\\,\\mathrm{statC}) (10^{-4}\\,\\mathrm{G}) (3.15576 \\times 10^{10}\\,\\mathrm{s})}{2.99792458 \\times 10^{10}\\,\\mathrm{cm\\,s^{-1}}}\n$$\n$$\nE_{\\max} = \\frac{0.15 \\times (25 \\times 10^{16}) \\times (4.8032 \\times 10^{-10}) \\times (10^{-4}) \\times (3.15576 \\times 10^{10})}{2.99792458 \\times 10^{10}}\\,\\mathrm{erg}\n$$\n$$\nE_{\\max} \\approx 1.8959 \\times 10^{-3}\\,\\mathrm{erg}\n$$\nFinally, we convert this energy from ergs to electron-volts ($\\mathrm{eV}$). The conversion factor is $1\\,\\mathrm{eV} = 1.602176634 \\times 10^{-12}\\,\\mathrm{erg}$.\n$$\nE_{\\max}(\\mathrm{eV}) = \\frac{1.8959 \\times 10^{-3}\\,\\mathrm{erg}}{1.602176634 \\times 10^{-12}\\,\\mathrm{erg/eV}}\n$$\n$$\nE_{\\max}(\\mathrm{eV}) \\approx 1.1833 \\times 10^{15}\\,\\mathrm{eV}\n$$\nThe problem requires the answer to be rounded to three significant figures.\n$$\nE_{\\max} \\approx 1.18 \\times 10^{15}\\,\\mathrm{eV}\n$$",
            "answer": "$$\n\\boxed{1.18 \\times 10^{15}}\n$$"
        },
        {
            "introduction": "The standard \"test-particle\" theory assumes that accelerated particles have no effect on the shock structure. In reality, an efficient accelerator's structure is modified by the very particles it accelerates. This advanced exercise  introduces you to the realm of nonlinear diffusive shock acceleration (NLDSA), where you will model this feedback and explore one of its key predictions: a concave particle spectrum that flattens at high energy. This practice bridges the gap from textbook theory to topics in current research, highlighting the complex feedback loops that govern the most powerful astrophysical accelerators.",
            "id": "4222680",
            "problem": "Consider a one-dimensional, nonrelativistic collisionless shock with upstream flow speed $u_1$ and downstream flow speed $u_2$ in the shock frame. Assume diffusive shock acceleration with isotropic pitch-angle scattering in each local fluid frame, so that particle distributions are nearly isotropic. Using conservation of particle number and the mean energy gain per shock-crossing cycle, derive the momentum-space spectral index $q(r)$ of the steady-state isotropic part of the phase-space distribution $f(p) \\propto p^{-q}$ as a function of the compression ratio $r \\equiv u_1/u_2$, without assuming any particular numerical value of $r$.\n\nTo model nonlinear shock modification by accelerated particles, let higher-momentum particles sample a larger effective compression ratio because their diffusion length increases with momentum. Represent this by a monotonic mapping from momentum $p$ to an effective compression ratio\n$$\nr_{\\mathrm{eff}}(p) \\equiv r_{\\mathrm{sub}} + \\bigl(r_{\\mathrm{tot}} - r_{\\mathrm{sub}}\\bigr)\\,W(p),\n$$\nwhere $r_{\\mathrm{sub}}$ is the subshock compression ratio, $r_{\\mathrm{tot}}$ is the total compression ratio across the entire shock including the cosmic-ray precursor, and $W(p)$ is an increasing sampling weight that satisfies $W(0)=0$ and $\\lim_{p\\to\\infty} W(p)=1$. Adopt the following explicit, physically motivated choice based on a diffusion length that grows with momentum:\n$$\nW(p) \\equiv 1 - \\exp\\!\\left[-\\left(\\frac{p}{p_c}\\right)^{\\alpha}\\right],\n$$\nwhere $p_c$ sets the transition scale in momentum where particles begin to significantly sample the precursor, and $\\alpha0$ controls the sharpness of the transition. All momenta are dimensionless, measured in units of a fixed reference momentum, so no physical units are required.\n\nYour task is to:\n- Derive $q(r)$ starting from first principles that connect the mean fractional momentum gain per cycle and the escape probability per cycle to a steady-state power-law.\n- Using the derived $q(r)$, define $q(p) \\equiv q\\!\\bigl(r_{\\mathrm{eff}}(p)\\bigr)$ and compute $q(p)$ at two diagnostic momenta $p_{\\mathrm{low}} \\equiv 10^{-3} p_c$ and $p_{\\mathrm{high}} \\equiv 10^{3} p_c$ for each parameter set below.\n- For each parameter set, return the list $[q_{\\mathrm{low}}, q_{\\mathrm{high}}, \\Delta]$, where $q_{\\mathrm{low}} \\equiv q(p_{\\mathrm{low}})$, $q_{\\mathrm{high}} \\equiv q(p_{\\mathrm{high}})$, and $\\Delta \\equiv q_{\\mathrm{low}} - q_{\\mathrm{high}}$. A concave spectrum that flattens at high momentum corresponds to $\\Delta  0$.\n- Round each reported floating-point value to six decimal places.\n\nTest suite parameter sets:\n- Case A (a representative nonlinear shock): $(r_{\\mathrm{sub}}, r_{\\mathrm{tot}}, p_c, \\alpha) = (3.5, 6.0, 1.0, 1.0)$.\n- Case B (no nonlinear modification; boundary case): $(r_{\\mathrm{sub}}, r_{\\mathrm{tot}}, p_c, \\alpha) = (4.0, 4.0, 1.0, 1.0)$.\n- Case C (stronger total compression and sharper transition): $(r_{\\mathrm{sub}}, r_{\\mathrm{tot}}, p_c, \\alpha) = (3.2, 7.0, 1.0, 2.0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes its own three-element list, for example: $[[q_{\\mathrm{low},A}, q_{\\mathrm{high},A}, \\Delta_A],[q_{\\mathrm{low},B}, q_{\\mathrm{high},B}, \\Delta_B],[q_{\\mathrm{low},C}, q_{\\mathrm{high},C}, \\Delta_C]]$. No additional text should be printed.",
            "solution": "The solution proceeds in three parts. First, we derive the general formula for the momentum spectral index $q$ as a function of the shock compression ratio $r$. Second, we apply this formula to the provided nonlinear shock model where the effective compression ratio is momentum-dependent. Third, we compute the required numerical values for the given test cases.\n\n**Part 1: Derivation of the Spectral Index $q(r)$**\n\nWe consider a population of energetic particles interacting with a one-dimensional, non-relativistic shock. The particles are assumed to scatter isotropically in the local fluid frames both upstream (region $1$) and downstream (region $2$). The flow speeds in the shock rest frame are $u_1$ and $u_2$, respectively. We seek to find the spectral index $q$ of the steady-state, isotropic part of the phase-space distribution function, $f(p) \\propto p^{-q}$.\n\nThe steady-state power-law spectrum arises from a balance between the average energy (or momentum) gain per shock-crossing cycle and the probability of a particle being lost from the acceleration process.\n\n1.  **Mean Fractional Momentum Gain per Cycle**: For a particle with speed $v$ undergoing isotropic scattering, the average fractional momentum gain per cycle, $\\langle \\Delta p / p \\rangle$, is a standard result from diffusive shock acceleration (DSA) theory. It is given by\n    $$\n    \\left\\langle \\frac{\\Delta p}{p} \\right\\rangle = \\frac{4}{3} \\frac{u_1 - u_2}{v}\n    $$\n    This gain results from the particle effectively undergoing a head-on collision with the converging scattering centers across the shock.\n\n2.  **Escape Probability per Cycle**: Particles are advected away from the shock with the downstream flow. The flux of particles advected downstream is proportional to $n_2 u_2$, where $n_2$ is the particle number density. The flux of particles returning to the shock from downstream is proportional to $n_2 v / 4$ for an isotropic distribution. The probability of escape per shock encounter from downstream, $P_{esc, d}$, is the ratio of the advective flux to the random flux, which is $P_{esc, d} \\propto u_2 / v$. A full cycle involves one downstream-to-upstream crossing. The probability of escape per cycle, $P_{esc}$, is thus\n    $$\n    P_{\\mathrm{esc}} = \\frac{4 u_2}{v}\n    $$\n\n3.  **Formation of the Power-Law Spectrum**: Let's consider a set of $N_0$ particles injected with momentum $p_0$. After one cycle, the remaining number of particles is $N_1 = N_0(1 - P_{\\mathrm{esc}})$, and their average momentum is $p_1 = p_0(1 + \\langle \\Delta p / p \\rangle)$. After $k$ cycles, we have:\n    $$\n    N(k) = N_0(1 - P_{\\mathrm{esc}})^k\n    $$\n    $$\n    p(k) \\approx p_0 \\left(1 + \\left\\langle \\frac{\\Delta p}{p} \\right\\rangle \\right)^k\n    $$\n    Taking the natural logarithm of both equations and assuming $P_{\\mathrm{esc}} \\ll 1$ and $\\langle \\Delta p / p \\rangle \\ll 1$:\n    $$\n    \\ln\\left(\\frac{N(k)}{N_0}\\right) = k \\ln(1 - P_{\\mathrm{esc}}) \\approx -k P_{\\mathrm{esc}}\n    $$\n    $$\n    \\ln\\left(\\frac{p(k)}{p_0}\\right) = k \\ln\\left(1 + \\left\\langle \\frac{\\Delta p}{p} \\right\\rangle\\right) \\approx k \\left\\langle \\frac{\\Delta p}{p} \\right\\rangle\n    $$\n    From the second equation, we find the number of cycles $k$ to reach momentum $p$ is $k \\approx \\ln(p/p_0) / \\langle \\Delta p / p \\rangle$. Substituting this into the first equation:\n    $$\n    \\ln\\left(\\frac{N}{N_0}\\right) \\approx - \\frac{P_{\\mathrm{esc}}}{\\langle \\Delta p / p \\rangle} \\ln\\left(\\frac{p}{p_0}\\right)\n    $$\n    This gives the integral spectrum: $N(p)$, the number of particles with momentum greater than $p$, is\n    $$\n    N(p) \\propto p^{-\\gamma} \\quad \\text{where} \\quad \\gamma = \\frac{P_{\\mathrm{esc}}}{\\langle \\Delta p / p \\rangle}\n    $$\n    The differential number spectrum, $N(p)$, is the number of particles per unit momentum, $N(p) = -dN(p)/dp \\propto p^{-(\\gamma+1)}$. The phase-space distribution function $f(p)$ is related to $N(p)$ by $N(p)dp = 4\\pi p^2 f(p) dp$. Therefore, $f(p) \\propto p^{-2}N(p) \\propto p^{-(\\gamma+3)}$.\n    The problem defines the spectral index $q$ via $f(p) \\propto p^{-q}$. Thus, we have:\n    $$\n    q = \\gamma + 3 = 3 + \\frac{P_{\\mathrm{esc}}}{\\langle \\Delta p / p \\rangle}\n    $$\n    Substituting the expressions for $P_{\\mathrm{esc}}$ and $\\langle \\Delta p / p \\rangle$:\n    $$\n    q = 3 + \\frac{4 u_2 / v}{\\frac{4}{3}(u_1 - u_2) / v} = 3 + \\frac{3 u_2}{u_1 - u_2} = 3\\left(1 + \\frac{u_2}{u_1 - u_2}\\right) = 3\\left(\\frac{u_1 - u_2 + u_2}{u_1 - u_2}\\right) = \\frac{3u_1}{u_1-u_2}\n    $$\n    Finally, expressing $q$ in terms of the compression ratio $r \\equiv u_1/u_2$:\n    $$\n    q(r) = \\frac{3 u_1}{u_1 - u_1/r} = \\frac{3}{1 - 1/r} = \\frac{3r}{r-1}\n    $$\n    This is the desired relationship between the spectral index and the shock compression ratio. For the canonical strong shock value of $r=4$, this gives $q = 3(4)/(4-1) = 4$.\n\n**Part 2: Application to the Nonlinear Shock Model**\n\nThe problem introduces a model for nonlinear shock modification where the effective compression ratio, $r_{\\mathrm{eff}}$, depends on particle momentum $p$. This reflects the fact that higher-energy particles have larger diffusion lengths and can sample the full velocity transition of the shock, including the smooth precursor, while low-energy particles only experience the sharp subshock.\n\nThe spectral index becomes a function of momentum, $q(p)$, by substituting $r_{\\mathrm{eff}}(p)$ for $r$ in the derived formula:\n$$\nq(p) \\equiv q(r_{\\mathrm{eff}}(p)) = \\frac{3 r_{\\mathrm{eff}}(p)}{r_{\\mathrm{eff}}(p) - 1}\n$$\nThe effective compression ratio is given by:\n$$\nr_{\\mathrm{eff}}(p) = r_{\\mathrm{sub}} + (r_{\\mathrm{tot}} - r_{\\mathrm{sub}})W(p)\n$$\nwith the weighting function:\n$$\nW(p) = 1 - \\exp\\left[-\\left(\\frac{p}{p_c}\\right)^{\\alpha}\\right]\n$$\nHere, $r_{\\mathrm{sub}}$ is the compression ratio of the subshock seen by low-momentum particles, and $r_{\\mathrm{tot}}$ is the total compression ratio across the entire shock structure seen by high-momentum particles. The function $W(p)$ smoothly transitions from $W(p) \\approx 0$ for $p \\ll p_c$ to $W(p) \\approx 1$ for $p \\gg p_c$. Consequently, $r_{\\mathrm{eff}}(p)$ transitions from $r_{\\mathrm{sub}}$ to $r_{\\mathrm{tot}}$ as $p$ increases. This leads to a spectral index $q(p)$ that changes with momentum, resulting in a curved (concave) spectrum.\n\n**Part 3: Numerical Computations**\n\nWe are tasked to compute $q_{\\mathrm{low}} \\equiv q(p_{\\mathrm{low}})$, $q_{\\mathrm{high}} \\equiv q(p_{\\mathrm{high}})$, and $\\Delta \\equiv q_{\\mathrm{low}} - q_{\\mathrm{high}}$ for $p_{\\mathrm{low}} = 10^{-3}p_c$ and $p_{\\mathrm{high}} = 10^{3}p_c$. This requires evaluating $r_{\\mathrm{eff}}(p)$ at $p/p_c = 10^{-3}$ and $p/p_c = 10^{3}$.\n\n**Case A:** $(r_{\\mathrm{sub}}, r_{\\mathrm{tot}}, p_c, \\alpha) = (3.5, 6.0, 1.0, 1.0)$\n- At $p_{\\mathrm{low}}/p_c = 10^{-3}$:\n  $W(p_{\\mathrm{low}}) = 1 - \\exp[-(10^{-3})^1] = 1 - e^{-0.001}$\n  $r_{\\mathrm{eff}}(p_{\\mathrm{low}}) = 3.5 + (6.0 - 3.5)(1 - e^{-0.001}) = 3.5 + 2.5(1 - e^{-0.001}) \\approx 3.50249875$\n  $q_{\\mathrm{low}} = \\frac{3 \\times 3.50249875}{3.50249875 - 1} \\approx 4.198803$\n- At $p_{\\mathrm{high}}/p_c = 10^{3}$:\n  $W(p_{\\mathrm{high}}) = 1 - \\exp[-(10^{3})^1] = 1 - e^{-1000} \\approx 1$\n  $r_{\\mathrm{eff}}(p_{\\mathrm{high}}) \\approx 3.5 + 2.5(1) = 6.0$\n  $q_{\\mathrm{high}} = \\frac{3 \\times 6.0}{6.0 - 1} = \\frac{18}{5} = 3.6$\n- $\\Delta = 4.198803 - 3.600000 = 0.598803$.\n- Result A: $[4.198803, 3.600000, 0.598803]$\n\n**Case B:** $(r_{\\mathrm{sub}}, r_{\\mathrm{tot}}, p_c, \\alpha) = (4.0, 4.0, 1.0, 1.0)$\n- Here, $r_{\\mathrm{sub}} = r_{\\mathrm{tot}} = 4.0$. The term $(r_{\\mathrm{tot}} - r_{\\mathrm{sub}}) = 0$.\n- $r_{\\mathrm{eff}}(p) = 4.0 + (0)W(p) = 4.0$ for all $p$. This represents a standard linear shock with no nonlinear modification.\n- $q_{\\mathrm{low}} = \\frac{3 \\times 4.0}{4.0 - 1} = 4.0$\n- $q_{\\mathrm{high}} = \\frac{3 \\times 4.0}{4.0 - 1} = 4.0$\n- $\\Delta = 4.0 - 4.0 = 0.0$\n- Result B: $[4.000000, 4.000000, 0.000000]$\n\n**Case C:** $(r_{\\mathrm{sub}}, r_{\\mathrm{tot}}, p_c, \\alpha) = (3.2, 7.0, 1.0, 2.0)$\n- At $p_{\\mathrm{low}}/p_c = 10^{-3}$:\n  $W(p_{\\mathrm{low}}) = 1 - \\exp[-(10^{-3})^2] = 1 - e^{-10^{-6}}$\n  $r_{\\mathrm{eff}}(p_{\\mathrm{low}}) = 3.2 + (7.0 - 3.2)(1 - e^{-10^{-6}}) = 3.2 + 3.8(1 - e^{-10^{-6}}) \\approx 3.2000038$\n  $q_{\\mathrm{low}} = \\frac{3 \\times 3.2000038}{3.2000038 - 1} \\approx 4.363631$\n- At $p_{\\mathrm{high}}/p_c = 10^{3}$:\n  $W(p_{\\mathrm{high}}) = 1 - \\exp[-(10^{3})^2] = 1 - e^{-10^{6}} \\approx 1$\n  $r_{\\mathrm{eff}}(p_{\\mathrm{high}}) \\approx 3.2 + 3.8(1) = 7.0$\n  $q_{\\mathrm{high}} = \\frac{3 \\times 7.0}{7.0 - 1} = \\frac{21}{6} = 3.5$\n- $\\Delta = 4.363631 - 3.500000 = 0.863631$\n- Result C: $[4.363631, 3.500000, 0.863631]$\n\nThe positive value of $\\Delta$ in cases A and C signifies a concave spectrum, where the spectral index $q(p)$ decreases as momentum $p$ increases, leading to a spectrum that is steeper ($f(p)$ falls off faster) at low $p$ and flatter at high $p$. This is the characteristic signature of efficient particle acceleration in nonlinearly modified shocks.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes momentum-dependent spectral indices for a nonlinear shock model.\n\n    This function calculates the spectral index q(p) at low and high momenta\n    for several test cases of a diffusive shock acceleration model with nonlinear\n    modifications. The model uses a momentum-dependent effective compression\n    ratio.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains: (r_sub, r_tot, p_c, alpha)\n    test_cases = [\n        (3.5, 6.0, 1.0, 1.0),  # Case A\n        (4.0, 4.0, 1.0, 1.0),  # Case B\n        (3.2, 7.0, 1.0, 2.0),  # Case C\n    ]\n\n    # Diagnostic momentum ratios\n    p_over_pc_low = 1e-3\n    p_over_pc_high = 1e3\n    \n    # Store results for all cases\n    all_results = []\n\n    def calculate_q(p_over_pc, r_sub, r_tot, alpha):\n        \"\"\"\n        Calculates the spectral index q for a given set of parameters.\n\n        Args:\n            p_over_pc (float): The momentum ratio p/p_c.\n            r_sub (float): The subshock compression ratio.\n            r_tot (float): The total compression ratio.\n            alpha (float): The transition sharpness parameter.\n\n        Returns:\n            float: The spectral index q.\n        \"\"\"\n        # Calculate the weighting function W(p)\n        W_p = 1.0 - np.exp(-(p_over_pc**alpha))\n        \n        # Calculate the effective compression ratio r_eff(p)\n        r_eff = r_sub + (r_tot - r_sub) * W_p\n        \n        # Check for r_eff == 1, which leads to division by zero.\n        # Given the problem constraints (r_sub  1), this should not happen.\n        if r_eff = 1.0:\n            return np.inf\n            \n        # Calculate the spectral index q(r_eff)\n        q_val = (3.0 * r_eff) / (r_eff - 1.0)\n        \n        return q_val\n\n    for case in test_cases:\n        r_sub, r_tot, p_c, alpha = case\n\n        # Calculate q at low momentum\n        q_low = calculate_q(p_over_pc_low, r_sub, r_tot, alpha)\n\n        # Calculate q at high momentum\n        q_high = calculate_q(p_over_pc_high, r_sub, r_tot, alpha)\n\n        # Calculate the difference delta\n        delta = q_low - q_high\n        \n        # Round the results to six decimal places\n        q_low_rounded = round(q_low, 6)\n        q_high_rounded = round(q_high, 6)\n        delta_rounded = round(delta, 6)\n        \n        # Store the triplet of results for the current case\n        all_results.append([q_low_rounded, q_high_rounded, delta_rounded])\n\n    # Final print statement in the exact required format.\n    # The str() representation of a list is '[item1, item2, ...]' which matches\n    # the format needed for each sub-list.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}