{
    "hands_on_practices": [
        {
            "introduction": "正如前一个练习所揭示的，对于天体物理中常见的高伦德奎斯特数（$S$）等离子体，Sweet-Parker模型预测的重联过程过于缓慢。本练习探讨了一个关键的后续发展：等离子体团不稳定性，它解释了系统如何向更快的重联机制过渡。你将计算一个电流片是否会变得不稳定，并确定其在不稳定性发生时的厚度，从而深入了解自然界是如何打破缓慢的Sweet-Parker电流片并触发快速重联的。",
            "id": "4220345",
            "problem": "在一个磁场强度为 $B$、质量密度为 $\\rho$、均匀磁扩散率为 $\\eta$ 的类日冕天体物理等离子体中，形成了一个特征半长为 $L$ 的电阻磁流体力学电流片。电阻磁流体力学（MHD）感应方程的形式为 $\\partial \\mathbf{B}/\\partial t = \\nabla \\times (\\mathbf{v} \\times \\mathbf{B}) + \\eta \\nabla^{2} \\mathbf{B}$，其中真空磁导率用 $\\mu_{0}$ 表示。阿尔芬速度定义为 $V_{A} = B/\\sqrt{\\mu_{0}\\rho}$。无量纲伦德奎斯特数 $S$ 表征了在尺度 $L$ 上磁平流与磁扩散的比率。一旦 $S$ 超过临界值 $S_{c}$，Sweet–Parker 电流片就会对等离子体团不稳定性呈线性不稳定，而初始厚度 $\\delta_{\\mathrm{onset}}$ 是在 $S = S_{c}$ 时计算的 Sweet–Parker 厚度。\n\n仅使用这些标准定义和物理定律，对于参数\n$\\eta = 3\\,\\mathrm{m^{2}\\,s^{-1}}$，$L = 5.0 \\times 10^{7}\\,\\mathrm{m}$，$B = 3.0 \\times 10^{-2}\\,\\mathrm{T}$，$\\rho = 3.0 \\times 10^{-12}\\,\\mathrm{kg\\,m^{-3}}$，以及 $\\mu_{0} = 4\\pi \\times 10^{-7}\\,\\mathrm{N\\,A^{-2}}$，\n并假设适用于量级为1的磁普朗特数的临界伦德奎斯特数 $S_{c} = 1.0 \\times 10^{4}$，判断该Sweet-Parker电流片是否对等离子体团不稳定性呈线性不稳定。采用约定：如果 $S > S_{c}$，则不稳定性由 $I=1$ 表示，否则由 $I=0$ 表示。然后，计算预期的初始厚度 $\\delta_{\\mathrm{onset}}$。\n\n将 $\\delta_{\\mathrm{onset}}$ 四舍五入到三位有效数字。以米为单位表示 $\\delta_{\\mathrm{onset}}$。以行矩阵 $\\begin{pmatrix} I  \\delta_{\\mathrm{onset}} \\end{pmatrix}$ 的形式提供您的最终答案。",
            "solution": "首先将验证问题陈述的正确性、一致性和可行性。\n\n### 第1步：提取已知条件\n- **物理量和参数：**\n    - 电流片的特征半长：$L$\n    - 磁场强度：$B$\n    - 质量密度：$\\rho$\n    - 均匀磁扩散率：$\\eta$\n    - 真空磁导率：$\\mu_{0}$\n- **方程和定义：**\n    - 电阻MHD感应方程：$\\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{v} \\times \\mathbf{B}) + \\eta \\nabla^{2} \\mathbf{B}$\n    - 阿尔芬速度：$V_{A} = \\frac{B}{\\sqrt{\\mu_{0}\\rho}}$\n    - 伦德奎斯特数：$S$ 是尺度 $L$ 上磁平流与扩散之比的无量纲数。\n    - 临界伦德奎斯特数：$S_{c}$\n    - 初始厚度：$\\delta_{\\mathrm{onset}}$ 是在 $S=S_c$ 处计算的 Sweet–Parker 厚度。\n- **数值：**\n    - $\\eta = 3\\,\\mathrm{m^{2}\\,s^{-1}}$\n    - $L = 5.0 \\times 10^{7}\\,\\mathrm{m}$\n    - $B = 3.0 \\times 10^{-2}\\,\\mathrm{T}$\n    - $\\rho = 3.0 \\times 10^{-12}\\,\\mathrm{kg\\,m^{-3}}$\n    - $\\mu_{0} = 4\\pi \\times 10^{-7}\\,\\mathrm{N\\,A^{-2}}$\n    - $S_{c} = 1.0 \\times 10^{4}$\n- **条件和任务：**\n    - 不稳定性指标：如果 $S > S_{c}$，则 $I=1$，否则 $I=0$。\n    - 确定 $I$ 的值。\n    - 计算 $\\delta_{\\mathrm{onset}}$ 的值。\n    - 将 $\\delta_{\\mathrm{onset}}$ 四舍五入到三位有效数字。\n    - 以行矩阵 $\\begin{pmatrix} I  \\delta_{\\mathrm{onset}} \\end{pmatrix}$ 的形式表示最终答案。\n\n### 第2步：使用提取的已知条件进行验证\n1.  **科学或事实上的不合理性：** 该问题在科学上是合理的。它基于电阻磁流体力学（MHD）框架，特别是关于磁重联的 Sweet–Parker 模型及随后的等离子体团不稳定性。这些都是天体物理等离子体物理学中标准的、成熟的概念。控制方程和所有定义都是正确的。给定的数值对于日冕等离子体环境是物理上合理的。\n2.  **不完整或矛盾的设置：** 问题对伦德奎斯特数 $S$ 提供了定性描述，并提到了“Sweet–Parker 厚度”，但没有提供明确的公式。然而，问题明确指出要使用“标准定义和物理定律”。在电阻 MHD 和 Sweet-Parker 理论的背景下，伦德奎斯特数通常定义为 $S = L V_{A} / \\eta$，而 Sweet-Parker 电流片厚度为 $\\delta_{\\mathrm{SP}} = L S^{-1/2}$。问题依赖于这种预期的背景知识，对于指定的 STEM 教授背景是合适的，因此不会使其不完整。\n3.  **适定且客观：** 问题是适定的，有明确的目标和足够的参数集，可以为所求量（$I$ 和 $\\delta_{\\mathrm{onset}}$）得出唯一解。语言客观而精确。\n\n### 第3步：结论和行动\n该问题有效。将制定完整的解决方案。\n\n该解决方案需要两个主要计算：首先，确定不稳定性指标 $I$，这需要计算系统的伦德奎斯特数 $S$；其次，计算初始厚度 $\\delta_{\\mathrm{onset}}$。\n\n**1. 确定不稳定性指标 $I$**\n\n如果 $S > S_{c}$，不稳定性指标 $I$ 为 $1$，否则为 $0$。为了找到 $I$，我们必须根据给定的参数计算伦德奎斯特数 $S$。基于特征长度 $L$ 和阿尔芬速度 $V_{A}$ 的全局伦德奎斯特数的标准定义是：\n$$S = \\frac{L V_{A}}{\\eta}$$\n首先，我们使用其定义和提供的值来计算阿尔芬速度 $V_{A}$：\n$$V_{A} = \\frac{B}{\\sqrt{\\mu_{0}\\rho}}$$\n代入给定的数值：\n$$V_{A} = \\frac{3.0 \\times 10^{-2}\\,\\mathrm{T}}{\\sqrt{(4\\pi \\times 10^{-7}\\,\\mathrm{N\\,A^{-2}}) \\times (3.0 \\times 10^{-12}\\,\\mathrm{kg\\,m^{-3}})}}$$\n$$V_{A} = \\frac{3.0 \\times 10^{-2}}{\\sqrt{12\\pi \\times 10^{-19}}} = \\frac{3.0 \\times 10^{-2}}{\\sqrt{3.7699... \\times 10^{-18}}} \\, \\mathrm{m\\,s^{-1}}$$\n$$V_{A} \\approx \\frac{3.0 \\times 10^{-2}}{1.9416... \\times 10^{-9}} \\, \\mathrm{m\\,s^{-1}} \\approx 1.545... \\times 10^{7} \\, \\mathrm{m\\,s^{-1}}$$\n为求精确，我们先计算 $V_A^2$：\n$$V_A^2 = \\frac{B^2}{\\mu_0 \\rho} = \\frac{(3.0 \\times 10^{-2})^2}{(4\\pi \\times 10^{-7})(3.0 \\times 10^{-12})} = \\frac{9.0 \\times 10^{-4}}{12\\pi \\times 10^{-19}} = \\frac{3}{4\\pi} \\times 10^{15} \\, \\mathrm{m^2\\,s^{-2}}$$\n$$V_A^2 \\approx 0.2387 \\times 10^{15} = 2.387... \\times 10^{14} \\, \\mathrm{m^2\\,s^{-2}}$$\n$$V_A = \\sqrt{2.387... \\times 10^{14}} \\approx 1.545... \\times 10^7 \\, \\mathrm{m\\,s^{-1}}$$\n现在，我们可以计算伦德奎斯特数 $S$：\n$$S = \\frac{L V_{A}}{\\eta} = \\frac{(5.0 \\times 10^{7}\\,\\mathrm{m}) \\times (1.545... \\times 10^{7}\\,\\mathrm{m\\,s^{-1}})}{3\\,\\mathrm{m^{2}\\,s^{-1}}}$$\n$$S \\approx \\frac{7.725... \\times 10^{14}}{3} \\approx 2.575... \\times 10^{14}$$\n我们将这个值与临界伦德奎斯特数 $S_{c} = 1.0 \\times 10^{4}$进行比较。\n由于 $S \\approx 2.58 \\times 10^{14}$ 远大于 $S_{c} = 1.0 \\times 10^{4}$，因此满足条件 $S > S_{c}$。\n因此，电流片对等离子体团不稳定性是不稳定的，指标为：\n$$I = 1$$\n\n**2. 计算初始厚度 $\\delta_{\\mathrm{onset}}$**\n\n问题将 $\\delta_{\\mathrm{onset}}$ 定义为在临界伦德奎斯特数 $S = S_{c}$ 处计算的 Sweet–Parker 厚度。Sweet-Parker 厚度 $\\delta_{\\mathrm{SP}}$ 作为伦德奎斯特数 $S$ 和片半长 $L$ 的函数的标准公式是：\n$$\\delta_{\\mathrm{SP}} = \\frac{L}{\\sqrt{S}} = L S^{-1/2}$$\n为了找到初始厚度，我们将 $S_{c}$ 代入该公式中的 $S$：\n$$\\delta_{\\mathrm{onset}} = \\frac{L}{\\sqrt{S_{c}}}$$\n使用给定的 $L$ 和 $S_{c}$ 的值：\n$$L = 5.0 \\times 10^{7}\\,\\mathrm{m}$$\n$$S_{c} = 1.0 \\times 10^{4}$$\n我们计算 $\\delta_{\\mathrm{onset}}$：\n$$\\delta_{\\mathrm{onset}} = \\frac{5.0 \\times 10^{7}\\,\\mathrm{m}}{\\sqrt{1.0 \\times 10^{4}}} = \\frac{5.0 \\times 10^{7}\\,\\mathrm{m}}{1.0 \\times 10^{2}}$$\n$$\\delta_{\\mathrm{onset}} = 5.0 \\times 10^{5}\\,\\mathrm{m}$$\n问题要求将此值四舍五入到三位有效数字。\n$$\\delta_{\\mathrm{onset}} = 5.00 \\times 10^{5}\\,\\mathrm{m}$$\n\n最终答案是行矩阵 $\\begin{pmatrix} I  \\delta_{\\mathrm{onset}} \\end{pmatrix}$。\n代入计算出的值：\n$$\\begin{pmatrix} 1  5.00 \\times 10^{5} \\end{pmatrix}$$",
            "answer": "$$\\boxed{\\begin{pmatrix} 1  5.00 \\times 10^{5} \\end{pmatrix}}$$"
        },
        {
            "introduction": "虽然流体模型能很好地描述等离子体的宏观行为，但它们无法揭示单个粒子如何被加速——这是磁重联的一个关键特征。这个数值练习要求你在一个简化的重联电磁场模型中追踪测试粒子的运动轨迹。通过编程实现一个模拟，你可以直接观察粒子加速的过程，并区分不同的加速机制，从而在流体范式和动理学现实之间建立起一座桥梁。",
            "id": "4220376",
            "problem": "考虑一个非相对论性的、无碰撞的测试粒子，在代表天体物理等离子体的简化二维磁重联构型中运动。粒子动力学由从第一性原理出发的洛伦兹力决定。该模型中的场不随时间变化，仅在空间上根据具有均匀引导场和均匀重联电场的典型电流片形式而变化。环境等离子体的流入通过通常的跨场关系产生动生电场。你的任务是实现一个程序，对粒子轨迹进行积分，并计算几组不同参数下的动能增益和主导加速机制。\n\n基本原理：\n- 从洛伦兹力定律 $m \\, d\\mathbf{v}/dt = q \\left( \\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} \\right)$ 和 $d\\mathbf{r}/dt = \\mathbf{v}$ 出发，其中 $m$ 是质量，$q$ 是电荷，$\\mathbf{v}$ 是速度，$\\mathbf{r}$ 是位置，$\\mathbf{E}$ 是电场，$\\mathbf{B}$ 是磁场。\n- 动能的瞬时变化率为 $dW/dt = q \\, \\mathbf{E} \\cdot \\mathbf{v}$，其中 $W$ 是动能。\n- 简化的重联磁场为 $\\mathbf{B}(\\mathbf{r}) = B_0 \\tanh(y/L) \\, \\hat{\\mathbf{x}} + B_g \\, \\hat{\\mathbf{z}}$，其中 $B_0$ 是重联场振幅，$L$ 是电流片半厚度，$y$ 是跨越电流片的坐标，$B_g$ 是均匀引导场。\n- 重联电场是均匀的且沿 $\\hat{\\mathbf{z}}$ 方向：$\\mathbf{E}_{\\mathrm{rec}} = E_0 \\, \\hat{\\mathbf{z}}$，其中 $E_0$ 为常数。\n- 背景等离子体流入速度为 $\\mathbf{V}_{\\mathrm{in}} = - V_{\\mathrm{in}} \\, \\hat{\\mathbf{y}}$。动生电场由 $\\mathbf{E}_{\\mathrm{m}}(\\mathbf{r}) = - \\mathbf{V}_{\\mathrm{in}} \\times \\mathbf{B}(\\mathbf{r})$ 定义。总电场为 $\\mathbf{E}_{\\mathrm{tot}}(\\mathbf{r}) = \\mathbf{E}_{\\mathrm{rec}} + \\mathbf{E}_{\\mathrm{m}}(\\mathbf{r})$。\n\n定义和假设：\n- 粒子是非相对论性的：$|\\mathbf{v}| \\ll c$，其中 $c$ 是光速。\n- 场不随时间变化，仅如上所述在空间上变化。\n- 粒子方程使用适合带电粒子运动（CPM）的 Boris 算法进行积分。\n- 不求解磁流体动力学（MHD）；这是在预设场中的测试粒子计算。\n\n机制识别：\n- 将作用在粒子上的功分解为两个随时间积分的标量贡献：$\\Delta W_{\\mathrm{rec}} = \\int q \\, \\mathbf{E}_{\\mathrm{rec}} \\cdot \\mathbf{v} \\, dt$ 和 $\\Delta W_{\\mathrm{m}} = \\int q \\, \\mathbf{E}_{\\mathrm{m}}(\\mathbf{r}(t)) \\cdot \\mathbf{v} \\, dt$。总动能变化为 $\\Delta W = W_{\\mathrm{final}} - W_{\\mathrm{initial}}$。\n- 通过比较绝对贡献来定义主导加速机制：如果 $|\\Delta W_{\\mathrm{rec}}| \\ge |\\Delta W_{\\mathrm{m}}|$，则标记为 $0$（直接重联电场加速）；否则标记为 $1$（通过动生电场的类一阶费米加速）。\n\n数值积分要求：\n- 对每种情况，使用时间步长 $dt$ 和总积分时间 $T$ 的 Boris 推进器。\n- 在每一步，根据当前位置评估 $\\mathbf{B}(\\mathbf{r})$、$\\mathbf{E}_{\\mathrm{rec}}$ 和 $\\mathbf{E}_{\\mathrm{m}}(\\mathbf{r})$。\n\n单位和输出：\n- 除非另有说明，所有量均采用国际单位制（SI）。能量必须以焦耳（$\\mathrm{J}$）表示。\n- 你的程序必须为每个测试案例输出一个列表，包含动能增益和机制标签：$[\\Delta W, \\mathrm{label}]$，其中 $\\Delta W$ 是一个以 $\\mathrm{J}$ 为单位的浮点数，$\\mathrm{label}$ 是一个整数。\n- 你的程序应生成单行输出，其中包含一个逗号分隔的列表形式的结果，并用方括号括起来（例如，`[[\\Delta W_1, label_1], [\\Delta W_2, label_2], ...]`）。方括号和逗号必须严格按照描述出现一次，不得有任何额外文本。能量必须以 $\\mathrm{J}$ 为单位，作为浮点数打印。\n\n测试套件：\n对于每种情况，提供 $(q,m,B_0,B_g,L,E_0,V_{\\mathrm{in}},\\mathbf{r}_0,\\mathbf{v}_0,dt,T)$。\n\n- 情况 $1$（电子，预期以直接重联电场为主导）：$q = 1.602 \\times 10^{-19} \\, \\mathrm{C}$，$m = 9.109 \\times 10^{-31} \\, \\mathrm{kg}$，$B_0 = 1.0 \\times 10^{-4} \\, \\mathrm{T}$，$B_g = 0.0 \\, \\mathrm{T}$，$L = 1.0 \\times 10^{3} \\, \\mathrm{m}$，$E_0 = 1.0 \\times 10^{-3} \\, \\mathrm{V/m}$，$V_{\\mathrm{in}} = 0.0 \\, \\mathrm{m/s}$，$\\mathbf{r}_0 = (0.0 \\, \\mathrm{m}, 0.0 \\, \\mathrm{m}, 0.0 \\, \\mathrm{m})$，$\\mathbf{v}_0 = (0.0 \\, \\mathrm{m/s}, 0.0 \\, \\mathrm{m/s}, 100.0 \\, \\mathrm{m/s})$，$dt = 1.0 \\times 10^{-9} \\, \\mathrm{s}$，$T = 5.0 \\times 10^{-6} \\, \\mathrm{s}$。\n- 情况 $2$（电子，预期以动生电场为主导）：$q = 1.602 \\times 10^{-19} \\, \\mathrm{C}$，$m = 9.109 \\times 10^{-31} \\, \\mathrm{kg}$，$B_0 = 1.0 \\times 10^{-4} \\, \\mathrm{T}$，$B_g = 5.0 \\times 10^{-5} \\, \\mathrm{T}$，$L = 1.0 \\times 10^{3} \\, \\mathrm{m}$，$E_0 = 0.0 \\, \\mathrm{V/m}$，$V_{\\mathrm{in}} = 2.0 \\times 10^{3} \\, \\mathrm{m/s}$，$\\mathbf{r}_0 = (0.0 \\, \\mathrm{m}, 100.0 \\, \\mathrm{m}, 0.0 \\, \\mathrm{m})$，$\\mathbf{v}_0 = (0.0 \\, \\mathrm{m/s}, 0.0 \\, \\mathrm{m/s}, 0.0 \\, \\mathrm{m/s})$，$dt = 1.0 \\times 10^{-9} \\, \\mathrm{s}$，$T = 5.0 \\times 10^{-6} \\, \\mathrm{s}$。\n- 情况 $3$（质子，混合场）：$q = 1.602 \\times 10^{-19} \\, \\mathrm{C}$，$m = 1.673 \\times 10^{-27} \\, \\mathrm{kg}$，$B_0 = 1.0 \\times 10^{-4} \\, \\mathrm{T}$，$B_g = 1.0 \\times 10^{-4} \\, \\mathrm{T}$，$L = 2.0 \\times 10^{3} \\, \\mathrm{m}$，$E_0 = 5.0 \\times 10^{-4} \\, \\mathrm{V/m}$，$V_{\\mathrm{in}} = 3.0 \\times 10^{3} \\, \\mathrm{m/s}$，$\\mathbf{r}_0 = (0.0 \\, \\mathrm{m}, 200.0 \\, \\mathrm{m}, 0.0 \\, \\mathrm{m})$，$\\mathbf{v}_0 = (0.0 \\, \\mathrm{m/s}, 0.0 \\, \\mathrm{m/s}, 50.0 \\, \\mathrm{m/s})$，$dt = 1.0 \\times 10^{-7} \\, \\mathrm{s}$，$T = 5.0 \\times 10^{-5} \\, \\mathrm{s}$。\n- 情况 $4$（电子，远离中性线的边界条件）：$q = 1.602 \\times 10^{-19} \\, \\mathrm{C}$，$m = 9.109 \\times 10^{-31} \\, \\mathrm{kg}$，$B_0 = 1.0 \\times 10^{-4} \\, \\mathrm{T}$，$B_g = 2.0 \\times 10^{-4} \\, \\mathrm{T}$，$L = 1.0 \\times 10^{3} \\, \\mathrm{m}$，$E_0 = 1.0 \\times 10^{-3} \\, \\mathrm{V/m}$，$V_{\\mathrm{in}} = 5.0 \\times 10^{2} \\, \\mathrm{m/s}$，$\\mathbf{r}_0 = (0.0 \\, \\mathrm{m}, 1000.0 \\, \\mathrm{m}, 0.0 \\, \\mathrm{m})$，$\\mathbf{v}_0 = (10.0 \\, \\mathrm{m/s}, 0.0 \\, \\mathrm{m/s}, 0.0 \\, \\mathrm{m/s})$，$dt = 1.0 \\times 10^{-9} \\, \\mathrm{s}$，$T = 5.0 \\times 10^{-6} \\, \\mathrm{s}$。\n\n算法目标：\n- 实现与上述场一致的 Boris 推进器。\n- 对每种情况，计算以 $\\mathrm{J}$ 为单位的 $\\Delta W$ 和所定义的机制标签。\n- 按照规定将输出聚合在单行中。",
            "solution": "该问题被评估为有效。它在科学上基于经典电动力学原理，在数学上被良好地表述为一个常微分方程组的初值问题，并且所有提供的信息都是自洽、客观和一致的。\n\n任务是模拟一个非相对论性测试粒子在模拟磁重联的预设电磁场构型中的轨迹，并分析粒子的能量增益。解决方案涉及对运动方程进行数值积分，并计算电场不同分量所做的功。\n\n控制粒子运动的基本方程是洛伦兹力定律：\n$$\nm \\frac{d\\mathbf{v}}{dt} = q \\left( \\mathbf{E}_{\\mathrm{tot}}(\\mathbf{r}) + \\mathbf{v} \\times \\mathbf{B}(\\mathbf{r}) \\right)\n$$\n其中 $m$ 是粒子质量，$q$ 是其电荷，$\\mathbf{v}$ 是其速度，$\\mathbf{r}$ 是其位置。位置根据以下公式更新：\n$$\n\\frac{d\\mathbf{r}}{dt} = \\mathbf{v}\n$$\n\n电磁场定义如下。磁场 $\\mathbf{B}$ 由一个沿 $\\hat{\\mathbf{x}}$ 方向的反向分量和一个沿 $\\hat{\\mathbf{z}}$ 方向的均匀引导场组成：\n$$\n\\mathbf{B}(\\mathbf{r}) = B_0 \\tanh(y/L) \\, \\hat{\\mathbf{x}} + B_g \\, \\hat{\\mathbf{z}}\n$$\n这里，$B_0$ 是重联场强度，$L$ 是电流片的半厚度，$y$ 是跨越电流片的坐标，$B_g$ 是引导场强度。\n\n总电场 $\\mathbf{E}_{\\mathrm{tot}}$ 是均匀重联电场 $\\mathbf{E}_{\\mathrm{rec}}$ 和由等离子体流入产生的动生电场 $\\mathbf{E}_{\\mathrm{m}}$ 之和。\n重联电场由下式给出：\n$$\n\\mathbf{E}_{\\mathrm{rec}} = E_0 \\, \\hat{\\mathbf{z}}\n$$\n其中 $E_0$ 是一个常数。动生电场是由速度为 $\\mathbf{V}_{\\mathrm{in}} = -V_{\\mathrm{in}} \\hat{\\mathbf{y}}$ 的等离子体流过磁场时感应产生的：\n$$\n\\mathbf{E}_{\\mathrm{m}}(\\mathbf{r}) = - \\mathbf{V}_{\\mathrm{in}} \\times \\mathbf{B}(\\mathbf{r}) = -(-V_{\\mathrm{in}} \\hat{\\mathbf{y}}) \\times \\left(B_0 \\tanh(y/L) \\hat{\\mathbf{x}} + B_g \\hat{\\mathbf{z}}\\right)\n$$\n计算叉积得到：\n$$\n\\mathbf{E}_{\\mathrm{m}}(\\mathbf{r}) = V_{\\mathrm{in}} B_g \\hat{\\mathbf{x}} - V_{\\mathrm{in}} B_0 \\tanh(y/L) \\hat{\\mathbf{z}}\n$$\n因此，总电场为：\n$$\n\\mathbf{E}_{\\mathrm{tot}}(\\mathbf{r}) = \\mathbf{E}_{\\mathrm{rec}} + \\mathbf{E}_{\\mathrm{m}}(\\mathbf{r}) = (V_{\\mathrm{in}} B_g) \\hat{\\mathbf{x}} + \\left(E_0 - V_{\\mathrm{in}} B_0 \\tanh(y/L)\\right) \\hat{\\mathbf{z}}\n$$\n\n粒子的动能为 $W = \\frac{1}{2} m |\\mathbf{v}|^2$。动能的变化率由电场传递的功率给出：\n$$\n\\frac{dW}{dt} = q \\mathbf{E}_{\\mathrm{tot}} \\cdot \\mathbf{v}\n$$\n在积分时间 $T$ 内的总动能变化 $\\Delta W$ 是该功率的积分。我们将此变化分解为来自重联场 $\\Delta W_{\\mathrm{rec}}$ 和动生电场 $\\Delta W_{\\mathrm{m}}$ 的贡献：\n$$\n\\Delta W_{\\mathrm{rec}} = \\int_0^T q \\, \\mathbf{E}_{\\mathrm{rec}} \\cdot \\mathbf{v}(t) \\, dt\n$$\n$$\n\\Delta W_{\\mathrm{m}} = \\int_0^T q \\, \\mathbf{E}_{\\mathrm{m}}(\\mathbf{r}(t)) \\cdot \\mathbf{v}(t) \\, dt\n$$\n主导加速机制通过比较绝对大小 $|\\Delta W_{\\mathrm{rec}}|$ 和 $|\\Delta W_{\\mathrm{m}}|$ 来确定。如果 $|\\Delta W_{\\mathrm{rec}}| \\ge |\\Delta W_{\\mathrm{m}}|$，则机制标记为 $0$；否则标记为 $1$。\n\n运动方程使用 Boris 算法进行数值积分，这是一种二阶精确且非常适合带电粒子动力学的辛积分器。该算法在时间上交错速度和位置，位置 $\\mathbf{r}^n$ 在整数时间步长 $t_n = n \\, dt$ 上评估，速度 $\\mathbf{v}^{n-1/2}$ 在半步长 $t_{n-1/2} = (n-1/2) \\, dt$ 上评估。\n\n从 $t_n$ 到 $t_{n+1}$ 的单个时间步的积分过程如下：\n1.  **初始速度调整**：给定 $t=0$ 时的初始条件 $\\mathbf{r}^0$ 和 $\\mathbf{v}^0$，速度首先被“向后踢”半个时间步以获得 $\\mathbf{v}^{-1/2}$，这是启动蛙跳积分所必需的：\n    $$\n    \\mathbf{v}^{-1/2} = \\mathbf{v}^0 - \\frac{1}{2} dt \\frac{q}{m} \\left( \\mathbf{E}_{\\mathrm{tot}}(\\mathbf{r}^0) + \\mathbf{v}^0 \\times \\mathbf{B}(\\mathbf{r}^0) \\right)\n    $$\n2.  **主循环**：对于每一步 $n=0, 1, \\dots, N-1$，其中 $N = T/dt$：\n    a. 在当前位置 $\\mathbf{r}^n$ 处评估电场和磁场 $\\mathbf{E}_{\\mathrm{tot}}^n$ 和 $\\mathbf{B}^n$。\n    b. 通过将电加速的前半部分应用于 $\\mathbf{v}^{n-1/2}$ 来计算速度 $\\mathbf{v}^-$：\n       $$\n       \\mathbf{v}^- = \\mathbf{v}^{n-1/2} + \\frac{q \\mathbf{E}_{\\mathrm{tot}}^n}{m} \\frac{dt}{2}\n       $$\n    c. 磁场旋转应用于 $\\mathbf{v}^-$。这涉及定义中间向量 $\\mathbf{t} = \\frac{q \\mathbf{B}^n}{m} \\frac{dt}{2}$ 和 $\\mathbf{s} = \\frac{2\\mathbf{t}}{1 + |\\mathbf{t}|^2}$：\n       $$\n       \\mathbf{v}' = \\mathbf{v}^- + \\mathbf{v}^- \\times \\mathbf{t}\n       $$\n       $$\n       \\mathbf{v}^+ = \\mathbf{v}^- + \\mathbf{v}' \\times \\mathbf{s}\n       $$\n    d. 应用电加速的后半部分以获得下一个半步长处的速度 $\\mathbf{v}^{n+1/2}$：\n       $$\n       \\mathbf{v}^{n+1/2} = \\mathbf{v}^+ + \\frac{q \\mathbf{E}_{\\mathrm{tot}}^n}{m} \\frac{dt}{2}\n       $$\n    e. 计算新位置 $\\mathbf{r}^{n+1}$：\n       $$\n       \\mathbf{r}^{n+1} = \\mathbf{r}^n + \\mathbf{v}^{n+1/2} dt\n       $$\n    f. 对区间 $[t_n, t_{n+1}]$ 内每个电场分量所做的功进行近似和累加。速度 $\\mathbf{v}^{n+1/2}$ 是该区间内的平均速度，适合用于中点法则求积：\n       $$\n       \\delta W_{\\mathrm{rec}}^n = q \\left( \\mathbf{E}_{\\mathrm{rec}} \\cdot \\mathbf{v}^{n+1/2} \\right) dt\n       $$\n       $$\n       \\delta W_{\\mathrm{m}}^n = q \\left( \\mathbf{E}_{\\mathrm{m}}(\\mathbf{r}^n) \\cdot \\mathbf{v}^{n+1/2} \\right) dt\n       $$\n       通过加上这些增量来更新 $\\Delta W_{\\mathrm{rec}}$ 和 $\\Delta W_{\\mathrm{m}}$。\n\n3.  **最终化**：经过 $N$ 步后，通过从 $\\mathbf{v}^{N-1/2}$ 进行最终的半步加速来计算时间 $T$ 时的最终速度 $\\mathbf{v}^N$：\n    $$\n    \\mathbf{v}^N = \\mathbf{v}^{N-1/2} + \\frac{q \\mathbf{E}_{\\mathrm{tot}}(\\mathbf{r}^N)}{m} \\frac{dt}{2}\n    $$\n    总动能增益为 $\\Delta W = W_{\\mathrm{final}} - W_{\\mathrm{initial}} = \\frac{1}{2}m|\\mathbf{v}^N|^2 - \\frac{1}{2}m|\\mathbf{v}^0|^2$。这个 $\\Delta W$ 值可作为数值积分的检验，因为它应等于 $\\Delta W_{\\mathrm{rec}} + \\Delta W_{\\mathrm{m}}$。\n\n此程序将针对每个测试案例实施，以计算所需的 $[\\Delta W, \\mathrm{label}]$ 值。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the test-particle motion problem for several magnetic reconnection scenarios.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: electron, direct reconnection electric field dominant expected\n        {\n            'q': 1.602e-19, 'm': 9.109e-31, 'B0': 1.0e-4, 'Bg': 0.0, 'L': 1.0e3,\n            'E0': 1.0e-3, 'Vin': 0.0, 'r0': (0.0, 0.0, 0.0), 'v0': (0.0, 0.0, 100.0),\n            'dt': 1.0e-9, 'T': 5.0e-6\n        },\n        # Case 2: electron, motional field dominant expected\n        {\n            'q': 1.602e-19, 'm': 9.109e-31, 'B0': 1.0e-4, 'Bg': 5.0e-5, 'L': 1.0e3,\n            'E0': 0.0, 'Vin': 2.0e3, 'r0': (0.0, 100.0, 0.0), 'v0': (0.0, 0.0, 0.0),\n            'dt': 1.0e-9, 'T': 5.0e-6\n        },\n        # Case 3: proton, mixed fields\n        {\n            'q': 1.602e-19, 'm': 1.673e-27, 'B0': 1.0e-4, 'Bg': 1.0e-4, 'L': 2.0e3,\n            'E0': 5.0e-4, 'Vin': 3.0e3, 'r0': (0.0, 200.0, 0.0), 'v0': (0.0, 0.0, 50.0),\n            'dt': 1.0e-7, 'T': 5.0e-5\n        },\n        # Case 4: electron, boundary condition far from neutral line\n        {\n            'q': 1.602e-19, 'm': 9.109e-31, 'B0': 1.0e-4, 'Bg': 2.0e-4, 'L': 1.0e3,\n            'E0': 1.0e-3, 'Vin': 5.0e2, 'r0': (0.0, 1000.0, 0.0), 'v0': (10.0, 0.0, 0.0),\n            'dt': 1.0e-9, 'T': 5.0e-6\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(**case)\n        results.append(result)\n\n    # Format output as a list of lists with no spaces\n    formatted_results = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef run_simulation(q, m, B0, Bg, L, E0, Vin, r0, v0, dt, T):\n    \"\"\"\n    Integrates particle trajectory using Boris pusher and calculates energy gain.\n    \"\"\"\n    r = np.array(r0, dtype=float)\n    v = np.array(v0, dtype=float)\n    \n    num_steps = int(round(T / dt))\n\n    w_initial = 0.5 * m * np.dot(v, v)\n    dw_rec_total = 0.0\n    dw_m_total = 0.0\n\n    # Field calculation function\n    def get_fields(pos):\n        y = pos[1]\n        tanh_yL = np.tanh(y / L)\n        \n        B = np.array([B0 * tanh_yL, 0.0, Bg])\n        \n        E_rec = np.array([0.0, 0.0, E0])\n        \n        E_m = np.array([Vin * Bg, 0.0, -Vin * B0 * tanh_yL])\n        \n        E_tot = E_rec + E_m\n        \n        return B, E_rec, E_m, E_tot\n\n    # Initial half-step kick-back for velocity to start the leapfrog\n    B_init, _, _, E_init = get_fields(r)\n    a_init = (q / m) * (E_init + np.cross(v, B_init))\n    v = v - 0.5 * dt * a_init\n\n    # Main integration loop\n    for _ in range(num_steps):\n        B, E_rec, E_m, E_tot = get_fields(r)\n\n        # Boris algorithm\n        # 1. Electric field half-acceleration\n        v_minus = v + (q * E_tot / m) * (dt / 2.0)\n\n        # 2. Magnetic field rotation\n        t = (q * B / m) * (dt / 2.0)\n        t_mag_sq = np.dot(t, t)\n        s = 2.0 * t / (1.0 + t_mag_sq) if (1.0 + t_mag_sq) != 1.0 else 2.0 * t\n        \n        v_prime = v_minus + np.cross(v_minus, t)\n        v_plus = v_minus + np.cross(v_prime, s)\n\n        # 3. Second electric field half-acceleration\n        v_plus_half = v_plus + (q * E_tot / m) * (dt / 2.0)\n\n        # Accumulate work done by E-field components\n        dw_rec = q * np.dot(E_rec, v_plus_half) * dt\n        dw_m = q * np.dot(E_m, v_plus_half) * dt\n        dw_rec_total += dw_rec\n        dw_m_total += dw_m\n\n        # Update velocity and position for next step\n        v = v_plus_half\n        r = r + v * dt\n\n    # Final half-step to get velocity at the final integer time step\n    _, _, _, E_final = get_fields(r)\n    v_final = v + (q * E_final / m) * (dt / 2.0)\n\n    w_final = 0.5 * m * np.dot(v_final, v_final)\n    delta_w = w_final - w_initial\n\n    # Determine dominant mechanism\n    if abs(dw_rec_total) >= abs(dw_m_total):\n        label = 0\n    else:\n        label = 1\n\n    return [delta_w, label]\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}