{
    "hands_on_practices": [
        {
            "introduction": "这项实践展示了在具体场景中应用磁矩$\\mu$守恒定律的威力。通过应用这一定理，我们可以预测带电粒子在进入更强或更弱磁场区域时其垂直速度$v_{\\perp}$如何变化，这是磁约束和粒子俘获等现象中的一个关键过程。该练习有助于加深对$v_{\\perp}$和$B$之间直接关系的理解。",
            "id": "4215537",
            "problem": "考虑一个非相对論性的、电荷为 $q$、质量为 $m$ 的单电荷离子，该离子嵌入代表日冕环的磁化天体物理等离子体中。磁感应场为 $\\boldsymbol{B}(x) = B(x)\\,\\hat{\\boldsymbol{z}}$，其中 $B(x)$ 随横向坐标 $x$ 缓慢单调变化，$\\hat{\\boldsymbol{z}}$ 是一个固定的单位向量。假设该场是静磁场，并且在空间上是缓慢变化的，其精确含义是离子的拉莫尔半径和回旋周期远小于 $B(x)$ 的特征尺度，因此引导中心理论适用。离子的引导中心通过某种外部施加的跨场漂移（例如，由外部施加的电场（E）产生的漂移）绝热地从 $x=x_{0}$ 输运到 $x=x_{1}$，该漂移穿过梯度，且电场（E）没有任何平行于 $\\boldsymbol{B}$ 的分量；因此磁力不对粒子做功。\n\n在 $x=x_{0}$ 处，离子具有垂直速度 $v_{\\perp 0}$，磁场大小为 $B_{0} \\equiv B(x_{0})$。在最终位置处的局域磁场大小为 $B_{1} \\equiv B(x_{1})$。梯度是均匀的，$\\partial B/\\partial x = \\alpha  0$，因此 $B(x_{1}) = B_{0} + \\alpha\\,(x_{1}-x_{0})$。你可以假设第一绝热不变量（磁矩）在运动过程中是守恒的。\n\n仅从带电粒子在静磁场中的基本运动定律以及在所述条件下第一绝热不变量守恒出发，推导：\n\n1. 用 $v_{\\perp 0}$、$B_{0}$ 和 $B(x_{1})$ 表示最终位置处的垂直速度 $v_{\\perp}(x_{1})$ 的表达式。\n2. 对于几何结构 $\\boldsymbol{B}(x) = B(x)\\,\\hat{\\boldsymbol{z}}$ 且 $\\nabla B = \\alpha\\,\\hat{\\boldsymbol{x}}$ 的情况，推导在 $x_{1}$ 处与在 $x_{0}$ 处的梯度-$B$漂移速度大小之比的表达式。\n\n将你的最终答案表示为一个行矩阵，其中按顺序包含上面推导的两个解析表达式。不需要进行数值计算。如果你选择进行数值计算，请以米/秒为单位报告任何速度，并四舍五入到四位有效数字。",
            "solution": "所述问题在科学上基于天体物理等离子体物理学的原理，特别是引导中心理论。该问题提法明确，具有足够的信息来推导所要求的量，并且没有矛盾或含糊之处。在标准等离子体模型的背景下，其前提是物理上现实的。因此，该问题是有效的，并将提供解答。\n\n根据要求，分析分两部分进行。\n\n### 第1部分：垂直速度 $v_{\\perp}(x_{1})$ 的推导\n\n问题陈述，第一绝热不变量，即磁矩 $\\mu$，在粒子运动过程中是守恒的。带电粒子在磁场中回旋的磁矩由其垂直动能与磁场强度之比给出：\n$$ \\mu = \\frac{\\frac{1}{2} m v_{\\perp}^2}{B} $$\n其中 $m$ 是粒子的质量，$v_{\\perp}$ 是其垂直于磁场 $\\boldsymbol{B}$ 的速度，$B=|\\boldsymbol{B}|$ 是磁场的大小。\n\n$\\mu$ 的守恒意味着其在初始位置 $x_{0}$ 的值等于其在最终位置 $x_{1}$ 的值。\n设初始状态用下标 $0$ 表示，最终状态用下标 $1$ 表示。已知条件是：\n-   在 $x=x_{0}$ 处：垂直速度为 $v_{\\perp 0}$，磁场大小为 $B_{0} = B(x_{0})$。\n-   在 $x=x_{1}$ 处：垂直速度为 $v_{\\perp}(x_{1})$，磁场大小为 $B(x_{1})$。\n\n在初始位置的磁矩是：\n$$ \\mu_{0} = \\frac{m v_{\\perp 0}^2}{2 B_{0}} $$\n在最终位置的磁矩是：\n$$ \\mu_{1} = \\frac{m (v_{\\perp}(x_{1}))^2}{2 B(x_{1})} $$\n\n根据绝热不变量原理，$\\mu_{0} = \\mu_{1}$：\n$$ \\frac{m v_{\\perp 0}^2}{2 B_{0}} = \\frac{m (v_{\\perp}(x_{1}))^2}{2 B(x_{1})} $$\n两边消去 $\\frac{m}{2}$ 项，得到：\n$$ \\frac{v_{\\perp 0}^2}{B_{0}} = \\frac{(v_{\\perp}(x_{1}))^2}{B(x_{1})} $$\n我们现在可以解出最终的垂直速度 $v_{\\perp}(x_{1})$：\n$$ (v_{\\perp}(x_{1}))^2 = v_{\\perp 0}^2 \\frac{B(x_{1})}{B_{0}} $$\n取平方根（速度为非负值）得到所需的表达式：\n$$ v_{\\perp}(x_{1}) = v_{\\perp 0} \\sqrt{\\frac{B(x_{1})}{B_{0}}} $$\n这个结果表明，当离子移动到磁场更强的区域时，其垂直速度会增加，以使比率 $\\frac{v_{\\perp}^2}{B}$ 保持不变。\n\n### 第2部分：梯度-$B$漂移速度之比\n\n梯度-$B$漂移速度 $\\boldsymbol{v}_{\\nabla B}$ 是引导中心在非均匀磁场中经历的一种基本漂移。它由以下公式给出：\n$$ \\boldsymbol{v}_{\\nabla B} = \\frac{\\mu}{q} \\frac{\\boldsymbol{B} \\times \\nabla B}{B^2} $$\n其中 $q$ 是粒子的电荷。代入 $\\mu$ 的表达式：\n$$ \\boldsymbol{v}_{\\nabla B} = \\frac{1}{q} \\left( \\frac{m v_{\\perp}^2}{2 B} \\right) \\frac{\\boldsymbol{B} \\times \\nabla B}{B^2} = \\frac{m v_{\\perp}^2}{2 q} \\frac{\\boldsymbol{B} \\times \\nabla B}{B^3} $$\n问题为此部分指定了磁场及其梯度的几何结构：\n$$ \\boldsymbol{B}(x) = B(x)\\,\\hat{\\boldsymbol{z}} $$\n$$ \\nabla B = \\alpha\\,\\hat{\\boldsymbol{x}} \\quad (\\text{其中 } \\alpha \\text{ 是一个正常数}) $$\n首先，我们计算叉积 $\\boldsymbol{B} \\times \\nabla B$：\n$$ \\boldsymbol{B} \\times \\nabla B = \\left( B(x)\\,\\hat{\\boldsymbol{z}} \\right) \\times \\left( \\alpha\\,\\hat{\\boldsymbol{x}} \\right) = \\alpha B(x) (\\hat{\\boldsymbol{z}} \\times \\hat{\\boldsymbol{x}}) = \\alpha B(x)\\,\\hat{\\boldsymbol{y}} $$\n现在，将此结果代回 $\\boldsymbol{v}_{\\nabla B}$ 的表达式：\n$$ \\boldsymbol{v}_{\\nabla B} = \\frac{m v_{\\perp}^2}{2 q} \\frac{\\alpha B(x)\\,\\hat{\\boldsymbol{y}}}{(B(x))^3} = \\frac{m v_{\\perp}^2 \\alpha}{2 q (B(x))^2}\\,\\hat{\\boldsymbol{y}} $$\n梯度-$B$漂移速度的大小，我们记为 $v_{\\nabla B}$，是标量系数的绝对值：\n$$ v_{\\nabla B}(x) = |\\boldsymbol{v}_{\\nabla B}| = \\left| \\frac{m v_{\\perp}^2 \\alpha}{2 q (B(x))^2} \\right| = \\frac{m v_{\\perp}^2 \\alpha}{2 |q| (B(x))^2} $$\n因为 $m$、$\\alpha$ 和 $v_{\\perp}^2$ 是非负的。\n\n我们需要求出在 $x_{1}$ 处与在 $x_{0}$ 处该漂移的大小之比。\n在位置 $x_{0}$ 处：\n$$ v_{\\nabla B, 0} = \\frac{m v_{\\perp 0}^2 \\alpha}{2 |q| B_{0}^2} $$\n在位置 $x_{1}$ 处：\n$$ v_{\\nabla B, 1} = \\frac{m (v_{\\perp}(x_{1}))^2 \\alpha}{2 |q| (B(x_{1}))^2} $$\n比值为：\n$$ \\frac{v_{\\nabla B, 1}}{v_{\\nabla B, 0}} = \\frac{\\frac{m (v_{\\perp}(x_{1}))^2 \\alpha}{2 |q| (B(x_{1}))^2}}{\\frac{m v_{\\perp 0}^2 \\alpha}{2 |q| B_{0}^2}} $$\n消去常数项 $\\frac{m \\alpha}{2 |q|}$，我们得到：\n$$ \\frac{v_{\\nabla B, 1}}{v_{\\nabla B, 0}} = \\frac{(v_{\\perp}(x_{1}))^2 / (B(x_{1}))^2}{v_{\\perp 0}^2 / B_{0}^2} = \\left( \\frac{v_{\\perp}(x_{1})}{v_{\\perp 0}} \\right)^2 \\left( \\frac{B_{0}}{B(x_{1})} \\right)^2 $$\n从第1部分，我们有关系式 $(v_{\\perp}(x_{1}))^2 = v_{\\perp 0}^2 \\frac{B(x_{1})}{B_{0}}$。将此代入比值中：\n$$ \\frac{v_{\\nabla B, 1}}{v_{\\nabla B, 0}} = \\frac{v_{\\perp 0}^2 \\frac{B(x_{1})}{B_{0}}}{v_{\\perp 0}^2} \\left( \\frac{B_{0}}{B(x_{1})} \\right)^2 = \\frac{B(x_{1})}{B_{0}} \\frac{B_{0}^2}{(B(x_{1}))^2} = \\frac{B_{0}}{B(x_{1})} $$\n因此，梯度-$B$漂移速度之比与磁场强度之比成反比。\n\n所需的两个表达式是：\n1.  $v_{\\perp}(x_{1}) = v_{\\perp 0} \\sqrt{\\frac{B(x_{1})}{B_{0}}}$\n2.  $\\frac{v_{\\nabla B, 1}}{v_{\\nabla B, 0}} = \\frac{B_{0}}{B(x_{1})}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} v_{\\perp 0} \\sqrt{\\frac{B(x_{1})}{B_{0}}}  \\frac{B_{0}}{B(x_{1})} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "这项练习超越了简单的应用层面，深入探讨了绝热不变量背后深刻的理论基础。通过运用哈密顿力学和引导中心运动的非正则泊松括号这一优美的理论框架，你将严格证明$\\mu$在主导阶上是守恒的。这项实践将让你更深刻地领会等离子体物理学理论结构的严谨与精妙。",
            "id": "4215527",
            "problem": "考虑一个质量为 $m$、电荷为 $q$ 的单个带电粒子，在没有电场的情况下，在静磁场 $\\mathbf{B}(\\mathbf{X})$ 中运动。假设该场在一个特征尺度 $L_{B}$ 上缓慢变化，该尺度远大于回旋半径，因此导向中心简化在小参数 $\\epsilon \\equiv \\rho/L_{B}$ 的主导阶上是有效的，其中 $\\rho$ 是回旋半径。引入导向中心坐标 $\\mathbf{Z} \\equiv (\\mathbf{X}, p_{\\parallel}, \\mu, \\theta)$，其中 $\\mathbf{X}$ 是导向中心位置，$p_{\\parallel} \\equiv m v_{\\parallel}$ 是平行动量，$\\mu$ 是由 $\\mu \\equiv m v_{\\perp}^{2}/(2 B)$ 定义的磁矩，$\\theta$ 是回旋相位角。垂直运动允许使用作用量-角度描述：与快速回旋运动相关的作用量 $J$ 满足 $J = E_{\\perp}/\\Omega$，其中 $E_{\\perp}$ 是垂直动能，$\\Omega \\equiv q B/m$ 是回旋频率，因此 $J = (m/q)\\,\\mu$。\n\n从单粒子相空间拉格朗日量和上述作用量-角度关系出发，利用物理上合理的近似，构建主导阶导向中心哈密顿量 $H_{\\mathrm{gc}}(\\mathbf{X}, p_{\\parallel}, \\mu)$。然后，利用由导向中心一形式构建的辛二形式，将其求逆以获得在变量 $(\\mathbf{X}, p_{\\parallel}, \\mu, \\theta)$ 中对 $\\epsilon$ 的主导阶有效的非正则导向中心泊松括号（泊松括号）。最后，使用您的泊松括号计算磁矩的主导阶时间导数 $\\dot{\\mu} = \\{\\mu, H_{\\mathrm{gc}}\\}_{\\mathrm{gc}}$，并将此结果作为您的最终答案。\n\n将最终答案表示为单个闭式解析表达式。无需四舍五入。",
            "solution": "题目要求计算在缓慢变化的静磁场中带电粒子的磁矩的主导阶时间导数 $\\dot{\\mu}$。这通过计算泊松括号 $\\dot{\\mu} = \\{\\mu, H_{\\mathrm{gc}}\\}_{\\mathrm{gc}}$ 来确定，其中 $H_{\\mathrm{gc}}$ 是主导阶导向中心哈密顿量，而 $\\{\\cdot, \\cdot\\}_{\\mathrm{gc}}$ 是相应的非正则泊松括号。\n\n首先，我们构建主导阶导向中心哈密顿量 $H_{\\mathrm{gc}}$。在没有电场的静磁场中，粒子的能量是守恒的，并且完全是动能。哈密顿量等于总动能：\n$$ H = \\frac{1}{2} m v^2 $$\n粒子的速度 $\\mathbf{v}$ 可以分解为平行于和垂直于磁场方向 $\\mathbf{\\hat{b}} = \\mathbf{B}/B$ 的分量：\n$$ \\mathbf{v} = v_{\\parallel} \\mathbf{\\hat{b}} + \\mathbf{v}_{\\perp} $$\n因此，动能可以写成平行方向动能和垂直方向动能之和：\n$$ E_k = \\frac{1}{2} m v_{\\parallel}^2 + \\frac{1}{2} m v_{\\perp}^2 $$\n平行方向动能用平行动量 $p_{\\parallel} \\equiv m v_{\\parallel}$ 表示为 $p_{\\parallel}^2 / (2m)$。\n垂直方向动能 $E_{\\perp} = \\frac{1}{2} m v_{\\perp}^2$ 与磁矩 $\\mu$ 相关，其定义为 $\\mu \\equiv m v_{\\perp}^2 / (2B)$。根据此定义，我们有 $E_{\\perp} = \\mu B$。\n导向中心近似假设粒子的能量可以使用导向中心位置 $\\mathbf{X}$ 处的场强来评估。因此，主导阶导向中心哈密顿量是平行方向动能和回旋运动能量之和，用导向中心变量 $(\\mathbf{X}, p_{\\parallel}, \\mu)$ 表示：\n$$ H_{\\mathrm{gc}}(\\mathbf{X}, p_{\\parallel}, \\mu) = \\frac{p_{\\parallel}^2}{2m} + \\mu B(\\mathbf{X}) $$\n注意，在此主导阶上，$H_{\\mathrm{gc}}$ 与回旋相位角 $\\theta$ 无关。\n\n接下来，我们建立导向中心泊松括号的结构。这源于导向中心相空间一形式 $\\Gamma_{\\mathrm{gc}}$ 的辛部分。该一形式是通过将粒子的一形式 $\\gamma = (m\\mathbf{v} + q\\mathbf{A}) \\cdot d\\mathbf{x}$ 变换到导向中心坐标并对快速回旋运动进行平均来构建的。导向中心一形式的空间部分标准结果是：\n$$ \\gamma_{\\mathrm{gc}} = (q\\mathbf{A}(\\mathbf{X}) + p_{\\parallel}\\mathbf{\\hat{b}}(\\mathbf{X})) \\cdot d\\mathbf{X} + J d\\theta $$\n其中 $J$ 是垂直运动的作用量，$\\theta$ 是相应的角度变量（回旋相位）。题目指出 $J = (m/q)\\mu$。代入此关系，我们得到在指定坐标 $(\\mathbf{X}, p_{\\parallel}, \\mu, \\theta)$ 下的一形式：\n$$ \\gamma_{\\mathrm{gc}} = (q\\mathbf{A}(\\mathbf{X}) + p_{\\parallel}\\mathbf{\\hat{b}}(\\mathbf{X})) \\cdot d\\mathbf{X} + \\frac{m\\mu}{q} d\\theta $$\n泊松括号由辛二形式 $\\omega_{\\mathrm{gc}} = d\\gamma_{\\mathrm{gc}}$ 导出。泊松张量 $J^{ab}$ 是 $\\omega_{\\mathrm{gc}}$ 分量矩阵的逆。两个函数 $F$ 和 $G$ 的泊松括号则由 $\\{F, G\\}_{\\mathrm{gc}} = \\sum_{a,b} \\frac{\\partial F}{\\partial z^a} J^{ab} \\frac{\\partial G}{\\partial z^b}$ 给出，其中 $z^a$ 是相空间坐标。\n\n由于 $\\gamma_{\\mathrm{gc}}$ 的结构，辛形式和由此产生的泊松括号自然地分解为两个独立的部分：一部分用于变量 $(\\mathbf{X}, p_{\\parallel})$，另一部分用于作用量-角度对 $(\\mu, \\theta)$。在一形式中，坐标 $(\\mathbf{X}, p_{\\parallel})$ 与 $(\\mu, \\theta)$ 不混合，这意味着泊松张量 $J^{ab}$ 是块对角的。\n$$ \\{F, G\\}_{\\mathrm{gc}} = \\{F, G\\}_{\\mathbf{X}, p_{\\parallel}} + \\{F, G\\}_{\\mu, \\theta} $$\n我们感兴趣的是计算 $\\dot{\\mu} = \\{\\mu, H_{\\mathrm{gc}}\\}_{\\mathrm{gc}}$。由于 $\\mu$ 仅仅是 $\\mu$ 的函数（即 $\\mu(\\mathbf{X}, p_{\\parallel}, \\mu, \\theta) = \\mu$），它关于 $\\mathbf{X}$ 和 $p_{\\parallel}$ 的导数为零。因此，括号 $\\{ \\mu, H_{\\mathrm{gc}} \\}_{\\mathbf{X}, p_{\\parallel}}$ 为零。\n我们只需考虑括号中 $(\\mu, \\theta)$ 部分的贡献。一形式的作用量-角度部分是 $\\gamma_{\\mu,\\theta} = J d\\theta = (m/q)\\mu d\\theta$。对于一个正则作用量-角度对 $(J, \\theta)$，标准的泊松括号是 $\\{F, G\\}_{J,\\theta} = \\frac{\\partial F}{\\partial \\theta} \\frac{\\partial G}{\\partial J} - \\frac{\\partial F}{\\partial J} \\frac{\\partial G}{\\partial \\theta}$。为了用 $\\mu$ 来表示它，我们使用链式法则：$\\frac{\\partial}{\\partial J} = \\frac{d\\mu}{dJ} \\frac{\\partial}{\\partial \\mu}$。因为 $J=(m/q)\\mu$，我们有 $dJ/d\\mu = m/q$，所以 $d\\mu/dJ = q/m$。该括号变为：\n$$ \\{F, G\\}_{\\mu, \\theta} = \\frac{q}{m} \\left( \\frac{\\partial F}{\\partial \\theta} \\frac{\\partial G}{\\partial \\mu} - \\frac{\\partial F}{\\partial \\mu} \\frac{\\partial G}{\\partial \\theta} \\right) $$\n现在我们可以计算 $\\mu$ 的时间演化。令 $F = \\mu$ 和 $G = H_{\\mathrm{gc}}$。\n$$ \\dot{\\mu} = \\{\\mu, H_{\\mathrm{gc}}\\}_{\\mathrm{gc}} = \\{\\mu, H_{\\mathrm{gc}}\\}_{\\mu, \\theta} = \\frac{q}{m} \\left( \\frac{\\partial \\mu}{\\partial \\theta} \\frac{\\partial H_{\\mathrm{gc}}}{\\partial \\mu} - \\frac{\\partial \\mu}{\\partial \\mu} \\frac{\\partial H_{\\mathrm{gc}}}{\\partial \\theta} \\right) $$\n我们计算这些偏导数：\n1.  $\\frac{\\partial \\mu}{\\partial \\theta}$: 由于 $\\mu$ 是一个独立坐标，它关于 $\\theta$ 的导数为 $0$。\n2.  $\\frac{\\partial \\mu}{\\partial \\mu}$: 一个坐标关于其自身的导数为 $1$。\n3.  $\\frac{\\partial H_{\\mathrm{gc}}}{\\partial \\mu}$: 从 $H_{\\mathrm{gc}} = \\frac{p_{\\parallel}^2}{2m} + \\mu B(\\mathbf{X})$，我们得到 $\\frac{\\partial H_{\\mathrm{gc}}}{\\partial \\mu} = B(\\mathbf{X})$。\n4.  $\\frac{\\partial H_{\\mathrm{gc}}}{\\partial \\theta}$: 主导阶哈密顿量 $H_{\\mathrm{gc}}$ 不依赖于回旋相位 $\\theta$，所以这个导数为 $0$。\n\n将这些导数代入 $\\dot{\\mu}$ 的表达式中：\n$$ \\dot{\\mu} = \\frac{q}{m} \\left( (0) \\cdot B(\\mathbf{X}) - (1) \\cdot (0) \\right) $$\n$$ \\dot{\\mu} = \\frac{q}{m} (0 - 0) = 0 $$\n计算表明，磁矩的主导阶时间导数为零。这证明了，在导向中心近似的最低阶上，磁矩 $\\mu$ 是一个运动常量，这就是为什么它被称为第一绝热不变量。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "最后一项实践将理论分析与计算现实联系起来。你将实现一个标准的粒子推进算法来模拟质子的运动轨迹，并数值监测其磁矩的变化。这使你能够直接观察$\\mu$在绝热条件下的守恒，更重要的是，当场变化过快时，你将亲眼见证其守恒性的破坏，从而对该理论的适用边界有更具体的认识。",
            "id": "4215562",
            "problem": "在给定的电磁场中运动的单个带电粒子遵循洛伦兹力定律，这是经典电动力学和力学的一项基本陈述。目标是通过与粒子模拟（PIC）方法一致的数值测试粒子积分，计算第一绝热不变量（即磁矩，记为 $\\mu(t)$）的时间序列，并评估在不同场变化下 $\\mu(t)$ 保持恒定的程度。\n\n从基本原理出发，粒子遵循以下运动方程\n$$\nm\\,\\frac{d\\mathbf{v}}{dt} = q\\left(\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B}\\right), \\quad \\frac{d\\mathbf{r}}{dt} = \\mathbf{v},\n$$\n其中 $m$ 是粒子质量，$q$ 是粒子电荷，$\\mathbf{v}$ 是速度，$\\mathbf{r}$ 是位置，$\\mathbf{E}$ 是电场，$\\mathbf{B}$ 是磁场。磁矩 $\\mu(t)$ 是根据粒子相对于局部磁场的瞬时运动计算得出的，并且必须从相对于瞬时磁场大小的动能垂直分量中提取。数值积分器必须对场进行时间中心化，以避免伪能增益或损失，这与广泛使用的PIC和测试粒子方案一致。\n\n您必须实现一个时间中心化的旋转-加速算法（Boris方法）来更新洛伦兹力。磁矩 $\\mu(t)$ 应在每个时间步下，根据粒子的瞬时速度和磁场计算，方法是使用速度分解，将其分为平行和垂直于磁场方向的分量。然后，应通过计算一个量化其恒定性的标量度量来评估 $\\mu(t)$ 的绝热不变性。任何三角函数的参数均使用弧度。\n\n您的程序必须：\n- 在空间均匀但随时间变化的场 $\\mathbf{E}(t)$ 和 $\\mathbf{B}(t)$ 中，对电荷为 $q = +e$、质量为 $m = m_{\\mathrm{p}}$ 的单个质子进行积分。\n- 使用以下常数和初始条件：\n  - $q = 1.602176634 \\times 10^{-19}\\ \\mathrm{C}$，\n  - $m = 1.67262192369 \\times 10^{-27}\\ \\mathrm{kg}$，\n  - 基准磁场大小 $B_0 = 1.0 \\times 10^{-7}\\ \\mathrm{T}$，\n  - 时间步长 $\\Delta t = 1.0 \\times 10^{-3}\\ \\mathrm{s}$，\n  - 总积分时间 $T = 10.0\\ \\mathrm{s}$，\n  - 初始位置 $\\mathbf{r}(0) = (0,0,0)\\ \\mathrm{m}$，\n  - 初始速度 $\\mathbf{v}(0) = (v_{\\perp 0}, 0, v_{\\parallel 0})\\ \\mathrm{m/s}$，其中 $v_{\\perp 0} = 1.0 \\times 10^{5}\\ \\mathrm{m/s}$，$v_{\\parallel 0} = 5.0 \\times 10^{4}\\ \\mathrm{m/s}$。\n- 在每一步中，为了更新速度，需在 $t + \\Delta t/2$ 处对场进行时间中心化。\n\n为每个测试案例定义场如下\n$$\n\\mathbf{B}(t) = B_0 \\left[1 + \\epsilon \\sin(\\omega t)\\right]\\ \\hat{\\mathbf{z}},\n\\quad\n\\mathbf{E}(t) = E_0\\ \\hat{\\mathbf{x}},\n$$\n其中 $\\epsilon$ 是无量纲振幅，$\\omega$ 是角频率（单位为 $\\mathrm{rad/s}$），$E_0$ 是电场强度（单位为 $\\mathrm{V/m}$）。正弦函数中的角度必须以弧度为单位。\n\n按如下方式从瞬时速度和磁场计算磁矩 $\\mu(t)$：将 $\\mathbf{v}(t)$ 分解为平行于和垂直于 $\\mathbf{B}(t)$ 的分量，形成垂直动能，并使用瞬时磁场大小获得 $\\mu(t)$。根据时间序列 $\\mu(t)$，为每个测试案例计算相对于初始值的最大相对偏差，\n$$\n\\delta_{\\max} = \\max_{t \\in [0,T]} \\left| \\frac{\\mu(t) - \\mu(0)}{\\mu(0)} \\right|.\n$$\n这个 $\\delta_{\\max}$ 是一个无量纲标量，它量化了在给定的场变化下 $\\mu$ 作为绝热不变量的程度。\n\n实现以下参数值 $(\\epsilon, \\omega, E_0)$ 的测试套件以探测不同的物理机制：\n- 测试 $1$（静态场，无电场）：$(\\epsilon = 0.0,\\ \\omega = 0.0,\\ E_0 = 0.0)$，\n- 测试 $2$（慢变化，无电场）：$(\\epsilon = 0.05,\\ \\omega = 0.5,\\ E_0 = 0.0)$，\n- 测试 $3$（慢变化，小垂直电场）：$(\\epsilon = 0.05,\\ \\omega = 0.5,\\ E_0 = 1.0 \\times 10^{-3})$，\n- 测试 $4$（快变化，无电场）：$(\\epsilon = 0.3,\\ \\omega = 20.0,\\ E_0 = 0.0)$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如\n$$\n[\\delta_{\\max,1}, \\delta_{\\max,2}, \\delta_{\\max,3}, \\delta_{\\max,4}],\n$$\n其中每个条目是相应测试案例的最大相对偏差。输出是无量纲浮点数。不应打印任何其他文本。所有物理量必须按指定单位处理，角度以弧度为单位。该算法不得依赖任何外部输入或文件，并且必须是完全自包含的。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于经典力学和电磁学，问题提法清晰，提供了所有必要的信息，并且计算上是可行的。该问题是计算等离子体物理学中一个标准的、非平凡的练习。\n\n任务是模拟质子在给定的时变电磁场中的轨迹，并评估其磁矩 $\\mu(t)$（即第一绝热不变量）的守恒性。$\\mu(t)$ 的恒定性通过其与初始值的最大相对偏差 $\\delta_{\\max}$ 来量化。\n\n粒子的运动由洛伦兹力定律决定，这是一个关于位置 $\\mathbf{r}$ 和速度 $\\mathbf{v}$的一阶常微分方程组：\n$$\n\\frac{d\\mathbf{r}}{dt} = \\mathbf{v}\n$$\n$$\nm\\,\\frac{d\\mathbf{v}}{dt} = q\\left(\\mathbf{E}(t) + \\mathbf{v} \\times \\mathbf{B}(t)\\right)\n$$\n这里，$m$ 和 $q$ 分别是质子的质量和电荷。电场 $\\mathbf{E}(t) = E_0\\ \\hat{\\mathbf{x}}$ 和磁场 $\\mathbf{B}(t) = B_0 \\left[1 + \\epsilon \\sin(\\omega t)\\right]\\ \\hat{\\mathbf{z}}$ 在空间上是均匀的，但可能随时间变化。\n\n为了对这些方程进行数值积分，我们采用 Boris 算法，这是一种在等离子体模拟中广泛使用且稳健的方法。它是一种二阶精度的蛙跳积分法，以其出色的长期稳定性和守恒特性而闻名。问题规定，用于速度更新的场应在时间步的中点 $t_{n+1/2} = t_n + \\Delta t/2$ 进行评估。这导致从时间 $t_n$ 的速度 $\\mathbf{v}^n$ 更新到时间 $t_{n+1}$ 的速度 $\\mathbf{v}^{n+1}$ 的过程如下：\n\n设 $\\mathbf{r}^n$ 和 $\\mathbf{v}^n$ 分别为时间 $t_n$ 时的位置和速度。\n1.  在半步时间点评估场：$\\mathbf{E}^{n+1/2} = \\mathbf{E}(t_n + \\Delta t/2)$ 和 $\\mathbf{B}^{n+1/2} = \\mathbf{B}(t_n + \\Delta t/2)$。\n2.  执行由电场引起的第一个半步加速：\n    $$\n    \\mathbf{v}_1 = \\mathbf{v}^n + \\frac{q \\mathbf{E}^{n+1/2}}{m} \\frac{\\Delta t}{2}\n    $$\n3.  执行由磁场引起的整步旋转。这是 Boris 方法的核心：\n    $$\n    \\mathbf{h} = \\frac{q \\mathbf{B}^{n+1/2}}{m} \\frac{\\Delta t}{2}\n    $$\n    $$\n    \\mathbf{s} = \\frac{2\\mathbf{h}}{1 + |\\mathbf{h}|^2}\n    $$\n    $$\n    \\mathbf{v}_2 = \\mathbf{v}_1 + \\left( \\mathbf{v}_1 + (\\mathbf{v}_1 \\times \\mathbf{h}) \\right) \\times \\mathbf{s}\n    $$\n4.  执行由电场引起的第二个半步加速：\n    $$\n    \\mathbf{v}^{n+1} = \\mathbf{v}_2 + \\frac{q \\mathbf{E}^{n+1/2}}{m} \\frac{\\Delta t}{2}\n    $$\n5.  更新位置。为保持二阶精度，我们使用梯形法则，对步长开始和结束时的速度进行平均：\n    $$\n    \\mathbf{r}^{n+1} = \\mathbf{r}^n + \\frac{\\mathbf{v}^n + \\mathbf{v}^{n+1}}{2} \\Delta t\n    $$\n在总积分时间 $T$ 内，对每个时间步 $\\Delta t$ 重复此序列。\n\n在每个时间步 $t_n$，当状态 $(\\mathbf{r}^n, \\mathbf{v}^n)$ 已知后，我们计算瞬时磁矩 $\\mu(t_n)$。磁矩定义为粒子的垂直动能 $W_{\\perp}$ 与磁场强度 $B$ 之比：\n$$\n\\mu(t) = \\frac{W_{\\perp}(t)}{B(t)} = \\frac{\\frac{1}{2} m v_{\\perp}^2(t)}{B(t)}\n$$\n要计算 $\\mu(t_n)$，我们首先需要垂直于磁场的速度分量。给定 $\\mathbf{v}(t_n)$ 和 $\\mathbf{B}(t_n)$：\n1.  计算沿磁场方向的单位矢量：$\\hat{\\mathbf{b}}(t_n) = \\mathbf{B}(t_n) / |\\mathbf{B}(t_n)|$。\n2.  将速度矢量 $\\mathbf{v}(t_n)$ 分解为平行于和垂直于 $\\mathbf{B}(t_n)$ 的分量：\n    $$\n    v_{\\parallel}(t_n) = \\mathbf{v}(t_n) \\cdot \\hat{\\mathbf{b}}(t_n)\n    $$\n    $$\n    \\mathbf{v}_{\\parallel}(t_n) = v_{\\parallel}(t_n) \\hat{\\mathbf{b}}(t_n)\n    $$\n    $$\n    \\mathbf{v}_{\\perp}(t_n) = \\mathbf{v}(t_n) - \\mathbf{v}_{\\parallel}(t_n)\n    $$\n3.  计算垂直速度的平方，$v_{\\perp}^2(t_n) = |\\mathbf{v}_{\\perp}(t_n)|^2$。\n4.  使用上述公式计算磁矩。\n\n收集 $t_n \\in [0, T]$ 的整个 $\\mu(t_n)$ 时间序列。第一绝热不变量定理指出，如果电磁场相对于粒子的回旋周期变化缓慢，则 $\\mu$ 近似恒定。为了量化这种事后守恒的程度，我们计算模拟时间内的最大相对偏差 $\\delta_{\\max}$：\n$$\n\\delta_{\\max} = \\max_{t \\in [0,T]} \\left| \\frac{\\mu(t) - \\mu(0)}{\\mu(0)} \\right|\n$$\n为所提供的四个测试案例分别计算此无量纲度量，这些案例旨在探测不同的物理机制：静态情况（绝热）、慢场变化（绝热）、带电场的慢变化（测试漂移效应）以及快场变化（非绝热）。最终输出是这四种情况下 $\\delta_{\\max}$ 值的列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the charged particle motion problem, computes the magnetic moment time series,\n    and finds the maximum relative deviation for several test cases.\n    \"\"\"\n\n    # Physical constants\n    Q = 1.602176634e-19  # Proton charge in Coulombs\n    M = 1.67262192369e-27 # Proton mass in kg\n    Q_OVER_M = Q / M\n\n    # Simulation parameters\n    B0 = 1.0e-7          # Baseline magnetic field in Tesla\n    DT = 1.0e-3          # Time step in seconds\n    T_TOTAL = 10.0       # Total integration time in seconds\n    R0 = np.array([0.0, 0.0, 0.0]) # Initial position (m)\n    V_PERP0 = 1.0e5      # Initial perpendicular velocity (m/s)\n    V_PARA0 = 5.0e4      # Initial parallel velocity (m/s)\n    V0 = np.array([V_PERP0, 0.0, V_PARA0]) # Initial velocity vector (m/s)\n\n    # Test cases parameters (epsilon, omega, E0)\n    test_cases = [\n        (0.0, 0.0, 0.0),            # Test 1: Static B, no E\n        (0.05, 0.5, 0.0),           # Test 2: Slow B variation, no E\n        (0.05, 0.5, 1.0e-3),        # Test 3: Slow B variation, with E\n        (0.3, 20.0, 0.0),           # Test 4: Rapid B variation, no E\n    ]\n\n    results = []\n    \n    num_steps = int(T_TOTAL / DT)\n\n    for case in test_cases:\n        epsilon, omega, e0 = case\n\n        # Initialize state variables\n        r = R0.copy()\n        v = V0.copy()\n        t = 0.0\n        \n        mu_series = []\n\n        # --- Calculate mu(0) ---\n        # B-field at t=0\n        b_vec_t0 = np.array([0.0, 0.0, B0 * (1.0 + epsilon * np.sin(omega * 0.0))])\n        b_mag_t0 = np.linalg.norm(b_vec_t0)\n\n        # Decompose initial velocity\n        b_hat_t0 = b_vec_t0 / b_mag_t0 if b_mag_t0  0 else np.array([0.0, 0.0, 1.0])\n        v_para_mag_t0 = np.dot(v, b_hat_t0)\n        v_perp_sq_t0 = np.dot(v, v) - v_para_mag_t0**2\n        \n        # Magnetic moment at t=0\n        mu0 = 0.5 * M * v_perp_sq_t0 / b_mag_t0 if b_mag_t0  0 else 0.0\n        mu_series.append(mu0)\n\n        # --- Time integration loop ---\n        for i in range(num_steps):\n            # Time at step n and n+1/2\n            t_n = i * DT\n            t_half = t_n + DT / 2.0\n            \n            # Fields evaluated at t_half for Boris push\n            e_field = np.array([e0, 0.0, 0.0])\n            b_field = np.array([0.0, 0.0, B0 * (1.0 + epsilon * np.sin(omega * t_half))])\n            \n            # --- Boris Algorithm ---\n            # 1. First half-step E-acceleration\n            v1 = v + (Q_OVER_M * e_field) * (DT / 2.0)\n            \n            # 2. B-field rotation\n            h = (Q_OVER_M * b_field) * (DT / 2.0)\n            h_mag_sq = np.dot(h, h)\n            s = 2.0 * h / (1.0 + h_mag_sq)\n            \n            v_prime = v1 + np.cross(v1, h)\n            v2 = v1 + np.cross(v_prime, s)\n            \n            # 3. Second half-step E-acceleration\n            v_new = v2 + (Q_OVER_M * e_field) * (DT / 2.0)\n            \n            # 4. Position update (Trapezoidal rule)\n            r = r + (v + v_new) / 2.0 * DT\n            \n            # Update velocity for next step\n            v = v_new\n            \n            # Update time\n            t = t_n + DT\n            \n            # --- Magnetic Moment Calculation at time t ---\n            # B-field at time t\n            b_vec_t = np.array([0.0, 0.0, B0 * (1.0 + epsilon * np.sin(omega * t))])\n            b_mag_t = np.linalg.norm(b_vec_t)\n            \n            # Decompose velocity\n            if b_mag_t  0:\n                b_hat_t = b_vec_t / b_mag_t\n                v_para_mag_t = np.dot(v, b_hat_t)\n                v_perp_sq_t = np.dot(v, v) - v_para_mag_t**2\n                mu_t = 0.5 * M * v_perp_sq_t / b_mag_t\n            else: # Handle case of zero B-field\n                mu_t = 0.0\n            \n            mu_series.append(mu_t)\n\n        # --- Compute max relative deviation ---\n        mu_series_np = np.array(mu_series)\n        \n        if mu0 == 0.0:\n            # If initial mu is zero, relative error is not well-defined.\n            # A non-zero mu later would be infinite relative error.\n            # A zero mu later is zero absolute error. Max absolute should be used.\n            # Assuming mu0 > 0 for this problem as per initial conditions.\n            delta_max = np.max(np.abs(mu_series_np)) if np.max(np.abs(mu_series_np))  0 else 0.0\n        else:\n            relative_deviation = np.abs((mu_series_np - mu0) / mu0)\n            delta_max = np.max(relative_deviation)\n        \n        results.append(delta_max)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n\n```"
        }
    ]
}