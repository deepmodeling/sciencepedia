{
    "hands_on_practices": [
        {
            "introduction": "The conservation of the magnetic moment, $\\mu$, is a cornerstone of guiding-center theory, providing a powerful tool for understanding particle behavior in slowly varying magnetic fields. This first exercise puts this principle into practice, challenging you to calculate the direct consequences of a charged particle moving adiabatically into a region of stronger magnetic field . By deriving the change in the particle's perpendicular velocity and the associated grad-$B$ drift, you will solidify your understanding of how energy is partitioned in magnetized plasmas and how this affects particle transport.",
            "id": "4215537",
            "problem": "Consider a nonrelativistic, singly charged ion of charge $q$ and mass $m$ embedded in a magnetized astrophysical plasma representative of a coronal loop. The magnetic induction field is $\\boldsymbol{B}(x) = B(x)\\,\\hat{\\boldsymbol{z}}$, where $B(x)$ varies slowly and monotonically with the transverse coordinate $x$, and $\\hat{\\boldsymbol{z}}$ is a fixed unit vector. Assume the field is magnetostatic and spatially slowly varying in the precise sense that the ion’s Larmor radius and gyroperiod are much smaller than the characteristic scales of $B(x)$, so that guiding-center theory applies. The ion’s guiding center is transported adiabatically from $x=x_{0}$ to $x=x_{1}$ across the gradient by some externally imposed cross-field drift (for example, the drift produced by an externally applied Electric field ($E$)), without any component of the Electric field ($E$) parallel to $\\boldsymbol{B}$; thus magnetic forces do not perform work on the particle.\n\nAt $x=x_{0}$, the ion has perpendicular speed $v_{\\perp 0}$ and the field magnitude is $B_{0} \\equiv B(x_{0})$. The local magnetic field magnitude at the final position is $B_{1} \\equiv B(x_{1})$. The gradient is uniform, $\\partial B/\\partial x = \\alpha > 0$, so that $B(x_{1}) = B_{0} + \\alpha\\,(x_{1}-x_{0})$. You may assume that the first adiabatic invariant (the magnetic moment) is conserved during the motion.\n\nStarting only from fundamental laws of motion for charged particles in magnetostatic fields and the conservation of the first adiabatic invariant under the stated conditions, derive:\n\n1. An expression for the perpendicular speed $v_{\\perp}(x_{1})$ at the final position in terms of $v_{\\perp 0}$, $B_{0}$, and $B(x_{1})$.\n2. An expression for the ratio of the magnitude of the grad-$B$ drift speed at $x_{1}$ to that at $x_{0}$, for the geometry $\\boldsymbol{B}(x) = B(x)\\,\\hat{\\boldsymbol{z}}$ with $\\nabla B = \\alpha\\,\\hat{\\boldsymbol{x}}$.\n\nExpress your final answer as a row matrix containing, in order, the two analytic expressions derived above. No numerical evaluation is required. If you choose to evaluate numerically, report any speed in meters per second and round to four significant figures.",
            "solution": "The problem as stated is scientifically grounded in the principles of astrophysical plasma physics, specifically guiding-center theory. It is well-posed, with sufficient information to derive the requested quantities, and free of contradictions or ambiguities. The premises are physically realistic within the context of standard plasma models. Therefore, the problem is valid and a solution will be provided.\n\nThe analysis proceeds in two parts as requested.\n\n### Part 1: Derivation of the perpendicular speed $v_{\\perp}(x_{1})$\n\nThe problem states that the first adiabatic invariant, the magnetic moment $\\mu$, is conserved during the particle's motion. The magnetic moment of a charged particle gyrating in a magnetic field is given by the ratio of its perpendicular kinetic energy to the magnetic field strength:\n$$ \\mu = \\frac{\\frac{1}{2} m v_{\\perp}^2}{B} $$\nwhere $m$ is the mass of the particle, $v_{\\perp}$ is its speed perpendicular to the magnetic field $\\boldsymbol{B}$, and $B=|\\boldsymbol{B}|$ is the magnitude of the magnetic field.\n\nConservation of $\\mu$ implies that its value at the initial position $x_{0}$ is equal to its value at the final position $x_{1}$.\nLet the initial state be denoted by subscript $0$ and the final state by subscript $1$. The givens are:\n-   At $x=x_{0}$: perpendicular speed is $v_{\\perp 0}$ and magnetic field magnitude is $B_{0} = B(x_{0})$.\n-   At $x=x_{1}$: perpendicular speed is $v_{\\perp}(x_{1})$ and magnetic field magnitude is $B(x_{1})$.\n\nThe magnetic moment at the initial position is:\n$$ \\mu_{0} = \\frac{m v_{\\perp 0}^2}{2 B_{0}} $$\nThe magnetic moment at the final position is:\n$$ \\mu_{1} = \\frac{m (v_{\\perp}(x_{1}))^2}{2 B(x_{1})} $$\n\nAccording to the principle of adiabatic invariance, $\\mu_{0} = \\mu_{1}$:\n$$ \\frac{m v_{\\perp 0}^2}{2 B_{0}} = \\frac{m (v_{\\perp}(x_{1}))^2}{2 B(x_{1})} $$\nThe terms $\\frac{m}{2}$ cancel from both sides, yielding:\n$$ \\frac{v_{\\perp 0}^2}{B_{0}} = \\frac{(v_{\\perp}(x_{1}))^2}{B(x_{1})} $$\nWe can now solve for the final perpendicular speed, $v_{\\perp}(x_{1})$:\n$$ (v_{\\perp}(x_{1}))^2 = v_{\\perp 0}^2 \\frac{B(x_{1})}{B_{0}} $$\nTaking the square root (speeds are non-negative) gives the desired expression:\n$$ v_{\\perp}(x_{1}) = v_{\\perp 0} \\sqrt{\\frac{B(x_{1})}{B_{0}}} $$\nThis result shows that as the ion moves into a region of stronger magnetic field, its perpendicular speed increases such that the ratio $\\frac{v_{\\perp}^2}{B}$ remains constant.\n\n### Part 2: Ratio of grad-$B$ drift speeds\n\nThe grad-$B$ drift velocity, $\\boldsymbol{v}_{\\nabla B}$, is a fundamental drift experienced by a guiding center in a non-uniform magnetic field. It is given by the formula:\n$$ \\boldsymbol{v}_{\\nabla B} = \\frac{\\mu}{q} \\frac{\\boldsymbol{B} \\times \\nabla B}{B^2} $$\nwhere $q$ is the charge of the particle. Substituting the expression for $\\mu$:\n$$ \\boldsymbol{v}_{\\nabla B} = \\frac{1}{q} \\left( \\frac{m v_{\\perp}^2}{2 B} \\right) \\frac{\\boldsymbol{B} \\times \\nabla B}{B^2} = \\frac{m v_{\\perp}^2}{2 q} \\frac{\\boldsymbol{B} \\times \\nabla B}{B^3} $$\nThe problem specifies the geometry of the magnetic field and its gradient for this part:\n$$ \\boldsymbol{B}(x) = B(x)\\,\\hat{\\boldsymbol{z}} $$\n$$ \\nabla B = \\alpha\\,\\hat{\\boldsymbol{x}} \\quad (\\text{where } \\alpha \\text{ is a positive constant}) $$\nFirst, we compute the cross product $\\boldsymbol{B} \\times \\nabla B$:\n$$ \\boldsymbol{B} \\times \\nabla B = \\left( B(x)\\,\\hat{\\boldsymbol{z}} \\right) \\times \\left( \\alpha\\,\\hat{\\boldsymbol{x}} \\right) = \\alpha B(x) (\\hat{\\boldsymbol{z}} \\times \\hat{\\boldsymbol{x}}) = \\alpha B(x)\\,\\hat{\\boldsymbol{y}} $$\nNow, substitute this result back into the expression for $\\boldsymbol{v}_{\\nabla B}$:\n$$ \\boldsymbol{v}_{\\nabla B} = \\frac{m v_{\\perp}^2}{2 q} \\frac{\\alpha B(x)\\,\\hat{\\boldsymbol{y}}}{(B(x))^3} = \\frac{m v_{\\perp}^2 \\alpha}{2 q (B(x))^2}\\,\\hat{\\boldsymbol{y}} $$\nThe magnitude of the grad-$B$ drift speed, which we denote as $v_{\\nabla B}$, is the absolute value of the scalar coefficient:\n$$ v_{\\nabla B}(x) = |\\boldsymbol{v}_{\\nabla B}| = \\left| \\frac{m v_{\\perp}^2 \\alpha}{2 q (B(x))^2} \\right| = \\frac{m v_{\\perp}^2 \\alpha}{2 |q| (B(x))^2} $$\nsince $m$, $\\alpha$, and $v_{\\perp}^2$ are non-negative.\n\nWe need to find the ratio of the magnitude of this drift at $x_{1}$ to that at $x_{0}$.\nAt position $x_{0}$:\n$$ v_{\\nabla B, 0} = \\frac{m v_{\\perp 0}^2 \\alpha}{2 |q| B_{0}^2} $$\nAt position $x_{1}$:\n$$ v_{\\nabla B, 1} = \\frac{m (v_{\\perp}(x_{1}))^2 \\alpha}{2 |q| (B(x_{1}))^2} $$\nThe ratio is:\n$$ \\frac{v_{\\nabla B, 1}}{v_{\\nabla B, 0}} = \\frac{\\frac{m (v_{\\perp}(x_{1}))^2 \\alpha}{2 |q| (B(x_{1}))^2}}{\\frac{m v_{\\perp 0}^2 \\alpha}{2 |q| B_{0}^2}} $$\nCanceling the constant terms $\\frac{m \\alpha}{2 |q|}$, we get:\n$$ \\frac{v_{\\nabla B, 1}}{v_{\\nabla B, 0}} = \\frac{(v_{\\perp}(x_{1}))^2 / (B(x_{1}))^2}{v_{\\perp 0}^2 / B_{0}^2} = \\left( \\frac{v_{\\perp}(x_{1})}{v_{\\perp 0}} \\right)^2 \\left( \\frac{B_{0}}{B(x_{1})} \\right)^2 $$\nFrom Part 1, we have the relationship $(v_{\\perp}(x_{1}))^2 = v_{\\perp 0}^2 \\frac{B(x_{1})}{B_{0}}$. Substituting this into the ratio:\n$$ \\frac{v_{\\nabla B, 1}}{v_{\\nabla B, 0}} = \\frac{v_{\\perp 0}^2 \\frac{B(x_{1})}{B_{0}}}{v_{\\perp 0}^2} \\left( \\frac{B_{0}}{B(x_{1})} \\right)^2 = \\frac{B(x_{1})}{B_{0}} \\frac{B_{0}^2}{(B(x_{1}))^2} = \\frac{B_{0}}{B(x_{1})} $$\nThus, the ratio of the grad-$B$ drift speeds is inversely proportional to the ratio of the magnetic field strengths.\n\nThe two required expressions are:\n1.  $v_{\\perp}(x_{1}) = v_{\\perp 0} \\sqrt{\\frac{B(x_{1})}{B_{0}}}$\n2.  $\\frac{v_{\\nabla B, 1}}{v_{\\nabla B, 0}} = \\frac{B_{0}}{B(x_{1})}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} v_{\\perp 0} \\sqrt{\\frac{B(x_{1})}{B_{0}}} & \\frac{B_{0}}{B(x_{1})} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "An invariant is only as useful as its domain of validity. The first adiabatic invariant, $\\mu$, is conserved only when the magnetic field changes \"slowly\" from the particle's perspective. This practice delves into the crucial question of what \"slowly\" means by asking you to quantify the conditions under which adiabatic invariance breaks down . By analyzing how spatial gradients and temporal fluctuations contribute to non-adiabatic behavior, you will gain a deeper appreciation for the limits of this powerful approximation and the physics of resonant particle interactions.",
            "id": "4215582",
            "problem": "A non-relativistic charged particle of mass $m$ and charge $q$ moves in a magnetized astrophysical plasma in which the magnetic field is the superposition of a uniform background and small spatio-temporal variations aligned with the background field. Let the background magnetic field be $\\mathbf{B}_{0} = B_{0}\\,\\hat{\\mathbf{z}}$, and let the perturbation be described by\n$$\nB(x,t) = B_{0}\\left[1 + \\alpha\\,\\frac{x}{L} + \\beta\\,\\cos(\\omega t)\\right],\n$$\nwith $|\\alpha| \\ll 1$, $|\\beta| \\ll 1$, and $L$ a characteristic gradient scale. Assume the particle’s perpendicular motion is a circular gyro-orbit with radius $\\rho$ and angular frequency $\\Omega = q B_{0}/m$, so that its instantaneous position in the plane perpendicular to $\\hat{\\mathbf{z}}$ can be approximated by $x(t) = \\rho \\cos(\\Omega t + \\varphi)$ for some constant phase $\\varphi$, and its perpendicular speed $v_{\\perp}$ is constant over one gyroperiod in the absence of rapid energy exchange. The first adiabatic invariant (the magnetic moment) is defined as $\\mu = m v_{\\perp}^{2}/(2B)$.\n\nStarting from the Lorentz force law and the definition of the adiabatic invariant as the action associated with the fast gyromotion, derive a criterion for the adiabatic invariance of $\\mu$ in terms of the fractional change of $B$ experienced by the particle over one gyroperiod. For the specific field model given above, compute the leading-order expression for the characteristic fractional change\n$$\n\\frac{\\delta B}{B} \\equiv \\frac{\\max_{t \\in [t_{0},\\,t_{0}+T]} B(x(t),t) - \\min_{t \\in [t_{0},\\,t_{0}+T]} B(x(t),t)}{B_{0}},\n$$\nwhere $T = 2\\pi/\\Omega$ is the gyroperiod, and identify scenarios in which the adiabatic invariance of $\\mu$ fails. Then, using the general adiabatic reasoning, determine the threshold value (as a single dimensionless number) for breakdown of adiabatic invariance in terms of $\\delta B/B$ evaluated over one gyroperiod. The final answer must be a single dimensionless number and needs no rounding.",
            "solution": "The problem statement is first validated to ensure it is scientifically sound, well-posed, and objective.\n\n### Step 1: Extract Givens\n- A non-relativistic charged particle with mass $m$ and charge $q$.\n- The magnetic field is given by the superposition of a uniform background $\\mathbf{B}_{0} = B_{0}\\,\\hat{\\mathbf{z}}$ and a perturbation. The total magnetic field magnitude is $B(x,t) = B_{0}\\left[1 + \\alpha\\,\\frac{x}{L} + \\beta\\,\\cos(\\omega t)\\right]$.\n- The perturbation parameters are small: $|\\alpha| \\ll 1$ and $|\\beta| \\ll 1$.\n- $L$ is a characteristic gradient scale length.\n- The particle's perpendicular motion is approximated as a circular gyro-orbit.\n- Gyroradius: $\\rho$.\n- Gyrofrequency: $\\Omega = q B_{0}/m$.\n- Particle's instantaneous x-position: $x(t) = \\rho \\cos(\\Omega t + \\varphi)$, where $\\varphi$ is a constant phase.\n- The perpendicular speed $v_{\\perp}$ is constant over one gyroperiod in the absence of rapid energy exchange.\n- The first adiabatic invariant (magnetic moment) is defined as $\\mu = \\frac{m v_{\\perp}^{2}}{2B}$.\n- The characteristic fractional change of the magnetic field is defined as $\\frac{\\delta B}{B} \\equiv \\frac{\\max_{t \\in [t_{0},\\,t_{0}+T]} B(x(t),t) - \\min_{t \\in [t_{0},\\,t_{0}+T]} B(x(t),t)}{B_{0}}$, where $T = 2\\pi/\\Omega$ is the gyroperiod.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem is a classic example within astrophysical plasma physics, dealing with the guiding-center approximation and the conservation of the first adiabatic invariant. The field model is a standard linearization of a more complex field, and the core concepts are fundamental to the discipline. The setup is scientifically valid.\n- **Well-Posed:** The problem asks for a derivation of a condition, a calculation for a specific model, an identification of failure scenarios, and a determination of a numerical threshold. All tasks are clearly defined and lead to a unique and meaningful solution based on the provided information.\n- **Objective:** The problem is phrased in precise, standard scientific language, free of subjective or ambiguous terminology.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid as it is scientifically sound, well-posed, objective, and self-contained. Proceeding to the solution.\n\n***\n\nThe first adiabatic invariant, the magnetic moment $\\mu = m v_{\\perp}^{2}/(2B)$, is conserved when the magnetic field $B$ experienced by the particle changes slowly compared to the particle's gyromotion period, $T = 2\\pi/\\Omega$. This principle of \"slowness\" is the cornerstone of adiabatic theory. It requires that the fractional change in the system's parameters over one period of its fast motion is much less than unity. In this context, the parameter is the magnetic field $B$ and the period is the gyroperiod $T$.\n\nThe problem provides a specific quantitative measure for this fractional change:\n$$\n\\frac{\\delta B}{B} = \\frac{\\max_{t \\in [t_{0},\\,t_{0}+T]} B(t) - \\min_{t \\in [t_{0},\\,t_{0}+T]} B(t)}{B_{0}}\n$$\nwhere $B(t)$ is the magnetic field evaluated along the particle's trajectory. The general criterion for the adiabatic invariance of $\\mu$ is that this fractional change must be much smaller than $1$:\n$$\n\\frac{\\delta B}{B} \\ll 1\n$$\nWhen this condition is violated, the invariant is no longer conserved.\n\nNext, we compute the leading-order expression for $\\frac{\\delta B}{B}$ for the given field model. The magnetic field experienced by the particle is found by substituting the particle's path $x(t) = \\rho \\cos(\\Omega t + \\varphi)$ into the expression for $B(x,t)$:\n$$\nB(t) = B_{0}\\left[1 + \\alpha\\,\\frac{\\rho}{L}\\cos(\\Omega t + \\varphi) + \\beta\\,\\cos(\\omega t)\\right]\n$$\nTo find $\\frac{\\delta B}{B}$, we must find the maximum and minimum of this expression over one gyroperiod, $t \\in [t_0, t_0+T]$. This is equivalent to finding the range of the function $g(t) = \\alpha\\,\\frac{\\rho}{L}\\cos(\\Omega t + \\varphi) + \\beta\\,\\cos(\\omega t)$.\n$$\n\\frac{\\delta B}{B} = \\max_{t \\in [t_{0},\\,t_{0}+T]} g(t) - \\min_{t \\in [t_{0},\\,t_{0}+T]} g(t)\n$$\nThe function $g(t)$ is a sum of two contributions: a spatial part, due to the particle's motion through the field gradient, and a temporal part, due to the intrinsic time variation of the field.\nThe spatial part is $g_s(t) = \\alpha\\,\\frac{\\rho}{L}\\cos(\\Omega t + \\varphi)$. Over one gyroperiod $T = 2\\pi/\\Omega$, the argument of the cosine, $\\Omega t+\\varphi$, sweeps through an interval of length $2\\pi$. Thus, this term explores its full range from $-|\\alpha|\\rho/L$ to $+|\\alpha|\\rho/L$. The range (max - min) contributed by the spatial part is $2|\\alpha|\\frac{\\rho}{L}$.\n\nThe temporal part is $g_t(t) = \\beta\\,\\cos(\\omega t)$. Its range over the interval $[t_0, t_0+T]$ depends on the ratio of frequencies $\\omega/\\Omega$. The phase of this term, $\\omega t$, advances by $\\Delta(\\omega t) = \\omega T = 2\\pi\\omega/\\Omega$ during one gyroperiod.\n- If $\\omega \\ll \\Omega$, the phase advance is small, and $\\cos(\\omega t)$ is nearly constant. The range is small, proportional to $\\omega/\\Omega$.\n- If $\\omega/\\Omega \\ge 1/2$, the phase advance $\\Delta(\\omega t)$ is at least $\\pi$. Over such an interval, the cosine function will attain both its maximum ($+1$) and minimum ($-1$). Thus, for fast temporal variations, the range of $g_t(t)$ is $2|\\beta|$.\n\nAdiabatic invariance fails when changes are rapid. This corresponds to two main scenarios:\n1.  The spatial scale of variation $L$ is comparable to or smaller than the gyroradius $\\rho$, making the term $|\\alpha|\\rho/L$ non-negligible.\n2.  The temporal frequency of the field $\\omega$ is comparable to or larger than the gyrofrequency $\\Omega$. This includes the critical case of cyclotron resonance, $\\omega \\approx \\Omega$.\n\nThe characteristic fractional change asked for should represent the conditions where adiabaticity is most strongly violated. This occurs for fast or resonant variations ($\\omega/\\Omega \\gtrsim 1/2$). In this regime, the range of the temporal part is $2|\\beta|$. The \"worst-case\" scenario for the total range occurs when the extrema of the spatial and temporal parts align, as they do in the resonant case $\\omega = \\Omega$. In this case, the total range is the sum of the individual ranges. Therefore, the leading-order expression for the characteristic fractional change is:\n$$\n\\frac{\\delta B}{B} \\approx 2|\\alpha|\\frac{\\rho}{L} + 2|\\beta|\n$$\nThis expression combines the two primary mechanisms for breaking the adiabatic invariance: a large spatial gradient relative to the gyroradius ($|\\alpha|\\rho/L$) and a large-amplitude, high-frequency temporal oscillation ($|\\beta|$ and $\\omega/\\Omega \\gtrsim 1/2$).\n\nFinally, we must determine the threshold value for the breakdown of adiabatic invariance. The condition for invariance is $\\frac{\\delta B}{B} \\ll 1$. The breakdown of this condition occurs when the quantity $\\frac{\\delta B}{B}$ is no longer \"much less than 1\" but instead becomes of order unity. By convention in physics, the threshold for such an order-of-magnitude condition is reached when the quantity equals $1$. Therefore, the breakdown of adiabatic invariance occurs when $\\frac{\\delta B}{B} \\approx 1$. The threshold value is the dimensionless number itself.",
            "answer": "$$\n\\boxed{1}\n$$"
        },
        {
            "introduction": "Bridging the gap between analytical theory and practical application, this final exercise invites you to numerically verify the principles of adiabatic invariance. You will implement a test-particle simulation to integrate a proton's trajectory and compute the time evolution of its magnetic moment under different field conditions . This computational approach provides a powerful and tangible way to observe the robust conservation of $\\mu$ in the adiabatic regime and its clear violation when the fields change too rapidly, reinforcing the theoretical concepts with direct, quantitative evidence.",
            "id": "4215562",
            "problem": "A single charged particle moving in prescribed electromagnetic fields is governed by the Lorentz force law, which is a fundamental statement of classical electrodynamics and mechanics. The goal is to compute the time series of the first adiabatic invariant, known as the magnetic moment, denoted by $\\mu(t)$, from a numerical test-particle integration that is consistent with Particle-In-Cell (PIC) methodology, and to assess the degree to which $\\mu(t)$ remains constant under various field variations.\n\nStarting from the fundamental base, the particle obeys the equation of motion\n$$\nm\\,\\frac{d\\mathbf{v}}{dt} = q\\left(\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B}\\right), \\quad \\frac{d\\mathbf{r}}{dt} = \\mathbf{v},\n$$\nwhere $m$ is the particle mass, $q$ is the particle charge, $\\mathbf{v}$ is velocity, $\\mathbf{r}$ is position, $\\mathbf{E}$ is the electric field, and $\\mathbf{B}$ is the magnetic field. The magnetic moment $\\mu(t)$ is computed from the particle’s instantaneous motion relative to the local magnetic field and must be extracted from the perpendicular component of the kinetic energy with respect to the instantaneous magnetic field magnitude. The numerical integrator must time-center the fields to avoid spurious energy gain or loss, consistent with widely used PIC and test-particle schemes.\n\nYou must implement a time-centered rotation-acceleration algorithm (Boris method) for the Lorentz force update. The magnetic moment $\\mu(t)$ should be computed at every time step from the particle’s instantaneous velocity and magnetic field, using the decomposition of velocity into components parallel and perpendicular to the magnetic field direction. The adiabatic invariance of $\\mu(t)$ should then be assessed by computing a scalar metric that quantifies its constancy. Use radians for any trigonometric function arguments.\n\nYour program must:\n- Integrate a single proton with charge $q = +e$ and mass $m = m_{\\mathrm{p}}$ in spatially uniform but time-dependent fields $\\mathbf{E}(t)$ and $\\mathbf{B}(t)$.\n- Use the following constants and initial conditions:\n  - $q = 1.602176634 \\times 10^{-19}\\ \\mathrm{C}$,\n  - $m = 1.67262192369 \\times 10^{-27}\\ \\mathrm{kg}$,\n  - baseline magnetic field magnitude $B_0 = 1.0 \\times 10^{-7}\\ \\mathrm{T}$,\n  - time step $\\Delta t = 1.0 \\times 10^{-3}\\ \\mathrm{s}$,\n  - total integration time $T = 10.0\\ \\mathrm{s}$,\n  - initial position $\\mathbf{r}(0) = (0,0,0)\\ \\mathrm{m}$,\n  - initial velocity $\\mathbf{v}(0) = (v_{\\perp 0}, 0, v_{\\parallel 0})\\ \\mathrm{m/s}$ with $v_{\\perp 0} = 1.0 \\times 10^{5}\\ \\mathrm{m/s}$ and $v_{\\parallel 0} = 5.0 \\times 10^{4}\\ \\mathrm{m/s}$.\n- At each step, time-center the fields at $t + \\Delta t/2$ for the velocity update.\n\nDefine the fields for each test case as\n$$\n\\mathbf{B}(t) = B_0 \\left[1 + \\epsilon \\sin(\\omega t)\\right]\\ \\hat{\\mathbf{z}},\n\\quad\n\\mathbf{E}(t) = E_0\\ \\hat{\\mathbf{x}},\n$$\nwhere $\\epsilon$ is a dimensionless amplitude, $\\omega$ is an angular frequency in $\\mathrm{rad/s}$, and $E_0$ is an electric field magnitude in $\\mathrm{V/m}$. Angles in the sine function must be in radians.\n\nCompute the magnetic moment $\\mu(t)$ from the instantaneous velocity and magnetic field as follows: decompose $\\mathbf{v}(t)$ into components parallel and perpendicular to $\\mathbf{B}(t)$, form the perpendicular kinetic energy, and use the instantaneous magnetic field magnitude to obtain $\\mu(t)$. From the time series $\\mu(t)$, compute for each test case the maximum relative deviation with respect to the initial value,\n$$\n\\delta_{\\max} = \\max_{t \\in [0,T]} \\left| \\frac{\\mu(t) - \\mu(0)}{\\mu(0)} \\right|.\n$$\nThis $\\delta_{\\max}$ is a dimensionless scalar that quantifies the degree to which $\\mu$ is an adiabatic invariant under the prescribed field variation.\n\nImplement the following test suite of parameter values $(\\epsilon, \\omega, E_0)$ to probe different regimes:\n- Test $1$ (static field, no electric field): $(\\epsilon = 0.0,\\ \\omega = 0.0,\\ E_0 = 0.0)$,\n- Test $2$ (slow variation, no electric field): $(\\epsilon = 0.05,\\ \\omega = 0.5,\\ E_0 = 0.0)$,\n- Test $3$ (slow variation, small perpendicular electric field): $(\\epsilon = 0.05,\\ \\omega = 0.5,\\ E_0 = 1.0 \\times 10^{-3})$,\n- Test $4$ (rapid variation, no electric field): $(\\epsilon = 0.3,\\ \\omega = 20.0,\\ E_0 = 0.0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example\n$$\n[\\delta_{\\max,1}, \\delta_{\\max,2}, \\delta_{\\max,3}, \\delta_{\\max,4}],\n$$\nwhere each entry is the maximum relative deviation for the corresponding test case. The outputs are dimensionless floating-point numbers. No other text should be printed. All physical quantities must be treated in the specified units, with angles in radians. The algorithm must not rely on any external input or files and must be fully self-contained.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in classical mechanics and electromagnetism, well-posed with all necessary information provided, and computationally feasible. The problem constitutes a standard, non-trivial exercise in computational plasma physics.\n\nThe task is to simulate the trajectory of a proton in specified time-varying electromagnetic fields and to evaluate the conservation of its magnetic moment, $\\mu(t)$, which is the first adiabatic invariant. The constancy of $\\mu(t)$ is quantified by its maximum relative deviation, $\\delta_{\\max}$, from its initial value.\n\nThe particle's motion is governed by the Lorentz force law, a system of first-order ordinary differential equations for position $\\mathbf{r}$ and velocity $\\mathbf{v}$:\n$$\n\\frac{d\\mathbf{r}}{dt} = \\mathbf{v}\n$$\n$$\nm\\,\\frac{d\\mathbf{v}}{dt} = q\\left(\\mathbf{E}(t) + \\mathbf{v} \\times \\mathbf{B}(t)\\right)\n$$\nHere, $m$ and $q$ are the mass and charge of the proton. The electric field $\\mathbf{E}(t) = E_0\\ \\hat{\\mathbf{x}}$ and magnetic field $\\mathbf{B}(t) = B_0 \\left[1 + \\epsilon \\sin(\\omega t)\\right]\\ \\hat{\\mathbf{z}}$ are spatially uniform but may be time-dependent.\n\nTo numerically integrate these equations, we employ the Boris algorithm, a widely-used and robust method in plasma simulations. It is a second-order accurate leapfrog integrator known for its excellent long-term stability and conservation properties. The problem specifies that fields for the velocity update should be evaluated at the midpoint of the time step, $t_{n+1/2} = t_n + \\Delta t/2$. This leads to a velocity update from $\\mathbf{v}^n$ at time $t_n$ to $\\mathbf{v}^{n+1}$ at time $t_{n+1}$ as follows:\n\nLet $\\mathbf{r}^n$ and $\\mathbf{v}^n$ be the position and velocity at time $t_n$.\n1.  Evaluate fields at the half-step time: $\\mathbf{E}^{n+1/2} = \\mathbf{E}(t_n + \\Delta t/2)$ and $\\mathbf{B}^{n+1/2} = \\mathbf{B}(t_n + \\Delta t/2)$.\n2.  Perform the first half-step acceleration due to the electric field:\n    $$\n    \\mathbf{v}_1 = \\mathbf{v}^n + \\frac{q \\mathbf{E}^{n+1/2}}{m} \\frac{\\Delta t}{2}\n    $$\n3.  Perform the full-step rotation due to the magnetic field. This is the core of the Boris method:\n    $$\n    \\mathbf{h} = \\frac{q \\mathbf{B}^{n+1/2}}{m} \\frac{\\Delta t}{2}\n    $$\n    $$\n    \\mathbf{s} = \\frac{2\\mathbf{h}}{1 + |\\mathbf{h}|^2}\n    $$\n    $$\n    \\mathbf{v}_2 = \\mathbf{v}_1 + \\left( \\mathbf{v}_1 + (\\mathbf{v}_1 \\times \\mathbf{h}) \\right) \\times \\mathbf{s}\n    $$\n4.  Perform the second half-step acceleration due to the electric field:\n    $$\n    \\mathbf{v}^{n+1} = \\mathbf{v}_2 + \\frac{q \\mathbf{E}^{n+1/2}}{m} \\frac{\\Delta t}{2}\n    $$\n5.  Update the position. To maintain second-order accuracy, we use the trapezoidal rule, averaging the velocities at the beginning and end of the step:\n    $$\n    \\mathbf{r}^{n+1} = \\mathbf{r}^n + \\frac{\\mathbf{v}^n + \\mathbf{v}^{n+1}}{2} \\Delta t\n    $$\nThis sequence is repeated for each time step $\\Delta t$ over the total integration time $T$.\n\nAt each time step $t_n$, after the state $(\\mathbf{r}^n, \\mathbf{v}^n)$ is known, we compute the instantaneous magnetic moment $\\mu(t_n)$. The magnetic moment is defined as the ratio of the particle's perpendicular kinetic energy $W_{\\perp}$ to the magnetic field strength $B$:\n$$\n\\mu(t) = \\frac{W_{\\perp}(t)}{B(t)} = \\frac{\\frac{1}{2} m v_{\\perp}^2(t)}{B(t)}\n$$\nTo calculate $\\mu(t_n)$, we first need the velocity component perpendicular to the magnetic field. Given $\\mathbf{v}(t_n)$ and $\\mathbf{B}(t_n)$:\n1.  Compute the unit vector along the magnetic field: $\\hat{\\mathbf{b}}(t_n) = \\mathbf{B}(t_n) / |\\mathbf{B}(t_n)|$.\n2.  Decompose the velocity vector $\\mathbf{v}(t_n)$ into components parallel and perpendicular to $\\mathbf{B}(t_n)$:\n    $$\n    v_{\\parallel}(t_n) = \\mathbf{v}(t_n) \\cdot \\hat{\\mathbf{b}}(t_n)\n    $$\n    $$\n    \\mathbf{v}_{\\parallel}(t_n) = v_{\\parallel}(t_n) \\hat{\\mathbf{b}}(t_n)\n    $$\n    $$\n    \\mathbf{v}_{\\perp}(t_n) = \\mathbf{v}(t_n) - \\mathbf{v}_{\\parallel}(t_n)\n    $$\n3.  Calculate the square of the perpendicular speed, $v_{\\perp}^2(t_n) = |\\mathbf{v}_{\\perp}(t_n)|^2$.\n4.  Compute the magnetic moment using the formula above.\n\nThe entire time series of $\\mu(t_n)$ for $t_n \\in [0, T]$ is collected. The first adiabatic invariant theorem states that $\\mu$ is nearly constant if the electromagnetic fields vary slowly compared to the particle's gyroperiod. To quantify the degree of this a-posteriori conservation, we compute the maximum relative deviation $\\delta_{\\max}$ over the simulation time:\n$$\n\\delta_{\\max} = \\max_{t \\in [0,T]} \\left| \\frac{\\mu(t) - \\mu(0)}{\\mu(0)} \\right|\n$$\nThis dimensionless metric is calculated for each of the four test cases provided, which are designed to probe different physical regimes: a static case (adiabatic), a slow field variation (adiabatic), a slow variation with an electric field (testing drift effects), and a rapid field variation (non-adiabatic). The final output is a list of the $\\delta_{\\max}$ values for these four cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the charged particle motion problem, computes the magnetic moment time series,\n    and finds the maximum relative deviation for several test cases.\n    \"\"\"\n\n    # Physical constants\n    Q = 1.602176634e-19  # Proton charge in Coulombs\n    M = 1.67262192369e-27 # Proton mass in kg\n    Q_OVER_M = Q / M\n\n    # Simulation parameters\n    B0 = 1.0e-7          # Baseline magnetic field in Tesla\n    DT = 1.0e-3          # Time step in seconds\n    T_TOTAL = 10.0       # Total integration time in seconds\n    R0 = np.array([0.0, 0.0, 0.0]) # Initial position (m)\n    V_PERP0 = 1.0e5      # Initial perpendicular velocity (m/s)\n    V_PARA0 = 5.0e4      # Initial parallel velocity (m/s)\n    V0 = np.array([V_PERP0, 0.0, V_PARA0]) # Initial velocity vector (m/s)\n\n    # Test cases parameters (epsilon, omega, E0)\n    test_cases = [\n        (0.0, 0.0, 0.0),            # Test 1: Static B, no E\n        (0.05, 0.5, 0.0),           # Test 2: Slow B variation, no E\n        (0.05, 0.5, 1.0e-3),        # Test 3: Slow B variation, with E\n        (0.3, 20.0, 0.0),           # Test 4: Rapid B variation, no E\n    ]\n\n    results = []\n    \n    num_steps = int(T_TOTAL / DT)\n\n    for case in test_cases:\n        epsilon, omega, e0 = case\n\n        # Initialize state variables\n        r = R0.copy()\n        v = V0.copy()\n        t = 0.0\n        \n        mu_series = []\n\n        # --- Calculate mu(0) ---\n        # B-field at t=0\n        b_vec_t0 = np.array([0.0, 0.0, B0 * (1.0 + epsilon * np.sin(omega * 0.0))])\n        b_mag_t0 = np.linalg.norm(b_vec_t0)\n\n        # Decompose initial velocity\n        b_hat_t0 = b_vec_t0 / b_mag_t0 if b_mag_t0 > 0 else np.array([0.0, 0.0, 1.0])\n        v_para_mag_t0 = np.dot(v, b_hat_t0)\n        v_perp_sq_t0 = np.dot(v, v) - v_para_mag_t0**2\n        \n        # Magnetic moment at t=0\n        mu0 = 0.5 * M * v_perp_sq_t0 / b_mag_t0 if b_mag_t0 > 0 else 0.0\n        mu_series.append(mu0)\n\n        # --- Time integration loop ---\n        for i in range(num_steps):\n            # Time at step n and n+1/2\n            t_n = i * DT\n            t_half = t_n + DT / 2.0\n            \n            # Fields evaluated at t_half for Boris push\n            e_field = np.array([e0, 0.0, 0.0])\n            b_field = np.array([0.0, 0.0, B0 * (1.0 + epsilon * np.sin(omega * t_half))])\n            \n            # --- Boris Algorithm ---\n            # 1. First half-step E-acceleration\n            v1 = v + (Q_OVER_M * e_field) * (DT / 2.0)\n            \n            # 2. B-field rotation\n            h = (Q_OVER_M * b_field) * (DT / 2.0)\n            h_mag_sq = np.dot(h, h)\n            s = 2.0 * h / (1.0 + h_mag_sq)\n            \n            v_prime = v1 + np.cross(v1, h)\n            v2 = v1 + np.cross(v_prime, s)\n            \n            # 3. Second half-step E-acceleration\n            v_new = v2 + (Q_OVER_M * e_field) * (DT / 2.0)\n            \n            # 4. Position update (Trapezoidal rule)\n            r = r + (v + v_new) / 2.0 * DT\n            \n            # Update velocity for next step\n            v = v_new\n            \n            # Update time\n            t = t_n + DT\n            \n            # --- Magnetic Moment Calculation at time t ---\n            # B-field at time t\n            b_vec_t = np.array([0.0, 0.0, B0 * (1.0 + epsilon * np.sin(omega * t))])\n            b_mag_t = np.linalg.norm(b_vec_t)\n            \n            # Decompose velocity\n            if b_mag_t > 0:\n                b_hat_t = b_vec_t / b_mag_t\n                v_para_mag_t = np.dot(v, b_hat_t)\n                v_perp_sq_t = np.dot(v, v) - v_para_mag_t**2\n                mu_t = 0.5 * M * v_perp_sq_t / b_mag_t\n            else: # Handle case of zero B-field\n                mu_t = 0.0\n            \n            mu_series.append(mu_t)\n\n        # --- Compute max relative deviation ---\n        mu_series_np = np.array(mu_series)\n        \n        if mu0 == 0.0:\n            # If initial mu is zero, relative error is not well-defined.\n            # A non-zero mu later would be infinite relative error.\n            # A zero mu later is zero absolute error. Max absolute should be used.\n            # Assuming mu0 > 0 for this problem as per initial conditions.\n            delta_max = np.max(np.abs(mu_series_np)) if np.max(np.abs(mu_series_np)) > 0 else 0.0\n        else:\n            relative_deviation = np.abs((mu_series_np - mu0) / mu0)\n            delta_max = np.max(relative_deviation)\n        \n        results.append(delta_max)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n\n```"
        }
    ]
}