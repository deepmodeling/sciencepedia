{
    "hands_on_practices": [
        {
            "introduction": "Understanding Miller indices begins with their fundamental geometric definition. This practice guides you through the process of determining the Miller indices for a plane starting from three points it intersects, a common scenario when analyzing crystal structures . By first deriving the plane's equation using vector algebra, you will solidify the connection between a plane's spatial orientation and its crystallographic notation.",
            "id": "2779321",
            "problem": "In a cubic crystal relevant to nanomechanics and surface and interface science, atomic planes govern slip, adhesion, and interfacial energies. Consider a conventional cubic Bravais lattice with lattice vectors $\\mathbf{a}_{1}$, $\\mathbf{a}_{2}$, and $\\mathbf{a}_{3}$. Fractional (reduced) coordinates $(u,v,w)$ denote the point $\\mathbf{r} = u\\,\\mathbf{a}_{1} + v\\,\\mathbf{a}_{2} + w\\,\\mathbf{a}_{3}$. An experimentally identified atomic plane passes through the $3$ axis-intercept points at fractional coordinates $(1,0,0)$, $(0,\\tfrac{1}{2},0)$, and $(0,0,\\tfrac{1}{3})$. Starting from the core definition that Miller indices $(h\\,k\\,l)$ label a crystal plane by the smallest set of integers proportional to the reciprocals of its fractional intercepts with the crystallographic axes, do the following:\n- Derive the equation of the unique plane in the fractional-coordinate space $(u,v,w)$ that passes through the given three points. Use only vector algebra and the definition of a plane in three-dimensional space to establish the plane equation and thereby confirm coplanarity of the three points.\n- From your derived plane equation, determine the Miller indices $(h\\,k\\,l)$ as the smallest integers with no common divisor, consistent with the definition.\n\nReport your final answer as the Miller triplet in a single row matrix $\\bigl(h\\;k\\;l\\bigr)$. Do not include units. No rounding is required.",
            "solution": "We begin from the fundamental geometric description of a plane in three-dimensional space. Given three non-colinear points, there exists a unique plane that contains them. In fractional-coordinate space $(u,v,w)$ associated with the cubic crystallographic axes, the three points are\n$$(u_{1},v_{1},w_{1}) = (1,0,0), \\quad (u_{2},v_{2},w_{2}) = \\left(0,\\tfrac{1}{2},0\\right), \\quad (u_{3},v_{3},w_{3}) = \\left(0,0,\\tfrac{1}{3}\\right).$$\nDefine two independent direction vectors within the plane:\n$$\\mathbf{v}_{1} = (u_{2}-u_{1},\\,v_{2}-v_{1},\\,w_{2}-w_{1}) = \\left(-1,\\,\\tfrac{1}{2},\\,0\\right),$$\n$$\\mathbf{v}_{2} = (u_{3}-u_{1},\\,v_{3}-v_{1},\\,w_{3}-w_{1}) = \\left(-1,\\,0,\\,\\tfrac{1}{3}\\right).$$\nA normal vector $\\mathbf{n}$ to the plane is given by the cross product $\\mathbf{n} = \\mathbf{v}_{1} \\times \\mathbf{v}_{2}$. Compute\n$$\\mathbf{n} = \n\\begin{vmatrix}\n\\mathbf{i} & \\mathbf{j} & \\mathbf{k} \\\\\n-1 & \\tfrac{1}{2} & 0 \\\\\n-1 & 0 & \\tfrac{1}{3}\n\\end{vmatrix}\n= \\mathbf{i}\\left(\\tfrac{1}{2}\\cdot\\tfrac{1}{3} - 0\\cdot 0\\right) - \\mathbf{j}\\left((-1)\\cdot\\tfrac{1}{3} - 0\\cdot(-1)\\right) + \\mathbf{k}\\left((-1)\\cdot 0 - \\tfrac{1}{2}\\cdot(-1)\\right).$$\nThus\n$$\\mathbf{n} = \\left(\\tfrac{1}{6},\\,\\tfrac{1}{3},\\,\\tfrac{1}{2}\\right).$$\nMultiplying by $6$ (a nonzero scalar) gives a proportional integer normal vector\n$$\\mathbf{n}' = (1,\\,2,\\,3).$$\nA plane with normal $\\mathbf{n}'$ passing through $(u_{1},v_{1},w_{1})=(1,0,0)$ has the equation\n$$\\mathbf{n}'\\cdot\\bigl[(u,v,w)-(1,0,0)\\bigr] = 0.$$\nExpanding yields\n$$(1,2,3)\\cdot(u-1,\\,v-0,\\,w-0) = 0 \\;\\;\\Rightarrow\\;\\; 1\\cdot(u-1) + 2\\cdot v + 3\\cdot w = 0,$$\nwhich simplifies to\n$$u + 2v + 3w = 1.$$\nThis is the plane equation in the fractional-coordinate space. Substituting each of the three given points confirms coplanarity:\n- For $(1,0,0)$: $1 + 2\\cdot 0 + 3\\cdot 0 = 1$, satisfied.\n- For $\\left(0,\\tfrac{1}{2},0\\right)$: $0 + 2\\cdot \\tfrac{1}{2} + 0 = 1$, satisfied.\n- For $\\left(0,0,\\tfrac{1}{3}\\right)$: $0 + 0 + 3\\cdot \\tfrac{1}{3} = 1$, satisfied.\nHence the three points are coplanar and define this unique plane.\n\nTo obtain the Miller indices $(h\\,k\\,l)$, use the core definition: they are proportional to the reciprocals of the plane’s fractional intercepts with the crystallographic axes. From the plane equation $u + 2v + 3w = 1$, the intercepts are found by setting two coordinates to zero:\n- $u$-intercept: set $v=0$ and $w=0$, giving $u=1$.\n- $v$-intercept: set $u=0$ and $w=0$, giving $2v=1 \\Rightarrow v=\\tfrac{1}{2}$.\n- $w$-intercept: set $u=0$ and $v=0$, giving $3w=1 \\Rightarrow w=\\tfrac{1}{3}$.\nTake reciprocals to obtain the triplet proportional to $(h\\,k\\,l)$:\n$$\\left(\\frac{1}{1},\\,\\frac{1}{1/2},\\,\\frac{1}{1/3}\\right) = (1,\\,2,\\,3).$$\nThese are already the smallest integers with no common divisor, so the Miller indices are $(1\\,2\\,3)$.",
            "answer": "$$\\boxed{\\begin{pmatrix}1 & 2 & 3\\end{pmatrix}}$$"
        },
        {
            "introduction": "A crystal plane is not just an abstract surface; it contains a specific two-dimensional arrangement of atoms defined by lattice directions lying within it. This exercise focuses on applying the Weiss zone law, $hu+kv+lw=0$, which is the mathematical condition for a direction $[uvw]$ to lie within a plane $(hkl)$ . You will identify the shortest, non-collinear lattice vectors that form the basis for a given plane, a critical skill for analyzing surface properties and deformation mechanisms.",
            "id": "2779302",
            "problem": "In a simple cubic crystal with lattice parameter $a = 0.400$ nm, consider the crystal plane with Miller indices $(hkl) = (311)$. Use only fundamental definitions of lattice directions and planes as follows: a lattice direction $[uvw]$ corresponds to the shortest real-space lattice translation $\\mathbf{r} = u\\,\\mathbf{a}_{1} + v\\,\\mathbf{a}_{2} + w\\,\\mathbf{a}_{3}$ with $\\gcd(u,v,w) = 1$, and a plane $(hkl)$ has a real-space normal parallel to the reciprocal lattice vector $\\mathbf{G} = h\\,\\mathbf{b}_{1} + k\\,\\mathbf{b}_{2} + l\\,\\mathbf{b}_{3}$, where $\\mathbf{a}_{i}\\cdot\\mathbf{b}_{j} = 2\\pi\\,\\delta_{ij}$. \n\nStarting from these definitions and the condition for a direction to lie in a plane, do the following:\n\n1. Derive the condition that a direction $[uvw]$ lies within the plane $(311)$ in this simple cubic lattice.\n2. Find two distinct, non-collinear lattice directions with minimal integer indices that lie within the plane $(311)$. Among all such pairs, choose a pair that spans the smallest-area in-plane parallelogram formed by the shortest lattice translation vectors along those directions.\n3. Verify explicitly that each of your two directions satisfies the condition derived in part 1.\n4. Compute the area of that smallest in-plane parallelogram spanned by the shortest translation vectors along your two directions. Express the final area in nm$^{2}$ and round your answer to four significant figures.\n\nYour final reported answer must be a single real number corresponding to the area in nm$^{2}$ (do not include units in the final box).",
            "solution": "The problem statement is first subjected to a rigorous validation process.\n\n**Step 1: Extract Givens**\n- Crystal structure: Simple cubic.\n- Lattice parameter: $a = 0.400$ nm.\n- Crystal plane Miller indices: $(hkl) = (311)$.\n- Definition of a lattice direction $[uvw]$: Corresponds to the shortest real-space lattice translation $\\mathbf{r} = u\\,\\mathbf{a}_{1} + v\\,\\mathbf{a}_{2} + w\\,\\mathbf{a}_{3}$ with $\\gcd(u,v,w) = 1$.\n- Definition of a crystal plane $(hkl)$: Has a real-space normal parallel to the reciprocal lattice vector $\\mathbf{G} = h\\,\\mathbf{b}_{1} + k\\,\\mathbf{b}_{2} + l\\,\\mathbf{b}_{3}$.\n- Relation between direct and reciprocal lattice vectors: $\\mathbf{a}_{i}\\cdot\\mathbf{b}_{j} = 2\\pi\\,\\delta_{ij}$.\n- Condition for a direction to lie in a plane is implied to be the orthogonality of the direction vector and the plane normal vector.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is assessed against the required criteria:\n- **Scientifically Grounded:** The problem is based on fundamental, standard principles of solid-state physics and crystallography, specifically the concepts of direct and reciprocal lattices, Miller indices, and vector algebra in cubic systems. All definitions and relationships provided are correct.\n- **Well-Posed:** The problem is clearly stated, providing all necessary information and definitions to proceed with a logical derivation and calculation. The objectives for each of the four parts are unambiguous. A unique numerical answer for the area exists.\n- **Objective:** The language is technical, precise, and free of any subjective or opinion-based claims.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, well-posed, objective, and complete. It contains no contradictions or ambiguities. It is a standard exercise in solid-state physics. Therefore, the problem is deemed **valid**. We proceed with the solution.\n\nThe solution is constructed in four parts as demanded by the problem statement.\n\nFor a simple cubic crystal with lattice parameter $a$, the primitive direct lattice vectors can be chosen to be aligned with a Cartesian coordinate system:\n$$ \\mathbf{a}_{1} = a\\,\\hat{x}, \\quad \\mathbf{a}_{2} = a\\,\\hat{y}, \\quad \\mathbf{a}_{3} = a\\,\\hat{z} $$\nThe primitive reciprocal lattice vectors are then found from the condition $\\mathbf{a}_{i}\\cdot\\mathbf{b}_{j} = 2\\pi\\,\\delta_{ij}$:\n$$ \\mathbf{b}_{1} = \\frac{2\\pi}{a}\\,\\hat{x}, \\quad \\mathbf{b}_{2} = \\frac{2\\pi}{a}\\,\\hat{y}, \\quad \\mathbf{b}_{3} = \\frac{2\\pi}{a}\\,\\hat{z} $$\n\n**1. Derivation of the condition for a direction to lie within a plane.**\nA lattice direction $[uvw]$ corresponds to a real-space vector $\\mathbf{r}$ given by:\n$$ \\mathbf{r} = u\\,\\mathbf{a}_{1} + v\\,\\mathbf{a}_{2} + w\\,\\mathbf{a}_{3} = a(u\\,\\hat{x} + v\\,\\hat{y} + w\\,\\hat{z}) $$\nA crystal plane $(hkl)$ has a normal vector that is parallel to the reciprocal lattice vector $\\mathbf{G}$:\n$$ \\mathbf{G} = h\\,\\mathbf{b}_{1} + k\\,\\mathbf{b}_{2} + l\\,\\mathbf{b}_{3} = \\frac{2\\pi}{a}(h\\,\\hat{x} + k\\,\\hat{y} + l\\,\\hat{z}) $$\nA direction $[uvw]$ lies within the plane $(hkl)$ if and only if its corresponding vector $\\mathbf{r}$ is perpendicular to the plane's normal vector $\\mathbf{G}$. The condition for orthogonality is that their dot product is zero:\n$$ \\mathbf{r} \\cdot \\mathbf{G} = 0 $$\nSubstituting the expressions for $\\mathbf{r}$ and $\\mathbf{G}$ for the simple cubic lattice:\n$$ [a(u\\,\\hat{x} + v\\,\\hat{y} + w\\,\\hat{z})] \\cdot \\left[ \\frac{2\\pi}{a}(h\\,\\hat{x} + k\\,\\hat{y} + l\\,\\hat{z}) \\right] = 0 $$\nThe constants $a$ and $\\frac{2\\pi}{a}$ cancel:\n$$ 2\\pi (u\\,\\hat{x} + v\\,\\hat{y} + w\\,\\hat{z}) \\cdot (h\\,\\hat{x} + k\\,\\hat{y} + l\\,\\hat{z}) = 0 $$\nEvaluating the dot product of the Cartesian vectors:\n$$ 2\\pi (h u + k v + l w) = 0 $$\nThis simplifies to the well-known Weiss zone law, which is the condition for a direction $[uvw]$ to lie in a plane $(hkl)$:\n$$ h u + k v + l w = 0 $$\nFor the specific plane $(311)$, the condition is:\n$$ 3u + v + w = 0 $$\n\n**2. Finding two minimal, non-collinear directions in the $(311)$ plane.**\nWe need to find two distinct, non-collinear sets of integers $(u, v, w)$ that satisfy $3u + v + w = 0$, have $\\gcd(u,v,w)=1$, and correspond to the shortest possible lattice vectors. The length squared of a direction vector $\\mathbf{r}$ is $|\\mathbf{r}|^2 = a^2(u^2+v^2+w^2)$. We seek to minimize $u^2+v^2+w^2$.\nWe search for integer solutions $(u,v,w)$ to $w = -3u - v$:\n- If $u=0$, then $w = -v$. To have minimal non-zero magnitude and $\\gcd(0,v,w)=1$, we choose $v=1$, which gives $w=-1$. This results in the direction $[01\\bar{1}]$. The length-squared term is $u^2+v^2+w^2 = 0^2+1^2+(-1)^2 = 2$. This is a shortest possible non-zero lattice vector in the plane. Let this be our first direction, $\\mathbf{d}_1 = [01\\bar{1}]$.\n\n- We now need a second direction, non-collinear with the first. We try $u=1$. The condition is $v+w = -3$. We seek the pair $(v,w)$ that minimizes $1^2+v^2+w^2$. This is equivalent to minimizing $v^2+w^2$ subject to $v+w=-3$. Pairs are $(0,-3), (-1,-2), (-2,-1), (-3,0)$.\n  - For $(v,w)=(0,-3)$, length-squared term is $1^2+0^2+(-3)^2 = 10$. Direction: $[10\\bar{3}]$.\n  - For $(v,w)=(-1,-2)$, length-squared term is $1^2+(-1)^2+(-2)^2 = 6$. Direction: $[1\\bar{1}\\bar{2}]$.\n  - For $(v,w)=(-2,-1)$, length-squared term is $1^2+(-2)^2+(-1)^2 = 6$. Direction: $[1\\bar{2}\\bar{1}]$.\nThe minimal length-squared term for $u \\neq 0$ is $6$. We choose one of these directions, for example, $\\mathbf{d}_2 = [1\\bar{2}\\bar{1}]$. Here, $\\gcd(1,-2,-1)=1$.\n\nThe two directions $\\mathbf{d}_1 = [01\\bar{1}]$ and $\\mathbf{d}_2 = [1\\bar{2}\\bar{1}]$ are non-collinear and represent the two shortest non-collinear lattice translation types in the $(311)$ plane. These will therefore span the parallelogram of smallest area, which corresponds to the primitive unit cell of the 2D lattice on this plane.\n\n**3. Explicit verification.**\nWe verify that both chosen directions satisfy the condition $3u+v+w=0$.\n- For direction $\\mathbf{d}_1 = [01\\bar{1}]$: $u=0, v=1, w=-1$.\n  $3(0) + (1) + (-1) = 0 + 1 - 1 = 0$. The condition is satisfied.\n- For direction $\\mathbf{d}_2 = [1\\bar{2}\\bar{1}]$: $u=1, v=-2, w=-1$.\n  $3(1) + (-2) + (-1) = 3 - 2 - 1 = 0$. The condition is satisfied.\n\n**4. Computation of the area.**\nThe area of the parallelogram is given by the magnitude of the cross product of the two vectors that span it. Let these vectors be $\\mathbf{r}_1$ and $\\mathbf{r}_2$, corresponding to directions $\\mathbf{d}_1$ and $\\mathbf{d}_2$.\n$$ \\mathbf{r}_1 = a(0\\,\\hat{x} + 1\\,\\hat{y} - 1\\,\\hat{z}) $$\n$$ \\mathbf{r}_2 = a(1\\,\\hat{x} - 2\\,\\hat{y} - 1\\,\\hat{z}) $$\nThe cross product is:\n$$ \\mathbf{r}_1 \\times \\mathbf{r}_2 = a^2 \\det \\begin{pmatrix} \\hat{x} & \\hat{y} & \\hat{z} \\\\ 0 & 1 & -1 \\\\ 1 & -2 & -1 \\end{pmatrix} = a^2 (\\hat{x}(1(-1)-(-1)(-2)) - \\hat{y}(0(-1)-(-1)(1)) + \\hat{z}(0(-2)-1(1))) $$\n$$ \\mathbf{r}_1 \\times \\mathbf{r}_2 = a^2 (\\hat{x}(-1-2) - \\hat{y}(0+1) + \\hat{z}(0-1)) = a^2 (-3\\hat{x} - 1\\hat{y} - 1\\hat{z}) $$\nAs required, the resulting vector $(-3, -1, -1)$ is parallel to the plane normal $(3, 1, 1)$.\nThe area $A$ is the magnitude of this vector:\n$$ A = |\\mathbf{r}_1 \\times \\mathbf{r}_2| = |a^2 (-3\\hat{x} - 1\\hat{y} - 1\\hat{z})| = a^2 \\sqrt{(-3)^2 + (-1)^2 + (-1)^2} $$\n$$ A = a^2 \\sqrt{9 + 1 + 1} = a^2 \\sqrt{11} $$\nNow, we substitute the given value $a = 0.400$ nm:\n$$ A = (0.400 \\text{ nm})^2 \\sqrt{11} = 0.1600 \\times \\sqrt{11} \\text{ nm}^2 $$\nUsing the value $\\sqrt{11} \\approx 3.31662479$:\n$$ A \\approx 0.1600 \\times 3.31662479 \\text{ nm}^2 \\approx 0.53065996 \\text{ nm}^2 $$\nRounding the result to four significant figures as requested:\n$$ A \\approx 0.5307 \\text{ nm}^2 $$",
            "answer": "$$\\boxed{0.5307}$$"
        },
        {
            "introduction": "While simple cubic systems offer intuitive geometric relationships, most real-world semiconductor materials are non-cubic, requiring a more robust mathematical framework. This advanced practice introduces the crystallographic metric tensor, the essential tool for performing geometric calculations in any lattice system . By implementing a program to fit calculated $d$-spacings and interplanar angles to experimental data, you will engage in a realistic materials characterization task: indexing diffraction patterns to determine the orientation of crystal planes.",
            "id": "4287493",
            "problem": "You are tasked with implementing a program that uses the crystallographic metric matrix to compute interplanar spacings and interplanar angles for candidate Miller indices and then select the best fit to experimental data using a least-squares approach. The context is the analysis of crystal planes in nanoelectronic and emerging semiconductor materials where rigorous metric treatment is essential to handle non-cubic lattices. Your algorithm must proceed from first principles and well-tested definitions.\n\nDefinitions and fundamental base:\n- The direct lattice parameters are the lengths $a$, $b$, $c$ and the angles $\\alpha$, $\\beta$, $\\gamma$, where $\\alpha$ is the angle between $\\mathbf{b}$ and $\\mathbf{c}$, $\\beta$ between $\\mathbf{a}$ and $\\mathbf{c}$, and $\\gamma$ between $\\mathbf{a}$ and $\\mathbf{b}$.\n- The direct metric matrix $G$ encodes the inner products of the basis vectors of the direct lattice and is given by\n$$\nG = \\begin{bmatrix}\na^2 & a b \\cos \\gamma & a c \\cos \\beta \\\\\na b \\cos \\gamma & b^2 & b c \\cos \\alpha \\\\\na c \\cos \\beta & b c \\cos \\alpha & c^2\n\\end{bmatrix}.\n$$\n- The reciprocal metric matrix $G^{\\ast}$ is the matrix inverse of $G$, i.e., $G^{\\ast} = G^{-1}$. This follows from the definition of reciprocal basis vectors $\\mathbf{a}^{\\ast}$, $\\mathbf{b}^{\\ast}$, $\\mathbf{c}^{\\ast}$ satisfying $\\mathbf{a}^{\\ast} \\cdot \\mathbf{a} = 1$, $\\mathbf{a}^{\\ast} \\cdot \\mathbf{b} = 0$, etc., and yields $G G^{\\ast} = I$.\n- For a plane with Miller indices $(h,k,l)$, the corresponding reciprocal lattice vector is $\\mathbf{H} = h \\mathbf{a}^{\\ast} + k \\mathbf{b}^{\\ast} + l \\mathbf{c}^{\\ast}$, with squared norm computed by\n$$\n\\lVert \\mathbf{H} \\rVert^2 = \\begin{bmatrix} h & k & l \\end{bmatrix} \\, G^{\\ast} \\, \\begin{bmatrix} h \\\\ k \\\\ l \\end{bmatrix}.\n$$\n- The interplanar spacing is $d_{hkl} = \\frac{1}{\\lVert \\mathbf{H} \\rVert}$, which has units of Angstroms (Å) if $a$, $b$, $c$ are given in Angstroms.\n- The angle between two planes $(h_1,k_1,l_1)$ and $(h_2,k_2,l_2)$ is the angle between their normals in reciprocal space:\n$$\n\\cos \\phi = \\frac{\\mathbf{H}_1 \\cdot \\mathbf{H}_2}{\\lVert \\mathbf{H}_1 \\rVert \\, \\lVert \\mathbf{H}_2 \\rVert} = \\frac{\\begin{bmatrix} h_1 & k_1 & l_1 \\end{bmatrix} \\, G^{\\ast} \\, \\begin{bmatrix} h_2 \\\\ k_2 \\\\ l_2 \\end{bmatrix}}{\\sqrt{\\begin{bmatrix} h_1 & k_1 & l_1 \\end{bmatrix} \\, G^{\\ast} \\, \\begin{bmatrix} h_1 \\\\ k_1 \\\\ l_1 \\end{bmatrix}} \\, \\sqrt{\\begin{bmatrix} h_2 & k_2 & l_2 \\end{bmatrix} \\, G^{\\ast} \\, \\begin{bmatrix} h_2 \\\\ k_2 \\\\ l_2 \\end{bmatrix}}}.\n$$\nThe angle $\\phi$ must be reported in degrees.\n\nObjective and least-squares approach:\n- You will be given a set of experimental interplanar spacings $d_i$ for $i = 1,\\dots,N$, each in Angstroms (Å), and a set of experimental interplanar angles $\\phi_p$ for specified index pairs $(i_p, j_p)$, in degrees.\n- For each spacing $d_i$, a small candidate set of possible Miller indices $\\{(h,k,l)\\}$ is provided.\n- Your goal is to select exactly one triplet $(h_i,k_i,l_i)$ for each $i$ from its candidate set so that the computed spacings and angles best fit the experimental values in a normalized least-squares sense.\n- Define the normalized squared residual for spacings as\n$$\nr_{d,i}^2 = \\left( \\frac{d_{\\text{calc},i} - d_{\\text{exp},i}}{d_{\\text{exp},i}} \\right)^2,\n$$\nand for angles as\n$$\nr_{\\phi,p}^2 = \\left( \\frac{\\phi_{\\text{calc},p} - \\phi_{\\text{exp},p}}{180} \\right)^2,\n$$\nwhere $d_{\\text{calc},i}$ and $\\phi_{\\text{calc},p}$ are computed from the metric matrices as specified above. The total sum of squares is\n$$\nS = \\sum_{i=1}^{N} r_{d,i}^2 + \\sum_{p=1}^{P} r_{\\phi,p}^2.\n$$\n- Choose the combination of indices that minimizes $S$. Report the root-mean-square (RMS) error\n$$\n\\mathrm{RMS} = \\sqrt{\\frac{S}{N + P}}.\n$$\n\nUnits:\n- All interplanar spacings $d_{hkl}$ must be computed and compared in Angstroms (Å).\n- All angles must be computed and compared in degrees.\n\nProgram requirements:\n- Implement the computation of $G$ and $G^{\\ast}$ from $(a,b,c,\\alpha,\\beta,\\gamma)$.\n- Implement $d_{hkl}$ and $\\phi$ calculations using the metric matrices.\n- For each test case, enumerate all combinations of candidate indices (Cartesian product) and select the combination minimizing $S$.\n- Compute and report the RMS error for the selected combination.\n\nTest suite:\nProvide solutions for all the test cases below. Your program must hard-code these cases and produce outputs in the exact final format specified at the end.\n\nTest Case 1 (Hexagonal wurtzite-like):\n- Lattice parameters: $a = 3.189\\ \\text{Å}$, $b = 3.189\\ \\text{Å}$, $c = 5.185\\ \\text{Å}$, $\\alpha = 90^\\circ$, $\\beta = 90^\\circ$, $\\gamma = 120^\\circ$.\n- Experimental spacings (in Å): $[2.760, 2.595, 2.440, 1.590]$.\n- Angle pairs and experimental angles (degrees): between indices $i=0$ and $j=1$: $90.3^\\circ$; between $i=0$ and $j=3$: $30.1^\\circ$.\n- Candidate sets for each spacing $i$:\n  - $i=0$: $\\{(1,0,0), (0,0,2), (1,1,0)\\}$.\n  - $i=1$: $\\{(0,0,2), (1,0,1), (1,1,0)\\}$.\n  - $i=2$: $\\{(1,0,1), (1,1,1), (0,0,3)\\}$.\n  - $i=3$: $\\{(1,1,0), (2,0,0), (0,0,4)\\}$.\n\nTest Case 2 (Tetragonal rutile-like):\n- Lattice parameters: $a = 4.5937\\ \\text{Å}$, $b = 4.5937\\ \\text{Å}$, $c = 2.9587\\ \\text{Å}$, $\\alpha = 90^\\circ$, $\\beta = 90^\\circ$, $\\gamma = 90^\\circ$.\n- Experimental spacings (in Å): $[3.249, 2.487, 2.300]$.\n- Angle pairs and experimental angles (degrees): between $i=0$ and $j=1$: $67.6^\\circ$; between $i=1$ and $j=2$: $57.2^\\circ$.\n- Candidate sets:\n  - $i=0$: $\\{(1,1,0), (2,0,0), (2,1,1)\\}$.\n  - $i=1$: $\\{(1,0,1), (2,1,0), (1,1,2)\\}$.\n  - $i=2$: $\\{(2,0,0), (0,0,2), (1,1,1)\\}$.\n\nTest Case 3 (Orthorhombic layered-like):\n- Lattice parameters: $a = 3.313\\ \\text{Å}$, $b = 10.473\\ \\text{Å}$, $c = 4.374\\ \\text{Å}$, $\\alpha = 90^\\circ$, $\\beta = 90^\\circ$, $\\gamma = 90^\\circ$.\n- Experimental spacings (in Å): $[5.220, 2.186, 1.656]$.\n- Angle pairs and experimental angles (degrees): between $i=0$ and $j=2$: $90.0^\\circ$; between $i=1$ and $j=2$: $90.0^\\circ$.\n- Candidate sets:\n  - $i=0$: $\\{(0,2,0), (0,1,0), (1,0,0)\\}$.\n  - $i=1$: $\\{(0,0,2), (1,0,1), (0,1,1)\\}$.\n  - $i=2$: $\\{(2,0,0), (1,1,0), (0,0,3)\\}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a list whose elements are the selected Miller indices lists in order $i=0$ to $N-1$, followed by the RMS error rounded to six decimal places. For example:\n\"[[[h0,k0,l0],[h1,k1,l1],...,rms_case1],[[...],rms_case2],[[...],rms_case3]]\".\nNo additional text should be printed.",
            "solution": "The user's request is to develop a program that determines the Miller indices of crystal planes from experimental data. The problem is well-defined and grounded in the principles of crystallography and solid-state physics. It requires the implementation of calculations based on the crystallographic metric tensor for general, non-orthogonal lattice systems and the application of a least-squares minimization procedure to find the best fit between calculated and experimental data.\n\nThe problem statement is validated as follows:\n- **Scientific Grounding:** The problem is based on fundamental and correct definitions from crystallography, including the direct and reciprocal metric tensors ($G$ and $G^{\\ast}$), interplanar spacing ($d_{hkl}$), and interplanar angles ($\\phi$). The use of a least-squares method for data fitting is a standard scientific practice.\n- **Well-Posedness:** The objective is to minimize a sum-of-squares function $S$ over a finite set of possibilities (the Cartesian product of candidate Miller index sets). A minimum is guaranteed to exist. The problem is self-contained, providing all necessary lattice parameters, experimental data, candidate indices, and definitions for the cost function and final metric (RMS error).\n- **Objectivity:** The problem is stated using precise mathematical formulas and objective numerical data, with no subjective or ambiguous language.\n\nThe problem is deemed valid as it is scientifically sound, complete, and quantitatively specified. The solution proceeds by first principles as outlined.\n\nThe methodological approach consists of three primary stages:\n1.  **Metric Tensor Construction:** For a given crystal lattice defined by parameters $a$, $b$, $c$, $\\alpha$, $\\beta$, $\\gamma$, the direct metric tensor $G$ is constructed. This matrix encapsulates the geometry of the direct lattice basis vectors. The reciprocal metric tensor, $G^{\\ast} = G^{-1}$, is then computed. $G^{\\ast}$ is the fundamental operator for performing calculations in reciprocal space.\n2.  **Reciprocal Space Calculations:** The computed $G^{\\ast}$ is used to determine theoretical values for interplanar spacings and angles for any given set of Miller indices $(h,k,l)$.\n    - The interplanar spacing $d_{hkl}$ is the reciprocal of the magnitude of the reciprocal lattice vector $\\mathbf{H} = h \\mathbf{a}^{\\ast} + k \\mathbf{b}^{\\ast} + l \\mathbf{c}^{\\ast}$. This magnitude is calculated using $G^{\\ast}$: $\\lVert \\mathbf{H} \\rVert^2 = \\mathbf{h}^T G^{\\ast} \\mathbf{h}$, where $\\mathbf{h}$ is the column vector $[h, k, l]^T$. Thus, $d_{hkl} = (\\mathbf{h}^T G^{\\ast} \\mathbf{h})^{-1/2}$.\n    - The angle $\\phi$ between two planes $(h_1, k_1, l_1)$ and $(h_2, k_2, l_2)$ is found from the dot product of their respective reciprocal lattice vectors, $\\mathbf{H}_1$ and $\\mathbf{H}_2$. This dot product is also computed via the metric tensor: $\\mathbf{H}_1 \\cdot \\mathbf{H}_2 = \\mathbf{h}_1^T G^{\\ast} \\mathbf{h}_2$. The angle is then given by $\\cos \\phi = (\\mathbf{h}_1^T G^{\\ast} \\mathbf{h}_2) / (\\lVert \\mathbf{H}_1 \\rVert \\lVert \\mathbf{H}_2 \\rVert)$.\n3.  **Combinatorial Optimization:** To find the Miller indices that best match the experimental data, an exhaustive search is performed. The set of all possible assignments of Miller indices is generated by taking the Cartesian product of the candidate sets provided for each experimental spacing. For each complete assignment (a combination), the total normalized sum of squares, $S$, is calculated:\n    $$\n    S = \\sum_{i=1}^{N} \\left( \\frac{d_{\\text{calc},i} - d_{\\text{exp},i}}{d_{\\text{exp},i}} \\right)^2 + \\sum_{p=1}^{P} \\left( \\frac{\\phi_{\\text{calc},p} - \\phi_{\\text{exp},p}}{180} \\right)^2\n    $$\n    The combination of indices that minimizes $S$ is selected as the optimal solution. Finally, the root-mean-square (RMS) error, $\\mathrm{RMS} = \\sqrt{S_{\\min} / (N+P)}$, is computed as the metric of fit quality.\n\nThe implementation will be realized in Python, leveraging the `numpy` library for efficient and accurate linear algebra operations (matrix construction, inversion, and products) and the `itertools` library to generate the combinations for the search. For each test case, the algorithm will:\n1.  Define the lattice parameters, experimental data, and candidate index sets.\n2.  Pre-calculate the reciprocal metric tensor $G^{\\ast}$ once per test case.\n3.  Iterate through every combination of candidate indices.\n4.  For each combination, calculate the corresponding theoretical spacings and angles using $G^{\\ast}$.\n5.  Compute the total squared error $S$.\n6.  Track the combination that yields the minimum $S$.\n7.  After the search, calculate the final RMS error for the best combination.\n8.  Format the resulting optimal indices and RMS value as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport itertools\nimport math\n\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases for crystallographic analysis.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Test Case 1 (Hexagonal wurtzite-like)\",\n            \"lattice_params\": {\n                \"a\": 3.189, \"b\": 3.189, \"c\": 5.185,\n                \"alpha\": 90.0, \"beta\": 90.0, \"gamma\": 120.0\n            },\n            \"exp_spacings\": [2.760, 2.595, 2.440, 1.590],\n            \"exp_angles\": [\n                {\"indices\": (0, 1), \"angle\": 90.3},\n                {\"indices\": (0, 3), \"angle\": 30.1}\n            ],\n            \"candidate_indices\": [\n                [(1, 0, 0), (0, 0, 2), (1, 1, 0)],\n                [(0, 0, 2), (1, 0, 1), (1, 1, 0)],\n                [(1, 0, 1), (1, 1, 1), (0, 0, 3)],\n                [(1, 1, 0), (2, 0, 0), (0, 0, 4)]\n            ]\n        },\n        {\n            \"name\": \"Test Case 2 (Tetragonal rutile-like)\",\n            \"lattice_params\": {\n                \"a\": 4.5937, \"b\": 4.5937, \"c\": 2.9587,\n                \"alpha\": 90.0, \"beta\": 90.0, \"gamma\": 90.0\n            },\n            \"exp_spacings\": [3.249, 2.487, 2.300],\n            \"exp_angles\": [\n                {\"indices\": (0, 1), \"angle\": 67.6},\n                {\"indices\": (1, 2), \"angle\": 57.2}\n            ],\n            \"candidate_indices\": [\n                [(1, 1, 0), (2, 0, 0), (2, 1, 1)],\n                [(1, 0, 1), (2, 1, 0), (1, 1, 2)],\n                [(2, 0, 0), (0, 0, 2), (1, 1, 1)]\n            ]\n        },\n        {\n            \"name\": \"Test Case 3 (Orthorhombic layered-like)\",\n            \"lattice_params\": {\n                \"a\": 3.313, \"b\": 10.473, \"c\": 4.374,\n                \"alpha\": 90.0, \"beta\": 90.0, \"gamma\": 90.0\n            },\n            \"exp_spacings\": [5.220, 2.186, 1.656],\n            \"exp_angles\": [\n                {\"indices\": (0, 2), \"angle\": 90.0},\n                {\"indices\": (1, 2), \"angle\": 90.0}\n            ],\n            \"candidate_indices\": [\n                [(0, 2, 0), (0, 1, 0), (1, 0, 0)],\n                [(0, 0, 2), (1, 0, 1), (0, 1, 1)],\n                [(2, 0, 0), (1, 1, 0), (0, 0, 3)]\n            ]\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        lattice = case[\"lattice_params\"]\n        a, b, c = lattice[\"a\"], lattice[\"b\"], lattice[\"c\"]\n        alpha_rad = np.deg2rad(lattice[\"alpha\"])\n        beta_rad = np.deg2rad(lattice[\"beta\"])\n        gamma_rad = np.deg2rad(lattice[\"gamma\"])\n\n        # Construct the direct metric matrix G\n        g_matrix = np.array([\n            [a**2, a * b * np.cos(gamma_rad), a * c * np.cos(beta_rad)],\n            [a * b * np.cos(gamma_rad), b**2, b * c * np.cos(alpha_rad)],\n            [a * c * np.cos(beta_rad), b * c * np.cos(alpha_rad), c**2]\n        ])\n\n        # Compute the reciprocal metric matrix G*\n        g_star_matrix = np.linalg.inv(g_matrix)\n\n        min_s = float('inf')\n        best_combo = None\n\n        # Generate all combinations of candidate indices\n        index_combinations = itertools.product(*case[\"candidate_indices\"])\n\n        # For each combination, calculate S and find the minimum\n        for combo in index_combinations:\n            total_s = 0.0\n            \n            # Calculate d_hkl for the current combination\n            calculated_spacings = []\n            for hkl in combo:\n                h = np.array(hkl).reshape(3, 1)\n                h_norm_sq = h.T @ g_star_matrix @ h\n                d_hkl = 1.0 / np.sqrt(h_norm_sq[0, 0])\n                calculated_spacings.append(d_hkl)\n            \n            # Calculate spacing residuals\n            for i, d_exp in enumerate(case[\"exp_spacings\"]):\n                d_calc = calculated_spacings[i]\n                total_s += ((d_calc - d_exp) / d_exp)**2\n\n            # Calculate interplanar angles for the current combination\n            for angle_info in case[\"exp_angles\"]:\n                idx1, idx2 = angle_info[\"indices\"]\n                h1_tuple, h2_tuple = combo[idx1], combo[idx2]\n                \n                h1 = np.array(h1_tuple).reshape(3, 1)\n                h2 = np.array(h2_tuple).reshape(3, 1)\n\n                h1_norm = np.sqrt(h1.T @ g_star_matrix @ h1)\n                h2_norm = np.sqrt(h2.T @ g_star_matrix @ h2)\n                \n                h1_dot_h2 = h1.T @ g_star_matrix @ h2\n                \n                cos_phi_val = h1_dot_h2 / (h1_norm * h2_norm)\n                # Clip to handle potential floating point inaccuracies\n                cos_phi_val = np.clip(cos_phi_val, -1.0, 1.0)\n                \n                phi_calc_rad = np.arccos(cos_phi_val)\n                phi_calc_deg = np.rad2deg(phi_calc_rad)[0, 0]\n                \n                phi_exp = angle_info[\"angle\"]\n                total_s += ((phi_calc_deg - phi_exp) / 180.0)**2\n\n            if total_s < min_s:\n                min_s = total_s\n                best_combo = combo\n\n        # Calculate RMS for the best combination\n        num_spacings = len(case[\"exp_spacings\"])\n        num_angles = len(case[\"exp_angles\"])\n        rms = np.sqrt(min_s / (num_spacings + num_angles))\n\n        # Format the result for this case\n        case_result = [list(hkl) for hkl in best_combo]\n        case_result.append(float(f\"{rms:.6f}\"))\n        all_results.append(case_result)\n\n    # Custom string formatter to match the required output style (no spaces)\n    def format_output_string(data):\n        items = []\n        for item in data:\n            if isinstance(item, list):\n                items.append(format_output_string(item))\n            elif isinstance(item, float):\n                items.append(f\"{item:.6f}\")\n            else:\n                items.append(str(item))\n        return f\"[{','.join(items)}]\"\n    \n    print(format_output_string(all_results))\n\nsolve()\n\n```"
        }
    ]
}