{
    "hands_on_practices": [
        {
            "introduction": "光刻技术的核心是投影成像系统，其性能由几个基本参数决定。瑞利判据 (Rayleigh criteria) 提供了计算分辨率 ($R$) 和焦深 ($DOF$) 的基础公式，揭示了在任何光刻工艺中都必须面对的根本性权衡。通过练习 ，你将应用这些关键公式来评估一个现代浸没式光刻系统，从而将波长 ($\\lambda$) 和数值孔径 ($NA$) 等抽象概念与实际的性能计算联系起来。",
            "id": "4309655",
            "problem": "一个投影光刻系统被用于自上而下的纳米制造流程中，使用波长为 $\\lambda$ 的氟化氩 (ArF) 准分子激光辐射，将密集的线-空间图形印刷到化学放大光刻胶上。该设备被配置为浸没式系统，在末级透镜元件和光刻胶之间填充有超纯水，从而在曝光波长下产生折射率 $n$ 和指定的数值孔径 (NA)。最小可分辨半间距（能够以可接受的图像对比度转移的线-空间周期的最小一半）和焦深 (DOF) 由衍射极限成像决定，并受到依赖于工艺的经验常数的修正，这些常数包含了诸如照明相干性、掩模形貌、光刻胶动力学和光瞳切趾等效应。\n\n从数值孔径的定义 $NA = n \\sin(\\theta)$ 出发，并根据 Abbe 和 Rayleigh 判据所描述的相干或部分相干照明下周期性结构的衍射极限成像原理，推导出最小可分辨半间距和焦深作为波长 $\\lambda$、数值孔径 $NA$以及依赖于工艺的常数 $k_1$ 和 $k_2$ 的函数表达式。然后，对于一个浸没式工具，在 $n = 1.44$、$\\lambda = 193\\,\\mathrm{nm}$、$NA = 1.35$、$k_1 = 0.29$ 和 $k_2 = 0.50$ 的条件下，计算这些表达式的值。确认指定的 $NA$ 相对于浸没介质折射率 $n$ 的物理合理性，并计算最小可分辨半间距和焦深的数值。\n\n将两个最终结果都以纳米为单位表示，并四舍五入到四位有效数字。按以下顺序报告你的最终数值结果：最小可分辨半间距，焦深。",
            "solution": "目标是从衍射极限成像原理出发，确定对于一个浸没式投影光刻工具，最小可分辨半间距和焦深如何随曝光波长和数值孔径变化。\n\n数值孔径定义为\n$$\nNA = n \\sin(\\theta),\n$$\n其中 $n$ 是末级光学元件和晶圆之间的介质（浸没液）的折射率，$\\theta$ 是透镜接收的光锥的最大半角。物理上的合理性要求 $NA \\leq n$，因为 $|\\sin(\\theta)| \\leq 1$。\n\n对于衍射极限成像下的周期性结构（线-空间光栅），Abbe 判据要求 $\\pm 1$ 级衍射光必须被成像系统收集，才能以非零对比度重建图形。对于周期为 $p$ 的光栅，一级衍射条件是\n$$\nm \\lambda = p \\, n \\sin(\\theta),\n$$\n其中一级衍射 $m = 1$，因此\n$$\np_{\\min} \\approx \\frac{\\lambda}{n \\sin(\\theta)} = \\frac{\\lambda}{NA}.\n$$\n最小可分辨半间距（此处记为 $R$）是线-空间图形周期 $p$ 的一半。在实际光刻中，依赖于工艺的因素（掩模照明的部分相干性、光刻胶工艺模糊、光瞳滤波和图像阈值处理）会修正纯粹的衍射极限。这些效应通常被包含在一个对分辨率进行缩放的常数 $k_1$ 中，从而得到广泛使用且经过充分验证的分辨率缩放关系\n$$\nR = k_1 \\frac{\\lambda}{NA}.\n$$\n该表达式保留了由衍射决定的与 $NA$ 的基本反比关系以及与 $\\lambda$ 的正比关系。\n\n焦深源于图像对比度对离焦的敏感性。在针对高 NA 透镜的标量衍射理论中，离焦会在光瞳函数中引入一个二次相位项，这会降低某个空间频率分量的图像调制度。在图像调制度下降到可接受阈值以下的离焦容限与 $NA^2$ 成反比，与 $\\lambda$ 成正比。这种缩放关系由一个依赖于工艺的常数 $k_2$ 捕捉，该常数设定了可接受的对比度损失标准，从而得到已被广泛认可的 DOF 缩放关系\n$$\nDOF = k_2 \\frac{\\lambda}{NA^{2}}.\n$$\n这些关系与分辨率和离焦敏感性的衍射极限起源相一致，同时允许通过 $k_1$ 和 $k_2$ 进行工艺优化。\n\n我们现在根据给定参数对这两个表达式进行数值计算：\n- 浸没液折射率：$n = 1.44$，\n- 波长：$\\lambda = 193\\,\\mathrm{nm}$，\n- 数值孔径：$NA = 1.35$，\n- 分辨率常数：$k_1 = 0.29$，\n- 焦深常数：$k_2 = 0.50$。\n\n首先，检查指定数值孔径的物理合理性：\n$$\n\\frac{NA}{n} = \\frac{1.35}{1.44} \\approx 0.9375,\n$$\n该值小于 $1$，确认了 $NA \\leq n$，因此在给定波长下通过水浸没式技术是物理上可实现的。\n\n计算最小可分辨半间距：\n$$\nR = k_1 \\frac{\\lambda}{NA} = 0.29 \\times \\frac{193\\,\\mathrm{nm}}{1.35}.\n$$\n计算分数值：\n$$\n\\frac{193}{1.35} = \\frac{193 \\times 20}{27} = \\frac{3860}{27} \\approx 142.96296\\,\\mathrm{nm}.\n$$\n因此，\n$$\nR \\approx 0.29 \\times 142.96296\\,\\mathrm{nm} \\approx 41.4593\\,\\mathrm{nm}.\n$$\n四舍五入到四位有效数字并以纳米表示：\n$$\nR \\approx 41.46\\,\\mathrm{nm}.\n$$\n\n计算焦深：\n$$\nDOF = k_2 \\frac{\\lambda}{NA^{2}} = 0.50 \\times \\frac{193\\,\\mathrm{nm}}{(1.35)^{2}} = 0.50 \\times \\frac{193\\,\\mathrm{nm}}{1.8225}.\n$$\n计算分数值：\n$$\n\\frac{193}{1.8225} \\approx 105.898\\,\\mathrm{nm},\n$$\n所以\n$$\nDOF \\approx 0.50 \\times 105.898\\,\\mathrm{nm} \\approx 52.949\\,\\mathrm{nm}.\n$$\n四舍五入到四位有效数字并以纳米表示：\n$$\nDOF \\approx 52.95\\,\\mathrm{nm}.\n$$\n\n因此，对于指定的浸没式工具配置，按所要求的顺序报告，最小可分辨半间距和焦深分别为 $41.46\\,\\mathrm{nm}$ 和 $52.95\\,\\mathrm{nm}$，每个值都已四舍五入到四位有效数字。",
            "answer": "$$\\boxed{\\begin{pmatrix}41.46  52.95\\end{pmatrix}}$$"
        },
        {
            "introduction": "成功地在光刻胶上形成图形仅仅是纳米制造的第一步；这些精细的结构还必须在后续的工艺步骤中保持其完整性。练习  将我们的视角从纯粹的光学领域扩展到一个关键的物理失效模式：由干燥过程中的毛细作用力引起的图形坍塌。通过结合流体动力学（杨-拉普拉斯方程）和固体力学（梁理论），这个问题展示了为何多物理场理解对于制造高深宽比的纳米结构至关重要。",
            "id": "4293982",
            "problem": "在硅基底上为先进的极紫外光刻工艺制作的一对相邻光刻胶线条，在去离子（DI）水冲洗和干燥步骤中，由于线条之间毛细力的作用，容易发生坍塌。每条线都可以理想化为一个棱柱形、各向同性、线弹性的悬臂梁，具有均匀的矩形截面，高度为 $h$，厚度为 $t$，并沿页面内方向延伸很长。该梁底部固定，顶部自由。中心间距导致内侧壁之间的间隙为 $s$。在干燥过程中，间隙中会形成一个稳定的弯月面，将两条线相互拉近。假设液体对光刻胶的表面张力为 $\\gamma$，接触角为 $\\theta$。忽略重力、惯性效应和粘性效应，并将毛细作用模拟为在间隙区域内作用于侧壁整个高度上的均匀侧向压力。将力和刚度按页面内单位长度计算，并假设每条线对称偏转，因此当一条线的顶端挠度等于 $s/2$ 时发生接触。\n\n仅从毛细作用的杨-拉普拉斯关系和用于小挠度弯曲的欧拉-伯努利梁关系出发，推导出力学坍塌的条件（用材料和几何参数表示），然后计算在以下参数条件下，线条避免坍塌的最大高度 $h_{\\mathrm{c}}$：\n- 杨氏模量 $E = 3.0 \\times 10^{9}~\\mathrm{Pa}$，\n- 线条厚度 $t = 20~\\mathrm{nm}$，\n- 间隙 $s = 24~\\mathrm{nm}$，\n- 表面张力 $\\gamma = 0.072~\\mathrm{N/m}$，\n- 接触角 $\\theta = 36^{\\circ}$。\n\n将 $h_{\\mathrm{c}}$ 的最终数值答案以纳米为单位表示，并四舍五入到三位有效数字。",
            "solution": "该问题要求推导由毛细力引起的光刻胶线条坍塌的临界高度，然后进行数值计算。推导将基于毛细作用原理（杨-拉普拉斯方程）和固体力学原理（欧拉-伯努利梁理论）。\n\n首先，我们确定液态弯月面在光刻胶线条之间施加的毛细压力。杨-拉普拉斯方程将跨越弯曲流体界面的压差 $\\Delta P$ 与表面张力 $\\gamma$ 和主曲率半径 $R_1$、$R_2$ 联系起来：\n$$ \\Delta P = \\gamma \\left( \\frac{1}{R_1} + \\frac{1}{R_2} \\right) $$\n问题描述了光刻胶线条在页面内方向延伸很长，这意味着弯月面是一个圆柱面。因此，其中一个主曲率半径是无限大的，即 $R_2 \\to \\infty$，所以其倒数为零。将线条拉向彼此的压差，也就是毛细压力 $P_c$，变为：\n$$ P_c = \\frac{\\gamma}{R_1} $$\n曲率半径 $R_1$ 位于横截面平面内。对于在宽度为 $s$ 的间隙中形成的、与侧壁接触角为 $\\theta$ 的圆形弧形液面，几何分析得出关系式 $s = 2R_1 \\cos\\theta$。因此，曲率半径为 $R_1 = \\frac{s}{2\\cos\\theta}$。将此代入压力方程得：\n$$ P_c = \\frac{\\gamma}{\\frac{s}{2\\cos\\theta}} = \\frac{2\\gamma\\cos\\theta}{s} $$\n这个压力横向作用在光刻胶线条的内侧壁上。问题要求将其模拟为均匀压力，这相当于作用在每条线上单位高度上的均布载荷 $w$。由于我们是按页面内单位长度来考虑系统的，该载荷在数值上等于压力，即 $w = P_c$。\n\n接下来，我们对单条光刻胶线条的力学响应进行建模。它被描述为一个棱柱形悬臂梁，高为 $h$，厚为 $t$，页面内单位长度，底部（$y=0$）固定，顶部（$y=h$）自由。梁的挠度 $\\delta(y)$ 由欧拉-伯努利方程决定：\n$$ EI \\frac{d^2\\delta}{dy^2} = M(y) $$\n这里，$E$ 是光刻胶的杨氏模量，$I$ 是梁横截面的截面二次矩，$M(y)$ 是距底部距离为 $y$ 处的弯矩。对于宽度为 $t$、单位深度（页面内方向）的矩形截面，在平行于基底的平面内弯曲的截面二次矩为 $I = \\frac{1 \\cdot t^3}{12} = \\frac{t^3}{12}$。\n\n梁在其高度上承受均布载荷 $w = P_c$。在位置 $y$ 处的弯矩 $M(y)$ 是由 $y$ 上方的梁段上的总力引起的。这个力是 $w(h-y)$，其合力作用在该段的形心处，距离 $y$ 为 $\\frac{h-y}{2}$。因此，弯矩为：\n$$ M(y) = w(h-y) \\cdot \\frac{h-y}{2} = \\frac{w}{2}(h-y)^2 $$\n将此代入梁方程：\n$$ EI \\frac{d^2\\delta}{dy^2} = \\frac{w}{2}(h-y)^2 $$\n我们将此方程对 $y$ 积分两次以求得挠度。第一次积分得到斜率：\n$$ EI \\frac{d\\delta}{dy} = \\int \\frac{w}{2}(h-y)^2 dy = -\\frac{w}{6}(h-y)^3 + C_1 $$\n在固定端的边界条件是斜率为零：$\\frac{d\\delta}{dy}(y=0)=0$。应用此条件得 $0 = -\\frac{w}{6}h^3 + C_1$，所以 $C_1 = \\frac{wh^3}{6}$。\n第二次积分得到挠度：\n$$ EI \\delta(y) = \\int \\left( -\\frac{w}{6}(h-y)^3 + \\frac{wh^3}{6} \\right) dy = \\frac{w}{24}(h-y)^4 + \\frac{wh^3}{6}y + C_2 $$\n在固定端的边界条件是挠度为零：$\\delta(y=0)=0$。应用此条件得 $0 = \\frac{w}{24}h^4 + 0 + C_2$，所以 $C_2 = -\\frac{wh^4}{24}$。\n因此，挠度曲线为：\n$$ \\delta(y) = \\frac{w}{EI} \\left( \\frac{(h-y)^4}{24} + \\frac{h^3y}{6} - \\frac{h^4}{24} \\right) $$\n最大挠度发生在自由端，即 $y=h$ 处：\n$$ \\delta_{\\text{tip}} = \\delta(h) = \\frac{w}{EI} \\left( \\frac{0}{24} + \\frac{h^4}{6} - \\frac{h^4}{24} \\right) = \\frac{w}{EI} \\left( \\frac{4h^4 - h^4}{24} \\right) = \\frac{3wh^4}{24EI} = \\frac{wh^4}{8EI} $$\n现在我们代入 $w$ 和 $I$ 的表达式：\n$$ \\delta_{\\text{tip}} = \\frac{\\left(\\frac{2\\gamma\\cos\\theta}{s}\\right)h^4}{8E\\left(\\frac{t^3}{12}\\right)} = \\frac{2\\gamma\\cos\\theta \\cdot h^4}{s} \\cdot \\frac{12}{8Et^3} = \\frac{3\\gamma h^4 \\cos\\theta}{E s t^3} $$\n当相邻线条的顶端接触时发生坍塌。由于对称偏转，这在一条线的顶端挠度等于初始间隙的一半时发生，即 $\\delta_{\\text{tip}} = s/2$。设 $h_c$ 为满足此条件的临界高度。\n$$ \\frac{s}{2} = \\frac{3\\gamma h_c^4 \\cos\\theta}{E s t^3} $$\n对 $h_c^4$ 求解，我们得到力学坍塌的条件：\n$$ h_c^4 = \\frac{s}{2} \\cdot \\frac{E s t^3}{3\\gamma \\cos\\theta} = \\frac{E s^2 t^3}{6\\gamma \\cos\\theta} $$\n因此，避免坍塌的最大高度为：\n$$ h_c = \\left( \\frac{E s^2 t^3}{6\\gamma \\cos\\theta} \\right)^{1/4} $$\n推导到此完成。现在，我们使用所给参数计算 $h_c$ 的数值，确保所有单位均为国际单位制（SI）单位。\n- $E = 3.0 \\times 10^{9}~\\mathrm{Pa}$\n- $t = 20~\\mathrm{nm} = 20 \\times 10^{-9}~\\mathrm{m}$\n- $s = 24~\\mathrm{nm} = 24 \\times 10^{-9}~\\mathrm{m}$\n- $\\gamma = 0.072~\\mathrm{N/m}$\n- $\\theta = 36^{\\circ}$\n\n将这些值代入 $h_c$ 的表达式中：\n$$ h_c = \\left( \\frac{(3.0 \\times 10^{9}~\\mathrm{Pa}) (24 \\times 10^{-9}~\\mathrm{m})^2 (20 \\times 10^{-9}~\\mathrm{m})^3}{6 (0.072~\\mathrm{N/m}) \\cos(36^{\\circ})} \\right)^{1/4} $$\n$$ h_c = \\left( \\frac{(3.0 \\times 10^{9}) (576 \\times 10^{-18}) (8000 \\times 10^{-27})}{6 (0.072) \\cos(36^{\\circ})} \\right)^{1/4}~\\mathrm{m} $$\n$$ h_c = \\left( \\frac{1.3824 \\times 10^{-29}}{0.432 \\times \\cos(36^{\\circ})} \\right)^{1/4}~\\mathrm{m} $$\n使用 $\\cos(36^{\\circ}) \\approx 0.809017$ 的值：\n$$ h_c = \\left( \\frac{1.3824 \\times 10^{-29}}{0.432 \\times 0.809017} \\right)^{1/4}~\\mathrm{m} \\approx \\left( \\frac{1.3824 \\times 10^{-29}}{0.349495} \\right)^{1/4}~\\mathrm{m} $$\n$$ h_c \\approx (3.9554 \\times 10^{-29})^{1/4}~\\mathrm{m} \\approx 7.9305 \\times 10^{-8}~\\mathrm{m} $$\n为了以纳米为单位表示答案，我们乘以 $10^9$：\n$$ h_c \\approx 7.9305 \\times 10^{-8} \\times 10^9~\\mathrm{nm} = 79.305~\\mathrm{nm} $$\n四舍五入到三位有效数字，避免坍塌的最大高度为 $79.3~\\mathrm{nm}$。",
            "answer": "$$\\boxed{79.3}$$"
        },
        {
            "introduction": "要将分辨率远推至经典衍射极限之外，必须借助复杂的计算方法。练习  介绍了光源-掩模协同优化 (Source-Mask Optimization, SMO) 的概念，这是现代逆向光刻技术 (Inverse Lithography Technology, ILT) 的基石。通过编写一个仿真程序来协同优化照明光源和掩模图形，你将亲身体验这些使当今最先进半导体器件制造成为可能的计算技术。",
            "id": "4294011",
            "problem": "要求您在标量傅里叶光学对光刻的描述框架内，实现一个一维计算模型，用于光源掩模协同优化（SMO）和逆向光刻技术（ILT）。目标是为每个给定的测试用例，确定最优的掩模占空比和对称偶极子光源偏移量，以最小化归一化衍射图像与预定目标线-空间图形之间的均方误差。\n\n假设系统为相干、一维、移不变的光学系统，并使用以下经过充分检验的物理基础和定义：\n- 在空间频率域中，相干照明下的图像形成过程表现为物体频谱与系统光瞳函数的乘积。设物体透射率为 $m(x)$，其傅里叶变换为 $M(k)$，光瞳函数为 $P(k)$，其中 $x$ 是空间坐标（单位：纳米），$k$ 是空间频率（单位：周期/纳米）。\n- 相干截止空间频率由 $f_c = \\mathrm{NA}/\\lambda$ 给出，其中 $\\mathrm{NA}$ 是数值孔径（无量纲），$\\lambda$ 是波长（单位：纳米）。此 $f_c$ 描述了 Abbe 成像模型中相干传递函数的通带。\n- 空间频率偏移为 $s$（单位：周期/纳米）的单个离轴光源点会引起光瞳移动至 $P(k - s)$。对于偏移量为 $\\pm s$ 的两个对称偶极子光源点，假设它们相互非相干，因此衍射图像强度是由每个移动后的光瞳所产生的相干场的模的平方取平均值得到。\n- 对于给定的掩模和光源，衍射图像强度定义为\n$$I(x; d, s) = \\frac{1}{2}\\left(\\left|\\mathcal{F}^{-1}\\left\\{M(k; d)\\,P(k-s)\\right\\}(x)\\right|^2 + \\left|\\mathcal{F}^{-1}\\left\\{M(k; d)\\,P(k+s)\\right\\}(x)\\right|^2\\right),$$\n其中 $d$ 是掩模占空比，$\\mathcal{F}^{-1}\\{\\cdot\\}$ 表示关于 $k$ 的逆傅里叶变换。占空比 $d$ 是在一个二元线-空间图形中，透光线所占周期的比例。\n- 通过以下方式将衍射图像强度归一化到 $[0,1]$ 区间\n$$I_{\\mathrm{norm}}(x; d, s) = \\frac{I(x; d, s) - \\min_x I(x; d, s)}{\\max_x I(x; d, s) - \\min_x I(x; d, s) + \\epsilon},$$\n其中 $\\epsilon$ 是一个小的正数以避免除以零，设为 $\\epsilon = 10^{-12}$。\n- 目标图形 $T(x)$ 是一个预设的二元线-空间函数，其占空比为 $d_{\\mathrm{tgt}} = 0.5$，定义在与 $m(x)$ 相同的空间网格上。\n\n离散化与计算模型：\n- 使用一个包含 $N_x = 2048$ 个样本点的空间网格。\n- 对于周期为 $p$（单位：纳米）的给定测试用例，将空间采样间隔设为 $\\Delta x = p/16$，以确保对基频进行充分采样。\n- 将二元掩模透射率 $m(x; d)$ 构建为一个周期为 $p$、占空比为 $d$ 的周期性线-空间函数，其中透光区域取值为 $1$，不透光区域取值为 $0$。\n- 在给定的网格上，通过对 $m(x; d)$ 进行离散傅里叶变换来计算 $M(k; d)$。\n- 光瞳函数是相coherent通带的指示函数：当 $|k| \\le f_c$ 时，$P(k) = 1$，否则 $P(k) = 0$。对于位于 $\\pm s$ 的偶极子光源，相应地使用 $P(k \\mp s)$。\n- 目标图形 $T(x)$ 是一个占空比为 $d_{\\mathrm{tgt}} = 0.5$、周期为 $p$ 的二元线-空间函数，其定义与掩模相同，但占空比固定为 $0.5$。\n- 将误差度量定义为均方误差：\n$$\\mathrm{MSE}(d, s) = \\frac{1}{N_x}\\sum_{i=0}^{N_x-1}\\left(I_{\\mathrm{norm}}(x_i; d, s) - T(x_i)\\right)^2.$$\n\n优化任务：\n- 对每个测试用例，执行一次网格搜索：\n    - 占空比 $d$ 在闭区间 $[0.25, 0.75]$ 内均匀采样 $17$ 个点。\n    - 光源偏移量 $s$ 在闭区间 $[0, f_c]$ 内均匀采样 $21$ 个点。\n- 对于每对 $(d, s)$，计算 $\\mathrm{MSE}(d, s)$ 并记录下获得最小均方误差的参数对。\n\n测试套件：\n- 使用以下三个测试用例，每个用例由 $(\\lambda, \\mathrm{NA}, p)$ 指定，其中 $\\lambda$ 是波长（单位：纳米），$\\mathrm{NA}$ 是数值孔径（无量纲），$p$ 是线-空间周期（单位：纳米）。\n    1. $(193, 0.93, 250)$，一个高数值孔径配置，其基频预计在相干通带内。\n    2. $(193, 0.33, 290)$，一个较低数值孔径的案例，其基频对通带构成了挑战，用以说明分辨率极限。\n    3. $(193, 0.33, 584)$，一个边界配置，其基频接近通带极限。\n\n要求输出：\n- 对于每个测试用例，您的程序必须输出一个包含三个值的列表：最优占空比 $d_{\\mathrm{opt}}$（以小数形式），最优光源偏移量 $s_{\\mathrm{opt}}$（单位：周期/纳米），以及最小均方误差 $\\mathrm{MSE}_{\\min}$（无量纲）。\n- 将所有结果聚合到单行输出中，该输出包含一个由方括号括起来的逗号分隔列表，其中每个元素本身都是一个形如 $[d_{\\mathrm{opt}}, s_{\\mathrm{opt}}, \\mathrm{MSE}_{\\min}]$ 的列表。\n- 所有空间频率必须以“周期/纳米”为单位报告，所有长度以“纳米”为单位，所有强度和误差均为无量纲。不使用角度。程序必须以所描述的精确最终格式生成结果。\n\n您的实现必须是完全自包含的，不需要任何输入，并遵守指定的离散化和搜索参数。数值结果必须使用浮点运算计算，并以上述简单的数字列表形式报告。",
            "solution": "该问题要求实现一个用于光源掩模协同优化（SMO）的一维计算模型，以找到最优的掩模占空比 $d$ 和偶极子光源偏移量 $s$，从而最小化光刻中的印刷误差。解决方案是通过在参数空间 $(d, s)$ 上执行网格搜索，并最小化模拟的衍射图像与期望目标图形之间的均方误差（MSE）来找到的。该模拟基于相干、移不变系统的标量傅里叶光学原理。\n\n模拟的核心是为图像形成过程建模。对于给定的掩模透射函数 $m(x)$ 及其傅里叶频谱 $M(k) = \\mathcal{F}\\{m(x)\\}(k)$，在相干照明下，像平面上的复振幅场是物体频谱经光瞳函数 $P(k)$ 滤波后的逆傅里叶变换。光瞳函数 $P(k)$ 充当一个低通滤波器，由相干截止空间频率 $f_c = \\mathrm{NA} / \\lambda$ 定义，其中 $\\mathrm{NA}$ 是数值孔径，$\\lambda$ 是照明波长。当 $|k| \\le f_c$ 时，光瞳函数 $P(k) = 1$，否则 $P(k) = 0$。\n\n问题指定了一个偶极子照明光源，它由两个位于空间频率 $\\pm s$ 处对称的、相互非相干的点光源组成。每个光源点都有效地在频域中移动了光瞳函数的中心。位于 $+s$ 的光源对应于光瞳 $P(k-s)$，位于 $-s$ 的光源对应于光瞳 $P(k+s)$。由于光源是非相干的，总衍射图像强度 $I(x)$ 是由每个光源独立产生的强度之和。因此，对于占空比为 $d$ 的掩模，衍射图像为：\n$$I(x; d, s) = \\frac{1}{2}\\left(\\left|\\mathcal{F}^{-1}\\left\\{M(k; d)\\,P(k-s)\\right\\}(x)\\right|^2 + \\left|\\mathcal{F}^{-1}\\left\\{M(k; d)\\,P(k+s)\\right\\}(x)\\right|^2\\right)$$\n\n对于每个由 $(\\lambda, \\mathrm{NA}, p)$ 指定的测试用例，算法按以下步骤进行：\n\n1.  **计算域的设置**：\n    建立一个包含 $N_x = 2048$ 个点的一维空间网格。空间采样间隔为 $\\Delta x = p/16$，其中 $p$ 是目标图形的周期。模拟域的总空间范围是 $L = N_x \\Delta x = 128p$。空间坐标向量为 $x_i = i \\Delta x$，其中 $i_x = 0, \\ldots, N_x-1$。\n    相应的空间频率域由离散傅里叶变换（DFT）确定。频率采样间隔为 $\\Delta k = 1/L$，频率向量 $k$ 使用 `fftfreq` 约定生成，该约定为 FFT 算法正确地排列了负频率和正频率。\n\n2.  **图形生成**：\n    掩模透射函数 $m(x; d)$ 和目标图形 $T(x)$ 都是二元周期性线-空间图形。图形的单个周期有 $N_p = p/\\Delta x = 16$ 个样本点。对于给定的占空比 $d$，透光部分由 $\\text{round}(d \\times N_p)$ 个值为 $1$ 的样本点组成，其余部分为值为 $0$ 的不透光部分。通过将这个单周期图形平铺 $N_x / N_p = 128$ 次，来创建在 $N_x$ 点网格上的完整图形。目标图形 $T(x)$ 的占空比固定为 $d_{\\mathrm{tgt}} = 0.5$。\n\n3.  **通过网格搜索进行优化**：\n    执行网格搜索以找到最优参数 $(d_{\\mathrm{opt}}, s_{\\mathrm{opt}})$。\n    -   掩模占空比 $d$ 在区间 $[0.25, 0.75]$ 内采样 $17$ 个点。\n    -   光源偏移量 $s$ 在区间 $[0, f_c]$ 内采样 $21$ 个点，其中 $f_c = \\mathrm{NA}/\\lambda$。\n\n4.  **误差评估循环**：\n    对于搜索网格中的每一对 $(d, s)$，执行以下步骤：\n    a.  构建掩模 $m(x; d)$。\n    b.  使用快速傅里叶变换（FFT）计算其频谱 $M(k; d)$。\n    c.  构建两个移位的光瞳函数 $P_1(k) = P(k-s)$ 和 $P_2(k) = P(k+s)$。这些是二元数组，当绝对值的参数小于或等于 $f_c$ 时，其值为1，否则为0。\n    d.  使用逆快速傅里叶变换（IFFT）计算像平面复振幅场 $E_1(x) = \\mathcal{F}^{-1}\\{M(k; d) P_1(k)\\}$ 和 $E_2(x) = \\mathcal{F}^{-1}\\{M(k; d) P_2(k)\\}$。\n    e.  计算最终的衍射图像强度 $I(x; d, s) = 0.5 \\times ( |E_1(x)|^2 + |E_2(x)|^2 )$。\n    f.  使用提供的公式将强度归一化到 $[0, 1]$ 范围：\n       $$I_{\\mathrm{norm}}(x; d, s) = \\frac{I(x; d, s) - \\min_x I(x; d, s)}{\\max_x I(x; d, s) - \\min_x I(x; d, s) + \\epsilon}$$\n       其中正则化小常数 $\\epsilon = 10^{-12}$。\n    g.  计算归一化图像与目标图形之间的均方误差（MSE）：\n       $$\\mathrm{MSE}(d, s) = \\frac{1}{N_x}\\sum_{i=0}^{N_x-1}\\left(I_{\\mathrm{norm}}(x_i; d, s) - T(x_i)\\right)^2$$\n    h.  将计算出的 $\\mathrm{MSE}(d, s)$ 与迄今为止找到的最小 MSE 进行比较。如果当前值更小，则将当前的 $(d, s)$ 和 MSE 存储为新的最优值。\n\n5.  **结果聚合**：\n    在对一个测试用例的整个网格进行迭代后，将得到的最优三元组 $(d_{\\mathrm{opt}}, s_{\\mathrm{opt}}, \\mathrm{MSE}_{\\min})$ 存储起来。对所有三个测试用例重复此过程，并将最终结果聚合到一个列表的列表中。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Source-Mask Optimization problem for the given test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (lambda_val, NA, period)\n    test_cases = [\n        (193, 0.93, 250),\n        (193, 0.33, 290),\n        (193, 0.33, 584),\n    ]\n\n    # Global parameters\n    Nx = 2048\n    epsilon = 1e-12\n    d_points = 17\n    s_points = 21\n\n    results = []\n\n    for lambda_val, NA, p in test_cases:\n        # 1. Setup of Computational Domain\n        dx = p / 16.0\n        L = Nx * dx\n        x = np.arange(Nx) * dx\n        k = np.fft.fftfreq(Nx, d=dx)\n\n        # 2. Pattern Generation (Target)\n        d_tgt = 0.5\n        N_period = int(round(p / dx))\n        \n        def create_pattern(d, N_period_samples, num_periods):\n            single_period = np.zeros(N_period_samples)\n            width_samples = int(round(d * N_period_samples))\n            single_period[:width_samples] = 1.0\n            return np.tile(single_period, num_periods)\n\n        T_x = create_pattern(d_tgt, N_period, Nx // N_period)\n\n        # 3. Optimization via Grid Search\n        fc = NA / lambda_val\n        d_space = np.linspace(0.25, 0.75, d_points)\n        s_space = np.linspace(0, fc, s_points)\n\n        min_mse = float('inf')\n        best_d = -1\n        best_s = -1\n\n        # 4. Error Evaluation Loop\n        for d in d_space:\n            # Generate mask and its spectrum\n            m_x = create_pattern(d, N_period, Nx // N_period)\n            M_k = np.fft.fft(m_x)\n\n            for s in s_space:\n                # Construct pupil functions for dipole source\n                pupil_s_plus = np.where(np.abs(k - s) <= fc, 1.0, 0.0)\n                pupil_s_minus = np.where(np.abs(k + s) <= fc, 1.0, 0.0)\n\n                # Filter spectrum with each pupil\n                G_plus = M_k * pupil_s_plus\n                G_minus = M_k * pupil_s_minus\n\n                # IFFT to get complex fields at image plane\n                E_plus = np.fft.ifft(G_plus)\n                E_minus = np.fft.ifft(G_minus)\n\n                # Calculate intensities and sum incoherently\n                I_plus = np.abs(E_plus)**2\n                I_minus = np.abs(E_minus)**2\n                I_total = 0.5 * (I_plus + I_minus)\n\n                # Normalize image intensity\n                I_min = np.min(I_total)\n                I_max = np.max(I_total)\n                denominator = I_max - I_min + epsilon\n                \n                if denominator > 0:\n                    I_norm = (I_total - I_min) / denominator\n                else: # Handle flat intensity profile\n                    I_norm = np.zeros_like(I_total)\n\n                # Calculate MSE\n                mse = np.mean((I_norm - T_x)**2)\n\n                # Update best parameters if current MSE is lower\n                if mse < min_mse:\n                    min_mse = mse\n                    best_d = d\n                    best_s = s\n        \n        # Store results for the current test case\n        results.append([best_d, best_s, min_mse])\n\n    # Final print statement in the exact required format.\n    # Using str(list) produces spaces, which seems to be the standard python representation.\n    # Joining these string representations with a comma.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}