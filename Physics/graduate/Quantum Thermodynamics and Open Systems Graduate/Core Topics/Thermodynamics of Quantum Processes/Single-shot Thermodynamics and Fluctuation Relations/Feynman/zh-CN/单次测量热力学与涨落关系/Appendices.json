{
    "hands_on_practices": [
        {
            "introduction": "在量子力学中，“功”不是一个静态的观测量，而是通过一个过程来定义的。双点测量（TPM）方案为功提供了一个操作性定义，它已成为研究非平衡量子系统能量交换的基石。本练习  将引导您为一个被驱动的量子比特（一个典型的模型）计算功分布，这是一个基础而重要的计算。通过这个练习，您将澄清“广义功”和“狭义功”定义之间的关键区别，并计算涨落关系中核心的特征函数 $\\langle \\exp(-\\beta W) \\rangle$，从而加深对量子功和相关涨落定理的理解。",
            "id": "3784493",
            "problem": "考虑一个由含时哈密顿量 $H(t)=\\frac{\\omega}{2}\\sigma_{z}+\\lambda(t)\\sigma_{x}$ 驱动的量子比特，其中 $\\sigma_{x}$ 和 $\\sigma_{z}$ 是泡利算符，且 $\\omega>0$。系统初始制备于相对于裸哈密顿量 $H(0)=\\frac{\\omega}{2}\\sigma_{z}$ 的吉布斯态，其逆温度为 $\\beta>0$，即 $\\rho_{0}=\\exp(-\\beta H(0))/Z_{0}$，其中 $Z_{0}=\\operatorname{Tr}[\\exp(-\\beta H(0))]$。在时刻 $t=0^{+}$，经典场被突然淬火至一个恒定值 $\\lambda(t)=\\lambda$（对于 $t\\in[0,\\tau]$），其中 $\\tau\\to 0^{+}$，因此在该过程中的幺正演化算符等效于单位算符，$U(\\tau)\\approx \\mathbb{I}$。末态哈密顿量为 $H(\\tau)=\\frac{\\omega}{2}\\sigma_{z}+\\lambda\\,\\sigma_{x}$。\n\n在两点测量（TPM）方案下，定义排他功为在过程的开始和结束时测量的相对于裸哈密顿量 $H_{0}=\\frac{\\omega}{2}\\sigma_{z}$ 的能量差；定义包容功为分别在开始和结束时测量的 $H(0)$ 和 $H(\\tau)$ 之间的能量差。从幺正量子力学的第一性原理、TPM 方案的定义以及吉布斯系综出发，完成以下任务：\n\n- 对角化 $H(0)$ 和 $H(\\tau)$，并确定两者的本征值和本征态。\n- 计算所述突然淬火过程的排他 TPM 功分布 $P_{\\mathrm{excl}}(W)$。\n- 计算相同过程的包容 TPM 功分布 $P_{\\mathrm{incl}}(W)$。\n- 利用这些分布，推导涨落平均值 $\\langle \\exp(-\\beta W_{\\mathrm{excl}})\\rangle$ 和 $\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle$。\n\n你的最终任务是，以闭合形式提供差值\n$$\\Delta(\\beta,\\omega,\\lambda)\\equiv \\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle-\\langle \\exp(-\\beta W_{\\mathrm{excl}})\\rangle,$$\n的单一解析表达式，并用 $\\beta$、$\\omega$ 和 $\\lambda$ 尽可能地简化。最终答案必须是单一的闭合形式解析表达式。无需四舍五入；最终表达式中不包含单位。",
            "solution": "该问题要求计算一个突然量子淬火过程中，包容功与排他功的特征函数之差。我们首先验证问题的有效性，然后进行推导。\n\n### 问题验证\n**第1步：提取已知条件**\n-   系统哈密顿量: $H(t)=\\frac{\\omega}{2}\\sigma_{z}+\\lambda(t)\\sigma_{x}$，其中 $\\omega>0$。\n-   初始态: 吉布斯态 $\\rho_{0}=\\exp(-\\beta H(0))/Z_{0}$，逆温度为 $\\beta>0$。\n-   初始哈密顿量: $H(0)=\\frac{\\omega}{2}\\sigma_{z}$。\n-   过程: 在 $t=0^{+}$ 时，突然淬火至 $\\lambda(t)=\\lambda$，持续时间为 $t\\in[0,\\tau]$。\n-   过程持续时间: $\\tau\\to 0^{+}$。\n-   幺正演化算符: $U(\\tau)\\approx \\mathbb{I}$。\n-   末态哈密顿量: $H(\\tau)=\\frac{\\omega}{2}\\sigma_{z}+\\lambda\\,\\sigma_{x}$。\n-   排他功, $W_{\\mathrm{excl}}$: 在 $t=0$ 和 $t=\\tau$ 时测量的相对于裸哈密顿量 $H_{0}=\\frac{\\omega}{2}\\sigma_{z}$ 的能量差。\n-   包容功, $W_{\\mathrm{incl}}$: 分别在 $t=0$ 和 $t=\\tau$ 时测量的 $H(0)$ 和 $H(\\tau)$ 之间的能量差。\n-   任务: 对角化 $H(0)$ 和 $H(\\tau)$；计算功分布 $P_{\\mathrm{excl}}(W)$ 和 $P_{\\mathrm{incl}}(W)$；计算涨落平均值 $\\langle \\exp(-\\beta W_{\\mathrm{excl}})\\rangle$ 和 $\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle$；求差值 $\\Delta(\\beta,\\omega,\\lambda) = \\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle-\\langle \\exp(-\\beta W_{\\mathrm{excl}})\\rangle$。\n\n**第2步：使用提取的已知条件进行验证**\n问题在量子力学和量子热力学领域具有科学依据。它使用了泡利矩阵、哈密顿量、吉布斯态、两点测量（TPM）方案和量子淬火等标准概念。问题是良定的：初始态、动力学（突然淬火意味着 $U\\approx\\mathbb{I}$）以及用于测量的可观测量都已明确定义。“排他功”和“包容功”的定义虽然是针对此特定情境，但陈述清晰无歧义，可以得出唯一解。问题是客观的，没有事实错误、伪科学或含糊不清之处。这是一个可形式化的理论物理问题，与单次测量热力学和涨落关系的主题直接相关。整个设置是自洽且一致的。\n\n**第3步：结论与行动**\n问题有效。我们开始求解。\n\n###\n**1. 哈密顿量、本征值和本征态**\n\n$t=0$ 时的初始哈密顿量是 $H(0) = \\frac{\\omega}{2}\\sigma_{z}$。由于 $\\sigma_z = \\begin{pmatrix} 1  0 \\\\ 0  -1 \\end{pmatrix}$，$H(0)$ 在标准基中已经是对角的。\n$$H(0) = \\begin{pmatrix} \\frac{\\omega}{2}  0 \\\\ 0  -\\frac{\\omega}{2} \\end{pmatrix}$$\n本征值为 $E_0^{(0)} = \\frac{\\omega}{2}$ 和 $E_1^{(0)} = -\\frac{\\omega}{2}$。对应的本征态是标准基矢量 $|0\\rangle = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$ 和 $|1\\rangle = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$。\n\n$t=\\tau$ 时的末态哈密顿量是 $H(\\tau) = \\frac{\\omega}{2}\\sigma_z + \\lambda\\sigma_x$。\n$$H(\\tau) = \\begin{pmatrix} \\frac{\\omega}{2}  \\lambda \\\\ \\lambda  -\\frac{\\omega}{2} \\end{pmatrix}$$\n为了求本征值 $E'$，我们求解特征方程 $\\det(H(\\tau) - E'\\mathbb{I}) = 0$：\n$$(\\frac{\\omega}{2}-E')(-\\frac{\\omega}{2}-E') - \\lambda^2 = 0 \\implies E'^2 - \\frac{\\omega^2}{4} - \\lambda^2 = 0$$\n$$E' = \\pm\\sqrt{\\frac{\\omega^2}{4}+\\lambda^2} = \\pm\\frac{1}{2}\\sqrt{\\omega^2+4\\lambda^2}$$\n我们定义 $\\Omega = \\sqrt{\\omega^2+4\\lambda^2}$。$H(\\tau)$ 的本征值为 $E_0^{(\\tau)} = \\frac{\\Omega}{2}$ 和 $E_1^{(\\tau)} = -\\frac{\\Omega}{2}$。\n\n###\n**2. 初始态和配分函数**\n\n系统初始处于相对于 $H(0)$ 的吉布斯态：$\\rho_0 = \\exp(-\\beta H(0))/Z_0$。\n初始配分函数为：\n$$Z_0 = \\operatorname{Tr}[\\exp(-\\beta H(0))] = \\exp(-\\beta E_0^{(0)}) + \\exp(-\\beta E_1^{(0)}) = \\exp\\left(-\\frac{\\beta\\omega}{2}\\right) + \\exp\\left(\\frac{\\beta\\omega}{2}\\right) = 2\\cosh\\left(\\frac{\\beta\\omega}{2}\\right)$$\n测量到初始能量 $E_0^{(0)}$ 和 $E_1^{(0)}$ 的概率为：\n$p_0 = \\langle 0|\\rho_0|0\\rangle = \\frac{1}{Z_0}\\exp(-\\beta E_0^{(0)}) = \\frac{1}{Z_0}\\exp(-\\frac{\\beta\\omega}{2})$\n$p_1 = \\langle 1|\\rho_0|1\\rangle = \\frac{1}{Z_0}\\exp(-\\beta E_1^{(0)}) = \\frac{1}{Z_0}\\exp(\\frac{\\beta\\omega}{2})$\n\n###\n**3. 排他功**\n\n排他功 $W_{\\mathrm{excl}}$ 由TPM方案定义，其中能量在 $t=0$ 和 $t=\\tau$ 时都是相对于 $H_0 = H(0)$ 测量的。功是测得的能量本征值之差。\n1.  在 $t=0$ 时，对 $H_0$ 进行投影测量。得到结果 $E_n^{(0)}$（其中 $n \\in \\{0,1\\}$）的概率为 $p_n$。系统状态塌缩到相应的本征态 $|n\\rangle$。\n2.  系统在幺正算符 $U(\\tau)$ 下演化。对于突然淬火，$\\tau \\to 0^{+}$，因此 $U(\\tau) \\approx \\mathbb{I}$。系统状态保持为 $|n\\rangle$。\n3.  在 $t=\\tau$ 时，对状态 $|n\\rangle$ 进行 $H_0$ 的投影测量。获得结果 $E_m^{(0)}$ 的概率为 $|\\langle m|U(\\tau)|n\\rangle|^2 \\approx |\\langle m|n\\rangle|^2 = \\delta_{mn}$。\n\n这意味着如果初始测量得到 $E_n^{(0)}$，那么末次测量也将以概率1得到 $E_n^{(0)}$。所做的功为 $W_{\\mathrm{excl}} = E_n^{(0)} - E_n^{(0)} = 0$。这是唯一可能的结果。因此，功分布是一个以零为中心的狄拉克δ函数：\n$$P_{\\mathrm{excl}}(W) = \\delta(W)$$\n对应的涨落平均值为：\n$$\\langle \\exp(-\\beta W_{\\mathrm{excl}})\\rangle = \\int_{-\\infty}^{\\infty} dW P_{\\mathrm{excl}}(W) \\exp(-\\beta W) = \\int_{-\\infty}^{\\infty} dW \\delta(W) \\exp(-\\beta W) = \\exp(0) = 1$$\n\n###\n**4. 包容功**\n\n包容功 $W_{\\mathrm{incl}}$ 由TPM方案定义，其中能量在 $t=0$ 时相对于 $H(0)$ 测量，在 $t=\\tau$ 时相对于 $H(\\tau)$ 测量。\n1.  第一次测量与排他功的情况相同。\n2.  经过初始测量和演化后，系统状态为 $|n\\rangle$。\n3.  在 $t=\\tau$ 时，对 $H(\\tau)$ 进行投影测量。可能的结果是其本征值 $E_m^{(\\tau)}$（其中 $m \\in \\{0,1\\}$）。在给定初始态 $|n\\rangle$ 的条件下，获得 $E_m^{(\\tau)}$ 的概率是 $|\\langle m'|U(\\tau)|n\\rangle|^2 \\approx |\\langle m'|n\\rangle|^2$，其中 $|m'\\rangle$ 是 $H(\\tau)$ 的本征态。\n\n功是 $W = E_m^{(\\tau)} - E_n^{(0)}$。功的特征函数由下式给出：\n$$\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle = \\sum_{n,m=0,1} p_n |\\langle m'|U(\\tau)|n\\rangle|^2 \\exp(-\\beta(E_m^{(\\tau)} - E_n^{(0)}))$$\n代入 $p_n = \\exp(-\\beta E_n^{(0)})/Z_0$ 和 $U(\\tau) \\approx \\mathbb{I}$：\n$$\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle = \\sum_{n,m} \\frac{\\exp(-\\beta E_n^{(0)})}{Z_0} |\\langle m'|n\\rangle|^2 \\exp(-\\beta E_m^{(\\tau)}) \\exp(\\beta E_n^{(0)})$$\n$$\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle = \\frac{1}{Z_0} \\sum_{n,m} |\\langle m'|n\\rangle|^2 \\exp(-\\beta E_m^{(\\tau)})$$\n我们可以先对 $n$ 求和。利用基 $\\{|n\\rangle\\}$ 的完备性，$\\sum_n |n\\rangle\\langle n| = \\mathbb{I}$：\n$$\\sum_n |\\langle m'|n\\rangle|^2 = \\sum_n \\langle m'|n\\rangle\\langle n|m'\\rangle = \\langle m'| \\left(\\sum_n |n\\rangle\\langle n|\\right) |m'\\rangle = \\langle m'|\\mathbb{I}|m'\\rangle = 1$$\n因此，表达式简化为：\n$$\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle = \\frac{1}{Z_0} \\sum_m \\exp(-\\beta E_m^{(\\tau)})$$\n该和是在相同逆温度 $\\beta$ 下与末态哈密顿量 $H(\\tau)$ 相关联的配分函数 $Z_\\tau$：\n$$Z_\\tau = \\operatorname{Tr}[\\exp(-\\beta H(\\tau))] = \\exp(-\\beta E_0^{(\\tau)}) + \\exp(-\\beta E_1^{(\\tau)}) = \\exp\\left(-\\frac{\\beta\\Omega}{2}\\right) + \\exp\\left(\\frac{\\beta\\Omega}{2}\\right) = 2\\cosh\\left(\\frac{\\beta\\Omega}{2}\\right)$$\n这得到了量子淬火中著名的类Jarzynski关系：\n$$\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle = \\frac{Z_\\tau}{Z_0} = \\frac{2\\cosh(\\frac{\\beta\\Omega}{2})}{2\\cosh(\\frac{\\beta\\omega}{2})} = \\frac{\\cosh(\\frac{\\beta}{2}\\sqrt{\\omega^2+4\\lambda^2})}{\\cosh(\\frac{\\beta\\omega}{2})}$$\n\n###\n**5. 最终差值计算**\n\n所求的量是 $\\Delta(\\beta,\\omega,\\lambda) = \\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle - \\langle \\exp(-\\beta W_{\\mathrm{excl}})\\rangle$。\n代入前面几节的结果：\n$$\\Delta(\\beta,\\omega,\\lambda) = \\frac{\\cosh\\left(\\frac{\\beta}{2}\\sqrt{\\omega^2+4\\lambda^2}\\right)}{\\cosh\\left(\\frac{\\beta\\omega}{2}\\right)} - 1$$\n这个表达式可以合并成一个分数：\n$$\\Delta(\\beta,\\omega,\\lambda) = \\frac{\\cosh\\left(\\frac{\\beta}{2}\\sqrt{\\omega^2+4\\lambda^2}\\right) - \\cosh\\left(\\frac{\\beta\\omega}{2}\\right)}{\\cosh\\left(\\frac{\\beta\\omega}{2}\\right)}$$\n这就是差值的最终简化解析表达式。",
            "answer": "$$\n\\boxed{\\frac{\\cosh\\left(\\frac{\\beta}{2}\\sqrt{\\omega^2+4\\lambda^2}\\right)}{\\cosh\\left(\\frac{\\beta\\omega}{2}\\right)} - 1}\n$$"
        },
        {
            "introduction": "从分析单个过程转向理解状态转换的普适规律，是单次热力学理论的一大飞跃。热操作的资源理论为此提供了一个严谨的框架，其核心判据是热主序化（thermo-majorization）。该判据精确地回答了在单次测量（single-shot）范式下，一个量子态能否通过热操作转换为另一个量子态。本练习  将帮助您将热主序化曲线这一抽象的几何条件，转化为一组具体的、可验证的代数不等式，从而使这个强大的理论工具变得具体且易于应用。",
            "id": "3784440",
            "problem": "考虑一个有限维量子系统，其哈密顿量为 $H = \\sum_{i=1}^{d} E_{i} \\, |i\\rangle\\langle i|$，与逆温度为 $\\beta$ 的热浴接触。在热操作（TO）的资源理论中，两个对角态 $\\boldsymbol{p} = (p_{1},\\dots,p_{d})$ 和 $\\boldsymbol{q} = (q_{1},\\dots,q_{d})$ 之间的单次转换的充分必要判据由热力学主序关系编码，该关系使用 $\\beta$-序和吉布斯权重来定义。从吉布斯权重 $g_{i} \\propto \\exp(-\\beta E_{i})$ 的定义以及通过将分布 $\\boldsymbol{r}$ 的分量按 $r_{i} \\exp(\\beta E_{i})$ 的降序排列所导出的 $\\beta$-序出发，构建一个最小的 $\\beta$-序线性不等式组，该不等式组的满足等价于从 $\\boldsymbol{p}$ 到 $\\boldsymbol{q}$ 的热力学主序转换。您的构建应从热力学主序曲线的第一性原理推导得出，并且应仅依赖于在由 $\\boldsymbol{q}$ 的 $\\beta$-序确定的一个最小横坐标集合上验证 $\\boldsymbol{p}$ 的曲线对 $\\boldsymbol{q}$ 的曲线的支配关系。\n\n然后，在以下三能级例子上验证您的不等式。设 $d=3$，能量为 $E_{1}=0$，$E_{2}=1$，$E_{3}=2$，以 $k_{B}T$ 为单位测量，因此 $\\beta=1$ 是无量纲的，并设\n$$\n\\boldsymbol{p} = (0.7,\\,0.2,\\,0.1),\\qquad \\boldsymbol{q} = (0.6,\\,0.25,\\,0.15).\n$$\n使用由 $\\boldsymbol{q}$ 导出的 $\\beta$-序，评估您的最小不等式组。通过 $\\boldsymbol{p}$ 的 $\\beta$-序定义态 $\\boldsymbol{p}$ 的热力学主序曲线 $C_{\\boldsymbol{p}}(x)$，并令 $x_{k}^{\\boldsymbol{q}}$ 表示由 $\\boldsymbol{q}$ 的 $\\beta$-序生成的断点横坐标， $y_{k}^{\\boldsymbol{q}}$ 为相应的累积纵坐标。计算在此最小集合上，$\\boldsymbol{p}$ 相对于 $\\boldsymbol{q}$ 的热力学主序关系的最大违背量 $D$ 的大小，\n$$\nD := \\max_{k \\in \\{1,2\\}} \\left[\\, y_{k}^{\\boldsymbol{q}} - C_{\\boldsymbol{p}}\\!\\left(x_{k}^{\\boldsymbol{q}}\\right) \\,\\right]_{+},\n$$\n其中 $[x]_{+} := \\max\\{x,0\\}$。将 $D$ 的最终数值表示为最简分数。无需四舍五入。量 $D$ 是无量纲的。",
            "solution": "该问题是良定的且科学上合理，位于单次量子热力学和资源理论的标准框架内。它是完整、一致的，并且需要标准的推导和计算。因此，我们开始进行解答。\n\n### 第一部分：最小不等式组的推导\n\n在热操作（TO）下，对于能量基底下对角的态，单次状态转换 $\\boldsymbol{p} \\to \\boldsymbol{q}$ 的条件由热力学主序关系给出，记为 $\\boldsymbol{p} \\succ_{\\text{th}} \\boldsymbol{q}$。该关系可以用热力学主序曲线几何地表示。\n\n设系统哈密顿量为 $H = \\sum_{i=1}^{d} E_{i} |i\\rangle\\langle i|$，并与逆温度为 $\\beta$ 的热浴接触。一个对角态由概率分布 $\\boldsymbol{r} = (r_1, \\dots, r_d)$ 给出。\n\n首先，我们定义分布 $\\boldsymbol{r}$ 的 $\\beta$-序。这由指标 $\\{1, \\dots, d\\}$ 的一个排列 $\\pi_{\\boldsymbol{r}}$ 决定，该排列将量 $r_i \\exp(\\beta E_i)$ 按非递增顺序排序：\n$$\nr_{\\pi_{\\boldsymbol{r}}(1)} \\exp(\\beta E_{\\pi_{\\boldsymbol{r}}(1)}) \\ge r_{\\pi_{\\boldsymbol{r}}(2)} \\exp(\\beta E_{\\pi_{\\boldsymbol{r}}(2)}) \\ge \\dots \\ge r_{\\pi_{\\boldsymbol{r}}(d)} \\exp(\\beta E_{\\pi_{\\boldsymbol{r}}(d)})\n$$\n\n态 $\\boldsymbol{r}$ 的热力学主序曲线 $C_{\\boldsymbol{r}}(x)$ 是在区间 $[0, Z_{\\beta}]$ 上的一个分段线性函数，其中 $Z_{\\beta} = \\sum_{i=1}^d \\exp(-\\beta E_i)$。该曲线通过连接点 $(x_k^{\\boldsymbol{r}}, y_k^{\\boldsymbol{r}})$（$k=0, 1, \\dots, d$）来构建。这些点称为断点，定义如下：\n-   $(x_0^{\\boldsymbol{r}}, y_0^{\\boldsymbol{r}}) = (0, 0)$\n-   对于 $k=1, \\dots, d$：\n    $$ x_k^{\\boldsymbol{r}} = \\sum_{j=1}^k \\exp(-\\beta E_{\\pi_{\\boldsymbol{r}}(j)}) $$\n    $$ y_k^{\\boldsymbol{r}} = \\sum_{j=1}^k r_{\\pi_{\\boldsymbol{r}}(j)} $$\n曲线 $C_{\\boldsymbol{r}}(x)$ 是这些连续断点之间的线性插值。在 $(x_{k-1}^{\\boldsymbol{r}}, y_{k-1}^{\\boldsymbol{r}})$ 和 $(x_k^{\\boldsymbol{r}}, y_k^{\\boldsymbol{r}})$ 之间的线段斜率由 $r_{\\pi_{\\boldsymbol{r}}(k)}/\\exp(-\\beta E_{\\pi_{\\boldsymbol{r}}(k)}) = r_{\\pi_{\\boldsymbol{r}}(k)}\\exp(\\beta E_{\\pi_{\\boldsymbol{r}}(k)})$ 给出。根据 $\\beta$-序的定义，这些斜率是非递增的，这意味着 $C_{\\boldsymbol{r}}(x)$ 是一个凸函数。\n\n热力学主序条件 $\\boldsymbol{p} \\succ_{\\text{th}} \\boldsymbol{q}$ 等价于 $\\boldsymbol{p}$ 的曲线处处不低于 $\\boldsymbol{q}$ 的曲线：\n$$ C_{\\boldsymbol{p}}(x) \\ge C_{\\boldsymbol{q}}(x) \\quad \\text{for all } x \\in [0, Z_{\\beta}] $$\n由于两个函数都是凸函数且共享相同的端点 $(0,0)$ 和 $(Z_{\\beta}, 1)$，此条件成立当且仅当该不等式在下方曲线 $C_{\\boldsymbol{q}}(x)$ 的断点处成立。\n\n因此，为使转换 $\\boldsymbol{p} \\to \\boldsymbol{q}$ 成为可能，必须验证的最小不等式组是：\n$$ C_{\\boldsymbol{p}}(x_k^{\\boldsymbol{q}}) \\ge y_k^{\\boldsymbol{q}} \\quad \\text{for } k = 1, 2, \\dots, d-1. $$\n注意，根据定义有 $y_k^{\\boldsymbol{q}} = C_{\\boldsymbol{q}}(x_k^{\\boldsymbol{q}})$。在 $k=0$ 和 $k=d$ 处的检查是平凡的，因为 $C_{\\boldsymbol{p}}(0) = C_{\\boldsymbol{q}}(0) = 0$ 且 $C_{\\boldsymbol{p}}(Z_{\\beta}) = C_{\\boldsymbol{q}}(Z_{\\beta}) = 1$。$C_{\\boldsymbol{p}}(x_k^{\\boldsymbol{q}})$ 的值是通过在横坐标 $x_k^{\\boldsymbol{q}}$ 处评估分段线性函数 $C_{\\boldsymbol{p}}(x)$ 来找到的。\n\n### 第二部分：数值验证与计算\n\n给定一个三能级系统，其中 $d=3$。能量为 $E_1=0$、$E_2=1$ 和 $E_3=2$，以 $k_B T$ 为单位，因此我们取 $\\beta=1$。态为 $\\boldsymbol{p} = (0.7, 0.2, 0.1)$ 和 $\\boldsymbol{q} = (0.6, 0.25, 0.15)$。\n\n首先，我们计算玻尔兹曼因子 $\\exp(-\\beta E_i)$：\n-   $\\exp(-\\beta E_1) = \\exp(-1 \\cdot 0) = 1$\n-   $\\exp(-\\beta E_2) = \\exp(-1 \\cdot 1) = \\exp(-1)$\n-   $\\exp(-\\beta E_3) = \\exp(-1 \\cdot 2) = \\exp(-2)$\n\n接下来，我们通过对 $q_i \\exp(\\beta E_i)$ 排序来确定目标态 $\\boldsymbol{q}$ 的 $\\beta$-序：\n-   $i=1$: $q_1 \\exp(E_1) = 0.6 \\exp(0) = 0.6$\n-   $i=2$: $q_2 \\exp(E_2) = 0.25 \\exp(1)$\n-   $i=3$: $q_3 \\exp(E_3) = 0.15 \\exp(2)$\n由于 $\\exp(1) \\approx 2.718$ 且 $\\exp(2) \\approx 7.389$，我们有 $0.25\\exp(1) \\approx 0.680$ 和 $0.15\\exp(2) \\approx 1.108$。\n因此，$q_3 \\exp(E_3) > q_2 \\exp(E_2) > q_1 \\exp(E_1)$。$\\boldsymbol{q}$ 的 $\\beta$-序由排列 $\\pi_{\\boldsymbol{q}} = (3, 2, 1)$ 给出。\n\n曲线 $C_{\\boldsymbol{q}}(x)$ 的断点由该顺序确定。最小不等式组需要在 $k=1$ 和 $k=2$ 处进行检查。\n-   对于 $k=1$：\n    $x_1^{\\boldsymbol{q}} = \\exp(-E_{\\pi_{\\boldsymbol{q}}(1)}) = \\exp(-E_3) = \\exp(-2)$\n    $y_1^{\\boldsymbol{q}} = q_{\\pi_{\\boldsymbol{q}}(1)} = q_3 = 0.15$\n-   对于 $k=2$：\n    $x_2^{\\boldsymbol{q}} = \\exp(-E_3) + \\exp(-E_2) = \\exp(-2) + \\exp(-1)$\n    $y_2^{\\boldsymbol{q}} = q_3 + q_2 = 0.15 + 0.25 = 0.40$\n\n为了评估这些不等式，我们必须计算 $C_{\\boldsymbol{p}}(x_k^{\\boldsymbol{q}})$。这需要 $\\boldsymbol{p}$ 的热力学主序曲线，因此我们首先通过对 $p_i \\exp(E_i)$ 排序来找到其 $\\beta$-序：\n-   $i=1$: $p_1 \\exp(E_1) = 0.7 \\exp(0) = 0.7$\n-   $i=2$: $p_2 \\exp(E_2) = 0.2 \\exp(1) \\approx 0.544$\n-   $i=3$: $p_3 \\exp(E_3) = 0.1 \\exp(2) \\approx 0.739$\n因此，$p_3 \\exp(E_3) > p_1 \\exp(E_1) > p_2 \\exp(E_2)$。$\\boldsymbol{p}$ 的 $\\beta$-序为 $\\pi_{\\boldsymbol{p}} = (3, 1, 2)$。\n\n$C_{\\boldsymbol{p}}(x)$ 的断点为：\n-   $(x_0^{\\boldsymbol{p}}, y_0^{\\boldsymbol{p}}) = (0, 0)$\n-   $k=1$: $x_1^{\\boldsymbol{p}} = \\exp(-E_3) = \\exp(-2)$，且 $y_1^{\\boldsymbol{p}} = p_3 = 0.1$。\n-   $k=2$: $x_2^{\\boldsymbol{p}} = \\exp(-E_3) + \\exp(-E_1) = \\exp(-2) + 1$，且 $y_2^{\\boldsymbol{p}} = p_3 + p_1 = 0.1 + 0.7 = 0.8$。\n-   $k=3$: $x_3^{\\boldsymbol{p}} = \\exp(-E_3) + \\exp(-E_1) + \\exp(-E_2) = \\exp(-2) + 1 + \\exp(-1)$，且 $y_3^{\\boldsymbol{p}} = p_3 + p_1 + p_2 = 1.0$。\n\n现在我们可以计算 $C_{\\boldsymbol{p}}(x_k^{\\boldsymbol{q}})$ 和违背量大小 $D$。在检查点 $k$ 处的违背量为 $[y_k^{\\boldsymbol{q}} - C_{\\boldsymbol{p}}(x_k^{\\boldsymbol{q}})]_+$。\n\n-   **检查点 $k=1$**：\n$x_1^{\\boldsymbol{q}} = \\exp(-2)$。这个横坐标与 $C_{\\boldsymbol{p}}(x)$ 的第一个断点重合，即 $x_1^{\\boldsymbol{q}} = x_1^{\\boldsymbol{p}}$。\n因此，$C_{\\boldsymbol{p}}(x_1^{\\boldsymbol{q}}) = y_1^{\\boldsymbol{p}} = 0.1$。\n违背量为 $[y_1^{\\boldsymbol{q}} - C_{\\boldsymbol{p}}(x_1^{\\boldsymbol{q}})]_+ = [0.15 - 0.1]_+ = [0.05]_+ = 0.05$。\n\n-   **检查点 $k=2$**：\n$x_2^{\\boldsymbol{q}} = \\exp(-2) + \\exp(-1)$。为了找到 $C_{\\boldsymbol{p}}(x_2^{\\boldsymbol{q}})$，我们确定 $x_2^{\\boldsymbol{q}}$ 相对于 $C_{\\boldsymbol{p}}(x)$ 断点的位置。\n$x_1^{\\boldsymbol{p}} = \\exp(-2)$ 且 $x_2^{\\boldsymbol{p}} = 1 + \\exp(-2)$。由于 $\\exp(-1)  1$，我们有 $x_1^{\\boldsymbol{p}}  x_2^{\\boldsymbol{q}}  x_2^{\\boldsymbol{p}}$。\n值 $C_{\\boldsymbol{p}}(x_2^{\\boldsymbol{q}})$ 是通过在 $(x_1^{\\boldsymbol{p}}, y_1^{\\boldsymbol{p}})$ 和 $(x_2^{\\boldsymbol{p}}, y_2^{\\boldsymbol{p}})$ 之间的线段上进行线性插值得到的。该线段的斜率为：\n$$ m = \\frac{y_2^{\\boldsymbol{p}} - y_1^{\\boldsymbol{p}}}{x_2^{\\boldsymbol{p}} - x_1^{\\boldsymbol{p}}} = \\frac{0.8 - 0.1}{(1 + \\exp(-2)) - \\exp(-2)} = \\frac{0.7}{1} = 0.7 $$\n曲线的值为：\n\\begin{align*} C_{\\boldsymbol{p}}(x_2^{\\boldsymbol{q}}) = y_1^{\\boldsymbol{p}} + m \\cdot (x_2^{\\boldsymbol{q}} - x_1^{\\boldsymbol{p}}) \\\\ = 0.1 + 0.7 \\cdot ((\\exp(-2) + \\exp(-1)) - \\exp(-2)) \\\\ = 0.1 + 0.7 \\exp(-1) \\end{align*}\n在该点的违背量为 $[y_2^{\\boldsymbol{q}} - C_{\\boldsymbol{p}}(x_2^{\\boldsymbol{q}})]_+ = [0.4 - (0.1 + 0.7 \\exp(-1))]_+ = [0.3 - 0.7 \\exp(-1)]_+$。\n为了确定该值是否为正，我们比较 $0.3$ 和 $0.7 \\exp(-1)$。\n$0.3 = \\frac{3}{10}$ 和 $0.7 \\exp(-1) = \\frac{7}{10\\exp(1)}$。\n由于 $\\exp(1)  3$，我们有 $\\frac{1}{\\exp(1)} > \\frac{1}{3}$。\n所以，$\\frac{7}{10\\exp(1)} > \\frac{7}{30} = \\frac{2.33...}{10}$。这并不能解决问题。\n比较 $3$ 和 $7\\exp(-1)$：$7\\exp(-1) \\approx 7 \\times 0.3678 = 2.5746$。\n由于 $3 > 7\\exp(-1)$，值 $0.3 - 0.7 \\exp(-1)$ 是正的。违背量为 $0.3 - 0.7 \\exp(-1)$。\n\n最后，我们通过取两个违背量的最大值来找到 $D$：\n$$ D = \\max(0.05, 0.3 - 0.7 \\exp(-1)) $$\n我们必须比较 $0.05 = \\frac{1}{20}$ 和 $0.3 - 0.7 \\exp(-1) = \\frac{3}{10} - \\frac{7}{10\\exp(1)}$。\n考虑差值：$0.05 - (0.3 - 0.7 \\exp(-1)) = -0.25 + 0.7 \\exp(-1) = \\frac{7}{10\\exp(1)} - \\frac{1}{4}$。\n这与 $28 - 10\\exp(1) = 10(2.8 - \\exp(1))$ 具有相同的符号。\n由于 $\\exp(1) \\approx 2.71828$，值 $2.8 - \\exp(1)$ 是正的。\n因此，$0.05 - (0.3 - 0.7 \\exp(-1)) > 0$，这意味着 $0.05 > 0.3 - 0.7 \\exp(-1)$。\n\n最大的违背量是 $D = 0.05$。\n以最简分数形式表示，即为 $D = \\frac{5}{100} = \\frac{1}{20}$。",
            "answer": "$$\\boxed{\\frac{1}{20}}$$"
        },
        {
            "introduction": "将如Jarzynski恒等式这样的精确理论关系应用于实验或数值模拟的有限数据时，会面临实际的挑战。由于指数平均对罕见的极端功值（即离群值）高度敏感，在小样本情况下，对自由能差的直接估计可能极不稳定且有偏。本计算练习  旨在教授一项关键的实践技能：通过实现一种统计平滑技术（winsorization）来更稳健地估计自由能，并使用集中不等式（如Hoeffding不等式）来严格地量化估计结果的置信区间，这反映了该领域的前沿研究实践。",
            "id": "3784456",
            "problem": "一个系统初始时与一个逆温度为 $\\beta$ (单位为 $\\mathrm{J}^{-1}$) 的热库处于平衡状态，并通过一个过程被驱动离开平衡态，该过程产生一组 $n$ 个独立的功测量值 $\\{W_i\\}_{i=1}^n$，每个 $W_i$ 以焦耳 ($\\mathrm{J}$) 为单位。在小数据情况下，基于涨落关系的自由能变化 $\\Delta F$ 的朴素估计量，已知会因对稀有功值的指数加权而导致方差过大。你的任务是构建一个基于平滑的 $\\Delta F$ 估计量以减轻有限样本不稳定性，并使用集中不等式提供非渐近置信区间。\n\n基本原理。考虑 Jarzynski 等式，该等式通过非平衡功将平衡自由能差 $\\Delta F$ 联系起来：\n$$\n\\Delta F = -\\frac{1}{\\beta} \\ln \\mathbb{E}\\left[\\exp\\left(-\\beta W\\right)\\right],\n$$\n其中 $\\mathbb{E}[\\cdot]$ 表示对功分布的期望。令 $Y = \\exp(-\\beta W)$ 表示指数功变量，并令 $\\{Y_i\\}_{i=1}^n$ 为根据 $\\{W_i\\}_{i=1}^n$ 计算出的观测值。\n\n平滑方案。通过选择经验分位数的下阈值和上阈值，定义指数功变量的缩尾（加帽）版本。对于分位数水平 $\\alpha_{\\mathrm{low}}\\in[0,1)$ 和 $\\alpha_{\\mathrm{high}}\\in(0,1]$ 且满足 $\\alpha_{\\mathrm{low}} \\leq \\alpha_{\\mathrm{high}}$，计算顺序统计量索引\n$$\ni_{\\mathrm{low}} = \\max\\left\\{0, \\left\\lceil \\alpha_{\\mathrm{low}} n \\right\\rceil - 1\\right\\}, \\quad\ni_{\\mathrm{high}} = \\min\\left\\{n-1, \\left\\lceil \\alpha_{\\mathrm{high}} n \\right\\rceil - 1\\right\\},\n$$\n形成排序序列 $Y_{(0)} \\leq Y_{(1)} \\leq \\cdots \\leq Y_{(n-1)}$，并设定界限\n$$\nL = Y_{(i_{\\mathrm{low}})}, \\quad U = Y_{(i_{\\mathrm{high}})}.\n$$\n缩尾变量定义为 $Y_i' = \\min\\{\\max\\{Y_i, L\\}, U\\}$，自由能变化的平滑估计量为\n$$\n\\widehat{\\Delta F}_{\\mathrm{smooth}} = -\\frac{1}{\\beta} \\ln \\left(\\frac{1}{n} \\sum_{i=1}^n Y_i'\\right).\n$$\n原始（未平滑）的 Jarzynski 估计量为\n$$\n\\widehat{\\Delta F}_{\\mathrm{raw}} = -\\frac{1}{\\beta} \\ln \\left(\\frac{1}{n} \\sum_{i=1}^n Y_i\\right).\n$$\n\n置信区间 (CI) 量化。由于 $Y_i'$ 确定性地属于 $[L, U]$，Hoeffding 不等式意味着对于任何 $\\delta \\in (0,1)$，\n$$\n\\mathbb{P}\\left(\\left|\\frac{1}{n}\\sum_{i=1}^n Y_i' - \\mathbb{E}[Y']\\right| \\geq \\varepsilon\\right) \\leq 2 \\exp\\left(-\\frac{2 n \\varepsilon^2}{(U - L)^2}\\right),\n$$\n其中 $Y'$ 表示缩尾随机变量。因此，在置信度至少为 $1-\\delta$ 的情况下，样本均值 $m' = \\frac{1}{n}\\sum_{i=1}^n Y_i'$ 满足\n$$\n\\left| m' - \\mathbb{E}[Y'] \\right| \\leq r_{\\mathrm{H}}(\\delta) \\equiv (U - L) \\sqrt{\\frac{\\ln(2/\\delta)}{2n}}.\n$$\n通过单调变换 $f(m) = -\\beta^{-1} \\ln(m)$ 转换此置信区间，得到平滑自由能估计量的置信区间为\n$$\n\\Delta F_{\\mathrm{low}} = -\\frac{1}{\\beta} \\ln\\left(m' + r_{\\mathrm{H}}(\\delta)\\right), \\quad\n\\Delta F_{\\mathrm{high}} = -\\frac{1}{\\beta} \\ln\\left(m' - r_{\\mathrm{H}}(\\delta)\\right),\n$$\n按照约定，为确保对数函数的定义域，必要时，将任何非正参数替换为一个严格为正的数值保护值 $\\varepsilon > 0$。所有报告的自由能值必须以焦耳 ($\\mathrm{J}$) 表示。\n\n为以下测试套件实现上述平滑和置信区间构建方法。在每种情况下，计算并返回列表 $[\\widehat{\\Delta F}_{\\mathrm{raw}}, \\widehat{\\Delta F}_{\\mathrm{smooth}}, \\Delta F_{\\mathrm{low}}, \\Delta F_{\\mathrm{high}}]$。\n\n测试套件：\n- 案例 A (理想情况，中等 $n$)：$\\beta = 2.414 \\times 10^{20}\\ \\mathrm{J}^{-1}$，$\\delta = 0.10$，$\\alpha_{\\mathrm{low}} = 0.05$，$\\alpha_{\\mathrm{high}} = 0.95$，以及 $n=20$ 个功值，由下式给出\n$$\nW_k = 3.0 \\times 10^{-21} + 0.8 \\times 10^{-21} \\sin\\left(\\frac{2\\pi k}{20}\\right) + 0.2 \\times 10^{-21} \\cos\\left(\\frac{2\\pi k}{5}\\right), \\quad k=1,2,\\ldots,20.\n$$\n- 案例 B (带有离群值的重尾边界情况)：$\\beta = 2.414 \\times 10^{20}\\ \\mathrm{J}^{-1}$，$\\delta = 0.05$，$\\alpha_{\\mathrm{low}} = 0.10$，$\\alpha_{\\mathrm{high}} = 0.90$，以及 $n=10$ 个功值，由下式给出\n$$\nW_k = 2.5 \\times 10^{-21} + 1.2 \\times 10^{-21} \\sin\\left(\\frac{2\\pi k}{9}\\right), \\quad k=1,2,\\ldots,9,\n$$\n以及一个额外的离群值 $W_{10} = -3.5 \\times 10^{-20}$。\n- 案例 C (小 $n$ 且有上界截断的边界情况)：$\\beta = 2.414 \\times 10^{20}\\ \\mathrm{J}^{-1}$，$\\delta = 0.20$，$\\alpha_{\\mathrm{low}} = 0.00$，$\\alpha_{\\mathrm{high}} = 0.66$，以及 $n=3$ 个功值\n$$\nW_1 = 4.0 \\times 10^{-21}, \\quad W_2 = 3.2 \\times 10^{-21}, \\quad W_3 = -2.0 \\times 10^{-20}.\n$$\n\n输出规范。你的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果，其中每个测试案例的结果本身是一个由方括号括起来的、包含四个以焦耳为单位的浮点数的逗号分隔列表。例如，输出应具有以下形式\n$$\n\\text{[[df\\_raw\\_A,df\\_smooth\\_A,ci\\_low\\_A,ci\\_high\\_A],[df\\_raw\\_B,df\\_smooth\\_B,ci\\_low\\_B,ci\\_high\\_B],[df\\_raw\\_C,df\\_smooth\\_C,ci\\_low\\_C,ci\\_high\\_C]]}.\n$$\n所有自由能值必须以焦耳 ($\\mathrm{J}$) 表示。角度（如有）必须以弧度为单位。百分比必须以小数形式表示。不得打印任何其他文本。",
            "solution": "问题陈述经评估有效。其科学基础在于非平衡统计力学原理，特别是 Jarzynski 等式，并且解决了一个在其际应用中明确且相关的问题：从有限数据中稳健地估计自由能差异。其表述在数学上是精确的、自洽的，并且在算法上是可行的。\n\n解决方案的开发首先要建立理论和统计原理，然后构建一个实现这些原理的算法。\n\n### 理论框架\n\n问题的核心在于 Jarzynski 等式，这是单次热力学和涨落关系中的一个基本结果，它将两个状态之间的平衡自由能差 $\\Delta F$ 与在非平衡过程中对系统所做的功 $W$ 联系起来：\n$$\ne^{-\\beta \\Delta F} = \\mathbb{E}\\left[e^{-\\beta W}\\right]\n$$\n其中 $\\beta = (k_B T)^{-1}$ 是初始平衡热库的逆温度，$\\mathbb{E}[\\cdot]$ 表示对功过程所有可能实现的期望。因此，自由能差由下式给出\n$$\n\\Delta F = -\\frac{1}{\\beta} \\ln \\mathbb{E}\\left[e^{-\\beta W}\\right].\n$$\n在实践中，期望值是通过 $n$ 个独立功测量值的有限样本 $\\{W_i\\}_{i=1}^n$ 来估计的。通过用样本均值代替期望，可以得到 $\\Delta F$ 的一个朴素或“原始”估计量：\n$$\n\\widehat{\\Delta F}_{\\mathrm{raw}} = -\\frac{1}{\\beta} \\ln \\left(\\frac{1}{n} \\sum_{i=1}^n e^{-\\beta W_i}\\right).\n$$\n已知对于有限的 $n$，该估计量是有偏的（由于 Jensen 不等式），并且可能具有高方差，特别是当功分布在低功值一侧有重尾时。单个非常小（或负）的 $W_i$ 值可以产生一个指数级大的 $e^{-\\beta W_i}$ 值，从而主导求和并使估计不稳定。\n\n### 通过缩尾实现的稳健估计\n\n为减轻这种有限样本不稳定性，问题提出了一种基于缩尾（winsorization）的平滑程序。这种统计技术通过对极端数据点进行封顶来减少离群值的影响。令 $Y = e^{-\\beta W}$ 为指数功变量，$\\{Y_i\\}_{i=1}^n$ 为相应的样本。步骤如下：\n\n1.  将样本 $\\{Y_i\\}$ 按非递减顺序排序，以获得顺序统计量 $Y_{(0)} \\leq Y_{(1)} \\leq \\cdots \\leq Y_{(n-1)}$。\n2.  选择下分位数和上分位数阈值 $\\alpha_{\\mathrm{low}}$ 和 $\\alpha_{\\mathrm{high}}$ 来定义封顶的范围。这些水平被映射到排序数组中的索引：\n    $$\n    i_{\\mathrm{low}} = \\max\\left\\{0, \\lceil \\alpha_{\\mathrm{low}} n \\rceil - 1\\right\\}, \\quad\n    i_{\\mathrm{high}} = \\min\\left\\{n-1, \\lceil \\alpha_{\\mathrm{high}} n \\rceil - 1\\right\\}.\n    $$\n    这些索引必须是整数。向上取整函数 $\\lceil \\cdot \\rceil$ 确保了例如第 $95$ 百分位数对应的索引至少包含 $95\\%$ 的数据。\n3.  位于这些索引处的值 $L = Y_{(i_{\\mathrm{low}})}$ 和 $U = Y_{(i_{\\mathrm{high}})}$ 被用作缩尾的下界和上界。\n4.  通过对原始值进行封顶来创建一个新的、缩尾（或“平滑”）的样本 $\\{Y_i'\\}_{i=1}^n$：$Y_i' = \\min\\{\\max\\{Y_i, L\\}, U\\}$。这实际上将所有低于 $L$ 的值替换为 $L$，所有高于 $U$ 的值替换为 $U$。\n5.  然后使用缩尾样本的均值计算自由能差的平滑估计量：\n    $$\n    \\widehat{\\Delta F}_{\\mathrm{smooth}} = -\\frac{1}{\\beta} \\ln \\left(\\frac{1}{n} \\sum_{i=1}^n Y_i'\\right).\n    $$\n\n### 通过 Hoeffding 不等式构建非渐近置信区间\n\n根据构造，缩尾变量 $Y_i'$ 被限定在区间 $[L, U]$ 内。这种有界性是一个关键属性，它允许应用 Hoeffding 不等式来为潜在的缩尾分布的均值 $\\mathbb{E}[Y']$ 构建一个非渐近置信区间。Hoeffding 不等式指出，对于 $n$ 个在 $[a_i, b_i]$ 内有界的独立随机变量 $X_i$，它们的和 $S_n = \\sum X_i$ 满足：\n$$\n\\mathbb{P}\\left( |S_n - \\mathbb{E}[S_n]| \\geq t \\right) \\leq 2 \\exp\\left( - \\frac{2t^2}{\\sum (b_i-a_i)^2} \\right).\n$$\n在我们的案例中，变量是 $Y_i'$，它们是独立同分布的，并且都在 $[L, U]$ 内有界。令 $m' = \\frac{1}{n} \\sum Y_i'$ 为样本均值，不等式简化为：\n$$\n\\mathbb{P}\\left(\\left|m' - \\mathbb{E}[Y']\\right| \\geq \\varepsilon\\right) \\leq 2 \\exp\\left(-\\frac{2 n \\varepsilon^2}{(U - L)^2}\\right).\n$$\n为了构建置信水平为 $1-\\delta$ 的置信区间，我们将右侧设为 $\\delta$ 并求解偏差 $\\varepsilon$。这给出了均值置信区间的半径：\n$$\nr_{\\mathrm{H}}(\\delta) = (U - L) \\sqrt{\\frac{\\ln(2/\\delta)}{2n}}.\n$$\n因此，以至少 $1-\\delta$ 的概率，我们有 $\\mathbb{E}[Y'] \\in [m' - r_{\\mathrm{H}}(\\delta), m' + r_{\\mathrm{H}}(\\delta)]$。\n\n这个关于指数功均值的置信区间可以转换为自由能的置信区间。由于函数 $f(x) = - (1/\\beta) \\ln(x)$ 是单调递减的，区间的界限就是将该函数应用于均值区间端点得到的值，但顺序相反：\n$$\n\\Delta F_{\\mathrm{low}} = f(m' + r_{\\mathrm{H}}(\\delta)) = -\\frac{1}{\\beta} \\ln\\left(m' + r_{\\mathrm{H}}(\\delta)\\right)\n$$\n$$\n\\Delta F_{\\mathrm{high}} = f(m' - r_{\\mathrm{H}}(\\delta)) = -\\frac{1}{\\beta} \\ln\\left(m' - r_{\\mathrm{H}}(\\delta)\\right)\n$$\n在计算 $\\Delta F_{\\mathrm{high}}$ 时，需要一个数值保护措施。如果参数 $m' - r_{\\mathrm{H}}(\\delta)$ 为非正数，必须用一个小的正数替换它，以防止对数函数出现定义域错误。一个标准的选择是机器精度值。\n\n### 算法实现\n\n每个测试案例的完整计算流程如下：\n1.  给定参数 $\\beta$、$\\delta$、$\\alpha_{\\mathrm{low}}$、$\\alpha_{\\mathrm{high}}$ 以及 $n$ 个功测量值集合 $\\{W_i\\}$。\n2.  计算指数功值 $Y_i = \\exp(-\\beta W_i)$。\n3.  计算原始估计量：$\\widehat{\\Delta F}_{\\mathrm{raw}} = -\\frac{1}{\\beta} \\ln(\\text{mean}(\\{Y_i\\}))$。\n4.  对 $\\{Y_i\\}$ 进行排序以获得顺序统计量 $\\{Y_{(j)}\\}$。\n5.  使用提供的公式确定缩尾索引 $i_{\\mathrm{low}}$ 和 $i_{\\mathrm{high}}$，并确保它们是整数值。\n6.  提取缩尾界限 $L = Y_{(i_{\\mathrm{low}})}$ 和 $U = Y_{(i_{\\mathrm{high}})}$。\n7.  通过将原始样本 $\\{Y_i\\}$ 截断到范围 $[L, U]$ 内，计算缩尾样本 $\\{Y_i'\\}$。\n8.  计算缩尾样本的均值 $m' = \\text{mean}(\\{Y_i'\\})$。\n9.  计算平滑估计量：$\\widehat{\\Delta F}_{\\mathrm{smooth}} = -\\frac{1}{\\beta} \\ln(m')$。\n10. 计算 Hoeffding 半径 $r_{\\mathrm{H}}(\\delta) = (U-L) \\sqrt{\\ln(2/\\delta)/(2n)}$。\n11. 计算 $\\Delta F$ 的置信区间界限：\n    - $\\Delta F_{\\mathrm{low}} = -\\frac{1}{\\beta} \\ln(m' + r_{\\mathrm{H}}(\\delta))$。\n    - $\\Delta F_{\\mathrm{high}} = -\\frac{1}{\\beta} \\ln(\\max(\\varepsilon_{\\text{safe}}, m' - r_{\\mathrm{H}}(\\delta)))$，其中 $\\varepsilon_{\\text{safe}}$ 是一个小的正常数（例如 `numpy.finfo(float).eps`）。\n12. 组合并返回四个计算值：$[\\widehat{\\Delta F}_{\\mathrm{raw}}, \\widehat{\\Delta F}_{\\mathrm{smooth}}, \\Delta F_{\\mathrm{low}}, \\Delta F_{\\mathrm{high}}]$。\n\n将此算法应用于问题陈述中指定的三个测试案例中的每一个。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating raw and smoothed free energy estimators\n    and confidence intervals for three test cases.\n    \"\"\"\n\n    # Numerical safeguard for logarithm argument\n    LOG_SAFEGUARD = np.finfo(float).eps\n\n    def calculate_df_estimates(beta, delta, alpha_low, alpha_high, W):\n        \"\"\"\n        Calculates the raw estimator, smoothed estimator, and confidence interval\n        for the free energy change from a set of work values.\n\n        Args:\n            beta (float): Inverse temperature in J^-1.\n            delta (float): Confidence level parameter (1-delta is the confidence).\n            alpha_low (float): Lower quantile for winsorization.\n            alpha_high (float): Upper quantile for winsorization.\n            W (np.ndarray): Array of work measurements in J.\n\n        Returns:\n            list: A list containing [dF_raw, dF_smooth, dF_low, dF_high].\n        \"\"\"\n        n = len(W)\n        \n        # Calculate exponential work values\n        Y = np.exp(-beta * W)\n\n        # 1. Raw Jarzynski estimator\n        m_raw = np.mean(Y)\n        dF_raw = -1/beta * np.log(m_raw)\n\n        # 2. Smoothing-based (winsorized) estimator\n        Y_sorted = np.sort(Y)\n        \n        # Calculate order-statistic indices\n        # Note: np.ceil returns a float, which needs to be cast to int for indexing.\n        i_low = int(max(0, np.ceil(alpha_low * n) - 1))\n        i_high = int(min(n - 1, np.ceil(alpha_high * n) - 1))\n        \n        # Determine winsorization bounds\n        L = Y_sorted[i_low]\n        U = Y_sorted[i_high]\n        \n        # Create winsorized sample\n        Y_prime = np.clip(Y, L, U)\n        \n        # Calculate mean of winsorized sample\n        m_prime = np.mean(Y_prime)\n        \n        # Calculate smoothed estimator\n        dF_smooth = -1/beta * np.log(m_prime)\n        \n        # 3. Confidence Interval quantification\n        # Hoeffding's inequality radius for the mean\n        r_H = (U - L) * np.sqrt(np.log(2 / delta) / (2 * n))\n        \n        # Lower bound of the confidence interval for dF\n        arg_low = m_prime + r_H\n        dF_low = -1/beta * np.log(arg_low)\n        \n        # Upper bound of the confidence interval for dF\n        arg_high = m_prime - r_H\n        # Apply numerical safeguard if argument is non-positive\n        dF_high = -1/beta * np.log(max(LOG_SAFEGUARD, arg_high))\n        \n        return [dF_raw, dF_smooth, dF_low, dF_high]\n\n    # Test Suite Definition\n    test_cases = []\n\n    # Case A\n    beta_A = 2.414e20\n    delta_A = 0.10\n    alpha_low_A = 0.05\n    alpha_high_A = 0.95\n    n_A = 20\n    k_A = np.arange(1, n_A + 1)\n    W_A = 3.0e-21 + 0.8e-21 * np.sin(2 * np.pi * k_A / 20) + 0.2e-21 * np.cos(2 * np.pi * k_A / 5)\n    test_cases.append((beta_A, delta_A, alpha_low_A, alpha_high_A, W_A))\n\n    # Case B\n    beta_B = 2.414e20\n    delta_B = 0.05\n    alpha_low_B = 0.10\n    alpha_high_B = 0.90\n    n_B = 10\n    k_B = np.arange(1, n_B)\n    W_B_main = 2.5e-21 + 1.2e-21 * np.sin(2 * np.pi * k_B / 9)\n    W_B_outlier = np.array([-3.5e-20])\n    W_B = np.concatenate((W_B_main, W_B_outlier))\n    test_cases.append((beta_B, delta_B, alpha_low_B, alpha_high_B, W_B))\n\n    # Case C\n    beta_C = 2.414e20\n    delta_C = 0.20\n    alpha_low_C = 0.00\n    alpha_high_C = 0.66\n    W_C = np.array([4.0e-21, 3.2e-21, -2.0e-20])\n    test_cases.append((beta_C, delta_C, alpha_low_C, alpha_high_C, W_C))\n\n    # Process all test cases\n    results = []\n    for case in test_cases:\n        beta, delta, alpha_low, alpha_high, W = case\n        case_results = calculate_df_estimates(beta, delta, alpha_low, alpha_high, W)\n        results.append(case_results)\n\n    # Format output as specified\n    formatted_results = [f\"[{','.join(map(lambda x: f'{x:.6e}', res))}]\" for res in results]\n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}