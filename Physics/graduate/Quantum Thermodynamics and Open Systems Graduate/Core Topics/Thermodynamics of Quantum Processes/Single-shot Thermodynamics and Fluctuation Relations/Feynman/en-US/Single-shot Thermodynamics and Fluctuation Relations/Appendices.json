{
    "hands_on_practices": [
        {
            "introduction": "The concept of work in quantum mechanics is defined operationally through the Two-Point Measurement (TPM) scheme. This practice will solidify your understanding of this fundamental protocol by applying it to a driven qubit, a canonical model system in quantum thermodynamics. You will explore the crucial distinction between \"inclusive\" and \"exclusive\" work definitions, which arise from different choices of the Hamiltonian used for the final energy measurement, and see how this choice affects the resulting fluctuation relations .",
            "id": "3784493",
            "problem": "Consider a driven qubit with time-dependent Hamiltonian $H(t)=\\frac{\\omega}{2}\\sigma_{z}+\\lambda(t)\\sigma_{x}$, where $\\sigma_{x}$ and $\\sigma_{z}$ are Pauli operators and $\\omega0$. The system is initially prepared in the Gibbs state at inverse temperature $\\beta0$ with respect to the bare Hamiltonian $H(0)=\\frac{\\omega}{2}\\sigma_{z}$, i.e. $\\rho_{0}=\\exp(-\\beta H(0))/Z_{0}$ with $Z_{0}=\\operatorname{Tr}[\\exp(-\\beta H(0))]$. At time $t=0^{+}$, the classical field is suddenly quenched to a constant value $\\lambda(t)=\\lambda$ for $t\\in[0,\\tau]$, with $\\tau\\to 0^{+}$ so that the unitary propagator during the protocol is effectively the identity, $U(\\tau)\\approx \\mathbb{I}$. The final Hamiltonian is $H(\\tau)=\\frac{\\omega}{2}\\sigma_{z}+\\lambda\\,\\sigma_{x}$. \n\nUnder the Two-Point Measurement (TPM) scheme, define the exclusive work as the energy difference with respect to the bare Hamiltonian $H_{0}=\\frac{\\omega}{2}\\sigma_{z}$ measured at the beginning and at the end of the protocol, and the inclusive work as the energy difference between $H(0)$ and $H(\\tau)$ measured at the beginning and the end, respectively. Starting from first principles of unitary quantum mechanics, the definition of the TPM scheme, and the Gibbs ensemble, perform the following:\n\n- Diagonalize $H(0)$ and $H(\\tau)$, and determine the eigenvalues and eigenstates of both.\n- Compute the exclusive TPM work distribution $P_{\\mathrm{excl}}(W)$ for the sudden-quench protocol described.\n- Compute the inclusive TPM work distribution $P_{\\mathrm{incl}}(W)$ for the same protocol.\n- Using these distributions, derive the fluctuation averages $\\langle \\exp(-\\beta W_{\\mathrm{excl}})\\rangle$ and $\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle$.\n\nYour final task is to provide, in closed form, the single analytical expression for the difference\n$$\\Delta(\\beta,\\omega,\\lambda)\\equiv \\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle-\\langle \\exp(-\\beta W_{\\mathrm{excl}})\\rangle,$$\nsimplified as far as possible in terms of $\\beta$, $\\omega$, and $\\lambda$. The final answer must be a single closed-form analytic expression. No rounding is required; do not include units in the final expression.",
            "solution": "The problem asks for the difference between the characteristic function of inclusive work and exclusive work for a sudden quantum quench protocol. We first validate the problem, then proceed with the derivation.\n\n### Problem Validation\n**Step 1: Extract Givens**\n-   System Hamiltonian: $H(t)=\\frac{\\omega}{2}\\sigma_{z}+\\lambda(t)\\sigma_{x}$, with $\\omega0$.\n-   Initial state: Gibbs state $\\rho_{0}=\\exp(-\\beta H(0))/Z_{0}$ at inverse temperature $\\beta0$.\n-   Initial Hamiltonian: $H(0)=\\frac{\\omega}{2}\\sigma_{z}$.\n-   Protocol: At $t=0^{+}$, a sudden quench to $\\lambda(t)=\\lambda$ for $t\\in[0,\\tau]$.\n-   Protocol duration: $\\tau\\to 0^{+}$.\n-   Unitary propagator: $U(\\tau)\\approx \\mathbb{I}$.\n-   Final Hamiltonian: $H(\\tau)=\\frac{\\omega}{2}\\sigma_{z}+\\lambda\\,\\sigma_{x}$.\n-   Exclusive work, $W_{\\mathrm{excl}}$: Energy difference with respect to the bare Hamiltonian $H_{0}=\\frac{\\omega}{2}\\sigma_{z}$ measured at $t=0$ and $t=\\tau$.\n-   Inclusive work, $W_{\\mathrm{incl}}$: Energy difference between $H(0)$ and $H(\\tau)$ measured at $t=0$ and $t=\\tau$, respectively.\n-   Tasks: Diagonalize $H(0)$ and $H(\\tau)$; compute work distributions $P_{\\mathrm{excl}}(W)$ and $P_{\\mathrm{incl}}(W)$; compute fluctuation averages $\\langle \\exp(-\\beta W_{\\mathrm{excl}})\\rangle$ and $\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle$; find the difference $\\Delta(\\beta,\\omega,\\lambda) = \\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle-\\langle \\exp(-\\beta W_{\\mathrm{excl}})\\rangle$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded in the fields of quantum mechanics and quantum thermodynamics. It utilizes standard concepts such as Pauli matrices, Hamiltonians, Gibbs states, the Two-Point Measurement (TPM) scheme, and quantum quenches. The problem is well-posed: the initial state, the dynamics (a sudden quench implying $U\\approx\\mathbb{I}$), and the observables for measurement are all explicitly defined. The definitions of \"exclusive\" and \"inclusive\" work, though specific to this context, are clearly stated and unambiguous, allowing for a unique solution. The problem is objective and free from factual errors, pseudoscience, or vagueness. It is a formalizable theoretical physics problem directly relevant to the topic of single-shot thermodynamics and fluctuation relations. The setup is self-contained and consistent.\n\n**Step 3: Verdict and Action**\nThe problem is valid. We proceed to the solution.\n\n###\n**1. Hamiltonians, Eigenvalues, and Eigenstates**\n\nThe initial Hamiltonian at $t=0$ is $H(0) = \\frac{\\omega}{2}\\sigma_{z}$. Since $\\sigma_z = \\begin{pmatrix} 1  0 \\\\ 0  -1 \\end{pmatrix}$, $H(0)$ is already diagonal in the standard basis.\n$$H(0) = \\begin{pmatrix} \\frac{\\omega}{2}  0 \\\\ 0  -\\frac{\\omega}{2} \\end{pmatrix}$$\nThe eigenvalues are $E_0^{(0)} = \\frac{\\omega}{2}$ and $E_1^{(0)} = -\\frac{\\omega}{2}$. The corresponding eigenstates are the standard basis vectors $|0\\rangle = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$ and $|1\\rangle = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$.\n\nThe final Hamiltonian at $t=\\tau$ is $H(\\tau) = \\frac{\\omega}{2}\\sigma_z + \\lambda\\sigma_x$.\n$$H(\\tau) = \\begin{pmatrix} \\frac{\\omega}{2}  \\lambda \\\\ \\lambda  -\\frac{\\omega}{2} \\end{pmatrix}$$\nTo find the eigenvalues $E'$, we solve the characteristic equation $\\det(H(\\tau) - E'\\mathbb{I}) = 0$:\n$$(\\frac{\\omega}{2}-E')(-\\frac{\\omega}{2}-E') - \\lambda^2 = 0 \\implies E'^2 - \\frac{\\omega^2}{4} - \\lambda^2 = 0$$\n$$E' = \\pm\\sqrt{\\frac{\\omega^2}{4}+\\lambda^2} = \\pm\\frac{1}{2}\\sqrt{\\omega^2+4\\lambda^2}$$\nLet us define $\\Omega = \\sqrt{\\omega^2+4\\lambda^2}$. The eigenvalues of $H(\\tau)$ are $E_0^{(\\tau)} = \\frac{\\Omega}{2}$ and $E_1^{(\\tau)} = -\\frac{\\Omega}{2}$.\n\n###\n**2. Initial State and Partition Functions**\n\nThe system is initially in a Gibbs state with respect to $H(0)$: $\\rho_0 = \\exp(-\\beta H(0))/Z_0$.\nThe initial partition function is:\n$$Z_0 = \\operatorname{Tr}[\\exp(-\\beta H(0))] = \\exp(-\\beta E_0^{(0)}) + \\exp(-\\beta E_1^{(0)}) = \\exp\\left(-\\frac{\\beta\\omega}{2}\\right) + \\exp\\left(\\frac{\\beta\\omega}{2}\\right) = 2\\cosh\\left(\\frac{\\beta\\omega}{2}\\right)$$\nThe probabilities of measuring the initial energies $E_0^{(0)}$ and $E_1^{(0)}$ are:\n$p_0 = \\langle 0|\\rho_0|0\\rangle = \\frac{1}{Z_0}\\exp(-\\beta E_0^{(0)}) = \\frac{1}{Z_0}\\exp(-\\frac{\\beta\\omega}{2})$\n$p_1 = \\langle 1|\\rho_0|1\\rangle = \\frac{1}{Z_0}\\exp(-\\beta E_1^{(0)}) = \\frac{1}{Z_0}\\exp(\\frac{\\beta\\omega}{2})$\n\n###\n**3. Exclusive Work**\n\nThe exclusive work $W_{\\mathrm{excl}}$ is defined by a TPM scheme where the energy is measured with respect to $H_0 = H(0)$ at both $t=0$ and $t=\\tau$. The work is the difference in the measured energy eigenvalues.\n1.  At $t=0$, a projective measurement of $H_0$ is performed. The outcome is $E_n^{(0)}$ (with $n \\in \\{0,1\\}$) with probability $p_n$. The system state collapses to the corresponding eigenstate $|n\\rangle$.\n2.  The system evolves under the unitary operator $U(\\tau)$. For a sudden quench, $\\tau \\to 0^{+}$, so $U(\\tau) \\approx \\mathbb{I}$. The state of the system remains $|n\\rangle$.\n3.  At $t=\\tau$, a projective measurement of $H_0$ is performed on the state $|n\\rangle$. The probability of obtaining the outcome $E_m^{(0)}$ is $|\\langle m|U(\\tau)|n\\rangle|^2 \\approx |\\langle m|n\\rangle|^2 = \\delta_{mn}$.\n\nThis means that if the initial measurement yielded $E_n^{(0)}$, the final measurement will also yield $E_n^{(0)}$ with probability $1$. The work done is $W_{\\mathrm{excl}} = E_n^{(0)} - E_n^{(0)} = 0$. This is the only possible outcome. The work distribution is therefore a Dirac delta function centered at zero:\n$$P_{\\mathrm{excl}}(W) = \\delta(W)$$\nThe corresponding fluctuation average is:\n$$\\langle \\exp(-\\beta W_{\\mathrm{excl}})\\rangle = \\int_{-\\infty}^{\\infty} dW P_{\\mathrm{excl}}(W) \\exp(-\\beta W) = \\int_{-\\infty}^{\\infty} dW \\delta(W) \\exp(-\\beta W) = \\exp(0) = 1$$\n\n###\n**4. Inclusive Work**\n\nThe inclusive work $W_{\\mathrm{incl}}$ is defined by a TPM scheme where the energy is measured with respect to $H(0)$ at $t=0$ and $H(\\tau)$ at $t=\\tau$.\n1.  The first measurement is the same as for the exclusive case.\n2.  The system state after the initial measurement and evolution is $|n\\rangle$.\n3.  At $t=\\tau$, a projective measurement of $H(\\tau)$ is performed. The possible outcomes are its eigenvalues $E_m^{(\\tau)}$ (with $m \\in \\{0,1\\}$). The probability of obtaining $E_m^{(\\tau)}$ given the initial state $|n\\rangle$ is $|\\langle m'|U(\\tau)|n\\rangle|^2 \\approx |\\langle m'|n\\rangle|^2$, where $|m'\\rangle$ are the eigenstates of $H(\\tau)$.\n\nThe work is $W = E_m^{(\\tau)} - E_n^{(0)}$. The characteristic function of work is given by:\n$$\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle = \\sum_{n,m=0,1} p_n |\\langle m'|U(\\tau)|n\\rangle|^2 \\exp(-\\beta(E_m^{(\\tau)} - E_n^{(0)}))$$\nSubstituting $p_n = \\exp(-\\beta E_n^{(0)})/Z_0$ and $U(\\tau) \\approx \\mathbb{I}$:\n$$\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle = \\sum_{n,m} \\frac{\\exp(-\\beta E_n^{(0)})}{Z_0} |\\langle m'|n\\rangle|^2 \\exp(-\\beta E_m^{(\\tau)}) \\exp(\\beta E_n^{(0)})$$\n$$\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle = \\frac{1}{Z_0} \\sum_{n,m} |\\langle m'|n\\rangle|^2 \\exp(-\\beta E_m^{(\\tau)})$$\nWe can sum over $n$ first. Using the completeness of the basis $\\{|n\\rangle\\}$, $\\sum_n |n\\rangle\\langle n| = \\mathbb{I}$:\n$$\\sum_n |\\langle m'|n\\rangle|^2 = \\sum_n \\langle m'|n\\rangle\\langle n|m'\\rangle = \\langle m'| \\left(\\sum_n |n\\rangle\\langle n|\\right) |m'\\rangle = \\langle m'|\\mathbb{I}|m'\\rangle = 1$$\nThus, the expression simplifies to:\n$$\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle = \\frac{1}{Z_0} \\sum_m \\exp(-\\beta E_m^{(\\tau)})$$\nThe sum is the partition function $Z_\\tau$ associated with the final Hamiltonian $H(\\tau)$ at the same inverse temperature $\\beta$:\n$$Z_\\tau = \\operatorname{Tr}[\\exp(-\\beta H(\\tau))] = \\exp(-\\beta E_0^{(\\tau)}) + \\exp(-\\beta E_1^{(\\tau)}) = \\exp\\left(-\\frac{\\beta\\Omega}{2}\\right) + \\exp\\left(\\frac{\\beta\\Omega}{2}\\right) = 2\\cosh\\left(\\frac{\\beta\\Omega}{2}\\right)$$\nThis yields the well-known Jarzynski-type relation for a quantum quench:\n$$\\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle = \\frac{Z_\\tau}{Z_0} = \\frac{2\\cosh(\\frac{\\beta\\Omega}{2})}{2\\cosh(\\frac{\\beta\\omega}{2})} = \\frac{\\cosh(\\frac{\\beta}{2}\\sqrt{\\omega^2+4\\lambda^2})}{\\cosh(\\frac{\\beta\\omega}{2})}$$\n\n###\n**5. Final Difference Calculation**\n\nThe required quantity is $\\Delta(\\beta,\\omega,\\lambda) = \\langle \\exp(-\\beta W_{\\mathrm{incl}})\\rangle - \\langle \\exp(-\\beta W_{\\mathrm{excl}})\\rangle$.\nSubstituting the results from the previous sections:\n$$\\Delta(\\beta,\\omega,\\lambda) = \\frac{\\cosh\\left(\\frac{\\beta}{2}\\sqrt{\\omega^2+4\\lambda^2}\\right)}{\\cosh\\left(\\frac{\\beta\\omega}{2}\\right)} - 1$$\nThis expression can be combined into a single fraction:\n$$\\Delta(\\beta,\\omega,\\lambda) = \\frac{\\cosh\\left(\\frac{\\beta}{2}\\sqrt{\\omega^2+4\\lambda^2}\\right) - \\cosh\\left(\\frac{\\beta\\omega}{2}\\right)}{\\cosh\\left(\\frac{\\beta\\omega}{2}\\right)}$$\nThis is the final simplified analytical expression for the difference.",
            "answer": "$$\n\\boxed{\\frac{\\cosh\\left(\\frac{\\beta}{2}\\sqrt{\\omega^2+4\\lambda^2}\\right)}{\\cosh\\left(\\frac{\\beta\\omega}{2}\\right)} - 1}\n$$"
        },
        {
            "introduction": "Beyond average energy and entropy, single-shot thermodynamics provides a precise criterion for state convertibility known as thermo-majorization. This powerful condition can be visualized by comparing thermo-majorization curves, which encode the relationship between a state's population distribution and its energy spectrum. This exercise challenges you to translate this geometric picture into a minimal set of algebraic inequalities, providing a practical tool for determining whether a given state transformation is possible under thermal operations .",
            "id": "3784440",
            "problem": "Consider a finite-dimensional quantum system with Hamiltonian $H = \\sum_{i=1}^{d} E_{i} \\, |i\\rangle\\langle i|$ in contact with a heat bath at inverse temperature $\\beta$. In the resource theory of Thermal Operations (TO), a necessary and sufficient single-shot convertibility criterion between two diagonal states $\\boldsymbol{p} = (p_{1},\\dots,p_{d})$ and $\\boldsymbol{q} = (q_{1},\\dots,q_{d})$ is encoded by the thermo-majorization preorder, which is defined using the $\\beta$-order and Gibbs weights. Starting from the definitions of the Gibbs weights $g_{i} \\propto \\exp(-\\beta E_{i})$ and the $\\beta$-order induced by sorting the components of a distribution $\\boldsymbol{r}$ according to decreasing values of $r_{i} \\exp(\\beta E_{i})$, construct a minimal set of $\\beta$-ordered linear inequalities whose satisfaction is equivalent to thermo-majorization convertibility from $\\boldsymbol{p}$ to $\\boldsymbol{q}$. Your construction should be derived from first principles of the thermo-majorization curve and should rely on verifying the dominance of the curve of $\\boldsymbol{p}$ over that of $\\boldsymbol{q}$ only at a minimal set of abscissae determined by the $\\beta$-order of $\\boldsymbol{q}$.\n\nThen verify your inequalities on the following three-level example. Let $d=3$, let energies be $E_{1}=0$, $E_{2}=1$, $E_{3}=2$ measured in units of $k_{B}T$ so that $\\beta=1$ is dimensionless, and let\n$$\n\\boldsymbol{p} = (0.7,\\,0.2,\\,0.1),\\qquad \\boldsymbol{q} = (0.6,\\,0.25,\\,0.15).\n$$\nUsing the $\\beta$-order induced by $\\boldsymbol{q}$, evaluate your minimal set of inequalities. Define the thermo-majorization curve $C_{\\boldsymbol{p}}(x)$ for the state $\\boldsymbol{p}$ via the $\\beta$-order of $\\boldsymbol{p}$, and let $x_{k}^{\\boldsymbol{q}}$ denote the breakpoint abscissae generated by the $\\beta$-order of $\\boldsymbol{q}$, with $y_{k}^{\\boldsymbol{q}}$ the corresponding cumulative ordinates. Compute the magnitude $D$ of the largest violation of thermo-majorization by $\\boldsymbol{p}$ with respect to $\\boldsymbol{q}$ over this minimal set,\n$$\nD := \\max_{k \\in \\{1,2\\}} \\left[\\, y_{k}^{\\boldsymbol{q}} - C_{\\boldsymbol{p}}\\!\\left(x_{k}^{\\boldsymbol{q}}\\right) \\,\\right]_{+},\n$$\nwhere $[x]_{+} := \\max\\{x,0\\}$. Express the final numerical value of $D$ as a fraction in simplest form. No rounding is required. The quantity $D$ is dimensionless.",
            "solution": "The problem is well-posed and scientifically sound, situated within the standard framework of single-shot quantum thermodynamics and resource theories. It is complete, consistent, and requires a standard derivation and calculation. Thus, we proceed with the solution.\n\n### Part 1: Derivation of the Minimal Set of Inequalities\n\nThe condition for the single-shot state conversion $\\boldsymbol{p} \\to \\boldsymbol{q}$ under Thermal Operations (TO) for states diagonal in the energy basis is given by the thermo-majorization relation, denoted $\\boldsymbol{p} \\succ_{\\text{th}} \\boldsymbol{q}$. This relation can be expressed geometrically using thermo-majorization curves.\n\nLet the system have a Hamiltonian $H = \\sum_{i=1}^{d} E_{i} |i\\rangle\\langle i|$ and be in contact with a heat bath at inverse temperature $\\beta$. A diagonal state is given by a probability distribution $\\boldsymbol{r} = (r_1, \\dots, r_d)$.\n\nFirst, we define the $\\beta$-order for a distribution $\\boldsymbol{r}$. This is determined by the permutation $\\pi_{\\boldsymbol{r}}$ of the indices $\\{1, \\dots, d\\}$ that sorts the quantities $r_i \\exp(\\beta E_i)$ in non-increasing order:\n$$\nr_{\\pi_{\\boldsymbol{r}}(1)} \\exp(\\beta E_{\\pi_{\\boldsymbol{r}}(1)}) \\ge r_{\\pi_{\\boldsymbol{r}}(2)} \\exp(\\beta E_{\\pi_{\\boldsymbol{r}}(2)}) \\ge \\dots \\ge r_{\\pi_{\\boldsymbol{r}}(d)} \\exp(\\beta E_{\\pi_{\\boldsymbol{r}}(d)})\n$$\n\nThe thermo-majorization curve, $C_{\\boldsymbol{r}}(x)$, for a state $\\boldsymbol{r}$ is a piecewise linear function on the interval $[0, Z_{\\beta}]$, where $Z_{\\beta} = \\sum_{i=1}^d \\exp(-\\beta E_i)$. The curve is constructed by connecting the points $(x_k^{\\boldsymbol{r}}, y_k^{\\boldsymbol{r}})$ for $k=0, 1, \\dots, d$. These points, called breakpoints, are defined as follows:\n-   $(x_0^{\\boldsymbol{r}}, y_0^{\\boldsymbol{r}}) = (0, 0)$\n-   For $k=1, \\dots, d$:\n    $$ x_k^{\\boldsymbol{r}} = \\sum_{j=1}^k \\exp(-\\beta E_{\\pi_{\\boldsymbol{r}}(j)}) $$\n    $$ y_k^{\\boldsymbol{r}} = \\sum_{j=1}^k r_{\\pi_{\\boldsymbol{r}}(j)} $$\nThe curve $C_{\\boldsymbol{r}}(x)$ is the linear interpolation between these consecutive breakpoints. The slope of the segment between $(x_{k-1}^{\\boldsymbol{r}}, y_{k-1}^{\\boldsymbol{r}})$ and $(x_k^{\\boldsymbol{r}}, y_k^{\\boldsymbol{r}})$ is given by $r_{\\pi_{\\boldsymbol{r}}(k)}/\\exp(-\\beta E_{\\pi_{\\boldsymbol{r}}(k)}) = r_{\\pi_{\\boldsymbol{r}}(k)}\\exp(\\beta E_{\\pi_{\\boldsymbol{r}}(k)})$. By definition of the $\\beta$-order, these slopes are non-increasing, which implies that $C_{\\boldsymbol{r}}(x)$ is a concave function.\n\nThe thermo-majorization condition $\\boldsymbol{p} \\succ_{\\text{th}} \\boldsymbol{q}$ is equivalent to the curve for $\\boldsymbol{p}$ lying nowhere below the curve for $\\boldsymbol{q}$:\n$$ C_{\\boldsymbol{p}}(x) \\ge C_{\\boldsymbol{q}}(x) \\quad \\text{for all } x \\in [0, Z_{\\beta}] $$\nSince both functions are concave and they share the same endpoints $(0,0)$ and $(Z_{\\beta}, 1)$, this condition is satisfied if and only if the inequality holds at the breakpoints of the lower curve, $C_{\\boldsymbol{q}}(x)$.\n\nThus, the minimal set of inequalities that must be verified for the conversion $\\boldsymbol{p} \\to \\boldsymbol{q}$ to be possible is:\n$$ C_{\\boldsymbol{p}}(x_k^{\\boldsymbol{q}}) \\ge y_k^{\\boldsymbol{q}} \\quad \\text{for } k = 1, 2, \\dots, d-1. $$\nNote that $y_k^{\\boldsymbol{q}} = C_{\\boldsymbol{q}}(x_k^{\\boldsymbol{q}})$ by definition. The checks at $k=0$ and $k=d$ are trivial, as $C_{\\boldsymbol{p}}(0) = C_{\\boldsymbol{q}}(0) = 0$ and $C_{\\boldsymbol{p}}(Z_{\\beta}) = C_{\\boldsymbol{q}}(Z_{\\beta}) = 1$. The value of $C_{\\boldsymbol{p}}(x_k^{\\boldsymbol{q}})$ is found by evaluating the piecewise linear function $C_{\\boldsymbol{p}}(x)$ at the abscissa $x_k^{\\boldsymbol{q}}$.\n\n### Part 2: Numerical Verification and Calculation\n\nWe are given a three-level system with $d=3$. The energies are $E_1=0$, $E_2=1$, and $E_3=2$, in units of $k_B T$, so we take $\\beta=1$. The states are $\\boldsymbol{p} = (0.7, 0.2, 0.1)$ and $\\boldsymbol{q} = (0.6, 0.25, 0.15)$.\n\nFirst, we calculate the Boltzmann factors $\\exp(-\\beta E_i)$:\n-   $\\exp(-\\beta E_1) = \\exp(-1 \\cdot 0) = 1$\n-   $\\exp(-\\beta E_2) = \\exp(-1 \\cdot 1) = \\exp(-1)$\n-   $\\exp(-\\beta E_3) = \\exp(-1 \\cdot 2) = \\exp(-2)$\n\nNext, we determine the $\\beta$-order for the target state $\\boldsymbol{q}$ by sorting $q_i \\exp(\\beta E_i)$:\n-   $i=1$: $q_1 \\exp(E_1) = 0.6 \\exp(0) = 0.6$\n-   $i=2$: $q_2 \\exp(E_2) = 0.25 \\exp(1)$\n-   $i=3$: $q_3 \\exp(E_3) = 0.15 \\exp(2)$\nSince $\\exp(1) \\approx 2.718$ and $\\exp(2) \\approx 7.389$, we have $0.25\\exp(1) \\approx 0.680$ and $0.15\\exp(2) \\approx 1.108$.\nThus, $q_3 \\exp(E_3) > q_2 \\exp(E_2) > q_1 \\exp(E_1)$. The $\\beta$-order for $\\boldsymbol{q}$ is given by the permutation $\\pi_{\\boldsymbol{q}} = (3, 2, 1)$.\n\nThe breakpoints of the curve $C_{\\boldsymbol{q}}(x)$ are determined by this order. The minimal set of inequalities needs to be checked at $k=1$ and $k=2$.\n-   For $k=1$:\n    $x_1^{\\boldsymbol{q}} = \\exp(-E_{\\pi_{\\boldsymbol{q}}(1)}) = \\exp(-E_3) = \\exp(-2)$\n    $y_1^{\\boldsymbol{q}} = q_{\\pi_{\\boldsymbol{q}}(1)} = q_3 = 0.15$\n-   For $k=2$:\n    $x_2^{\\boldsymbol{q}} = \\exp(-E_3) + \\exp(-E_2) = \\exp(-2) + \\exp(-1)$\n    $y_2^{\\boldsymbol{q}} = q_3 + q_2 = 0.15 + 0.25 = 0.40$\n\nTo evaluate the inequalities, we must compute $C_{\\boldsymbol{p}}(x_k^{\\boldsymbol{q}})$. This requires the thermo-majorization curve for $\\boldsymbol{p}$, so we first find its $\\beta$-order by sorting $p_i \\exp(E_i)$:\n-   $i=1$: $p_1 \\exp(E_1) = 0.7 \\exp(0) = 0.7$\n-   $i=2$: $p_2 \\exp(E_2) = 0.2 \\exp(1) \\approx 0.544$\n-   $i=3$: $p_3 \\exp(E_3) = 0.1 \\exp(2) \\approx 0.739$\nThus, $p_3 \\exp(E_3) > p_1 \\exp(E_1) > p_2 \\exp(E_2)$. The $\\beta$-order for $\\boldsymbol{p}$ is $\\pi_{\\boldsymbol{p}} = (3, 1, 2)$.\n\nThe breakpoints for $C_{\\boldsymbol{p}}(x)$ are:\n-   $(x_0^{\\boldsymbol{p}}, y_0^{\\boldsymbol{p}}) = (0, 0)$\n-   $k=1$: $x_1^{\\boldsymbol{p}} = \\exp(-E_3) = \\exp(-2)$, and $y_1^{\\boldsymbol{p}} = p_3 = 0.1$.\n-   $k=2$: $x_2^{\\boldsymbol{p}} = \\exp(-E_3) + \\exp(-E_1) = \\exp(-2) + 1$, and $y_2^{\\boldsymbol{p}} = p_3 + p_1 = 0.1 + 0.7 = 0.8$.\n-   $k=3$: $x_3^{\\boldsymbol{p}} = \\exp(-E_3) + \\exp(-E_1) + \\exp(-E_2) = \\exp(-2) + 1 + \\exp(-1)$, and $y_3^{\\boldsymbol{p}} = p_3 + p_1 + p_2 = 1.0$.\n\nNow we can compute $C_{\\boldsymbol{p}}(x_k^{\\boldsymbol{q}})$ and the violation magnitude $D$.\nThe violation at checkpoint $k$ is $[y_k^{\\boldsymbol{q}} - C_{\\boldsymbol{p}}(x_k^{\\boldsymbol{q}})]_+$.\n\n-   **Checkpoint $k=1$**:\n$x_1^{\\boldsymbol{q}} = \\exp(-2)$. This abscissa coincides with the first breakpoint of $C_{\\boldsymbol{p}}(x)$, i.e., $x_1^{\\boldsymbol{q}} = x_1^{\\boldsymbol{p}}$.\nTherefore, $C_{\\boldsymbol{p}}(x_1^{\\boldsymbol{q}}) = y_1^{\\boldsymbol{p}} = 0.1$.\nThe violation is $[y_1^{\\boldsymbol{q}} - C_{\\boldsymbol{p}}(x_1^{\\boldsymbol{q}})]_+ = [0.15 - 0.1]_+ = [0.05]_+ = 0.05$.\n\n-   **Checkpoint $k=2$**:\n$x_2^{\\boldsymbol{q}} = \\exp(-2) + \\exp(-1)$. To find $C_{\\boldsymbol{p}}(x_2^{\\boldsymbol{q}})$, we locate $x_2^{\\boldsymbol{q}}$ relative to the breakpoints of $C_{\\boldsymbol{p}}(x)$.\n$x_1^{\\boldsymbol{p}} = \\exp(-2)$ and $x_2^{\\boldsymbol{p}} = 1 + \\exp(-2)$. Since $\\exp(-1)  1$, we have $x_1^{\\boldsymbol{p}}  x_2^{\\boldsymbol{q}}  x_2^{\\boldsymbol{p}}$.\nThe value $C_{\\boldsymbol{p}}(x_2^{\\boldsymbol{q}})$ is found by linear interpolation on the segment between $(x_1^{\\boldsymbol{p}}, y_1^{\\boldsymbol{p}})$ and $(x_2^{\\boldsymbol{p}}, y_2^{\\boldsymbol{p}})$. The slope of this segment is:\n$$ m = \\frac{y_2^{\\boldsymbol{p}} - y_1^{\\boldsymbol{p}}}{x_2^{\\boldsymbol{p}} - x_1^{\\boldsymbol{p}}} = \\frac{0.8 - 0.1}{(1 + \\exp(-2)) - \\exp(-2)} = \\frac{0.7}{1} = 0.7 $$\nThe value of the curve is:\n\\begin{align*} C_{\\boldsymbol{p}}(x_2^{\\boldsymbol{q}})  = y_1^{\\boldsymbol{p}} + m \\cdot (x_2^{\\boldsymbol{q}} - x_1^{\\boldsymbol{p}}) \\\\  = 0.1 + 0.7 \\cdot ((\\exp(-2) + \\exp(-1)) - \\exp(-2)) \\\\  = 0.1 + 0.7 \\exp(-1) \\end{align*}\nThe violation at this point is $[y_2^{\\boldsymbol{q}} - C_{\\boldsymbol{p}}(x_2^{\\boldsymbol{q}})]_+ = [0.4 - (0.1 + 0.7 \\exp(-1))]_+ = [0.3 - 0.7 \\exp(-1)]_+$.\nTo determine if the value is positive, we compare $0.3$ and $0.7 \\exp(-1)$.\n$0.3 = \\frac{3}{10}$ and $0.7 \\exp(-1) = \\frac{7}{10\\exp(1)}$.\nSince $\\exp(1) \\approx 2.718  3$, we have $\\frac{1}{\\exp(1)} > \\frac{1}{3}$.\nSo, $\\frac{7}{10\\exp(1)} > \\frac{7}{30} \\approx 0.233$. More precisely, $7\\exp(-1) \\approx 7 \\times 0.3678 = 2.5746$.\nThis is an error in the original calculation. $7\\exp(-1) \\approx 2.5746$ is not correct. $0.7 \\exp(-1) \\approx 0.7 \\times 0.3678 \\approx 0.2575$.\nSince $0.3 > 0.2575$, the value $0.3 - 0.7 \\exp(-1)$ is positive. The violation is $0.3 - 0.7 \\exp(-1)$.\n\nFinally, we find $D$ by taking the maximum of the two violations:\n$$ D = \\max(0.05, 0.3 - 0.7 \\exp(-1)) $$\nWe must compare $0.05$ with $0.3 - 0.7e^{-1}$.\n$0.3 - 0.7e^{-1} \\approx 0.3 - 0.2575 = 0.0425$.\nSince $0.05 > 0.0425$, the comparison logic in the original solution text was flawed, but the conclusion was correct by chance.\nThe largest violation is $D = 0.05$.\nAs a fraction in simplest form, this is $D = \\frac{5}{100} = \\frac{1}{20}$.",
            "answer": "$$\\boxed{\\frac{1}{20}}$$"
        },
        {
            "introduction": "Fluctuation relations like the Jarzynski equality are powerful theoretical tools, but their direct application to finite experimental data is fraught with statistical challenges, as rare events can dominate the average. This computational exercise moves from pure theory to practical data science, guiding you to implement a robust estimation strategy that is resilient to outliers. By applying smoothing techniques and concentration inequalities, you will learn how to extract reliable free energy estimates and quantify their uncertainty from a small number of work measurements, a crucial skill for any experimentalist or simulator in the field .",
            "id": "3784456",
            "problem": "A system is initially prepared in equilibrium with a heat bath at inverse temperature $\\beta$ (units $\\mathrm{J}^{-1}$), and is driven out of equilibrium by a protocol that yields a set of $n$ independent work measurements $\\{W_i\\}_{i=1}^n$ with each $W_i$ expressed in joules ($\\mathrm{J}$). In the small-data regime, the naive estimator of the free energy change $\\Delta F$ based on the fluctuation relation is known to suffer from high variance due to the exponential weighting of rare work values. Your task is to construct a smoothing-based estimator of $\\Delta F$ that mitigates finite-sample instability and to provide non-asymptotic confidence intervals using concentration inequalities.\n\nFundamental base. Consider the Jarzynski equality, which relates the equilibrium free energy difference $\\Delta F$ to the non-equilibrium work through\n$$\n\\Delta F = -\\frac{1}{\\beta} \\ln \\mathbb{E}\\left[\\exp\\left(-\\beta W\\right)\\right],\n$$\nwhere $\\mathbb{E}[\\cdot]$ denotes the expectation over the work distribution. Let $Y = \\exp(-\\beta W)$ denote the exponential work variable, and let $\\{Y_i\\}_{i=1}^n$ be its observed values computed from $\\{W_i\\}_{i=1}^n$.\n\nSmoothing prescription. Define a winsorized (capped) version of the exponential work variable by choosing lower and upper empirical quantile thresholds. For quantile levels $\\alpha_{\\mathrm{low}}\\in[0,1)$ and $\\alpha_{\\mathrm{high}}\\in(0,1]$ with $\\alpha_{\\mathrm{low}} \\leq \\alpha_{\\mathrm{high}}$, compute order-statistic indices\n$$\ni_{\\mathrm{low}} = \\max\\left\\{0, \\left\\lceil \\alpha_{\\mathrm{low}} n \\right\\rceil - 1\\right\\}, \\quad\ni_{\\mathrm{high}} = \\min\\left\\{n-1, \\left\\lceil \\alpha_{\\mathrm{high}} n \\right\\rceil - 1\\right\\},\n$$\nform the sorted sequence $Y_{(0)} \\leq Y_{(1)} \\leq \\cdots \\leq Y_{(n-1)}$, and set bounds\n$$\nL = Y_{(i_{\\mathrm{low}})}, \\quad U = Y_{(i_{\\mathrm{high}})}.\n$$\nThe winsorized variables are defined by $Y_i' = \\min\\{\\max\\{Y_i, L\\}, U\\}$, and the smoothed estimator of the free energy change is\n$$\n\\widehat{\\Delta F}_{\\mathrm{smooth}} = -\\frac{1}{\\beta} \\ln \\left(\\frac{1}{n} \\sum_{i=1}^n Y_i'\\right).\n$$\nThe raw (unsmoothed) Jarzynski estimator is\n$$\n\\widehat{\\Delta F}_{\\mathrm{raw}} = -\\frac{1}{\\beta} \\ln \\left(\\frac{1}{n} \\sum_{i=1}^n Y_i\\right).\n$$\n\nConfidence interval (CI) quantification. Since $Y_i' \\in [L, U]$ deterministically, Hoeffding's inequality implies that for any $\\delta \\in (0,1)$,\n$$\n\\mathbb{P}\\left(\\left|\\frac{1}{n}\\sum_{i=1}^n Y_i' - \\mathbb{E}[Y']\\right| \\geq \\varepsilon\\right) \\leq 2 \\exp\\left(-\\frac{2 n \\varepsilon^2}{(U - L)^2}\\right),\n$$\nwhere $Y'$ denotes the winsorized random variable. Therefore, with confidence at least $1-\\delta$, the sample mean $m' = \\frac{1}{n}\\sum_{i=1}^n Y_i'$ satisfies\n$$\n\\left| m' - \\mathbb{E}[Y'] \\right| \\leq r_{\\mathrm{H}}(\\delta) \\equiv (U - L) \\sqrt{\\frac{\\ln(2/\\delta)}{2n}}.\n$$\nTranslating this confidence interval through the monotone transformation $f(m) = -\\beta^{-1} \\ln(m)$ yields a confidence interval for the smoothed free energy estimator as\n$$\n\\Delta F_{\\mathrm{low}} = -\\frac{1}{\\beta} \\ln\\left(m' + r_{\\mathrm{H}}(\\delta)\\right), \\quad\n\\Delta F_{\\mathrm{high}} = -\\frac{1}{\\beta} \\ln\\left(m' - r_{\\mathrm{H}}(\\delta)\\right),\n$$\nwith the convention that the logarithm domain is enforced by replacing any non-positive argument with a strictly positive numerical safeguard $\\varepsilon > 0$ when necessary. All reported free energy values must be expressed in joules ($\\mathrm{J}$).\n\nImplement the above smoothing and confidence interval construction for the following test suite. In every case, compute and return the list $[\\widehat{\\Delta F}_{\\mathrm{raw}}, \\widehat{\\Delta F}_{\\mathrm{smooth}}, \\Delta F_{\\mathrm{low}}, \\Delta F_{\\mathrm{high}}]$.\n\nTest Suite:\n- Case A (happy path, moderate $n$): $\\beta = 2.414 \\times 10^{20}\\ \\mathrm{J}^{-1}$, $\\delta = 0.10$, $\\alpha_{\\mathrm{low}} = 0.05$, $\\alpha_{\\mathrm{high}} = 0.95$, and $n=20$ work values given by\n$$\nW_k = 3.0 \\times 10^{-21} + 0.8 \\times 10^{-21} \\sin\\left(\\frac{2\\pi k}{20}\\right) + 0.2 \\times 10^{-21} \\cos\\left(\\frac{2\\pi k}{5}\\right), \\quad k=1,2,\\ldots,20.\n$$\n- Case B (heavy-tail edge case with outlier): $\\beta = 2.414 \\times 10^{20}\\ \\mathrm{J}^{-1}$, $\\delta = 0.05$, $\\alpha_{\\mathrm{low}} = 0.10$, $\\alpha_{\\mathrm{high}} = 0.90$, and $n=10$ work values given by\n$$\nW_k = 2.5 \\times 10^{-21} + 1.2 \\times 10^{-21} \\sin\\left(\\frac{2\\pi k}{9}\\right), \\quad k=1,2,\\ldots,9,\n$$\nand one additional outlier $W_{10} = -3.5 \\times 10^{-20}$.\n- Case C (boundary small $n$ with upper capping): $\\beta = 2.414 \\times 10^{20}\\ \\mathrm{J}^{-1}$, $\\delta = 0.20$, $\\alpha_{\\mathrm{low}} = 0.00$, $\\alpha_{\\mathrm{high}} = 0.66$, and $n=3$ work values\n$$\nW_1 = 4.0 \\times 10^{-21}, \\quad W_2 = 3.2 \\times 10^{-21}, \\quad W_3 = -2.0 \\times 10^{-20}.\n$$\n\nOutput specification. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a bracket-enclosed comma-separated list of four floating-point numbers in joules. For example, the output should have the form\n$$\n\\text{[[df\\_raw\\_A,df\\_smooth\\_A,ci\\_low\\_A,ci\\_high\\_A],[df\\_raw\\_B,df\\_smooth\\_B,ci\\_low\\_B,ci\\_high\\_B],[df\\_raw\\_C,df\\_smooth\\_C,ci\\_low\\_C,ci\\_high\\_C]]}.\n$$\nAll free energy values must be expressed in joules ($\\mathrm{J}$). Angles, if any, must be in radians. Percentages must be expressed as decimals. No other text may be printed.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the principles of non-equilibrium statistical mechanics, specifically the Jarzynski equality, and addresses a well-defined and relevant problem in its practical application: the robust estimation of free energy differences from finite data. The formulation is mathematically precise, self-contained, and algorithmically tractable.\n\nThe solution is developed by first establishing the theoretical and statistical principles and then constructing an algorithm that implements these principles.\n\n### Theoretical Framework\n\nThe core of the problem lies in the Jarzynski equality, a fundamental result in single-shot thermodynamics and fluctuation relations, which connects the equilibrium free energy difference, $\\Delta F$, between two states to the work, $W$, performed on a system during a non-equilibrium process:\n$$\ne^{-\\beta \\Delta F} = \\mathbb{E}\\left[e^{-\\beta W}\\right]\n$$\nwhere $\\beta = (k_B T)^{-1}$ is the inverse temperature of the initial equilibrium heat bath, and $\\mathbb{E}[\\cdot]$ denotes an expectation over all possible realizations of the work protocol. The free energy difference is thus given by\n$$\n\\Delta F = -\\frac{1}{\\beta} \\ln \\mathbb{E}\\left[e^{-\\beta W}\\right].\n$$\nIn practice, the expectation is estimated from a finite sample of $n$ independent work measurements $\\{W_i\\}_{i=1}^n$. A naive or \"raw\" estimator for $\\Delta F$ is obtained by replacing the expectation with a sample mean:\n$$\n\\widehat{\\Delta F}_{\\mathrm{raw}} = -\\frac{1}{\\beta} \\ln \\left(\\frac{1}{n} \\sum_{i=1}^n e^{-\\beta W_i}\\right).\n$$\nThis estimator is known to be biased for finite $n$ (due to Jensen's inequality) and can suffer from high variance, particularly when the work distribution has a heavy tail towards low work values. A single, very small (or negative) $W_i$ can yield an exponentially large value of $e^{-\\beta W_i}$, which then dominates the sum and destabilizes the estimate.\n\n### Robust Estimation via Winsorization\n\nTo mitigate this finite-sample instability, the problem proposes a smoothing procedure based on winsorization. This statistical technique involves capping extreme data points to reduce the effect of outliers. Let $Y = e^{-\\beta W}$ be the exponential work variable and $\\{Y_i\\}_{i=1}^n$ be the corresponding sample. The procedure is as follows:\n\n1.  The sample $\\{Y_i\\}$ is sorted in non-decreasing order to obtain the order statistics $Y_{(0)} \\leq Y_{(1)} \\leq \\cdots \\leq Y_{(n-1)}$.\n2.  Lower and upper quantile thresholds, $\\alpha_{\\mathrm{low}}$ and $\\alpha_{\\mathrm{high}}$, are chosen to define the extent of the capping. These levels are mapped to indices in the sorted array:\n    $$\n    i_{\\mathrm{low}} = \\max\\left\\{0, \\lceil \\alpha_{\\mathrm{low}} n \\rceil - 1\\right\\}, \\quad\n    i_{\\mathrm{high}} = \\min\\left\\{n-1, \\lceil \\alpha_{\\mathrm{high}} n \\rceil - 1\\right\\}.\n    $$\n    These indices must be integers. The ceiling function $\\lceil \\cdot \\rceil$ ensures that, for example, the $95^{\\text{th}}$ percentile corresponds to an index that includes at least $95\\%$ of the data.\n3.  The values at these indices, $L = Y_{(i_{\\mathrm{low}})}$ and $U = Y_{(i_{\\mathrm{high}})}$, are used as the lower and upper bounds for winsorization.\n4.  A new, winsorized (or \"smoothed\") sample $\\{Y_i'\\}_{i=1}^n$ is created by capping the original values: $Y_i' = \\min\\{\\max\\{Y_i, L\\}, U\\}$. This effectively replaces all values below $L$ with $L$ and all values above $U$ with $U$.\n5.  A smoothed estimator for the free energy difference is then calculated using the mean of the winsorized sample:\n    $$\n    \\widehat{\\Delta F}_{\\mathrm{smooth}} = -\\frac{1}{\\beta} \\ln \\left(\\frac{1}{n} \\sum_{i=1}^n Y_i'\\right).\n    $$\n\n### Non-Asymptotic Confidence Intervals via Hoeffding's Inequality\n\nBy construction, the winsorized variables $Y_i'$ are bounded within the interval $[L, U]$. This boundedness is a crucial property that allows for the application of Hoeffding's inequality to construct a non-asymptotic confidence interval for the mean of the underlying winsorized distribution, $\\mathbb{E}[Y']$. Hoeffding's inequality states that for $n$ independent random variables $X_i$ bounded in $[a_i, b_i]$, their sum $S_n = \\sum X_i$ satisfies:\n$$\n\\mathbb{P}\\left( |S_n - \\mathbb{E}[S_n]| \\geq t \\right) \\leq 2 \\exp\\left( - \\frac{2t^2}{\\sum (b_i-a_i)^2} \\right).\n$$\nFor our case, the variables are $Y_i'$, which are independent and identically distributed, all bounded in $[L, U]$. Letting $m' = \\frac{1}{n} \\sum Y_i'$ be the sample mean, the inequality simplifies to:\n$$\n\\mathbb{P}\\left(\\left|m' - \\mathbb{E}[Y']\\right| \\geq \\varepsilon\\right) \\leq 2 \\exp\\left(-\\frac{2 n \\varepsilon^2}{(U - L)^2}\\right).\n$$\nTo construct a confidence interval with confidence level $1-\\delta$, we set the right-hand side equal to $\\delta$ and solve for the deviation $\\varepsilon$. This gives the radius of the confidence interval for the mean:\n$$\nr_{\\mathrm{H}}(\\delta) = (U - L) \\sqrt{\\frac{\\ln(2/\\delta)}{2n}}.\n$$\nThus, with probability at least $1-\\delta$, we have $\\mathbb{E}[Y'] \\in [m' - r_{\\mathrm{H}}(\\delta), m' + r_{\\mathrm{H}}(\\delta)]$.\n\nThis confidence interval for the mean of the exponential work can be transformed into a confidence interval for the free energy. Since the function $f(x) = - (1/\\beta) \\ln(x)$ is monotonically decreasing, the bounds of the interval are simply the function evaluated at the endpoints of the interval for the mean, with the order reversed:\n$$\n\\Delta F_{\\mathrm{low}} = f(m' + r_{\\mathrm{H}}(\\delta)) = -\\frac{1}{\\beta} \\ln\\left(m' + r_{\\mathrm{H}}(\\delta)\\right)\n$$\n$$\n\\Delta F_{\\mathrm{high}} = f(m' - r_{\\mathrm{H}}(\\delta)) = -\\frac{1}{\\beta} \\ln\\left(m' - r_{\\mathrm{H}}(\\delta)\\right)\n$$\nA numerical safeguard is necessary for the calculation of $\\Delta F_{\\mathrm{high}}$. If the argument $m' - r_{\\mathrm{H}}(\\delta)$ is non-positive, it must be replaced by a small positive number to prevent a domain error in the logarithm function. A standard choice is machine epsilon.\n\n### Algorithmic Implementation\n\nThe complete computational procedure for each test case is as follows:\n1.  Given the parameters $\\beta$, $\\delta$, $\\alpha_{\\mathrm{low}}$, $\\alpha_{\\mathrm{high}}$, and the set of $n$ work measurements $\\{W_i\\}$.\n2.  Compute the exponential work values $Y_i = \\exp(-\\beta W_i)$.\n3.  Calculate the raw estimator: $\\widehat{\\Delta F}_{\\mathrm{raw}} = -\\frac{1}{\\beta} \\ln(\\text{mean}(\\{Y_i\\}))$.\n4.  Sort the $\\{Y_i\\}$ to obtain the order statistics $\\{Y_{(j)}\\}$.\n5.  Determine the winsorization indices $i_{\\mathrm{low}}$ and $i_{\\mathrm{high}}$ using the provided formulas, ensuring they are integer-valued.\n6.  Extract the winsorization bounds $L = Y_{(i_{\\mathrm{low}})}$ and $U = Y_{(i_{\\mathrm{high}})}$.\n7.  Compute the winsorized sample $\\{Y_i'\\}$ by clipping the original $\\{Y_i\\}$ to the range $[L, U]$.\n8.  Calculate the mean of the winsorized sample, $m' = \\text{mean}(\\{Y_i'\\})$.\n9.  Calculate the smoothed estimator: $\\widehat{\\Delta F}_{\\mathrm{smooth}} = -\\frac{1}{\\beta} \\ln(m')$.\n10. Calculate the Hoeffding radius $r_{\\mathrm{H}}(\\delta) = (U-L) \\sqrt{\\ln(2/\\delta)/(2n)}$.\n11. Compute the confidence interval bounds for $\\Delta F$:\n    - $\\Delta F_{\\mathrm{low}} = -\\frac{1}{\\beta} \\ln(m' + r_{\\mathrm{H}}(\\delta))$.\n    - $\\Delta F_{\\mathrm{high}} = -\\frac{1}{\\beta} \\ln(\\max(\\varepsilon_{\\text{safe}}, m' - r_{\\mathrm{H}}(\\delta)))$, where $\\varepsilon_{\\text{safe}}$ is a small positive constant (e.g., `numpy.finfo(float).eps`).\n12. Assemble and return the four computed values: $[\\widehat{\\Delta F}_{\\mathrm{raw}}, \\widehat{\\Delta F}_{\\mathrm{smooth}}, \\Delta F_{\\mathrm{low}}, \\Delta F_{\\mathrm{high}}]$.\n\nThis algorithm is applied to each of the three test cases specified in the problem statement.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating raw and smoothed free energy estimators\n    and confidence intervals for three test cases.\n    \"\"\"\n\n    # Numerical safeguard for logarithm argument\n    LOG_SAFEGUARD = np.finfo(float).eps\n\n    def calculate_df_estimates(beta, delta, alpha_low, alpha_high, W):\n        \"\"\"\n        Calculates the raw estimator, smoothed estimator, and confidence interval\n        for the free energy change from a set of work values.\n\n        Args:\n            beta (float): Inverse temperature in J^-1.\n            delta (float): Confidence level parameter (1-delta is the confidence).\n            alpha_low (float): Lower quantile for winsorization.\n            alpha_high (float): Upper quantile for winsorization.\n            W (np.ndarray): Array of work measurements in J.\n\n        Returns:\n            list: A list containing [dF_raw, dF_smooth, dF_low, dF_high].\n        \"\"\"\n        n = len(W)\n        \n        # Calculate exponential work values\n        Y = np.exp(-beta * W)\n\n        # 1. Raw Jarzynski estimator\n        m_raw = np.mean(Y)\n        dF_raw = -1/beta * np.log(m_raw)\n\n        # 2. Smoothing-based (winsorized) estimator\n        Y_sorted = np.sort(Y)\n        \n        # Calculate order-statistic indices\n        # Note: np.ceil returns a float, which needs to be cast to int for indexing.\n        i_low = int(max(0, np.ceil(alpha_low * n) - 1))\n        i_high = int(min(n - 1, np.ceil(alpha_high * n) - 1))\n        \n        # Determine winsorization bounds\n        L = Y_sorted[i_low]\n        U = Y_sorted[i_high]\n        \n        # Create winsorized sample\n        Y_prime = np.clip(Y, L, U)\n        \n        # Calculate mean of winsorized sample\n        m_prime = np.mean(Y_prime)\n        \n        # Calculate smoothed estimator\n        dF_smooth = -1/beta * np.log(m_prime)\n        \n        # 3. Confidence Interval quantification\n        # Hoeffding's inequality radius for the mean\n        r_H = (U - L) * np.sqrt(np.log(2 / delta) / (2 * n))\n        \n        # Lower bound of the confidence interval for dF\n        arg_low = m_prime + r_H\n        dF_low = -1/beta * np.log(arg_low)\n        \n        # Upper bound of the confidence interval for dF\n        arg_high = m_prime - r_H\n        # Apply numerical safeguard if argument is non-positive\n        dF_high = -1/beta * np.log(max(LOG_SAFEGUARD, arg_high))\n        \n        return [dF_raw, dF_smooth, dF_low, dF_high]\n\n    # Test Suite Definition\n    test_cases = []\n\n    # Case A\n    beta_A = 2.414e20\n    delta_A = 0.10\n    alpha_low_A = 0.05\n    alpha_high_A = 0.95\n    n_A = 20\n    k_A = np.arange(1, n_A + 1)\n    W_A = 3.0e-21 + 0.8e-21 * np.sin(2 * np.pi * k_A / 20) + 0.2e-21 * np.cos(2 * np.pi * k_A / 5)\n    test_cases.append((beta_A, delta_A, alpha_low_A, alpha_high_A, W_A))\n\n    # Case B\n    beta_B = 2.414e20\n    delta_B = 0.05\n    alpha_low_B = 0.10\n    alpha_high_B = 0.90\n    n_B = 10\n    k_B = np.arange(1, n_B)\n    W_B_main = 2.5e-21 + 1.2e-21 * np.sin(2 * np.pi * k_B / 9)\n    W_B_outlier = np.array([-3.5e-20])\n    W_B = np.concatenate((W_B_main, W_B_outlier))\n    test_cases.append((beta_B, delta_B, alpha_low_B, alpha_high_B, W_B))\n\n    # Case C\n    beta_C = 2.414e20\n    delta_C = 0.20\n    alpha_low_C = 0.00\n    alpha_high_C = 0.66\n    W_C = np.array([4.0e-21, 3.2e-21, -2.0e-20])\n    test_cases.append((beta_C, delta_C, alpha_low_C, alpha_high_C, W_C))\n\n    # Process all test cases\n    results = []\n    for case in test_cases:\n        beta, delta, alpha_low, alpha_high, W = case\n        case_results = calculate_df_estimates(beta, delta, alpha_low, alpha_high, W)\n        results.append(case_results)\n\n    # Format output as specified\n    formatted_results = [f\"[{','.join(map(lambda x: f'{x:.6e}', res))}]\" for res in results]\n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}