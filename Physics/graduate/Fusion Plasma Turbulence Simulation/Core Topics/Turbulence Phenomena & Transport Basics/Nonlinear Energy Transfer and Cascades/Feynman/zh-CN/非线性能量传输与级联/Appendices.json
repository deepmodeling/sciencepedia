{
    "hands_on_practices": [
        {
            "introduction": "要理解等离子体湍流中复杂的能量网络，我们通常从简化模型入手。本练习使用一个捕食者-被捕食者系统来描述湍流涡旋与自生带状流之间的基本相互作用，清晰地展示了能量如何交换并最终达到饱和的稳态。通过分析这个系统的定点和稳定性，您将掌握一个研究非线性饱和机制的核心分析工具 。",
            "id": "4197196",
            "problem": "在漂移波湍流与自生带状流相互作用的聚变等离子体湍流模拟中，通常采用一个简化的捕食者-猎物模型来表示湍流和带状流之间的非线性能量转移。令湍流能量表示为 $E_t(t)$，带状流能量表示为 $Z(t)$。考虑以下动力学系统：\n$$\n\\dot{E}_t \\equiv \\frac{dE_t}{dt} = \\alpha E_t - \\beta Z E_t, \\qquad \\dot{Z} \\equiv \\frac{dZ}{dt} = \\gamma E_t - \\delta Z,\n$$\n其中 $t$ 是时间，$\\alpha$ 是湍流的净线性驱动（例如，由背景梯度引起），$\\delta$ 是带状流的净线性阻尼，$\\beta$ 和 $\\gamma$ 分别是编码了湍流的剪切抑制和带状流的雷诺应力驱动的非线性耦合系数。假设以下条件与通过回旋动理学模拟中的三波能量通量诊断获得的非线性能量转移测量结果一致：$\\alpha > 0$, $\\beta > 0$, $\\gamma > 0$, $\\delta > 0$。\n\n从不动点（稳态）的定义和基于矢量场雅可比矩阵的线性稳定性出发，仅使用第一性原理完成以下任务：\n- 找出系统的所有不动点 $(E_t^{\\star}, Z^{\\star})$。\n- 通过在每个不动点附近进行线性化，推导关于 $\\alpha$、$\\beta$、$\\gamma$、$\\delta$ 的线性稳定性条件，这些条件需与从非线性能量转移测量中推断出的符号一致。你的推理必须从雅可比矩阵、其迹和行列式以及标准的二维稳定性判据出发。\n\n以稳态正湍流能量 $E_t^{\\star}$ 的解析表达式形式给出你的最终答案，该表达式应只包含 $\\alpha$、$\\beta$、$\\gamma$、$\\delta$。不要包含任何单位。如果引入任何辅助符号，你必须在最终答案中将它们消去，使其仅依赖于 $\\alpha$、$\\beta$、$\\gamma$、$\\delta$。",
            "solution": "给定一个关于湍流能量 $E_t$ 和带状流能量 $Z$ 的双变量动力学系统：\n$$\n\\dot{E}_t = \\alpha E_t - \\beta Z E_t, \\qquad \\dot{Z} = \\gamma E_t - \\delta Z,\n$$\n其参数受测量值约束为 $\\alpha > 0$, $\\beta > 0$, $\\gamma > 0$, $\\delta > 0$。\n\n步骤 $1$：不动点。一个不动点 $(E_t^{\\star}, Z^{\\star})$ 满足 $\\dot{E}_t = 0$ 和 $\\dot{Z} = 0$。由 $\\dot{E}_t = 0$ 得，\n$$\n0 = \\alpha E_t^{\\star} - \\beta Z^{\\star} E_t^{\\star} = E_t^{\\star} \\left( \\alpha - \\beta Z^{\\star} \\right).\n$$\n因此，要么 $E_t^{\\star} = 0$，要么 $Z^{\\star} = \\alpha / \\beta$。由 $\\dot{Z} = 0$ 得，\n$$\n0 = \\gamma E_t^{\\star} - \\delta Z^{\\star} \\quad \\Rightarrow \\quad Z^{\\star} = \\frac{\\gamma}{\\delta} E_t^{\\star}.\n$$\n结合这些条件可得出两个不动点：\n\n$1.$ 平凡不动点：$E_t^{\\star} = 0$ 意味着 $Z^{\\star} = 0$，所以 $(E_t^{\\star}, Z^{\\star}) = (0, 0)$。\n\n$2.$ 非平凡不动点：$Z^{\\star} = \\alpha / \\beta$ 和 $Z^{\\star} = (\\gamma / \\delta) E_t^{\\star}$ 意味着\n$$\n\\frac{\\gamma}{\\delta} E_t^{\\star} = \\frac{\\alpha}{\\beta} \\quad \\Rightarrow \\quad E_t^{\\star} = \\frac{\\alpha \\delta}{\\beta \\gamma}, \\qquad Z^{\\star} = \\frac{\\alpha}{\\beta}.\n$$\n鉴于 $\\alpha > 0$, $\\beta > 0$, $\\gamma > 0$, $\\delta > 0$，$E_t^{\\star}$ 和 $Z^{\\star}$ 均为正值，这与物理上的能量相符。\n\n步骤 $2$：通过雅可比矩阵进行线性稳定性分析。令矢量场为 $\\mathbf{F}(E_t, Z) = \\left( \\alpha E_t - \\beta Z E_t, \\gamma E_t - \\delta Z \\right)$。雅可比矩阵 $\\mathbf{J}$ 为\n$$\n\\mathbf{J}(E_t, Z) = \n\\begin{pmatrix}\n\\frac{\\partial}{\\partial E_t}(\\alpha E_t - \\beta Z E_t) & \\frac{\\partial}{\\partial Z}(\\alpha E_t - \\beta Z E_t) \\\\\n\\frac{\\partial}{\\partial E_t}(\\gamma E_t - \\delta Z) & \\frac{\\partial}{\\partial Z}(\\gamma E_t - \\delta Z)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\alpha - \\beta Z & - \\beta E_t \\\\\n\\gamma & - \\delta\n\\end{pmatrix}.\n$$\n对于二维线性化，稳定性通过在不动点处计算的迹 $\\operatorname{tr}(\\mathbf{J})$ 和行列式 $\\det(\\mathbf{J})$ 来评估。当且仅当 $\\operatorname{tr}(\\mathbf{J}) < 0$ 和 $\\det(\\mathbf{J}) > 0$ 时，该不动点是线性稳定的。\n\n在 $(0, 0)$ 处的稳定性：\n$$\n\\mathbf{J}(0, 0) =\n\\begin{pmatrix}\n\\alpha & 0 \\\\\n\\gamma & - \\delta\n\\end{pmatrix}.\n$$\n其迹和行列式为\n$$\n\\operatorname{tr}(\\mathbf{J}(0, 0)) = \\alpha - \\delta, \\qquad \\det(\\mathbf{J}(0, 0)) = \\alpha (- \\delta) - 0 \\cdot \\gamma = - \\alpha \\delta.\n$$\n在 $\\alpha > 0$ 和 $\\delta > 0$ 的条件下，我们有 $\\det(\\mathbf{J}(0, 0)) < 0$，这意味着它是一个鞍点，因此无论 $\\operatorname{tr}(\\mathbf{J}(0, 0))$ 的符号如何，该点都是线性不稳定的。因此，对于测量符号的参数体系，平凡不动点 $(0, 0)$ 是不稳定的。\n\n在非平凡不动点 $(E_t^{\\star}, Z^{\\star}) = \\left( \\frac{\\alpha \\delta}{\\beta \\gamma}, \\frac{\\alpha}{\\beta} \\right)$ 处的稳定性：\n代入雅可比矩阵，\n$$\n\\mathbf{J}(E_t^{\\star}, Z^{\\star}) =\n\\begin{pmatrix}\n\\alpha - \\beta \\left( \\frac{\\alpha}{\\beta} \\right) & - \\beta \\left( \\frac{\\alpha \\delta}{\\beta \\gamma} \\right) \\\\\n\\gamma & - \\delta\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 & - \\frac{\\alpha \\delta}{\\gamma} \\\\\n\\gamma & - \\delta\n\\end{pmatrix}.\n$$\n其迹和行列式为\n$$\n\\operatorname{tr}(\\mathbf{J}(E_t^{\\star}, Z^{\\star})) = 0 + (- \\delta) = - \\delta, \\qquad \\det(\\mathbf{J}(E_t^{\\star}, Z^{\\star})) = 0 \\cdot (- \\delta) - \\left( - \\frac{\\alpha \\delta}{\\gamma} \\right) \\gamma = \\alpha \\delta.\n$$\n鉴于 $\\delta > 0$，我们有 $\\operatorname{tr}(\\mathbf{J}(E_t^{\\star}, Z^{\\star})) < 0$；又鉴于 $\\alpha > 0$，有 $\\det(\\mathbf{J}(E_t^{\\star}, Z^{\\star})) > 0$。因此，非平凡不动点是线性稳定的。特征值 $\\lambda$ 满足\n$$\n\\lambda^2 - \\operatorname{tr}(\\mathbf{J}) \\lambda + \\det(\\mathbf{J}) = 0 \\quad \\Rightarrow \\quad \\lambda^2 + \\delta \\lambda + \\alpha \\delta = 0,\n$$\n所以\n$$\n\\lambda = \\frac{- \\delta \\pm \\sqrt{ \\delta^2 - 4 \\alpha \\delta }}{2}.\n$$\n对于 $\\alpha > 0$ 和 $\\delta > 0$，其实部为 $- \\delta / 2 < 0$，这意味着线性稳定性；如果 $\\alpha > \\delta / 4$，则趋近过程是振荡的（共轭复特征值），而对于 $\\alpha \\le \\delta / 4$，它是过阻尼的，这两种情况都与测量结果一致，即系统根据驱动与阻尼的相对强度，表现为伴随或不伴随振荡的饱和现象。\n\n这些结论与假定的测量符号是一致的：$\\beta > 0$ 编码了带状流对湍流的剪切抑制，$\\gamma > 0$ 编码了通过雷诺应力从湍流到带状流的净非线性能量转移，$\\alpha > 0$ 是背景驱动，而 $\\delta > 0$ 是带状流阻尼。非平凡不动点的存在性和正性要求 $\\beta > 0$ 和 $\\gamma > 0$，而其稳定性进一步要求 $\\delta > 0$ 和 $\\alpha > 0$，所有这些条件都得到满足。\n\n因此，稳态正湍流能量为\n$$\nE_t^{\\star} = \\frac{\\alpha \\delta}{\\beta \\gamma}.\n$$\n这就是所要求的以 $\\alpha$、$\\beta$、$\\gamma$、$\\delta$ 表示的解析表达式。",
            "answer": "$$\\boxed{\\frac{\\alpha \\delta}{\\beta \\gamma}}$$"
        },
        {
            "introduction": "精确地模拟非线性过程，尤其是能量在不同尺度间的传递，对数值方法的保真度提出了极高要求。本实践将引导您实现一个求解长谷川-三间方程的拟谱方法，并揭示一个被称为“混淆误差”的关键数值陷阱，它可能导致非物理的能量产生并破坏守恒律。通过亲自实现奥萨格（Orszag）的2/3反混淆规则，您将掌握确保湍流模拟结果可靠性的基本技术 。",
            "id": "4197193",
            "problem": "实现一个用于 Charney–Hasegawa–Mima (CHM) 方程的伪谱求解器，以揭示非线性能量传递中的混叠误差，并使用 Orszag 的三分之二规则验证守恒性。工作在双周期正方形域 $[0,2\\pi)\\times[0,2\\pi)$ 上，使用大小为 $N\\times N$ 的傅里叶配置网格进行离散。CHM 动力学根据平流方程演化广义位涡 $q$：\n$$\n\\frac{\\partial q}{\\partial t} + \\{\\phi,q\\} = 0,\n$$\n其中 $q = \\nabla^2 \\phi - \\phi$，$\\phi$ 是静电势，而泊松括号为\n$$\n\\{\\phi,q\\} = \\frac{\\partial \\phi}{\\partial x}\\frac{\\partial q}{\\partial y} - \\frac{\\partial \\phi}{\\partial y}\\frac{\\partial q}{\\partial x}.\n$$\n使用快速傅里叶变换 (FFT) 以伪谱方法计算空间导数：在谱空间中乘以 $i k_x$ 或 $i k_y$ 对应于在实空间中对 $x$ 或 $y$ 求导。求解器必须采用稳定的显式时间积分方法，并实现非线性项求值的两种变体：一种是未去混叠的变体，另一种是基于 Orszag 三分之二规则的去混叠变体，该规则在非线性乘积求值期间仅保留满足 $|k_x|\\le k_c$ 和 $|k_y|\\le k_c$（其中 $k_c=\\lfloor N/3\\rfloor$）的模式，并将结果过滤回这组已解析的模式。\n\n从第一性原理出发，连续的 CHM 非线性项守恒区域平均能量\n$$\nE = \\frac{1}{2}\\left\\langle |\\nabla \\phi|^2 + |\\phi|^2\\right\\rangle,\n$$\n和区域平均拟涡能\n$$\nZ = \\frac{1}{2}\\left\\langle |q|^2\\right\\rangle,\n$$\n其中 $\\langle \\cdot \\rangle$ 表示在周期域上的空间平均。在伪谱离散化中，在物理空间中计算乘积对应于在谱空间中的卷积。在截断的网格上，未解析的三波相互作用 $\\mathbf{k}_3=\\mathbf{k}_1+\\mathbf{k}_2$（其中 $|\\mathbf{k}_3|$ 超过截断极限）会混叠到较低的模式中，并可能伪性地违反这些不变量的离散模拟。Orszag 的三分之二规则可证明地避免了二次非线性项的这种混叠，方法是确保任意两个保留的模式之和不会产生位于截断集之外的模式。\n\n您的程序必须：\n- 用每个方向 $N$ 个点表示域，并使用与 $[0,2\\pi)$ 周期性一致的基于 FFT 的谱微分，即 $k_x$ 和 $k_y$ 对应于整数波数。\n- 将 $\\phi(x,y,0)$ 初始化为两个余弦平面波的叠加，分别形成一个近截断三波和一个低波数三波。对于波矢量 $\\mathbf{k}=(k_x,k_y)$，使用 $\\cos(k_x x + k_y y)$。\n- 从初始化的 $\\phi$ 计算 $q(x,y,0) = \\nabla^2 \\phi(x,y,0) - \\phi(x,y,0)$。\n- 通过在物理空间中计算泊松括号并将结果变换回谱空间进行时间步进，来推进 $q$。对于去混叠变体，将三分之二规则掩码应用于用于非线性项求值的场，并在更新状态之前应用于非线性项本身。\n- 在 $t=0$ 和最终时间 $t=T$ 时，使用空间平均计算 $E$ 和 $Z$（无单位；所有量均为无量纲），并报告相对变化 $(E(T)-E(0))/E(0)$ 和 $(Z(T)-Z(0))/Z(0)$。\n\n时间积分必须是显式的且稳定；使用不依赖于隐式求解器的方法。由于域是 $[0,2\\pi)$，角度以弧度为单位。您的实现必须是自包含的，并且只使用指定的库。\n\n测试套件：\n使用以下参数集，它们共同测试了近截断处的混叠、使用去混叠的守恒性以及低波数行为。\n- 情况 1（近截断三波，无去混叠）：\n  - 网格大小 $N=32$，域大小 $L=2\\pi$。\n  - 时间步长 $\\Delta t = 0.002$，最终时间 $T = 0.2$。\n  - 振幅 $A = 10^{-3}$。\n  - 使用 $\\mathbf{k}_1=(10,5)$ 和 $\\mathbf{k}_2=(7,6)$ 初始化。\n  - 禁用去混叠。\n- 情况 2（近截断三波，使用三分之二规则去混叠）：\n  - 与情况 1 相同，但启用去混叠，每个方向的截止波数为 $k_c=\\lfloor N/3\\rfloor$。\n- 情况 3（低波数三波，无去混叠）：\n  - 网格大小 $N=32$，域大小 $L=2\\pi$。\n  - 时间步长 $\\Delta t = 0.002$，最终时间 $T = 0.2$。\n  - 振幅 $A = 10^{-3}$。\n  - 使用 $\\mathbf{k}_1=(3,2)$ 和 $\\mathbf{k}_2=(4,3)$ 初始化。\n  - 禁用去混叠。\n- 情况 4（低波数三波，使用三分之二规则去混叠）：\n  - 与情况 3 相同，但启用去混叠，截止波数为 $k_c=\\lfloor N/3\\rfloor$。\n\n答案规范：\n- 对于每种情况，计算两个浮点数 $(E(T)-E(0))/E(0)$ 和 $(Z(T)-Z(0))/Z(0)$。\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，按以下顺序排列\n$$\n\\big[(\\Delta E)_1, (\\Delta Z)_1, (\\Delta E)_2, (\\Delta Z)_2, (\\Delta E)_3, (\\Delta Z)_3, (\\Delta E)_4, (\\Delta Z)_4\\big],\n$$\n其中 $(\\Delta E)_i$ 和 $(\\Delta Z)_i$ 分别是情况 $i$ 的相对变化。\n- 将所有浮点数表示为四舍五入到六位小数的十进制数。",
            "solution": "该问题要求在二维周期域上实现 Charney-Hasegawa-Mima (CHM) 方程的伪谱求解器，以研究混叠误差及其缓解方法。解决方案涉及对域进行离散化，在傅里叶空间中表示场，并使用显式数值格式在时间上推进系统。\n\nCHM 方程控制广义位涡 $q$ 的演化：\n$$\n\\frac{\\partial q}{\\partial t} + \\left\\{\\phi, q\\right\\} = 0\n$$\n量 $q$ 通过 $q = \\nabla^2 \\phi - \\phi$ 与静电势 $\\phi$ 相关。项 $\\{\\phi, q\\}$ 是泊松括号，表示 $q$ 被 $\\mathbf{E}\\times\\mathbf{B}$ 漂移速度场 $\\mathbf{u} = (-\\partial_y \\phi, \\partial_x \\phi)$ 平流。\n\n我们在一个双周期正方形域 $[0, 2\\pi) \\times [0, 2\\pi)$ 上求解这个系统，该域在一个均匀的 $N \\times N$ 网格上离散化。这种周期性使得傅里叶谱方法成为自然的选择。一个场 $f(x, y)$ 由其离散傅里叶级数表示：\n$$\nf(x_j, y_l) = \\sum_{k_x, k_y} \\hat{f}(k_x, k_y) e^{i(k_x x_j + k_y y_l)}\n$$\n其中 $(x_j, y_l)$ 是网格点，$(k_x, k_y)$ 是整数波数。离散傅里叶系数 $\\hat{f}(k_x, k_y)$ 使用快速傅里叶变换 (FFT) 高效计算。\n\n在这种谱表示中，空间导数变成代数乘法。例如，$\\partial f / \\partial x$ 的傅里叶变换是 $i k_x \\hat{f}(k_x, k_y)$。拉普拉斯算子 $\\nabla^2 = \\partial_x^2 + \\partial_y^2$ 由乘以 $-(k_x^2 + k_y^2) = -k^2$ 表示。$q$ 和 $\\phi$ 之间的关系在傅里叶空间中变成代数关系：\n$$\n\\hat{q}(k_x, k_y) = (-k^2 - 1)\\hat{\\phi}(k_x, k_y)\n$$\n这使我们能够很容易地从 $\\hat{q}$ 中找到 $\\hat{\\phi}$：\n$$\n\\hat{\\phi}(k_x, k_y) = -\\frac{\\hat{q}(k_x, k_y)}{k^2 + 1}\n$$\n请注意，对于实数波数，分母总是非零的。时间演化将在谱系数 $\\hat{q}(k_x, k_y, t)$ 上进行。\n\n非线性泊松括号项 $\\{\\phi,q\\} = \\frac{\\partial \\phi}{\\partial x}\\frac{\\partial q}{\\partial y} - \\frac{\\partial \\phi}{\\partial y}\\frac{\\partial q}{\\partial x}$ 以伪谱方式处理。这意味着导数在谱空间中计算，但乘积在实空间中进行。评估泊松括号 $\\mathcal{P} = \\{\\phi,q\\}$ 的过程如下：\n1.  计算四个所需导数的谱系数：$\\widehat{\\partial_x\\phi} = i k_x \\hat{\\phi}$、$\\widehat{\\partial_y\\phi} = i k_y \\hat{\\phi}$、$\\widehat{\\partial_xq} = i k_x \\hat{q}$ 和 $\\widehat{\\partial_yq} = i k_y \\hat{q}$。\n2.  使用逆 FFT (IFFT) 将这四个谱场变换回实空间网格。\n3.  在每个网格点上计算乘积 $\\partial_x \\phi \\cdot \\partial_y q$ 和 $\\partial_y \\phi \\cdot \\partial_x q$。\n4.  将它们相减，得到网格上的 $\\mathcal{P}(x, y)$。\n5.  使用正向 FFT 将 $\\mathcal{P}(x, y)$ 变换回谱空间，得到 $\\hat{\\mathcal{P}}(k_x, k_y)$。\n\n谱空间中的控制方程为：\n$$\n\\frac{d\\hat{q}}{dt} = -\\hat{\\mathcal{P}}(k_x, k_y)\n$$\n这个常微分方程组（每个模式 $(k_x, k_y)$ 一个）在时间上向前积分。我们使用显式四阶龙格-库塔 (RK4) 方法，因其稳定性和准确性。\n\n非线性项的伪谱计算会引入混叠误差。实空间中的乘积对应于谱空间中的卷积。对于有限网格，波数是周期性的，因此由卷积产生的高波数模式可能会被错误地表示为低波数模式，例如，模式 $k_x' = k_{x1} + k_{x2} > N/2$ 会混叠为 $k_x' - N$。这会污染解并可能违反守恒律。\n\n为防止这种情况，我们实现了 Orszag 的三分之二去混叠规则。这包括创建一个谱空间掩码，该掩码仅保留满足 $|k_x| \\le k_c$ 和 $|k_y| \\le k_c$（其中 $k_c = \\lfloor N/3 \\rfloor$）的模式。非线性项的去混叠计算过程如下：\n1.  给定 $\\hat{q}$，求出 $\\hat{\\phi}$。\n2.  在计算其导数之前，将去混叠掩码应用于 $\\hat{q}$ 和 $\\hat{\\phi}$。这有效地过滤了场，只保留了模式的内三分之二。\n3.  使用这些过滤后的场在实空间中计算泊松括号。\n4.  将得到的括号变换回谱空间。\n5.  再次将去混叠掩码应用于括号的谱表示 $\\hat{\\mathcal{P}}$，以移除由乘积产生的任何高波数分量。结果 $\\hat{\\mathcal{P}}_{dealiased}$ 是用于时间演化方程的去混叠右侧项。\n\nCHM 系统守恒总能量 $E$ 和拟涡能 $Z$。我们计算这些量以验证模拟的准确性。使用帕塞瓦尔定理，我们可以用谱系数表示空间平均值，这通常比实空间求和更准确。\n拟涡能为：\n$$\nZ = \\frac{1}{2}\\left\\langle |q|^2\\right\\rangle = \\frac{1}{2 N^4} \\sum_{k_x, k_y} |\\hat{q}(k_x, k_y)|^2\n$$\n能量为：\n$$\nE = \\frac{1}{2}\\left\\langle |\\nabla \\phi|^2 + |\\phi|^2\\right\\rangle = \\frac{1}{2 N^4} \\sum_{k_x, k_y} (k^2+1) |\\hat{\\phi}(k_x, k_y)|^2\n$$\n用 $\\hat{q}$ 表示 $\\hat{\\phi}$，我们得到一个方便的能量公式：\n$$\nE = \\frac{1}{2 N^4} \\sum_{k_x, k_y} \\frac{|\\hat{q}(k_x, k_y)|^2}{k^2+1}\n$$\n在 $t=0$ 和 $t=T$ 时计算这些量，以求出相对变化，这些变化是数值误差和去混叠有效性的指标。\n\n每个测试案例的模拟工作流程如下：\n1.  初始化 $N \\times N$ 网格、波数数组 `KX`、`KY` 和波数平方数组 `K2`。\n2.  在实空间网格上设置初始势 $\\phi(x,y,0)$ 为两个余弦函数的和。\n3.  通过对 $\\phi_0$ 进行 FFT 并应用关系 $\\hat{q} = -(k^2+1)\\hat{\\phi}$，计算初始谱位涡 $\\hat{q}_0$。\n4.  从 $\\hat{q}_0$ 计算初始不变量 $E_0$ 和 $Z_0$。\n5.  使用 RK4 步长在 $\\hat{q}$ 上从 $t=0$ 到 $t=T$ 进行时间迭代，在每个子步中使用标准或去混叠方案计算非线性项。\n6.  在最终时间 $T$，计算最终不变量 $E_T$ 和 $Z_T$。\n7.  计算并存储相对变化 $(E_T-E_0)/E_0$ 和 $(Z_T-Z_0)/Z_0$。\n然后将所有四个测试案例的结果格式化为所需的输出字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_invariants(q_hat, N, K2):\n    \"\"\"\n    Calculates energy and enstrophy in spectral space.\n    \"\"\"\n    # Z = 0.5 *|q|^2> = 0.5 * sum(|q_hat|^2) / N^4\n    Z = 0.5 * np.sum(np.abs(q_hat)**2) / (N**4)\n    \n    # E = 0.5 * |nabla phi|^2 + |phi|^2> = 0.5 * sum((k^2+1)|phi_hat|^2) / N^4\n    # phi_hat = -q_hat / (k^2+1)\n    # E = 0.5 * sum((k^2+1)|q_hat|^2 / (k^2+1)^2) / N^4 = 0.5 * sum(|q_hat|^2 / (k^2+1)) / N^4\n    E = 0.5 * np.sum(np.abs(q_hat)**2 / (K2 + 1)) / (N**4)\n    \n    return E, Z\n```"
        },
        {
            "introduction": "量化能量在不同尺度间的流动是湍流模拟的核心目标之一。本练习将指导您构建一个实用的诊断工具——谱能量通量——来精确测量这种能量流动。您将应用该工具比较简化的通量管模型与更真实的全局模拟，从而揭示磁约束装置的复杂几何结构如何深刻影响能量在谱空间中的级串过程 。",
            "id": "4197214",
            "problem": "您的任务是为聚变等离子体湍流模拟中的非线性能量转移设计并实现一种谱通量度量，该度量在磁通面坐标系中有一致的定义，然后用它来比较局域（磁通管）与全局托卡马克的情况。目标是从第一性原理出发构建该度量，指定一个可复现的离散公式，并为一组测试用例计算数值。除非另有明确说明，本问题中的所有量均为无量纲量，所有波数应解释为弧度/单位长度。\n\n从以下基础开始。考虑在单个环形磁通面上的二维、静电、无碰撞湍流，使用磁通面坐标系 $(x,y)$，其中 $x$ 代表一个局域类径向坐标，$y$ 代表一个副法向或类极向坐标。由静电势 $\\phi(x,y,t)$ 产生的 $\\boldsymbol{E}\\times\\boldsymbol{B}$ 速度平流的广义涡度场 $q(x,y,t)$ 的非线性动力学由守恒的泊松括号形式表示：\n$$\n\\partial_t q + \\{\\phi,q\\} = 0,\n$$\n其中泊松括号 $\\{a,b\\}$ 定义为\n$$\n\\{a,b\\} = \\partial_x a\\,\\partial_y b - \\partial_y a\\,\\partial_x b,\n$$\n空间导数是关于 $(x,y)$ 求的。广义涡度建模为\n$$\nq = -\\nabla\\cdot\\left(\\mathbf{G}(x)\\,\\nabla \\phi\\right) + \\alpha\\,\\phi,\n$$\n其中 $\\mathbf{G}(x)$ 是一个对称正定度规张量，它编码了磁通面坐标系中的垂直几何，此处限制为对角形式 $\\mathbf{G}(x)=\\mathrm{diag}(g_{xx}(x),g_{yy}(x))$，而 $\\alpha\\ge 0$ 是一个常数，代表极化或有限拉莫尔半径贡献。在磁通管（局域）近似中，$\\mathbf{G}$ 在整个区域内被视为常数，而在全局托卡马克表示中，$\\mathbf{G}$ 随 $x$ 变化。\n\n非线性动力学的守恒自由能密度为\n$$\n\\mathcal{E} = \\frac{1}{2}\\,\\phi\\,q,\n$$\n总自由能为 $E = \\int \\mathcal{E}\\,dA$，积分遍布面积为 $A=L_x L_y$ 的周期性区域。在上述非线性平流下，对于周期性边界，全局非线性能量变化为零，但非线性三波相互作用会在谱尺度上重新分配能量。将传递到傅里叶模 $\\boldsymbol{k}=(k_x,k_y)$ 的谱能量转移定义为\n$$\nT_{\\boldsymbol{k}} = -\\mathrm{Re}\\left[\\phi_{\\boldsymbol{k}}^*\\,J_{\\boldsymbol{k}}\\right],\n$$\n其中 $J=\\{\\phi,q\\}$，下标表示模 $\\boldsymbol{k}$ 处的傅里叶系数。跨越各向同性截断波数 $K_c$ 的谱通量则为\n$$\n\\Pi(K_c) = \\sum_{\\boldsymbol{k}: |\\boldsymbol{k}|_{\\mathrm{ref}}  K_c} T_{\\boldsymbol{k}},\n$$\n其中各向同性范数 $|\\boldsymbol{k}|_{\\mathrm{ref}}$ 由一个参考度规在磁通面坐标系中一致地定义，此处取为 $\\mathbf{G}_{\\mathrm{ref}}=\\mathrm{diag}(1,1)$，即\n$$\n|\\boldsymbol{k}|_{\\mathrm{ref}} = \\sqrt{k_x^2 + k_y^2}.\n$$\n\n您的任务是实现一个完整的程序，该程序：\n- 构建一个周期性区域，两个方向上的网格点数均为 $N_x=N_y=64$，长度均为 $L_x=L_y=2\\pi$。\n- 通过以下方式确定性地定义静电势场 $\\phi(x,y)$：\n$$\n\\phi(x,y) = A_1 \\cos(3x)\\cos(2y) + A_2 \\sin(4x + y) + A_3 \\cos(5y) + A_4 \\sin(2x - 3y),\n$$\n其中 $A_1=1.0$，$A_2=0.8$，$A_3=0.6$，$A_4=0.7$。\n- 使用 $\\alpha=0.5$。\n- 通过以下方式定义全局度规的变化：\n$$\ng_{xx}(x) = 1 + s \\cos(x),\\quad g_{yy}(x) = 1 - s \\cos(x),\n$$\n其中 $s\\in[0,1)$ 以确保正定性，并在磁通管情况下（$s=0$）使用常数值 $g_{xx}=g_{yy}=1$。\n- 通过使用谱精度周期性导数计算 $-\\partial_x\\left(g_{xx}(x)\\,\\partial_x \\phi\\right) - \\partial_y\\left(g_{yy}(x)\\,\\partial_y \\phi\\right) + \\alpha \\phi$ 来计算 $q(x,y)$。\n- 计算 $J(x,y)=\\{\\phi,q\\}$，将 $\\phi$ 和 $J$ 转换到傅里叶空间，并为指定的 $K_c$ 值计算模态转移 $T_{\\boldsymbol{k}}$ 和通量 $\\Pi(K_c)$。\n- 在所有情况下均使用一致的各向同性截断范数 $|\\boldsymbol{k}|_{\\mathrm{ref}} = \\sqrt{k_x^2 + k_y^2}$。\n\n为以下参数集 $(s,K_c)$ 的测试套件提供输出：\n1. $(0.0, 3.5)$：磁通管（局域）度规，中等截断。\n2. $(0.2, 3.5)$：弱变化的全局度规，相同截断。\n3. $(0.6, 3.5)$：强变化的全局度规，相同截断。\n4. $(0.0, 0.1)$：磁通管度规，接近零的截断（测试守恒性以及总非线性转移之和接近于零）。\n5. $(0.0, 100.0)$：磁通管度规，截断值高于所有可分辨的波数（空集，通量应为零）。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4,result5]”），每个结果是对应参数集的通量值 $\\Pi(K_c)$，四舍五入到六位小数。所有通量值都是无量纲的，必须以十进制浮点数报告。",
            "solution": "所提出的问题是等离子体物理与流体动力学领域一个定义明确的计算任务，具体涉及二维湍流模型中非线性能量转移的分析。该问题在科学上合理，数学上自洽，并为获得唯一解提供了所有必要信息。因此，它被认为是有效的。目标是，在不同的几何条件（即度规张量 $\\mathbf{G}(x)$ 的不同形式）下，为给定的静电势场 $\\phi(x,y)$ 计算谱能量通量 $\\Pi(K_c)$。该解法需要对空间导数和非线性项进行数值评估，鉴于周期性边界条件和谱精度的要求，伪谱法最为合适。\n\n计算步骤如下：\n\n1.  **离散化与谱表示**：\n    将连续空间域 $(x,y) \\in [0, L_x] \\times [0, L_y]$ 离散化到 $N_x \\times N_y$ 点的均匀笛卡尔网格上。一个物理场 $f(x,y)$ 由其在该网格上的值 $f_{jk} = f(x_j, y_k)$ 表示。由于指定的周期性，任何这样的场都可以通过离散傅里叶级数表示：\n    $$\n    f(x_j, y_l) = \\sum_{m=0}^{N_x-1} \\sum_{n=0}^{N_y-1} \\hat{f}_{mn} e^{i(k_x^{(m)} x_j + k_y^{(n)} y_l)}\n    $$\n    傅里叶系数 $\\hat{f}_{mn}$ 与离散傅里叶变换 (DFT) $F_{mn} = \\mathcal{F}[f_{jl}]$ 的关系为 $\\hat{f}_{mn} = F_{mn} / (N_x N_y)$。空间波数由 $k_x^{(m)} = 2\\pi m / L_x$（对于 $m \\in \\{-N_x/2, \\dots, N_x/2-1\\}$）和 $k_y^{(n)} = 2\\pi n / L_y$（对于 $n \\in \\{-N_y/2, \\dots, N_y/2-1\\}$）给出。给定 $L_x=L_y=2\\pi$，波数 $k_x$ 和 $k_y$ 取整数值。\n\n    空间导数通过谱方法计算。例如，$\\partial_x f(x,y)$ 的傅里叶变换是 $i k_x \\mathcal{F}[f]$。此操作通过对场进行快速傅里叶变换 (FFT)，在傅里叶空间中乘以相应的 $i k_x$ 或 $i k_y$ 矩阵，然后执行逆 FFT 来完成。\n\n2.  **广义涡度 $q$ 的计算**：\n    广义涡度定义为 $q = -\\nabla\\cdot\\left(\\mathbf{G}(x)\\,\\nabla \\phi\\right) + \\alpha\\,\\phi$。给定对角度规 $\\mathbf{G}(x)=\\mathrm{diag}(g_{xx}(x),g_{yy}(x))$，这展开为：\n    $$\n    q(x,y) = -\\partial_x\\left(g_{xx}(x)\\,\\partial_x \\phi\\right) - \\partial_y\\left(g_ {yy}(x)\\,\\partial_y \\phi\\right) + \\alpha\\,\\phi\n    $$\n    度规分量 $g_{xx}$ 和 $g_{yy}$ 的空间依赖性阻止了 $q$ 和 $\\phi$ 的傅里叶系数之间存在简单的乘法关系。我们必须采用伪谱法：\n    a.  在傅里叶空间中通过谱方法计算梯度 $\\partial_x \\phi$ 和 $\\partial_y \\phi$，并将结果变换回实空间。\n        - $\\mathcal{F}[\\partial_x \\phi] = i k_x \\mathcal{F}[\\phi]$\n        - $\\mathcal{F}[\\partial_y \\phi] = i k_y \\mathcal{F}[\\phi]$\n    b.  在实空间中，执行与度规分量的乘法：\n        - 令 $v_x(x,y) = g_{xx}(x)\\,\\partial_x \\phi(x,y)$\n        - 令 $v_y(x,y) = g_{yy}(x)\\,\\partial_y \\phi(x,y)$\n    c.  通过谱方法计算矢量场 $(v_x, v_y)$ 的散度。\n        - $\\mathcal{F}[\\partial_x v_x] = i k_x \\mathcal{F}[v_x]$\n        - $\\mathcal{F}[\\partial_y v_y] = i k_y \\mathcal{F}[v_y]$\n    d.  在傅里叶空间中组合各项以找到 $q$ 的傅里叶系数：\n        $$\n        \\mathcal{F}[q] = - ( i k_x \\mathcal{F}[v_x] + i k_y \\mathcal{F}[v_y] ) + \\alpha \\mathcal{F}[\\phi]\n        $$\n    这提供了 $\\mathcal{F}[q]$，即涡度场的傅里叶表示。\n\n3.  **非线性项 $J = \\{\\phi, q\\}$ 的计算**：\n    泊松括号 $J = \\{\\phi,q\\} = \\partial_x \\phi\\,\\partial_y q - \\partial_y \\phi\\,\\partial_x q$ 也使用伪谱方法计算。这种非线性是二次的，其评估涉及场的乘积，这在实空间中计算效率最高。\n    a.  通过谱方法计算所有所需空间导数：$\\partial_x \\phi$、$\\partial_y \\phi$、$\\partial_x q$ 和 $\\partial_y q$。这些是通过将 $\\mathcal{F}[\\phi]$ 和 $\\mathcal{F}[q]$ 乘以它们各自的 $i\\boldsymbol{k}$ 向量后，变换回实空间得到的。\n    b.  在实空间中，计算乘积：$(\\partial_x \\phi)(\\partial_y q)$ 和 $(\\partial_y \\phi)(\\partial_x q)$。\n    c.  在实空间中减去两个结果场以获得 $J(x,y)$。\n\n4.  **谱通量 $\\Pi(K_c)$ 的计算**：\n    最后一步是计算谱通量 $\\Pi(K_c) = \\sum_{\\boldsymbol{k}: |\\boldsymbol{k}|_{\\mathrm{ref}}  K_c} T_{\\boldsymbol{k}}$。\n    a.  首先，获得 $J$ 的傅里叶系数，记为 $J_{\\boldsymbol{k}}$。这是通过对实空间场 $J(x,y)$ 进行 FFT 并正确归一化来完成的：$J_{\\boldsymbol{k}} = \\mathcal{F}[J] / (N_x N_y)$。类似地，系数 $\\phi_{\\boldsymbol{k}}$ 从 $\\mathcal{F}[\\phi]$ 获得。\n    b.  为每个波数矢量 $\\boldsymbol{k}=(k_x, k_y)$ 计算模态能量转移：\n        $$\n        T_{\\boldsymbol{k}} = -\\mathrm{Re}\\left[\\phi_{\\boldsymbol{k}}^*\\,J_{\\boldsymbol{k}}\\right]\n        $$\n        使用 DFT 输出 $F_\\phi = \\mathcal{F}[\\phi]$ 和 $F_J = \\mathcal{F}[J]$，这变为：\n        $$\n        T_{\\boldsymbol{k}} = -\\frac{1}{(N_x N_y)^2} \\mathrm{Re}\\left[F_{\\phi, \\boldsymbol{k}}^* F_{J, \\boldsymbol{k}}\\right]\n        $$\n    c.  构建参考波数大小的网格 $|\\boldsymbol{k}|_{\\mathrm{ref}} = \\sqrt{k_x^2 + k_y^2}$。\n    d.  识别所有满足条件 $|\\boldsymbol{k}|_{\\mathrm{ref}}  K_c$ 的模 $\\boldsymbol{k}$。\n    e.  将所有已识别模的 $T_{\\boldsymbol{k}}$ 值相加以获得谱通量 $\\Pi(K_c)$。\n\n    所提供的测试用例用于探究几何变化（参数 $s$）对非线性能量级串的影响，并验证计算的基本属性，例如能量守恒（这意味着 $\\sum_{\\boldsymbol{k}} T_{\\boldsymbol{k}} \\approx 0$）和在极端截断值下的行为。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_flux(s, Kc, Nx, Ny, Lx, Ly, alpha, A1, A2, A3, A4):\n    \"\"\"\n    Computes the spectral flux for a given set of parameters.\n    \"\"\"\n    \n    # 1. Grid and Wavenumber Setup\n    x = np.linspace(0, Lx, Nx, endpoint=False)\n    y = np.linspace(0, Ly, Ny, endpoint=False)\n    xx, yy = np.meshgrid(x, y, indexing='ij')\n\n    kx_vec = 2 * np.pi * np.fft.fftfreq(Nx, d=Lx / Nx)\n    ky_vec = 2 * np.pi * np.fft.fftfreq(Ny, d=Ly / Ny)\n    kx, ky = np.meshgrid(kx_vec, ky_vec, indexing='ij')\n\n    # 2. Define initial field and metric\n    phi = (A1 * np.cos(3 * xx) * np.cos(2 * yy) +\n           A2 * np.sin(4 * xx + yy) +\n           A3 * np.cos(5 * yy) +\n           A4 * np.sin(2 * xx - 3 * yy))\n\n    gxx = 1.0 + s * np.cos(xx)\n    gyy = 1.0 - s * np.cos(xx) # Note: gyy also depends on x, not y\n\n    # 3. Compute Generalized Vorticity q using pseudo-spectral method\n    phi_k = np.fft.fftn(phi)\n\n    # a. Compute derivatives of phi\n    dphidx_k = 1j * kx * phi_k\n    dphidy_k = 1j * ky * phi_k\n    dphidx = np.real(np.fft.ifftn(dphidx_k))\n    dphidy = np.real(np.fft.ifftn(dphidy_k))\n\n    # b. Multiply by metric in real space\n    term_x = gxx * dphidx\n    term_y = gyy * dphidy\n\n    # c. Compute divergence of the result\n    term_x_k = np.fft.fftn(term_x)\n    term_y_k = np.fft.fftn(term_y)\n\n    d_term_x_dx_k = 1j * kx * term_x_k\n    d_term_y_dy_k = 1j * ky * term_y_k\n\n    # d. Combine terms in Fourier space to get q_k\n    q_k = -(d_term_x_dx_k + d_term_y_dy_k) + alpha * phi_k\n\n    # 4. Compute Nonlinear Term J = {phi, q}\n    # a. Compute derivatives of q\n    dqdx_k = 1j * kx * q_k\n    dqdy_k = 1j * ky * q_k\n    dqdx = np.real(np.fft.ifftn(dqdx_k))\n    dqdy = np.real(np.fft.ifftn(dqdy_k))\n\n    # b. Compute Poisson bracket in real space\n    J = dphidx * dqdy - dphidy * dqdx\n\n    # 5. Compute Spectral Flux Pi(Kc)\n    # a. Get FFT of J\n    J_k = np.fft.fftn(J)\n\n    # b. Compute modal energy transfer T_k\n    # Normalization for physical Fourier coefficients: FFT / N_total\n    N_total = Nx * Ny\n    # T_k = -Re(phi_k_coeff* . J_k_coeff)\n    # T_k = -Re( (phi_k/N_total)* . (J_k/N_total) )\n    T_k = -np.real(np.conj(phi_k) * J_k) / (N_total**2)\n\n    # c. Construct wavenumber magnitude grid\n    k_mag_sq = kx**2 + ky**2\n    \n    # d. Create mask for wavenumbers > Kc\n    mask = k_mag_sq > Kc**2\n\n    # e. Sum T_k over the mask\n    Pi_Kc = np.sum(T_k[mask])\n\n    return Pi_Kc\n\ndef solve():\n    \"\"\"\n    Main function to run the specified test cases and print results.\n    \"\"\"\n    # Define problem parameters\n    Nx, Ny = 64, 64\n    Lx, Ly = 2 * np.pi, 2 * np.pi\n    alpha = 0.5\n    A1, A2, A3, A4 = 1.0, 0.8, 0.6, 0.7\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.0, 3.5),   # 1. flux-tube (local) metric, moderate cutoff.\n        (0.2, 3.5),   # 2. global metric with weak variation, same cutoff.\n        (0.6, 3.5),   # 3. global metric with strong variation, same cutoff.\n        (0.0, 0.1),   # 4. flux-tube metric, near-zero cutoff.\n        (0.0, 100.0)  # 5. flux-tube metric, cutoff above all resolved wavenumbers.\n    ]\n\n    results = []\n    for s, Kc in test_cases:\n        flux = compute_flux(s, Kc, Nx, Ny, Lx, Ly, alpha, A1, A2, A3, A4)\n        results.append(flux)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}