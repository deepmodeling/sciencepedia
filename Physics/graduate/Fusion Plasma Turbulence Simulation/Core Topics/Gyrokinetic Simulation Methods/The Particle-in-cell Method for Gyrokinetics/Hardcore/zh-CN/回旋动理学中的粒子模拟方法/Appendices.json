{
    "hands_on_practices": [
        {
            "introduction": "一次成功的“单元内粒子”（PIC）模拟始于在相空间中正确地初始化粒子。本实践深入探讨了回旋动理学的基本原理，要求您使用恰当的非正则相空间测度来正确归一化一个分布函数。掌握此计算能够确保您的模拟从一个物理上自洽的状态开始，这是任何有效数值研究都必须迈出的关键第一步。",
            "id": "4205894",
            "problem": "考虑在用于回旋动理学质点网格法(PIC)聚变等离子体湍流模拟的板状几何中，一种质量为 $m$、电荷为 $q$ 的单一离子。设背景磁场大小恒为 $B_0$，单位矢量为 $\\boldsymbol{b}(\\boldsymbol{R})$，满足 $\\boldsymbol{b} \\cdot \\nabla \\times \\boldsymbol{b} = \\tau$，其中 $\\tau$ 是一个常数（扭率），并假设处于静电极限，没有变化的矢量势。回旋中心相空间测度为 $d^3 R \\, 2\\pi \\, d\\mu \\, dv_{\\parallel} \\, B^{\\star}_{\\parallel}/m$，其中 $B^{\\star}_{\\parallel}$ 是由导心变换产生的修正磁场 $\\boldsymbol{B}^{\\star}$ 的平行分量。\n\n假设平衡回旋中心分布函数在 $\\boldsymbol{R}$ 上空间均匀，并且在 $\\mu$ 和 $v_{\\parallel}$ 上是可分离的，\n$$\nf_{\\mathrm{gc}}(\\boldsymbol{R},\\mu,v_{\\parallel}) = C \\, \\exp\\!\\left(-\\frac{m v_{\\parallel}^{2}}{2 T} - \\frac{\\mu B_0}{T}\\right),\n$$\n其中归一化常数 $C$、温度 $T$ 和目标常数数密度 $n_0$ 未知。仅使用基本原理（相空间体积守恒和导心的正确非正则雅可比），要求每个 $\\boldsymbol{R}$ 处的物理数密度满足\n$$\nn_0 \\;=\\; \\int_{-\\infty}^{\\infty} dv_{\\parallel} \\int_{0}^{\\infty} 2\\pi \\, d\\mu \\, \\frac{B^{\\star}_{\\parallel}}{m} \\, f_{\\mathrm{gc}}(\\boldsymbol{R},\\mu,v_{\\parallel}).\n$$\n\n从导心非正则哈密顿结构和刘维尔定理出发，确定此几何下的 $B^{\\star}_{\\parallel}$，并计算 $C$ 的闭式解析表达式，使得上述密度约束被精确满足。最后，解释 $B^{\\star}_{\\parallel}$ 在PIC中回旋中心相空间采样中的作用，并论证其依赖于 $v_{\\parallel}$ 的部分是否影响给定平衡下 $C$ 的值。最终答案必须是 $C$ 的单一解析表达式。无需数值舍入。",
            "solution": "用于回旋动理学的质点网格法(PIC)通过从正确的相空间测度中采样的离散标记点和权重来表示回旋中心分布。对于导心，由于从粒子坐标到回旋中心坐标的变换，其自然相空间测度是非正则的。基本出发点是导心相空间拉格朗日量和刘维尔定理，它们共同表明，当使用正确的雅可比因子书写时，相空间体积元在动力学演化下是守恒的。在回旋中心坐标 $(\\boldsymbol{R}, \\mu, v_{\\parallel}, \\theta)$ 中，其中 $\\boldsymbol{R}$ 是回旋中心位置，$\\mu$ 是磁矩，$v_{\\parallel}$ 是平行速度，$\\theta$ 是回旋相位，其不变测度为\n$$\nd^3 R \\, 2\\pi \\, d\\mu \\, dv_{\\parallel} \\, \\frac{B^{\\star}_{\\parallel}}{m},\n$$\n其中 $2\\pi$ 来自对回旋相位角 $\\theta$ 的积分，$B^{\\star}_{\\parallel}$ 是回旋中心雅可比因子，它确保了非正则变量下相空间体积的守恒。\n\n根据导心理论，修正磁场为\n$$\n\\boldsymbol{B}^{\\star} = \\boldsymbol{B} + \\frac{m v_{\\parallel}}{q} \\nabla \\times \\boldsymbol{b},\n$$\n其平行分量为\n$$\nB^{\\star}_{\\parallel} = \\boldsymbol{b} \\cdot \\boldsymbol{B}^{\\star} = B + \\frac{m v_{\\parallel}}{q} \\, \\boldsymbol{b} \\cdot \\nabla \\times \\boldsymbol{b}.\n$$\n在给定几何中，$B(\\boldsymbol{R}) = B_0$ 是常数，$\\boldsymbol{b} \\cdot \\nabla \\times \\boldsymbol{b} = \\tau$ 也是常数，因此\n$$\nB^{\\star}_{\\parallel}(v_{\\parallel}) = B_0 + \\frac{m v_{\\parallel}}{q} \\, \\tau.\n$$\n\n平衡回旋中心分布函数指定为\n$$\nf_{\\mathrm{gc}}(\\boldsymbol{R},\\mu,v_{\\parallel}) = C \\, \\exp\\!\\left(-\\frac{m v_{\\parallel}^{2}}{2 T} - \\frac{\\mu B_0}{T}\\right),\n$$\n其中 $C$ 待定，以满足数密度约束：\n$$\nn_0 = \\int_{-\\infty}^{\\infty} dv_{\\parallel} \\int_{0}^{\\infty} 2\\pi \\, d\\mu \\, \\frac{B^{\\star}_{\\parallel}(v_{\\parallel})}{m} \\, C \\, \\exp\\!\\left(-\\frac{m v_{\\parallel}^{2}}{2 T} - \\frac{\\mu B_0}{T}\\right).\n$$\n代入 $B^{\\star}_{\\parallel}(v_{\\parallel})$：\n$$\nn_0 = \\int_{-\\infty}^{\\infty} dv_{\\parallel} \\int_{0}^{\\infty} 2\\pi \\, d\\mu \\, \\frac{1}{m} \\left(B_0 + \\frac{m v_{\\parallel}}{q} \\tau\\right) C \\, \\exp\\!\\left(-\\frac{m v_{\\parallel}^{2}}{2 T} - \\frac{\\mu B_0}{T}\\right).\n$$\n将积分分为两部分：\n$$\nn_0 = \\frac{2\\pi C}{m} \\left[ B_0 \\int_{-\\infty}^{\\infty} dv_{\\parallel} \\exp\\!\\left(-\\frac{m v_{\\parallel}^{2}}{2 T}\\right) \\int_{0}^{\\infty} d\\mu \\, \\exp\\!\\left(-\\frac{\\mu B_0}{T}\\right) \\right. \\\\\n\\left. + \\frac{m \\tau}{q} \\int_{-\\infty}^{\\infty} dv_{\\parallel} \\, v_{\\parallel} \\exp\\!\\left(-\\frac{m v_{\\parallel}^{2}}{2 T}\\right) \\int_{0}^{\\infty} d\\mu \\, \\exp\\!\\left(-\\frac{\\mu B_0}{T}\\right) \\right].\n$$\n计算关于 $\\mu$ 的积分：\n$$\n\\int_{0}^{\\infty} d\\mu \\, \\exp\\!\\left(-\\frac{\\mu B_0}{T}\\right) = \\frac{T}{B_0}.\n$$\n计算关于 $v_{\\parallel}$ 的高斯积分。偶函数高斯积分为\n$$\n\\int_{-\\infty}^{\\infty} dv_{\\parallel} \\exp\\!\\left(-\\frac{m v_{\\parallel}^{2}}{2 T}\\right) = \\sqrt{\\frac{2\\pi T}{m}},\n$$\n而奇函数高斯积分为零：\n$$\n\\int_{-\\infty}^{\\infty} dv_{\\parallel} \\, v_{\\parallel} \\exp\\!\\left(-\\frac{m v_{\\parallel}^{2}}{2 T}\\right) = 0.\n$$\n因此，\n$$\nn_0 = \\frac{2\\pi C}{m} \\left[ B_0 \\, \\sqrt{\\frac{2\\pi T}{m}} \\, \\frac{T}{B_0} + \\frac{m \\tau}{q} \\cdot 0 \\cdot \\frac{T}{B_0} \\right] = \\frac{2\\pi C}{m} \\, \\sqrt{\\frac{2\\pi T}{m}} \\, T.\n$$\n于是，\n$$\nn_0 = 2\\pi C \\, \\frac{T}{m} \\, \\sqrt{\\frac{2\\pi T}{m}}.\n$$\n解出 $C$：\n$$\nC = \\frac{n_0}{2\\pi} \\, \\frac{m}{T} \\left(\\frac{m}{2\\pi T}\\right)^{\\frac{1}{2}} = n_0 \\left(\\frac{m}{2\\pi T}\\right)^{\\frac{3}{2}}.\n$$\n\n此结果与结合了正确的非正则雅可比后，用回旋中心不变量表示的常规麦克斯韦分布归一化相符。$B^{\\star}_{\\parallel}$ 的作用是在非正则导心坐标中提供正确的相空间雅可比，确保刘维尔不变性，从而保证PIC采样中密度和矩计算的正确性。在此几何中，$B^{\\star}_{\\parallel} = B_0 + (m v_{\\parallel}/q)\\tau$ 包含一个依赖于 $v_{\\parallel}$ 的项，该项是关于 $v_{\\parallel}$ 的奇函数。对于一个关于 $v_{\\parallel}$ 是偶函数的各向同性平衡麦克斯韦分布，该奇函数贡献的积分为零，因此它不影响归一化常数 $C$。然而，对于非对称分布（例如，带有平行漂移的分布），$B^{\\star}_{\\parallel}$ 中依赖于 $v_{\\parallel}$ 的部分会对矩产生贡献，必须保留以避免在采样和诊断中产生偏差。在所有情况下，将 $B^{\\star}_{\\parallel}$ 包含在测度中对于物理上一致的回旋中心相空间PIC采样至关重要。",
            "answer": "$$\\boxed{n_0\\left(\\frac{m}{2\\pi T}\\right)^{\\frac{3}{2}}}$$"
        },
        {
            "introduction": "在实现核心算法之后，验证其物理保真度至关重要。本动手编程练习聚焦于最基本的守恒律之一：能量守恒。您将实现一个数值诊断工具，以确认粒子与静电场之间的能量交换与场能量的变化精确平衡，这是任何静电 PIC 模拟的关键验证测试。",
            "id": "4205831",
            "problem": "要求您设计并实现一种数值诊断工具，用于检验一维长波长极限下静电回旋动理学粒子模拟（PIC）方法中的能量守恒。目标是计算单个时间步长内粒子与场之间的能量交换，并验证净交换量与场能量的变化量相匹配，其中使用的离散化方案需能反映回旋动理学中的极化物理。您的程序必须针对一个指定的测试套件产生结果，并将它们汇总成单行输出。\n\n从以下基本理论出发：\n\n- 长波长回旋动理学极限下的静电学，满足准中性与极化条件：由粒子产生的自由电荷密度（记为 $\\rho_{\\mathrm{free}}(x,t)$）和极化电荷密度（记为 $\\rho_{\\mathrm{pol}}(x,t)$）满足 $\\rho_{\\mathrm{free}}(x,t) + \\rho_{\\mathrm{pol}}(x,t) = 0$。\n- 极化电荷密度模型为 $\\rho_{\\mathrm{pol}}(x,t) = -\\epsilon \\,\\partial_x^2 \\phi(x,t)$，其中 $\\phi(x,t)$ 是静电势，$\\epsilon$ 是一个常数，代表归一化单位下的长波长极化系数 $\\epsilon = n_0 m_i/B^2$。\n- 静电场能量为 $W_{\\mathrm{field}}(t) = \\dfrac{1}{2} \\int \\epsilon \\left(\\partial_x \\phi(x,t)\\right)^2 \\, dx$。\n- 在此静电回旋动理学模型中，根据能量守恒，粒子与场之间的能量交换率遵循：$\\dfrac{d}{dt} W_{\\mathrm{field}}(t) + \\int \\rho_{\\mathrm{free}}(x,t) \\,\\partial_t \\phi(x,t)\\, dx = 0$。\n\n按如下方式对区域、算子和时间间隔进行离散化：\n\n- 使用长度为 $L$ 的一维周期性区域，包含 $N$ 个点的均匀网格，格点间距为 $\\Delta x = L/N$。\n- 用数组 $\\phi^n_i$ 和 $\\phi^{n+1}_i$（其中 $i = 0,1,\\dots,N-1$）表示在两个连续时间点 $t^n$ 和 $t^{n+1}$ 的网格上的场。\n- 使用前向差分计算空间梯度：\n  $$\n  D_+ \\phi_i = \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x},\n  $$\n  其中下标运算是周期性的（例如，$\\phi_N \\equiv \\phi_0$）。\n- 使用后向差分计算散度：\n  $$\n  D_- \\phi_i = \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x}.\n  $$\n- 使用由 $D_- D_+$ 构成的二阶中心拉普拉斯算子：\n  $$\n  \\partial_x^2 \\phi_i \\approx \\frac{\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}}{\\Delta x^2}.\n  $$\n- 将空间积分近似为离散求和：$\\int f(x)\\,dx \\approx \\sum_i f_i \\,\\Delta x$。\n- 使用梯形法则近似时间中点：定义 $\\phi^{\\mathrm{avg}}_i = \\dfrac{1}{2}(\\phi^n_i + \\phi^{n+1}_i)$ 和 $\\rho_{\\mathrm{free}}^{\\mathrm{avg}}_i = \\dfrac{1}{2}(\\rho_{\\mathrm{free}}^n{}_i + \\rho_{\\mathrm{free}}^{n+1}{}_i)$。利用准中性条件从场中获得自由电荷：$\\rho_{\\mathrm{free}}^n{}_i = \\epsilon \\,\\partial_x^2 \\phi^n_i$ 以及 $\\rho_{\\mathrm{free}}^{n+1}{}_i = \\epsilon \\,\\partial_x^2 \\phi^{n+1}_i$。\n\n根据这些定义，计算单个时间步长内的以下量：\n\n- 粒子-场能量交换：\n  $$\n  Q_{\\mathrm{part}} = -\\sum_{i=0}^{N-1} \\rho_{\\mathrm{free}}^{\\mathrm{avg}}{}_i \\left(\\phi^{n+1}_i - \\phi^n_i\\right)\\,\\Delta x.\n  $$\n- 场能量的变化：\n  $$\n  \\Delta W_{\\mathrm{field}} = W_{\\mathrm{field}}^{n+1} - W_{\\mathrm{field}}^{n} = \\frac{1}{2}\\epsilon \\sum_{i=0}^{N-1} \\left[\\left(D_+ \\phi^{n+1}_i\\right)^2 - \\left(D_+ \\phi^{n}_i\\right)^2\\right] \\Delta x.\n  $$\n\n对每个测试用例，计算绝对不匹配量\n$$\nM = \\left| Q_{\\mathrm{part}} - \\Delta W_{\\mathrm{field}} \\right|\n$$\n。在精确算术下，对于指定的离散化和周期性边界条件，由于存在离散分部积分恒等式，$M$ 的值应该极小。\n\n整个过程使用归一化单位，因此无需进行物理单位转换。所有角度必须以弧度为单位。\n\n实现以下测试套件。对于每个用例，构建网格 $x_i = i\\,\\Delta x$（其中 $i=0,1,\\dots,N-1$，$\\Delta x = L/N$），并按下述方式明确定义 $\\phi^n_i$ 和 $\\phi^{n+1}_i$。\n\n- 用例 1（平滑单模，振幅变化）：\n  - $N = 128$，$L = 2\\pi$，$\\epsilon = 1$。\n  - $k = 2$，$A = 0.3$，$\\delta A = 0.01$。\n  - $\\phi^n_i = A \\,\\sin(k x_i)$，$\\phi^{n+1}_i = (A + \\delta A)\\,\\sin(k x_i)$。\n- 用例 2（无变化，精确为零）：\n  - $N = 128$，$L = 2\\pi$，$\\epsilon = 1$。\n  - $k = 4$，$A = 0.25$。\n  - $\\phi^n_i = A \\,\\sin(k x_i)$，$\\phi^{n+1}_i = A \\,\\sin(k x_i)$。\n- 用例 3（双模组合，振幅和相位均有变化）：\n  - $N = 256$，$L = 2\\pi$，$\\epsilon = 0.5$。\n  - $k_1 = 3$，$k_2 = 5$，$A_1 = 0.2$，$A_2 = 0.1$，$A_1' = 0.205$，$A_2' = 0.095$，$\\delta\\varphi_1 = 0.02$，$\\delta\\varphi_2 = -0.015$。\n  - $\\phi^n_i = A_1 \\,\\sin(k_1 x_i) + A_2 \\,\\cos(k_2 x_i)$，\n    $\\phi^{n+1}_i = A_1' \\,\\sin(k_1 x_i + \\delta\\varphi_1) + A_2' \\,\\cos(k_2 x_i + \\delta\\varphi_2)$。\n- 用例 4（奈奎斯特模式，网格尺度振荡）：\n  - $N = 64$，$L = 2\\pi$，$\\epsilon = 1$。\n  - $k_{\\mathrm{nyq}} = N/2$（整数），$A = 0.1$，$A' = 0.11$。\n  - $\\phi^n_i = A \\,\\cos(k_{\\mathrm{nyq}}\\, x_i)$，$\\phi^{n+1}_i = A' \\,\\cos(k_{\\mathrm{nyq}}\\, x_i)$。\n\n您的程序应为每个用例计算 $M$，并生成一行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，$[m_1,m_2,m_3,m_4]$）。这些值应为实数（浮点数）。三角函数中使用的角度必须是弧度，网格必须严格按照规定使用周期性边界条件。程序运行时不提供输入；测试套件的所有参数都必须硬编码在程序中。",
            "solution": "本问题已经过验证。\n\n### 步骤 1：提取已知条件\n\n- **物理模型**：\n    - 准中性：$\\rho_{\\mathrm{free}}(x,t) + \\rho_{\\mathrm{pol}}(x,t) = 0$。\n    - 极化电荷密度：$\\rho_{\\mathrm{pol}}(x,t) = -\\epsilon \\,\\partial_x^2 \\phi(x,t)$。\n    - 由上可知，自由电荷密度为 $\\rho_{\\mathrm{free}}(x,t) = \\epsilon \\,\\partial_x^2 \\phi(x,t)$。\n    - 静电场能量：$W_{\\mathrm{field}}(t) = \\dfrac{1}{2} \\int \\epsilon \\left(\\partial_x \\phi(x,t)\\right)^2 \\, dx$。\n    - 能量守恒定律：$\\dfrac{d}{dt} W_{\\mathrm{field}}(t) + \\int \\rho_{\\mathrm{free}}(x,t) \\,\\partial_t \\phi(x,t)\\, dx = 0$。\n\n- **数值离散化**：\n    - 区域：一维、周期性，长度为 $L$，有 $N$ 个网格点，间距为 $\\Delta x = L/N$。\n    - $t^n$ 和 $t^{n+1}$ 时刻的场：$\\phi^n_i, \\phi^{n+1}_i$，其中 $i \\in \\{0, 1, \\dots, N-1\\}$。\n    - 前向差分梯度：$D_+ \\phi_i = (\\phi_{i+1} - \\phi_i)/\\Delta x$。\n    - 后向差分散度：$D_- \\phi_i = (\\phi_i - \\phi_{i-1})/\\Delta x$。\n    - 中心拉普拉斯算子：$\\partial_x^2 \\phi_i \\approx D_- D_+ \\phi_i = (\\phi_{i+1} - 2\\phi_i + \\phi_{i-1})/\\Delta x^2$。\n    - 空间积分：$\\int f(x)\\,dx \\approx \\sum_i f_i \\,\\Delta x$。\n    - 时间中心化：$\\phi^{\\mathrm{avg}}_i = \\frac{1}{2}(\\phi^n_i + \\phi^{n+1}_i)$，$\\rho_{\\mathrm{free}}^{\\mathrm{avg}}_i = \\frac{1}{2}(\\rho_{\\mathrm{free}}^n{}_i + \\rho_{\\mathrm{free}}^{n+1}{}_i)$，其中 $\\rho_{\\mathrm{free}}^k{}_i = \\epsilon (D_-D_+ \\phi^k_i)$。\n\n- **待计算量**：\n    - 单个时间步长内的粒子-场能量交换：$Q_{\\mathrm{part}} = -\\sum_{i=0}^{N-1} \\rho_{\\mathrm{free}}^{\\mathrm{avg}}{}_i \\left(\\phi^{n+1}_i - \\phi^n_i\\right)\\,\\Delta x$。\n    - 单个时间步长内的场能量变化：$\\Delta W_{\\mathrm{field}} = \\frac{1}{2}\\epsilon \\sum_{i=0}^{N-1} \\left[\\left(D_+ \\phi^{n+1}_i\\right)^2 - \\left(D_+ \\phi^{n}_i\\right)^2\\right] \\Delta x$。\n    - 绝对不匹配量：$M = \\left| Q_{\\mathrm{part}} - \\Delta W_{\\mathrm{field}} \\right|$。\n\n- **测试套件**：\n    - **用例 1**：$N = 128$，$L = 2\\pi$，$\\epsilon = 1$，$k = 2$，$A = 0.3$，$\\delta A = 0.01$。$\\phi^n_i = A \\sin(k x_i)$，$\\phi^{n+1}_i = (A + \\delta A) \\sin(k x_i)$。\n    - **用例 2**：$N = 128$，$L = 2\\pi$，$\\epsilon = 1$，$k = 4$，$A = 0.25$。$\\phi^n_i = A \\sin(k x_i)$，$\\phi^{n+1}_i = A \\sin(k x_i)$。\n    - **用例 3**：$N = 256$，$L = 2\\pi$，$\\epsilon = 0.5$，$k_1 = 3$，$k_2 = 5$，$A_1 = 0.2$，$A_2 = 0.1$，$A_1' = 0.205$，$A_2' = 0.095$，$\\delta\\varphi_1 = 0.02$，$\\delta\\varphi_2 = -0.015$。$\\phi^n_i = A_1 \\sin(k_1 x_i) + A_2 \\cos(k_2 x_i)$，$\\phi^{n+1}_i = A_1' \\sin(k_1 x_i + \\delta\\varphi_1) + A_2' \\cos(k_2 x_i + \\delta\\varphi_2)$。\n    - **用例 4**：$N = 64$，$L = 2\\pi$，$\\epsilon = 1$，$k_{\\mathrm{nyq}} = N/2=32$，$A = 0.1$，$A' = 0.11$。$\\phi^n_i = A \\cos(k_{\\mathrm{nyq}} x_i)$，$\\phi^{n+1}_i = A' \\cos(k_{\\mathrm{nyq}} x_i)$。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n该问题具有科学依据，是适定的、客观的。\n1.  **科学合理性**：该问题描述了一个标准的（尽管是简化的）一维静电回旋动理学模型。所提供的准中性、极化、场能量和能量守恒方程是该模型长波长极限的正确表示。有限差分格式是离散化微分算子的标准方法。\n2.  **可形式化**：该问题用精确的数学定义和算法要求来表达，使其完全可以形式化。\n3.  **完整性**：测试用例的所有必要参数和函数形式都已明确提供。定义是自洽的。\n4.  **真实性**：这些参数定义了一个数值实验，并且在模拟的背景下是物理上可信的。\n5.  **适定结构**：该问题要求计算一个特定的数值——不匹配量 $M$，它由所提供的输入和公式唯一确定。对于这种特定的离散化，$M$ 应该接近于零，这一基本前提是能量守恒数值格式的一个众所周知的性质。\n6.  **非平凡性**：该问题要求仔细实现离散微积分，并理解连续守恒定律如何转化为离散系统。这并非易事。\n7.  **可验证性**：结果可以通过实现所述算法进行计算验证。\n\n### 步骤 3：结论与行动\n\n问题陈述是**有效的**。将提供一个解决方案。\n\n---\n\n目标是为一个特定的数值格式验证离散能量守恒定律。该定律指出，在单个时间步长内，粒子与静电场之间交换的能量 $Q_{\\mathrm{part}}$，应等于场中存储的总能量的变化量 $\\Delta W_{\\mathrm{field}}$。问题为这些量提供了离散定义，我们必须证明它们确实相等（在浮点精度范围内）。\n\n需要比较的两个量是：\n1.  能量交换, $Q_{\\mathrm{part}} = -\\sum_{i=0}^{N-1} \\rho_{\\mathrm{free}}^{\\mathrm{avg}}{}_i \\left(\\phi^{n+1}_i - \\phi^n_i\\right)\\,\\Delta x$。\n2.  场能量的变化, $\\Delta W_{\\mathrm{field}} = \\frac{1}{2}\\epsilon \\sum_{i=0}^{N-1} \\left[\\left(D_+ \\phi^{n+1}_i\\right)^2 - \\left(D_+ \\phi^{n}_i\\right)^2\\right] \\Delta x$。\n\n我们现在将从代数上证明，所选的离散化方案确保了 $Q_{\\mathrm{part}} = \\Delta W_{\\mathrm{field}}$。\n\n自由电荷由 $\\rho_{\\mathrm{free}} = \\epsilon \\partial_x^2\\phi$ 给出。网格点 $i$ 上的时间平均自由电荷密度离散化为：\n$$\n\\rho_{\\mathrm{free}}^{\\mathrm{avg}}{}_i = \\frac{1}{2}(\\rho_{\\mathrm{free}}^n{}_i + \\rho_{\\mathrm{free}}^{n+1}{}_i) = \\frac{1}{2} \\epsilon (D_- D_+ \\phi^n_i + D_- D_+ \\phi^{n+1}_i)\n$$\n由于算子 $D_-D_+$ 是线性的，这等价于：\n$$\n\\rho_{\\mathrm{free}}^{\\mathrm{avg}}{}_i = \\epsilon D_- D_+ \\left( \\frac{\\phi^n_i + \\phi^{n+1}_i}{2} \\right) = \\epsilon D_- D_+ \\phi^{\\mathrm{avg}}_i\n$$\n将此代入 $Q_{\\mathrm{part}}$ 的表达式：\n$$\nQ_{\\mathrm{part}} = - \\sum_{i=0}^{N-1} \\epsilon (D_- D_+ \\phi^{\\mathrm{avg}}_i) (\\phi^{n+1}_i - \\phi^n_i) \\Delta x\n$$\n让我们将势的变化表示为 $\\delta\\phi_i = \\phi^{n+1}_i - \\phi^{n}_i$。\n$$\nQ_{\\mathrm{part}} = - \\epsilon \\sum_{i=0}^{N-1} (D_- (D_+ \\phi^{\\mathrm{avg}}_i)) \\delta\\phi_i \\Delta x\n$$\n我们现在应用周期性网格上的离散分部求和恒等式，即 $\\sum_i a_i (D_- b_i) \\Delta x = - \\sum_i (D_+ a_i) b_i \\Delta x$。令 $a_i = \\delta\\phi_i$ 和 $b_i = D_+ \\phi^{\\mathrm{avg}}_i$。应用此恒等式：\n$$\n\\sum_{i=0}^{N-1} \\delta\\phi_i (D_- (D_+ \\phi^{\\mathrm{avg}}_i)) \\Delta x = - \\sum_{i=0}^{N-1} (D_+ \\delta\\phi_i) (D_+ \\phi^{\\mathrm{avg}}_i) \\Delta x\n$$\n将此代回 $Q_{\\mathrm{part}}$ 的表达式：\n$$\nQ_{\\mathrm{part}} = - \\epsilon \\left( - \\sum_{i=0}^{N-1} (D_+ \\delta\\phi_i) (D_+ \\phi^{\\mathrm{avg}}_i) \\Delta x \\right) = \\epsilon \\sum_{i=0}^{N-1} (D_+ \\delta\\phi_i) (D_+ \\phi^{\\mathrm{avg}}_i) \\Delta x\n$$\n现在，我们展开 $\\delta\\phi_i$ 和 $\\phi^{\\mathrm{avg}}_i$ 这两项：\n$$\nD_+ \\delta\\phi_i = D_+(\\phi^{n+1}_i - \\phi^n_i) = D_+\\phi^{n+1}_i - D_+\\phi^n_i\n$$\n$$\nD_+ \\phi^{\\mathrm{avg}}_i = D_+\\left(\\frac{\\phi^{n+1}_i + \\phi^n_i}{2}\\right) = \\frac{1}{2}(D_+\\phi^{n+1}_i + D_+\\phi^n_i)\n$$\n将这些代入 $Q_{\\mathrm{part}}$ 的表达式：\n$$\nQ_{\\mathrm{part}} = \\epsilon \\sum_{i=0}^{N-1} (D_+\\phi^{n+1}_i - D_+\\phi^n_i) \\frac{1}{2}(D_+\\phi^{n+1}_i + D_+\\phi^n_i) \\Delta x\n$$\n使用代数恒等式 $(a-b)(a+b) = a^2 - b^2$，表达式简化为：\n$$\nQ_{\\mathrm{part}} = \\frac{1}{2}\\epsilon \\sum_{i=0}^{N-1} \\left[ (D_+\\phi^{n+1}_i)^2 - (D_+\\phi^n_i)^2 \\right] \\Delta x\n$$\n这个表达式与 $\\Delta W_{\\mathrm{field}}$ 的定义完全相同。因此，我们证明了在指定的离散化下，$Q_{\\mathrm{part}} = \\Delta W_{\\mathrm{field}}$。计算出的不匹配量 $M = |Q_{\\mathrm{part}} - \\Delta W_{\\mathrm{field}}|$ 应该为零，或是一个可归因于浮点运算误差的极小数值。\n\n每个测试用例的计算步骤如下：\n1.  定义网格参数 $N$、$L$ 和物理常数 $\\epsilon$。\n2.  构建空间网格 $x_i = i \\Delta x$，其中 $i = 0, \\dots, N-1$，$\\Delta x = L/N$。\n3.  根据测试用例的指定公式生成势场数组 $\\phi^n$ 和 $\\phi^{n+1}$。\n4.  计算 $Q_{\\mathrm{part}}$：\n    a. 计算时间平均势 $\\phi^{\\mathrm{avg}} = (\\phi^n + \\phi^{n+1})/2$。\n    b. 计算 $\\phi^{\\mathrm{avg}}$ 的离散拉普拉斯算子：$\\text{Lap}(\\phi^{\\mathrm{avg}})_i = (\\phi^{\\mathrm{avg}}_{i+1} - 2\\phi^{\\mathrm{avg}}_i + \\phi^{\\mathrm{avg}}_{i-1})/\\Delta x^2$，并遵守周期性边界。\n    c. 计算时间平均自由电荷密度 $\\rho_{\\mathrm{free}}^{\\mathrm{avg}} = \\epsilon \\cdot \\text{Lap}(\\phi^{\\mathrm{avg}})$。\n    d. 计算势差 $\\delta\\phi = \\phi^{n+1} - \\phi^n$。\n    e. 计算 $Q_{\\mathrm{part}} = -\\text{sum}(\\rho_{\\mathrm{free}}^{\\mathrm{avg}} \\cdot \\delta\\phi) \\cdot \\Delta x$。\n5.  计算 $\\Delta W_{\\mathrm{field}}$：\n    a. 计算离散前向梯度 $D_+\\phi^n$ 和 $D_+\\phi^{n+1}$。对于一个数组 $\\psi$，$(D_+\\psi)_i = (\\psi_{i+1}-\\psi_i)/\\Delta x$，并遵守周期性边界。\n    b. 对这些梯度数组进行逐元素平方。\n    c. 计算 $\\Delta W_{\\mathrm{field}} = (1/2)\\epsilon \\cdot \\text{sum}((D_+\\phi^{n+1})^2 - (D_+\\phi^n)^2) \\cdot \\Delta x$。\n6.  计算不匹配量 $M = |Q_{\\mathrm{part}} - \\Delta W_{\\mathrm{field}}|$。\n\n对四个测试用例中的每一个都执行此过程。在用例 2 中，$\\phi^n = \\phi^{n+1}$，它作为一个空检验，其中 $Q_{\\mathrm{part}}$ 和 $\\Delta W_{\\mathrm{field}}$ 都应恒等于零。用例 4 测试了该格式对于网格上可分辨的最高频率模式（奈奎斯特模式）的行为，在这种情况下，离散算子的行为可能与其连续对应物不同。该恒等式预计在所有情况下都成立。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the energy conservation mismatch for a 1D electrostatic gyrokinetic\n    PIC model using a specific finite-difference scheme.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"case_id\": 1,\n            \"N\": 128, \"L\": 2.0 * np.pi, \"epsilon\": 1.0,\n            \"params\": {\"k\": 2.0, \"A\": 0.3, \"deltaA\": 0.01},\n            \"phi_n_func\": lambda x, p: p[\"A\"] * np.sin(p[\"k\"] * x),\n            \"phi_n1_func\": lambda x, p: (p[\"A\"] + p[\"deltaA\"]) * np.sin(p[\"k\"] * x)\n        },\n        {\n            \"case_id\": 2,\n            \"N\": 128, \"L\": 2.0 * np.pi, \"epsilon\": 1.0,\n            \"params\": {\"k\": 4.0, \"A\": 0.25},\n            \"phi_n_func\": lambda x, p: p[\"A\"] * np.sin(p[\"k\"] * x),\n            \"phi_n1_func\": lambda x, p: p[\"A\"] * np.sin(p[\"k\"] * x)\n        },\n        {\n            \"case_id\": 3,\n            \"N\": 256, \"L\": 2.0 * np.pi, \"epsilon\": 0.5,\n            \"params\": {\n                \"k1\": 3.0, \"k2\": 5.0, \"A1\": 0.2, \"A2\": 0.1,\n                \"A1_prime\": 0.205, \"A2_prime\": 0.095,\n                \"d_phi1\": 0.02, \"d_phi2\": -0.015\n            },\n            \"phi_n_func\": lambda x, p: p[\"A1\"] * np.sin(p[\"k1\"] * x) + p[\"A2\"] * np.cos(p[\"k2\"] * x),\n            \"phi_n1_func\": lambda x, p: p[\"A1_prime\"] * np.sin(p[\"k1\"] * x + p[\"d_phi1\"]) + p[\"A2_prime\"] * np.cos(p[\"k2\"] * x + p[\"d_phi2\"])\n        },\n        {\n            \"case_id\": 4,\n            \"N\": 64, \"L\": 2.0 * np.pi, \"epsilon\": 1.0,\n            \"params\": {\"k_nyq\": 32.0, \"A\": 0.1, \"A_prime\": 0.11},\n            \"phi_n_func\": lambda x, p: p[\"A\"] * np.cos(p[\"k_nyq\"] * x),\n            \"phi_n1_func\": lambda x, p: p[\"A_prime\"] * np.cos(p[\"k_nyq\"] * x)\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N = case[\"N\"]\n        L = case[\"L\"]\n        epsilon = case[\"epsilon\"]\n        params = case[\"params\"]\n\n        dx = L / N\n        x = np.linspace(0.0, L, N, endpoint=False)\n\n        # Generate potential fields at times t^n and t^{n+1}\n        phi_n = case[\"phi_n_func\"](x, params)\n        phi_n1 = case[\"phi_n1_func\"](x, params)\n\n        # ---- Calculate Q_part ----\n        \n        # Calculate time-averaged free charge density, rho_free_avg\n        # rho_free_avg = epsilon * laplacian(phi_avg)\n        # where phi_avg = (phi_n + phi_n1) / 2\n        phi_avg = 0.5 * (phi_n + phi_n1)\n        \n        # Discrete Laplacian operator D_- D_+ using periodic boundaries\n        # np.roll(phi, -1) gives phi_{i+1}\n        # np.roll(phi, 1)  gives phi_{i-1}\n        laplacian_phi_avg = (np.roll(phi_avg, -1) - 2.0 * phi_avg + np.roll(phi_avg, 1)) / (dx**2)\n        \n        rho_free_avg = epsilon * laplacian_phi_avg\n        \n        # Calculate potential difference\n        delta_phi = phi_n1 - phi_n\n        \n        # Calculate energy exchange Q_part\n        Q_part = -np.sum(rho_free_avg * delta_phi) * dx\n\n        # ---- Calculate Delta_W_field ----\n        \n        # Discrete forward difference operator D_+ using periodic boundaries\n        d_plus_phi_n = (np.roll(phi_n, -1) - phi_n) / dx\n        d_plus_phi_n1 = (np.roll(phi_n1, -1) - phi_n1) / dx\n\n        # Calculate field energy at each time\n        W_field_n_sq_term = d_plus_phi_n**2\n        W_field_n1_sq_term = d_plus_phi_n1**2\n        \n        # Calculate change in field energy Delta_W_field\n        delta_W_field = 0.5 * epsilon * np.sum(W_field_n1_sq_term - W_field_n_sq_term) * dx\n\n        # ---- Calculate the mismatch M ----\n        mismatch = np.abs(Q_part - delta_W_field)\n        results.append(mismatch)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个经过验证的代码是成功模拟的必要条件，但非充分条件；我们还必须管理其中固有的数值噪声。本实践旨在解决 PIC 方法的统计特性问题，引导您推导由离散粒子表示所产生的频谱噪声基底。通过将粒子数量等模拟参数与信噪比联系起来，您将学会如何设计一个既计算高效又能够解析目标物理现象的模拟。",
            "id": "4205893",
            "problem": "考虑一个静电回旋动理学模拟，其中单个离子种类存在于面积为 $A$ 的二维周期性区域内，具有均匀的平均离子回旋中心密度 $n_{0}$ 和绝热电子。使用网格粒子（PIC）方法，通过 $N_{p}$ 个权重相同的独立宏粒子来表示离子回旋中心分布。每个宏粒子携带密度权重 $w$，并使用一个紧凑的 $r$ 阶基数B样条形函数沉积到间距为 $\\Delta$ 的均匀网格上。$r$ 阶形函数的傅里叶变换为\n$$\nS_{r}(\\mathbf{k}) \\;=\\; \\prod_{j=1}^{2} \\left[\\mathrm{sinc}\\!\\left(\\frac{k_{j}\\Delta}{2}\\right)\\right]^{\\,r+1},\n$$\n其中 $\\mathrm{sinc}(x) = \\frac{\\sin(x)}{x}$，$\\mathbf{k}=(k_{x},k_{y})$ 是垂直波矢。在波数大小 $k_{\\perp}=\\sqrt{k_{x}^{2}+k_{y}^{2}}$ 处的离子回旋平均表现为零阶贝塞尔函数 $J_{0}(k_{\\perp}\\rho_{i})$，其中 $\\rho_{i}$ 是离子热拉莫尔半径。在包含绝热电子的静电回旋动理学准中性关系中，\n$$\n\\alpha(\\mathbf{k})\\,\\phi_{\\mathbf{k}} \\;=\\; q_{i}\\,J_{0}\\!\\left(k_{\\perp}\\rho_{i}\\right)\\,\\delta n_{i,\\mathbf{k}},\n$$\n其中\n$$\n\\alpha(\\mathbf{k}) \\;=\\; \\frac{q_{e}^{2}n_{0e}}{T_{e}} \\;+\\; \\frac{q_{i}^{2}n_{0i}}{T_{i}}\\left[1-\\Gamma_{0}\\!\\left(b_{i}\\right)\\right],\n\\qquad\nb_{i}\\;=\\;k_{\\perp}^{2}\\rho_{i}^{2},\n\\qquad\n\\Gamma_{0}(b)\\;=\\;\\exp(-b)\\,I_{0}(b),\n$$\n以及 $q_{s}$、$n_{0s}$、$T_{s}$ 分别为粒子种类 $s$ 的电荷、平均密度和温度，$I_{0}$ 是第一类修正贝塞尔函数。假设离子为单次电离，因此 $q_{i}=e$，且满足电荷中性条件 $n_{0e}=n_{0i}=n_{0}$。\n\n宏粒子在区域内均匀且独立地分布，对均匀的平衡态进行采样。沉积的离子回旋中心密度场的傅里叶系数由单位面积约定定义，$\\delta n_{i,\\mathbf{k}} = \\frac{1}{A}\\int \\delta n_{i}(\\mathbf{x})\\,\\exp\\!\\left(-i\\mathbf{k}\\cdot\\mathbf{x}\\right)\\,d^{2}x$。选择宏粒子密度权重 $w$，使得沉积密度的系综平均值等于 $n_{0}$。\n\n从基本定义和上述假设出发，推导在模式 $\\mathbf{k}$ 处静电势的均方根谱噪声振幅，记为 $\\sigma_{\\phi}(\\mathbf{k};N_{p},r)$，作为 $N_{p}$ 和形函数阶数 $r$ 的函数。然后，给定目标模式振幅 $|\\phi_{\\mathbf{k}}|=\\Phi_{\\mathrm{t}}>0$ 和所需的信噪比 $\\mathcal{R}>1$，确定所需的最小宏粒子数 $N_{p}^{\\min}$，以满足 $\\Phi_{\\mathrm{t}}/\\sigma_{\\phi}(\\mathbf{k};N_{p},r)\\geq \\mathcal{R}$。\n\n使用上述定义，将您的最终答案表示为关于 $n_{0}$、$e$、$T_{e}$、$T_{i}$、$\\rho_{i}$、$\\mathbf{k}$、$\\Delta$、$r$ 和 $\\Phi_{\\mathrm{t}}$ 的闭合形式解析表达式。不要引入任何额外的参数。不需要进行数值计算。最终答案必须不带单位。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于成熟的回旋动理学模拟理论，表述清晰，信息充分，可得到唯一解，并以客观、正式的语言进行阐述。所提出的物理和数学模型，如网格粒子法、B样条形函数和回旋动理学准中性关系，在计算等离子体物理学中是标准的。不存在矛盾、歧义或不成立的前提。\n\n第一个目标是推导静电势的均方根（RMS）谱噪声振幅 $\\sigma_{\\phi}(\\mathbf{k};N_{p},r)$。宏粒子均匀且独立地分布，以对均匀的平衡密度 $n_{0}$ 进行采样。对于任何非零波矢 $\\mathbf{k} \\neq \\mathbf{0}$，密度扰动的系综平均为零，即 $\\langle \\delta n_{i, \\mathbf{k}} \\rangle = 0$。因此，根据准中性关系，电势涨落的系综平均也为零，$\\langle \\phi_{\\mathbf{k}} \\rangle = 0$。因此，RMS振幅即为标准差，对于零均值过程，其表达式为 $\\sigma_{\\phi}(\\mathbf{k}) = \\sqrt{\\langle |\\phi_{\\mathbf{k}}|^{2} \\rangle}$。\n\n根据给定的静电回旋动理学准中性关系，我们可以将电势涨落 $\\phi_{\\mathbf{k}}$ 表示为离子回旋中心密度涨落 $\\delta n_{i, \\mathbf{k}}$ 的函数：\n$$\n\\phi_{\\mathbf{k}} = \\frac{q_{i}\\,J_{0}\\!\\left(k_{\\perp}\\rho_{i}\\right)}{\\alpha(\\mathbf{k})}\\,\\delta n_{i,\\mathbf{k}}\n$$\n电势的方差则为：\n$$\n\\sigma_{\\phi}^{2}(\\mathbf{k}) = \\langle |\\phi_{\\mathbf{k}}|^{2} \\rangle = \\left| \\frac{q_{i}\\,J_{0}\\!\\left(k_{\\perp}\\rho_{i}\\right)}{\\alpha(\\mathbf{k})} \\right|^{2} \\langle |\\delta n_{i,\\mathbf{k}}|^{2} \\rangle\n$$\n在给定的定义下，项 $\\alpha(\\mathbf{k})$ 是实数，因此表达式简化为：\n$$\n\\sigma_{\\phi}^{2}(\\mathbf{k}) = \\frac{q_{i}^{2}\\,J_{0}^{2}\\!\\left(k_{\\perp}\\rho_{i}\\right)}{\\alpha(\\mathbf{k})^{2}} \\langle |\\delta n_{i,\\mathbf{k}}|^{2} \\rangle\n$$\n推导的核心是计算离子回旋中心密度涨落的方差 $\\langle |\\delta n_{i,\\mathbf{k}}|^{2} \\rangle$。沉积的密度场由 $N_{p}$ 个位置为 $\\{\\mathbf{x}_{j}\\}_{j=1}^{N_p}$ 且具有相同密度权重 $w$ 的宏粒子构成，使用形函数 $S_{r}(\\mathbf{x})$（对应于给定的傅里叶变换 $S_r(\\mathbf{k})$ 的实空间函数）。连续密度场为 $n(\\mathbf{x}) = \\sum_{j=1}^{N_{p}} w S_{r}(\\mathbf{x} - \\mathbf{x}_{j})$。\n\n该密度场的傅里叶系数定义为：\n$$\nn_{\\mathbf{k}} = \\frac{1}{A} \\int_{A} n(\\mathbf{x}) \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}) d^{2}x = \\frac{1}{A} \\int_{A} \\left( \\sum_{j=1}^{N_{p}} w S_{r}(\\mathbf{x} - \\mathbf{x}_{j}) \\right) \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}) d^{2}x\n$$\n根据卷积定理，一系列位移函数的和的傅里叶变换是它们各自傅里叶变换的和。$S_r(\\mathbf{x}-\\mathbf{x}_j)$ 的傅里叶变换是 $S_r(\\mathbf{k})\\exp(-i\\mathbf{k}\\cdot\\mathbf{x}_j)$。因此，傅里叶系数变为：\n$$\nn_{\\mathbf{k}} = \\frac{w}{A} S_{r}(\\mathbf{k}) \\sum_{j=1}^{N_{p}} \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}_{j})\n$$\n对于 $\\mathbf{k} \\neq \\mathbf{0}$，这对应于涨落 $\\delta n_{i,\\mathbf{k}}$。在计算其方差之前，我们先确定权重 $w$。选择 $w$ 使得沉积密度的系综平均值为 $n_{0}$。\n$$\n\\langle n(\\mathbf{x}) \\rangle = \\left\\langle \\sum_{j=1}^{N_{p}} w S_{r}(\\mathbf{x} - \\mathbf{x}_{j}) \\right\\rangle = w N_{p} \\langle S_{r}(\\mathbf{x} - \\mathbf{x}_{j}) \\rangle\n$$\n由于粒子在面积 $A$ 内均匀分布，位置 $\\mathbf{x}_j$ 的概率密度为 $1/A$。\n$$\n\\langle S_{r}(\\mathbf{x} - \\mathbf{x}_{j}) \\rangle = \\int_{A} S_{r}(\\mathbf{x} - \\mathbf{x}') \\frac{1}{A} d^{2}x' = \\frac{1}{A} \\int_{A} S_{r}(\\mathbf{y}) d^{2}y\n$$\n形函数在整个区域上的积分是其在 $\\mathbf{k}=\\mathbf{0}$ 处的傅里叶变换，即 $S_r(\\mathbf{0})=1$。因此，$\\langle S_{r}(\\mathbf{x} - \\mathbf{x}_{j}) \\rangle = 1/A$。\n平均密度为 $\\langle n(\\mathbf{x}) \\rangle = w N_{p} / A$。将其等于 $n_{0}$ 可得到权重：\n$$\nw = \\frac{n_{0}A}{N_{p}}\n$$\n现在我们计算 $\\mathbf{k} \\neq \\mathbf{0}$ 时 $\\delta n_{i,\\mathbf{k}}$ 的方差：\n$$\n\\langle |\\delta n_{i,\\mathbf{k}}|^{2} \\rangle = \\left\\langle \\left( \\frac{w}{A} S_{r}(\\mathbf{k}) \\sum_{j=1}^{N_{p}} e^{-i\\mathbf{k}\\cdot\\mathbf{x}_{j}} \\right) \\left( \\frac{w}{A} S_{r}^{*}(\\mathbf{k}) \\sum_{l=1}^{N_{p}} e^{i\\mathbf{k}\\cdot\\mathbf{x}_{l}} \\right) \\right\\rangle\n$$\n根据题目所给，$S_{r}(\\mathbf{k})$ 是实数，所以 $S_{r}^{*}(\\mathbf{k}) = S_{r}(\\mathbf{k})$。\n$$\n\\langle |\\delta n_{i,\\mathbf{k}}|^{2} \\rangle = \\frac{w^{2}S_{r}^{2}(\\mathbf{k})}{A^{2}} \\left\\langle \\sum_{j,l=1}^{N_{p}} e^{-i\\mathbf{k}\\cdot(\\mathbf{x}_{j}-\\mathbf{x}_{l})} \\right\\rangle\n$$\n粒子位置 $\\mathbf{x}_{j}$ 是独立的随机变量。我们将求和分解为对角项（$j=l$）和非对角项（$j\\neq l$）。\n$$\n\\left\\langle \\sum_{j,l} e^{-i\\mathbf{k}\\cdot(\\mathbf{x}_{j}-\\mathbf{x}_{l})} \\right\\rangle = \\sum_{j=1}^{N_{p}} \\langle e^{0} \\rangle + \\sum_{j \\neq l} \\langle e^{-i\\mathbf{k}\\cdot\\mathbf{x}_{j}} \\rangle \\langle e^{i\\mathbf{k}\\cdot\\mathbf{x}_{l}} \\rangle\n$$\n对于在面积为 $A$ 的周期性区域内均匀分布的粒子，当 $\\mathbf{k} \\neq \\mathbf{0}$ 时，期望值为 $\\langle \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}_{j}) \\rangle = \\frac{1}{A} \\int_{A} \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}) d^{2}x = 0$。\n因此，所有非对角项都为零。求和简化为对角项：\n$$\n\\left\\langle \\sum_{j,l} e^{-i\\mathbf{k}\\cdot(\\mathbf{x}_{j}-\\mathbf{x}_{l})} \\right\\rangle = N_{p}\n$$\n密度方差为：\n$$\n\\langle |\\delta n_{i,\\mathbf{k}}|^{2} \\rangle = \\frac{w^{2}S_{r}^{2}(\\mathbf{k})}{A^{2}} N_{p}\n$$\n代入 $w = n_{0}A/N_{p}$：\n$$\n\\langle |\\delta n_{i,\\mathbf{k}}|^{2} \\rangle = \\frac{(n_{0}A/N_{p})^{2} S_{r}^{2}(\\mathbf{k})}{A^{2}} N_{p} = \\frac{n_{0}^{2} A^{2}}{N_{p}^{2} A^{2}} S_{r}^{2}(\\mathbf{k}) N_{p} = \\frac{n_{0}^{2}}{N_{p}} S_{r}^{2}(\\mathbf{k})\n$$\n现在我们组合出 $\\sigma_{\\phi}^{2}(\\mathbf{k})$ 的表达式：\n$$\n\\sigma_{\\phi}^{2}(\\mathbf{k}) = \\frac{q_{i}^{2}\\,J_{0}^{2}\\!\\left(k_{\\perp}\\rho_{i}\\right)}{\\alpha(\\mathbf{k})^{2}} \\frac{n_{0}^{2}}{N_{p}} S_{r}^{2}(\\mathbf{k})\n$$\n我们使用给定的假设 $q_{i}=e$，$n_{0e}=n_{0i}=n_{0}$，因此 $q_{e}=-e$。项 $\\alpha(\\mathbf{k})$ 变为：\n$$\n\\alpha(\\mathbf{k}) = \\frac{(-e)^{2}n_{0}}{T_{e}} + \\frac{e^{2}n_{0}}{T_{i}}\\left[1-\\Gamma_{0}\\!\\left(b_{i}\\right)\\right] = e^{2}n_{0}\\left(\\frac{1}{T_{e}} + \\frac{1-\\Gamma_{0}(b_{i})}{T_{i}}\\right)\n$$\n将此代入 $\\sigma_\\phi^2$ 的表达式中：\n$$\n\\sigma_{\\phi}^{2}(\\mathbf{k}) = \\frac{e^{2}\\,J_{0}^{2}\\!\\left(k_{\\perp}\\rho_{i}\\right)}{\\left[e^{2}n_{0}\\left(\\frac{1}{T_{e}} + \\frac{1-\\Gamma_{0}(b_{i})}{T_{i}}\\right)\\right]^{2}} \\frac{n_{0}^{2}}{N_{p}} S_{r}^{2}(\\mathbf{k}) = \\frac{J_{0}^{2}\\!\\left(k_{\\perp}\\rho_{i}\\right) S_{r}^{2}(\\mathbf{k})}{e^{2}N_{p}\\left(\\frac{1}{T_{e}} + \\frac{1-\\Gamma_{0}(b_{i})}{T_{i}}\\right)^{2}}\n$$\n取平方根得到第一个要求的表达式，即RMS噪声振幅：\n$$\n\\sigma_{\\phi}(\\mathbf{k};N_{p},r) = \\frac{\\left|J_{0}\\!\\left(k_{\\perp}\\rho_{i}\\right)\\right| \\left|S_{r}(\\mathbf{k})\\right|}{e\\sqrt{N_{p}}\\left(\\frac{1}{T_{e}} + \\frac{1-\\Gamma_{0}(b_{i})}{T_{i}}\\right)}\n$$\n其中 $b_{i}=k_{\\perp}^{2}\\rho_{i}^{2}$ 且 $S_{r}(\\mathbf{k}) = \\prod_{j=1}^{2} \\left[\\mathrm{sinc}\\!\\left(\\frac{k_{j}\\Delta}{2}\\right)\\right]^{\\,r+1}$。\n\n第二个目标是求出为达到目标模式振幅 $\\Phi_{\\mathrm{t}}$ 的信噪比 $\\mathcal{R}$ 所需的最小宏粒子数 $N_{p}^{\\min}$。条件是：\n$$\n\\frac{\\Phi_{\\mathrm{t}}}{\\sigma_{\\phi}(\\mathbf{k};N_{p},r)} \\ge \\mathcal{R}\n$$\n我们求解 $N_{p}$：\n$$\n\\Phi_{\\mathrm{t}} \\ge \\mathcal{R} \\sigma_{\\phi}(\\mathbf{k};N_{p},r) \\implies \\sqrt{N_p} \\ge \\frac{\\mathcal{R}}{\\Phi_{\\mathrm{t}}} \\frac{\\left|J_{0}\\!\\left(k_{\\perp}\\rho_{i}\\right)\\right| \\left|S_{r}(\\mathbf{k})\\right|}{e\\left(\\frac{1}{T_{e}} + \\frac{1-\\Gamma_{0}(b_{i})}{T_{i}}\\right)}\n$$\n两边平方得到关于 $N_p$ 的条件：\n$$\nN_{p} \\ge \\left(\\frac{\\mathcal{R}}{\\Phi_{\\mathrm{t}}}\\right)^{2} \\frac{J_{0}^{2}\\!\\left(k_{\\perp}\\rho_{i}\\right) S_{r}^{2}(\\mathbf{k})}{e^{2}\\left(\\frac{1}{T_{e}} + \\frac{1-\\Gamma_{0}(b_{i})}{T_{i}}\\right)^{2}}\n$$\n最小粒子数 $N_{p}^{\\min}$ 对应于此不等式的下界。\n$$\nN_{p}^{\\min} = \\left(\\frac{\\mathcal{R}}{\\Phi_{\\mathrm{t}}}\\right)^{2} \\frac{J_{0}^{2}\\!\\left(k_{\\perp}\\rho_{i}\\right) S_{r}^{2}(\\mathbf{k})}{e^{2}\\left(\\frac{1}{T_{e}} + \\frac{1-\\Gamma_{0}(b_{i})}{T_{i}}\\right)^{2}}\n$$\n该表达式以给定参数的形式提供了所需的最小粒子数。\n两个要求的表达式都已推导得出。",
            "answer": "$$\n\\boxed{\\left(\\frac{\\mathcal{R}}{\\Phi_{\\mathrm{t}}}\\right)^{2} \\frac{J_{0}^{2}\\!\\left(k_{\\perp}\\rho_{i}\\right) \\left(\\prod_{j=1}^{2} \\left[\\mathrm{sinc}\\!\\left(\\frac{k_{j}\\Delta}{2}\\right)\\right]^{\\,r+1}\\right)^{2}}{e^{2}\\left(\\frac{1}{T_{e}} + \\frac{1-\\Gamma_{0}(k_{\\perp}^{2}\\rho_{i}^{2})}{T_{i}}\\right)^{2}}}\n$$"
        }
    ]
}