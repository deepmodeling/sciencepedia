{
    "hands_on_practices": [
        {
            "introduction": "Before simulating a turbulent system, one must understand the fundamental conservation laws that govern its evolution. This exercise builds that foundation by comparing the conserved quantities for a standard fluid model, the two-dimensional Navier-Stokes equation, and a foundational plasma turbulence model, the Charney-Hasegawa-Mima equation . By deriving the spectral forms of energy and enstrophy for both systems, you will gain a deeper appreciation for how plasma physics modifies the ideal invariants and, consequently, the direction of turbulent cascades.",
            "id": "4192154",
            "problem": "In a magnetized plasma slab model relevant to fusion devices, drift-wave turbulence is often modeled by the Charney–Hasegawa–Mima (CHM) equation and compared to the two-dimensional incompressible Navier–Stokes (NS) vorticity equation. Consider a square periodic domain of side length $L$ in the $x$–$y$ plane, with coordinates $\\boldsymbol{x}=(x,y)$ and periodic boundary conditions. Let the electrostatic potential be $\\phi(\\boldsymbol{x},t)$ and the streamfunction be $\\psi(\\boldsymbol{x},t)$. Define the spatial Fourier series by\n$\\phi(\\boldsymbol{x})=\\sum_{\\boldsymbol{k}}\\phi_{\\boldsymbol{k}}\\exp(i\\boldsymbol{k}\\cdot\\boldsymbol{x})$ and $\\psi(\\boldsymbol{x})=\\sum_{\\boldsymbol{k}}\\psi_{\\boldsymbol{k}}\\exp(i\\boldsymbol{k}\\cdot\\boldsymbol{x})$, with $\\phi_{\\boldsymbol{k}}=\\frac{1}{L^{2}}\\int_{[0,L]^2}\\phi(\\boldsymbol{x})\\exp(-i\\boldsymbol{k}\\cdot\\boldsymbol{x})\\,\\mathrm{d}^{2}x$ (and similarly for $\\psi_{\\boldsymbol{k}}$), where the discrete wavevectors are $\\boldsymbol{k}=\\frac{2\\pi}{L}(m,n)$ for integers $m,n$. This normalization implies the Parseval identity $\\int_{[0,L]^2}|\\phi|^{2}\\,\\mathrm{d}^{2}x=L^{2}\\sum_{\\boldsymbol{k}}|\\phi_{\\boldsymbol{k}}|^{2}$.\n\nThe $2$-dimensional incompressible vorticity equation is $\\partial_{t}\\omega+\\{\\psi,\\omega\\}=0$, where $\\omega=\\nabla^{2}\\psi$ and $\\{a,b\\}=\\partial_{x}a\\,\\partial_{y}b-\\partial_{y}a\\,\\partial_{x}b$. The CHM equation is $\\partial_{t}q+\\{\\phi,q\\}=0$, where $q=\\nabla^{2}\\phi-\\phi/\\rho_{s}^{2}$ is the generalized potential vorticity and $\\rho_{s}$ is the ion sound Larmor radius. For both models, periodic boundaries imply conservation of quadratic invariants constructed from the fields.\n\nStarting only from these definitions and the incompressibility of the flows, do the following.\n\n- Using the kinetic energy density of an incompressible flow and the definition of vorticity, derive the quadratic invariants that represent the total energy and the total enstrophy for the NS model, and write them in spectral form in terms of $\\psi_{\\boldsymbol{k}}$.\n- Using the CHM potential vorticity $q$ and the polarization (finite Larmor radius) energy, derive the quadratic invariants that represent the total generalized energy and the total potential enstrophy for the CHM model, and write them in spectral form in terms of $\\phi_{\\boldsymbol{k}}$ and $\\rho_{s}$.\n- Consider an initial value problem at $t=0$ in which the initial fields are chosen to coincide, $\\psi(\\boldsymbol{x},0)=\\phi(\\boldsymbol{x},0)$, and their spectrum is isotropic and supported on a finite annulus in wavenumber space: for $k=|\\boldsymbol{k}|$ in $[k_{1},k_{2}]$ with $0k_{1}k_{2}$, the per-mode spectral amplitude satisfies $|\\phi_{\\boldsymbol{k}}(0)|^{2}=C\\,k^{-p}$, and it vanishes outside this band. Here $C0$ and the spectral exponent $p$ obeys $p\\neq 2,4,6$.\n- In the large-domain limit, replace sums by integrals using the mode-counting measure appropriate to the above Fourier normalization, and compute the initial values of the NS energy and enstrophy and the CHM generalized energy and potential enstrophy as shell integrals over $k\\in[k_{1},k_{2}]$.\n\nReport, as a single closed-form analytic expression, the dimensionless ratio\n$R:=\\rho_{s}^{2}\\,\\frac{Z_{\\mathrm{CHM}}(0)}{E_{\\mathrm{CHM}}(0)}$\nin terms of $k_{1}$, $k_{2}$, $p$, and $\\rho_{s}$. No numerical evaluation is required. Provide your final result as a single simplified expression. Do not include any units in your final reported expression.",
            "solution": "We begin from first principles for each model, then pass to Fourier representation and finally evaluate the requested ratio for the given initial spectral distribution.\n\nFor the two-dimensional incompressible Navier–Stokes (NS) model, the velocity is $\\boldsymbol{u}=\\hat{\\boldsymbol{z}}\\times\\nabla\\psi$, which implies $|\\boldsymbol{u}|^{2}=|\\nabla\\psi|^{2}$. The kinetic energy is therefore\n$$\nE_{\\mathrm{NS}}=\\frac{1}{2}\\int_{[0,L]^2}|\\nabla\\psi|^{2}\\,\\mathrm{d}^{2}x.\n$$\nThe scalar vorticity is $\\omega=\\nabla^{2}\\psi$. The enstrophy is defined as the mean-square vorticity,\n$$\nZ_{\\mathrm{NS}}=\\frac{1}{2}\\int_{[0,L]^2}\\omega^{2}\\,\\mathrm{d}^{2}x=\\frac{1}{2}\\int_{[0,L]^2}(\\nabla^{2}\\psi)^{2}\\,\\mathrm{d}^{2}x.\n$$\nThese invariants follow from multiplying the vorticity equation $\\partial_{t}\\omega+\\{\\psi,\\omega\\}=0$ by $\\psi$ and by $\\omega$, integrating over the periodic domain, and using the antisymmetry of the Poisson bracket and incompressibility to eliminate the flux terms:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\left(\\frac{1}{2}\\int |\\nabla\\psi|^{2}\\,\\mathrm{d}^{2}x\\right)=0,\\qquad \\frac{\\mathrm{d}}{\\mathrm{d}t}\\left(\\frac{1}{2}\\int \\omega^{2}\\,\\mathrm{d}^{2}x\\right)=0.\n$$\nPassing to spectral form with the stated normalization, we use $\\int |\\nabla\\psi|^{2}\\,\\mathrm{d}^{2}x=L^{2}\\sum_{\\boldsymbol{k}}k^{2}|\\psi_{\\boldsymbol{k}}|^{2}$ and $\\int (\\nabla^{2}\\psi)^{2}\\,\\mathrm{d}^{2}x=L^{2}\\sum_{\\boldsymbol{k}}k^{4}|\\psi_{\\boldsymbol{k}}|^{2}$. Hence\n$$\nE_{\\mathrm{NS}}=\\frac{L^{2}}{2}\\sum_{\\boldsymbol{k}}k^{2}|\\psi_{\\boldsymbol{k}}|^{2},\\qquad Z_{\\mathrm{NS}}=\\frac{L^{2}}{2}\\sum_{\\boldsymbol{k}}k^{4}|\\psi_{\\boldsymbol{k}}|^{2}.\n$$\n\nFor the Charney–Hasegawa–Mima (CHM) model, the generalized potential vorticity is $q=\\nabla^{2}\\phi-\\phi/\\rho_{s}^{2}$. The CHM equation $\\partial_{t}q+\\{\\phi,q\\}=0$ implies two quadratic invariants. The first is the generalized energy, comprised of the kinetic contribution from the electric field cross magnetic field (E cross B) drift and the polarization (finite Larmor radius) energy:\n$$\nE_{\\mathrm{CHM}}=\\frac{1}{2}\\int_{[0,L]^2}\\left(|\\nabla\\phi|^{2}+\\frac{\\phi^{2}}{\\rho_{s}^{2}}\\right)\\,\\mathrm{d}^{2}x.\n$$\nThe second is the potential enstrophy,\n$$\nZ_{\\mathrm{CHM}}=\\frac{1}{2}\\int_{[0,L]^2}q^{2}\\,\\mathrm{d}^{2}x=\\frac{1}{2}\\int_{[0,L]^2}\\left(\\nabla^{2}\\phi-\\frac{\\phi}{\\rho_{s}^{2}}\\right)^{2}\\,\\mathrm{d}^{2}x.\n$$\nThese follow by multiplying $\\partial_{t}q+\\{\\phi,q\\}=0$ by $\\phi$ to obtain $\\partial_{t}\\left(\\frac{1}{2}(|\\nabla\\phi|^{2}+\\phi^{2}/\\rho_{s}^{2})\\right)+\\nabla\\cdot(\\cdots)=0$ and by $q$ to obtain $\\partial_{t}(q^{2}/2)+\\nabla\\cdot(\\cdots)=0$, then integrating over the periodic domain to drop the divergence terms.\n\nIn spectral form, using $\\int |\\nabla\\phi|^{2}\\,\\mathrm{d}^{2}x=L^{2}\\sum_{\\boldsymbol{k}}k^{2}|\\phi_{\\boldsymbol{k}}|^{2}$ and $\\int \\phi^{2}\\,\\mathrm{d}^{2}x=L^{2}\\sum_{\\boldsymbol{k}}|\\phi_{\\boldsymbol{k}}|^{2}$, and $q_{\\boldsymbol{k}}=-(k^{2}+1/\\rho_{s}^{2})\\phi_{\\boldsymbol{k}}$ (the minus sign is irrelevant for quadratic quantities), we obtain\n$$\nE_{\\mathrm{CHM}}=\\frac{L^{2}}{2}\\sum_{\\boldsymbol{k}}\\left(k^{2}+\\frac{1}{\\rho_{s}^{2}}\\right)|\\phi_{\\boldsymbol{k}}|^{2},\\qquad Z_{\\mathrm{CHM}}=\\frac{L^{2}}{2}\\sum_{\\boldsymbol{k}}\\left(k^{2}+\\frac{1}{\\rho_{s}^{2}}\\right)^{2}|\\phi_{\\boldsymbol{k}}|^{2}.\n$$\n\nWe now impose the initial condition $\\psi(\\boldsymbol{x},0)=\\phi(\\boldsymbol{x},0)$ and an isotropic per-mode spectrum supported on the annulus $k\\in[k_{1},k_{2}]$, namely\n$$\n|\\phi_{\\boldsymbol{k}}(0)|^{2}=C\\,k^{-p}\\quad \\text{for}\\ \\ k\\in[k_{1},k_{2}],\\qquad |\\phi_{\\boldsymbol{k}}(0)|^{2}=0\\ \\ \\text{otherwise},\n$$\nwith $C0$ and $p\\neq 2,4,6$. In the large-domain limit we replace sums by integrals using the mode-counting measure associated with our Fourier normalization:\n$$\n\\sum_{\\boldsymbol{k}}g(k)\\ \\to\\ \\frac{L^{2}}{(2\\pi)^{2}}\\int_{\\mathbb{R}^{2}}g(|\\boldsymbol{k}|)\\,\\mathrm{d}^{2}k\\ =\\ \\frac{L^{2}}{2\\pi}\\int_{0}^{\\infty}k\\,g(k)\\,\\mathrm{d}k.\n$$\nThus, the initial CHM invariants become shell integrals,\n$$\nE_{\\mathrm{CHM}}(0)=\\frac{L^{2}}{2}\\cdot \\frac{L^{2}}{2\\pi}\\int_{k_{1}}^{k_{2}}k\\left(k^{2}+\\frac{1}{\\rho_{s}^{2}}\\right)C\\,k^{-p}\\,\\mathrm{d}k,\\qquad\nZ_{\\mathrm{CHM}}(0)=\\frac{L^{2}}{2}\\cdot \\frac{L^{2}}{2\\pi}\\int_{k_{1}}^{k_{2}}k\\left(k^{2}+\\frac{1}{\\rho_{s}^{2}}\\right)^{2}C\\,k^{-p}\\,\\mathrm{d}k.\n$$\nCommon constants cancel in the ratio. Defining $\\alpha:=\\rho_{s}^{-2}$ for compactness, the two integrals reduce to\n$$\nI_{1}:=\\int_{k_{1}}^{k_{2}}k^{1-p}\\left(k^{2}+\\alpha\\right)\\,\\mathrm{d}k\n=\\int_{k_{1}}^{k_{2}}\\left(k^{3-p}+\\alpha\\,k^{1-p}\\right)\\,\\mathrm{d}k\n=\\left[\\frac{k^{4-p}}{4-p}+\\alpha\\,\\frac{k^{2-p}}{2-p}\\right]_{k_{1}}^{k_{2}},\n$$\n$$\nI_{2}:=\\int_{k_{1}}^{k_{2}}k^{1-p}\\left(k^{2}+\\alpha\\right)^{2}\\,\\mathrm{d}k\n=\\int_{k_{1}}^{k_{2}}\\left(k^{5-p}+2\\alpha\\,k^{3-p}+\\alpha^{2}k^{1-p}\\right)\\,\\mathrm{d}k\n=\\left[\\frac{k^{6-p}}{6-p}+2\\alpha\\,\\frac{k^{4-p}}{4-p}+\\alpha^{2}\\,\\frac{k^{2-p}}{2-p}\\right]_{k_{1}}^{k_{2}},\n$$\nwhere the restrictions $p\\neq 2,4,6$ ensure the antiderivatives are well defined. Therefore,\n$$\n\\frac{Z_{\\mathrm{CHM}}(0)}{E_{\\mathrm{CHM}}(0)}=\\frac{I_{2}}{I_{1}}.\n$$\nThe requested dimensionless ratio is $R=\\rho_{s}^{2}\\,I_{2}/I_{1}$. Substituting $\\alpha=\\rho_{s}^{-2}$ and writing the definite integrals explicitly yields\n$$\nR=\\frac{\\rho_{s}^{2}\\left(\\dfrac{k_{2}^{6-p}-k_{1}^{6-p}}{6-p}\\right)+2\\left(\\dfrac{k_{2}^{4-p}-k_{1}^{4-p}}{4-p}\\right)+\\rho_{s}^{-2}\\left(\\dfrac{k_{2}^{2-p}-k_{1}^{2-p}}{2-p}\\right)}{\\left(\\dfrac{k_{2}^{4-p}-k_{1}^{4-p}}{4-p}\\right)+\\rho_{s}^{-2}\\left(\\dfrac{k_{2}^{2-p}-k_{1}^{2-p}}{2-p}\\right)}.\n$$\nThis is a closed-form analytic expression in terms of $k_{1}$, $k_{2}$, $p$, and $\\rho_{s}$, and is independent of $C$, $L$, and the overall normalization of the spectrum.\n\nFor completeness, the NS initial invariants for the same initial condition $\\psi(\\boldsymbol{x},0)=\\phi(\\boldsymbol{x},0)$ are\n$$\nE_{\\mathrm{NS}}(0)\\propto \\int_{k_{1}}^{k_{2}}k^{1-p}\\,k^{2}\\,\\mathrm{d}k=\\left[\\frac{k^{4-p}}{4-p}\\right]_{k_{1}}^{k_{2}},\\qquad\nZ_{\\mathrm{NS}}(0)\\propto \\int_{k_{1}}^{k_{2}}k^{1-p}\\,k^{4}\\,\\mathrm{d}k=\\left[\\frac{k^{6-p}}{6-p}\\right]_{k_{1}}^{k_{2}},\n$$\nwhich highlights the structural difference between the NS and CHM quadratic invariants due to the polarization term proportional to $1/\\rho_{s}^{2}$ in CHM. However, only the CHM ratio $R$ is required to be reported.",
            "answer": "$$\\boxed{\\frac{\\rho_{s}^{2}\\left(\\dfrac{k_{2}^{6-p}-k_{1}^{6-p}}{6-p}\\right)+2\\left(\\dfrac{k_{2}^{4-p}-k_{1}^{4-p}}{4-p}\\right)+\\rho_{s}^{-2}\\left(\\dfrac{k_{2}^{2-p}-k_{1}^{2-p}}{2-p}\\right)}{\\left(\\dfrac{k_{2}^{4-p}-k_{1}^{4-p}}{4-p}\\right)+\\rho_{s}^{-2}\\left(\\dfrac{k_{2}^{2-p}-k_{1}^{2-p}}{2-p}\\right)}}$$"
        },
        {
            "introduction": "Moving from theory to practice, we must address how physical laws are represented numerically, where seemingly equivalent formulations can have vastly different consequences for stability. This exercise confronts the critical issue of gauge freedom in electromagnetic simulations, demonstrating how an unconstrained initial vector potential can introduce stiff, non-physical modes that severely limit the computational time step . You will implement a Fourier-space projection to enforce the solenoidal Coulomb gauge condition, $\\nabla \\cdot \\mathbf{A} = 0$, and quantify the resulting improvement in numerical stability, a vital lesson in practical scientific computing.",
            "id": "4192185",
            "problem": "Consider a simplified electromagnetic initial value problem relevant to fusion plasma turbulence simulation in a periodic square domain, where a spectral solver advances the Fourier coefficients of the vector potential. The electromagnetic fields are represented by the scalar potential $ \\phi(\\mathbf{x}, t) $ and the vector potential $ \\mathbf{A}(\\mathbf{x}, t) $, with the magnetic field $ \\mathbf{B} = \\nabla \\times \\mathbf{A} $ and the electric field $ \\mathbf{E} = -\\partial_t \\mathbf{A} - \\nabla \\phi $. The gauge freedom is expressed by the transformation $ \\mathbf{A} \\rightarrow \\mathbf{A} + \\nabla \\chi $ and $ \\phi \\rightarrow \\phi - \\partial_t \\chi $ for any sufficiently smooth gauge function $ \\chi(\\mathbf{x}, t) $. The Coulomb gauge enforces $ \\nabla \\cdot \\mathbf{A} = 0 $. In a spectral solver, the Coulomb gauge condition translates to the Fourier-space constraint $ \\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}} = 0 $ for each Fourier mode $ \\mathbf{k} $.\n\nThe transverse dynamics of the vector potential under the Coulomb gauge and linearized Maxwell dynamics in normalized units obeys the wave equation $ \\partial_t^2 \\mathbf{A} - \\nabla^2 \\mathbf{A} = 0 $, which in Fourier space reduces for each mode to $ \\partial_t^2 \\mathbf{A}_{\\mathbf{k}} + |\\mathbf{k}|^2 \\mathbf{A}_{\\mathbf{k}} = 0 $ provided $ \\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}} = 0 $. Many computational schemes add an explicit penalty to suppress violations of the gauge constraint, yielding for the longitudinal component a stiff contribution modeled by $ \\partial_t^2 \\mathbf{A}_{\\parallel, \\mathbf{k}} + \\left(|\\mathbf{k}|^2 + p\\right) \\mathbf{A}_{\\parallel, \\mathbf{k}} = 0 $, where $ p \\ge 0 $ is a user-chosen penalty parameter and $ \\mathbf{A}_{\\parallel, \\mathbf{k}} $ denotes the component of $ \\mathbf{A}_{\\mathbf{k}} $ parallel to $ \\mathbf{k} $.\n\nYou must formulate the initial value problem for the potentials at $ t = 0 $ with a given controlled gauge contamination and then enforce the gauge constraint using a projection in Fourier space. Specifically:\n\n- Let the set of Fourier modes be a finite list $ \\mathcal{K} \\subset \\mathbb{Z}^2 \\setminus \\{\\mathbf{0}\\} $ with two-dimensional wave vectors $ \\mathbf{k} = (k_x, k_y) $.\n- For each $ \\mathbf{k} \\in \\mathcal{K} $, define the unit vector $ \\hat{\\mathbf{k}} = \\mathbf{k} / |\\mathbf{k}| $ and the transverse unit vector $ \\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} = \\frac{1}{|\\mathbf{k}|}(-k_y, k_x) $, so that $ \\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} \\cdot \\hat{\\mathbf{k}} = 0 $.\n- Construct the initial vector potential Fourier coefficients at $ t = 0 $ as $ \\mathbf{A}_{\\mathbf{k}}(0) = a_{\\mathbf{k}} \\left( \\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} + g \\, \\hat{\\mathbf{k}} \\right) $, where $ a_{\\mathbf{k}} = |\\mathbf{k}|^{-s} $, with the spectral index $ s \\ge 0 $ and the nonnegative gauge contamination amplitude $ g \\ge 0 $ controlling the fraction of longitudinal content relative to transverse content. Let $ \\phi_{\\mathbf{k}}(0) $ be arbitrary, and only the vector potential is used for the gauge projection at $ t = 0 $.\n\nPart A: Derive, from the gauge transformation and the Helmholtz decomposition, the Fourier-space projection that enforces the Coulomb gauge at $ t = 0 $ while preserving the physical electric field at $ t = 0 $. Conclude with the explicit formula for the projected vector potential $ \\mathbf{A}'_{\\mathbf{k}}(0) $ in terms of $ \\mathbf{A}_{\\mathbf{k}}(0) $ and $ \\mathbf{k} $.\n\nPart B: Using second-order central differences in time for the oscillator $ \\partial_t^2 y + \\omega^2 y = 0 $ applied modewise, analyze the linear stability of the explicit time-stepping scheme. Show that stability requires $ \\Delta t \\, \\omega  2 $ for each oscillator, and deduce the maximum stable time step $ \\Delta t_{\\max} = 2 / \\max_{\\mathbf{k}} \\omega_{\\mathbf{k}} $ for the coupled system. In the presence of gauge contamination and the penalty $ p $, the longitudinal component has frequency $ \\omega_{\\parallel, \\mathbf{k}} = \\sqrt{|\\mathbf{k}|^2 + p} $; in the purely transverse case, $ \\omega_{\\perp, \\mathbf{k}} = |\\mathbf{k}| $. Quantify the effect of the initial gauge choice by computing $ \\Delta t_{\\max}^{\\text{pre}} $ when $ g  0 $ and $ p  0 $, and $ \\Delta t_{\\max}^{\\text{post}} $ after the projection has enforced $ \\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0) = 0 $, thereby eliminating the longitudinal component.\n\nPart C: Define the following metrics of the initial gauge choice and its correction:\n- The gauge violation fraction $ \\delta = \\frac{\\sum_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0)|^2}{\\sum_{\\mathbf{k} \\in \\mathcal{K}} \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2} $.\n- The energy fraction removed by the projection $ r = \\frac{\\sum_{\\mathbf{k} \\in \\mathcal{K}} \\left( \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2 - \\|\\mathbf{A}'_{\\mathbf{k}}(0)\\|^2 \\right)}{\\sum_{\\mathbf{k} \\in \\mathcal{K}} \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2} $.\n- The maximum stable time step before projection $ \\Delta t_{\\max}^{\\text{pre}} = \\frac{2}{\\max_{\\mathbf{k} \\in \\mathcal{K}} \\omega_{\\text{pre}, \\mathbf{k}}} $, where $ \\omega_{\\text{pre}, \\mathbf{k}} = \\max\\{ |\\mathbf{k}|, \\sqrt{|\\mathbf{k}|^2 + p} \\} $ if $ g  0 $, and $ \\omega_{\\text{pre}, \\mathbf{k}} = |\\mathbf{k}| $ if $ g = 0 $.\n- The maximum stable time step after projection $ \\Delta t_{\\max}^{\\text{post}} = \\frac{2}{\\max_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k}| } $.\n- The improvement factor $ f = \\Delta t_{\\max}^{\\text{post}} / \\Delta t_{\\max}^{\\text{pre}} $.\n\nYour program must implement the projection at $ t = 0 $ in Fourier space and compute $ \\delta $, $ r $, $ \\Delta t_{\\max}^{\\text{pre}} $, $ \\Delta t_{\\max}^{\\text{post}} $, and $ f $ for each test case specified below. All quantities are dimensionless. Your implementation must not use external input and must use the parameters provided in the test suite.\n\nTest Suite:\n- Case $ 1 $ (happy path): $ \\mathcal{K} = \\{ (1, 0), (0, 1), (1, 1), (2, 1), (2, 2) \\} $, $ g = 0.2 $, $ s = 1 $, $ p = 10 $.\n- Case $ 2 $ (boundary condition, zero contamination): $ \\mathcal{K} = \\{ (1, 0), (0, 1), (1, 1), (2, 1), (2, 2) \\} $, $ g = 0 $, $ s = 1 $, $ p = 10 $.\n- Case $ 3 $ (edge case, no penalty): $ \\mathcal{K} = \\{ (1, 0), (0, 1), (1, 1), (2, 1), (2, 2) \\} $, $ g = 0.2 $, $ s = 1 $, $ p = 0 $.\n- Case $ 4 $ (edge case, high wave numbers and strong penalty): $ \\mathcal{K} = \\{ (1, 0), (0, 1), (1, 1), (2, 1), (2, 2), (4, 4), (8, 8) \\} $, $ g = 0.5 $, $ s = 0 $, $ p = 50 $.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results for the cases as a comma-separated list enclosed in square brackets, where each case result is itself a list of $ 5 $ floats in the order $ [\\delta, r, \\Delta t_{\\max}^{\\text{pre}}, \\Delta t_{\\max}^{\\text{post}}, f] $. For example, the overall output should look like $ [[\\cdots],[\\cdots],[\\cdots],[\\cdots]] $.",
            "solution": "The problem requires the formulation and analysis of an initial value problem for a simplified electromagnetic system in a periodic domain, focusing on the enforcement of the Coulomb gauge and its effect on numerical stability. We will proceed by first validating the problem statement and then providing a complete, reasoned solution.\n\nThe problem is determined to be valid. It is scientifically grounded in the principles of Maxwell's equations, gauge theory, and numerical analysis of partial differential equations. The setup is self-contained, mathematically well-posed, and free from contradictions or ambiguity. All terms are explicitly defined, and the required tasks are rigorously formalizable. We proceed to the solution.\n\nThe solution is presented in three parts, corresponding to the tasks outlined in the problem statement.\n\nPart A: Derivation of the Gauge Projection at $ t=0 $\n\nThe fundamental principle guiding this derivation is gauge invariance. The physical electric field $ \\mathbf{E} $ and magnetic field $ \\mathbf{B} $ are invariant under a gauge transformation of the potentials $ \\mathbf{A} $ and $ \\phi $:\n$$ \\mathbf{A} \\rightarrow \\mathbf{A}' = \\mathbf{A} + \\nabla\\chi $$\n$$ \\phi \\rightarrow \\phi' = \\phi - \\partial_t\\chi $$\nFor any sufficiently smooth gauge function $ \\chi(\\mathbf{x}, t) $. The initial electric field $ \\mathbf{E}(0) = -\\partial_t\\mathbf{A}(0) - \\nabla\\phi(0) $ is automatically preserved under any such transformation, as $ \\mathbf{E}'(0) = -(\\partial_t\\mathbf{A}(0) + \\nabla\\partial_t\\chi(0)) - (\\nabla\\phi(0) - \\nabla\\partial_t\\chi(0)) = \\mathbf{E}(0) $.\n\nOur goal is to find a gauge function $ \\chi(\\mathbf{x}, 0) $ such that the new vector potential $ \\mathbf{A}'(\\mathbf{x}, 0) $ satisfies the Coulomb gauge condition, $ \\nabla \\cdot \\mathbf{A}'(0) = 0 $. The transformation is performed in Fourier space, where the gradient operator $ \\nabla $ becomes multiplication by $ i\\mathbf{k} $ and the divergence operator $ \\nabla \\cdot $ becomes multiplication by $ i\\mathbf{k} \\cdot $.\n\nThe gauge transformation for the Fourier coefficients of the vector potential at $ t=0 $ is:\n$$ \\mathbf{A}'_{\\mathbf{k}}(0) = \\mathbf{A}_{\\mathbf{k}}(0) + i\\mathbf{k}\\chi_{\\mathbf{k}}(0) $$\nThe Coulomb gauge condition in Fourier space is $ \\mathbf{k} \\cdot \\mathbf{A}'_{\\mathbf{k}}(0) = 0 $. We enforce this by taking the dot product of the transformation equation with $ \\mathbf{k} $:\n$$ \\mathbf{k} \\cdot \\mathbf{A}'_{\\mathbf{k}}(0) = \\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0) + i\\mathbf{k} \\cdot \\mathbf{k}\\chi_{\\mathbf{k}}(0) $$\nSetting the left-hand side to $ 0 $ and using $ \\mathbf{k} \\cdot \\mathbf{k} = |\\mathbf{k}|^2 $, we solve for the required gauge function's Fourier coefficient $ \\chi_{\\mathbf{k}}(0) $:\n$$ 0 = \\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0) + i|\\mathbf{k}|^2\\chi_{\\mathbf{k}}(0) $$\n$$ \\chi_{\\mathbf{k}}(0) = \\frac{i}{|\\mathbf{k}|^2} (\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0)) $$\nThis expression is well-defined for all $ \\mathbf{k} \\in \\mathcal{K} $, since the problem statement specifies $ \\mathcal{K} \\subset \\mathbb{Z}^2 \\setminus \\{\\mathbf{0}\\} $, ensuring $ |\\mathbf{k}|^2 \\neq 0 $.\n\nWe substitute this $ \\chi_{\\mathbf{k}}(0) $ back into the transformation equation for $ \\mathbf{A}'_{\\mathbf{k}}(0) $:\n$$ \\mathbf{A}'_{\\mathbf{k}}(0) = \\mathbf{A}_{\\mathbf{k}}(0) + i\\mathbf{k} \\left( \\frac{i}{|\\mathbf{k}|^2} (\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0)) \\right) $$\n$$ \\mathbf{A}'_{\\mathbf{k}}(0) = \\mathbf{A}_{\\mathbf{k}}(0) - \\frac{\\mathbf{k}(\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0))}{|\\mathbf{k}|^2} $$\nThis is the explicit formula for the projected vector potential. This operation is a manifestation of the Helmholtz decomposition, which separates a vector field into its solenoidal (transverse) and irrotational (longitudinal) parts. The operator $ \\mathcal{P}_{\\parallel, \\mathbf{k}}(\\mathbf{V}) = \\frac{\\mathbf{k}(\\mathbf{k} \\cdot \\mathbf{V})}{|\\mathbf{k}|^2} $ projects a vector $ \\mathbf{V} $ onto its longitudinal component (parallel to $ \\mathbf{k} $), and $ \\mathcal{P}_{\\perp, \\mathbf{k}}(\\mathbf{V}) = \\mathbf{V} - \\mathcal{P}_{\\parallel, \\mathbf{k}}(\\mathbf{V}) $ projects it onto its transverse component. Thus, $ \\mathbf{A}'_{\\mathbf{k}}(0) $ is the purely transverse part of the initial $ \\mathbf{A}_{\\mathbf{k}}(0) $.\n\nPart B: Stability Analysis and Maximum Time Step\n\nThe problem states that the system dynamics are modeled by a set of uncoupled oscillators, one for each component of each Fourier mode. The stability of the explicit second-order central difference time-stepping scheme for an oscillator $ \\partial_t^2 y + \\omega^2 y = 0 $ is given by the condition $ \\Delta t \\cdot \\omega  2 $. For a system of oscillators, the time step $ \\Delta t $ must be small enough to stabilize the highest frequency present in the system, $ \\omega_{\\max} $. This leads to the constraint $ \\Delta t_{\\max} = 2 / \\omega_{\\max} $.\n\nWe analyze the system before and after the gauge projection.\n\nBefore Projection ($ \\Delta t_{\\max}^{\\text{pre}} $):\nThe initial state $ \\mathbf{A}_{\\mathbf{k}}(0) = a_{\\mathbf{k}} (\\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} + g \\hat{\\mathbf{k}}) $ contains both transverse and longitudinal components if $ g0 $. The transverse part evolves with frequency $ \\omega_{\\perp, \\mathbf{k}} = |\\mathbf{k}| $, while the longitudinal part evolves with the penalized frequency $ \\omega_{\\parallel, \\mathbf{k}} = \\sqrt{|\\mathbf{k}|^2 + p} $.\nThe highest frequency excited for a given mode $ \\mathbf{k} $ is $ \\omega_{\\text{pre}, \\mathbf{k}} = \\max(\\omega_{\\perp, \\mathbf{k}}, \\omega_{\\parallel, \\mathbf{k}}) = \\max(|\\mathbf{k}|, \\sqrt{|\\mathbf{k}|^2 + p}) $. Since $ p \\ge 0 $, we have $ \\sqrt{|\\mathbf{k}|^2 + p} \\ge |\\mathbf{k}| $, so $ \\omega_{\\text{pre}, \\mathbf{k}} = \\sqrt{|\\mathbf{k}|^2 + p} $.\nThis is valid if and only if a longitudinal component exists, which is the case for $ g  0 $. If $ g = 0 $, the initial state is purely transverse, and only the transverse frequencies $ \\omega_{\\perp, \\mathbf{k}} = |\\mathbf{k}| $ are excited.\nThe maximum frequency across the entire system is $ \\omega_{\\max}^{\\text{pre}} = \\max_{\\mathbf{k} \\in \\mathcal{K}} \\omega_{\\text{pre}, \\mathbf{k}} $.\n- If $ g  0 $: $ \\omega_{\\max}^{\\text{pre}} = \\max_{\\mathbf{k} \\in \\mathcal{K}} \\sqrt{|\\mathbf{k}|^2 + p} = \\sqrt{(\\max_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k}|)^2 + p} $, because $ \\sqrt{x+p} $ is a monotonic function of $ x=|\\mathbf{k}|^2 $.\n- If $ g = 0 $: $ \\omega_{\\max}^{\\text{pre}} = \\max_{\\mathbf{k} \\in \\mathcalK} |\\mathbf{k}| $.\nThe maximum stable time step is $ \\Delta t_{\\max}^{\\text{pre}} = 2 / \\omega_{\\max}^{\\text{pre}} $.\n\nAfter Projection ($ \\Delta t_{\\max}^{\\text{post}} $):\nThe projection eliminates the longitudinal component of $ \\mathbf{A}_{\\mathbf{k}}(0) $ for all $ \\mathbf{k} $. The dynamics subsequently evolve only the purely transverse potential $ \\mathbf{A}'_{\\mathbf{k}}(0) $. The only frequencies present in the system are the transverse frequencies $ \\omega_{\\perp, \\mathbf{k}} = |\\mathbf{k}| $.\nThe maximum frequency in the projected system is $ \\omega_{\\max}^{\\text{post}} = \\max_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k}| $.\nThe maximum stable time step is therefore $ \\Delta t_{\\max}^{\\text{post}} = 2 / \\omega_{\\max}^{\\text{post}} = 2 / (\\max_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k}|) $.\n\nPart C: Calculation of Metrics\nWe now formalize the computation of the required metrics. Let $ k_{\\max} = \\max_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k}| $.\nThe initial potential is $ \\mathbf{A}_{\\mathbf{k}}(0) = a_{\\mathbf{k}} (\\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} + g \\hat{\\mathbf{k}}) $, where $ a_{\\mathbf{k}} = |\\mathbf{k}|^{-s} $.\n\n1.  Gauge Violation Fraction, $ \\delta $:\n$$ \\delta = \\frac{\\sum_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0)|^2}{\\sum_{\\mathbf{k} \\in \\mathcal{K}} \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2} $$\nThe terms in the sums are $ \\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0) = a_{\\mathbf{k}} g (\\mathbf{k} \\cdot \\hat{\\mathbf{k}}) = g a_{\\mathbf{k}} |\\mathbf{k}| $ and $ \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2 = a_{\\mathbf{k}}^2(1+g^2) $ due to the orthogonality of $ \\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} $ and $ \\hat{\\mathbf{k}} $.\nThus, we compute:\n$$ \\delta = \\frac{g^2 \\sum_{\\mathbf{k} \\in \\mathcal{K}} a_{\\mathbf{k}}^2 |\\mathbf{k}|^2}{(1+g^2) \\sum_{\\mathbf{k} \\in \\mathcal{K}} a_{\\mathbf{k}}^2} $$\n\n2.  Energy Fraction Removed, $ r $:\n$$ r = \\frac{\\sum_{\\mathbf{k} \\in \\mathcal{K}} \\left( \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2 - \\|\\mathbf{A}'_{\\mathbf{k}}(0)\\|^2 \\right)}{\\sum_{\\mathbf{k} \\in \\mathcal{K}} \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2} $$\nThe projected potential is $ \\mathbf{A}'_{\\mathbf{k}}(0) = a_{\\mathbf{k}} \\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} $, so $ \\|\\mathbf{A}'_{\\mathbf{k}}(0)\\|^2 = a_{\\mathbf{k}}^2 $.\nThe numerator is $ \\sum (a_{\\mathbf{k}}^2(1+g^2) - a_{\\mathbf{k}}^2) = \\sum g^2 a_{\\mathbf{k}}^2 = g^2 \\sum a_{\\mathbf{k}}^2 $.\nThe denominator is $ \\sum a_{\\mathbf{k}}^2(1+g^2) = (1+g^2) \\sum a_{\\mathbf{k}}^2 $.\nThe ratio simplifies to:\n$$ r = \\frac{g^2 \\sum a_{\\mathbf{k}}^2}{(1+g^2) \\sum a_{\\mathbf{k}}^2} = \\frac{g^2}{1+g^2} $$\n\n3.  Maximum Stable Time Steps:\nAs derived in Part B:\n$$ \\Delta t_{\\max}^{\\text{pre}} = \\begin{cases} 2 / \\sqrt{k_{\\max}^2 + p}  \\text{if } g  0 \\\\ 2 / k_{\\max}  \\text{if } g = 0 \\end{cases} $$\n$$ \\Delta t_{\\max}^{\\text{post}} = \\frac{2}{k_{\\max}} $$\n\n4.  Improvement Factor, $ f $:\nThe factor $ f $ quantifies the benefit of the projection on the time step constraint.\n$$ f = \\frac{\\Delta t_{\\max}^{\\text{post}}}{\\Delta t_{\\max}^{\\text{pre}}} = \\begin{cases} (2/k_{\\max}) / (2/\\sqrt{k_{\\max}^2+p}) = \\sqrt{1 + p/k_{\\max}^2}  \\text{if } g  0 \\\\ (2/k_{\\max}) / (2/k_{\\max}) = 1  \\text{if } g = 0 \\end{cases} $$\n\nThese formulae are implemented for each test case to produce the final numerical results.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the plasma turbulence initial value problem for the given test cases.\n\n    This function iterates through a predefined test suite. For each case, it\n    implements the gauge projection at t=0 and computes five metrics:\n    - delta: The gauge violation fraction.\n    - r: The energy fraction removed by the projection.\n    - dt_max_pre: The maximum stable time step before projection.\n    - dt_max_post: The maximum stable time step after projection.\n    - f: The improvement factor in the time step.\n\n    The results are formatted and printed as specified in the problem statement.\n    \"\"\"\n    test_cases = [\n        # Case 1: Happy path\n        {'k_vectors': np.array([[1, 0], [0, 1], [1, 1], [2, 1], [2, 2]]), 'g': 0.2, 's': 1.0, 'p': 10.0},\n        # Case 2: Boundary condition, zero contamination\n        {'k_vectors': np.array([[1, 0], [0, 1], [1, 1], [2, 1], [2, 2]]), 'g': 0.0, 's': 1.0, 'p': 10.0},\n        # Case 3: Edge case, no penalty\n        {'k_vectors': np.array([[1, 0], [0, 1], [1, 1], [2, 1], [2, 2]]), 'g': 0.2, 's': 1.0, 'p': 0.0},\n        # Case 4: Edge case, high wave numbers and strong penalty\n        {'k_vectors': np.array([[1, 0], [0, 1], [1, 1], [2, 1], [2, 2], [4, 4], [8, 8]]), 'g': 0.5, 's': 0.0, 'p': 50.0},\n    ]\n\n    all_results = []\n    for case in test_cases:\n        k_vectors = case['k_vectors']\n        g = case['g']\n        s = case['s']\n        p = case['p']\n\n        # Calculate magnitudes |k| and amplitudes a_k = |k|^-s\n        k_mags = np.linalg.norm(k_vectors, axis=1)\n        a_k = k_mags**(-s)\n\n        # Part C: Metric Calculations\n        \n        # 1. Gauge violation fraction, delta\n        # Numerator: sum(|k_dot_A_k|^2) = sum((g * a_k * |k|)^2)\n        numerator_delta = np.sum((g * a_k * k_mags)**2)\n        # Denominator: sum(||A_k||^2) = sum(a_k^2 * (1 + g^2))\n        denominator_delta = np.sum(a_k**2 * (1 + g**2))\n        \n        if denominator_delta == 0.0:\n            delta = 0.0  # Should not happen for k != 0\n        else:\n            delta = numerator_delta / denominator_delta\n\n        # 2. Energy fraction removed, r\n        # Simplifies to g^2 / (1 + g^2)\n        r = g**2 / (1 + g**2)\n\n        # 3. Maximum stable time step before projection, dt_max_pre\n        k_max = np.max(k_mags)\n        if g > 0:\n            # Longitudinal modes are present and have frequency sqrt(|k|^2 + p)\n            # The max frequency is determined by k_max\n            omega_max_pre = np.sqrt(k_max**2 + p)\n        else:\n            # Only transverse modes are present, frequency is |k|\n            omega_max_pre = k_max\n        \n        dt_max_pre = 2.0 / omega_max_pre\n\n        # 4. Maximum stable time step after projection, dt_max_post\n        # After projection, only transverse modes remain, so max frequency is k_max\n        dt_max_post = 2.0 / k_max\n\n        # 5. Improvement factor, f\n        # Handles the case where dt_max_pre might be zero, although not possible here\n        if dt_max_pre == 0.0:\n            f = np.inf if dt_max_post > 0 else 1.0\n        else:\n            f = dt_max_post / dt_max_pre\n\n        case_result = [delta, r, dt_max_pre, dt_max_post, f]\n        all_results.append(case_result)\n    \n    # Format the final output string exactly as required\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "A successful simulation begins with a valid initial state, and verifying this state is a crucial step in the computational workflow. This practice guides you through creating a \"pre-flight checklist\" of diagnostics to ensure your initial fields are consistent with the fundamental physical model, in this case, the Darwin approximation for a quasineutral plasma . By implementing routines to check the residuals for quasineutrality, Ampère's law, and the solenoidal condition $\\nabla \\cdot \\mathbf{B}=0$ against numerical tolerances, you will develop the professional discipline needed to ensure the fidelity of your simulations from $t=0$.",
            "id": "4192199",
            "problem": "You are tasked with formulating and implementing a set of initial-time diagnostics for a fusion plasma turbulence simulation in the low-frequency Darwin approximation. The goal is to check, at $t=0$, that the initial data satisfy three constraints derived from Maxwell's equations and charge neutrality, and to decide acceptance based on prescribed numerical thresholds. Your program must compute three residuals: the quasineutrality residual, the Ampère residual (without displacement current under the Darwin approximation), and the magnetic-field divergence residual, using a three-dimensional periodic grid and Fourier spectral derivatives. All variables are in dimensionless units consistent with a chosen normalization (for example, reference density, magnetic field, and length scales absorbed into dimensionless definitions). Thresholds are dimensionless. No physical units conversion is required, and no angles or percentages are involved.\n\nFundamental laws and core definitions:\n- Charge neutrality in a quasineutral plasma requires the net charge density to be negligible, which, for electrons and a single ion species, is $q_i n_i + q_e n_e \\approx 0$, where $q_i = Z_i e$ and $q_e = -e$.\n- Ampère's law under the Darwin approximation (neglecting the displacement current) is $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$.\n- The magnetic field must be solenoidal, $\\nabla \\cdot \\mathbf{B} = 0$.\n\nDomain, discretization, and norms:\n- Let the computational domain be periodic on $[0,L_x) \\times [0,L_y) \\times [0,L_z)$, with a uniform grid of $N_x \\times N_y \\times N_z$ points. Use Fourier spectral differentiation, i.e., compute derivatives via multiplication by $i \\mathbf{k}$ in Fourier space, where the wavevector components are $k_x = \\frac{2\\pi n_x}{L_x}$, $k_y = \\frac{2\\pi n_y}{L_y}$, $k_z = \\frac{2\\pi n_z}{L_z}$, with integer indices $n_x, n_y, n_z$ consistent with the discrete Fourier transform.\n- For any scalar or vector field $f(\\mathbf{x})$ sampled on the grid, define the discrete root-mean-square norm by $\\| f \\|_2 = \\left( \\frac{1}{N_x N_y N_z} \\sum_{j=1}^{N_x N_y N_z} | f_j |^2 \\right)^{1/2}$.\n\nDiagnostics to implement:\n1. Quasineutrality residual:\n   $$R_{\\mathrm{QN}} = \\frac{\\| \\rho \\|_2}{\\| |q_i| n_i \\|_2 + \\| |q_e| n_e \\|_2}, \\quad \\rho = q_i n_i + q_e n_e.$$\n2. Ampère residual (Darwin approximation):\n   $$R_{\\mathrm{A}} = \\frac{ \\| \\nabla \\times \\mathbf{B} - \\mu_0 \\mathbf{J} \\|_2 }{ \\| \\nabla \\times \\mathbf{B} \\|_2 + \\| \\mu_0 \\mathbf{J} \\|_2 }.$$\n3. Magnetic divergence residual:\n   $$R_{\\mathrm{divB}} = \\frac{ \\| \\nabla \\cdot \\mathbf{B} \\|_2 }{ \\| \\mathbf{B} \\|_2 / L_{\\mathrm{ref}} }, \\quad L_{\\mathrm{ref}} = \\min(L_x, L_y, L_z).$$\n\nAcceptance thresholds:\n- The initial data are accepted if simultaneously $R_{\\mathrm{QN}} \\leq \\epsilon_{\\mathrm{QN}}$, $R_{\\mathrm{A}} \\leq \\epsilon_{\\mathrm{A}}$, and $R_{\\mathrm{divB}} \\leq \\epsilon_{\\mathrm{divB}}$, with the following numerical thresholds:\n  - $\\epsilon_{\\mathrm{QN}} = 10^{-6}$,\n  - $\\epsilon_{\\mathrm{A}} = 10^{-6}$,\n  - $\\epsilon_{\\mathrm{divB}} = 10^{-8}$.\n\nTest suite:\nImplement a periodic domain with dimensionless lengths $L_x = 1$, $L_y = 1$, $L_z = 1$, and a single ion species with charge number $Z_i = 1$, so $q_i = +1$ and $q_e = -1$, and permeability $\\mu_0 = 1$. Construct fields as follows:\n- Use a vector potential $\\mathbf{A}(\\mathbf{x})$ with only a $z$-component $A_z(\\mathbf{x}) = A_0 \\sin(2\\pi x/L_x)\\sin(2\\pi y/L_y)$, and define $\\mathbf{B} = \\nabla \\times \\mathbf{A}$ via spectral differentiation, so $B_x = \\partial A_z/\\partial y$, $B_y = -\\partial A_z/\\partial x$, $B_z = 0$.\n- Define the ion density $n_i(\\mathbf{x}) = n_0 \\left( 1 + 0.1 \\cos(2\\pi x/L_x)\\cos(2\\pi y/L_y)\\cos(2\\pi z/L_z) \\right)$ with $n_0 = 1$.\n- Define the electron density $n_e(\\mathbf{x}) = Z_i n_i(\\mathbf{x}) + \\delta_{\\mathrm{QN}}$, where $\\delta_{\\mathrm{QN}}$ is a spatially uniform offset controlling quasineutrality mismatch.\n- Define the current density $\\mathbf{J}(\\mathbf{x}) = (1+\\gamma_{\\mathrm{A}}) \\frac{1}{\\mu_0} \\nabla \\times \\mathbf{B}(\\mathbf{x})$, where $\\gamma_{\\mathrm{A}}$ controls Ampère mismatch.\n- Optionally break $\\nabla \\cdot \\mathbf{B} = 0$ by adding a gradient component, $\\mathbf{B} \\leftarrow \\mathbf{B} + \\nabla \\phi$, with $\\phi(\\mathbf{x}) = \\epsilon_{\\mathrm{div}} \\cos(2\\pi x/L_x)$ and $\\epsilon_{\\mathrm{div}}$ controlling the divergence error.\n\nDefine $4$ test cases with the following parameters:\n- Case $1$ (happy path): $N_x=N_y=N_z=16$, $A_0=0.3$, $\\delta_{\\mathrm{QN}}=0$, $\\gamma_{\\mathrm{A}}=0$, $\\epsilon_{\\mathrm{div}}=0$.\n- Case $2$ (near-threshold small mismatches): $N_x=N_y=N_z=16$, $A_0=0.3$, $\\delta_{\\mathrm{QN}}=5\\times 10^{-7}$, $\\gamma_{\\mathrm{A}}=2\\times 10^{-7}$, $\\epsilon_{\\mathrm{div}}=10^{-9}$.\n- Case $3$ (fails constraints): $N_x=N_y=N_z=16$, $A_0=0.3$, $\\delta_{\\mathrm{QN}}=10^{-3}$, $\\gamma_{\\mathrm{A}}=10^{-2}$, $\\epsilon_{\\mathrm{div}}=10^{-3}$.\n- Case $4$ (higher resolution happy path): $N_x=N_y=N_z=64$, $A_0=0.3$, $\\delta_{\\mathrm{QN}}=0$, $\\gamma_{\\mathrm{A}}=0$, $\\epsilon_{\\mathrm{div}}=0$.\n\nYour program must:\n- For each case, construct the fields and compute $R_{\\mathrm{QN}}$, $R_{\\mathrm{A}}$, and $R_{\\mathrm{divB}}$ using Fourier spectral derivatives and the discrete norms above.\n- Decide acceptance for the case by checking the thresholds.\n- Produce a single line of output containing the acceptance decisions for all $4$ cases as a comma-separated list enclosed in square brackets, for example, $[{\\rm True},{\\rm False},{\\rm True},{\\rm True}]$.\n\nYour implementation must be fully self-contained and must not require any input. The final outputs are dimensionless booleans indicating acceptance of initial data at $t=0$ based on the specified thresholds.",
            "solution": "The task is to implement a set of initial-time diagnostics for a fusion plasma turbulence simulation. This involves verifying that the initial conditions for the physical fields conform to three fundamental constraints: plasma quasineutrality, the Darwin-approximated Ampère's law, and the solenoidal condition for the magnetic field. The verification is performed by computing three normalized residuals, $R_{\\mathrm{QN}}$, $R_{\\mathrm{A}}$, and $R_{\\mathrm{divB}}$, and comparing them against given numerical thresholds $\\epsilon_{\\mathrm{QN}}$, $\\epsilon_{\\mathrm{A}}$, and $\\epsilon_{\\mathrm{divB}}$.\n\nThe formulation is based on a three-dimensional periodic domain $[0, L_x) \\times [0, L_y) \\times [0, L_z)$, discretized on a uniform grid of $N_x \\times N_y \\times N_z$ points. All spatial derivatives required for the physical laws are computed using the Fourier spectral method. This method is highly accurate for smooth, periodic functions. It involves transforming a field to Fourier space, performing differentiation by multiplying with the imaginary unit $i$ and the corresponding wavevector component, and then transforming back to real space.\n\nThe wavevector $\\mathbf{k} = (k_x, k_y, k_z)$ for a discrete Fourier transform (DFT) on a grid of size $N_x \\times N_y \\times N_z$ over a domain of size $L_x \\times L_y \\times L_z$ has components:\n$$k_j = \\frac{2\\pi n_j}{L_j}, \\quad n_j \\in \\left\\{-\\frac{N_j}{2}, \\dots, \\frac{N_j}{2}-1\\right\\}, \\quad j \\in \\{x, y, z\\}$$\nThese wave numbers are provided by standard FFT libraries. Using these, the gradient, divergence, and curl operators are implemented as follows for a scalar field $f$ and a vector field $\\mathbf{F}$:\n- $\\nabla f(\\mathbf{x}) \\iff i\\mathbf{k} \\hat{f}(\\mathbf{k})$\n- $\\nabla \\cdot \\mathbf{F}(\\mathbf{x}) \\iff i\\mathbf{k} \\cdot \\hat{\\mathbf{F}}(\\mathbf{k})$\n- $\\nabla \\times \\mathbf{F}(\\mathbf{x}) \\iff i\\mathbf{k} \\times \\hat{\\mathbf{F}}(\\mathbf{k})$\nwhere $\\hat{f}$ and $\\hat{\\mathbf{F}}$ are the Fourier representations of the fields, and $\\iff$ denotes the Fourier transform pair.\n\nFor quantifying the magnitude of the fields and their residuals, the discrete root-mean-square norm is employed. For any field $f$ sampled on the grid, its norm is:\n$$ \\| f \\|_2 = \\left( \\frac{1}{N_x N_y N_z} \\sum_{j=1}^{N_x N_y N_z} | f_j |^2 \\right)^{1/2} $$\nwhere the sum is over all grid points. For a vector field $\\mathbf{F} = (F_x, F_y, F_z)$, the squared magnitude is $|f_j|^2 = |F_{x,j}|^2 + |F_{y,j}|^2 + |F_{z,j}|^2$.\n\nThe procedure for each test case is as follows:\n1.  **Construct Fields**: Based on the test case parameters ($N_x, N_y, N_z, A_0, \\delta_{\\mathrm{QN}}, \\gamma_{\\mathrm{A}}, \\epsilon_{\\mathrm{div}}$) and constants ($L_x=L_y=L_z=1$, $Z_i=1$, $\\mu_0=1$, $n_0=1$), the initial physical fields are constructed on the grid.\n    -   A real-space grid $(x,y,z)$ is generated.\n    -   Ion density $n_i(\\mathbf{x}) = n_0 ( 1 + 0.1 \\cos(2\\pi x/L_x)\\cos(2\\pi y/L_y)\\cos(2\\pi z/L_z) )$.\n    -   Electron density $n_e(\\mathbf{x}) = Z_i n_i(\\mathbf{x}) + \\delta_{\\mathrm{QN}}$. With $q_i=1, q_e=-1$, the charge density is $\\rho = q_i n_i + q_e n_e = n_i - n_e = -\\delta_{\\mathrm{QN}}$.\n    -   The vector potential $\\mathbf{A}$ is given by $A_z(\\mathbf{x}) = A_0 \\sin(2\\pi x/L_x)\\sin(2\\pi y/L_y)$ and $A_x = A_y = 0$. The magnetic field $\\mathbf{B}$ is computed from $\\mathbf{B}_{\\text{curl}} = \\nabla \\times \\mathbf{A}$ using the spectral curl operator.\n    -   To test the divergence constraint, a non-solenoidal component is added: $\\mathbf{B} = \\mathbf{B}_{\\text{curl}} + \\nabla \\phi$, where $\\phi(\\mathbf{x}) = \\epsilon_{\\mathrm{div}} \\cos(2\\pi x/L_x)$. The gradient $\\nabla\\phi$ is computed spectrally.\n    -   The current density $\\mathbf{J}$ is defined via a controlled mismatch with Ampère's law: $\\mathbf{J} = (1+\\gamma_{\\mathrm{A}}) \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{B})$, where $\\nabla \\times \\mathbf{B}$ is computed from the final $\\mathbf{B}$ field using the spectral curl operator.\n\n2.  **Compute Residuals**: The three residuals are calculated using the constructed fields.\n    -   **Quasineutrality Residual $R_{\\mathrm{QN}}$**: This measures the deviation from charge neutrality.\n        $$ R_{\\mathrm{QN}} = \\frac{\\| \\rho \\|_2}{\\| |q_i| n_i \\|_2 + \\| |q_e| n_e \\|_2} = \\frac{\\| n_i - n_e \\|_2}{\\| n_i \\|_2 + \\| n_e \\|_2} $$\n        The denominator, containing the sum of the norms of the positive and negative charge densities, provides a natural scale for the charge density $\\rho$.\n    -   **Ampère Residual $R_{\\mathrm{A}}$**: This measures the inconsistency in the Darwin-approximated Ampère's law, $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$.\n        $$ R_{\\mathrm{A}} = \\frac{ \\| \\nabla \\times \\mathbf{B} - \\mu_0 \\mathbf{J} \\|_2 }{ \\| \\nabla \\times \\mathbf{B} \\|_2 + \\| \\mu_0 \\mathbf{J} \\|_2 } $$\n        The numerator is the norm of the local error in the law. By construction, $\\nabla \\times \\mathbf{B} - \\mu_0 \\mathbf{J} = \\nabla \\times \\mathbf{B} - \\mu_0 (1+\\gamma_{\\mathrm{A}}) \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{B}) = -\\gamma_{\\mathrm{A}} (\\nabla \\times \\mathbf{B})$. The normalization factor is the sum of the norms of the two terms in the equation, making the residual a relative error measure bounded between $0$ and $1$.\n    -   **Magnetic Divergence Residual $R_{\\mathrm{divB}}$**: This quantifies the violation of the solenoidal condition $\\nabla \\cdot \\mathbf{B} = 0$.\n        $$ R_{\\mathrm{divB}} = \\frac{ \\| \\nabla \\cdot \\mathbf{B} \\|_2 }{ \\| \\mathbf{B} \\|_2 / L_{\\mathrm{ref}} } $$\n        Here, $L_{\\mathrm{ref}} = \\min(L_x, L_y, L_z)$ is a characteristic length scale of the domain. The denominator $\\| \\mathbf{B} \\|_2 / L_{\\mathrm{ref}}$ represents a characteristic magnitude of the divergence that would be obtained if $\\mathbf{B}$ varied on the scale $L_{\\mathrm{ref}}$, thus making $R_{\\mathrm{divB}}$ a dimensionless measure of the field's non-solenoidal component. Since $\\nabla \\cdot (\\nabla \\times \\mathbf{A}) = 0$, any non-zero divergence comes from the added gradient term: $\\nabla \\cdot \\mathbf{B} = \\nabla \\cdot (\\nabla\\phi) = \\nabla^2\\phi$.\n\n3.  **Acceptance Decision**: The computed residuals are compared to their respective thresholds: $\\epsilon_{\\mathrm{QN}} = 10^{-6}$, $\\epsilon_{\\mathrm{A}} = 10^{-6}$, and $\\epsilon_{\\mathrm{divB}} = 10^{-8}$. The initial data for a test case is deemed \"accepted\" (True) if and only if all three conditions are met simultaneously:\n    $$ R_{\\mathrm{QN}} \\le \\epsilon_{\\mathrm{QN}} \\quad \\text{and} \\quad R_{\\mathrm{A}} \\le \\epsilon_{\\mathrm{A}} \\quad \\text{and} \\quad R_{\\mathrm{divB}} \\le \\epsilon_{\\mathrm{divB}} $$\n    Otherwise, it is \"rejected\" (False). This procedure is repeated for all four specified test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the diagnostics for all test cases and print the results.\n    \"\"\"\n    # Define the acceptance thresholds from the problem statement.\n    thresholds = {\n        'qn': 1e-6,\n        'a': 1e-6,\n        'divb': 1e-8,\n    }\n\n    # Define the 4 test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path)\n        {'N': 16, 'A0': 0.3, 'delta_qn': 0.0, 'gamma_a': 0.0, 'eps_div': 0.0},\n        # Case 2 (near-threshold small mismatches)\n        {'N': 16, 'A0': 0.3, 'delta_qn': 5e-7, 'gamma_a': 2e-7, 'eps_div': 1e-9},\n        # Case 3 (fails constraints)\n        {'N': 16, 'A0': 0.3, 'delta_qn': 1e-3, 'gamma_a': 1e-2, 'eps_div': 1e-3},\n        # Case 4 (higher resolution happy path)\n        {'N': 64, 'A0': 0.3, 'delta_qn': 0.0, 'gamma_a': 0.0, 'eps_div': 0.0},\n    ]\n\n    results = []\n    for params in test_cases:\n        accepted = run_case(params, thresholds)\n        results.append(accepted)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_case(params, thresholds):\n    \"\"\"\n    Constructs fields, computes residuals, and decides acceptance for a single case.\n    \"\"\"\n    # Unpack parameters\n    N = params['N']\n    Nx, Ny, Nz = N, N, N\n    A0, delta_qn, gamma_a, eps_div = params['A0'], params['delta_qn'], params['gamma_a'], params['eps_div']\n    \n    # Constants\n    Lx, Ly, Lz = 1.0, 1.0, 1.0\n    qi, qe = 1.0, -1.0\n    mu0 = 1.0\n    n0 = 1.0\n    L_ref = min(Lx, Ly, Lz)\n\n    # Setup grids\n    x_1d = np.linspace(0, Lx, Nx, endpoint=False)\n    y_1d = np.linspace(0, Ly, Ny, endpoint=False)\n    z_1d = np.linspace(0, Lz, Nz, endpoint=False)\n    x, y, z = np.meshgrid(x_1d, y_1d, z_1d, indexing='ij')\n\n    # Setup wavevectors\n    kx_1d = 2 * np.pi * np.fft.fftfreq(Nx, d=Lx/Nx)\n    ky_1d = 2 * np.pi * np.fft.fftfreq(Ny, d=Ly/Ny)\n    kz_1d = 2 * np.pi * np.fft.fftfreq(Nz, d=Lz/Nz)\n    kx, ky, kz = np.meshgrid(kx_1d, ky_1d, kz_1d, indexing='ij')\n    k_vectors = (kx, ky, kz)\n\n    # --- Field Construction ---\n    \n    # Densities ni, ne\n    ni = n0 * (1 + 0.1 * np.cos(2 * np.pi * x / Lx) * np.cos(2 * np.pi * y / Ly) * np.cos(2 * np.pi * z / Lz))\n    ne = qi * ni + delta_qn\n\n    # Magnetic field B\n    Ax, Ay, Az = np.zeros_like(x), np.zeros_like(y), A0 * np.sin(2 * np.pi * x / Lx) * np.sin(2 * np.pi * y / Ly)\n    Bx_curl, By_curl, Bz_curl = spectral_curl(Ax, Ay, Az, k_vectors)\n    \n    Bx, By, Bz = Bx_curl, By_curl, Bz_curl\n    if eps_div != 0:\n        phi = eps_div * np.cos(2 * np.pi * x / Lx)\n        grad_phi_x, grad_phi_y, grad_phi_z = spectral_grad(phi, k_vectors)\n        Bx += grad_phi_x\n        By += grad_phi_y\n        Bz += grad_phi_z\n\n    # Current density J\n    curl_B_x, curl_B_y, curl_B_z = spectral_curl(Bx, By, Bz, k_vectors)\n    Jx = (1 + gamma_a) / mu0 * curl_B_x\n    Jy = (1 + gamma_a) / mu0 * curl_B_y\n    Jz = (1 + gamma_a) / mu0 * curl_B_z\n    \n    # --- Residual Calculation ---\n\n    # R_QN\n    rho = qi * ni + qe * ne\n    R_qn = rms_norm_scalar(rho) / (rms_norm_scalar(np.abs(qi) * ni) + rms_norm_scalar(np.abs(qe) * ne))\n\n    # R_A\n    mu0_Jx, mu0_Jy, mu0_Jz = mu0 * Jx, mu0 * Jy, mu0 * Jz\n    numerator_A = rms_norm_vector(curl_B_x - mu0_Jx, curl_B_y - mu0_Jy, curl_B_z - mu0_Jz)\n    denominator_A = rms_norm_vector(curl_B_x, curl_B_y, curl_B_z) + rms_norm_vector(mu0_Jx, mu0_Jy, mu0_Jz)\n    R_a = numerator_A / denominator_A if denominator_A > 0 else 0.0\n\n    # R_divB\n    div_B = spectral_div(Bx, By, Bz, k_vectors)\n    numerator_divB = rms_norm_scalar(div_B)\n    norm_B = rms_norm_vector(Bx, By, Bz)\n    denominator_divB = norm_B / L_ref\n    R_divb = numerator_divB / denominator_divB if denominator_divB > 0 else 0.0\n    \n    # --- Acceptance Decision ---\n    is_accepted = (R_qn = thresholds['qn']) and \\\n                  (R_a = thresholds['a']) and \\\n                  (R_divb = thresholds['divb'])\n                  \n    return is_accepted\n\n# --- Helper Functions ---\n\ndef rms_norm_scalar(field):\n    return np.sqrt(np.mean(field**2))\n\ndef rms_norm_vector(fx, fy, fz):\n    return np.sqrt(np.mean(fx**2 + fy**2 + fz**2))\n\ndef spectral_grad(f, k_vectors):\n    kx, ky, kz = k_vectors\n    f_hat = np.fft.fftn(f)\n    grad_x = np.fft.ifftn(1j * kx * f_hat).real\n    grad_y = np.fft.ifftn(1j * ky * f_hat).real\n    grad_z = np.fft.ifftn(1j * kz * f_hat).real\n    return grad_x, grad_y, grad_z\n\ndef spectral_div(fx, fy, fz, k_vectors):\n    kx, ky, kz = k_vectors\n    fx_hat = np.fft.fftn(fx)\n    fy_hat = np.fft.fftn(fy)\n    fz_hat = np.fft.fftn(fz)\n    div_f_hat = 1j * kx * fx_hat + 1j * ky * fy_hat + 1j * kz * fz_hat\n    return np.fft.ifftn(div_f_hat).real\n\ndef spectral_curl(fx, fy, fz, k_vectors):\n    kx, ky, kz = k_vectors\n    fx_hat = np.fft.fftn(fx)\n    fy_hat = np.fft.fftn(fy)\n    fz_hat = np.fft.fftn(fz)\n    curl_x = np.fft.ifftn(1j * ky * fz_hat - 1j * kz * fy_hat).real\n    curl_y = np.fft.ifftn(1j * kz * fx_hat - 1j * kx * fz_hat).real\n    curl_z = np.fft.ifftn(1j * kx * fy_hat - 1j * ky * fx_hat).real\n    return curl_x, curl_y, curl_z\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}