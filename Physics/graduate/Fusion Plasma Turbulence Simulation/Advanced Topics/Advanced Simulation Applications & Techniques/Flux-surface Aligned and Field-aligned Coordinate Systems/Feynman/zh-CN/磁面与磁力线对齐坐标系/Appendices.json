{
    "hands_on_practices": [
        {
            "introduction": "在曲线坐标系中进行任何分析，都始于理解其基本几何性质。本练习旨在实践计算度规张量系数和雅可比行列式，这对于在磁流形对齐坐标系中定义距离、面积、体积和微分算子至关重要。通过掌握这些基础量，你将为后续更复杂的物理计算打下坚实的基础 。",
            "id": "4189287",
            "problem": "在用于聚变等离子体湍流模拟的磁通面对齐和场向对齐坐标系的背景下，考虑一个大环径比的圆形托卡马克。设该托卡马克的大半径为 $R_{0}$，小半径坐标为 $r$，极向角为 $\\theta$，环向角为 $\\phi$。假设磁通面是圆形且同心的，并且 $r/R_{0} \\ll 1$（大环径比）。使用由 $R = R_{0} + r \\cos\\theta$ 和 $Z = r \\sin\\theta$ 给出的到柱坐标 $(R,Z,\\phi)$ 的几何嵌入，其中 $\\theta$ 和 $\\phi$ 以弧度为单位。\n\n引入磁通面坐标 $(\\psi,\\theta,\\phi)$，其中 $\\psi$ 是一个关于 $r$ 的单调极向磁通函数，并且在指定的磁通面上，其梯度的模已知为 $|\\nabla \\psi|$。坐标度规系数 $g_{ij}$ 定义为 $g_{ij} = \\partial \\boldsymbol{x}/\\partial u_{i} \\cdot \\partial \\boldsymbol{x}/\\partial u_{j}$，其中 $\\boldsymbol{x}$ 是位置矢量，$(u_{1},u_{2},u_{3})$ 表示坐标。坐标系 $(u_{1},u_{2},u_{3})$ 的体雅可比行列式定义为 $J = \\left|\\frac{\\partial \\boldsymbol{x}}{\\partial u_{1}} \\times \\frac{\\partial \\boldsymbol{x}}{\\partial u_{2}} \\cdot \\frac{\\partial \\boldsymbol{x}}{\\partial u_{3}}\\right|$，因此体元为 $\\mathrm{d}V = J\\,\\mathrm{d}u_{1}\\mathrm{d}u_{2}\\mathrm{d}u_{3}$。\n\n从这些定义和上述几何嵌入出发，推导在大环径比圆形极限下，磁通面上度规系数 $g_{\\theta\\theta}$、$g_{\\phi\\phi}$ 和 $g_{\\theta\\phi}$ 的领头阶表达式，并估计 $(\\psi,\\theta,\\phi)$ 的磁通坐标雅可比行列式 $J$ 到 $r/R_{0}$ 的领头阶。然后，对于 $R_{0} = 1.7\\,\\mathrm{m}$、$r = 0.35\\,\\mathrm{m}$ 和 $|\\nabla \\psi| = 12\\,\\mathrm{Wb/m}$，对这些表达式进行数值计算。将您的答案四舍五入到四位有效数字。将 $g_{\\theta\\theta}$ 和 $g_{\\phi\\phi}$ 以 $\\mathrm{m}^{2}$ 为单位表示，将 $J$ 以 $\\mathrm{m}^{3}/\\mathrm{Wb}$ 为单位表示。以单行矩阵的形式提供您的最终答案，顺序为 $\\left(g_{\\theta\\theta},\\,g_{\\phi\\phi},\\,g_{\\theta\\phi},\\,J\\right)$。",
            "solution": "用户请求解答一个等离子体物理问题。作为一名严谨的教授，我必须首先验证问题陈述的有效性。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   **系统**：大环径比圆形托卡马克。\n-   **参数**：大半径 $R_{0}$，小半径坐标 $r$。\n-   **坐标**：极向角 $\\theta$，环向角 $\\phi$。\n-   **假设**：大环径比，$r/R_{0} \\ll 1$。\n-   **几何嵌入**：柱坐标 $(R,Z,\\phi)$ 定义为 $R = R_{0} + r \\cos\\theta$ 和 $Z = r \\sin\\theta$。\n-   **磁通坐标**：$(\\psi,\\theta,\\phi)$，其中 $\\psi$ 是一个关于 $r$ 的单调极向磁通函数。\n-   **已知量**：在给定的磁通面上，磁通函数梯度的模为 $|\\nabla \\psi|$。\n-   **定义**：\n    -   度规系数：$g_{ij} = \\frac{\\partial \\boldsymbol{x}}{\\partial u_{i}} \\cdot \\frac{\\partial \\boldsymbol{x}}{\\partial u_{j}}$。\n    -   雅可比行列式：$J = \\left|\\frac{\\partial \\boldsymbol{x}}{\\partial u_{1}} \\times \\frac{\\partial \\boldsymbol{x}}{\\partial u_{2}} \\cdot \\frac{\\partial \\boldsymbol{x}}{\\partial u_{3}}\\right|$。\n-   **任务**：\n    1.  在大环径比极限下，推导 $g_{\\theta\\theta}$、$g_{\\phi\\phi}$ 和 $g_{\\theta\\phi}$ 的领头阶表达式。\n    2.  估计 $(\\psi,\\theta,\\phi)$ 的磁通坐标雅可比行列式 $J$ 到 $r/R_{0}$ 的领头阶。\n    3.  对这些表达式进行数值计算。\n-   **数值**：$R_{0} = 1.7\\,\\mathrm{m}$，$r = 0.35\\,\\mathrm{m}$，$|\\nabla \\psi| = 12\\,\\mathrm{Wb/m}$。\n-   **输出要求**：\n    -   将数值答案四舍五入到四位有效数字。\n    -   以单行矩阵 $(g_{\\theta\\theta},\\,g_{\\phi\\phi},\\,g_{\\theta\\phi},\\,J)$ 的形式表示最终答案。\n    -   数值的单位：$g_{\\theta\\theta}$、$g_{\\phi\\phi}$ 的单位为 $\\mathrm{m}^{2}$；$J$ 的单位为 $\\mathrm{m}^{3}/\\mathrm{Wb}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题基于大环径比圆形托卡马克的标准且成熟的模型，这是入门等离子体物理和聚变研究的基石。度规系数和雅可比行列式的定义在微分几何和物理学中是标准的。所有概念在科学上都是合理的。\n-   **适定性**：问题提供了所有必要信息。通过 $|\\nabla \\psi|$ 充分定义了 $\\psi$ 和 $r$ 之间的关系。任务清晰，并且在此背景下对“领头阶”的标准解释下，可以得到唯一解。\n-   **客观性**：问题以精确、客观、技术性的语言陈述，不含任何主观或有偏见的成分。\n\n该问题不违反任何无效标准。它在科学上是合理的、适定的、客观的，并且是可形式化的。提供的数值描述了一个物理上合理的中型托卡马克。逆环径比为 $\\epsilon = r/R_0 = 0.35/1.7 \\approx 0.206$，这个值足够小，可以证明大环径比近似的合理性。\n\n**步骤 3：结论与行动**\n该问题是**有效的**。将提供完整解答。\n\n### 解答\n\n在笛卡尔坐标 $(x,y,z)$ 中的位置矢量 $\\boldsymbol{x}$ 可以用给定的环形几何表示。从柱坐标 $(R, Z, \\phi)$ 到笛卡尔坐标的变换是 $x = R\\cos\\phi$，$y = R\\sin\\phi$ 和 $z = Z$。代入 $R$ 和 $Z$ 的表达式：\n$$ \\boldsymbol{x}(\\theta, \\phi; r) = \\begin{pmatrix} (R_{0} + r \\cos\\theta)\\cos\\phi \\\\ (R_{0} + r \\cos\\theta)\\sin\\phi \\\\ r \\sin\\theta \\end{pmatrix} $$\n在单个磁通面上进行计算时，$r$ 相对于 $\\theta$ 和 $\\phi$ 是常数。\n\n**1. 度规系数的推导**\n\n度规系数 $g_{ij}$ 是基矢 $\\partial\\boldsymbol{x}/\\partial u_i$ 的点积。我们关心的是坐标 $u_2=\\theta$ 和 $u_3=\\phi$。\n\n关于 $\\theta$ 的偏导数为：\n$$ \\frac{\\partial \\boldsymbol{x}}{\\partial \\theta} = \\begin{pmatrix} -r \\sin\\theta \\cos\\phi \\\\ -r \\sin\\theta \\sin\\phi \\\\ r \\cos\\theta \\end{pmatrix} $$\n关于 $\\phi$ 的偏导数为：\n$$ \\frac{\\partial \\boldsymbol{x}}{\\partial \\phi} = \\begin{pmatrix} -(R_{0} + r \\cos\\theta) \\sin\\phi \\\\ (R_{0} + r \\cos\\theta) \\cos\\phi \\\\ 0 \\end{pmatrix} $$\n\n现在我们计算所需的度规系数：\n$g_{\\theta\\theta} = \\frac{\\partial \\boldsymbol{x}}{\\partial \\theta} \\cdot \\frac{\\partial \\boldsymbol{x}}{\\partial \\theta} = (-r \\sin\\theta \\cos\\phi)^2 + (-r \\sin\\theta \\sin\\phi)^2 + (r \\cos\\theta)^2$\n$$ g_{\\theta\\theta} = r^2\\sin^2\\theta(\\cos^2\\phi + \\sin^2\\phi) + r^2\\cos^2\\theta = r^2\\sin^2\\theta + r^2\\cos^2\\theta = r^2 $$\n对于给定的几何形状，此表达式是精确的。\n\n$g_{\\phi\\phi} = \\frac{\\partial \\boldsymbol{x}}{\\partial \\phi} \\cdot \\frac{\\partial \\boldsymbol{x}}{\\partial \\phi} = (-(R_{0} + r \\cos\\theta) \\sin\\phi)^2 + ((R_{0} + r \\cos\\theta) \\cos\\phi)^2 + 0^2$\n$$ g_{\\phi\\phi} = (R_{0} + r \\cos\\theta)^2 (\\sin^2\\phi + \\cos^2\\phi) = (R_{0} + r \\cos\\theta)^2 $$\n在大环径比极限下（$r/R_{0} \\ll 1$），我们展开此表达式：\n$$ g_{\\phi\\phi} = R_{0}^2 \\left(1 + \\frac{r}{R_{0}}\\cos\\theta\\right)^2 = R_{0}^2 \\left(1 + 2\\frac{r}{R_{0}}\\cos\\theta + \\left(\\frac{r}{R_{0}}\\right)^2\\cos^2\\theta\\right) $$\n领头阶表达式是展开参数 $\\epsilon = r/R_{0}$ 中阶数最低的项，即 $\\epsilon^0$ 项。\n$$ g_{\\phi\\phi} \\approx R_{0}^2 $$\n\n$g_{\\theta\\phi} = \\frac{\\partial \\boldsymbol{x}}{\\partial \\theta} \\cdot \\frac{\\partial \\boldsymbol{x}}{\\partial \\phi}$\n$$ g_{\\theta\\phi} = (-r\\sin\\theta\\cos\\phi)(-(R_0+r\\cos\\theta)\\sin\\phi) + (-r\\sin\\theta\\sin\\phi)((R_0+r\\cos\\theta)\\cos\\phi) + 0 $$\n$$ g_{\\theta\\phi} = r\\sin\\theta(R_0+r\\cos\\theta)(\\cos\\phi\\sin\\phi - \\sin\\phi\\cos\\phi) = 0 $$\n这个系数恰好为零，所以它的领头阶表达式也是 $0$。这表明在此几何中 $\\theta$ 和 $\\phi$ 是正交坐标。\n\n**2. 雅可比行列式的推导**\n\n坐标系 $(\\psi, \\theta, \\phi)$ 的雅可比行列式 $J$ 与 $(r, \\theta, \\phi)$ 坐标系的雅可比行列式相关。在 $(r, \\theta, \\phi)$ 坐标系中，体元 $\\mathrm{d}V$ 为：\n$$ \\mathrm{d}V = \\mathrm{d}r \\cdot (r\\,\\mathrm{d}\\theta) \\cdot ((R_{0}+r\\cos\\theta)\\,\\mathrm{d}\\phi) = r(R_{0}+r\\cos\\theta)\\,\\mathrm{d}r\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi $$\n因此，这些坐标的雅可比行列式为 $J_{(r,\\theta,\\phi)} = r(R_{0}+r\\cos\\theta)$。\n\n为了找到 $(\\psi, \\theta, \\phi)$ 坐标系的雅可比行列式，我们进行从 $r$ 到 $\\psi$ 的变量替换。\n$$ \\mathrm{d}r = \\frac{\\mathrm{d}r}{\\mathrm{d}\\psi} \\mathrm{d}\\psi $$\n问题陈述，对于这些磁通面，$\\psi$ 仅是 $r$ 的函数。其梯度的模通常为 $|\\nabla \\psi| = |\\frac{\\mathrm{d}\\psi}{\\mathrm{d}r}\\nabla r|$。由于 $\\nabla r$ 是一个单位矢量，所以 $|\\nabla\\psi|=|\\frac{\\mathrm{d}\\psi}{\\mathrm{d}r}|$。假设 $\\psi$ 随 $r$ 增加，我们有 $\\frac{\\mathrm{d}r}{\\mathrm{d}\\psi} = \\frac{1}{|\\nabla\\psi|}$。\n体元变为：\n$$ \\mathrm{d}V = r(R_{0}+r\\cos\\theta) \\left(\\frac{1}{|\\nabla\\psi|}\\right) \\mathrm{d}\\psi\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi $$\n雅可比行列式 $J \\equiv J_{(\\psi,\\theta,\\phi)}$ 是 $\\mathrm{d}\\psi\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$ 的系数：\n$$ J = \\frac{r(R_{0}+r\\cos\\theta)}{|\\nabla\\psi|} $$\n为了找到领头阶估计，我们再次按 $r/R_{0}$ 展开：\n$$ J = \\frac{rR_{0}}{|\\nabla\\psi|}\\left(1 + \\frac{r}{R_{0}}\\cos\\theta\\right) $$\n领头阶项是：\n$$ J \\approx \\frac{rR_{0}}{|\\nabla\\psi|} $$\n\n**领头阶表达式总结**\n-   $g_{\\theta\\theta} = r^2$\n-   $g_{\\phi\\phi} \\approx R_0^2$\n-   $g_{\\theta\\phi} = 0$\n-   $J \\approx \\frac{rR_{0}}{|\\nabla\\psi|}$\n\n**3. 数值计算**\n\n给定数值为：$R_{0} = 1.7\\,\\mathrm{m}$，$r = 0.35\\,\\mathrm{m}$，以及 $|\\nabla \\psi| = 12\\,\\mathrm{Wb/m}$。我们将计算领头阶表达式的值，并四舍五入到四位有效数字。\n\n-   $g_{\\theta\\theta} = (0.35\\,\\mathrm{m})^2 = 0.1225\\,\\mathrm{m}^2$。\n\n-   $g_{\\phi\\phi} \\approx (1.7\\,\\mathrm{m})^2 = 2.89\\,\\mathrm{m}^2$。保留四位有效数字，结果为 $2.890\\,\\mathrm{m}^2$。\n\n-   $g_{\\theta\\phi} = 0$。\n\n-   $J \\approx \\frac{(0.35\\,\\mathrm{m})(1.7\\,\\mathrm{m})}{12\\,\\mathrm{Wb/m}} = \\frac{0.595\\,\\mathrm{m}^2}{12\\,\\mathrm{Wb/m}} \\approx 0.0495833...\\,\\mathrm{m}^3/\\mathrm{Wb}$。\n    四舍五入到四位有效数字，$J \\approx 0.04958\\,\\mathrm{m}^3/\\mathrm{Wb}$。\n\n**最终答案组合**\n\n最终答案是包含计算出的数值的行矩阵 $(g_{\\theta\\theta},\\,g_{\\phi\\phi},\\,g_{\\theta\\phi},\\,J)$。\n$$ (0.1225,\\, 2.890,\\, 0,\\, 0.04958) $$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0.1225 & 2.890 & 0 & 0.04958 \\end{pmatrix} } $$"
        },
        {
            "introduction": "场向对齐坐标系的真正威力在于分析沿磁力线高度拉长的涨落（例如湍流）。本练习将引导你推导垂直波数 $k_\\perp$ 的表达式，这是分析等离子体中波和不稳定性的核心物理量。理解 $k_\\perp$ 如何因磁场几何位形而在极向发生变化，是解释气球模不稳定性等现象的关键 。",
            "id": "4189269",
            "problem": "考虑一个具有圆形同心磁通面的轴对称、大环径比的托卡马克。使用磁通面对齐坐标系 $(r,\\theta,\\phi)$，其中 $r$ 是标记磁通面的小半径，$\\theta$ 是极向角，$\\phi$ 是环向角。依赖于位置的大半径为 $R(\\theta)=R_0 + r \\cos\\theta$，其中 $R_0$ 是磁轴处的恒定大半径。在此正交坐标系中，磁通面（$r=\\text{const}$）上的线元为 $ds^2 = r^2\\, d\\theta^2 + R(\\theta)^2\\, d\\phi^2$，相应的度规因子为 $h_r=1$, $h_\\theta=r$ 和 $h_\\phi=R(\\theta)$。\n\n采用直磁力线、磁场对齐坐标系，其中 Clebsch 磁力线标签定义为 $\\alpha=\\theta - q \\phi$，$q$ 是安全因子，在局域近似下假定在所选磁通面上为常数。磁场可以用 Clebsch 形式表示为 $\\mathbf{B}=\\nabla\\psi \\times \\nabla\\alpha$，其中 $\\psi$ 是一个磁通函数，但除了所提供的几何定义外，您不应使用任何简化公式。一个具有副法向傅里叶波数 $k_y$ 的涨落，其相位为 $k_y \\alpha$，并且在局域、磁场对齐模型中，其垂直波矢方向沿着 $\\nabla\\alpha$。\n\n从正交曲线坐标系的第一性原理和梯度的定义出发，推导磁通面上 $|\\nabla \\alpha|^2$ 的表达式。然后，利用您的结果，对于具有副法向波数 $k_y$ 的傅里叶模式，获得极向变化的垂直波数大小 $k_\\perp^2(\\theta)$ 的显式表达式，假设在局域模型中径向波数为零，因此 $\\mathbf{k}_\\perp(\\theta)=k_y \\nabla \\alpha$。\n\n您的最终答案必须是 $k_\\perp^2(\\theta)$ 的一个单一闭式解析表达式，用 $k_y$、$q$、$r$、$R_0$ 和 $\\theta$ 表示。不要进行任何数值计算。",
            "solution": "该问题已经过验证，被认为是有效的。它在磁约束聚变和等离子体物理的既定理论中具有科学依据，特别涉及托卡马克中湍流模拟的几何结构。该问题是适定的，提供了推导唯一解析解所需的所有必要定义和约束。其语言客观，并且在场论中使用的标准局域近似范围内，其设置是内部一致且物理上合理的。\n\n垂直波数大小的平方 $k_\\perp^2(\\theta)$ 的推导按要求从第一性原理开始。我们从正交曲线坐标系 $(u_1, u_2, u_3)$ 中标量函数 $\\alpha$ 的梯度的一般定义开始，该坐标系具有相应的单位矢量 $(\\hat{e}_1, \\hat{e}_2, \\hat{e}_3)$ 和度规因子 $(h_1, h_2, h_3)$。梯度的公式为：\n$$ \\nabla \\alpha = \\frac{\\hat{e}_1}{h_1} \\frac{\\partial \\alpha}{\\partial u_1} + \\frac{\\hat{e}_2}{h_2} \\frac{\\partial \\alpha}{\\partial u_2} + \\frac{\\hat{e}_3}{h_3} \\frac{\\partial \\alpha}{\\partial u_3} $$\n问题指定使用磁通面对齐坐标系 $(r, \\theta, \\phi)$，该坐标系是正交的。因此，我们将 $(u_1, u_2, u_3)$ 与 $(r, \\theta, \\phi)$ 等同。问题提供了相应的度规因子为 $h_r=1$, $h_\\theta=r$ 和 $h_\\phi=R(\\theta)$，其中 $R(\\theta) = R_0 + r \\cos\\theta$。\n\n我们感兴趣的标量函数是 Clebsch 磁力线标签，定义为 $\\alpha = \\theta - q\\phi$，其中安全因子 $q$ 在所考虑的磁通面上是常数。我们首先计算 $\\alpha$ 对坐标 $r$、$\\theta$ 和 $\\phi$ 的偏导数：\n$$ \\frac{\\partial \\alpha}{\\partial r} = \\frac{\\partial}{\\partial r}(\\theta - q\\phi) = 0 $$\n这个导数为零，因为 $\\theta$ 和 $\\phi$ 与 $r$ 无关，并且 $q$ 在给定的磁通面（$r = \\text{const}$）上被视作常数。这与所分析涨落的局域模型中径向波数为零的假设是一致的。\n$$ \\frac{\\partial \\alpha}{\\partial \\theta} = \\frac{\\partial}{\\partial \\theta}(\\theta - q\\phi) = 1 $$\n$$ \\frac{\\partial \\alpha}{\\partial \\phi} = \\frac{\\partial}{\\partial \\phi}(\\theta - q\\phi) = -q $$\n将这些偏导数和度规因子代入梯度公式，我们得到 $\\nabla \\alpha$ 的表达式：\n$$ \\nabla \\alpha = \\frac{\\hat{e}_r}{h_r}\\left(\\frac{\\partial \\alpha}{\\partial r}\\right) + \\frac{\\hat{e}_\\theta}{h_\\theta}\\left(\\frac{\\partial \\alpha}{\\partial \\theta}\\right) + \\frac{\\hat{e}_\\phi}{h_\\phi}\\left(\\frac{\\partial \\alpha}{\\partial \\phi}\\right) $$\n$$ \\nabla \\alpha = \\frac{\\hat{e}_r}{1}(0) + \\frac{\\hat{e}_\\theta}{r}(1) + \\frac{\\hat{e}_\\phi}{R(\\theta)}(-q) $$\n$$ \\nabla \\alpha = \\frac{1}{r} \\hat{e}_\\theta - \\frac{q}{R(\\theta)} \\hat{e}_\\phi $$\n梯度的大小的平方 $|\\nabla \\alpha|^2$ 是 $\\nabla \\alpha$ 与自身的点积。由于坐标系是正交的，基矢量 $(\\hat{e}_r, \\hat{e}_\\theta, \\hat{e}_\\phi)$ 是标准正交的，即 $\\hat{e}_i \\cdot \\hat{e}_j = \\delta_{ij}$。计算简化为各分量平方之和：\n$$ |\\nabla \\alpha|^2 = (\\nabla \\alpha) \\cdot (\\nabla \\alpha) = \\left(\\frac{1}{r}\\right)^2 + \\left(-\\frac{q}{R(\\theta)}\\right)^2 $$\n$$ |\\nabla \\alpha|^2 = \\frac{1}{r^2} + \\frac{q^2}{R(\\theta)^2} $$\n这就完成了任务的第一部分。对于第二部分，我们使用所提供的垂直波矢模型 $\\mathbf{k}_\\perp(\\theta) = k_y \\nabla \\alpha$，其中 $k_y$ 是傅里叶模式的恒定副法向波数。因此，垂直波矢大小的平方 $k_\\perp^2(\\theta)$ 为：\n$$ k_\\perp^2(\\theta) = |\\mathbf{k}_\\perp(\\theta)|^2 = |k_y \\nabla \\alpha|^2 = k_y^2 |\\nabla \\alpha|^2 $$\n代入我们推导出的 $|\\nabla \\alpha|^2$ 表达式：\n$$ k_\\perp^2(\\theta) = k_y^2 \\left( \\frac{1}{r^2} + \\frac{q^2}{R(\\theta)^2} \\right) $$\n最后，问题要求答案用 $k_y$、$q$、$r$、$R_0$ 和 $\\theta$ 表示。我们将给定的依赖于位置的大半径定义 $R(\\theta) = R_0 + r \\cos\\theta$ 代入我们的 $k_\\perp^2(\\theta)$ 表达式中：\n$$ k_\\perp^2(\\theta) = k_y^2 \\left( \\frac{1}{r^2} + \\frac{q^2}{(R_0 + r \\cos\\theta)^2} \\right) $$\n这就是在磁通面上极向变化的垂直波数大小的平方的最终闭式解析表达式。",
            "answer": "$$\n\\boxed{k_y^2 \\left( \\frac{1}{r^2} + \\frac{q^2}{(R_0 + r \\cos\\theta)^2} \\right)}\n$$"
        },
        {
            "introduction": "从解析理论迈向计算模拟，需要对这些坐标系进行数值实现并验证其正确性。这项高级练习模拟了真实世界中的代码验证任务。通过数值化计算整个坐标系的几何量，并利用它们来验证基本物理定律 $\\nabla \\cdot \\mathbf{B} = 0$，你将深入了解开发复杂等离子体模拟代码时所面临的实际挑战和关键的验证技术 。",
            "id": "4189289",
            "problem": "给定一个轴对称、大环径比的环形平衡，旨在模拟平衡拟合（EFIT）或变分矩平衡代码（VMEC）的部分输出。你将在磁通面对齐坐标系 $(\\psi,\\theta,\\zeta)$ 中工作，其中 $\\psi$ 是一个单调递增的磁通面标签，$\\theta$ 是极向角，$\\zeta$ 是环向角。角度必须以弧度处理。除非另有说明，所有量纲均为无量纲。\n\n几何与映射。在柱坐标 $(R,\\phi,Z)$ 中，其对应的笛卡尔坐标 $(x,y,z)$ 定义为 $x = R \\cos\\phi$，$y = R \\sin\\phi$，$z = Z$。考虑参数化为如下形式的嵌套圆形磁通面\n$$\nR(\\psi,\\theta) = R_0 + r(\\psi)\\cos\\theta,\\quad Z(\\psi,\\theta) = r(\\psi)\\sin\\theta,\\quad \\phi = \\zeta,\n$$\n其中 $r(\\psi) = \\sqrt{2\\psi}$，$R_0$ 为大半径。坐标映射为 $X(\\psi,\\theta,\\zeta) = \\big(R(\\psi,\\theta)\\cos\\zeta,\\,R(\\psi,\\theta)\\sin\\zeta,\\,Z(\\psi,\\theta)\\big)$。\n\n坐标演算。对于一个映射到 $\\mathbb{R}^3$ 的通用曲线坐标系 $(u^1,u^2,u^3)=(\\psi,\\theta,\\zeta)$，定义协变基矢量 $a_i = \\partial X/\\partial u^i$、度规系数 $g_{ij} = a_i\\cdot a_j$ 和雅可比行列式\n$$\nJ = a_1\\cdot\\left(a_2\\times a_3\\right).\n$$\n倒易（逆变）基矢量满足 $b^i\\cdot a_j = \\delta^i_{\\;j}$，并可通过 $b^\\psi = (a_\\theta\\times a_\\zeta)/J$、$b^\\theta = (a_\\zeta\\times a_\\psi)/J$、$b^\\zeta = (a_\\psi\\times a_\\theta)/J$ 计算。\n\n磁场与散度。在场向坐标系中，定义Clebsch势 $\\alpha(\\psi,\\theta,\\zeta) = \\zeta - q(\\psi)\\,\\theta$，其中 $q(\\psi)$ 是一个仅依赖于 $\\psi$ 的预设类安全因子剖面。使用Clebsch形式构造磁场\n$$\n\\mathbf{B} = \\nabla\\psi \\times \\nabla\\alpha,\n$$\n当 $q = q(\\psi)$（即独立于 $\\theta$ 和 $\\zeta$）时，该磁场是无散的，因为 $\\nabla\\psi$ 和 $\\nabla\\alpha$ 都是无旋的，且 $\\nabla\\cdot(\\nabla\\psi\\times\\nabla\\alpha)=0$。在通用曲线坐标系中，一个以逆变分量 $\\mathbf{A} = A^\\psi a_\\psi + A^\\theta a_\\theta + A^\\zeta a_\\zeta$ 写出的矢量场 $\\mathbf{A}$ 的散度为\n$$\n\\nabla\\cdot\\mathbf{A} = \\frac{1}{J}\\left(\\frac{\\partial}{\\partial\\psi}(J A^\\psi) + \\frac{\\partial}{\\partial\\theta}(J A^\\theta) + \\frac{\\partial}{\\partial\\zeta}(J A^\\zeta)\\right).\n$$\n\n任务。实现一个程序，对于给定的映射和 $\\alpha(\\psi,\\theta,\\zeta)$，在一个数值网格上计算：\n- 通过对 $X(\\psi,\\theta,\\zeta)$ 直接求偏导数，计算协变基矢量 $a_\\psi$、$a_\\theta$、$a_\\zeta$，\n- 度规系数 $g_{ij} = a_i\\cdot a_j$，\n- 雅可比行列式 $J = a_\\psi\\cdot(a_\\theta\\times a_\\zeta)$，\n- 使用倒易基计算磁场 $\\mathbf{B} = \\nabla\\psi \\times \\nabla\\alpha$，\n- 使用上述曲线坐标散度公式，并在 $(\\psi,\\theta,\\zeta)$ 网格上采用有限差分法，计算数值散度 $\\nabla\\cdot\\mathbf{B}$。\n\n验证指标。你的程序必须为每个测试用例报告：\n- 网格上 $\\mathbf{B}$ 的最大绝对散度，即 $\\max|\\nabla\\cdot\\mathbf{B}|$，以浮点数形式表示，\n- 网格上度规矩阵的最大绝对对称性残差，即对于 $i\\neq j$ 的 $\\max|g_{ij}-g_{ji}|$，以浮点数形式表示。\n\n网格与差分。在 $\\theta$ 和 $\\zeta$ 方向上使用周期性中心差分；在 $\\psi$ 域的内部使用二阶中心差分，在 $\\psi$ 边界上使用单边差分。角度必须以弧度为单位。\n\n测试套件。使用以下三个测试用例；对每个用例，在指定范围内构建均匀网格：\n1. 正常路径：$R_0 = 3.0$，$a = 0.5$，$\\psi\\in[\\psi_{\\min},\\psi_{\\max}]$，其中 $\\psi_{\\max}=a^2/2$，$\\psi_{\\min}=10^{-4}$，$q(\\psi) = q_0 + s\\,\\psi$，其中 $q_0=1.2$，$s=1.0$，网格大小为 $(N_\\psi,N_\\theta,N_\\zeta)=(33,64,32)$，并且 $\\theta,\\zeta\\in[0,2\\pi)$。\n2. 近轴边界：$R_0 = 3.0$，$a = 0.5$，$\\psi_{\\max}=a^2/2$，$\\psi_{\\min}=10^{-9}$，$q(\\psi) = q_0 + s\\,\\psi$，其中 $q_0=1.0$，$s=0.0$，$(N_\\psi,N_\\theta,N_\\zeta)=(17,32,8)$，并且 $\\theta,\\zeta\\in[0,2\\pi)$。\n3. 高磁剪切：$R_0 = 3.0$，$a = 0.5$，$\\psi_{\\max}=a^2/2$，$\\psi_{\\min}=10^{-4}$，$q(\\psi) = q_0 + s\\,\\psi$，其中 $q_0=2.0$，$s=50.0$，$(N_\\psi,N_\\theta,N_\\zeta)=(25,48,24)$，并且 $\\theta,\\zeta\\in[0,2\\pi)$。\n\n输出格式。你的程序应生成单行输出，其中包含三个测试用例的结果，形式为以逗号分隔的配对列表，每个配对是上述两个浮点数，并用方括号括起来。例如：[[div1,sym1],[div2,sym2],[div3,sym3]]。所有角度必须以弧度为单位，所有输出均为无量纲。浮点数应以Python的默认浮点格式打印。",
            "solution": "所给问题是一项有效的计算物理任务。它在科学上基于等离子体物理和微分几何的原理，问题设定良好，目标明确，数据充分，并且没有任何逻辑矛盾或事实错误。该问题要求实现并验证与磁通面对齐和场向坐标系相关的基本计算，这是聚变等离子体湍流模拟领域的标准课题。因此，我们可以着手提供一个完整的解决方案。\n\n该解决方案涉及一个多步骤过程：首先，我们解析推导必要的几何和物理量，然后我们以数值方式实现这些公式，以在离散化网格上计算指定的验证指标。\n\n**1. 几何框架与坐标系**\n\n该问题设置在环形几何中，使用磁通面对齐坐标 $(\\psi, \\theta, \\zeta)$。到笛卡尔坐标 $X(\\psi, \\theta, \\zeta) = (x, y, z)$ 的映射由下式给出：\n$$\nx = R(\\psi, \\theta) \\cos\\zeta, \\quad y = R(\\psi, \\theta) \\sin\\zeta, \\quad z = Z(\\psi, \\theta)\n$$\n其中 $R(\\psi, \\theta) = R_0 + r(\\psi)\\cos\\theta$ 且 $Z(\\psi, \\theta) = r(\\psi)\\sin\\theta$。小半径 $r$ 通过 $r(\\psi) = \\sqrt{2\\psi}$ 与磁通面标签 $\\psi$ 相关。环向角 $\\zeta$ 等同于柱坐标角 $\\phi$。\n\n**2. 协变基矢量**\n\n协变基矢量 $a_i = \\partial X / \\partial u^i$ 在空间中的每一点构成一个局部基。对于我们的坐标系 $(u^1, u^2, u^3) = (\\psi, \\theta, \\zeta)$，我们通过对 $X(\\psi, \\theta, \\zeta)$ 直接求导来计算基矢量。一个关键的导数是 $dr/d\\psi = d(\\sqrt{2\\psi})/d\\psi = (1/2)(2\\psi)^{-1/2}(2) = 1/\\sqrt{2\\psi} = 1/r(\\psi)$。\n\n基矢量为：\n$$\na_\\psi = \\frac{\\partial X}{\\partial\\psi} = \\left( \\frac{\\partial R}{\\partial\\psi}\\cos\\zeta, \\frac{\\partial R}{\\partial\\psi}\\sin\\zeta, \\frac{\\partial Z}{\\partial\\psi} \\right) = \\frac{1}{r}\\left( \\cos\\theta\\cos\\zeta, \\cos\\theta\\sin\\zeta, \\sin\\theta \\right)\n$$\n$$\na_\\theta = \\frac{\\partial X}{\\partial\\theta} = \\left( \\frac{\\partial R}{\\partial\\theta}\\cos\\zeta, \\frac{\\partial R}{\\partial\\theta}\\sin\\zeta, \\frac{\\partial Z}{\\partial\\theta} \\right) = r\\left( -\\sin\\theta\\cos\\zeta, -\\sin\\theta\\sin\\zeta, \\cos\\theta \\right)\n$$\n$$\na_\\zeta = \\frac{\\partial X}{\\partial\\zeta} = \\left( -R\\sin\\zeta, R\\cos\\zeta, 0 \\right)\n$$\n\n**3. 度规张量与雅可比行列式**\n\n度规张量分量为 $g_{ij} = a_i \\cdot a_j$。由于在这种简化的同心圆几何中基矢量的正交性，度规张量是对角的：\n$$\ng_{\\psi\\psi} = a_\\psi \\cdot a_\\psi = \\frac{1}{r^2} = \\frac{1}{2\\psi}\n$$\n$$\ng_{\\theta\\theta} = a_\\theta \\cdot a_\\theta = r^2 = 2\\psi\n$$\n$$\ng_{\\zeta\\zeta} = a_\\zeta \\cdot a_\\zeta = R^2 = (R_0 + r\\cos\\theta)^2\n$$\n$$\ng_{ij} = 0 \\quad \\text{for} \\quad i \\neq j\n$$\n解析上，度规张量是对称的 ($g_{ij} = g_{ji}$)。数值检查 $\\max|g_{ij}-g_{ji}|$ 作为对点积实现的合理性检查，其结果应在机器精度范围内为零。\n\n变换的雅可比行列式，定义为 $J = a_\\psi \\cdot (a_\\theta \\times a_\\zeta)$，计算如下：\n$$\na_\\theta \\times a_\\zeta = \\left( -rR\\cos\\theta\\cos\\zeta, -rR\\cos\\theta\\sin\\zeta, -rR\\sin\\theta \\right)\n$$\n$$\nJ = a_\\psi \\cdot (a_\\theta \\times a_\\zeta) = \\frac{1}{r} \\left[ (\\cos\\theta\\cos\\zeta)(-rR\\cos\\theta\\cos\\zeta) + (\\cos\\theta\\sin\\zeta)(-rR\\cos\\theta\\sin\\zeta) + (\\sin\\theta)(-rR\\sin\\theta) \\right] = -R\n$$\n因此，$J = -(R_0 + r\\cos\\theta)$。负号表示坐标系 $(\\psi, \\theta, \\zeta)$ 是左手系。\n\n**4. 磁场表示**\n\n磁场使用Clebsch表示 $\\mathbf{B} = \\nabla\\psi \\times \\nabla\\alpha$ 来构造，其中Clebsch势为 $\\alpha = \\zeta - q(\\psi)\\theta$。标量场 $\\psi$ 和 $\\alpha$ 的梯度在逆变基 $b^i$ 中表示为 $\\nabla f = \\sum_i (\\partial f/\\partial u^i) b^i$。\n$$\n\\nabla\\psi = b^\\psi\n$$\n$$\n\\nabla\\alpha = \\frac{\\partial\\alpha}{\\partial\\psi}b^\\psi + \\frac{\\partial\\alpha}{\\partial\\theta}b^\\theta + \\frac{\\partial\\alpha}{\\partial\\zeta}b^\\zeta = -q'(\\psi)\\theta \\,b^\\psi - q(\\psi) \\,b^\\theta + 1 \\cdot b^\\zeta\n$$\n其中 $q'(\\psi) = dq/d\\psi$。那么磁场为：\n$$\n\\mathbf{B} = b^\\psi \\times \\left(-q'(\\psi)\\theta \\,b^\\psi - q(\\psi) \\,b^\\theta + b^\\zeta\\right) = -q(\\psi)(b^\\psi \\times b^\\theta) + (b^\\psi \\times b^\\zeta)\n$$\n使用恒等式 $b^i \\times b^j = \\epsilon^{ijk} a_k / J$，其中 $\\epsilon^{ijk}$ 是 Levi-Civita 符号，我们有 $b^\\psi \\times b^\\theta = a_\\zeta/J$ 和 $b^\\psi \\times b^\\zeta = -a_\\theta/J$。代入这些可得：\n$$\n\\mathbf{B} = -q(\\psi)\\frac{a_\\zeta}{J} - \\frac{a_\\theta}{J} = \\frac{1}{-J}\\left( a_\\theta + q(\\psi)a_\\zeta \\right) = \\frac{1}{R}\\left( a_\\theta + q(\\psi)a_\\zeta \\right)\n$$\n为了求得散度公式所需的逆变分量 $B^i$，我们将 $\\mathbf{B}$ 投影到逆变基矢量上：$B^i = \\mathbf{B} \\cdot b^i$。\n$$\nB^\\psi = \\mathbf{B} \\cdot b^\\psi = \\frac{1}{R}(a_\\theta + q a_\\zeta)\\cdot b^\\psi = 0\n$$\n$$\nB^\\theta = \\mathbf{B} \\cdot b^\\theta = \\frac{1}{R}(a_\\theta + q a_\\zeta)\\cdot b^\\theta = \\frac{1}{R}(1 + 0) = \\frac{1}{R}\n$$\n$$\nB^\\zeta = \\mathbf{B} \\cdot b^\\zeta = \\frac{1}{R}(a_\\theta + q a_\\zeta)\\cdot b^\\zeta = \\frac{1}{R}(0 + q) = \\frac{q(\\psi)}{R}\n$$\n因此逆变分量为 $B^\\psi=0$、$B^\\theta=1/R$ 和 $B^\\zeta=q(\\psi)/R$。\n\n**5. 数值散度计算**\n\n问题提供了矢量场 $\\mathbf{A} = \\sum_i A^i a_i$ 的散度公式：\n$$\n\\nabla\\cdot\\mathbf{A} = \\frac{1}{J}\\left(\\frac{\\partial}{\\partial\\psi}(J A^\\psi) + \\frac{\\partial}{\\partial\\theta}(J A^\\theta) + \\frac{\\partial}{\\partial\\zeta}(J A^\\zeta)\\right)\n$$\n代入我们的分量 $B^i$ 和雅可比行列式 $J=-R$：\n$$\nJ B^\\psi = (-R)(0) = 0\n$$\n$$\nJ B^\\theta = (-R)\\left(\\frac{1}{R}\\right) = -1\n$$\n$$\nJ B^\\zeta = (-R)\\left(\\frac{q(\\psi)}{R}\\right) = -q(\\psi)\n$$\n散度表达式变为：\n$$\n\\nabla\\cdot\\mathbf{B} = \\frac{1}{J}\\left(\\frac{\\partial}{\\partial\\psi}(0) + \\frac{\\partial}{\\partial\\theta}(-1) + \\frac{\\partial}{\\partial\\zeta}(-q(\\psi))\\right)\n$$\n解析上，每个偏导数都为零，因此 $\\nabla\\cdot\\mathbf{B} = 0$。数值任务是将此计算离散化。偏导数 $\\partial/\\partial\\theta$ 和 $\\partial/\\partial\\zeta$ 使用二阶周期性中心有限差分计算。$\\nabla\\cdot\\mathbf{B}$ 的数值结果将是一个小的非零值，代表了浮点误差和有限差分误差，我们通过其在网格上的最大绝对值来量化它。\n\n**数值实现策略**\n\nPython 实现将按以下步骤进行：\n1.  对每个测试用例，使用 `numpy.meshgrid` 为 $(\\psi, \\theta, \\zeta)$ 定义一个均匀的三维网格。\n2.  使用解析公式在每个网格点上计算协变基矢量 $a_\\psi, a_\\theta, a_\\zeta$ 的笛卡尔分量。\n3.  计算度规张量 $g_{ij} = a_i \\cdot a_j$ 的九个分量。\n4.  计算最大对称性残差 $\\max|g_{ij} - g_{ji}|$，其期望值为 $0.0$。\n5.  数值计算雅可比行列式 $J = a_\\psi \\cdot (a_\\theta \\times a_\\zeta)$。\n6.  计算逆变场分量 $B^\\theta$ 和 $B^\\zeta$。\n7.  计算 $J B^\\theta$ 和 $J B^\\zeta$。\n8.  使用周期性中心差分，分别对 $\\theta$ 和 $\\zeta$ 数值微分 $J B^\\theta$ 和 $J B^\\zeta$。\n9.  组合各项以计算 $\\nabla\\cdot\\mathbf{B}$，并找到其在网格上的最大绝对值。\n10. 为每个用例存储两个指标（散度和对称性），并格式化最终输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Happy path\n        {'R0': 3.0, 'a': 0.5, 'psi_min': 1e-4, 'q0': 1.2, 's': 1.0, 'grid_size': (33, 64, 32)},\n        # Case 2: Near-axis boundary\n        {'R0': 3.0, 'a': 0.5, 'psi_min': 1e-9, 'q0': 1.0, 's': 0.0, 'grid_size': (17, 32, 8)},\n        # Case 3: High shear\n        {'R0': 3.0, 'a': 0.5, 'psi_min': 1e-4, 'q0': 2.0, 's': 50.0, 'grid_size': (25, 48, 24)},\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = compute_metrics(**case_params)\n        results.append(result)\n\n    # Format the final output string as a list of lists.\n    output_str = \"[\" + \",\".join([f\"[{div},{sym}]\" for div, sym in results]) + \"]\"\n    print(output_str)\n\ndef compute_metrics(R0, a, psi_min, q0, s, grid_size):\n    \"\"\"\n    Computes verification metrics for a single test case.\n    \"\"\"\n    N_psi, N_theta, N_zeta = grid_size\n    psi_max = a**2 / 2.0\n\n    # 1. Construct uniform grids\n    psi_1d = np.linspace(psi_min, psi_max, N_psi)\n    theta_1d = np.linspace(0, 2 * np.pi, N_theta, endpoint=False)\n    zeta_1d = np.linspace(0, 2 * np.pi, N_zeta, endpoint=False)\n\n    dpsi = psi_1d[1] - psi_1d[0]\n    dtheta = theta_1d[1] - theta_1d[0]\n    dzeta = zeta_1d[1] - zeta_1d[0]\n\n    PSI, THETA, ZETA = np.meshgrid(psi_1d, theta_1d, zeta_1d, indexing='ij')\n\n    # Geometric quantities on the grid\n    r = np.sqrt(2 * PSI)\n    R = R0 + r * np.cos(THETA)\n    \n    # 2. Covariant basis vectors a_i\n    # Each a_i is a tuple of its (x, y, z) components, which are 3D arrays.\n    dr_dpsi = 1.0 / r\n    a_psi = (dr_dpsi * np.cos(THETA) * np.cos(ZETA),\n             dr_dpsi * np.cos(THETA) * np.sin(ZETA),\n             dr_dpsi * np.sin(THETA))\n    \n    a_theta = (-r * np.sin(THETA) * np.cos(ZETA),\n               -r * np.sin(THETA) * np.sin(ZETA),\n               r * np.cos(THETA))\n               \n    a_zeta = (-R * np.sin(ZETA),\n              R * np.cos(ZETA),\n              np.zeros_like(R))\n\n    # Helper function for dot product of two vector fields\n    def dot_product(v1, v2):\n        return v1[0] * v2[0] + v1[1] * v2[1] + v1[2] * v2[2]\n\n    # 3. Metric coefficients g_ij and symmetry residual\n    g_psitheta = dot_product(a_psi, a_theta)\n    g_psizeta = dot_product(a_psi, a_zeta)\n    g_thetazeta = dot_product(a_theta, a_zeta)\n    \n    g_thetapsi = dot_product(a_theta, a_psi)\n    g_zetapsi = dot_product(a_zeta, a_psi)\n    g_zetatheta = dot_product(a_zeta, a_theta)\n\n    res1 = np.max(np.abs(g_psitheta - g_thetapsi))\n    res2 = np.max(np.abs(g_psizeta - g_zetapsi))\n    res3 = np.max(np.abs(g_thetazeta - g_zetatheta))\n    max_sym_res = max(res1, res2, res3)\n\n    # 4. Jacobian J\n    # J = a_psi . (a_theta x a_zeta)\n    cross_theta_zeta_x = a_theta[1] * a_zeta[2] - a_theta[2] * a_zeta[1]\n    cross_theta_zeta_y = a_theta[2] * a_zeta[0] - a_theta[0] * a_zeta[2]\n    cross_theta_zeta_z = a_theta[0] * a_zeta[1] - a_theta[1] * a_zeta[0]\n    J = a_psi[0] * cross_theta_zeta_x + a_psi[1] * cross_theta_zeta_y + a_psi[2] * cross_theta_zeta_z\n    \n    # 5. Magnetic field contravariant components B^i\n    q = q0 + s * PSI\n    B_theta = 1.0 / R\n    B_zeta = q / R\n\n    # 6. Numerical divergence of B\n    # Compute fluxes J*B^i\n    Flux_theta = J * B_theta\n    Flux_zeta = J * B_zeta\n    \n    # Derivatives using second-order periodic central differences\n    # d(F_theta)/d(theta)\n    dF_theta_dtheta = (np.roll(Flux_theta, -1, axis=1) - np.roll(Flux_theta, 1, axis=1)) / (2 * dtheta)\n    \n    # d(F_zeta)/d(zeta)\n    dF_zeta_dzeta = (np.roll(Flux_zeta, -1, axis=2) - np.roll(Flux_zeta, 1, axis=2)) / (2 * dzeta)\n    \n    # Divergence calculation. Note: d(J*B^psi)/d(psi) term is zero.\n    div_B = (1.0 / J) * (dF_theta_dtheta + dF_zeta_dzeta)\n    max_abs_divB = np.max(np.abs(div_B))\n    \n    return max_abs_divB, max_sym_res\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}