{
    "hands_on_practices": [
        {
            "introduction": "理解扭曲-平移边界条件的第一步是掌握磁剪切的物理意义。本练习将抽象的磁剪切参数 $\\hat{s}$ 与一个具体的几何量——平行连接长度 $L_\\parallel$ 联系起来。通过推导 $L_\\parallel$ 如何随径向位置变化，您将直观地理解为什么磁剪切是描述磁场结构、特别是相邻磁面上磁场线螺距变化的关键因素 。",
            "id": "4198293",
            "problem": "考虑一个大环径比、圆形截面的托卡马克，其大半径为 $R$，小半径坐标为 $r$，极向角为 $\\theta$，环向角为 $\\varphi$。在固定的 $r$ 处构建一个局域磁通管回旋动理学（GK）区域，该区域沿一条追踪了 $N_{\\text{pol}}$ 极向圈数的磁力线施加周期性和扭曲-平移边界条件。平衡安全因子为 $q(r)=q_0+\\alpha r$，其中 $q_0>0$ 和 $\\alpha$ 为常数。假设沿着磁面采用标准且广泛使用的大环径比磁力线关系 $d\\varphi/d\\theta=q(r)$，并在环面上采用欧几里得度规近似，因此限制在单个磁面上的线元为 $dl^2=(r\\,d\\theta)^2+(R\\,d\\varphi)^2$。在此设定下：\n\n- 使用磁剪切 $\\hat{s}$ 的基本定义，即沿一族同心圆形磁面，安全因子径向变化的无量纲度量。\n- 从 $dl$ 和上述磁力线关系出发，推导平行连接长度 $L_\\parallel$，即沿磁力线行进 $N_{\\text{pol}}$ 个极向圈数所需的几何弧长，并假设在固定的 $r$ 处，$q(r)$ 不沿 $\\theta$ 变化。\n- 为将磁剪切的作用与扭曲-平移边界条件联系起来，通过计算无量纲导数 $\\partial\\ln L_\\parallel/\\partial\\ln r$ 来量化 $L_\\parallel$ 对小半径的敏感度，然后在 $R\\,q(r)\\gg r$ 的极限下给出其领头阶近似。\n\n将你的最终答案以单个闭式解析行矩阵的形式给出，该矩阵按顺序包含 $\\hat{s}(r)$ 的表达式、$L_\\parallel(N_{\\text{pol}},r)$ 的表达式以及在 $R\\,q(r)\\gg r$ 极限下 $\\partial\\ln L_\\parallel/\\partial\\ln r$ 的领头阶近似。无需代入任何数值。",
            "solution": "首先根据所需标准验证问题陈述。\n\n### 第1步：提取已知条件\n- **系统：** 大环径比、圆形截面托卡马克。\n- **坐标：** 大半径 $R$，小半径坐标 $r$，极向角 $\\theta$ 和环向角 $\\varphi$。\n- **区域：** 固定 $r$ 处的局域磁通管回旋动理学（GK）区域。\n- **边界条件：** 沿一条追踪了 $N_{\\text{pol}}$ 极向圈数的磁力线的周期性和扭曲-平移边界条件。\n- **平衡安全因子：** $q(r)=q_0+\\alpha r$，其中常数 $q_0>0$ 和 $\\alpha$。\n- **磁力线关系：** 沿磁面的 $d\\varphi/d\\theta=q(r)$。\n- **度规元：** 单个磁面上的 $dl^2=(r\\,d\\theta)^2+(R\\,d\\varphi)^2$。\n- **假设：** 在固定的 $r$ 处，$q(r)$ 不沿 $\\theta$ 变化。\n- **任务：**\n  1. 推导磁剪切 $\\hat{s}(r)$。\n  2. 推导平行连接长度 $L_\\parallel(N_{\\text{pol}}, r)$。\n  3. 计算无量纲导数 $\\partial\\ln L_\\parallel/\\partial\\ln r$ 并在 $R\\,q(r)\\gg r$ 的极限下给出其领头阶近似。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，位于聚变等离子体物理的标准理论框架内，特别是关于大环径比托卡马克中磁几何的描述。所使用的概念，如安全因子 $q$、磁剪切 $\\hat{s}$ 和磁力线追踪方程，都是该领域的基础。所提供的度规是环面的标准欧几里得近似。问题是适定的，提供了唯一推导所求量所需的所有必要定义和约束。语言客观而精确。所做的假设，例如 $q(r)$ 的形式和大环径比极限，是理论建模和模拟中常用且物理上相关的简化。问题是完整、一致的，且不违反任何物理或数学原理。\n\n### 第3步：结论与行动\n问题被判定为**有效**。将推导解答。\n\n### 推导\n\n解答过程按问题陈述的要求分为三个部分。\n\n**第1部分：磁剪切 $\\hat{s}(r)$ 的推导**\n\n磁剪切 $\\hat{s}$ 定义为安全因子 $q$ 相对于小半径 $r$ 的无量纲对数导数。其定义为：\n$$\n\\hat{s}(r) = \\frac{r}{q(r)} \\frac{dq(r)}{dr}\n$$\n安全因子被给定为 $r$ 的线性函数：\n$$\nq(r) = q_0 + \\alpha r\n$$\n首先，我们计算 $q(r)$ 对 $r$ 的导数：\n$$\n\\frac{dq(r)}{dr} = \\frac{d}{dr}(q_0 + \\alpha r) = \\alpha\n$$\n将此导数和 $q(r)$ 的表达式代回 $\\hat{s}(r)$ 的定义中，我们得到：\n$$\n\\hat{s}(r) = \\frac{r}{q_0 + \\alpha r} (\\alpha) = \\frac{\\alpha r}{q_0 + \\alpha r}\n$$\n这是磁剪切作为小半径 $r$ 函数的表达式。\n\n**第2部分：平行连接长度 $L_\\parallel(N_{\\text{pol}}, r)$ 的推导**\n\n平行连接长度 $L_\\parallel$ 是沿磁力线的几何弧长。磁面上的弧长微分 $dl$ 由线元给出：\n$$\ndl^2 = (r\\,d\\theta)^2 + (R\\,d\\varphi)^2\n$$\n为了找到沿磁力线的弧长，我们必须关联 $d\\varphi$ 和 $d\\theta$。问题提供了磁面上的标准磁力线关系：\n$$\n\\frac{d\\varphi}{d\\theta} = q(r)\n$$\n这可以写成 $d\\varphi = q(r) d\\theta$。将其代入 $dl^2$ 的表达式中：\n$$\ndl^2 = (r\\,d\\theta)^2 + (R\\,q(r)\\,d\\theta)^2 = [r^2 + (R\\,q(r))^2] (d\\theta)^2\n$$\n取平方根得到沿磁力线的弧长微分：\n$$\ndl = \\sqrt{r^2 + R^2 q(r)^2} \\, d\\theta\n$$\n总连接长度 $L_\\parallel$ 是通过将 $dl$ 沿磁力线积分得到的，总共积分 $N_{\\text{pol}}$ 个极向圈数。一个极向圈对应于 $\\theta$ 变化 $2\\pi$。因此，$N_{\\text{pol}}$ 圈对应的 $\\theta$ 积分范围是从 $0$ 到 $2\\pi N_{\\text{pol}}$。\n$$\nL_\\parallel = \\int_{0}^{2\\pi N_{\\text{pol}}} \\sqrt{r^2 + R^2 q(r)^2} \\, d\\theta\n$$\n由于积分是在固定的小半径 $r$ 处进行的，并且假设 $q(r)$ 与 $\\theta$ 无关，所以整个被积函数相对于积分变量 $\\theta$ 是常数。因此，积分就是被积函数乘以积分区间的长度：\n$$\nL_\\parallel(N_{\\text{pol}}, r) = \\sqrt{r^2 + R^2 q(r)^2} \\int_{0}^{2\\pi N_{\\text{pol}}} d\\theta = 2\\pi N_{\\text{pol}} \\sqrt{r^2 + R^2 q(r)^2}\n$$\n代入给定的 $q(r)$ 表达式：\n$$\nL_\\parallel(N_{\\text{pol}}, r) = 2\\pi N_{\\text{pol}} \\sqrt{r^2 + R^2 (q_0 + \\alpha r)^2}\n$$\n\n**第3部分：$\\partial\\ln L_\\parallel/\\partial\\ln r$ 及其领头阶近似的推导**\n\n第三项任务是计算无量纲导数 $\\partial\\ln L_\\parallel/\\partial\\ln r$。这个量度量了连接长度对小半径微小相对变化的敏感度。使用链式法则，该导数可以表示为：\n$$\n\\frac{\\partial\\ln L_\\parallel}{\\partial\\ln r} = r \\frac{\\partial(\\ln L_\\parallel)}{\\partial r}\n$$\n首先，我们从第2部分的结果中找到 $\\ln L_\\parallel$：\n$$\n\\ln L_\\parallel = \\ln(2\\pi N_{\\text{pol}}) + \\ln\\left(\\sqrt{r^2 + R^2 q(r)^2}\\right) = \\ln(2\\pi N_{\\text{pol}}) + \\frac{1}{2} \\ln(r^2 + R^2 q(r)^2)\n$$\n现在，我们对 $r$ 求导：\n$$\n\\frac{\\partial(\\ln L_\\parallel)}{\\partial r} = 0 + \\frac{1}{2} \\frac{1}{r^2 + R^2 q(r)^2} \\frac{\\partial}{\\partial r} [r^2 + R^2 q(r)^2]\n$$\n$$\n\\frac{\\partial(\\ln L_\\parallel)}{\\partial r} = \\frac{1}{2(r^2 + R^2 q(r)^2)} \\left[2r + R^2 \\cdot 2q(r) \\frac{dq(r)}{dr}\\right] = \\frac{r + R^2 q(r) \\frac{dq(r)}{dr}}{r^2 + R^2 q(r)^2}\n$$\n乘以 $r$ 得到所需的无量纲导数：\n$$\n\\frac{\\partial\\ln L_\\parallel}{\\partial\\ln r} = r \\frac{r + R^2 q(r) \\frac{dq(r)}{dr}}{r^2 + R^2 q(r)^2} = \\frac{r^2 + R^2 q(r) \\left(r \\frac{dq(r)}{dr}\\right)}{r^2 + R^2 q(r)^2}\n$$\n我们从磁剪切的定义中识别出 $r \\frac{dq(r)}{dr}$ 这一项：$\\hat{s}(r) = \\frac{r}{q(r)}\\frac{dq(r)}{dr}$，这意味着 $r \\frac{dq(r)}{dr} = q(r)\\hat{s}(r)$。将此代入我们的表达式中：\n$$\n\\frac{\\partial\\ln L_\\parallel}{\\partial\\ln r} = \\frac{r^2 + R^2 q(r) [q(r)\\hat{s}(r)]}{r^2 + R^2 q(r)^2} = \\frac{r^2 + R^2 q(r)^2 \\hat{s}(r)}{r^2 + R^2 q(r)^2}\n$$\n最后一步是在 $R\\,q(r) \\gg r$ 的极限下找到此表达式的领头阶近似。这个极限等价于陈述 $(R\\,q(r))^2 \\gg r^2$。为了分析其行为，我们可以将分子和分母同除以 $R^2 q(r)^2$：\n$$\n\\frac{\\partial\\ln L_\\parallel}{\\partial\\ln r} = \\frac{\\frac{r^2}{R^2 q(r)^2} + \\hat{s}(r)}{\\frac{r^2}{R^2 q(r)^2} + 1}\n$$\n在指定极限下，$\\frac{r^2}{R^2 q(r)^2}$ 项趋近于零。因此，领头阶近似为：\n$$\n\\left.\\frac{\\partial\\ln L_\\parallel}{\\partial\\ln r}\\right|_{R\\,q \\gg r} \\approx \\frac{0 + \\hat{s}(r)}{0 + 1} = \\hat{s}(r)\n$$\n使用第1部分得到的 $\\hat{s}(r)$ 表达式，领头阶近似为：\n$$\n\\frac{\\alpha r}{q_0 + \\alpha r}\n$$\n这个结果表明，在大环径比极限下，平行连接长度的径向敏感度直接由磁剪切给出。\n\n最终答案是一个按顺序包含三个推导出的表达式的行矩阵。\n1. $\\hat{s}(r) = \\frac{\\alpha r}{q_0 + \\alpha r}$\n2. $L_\\parallel(N_{\\text{pol}}, r) = 2\\pi N_{\\text{pol}} \\sqrt{r^2 + R^2 (q_0 + \\alpha r)^2}$\n3. $\\partial\\ln L_\\parallel/\\partial\\ln r$ 的领头阶近似为 $\\frac{\\alpha r}{q_0 + \\alpha r}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\alpha r}{q_0 + \\alpha r}  2\\pi N_{\\text{pol}} \\sqrt{r^2 + R^2 (q_0 + \\alpha r)^2}  \\frac{\\alpha r}{q_0 + \\alpha r} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在建立了磁剪切的重要性之后，这个实践将深入探讨扭曲-平移边界条件本身的数学形式。您将使用场线标签 $\\alpha$ 的概念，推导出连接平行区域两端所需的副法向坐标位移。这个练习阐明了磁剪切如何直接转化为“扭曲-平移”操作，并证明了在没有磁剪切的情况下，它如何退化为简单的周期性边界条件 。",
            "id": "4198330",
            "problem": "考虑一个在场向坐标系 $(x,y,z)$ 中的磁化等离子体的局域磁通管模型，其中 $x$ 是无量纲的径向坐标，$y$ 是无量纲的副法向坐标，$z$ 是与极向角成正比的无量纲平行坐标。磁场具有 Clebsch 表示 $\\boldsymbol{B}=\\nabla \\alpha \\times \\nabla \\psi$，其中 $\\psi$ 是一个磁通函数，$\\alpha$ 是一个沿磁力线为常数的磁力线标签。在具有无量纲磁剪切 $\\hat{s}$ 的标准局域级数展开中，可以选择磁力线标签在局域上为 $\\alpha=y-\\hat{s}\\,x\\,z$。一个标量涨落 $f(x,y,z)$ 定义在平行域 $z\\in[-L_{z}/2,L_{z}/2]$ 上。扭曲-平移边界条件在将两端点 $z=-L_{z}/2$ 和 $z=+L_{z}/2$ 等同起来时，保证了 $f$ 沿磁力线的单值性。这意味着 $f$ 在点 $(x,y,+L_{z}/2)$ 的值必须等于其在位于同一磁力线上（即具有相同的 $\\alpha$）的点 $(x,y',-L_{z}/2)$ 的值。仅从 $\\alpha$ 沿磁力线为常数、$\\alpha=y-\\hat{s}\\,x\\,z$ 以及 $f$ 沿磁力线是单值这几个事实出发，推导在两端点进行扭曲-平移等同所需的副法向映射 $y'\\equiv y-\\Delta y$，并用 $\\hat{s}$、$x$ 和 $L_{z}$ 给出 $\\Delta y$ 的显式公式。然后，计算 $\\hat{s}=0$ 时的 $\\Delta y$。在所采用的归一化中，所有坐标都是无量纲的；请将 $\\hat{s}=0$ 时 $\\Delta y$ 的最终值作为无量纲量报告。你的最终答案必须是一个单一的数字或一个单一的闭合形式表达式。不需要四舍五入。",
            "solution": "出发点是 Clebsch 表示 $\\boldsymbol{B}=\\nabla \\alpha \\times \\nabla \\psi$ 以及局域磁力线标签的定义 $\\alpha=y-\\hat{s}\\,x\\,z$。根据构造，$\\alpha$ 沿磁力线为常数。扭曲-平移边界条件保证了当我们将两个平行端点 $z=-L_{z}/2$ 和 $z=+L_{z}/2$ 等同起来时，标量场 $f$ 在给定的磁力线上是单值的。这是通过要求点 $(x,y,+L_{z}/2)$ 与位于同一磁力线上的点 $(x,y',-L_{z}/2)$ 相匹配来实现的，这等价于要求这两点的磁力线标签 $\\alpha$ 在两个端点处相等。\n\n施加两端点磁力线标签相等的条件：\n$$\n\\alpha\\big|_{(x,y,+L_{z}/2)}=\\alpha\\big|_{(x,y',-L_{z}/2)}.\n$$\n使用 $\\alpha = y - \\hat{s}\\,x\\,z$，等式左边是\n$$\n\\alpha\\big|_{(x,y,+L_{z}/2)}=y-\\hat{s}\\,x\\left(+\\frac{L_{z}}{2}\\right),\n$$\n等式右边是\n$$\n\\alpha\\big|_{(x,y',-L_{z}/2)}=y'-\\hat{s}\\,x\\left(-\\frac{L_{z}}{2}\\right)=y'+\\hat{s}\\,x\\left(\\frac{L_{z}}{2}\\right).\n$$\n令这两个表达式相等，得到\n$$\ny-\\hat{s}\\,x\\left(\\frac{L_{z}}{2}\\right)=y'+\\hat{s}\\,x\\left(\\frac{L_{z}}{2}\\right).\n$$\n解出 $y'$ 得到\n$$\ny'=y-\\hat{s}\\,x\\,L_{z}.\n$$\n通过 $y'=y-\\Delta y$ 定义所需的平移量 $\\Delta y$，可以立即确定\n$$\n\\Delta y=\\hat{s}\\,x\\,L_{z}.\n$$\n这个映射确保了当从 $z=+L_{z}/2$ 移动到 $z=-L_{z}/2$ 时 $\\alpha$ 不变，从而通过以下方式保证了 $f$ 沿磁力线的单值性：\n$$\nf\\!\\left(x,y,+\\frac{L_{z}}{2}\\right)=f\\!\\left(x,y-\\Delta y,-\\frac{L_{z}}{2}\\right), \\quad \\Delta y=\\hat{s}\\,x\\,L_{z}.\n$$\n\n最后，在磁剪切为零（$\\hat{s}=0$）时计算该平移量，得到\n$$\n\\Delta y\\big|_{\\hat{s}=0}=0.\n$$\n当 $\\Delta y=0$ 时，扭曲-平移等同简化为简单的周期性边界条件\n$$\nf\\!\\left(x,y,+\\frac{L_{z}}{2}\\right)=f\\!\\left(x,y,-\\frac{L_{z}}{2}\\right).\n$$\n因此，所要求的在 $\\hat{s}=0$ 时的 $\\Delta y$ 的最终值为 $0$，在所采用的归一化中这是一个无量纲数。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "最后的这个实践从解析推导转向计算应用，模拟了建立磁通管模拟的核心任务。通过计算托卡马克（恒定磁剪切）和仿星器（变化磁剪切）的波数位移，您将量化使用不正确的（周期性）与正确的（扭曲-平移）边界条件所引入的误差。这个基准测试突出了扭曲-平移边界条件的实际必要性，并介绍了将其应用于不同磁场位形的复杂性 。",
            "id": "4198292",
            "problem": "考虑磁化等离子体中离子温度梯度（ITG）模的一种简化的线性磁通管模型。垂直于磁场的平面内的垂直涨落由具有垂直波矢分量 $k_x$ 和 $k_y$ 的单一傅里叶分量表示。平行坐标 $z$ 沿磁力线分布，是一个以弧度为单位测量的角度。在存在磁剪切的情况下，由于垂直坐标沿磁力线的变换，径向波数 $k_x$ 会随 $z$ 变化。扭曲-平移边界条件的设计旨在通过将 $z=L_z$ 处的 $k_x$ 相对于 $z=0$ 处进行适当的平移来确保傅里叶模在平行域 $z \\in [0,L_z]$ 两端的连续性，平移量取决于积分的几何剪切。相比之下，一个朴素的周期性边界条件对 $k_x$ 施加零平移。\n\n从第一性原理出发，通过证明平行域上的径向波数变化（记为 $\\Delta k_x$）是由局域剪切函数 $s(z)$ 的积分（由 $k_y$ 加权）所决定的，来模拟磁剪切的效应。精确地，用 $k_y$，$s(z)$ 和 $L_z$ 来推导 $\\Delta k_x$。对于轴对称托卡马克，取局域剪切为常数 $s(z)=\\hat{s}$，其中 $\\hat{s}$ 是磁剪切参数。对于非轴对称仿星器，取局域剪切为平行角的简单但非平凡的函数，\n$$\ns(z) = s_0 + s_1 \\cos(z) + s_2 \\sin(2z),\n$$\n其中 $s_0$，$s_1$ 和 $s_2$ 是由几何结构决定的常数。所有角度均以弧度为单位。\n\n你必须实现一个算法来量化因应用以下任一边界条件而引起的离散网格失配：\n- 周期性边界条件（边界处 $k_x$ 无平移），或\n- 扭曲-平移边界条件（在离散 $k_x$ 网格中应用整数索引平移以最小化失配）。\n\n假设两种几何结构都使用相同的垂直 $k_x$ 网格，其均匀间距为 $\\Delta k_x^{\\mathrm{grid}}$。对于给定的几何结构计算出的 $\\Delta k_x$，将选定整数网格平移 $\\Delta i$ 的无量纲失配误差定义为\n$$\ne = \\frac{\\left|\\Delta k_x - \\Delta i \\, \\Delta k_x^{\\mathrm{grid}}\\right|}{\\Delta k_x^{\\mathrm{grid}}}.\n$$\n对于周期性边界条件，设置 $\\Delta i = 0$。对于扭曲-平移边界条件，选择使 $e$ 最小化的整数 $\\Delta i$。\n\n你的程序必须为一组测试用例计算以下四个误差：\n- 托卡马克周期性误差 $e_{\\text{per,tok}}$，\n- 托卡马克扭曲-平移误差 $e_{\\text{tw,tok}}$，\n- 仿星器周期性误差 $e_{\\text{per,stel}}$，\n- 仿星器扭曲-平移误差 $e_{\\text{tw,stel}}$。\n\n使用以下测试套件，其中所有角度均以弧度为单位，所有波数均使用回旋动理学模拟中典型的归一化单位。每个测试用例指定了网格间距 $\\Delta k_x^{\\mathrm{grid}}$、副法向波数 $k_y$、平行域长度 $L_z$、托卡马克剪切 $\\hat{s}$ 以及仿星器剪切系数 $(s_0,s_1,s_2)$：\n\n- 测试用例 1 (具有中等剪切和非平凡z几何结构的一般情况):\n    - $\\Delta k_x^{\\mathrm{grid}} = 0.125$, $k_y = 0.35$, $L_z = 3.0$,\n    - 托卡马克 $\\hat{s} = 0.8$,\n    - 仿星器 $(s_0,s_1,s_2) = (0.6,0.3,0.1)$。\n\n- 测试用例 2 (托卡马克扭曲-平移的完美匹配，仿星器的接近匹配):\n    - $\\Delta k_x^{\\mathrm{grid}} = 0.1$, $k_y = 0.4$, $L_z = 2.0$,\n    - 托卡马克 $\\hat{s} = 1.25$,\n    - 仿星器 $(s_0,s_1,s_2) = (1.1,0.2,-0.1)$。\n\n- 测试用例 3 (托卡马克的半网格失配，仿星器的近乎精确匹配):\n    - $\\Delta k_x^{\\mathrm{grid}} = 0.2$, $k_y = 0.5$, $L_z = 1.5$,\n    - 托卡马克 $\\hat{s} = 0.9333333333333$,\n    - 仿星器 $(s_0,s_1,s_2) = (0.6,0.3,0.0)$。\n\n- 测试用例 4 (无副法向变化，两种几何结构均产生零平移):\n    - $\\Delta k_x^{\\mathrm{grid}} = 0.15$, $k_y = 0.0$, $L_z = 2.5$,\n    - 托卡马克 $\\hat{s} = 1.0$,\n    - 仿星器 $(s_0,s_1,s_2) = (0.7,0.2,0.05)$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按以下顺序包含每个测试用例的四个误差：\n$$\n\\left[e_{\\text{per,tok}}^{(1)}, e_{\\text{tw,tok}}^{(1)}, e_{\\text{per,stel}}^{(1)}, e_{\\text{tw,stel}}^{(1)}, \\ldots, e_{\\text{per,tok}}^{(4)}, e_{\\text{tw,tok}}^{(4)}, e_{\\text{per,stel}}^{(4)}, e_{\\text{tw,stel}}^{(4)}\\right],\n$$\n其中上标表示测试用例索引。所有角度必须以弧度为单位，所有输出必须是无单位的浮点数。",
            "solution": "问题陈述已经过严格评估，并被确定为有效。它在等离子体物理学中已建立的回旋动理学磁通管模拟框架内具有科学依据，在数学上是适定的，并以客观、正式的语言呈现。所有得出唯一解所需的数据和定义均已提供。\n\n主要任务是推导两种不同磁几何结构（托卡马克和仿星器）中，径向波数 $\\Delta k_x$ 在长度为 $L_z$ 的平行域上的总平移，然后量化在对该平移进行离散化以应用于周期性和扭曲-平移边界条件时引入的数值误差。\n\n首先，我们为波数平移建立理论基础。在磁通管模型中，磁场存在局域剪切，这导致垂直坐标的朝向在沿磁力线移动时发生变化。对于固定的副法向波数 $k_y$，这种几何效应体现为径向波数 $k_x$ 的变化。$k_x$ 相对于平行坐标 $z$ 的变化率由以下基本关系式给出：\n$$\n\\frac{d k_x}{d z} = -k_y s(z)\n$$\n负号是该领域的标准惯例。\n\n为求出径向波数的总变化量 $\\Delta k_x = k_x(L_z) - k_x(0)$，我们将此微分方程在平行域上从 $z=0$ 到 $z=L_z$ 进行积分：\n$$\n\\Delta k_x = \\int_0^{L_z} \\frac{d k_x}{d z'} dz' = \\int_0^{L_z} -k_y s(z') dz' = -k_y \\int_0^{L_z} s(z') dz'\n$$\n这个公式提供了物理上要求的 $k_x$ 平移量，任何数值方案都必须满足这个平移量，以保持模在跨越平行边界时的连续性。\n\n接下来，我们将这个通用公式应用于问题中定义的两种具体情况。\n\n对于轴对称托卡马克，在磁通管内沿磁力线的磁剪切近似恒定，因此 $s(z) = \\hat{s}$。积分是直接的：\n$$\n\\int_0^{L_z} \\hat{s} \\, dz' = \\hat{s} \\int_0^{L_z} dz' = \\hat{s} L_z\n$$\n因此，托卡马克的波数平移为：\n$$\n\\Delta k_{x, \\text{tok}} = -k_y \\hat{s} L_z\n$$\n\n对于非轴对称仿星器，剪切沿磁力线变化。问题提供了模型函数 $s(z) = s_0 + s_1 \\cos(z) + s_2 \\sin(2z)$。我们必须将此函数从 $z=0$ 到 $z=L_z$ 进行积分：\n$$\n\\int_0^{L_z} \\left(s_0 + s_1 \\cos(z') + s_2 \\sin(2z')\\right) dz' = \\left[ s_0 z' + s_1 \\sin(z') - \\frac{s_2}{2} \\cos(2z') \\right]_0^{L_z}\n$$\n计算该定积分得出：\n$$\n\\left( s_0 L_z + s_1 \\sin(L_z) - \\frac{s_2}{2} \\cos(2L_z) \\right) - \\left( s_0 \\cdot 0 + s_1 \\sin(0) - \\frac{s_2}{2} \\cos(0) \\right) = s_0 L_z + s_1 \\sin(L_z) - \\frac{s_2}{2} \\cos(2L_z) + \\frac{s_2}{2}\n$$\n因此，仿星器的波数平移为：\n$$\n\\Delta k_{x, \\text{stel}} = -k_y \\left( s_0 L_z + s_1 \\sin(L_z) - \\frac{s_2}{2} (\\cos(2L_z) - 1) \\right)\n$$\n\n最后一步是量化数值失配误差。径向波数的计算网格是离散的，具有均匀间距 $\\Delta k_x^{\\mathrm{grid}}$。数值边界条件必须通过该网格间距的某个整数倍（即 $\\Delta i \\, \\Delta k_x^{\\mathrm{grid}}$，其中 $\\Delta i$ 为整数）来近似物理平移 $\\Delta k_x$。无量纲失配误差 $e$ 定义为：\n$$\ne = \\frac{\\left|\\Delta k_x - \\Delta i \\, \\Delta k_x^{\\mathrm{grid}}\\right|}{\\Delta k_x^{\\mathrm{grid}}} = \\left| \\frac{\\Delta k_x}{\\Delta k_x^{\\mathrm{grid}}} - \\Delta i \\right|\n$$\n\n对于周期性边界条件，不施加任何平移，这对应于设置网格平移指数 $\\Delta i = 0$。此时误差为：\n$$\ne_{\\text{per}} = \\left| \\frac{\\Delta k_x}{\\Delta k_x^{\\mathrm{grid}}} \\right|\n$$\n\n对于扭曲-平移边界条件，选择整数网格平移 $\\Delta i$ 以最小化误差 $e$。这通过选择最接近比值 $X = \\frac{\\Delta k_x}{\\Delta k_x^{\\mathrm{grid}}}$ 的整数 $\\Delta i$ 来实现。这个最优整数平移是 $\\Delta i_{\\text{opt}} = \\text{round}(X)$，其中 $\\text{round}$ 函数将一个实数映射到其最近的整数。得到的最小误差为：\n$$\ne_{\\text{tw}} = \\left| \\frac{\\Delta k_x}{\\Delta k_x^{\\mathrm{grid}}} - \\text{round}\\left(\\frac{\\Delta k_x}{\\Delta k_x^{\\mathrm{grid}}}\\right) \\right|\n$$\n\n将要实现的算法将为每个测试用例首先使用推导出的公式计算 $\\Delta k_{x, \\text{tok}}$ 和 $\\Delta k_{x, \\text{stel}}$。然后，利用这些值和给定的 $\\Delta k_x^{\\mathrm{grid}}$，它将计算所需的四个误差：$e_{\\text{per,tok}}$、$e_{\\text{tw,tok}}$、$e_{\\text{per,stel}}$ 和 $e_{\\text{tw,stel}}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating boundary condition mismatch errors for a set of\n    gyrokinetic simulation test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1: general case\n        {'delta_kx_grid': 0.125, 'ky': 0.35, 'Lz': 3.0, 's_hat': 0.8, 's_coeffs': (0.6, 0.3, 0.1)},\n        # Test Case 2: perfect registry for tokamak T\n        {'delta_kx_grid': 0.1, 'ky': 0.4, 'Lz': 2.0, 's_hat': 1.25, 's_coeffs': (1.1, 0.2, -0.1)},\n        # Test Case 3: half-grid mismatch for tokamak\n        {'delta_kx_grid': 0.2, 'ky': 0.5, 'Lz': 1.5, 's_hat': 0.9333333333333, 's_coeffs': (0.6, 0.3, 0.0)},\n        # Test Case 4: no binormal variation\n        {'delta_kx_grid': 0.15, 'ky': 0.0, 'Lz': 2.5, 's_hat': 1.0, 's_coeffs': (0.7, 0.2, 0.05)},\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        delta_kx_grid = case['delta_kx_grid']\n        ky = case['ky']\n        Lz = case['Lz']\n        s_hat = case['s_hat']\n        s0, s1, s2 = case['s_coeffs']\n\n        # --- Calculate physical wavenumber shifts ---\n\n        # Tokamak shift\n        delta_kx_tok = -ky * s_hat * Lz\n\n        # Stellarator shift\n        integral_stel = s0 * Lz + s1 * np.sin(Lz) - (s2 / 2.0) * (np.cos(2.0 * Lz) - 1.0)\n        delta_kx_stel = -ky * integral_stel\n\n        # --- Calculate mismatch errors ---\n        \n        def calculate_errors(delta_kx, grid_spacing):\n            \"\"\"\n            Calculates periodic and twist-and-shift errors for a given physical shift.\n            \n            Args:\n                delta_kx (float): The physical shift in kx.\n                grid_spacing (float): The kx grid spacing.\n            \n            Returns:\n                tuple[float, float]: A tuple containing the periodic error and the \n                                     twist-and-shift error.\n            \"\"\"\n            if grid_spacing == 0:\n                # Avoid division by zero, though problem constraints make this unlikely.\n                return (np.inf, np.inf)\n            \n            # The ratio of the physical shift to the grid spacing\n            X = delta_kx / grid_spacing\n            \n            # Periodic error (shift index Delta_i = 0)\n            e_per = np.abs(X)\n            \n            # Twist-and-shift error (optimal integer shift)\n            # np.round rounds to the nearest even integer for .5 cases (e.g., round(2.5)=2, round(3.5)=4)\n            # The resulting error is 0.5 regardless, so this is fine.\n            delta_i_opt = np.round(X)\n            e_tw = np.abs(X - delta_i_opt)\n\n            return e_per, e_tw\n\n        # Calculate the four errors for the current test case\n        e_per_tok, e_tw_tok = calculate_errors(delta_kx_tok, delta_kx_grid)\n        e_per_stel, e_tw_stel = calculate_errors(delta_kx_stel, delta_kx_grid)\n\n        all_results.extend([e_per_tok, e_tw_tok, e_per_stel, e_tw_stel])\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) converts all floats to their string representation.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}