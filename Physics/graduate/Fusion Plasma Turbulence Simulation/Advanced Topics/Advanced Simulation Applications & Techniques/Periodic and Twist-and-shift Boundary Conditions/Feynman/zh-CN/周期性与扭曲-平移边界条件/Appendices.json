{
    "hands_on_practices": [
        {
            "introduction": "该练习将直接推导“扭曲-平移”边界条件中的“平移”部分。从剪切磁场的局域表示出发，你将看到，要求一个物理量沿着磁力线是单值的，如何自然地导致在区域边界处产生空间平移，以及当磁剪切为零时，这种平移如何消失，从而恢复为简单的周期性边界条件。",
            "id": "4198330",
            "problem": "考虑一个磁化等离子体的局域磁通管模型，其处于场向坐标 $(x,y,z)$ 中，其中 $x$ 是无量纲径向坐标，$y$ 是无量纲副法向坐标，$z$ 是与极向角成正比的无量纲平行坐标。磁场具有 Clebsch 表示 $\\boldsymbol{B}=\\nabla \\alpha \\times \\nabla \\psi$，其中 $\\psi$ 是一个磁通函数，$\\alpha$ 是一个沿磁力线为常数的磁力线标签。在具有无量纲磁剪切 $\\hat{s}$ 的标准局域级数中，可以选择局域磁力线标签为 $\\alpha=y-\\hat{s}\\,x\\,z$。一个标量涨落 $f(x,y,z)$ 定义在平行域 $z\\in[-L_{z}/2,L_{z}/2]$上。当识别两端 $z=-L_{z}/2$ 和 $z=+L_{z}/2$ 时，扭转-平移边界条件强制 $f$ 沿磁力线具有单值性，这意味着 $f$ 在 $(x,y,+L_{z}/2)$ 处的值必须等于其在位于同一磁力线上（即具有相同的 $\\alpha$）的点 $(x,y',-L_{z}/2)$ 处的值。仅从以下事实出发：$\\alpha$ 沿磁力线为常数，$\\alpha=y-\\hat{s}\\,x\\,z$，以及 $f$ 沿磁力线是单值的，推导在两端进行扭转-平移识别所需的副法向映射 $y'\\equiv y-\\Delta y$，并将其表示为 $\\Delta y$ 关于 $\\hat{s}$、$x$ 和 $L_{z}$ 的显式公式。然后，计算当 $\\hat{s}=0$ 时 $\\Delta y$ 的值。在所采用的归一化中，所有坐标都是无量纲的；请将 $\\hat{s}=0$ 时 $\\Delta y$ 的最终值作为无量纲量报告。你的最终答案必须是一个数字或一个封闭形式的表达式。无需四舍五入。",
            "solution": "出发点是 Clebsch 表示 $\\boldsymbol{B}=\\nabla \\alpha \\times \\nabla \\psi$ 以及局域磁力线标签的定义 $\\alpha=y-\\hat{s}\\,x\\,z$。根据构造，$\\alpha$ 沿磁力线为常数。扭转-平移边界条件强制要求，当识别两个平行端点 $z=-L_{z}/2$ 和 $z=+L_{z}/2$ 时，标量场 $f$ 沿给定的磁力线是单值的。这通过要求点 $(x,y,+L_{z}/2)$ 与位于同一磁力线上的点 $(x,y',-L_{z}/2)$ 相匹配来实现，这等价于要求这两个点的磁力线标签 $\\alpha$ 在两个端点处相等。\n\n施加两端磁力线标签相等的条件：\n$$\n\\alpha\\big|_{(x,y,+L_{z}/2)}=\\alpha\\big|_{(x,y',-L_{z}/2)}.\n$$\n使用 $\\alpha = y - \\hat{s}\\,x\\,z$，等式左边为\n$$\n\\alpha\\big|_{(x,y,+L_{z}/2)}=y-\\hat{s}\\,x\\left(+\\frac{L_{z}}{2}\\right),\n$$\n等式右边为\n$$\n\\alpha\\big|_{(x,y',-L_{z}/2)}=y'-\\hat{s}\\,x\\left(-\\frac{L_{z}}{2}\\right)=y'+\\hat{s}\\,x\\left(\\frac{L_{z}}{2}\\right).\n$$\n令这两个表达式相等，得到\n$$\ny-\\hat{s}\\,x\\left(\\frac{L_{z}}{2}\\right)=y'+\\hat{s}\\,x\\left(\\frac{L_{z}}{2}\\right).\n$$\n解出 $y'$ 得到\n$$\ny'=y-\\hat{s}\\,x\\,L_{z}.\n$$\n通过 $y'=y-\\Delta y$ 定义所需的平移量 $\\Delta y$，可以立即确定\n$$\n\\Delta y=\\hat{s}\\,x\\,L_{z}.\n$$\n该映射确保了当从 $z=+L_{z}/2$ 传递到 $z=-L_{z}/2$ 时 $\\alpha$ 保持不变，因此通过以下方式保证了 $f$ 沿磁力线的单值性\n$$\nf\\!\\left(x,y,+\\frac{L_{z}}{2}\\right)=f\\!\\left(x,y-\\Delta y,-\\frac{L_{z}}{2}\\right), \\quad \\Delta y=\\hat{s}\\,x\\,L_{z}.\n$$\n\n最后，在磁剪切为零（$\\hat{s}=0$）时计算该平移量，得到\n$$\n\\Delta y\\big|_{\\hat{s}=0}=0.\n$$\n当 $\\Delta y=0$ 时，扭转-平移识别简化为简单的周期性边界条件\n$$\nf\\!\\left(x,y,+\\frac{L_{z}}{2}\\right)=f\\!\\left(x,y,-\\frac{L_{z}}{2}\\right).\n$$\n因此，在 $\\hat{s}=0$ 时，所要求的 $\\Delta y$ 的最终值为 $0$，在所采用的归一化中是一个无量纲数。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "现代的湍流模拟通常在傅里叶空间中进行。这个练习将探讨实空间中的坐标平移如何转化为径向波数 $k_x$ 的移动。你将推导出一个关键的“闭合条件”，该条件确保了这种波数移动与数值模拟中使用的离散网格相兼容。",
            "id": "4198300",
            "problem": "考虑一个用于聚变等离子体中回旋动理学湍流的局域场向磁通管模型，其中垂直坐标为 $(x,y)$，平行坐标 $z$ 沿着磁场方向。垂直平面是双周期的，域尺寸为 $L_x$ 和 $L_y$，因此任何涨落标量场 $f(x,y,z)$ 在每个 $z$ 处都可以用离散波数 $k_x = \\frac{2\\pi}{L_x} n_x$ 和 $k_y = \\frac{2\\pi}{L_y} n_y$（其中 $n_x$ 和 $n_y$ 为整数）在 $(x,y)$ 上展开为傅里叶级数。平行坐标是周期的，范围为 $L_z$，并施加了扭曲-平移边界条件以计入均匀磁剪切 $\\hat{s}$。\n\n采用由线性剪切映射 $\\alpha(y,z) = y - \\hat{s}\\,z\\,x$ 定义的标准场向次法向坐标 $\\alpha(y,z)$，该映射在剪切平板近似中将垂直坐标与磁力线标签关联起来。假设傅里叶分量的涨落相位被构造成在 $z=0$ 处、在 $\\alpha$ 和 $x$ 为常数的表面上是恒定的，并利用这一点来推断有效径向波数如何随 $z$ 在均匀磁剪切下演化。\n\n仅从以下几点出发：(i) $(x,y)$ 的周期性意味着 $k_x$ 的离散傅里叶网格间距为 $\\Delta k_x = \\frac{2\\pi}{L_x}$，(ii) 上述 $\\alpha(y,z)$ 的定义，以及 (iii) 在推进一个平行周期 $L_z$ 后，扭曲-平移重映射必须正好落在离散的 $k_x$ 网格上的要求，推导出闭合条件，该条件用整数模式指数重映射来量化 $\\hat{s}$、$k_y$、$L_z$ 和 $L_x$ 之间的必要关系。然后，将整数重映射计数 $m$ 表示为关于 $\\hat{s}$、$k_y$、$L_z$ 和 $L_x$ 的单个闭合形式解析表达式。\n\n你的最终答案必须仅为 $m$ 的表达式，书写时无需单位。不需要进行数值计算。如果进行了中间量纲分析，请确保所有量的使用方式在物理上是一致的，并且适用于场向剪切平板回旋动理学建模。",
            "solution": "该问题要求在剪切平板磁几何中推导扭曲-平移边界条件的闭合条件，并找出整数重映射计数 $m$ 的表达式。推导过程将首先确定径向波数如何沿平行坐标演化，然后应用周期性约束。\n\n让我们从考虑参考平面 $z=0$ 处涨落标量场 $f(x,y,z)$ 的单个傅里叶分量开始。其空间依赖性由相位因子 $\\exp[i(k_x x + k_y y)]$ 给出，其中 $k_x$ 和 $k_y$ 分别是径向和次法向波数。我们将 $z=0$ 处的初始径向波数记为 $k_x(0)$。\n\n问题引入了场向次法向坐标 $\\alpha(y,z) = y - \\hat{s} z x$，并指出它可作为磁力线标签。在场向坐标系中，物理量沿磁力线变化缓慢。因此，点 $(x,y,z)$ 处模式的相位应由位于同一磁力线上的 $z=0$ 平面上的点 $(x,y_0,0)$ 处的相位决定。我们可以通过找到一个点 $(x, y_0, 0)$，它与 $(x, y, z)$ 具有相同的磁力线标签 $\\alpha$ 来确定这个关系。\n$$ \\alpha = y_0 - \\hat{s} \\cdot 0 \\cdot x = y - \\hat{s} z x $$\n这给出了回溯坐标 $y_0 = y - \\hat{s} x z$。\n\n设傅里叶模式在 $z=0$ 处的相位为 $S_0(x,y) = k_x(0) x + k_y y$。由于其场向性质，模式在任意 $z$ 处的相位 $S(x,y,z)$ 通过在回溯坐标处计算 $S_0$ 得到：\n$$ S(x,y,z) = S_0(x, y_0) = S_0(x, y - \\hat{s} x z) = k_x(0) x + k_y (y - \\hat{s} x z) $$\n我们可以重新组合这些项，以识别在坐标 $z$ 处的有效波数：\n$$ S(x,y,z) = [k_x(0) - k_y \\hat{s} z]x + k_y y $$\n这表明次法向波数 $k_y$ 保持不变，而有效径向波数 $k_x^{\\text{eff}}$ 随 $z$ 线性演化：\n$$ k_x^{\\text{eff}}(z) = k_x(0) - k_y \\hat{s} z $$\n这个结果源于前提 (ii)，即 $\\alpha(y,z)$ 的定义。\n\n接下来，我们应用边界条件。系统在平行方向上是周期的，周期为 $L_z$。如前提 (iii) 所述，扭曲-平移边界条件要求 $z=L_z$ 处的场结构必须能表示在与 $z=0$ 处场相同的离散傅里叶网格上。这意味着演化后的径向波数 $k_x^{\\text{eff}}(L_z)$ 必须与 $k_x$ 的某个允许的离散值重合。\n\n经过一个平行周期 $L_z$ 后，径向波数的总位移为：\n$$ \\Delta k_x = k_x^{\\text{eff}}(L_z) - k_x(0) = (k_x(0) - k_y \\hat{s} L_z) - k_x(0) = -k_y \\hat{s} L_z $$\n\n根据前提 (i)，域在 $x$ 方向上尺寸为 $L_x$ 的周期性为径向波数 $k_x$ 定义了一个离散网格。该网格上相邻点之间的间距为 $\\Delta k_x^{\\text{grid}} = \\frac{2\\pi}{L_x}$。为了使演化后的模式落在此网格的一个点上，其总波数位移 $\\Delta k_x$ 必须是网格间距 $\\Delta k_x^{\\text{grid}}$ 的整数倍。我们将这个整数记为 $m$，即“整数重映射计数”。\n$$ \\Delta k_x = m \\cdot \\Delta k_x^{\\text{grid}} $$\n其中 $m$ 必须是整数 ($m \\in \\mathbb{Z}$)。\n\n将波数位移和网格间距的表达式代入，得到闭合条件：\n$$ -k_y \\hat{s} L_z = m \\frac{2\\pi}{L_x} $$\n该方程建立了磁剪切 $\\hat{s}$、次法向波数 $k_y$、平行长度 $L_z$ 和径向长度 $L_x$ 之间所需的必要关系。\n\n最后一步是解此方程求出整数重映射计数 $m$。整理各项，我们得到 $m$ 的闭合形式表达式：\n$$ m = -\\frac{k_y \\hat{s} L_z L_x}{2\\pi} $$\n这个表达式量化了径向波数 $k_x$ 在一次平行穿行后移动的网格间距数量，从而确保满足扭曲-平移边界条件。为使此条件成立，模拟的参数必须被选择，以使得对于模拟中使用的 $k_y$ 的离散值，表达式的右侧计算结果为整数。",
            "answer": "$$\n\\boxed{-\\frac{k_y \\hat{s} L_z L_x}{2\\pi}}\n$$"
        },
        {
            "introduction": "最后的这个练习将这些概念应用于一个具体的计算问题。你将实现一个算法，用于计算简单托卡马克和更复杂仿星器所需的波数移动。通过计算由此产生的失配误差，你将定量地证明“扭曲-平移”条件相对于朴素周期性条件的重要性。",
            "id": "4198292",
            "problem": "考虑磁化等离子体中离子温度梯度（ITG）模的一种简化的线性通量管表示。垂直于磁场的平面内的垂直涨落由单个傅里叶分量表示，其垂直波矢分量为 $k_x$ 和 $k_y$。平行坐标 $z$ 沿磁力线方向，是以弧度为单位测量的角度。在存在磁剪切的情况下，由于垂直坐标沿磁力线的变换，径向波数 $k_x$ 随 $z$ 变化。扭曲-平移（twist-and-shift）边界条件旨在通过将 $z=L_z$ 处的 $k_x$ 相对于 $z=0$ 处进行适当的平移来确保傅里叶模在平行域 $z \\in [0,L_z]$ 两端的连续性，平移量取决于积分的几何剪切。相比之下，朴素的周期性边界条件对 $k_x$ 不施加任何平移。\n\n从第一性原理出发，通过证明径向波数在平行域上的变化量（记为 $\\Delta k_x$）由局部剪切函数 $s(z)$ 乘以 $k_y$ 的积分确定，来模拟磁剪切效应。具体来说，请用 $k_y$、$s(z)$ 和 $L_z$ 推导出 $\\Delta k_x$。对于轴对称的托卡马克，设局部剪切为常数 $s(z)=\\hat{s}$，其中 $\\hat{s}$ 是磁剪切参数。对于非轴对称的仿星器，设局部剪切是平行角的一个简单但非平凡的函数，\n$$\ns(z) = s_0 + s_1 \\cos(z) + s_2 \\sin(2z),\n$$\n其中 $s_0$、$s_1$ 和 $s_2$ 是由几何结构决定的常数。所有角度均以弧度为单位测量。\n\n你必须实现一个算法来量化在应用以下任一边界条件时引起的离散网格失配：\n- 周期性边界条件（边界上 $k_x$ 无平移），或\n- 扭曲-平移边界条件（在离散的 $k_x$ 网格中应用整数索引平移以最小化失配）。\n\n假设两种几何结构都使用相同的垂直 $k_x$ 网格，其均匀间距为 $\\Delta k_x^{\\mathrm{grid}}$。对于一个给定的几何结构计算出的 $\\Delta k_x$，定义一个无量纲失配误差 $e$，其对应于所选的整数网格平移 $\\Delta i$，公式如下\n$$\ne = \\frac{\\left|\\Delta k_x - \\Delta i \\, \\Delta k_x^{\\mathrm{grid}}\\right|}{\\Delta k_x^{\\mathrm{grid}}}.\n$$\n对于周期性边界条件，设置 $\\Delta i = 0$。对于扭曲-平移边界条件，选择使 $e$ 最小化的整数 $\\Delta i$。\n\n你的程序必须为一组测试用例计算以下四种误差：\n- 托卡马克周期性误差 $e_{\\text{per,tok}}$，\n- 托卡马克扭曲-平移误差 $e_{\\text{tw,tok}}$，\n- 仿星器周期性误差 $e_{\\text{per,stel}}$，\n- 仿星器扭曲-平移误差 $e_{\\text{tw,stel}}$。\n\n使用以下测试套件，其中所有角度均以弧度为单位，所有波数均采用回旋动理学模拟中典型的归一化单位。每个测试用例指定了网格间距 $\\Delta k_x^{\\mathrm{grid}}$、副法向波数 $k_y$、平行域长度 $L_z$、托卡马克剪切 $\\hat{s}$ 和仿星器剪切系数 $(s_0,s_1,s_2)$：\n\n- 测试用例 1（具有中等剪切和非平凡 $z$ 几何结构的一般情况）：\n    - $\\Delta k_x^{\\mathrm{grid}} = 0.125$, $k_y = 0.35$, $L_z = 3.0$,\n    - 托卡马克 $\\hat{s} = 0.8$,\n    - 仿星器 $(s_0,s_1,s_2) = (0.6,0.3,0.1)$。\n\n- 测试用例 2（托卡马克扭曲-平移的完美配准，仿星器的接近配准）：\n    - $\\Delta k_x^{\\mathrm{grid}} = 0.1$, $k_y = 0.4$, $L_z = 2.0$,\n    - 托卡马克 $\\hat{s} = 1.25$,\n    - 仿星器 $(s_0,s_1,s_2) = (1.1,0.2,-0.1)$。\n\n- 测试用例 3（托卡马克的半网格失配，仿星器的近乎精确配准）：\n    - $\\Delta k_x^{\\mathrm{grid}} = 0.2$, $k_y = 0.5$, $L_z = 1.5$,\n    - 托卡马克 $\\hat{s} = 0.9333333333333$,\n    - 仿星器 $(s_0,s_1,s_2) = (0.6,0.3,0.0)$。\n\n- 测试用例 4（无副法向变化，两种几何结构均产生零平移）：\n    - $\\Delta k_x^{\\mathrm{grid}} = 0.15$, $k_y = 0.0$, $L_z = 2.5$,\n    - 托卡马克 $\\hat{s} = 1.0$,\n    - 仿星器 $(s_0,s_1,s_2) = (0.7,0.2,0.05)$。\n\n你的程序应该生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。该列表必须按以下顺序包含每个测试用例的四种误差\n$$\n\\left[e_{\\text{per,tok}}^{(1)}, e_{\\text{tw,tok}}^{(1)}, e_{\\text{per,stel}}^{(1)}, e_{\\text{tw,stel}}^{(1)}, \\ldots, e_{\\text{per,tok}}^{(4)}, e_{\\text{tw,tok}}^{(4)}, e_{\\text{per,stel}}^{(4)}, e_{\\text{tw,stel}}^{(4)}\\right],\n$$\n其中上标表示测试用例的索引。所有角度必须以弧度为单位，所有输出必须是无单位的浮点数。",
            "solution": "问题陈述已经过严格评估，并被确定为有效。它在等离子体物理学中已建立的回旋动理学通量管模拟框架内具有科学依据，数学上是适定的，并以客观、正式的语言呈现。所有唯一解所需的必要数据和定义均已提供。\n\n主要任务是针对两种不同的磁几何结构（托卡马克和仿星器），推导在长度为 $L_z$ 的平行域上径向波数的总平移量 $\\Delta k_x$，然后量化在对该平移进行离散化时，周期性边界条件和扭曲-平移边界条件所引入的数值误差。\n\n首先，我们为波数平移建立理论基础。在通量管模型中，磁场存在局部剪切，这导致当沿磁力线移动时，垂直坐标的朝向会发生变化。对于固定的副法向波数 $k_y$，这种几何效应表现为径向波数 $k_x$ 的变化。$k_x$ 相对于平行坐标 $z$ 的变化率由以下基本关系给出：\n$$\n\\frac{d k_x}{d z} = -k_y s(z)\n$$\n负号是该领域的标准约定。\n\n为了求出径向波数的总变化量 $\\Delta k_x = k_x(L_z) - k_x(0)$，我们将此微分方程在平行域上从 $z=0$ 到 $z=L_z$ 进行积分：\n$$\n\\Delta k_x = \\int_0^{L_z} \\frac{d k_x}{d z'} dz' = \\int_0^{L_z} -k_y s(z') dz' = -k_y \\int_0^{L_z} s(z') dz'\n$$\n此公式提供了数值方案为保持模式在平行边界上的连续性所必须适应的物理上所需的 $k_x$ 平移量。\n\n接下来，我们将此通用公式应用于问题中定义的两种具体情况。\n\n对于轴对称的托卡马克，磁剪切在通量管内沿磁力线近似为常数，因此 $s(z) = \\hat{s}$。积分为：\n$$\n\\int_0^{L_z} \\hat{s} \\, dz' = \\hat{s} \\int_0^{L_z} dz' = \\hat{s} L_z\n$$\n因此，托卡马克的波数平移为：\n$$\n\\Delta k_{x, \\text{tok}} = -k_y \\hat{s} L_z\n$$\n\n对于非轴对称的仿星器，剪切沿磁力线变化。问题给出了模型函数 $s(z) = s_0 + s_1 \\cos(z) + s_2 \\sin(2z)$。我们必须将此函数从 $z=0$ 积分到 $z=L_z$：\n$$\n\\int_0^{L_z} \\left(s_0 + s_1 \\cos(z') + s_2 \\sin(2z')\\right) dz' = \\left[ s_0 z' + s_1 \\sin(z') - \\frac{s_2}{2} \\cos(2z') \\right]_0^{L_z}\n$$\n计算该定积分得出：\n$$\n\\left( s_0 L_z + s_1 \\sin(L_z) - \\frac{s_2}{2} \\cos(2L_z) \\right) - \\left( s_0 \\cdot 0 + s_1 \\sin(0) - \\frac{s_2}{2} \\cos(0) \\right) = s_0 L_z + s_1 \\sin(L_z) - \\frac{s_2}{2} \\cos(2L_z) + \\frac{s_2}{2}\n$$\n因此，仿星器的波数平移为：\n$$\n\\Delta k_{x, \\text{stel}} = -k_y \\left( s_0 L_z + s_1 \\sin(L_z) - \\frac{s_2}{2} (\\cos(2L_z) - 1) \\right)\n$$\n\n最后一步是量化数值失配误差。用于径向波数的计算网格是离散的，具有均匀间距 $\\Delta k_x^{\\mathrm{grid}}$。数值边界条件必须通过该网格间距的整数倍来近似物理平移 $\\Delta k_x$，即对于某个整数 $\\Delta i$，近似为 $\\Delta i \\, \\Delta k_x^{\\mathrm{grid}}$。无量纲失配误差 $e$ 定义为：\n$$\ne = \\frac{\\left|\\Delta k_x - \\Delta i \\, \\Delta k_x^{\\mathrm{grid}}\\right|}{\\Delta k_x^{\\mathrm{grid}}} = \\left| \\frac{\\Delta k_x}{\\Delta k_x^{\\mathrm{grid}}} - \\Delta i \\right|\n$$\n\n对于周期性边界条件，不施加平移，这对应于将网格平移指数 $\\Delta i$ 设置为 0。误差则为：\n$$\ne_{\\text{per}} = \\left| \\frac{\\Delta k_x}{\\Delta k_x^{\\mathrm{grid}}} \\right|\n$$\n\n对于扭曲-平移边界条件，选择整数网格平移 $\\Delta i$ 以最小化误差 $e$。这是通过选择最接近比值 $X = \\frac{\\Delta k_x}{\\Delta k_x^{\\mathrm{grid}}}$ 的整数 $\\Delta i$ 来实现的。这个最优整数平移是 $\\Delta i_{\\text{opt}} = \\text{round}(X)$，其中 $\\text{round}$ 函数将实数映射到其最近的整数。由此产生的最小误差是：\n$$\ne_{\\text{tw}} = \\left| \\frac{\\Delta k_x}{\\Delta k_x^{\\mathrm{grid}}} - \\text{round}\\left(\\frac{\\Delta k_x}{\\Delta k_x^{\\mathrm{grid}}}\\right) \\right|\n$$\n\n将要实现的算法，对于每个测试用例，将首先使用推导出的公式计算 $\\Delta k_{x, \\text{tok}}$ 和 $\\Delta k_{x, \\text{stel}}$。然后，使用这些值和给定的 $\\Delta k_x^{\\mathrm{grid}}$，它将计算所需的四个误差：$e_{\\text{per,tok}}$、$e_{\\text{tw,tok}}$、$e_{\\text{per,stel}}$ 和 $e_{\\text{tw,stel}}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating boundary condition mismatch errors for a set of\n    gyrokinetic simulation test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1: general case\n        {'delta_kx_grid': 0.125, 'ky': 0.35, 'Lz': 3.0, 's_hat': 0.8, 's_coeffs': (0.6, 0.3, 0.1)},\n        # Test Case 2: perfect registry for tokamak T\n        {'delta_kx_grid': 0.1, 'ky': 0.4, 'Lz': 2.0, 's_hat': 1.25, 's_coeffs': (1.1, 0.2, -0.1)},\n        # Test Case 3: half-grid mismatch for tokamak\n        {'delta_kx_grid': 0.2, 'ky': 0.5, 'Lz': 1.5, 's_hat': 0.9333333333333, 's_coeffs': (0.6, 0.3, 0.0)},\n        # Test Case 4: no binormal variation\n        {'delta_kx_grid': 0.15, 'ky': 0.0, 'Lz': 2.5, 's_hat': 1.0, 's_coeffs': (0.7, 0.2, 0.05)},\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        delta_kx_grid = case['delta_kx_grid']\n        ky = case['ky']\n        Lz = case['Lz']\n        s_hat = case['s_hat']\n        s0, s1, s2 = case['s_coeffs']\n\n        # --- Calculate physical wavenumber shifts ---\n\n        # Tokamak shift\n        delta_kx_tok = -ky * s_hat * Lz\n\n        # Stellarator shift\n        integral_stel = s0 * Lz + s1 * np.sin(Lz) - (s2 / 2.0) * (np.cos(2.0 * Lz) - 1.0)\n        delta_kx_stel = -ky * integral_stel\n\n        # --- Calculate mismatch errors ---\n        \n        def calculate_errors(delta_kx, grid_spacing):\n            \"\"\"\n            Calculates periodic and twist-and-shift errors for a given physical shift.\n            \n            Args:\n                delta_kx (float): The physical shift in kx.\n                grid_spacing (float): The kx grid spacing.\n            \n            Returns:\n                tuple[float, float]: A tuple containing the periodic error and the \n                                     twist-and-shift error.\n            \"\"\"\n            if grid_spacing == 0:\n                # Avoid division by zero, though problem constraints make this unlikely.\n                return (np.inf, np.inf)\n            \n            # The ratio of the physical shift to the grid spacing\n            X = delta_kx / grid_spacing\n            \n            # Periodic error (shift index Delta_i = 0)\n            e_per = np.abs(X)\n            \n            # Twist-and-shift error (optimal integer shift)\n            # np.round rounds to the nearest even integer for .5 cases (e.g., round(2.5)=2, round(3.5)=4)\n            # The resulting error is 0.5 regardless, so this is fine.\n            delta_i_opt = np.round(X)\n            e_tw = np.abs(X - delta_i_opt)\n\n            return e_per, e_tw\n\n        # Calculate the four errors for the current test case\n        e_per_tok, e_tw_tok = calculate_errors(delta_kx_tok, delta_kx_grid)\n        e_per_stel, e_tw_stel = calculate_errors(delta_kx_stel, delta_kx_grid)\n\n        all_results.extend([e_per_tok, e_tw_tok, e_per_stel, e_tw_stel])\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) converts all floats to their string representation.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}