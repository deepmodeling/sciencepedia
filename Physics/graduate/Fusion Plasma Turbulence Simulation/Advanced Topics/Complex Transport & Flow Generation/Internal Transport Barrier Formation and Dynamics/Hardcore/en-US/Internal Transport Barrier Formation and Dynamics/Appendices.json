{
    "hands_on_practices": [
        {
            "introduction": "The formation of an Internal Transport Barrier is often intimately linked to the underlying magnetic field structure. A key feature associated with robust ITBs is a non-monotonic safety factor profile, leading to a region of reversed magnetic shear. This first practice provides a foundational exercise in analyzing such a profile, helping to build an intuitive connection between the analytical form of the safety factor $q(r)$ and the existence of a shear-reversal region .",
            "id": "4192938",
            "problem": "Consider a large-aspect-ratio, axisymmetric tokamak with circular, concentric flux surfaces, major radius $R_0$, minor radius $a$, and a toroidal magnetic field $B_\\phi$ that is approximately constant across the minor radius. The safety factor $q(r)$ is defined as the ratio of the number of toroidal transits to poloidal transits of a magnetic field line and, in the large-aspect-ratio approximation, can be written as $q(r) \\equiv \\frac{r B_\\phi}{R_0 B_\\theta(r)}$, where $B_\\theta(r)$ is the poloidal magnetic field. The normalized magnetic shear is defined as $\\hat{s}(r) \\equiv \\frac{r}{q(r)} \\frac{dq}{dr}$. A region of reversed shear is one in which $\\hat{s}(r) < 0$ over a finite radial interval, typically associated with internal transport barrier (ITB) formation and dynamics in fusion plasma turbulence simulation.\n\nSuppose the safety factor profile is prescribed by the quartic form\n$$\nq(r) = q_0 + \\alpha \\left(\\frac{r}{a}\\right)^2 + \\beta \\left(\\frac{r}{a}\\right)^4,\n$$\nwith parameters $q_0 > 0$, $\\alpha < 0$, and $\\beta > 0$, representing a qualitatively reversed-shear configuration in the core that relaxes to monotonic shear toward the edge.\n\nStarting from the definitions above and without invoking any specialized stability criteria, determine the closed-form analytic expression for the minimum safety factor $q_{\\min}$ implied by the given $q(r)$, expressed solely in terms of $q_0$, $\\alpha$, and $\\beta$. Express your final answer as a single closed-form expression. No numerical evaluation is required, and no units should be included in the final answer.",
            "solution": "The problem requires the determination of the minimum value of the safety factor, $q_{\\min}$, based on the prescribed radial profile.\n\nThe given safety factor profile is a function of the minor radius $r$, defined as:\n$$\nq(r) = q_0 + \\alpha \\left(\\frac{r}{a}\\right)^2 + \\beta \\left(\\frac{r}{a}\\right)^4\n$$\nwhere $q_0$, $\\alpha$, $\\beta$, and $a$ are constants. The parameters are constrained such that $q_0 > 0$, $\\alpha < 0$, and $\\beta > 0$. The physical domain for the minor radius is $0 \\le r \\le a$.\n\nTo find the minimum value of the function $q(r)$, we must first find its critical points. The critical points are the locations where the first derivative of the function with respect to its variable is equal to zero. We compute the derivative of $q(r)$ with respect to $r$:\n$$\n\\frac{dq}{dr} = \\frac{d}{dr} \\left[ q_0 + \\alpha \\frac{r^2}{a^2} + \\beta \\frac{r^4}{a^4} \\right]\n$$\nApplying the power rule for differentiation, we obtain:\n$$\n\\frac{dq}{dr} = 0 + \\alpha \\frac{2r}{a^2} + \\beta \\frac{4r^3}{a^4} = \\frac{2\\alpha r}{a^2} + \\frac{4\\beta r^3}{a^4}\n$$\nWe find the critical points by setting this derivative to zero:\n$$\n\\frac{2\\alpha r}{a^2} + \\frac{4\\beta r^3}{a^4} = 0\n$$\nWe can factor out a term proportional to $r$:\n$$\nr \\left( \\frac{2\\alpha}{a^2} + \\frac{4\\beta r^2}{a^4} \\right) = 0\n$$\nThis equation yields two possible solutions for the locations of the critical points.\n\nThe first solution is $r = 0$. This corresponds to the magnetic axis. At this point, the safety factor is $q(0) = q_0$.\n\nThe second solution is found by setting the term in the parenthesis to zero:\n$$\n\\frac{2\\alpha}{a^2} + \\frac{4\\beta r^2}{a^4} = 0\n$$\nLet us solve for $r^2$:\n$$\n\\frac{4\\beta r^2}{a^4} = -\\frac{2\\alpha}{a^2}\n$$\n$$\nr^2 = -\\frac{2\\alpha a^4}{4\\beta a^2} = -\\frac{\\alpha}{2\\beta} a^2\n$$\nSince $r$ represents a physical radius, $r^2$ must be non-negative. The problem states that $\\alpha < 0$ and $\\beta > 0$. Therefore, the ratio $-\\frac{\\alpha}{2\\beta}$ is positive, and a real, positive root for $r$ exists. Let us denote the radius of this second critical point as $r_c$:\n$$\nr_c = a \\sqrt{-\\frac{\\alpha}{2\\beta}}\n$$\nTo determine whether these critical points correspond to a minimum or a maximum, we employ the second derivative test. The second derivative of $q(r)$ is:\n$$\n\\frac{d^2q}{dr^2} = \\frac{d}{dr} \\left( \\frac{2\\alpha r}{a^2} + \\frac{4\\beta r^3}{a^4} \\right) = \\frac{2\\alpha}{a^2} + \\frac{12\\beta r^2}{a^4}\n$$\nFirst, we evaluate the second derivative at $r = 0$:\n$$\n\\left. \\frac{d^2q}{dr^2} \\right|_{r=0} = \\frac{2\\alpha}{a^2}\n$$\nSince $\\alpha < 0$, the second derivative at $r=0$ is negative. This indicates that $q(0) = q_0$ is a local maximum. This is consistent with the physical description of a reversed-shear profile, where the safety factor decreases away from the magnetic axis.\n\nNext, we evaluate the second derivative at the second critical point, where $r^2 = r_c^2 = -\\frac{\\alpha}{2\\beta} a^2$:\n$$\n\\left. \\frac{d^2q}{dr^2} \\right|_{r=r_c} = \\frac{2\\alpha}{a^2} + \\frac{12\\beta}{a^4} \\left( -\\frac{\\alpha}{2\\beta} a^2 \\right) = \\frac{2\\alpha}{a^2} - \\frac{12\\alpha\\beta a^2}{2\\beta a^4} = \\frac{2\\alpha}{a^2} - \\frac{6\\alpha}{a^2} = -\\frac{4\\alpha}{a^2}\n$$\nSince $\\alpha < 0$, the quantity $-\\frac{4\\alpha}{a^2}$ is positive. A positive second derivative indicates that the critical point at $r = r_c$ is a local minimum.\n\nThe function $q(r)$ is a simple polynomial in $r^2$ with one local maximum at $r=0$ and one local minimum for $r>0$. Therefore, the value of the function at $r = r_c$ is the minimum safety factor, $q_{\\min}$. To find $q_{\\min}$, we substitute the expression for $r_c^2$ back into the original equation for $q(r)$:\n$$\nq_{\\min} = q(r_c) = q_0 + \\alpha \\left(\\frac{r_c}{a}\\right)^2 + \\beta \\left(\\frac{r_c}{a}\\right)^4\n$$\nWe have $\\left(\\frac{r_c}{a}\\right)^2 = \\frac{r_c^2}{a^2} = -\\frac{\\alpha}{2\\beta}$. Substituting this into the expression for $q_{\\min}$:\n$$\nq_{\\min} = q_0 + \\alpha \\left(-\\frac{\\alpha}{2\\beta}\\right) + \\beta \\left(-\\frac{\\alpha}{2\\beta}\\right)^2\n$$\n$$\nq_{\\min} = q_0 - \\frac{\\alpha^2}{2\\beta} + \\beta \\left(\\frac{\\alpha^2}{4\\beta^2}\\right)\n$$\n$$\nq_{\\min} = q_0 - \\frac{\\alpha^2}{2\\beta} + \\frac{\\alpha^2}{4\\beta}\n$$\nCombining the terms containing $\\alpha^2$ and $\\beta$:\n$$\nq_{\\min} = q_0 - \\frac{2\\alpha^2}{4\\beta} + \\frac{\\alpha^2}{4\\beta} = q_0 - \\frac{\\alpha^2}{4\\beta}\n$$\nThis is the closed-form analytic expression for the minimum safety factor, expressed solely in terms of the given parameters $q_0$, $\\alpha$, and $\\beta$.",
            "answer": "$$\n\\boxed{q_0 - \\frac{\\alpha^2}{4\\beta}}\n$$"
        },
        {
            "introduction": "Having explored the magnetic geometry conducive to ITBs, we now turn to their primary practical consequence: the enhancement of plasma confinement. An ITB acts as a dam against heat leakage, a phenomenon modeled by a local reduction in thermal diffusivity, $\\chi$. This exercise challenges you to quantify this effect by deriving and calculating the global energy confinement time, $\\tau_E$, demonstrating the direct performance benefit of establishing a transport barrier .",
            "id": "4192955",
            "problem": "A large-aspect-ratio tokamak of major radius $R$ and minor radius $a$ operates in steady state with uniform auxiliary heating power density $\\mathcal{P}$ (energy per unit time per unit volume) and uniform ion density $n(r) = n$ across flux surfaces. Energy is transported radially by turbulent conduction with heat flux density $q_r(r) = - n \\chi(r) \\frac{dT}{dr}$, where $\\chi(r)$ is the effective turbulent thermal diffusivity and $T(r)$ is the ion temperature. Assume axisymmetry and neglect convection and radiation such that the steady-state energy balance reduces to radial conduction carrying the locally deposited heating outward.\n\nModel the geometry using thin-flux-surface toroidal relations: the volume enclosed by a flux surface of minor radius $r$ is $V(r) = 2 \\pi^2 R r^2$ and the area of that flux surface is $A(r) = 4 \\pi^2 R r$. Impose boundary conditions $q_r(0) = 0$ and $T(a) = 0$. Define the total stored thermal energy $W$ by $W = \\int \\frac{3}{2} n T \\, dV$, and the total input power by $P_{\\text{in}} = \\int \\mathcal{P} \\, dV$. The energy confinement time is $\\tau_E = \\frac{W}{P_{\\text{in}}}$.\n\nConsider two transport states: a baseline state with uniform diffusivity $\\chi(r) = \\chi_0$, and a state with an Internal Transport Barrier (ITB) where diffusivity is reduced to $\\chi(r) = \\alpha \\chi_0$ over the barrier region $r \\in [r_b - w, r_b + w]$ and remains $\\chi_0$ elsewhere, with $0 < \\alpha < 1$. Using only the principles and definitions given above, derive an expression for $\\tau_E$ in terms of $a$, $\\chi(r)$, and the geometric quantities, and then evaluate $\\tau_E$ numerically for the ITB case with the following parameters:\n- $a = 0.60$ meters,\n- $\\chi_0 = 1.5$ meters$^2$ per second,\n- $r_b = 0.35$ meters,\n- $w = 0.10$ meters,\n- $\\alpha = 0.20$.\n\nExpress the final energy confinement time in seconds. Round your answer to three significant figures.",
            "solution": "The problem is validated as scientifically grounded, well-posed, objective, and consistent. It represents a standard simplification of heat transport in a tokamak plasma, a core topic in fusion energy science. All necessary definitions, parameters, and boundary conditions are provided to derive a unique and meaningful solution.\n\nThe derivation proceeds in several steps. First, we determine the radial heat flux density $q_r(r)$ from the steady-state energy balance. Second, we find the temperature profile $T(r)$ by integrating the heat transport equation. Third, we derive a general expression for the energy confinement time $\\tau_E$. Finally, we evaluate this expression for the specified Internal Transport Barrier (ITB) case.\n\nIn steady state, the total heating power deposited within a flux surface of minor radius $r$ must be balanced by the energy flux exiting through the surface area of that flux surface. The total power deposited inside the volume $V(r)$ is $P(r) = \\int_{V(r)} \\mathcal{P} \\, dV'$. Since the heating power density $\\mathcal{P}$ is uniform, this integral becomes $P(r) = \\mathcal{P} V(r)$. Using the given geometric relation $V(r) = 2 \\pi^2 R r^2$, we have $P(r) = 2 \\pi^2 R \\mathcal{P} r^2$.\n\nThe total heat flow rate across the surface area $A(r)$ is $q_r(r) A(r)$. The energy balance equation is thus $q_r(r) A(r) = P(r)$. Substituting the expressions for $A(r) = 4 \\pi^2 R r$ and $P(r)$, we get:\n$$q_r(r) (4 \\pi^2 R r) = 2 \\pi^2 R \\mathcal{P} r^2$$\nSolving for the heat flux density $q_r(r)$:\n$$q_r(r) = \\frac{2 \\pi^2 R \\mathcal{P} r^2}{4 \\pi^2 R r} = \\frac{\\mathcal{P} r}{2}$$\nThis expression satisfies the boundary condition $q_r(0) = 0$.\n\nNext, we determine the temperature profile $T(r)$ using the given definition for heat flux, $q_r(r) = -n \\chi(r) \\frac{dT}{dr}$. Since the ion density $n$ is uniform, we can write:\n$$\\frac{dT}{dr} = -\\frac{q_r(r)}{n \\chi(r)} = -\\frac{\\mathcal{P} r}{2n \\chi(r)}$$\nWe integrate this expression from a general radius $r$ to the plasma edge at $r=a$ to find the temperature profile, using the boundary condition $T(a) = 0$:\n$$T(r) - T(a) = \\int_a^r \\left( -\\frac{\\mathcal{P} r'}{2n \\chi(r')} \\right) dr'$$\n$$T(r) = \\frac{\\mathcal{P}}{2n} \\int_r^a \\frac{r'}{\\chi(r')} dr'$$\n\nNow we derive the expression for the energy confinement time $\\tau_E = W/P_{\\text{in}}$. First, we calculate the total input power $P_{\\text{in}}$ by integrating the power density $\\mathcal{P}$ over the entire plasma volume $V(a)$:\n$$P_{\\text{in}} = \\mathcal{P} V(a) = 2 \\pi^2 R a^2 \\mathcal{P}$$\nNext, we calculate the total stored thermal energy $W$, defined as $W = \\int \\frac{3}{2} n T \\, dV$. Using the toroidal volume element $dV = A(r)dr = 4 \\pi^2 R r dr$, the integral becomes:\n$$W = \\int_0^a \\frac{3}{2} n T(r) (4 \\pi^2 R r) dr = 6 \\pi^2 n R \\int_0^a r T(r) dr$$\nSubstituting the expression for $T(r)$:\n$$W = 6 \\pi^2 n R \\int_0^a r \\left( \\frac{\\mathcal{P}}{2n} \\int_r^a \\frac{r'}{\\chi(r')} dr' \\right) dr = 3 \\pi^2 R \\mathcal{P} \\int_0^a r \\left( \\int_r^a \\frac{r'}{\\chi(r')} dr' \\right) dr$$\nThe energy confinement time is the ratio of $W$ to $P_{\\text{in}}$:\n$$\\tau_E = \\frac{W}{P_{\\text{in}}} = \\frac{3 \\pi^2 R \\mathcal{P} \\int_0^a r \\left( \\int_r^a \\frac{r'}{\\chi(r')} dr' \\right) dr}{2 \\pi^2 R a^2 \\mathcal{P}} = \\frac{3}{2 a^2} \\int_0^a r \\left( \\int_r^a \\frac{r'}{\\chi(r')} dr' \\right) dr$$\nThe double integral can be simplified using integration by parts. Let $f(r) = \\frac{r}{\\chi(r)}$. The integral is $\\int_0^a r \\left( \\int_r^a f(r') dr' \\right) dr$. Applying integration by parts with $u = \\int_r^a f(r') dr'$ and $dv = r dr$, we find this simplifies to $\\int_0^a \\frac{r^3}{2 \\chi(r)} dr$. Thus, the expression for $\\tau_E$ becomes:\n$$\\tau_E = \\frac{3}{2 a^2} \\left( \\int_0^a \\frac{r^3}{2 \\chi(r)} dr \\right) = \\frac{3}{4 a^2} \\int_0^a \\frac{r^3}{\\chi(r)} dr$$\nThis is the general expression for $\\tau_E$ in terms of $a$ and the diffusivity profile $\\chi(r)$. Note that the major radius $R$, heating power density $\\mathcal{P}$, and ion density $n$ have all cancelled out.\n\nWe now evaluate this expression for the ITB case. The barrier is centered at $r_b = 0.35$ m with width $w = 0.10$ m. The inner and outer boundaries of the barrier are $r_1 = r_b - w = 0.25$ m and $r_2 = r_b + w = 0.45$ m, respectively. The diffusivity profile $\\chi(r)$ is piecewise:\n$$\\chi(r) = \\begin{cases} \\chi_0 & \\text{for } 0 \\le r < 0.25 \\, \\text{m} \\\\ \\alpha \\chi_0 & \\text{for } 0.25 \\, \\text{m} \\le r \\le 0.45 \\, \\text{m} \\\\ \\chi_0 & \\text{for } 0.45 \\, \\text{m} < r \\le a \\end{cases}$$\nThe integral for $\\tau_E$ must be split into three parts:\n$$\\int_0^a \\frac{r^3}{\\chi(r)} dr = \\int_0^{r_1} \\frac{r^3}{\\chi_0} dr + \\int_{r_1}^{r_2} \\frac{r^3}{\\alpha \\chi_0} dr + \\int_{r_2}^{a} \\frac{r^3}{\\chi_0} dr$$\n$$\\int_0^a \\frac{r^3}{\\chi(r)} dr = \\frac{1}{\\chi_0} \\left[ \\int_0^{r_1} r^3 dr + \\frac{1}{\\alpha} \\int_{r_1}^{r_2} r^3 dr + \\int_{r_2}^{a} r^3 dr \\right]$$\nEvaluating the definite integrals of $r^3$:\n$$\\int_0^a \\frac{r^3}{\\chi(r)} dr = \\frac{1}{\\chi_0} \\left[ \\left[\\frac{r^4}{4}\\right]_0^{r_1} + \\frac{1}{\\alpha} \\left[\\frac{r^4}{4}\\right]_{r_1}^{r_2} + \\left[\\frac{r^4}{4}\\right]_{r_2}^{a} \\right]$$\n$$\\int_0^a \\frac{r^3}{\\chi(r)} dr = \\frac{1}{4 \\chi_0} \\left[ r_1^4 + \\frac{1}{\\alpha}(r_2^4 - r_1^4) + (a^4 - r_2^4) \\right]$$\nSubstituting this back into the expression for $\\tau_E$:\n$$\\tau_E = \\frac{3}{4 a^2} \\left( \\frac{1}{4 \\chi_0} \\left[ r_1^4 + \\frac{r_2^4 - r_1^4}{\\alpha} + a^4 - r_2^4 \\right] \\right) = \\frac{3}{16 a^2 \\chi_0} \\left[ a^4 + \\left(\\frac{1}{\\alpha} - 1\\right)(r_2^4 - r_1^4) \\right]$$\nNow we substitute the given numerical values: $a = 0.60$ m, $\\chi_0 = 1.5$ m$^2$/s, $r_1 = 0.25$ m, $r_2 = 0.45$ m, and $\\alpha = 0.20$.\n$$a^2 = (0.60)^2 = 0.36 \\, \\text{m}^2$$\n$$a^4 = (0.60)^4 = 0.1296 \\, \\text{m}^4$$\n$$r_1^4 = (0.25)^4 = 0.00390625 \\, \\text{m}^4$$\n$$r_2^4 = (0.45)^4 = 0.04100625 \\, \\text{m}^4$$\n$$\\frac{1}{\\alpha} - 1 = \\frac{1}{0.20} - 1 = 5 - 1 = 4$$\nThe term in the brackets is:\n$$0.1296 + 4 \\times (0.04100625 - 0.00390625) = 0.1296 + 4 \\times (0.0371) = 0.1296 + 0.1484 = 0.278 \\, \\text{m}^4$$\nNow we compute $\\tau_E$:\n$$\\tau_E = \\frac{3}{16 \\times 0.36 \\times 1.5} \\times 0.278 = \\frac{3}{8.64} \\times 0.278 \\approx 0.0965277... \\, \\text{s}$$\nRounding the result to three significant figures as requested gives $0.0965$ seconds.",
            "answer": "$$\\boxed{0.0965}$$"
        },
        {
            "introduction": "While our previous exercises treated the ITB as a static feature, their existence is governed by a dynamic, non-linear interplay between turbulence and self-generated shear flows. This relationship is often described by predator-prey models, where the temperature gradient (\"prey\") fuels turbulence (\"predator\"), which in turn is suppressed by shear flows generated by the gradient itself. In this final practice, you will implement and simulate such a model, exploring how the system can evolve into distinct states of stable barrier, collapse, or oscillation, revealing the rich dynamics underlying ITB formation .",
            "id": "4056842",
            "problem": "You are tasked with implementing and analyzing a reduced, non-dimensional internal transport barrier (ITB) model that captures the interplay between a normalized temperature gradient and turbulence intensity under localized heating. The goal is to conduct a parameter sweep over heating localization and intensity, simulate the model dynamics, and classify the resulting regimes into barrier formation, collapse, or oscillation. Your program must be a complete, runnable program that produces the specified output format without requiring any user input.\n\nBegin from the following principle-level bases appropriate to computational fusion science and engineering:\n\n- Energy balance and transport: A normalized temperature gradient, denoted by $g(t)$, evolves under heating, linear relaxation, and turbulence-driven transport. Turbulence intensity, denoted by $w(t)$, is driven by gradient-based instability and suppressed by $E$ cross $B$ (E×B) shear.\n- Turbulent drive and shear suppression: The turbulence growth rate depends on $g(t)$ via a saturating nonlinearity, and the E×B shear decorrelation rate scales with the square of the local gradient.\n\nYou will implement a two-equation reduced model for a single representative flux surface at a fixed normalized minor radius $r_b = 0.6$ (non-dimensional), representative of the barrier location. The governing ordinary differential equations (ODEs) are:\n$$\n\\frac{dg}{dt} = Q \\, L(r_0,\\sigma) - C_g \\, g - \\alpha \\, w \\, g,\n$$\n$$\n\\frac{dw}{dt} = \\beta \\, \\frac{g^2}{1 + s \\, g^2} - C_w \\, w - S_{\\text{shear}} \\, g^2 \\, w,\n$$\nwhere $Q$ is the heating intensity, $r_0$ is the heating localization radius, and $\\sigma$ is the heating width. The localization factor $L(r_0,\\sigma)$ is a Gaussian:\n$$\nL(r_0,\\sigma) = \\exp\\left(-\\frac{(r_b - r_0)^2}{2 \\sigma^2}\\right).\n$$\nAll quantities are non-dimensional.\n\nUse the following fixed model parameters, which are chosen to be physically plausible and self-consistent in reduced modeling:\n- $C_g = 0.3$,\n- $\\alpha = 0.9$,\n- $\\beta = 1.5$,\n- $s = 0.5$,\n- $C_w = 0.4$,\n- $S_{\\text{shear}} = 3.0$,\n- $r_b = 0.6$.\n\nUse initial conditions $g(0) = 0.1$ and $w(0) = 0.05$, and integrate the ODEs from $t = 0$ to $t = 500$ (non-dimensional time) with sufficient resolution to capture transients and sustained dynamics.\n\nRegime classification must be performed on the numerical time series using the following criteria computed over the last $20\\%$ of the simulated time interval:\n- Compute the time-averaged gradient $\\overline{g}$ and time-averaged turbulence $\\overline{w}$ over the last $20\\%$ of the time series.\n- Define thresholds: $g_{\\text{high}} = 0.9$, $g_{\\text{low}} = 0.3$, $w_{\\text{low}} = 0.25$.\n- Barrier formation (code $1$): if $\\overline{g} > g_{\\text{high}}$ and $\\overline{w} < w_{\\text{low}}$.\n- Collapse (code $0$): if $\\overline{g} < g_{\\text{low}}$ and $\\overline{w} < w_{\\text{low}}$.\n- Oscillation (code $2$): if neither of the above applies and the last-half time series exhibits sustained oscillations, detected by at least $5$ significant local maxima of $g(t)$ with peak-to-peak amplitude greater than $0.3$, and with nontrivial variance (variance of $g(t)$ over the last $50\\%$ exceeding $0.01$ and similarly for $w(t)$).\n- If none of the conditions are met, classify as collapse (code $0$).\n\nNote that there are no physical units in this non-dimensional reduced model; all outputs must be unitless integers.\n\nYour program must simulate the model for each parameter set in the test suite below and output a classification code per case. The test suite spans a variety of behaviors including a high-intensity localized heating case, a low-intensity distant heating case, moderate intensity near-barrier conditions prone to oscillation, and width effects:\n\nTest suite of $(Q, r_0, \\sigma)$ values:\n- Case $1$: $(2.5, 0.6, 0.05)$,\n- Case $2$: $(0.3, 0.1, 0.2)$,\n- Case $3$: $(1.2, 0.62, 0.08)$,\n- Case $4$: $(1.8, 0.9, 0.05)$,\n- Case $5$: $(2.0, 0.6, 0.3)$,\n- Case $6$: $(1.0, 0.58, 0.05)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the test suite (e.g., \"[c1,c2,c3,c4,c5,c6]\"), where each $c_i$ is the integer classification code for case $i$ as defined above. No other text should be printed.",
            "solution": "The problem presented is a valid and well-posed exercise in computational physics, specifically in the field of fusion energy science. It requires the numerical solution of a system of coupled, non-linear ordinary differential equations (ODEs) that form a reduced model for the dynamics of an Internal Transport Barrier (ITB) in a tokamak plasma. The task is to simulate the model under various heating scenarios and classify the resulting plasma state.\n\nThe core of the problem lies in the following system of two non-dimensional ODEs, which describe the temporal evolution of the normalized temperature gradient, $g(t)$, and the normalized turbulence intensity, $w(t)$, at a specific radial location $r_b = 0.6$:\n$$\n\\frac{dg}{dt} = Q \\, L(r_0,\\sigma) - C_g \\, g - \\alpha \\, w \\, g\n$$\n$$\n\\frac{dw}{dt} = \\beta \\, \\frac{g^2}{1 + s \\, g^2} - C_w \\, w - S_{\\text{shear}} \\, g^2 \\, w\n$$\nThis system is a classic example of a predator-prey model, where the gradient $g(t)$ acts as the \"prey\" and the turbulence $w(t)$ acts as the \"predator\".\n\nThe first equation governs the temperature gradient $g(t)$. Each term corresponds to a distinct physical process:\n- The source term, $Q_h = Q \\, L(r_0,\\sigma)$, represents external heating applied to the plasma. $Q$ is the total heating power, and the function $L(r_0,\\sigma) = \\exp\\left(-\\frac{(r_b - r_0)^2}{2 \\sigma^2}\\right)$ models the localization of this heating. A value of $L$ close to $1$ signifies heating that is highly concentrated at the barrier location $r_b$, while a value close to $0$ represents off-axis heating that does not directly fuel the gradient at this location.\n- The linear term $-C_g \\, g$ represents a standard relaxation or damping process, modeling energy loss through neoclassical or other non-turbulent transport channels at a rate proportional to the gradient. Here, the constant is $C_g = 0.3$.\n- The non-linear term $-\\alpha \\, w \\, g$ models the turbulent transport of heat, which is the primary mechanism for energy loss in a turbulent plasma. The heat flux is proportional to the product of the turbulence intensity $w$ and the gradient $g$, with a coupling coefficient $\\alpha = 0.9$. This term shows how turbulence \"preys\" on the gradient, reducing it.\n\nThe second equation governs the turbulence intensity $w(t)$:\n- The term $\\beta \\, \\frac{g^2}{1 + s \\, g^2}$ represents the drive for the turbulence. Gradient-driven instabilities, such as ion temperature gradient (ITG) modes, are a primary source of turbulence. The growth rate increases with the gradient $g$ but saturates at very high gradients, a behavior captured by this functional form with parameters $\\beta = 1.5$ and $s = 0.5$.\n- The linear term $-C_w \\, w$ is a simple damping term for the turbulence, representing mechanisms that dissipate turbulent energy. The constant is $C_w = 0.4$.\n- The most crucial term for ITB formation is the shear suppression term, $-S_{\\text{shear}} \\, g^2 \\, w$. A strong temperature gradient generates sheared E×B plasma flows. These flows tear apart and decorrelate the turbulent eddies, actively suppressing the turbulence. This suppression is highly non-linear, scaling with $g^2$, and is modulated by the constant $S_{\\text{shear}} = 3.0$. This term represents the \"prey's\" defense mechanism: a high gradient can suppress its own predator.\n\nThe algorithmic approach to solving this problem consists of two main stages: numerical integration followed by time-series analysis for classification.\n\nFirst, for each parameter set $(Q, r_0, \\sigma)$, the system of ODEs is solved numerically. The `scipy.integrate.solve_ivp` function is the appropriate tool for this task, as it provides robust and adaptive algorithms for initial value problems. The integration is performed from $t=0$ to $t=500$ with specified initial conditions $g(0) = 0.1$ and $w(0) = 0.05$. A sufficiently large number of time points must be evaluated to resolve the potentially complex dynamics, including rapid transients and sustained oscillations.\n\nSecond, upon obtaining the time series for $g(t)$ and $w(t)$, a classification algorithm is applied to determine the final state of the system. The analysis focuses on the latter part of the simulation to characterize the asymptotic behavior, discarding the initial transient phase.\n- An analysis window covering the last $20\\%$ of the simulation time (from $t=400$ to $t=500$) is used to compute the time-averaged gradient $\\overline{g}$ and turbulence $\\overline{w}$.\n- These average values are compared against predefined thresholds: $g_{\\text{high}} = 0.9$, $g_{\\text{low}} = 0.3$, and $w_{\\text{low}} = 0.25$.\n- A \"Barrier formation\" state (code $1$) is identified if the system settles into a high-gradient, low-turbulence state, i.e., $\\overline{g} > g_{\\text{high}}$ and $\\overline{w} < w_{\\text{low}}$.\n- A \"Collapse\" state (code $0$) is identified if the system is in a low-gradient, low-turbulence state, where $\\overline{g} < g_{\\text{low}}$ and $\\overline{w} < w_{\\text{low}}$.\n- If neither of these steady-state conditions is met, the system is checked for oscillatory behavior. This check is performed over the last $50\\%$ of the simulation (from $t=250$ to $t=500$). An \"Oscillation\" state (code $2$) is declared if all of the following conditions are true:\n    1. The variances of both $g(t)$ and $w(t)$ are non-trivial (greater than $0.01$), indicating dynamic activity.\n    2. The time series for $g(t)$ exhibits at least $5$ local maxima, indicating sustained oscillatory behavior rather than a simple overshoot.\n    3. The peak-to-peak amplitude of the oscillation in $g(t)$ is significant, defined as the difference between the maximum and minimum value of $g(t)$ over this window being greater than $0.3$.\n- If none of the specific criteria for barrier, collapse, or oscillation are met, the state is classified by default as a collapse (code $0$), representing a generic low-confinement mode.\n\nThis systematic procedure of simulation and classification allows for a quantitative exploration of the parameter space, mapping different heating scenarios to distinct and physically meaningful plasma transport regimes.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Simulates a reduced internal transport barrier (ITB) model and classifies the\n    resulting regimes for a suite of test cases.\n    \"\"\"\n    \n    # Test suite of (Q, r0, sigma) values\n    test_cases = [\n        (2.5, 0.6, 0.05),  # Case 1\n        (0.3, 0.1, 0.2),   # Case 2\n        (1.2, 0.62, 0.08), # Case 3\n        (1.8, 0.9, 0.05),  # Case 4\n        (2.0, 0.6, 0.3),   # Case 5\n        (1.0, 0.58, 0.05),  # Case 6\n    ]\n\n    results = []\n\n    # Fixed model parameters\n    Cg = 0.3\n    alpha = 0.9\n    beta = 1.5\n    s = 0.5\n    Cw = 0.4\n    S_shear = 3.0\n    rb = 0.6\n\n    # Simulation parameters\n    t_span = [0, 500]\n    t_eval = np.linspace(t_span[0], t_span[1], 10000)\n    initial_conditions = [0.1, 0.05] # [g(0), w(0)]\n\n    for Q, r0, sigma in test_cases:\n        \n        # Calculate the constant heating source term\n        L = np.exp(-((rb - r0)**2) / (2 * sigma**2))\n        Q_h = Q * L\n\n        def itb_model(t, y):\n            \"\"\"Defines the system of ODEs for the ITB model.\"\"\"\n            g, w = y\n            \n            dg_dt = Q_h - Cg * g - alpha * w * g\n            dw_dt = beta * (g**2 / (1 + s * g**2)) - Cw * w - S_shear * g**2 * w\n            \n            return [dg_dt, dw_dt]\n\n        # Numerically integrate the ODEs\n        sol = solve_ivp(\n            itb_model, \n            t_span, \n            initial_conditions,\n            method='RK45', \n            t_eval=t_eval\n        )\n        \n        g_series = sol.y[0]\n        w_series = sol.y[1]\n        \n        # --- Regime Classification ---\n        \n        # Analysis over the last 20% of the time series for steady state\n        last_20_percent_idx = int(len(t_eval) * 0.8)\n        g_last_20 = g_series[last_20_percent_idx:]\n        w_last_20 = w_series[last_20_percent_idx:]\n        \n        g_mean = np.mean(g_last_20)\n        w_mean = np.mean(w_last_20)\n        \n        # Thresholds\n        g_high = 0.9\n        g_low = 0.3\n        w_low = 0.25\n        \n        # Classification logic\n        classification_code = 0 # Default to collapse\n\n        # Check for Barrier formation (code 1)\n        if g_mean > g_high and w_mean < w_low:\n            classification_code = 1\n        # Check for Collapse (code 0)\n        elif g_mean < g_low and w_mean < w_low:\n            classification_code = 0\n        else:\n            # If not a clear steady state, check for Oscillation (code 2)\n            \n            # Analysis over the last 50% of the time series for oscillations\n            last_50_percent_idx = int(len(t_eval) * 0.5)\n            g_last_50 = g_series[last_50_percent_idx:]\n            w_last_50 = w_series[last_50_percent_idx:]\n            \n            # Condition 1: Non-trivial variance\n            g_var_ok = np.var(g_last_50) > 0.01\n            w_var_ok = np.var(w_last_50) > 0.01\n            \n            if g_var_ok and w_var_ok:\n                # Condition 2: At least 5 local maxima in g(t)\n                # A point is a local maximum if it is greater than its neighbors\n                peaks = 0\n                for i in range(1, len(g_last_50) - 1):\n                    if g_last_50[i] > g_last_50[i-1] and g_last_50[i] > g_last_50[i+1]:\n                        peaks += 1\n                \n                num_peaks_ok = (peaks >= 5)\n\n                if num_peaks_ok:\n                    # Condition 3: Significant peak-to-peak amplitude\n                    amplitude = np.max(g_last_50) - np.min(g_last_50)\n                    amplitude_ok = (amplitude > 0.3)\n                    \n                    if amplitude_ok:\n                        classification_code = 2\n                    else: # Not oscillating significantly, default to collapse\n                        classification_code = 0\n                else: # Not enough peaks, default to collapse\n                    classification_code = 0\n            else: # Low variance, default to collapse\n                classification_code = 0\n        \n        results.append(classification_code)\n    \n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}