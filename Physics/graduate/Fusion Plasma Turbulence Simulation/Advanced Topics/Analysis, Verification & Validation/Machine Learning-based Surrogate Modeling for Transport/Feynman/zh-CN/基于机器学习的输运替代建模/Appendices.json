{
    "hands_on_practices": [
        {
            "introduction": "在将机器学习代理模型用于科学预测之前，一个最基本的问题是：这个模型在物理上是合理的吗？即使是复杂的代理模型也必须遵守基本的物理原理，例如在没有梯度驱动的情况下输运通量应为零。本练习  介绍了一种量化方法，通过定义和计算“残差”来检验模型是否符合这些基本物理约束，这是模型验证中至关重要的第一步。",
            "id": "4194327",
            "problem": "考虑一个用于聚变等离子体湍流输运的机器学习代理模型，该模型将无量纲局部梯度输入映射到回旋玻姆归一化的径向热通量。设 $x$ 表示无量纲密度梯度参数，$y$ 表示无量纲温度梯度参数，两者都定义为宏观长度尺度与其各自梯度标长之比。该代理模型预测归一化热通量 $Q_{\\text{s}}(x,y)$，其单位为回旋玻姆（gB）归一化单位。对于磁通面平均的局域扩散闭合，基本输运理论表明湍流热通量是由热力学梯度驱动的。特别地，在梯度趋于零时，湍流热通量的扩散分量消失；在领头阶上，当单个驱动梯度反向时，热通量符号反转，反映了梯度的奇宇称性。这些解析极限被用来验证代理模型的一致性。\n\n从扩散热输运的基本本构关系出发，即热通量与负温度梯度成正比，一个物理上一致的代理模型应满足以下两个解析极限：\n- 零梯度极限：$Q_{\\text{true}}(0,0)=0$。\n- 小振幅下单梯度反转下的奇对称性：对于固定的 $x=0$ 和小的 $|y|$，领头阶响应满足 $Q_{\\text{true}}(0,-y)=-Q_{\\text{true}}(0,y)$。\n\n定义验证残差，用于衡量代理模型与这些解析极限的偏差，如下所示：\n- 零梯度残差：$R_{0}=\\left|Q_{\\text{s}}(0,0)-0\\right|$。\n- 在指定测试梯度幅度 $y_{0}$ 处的奇对称性残差：\n$$\nR_{\\text{odd}}(y_{0})=\\left|\\frac{Q_{\\text{s}}(0,y_{0})+Q_{\\text{s}}(0,-y_{0})}{Q_{\\text{s}}(0,y_{0})-Q_{\\text{s}}(0,-y_{0})}\\right|,\n$$\n该值等于在 $y_{0}$ 处偶分量的大小除以奇分量的大小。\n\n假设代理模型具有以下关于梯度的多项式形式：\n$$\nQ_{\\text{s}}(x,y)=a\\,x+b\\,y+c\\,x\\,y+d\\,y^{2}+e,\n$$\n其中参数为 $a=0.8$, $b=1.2$, $c=0.05$, $d=0.1$ 和 $e=0.02$。使用测试值 $y_{0}=1.3$。计算两个残差 $R_{0}$ 和 $R_{\\text{odd}}(y_{0})$。将两个残差都表示为无量纲数，并将您的答案四舍五入到四位有效数字。",
            "solution": "题目陈述经验证在科学上是合理的、适定的、客观且自包含的。代理建模、根据物理极限（零梯度、奇对称性）进行验证以及使用定量残差等概念，是计算物理和工程领域的标准做法。为求得唯一解，所有必要的数据和定义均已给出。\n\n零梯度残差 $R_{0}$ 定义为 $R_{0}=\\left|Q_{\\text{s}}(0,0)-0\\right|$。热通量的代理模型由以下多项式给出：\n$$\nQ_{\\text{s}}(x,y)=a\\,x+b\\,y+c\\,x\\,y+d\\,y^{2}+e\n$$\n为计算 $R_{0}$，我们在 $x=0$ 和 $y=0$ 处对 $Q_{\\text{s}}(x,y)$ 求值：\n$$\nQ_{\\text{s}}(0,0) = a(0) + b(0) + c(0)(0) + d(0)^{2} + e = e\n$$\n参数 $e$ 的值为 $e=0.02$。因此，零梯度残差为：\n$$\nR_{0} = |Q_{\\text{s}}(0,0)| = |e| = |0.02| = 0.02\n$$\n题目要求答案四舍五入到四位有效数字。为将 $0.02$ 表示为四位有效数字，我们将其写为 $0.02000$。\n\n接下来，我们计算在测试梯度幅度 $y_{0}=1.3$ 处的奇对称性残差 $R_{\\text{odd}}(y_{0})$。其定义为：\n$$\nR_{\\text{odd}}(y_{0})=\\left|\\frac{Q_{\\text{s}}(0,y_{0})+Q_{\\text{s}}(0,-y_{0})}{Q_{\\text{s}}(0,y_{0})-Q_{\\text{s}}(0,-y_{0})}\\right|\n$$\n首先，我们确定代理模型在 $x=0$ 时的形式：\n$$\nQ_{\\text{s}}(0,y) = b\\,y + d\\,y^{2} + e\n$$\n然后，我们在 $y=y_{0}$ 和 $y=-y_{0}$ 处对此表达式求值：\n$$\nQ_{\\text{s}}(0,y_{0}) = b\\,y_{0} + d\\,y_{0}^{2} + e\n$$\n$$\nQ_{\\text{s}}(0,-y_{0}) = b(-y_{0}) + d(-y_{0})^{2} + e = -b\\,y_{0} + d\\,y_{0}^{2} + e\n$$\n现在我们计算残差表达式的分子和分母所需的和与差。\n和为：\n$$\nQ_{\\text{s}}(0,y_{0}) + Q_{\\text{s}}(0,-y_{0}) = (b\\,y_{0} + d\\,y_{0}^{2} + e) + (-b\\,y_{0} + d\\,y_{0}^{2} + e) = 2\\,d\\,y_{0}^{2} + 2\\,e\n$$\n差为：\n$$\nQ_{\\text{s}}(0,y_{0}) - Q_{\\text{s}}(0,-y_{0}) = (b\\,y_{0} + d\\,y_{0}^{2} + e) - (-b\\,y_{0} + d\\,y_{0}^{2} + e) = 2\\,b\\,y_{0}\n$$\n将这些代入 $R_{\\text{odd}}(y_{0})$ 的表达式，得到：\n$$\nR_{\\text{odd}}(y_{0}) = \\left|\\frac{2\\,d\\,y_{0}^{2} + 2\\,e}{2\\,b\\,y_{0}}\\right| = \\left|\\frac{d\\,y_{0}^{2} + e}{b\\,y_{0}}\\right|\n$$\n此表达式表明，该残差度量了代理模型的偶分量（$d\\,y^2$ 和 $e$ 项）与领头阶奇分量（$b\\,y$ 项）之比。\n现在，我们代入指定的数值：$b=1.2$，$d=0.1$，$e=0.02$ 和 $y_{0}=1.3$。\n$$\nR_{\\text{odd}}(1.3) = \\left|\\frac{(0.1)(1.3)^{2} + 0.02}{(1.2)(1.3)}\\right|\n$$\n我们计算分子和分母：\n分子：$(0.1)(1.69) + 0.02 = 0.169 + 0.02 = 0.189$。\n分母：$(1.2)(1.3) = 1.56$。\n$$\nR_{\\text{odd}}(1.3) = \\frac{0.189}{1.56} \\approx 0.121153846...\n$$\n将此结果四舍五入到四位有效数字，得到 $0.1212$。\n\n计算出的两个残差为 $R_{0}=0.02000$ 和 $R_{\\text{odd}}(1.3)=0.1212$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.02000  0.1212 \\end{pmatrix}}$$"
        },
        {
            "introduction": "了解如何验证一个给定的模型后，下一步自然是将这些物理规则直接整合到模型的训练过程中。这可以通过设计一个定制的“损失函数”来实现，该函数会对违反物理定律（如粒子数守恒，即电荷守恒约束下的准中性条件，以及单调性）的模型进行惩罚。本练习  将指导您构建一个复合损失函数，该函数能在预测准确性与物理约束之间取得平衡。",
            "id": "4194285",
            "problem": "考虑一个监督学习场景，其中训练一个人工神经网络（ANN）代理模型，用以根据局域梯度输入来预测磁化聚变等离子体中的回旋动理学湍流输运通量。目标是学习从归一化的局域输入到磁面平均的离子和电子湍流通量的映射。令 $s \\in \\{i,e\\}$ 表示粒子种类（离子 $i$，电子 $e$）。对于每个以 $n \\in \\{1,\\dots,N\\}$ 为索引的训练样本，输入包括归一化的温度梯度参数 $\\kappa_{s,n} \\equiv -\\frac{a}{T_s}\\frac{dT_s}{dr}$ 和一个归一化的密度梯度参数 $a_n \\equiv -\\frac{a}{n}\\frac{dn}{dr}$，其中 $r$ 是小半径，$a$ 是用于归一化的托卡马克小半径。目标是磁面平均的湍流热通量 $Q_{s,n}$ 和粒子通量 $\\Gamma_{s,n}$。ANN 为这些量生成预测值 $\\hat{Q}_{s,n}$ 和 $\\hat{\\Gamma}_{s,n}$。\n\n复合目标函数应平衡两个要求：\n1. 准确预测湍流通量，通过相对误差进行评估。\n2. 基于物理的约束惩罚：\n   - 双极性粒子输运（准电中性）以反映电荷守恒，对于单电荷离子，这意味着离子和电子的粒子通量应该匹配，即 $\\Gamma_i \\approx \\Gamma_e$。\n   - 相对于驱动梯度的单调性，其物理动机是在漂移波湍流下，湍流输运系数是正定的：湍流热通量 $Q_s$ 应相对于 $\\kappa_s$ 非递减，湍流粒子通量 $\\Gamma_s$ 应相对于 $a$ 非递减。\n\n从以下符合背景的基本原理出发：\n- 粒子种类 $s$ 的磁面平均连续性方程：$\\frac{\\partial n_s}{\\partial t} + \\frac{1}{V'}\\frac{\\partial}{\\partial \\psi}\\left(V'\\Gamma_s\\right) = S_s$，其中 $V'$ 是体积对磁通坐标 $\\psi$ 的导数，$S_s$ 是源项。在稳态、准电中性源和单电荷离子的条件下，双极性意味着 $\\Gamma_i \\approx \\Gamma_e$。\n- 漂移波湍流中梯度驱动的输运本构关系：$Q_s \\sim -n_s \\chi_s \\frac{dT_s}{dr}$ 和 $\\Gamma_s \\sim -D_s \\frac{dn}{dr}$，其中 $\\chi_s \\ge 0$ 和 $D_s \\ge 0$，这意味着随着驱动梯度幅度的增加，$Q_s$ 和 $\\Gamma_s$ 不应减小。\n\n定义相对误差项的正权重 $\\alpha_Q^i$, $\\alpha_Q^e$, $\\alpha_{\\Gamma}^i$, $\\alpha_{\\Gamma}^e$，正惩罚权重 $\\lambda_c$, $\\lambda_m^Q$, $\\lambda_m^{\\Gamma}$，小的正稳定项 $\\varepsilon_Q$, $\\varepsilon_{\\Gamma}$ 以避免相对误差归一化中出现除以零的情况，以及正的归一化尺度 $S_Q$, $S_{\\Gamma}$ 以使惩罚项无量纲化。设单调性惩罚在有序样本对上进行评估。定义配对集合\n$$\n\\mathcal{P}_s^Q \\equiv \\left\\{(m,n) \\in \\{1,\\dots,N\\}^2 \\,\\big|\\, \\kappa_{s,m} > \\kappa_{s,n}\\right\\}, \\quad\n\\mathcal{P}_s^{\\Gamma} \\equiv \\left\\{(m,n) \\in \\{1,\\dots,N\\}^2 \\,\\big|\\, a_m > a_n\\right\\},\n$$\n以及应用于有限差分单调性违背的铰链函数 $h(x) \\equiv \\max\\{0,-x\\}$。复合损失必须是结合以下各项的单一闭式解析表达式：\n- 在 $n=1,\\dots,N$ 上，对 $Q_s$ 和 $\\Gamma_s$ 的按粒子种类加权的均方相对误差进行数据集平均求和。\n- 一项双极性惩罚项，对数据集中的平方差 $\\hat{\\Gamma}_{i,n} - \\hat{\\Gamma}_{e,n}$ 进行平均，并用 $S_{\\Gamma}^2$ 进行归一化。\n- $Q_s$ 和 $\\Gamma_s$ 的单调性惩罚项，分别对 $\\mathcal{P}_s^Q$ 上的带符号差异 $(\\hat{Q}_{s,m} - \\hat{Q}_{s,n})(\\kappa_{s,m} - \\kappa_{s,n})$ 和 $\\mathcal{P}_s^{\\Gamma}$ 上的带符号差异 $(\\hat{\\Gamma}_{s,m} - \\hat{\\Gamma}_{s,n})(a_m - a_n)$ 的铰链函数的平方进行平均，并分别用 $S_Q^2$ 和 $S_{\\Gamma}^2$ 进行归一化。\n\n推导满足上述要求的复合损失的显式表达式。将最终结果表示为关于 $N$, $\\alpha_Q^i$, $\\alpha_Q^e$, $\\alpha_{\\Gamma}^i$, $\\alpha_{\\Gamma}^e$, $\\lambda_c$, $\\lambda_m^Q$, $\\lambda_m^{\\Gamma}$, $\\varepsilon_Q$, $\\varepsilon_{\\Gamma}$, $S_Q$, $S_{\\Gamma}$，目标值 $Q_{s,n}$, $\\Gamma_{s,n}$，预测值 $\\hat{Q}_{s,n}$, $\\hat{\\Gamma}_{s,n}$，梯度 $\\kappa_{s,n}$, $a_n$，以及配对集合 $\\mathcal{P}_s^Q$, $\\mathcal{P}_s^{\\Gamma}$ 的单一闭式解析表达式。最终答案必须是单一的解析表达式，且不得包含任何单位。如果引入任何辅助函数，必须明确定义它们。\n\n不需要进行数值评估。最终答案必须是解析表达式。",
            "solution": "在进行求解之前，对问题陈述进行了严格验证。\n\n### 步骤 1：提取已知条件\n- **粒子种类**：$s \\in \\{i,e\\}$，分别代表离子（$i$）和电子（$e$）。\n- **训练数据**：$N$ 个样本，由 $n \\in \\{1, \\dots, N\\}$ 索引。\n- **输入变量**：\n    - 归一化的温度梯度：$\\kappa_{s,n} \\equiv -\\frac{a}{T_s}\\frac{dT_s}{dr}$。\n    - 归一化的密度梯度：$a_n \\equiv -\\frac{a}{n}\\frac{dn}{dr}$。\n- **目标变量**：\n    - 磁面平均的湍流热通量：$Q_{s,n}$。\n    - 磁面平均的湍流粒子通量：$\\Gamma_{s,n}$。\n- **ANN 预测值**：$\\hat{Q}_{s,n}$ 和 $\\hat{\\Gamma}_{s,n}$。\n- **目标要求**：\n    1.  **准确度**：通过湍流通量的相对误差评估。\n    2.  **约束惩罚**：\n        - 双极性：$\\Gamma_i \\approx \\Gamma_e$。\n        - 单调性：$Q_s$ 相对于 $\\kappa_s$ 非递减；$\\Gamma_s$ 相对于 $a$ 非递减。\n- **基本原理**：\n    - 稳态、准电中性源意味着 $\\Gamma_i \\approx \\Gamma_e$。\n    - 梯度驱动的输运意味着非负的输运系数 $\\chi_s, D_s \\ge 0$。\n- **参数和函数**：\n    - 相对误差的正权重：$\\alpha_Q^i, \\alpha_Q^e, \\alpha_{\\Gamma}^i, \\alpha_{\\Gamma}^e$。\n    - 正惩罚权重：$\\lambda_c, \\lambda_m^Q, \\lambda_m^{\\Gamma}$。\n    - 小的正稳定项：$\\varepsilon_Q, \\varepsilon_{\\Gamma}$。\n    - 正的归一化尺度：$S_Q, S_{\\Gamma}$。\n    - 单调性配对集合：\n        - $\\mathcal{P}_s^Q \\equiv \\left\\{(m,n) \\in \\{1,\\dots,N\\}^2 \\,\\big|\\, \\kappa_{s,m} > \\kappa_{s,n}\\right\\}$。\n        - $\\mathcal{P}_s^{\\Gamma} \\equiv \\left\\{(m,n) \\in \\{1,\\dots,N\\}^2 \\,\\big|\\, a_m > a_n\\right\\}$。\n    - 铰链函数：$h(x) \\equiv \\max\\{0,-x\\}$。\n- **损失函数组成部分**：\n    1.  **准确度项**：数据集平均的、按粒子种类加权的 $Q_s$ 和 $\\Gamma_s$ 的均方相对误差之和。\n    2.  **双极性惩罚项**：数据集中平方差 $(\\hat{\\Gamma}_{i,n} - \\hat{\\Gamma}_{e,n})$ 的平均值，并用 $S_{\\Gamma}^2$ 进行归一化。\n    3.  **单调性惩罚项**：在 $\\mathcal{P}_s^Q$ 上对带符号差异 $(\\hat{Q}_{s,m} - \\hat{Q}_{s,n})(\\kappa_{s,m} - \\kappa_{s,n})$ 的铰链函数的平方进行平均，并用 $S_Q^2$ 归一化；在 $\\mathcal{P}_s^{\\Gamma}$ 上对带符号差异 $(\\hat{\\Gamma}_{s,m} - \\hat{\\Gamma}_{s,n})(a_m - a_n)$ 的铰链函数的平方进行平均，并用 $S_{\\Gamma}^2$ 归一化。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题设置在等离子体湍流模拟的背景下，这是聚变能研究中一个合理且活跃的领域。所使用的概念——回旋动理学、湍流输运、使用 ANN 的代理建模、双极性以及梯度驱动的通量——都是该领域的标准和公认概念。损失函数的构建反映了理论指导的机器学习中常见的基于物理的约束。该问题在科学上是合理的。\n- **适定性**：该问题要求推导一个复合损失函数的单一解析表达式。损失函数的所有组成部分都得到了高度具体的描述，包括函数形式、所涉及的变量、平均方法和归一化因子。所提供的信息足以且内部一致地构建一个唯一的表达式。\n- **客观性**：问题以精确、正式和无偏见的技术语言陈述。它不包含主观主张或观点。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。它具有科学依据，是适定的，并且是客观的。没有可识别的缺陷或矛盾。将推导一个完整的解。\n\n### 复合损失函数的推导\n\n复合损失函数，记为 $\\mathcal{L}$，由三个部分的总和构成：一个准确度项 $\\mathcal{L}_{\\text{acc}}$，一个双极性惩罚项 $\\mathcal{L}_{\\text{amb}}$，和一个单调性惩罚项 $\\mathcal{L}_{\\text{mon}}$。我们将根据问题的规定来构建每个部分。\n\n**1. 准确度项 ($\\mathcal{L}_{\\text{acc}}$)**\n\n该项是“数据集平均的、按粒子种类加权的 $Q_s$ 和 $\\Gamma_s$ 的均方相对误差之和”。对于给定的粒子种类 $s$ 和通量 $F \\in \\{Q, \\Gamma\\}$，单个样本 $n$ 的相对平方误差被定义。例如，对于 $Q_{s,n}$，一个鲁棒的稳定化相对平方误差的公式是 $\\frac{(\\hat{Q}_{s,n} - Q_{s,n})^2}{Q_{s,n}^2 + \\varepsilon_Q}$。项 $\\varepsilon_Q$ 是一个小的正稳定项，以防止当真实通量 $Q_{s,n}$ 接近零时出现除以零的情况。如果 $\\varepsilon_Q$ 的单位是通量的平方，分母 $Q_{s,n}^2 + \\varepsilon_Q$ 确保了该项的定义良好且量纲一致。\n\n$Q_s$ 的均方相对误差是数据集上的平均值：$\\frac{1}{N} \\sum_{n=1}^{N} \\frac{(\\hat{Q}_{s,n} - Q_{s,n})^2}{Q_{s,n}^2 + \\varepsilon_Q}$。\n总准确度项结合了所有四种通量（$Q_i, Q_e, \\Gamma_i, \\Gamma_e$）的按粒子种类加权的均方误差。该和由系数 $\\alpha_Q^s$ 和 $\\alpha_{\\Gamma}^s$ 加权。\n\n其结构是按粒子种类加权的均方误差之和：\n$\\mathcal{L}_{\\text{acc}} = \\alpha_Q^i \\left(\\frac{1}{N}\\sum_{n=1}^{N}\\frac{(\\hat{Q}_{i,n} - Q_{i,n})^2}{Q_{i,n}^2 + \\varepsilon_Q}\\right) + \\alpha_Q^e \\left(\\frac{1}{N}\\sum_{n=1}^{N}\\frac{(\\hat{Q}_{e,n} - Q_{e,n})^2}{Q_{e,n}^2 + \\varepsilon_Q}\\right) + \\alpha_{\\Gamma}^i \\left(\\frac{1}{N}\\sum_{n=1}^{N}\\frac{(\\hat{\\Gamma}_{i,n} - \\Gamma_{i,n})^2}{\\Gamma_{i,n}^2 + \\varepsilon_{\\Gamma}}\\right) + \\alpha_{\\Gamma}^e \\left(\\frac{1}{N}\\sum_{n=1}^{N}\\frac{(\\hat{\\Gamma}_{e,n} - \\Gamma_{e,n})^2}{\\Gamma_{e,n}^2 + \\varepsilon_{\\Gamma}}\\right)$。\n\n这可以通过提取对 $n$ 的求和并使用索引 $s \\in \\{i,e\\}$ 来更紧凑地表示：\n$\\mathcal{L}_{\\text{acc}} = \\frac{1}{N} \\sum_{n=1}^{N} \\sum_{s \\in \\{i,e\\}} \\left( \\alpha_Q^s \\frac{(\\hat{Q}_{s,n} - Q_{s,n})^2}{Q_{s,n}^2 + \\varepsilon_Q} + \\alpha_{\\Gamma}^s \\frac{(\\hat{\\Gamma}_{s,n} - \\Gamma_{s,n})^2}{\\Gamma_{s,n}^2 + \\varepsilon_{\\Gamma}} \\right)$。\n\n**2. 双极性惩罚项 ($\\mathcal{L}_{\\text{amb}}$)**\n\n此项惩罚对双极性粒子输运 $\\Gamma_i \\approx \\Gamma_e$ 的违背。它被定义为预测的离子和电子粒子通量之差的平方 $(\\hat{\\Gamma}_{i,n} - \\hat{\\Gamma}_{e,n})^2$ 在数据集上的平均值，并用 $S_{\\Gamma}^2$ 进行归一化。此项由惩罚因子 $\\lambda_c$ 加权。\n\n在数据集上的平均值为 $\\frac{1}{N} \\sum_{n=1}^{N} (\\hat{\\Gamma}_{i,n} - \\hat{\\Gamma}_{e,n})^2$。\n应用权重和归一化后得到：\n$\\mathcal{L}_{\\text{amb}} = \\lambda_c \\frac{1}{N S_{\\Gamma}^2} \\sum_{n=1}^{N} (\\hat{\\Gamma}_{i,n} - \\hat{\\Gamma}_{e,n})^2$。\n\n**3. 单调性惩罚项 ($\\mathcal{L}_{\\text{mon}}$)**\n\n此项惩罚预测通量相对于其驱动梯度的非单调行为。惩罚应用于违规情况，这些违规情况通过铰链函数 $h(x) \\equiv \\max\\{0, -x\\}$ 来检测。仅当铰链函数的参数为负时，惩罚才非零。\n\n对于热通量 $Q_s$，相对于梯度 $\\kappa_s$ 的单调性意味着对于任何样本对 $(m,n)$，如果 $\\kappa_{s,m} > \\kappa_{s,n}$，我们应该有 $\\hat{Q}_{s,m} \\ge \\hat{Q}_{s,n}$。这等同于要求 $(\\hat{Q}_{s,m} - \\hat{Q}_{s,n}) \\ge 0$。由于对于 $\\mathcal{P}_s^Q$ 中的配对，$\\kappa_{s,m} - \\kappa_{s,n} > 0$，所以乘积 $v_{m,n}^Q = (\\hat{Q}_{s,m} - \\hat{Q}_{s,n})(\\kappa_{s,m} - \\kappa_{s,n})$ 应为非负。\n当 $v_{m,n}^Q  0$ 时发生违规。惩罚是该值的铰链函数的平方，即 $[h(v_{m,n}^Q)]^2$。\n\n$Q_s$ 的惩罚是在 $\\mathcal{P}_s^Q$ 中所有相关配对上对这些铰链函数平方值的平均，并用 $S_Q^2$ 进行归一化。热通量的总单调性惩罚 $\\mathcal{L}_{\\text{mon}}^Q$ 由 $\\lambda_m^Q$ 加权，并对两种粒子 $s \\in \\{i,e\\}$ 求和：\n$\\mathcal{L}_{\\text{mon}}^Q = \\lambda_m^Q \\sum_{s \\in \\{i,e\\}} \\left( \\frac{1}{|\\mathcal{P}_s^Q| S_Q^2} \\sum_{(m,n) \\in \\mathcal{P}_s^Q} \\left[ h\\left( (\\hat{Q}_{s,m} - \\hat{Q}_{s,n})(\\kappa_{s,m} - \\kappa_{s,n}) \\right) \\right]^2 \\right)$。\n其中 $|\\mathcal{P}_s^Q|$ 是集合 $\\mathcal{P}_s^Q$ 的基数。\n\n同样，对于粒子通量 $\\Gamma_s$，相对于梯度 $a_n$ 的单调性也受到惩罚。逻辑是相同的。$\\Gamma_s$ 的惩罚 $\\mathcal{L}_{\\text{mon}}^{\\Gamma}$ 由 $\\lambda_m^\\Gamma$ 加权，用 $S_\\Gamma^2$ 归一化，并对粒子种类求和：\n$\\mathcal{L}_{\\text{mon}}^{\\Gamma} = \\lambda_m^{\\Gamma} \\sum_{s \\in \\{i,e\\}} \\left( \\frac{1}{|\\mathcal{P}_s^{\\Gamma}| S_{\\Gamma}^2} \\sum_{(m,n) \\in \\mathcal{P}_s^{\\Gamma}} \\left[ h\\left( (\\hat{\\Gamma}_{s,m} - \\hat{\\Gamma}_{s,n})(a_m - a_n) \\right) \\right]^2 \\right)$。注意，由于 $a_n$ 对两种粒子是相同的，所以集合 $\\mathcal{P}_i^{\\Gamma}$ 和 $\\mathcal{P}_e^{\\Gamma}$ 是相同的。\n\n总单调性惩罚是这两部分之和：$\\mathcal{L}_{\\text{mon}} = \\mathcal{L}_{\\text{mon}}^Q + \\mathcal{L}_{\\text{mon}}^{\\Gamma}$。\n\n**4. 复合损失函数 ($\\mathcal{L}$)**\n\n最终的复合损失函数是准确度项和两个惩罚项之和：$\\mathcal{L} = \\mathcal{L}_{\\text{acc}} + \\mathcal{L}_{\\text{amb}} + \\mathcal{L}_{\\text{mon}}$。代入推导出的表达式，得到损失的单一闭式解析表达式。\n\n$\\mathcal{L} = \\frac{1}{N} \\sum_{n=1}^{N} \\sum_{s \\in \\{i,e\\}} \\left( \\alpha_Q^s \\frac{(\\hat{Q}_{s,n} - Q_{s,n})^2}{Q_{s,n}^2 + \\varepsilon_Q} + \\alpha_{\\Gamma}^s \\frac{(\\hat{\\Gamma}_{s,n} - \\Gamma_{s,n})^2}{\\Gamma_{s,n}^2 + \\varepsilon_{\\Gamma}} \\right)$\n$+ \\lambda_c \\frac{1}{N S_{\\Gamma}^2} \\sum_{n=1}^{N} (\\hat{\\Gamma}_{i,n} - \\hat{\\Gamma}_{e,n})^2$\n$+ \\lambda_m^Q \\sum_{s \\in \\{i,e\\}} \\frac{1}{|\\mathcal{P}_s^Q| S_Q^2} \\sum_{(m,n) \\in \\mathcal{P}_s^Q} \\left[ h\\left( (\\hat{Q}_{s,m} - \\hat{Q}_{s,n})(\\kappa_{s,m} - \\kappa_{s,n}) \\right) \\right]^2$\n$+ \\lambda_m^{\\Gamma} \\sum_{s \\in \\{i,e\\}} \\frac{1}{|\\mathcal{P}_s^{\\Gamma}| S_{\\Gamma}^2} \\sum_{(m,n) \\in \\mathcal{P}_s^{\\Gamma}} \\left[ h\\left( (\\hat{\\Gamma}_{s,m} - \\hat{\\Gamma}_{s,n})(a_m - a_n) \\right) \\right]^2$。\n\n此表达式满足问题陈述中设定的所有要求。铰链函数 $h(x)$ 定义为 $h(x) \\equiv \\max\\{0, -x\\}$。$\\alpha_Q^s$ 和 $\\alpha_{\\Gamma}^s$ 中的粒子种类索引 $s$ 在 $\\{i,e\\}$ 中取值，对应于参数 $\\alpha_Q^i, \\alpha_Q^e, \\alpha_{\\Gamma}^i, \\alpha_{\\Gamma}^e$。",
            "answer": "$$\n\\boxed{\n\\begin{aligned}\n\\mathcal{L}  = \\frac{1}{N} \\sum_{n=1}^{N} \\sum_{s \\in \\{i,e\\}} \\left( \\alpha_Q^s \\frac{(\\hat{Q}_{s,n} - Q_{s,n})^2}{Q_{s,n}^2 + \\varepsilon_Q} + \\alpha_{\\Gamma}^s \\frac{(\\hat{\\Gamma}_{s,n} - \\Gamma_{s,n})^2}{\\Gamma_{s,n}^2 + \\varepsilon_{\\Gamma}} \\right) \\\\\n \\quad + \\frac{\\lambda_c}{N S_{\\Gamma}^2} \\sum_{n=1}^{N} (\\hat{\\Gamma}_{i,n} - \\hat{\\Gamma}_{e,n})^2 \\\\\n \\quad + \\lambda_m^Q \\sum_{s \\in \\{i,e\\}} \\frac{1}{|\\mathcal{P}_s^Q| S_Q^2} \\sum_{(m,n) \\in \\mathcal{P}_s^Q} \\left[ \\max\\{0, -(\\hat{Q}_{s,m} - \\hat{Q}_{s,n})(\\kappa_{s,m} - \\kappa_{s,n})\\} \\right]^2 \\\\\n \\quad + \\lambda_m^{\\Gamma} \\sum_{s \\in \\{i,e\\}} \\frac{1}{|\\mathcal{P}_s^{\\Gamma}| S_{\\Gamma}^2} \\sum_{(m,n) \\in \\mathcal{P}_s^{\\Gamma}} \\left[ \\max\\{0, -(\\hat{\\Gamma}_{s,m} - \\hat{\\Gamma}_{s,n})(a_m - a_n)\\} \\right]^2\n\\end{aligned}\n}\n$$"
        },
        {
            "introduction": "当我们拥有一个经过训练和验证的模型后，就可以利用它进行科学探索。最后的这个练习探讨了如何使用一个不仅提供单一预测值，而且提供概率性预测的代理模型来分析等离子体对外部变化的响应。此练习  要求计算热通量的期望变化，展示了如何通过模型传递输入的不确定性，从而获得一个稳健的预测结果。",
            "id": "4194387",
            "problem": "一个聚变等离子体输运程序使用一个基于机器学习（ML）的代理模型来闭合离子热通量。该代理模型基于传导热通量的定义和回旋玻姆归一化提供了一个类似刚度的闭合。从传导离子热通量的定义 $Q_i = - n_i \\chi_i \\nabla T_i$ 开始，其中 $n_i$ 是离子密度，$\\chi_i$ 是离子热扩散系数，$T_i$ 是离子温度。在大环径比托卡马克近似下，使用径向坐标 $r$ 和大半径 $R$，归一化温度梯度定义为 $R/L_{T_i}$，其中 $L_{T_i}^{-1} = - \\frac{1}{T_i}\\frac{d T_i}{d r}$。归一化离子热通量为 $q \\equiv \\frac{Q_i}{n_i T_i c_s}$，其中 $c_s$ 是声速，定义为 $c_s = \\sqrt{\\frac{T_e}{m_i}}$，$T_e$ 是电子温度，$m_i$ 是离子质量。该代理模型返回一个预测的归一化扩散系数参数 $\\chi_0$，并强制执行一个阈值刚度闭合\n$$\nq = \\chi_0 \\left( \\frac{R}{L_{T_i}} - \\left(\\frac{R}{L_{T_i}}\\right)_{\\text{crit}} \\right)_+,\n$$\n其中 $(x)_+ \\equiv \\max(x,0)$ 且 $\\left(\\frac{R}{L_{T_i}}\\right)_{\\text{crit}}$ 是湍流起始的临界梯度。\n\n由于基于机器学习的代理模型是概率性的，其在运行情景中对基线归一化温度梯度 $X \\equiv \\frac{R}{L_{T_i}}$ 的预测分布被建模为高斯分布，$X \\sim \\mathcal{N}(\\mu, \\sigma^2)$，且独立于 $\\chi_0$。一个提议的加热变化使 $X$ 增加一个固定量 $\\Delta$，即 $X \\mapsto X + \\Delta$。使用上述刚度闭合和对 $X$ 的概率性预测，从第一性原理推导归一化热通量期望变化的解析表达式，\n$$\n\\mathbb{E}[\\Delta q] = \\mathbb{E}\\left[ \\chi_0 \\left( (X+\\Delta - c)_+ - (X - c)_+ \\right) \\right],\n$$\n其中 $c \\equiv \\left(\\frac{R}{L_{T_i}}\\right)_{\\text{crit}}$，然后针对以下情景进行数值计算：\n- $\\mu = 3.4$，\n- $\\sigma = 0.1$，\n- $c = 3.5$，\n- $\\Delta = 0.2$，\n- $\\chi_0 = 0.5$。\n\n将 $\\mathbb{E}[\\Delta q]$ 的最终答案表示为一个无量纲数，并将您的数值结果四舍五入到四位有效数字。在最后一步之前，不应进行任何中间数值的四舍五入。",
            "solution": "该问题陈述已经过验证，被认为是合理的。它在科学上基于聚变等离子体输运和湍流理论的原理，并提出了一个基于标准概率论的适定数学问题。所有必要的参数和定义都已提供。\n\n目标是推导归一化离子热通量期望变化 $\\mathbb{E}[\\Delta q]$ 的解析表达式，然后针对一个特定情景对其进行求值。期望变化的定义如下：\n$$\n\\mathbb{E}[\\Delta q] = \\mathbb{E}\\left[ \\chi_0 \\left( (X+\\Delta - c)_+ - (X - c)_+ \\right) \\right]\n$$\n其中 $X \\equiv R/L_{T_i}$ 是归一化温度梯度，被建模为一个高斯随机变量 $X \\sim \\mathcal{N}(\\mu, \\sigma^2)$。参数 $c \\equiv (R/L_{T_i})_{\\text{crit}}$ 是临界梯度，$\\Delta$ 是 $X$ 的一个固定增量，$\\chi_0$ 是归一化扩散系数参数，而 $(z)_+ \\equiv \\max(z,0)$ 是正部函数。\n\n问题陈述指出，代理模型对 $X$ 的预测独立于 $\\chi_0$。此外，对于数值计算，$\\chi_0$ 被给定为一个常数值。因此，我们可以将 $\\chi_0$ 从期望中提取出来：\n$$\n\\mathbb{E}[\\Delta q] = \\chi_0 \\mathbb{E}\\left[ (X+\\Delta - c)_+ - (X - c)_+ \\right]\n$$\n根据期望的线性性质，这变为：\n$$\n\\mathbb{E}[\\Delta q] = \\chi_0 \\left( \\mathbb{E}\\left[ (X+\\Delta - c)_+ \\right] - \\mathbb{E}\\left[ (X - c)_+ \\right] \\right)\n$$\n问题的核心是求形式为 $(Z-a)_+$ 的函数的期望，其中 $Z$ 是一个高斯随机变量 $Z \\sim \\mathcal{N}(\\mu_Z, \\sigma_Z^2)$。设 $f_Z(z)$ 为 $Z$ 的概率密度函数（PDF）：\n$$\nf_Z(z) = \\frac{1}{\\sigma_Z \\sqrt{2\\pi}} \\exp\\left(-\\frac{(z-\\mu_Z)^2}{2\\sigma_Z^2}\\right)\n$$\n期望 $\\mathbb{E}[(Z-a)_+]$ 通过以下积分计算：\n$$\n\\mathbb{E}[(Z-a)_+] = \\int_{-\\infty}^{\\infty} (z-a)_+ f_Z(z) dz = \\int_{a}^{\\infty} (z-a) f_Z(z) dz\n$$\n这是概率论中的一个标准结果。该积分的计算结果为：\n$$\n\\mathbb{E}[(Z-a)_+] = (\\mu_Z - a) \\Phi\\left(\\frac{\\mu_Z-a}{\\sigma_Z}\\right) + \\sigma_Z \\phi\\left(\\frac{\\mu_Z-a}{\\sigma_Z}\\right)\n$$\n其中 $\\phi(v) = \\frac{1}{\\sqrt{2\\pi}}\\exp(-v^2/2)$ 是标准正态分布的概率密度函数（PDF），而 $\\Phi(v) = \\int_{-\\infty}^{v} \\phi(t) dt$ 是其累积分布函数（CDF）。\n\n我们将此通用公式应用于我们 $\\mathbb{E}[\\Delta q]$ 表达式中的两项。\n对于第一项 $\\mathbb{E}\\left[ (X+\\Delta - c)_+ \\right] = \\mathbb{E}\\left[ (X - (c-\\Delta))_+ \\right]$，我们确定 $Z=X$，$\\mu_Z=\\mu$，$\\sigma_Z=\\sigma$ 和 $a=c-\\Delta$。其期望为：\n$$\n\\mathbb{E}\\left[ (X+\\Delta - c)_+ \\right] = (\\mu - (c-\\Delta)) \\Phi\\left(\\frac{\\mu-(c-\\Delta)}{\\sigma}\\right) + \\sigma \\phi\\left(\\frac{\\mu-(c-\\Delta)}{\\sigma}\\right)\n$$\n$$\n= (\\mu - c + \\Delta) \\Phi\\left(\\frac{\\mu-c+\\Delta}{\\sigma}\\right) + \\sigma \\phi\\left(\\frac{\\mu-c+\\Delta}{\\sigma}\\right)\n$$\n对于第二项 $\\mathbb{E}\\left[ (X - c)_+ \\right]$，我们确定 $Z=X$，$\\mu_Z=\\mu$，$\\sigma_Z=\\sigma$ 和 $a=c$。其期望为：\n$$\n\\mathbb{E}\\left[ (X - c)_+ \\right] = (\\mu - c) \\Phi\\left(\\frac{\\mu-c}{\\sigma}\\right) + \\sigma \\phi\\left(\\frac{\\mu-c}{\\sigma}\\right)\n$$\n将这些结合起来，得到 $\\mathbb{E}[\\Delta q]$ 的完整解析表达式：\n$$\n\\mathbb{E}[\\Delta q] = \\chi_0 \\left[ \\left( (\\mu-c+\\Delta) \\Phi\\left(\\frac{\\mu-c+\\Delta}{\\sigma}\\right) + \\sigma \\phi\\left(\\frac{\\mu-c+\\Delta}{\\sigma}\\right) \\right) - \\left( (\\mu-c) \\Phi\\left(\\frac{\\mu-c}{\\sigma}\\right) + \\sigma \\phi\\left(\\frac{\\mu-c}{\\sigma}\\right) \\right) \\right]\n$$\n现在，我们使用提供的数值来计算这个表达式：$\\mu=3.4$，$\\sigma=0.1$，$c=3.5$，$\\Delta=0.2$ 和 $\\chi_0=0.5$。\n\n首先，我们计算特殊函数 $\\Phi$ 和 $\\phi$ 的自变量：\n$$\n\\frac{\\mu-c+\\Delta}{\\sigma} = \\frac{3.4 - 3.5 + 0.2}{0.1} = \\frac{0.1}{0.1} = 1\n$$\n$$\n\\frac{\\mu-c}{\\sigma} = \\frac{3.4 - 3.5}{0.1} = \\frac{-0.1}{0.1} = -1\n$$\n我们将这些归一化自变量记为 $\\alpha_1 = 1$ 和 $\\alpha_2 = -1$。预因子为：\n$$\n\\mu-c+\\Delta = 0.1\n$$\n$$\n\\mu-c = -0.1\n$$\n将这些代入 $\\mathbb{E}[\\Delta q]$ 的表达式中：\n$$\n\\mathbb{E}[\\Delta q] = \\chi_0 \\left[ \\left( (0.1) \\Phi(1) + \\sigma \\phi(1) \\right) - \\left( (-0.1) \\Phi(-1) + \\sigma \\phi(-1) \\right) \\right]\n$$\n我们使用标准正态分布的性质：$\\phi(-z) = \\phi(z)$ 和 $\\Phi(-z) = 1 - \\Phi(z)$。\n$\\phi(-1) = \\phi(1)$，所以涉及 $\\sigma$ 的项为 $\\sigma \\phi(1) - \\sigma \\phi(-1) = 0$。表达式简化为：\n$$\n\\mathbb{E}[\\Delta q] = \\chi_0 \\left[ (0.1) \\Phi(1) - (-0.1) \\Phi(-1) \\right] = \\chi_0 \\left[ (0.1) (\\Phi(1) + \\Phi(-1)) \\right]\n$$\n现在，代入 $\\Phi(-1) = 1 - \\Phi(1)$：\n$$\n\\mathbb{E}[\\Delta q] = \\chi_0 \\left[ (0.1) (\\Phi(1) + 1 - \\Phi(1)) \\right] = \\chi_0 \\left[ (0.1) (1) \\right] = 0.1 \\chi_0\n$$\n出现这种简化是因为特定的数值参数满足条件 $2(\\mu-c)+\\Delta = 0$。\n\n最后，我们代入 $\\chi_0=0.5$ 的值：\n$$\n\\mathbb{E}[\\Delta q] = 0.1 \\times 0.5 = 0.05\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\n0.05000\n$$\n以要求的科学记数法格式 $a \\times 10^b$ 表示：\n$$\n5.000 \\times 10^{-2}\n$$",
            "answer": "$$\\boxed{5.000 \\times 10^{-2}}$$"
        }
    ]
}