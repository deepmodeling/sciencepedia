{
    "hands_on_practices": [
        {
            "introduction": "Before we can analyze any spectrum, we must first understand the space it lives in. This foundational exercise  connects the physical parameters of a simulation domain—its size and grid resolution—to the discrete set of wavenumbers that can be resolved. Mastering this connection between the physical setup and the Fourier representation is the first step toward correctly interpreting any spectral data from a periodic numerical simulation.",
            "id": "4180922",
            "problem": "Consider a three-dimensional, flux-tube style fusion plasma turbulence simulation domain with Cartesian coordinates $\\{x,y,z\\}$, where $x$ and $y$ are perpendicular to the magnetic field and $z$ is aligned with the magnetic field, so that the parallel wavenumber is $k_{\\parallel} \\equiv k_{z}$. The domain is triply periodic with periods $L_{x}$, $L_{y}$, and $L_{z}$, and the fields are sampled uniformly on grids of sizes $N_{x}$, $N_{y}$, and $N_{z}$ with spacings $\\Delta x$, $\\Delta y$, and $\\Delta z$, respectively, so that $L_{x} = N_{x}\\Delta x$, $L_{y} = N_{y}\\Delta y$, and $L_{z} = N_{z}\\Delta z$. Assume that $N_{x}$, $N_{y}$, and $N_{z}$ are even integers and that the spectral analysis uses a centered indexing convention consistent with the Discrete Fourier Transform, in which integer mode indices span $m_{x} \\in \\{-N_{x}/2,\\ldots,N_{x}/2-1\\}$, $m_{y} \\in \\{-N_{y}/2,\\ldots,N_{y}/2-1\\}$, and $m_{z} \\in \\{-N_{z}/2,\\ldots,N_{z}/2-1\\}$.\n\nStarting from the Fourier series representation of periodic functions on each domain and the quantization of wavenumbers enforced by periodic boundary conditions, and invoking the sampling constraint defined by the Nyquist-Shannon theorem to determine the resolvable discrete set for each direction, derive the compact analytic expression for the resolved wavenumber triplet $\\{k_{x},k_{y},k_{\\parallel}\\}$ as a parametric function of the integer indices and the grid/dimension parameters. Your answer must be expressed solely in terms of $m_{x}$, $m_{y}$, $m_{z}$, $N_{x}$, $N_{y}$, $N_{z}$, $\\Delta x$, $\\Delta y$, and $\\Delta z$, with no numerical substitution. Provide your final expression only, and do not include inequalities or equalities in your final answer.",
            "solution": "The problem requires the derivation of the analytic expression for the resolved wavenumber triplet $\\{k_{x}, k_{y}, k_{\\parallel}\\}$ in a triply periodic domain used for fusion plasma turbulence simulations. The derivation proceeds from the fundamental principles of Fourier series on periodic domains and the constraints imposed by discrete sampling.\n\nA function $f(x, y, z)$ defined on a rectangular domain with side lengths $L_x$, $L_y$, and $L_z$ that is periodic in all three directions can be represented by a three-dimensional Fourier series:\n$$\nf(x, y, z) = \\sum_{m_x, m_y, m_z \\in \\mathbb{Z}} \\hat{f}_{m_x, m_y, m_z} \\exp\\left(i (k_x x + k_y y + k_z z)\\right)\n$$\nwhere $\\hat{f}_{m_x, m_y, m_z}$ are the Fourier coefficients and $\\{k_x, k_y, k_z\\}$ are the components of the wavenumber vector $\\vec{k}$.\n\nThe periodicity conditions are:\n$f(x+L_x, y, z) = f(x, y, z)$\n$f(x, y+L_y, z) = f(x, y, z)$\n$f(x, y, z+L_z) = f(x, y, z)$\n\nApplying the first condition to the general term of the Fourier series yields:\n$$\n\\exp\\left(i (k_x (x+L_x) + k_y y + k_z z)\\right) = \\exp\\left(i (k_x x + k_y y + k_z z)\\right)\n$$\nThis simplifies to:\n$$\n\\exp\\left(i k_x L_x\\right) = 1\n$$\nThis equality holds if and only if the argument of the exponential is an integer multiple of $2\\pi$. Thus, we have the quantization condition for the wavenumber component $k_x$:\n$$\nk_x L_x = 2\\pi m_x\n$$\nwhere $m_x$ is an integer mode index ($m_x \\in \\mathbb{Z}$). This gives the expression for the allowed discrete values of $k_x$:\n$$\nk_x = \\frac{2\\pi m_x}{L_x}\n$$\nBy identical reasoning, the periodicity in the $y$ and $z$ directions leads to quantization of their respective wavenumber components:\n$$\nk_y = \\frac{2\\pi m_y}{L_y}\n$$\n$$\nk_z = \\frac{2\\pi m_z}{L_z}\n$$\nwhere $m_y$ and $m_z$ are also integer mode indices.\n\nThe problem states that the domain is discretized on a uniform grid with $N_x, N_y, N_z$ points and grid spacings $\\Delta x, \\Delta y, \\Delta z$. The total lengths of the domain are related to these grid parameters by:\n$L_x = N_x \\Delta x$\n$L_y = N_y \\Delta y$\n$L_z = N_z \\Delta z$\n\nSubstituting these expressions for the domain lengths into the wavenumber quantization formulas yields the wavenumbers in terms of the grid parameters:\n$$\nk_x = \\frac{2\\pi m_x}{N_x \\Delta x}\n$$\n$$\nk_y = \\frac{2\\pi m_y}{N_y \\Delta y}\n$$\n$$\nk_z = \\frac{2\\pi m_z}{N_z \\Delta z}\n$$\n\nThe problem also specifies that the parallel wavenumber is defined as $k_{\\parallel} \\equiv k_z$. Therefore:\n$$\nk_{\\parallel} = \\frac{2\\pi m_z}{N_z \\Delta z}\n$$\n\nThe range of resolvable wavenumbers is determined by the grid spacing, as stated by the Nyquist-Shannon sampling theorem. For a grid spacing of $\\Delta x$, the highest resolvable wavenumber magnitude is the Nyquist wavenumber, $k_{Ny,x} = \\frac{\\pi}{\\Delta x}$. This implies that the represented wavenumbers must satisfy $|k_x| \\le k_{Ny,x}$. Let's verify this is consistent with the provided integer index range.\n$$\n|k_x| = \\left| \\frac{2\\pi m_x}{N_x \\Delta x} \\right| \\le \\frac{\\pi}{\\Delta x}\n$$\n$$\n\\frac{2\\pi |m_x|}{N_x \\Delta x} \\le \\frac{\\pi}{\\Delta x} \\implies |m_x| \\le \\frac{N_x}{2}\n$$\nThe problem specifies that the integer mode indices $m_x$ belong to the set $\\{-N_x/2, \\dots, N_x/2 - 1\\}$. This asymmetric range for an even number of points $N_x$ is a standard convention for Discrete Fourier Transforms (DFTs), where the basis functions for the modes $m_x = -N_x/2$ and $m_x = N_x/2$ are identical on the grid, so only one is kept to ensure a unique basis. The provided range spans all unique modes from the most negative (the Nyquist mode) up to, but not including, the positive Nyquist mode. The expressions for $k_x$, $k_y$, and $k_z$ as functions of the mode indices $m_x$, $m_y$, and $m_z$ are the fundamental relations derived from periodicity and are independent of the specific range chosen for the DFT indices.\n\nCombining the results, the resolved wavenumber triplet $\\{k_x, k_y, k_{\\parallel}\\}$ is given by:\n$$\n\\left\\{ \\frac{2\\pi m_x}{N_x \\Delta x}, \\frac{2\\pi m_y}{N_y \\Delta y}, \\frac{2\\pi m_z}{N_z \\Delta z} \\right\\}\n$$\nThis expression is solely in terms of the required parameters: the integer indices $\\{m_x, m_y, m_z\\}$ and the grid/dimension parameters $\\{N_x, N_y, N_z, \\Delta x, \\Delta y, \\Delta z\\}$.",
            "answer": "$$\n\\boxed{\\left( \\frac{2\\pi m_{x}}{N_{x} \\Delta x}, \\frac{2\\pi m_{y}}{N_{y} \\Delta y}, \\frac{2\\pi m_{z}}{N_{z} \\Delta z} \\right)}\n$$"
        },
        {
            "introduction": "Raw spectral data from multi-dimensional simulations often consists of energy distributed over a grid of wavenumber vectors, which can be difficult to interpret. A common and powerful simplification is to compute an isotropized one-dimensional spectrum, which reveals the energy content as a function of wavenumber magnitude, $k$. This hands-on coding exercise  guides you through the essential process of binning 2D spectral energy into 1D shells, with careful attention to the concept of mode degeneracy for proper normalization.",
            "id": "4180938",
            "problem": "You are given a two-dimensional periodic field sampled on a uniform rectangular grid and asked to construct the isotropized turbulent wavenumber spectrum by mapping discrete Fourier mode indices $(n_x,n_y)$ to circular shell bins in $k=\\sqrt{k_x^2+k_y^2}$ and properly accounting for degeneracy to normalize $E(k)$. Your derivation and algorithm must start from the fundamental definitions of the Discrete Fourier Transform (DFT) and Fast Fourier Transform (FFT), and from Parseval’s theorem for discrete transforms. All quantities in this problem are dimensionless and normalized; treat the domain lengths as $L_x=L_y=2\\pi$ so that the discrete wavenumber components satisfy $k_x \\in \\mathbb{Z}$ and $k_y \\in \\mathbb{Z}$. No physical units are to be used.\n\nFundamental base to use:\n- The two-dimensional Discrete Fourier Transform of a field $\\phi(x,y)$ sampled at $N_x \\times N_y$ points yields complex coefficients $\\hat{\\phi}(k_x,k_y)$ indexed by discrete wavenumbers $k_x$ and $k_y$ defined by the FFT frequency convention with periodic boundary conditions.\n- The modal spectral energy is defined as $|\\hat{\\phi}(k_x,k_y)|^2$.\n- An isotropized spectrum $E(k)$ averages the modal energy over all modes in a circular shell at fixed magnitude $k$, which requires counting the degeneracy $N_k$ (the number of $(k_x,k_y)$ pairs falling into the shell).\n\nYour tasks:\n1. Using the FFT frequency convention on a uniform grid with $L_x=L_y=2\\pi$, construct the wavenumber arrays $k_x$ and $k_y$ and compute the magnitude $k=\\sqrt{k_x^2+k_y^2}$ for each grid mode.\n2. Define circular shell bins centered at integer $k=m$ with width $\\Delta k=1$ by rounding $k$ to the nearest integer. Explicitly, assign each mode to bin index $m=\\mathrm{round}(k)$, which corresponds to shells $[m-\\tfrac{1}{2},m+\\tfrac{1}{2})$. Let $N_m$ be the integer degeneracy (the number of modes assigned to bin $m$).\n3. Compute two isotropized spectra:\n   - The shell-summed spectrum $E_{\\mathrm{sum}}(m)=\\sum_{(k_x,k_y)\\in \\text{bin }m} |\\hat{\\phi}(k_x,k_y)|^2$.\n   - The degeneracy-normalized spectrum $E_{\\mathrm{avg}}(m)=E_{\\mathrm{sum}}(m)/N_m$, defined for bins with $N_m>0$.\n4. Verify spectral consistency properties implied by the definitions and discrete Parseval’s theorem, using the same normalization on both sides so that sums of modal energies match their bin-aggregated sums.\n\nTest suite:\n- Case A (general mapping and conservation): $N_x=N_y=8$. Generate a random field $\\phi$ with independent standard normal samples. Compute $E_{\\mathrm{sum}}(m)$ and the total spectral energy $E_{\\mathrm{tot}}=\\sum_{k_x,k_y} |\\hat{\\phi}(k_x,k_y)|^2$. Return the relative error $r_1=\\left| \\sum_m E_{\\mathrm{sum}}(m) - E_{\\mathrm{tot}} \\right| / E_{\\mathrm{tot}}$ as a floating-point number.\n- Case B (single mode localization): $N_x=N_y=64$. Construct $\\phi(x,y)=\\cos(2x+3y)$ on the discrete grid. Compute $E_{\\mathrm{sum}}(m)$ and $E_{\\mathrm{tot}}$. Let $k_0=\\sqrt{2^2+3^2}$ and $m_0=\\mathrm{round}(k_0)$. Return the localization deviation $d_2=\\left|1 - E_{\\mathrm{sum}}(m_0)/E_{\\mathrm{tot}}\\right|$ as a floating-point number.\n- Case C (degeneracy count coverage): $N_x=16$, $N_y=8$. Generate a random field with an independent standard normal distribution. Compute the degeneracy counts $N_m$ for all bins. Return the boolean $b_3$ indicating whether $\\sum_m N_m = N_x N_y$.\n- Case D (edge case at zero wavenumber): $N_x=N_y=1$. Use a constant field $\\phi(x,y)=1$. Compute $E_{\\mathrm{avg}}(0)$ and return it as a floating-point number.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[r_1,d_2,b_3,E_{\\mathrm{avg}}(0)]$.\n\nImportant implementation details:\n- Use $L_x=L_y=2\\pi$ and grid coordinates sampled as $x_j=j\\Delta x$ and $y_\\ell=\\ell \\Delta y$ with $\\Delta x=L_x/N_x$ and $\\Delta y=L_y/N_y$, for $j=0,\\dots,N_x-1$ and $\\ell=0,\\dots,N_y-1$.\n- Compute FFT-based discrete wavenumbers via the Fast Fourier Transform (FFT) frequency convention, then set $k_x=2\\pi\\,\\mathrm{fftfreq}(N_x,\\Delta x)$ and $k_y=2\\pi\\,\\mathrm{fftfreq}(N_y,\\Delta y)$.\n- Each Fourier mode $(k_x,k_y)$ must be assigned to exactly one bin by rounding $k=\\sqrt{k_x^2+k_y^2}$ to the nearest integer $m$.\n- All computations are dimensionless; do not include any units.",
            "solution": "We derive the required mapping and normalization from first principles of the Discrete Fourier Transform (DFT) under periodic boundary conditions. Let the two-dimensional field be sampled on a grid with $N_x$ points along $x$ and $N_y$ points along $y$, over $L_x=L_y=2\\pi$. The sample spacings are $\\Delta x=L_x/N_x$ and $\\Delta y=L_y/N_y$, with grid points $x_j=j\\Delta x$ for $j=0,\\dots,N_x-1$ and $y_\\ell=\\ell\\Delta y$ for $\\ell=0,\\dots,N_y-1$.\n\nThe two-dimensional DFT (computed via the Fast Fourier Transform (FFT)) maps the field $\\phi(x_j,y_\\ell)$ to complex Fourier coefficients $\\hat{\\phi}(k_x,k_y)$ on a discrete wavenumber lattice defined by the FFT frequency convention. The discrete wavenumbers are constructed as\n$$\nk_x = 2\\pi\\,\\mathrm{fftfreq}(N_x,\\Delta x),\\qquad\nk_y = 2\\pi\\,\\mathrm{fftfreq}(N_y,\\Delta y),\n$$\nwhich, for $L_x=L_y=2\\pi$, yield integer-valued arrays because $2\\pi\\,\\mathrm{fftfreq}(N,L/N)=\\{0,1,2,\\dots,\\lfloor (N-1)/2\\rfloor,-\\lceil N/2\\rceil,\\dots,-1\\}$.\n\nThe spectral energy of a single Fourier mode is the squared modulus of its coefficient,\n$$\nE_{\\mathrm{mode}}(k_x,k_y) = |\\hat{\\phi}(k_x,k_y)|^2.\n$$\nTo form the isotropized spectrum $E(k)$, we must group modes by their magnitude\n$$\nk = \\sqrt{k_x^2+k_y^2}.\n$$\nWe define shell bins centered at integer wavenumbers $m\\in\\{0,1,2,\\dots\\}$ with width $\\Delta k=1$ by the rule\n$$\n\\text{mode }(k_x,k_y)\\text{ is in bin }m\\quad\\Longleftrightarrow\\quad m=\\mathrm{round}(k),\n$$\nwhich corresponds to rings $k\\in[m-\\tfrac{1}{2},m+\\tfrac{1}{2})$. The degeneracy $N_m$ is the count of $(k_x,k_y)$ pairs assigned to bin $m$.\n\nTwo natural isotropized spectra follow from this mapping:\n- The shell-summed spectrum\n$$\nE_{\\mathrm{sum}}(m) = \\sum_{\\{(k_x,k_y):\\ \\mathrm{round}(\\sqrt{k_x^2+k_y^2})=m\\}} |\\hat{\\phi}(k_x,k_y)|^2,\n$$\nwhich is the total modal energy in bin $m$.\n- The degeneracy-normalized spectrum\n$$\nE_{\\mathrm{avg}}(m) = \\frac{E_{\\mathrm{sum}}(m)}{N_m},\\qquad \\text{for }N_m>0,\n$$\nwhich is the average energy per Fourier mode in bin $m$.\n\nConsistency and normalization are justified by discrete Parseval’s theorem (under a fixed transform normalization convention). When the same transform convention is used for all sums, the total spectral energy satisfies\n$$\nE_{\\mathrm{tot}} = \\sum_{k_x,k_y} |\\hat{\\phi}(k_x,k_y)|^2 = \\sum_m E_{\\mathrm{sum}}(m).\n$$\nMoreover,\n$$\n\\sum_m N_m E_{\\mathrm{avg}}(m) = \\sum_m E_{\\mathrm{sum}}(m) = E_{\\mathrm{tot}}.\n$$\nThus, assigning each mode to exactly one shell by rounding and summing over all shells recovers the full spectral energy.\n\nAlgorithmic design:\n1. Construct the spatial grids $x_j$ and $y_\\ell$ and the wavenumber arrays $k_x$ and $k_y$ as above.\n2. Compute $\\hat{\\phi}(k_x,k_y)$ via $\\mathrm{FFT2}$ of the real-space field.\n3. Form the magnitude array $k=\\sqrt{k_x^2+k_y^2}$ on the Fourier lattice by meshing $k_x$ and $k_y$ with a Cartesian product grid.\n4. Map each mode to a bin index $m=\\mathrm{round}(k)$; this uniquely assigns each mode to one shell.\n5. Accumulate $E_{\\mathrm{sum}}(m)$ with a single pass using weighted bin counting with weights $|\\hat{\\phi}(k_x,k_y)|^2$, and accumulate degeneracies $N_m$ using unweighted bin counting. Compute $E_{\\mathrm{avg}}(m)$ by dividing $E_{\\mathrm{sum}}(m)$ by $N_m$ where $N_m>0$.\n6. Verify:\n   - Case A: compute $r_1=\\left| \\sum_m E_{\\mathrm{sum}}(m) - \\sum_{k_x,k_y}|\\hat{\\phi}|^2 \\right| / \\sum_{k_x,k_y}|\\hat{\\phi}|^2$, which should be numerically near $0$.\n   - Case B: for $\\phi(x,y)=\\cos(2x+3y)$, the nonzero Fourier coefficients are located at $(k_x,k_y)=(2,3)$ and $(-2,-3)$. Their magnitudes share the same $k_0=\\sqrt{2^2+3^2}$, thus $E_{\\mathrm{sum}}(m_0)$ with $m_0=\\mathrm{round}(k_0)$ captures essentially all spectral energy, and $d_2=\\left|1-E_{\\mathrm{sum}}(m_0)/E_{\\mathrm{tot}}\\right|$ is near $0$.\n   - Case C: each mode is assigned to exactly one bin, so $\\sum_m N_m=N_xN_y$ evaluates to true.\n   - Case D: for $N_x=N_y=1$ and $\\phi=1$, all energy is at $k=0$ with $N_0=1$, so $E_{\\mathrm{avg}}(0)=|\\hat{\\phi}(0,0)|^2$.\n\nComputational notes:\n- Using $L_x=L_y=2\\pi$ yields integer wavenumber grids that make rounding to integer bins natural and unambiguous.\n- All computations are dimensionless and rely solely on the FFT normalization chosen; since both sides of each identity use the same convention, relative comparisons are meaningful without additional scaling.\n\nThe program implements the above steps for the test suite and prints a single line containing $[r_1,d_2,b_3,E_{\\mathrm{avg}}(0)]$.",
            "answer": "```python\nimport numpy as np\n\ndef fft_wavenumbers(nx: int, ny: int, lx: float = 2*np.pi, ly: float = 2*np.pi):\n    dx = lx / nx\n    dy = ly / ny\n    kx = 2*np.pi * np.fft.fftfreq(nx, d=dx)  # integer-valued when lx=2*pi\n    ky = 2*np.pi * np.fft.fftfreq(ny, d=dy)\n    return kx, ky\n\ndef isotropic_spectrum(phi: np.ndarray, lx: float = 2*np.pi, ly: float = 2*np.pi):\n    nx, ny = phi.shape\n    # FFT of the field\n    phihat = np.fft.fft2(phi)\n    modal_energy = np.abs(phihat)**2\n\n    # Wavenumber grids\n    kx, ky = fft_wavenumbers(nx, ny, lx, ly)\n    KX, KY = np.meshgrid(kx, ky, indexing='ij')\n    kmag = np.sqrt(KX**2 + KY**2)\n\n    # Bin indices by rounding kmag to nearest integer\n    bin_indices = np.rint(kmag).astype(np.int64)\n\n    # Determine maximum bin index to size arrays\n    max_bin = int(bin_indices.max())\n\n    # Flatten for bincount accumulation\n    bin_flat = bin_indices.ravel()\n    energy_flat = modal_energy.ravel()\n\n    # Accumulate shell-summed energy and degeneracy counts\n    Esum = np.bincount(bin_flat, weights=energy_flat, minlength=max_bin + 1)\n    degeneracy = np.bincount(bin_flat, minlength=max_bin + 1)\n\n    # Degeneracy-normalized average energy per mode\n    Eavg = np.zeros_like(Esum)\n    nonzero = degeneracy > 0\n    Eavg[nonzero] = Esum[nonzero] / degeneracy[nonzero]\n\n    # Total spectral energy (under the same FFT normalization)\n    Etot = energy_flat.sum()\n\n    return Esum, Eavg, degeneracy, Etot\n\ndef case_A():\n    # Nx=Ny=8 random field\n    nx = ny = 8\n    rng = np.random.default_rng(42)\n    phi = rng.standard_normal((nx, ny))\n    Esum, Eavg, degeneracy, Etot = isotropic_spectrum(phi)\n    rel_err = abs(Esum.sum() - Etot) / Etot if Etot != 0 else 0.0\n    return rel_err\n\ndef case_B():\n    # Nx=Ny=64 plane wave phi(x,y)=cos(2x+3y)\n    nx = ny = 64\n    lx = ly = 2*np.pi\n    x = (np.arange(nx) * (lx / nx)).reshape(-1, 1)\n    y = (np.arange(ny) * (ly / ny)).reshape(1, -1)\n    phi = np.cos(2.0 * x + 3.0 * y)\n    Esum, Eavg, degeneracy, Etot = isotropic_spectrum(phi, lx, ly)\n    k0 = np.sqrt(2**2 + 3**2)\n    m0 = int(np.rint(k0))\n    # Guard in case bins shorter than m0 due to grid, though for Nx=64 it will exist\n    if m0 >= Esum.shape[0]:\n        deviation = 1.0\n    else:\n        fraction = Esum[m0] / Etot if Etot != 0 else 0.0\n        deviation = abs(1.0 - fraction)\n    return deviation\n\ndef case_C():\n    # Nx=16, Ny=8 random field; check degeneracy coverage\n    nx, ny = 16, 8\n    rng = np.random.default_rng(7)\n    phi = rng.standard_normal((nx, ny))\n    Esum, Eavg, degeneracy, Etot = isotropic_spectrum(phi)\n    total_modes = nx * ny\n    b3 = (int(degeneracy.sum()) == total_modes)\n    return b3\n\ndef case_D():\n    # Nx=Ny=1 constant field phi=1; return Eavg[0]\n    nx = ny = 1\n    phi = np.ones((nx, ny))\n    Esum, Eavg, degeneracy, Etot = isotropic_spectrum(phi)\n    # Eavg[0] should be |phihat(0,0)|^2 = 1 for Nx=Ny=1\n    e0 = float(Eavg[0]) if Eavg.shape[0] > 0 else 0.0\n    return e0\n\ndef solve():\n    results = []\n    results.append(case_A())\n    results.append(case_B())\n    results.append(case_C())\n    results.append(case_D())\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "The energy spectrum $E(k)$ provides a static snapshot of turbulence, but the essence of turbulence lies in the dynamic transfer of energy between different scales. This advanced practice  moves beyond $E(k)$ to the cumulative energy flux, $\\Pi(k)$, a crucial diagnostic for determining the direction of the energy cascade. By constructing and analyzing a synthetic energy transfer function, you will gain direct insight into the fundamental mechanisms that shape turbulent spectra, such as forward and inverse cascades.",
            "id": "4180917",
            "problem": "You are given the task of constructing and analyzing the cumulative scale-to-scale energy flux in wavenumber space for a two-dimensional turbulent field representative of fusion plasma turbulence. The analysis must be expressed in terms of the spectral energy transfer function. Assume a two-dimensional Fourier space with integer wavenumber coordinates $(p_x,p_y)$ on a square grid. Let the energy transfer function be denoted $T(\\boldsymbol{p})$, where $\\boldsymbol{p} = (p_x,p_y)$ and $|\\boldsymbol{p}| = \\sqrt{p_x^2 + p_y^2}$. You must construct synthetic, isotropic transfer fields $T(\\boldsymbol{p})$ that are consistent with conservation of energy in spectral space and compute the cumulative energy flux across wavenumber thresholds.\n\nFundamental base:\n- The nonlinear term in the dynamical equations governing turbulent flows conserves total quadratic invariants such as energy in the absence of forcing and dissipation. In spectral space this yields the property that the total energy transfer sums to zero: $$\\sum_{\\boldsymbol{p}} T(\\boldsymbol{p}) = 0.$$\n- The cumulative flux across a wavenumber threshold $k$ is defined as the net energy transferred into all modes with wavenumbers larger than $k$: $$\\Pi(k) = \\sum_{|\\boldsymbol{p}|>k} T(\\boldsymbol{p}).$$\n- The sign of $\\Pi(k)$ indicates the cascade direction: if $\\Pi(k) > 0$ over an interval of $k$, energy is transferred from lower wavenumbers to higher wavenumbers (forward cascade); if $\\Pi(k) < 0$, energy is transferred from higher wavenumbers to lower wavenumbers (inverse cascade).\n\nYour tasks, for each test case below, are:\n- Construct a synthetic, isotropic transfer field $T(\\boldsymbol{p})$ on a square grid of size $N \\times N$ with $p_x, p_y \\in \\{-M, -M+1, \\dots, M-1, M\\}$ where $M = (N-1)/2$, using a smooth radial profile that changes sign across a characteristic radius $r_0$. Enforce spectral energy conservation by adjusting the field so that $\\sum_{\\boldsymbol{p}} T(\\boldsymbol{p}) = 0$.\n- Compute the cumulative flux $\\Pi(k)$ for each specified cutoff $k$ using the definition above.\n- Determine the cascade direction at each $k$ by the sign of $\\Pi(k)$: return a boolean that is $true$ if $\\Pi(k) > 0$ (forward cascade) and $false$ otherwise (inverse or no net cascade).\n- Express all numerical outputs as dimensionless floats or booleans. Round floats to $6$ decimal places. No physical units are required for this synthetic analysis.\n\nUse the following test suite. Each test case provides $(N, r_0, w, A, \\{k\\})$, where $N$ is the grid size, $r_0$ is the characteristic radius, $w$ is a smoothness width, $A$ is an amplitude scaling, and $\\{k\\}$ is the list of cutoff radii to evaluate:\n- Test case $1$ (happy path, forward cascade): $(N, r_0, w, A, \\{k\\}) = (33, 6, 2, 1, \\{4,8,12,16,30\\})$. Construct $T(\\boldsymbol{p})$ using a smooth increasing radial function that is negative for $|\\boldsymbol{p}| < r_0$ and positive for $|\\boldsymbol{p}| > r_0$, then enforce $\\sum_{\\boldsymbol{p}} T(\\boldsymbol{p}) = 0$ by subtracting its mean over the grid.\n- Test case $2$ (edge case, inverse cascade): $(N, r_0, w, A, \\{k\\}) = (33, 6, 2, 1, \\{4,8,12,16,30\\})$. Use the same construction as test case $1$, but reverse the sign of $T(\\boldsymbol{p})$ to swap the roles of large and small wavenumbers.\n- Test case $3$ (boundary case, no cascade): $(N, r_0, w, A, \\{k\\}) = (33, 6, 2, 0, \\{4,8,12,16,30\\})$. Set $A = 0$ to produce $T(\\boldsymbol{p}) \\equiv 0$ everywhere, so that $\\Pi(k)$ must be zero for all $k$.\n\nAlgorithmic requirements:\n- The construction of $T(\\boldsymbol{p})$ must be isotropic and smooth in $|\\boldsymbol{p}|$, for example using a hyperbolic tangent profile $f(|\\boldsymbol{p}|) = \\tanh\\left(\\dfrac{|\\boldsymbol{p}| - r_0}{w}\\right)$ scaled by $A$. After construction, enforce spectral energy conservation by subtracting the mean value of $T$ over all grid points so that $\\sum_{\\boldsymbol{p}} T(\\boldsymbol{p}) = 0$.\n- For each cutoff $k$ in the test suite, compute $\\Pi(k)$ according to the definition above by summing $T(\\boldsymbol{p})$ over all grid points with $|\\boldsymbol{p}| > k$.\n\nAnswer specification and output format:\n- For each test case, return a pair of lists: the first list contains the flux values $\\Pi(k)$ for all provided $k$, rounded to $6$ decimal places; the second list contains booleans indicating forward cascade ($\\Pi(k) > 0$) at each $k$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, aggregating the results of all provided test cases, with no spaces anywhere in the line. The output must therefore have the form $$\\left[ \\left[ \\left[ \\Pi_1(k_1), \\dots, \\Pi_1(k_m) \\right], \\left[ b_1, \\dots, b_m \\right] \\right], \\left[ \\left[ \\Pi_2(k_1), \\dots, \\Pi_2(k_m) \\right], \\left[ b_1, \\dots, b_m \\right] \\right], \\left[ \\left[ \\Pi_3(k_1), \\dots, \\Pi_3(k_m) \\right], \\left[ b_1, \\dots, b_m \\right] \\right] \\right],$$ where $m$ is the number of cutoffs in each case, and $b_j$ are booleans computed as $b_j = (\\Pi(k_j) > 0)$.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of fluid and plasma turbulence, is well-posed with a clear and complete set of instructions, and is stated in objective, formal language. A solution can be constructed following the specified algorithmic requirements.\n\nThe solution involves a numerical implementation of concepts from spectral analysis of turbulence. The core task is to construct a synthetic energy transfer function $T(\\boldsymbol{p})$ in a two-dimensional wavenumber space, enforce a physical conservation law, and then compute a diagnostic quantity, the cumulative energy flux $\\Pi(k)$, to analyze the direction of energy cascade.\n\n### Step 1: Wavenumber Grid Generation\nThe problem is set in a two-dimensional, discrete Fourier (wavenumber) space. The grid is a square of size $N \\times N$. The integer wavenumber coordinates $(p_x, p_y)$ are defined to be centered around zero. For a given grid size $N$, which is specified to be odd, we define $M = (N-1)/2$. The coordinates for both $p_x$ and $p_y$ then range over the integers from $-M$ to $M$: $p_x, p_y \\in \\{-M, -M+1, \\dots, M-1, M\\}$.\n\nFirst, we generate one-dimensional arrays representing the coordinate values for $p_x$ and $p_y$. Using these, we construct two $N \\times N$ matrices, one for the $p_x$ coordinates of each grid point and one for the $p_y$ coordinates. From these coordinate matrices, we compute the matrix of radial wavenumber magnitudes, $|\\boldsymbol{p}|$, for each point $\\boldsymbol{p} = (p_x, p_y)$ on the grid using the Euclidean norm:\n$$\n|\\boldsymbol{p}| = \\sqrt{p_x^2 + p_y^2}\n$$\nThis $|\\boldsymbol{p}|$ matrix is essential for constructing an isotropic field and for applying the wavenumber cutoffs.\n\n### Step 2: Construction of the Synthetic Energy Transfer Field $T(\\boldsymbol{p})$\nThe energy transfer function $T(\\boldsymbol{p})$ describes the net rate of energy transfer into (+) or out of (-) the mode with wavenumber $\\boldsymbol{p}$ due to nonlinear interactions. We are instructed to create a synthetic, isotropic field based on a smooth radial profile.\n\nThe chosen profile is a hyperbolic tangent function, which creates a smooth transition from a negative to a positive value across a characteristic radius $r_0$ with a transition width $w$:\n$$\nT_{raw}(\\boldsymbol{p}) = A \\cdot \\tanh\\left(\\frac{|\\boldsymbol{p}| - r_0}{w}\\right)\n$$\nHere, $A$ is an amplitude scaling factor. This function models a scenario where energy is systematically removed from modes with small wavenumbers ($|\\boldsymbol{p}| < r_0$) and deposited into modes with large wavenumbers ($|\\boldsymbol{p}| > r_0$).\n\nA fundamental property of the nonlinear terms in ideal, unforced, and undissipated turbulent systems is the conservation of total energy. In spectral space, this translates to the condition that the sum of the energy transfer over all modes must be zero:\n$$\n\\sum_{\\boldsymbol{p}} T(\\boldsymbol{p}) = 0\n$$\nOur synthetic field $T_{raw}(\\boldsymbol{p})$ does not generally satisfy this condition. To enforce it, we subtract the mean value of $T_{raw}$ from every point on the grid. Let the total number of grid points be $N_{grid} = N^2$. The mean is $\\bar{T}_{raw} = \\frac{1}{N_{grid}} \\sum_{\\boldsymbol{p}} T_{raw}(\\boldsymbol{p})$. The final, conserved transfer function is:\n$$\nT(\\boldsymbol{p}) = T_{raw}(\\boldsymbol{p}) - \\bar{T}_{raw}\n$$\nThis procedure guarantees that $\\sum_{\\boldsymbol{p}} T(\\boldsymbol{p}) = 0$.\n\n### Step 3: Computation of the Cumulative Energy Flux $\\Pi(k)$\nThe cumulative energy flux $\\Pi(k)$ quantifies the net energy transfer across a spherical shell of radius $k$ in wavenumber space. It is defined as the sum of all energy transfers into modes with wavenumbers larger than $k$:\n$$\n\\Pi(k) = \\sum_{|\\boldsymbol{p}| > k} T(\\boldsymbol{p})\n$$\nTo compute this for a given cutoff $k$, we identify all grid points $(p_x, p_y)$ for which the condition $|\\boldsymbol{p}| > k$ is met. We then sum the values of our conserved field $T(\\boldsymbol{p})$ at these specific grid points. This sum gives the value of $\\Pi(k)$.\n\n### Step 4: Determination of Cascade Direction\nThe sign of $\\Pi(k)$ indicates the dominant direction of the energy cascade across the scale $k$.\n- If $\\Pi(k) > 0$, there is a net flux of energy towards higher wavenumbers (smaller spatial scales). This is a **forward cascade**.\n- If $\\Pi(k) < 0$, there is a net flux of energy towards lower wavenumbers (larger spatial scales). This is an **inverse cascade**.\n- If $\\Pi(k) = 0$, there is no net flux across the scale $k$.\n\nFor each computed $\\Pi(k)$, we evaluate the boolean condition $\\Pi(k) > 0$ to determine if the cascade is forward.\n\n### Step 5: Test Case Implementation\nThe procedure is applied to each test case:\n- **Test Case 1 (Forward Cascade)**: With $A=1$, $r_0=6$, the initial field $T_{raw}(\\boldsymbol{p})$ is negative for $|\\boldsymbol{p}| < 6$ and positive for $|\\boldsymbol{p}| > 6$. This setup is designed to model a forward energy cascade, so we expect $\\Pi(k) > 0$ for the given $k$ values.\n- **Test Case 2 (Inverse Cascade)**: The parameters are identical to Case 1, but the problem requires reversing the sign of the final, conserved transfer function, i.e., $T_{case2}(\\boldsymbol{p}) = -T_{case1}(\\boldsymbol{p})$. This flips the sign of all transfers. Consequently, the cumulative flux will also be negated: $\\Pi_{case2}(k) = -\\Pi_{case1}(k)$. This models an inverse cascade, and we expect $\\Pi(k) < 0$.\n- **Test Case 3 (No Cascade)**: With $A=0$, the initial field $T_{raw}(\\boldsymbol{p})$ is identically zero for all $\\boldsymbol{p}$. The mean is zero, and the final field $T(\\boldsymbol{p})$ is also zero everywhere. Therefore, any sum over this field will be zero, resulting in $\\Pi(k) = 0$ for all $k$. This tests the baseline case of no energy transfer.\n\nThe final numerical results for $\\Pi(k)$ are rounded to six decimal places as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and analyzes the cumulative scale-to-scale energy flux in \n    wavenumber space for synthetic 2D turbulent fields.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # The parameters are (N, r_0, w, A, k_list).\n    test_case_data = [\n        (33, 6, 2, 1, [4, 8, 12, 16, 30]),  # Test Case 1\n        (33, 6, 2, 1, [4, 8, 12, 16, 30]),  # Test Case 2\n        (33, 6, 2, 0, [4, 8, 12, 16, 30]),  # Test Case 3\n    ]\n\n    all_results = []\n    # Process each test case using its index to apply special rules.\n    for i, case in enumerate(test_case_data):\n        N, r_0, w, A, k_list = case\n\n        # 1. Grid Generation\n        M = (N - 1) // 2\n        p_coords = np.arange(-M, M + 1)\n        p_x, p_y = np.meshgrid(p_coords, p_coords, indexing='xy')\n        p_mag = np.sqrt(p_x**2 + p_y**2)\n\n        # 2. Construct Initial Transfer Field\n        # For A=0 (Case 3), T_raw will correctly be an array of zeros.\n        T_raw = A * np.tanh((p_mag - r_0) / w)\n\n        # 3. Enforce Energy Conservation\n        mean_T = np.mean(T_raw)\n        T_conserved = T_raw - mean_T\n\n        # 4. Handle Case-Specific Logic from the problem description\n        T_final = T_conserved\n        if i == 1:  # Case 2: \"reverse the sign of T(p)\"\n            T_final = -T_conserved\n\n        # 5. Compute Cumulative Flux and Determine Cascade Direction\n        flux_values = []\n        cascade_directions = []\n        for k in k_list:\n            mask = p_mag > k\n            pi_k = np.sum(T_final[mask])\n            flux_values.append(pi_k)\n            cascade_directions.append(pi_k > 0)\n        \n        all_results.append([flux_values, cascade_directions])\n\n    # Final print statement in the exact required format.\n    # The string must be built without spaces, so standard list-to-string conversion\n    # is not suitable.\n    case_strings = []\n    for result_struct in all_results:\n        fluxes, bools = result_struct\n        \n        # Format list of floats to \"[-0.123456,1.234567,...]\"\n        fluxes_str = f\"[{','.join([f'{f:.6f}' for f in fluxes])}]\"\n        \n        # Format list of booleans to \"[false,true,...]\"\n        bools_str = f\"[{','.join([str(b).lower() for b in bools])}]\"\n        \n        # Combine into a single case result string \"[[...],[...]]\"\n        case_str = f\"[{fluxes_str},{bools_str}]\"\n        case_strings.append(case_str)\n        \n    final_output = f\"[{','.join(case_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}