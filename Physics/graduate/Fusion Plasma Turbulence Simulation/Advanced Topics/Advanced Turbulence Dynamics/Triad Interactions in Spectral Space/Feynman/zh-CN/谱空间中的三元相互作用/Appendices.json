{
    "hands_on_practices": [
        {
            "introduction": "这项实践将深入探讨谱空间模拟的核心。通过将傅里叶变换的卷积定理转化为一种计算算法，您将亲手构建一个工具来描绘出给定谱域内所有可能的三元组相互作用。这是理解和分析非线性能量传递的基础，掌握这一步对于理解湍流模拟代码的计算复杂性和底层结构至关重要。",
            "id": "4207745",
            "problem": "您的任务是设计并实现一个算法，用于枚举二维周期性域中与聚变等离子体湍流模拟中的非线性模式耦合相关的所有谱三元组。从场傅里叶表示和二次非线性项卷积性质的第一性原理和核心定义开始。使用这些原理来论证谱空间中的三元组条件，并设计一种计算策略及其复杂度分析。\n\n假设一个边长为 $2\\pi$ 的方形周期性域，因此傅里叶波矢是整数对 $k = (k_x, k_y)$，其中 $k_x \\in \\mathbb{Z}$ 且 $k_y \\in \\mathbb{Z}$。令 $k_{\\max} \\in \\mathbb{N}$ 定义最大波数截断。容许的非零模式集合定义为\n$$\n\\mathcal{S}(k_{\\max}) = \\left\\{ (k_x,k_y) \\in \\mathbb{Z}^2 \\setminus \\{(0,0)\\} \\;\\middle|\\; k_x^2 + k_y^2 \\le k_{\\max}^2 \\right\\}.\n$$\n在谱空间中，一个三元组是一个无序三元组 $\\{k,p,q\\} \\subset \\mathcal{S}(k_{\\max})$，它满足共振条件\n$$\nk = p + q,\n$$\n其中 $p$ 和 $q$ 是 $\\mathcal{S}(k_{\\max})$ 的元素，和是按分量计算的。三元组被认为是无序的：$(k,p,q)$ 的任何排列都代表同一个三元组。零模式 $(0,0)$ 从 $\\mathcal{S}(k_{\\max})$ 中排除，并且只要 $2p \\in \\mathcal{S}(k_{\\max})$，就允许 $p=q$ 的退化对。\n\n从傅里叶变换将实空间中的乘积映射到谱空间中的卷积这一基本事实出发，推导出三元组条件，然后设计一个满足以下条件的算法：\n- 构建 $\\mathcal{S}(k_{\\max})$。\n- 枚举所有唯一的无序三元组 $\\{k,p,q\\}$，满足 $k = p + q$ 且 $k,p,q \\in \\mathcal{S}(k_{\\max})$。\n- 避免在 $(k,p,q)$ 的排列下重复计数同一个三元组。\n\n根据容许模式的数量 $M = \\left|\\mathcal{S}(k_{\\max})\\right|$ 和参数 $k_{\\max}$ 分析您算法的计算复杂度，并为您的复杂度类别提供清晰的推理。用大$\\mathcal{O}$表示法表达您的复杂度分析，并证明任何假设，例如常数时间的集合成员资格检查。\n\n您的程序必须实现该算法，并针对一组给定的 $k_{\\max}$ 值测试套件，为每种情况计算：\n- 您的算法找到的唯一无序三元组数量 $T$。\n- 容许模式的数量 $M$。\n- 检查的无序模式对的数量 $P$，其中模式对包括 $p = q$ 并被视为无序，因此 $P = M(M+1)/2$。\n\n测试套件：\n- 情况 1：$k_{\\max} = 0$。\n- 情况 2：$k_{\\max} = 1$。\n- 情况 3：$k_{\\max} = 2$。\n- 情况 4：$k_{\\max} = 3$。\n- 情况 5：$k_{\\max} = 4$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含五个测试用例的结果，形式为逗号分隔的列表的列表，格式完全如下\n$$\n[[T_1,M_1,P_1],[T_2,M_2,P_2],[T_3,M_3,P_3],[T_4,M_4,P_4],[T_5,M_5,P_5]]\n$$\n本问题不需要物理单位或角度单位。所有计算输出必须是整数。程序必须是完全自包含的，并且不需要用户输入。",
            "solution": "此任务的动机是类流体等离子体模型的谱表示中二次非线性项的卷积结构。考虑一个定义在边长为 $2\\pi$ 的二维周期性正方形上的标量场 $\\phi(x,y,t)$。其傅里叶级数为\n$$\n\\phi(x,y,t) = \\sum_{k \\in \\mathbb{Z}^2} \\hat{\\phi}_k(t) \\, e^{i(k_x x + k_y y)}.\n$$\n对于具有二次非线性项的模型，例如二维不可压缩流中的平流非线性项或漂移波湍流中的泊松括号非线性项，典型的非线性项涉及实空间中场（或其导数）的乘积。根据卷积定理，乘积的傅里叶变换变成一个卷积。对于傅里叶系数为 $\\hat{\\phi}_k$ 和 $\\hat{\\psi}_k$ 的两个场 $\\phi$ 和 $\\psi$，它们乘积在模式 $k$ 处的傅里叶系数为\n$$\n\\widehat{(\\phi \\psi)}_k = \\sum_{p \\in \\mathbb{Z}^2} \\hat{\\phi}_p \\, \\hat{\\psi}_{k-p}.\n$$\n和是对所有整数波矢 $p$ 求和，而 $q = k - p$ 是另一个波矢。这表明在 $k$ 处的谱系数与满足 $p + q = k$ 的对 $(p,q)$ 耦合。在湍流系统中，非线性能量传递源于这些三元组相互作用。因此，三元组条件\n$$\nk = p + q\n$$\n是基础的，并且由三个参与的波矢 $\\{k,p,q\\}$ 组成的集合定义了一个三元组。\n\n我们将谱域限制在一个受数值模拟启发的有限集合上：我们只考虑满足 $k_x^2 + k_y^2 \\le k_{\\max}^2$ 的整数波矢 $(k_x,k_y)$，并排除零模式。这个集合是\n$$\n\\mathcal{S}(k_{\\max}) = \\left\\{ (k_x,k_y) \\in \\mathbb{Z}^2 \\setminus \\{(0,0)\\} \\;\\middle|\\; k_x^2 + k_y^2 \\le k_{\\max}^2 \\right\\}.\n$$\n容许模式的数量为 $M = \\left|\\mathcal{S}(k_{\\max})\\right|$。随着 $k_{\\max}$ 增大，$M$ 的尺度与半径为 $k_{\\max}$ 的圆盘内的整数格点数量相似，渐近满足\n$$\nM \\sim \\pi k_{\\max}^2 \\quad \\text{as } k_{\\max} \\to \\infty,\n$$\n除去边界效应。\n\n算法设计：\n1. 通过在 $-k_{\\max}$ 到 $k_{\\max}$ 范围内迭代整数 $k_x$ 和 $k_y$ 来构建 $\\mathcal{S}(k_{\\max})$，排除 $(0,0)$，并保留满足 $k_x^2 + k_y^2 \\le k_{\\max}^2$ 的那些。将该集合同时存储为用于有序迭代的列表和用于平均时间复杂度为 $O(1)$ 的成员资格查询的哈希集（例如，Python元组集合）。\n2. 从 $\\mathcal{S}(k_{\\max})$ 中枚举无序对 $(p,q)$，包括退化情况 $p = q$。对长度为 $M$ 的模式列表使用索引 $i$ 和 $j$，其中 $0 \\le i \\le j  M$。所考虑的无序对的总数是\n   $$\n   P = \\frac{M(M+1)}{2}.\n   $$\n3. 对于每对 $(p,q)$，按分量相加计算 $k = p + q$，并检查 $k \\in \\mathcal{S}(k_{\\max})$ 是否成立。如果成立，则三元组 $(k,p,q)$ 满足三元组条件。由于三元组是无序的，同一个三元组也可能由其他组合产生。为避免重复计数，通过在固定的字典序下对其三个向量进行排序来将三元组 $\\{k,p,q\\}$ 规范化，并将得到的有序三元组插入到一个三元组的哈希集中。这确保了每个无序三元组只被计数一次。\n4. 每个 $k_{\\max}$ 的输出是唯一三元组的数量 $T$、模式数量 $M$ 以及检查的配对数量 $P$。\n\n复杂度分析：\n- 构建 $\\mathcal{S}(k_{\\max})$ 需要检查方块区域 $[-k_{\\max},k_{\\max}]^2$ 内的所有整数对 $(k_x,k_y)$，该区域有 $(2k_{\\max}+1)^2$ 个点。构建集合的时间是 $O(k_{\\max}^2)$，这与 $M = O(k_{\\max}^2)$ 一致，空间复杂度为 $O(M)$。\n- 枚举所有无序对 $(p,q)$ 需要 $P = M(M+1)/2 = O(M^2)$ 次迭代。对于每一对，计算 $k = p + q$ 和在哈希集中检查成员资格的平均时间是 $O(1)$。对于哈希操作，规范化和插入到三元组集合中的平均时间是 $O(1)$（排序三个项目是 $O(1)$，因为它是常数大小）。\n- 因此，总时间复杂度为\n  $$\n  O(M^2),\n  $$\n  空间复杂度为\n  $$\n  O(M + T),\n  $$\n  其中 $T$ 是找到的唯一三元组的数量，且 $T \\le P$。\n- 就 $k_{\\max}$ 而言，使用 $M = \\Theta(k_{\\max}^2)$ 得到总时间复杂度为 $O(k_{\\max}^4)$。\n\n正确性论证：\n- 谱空间中的卷积性质要求，到模式 $k$ 的非线性耦合来自于满足 $p + q = k$ 的对 $(p,q)$。在 $\\mathcal{S}(k_{\\max})$ 上枚举所有这样的对并收集无序三元组，可以确保所有与共振条件一致的三元组都被找到。\n- 排除 $(0,0)$ 避免了通过零模式的平凡耦合，这与典型的模拟实践一致。允许 $p = q$ 确保了包含 $k = 2p$ 的有效退化三元组。\n- 通过排序进行规范化消除了 $(k,p,q)$ 之间的排列模糊性，从而产生了一个明确定义的无序三元组计数。\n\n测试套件和输出：\n- 对于 $k_{\\max} \\in \\{0,1,2,3,4\\}$，程序构建 $\\mathcal{S}(k_{\\max})$，枚举三元组，并打印单行\n  $$\n  [[T_1,M_1,P_1],[T_2,M_2,P_2],[T_3,M_3,P_3],[T_4,M_4,P_4],[T_5,M_5,P_5]],\n  $$\n  其中 $T_i$ 是三元组计数，$M_i$ 是模式计数，$P_i = M_i(M_i+1)/2$ 是情况 $i$ 的配对计数。所有值都是整数。\n\n这种方法在科学上是现实的，在算法上基于基本的卷积性质，能够产生一个高效的枚举，与聚变等离子体湍流模拟（如漂移波和回旋流体模型）中使用的谱非线性的典型结构一致。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef generate_modes(kmax: int):\n    \"\"\"\n    Generate the set of integer 2D wavevectors (kx, ky) with 0  kx^2 + ky^2 = kmax^2.\n    Returns both a list (for ordered iteration) and a set (for O(1) membership).\n    \"\"\"\n    modes_list = []\n    r2_max = kmax * kmax\n    # Iterate over square box [-kmax, kmax]^2\n    for kx in range(-kmax, kmax + 1):\n        for ky in range(-kmax, kmax + 1):\n            if kx == 0 and ky == 0:\n                continue  # exclude zero mode\n            r2 = kx * kx + ky * ky\n            if r2 = r2_max:\n                modes_list.append((kx, ky))\n    modes_set = set(modes_list)\n    return modes_list, modes_set\n\ndef enumerate_triads(kmax: int):\n    \"\"\"\n    Enumerate all unique unordered triads {k, p, q} such that k = p + q,\n    with k, p, q in the admissible set S(kmax).\n    Returns:\n      T: number of unique triads\n      M: number of admissible modes\n      P: number of unordered pairs checked (= M*(M+1)//2)\n    \"\"\"\n    modes_list, modes_set = generate_modes(kmax)\n    M = len(modes_list)\n    # Number of unordered pairs including p = q\n    P = M * (M + 1) // 2\n\n    triads_set = set()  # store canonical triads as sorted tuples of 2D tuples\n\n    # Iterate over unordered pairs (i = j)\n    for i in range(M):\n        p = modes_list[i]\n        for j in range(i, M):\n            q = modes_list[j]\n            k = (p[0] + q[0], p[1] + q[1])\n            if k in modes_set:\n                # Canonicalize unordered triad by sorting lexicographically\n                triad = tuple(sorted((k, p, q)))\n                triads_set.add(triad)\n\n    T = len(triads_set)\n    return T, M, P\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [0, 1, 2, 3, 4]\n\n    results = []\n    for kmax in test_cases:\n        T, M, P = enumerate_triads(kmax)\n        results.append([T, M, P])\n\n    # Final print statement in the exact required format.\n    # A single line, comma-separated lists enclosed in square brackets.\n    print(f\"[{','.join(str(r).replace(' ', '') for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "在识别出所有可能的三元组之后，下一步是理解它们的动力学行为。本练习聚焦于模拟一个孤立的三波系统，这是描述共振相互作用的基本模型。您将实现一个能够保持系统几何结构的积分方法，以验证关键物理不变量的守恒性，这是开发稳健且物理精确的长时间模拟程序的关键技能。",
            "id": "4207771",
            "problem": "考虑谱空间中的三波相互作用，将其作为代表聚变等离子体湍流中共振相互作用的漂移波模式的三个复傅里叶振幅之间的二次非线性耦合的简化模型。设复振幅为 $a_1(t)$、$a_2(t)$ 和 $a_3(t)$，实耦合系数为 $\\kappa \\in \\mathbb{R}$。其控制常微分方程 (ODE) 如下：\n$$\n\\frac{d a_1}{dt} = i\\,\\kappa\\, a_2^*(t)\\, a_3^*(t), \\quad\n\\frac{d a_2}{dt} = i\\,\\kappa\\, a_1^*(t)\\, a_3^*(t), \\quad\n\\frac{d a_3}{dt} = i\\,\\kappa\\, a_1^*(t)\\, a_2^*(t),\n$$\n其中 $i$ 是虚数单位，${}^*$ 表示复共轭。该系统拥有被称为 Manley–Rowe 不变量的二次不变量，定义为：\n$$\nI_{12}(t) = |a_1(t)|^2 - |a_2(t)|^2, \\quad I_{13}(t) = |a_1(t)|^2 - |a_3(t)|^2,\n$$\n以及一个哈密顿能量：\n$$\nH(t) = \\kappa\\left(a_1(t)\\,a_2(t)\\,a_3(t) + a_1^*(t)\\,a_2^*(t)\\,a_3^*(t)\\right).\n$$\n对于精确积分，$I_{12}(t)$、$I_{13}(t)$ 和 $H(t)$ 是不随时间变化的常数。\n\n你需要实现一个离散时间步进格式，其设计目标是在长时间积分中守恒这些不变量。使用在三波之间共享平均值的隐式中点法，定义如下：\n$$\na_j^{n+1} - a_j^n = i\\,\\kappa\\,\\Delta t\\,(a_m^{\\mathrm{avg}})^*(a_n^{\\mathrm{avg}})^*, \\quad j \\in \\{1,2,3\\},\n$$\n其中对于每个时间步 $n \\to n+1$，\n$$\na_j^{\\mathrm{avg}} = \\frac{1}{2}\\left(a_j^{n+1} + a_j^{n}\\right),\n$$\n且 $\\{j,m,n\\} = \\{1,2,3\\}$ 循环置换，因此 $a_1$ 的更新使用 $a_2^{\\mathrm{avg}}$ 和 $a_3^{\\mathrm{avg}}$，对 $a_2$ 和 $a_3$ 的更新也类似。此格式是隐式的，必须在每个时间步求解 $\\left(a_1^{n+1}, a_2^{n+1}, a_3^{n+1}\\right)$，例如，在时间步长 $\\Delta t$ 足够小的情况下使用不动点迭代法。\n\n从以上定义和关于哈密顿系统中二次不变量的经过充分检验的事实出发，从第一性原理推导这些不变量，并证明中点法格式下的守恒性。然后，实现该格式，并通过追踪在整个积分时间内 $I_{12}$、$I_{13}$ 和 $H$ 相对于其初始值的最大绝对漂移，使用构造的三波解来数值验证守恒性。\n\n你的程序必须为每个测试用例执行以下操作：\n- 使用均匀时间步长 $\\Delta t$ 和上述隐式中点法，从 $t=0$ 积分到 $t=T$。\n- 在每一步计算 $I_{12}(t)$、$I_{13}(t)$ 和 $H(t)$，并追踪相对于它们在 $t=0$ 时初始值的最大绝对漂移：\n$$\nD_{12} = \\max_{0 \\le n \\le N} \\left|I_{12}^n - I_{12}^0\\right|,\\quad\nD_{13} = \\max_{0 \\le n \\le N} \\left|I_{13}^n - I_{13}^0\\right|,\\quad\nD_H = \\max_{0 \\le n \\le N} \\left|H^n - H^0\\right|,\n$$\n其中 $N = T/\\Delta t$ 是时间步数。\n- 对于给定的容差 $\\varepsilon_I$ 和 $\\varepsilon_H$，如果 $D_{12} \\le \\varepsilon_I$，$D_{13} \\le \\varepsilon_I$ 且 $D_H \\le \\varepsilon_H$，则声明不变量在数值上是守恒的。\n\n使用以下测试套件，其选择旨在覆盖一般情况、刚性情况以及涉及振幅消失的边界情况：\n1. 情况 A（一般情况，长时间）：$\\kappa = 1.0$, $a_1(0) = 1 + 0.2i$, $a_2(0) = 0.8 - 0.4i$, $a_3(0) = -0.6 + 0.3i$, $T = 200$, $\\Delta t = 0.01$, $\\varepsilon_I = 10^{-8}$, $\\varepsilon_H = 5\\times 10^{-3}$。\n2. 情况 B（刚性耦合）：$\\kappa = 10.0$, $a_1(0) = 0.1 + 0.0i$, $a_2(0) = 0.2 + 0.0i$, $a_3(0) = 0.3 + 0.0i$, $T = 2.0$, $\\Delta t = 10^{-3}$, $\\varepsilon_I = 10^{-8}$, $\\varepsilon_H = 5\\times 10^{-3}$。\n3. 情况 C（振幅为零的边界情况）：$\\kappa = 1.0$, $a_1(0) = 1.0 + 0.0i$, $a_2(0) = 1.0 + 0.0i$, $a_3(0) = 0.0 + 0.0i$, $T = 50$, $\\Delta t = 0.01$, $\\varepsilon_I = 10^{-8}$, $\\varepsilon_H = 5\\times 10^{-3}$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中每个测试用例对应一个布尔值，表示是否所有不变量都在指定的容差范围内守恒，顺序为 [情况 A, 情况 B, 情况 C]。例如：“[True,False,True]”。",
            "solution": "在尝试解答之前，对问题进行验证。\n\n### 第 1 步：提取已知条件\n三个复振幅 $a_1(t)$、$a_2(t)$ 和 $a_3(t)$ 的控制常微分方程 (ODE) 如下：\n$$\n\\frac{d a_1}{dt} = i\\,\\kappa\\, a_2^*(t)\\, a_3^*(t)\n$$\n$$\n\\frac{d a_2}{dt} = i\\,\\kappa\\, a_1^*(t)\\, a_3^*(t)\n$$\n$$\n\\frac{d a_3}{dt} = i\\,\\kappa\\, a_1^*(t)\\, a_2^*(t)\n$$\n其中 $\\kappa \\in \\mathbb{R}$ 是实耦合系数，$i$ 是虚数单位，${}^*$ 表示复共轭。\n\n连续系统的守恒量（不变量）是 Manley–Rowe 不变量：\n$$\nI_{12}(t) = |a_1(t)|^2 - |a_2(t)|^2\n$$\n$$\nI_{13}(t) = |a_1(t)|^2 - |a_3(t)|^2\n$$\n和哈密顿能量：\n$$\nH(t) = \\kappa\\left(a_1(t)\\,a_2(t)\\,a_3(t) + a_1^*(t)\\,a_2^*(t)\\,a_3^*(t)\\right)\n$$\n要使用的数值积分格式是隐式中点法，其从时间步 $n$ 到 $n+1$ 的更新规则定义为：\n$$\na_j^{n+1} - a_j^n = i\\,\\kappa\\,\\Delta t\\,\\left({a_m^{\\mathrm{avg}}}\\right)^*\\,\\left({a_n^{\\mathrm{avg}}}\\right)^*\n$$\n对于下标 $\\{j,m,n\\} = \\{1,2,3\\}$ 的循环置换。时间平均振幅定义为：\n$$\na_j^{\\mathrm{avg}} = \\frac{1}{2}\\left(a_j^{n+1} + a_j^{n}\\right)\n$$\n问题要求使用不动点迭代法求解这个隐式系统。\n\n任务是数值验证这些不变量的守恒性，通过追踪在积分时间 $T$ 内的最大绝对漂移：\n$$\nD_{12} = \\max_{0 \\le n \\le N} \\left|I_{12}^n - I_{12}^0\\right|\n$$\n$$\nD_{13} = \\max_{0 \\le n \\le N} \\left|I_{13}^n - I_{13}^0\\right|\n$$\n$$\nD_H = \\max_{0 \\le n \\le N} \\left|H^n - H^0\\right|\n$$\n其中 $N=T/\\Delta t$。如果 $D_{12} \\le \\varepsilon_I$，$D_{13} \\le \\varepsilon_I$ 且 $D_H \\le \\varepsilon_H$，则声明为数值守恒。\n\n测试用例：\n1.  情况 A：$\\kappa=1.0$, $a(0) = [1+0.2i, 0.8-0.4i, -0.6+0.3i]$, $T=200$, $\\Delta t=0.01$, $\\varepsilon_I=10^{-8}$, $\\varepsilon_H=5\\times 10^{-3}$。\n2.  情况 B：$\\kappa=10.0$, $a(0) = [0.1, 0.2, 0.3]$, $T=2.0$, $\\Delta t=10^{-3}$, $\\varepsilon_I=10^{-8}$, $\\varepsilon_H=5\\times 10^{-3}$。\n3.  情况 C：$\\kappa=1.0$, $a(0) = [1.0, 1.0, 0.0]$, $T=50$, $\\Delta t=0.01$, $\\varepsilon_I=10^{-8}$, $\\varepsilon_H=5\\times 10^{-3}$。\n\n### 第 2 步：使用提取的已知条件进行验证\n基于验证标准对问题进行评估。\n- **科学性**：问题描述了三波相互作用模型，这是等离子体物理、非线性光学和流体动力学中的一个基本概念。控制方程是共振三波相互作用的标准表示。Manley-Rowe 关系和哈密顿量守恒的概念是该领域的核心。使用像隐式中点法这样的几何积分子来保持这些不变量是计算科学中一个成熟的课题。该问题在科学上是合理的。\n- **适定性**：问题提供了一套完整的 ODE、每个测试用例的初始条件以及一个完全指定的数值方法。任务定义明确：实现该格式并根据给定的容差检查指定量的守恒性。对于给定的初值问题，存在唯一解，并且数值任务是无歧义的。\n- **客观性**：问题以精确的数学和计算术语陈述。所有参数都已量化，成功标准（在容差范围内守恒）也已客观定义。没有主观或含糊不清的陈述。\n\n问题没有任何指定的无效性缺陷。它是自洽的、一致的，并构成一个有效的科学和计算挑战。\n\n### 第 3 步：结论与行动\n问题有效。将提供一个合理的解答。\n\n### 基于原理的解答\n\n问题要求分析一个描述共振三波相互作用的系统的守恒性质，包括连续时间动力学和一个特定的离散时间数值格式。\n\n**1. 连续系统中的守恒性**\n\n首先，我们证明 $I_{12}$、$I_{13}$ 和 $H$ 确实是连续系统的不变量。\n\n**Manley–Rowe 不变量 ($I_{12}, I_{13}$):**\n振幅 $a_j$ 模方的变化率由 $\\frac{d|a_j|^2}{dt} = \\frac{d(a_j a_j^*)}{dt} = \\frac{da_j}{dt}a_j^* + a_j\\frac{da_j^*}{dt}$ 给出。对控制 ODE 取复共轭可得 $\\frac{da_j^*}{dt} = -i\\,\\kappa\\, a_m(t)\\, a_n(t)$。\n\n对于 $a_1$，我们有：\n$$\n\\frac{d|a_1|^2}{dt} = (i\\kappa a_2^* a_3^*) a_1^* + a_1 (-i\\kappa a_2 a_3) = i\\kappa(a_1^* a_2^* a_3^* - a_1 a_2 a_3) = -2\\kappa \\mathrm{Im}(a_1 a_2 a_3)\n$$\n由于控制方程的对称结构，完全相同的计算也适用于 $a_2$ 和 $a_3$：\n$$\n\\frac{d|a_2|^2}{dt} = (i\\kappa a_1^* a_3^*) a_2^* + a_2 (-i\\kappa a_1 a_3) = i\\kappa(a_1^* a_2^* a_3^* - a_1 a_2 a_3) = -2\\kappa \\mathrm{Im}(a_1 a_2 a_3)\n$$\n$$\n\\frac{d|a_3|^2}{dt} = (i\\kappa a_1^* a_2^*) a_3^* + a_3 (-i\\kappa a_1 a_2) = i\\kappa(a_1^* a_2^* a_3^* - a_1 a_2 a_3) = -2\\kappa \\mathrm{Im}(a_1 a_2 a_3)\n$$\n由于 $\\frac{d|a_1|^2}{dt} = \\frac{d|a_2|^2}{dt} = \\frac{d|a_3|^2}{dt}$，直接可以得出这些量的差值不随时间变化：\n$$\n\\frac{dI_{12}}{dt} = \\frac{d}{dt}(|a_1|^2 - |a_2|^2) = \\frac{d|a_1|^2}{dt} - \\frac{d|a_2|^2}{dt} = 0\n$$\n$$\n\\frac{dI_{13}}{dt} = \\frac{d}{dt}(|a_1|^2 - |a_3|^2) = \\frac{d|a_1|^2}{dt} - \\frac{d|a_3|^2}{dt} = 0\n$$\n这证实了 $I_{12}$ 和 $I_{13}$ 是守恒量。\n\n**哈密顿量 ($H$):**\n设 $S(t) = a_1(t)a_2(t)a_3(t)$。哈密顿量为 $H(t) = \\kappa(S(t) + S^*(t))$。其时间导数为 $\\frac{dH}{dt} = \\kappa(\\frac{dS}{dt} + \\frac{dS^*}{dt})$。我们计算 $\\frac{dS}{dt}$：\n$$\n\\frac{dS}{dt} = \\frac{da_1}{dt}a_2a_3 + a_1\\frac{da_2}{dt}a_3 + a_1a_2\\frac{da_3}{dt}\n$$\n代入控制 ODE：\n$$\n\\frac{dS}{dt} = (i\\kappa a_2^*a_3^*)a_2a_3 + a_1(i\\kappa a_1^*a_3^*)a_3 + a_1a_2(i\\kappa a_1^*a_2^*) = i\\kappa\\left(|a_2|^2|a_3|^2+|a_1|^2|a_3|^2+|a_1|^2|a_2|^2\\right)\n$$\n括号中的项是纯实数。取复共轭可得 $\\frac{dS^*}{dt} = -i\\kappa\\left(|a_2|^2|a_3|^2+|a_1|^2|a_3|^2+|a_1|^2|a_2|^2\\right)$。\n因此，哈密顿量的导数为：\n$$\n\\frac{dH}{dt} = \\kappa\\left(\\frac{dS}{dt} + \\frac{dS^*}{dt}\\right) = \\kappa \\left( i\\kappa(\\dots) - i\\kappa(\\dots) \\right) = 0\n$$\n这证实了哈密顿量 H 也是连续系统的一个守恒量。\n\n**2. 离散格式中的守恒性**\n\n隐式中点法是一种几何积分子，以其能保持底层连续系统的某些几何性质而闻名。我们现在证明它能精确守恒二次 Manley-Rowe 不变量。\n\n**Manley–Rowe 不变量 ($I_{12}, I_{13}$):**\n从步 $n$到 $n+1$，$a_1$ 模方的变化可以写为：\n$$\n|a_1^{n+1}|^2 - |a_1^n|^2 = \\mathrm{Re}\\left( (a_1^{n+1}-a_1^n)(a_1^{n+1}+a_1^n)^* \\right)\n$$\n使用中点法的定义，$a_1^{n+1}-a_1^n = i\\kappa\\Delta t (a_2^{\\mathrm{avg}})^*(a_3^{\\mathrm{avg}})^*$ 和 $a_1^{n+1}+a_1^n = 2a_1^{\\mathrm{avg}}$。代入可得：\n$$\n|a_1^{n+1}|^2 - |a_1^n|^2 = \\mathrm{Re}\\left( \\left(i\\kappa\\Delta t (a_2^{\\mathrm{avg}})^*(a_3^{\\mathrm{avg}})^*\\right) \\left(2(a_1^{\\mathrm{avg}})^*\\right) \\right) = 2\\kappa\\Delta t \\mathrm{Re}\\left( i (a_1^{\\mathrm{avg}}a_2^{\\mathrm{avg}}a_3^{\\mathrm{avg}})^* \\right)\n$$\n因为 $\\mathrm{Re}(iz) = -\\mathrm{Im}(z)$，我们有：\n$$\n|a_1^{n+1}|^2 - |a_1^n|^2 = -2\\kappa\\Delta t \\mathrm{Im}\\left( (a_1^{\\mathrm{avg}}a_2^{\\mathrm{avg}}a_3^{\\mathrm{avg}})^* \\right)\n$$\n由于更新规则和下标的循环对称性，$|a_2^{n+1}|^2 - |a_2^n|^2$ 的计算是相同的，会得到相同的表达式。因此：\n$$\n|a_1^{n+1}|^2 - |a_1^n|^2 = |a_2^{n+1}|^2 - |a_2^n|^2 = |a_3^{n+1}|^2 - |a_3^n|^2\n$$\n这意味着 $I_{12}$ 在一个时间步内的变化为零：\n$$\nI_{12}^{n+1} - I_{12}^n = (|a_1^{n+1}|^2 - |a_2^{n+1}|^2) - (|a_1^n|^2 - |a_2^n|^2) = (|a_1^{n+1}|^2 - |a_1^n|^2) - (|a_2^{n+1}|^2 - |a_2^n|^2) = 0\n$$\n同样的论证也适用于 $I_{13}$。因此，隐式中点法能够精确守恒二次不变量 $I_{12}$ 和 $I_{13}$，误差仅在浮点精度范围内。这就解释了为何容差 $\\varepsilon_I = 10^{-8}$ 非常严格。\n\n**哈密顿量 ($H$):**\n哈密顿量 H 是振幅的三次函数。关于几何积分子的一般定理指出，中点法能精确守恒一个系统的所有二次不变量。然而，它通常不能精确守恒非二次不变量。作为一个用于哈密顿系统的对称、类辛的积分方法，它被期望对 H 表现出优异的长期守恒特性，这意味着 H 的数值误差将保持有界且很小，围绕真实值振荡而没有长期漂移。问题陈述通过提供一个宽松得多的容差 $\\varepsilon_H = 5 \\times 10^{-3}$，间接承认了这一点。对于给定的参数，一个表现良好的格式应该满足这个容差。\n\n**3. 实现算法**\n\n实现的核心是在每个时间步求解关于 $a_j^{\\text{avg}}$ 的隐式系统。更新规则可以重写为关于 $a_j^{\\text{avg}}$ 的不动点问题：\n$$\na_j^{\\mathrm{avg}} = a_j^n + \\frac{i\\kappa\\Delta t}{2} (a_m^{\\mathrm{avg}})^* (a_n^{\\mathrm{avg}})^*\n$$\n这个系统通过迭代求解。\n1.  初始化中点值的猜测值：$a_j^{\\mathrm{avg},(0)} = a_j^n$。\n2.  对 $k=0, 1, 2, \\dots$ 进行迭代：\n    $$\n    a_j^{\\mathrm{avg},(k+1)} = a_j^n + \\frac{i\\kappa\\Delta t}{2} (a_m^{\\mathrm{avg},(k)})^* (a_n^{\\mathrm{avg},(k)})^*\n    $$\n    对于足够小的 $\\Delta t$，该迭代会快速收敛。固定次数的迭代（例如10次）就足够了。\n3.  一旦找到收敛的 $a_j^{\\text{avg}}$，计算下一个时间步的状态：$a_j^{n+1} = 2 a_j^{\\text{avg}} - a_j^n$。\n4.  在每一步，计算不变量 $I_{12}^n, I_{13}^n, H^n$ 并更新最大漂移 $D_{12}, D_{13}, D_H$。\n5.  在最后一个时间步之后，将最大漂移与容差 $\\varepsilon_I$ 和 $\\varepsilon_H$ 进行比较，以确定不变量是否守恒。\n对指定的三个测试用例中的每一个重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the triad interaction simulation for all test cases\n    and determine if the invariants are conserved.\n    \"\"\"\n    test_cases = [\n        # Case A (general, long time)\n        {'kappa': 1.0, 'a0': [1 + 0.2j, 0.8 - 0.4j, -0.6 + 0.3j], 'T': 200, 'dt': 0.01,\n         'eps_I': 1e-8, 'eps_H': 5e-3},\n        # Case B (stiff coupling)\n        {'kappa': 10.0, 'a0': [0.1 + 0.0j, 0.2 + 0.0j, 0.3 + 0.0j], 'T': 2.0, 'dt': 1e-3,\n         'eps_I': 1e-8, 'eps_H': 5e-3},\n        # Case C (edge with zero amplitude)\n        {'kappa': 1.0, 'a0': [1.0 + 0.0j, 1.0 + 0.0j, 0.0 + 0.0j], 'T': 50, 'dt': 0.01,\n         'eps_I': 1e-8, 'eps_H': 5e-3},\n    ]\n\n    results = []\n    for case in test_cases:\n        conserved = run_simulation(**case)\n        results.append(conserved)\n\n    print(f\"[{','.join(str(b) for b in results)}]\")\n\ndef run_simulation(kappa, a0, T, dt, eps_I, eps_H):\n    \"\"\"\n    Performs the time-stepping simulation for a single test case.\n\n    Args:\n        kappa (float): Real coupling coefficient.\n        a0 (list of complex): Initial complex amplitudes [a1(0), a2(0), a3(0)].\n        T (float): Total integration time.\n        dt (float): Time step size.\n        eps_I (float): Tolerance for Manley-Rowe invariants.\n        eps_H (float): Tolerance for Hamiltonian energy.\n\n    Returns:\n        bool: True if all invariants are conserved within tolerances, False otherwise.\n    \"\"\"\n    a_current = np.array(a0, dtype=np.complex128)\n    num_steps = int(round(T / dt))\n\n    # Calculate initial invariants\n    I12_0 = abs(a_current[0])**2 - abs(a_current[1])**2\n    I13_0 = abs(a_current[0])**2 - abs(a_current[2])**2\n    S0 = a_current[0] * a_current[1] * a_current[2]\n    H_0 = kappa * (S0 + np.conj(S0)).real\n\n    # Initialize maximum drifts\n    max_D12 = 0.0\n    max_D13 = 0.0\n    max_DH = 0.0\n\n    # Fixed-point iteration parameters\n    FP_ITERATIONS = 10\n\n    # Time-stepping loop\n    for _ in range(num_steps):\n        a_n = a_current\n\n        # --- Solve for a_avg using fixed-point iteration ---\n        # Initial guess for a_avg is a_n\n        a_avg = a_n.copy()\n        \n        # Using a Jacobi-style iteration\n        for _ in range(FP_ITERATIONS):\n            a_avg_old = a_avg.copy()\n            # Update equations for a_avg based on the implicit midpoint rule\n            a_avg[0] = a_n[0] + 0.5j * kappa * dt * np.conj(a_avg_old[1]) * np.conj(a_avg_old[2])\n            a_avg[1] = a_n[1] + 0.5j * kappa * dt * np.conj(a_avg_old[0]) * np.conj(a_avg_old[2])\n            a_avg[2] = a_n[2] + 0.5j * kappa * dt * np.conj(a_avg_old[0]) * np.conj(a_avg_old[1])\n\n        # --- Update to next time step ---\n        # a_n+1 = 2 * a_avg - a_n\n        a_current = 2.0 * a_avg - a_n\n\n        # --- Calculate invariants and update drifts ---\n        I12_n = abs(a_current[0])**2 - abs(a_current[1])**2\n        I13_n = abs(a_current[0])**2 - abs(a_current[2])**2\n        S_n = a_current[0] * a_current[1] * a_current[2]\n        H_n = kappa * (S_n + np.conj(S_n)).real\n\n        max_D12 = max(max_D12, abs(I12_n - I12_0))\n        max_D13 = max(max_D13, abs(I13_n - I13_0))\n        max_DH = max(max_DH, abs(H_n - H_0))\n    \n    # Check if all drifts are within their respective tolerances\n    is_conserved = (max_D12 = eps_I) and (max_D13 = eps_I) and (max_DH = eps_H)\n    return is_conserved\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "真实的湍流包含一个由大量相互作用的三元组构成的复杂网络。这项实践采用一个简化的壳层模型，以弥合单个三元组动力学与完整湍流系统统计行为之间的鸿沟。通过将系统初始化在热力学平衡态并测量能量通量，您将从数值上验证统计力学的一个关键预测：在最大熵状态下，系统不存在持续的能量级串。",
            "id": "4207738",
            "problem": "考虑一个在谱空间中截断的保守二次非线性系统，其动力学由三波相互作用控制。作为聚变等离子体湍流中类漂移波三波相互作用的一个替代模型，采用 Sabra 壳层模型。这是一个谱局域三波系统，定义在波数为 $k_n = k_0 \\lambda^n$ 的壳层上，其中壳层指数 $n \\in \\{0,1,\\dots,N-1\\}$ 为整数，几何因子 $\\lambda  1$，基波数 $k_0  0$。设复壳层振幅为 $u_n(t) \\in \\mathbb{C}$。其无粘截断动力学方程为\n$$\n\\frac{d u_n}{d t} = i \\left( a\\, k_{n+1}\\, u_{n+1}\\, u_{n+2}^\\ast \\;+\\; b\\, k_n\\, u_{n-1}\\, u_{n+1}^\\ast \\;+\\; c\\, k_{n-1}\\, u_{n-1}\\, u_{n-2} \\right),\n$$\n约定任何引用超出范围的壳层指数的项都设置为零，其中 $a$、$b$、$c \\in \\mathbb{R}$ 为常系数。总能量为\n$$\nE(t) = \\frac{1}{2} \\sum_{n=0}^{N-1} |u_n(t)|^2,\n$$\n当且仅当 $a + b + c = 0$ 时，总能量守恒。进入壳层 $n$ 的瞬时非线性能量输运为\n$$\nT_n(t) = \\operatorname{Re}\\left[ u_n^\\ast(t)\\, \\mathcal{N}_n(t) \\right],\n$$\n其中 $\\mathcal{N}_n(t)$ 表示演化方程中非线性项的右端。跨越壳层截断 $m$ 的累积能量通量定义为\n$$\n\\Pi_m(t) = -\\sum_{n=0}^{m} T_n(t),\n$$\n它衡量了从指数 $n \\le m$ 的壳层到指数 $n  m$ 的壳层的净非线性输运。一个在绝对平衡态附近初始化的系统，其初始振幅从与二次不变量 $E$ 相关联的正则吉布斯分布中抽样，即\n$$\nP(\\{u_n\\}) \\propto \\exp\\left( -\\beta \\sum_{n=0}^{N-1} \\frac{|u_n|^2}{2} \\right),\n$$\n因此 $u_n(0)$ 是独立的复高斯随机变量，其均值为零，方差为 $\\sigma^2 = 1/\\beta$。\n\n您的任务是设计并实现一个使用无量纲单位的数值测试，该测试将系统初始化在绝对平衡态附近，并验证测得的三波输运在零附近波动，没有持续的通量。具体来说：\n\n- 实现上述三波形式的无粘截断 Sabra 壳层模型。使用固定步长的显式积分器。通过固定随机种子来确保可复现性。\n- 对每个测试案例，将 $u_n(0)$ 初始化为独立的复高斯随机变量，均值为零，方差为 $\\sigma^2$，即 $u_n(0) \\sim \\mathcal{N}(0,\\sigma^2/2) + i\\,\\mathcal{N}(0,\\sigma^2/2)$，这实现了参数为 $\\beta = 1/\\sigma^2$ 的正则分布。\n- 演化系统并计算惯性区内两个截断 $m$ 的时间序列 $\\Pi_m(t)$：$m_1 = \\lfloor N/3 \\rfloor$ 和 $m_2 = \\lfloor 2N/3 \\rfloor$。\n- 对每个截断，计算整个模拟过程中的时间平均值 $\\overline{\\Pi}_m$ 和标准差 $S_m$。将“无持续通量”条件定义为 $|\\overline{\\Pi}_m| \\le \\epsilon + \\rho\\, S_m$，其中 $\\epsilon$ 是一个小的绝对容差，$\\rho$ 是一个小的相对容差因子。如果 $m_1$ 和 $m_2$ 都满足此条件，则该测试案例通过。\n\n使用以下无量纲参数值的测试套件：\n\n- 案例1 (标准情况)：$N = 12$，$\\lambda = 1.618$，$k_0 = 1$，$(a,b,c) = (1, -\\tfrac{1}{2}, -\\tfrac{1}{2})$，$\\sigma = 1$，时间步长 $\\Delta t = 10^{-3}$，步数 $4000$，容差 $\\epsilon = 10^{-6}$，$\\rho = 0.05$。\n- 案例2 (边界壳层数)：$N = 6$，$\\lambda = 1.5$，$k_0 = 1$，$(a,b,c) = (1, -\\tfrac{1}{2}, -\\tfrac{1}{2})$，$\\sigma = 1$，时间步长 $\\Delta t = 10^{-3}$，步数 $3000$，容差 $\\epsilon = 10^{-6}$，$\\rho = 0.05$。\n- 案例3 (强振幅)：$N = 12$，$\\lambda = 1.5$，$k_0 = 1$，$(a,b,c) = (1, -\\tfrac{1}{2}, -\\tfrac{1}{2})$，$\\sigma = 3$，时间步长 $\\Delta t = 5\\times 10^{-4}$，步数 $3000$，容差 $\\epsilon = 10^{-6}$，$\\rho = 0.05$。\n- 案例4 (守恒破缺，边界情况)：$N = 12$，$\\lambda = 1.618$，$k_0 = 1$，$(a,b,c) = (1, -0.4, -0.5)$，$\\sigma = 1$，时间步长 $\\Delta t = 10^{-3}$，步数 $4000$，容差 $\\epsilon = 10^{-6}$，$\\rho = 0.05$。\n\n对于每个案例，评估两个截断的“无持续通量”条件，并返回一个布尔值，指示两个截断是否都满足该条件。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，`[True,False,True,True]`）。由于模型是无量纲构造的，因此不需要物理单位。角度不会出现，所有值都必须以指定的布尔格式报告。",
            "solution": "用户希望验证 Sabra 壳层模型中三波相互作用的数值测试，该模型被用作聚变等离子体湍流的替代模型。\n\n### 步骤1：提取已知信息\n\n-   **模型**：无粘截断 Sabra 壳层模型。\n-   **壳层波数**：$k_n = k_0 \\lambda^n$，壳层指数 $n \\in \\{0, 1, \\dots, N-1\\}$，其中 $k_0  0$ 且 $\\lambda  1$。\n-   **状态变量**：复壳层振幅 $u_n(t) \\in \\mathbb{C}$。\n-   **演化方程**：\n    $$\n    \\frac{d u_n}{d t} = i \\left( a\\, k_{n+1}\\, u_{n+1}\\, u_{n+2}^\\ast \\;+\\; b\\, k_n\\, u_{n-1}\\, u_{n+1}^\\ast \\;+\\; c\\, k_{n-1}\\, u_{n-1}\\, u_{n-2} \\right)\n    $$\n-   **边界条件**：任何引用超出范围的壳层指数（即 $ 0$ 或 $\\ge N$）的项均设置为零。\n-   **模型系数**：$a, b, c$ 是实常数。\n-   **总能量**：$E(t) = \\frac{1}{2} \\sum_{n=0}^{N-1} |u_n(t)|^2$。\n-   **能量守恒**：当且仅当 $a + b + c = 0$ 时，总能量 $E(t)$ 是守恒量。\n-   **非线性能量输运**：进入壳层 $n$ 的瞬时能量输运为 $T_n(t) = \\operatorname{Re}\\left[ u_n^\\ast(t)\\, \\mathcal{N}_n(t) \\right]$，其中 $\\mathcal{N}_n(t)$ 是 $u_n$ 演化方程的整个右端项。\n-   **累积能量通量**：跨越壳层截断 $m$ 的通量为 $\\Pi_m(t) = -\\sum_{n=0}^{m} T_n(t)$。\n-   **初始条件**：系统在绝对平衡态附近初始化。初始振幅 $u_n(0)$ 是均值为零、方差为 $\\sigma^2$ 的独立复高斯随机变量。这可以实现为 $u_n(0) \\sim \\mathcal{N}(0,\\sigma^2/2) + i\\,\\mathcal{N}(0,\\sigma^2/2)$。\n-   **数值方法**：使用固定步长的显式积分器。必须通过固定随机种子来确保可复现性。\n-   **测量任务**：\n    1.  在指定数量的时间步长上演化系统。\n    2.  计算两个截断的通量时间序列 $\\Pi_m(t)$：$m_1 = \\lfloor N/3 \\rfloor$ 和 $m_2 = \\lfloor 2N/3 \\rfloor$。\n    3.  对每个截断 $m$，计算通量时间序列的时间平均值 $\\overline{\\Pi}_m$ 和标准差 $S_m$。\n    4.  如果“无持续通量”条件 $|\\overline{\\Pi}_m| \\le \\epsilon + \\rho\\, S_m$ 对 $m_1$ 和 $m_2$ 都满足，则测试案例通过。\n\n-   **测试套件**：\n    -   **案例1**：$N = 12$，$\\lambda = 1.618$，$k_0 = 1$，$(a,b,c) = (1, -0.5, -0.5)$，$\\sigma = 1$，$\\Delta t = 10^{-3}$，步数 $= 4000$，$\\epsilon = 10^{-6}$，$\\rho = 0.05$。\n    -   **案例2**：$N = 6$，$\\lambda = 1.5$，$k_0 = 1$，$(a,b,c) = (1, -0.5, -0.5)$，$\\sigma = 1$，$\\Delta t = 10^{-3}$，步数 $= 3000$，$\\epsilon = 10^{-6}$，$\\rho = 0.05$。\n    -   **案例3**：$N = 12$，$\\lambda = 1.5$，$k_0 = 1$，$(a,b,c) = (1, -0.5, -0.5)$，$\\sigma = 3$，$\\Delta t = 5 \\times 10^{-4}$，步数 $= 3000$，$\\epsilon = 10^{-6}$，$\\rho = 0.05$。\n    -   **案例4**：$N = 12$，$\\lambda = 1.618$，$k_0 = 1$，$(a,b,c) = (1, -0.4, -0.5)$，$\\sigma = 1$，$\\Delta t = 10^{-3}$，步数 $= 4000$，$\\epsilon = 10^{-6}$，$\\rho = 0.05$。\n\n-   **输出格式**：包含布尔值列表的单行：`[result1,result2,result3,result4]`。\n\n### 步骤2：使用提取的已知信息进行验证\n\n1.  **科学依据**：该问题基于 Sabra 壳层模型，这是流体和等离子体湍流领域中一个标准且广为接受的简化模型。三波相互作用、谱能量输运、统计平衡以及二次不变量的吉布斯分布等概念是统计力学和湍流理论中的基本原理。该问题是科学合理的。\n2.  **适定性**：该问题提供了系统的完整数学描述，包括控制方程、每个测试案例的所有必要参数、精确定义的初始条件以及清晰、定量的成功标准。任务是执行数值模拟和后续检查，这是一个明确定义的过程。\n3.  **客观性**：该问题以精确、客观和数学的语言陈述。没有主观或含糊的术语。测试案例和通过/失败条件都得到了严格定义。\n\n该问题通过了所有验证检查。它是一个完整、一致且科学有效的问题，可以按所述方式解决。\n\n### 步骤3：结论与行动\n\n该问题有效。我将继续设计并实现解决方案。\n\n### 基于原理的设计\n\n问题的核心是模拟耦合常微分方程 (ODE) 系统的时间演化，并分析由此产生的能量通量的统计特性。\n\n**1. 系统表示与初始化**\n系统在任何时间 $t$ 的状态由复振幅向量 $\\vec{u}(t) = [u_0, u_1, \\dots, u_{N-1}]$ 给出。模型参数（如波数 $k_n$）被预先计算和存储。初始条件 $u_n(0)$ 从复正态分布中抽取，以模拟正则平衡态。这是通过从高斯分布 $\\mathcal{N}(0, \\sigma^2/2)$ 生成独立的实部和虚部来实现的。为确保可复现性，伪随机数生成器使用固定的整数作为种子。\n\n**2. 时间积分**\n问题指定了固定步长的显式积分器。前向欧拉法是其中最简单的选择：\n$$ u_n(t+\\Delta t) = u_n(t) + \\Delta t \\, \\frac{du_n}{dt}(t) $$\n其中 $\\frac{du_n}{dt}$ 是演化方程的右端项 (RHS)。鉴于指定的小时间步长和有限的积分周期，此方法足以完成任务。\n\n**3. 计算非线性项 (RHS)**\n右端项 $\\mathcal{N}_n = \\frac{du_n}{dt}$ 由三项组成，每项代表一个三波相互作用。朴素的实现将是对壳层 $n \\in \\{0, \\dots, N-1\\}$ 进行循环。对每个 $n$，需要进行边界检查（如 `if n+2  N`）来处理超出范围的指数。一种更高效的、使用 `numpy` 数组切片的向量化实现可以同时计算所有壳层的 RHS。对于三种相互作用类型中的每一种，我们可以定义状态向量 $\\vec{u}$ 的切片，这些切片对应于指数 $(n-2, n-1, n, n+1, n+2)$，并在 $n$ 的有效范围内逐元素执行乘法。例如，第一项 $a k_{n+1} u_{n+1} u_{n+2}^\\ast$ 可以通过 `a * k[1:-1] * u[1:-1] * np.conj(u[2:])` 为所有适用的 $n$（从 $0$ 到 $N-3$）进行计算。对另外两项也构造类似的表达式。\n\n**4. 计算输运和通量**\n在每个时间步，计算完 RHS $\\mathcal{N_n} = \\frac{du_n}{dt}$ 后，进入每个壳层的能量输运计算为 $T_n = \\operatorname{Re}[u_n^* \\mathcal{N}_n]$。然后，累积通量 $\\Pi_m(t)$ 是这些输运直到截断指数 $m$ 的负和。\n$$ \\Pi_m(t) = -\\sum_{n=0}^{m} T_n(t) $$\n$\\Pi_{m_1}(t)$ 和 $\\Pi_{m_2}(t)$ 的时间序列被存储起来用于模拟后分析。\n\n**5. 统计分析与验证**\n模拟完成后，分析 $\\Pi_{m_1}$ 和 $\\Pi_{m_2}$ 的时间序列。核心思想是，对于一个处于热平衡状态（由初始条件设定）且能量守恒（$a+b+c=0$）的系统，不同尺度之间不应存在净的、持续的能量流动。通量 $\\Pi_m(t)$ 应该在零均值附近波动。测试条件 $|\\overline{\\Pi}_m| \\le \\epsilon + \\rho\\, S_m$ 将这一预期形式化。它断言，测得的通量时间平均值 $\\overline{\\Pi}_m$ 应在统计上与零无法区分，同时允许一个小的绝对容差 $\\epsilon$ 和一个与波动幅度 $S_m$ 成比例的容差。\n\n对于案例1、2和3，其中 $a+b+c=0$，系统能量守恒并在平衡态下初始化。我们期望“无持续通量”条件得到满足，这些测试应该会通过。对于案例4，$a+b+c=0.1 \\neq 0$，所以能量不守恒。绝对平衡的基本假设被违反。系统很可能会产生一个系统性的能量耗散或源，导致非零的平均通量。因此，预计此案例将无法通过测试。\n\n实现将封装此逻辑，遍历每个测试案例，执行模拟，并评估通过/失败条件。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(N, lam, k0, a, b, c, sigma, dt, num_steps, eps, rho):\n    \"\"\"\n    Runs a single simulation of the Sabra shell model and checks the 'no persistent flux' condition.\n    \"\"\"\n    # Fix the random seed for reproducibility.\n    rng = np.random.default_rng(seed=0)\n\n    # Define shell cutoffs for flux calculation\n    m1 = N // 3\n    m2 = 2 * N // 3\n\n    # Initialize wavenumbers and complex shell amplitudes\n    k = k0 * lam**np.arange(N)\n    u = (rng.normal(size=N, scale=sigma/np.sqrt(2)) + \n         1j * rng.normal(size=N, scale=sigma/np.sqrt(2)))\n\n    pi_m1_history = np.zeros(num_steps)\n    pi_m2_history = np.zeros(num_steps)\n\n    # Time integration loop\n    for i in range(num_steps):\n        # Calculate the nonlinear RHS (dudt) in a vectorized manner\n        dudt = np.zeros(N, dtype=np.complex128)\n        \n        # Term 1: a * k_{n+1} * u_{n+1} * u_{n+2}^*\n        # Valid for n from 0 to N-3\n        if N > 2:\n            dudt[:-2] += a * k[1:-1] * u[1:-1] * np.conj(u[2:])\n        \n        # Term 2: b * k_n * u_{n-1} * u_{n+1}^*\n        # Valid for n from 1 to N-2\n        if N > 2:\n            dudt[1:-1] += b * k[1:-1] * u[:-2] * np.conj(u[2:])\n            \n        # Term 3: c * k_{n-1} * u_{n-1} * u_{n-2}\n        # Valid for n from 2 to N-1\n        if N > 2:\n            dudt[2:] += c * k[1:-1] * u[1:-1] * u[:-2]\n            \n        dudt *= 1j\n\n        # Calculate instantaneous energy transfer T_n\n        T = np.real(np.conj(u) * dudt)\n        \n        # Calculate cumulative energy flux Pi_m\n        pi_m1_history[i] = -np.sum(T[0:m1+1])\n        pi_m2_history[i] = -np.sum(T[0:m2+1])\n        \n        # Update shell amplitudes using Forward Euler\n        u += dt * dudt\n\n    # Analyze the flux time series\n    avg1 = np.mean(pi_m1_history)\n    std1 = np.std(pi_m1_history)\n    \n    avg2 = np.mean(pi_m2_history)\n    std2 = np.std(pi_m2_history)\n    \n    # Check the 'no persistent flux' condition for both cutoffs\n    pass1 = np.abs(avg1) = eps + rho * std1\n    pass2 = np.abs(avg2) = eps + rho * std2\n    \n    return pass1 and pass2\n\ndef solve():\n    \"\"\"\n    Defines test cases and runs the simulation for each, printing the results.\n    \"\"\"\n    test_cases = [\n        # Case 1: Standard case\n        {'N': 12, 'lam': 1.618, 'k0': 1.0, 'a': 1.0, 'b': -0.5, 'c': -0.5, \n         'sigma': 1.0, 'dt': 1e-3, 'num_steps': 4000, 'eps': 1e-6, 'rho': 0.05},\n        # Case 2: Boundary shell count\n        {'N': 6, 'lam': 1.5, 'k0': 1.0, 'a': 1.0, 'b': -0.5, 'c': -0.5, \n         'sigma': 1.0, 'dt': 1e-3, 'num_steps': 3000, 'eps': 1e-6, 'rho': 0.05},\n        # Case 3: Strong amplitude\n        {'N': 12, 'lam': 1.5, 'k0': 1.0, 'a': 1.0, 'b': -0.5, 'c': -0.5, \n         'sigma': 3.0, 'dt': 5e-4, 'num_steps': 3000, 'eps': 1e-6, 'rho': 0.05},\n        # Case 4: Broken conservation\n        {'N': 12, 'lam': 1.618, 'k0': 1.0, 'a': 1.0, 'b': -0.4, 'c': -0.5, \n         'sigma': 1.0, 'dt': 1e-3, 'num_steps': 4000, 'eps': 1e-6, 'rho': 0.05},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(**case)\n        results.append(result)\n\n    # Format the output as a string representation of a list of booleans\n    formatted_results = [str(r) for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}