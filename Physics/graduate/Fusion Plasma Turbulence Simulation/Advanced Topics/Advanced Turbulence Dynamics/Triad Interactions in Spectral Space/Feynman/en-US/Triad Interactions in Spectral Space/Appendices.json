{
    "hands_on_practices": [
        {
            "introduction": "Before building complex simulations, it is invaluable to understand the fundamental constraints that govern nonlinear transfer. This analytical exercise explores how the simultaneous conservation of energy and potential enstrophy in 2D turbulence models powerfully dictates the flow of energy between scales . By analyzing an idealized three-shell interaction, you will derive the famous dual cascade from first principles, gaining a concrete understanding of how local triad interactions lead to large-scale turbulent organization.",
            "id": "4207770",
            "problem": "Consider the inviscid, unforced Charney–Hasegawa–Mima (CHM) model, which evolves the electrostatic potential $\\,\\phi(\\boldsymbol{x},t)\\,$ through the conservation of potential vorticity $\\,q(\\boldsymbol{x},t) = \\nabla^{2}\\phi - \\alpha\\,\\phi\\,$ with Jacobian nonlinearity $\\,J(\\phi,q) \\equiv \\partial_{x}\\phi\\,\\partial_{y}q - \\partial_{y}\\phi\\,\\partial_{x}q\\,$. In Fourier space, modes $\\,\\phi_{\\boldsymbol{k}}\\,$ interact in triads satisfying $\\,\\boldsymbol{k}+\\boldsymbol{p}+\\boldsymbol{q}=\\boldsymbol{0}\\,$. Two quadratic invariants in the inviscid CHM system are the total energy and the total potential enstrophy, defined by\n$$\n\\mathcal{E} = \\frac{1}{2}\\int \\left(|\\nabla \\phi|^{2} + \\alpha\\,|\\phi|^{2}\\right)\\,d^{2}x = \\frac{1}{2}\\sum_{\\boldsymbol{k}} \\left(k^{2}+\\alpha\\right)\\,|\\phi_{\\boldsymbol{k}}|^{2},\n\\qquad\n\\mathcal{Z} = \\frac{1}{2}\\int |q|^{2}\\,d^{2}x = \\frac{1}{2}\\sum_{\\boldsymbol{k}} \\left(k^{2}+\\alpha\\right)^{2}\\,|\\phi_{\\boldsymbol{k}}|^{2}.\n$$\nHence, at each wavenumber magnitude $\\,k\\,$, the energy spectral density and the potential enstrophy spectral density satisfy $\\,Z_{k} = \\left(k^{2}+\\alpha\\right) E_{k}\\,$, where $\\,E_{k} = \\frac{1}{2}\\left(k^{2}+\\alpha\\right)|\\phi_{\\boldsymbol{k}}|^{2}\\,$ and $\\,Z_{k} = \\frac{1}{2}\\left(k^{2}+\\alpha\\right)^{2}|\\phi_{\\boldsymbol{k}}|^{2}\\,$.\n\nAdopt a discrete, isotropic spectrum concentrated in three concentric spectral shells $\\,S_{1},S_{2},S_{3}\\,$ with representative magnitudes $\\,k_{1},k_{2},k_{3}\\,$ and negligible energy elsewhere. Take $\\,\\alpha=1\\,$ and choose $\\,k_{1}=1\\,$, $\\,k_{2}=2\\,$, and $\\,k_{3}=3\\,$. Assume that an isolated, local three-shell interaction consistent with CHM triads redistributes energy instantaneously among these shells while conserving both total energy and total potential enstrophy. Let $\\,\\delta E_{i}\\,$ denote the energy change in shell $\\,S_{i}\\,$ during this exchange, and suppose the intermediate shell loses a prescribed amount of energy $\\,\\delta E_{2}=-\\Delta\\,$ with $\\,\\Delta>0\\,$. The conservation laws then determine $\\,\\delta E_{1}\\,$ and $\\,\\delta E_{3}\\,$.\n\nCompute the fraction $\\,f\\,$ of the energy removed from the intermediate shell $\\,S_{2}\\,$ that is transferred to the large-scale shell $\\,S_{1}\\,$ when $\\,\\Delta\\,$ is normalized to $\\,\\Delta=1\\,$. That is, find\n$$\nf \\equiv \\frac{\\delta E_{1}}{\\Delta}\n$$\nfor the specified $\\,\\alpha\\,$ and $\\,k_{i}\\,$. Based on your result, identify within your derivation the directionality of the energy and potential enstrophy fluxes implied by this triad-consistent shell-to-shell transfer.\n\nExpress your final numerical answer for $\\,f\\,$ as a decimal rounded to four significant figures. No units are required.",
            "solution": "The problem is first validated to ensure it is scientifically sound, well-posed, and objective.\n\n### Step 1: Extract Givens\n- **Model**: Inviscid, unforced Charney–Hasegawa–Mima (CHM) model.\n- **Potential Vorticity**: $q(\\boldsymbol{x},t) = \\nabla^{2}\\phi - \\alpha\\,\\phi$.\n- **Quadratic Invariants**:\n  - Total Energy: $\\mathcal{E} = \\frac{1}{2}\\sum_{\\boldsymbol{k}} (k^{2}+\\alpha)\\,|\\phi_{\\boldsymbol{k}}|^{2}$.\n  - Total Potential Enstrophy: $\\mathcal{Z} = \\frac{1}{2}\\sum_{\\boldsymbol{k}} (k^{2}+\\alpha)^{2}\\,|\\phi_{\\boldsymbol{k}}|^{2}$.\n- **Spectral Density Relation**: For a given wavenumber magnitude $k$, the energy spectral density $E_{k}$ and potential enstrophy spectral density $Z_{k}$ are related by $Z_{k} = (k^{2}+\\alpha) E_{k}$.\n- **System**: A discrete, isotropic spectrum concentrated in three shells $S_{1}$, $S_{2}$, $S_{3}$.\n- **Representative Wavenumber Magnitudes**: $k_{1}$, $k_{2}$, $k_{3}$.\n- **Given Values**: $\\alpha=1$, $k_{1}=1$, $k_{2}=2$, $k_{3}=3$.\n- **Interaction**: An isolated, local three-shell interaction conserves total energy and total potential enstrophy.\n- **Energy Changes**: $\\delta E_{i}$ is the energy change in shell $S_{i}$.\n- **Prescribed Condition**: $\\delta E_{2}=-\\Delta$, with $\\Delta>0$. For the final calculation, $\\Delta=1$.\n- **Objective**: Compute the fraction $f \\equiv \\frac{\\delta E_{1}}{\\Delta}$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientific Grounding**: The CHM equation is a standard model in plasma physics and geophysical fluid dynamics. The concepts of energy and potential enstrophy as conserved quantities and their spectral representations are fundamental to the study of turbulence in these systems. The problem is scientifically grounded.\n2.  **Well-Posedness**: The problem defines a closed system of linear equations based on two conservation laws for three variables. Specifying one variable constrains the system, leading to a unique solution for the other two. The problem is well-posed.\n3.  **Objectivity**: The problem is stated using precise mathematical definitions and contains no subjective or ambiguous language. It is objective.\n4.  **Consistency**: The chosen wavenumbers $k_{1}=1$, $k_{2}=2$, $k_{3}=3$ can form a degenerate triangle ($1+2=3$), which is required for a triad interaction. The setup is internally consistent and physically plausible within the context of idealized spectral models.\n\n### Step 3: Verdict and Action\nThe problem is valid. A solution will be derived.\n\n### Solution Derivation\nThe core of the problem lies in the simultaneous conservation of total energy $\\mathcal{E}$ and total potential enstrophy $\\mathcal{Z}$ during the interaction among the three shells $S_{1}$, $S_{2}$, and $S_{3}$. Let $\\delta E_{i}$ and $\\delta Z_{i}$ be the changes in energy and potential enstrophy, respectively, within shell $S_{i}$, which is characterized by the representative wavenumber $k_{i}$.\n\nThe conservation laws for this isolated three-shell system can be written as:\n$$\n\\delta \\mathcal{E}_{\\text{total}} = \\delta E_{1} + \\delta E_{2} + \\delta E_{3} = 0\n$$\n$$\n\\delta \\mathcal{Z}_{\\text{total}} = \\delta Z_{1} + \\delta Z_{2} + \\delta Z_{3} = 0\n$$\n\nThe problem states that for a given wavenumber magnitude $k$, the spectral densities are related by $Z_{k} = (k^{2}+\\alpha) E_{k}$. This relationship extends to the total energy $E_{i}$ and total potential enstrophy $Z_{i}$ integrated over a narrow shell $S_i$ with representative wavenumber $k_i$. Thus, for any change in these quantities, we must have:\n$$\n\\delta Z_{i} = (k_{i}^{2}+\\alpha) \\delta E_{i}\n$$\n\nSubstituting this relationship into the potential enstrophy conservation equation yields:\n$$\n(k_{1}^{2}+\\alpha) \\delta E_{1} + (k_{2}^{2}+\\alpha) \\delta E_{2} + (k_{3}^{2}+\\alpha) \\delta E_{3} = 0\n$$\n\nWe now have a system of two linear equations for the three variables $\\delta E_{1}$, $\\delta E_{2}$, and $\\delta E_{3}$:\n1.  $\\delta E_{1} + \\delta E_{2} + \\delta E_{3} = 0$\n2.  $(k_{1}^{2}+\\alpha) \\delta E_{1} + (k_{2}^{2}+\\alpha) \\delta E_{2} + (k_{3}^{2}+\\alpha) \\delta E_{3} = 0$\n\nThe problem specifies that the intermediate shell loses energy $\\delta E_{2} = -\\Delta$, where $\\Delta > 0$. We can use this to solve for the unknowns $\\delta E_{1}$ and $\\delta E_{3}$:\n1.  $\\delta E_{1} + \\delta E_{3} = -\\delta E_{2} = \\Delta$\n2.  $(k_{1}^{2}+\\alpha) \\delta E_{1} + (k_{3}^{2}+\\alpha) \\delta E_{3} = -(k_{2}^{2}+\\alpha) \\delta E_{2} = (k_{2}^{2}+\\alpha) \\Delta$\n\nFrom the first equation, we can express $\\delta E_{3}$ in terms of $\\delta E_{1}$:\n$$\n\\delta E_{3} = \\Delta - \\delta E_{1}\n$$\n\nSubstitute this into the second equation:\n$$\n(k_{1}^{2}+\\alpha) \\delta E_{1} + (k_{3}^{2}+\\alpha) (\\Delta - \\delta E_{1}) = (k_{2}^{2}+\\alpha) \\Delta\n$$\n\nNow, we solve for $\\delta E_{1}$:\n$$\n(k_{1}^{2}+\\alpha) \\delta E_{1} + (k_{3}^{2}+\\alpha) \\Delta - (k_{3}^{2}+\\alpha) \\delta E_{1} = (k_{2}^{2}+\\alpha) \\Delta\n$$\n$$\n\\delta E_{1} \\left( (k_{1}^{2}+\\alpha) - (k_{3}^{2}+\\alpha) \\right) = \\Delta \\left( (k_{2}^{2}+\\alpha) - (k_{3}^{2}+\\alpha) \\right)\n$$\n$$\n\\delta E_{1} (k_{1}^{2} - k_{3}^{2}) = \\Delta (k_{2}^{2} - k_{3}^{2})\n$$\n\nThe desired fraction $f$ is defined as $f \\equiv \\frac{\\delta E_{1}}{\\Delta}$. From the equation above, we find:\n$$\nf = \\frac{\\delta E_{1}}{\\Delta} = \\frac{k_{2}^{2} - k_{3}^{2}}{k_{1}^{2} - k_{3}^{2}}\n$$\nThis expression for the fraction $f$ is remarkably independent of the parameter $\\alpha$.\n\nWe now substitute the given numerical values for the wavenumbers: $k_{1}=1$, $k_{2}=2$, and $k_{3}=3$.\n$$\nf = \\frac{2^{2} - 3^{2}}{1^{2} - 3^{2}} = \\frac{4 - 9}{1 - 9} = \\frac{-5}{-8} = \\frac{5}{8}\n$$\n\nAs a decimal, $f = 0.625$. The problem requires the answer to be rounded to four significant figures, which is $0.6250$.\n\nTo identify the directionality of the fluxes, we analyze the signs of the energy changes. We set $\\Delta=1$ as instructed for the normalization.\n-   $\\delta E_{1} = f \\Delta = \\frac{5}{8} \\Delta$. Since $\\Delta > 0$, $\\delta E_{1} > 0$. Energy flows into the large-scale shell $S_{1}$ (inverse cascade).\n-   $\\delta E_{2} = -\\Delta < 0$. Energy is removed from the intermediate shell $S_{2}$.\n-   $\\delta E_{3} = \\Delta - \\delta E_{1} = \\Delta - \\frac{5}{8}\\Delta = \\frac{3}{8}\\Delta$. Since $\\Delta > 0$, $\\delta E_{3} > 0$. Energy flows into the small-scale shell $S_{3}$ (direct cascade).\n\nThis simultaneous transfer of energy to both larger scales (lower $k$) and smaller scales (higher $k$) from an intermediate source is the hallmark of a **dual cascade**.\n\nNext, we examine the potential enstrophy fluxes using $\\alpha=1$ and $\\Delta=1$:\n-   $\\delta Z_{1} = (k_{1}^{2}+\\alpha) \\delta E_{1} = (1^{2}+1) \\left(\\frac{5}{8}\\right) = 2 \\left(\\frac{5}{8}\\right) = \\frac{10}{8} = \\frac{5}{4} = 1.25$.\n-   $\\delta Z_{2} = (k_{2}^{2}+\\alpha) \\delta E_{2} = (2^{2}+1) (-1) = -5$.\n-   $\\delta Z_{3} = (k_{3}^{2}+\\alpha) \\delta E_{3} = (3^{2}+1) \\left(\\frac{3}{8}\\right) = 10 \\left(\\frac{3}{8}\\right) = \\frac{30}{8} = \\frac{15}{4} = 3.75$.\n\nThe total enstrophy change is $\\delta Z_{1} + \\delta Z_{2} + \\delta Z_{3} = 1.25 - 5 + 3.75 = 0$, confirming conservation.\nThe shell $S_2$ loses $5$ units of potential enstrophy. Of this, $3.75$ units ($75\\%$) are transferred to the small-scale shell $S_{3}$, while $1.25$ units ($25\\%$) are transferred to the large-scale shell $S_{1}$. The dominant flux of potential enstrophy is thus a **direct cascade** to smaller scales (higher $k$).\n\nIn summary, the interaction results in a dual energy cascade and a predominantly direct potential enstrophy cascade, which are characteristic features of turbulence in the CHM system. The fraction of energy transferred from the intermediate shell to the large-scale shell is $f = \\frac{5}{8}$.\n\nFinal calculation for the requested format:\n$f = \\frac{5}{8} = 0.625$. Rounded to four significant figures, the result is $0.6250$.",
            "answer": "$$\n\\boxed{0.6250}\n$$"
        },
        {
            "introduction": "From the analytical constraints on a single triad, we move to the practical challenge of handling all possible interactions within a full simulation. In a spectral code, the nonlinear term is computed as a sum over all resonant triads, and the first step is to identify them efficiently . This computational practice tasks you with designing and implementing an algorithm to enumerate all such triads in a 2D domain, providing direct experience with a core component of turbulence simulation and the computational scaling laws that govern it.",
            "id": "4207745",
            "problem": "You are tasked with designing and implementing an algorithm to enumerate all spectral triads in a two-dimensional periodic domain that are relevant to nonlinear mode coupling in fusion plasma turbulence simulations. Begin from first principles and core definitions about Fourier representations of fields and the convolution property of quadratic nonlinearities. Use these principles to justify the triad condition in spectral space and to design a computational strategy and its complexity analysis.\n\nAssume a square periodic domain of side length $2\\pi$, so the Fourier wavevectors are integer pairs $k = (k_x, k_y)$ with $k_x \\in \\mathbb{Z}$ and $k_y \\in \\mathbb{Z}$. Let $k_{\\max} \\in \\mathbb{N}$ define the maximum wavenumber cutoff. Define the admissible set of nonzero modes by\n$$\n\\mathcal{S}(k_{\\max}) = \\left\\{ (k_x,k_y) \\in \\mathbb{Z}^2 \\setminus \\{(0,0)\\} \\;\\middle|\\; k_x^2 + k_y^2 \\le k_{\\max}^2 \\right\\}.\n$$\nIn spectral space, a triad is an unordered triple $\\{k,p,q\\} \\subset \\mathcal{S}(k_{\\max})$ that satisfies the resonance condition\n$$\nk = p + q,\n$$\nwhere $p$ and $q$ are elements of $\\mathcal{S}(k_{\\max})$ and the sum is taken component-wise. The triad is considered unordered: any permutation of $(k,p,q)$ represents the same triad. The zero mode $(0,0)$ is excluded from $\\mathcal{S}(k_{\\max})$, and degenerate pairs with $p = q$ are permitted provided $2p \\in \\mathcal{S}(k_{\\max})$.\n\nStarting from the fundamental fact that the Fourier transform maps products in real space to convolutions in spectral space, derive the triad condition and then design an algorithm that:\n- Constructs $\\mathcal{S}(k_{\\max})$.\n- Enumerates all unique unordered triads $\\{k,p,q\\}$ with $k = p + q$ and $k,p,q \\in \\mathcal{S}(k_{\\max})$.\n- Avoids double-counting the same triad under permutation of $(k,p,q)$.\n\nAnalyze the computational complexity of your algorithm in terms of the number of admissible modes $M = \\left|\\mathcal{S}(k_{\\max})\\right|$ and the parameter $k_{\\max}$, and provide clear reasoning for your complexity class. Express your complexity analysis in big-$\\mathcal{O}$ notation and justify any assumptions such as constant-time set membership.\n\nYour program must implement the algorithm and, for a provided test suite of $k_{\\max}$ values, compute for each case:\n- The number of unique unordered triads $T$ found by your algorithm.\n- The number of admissible modes $M$.\n- The number of unordered pairs of modes checked $P$, where pairs include $p = q$ and are treated as unordered, so $P = M(M+1)/2$.\n\nTest Suite:\n- Case $1$: $k_{\\max} = 0$.\n- Case $2$: $k_{\\max} = 1$.\n- Case $3$: $k_{\\max} = 2$.\n- Case $4$: $k_{\\max} = 3$.\n- Case $5$: $k_{\\max} = 4$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results for the five test cases as a comma-separated list of lists, in the exact form\n$$\n\\left[ [T_1,M_1,P_1],[T_2,M_2,P_2],[T_3,M_3,P_3],[T_4,M_4,P_4],[T_5,M_5,P_5] \\right].\n$$\nNo physical units or angle units are required for this problem. All computed outputs must be integers. The program must be fully self-contained and require no user input.",
            "solution": "The task is motivated by the convolution structure of quadratic nonlinearities in spectral representations of fluid-like plasma models. Consider a scalar field $\\phi(x,y,t)$ defined on a two-dimensional periodic square of side $2\\pi$. Its Fourier series is\n$$\n\\phi(x,y,t) = \\sum_{k \\in \\mathbb{Z}^2} \\hat{\\phi}_k(t) \\, e^{i(k_x x + k_y y)}.\n$$\nFor models with quadratic nonlinearities such as the advective nonlinearity in the two-dimensional incompressible flow or the Poisson bracket nonlinearity in drift-wave turbulence, a typical nonlinear term involves products of fields (or their derivatives) in real space. By the convolution theorem, the Fourier transform of a product becomes a convolution. For two fields $\\phi$ and $\\psi$ with Fourier coefficients $\\hat{\\phi}_k$ and $\\hat{\\psi}_k$, the Fourier coefficient of their product at mode $k$ is\n$$\n\\widehat{(\\phi \\psi)}_k = \\sum_{p \\in \\mathbb{Z}^2} \\hat{\\phi}_p \\, \\hat{\\psi}_{k-p}.\n$$\nThe sum is over all integer wavevectors $p$, and $q = k - p$ is another wavevector. This shows that the spectral coefficient at $k$ couples to pairs $(p,q)$ that satisfy $p + q = k$. In turbulence systems, nonlinear energy transfer arises from these triad interactions. Hence, the triad condition\n$$\nk = p + q\n$$\nis fundamental, and the set of three participating wavevectors $\\{k,p,q\\}$ defines a triad.\n\nWe restrict the spectral domain to a finite set motivated by numerical simulations: we consider only integer wavevectors $(k_x,k_y)$ satisfying $k_x^2 + k_y^2 \\le k_{\\max}^2$, excluding the zero mode. This set is\n$$\n\\mathcal{S}(k_{\\max}) = \\left\\{ (k_x,k_y) \\in \\mathbb{Z}^2 \\setminus \\{(0,0)\\} \\;\\middle|\\; k_x^2 + k_y^2 \\le k_{\\max}^2 \\right\\}.\n$$\nThe number of admissible modes is $M = \\left|\\mathcal{S}(k_{\\max})\\right|$. As $k_{\\max}$ grows, $M$ scales like the number of integer lattice points inside a disk of radius $k_{\\max}$, which asymptotically satisfies\n$$\nM \\sim \\pi k_{\\max}^2 \\quad \\text{as } k_{\\max} \\to \\infty,\n$$\nup to boundary effects.\n\nAlgorithm design:\n1. Construct $\\mathcal{S}(k_{\\max})$ by iterating over integer $k_x$ and $k_y$ in the range $-k_{\\max}$ to $k_{\\max}$, excluding $(0,0)$, and retaining those for which $k_x^2 + k_y^2 \\le k_{\\max}^2$. Store the set both as a list for ordered iteration and as a hash set (e.g., Python set of tuples) for $O(1)$ average-time membership queries.\n2. Enumerate unordered pairs $(p,q)$ from $\\mathcal{S}(k_{\\max})$, including the degenerate case $p = q$. Use indices $i$ and $j$ with $0 \\le i \\le j < M$ for the list of modes of length $M$. The total number of unordered pairs considered is\n   $$\n   P = \\frac{M(M+1)}{2}.\n   $$\n3. For each pair $(p,q)$, compute $k = p + q$ as component-wise addition, and check whether $k \\in \\mathcal{S}(k_{\\max})$. If true, then the triple $(k,p,q)$ satisfies the triad condition. Because the triad is unordered, the same triple can also arise from the other pair sums $(q,k)$ and $(k,p)$. To avoid double-counting, canonicalize the triple $\\{k,p,q\\}$ by sorting its three vectors under a fixed lexicographic order and inserting the resulting ordered triple into a hash set of triads. This ensures each unordered triad is counted exactly once.\n4. The output for each $k_{\\max}$ is the number of unique triads $T$, the number of modes $M$, and the number of pairs checked $P$.\n\nComplexity analysis:\n- Constructing $\\mathcal{S}(k_{\\max})$ requires checking all integer pairs $(k_x,k_y)$ in the square $[-k_{\\max},k_{\\max}]^2$, which has $(2k_{\\max}+1)^2$ points. The time to build the set is $O(k_{\\max}^2)$, consistent with $M = O(k_{\\max}^2)$, and the space is $O(M)$.\n- Enumerating all unordered pairs $(p,q)$ is $P = M(M+1)/2 = O(M^2)$ iterations. For each pair, computing $k = p + q$ and checking membership in the hash set is $O(1)$ average time. Canonicalization and insertion in a triad set are $O(1)$ average time for hashing (sorting three items is $O(1)$ since it is constant size).\n- Therefore, the total time complexity is\n  $$\n  O(M^2),\n  $$\n  and the space complexity is\n  $$\n  O(M + T),\n  $$\n  where $T$ is the number of unique triads found, with $T \\le P$.\n- In terms of $k_{\\max}$, using $M = \\Theta(k_{\\max}^2)$ gives overall time $O(k_{\\max}^4)$.\n\nCorrectness argument:\n- The convolution property in spectral space requires that nonlinear coupling into mode $k$ comes from pairs $(p,q)$ satisfying $p + q = k$. Enumerating all such pairs over $\\mathcal{S}(k_{\\max})$ and collecting unordered triples ensures all triads consistent with the resonance condition are found.\n- Excluding $(0,0)$ avoids trivial couplings via the zero mode, in line with typical simulation practice. Allowing $p = q$ ensures that valid degenerate triads with $k = 2p$ are included.\n- Canonicalization via sorting removes permutation ambiguities among $(k,p,q)$, producing a well-defined count of unordered triads.\n\nTest suite and outputs:\n- For $k_{\\max} \\in \\{0,1,2,3,4\\}$, the program constructs $\\mathcal{S}(k_{\\max})$, enumerates triads, and prints a single line\n  $$\n  \\left[ [T_1,M_1,P_1],[T_2,M_2,P_2],[T_3,M_3,P_3],[T_4,M_4,P_4],[T_5,M_5,P_5] \\right],\n  $$\n  where $T_i$ is the triad count, $M_i$ is the mode count, and $P_i = M_i(M_i+1)/2$ is the pair count for case $i$. All values are integers.\n\nThis approach is scientifically realistic and algorithmically grounded in the fundamental convolution property, producing an efficient enumeration consistent with the typical structure of spectral nonlinearities used in fusion plasma turbulence simulations such as drift-wave and gyrofluid models.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef generate_modes(kmax: int):\n    \"\"\"\n    Generate the set of integer 2D wavevectors (kx, ky) with 0 < kx^2 + ky^2 <= kmax^2.\n    Returns both a list (for ordered iteration) and a set (for O(1) membership).\n    \"\"\"\n    modes_list = []\n    r2_max = kmax * kmax\n    # Iterate over square box [-kmax, kmax]^2\n    for kx in range(-kmax, kmax + 1):\n        for ky in range(-kmax, kmax + 1):\n            if kx == 0 and ky == 0:\n                continue  # exclude zero mode\n            r2 = kx * kx + ky * ky\n            if r2 <= r2_max:\n                modes_list.append((kx, ky))\n    modes_set = set(modes_list)\n    return modes_list, modes_set\n\ndef enumerate_triads(kmax: int):\n    \"\"\"\n    Enumerate all unique unordered triads {k, p, q} such that k = p + q,\n    with k, p, q in the admissible set S(kmax).\n    Returns:\n      T: number of unique triads\n      M: number of admissible modes\n      P: number of unordered pairs checked (= M*(M+1)//2)\n    \"\"\"\n    modes_list, modes_set = generate_modes(kmax)\n    M = len(modes_list)\n    # Number of unordered pairs including p = q\n    P = M * (M + 1) // 2\n\n    triads_set = set()  # store canonical triads as sorted tuples of 2D tuples\n\n    # Iterate over unordered pairs (i <= j)\n    for i in range(M):\n        p = modes_list[i]\n        for j in range(i, M):\n            q = modes_list[j]\n            k = (p[0] + q[0], p[1] + q[1])\n            if k in modes_set:\n                # Canonicalize unordered triad by sorting lexicographically\n                triad = tuple(sorted((k, p, q)))\n                triads_set.add(triad)\n\n    T = len(triads_set)\n    return T, M, P\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [0, 1, 2, 3, 4]\n\n    results = []\n    for kmax in test_cases:\n        T, M, P = enumerate_triads(kmax)\n        results.append([T, M, P])\n\n    # Final print statement in the exact required format.\n    # A single line, comma-separated lists enclosed in square brackets.\n    print(f\"[{','.join(str(r) for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Finally, we elevate our perspective from the mechanics of individual triads to the statistical physics of a complete turbulent system. Statistical mechanics predicts that a conservative system in thermal equilibrium should exhibit no net flux of conserved quantities—a state of detailed balance. This numerical experiment bridges the microscopic dynamics of triad interactions with the macroscopic principles of statistical equilibrium, tasking you to verify this foundational concept and observe how it breaks down when conservation laws are violated .",
            "id": "4207738",
            "problem": "Consider a conservative quadratic nonlinear system truncated in spectral space whose dynamics are governed by triad interactions. As a proxy for drift-wave-like triadic interactions in fusion plasma turbulence, adopt the Sabra shell model, a spectrally local triad system defined on shells with wavenumbers $k_n = k_0 \\lambda^n$ for integer shell index $n \\in \\{0,1,\\dots,N-1\\}$, geometric factor $\\lambda > 1$, and base wavenumber $k_0 > 0$. Let the complex shell amplitudes be $u_n(t) \\in \\mathbb{C}$. The inviscid truncated dynamics are\n$$\n\\frac{d u_n}{d t} = i \\left( a\\, k_{n+1}\\, u_{n+1}\\, u_{n+2}^\\ast \\;+\\; b\\, k_n\\, u_{n-1}\\, u_{n+1}^\\ast \\;+\\; c\\, k_{n-1}\\, u_{n-1}\\, u_{n-2} \\right),\n$$\nwith the convention that any term referencing an out-of-range shell index is set to zero, and where $a$, $b$, $c \\in \\mathbb{R}$ are constant coefficients. The total energy is\n$$\nE(t) = \\frac{1}{2} \\sum_{n=0}^{N-1} |u_n(t)|^2,\n$$\nwhich is conserved if and only if $a + b + c = 0$. The instantaneous nonlinear energy transfer into shell $n$ is\n$$\nT_n(t) = \\operatorname{Re}\\left[ u_n^\\ast(t)\\, \\mathcal{N}_n(t) \\right],\n$$\nwhere $\\mathcal{N}_n(t)$ denotes the right-hand side of the nonlinear term in the evolution equation. The cumulative energy flux across a shell cutoff $m$ is defined by\n$$\n\\Pi_m(t) = -\\sum_{n=0}^{m} T_n(t),\n$$\nwhich measures the net nonlinear transfer from shells with index $n \\le m$ to shells with index $n > m$. A system initialized near absolute equilibrium is one in which the initial amplitudes are sampled from the canonical Gibbs distribution associated with the quadratic invariant $E$, namely\n$$\nP(\\{u_n\\}) \\propto \\exp\\left( -\\beta \\sum_{n=0}^{N-1} \\frac{|u_n|^2}{2} \\right),\n$$\nso that $u_n(0)$ are independent complex Gaussian random variables with zero mean and variance $\\sigma^2 = 1/\\beta$.\n\nYour task is to design and implement a numerical test, in dimensionless units, that initializes the system near absolute equilibrium and confirms that the measured triad transfers fluctuate around zero with no persistent flux. Specifically:\n\n- Implement the inviscid truncated Sabra shell model with the triad form above. Use a fixed-step explicit integrator. Ensure reproducibility by fixing the random seed.\n- For each test case, initialize $u_n(0)$ as independent complex Gaussian random variables with zero mean and variance $\\sigma^2$, i.e., $u_n(0) \\sim \\mathcal{N}(0,\\sigma^2/2) + i\\,\\mathcal{N}(0,\\sigma^2/2)$, which realizes the canonical distribution with parameter $\\beta = 1/\\sigma^2$.\n- Evolve the system and compute the time series $\\Pi_m(t)$ for two cutoffs $m$ within the inertial range: $m_1 = \\lfloor N/3 \\rfloor$ and $m_2 = \\lfloor 2N/3 \\rfloor$.\n- For each cutoff, compute the time-average $\\overline{\\Pi}_m$ and the standard deviation $S_m$ over the simulation. Define the “no persistent flux” condition as $|\\overline{\\Pi}_m| \\le \\epsilon + \\rho\\, S_m$ with $\\epsilon$ a small absolute tolerance and $\\rho$ a small relative tolerance factor. A test case passes if this condition is satisfied for both $m_1$ and $m_2$.\n\nUse the following dimensionless test suite of parameter values:\n\n- Case $1$ (happy path): $N = 12$, $\\lambda = 1.618$, $k_0 = 1$, $(a,b,c) = (1, -\\tfrac{1}{2}, -\\tfrac{1}{2})$, $\\sigma = 1$, time step $\\Delta t = 10^{-3}$, number of steps $4000$, tolerances $\\epsilon = 10^{-6}$, $\\rho = 0.05$.\n- Case $2$ (boundary shell count): $N = 6$, $\\lambda = 1.5$, $k_0 = 1$, $(a,b,c) = (1, -\\tfrac{1}{2}, -\\tfrac{1}{2})$, $\\sigma = 1$, time step $\\Delta t = 10^{-3}$, number of steps $3000$, tolerances $\\epsilon = 10^{-6}$, $\\rho = 0.05$.\n- Case $3$ (strong amplitude): $N = 12$, $\\lambda = 1.5$, $k_0 = 1$, $(a,b,c) = (1, -\\tfrac{1}{2}, -\\tfrac{1}{2})$, $\\sigma = 3$, time step $\\Delta t = 5\\times 10^{-4}$, number of steps $3000$, tolerances $\\epsilon = 10^{-6}$, $\\rho = 0.05$.\n- Case $4$ (broken conservation, edge case): $N = 12$, $\\lambda = 1.618$, $k_0 = 1$, $(a,b,c) = (1, -0.4, -0.5)$, $\\sigma = 1$, time step $\\Delta t = 10^{-3}$, number of steps $4000$, tolerances $\\epsilon = 10^{-6}$, $\\rho = 0.05$.\n\nFor each case, evaluate the “no persistent flux” condition for both cutoffs and return a boolean indicating whether both cutoffs satisfy the condition. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[{\\rm True},{\\rm False},{\\rm True},{\\rm True}]$). No physical units are required because the model is nondimensional by construction. Angles do not appear, and all values must be reported as booleans in the specified format.",
            "solution": "The user wants to validate a numerical test for triad interactions in a Sabra shell model, which is used as a proxy for fusion plasma turbulence.\n\n### Step 1: Extract Givens\n\n-   **Model**: Inviscid truncated Sabra shell model.\n-   **Shell Wavenumbers**: $k_n = k_0 \\lambda^n$ for shell index $n \\in \\{0, 1, \\dots, N-1\\}$, with $k_0 > 0$ and $\\lambda > 1$.\n-   **State Variables**: Complex shell amplitudes $u_n(t) \\in \\mathbb{C}$.\n-   **Evolution Equation**:\n    $$\n    \\frac{d u_n}{d t} = i \\left( a\\, k_{n+1}\\, u_{n+1}\\, u_{n+2}^\\ast \\;+\\; b\\, k_n\\, u_{n-1}\\, u_{n+1}^\\ast \\;+\\; c\\, k_{n-1}\\, u_{n-1}\\, u_{n-2} \\right)\n    $$\n-   **Boundary Conditions**: Any term that references an out-of-range shell index (i.e., $<0$ or $\\ge N$) is set to zero.\n-   **Model Coefficients**: $a, b, c$ are real constants.\n-   **Total Energy**: $E(t) = \\frac{1}{2} \\sum_{n=0}^{N-1} |u_n(t)|^2$.\n-   **Energy Conservation**: The total energy $E(t)$ is a conserved quantity if and only if $a + b + c = 0$.\n-   **Nonlinear Energy Transfer**: The instantaneous energy transfer into shell $n$ is $T_n(t) = \\operatorname{Re}\\left[ u_n^\\ast(t)\\, \\mathcal{N}_n(t) \\right]$, where $\\mathcal{N}_n(t)$ is the entire right-hand side of the evolution equation for $u_n$.\n-   **Cumulative Energy Flux**: The flux across shell cutoff $m$ is $\\Pi_m(t) = -\\sum_{n=0}^{m} T_n(t)$.\n-   **Initial Conditions**: The system is initialized near absolute equilibrium. The initial amplitudes $u_n(0)$ are independent complex Gaussian random variables with zero mean and variance $\\sigma^2$. This is realized as $u_n(0) \\sim \\mathcal{N}(0,\\sigma^2/2) + i\\,\\mathcal{N}(0,\\sigma^2/2)$.\n-   **Numerical Method**: A fixed-step explicit integrator is to be used. Reproducibility must be ensured by fixing the random seed.\n-   **Measurement Task**:\n    1.  Evolve the system over a specified number of time steps.\n    2.  Compute the time series of the flux $\\Pi_m(t)$ for two cutoffs: $m_1 = \\lfloor N/3 \\rfloor$ and $m_2 = \\lfloor 2N/3 \\rfloor$.\n    3.  For each cutoff $m$, calculate the time-average $\\overline{\\Pi}_m$ and standard deviation $S_m$ of the flux time series.\n    4.  A test case passes if the \"no persistent flux\" condition, $|\\overline{\\Pi}_m| \\le \\epsilon + \\rho\\, S_m$, is met for both $m_1$ and $m_2$.\n\n-   **Test Suite**:\n    -   **Case 1**: $N = 12$, $\\lambda = 1.618$, $k_0 = 1$, $(a,b,c) = (1, -0.5, -0.5)$, $\\sigma = 1$, $\\Delta t = 10^{-3}$, number of steps $= 4000$, $\\epsilon = 10^{-6}$, $\\rho = 0.05$.\n    -   **Case 2**: $N = 6$, $\\lambda = 1.5$, $k_0 = 1$, $(a,b,c) = (1, -0.5, -0.5)$, $\\sigma = 1$, $\\Delta t = 10^{-3}$, number of steps $= 3000$, $\\epsilon = 10^{-6}$, $\\rho = 0.05$.\n    -   **Case 3**: $N = 12$, $\\lambda = 1.5$, $k_0 = 1$, $(a,b,c) = (1, -0.5, -0.5)$, $\\sigma = 3$, $\\Delta t = 5 \\times 10^{-4}$, number of steps $= 3000$, $\\epsilon = 10^{-6}$, $\\rho = 0.05$.\n    -   **Case 4**: $N = 12$, $\\lambda = 1.618$, $k_0 = 1$, $(a,b,c) = (1, -0.4, -0.5)$, $\\sigma = 1$, $\\Delta t = 10^{-3}$, number of steps $= 4000$, $\\epsilon = 10^{-6}$, $\\rho = 0.05$.\n\n-   **Output Format**: A single line with a list of booleans: `[result1,result2,result3,result4]`.\n\n### Step 2: Validate Using Extracted Givens\n\n1.  **Scientifically Grounded**: The problem is based on the Sabra shell model, which is a standard and well-accepted reduced model in the field of fluid and plasma turbulence. The concepts of triadic interaction, spectral energy transfer, statistical equilibrium, and the Gibbs distribution for quadratic invariants are fundamental principles in statistical mechanics and turbulence theory. The problem is scientifically sound.\n2.  **Well-Posed**: The problem provides a complete mathematical description of the system, including the governing equations, all necessary parameters for each test case, precisely defined initial conditions, and a clear, quantitative criterion for success. The task is to perform a numerical simulation and a subsequent check, which is a well-defined procedure.\n3.  **Objective**: The problem is stated in precise, objective, and mathematical language. There are no subjective or ambiguous terms. The test cases and the pass/fail condition are defined rigorously.\n\nThe problem passes all validation checks. It is a complete, consistent, and scientifically valid problem that can be solved as stated.\n\n### Step 3: Verdict and Action\n\nThe problem is valid. I will proceed to design and implement the solution.\n\n### Principle-Based Design\n\nThe core of the problem is to simulate the time evolution of a system of coupled ordinary differential equations (ODEs) and analyze the statistical properties of the resulting energy fluxes.\n\n**1. System Representation and Initialization**\nThe state of the system at any time $t$ is given by the vector of complex amplitudes $\\vec{u}(t) = [u_0, u_1, \\dots, u_{N-1}]$. The model parameters such as wavenumbers $k_n$ are pre-calculated and stored. Initial conditions $u_n(0)$ are drawn from a complex normal distribution to simulate the canonical equilibrium state. This is achieved by generating independent real and imaginary parts from a Gaussian distribution $\\mathcal{N}(0, \\sigma^2/2)$. For reproducibility, the pseudo-random number generator is seeded with a fixed integer.\n\n**2. Time Integration**\nThe problem specifies a fixed-step explicit integrator. The forward Euler method is the simplest such choice:\n$$ u_n(t+\\Delta t) = u_n(t) + \\Delta t \\, \\frac{du_n}{dt}(t) $$\nwhere $\\frac{du_n}{dt}$ is the right-hand side (RHS) of the evolution equation. Given the small time steps and limited integration periods specified, this method is adequate for the task.\n\n**3. Computing the Nonlinear Term (RHS)**\nThe RHS, $\\mathcal{N}_n = \\frac{du_n}{dt}$, consists of three terms, each representing a triad interaction. Naively, this would be implemented with a loop over the shells $n \\in \\{0, \\dots, N-1\\}$. For each $n$, boundary checks (`if n+2 < N`, etc.) are required to handle the out-of-range indices. A more efficient, vectorized implementation using `numpy` array slicing can compute the RHS for all shells simultaneously. For each of the three interaction types, we can define slices of the state vector $\\vec{u}$ that correspond to the indices $(n-2, n-1, n, n+1, n+2)$ and perform the multiplications element-wise over the valid range of $n$. For instance, the first term $a k_{n+1} u_{n+1} u_{n+2}^\\ast$ can be calculated for all applicable $n$ (from $0$ to $N-3$) by `a * k[1:-1] * u[1:-1] * np.conj(u[2:])`. Similar expressions are constructed for the other two terms.\n\n**4. Calculating Transfers and Fluxes**\nAt each time step, after computing the RHS $\\mathcal{N_n} = \\frac{du_n}{dt}$, the energy transfer into each shell is calculated as $T_n = \\operatorname{Re}[u_n^* \\mathcal{N}_n]$. The cumulative flux $\\Pi_m(t)$ is then the negative sum of these transfers up to the cutoff index $m$.\n$$ \\Pi_m(t) = -\\sum_{n=0}^{m} T_n(t) $$\nThe time series for $\\Pi_{m_1}(t)$ and $\\Pi_{m_2}(t)$ are stored for post-simulation analysis.\n\n**5. Statistical Analysis and Verification**\nAfter the simulation completes, the time series of $\\Pi_{m_1}$ and $\\Pi_{m_2}$ are analyzed. The key insight is that for a system in thermal equilibrium (as set by the initial conditions) with a conserved energy ($a+b+c=0$), there should be no net, persistent flow of energy between different scales. The flux $\\Pi_m(t)$ should fluctuate around a mean of zero. The test condition $|\\overline{\\Pi}_m| \\le \\epsilon + \\rho\\, S_m$ formalizes this expectation. It asserts that the measured time-average of the flux, $\\overline{\\Pi}_m$, should be statistically indistinguishable from zero, allowing for a small absolute tolerance $\\epsilon$ and a tolerance proportional to the magnitude of the fluctuations, $S_m$.\n\nFor cases 1, 2, and 3, where $a+b+c=0$, the system anserves energy and is initialized in equilibrium. We expect the \"no persistent flux\" condition to be met, and these tests should pass. For case 4, $a+b+c=0.1 \\neq 0$, so energy is not conserved. The fundamental assumption for absolute equilibrium is violated. The system will likely develop a systematic energy drain or source, leading to a non-zero average flux. Thus, this case is expected to fail the test.\n\nThe implementation will encapsulate this logic, iterating through each test case, performing the simulation, and evaluating the pass/fail condition.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(N, lam, k0, a, b, c, sigma, dt, num_steps, eps, rho):\n    \"\"\"\n    Runs a single simulation of the Sabra shell model and checks the 'no persistent flux' condition.\n    \"\"\"\n    # Fix the random seed for reproducibility. Note: The problem asks for a fixed seed\n    # but does not specify one. We use a constant seed for all test cases.\n    rng = np.random.default_rng(seed=0)\n\n    # Define shell cutoffs for flux calculation\n    m1 = N // 3\n    m2 = 2 * N // 3\n\n    # Initialize wavenumbers and complex shell amplitudes\n    k = k0 * lam**np.arange(N)\n    u = (rng.normal(size=N, scale=sigma/np.sqrt(2)) + \n         1j * rng.normal(size=N, scale=sigma/np.sqrt(2)))\n\n    pi_m1_history = np.zeros(num_steps)\n    pi_m2_history = np.zeros(num_steps)\n\n    # Time integration loop\n    for i in range(num_steps):\n        # Calculate the nonlinear RHS (dudt) in a vectorized manner\n        dudt = np.zeros(N, dtype=np.complex128)\n        \n        # Term 1: a * k_{n+1} * u_{n+1} * u_{n+2}^*\n        # Valid for n from 0 to N-3\n        if N > 2:\n            dudt[:-2] += a * k[1:-1] * u[1:-1] * np.conj(u[2:])\n        \n        # Term 2: b * k_n * u_{n-1} * u_{n+1}^*\n        # Valid for n from 1 to N-2\n        if N > 2:\n            dudt[1:-1] += b * k[1:-1] * u[:-2] * np.conj(u[2:])\n            \n        # Term 3: c * k_{n-1} * u_{n-1} * u_{n-2}\n        # Valid for n from 2 to N-1\n        if N > 2:\n            dudt[2:] += c * k[1:-1] * u[1:-1] * u[:-2]\n            \n        dudt *= 1j\n\n        # Calculate instantaneous energy transfer T_n\n        T = np.real(np.conj(u) * dudt)\n        \n        # Calculate cumulative energy flux Pi_m\n        pi_m1_history[i] = -np.sum(T[0:m1+1])\n        pi_m2_history[i] = -np.sum(T[0:m2+1])\n        \n        # Update shell amplitudes using Forward Euler\n        u += dt * dudt\n\n    # Analyze the flux time series\n    avg1 = np.mean(pi_m1_history)\n    std1 = np.std(pi_m1_history)\n    \n    avg2 = np.mean(pi_m2_history)\n    std2 = np.std(pi_m2_history)\n    \n    # Check the 'no persistent flux' condition for both cutoffs\n    pass1 = np.abs(avg1) <= eps + rho * std1\n    pass2 = np.abs(avg2) <= eps + rho * std2\n    \n    return pass1 and pass2\n\ndef solve():\n    \"\"\"\n    Defines test cases and runs the simulation for each, printing the results.\n    \"\"\"\n    test_cases = [\n        # Case 1: Happy path\n        {'N': 12, 'lam': 1.618, 'k0': 1.0, 'a': 1.0, 'b': -0.5, 'c': -0.5, \n         'sigma': 1.0, 'dt': 1e-3, 'num_steps': 4000, 'eps': 1e-6, 'rho': 0.05},\n        # Case 2: Boundary shell count\n        {'N': 6, 'lam': 1.5, 'k0': 1.0, 'a': 1.0, 'b': -0.5, 'c': -0.5, \n         'sigma': 1.0, 'dt': 1e-3, 'num_steps': 3000, 'eps': 1e-6, 'rho': 0.05},\n        # Case 3: Strong amplitude\n        {'N': 12, 'lam': 1.5, 'k0': 1.0, 'a': 1.0, 'b': -0.5, 'c': -0.5, \n         'sigma': 3.0, 'dt': 5e-4, 'num_steps': 3000, 'eps': 1e-6, 'rho': 0.05},\n        # Case 4: Broken conservation\n        {'N': 12, 'lam': 1.618, 'k0': 1.0, 'a': 1.0, 'b': -0.4, 'c': -0.5, \n         'sigma': 1.0, 'dt': 1e-3, 'num_steps': 4000, 'eps': 1e-6, 'rho': 0.05},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(**case)\n        results.append(result)\n\n    # Format the output as a string representation of a list of booleans\n    # np.bool_ is used to get lowercase true/false\n    formatted_results = [str(np.bool_(r)).lower() for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}