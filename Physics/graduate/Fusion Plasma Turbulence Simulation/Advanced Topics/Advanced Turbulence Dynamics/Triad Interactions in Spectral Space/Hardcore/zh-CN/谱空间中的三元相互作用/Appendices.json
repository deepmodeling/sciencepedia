{
    "hands_on_practices": [
        {
            "introduction": "在湍流的光谱模拟中，二次非线性项导致了傅里叶模式之间的耦合。这些耦合通过三波（triad）相互作用来描述。本篇实践将为您提供一个计算基础，要求您设计一个算法，系统地识别出离散二维谱域内所有可能的共振三波组合，这是构建任何谱方法湍流代码的关键第一步。",
            "id": "4207745",
            "problem": "您的任务是设计并实现一个算法，用于枚举二维周期性域中所有与聚变等离子体湍流模拟中的非线性模式耦合相关的谱三元组。从场论的傅里叶表示和二次非线性项的卷积性质等第一性原理和核心定义出发。利用这些原理来阐明谱空间中三元组条件的合理性，并设计一种计算策略及其复杂度分析。\n\n假设一个边长为 $2\\pi$ 的方形周期性域，因此傅里叶波矢为整数对 $k = (k_x, k_y)$，其中 $k_x \\in \\mathbb{Z}$ 且 $k_y \\in \\mathbb{Z}$。设 $k_{\\max} \\in \\mathbb{N}$ 定义最大波数截断。容许的非零模式集合定义为\n$$\n\\mathcal{S}(k_{\\max}) = \\left\\{ (k_x,k_y) \\in \\mathbb{Z}^2 \\setminus \\{(0,0)\\} \\;\\middle|\\; k_x^2 + k_y^2 \\le k_{\\max}^2 \\right\\}.\n$$\n在谱空间中，一个三元组是一个无序三元组 $\\{k,p,q\\} \\subset \\mathcal{S}(k_{\\max})$，它满足共振条件\n$$\nk = p + q,\n$$\n其中 $p$ 和 $q$ 是 $\\mathcal{S}(k_{\\max})$ 中的元素，求和是按分量进行的。该三元组被认为是无序的：$(k,p,q)$ 的任何排列都代表同一个三元组。零模式 $(0,0)$ 被排除在 $\\mathcal{S}(k_{\\max})$ 之外，并且在 $2p \\in \\mathcal{S}(k_{\\max})$ 的条件下，允许 $p=q$ 的退化对。\n\n从傅里叶变换将实空间中的乘积映射到谱空间中的卷积这一基本事实出发，推导出三元组条件，然后设计一个算法，该算法能够：\n- 构建 $\\mathcal{S}(k_{\\max})$。\n- 枚举所有满足 $k = p + q$ 且 $k,p,q \\in \\mathcal{S}(k_{\\max})$ 的唯一无序三元组 $\\{k,p,q\\}$。\n- 避免因 $(k,p,q)$ 的排列而重复计数同一个三元组。\n\n根据容许模式的数量 $M = \\left|\\mathcal{S}(k_{\\max})\\right|$ 和参数 $k_{\\max}$ 来分析您的算法的计算复杂度，并为您的复杂度类别提供清晰的推理。用大$\\mathcal{O}$表示法表达您的复杂度分析，并证明任何假设（例如恒定时间的集合成员资格查询）的合理性。\n\n您的程序必须实现该算法，并针对一组给定的 $k_{\\max}$ 值测试套件，为每种情况计算：\n- 您的算法找到的唯一无序三元组的数量 $T$。\n- 容许模式的数量 $M$。\n- 检查的无序模式对的数量 $P$，其中模式对包括 $p=q$ 并且被视为无序的，因此 $P = M(M+1)/2$。\n\n测试套件：\n- 情况 1：$k_{\\max} = 0$。\n- 情况 2：$k_{\\max} = 1$。\n- 情况 3：$k_{\\max} = 2$。\n- 情况 4：$k_{\\max} = 3$。\n- 情况 5：$k_{\\max} = 4$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含五个测试用例的结果，格式为逗号分隔的列表的列表，具体形式如下\n$$\n\\left[ [T_1,M_1,P_1],[T_2,M_2,P_2],[T_3,M_3,P_3],[T_4,M_4,P_4],[T_5,M_5,P_5] \\right].\n$$\n此问题不需要物理单位或角度单位。所有计算输出必须是整数。程序必须是完全自包含的，并且不需要用户输入。",
            "solution": "该任务的动机源于类流体等离子体模型谱表示中二次非线性项的卷积结构。考虑一个在边长为 $2\\pi$ 的二维周期性正方形上定义的标量场 $\\phi(x,y,t)$。其傅里叶级数为\n$$\n\\phi(x,y,t) = \\sum_{k \\in \\mathbb{Z}^2} \\hat{\\phi}_k(t) \\, e^{i(k_x x + k_y y)}.\n$$\n对于具有二次非线性项的模型，例如二维不可压缩流中的平流非线性项或漂移波湍流中的泊松括号非线性项，典型的非线性项涉及实空间中场（或其导数）的乘积。根据卷积定理，乘积的傅里叶变换会变成一个卷积。对于两个傅里叶系数为 $\\hat{\\phi}_k$ 和 $\\hat{\\psi}_k$ 的场 $\\phi$ 和 $\\psi$，它们乘积在模式 $k$ 处的傅里叶系数为\n$$\n\\widehat{(\\phi \\psi)}_k = \\sum_{p \\in \\mathbb{Z}^2} \\hat{\\phi}_p \\, \\hat{\\psi}_{k-p}.\n$$\n求和遍历所有整数波矢 $p$，而 $q = k - p$ 是另一个波矢。这表明在 $k$ 处的谱系数与满足 $p + q = k$ 的波矢对 $(p,q)$ 耦合。在湍流系统中，非线性能量传输源于这些三元组相互作用。因此，三元组条件\n$$\nk = p + q\n$$\n是基础，由三个参与的波矢 $\\{k,p,q\\}$ 组成的集合定义了一个三元组。\n\n受数值模拟的启发，我们将谱域限制在一个有限集合内：我们只考虑满足 $k_x^2 + k_y^2 \\le k_{\\max}^2$ 的整数波矢 $(k_x,k_y)$，并排除零模式。这个集合是\n$$\n\\mathcal{S}(k_{\\max}) = \\left\\{ (k_x,k_y) \\in \\mathbb{Z}^2 \\setminus \\{(0,0)\\} \\;\\middle|\\; k_x^2 + k_y^2 \\le k_{\\max}^2 \\right\\}.\n$$\n容许模式的数量为 $M = \\left|\\mathcal{S}(k_{\\max})\\right|$。随着 $k_{\\max}$ 的增长，$M$ 的规模与半径为 $k_{\\max}$ 的圆盘内的整数格点数量相当，渐近地满足\n$$\nM \\sim \\pi k_{\\max}^2 \\quad \\text{as } k_{\\max} \\to \\infty,\n$$\n不考虑边界效应。\n\n算法设计：\n1. 通过在 $-k_{\\max}$ 到 $k_{\\max}$ 的范围内迭代整数 $k_x$ 和 $k_y$ 来构建 $\\mathcal{S}(k_{\\max})$，排除 $(0,0)$，并保留那些满足 $k_x^2 + k_y^2 \\le k_{\\max}^2$ 的波矢。将该集合同时存储为用于有序迭代的列表和用于 $O(1)$ 平均时间成员资格查询的哈希集合（例如，Python中的元组集合）。\n2. 从 $\\mathcal{S}(k_{\\max})$ 中枚举无序对 $(p,q)$，包括退化情况 $p = q$。对于长度为 $M$ 的模式列表，使用索引 $i$ 和 $j$，其中 $0 \\le i \\le j < M$。所考虑的无序对总数为\n   $$\n   P = \\frac{M(M+1)}{2}.\n   $$\n3. 对于每对 $(p,q)$，通过分量相加计算 $k = p + q$，并检查 $k$ 是否在 $\\mathcal{S}(k_{\\max})$ 中。如果为真，则三元组 $(k,p,q)$ 满足三元组条件。因为三元组是无序的，所以同一个三元组也可能由其他对的和（如 $(q,k)$ 和 $(k,p)$）产生。为避免重复计数，通过按固定的字典序对三个向量排序来规范化三元组 $\\{k,p,q\\}$，并将得到的有序三元组插入到一个三元组的哈希集合中。这确保了每个无序三元组只被计数一次。\n4. 对于每个 $k_{\\max}$，输出是唯一三元组的数量 $T$、模式的数量 $M$ 以及检查的对的数量 $P$。\n\n复杂度分析：\n- 构建 $\\mathcal{S}(k_{\\max})$ 需要检查正方形 $[-k_{\\max},k_{\\max}]^2$ 中的所有整数对 $(k_x,k_y)$，该区域有 $(2k_{\\max}+1)^2$ 个点。建立集合的时间为 $O(k_{\\max}^2)$，这与 $M = O(k_{\\max}^2)$ 一致，空间复杂度为 $O(M)$。\n- 枚举所有无序对 $(p,q)$ 需要 $P = M(M+1)/2 = O(M^2)$ 次迭代。对于每一对，计算 $k = p + q$ 和在哈希集合中检查成员资格的平均时间为 $O(1)$。对三元组进行规范化并插入三元组集合的哈希操作平均时间为 $O(1)$（因为排序三个元素是常数大小，所以是 $O(1)$）。\n- 因此，总时间复杂度为\n  $$\n  O(M^2),\n  $$\n  空间复杂度为\n  $$\n  O(M + T),\n  $$\n  其中 $T$ 是找到的唯一三元组的数量，且 $T \\le P$。\n- 就 $k_{\\max}$ 而言，使用 $M = \\Theta(k_{\\max}^2)$ 得出总体时间复杂度为 $O(k_{\\max}^4)$。\n\n正确性论证：\n- 谱空间中的卷积性质要求，对模式 $k$ 的非线性耦合来自于满足 $p + q = k$ 的波矢对 $(p,q)$。通过在 $\\mathcal{S}(k_{\\max})$ 上枚举所有这样的对并收集无序三元组，可以确保找到所有与共振条件一致的三元组。\n- 排除 $(0,0)$ 避免了通过零模式的平凡耦合，这符合典型的模拟实践。允许 $p = q$ 确保了包含满足 $k = 2p$ 的有效退化三元组。\n- 通过排序进行规范化消除了 $(k,p,q)$ 之间的排列模糊性，从而得出了一个明确定义的无序三元组计数。\n\n测试套件和输出：\n- 对于 $k_{\\max} \\in \\{0,1,2,3,4\\}$，程序构建 $\\mathcal{S}(k_{\\max})$，枚举三元组，并打印单行\n  $$\n  \\left[ [T_1,M_1,P_1],[T_2,M_2,P_2],[T_3,M_3,P_3],[T_4,M_4,P_4],[T_5,M_5,P_5] \\right],\n  $$\n  其中 $T_i$ 是三元组计数，$M_i$ 是模式计数，$P_i = M_i(M_i+1)/2$ 是情况 $i$ 的对计数。所有值都必须是整数。\n\n这种方法在科学上是现实的，其算法基础是基本的卷积性质，能够产生一种高效的枚举方法，该方法与聚变等离子体湍流模拟（如漂移波模型和回旋流体模型）中使用的谱非线性项的典型结构相一致。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef generate_modes(kmax: int):\n    \"\"\"\n    Generate the set of integer 2D wavevectors (kx, ky) with 0  kx^2 + ky^2 = kmax^2.\n    Returns both a list (for ordered iteration) and a set (for O(1) membership).\n    \"\"\"\n    modes_list = []\n    r2_max = kmax * kmax\n    # Iterate over square box [-kmax, kmax]^2\n    for kx in range(-kmax, kmax + 1):\n        for ky in range(-kmax, kmax + 1):\n            if kx == 0 and ky == 0:\n                continue  # exclude zero mode\n            r2 = kx * kx + ky * ky\n            if r2 = r2_max:\n                modes_list.append((kx, ky))\n    modes_set = set(modes_list)\n    return modes_list, modes_set\n\ndef enumerate_triads(kmax: int):\n    \"\"\"\n    Enumerate all unique unordered triads {k, p, q} such that k = p + q,\n    with k, p, q in the admissible set S(kmax).\n    Returns:\n      T: number of unique triads\n      M: number of admissible modes\n      P: number of unordered pairs checked (= M*(M+1)//2)\n    \"\"\"\n    modes_list, modes_set = generate_modes(kmax)\n    M = len(modes_list)\n    # Number of unordered pairs including p = q\n    P = M * (M + 1) // 2\n\n    triads_set = set()  # store canonical triads as sorted tuples of 2D tuples\n\n    # Iterate over unordered pairs (i = j)\n    for i in range(M):\n        p = modes_list[i]\n        for j in range(i, M):\n            q = modes_list[j]\n            k = (p[0] + q[0], p[1] + q[1])\n            if k in modes_set:\n                # Canonicalize unordered triad by sorting lexicographically\n                triad = tuple(sorted((k, p, q)))\n                triads_set.add(triad)\n\n    T = len(triads_set)\n    return T, M, P\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [0, 1, 2, 3, 4]\n\n    results = []\n    for kmax in test_cases:\n        T, M, P = enumerate_triads(kmax)\n        results.append([T, M, P])\n\n    # Final print statement in the exact required format.\n    # A single line, comma-separated lists enclosed in square brackets.\n    print(f\"[{','.join(str(r) for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "识别出三波组合后，下一步是理解它们的动力学行为。本练习聚焦于一个孤立的相互作用三波的简化模型，其演化由一组常微分方程控制。通过实现一个特殊的数值积分器，您将验证能量和Manley-Rowe关系等物理不变量的守恒性，从而凸显数值方法与在长时间模拟中保持基本物理原理之间的关键联系。",
            "id": "4207771",
            "problem": "将谱空间中的三波相互作用视为一个简化模型，该模型描述了聚变等离子体湍流中代表共振相互作用漂移波模式的三个复傅里叶振幅之间的二次非线性耦合。设复振幅为 $a_1(t)$、$a_2(t)$ 和 $a_3(t)$，实耦合系数为 $\\kappa \\in \\mathbb{R}$。控制常微分方程 (ODE) 为\n$$\n\\frac{d a_1}{dt} = i\\,\\kappa\\, a_2^*(t)\\, a_3^*(t), \\quad\n\\frac{d a_2}{dt} = i\\,\\kappa\\, a_1^*(t)\\, a_3^*(t), \\quad\n\\frac{d a_3}{dt} = i\\,\\kappa\\, a_1^*(t)\\, a_2^*(t),\n$$\n其中 $i$ 是虚数单位，${}^*$ 表示复共轭。该系统拥有被称为 Manley–Rowe 不变量的二次不变量，定义为\n$$\nI_{12}(t) = |a_1(t)|^2 - |a_2(t)|^2, \\quad I_{13}(t) = |a_1(t)|^2 - |a_3(t)|^2,\n$$\n以及一个哈密顿能量\n$$\nH(t) = \\kappa\\left(a_1(t)\\,a_2(t)\\,a_3(t) + a_1^*(t)\\,a_2^*(t)\\,a_3^*(t)\\right).\n$$\n对于精确积分，$I_{12}(t)$、$I_{13}(t)$ 和 $H(t)$ 是不随时间变化的常数。\n\n您需要实现一个离散时间步进格式，该格式旨在在长时间积分中保持这些不变量守恒。使用在三波中共享平均值的隐式中点法，定义为\n$$\na_j^{n+1} - a_j^n = i\\,\\kappa\\,\\Delta t\\,\\left(\\overline{a_m^{\\mathrm{avg}}}\\right)\\left(\\overline{a_n^{\\mathrm{avg}}}\\right), \\quad j \\in \\{1,2,3\\},\n$$\n其中，对于从 $n \\to n+1$ 的每个时间步，\n$$\na_j^{\\mathrm{avg}} = \\frac{1}{2}\\left(a_j^{n+1} + a_j^{n}\\right),\n$$\n且 $\\{j,m,n\\} = \\{1,2,3\\}$ 循环置换，因此 $a_1$ 的更新使用 $a_2^{\\mathrm{avg}}$ 和 $a_3^{\\mathrm{avg}}$，对于 $a_2$ 和 $a_3$ 也类似。该格式是隐式的，必须在每个时间步就 $\\left(a_1^{n+1}, a_2^{n+1}, a_3^{n+1}\\right)$ 求解，例如，使用不动点迭代法和一个足够小的时间步长 $\\Delta t$。\n\n从上述定义和关于哈密顿系统中二次不变量的经过充分检验的事实出发，从第一性原理推导这些不变量，并证明在中点格式下它们的守恒性。然后实现该格式，并通过追踪 $I_{12}$、$I_{13}$ 和 $H$ 在整个积分时间内相对于其初始值的最大绝对漂移，利用一个人为构造的三波解来数值验证其守恒性。\n\n您的程序必须为每个测试用例执行以下操作：\n- 使用均匀时间步长 $\\Delta t$ 和上述隐式中点法，从 $t=0$ 积分到 $t=T$。\n- 在每一步计算 $I_{12}(t)$、$I_{13}(t)$ 和 $H(t)$，并追踪相对于它们在 $t=0$ 时的初始值的最大绝对漂移：\n$$\nD_{12} = \\max_{0 \\le n \\le N} \\left|I_{12}^n - I_{12}^0\\right|,\\quad\nD_{13} = \\max_{0 \\le n \\le N} \\left|I_{13}^n - I_{13}^0\\right|,\\quad\nD_H = \\max_{0 \\le n \\le N} \\left|H^n - H^0\\right|,\n$$\n其中 $N = T/\\Delta t$ 是时间步数。\n- 如果对于给定的容差 $\\varepsilon_I$ 和 $\\varepsilon_H$，满足 $D_{12} \\le \\varepsilon_I$、$D_{13} \\le \\varepsilon_I$ 和 $D_H \\le \\varepsilon_H$，则宣称不变量在数值上是守恒的。\n\n使用以下测试套件，其选择旨在覆盖一般情况、刚性情况和涉及振幅消失的边界情况：\n1. 情况 A (一般情况，长时间)：$\\kappa = 1.0$, $a_1(0) = 1 + 0.2i$, $a_2(0) = 0.8 - 0.4i$, $a_3(0) = -0.6 + 0.3i$, $T = 200$, $\\Delta t = 0.01$, $\\varepsilon_I = 10^{-8}$, $\\varepsilon_H = 5\\times 10^{-3}$。\n2. 情况 B (刚性耦合)：$\\kappa = 10.0$, $a_1(0) = 0.1 + 0.0i$, $a_2(0) = 0.2 + 0.0i$, $a_3(0) = 0.3 + 0.0i$, $T = 2.0$, $\\Delta t = 10^{-3}$, $\\varepsilon_I = 10^{-8}$, $\\varepsilon_H = 5\\times 10^{-3}$。\n3. 情况 C (边界情况，零振幅)：$\\kappa = 1.0$, $a_1(0) = 1.0 + 0.0i$, $a_2(0) = 1.0 + 0.0i$, $a_3(0) = 0.0 + 0.0i$, $T = 50$, $\\Delta t = 0.01$, $\\varepsilon_I = 10^{-8}$, $\\varepsilon_H = 5\\times 10^{-3}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例对应一个布尔值，表示是否所有不变量都在指定的容差内守恒，顺序为 [情况 A, 情况 B, 情况 C]。例如：“[True,False,True]”。",
            "solution": "该问题要求分析一个描述共振三波相互作用的系统的守恒性质，既要分析连续时间动力学，也要分析一个特定的离散时间数值格式。\n\n**1. 连续系统中的守恒性**\n\n首先，我们证明 $I_{12}$、$I_{13}$ 和 $H$ 确实是连续系统的不变量。\n\n**Manley-Rowe 不变量 ($I_{12}, I_{13}$):**\n振幅 $a_j$ 模的平方的变化率由 $\\frac{d|a_j|^2}{dt} = \\frac{d(a_j a_j^*)}{dt} = \\frac{da_j}{dt}a_j^* + a_j\\frac{da_j^*}{dt}$ 给出。对控制常微分方程取复共轭，得到 $\\frac{da_j^*}{dt} = -i\\,\\kappa\\, a_m(t)\\, a_n(t)$。\n\n对于 $a_1$，我们有：\n$$\n\\frac{d|a_1|^2}{dt} = (i\\kappa a_2^* a_3^*) a_1^* + a_1 (-i\\kappa a_2 a_3) = i\\kappa(a_1^* a_2^* a_3^* - a_1 a_2 a_3) = -2\\kappa \\mathrm{Im}(a_1 a_2 a_3)\n$$\n由于控制方程的对称结构，完全相同的计算也适用于 $a_2$ 和 $a_3$：\n$$\n\\frac{d|a_2|^2}{dt} = (i\\kappa a_1^* a_3^*) a_2^* + a_2 (-i\\kappa a_1 a_3) = i\\kappa(a_1^* a_2^* a_3^* - a_1 a_2 a_3) = -2\\kappa \\mathrm{Im}(a_1 a_2 a_3)\n$$\n$$\n\\frac{d|a_3|^2}{dt} = (i\\kappa a_1^* a_2^*) a_3^* + a_3 (-i\\kappa a_1 a_2) = i\\kappa(a_1^* a_2^* a_3^* - a_1 a_2 a_3) = -2\\kappa \\mathrm{Im}(a_1 a_2 a_3)\n$$\n由于 $\\frac{d|a_1|^2}{dt} = \\frac{d|a_2|^2}{dt} = \\frac{d|a_3|^2}{dt}$，可以直接得出这些量之间的差值不随时间变化：\n$$\n\\frac{dI_{12}}{dt} = \\frac{d}{dt}(|a_1|^2 - |a_2|^2) = \\frac{d|a_1|^2}{dt} - \\frac{d|a_2|^2}{dt} = 0\n$$\n$$\n\\frac{dI_{13}}{dt} = \\frac{d}{dt}(|a_1|^2 - |a_3|^2) = \\frac{d|a_1|^2}{dt} - \\frac{d|a_3|^2}{dt} = 0\n$$\n这证实了 $I_{12}$ 和 $I_{13}$ 是守恒量。\n\n**哈密顿量 ($H$):**\n令 $S(t) = a_1(t)a_2(t)a_3(t)$。哈密顿量为 $H(t) = \\kappa(S(t) + S^*(t))$。其时间导数为 $\\frac{dH}{dt} = \\kappa(\\frac{dS}{dt} + \\frac{dS^*}{dt})$。我们计算 $\\frac{dS}{dt}$：\n$$\n\\frac{dS}{dt} = \\frac{da_1}{dt}a_2a_3 + a_1\\frac{da_2}{dt}a_3 + a_1a_2\\frac{da_3}{dt}\n$$\n代入控制常微分方程：\n$$\n\\frac{dS}{dt} = (i\\kappa a_2^*a_3^*)a_2a_3 + a_1(i\\kappa a_1^*a_3^*)a_3 + a_1a_2(i\\kappa a_1^*a_2^*) = i\\kappa\\left(|a_2|^2|a_3|^2+|a_1|^2|a_3|^2+|a_1|^2|a_2|^2\\right)\n$$\n括号中的项是纯实数。取复共轭得到 $\\frac{dS^*}{dt} = -i\\kappa\\left(|a_2|^2|a_3|^2+|a_1|^2|a_3|^2+|a_1|^2|a_2|^2\\right)$。\n因此，哈密顿量的导数为：\n$$\n\\frac{dH}{dt} = \\kappa\\left(\\frac{dS}{dt} + \\frac{dS^*}{dt}\\right) = \\kappa \\left( i\\kappa(\\dots) - i\\kappa(\\dots) \\right) = 0\n$$\n这证实了哈密顿量 $H$ 也是连续系统的一个守恒量。\n\n**2. 离散格式中的守恒性**\n\n隐式中点法是一种几何积分器，以其能保持底层连续系统的某些几何性质而闻名。我们现在证明它能精确地守恒二次 Manley-Rowe 不变量。\n\n**Manley-Rowe 不变量 ($I_{12}, I_{13}$):**\n从步长 $n$ 到 $n+1$，$a_1$ 模的平方的变化可以写为：\n$$\n|a_1^{n+1}|^2 - |a_1^n|^2 = \\mathrm{Re}\\left( (a_1^{n+1}-a_1^n)(a_1^{n+1}+a_1^n)^* \\right)\n$$\n使用中点定义 $a_1^{n+1}-a_1^n = i\\kappa\\Delta t (a_2^{\\mathrm{avg}})^*(a_3^{\\mathrm{avg}})^*$ 和 $a_1^{n+1}+a_1^n = 2a_1^{\\mathrm{avg}}$。代入这些可得：\n$$\n|a_1^{n+1}|^2 - |a_1^n|^2 = \\mathrm{Re}\\left( \\left(i\\kappa\\Delta t (a_2^{\\mathrm{avg}})^*(a_3^{\\mathrm{avg}})^*\\right) \\left(2(a_1^{\\mathrm{avg}})^*\\right) \\right) = 2\\kappa\\Delta t \\mathrm{Re}\\left( i (a_1^{\\mathrm{avg}}a_2^{\\mathrm{avg}}a_3^{\\mathrm{avg}})^* \\right)\n$$\n由于 $\\mathrm{Re}(iz) = -\\mathrm{Im}(z)$，我们有：\n$$\n|a_1^{n+1}|^2 - |a_1^n|^2 = -2\\kappa\\Delta t \\mathrm{Im}\\left( (a_1^{\\mathrm{avg}}a_2^{\\mathrm{avg}}a_3^{\\mathrm{avg}})^* \\right)\n$$\n由于更新规则和下标的循环对称性，对 $|a_2^{n+1}|^2 - |a_2^n|^2$ 的计算是完全相同的，从而得到相同的表达式。因此：\n$$\n|a_1^{n+1}|^2 - |a_1^n|^2 = |a_2^{n+1}|^2 - |a_2^n|^2 = |a_3^{n+1}|^2 - |a_3^n|^2\n$$\n这意味着在一个时间步长内，$I_{12}$ 的变化为零：\n$$\nI_{12}^{n+1} - I_{12}^n = (|a_1^{n+1}|^2 - |a_2^{n+1}|^2) - (|a_1^n|^2 - |a_2^n|^2) = (|a_1^{n+1}|^2 - |a_1^n|^2) - (|a_2^{n+1}|^2 - |a_2^n|^2) = 0\n$$\n相同的论证也适用于 $I_{13}$。因此，隐式中点格式能精确地守恒二次不变量 $I_{12}$ 和 $I_{13}$，误差仅限于浮点精度。这就解释了为何设置了非常严格的容差 $\\varepsilon_I = 10^{-8}$。\n\n**哈密顿量 ($H$):**\n哈密顿量 $H$ 是振幅的三次函数。关于几何积分器的一般定理指出，中点法则能精确保持一个系统的所有二次不变量。然而，它通常不能精确保持非二次不变量。作为哈密顿系统的一个对称的、类辛的积分器，它有望对 $H$ 表现出优异的长期守恒特性，这意味着 $H$ 的数值误差将保持有界且很小，围绕真值振荡而没有长期漂移。问题陈述通过提供一个宽松得多的容差 $\\varepsilon_H = 5 \\times 10^{-3}$ 来含蓄地承认了这一点，对于给定的参数，一个表现良好的格式应该能满足此容差。\n\n**3. 实现算法**\n\n实现的核心是在每个时间步求解关于 $a_j^{\\text{avg}}$ 的隐式系统。该更新规则可以重写为关于 $a_j^{\\text{avg}}$ 的不动点问题：\n$$\na_j^{\\mathrm{avg}} = a_j^n + \\frac{i\\kappa\\Delta t}{2} (a_m^{\\mathrm{avg}})^* (a_n^{\\mathrm{avg}})^*\n$$\n这个系统通过迭代求解。\n1. 初始化中点值的猜测值：$a_j^{\\mathrm{avg},(0)} = a_j^n$。\n2. 对 $k=0, 1, 2, \\dots$ 进行迭代：\n    $$\n    a_j^{\\mathrm{avg},(k+1)} = a_j^n + \\frac{i\\kappa\\Delta t}{2} (a_m^{\\mathrm{avg},(k)})^* (a_n^{\\mathrm{avg},(k)})^*\n    $$\n    对于足够小的 $\\Delta t$，该迭代会快速收敛。固定次数的迭代（例如 10 次）就足够了。\n3. 一旦找到收敛的 $a_j^{\\text{avg}}$，计算下一个时间步的状态：$a_j^{n+1} = 2 a_j^{\\text{avg}} - a_j^n$。\n4. 在每一步，计算不变量 $I_{12}^n, I_{13}^n, H^n$ 并更新最大漂移 $D_{12}, D_{13}, D_H$。\n5. 在最后一个时间步之后，将最大漂移与容差 $\\varepsilon_I$ 和 $\\varepsilon_H$ 进行比较，以判断不变量是否守恒。\n对指定的三个测试用例中的每一个都重复此过程。",
            "answer": "```python\n# 完整且可运行的 Python 3 代码在此处。\n# 导入必须遵守指定的执行环境。\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    主函数，为所有测试用例运行三波相互作用模拟，并判断不变量是否守恒。\n    \"\"\"\n    test_cases = [\n        # 情况 A (一般情况，长时间)\n        {'kappa': 1.0, 'a0': [1 + 0.2j, 0.8 - 0.4j, -0.6 + 0.3j], 'T': 200, 'dt': 0.01,\n         'eps_I': 1e-8, 'eps_H': 5e-3},\n        # 情况 B (刚性耦合)\n        {'kappa': 10.0, 'a0': [0.1 + 0.0j, 0.2 + 0.0j, 0.3 + 0.0j], 'T': 2.0, 'dt': 1e-3,\n         'eps_I': 1e-8, 'eps_H': 5e-3},\n        # 情况 C (边界情况，零振幅)\n        {'kappa': 1.0, 'a0': [1.0 + 0.0j, 1.0 + 0.0j, 0.0 + 0.0j], 'T': 50, 'dt': 0.01,\n         'eps_I': 1e-8, 'eps_H': 5e-3},\n    ]\n\n    results = []\n    for case in test_cases:\n        conserved = run_simulation(**case)\n        results.append(conserved)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation(kappa, a0, T, dt, eps_I, eps_H):\n    \"\"\"\n    为单个测试用例执行时间步进模拟。\n\n    Args:\n        kappa (float): 实耦合系数。\n        a0 (list of complex): 初始复振幅 [a1(0), a2(0), a3(0)]。\n        T (float): 总积分时间。\n        dt (float): 时间步长。\n        eps_I (float): Manley–Rowe 不变量的容差。\n        eps_H (float): 哈密顿能量的容差。\n\n    Returns:\n        bool: 如果所有不变量都在容差范围内守恒，则为 True，否则为 False。\n    \"\"\"\n    a_current = np.array(a0, dtype=np.complex128)\n    num_steps = int(round(T / dt))\n\n    # 计算初始不变量\n    I12_0 = abs(a_current[0])**2 - abs(a_current[1])**2\n    I13_0 = abs(a_current[0])**2 - abs(a_current[2])**2\n    S0 = a_current[0] * a_current[1] * a_current[2]\n    H_0 = kappa * (S0 + np.conj(S0)).real\n\n    # 初始化最大漂移\n    max_D12 = 0.0\n    max_D13 = 0.0\n    max_DH = 0.0\n\n    # 不动点迭代参数\n    FP_ITERATIONS = 10\n\n    # 时间步进循环\n    for _ in range(num_steps):\n        a_n = a_current\n\n        # --- 使用不动点迭代求解 a_avg ---\n        # a_avg 的初始猜测值为 a_n\n        a_avg = a_n.copy()\n        \n        # 使用类 Jacobi 迭代\n        for _ in range(FP_ITERATIONS):\n            a_avg_old = a_avg.copy()\n            # 基于隐式中点法则的 a_avg 更新方程\n            a_avg[0] = a_n[0] + 0.5j * kappa * dt * np.conj(a_avg_old[1]) * np.conj(a_avg_old[2])\n            a_avg[1] = a_n[1] + 0.5j * kappa * dt * np.conj(a_avg_old[0]) * np.conj(a_avg_old[2])\n            a_avg[2] = a_n[2] + 0.5j * kappa * dt * np.conj(a_avg_old[0]) * np.conj(a_avg_old[1])\n\n        # --- 更新到下一个时间步 ---\n        # a_n+1 = 2 * a_avg - a_n\n        a_current = 2.0 * a_avg - a_n\n\n        # --- 计算不变量并更新漂移 ---\n        I12_n = abs(a_current[0])**2 - abs(a_current[1])**2\n        I13_n = abs(a_current[0])**2 - abs(a_current[2])**2\n        S_n = a_current[0] * a_current[1] * a_current[2]\n        H_n = kappa * (S_n + np.conj(S_n)).real\n\n        max_D12 = max(max_D12, abs(I12_n - I12_0))\n        max_D13 = max(max_D13, abs(I13_n - I13_0))\n        max_DH = max(max_DH, abs(H_n - H_0))\n    \n    # 检查所有漂移是否都在各自的容差范围内\n    is_conserved = (max_D12 = eps_I) and (max_D13 = eps_I) and (max_DH = eps_H)\n    return is_conserved\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "单个三波相互作用的行为会汇集成宏观的湍流现象，例如谱级串。本理论练习将探讨基本守恒律如何决定Charney–Hasegawa–Mima模型中这些级串的方向，该模型是等离子体和地球物理湍流中的一个关键系统。通过分析一个简单的三壳层相互作用，您将从第一性原理推导出著名的双级串现象：能量向大尺度的反向级串和拟涡能向小尺度的正向级串。",
            "id": "4207770",
            "problem": "考虑无粘、无强迫的 Charney–Hasegawa–Mima (CHM) 模型，该模型通过位涡 $\\,q(\\boldsymbol{x},t) = \\nabla^{2}\\phi - \\alpha\\,\\phi\\,$ 的守恒来演化静电势 $\\,\\phi(\\boldsymbol{x},t)\\,$，其雅可比非线性项为 $\\,J(\\phi,q) \\equiv \\partial_{x}\\phi\\,\\partial_{y}q - \\partial_{y}\\phi\\,\\partial_{x}q\\,$。在傅里叶空间中，模 $\\,\\phi_{\\boldsymbol{k}}\\,$ 以满足 $\\,\\boldsymbol{k}+\\boldsymbol{p}+\\boldsymbol{q}=\\boldsymbol{0}\\,$ 的三波共振形式相互作用。在无粘 CHM 系统中，两个二次不变量是总能量和总位涡拟能，定义为\n$$\n\\mathcal{E} = \\frac{1}{2}\\int \\left(|\\nabla \\phi|^{2} + \\alpha\\,|\\phi|^{2}\\right)\\,d^{2}x = \\frac{1}{2}\\sum_{\\boldsymbol{k}} \\left(k^{2}+\\alpha\\right)\\,|\\phi_{\\boldsymbol{k}}|^{2},\n\\qquad\n\\mathcal{Z} = \\frac{1}{2}\\int |q|^{2}\\,d^{2}x = \\frac{1}{2}\\sum_{\\boldsymbol{k}} \\left(k^{2}+\\alpha\\right)^{2}\\,|\\phi_{\\boldsymbol{k}}|^{2}.\n$$\n因此，在每个波数大小 $\\,k\\,$ 处，能量谱密度和位涡拟能谱密度满足 $\\,Z_{k} = \\left(k^{2}+\\alpha\\right) E_{k}\\,$，其中 $\\,E_{k} = \\frac{1}{2}\\left(k^{2}+\\alpha\\right)|\\phi_{\\boldsymbol{k}}|^{2}\\,$ 且 $\\,Z_{k} = \\frac{1}{2}\\left(k^{2}+\\alpha\\right)^{2}|\\phi_{\\boldsymbol{k}}|^{2}\\,$。\n\n采用一个离散、各向同性的谱，该谱集中在三个同心谱壳层 $\\,S_{1},S_{2},S_{3}\\,$ 中，其代表性波数大小分别为 $\\,k_{1},k_{2},k_{3}\\,$，而在其他地方的能量可以忽略不计。取 $\\,\\alpha=1\\,$ 并选择 $\\,k_{1}=1\\,$，$\\,k_{2}=2\\,$ 和 $\\,k_{3}=3\\,$。假设一个与 CHM 三波共振一致的孤立、局部的三壳层相互作用，在这些壳层之间瞬时重新分配能量，同时保持总能量和总位涡拟能守恒。令 $\\,\\delta E_{i}\\,$ 表示在此交换过程中壳层 $\\,S_{i}\\,$ 的能量变化，并假设中间壳层损失了给定量的能量 $\\,\\delta E_{2}=-\\Delta\\,$，其中 $\\,\\Delta0\\,$。守恒定律从而决定了 $\\,\\delta E_{1}\\,$ 和 $\\,\\delta E_{3}\\,$。\n\n计算当 $\\,\\Delta\\,$ 归一化为 $\\,\\Delta=1\\,$ 时，从中间壳层 $\\,S_{2}\\,$ 移除并转移到大尺度壳层 $\\,S_{1}\\,$ 的能量所占的分数 $\\,f\\,$。即，求出\n$$\nf \\equiv \\frac{\\delta E_{1}}{\\Delta}\n$$\n对于指定的 $\\,\\alpha\\,$ 和 $\\,k_{i}\\,$。根据你的结果，在你的推导过程中指明这种与三波共振一致的壳层间转移所蕴含的能量通量和位涡拟能通量的方向性。\n\n将 $\\,f\\,$ 的最终数值答案表示为小数，并四舍五入到四位有效数字。不需要单位。",
            "solution": "问题的核心在于三个壳层 $S_{1}$、$S_{2}$ 和 $S_{3}$ 之间相互作用过程中总能量 $\\mathcal{E}$ 和总位涡拟能 $\\mathcal{Z}$ 的同时守恒。令 $\\delta E_{i}$ 和 $\\delta Z_{i}$ 分别为壳层 $S_{i}$ 内能量和位涡拟能的变化，该壳层的特征是代表性波数 $k_{i}$。\n\n这个孤立的三壳层系统的守恒定律可以写为：\n$$\n\\delta \\mathcal{E}_{\\text{total}} = \\delta E_{1} + \\delta E_{2} + \\delta E_{3} = 0\n$$\n$$\n\\delta \\mathcal{Z}_{\\text{total}} = \\delta Z_{1} + \\delta Z_{2} + \\delta Z_{3} = 0\n$$\n\n问题指出，对于给定的波数大小 $k$，谱密度通过 $Z_{k} = (k^{2}+\\alpha) E_{k}$ 相关联。这个关系可以推广到在一个以代表性波数 $k_i$ 为特征的窄壳层 $S_i$ 上积分得到的总能量 $E_{i}$ 和总位涡拟能 $Z_{i}$。因此，对于这些量的任何变化，我们必须有：\n$$\n\\delta Z_{i} = (k_{i}^{2}+\\alpha) \\delta E_{i}\n$$\n\n将此关系代入位涡拟能守恒方程，得到：\n$$\n(k_{1}^{2}+\\alpha) \\delta E_{1} + (k_{2}^{2}+\\alpha) \\delta E_{2} + (k_{3}^{2}+\\alpha) \\delta E_{3} = 0\n$$\n\n我们现在得到了一个关于三个变量 $\\delta E_{1}$、$\\delta E_{2}$ 和 $\\delta E_{3}$ 的两个线性方程组：\n1.  $\\delta E_{1} + \\delta E_{2} + \\delta E_{3} = 0$\n2.  $(k_{1}^{2}+\\alpha) \\delta E_{1} + (k_{2}^{2}+\\alpha) \\delta E_{2} + (k_{3}^{2}+\\alpha) \\delta E_{3} = 0$\n\n问题指定中间壳层损失能量 $\\delta E_{2} = -\\Delta$，其中 $\\Delta  0$。我们可以用这个条件来求解未知数 $\\delta E_{1}$ 和 $\\delta E_{3}$：\n1.  $\\delta E_{1} + \\delta E_{3} = -\\delta E_{2} = \\Delta$\n2.  $(k_{1}^{2}+\\alpha) \\delta E_{1} + (k_{3}^{2}+\\alpha) \\delta E_{3} = -(k_{2}^{2}+\\alpha) \\delta E_{2} = (k_{2}^{2}+\\alpha) \\Delta$\n\n从第一个方程中，我们可以用 $\\delta E_{1}$ 表示 $\\delta E_{3}$：\n$$\n\\delta E_{3} = \\Delta - \\delta E_{1}\n$$\n\n将此代入第二个方程：\n$$\n(k_{1}^{2}+\\alpha) \\delta E_{1} + (k_{3}^{2}+\\alpha) (\\Delta - \\delta E_{1}) = (k_{2}^{2}+\\alpha) \\Delta\n$$\n\n现在，我们求解 $\\delta E_{1}$：\n$$\n(k_{1}^{2}+\\alpha) \\delta E_{1} + (k_{3}^{2}+\\alpha) \\Delta - (k_{3}^{2}+\\alpha) \\delta E_{1} = (k_{2}^{2}+\\alpha) \\Delta\n$$\n$$\n\\delta E_{1} \\left( (k_{1}^{2}+\\alpha) - (k_{3}^{2}+\\alpha) \\right) = \\Delta \\left( (k_{2}^{2}+\\alpha) - (k_{3}^{2}+\\alpha) \\right)\n$$\n$$\n\\delta E_{1} (k_{1}^{2} - k_{3}^{2}) = \\Delta (k_{2}^{2} - k_{3}^{2})\n$$\n\n所求的分数 $f$ 定义为 $f \\equiv \\frac{\\delta E_{1}}{\\Delta}$。从上面的方程，我们发现：\n$$\nf = \\frac{\\delta E_{1}}{\\Delta} = \\frac{k_{2}^{2} - k_{3}^{2}}{k_{1}^{2} - k_{3}^{2}}\n$$\n分数 $f$ 的这个表达式非常显著地与参数 $\\alpha$ 无关。\n\n我们现在代入给定的波数数值：$k_{1}=1$，$k_{2}=2$ 和 $k_{3}=3$。\n$$\nf = \\frac{2^{2} - 3^{2}}{1^{2} - 3^{2}} = \\frac{4 - 9}{1 - 9} = \\frac{-5}{-8} = \\frac{5}{8}\n$$\n\n作为小数，$f = 0.625$。问题要求答案四舍五入到四位有效数字，即 $0.6250$。\n\n为了确定通量的方向性，我们分析能量变化的符号。按照归一化的指示，我们设 $\\Delta=1$。\n-   $\\delta E_{1} = f \\Delta = \\frac{5}{8} \\Delta$。由于 $\\Delta  0$，所以 $\\delta E_{1}  0$。能量流入大尺度壳层 $S_{1}$（逆级串）。\n-   $\\delta E_{2} = -\\Delta  0$。能量从中间壳层 $S_{2}$ 移除。\n-   $\\delta E_{3} = \\Delta - \\delta E_{1} = \\Delta - \\frac{5}{8}\\Delta = \\frac{3}{8}\\Delta$。由于 $\\Delta  0$，所以 $\\delta E_{3}  0$。能量流入小尺度壳层 $S_{3}$（正级串）。\n\n这种从一个中间源同时向大尺度（更低的 $k$）和小尺度（更高的 $k$）转移能量是**双级串**的标志。\n\n接下来，我们使用 $\\alpha=1$ 和 $\\Delta=1$ 来检验位涡拟能通量：\n-   $\\delta Z_{1} = (k_{1}^{2}+\\alpha) \\delta E_{1} = (1^{2}+1) \\left(\\frac{5}{8}\\right) = 2 \\left(\\frac{5}{8}\\right) = \\frac{10}{8} = \\frac{5}{4} = 1.25$。\n-   $\\delta Z_{2} = (k_{2}^{2}+\\alpha) \\delta E_{2} = (2^{2}+1) (-1) = -5$。\n-   $\\delta Z_{3} = (k_{3}^{2}+\\alpha) \\delta E_{3} = (3^{2}+1) \\left(\\frac{3}{8}\\right) = 10 \\left(\\frac{3}{8}\\right) = \\frac{30}{8} = \\frac{15}{4} = 3.75$。\n\n总位涡拟能变化为 $\\delta Z_{1} + \\delta Z_{2} + \\delta Z_{3} = 1.25 - 5 + 3.75 = 0$，证实了其守恒性。\n壳层 $S_2$ 损失了 $5$ 个单位的位涡拟能。其中，$3.75$ 个单位（$75\\%$）被转移到小尺度壳层 $S_{3}$，而 $1.25$ 个单位（$25\\%$）被转移到大尺度壳层 $S_{1}$。因此，位涡拟能的主要通量是向小尺度（更高的 $k$）的**正级串**。\n\n总而言之，该相互作用导致了能量的双级串和位涡拟能的主要是正级串，这些是 CHM 系统中湍流的特征。从中间壳层转移到大尺度壳层的能量分数为 $f = \\frac{5}{8}$。\n\n针对所要求格式的最终计算：$f = \\frac{5}{8} = 0.625$。四舍五入到四位有效数字，结果为 $0.6250$。",
            "answer": "$$\n\\boxed{0.6250}\n$$"
        }
    ]
}