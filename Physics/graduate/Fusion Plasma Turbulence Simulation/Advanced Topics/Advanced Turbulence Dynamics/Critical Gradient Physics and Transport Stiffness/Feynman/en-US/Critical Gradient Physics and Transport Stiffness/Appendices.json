{
    "hands_on_practices": [
        {
            "introduction": "This exercise bridges the gap between microscopic turbulence and macroscopic plasma profiles by exploring the concept of \"profile resilience.\" Using a simplified energy balance model, you will investigate how a transport law with a stiff, critical gradient behavior leads to the phenomenon of gradient clamping . This practice is fundamental to understanding why temperature profiles in fusion devices are often robustly fixed near a marginal value, even when heating power is significantly increased.",
            "id": "4185851",
            "problem": "Consider a single flux surface in a toroidal plasma with a prescribed, constant external heating power density $P$ (in Gyro-Bohm units, defined as Gyro-Bohm (GB) units), and a local, dimensionless temperature gradient $G \\equiv R/L_T$, where $R$ is the major radius and $L_T \\equiv -T/\\nabla T$ is the temperature scale length. Assume a reduced, local energy balance model in which the gradient evolves according to $C\\, dG/dt = P - Q(G)$, where $C>0$ is an effective heat capacity per unit volume and $Q(G)$ is the outward heat flux (in GB units) as a function of $G$. The total flux is the sum of a neoclassical baseline and a turbulence-driven contribution that turns on above a critical gradient $G_c$:\n$$\nQ(G) \\;=\\; \\chi_{\\mathrm{neo}}\\, G \\;+\\; \\chi_{\\mathrm{t}}\\, \\bigl(G - G_c\\bigr)^{2}\\, H\\!\\bigl(G - G_c\\bigr),\n$$\nwhere $\\chi_{\\mathrm{neo}}>0$ and $\\chi_{\\mathrm{t}}>0$ are constants, and $H(x)$ is the Heaviside step function. Take the parameters $\\chi_{\\mathrm{neo}} = 0.8$ (GB units), $\\chi_{\\mathrm{t}} = 200$ (GB units), $G_c = 4.6$, and $P = 12$ (GB units).\n\nFrom first principles, determine the equilibrium branches by solving $P = Q(G)$ and assess linear stability of each branch by analyzing $dQ/dG$ at the equilibrium. Define gradient clamping to occur when the sensitivity of the equilibrium gradient to changes in heating power is small in the sense that $dG/dP \\leq 2 \\times 10^{-2}$ at the equilibrium. Compute the stable equilibrium gradient $G^{\\ast}$ and determine whether it satisfies the clamping criterion. Report the clamped equilibrium gradient $G^{\\ast}$ (in dimensionless $R/L_T$ form). Round your final answer to four significant figures.",
            "solution": "The problem will be validated by first extracting the given information and then checking it for scientific grounding, consistency, and completeness.\n\n### Step 1: Extract Givens\nThe givens are as follows:\n- Energy balance model: $C\\, dG/dt = P - Q(G)$, with $C>0$.\n- Dimensionless temperature gradient: $G \\equiv R/L_T$.\n- External heating power density: $P = 12$ (Gyro-Bohm units).\n- Heat flux model $Q(G)$:\n$$\nQ(G) = \\chi_{\\mathrm{neo}}\\, G + \\chi_{\\mathrm{t}}\\, \\bigl(G - G_c\\bigr)^{2}\\, H\\!\\bigl(G - G_c\\bigr)\n$$\n- Model parameters:\n  - Neoclassical transport coefficient: $\\chi_{\\mathrm{neo}} = 0.8$ (GB units).\n  - Turbulent transport coefficient: $\\chi_{\\mathrm{t}} = 200$ (GB units).\n  - Critical gradient: $G_c = 4.6$.\n- Heaviside step function: $H(x) = 1$ for $x \\ge 0$ and $H(x) = 0$ for $x < 0$.\n- Gradient clamping criterion: $dG/dP \\leq 2 \\times 10^{-2}$ at equilibrium.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated based on the validation criteria.\n- **Scientifically Grounded**: The problem presents a simplified, but standard, zero-dimensional ($0$D) transport model used in plasma physics to study the stiffness of temperature profiles in the presence of turbulence. The critical gradient model for turbulent heat flux is a cornerstone of modern transport theory in fusion plasmas. The given equation, $C\\, dG/dt = P - Q$, is a basic energy balance equation. The form of $Q(G)$ and the given parameters are physically plausible within the gyro-Bohm normalization scheme. The concepts of equilibrium, stability, and transport stiffness ($dQ/dG$) are central to this field. The problem is scientifically sound.\n- **Well-Posed**: The problem is clearly stated with all necessary parameters and definitions provided. It asks for the calculation of equilibrium points, their stability, and the evaluation of a specific criterion ($dG/dP$). This structure leads to a unique, stable, and meaningful solution.\n- **Objective**: The problem is formulated with precise, objective language and mathematical expressions, free of any subjective or opinion-based statements.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is scientifically grounded, well-posed, and objective. A complete solution will be provided.\n\n### Solution\n\nThe solution proceeds in four stages:\n1.  Determine the equilibrium branches by solving for the gradient $G$ from the steady-state energy balance equation.\n2.  Assess the linear stability of each equilibrium branch.\n3.  Evaluate the clamping criterion for the stable equilibrium.\n4.  Report the final value for the stable, clamped equilibrium gradient $G^{\\ast}$.\n\n**1. Determination of Equilibrium Branches**\n\nAn equilibrium state is defined by the condition $dG/dt = 0$. From the given energy balance model, this implies that the heating power $P$ must be balanced by the outward heat flux $Q(G)$:\n$$\nP = Q(G)\n$$\nSubstituting the given values and the expression for $Q(G)$:\n$$\n12 = 0.8\\, G + 200\\, (G - 4.6)^{2}\\, H(G - 4.6)\n$$\nWe must analyze this equation in two regimes, defined by the Heaviside function $H(G - G_c)$.\n\n- **Case 1: Sub-critical gradient ($G \\le G_c$)**\nIn this case, $G \\le 4.6$, which means $G - G_c \\le 0$ and $H(G - 4.6) = 0$. The turbulent flux term vanishes, and the equation simplifies to the neoclassical balance:\n$$\n12 = 0.8\\, G\n$$\nSolving for $G$ yields:\n$$\nG = \\frac{12}{0.8} = 15\n$$\nThis solution, $G=15$, contradicts the initial assumption for this case, which was $G \\le 4.6$. Therefore, there are no equilibrium solutions in the sub-critical regime.\n\n- **Case 2: Super-critical gradient ($G > G_c$)**\nIn this case, $G > 4.6$, which means $G - G_c > 0$ and $H(G - 4.6) = 1$. The full heat flux model applies:\n$$\n12 = 0.8\\, G + 200\\, (G - 4.6)^{2}\n$$\nThis is a quadratic equation for $G$. We expand and rearrange it into the standard form $aG^2 + bG + c = 0$.\n$$\n12 = 0.8\\, G + 200\\, (G^2 - 9.2\\, G + 21.16)\n$$\n$$\n12 = 0.8\\, G + 200\\, G^2 - 1840\\, G + 4232\n$$\n$$\n200\\, G^2 + (0.8 - 1840)\\, G + (4232 - 12) = 0\n$$\n$$\n200\\, G^2 - 1839.2\\, G + 4220 = 0\n$$\nWe solve this quadratic equation using the quadratic formula, $G = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$, with $a=200$, $b=-1839.2$, and $c=4220$.\nThe discriminant is:\n$$\n\\Delta = b^2 - 4ac = (-1839.2)^2 - 4(200)(4220) = 3382656.64 - 3376000 = 6656.64\n$$\nThe roots are:\n$$\nG = \\frac{1839.2 \\pm \\sqrt{6656.64}}{2(200)} = \\frac{1839.2 \\pm 81.588231}{400}\n$$\nThis yields two potential solutions:\n$$\nG_1 = \\frac{1839.2 + 81.588231}{400} = \\frac{1920.788231}{400} \\approx 4.80197\n$$\n$$\nG_2 = \\frac{1839.2 - 81.588231}{400} = \\frac{1757.611769}{400} \\approx 4.39403\n$$\nWe must check these solutions against the assumption for this case, $G > 4.6$.\n- $G_1 \\approx 4.80197$ is greater than $4.6$, so it is a valid physical equilibrium.\n- $G_2 \\approx 4.39403$ is less than $4.6$, which contradicts the assumption. This root is an artifact of extending the quadratic form of the flux into a region where it is not valid and is therefore not a physical equilibrium.\n\nThus, there is only one physical equilibrium point, $G^{\\ast} \\approx 4.80197$.\n\n**2. Stability Analysis**\n\nThe stability of an equilibrium point $G^{\\ast}$ is determined by analyzing the response to a small perturbation $\\delta G(t) = G(t) - G^{\\ast}$. The evolution equation becomes:\n$$\nC \\frac{d(\\delta G)}{dt} = P - Q(G^{\\ast} + \\delta G)\n$$\nFor a small perturbation, we can linearize $Q(G)$ around $G^{\\ast}$: $Q(G^{\\ast} + \\delta G) \\approx Q(G^{\\ast}) + \\frac{dQ}{dG}\\bigg|_{G^{\\ast}} \\delta G$.\nSince $P = Q(G^{\\ast})$ at equilibrium, the equation simplifies to:\n$$\nC \\frac{d(\\delta G)}{dt} = - \\left( \\frac{dQ}{dG}\\bigg|_{G^{\\ast}} \\right) \\delta G\n$$\nFor the equilibrium to be stable, the perturbation must decay, which requires the coefficient on the right-hand side to be negative. Since $C > 0$, stability requires:\n$$\n\\frac{dQ}{dG}\\bigg|_{G^{\\ast}} > 0\n$$\nThe derivative of the heat flux $Q(G)$ for $G > G_c$ is:\n$$\n\\frac{dQ}{dG} = \\frac{d}{dG} \\left[ \\chi_{\\mathrm{neo}}\\, G + \\chi_{\\mathrm{t}}\\, (G - G_c)^{2} \\right] = \\chi_{\\mathrm{neo}} + 2\\, \\chi_{\\mathrm{t}}\\, (G - G_c)\n$$\nWe evaluate this \"transport stiffness\" at the equilibrium point $G^{\\ast} \\approx 4.80197$:\n$$\n\\frac{dQ}{dG}\\bigg|_{G^{\\ast}} = 0.8 + 2(200)(4.80197 - 4.6) = 0.8 + 400(0.20197) = 0.8 + 80.788 = 81.588\n$$\nSince $\\frac{dQ}{dG}\\bigg|_{G^{\\ast}} \\approx 81.588 > 0$, the equilibrium $G^{\\ast} \\approx 4.80197$ is linearly stable.\n\n**3. Gradient Clamping Criterion**\n\nThe problem defines gradient clamping as the condition where the sensitivity of the equilibrium gradient to heating power, $dG/dP$, is small:\n$$\n\\frac{dG}{dP} \\le 2 \\times 10^{-2}\n$$\nTo find $dG/dP$, we differentiate the equilibrium condition $P = Q(G)$ with respect to $P$, treating $G$ as a function of $P$:\n$$\n\\frac{d}{dP}(P) = \\frac{d}{dP}(Q(G(P)))\n$$\nUsing the chain rule on the right side:\n$$\n1 = \\frac{dQ}{dG} \\frac{dG}{dP}\n$$\nTherefore, the sensitivity is the inverse of the transport stiffness:\n$$\n\\frac{dG}{dP} = \\left(\\frac{dQ}{dG}\\right)^{-1}\n$$\nUsing the value calculated in the stability analysis:\n$$\n\\frac{dG}{dP}\\bigg|_{G^{\\ast}} = \\frac{1}{81.588} \\approx 0.0122567\n$$\nWe now compare this value to the clamping criterion:\n$$\n0.0122567 \\le 2 \\times 10^{-2} \\quad \\implies \\quad 0.0122567 \\le 0.02\n$$\nThis inequality is true. Therefore, the stable equilibrium gradient $G^{\\ast}$ satisfies the clamping criterion.\n\n**4. Final Answer**\n\nThe stable, clamped equilibrium gradient is $G^{\\ast} \\approx 4.80197$. Rounding this to four significant figures gives $4.802$.",
            "answer": "$$ \\boxed{4.802} $$"
        },
        {
            "introduction": "A central task in turbulence research is the quantitative analysis of simulation data to extract key physical parameters. This practice provides direct experience in this process by asking you to infer critical thresholds from synthetic gyrokinetic outputs . By fitting simple models to linear growth rate and nonlinear heat flux data, you will learn to distinguish and calculate the linear stability threshold, $\\kappa_{\\text{lin}}$, and the nonlinear transport threshold, $\\kappa_{\\text{NL}}$, thereby quantifying the important phenomenon of the Dimits upshift.",
            "id": "4185941",
            "problem": "Consider a reduced, dimensionless setting for electrostatic Ion Temperature Gradient (ITG) turbulence in a tokamak-like system, where the control parameter is the normalized ion temperature gradient denoted by $\\kappa$. In the linear gyrokinetic regime, the dominant mode has a growth rate $\\gamma(\\kappa)$ that changes sign at the linear marginal stability threshold, i.e., $\\gamma(\\kappa_{\\text{lin}})=0$ with $\\partial \\gamma/\\partial \\kappa \\neq 0$ near marginality. In the fully nonlinear regime with self-generated zonal flows, turbulent heat transport is observed to be stiff, exhibiting an upshifted nonlinear threshold $\\kappa_{\\text{NL}}$ (often called the Dimits upshift), so that the saturated heat flux $Q(\\kappa)$ is strongly suppressed for $\\kappa \\le \\kappa_{\\text{NL}}$ and rises rapidly for $\\kappa > \\kappa_{\\text{NL}}$. The Dimits upshift can be quantified by comparing $\\kappa_{\\text{NL}}$ against $\\kappa_{\\text{lin}}$ through two metrics: the ratio $D = \\kappa_{\\text{NL}} / \\kappa_{\\text{lin}}$ and the difference $\\Delta = \\kappa_{\\text{NL}} - \\kappa_{\\text{lin}}$, both dimensionless. Your task is to infer $\\kappa_{\\text{lin}}$ from linear gyrokinetic data and $\\kappa_{\\text{NL}}$ from nonlinear power-scan data, for each test case below, and then compute $D$ and $\\Delta$.\n\nUse only the following principled and model-agnostic inferences that are consistent with first principles and well-tested observations:\n- Linear marginality: Near $\\kappa_{\\text{lin}}$, the most unstable linear eigenvalue has real growth rate $\\gamma(\\kappa)$ that is approximately affine in $\\kappa$. Infer $\\kappa_{\\text{lin}}$ by fitting $\\gamma(\\kappa)$ to a straight line in $\\kappa$ using least squares and solving for the intercept where $\\gamma(\\kappa)=0$.\n- Nonlinear stiff transport onset: Near the onset, assume the saturated heat flux follows a thresholded power law of the form $Q(\\kappa) \\approx A \\, \\max\\{0, \\kappa - \\kappa_{0}\\}^{\\alpha}$ with $A \\ge 0$ and a fixed exponent $\\alpha = 2$ representing a superlinear onset consistent with strong shear regulation. Infer $\\kappa_{\\text{NL}}$ by selecting $\\kappa_{0}$ that minimizes the total least-squares error over all data points with respect to this model, with the coefficient $A$ optimized (by least squares) for each trial $\\kappa_{0}$. Restrict $\\kappa_{0}$ to the closed interval spanning the minimum and maximum $\\kappa$ values provided in the nonlinear dataset for each test.\n\nFor each test case, you are given two datasets:\n- Linear dataset: a list of $(\\kappa_{i}, \\gamma_{i})$ pairs, expressed as two parallel lists $\\{\\kappa_{i}\\}$ and $\\{\\gamma_{i}\\}$.\n- Nonlinear dataset: a list of $(\\kappa_{j}, Q_{j})$ pairs, expressed as two parallel lists $\\{\\kappa_{j}\\}$ and $\\{Q_{j}\\}$.\n\nAll quantities are dimensionless. No physical units are required. Angles are not used. Your program must:\n- For each test case, infer $\\kappa_{\\text{lin}}$ from the linear dataset by a least-squares affine fit to $\\gamma(\\kappa)$ and evaluating the zero-crossing.\n- For each test case, infer $\\kappa_{\\text{NL}}$ from the nonlinear dataset by minimizing the least-squares error over thresholded quadratic models $Q(\\kappa) = A \\, \\max\\{0, \\kappa - \\kappa_{0}\\}^{2}$ with respect to $\\kappa_{0}$ and $A \\ge 0$.\n- Compute $D = \\kappa_{\\text{NL}} / \\kappa_{\\text{lin}}$ and $\\Delta = \\kappa_{\\text{NL}} - \\kappa_{\\text{lin}}$ for each test case.\n- Round $D$ and $\\Delta$ to exactly three decimal places.\n\nTest suite:\n- Test case $1$:\n  - Linear: $\\{\\kappa\\} = [3.5, 4.0, 4.5, 5.0, 5.5]$, $\\{\\gamma\\} = [-0.2, -0.1, 0.0, 0.1, 0.2]$.\n  - Nonlinear: $\\{\\kappa\\} = [5.0, 5.5, 6.0, 6.3, 6.6, 7.0]$, $\\{Q\\} = [0.0, 0.0, 0.0, 0.0, 0.135, 0.735]$.\n- Test case $2$:\n  - Linear: $\\{\\kappa\\} = [4.0, 4.5, 5.0, 5.5, 6.0]$, $\\{\\gamma\\} = [-0.25, -0.125, 0.0, 0.125, 0.25]$.\n  - Nonlinear: $\\{\\kappa\\} = [4.5, 5.0, 5.5, 6.0]$, $\\{Q\\} = [0.0, 0.0, 0.5, 2.0]$.\n- Test case $3$:\n  - Linear: $\\{\\kappa\\} = [3.0, 3.5, 3.8, 4.2, 4.6]$, $\\{\\gamma\\} = [-0.144, -0.054, 0.0, 0.072, 0.144]$.\n  - Nonlinear: $\\{\\kappa\\} = [5.0, 5.5, 6.0, 6.84, 7.2, 7.8]$, $\\{Q\\} = [0.0, 0.0, 0.0, 0.0, 0.15552, 1.10592]$.\n\nFinal output format:\n- Your program should produce a single line of output containing a list with one entry per test case. Each entry must itself be a two-element list $[D, \\Delta]$ with both numbers rounded to exactly three decimal places. For example, a valid output for two hypothetical cases would be \"[[1.234,0.567],[1.000,0.000]]\". Your actual output must correspond to the three test cases above, in order $1$, $2$, $3$.",
            "solution": "The user's problem requires the analysis of simulated data from gyrokinetic turbulence simulations to extract key physics parameters related to transport stiffness. The problem is deemed valid as it is scientifically grounded in established fusion plasma physics principles, well-posed with clear and formalizable instructions, and objective in its language. All necessary data and models are provided, and the task is a standard data analysis procedure in the field.\n\nThe analysis is divided into two main parts for each test case: inference of the linear stability threshold $\\kappa_{\\text{lin}}$ and inference of the nonlinear transport threshold $\\kappa_{\\text{NL}}$.\n\n**1. Inference of the Linear Threshold $\\kappa_{\\text{lin}}$**\n\nThe problem states that near the marginal stability point, the linear growth rate $\\gamma$ of the most unstable mode is approximately an affine function of the normalized temperature gradient $\\kappa$. This is consistent with the general behavior of eigenvalues near a bifurcation point. We model this relationship as:\n$$\n\\gamma(\\kappa) = m\\kappa + c\n$$\nwhere $m$ and $c$ are constants. The linear marginal stability threshold, $\\kappa_{\\text{lin}}$, is defined as the point where the growth rate vanishes, i.e., $\\gamma(\\kappa_{\\text{lin}}) = 0$. Solving for $\\kappa_{\\text{lin}}$ gives:\n$$\n\\kappa_{\\text{lin}} = -\\frac{c}{m}\n$$\nTo determine the parameters $m$ and $c$ from a given linear dataset of pairs $(\\kappa_i, \\gamma_i)$, we perform a linear least-squares regression. This procedure minimizes the sum of the squared differences between the observed growth rates $\\gamma_i$ and the values predicted by the affine model. For a dataset of $N$ points, we minimize the error $E = \\sum_{i=1}^{N} (\\gamma_i - (m\\kappa_i + c))^2$. The optimal parameters $m$ and $c$ are computed, and from them, $\\kappa_{\\text{lin}}$ is determined. In the implementation, this is efficiently handled using a function like `numpy.polyfit` with degree $1$.\n\n**2. Inference of the Nonlinear Threshold $\\kappa_{\\text{NL}}$**\n\nThe problem describes the onset of stiff turbulent transport using a thresholded power-law model for the saturated heat flux $Q$ as a function of $\\kappa$:\n$$\nQ(\\kappa) \\approx A \\, \\max\\{0, \\kappa - \\kappa_{0}\\}^{\\alpha}\n$$\nThe problem specifies the exponent $\\alpha = 2$, which represents a super-linear onset characteristic of turbulence regulated by strong zonal flow shear. Our task is to find the nonlinear threshold $\\kappa_{\\text{NL}}$, which is identified with the parameter $\\kappa_0$ in the model.\n\nThe inference of $\\kappa_0$ (and the amplitude $A$) from a nonlinear dataset of pairs $(\\kappa_j, Q_j)$ is a nonlinear least-squares problem. A standard method, specified by the problem, is to perform a one-dimensional search for the optimal $\\kappa_0$. For any given trial value of $\\kappa_0$, the model becomes linear with respect to the amplitude $A$. Let us define a new independent variable $X_j(\\kappa_0) = \\max\\{0, \\kappa_j - \\kappa_0\\}^2$. The model is then $Q_j \\approx A X_j(\\kappa_0)$.\n\nFor a fixed $\\kappa_0$, we can find the optimal amplitude $A_{opt}$ that minimizes the sum of squared residuals $S = \\sum_j (Q_j - A X_j(\\kappa_0))^2$ by solving $\\partial S / \\partial A = 0$. This yields the standard linear least-squares solution for the coefficient $A$:\n$$\nA_{opt}(\\kappa_0) = \\frac{\\sum_j Q_j X_j(\\kappa_0)}{\\sum_j (X_j(\\kappa_0))^2} = \\frac{\\vec{Q} \\cdot \\vec{X}(\\kappa_0)}{\\vec{X}(\\kappa_0) \\cdot \\vec{X}(\\kappa_0)}\n$$\nThe problem constrains $A \\ge 0$. As the observed heat flux $Q_j$ is non-negative and the basis function $X_j(\\kappa_0)$ is non-negative by construction, the calculated $A_{opt}$ will also be non-negative.\n\nBy substituting $A_{opt}(\\kappa_0)$ back into the expression for the sum of squares, we obtain the minimum error for a given $\\kappa_0$, which is a function of $\\kappa_0$ alone:\n$$\nE(\\kappa_0) = \\sum_j (Q_j - A_{opt}(\\kappa_0) X_j(\\kappa_0))^2\n$$\nThe nonlinear threshold $\\kappa_{\\text{NL}}$ is then the value of $\\kappa_0$ that minimizes this error function $E(\\kappa_0)$. The search for this minimum is conducted over the specified closed interval $[\\min\\{\\kappa_j\\}, \\max\\{\\kappa_j\\}]$. This one-dimensional, bounded minimization is performed numerically using `scipy.optimize.minimize_scalar`.\n\n**3. Calculation of Dimits Upshift Metrics**\n\nOnce $\\kappa_{\\text{lin}}$ and $\\kappa_{\\text{NL}}$ have been inferred for a given test case, the two dimensionless metrics quantifying the Dimits upshift are calculated as:\n- The ratio: $D = \\kappa_{\\text{NL}} / \\kappa_{\\text{lin}}$\n- The difference: $\\Delta = \\kappa_{\\text{NL}} - \\kappa_{\\text{lin}}$\n\nThese values are then rounded to three decimal places as required. The entire procedure is applied to each test case provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves the problem of inferring linear and nonlinear thresholds\n    from gyrokinetic data and computes the Dimits upshift metrics.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"linear\": {\n                \"kappa\": [3.5, 4.0, 4.5, 5.0, 5.5],\n                \"gamma\": [-0.2, -0.1, 0.0, 0.1, 0.2]\n            },\n            \"nonlinear\": {\n                \"kappa\": [5.0, 5.5, 6.0, 6.3, 6.6, 7.0],\n                \"Q\": [0.0, 0.0, 0.0, 0.0, 0.135, 0.735]\n            }\n        },\n        {\n            \"linear\": {\n                \"kappa\": [4.0, 4.5, 5.0, 5.5, 6.0],\n                \"gamma\": [-0.25, -0.125, 0.0, 0.125, 0.25]\n            },\n            \"nonlinear\": {\n                \"kappa\": [4.5, 5.0, 5.5, 6.0],\n                \"Q\": [0.0, 0.0, 0.5, 2.0]\n            }\n        },\n        {\n            \"linear\": {\n                \"kappa\": [3.0, 3.5, 3.8, 4.2, 4.6],\n                \"gamma\": [-0.144, -0.054, 0.0, 0.072, 0.144]\n            },\n            \"nonlinear\": {\n                \"kappa\": [5.0, 5.5, 6.0, 6.84, 7.2, 7.8],\n                \"Q\": [0.0, 0.0, 0.0, 0.0, 0.15552, 1.10592]\n            }\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # --- 1. Infer linear threshold kappa_lin ---\n        k_lin_data = np.array(case[\"linear\"][\"kappa\"])\n        g_lin_data = np.array(case[\"linear\"][\"gamma\"])\n        \n        # Fit gamma(kappa) = m*kappa + c\n        m, c = np.polyfit(k_lin_data, g_lin_data, 1)\n        \n        # kappa_lin is found where gamma = 0, so m*k_lin + c = 0\n        kappa_lin = -c / m\n\n        # --- 2. Infer nonlinear threshold kappa_NL ---\n        k_nl_data = np.array(case[\"nonlinear\"][\"kappa\"])\n        q_nl_data = np.array(case[\"nonlinear\"][\"Q\"])\n\n        def cost_function(kappa_0, kappa_vals, q_vals):\n            \"\"\"\n            Calculates the least-squares error for a given threshold kappa_0.\n            \"\"\"\n            # Model basis function: X = max(0, kappa - kappa_0)^2\n            X = np.maximum(0, kappa_vals - kappa_0)**2\n            \n            # Solve for the optimal amplitude A >= 0 via linear least squares\n            # A = (Q . X) / (X . X)\n            x_dot_x = np.dot(X, X)\n            \n            if x_dot_x < 1e-15: # Handles cases where all kappa < kappa_0\n                A = 0.0\n            else:\n                q_dot_x = np.dot(q_vals, X)\n                A = q_dot_x / x_dot_x\n\n            # Calculate residuals and sum of squares error\n            q_predicted = A * X\n            residuals = q_vals - q_predicted\n            error = np.dot(residuals, residuals)\n            \n            return error\n\n        # Search for kappa_0 that minimizes the cost function\n        search_bounds = (k_nl_data.min(), k_nl_data.max())\n        \n        opt_result = minimize_scalar(\n            cost_function,\n            bounds=search_bounds,\n            args=(k_nl_data, q_nl_data),\n            method='bounded'\n        )\n        \n        kappa_nl = opt_result.x\n\n        # --- 3. Compute metrics D and Delta ---\n        D = kappa_nl / kappa_lin\n        Delta = kappa_nl - kappa_lin\n\n        results.append((D, Delta))\n\n    # --- 4. Format and print final output ---\n    # Create a list of formatted strings, e.g., \"[1.400,1.800]\"\n    formatted_results = [f\"[{d:.3f},{delta:.3f}]\" for d, delta in results]\n\n    # Join them into the final output string, e.g., \"[[...],[...]]\"\n    output_string = f\"[{','.join(formatted_results)}]\"\n    \n    print(output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "This practice elevates your understanding from analyzing existing data to synthesizing a predictive model from core physical principles. You will implement a reduced model that captures the essential competition between the linear drive of turbulence and its suppression by zonal flows, which is the mechanism underlying the Dimits shift . This hands-on coding exercise will allow you to quantify how the nonlinear transport threshold depends on crucial plasma parameters like the normalized gyroradius, $\\rho_*$, and collisionality, $\\nu_*$.",
            "id": "4185910",
            "problem": "You are tasked with designing and implementing a self-contained numerical experiment that quantifies the Dimits shift for ion-temperature-gradient-driven turbulence by sweeping the normalized ion temperature gradient $R/L_{T_i}$ at fixed normalized Larmor radius $\\rho_*$ and normalized collisionality $\\nu_*$. The objective is to extract the nonlinear threshold range in which the turbulent heat flux remains zero or negligible due to zonal flow regulation, thereby quantifying the Dimits shift in a simplified reduced model.\n\nStart from the following fundamental physical base and assumptions that are widely used in reduced modeling of gyrokinetic turbulence:\n\n1. Ion Temperature Gradient (ITG) linear stability: Near marginal stability, the maximum linear growth rate of the most unstable mode grows approximately linearly with the distance to a critical gradient, so that the linear growth rate may be represented as $ \\gamma_L(R/L_{T_i}) = s \\, \\max\\{0, R/L_{T_i} - (R/L_{T_i})_{\\mathrm{lin}}\\} $, where $s$ is a positive constant slope, and $(R/L_{T_i})_{\\mathrm{lin}}$ is the linear critical gradient.\n\n2. Zonal flow regulation and Dimits shift: Zonal flows are driven by secondary instabilities and shear the turbulent eddies, suppressing turbulence when the zonal flow shearing rate exceeds the linear growth rate. As a minimal model consistent with the scaling trends observed in gyrokinetics, take the zonal flow shearing rate to be inversely proportional to $\\rho_*$ and reduced by collisionality, namely $ \\gamma_{\\mathrm{ZF}} = C_{\\mathrm{ZF}} \\big/ \\big(\\rho_* [1 + C_\\nu \\nu_*]\\big) $, where $C_{\\mathrm{ZF}}$ and $C_\\nu$ are positive constants. The turbulence is suppressed when $\\gamma_L \\le \\gamma_{\\mathrm{ZF}}$, which produces a nonlinear upshift of the onset of finite transport.\n\n3. Transport stiffness closure: In a mixing-length closure, the turbulent heat flux $Q_{\\mathrm{turb}}$ scales like a positive power of the net positive growth rate that survives zonal flow shearing. Model this as $ Q_{\\mathrm{turb}} = K_Q \\, \\big(\\max\\{0, \\gamma_L - \\gamma_{\\mathrm{ZF}}\\}\\big)^p $ with constants $K_Q > 0$ and $p \\ge 1$, which encodes transport stiffness when $p > 1$.\n\nYour program must implement the following experiment design and measurement protocol:\n\n- For each test case, sweep $R/L_{T_i}$ uniformly over a prescribed range with a given step.\n- Compute $Q_{\\mathrm{turb}}(R/L_{T_i}; \\rho_*, \\nu_*)$ from the above model using fixed constants $s$, $C_{\\mathrm{ZF}}$, $C_\\nu$, $K_Q$, and $p$ supplied below.\n- Define the estimated nonlinear threshold $(R/L_{T_i})_{\\mathrm{nl}}$ as the smallest $R/L_{T_i}$ in the sweep for which $Q_{\\mathrm{turb}} \\ge \\epsilon$, where $\\epsilon$ is a small threshold representing “negligible” flux. If no such $R/L_{T_i}$ exists within the scan, report $(R/L_{T_i})_{\\mathrm{nl}}$ as the upper bound of the scan.\n- Define the Dimits shift as $\\Delta_{\\mathrm{Dimits}} = (R/L_{T_i})_{\\mathrm{nl}} - (R/L_{T_i})_{\\mathrm{lin}}$.\n\nUse the following fixed model parameters in your implementation:\n- $s = 1.0$,\n- $C_{\\mathrm{ZF}} = 0.01$,\n- $C_\\nu = 5.0$,\n- $K_Q = 1.0$,\n- $p = 2$.\n\nAll quantities are dimensionless.\n\nTest Suite:\nYour program must compute $\\Delta_{\\mathrm{Dimits}}$ for each of the following parameter sets, each described by a tuple $(\\rho_*, \\nu_*, (R/L_{T_i})_{\\mathrm{lin}}, (R/L_{T_i})_{\\min}, (R/L_{T_i})_{\\max}, \\Delta(R/L_{T_i}), \\epsilon)$:\n\n1. Case A (moderate $\\rho_*$, low $\\nu_*$, clear nonlinear upshift):\n   - $\\rho_* = 0.003$, $\\nu_* = 0.02$, $(R/L_{T_i})_{\\mathrm{lin}} = 4.5$, $(R/L_{T_i})_{\\min} = 3.5$, $(R/L_{T_i})_{\\max} = 9.0$, $\\Delta(R/L_{T_i}) = 0.05$, $\\epsilon = 0.001$.\n\n2. Case B (larger $\\rho_*$, moderate $\\nu_*$, reduced upshift):\n   - $\\rho_* = 0.01$, $\\nu_* = 0.1$, $(R/L_{T_i})_{\\mathrm{lin}} = 4.5$, $(R/L_{T_i})_{\\min} = 3.5$, $(R/L_{T_i})_{\\max} = 9.0$, $\\Delta(R/L_{T_i}) = 0.05$, $\\epsilon = 0.001$.\n\n3. Case C (moderate $\\rho_*$, high $\\nu_*$, small upshift):\n   - $\\rho_* = 0.005$, $\\nu_* = 2.0$, $(R/L_{T_i})_{\\mathrm{lin}} = 4.5$, $(R/L_{T_i})_{\\min} = 3.5$, $(R/L_{T_i})_{\\max} = 9.0$, $\\Delta(R/L_{T_i}) = 0.05$, $\\epsilon = 0.001$.\n\n4. Case D (very small $\\rho_*$, vanishing $\\nu_*$, upshift exceeds scan window):\n   - $\\rho_* = 0.001$, $\\nu_* = 0.0$, $(R/L_{T_i})_{\\mathrm{lin}} = 3.0$, $(R/L_{T_i})_{\\min} = 2.0$, $(R/L_{T_i})_{\\max} = 12.0$, $\\Delta(R/L_{T_i}) = 0.05$, $\\epsilon = 0.001$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as [Case A, Case B, Case C, Case D], where each entry is the computed $\\Delta_{\\mathrm{Dimits}}$ rounded to three decimals. For example, an output of the form $[3.100,0.700,0.250,9.000]$ would be acceptable. No additional text should be printed.",
            "solution": "We outline a principle-based derivation that links the minimal physics of critical gradient behavior, zonal flow regulation, and transport stiffness to an algorithm for extracting the Dimits shift from a numerical parameter sweep.\n\nFirst principles and reduced modeling assumptions:\n\n1. Linear drive near marginality. In Ion Temperature Gradient (ITG) turbulence, the free energy source is the ion temperature gradient. Near the linear critical gradient $(R/L_{T_i})_{\\mathrm{lin}}$, the most unstable linear mode has growth rate that increases approximately linearly with the distance above threshold. This is a standard result of linear gyrokinetics and two-scale expansion around marginality. We represent this as\n$$\n\\gamma_L(R/L_{T_i}) = s \\, \\max\\{0,\\; R/L_{T_i} - (R/L_{T_i})_{\\mathrm{lin}}\\},\n$$\nwhere $s>0$ is a slope that converts a gradient increment into a growth rate increment. This captures the onset of instability at $R/L_{T_i}=(R/L_{T_i})_{\\mathrm{lin}}$ and a proportional increase thereafter.\n\n2. Zonal flow suppression and the Dimits shift. Zonal flows are $E\\times B$ shear flows at poloidal and toroidal mode numbers $(m,n)=(0,0)$ that derive their free energy from turbulent Reynolds stress via secondary and tertiary processes. In the Dimits regime, these zonal flows are efficiently generated and weakly damped, producing shear decorrelation of turbulent eddies. Suppression occurs when the zonal flow shearing rate exceeds the linear growth rate, i.e.,\n$$\n\\gamma_{\\mathrm{ZF}} \\gtrsim \\gamma_L,\n$$\nso the effective growth rate of turbulence is reduced to zero. The Dimits shift is the nonlinear upshift of the transport onset relative to the linear marginal point. A reduced scaling for the zonal flow shearing rate consistent with standard gyrokinetic trends includes the following:\n- Stronger shearing with smaller $\\rho_*$ due to enhanced scale separation: $\\gamma_{\\mathrm{ZF}} \\propto 1/\\rho_*$.\n- Collisional damping that weakens zonal flows: $\\gamma_{\\mathrm{ZF}}$ is reduced as $\\nu_*$ increases.\nWe take the minimal form\n$$\n\\gamma_{\\mathrm{ZF}} = \\frac{C_{\\mathrm{ZF}}}{\\rho_* \\, \\big(1 + C_\\nu \\nu_*\\big)},\n$$\nwhere $C_{\\mathrm{ZF}}>0$ and $C_\\nu>0$ are model constants. This scaling captures the established sensitivity of the Dimits shift to $\\rho_*$ and $\\nu_*$: larger shift for smaller $\\rho_*$ and smaller $\\nu_*$, and reduced shift as collisionality increases.\n\n3. Transport stiffness closure. In a mixing-length spirit, the turbulent thermal diffusivity $\\chi_t$ scales like a correlation length squared times a decorrelation rate. Using the effective growth rate\n$$\n\\gamma_{\\mathrm{eff}} = \\max\\{0, \\gamma_L - \\gamma_{\\mathrm{ZF}}\\},\n$$\nand absorbing scale factors into a coefficient, a phenomenological closure for the ion turbulent heat flux is\n$$\nQ_{\\mathrm{turb}} = K_Q \\, \\gamma_{\\mathrm{eff}}^p,\n$$\nwith $K_Q>0$ and $p\\ge 1$. Choosing $p=2$ encodes transport stiffness observed in gyrokinetic simulations, where flux increases rapidly once suppression is lost. This form respects that $Q_{\\mathrm{turb}}=0$ whenever $\\gamma_{\\mathrm{eff}}=0$.\n\nMeasuring the Dimits shift:\n\n- The nonlinear transport threshold $(R/L_{T_i})_{\\mathrm{nl}}$ is the smallest $R/L_{T_i}$ such that $Q_{\\mathrm{turb}} \\ge \\epsilon$, for a prescribed small $\\epsilon>0$, representing a negligible heat flux threshold. The discrete sweep spacing sets resolution.\n- The Dimits shift is\n$$\n\\Delta_{\\mathrm{Dimits}} = (R/L_{T_i})_{\\mathrm{nl}} - (R/L_{T_i})_{\\mathrm{lin}}.\n$$\n- If the scan does not reach a point where $Q_{\\mathrm{turb}} \\ge \\epsilon$, then $(R/L_{T_i})_{\\mathrm{nl}}$ is at least the upper bound of the scan, and we report a lower bound on the shift by taking $(R/L_{T_i})_{\\mathrm{nl}}=(R/L_{T_i})_{\\max}$.\n\nAlgorithm:\n\n1. Fix model constants $s$, $C_{\\mathrm{ZF}}$, $C_\\nu$, $K_Q$, $p$ and a negligible flux floor $\\epsilon$.\n2. For a given $(\\rho_*, \\nu_*, (R/L_{T_i})_{\\mathrm{lin}})$ and a sweep grid $R/L_{T_i} \\in [(R/L_{T_i})_{\\min}, (R/L_{T_i})_{\\max}]$ with step $\\Delta(R/L_{T_i})$, compute:\n   - $\\gamma_L(R/L_{T_i}) = s \\, \\max\\{0, R/L_{T_i} - (R/L_{T_i})_{\\mathrm{lin}}\\}$,\n   - $\\gamma_{\\mathrm{ZF}} = C_{\\mathrm{ZF}} / (\\rho_* (1 + C_\\nu \\nu_*))$,\n   - $\\gamma_{\\mathrm{eff}} = \\max\\{0, \\gamma_L - \\gamma_{\\mathrm{ZF}}\\}$,\n   - $Q_{\\mathrm{turb}} = K_Q \\, (\\gamma_{\\mathrm{eff}})^p$.\n3. Find the smallest $R/L_{T_i}$ in the grid such that $Q_{\\mathrm{turb}} \\ge \\epsilon$, define it as $(R/L_{T_i})_{\\mathrm{nl}}$, and compute $\\Delta_{\\mathrm{Dimits}}$.\n4. If none satisfies the condition, set $(R/L_{T_i})_{\\mathrm{nl}} = (R/L_{T_i})_{\\max}$ and compute the corresponding lower bound on $\\Delta_{\\mathrm{Dimits}}$.\n\nWith the specified constants $s=1.0$, $C_{\\mathrm{ZF}}=0.01$, $C_\\nu=5.0$, $K_Q=1.0$, $p=2$, and $\\epsilon=0.001$, the test cases yield the following reasoning:\n\n- Case A: $\\rho_* = 0.003$, $\\nu_* = 0.02$. Then $\\gamma_{\\mathrm{ZF}} = 0.01 / (0.003 \\cdot (1 + 5 \\cdot 0.02)) = 0.01 / (0.003 \\cdot 1.1) \\approx 3.0303$. The linear threshold is at $(R/L_{T_i})_{\\mathrm{lin}}=4.5$. The discrete scan with step $\\Delta(R/L_{T_i})=0.05$ produces $(R/L_{T_i})_{\\mathrm{nl}} \\approx 7.6$ as the first point where $Q_{\\mathrm{turb}} \\ge 0.001$, hence $\\Delta_{\\mathrm{Dimits}} \\approx 7.6 - 4.5 = 3.1$.\n\n- Case B: $\\rho_* = 0.01$, $\\nu_* = 0.1$. Then $\\gamma_{\\mathrm{ZF}} = 0.01 / (0.01 \\cdot (1 + 5 \\cdot 0.1)) = 0.01 / (0.01 \\cdot 1.5) = 0.6667$. The first point exceeding the flux floor occurs at $(R/L_{T_i})_{\\mathrm{nl}} \\approx 5.2$, giving $\\Delta_{\\mathrm{Dimits}} \\approx 0.7$.\n\n- Case C: $\\rho_* = 0.005$, $\\nu_* = 2.0$. Then $\\gamma_{\\mathrm{ZF}} = 0.01 / (0.005 \\cdot (1 + 5 \\cdot 2.0)) = 0.01 / (0.005 \\cdot 11) \\approx 0.1818$. The scan resolves $(R/L_{T_i})_{\\mathrm{nl}} \\approx 4.75$, giving $\\Delta_{\\mathrm{Dimits}} \\approx 0.25$.\n\n- Case D: $\\rho_* = 0.001$, $\\nu_* = 0.0$. Then $\\gamma_{\\mathrm{ZF}} = 0.01 / (0.001 \\cdot (1 + 0)) = 10$. With $(R/L_{T_i})_{\\mathrm{lin}}=3.0$ and scan up to $(R/L_{T_i})_{\\max}=12.0$, the nonlinear threshold would be $(R/L_{T_i})_{\\mathrm{lin}} + \\gamma_{\\mathrm{ZF}}/s = 13.0$, which exceeds the scan window, so no $R/L_{T_i}$ in the sweep produces $Q_{\\mathrm{turb}} \\ge \\epsilon$. By the measurement protocol, report $(R/L_{T_i})_{\\mathrm{nl}}=(R/L_{T_i})_{\\max}=12.0$, yielding a lower bound $\\Delta_{\\mathrm{Dimits}} = 12.0 - 3.0 = 9.0$.\n\nThe program will implement this algorithm, sweep the specified grids, detect the onset according to the flux criterion, and print a single line with the four shifts rounded to three decimals in the requested order. This procedure operationalizes the concept of the Dimits shift through a minimal, physically grounded surrogate model and a reproducible numerical experiment design.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_gamma_L(RL, RL_lin, s):\n    # Linear growth rate model near threshold\n    return s * max(0.0, RL - RL_lin)\n\ndef compute_gamma_ZF(rho_star, nu_star, C_ZF, C_nu):\n    # Zonal flow shearing rate scaling with rho_* and nu_*\n    return C_ZF / (rho_star * (1.0 + C_nu * nu_star))\n\ndef compute_Q_turb(gamma_L, gamma_ZF, K_Q, p):\n    # Transport stiffness closure with net positive growth\n    gamma_eff = max(0.0, gamma_L - gamma_ZF)\n    return K_Q * (gamma_eff ** p)\n\ndef dimits_shift_for_case(case, s, C_ZF, C_nu, K_Q, p):\n    rho_star, nu_star, RL_lin, RL_min, RL_max, dRL, eps = case\n    gamma_ZF = compute_gamma_ZF(rho_star, nu_star, C_ZF, C_nu)\n    # Create RL grid including RL_max\n    # Add a small numerical epsilon to include upper bound reliably\n    RL_vals = np.arange(RL_min, RL_max + 0.5 * dRL, dRL)\n    RL_nl = RL_max  # default to upper bound if not found\n    found = False\n    for RL in RL_vals:\n        gL = compute_gamma_L(RL, RL_lin, s)\n        Q = compute_Q_turb(gL, gamma_ZF, K_Q, p)\n        if Q >= eps:\n            RL_nl = RL\n            found = True\n            break\n    # Dimits shift definition\n    shift = RL_nl - RL_lin\n    return shift\n\ndef solve():\n    # Fixed model constants\n    s = 1.0\n    C_ZF = 0.01\n    C_nu = 5.0\n    K_Q = 1.0\n    p = 2\n\n    # Define the test cases from the problem statement:\n    # (rho_*, nu_*, RL_lin, RL_min, RL_max, dRL, eps)\n    test_cases = [\n        (0.003, 0.02, 4.5, 3.5, 9.0, 0.05, 0.001),  # Case A\n        (0.01,  0.1,  4.5, 3.5, 9.0, 0.05, 0.001),  # Case B\n        (0.005, 2.0,  4.5, 3.5, 9.0, 0.05, 0.001),  # Case C\n        (0.001, 0.0,  3.0, 2.0, 12.0, 0.05, 0.001)  # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        shift = dimits_shift_for_case(case, s, C_ZF, C_nu, K_Q, p)\n        # Round to three decimals as required\n        results.append(f\"{shift:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}