{
    "hands_on_practices": [
        {
            "introduction": "Understanding the interaction between fast ions and turbulence begins with characterizing the fast-ion population itself. In a thermalizing plasma, the equilibrium fast-ion distribution function, $F_{0f}$, is not Maxwellian but is shaped by the continuous process of slowing down on background electrons and ions. This exercise  challenges you to derive the critical energy, $E_c$, where the collisional drag from electrons equals that from ions. By calculating this fundamental parameter, you will gain insight into how the structure of $F_{0f}$ is formed, which is essential for determining the available free energy that can drive or damp turbulent modes.",
            "id": "4189028",
            "problem": "A monoenergetic population of fast deuterium ions with charge number $Z_{t}=1$ and mass $M = m_{D}$ is injected into a homogeneous, fully ionized deuterium plasma. Assume quasineutrality with $n_{e} \\simeq n_{i}$, where $n_{e}$ and $n_{i}$ are the electron and deuterium ion densities, respectively. The electrons and bulk deuterium ions are Maxwellian with temperatures $T_{e}$ and $T_{i}$, and the Coulomb logarithm $\\ln\\Lambda$ is the same in electron and ion collisions. Consider the classical test-particle Coulomb collision operator in the Fokker–Planck description, and use the asymptotic limits of the test-particle drag on a Maxwellian background: the low-speed limit for electrons relative to $v_{Te}$ and the high-speed limit for ions relative to $v_{Ti}$. From first principles, derive the condition for the critical speed $v_{c}$ at which the electron drag equals the ion drag, and hence obtain the critical energy $E_{c} = \\frac{1}{2} M v_{c}^{2}$ for the fast deuterium ions.\n\nUse the following parameters: $n_{e} = 6.0 \\times 10^{19}\\,\\mathrm{m}^{-3}$, $n_{i} = 6.0 \\times 10^{19}\\,\\mathrm{m}^{-3}$, $T_{e} = 10\\,\\mathrm{keV}$, $T_{i} = 5\\,\\mathrm{keV}$, $m_{e} = 9.109 \\times 10^{-31}\\,\\mathrm{kg}$, $m_{D} = 3.344 \\times 10^{-27}\\,\\mathrm{kg}$, and $1\\,\\mathrm{eV} = 1.602176634 \\times 10^{-19}\\,\\mathrm{J}$. You may assume that the Coulomb logarithm $\\ln\\Lambda$ and the factor $Z_{t}^{2}$ cancel between electron and ion drag in the ratio defining $v_{c}$.\n\nCompute the numerical value of $E_{c}$ for the deuterium fast ions using these assumptions. Express the final energy in $\\mathrm{keV}$ and round your answer to three significant figures.\n\nFinally, explain qualitatively how the location of $E_{c}$ imprints a knee in the equilibrium fast-ion distribution $F_{0f}(v)$ that is used in gyrokinetic simulations, and how this knee can modify coupling to microturbulence by altering velocity-space gradients and resonance conditions. The discussion does not affect the numerical answer requirement and is for conceptual completeness only.",
            "solution": "The user-provided problem is a valid, well-posed, and scientifically grounded problem in the field of plasma physics. It is a standard derivation and calculation concerning the collisional slowing-down of fast ions in a plasma. All necessary parameters and physical assumptions are provided, and no contradictions or unsound premises are present. Therefore, I will proceed with a full solution.\n\nThe problem asks for the derivation of the critical energy $E_c$ at which the collisional drag on a fast deuterium ion from background electrons equals the drag from background ions. The derivation begins from the Fokker-Planck description of Coulomb collisions.\n\nLet the test particle (fast deuterium ion) have mass $M=m_D$, charge $Z_t e$, and velocity $\\mathbf{v}$. The background plasma consists of electrons (species 'e') and deuterium ions (species 'i'), which are Maxwellian with temperatures $T_e$ and $T_i$ and densities $n_e$ and $n_i$, respectively. Let the charge of background ions be $Z_i e$.\n\nThe frictional drag force $\\mathbf{F}_{ts}$ on a test particle 't' due to collisions with a background species 's' is given by:\n$$ \\mathbf{F}_{ts} = - (1 + \\frac{M}{m_s}) \\frac{Z_t^2 Z_s^2 e^4 n_s \\ln\\Lambda}{4\\pi\\epsilon_0^2 M} \\frac{\\mathbf{v}}{v^3} \\Psi(x_s) $$\nwhere $m_s$ and $Z_s e$ are the mass and charge of the background species, $v=|\\mathbf{v}|$ is the speed of the test particle, $x_s = v/v_{Ts}$ is the ratio of the test particle speed to the thermal speed of species 's' ($v_{Ts} = \\sqrt{2T_s/m_s}$), and $\\Psi(x_s)$ is the Chandrasekhar function:\n$$ \\Psi(x_s) = \\mathrm{erf}(x_s) - \\frac{2x_s}{\\sqrt{\\pi}}\\exp(-x_s^2) $$\nThe rate of energy loss of the test particle to species 's' is given by $\\frac{dE}{dt}|_s = \\mathbf{F}_{ts} \\cdot \\mathbf{v}$. We are interested in the magnitude of this energy loss rate.\n$$ \\left| \\frac{dE}{dt} \\right|_s = (1 + \\frac{M}{m_s}) \\frac{Z_t^2 Z_s^2 e^4 n_s \\ln\\Lambda}{4\\pi\\epsilon_0^2 M} \\frac{1}{v} \\Psi(x_s) $$\nWe now apply the asymptotic limits specified in the problem.\n\n**Drag on Electrons (s=e)**\nThe problem states to use the low-speed limit, $v \\ll v_{Te}$, which implies $x_e = v/v_{Te} \\ll 1$. The Chandrasekhar function $\\Psi(x_e)$ can be approximated for small $x_e$ by expanding the error function and exponential:\n$$ \\mathrm{erf}(x_e) \\approx \\frac{2}{\\sqrt{\\pi}}(x_e - \\frac{x_e^3}{3}) \\quad \\text{and} \\quad \\exp(-x_e^2) \\approx 1 - x_e^2 $$\n$$ \\Psi(x_e) \\approx \\frac{2}{\\sqrt{\\pi}}(x_e - \\frac{x_e^3}{3}) - \\frac{2x_e}{\\sqrt{\\pi}}(1 - x_e^2) = \\frac{2}{\\sqrt{\\pi}} \\left( x_e - \\frac{x_e^3}{3} - x_e + x_e^3 \\right) = \\frac{4x_e^3}{3\\sqrt{\\pi}} $$\nThe prefactor $(1 + M/m_e)$ is approximately $M/m_e$ since $M \\gg m_e$. The energy loss rate to electrons becomes:\n$$ \\left| \\frac{dE}{dt} \\right|_e \\approx \\frac{M}{m_e} \\frac{Z_t^2 e^4 n_e \\ln\\Lambda}{4\\pi\\epsilon_0^2 M} \\frac{1}{v} \\left( \\frac{4x_e^3}{3\\sqrt{\\pi}} \\right) = \\frac{Z_t^2 e^4 n_e \\ln\\Lambda}{3\\pi^{3/2}\\epsilon_0^2 m_e} \\frac{x_e^3}{v} $$\nSubstituting $x_e = v/v_{Te}$ and $E = \\frac{1}{2} M v^2$:\n$$ \\left| \\frac{dE}{dt} \\right|_e \\approx \\frac{Z_t^2 e^4 n_e \\ln\\Lambda}{3\\pi^{3/2}\\epsilon_0^2 m_e v_{Te}^3} v^2 = \\frac{Z_t^2 e^4 n_e \\ln\\Lambda}{3\\pi^{3/2}\\epsilon_0^2 m_e v_{Te}^3} \\frac{2E}{M} $$\n\n**Drag on Ions (s=i)**\nThe problem states to use the high-speed limit, $v \\gg v_{Ti}$, which implies $x_i = v/v_{Ti} \\gg 1$. In this limit, $\\mathrm{erf}(x_i) \\to 1$ and $\\exp(-x_i^2) \\to 0$, so $\\Psi(x_i) \\approx 1$.\nThe energy loss rate to ions is:\n$$ \\left| \\frac{dE}{dt} \\right|_i \\approx (1 + \\frac{M}{m_i}) \\frac{Z_t^2 Z_i^2 e^4 n_i \\ln\\Lambda}{4\\pi\\epsilon_0^2 M} \\frac{1}{v} $$\nIn this problem, the background ions are also deuterium, so $m_i = m_D = M$ and $Z_i = 1$. The quasineutrality condition for a deuterium plasma is $n_e \\simeq n_i$. The prefactor becomes $(1 + M/M) = 2$.\n$$ \\left| \\frac{dE}{dt} \\right|_i \\approx 2 \\frac{Z_t^2 e^4 n_i \\ln\\Lambda}{4\\pi\\epsilon_0^2 M} \\frac{1}{v} = \\frac{Z_t^2 e^4 n_i \\ln\\Lambda}{2\\pi\\epsilon_0^2 M v} $$\n\n**Critical Speed and Energy**\nThe critical speed $v_c$ is defined by the condition that the electron and ion drag rates are equal. Let $E_c = \\frac{1}{2} M v_c^2$.\n$$ \\left| \\frac{dE}{dt} \\right|_e = \\left| \\frac{dE}{dt} \\right|_i $$\n$$ \\frac{Z_t^2 e^4 n_e \\ln\\Lambda}{3\\pi^{3/2}\\epsilon_0^2 m_e v_{Te}^3} v_c^2 = \\frac{Z_t^2 e^4 n_i \\ln\\Lambda}{2\\pi\\epsilon_0^2 M v_c} $$\nThe problem states that $Z_t^2$ and $\\ln\\Lambda$ cancel. With $n_e=n_i$, we can simplify:\n$$ \\frac{1}{3\\pi^{3/2} m_e v_{Te}^3} v_c^2 = \\frac{1}{2\\pi M v_c} $$\nSolving for $v_c^3$:\n$$ v_c^3 = \\frac{3\\pi^{3/2} m_e v_{Te}^3}{2\\pi M} = \\frac{3\\sqrt{\\pi} m_e v_{Te}^3}{2 M} $$\nNow, substitute the thermal velocity $v_{Te} = \\sqrt{2T_e/m_e}$:\n$$ v_c^3 = \\frac{3\\sqrt{\\pi} m_e}{2 M} \\left(\\frac{2T_e}{m_e}\\right)^{3/2} = \\frac{3\\sqrt{\\pi} m_e}{2 M} \\frac{2\\sqrt{2} T_e^{3/2}}{m_e^{3/2}} = \\frac{3\\sqrt{2\\pi} T_e^{3/2}}{M \\sqrt{m_e}} $$\nThe critical energy is $E_c = \\frac{1}{2} M v_c^2 = \\frac{1}{2} M (v_c^3)^{2/3}$.\n$$ E_c = \\frac{1}{2} M \\left( \\frac{3\\sqrt{2\\pi} T_e^{3/2}}{M \\sqrt{m_e}} \\right)^{2/3} = \\frac{1}{2} M \\frac{(18\\pi)^{1/3} T_e}{M^{2/3} m_e^{1/3}} $$\n$$ E_c = \\frac{1}{2} (18\\pi)^{1/3} M^{1/3} m_e^{-1/3} T_e = \\frac{1}{2} (18\\pi)^{1/3} \\left(\\frac{M}{m_e}\\right)^{1/3} T_e $$\n\n**Numerical Calculation**\nWe are given $M = m_D = 3.344 \\times 10^{-27}\\,\\mathrm{kg}$, $m_e = 9.109 \\times 10^{-31}\\,\\mathrm{kg}$, and $T_e = 10\\,\\mathrm{keV}$.\nFirst, calculate the mass ratio:\n$$ \\frac{M}{m_e} = \\frac{3.344 \\times 10^{-27}\\,\\mathrm{kg}}{9.109 \\times 10^{-31}\\,\\mathrm{kg}} \\approx 3671.09 $$\nNow, calculate the numerical prefactor for $T_e$:\n$$ \\frac{E_c}{T_e} = \\frac{1}{2} (18\\pi)^{1/3} \\left(\\frac{M}{m_e}\\right)^{1/3} \\approx \\frac{1}{2} (18 \\times 3.14159)^{1/3} (3671.09)^{1/3} $$\n$$ \\frac{E_c}{T_e} \\approx \\frac{1}{2} (56.5487)^{1/3} (15.4294) \\approx \\frac{1}{2} (3.8383) (15.4294) \\approx 29.605 $$\nThe critical energy is approximately $29.605$ times the electron temperature.\n$$ E_c \\approx 29.605 \\times T_e = 29.605 \\times 10\\,\\mathrm{keV} = 296.05\\,\\mathrm{keV} $$\nRounding to three significant figures, the critical energy is $296\\,\\mathrm{keV}$.\n\n**Qualitative Discussion**\nThe critical energy $E_c$ marks a transition in the collisional dynamics of fast ions. For fast ion energies $E \\gg E_c$, the ion slows down primarily on electrons, with an energy loss rate $|dE/dt|_e \\propto E$. For energies $E \\ll E_c$, slowing down on background ions dominates, with a loss rate $|dE/dt|_i \\propto E^{-1/2}$.\n\nIn a steady-state system with a fast ion source at high energy (e.g., from neutral beam injection or fusion reactions), the equilibrium fast-ion distribution function, $F_{0f}$, is determined by the balance between the source and the collisional slowing-down. In the source-free region of velocity space, the particle flux in energy space is constant. This leads to a distribution function of the form $F_{0f}(E) \\propto 1/|dE/dt|_{total}$. The total energy loss rate is the sum of the rates onto electrons and ions: $|dE/dt|_{total} \\propto E + E_c^{3/2} E^{-1/2}$. This functional form results in a distinct change in the slope of the distribution function $F_{0f}(E)$ around $E=E_c$. Specifically, $F_{0f}(E) \\propto E^{-1}$ for $E \\gg E_c$ and $F_{0f}(E) \\propto E^{1/2}$ for $E \\ll E_c$. This transition region is often referred to as a \"knee\" in the fast-ion distribution.\n\nThe location and shape of this knee are significant for gyrokinetic simulations of microturbulence.\n1.  **Velocity-Space Gradients as Instability Drive**: Instabilities are driven by gradients in the distribution function. The knee at $E_c$ creates a region where the energy gradient $\\partial F_{0f}/\\partial E$ changes character. For $E>E_c$, $\\partial F_{0f}/\\partial E < 0$, providing a source of free energy that can drive kinetic instabilities, such as Alfvén eigenmodes. The magnitude of this gradient, which is influenced by the value of $E_c$ relative to the source energy, determines the strength of the drive.\n2.  **Modification of Resonance Conditions**: The interaction between fast ions and microturbulence is governed by wave-particle resonances of the form $\\omega - k_{\\parallel}v_{\\parallel} - n\\omega_c = 0$. The population of resonant particles depends on the structure of $F_{0f}(v)$. The knee at $v_c$ dictates the number of particles available for resonance in different velocity ranges. A shift in $E_c$ (e.g., due to a change in $T_e$) can alter which particles are resonant with a given mode, thereby changing the stability properties of that mode. For instance, it can modify the stabilizing effect that fast ions often have on ion temperature gradient (ITG) modes or change the growth rate of fast ion-driven modes.\n\nIn summary, the critical energy $E_c$ is a fundamental parameter that structures the fast-ion equilibrium distribution, and this structure, particularly the knee, directly impacts the interaction between fast ions and microturbulence in fusion plasmas.",
            "answer": "$$\\boxed{296}$$"
        },
        {
            "introduction": "The interaction strength between a fast ion and a turbulent fluctuation depends critically on their relative scales. Because fast ions have large Larmor radii, $\\rho_f$, they effectively average the turbulent potential over their gyro-orbit, a process known as the Finite Larmor Radius (FLR) effect. This practice  delves into this crucial mechanism by asking you to derive a threshold for the dimensionless parameter $k_\\perp\\rho_f$ beyond which turbulent transport is strongly suppressed. Mastering this concept is key to understanding why fast ions can exhibit significantly better confinement than thermal ions in a turbulent plasma.",
            "id": "4188975",
            "problem": "Consider a magnetized plasma populated by fast ions with Larmor radius $\\rho_{f}$ interacting with electrostatic drift-wave turbulence. In the quasilinear (QL) limit of the gyrokinetic (GK) theory, the coupling of fast ions to turbulent fluctuations at perpendicular wavenumber $k_{\\perp}$ is modified by the finite Larmor radius (FLR) gyroaveraging factor, which enters as the zeroth-order Bessel function $J_{0}(k_{\\perp}\\rho_{f})$ in the fast-ion response. The fast-ion quasilinear diffusivity $D_{\\mathrm{QL}}$ can be written schematically as a spectral sum where the FLR factor appears multiplicatively with the turbulent field amplitude and the wave-particle resonance kernel. Introduce the dimensionless suppression factor $S(x) = J_{0}^{2}(x)$, with $x \\equiv k_{\\perp}\\rho_{f}$, so that $D_{\\mathrm{QL}}$ at fixed resonance and spectrum is reduced by the factor $S(x)$ relative to its zero-Larmor-radius limit.\n\nAdopt the operational criterion that fast-ion diffusion is “significant” when $S(x) \\ge \\eta$ for a prescribed threshold $0 < \\eta < 1$, and “suppressed” when $S(x) \\le \\eta$. Using only well-tested properties of the Bessel function $J_{0}(x)$, derive a conservative threshold $x_{\\mathrm{th}}(\\eta)$ such that for all $x \\ge x_{\\mathrm{th}}(\\eta)$, the inequality $S(x) \\le \\eta$ holds irrespective of the detailed phase alignment of the fast-ion gyroangle with the perpendicular wave field. Your derivation should start from a fundamental representation or asymptotic form of $J_{0}(x)$ and logically justify the sufficiency of the threshold. State the final expression for $x_{\\mathrm{th}}(\\eta)$ as a single closed-form analytic expression, with no rounding required. The quantity $x_{\\mathrm{th}}$ is dimensionless, so no physical units are required in the final answer.",
            "solution": "The quasilinear (QL) gyrokinetic (GK) formulation for fast-ion transport in electrostatic turbulence features the finite Larmor radius (FLR) modification of the perpendicular coupling as a factor $J_{0}(k_{\\perp}\\rho_{f})$, arising from gyroaveraging over the fast-ion circular orbit. This factor is well known from the Fourier-Bessel representation of the gyroaverage of an exponential perturbation. When focusing on how FLR suppresses transport relative to the zero-Larmor-radius limit, a dimensionless measure of suppression is\n$$\nS(x) \\equiv J_{0}^{2}(x), \\quad x \\equiv k_{\\perp}\\rho_{f}.\n$$\nUnder fixed resonance and turbulence spectrum, the quasilinear diffusivity $D_{\\mathrm{QL}}$ is reduced by $S(x)$, so that $S(x) \\ge \\eta$ indicates “significant” diffusion and $S(x) \\le \\eta$ indicates “suppressed” diffusion, for a prescribed threshold $0<\\eta<1$.\n\nTo find a conservative (sufficient) threshold $x_{\\mathrm{th}}(\\eta)$ ensuring $S(x) \\le \\eta$ for all $x \\ge x_{\\mathrm{th}}$, independent of the phase of the oscillations, we require an upper bound on $|J_{0}(x)|$ that is valid for large $x$. A standard, well-tested asymptotic form of the Bessel function of the first kind for large argument is\n$$\nJ_{0}(x) \\simeq \\sqrt{\\frac{2}{\\pi x}} \\cos\\!\\left(x - \\frac{\\pi}{4}\\right), \\quad x \\gg 1.\n$$\nThis asymptotic expansion follows from the method of stationary phase applied to the integral representation $J_{0}(x) = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\exp(i x \\cos\\theta)\\, d\\theta$, and it exhibits an oscillatory behavior with an envelope amplitude $|J_{0}(x)| \\lesssim \\sqrt{\\frac{2}{\\pi x}}$ (for $x \\gg 1$) for sufficiently large $x$. While the asymptotic expression is approximate, it provides a conservative envelope: the magnitude of $J_{0}(x)$ decays approximately like $x^{-1/2}$, and the oscillations are bounded in magnitude by the envelope amplitude $\\sqrt{2/(\\pi x)}$ for sufficiently large $x$. Using this envelope bound, we obtain the inequality $|J_{0}(x)| \\le \\sqrt{\\frac{2}{\\pi x}}$ (for large $x$), which then yields\n$$\nS(x) = J_{0}^{2}(x) \\le \\frac{2}{\\pi x}.\n$$\nTo guarantee $S(x) \\le \\eta$ for any oscillatory phase at given $x$, it is sufficient that the envelope satisfy\n$$\n\\frac{2}{\\pi x} \\le \\eta.\n$$\nSolving this inequality for $x$ gives the conservative threshold\n$$\nx_{\\mathrm{th}}(\\eta) = \\frac{2}{\\pi \\eta}.\n$$\nFor all $x \\ge x_{\\mathrm{th}}(\\eta)$, the envelope bound forces $|J_{0}(x)| \\le \\sqrt{\\eta}$ and hence $S(x) \\le \\eta$, independent of the detailed interference between fast-ion gyrophase and the perpendicular wave field. This threshold explicitly identifies the $k_{\\perp}\\rho_{f}$ regimes where fast-ion quasilinear diffusion is suppressed by FLR effects in the sense of the operational criterion.\n\nIt is worth noting two complementary regimes: for small $x$, one has the Taylor expansion $J_{0}(x) = 1 - x^{2}/4 + \\mathcal{O}(x^{4})$, indicating little suppression; near the zeros $x_{n}$ of $J_{0}(x)$, $S(x)$ is strongly suppressed. However, the derived $x_{\\mathrm{th}}(\\eta)$ provides a simple, phase-independent, sufficient condition for suppression based solely on the large-$x$ envelope, which is the requested conservative threshold.\n\nTherefore, the final closed-form analytic expression for the conservative suppression threshold is\n$$\nx_{\\mathrm{th}}(\\eta) = \\frac{2}{\\pi \\eta}.\n$$",
            "answer": "$$\\boxed{\\frac{2}{\\pi \\eta}}$$"
        },
        {
            "introduction": "The ultimate outcome of the fast ion-turbulence interaction is a net exchange of energy, which can either damp the turbulence or drive it to larger amplitudes. This net power transfer is quantified by integrating the product of the non-adiabatic part of the fast-ion distribution, $h_f$, and the rate of change of the gyrokinetic potential, $\\partial_t \\chi$, over all of velocity space. This computational exercise  provides a direct, hands-on experience in calculating this energy exchange from first principles, mimicking the analysis performed on real gyrokinetic simulation data. By implementing the numerical integration, you will gain a practical understanding of how to determine whether the fast-ion population acts as a net source (drive) or sink (damping) of turbulent energy.",
            "id": "4188971",
            "problem": "Consider the turbulent energy transfer between fields and a fast-ion species in the electrostatic limit of Gyrokinetic (GK) theory. Starting from the kinetic description, the species-field energy exchange rate density at a fixed time $t$ can be quantified by evaluating the velocity-space correlation integral\n$P_f(t) = \\int h_f(\\mathbf{v}, t)\\,\\partial_t \\chi(\\mathbf{v}, t)\\,d^3v$,\nwhere $h_f$ denotes the non-adiabatic part of the fast-ion distribution function and $\\chi$ denotes the GK potential. In an axisymmetric velocity space, introduce cylindrical coordinates with $v_\\parallel \\in [-v_{\\max}, v_{\\max}]$ and $v_\\perp \\in [0, v_{\\max}]$, so that $d^3v = 2\\pi\\,v_\\perp\\,dv_\\perp\\,dv_\\parallel$. Assume all quantities are given in a consistent, dimensionless GK normalization, so numerical values do not require conversion to physical units.\n\nYour task is to write a complete, runnable program that:\n- Constructs uniform velocity-space grids for $v_\\parallel$ and $v_\\perp$ with spacings $\\Delta v_\\parallel$ and $\\Delta v_\\perp$, evaluates $h_f(v_\\parallel, v_\\perp)$ and $\\partial_t \\chi(v_\\parallel, v_\\perp)$ for each test case, and computes the discrete approximation\n$$\nP_f \\approx \\sum_{i=1}^{N_\\parallel}\\sum_{j=1}^{N_\\perp} h_f(v_{\\parallel,i}, v_{\\perp,j})\\,\\partial_t \\chi(v_{\\parallel,i}, v_{\\perp,j})\\,\\left(2\\pi\\,v_{\\perp,j}\\,\\Delta v_\\perp\\,\\Delta v_\\parallel\\right).\n$$\n- Interprets the sign of $P_f$ as follows: if $P_f > 0$ then the fast ions are a net sink of turbulent energy (net damping, encoded as the integer $+1$); if $P_f < 0$ then fast ions are a net source to turbulent energy (net drive, encoded as the integer $-1$); if $P_f = 0$ within numerical tolerance, encode as the integer $0$.\n\nImplement the following test suite, where all parameters are dimensionless and the velocity-space measure is $d^3v = 2\\pi\\,v_\\perp\\,dv_\\perp\\,dv_\\parallel$:\n\n- Test case $1$ (happy path, net damping expected): Use $v_{\\max} = 4$, $N_\\parallel = 201$, $N_\\perp = 200$, and $\\sigma = 1$. Define\n$$\nh_f(v_\\parallel, v_\\perp) = A\\,\\exp\\!\\left(-\\frac{v_\\parallel^2 + v_\\perp^2}{2\\sigma^2}\\right)\\left(1 + \\delta \\cos(k\\,v_\\parallel)\\right) + \\delta_b\\,\\exp\\!\\left(-\\frac{(v_\\parallel - v_b)^2}{2 w_b^2}\\right)\\exp\\!\\left(-\\frac{(v_\\perp - v_{p,b})^2}{2 w_{p,b}^2}\\right),\n$$\nwith $A = 0.1$, $\\delta = 0.05$, $k = 1.2$, $\\delta_b = 0.02$, $v_b = 1.8$, $v_{p,b} = 0.4$, $w_b = 0.25$, $w_{p,b} = 0.2$. Take a uniform $\\partial_t \\chi = c_0$ with $c_0 = 0.01$.\n\n- Test case $2$ (net drive expected by sign reversal): Use the same $h_f$ as in test case $1$, but take a uniform $\\partial_t \\chi = c_0$ with $c_0 = -0.015$.\n\n- Test case $3$ (symmetry boundary, near-zero transfer expected): Use $v_{\\max} = 3$, $N_\\parallel = 401$, $N_\\perp = 401$, and $\\sigma = 1$. Define\n$$\nh_f(v_\\parallel, v_\\perp) = A\\,\\exp\\!\\left(-\\frac{v_\\parallel^2 + v_\\perp^2}{2\\sigma^2}\\right),\n$$\nwith $A = 0.2$, and\n$$\n\\partial_t \\chi(v_\\parallel, v_\\perp) = \\alpha\\,v_\\parallel\\,\\exp\\!\\left(-\\frac{v_\\perp^2}{2\\sigma^2}\\right),\n$$\nwith $\\alpha = 0.02$.\n\nAlgorithmic requirements:\n- Construct $v_\\parallel$ and $v_\\perp$ as uniform grids on their respective intervals, including endpoints.\n- Use the discrete approximation above with $2\\pi$ factor and the cylindrical Jacobian $v_\\perp$.\n- Apply a numerical tolerance $\\varepsilon = 10^{-12}$ in the sign interpretation: treat $|P_f| < \\varepsilon$ as zero.\n\nFinal output specification:\n- For each test case, produce a nested list $[P_f, s]$ where $P_f$ is rounded to $8$ decimal places and $s \\in \\{-1, 0, +1\\}$ is the sign classification as described above.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[[P_1,s_1],[P_2,s_2],[P_3,s_3]]$, with no spaces.\n\nAll inputs are dimensionless and no physical unit conversions are required. Angles, if any, are in radians, but none are used in the definitions above.",
            "solution": "The problem requires the computation of the turbulent energy transfer rate density, $P_f$, between a fast-ion species and electrostatic fields within the framework of Gyrokinetic (GK) theory. The quantity $P_f$ is defined by the velocity-space integral:\n$$\nP_f = \\int h_f(\\mathbf{v})\\,\\partial_t \\chi(\\mathbf{v})\\,d^3v\n$$\nwhere $h_f$ is the non-adiabatic part of the fast-ion distribution function and $\\partial_t \\chi$ is the time rate of change of the GK potential. The sign of $P_f$ determines the direction of energy flow: $P_f > 0$ signifies net energy transfer from fields to particles (damping), while $P_f < 0$ signifies net energy transfer from particles to fields (drive).\n\nThe integration is performed in an axisymmetric cylindrical velocity-space coordinate system $(v_\\parallel, v_\\perp)$, where $v_\\parallel$ is the velocity parallel to the magnetic field and $v_\\perp$ is the perpendicular speed. The integration domains are $v_\\parallel \\in [-v_{\\max}, v_{\\max}]$ and $v_\\perp \\in [0, v_{\\max}]$. The infinitesimal volume element is given by $d^3v = 2\\pi\\,v_\\perp\\,dv_\\perp\\,dv_\\parallel$. The integral for $P_f$ is thus:\n$$\nP_f = \\int_{-v_{\\max}}^{v_{\\max}} \\int_0^{v_{\\max}} h_f(v_\\parallel, v_\\perp)\\,\\partial_t \\chi(v_\\parallel, v_\\perp)\\, (2\\pi v_\\perp) \\,dv_\\perp \\,dv_\\parallel\n$$\n\nTo compute this definite integral, we employ a numerical approximation based on a discrete summation over a uniform two-dimensional grid. The velocity-space is discretized into a grid of $N_\\parallel \\times N_\\perp$ points.\nThe grid for the parallel velocity, $\\{v_{\\parallel,i}\\}_{i=1}^{N_\\parallel}$, covers the interval $[-v_{\\max}, v_{\\max}]$ with a uniform spacing $\\Delta v_\\parallel = \\frac{2v_{\\max}}{N_\\parallel - 1}$.\nThe grid for the perpendicular velocity, $\\{v_{\\perp,j}\\}_{j=1}^{N_\\perp}$, covers the interval $[0, v_{\\max}]$ with a uniform spacing $\\Delta v_\\perp = \\frac{v_{\\max}}{N_\\perp - 1}$.\n\nThe continuous integral is approximated by the following discrete sum:\n$$\nP_f \\approx \\sum_{i=1}^{N_\\parallel}\\sum_{j=1}^{N_\\perp} I(v_{\\parallel,i}, v_{\\perp,j})\\, \\Delta V_j\n$$\nwhere $I(v_{\\parallel,i}, v_{\\perp,j}) = h_f(v_{\\parallel,i}, v_{\\perp,j})\\,\\partial_t \\chi(v_{\\parallel,i}, v_{\\perp,j})$ is the integrand evaluated at each grid point, and $\\Delta V_j = 2\\pi\\,v_{\\perp,j}\\,\\Delta v_\\perp\\,\\Delta v_\\parallel$ is the volume of the corresponding annular cell in velocity space. The Jacobian factor $v_{\\perp,j}$ is critical for correctness in cylindrical coordinates.\n\nThe computation for each test case proceeds as follows:\n$1$. Construct the one-dimensional grids for $v_\\parallel$ and $v_\\perp$ using the specified parameters $v_{\\max}$, $N_\\parallel$, and $N_\\perp$.\n$2$. Create two-dimensional coordinate arrays from these grids to represent every point $(v_{\\parallel,i}, v_{\\perp,j})$ in the integration domain.\n$3$. Evaluate the functions $h_f(v_\\parallel, v_\\perp)$ and $\\partial_t \\chi(v_\\parallel, v_\\perp)$ on this two-dimensional grid, yielding two matrices of values.\n$4$. Compute the integrand matrix by performing an element-wise product of the $h_f$ and $\\partial_t \\chi$ matrices.\n$5$. Compute a matrix representing the differential volume element $2\\pi\\,v_{\\perp,j}\\,\\Delta v_\\perp\\,\\Delta v_\\parallel$.\n$6$. Multiply the integrand matrix and the volume element matrix element-wise, and sum all elements of the resulting matrix to obtain the numerical value for $P_f$.\n$7. $Interpret the sign of the computed $P_f$ using the tolerance $\\varepsilon = 10^{-12}$. If $P_f > \\varepsilon$, the result is net damping (encoded as $+1$). If $P_f < -\\varepsilon$, it is net drive (encoded as $-1$). If $|P_f| \\le \\varepsilon$, the net transfer is considered zero (encoded as $0$).\n\nAnalysis of the test cases:\n- **Test Case $1$**: The function $h_f$ is constructed as the sum of a modulated Maxwellian and a Gaussian \"bump-on-tail\". Both components are strictly positive, so $h_f(v_\\parallel, v_\\perp) > 0$. The potential rate of change is a positive constant, $\\partial_t \\chi = c_0 = 0.01 > 0$. The integrand is therefore positive everywhere in the domain. Consequently, the integral $P_f$ must be positive, corresponding to net damping ($s=+1$).\n\n- **Test Case $2$**: This case uses the same positive function $h_f$ as in Case $1$. However, the potential rate of change is a negative constant, $\\partial_t \\chi = c_0 = -0.015 < 0$. The integrand is thus negative everywhere. The integral $P_f$ must be negative, corresponding to net drive ($s=-1$).\n\n- **Test Case $3$**: Here, $h_f(v_\\parallel, v_\\perp) = A\\,\\exp\\!\\left(-\\frac{v_\\parallel^2 + v_\\perp^2}{2\\sigma^2}\\right)$ is an even function with respect to $v_\\parallel$, i.e., $h_f(-v_\\parallel, v_\\perp) = h_f(v_\\parallel, v_\\perp)$. The potential rate of change, $\\partial_t \\chi(v_\\parallel, v_\\perp) = \\alpha\\,v_\\parallel\\,\\exp\\!\\left(-\\frac{v_\\perp^2}{2\\sigma^2}\\right)$, is an odd function with respect to $v_\\parallel$, i.e., $\\partial_t \\chi(-v_\\parallel, v_\\perp) = -\\partial_t \\chi(v_\\parallel, v_\\perp)$. The integrand, being a product of an even and an odd function, is itself odd with respect to $v_\\parallel$. The integral of an odd function over a symmetric interval, such as $[-v_{\\max}, v_{\\max}]$, is analytically zero. The numerical integration scheme, being symmetric, is expected to yield a value for $P_f$ that is zero within numerical precision. Therefore, we expect $|P_f| \\le \\varepsilon$, corresponding to zero net energy transfer ($s=0$).",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the species-field energy exchange rate density Pf for three test cases\n    based on Gyrokinetic theory.\n    \"\"\"\n    \n    # Define the parameters for the three test cases.\n    test_cases = [\n        {\n            # Test case 1: happy path, net damping expected\n            \"v_max\": 4.0, \"N_parallel\": 201, \"N_perp\": 200, \"sigma\": 1.0,\n            \"h_f_params\": {\"A\": 0.1, \"delta\": 0.05, \"k\": 1.2, \"delta_b\": 0.02,\n                         \"v_b\": 1.8, \"v_p_b\": 0.4, \"w_b\": 0.25, \"w_p_b\": 0.2},\n            \"dt_chi_params\": {\"c0\": 0.01},\n            \"case_type\": 1\n        },\n        {\n            # Test case 2: net drive expected by sign reversal\n            \"v_max\": 4.0, \"N_parallel\": 201, \"N_perp\": 200, \"sigma\": 1.0,\n            \"h_f_params\": {\"A\": 0.1, \"delta\": 0.05, \"k\": 1.2, \"delta_b\": 0.02,\n                         \"v_b\": 1.8, \"v_p_b\": 0.4, \"w_b\": 0.25, \"w_p_b\": 0.2},\n            \"dt_chi_params\": {\"c0\": -0.015},\n            \"case_type\": 2\n        },\n        {\n            # Test case 3: symmetry boundary, near-zero transfer expected\n            \"v_max\": 3.0, \"N_parallel\": 401, \"N_perp\": 401, \"sigma\": 1.0,\n            \"h_f_params\": {\"A\": 0.2},\n            \"dt_chi_params\": {\"alpha\": 0.02},\n            \"case_type\": 3\n        }\n    ]\n\n    results = []\n    \n    # Define functional forms for h_f and dt_chi\n    def get_hf(case_type, Vp, Vperp, sigma, params):\n        if case_type in [1, 2]:\n            term1 = params['A'] * np.exp(-(Vp**2 + Vperp**2) / (2 * sigma**2)) * \\\n                    (1 + params['delta'] * np.cos(params['k'] * Vp))\n            term2 = params['delta_b'] * np.exp(-((Vp - params['v_b'])**2) / (2 * params['w_b']**2)) * \\\n                    np.exp(-((Vperp - params['v_p_b'])**2) / (2 * params['w_p_b']**2))\n            return term1 + term2\n        elif case_type == 3:\n            return params['A'] * np.exp(-(Vp**2 + Vperp**2) / (2 * sigma**2))\n\n    def get_dt_chi(case_type, Vp, Vperp, sigma, params):\n        if case_type in [1, 2]:\n            return np.full_like(Vp, params['c0'])\n        elif case_type == 3:\n            return params['alpha'] * Vp * np.exp(-(Vperp**2) / (2 * sigma**2))\n\n    for case in test_cases:\n        v_max = case[\"v_max\"]\n        N_parallel = case[\"N_parallel\"]\n        N_perp = case[\"N_perp\"]\n        sigma = case[\"sigma\"]\n        \n        # 1. Construct uniform velocity-space grids\n        v_parallel_grid = np.linspace(-v_max, v_max, N_parallel)\n        v_perp_grid = np.linspace(0, v_max, N_perp)\n        \n        # Calculate grid spacings\n        delta_v_parallel = (2 * v_max) / (N_parallel - 1)\n        delta_v_perp = v_max / (N_perp - 1)\n        \n        # Create 2D coordinate arrays\n        V_parallel, V_perp = np.meshgrid(v_parallel_grid, v_perp_grid, indexing='ij')\n\n        # 2. Evaluate h_f and dt_chi on the grid\n        hf_vals = get_hf(case[\"case_type\"], V_parallel, V_perp, sigma, case[\"h_f_params\"])\n        dt_chi_vals = get_dt_chi(case[\"case_type\"], V_parallel, V_perp, sigma, case[\"dt_chi_params\"])\n        \n        # 3. Compute the integrand and the differential volume element\n        integrand = hf_vals * dt_chi_vals\n        dV = 2 * np.pi * V_perp * delta_v_perp * delta_v_parallel\n        \n        # 4. Compute Pf using discrete approximation\n        P_f = np.sum(integrand * dV)\n        \n        # 5. Interpret the sign of Pf\n        eps = 1e-12\n        if P_f > eps:\n            s = 1\n        elif P_f < -eps:\n            s = -1\n        else:\n            s = 0\n        \n        # Store result rounded to 8 decimal places\n        results.append([round(P_f, 8), s])\n\n    # Final print statement in the exact required format\n    output_parts = [f\"[{p},{s}]\" for p, s in results]\n    print(f\"[{','.join(output_parts)}]\")\n\nsolve()\n```"
        }
    ]
}