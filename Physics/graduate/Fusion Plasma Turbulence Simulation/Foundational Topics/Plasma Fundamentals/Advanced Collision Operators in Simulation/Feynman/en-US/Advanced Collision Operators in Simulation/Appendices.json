{
    "hands_on_practices": [
        {
            "introduction": "The implementation of collision operators in kinetic simulations introduces significant numerical challenges, chief among them being \"stiffness.\" This exercise  provides a practical way to diagnose stiffness by analyzing the spectral properties of a simplified collision operator. By comparing the characteristic timescales of collisional dissipation with those of physical processes like parallel streaming, you will learn to quantify the stability limits of explicit time-integration schemes and appreciate why more advanced methods are essential.",
            "id": "4180542",
            "problem": "Consider the linearized kinetic equation for a perturbed distribution $g$ in a fusion plasma turbulence simulation, written in one-dimensional parallel configuration space and velocity space,\n$$\n\\partial_t g + v_{\\parallel}\\,\\partial_z g + i\\,\\omega_*\\, g \\;=\\; L\\,g,\n$$\nwhere $v_{\\parallel}$ is the parallel velocity, $\\omega_*$ is a constant diamagnetic drive frequency, and $L$ is a linearized collision operator. Assume a simplified model in which $L$ consists of two decoupled test-particle pieces: pitch-angle scattering and energy diffusion, acting on the pitch-angle cosine $\\xi$ and the normalized speed $u = v/v_{\\mathrm{th}}$, respectively,\n$$\nL \\;=\\; \\nu\\,\\partial_{\\xi}\\!\\left[(1-\\xi^2)\\,\\partial_{\\xi}\\,\\cdot\\right] \\;+\\; \\nu\\,\\partial_{uu}\\,,\n$$\nwith constant collision frequency $\\nu$, and $v_{\\mathrm{th}}$ the thermal speed. Take a spectral representation in $\\xi$ using Legendre polynomials $P_{\\ell}(\\xi)$ (so that $\\partial_{\\xi}[(1-\\xi^2)\\partial_{\\xi}] P_{\\ell} = -\\ell(\\ell+1) P_{\\ell}$), truncated at $\\ell_{\\max}$, and a grid in $u$ with uniform spacing $\\Delta u$ and sufficient resolution such that the largest resolved wavenumber in $u$-space can be estimated as $k_{u,\\max} \\approx \\pi/\\Delta u$. For the advective streaming term, take a single parallel Fourier mode with wavenumber $k_{\\parallel}$, so that its linear frequency scale is $\\omega_s = v_{\\mathrm{th}}\\,k_{\\parallel}$. Assume all other nonlinearities and field coupling are turned off.\n\nUse the following numerically plausible parameters representative of electron-scale turbulence resolution and collision strength:\n- $\\nu = 5\\times 10^5\\ \\mathrm{s}^{-1}$,\n- $\\ell_{\\max} = 32$,\n- $\\Delta u = 0.01$,\n- $v_{\\mathrm{th}} = 6\\times 10^7\\ \\mathrm{m/s}$,\n- $k_{\\parallel} = 100\\ \\mathrm{m}^{-1}$,\n- $\\omega_* = 8\\times 10^4\\ \\mathrm{s}^{-1}$.\n\nBased on first principles of the spectral properties of the pitch-angle scattering operator and the diffusion operator in $u$-space, and the form of the streaming and drive terms, which option correctly explains why the collision operator introduces stiffness relative to the advective and drive terms, and provides a consistent estimate for the most restrictive stability-limited timestep $\\Delta t$ for a fully explicit forward Euler time integrator applied to the semi-discrete system?\n\nChoose one:\n\nA. The pitch-angle operator has eigenvalues $-\\nu\\,\\ell(\\ell+1)$ and the $u$-diffusion has eigenvalues $-\\nu\\,k_u^2$, so the largest negative real part is approximately $\\lambda_{\\max}^{(L)} \\approx -\\nu\\,\\ell_{\\max}(\\ell_{\\max}+1)$ or $-\\nu\\,(\\pi/\\Delta u)^2$, whichever is larger. With the given parameters, $|\\lambda_{\\max}^{(L)}|$ from $u$-diffusion exceeds both $|\\omega_s|$ and $|\\omega_*|$, making the system stiff; the forward Euler stability bound is $\\Delta t \\lesssim 2/|\\lambda_{\\max}^{(L)}| \\approx 4\\times 10^{-11}\\ \\mathrm{s}$.\n\nB. The collision operator contributes purely imaginary eigenvalues that only shift the phase of $g$, so stiffness does not arise from collisions. The timestep is limited by the streaming term, with $\\Delta t \\lesssim 1/|\\omega_s| \\approx 1.7\\times 10^{-10}\\ \\mathrm{s}$.\n\nC. The largest eigenvalue of the collision operator is $-\\nu$, independent of velocity-space resolution, so the timestep bound is $\\Delta t \\lesssim 2/\\nu \\approx 4\\times 10^{-6}\\ \\mathrm{s}$, which is much larger than the advective bound.\n\nD. Stiffness is dominated by pitch-angle scattering with $\\lambda_{\\max}^{(L)} \\approx -\\nu\\,\\ell_{\\max}(\\ell_{\\max}+1)$, so the timestep bound is $\\Delta t \\lesssim 2/\\left[\\nu\\,\\ell_{\\max}(\\ell_{\\max}+1)\\right] \\approx 4\\times 10^{-9}\\ \\mathrm{s}$; energy diffusion in $u$ is subdominant and can be neglected in the stiffness estimate.",
            "solution": "Begin from the linearized kinetic equation,\n$$\n\\partial_t g + v_{\\parallel}\\,\\partial_z g + i\\,\\omega_*\\, g \\;=\\; L\\,g,\n$$\nwith $L$ composed of pitch-angle scattering and energy diffusion,\n$$\nL \\;=\\; \\nu\\,\\partial_{\\xi}\\!\\left[(1-\\xi^2)\\,\\partial_{\\xi}\\,\\cdot\\right] \\;+\\; \\nu\\,\\partial_{uu}\\,.\n$$\nWe analyze the spectral properties of each term.\n\nFor the pitch-angle scattering operator, the well-known eigenfunctions are the Legendre polynomials $P_{\\ell}(\\xi)$, and\n$$\n\\partial_{\\xi}\\!\\left[(1-\\xi^2)\\,\\partial_{\\xi} P_{\\ell}\\right] \\;=\\; -\\,\\ell(\\ell+1)\\,P_{\\ell}.\n$$\nMultiplying by $\\nu$, the eigenvalues contributed by pitch-angle scattering are\n$$\n\\lambda_{\\ell}^{(\\xi)} \\;=\\; -\\,\\nu\\,\\ell(\\ell+1).\n$$\nTruncating at $\\ell_{\\max}$, the most negative eigenvalue from pitch-angle scattering is\n$$\n\\lambda_{\\max}^{(\\xi)} \\;=\\; -\\,\\nu\\,\\ell_{\\max}(\\ell_{\\max}+1).\n$$\nWith $\\nu = 5\\times 10^5\\ \\mathrm{s}^{-1}$ and $\\ell_{\\max}=32$, we have $\\ell_{\\max}(\\ell_{\\max}+1) = 32\\times 33 = 1056$, hence\n$$\n|\\lambda_{\\max}^{(\\xi)}| \\;=\\; \\nu\\,\\ell_{\\max}(\\ell_{\\max}+1) \\;=\\; (5\\times 10^5)\\times 1056 \\;\\approx\\; 5.28\\times 10^8\\ \\mathrm{s}^{-1}.\n$$\n\nFor the energy diffusion operator in the normalized speed coordinate $u = v/v_{\\mathrm{th}}$, the continuous operator is $\\nu\\,\\partial_{uu}$, whose Fourier eigenvalues are $-\\nu\\,k_u^2$. On a grid with spacing $\\Delta u$, the largest resolvable wavenumber can be estimated as $k_{u,\\max} \\approx \\pi/\\Delta u$, so the most negative eigenvalue magnitude from $u$-diffusion is\n$$\n|\\lambda_{\\max}^{(u)}| \\;\\approx\\; \\nu\\,k_{u,\\max}^2 \\;\\approx\\; \\nu\\left(\\frac{\\pi}{\\Delta u}\\right)^2.\n$$\nWith $\\nu = 5\\times 10^5\\ \\mathrm{s}^{-1}$ and $\\Delta u = 0.01$, we find\n$$\n\\left(\\frac{\\pi}{\\Delta u}\\right)^2 \\;=\\; \\left(\\frac{3.14159}{0.01}\\right)^2 \\;\\approx\\; (314.159)^2 \\;\\approx\\; 9.87\\times 10^4,\n$$\nso\n$$\n|\\lambda_{\\max}^{(u)}| \\;\\approx\\; (5\\times 10^5)\\times (9.87\\times 10^4) \\;\\approx\\; 4.94\\times 10^{10}\\ \\mathrm{s}^{-1}.\n$$\n\nNext, consider the advective streaming term. For a single parallel Fourier mode with $k_{\\parallel}$, the streaming frequency scale is\n$$\n\\omega_s \\;=\\; v_{\\mathrm{th}}\\,k_{\\parallel}.\n$$\nWith $v_{\\mathrm{th}} = 6\\times 10^7\\ \\mathrm{m/s}$ and $k_{\\parallel} = 100\\ \\mathrm{m}^{-1}$,\n$$\n|\\omega_s| \\;=\\; (6\\times 10^7)\\times 100 \\;=\\; 6\\times 10^9\\ \\mathrm{s}^{-1}.\n$$\nThe diamagnetic drive contributes a purely imaginary term $i\\omega_*$ with $|\\omega_*| = 8\\times 10^4\\ \\mathrm{s}^{-1}$.\n\nComparing scales:\n- $|\\lambda_{\\max}^{(u)}| \\approx 4.94\\times 10^{10}\\ \\mathrm{s}^{-1}$ (real, negative),\n- $|\\lambda_{\\max}^{(\\xi)}| \\approx 5.28\\times 10^{8}\\ \\mathrm{s}^{-1}$ (real, negative),\n- $|\\omega_s| \\approx 6\\times 10^{9}\\ \\mathrm{s}^{-1}$ (purely imaginary),\n- $|\\omega_*| \\approx 8\\times 10^{4}\\ \\mathrm{s}^{-1}$ (purely imaginary).\n\nThe largest magnitude eigenvalues arise from the collision operator, specifically the energy diffusion in $u$-space. Because these eigenvalues have large negative real parts, they introduce stiffness: the fastest decaying modes associated with velocity-space diffusion evolve on a timescale $O(1/|\\lambda_{\\max}^{(u)}|)$, which is much shorter than the advective or drive timescales. In an explicit forward Euler scheme applied to a linear system $\\partial_t y = A y$ with an eigenvalue $\\lambda$ having negative real part, the stability requirement along that eigenmode is $|1 + \\Delta t\\,\\lambda| \\le 1$, which for real negative $\\lambda$ reduces to\n$$\n\\Delta t \\;\\le\\; \\frac{2}{|\\lambda|}.\n$$\nHence, the most restrictive explicit timestep is controlled by the largest negative real eigenvalue of $L$, i.e.,\n$$\n\\Delta t_{\\max} \\;\\approx\\; \\frac{2}{|\\lambda_{\\max}^{(L)}|} \\;\\approx\\; \\frac{2}{|\\lambda_{\\max}^{(u)}|} \\;\\approx\\; \\frac{2}{4.94\\times 10^{10}} \\;\\approx\\; 4.05\\times 10^{-11}\\ \\mathrm{s}.\n$$\nBy contrast, advective and drive terms are purely imaginary and do not impose this forward Euler diffusion-type bound; their explicit stability in practice follows a Courant–Friedrichs–Lewy (CFL) restriction that depends on spatial discretization. Even if one estimates a naive bound $\\Delta t \\sim 1/|\\omega_s| \\approx 1.7\\times 10^{-10}\\ \\mathrm{s}$, it is still less restrictive than the collisional diffusion bound computed above. Therefore, collisions render the semi-discrete kinetic system stiff relative to the advective and drive terms under these resolution and parameter choices.\n\nOption-by-option analysis:\n- Option A correctly states the eigenvalue scalings: $-\\nu\\,\\ell(\\ell+1)$ for pitch-angle scattering and $-\\nu\\,k_u^2$ for $u$-diffusion. It identifies that the largest magnitude eigenvalue is due to $u$-diffusion at the given $\\Delta u$, and correctly compares it to $|\\omega_s|$ and $|\\omega_*|$, concluding stiffness. Its timestep estimate $\\Delta t \\lesssim 2/|\\lambda_{\\max}^{(L)}|$ and the numerical value $\\approx 4\\times 10^{-11}\\ \\mathrm{s}$ are consistent with the above derivation. Verdict: Correct.\n- Option B incorrectly claims that collisions contribute purely imaginary eigenvalues; in fact, diffusion operators produce negative real eigenvalues, which are precisely the source of stiffness in explicit schemes. The timestep limited only by streaming, $\\Delta t \\lesssim 1/|\\omega_s|$, neglects the dominant collisional stability constraint. Verdict: Incorrect.\n- Option C asserts the largest collisional eigenvalue is $-\\nu$, independent of resolution, which contradicts the spectral scaling of diffusion ($\\propto k^2$) and pitch-angle scattering ($\\propto \\ell(\\ell+1)$). The resulting timestep $\\Delta t \\approx 2/\\nu$ is orders of magnitude too large and ignores resolution-induced stiffness. Verdict: Incorrect.\n- Option D focuses exclusively on pitch-angle scattering and neglects the $u$-diffusion contribution, which is much larger under the given parameters. Its timestep estimate $\\approx 4\\times 10^{-9}\\ \\mathrm{s}$ is less restrictive than the correct bound from $u$-diffusion and thus inconsistent. Verdict: Incorrect.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Having identified stiffness as a key obstacle, we now turn to a powerful solution: Implicit-Explicit (IMEX) time-integration schemes. These hybrid methods offer a pragmatic balance, treating the stiff collisional terms implicitly for stability while handling non-stiff terms like streaming explicitly for efficiency. This practice  walks you through the design and stability analysis of a first-order IMEX scheme, a foundational technique for developing robust and efficient solvers for kinetic equations.",
            "id": "4180514",
            "problem": "You are asked to design and analyze a time integration scheme for a linear model of fusion plasma turbulence where parallel streaming acts explicitly and pitch-angle scattering acts implicitly. Consider the linear, collision-streaming model for the gyro-averaged distribution perturbation, written in a reduced form for a single Fourier mode in the coordinate along the magnetic field and a single Legendre polynomial mode in pitch angle. The continuous model is\n$$\n\\frac{d u}{d t} \\;=\\; \\mathcal{S}\\,u \\;+\\; \\mathcal{C}\\,u,\n$$\nwhere $u(t)$ is a complex-valued amplitude, $\\mathcal{S}$ models parallel streaming and is skew-Hermitian, and $\\mathcal{C}$ models pitch-angle scattering and is self-adjoint negative semidefinite. For a single Fourier mode with parallel wavenumber $k$ and a single Legendre polynomial index $l$, the model reduces to the scalar ordinary differential equation\n$$\n\\frac{d u}{d t} \\;=\\; -\\,i\\,a\\,u \\;-\\; c\\,u,\n$$\nwhere $a \\ge 0$ is a real streaming frequency (in s$^{-1}$) induced by the parallel streaming term and $c \\ge 0$ is a real collisional damping rate (in s$^{-1}$) that arises from pitch-angle scattering, for example $c = \\nu\\,l(l+1)$ if $\\nu$ is a collision frequency (in s$^{-1}$). Here $i$ is the imaginary unit.\n\nYour tasks are as follows.\n\n1) Formulate a first-order Implicit-Explicit (IMEX) scheme, where the collision operator is treated implicitly and the streaming operator is treated explicitly. Discretize time with step $\\Delta t$ (in s), from $t^n$ to $t^{n+1} = t^n + \\Delta t$, and write your scheme for updating $u^n \\approx u(t^n)$ to $u^{n+1} \\approx u(t^{n+1})$.\n\n2) For the scalar model above, derive the corresponding one-step amplification factor $G(\\Delta t)$, defined by $u^{n+1} = G(\\Delta t)\\,u^n$, and give the necessary and sufficient condition for linear stability in the sense $\\lvert G(\\Delta t) \\rvert \\le 1$.\n\n3) Reduce the linear stability condition in item 2 to an explicit algebraic inequality relating $a$, $c$, and $\\Delta t$. Analyze the condition to obtain:\n   - a regime in which the scheme is unconditionally stable with respect to $\\Delta t$,\n   - and, when not unconditionally stable, an explicit bound on $\\Delta t$ in terms of $a$ and $c$ that guarantees $\\lvert G(\\Delta t) \\rvert \\le 1$.\n\nAll physical quantities that appear numerically must be expressed in the following units: $a$ in s$^{-1}$, $c$ in s$^{-1}$, and $\\Delta t$ in s.\n\nImplementation task:\nWrite a complete program that, for each test case below, evaluates whether the IMEX scheme derived in item 1 is linearly stable according to the criterion in item 2. Your program should return a boolean result for each case: use the value true if the scheme is linearly stable for the given $(a,c,\\Delta t)$ triple, and false otherwise. The test suite is:\n\n- Case 1 (happy path, zero-collision edge): $a = 1.0$ s$^{-1}$, $c = 0.0$ s$^{-1}$, $\\Delta t = 1.0 \\times 10^{-3}$ s.\n- Case 2 (strongly collisional, moderate $\\Delta t$): $a = 1.0$ s$^{-1}$, $c = 10.0$ s$^{-1}$, $\\Delta t = 0.1$ s.\n- Case 3 (moderately collisional, small $\\Delta t$): $a = 1.0$ s$^{-1}$, $c = 0.1$ s$^{-1}$, $\\Delta t = 0.1$ s.\n- Case 4 (boundary case at stability threshold): $a = 1.0$ s$^{-1}$, $c = 0.2360679774997897$ s$^{-1}$, $\\Delta t = 0.5$ s.\n- Case 5 (streaming-dominated instability): $a = 10.0$ s$^{-1}$, $c = 0.1$ s$^{-1}$, $\\Delta t = 0.05$ s.\n- Case 6 (very strong collisions, large $\\Delta t$): $a = 1.0$ s$^{-1}$, $c = 100.0$ s$^{-1}$, $\\Delta t = 10.0$ s.\n\nFinal output format:\nYour program should produce a single line of output containing the six boolean results as a comma-separated list enclosed in square brackets, in the same order as the cases above. For example: \"[True,False,True,True,False,True]\".",
            "solution": "The problem statement is scientifically grounded, well-posed, and objective. It presents a standard simplified model from plasma physics and poses a sequence of clear, solvable tasks in numerical analysis. All necessary parameters are defined, and the premises are consistent with established principles. Therefore, the problem is deemed valid and a full solution is provided below.\n\nThe analysis proceeds in three parts as requested: first, the formulation of the Implicit-Explicit (IMEX) time integration scheme; second, the derivation of the scheme's amplification factor and stability condition; and third, a detailed analysis of the stability condition to determine regimes of stability.\n\nThe governing ordinary differential equation (ODE) for the complex-valued amplitude $u(t)$ is given by:\n$$\n\\frac{d u}{d t} = -\\,i\\,a\\,u - c\\,u\n$$\nwhere $a \\ge 0$ is the real-valued streaming frequency, $c \\ge 0$ is the real-valued collisional damping rate, and $i$ is the imaginary unit. The term $-iau$ represents the effects of parallel streaming, corresponding to the skew-Hermitian operator $\\mathcal{S}$, while the term $-cu$ represents pitch-angle scattering, corresponding to the self-adjoint negative semidefinite operator $\\mathcal{C}$.\n\n1) Formulation of the First-Order IMEX Scheme\n\nWe are tasked to formulate a first-order IMEX scheme where the streaming term ($-iau$) is treated explicitly and the collision term ($-cu$) is treated implicitly. We discretize time such that $t^{n+1} = t^n + \\Delta t$, and let $u^n$ be the numerical approximation of $u(t^n)$. A first-order time derivative is approximated by the forward difference $\\frac{u^{n+1} - u^n}{\\Delta t}$.\n\nIn this scheme, the explicit part of the right-hand side is evaluated at the current time level $n$, while the implicit part is evaluated at the future time level $n+1$. This yields the following finite difference equation:\n$$\n\\frac{u^{n+1} - u^n}{\\Delta t} = -i\\,a\\,u^n - c\\,u^{n+1}\n$$\nThis method is also known as an IMEX Euler scheme, combining a Forward Euler step for the streaming term and a Backward Euler step for the collision term. To obtain the update rule for $u^{n+1}$, we rearrange the equation to solve for $u^{n+1}$:\n$$\nu^{n+1} - u^n = \\Delta t (-i\\,a\\,u^n - c\\,u^{n+1})\n$$\n$$\nu^{n+1} + c\\,\\Delta t\\,u^{n+1} = u^n - i\\,a\\,\\Delta t\\,u^n\n$$\n$$\nu^{n+1} (1 + c\\,\\Delta t) = u^n (1 - i\\,a\\,\\Delta t)\n$$\nFinally, dividing by $(1 + c\\,\\Delta t)$, which is non-zero for $c \\ge 0$ and $\\Delta t > 0$, we arrive at the explicit one-step update formula:\n$$\nu^{n+1} = \\left( \\frac{1 - i\\,a\\,\\Delta t}{1 + c\\,\\Delta t} \\right) u^n\n$$\n\n2) Derivation of the Amplification Factor and Stability Condition\n\nThe one-step amplification factor, denoted $G(\\Delta t)$, relates the solution at two consecutive time steps via the relation $u^{n+1} = G(\\Delta t)\\,u^n$. By comparing this definition with the derived update rule, we can directly identify the amplification factor for this scheme:\n$$\nG(\\Delta t) = \\frac{1 - i\\,a\\,\\Delta t}{1 + c\\,\\Delta t}\n$$\nA numerical scheme is linearly stable if perturbations do not grow over time. For a one-step method, this requires the magnitude of the amplification factor to be less than or equal to one. The stability condition is therefore:\n$$\n\\lvert G(\\Delta t) \\rvert \\le 1\n$$\nWe compute the magnitude of $G(\\Delta t)$. Since $a$, $c$, and $\\Delta t$ are real quantities:\n$$\n\\lvert G(\\Delta t) \\rvert = \\left\\lvert \\frac{1 - i\\,a\\,\\Delta t}{1 + c\\,\\Delta t} \\right\\rvert = \\frac{\\lvert 1 - i\\,a\\,\\Delta t \\rvert}{\\lvert 1 + c\\,\\Delta t \\rvert}\n$$\nThe magnitude of the numerator is $\\lvert 1 - i\\,a\\,\\Delta t \\rvert = \\sqrt{1^2 + (-a\\,\\Delta t)^2} = \\sqrt{1 + a^2(\\Delta t)^2}$.\nThe denominator is a positive real number, so $\\lvert 1 + c\\,\\Delta t \\rvert = 1 + c\\,\\Delta t$.\nSubstituting these into the stability condition gives:\n$$\n\\frac{\\sqrt{1 + a^2(\\Delta t)^2}}{1 + c\\,\\Delta t} \\le 1\n$$\n\n3) Analysis of the Linear Stability Condition\n\nTo make this condition more explicit, we manipulate the inequality. As both sides are positive, we can square them without changing the inequality's direction:\n$$\n\\frac{1 + a^2(\\Delta t)^2}{(1 + c\\,\\Delta t)^2} \\le 1\n$$\nMultiplying by the positive denominator $(1 + c\\,\\Delta t)^2$:\n$$\n1 + a^2(\\Delta t)^2 \\le (1 + c\\,\\Delta t)^2 = 1 + 2c\\,\\Delta t + c^2(\\Delta t)^2\n$$\nSubtracting $1$ from both sides:\n$$\na^2(\\Delta t)^2 \\le 2c\\,\\Delta t + c^2(\\Delta t)^2\n$$\nAssuming a positive time step $\\Delta t > 0$, we can divide the entire inequality by $\\Delta t$:\n$$\na^2\\,\\Delta t \\le 2c + c^2\\,\\Delta t\n$$\nRearranging the terms to isolate $\\Delta t$:\n$$\na^2\\,\\Delta t - c^2\\,\\Delta t \\le 2c\n$$\n$$\n(a^2 - c^2)\\,\\Delta t \\le 2c\n$$\nThis is the final algebraic inequality relating $a$, $c$, and $\\Delta t$. We analyze this condition by considering the sign of the term $(a^2 - c^2)$.\n\nRegime of Unconditional Stability:\nThe scheme is unconditionally stable if the inequality holds for all $\\Delta t > 0$. This occurs if the coefficient of $\\Delta t$ on the left-hand side is non-positive, while the right-hand side is non-negative.\nThe right-hand side, $2c$, is non-negative since $c \\ge 0$.\nThe coefficient of $\\Delta t$ is $(a^2 - c^2)$. If $a^2 - c^2 \\le 0$, the left-hand side is a non-positive number for any $\\Delta t > 0$. A non-positive number is always less than or equal to a non-negative number.\nTherefore, the condition for unconditional stability is $a^2 - c^2 \\le 0$, which, given that $a, c \\ge 0$, is equivalent to $a \\le c$.\nPhysically, this means that if the collisional damping rate is greater than or equal to the streaming frequency, the scheme is stable for any time step size. The strong implicit dissipation stabilizes the explicit oscillatory part.\n\nRegime of Conditional Stability and Time-Step Bound:\nIf $a^2 - c^2 > 0$, which is equivalent to $a > c$, the coefficient of $\\Delta t$ is positive. To satisfy the inequality, we can divide by $(a^2 - c^2)$ without changing the inequality direction, which yields an upper bound on $\\Delta t$:\n$$\n\\Delta t \\le \\frac{2c}{a^2 - c^2}\n$$\nIn this streaming-dominated regime ($a > c$), the scheme is only conditionally stable. The time step $\\Delta t$ must be smaller than the critical value $\\frac{2c}{a^2 - c^2}$ to ensure numerical stability. In the specific case where $c=0$ and $a>0$ (pure streaming, treated explicitly), the stability limit becomes $\\Delta t \\le 0$, which is impossible for a forward time step, correctly indicating that the Forward Euler scheme for an oscillatory problem is always unstable.\n\nThe implementation will test for stability based on these two regimes.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the linear stability of a first-order IMEX scheme for a simplified\n    plasma turbulence model based on the derived criteria.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple represents (a, c, Delta_t) in units of s^-1, s^-1, and s.\n    test_cases = [\n        (1.0, 0.0, 1.0e-3),             # Case 1\n        (1.0, 10.0, 0.1),                # Case 2\n        (1.0, 0.1, 0.1),                 # Case 3\n        (1.0, 0.2360679774997897, 0.5), # Case 4 (c = sqrt(5) - 2)\n        (10.0, 0.1, 0.05),               # Case 5\n        (1.0, 100.0, 10.0),              # Case 6\n    ]\n\n    results = []\n    for a, c, dt in test_cases:\n        # The stability analysis provides two regimes based on the relative\n        # values of the streaming frequency 'a' and collisional rate 'c'.\n        # The problem statement guarantees a >= 0 and c >= 0.\n        # A time step dt is inherently positive.\n\n        if a = c:\n            # Unconditionally stable regime.\n            # The inequality (a^2 - c^2) * dt = 2*c is always satisfied\n            # for dt  0 because the left side is non-positive and the\n            # right side is non-negative.\n            is_stable = True\n        else: # a  c\n            # Conditionally stable regime.\n            # The denominator (a**2 - c**2) is guaranteed to be positive.\n            # No risk of division by zero.\n            #\n            # The case c=0 is handled correctly:\n            # If c=0 and a0, dt_max becomes 0.\n            # Since dt  0, the condition dt = dt_max will be False,\n            # correctly indicating instability for the explicit Euler scheme\n            # on an oscillatory problem.\n            dt_max = (2.0 * c) / (a**2 - c**2)\n            \n            # The scheme is stable if the time step is within the bound.\n            # The equality dt == dt_max corresponds to |G|=1, which is stable.\n            is_stable = (dt = dt_max)\n        \n        results.append(is_stable)\n\n    # Final print statement in the exact required format:\n    # A comma-separated list of boolean values enclosed in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A numerically stable scheme is not sufficient; it must also be physically faithful. For collision operators, this means exactly conserving particle number, momentum, and energy. While continuous operators possess these properties, their discrete counterparts often do not, leading to unphysical drifts over long simulations. This exercise  guides you through the implementation of a \"conservation fixer,\" a projection-based method that enforces these fundamental laws at the discrete level, ensuring the long-term accuracy of your simulation.",
            "id": "4180552",
            "problem": "A discrete-velocity simulation seeks to advance a distribution perturbation $h(\\mathbf{v})$ under a linearized collision operator $L$ in a fusion plasma turbulence context. In the continuum, collisional invariants imply that number, momentum, and energy exchanges vanish for the collision operator when integrated against the appropriate invariants. Numerically, a discretized $L$ may not exactly preserve these invariants at each timestep. The goal is to derive from first principles and implement a minimal correction that enforces exact discrete conservation of number, momentum, and energy by projecting $Lh$ onto the null space complement after each timestep on a finite three-dimensional velocity grid.\n\nStart from the kinetic equation with a linearized collisional source $S(\\mathbf{v}) = Lh(\\mathbf{v})$ and the discrete inner product defined on a grid of points $\\mathbf{v}_i = (v_{x,i},v_{y,i},v_{z,i})$ with positive quadrature weights $w_i$. Define the discrete inner product by\n$$\n\\langle a, b \\rangle_W = \\sum_{i=1}^{N} w_i\\, a_i\\, b_i,\n$$\nwhere $a_i = a(\\mathbf{v}_i)$ and $b_i = b(\\mathbf{v}_i)$, and $N$ is the total number of grid points. The collisional invariants are the constant function $\\phi_0(\\mathbf{v}) = 1$, the components of velocity $\\phi_1(\\mathbf{v}) = v_x$, $\\phi_2(\\mathbf{v}) = v_y$, $\\phi_3(\\mathbf{v}) = v_z$, and the kinetic energy-like function $\\phi_4(\\mathbf{v}) = \\lVert \\mathbf{v} \\rVert^2 = v_x^2+v_y^2+v_z^2$. Discrete conservation at a timestep requires that the corrected source $S_\\perp$ satisfies\n$$\n\\langle \\phi_j, S_\\perp \\rangle_W = 0\n\\quad \\text{for} \\quad j \\in \\{0,1,2,3,4\\}.\n$$\nFormulate the correction as the orthogonal projection of $S$ onto the null space complement of the span of $\\{\\phi_0,\\phi_1,\\phi_2,\\phi_3,\\phi_4\\}$ with respect to the inner product $\\langle \\cdot, \\cdot \\rangle_W$, and derive the resulting linear algebraic system that must be solved to compute $S_\\perp$. Then implement this correction and apply it at each timestep so that $h^{n+1} = h^n + \\Delta t\\, S_\\perp$ yields no change in the discrete invariants.\n\nAll quantities in this problem are dimensionless, and no physical units are required. Angles are not used. The program must be self-contained and not read any external input; it should output a single line of results in the specified format.\n\nImplement your program to construct the velocity grid, weights, a test distribution $h$, and an uncorrected source $S$ for each of the following test cases. For uniform grids, weights are equal to the uniform cell volume $\\Delta v_x\\,\\Delta v_y\\,\\Delta v_z$. For nonuniform grids, use one-dimensional arrays of node positions in each direction and approximate the local cell widths by half the distance to the next node plus half the distance to the previous node (with endpoints using half the single adjacent interval). The weight at a node is the product of the three directional cell widths.\n\nTest suite:\n\n- Case $1$ (happy path):\n  - Grid nodes in each direction: $\\{-2,-1,0,1,2\\}$, so $N = 5 \\times 5 \\times 5$.\n  - Timestep: $\\Delta t = 0.1$.\n  - Distribution: $h(\\mathbf{v}) = \\exp(-\\lVert \\mathbf{v} \\rVert^2)$.\n  - Source: $S(\\mathbf{v}) = -\\nu h(\\mathbf{v}) + \\alpha v_x + \\beta \\lVert \\mathbf{v} \\rVert^2 + \\gamma v_x v_y$ with $\\nu = 0.4$, $\\alpha = 0.3$, $\\beta = -0.1$, $\\gamma = 0.05$.\n\n- Case $2$ (boundary case: zero source):\n  - Grid nodes in each direction: $\\{-1,0,1\\}$, so $N = 3 \\times 3 \\times 3$.\n  - Timestep: $\\Delta t = 0.5$.\n  - Distribution: $h(\\mathbf{v}) = \\exp(-\\lVert \\mathbf{v} \\rVert^2)$.\n  - Source: $S(\\mathbf{v}) = 0$.\n\n- Case $3$ (edge case: nonuniform grid and large timestep):\n  - Grid nodes:\n    - $v_x$ nodes: $\\{-3,-1,0,0.5,2\\}$,\n    - $v_y$ nodes: $\\{-2.5,-0.5,0.2,1.7\\}$,\n    - $v_z$ nodes: $\\{-1.5,-0.7,-0.2,0.4,1.4,3.0\\}$,\n    leading to $N = 5 \\times 4 \\times 6$.\n  - Timestep: $\\Delta t = 10.0$.\n  - Distribution: $h(\\mathbf{v}) = \\exp(-\\lVert \\mathbf{v} \\rVert^2)$.\n  - Source: $S(\\mathbf{v}) = a_1 v_x + a_2 v_y + a_3 v_z + a_4 \\lVert \\mathbf{v} \\rVert^2 - a_5 h(\\mathbf{v}) + b_1 v_x v_y + b_2 v_y v_z + b_3 v_x v_z$ with $a_1 = 2.0$, $a_2 = -3.0$, $a_3 = 1.5$, $a_4 = 0.7$, $a_5 = 1.0$, $b_1 = 0.2$, $b_2 = -0.05$, $b_3 = 0.02$.\n\nFor each case:\n- Construct the basis vectors $\\phi_j$ evaluated at all grid points.\n- Compute the corrected source $S_\\perp$ by projecting $S$ onto the null space complement of the span of the $\\phi_j$ with respect to the weight matrix implied by $\\langle \\cdot, \\cdot \\rangle_W$.\n- Compute the invariant residuals $r_j = \\langle \\phi_j, S_\\perp \\rangle_W$ for $j \\in \\{0,1,2,3,4\\}$.\n- Report for the case the single float equal to $\\max_{j} |r_j|$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[r_1,r_2,r_3]$, where each $r_k$ corresponds to the maximum absolute residual for Case $k$ in the order listed above.",
            "solution": "The problem requires the derivation and implementation of a numerical method to enforce discrete conservation laws for a linearized collision operator in a plasma simulation. The method involves projecting the uncorrected collisional source term, $S(\\mathbf{v})$, onto the orthogonal complement of the subspace spanned by the collisional invariants.\n\nThis problem is set in the context of kinetic theory, where the evolution of a particle distribution function is described. Here, we consider the perturbation to a background distribution, $h(\\mathbf{v})$, and its evolution due to collisions, modeled by a linearized operator $L$. The discrete form of the kinetic equation for a time step $\\Delta t$ is $h^{n+1} = h^n + \\Delta t S$, where $S=Lh$ is the collisional source term.\n\nIn the continuous case, the collision operator conserves particle number, momentum, and energy. This property mathematically translates to the source term being orthogonal to the functions representing these conserved quantities (the collisional invariants). When the problem is discretized onto a finite velocity grid, this conservation property may be lost due to approximation errors. The task is to restore it by applying a minimal correction to the source term $S$ at each step.\n\nThe mathematical framework is a finite-dimensional vector space where functions on the grid are represented as vectors. The space is equipped with a weighted inner product, defined as:\n$$\n\\langle a, b \\rangle_W = \\sum_{i=1}^{N} w_i a(\\mathbf{v}_i) b(\\mathbf{v}_i)\n$$\nwhere $\\mathbf{v}_i$ are the $N$ points of the velocity grid and $w_i  0$ are corresponding quadrature weights.\n\nThe collisional invariants are given as a set of five functions:\n\\begin{itemize}\n    \\item $\\phi_0(\\mathbf{v}) = 1$ (related to number density)\n    \\item $\\phi_1(\\mathbf{v}) = v_x$, $\\phi_2(\\mathbf{v}) = v_y$, $\\phi_3(\\mathbf{v}) = v_z$ (related to momentum)\n    \\item $\\phi_4(\\mathbf{v}) = \\lVert \\mathbf{v} \\rVert^2 = v_x^2 + v_y^2 + v_z^2$ (related to kinetic energy)\n\\end{itemize}\nThese five functions span a subspace, let us call it $U$, within the vector space of all functions on the grid.\n$$\nU = \\text{span}\\{\\phi_0, \\phi_1, \\phi_2, \\phi_3, \\phi_4\\}\n$$\nThe discrete conservation requirement is that the corrected source term, $S_\\perp$, must be orthogonal to each of these basis functions with respect to the defined inner product:\n$$\n\\langle \\phi_j, S_\\perp \\rangle_W = 0 \\quad \\text{for } j \\in \\{0, 1, 2, 3, 4\\}\n$$\nThis condition implies that $S_\\perp$ must belong to the orthogonal complement of the subspace $U$, denoted $U^\\perp$.\n\nThe problem specifies that $S_\\perp$ should be derived from the uncorrected source $S$ via an orthogonal projection. The unique vector in $U^\\perp$ that is closest to $S$ (in the sense of the norm induced by the inner product) is the orthogonal projection of $S$ onto $U^\\perp$. Any vector $S$ can be uniquely decomposed into a component in $U$ and a component in $U^\\perp$:\n$$\nS = S_\\| + S_\\perp\n$$\nwhere $S_\\| = \\text{proj}_U(S)$ is the projection of $S$ onto $U$, and $S_\\perp = \\text{proj}_{U^\\perp}(S)$ is the projection onto $U^\\perp$. Our desired corrected source is $S_\\perp = S - S_\\|$.\n\nTo find $S_\\|$, we express it as a linear combination of the basis vectors of $U$:\n$$\nS_\\| = \\sum_{k=0}^{4} c_k \\phi_k\n$$\nThe coefficients $c_k$ are determined by the condition that the difference vector $S - S_\\|$ must be orthogonal to the subspace $U$. This is satisfied if the difference vector is orthogonal to every basis vector of $U$:\n$$\n\\langle \\phi_j, S - S_\\| \\rangle_W = 0 \\quad \\text{for } j \\in \\{0, 1, 2, 3, 4\\}\n$$\nUsing the linearity of the inner product, we get:\n$$\n\\langle \\phi_j, S \\rangle_W = \\langle \\phi_j, S_\\| \\rangle_W = \\left\\langle \\phi_j, \\sum_{k=0}^{4} c_k \\phi_k \\right\\rangle_W = \\sum_{k=0}^{4} c_k \\langle \\phi_j, \\phi_k \\rangle_W\n$$\nThis constitutes a system of $5$ linear equations for the $5$ unknown coefficients $c_k$. We can express this in matrix form, $Gc = b$, where:\n- $G$ is the $5 \\times 5$ Gram matrix with elements $G_{jk} = \\langle \\phi_j, \\phi_k \\rangle_W$.\n- $c$ is the column vector of coefficients $[c_0, c_1, c_2, c_3, c_4]^T$.\n- $b$ is a column vector with elements $b_j = \\langle \\phi_j, S \\rangle_W$.\n\nThe steps to implement the solution are:\n1.  **Construct the grid and weights.** For a point $\\mathbf{v}_i = (v_{x,p}, v_{y,q}, v_{z,r})$, the weight is $w_i = \\delta v_{x,p} \\delta v_{y,q} \\delta v_{z,r}$. The one-dimensional cell widths $\\delta v$ are computed based on the distance to adjacent nodes as specified.\n2.  **Represent functions as vectors.** Evaluate the functions $S$ and $\\phi_j$ at each of the $N$ grid points to obtain vectors in $\\mathbb{R}^N$.\n3.  **Assemble and solve the linear system.** Compute the matrix $G$ and vector $b$ using the discrete inner product. Then, solve the linear system $Gc = b$ for the coefficient vector $c$. The Gram matrix $G$ is symmetric and positive-definite (as long as the $\\phi_j$ are linearly independent on the grid), so a unique solution for $c$ exists.\n4.  **Compute the corrected source.** Calculate the projection onto the invariant subspace, $S_\\| = \\sum_{k=0}^4 c_k \\phi_k$. Then obtain the corrected source via subtraction: $S_\\perp = S - S_\\|$.\n5.  **Calculate residuals.** To verify the conservation property, compute the residuals $r_j = \\langle \\phi_j, S_\\perp \\rangle_W$. The final reported value for each case is the maximum absolute residual, $\\max_j |r_j|$. This value quantifies the numerical precision of the conservation enforcement.\nThe time step $\\Delta t$ and the distribution $h^n$ are given for context and to define $S$, but do not directly enter the calculation of the residuals of $S_\\perp$.",
            "answer": "```python\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Solves the conservation-fixing problem for three given test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (happy path)\n        {\n            \"vx_nodes\": np.array([-2.0, -1.0, 0.0, 1.0, 2.0]),\n            \"vy_nodes\": np.array([-2.0, -1.0, 0.0, 1.0, 2.0]),\n            \"vz_nodes\": np.array([-2.0, -1.0, 0.0, 1.0, 2.0]),\n            \"dt\": 0.1,\n            \"h_func\": lambda vx, vy, vz: np.exp(-(vx**2 + vy**2 + vz**2)),\n            \"s_func\": lambda vx, vy, vz, h: (\n                -0.4 * h + 0.3 * vx - 0.1 * (vx**2 + vy**2 + vz**2) + 0.05 * vx * vy\n            ),\n        },\n        # Case 2 (boundary case: zero source)\n        {\n            \"vx_nodes\": np.array([-1.0, 0.0, 1.0]),\n            \"vy_nodes\": np.array([-1.0, 0.0, 1.0]),\n            \"vz_nodes\": np.array([-1.0, 0.0, 1.0]),\n            \"dt\": 0.5,\n            \"h_func\": lambda vx, vy, vz: np.exp(-(vx**2 + vy**2 + vz**2)),\n            \"s_func\": lambda vx, vy, vz, h: 0.0,\n        },\n        # Case 3 (edge case: nonuniform grid and large timestep)\n        {\n            \"vx_nodes\": np.array([-3.0, -1.0, 0.0, 0.5, 2.0]),\n            \"vy_nodes\": np.array([-2.5, -0.5, 0.2, 1.7]),\n            \"vz_nodes\": np.array([-1.5, -0.7, -0.2, 0.4, 1.4, 3.0]),\n            \"dt\": 10.0,\n            \"h_func\": lambda vx, vy, vz: np.exp(-(vx**2 + vy**2 + vz**2)),\n            \"s_func\": lambda vx, vy, vz, h: (\n                2.0 * vx - 3.0 * vy + 1.5 * vz + 0.7 * (vx**2 + vy**2 + vz**2) \n                - 1.0 * h + 0.2 * vx * vy - 0.05 * vy * vz + 0.02 * vx * vz\n            ),\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        vx_nodes, vy_nodes, vz_nodes = case[\"vx_nodes\"], case[\"vy_nodes\"], case[\"vz_nodes\"]\n\n        # 1. Construct the grid and weights\n        def get_weights_1d(nodes):\n            if len(nodes)  2:\n                # For a single point, the concept of a cell width is ill-defined.\n                # However, the problem implies grids with at least 3 points.\n                # For robustness, we handle this.\n                return np.ones_like(nodes) if len(nodes) == 1 else np.array([])\n            \n            dv = np.zeros_like(nodes, dtype=float)\n            dv[0] = (nodes[1] - nodes[0]) / 2.0\n            dv[-1] = (nodes[-1] - nodes[-2]) / 2.0\n            dv[1:-1] = (nodes[2:] - nodes[:-2]) / 2.0\n            return dv\n\n        dvx = get_weights_1d(vx_nodes)\n        dvy = get_weights_1d(vy_nodes)\n        dvz = get_weights_1d(vz_nodes)\n\n        # Create 3D grid and weights\n        vx, vy, vz = np.meshgrid(vx_nodes, vy_nodes, vz_nodes, indexing='ij')\n        weights_3d = np.einsum('i,j,k-ijk', dvx, dvy, dvz)\n        \n        # Flatten all arrays\n        N = vx.size\n        vx_flat = vx.flatten()\n        vy_flat = vy.flatten()\n        vz_flat = vz.flatten()\n        w_flat = weights_3d.flatten()\n\n        # 2. Evaluate functions on the grid\n        h = case[\"h_func\"](vx_flat, vy_flat, vz_flat)\n        s_uncorrected = case[\"s_func\"](vx_flat, vy_flat, vz_flat, h)\n\n        # Define invariant basis functions\n        phi_0 = np.ones(N)\n        phi_1 = vx_flat\n        phi_2 = vy_flat\n        phi_3 = vz_flat\n        phi_4 = vx_flat**2 + vy_flat**2 + vz_flat**2\n        phis = [phi_0, phi_1, phi_2, phi_3, phi_4]\n        \n        # 3. Assemble and solve the linear system\n        num_invariants = len(phis)\n        gram_matrix = np.zeros((num_invariants, num_invariants))\n        b_vector = np.zeros(num_invariants)\n\n        w_s = w_flat * s_uncorrected\n        for j in range(num_invariants):\n            b_vector[j] = np.sum(phis[j] * w_s)\n            for k in range(j, num_invariants):\n                val = np.sum(phis[j] * w_flat * phis[k])\n                gram_matrix[j, k] = val\n                gram_matrix[k, j] = val\n\n        coeffs = linalg.solve(gram_matrix, b_vector, assume_a='sym')\n\n        # 4. Compute the corrected source\n        s_parallel = np.zeros(N)\n        for k in range(num_invariants):\n            s_parallel += coeffs[k] * phis[k]\n        \n        s_perp = s_uncorrected - s_parallel\n\n        # 5. Calculate residuals\n        residuals = []\n        w_s_perp = w_flat * s_perp\n        for j in range(num_invariants):\n            residual = np.sum(phis[j] * w_s_perp)\n            residuals.append(residual)\n        \n        max_abs_residual = np.max(np.abs(residuals))\n        results.append(max_abs_residual)\n\n    # Format the final output\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}