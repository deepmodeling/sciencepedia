{
    "hands_on_practices": [
        {
            "introduction": "在等离子体动理学模拟中，一个核心挑战是处理由碰撞算子引起的数值刚度。这种刚度源于系统中存在的多种物理过程，它们的时间尺度可能相差悬殊，例如，快速的碰撞过程和相对较慢的粒子输运过程。本练习  将通过分析一个简化的动理学模型，引导您定量地理解这一问题，您将比较碰撞、平流和驱动项的特征值，从而揭示为何显式时间积分方法在处理含碰撞的等离子体问题时会受到严苛的时间步长限制。",
            "id": "4180542",
            "problem": "考虑在聚变等离子体湍流模拟中，扰动分布 $g$ 的线性化动理学方程，该方程写在一维平行位形空间和速度空间中，\n$$\n\\partial_t g + v_{\\parallel}\\,\\partial_z g + i\\,\\omega_*\\, g \\;=\\; L\\,g,\n$$\n其中 $v_{\\parallel}$ 是平行速度，$\\omega_*$ 是一个恒定的抗磁驱动频率，$L$ 是一个线性化碰撞算符。假设一个简化模型，其中 $L$ 由两个解耦的测试粒子部分组成：螺距角散射和能量扩散，它们分别作用于螺距角余弦 $\\xi$ 和归一化速率 $u = v/v_{\\mathrm{th}}$，\n$$\nL \\;=\\; \\nu\\,\\partial_{\\xi}\\!\\left[(1-\\xi^2)\\,\\partial_{\\xi}\\,\\cdot\\right] \\;+\\; \\nu\\,\\partial_{uu}\\,,\n$$\n其中 $\\nu$ 是恒定的碰撞频率，$v_{\\mathrm{th}}$ 是热速度。在 $\\xi$ 中采用勒让德多项式 $P_{\\ell}(\\xi)$ 进行谱表示（因此 $\\partial_{\\xi}[(1-\\xi^2)\\partial_{\\xi}] P_{\\ell} = -\\ell(\\ell+1) P_{\\ell}$），在 $\\ell_{\\max}$ 处截断，并在 $u$ 中采用一个具有均匀间距 $\\Delta u$ 和足够分辨率的网格，使得 $u$ 空间中能解析的最大波数可以估计为 $k_{u,\\max} \\approx \\pi/\\Delta u$。对于平流项，取波数为 $k_{\\parallel}$ 的单个平行傅里叶模式，因此其线性频率标度为 $\\omega_s = v_{\\mathrm{th}}\\,k_{\\parallel}$。假设所有其他非线性项和场耦合都已关闭。\n\n使用以下数值上合理的参数，这些参数代表了电子尺度湍流的分辨率和碰撞强度：\n- $\\nu = 5\\times 10^5\\ \\mathrm{s}^{-1}$，\n- $\\ell_{\\max} = 32$，\n- $\\Delta u = 0.01$，\n- $v_{\\mathrm{th}} = 6\\times 10^7\\ \\mathrm{m/s}$，\n- $k_{\\parallel} = 100\\ \\mathrm{m}^{-1}$，\n- $\\omega_* = 8\\times 10^4\\ \\mathrm{s}^{-1}$。\n\n基于螺距角散射算符和 $u$ 空间中扩散算符的谱特性的第一性原理，以及平流项和驱动项的形式，哪个选项正确解释了为什么碰撞算符相对于平流项和驱动项会引入刚性，并为应用于半离散系统的完全显式前向欧拉时间积分器提供了最严格的稳定性限制时间步长 $\\Delta t$ 的一致估计？\n\n选择一项：\n\nA. 螺距角算符的本征值为 $-\\nu\\,\\ell(\\ell+1)$，$u$-扩散的本征值为 $-\\nu\\,k_u^2$，因此最大的负实部约为 $\\lambda_{\\max}^{(L)} \\approx -\\nu\\,\\ell_{\\max}(\\ell_{\\max}+1)$ 或 $-\\nu\\,(\\pi/\\Delta u)^2$，取两者中较大者。根据给定参数，来自 $u$-扩散的 $|\\lambda_{\\max}^{(L)}|$ 超过了 $|\\omega_s|$ 和 $|\\omega_*|$，使得系统变得刚性；前向欧拉稳定性边界为 $\\Delta t \\lesssim 2/|\\lambda_{\\max}^{(L)}| \\approx 4\\times 10^{-11}\\ \\mathrm{s}$。\n\nB. 碰撞算符贡献的是纯虚本征值，仅改变 $g$ 的相位，因此刚性不是由碰撞引起的。时间步长受限于平流项，$\\Delta t \\lesssim 1/|\\omega_s| \\approx 1.7\\times 10^{-10}\\ \\mathrm{s}$。\n\nC. 碰撞算符的最大本征值为 $-\\nu$，与速度空间分辨率无关，因此时间步长边界为 $\\Delta t \\lesssim 2/\\nu \\approx 4\\times 10^{-6}\\ \\mathrm{s}$，这远大于平流项的边界。\n\nD. 刚性主要由螺距角散射主导，其 $\\lambda_{\\max}^{(L)} \\approx -\\nu\\,\\ell_{\\max}(\\ell_{\\max}+1)$，因此时间步长边界为 $\\Delta t \\lesssim 2/\\left[\\nu\\,\\ell_{\\max}(\\ell_{\\max}+1)\\right] \\approx 4\\times 10^{-9}\\ \\mathrm{s}$；$u$ 中的能量扩散是次要的，可以在刚性估计中忽略。",
            "solution": "从线性化动理学方程开始，\n$$\n\\partial_t g + v_{\\parallel}\\,\\partial_z g + i\\,\\omega_*\\, g \\;=\\; L\\,g,\n$$\n其中 $L$ 由螺距角散射和能量扩散组成，\n$$\nL \\;=\\; \\nu\\,\\partial_{\\xi}\\!\\left[(1-\\xi^2)\\,\\partial_{\\xi}\\,\\cdot\\right] \\;+\\; \\nu\\,\\partial_{uu}\\,.\n$$\n我们分析每一项的谱特性。\n\n对于螺距角散射算符，其众所周知的本征函数是勒让德多项式 $P_{\\ell}(\\xi)$，且\n$$\n\\partial_{\\xi}\\!\\left[(1-\\xi^2)\\,\\partial_{\\xi} P_{\\ell}\\right] \\;=\\; -\\,\\ell(\\ell+1)\\,P_{\\ell}.\n$$\n乘以 $\\nu$，螺距角散射贡献的本征值为\n$$\n\\lambda_{\\ell}^{(\\xi)} \\;=\\; -\\,\\nu\\,\\ell(\\ell+1).\n$$\n在 $\\ell_{\\max}$ 处截断，螺距角散射产生的最负的本征值为\n$$\n\\lambda_{\\max}^{(\\xi)} \\;=\\; -\\,\\nu\\,\\ell_{\\max}(\\ell_{\\max}+1).\n$$\n给定 $\\nu = 5\\times 10^5\\ \\mathrm{s}^{-1}$ 和 $\\ell_{\\max}=32$，我们有 $\\ell_{\\max}(\\ell_{\\max}+1) = 32\\times 33 = 1056$，因此\n$$\n|\\lambda_{\\max}^{(\\xi)}| \\;=\\; \\nu\\,\\ell_{\\max}(\\ell_{\\max}+1) \\;=\\; (5\\times 10^5)\\times 1056 \\;\\approx\\; 5.28\\times 10^8\\ \\mathrm{s}^{-1}.\n$$\n\n对于归一化速率坐标 $u = v/v_{\\mathrm{th}}$ 中的能量扩散算符，连续算符为 $\\nu\\,\\partial_{uu}$，其傅里叶本征值为 $-\\nu\\,k_u^2$。在间距为 $\\Delta u$ 的网格上，可解析的最大波数可估计为 $k_{u,\\max} \\approx \\pi/\\Delta u$，因此 $u$-扩散产生的最负本征值的绝对值为\n$$\n|\\lambda_{\\max}^{(u)}| \\;\\approx\\; \\nu\\,k_{u,\\max}^2 \\;\\approx\\; \\nu\\left(\\frac{\\pi}{\\Delta u}\\right)^2.\n$$\n给定 $\\nu = 5\\times 10^5\\ \\mathrm{s}^{-1}$ 和 $\\Delta u = 0.01$，我们发现\n$$\n\\left(\\frac{\\pi}{\\Delta u}\\right)^2 \\;=\\; \\left(\\frac{3.14159}{0.01}\\right)^2 \\;\\approx\\; (314.159)^2 \\;\\approx\\; 9.87\\times 10^4,\n$$\n所以\n$$\n|\\lambda_{\\max}^{(u)}| \\;\\approx\\; (5\\times 10^5)\\times (9.87\\times 10^4) \\;\\approx\\; 4.94\\times 10^{10}\\ \\mathrm{s}^{-1}.\n$$\n\n接下来，考虑平流项。对于波数为 $k_{\\parallel}$ 的单个平行傅里叶模式，其平流频率标度为\n$$\n\\omega_s \\;=\\; v_{\\mathrm{th}}\\,k_{\\parallel}.\n$$\n给定 $v_{\\mathrm{th}} = 6\\times 10^7\\ \\mathrm{m/s}$ 和 $k_{\\parallel} = 100\\ \\mathrm{m}^{-1}$，\n$$\n|\\omega_s| \\;=\\; (6\\times 10^7)\\times 100 \\;=\\; 6\\times 10^9\\ \\mathrm{s}^{-1}.\n$$\n抗磁驱动贡献一个纯虚项 $i\\omega_*$，其 $|\\omega_*| = 8\\times 10^4\\ \\mathrm{s}^{-1}$。\n\n比较各个尺度：\n- $|\\lambda_{\\max}^{(u)}| \\approx 4.94\\times 10^{10}\\ \\mathrm{s}^{-1}$ (实数，负值),\n- $|\\lambda_{\\max}^{(\\xi)}| \\approx 5.28\\times 10^{8}\\ \\mathrm{s}^{-1}$ (实数，负值),\n- $|\\omega_s| \\approx 6\\times 10^{9}\\ \\mathrm{s}^{-1}$ (纯虚数),\n- $|\\omega_*| \\approx 8\\times 10^{4}\\ \\mathrm{s}^{-1}$ (纯虚数).\n\n最大绝对值的本征值来自碰撞算符，特别是 $u$ 空间中的能量扩散。因为这些本征值具有大的负实部，它们引入了刚性：与速度空间扩散相关的最快衰减模式在 $O(1/|\\lambda_{\\max}^{(u)}|)$ 的时间尺度上演化，这远短于平流或驱动的时间尺度。在应用于线性系统 $\\partial_t y = A y$ 的显式前向欧拉格式中，对于具有负实部的本征值 $\\lambda$，沿该本征模的稳定性要求是 $|1 + \\Delta t\\,\\lambda| \\le 1$，对于实数负值 $\\lambda$，这简化为\n$$\n\\Delta t \\;\\le\\; \\frac{2}{|\\lambda|}.\n$$\n因此，最严格的显式时间步长由 $L$ 的最大负实部本征值控制，即，\n$$\n\\Delta t_{\\max} \\;\\approx\\; \\frac{2}{|\\lambda_{\\max}^{(L)}|} \\;\\approx\\; \\frac{2}{|\\lambda_{\\max}^{(u)}|} \\;\\approx\\; \\frac{2}{4.94\\times 10^{10}} \\;\\approx\\; 4.05\\times 10^{-11}\\ \\mathrm{s}.\n$$\n相比之下，平流项和驱动项是纯虚的，不会施加这种前向欧拉扩散类型的边界；它们在实践中的显式稳定性遵循一个依赖于空间离散化的 Courant–Friedrichs–Lewy (CFL) 限制。即使人们估计一个朴素的边界 $\\Delta t \\sim 1/|\\omega_s| \\approx 1.7\\times 10^{-10}\\ \\mathrm{s}$，它仍然比上面计算的碰撞扩散边界要宽松。因此，在这些分辨率和参数选择下，碰撞使得半离散动理学系统相对于平流项和驱动项变得刚性。\n\n逐项分析：\n- 选项 A 正确地陈述了本征值的标度：螺距角散射为 $-\\nu\\,\\ell(\\ell+1)$，$u$-扩散为 $-\\nu\\,k_u^2$。它指出了在给定的 $\\Delta u$ 下，最大绝对值的本征值是由 $u$-扩散引起的，并正确地将其与 $|\\omega_s|$ 和 $|\\omega_*|$ 进行了比较，得出了刚性的结论。其时间步长估计 $\\Delta t \\lesssim 2/|\\lambda_{\\max}^{(L)}|$ 和数值 $\\approx 4\\times 10^{-11}\\ \\mathrm{s}$ 与上述推导一致。结论：正确。\n- 选项 B 错误地声称碰撞贡献的是纯虚本征值；实际上，扩散算符产生的是负实数本征值，这正是显式格式中刚性的来源。仅由平流项限制的时间步长 $\\Delta t \\lesssim 1/|\\omega_s|$ 忽略了主导的碰撞稳定性约束。结论：错误。\n- 选项 C 断言最大的碰撞本征值为 $-\\nu$，与速度空间分辨率无关，这与扩散（$\\propto k^2$）和螺距角散射（$\\propto \\ell(\\ell+1)$）的谱标度相矛盾。由此产生的时间步长 $\\Delta t \\approx 2/\\nu$ 大了好几个数量级，并且忽略了由分辨率引起的刚性。结论：错误。\n- 选项 D 只关注螺距角散射，忽略了 $u$-扩散的贡献，而在给定参数下，$u$-扩散的贡献要大得多。其时间步长估计 $\\approx 4\\times 10^{-9}\\ \\mathrm{s}$ 比来自 $u$-扩散的正确边界要宽松，因此不一致。结论：错误。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "理解了碰撞算子带来的刚度问题后，我们自然会思考如何设计有效的数值方案来克服它。一种强大且广泛应用的策略是隐式-显式 (IMEX) 方法，其核心思想是对引起刚度的项（如碰撞）采用隐式处理以保证稳定性，而对非刚性项（如平流）采用显式处理以提高计算效率。在本练习  中，您将为一个模型问题推导并分析一个一阶 IMEX 格式，确定其线性稳定性条件，从而掌握构建稳定高效的时间积分算法的基本原理。",
            "id": "4180514",
            "problem": "要求您设计并分析一个时间积分格式，该格式用于聚变等离子体湍流的线性模型，其中平行流显式处理，而节距角散射隐式处理。考虑用于描述回旋平均分布扰动的线性碰撞-流模型，该模型针对沿磁场坐标的单个傅里叶模式和节距角的单个勒让德多项式模式写为简化形式。连续模型为\n$$\n\\frac{d u}{d t} \\;=\\; \\mathcal{S}\\,u \\;+\\; \\mathcal{C}\\,u,\n$$\n其中 $u(t)$ 是一个复值振幅，$\\mathcal{S}$ 模拟平行流且是斜厄米算符，$\\mathcal{C}$ 模拟节距角散射且是自伴负半定算符。对于具有平行波数 $k$ 和单个勒让德多项式指数 $l$ 的单个傅里叶模式，该模型简化为标量常微分方程\n$$\n\\frac{d u}{d t} \\;=\\; -\\,i\\,a\\,u \\;-\\; c\\,u,\n$$\n其中 $a \\ge 0$ 是由平行流项引起的实数流频率（单位为 s$^{-1}$），$c \\ge 0$ 是由节距角散射产生的实数碰撞阻尼率（单位为 s$^{-1}$），例如，如果 $\\nu$ 是碰撞频率（单位为 s$^{-1}$），则 $c = \\nu\\,l(l+1)$。此处 $i$ 是虚数单位。\n\n您的任务如下。\n\n1) 构建一个一阶隐式-显式 (IMEX) 格式，其中碰撞算符被隐式处理，流算符被显式处理。用步长 $\\Delta t$（单位为 s）将时间从 $t^n$ 离散到 $t^{n+1} = t^n + \\Delta t$，并写出将 $u^n \\approx u(t^n)$ 更新到 $u^{n+1} \\approx u(t^{n+1})$ 的格式。\n\n2) 对于上述标量模型，推导相应的一步放大因子 $G(\\Delta t)$（定义为 $u^{n+1} = G(\\Delta t)\\,u^n$），并给出线性稳定性（即 $\\lvert G(\\Delta t) \\rvert \\le 1$）的充要条件。\n\n3) 将第 2 项中的线性稳定性条件简化为关联 $a$、$c$ 和 $\\Delta t$ 的显式代数不等式。分析该条件以获得：\n   - 该格式相对于 $\\Delta t$ 无条件稳定的区域，\n   - 以及，当非无条件稳定时，一个用 $a$ 和 $c$ 表示的关于 $\\Delta t$ 的显式界限，该界限保证 $\\lvert G(\\Delta t) \\rvert \\le 1$。\n\n所有数值出现的物理量必须用以下单位表示：$a$ 的单位为 s$^{-1}$，$c$ 的单位为 s$^{-1}$，$\\Delta t$ 的单位为 s。\n\n实现任务：\n编写一个完整的程序，对下面的每个测试用例，根据第 2 项中的标准评估第 1 项中推导的 IMEX 格式是否是线性稳定的。您的程序应为每个用例返回一个布尔结果：如果格式对于给定的 $(a,c,\\Delta t)$ 三元组是线性稳定的，则使用值 true，否则使用 false。测试套件如下：\n\n- 用例 1 (正常路径，零碰撞边界): $a = 1.0$ s$^{-1}$, $c = 0.0$ s$^{-1}$, $\\Delta t = 1.0 \\times 10^{-3}$ s.\n- 用例 2 (强碰撞，中等 $\\Delta t$): $a = 1.0$ s$^{-1}$, $c = 10.0$ s$^{-1}$, $\\Delta t = 0.1$ s.\n- 用例 3 (中等碰撞，小 $\\Delta t$): $a = 1.0$ s$^{-1}$, $c = 0.1$ s$^{-1}$, $\\Delta t = 0.1$ s.\n- 用例 4 (稳定性阈值处的边界情况): $a = 1.0$ s$^{-1}$, $c = 0.2360679774997897$ s$^{-1}$, $\\Delta t = 0.5$ s.\n- 用例 5 (流主导的不稳定性): $a = 10.0$ s$^{-1}$, $c = 0.1$ s$^{-1}$, $\\Delta t = 0.05$ s.\n- 用例 6 (极强碰撞，大 $\\Delta t$): $a = 1.0$ s$^{-1}$, $c = 100.0$ s$^{-1}$, $\\Delta t = 10.0$ s.\n\n最终输出格式：\n您的程序应生成单行输出，其中包含六个布尔结果，以逗号分隔列表的形式包含在方括号中，顺序与上述用例相同。例如：\"[True,False,True,True,False,True]\"。",
            "solution": "该问题陈述具有科学依据，提法得当且客观。它提出了一个等离子体物理学中的标准简化模型，并给出了一系列数值分析领域中清晰可解的任务。所有必要的参数都已定义，前提与既定原则一致。因此，该问题被认为是有效的，下面提供完整的解答。\n\n分析按要求分三部分进行：首先，构建隐式-显式 (IMEX) 时间积分格式；其次，推导该格式的放大因子和稳定性条件；第三，详细分析稳定性条件以确定稳定区域。\n\n控制复值振幅 $u(t)$ 的常微分方程 (ODE) 如下：\n$$\n\\frac{d u}{d t} = -\\,i\\,a\\,u - c\\,u\n$$\n其中 $a \\ge 0$ 是实值流频率，$c \\ge 0$ 是实值碰撞阻尼率，$i$ 是虚数单位。项 $-iau$ 代表平行流效应，对应于斜厄米算符 $\\mathcal{S}$，而项 $-cu$ 代表节距角散射，对应于自伴负半定算符 $\\mathcal{C}$。\n\n1) 一阶 IMEX 格式的构建\n\n我们的任务是构建一个一阶 IMEX 格式，其中流项 ($-iau$) 被显式处理，碰撞项 ($-cu$) 被隐式处理。我们将时间离散化，使得 $t^{n+1} = t^n + \\Delta t$，并令 $u^n$ 为 $u(t^n)$ 的数值近似。一阶时间导数用前向差分 $\\frac{u^{n+1} - u^n}{\\Delta t}$ 近似。\n\n在此格式中，右侧的显式部分在当前时间层 $n$ 进行计算，而隐式部分在未来时间层 $n+1$ 进行计算。这得出以下有限差分方程：\n$$\n\\frac{u^{n+1} - u^n}{\\Delta t} = -i\\,a\\,u^n - c\\,u^{n+1}\n$$\n该方法也称为 IMEX 欧拉格式，它结合了用于流项的前向欧拉步和用于碰撞项的后向欧拉步。为了获得 $u^{n+1}$ 的更新规则，我们重排方程以求解 $u^{n+1}$：\n$$\nu^{n+1} - u^n = \\Delta t (-i\\,a\\,u^n - c\\,u^{n+1})\n$$\n$$\nu^{n+1} + c\\,\\Delta t\\,u^{n+1} = u^n - i\\,a\\,\\Delta t\\,u^n\n$$\n$$\nu^{n+1} (1 + c\\,\\Delta t) = u^n (1 - i\\,a\\,\\Delta t)\n$$\n最后，除以 $(1 + c\\,\\Delta t)$（对于 $c \\ge 0$ 和 $\\Delta t > 0$ 该项非零），我们得到显式单步更新公式：\n$$\nu^{n+1} = \\left( \\frac{1 - i\\,a\\,\\Delta t}{1 + c\\,\\Delta t} \\right) u^n\n$$\n\n2) 放大因子和稳定性条件的推导\n\n单步放大因子（记为 $G(\\Delta t)$）通过关系式 $u^{n+1} = G(\\Delta t)\\,u^n$ 将连续两个时间步的解联系起来。通过将此定义与推导出的更新规则进行比较，我们可以直接确定此格式的放大因子：\n$$\nG(\\Delta t) = \\frac{1 - i\\,a\\,\\Delta t}{1 + c\\,\\Delta t}\n$$\n如果扰动不随时间增长，则数值格式是线性稳定的。对于单步法，这要求放大因子的模小于或等于 1。因此，稳定性条件为：\n$$\n\\lvert G(\\Delta t) \\rvert \\le 1\n$$\n我们计算 $G(\\Delta t)$ 的模。由于 $a$、$c$ 和 $\\Delta t$ 都是实量：\n$$\n\\lvert G(\\Delta t) \\rvert = \\left\\lvert \\frac{1 - i\\,a\\,\\Delta t}{1 + c\\,\\Delta t} \\right\\rvert = \\frac{\\lvert 1 - i\\,a\\,\\Delta t \\rvert}{\\lvert 1 + c\\,\\Delta t \\rvert}\n$$\n分子的模为 $\\lvert 1 - i\\,a\\,\\Delta t \\rvert = \\sqrt{1^2 + (-a\\,\\Delta t)^2} = \\sqrt{1 + a^2(\\Delta t)^2}$。\n分母是一个正实数，所以 $\\lvert 1 + c\\,\\Delta t \\rvert = 1 + c\\,\\Delta t$。\n将这些代入稳定性条件，得到：\n$$\n\\frac{\\sqrt{1 + a^2(\\Delta t)^2}}{1 + c\\,\\Delta t} \\le 1\n$$\n\n3) 线性稳定性条件分析\n\n为了使这个条件更明确，我们对不等式进行处理。由于两边都是正数，我们可以对它们进行平方而不改变不等式的方向：\n$$\n\\frac{1 + a^2(\\Delta t)^2}{(1 + c\\,\\Delta t)^2} \\le 1\n$$\n乘以正分母 $(1 + c\\,\\Delta t)^2$：\n$$\n1 + a^2(\\Delta t)^2 \\le (1 + c\\,\\Delta t)^2 = 1 + 2c\\,\\Delta t + c^2(\\Delta t)^2\n$$\n两边同时减去 $1$：\n$$\na^2(\\Delta t)^2 \\le 2c\\,\\Delta t + c^2(\\Delta t)^2\n$$\n假设时间步长 $\\Delta t > 0$ 为正，我们可以将整个不等式除以 $\\Delta t$：\n$$\na^2\\,\\Delta t \\le 2c + c^2\\,\\Delta t\n$$\n重排各项以分离出 $\\Delta t$：\n$$\na^2\\,\\Delta t - c^2\\,\\Delta t \\le 2c\n$$\n$$\n(a^2 - c^2)\\,\\Delta t \\le 2c\n$$\n这就是关联 $a$、$c$ 和 $\\Delta t$ 的最终代数不等式。我们通过考虑项 $(a^2 - c^2)$ 的符号来分析此条件。\n\n无条件稳定区域：\n如果该不等式对所有 $\\Delta t > 0$ 都成立，则格式是无条件稳定的。这种情况发生在左侧 $\\Delta t$ 的系数为非正数，而右侧为非负数时。右侧的 $2c$ 因为 $c \\ge 0$ 而是非负的。$\\Delta t$ 的系数是 $(a^2 - c^2)$。如果 $a^2 - c^2 \\le 0$，那么对于任何 $\\Delta t > 0$，左侧都是一个非正数。一个非正数总是小于或等于一个非负数。因此，无条件稳定的条件是 $a^2 - c^2 \\le 0$，考虑到 $a, c \\ge 0$，这等价于 $a \\le c$。\n从物理上讲，这意味着如果碰撞阻尼率大于或等于流频率，该格式对于任何时间步长都是稳定的。强大的隐式耗散稳定了显式的振荡部分。\n\n条件稳定区域和时间步长限制：\n如果 $a^2 - c^2 > 0$，这等价于 $a > c$，那么 $\\Delta t$ 的系数是正数。为了满足该不等式，我们可以除以 $(a^2 - c^2)$ 而不改变不等式方向，从而得到 $\\Delta t$ 的一个上界：\n$$\n\\Delta t \\le \\frac{2c}{a^2 - c^2}\n$$\n在这个流主导的区域 ($a > c$)，该格式只是条件稳定的。时间步长 $\\Delta t$ 必须小于临界值 $\\frac{2c}{a^2 - c^2}$ 以确保数值稳定性。在 $c=0$ 且 $a>0$ 的特定情况下（纯流，显式处理），稳定性限制变为 $\\Delta t \\le 0$，这对于前向时间步是不可能的，这正确地表明前向欧拉格式对于振荡问题总是不稳定的。\n\n实现将基于这两个区域来测试稳定性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the linear stability of a first-order IMEX scheme for a simplified\n    plasma turbulence model based on the derived criteria.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple represents (a, c, Delta_t) in units of s^-1, s^-1, and s.\n    test_cases = [\n        (1.0, 0.0, 1.0e-3),             # Case 1\n        (1.0, 10.0, 0.1),                # Case 2\n        (1.0, 0.1, 0.1),                 # Case 3\n        (1.0, 0.2360679774997897, 0.5), # Case 4 (c = sqrt(5) - 2)\n        (10.0, 0.1, 0.05),               # Case 5\n        (1.0, 100.0, 10.0),              # Case 6\n    ]\n\n    results = []\n    for a, c, dt in test_cases:\n        # The stability analysis provides two regimes based on the relative\n        # values of the streaming frequency 'a' and collisional rate 'c'.\n        # The problem statement guarantees a >= 0 and c >= 0.\n        # A time step dt is inherently positive.\n\n        if a = c:\n            # Unconditionally stable regime.\n            # The inequality (a**2 - c**2) * dt = 2*c is always satisfied\n            # for dt > 0 because the left side is non-positive and the\n            # right side is non-negative.\n            is_stable = True\n        else: # a > c\n            # Conditionally stable regime.\n            # The denominator (a**2 - c**2) is guaranteed to be positive.\n            # No risk of division by zero.\n            #\n            # The case c=0 is handled correctly:\n            # If c=0 and a>0, dt_max becomes 0.\n            # Since dt > 0, the condition dt = dt_max will be False,\n            # correctly indicating instability for the explicit Euler scheme\n            # on an oscillatory problem.\n            dt_max = (2.0 * c) / (a**2 - c**2)\n            \n            # The scheme is stable if the time step is within the bound.\n            # The equality dt == dt_max corresponds to |G|=1, which is stable.\n            is_stable = (dt = dt_max)\n        \n        results.append(is_stable)\n\n    # Final print statement in the exact required format:\n    # A comma-separated list of boolean values enclosed in square brackets.\n    # The boolean values are capitalized in Python, so they are converted to lowercase.\n    print(f\"[{','.join(map(str, results))}]\".lower())\n\nsolve()\n```"
        },
        {
            "introduction": "一个可靠的数值模拟不仅要保证稳定性，还必须精确地遵守其所描述的物理系统的基本守恒律，例如粒子数、动量和能量的守恒。然而，数值离散化过程本身可能会引入误差，从而破坏这些守恒律。本练习  介绍了一种关键的修正技术：通过将碰撞项投影到与碰撞不变量正交的子空间上，来精确地强制执行这些守恒律。通过完成这个编码任务，您将掌握一个确保动理学模拟长期准确性和物理保真度的重要工具。",
            "id": "4180552",
            "problem": "在聚变等离子体湍流背景下，一项离散速度模拟旨在通过线性化碰撞算子 $L$ 来推进分布微扰 $h(\\mathbf{v})$ 的演化。在连续谱中，碰撞不变量意味着当碰撞算子与相应的不变量进行积分时，粒子数、动量和能量的交换为零。在数值上，离散化的 $L$ 可能在每个时间步都不能精确地保持这些不变量。本题的目标是，在一个有限的三维速度网格上，从第一性原理出发，推导并实现一个最小修正，该修正通过在每个时间步后将 $Lh$ 投影到零空间补集上来强制实现粒子数、动量和能量的精确离散守恒。\n\n从带有线性化碰撞源 $S(\\mathbf{v}) = Lh(\\mathbf{v})$ 的动理学方程和定义在点集 $\\mathbf{v}_i = (v_{x,i},v_{y,i},v_{z,i})$ （带有正求积权重 $w_i$）上的离散内积开始。离散内积定义为\n$$\n\\langle a, b \\rangle_W = \\sum_{i=1}^{N} w_i\\, a_i\\, b_i,\n$$\n其中 $a_i = a(\\mathbf{v}_i)$ 且 $b_i = b(\\mathbf{v}_i)$，$N$ 是网格点的总数。碰撞不变量包括常数函数 $\\phi_0(\\mathbf{v}) = 1$，速度分量 $\\phi_1(\\mathbf{v}) = v_x$、$\\phi_2(\\mathbf{v}) = v_y$、$\\phi_3(\\mathbf{v}) = v_z$，以及类动能函数 $\\phi_4(\\mathbf{v}) = \\lVert \\mathbf{v} \\rVert^2 = v_x^2+v_y^2+v_z^2$。在一个时间步上的离散守恒要求修正后的源项 $S_\\perp$ 满足\n$$\n\\langle \\phi_j, S_\\perp \\rangle_W = 0\n\\quad \\text{for} \\quad j \\in \\{0,1,2,3,4\\}.\n$$\n将该修正表述为 $S$ 在关于内积 $\\langle \\cdot, \\cdot \\rangle_W$ 的 $\\{\\phi_0,\\phi_1,\\phi_2,\\phi_3,\\phi_4\\}$ 生成子空间的零空间补集上的正交投影，并导出计算 $S_\\perp$ 所必须求解的线性代数系统。然后实现这个修正，并在每个时间步应用它，使得 $h^{n+1} = h^n + \\Delta t\\, S_\\perp$ 不会改变离散不变量。\n\n本问题中的所有量都是无量纲的，不需要物理单位。不使用角度。程序必须是自包含的，不读取任何外部输入；它应以指定格式输出单行结果。\n\n为以下每个测试用例，实现程序以构建速度网格、权重、一个测试分布 $h$ 和一个未修正的源项 $S$。对于均匀网格，权重等于均匀单元体积 $\\Delta v_x\\,\\Delta v_y\\,\\Delta v_z$。对于非均匀网格，在每个方向上使用一维节点位置数组，并通过到下一个节点距离的一半加上到前一个节点距离的一半来近似局部单元宽度（端点使用单个相邻区间的一半）。一个节点上的权重是三个方向单元宽度的乘积。\n\n测试套件：\n\n- 案例 1 (正常路径):\n  - 每个方向的网格节点：$\\{-2,-1,0,1,2\\}$，因此 $N = 5 \\times 5 \\times 5$。\n  - 时间步长：$\\Delta t = 0.1$。\n  - 分布：$h(\\mathbf{v}) = \\exp(-\\lVert \\mathbf{v} \\rVert^2)$。\n  - 源项：$S(\\mathbf{v}) = -\\nu h(\\mathbf{v}) + \\alpha v_x + \\beta \\lVert \\mathbf{v} \\rVert^2 + \\gamma v_x v_y$，其中 $\\nu = 0.4, \\alpha = 0.3, \\beta = -0.1, \\gamma = 0.05$。\n\n- 案例 2 (边界情况：零源项):\n  - 每个方向的网格节点：$\\{-1,0,1\\}$，因此 $N = 3 \\times 3 \\times 3$。\n  - 时间步长：$\\Delta t = 0.5$。\n  - 分布：$h(\\mathbf{v}) = \\exp(-\\lVert \\mathbf{v} \\rVert^2)$。\n  - 源项：$S(\\mathbf{v}) = 0$。\n\n- 案例 3 (边缘情况：非均匀网格和大时间步长):\n  - 网格节点：\n    - $v_x$ 节点：$\\{-3,-1,0,0.5,2\\}$，\n    - $v_y$ 节点：$\\{-2.5,-0.5,0.2,1.7\\}$，\n    - $v_z$ 节点：$\\{-1.5,-0.7,-0.2,0.4,1.4,3.0\\}$，\n    得到 $N = 5 \\times 4 \\times 6$。\n  - 时间步长：$\\Delta t = 10.0$。\n  - 分布：$h(\\mathbf{v}) = \\exp(-\\lVert \\mathbf{v} \\rVert^2)$。\n  - 源项：$S(\\mathbf{v}) = a_1 v_x + a_2 v_y + a_3 v_z + a_4 \\lVert \\mathbf{v} \\rVert^2 - a_5 h(\\mathbf{v}) + b_1 v_x v_y + b_2 v_y v_z + b_3 v_x v_z$，其中 $a_1 = 2.0, a_2 = -3.0, a_3 = 1.5, a_4 = 0.7, a_5 = 1.0, b_1 = 0.2, b_2 = -0.05, b_3 = 0.02$。\n\n对于每个案例：\n- 构建在所有网格点上求值的基向量 $\\phi_j$。\n- 通过将 $S$ 投影到由内积 $\\langle \\cdot, \\cdot \\rangle_W$ 所隐含的权重矩阵决定的 $\\phi_j$ 生成子空间的零空间补集上，来计算修正后的源项 $S_\\perp$。\n- 计算不变量残差 $r_j = \\langle \\phi_j, S_\\perp \\rangle_W$，其中 $j \\in \\{0,1,2,3,4\\}$。\n- 报告该案例的单个浮点数值，其等于 $\\max_{j} |r_j|$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，例如 $[r_1,r_2,r_3]$，其中每个 $r_k$ 对应于上面列出的第 $k$ 个案例的最大绝对残差。",
            "solution": "该问题要求推导并实现一种数值方法，用于在等离子体模拟中对线性化碰撞算子强制执行离散守恒律。该方法涉及将未经修正的碰撞源项 $S(\\mathbf{v})$ 投影到由碰撞不变量张成的子空间的正交补上。\n\n这个问题设置在动理学理论的背景下，该理论描述了粒子分布函数的演化。在这里，我们考虑对背景分布的微扰 $h(\\mathbf{v})$ 及其因碰撞引起的演化，该演化由线性化算子 $L$ 建模。对于一个时间步长 $\\Delta t$，动理学方程的离散形式是 $h^{n+1} = h^n + \\Delta t S$，其中 $S=Lh$ 是碰撞源项。\n\n在连续情况下，碰撞算子守恒粒子数、动量和能量。在数学上，这个性质转化为源项与代表这些守恒量（即碰撞不变量）的函数正交。当问题离散化到有限速度网格上时，由于近似误差，这个守恒性质可能会丢失。任务是在每个步骤中对源项 $S$ 应用最小修正来恢复它。\n\n其数学框架是一个有限维向量空间，其中网格上的函数表示为向量。该空间配备了一个加权内积，定义为：\n$$\n\\langle a, b \\rangle_W = \\sum_{i=1}^{N} w_i a(\\mathbf{v}_i) b(\\mathbf{v}_i)\n$$\n其中 $\\mathbf{v}_i$ 是速度网格的 $N$ 个点，$w_i  0$ 是相应的求积权重。\n\n碰撞不变量由一组五个函数给出：\n\\begin{itemize}\n    \\item $\\phi_0(\\mathbf{v}) = 1$ （与数密度相关）\n    \\item $\\phi_1(\\mathbf{v}) = v_x$, $\\phi_2(\\mathbf{v}) = v_y$, $\\phi_3(\\mathbf{v}) = v_z$ （与动量相关）\n    \\item $\\phi_4(\\mathbf{v}) = \\lVert \\mathbf{v} \\rVert^2 = v_x^2 + v_y^2 + v_z^2$ （与动能相关）\n\\end{itemize}\n这五个函数在网格上所有函数的向量空间中张成一个子空间，我们称之为 $U$。\n$$\nU = \\text{span}\\{\\phi_0, \\phi_1, \\phi_2, \\phi_3, \\phi_4\\}\n$$\n离散守恒要求是，修正后的源项 $S_\\perp$ 必须在所定义的内积下与这些基函数中的每一个都正交：\n$$\n\\langle \\phi_j, S_\\perp \\rangle_W = 0 \\quad \\text{for } j \\in \\{0, 1, 2, 3, 4\\}\n$$\n这个条件意味着 $S_\\perp$ 必须属于子空间 $U$ 的正交补，记为 $U^\\perp$。\n\n问题规定 $S_\\perp$ 应通过正交投影从未修正的源项 $S$ 推导得出。在 $U^\\perp$ 中，与 $S$ 最接近（在由内积导出的范数意义下）的唯一向量是 $S$ 在 $U^\\perp$ 上的正交投影。任何向量 $S$ 都可以唯一地分解为一个在 $U$ 中的分量和一个在 $U^\\perp$ 中的分量：\n$$\nS = S_\\| + S_\\perp\n$$\n其中 $S_\\| = \\text{proj}_U(S)$ 是 $S$ 在 $U$ 上的投影，而 $S_\\perp = \\text{proj}_{U^\\perp}(S)$ 是在 $U^\\perp$ 上的投影。我们所期望的修正源项是 $S_\\perp = S - S_\\|$。\n\n为了找到 $S_\\|$，我们将其表示为 $U$ 的基向量的线性组合：\n$$\nS_\\| = \\sum_{k=0}^{4} c_k \\phi_k\n$$\n系数 $c_k$ 由差向量 $S - S_\\|$ 必须与子空间 $U$ 正交的条件确定。如果差向量与 $U$ 的每个基向量都正交，则此条件得到满足：\n$$\n\\langle \\phi_j, S - S_\\| \\rangle_W = 0 \\quad \\text{for } j \\in \\{0, 1, 2, 3, 4\\}\n$$\n利用内积的线性性质，我们得到：\n$$\n\\langle \\phi_j, S \\rangle_W = \\langle \\phi_j, S_\\| \\rangle_W = \\left\\langle \\phi_j, \\sum_{k=0}^{4} c_k \\phi_k \\right\\rangle_W = \\sum_{k=0}^{4} c_k \\langle \\phi_j, \\phi_k \\rangle_W\n$$\n这构成了关于 5 个未知系数 $c_k$ 的 5 个线性方程组。我们可以将其表示为矩阵形式 $Gc = b$，其中：\n- $G$ 是 $5 \\times 5$ 的格拉姆矩阵 (Gram matrix)，其元素为 $G_{jk} = \\langle \\phi_j, \\phi_k \\rangle_W$。\n- $c$ 是系数的列向量 $[c_0, c_1, c_2, c_3, c_4]^T$。\n- $b$ 是一个列向量，其元素为 $b_j = \\langle \\phi_j, S \\rangle_W$。\n\n实现该解决方案的步骤如下：\n1.  **构建网格和权重。** 对于一个点 $\\mathbf{v}_i = (v_{x,p}, v_{y,q}, v_{z,r})$，权重为 $w_i = \\delta v_{x,p} \\delta v_{y,q} \\delta v_{z,r}$。一维单元宽度 $\\delta v$ 根据与相邻节点的距离按指定方式计算。\n2.  **将函数表示为向量。** 在 $N$ 个网格点上计算函数 $S$ 和 $\\phi_j$ 的值，以获得 $\\mathbb{R}^N$ 中的向量。\n3.  **组装并求解线性系统。** 使用离散内积计算矩阵 $G$ 和向量 $b$。然后，求解线性系统 $Gc = b$ 以得到系数向量 $c$。格拉姆矩阵 $G$ 是对称正定的（只要 $\\phi_j$ 在网格上是线性无关的），因此 $c$ 存在唯一解。\n4.  **计算修正后的源项。** 计算在不变量子空间上的投影 $S_\\| = \\sum_{k=0}^4 c_k \\phi_k$。然后通过相减得到修正后的源项：$S_\\perp = S - S_\\|$。\n5.  **计算残差。** 为验证守恒性质，计算残差 $r_j = \\langle \\phi_j, S_\\perp \\rangle_W$。每个案例最终报告的值是最大绝对残差 $\\max_j |r_j|$。该值量化了守恒强制执行的数值精度。\n时间步长 $\\Delta t$ 和分布 $h^n$ 是为提供背景和定义 $S$ 而给出的，但它们不直接参与 $S_\\perp$ 残差的计算。",
            "answer": "```python\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Solves the conservation-fixing problem for three given test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (happy path)\n        {\n            \"vx_nodes\": np.array([-2.0, -1.0, 0.0, 1.0, 2.0]),\n            \"vy_nodes\": np.array([-2.0, -1.0, 0.0, 1.0, 2.0]),\n            \"vz_nodes\": np.array([-2.0, -1.0, 0.0, 1.0, 2.0]),\n            \"dt\": 0.1,\n            \"h_func\": lambda vx, vy, vz: np.exp(-(vx**2 + vy**2 + vz**2)),\n            \"s_func\": lambda vx, vy, vz, h: (\n                -0.4 * h + 0.3 * vx - 0.1 * (vx**2 + vy**2 + vz**2) + 0.05 * vx * vy\n            ),\n        },\n        # Case 2 (boundary case: zero source)\n        {\n            \"vx_nodes\": np.array([-1.0, 0.0, 1.0]),\n            \"vy_nodes\": np.array([-1.0, 0.0, 1.0]),\n            \"vz_nodes\": np.array([-1.0, 0.0, 1.0]),\n            \"dt\": 0.5,\n            \"h_func\": lambda vx, vy, vz: np.exp(-(vx**2 + vy**2 + vz**2)),\n            \"s_func\": lambda vx, vy, vz, h: 0.0,\n        },\n        # Case 3 (edge case: nonuniform grid and large timestep)\n        {\n            \"vx_nodes\": np.array([-3.0, -1.0, 0.0, 0.5, 2.0]),\n            \"vy_nodes\": np.array([-2.5, -0.5, 0.2, 1.7]),\n            \"vz_nodes\": np.array([-1.5, -0.7, -0.2, 0.4, 1.4, 3.0]),\n            \"dt\": 10.0,\n            \"h_func\": lambda vx, vy, vz: np.exp(-(vx**2 + vy**2 + vz**2)),\n            \"s_func\": lambda vx, vy, vz, h: (\n                2.0 * vx - 3.0 * vy + 1.5 * vz + 0.7 * (vx**2 + vy**2 + vz**2) \n                - 1.0 * h + 0.2 * vx * vy - 0.05 * vy * vz + 0.02 * vx * vz\n            ),\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        vx_nodes, vy_nodes, vz_nodes = case[\"vx_nodes\"], case[\"vy_nodes\"], case[\"vz_nodes\"]\n\n        # 1. Construct the grid and weights\n        def get_weights_1d(nodes):\n            if len(nodes)  2:\n                # For a single point, the concept of a cell width is ill-defined.\n                # However, the problem implies grids with at least 3 points.\n                # For robustness, we handle this.\n                return np.ones_like(nodes) if len(nodes) == 1 else np.array([])\n            \n            dv = np.zeros_like(nodes, dtype=float)\n            dv[0] = (nodes[1] - nodes[0]) / 2.0\n            dv[-1] = (nodes[-1] - nodes[-2]) / 2.0\n            dv[1:-1] = (nodes[2:] - nodes[:-2]) / 2.0\n            return dv\n\n        dvx = get_weights_1d(vx_nodes)\n        dvy = get_weights_1d(vy_nodes)\n        dvz = get_weights_1d(vz_nodes)\n\n        # Create 3D grid and weights\n        vx, vy, vz = np.meshgrid(vx_nodes, vy_nodes, vz_nodes, indexing='ij')\n        weights_3d = np.einsum('i,j,k->ijk', dvx, dvy, dvz)\n        \n        # Flatten all arrays\n        N = vx.size\n        vx_flat = vx.flatten()\n        vy_flat = vy.flatten()\n        vz_flat = vz.flatten()\n        w_flat = weights_3d.flatten()\n\n        # 2. Evaluate functions on the grid\n        h = case[\"h_func\"](vx_flat, vy_flat, vz_flat)\n        s_uncorrected = case[\"s_func\"](vx_flat, vy_flat, vz_flat, h)\n\n        # Define invariant basis functions\n        phi_0 = np.ones(N)\n        phi_1 = vx_flat\n        phi_2 = vy_flat\n        phi_3 = vz_flat\n        phi_4 = vx_flat**2 + vy_flat**2 + vz_flat**2\n        phis = [phi_0, phi_1, phi_2, phi_3, phi_4]\n        \n        # 3. Assemble and solve the linear system\n        num_invariants = len(phis)\n        gram_matrix = np.zeros((num_invariants, num_invariants))\n        b_vector = np.zeros(num_invariants)\n\n        w_s = w_flat * s_uncorrected\n        for j in range(num_invariants):\n            b_vector[j] = np.sum(phis[j] * w_s)\n            for k in range(j, num_invariants):\n                val = np.sum(phis[j] * w_flat * phis[k])\n                gram_matrix[j, k] = val\n                gram_matrix[k, j] = val\n\n        coeffs = linalg.solve(gram_matrix, b_vector, assume_a='sym')\n\n        # 4. Compute the corrected source\n        s_parallel = np.zeros(N)\n        for k in range(num_invariants):\n            s_parallel += coeffs[k] * phis[k]\n        \n        s_perp = s_uncorrected - s_parallel\n\n        # 5. Calculate residuals\n        residuals = []\n        w_s_perp = w_flat * s_perp\n        for j in range(num_invariants):\n            residual = np.sum(phis[j] * w_s_perp)\n            residuals.append(residual)\n        \n        max_abs_residual = np.max(np.abs(residuals))\n        results.append(max_abs_residual)\n\n    # Format the final output\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}