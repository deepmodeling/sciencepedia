{
    "hands_on_practices": [
        {
            "introduction": "The safety factor, denoted by $q$, is a crucial parameter in magnetic confinement, quantifying the helical pitch of magnetic field lines on a given flux surface. Surfaces where $q$ is a rational number, $q = m/n$, are known as rational surfaces and are particularly important as they can be resonant with magnetohydrodynamic (MHD) instabilities, which can degrade plasma confinement. This exercise  provides a direct, analytical practice in connecting a given plasma equilibrium, represented by its $q$-profile, to the specific locations within the plasma where these potentially disruptive instabilities are expected to arise.",
            "id": "4194764",
            "problem": "Consider a large-aspect-ratio, axisymmetric tokamak with circular, concentric magnetic flux surfaces, minor radius $a$, and major radius $R_0$. The safety factor $q(r)$ is defined as the ratio of the toroidal to poloidal winding of magnetic field lines, which in the large-aspect-ratio limit can be written as $q(r) \\approx \\frac{r B_{\\phi}(r)}{R_0 B_{\\theta}(r)}$, where $B_{\\phi}$ and $B_{\\theta}$ are the toroidal and poloidal magnetic field components, respectively. A rational surface is located at radii $r$ where $q(r) = \\frac{m}{n}$ for integers $m$ and $n$, and such surfaces are known to be resonant for Magnetohydrodynamic (MHD) modes and can seed microturbulent activity in fusion plasma turbulence simulations.\n\nSuppose the measured equilibrium safety-factor profile in this tokamak is well-approximated by the quadratic form\n$$\nq(r) = q_0 + \\alpha \\left(\\frac{r}{a}\\right)^{2},\n$$\nwhere $q_0 > 0$ and $\\alpha > 0$ are dimensionless constants. Assuming this profile is monotonic in $r$ and physically consistent with a centrally peaked current density, determine the location of the rational surface where $q = \\frac{3}{2}$ and calculate the corresponding radius $r_{3/2}$.\n\nUse the following parameters: $a = 0.75\\,\\mathrm{m}$, $q_0 = 0.95$, and $\\alpha = 0.80$. Round your final numerical answer for $r_{3/2}$ to four significant figures and express your answer in meters.",
            "solution": "The problem statement is critically evaluated and found to be valid. It is scientifically grounded in the principles of Magnetohydrodynamics (MHD) as applied to tokamak plasmas, is well-posed with a complete and consistent set of givens, and is expressed in objective, formal language. The provided model for the safety factor profile is a standard and physically reasonable approximation. All specified parameters have realistic values. Therefore, a solution can be determined.\n\nThe equilibrium safety-factor profile $q(r)$ in the a large-aspect-ratio, circular tokamak is given by the quadratic form:\n$$\nq(r) = q_0 + \\alpha \\left(\\frac{r}{a}\\right)^{2}\n$$\nHere, $r$ is the minor radial coordinate, $a$ is the plasma minor radius, $q_0$ is the safety factor at the magnetic axis ($r=0$), and $\\alpha$ is a dimensionless parameter that shapes the profile.\n\nWe are tasked with finding the location of the rational surface where the safety factor is $q=\\frac{3}{2}$. A rational surface is defined by the condition $q(r) = m/n$ where $m$ and $n$ are integers. In this specific case, we are interested in the $m=3$, $n=2$ surface. Let the radius of this surface be denoted by $r_{3/2}$. We can find this radius by setting $q(r_{3/2})$ equal to $\\frac{3}{2}$:\n$$\nq(r_{3/2}) = q_0 + \\alpha \\left(\\frac{r_{3/2}}{a}\\right)^{2} = \\frac{3}{2}\n$$\nOur goal is to solve this equation for $r_{3/2}$. We can rearrange the equation algebraically to isolate the term containing $r_{3/2}$:\n$$\n\\alpha \\left(\\frac{r_{3/2}}{a}\\right)^{2} = \\frac{3}{2} - q_0\n$$\nDividing by $\\alpha$ yields:\n$$\n\\left(\\frac{r_{3/2}}{a}\\right)^{2} = \\frac{\\frac{3}{2} - q_0}{\\alpha}\n$$\nTo solve for $r_{3/2}$, we take the square root of both sides. Since $r_{3/2}$ represents a physical radius, it must be a non-negative quantity. Therefore, we take the positive square root:\n$$\n\\frac{r_{3/2}}{a} = \\sqrt{\\frac{\\frac{3}{2} - q_0}{\\alpha}}\n$$\nFinally, multiplying by the minor radius $a$ gives the symbolic expression for the location of the rational surface:\n$$\nr_{3/2} = a \\sqrt{\\frac{\\frac{3}{2} - q_0}{\\alpha}}\n$$\nThe problem provides the following numerical values for the parameters:\n$a = 0.75\\,\\mathrm{m}$\n$q_0 = 0.95$\n$\\alpha = 0.80$\n\nWe can substitute these values into the symbolic expression. Note that $\\frac{3}{2} = 1.5$.\n$$\nr_{3/2} = 0.75 \\sqrt{\\frac{1.5 - 0.95}{0.80}}\n$$\nFirst, we evaluate the numerator inside the square root:\n$$\n1.5 - 0.95 = 0.55\n$$\nNext, we evaluate the fraction inside the square root:\n$$\n\\frac{0.55}{0.80} = 0.6875\n$$\nThe expression for $r_{3/2}$ becomes:\n$$\nr_{3/2} = 0.75 \\sqrt{0.6875}\n$$\nCalculating the square root:\n$$\n\\sqrt{0.6875} \\approx 0.82915619758\n$$\nNow, we multiply by the minor radius $a$:\n$$\nr_{3/2} \\approx 0.75 \\times 0.82915619758 \\approx 0.62186714818\\,\\mathrm{m}\n$$\nThe problem requires the final answer to be rounded to four significant figures.\n$$\nr_{3/2} \\approx 0.6219\\,\\mathrm{m}\n$$\nThis value is physically meaningful as it lies within the plasma minor radius, i.e., $0 < r_{3/2} < a$ ($0.6219\\,\\mathrm{m} < 0.75\\,\\mathrm{m}$). This is consistent with the fact that the target value $q = 1.5$ lies between the on-axis value $q(0) = q_0 = 0.95$ and the edge value $q(a) = q_0 + \\alpha = 0.95 + 0.80 = 1.75$.",
            "answer": "$$\n\\boxed{0.6219}\n$$"
        },
        {
            "introduction": "Numerical simulations are indispensable tools for understanding plasma turbulence, but they are governed by strict numerical stability constraints. The Courant-Friedrichs-Lewy (CFL) condition, for example, limits the maximum time step in explicit schemes based on the fastest physical processes and the grid resolution. This practice  is a crucial exercise in computational plasma physics, demonstrating how to derive and apply this stability limit for an advection model including both rapid parallel streaming and slower perpendicular drifts. By comparing the drift terms for a tokamak and a stellarator, you will gain a concrete understanding of how differences in magnetic geometry directly impact the computational cost of a turbulence simulation.",
            "id": "4194742",
            "problem": "Consider a fusion plasma turbulence simulation in a magnetic confinement device using a field-line-following grid with coordinates $(x,y,s)$, where $s$ is the coordinate along the magnetic field $\\mathbf{B}$ (parallel direction), $x$ is the radial coordinate across flux surfaces, and $y$ is the binormal (ballooning) coordinate within a flux surface. The evolution of a passive scalar $f$ advected by parallel streaming and magnetic drifts is governed by first principles through the conservation law $\\partial f / \\partial t + \\mathbf{v} \\cdot \\nabla f = 0$, where the velocity field is $\\mathbf{v} = v_{\\parallel} \\mathbf{b} + \\mathbf{v}_{d}$, with $\\mathbf{b} = \\mathbf{B}/|\\mathbf{B}|$ the unit vector along the magnetic field and $\\mathbf{v}_{d}$ representing magnetic curvature and gradient drifts projected on $(x,y)$.\n\nYou will determine the numerical Courant-Friedrichs-Lewy (CFL) condition for an unsplit explicit finite-volume, first-order upwind scheme in three dimensions, integrated in time by a Strong Stability Preserving Runge-Kutta of order $3$ (SSP-RK3). The grid spacing is uniform and given by $\\Delta s = 0.20\\,\\mathrm{m}$, $\\Delta x = 0.005\\,\\mathrm{m}$, and $\\Delta y = 0.010\\,\\mathrm{m}$ (all lengths are along their respective physical directions). Parallel streaming speed is $v_{\\parallel} = 2.0 \\times 10^{5}\\,\\mathrm{m/s}$. Magnetic drift components across the perpendicular plane differ between devices: for the tokamak, $(v_{d,x}^{\\mathrm{T}}, v_{d,y}^{\\mathrm{T}}) = (20, 60)\\,\\mathrm{m/s}$; for the stellarator, $(v_{d,x}^{\\mathrm{S}}, v_{d,y}^{\\mathrm{S}}) = (20, 120)\\,\\mathrm{m/s}$. Assume a single global time step must be stable for both devices simultaneously, and use the worst-case drift magnitudes across the two. \n\nStarting only from the conservation law and properties of upwind finite-volume discretization with SSP-RK3 time integration, derive the multidimensional CFL restriction appropriate for this unsplit scheme in the $(x,y,s)$ directions. Then evaluate the corresponding maximum stable time step under the given parameters, and finally propose a production time step by applying a safety factor $\\sigma = 0.80$ to the maximum stable value. Round your final proposed time step to four significant figures, and express the answer in seconds (use the unit $\\mathrm{s}$).",
            "solution": "The problem requires the determination of a stable numerical time step for a plasma turbulence simulation. The validation of the problem statement confirms its scientific and mathematical soundness, completeness, and clarity. The problem is well-posed and grounded in the principles of computational plasma physics.\n\nThe governing equation for the passive scalar $f$ is the advection equation:\n$$\n\\frac{\\partial f}{\\partial t} + \\mathbf{v} \\cdot \\nabla f = 0\n$$\nIn the given field-line-following coordinates $(x, y, s)$, the velocity vector $\\mathbf{v}$ has components $(v_x, v_y, v_s)$, where $v_x$ and $v_y$ are the components of the magnetic drift velocity $\\mathbf{v}_d$, and $v_s$ is the parallel streaming velocity $v_{\\parallel}$. The equation expands to:\n$$\n\\frac{\\partial f}{\\partial t} + v_x \\frac{\\partial f}{\\partial x} + v_y \\frac{\\partial f}{\\partial y} + v_s \\frac{\\partial f}{\\partial s} = 0\n$$\nThis is a $3$-dimensional linear hyperbolic partial differential equation.\n\nThe numerical scheme consists of a first-order upwind finite-volume discretization in space and a Strong Stability Preserving Runge-Kutta method of order $3$ (SSP-RK$3$) for time integration. We are considering an unsplit explicit scheme.\n\nFor a first-order upwind discretization of the advection equation, the stability of an explicit time-stepping scheme is limited by the Courant-Friedrichs-Lewy (CFL) condition. For the Forward Euler time integration method, the stability condition for a $1$-dimensional problem $\\partial_t f + v \\partial_x f = 0$ is given by the Courant number $C = \\frac{|v| \\Delta t}{\\Delta x} \\le 1$.\n\nFor the $3$-dimensional, unsplit scheme, the contributions from each spatial direction are additive. The semi-discrete form for a grid cell centered at $(x_i, y_j, s_k)$ is:\n$$\n\\frac{df_{i,j,k}}{dt} = \\mathcal{L}(f)_{i,j,k}\n$$\nwhere $\\mathcal{L}$ is the spatial discretization operator. For first-order upwind, this operator is:\n$$\n\\mathcal{L}(f)_{i,j,k} = - \\left( \\frac{|v_x|}{\\Delta x}(f_{i,j,k} - f_{\\text{upwind},x}) + \\frac{|v_y|}{\\Delta y}(f_{i,j,k} - f_{\\text{upwind},y}) + \\frac{|v_s|}{\\Delta s}(f_{i,j,k} - f_{\\text{upwind},s}) \\right)\n$$\nwhere $f_{\\text{upwind},d}$ is the value of $f$ in the adjacent cell in the upwind direction for the velocity component $v_d$.\n\nWhen integrated with the Forward Euler method, $f^{n+1} = f^n + \\Delta t \\mathcal{L}(f^n)$, this scheme is stable (and monotone) if all coefficients in the update formula are non-negative. This leads to the multidimensional CFL condition:\n$$\n\\Delta t \\left( \\frac{|v_x|}{\\Delta x} + \\frac{|v_y|}{\\Delta y} + \\frac{|v_s|}{\\Delta s} \\right) \\le 1\n$$\nStrong Stability Preserving (SSP) methods are designed to preserve the stability properties of the Forward Euler method. An SSP-RK method can be expressed as a convex combination of Forward Euler steps. For the first-order upwind spatial discretization, which is a monotone scheme under the CFL condition for Forward Euler, the SSP-RK$3$ method is also stable under the same condition. The effective SSP coefficient for this specific combination of spatial and temporal schemes is $1$.\n\nTherefore, the maximum stable time step, $\\Delta t_{max}$, is given by the equality:\n$$\n\\Delta t_{max} \\left( \\frac{|v_x|}{\\Delta x} + \\frac{|v_y|}{\\Delta y} + \\frac{|v_s|}{\\Delta s} \\right) = 1\n$$\nThis can be rearranged to solve for $\\Delta t_{max}$:\n$$\n\\Delta t_{max} = \\left( \\frac{|v_x|}{\\Delta x} + \\frac{|v_y|}{\\Delta y} + \\frac{|v_s|}{\\Delta s} \\right)^{-1}\n$$\nThe problem requires using a single global time step that is stable for both tokamak and stellarator configurations, based on the worst-case drift magnitudes. The worst case corresponds to the largest velocity magnitudes, as this imposes the most restrictive limit on the time step.\n\nThe given velocity components are:\n- Parallel streaming: $v_s = v_{\\parallel} = 2.0 \\times 10^{5}\\,\\mathrm{m/s}$.\n- Tokamak drifts: $(v_{d,x}^{\\mathrm{T}}, v_{d,y}^{\\mathrm{T}}) = (20, 60)\\,\\mathrm{m/s}$.\n- Stellarator drifts: $(v_{d,x}^{\\mathrm{S}}, v_{d,y}^{\\mathrm{S}}) = (20, 120)\\,\\mathrm{m/s}$.\n\nThe worst-case (largest) magnitudes for the drift velocities are:\n- $|v_x| = \\max(|20|, |20|) = 20\\,\\mathrm{m/s}$.\n- $|v_y| = \\max(|60|, |120|) = 120\\,\\mathrm{m/s}$.\n\nThe grid spacings are given as:\n- $\\Delta x = 0.005\\,\\mathrm{m}$.\n- $\\Delta y = 0.010\\,\\mathrm{m}$.\n- $\\Delta s = 0.20\\,\\mathrm{m}$.\n\nWe can now compute the terms in the sum:\n- CFL frequency for $x$-direction: $\\frac{|v_x|}{\\Delta x} = \\frac{20\\,\\mathrm{m/s}}{0.005\\,\\mathrm{m}} = 4000\\,\\mathrm{s}^{-1} = 4 \\times 10^3\\,\\mathrm{s}^{-1}$.\n- CFL frequency for $y$-direction: $\\frac{|v_y|}{\\Delta y} = \\frac{120\\,\\mathrm{m/s}}{0.010\\,\\mathrm{m}} = 12000\\,\\mathrm{s}^{-1} = 1.2 \\times 10^4\\,\\mathrm{s}^{-1}$.\n- CFL frequency for $s$-direction: $\\frac{|v_s|}{\\Delta s} = \\frac{2.0 \\times 10^5\\,\\mathrm{m/s}}{0.20\\,\\mathrm{m}} = 1000000\\,\\mathrm{s}^{-1} = 1 \\times 10^6\\,\\mathrm{s}^{-1}$.\n\nThe sum of these frequencies is:\n$$\nS = \\frac{|v_x|}{\\Delta x} + \\frac{|v_y|}{\\Delta y} + \\frac{|v_s|}{\\Delta s} = (4 \\times 10^3 + 1.2 \\times 10^4 + 1 \\times 10^6)\\,\\mathrm{s}^{-1}\n$$\n$$\nS = (0.004 \\times 10^6 + 0.012 \\times 10^6 + 1.0 \\times 10^6)\\,\\mathrm{s}^{-1} = 1.016 \\times 10^6\\,\\mathrm{s}^{-1}\n$$\nThe maximum stable time step is the reciprocal of this sum:\n$$\n\\Delta t_{max} = \\frac{1}{S} = \\frac{1}{1.016 \\times 10^6\\,\\mathrm{s}^{-1}} \\approx 9.84252 \\times 10^{-7}\\,\\mathrm{s}\n$$\nThe problem specifies using a safety factor $\\sigma = 0.80$ to determine the production time step, $\\Delta t_{prod}$:\n$$\n\\Delta t_{prod} = \\sigma \\cdot \\Delta t_{max} = 0.80 \\times \\frac{1}{1.016 \\times 10^6\\,\\mathrm{s}^{-1}}\n$$\n$$\n\\Delta t_{prod} \\approx 0.80 \\times 9.84252 \\times 10^{-7}\\,\\mathrm{s} \\approx 7.874016 \\times 10^{-7}\\,\\mathrm{s}\n$$\nFinally, we round this result to $4$ significant figures:\n$$\n\\Delta t_{prod} \\approx 7.874 \\times 10^{-7}\\,\\mathrm{s}\n$$",
            "answer": "$$\\boxed{7.874 \\times 10^{-7}}$$"
        },
        {
            "introduction": "A primary goal of fusion research is to design magnetic configurations that stably confine a hot plasma. Microinstabilities, such as the Ion Temperature Gradient (ITG) mode, are a major concern as they can drive turbulence that degrades confinement. The ballooning formalism is a powerful theoretical tool that simplifies this complex three-dimensional stability problem into a one-dimensional eigenvalue problem along a single magnetic field line, capturing the essential physics of the instability drive (e.g., from magnetic curvature) versus stabilization (e.g., from field line bending). In this advanced computational exercise , you will implement a numerical solver for the ballooning equation, allowing you to directly investigate how geometric properties like magnetic shear and helical shaping influence plasma stability.",
            "id": "4194738",
            "problem": "Consider the simplified linear ballooning representation of electrostatic Ion Temperature Gradient (ITG) modes in magnetically confined plasmas, appropriate for both tokamak and stellarator magnetic geometries. Along a single magnetic field line, the fluctuation envelope amplitude $ \\phi(\\theta) $ satisfies an eigenvalue problem of the form\n$$\n\\mathcal{H} \\, \\phi(\\theta) = \\mu \\, \\phi(\\theta),\n$$\nwith the self-adjoint operator\n$$\n\\mathcal{H} = -\\frac{d^2}{d\\theta^2} + U(\\theta),\n$$\nwhere $ \\theta $ is the ballooning angle measured along the field line (in radians), and $ U(\\theta) $ is an effective potential that encodes the perpendicular wavenumber and curvature drive. The effective potential is modeled by\n$$\nU(\\theta) = k_y^2 \\left[ 1 + \\left( s_{\\mathrm{eff}}(\\theta)\\, \\theta - \\alpha \\sin\\theta \\right)^2 \\right] - \\omega_D(\\theta),\n$$\nwhere $ k_y $ is the binormal wavenumber normalized to a characteristic gyroradius, $ \\alpha $ is the pressure gradient ballooning parameter, and $ s_{\\mathrm{eff}}(\\theta) $ is the effective magnetic shear including local shear reversal contributions. The curvature drift drive is\n$$\n\\omega_D(\\theta) = A_{\\mathrm{curv}} \\cos\\theta + A_{\\mathrm{hel}} \\cos(N_{\\mathrm{hel}} \\theta),\n$$\nwith $ A_{\\mathrm{curv}} $ the axisymmetric curvature amplitude and $ A_{\\mathrm{hel}} $ a helical curvature amplitude representing three-dimensional stellarator effects with mode number $ N_{\\mathrm{hel}} $. The effective magnetic shear is specified as\n$$\ns_{\\mathrm{eff}}(\\theta) = \\hat{s} + s_{\\mathrm{rev}} \\exp\\!\\left[ -\\frac{(\\theta - \\theta_0)^2}{\\Delta^2} \\right],\n$$\nwhere $ \\hat{s} $ is the background magnetic shear, $ s_{\\mathrm{rev}} $ is the local shear reversal amplitude centered at $ \\theta_0 $ with width $ \\Delta $. The boundary conditions are homogeneous Dirichlet $ \\phi(-\\theta_{\\max}) = \\phi(\\theta_{\\max}) = 0 $ on a finite domain $ \\theta \\in [-\\theta_{\\max}, \\theta_{\\max}] $.\n\nStarting from fundamental principles of linear wave propagation and the self-adjoint form of second-order differential operators, the spectrum $ \\{ \\mu \\} $ characterizes the net balance between stabilizing perpendicular compression and destabilizing curvature drive. A negative lowest eigenvalue $ \\mu_{\\min} $ indicates that the curvature drive locally overcomes the perpendicular stabilization, yielding a localized bound state that serves as a proxy for unstable ITG mode structure. The spatial localization can be quantified by the second-moment width\n$$\nw = \\sqrt{ \\frac{ \\int_{-\\theta_{\\max}}^{\\theta_{\\max}} \\theta^2 \\, |\\phi(\\theta)|^2 \\, d\\theta }{ \\int_{-\\theta_{\\max}}^{\\theta_{\\max}} |\\phi(\\theta)|^2 \\, d\\theta } }.\n$$\n\nYour task is to discretize $ \\mathcal{H} $ on the interval $ [-\\theta_{\\max}, \\theta_{\\max}] $ using a uniform grid and second-order central differences for $ -d^2/d\\theta^2 $ with homogeneous Dirichlet boundary conditions, construct the symmetric tridiagonal matrix representation of $ \\mathcal{H} $, and compute the algebraically smallest eigenvalue $ \\mu_{\\min} $ and its corresponding normalized eigenvector $ \\phi(\\theta) $. Then compute $ w $ using the discrete approximation of the integral with uniform spacing. All angles must be treated in radians. All quantities are dimensionless. Express $ \\mu_{\\min} $ and $ w $ for each test case as floats rounded to six decimal places.\n\nUse the following numerical specifications, which define the test suite:\n- Domain half-width: $ \\theta_{\\max} = 3\\pi $.\n- Number of grid points: $ N = 2001 $ uniformly spaced on $ [-\\theta_{\\max}, \\theta_{\\max}] $.\n- Discrete operator: $ \\mathcal{H} $ represented by the tridiagonal matrix with main diagonal $ 2/h^2 + U(\\theta_i) $ and off-diagonals $ -1/h^2 $, where $ h $ is the uniform grid spacing, applied to interior points $ i = 2, \\ldots, N-1 $.\n\nTest suite parameter sets $ (k_y, \\hat{s}, \\alpha, s_{\\mathrm{rev}}, \\theta_0, \\Delta, A_{\\mathrm{curv}}, A_{\\mathrm{hel}}, N_{\\mathrm{hel}}) $:\n1. Tokamak baseline: $ (0.35, 1.0, 0.6, 0.0, 0.0, 0.7, 0.45, 0.0, 0) $.\n2. Tokamak with local shear reversal near the outboard midplane: $ (0.35, 0.8, 0.5, -1.2, 0.0, 0.6, 0.45, 0.0, 0) $.\n3. Stellarator-like helical curvature and weak local shear reversal: $ (0.30, 0.8, 0.4, -0.5, 1.2, 0.8, 0.30, 0.25, 3) $.\n4. High ballooning parameter stabilizing case: $ (0.35, 0.5, 1.2, 0.0, 0.0, 0.6, 0.35, 0.0, 0) $.\n\nImplementation requirements:\n- Construct $ U(\\theta) $ exactly as specified above.\n- Compute $ \\mu_{\\min} $ and $ w $ for each test case.\n- Round each computed $ \\mu_{\\min} $ and $ w $ to six decimal places.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case in order 1 to 4, output $ \\mu_{\\min} $ followed by $ w $. The final list must therefore contain eight floats, namely $ [\\mu_{\\min}^{(1)}, w^{(1)}, \\mu_{\\min}^{(2)}, w^{(2)}, \\mu_{\\min}^{(3)}, w^{(3)}, \\mu_{\\min}^{(4)}, w^{(4)}] $.",
            "solution": "The user has provided a well-posed problem from the field of computational plasma physics, specifically concerning the stability of Ion Temperature Gradient (ITG) modes in magnetically confined plasmas. The problem is scientifically grounded, mathematically complete, and numerically feasible. I will therefore proceed with a full solution.\n\nThe problem requires solving the one-dimensional, time-independent SchrÃ¶dinger-like equation, also known as the ballooning equation in this context:\n$$\n\\mathcal{H} \\, \\phi(\\theta) = \\mu \\, \\phi(\\theta)\n$$\nwhere $ \\mathcal{H} = -\\frac{d^2}{d\\theta^2} + U(\\theta) $ is a self-adjoint operator, $ \\phi(\\theta) $ is the eigenfunction representing the mode amplitude along a magnetic field line, and $ \\mu $ is the corresponding eigenvalue. A negative lowest eigenvalue, $ \\mu_{\\min} < 0 $, signifies an unstable mode. The task is to find $ \\mu_{\\min} $ and the spatial width $ w $ of the corresponding eigenfunction $ \\phi_{\\min}(\\theta) $ for several sets of physical parameters.\n\nThe solution strategy is to discretize the differential operator $ \\mathcal{H} $ on a uniform grid and solve the resulting matrix eigenvalue problem.\n\n**1. Discretization of the Domain and Operator**\n\nThe continuous domain $ \\theta \\in [-\\theta_{\\max}, \\theta_{\\max}] $ is discretized into a uniform grid of $ N $ points. Let the grid points be $ \\theta_i = -\\theta_{\\max} + (i-1)h $ for $ i = 1, 2, \\ldots, N $. The grid spacing is $ h = (2\\theta_{\\max}) / (N-1) $. The problem specifies $ \\theta_{\\max} = 3\\pi $ and $ N = 2001 $.\n\nThe second derivative operator $ d^2/d\\theta^2 $ is approximated using a second-order central finite difference scheme:\n$$\n\\frac{d^2\\phi}{d\\theta^2}\\bigg|_{\\theta_i} \\approx \\frac{\\phi(\\theta_{i+1}) - 2\\phi(\\theta_i) + \\phi(\\theta_{i-1})}{h^2} = \\frac{\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}}{h^2}\n$$\nSubstituting this into the eigenvalue equation for an interior grid point $ \\theta_i $ ($ i \\in \\{2, \\ldots, N-1\\} $) yields:\n$$\n-\\left( \\frac{\\phi_{i-1} - 2\\phi_i + \\phi_{i+1}}{h^2} \\right) + U(\\theta_i)\\phi_i = \\mu \\phi_i\n$$\nRearranging this equation gives:\n$$\n-\\frac{1}{h^2} \\phi_{i-1} + \\left(\\frac{2}{h^2} + U(\\theta_i)\\right) \\phi_i - \\frac{1}{h^2} \\phi_{i+1} = \\mu \\phi_i\n$$\nThis defines a matrix eigenvalue problem $ \\mathbf{H}\\vec{\\phi} = \\mu\\vec{\\phi} $. The homogeneous Dirichlet boundary conditions, $ \\phi_1 = \\phi(-\\theta_{\\max}) = 0 $ and $ \\phi_N = \\phi(\\theta_{\\max}) = 0 $, eliminate the first and last columns and rows of the full $ N \\times N $ matrix, resulting in an effective eigenvalue problem for the vector of interior points $ \\vec{\\phi}_{\\text{int}} = [\\phi_2, \\phi_3, \\ldots, \\phi_{N-1}]^T $. The resulting matrix $ \\mathbf{H} $ is an $ (N-2) \\times (N-2) $ real, symmetric, tridiagonal matrix with:\n- Main diagonal elements: $ D_j = \\frac{2}{h^2} + U(\\theta_{j+1}) $ for $ j = 1, \\ldots, N-2 $.\n- Off-diagonal elements: $ E_j = -\\frac{1}{h^2} $ for $ j = 1, \\ldots, N-3 $.\n\n**2. Numerical Eigenvalue Solution**\n\nThe problem of finding the eigenvalues and eigenvectors of a symmetric tridiagonal matrix is a classic and efficiently solvable problem in numerical linear algebra. We are interested only in the algebraically smallest eigenvalue $ \\mu_{\\min} $ and its associated eigenvector. For this purpose, specialized algorithms are far more efficient than general-purpose eigensolvers. The `scipy.linalg.eigh_tridiagonal` function is perfectly suited for this task, as it is optimized for symmetric tridiagonal matrices and can be instructed to compute only a specific subset of eigenpairs. We will request the eigenpair corresponding to the lowest index ($0$), which for a symmetric matrix corresponds to the smallest eigenvalue.\n\n**3. Calculation of the Mode Width**\n\nOnce the eigenvector $ \\vec{\\phi}_{\\text{int}} $ corresponding to $ \\mu_{\\min} $ is found, it is padded with zeros at both ends to reconstruct the full discrete eigenfunction $ \\vec{\\phi} $ on the grid $ \\{\\theta_i\\}_{i=1}^N $. This satisfies the boundary conditions $ \\phi_1 = \\phi_N = 0 $.\n\nThe second-moment width $ w $ is defined by the integrals:\n$$\nw = \\sqrt{ \\frac{ \\int_{-\\theta_{\\max}}^{\\theta_{\\max}} \\theta^2 \\, |\\phi(\\theta)|^2 \\, d\\theta }{ \\int_{-\\theta_{\\max}}^{\\theta_{\\max}} |\\phi(\\theta)|^2 \\, d\\theta } }\n$$\nThese integrals are approximated by numerical summation over the grid points. For a uniform grid, the integral $ \\int f(\\theta) d\\theta $ is approximated by $ \\sum_i f(\\theta_i) h $. Applying this to the definition of $ w^2 $:\n$$\nw^2 \\approx \\frac{ \\sum_{i=1}^{N} \\theta_i^2 |\\phi_i|^2 h }{ \\sum_{i=1}^{N} |\\phi_i|^2 h } = \\frac{ \\sum_{i=1}^{N} \\theta_i^2 |\\phi_i|^2 }{ \\sum_{i=1}^{N} |\\phi_i|^2 }\n$$\nThe grid spacing $ h $ cancels out. The calculation thus involves computing two weighted sums over the grid using the computed discrete eigenfunction $ \\vec{\\phi} $.\n\n**4. Algorithmic Implementation Steps**\n\nThe overall algorithm proceeds as follows for each test case:\n1.  Define the numerical parameters: $ \\theta_{\\max} = 3\\pi $, $ N = 2001 $.\n2.  Set up the uniform grid $ \\theta_i $ for $ i=1, \\ldots, N $ and calculate the grid spacing $ h $.\n3.  Extract the physical parameters $ (k_y, \\hat{s}, \\alpha, s_{\\mathrm{rev}}, \\theta_0, \\Delta, A_{\\mathrm{curv}}, A_{\\mathrm{hel}}, N_{\\mathrm{hel}}) $.\n4.  Construct the potential $ U(\\theta_i) $ for the interior grid points $ i = 2, \\ldots, N-1 $. This involves first calculating $ s_{\\mathrm{eff}}(\\theta_i) $ and $ \\omega_D(\\theta_i) $.\n5.  Form the main diagonal and the off-diagonal of the $ (N-2) \\times (N-2) $ tridiagonal matrix $ \\mathbf{H} $.\n6.  Use `scipy.linalg.eigh_tridiagonal` to compute the lowest eigenvalue $ \\mu_{\\min} $ and its eigenvector $ \\vec{\\phi}_{\\text{int}} $.\n7.  Construct the full eigenvector $ \\vec{\\phi} $ of length $ N $ by padding $ \\vec{\\phi}_{\\text{int}} $ with zeros.\n8.  Compute the sums $ \\sum \\theta_i^2 |\\phi_i|^2 $ and $ \\sum |\\phi_i|^2 $ over all grid points.\n9.  Calculate $ w $ using the ratio of these sums.\n10. Round $ \\mu_{\\min} $ and $ w $ to six decimal places.\n11. Collate the results for all test cases and format them into the specified output string.",
            "answer": "[-0.07185,2.44146,-0.125692,2.052048,-0.120614,2.56943,0.063762,2.593259]"
        }
    ]
}