{
    "hands_on_practices": [
        {
            "introduction": "The magnetic field in a tokamak is not uniform but twists helically, a property quantified by the safety factor, $q(r)$, as a function of radius. This exercise  provides practice in a foundational skill: locating the specific \"rational surfaces\" where $q$ is a simple fraction. Understanding the location of these surfaces is critical, as they are the resonant sites where magnetohydrodynamic (MHD) instabilities can form and potentially disrupt plasma confinement.",
            "id": "4194764",
            "problem": "Consider a large-aspect-ratio, axisymmetric tokamak with circular, concentric magnetic flux surfaces, minor radius $a$, and major radius $R_0$. The safety factor $q(r)$ is defined as the ratio of the toroidal to poloidal winding of magnetic field lines, which in the large-aspect-ratio limit can be written as $q(r) \\approx \\frac{r B_{\\phi}(r)}{R_0 B_{\\theta}(r)}$, where $B_{\\phi}$ and $B_{\\theta}$ are the toroidal and poloidal magnetic field components, respectively. A rational surface is located at radii $r$ where $q(r) = \\frac{m}{n}$ for integers $m$ and $n$, and such surfaces are known to be resonant for Magnetohydrodynamic (MHD) modes and can seed microturbulent activity in fusion plasma turbulence simulations.\n\nSuppose the measured equilibrium safety-factor profile in this tokamak is well-approximated by the quadratic form\n$$\nq(r) = q_0 + \\alpha \\left(\\frac{r}{a}\\right)^{2},\n$$\nwhere $q_0  0$ and $\\alpha  0$ are dimensionless constants. Assuming this profile is monotonic in $r$ and physically consistent with a centrally peaked current density, determine the location of the rational surface where $q = \\frac{3}{2}$ and calculate the corresponding radius $r_{3/2}$.\n\nUse the following parameters: $a = 0.75\\,\\mathrm{m}$, $q_0 = 0.95$, and $\\alpha = 0.80$. Round your final numerical answer for $r_{3/2}$ to four significant figures and express your answer in meters.",
            "solution": "The problem statement is critically evaluated and found to be valid. It is scientifically grounded in the principles of Magnetohydrodynamics (MHD) as applied to tokamak plasmas, is well-posed with a complete and consistent set of givens, and is expressed in objective, formal language. The provided model for the safety factor profile is a standard and physically reasonable approximation. All specified parameters have realistic values. Therefore, a solution can be determined.\n\nThe equilibrium safety-factor profile $q(r)$ in a large-aspect-ratio, circular tokamak is given by the quadratic form:\n$$\nq(r) = q_0 + \\alpha \\left(\\frac{r}{a}\\right)^{2}\n$$\nHere, $r$ is the minor radial coordinate, $a$ is the plasma minor radius, $q_0$ is the safety factor at the magnetic axis ($r=0$), and $\\alpha$ is a dimensionless parameter that shapes the profile.\n\nWe are tasked with finding the location of the rational surface where the safety factor is $q=\\frac{3}{2}$. A rational surface is defined by the condition $q(r) = m/n$ where $m$ and $n$ are integers. In this specific case, we are interested in the $m=3$, $n=2$ surface. Let the radius of this surface be denoted by $r_{3/2}$. We can find this radius by setting $q(r_{3/2})$ equal to $\\frac{3}{2}$:\n$$\nq(r_{3/2}) = q_0 + \\alpha \\left(\\frac{r_{3/2}}{a}\\right)^{2} = \\frac{3}{2}\n$$\nOur goal is to solve this equation for $r_{3/2}$. We can rearrange the equation algebraically to isolate the term containing $r_{3/2}$:\n$$\n\\alpha \\left(\\frac{r_{3/2}}{a}\\right)^{2} = \\frac{3}{2} - q_0\n$$\nDividing by $\\alpha$ yields:\n$$\n\\left(\\frac{r_{3/2}}{a}\\right)^{2} = \\frac{\\frac{3}{2} - q_0}{\\alpha}\n$$\nTo solve for $r_{3/2}$, we take the square root of both sides. Since $r_{3/2}$ represents a physical radius, it must be a non-negative quantity. Therefore, we take the positive square root:\n$$\n\\frac{r_{3/2}}{a} = \\sqrt{\\frac{\\frac{3}{2} - q_0}{\\alpha}}\n$$\nFinally, multiplying by the minor radius $a$ gives the symbolic expression for the location of the rational surface:\n$$\nr_{3/2} = a \\sqrt{\\frac{\\frac{3}{2} - q_0}{\\alpha}}\n$$\nThe problem provides the following numerical values for the parameters:\n$a = 0.75\\,\\mathrm{m}$\n$q_0 = 0.95$\n$\\alpha = 0.80$\n\nWe can substitute these values into the symbolic expression. Note that $\\frac{3}{2} = 1.5$.\n$$\nr_{3/2} = 0.75 \\sqrt{\\frac{1.5 - 0.95}{0.80}}\n$$\nFirst, we evaluate the numerator inside the square root:\n$$\n1.5 - 0.95 = 0.55\n$$\nNext, we evaluate the fraction inside the square root:\n$$\n\\frac{0.55}{0.80} = 0.6875\n$$\nThe expression for $r_{3/2}$ becomes:\n$$\nr_{3/2} = 0.75 \\sqrt{0.6875}\n$$\nCalculating the square root:\n$$\n\\sqrt{0.6875} \\approx 0.82915619758\n$$\nNow, we multiply by the minor radius $a$:\n$$\nr_{3/2} \\approx 0.75 \\times 0.82915619758 \\approx 0.62186714818\\,\\mathrm{m}\n$$\nThe problem requires the final answer to be rounded to four significant figures.\n$$\nr_{3/2} \\approx 0.6219\\,\\mathrm{m}\n$$\nThis value is physically meaningful as it lies within the plasma minor radius, i.e., $0  r_{3/2}  a$ ($0.6219\\,\\mathrm{m}  0.75\\,\\mathrm{m}$). This is consistent with the fact that the target value $q = 1.5$ lies between the on-axis value $q(0) = q_0 = 0.95$ and the edge value $q(a) = q_0 + \\alpha = 0.95 + 0.80 = 1.75$.",
            "answer": "$$\n\\boxed{0.6219}\n$$"
        },
        {
            "introduction": "Plasma turbulence is largely driven by micro-instabilities that feed on the free energy stored in temperature and density gradients. The ballooning formalism is a powerful theoretical tool that transforms the complex three-dimensional stability analysis into a more tractable one-dimensional eigenvalue problem, offering deep insight into how magnetic geometry stabilizes or destabilizes these modes. This computational exercise  guides you through solving this eigenvalue problem, allowing you to directly observe how factors like magnetic shear and field line curvature govern the structure and stability of turbulent eddies.",
            "id": "4194738",
            "problem": "Consider the simplified linear ballooning representation of electrostatic Ion Temperature Gradient (ITG) modes in magnetically confined plasmas, appropriate for both tokamak and stellarator magnetic geometries. Along a single magnetic field line, the fluctuation envelope amplitude $ \\phi(\\theta) $ satisfies an eigenvalue problem of the form\n$$\n\\mathcal{H} \\, \\phi(\\theta) = \\mu \\, \\phi(\\theta),\n$$\nwith the self-adjoint operator\n$$\n\\mathcal{H} = -\\frac{d^2}{d\\theta^2} + U(\\theta),\n$$\nwhere $ \\theta $ is the ballooning angle measured along the field line (in radians), and $ U(\\theta) $ is an effective potential that encodes the perpendicular wavenumber and curvature drive. The effective potential is modeled by\n$$\nU(\\theta) = k_y^2 \\left[ 1 + \\left( s_{\\mathrm{eff}}(\\theta)\\, \\theta - \\alpha \\sin\\theta \\right)^2 \\right] - \\omega_D(\\theta),\n$$\nwhere $ k_y $ is the binormal wavenumber normalized to a characteristic gyroradius, $ \\alpha $ is the pressure gradient ballooning parameter, and $ s_{\\mathrm{eff}}(\\theta) $ is the effective magnetic shear including local shear reversal contributions. The curvature drift drive is\n$$\n\\omega_D(\\theta) = A_{\\mathrm{curv}} \\cos\\theta + A_{\\mathrm{hel}} \\cos(N_{\\mathrm{hel}} \\theta),\n$$\nwith $ A_{\\mathrm{curv}} $ the axisymmetric curvature amplitude and $ A_{\\mathrm{hel}} $ a helical curvature amplitude representing three-dimensional stellarator effects with mode number $ N_{\\mathrm{hel}} $. The effective magnetic shear is specified as\n$$\ns_{\\mathrm{eff}}(\\theta) = \\hat{s} + s_{\\mathrm{rev}} \\exp\\!\\left[ -\\frac{(\\theta - \\theta_0)^2}{\\Delta^2} \\right],\n$$\nwhere $ \\hat{s} $ is the background magnetic shear, $ s_{\\mathrm{rev}} $ is the local shear reversal amplitude centered at $ \\theta_0 $ with width $ \\Delta $. The boundary conditions are homogeneous Dirichlet $ \\phi(-\\theta_{\\max}) = \\phi(\\theta_{\\max}) = 0 $ on a finite domain $ \\theta \\in [-\\theta_{\\max}, \\theta_{\\max}] $.\n\nStarting from fundamental principles of linear wave propagation and the self-adjoint form of second-order differential operators, the spectrum $ \\{ \\mu \\} $ characterizes the net balance between stabilizing perpendicular compression and destabilizing curvature drive. A negative lowest eigenvalue $ \\mu_{\\min} $ indicates that the curvature drive locally overcomes the perpendicular stabilization, yielding a localized bound state that serves as a proxy for unstable ITG mode structure. The spatial localization can be quantified by the second-moment width\n$$\nw = \\sqrt{ \\frac{ \\int_{-\\theta_{\\max}}^{\\theta_{\\max}} \\theta^2 \\, |\\phi(\\theta)|^2 \\, d\\theta }{ \\int_{-\\theta_{\\max}}^{\\theta_{\\max}} |\\phi(\\theta)|^2 \\, d\\theta } }.\n$$\n\nYour task is to discretize $ \\mathcal{H} $ on the interval $ [-\\theta_{\\max}, \\theta_{\\max}] $ using a uniform grid and second-order central differences for $ -d^2/d\\theta^2 $ with homogeneous Dirichlet boundary conditions, construct the symmetric tridiagonal matrix representation of $ \\mathcal{H} $, and compute the algebraically smallest eigenvalue $ \\mu_{\\min} $ and its corresponding normalized eigenvector $ \\phi(\\theta) $. Then compute $ w $ using the discrete approximation of the integral with uniform spacing. All angles must be treated in radians. All quantities are dimensionless. Express $ \\mu_{\\min} $ and $ w $ for each test case as floats rounded to six decimal places.\n\nUse the following numerical specifications, which define the test suite:\n- Domain half-width: $ \\theta_{\\max} = 3\\pi $.\n- Number of grid points: $ N = 2001 $ uniformly spaced on $ [-\\theta_{\\max}, \\theta_{\\max}] $.\n- Discrete operator: $ \\mathcal{H} $ represented by the tridiagonal matrix with main diagonal $ 2/h^2 + U(\\theta_i) $ and off-diagonals $ -1/h^2 $, where $ h $ is the uniform grid spacing, applied to interior points $ i = 2, \\ldots, N-1 $.\n\nTest suite parameter sets $ (k_y, \\hat{s}, \\alpha, s_{\\mathrm{rev}}, \\theta_0, \\Delta, A_{\\mathrm{curv}}, A_{\\mathrm{hel}}, N_{\\mathrm{hel}}) $:\n1. Tokamak baseline: $ (0.35, 1.0, 0.6, 0.0, 0.0, 0.7, 0.45, 0.0, 0) $.\n2. Tokamak with local shear reversal near the outboard midplane: $ (0.35, 0.8, 0.5, -1.2, 0.0, 0.6, 0.45, 0.0, 0) $.\n3. Stellarator-like helical curvature and weak local shear reversal: $ (0.30, 0.8, 0.4, -0.5, 1.2, 0.8, 0.30, 0.25, 3) $.\n4. High ballooning parameter stabilizing case: $ (0.35, 0.5, 1.2, 0.0, 0.0, 0.6, 0.35, 0.0, 0) $.\n\nImplementation requirements:\n- Construct $ U(\\theta) $ exactly as specified above.\n- Compute $ \\mu_{\\min} $ and $ w $ for each test case.\n- Round each computed $ \\mu_{\\min} $ and $ w $ to six decimal places.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case in order 1 to 4, output $ \\mu_{\\min} $ followed by $ w $. The final list must therefore contain eight floats, namely $ [\\mu_{\\min}^{(1)}, w^{(1)}, \\mu_{\\min}^{(2)}, w^{(2)}, \\mu_{\\min}^{(3)}, w^{(3)}, \\mu_{\\min}^{(4)}, w^{(4)}] $.",
            "solution": "The user has provided a well-posed problem from the field of computational plasma physics, specifically concerning the stability of Ion Temperature Gradient (ITG) modes in magnetically confined plasmas. The problem is scientifically grounded, mathematically complete, and numerically feasible. I will therefore proceed with a full solution.\n\nThe problem requires solving the one-dimensional, time-independent Schrödinger-like equation, also known as the ballooning equation in this context:\n$$\n\\mathcal{H} \\, \\phi(\\theta) = \\mu \\, \\phi(\\theta)\n$$\nwhere $ \\mathcal{H} = -\\frac{d^2}{d\\theta^2} + U(\\theta) $ is a self-adjoint operator, $ \\phi(\\theta) $ is the eigenfunction representing the mode amplitude along a magnetic field line, and $ \\mu $ is the corresponding eigenvalue. A negative lowest eigenvalue, $ \\mu_{\\min}  0 $, signifies an unstable mode. The task is to find $ \\mu_{\\min} $ and the spatial width $ w $ of the corresponding eigenfunction $ \\phi_{\\min}(\\theta) $ for several sets of physical parameters.\n\nThe solution strategy is to discretize the differential operator $ \\mathcal{H} $ on a uniform grid and solve the resulting matrix eigenvalue problem.\n\n**1. Discretization of the Domain and Operator**\n\nThe continuous domain $ \\theta \\in [-\\theta_{\\max}, \\theta_{\\max}] $ is discretized into a uniform grid of $ N $ points. Let the grid points be $ \\theta_i = -\\theta_{\\max} + (i-1)h $ for $ i = 1, 2, \\ldots, N $. The grid spacing is $ h = (2\\theta_{\\max}) / (N-1) $. The problem specifies $ \\theta_{\\max} = 3\\pi $ and $ N = 2001 $.\n\nThe second derivative operator $ d^2/d\\theta^2 $ is approximated using a second-order central finite difference scheme:\n$$\n\\frac{d^2\\phi}{d\\theta^2}\\bigg|_{\\theta_i} \\approx \\frac{\\phi(\\theta_{i+1}) - 2\\phi(\\theta_i) + \\phi(\\theta_{i-1})}{h^2} = \\frac{\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}}{h^2}\n$$\nSubstituting this into the eigenvalue equation for an interior grid point $ \\theta_i $ ($ i \\in \\{2, \\ldots, N-1\\} $) yields:\n$$\n-\\left( \\frac{\\phi_{i-1} - 2\\phi_i + \\phi_{i+1}}{h^2} \\right) + U(\\theta_i)\\phi_i = \\mu \\phi_i\n$$\nRearranging this equation gives:\n$$\n-\\frac{1}{h^2} \\phi_{i-1} + \\left(\\frac{2}{h^2} + U(\\theta_i)\\right) \\phi_i - \\frac{1}{h^2} \\phi_{i+1} = \\mu \\phi_i\n$$\nThis defines a matrix eigenvalue problem $ \\mathbf{H}\\vec{\\phi} = \\mu\\vec{\\phi} $. The homogeneous Dirichlet boundary conditions, $ \\phi_1 = \\phi(-\\theta_{\\max}) = 0 $ and $ \\phi_N = \\phi(\\theta_{\\max}) = 0 $, eliminate the first and last columns and rows of the full $ N \\times N $ matrix, resulting in an effective eigenvalue problem for the vector of interior points $ \\vec{\\phi}_{\\text{int}} = [\\phi_2, \\phi_3, \\ldots, \\phi_{N-1}]^T $. The resulting matrix $ \\mathbf{H} $ is an $ (N-2) \\times (N-2) $ real, symmetric, tridiagonal matrix with:\n- Main diagonal elements: $ D_j = \\frac{2}{h^2} + U(\\theta_{j+1}) $ for $ j = 1, \\ldots, N-2 $.\n- Off-diagonal elements: $ E_j = -\\frac{1}{h^2} $ for $ j = 1, \\ldots, N-3 $.\n\n**2. Numerical Eigenvalue Solution**\n\nThe problem of finding the eigenvalues and eigenvectors of a symmetric tridiagonal matrix is a classic and efficiently solvable problem in numerical linear algebra. We are interested only in the algebraically smallest eigenvalue $ \\mu_{\\min} $ and its associated eigenvector. For this purpose, specialized algorithms are far more efficient than general-purpose eigensolvers. The `scipy.linalg.eigh_tridiagonal` function is perfectly suited for this task, as it is optimized for symmetric tridiagonal matrices and can be instructed to compute only a specific subset of eigenpairs. We will request the eigenpair corresponding to the lowest index ($0$), which for a symmetric matrix corresponds to the smallest eigenvalue.\n\n**3. Calculation of the Mode Width**\n\nOnce the eigenvector $ \\vec{\\phi}_{\\text{int}} $ corresponding to $ \\mu_{\\min} $ is found, it is padded with zeros at both ends to reconstruct the full discrete eigenfunction $ \\vec{\\phi} $ on the grid $ \\{\\theta_i\\}_{i=1}^N $. This satisfies the boundary conditions $ \\phi_1 = \\phi_N = 0 $.\n\nThe second-moment width $ w $ is defined by the integrals:\n$$\nw = \\sqrt{ \\frac{ \\int_{-\\theta_{\\max}}^{\\theta_{\\max}} \\theta^2 \\, |\\phi(\\theta)|^2 \\, d\\theta }{ \\int_{-\\theta_{\\max}}^{\\theta_{\\max}} |\\phi(\\theta)|^2 \\, d\\theta } }\n$$\nThese integrals are approximated by numerical summation over the grid points. For a uniform grid, the integral $ \\int f(\\theta) d\\theta $ is approximated by $ \\sum_i f(\\theta_i) h $. Applying this to the definition of $ w^2 $:\n$$\nw^2 \\approx \\frac{ \\sum_{i=1}^{N} \\theta_i^2 |\\phi_i|^2 h }{ \\sum_{i=1}^{N} |\\phi_i|^2 h } = \\frac{ \\sum_{i=1}^{N} \\theta_i^2 |\\phi_i|^2 }{ \\sum_{i=1}^{N} |\\phi_i|^2 }\n$$\nThe grid spacing $ h $ cancels out. The calculation thus involves computing two weighted sums over the grid using the computed discrete eigenfunction $ \\vec{\\phi} $.\n\n**4. Algorithmic Implementation Steps**\n\nThe overall algorithm proceeds as follows for each test case:\n1.  Define the numerical parameters: $ \\theta_{\\max} = 3\\pi $, $ N = 2001 $.\n2.  Set up the uniform grid $ \\theta_i $ for $ i=1, \\ldots, N $ and calculate the grid spacing $ h $.\n3.  Extract the physical parameters $ (k_y, \\hat{s}, \\alpha, s_{\\mathrm{rev}}, \\theta_0, \\Delta, A_{\\mathrm{curv}}, A_{\\mathrm{hel}}, N_{\\mathrm{hel}}) $.\n4.  Construct the potential $ U(\\theta_i) $ for the interior grid points $ i = 2, \\ldots, N-1 $. This involves first calculating $ s_{\\mathrm{eff}}(\\theta_i) $ and $ \\omega_D(\\theta_i) $.\n5.  Form the main diagonal and the off-diagonal of the $ (N-2) \\times (N-2) $ tridiagonal matrix $ \\mathbf{H} $.\n6.  Use `scipy.linalg.eigh_tridiagonal` to compute the lowest eigenvalue $ \\mu_{\\min} $ and its eigenvector $ \\vec{\\phi}_{\\text{int}} $.\n7.  Construct the full eigenvector $ \\vec{\\phi} $ of length $ N $ by padding $ \\vec{\\phi}_{\\text{int}} $ with zeros.\n8.  Compute the sums $ \\sum \\theta_i^2 |\\phi_i|^2 $ and $ \\sum |\\phi_i|^2 $ over all grid points.\n9.  Calculate $ w $ using the ratio of these sums.\n10. Round $ \\mu_{\\min} $ and $ w $ to six decimal places.\n11. Collate the results for all test cases and format them into the specified output string.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef solve():\n    \"\"\"\n    Solves the 1D ballooning eigenvalue problem for ITG modes and calculates\n    the minimum eigenvalue and mode width for a given set of test cases.\n    \"\"\"\n    \n    # Numerical specifications\n    theta_max = 3.0 * np.pi\n    N = 2001\n\n    # Test suite parameter sets (ky, s_hat, alpha, s_rev, theta_0, delta, A_curv, A_hel, N_hel)\n    test_cases = [\n        (0.35, 1.0, 0.6, 0.0, 0.0, 0.7, 0.45, 0.0, 0),  # 1. Tokamak baseline\n        (0.35, 0.8, 0.5, -1.2, 0.0, 0.6, 0.45, 0.0, 0),  # 2. Tokamak with local shear reversal\n        (0.30, 0.8, 0.4, -0.5, 1.2, 0.8, 0.30, 0.25, 3),  # 3. Stellarator-like case\n        (0.35, 0.5, 1.2, 0.0, 0.0, 0.6, 0.35, 0.0, 0)   # 4. High ballooning parameter case\n    ]\n\n    results = []\n\n    # Set up the spatial grid\n    theta = np.linspace(-theta_max, theta_max, N)\n    h = theta[1] - theta[0]\n\n    # The eigenvalue problem is solved on the interior points\n    theta_interior = theta[1:-1]\n    num_interior_points = N - 2\n\n    for params in test_cases:\n        ky, s_hat, alpha, s_rev, theta_0, delta, A_curv, A_hel, N_hel = params\n\n        # 1. Construct the potential U(theta) on the interior grid\n        \n        # Effective magnetic shear\n        s_eff = s_hat + s_rev * np.exp(-((theta_interior - theta_0)**2) / delta**2)\n        \n        # Curvature drift drive\n        omega_D = A_curv * np.cos(theta_interior) + A_hel * np.cos(N_hel * theta_interior)\n        \n        # Total effective potential\n        U = ky**2 * (1.0 + (s_eff * theta_interior - alpha * np.sin(theta_interior))**2) - omega_D\n\n        # 2. Construct the tridiagonal matrix representation of the operator H\n        \n        # Main diagonal\n        main_diag = (2.0 / h**2) + U\n        \n        # Off-diagonal (constant value)\n        off_diag = np.full(num_interior_points - 1, -1.0 / h**2)\n        \n        # 3. Solve the eigenvalue problem for the lowest eigenvalue and eigenvector\n        \n        # We need only the eigenvalue at index 0 (the smallest one).\n        eigenvalues, eigenvectors = eigh_tridiagonal(\n            main_diag, \n            off_diag, \n            select='i', \n            select_range=(0, 0)\n        )\n        \n        mu_min = eigenvalues[0]\n        \n        # The eigenvector for the interior points\n        phi_interior = eigenvectors[:, 0]\n\n        # 4. Reconstruct the full eigenfunction and calculate its width\n        \n        # Create full eigenfunction vector, padding with zeros for Dirichlet BCs\n        phi = np.zeros(N)\n        phi[1:-1] = phi_interior\n        \n        # Normalize the eigenfunction on the grid (optional, as it cancels in w calculation)\n        # norm_const = np.sqrt(np.sum(phi**2) * h)\n        # phi /= norm_const\n        \n        # Calculate the second-moment width w\n        phi_sq = phi**2\n        norm_denominator = np.sum(phi_sq)\n        \n        # Avoid division by zero if the eigenfunction is numerically zero\n        if norm_denominator  1e-16:\n            w = 0.0\n        else:\n            width_numerator = np.sum(theta**2 * phi_sq)\n            w = np.sqrt(width_numerator / norm_denominator)\n\n        # 5. Store the rounded results\n        results.append(round(mu_min, 6))\n        results.append(round(w, 6))\n\n    # Print the final results in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Unlike axisymmetric tokamaks, the intrinsically three-dimensional magnetic fields of a stellarator give rise to distinct neoclassical transport properties that depend sensitively on the radial electric field, $E_r$. This field is not an external parameter but is self-consistently established by the plasma itself through the principle of ambipolarity, which demands that ion and electron radial fluxes balance perfectly. In this advanced practice , you will implement a neoclassical model to compute this ambipolar $E_r$, a crucial element for understanding and optimizing the confinement performance of stellarators.",
            "id": "4194799",
            "problem": "You are to construct and implement a principled ambipolar electric field determination model for a stellarator by equating ion and electron neoclassical radial particle fluxes and then compute the ambipolar radial electric field profile $E_r(\\psi)$ at selected flux-surface radii. The derivation must start from first principles and well-tested facts, and the program must compute numerical results for a specified test suite using the provided parameters.\n\nThe starting point is ambipolarity (quasineutrality of radial particle transport), which requires the equality of electron and ion radial particle fluxes, written as $\\Gamma_e = \\Gamma_i$. Assume a linear neoclassical transport closure at each flux surface in which the radial particle flux for species $s \\in \\{e,i\\}$ is modeled as\n$$\n\\Gamma_s = - n \\, D_s \\left( \\frac{d \\ln n}{dr} + \\alpha_s \\frac{d \\ln T_s}{dr} + \\beta_s \\frac{Z_s e E_r}{T_s} \\right),\n$$\nwhere $n$ is the density, $D_s$ is the neoclassical transport coefficient with units of $\\mathrm{m^2/s}$, $T_s$ is the temperature, $Z_s$ is the charge state ($Z_e = -1$, $Z_i = +1$), $e$ is the elementary charge, and $r$ is the minor-radius-like coordinate labeling flux surfaces. The coefficients $\\alpha_s$ and $\\beta_s$ are dimensionless thermodynamic force coefficients of order unity characterizing neoclassical cross-coupling.\n\nAdopt a composite, regime-bridging model for $D_s$ that smoothly combines the $1/\\nu$ regime (low collisionality), the $\\sqrt{\\nu}$ regime (intermediate collisionality), and the Pfirsch–Schlüter (high collisionality) regime, expressed as\n$$\nD_s = C_{1s} \\, \\epsilon_{\\mathrm{eff}}^{3/2} \\, \\frac{v_{\\mathrm{th},s}^2}{\\nu_s R^2} \\, \\rho_s^2 \\;+\\; C_{2s} \\, \\epsilon_{\\mathrm{eff}}^{1/2} \\, \\frac{v_{\\mathrm{th},s} \\, \\rho_s^2}{R} \\, \\sqrt{\\frac{\\nu_s}{\\Omega_{c,s}}} \\;+\\; C_{3s} \\, \\nu_s \\, \\rho_s^2,\n$$\nwhere $\\epsilon_{\\mathrm{eff}}$ is the effective ripple, $R$ is the major radius, $v_{\\mathrm{th},s} = \\sqrt{2 T_s / m_s}$ is the thermal speed, $\\rho_s = v_{\\mathrm{th},s} / \\Omega_{c,s}$ is the gyroradius, $\\Omega_{c,s} = Z_s e B / m_s$ is the cyclotron frequency, $B$ is the magnetic field, and $\\nu_s$ is the species self-collision (or electron-ion for electrons) frequency. All quantities are to be treated in the International System of Units (SI), with temperatures converted from electron-volts to joules via multiplication by $e$ where needed.\n\nUse the following well-tested approximate formulas for Coulomb collision frequencies from the National Research Laboratory (NRL) Plasma Formulary (valid for singly charged ions, $Z_i = 1$), with density in $\\mathrm{cm^{-3}}$ and temperature in $\\mathrm{eV}$:\n- Electron–ion collision frequency:\n$$\n\\nu_{ei} \\;[\\mathrm{s^{-1}}] = 2.91 \\times 10^{-6} \\; n_e \\;[\\mathrm{cm^{-3}}] \\; \\ln\\Lambda \\; \\left(T_e \\;[\\mathrm{eV}]\\right)^{-3/2}.\n$$\n- Ion–ion collision frequency (for hydrogen):\n$$\n\\nu_{ii} \\;[\\mathrm{s^{-1}}] = 4.80 \\times 10^{-8} \\; n_i \\;[\\mathrm{cm^{-3}}] \\; \\ln\\Lambda \\; \\left(T_i \\;[\\mathrm{eV}]\\right)^{-3/2}.\n$$\n\nAssume singly charged, quasineutral plasma with $n_e \\approx n_i \\equiv n$. The ambipolarity condition $\\Gamma_e = \\Gamma_i$ together with the closure above implies a scalar equation for $E_r$ at each radius. You must solve for $E_r$ explicitly and implement a program to evaluate it for the specified profiles.\n\nAdopt the following parameter values, all constants in SI unless explicitly stated:\n- Geometry and magnetic configuration:\n  - Major radius $R = 1.5 \\,\\mathrm{m}$,\n  - Minor radius $a = 0.5 \\,\\mathrm{m}$,\n  - Magnetic field $B = 2.7 \\,\\mathrm{T}$,\n  - Effective ripple $\\epsilon_{\\mathrm{eff}} = 0.01$.\n- Coulomb logarithm: $\\ln\\Lambda = 17$ (dimensionless).\n- Species and constants:\n  - Elementary charge $e = 1.602176634 \\times 10^{-19} \\,\\mathrm{C}$,\n  - Electron mass $m_e = 9.10938356 \\times 10^{-31} \\,\\mathrm{kg}$,\n  - Proton mass $m_i = 1.6726219 \\times 10^{-27} \\,\\mathrm{kg}$,\n  - Ion charge state $Z_i = +1$, electron charge state $Z_e = -1$.\n- Profile model as functions of $r$:\n  - Density in $\\mathrm{m^{-3}}$:\n    $$\n    n(r) = n_{\\mathrm{edge}} + \\left(n_0 - n_{\\mathrm{edge}}\\right)\\left(1 - \\left(\\frac{r}{a}\\right)^2\\right),\n    $$\n    with $n_0 = 1.2 \\times 10^{20}$ and $n_{\\mathrm{edge}} = 2.0 \\times 10^{19}$.\n  - Electron temperature in $\\mathrm{eV}$:\n    $$\n    T_e(r) = T_{e,\\mathrm{edge}} + \\left(T_{e0} - T_{e,\\mathrm{edge}}\\right)\\left(1 - \\left(\\frac{r}{a}\\right)^2\\right),\n    $$\n    with $T_{e0} = 2000$ and $T_{e,\\mathrm{edge}} = 100$.\n  - Ion temperature in $\\mathrm{eV}$:\n    $$\n    T_i(r) = T_{i,\\mathrm{edge}} + \\left(T_{i0} - T_{i,\\mathrm{edge}}\\right)\\left(1 - \\left(\\frac{r}{a}\\right)^2\\right),\n    $$\n    with $T_{i0} = 1500$ and $T_{i,\\mathrm{edge}} = 100$.\n- Neoclassical coefficients:\n  - $\\alpha_e = 0.71$, $\\beta_e = 1.0$,\n  - $\\alpha_i = 0.50$, $\\beta_i = 1.0$,\n  - $C_{1e} = 0.66$, $C_{2e} = 0.40$, $C_{3e} = 0.30$,\n  - $C_{1i} = 0.66$, $C_{2i} = 0.50$, $C_{3i} = 0.30$.\n\nDerivation and computation details to be implemented:\n- Compute $d \\ln n / dr$ and $d \\ln T_s / dr$ analytically from the profiles using the chain rule. The natural logarithm derivatives are $d \\ln n / dr = \\left(1/n\\right) \\, dn/dr$ and $d \\ln T_s / dr = \\left(1/T_s\\right) \\, dT_s/dr$. Note that $T_s$ in these logarithmic gradients may be consistently treated in $\\mathrm{eV}$ because the ratio is dimensionless; however, wherever $T_s$ appears multiplying or dividing an energy in the ambipolar electric field formula, convert to joules via $T_s[\\mathrm{J}] = e \\, T_s[\\mathrm{eV}]$.\n- Convert density to $\\mathrm{cm^{-3}}$ for evaluating $\\nu_{ei}$ and $\\nu_{ii}$ in the provided NRL formulas, then use those $\\mathrm{s^{-1}}$ values directly in SI expressions for $D_s$.\n- Compute $v_{\\mathrm{th},s}$, $\\Omega_{c,s}$, and $\\rho_s$ in SI.\n- Assemble $D_s$ and then enforce $\\Gamma_e = \\Gamma_i$ to determine $E_r$.\n\nYou must implement a program that evaluates $E_r$ at a selected set of radii with the above inputs. Express the final electric field in $\\mathrm{V/m}$. For numerical output, round each $E_r$ to the nearest integer before printing.\n\nTest suite:\n- Radii in meters for which to compute $E_r$:\n  - Case $1$: $r = 0.05$,\n  - Case $2$: $r = 0.25$,\n  - Case $3$: $r = 0.49$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test suite radii, for example, $\\left[\\mathrm{result}_1,\\mathrm{result}_2,\\mathrm{result}_3\\right]$, with each entry an integer representing $\\mathrm{V/m}$, and no spaces anywhere in the output line.",
            "solution": "The problem posed is to determine the ambipolar radial electric field, $E_r(r)$, in a stellarator plasma. This is a standard problem in neoclassical transport theory, which is scientifically well-grounded and computationally tractable. All required physical models, parameters, and boundary conditions are provided, and they are consistent and physically realistic. The problem is well-posed, leading to a unique solution for $E_r$ at each specified radius. Therefore, the problem is deemed valid and a full solution follows.\n\nThe fundamental principle is ambipolarity, which enforces quasineutrality in radial particle transport by requiring the total charge flux to be zero. For a simple plasma composed of electrons (species $s=e$) and a single ion species (species $s=i$), this condition simplifies to the equality of the radial particle fluxes:\n$$\n\\Gamma_e = \\Gamma_i\n$$\nThe problem provides a linear neoclassical closure relating the particle flux of species $s$ to the thermodynamic forces (gradients of density and temperature) and the radial electric field:\n$$\n\\Gamma_s = - n \\, D_s \\left( \\frac{d \\ln n}{dr} + \\alpha_s \\frac{d \\ln T_s}{dr} + \\beta_s \\frac{Z_s e E_r}{T_s} \\right)\n$$\nHere, $n$ is the plasma density, $D_s$ is the neoclassical diffusion coefficient, $\\alpha_s$ and $\\beta_s$ are dimensionless coefficients, $T_s$ is the species temperature in energy units (Joules), $Z_s$ is the charge state number ($Z_e = -1$, $Z_i = +1$), $e$ is the elementary charge, and $E_r$ is the radial electric field.\n\n**Step 1: Derivation of the Ambipolar Radial Electric Field**\n\nWe begin by equating the electron and ion fluxes as per the ambipolarity condition:\n$$\n- n D_e \\left( \\frac{d \\ln n}{dr} + \\alpha_e \\frac{d \\ln T_e}{dr} + \\beta_e \\frac{Z_e e E_r}{T_e} \\right) = - n D_i \\left( \\frac{d \\ln n}{dr} + \\alpha_i \\frac{d \\ln T_i}{dr} + \\beta_i \\frac{Z_i e E_r}{T_i} \\right)\n$$\nThe common factor of $-n$ on both sides can be canceled, assuming a non-zero density $n > 0$. We then substitute the charge numbers $Z_e = -1$ and $Z_i = +1$:\n$$\nD_e \\left( \\frac{d \\ln n}{dr} + \\alpha_e \\frac{d \\ln T_e}{dr} - \\frac{\\beta_e e E_r}{T_e} \\right) = D_i \\left( \\frac{d \\ln n}{dr} + \\alpha_i \\frac{d \\ln T_i}{dr} + \\frac{\\beta_i e E_r}{T_i} \\right)\n$$\nTo solve for $E_r$, we rearrange the equation by grouping terms containing $E_r$ on one side and all other terms on the other side:\n$$\nD_e \\left( \\frac{d \\ln n}{dr} + \\alpha_e \\frac{d \\ln T_e}{dr} \\right) - D_i \\left( \\fracd \\ln n}{dr} + \\alpha_i \\frac{d \\ln T_i}{dr} \\right) = \\frac{D_e \\beta_e e E_r}{T_e} + \\frac{D_i \\beta_i e E_r}{T_i}\n$$\nFactoring out the common terms $E_r$ and $e$ on the right-hand side yields:\n$$\nD_e \\left( \\frac{d \\ln n}{dr} + \\alpha_e \\frac{d \\ln T_e}{dr} \\right) - D_i \\left( \\frac{d \\ln n}{dr} + \\alpha_i \\frac{d \\ln T_i}{dr} \\right) = e E_r \\left( \\frac{D_e \\beta_e}{T_e} + \\frac{D_i \\beta_i}{T_i} \\right)\n$$\nFinally, isolating $E_r$ gives the explicit expression for the ambipolar radial electric field. It is critical that the temperatures $T_e$ and $T_i$ in the denominator are expressed in Joules to ensure dimensional consistency, as they are divided into the energy unit $e E_r$.\n$$\nE_r(r) = \\frac{D_e \\left( \\frac{d \\ln n}{dr} + \\alpha_e \\frac{d \\ln T_e}{dr} \\right) - D_i \\left( \\frac{d \\ln n}{dr} + \\alpha_i \\frac{d \\ln T_i}{dr} \\right)}{e \\left( \\frac{D_e \\beta_e}{T_e[\\mathrm{J}]} + \\frac{D_i \\beta_i}{T_i[\\mathrm{J}]} \\right)}\n$$\nThis equation is the core of our numerical model.\n\n**Step 2: Calculation of Profile Gradients**\n\nThe problem specifies parabolic-like profiles for density $n(r)$ and temperatures $T_s(r)$. Let a generic profile be denoted by $f(r)$:\n$$\nf(r) = f_{\\mathrm{edge}} + (f_0 - f_{\\mathrm{edge}}) \\left(1 - \\left(\\frac{r}{a}\\right)^2\\right)\n$$\nwhere $f_0$ is the value at the magnetic axis ($r=0$) and $f_{\\mathrm{edge}}$ is the value at the plasma edge ($r=a$). The radial derivative is:\n$$\n\\frac{df}{dr} = (f_0 - f_{\\mathrm{edge}}) \\left( -\\frac{2r}{a^2} \\right) = - \\frac{2r(f_0 - f_{\\mathrm{edge}})}{a^2}\n$$\nThe logarithmic radial gradient, which appears in the force terms, is then:\n$$\n\\frac{d \\ln f}{dr} = \\frac{1}{f(r)} \\frac{df}{dr} = \\frac{-2r(f_0 - f_{\\mathrm{edge}})}{a^2 \\left[ f_{\\mathrm{edge}} + (f_0 - f_{\\mathrm{edge}}) \\left(1 - \\left(\\frac{r}{a}\\right)^2\\right) \\right]}\n$$\nThis formula is applied to $n(r)$, $T_e(r)$, and $T_i(r)$ using their respective central and edge values. For the temperature gradients, the units of $T_s$ cancel, so they can be consistently computed in electron-volts ($\\mathrm{eV}$).\n\n**Step 3: Calculation of Neoclassical Diffusion Coefficients**\n\nThe composite diffusion coefficient $D_s$ is the sum of three terms corresponding to different collisionality regimes:\n$$\nD_s = C_{1s} \\epsilon_{\\mathrm{eff}}^{3/2} \\frac{v_{\\mathrm{th},s}^2}{\\nu_s R^2} \\rho_s^2 \\;+\\; C_{2s} \\epsilon_{\\mathrm{eff}}^{1/2} \\frac{v_{\\mathrm{th},s} \\rho_s^2}{R} \\sqrt{\\frac{\\nu_s}{\\Omega_{c,s}}} \\;+\\; C_{3s} \\nu_s \\rho_s^2\n$$\nTo compute $D_s$ for each species at a given radius $r$, we must first calculate several intermediate quantities in SI units.\n\n- **Collision Frequencies ($\\nu_s$)**: The NRL formulas are given with density in $\\mathrm{cm^{-3}}$ and temperature in $\\mathrm{eV}$. We must convert the density $n(r) [\\mathrm{m^{-3}}]$ to $n(r) [\\mathrm{cm^{-3}}] = n(r) [\\mathrm{m^{-3}}] \\times 10^{-6}$. For electrons, we use $\\nu_e = \\nu_{ei}$, and for ions, $\\nu_i = \\nu_{ii}$.\n$$\n\\nu_{ei} [\\mathrm{s^{-1}}] = 2.91 \\times 10^{-6} \\, n_e[\\mathrm{cm^{-3}}] \\, \\ln\\Lambda \\, (T_e[\\mathrm{eV}])^{-3/2}\n$$\n$$\n\\nu_{ii} [\\mathrm{s^{-1}}] = 4.80 \\times 10^{-8} \\, n_i[\\mathrm{cm^{-3}}] \\, \\ln\\Lambda \\, (T_i[\\mathrm{eV}])^{-3/2}\n$$\n\n- **Cyclotron Frequency ($\\Omega_{c,s}$)**: The problem states $\\Omega_{c,s} = Z_s e B / m_s$. However, the term $\\sqrt{\\nu_s/\\Omega_{c,s}}$ in the expression for $D_s$ requires $\\Omega_{c,s}$ to be positive to yield a real-valued diffusion coefficient, which is physically necessary. Using the signed charge $Z_e = -1$ would result in a complex $D_e$. Therefore, we must use the standard definition of cyclotron frequency as a positive angular frequency, $\\Omega_{c,s} = |Z_s| e B / m_s$.\n\n- **Thermal Speed ($v_{\\mathrm{th},s}$)**: This requires temperature in Joules, $T_s[\\mathrm{J}] = T_s[\\mathrm{eV}] \\times e$.\n$$\nv_{\\mathrm{th},s} = \\sqrt{\\frac{2 T_s[\\mathrm{J}]}{m_s}}\n$$\n\n- **Gyroradius ($\\rho_s$)**:\n$$\n\\rho_s = \\frac{v_{\\mathrm{th},s}}{\\Omega_{c,s}}\n$$\n\nWith these components calculated, the three terms of $D_s$ can be assembled and summed to find the total diffusion coefficient for each species.\n\n**Step 4: Numerical Implementation**\n\nThe final step is to implement the above sequence of calculations in a program. For each radius $r$ in the test suite:\n1.  Calculate $n(r)$, $T_e(r)$, and $T_i(r)$ from their profile functions.\n2.  Calculate the logarithmic gradients $\\frac{d \\ln n}{dr}$, $\\frac{d \\ln T_e}{dr}$, and $\\frac{d \\ln T_i}{dr}$.\n3.  For each species $s \\in \\{e, i\\}$:\n    a. Convert units for temperature ($T_s[\\mathrm{eV}] \\to T_s[\\mathrm{J}]$) and density ($n[\\mathrm{m^{-3}}] \\to n[\\mathrm{cm^{-3}}]$).\n    b. Calculate the collision frequency $\\nu_s$.\n    c. Calculate the cyclotron frequency $\\Omega_{c,s}$, thermal speed $v_{\\mathrm{th},s}$, and gyroradius $\\rho_s$.\n    d. Assemble the three components of $D_s$ and sum them.\n4.  Substitute the computed values of $D_e$, $D_i$, the logarithmic gradients, and temperatures in Joules into the derived expression for $E_r(r)$.\n5.  The resulting value of $E_r$ will be in SI units of Volts per meter ($\\mathrm{V/m}$).\n6.  Round the final value to the nearest integer as required for output.\n\nThis procedure provides a complete, step-by-step method for solving the problem as stated.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the ambipolar radial electric field profile in a stellarator\n    based on neoclassical transport theory.\n    \"\"\"\n\n    # --- Given Constants and Parameters (in SI units unless specified) --- #\n\n    # Geometry and magnetic configuration\n    R = 1.5  # Major radius [m]\n    a = 0.5  # Minor radius [m]\n    B = 2.7  # Magnetic field [T]\n    epsilon_eff = 0.01  # Effective ripple [dimensionless]\n\n    # Coulomb logarithm\n    ln_Lambda = 17.0  # [dimensionless]\n\n    # Fundamental constants\n    e = 1.602176634e-19  # Elementary charge [C]\n    m_e = 9.10938356e-31  # Electron mass [kg]\n    m_i = 1.6726219e-27  # Proton mass [kg]\n\n    # Species charge states\n    Z_e = -1.0\n    Z_i = 1.0\n\n    # Profile parameters\n    n0 = 1.2e20  # Central density [m^-3]\n    n_edge = 2.0e19  # Edge density [m^-3]\n    Te0 = 2000.0  # Central electron temperature [eV]\n    Te_edge = 100.0  # Edge electron temperature [eV]\n    Ti0 = 1500.0  # Central ion temperature [eV]\n    Ti_edge = 100.0  # Edge ion temperature [eV]\n\n    # Neoclassical coefficients\n    alpha_e = 0.71\n    beta_e = 1.0\n    alpha_i = 0.50\n    beta_i = 1.0\n    C1e = 0.66\n    C2e = 0.40\n    C3e = 0.30\n    C1i = 0.66\n    C2i = 0.50\n    C3i = 0.30\n\n    # --- Profile Functions and Their Derivatives --- #\n\n    def profile(r, f0, f_edge):\n        \"\"\"Generic profile function.\"\"\"\n        return f_edge + (f0 - f_edge) * (1 - (r / a)**2)\n\n    def d_ln_f_dr(r, f_val, f0, f_edge):\n        \"\"\"Logarithmic derivative of the generic profile.\"\"\"\n        if r == 0:\n            return 0.0\n        df_dr = -2 * r * (f0 - f_edge) / a**2\n        return (1 / f_val) * df_dr\n\n    # Test suite of radii\n    test_cases = [0.05, 0.25, 0.49]\n    results = []\n\n    for r in test_cases:\n        # --- Calculate Local Plasma Parameters at radius r --- #\n        n_r = profile(r, n0, n_edge)  # Density [m^-3]\n        Te_r_eV = profile(r, Te0, Te_edge)  # Electron temperature [eV]\n        Ti_r_eV = profile(r, Ti0, Ti_edge)  # Ion temperature [eV]\n\n        # Convert to units required for formulas\n        n_r_cm3 = n_r * 1e-6  # Density [cm^-3]\n        Te_r_J = Te_r_eV * e  # Electron temperature [J]\n        Ti_r_J = Ti_r_eV * e  # Ion temperature [J]\n\n        # --- Calculate Logarithmic Gradients --- #\n        dlnn_dr = d_ln_f_dr(r, n_r, n0, n_edge)\n        dlnTe_dr = d_ln_f_dr(r, Te_r_eV, Te0, Te_edge)\n        dlnTi_dr = d_ln_f_dr(r, Ti_r_eV, Ti0, Ti_edge)\n\n        # --- Calculate Quantities for Electrons (s=e) --- #\n        # Collision frequency (nu_ei)\n        nu_e = 2.91e-6 * n_r_cm3 * ln_Lambda * Te_r_eV**(-1.5)  # [s^-1]\n        \n        # Cyclotron frequency (absolute value for real D_s)\n        Omega_ce = abs(Z_e) * e * B / m_e  # [rad/s]\n        \n        # Thermal speed\n        v_th_e = np.sqrt(2 * Te_r_J / m_e)  # [m/s]\n        \n        # Gyroradius\n        rho_e = v_th_e / Omega_ce  # [m]\n        \n        # Diffusion coefficient D_e\n        D_e_term1 = C1e * epsilon_eff**(1.5) * (v_th_e**2 / (nu_e * R**2)) * rho_e**2\n        D_e_term2 = C2e * epsilon_eff**(0.5) * (v_th_e * rho_e**2 / R) * np.sqrt(nu_e / Omega_ce)\n        D_e_term3 = C3e * nu_e * rho_e**2\n        D_e = D_e_term1 + D_e_term2 + D_e_term3\n\n        # --- Calculate Quantities for Ions (s=i) --- #\n        # Collision frequency (nu_ii)\n        nu_i = 4.80e-8 * n_r_cm3 * ln_Lambda * Ti_r_eV**(-1.5)  # [s^-1]\n\n        # Cyclotron frequency\n        Omega_ci = abs(Z_i) * e * B / m_i  # [rad/s]\n        \n        # Thermal speed\n        v_th_i = np.sqrt(2 * Ti_r_J / m_i)  # [m/s]\n        \n        # Gyroradius\n        rho_i = v_th_i / Omega_ci  # [m]\n        \n        # Diffusion coefficient D_i\n        D_i_term1 = C1i * epsilon_eff**(1.5) * (v_th_i**2 / (nu_i * R**2)) * rho_i**2\n        D_i_term2 = C2i * epsilon_eff**(0.5) * (v_th_i * rho_i**2 / R) * np.sqrt(nu_i / Omega_ci)\n        D_i_term3 = C3i * nu_i * rho_i**2\n        D_i = D_i_term1 + D_i_term2 + D_i_term3\n\n        # --- Calculate Ambipolar Radial Electric Field E_r --- #\n        numerator = D_e * (dlnn_dr + alpha_e * dlnTe_dr) - D_i * (dlnn_dr + alpha_i * dlnTi_dr)\n        denominator = e * ((D_e * beta_e / Te_r_J) + (D_i * beta_i / Ti_r_J))\n        \n        Er = numerator / denominator  # [V/m]\n        \n        # Round to nearest integer and store result\n        results.append(int(round(Er)))\n    \n    # Print results in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}