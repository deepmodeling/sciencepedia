{
    "hands_on_practices": [
        {
            "introduction": "To build a robust understanding of magnetohydrodynamic (MHD) equilibria, we begin by examining the behavior of the plasma at its very core: the magnetic axis. This exercise  demonstrates a powerful analytical technique, the near-axis expansion, to probe the local structure of the equilibrium. By applying the Grad-Shafranov equation at the magnetic axis, you will derive a fundamental constraint that connects the local curvature of the poloidal flux surfaces to the gradients of plasma pressure and the toroidal magnetic field, revealing the intimate link between geometry and physics at the heart of a tokamak.",
            "id": "4196413",
            "problem": "Consider an axisymmetric ideal magnetohydrodynamic (MHD) equilibrium in a toroidal device, with cylindrical coordinates $(R,\\phi,Z)$ and magnetic axis at $(R_0,0)$. Let the poloidal magnetic flux function be $\\psi(R,Z)$, and assume a near-axis expansion of the form\n$$\n\\psi(R,Z)=\\psi_0+\\frac{1}{2}a\\,(R-R_0)^2+\\frac{1}{2}b\\,Z^2,\n$$\nwhere $\\psi_0=\\psi(R_0,0)$ and $a$ and $b$ are constants representing the local curvature of $\\psi$ in the radial and vertical directions near the axis. Assume that the equilibrium pressure and toroidal field function are flux functions satisfying $p=p(\\psi)$ and $F=F(\\psi)$, where $F(\\psi)=R B_{\\phi}$, and admit near-axis expansions\n$$\np(\\psi)=p_{\\mathrm{axis}}+\\alpha\\,(\\psi-\\psi_0)+\\mathcal{O}((\\psi-\\psi_0)^2),\\qquad F(\\psi)=F_0+\\gamma\\,(\\psi-\\psi_0)+\\mathcal{O}((\\psi-\\psi_0)^2),\n$$\nwith constants $\\alpha=\\left.\\dfrac{dp}{d\\psi}\\right|_{\\psi_0}$, $F_0=F(\\psi_0)$, and $\\gamma=\\left.\\dfrac{dF}{d\\psi}\\right|_{\\psi_0}$. Starting from the axisymmetric ideal MHD equilibrium and the Grad–Shafranov equation, derive the leading-order constraint on the combination $a+b$ implied by the near-axis expansion. Express your final answer as a single closed-form analytic expression in terms of $\\mu_0$, $R_0$, $\\alpha$, $F_0$, and $\\gamma$. No numerical evaluation or rounding is required, and no units should be included in the final expression.",
            "solution": "The problem requires the derivation of a constraint on the parameters of a near-axis expansion of the poloidal magnetic flux function, $\\psi$, in an axisymmetric ideal Magnetohydrodynamic (MHD) equilibrium. The starting point is the Grad-Shafranov equation, which governs such equilibria.\n\nThe Grad-Shafranov equation is given by:\n$$\n\\Delta^* \\psi = - \\mu_0 R^2 \\frac{dp}{d\\psi} - F \\frac{dF}{d\\psi}\n$$\nwhere $\\psi$ is the poloidal magnetic flux, $p(\\psi)$ is the plasma pressure, $F(\\psi) = R B_{\\phi}$ is the toroidal field function, and $\\mu_0$ is the vacuum permeability. The coordinates are cylindrical $(R,\\phi,Z)$. The Grad-Shafranov operator, $\\Delta^*$, is defined as:\n$$\n\\Delta^* \\psi \\equiv R \\frac{\\partial}{\\partial R} \\left(\\frac{1}{R} \\frac{\\partial \\psi}{\\partial R}\\right) + \\frac{\\partial^2 \\psi}{\\partial Z^2}\n$$\nExpanding the first term, the operator can be written as:\n$$\n\\Delta^* \\psi = \\frac{\\partial^2 \\psi}{\\partial R^2} - \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} + \\frac{\\partial^2 \\psi}{\\partial Z^2}\n$$\nThe problem specifies that the magnetic axis is located at $(R,Z)=(R_0,0)$. We will evaluate the Grad-Shafranov equation at this point. To do this, we need to compute the terms on both the left-hand side (LHS) and right-hand side (RHS) at the magnetic axis using the provided near-axis expansions.\n\nFirst, let's analyze the LHS of the equation. We are given the near-axis expansion for $\\psi(R,Z)$:\n$$\n\\psi(R,Z) = \\psi_0 + \\frac{1}{2}a(R-R_0)^2 + \\frac{1}{2}b Z^2\n$$\nWe compute the necessary partial derivatives of $\\psi$:\n$$\n\\frac{\\partial \\psi}{\\partial R} = a(R-R_0)\n$$\n$$\n\\frac{\\partial^2 \\psi}{\\partial R^2} = a\n$$\n$$\n\\frac{\\partial \\psi}{\\partial Z} = bZ\n$$\n$$\n\\frac{\\partial^2 \\psi}{\\partial Z^2} = b\n$$\nNote that the condition for a magnetic axis, $\\nabla \\psi = 0$, is satisfied at $(R,Z)=(R_0,0)$, since $\\left.\\frac{\\partial \\psi}{\\partial R}\\right|_{(R_0,0)} = a(R_0-R_0) = 0$ and $\\left.\\frac{\\partial \\psi}{\\partial Z}\\right|_{(R_0,0)} = b(0) = 0$.\n\nNow, we evaluate each term of the $\\Delta^*$ operator at the magnetic axis $(R_0,0)$:\n$$\n\\left. \\frac{\\partial^2 \\psi}{\\partial R^2} \\right|_{(R_0,0)} = a\n$$\n$$\n\\left. \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} \\right|_{(R_0,0)} = \\frac{1}{R_0} \\left( a(R_0-R_0) \\right) = 0\n$$\n$$\n\\left. \\frac{\\partial^2 \\psi}{\\partial Z^2} \\right|_{(R_0,0)} = b\n$$\nSubstituting these into the expression for the LHS, we find its value at the magnetic axis:\n$$\n\\left. \\Delta^* \\psi \\right|_{(R_0,0)} = a - 0 + b = a+b\n$$\n\nNext, we evaluate the RHS of the Grad-Shafranov equation at the magnetic axis $(R_0,0)$. The RHS is:\n$$\n- \\mu_0 R^2 \\frac{dp}{d\\psi} - F \\frac{dF}{d\\psi}\n$$\nAt the magnetic axis, $R=R_0$, $Z=0$, and $\\psi = \\psi_0$. We are given the near-axis expansions for the pressure $p(\\psi)$ and the toroidal field function $F(\\psi)$:\n$$\np(\\psi) = p_{\\mathrm{axis}} + \\alpha(\\psi-\\psi_0) + \\mathcal{O}((\\psi-\\psi_0)^2)\n$$\n$$\nF(\\psi) = F_0 + \\gamma(\\psi-\\psi_0) + \\mathcal{O}((\\psi-\\psi_0)^2)\n$$\nFrom these expansions, we can find the derivatives with respect to $\\psi$:\n$$\n\\frac{dp}{d\\psi} = \\alpha + \\mathcal{O}(\\psi-\\psi_0)\n$$\n$$\n\\frac{dF}{d\\psi} = \\gamma + \\mathcal{O}(\\psi-\\psi_0)\n$$\nEvaluating these quantities at the magnetic axis, where $\\psi=\\psi_0$:\n$$\n\\left. \\frac{dp}{d\\psi} \\right|_{\\psi=\\psi_0} = \\alpha\n$$\n$$\nF(\\psi_0) = F_0\n$$\n$$\n\\left. \\frac{dF}{d\\psi} \\right|_{\\psi=\\psi_0} = \\gamma\n$$\nSubstituting these values, along with $R=R_0$, into the RHS expression:\n$$\n\\left. \\left( - \\mu_0 R^2 \\frac{dp}{d\\psi} - F \\frac{dF}{d\\psi} \\right) \\right|_{(R_0,0)} = - \\mu_0 R_0^2 \\left. \\frac{dp}{d\\psi} \\right|_{\\psi_0} - F(\\psi_0) \\left. \\frac{dF}{d\\psi} \\right|_{\\psi_0} = - \\mu_0 R_0^2 \\alpha - F_0 \\gamma\n$$\n\nFinally, we equate the LHS and RHS of the Grad-Shafranov equation evaluated at the magnetic axis:\n$$\na+b = - \\mu_0 R_0^2 \\alpha - F_0 \\gamma\n$$\nThis equation represents the leading-order constraint on the combination $a+b$ that is imposed by the MHD equilibrium condition near the magnetic axis. The parameters $a$ and $b$ describe the local curvature of the nested flux surfaces, and this expression relates this curvature to the local gradients of pressure and the toroidal field function.",
            "answer": "$$ \\boxed{- \\mu_0 R_0^2 \\alpha - F_0 \\gamma} $$"
        },
        {
            "introduction": "Having established the local constraints at the magnetic axis, we now broaden our scope to understand how the source terms in the Grad-Shafranov equation shape the global current profile across the entire plasma. This problem  uses the well-known Solov'ev equilibrium model, where the pressure and toroidal field functions are simple functions of the poloidal flux. By analyzing the resulting toroidal current density, $J_{\\phi}$, you will gain a deeper appreciation for how the interplay between the plasma pressure and magnetic field creates the characteristic poloidally asymmetric current profiles observed in tokamaks.",
            "id": "4196435",
            "problem": "Consider a static, axisymmetric magnetohydrodynamics (MHD) equilibrium in a tokamak, where the magnetic field is written in terms of a poloidal flux function $\\,\\psi(R,Z)\\,$ and the toroidal field function $\\,F(\\psi) = R B_{\\phi}\\,$. The governing equilibrium is built from $\\,\\nabla p = \\mathbf{J} \\times \\mathbf{B}\\,$ and $\\,\\nabla \\times \\mathbf{B} = \\mu_{0} \\mathbf{J}\\,$, together with $\\,\\nabla \\cdot \\mathbf{B} = 0\\,$ and axisymmetry. In such equilibria, the scalar pressure $\\,p(\\psi)\\,$ and the toroidal field function $\\,F(\\psi)\\,$ determine the source terms that drive the poloidal flux $\\,\\psi(R,Z)\\,$ via the axisymmetric force balance. The toroidal current density $\\,J_{\\phi}(R,Z)\\,$ follows from Ampère’s law and can be expressed in terms of these source functions and geometric factors.\n\nAssume a large-aspect-ratio tokamak with major radius $\\,R_{0}\\,$ and minor radius $\\,a\\,$ so that closed flux surfaces are contained within the cylindrical radius range $\\,R \\in [R_{\\min},R_{\\max}] = [R_{0}-a,\\,R_{0}+a]\\,$. Consider two Solov’ev-type parameter choices, defined by linear functions of $\\,\\psi\\,$:\n\n- Set $\\,\\mathsf{S1}\\,$: $\\,p(\\psi) = p_{0} - \\alpha \\psi\\,$ with $\\,\\alpha  0\\,$ and $\\,F(\\psi) = F_{0}\\,$ (so that $\\,F'(\\psi) = 0\\,$).\n- Set $\\,\\mathsf{S2}\\,$: $\\,p(\\psi) = p_{0} - \\alpha \\psi\\,$ with $\\,\\alpha  0\\,$ and $\\,F(\\psi) = F_{0} + \\beta \\psi\\,$ with $\\,\\beta \\neq 0\\,$ chosen such that the product $\\,F(\\psi) F'(\\psi)\\,$ is approximately constant across the plasma and equal to a positive parameter $\\,b  0\\,$.\n\nStarting from the equilibrium laws stated above (without invoking shortcut formulas), derive the dependence of the toroidal current density $\\,J_{\\phi}(R,Z)\\,$ on $\\,R\\,$ under these parameterizations and use this to assess the physical plausibility of the resulting $\\,J_{\\phi}\\,$ distributions on each closed flux surface. In particular, discuss sign-definiteness, poloidal variation between the high-field side (HFS, smaller $\\,R\\,$) and low-field side (LFS, larger $\\,R\\,$), and the possibility of counter-current regions.\n\nWhich of the following statements are correct?\n\nA. Under set $\\,\\mathsf{S1}\\,$, the toroidal current density $\\,J_{\\phi}\\,$ is a flux function (constant on each magnetic surface), leading to poloidally uniform current and a physically plausible, on-axis-peaked profile.\n\nB. Under set $\\,\\mathsf{S2}\\,$ with $\\,b  \\mu_{0} \\alpha R_{\\max}^{2}\\,$, the toroidal current density $\\,J_{\\phi}\\,$ has the same sign on both the HFS and LFS and is larger on the HFS due to the $\\,1/R\\,$ contribution, thereby avoiding counter-current regions and remaining physically plausible.\n\nC. For any Solov’ev equilibrium with constant $\\,p'(\\psi)\\,$ and approximately constant $\\,F(\\psi) F'(\\psi)\\,$, the toroidal current density $\\,J_{\\phi}\\,$ necessarily diverges at the magnetic axis, making such solutions physically implausible.\n\nD. Under set $\\,\\mathsf{S2}\\,$, if $\\,\\mu_{0} \\alpha R_{\\min}^{2}  b  \\mu_{0} \\alpha R_{\\max}^{2}\\,$, the toroidal current reverses sign between HFS and LFS on the same flux surface, which is unavoidable in Solov’ev equilibria and therefore renders them incapable of representing tokamak discharges.",
            "solution": "The problem statement is a valid exercise in magnetohydrodynamics (MHD) equilibrium theory. It is scientifically grounded in the principles of ideal MHD, is well-posed, objective, and provides all necessary information for a rigorous derivation and analysis. The parameterizations provided, known as Solov'ev-type equilibria, are standard in the field.\n\nThe first step is to derive the expression for the toroidal current density, $\\,J_{\\phi}(R,Z)\\,$, from the provided fundamental laws of MHD equilibrium:\n1.  Force balance: $\\,\\nabla p = \\mathbf{J} \\times \\mathbf{B}\\,$\n2.  Ampère's law: $\\,\\nabla \\times \\mathbf{B} = \\mu_{0} \\mathbf{J}\\,$\n\nIn an axisymmetric system, the magnetic field $\\,\\mathbf{B}\\,$ can be expressed as:\n$$ \\mathbf{B} = \\frac{1}{R} \\nabla\\psi \\times \\hat{\\phi} + \\frac{F(\\psi)}{R}\\hat{\\phi} $$\nwhere $\\,\\psi(R,Z)\\,$ is the poloidal magnetic flux, $\\,F(\\psi) = R B_{\\phi}\\,$ is the toroidal field function, and $\\,(R, \\phi, Z)\\,$ are cylindrical coordinates. The poloidal components of the field are $\\,B_R = -\\frac{1}{R}\\frac{\\partial\\psi}{\\partial Z}\\,$ and $\\,B_Z = \\frac{1}{R}\\frac{\\partial\\psi}{\\partial R}\\,$.\n\nThe current density $\\,\\mathbf{J}\\,$ can be decomposed into poloidal and toroidal parts, $\\,\\mathbf{J} = \\mathbf{J}_p + J_{\\phi}\\hat{\\phi}\\,$. From Ampère's law, we have:\n$$ \\mu_{0} J_{\\phi} = (\\nabla \\times \\mathbf{B}_p) \\cdot \\hat{\\phi} = \\frac{\\partial B_R}{\\partial Z} - \\frac{\\partial B_Z}{\\partial R} $$\n$$ \\mu_{0} \\mathbf{J}_p = \\nabla \\times \\mathbf{B}_{\\phi} = \\nabla \\times \\left(\\frac{F(\\psi)}{R}\\hat{\\phi}\\right) $$\nFrom the force balance equation, $\\,\\nabla p = \\mathbf{J} \\times \\mathbf{B}\\,$, and the fact that pressure is a flux function, $\\,p=p(\\psi)\\,$, we have $\\,\\nabla p = p'(\\psi)\\nabla\\psi\\,$.\nSubstituting the expressions for $\\,\\mathbf{J}\\,$ and $\\,\\mathbf{B}\\,$:\n$$ p'(\\psi)\\nabla\\psi = (\\mathbf{J}_p + J_{\\phi}\\hat{\\phi}) \\times (\\mathbf{B}_p + B_{\\phi}\\hat{\\phi}) $$\n$$ p'(\\psi)\\nabla\\psi = (\\mathbf{J}_p \\times \\mathbf{B}_p) + (\\mathbf{J}_p \\times B_{\\phi}\\hat{\\phi}) + (J_{\\phi}\\hat{\\phi} \\times \\mathbf{B}_p) + (J_{\\phi}\\hat{\\phi} \\times B_{\\phi}\\hat{\\phi}) $$\nIn an axisymmetric equilibrium, $\\,\\mathbf{J}_p\\,$ is parallel to $\\,\\mathbf{B}_p\\,$, so $\\,\\mathbf{J}_p \\times \\mathbf{B}_p = 0\\,$. The last term is also zero. This leaves:\n$$ p'(\\psi)\\nabla\\psi = B_{\\phi} (\\mathbf{J}_p \\times \\hat{\\phi}) + J_{\\phi}(\\hat{\\phi} \\times \\mathbf{B}_p) $$\nA detailed calculation of $\\,\\mathbf{J}_p = (\\nabla \\times \\mathbf{B}_{\\phi})/\\mu_0\\,$ shows that $\\,\\mathbf{J}_p = \\frac{F'(\\psi)}{\\mu_0}\\mathbf{B}_p\\,$.\nSubstituting this into the force balance equation gives:\n$$ p'(\\psi)\\nabla\\psi = \\frac{F'(\\psi)B_{\\phi}}{\\mu_0}(\\mathbf{B}_p \\times \\hat{\\phi}) + J_{\\phi}(\\hat{\\phi} \\times \\mathbf{B}_p) $$\nUsing the identity $\\,\\hat{\\phi} \\times \\mathbf{B}_p = -(\\mathbf{B}_p \\times \\hat{\\phi})\\,$ and expressing $\\,\\mathbf{B}_p \\times \\hat{\\phi} = -\\frac{1}{R}\\nabla\\psi\\,$:\n$$ p'(\\psi)\\nabla\\psi = \\left( J_{\\phi} - \\frac{F'(\\psi) B_{\\phi}}{\\mu_0} \\right)(-\\frac{1}{R}\\nabla\\psi) $$\nEquating scalar coefficients of $\\,\\nabla\\psi\\,$ and substituting $\\,B_{\\phi} = F(\\psi)/R\\,$:\n$$ p'(\\psi) = -\\frac{1}{R}\\left(J_{\\phi} - \\frac{F(\\psi)F'(\\psi)}{\\mu_0 R}\\right) $$\nSolving for $\\,J_{\\phi}\\,$ yields the desired expression for the toroidal current density:\n$$ J_{\\phi}(R, Z) = R p'(\\psi) + \\frac{F(\\psi) F'(\\psi)}{\\mu_0 R} $$\nThis fundamental result shows that $\\,J_{\\phi}\\,$ is generally not a flux function due to its explicit dependence on $\\,R\\,$.\n\nNow we analyze the two specific parameter sets.\n\n**Analysis of Set $\\,\\mathsf{S1}\\,$**\nGiven: $\\,p(\\psi) = p_{0} - \\alpha \\psi\\,$ (so $\\,p'(\\psi) = -\\alpha\\,$ with $\\,\\alpha  0\\,$) and $\\,F(\\psi) = F_{0}\\,$ (so $\\,F'(\\psi) = 0\\,$).\nSubstituting these into the expression for $\\,J_{\\phi}\\,$:\n$$ J_{\\phi}(R,Z) = R(-\\alpha) + \\frac{F_0 \\cdot 0}{\\mu_0 R} = -\\alpha R $$\nThe toroidal current density is $\\,J_{\\phi} = -\\alpha R\\,$.\n- **Flux Function**: A flux function is constant on a surface of constant $\\,\\psi\\,$. Since $\\,R\\,$ varies over a flux surface in a tokamak, $\\,J_{\\phi}\\,$ is not a flux function. The current is not poloidally uniform.\n- **Poloidal Variation**: The magnitude of the current is $\\,|J_{\\phi}| = \\alpha R\\,$. It is smaller on the high-field side (HFS, smaller $\\,R\\,$) and larger on the low-field side (LFS, larger $\\,R\\,$).\n- **Profile Shape**: The current profile is 'hollow', meaning the current density magnitude peaks at the largest major radius $\\,R_{max}\\,$, not on the magnetic axis.\nThis profile is physically possible but does not match the description in Option A.\n\n**Analysis of Set $\\,\\mathsf{S2}\\,$**\nGiven: $\\,p'(\\psi) = -\\alpha\\,$ and $\\,F(\\psi)F'(\\psi) \\approx b\\,$ with $\\,b  0\\,$ being a constant.\nSubstituting these into the expression for $\\,J_{\\phi}\\,$:\n$$ J_{\\phi}(R,Z) = R(-\\alpha) + \\frac{b}{\\mu_0 R} = \\frac{b - \\mu_0 \\alpha R^2}{\\mu_0 R} $$\nThe sign and behavior of $\\,J_{\\phi}\\,$ depend on the competition between the two terms. The current reverses sign at a radius $\\,R_{rev} = \\sqrt{b/(\\mu_0 \\alpha)}\\,$.\n\nNow we evaluate each option.\n\n**A. Under set $\\,\\mathsf{S1}\\,$, the toroidal current density $\\,J_{\\phi}\\,$ is a flux function (constant on each magnetic surface), leading to poloidally uniform current and a physically plausible, on-axis-peaked profile.**\nAs derived above, for set $\\,\\mathsf{S1}\\,$, $\\,J_{\\phi} = -\\alpha R\\,$. This is not a flux function, current is not poloidally uniform, and the profile is hollow (peaked at large $\\,R\\,$), not on-axis-peaked. Each claim in this statement is false.\n**Verdict: Incorrect**\n\n**B. Under set $\\,\\mathsf{S2}\\,$ with $\\,b  \\mu_{0} \\alpha R_{\\max}^{2}\\,$, the toroidal current density $\\,J_{\\phi}\\,$ has the same sign on both the HFS and LFS and is larger on the HFS due to the $\\,1/R\\,$ contribution, thereby avoiding counter-current regions and remaining physically plausible.**\nThe condition $\\,b  \\mu_{0} \\alpha R_{\\max}^{2}\\,$ implies $\\,b/(\\mu_0 \\alpha)  R_{\\max}^2\\,$. The current reversal radius is $\\,R_{rev} = \\sqrt{b/(\\mu_0 \\alpha)}  R_{max}\\,$. Since all plasma is contained within $\\,R \\leq R_{max}\\,$, the reversal radius is outside the plasma. For any $\\,R\\,$ in the plasma, $\\,\\mu_0 \\alpha R^2  \\mu_0 \\alpha R_{max}^2  b\\,$. Thus, the numerator $\\,b - \\mu_0 \\alpha R^2\\,$ is always positive. As $\\,\\mu_0 R  0\\,$, $\\,J_{\\phi}\\,$ is positive everywhere. This avoids counter-current regions.\nTo determine the poloidal variation, we examine the derivative with respect to $\\,R\\,$:\n$$ \\frac{d J_{\\phi}}{d R} = \\frac{d}{dR}\\left(-\\alpha R + \\frac{b}{\\mu_0 R}\\right) = -\\alpha - \\frac{b}{\\mu_0 R^2} $$\nSince $\\,\\alpha  0\\,$ and $\\,b  0\\,$, this derivative is always negative. This proves that $\\,J_{\\phi}(R)\\,$ is a monotonically decreasing function of $\\,R\\,$. Therefore, the current density is largest at the smallest radius (HFS) and smallest at the largest radius (LFS). This inboard-peaked current profile is a consequence of the Shafranov shift and is very physically plausible for tokamak equilibria.\n**Verdict: Correct**\n\n**C. For any Solov’ev equilibrium with constant $\\,p'(\\psi)\\,$ and approximately constant $\\,F(\\psi) F'(\\psi)\\,$, the toroidal current density $\\,J_{\\phi}\\,$ necessarily diverges at the magnetic axis, making such solutions physically implausible.**\nThe expression for the current density is $\\,J_{\\phi} = c_1 R + c_2/R\\,$, where $\\,c_1 = p'\\,$ and $\\,c_2 = FF'/\\mu_0\\,$ are constants. The magnetic axis of a tokamak is a point $\\,(R_{axis}, Z_{axis})\\,$ where $\\,R_{axis}\\,$ is typically close to the major radius $\\,R_0  0\\,$. The current density at the axis, $\\,J_{\\phi}(R_{axis}, Z_{axis}) = c_1 R_{axis} + c_2/R_{axis}\\,$, is a finite value. A divergence would only occur at $\\,R=0\\,$, which is the geometric axis of the torus and is not part of the confined plasma. The statement is false.\n**Verdict: Incorrect**\n\n**D. Under set $\\,\\mathsf{S2}\\,$, if $\\,\\mu_{0} \\alpha R_{\\min}^{2}  b  \\mu_{0} \\alpha R_{\\max}^{2}\\,$, the toroidal current reverses sign between HFS and LFS on the same flux surface, which is unavoidable in Solov’ev equilibria and therefore renders them incapable of representing tokamak discharges.**\nThe condition $\\,\\mu_{0} \\alpha R_{\\min}^{2}  b  \\mu_{0} \\alpha R_{\\max}^{2}\\,$ implies $\\,R_{min}  R_{rev}  R_{max}\\,$, where $\\,R_{rev} = \\sqrt{b/(\\mu_0 \\alpha)}\\,$. This means the radius at which $\\,J_{\\phi}=0\\,$ lies within the plasma. For any flux surface that crosses this radius, $\\,J_{\\phi}\\,$ will be positive on the HFS part ($\\,R  R_{rev}\\,$) and negative on the LFS part ($\\,R  R_{rev}\\,$). The existence of such a current reversal under this condition is correctly described. However, the statement claims this situation is \"unavoidable in Solov’ev equilibria\". This is false. As demonstrated in the analysis for option B, choosing parameters such that $\\,b  \\mu_{0} \\alpha R_{\\max}^{2}\\,$ avoids the current reversal. Because the phenomenon is not unavoidable, the statement is incorrect. Furthermore, the claim that this renders the equilibria \"incapable of representing tokamak discharges\" is an overstatement, as equilibria with reversed current regions are studied in plasma physics, particularly for exotic configurations.\n**Verdict: Incorrect**",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "The final step in our hands-on practice is to bridge the gap between analytical theory and the computational methods used in modern fusion research. While the Grad-Shafranov equation yields the poloidal flux function $\\psi(R,Z)$, other critical parameters that govern plasma stability must be derived from it. This practical exercise  guides you through the numerical computation of the safety factor, $q$, and the magnetic shear, $\\hat{s}$, which are fundamental to understanding plasma confinement and turbulence. By implementing flux-surface integrals and derivatives, you will develop the essential skills needed to diagnose and analyze numerical MHD equilibria.",
            "id": "4196423",
            "problem": "You are given an axisymmetric magnetohydrodynamic (MHD) equilibrium, described by the poloidal flux function $\\,\\psi(R,Z)\\,$ and the toroidal field function $\\,F(\\psi)\\,$, in cylindrical coordinates $\\, (R,\\phi,Z)\\,$. In ideal MHD equilibrium, the magnetic field can be represented as $\\,\\mathbf{B} = \\frac{1}{R}\\,\\nabla\\psi \\times \\hat{\\boldsymbol{\\phi}} \\;+\\; \\frac{F(\\psi)}{R}\\,\\hat{\\boldsymbol{\\phi}}\\,$, where $\\,\\hat{\\boldsymbol{\\phi}}\\,$ is the unit vector in the toroidal direction. The poloidal magnetic field magnitude is $\\,B_{\\mathrm{p}} = \\frac{|\\nabla \\psi|}{R}\\,$ and the safety factor $\\,q(\\psi)\\,$ measures the field-line winding, defined by a flux-surface average line integral. The magnetic shear is defined as $\\,\\hat{s} = \\frac{r}{q}\\,\\frac{\\mathrm{d}q}{\\mathrm{d}r}\\,$, where $\\,r(\\psi)\\,$ is a minor-radius label derived from the flux surface area $\\,A(\\psi)\\,$ via $\\,r(\\psi) = \\sqrt{A(\\psi)/\\pi}\\,$. Angles must be in radians.\n\nStarting from these principles alone, construct a program that, for a specified numerical $\\,\\psi(R,Z)\\,$ which generates nested, closed flux surfaces and a specified $\\,F(\\psi)\\,$, computes:\n- the safety factor $\\,q(\\psi)\\,$ using flux-surface averages, and\n- the magnetic shear $\\,\\hat{s} = \\frac{r}{q}\\,\\frac{\\mathrm{d}q}{\\mathrm{d}r}\\,$ using numerical flux-surface differentiation.\n\nUse the flux-surface average definition\n$$\n\\langle g \\rangle_{\\psi} \\;=\\; \\frac{\\displaystyle \\oint_{\\psi=\\mathrm{const}} \\frac{g\\,\\mathrm{d}\\ell_{\\mathrm{p}}}{|\\nabla\\psi|}}{\\displaystyle \\oint_{\\psi=\\mathrm{const}} \\frac{\\mathrm{d}\\ell_{\\mathrm{p}}}{|\\nabla\\psi|}} \\,,\n$$\nwhere $\\,\\mathrm{d}\\ell_{\\mathrm{p}}\\,$ is the poloidal line element along the flux surface $\\,\\psi=\\mathrm{const}\\,$, and compute $\\,q(\\psi)\\,$ via the standard axisymmetric line integral\n$$\nq(\\psi) \\;=\\; \\frac{1}{2\\pi}\\,\\oint_{\\psi=\\mathrm{const}} \\frac{F(\\psi)}{R\\,|\\nabla\\psi|}\\;\\mathrm{d}\\ell_{\\mathrm{p}} \\,,\n$$\nwhich can also be expressed using the flux-surface average as\n$$\nq(\\psi) \\;=\\; \\frac{1}{2\\pi}\\,\\Big\\langle \\frac{F(\\psi)}{R} \\Big\\rangle_{\\psi}\\;\\oint_{\\psi=\\mathrm{const}} \\frac{\\mathrm{d}\\ell_{\\mathrm{p}}}{|\\nabla\\psi|} \\,.\n$$\n\nYour program must implement these computations on a set of test geometries where $\\,\\psi(R,Z)\\,$ yields elliptical flux surfaces centered at $\\,R=R_{0}\\,$:\n$$\n\\psi(R,Z) \\;=\\; \\psi_{0} \\;+\\; \\frac{1}{2}\\Big( \\frac{(R - R_{0})^{2}}{a^{2}} \\;+\\; \\frac{Z^{2}}{b^{2}} \\Big) \\,,\n$$\nwith semi-axis parameters $\\,a0\\,$ and $\\,b0\\,$. For a given level $\\,\\psi=\\psi_{0}+\\Delta\\psi\\,$ with $\\,\\Delta\\psi0\\,$, parameterize the flux surface by an angle $\\,t\\in[0,2\\pi)\\,$ (in radians) as\n$$\nR(t) \\;=\\; R_{0} \\;+\\; a\\,\\sqrt{2\\,\\Delta\\psi}\\,\\cos t \\,,\\qquad\nZ(t) \\;=\\; b\\,\\sqrt{2\\,\\Delta\\psi}\\,\\sin t \\,,\n$$\nwith differential poloidal arc length\n$$\n\\mathrm{d}\\ell_{\\mathrm{p}} \\;=\\; \\sqrt{ 2\\,\\Delta\\psi }\\;\\sqrt{ a^{2}\\,\\sin^{2}t \\;+\\; b^{2}\\,\\cos^{2}t } \\;\\mathrm{d}t \\,,\n$$\nand gradient magnitude\n$$\n|\\nabla\\psi| \\;=\\; \\sqrt{ 2\\,\\Delta\\psi }\\;\\sqrt{ \\frac{\\cos^{2}t}{a^{2}} \\;+\\; \\frac{\\sin^{2}t}{b^{2}} } \\,.\n$$\nUse these relations to numerically evaluate the line integrals for $\\,q(\\psi)\\,$. The flux surface area enclosed by the ellipse at $\\,\\psi=\\psi_{0}+\\Delta\\psi\\,$ is\n$$\nA(\\psi) \\;=\\; 2\\,\\pi\\,a\\,b\\,\\Delta\\psi \\,,\n$$\nand the minor radius label is\n$$\nr(\\psi) \\;=\\; \\sqrt{ \\frac{A(\\psi)}{\\pi} } \\;=\\; \\sqrt{ 2\\,a\\,b\\,\\Delta\\psi } \\,.\n$$\nCompute $\\,\\hat{s}(\\psi)\\,$ by numerically differentiating $\\,q\\,$ with respect to $\\,r\\,$ along a sequence of nearby flux surfaces.\n\nDesign a test suite with three cases that probe different aspects of the computation:\n- Case $\\,1\\,$ (general elongated surface, constant toroidal field function): $\\,R_{0}=1.7\\,$, $\\,a=0.25\\,$, $\\,b=0.50\\,$, $\\,F(\\psi)=F_{0}\\,$ with $\\,F_{0}=2.5\\,$, and $\\,\\Delta\\psi\\in\\{0.01,\\,0.04,\\,0.09\\}\\,$.\n- Case $\\,2\\,$ (circular cross-section, linearly varying toroidal field function): $\\,R_{0}=2.0\\,$, $\\,a=0.20\\,$, $\\,b=0.20\\,$, $\\,F(\\psi)=F_{0}+c\\,(\\psi-\\psi_{0})\\,$ with $\\,F_{0}=3.0\\,$ and $\\,c=10.0\\,$, and $\\,\\Delta\\psi\\in\\{0.001,\\,0.01,\\,0.03\\}\\,$.\n- Case $\\,3\\,$ (near-axis small surfaces, constant toroidal field function for a boundary test): $\\,R_{0}=1.8\\,$, $\\,a=0.15\\,$, $\\,b=0.45\\,$, $\\,F(\\psi)=F_{0}\\,$ with $\\,F_{0}=2.2\\,$, and $\\,\\Delta\\psi\\in\\{10^{-6},\\,5\\times 10^{-6}\\}\\,$.\n\nAll quantities are dimensionless in the final output (the safety factor $\\,q\\,$ and magnetic shear $\\,\\hat{s}\\,$ are both dimensionless); angles must be in radians. For each case, compute:\n- All $\\,q\\,$ values at the listed $\\,\\Delta\\psi\\,$ levels, and\n- All $\\,\\hat{s}\\,$ values at the same $\\,\\Delta\\psi\\,$ levels, using finite differences with respect to $\\,r(\\psi)\\,$ computed from the listed discrete surfaces. Use centered finite differences for interior points and one-sided finite differences for endpoints.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as:\n$$\n[\\;q_{1}^{(1)},\\,q_{2}^{(1)},\\,q_{3}^{(1)},\\,\\hat{s}_{1}^{(1)},\\,\\hat{s}_{2}^{(1)},\\,\\hat{s}_{3}^{(1)},\\,q_{1}^{(2)},\\,q_{2}^{(2)},\\,q_{3}^{(2)},\\,\\hat{s}_{1}^{(2)},\\,\\hat{s}_{2}^{(2)},\\,\\hat{s}_{3}^{(2)},\\,q_{1}^{(3)},\\,q_{2}^{(3)},\\,\\hat{s}_{1}^{(3)},\\,\\hat{s}_{2}^{(3)}\\;] \\,,\n$$\nwhere superscripts denote the case index and subscripts enumerate the $\\,\\Delta\\psi\\,$ surface index in ascending order. The numerical integration along $\\,t\\,$ must use radians. No other output is permitted.",
            "solution": "The problem statement is scientifically sound, self-contained, and well-posed. It is based on established principles of magnetohydrodynamics (MHD) for axisymmetric plasma equilibria. All provided definitions and formulae are standard in the field of plasma physics. The parameters for the test cases are physically realistic. Therefore, the problem is valid, and a solution is provided below.\n\nThe core of the task is to compute the safety factor, $q(\\psi)$, and the magnetic shear, $\\hat{s}(\\psi)$, for a specific family of MHD equilibria characterized by elliptical, nested magnetic flux surfaces.\n\nFirst, we address the computation of the safety factor $q(\\psi)$. The definition provided is\n$$\nq(\\psi) \\;=\\; \\frac{1}{2\\pi}\\,\\oint_{\\psi=\\mathrm{const}} \\frac{F(\\psi)}{R\\,|\\nabla\\psi|}\\;\\mathrm{d}\\ell_{\\mathrm{p}}\n$$\nThe problem supplies a parameterization for the flux surfaces $\\psi = \\psi_0 + \\Delta\\psi$ in terms of an angle $t \\in [0, 2\\pi)$, from which the quantities in the integrand can be derived. The relevant expressions are:\n- The major radius: $R(t) = R_{0} + a\\,\\sqrt{2\\,\\Delta\\psi}\\,\\cos t$\n- The differential poloidal arc length: $\\mathrm{d}\\ell_{\\mathrm{p}} = \\sqrt{ 2\\,\\Delta\\psi }\\;\\sqrt{ a^{2}\\,\\sin^{2}t \\;+\\; b^{2}\\,\\cos^{2}t } \\;\\mathrm{d}t$\n- The gradient of the flux function: $|\\nabla\\psi| = \\sqrt{ 2\\,\\Delta\\psi }\\;\\sqrt{ \\frac{\\cos^{2}t}{a^{2}} \\;+\\; \\frac{\\sin^{2}t}{b^{2}} }$\n\nSubstituting these into the integral for $q(\\psi)$, we convert the line integral over $\\mathrm{d}\\ell_{\\mathrm{p}}$ into a standard definite integral over $t$ from $0$ to $2\\pi$:\n$$\nq(\\Delta\\psi) \\;=\\; \\frac{1}{2\\pi}\\,\\int_{0}^{2\\pi} \\frac{F(\\psi_0 + \\Delta\\psi)}{R(t)\\,|\\nabla\\psi(t)|}\\;\\frac{\\mathrm{d}\\ell_{\\mathrm{p}}}{\\mathrm{d}t}\\;\\mathrm{d}t\n$$\nThe integrand, including the term $\\frac{\\mathrm{d}\\ell_{\\mathrm{p}}}{\\mathrm{d}t}$, becomes:\n$$\n\\frac{F(\\psi_0+\\Delta\\psi) \\left( \\sqrt{ 2\\,\\Delta\\psi }\\;\\sqrt{ a^{2}\\,\\sin^{2}t \\;+\\; b^{2}\\,\\cos^{2}t } \\right)}{\\left( R_{0} + a\\,\\sqrt{2\\,\\Delta\\psi}\\,\\cos t \\right) \\left( \\sqrt{ 2\\,\\Delta\\psi }\\;\\sqrt{ \\frac{\\cos^{2}t}{a^{2}} \\;+\\; \\frac{\\sin^{2}t}{b^{2}} } \\right)}\n$$\nThis expression can be algebraically simplified. The term $\\sqrt{ 2\\,\\Delta\\psi }$ in the numerator and denominator cancels. The radical in the denominator can be rewritten as:\n$$\n\\sqrt{ \\frac{\\cos^{2}t}{a^{2}} \\;+\\; \\frac{\\sin^{2}t}{b^{2}} } \\;=\\; \\sqrt{ \\frac{b^2\\cos^2 t + a^2\\sin^2 t}{a^2 b^2} } \\;=\\; \\frac{\\sqrt{a^2\\sin^2 t + b^2\\cos^2 t}}{ab}\n$$\nsince $a0$ and $b0$. The term $\\sqrt{a^2\\sin^2 t + b^2\\cos^2 t}$ then cancels with its counterpart in the numerator. This yields a substantially simplified integrand. The formula for $q(\\psi)$ becomes:\n$$\nq(\\Delta\\psi) \\;=\\; \\frac{F(\\psi_0+\\Delta\\psi)}{2\\pi} \\int_{0}^{2\\pi} \\frac{ab}{R_{0} + a\\,\\sqrt{2\\,\\Delta\\psi}\\,\\cos t} \\;\\mathrm{d}t\n$$\nThis integral is well-behaved and is computed numerically for each specified value of $\\Delta\\psi$ using the `quad` function from the `scipy.integrate` library, which performs numerical quadrature. All angular quantities are handled in radians.\n\nNext, we compute the magnetic shear, $\\hat{s}$, defined as $\\hat{s} = \\frac{r}{q}\\frac{\\mathrm{d}q}{\\mathrm{d}r}$. The flux surface label $r(\\psi)$ is given by $r(\\psi) = \\sqrt{2\\,a\\,b\\,\\Delta\\psi}$. For each case, we first compute the discrete pairs $(r_i, q_i)$ corresponding to each given $\\Delta\\psi_i$. The derivative $\\frac{\\mathrm{d}q}{\\mathrm{d}r}$ is then approximated at each point $i$ using a finite difference method, as stipulated.\nLet a case have $N$ surfaces, indexed $i=0, 1, ..., N-1$.\n- For the first surface ($i=0$), a forward difference is used:\n$$ \\Big(\\frac{\\mathrm{d}q}{\\mathrm{d}r}\\Big)_0 \\approx \\frac{q_1 - q_0}{r_1 - r_0} $$\n- For any interior surface ($0  i  N-1$), a centered difference is used for better accuracy:\n$$ \\Big(\\frac{\\mathrm{d}q}{\\mathrm{d}r}\\Big)_i \\approx \\frac{q_{i+1} - q_{i-1}}{r_{i+1} - r_{i-1}} $$\n- For the last surface ($i=N-1$), a backward difference is used:\n$$ \\Big(\\frac{\\mathrm{d}q}{\\mathrm{d}r}\\Big)_{N-1} \\approx \\frac{q_{N-1} - q_{N-2}}{r_{N-1} - r_{N-2}} $$\nFor case $3$, which has only two surfaces ($N=2$), the first point uses a forward difference and the second point uses a backward difference, which both evaluate to the same value, $\\frac{q_1-q_0}{r_1-r_0}$.\n\nThe magnetic shear $\\hat{s}_i$ at each surface is then calculated by combining these components:\n$$\n\\hat{s}_i = \\frac{r_i}{q_i} \\Big(\\frac{\\mathrm{d}q}{\\mathrm{d}r}\\Big)_i\n$$\nThis procedure is systematically applied to the parameters of each of the three test cases. The computed values of $q$ and $\\hat{s}$ for each case are collected and formatted into a single flat list, as specified by the output requirements.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n\n    def calculate_q_and_s(R0, a, b, F_func, dpsi_values):\n        \"\"\"\n        Calculates q and s profiles for a single case.\n\n        Args:\n            R0 (float): Major radius of the magnetic axis.\n            a (float): Horizontal semi-axis of elliptical flux surfaces.\n            b (float): Vertical semi-axis of elliptical flux surfaces.\n            F_func (callable): Toroidal field function F(psi), expects delta_psi.\n            dpsi_values (list of float): List of delta_psi levels to compute on.\n\n        Returns:\n            tuple: A tuple containing a list of q values and a list of s values.\n        \"\"\"\n\n        q_vals = []\n        r_vals = []\n\n        # Sort delta_psi values to ensure r is monotonically increasing\n        dpsi_values = sorted(dpsi_values)\n\n        # 1. Calculate r and q for each delta_psi\n        for dpsi in dpsi_values:\n            # Calculate minor radius label r\n            r = np.sqrt(2 * a * b * dpsi)\n            r_vals.append(r)\n            \n            # Calculate safety factor q\n            F_val = F_func(dpsi)\n            delta_R = a * np.sqrt(2 * dpsi)\n\n            # The integrand for q simplifies to ab / (R0 + delta_R * cos(t)).\n            # This is derived by substituting the parametric expressions for R, |grad(psi)|,\n            # and dl_p into the definition of q and simplifying the resulting algebraic expression.\n            def integrand(t):\n                return 1.0 / (R0 + delta_R * np.cos(t))\n\n            integral_val, _ = quad(integrand, 0, 2 * np.pi)\n            \n            q = (F_val * a * b / (2 * np.pi)) * integral_val\n            q_vals.append(q)\n\n        # 2. Calculate magnetic shear s using finite differences\n        n = len(dpsi_values)\n        if n  2:\n            # Shear is not well-defined for a single point\n            s_vals = [np.nan] * n\n            return q_vals, s_vals\n\n        dqdr = [0.0] * n\n        \n        # Forward difference for the first point (i=0)\n        dqdr[0] = (q_vals[1] - q_vals[0]) / (r_vals[1] - r_vals[0])\n        \n        # Centered difference for interior points\n        for i in range(1, n - 1):\n            dqdr[i] = (q_vals[i+1] - q_vals[i-1]) / (r_vals[i+1] - r_vals[i-1])\n\n        # Backward difference for the last point (i=n-1)\n        dqdr[n-1] = (q_vals[n-1] - q_vals[n-2]) / (r_vals[n-1] - r_vals[n-2])\n        \n        s_vals = [(r_vals[i] / q_vals[i]) * dqdr[i] for i in range(n)]\n\n        return q_vals, s_vals\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"R0\": 1.7, \"a\": 0.25, \"b\": 0.50,\n            \"F_func\": lambda dpsi: 2.5,\n            \"dpsi_values\": [0.01, 0.04, 0.09]\n        },\n        {\n            \"R0\": 2.0, \"a\": 0.20, \"b\": 0.20,\n            \"F_func\": lambda dpsi: 3.0 + 10.0 * dpsi,\n            \"dpsi_values\": [0.001, 0.01, 0.03]\n        },\n        {\n            \"R0\": 1.8, \"a\": 0.15, \"b\": 0.45,\n            \"F_func\": lambda dpsi: 2.2,\n            \"dpsi_values\": [1e-6, 5e-6]\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        q_results, s_results = calculate_q_and_s(\n            case[\"R0\"], case[\"a\"], case[\"b\"], case[\"F_func\"], case[\"dpsi_values\"]\n        )\n        all_results.extend(q_results)\n        all_results.extend(s_results)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}