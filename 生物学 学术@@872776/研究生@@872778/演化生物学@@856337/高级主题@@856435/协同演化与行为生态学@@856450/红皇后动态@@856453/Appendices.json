{"hands_on_practices": [{"introduction": "这项练习深入探讨了一个经典的宿主-寄生虫协同进化模型，它代表了“红色皇后”动力学的数学核心。通过分析这个耦合微分方程系统，我们可以精确地确定在何种条件下，拮抗性相互作用会产生持续的、周期性的“军备竞赛”。这项练习对于培养生态和进化模型稳定性分析的基本技能至关重要。[@problem_id:2748462]", "problem": "考虑一个在等位基因匹配 (MA) 相互作用范式下的宿主-寄生虫系统，其中宿主带有一个双等位基因座，其等位基因频率为 $x \\in [0,1]$，而寄生虫带有一个相应的双等位基因座，其等位基因频率为 $y \\in [0,1]$。假设时间是连续的，选择是弱的，因此等位基因频率的变化与现存遗传方差和选择梯度的乘积成正比。具体来说，设宿主的选择梯度是寄生虫频率的线性函数，$S_{x}(y) = a - b\\,y$，而寄生虫的选择梯度是宿主频率的线性函数，$S_{y}(x) = c - d\\,x$，其中 $a,b,c,d \\in \\mathbb{R}$ 是反映基线选择和种间耦合的常数。在这些假设下，等位基因频率的动态遵循一对耦合的常微分方程组 (ODEs)：$\\dot{x} = x(1 - x)\\,S_{x}(y)$ 和 $\\dot{y} = y(1 - y)\\,S_{y}(x)$。\n\n任务：\n- 用 $a, b, c, d$ 显式地写出耦合常微分方程组。\n- 确定内部平衡点 $(x^{\\ast},y^{\\ast})$，其中 $x^{\\ast} \\in (0,1)$ 且 $y^{\\ast} \\in (0,1)$，并陈述其存在的参数约束条件。\n- 通过计算雅可比矩阵及其特征值，在 $(x^{\\ast},y^{\\ast})$ 处对系统进行线性化。仅使用线性化方法，确定使内部平衡点成为线性中心（即线性化系统具有闭合轨道，等价于具有纯虚特征值）的充分必要参数约束条件。\n- 在你为线性中心推导出的条件下，计算由线性化预测的小振幅闭合轨道的角频率 $\\omega$，并仅用 $a, b, c, d$ 表示你的答案。\n\n以 $\\omega$ 的单个闭式表达式形式提供最终答案。不需要数值近似，也不需要单位。", "solution": "所述问题具有科学依据，是适定的，并且在数学上是一致的。它提出了一个来自理论进化生物学的标准模型，并要求使用动力系统理论的既定方法进行严格分析。该问题是有效的，且存在唯一解。我们着手进行分析。\n\n该耦合常微分方程组 (ODEs) 描述了宿主等位基因频率 $x$ 和寄生虫等位基因频率 $y$ 的协同进化。其动态由以下方程给出：\n$$ \\dot{x} = \\frac{dx}{dt} = x(1 - x)S_{x}(y) $$\n$$ \\dot{y} = \\frac{dy}{dt} = y(1 - y)S_{y}(x) $$\n项 $x(1-x)$ 代表宿主双等位基因座上的遗传方差，$y(1-y)$ 是寄生虫的相应方差。选择梯度 $S_{x}(y)$ 和 $S_{y}(x)$ 以线性函数形式给出：\n$$ S_{x}(y) = a - by $$\n$$ S_{y}(x) = c - dx $$\n其中 $a, b, c, d \\in \\mathbb{R}$ 为常数。\n\n首先，我们通过代入选择梯度的表达式，写出显式的耦合常微分方程组：\n$$ \\dot{x} = x(1 - x)(a - by) $$\n$$ \\dot{y} = y(1 - y)(c - dx) $$\n\n接下来，我们确定内部平衡点 $(x^{\\ast}, y^{\\ast})$，这是一个稳态解，其中 $x^{\\ast} \\in (0,1)$ 且 $y^{\\ast} \\in (0,1)$。在平衡点处，$\\dot{x} = 0$ 且 $\\dot{y} = 0$。对于内部平衡点，$x(1-x)$ 和 $y(1-y)$ 均不为零。这迫使选择梯度必须为零：\n$$ a - by^{\\ast} = 0 \\implies y^{\\ast} = \\frac{a}{b} $$\n$$ c - dx^{\\ast} = 0 \\implies x^{\\ast} = \\frac{c}{d} $$\n为使该平衡点位于状态空间的内部，我们必须满足约束条件 $0  x^{\\ast}  1$ 和 $0  y^{\\ast}  1$。这对参数施加了以下条件：\n$$ 0  \\frac{c}{d}  1 $$\n$$ 0  \\frac{a}{b}  1 $$\n这些条件意味着 $a$ 和 $b$ 必须同号且 $|a|  |b|$，$c$ 和 $d$ 必须同号且 $|c|  |d|$。\n\n为了分析此平衡点的稳定性，我们通过计算在 $(x^{\\ast}, y^{\\ast})$ 处取值的雅可比矩阵 $J$ 来对系统进行线性化。令 $f(x,y) = x(1-x)(a-by)$ 且 $g(x,y) = y(1-y)(c-dx)$。雅可比矩阵为：\n$$ J = \\begin{pmatrix} \\frac{\\partial f}{\\partial x}  \\frac{\\partial f}{\\partial y} \\\\ \\frac{\\partial g}{\\partial x}  \\frac{\\partial g}{\\partial y} \\end{pmatrix}_{(x^{\\ast}, y^{\\ast})} $$\n偏导数如下：\n$$ \\frac{\\partial f}{\\partial x} = (1 - 2x)(a - by) $$\n$$ \\frac{\\partial f}{\\partial y} = x(1 - x)(-b) = -bx(1-x) $$\n$$ \\frac{\\partial g}{\\partial x} = y(1 - y)(-d) = -dy(1-y) $$\n$$ \\frac{\\partial g}{\\partial y} = (1 - 2y)(c - dx) $$\n在平衡点 $(x^{\\ast}, y^{\\ast})$ 处（其中 $a - by^{\\ast} = 0$ 且 $c - dx^{\\ast} = 0$）计算这些偏导数，可将对角线元素简化为零：\n$$ \\frac{\\partial f}{\\partial x}\\bigg|_{(x^{\\ast}, y^{\\ast})} = (1 - 2x^{\\ast})(0) = 0 $$\n$$ \\frac{\\partial g}{\\partial y}\\bigg|_{(x^{\\ast}, y^{\\ast})} = (1 - 2y^{\\ast})(0) = 0 $$\n非对角线元素为：\n$$ \\frac{\\partial f}{\\partial y}\\bigg|_{(x^{\\ast}, y^{\\ast})} = -b x^{\\ast}(1 - x^{\\ast}) $$\n$$ \\frac{\\partial g}{\\partial x}\\bigg|_{(x^{\\ast}, y^{\\ast})} = -d y^{\\ast}(1 - y^{\\ast}) $$\n因此，在内部平衡点处的雅可比矩阵为：\n$$ J = \\begin{pmatrix} 0  -b x^{\\ast}(1-x^{\\ast}) \\\\ -d y^{\\ast}(1-y^{\\ast})  0 \\end{pmatrix} $$\n该矩阵的特征值 $\\lambda$ 可通过特征方程 $\\det(J - \\lambda I) = 0$ 求得：\n$$ \\lambda^2 - \\text{Tr}(J)\\lambda + \\det(J) = 0 $$\n此处，迹 $\\text{Tr}(J) = 0$。行列式为 $\\det(J) = (0)(0) - (-b x^{\\ast}(1-x^{\\ast}))(-d y^{\\ast}(1-y^{\\ast})) = -bd x^{\\ast}(1-x^{\\ast})y^{\\ast}(1-y^{\\ast})$。\n特征方程变为：\n$$ \\lambda^2 - bd x^{\\ast}(1-x^{\\ast})y^{\\ast}(1-y^{\\ast}) = 0 $$\n$$ \\lambda^2 = bd x^{\\ast}(1-x^{\\ast})y^{\\ast}(1-y^{\\ast}) $$\n为使该平衡点成为一个线性中心，其特征值必须是纯虚数，即 $\\lambda = \\pm i\\omega$，其中 $\\omega$ 是一个非零实数角频率。这要求 $\\lambda^2  0$。由于 $x^{\\ast} \\in (0,1)$ 且 $y^{\\ast} \\in (0,1)$，因此 $x^{\\ast}(1-x^{\\ast})$ 和 $y^{\\ast}(1-y^{\\ast})$ 均为严格正值。所以，成为线性中心的条件是：\n$$ bd  0 $$\n这意味着决定协同进化相互作用强度的参数 $b$ 和 $d$ 必须异号。这是充分必要条件。\n\n在此条件下，特征值为 $\\lambda = \\pm i\\omega$，其中 $\\omega^2 = -\\lambda^2$。角频率 $\\omega$ 则为：\n$$ \\omega = \\sqrt{-bd x^{\\ast}(1-x^{\\ast})y^{\\ast}(1-y^{\\ast})} $$\n现在我们将 $x^{\\ast}$ 和 $y^{\\ast}$ 用 $a, b, c, d$ 的表达式代入：\n$$ \\omega = \\sqrt{-bd \\left(\\frac{c}{d}\\right)\\left(1-\\frac{c}{d}\\right) \\left(\\frac{a}{b}\\right)\\left(1-\\frac{a}{b}\\right)} $$\n简化平方根下的表达式：\n$$ \\omega^2 = -bd \\left(\\frac{c(d-c)}{d^2}\\right) \\left(\\frac{a(b-a)}{b^2}\\right) $$\n$$ \\omega^2 = - \\frac{bd \\cdot ac(d-c)(b-a)}{b^2 d^2} $$\n$$ \\omega^2 = - \\frac{ac(b-a)(d-c)}{bd} $$\n因此，角频率的表达式为：\n$$ \\omega = \\sqrt{- \\frac{ac(b-a)(d-c)}{bd}} $$\n参数约束条件 $0  a/b  1$ 和 $0  c/d  1$ 确保了 $a(b-a)  0$ 和 $c(d-c)  0$，因此分子乘积 $ac(b-a)(d-c)$ 为正。在 $bd  0$ 的条件下，平方根内的整个分式保证为正，所以 $\\omega$ 是一个实数正值。", "answer": "$$ \\boxed{\\sqrt{-\\frac{ac(b-a)(d-c)}{bd}}} $$", "id": "2748462"}, {"introduction": "现在，我们将视角从离散的等位基因频率转向连续的量化性状的演化。这项练习探索了一个典型的“红色皇后”情景：一个种群的平均性状值必须追踪一个不断移动的适应度最优点。通过推导稳态下的演化滞后，我们可以量化种群在何种程度上永久处于适应不良状态，这是协同进化追逐的一个关键标志和后果。[@problem_id:2748443]", "problem": "考虑一个目标谱系中的单个定量性状 $z$（例如，宿主防御性状），该性状与一个共同演化的拮抗者（例如，寄生虫）处于红皇后动态中。假设在短的演化时间尺度上，拮抗者对目标谱系的生态反馈可以概括为一个作用于该谱系的移动高斯稳定化选择适应度景观，其绝对适应度为\n$$\nW(z,t) \\;=\\; W_{0}\\,\\exp\\!\\Big(-\\frac{S}{2}\\,\\big(z-\\theta(t)\\big)^{2}\\Big),\n$$\n其中 $S0$ 是稳定化选择的曲率（强度），$\\theta(t)$ 是由拮抗者驱动的瞬时适应度最适值，$W_{0}0$ 是一个恒定的基线适应度。令 $m(z,t)=\\ln W(z,t)$ 表示马尔萨斯适应度（瞬时增长率）。该目标谱系对于该性状具有一个加性遗传方差 $G$，在所考虑的时间尺度上近似恒定，性状分布近似保持为窄高斯分布，且环境效应独立于育种值。\n\n从 Robertson–Price 恒等式和数量遗传学（QG）关于表型的加性分解以及弱选择允许在均值附近对 $m(z,t)$ 进行线性化的标准假设出发，推导出一个关于平均性状 $\\bar{z}(t)$ 演化的闭式确定性常微分方程，该方程用 $G$、$S$ 和 $\\theta(t)$ 表示。然后，假设拮抗者施加一个匀速移动的最适值 $\\theta(t)=\\theta_{0}+ v t$，其中 $v$ 为常数。定义演化滞后 $\\Delta(t)=\\theta(t)-\\bar{z}(t)$，并确定当滞后在恒定 $v$ 下变得不随时间变化时达到的稳态滞后 $\\Delta^{\\ast}$。请将最终答案表示为仅包含 $G$、$S$ 和 $v$ 的单个闭式解析表达式。不需要也不允许进行数值近似，也不需要单位。", "solution": "问题陈述已经过验证，被认为是科学上可靠、提法恰当且完整的。这是一个理论演化数量遗传学中的标准练习。推导将按要求进行。\n\n选择作用下定量性状的演化由育种者方程的连续时间形式描述，该结果源于 Robertson–Price 恒等式和数量遗传学的标准假设。该方程将平均性状值 $\\bar{z}(t)$ 的变化率与加性遗传方差 $G$ 和选择梯度 $\\beta$ 联系起来：\n$$\n\\frac{d\\bar{z}}{dt} = G \\beta\n$$\n选择梯度 $\\beta$ 量化了作用于性状的定向选择压力。在弱选择的假设下，它被定义为个体马尔萨斯适应度 $m(z,t)$ 对性状值 $z$ 的偏导数，并在群体平均性状值 $\\bar{z}$ 处取值。\n$$\n\\beta = \\left. \\frac{\\partial m(z,t)}{\\partial z} \\right|_{z=\\bar{z}}\n$$\n问题给出了作为移动高斯函数的绝对适应度函数（生存力）：\n$$\nW(z,t) = W_{0}\\,\\exp\\!\\Big(-\\frac{S}{2}\\,\\big(z-\\theta(t)\\big)^{2}\\Big)\n$$\n其中 $W_0  0$ 是基线适应度，$S  0$ 是稳定化选择的强度，$\\theta(t)$ 是在时间 $t$ 的适应度最适值的位置。马尔萨斯适应度 $m(z,t)$ 是绝对适应度的自然对数：\n$$\nm(z,t) = \\ln(W(z,t)) = \\ln\\left(W_{0}\\,\\exp\\!\\Big(-\\frac{S}{2}\\,\\big(z-\\theta(t)\\big)^{2}\\Big)\\right)\n$$\n$$\nm(z,t) = \\ln(W_{0}) - \\frac{S}{2}(z-\\theta(t))^{2}\n$$\n为了求得选择梯度 $\\beta$，我们首先计算 $m(z,t)$ 对 $z$ 的偏导数：\n$$\n\\frac{\\partial m(z,t)}{\\partial z} = \\frac{\\partial}{\\partial z} \\left( \\ln(W_{0}) - \\frac{S}{2}(z-\\theta(t))^{2} \\right)\n$$\n$$\n\\frac{\\partial m(z,t)}{\\partial z} = 0 - \\frac{S}{2} \\cdot 2(z-\\theta(t)) \\cdot \\frac{\\partial}{\\partial z}(z-\\theta(t))\n$$\n$$\n\\frac{\\partial m(z,t)}{\\partial z} = -S(z-\\theta(t))\n$$\n接下来，我们在群体平均性状值 $z=\\bar{z}(t)$ 处计算这个导数：\n$$\n\\beta(t) = -S(\\bar{z}(t)-\\theta(t)) = S(\\theta(t)-\\bar{z}(t))\n$$\n将这个选择梯度的表达式代入演化速率方程，得到平均性状 $\\bar{z}(t)$ 的确定性常微分方程（ODE）：\n$$\n\\frac{d\\bar{z}}{dt} = G S (\\theta(t)-\\bar{z}(t))\n$$\n这个常微分方程描述了群体平均性状如何追踪移动的最适值 $\\theta(t)$。至此完成了问题的第一部分。\n\n对于第二部分，适应度最适值被指定以恒定速度 $v$ 移动：\n$$\n\\theta(t) = \\theta_{0} + v t\n$$\n演化滞后 $\\Delta(t)$ 定义为最适值与平均性状之间的差值：\n$$\n\\Delta(t) = \\theta(t) - \\bar{z}(t)\n$$\n为了求出演化滞后的动态，我们对 $\\Delta(t)$ 关于时间求导：\n$$\n\\frac{d\\Delta}{dt} = \\frac{d\\theta}{dt} - \\frac{d\\bar{z}}{dt}\n$$\n最适值的变化率是恒定的：\n$$\n\\frac{d\\theta}{dt} = \\frac{d}{dt}(\\theta_{0} + vt) = v\n$$\n平均性状的变化率 $\\frac{d\\bar{z}}{dt}$ 由上面推导的常微分方程给出。我们可以用滞后 $\\Delta(t)$ 来表示它：\n$$\n\\frac{d\\bar{z}}{dt} = G S (\\theta(t) - \\bar{z}(t)) = G S \\Delta(t)\n$$\n将这些表达式代入关于 $\\frac{d\\Delta}{dt}$ 的方程中：\n$$\n\\frac{d\\Delta}{dt} = v - G S \\Delta(t)\n$$\n这是一个关于演化滞后的线性一阶常微分方程。稳态滞后 $\\Delta^{\\ast}$ 是滞后的平衡值，当滞后不随时间变化时达到，即当 $\\frac{d\\Delta}{dt} = 0$ 时。将导数设为零，我们得到稳态的条件：\n$$\n0 = v - G S \\Delta^{\\ast}\n$$\n求解 $\\Delta^{\\ast}$ 得到稳态滞后：\n$$\nG S \\Delta^{\\ast} = v\n$$\n$$\n\\Delta^{\\ast} = \\frac{v}{G S}\n$$\n该表达式表示群体平均性状与不断移动的环境最适值之间的平衡滞后。它与环境变化的速度成正比，与加性遗传方差和稳定化选择强度的乘积成反比。", "answer": "$$\n\\boxed{\\frac{v}{GS}}\n$$", "id": "2748443"}, {"introduction": "这项练习从解析理论转向具体的计算实现，让你能够模拟群体遗传学的核心机制。你将为一个世代内的单倍型模拟选择和重组的作用，并重点关注它们对连锁不平衡（$D$）的共同影响。掌握这项技能至关重要，因为从长远来看，重组既可能破坏，也可能有助于维持驱动“红色皇后”动力学的协同适应基因组合。[@problem_id:2748386]", "problem": "考虑一个由红皇后动态驱动的、确定性的、无限群体的、单倍体双基因座宿主模型，该模型具有拮抗性上位效应。存在两个双等位基因座 $A/a$ 和 $B/b$，以及四种单倍型，其初始频率为 $(p_{AB}, p_{Ab}, p_{aB}, p_{ab})$，总和为 $1$。选择通过编码拮抗性上位效应的恒定绝对适应度作用于单倍型：连锁相单倍型 $AB$ 和 $ab$ 的适应度为 $1 + s_H$，而互斥相单倍型 $Ab$ 和 $aB$ 的适应度为 $1 - s_P$，其中 $s_H$ 和 $s_P$ 是选择系数，满足 $1 + s_H \\gt 0$ 和 $1 - s_P \\gt 0$。一个世代按顺序包括两个阶段：\n\n1. 选择阶段：频率按适应度重新加权，并按平均适应度重新归一化。如果单倍型 $ij$ 的初始频率是 $p_{ij}$，其绝对适应度是 $w_{ij}$，则选择后其频率为 $p_{ij}^{(s)} = p_{ij} w_{ij} / \\bar{w}$，其中 $\\bar{w} = \\sum_{k} p_{k} w_{k}$ 是平均适应度。\n\n2. 重组阶段：随机交配产生一个配子池，其中两个基因座之间以重组率 $r \\in [0, 0.5]$ 发生同源重组。设 $D^{(s)}$ 为选择后计算的连锁不平衡，定义为 $D^{(s)} = p_{AB}^{(s)} p_{ab}^{(s)} - p_{Ab}^{(s)} p_{aB}^{(s)}$。重组通过标准的双基因座随机交配转换，将选择后的单倍型频率转换为重组后的频率：\n- $p_{AB}^{(1)} = p_{AB}^{(s)} - r\\, D^{(s)}$，\n- $p_{Ab}^{(1)} = p_{Ab}^{(s)} + r\\, D^{(s)}$，\n- $p_{aB}^{(1)} = p_{aB}^{(s)} + r\\, D^{(s)}$，\n- $p_{ab}^{(1)} = p_{ab}^{(s)} - r\\, D^{(s)}$。\n\n将单世代连锁不平衡 $D_1$ 定义为重组后配子池中的连锁不平衡：\n$$\nD_1 = p_{AB}^{(1)} p_{ab}^{(1)} - p_{Ab}^{(1)} p_{aB}^{(1)}.\n$$\n\n你的任务是编写一个程序，对每个提供的测试用例执行上述的单世代更新（选择然后重组），并报告 $D_1$。\n\n使用以下测试套件，其中每个元组为 $(p_{AB}, p_{Ab}, p_{aB}, p_{ab}, s_H, s_P, r)$：\n- 测试 1 (一般情况): $(0.4, 0.1, 0.1, 0.4, 0.1, 0.1, 0.2)$。\n- 测试 2 (无重组；平衡起始): $(0.25, 0.25, 0.25, 0.25, 0.2, 0.1, 0.0)$。\n- 测试 3 (自由重组极限): $(0.3, 0.4, 0.2, 0.1, 0.05, 0.2, 0.5)$。\n- 测试 4 (连锁相单倍型频率为零的边缘情况): $(0.0, 0.6, 0.4, 0.0, 0.3, 0.9, 0.3)$。\n\n所有输入均为无量纲的概率和选择系数。将每个 $D_1$ 表示为四舍五入到8位小数的十进制数。\n\n最终输出格式：你的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，顺序与测试套件相同（例如，“[x1,x2,x3,x4]”）。", "solution": "问题陈述已经过验证，被认为是有效的。它描述了一个来自理论群体遗传学的标准（尽管是简化的）确定性模型，具体是一个带有选择和重组的双基因座单倍体模型。所有提供的参数和条件都是自洽的、有科学依据且数学上一致的。该问题是适定的，并允许一个唯一的可计算解。我现在将从第一性原理开始推导解决方案。\n\n目标是计算经过一个完整的选择和重组世代后的连锁不平衡（表示为 $D_1$）。一个世代包含作用于四种单倍型（$AB$、$Ab$、$aB$ 和 $ab$）频率的两个相继阶段。设它们的初始频率分别为 $p_{AB}$、$p_{Ab}$、$p_{aB}$ 和 $p_{ab}$，其中 $\\sum p_{ij} = 1$。\n\n该模型为单倍型指定了恒定的绝对适应度，以反映拮抗性上位效应。连锁相单倍型 $AB$ 和 $ab$ 的适应度为 $w_{c} = 1 + s_H$。互斥相单倍型 $Ab$ 和 $aB$ 的适应度为 $w_{r} = 1 - s_P$。\n\n第一个阶段是选择。每个单倍型的频率乘以其适应度，然后结果通过群体的平均适应度 $\\bar{w}$ 进行归一化。平均适应度是单倍型适应度的加权平均值：\n$$\n\\bar{w} = p_{AB} w_{c} + p_{Ab} w_{r} + p_{aB} w_{r} + p_{ab} w_{c}\n$$\n代入适应度值并按适应度对各项进行分组：\n$$\n\\bar{w} = (p_{AB} + p_{ab})(1 + s_H) + (p_{Ab} + p_{aB})(1 - s_P)\n$$\n单倍型 $ij$ 的选择后频率（表示为 $p_{ij}^{(s)}$）由下式给出：\n$$\np_{ij}^{(s)} = \\frac{p_{ij} w_{ij}}{\\bar{w}}\n$$\n具体来说，对于我们的四种单倍型：\n$$\np_{AB}^{(s)} = \\frac{p_{AB}(1 + s_H)}{\\bar{w}}, \\quad p_{ab}^{(s)} = \\frac{p_{ab}(1 + s_H)}{\\bar{w}}\n$$\n$$\np_{Ab}^{(s)} = \\frac{p_{Ab}(1 - s_P)}{\\bar{w}}, \\quad p_{aB}^{(s)} = \\frac{p_{aB}(1 - s_P)}{\\bar{w}}\n$$\n\n第二个阶段是重组。重组根据重组率 $r \\in [0, 0.5]$ 和选择后群体中存在的连锁不平衡 $D^{(s)}$ 来改变单倍型频率。连锁不平衡衡量了两个基因座上等位基因的统计性非随机关联。其定义为：\n$$\nD^{(s)} = p_{AB}^{(s)} p_{ab}^{(s)} - p_{Ab}^{(s)} p_{aB}^{(s)}\n$$\n重组会分解这些关联。经过一轮重组后的频率，即下一代开始时的频率，由标准转换给出：\n$$\np_{AB}^{(1)} = p_{AB}^{(s)} - r D^{(s)}\n$$\n$$\np_{Ab}^{(1)} = p_{Ab}^{(s)} + r D^{(s)}\n$$\n$$\np_{aB}^{(1)} = p_{aB}^{(s)} + r D^{(s)}\n$$\n$$\np_{ab}^{(1)} = p_{ab}^{(s)} - r D^{(s)}\n$$\n问题要求我们计算这个新配子池中的连锁不平衡 $D_1$。根据定义：\n$$\nD_1 = p_{AB}^{(1)} p_{ab}^{(1)} - p_{Ab}^{(1)} p_{aB}^{(1)}\n$$\n虽然可以直接代入 $p_{ij}^{(1)}$ 的表达式来计算 $D_1$，但一个更优雅和基础的推导揭示了一个更简单的关系。让我们将重组后的频率代入 $D_1$ 的定义中：\n$$\nD_1 = (p_{AB}^{(s)} - r D^{(s)})(p_{ab}^{(s)} - r D^{(s)}) - (p_{Ab}^{(s)} + r D^{(s)})(p_{aB}^{(s)} + r D^{(s)})\n$$\n展开乘积可得：\n$$\nD_1 = \\left(p_{AB}^{(s)}p_{ab}^{(s)} - rD^{(s)}(p_{AB}^{(s)} + p_{ab}^{(s)}) + (rD^{(s)})^2\\right) - \\left(p_{Ab}^{(s)}p_{aB}^{(s)} + rD^{(s)}(p_{Ab}^{(s)} + p_{aB}^{(s)}) + (rD^{(s)})^2\\right)\n$$\n合并各项：\n$$\nD_1 = (p_{AB}^{(s)}p_{ab}^{(s)} - p_{Ab}^{(s)}p_{aB}^{(s)}) - rD^{(s)}(p_{AB}^{(s)} + p_{ab}^{(s)} + p_{Ab}^{(s)} + p_{aB}^{(s)})\n$$\n根据定义，第一项是 $D^{(s)}$。第二项中的和 $(p_{AB}^{(s)} + p_{Ab}^{(s)} + p_{aB}^{(s)} + p_{ab}^{(s)})$ 是选择后所有单倍型频率的总和，必须等于 $1$。因此，方程简化为：\n$$\nD_1 = D^{(s)} - rD^{(s)}(1) = D^{(s)}(1 - r)\n$$\n这个基本结果表明，在没有其他力量产生连锁不平衡的情况下，重组会导致连锁不平衡每代以 $(1-r)$ 的因子指数衰减。因此，解决该问题的算法如下：\n1. 给定初始频率 $(p_{AB}, p_{Ab}, p_{aB}, p_{ab})$ 和选择系数 $s_H, s_P$。\n2. 计算平均适应度 $\\bar{w} = (p_{AB} + p_{ab})(1 + s_H) + (p_{Ab} + p_{aB})(1 - s_P)$。\n3. 计算选择后频率 $p_{ij}^{(s)} = p_{ij} w_{ij} / \\bar{w}$。\n4. 计算选择后连锁不平衡 $D^{(s)} = p_{AB}^{(s)} p_{ab}^{(s)} - p_{Ab}^{(s)} p_{aB}^{(s)}$。\n5. 计算最终连锁不平衡 $D_1 = D^{(s)}(1 - r)$。\n\n将对每个测试用例实施此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the one-generation linkage disequilibrium D_1 in a two-locus\n    haploid model with selection and recombination.\n    \"\"\"\n    # Each tuple contains: (p_AB, p_Ab, p_aB, p_ab, s_H, s_P, r)\n    test_cases = [\n        (0.4, 0.1, 0.1, 0.4, 0.1, 0.1, 0.2),       # Test 1\n        (0.25, 0.25, 0.25, 0.25, 0.2, 0.1, 0.0),    # Test 2\n        (0.3, 0.4, 0.2, 0.1, 0.05, 0.2, 0.5),      # Test 3\n        (0.0, 0.6, 0.4, 0.0, 0.3, 0.9, 0.3)        # Test 4\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        p_AB, p_Ab, p_aB, p_ab, s_H, s_P, r = case\n\n        # Fitnesses for coupling (c) and repulsion (r) haplotypes\n        w_c = 1.0 + s_H\n        w_r = 1.0 - s_P\n\n        # Step 1: Calculate mean fitness (w_bar)\n        # w_bar = p_AB*w_AB + p_Ab*w_Ab + p_aB*w_aB + p_ab*w_ab\n        w_bar = p_AB * w_c + p_Ab * w_r + p_aB * w_r + p_ab * w_c\n\n        # Step 2: Calculate post-selection frequencies (p_ij_s)\n        # Avoid division by zero if w_bar is zero, though problem constraints\n        # on s_H, s_P and positive frequencies prevent this.\n        if w_bar == 0:\n            # This case should not be reached with valid inputs.\n            # If all initial frequencies have zero fitness, the population dies.\n            # In such an undefined state, LD would be zero.\n            p_AB_s, p_Ab_s, p_aB_s, p_ab_s = 0.0, 0.0, 0.0, 0.0\n        else:\n            p_AB_s = (p_AB * w_c) / w_bar\n            p_ab_s = (p_ab * w_c) / w_bar\n            p_Ab_s = (p_Ab * w_r) / w_bar\n            p_aB_s = (p_aB * w_r) / w_bar\n\n        # Step 3: Calculate linkage disequilibrium after selection (D_s)\n        D_s = p_AB_s * p_ab_s - p_Ab_s * p_aB_s\n\n        # Step 4: Calculate final linkage disequilibrium (D_1)\n        # D_1 = D_s * (1 - r)\n        D_1 = D_s * (1.0 - r)\n\n        # Round the result to 8 decimal places as required.\n        results.append(f\"{D_1:.8f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2748386"}]}