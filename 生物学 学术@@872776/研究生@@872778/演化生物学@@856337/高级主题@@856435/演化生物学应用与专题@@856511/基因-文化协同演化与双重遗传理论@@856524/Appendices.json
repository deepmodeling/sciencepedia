{"hands_on_practices": [{"introduction": "双重继承理论的一个核心贡献是提供了量化和分解表型变迁的严谨框架。Price方程是实现这一目标的基础工具，它能将一代人之间的平均表型变化精确地划分为遗传和文化成分，并进一步区分选择效应和传递效应。通过这个练习[@problem_id:2716419]，你将亲手应用 Price 方程的分解形式，处理一个假设的经验数据集，从而掌握如何从数据中剖析基因-文化共同演化的各个驱动力。", "problem": "一个研究团队正在一个大型、有年龄结构的人类群体中研究双重继承理论（DIT），记录了一个离散世代中关于繁殖输出和标量表型的个体水平数据，该表型由遗传和文化成分相加构成。设个体 $i$ 的表型为 $z_{i} = g_{i} + c_{i}$，其中 $g_{i}$ 是加性遗传值，$c_{i}$ 是文化获得值。设 $w_{i}$ 表示个体 $i$ 的绝对适应度（预期后代数量）。该团队提供了以下经验估计的、按世代汇总的量：\n- 平均适应度 $\\bar{w} = $ $1.25$ 后代/亲代。\n- 遗传选择协方差 $\\mathrm{Cov}(w,g) = $ $0.08$ （性状单位$\\cdot$后代）。\n- 文化选择协方差 $\\mathrm{Cov}(w,c) = $ $0.15$ （性状单位$\\cdot$后代）。\n- 遗传传递项 $\\mathbb{E}(w\\,\\Delta g) = $ $-0.0125$ （性状单位$\\cdot$后代）。\n- 文化传递项 $\\mathbb{E}(w\\,\\Delta c) = $ $-0.0250$ （性状单位$\\cdot$后代）。\n\n从标量表型的标准Price方程和加性分解 $z_{i} = g_{i} + c_{i}$ 出发，推导出平均表型预期单代变化量 $\\Delta \\bar{z}$ 的加性分解，将其分解为遗传选择、文化选择、遗传传递和文化传递四个部分。使用你的分解，计算此数据集中文化对一代内表型变化的贡献。\n\n你的最终数值答案应以每代性状单位表示，并四舍五入到四位有效数字。", "solution": "该问题要求使用Price方程推导表型变化的加性分解，并随后计算文化对这一变化的贡献。该问题具有科学依据，提法明确，并为得到唯一解提供了所有必要信息。\n\n起点是描述平均表型 $\\bar{z}$ 在一代内变化的一般形式的Price方程：\n$$ \\bar{w} \\Delta \\bar{z} = \\mathrm{Cov}(w, z) + \\mathbb{E}(w \\Delta z) $$\n此处，$\\bar{w}$ 是群体的平均适应度，$w$ 是个体适应度，$z$ 是个体表型值，$\\mathrm{Cov}(w, z)$ 是适应度与表型之间的协方差（选择项），而 $\\mathbb{E}(w \\Delta z)$ 是亲代与子代之间表型变化的适应度加权平均值（传递项）。\n\n个体 $i$ 的表型 $z_i$ 由遗传值 $g_i$ 和文化获得值 $c_i$ 相加构成：\n$$ z_i = g_i + c_i $$\n我们将此分解代入Price方程。\n\n首先，考虑协方差项 $\\mathrm{Cov}(w, z)$。利用协方差的双线性性质：\n$$ \\mathrm{Cov}(w, z) = \\mathrm{Cov}(w, g + c) = \\mathrm{Cov}(w, g) + \\mathrm{Cov}(w, c) $$\n$\\mathrm{Cov}(w, g)$ 项表示作用于表型遗传成分的选择效应，而 $\\mathrm{Cov}(w, c)$ 表示作用于文化成分的选择效应。\n\n接下来，考虑传递项 $\\mathbb{E}(w \\Delta z)$。表型变化 $\\Delta z_i$ 是亲代 $i$ 的子代表型与亲代 $i$ 表型之间的平均差异。给定 $z = g+c$，此变化可分解为 $\\Delta z = \\Delta g + \\Delta c$。我们将其代入传递项，并利用期望算子的线性性质：\n$$ \\mathbb{E}(w \\Delta z) = \\mathbb{E}(w(\\Delta g + \\Delta c)) = \\mathbb{E}(w \\Delta g) + \\mathbb{E}(w \\Delta c) $$\n$\\mathbb{E}(w \\Delta g)$ 项表示非孟德尔传递和突变对遗传成分的影响，而 $\\mathbb{E}(w \\Delta c)$ 表示有偏文化传递（例如，不完美学习、引导变异）的影响。\n\n结合这些展开的项，复合表型的完整Price方程变为：\n$$ \\bar{w} \\Delta \\bar{z} = \\mathrm{Cov}(w, g) + \\mathrm{Cov}(w, c) + \\mathbb{E}(w \\Delta g) + \\mathbb{E}(w \\Delta c) $$\n为了求出平均表型的总变化量 $\\Delta \\bar{z}$，我们将整个方程除以平均适应度 $\\bar{w}$：\n$$ \\Delta \\bar{z} = \\frac{\\mathrm{Cov}(w, g)}{\\bar{w}} + \\frac{\\mathrm{Cov}(w, c)}{\\bar{w}} + \\frac{\\mathbb{E}(w \\Delta g)}{\\bar{w}} + \\frac{\\mathbb{E}(w \\Delta c)}{\\bar{w}} $$\n这就是所要求的总表型变化分解为四个部分的加性分解：遗传选择、文化选择、遗传传递和文化传递。\n\n平均表型的总变化量 $\\Delta \\bar{z}$ 是平均遗传值变化量 $\\Delta \\bar{g}$ 与平均文化值变化量 $\\Delta \\bar{c}$ 的和。\n$$ \\Delta \\bar{z} = \\Delta \\bar{g} + \\Delta \\bar{c} $$\n通过将分解中的遗传项和文化项分组，我们可以确定 $\\Delta \\bar{g}$ 和 $\\Delta \\bar{c}$ 的表达式：\n$$ \\Delta \\bar{g} = \\frac{\\mathrm{Cov}(w, g) + \\mathbb{E}(w \\Delta g)}{\\bar{w}} $$\n$$ \\Delta \\bar{c} = \\frac{\\mathrm{Cov}(w, c) + \\mathbb{E}(w \\Delta c)}{\\bar{w}} $$\n问题要求计算“文化对表型变化的贡献”。这对应于平均文化值的总变化量 $\\Delta \\bar{c}$。\n\n我们已知以下经验值：\n- 平均适应度 $\\bar{w} = 1.25$\n- 文化选择协方差 $\\mathrm{Cov}(w,c) = 0.15$\n- 文化传递项 $\\mathbb{E}(w \\Delta c) = -0.0250$\n\n我们使用这些值来计算 $\\Delta \\bar{c}$：\n$$ \\Delta \\bar{c} = \\frac{\\mathrm{Cov}(w, c) + \\mathbb{E}(w \\Delta c)}{\\bar{w}} $$\n代入数值：\n$$ \\Delta \\bar{c} = \\frac{0.15 + (-0.0250)}{1.25} $$\n$$ \\Delta \\bar{c} = \\frac{0.15 - 0.025}{1.25} $$\n$$ \\Delta \\bar{c} = \\frac{0.125}{1.25} $$\n$$ \\Delta \\bar{c} = 0.1 $$\n题目要求答案四舍五入到四位有效数字。因此，值 $0.1$ 必须写成 $0.1000$。单位是每代性状单位，因为 $\\Delta \\bar{c}$ 与表型 $c$ 的单位相同。", "answer": "$$\\boxed{0.1000}$$", "id": "2716419"}, {"introduction": "除了衡量已经发生的变化，演化理论家还关心预测新性状的最终命运。这个练习[@problem_id:2716387]将我们从确定性的分析带入随机过程的世界，聚焦于一个有益的文化创新在有限群体中的传播。你将运用一维生灭过程（Moran模型）的基本原理，从头推导出一个文化变异的固定概率，这是理解机会和选择在群体动态中如何相互作用的基础。", "problem": "考虑一个规模固定为 $N$ 的种群，该种群由两种可替代文化变体（cultural variant）的携带者组成：一种是最初稀有的创新变体 $I$，另一种是原有的传统变体 $T$。在基因-文化共演化和双重继承理论的框架下，假设文化变迁通过一次一个的社会学习事件进行。在每个事件中，从种群中选择一个榜样（role model），然后一个随机选择的学习者采纳该榜样的文化变体，取代其当前的变体。没有突变（创新只在开始时发生一次），并且随机性的唯一来源是社会学习过程中的人口抽样。\n\n水平传播以速率参数 $\\beta$ 发生，这意味着收益差异通过水平社会学习在榜样选择中得到体现，其强度与 $\\beta$ 成正比。设创新变体 $I$ 相对于 $T$ 具有一个不依赖于频率的收益优势 $s_c$（因此 $I$ 的收益为 $1 + s_c$，$T$ 的收益为 $1$）。假设水平社会学习使榜样选择偏向于一种有效的文化适应度（cultural fitness），该适应度将收益优势按水平传播速率 $\\beta$ 进行线性缩放，因此被选为榜样的相对可能性对于 $I$ 来说与 $f_I = 1 + \\beta s_c$ 成正比，对于 $T$ 来说与 $f_T = 1$ 成正比。这引出一个出生—死亡文化莫兰过程：在每次更新中，一个榜样以与其适应度 $f$ 成正比的概率被选中，然后一个均匀随机的学习者采纳该榜样的变体。\n\n从单个创新者（状态 $i=1$）开始，从第一性原理出发，推导出精确的固定概率（即 $I$ 最终遍布整个种群的概率），并将其表示为包含 $N$、$\\beta$ 和 $s_c$ 的闭式解析表达式。你的最终答案必须是一个没有单位的单一表达式。如果引入了任何中间符号，需在最终表达式中将其消去，使其仅依赖于 $N$、$\\beta$ 和 $s_c$。", "solution": "问题陈述经过了严格验证，被认为是科学合理的、定义明确的、客观的且内部一致的。它描述了一个标准的出生—死亡过程，具体来说是带有选择的莫兰模型，置于文化演化的背景下。因此，该问题是有效的，并允许一个形式化的数学解。\n\n我们将从第一性原理推导固定概率。系统的状态由携带创新变体 $I$ 的个体数量定义，我们将其表示为 $i$。种群规模固定为 $N$，因此有 $N-i$ 个个体携带传统变体 $T$。$i$ 的状态空间为 $\\{0, 1, \\dots, N\\}$。状态 $i=0$ 和 $i=N$ 是吸收态，分别对应于变体 $T$ 和 $I$ 的固定。\n\n该过程是一个离散时间马尔可夫链。在每一步中，发生单个事件，可能将 $i$ 的值改变 $+1$、$-1$ 或 $0$。我们必须首先确定转移概率。\n\n根据问题描述，一个榜样以与其有效文化适应度成正比的概率被选中，一个学习者被均匀随机地选中以采纳该榜样的变体。\n有效文化适应度值给定为：$I$ 型个体的适应度为 $f_I = 1 + \\beta s_c$，$T$ 型个体的适应度为 $f_T = 1$。\n\n在拥有 $i$ 个创新者和 $N-i$ 个传统者的种群中，总适应度是所有个体适应度值的总和：\n$$ W_{total} = i \\cdot f_I + (N-i) \\cdot f_T = i(1 + \\beta s_c) + (N-i)(1) = N + i \\beta s_c $$\n\n选择一个 $I$ 型个体作为榜样的概率是所有 $I$ 型个体总适应度与种群总适应度的比值：\n$$ P(\\text{model is } I) = \\frac{i f_I}{W_{total}} = \\frac{i(1 + \\beta s_c)}{N + i \\beta s_c} $$\n类似地，选择一个 $T$ 型个体作为榜样的概率是：\n$$ P(\\text{model is } T) = \\frac{(N-i) f_T}{W_{total}} = \\frac{N-i}{N + i \\beta s_c} $$\n\n学习者从规模为 $N$ 的种群中被均匀随机地选择。\n如果选择了 $I$ 型榜样和 $T$ 型学习者，创新者的数量 $i$ 将增加一（即 $i \\to i+1$）。种群中有 $N-i$ 个 $T$ 型个体。选择一个 $T$ 型学习者的概率是 $\\frac{N-i}{N}$。因此，数量增加的转移概率 $T_i^+$ 为：\n$$ T_i^+ = P(i \\to i+1) = P(\\text{model is } I) \\times P(\\text{learner is } T) = \\frac{i(1 + \\beta s_c)}{N + i \\beta s_c} \\times \\frac{N-i}{N} $$\n\n如果选择了 $T$ 型榜样和 $I$ 型学习者，创新者的数量 $i$ 将减少一（即 $i \\to i-1$）。种群中有 $i$ 个 $I$ 型个体。选择一个 $I$ 型学习者的概率是 $\\frac{i}{N}$。因此，数量减少的转移概率 $T_i^-$ 为：\n$$ T_i^- = P(i \\to i-1) = P(\\text{model is } T) \\times P(\\text{learner is } I) = \\frac{N-i}{N + i \\beta s_c} \\times \\frac{i}{N} $$\n\n保持在状态 $i$ 的概率是 $T_i^0 = 1 - T_i^+ - T_i^-$。在 $i=0$ 和 $i=N$ 处的吸收态与计算 $1 \\le i \\le N-1$ 时的固定概率无关。\n\n对于一维出生—死亡过程，从状态 $k$（即有 $k$ 个突变体）开始的固定概率 $\\Phi_k$ 由通用公式给出：\n$$ \\Phi_k = \\frac{1 + \\sum_{j=1}^{k-1} \\prod_{i=1}^{j} \\frac{T_i^-}{T_i^+}}{1 + \\sum_{j=1}^{N-1} \\prod_{i=1}^{j} \\frac{T_i^-}{T_i^+}} $$\n问题指定我们从单个创新者开始，所以 $k=1$。在这种情况下，分子中的求和是空的（从 $j=1$ 到 $k-1=0$），其定义为 $0$。公式简化为：\n$$ \\Phi_1 = \\frac{1}{1 + \\sum_{j=1}^{N-1} \\prod_{i=1}^{j} \\frac{T_i^-}{T_i^+}} $$\n我们现在必须计算比率 $\\gamma_i = \\frac{T_i^-}{T_i^+}$。\n$$ \\gamma_i = \\frac{\\frac{(N-i)i}{N(N + i \\beta s_c)}}{\\frac{i(1 + \\beta s_c)(N-i)}{N(N + i \\beta s_c)}} = \\frac{1}{1 + \\beta s_c} $$\n这个比率是一个常数，与状态 $i$ 无关。我们定义这个常数为 $\\gamma = \\frac{1}{1 + \\beta s_c}$。\n\n固定概率公式中的乘积项变为：\n$$ \\prod_{i=1}^{j} \\gamma_i = \\prod_{i=1}^{j} \\gamma = \\gamma^j $$\n将此代入 $\\Phi_1$ 的表达式中：\n$$ \\Phi_1 = \\frac{1}{1 + \\sum_{j=1}^{N-1} \\gamma^j} $$\n分母是一个等比数列：$1 + \\sum_{j=1}^{N-1} \\gamma^j = \\sum_{j=0}^{N-1} \\gamma^j$。\n这个有限等比数列的和由 $\\frac{1-\\gamma^N}{1-\\gamma}$ 给出，假设 $\\gamma \\ne 1$。\n$\\gamma=1$ 的情况对应于 $\\beta s_c = 0$，即中性情况。此时，$\\Phi_1 = \\frac{1}{1 + (N-1)} = \\frac{1}{N}$，这是正确的中性固定概率。\n对于 $\\gamma \\ne 1$：\n$$ \\Phi_1 = \\frac{1}{\\frac{1-\\gamma^N}{1-\\gamma}} = \\frac{1-\\gamma}{1-\\gamma^N} $$\n这是以 $\\gamma$ 表示的精确固定概率。为了提供以问题给定的参数 $N$、$\\beta$ 和 $s_c$ 表示的最终答案，我们将 $\\gamma = \\frac{1}{1 + \\beta s_c}$ 代回表达式中。\n$$ \\Phi_1 = \\frac{1 - \\frac{1}{1 + \\beta s_c}}{1 - \\left(\\frac{1}{1 + \\beta s_c}\\right)^N} $$\n为了简化此表达式并消除复合分数，我们进行代数操作。\n分子是：\n$$ 1 - \\frac{1}{1 + \\beta s_c} = \\frac{(1 + \\beta s_c) - 1}{1 + \\beta s_c} = \\frac{\\beta s_c}{1 + \\beta s_c} $$\n分母是：\n$$ 1 - \\frac{1}{(1 + \\beta s_c)^N} = \\frac{(1 + \\beta s_c)^N - 1}{(1 + \\beta s_c)^N} $$\n将它们组合起来得到：\n$$ \\Phi_1 = \\frac{\\frac{\\beta s_c}{1 + \\beta s_c}}{\\frac{(1 + \\beta s_c)^N - 1}{(1 + \\beta s_c)^N}} = \\frac{\\beta s_c}{1 + \\beta s_c} \\times \\frac{(1 + \\beta s_c)^N}{(1 + \\beta s_c)^N - 1} $$\n这简化为最终的闭式表达式：\n$$ \\Phi_1 = \\frac{\\beta s_c (1 + \\beta s_c)^{N-1}}{(1 + \\beta s_c)^N - 1} $$\n这个表达式代表了在指定的文化莫兰过程中，单个创新者的精确固定概率。", "answer": "$$ \\boxed{\\frac{\\beta s_c (1 + \\beta s_c)^{N-1}}{(1 + \\beta s_c)^{N} - 1}} $$", "id": "2716387"}, {"introduction": "理论学习的终极实践是将各种概念融会贯通，构建一个动态的仿真模型。这个练习[@problem_id:2716366]将指导你从零开始，为基因-文化共同演化最著名的案例之一——乳糖酶耐受性与奶制品业——建立一个耦合动态模型。通过亲手实现这个仿真过程，你将对基因和文化在数千年的时间尺度上如何相互影响、共同塑造彼此的演化轨迹获得深刻的直观理解。", "problem": "您需要实现一个完整、可运行的程序，模拟一个基于双重继承理论（DIT）的遗传性状（乳糖酶持久性）与文化性状（乳制品业）共同演化的模型。您的设计必须从演化生物学的有效基础出发，并推导出离散时间下的耦合基因-文化动态。假设生物种群是随机交配的，具有离散且不重叠的世代。遗传性状由单一基因座上的两个等位基因编码，文化性状是一种社会传播的实践，其采纳动态取决于收益。\n\n仅从以下基本依据出发：\n- 在大种群中，随机交配和单一基因座双等位基因条件下的 Hardy–Weinberg 平衡比例。\n- 离散时间下的确定性生存力选择。\n- 基于收益差异的频率依赖性采纳的复制子型社会学习动态。\n- 全新世乳制品业出现与传播的考古学上合理的时间线，世代时间为 $25$ 年。使用总模拟时域 $T=400$ 个世代（对应于 $10{,}000$ 年）。\n\n使用以下组成部分和定义构建模型。\n- 遗传状态：令 $p_t \\in [0,1]$ 表示在第 $t$ 代中乳糖酶持久性等位基因的频率，其中 $t \\in \\{0,1,\\dots,T\\}$。假设在该世代的乳制品业背景下，乳糖酶持久性对于适应度效应是显性的。\n- 文化状态：令 $q_t \\in [0,1]$ 表示在第 $t$ 代中乳制品业（采纳者）的频率。\n- 适应度环境：乳糖酶持久性的适应度效应取决于同一世代的乳制品业；令每代选择系数为 $s \\ge 0$，使得在第 $t$ 代中，乳制品业的采纳者为乳糖酶持久性等位基因的携带者带来与 $q_t$ 成正比的优势。\n- 文化环境：乳制品业的采纳通过速率为 $r > 0$ 的收益偏向型社会学习进行，第 $t$ 代中有利于采纳的收益差异为 $[(b_0 + b_1\\,p_t) - c]$，其中 $b_0 \\ge 0$ 是独立于基因型的乳制品业基线收益，$b_1 \\ge 0$ 捕捉了基因-文化互补性（额外收益随乳糖酶持久性等位基因频率增加而增加），$c \\ge 0$ 是乳制品业的成本。\n- 起始时间：将乳制品业的起始定义为距今 $\\Omega$ 代。在总时域 $T$ 下，前向模拟中的起始指数为 $g_{\\mathrm{on}} = T - \\Omega$。在 $t  g_{\\mathrm{on}}$ 之前，乳制品业不可用，$q_t$ 被约束为 $0$。在 $t = g_{\\mathrm{on}}$ 时，以一个小的种子频率 $q_\\varepsilon \\in (0,1)$ 引入乳制品业。\n\n您的程序必须精确地实现以下离散时间过程：\n- 在 $t=0$ 时初始化：将 $p_0$ 设置为特定案例的初始等位基因频率，且 $q_0 = 0$。\n- 对于每一代 $t \\in \\{0,1,\\dots,T-1\\}$：\n  - 如果 $t  g_{\\mathrm{on}}$，则设置 $q_t = 0$。\n  - 如果 $t = g_{\\mathrm{on}}$，将 $q_t$ 替换为 $\\max(q_t, q_\\varepsilon)$ 以引入乳制品业。\n  - 文化更新，通过收益偏向的复制子步骤从 $q_t$ 和 $p_t$ 得到 $q_{t+1}$：\n    $$q_{t+1} = \\mathrm{clip}\\Big(q_t + r\\,q_t\\,(1-q_t)\\,\\big[(b_0 + b_1\\,p_t) - c\\big]\\Big)$$\n    其中 $\\mathrm{clip}(x)$ 通过在区间边界处截断将 $x$ 投影到 $[0,1]$。\n  - 遗传更新，通过在该世代环境下的 Hardy–Weinberg 和乳糖酶持久性显性条件下的确定性生存力选择，从 $p_t$ 和 $q_t$ 得到 $p_{t+1}$。使用这些假设所隐含的标准离散时间选择更新。\n- 记录 $p_t$ 达到或超过指定阈值 $p^\\star$ 的第一个世代指数（一个整数），并类似地记录 $q_t$ 达到或超过 $q^\\star$ 的第一个指数。如果在 $t=T$ 之前（含 $t=T$）从未达到阈值，则记录 $-1$。阈值应在由上述规则生成的序列 $\\{p_t\\}_{t=0}^{T}$ 和 $\\{q_t\\}_{t=0}^{T}$ 上进行评估。\n\n所有时间必须以世代（整数）表示。所有频率必须以 $[0,1]$ 区间内的小数表示。\n\n为以下参数集测试套件实现模拟，这些参数集旨在反映考古学上合理的起始时间，并跨越性质上不同的动态区域。对于所有情况，使用 $T = 400$，$p^\\star = 0.6$，$q^\\star = 0.8$，以及世代长度 $25$ 年（仅为背景信息；不要转换单位）。\n\n- 情况 A（早期起始，强耦合）：\n  - 初始等位基因频率 $p_0 = 0.01$。\n  - 选择系数 $s = 0.02$。\n  - 社会学习率 $r = 0.15$。\n  - 基线文化收益 $b_0 = 0.02$。\n  - 基因-文化互补性 $b_1 = 0.10$。\n  - 文化成本 $c = 0.01$。\n  - 乳制品业起始于距今 $\\Omega = 360$ 代（约 $9{,}000$ 年），因此 $g_{\\mathrm{on}} = 40$。\n  - 种子频率 $q_\\varepsilon = 0.02$。\n\n- 情况 B（晚期起始，中等耦合）：\n  - $p_0 = 0.01$。\n  - $s = 0.015$。\n  - $r = 0.10$。\n  - $b_0 = 0.02$。\n  - $b_1 = 0.08$。\n  - $c = 0.012$。\n  - $\\Omega = 240$（约 $6{,}000$ 年），所以 $g_{\\mathrm{on}} = 160$。\n  - $q_\\varepsilon = 0.02$。\n\n- 情况 C（无耦合，无遗传选择；文化独立兴起）：\n  - $p_0 = 0.05$。\n  - $s = 0.00$。\n  - $r = 0.12$。\n  - $b_0 = 0.02$。\n  - $b_1 = 0.00$。\n  - $c = 0.005$。\n  - $\\Omega = 360$，所以 $g_{\\mathrm{on}} = 40$。\n  - $q_\\varepsilon = 0.01$。\n\n- 情况 D（易出现双稳态，起步困难）：\n  - $p_0 = 0.01$。\n  - $s = 0.02$。\n  - $r = 0.10$。\n  - $b_0 = 0.00$。\n  - $b_1 = 0.05$。\n  - $c = 0.02$。\n  - $\\Omega = 240$，所以 $g_{\\mathrm{on}} = 160$。\n  - $q_\\varepsilon = 0.02$。\n\n您的程序必须为每种情况计算以下四个输出：\n- 最终等位基因频率 $p_T$（四舍五入到六位小数）。\n- 最终文化频率 $q_T$（四舍五入到六位小数）。\n- $p_t \\ge p^\\star$ 的最早世代指数（一个整数，如果从未达到则为 $-1$）。\n- $q_t \\ge q^\\star$ 的最早世代指数（一个整数，如果从未达到则为 $-1$）。\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含按 A、B、C、D 顺序连接的所有案例结果，形式为用方括号括起来的逗号分隔列表。每个案例的顺序必须是 $[p_T, q_T, t_{p^\\star}, t_{q^\\star}]$。例如，最终行的有效形式为\n  $$[\\text{A}_{p_T},\\text{A}_{q_T},\\text{A}_{t_{p^\\star}},\\text{A}_{t_{q^\\star}},\\text{B}_{p_T},\\dots,\\text{D}_{t_{q^\\star}}]$$\n所有频率必须是 $[0,1]$ 区间内四舍五入到六位小数的小数，所有时间必须是世代整数。", "solution": "所提出的问题是要求基于双重继承理论（DIT）的原则，构建并实现一个基因-文化共同演化的模拟模型。具体案例是乳糖酶持久性（一种遗传性状）和乳制品业（一种文化性状）的共同演化。\n\n### 问题验证\n\n首先，我必须验证问题陈述。\n\n**第1步：提取已知条件**\n\n*   **模型框架**：基于双重继承理论（DIT）的离散时间模型，总时长为 $T=400$ 个世代。\n*   **遗传系统**：单一基因座，两个等位基因。乳糖酶持久性等位基因的频率为 $p_t \\in [0,1]$。假设乳糖酶持久性等位基因对适应度效应是显性的。\n*   **文化系统**：单一文化性状（乳制品业）。采纳者的频率为 $q_t \\in [0,1]$。\n*   **基因-文化相互作用**：\n    *   **遗传更新**：对乳糖酶持久性等位基因的选择取决于乳制品业的频率 $q_t$。选择系数为 $s \\ge 0$。更新遵循 Hardy-Weinberg 条件下的确定性生存力选择。\n    *   **文化更新**：乳制品业的采纳遵循收益偏向型社会学习（复制子动态），速率为 $r > 0$。收益差异为 $\\Delta_{\\pi} = (b_0 + b_1 p_t) - c$。\n*   **模拟时间线**：\n    *   总时域：$T = 400$ 个世代。\n    *   乳制品业起始：距今 $\\Omega$ 个世代，在模拟时间 $g_{\\mathrm{on}} = T - \\Omega$。\n    *   对于 $t  g_{\\mathrm{on}}$，$q_t=0$。\n    *   在 $t = g_{\\mathrm{on}}$ 时，以频率 $q_\\varepsilon > 0$ 引入乳制品业。\n*   **更新方程**：\n    *   文化：$q_{t+1} = \\mathrm{clip}\\Big(q_t + r\\,q_t\\,(1-q_t)\\,\\big[(b_0 + b_1\\,p_t) - c\\big]\\Big)$，其中 $\\mathrm{clip}(x)$ 将 $x$ 投影到 $[0,1]$。\n    *   遗传：由显性以及适应度取决于 $q_t$ 所隐含的标准离散时间选择更新。\n*   **输出要求**：\n    *   最终频率 $p_T, q_T$。\n    *   频率达到阈值 $p^\\star=0.6$ 和 $q^\\star=0.8$ 的第一个世代指数 $t_{p^\\star}, t_{q^\\star}$。\n*   **测试案例的参数**：提供了四个不同的参数集（A、B、C、D），包含 $p_0, s, r, b_0, b_1, c, \\Omega, q_\\varepsilon$ 的具体值。\n\n**第2步：使用提取的已知条件进行验证**\n\n根据验证标准对问题进行评估。\n\n*   **科学依据**：该模型基于演化生物学中已建立的标准框架：双重继承理论、Hardy-Weinberg 平衡、确定性选择和复制子动态。将其应用于乳糖酶持久性和乳制品业是该领域的典型范例。指定的参数和时间尺度是合理的。该问题在科学上是合理的。\n*   **良定性**：该问题描述了一个耦合的一阶非线性差分方程组。初始条件和更新规则都已指定。遗传更新规则虽然没有给出最终公式，但通过“Hardy–Weinberg 和显性条件下的确定性生存力选择”的原则明确指定。如下文详述，这一标准推导将得出一个唯一的公式。该系统是良定的，对于给定的初始状态和参数存在唯一解。\n*   **客观性**：问题以精确的数学术语陈述，没有歧义、主观性或非科学主张。\n\n**第3步：结论与行动**\n\n该问题是**有效的**。这是一个在计算生物学领域中良定且具有科学依据的问题。我现在将开始构建解决方案。\n\n### 模型推导与算法设计\n\n在实现模拟之前，我们必须按规定最终确定更新方程的数学形式。\n\n**1. 文化更新动态**\n乳制品业频率 $q_t$ 的更新规则是直接给出的：\n$$q_{t+1} = \\mathrm{clip}\\left(q_t + r\\,q_t\\,(1-q_t)\\,\\left[\\left(b_0 + b_1\\,p_t\\right) - c\\right]\\right)$$\n此处，$q_t(1-q_t)$ 代表种群中文化性状的方差，括号中的项是采纳乳制品业与不采纳之间的收益差异。参数 $r$ 是社会学习率，用于缩放文化变化的速度。$\\mathrm{clip}$ 函数确保 $q_{t+1}$ 保持在区间 $[0,1]$ 内。\n\n**2. 遗传更新动态**\n等位基因频率 $p_t$ 的更新规则必须从所述原则中推导出来。\n设 $A$ 为乳糖酶持久性等位基因（频率为 $p_t$），$a$ 为非持久性等位基因（频率为 $1-p_t$）。在随机交配（panmixia）下，受孕时的基因型频率由 Hardy-Weinberg 平衡比例给出：\n*   $f(AA) = p_t^2$\n*   $f(Aa) = 2p_t(1-p_t)$\n*   $f(aa) = (1-p_t)^2$\n\n等位基因 $A$ 的显性意味着基因型 $AA$ 和 $Aa$ 具有相同的表型（乳糖酶持久性）。问题陈述指出，这些个体享有选择优势，其大小与乳制品业的频率 $q_t$ 成正比。我们如下定义每个基因型的相对适应度（生存力）：\n*   $w_{AA} = 1 + s\\,q_t$\n*   $w_{Aa} = 1 + s\\,q_t$\n*   $w_{aa} = 1$\n参数 $s$ 是最大选择系数，在 $q_t=1$ 时实现。\n\n第 $t$ 代种群的平均适应度 $\\bar{w}_t$ 是基因型适应度的加权平均值：\n$$\\bar{w}_t = f(AA)w_{AA} + f(Aa)w_{Aa} + f(aa)w_{aa}$$\n$$\\bar{w}_t = p_t^2(1+s\\,q_t) + 2p_t(1-p_t)(1+s\\,q_t) + (1-p_t)^2(1)$$\n提出因子 $(1+s\\,q_t)$：\n$$\\bar{w}_t = (p_t^2 + 2p_t(1-p_t))(1+s\\,q_t) + (1-p_t)^2$$\n乳糖酶持久性基因型的频率是 $p_t^2 + 2p_t(1-p_t) = 2p_t - p_t^2$。代入此式得到：\n$$\\bar{w}_t = (2p_t-p_t^2)(1+s\\,q_t) + (1-p_t)^2 = (2p_t-p_t^2) + s\\,q_t(2p_t-p_t^2) + 1 - 2p_t + p_t^2$$\n$$\\bar{w}_t = 1 + s\\,q_t(2p_t-p_t^2)$$\n\n下一代中等位基因 $A$ 的频率 $p_{t+1}$ 是选择后基因库中等位基因 $A$ 的频率。这是通过将每个基因型对等位基因的贡献按其选择后频率加权计算得出的：\n$$p_{t+1} = \\frac{p_t^2 w_{AA} + p_t(1-p_t)w_{Aa}}{\\bar{w}_t}$$\n$$p_{t+1} = \\frac{p_t^2(1+s\\,q_t) + p_t(1-p_t)(1+s\\,q_t)}{\\bar{w}_t} = \\frac{p_t(p_t + 1-p_t)(1+s\\,q_t)}{\\bar{w}_t}$$\n$$p_{t+1} = \\frac{p_t(1+s\\,q_t)}{\\bar{w}_t}$$\n代入 $\\bar{w}_t$ 的表达式，我们得到最终的遗传更新方程：\n$$p_{t+1} = \\frac{p_t(1+s\\,q_t)}{1 + s\\,q_t(2p_t - p_t^2)}$$\n\n**3. 模拟算法**\n\n每个测试案例的模拟将进行 $T=400$ 个世代。\n1.  初始化两个长度为 $T+1$ 的数组 `p` 和 `q`，用于存储状态历史。\n2.  设置初始条件：`p[0] = p_0` 和 `q[0] = 0`。\n3.  在乳制品业开始之前，动态是静止的。对于从 $0$ 到 $g_{\\mathrm{on}}-1$ 的所有世代 $t$，状态保持为 $(p_0, 0)$。我们可以计算上跳过这个时期，并为 $t \\in \\{1, \\dots, g_{\\mathrm{on}}-1\\}$ 设置 `p[t] = p_0` 和 `q[t] = 0$。\n4.  在第 $t=g_{\\mathrm{on}}$ 代，文化性状被引入：设置 `q[g_on] = q_\\varepsilon`。遗传状态仍然是 `p[g_on] = p_0`。\n5.  从 $g_{\\mathrm{on}}$ 到 $T-1$ 对 $t$ 进行迭代：\n    a. 从历史数组中检索当前状态 $(p_t, q_t)$：`p_t = p[t]`，`q_t = q[t]`。\n    b. 使用推导出的更新方程计算下一个状态 $(p_{t+1}, q_{t+1})$。\n    c. 将新状态存储在历史数组中：`p[t+1] = p_{t+1}`，`q[t+1] = q_{t+1}`。\n6.  循环完成后，生成了完整的历史记录 $\\{p_t\\}_{t=0}^{T}$ 和 $\\{q_t\\}_{t=0}^{T}$。\n7.  最终值 $p_T$ 和 $q_T$ 从 `p[T]` 和 `q[T]` 中读取。\n8.  通过搜索完整的 `p` 和 `q` 数组，找到各自阈值（$p^\\star=0.6$, $q^\\star=0.8$）首次被达到或超过的索引，从而得到阈值穿越时间 $t_{p^\\star}$ 和 $t_{q^\\star}$。如果从未达到阈值，则记录值为 $-1$。\n\n这个过程是确定性的，并将为四个指定的测试案例分别实施。", "answer": "```\n[0.999650,0.999988,277,129,0.994645,0.999648,387,256,0.050000,0.999999,-1,99,0.010000,0.000000,-1,-1]\n```", "id": "2716366"}]}