{"hands_on_practices": [{"introduction": "有效种群大小 ($N_e$) 是理解种群历史中遗传漂变影响的核心概念。本练习旨在实践如何应用中性理论的基本公式，利用现代基因组数据来估算古代人类种群的长时程有效种群大小，这是群体遗传学中一项基本而重要的技能 [@problem_id:2724541]。通过这个计算，我们将探索理论预测与从真实或模拟数据中获得的经验观察之间的联系。", "problem": "一个研究团队正在研究晚更新世时期解剖学意义上的现代人祖先群体的长期人口史。他们从常染色体上假定中性的基因间区域获得了全基因组数据，并估计了全基因组范围的核苷酸多样性（随机抽样的两条染色体之间每个位点的成对差异），记作 $\\pi$，其值为 $\\pi = 0.001$。独立的基于谱系的研究提供了一个每个位点、每一代的突变率 $\\mu = 1.25 \\times 10^{-8}$。\n\n假设一个随机交配的二倍体群体处于突变-漂变平衡状态，具有恒定的长期有效群体大小，其中突变遵循无限位点模型，并且所分析位点上的选择可以忽略不计。仅使用这些假设以及核苷酸多样性和有效群体大小的核心定义，推导出从 $\\pi$ 和 $\\mu$ 估算常染色体长期有效群体大小 $N_{e}$ 所需的关系式，计算点估计值，并简要解释为什么在人族谱系中，这样的 $N_{e}$ 会与普查规模不同。\n\n提供您的 $N_{e}$ 数值估计，四舍五入到两位有效数字，并以个体数为单位报告。您最终报告的答案必须是一个数字。", "solution": "问题陈述经过验证，被认为是有效的。这是一个群体遗传学中定义明确的问题，基于成熟的理论原理——即分子进化的中性理论和溯祖理论。唯一解所需的所有参数和假设均已提供，不存在科学或逻辑上的矛盾。\n\n目标是从全基因组核苷酸多样性 $\\pi$ 和每代突变率 $\\mu$ 估算常染色体长期有效群体大小 $N_e$。所给的假设是一个随机交配的二倍体群体，处于突变-漂变平衡状态，具有恒定的 $N_e$，遵循无限位点突变模型且无选择。\n\n核苷酸多样性 $\\pi$ 定义为从一个群体中随机抽样的两个序列（染色体）之间每个位点的平均成对差异数。为了推导 $\\pi$、$N_e$ 和 $\\mu$ 之间的关系，我们考虑从一个有效大小为 $N_e$ 的当前二倍体群体中随机抽样的两个基因谱系。\n\n根据适用于二倍体群体的 Wright-Fisher 模型的溯祖理论，这两个谱系在前一代发生合并（即找到它们最近的共同祖先）的概率由 $\\frac{1}{2N_e}$ 给出。合并时间 $T_2$ 服从以此成功概率为参数的几何分布。因此，这两个谱系到最近共同祖先的期望时间是该概率的倒数：\n$$E[T_2] = \\frac{1}{\\frac{1}{2N_e}} = 2N_e \\text{ generations}$$\n\n假设突变以每位点、每代 $\\mu$ 的速率发生。在无限位点模型下，每个新突变都发生在一个以前不是多态性的位点上。因此，两个序列之间的核苷酸差异数是自从它们从共同祖先分化以来，在两个谱系上累积的突变总数。\n\n分隔两个采样染色体的总时间是通向它们共同祖先的两个分支长度之和。这个总分支长度是 $2T_2$。期望总分支长度是 $E[2T_2] = 2 E[T_2] = 2(2N_e) = 4N_e$ 代。\n\n分隔两个谱系的每位点期望突变数是总突变机会（以代为单位的总期望分支长度）与每代突变率的乘积。根据定义，这个量就是核苷酸多样性 $\\pi$。\n$$\\pi = (2 \\mu) \\times E[T_2]$$\n或者，更直接地：\n$$\\pi = \\mu \\times E[\\text{total branch length}] = \\mu \\times (4N_e)$$\n因此，在这些假设下的基本关系是：\n$$\\pi = 4N_e\\mu$$\n\n现在我们可以求解有效群体大小 $N_e$：\n$$N_e = \\frac{\\pi}{4\\mu}$$\n\n问题提供了以下数值：\n核苷酸多样性，$\\pi = 0.001$。\n突变率，$\\mu = 1.25 \\times 10^{-8}$ 每位点每代。\n\n将这些值代入推导出的方程：\n$$N_e = \\frac{0.001}{4 \\times (1.25 \\times 10^{-8})}$$\n首先，我们计算分母：\n$$4 \\times 1.25 \\times 10^{-8} = 5.0 \\times 10^{-8}$$\n现在，我们进行除法运算：\n$$N_e = \\frac{10^{-3}}{5.0 \\times 10^{-8}} = \\frac{1}{5.0} \\times 10^{-3 - (-8)} = 0.2 \\times 10^5 = 20000$$\n问题要求将估计值四舍五入到两位有效数字。计算出的值恰好是 $20000$，可以表示为 $2.0 \\times 10^4$ 以表示两位有效数字。\n\n最后，需要简要解释为什么在人族谱系中，有效群体大小 ($N_e$) 会与普查规模 ($N_c$) 不同。有效群体大小是一个理想化的概念，代表了一个会经历与实际群体相同程度遗传漂变的 Wright-Fisher 群体的大小。在现实中，由于违反了理想模型的假设，$N_e$ 几乎总是小于普查规模 $N_c$（个体的实际数量）。对于人族谱系，关键因素包括：\n$1$. **繁殖成功率的变异：** 如果个体间的后代数量存在高方差，其中一些个体对下一代的贡献不成比例地更大（例如，由于社会结构或性选择），遗传漂变会加速，$N_e$ 会减小。\n$2$. **性别比例不均：** 繁殖雄性与繁殖雌性的比例失衡会降低 $N_e$。有效大小对数量较少的性别的数量很敏感，如公式 $N_e = \\frac{4N_m N_f}{N_m + N_f}$ 所示。对于各种人族群体来说，一夫多妻制或一妻多夫制的交配系统是可能的，这会导致 $N_e  N_c$。\n$3$. **群体规模的波动：** 长期有效大小由群体规模随时间的调和平均数决定。该平均数受小群体规模时期（瓶颈）的严重影响。人族历史，特别是 *Homo sapiens* 的历史，以人口瓶颈为特征，例如与“走出非洲”迁徙相关的瓶颈，这将相对于任何特定时间的普查规模，极大地减少长期 $N_e$。", "answer": "$$\\boxed{2.0 \\times 10^4}$$", "id": "2724541"}, {"introduction": "ABBA-BABA检验和帕特森$D$统计量是揭示古人类与现代人类之间基因流动的强大工具，这一发现重塑了我们对人类演化的理解。本练习将指导您完成一个真实世界分析的模拟过程：从位点模式计数中计算$D$统计量，并使用区块自助法（block-jackknife）评估其统计显著性 [@problem_id:2724590]。这项实践对于任何希望分析古代DNA以检测基因渗入的研究者来说都是至关重要的。", "problem": "考虑一个应用于古人类系统发育的、使用 ABBA-BABA 框架的四分类单元基因流检验：群体 $P_1$ 是一个西非群体（Yoruba），群体 $P_2$ 是一个欧洲群体，群体 $P_3$ 是一个高覆盖度的尼安德特人（Neanderthal）基因组，而 $O$ 是作为外群的黑猩猩（Chimpanzee），用于确定衍生等位基因的极性。假设位点是双等位基因的，祖先状态极性确定正确，并且通过将基因组划分为 $20$ 个长度大致相等、不重叠的区块来解释连锁不平衡。在所有信息性位点中，全基因组的位点模式计数为 $ABBA = 120$ 和 $BABA = 80$。提供了逐区块的“留一法”刀切法贡献，定义为 $v_i = \\left(D_{(i)} - \\bar{D}\\right)^2$，其中 $D_{(i)}$是 Patterson’s $D$-统计量的“留一法”估计量，$\\bar{D}$ 是 $D_{(i)}$ 在 $20$ 个区块中的平均值。$20$ 个 $v_i$ 的值为：\n$$\n\\{\\,1.0 \\times 10^{-4},\\, 1.2 \\times 10^{-4},\\, 1.5 \\times 10^{-4},\\, 9.0 \\times 10^{-5},\\, 1.4 \\times 10^{-4},\\, 1.3 \\times 10^{-4},\\, 1.1 \\times 10^{-4},\\, 1.6 \\times 10^{-4},\\, 1.2 \\times 10^{-4},\\, 1.4 \\times 10^{-4},\\, 1.3 \\times 10^{-4},\\, 1.1 \\times 10^{-4},\\, 1.7 \\times 10^{-4},\\, 1.0 \\times 10^{-4},\\, 1.3 \\times 10^{-4},\\, 1.2 \\times 10^{-4},\\, 1.4 \\times 10^{-4},\\, 2.2 \\times 10^{-4},\\, 1.5 \\times 10^{-4},\\, 1.1 \\times 10^{-4}\\,\\}.\n$$\n从适用于此背景下进化推断的基本原理出发，根据计数计算全基因组的 Patterson's $D$-统计量，使用这 $20$ 个区块构建 $D$ 的区块刀切法标准误，然后计算相应的双侧正态近似 $Z$-分数，以检验无过量等位基因共享（即无不对称基因流）的原假设。使用广泛采纳的标准，即在此背景下 $|Z| \\ge 3$ 表示具有统计学意义，并从生物学角度解释结果，即 $P_2$ 和 $P_3$ 相对于 $P_1$ 的过量等位基因共享。以四位有效数字的形式报告 $Z$-分数作为最终数值答案。将 $Z$-分数表述为无量纲量。", "solution": "问题陈述经过验证。\n\n**第一步：提取给定信息**\n- 群体：$P_1$ (Yoruba)，$P_2$ (欧洲人)，$P_3$ (Neanderthal)，$O$ (Chimpanzee 外群)。这定义了系统发育关系为 $((P_1, P_2), P_3), O$。\n- 检验框架：用于基因流检验的 ABBA-BABA 测试。\n- 假设：双等位基因位点，正确的祖先状态极性确定，通过将基因组划分为 $n=20$ 个不重叠的区块来解释连锁不平衡。\n- 全基因组位点模式计数：$C_{ABBA} = 120$ 和 $C_{BABA} = 80$。\n- 区塊刀切法数据：区块数量为 $n=20$。提供了“留一法”贡献 $v_i = (D_{(i)} - \\bar{D})^2$，$i=1, \\dots, 20$。\n- $v_i$ 值的集合是 $\\{1.0 \\times 10^{-4}, 1.2 \\times 10^{-4}, 1.5 \\times 10^{-4}, 9.0 \\times 10^{-5}, 1.4 \\times 10^{-4}, 1.3 \\times 10^{-4}, 1.1 \\times 10^{-4}, 1.6 \\times 10^{-4}, 1.2 \\times 10^{-4}, 1.4 \\times 10^{-4}, 1.3 \\times 10^{-4}, 1.1 \\times 10^{-4}, 1.7 \\times 10^{-4}, 1.0 \\times 10^{-4}, 1.3 \\times 10^{-4}, 1.2 \\times 10^{-4}, 1.4 \\times 10^{-4}, 2.2 \\times 10^{-4}, 1.5 \\times 10^{-4}, 1.1 \\times 10^{-4}\\}$。注意 $9.0 \\times 10^{-5}$ 可以写作 $0.9 \\times 10^{-4}$。\n- 任务：计算全基因组的 Patterson's $D$-统计量、区块刀切法标准误，以及用于检验无过量等位基因共享原假设的相应 $Z$-分数。\n- 显著性标准：$|Z| \\ge 3$。\n- 最终答案要求：以四位有效数字报告 $Z$-分数。\n\n**第二步：使用提取的给定信息进行验证**\n根据验证标准对问题进行评估。\n- **科学依据**：该问题在群体遗传学中有坚实的基础。Patterson's $D$-统计量（ABBA-BABA 测试）是一种用于检测古人类和其他系统发育中基因渗入的标准且广泛使用的方法。该群体配置是研究 Neanderthal 基因渗入到非非洲现代人群中的经典配置。\n- **良态问题**：该问题是良态的。它提供了计算所需量（$D$-统计量、标准误和 $Z$-分数）的所有必要数据（ABBA 和 BABA 模式的计数、区块数量以及刀切法方差分量 $v_i$）。目标明确，并能导出一个唯一的数值解。\n- **客观性**：问题以精确、客观、无偏见的科学语言陈述。\n- **完整性与一致性**：问题是自洽且内部一致的。提供的数据充分且不矛盾。$v_i$ 的值均为非负数，这与平方项的预期相符。\n\n**第三步：结论与行动**\n问题有效。将构建一个严谨的解答。\n\n**解答推导**\n该问题要求计算 Patterson's $D$-统计量、使用区块刀切法程序计算其标准误，以及由此产生的用于检验基因流的 $Z$-分数。\n\n原假设 $H_0$ 设定了一个严格的分支系统发育 $((P_1, P_2), P_3), O$，内群分支之间没有基因流。在此模型下，分类到 $P_1$、$P_2$ 和 $P_3$ 中的祖先多态性是谱系不一致的唯一来源。这个过程被称为不完全谱系分选（ILS），预计会以相等的频率产生‘ABBA’和‘BABA’这两种衍生位点模式。这里，‘A’表示祖先等位基因（与外群 $O$ 中相同），‘B’表示衍生等位基因。\n\n‘ABBA’模式的过量（其中 $P_2$ 和 $P_3$ 共享衍生等位基因）表明它们之间存在基因流。反之，‘BABA’模式的过量（其中 $P_1$ 和 $P_3$ 共享衍生等位基因）则表明它们之间存在基因流。\n\nPatterson's $D$-统计量用于量化这些位点模式计数的不对称性。其定义为：\n$$\nD = \\frac{\\sum_j (C_{ABBA,j} - C_{BABA,j})}{\\sum_j (C_{ABBA,j} + C_{BABA,j})}\n$$\n其中 $C_{ABBA,j}$ 和 $C_{BABA,j}$ 是位点 $j$ 的位点模式的指示变量。对于全基因组计数，这简化为：\n$$\nD = \\frac{N_{ABBA} - N_{BABA}}{N_{ABBA} + N_{BABA}}\n$$\n其中 $N_{ABBA}$ 和 $N_{BABA}$ 分别是相应模式的总计数。\n\n使用提供的数据，$N_{ABBA} = 120$ 和 $N_{BABA} = 80$，全基因组 $D$-统计量为：\n$$\nD = \\frac{120 - 80}{120 + 80} = \\frac{40}{200} = 0.2\n$$\n$D$ 的正值表示‘ABBA’位点的过量，表明群体 $P_2$（欧洲人）和 $P_3$（Neanderthal）之间存在过量的等位基因共享。\n\n为了评估这个偏差相对于原假设期望值（$D=0$）的统计学意义，我们必须计算估计的标准误 $SE_D$。问题指定了对 $n=20$ 个区块进行区块刀切法程序。刀切法估计的标准误公式为：\n$$\nSE_D = \\sqrt{\\frac{n-1}{n} \\sum_{i=1}^{n} (D_{(i)} - \\bar{D})^2}\n$$\n其中 $D_{(i)}$ 是移除第 $i$ 个区块后计算的 $D$-统计量，而 $\\bar{D}$ 是这 $n$ 个 $D_{(i)}$ 值的平均值。问题直接提供了量 $v_i = (D_{(i)} - \\bar{D})^2$。因此，我们首先需要计算这些值的总和。给出了 $v_i$ 的值，其中一个是 $9.0 \\times 10^{-5} = 0.9 \\times 10^{-4}$。总和 $\\sum_{i=1}^{20} v_i$ 是：\n$$\n\\sum_{i=1}^{20} v_i = (1.0 + 1.2 + 1.5 + 0.9 + 1.4 + 1.3 + 1.1 + 1.6 + 1.2 + 1.4 + 1.3 + 1.1 + 1.7 + 1.0 + 1.3 + 1.2 + 1.4 + 2.2 + 1.5 + 1.1) \\times 10^{-4}\n$$\n$$\n\\sum_{i=1}^{20} v_i = 26.4 \\times 10^{-4}\n$$\n现在，将这个总和代入标准误公式，其中 $n=20$：\n$$\nSE_D = \\sqrt{\\frac{20-1}{20} \\sum_{i=1}^{20} v_i} = \\sqrt{\\frac{19}{20} \\times (26.4 \\times 10^{-4})}\n$$\n$$\nSE_D = \\sqrt{0.95 \\times 26.4 \\times 10^{-4}} = \\sqrt{25.08 \\times 10^{-4}}\n$$\n$SE_D \\approx 5.0079936 \\times 10^{-2}$。\n\n最后，我们计算 $Z$-分数。用于检验原假设 $H_0: D=0$ 的 $Z$-分数由估计值与其标准误的比值给出，假设根据中心极限定理，该估计量服从正态分布。\n$$\nZ = \\frac{D}{SE_D}\n$$\n代入计算出的值：\n$$\nZ = \\frac{0.2}{\\sqrt{25.08 \\times 10^{-4}}} \\approx \\frac{0.2}{0.050079936} \\approx 3.993615\n$$\n问题要求将 $Z$-分数四舍五入到四位有效数字。\n$$\nZ \\approx 3.994\n$$\n然后将这个 $Z$ 值与显著性阈值进行比较。问题陈述 $|Z| \\ge 3$ 表示具有统计学意义。由于 $|3.994| = 3.994 \\ge 3$，因此可以高置信度地拒绝无基因流的原假设。\n\n生物学解释是，与西非群体 ($P_1$) 相比，欧洲群体 ($P_2$) 和 Neanderthal 群体 ($P_3$) 之间存在统计上显著的共享衍生等位基因过量。这一结果为 Neanderthal 人在现代欧洲人祖先与现代西非人祖先分化后，向其注入基因（基因流）提供了有力证据。这与关于人类进化的既定科学共识是一致的。", "answer": "$$\n\\boxed{3.994}\n$$", "id": "2724590"}, {"introduction": "在检测到基因渗入后，下一个关键问题是阐明其发生的方式——是一次性的混合事件，还是长期的持续接触？本项高级练习通过连锁不平衡（LD）随遗传距离的衰减来探索这一问题，这一衰减模式可作为“混合时钟” [@problem_id:2724604]。您将通过设计一个模拟研究，来学习如何区分单次脉冲式混合与持续基因流这两种模式，从而培养在理论建模、计算机模拟和统计分类方面的综合能力。", "problem": "您被要求设计并实现一个可复现的模拟研究，通过利用连锁不平衡（LD; Linkage Disequilibrium）随遗传距离的衰减特性，来从算法上区分单次脉冲式混合与连续迁移。您的程序必须在每种人口情景下合成一条由混合引起的LD衰减曲线，拟合一个能够捕捉单次事件预期特征的简约模型，量化其失拟程度，然后分类判断该基础情景更符合单次脉冲还是连续迁移。所有遗传距离都必须视为以摩根（Morgans）为单位测量的遗传图单位，并且您模拟中的所有距离都必须以摩根表示。\n\n需要使用的基本原理：\n- 重组事件可以被建模为沿遗传图的泊松过程，两个相隔遗传距离 $d$ 的中性位点在代际间共同继承相同祖源片段的概率，是关于 $d$ 和迁入祖源进入群体的时代分布的单调递减函数。\n- 在单代中贡献固定比例的单次脉冲式混合，会产生长程的局域祖源相关性，这种相关性由一个横跨 $d$ 的单一特征衰减时间尺度所控制；而跨越多代的连续迁移则会产生来自许多进入时间的贡献的叠加，每个时间贡献其自身的时间尺度，从而导致衰减的混合。\n\n您的任务：\n1. 从第一性原理出发，推导在以下两种情景中，由混合引起的LD衰减信号作为遗传距离 $d$ 的函数的预期函数形式：\n   - 发生在 $t$ 代前的单次脉冲式混合。\n   - 在 $G$ 代内以恒定的每代速率 $m$ 发生的连续迁移。\n   在这两种情况下，您将模拟的信号是预期的衰减曲线，并且您将添加小的、乘性的对数正态噪声来模拟抽样噪声，同时保持其正性。\n\n2. 实现一个模拟器，给定一个遗传距离网格 $d \\in [0,0.5]$ 摩根，增量为 $0.01$ 摩根，使用推导出的函数形式为每种情景生成一条带噪声的衰减曲线。噪声模型必须是乘性对数正态的：对于每个 $d$，将理想曲线值乘以 $\\exp(\\epsilon)$，其中 $\\epsilon$ 是一个均值为零、标准差为 $0.004$（以自然对数单位计）的正态随机变量。使用固定的随机种子以确保精确的可复现性。\n\n3. 在对数空间中，通过普通最小二乘法拟合一个关于 $d$ 的单指数模型，即通过带截距的线性回归，将模拟曲线的对数值拟合为 $d$ 的一条直线。计算整个 $d$ 网格上残差在对数空间中的均方根误差（RMSE）。基于概念上的预期——单次脉冲产生单一特征时间尺度（在对数空间中是线性的），而连续迁移产生时间尺度的混合（在对数空间中是非线性的）——实现以下决策规则：如果RMSE超过阈值 $0.008$，则分类为“连续迁移”；否则分类为“单次脉冲”。将分类编码为整数：为“连续迁移”输出 $1$，为“单次脉冲”输出 $0$。\n\n4. 测试套件。您的程序必须按照这个确切的顺序评估以下六个参数集，使用与上述定义相同的距离网格和噪声模型：\n   - 情况A（单次脉冲）：$t = 5$。\n   - 情况B（单次脉冲）：$t = 40$。\n   - 情况C（连续迁移）：$m = 0.02$，$G = 50$。\n   - 情况D（连续迁移）：$m = 0.005$，$G = 200$。\n   - 情况E（边界条件，塌缩为单代的连续迁移）：$m = 0.3$，$G = 1$。\n   - 情况F（连续迁移）：$m = 0.05$，$G = 10$。\n\n5. 最终输出格式。您的程序应生成单行输出，包含A-F六种情况的整数分类，形式为逗号分隔的列表并用方括号括起来（例如，“[0,1,1,0,0,1]”）。不允许有其他输出。\n\n注意：\n- 您必须不假定任何外部文件或输入。所有值都必须嵌入在程序中。\n- 所有遗传距离均以摩根为单位。所需输出不涉及其他物理单位。\n- 每个测试用例的答案是如上指定的整数，最终输出必须以上述单行格式汇总它们。", "solution": "所述问题经过了严格的验证。所有提供的数据、原理和约束都已逐字提取。发现该问题在群体遗传学原理上具有科学依据，特别是在连锁不平衡因混合而衰减的理论方面。该问题是适定的，所有必要的参数和用于模拟与分类的清晰、客观的程序都已定义。问题没有矛盾、歧义和事实错误。它构成了一个有效且可形式化的科学问题。因此，有必要提供一个解决方案。\n\n问题的核心是通过分析连锁不平衡（LD）衰减曲线的形状，来区分两种人口历史：单次混合脉冲和连续迁移。其基本原理是，被建模为泊松过程的重组会随时间分解祖先染色体片段。这种分解的速率取决于自混合以来的时间以及位点间的遗传距离 $d$。\n\n**1. LD衰减模型的推导**\n\n我们推导预期的LD衰减信号（记为 $L(d)$）作为遗传距离 $d$（单位为摩根）的函数形式。\n\n**情景A：单次脉冲式混合**\n\n考虑一个发生在 $t$ 代前的单次脉冲式混合事件。来自迁移群体的染色体片段在此时被引入混合群体。对于两个遗传距离为 $d$ 的位点，其祖源的相关性取决于连接它们的片段在脉冲事件后的 $t$ 代中未被任何重组事件破坏的概率。\n\n在单次减数分裂中，长度为 $d$ 的片段不发生重组的概率是 $e^{-d}$。在 $t$ 个独立的减数分裂代中该片段保持完整的概率是 $(e^{-d})^t = e^{-td}$。由混合引起的LD信号与此存活概率成正比。因此，我们可以将衰减的函数形式写为：\n$$L_{\\text{pulse}}(d) = C_1 e^{-td}$$\n其中 $C_1$ 是一个依赖于混合比例的振幅常数。\n\n为了分析衰减的形状，我们可以归一化振幅。对此函数取自然对数，得到：\n$$\\log(L_{\\text{pulse}}(d)) = \\log(C_1) - td$$\n此方程关于 $d$ 是线性的，斜率为 $-t$，截距为 $\\log(C_1)$。这证实了前提，即单次脉冲事件导致简单的指数衰减，在对数空间中表现为一条直线。\n\n**情景B：连续迁移**\n\n考虑一个在过去 $G$ 代（从 $g=1$ 到 $g=G$ 代）内以恒定速率 $m$ 发生的连续迁移过程。在不同时间进入群体的迁移片段将经历不同代数的重组。一个在 $g$ 代前进入的片段对LD信号的贡献具有 $e^{-gd}$ 的衰减形式。\n\n总的LD信号是每一代迁移贡献的叠加或加权和。设 $w_g$ 是在第 $g$ 代进入的片段对观测到的LD的相对贡献。总信号为：\n$$L_{\\text{continuous}}(d) = C_2 \\sum_{g=1}^{G} w_g e^{-gd}$$\n问题没有指定权重 $w_g$。对于一个简化的“连续”流动模型，一个合理且标准的假设是，迁移期间的每一代对迁移片段池的贡献是均等的。这对应于均匀权重，$w_g = 1/G$ 对于 $g \\in \\{1, 2, \\dots, G\\}$。模型变为：\n$$L_{\\text{continuous}}(d) = C_2 \\frac{1}{G} \\sum_{g=1}^{G} e^{-gd}$$\n这是一个具有不同衰减率的多个指数函数的和。结果函数不是单一的指数函数。它的对数 $\\log(L_{\\text{continuous}}(d))$ 不是 $d$ 的线性函数。这个和是一个几何级数，可以写成闭合形式：\n$$\\sum_{g=1}^{G} (e^{-d})^g = e^{-d} \\frac{1 - e^{-Gd}}{1 - e^{-d}}$$\n因此：\n$$L_{\\text{continuous}}(d) = C_2 \\frac{e^{-d}(1 - e^{-Gd})}{G(1 - e^{-d})}$$\n当用线性模型拟合 $\\log(L_{\\text{continuous}}(d))$ 时，其固有的曲率将导致显著的模型设定错误，这可以通过残差的均方根误差（RMSE）来量化。\n\n**2. 模拟与分类程序**\n\n分析将按以下算法步骤进行：\n\n1.  **定义网格**：建立一个从 $0$ 到 $0.5$ 摩根的遗传距离 $d$ 网格，增量为 $0.01$ 摩根。这会产生 $N=51$ 个数据点。\n\n2.  **模拟衰减曲线**：对于每个测试用例，使用适当的推导公式（单次脉冲或连续迁移）和单位振幅（$C_1=C_2=1$）生成理想的衰减曲线 $L_{\\text{ideal}}(d)$。\n    -   单次脉冲：$L(d) = e^{-td}$\n    -   连续迁移：$L(d) = \\frac{1}{G} \\sum_{g=1}^{G} e^{-gd}$\n    然后通过引入乘性对数正态噪声来生成带噪声的模拟曲线 $L_{\\text{sim}}(d)$：\n    $$L_{\\text{sim}}(d_i) = L_{\\text{ideal}}(d_i) \\cdot \\exp(\\epsilon_i)$$\n    其中 $\\epsilon_i$ 是来自正态分布 $\\mathcal{N}(0, \\sigma^2)$ 的独立样本，$\\sigma = 0.004$。使用固定的随机种子以确保可复现性。\n\n3.  **执行线性回归**：对模拟数据进行对数转换，$z_i = \\log(L_{\\text{sim}}(d_i))$。执行普通最小二乘线性回归，将模型 $z(d) = \\beta_0 + \\beta_1 d$ 拟合到转换后的数据点 $(d_i, z_i)$。这会找到最佳拟合直线。\n\n4.  **量化拟合优度**：计算残差在对数空间中的均方根误差（RMSE）。残差为 $r_i = z_i - (\\hat{\\beta}_0 + \\hat{\\beta}_1 d_i)$，其中 $\\hat{\\beta}_0$ 和 $\\hat{\\beta}_1$ 是估计的回归系数。RMSE为：\n    $$RMSE = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} r_i^2}$$\n    对于真实的单脉冲情景，残差 $r_i$ 仅由噪声项 $\\epsilon_i$ 产生，因此RMSE预期接近 $\\sigma = 0.004$。对于连续迁移情景，残差还包括将直线拟合到曲线所产生的系统误差，导致RMSE显著增大。\n\n5.  **分类情景**：根据计算出的RMSE和预定义的阈值做出决策：\n    -   如果 $RMSE  0.008$：较大的误差表明存在非线性，这是连续迁移的特征。该情况被分类为“连续迁移”（输出 $1$）。\n    -   如果 $RMSE \\leq 0.008$：较小的误差与线性一致，这是单次脉冲的特征。该情况被分类为“单次脉冲”（输出 $0$）。\n\n此程序将应用于六个指定的测试用例中的每一个，以确定其分类。$G=1$ 代的连续迁移边界情况预期与 $t=1$ 的单次脉冲表现完全相同，这为模型的自洽性提供了一个关键检验。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Designs and implements a simulation to distinguish single pulse from continuous migration\n    based on linkage disequilibrium decay, as specified in the problem statement.\n    \"\"\"\n    \n    # Define the six test cases as per the problem statement\n    test_cases = [\n        {'type': 'pulse', 'params': {'t': 5}, 'label': 'A'},\n        {'type': 'pulse', 'params': {'t': 40}, 'label': 'B'},\n        {'type': 'continuous', 'params': {'m': 0.02, 'G': 50}, 'label': 'C'},\n        {'type': 'continuous', 'params': {'m': 0.005, 'G': 200}, 'label': 'D'},\n        {'type': 'continuous', 'params': {'m': 0.3, 'G': 1}, 'label': 'E'},\n        {'type': 'continuous', 'params': {'m': 0.05, 'G': 10}, 'label': 'F'}\n    ]\n\n    # Global parameters for the simulation\n    d = np.arange(0.0, 0.501, 0.01) # Genetic distance grid from 0 to 0.5 Morgans\n    sigma_noise = 0.004 # Standard deviation of log-normal noise\n    rmse_threshold = 0.008 # Decision threshold for classification\n    \n    # Set a fixed random seed for reproducibility\n    np.random.seed(0)\n\n    results = []\n\n    for case in test_cases:\n        # 1. Generate the ideal LD decay curve\n        if case['type'] == 'pulse':\n            t = case['params']['t']\n            # Functional form for single pulse: L(d) = exp(-t*d)\n            y_ideal = np.exp(-t * d)\n        elif case['type'] == 'continuous':\n            G = case['params']['G']\n            # Parameter m is not used for the decay shape, only G matters.\n            # Functional form for continuous migration: L(d) = 1/G * sum_{g=1 to G} exp(-g*d)\n            # Vectorized implementation for efficiency:\n            g_gens = np.arange(1, G + 1).reshape(-1, 1) # Generations as a column vector\n            d_grid = d.reshape(1, -1)                  # Distances as a row vector\n            matrix_gd = g_gens @ d_grid                # Outer product g*d\n            exp_matrix = np.exp(-matrix_gd)\n            y_ideal = np.mean(exp_matrix, axis=0) # Average over generations\n        else:\n            # This path should not be reached with the given test cases\n            raise ValueError(f\"Unknown case type: {case['type']}\")\n\n        # 2. Add multiplicative log-normal noise\n        noise = np.random.normal(loc=0.0, scale=sigma_noise, size=len(d))\n        y_sim = y_ideal * np.exp(noise)\n\n        # 3. Fit a linear model in log space\n        log_y_sim = np.log(y_sim)\n        \n        # OLS linear regression (degree 1 polynomial fit)\n        # coeffs[0] is the slope, coeffs[1] is the intercept\n        coeffs = np.polyfit(d, log_y_sim, 1)\n        y_fit = coeffs[0] * d + coeffs[1]\n        \n        # 4. Compute RMSE of the residuals\n        residuals = log_y_sim - y_fit\n        rmse = np.sqrt(np.mean(residuals**2))\n\n        # 5. Classify based on the RMSE threshold\n        classification = 1 if rmse > rmse_threshold else 0\n        results.append(classification)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "2724604"}]}