{"hands_on_practices": [{"introduction": "理解分化基因组岛的第一步是掌握衡量群体分化的核心指标。这项练习将引导您从群体内的核苷酸多样性（$\\pi$）和群体间的绝对分歧（$d_{XY}$）出发，亲手计算关键的相对分化指标——固定指数（$F_{ST}$）。通过这个基础计算，您将能更深刻地理解总遗传变异是如何在群体内和群体间分配的，为后续更复杂的分析奠定坚实的基础。", "problem": "在基因组分化岛的研究中，一个核心目标是量化一个基因组窗口内观察到的核苷酸变异在多大程度上反映了种群间的分化，以及在多大程度上反映了种群内部维持的多态性。考虑在无限位点突变模型下，于一个无重组的基因组窗口中采样的两个种群，其单位点突变率低且无测序错误。令 $d_{XY}$ 表示从种群 $X$ 中随机抽取的一条序列与从种群 $Y$ 中随机抽取的一条序列之间每位点的平均核苷酸差异数（绝对分化）。令 $\\pi_{i}$ 表示从种群 $i \\in \\{1,2\\}$ 中随机抽取的两条序列之间每位点的平均核苷酸差异数（种群内核苷酸多样性），并令 $\\bar{\\pi}$ 为种群内核苷酸多样性的跨种群平均值，定义为 $\\bar{\\pi} = (\\pi_{1} + \\pi_{2})/2$。将净分子分化定义为 $D_{a} = d_{XY} - \\bar{\\pi}$，这移除了种群间共享的分离变异的贡献。并将该窗口的固定指数（$F_{ST}$）定义为每位点总的种群间分化中可归因于净分化的部分，即种群间组分与总量的比率。\n \n从这些定义出发，并且不引用任何额外的摘要统计公式，推导出一个用 $d_{XY}$ 和 $\\bar{\\pi}$ 表示 $F_{ST}$ 的表达式。然后，对于一个特定的基因组窗口，其 $\\pi_{1} = 0.008$，$\\pi_{2} = 0.004$，$d_{XY} = 0.012$，计算 $F_{ST}$ 并陈述其值。提供精确值（不要四舍五入）。最后，在基因组分化岛的背景下，简要解释该 $F_{ST}$ 值的大小对于此窗口的分化意味着什么。你的最终数值答案必须仅为 $F_{ST}$ 的值，该值是无量纲的。", "solution": "所陈述的问题具有科学依据、是良定的，并包含了唯一解所需的所有定义和数据。核苷酸多样性($\\pi$)、绝对分化($d_{XY}$)、净分化($D_a$)和固定指数($F_{ST}$)的定义是群体遗传学领域的标准定义。因此，该问题被认为是有效的，并将提供解答。\n\n该问题要求一个三部分的答案：首先，推导 $F_{ST}$ 的公式；其次，根据给定数据对 $F_{ST}$ 进行数值计算；第三，对结果进行简要解释。\n\n首先，我们推导 $F_{ST}$ 的表达式。问题将 $F_{ST}$ 定义为“种群间组分与总量的比率”。它进一步指明“种群间组分”是净分子分化 $D_a$，而“总量”组分是每位点总的种群间分化。这个总分化恰好被定义为 $d_{XY}$，即从种群 $X$ 的一条序列和种群 $Y$ 的一条序列之间的平均差异数。因此，$F_{ST}$ 的数学表达式是净分化与绝对分化的比率：\n$$F_{ST} = \\frac{D_a}{d_{XY}}$$\n问题还提供了净分子分化 $D_a$ 的定义：\n$$D_a = d_{XY} - \\bar{\\pi}$$\n其中 $\\bar{\\pi}$ 是平均种群内核苷酸多样性。通过将 $D_a$ 的表达式代入 $F_{ST}$ 的公式中，我们推导出用给定数量 $d_{XY}$ 和 $\\bar{\\pi}$ 表示的 $F_{ST}$ 的最终表达式：\n$$F_{ST} = \\frac{d_{XY} - \\bar{\\pi}}{d_{XY}}$$\n这可以等价地写成 $F_{ST} = 1 - \\frac{\\bar{\\pi}}{d_{XY}}$，它表示总分化($d_{XY}$)中不能由平均种群内多样性($\\bar{\\pi}$)解释的比例。\n\n其次，我们计算 $F_{ST}$ 的数值。提供的数据如下：\n种群1的种群内多样性：$\\pi_{1} = 0.008$\n种群2的种群内多样性：$\\pi_{2} = 0.004$\n种群1和2之间的绝对分化：$d_{XY} = 0.012$\n\n我们首先根据其定义计算平均种群内多样性 $\\bar{\\pi}$：\n$$\\bar{\\pi} = \\frac{\\pi_{1} + \\pi_{2}}{2} = \\frac{0.008 + 0.004}{2} = \\frac{0.012}{2} = 0.006$$\n现在，我们将 $d_{XY}$ 的数值和计算出的 $\\bar{\\pi}$ 代入我们推导出的 $F_{ST}$ 公式中：\n$$F_{ST} = \\frac{d_{XY} - \\bar{\\pi}}{d_{XY}} = \\frac{0.012 - 0.006}{0.012} = \\frac{0.006}{0.012}$$\n这简化为精确值：\n$$F_{ST} = 0.5$$\n\n第三，我们解释这个 $F_{ST}$ 值的大小。固定指数 $F_{ST}$ 衡量种群间的遗传分化程度，其理论范围从 $0$（无分化）到 $1$（完全分化，此时种种群对不同的等位基因达到固定）。$F_{ST}$ 值为 $0.5$ 表明，在这两个种群的这个基因组窗口观察到的总核苷酸分化中，恰好有一半（$50\\%$）是由净分化引起的——即那些已经固定或在它们之间存在高频率差异的核苷酸替换。另一半则可归因于仍在种群内分离的多态性。在寻找基因组分化岛的过程中，$F_{ST}$ 为 $0.5$ 是一个很高的值，表示显著的分化。这表明这个特定的基因组窗口正在经历诸如分化性自然选择或严重受限的基因流等力量，这些力量在遗传上将种群分离开来，其程度远超基因组中的平均区域（“基因组海洋”）。", "answer": "$$\\boxed{0.5}$$", "id": "2718661"}, {"introduction": "在计算出分化指标后，下一步关键是进行准确的生物学解释。这项练习 [@problem_id:2718691] 提出了一个典型的群体基因组学场景，挑战了将高 $F_{ST}$ 峰简单等同于基因流屏障的看法。通过辨析，您将学会如何利用绝对分歧（$d_{XY}$）和群体内核苷酸多样性（$\\pi$）的模式，来区分由局部基因流受阻形成的“真正”分化岛，和由连锁选择效应（如背景选择）导致的“伪”信号。", "problem": "对单一物种的两个种群 $X$ 和 $Y$ 进行了取样和测序，得到了在非重叠窗口中全染色体范围内的成对分化和多样性总结数据。在整个染色体上，种群间的绝对序列分化 $d_{XY}$ 大约恒定为每个位点 $0.012$ 个差异。然而，在一个大小为 $200\\,\\mathrm{kb}$ 的焦点窗口中，固定指数 $F_{ST}$ 升高至 $0.35$，而染色体范围内的 $F_{ST}$ 中位数为 $0.12$。焦点窗口内的种群内核苷酸多样性相对于染色体背景有所降低（例如，焦点窗口中 $\\pi_X \\approx 0.0012$, $\\pi_Y \\approx 0.0010$，而全基因组中位数为 $\\pi_X \\approx 0.0045$, $\\pi_Y \\approx 0.0044$）。假设沿染色体的中性突变率 $\\mu$ 大致均匀，并且窗口足够大，可以用较低的取样方差来估计汇总统计量。\n\n仅使用群体遗传学的基本定义（例如，$F_{ST}$ 定义为种群内和总杂合度之比，$d_{XY}$ 解释为种群间绝对分化，以及基因流和连锁选择对这些数量的定性影响），判断焦点窗口是否为真正的局部基因流屏障提供了证据。选择支持最充分的唯一推论及其理由。\n\nA. 焦点窗口构成了一个真正的基因流屏障，因为高 $F_{ST}$ 直接表明迁移受限，而 $d_{XY}$ 的恒定性与检测屏障无关。\n\nB. 焦点窗口不支持真正的基因流屏障；$F_{ST}$ 升高而 $d_{XY}$ 恒定的现象最好解释为种群内多样性降低（例如，低重组区域中的连锁选择）夸大了相对分化，而真正的屏障应该使 $d_{XY}$ 高于背景水平。\n\nC. 焦点窗口构成了一个真正的基因流屏障，因为恒定的 $d_{XY}$ 证实了均匀的突变率，所以高 $F_{ST}$ 必然源于对迁入者的选择，而非其他过程。\n\nD. 数据不足以评估屏障状态；没有明确的重组图谱，即使 $d_{XY}$ 恒定，也无法解释 $F_{ST}$ 或 $d_{XY}$ 的模式。\n\nE. 焦点窗口不支持真正的基因流屏障，因为背景选择预期会降低 $F_{ST}$，所以焦点窗口的 $F_{ST}$ 峰值很可能反映的是技术伪影而不是生物过程。", "solution": "必须首先严格验证问题陈述。\n\n### 第 1 步：提取已知条件\n- 种群：单一物种的两个种群 $X$ 和 $Y$。\n- 数据：非重叠窗口中全染色体范围内的成对分化和多样性总结。\n- 绝对分化：在整个染色体上，$d_{XY}$ 大约恒定为每个位点 $0.012$ 个差异。\n- 焦点窗口大小：$200\\,\\mathrm{kb}$。\n- 焦点窗口固定指数：$F_{ST} = 0.35$。\n- 染色体范围内的中位固定指数：$F_{ST} = 0.12$。\n- 焦点窗口核苷酸多样性：$\\pi_X \\approx 0.0012$, $\\pi_Y \\approx 0.0010$。\n- 全基因组中位核苷酸多样性：$\\pi_X \\approx 0.0045$, $\\pi_Y \\approx 0.0044$。\n- 假设 1：沿染色体的中性突变率 $\\mu$ 大致均匀。\n- 假设 2：窗口足够大，取样方差较低。\n- 问题：判断焦点窗口是否为真正的局部基因流屏障提供了证据。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题定义明确，并在群体基因组学领域有科学依据。所提供的统计数据——绝对分化（$d_{XY}$）、核苷酸多样性（$\\pi$）和固定指数（$F_{ST}$）——是用于推断进化过程的标准度量。这些数值本身对于许多正在分化的种群来说是符合实际的。所描述的场景，即高相对分化（$F_{ST}$）的“基因组岛”伴随着绝对分化（$d_{XY}$）和种群内多样性（$\\pi$）的特定模式，是进化生物学中研究和理论建模的经典课题。该问题要求基于基本定义来解释这些模式，这是一项标准的科学练习。该问题是自洽的，其前提在群体遗传学模型的背景下是事实正确的，并且没有歧义或矛盾。\n\n### 第 3 步：结论和行动\n问题陈述有效。我将继续提供完整解答。\n\n### 推导\n问题的核心是区分两种可以产生“分化基因组岛”（$F_{ST}$ 升高区域）的主要假说：\n1.  真正的、局部的基因流屏障（例如，由于涉及生殖隔离的基因座）。\n2.  基因组某一区域连锁选择（正选择或背景选择）的影响，通常与低重组率相关。\n\n为了评估这些假说，我们必须考虑关键汇总统计量的精确定义和预期行为。\n\n-   **绝对分化 ($d_{XY}$)**: 该统计量衡量从种群 $X$ 和种群 $Y$ 中各随机选择一条序列之间的平均核苷酸差异数。在一个简单模型中，$d_{XY}$ 与这样一对序列到最近共同祖先的平均时间（$T_{MRCA}$）成正比。真正的、位点特异性的基因流屏障意味着在这个特定位点上的迁入等位基因会受到选择性清除，从而局部降低了有效的基因交换率。这将导致在该位点从两个种群中取样的谱系在更长的时间内保持分离，使其 $T_{MRCA}$ 相对于基因流较高的基因组其他部分增加。因此，一个真正的基因流屏障预期会在屏障位点产生一个明显的 $d_{XY}$ **峰值**。问题陈述 $d_{XY}$ 在整个染色体上大致恒定。这一证据直接与对真正局部屏障的预测相矛盾。\n\n-   **种群内多样性 ($\\pi$)**: 该指标衡量从*同一*种群中取样的两条序列之间的平均核苷酸差异数。它对影响该种群内整个谱系的局部力量很敏感，最显著的是选择。一次选择性清除（对新有利突变的强正选择）或背景选择（对复发有害突变的纯化选择）会降低连锁中性位点所经历的有效种群大小，从而清除变异并导致局部出现一个 $\\pi$ 的**低谷**。数据显示，在焦点窗口中 $\\pi_X$ 和 $\\pi_Y$ 確實显著降低（例如，从约 $0.0045$ 降至约 $0.0012$）。\n\n-   **固定指数 ($F_{ST}$)**: 这是一个*相对*分化的度量。一个常见且直观的定义将其与其他统计量联系起来：$F_{ST} = 1 - \\pi_S / \\pi_T$，其中 $\\pi_S$ 是平均种群内多样性（此处为 $(\\pi_X+\\pi_Y)/2$），$\\pi_T$ 是总多样性，包括种群内和种群间的差异。在许多情况下，一个有用的近似公式是 $F_{ST} \\approx 1 - \\pi_S/d_{XY}$。这种比率结构至关重要。$F_{ST}$ 的升高既可能是由于种群间分化增加（$d_{XY}$ 增加），也可能是由于种群内多样性降低（$\\pi_S$ 降低）。\n\n### 综合分析\n数据呈现出一幅清晰的图景：\n1.  $d_{XY}$ 恒定，这*不支持*存在一个真正的、局部的基因流屏障，该屏障会延长局部的种群间溯祖时间。\n2.  $\\pi_X$ 和 $\\pi_Y$ 显著降低，这指向连锁选择的作用，降低了各种群内的多样性。\n3.  $F_{ST}$ 升高。\n\n结合这些观察，通过公式 $F_{ST} \\approx 1 - \\pi_S/d_{XY}$ 来分析：在焦点窗口中，分数中的分子 $\\pi_S$ 大幅下降，而分母 $d_{XY}$ 保持不变。从1中减去一个分数时，减小分子会导致最终值增加，这是一个简单的数学结果。因此，升高的 $F_{ST}$ 并非真实屏障的指标，而是由连锁选择引起的局部多样性（$\\pi_S$）降低所导致的算术结果。这种模式是由基因流减少以外的过程产生的“假”基因组岛的经典特征。\n\n### 逐项分析选项\n\n**A. 焦点窗口构成了一个真正的基因流屏障，因为高 $F_{ST}$ 直接表明迁移受限，而 $d_{XY}$ 的恒定性与检测屏障无关。**\n这个陈述根本上是错误的。高 $F_{ST}$ 是相对分化的度量，并可能因种群内多样性降低而被夸大，因此它不“直接表明”迁移受限。此外，绝对分化 $d_{XY}$ 的行为对于区分真正的屏障（应使 $d_{XY}$ 升高）和其他现象至关重要。声稱其恒定性无关紧要，表明对基本理论的严重误解。\n**结论：错误。**\n\n**B. 焦点窗口不支持真正的基因流屏障；$F_{ST}$ 升高而 $d_{XY}$ 恒定的现象最好解释为种群内多样性降低（例如，低重组区域中的连锁选择）夸大了相对分化，而真正的屏障应该使 $d_{XY}$ 高于背景水平。**\n这个陈述完全正确，代表了对此类数据模式的科学共识解释。它正确地否定了“真正屏障”的假说。它准确地指出了因果链：连锁选择降低了种群内多样性（$\\pi_S$），当绝对分化（$d_{XY}$）恒定时，这反过来又夸大了相对度量 $F_{ST}$。它还正确地陈述了真正屏障的关键预测——$d_{XY}$ 升高。\n**结论：正确。**\n\n**C. 焦点窗口构成了一个真正的基因流屏障，因为恒定的 $d_{XY}$ 证实了均匀的突变率，所以高 $F_{ST}$ 必然源于对迁入者的选择，而非其他过程。**\n这构成了有缺陷的推理。虽然恒定的 $d_{XY}$ 与均匀突变率的假设一致，但这并不必然导致存在屏障的结论。事实上，如上所述，它反而反对存在屏障。断言高 $F_{ST}$ *必然*源于对迁入者的选择是一个不合逻辑的推论，因为它完全忽略了涉及连锁选择和局部多样性降低的更简约、支持更充分的替代解释。\n**结论：错误。**\n\n**D. 数据不足以评估屏障状态；没有明确的重组图谱，即使 $d_{XY}$ 恒定，也无法解释 $F_{ST}$ 或 $d_{XY}$ 的模式。**\n这种立场过于虚无主义且不正确。虽然重组图谱提供了补充证据（连锁选择假说预测焦点窗口应位于低重组区域），但缺少它并不会使主要数据（$d_{XY}$，$\\pi$，$F_{ST}$）无法解释。观察到的统计数据的特定组合信息量很大，并为区分主要的竞争假说提供了有力证据。\n**结论：错误。**\n\n**E. 焦点窗口不支持真正的基因流屏障，因为背景选择预期会降低 $F_{ST}$，所以焦点窗口的 $F_{ST}$ 峰值很可能反映的是技术伪影而不是生物过程。**\n这个陈述包含一个关键的事实错误。背景选择通过降低局部种群内多样性（$\\pi_S$），预期会*增加* $F_{ST}$，而不是减少它。由于论证的前提是错误的，所以结论站不住脚。观察到的模式不是技术伪影，而是一种有据可查的生物现象，由选择、突变和漂变相互作用产生。\n**结论：错误。**", "answer": "$$\\boxed{B}$$", "id": "2718691"}, {"introduction": "将理论知识应用于实际数据分析，需要一套严谨的计算流程。最后的这项练习 [@problem_id:2718644] 模拟了从原始数据中鉴定分化基因组岛的全过程，指导您构建一个考虑了重组率变异和背景选择等混淆因素的统计模型。通过亲手实现这个从数据建模、统计检验到多重检验校正的流程，您将掌握一套在全基因组扫描中稳健识别候选区域的实用方法。", "problem": "您的任务是形式化一个有原则的计算工作流程，用于检测基因组分化岛，同时考虑重组率变异、背景选择和多重检验。在此，基因组分化岛定义为一个最大的连续基因组窗口集合，在利用 Benjamini–Hochberg 程序控制假发现率后，其群体间分化程度超过了在给定局部重组率和背景选择下的中性预期。\n\n将使用的基本和核心定义：\n- 固定指数 (FST) 是衡量基因组窗口间群体遗传分化的一种度量。在包含连锁选择的中性模型下，窗口水平分化的期望值和方差取决于有效种群大小和重组率。背景选择会降低有效种群大小，即使在没有正选择的情况下，也能提高低重组区域的分化水平。\n- 在一个统计模型中，设窗口索引 $i \\in \\{0,1,\\ldots,N-1\\}$ 的观测到的窗口分化由 $y_i$ 表示。设局部重组率为 $r_i  0$，背景选择指数为 $B_i \\in (0,1]$，其中较小的 $B_i$ 值表示更强的背景选择。\n- 普通最小二乘法 (OLS) 回归提供了一个基于协变量的期望分化基线估计 $\\hat{\\mu}_i$。一个依赖于 $r_i$ 和 $B_i$ 的异方差函数 $\\sigma_i^2$ 可以通过将残差平方对带有非负约束的协变量进行回归来估计。标准化残差 $z_i = (y_i - \\hat{\\mu}_i)/\\hat{\\sigma}_i$ 可用于在标准正态模型下计算零偏差的双边 $p$ 值。\n- Benjamini–Hochberg (BH) 程序控制假发现率 (FDR)。给定 $m$ 个假设及其 $p$ 值 $\\{p_i\\}_{i=1}^m$，将它们按升序排列 $p_{(1)} \\le \\cdots \\le p_{(m)}$，并定义 $k^\\star = \\max\\{k: p_{(k)} \\le \\alpha \\cdot k / m\\}$。将所有满足 $p_i \\le p_{(k^\\star)}$ 的假设标记为发现，如果不存在这样的 $k$，则不标记任何发现。\n- 定义一个岛为任何连续发现的最大序列，且其序列长度至少为 $L_{\\min}$。\n\n您的程序必须实现以下工作流程：\n1. 期望的模型拟合：将 $y$ 对设计矩阵 $X$ 进行 OLS 模型拟合，其中 $X$ 的列为\n   - $x_{i,0} = 1$，\n   - $x_{i,1} = \\log(r_i + c)$，\n   - $x_{i,2} = 1/(r_i + c)$，\n   - $x_{i,3} = 1 - B_i$，\n   - $x_{i,4} = (1 - B_i)^2$，\n   其中 $c  0$ 是一个小常数，$\\log$ 是自然对数。获得 $\\hat{\\mu}_i = X_i \\hat{\\beta}$。\n2. 异方差的方差建模：将残差平方 $e_i^2 = (y_i - \\hat{\\mu}_i)^2$ 对带有以下列的方差设计矩阵 $Z$ 进行非负最小二乘回归：\n   - $z_{i,0} = 1$，\n   - $z_{i,1} = 1/(r_i + c)$，\n   - $z_{i,2} = 1 - B_i$，\n   以获得非负系数 $\\hat{\\gamma} \\ge 0$。定义 $\\hat{\\sigma}_i^2 = \\max(Z_i \\hat{\\gamma}, \\varepsilon)$，其中 $\\varepsilon = 10^{-6}$，且 $\\hat{\\sigma}_i = \\sqrt{\\hat{\\sigma}_i^2}$。\n3. 标准化检验和多重检验控制：计算双边 $p$ 值 $p_i = 2 \\cdot (1 - \\Phi(|z_i|))$，其中 $z_i = e_i / \\hat{\\sigma}_i$ 且 $\\Phi$ 是标准正态累积分布函数。在数据集中的所有窗口上应用指定 FDR 水平 $\\alpha$ 的 Benjamini–Hochberg 程序，以分类显著窗口。\n4. 岛屿识别：识别显著窗口的最大连续序列，并仅保留那些序列长度至少为 $L_{\\min}$ 的序列。计算保留的岛屿数量。\n\n角度单位和物理单位不适用。所有概率必须表示为小数（例如，百分之十表示为 $0.1$）。\n\n测试套件和数据生成：\n- 区间使用从零开始的包含性窗口索引。\n- 对于每个测试用例，从带有异方差高斯噪声的中性基线生成合成数据，然后在指定区间上叠加由选择引起的偏移。生成过程如下。对于 $i \\in \\{0,\\ldots,N-1\\}$：\n  - 从 $\\text{Gamma}(k,\\theta)$ 分布中抽取 $r_i$，并通过裁剪将其截断到 $[r_{\\min}, r_{\\max}]$ 范围内：$r_i \\leftarrow \\min(\\max(r_i, r_{\\min}), r_{\\max})$。\n  - 从 $\\text{Beta}(a,b)$ 分布中抽取 $B_i$，并通过在 $B_{\\min}$ 处裁剪设置下限：$B_i \\leftarrow \\max(B_i, B_{\\min})$。\n  - 计算基线均值\n    $$\\mu_i = A_0 + A_1 \\log(r_i + c) + \\frac{A_2}{r_i + c} + A_3 (1 - B_i) + A_4 (1 - B_i)^2.$$\n  - 计算方差\n    $$\\sigma_i^2 = v_0 + \\frac{v_1}{r_i + c} + v_2 (1 - B_i).$$\n  - 从 $\\mathcal{N}(0, \\sigma_i^2)$ 分布中抽取 $\\varepsilon_i$，并设置 $y_i \\leftarrow \\mu_i + \\varepsilon_i$。\n  - 对于每个指定的岛屿区间 $[s_j, e_j]$，对所有 $i \\in \\{s_j,\\ldots,e_j\\}$ 调整 $y_i \\leftarrow y_i + \\Delta$。\n\n所有测试用例的共享参数：\n- 形状 $k = 2.0$，尺度 $\\theta = 1.0$，重组截断 $r_{\\min} = 0.2$, $r_{\\max} = 5.0$。\n- Beta 参数 $a = 2.0$, $b = 5.0$，下限 $B_{\\min} = 0.2$。\n- 常数 $c = 0.05$。\n- 基线系数 $A_0 = 0.10$, $A_1 = -0.015$, $A_2 = 0.040$, $A_3 = 0.120$, $A_4 = 0.080$。\n- 方差系数 $v_0 = 0.0001$, $v_1 = 0.0005$, $v_2 = 0.0004$。\n- 发现参数 $L_{\\min} = 4$, $\\alpha = 0.10$。\n- 选择偏移 $\\Delta = 0.12$。\n\n测试用例：\n- 案例 A (happy path): $N = 400$，随机种子 $s = 12345$，岛屿区间 $\\{[50,62],[180,195],[320,330]\\}$。\n- 案例 B (null control): $N = 300$，随机种子 $s = 7$，岛屿区间 $\\emptyset$。\n- 案例 C (edge case for minimal length): $N = 500$，随机种子 $s = 2023$，岛屿区间 $\\{[100,110],[250,252],[400,430]\\}$。\n\n要求的最终输出格式：\n- 您的程序必须生成单行输出，其中包含一个列表，依次为案例 A、B 和 C 的三个整数。每个整数是检测到的岛屿数量（长度至少为 $L_{\\min}$ 的发现的最大连续序列）。该行必须是方括号括起来的逗号分隔列表，例如 $[3,0,2]$。", "solution": "问题陈述已经过严格验证，并被认为是有效的。它在科学上基于演化遗传学和群体遗传学的原理，在数学和算法上是适定的，并且以客观、明确的语言呈现。所有必要的参数和定义都已提供，以构建一个唯一且可验证的解决方案。因此，我们可以进行指定计算工作流程的形式化推导和实现。\n\n核心任务是识别被称为“分化岛”的基因组区域，在这些区域中，由固定指数 $F_{ST}$ 衡量的群体间遗传分化显著升高。这种升高是局部正选择的潜在迹象。基因组学中的一个关键挑战是，其他演化过程，如背景选择和重組率变异，可以产生模仿正选择的分化模式。所提出的方法是一种有原则的统计方法，旨在解释这些混杂因素。\n\n该工作流程分四个阶段进行：\n1.  建立期望分化的零模型。\n2.  对观测方差（异方差性）进行建模。\n3.  进行统计检验并进行多重比较校正。\n4.  识别显著的岛屿。\n\n这将应用于根据指定过程生成的合成数据，这些数据作为评估该方法性能的基准真相。\n\n首先，我们必须指定数据生成过程。对于每个基因组窗口 $i \\in \\{0, 1, \\ldots, N-1\\}$，我们生成预测变量和响应变量 $y_i$。\n- 局部重组率 $r_i$ 从 Gamma 分布 $r_i \\sim \\text{Gamma}(k, \\theta)$ 中抽取，然后截断到区间 $[r_{\\min}, r_{\\max}]$。\n- 背景选择系数 $B_i$ 从 Beta 分布 $B_i \\sim \\text{Beta}(a, b)$ 中抽取，并以下限 $B_{\\min}$ 为界。\n- 在零模型下，真实期望分化 $\\mu_i$ 是这些协变量的函数：\n$$ \\mu_i = A_0 + A_1 \\log(r_i + c) + \\frac{A_2}{r_i + c} + A_3 (1 - B_i) + A_4 (1 - B_i)^2 $$\n- 真实方差 $\\sigma_i^2$ 也依赖于协变量，反映了异方差性：\n$$ \\sigma_i^2 = v_0 + \\frac{v_1}{r_i + c} + v_2 (1 - B_i) $$\n- 基线观测分化随后从正态分布中抽取，$y_i = \\mu_i + \\varepsilon_i$，其中 $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma_i^2)$。\n- 最后，为模拟分化岛，对于位于预定义选择区间 $[s_j, e_j]$ 内的所有窗口 $i$，将一个固定效应 $\\Delta$ 添加到 $y_i$ 中。\n\n准备好合成数据 $(y_i, r_i, B_i)$ 后，我们开始分析。\n\n1.  **使用普通最小二乘法 (OLS) 建模期望分化：**\n    第一步是估计在局部基因组背景条件下的期望分化 $\\hat{\\mu}_i$。我们使用 OLS 拟合一个线性模型。响应变量是观测到的分化值向量 $\\mathbf{y}$。设计矩阵 $X$ 由 $N$ 行和 $5$ 列构成，其中第 $i$ 行为 $[1, \\log(r_i+c), 1/(r_i+c), 1-B_i, (1-B_i)^2]$。模型为 $\\mathbf{y} = X\\beta + \\mathbf{e}$。系数向量 $\\beta$ 的 OLS 估计是 $\\hat{\\beta} = (X^T X)^{-1} X^T \\mathbf{y}$。这可以使用标准的最小二乘算法进行数值计算。拟合值 $\\hat{\\boldsymbol{\\mu}} = X\\hat{\\beta}$ 代表了在背景效应零模型下估计的期望分化。残差为 $\\mathbf{e} = \\mathbf{y} - \\hat{\\boldsymbol{\\mu}}$。\n\n2.  **使用非负最小二乘法 (NNLS) 建模异方差性：**\n    分化的方差在整个基因组中并非恒定。我们通过将残差平方 $e_i^2$ 对一组协变量进行回归来对此异方差性进行建模。方差设计矩阵 $Z$ 由 $N$ 行和 $3$ 列构成，其中第 $i$ 行为 $[1, 1/(r_i+c), 1-B_i]$。我们拟合模型 $\\mathbf{e}^2 = Z\\gamma$。为确保预测的方差为非负，系数向量 $\\gamma$ 必须受到约束，使得对所有 $j$ 都有 $\\gamma_j \\ge 0$。这是一个非负最小二乘法 (NNLS) 问题。窗口 $i$ 的估计方差为 $\\hat{\\sigma}_i^2 = Z_i \\hat{\\gamma}$。为防止数值问题，应用一个下限值 $\\varepsilon = 10^{-6}$，因此 $\\hat{\\sigma}_i^2 = \\max(Z_i \\hat{\\gamma}, \\varepsilon)$。估计的标准差为 $\\hat{\\sigma}_i = \\sqrt{\\hat{\\sigma}_i^2}$。\n\n3.  **标准化检验和多重检验校正：**\n    有了均值和方差的估计值，我们现在可以计算标准化的检验统计量。对于每个窗口 $i$，标准化残差为 $z_i = e_i / \\hat{\\sigma}_i = (y_i - \\hat{\\mu}_i) / \\hat{\\sigma}_i$。在窗口 $i$ 不受选择作用的原假设下，$z_i$ 被假定服从标准正态分布 $\\mathcal{N}(0, 1)$。我们计算一个双边 p 值 $p_i$，即观测到至少与 $|z_i|$ 一样大的偏离零模型的概率：\n    $$ p_i = 2 \\cdot P(Z  |z_i|) = 2 \\cdot (1 - \\Phi(|z_i|)) $$\n    其中 $\\Phi$ 是标准正态分布的累积分布函数。\n    由于我们同时进行 $N$ 个检验，我们必须进行多重比较校正以控制假发现率。在指定的假发现率 (FDR) 水平 $\\alpha$ 下应用 Benjamini–Hochberg (BH) 程序。p 值 $\\{p_i\\}_{i=0}^{N-1}$ 按升序排列：$p_{(1)} \\le p_{(2)} \\le \\cdots \\le p_{(N)}$。我们找到满足 $p_{(k^\\star)} \\le \\frac{\\alpha \\cdot k^\\star}{N}$ 的最大整数 $k^\\star$。所有原始 p 值 $p_i \\le p_{(k^\\star)}$ 的窗口都被分类为显著的“发现”。如果不存在这样的 $k^\\star$，则没有窗口被认为是显著的。\n\n4.  **岛屿识别：**\n    最后一步是将显著窗口分组成分化岛。一个岛被定义为显著窗口的最大连续序列。我们遍历发现的布尔向量，识别所有这样的连续块，并计算它们的长度。只有那些长度大于或等于最小阈值 $L_{\\min}$ 的块被保留并计为有效的分化岛。这些有效岛屿的总数是每个测试用例的最终输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import nnls\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Main function to run the complete workflow for all test cases and print the results.\n    \"\"\"\n    # Shared parameters across all test cases\n    shared_params = {\n        'k': 2.0, 'theta': 1.0, 'r_min': 0.2, 'r_max': 5.0,\n        'a': 2.0, 'b': 5.0, 'B_min': 0.2,\n        'c': 0.05,\n        'A0': 0.10, 'A1': -0.015, 'A2': 0.040, 'A3': 0.120, 'A4': 0.080,\n        'v0': 0.0001, 'v1': 0.0005, 'v2': 0.0004,\n        'L_min': 4, 'alpha': 0.10,\n        'delta': 0.12,\n        'epsilon': 1e-6\n    }\n\n    # Test case definitions\n    test_cases = [\n        {'N': 400, 'seed': 12345, 'islands': [(50, 62), (180, 195), (320, 330)]},\n        {'N': 300, 'seed': 7, 'islands': []},\n        {'N': 500, 'seed': 2023, 'islands': [(100, 110), (250, 252), (400, 430)]},\n    ]\n\n    results = []\n    for case in test_cases:\n        params = {**shared_params, **case}\n        num_islands = process_case(params)\n        results.append(num_islands)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef generate_data(p):\n    \"\"\"\n    Generates synthetic data for a single test case according to the problem specification.\n    \"\"\"\n    np.random.seed(p['seed'])\n    N = p['N']\n\n    # Generate r_i and B_i\n    r = np.random.gamma(p['k'], p['theta'], size=N)\n    r = np.clip(r, p['r_min'], p['r_max'])\n\n    B = np.random.beta(p['a'], p['b'], size=N)\n    B = np.maximum(B, p['B_min'])\n\n    # Compute true mean and variance\n    log_r_c = np.log(r + p['c'])\n    inv_r_c = 1.0 / (r + p['c'])\n    one_minus_B = 1.0 - B\n    \n    mu = (p['A0'] + p['A1'] * log_r_c + p['A2'] * inv_r_c +\n          p['A3'] * one_minus_B + p['A4'] * one_minus_B**2)\n    \n    sigma_sq = p['v0'] + p['v1'] * inv_r_c + p['v2'] * one_minus_B\n    sigma = np.sqrt(sigma_sq)\n\n    # Generate baseline y_i and add selection shifts\n    y = np.random.normal(mu, sigma)\n    for start, end in p['islands']:\n        y[start:end+1] += p['delta']\n        \n    return y, r, B\n\ndef process_case(p):\n    \"\"\"\n    Executes the full analysis pipeline for a single test case.\n    \"\"\"\n    y, r, B = generate_data(p)\n    N = p['N']\n    c = p['c']\n\n    # 1. Model fitting for expectation (OLS)\n    log_r_c = np.log(r + c)\n    inv_r_c = 1.0 / (r + c)\n    one_minus_B = 1.0 - B\n    \n    X = np.vstack([np.ones(N), log_r_c, inv_r_c, one_minus_B, one_minus_B**2]).T\n    beta_hat, _, _, _ = np.linalg.lstsq(X, y, rcond=None)\n    mu_hat = X @ beta_hat\n    residuals = y - mu_hat\n    \n    # 2. Variance modeling for heteroskedasticity (NNLS)\n    Z = np.vstack([np.ones(N), inv_r_c, one_minus_B]).T\n    gamma_hat, _ = nnls(Z, residuals**2)\n    sigma_sq_hat = np.maximum(Z @ gamma_hat, p['epsilon'])\n    sigma_hat = np.sqrt(sigma_sq_hat)\n    \n    # 3. Standardized testing and multiple-testing control (Benjamini-Hochberg)\n    z_scores = residuals / sigma_hat\n    p_values = 2 * norm.sf(np.abs(z_scores))\n\n    sorted_indices = np.argsort(p_values)\n    sorted_p_values = p_values[sorted_indices]\n    \n    k_div_m = np.arange(1, N + 1) / N\n    bh_thresholds = p['alpha'] * k_div_m\n    \n    is_significant_sorted = sorted_p_values = bh_thresholds\n    \n    discoveries = np.zeros(N, dtype=bool)\n    if np.any(is_significant_sorted):\n        k_star_idx = np.where(is_significant_sorted)[0].max()\n        p_value_threshold = sorted_p_values[k_star_idx]\n        discoveries = p_values = p_value_threshold\n\n    # 4. Island calling\n    if not np.any(discoveries):\n        return 0\n    \n    # Use diff to find starts and ends of contiguous runs of True\n    padded_discoveries = np.concatenate(([False], discoveries, [False]))\n    diffs = np.diff(padded_discoveries.astype(int))\n    starts = np.where(diffs == 1)[0]\n    ends = np.where(diffs == -1)[0]\n    \n    lengths = ends - starts\n    \n    num_islands = np.sum(lengths >= p['L_min'])\n    \n    return num_islands\n\nsolve()\n```", "id": "2718644"}]}