## 引言
随着基因组测序技术的飞速发展，病原体的[基因序列](@entry_id:191077)已成为理解和抗击传染病传播的宝贵信息源。系统动力学（Phylodynamics）正是在这一背景下应运而生的[交叉](@entry_id:147634)学科，它将[流行病学](@entry_id:141409)、[进化生物学](@entry_id:145480)和计算科学融为一体，旨在从病原体的基因家谱（即[系统发育树](@entry_id:140506)）中解读出疫情的动态历史。然而，传统流行病学监测依赖于病例报告，常受限于报告延迟和检测偏差，而海量的基因组数据本身并不能直接告诉我们疫情的增长速度或传播路径。如何在这两者之间建立一座坚实的桥梁，将基因序列中蕴含的进化信号转化为可量化的[流行病学](@entry_id:141409)洞见，正是本领域面临的核心挑战与机遇。

本文旨在系统性地阐述系统动力学的理论基础与前沿应用。在“原理与机制”一章中，我们将深入探讨连接[病原体进化](@entry_id:176826)与[流行病传播](@entry_id:264141)的数学模型，如出生-死亡过程和[溯祖理论](@entry_id:155051)，揭示如何从[系统发育树](@entry_id:140506)的形态推断关键参数。随后，在“应用与跨学科连接”一章中，我们将展示这些理论如何应用于公共卫生实践，例如重构疫情轨迹、追踪病毒的空间传播，并与其他学科产生深刻的联系。最后，在“动手实践”部分，我们将通过具体问题来巩固这些知识。通过这一系列的学习，读者将掌握一套从基因组数据出发，洞察传染病传播规律的强大分析框架。

让我们首先从构建这一框架的基石——系统动力学的核心原理与机制开始。

## 原理与机制

本章旨在深入剖析连接病原体系统发育与群体层面流行过程的核心理论模型。我们将从正向时间（出生-死亡过程）和反向时间（溯祖过程）两个视角进行探索，并揭示它们之间的内在联系。通过理解这些基本原理，我们将能够阐明如何从病原体基因组序列中蕴含的[系统发育](@entry_id:137790)模式中，推断出关键的[流行病学](@entry_id:141409)参数，例如增长率和繁殖数。

### 正向时间模型：出生-死亡过程

在[流行病学建模](@entry_id:266439)中，最简洁而强大的框架之一是**出生-死亡过程**。我们可以将新感染事件视为“出生”，将感染者的移除（通过康复或死亡）视为“死亡”。这一框架为理解流行病在实时（real time）中的动态演变提供了坚实的数学基础。

在一个简化的线性出生-死亡模型中，每个感染个体（或谱系）都遵循几个关键的随机事件，其速率（hazard rate）决定了流行病的进程。我们定义以下核心参数 [@problem_id:2742349]：
- **传播率（transmission rate）** $\lambda$：每个感染个体产生新感染的单位时间速率。
- **移除率（removal rate）** $\mu$：每个感染个体因康复或宿主死亡而变得不再具有传染性的单位时间速率。
- **取样率（sampling rate）** $\psi$：每个感染个体被取样并测序的单位时间速率。在此类模型中，通常假设取样后，该个体即被移出感染群体。

这些速率共同决定了感染总人数的期望变化。在一个小的时段 $\Delta t$ 内，一个由 $N(t)$ 个感染者组成的群体，其人数的期望变化可以表示为：
$$ \mathbb{E}[\Delta N(t)] \approx (\lambda N(t) - \mu N(t) - \psi N(t)) \Delta t $$
由此可得，感染人数的[期望值](@entry_id:153208) $\mathbb{E}[N(t)]$ 遵循一个简单的[微分方程](@entry_id:264184)，其解为指数形式：
$$ \mathbb{E}[N(t)] = N(0) \exp((\lambda - \mu - \psi)t) $$
指数的系数被称为**[马尔萨斯增长](@entry_id:187002)率 (Malthusian growth rate)**，记为 $r$。它描述了感染人数随日历时间（calendar time）的瞬时指数增长率：
$$ r = \lambda - \mu - \psi $$
这个增长率是衡量疫情[实时传播](@entry_id:199067)速度的关键指标。

与实时增长率 $r$ 相对的是一个以“代（generation）”为单位的衡量标准——**有效繁殖数 (effective reproduction number)** $R_e$。$R_e$ 定义为在当前条件下，一个典型感染者在其整个感染期内平均产生的新感染数。个体的感染期持续到其被移除为止，移除事件的总速率为 $\delta = \mu + \psi$。因此，平均感染期为 $1/\delta$。在此时期内，该个体以速率 $\lambda$ 产生新感染，故：
$$ R_e = \lambda \times \frac{1}{\mu + \psi} = \frac{\lambda}{\delta} $$
$r$ 和 $R_e$ 分别从时间和代的角度描述了流行病的增长潜力，它们之间存在一个深刻而普适的关系。通过简单的代数替换，我们可以得到：
$$ R_e = 1 + \frac{r}{\delta} $$
这个等式是系统动力学中的一个基石，它精确地连接了实时增长和代际增长。当 $r>0$ 时，我们必然有 $R_e > 1$，这两种表述在数学上是等价的，都意味着流行病处于增长状态。

为了构建[系统发育树](@entry_id:140506)，我们不仅关心感染人数的变化，还关心哪些谱系最终被包含在我们的样本中。一个在时间 $t$ 存在的谱系，到最终取样时间 $T$ 为止没有任何后代被取样的概率 $q(\tau)$（其中 $\tau=T-t$ 是距离终点的时间），遵循一个[Riccati微分方程](@entry_id:200429)，其[初始条件](@entry_id:152863)为 $q(0)=1$ [@problem_id:2742349]。这表明，即使是正向时间模型，也内在地包含了关于最终谱系采样的回溯性逻辑。

### 反向时间模型：溯祖过程

与模拟流行病向前发展的出生-死亡模型不同，**溯祖过程 (coalescent process)** 从当前采集的样本出发，向过去追溯它们的共同祖先。这个反向时间的视角是系统动力学分析的核心，因为它直接对我们观察到的系统发育树的形态进行建模。

[溯祖理论](@entry_id:155051)的核心思想是，任何一对谱系合并（coalesce）成一个共同祖先的速率，反比于群体的**有效群体大小 (effective population size)** $N_e(t)$，其中 $t$ 是从现在开始度量的反向时间 [@problem_id:2490004]。如果在一个时间点，存在 $k$ 个谱系，那么任意一对谱系发生合并的速率为 $1/N_e(t)$。由于总共有 $\binom{k}{2}$ 个可能的谱系对，因此下一个合并事件发生的总[瞬时速率](@entry_id:182981)为：
$$ \lambda_c(t, k) = \binom{k}{2} \frac{1}{N_e(t)} $$
这个简单的公式蕴含了深刻的含义：在有效群体规模较大时，谱系合并的速率较慢，合并事件之间的等待时间较长；反之，在有效群体规模较小时，谱系合并得更快。

我们可以通过一个简单的例子来理解这个过程。假设在一个时间区间 $[0, T)$ 内，有效群体大小恒定为 $N_1$。那么，从 $n$ 个谱系开始，在时间 $T$ 之前没有发生任何合并事件的概率（即第一个合并事件发生在时间 $T$ 之后的概率），可以通过计算生存概率得到。由于合并事件的速率在 $[0, T)$ 区间内是恒定的 $\lambda_n = \binom{n}{2}/N_1$，所以这个概率为 [@problem_id:2742374]：
$$ P(\text{第一个合并事件} > T) = \exp\left(-\int_0^T \lambda_n(t) dt\right) = \exp\left(-\frac{\binom{n}{2}T}{N_1}\right) $$
这个计算揭示了系统发育树中[分支长度](@entry_id:177486)如何直接与有效群体大小和时间相关联。

需要强调的是，**有效群体大小** $N_e$ 并不等同于感染者的普查人口大小 (census size)。$N_e$ 是一个理论概念，它量化了谱系合并的速率，并综合了群体规模和繁殖成功率[方差](@entry_id:200758)的影响。例如，在存在“[超级传播](@entry_id:202212)”现象的流行病中，高的繁殖成功率[方差](@entry_id:200758)会显著降低有效群体大小 $N_e$，使其远小于普查人口大小 [@problem_id:2490004]。

### [系统动力学](@entry_id:136288)之桥：连接正向与反向视角

系统动力学的精髓在于建立了正向时间流行病过程与反向时间谱系过程之间的数学桥梁。这使得我们能够通过分析系统发育树的形态来推断流行病的动态历史。

#### 溯祖-出生-死亡关联

一个关键的理论成果是**溯祖-出生-死亡关联 (coalescent–birth–death link)**。该理论指出，在一个出生-死亡-取样过程中生成的、由被取样谱系构成的[系统发育树](@entry_id:140506)，其分支时间的[统计分布](@entry_id:182030)，等价于一个具有特定时变有效群体大小 $N_e(t)$ 的溯祖过程 [@problem_id:2490004] [@problem_id:2742394]。这种对偶性意味着我们可以用更易于处理的[溯祖模型](@entry_id:202220)来分析由复杂的流行病过程产生的数据。

#### 指数增长的印记

当流行病处于早期指数增长阶段时，它会在[系统发育树](@entry_id:140506)上留下特征性的印记。
- **正向视角**：感染人数 $I(t')$ 以增长率 $r > 0$ 呈[指数增长](@entry_id:141869)，即 $I(t') \propto \exp(rt')$。
- **反向视角**：这意味着在过去，群体规模更小。如果我们假设 $N_e(t)$ 与普查人口大小成正比，那么随着反向时间 $t$ 的增加（即追溯到更远的过去），有效群体大小 $N_e(t)$ 会以 $\exp(-rt)$ 的形式衰减 [@problem_id:2490004] [@problem_id:2742423]。
- **溯祖速率**：根据溯祖速率公式，合并速率与 $1/N_e(t)$ 成正比，因此它会随着反向时间 $t$ 的增加而呈指数**增长**，形式为 $\exp(rt)$ [@problem_id:2742394]。
- **树的形态**：这一动态过程导致了一个非常独特的系统发育树形态：在靠近现在的时间点（$t$ 较小，$N_e$ 较大），合并事件稀少，谱系倾向于长时间保持独立，从而形成较长的末端分支。而在更远的过去（$t$ 较大，$N_e$ 较小），合并事件变得非常频繁，导致内部节点密集地聚集在靠近树根的位置 [@problem_id:2490004]。这种“星状”或“梳状”的[系统发育树](@entry_id:140506)是流行病指数增长的一个强烈信号。

#### 洛特卡-[欧拉方程](@entry_id:177914)

为了更普遍地连接增长率和繁殖数，我们可以使用**[更新方程](@entry_id:264802) (renewal equation)** 框架。该框架将当前的感染发生率视为过去所有感染者贡献的总和，并由**代际间隔 (generation interval)** [分布](@entry_id:182848) $g(a)$ 加权。代际间隔是指从感染者被感染到其产生二代感染之间的时间。在指数增长阶段，繁殖数 $R$ 和增长率 $r$ 之间由著名的**洛特卡-[欧拉方程](@entry_id:177914) (Lotka-Euler equation)** 联系起来 [@problem_id:2742394]：
$$ 1 = R \int_0^\infty g(a) \exp(-ra) da = R \cdot L(r) $$
其中 $L(r)$ 是代际间隔[分布](@entry_id:182848) $g(a)$ 的拉普拉斯变换。这个方程为任何给定的代际间隔[分布](@entry_id:182848)提供了一个精确的换算关系。例如，如果代际间隔是固定的 $T_g$，则 $R = \exp(r T_g)$；如果代际间隔服从均值为 $T_g$、形状参数为 $k$ 的伽玛[分布](@entry_id:182848)，则 $R = \left(1 + \frac{r T_g}{k}\right)^k$ [@problem_id:2742394]。

### 从理论到实践：从树中估计参数

理论模型为我们提供了理解的基础，但在实践中，我们需要从真实的基因组数据中估计这些模型的参数。

#### 分子钟与时间校准

病原体基因组在复制过程中会积累突变。**[严格分子钟](@entry_id:183441) (strict molecular clock)** 假设突变的积累速率（[替换速率](@entry_id:150366)）$\mu$ 在整个系统发育树上是恒定的。这意味着遗传距离（单位：替换数/位点）与时间成正比：$d = \mu \times t$。

对于**异时序 (heterochronous)** 数据，即在不同日历时间点采集的样本，[分子钟](@entry_id:141071)假设提供了一种强大的校准方法。通过绘制每个样本（“树梢”）到树根的遗传距离 $d_i$ 与其已知的采样时间 $t_i$ 的关系图，我们可以进行**根到梢回归 (root-to-tip regression)**。根据[分子钟](@entry_id:141071)模型，我们期望 $d_i = \mu (t_i - T_{\text{root}})$，其中 $T_{\text{root}}$ 是树根的日历时间。这是一个线性关系 $d_i = \mu t_i - \mu T_{\text{root}}$。

例如，假设我们有如下数据 [@problem_id:2742381]：
- 采样时间 $t_i \in \{2010.0, 2012.0, 2015.0, 2018.0, 2020.0\}$
- 根到梢距离 $d_i \in \{0.0021, 0.0039, 0.0072, 0.0098, 0.0121\}$

通过对这些数据点进行简单的线性回归，我们可以得到斜率和截距的最大似然估计。斜率直接估计了[替换速率](@entry_id:150366) $\hat{\mu}$，而根时间则由负的截距与斜率之比给出，即 $\hat{T}_{\text{root}} = -\hat{\beta}_0 / \hat{\beta}_1$。对于上述数据，计算结果为 $\hat{\mu} \approx 9.96 \times 10^{-4}$ 替换数/位点/年，$\hat{T}_{\text{root}} \approx 2007.95$ 年。这种方法是校准[系统发育树](@entry_id:140506)时间尺度的基础。

#### 推断动态历史：[天际线图](@entry_id:167377)

一旦树被时间校准，我们就可以利用其分支模式来推断过去的有效群体大小 $N_e(t)$ 的动态变化。**[天际线图](@entry_id:167377) (skyline plot)** 方法正是为此而生。其基本逻辑是利用溯祖事件之间的等待时间来反推每个时间段内的 $N_e$。

在一个经典的天际线模型中，我们假设 $N_e(t)$ 在每个溯祖间隔内是分段恒定的。对于一个包含 $m$ 个溯祖间隔的时期，其中谱系数量为 $k_j$，等待时间为 $\Delta t_j$，该时期内有效群体大小 $N_e$ 的[最大似然估计量](@entry_id:163998) (MLE) 是 [@problem_id:2742423]：
$$ \hat{N}_e = \frac{1}{m} \sum_{j=1}^{m} \binom{k_j}{2} \Delta t_j $$
这个公式直观地表明，更长的等待时间 ($\Delta t_j$) 或更多的谱系 ($k_j$) 意味着更大的有效群体大小。例如，对于一组包含6个样本的等时序数据，其前两个溯祖间隔分别为 $k=6, \Delta t_6=0.20$ 和 $k=5, \Delta t_5=0.15$，那么该时期的有效群体大小估计为 $\hat{N}_{e,1} = \frac{1}{2} (\binom{6}{2} \times 0.20 + \binom{5}{2} \times 0.15) = 2.25$。

现代的**[贝叶斯天际线图](@entry_id:175686) (Bayesian skyline plot)** 方法更为灵活，它允许 $N_e(t)$ 更平滑地变化，并通过贝叶斯方法估计其[后验分布](@entry_id:145605)。一个普遍的结论是，在溯祖事件稀少的时间段，数据提供的信息较少，因此对 $N_e(t)$ 的估计不确定性会更大 [@problem_id:2742423]。

#### 可识别性与混淆

在进行参数估计时，一个核心的统计问题是**可识别性 (identifiability)**。一个参数是可识别的，前提是不同的参数值能够产生不同的数据[分布](@entry_id:182848)。如果多个不同的参数组合能够产生完全相同的数据[似然](@entry_id:167119)，那么这些参数就是**混淆 (confounded)** 的，无法被唯一确定。

在系统动力学中，一个经典的混淆问题出现在使用**等时序 (isochronous)** 数据（所有样本在同一时间采集）时。在这种情况下，我们只有以替换数为单位的[分支长度](@entry_id:177486)，而没有外部的时间锚点。此时，[进化速率](@entry_id:202008) $\mu$ 和人口统计学时间尺度是无法区分的。例如，在一个[指数增长模型](@entry_id:269008)中，数据只能告诉我们复合参数 $\mu N_0$ 和 $g/\mu$ 的值，而无法单独分辨出 $\mu$, $N_0$ 和 $g$ [@problem_id:2742419]。一个[快速进化](@entry_id:204684)的病原体在一个大群体中，与一个缓慢进化的病原体在一个小群体中，可能产生形态上无法区分的系统发育树。

然而，正如前面所讨论的，**异时序**数据通过根到梢回归提供了对 $\mu$ 的独立估计，从而打破了这种混淆，使得人口统计学参数（如 $N_0$ 和 $g$）能够在它们的自然时间单位（例如年）上被识别 [@problem_id:2742419]。在贝叶斯框架中，即使数据是等时序的，提供一个关于 $\mu$ 的强信息[先验分布](@entry_id:141376)也能在实践中“诱导”可识别性，但这时的识别能力来源于先验知识，而非数据本身 [@problem_id:2742419]。

### 复杂性与高级模型

简单的模型为我们提供了核心洞见，但真实世界的复杂性要求我们考虑更精细的模型。

#### 传播树 vs. 病原体[系统发育](@entry_id:137790)

一个至关重要的区别是，我们重建的**病原体[系统发育树](@entry_id:140506)**并不等同于**传播树**（即“谁感染了谁”的图谱）。系统发育树记录的是[基因谱系](@entry_id:172451)的祖先关系，而传播树记录的是宿主间的感染事件。它们之间的差异由几个因素造成 [@problem_id:2742354]：
- **宿主内动态**：当宿主D在时间 $t_{tx}$ 感染宿主R时，两个宿主样本谱系的合并事件（即它们的[最近共同祖先](@entry_id:136722)）必然发生在传播事件 **之前** 的某个时间。这个时间差的[期望值](@entry_id:153208)与宿主内的有效群体大小 $N_e^w$ 相关。[共同祖先](@entry_id:175919)在宿主D内部，等待合并的时间长度的期望为 $N_e^w$（在适当的时间单位下）。因此，[系统发育树](@entry_id:140506)的节点时间通常比对应的传播事件时间更早 [@problem_id:2742354]。
- **不完全取样**：在现实中，我们永远无法对所有感染者进行测序。如果A感染了B，B又感染了C，但B未被取样，那么在重建的只包含A和C样本的树中，B的存在是不可见的。谱系会直接从C追溯到A，导致我们只观察到一个合并事件，而实际上发生了两个传播事件。这使得系统发育树通常会低估真实的传播事件数量 [@problem_id:2742354]。
- **传播瓶颈**：在传播事件中，只有少数病毒颗粒（由**瓶颈大小** $b$ 决定）从供体传播给受体，这也深刻影响了系统发育树的结构。

#### 空间结构：结构化溯祖

流行病通常具有空间结构，而非在一个均匀混合的群体中传播。**结构化溯祖 (structured coalescent)** 模型通过允许谱系在不同的地理区域（或“亚群”，deme）之间迁移来解释这一点。在这个框架下，谱系在亚群内部发生合并，并在亚群之间以一定的速率 $m$ 迁移 [@problem_id:2742365]。

在一个包含A和B两个亚群的系统中，任何时刻都存在多个相互竞争的事件：A内的合并、B内的合并、从A到B的迁移、从B到A的迁移。每个事件都有其特定的速率。例如，有 $k_A=3$ 个谱系在A亚群 ($N_A=1000$)，迁移率 $m_{A \to B}=0.01$；有 $k_B=2$ 个谱系在B亚群 ($N_B=500$)，迁移率 $m_{B \to A}=0.02$。我们可以计算出每个事件的总速率：
- A内合并速率: $\lambda_{\text{coal, A}} = \binom{3}{2}/1000 = 0.003$
- B内合并速率: $\lambda_{\text{coal, B}} = \binom{2}{2}/500 = 0.002$
- A到B迁移速率: $\lambda_{\text{mig, A} \to \text{B}} = 3 \times 0.01 = 0.03$
- B到A迁移速率: $\lambda_{\text{mig, B} \to \text{A}} = 2 \times 0.02 = 0.04$
所有事件的总速率为 $\lambda_{\text{total}} = 0.075$。下一个事件是A内合并的概率就是其速率占总速率的比例：$P(\text{coal in A}) = 0.003 / 0.075 = 0.04$。通过这种方式，我们可以利用地理标记的[序列数据](@entry_id:636380)来估计迁移率和各区域的有效群体大小。

#### 无处不在的挑战：取样偏差

最后，或许也是实践中最严峻的挑战，是**取样偏差 (sampling bias)**。我们的推断质量完全取决于样本的[代表性](@entry_id:204613)。一个有偏差的样本[几乎必然](@entry_id:262518)会导致有偏差的结论。

一个极具说明性的例子是，如果我们只从一家收治重症患者的医院采集样本来研究一场全市范围的疫情。这些样本在地理上、流行病学上以及可能的生物学特性上都是高度聚集的，它们代表了整个社区病毒多样性中一个非常小的、非随机的[子集](@entry_id:261956)。这样的取样策略会系统性地遗漏掉大量在社区中传播的、与轻症或无症状感染相关的病毒谱系，尤其是那些在疫情早期就已经分化的“深层”谱系。

结果是，基于这个有偏差的样本重建的系统发育树将远比真实的社区传播树要“浅”。分析将只找到**该样本**的[最近共同祖先](@entry_id:136722)，而这个祖先比整个社区疫情的真正祖先要年轻得多。因此，这种取样偏差会导致对**[最近共同祖先时间](@entry_id:174926) ([TMRCA](@entry_id:174926))** 的系统性**低估**，使我们错误地认为疫情的起源时间比实际情况更近 [@problem_id:2414561]。认识并尽可能地纠正取样偏差，是应用[系统动力学](@entry_id:136288)方法进行[公共卫生](@entry_id:273864)响应时不可或缺的一步。