{"hands_on_practices": [{"introduction": "生命史理论的许多核心思想都建立在结构化种群模型之上。莱斯利（Leslie）矩阵及其推广形式是分析具有年龄或阶段结构种群动态的基础工具。这项练习将引导你完成对一个典型阶段结构矩阵的核心分析，计算其关键的人口统计学参数：种群的长期增长率（由主导特征值 $\\lambda$ 表示）、稳定的阶段分布（右特征向量 $\\mathbf{w}$）以及各阶段的繁殖价值（左特征向量 $\\mathbf{v}$）。掌握这些基本计算是定量理解任何生命史策略的第一步，为更深入的进化分析奠定基础 [@problem_id:2728442]。", "problem": "一种脊椎动物表现出三个离散的生活史阶段，这些阶段体现了生存与繁殖之间的权衡：幼体（阶段 $1$）、亚成体（阶段 $2$）和成体（阶段 $3$）。阶段 $2$ 和 $3$ 的个体进行繁殖，其繁殖力为 $F=[0,\\,1.2,\\,1.5]$，而阶段间的生存转移由 $P=[0.5,\\,0.6,\\,0.7]$ 给出。假设一个具有 Leslie–Lefkovitch 结构的离散时间线性投影：投影矩阵 $\\mathbf{A}$ 的第一行为繁殖力，次对角线为生存转移，最后一个阶段为留存，即\n$$\n\\mathbf{A} \\;=\\; \\begin{pmatrix}\n0  1.2  1.5 \\\\\n0.5  0  0 \\\\\n0  0.6  0.7\n\\end{pmatrix}.\n$$\n仅从以下标准定义出发：(i) $\\mathbf{A}$ 的主特征值 $\\lambda$ 是长期种群倍增率，(ii) 稳定年龄（阶段）分布 $\\mathbf{w}$ 是与 $\\lambda$ 相关的 $\\mathbf{A}$ 的右特征向量，归一化使得 $\\sum_i w_i = 1$，以及 (iii) 繁殖价值向量 $\\mathbf{v}$ 是与 $\\lambda$ 相关的左特征向量，归一化使得 $\\mathbf{v}^{\\top}\\mathbf{w} = 1$，完成以下任务：\n\n1.  推导 $\\mathbf{A}$ 的特征多项式并计算主特征值 $\\lambda$。\n2.  以符号形式推导相应的稳定年龄分布 $\\mathbf{w}$（最多相差一个标量），然后将其归一化使其各分量之和为 $1$。\n3.  以符号形式推导相应的繁殖价值向量 $\\mathbf{v}$（最多相差一个标量），然后将其归一化使得 $\\mathbf{v}^{\\top}\\mathbf{w} = 1$。\n\n将你的最终数值答案报告为 $\\lambda$ 的值，无单位，四舍五入到四位有效数字。你必须按要求进行 $\\mathbf{w}$ 和 $\\mathbf{v}$ 的推导，但最终只需报告 $\\lambda$ 的数值。", "solution": "经评估，问题陈述有效。这是一个在数学种群生物学中定义明确的问题，其基础是生命史理论和线性代数的既定原则。所有数据均已提供，定义标准且明确。我们开始求解。\n\n问题要求推导主特征值 $\\lambda$、稳定阶段分布 $\\mathbf{w}$ 和繁殖价值向量 $\\mathbf{v}$，该种群分为三个阶段，由投影矩阵 $\\mathbf{A}$ 控制。\n\n给定的投影矩阵是：\n$$\n\\mathbf{A} = \\begin{pmatrix}\n0  1.2  1.5 \\\\\n0.5  0  0 \\\\\n0  0.6  0.7\n\\end{pmatrix}\n$$\n\n**1. 推导特征多项式和主特征值 $\\lambda$**\n\n矩阵 $\\mathbf{A}$ 的特征值 $\\lambda$ 是特征方程 $\\det(\\mathbf{A} - \\lambda\\mathbf{I}) = 0$ 的根，其中 $\\mathbf{I}$ 是单位矩阵。\n\n特征行列式为：\n$$\n\\det(\\mathbf{A} - \\lambda\\mathbf{I}) = \\begin{vmatrix}\n-\\lambda  1.2  1.5 \\\\\n0.5  -\\lambda  0 \\\\\n0  0.6  0.7-\\lambda\n\\end{vmatrix} = 0\n$$\n\n我们沿第一列展开行列式：\n$$\n(-\\lambda) \\begin{vmatrix} -\\lambda  0 \\\\ 0.6  0.7-\\lambda \\end{vmatrix} - (0.5) \\begin{vmatrix} 1.2  1.5 \\\\ 0.6  0.7-\\lambda \\end{vmatrix} + (0) \\begin{vmatrix} 1.2  1.5 \\\\ -\\lambda  0 \\end{vmatrix} = 0\n$$\n$$\n(-\\lambda) \\left( (-\\lambda)(0.7-\\lambda) - (0)(0.6) \\right) - (0.5) \\left( (1.2)(0.7-\\lambda) - (1.5)(0.6) \\right) = 0\n$$\n$$\n(-\\lambda)(-\\lambda(0.7-\\lambda)) - (0.5)(0.84 - 1.2\\lambda - 0.9) = 0\n$$\n$$\n\\lambda^2(0.7-\\lambda) - (0.5)(-0.06 - 1.2\\lambda) = 0\n$$\n$$\n0.7\\lambda^2 - \\lambda^3 + 0.03 + 0.6\\lambda = 0\n$$\n乘以 $-1$ 并重新排列各项，得到标准形式的特征多项式：\n$$\n\\lambda^3 - 0.7\\lambda^2 - 0.6\\lambda - 0.03 = 0\n$$\n这就是该阶段结构模型的欧拉-洛特卡方程。主特征值 $\\lambda$ 是长期种群增长率。根据 Perron-Frobenius 定理，对于非负、不可约、本原的矩阵，存在一个唯一的、简单的、正实数特征值，其绝对值大于所有其他特征值。矩阵 $\\mathbf{A}$ 是本原矩阵，因为它是不可约的，并且主对角线上有一个正元素（$a_{33} = 0.7 > 0$）。这个正实根就是主特征值 $\\lambda$。\n\n这个三次方程必须求解其根。数值解得到一个正实根和两个共轭复根。正实根为：\n$$\n\\lambda \\approx 1.214436\n$$\n按要求四舍五入到四位有效数字，得到 $\\lambda = 1.214$。\n\n**2. 推导稳定阶段分布 $\\mathbf{w}$**\n\n稳定阶段分布 $\\mathbf{w}$ 是对应于主特征值 $\\lambda$ 的右特征向量，满足 $\\mathbf{A}\\mathbf{w} = \\lambda\\mathbf{w}$，或 $(\\mathbf{A} - \\lambda\\mathbf{I})\\mathbf{w} = \\mathbf{0}$。我们将其写成一个线性方程组：\n$$\n\\begin{pmatrix}\n-\\lambda  1.2  1.5 \\\\\n0.5  -\\lambda  0 \\\\\n0  0.6  0.7-\\lambda\n\\end{pmatrix}\n\\begin{pmatrix} w_1 \\\\ w_2 \\\\ w_3 \\end{pmatrix}\n=\n\\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n这得到方程组：\n1.  $-\\lambda w_1 + 1.2 w_2 + 1.5 w_3 = 0$\n2.  $0.5 w_1 - \\lambda w_2 = 0$\n3.  $0.6 w_2 + (0.7-\\lambda) w_3 = 0$\n\n从方程 (2)，我们用 $w_1$ 表示 $w_2$：\n$$ w_2 = \\frac{0.5}{\\lambda} w_1 $$\n从方程 (3)，我们用 $w_2$ 表示 $w_3$：\n$$ w_3 = -\\frac{0.6}{0.7-\\lambda} w_2 = \\frac{0.6}{\\lambda-0.7} w_2 $$\n代入 $w_2$ 的表达式：\n$$ w_3 = \\frac{0.6}{\\lambda-0.7} \\left( \\frac{0.5}{\\lambda} w_1 \\right) = \\frac{0.3}{\\lambda(\\lambda-0.7)} w_1 $$\n因此，特征向量 $\\mathbf{w}$ 与一个向量成比例，我们可以设 $w_1=1$ 来定义其未归一化的形式 $\\mathbf{w}'$：\n$$\n\\mathbf{w}' = \\begin{pmatrix} 1 \\\\ \\frac{0.5}{\\lambda} \\\\ \\frac{0.3}{\\lambda(\\lambda-0.7)} \\end{pmatrix}\n$$\n问题要求归一化，使得各分量之和为 $1$，即 $\\sum_i w_i = 1$。令 $S_w = 1 + \\frac{0.5}{\\lambda} + \\frac{0.3}{\\lambda(\\lambda-0.7)}$。归一化后的向量为 $\\mathbf{w} = \\frac{1}{S_w}\\mathbf{w}'$。\n$$\n\\mathbf{w} = \\frac{1}{1 + \\frac{0.5}{\\lambda} + \\frac{0.3}{\\lambda(\\lambda-0.7)}} \\begin{pmatrix} 1 \\\\ \\frac{0.5}{\\lambda} \\\\ \\frac{0.3}{\\lambda(\\lambda-0.7)} \\end{pmatrix}\n$$\n\n**3. 推导繁殖价值向量 $\\mathbf{v}$**\n\n繁殖价值向量 $\\mathbf{v}$ 是对应于 $\\lambda$ 的左特征向量，满足 $\\mathbf{v}^{\\top}\\mathbf{A} = \\lambda\\mathbf{v}^{\\top}$。这等价于 $\\mathbf{A}^{\\top}\\mathbf{v} = \\lambda\\mathbf{v}$，或 $(\\mathbf{A}^{\\top} - \\lambda\\mathbf{I})\\mathbf{v} = \\mathbf{0}$。\n\n$\\mathbf{A}$ 的转置矩阵是：\n$$\n\\mathbf{A}^{\\top} = \\begin{pmatrix}\n0  0.5  0 \\\\\n1.2  0  0.6 \\\\\n1.5  0  0.7\n\\end{pmatrix}\n$$\n方程组为：\n$$\n\\begin{pmatrix}\n-\\lambda  0.5  0 \\\\\n1.2  -\\lambda  0.6 \\\\\n1.5  0  0.7-\\lambda\n\\end{pmatrix}\n\\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix}\n=\n\\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n1.  $-\\lambda v_1 + 0.5 v_2 = 0$\n2.  $1.2 v_1 - \\lambda v_2 + 0.6 v_3 = 0$\n3.  $1.5 v_1 + (0.7-\\lambda) v_3 = 0$\n\n从方程 (1)，我们用 $v_1$ 表示 $v_2$：\n$$ v_2 = \\frac{\\lambda}{0.5} v_1 = 2\\lambda v_1 $$\n从方程 (3)，我们用 $v_1$ 表示 $v_3$：\n$$ v_3 = -\\frac{1.5}{0.7-\\lambda} v_1 = \\frac{1.5}{\\lambda-0.7} v_1 $$\n按照惯例，我们设 $v_1=1$ 来获得未归一化的繁殖价值向量 $\\mathbf{v}'$：\n$$\n\\mathbf{v}' = \\begin{pmatrix} 1 \\\\ 2\\lambda \\\\ \\frac{1.5}{\\lambda-0.7} \\end{pmatrix}\n$$\n问题要求归一化，使得 $\\mathbf{v}^{\\top}\\mathbf{w} = 1$。令 $\\mathbf{v} = k\\mathbf{v}'$，其中 $k$ 为某个标量。条件变为 $k\\mathbf{v}'^{\\top}\\mathbf{w} = 1$，所以归一化常数是 $k = (\\mathbf{v}'^{\\top}\\mathbf{w})^{-1}$。\n\n点积 $\\mathbf{v}'^{\\top}\\mathbf{w}$ 是：\n$$\n\\mathbf{v}'^{\\top}\\mathbf{w} = \\begin{pmatrix} 1  2\\lambda  \\frac{1.5}{\\lambda-0.7} \\end{pmatrix} \\left( \\frac{1}{S_w} \\begin{pmatrix} 1 \\\\ \\frac{0.5}{\\lambda} \\\\ \\frac{0.3}{\\lambda(\\lambda-0.7)} \\end{pmatrix} \\right)\n$$\n$$\n= \\frac{1}{S_w} \\left( 1\\cdot 1 + 2\\lambda \\cdot \\frac{0.5}{\\lambda} + \\frac{1.5}{\\lambda-0.7} \\cdot \\frac{0.3}{\\lambda(\\lambda-0.7)} \\right)\n$$\n$$\n= \\frac{1}{S_w} \\left( 1 + 1 + \\frac{0.45}{\\lambda(\\lambda-0.7)^2} \\right) = \\frac{1}{S_w} \\left( 2 + \\frac{0.45}{\\lambda(\\lambda-0.7)^2} \\right)\n$$\n因此，归一化常数 $k = \\frac{S_w}{2 + \\frac{0.45}{\\lambda(\\lambda-0.7)^2}}$。\n完全归一化的繁殖价值向量是 $\\mathbf{v} = k\\mathbf{v}'$：\n$$\n\\mathbf{v} = \\frac{1 + \\frac{0.5}{\\lambda} + \\frac{0.3}{\\lambda(\\lambda-0.7)}}{2 + \\frac{0.45}{\\lambda(\\lambda-0.7)^2}} \\begin{pmatrix} 1 \\\\ 2\\lambda \\\\ \\frac{1.5}{\\lambda-0.7} \\end{pmatrix}\n$$\n至此，所需的推导全部完成。最终的数值答案是 $\\lambda$ 的值，四舍五入到四位有效数字。", "answer": "$$\n\\boxed{1.214}\n$$", "id": "2728442"}, {"introduction": "掌握了计算种群增长率的技能后，我们便可以利用它来探索经典的生命史权衡。这项练习 [@problem_id:2728454] 设计了一个思想实验：在净繁殖率 $R_0$（即个体一生中产生的后代总数）固定的情况下，繁殖时间的早晚是否会影响种群的内禀增长率 $r$？通过比较“早生”和“晚生”两种策略，你将具体地、定量地揭示提前繁殖所带来的强大选择优势，即使这两种策略的终生繁殖成功率完全相同。", "problem": "你将实现并应用一种数值方法，以比较具有相同净繁殖率的两组生活史调度之间的内禀增长率。工作将在一个离散的、仅限雌性、以一年为年龄组的年龄结构设定中进行。令 $x \\in \\{0,1,2,\\dots,\\omega\\}$ 表示年龄（以年为单位），令 $s_x$ 表示从年龄 $x$ 存活到年龄 $x+1$ 的概率，并定义存活率 $l_x$ 为 $l_0 = 1$ 和 $l_{x+1} = l_x s_x$。令 $m_x$ 表示在年龄 $x$ 存活的雌性在确切年龄 $x$ 时产生的雌性后代的期望数量。净繁殖率 (NRR)，$R_0$，定义为 $R_0 = \\sum_{x=0}^{\\omega} l_x m_x$。内禀增长率 $r$（单位：每年）被定义为求解针对离散年龄和连续时间指数增长的 Euler–Lotka 平衡方程的唯一实数解：\n$$\n\\sum_{x=0}^{\\omega} l_x m_x e^{-r x} = 1,\n$$\n其中 $x$ 的单位是年，$r$ 的单位是每年。\n\n对于下面的每个测试用例，两个调度由一个共同的存活概况 $\\{s_x\\}_{x=0}^{\\omega-1}$、一个共同的目标 $R_0$ 和两个不相交的繁殖年龄集合指定：一个“早期”调度 $E$ 和一个“晚期”调度 $L$。对于每个调度 $S \\in \\{E,L\\}$，定义 $m_x^{(S)}$ 在所有年龄 $x \\in S$ 上相等，在其他年龄上为零，其共同值的选择使得 $\\sum_{x \\in S} l_x m_x^{(S)} = R_0$。即，对于 $S \\in \\{E,L\\}$ 和 $x \\in S$，\n$$\nm_x^{(S)} = \\frac{R_0}{\\sum_{a \\in S} l_a},\n$$\n且对于 $x \\notin S$，$m_x^{(S)} = 0$。\n\n任务：\n- 对于每个测试用例，根据 $s_x$ 计算 $l_x$，如上所述构建 $m_x^{(E)}$ 和 $m_x^{(L)}$，然后通过求解每个调度的 Euler–Lotka 方程来计算 $r_E$ 和 $r_L$。\n- 报告 $r_E$ 和 $r_L$（单位：每年），四舍五入到六位小数。\n- 同时报告一个四舍五入到整数的指标，如果 $r_E > r_L$ 则为 $1$，否则为 $0$。\n- 你的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表形式的结果，每个内部列表为 [$r_E$, $r_L$, 指标]。例如，一个包含两个用例的输出应如下所示：`[[0.123456,0.012345,1],[0.000000,0.000000,0]]`。\n\n使用以下测试套件。在每个用例中，$s_x$ 以有序列表形式给出，对应 $x \\in \\{0,\\dots,\\omega-1\\}$，年龄单位为年，$R_0$ 为无量纲单位：\n- 用例 A：\n  - $s_x = [\\,0.7,\\,0.8,\\,0.8,\\,0.75\\,]$（因此 $\\omega = 4$，年龄从 $0$ 到 $4$）。\n  - $R_0 = 1.6$。\n  - $E = \\{\\,1,\\,2\\,\\}$ 和 $L = \\{\\,3,\\,4\\,\\}$。\n- 用例 B：\n  - $s_x = [\\,0.4,\\,0.9,\\,0.95,\\,0.95\\,]$。\n  - $R_0 = 1.2$。\n  - $E = \\{\\,1\\,\\}$ 和 $L = \\{\\,4\\,\\}$。\n- 用例 C：\n  - $s_x = [\\,0.95,\\,0.95,\\,0.95,\\,0.95,\\,0.95,\\,0.95,\\,0.95,\\,0.95,\\,0.95\\,]$（因此 $\\omega = 9$，年龄从 $0$ 到 $9$）。\n  - $R_0 = 1.05$。\n  - $E = \\{\\,2,\\,3\\,\\}$ 和 $L = \\{\\,8,\\,9\\,\\}$。\n- 用例 D（边界条件）：\n  - $s_x = [\\,0.5,\\,0.9,\\,0.9\\,]$。\n  - $R_0 = 1.0$。\n  - $E = \\{\\,1,\\,2\\,\\}$ 和 $L = \\{\\,3\\,\\}$。\n\n角度单位不适用。所有报告的 $r$ 值必须以“每年”为单位表示，并按规定四舍五入到六位小数。最终的单行输出必须是包含四个内部列表的列表，并严格按照上述 A, B, C, D 的顺序排列。", "solution": "问题陈述已经过严格评估并被认为是有效的。它在科学上基于人口统计学理论的既定原则，特别是使用年龄结构模型的生活史理论。该问题是适定的，为确定每个用例的唯一解提供了充分且一致的信息。通过离散时间 Euler-Lotka 方程对存活率 ($l_x$)、生育力 ($m_x$)、净繁殖率 ($R_0$) 和内禀增长率 ($r$) 的定义是标准的且在数学上是合理的。问题是客观的，没有歧义。因此，我们可以进行严格的解析求解。\n\n问题的核心是找到内禀增长率 $r$，它是 Euler-Lotka 方程的唯一实数根：\n$$\n\\sum_{x=0}^{\\omega} l_x m_x e^{-r x} = 1\n$$\n这必须在两种不同的繁殖调度下完成，即“早期”调度 $E$ 和“晚期”调度 $L$，且约束条件是两者产生相同的净繁殖率 $R_0$。\n\n对每个测试用例执行的求解步骤如下：\n\n1.  **计算存活率调度 ($l_x$)**：\n    存活率调度 $\\{l_x\\}$，表示从出生（年龄 $0$）存活到年龄组 $x$ 开始的概率，是根据给定的特定年龄存活概率 $\\{s_x\\}$ 计算得出的。我们从存活到年龄 $0$ 的概率是确定的这一公理开始，因此 $l_0 = 1$。对于所有后续年龄 $x \\in \\{0, 1, \\dots, \\omega-1\\}$，存活率通过递推关系计算：\n    $$\n    l_{x+1} = l_x s_x\n    $$\n    这会生成一个从年龄 $0$到最大年龄 $\\omega$ 的完整存活率值向量。\n\n2.  **构建生育力调度 ($m_x^{(S)}$)**：\n    对于每个繁殖调度 $S \\in \\{E, L\\}$，生育力 $m_x^{(S)}$被定义为在所有年龄 $x \\in S$ 上为一个常数值（我们称之为 $m_S$），而在所有年龄 $x \\notin S$ 上为零。这个常数 $m_S$ 由必须达到净繁殖率 $R_0$ 这一约束条件确定。$R_0$ 的定义是 $\\sum_{x=0}^{\\omega} l_x m_x$。对于调度 $S$，这变为：\n    $$\n    R_0 = \\sum_{x \\in S} l_x m_S = m_S \\sum_{x \\in S} l_x\n    $$\n    由此，我们解出常数生育力值：\n    $$\n    m_S = \\frac{R_0}{\\sum_{a \\in S} l_a}\n    $$\n    此公式分别应用于早期年龄集 $E$ 和晚期年龄集 $L$，以构建两个各自的生育力调度 $\\{m_x^{(E)}\\}$ 和 $\\{m_x^{(L)}\\}$。\n\n3.  **求解内禀增长率 ($r$)**：\n    在确定了存活率 ($l_x$) 和生育力 ($m_x^{(S)}$) 调度后，我们必须求解 Euler-Lotka 方程以得到内禀增长率 $r_S$。将 $m_x^{(S)}$ 的表达式代入方程得到：\n    $$\n    \\sum_{x \\in S} l_x \\left( \\frac{R_0}{\\sum_{a \\in S} l_a} \\right) e^{-r_S x} = 1\n    $$\n    整理后，问题变为找到函数 $g_S(r)$ 的根 $r_S$：\n    $$\n    g_S(r) = R_0 \\sum_{x \\in S} l_x e^{-r x} - \\sum_{a \\in S} l_a = 0\n    $$\n    函数 $g_S(r)$ 相对于 $r$ 是单调递减的，因为其导数 $g_S'(r) = -R_0 \\sum_{x \\in S} x l_x e^{-r x}$ 对于任何非平凡的调度都是严格为负的。这种单调性保证了唯一的实数根。\n    我们注意到 $g_S(0) = (R_0 - 1) \\sum_{a \\in S} l_a$。\n    -   如果 $R_0 > 1$，则 $g_S(0) > 0$。当 $r \\to \\infty$ 时，$g_S(r) \\to -\\sum l_a  0$。因此，存在一个唯一的正根 $r_S$。\n    -   如果 $R_0  1$，则 $g_S(0)  0$。当 $r \\to -\\infty$ 时，$g_S(r) \\to \\infty$。因此，存在一个唯一的负根 $r_S$。\n    -   如果 $R_0 = 1$，则 $g_S(0) = 0$，这立即得出解 $r_S = 0$。\n\n    对于 $R_0 \\neq 1$ 的情况，需要一个数值求根算法。二分法，或更高效的 Brent 方法，适合在指定区间内找到这个表现良好的单调函数的根。$g_S(0)$ 的分析为选择合适的搜索区间提供了信息，例如对于 $R_0 > 1$ 选择 $[0, A]$，对于 $R_0  1$ 选择 $[-A, 0]$，其中 $A$ 是一个足够大的正常数。\n\n4.  **最终比较和报告**：\n    为每个测试用例计算出 $r_E$ 和 $r_L$ 后，对这些值进行比较。如果 $r_E > r_L$，则指标变量设为 $1$，否则设为 $0$。$r_E$ 和 $r_L$ 的值被四舍五入到六位小数，然后将结果编译成指定的列表的列表格式进行输出。对所有提供的测试用例重复此过程。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Implements and applies a numerical method to compare intrinsic rates of increase \n    for pairs of life-history schedules sharing the same net reproductive rate.\n    \"\"\"\n    test_cases = [\n        {\n            # Case A\n            \"s_x\": [0.7, 0.8, 0.8, 0.75],\n            \"R0\": 1.6,\n            \"E\": {1, 2},\n            \"L\": {3, 4}\n        },\n        {\n            # Case B\n            \"s_x\": [0.4, 0.9, 0.95, 0.95],\n            \"R0\": 1.2,\n            \"E\": {1},\n            \"L\": {4}\n        },\n        {\n            # Case C\n            \"s_x\": [0.95] * 9,\n            \"R0\": 1.05,\n            \"E\": {2, 3},\n            \"L\": {8, 9}\n        },\n        {\n            # Case D (boundary condition)\n            \"s_x\": [0.5, 0.9, 0.9],\n            \"R0\": 1.0,\n            \"E\": {1, 2},\n            \"L\": {3}\n        }\n    ]\n\n    # This list will store the string-formatted result for each case\n    all_results_str = []\n\n    for case in test_cases:\n        s_x_list = case[\"s_x\"]\n        R0 = case[\"R0\"]\n        E = case[\"E\"]\n        L = case[\"L\"]\n        \n        omega = len(s_x_list)\n        s_x = np.array(s_x_list)\n        \n        # 1. Compute survivorship schedule l_x\n        l_x = np.zeros(omega + 1)\n        l_x[0] = 1.0\n        for x in range(omega):\n            l_x[x+1] = l_x[x] * s_x[x]\n\n        def calculate_r(schedule_ages, R0_val, lx_vals):\n            \"\"\"\n            Calculates the intrinsic rate of increase 'r' for a given schedule.\n            \n            Args:\n                schedule_ages (set): The set of ages for reproduction.\n                R0_val (float): The net reproductive rate.\n                lx_vals (np.ndarray): The survivorship schedule.\n\n            Returns:\n                float: The intrinsic rate of increase, r.\n            \"\"\"\n            # Handle boundary case where R_0 = 1, which implies r = 0\n            if np.isclose(R0_val, 1.0):\n                return 0.0\n\n            ages = np.array(list(schedule_ages))\n            sum_l = np.sum(lx_vals[ages])\n\n            # Define the function whose root we need to find, based on the Euler-Lotka equation:\n            # g(r) = R0 * sum(l_x * exp(-r*x)) - sum(l_x) = 0\n            def euler_lotka_func(r):\n                return R0_val * np.sum(lx_vals[ages] * np.exp(-r * ages)) - sum_l\n\n            # Find the root numerically using Brent's method\n            # The search interval is determined by whether R0 > 1 (r > 0) or R0  1 (r  0)\n            if R0_val > 1.0:\n                # For R0 > 1, r is positive. g(0) is positive, and g(r) decreases.\n                # A sufficiently large upper bound ensures the function becomes negative.\n                bracket = [0.0, 10.0]\n            else: # R0_val  1.0\n                # For R0  1, r is negative. g(0) is negative, and g(r) increases as r becomes more negative.\n                bracket = [-10.0, 0.0]\n            \n            try:\n                # Use a tight tolerance for high accuracy before rounding\n                r_val = brentq(euler_lotka_func, bracket[0], bracket[1], xtol=1e-12, rtol=1e-12)\n            except ValueError:\n                # This should not happen for a valid problem setup\n                r_val = np.nan\n                \n            return r_val\n\n        # 2. Compute r_E and r_L for the early and late schedules\n        r_E = calculate_r(E, R0, l_x)\n        r_L = calculate_r(L, R0, l_x)\n        \n        # 3. Compute the indicator\n        # Note: Direct comparison is safe here as we are not checking for equality\n        indicator = 1 if r_E > r_L else 0\n        \n        # 4. Format results as a string and append to the list\n        case_result_str = f\"[{r_E:.6f},{r_L:.6f},{indicator}]\"\n        all_results_str.append(case_result_str)\n\n    # 5. Print the final combined output in the specified single-line format\n    print(f\"[{','.join(all_results_str)}]\")\n\nsolve()\n```", "id": "2728454"}, {"introduction": "生命史分析的最终目标之一是从描述性转向预测性。在分析了一个给定生命史的动态之后，一个核心的进化问题是：“哪个生命史性状的微小改变会对适合度（fitness）产生最大的影响？” 这项练习 [@problem_id:2728457] 引入了弹性分析（elasticity analysis），这是一种强大的微扰方法，用于量化适合度代理指标 $\\lambda$ 对不同生命率（vital rates）变化的相对敏感性。通过计算和比较不同生命率的弹性，你将学会如何识别哪些性状承受着最强的选择压力，从而预测种群的进化方向。", "problem": "考虑一个具有三个离散阶段的阶段结构化种群：幼体 ($1$)、亚成体 ($2$) 和成体 ($3$)。假设在低密度下的动态是密度无关的，因此长期人均增长率（适应度代理）由阶段结构化种群预测矩阵的主特征值 $\\,\\lambda\\,$ 给出。生命率参数化如下：在一个时间步内，幼体有概率 $g_{1}$ 保持为幼体，或有概率 $m_{1}$ 成熟为亚成体；亚成体有概率 $g_{2}$ 保持为亚成体，或有概率 $m_{2}$ 成熟为成体；成体有概率 $g_{3}$ 存活并保持为成体；成体产生 $F$ 个新生个体进入幼体阶段。\n\n两种生活史在幼体存活率和成体繁殖力上有所不同，但亚成体和成体的转移过程保持相同：\n- 生活史 1：$g_{1} = 0.05$, $m_{1} = 0.30$, $g_{2} = 0.30$, $m_{2} = 0.50$, $g_{3} = 0.60$, $F = 6$。\n- 生活史 2：$g_{1} = 0.40$, $m_{1} = 0.30$, $g_{2} = 0.30$, $m_{2} = 0.50$, $g_{3} = 0.60$, $F = 2$。\n\n因此，种群预测矩阵为\n$$\n\\mathbf{A}_{1} \\;=\\; \n\\begin{pmatrix}\n0.05  0  6 \\\\\n0.30  0.30  0 \\\\\n0  0.50  0.60\n\\end{pmatrix},\n\\qquad\n\\mathbf{A}_{2} \\;=\\; \n\\begin{pmatrix}\n0.40  0  2 \\\\\n0.30  0.30  0 \\\\\n0  0.50  0.60\n\\end{pmatrix}.\n$$\n\n从结构化种群理论的核心定义出发，对每种生活史执行以下操作：\n1. 计算主特征值 $\\,\\lambda\\,$ 及其相关的右特征向量 $\\,\\mathbf{w}\\,$（稳定阶段分布）和左特征向量 $\\,\\mathbf{v}\\,$（繁殖价值向量），仅在评估敏感度所需时进行归一化。\n2. 使用弹性（elasticity）的正式定义，即 $\\,\\lambda\\,$ 对生命率（矩阵元素）成比例变化的比例敏感度，计算 $\\,\\lambda\\,$ 对成体繁殖力 $F$（即元素 $a_{13}$）和对幼体停滞率 $g_{1}$（即元素 $a_{11}$）的弹性。对每种生活史，将这些弹性表示为 $e_{F}$ 和 $e_{g_{1}}$。\n3. 根据弹性，预测在低密度下，对于每种生活史，哪种生命率变化（$F$ 的小比例增加与 $g_{1}$ 的小比例增加相比）会受到最强的选择偏好。这里基于一个标准假设：当成本以比例尺度衡量时，选择会沿着最大弹性方向最快地增加 $\\,\\lambda\\,$。\n\n最后，报告单个数值\n$$\nR \\;=\\; \\frac{e_{F}^{(1)}}{e_{g_{1}}^{(1)}},\n$$\n其中上标 $(1)$ 表示生活史 1。将您报告的 $R$ 值四舍五入至四位有效数字。最终答案以无单位的纯数表示。", "solution": "该问题要求使用阶段结构化种群预测矩阵对两种生活史进行分析。此分析的核心依赖于这些矩阵的特征值和特征向量的性质。\n\n设 $\\mathbf{A}$ 为一个种群预测矩阵，其中元素 $a_{ij}$ 表示在一个时间步内，阶段 $j$ 的个体对阶段 $i$ 的人均贡献。长期、密度无关的种群动态由主特征值 $\\lambda$ 及其对应的右特征向量 $\\mathbf{w}$ 和左特征向量 $\\mathbf{v}$ 描述。\n$$ \\mathbf{A} \\mathbf{w} = \\lambda \\mathbf{w} \\quad \\text{和} \\quad \\mathbf{v}^T \\mathbf{A} = \\lambda \\mathbf{v}^T $$\n这里，$\\lambda$ 是渐近种群增长率，$\\mathbf{w}$ 是稳定阶段分布（每个阶段个体数量的比例），$\\mathbf{v}$ 是繁殖价值向量（每个阶段的个体对未来种群增长的相对贡献）。\n\n种群增长率 $\\lambda$ 对矩阵元素 $a_{ij}$ 变化的敏感度由下式给出\n$$ s_{ij} = \\frac{\\partial \\lambda}{\\partial a_{ij}} = \\frac{v_i w_j}{\\langle \\mathbf{v}, \\mathbf{w} \\rangle} $$\n其中 $\\langle \\mathbf{v}, \\mathbf{w} \\rangle = \\sum_k v_k w_k$ 是左右特征向量的标量积。弹性 $e_{ij}$ 是比例敏感度，它衡量 $\\lambda$ 对于 $a_{ij}$ 的比例变化的比例变化：\n$$ e_{ij} = \\frac{a_{ij}}{\\lambda} \\frac{\\partial \\lambda}{\\partial a_{ij}} = \\frac{a_{ij}}{\\lambda} \\frac{v_i w_j}{\\langle \\mathbf{v}, \\mathbf{w} \\rangle} $$\n弹性用于评估不同生命率对种群增长的相对重要性。在低密度下，选择将最强烈地偏好具有最高弹性的生命率的变化。\n\n这个三阶段系统的种群预测矩阵的一般形式是\n$$ \\mathbf{A} = \\begin{pmatrix} g_1  0  F \\\\ m_1  g_2  0 \\\\ 0  m_2  g_3 \\end{pmatrix} $$\n特征方程为 $\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$，展开后为：\n$$ (g_1 - \\lambda)(g_2 - \\lambda)(g_3 - \\lambda) + F m_1 m_2 = 0 $$\n$$ (\\lambda - g_1)(\\lambda - g_2)(\\lambda - g_3) = F m_1 m_2 $$\n\n我们现在将此框架应用于每种生活史。\n\n**生活史 1 的分析**\n矩阵为\n$$ \\mathbf{A}_{1} = \\begin{pmatrix} 0.05  0  6 \\\\ 0.30  0.30  0 \\\\ 0  0.50  0.60 \\end{pmatrix} $$\n参数为 $g_1 = 0.05$, $m_1 = 0.30$, $g_2 = 0.30$, $m_2 = 0.50$, $g_3 = 0.60$ 和 $F = 6$。特征方程为\n$$ (\\lambda - 0.05)(\\lambda - 0.30)(\\lambda - 0.60) = (6)(0.30)(0.50) = 0.9 $$\n$$ \\lambda^3 - 0.95\\lambda^2 + 0.225\\lambda - 0.909 = 0 $$\n数值求解此三次方程以获得主（最大正实）根，得到 $\\lambda_1 \\approx 1.30896$。\n\n为求右特征向量 $\\mathbf{w}^{(1)}$，我们求解 $(\\mathbf{A}_1 - \\lambda_1 \\mathbf{I})\\mathbf{w}^{(1)} = \\mathbf{0}$。我们设 $w_1 = 1$：\n从第二行：$0.30 w_1 + (0.30 - \\lambda_1) w_2 = 0 \\implies w_2 = \\frac{0.30}{\\lambda_1 - 0.30} w_1 = \\frac{0.30}{1.30896 - 0.30} \\approx 0.29734$。\n从第三行：$0.50 w_2 + (0.60 - \\lambda_1) w_3 = 0 \\implies w_3 = \\frac{0.50}{\\lambda_1 - 0.60} w_2 = \\frac{0.50}{1.30896 - 0.60} (0.29734) \\approx 0.20969$。\n所以，$\\mathbf{w}^{(1)} \\propto \\begin{pmatrix} 1 \\\\ 0.29734 \\\\ 0.20969 \\end{pmatrix}$。\n\n为求左特征向量 $\\mathbf{v}^{(1)}$，我们求解 $\\mathbf{v}^{(1)T}(\\mathbf{A}_1 - \\lambda_1 \\mathbf{I}) = \\mathbf{0}^T$。我们设 $v_1=1$：\n从第一列：$(0.05 - \\lambda_1) v_1 + 0.30 v_2 = 0 \\implies v_2 = \\frac{\\lambda_1 - 0.05}{0.30} v_1 = \\frac{1.30896 - 0.05}{0.30} \\approx 4.19653$。\n从第二列：$(0.30 - \\lambda_1) v_2 + 0.50 v_3 = 0 \\implies v_3 = \\frac{\\lambda_1 - 0.30}{0.50} v_2 = \\frac{1.30896 - 0.30}{0.50} (4.19653) \\approx 8.46823$。\n所以，$\\mathbf{v}^{(1)T} \\propto \\begin{pmatrix} 1  4.19653  8.46823 \\end{pmatrix}$。\n\n标量积为：\n$$ \\langle \\mathbf{v}^{(1)}, \\mathbf{w}^{(1)} \\rangle = (1)(1) + (4.19653)(0.29734) + (8.46823)(0.20969) \\approx 1 + 1.24783 + 1.77573 \\approx 4.02359 $$\n\n弹性为：\n$e_{F}^{(1)} = e_{13}^{(1)} = \\frac{a_{13}^{(1)}}{\\lambda_1} \\frac{v_1^{(1)} w_3^{(1)}}{\\langle \\mathbf{v}^{(1)}, \\mathbf{w}^{(1)} \\rangle} = \\frac{6}{1.30896} \\frac{(1)(0.20969)}{4.02359} \\approx 4.5835 \\times 0.05212 \\approx 0.23891$。\n$e_{g_1}^{(1)} = e_{11}^{(1)} = \\frac{a_{11}^{(1)}}{\\lambda_1} \\frac{v_1^{(1)} w_1^{(1)}}{\\langle \\mathbf{v}^{(1)}, \\mathbf{w}^{(1)} \\rangle} = \\frac{0.05}{1.30896} \\frac{(1)(1)}{4.02359} \\approx 0.03819 \\times 0.24853 \\approx 0.009492$。\n\n由于 $e_{F}^{(1)} (0.23891) > e_{g_1}^{(1)} (0.009492)$，与幼体停滞率 $g_1$ 的小比例增加相比，成体繁殖力 $F$ 的小比例增加会受到更强的选择偏好。\n\n**生活史 2 的分析**\n矩阵为\n$$ \\mathbf{A}_{2} = \\begin{pmatrix} 0.40  0  2 \\\\ 0.30  0.30  0 \\\\ 0  0.50  0.60 \\end{pmatrix} $$\n特征方程为 $(\\lambda - 0.40)(\\lambda - 0.30)(\\lambda - 0.60) = (2)(0.30)(0.50) = 0.3$。\n$$ \\lambda^3 - 1.3\\lambda^2 + 0.54\\lambda - 0.372 = 0 $$\n主特征值为 $\\lambda_2 \\approx 1.11538$。遵循与生活史 1 相似的计算：\n$\\mathbf{w}^{(2)} \\propto \\begin{pmatrix} 1 \\\\ 0.3680 \\\\ 0.3570 \\end{pmatrix}$，$\\mathbf{v}^{(2)T} \\propto \\begin{pmatrix} 1  2.3846  3.8893 \\end{pmatrix}$。\n标量积为 $\\langle \\mathbf{v}^{(2)}, \\mathbf{w}^{(2)} \\rangle \\approx 3.2657$。\n弹性为：\n$e_{F}^{(2)} = e_{13}^{(2)} = \\frac{2}{1.11538} \\frac{(1)(0.3570)}{3.2657} \\approx 0.1962$。\n$e_{g_1}^{(2)} = e_{11}^{(2)} = \\frac{0.40}{1.11538} \\frac{(1)(1)}{3.2657} \\approx 0.1098$。\n由于 $e_{F}^{(2)} (0.1962) > e_{g_1}^{(2)} (0.1098)$，选择将再次更强烈地偏好繁殖力 $F$ 的比例增加。\n\n**R 的最终计算**\n问题要求计算比率 $R = \\frac{e_{F}^{(1)}}{e_{g_{1}}^{(1)}} = \\frac{e_{13}^{(1)}}{e_{11}^{(1)}}$。\n使用弹性的定义：\n$$ R = \\frac{\\frac{a_{13}^{(1)}}{\\lambda_1} \\frac{v_1^{(1)} w_3^{(1)}}{\\langle \\mathbf{v}^{(1)}, \\mathbf{w}^{(1)} \\rangle}}{\\frac{a_{11}^{(1)}}{\\lambda_1} \\frac{v_1^{(1)} w_1^{(1)}}{\\langle \\mathbf{v}^{(1)}, \\mathbf{w}^{(1)} \\rangle}} = \\frac{a_{13}^{(1)}}{a_{11}^{(1)}} \\frac{w_3^{(1)}}{w_1^{(1)}} = \\frac{F_1}{g_1^{(1)}} \\frac{w_3^{(1)}}{w_1^{(1)}} $$\n该表达式避免了计算左特征向量 $\\mathbf{v}$ 和标量积的需要。从特征向量方程 $\\mathbf{A}_1 \\mathbf{w}^{(1)} = \\lambda_1 \\mathbf{w}^{(1)}$ 的第一行：\n$$ a_{11}^{(1)} w_1^{(1)} + a_{13}^{(1)} w_3^{(1)} = \\lambda_1 w_1^{(1)} \\implies F_1 w_3^{(1)} = (\\lambda_1 - g_1^{(1)}) w_1^{(1)} $$\n将此代入 $R$ 的表达式中：\n$$ R = \\frac{1}{g_1^{(1)}} \\left( F_1 \\frac{w_3^{(1)}}{w_1^{(1)}} \\right) = \\frac{1}{g_1^{(1)}} (\\lambda_1 - g_1^{(1)}) = \\frac{\\lambda_1 - g_1^{(1)}}{g_1^{(1)}} $$\n这提供了一种直接且更稳健的计算 $R$ 的方法，仅使用主特征值 $\\lambda_1$ 和参数 $g_1^{(1)}$。\n使用精确计算的值 $\\lambda_1 \\approx 1.30896$：\n$$ R = \\frac{1.30896 - 0.05}{0.05} = \\frac{1.25896}{0.05} = 25.1792 $$\n四舍五入到四位有效数字，结果是 $25.18$。\n该值与完整弹性计算得出的比率一致：$R \\approx \\frac{0.23891}{0.009492} \\approx 25.17$。", "answer": "$$ \\boxed{25.18} $$", "id": "2728457"}]}