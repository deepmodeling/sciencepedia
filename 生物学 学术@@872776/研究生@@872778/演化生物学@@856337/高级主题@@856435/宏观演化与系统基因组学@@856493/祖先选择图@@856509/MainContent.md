## 引言
自然选择是驱动进化的核心力量，但它如何精确地在基因组上留下可追溯的印记，一直是群体遗传学研究的中心问题。经典的[溯祖理论](@entry_id:155051)，如[Kingman溯祖](@entry_id:169191)模型，为我们理解中性进化下的[基因谱系](@entry_id:172451)提供了简洁优美的框架，然而，一旦引入选择，该模型的数学前提便被打破，导致我们无法直接追踪祖先历史。为了填补这一理论空白，[祖先选择图](@entry_id:190455)（Ancestral Selection Graph, ASG）应运而生，它提供了一个革命性的视角，使我们能够在存在选择的情况下，严谨地构建和分析[基因谱系](@entry_id:172451)。

本文将系统地引导您深入掌握[祖先选择图](@entry_id:190455)的理论精髓与实践应用。在“原理与机制”一章中，我们将从选择为何对标准[溯祖模型](@entry_id:202220)构成挑战讲起，详细拆解ASG的核心事件——溯祖与分支，并探讨其与前向时间扩散过程的深刻对偶关系。随后，在“应用与跨学科联系”一章中，我们将展示ASG如何成为连接进化过程与遗传变异模式的桥梁，并探讨其在检测正选择、[背景选择](@entry_id:167635)，以及建模更复杂场景（如适应性渐渗）中的强大功能。最后，“实践练习”部分将提供一系列精心设计的问题，帮助您将理论知识转化为解决实际问题的能力。让我们首先深入其核心，探究ASG的基本原理与精巧机制。

## 原理与机制

本章旨在深入阐释[祖先选择图](@entry_id:190455)（Ancestral Selection Graph, ASG）的核心原理与基本机制。我们将从经典的**中性[溯祖模型](@entry_id:202220)（neutral coalescent model）**出发，探讨为何在存在自然选择时该模型不再适用，并由此引出构建ASG的必要性。随后，我们将详细剖析ASG的两个关键事件——**溯祖（coalescence）**与**分支（branching）**——的速率与发生机制。最后，我们将探讨ASG的动态性质、如何从ASG中提取真实的谱系，并介绍其在更复杂进化场景（如显性与重组）下的扩展。

### 作为基准的中性[溯祖模型](@entry_id:202220)

在深入研究选择的影响之前，我们必须首先理解在没有[选择压力](@entry_id:175478)时，群体样本的祖先关系是如何被建模的。这一基准模型即为**[Kingman溯祖](@entry_id:169191)模型（Kingman's coalescent）**。考虑一个大小为 $N$ 的单倍体赖特-费舍尔（Wright-Fisher）群体，其世代不重叠、[随机交配](@entry_id:149892)且后代数量的[方差](@entry_id:200758)有限。当我们从当前群体中抽取一个大小为 $n$ 的样本，并向过去追溯其祖先时，在恰当的[时间尺度变换](@entry_id:190118)下，其谱系会收敛到一个连续时间的[随机过程](@entry_id:159502)。

这个过程的核心思想是，随着时间回溯，样本中的祖先谱系会因随机的[遗传漂变](@entry_id:145594)而逐一合并。具体来说，当存在 $k$ 条独立的祖先谱系时，任意两条谱系在上一代找到共同祖先的概率很小，但随着时间的累积，这种合并事件必然会发生。为了在 $N \to \infty$ 的极限下得到一个非平凡的[连续时间过程](@entry_id:274437)，我们需要将时间以 $N$ 代为单位进行度量（对于[二倍体](@entry_id:268054)群体，则为 $2N$ 代）。在该尺度下，谱系合并事件的发生遵循以下规律 [@problem_id:2756018]：

-   当存在 $k$ 条祖先谱系时，下一次**溯祖事件**（即两条谱系合并为一条）的等待时间服从速率为 $\binom{k}{2}$ 的[指数分布](@entry_id:273894)。
-   发生合并时，任意一对谱系被选中的概率是均等的。

这个过程是一个纯粹的“死亡”过程，谱系数量从 $n$ 开始，经过一系列成对合并，最终在**[最近共同祖先](@entry_id:136722)（Most Recent Common Ancestor, MRCA）**处减少为1。[Kingman溯祖](@entry_id:169191)模型的简洁与强大源于其严格的假设：**选择中性**、**恒定的群体大小**、**后代数量的[方差](@entry_id:200758)有限**（排除了单个祖先贡献过多后代的可能性，从而避免了多条谱系同时合并）以及**不重叠的世代** [@problem_id:2756018]。

### 选择带来的挑战：为何标准[溯祖模型](@entry_id:202220)不再适用

当自然选择介入时，上述简洁的图景被打破。在正向时间中，携带有利等位基因的个体有更高的概率产生后代。这破坏了所有个体作为亲本被选择的均等性。当我们[回溯时间](@entry_id:260844)时，这一偏差带来了根本性的挑战。

考虑一个谱系，在回溯时我们需要确定其亲本。在中性模型中，群体中的任何个体都有同等可能成为其亲本。然而，在选择模型中，一个谱系的亲本更有可能是在前一世代中携带了有利等位基因的个体。问题在于，当我们[回溯时间](@entry_id:260844)时，祖先的等位基因类型是未知的。这意味着，一个谱系回溯到特定亲本的转移概率，将取决于我们尚不知道的“未来”信息（即更遥远的过去中祖先的基因型）。

这种对未来信息的依赖性，破坏了谱系过程的**马尔可夫性质（Markov property）**。马尔可夫性质要求过程的未来状态仅取决于其当前状态，而与过去无关。在中性[溯祖模型](@entry_id:202220)中，事件发生的速率仅取决于当前谱系的数目 $k$。但在选择模型中，如果只追踪谱系本身，速率将依赖于未知的祖先基因型，这使得模型在数学上变得难以处理。因此，我们需要一个能够绕过此困难、在不预知祖先基因型的情况下描述谱系演化的新框架 [@problem_id:2756048]。

### [祖先选择图](@entry_id:190455)（ASG）：一个新的框架

为解决上述问题，Krone和Neuhauser提出了**[祖先选择图](@entry_id:190455)（Ancestral Selection Graph, ASG）**。其核心创举在于，不再试[图追踪](@entry_id:263851)唯一的真实祖先谱系，而是构建一个包含所有**潜在祖先（potential ancestors）**的图结构。这个图是通过在标准溯祖事件的基础上，引入一种全新的事件类型——**分支（branching）**——来实现的 [@problem_id:2756048]。

一个分支事件代表了在过去可能发生过选择性生殖的时刻。[回溯时间](@entry_id:260844)来看，一条谱系在此处会分裂成两条或多条潜在的祖先路径。通过囊括所有这些可能性，ASG构建了一个不依赖于未知基因型的、具有[马尔可夫性质](@entry_id:139474)的[随机过程](@entry_id:159502)。真实的谱系，作为该图的一个[子集](@entry_id:261956)，可以在图构建完成之后，通过一个“修剪”步骤被确定下来。

### ASG的核心机制

ASG是一个在[回溯时间](@entry_id:260844)中演化的图，其动态由两种[基本事件](@entry_id:265317)驱动：溯祖和分支。

#### 事件类型与速率

在一个拥有 $k$ 条潜在祖先谱系的ASG中，事件的发生遵循以下规则：

1.  **溯祖（Coalescence）**：此事件由遗传漂变引起，其机制与中性模型完全相同。任何一对谱系都以速率1合并，因此，当有 $k$ 条谱系时，总的溯祖速率为所有谱系对的速率之和，即 $\binom{k}{2}$。每次溯祖事件使谱系总数从 $k$ 减少到 $k-1$ [@problem_id:2756042]。

2.  **分支（Branching）**：此事件由选择驱动。在最简单的基因选择模型中，每个谱系都独立地以某个速率发生分支，该速率与选择强度成正比。

为了更精确地推导分支速率，我们可以考虑一个具体的模型。以连续时间的莫兰（Moran）模型为例，群体大小为 $N$，有利等位基因的[相对适应度](@entry_id:153028)为 $1+s$。我们可以将每个个体的生殖事件分解为两部分：一个速率为1的**中性生殖**过程，和一个仅对有利基因携带者生效的、速率为 $s$ 的**选择性生殖**过程。这可以通过一个精巧的“箭头”图解来构建 [@problem_id:2756041] [@problem_id:2756037]。

想象在任意两个个体 $i$ 和 $j$ 之间，存在两种独立的泊松过程产生的“箭头”：一种是以速率 $1/(N-1)$ 产生的**中性箭头**，代表 $i$ 的后代替换 $j$；另一种是以速率 $s/(N-1)$ 产生的**选择性箭头**，代表只有当 $i$ 携带有利等位基因时，其后代才会替换 $j$。在[回溯时间](@entry_id:260844)中，追踪一条位于 $j$ 的谱系，当中性箭头指向它时，它会“跳”到 $i$，这可能导致溯祖。而当选择性箭头指向它时，由于我们不知道祖先 $i$ 的基因型，我们无法确定替换事件是否真实发生。ASG的处理方式是：无论如何都记录这一潜在事件，即让谱系在 $j$ 处发生**分支**。一条分支继续追踪原位点的祖先（称为**持续分支**），另一条新的分支则追随箭头到达 $i$（称为**进入分支**）。

对于任意一条谱系，指向它的选择性箭头的总速率是多少？来自其他 $N-1$ 个潜在亲本的速率加总为 $(N-1) \times \frac{s}{N-1} = s$。因此，在[莫兰模型](@entry_id:195772)的时间单位下，每个谱系的分支速率为 $s$ [@problem_id:2756041]。

#### 与前向时间扩散过程的联系

ASG之所以重要，还在于它与前向时间的[等位基因频率](@entry_id:146872)动态构成了**对偶关系（duality）**。为了使[遗传漂变](@entry_id:145594)和弱选择的效应都能在极限中保留下来，我们需要采用**[扩散标度](@entry_id:263802)（diffusion scaling）**。具体而言，时间以 $N$ 代为单位进行度量（对于单倍体[赖特-费舍尔模型](@entry_id:148998)），同时[选择系数](@entry_id:155033) $s$ 被假定为弱的，其大小与 $1/N$ 成正比，即 $s_N = \sigma/N$，其中 $\sigma$ 是一个常数，称为**[群体选择](@entry_id:175784)系数**。

在此标度下，[等位基因频率](@entry_id:146872)的前向[演化过程](@entry_id:175749)收敛于一个**[赖特-费舍尔扩散](@entry_id:636145)过程（Wright-Fisher diffusion）**，其漂移（drift）项为 $\sigma x(1-x)$（代表选择），[扩散](@entry_id:141445)（diffusion）项的[方差](@entry_id:200758)为 $x(1-x)$（代表[遗传漂变](@entry_id:145594)）[@problem_id:2756056]。相应地，在[回溯时间](@entry_id:260844)的ASG中，每个谱系的分支速率恰好为 $\sigma$。因此，对于 $k$ 条谱系，总的分支速率为 $k\sigma$ [@problem_id:2756037] [@problem_id:2756042]。这个对偶关系是理论[群体遗传学](@entry_id:146344)中一个深刻而优美的结果，它将微观的个体谱系历史与宏观的群体等位基因频率动态联系在一起。

### ASG的动态与性质

#### 时间动态

ASG中事件的发生是泊松过程。当存在 $k$ 条谱系时，任何事件（溯祖或分支）发生的总速率是所有[独立事件](@entry_id:275822)速率的总和：
$$
\lambda_k = R_{\text{coal}} + R_{\text{branch}} = \frac{k(k-1)}{2} + k\sigma
$$
因此，从状态 $k$ 到下一个事件发生的等待时间 $T_k$ 服从参数为 $\lambda_k$ 的指数分布。其均值（[期望等待时间](@entry_id:274249)）为 [@problem_id:2756023]：
$$
E[T_k] = \frac{1}{\lambda_k} = \frac{1}{\frac{k(k-1)}{2} + k\sigma} = \frac{2}{k(k-1 + 2\sigma)}
$$
与中性[溯祖模型](@entry_id:202220)（$\sigma=0$）相比，正选择（$\sigma > 0$）增加了事件的总速率 $\lambda_k$，从而缩短了事件间的平均等待时间。这意味着在选择作用下，[谱系图](@entry_id:636481)中的事件发生得更频繁。

#### 修剪程序：从潜在到现实

ASG本身并非真实的物种或[基因谱系](@entry_id:172451)，而是一个包含了所有可能祖先路径的“脚手架”。为了得到唯一的、已实现的（realized）谱系，我们必须对这个图进行**修剪（pruning）**。

修剪过程的前提是，我们需要知道ASG所有分支上任意时刻的等位基因类型。这些类型信息可以通过在图上叠加一个独立的突变过程来生成，并从样本的已知基因型出发向过去“绘制”。一旦类型信息完备，修剪就成了一个确定性的程序，其规则如下 [@problem_id:2755989]：

1.  **对于溯祖事件**：两条谱系确定地合并为一条，其祖先谱系的类型由合并点之后的突变过程决定。
2.  **对于分支事件**：这是修剪的核心。在一个[分支点](@entry_id:166575)，我们需要决定保留“进入分支”还是“持续分支”。规则是：检查**进入分支**在分支发生时刻（[回溯时间](@entry_id:260844)的 $\tau^-$）的等位基因类型。
    -   如果进入分支携带**有利**等位基因，则表明前向时间中的选择性生殖事件是“真实的”。因此，进入分支是真正的祖先，持续分支被剪除。
    -   如果进入分支携带**中性或有害**等位基因，则表明它不具备选择优势，该选择性生殖事件是“虚拟的”。因此，谱系并未被替换，真正的祖先是持续分支，进入分支被剪除。

通过从样本（图的叶节点）开始，沿着图回溯并迭代应用此规则，所有不属于真实传递路径的“潜在”分支都将被移除，最终从复杂的ASG中雕刻出一棵唯一的谱系树。

### ASG框架的扩展

ASG的强大之处在于其理论框架的灵活性，可以被扩展以囊括更复杂的进化动力学。

#### 二倍性与显性

在二倍体群体中，选择的作用方式可能更复杂，因为存在**显性（dominance）**效应。考虑一个双等位[基因座](@entry_id:177958)位，基因型 $aa$, $Aa$ 和 $AA$ 的[相对适应度](@entry_id:153028)分别为 $1$, $1+hs$ 和 $1+s$。其中 $h$ 是[显性系数](@entry_id:183265)。

通过与前向[扩散过程](@entry_id:170696)生成元的对偶关系，可以推导出相应的ASG结构。选择项 $\alpha x(1-x)[h+(1-2h)x]$ 的数学形式，决定了ASG中选择事件的类型和速率。通过分解此表达式可以发现，需要引入两种不同的选择事件 [@problem_id:2756016]：

1.  **二元分支（Binary branching）**：每个谱系以与 $\alpha h$ 成正比的速率发生，使谱系数量 $k$ 变为 $k+1$。
2.  **三元分支（Ternary branching）**：每个谱系以与 $\alpha(1-2h)$ 成正比的速率发生，使谱系数量 $k$ 变为 $k+2$。

特别地，当 $h > 1/2$（[超显性](@entry_id:268017)或部分显性）时，三元分支的速率会变为负数。在ASG的数学解释中，一个负速率的产生事件等价于一个正速率的**消除或修剪事件**。这表明，ASG能够通过引入不同类型的分支和修剪事件，精确地映射复杂的显性[遗传模式](@entry_id:137802)。

#### 祖先重[组选择](@entry_id:175784)图（ARSG）

当考虑两个或更多连锁的[基因座](@entry_id:177958)时，**重组（recombination）**成为影响谱系历史的第三种基本力量。将重组整合进ASG，便得到了**祖先重[组选择](@entry_id:175784)图（Ancestral Recombination-Selection Graph, ARSG）** [@problem_id:2755997]。

在ARSG中，每个谱系都需要一个标签来注明它所代表的祖先区域（例如，位点 $A$ 的祖先、位点 $B$ 的祖先，或两者共同的祖先）。ARSG的演化由三种事件共同驱动：

1.  **溯祖**：速率与标准模型相同。只有当两条谱系在至少一个位点上共享祖先时才能发生合并。合并后的新谱系将继承两个亲本谱系标签的并集。

2.  **重组**：仅作用于携带多个位点祖先信息的谱系。一个携带 $\{A, B\}$ 标签的谱系，会以与群体重组率 $\rho = 4Nr$ 成正比的速率（具体为 $\rho/2$）分裂成两条独立的谱系，分别标记为 $\{A\}$ 和 $\{B\}$。

3.  **选择性分支**：仅作用于携带受选择位点（例如 $A$）的谱系。分支速率与[群体选择](@entry_id:175784)系数 $\alpha$ 成正比。当一个谱系分支时，产生的所有新分支（进入分支和持续分支）都将继承其亲本谱系的完整标签集。例如，一条 $\{A, B\}$ 谱系分支后会产生两条 $\{A, B\}$ 谱系。

ARSG的构建清晰地展示了ASG框架的模块化特性，它允许我们将遗传漂变、选择和重组这三种主要的进化力量，统一在一个连贯的、数学上严谨的谱系历史框架之中。