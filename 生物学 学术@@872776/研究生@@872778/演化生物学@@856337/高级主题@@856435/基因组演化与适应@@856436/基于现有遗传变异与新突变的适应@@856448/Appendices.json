{"hands_on_practices": [{"introduction": "区分适应是源于新突变（NM）还是源于存量遗传变异（SGV）是群体遗传学中的一个核心挑战。这两种截然不同的演化历史，在某些参数条件下，可能在单个时间点上产生无法区分的等位基因频率，这种现象称为模型拟态。本练习将引导你推导这种拟态现象发生的条件[@problem_id:2688422]，从而揭示为何更丰富的数据类型（如时间序列数据或单倍型结构）对于进行可靠的推断至关重要。", "problem": "一个有效种群大小为 $N$ 的大型单倍体种群在时间 $t=0$ 时经历了一次突然的环境变化，这使得一个特定的等位基因变得有利，其选择系数为 $s0$。考虑该适应性等位基因起源的两种替代模型：\n\n- 既存遗传变异 (SGV) 模型：在 $t=0$ 时，该等位基因已存在，频率为 $p_0 \\in (0,1)$。\n- 新生复发突变模型：在 $t=0$ 时，该等位基因不存在，而是以每基因组每代 $U_b$ 个突变的速率由新的有利突变产生。\n\n假设世代不重叠、随机交配、无显性（单倍体），并且 $N$ 足够大，$s$ 足够小，以至于在选择性清除的早期阶段（当 $p(t) \\ll 1$ 时），以下经过充分检验的近似方法适用：\n\n- 有利等位基因的确定性选择动态满足 $dp/dt = s\\,p\\,(1-p)$，当 $p \\ll 1$ 时，这简化为 $dp/dt \\approx s\\,p$。\n- 一个选择系数为 $s$ 的新生有利突变体的固置概率约为 $2s$。\n- 当一个新的有利谱系逃脱遗传漂变时，它以一个数量级为 $p^{\\ast} \\approx \\frac{1}{2 N s}$ 的有效频率进入确定性增长阶段。\n- 在具有复发性有利突变输入的新生模型中，这种已固置谱系出现的速率为 $N U_b \\times 2s$，并且在 $p \\ll 1$ 的情况下，它们对等位基因频率动态的总贡献可以表示为一个恒定的流入项。\n\n设 $T0$ 为一个固定的观察时间（以代为单位）。仅使用这些基础，完成以下任务：\n\n1. 在 SGV 模型下推导早期阶段的预期等位基因频率轨迹 $p_{\\mathrm{SGV}}(t)$，以及在新生模型下推导 $p_{\\mathrm{DN}}(t)$。\n2. 通过要求 $p_{\\mathrm{SGV}}(T) = p_{\\mathrm{DN}}(T)$，符号求解 $U_b^{\\ast}$ 的值（作为 $s$、$p_0$ 和 $T$ 的函数），使得两个模型在时间 $T$ 预测出相同的等位基因频率。以每基因组每代突变的单位报告您最终的 $U_b^{\\ast}$ 表达式。\n3. 根据您的推导，简要解释为什么在您找到的参数组合下，这两种模型可以在时间 $T$ 生成无法区分的数据，并指出至少两种可以在实践中区分这兩種模型的额外数据类型。您的解释不属于最终的数值或符号答案。\n\n您的最终答案必须是 $U_b^{\\ast}$ 的单个封闭形式解析表达式。无需四舍五入。", "solution": "所提出的问题是理论群体遗传学中一个标准的、定义明确的练习。它具有科学依据、内部一致，并要求应用基本原理。我们将开始推导。\n\n问题要求完成三项任务。我们按顺序解决它们。\n\n**1. 等位基因频率轨迹的推导**\n\n我们必须在等位基因频率 $p(t)$ 远小于 1 ($p(t) \\ll 1$) 的假设下，推导预期的等位基因频率轨迹 $p_{\\mathrm{SGV}}(t)$ 和 $p_{\\mathrm{DN}}(t)$。\n\n*   **既存遗传变异 (SGV) 模型：**\n    在此模型中，有利等位基因在时间 $t=0$ 时已存在于种群中，初始频率为 $p_{0}$。其动态由确定性选择决定。问题给出的选择性清除早期阶段的微分方程为：\n    $$\n    \\frac{dp}{dt} \\approx s p\n    $$\n    这是一个表示指数增长的一阶线性常微分方程。在初始条件 $p(0) = p_{0}$下，通过直接积分求得解：\n    $$\n    \\int_{p_{0}}^{p_{\\mathrm{SGV}}(t)} \\frac{dp}{p} = \\int_{0}^{t} s \\, d\\tau\n    $$\n    $$\n    \\ln\\left(\\frac{p_{\\mathrm{SGV}}(t)}{p_{0}}\\right) = st\n    $$\n    两边取指数，得到 SGV 模型的轨迹：\n    $$\n    p_{\\mathrm{SGV}}(t) = p_{0} \\exp(st)\n    $$\n\n*   **新生复发突变 (DN) 模型：**\n    在此模型中，等位基因在 $t=0$ 时不存在，因此 $p(0) = 0$。新的有利等位基因以每基因组每代 $U_b$ 的速率通过突变产生。这些新突变体必须逃脱随机损失（遗传漂变），才能对确定性的频率增加做出贡献。问题指出，一个新突变体以概率 $2s$ 固置，因此在大小为 $N$ 的种群中，*已固置*谱系的出现速率为 $N U_b \\times 2s$。\n    \n    问题进一步指出，这些不断出现的新谱系的总贡献可以在等位基因频率动态中建模为一个恒定的流入项。等位基因频率的增加速率 $dp/dt$ 是两项之和：现有有利等位基因的增长 ($s p$) 和来自新的、已固置突变的流入。\n    \n    在时间间隔 $dt$ 内，新固置谱系的数量为 $2 N s U_b dt$。每个这样的谱系在逃脱漂变后，实际上以 $p^{\\ast} \\approx \\frac{1}{2Ns}$ 的频率进入确定性阶段。因此，频率流入速率是谱系固置速率与每个谱系起始频率的乘积：\n    $$\n    \\text{Influx rate} = (2 N s U_b) \\times \\left(\\frac{1}{2Ns}\\right) = U_b\n    $$\n    这证实了 $U_b$ 是恒定的流入项。因此，DN 模型的控制微分方程为：\n    $$\n    \\frac{dp}{dt} = s p + U_b\n    $$\n    这是一个一阶线性非齐次微分方程。我们使用积分因子 $I(t) = \\exp\\left(-\\int s \\, dt\\right) = \\exp(-st)$ 来求解。将方程乘以 $I(t)$ 得：\n    $$\n    \\exp(-st)\\frac{dp}{dt} - s\\exp(-st)p = U_b \\exp(-st)\n    $$\n    左边是 $p(t)\\exp(-st)$ 关于 $t$ 的导数。\n    $$\n    \\frac{d}{dt}\\left(p(t)\\exp(-st)\\right) = U_b \\exp(-st)\n    $$\n    从 $\\tau=0$ 到 $\\tau=t$ 积分，并应用初始条件 $p(0)=0$：\n    $$\n    p_{\\mathrm{DN}}(t)\\exp(-st) - p_{\\mathrm{DN}}(0)\\exp(0) = \\int_{0}^{t} U_b \\exp(-s\\tau) \\, d\\tau\n    $$\n    $$\n    p_{\\mathrm{DN}}(t)\\exp(-st) = U_b \\left[ -\\frac{1}{s}\\exp(-s\\tau) \\right]_{0}^{t}\n    $$\n    $$\n    p_{\\mathrm{DN}}(t)\\exp(-st) = -\\frac{U_b}{s} (\\exp(-st) - \\exp(0)) = \\frac{U_b}{s} (1 - \\exp(-st))\n    $$\n    乘以 $\\exp(st)$ 得到 DN 模型的轨迹：\n    $$\n    p_{\\mathrm{DN}}(t) = \\frac{U_b}{s} (\\exp(st) - 1)\n    $$\n\n**2. 等效突变率 $U_b^{\\ast}$ 的计算**\n\n我们需要找到一个特定的突变率，我们称之为 $U_b^{\\ast}$，它使得两种模型在固定的观察时间 $T  0$ 预测出相同的等位基因频率。我们设定 $p_{\\mathrm{SGV}}(T) = p_{\\mathrm{DN}}(T)$：\n$$\np_{0} \\exp(sT) = \\frac{U_b^{\\ast}}{s} (\\exp(sT) - 1)\n$$\n求解 $U_b^{\\ast}$ 只是一个代数重排的问题：\n$$\nU_b^{\\ast} = s p_{0} \\frac{\\exp(sT)}{\\exp(sT) - 1}\n$$\n这个表达式提供了新生模型所需的有利突变率的值，以便在经过 $T$ 代选择后，与初始频率为 $p_0$ 的既存变异的最終频率相匹配。\n\n**3. 关于不可区分性的解释和区分数据**\n\n这两种截然不同的进化历史之所以能在单个时间点 $T$ 产生相同的等位基因频率，原因在于一个过程涉及单个、较老变异的长期指数增长，而另一个过程涉及大量不断出现的、较年轻变异的综合指数增长。SGV 模型的最终频率 $p_0 \\exp(sT)$ 是將初始状态 $p_0$ 在整个持续时间 $T$ 内放大的结果。DN 模型的最终频率 $\\frac{U_b}{s}(\\exp(sT)-1)$ 是许多谱系频率的总和，每个谱系都从小开始，并增长了小于或等于 $T$ 的时间。我们推导出的 $U_b^{\\ast}$ 等价关系显示了初始频率 $p_0$ 和突变率 $U_b$ 之间的精确数学权衡，这种权衡使得这两个不同的求和过程在时间 $T$ 产生相同的结果。仅在这个单一终点观察系统，无法解析其潜在的时间动态。\n\n在实践中要区分 SGV 模型和新生模型，需要对适应性等位基因的历史敏感的数据，而不仅仅是其最终频率。两种主要类型的数据会很有效：\n\n1.  **单倍型结构**：源于单个既存变異的适应（“硬清除”）意味着有利等位基因及其原始染色体上的一个大的连锁片段（单倍型）会横扫至高频。结果是在被选择的基因座周围形成一个遗传多样性极低的区域，几乎所有个体都携带相同的长程单倍型。相反，源于复发性新生突变的适应（“软清除”）意味着有利等位基因在多个不同的遗传背景上独立出现。因此，有利等位基因将存在于几种不同的单倍型上，被选择基因座周围的多样性降低程度将不那么严重。对样本个体中被选择位点周围的基因组区域进行测序，将揭示这种单倍型多样性的差异。\n\n2.  **时间序列等位基因频率数据**：如果能在到达 $T$ 之前的多个时间点测量等位基因频率（例如，通过古 DNA 或在实验室进化实验中），那么可以通过轨迹的函数形式来区分这两种模型。对于 SGV 模型，$\\ln(p(t))$ 对 $t$ 的图将是一条直线，$\\ln(p(t)) = \\ln(p_0) + st$，y 轴截距为 $\\ln(p_0)$。对于 DN 模型，相同的图将显示一条曲线，$\\ln(p(t)) = \\ln\\left(\\frac{U_b}{s}\\right) + \\ln(\\exp(st)-1)$，它对 $t$ 不是线性的，并且当 $t \\to 0$ 时会趋近于 $-\\infty$。将这些不同的数学模型拟合到时间序列数据上，将有助于进行稳健的模型选择。", "answer": "$$\n\\boxed{s p_{0} \\frac{\\exp(sT)}{\\exp(sT) - 1}}\n$$", "id": "2688422"}, {"introduction": "认识到单倍型结构有助于区分适应的起源后，本练习将深入探讨如何量化这些差异。我们将使用一个简化的溯祖模型来预测硬扫描（源于单个新突变）和软扫描（源于多个存量变异）如何在受选择位点周围留下不同的单倍型多样性特征。通过推导单倍型纯合度等常用汇总统计量的期望值[@problem_id:2688407]，你将为解释基因组数据和设计选择检验方法建立坚实的理论基础。", "problem": "考虑一个大小恒定为 $N$ 的随机交配单倍体 Wright–Fisher 种群，其中一个选择系数为 $s$ 的有益等位基因上升至固定。您分析的是距离受选择位点重组率为 $r$ (每代) 的一个焦点中性单倍型窗口。在适用包含选择和重组的结构化溯祖的强选择、稀有重组机制下进行研究，并对受选择位点的清除谱系使用星状近似。设 $X(t)$ 表示清除期间有益等位基因的确定性等位基因频率轨迹，并设标度重组率为 $\\rho = 2 N r$。在结构化溯祖模型下，中性窗口中一个抽样谱系在清除期间不从清除背景上重组下来的概率为\n$$\n\\lambda \\equiv \\exp\\!\\Big(-\\rho \\int_{0}^{T} X(t)\\,\\mathrm{d}t\\Big),\n$$\n其中 $T$ 是清除持续时间。假设焦点窗口足够短，以至于在清除期间窗口内的重组可以忽略不计。\n\n如下定义焦点窗口中单倍型样本频率谱上的单倍型纯合度统计量。设 $p_{1} \\ge p_{2} \\ge \\cdots \\ge p_{m}$ 为(大)样本中排序后的单倍型频率：\n- $H1 = \\sum_{i=1}^{m} p_{i}^{2}$,\n- $H12 = (p_{1} + p_{2})^{2} + \\sum_{i=3}^{m} p_{i}^{2}$,\n- $H2/H1 = \\dfrac{H1 - p_{1}^{2}}{H1}$.\n\n考虑两种清除起源：\n(i) 源于单一突变起源的硬清除，\n(ii) 源于既存遗传变异的软清除，在选择开始时有 $k$ 个奠基单倍型 ($k \\ge 2$)，它们在受选择位点的贡献形成一个频率向量 $\\mathbf{f} = (f_{1},\\dots,f_{k})$，且 $\\sum_{i=1}^{k} f_{i} = 1$。假设软清除具有对称性，因此对于所有 $i \\in \\{1,\\dots,k\\}$ 都有 $f_{i} = 1/k$。\n\n对固定后焦点窗口中的搭便车单倍型采用以下简化但标准的近似：\n- 一个抽样谱系在整个清除过程中保持与 $k$ 个清除奠基背景之一连锁的概率为 $\\lambda$；在连锁的条件下，它位于奠基背景 $i$ 上的概率为 $f_{i}$。\n- 一个抽样谱系在清除期间从清除背景上重组下来的概率为 $1-\\lambda$；由此产生的重组单倍型分布在非常大量的背景上，因此在大样本极限下，它们对纯合度的平方频率总贡献可以忽略不计。\n\n在这些假设下，推导在大样本极限中，对于 (ii) $k \\ge 2$ 个对称奠基者的情况，以及 (i) (硬清除，可视为 $k=1$ 且 $f_{1}=1$) 的情况，$H1$、$H12$ 和 $H2/H1$ 的期望值。将您的最终答案表示为一个单行矩阵，按以下顺序列出六个期望值：\n$$\n\\big(\\,\\mathbb{E}[H1]_{\\mathrm{soft}},\\ \\mathbb{E}[H12]_{\\mathrm{soft}},\\ \\mathbb{E}[H2/H1]_{\\mathrm{soft}},\\ \\mathbb{E}[H1]_{\\mathrm{hard}},\\ \\mathbb{E}[H12]_{\\mathrm{hard}},\\ \\mathbb{E}[H2/H1]_{\\mathrm{hard}}\\,\\big),\n$$\n以 $\\lambda$ 和 $k$ 的闭式解析表达式表示。无需进行数值计算，也不适用任何单位。请提供精确表达式，不要进行近似或取整。", "solution": "所提出的问题是群体遗传学中一个有效的理论练习，其基础是已确立的选择性清除理论。该问题提法明确、客观，并在给定的近似条件下包含了获得唯一解的充分信息。我将开始推导。\n\n问题的核心在于确定选择性清除后的预期单倍型频率谱，然后根据该谱计算纯合度统计量。对于清除完成后的种群大样本，我们得到了一个包含两个关键近似的模型：\n1.  在中性位点抽样的一个谱系是原始 $k$ 个奠基背景之一的后代（非重组）的概率为 $\\lambda$。在此条件下，它是奠基者 $i$ 的后代的概率为 $f_i$。因此，源自奠基者 $i$ 的非重组单倍型的种群频率为 $p_{\\text{founder},i} = \\lambda f_i$。\n2.  一个谱系是重组体的概率为 $1-\\lambda$。这些重组单倍型数量众多，且每个的频率都非常低。关键在于，它们对纯合度的总贡献可以忽略不计。也就是说，如果 $\\mathcal{R}$ 是重组单倍型的集合，那么 $\\sum_{j \\in \\mathcal{R}} p_j^2 \\approx 0$。\n\n在大样本极限下，我们可以将样本频率等同于这些种群频率。问题要求计算统计量 $H1$、$H12$ 和 $H2/H1$ 的期望值。由于模型给出了确定性的种群频率（给定 $\\lambda$ 和 $f_i$），并且在大样本极限下样本频率的方差趋于零，因此可以通过将公式应用于这些种群频率本身来计算统计量的期望值。\n\n我们将按规定分析两种情况：(i) 硬清除，对应于 $k=1$ 和 $f_1=1$；以及 (ii) 具有 $k \\ge 2$ 个奠基者的对称软清除，其中对所有 $i \\in \\{1, \\dots, k\\}$ 都有 $f_i = 1/k$。\n\n**情况 (ii)：对称软清除 ($k \\ge 2$)**\n\n对于有 $k$ 个奠基者的对称软清除，我们有 $f_i = 1/k$。这 $k$ 个与奠基者相关的单倍型的种群频率是相同的：\n$$\np_{\\text{founder},i} = \\lambda f_i = \\frac{\\lambda}{k} \\quad \\text{for } i=1, \\dots, k.\n$$\n这些将是种群中频率最高的 $k$ 个单倍型。由于它们都相等，排序后的频率为 $p_1 = p_2 = \\dots = p_k = \\lambda/k$。所有其他单倍型都是重组体，其平方频率可以忽略不计。\n\n**1. $\\mathbb{E}[H1]_{\\mathrm{soft}}$ 的计算**\n统计量 $H1$ 是单倍型频率的平方和，即 $\\sum_{i=1}^{m} p_i^2$。\n$$\n\\mathbb{E}[H1]_{\\mathrm{soft}} = H1 = \\sum_{i=1}^{k} \\left(\\frac{\\lambda}{k}\\right)^2 + \\sum_{j \\in \\mathcal{R}} p_j^2\n$$\n使用重组体频率平方和为零的近似：\n$$\n\\mathbb{E}[H1]_{\\mathrm{soft}} \\approx k \\left(\\frac{\\lambda}{k}\\right)^2 = k \\frac{\\lambda^2}{k^2} = \\frac{\\lambda^2}{k}.\n$$\n\n**2. $\\mathbb{E}[H12]_{\\mathrm{soft}}$ 的计算**\n统计量 $H12$ 定义为 $(p_1 + p_2)^2 + \\sum_{i=3}^{m} p_i^2$。由于 $k \\ge 2$，两个频率最高的单倍型 $p_1$ 和 $p_2$ 是频率为 $\\lambda/k$ 的奠基单倍型。\n$$\np_1 = \\frac{\\lambda}{k} \\quad \\text{and} \\quad p_2 = \\frac{\\lambda}{k}.\n$$\n求和项 $\\sum_{i=3}^{m} p_i^2$ 包括了剩余的 $k-2$ 个奠基单倍型以及所有重组单倍型。\n$$\n\\mathbb{E}[H12]_{\\mathrm{soft}} = H12 \\approx \\left(\\frac{\\lambda}{k} + \\frac{\\lambda}{k}\\right)^2 + \\sum_{i=3}^{k} \\left(\\frac{\\lambda}{k}\\right)^2 + \\sum_{j \\in \\mathcal{R}} p_j^2\n$$\n$$\n\\mathbb{E}[H12]_{\\mathrm{soft}} \\approx \\left(\\frac{2\\lambda}{k}\\right)^2 + (k-2)\\left(\\frac{\\lambda}{k}\\right)^2 = \\frac{4\\lambda^2}{k^2} + (k-2)\\frac{\\lambda^2}{k^2} = \\frac{(4+k-2)\\lambda^2}{k^2} = \\frac{(k+2)\\lambda^2}{k^2}.\n$$\n此推导对 $k \\ge 2$ 有效。\n\n**3. $\\mathbb{E}[H2/H1]_{\\mathrm{soft}}$ 的计算**\n统计量 $H2/H1$ 定义为 $\\frac{H1 - p_1^2}{H1} = 1 - \\frac{p_1^2}{H1}$。\n使用我们关于 $p_1$ 和 $H1$ 的结果：\n$$\n\\mathbb{E}[H2/H1]_{\\mathrm{soft}} \\approx 1 - \\frac{(\\lambda/k)^2}{\\lambda^2/k} = 1 - \\frac{\\lambda^2/k^2}{\\lambda^2/k} = 1 - \\frac{1}{k}.\n$$\n\n**情况 (i)：硬清除 ($k=1$)**\n\n对于硬清除，只有一个奠基单倍型，因此 $k=1$ 且 $f_1=1$。该单倍型的频率为：\n$$\np_1 = \\lambda f_1 = \\lambda.\n$$\n所有其他单倍型都是重组体，因此它们的频率 $p_2, p_3, \\dots$ 非常小，它们对平方和的贡献可以忽略不计。\n\n**1. $\\mathbb{E}[H1]_{\\mathrm{hard}}$ 的计算**\n$$\n\\mathbb{E}[H1]_{\\mathrm{hard}} = H1 \\approx p_1^2 + \\sum_{j \\in \\mathcal{R}} p_j^2 \\approx \\lambda^2 + 0 = \\lambda^2.\n$$\n这个结果与将软清除的通用公式中设置 $k=1$ 的结果一致：$\\lambda^2/1 = \\lambda^2$。\n\n**2. $\\mathbb{E}[H12]_{\\mathrm{hard}}$ 的计算**\n在这里，$p_1 \\approx \\lambda$，但频率第二高的单倍型 $p_2$ 是众多重组单倍型中频率最高的一个。根据问题的近似，其频率必须可以忽略不计，因此 $p_2 \\approx 0$。\n$$\n\\mathbb{E}[H12]_{\\mathrm{hard}} = H12 = (p_1 + p_2)^2 + \\sum_{i=3}^{m} p_i^2 \\approx (\\lambda + 0)^2 + 0 = \\lambda^2.\n$$\n注意，为软清除（$k \\ge 2$）推导的公式在这里不适用。就频率排名前两位的单倍型而言，其结构是根本不同的。\n\n**3. $\\mathbb{E}[H2/H1]_{\\mathrm{hard}}$ 的计算**\n$$\n\\mathbb{E}[H2/H1]_{\\mathrm{hard}} = H2/H1 = 1 - \\frac{p_1^2}{H1} \\approx 1 - \\frac{\\lambda^2}{\\lambda^2} = 0.\n$$\n这个结果与将软清除的通用公式中设置 $k=1$ 的结果一致：$1 - 1/1 = 0$。\n\n**结果总结**\n所要求的六个期望值为：\n- $\\mathbb{E}[H1]_{\\mathrm{soft}} = \\frac{\\lambda^2}{k}$\n- $\\mathbb{E}[H12]_{\\mathrm{soft}} = \\frac{(k+2)\\lambda^2}{k^2}$\n- $\\mathbb{E}[H2/H1]_{\\mathrm{soft}} = 1 - \\frac{1}{k}$\n- $\\mathbb{E}[H1]_{\\mathrm{hard}} = \\lambda^2$\n- $\\mathbb{E}[H12]_{\\mathrm{hard}} = \\lambda^2$\n- $\\mathbb{E}[H2/H1]_{\\mathrm{hard}} = 0$\n\n这些将以单行矩阵的形式呈现。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\lambda^2}{k}  \\frac{(k+2)\\lambda^2}{k^2}  1 - \\frac{1}{k}  \\lambda^2  \\lambda^2  0 \\end{pmatrix}}\n$$", "id": "2688407"}, {"introduction": "除了利用适应性扫描完成后的基因组数据，古DNA为我们提供了一个直接观察过去的窗口，使我们能检验适应性等位基因在环境变化前是否存在。本练习要求你构建一个严谨的贝叶斯推断框架，在考虑到测序错误可能性的前提下，根据古DNA样本计算适应起源于SGV的后验概率。掌握这一推导过程[@problem_id:2688401]，你将能够处理采样噪音和技术误差等现实世界中的复杂问题，从而利用带有时间戳的数据来正式权衡不同演化假说的证据权重。", "problem": "在一个古代种群中，紧接着一次环境变化之前，对一个双等位基因座进行了取样。环境变化后，在一个后代种群的该基因座上观察到了一次硬选择清除。要求您仅使用古代数据以及一个取样和测序误差模型，从第一性原理出发，量化该选择清除是由存留遗传变异（SGV）而非新突变（NM）驱动的后验概率。\n\n假设和模型组成部分：\n- 古代取样：您对该基因座上的 $n$ 条独立的古代染色体进行测序，观察到 $k$ 个读段被判定为衍生等位基因。每个读段的对称性错误检出率为 $\\epsilon \\in (0, \\tfrac{1}{2})$，这意味着一个真实的祖先等位基因被判定为衍生等位基因的概率为 $\\epsilon$，而一个真实的衍生等位基因被判定为祖先等位基因的概率也为 $\\epsilon$。在古代种群中真实衍生等位基因频率为 $p_0$ 的条件下，观察到的衍生读段数 $K$ 服从二项分布，其成功概率为 $q(p_0) = \\epsilon + (1 - 2\\epsilon) p_0$。\n- 环境变化时的竞争性选择清除起源模型：\n  - SGV 模型（$\\mathcal{M}_{\\mathrm{SGV}}$）：衍生等位基因预先存在，其频率为 $p_0 \\in (0,1)$，先验密度为 $p_0 \\sim \\mathrm{Beta}(a,b)$，其中 $a0$ 且 $b0$。贝塔函数为 $B(x,y) = \\dfrac{\\Gamma(x)\\Gamma(y)}{\\Gamma(x+y)}$，贝塔密度为 $f(p_0) = \\dfrac{p_0^{a-1}(1-p_0)^{b-1}}{B(a,b)}$。\n  - NM 模型（$\\mathcal{M}_{\\mathrm{NM}}$）：在环境变化前，衍生等位基因不存在，即 $p_0 = 0$。在此模型下，古代数据中任何衍生读段都仅由错误检出产生，其错误率为 $\\epsilon$。\n- 模型的先验概率：$\\Pr(\\mathcal{M}_{\\mathrm{SGV}}) = \\pi \\in (0,1)$ 且 $\\Pr(\\mathcal{M}_{\\mathrm{NM}}) = 1 - \\pi$。\n\n任务：\n- 使用贝叶斯定理、带对称误差的二项取样模型以及 $p_0$ 的贝塔先验，推导后验概率 $\\Pr(\\mathcal{M}_{\\mathrm{SGV}} \\mid K = k, n, \\epsilon, a, b, \\pi)$ 的一个闭式解析表达式，该表达式用 $n$、$k$、$\\epsilon$、$a$、$b$ 和 $\\pi$ 表示。您可以用有限和、二项式系数和贝塔函数 $B(\\cdot,\\cdot)$ 来表示您的结果。\n- 您的最终答案必须是一个单一的闭式符号表达式。不要提供不等式或待解方程。不要进行近似。\n\n将最终答案表示为单个解析表达式。无需单位。不要四舍五入。", "solution": "我们被要求计算后验模型概率 $\\Pr(\\mathcal{M}_{\\mathrm{SGV}} \\mid D)$，其中数据 $D$ 是在存在对称性错误检出率 $\\epsilon$ 的情况下，从 $n$ 个样本中观察到 $K=k$ 个古代计数。基本依据如下：\n- 贝叶斯定理：$\\Pr(\\mathcal{M}_{i} \\mid D) = \\dfrac{\\Pr(\\mathcal{M}_{i}) \\, \\Pr(D \\mid \\mathcal{M}_{i})}{\\sum_{j} \\Pr(\\mathcal{M}_{j}) \\, \\Pr(D \\mid \\mathcal{M}_{j})}$。\n- 带错误分类的二项取样：在真实衍生等位基因频率为 $p_0$ 的条件下，观察到的衍生读段概率为 $q(p_0) = \\epsilon + (1 - 2\\epsilon) p_0$，且 $K \\sim \\mathrm{Binomial}(n, q(p_0))$。\n- 共轭贝塔先验：在 $\\mathcal{M}_{\\mathrm{SGV}}$ 模型下，$p_0 \\sim \\mathrm{Beta}(a,b)$，其密度为 $f(p_0) = \\dfrac{p_0^{a-1}(1-p_0)^{b-1}}{B(a,b)}$。\n- 在 $\\mathcal{M}_{\\mathrm{NM}}$ 模型下，确定性地有 $p_0 = 0$，因此 $q(0) = \\epsilon$，所以 $K \\sim \\mathrm{Binomial}(n, \\epsilon)$。\n\n我们分步进行。\n\n步骤 $1$：新突变模型 $\\mathcal{M}_{\\mathrm{NM}}$ 下的似然。\n\n在 $\\mathcal{M}_{\\mathrm{NM}}$ 模型下，$q = \\epsilon$，所以\n$$\n\\Pr(K=k \\mid n, \\epsilon, \\mathcal{M}_{\\mathrm{NM}}) \\;=\\; \\binom{n}{k} \\, \\epsilon^{k} \\, (1-\\epsilon)^{n-k}.\n$$\n\n步骤 $2$：存留遗传变异模型 $\\mathcal{M}_{\\mathrm{SGV}}$ 下的边际似然。\n\n在 $\\mathcal{M}_{\\mathrm{SGV}}$ 模型下，以 $p_0$ 为条件，\n$$\n\\Pr(K=k \\mid n, \\epsilon, p_0, \\mathcal{M}_{\\mathrm{SGV}}) \\;=\\; \\binom{n}{k} \\, \\big(\\epsilon + (1 - 2\\epsilon) p_0\\big)^{k} \\, \\Big(1 - \\epsilon - (1 - 2\\epsilon) p_0\\Big)^{n-k}.\n$$\n我们将此似然函数对 $p_0$ 的贝塔先验进行积分：\n$$\n\\Pr(K=k \\mid n, \\epsilon, a, b, \\mathcal{M}_{\\mathrm{SGV}}) \\;=\\; \\int_{0}^{1} \\binom{n}{k} \\, \\big(\\epsilon + (1 - 2\\epsilon) p_0\\big)^{k} \\, \\Big(1 - \\epsilon - (1 - 2\\epsilon) p_0\\Big)^{n-k} \\, \\frac{p_0^{a-1} (1-p_0)^{b-1}}{B(a,b)} \\, dp_0.\n$$\n令 $\\delta = 1 - 2\\epsilon$。通过二项式定理展开各项：\n- 对第一个因子，\n$$\n\\big(\\epsilon + \\delta p_0\\big)^{k} \\;=\\; \\sum_{i=0}^{k} \\binom{k}{i} \\, \\epsilon^{k-i} \\, \\delta^{i} \\, p_0^{i}.\n$$\n- 对第二个因子，写成 $1 - \\epsilon - \\delta p_0 = (1 - \\epsilon) + (-\\delta) p_0$ 并展开：\n$$\n\\Big(1 - \\epsilon - \\delta p_0\\Big)^{n-k} \\;=\\; \\sum_{j=0}^{n-k} \\binom{n-k}{j} \\, (1 - \\epsilon)^{n-k-j} \\, (-\\delta)^{j} \\, p_0^{j}.\n$$\n将两个展开式相乘，并对贝塔密度逐项积分，得到\n$$\n\\Pr(K=k \\mid n, \\epsilon, a, b, \\mathcal{M}_{\\mathrm{SGV}}) \\;=\\; \\binom{n}{k} \\, \\frac{1}{B(a,b)} \\, \\sum_{i=0}^{k} \\sum_{j=0}^{n-k} \\binom{k}{i} \\binom{n-k}{j} \\, \\epsilon^{k-i} \\, (1 - \\epsilon)^{n-k-j} \\, \\delta^{i+j} \\, (-1)^{j} \\, \\int_{0}^{1} p_0^{a-1+i+j} (1-p_0)^{b-1} \\, dp_0.\n$$\n余下的积分是贝塔函数 $B(a+i+j, b)$。因此，\n$$\n\\Pr(K=k \\mid n, \\epsilon, a, b, \\mathcal{M}_{\\mathrm{SGV}}) \\;=\\; \\binom{n}{k} \\, \\frac{1}{B(a,b)} \\, \\sum_{i=0}^{k} \\sum_{j=0}^{n-k} \\binom{k}{i} \\binom{n-k}{j} \\, \\epsilon^{k-i} \\, (1 - \\epsilon)^{n-k-j} \\, \\delta^{i+j} \\, (-1)^{j} \\, B(a+i+j, b).\n$$\n\n定义有限双重和\n$$\nS(n,k,\\epsilon,a,b) \\;=\\; \\sum_{i=0}^{k} \\sum_{j=0}^{n-k} \\binom{k}{i} \\binom{n-k}{j} \\, \\epsilon^{k-i} \\, (1 - \\epsilon)^{n-k-j} \\, (1 - 2\\epsilon)^{i+j} \\, (-1)^{j} \\, B(a+i+j, b).\n$$\n那么\n$$\n\\Pr(K=k \\mid n, \\epsilon, a, b, \\mathcal{M}_{\\mathrm{SGV}}) \\;=\\; \\binom{n}{k} \\, \\frac{S(n,k,\\epsilon,a,b)}{B(a,b)}.\n$$\n\n步骤 $3$：应用贝叶斯定理得到 $\\Pr(\\mathcal{M}_{\\mathrm{SGV}} \\mid K=k, n, \\epsilon, a, b, \\pi)$。\n\n使用先验概率 $\\Pr(\\mathcal{M}_{\\mathrm{SGV}})=\\pi$ 和 $\\Pr(\\mathcal{M}_{\\mathrm{NM}})=1-\\pi$，贝叶斯定理给出\n$$\n\\Pr(\\mathcal{M}_{\\mathrm{SGV}} \\mid D) \\;=\\; \\frac{\\pi \\, \\Pr(D \\mid \\mathcal{M}_{\\mathrm{SGV}})}{\\pi \\, \\Pr(D \\mid \\mathcal{M}_{\\mathrm{SGV}}) \\;+\\; (1-\\pi)\\, \\Pr(D \\mid \\mathcal{M}_{\\mathrm{NM}})}.\n$$\n代入边际似然，并注意到公因子 $\\binom{n}{k}$ 从分子和分母中约去，我们得到\n$$\n\\Pr(\\mathcal{M}_{\\mathrm{SGV}} \\mid K=k, n, \\epsilon, a, b, \\pi)\n\\;=\\;\n\\frac{\\displaystyle \\pi \\, \\frac{S(n,k,\\epsilon,a,b)}{B(a,b)}}\n{\\displaystyle \\pi \\, \\frac{S(n,k,\\epsilon,a,b)}{B(a,b)} \\;+\\; (1-\\pi) \\, \\epsilon^{k} \\, (1-\\epsilon)^{n-k}}.\n$$\n\n这是一个关于 $n$、$k$、$\\epsilon$、$a$、$b$ 和 $\\pi$ 的闭式有限和表达式，还包括贝塔函数 $B(\\cdot,\\cdot)$ 和二项式系数。它仅依赖于指定的模型组成部分和基本概率定律。", "answer": "$$\\boxed{\\frac{\\displaystyle \\pi \\,\\dfrac{\\sum_{i=0}^{k} \\sum_{j=0}^{\\,n-k} \\binom{k}{i}\\binom{n-k}{j}\\,\\epsilon^{\\,k-i}\\,(1-\\epsilon)^{\\,n-k-j}\\,(1-2\\epsilon)^{\\,i+j}\\,(-1)^{j}\\,B(a+i+j,\\,b)}{B(a,b)}}{\\displaystyle \\pi \\,\\dfrac{\\sum_{i=0}^{k} \\sum_{j=0}^{\\,n-k} \\binom{k}{i}\\binom{n-k}{j}\\,\\epsilon^{\\,k-i}\\,(1-\\epsilon)^{\\,n-k-j}\\,(1-2\\epsilon)^{\\,i+j}\\,(-1)^{j}\\,B(a+i+j,\\,b)}{B(a,b)} \\;+\\; (1-\\pi)\\,\\epsilon^{\\,k}\\,(1-\\epsilon)^{\\,n-k}}}$$", "id": "2688401"}]}