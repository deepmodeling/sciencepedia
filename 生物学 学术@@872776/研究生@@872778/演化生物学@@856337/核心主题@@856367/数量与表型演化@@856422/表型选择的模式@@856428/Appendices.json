{"hands_on_practices": [{"introduction": "在定量遗传学中，区分选择差异（selection differential）和选择梯度（selection gradient）至关重要。选择差异 $\\mathbf{S}$ 描述了性状均值的表型响应，而选择梯度 $\\boldsymbol{\\beta}$ 则量化了作用于性状的直接选择压力。[@problem_id:2735643] 这个练习将通过一个具体的计算，阐明表型协方差矩阵 $\\mathbf{P}$ 如何调节这两者之间的关系，并揭示为何相同的表型变化可能源于截然不同的选择压力。", "problem": "在表型选择的数量遗传学模型中，Lande–Arnold 框架通过线性关系 $\\mathbf{S}=\\mathbf{P}\\boldsymbol{\\beta}$ 将选择差异向量 $\\mathbf{S}$ 与表型协方差矩阵 $\\mathbf{P}$ 以及定向选择梯度向量 $\\boldsymbol{\\beta}$ 联系起来。此处，$\\mathbf{S}$ 捕捉了由选择引起的平均表型变化，$\\mathbf{P}$ 编码了表型方差和协方差，而 $\\boldsymbol{\\beta}$ 量化了对性状的定向选择。选择的非线性分量（稳定化或分裂性）由二次梯度 $\\boldsymbol{\\gamma}$ 捕捉，此处不进行估计。\n\n考虑一个双性状系统（性状 $1$ 和性状 $2$）。在两种不同的环境中，观测到相同的选择差异，\n$$\n\\mathbf{S}=\\begin{pmatrix}0.2 \\\\ 0.1\\end{pmatrix},\n$$\n但表型协方差矩阵不同：\n$$\n\\mathbf{P}_{A}=\\begin{pmatrix}1  0.5 \\\\ 0.5  1\\end{pmatrix}, \\qquad\n\\mathbf{P}_{B}=\\begin{pmatrix}1.5  -0.3 \\\\ -0.3  0.8\\end{pmatrix}.\n$$\n从关系式 $\\mathbf{S}=\\mathbf{P}\\boldsymbol{\\beta}$ 和矩阵代数的基本原理出发，分别计算环境 $A$ 和 $B$ 的潜在定向选择梯度 $\\boldsymbol{\\beta}_{A}=\\mathbf{P}_{A}^{-1}\\mathbf{S}$ 和 $\\boldsymbol{\\beta}_{B}=\\mathbf{P}_{B}^{-1}\\mathbf{S}$，以说明当 $\\mathbf{P}$ 变化时，相同的 $\\mathbf{S}$ 如何由不同的 $\\boldsymbol{\\beta}$ 产生。然后，令 $\\|\\cdot\\|_{2}$ 表示欧几里得范数，并计算比率\n$$\nr=\\frac{\\|\\boldsymbol{\\beta}_{B}\\|_{2}}{\\|\\boldsymbol{\\beta}_{A}\\|_{2}}.\n$$\n将 $r$ 的精确值以单个简化的解析表达式形式报告。不要进行近似或四舍五入。", "solution": "所提出的问题具有科学依据且在数学上是适定的。我们开始进行求解。\n\n目标是计算比率 $r = \\frac{\\|\\boldsymbol{\\beta}_{B}\\|_{2}}{\\|\\boldsymbol{\\beta}_{A}\\|_{2}}$。定向选择梯度 $\\boldsymbol{\\beta}_{A}$ 和 $\\boldsymbol{\\beta}_{B}$ 由线性关系 $\\mathbf{S} = \\mathbf{P}\\boldsymbol{\\beta}$ 确定，这意味着 $\\boldsymbol{\\beta} = \\mathbf{P}^{-1}\\mathbf{S}$。这需要对表型协方差矩阵 $\\mathbf{P}_{A}$ 和 $\\mathbf{P}_{B}$ 求逆。\n\n为确保精度，我们将使用有理数而非小数进行计算。给定的向量和矩阵是：\n$$\n\\mathbf{S}=\\begin{pmatrix} 0.2 \\\\ 0.1 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{5} \\\\ \\frac{1}{10} \\end{pmatrix}\n$$\n$$\n\\mathbf{P}_{A}=\\begin{pmatrix} 1  0.5 \\\\ 0.5  1 \\end{pmatrix} = \\begin{pmatrix} 1  \\frac{1}{2} \\\\ \\frac{1}{2}  1 \\end{pmatrix}\n$$\n$$\n\\mathbf{P}_{B}=\\begin{pmatrix} 1.5  -0.3 \\\\ -0.3  0.8 \\end{pmatrix} = \\begin{pmatrix} \\frac{3}{2}  -\\frac{3}{10} \\\\ -\\frac{3}{10}  \\frac{4}{5} \\end{pmatrix}\n$$\n对于一个一般的 $2 \\times 2$ 矩阵 $\\mathbf{M} = \\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$，其逆矩阵由 $\\mathbf{M}^{-1} = \\frac{1}{ad-bc} \\begin{pmatrix} d  -b \\\\ -c  a \\end{pmatrix}$ 给出。\n\n首先，我们计算环境 $A$ 的选择梯度 $\\boldsymbol{\\beta}_{A}$。\n$\\mathbf{P}_{A}$ 的行列式是：\n$$\n\\det(\\mathbf{P}_{A}) = (1)(1) - (\\frac{1}{2})(\\frac{1}{2}) = 1 - \\frac{1}{4} = \\frac{3}{4}\n$$\n其逆矩阵是：\n$$\n\\mathbf{P}_{A}^{-1} = \\frac{1}{3/4} \\begin{pmatrix} 1  -\\frac{1}{2} \\\\ -\\frac{1}{2}  1 \\end{pmatrix} = \\frac{4}{3} \\begin{pmatrix} 1  -\\frac{1}{2} \\\\ -\\frac{1}{2}  1 \\end{pmatrix} = \\begin{pmatrix} \\frac{4}{3}  -\\frac{2}{3} \\\\ -\\frac{2}{3}  \\frac{4}{3} \\end{pmatrix}\n$$\n现在，我们计算 $\\boldsymbol{\\beta}_{A} = \\mathbf{P}_{A}^{-1}\\mathbf{S}$：\n$$\n\\boldsymbol{\\beta}_{A} = \\begin{pmatrix} \\frac{4}{3}  -\\frac{2}{3} \\\\ -\\frac{2}{3}  \\frac{4}{3} \\end{pmatrix} \\begin{pmatrix} \\frac{1}{5} \\\\ \\frac{1}{10} \\end{pmatrix} = \\begin{pmatrix} \\frac{4}{3} \\cdot \\frac{1}{5} - \\frac{2}{3} \\cdot \\frac{1}{10} \\\\ -\\frac{2}{3} \\cdot \\frac{1}{5} + \\frac{4}{3} \\cdot \\frac{1}{10} \\end{pmatrix} = \\begin{pmatrix} \\frac{4}{15} - \\frac{2}{30} \\\\ -\\frac{2}{15} + \\frac{4}{30} \\end{pmatrix} = \\begin{pmatrix} \\frac{8}{30} - \\frac{2}{30} \\\\ -\\frac{4}{30} + \\frac{4}{30} \\end{pmatrix} = \\begin{pmatrix} \\frac{6}{30} \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{5} \\\\ 0 \\end{pmatrix}\n$$\n$\\boldsymbol{\\beta}_{A}$ 的欧几里得范数是：\n$$\n\\|\\boldsymbol{\\beta}_{A}\\|_{2} = \\sqrt{(\\frac{1}{5})^{2} + (0)^{2}} = \\sqrt{\\frac{1}{25}} = \\frac{1}{5}\n$$\n\n接下来，我们计算环境 $B$ 的选择梯度 $\\boldsymbol{\\beta}_{B}$。\n$\\mathbf{P}_{B}$ 的行列式是：\n$$\n\\det(\\mathbf{P}_{B}) = (\\frac{3}{2})(\\frac{4}{5}) - (-\\frac{3}{10})(-\\frac{3}{10}) = \\frac{12}{10} - \\frac{9}{100} = \\frac{120}{100} - \\frac{9}{100} = \\frac{111}{100}\n$$\n其逆矩阵是：\n$$\n\\mathbf{P}_{B}^{-1} = \\frac{1}{111/100} \\begin{pmatrix} \\frac{4}{5}  \\frac{3}{10} \\\\ \\frac{3}{10}  \\frac{3}{2} \\end{pmatrix} = \\frac{100}{111} \\begin{pmatrix} \\frac{4}{5}  \\frac{3}{10} \\\\ \\frac{3}{10}  \\frac{3}{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{80}{111}  \\frac{30}{111} \\\\ \\frac{30}{111}  \\frac{150}{111} \\end{pmatrix}\n$$\n现在，我们计算 $\\boldsymbol{\\beta}_{B} = \\mathbf{P}_{B}^{-1}\\mathbf{S}$：\n$$\n\\boldsymbol{\\beta}_{B} = \\frac{1}{111} \\begin{pmatrix} 80  30 \\\\ 30  150 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{5} \\\\ \\frac{1}{10} \\end{pmatrix} = \\frac{1}{111} \\begin{pmatrix} 80 \\cdot \\frac{1}{5} + 30 \\cdot \\frac{1}{10} \\\\ 30 \\cdot \\frac{1}{5} + 150 \\cdot \\frac{1}{10} \\end{pmatrix} = \\frac{1}{111} \\begin{pmatrix} 16 + 3 \\\\ 6 + 15 \\end{pmatrix} = \\frac{1}{111} \\begin{pmatrix} 19 \\\\ 21 \\end{pmatrix}\n$$\n$\\boldsymbol{\\beta}_{B}$ 的欧几里得范数是：\n$$\n\\|\\boldsymbol{\\beta}_{B}\\|_{2} = \\sqrt{(\\frac{19}{111})^{2} + (\\frac{21}{111})^{2}} = \\frac{1}{111} \\sqrt{19^{2} + 21^{2}} = \\frac{1}{111} \\sqrt{361 + 441} = \\frac{\\sqrt{802}}{111}\n$$\n$\\sqrt{802}$ 无法进一步简化，因为 $802 = 2 \\times 401$ 且 $401$ 是一个素数。\n\n最后，我们计算比率 $r$：\n$$\nr = \\frac{\\|\\boldsymbol{\\beta}_{B}\\|_{2}}{\\|\\boldsymbol{\\beta}_{A}\\|_{2}} = \\frac{\\frac{\\sqrt{802}}{111}}{\\frac{1}{5}} = \\frac{5\\sqrt{802}}{111}\n$$\n数字 $5$、$111 = 3 \\times 37$ 和 $802 = 2 \\times 401$ 没有公因数，因此该表达式已是最简形式。", "answer": "$$\n\\boxed{\\frac{5\\sqrt{802}}{111}}\n$$", "id": "2735643"}, {"introduction": "在分析了定向选择之后，我们转向适应度景观的曲率，它描述了稳定选择和分裂选择。二次选择梯度矩阵 $\\boldsymbol{\\Gamma}$ 捕捉了这种多维曲率。[@problem_id:2735572] 这个练习将指导你如何使用特征分解来找到选择的主轴（principal axes），即在性状空间中选择表现为纯粹稳定或分裂的方向，并量化其强度，从而深入理解非线性选择的结构。", "problem": "在多变量数量遗传学中，对于一个表型性状向量 $\\mathbf{z} \\in \\mathbb{R}^{3}$，其在种群均值附近的均值标准化相对适合度曲面的曲率通常用二阶泰勒展开来近似，其中二次选择梯度的对称矩阵 $\\boldsymbol{\\Gamma}$ 捕捉了局部曲率。该适合度曲面的主曲率和主轴分别定义为 $\\boldsymbol{\\Gamma}$ 的特征值和特征向量。负主曲率表示沿着相应特征向量方向的局部凹性适合度（稳定性选择），而正主曲率表示局部凸性适合度（分裂性选择）。\n\n考虑一个具有三个均值标准化性状的种群，其测得的二次选择梯度矩阵为\n$$\n\\boldsymbol{\\Gamma}\n=\n\\begin{pmatrix}\n0.5  -2.5  0 \\\\\n-2.5  0.5  0 \\\\\n0  0  -1\n\\end{pmatrix}.\n$$\n从通过实对称矩阵的特征分解定义主曲率和主轴出发，推导 $\\boldsymbol{\\Gamma}$ 的主曲率和相应的标准正交轴，并根据主曲率的符号将每个轴上的选择分类为稳定性选择或分裂性选择。然后计算标量\n$$\nS \\equiv \\prod_{\\lambda_i  0} |\\lambda_i|,\n$$\n即所有负主曲率绝对值的乘积。给出 $S$ 的精确值，作为一个没有单位的纯数。不要对答案进行四舍五入。", "solution": "本题要求从给定的二次选择梯度矩阵 $\\boldsymbol{\\Gamma}$ 中推导出选择的主曲率和主轴，并随后计算标量 $S$。主曲率和主轴分别对应于矩阵 $\\boldsymbol{\\Gamma}$ 的特征值和特征向量。\n\n给定的矩阵是：\n$$\n\\boldsymbol{\\Gamma}\n=\n\\begin{pmatrix}\n0.5  -2.5  0 \\\\\n-2.5  0.5  0 \\\\\n0  0  -1\n\\end{pmatrix}\n$$\n主曲率（用 $\\lambda$ 表示）是 $\\boldsymbol{\\Gamma}$ 的特征值。它们通过求解特征方程 $\\det(\\boldsymbol{\\Gamma} - \\lambda\\mathbf{I}) = 0$ 来找到，其中 $\\mathbf{I}$ 是 $3 \\times 3$ 的单位矩阵。\n$$\n\\det \\begin{pmatrix}\n0.5 - \\lambda  -2.5  0 \\\\\n-2.5  0.5 - \\lambda  0 \\\\\n0  0  -1 - \\lambda\n\\end{pmatrix} = 0\n$$\n我们可以沿着第三行进行余子式展开来计算行列式：\n$$\n(-1 - \\lambda) \\det \\begin{pmatrix}\n0.5 - \\lambda  -2.5 \\\\\n-2.5  0.5 - \\lambda\n\\end{pmatrix} = 0\n$$\n$$\n(-1 - \\lambda) \\left[ (0.5 - \\lambda)^2 - (-2.5)^2 \\right] = 0\n$$\n该方程给出了三个特征值。从第一个因子可以立即看出一个特征值：\n$$\n-1 - \\lambda = 0 \\implies \\lambda_1 = -1\n$$\n另外两个特征值可以从第二个因子中找到：\n$$\n(0.5 - \\lambda)^2 - (2.5)^2 = 0\n$$\n$$\n(0.5 - \\lambda)^2 = (2.5)^2\n$$\n对两边取平方根，得到两种可能性：\n$$\n0.5 - \\lambda = 2.5 \\implies \\lambda = 0.5 - 2.5 = -2\n$$\n$$\n0.5 - \\lambda = -2.5 \\implies \\lambda = 0.5 + 2.5 = 3\n$$\n我们将特征值排序为 $\\lambda_1 = 3$，$\\lambda_2 = -1$ 和 $\\lambda_3 = -2$。主曲率是 $3$，$-1$ 和 $-2$。\n\n每个主轴上的选择类型由相应主曲率 $\\lambda_i$ 的符号决定。\n对于 $\\lambda_1 = 3 > 0$，选择是分裂性的。\n对于 $\\lambda_2 = -1  0$，选择是稳定性的。\n对于 $\\lambda_3 = -2  0$，选择是稳定性的。\n\n接下来，我们求出相应的标准正交主轴，它们是每个特征值 $\\lambda_i$ 对应的归一化特征向量 $\\mathbf{v}_i$。一个特征向量 $\\mathbf{v}$ 满足方程 $(\\boldsymbol{\\Gamma} - \\lambda\\mathbf{I})\\mathbf{v} = \\mathbf{0}$。\n\n对于 $\\lambda_1 = 3$：\n$$\n(\\boldsymbol{\\Gamma} - 3\\mathbf{I})\\mathbf{v}_1 = \\begin{pmatrix} 0.5 - 3  -2.5  0 \\\\ -2.5  0.5 - 3  0 \\\\ 0  0  -1 - 3 \\end{pmatrix} \\begin{pmatrix} v_{11} \\\\ v_{12} \\\\ v_{13} \\end{pmatrix} = \\begin{pmatrix} -2.5  -2.5  0 \\\\ -2.5  -2.5  0 \\\\ 0  0  -4 \\end{pmatrix} \\begin{pmatrix} v_{11} \\\\ v_{12} \\\\ v_{13} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n第三行意味着 $-4v_{13} = 0$，所以 $v_{13} = 0$。第一行意味着 $-2.5v_{11} - 2.5v_{12} = 0$，简化为 $v_{11} = -v_{12}$。特征向量的形式为 $\\begin{pmatrix} c \\\\ -c \\\\ 0 \\end{pmatrix}$。归一化为单位长度，$c^2 + (-c)^2 + 0^2 = 1 \\implies 2c^2 = 1 \\implies c = \\frac{1}{\\sqrt{2}}$。主轴为 $\\mathbf{v}_1 = \\begin{pmatrix} \\frac{1}{\\sqrt{2}} \\\\ -\\frac{1}{\\sqrt{2}} \\\\ 0 \\end{pmatrix}$。\n\n对于 $\\lambda_2 = -1$：\n$$\n(\\boldsymbol{\\Gamma} - (-1)\\mathbf{I})\\mathbf{v}_2 = \\begin{pmatrix} 0.5 + 1  -2.5  0 \\\\ -2.5  0.5 + 1  0 \\\\ 0  0  -1 + 1 \\end{pmatrix} \\begin{pmatrix} v_{21} \\\\ v_{22} \\\\ v_{23} \\end{pmatrix} = \\begin{pmatrix} 1.5  -2.5  0 \\\\ -2.5  1.5  0 \\\\ 0  0  0 \\end{pmatrix} \\begin{pmatrix} v_{21} \\\\ v_{22} \\\\ v_{23} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n前两行意味着 $1.5v_{21} - 2.5v_{22} = 0$ 和 $-2.5v_{21} + 1.5v_{22} = 0$。左上角 $2 \\times 2$ 子矩阵的行列式为 $(1.5)(1.5) - (-2.5)(-2.5) = 2.25 - 6.25 = -4 \\neq 0$。这意味着该子系统的唯一解是 $v_{21} = 0$ 和 $v_{22} = 0$。因此，特征向量的形式为 $\\begin{pmatrix} 0 \\\\ 0 \\\\ c \\end{pmatrix}$。归一化为单位长度得到 $c=1$。主轴为 $\\mathbf{v}_2 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}$。\n\n对于 $\\lambda_3 = -2$：\n$$\n(\\boldsymbol{\\Gamma} - (-2)\\mathbf{I})\\mathbf{v}_3 = \\begin{pmatrix} 0.5 + 2  -2.5  0 \\\\ -2.5  0.5 + 2  0 \\\\ 0  0  -1 + 2 \\end{pmatrix} \\begin{pmatrix} v_{31} \\\\ v_{32} \\\\ v_{33} \\end{pmatrix} = \\begin{pmatrix} 2.5  -2.5  0 \\\\ -2.5  2.5  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} v_{31} \\\\ v_{32} \\\\ v_{33} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n第三行得到 $v_{33} = 0$。第一行得到 $2.5v_{31} - 2.5v_{32} = 0$，简化为 $v_{31} = v_{32}$。特征向量的形式为 $\\begin{pmatrix} c \\\\ c \\\\ 0 \\end{pmatrix}$。归一化后，$c^2 + c^2 + 0^2 = 1 \\implies 2c^2 = 1 \\implies c = \\frac{1}{\\sqrt{2}}$。主轴为 $\\mathbf{v}_3 = \\begin{pmatrix} \\frac{1}{\\sqrt{2}} \\\\ \\frac{1}{\\sqrt{2}} \\\\ 0 \\end{pmatrix}$。\n\n结果总结：\n-   主曲率 $\\lambda_1 = 3$ (分裂性)，主轴 $\\mathbf{v}_1 = \\begin{pmatrix} \\frac{1}{\\sqrt{2}}  -\\frac{1}{\\sqrt{2}}  0 \\end{pmatrix}^T$。\n-   主曲率 $\\lambda_2 = -1$ (稳定性)，主轴 $\\mathbf{v}_2 = \\begin{pmatrix} 0  0  1 \\end{pmatrix}^T$。\n-   主曲率 $\\lambda_3 = -2$ (稳定性)，主轴 $\\mathbf{v}_3 = \\begin{pmatrix} \\frac{1}{\\sqrt{2}}  \\frac{1}{\\sqrt{2}}  0 \\end{pmatrix}^T$。\n\n最后的任务是计算标量 $S$，它被定义为所有负主曲率绝对值的乘积。负主曲率为 $\\lambda_2 = -1$ 和 $\\lambda_3 = -2$。\n$$\nS \\equiv \\prod_{\\lambda_i  0} |\\lambda_i| = |\\lambda_2| \\times |\\lambda_3|\n$$\n$$\nS = |-1| \\times |-2| = 1 \\times 2 = 2\n$$\n标量 $S$ 的值恰好为 $2$。", "answer": "$$\n\\boxed{2}\n$$", "id": "2735572"}, {"introduction": "为了将选择理论与种群动态更紧密地联系起来，本部分将引入一个更高级的实践：使用整合投射模型（Integral Projection Model, IPM）。在这个练习中 [@problem_id:2735647]，你将通过数值方法构建一个IPM，并计算种群的长期增长率 $\\lambda$ 如何随平均表型的变化而改变。这种强大的方法使我们能够在完整的生命周期框架下测量定向和稳定选择，从而将性状进化与种群动态直接联系起来。", "problem": "给定一个在选择作用下一个连续变化的数量性状的积分投影模型 (IPM)。令 $z \\in \\mathbb{R}$ 表示性状值，$n_t(z)$ 表示在时间 $t$ 的性状分布。IPM 通过以下方式更新分布：\n$$\nn_{t+1}(z') \\;=\\; \\int_{\\mathbb{R}} K_h(z',z)\\, n_t(z)\\, dz,\n$$\n其中核 $K_h$ 定义为\n$$\nK_h(z',z) \\;=\\; s(z;h)\\, G(z',z) \\;+\\; f(z;h)\\, R(z',z).\n$$\n函数 $s(z;h)$ 是存活率，$f(z;h)$ 是繁殖力，$G(z',z)$ 是条件生长核，$R(z',z)$ 是条件补充核。标量 $h \\in \\mathbb{R}$ 表示平均表型相对于环境或适应性最优值的一个小偏移。假设以下形式：\n- 在最优值 $\\theta$ 附近的二次选择下的存活率和繁殖力：\n$$\ns(z;h) \\;=\\; s_0 \\exp\\!\\left(-\\alpha_s\\, (z+h-\\theta)^2\\right), \n\\qquad\nf(z;h) \\;=\\; f_0 \\exp\\!\\left(-\\alpha_f\\, (z+h-\\theta)^2\\right),\n$$\n其中 $s_0  0$，$f_0  0$，且选择曲率 $\\alpha_s, \\alpha_f \\in \\mathbb{R}$ 为实数。正的 $\\alpha$ 意味着围绕 $\\theta$ 的稳定选择，而负的 $\\alpha$ 意味着在用于数值近似的性状域内的分裂选择。\n- 高斯生长和补充：\n$$\nG(z',z) \\;=\\; \\varphi\\!\\left(z';\\, \\mu_g(z),\\, \\sigma_g\\right), \n\\qquad\n\\mu_g(z) \\;=\\; z, \n\\qquad\nR(z',z) \\;=\\; \\varphi\\!\\left(z';\\, \\mu_r(z),\\, \\sigma_r\\right), \n\\qquad\n\\mu_r(z) \\;=\\; \\rho\\, z + (1-\\rho)\\, \\theta,\n$$\n其中 $\\varphi(\\cdot;\\mu,\\sigma)$ 表示均值为 $\\mu$、标准差为 $\\sigma$ 的高斯概率密度函数，$\\sigma_g  0$，$\\sigma_r  0$，且 $0 \\le \\rho \\le 1$。\n\n根据正线性算子的 Perron–Frobenius 性质，长期种群增长率是由 $K_h$ 在合适的函数空间上决定的线性算子的主特征值 $\\lambda(h)$；在实践中，您将通过离散化性状域并形成一个非负矩阵来近似 $\\lambda(h)$。\n\n您的任务是：\n1. 使用中点求积法则，在一个跨越有界域 $[z_{\\min}, z_{\\max}]$ 的均匀网格 $z_1,\\dots,z_M$ 上构造 $K_h$ 的数值近似。具体来说，定义\n$$\nK_{ij}(h) \\;=\\; \\left[s(z_j;h)\\, G(z_i,z_j) \\;+\\; f(z_j;h)\\, R(z_i,z_j)\\right]\\, \\Delta z,\n$$\n其中 $\\Delta z = (z_{\\max}-z_{\\min})/(M-1)$，并使用矩阵 $K(h)$ 的主特征值作为 $\\lambda(h)$ 的数值近似。\n2. 计算种群增长率对偏移 $h$ 在 $h=0$ 处的敏感度：\n$$\nS \\;=\\; \\left.\\frac{d\\lambda}{dh}\\right|_{h=0},\n$$\n使用一个小的对称步长 $h = \\varepsilon  0$ 的二阶中心有限差分，即：\n$$\nS \\;\\approx\\; \\frac{\\lambda(\\varepsilon) - \\lambda(-\\varepsilon)}{2\\varepsilon}.\n$$\n3. 计算增长率对数在 $h=0$ 处的曲率：\n$$\nC \\;=\\; \\left.\\frac{d^2}{dh^2}\\log \\lambda(h)\\right|_{h=0},\n$$\n使用二阶中心有限差分\n$$\nC \\;\\approx\\; \\frac{\\log \\lambda(\\varepsilon) - 2 \\log \\lambda(0) + \\log \\lambda(-\\varepsilon)}{\\varepsilon^2}.\n$$\n4. 使用数值容差 $\\tau  0$ 从曲率 $C$ 中对选择模式进行分类：\n- 如果 $C  -\\tau$，输出类别代码 $-1$ (稳定选择)。\n- 如果 $|C| \\le \\tau$，输出类别代码 $0$ ($h=0$ 附近近似平坦)。\n- 如果 $C > \\tau$，输出类别代码 $+1$ (分裂选择)。\n\n为保证数值真实性和可复现性，需强制执行以下实现细节：\n- 在域 $[z_{\\min}, z_{\\max}] = [-4, 4]$ 上使用包含 $M = 201$ 个点的均匀网格，因此 $\\Delta z = (4 - (-4))/(201 - 1)$。\n- 使用对称有限差分步长 $\\varepsilon = 0.01$。\n- 使用高斯密度\n$$\n\\varphi(x;\\mu,\\sigma) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\!\\left( -\\frac{(x-\\mu)^2}{2\\sigma^2} \\right).\n$$\n\n测试套件。对于下面的每个参数集，计算并返回三元组 $[S, C, \\text{class}]$，其中 $S$ 和 $C$ 四舍五入到六位小数：\n- 情况 A (预期的稳定曲率)：$s_0 = 0.8$, $f_0 = 2.0$, $\\alpha_s = 0.03$, $\\alpha_f = 0.02$, $\\theta = 0.0$, $\\sigma_g = 0.2$, $\\sigma_r = 0.3$, $\\rho = 0.5$。\n- 情况 B (预期的近似平坦曲率，可能具有非零斜率)：$s_0 = 0.8$, $f_0 = 2.0$, $\\alpha_s = 10^{-6}$, $\\alpha_f = 10^{-6}$, $\\theta = 0.5$, $\\sigma_g = 0.2$, $\\sigma_r = 0.3$, $\\rho = 0.5$。\n- 情况 C (预期的分裂曲率)：$s_0 = 0.8$, $f_0 = 2.0$, $\\alpha_s = -0.03$, $\\alpha_f = -0.02$, $\\theta = 0.0$, $\\sigma_g = 0.2$, $\\sigma_r = 0.3$, $\\rho = 0.5$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含三个情况的结果，格式为方括号括起来的逗号分隔列表，每个情况本身就是一个三元素列表 $[S, C, \\text{class}]$。例如，打印的结构必须如下所示：\n$$\n[[S_A, C_A, \\text{class}_A],[S_B, C_B, \\text{class}_B],[S_C, C_C, \\text{class}_C]]\n$$\n其中 $S$ 和 $C$ 显示为小数点后六位四舍五入的十进制数，类别代码为整数。不应打印任何其他文本。", "solution": "该问题具有科学依据，提法明确，并为演化数量遗传学中的一个数值实验提供了完整的规范。因此，该问题被认为是有效的。以下解决方案实现了指定的积分投影模型 (IPM) 及相关分析。\n\n该模型描述了数量性状 $z$ 在选择、生长和繁殖的共同作用下的演化过程。时间 $t+1$ 时的种群性状分布，記为 $n_{t+1}(z')$，是通过一个核为 $K_h(z',z)$ 的线性算子，将上一代 $t$ 的分布 $n_t(z)$ 投影得到的：\n$$\nn_{t+1}(z') \\;=\\; \\int_{\\mathbb{R}} K_h(z',z)\\, n_t(z)\\, dz\n$$\n核 $K_h(z',z)$ 表示具有性状 $z$ 的个体对下一代具有性状 $z'$ 的个体群体的总贡献。它由两个主要途径组成：\n1. 存活与生长：具有性状 $z$ 的个体以概率 $s(z;h)$ 存活，其性状值变为 $z'$。这个过程由项 $s(z;h)\\, G(z',z)$ 描述。\n2. 繁殖与补充：具有性状 $z$ 的个体以速率 $f(z;h)$ 产生后代，这些后代以性状值 $z'$ 加入种群。这由 $f(z;h)\\, R(z',z)$ 描述。\n总核是两者的和：\n$$\nK_h(z',z) \\;=\\; s(z;h)\\, G(z',z) \\;+\\; f(z;h)\\, R(z',z)\n$$\n参数 $h$ 表示种群平均表型相对于一个固定的选择环境的偏移。\n\n根据结构化种群理论，种群的长期渐近增长率 $\\lambda(h)$ 由 $K_h$ 定义的投影算子的主特征值给出。为了计算这个特征值，我们必须首先用一个有限维矩阵来近似这个无限维算子。这是通过数值求积实现的。我们将连续的性状轴 $z$ 离散化为一个包含 $M$ 个点的均匀网格 $z_1, z_2, \\dots, z_M$，跨越域 $[z_{\\min}, z_{\\max}]$。网格点由 $z_j = z_{\\min} + (j-1)\\Delta z$ 给出，其中 $j \\in \\{1, \\dots, M\\}$，网格间距为 $\\Delta z = (z_{\\max} - z_{\\min}) / (M - 1)$。然后使用中点法则将积分近似为一个和，从而得到核的矩阵表示 $K(h)$：\n$$\nK_{ij}(h) \\;=\\; \\left[s(z_j;h)\\, G(z_i,z_j) \\;+\\; f(z_j;h)\\, R(z_i,z_j)\\right]\\, \\Delta z\n$$\n这里，$K_{ij}(h)$ 是矩阵 $K(h)$ 的第 $i$ 行第 $j$ 列的元素，表示从性状为 $z_j$ 的个体到性狀为 $z_i$ 的个体的贡献。种群增长率 $\\lambda(h)$ 随后由这个 $M \\times M$ 矩阵的主特征值近似得到。由于核由非负函数（概率和速率）组成，得到的矩阵 $K(h)$ 是非负的。根据 Perron-Frobenius 定理，它有一个唯一的、实的、正的、主特征值，我们通过数值方法计算这个值。\n\n问题要求分析种群增长率 $\\lambda(h)$ 如何随表型偏移参数 $h$ 在 $h=0$ 点附近变化。这为了解对平均表型的选择压力提供了洞见。我们计算两个量：\n\n1. 敏感度，$S = \\frac{d\\lambda}{dh}\\big|_{h=0}$。这是适应度景观在 $h=0$ 处的斜率。它代表了定向选择的强度。非零的 $S$ 值表明平均表型的改变将提高种群的增长率。我们使用二阶中心有限差分公式来近似 $S$：\n$$\nS \\;\\approx\\; \\frac{\\lambda(\\varepsilon) - \\lambda(-\\varepsilon)}{2\\varepsilon}\n$$\n对于一个小的步长 $\\varepsilon  0$。\n\n2. 曲率，$C = \\frac{d^2}{dh^2}\\log \\lambda(h)\\big|_{h=0}$。这个量决定了选择的模式。负曲率 ($C  0$) 意味着 $\\log\\lambda(h)$ 在 $h=0$ 处是局部凹的，即 $h=0$ 是一个适应度最大值。这对应于稳定选择，它偏好当前的平均表型并惩罚偏差。正曲率 ($C > 0$) 意味着 $\\log\\lambda(h)$ 在 $h=0$ 处是局部凸的，即 $h=0$ 是一个适应度最小值。这对应于分裂选择，它偏好从当前平均表型发散。我们使用标准的二阶中心有限差分来近似二阶导数：\n$$\nC \\;\\approx\\; \\frac{\\log \\lambda(\\varepsilon) - 2 \\log \\lambda(0) + \\log \\lambda(-\\varepsilon)}{\\varepsilon^2}\n$$\n\n最后，我们根据计算出的曲率 $C$ 的符号对选择模式进行分类。为了考虑数值精度，我们引入一个容差 $\\tau  0$。我们将使用 $\\tau = 10^{-4}$，这对于在典型浮点运算中区分数值上显著的值和零是一个合理的选择。分类规则如下：\n- 如果 $C  -\\tau$，选择被分类为稳定选择 (代码 $-1$)。\n- 如果 $C > \\tau$，选择被分类为分裂选择 (代码 $+1$)。\n- 如果 $|C| \\le \\tau$，适应度景观被认为是局部平坦的，选择模式被分类为中性或未定 (代码 $0$)。\n\n实现使用了指定的数值参数：在域 $[-4, 4]$ 上的一个包含 $M=201$ 个点的网格，以及有限差分步长 $\\varepsilon=0.01$。对于每个测试用例，我们为 $h \\in \\{0, \\varepsilon, -\\varepsilon\\}$ 构建矩阵 $K(h)$，找到各自的主特征值，然后计算 $S$ 和 $C$ 来对选择模式进行分类。", "answer": "```python\nimport numpy as np\n\n# Global numerical parameters as specified in the problem\nM = 201\nZ_MIN, Z_MAX = -4.0, 4.0\nEPSILON = 0.01\nTAU = 1e-4 # Numerical tolerance for classification\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"s0\": 0.8, \"f0\": 2.0, \"alpha_s\": 0.03, \"alpha_f\": 0.02,\n            \"theta\": 0.0, \"sigma_g\": 0.2, \"sigma_r\": 0.3, \"rho\": 0.5\n        },\n        {\n            \"name\": \"Case B\",\n            \"s0\": 0.8, \"f0\": 2.0, \"alpha_s\": 1e-6, \"alpha_f\": 1e-6,\n            \"theta\": 0.5, \"sigma_g\": 0.2, \"sigma_r\": 0.3, \"rho\": 0.5\n        },\n        {\n            \"name\": \"Case C\",\n            \"s0\": 0.8, \"f0\": 2.0, \"alpha_s\": -0.03, \"alpha_f\": -0.02,\n            \"theta\": 0.0, \"sigma_g\": 0.2, \"sigma_r\": 0.3, \"rho\": 0.5\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        s, c, class_code = compute_ipm_metrics(params)\n        # Format results as a string representation of a list\n        results.append(f\"[{s:.6f},{c:.6f},{class_code}]\")\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\ndef gaussian_pdf(x, mu, sigma):\n    \"\"\"\n    Computes the Gaussian probability density function.\n    \"\"\"\n    return (1.0 / (sigma * np.sqrt(2 * np.pi))) * np.exp(-0.5 * ((x - mu) / sigma)**2)\n\ndef get_lambda(h, params, z_grid, delta_z):\n    \"\"\"\n    Constructs the IPM matrix K(h) and returns its dominant eigenvalue lambda(h).\n    \"\"\"\n    s0, f0 = params[\"s0\"], params[\"f0\"]\n    alpha_s, alpha_f = params[\"alpha_s\"], params[\"alpha_f\"]\n    theta, sigma_g, sigma_r, rho = params[\"theta\"], params[\"sigma_g\"], params[\"sigma_r\"], params[\"rho\"]\n    \n    # Use broadcasting for efficient matrix construction\n    # z_post is a column vector (M x 1), z_pre is a row vector (1 x M)\n    z_post = z_grid[:, np.newaxis]\n    z_pre = z_grid[np.newaxis, :]\n\n    # Survival and fecundity functions (1 x M vectors)\n    s_vec = s0 * np.exp(-alpha_s * (z_pre + h - theta)**2)\n    f_vec = f0 * np.exp(-alpha_f * (z_pre + h - theta)**2)\n\n    # Growth kernel G(z', z) (M x M matrix)\n    mu_g = z_pre # mu_g(z) = z\n    G = gaussian_pdf(z_post, mu_g, sigma_g)\n\n    # Recruitment kernel R(z', z) (M x M matrix)\n    mu_r = rho * z_pre + (1 - rho) * theta\n    R = gaussian_pdf(z_post, mu_r, sigma_r)\n\n    # Construct the IPM kernel matrix K\n    # Broadcasting multiplies each column of G/R by the corresponding element of s_vec/f_vec\n    K = (s_vec * G + f_vec * R) * delta_z\n    \n    # Compute eigenvalues. The dominant eigenvalue for a non-negative matrix\n    # is real, positive, and has the largest magnitude.\n    eigenvalues = np.linalg.eigvals(K)\n    dominant_eigenvalue = np.max(np.real(eigenvalues))\n    \n    return dominant_eigenvalue\n\ndef compute_ipm_metrics(params):\n    \"\"\"\n    Computes sensitivity (S), curvature (C), and classifies the selection mode.\n    \"\"\"\n    # Setup the trait grid\n    z_grid, delta_z = np.linspace(Z_MIN, Z_MAX, M, retstep=True)\n    \n    # Calculate lambda for the three required points for finite differences\n    lambda_p_eps = get_lambda(EPSILON, params, z_grid, delta_z)\n    lambda_n_eps = get_lambda(-EPSILON, params, z_grid, delta_z)\n    lambda_0 = get_lambda(0, params, z_grid, delta_z)\n\n    # Compute sensitivity S using the central difference formula\n    s = (lambda_p_eps - lambda_n_eps) / (2 * EPSILON)\n    \n    # Compute curvature C using the central difference formula for the second derivative\n    # Check for non-positive lambda which would make log invalid, though unlikely here\n    if lambda_p_eps = 0 or lambda_n_eps = 0 or lambda_0 = 0:\n        # This case is not expected for a biologically meaningful IPM\n        c = np.nan\n    else:\n        c = (np.log(lambda_p_eps) - 2 * np.log(lambda_0) + np.log(lambda_n_eps)) / (EPSILON**2)\n\n    # Classify selection mode based on curvature C and tolerance TAU\n    if c  -TAU:\n        class_code = -1  # Stabilizing\n    elif c > TAU:\n        class_code = 1   # Disruptive\n    else:\n        class_code = 0   # Approximately flat\n\n    return s, c, class_code\n\nsolve()\n```", "id": "2735647"}]}