{"hands_on_practices": [{"introduction": "贝叶斯系统发育推断的核心在于似然函数，它量化了在给定一棵树和演化模型的情况下，观测到特定DNA序列数据的概率。这个练习将带你回到原点，通过从Jukes-Cantor（JC69）模型的瞬时速率矩阵$Q$出发，推导出核苷酸替换的转移概率。掌握这一基本推导过程对于深刻理解更复杂模型（如GTR）如何将时间（枝长）与演化变化联系起来至关重要。[@problem_id:2694200]", "problem": "在贝叶斯系统发育推断中，分支似然是根据沿分支的核苷酸替换概率计算的。考虑 Jukes–Cantor (JC69) 核苷酸替换模型，该模型假设在字母表 $\\{A, C, G, T\\}$上是一个时齐连续时间马尔可夫链 (CTMC)，其平衡频率相等，为 $\\pi_{i} = \\frac{1}{4}$，且任意两个不同核苷酸之间的瞬时替换率也相等。设 CTMC 生成元（速率）矩阵为 $Q$，其元素为 $Q_{ij} = \\frac{\\mu}{3}$（当 $i \\neq j$）和 $Q_{ii} = -\\mu$，因此平均瞬时替换率为 $\\mu$。沿长度为 $t$ 的分支的转移概率矩阵为 $P(t) = \\exp(Qt)$，分支长度 $t$ 由标准缩放定义，即沿该分支每个位点的期望替换数等于 $t$。在此缩放标准下，平均替换率等于 $1$。\n\n仅从上述 CTMC 定义和使每个位点的期望替换数等于分支长度 $t$ 的缩放约定出发，推导 JC69 转移概率 $P_{ii}(t)$ 和 $P_{ij}(t)$（当 $i \\neq j$ 时）的闭式表达式，然后计算 $P_{ii}(0.1)$ 的数值。报告最终的 $P_{ii}(0.1)$ 数值，并四舍五入到四位有效数字。", "solution": "问题陈述经过验证，被认为是具有科学依据、良定且内部一致的。它描述了分子进化中的一个标准推导过程。我们将着手进行解答。\n\n问题要求从 Jukes-Cantor (JC69) 核苷酸替换模型的生成元矩阵 $Q$ 的定义出发，推导其转移概率。状态空间是四个核苷酸的集合 $\\{A, C, G, T\\}$。连续时间马尔可夫链的生成元矩阵 $Q$ 的元素给定为 $Q_{ij} = \\frac{\\mu}{3}$（对于任意两个不同状态 $i, j$）和 $Q_{ii} = -\\mu$，其中 $\\mu$ 是平均瞬时替换率。\n\n模型假设平衡频率是均匀的，即每个核苷酸 $i$ 的频率为 $\\pi_i = \\frac{1}{4}$。在平衡状态下对所有状态求平均的总体平均替换率定义为 $r = -\\sum_{i} \\pi_i Q_{ii}$。代入给定值，我们得到 $r = \\sum_{i} \\pi_i \\mu = \\sum_{i=1}^{4} \\frac{1}{4} \\mu = \\mu$。\n\n问题指定了一个缩放约定，即这个平均替换率等于 $1$。因此，我们必须有 $\\mu=1$。这个约定也确保了分支长度 $t$ 等于每个位点的期望替换数，因为期望替换数由平均速率与时间的乘积给出，即 $r \\times t = 1 \\times t = t$。\n\n当 $\\mu=1$ 时，$4 \\times 4$ 的生成元矩阵 $Q$ 为：\n$$\nQ = \\begin{pmatrix}\n-1 & \\frac{1}{3} & \\frac{1}{3} & \\frac{1}{3} \\\\\n\\frac{1}{3} & -1 & \\frac{1}{3} & \\frac{1}{3} \\\\\n\\frac{1}{3} & \\frac{1}{3} & -1 & \\frac{1}{3} \\\\\n\\frac{1}{3} & \\frac{1}{3} & \\frac{1}{3} & -1\n\\end{pmatrix}\n$$\n长度为 $t$ 的分支上的转移概率矩阵 $P(t)$ 由矩阵指数 $P(t) = \\exp(Qt)$ 给出。为了计算这个，我们可以将 $Q$ 表示为单位矩阵 $I$ 和全一矩阵 $J$ 的线性组合。直接观察可知 $Q = \\frac{1}{3}J - \\frac{4}{3}I$。\n我们来验证这个分解。对于一个非对角元素（$i \\neq j$），第 $(i,j)$ 个元素是 $\\frac{1}{3}J_{ij} - \\frac{4}{3}I_{ij} = \\frac{1}{3}(1) - \\frac{4}{3}(0) = \\frac{1}{3}$。对于一个对角元素（$i=j$），第 $(i,i)$ 个元素是 $\\frac{1}{3}J_{ii} - \\frac{4}{3}I_{ii} = \\frac{1}{3}(1) - \\frac{4}{3}(1) = -\\frac{3}{3} = -1$。该分解是正确的。\n\n由于矩阵 $I$ 和 $J$ 可交换，我们可以写成 $\\exp(Qt) = \\exp((\\frac{1}{3}J - \\frac{4}{3}I)t) = \\exp(-\\frac{4}{3}tI) \\exp(\\frac{t}{3}J)$。\n第一项就是 $\\exp(-\\frac{4}{3}t)I$。\n对于第二项，我们使用指数函数的泰勒级数展开式 $\\exp(X) = \\sum_{k=0}^{\\infty} \\frac{X^k}{k!}$。我们需要求 $J$ 的幂。对于一个 $4 \\times 4$ 的矩阵 $J$，我们有性质 $J^k = 4^{k-1}J$（当 $k \\ge 1$）。\n$$\n\\exp\\left(\\frac{t}{3}J\\right) = I + \\sum_{k=1}^{\\infty} \\frac{(\\frac{t}{3}J)^k}{k!} = I + \\sum_{k=1}^{\\infty} \\frac{(\\frac{t}{3})^k J^k}{k!} = I + J \\sum_{k=1}^{\\infty} \\frac{t^k 4^{k-1}}{3^k k!}\n$$\n$$\n= I + \\frac{J}{4} \\sum_{k=1}^{\\infty} \\frac{(4t/3)^k}{k!} = I + \\frac{J}{4} \\left( \\sum_{k=0}^{\\infty} \\frac{(4t/3)^k}{k!} - 1 \\right) = I + \\frac{J}{4} \\left( \\exp\\left(\\frac{4t}{3}\\right) - 1 \\right)\n$$\n现在，我们合并这些项来求 $P(t)$：\n$$\nP(t) = \\exp\\left(-\\frac{4t}{3}\\right)I \\cdot \\left[ I + \\frac{J}{4}\\left(\\exp\\left(\\frac{4t}{3}\\right) - 1\\right) \\right] = \\exp\\left(-\\frac{4t}{3}\\right)I + \\frac{J}{4}\\left(1 - \\exp\\left(-\\frac{4t}{3}\\right)\\right)\n$$\n从这个矩阵方程中，我们推导出各个转移概率的表达式。\n保持在同一状态的概率 $P_{ii}(t)$ 是 $P(t)$ 的一个对角元素。\n$$\nP_{ii}(t) = \\left( \\exp\\left(-\\frac{4t}{3}\\right)I \\right)_{ii} + \\left( \\frac{J}{4}\\left(1 - \\exp\\left(-\\frac{4t}{3}\\right)\\right) \\right)_{ii}\n$$\n$$\nP_{ii}(t) = \\exp\\left(-\\frac{4t}{3}\\right) \\cdot 1 + \\frac{1}{4}\\left(1 - \\exp\\left(-\\frac{4t}{3}\\right)\\right) \\cdot 1 = \\frac{1}{4} + \\frac{3}{4}\\exp\\left(-\\frac{4t}{3}\\right)\n$$\n转移到另一个特定状态的概率 $P_{ij}(t)$（当 $i \\neq j$ 时）是 $P(t)$ 的一个非对角元素。\n$$\nP_{ij}(t) = \\left( \\exp\\left(-\\frac{4t}{3}\\right)I \\right)_{ij} + \\left( \\frac{J}{4}\\left(1 - \\exp\\left(-\\frac{4t}{3}\\right)\\right) \\right)_{ij}\n$$\n$$\nP_{ij}(t) = \\exp\\left(-\\frac{4t}{3}\\right) \\cdot 0 + \\frac{1}{4}\\left(1 - \\exp\\left(-\\frac{4t}{3}\\right)\\right) \\cdot 1 = \\frac{1}{4}\\left(1 - \\exp\\left(-\\frac{4t}{3}\\right)\\right)\n$$\n这些就是所要求的闭式表达式。\n\n最后，我们必须计算 $P_{ii}(0.1)$ 的数值，并四舍五入到四位有效数字。我们将 $t=0.1$ 代入我们推导出的 $P_{ii}(t)$ 公式中：\n$$\nP_{ii}(0.1) = \\frac{1}{4} + \\frac{3}{4}\\exp\\left(-\\frac{4 \\times 0.1}{3}\\right) = 0.25 + 0.75\\exp\\left(-\\frac{0.4}{3}\\right) = 0.25 + 0.75\\exp\\left(-\\frac{2}{15}\\right)\n$$\n指数为 $-\\frac{2}{15} \\approx -0.13333$。\n计算其值：\n$$\nP_{ii}(0.1) \\approx 0.25 + 0.75 \\times (0.8751850) = 0.25 + 0.65638875 = 0.90638875\n$$\n四舍五入到四位有效数字，得到 $0.9064$。", "answer": "$$\\boxed{0.9064}$$", "id": "2694200"}, {"introduction": "在计算出给定树的似然之后，下一个挑战是如何在巨大的参数空间（包括所有可能的树形）中找到后验概率最高的区域。由于无法进行穷尽搜索，我们使用马尔可夫链蒙特卡洛（MCMC）方法进行抽样。这个练习聚焦于MCMC算法的核心决策步骤——Metropolis-Hastings接受准则，它决定了MCMC链是接受还是拒绝一个新提出的状态，从而引导抽样走向高概率区域。[@problem_id:2694143]", "problem": "在贝叶斯系统发育推断中，我们的目标是树的后验分布，其中树状态 $x$ 的后验密度表示为 $\\pi(x)$，它与 $x$ 下的序列数据的似然以及树和模型参数的先验的乘积成正比。使用Metropolis–Hastings移动根据转移概率为 $q(x \\to y)$ 的提议分布从 $x$ 提议一个新的树状态 $y$，然后以一个旨在使目标后验分布保持不变的概率接受该移动。\n\n假设我们正在对一个分支的有根系统发育树的后验分布执行马尔可夫链蒙特卡洛，并且提议了一个不改变参数化维度的单树移动（因此不需要雅可比因子）。给定当前状态 $x$ 和提议状态 $y$ 的以下未归一化后验密度和提议概率：\n- $\\pi(x) = \\exp(-100)$,\n- $\\pi(y) = \\exp(-98)$,\n- $q(x \\to y) = 0.3$,\n- $q(y \\to x) = 0.6$.\n\n计算此移动的Metropolis–Hastings接受概率。将最终答案表示为 $0$ 和 $1$ 之间的一个实数。无需四舍五入。", "solution": "该问题要求计算在以系统发育树的后验分布为目标的马尔可夫链蒙特卡洛（MCMC）模拟中，一个提议移动的Metropolis-Hastings接受概率。\n\n首先验证问题的正确性和可解性。\n\n**第1步：提取已知条件**\n- 当前状态 $x$ 的未归一化后验密度：$\\pi(x) = \\exp(-100)$。\n- 提议状态 $y$ 的未归一化后验密度：$\\pi(y) = \\exp(-98)$。\n- 从 $x$ 到 $y$ 的正向提议概率：$q(x \\to y) = 0.3$。\n- 从 $y$ 到 $x$ 的反向提议概率：$q(y \\to x) = 0.6$。\n- 该移动不改变参数维度，因此雅可比行列式为 $1$。\n\n**第2步：使用提取的已知条件进行验证**\n该问题具有科学依据，因为它描述了Metropolis-Hastings算法的一个标准应用，该算法是MCMC方法的基石，广泛用于贝叶斯统计学和计算生物学。该问题是适定的，为计算提供了所有必要的量。定义和数值是客观、精确和一致的。该问题是对MCMC接受准则理解的一个直接而非平凡的检验。未发现任何缺陷。\n\n**第3步：结论与行动**\n问题被判定为**有效**。将推导解答。\n\nMetropolis-Hastings算法确保生成的马尔可夫链以目标后验分布 $\\pi$ 为其平稳分布。这是通过为从状态 $x$ 到状态 $y$ 的提议移动设计一个接受概率 $\\alpha(x \\to y)$ 来实现的。该接受概率的通用公式为：\n$$\n\\alpha(x \\to y) = \\min \\left( 1, \\frac{\\pi(y) q(y \\to x)}{\\pi(x) q(x \\to y)} |J| \\right)\n$$\n其中 $\\pi(\\cdot)$ 是目标密度，$q(\\cdot \\to \\cdot)$ 是提议密度，而 $|J|$ 是参数空间之间变换的雅可比行列式。问题陈述该移动不改变参数化的维度，这意味着变换在同一空间内进行且 $|J| = 1$。因此，公式简化为：\n$$\n\\alpha(x \\to y) = \\min \\left( 1, \\frac{\\pi(y) q(y \\to x)}{\\pi(x) q(x \\to y)} \\right)\n$$\n后验密度 $\\pi(x)$ 和 $\\pi(y)$ 无需归一化，因为归一化常数会在比率中被抵消。\n\n我们将接受率 $R$ 定义为最小值函数内的第二项：\n$$\nR = \\frac{\\pi(y) q(y \\to x)}{\\pi(x) q(x \\to y)}\n$$\n我们将给定值代入此表达式中：\n- $\\pi(x) = \\exp(-100)$\n- $\\pi(y) = \\exp(-98)$\n- $q(x \\to y) = 0.3$\n- $q(y \\to x) = 0.6$\n\n计算过程如下：\n$$\nR = \\frac{\\exp(-98) \\cdot 0.6}{\\exp(-100) \\cdot 0.3}\n$$\n我们可以将后验密度的比率和提议概率的比率分开：\n$$\nR = \\left( \\frac{\\exp(-98)}{\\exp(-100)} \\right) \\cdot \\left( \\frac{0.6}{0.3} \\right)\n$$\n指数项的比率使用指数属性 $\\frac{\\exp(a)}{\\exp(b)} = \\exp(a-b)$ 计算：\n$$\n\\frac{\\exp(-98)}{\\exp(-100)} = \\exp(-98 - (-100)) = \\exp(100 - 98) = \\exp(2)\n$$\n提议概率的比率为：\n$$\n\\frac{0.6}{0.3} = 2\n$$\n结合这些结果，接受率 $R$ 为：\n$$\nR = \\exp(2) \\cdot 2 = 2e^2\n$$\n因此，接受概率为：\n$$\n\\alpha(x \\to y) = \\min(1, 2e^2)\n$$\n为了评估此表达式，我们必须确定 $2e^2$ 是大于1还是小于1。自然对数的底 $e$ 是一个超越数，其近似值为 $2.71828$。由于 $e > 1$，其平方 $e^2$ 也大于 $1$。具体来说，$e^2 \\approx (2.718)^2 \\approx 7.389$。\n因此，$R$ 的值约为 $2 \\times 7.389 = 14.778$。\n由于 $2e^2 > 1$，所以 $1$ 和 $2e^2$ 的最小值是 $1$。\n$$\n\\alpha(x \\to y) = 1\n$$\n这意味着从状态 $x$ 到状态 $y$ 的提议移动将总是被接受。这是符合预期的，因为提议状态 $y$ 具有更高的后验概率（$\\pi(y) > \\pi(x)$），并且Hastings修正项 $\\frac{q(y \\to x)}{q(x \\to y)} = 2$ 也倾向于该移动。", "answer": "$$\\boxed{1}$$", "id": "2694143"}, {"introduction": "贝叶斯推断不仅能估计参数，还能用于比较不同的演化假说，这通常体现为比较不同演化模型的优劣。这个练习将向你介绍贝叶斯因子（Bayes factor），这是贝叶斯框架下进行模型选择的黄金标准。你将学习如何利用系统发育软件通常输出的边际似然（marginal likelihood）的对数值，来计算贝叶斯因子，从而量化数据对某个模型相对于另一个模型的支持强度。[@problem_id:2694154]", "problem": "在对多个分类单元的脱氧核糖核酸（DNA）比对进行两个替换模型的贝叶斯系统发育比较中，假设您考虑模型 $M_1$ 与模型 $M_2$ 的对比。您已经使用一种有效的热力学路径抽样方法估计了边际似然，并获得了这些边际似然的自然对数，分别为 $\\ln p(D \\mid M_1) = -3200$ 和 $\\ln p(D \\mid M_2) = -3210$，其中 $D$ 表示观测到的比对。假设先验模型概率是正则且严格为正的。\n\n仅从贝叶斯定理和边际似然作为对模型特定参数积分的定义出发，推导一个用 $\\ln p(D \\mid M_1)$ 和 $\\ln p(D \\mid M_2)$ 表示的对数贝叶斯因子 $\\ln \\mathrm{BF}_{12}$ 的表达式，其中 $\\mathrm{BF}_{12}$ 用于比较 $M_1$ 和 $M_2$。然后使用上述数值计算 $\\ln \\mathrm{BF}_{12}$ 的值。\n\n将您的最终答案表示为单个实数。无需四舍五入。在整个计算过程中使用自然对数。", "solution": "该问题是有效的，因为它在科学上基于贝叶斯统计学，提法明确，客观且内容完整。我们被要求从基本原理出发推导对数贝叶斯因子的表达式，然后计算其值。\n\n让我们从应用于模型选择的贝叶斯定理开始。对于一组模型中的给定模型 $M_i$ 和观测数据 $D$，模型的后验概率由下式给出：\n$$\np(M_i \\mid D) = \\frac{p(D \\mid M_i) p(M_i)}{p(D)}\n$$\n这里，$p(M_i \\mid D)$ 是模型 $M_i$ 的后验概率，$p(D \\mid M_i)$ 是给定模型下数据的边际似然，$p(M_i)$ 是模型的先验概率，而 $p(D)$ 是数据的边际似然，它作为所有考虑模型的归一化常数。\n\n问题要求我们比较两个模型 $M_1$ 和 $M_2$。在贝叶斯框架下，标准的做法是计算后验优势比，它比较了两个模型的后验概率：\n$$\n\\frac{p(M_1 \\mid D)}{p(M_2 \\mid D)}\n$$\n将每个模型的贝叶斯定理表达式代入，我们得到：\n$$\n\\frac{p(M_1 \\mid D)}{p(M_2 \\mid D)} = \\frac{\\frac{p(D \\mid M_1) p(M_1)}{p(D)}}{\\frac{p(D \\mid M_2) p(M_2)}{p(D)}}\n$$\n归一化常数 $p(D)$ 被约去，得到：\n$$\n\\frac{p(M_1 \\mid D)}{p(M_2 \\mid D)} = \\frac{p(D \\mid M_1)}{p(D \\mid M_2)} \\times \\frac{p(M_1)}{p(M_2)}\n$$\n这个方程表明后验优势比是两项的乘积：贝叶斯因子和先验优势比。用于比较 $M_1$ 和 $M_2$ 的贝叶斯因子，记为 $\\mathrm{BF}_{12}$，定义为边际似然的比率：\n$$\n\\mathrm{BF}_{12} = \\frac{p(D \\mid M_1)}{p(D \\mid M_2)}\n$$\n问题陈述还要求从边际似然作为积分的定义出发。边际似然 $p(D \\mid M_i)$ 是通过将似然函数 $p(D \\mid \\theta_i, M_i)$ 在模型的整个参数空间上，按参数的先验分布 $p(\\theta_i \\mid M_i)$ 加权积分得到的：\n$$\np(D \\mid M_i) = \\int p(D \\mid \\theta_i, M_i) p(\\theta_i \\mid M_i) \\, d\\theta_i\n$$\n其中 $\\theta_i$ 代表模型 $M_i$ 的所有参数集。问题中给出的量 $\\ln p(D \\mid M_1)$ 和 $\\ln p(D \\mid M_2)$ 是这些积分的自然对数，它们是通过诸如热力学路径抽样等方法估计得到的。\n\n我们的任务是找到贝叶斯因子自然对数 $\\ln \\mathrm{BF}_{12}$ 的表达式。从 $\\mathrm{BF}_{12}$ 的定义开始：\n$$\n\\ln \\mathrm{BF}_{12} = \\ln \\left( \\frac{p(D \\mid M_1)}{p(D \\mid M_2)} \\right)\n$$\n利用对数性质 $\\ln(a/b) = \\ln(a) - \\ln(b)$，我们推导出用对数边际似然表示的对数贝叶斯因子表达式：\n$$\n\\ln \\mathrm{BF}_{12} = \\ln p(D \\mid M_1) - \\ln p(D \\mid M_2)\n$$\n这就是所要求推导的表达式。它表明对数贝叶斯因子就是两个竞争模型的对数边际似然之差。\n\n现在，我们使用问题陈述中给出的数值进行计算：\n- 模型 $M_1$ 的边际似然的自然对数：$\\ln p(D \\mid M_1) = -3200$。\n- 模型 $M_2$ 的边际似然的自然对数：$\\ln p(D \\mid M_2) = -3210$。\n\n将这些值代入我们推导的表达式中：\n$$\n\\ln \\mathrm{BF}_{12} = (-3200) - (-3210)\n$$\n$$\n\\ln \\mathrm{BF}_{12} = -3200 + 3210\n$$\n$$\n\\ln \\mathrm{BF}_{12} = 10\n$$\n得到的对数贝叶斯因子是 $10$。这个正值表明数据提供了支持模型 $M_1$ 优于模型 $M_2$ 的证据。", "answer": "$$\\boxed{10}$$", "id": "2694154"}]}