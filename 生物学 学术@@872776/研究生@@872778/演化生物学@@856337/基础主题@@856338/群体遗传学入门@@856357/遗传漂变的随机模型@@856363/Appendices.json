{"hands_on_practices": [{"introduction": "任何随机过程的研究都始于定义其状态转移规则。此练习将引导你从第一性原理出发，为群体遗传学中最经典的Wright-Fisher模型推导其单步转移概率 [@problem_id:2753551]。通过将世代交替中的随机抽样过程与二项分布联系起来，你将为理解遗传漂变奠定坚实的数学基础。", "problem": "考虑一个含有等位基因 $A$ 和 $a$ 的中性、双等位基因座，在一个大小恒为 $N$ 的二倍体 Wright–Fisher 种群中演化。世代不重叠，存在随机交配，无选择，无突变，也无迁移。设 $X_t$ 表示在第 $t$ 代的 $2N$ 个基因拷贝中等位基因 $A$ 的拷贝数。在 $X_t=i$ 的条件下，定义等位基因 $A$ 的频率为 $p=i/(2N)$。下一代是通过从亲代基因库中进行有放回的独立抽样形成 $2N$ 个基因拷贝而产生的，这与中性条件下的随机交配和孟德尔分离定律一致。\n\n仅从这些模型假设和有限抽样的第一性原理出发，推导在 $X_t=i$ 条件下 $X_{t+1}$ 的精确单步转移概率质量函数。你的最终答案必须是 $\\Pr(X_{t+1}=k \\mid X_t=i)$ 的一个单一闭式解析表达式，该表达式是关于 $N$、$i$ 和 $k$ 的函数，且仅使用基本函数和标准组合量。\n\n请用单一的代数表达式作答。不要提供不等式或需要求解的方程。无需四舍五入。", "solution": "该问题陈述已经过严格验证。这是一个理论群体遗传学中的标准、适定问题，基于成熟的随机模型原理。所有必要的数据和条件均已提供，不存在科学或逻辑上的不一致。任务是从第一性原理出发，推导 Wright-Fisher 模型的单步转移概率，这是一项基础练习。我们现在开始进行推导。\n\n在第 $t$ 代，种群的状态由 $X_t = i$ 给出，其中 $i$ 是在大小为 $2N$ 的总基因库中等位基因 $A$ 的拷贝数。$i$ 的取值范围可以从 $0$ 到 $2N$。由此，亲代基因库中等位基因 $A$ 的频率精确为 $p = \\frac{i}{2N}$。另一个等位基因 $a$ 的频率为 $1-p = 1 - \\frac{i}{2N} = \\frac{2N-i}{2N}$。\n\n问题陈述指出，下一代（第 $t+1$ 代）的基因库是通过从第 $t$ 代的基因库中进行 $2N$ 次有放回的独立抽样形成的。这种抽样方案是 Wright-Fisher 模型的决定性特征。为下一代抽取一个基因拷贝的过程可以被建模为单次试验。我们必须执行 $2N$ 次这样的试验来形成新一代。\n\n我们将单次试验的“成功”定义为抽出的基因拷贝是等位基因 $A$ 这一事件。由于抽样是有放回的，每次试验的成功概率是恒定的，并且独立于所有其他试验的结果。这个概率等于亲代基因库中等位基因 $A$ 的频率，即 $p = \\frac{i}{2N}$。\n\n我们关心的是下一代恰好包含 $k$ 个等位基因 $A$ 拷贝的概率。这等价于询问在一系列 $n = 2N$ 次独立的伯努利试验中获得恰好 $k$ 次成功的概率，其中每次试验的成功概率为 $p = \\frac{i}{2N}$。\n\n根据定义，这是一个可以用二项分布描述的问题。一个参数为 $n$（试验次数）和 $p$（成功概率）的二项随机变量 $K$ 的概率质量函数（PMF）由以下公式给出：\n$$ \\Pr(K=k) = \\binom{n}{k} p^k (1-p)^{n-k} $$\n其中 $k$ 是所求的成功次数，$\\binom{n}{k}$ 是二项式系数，它计算了从 $n$ 次总试验中选择 $k$ 次成功试验的方式数量。\n\n为了推导特定的转移概率 $\\Pr(X_{t+1}=k \\mid X_t=i)$，我们将 Wright-Fisher 模型的参数代入通用的二项 PMF 中：\n1.  试验次数是新一代中基因拷贝的总数，所以 $n = 2N$。\n2.  成功次数是新一代中期望的 $A$ 等位基因的数量，所以变量是 $k$。$k$ 的可能取值范围是 $0, 1, 2, \\dots, 2N$。\n3.  每次试验的成功概率是亲代中等位基因 $A$ 的频率，即 $p = \\frac{i}{2N}$。\n4.  失败（抽到等位基因 $a$）的概率是 $1-p = 1 - \\frac{i}{2N} = \\frac{2N-i}{2N}$。\n\n将这些值代入二项 PMF，得到 Wright-Fisher 模型的单步转移概率：\n$$ \\Pr(X_{t+1}=k \\mid X_t=i) = \\binom{2N}{k} \\left(\\frac{i}{2N}\\right)^k \\left(\\frac{2N-i}{2N}\\right)^{2N-k} $$\n这个表达式表示了在一个世代内，从拥有 $i$ 个等位基因 $A$ 拷贝的状态转移到拥有 $k$ 个拷贝的状态的概率。这是一个使用标准组合量的闭式解析表达式，符合要求。至此，从第一性原理出发的推导完成。", "answer": "$$\n\\boxed{\\binom{2N}{k} \\left(\\frac{i}{2N}\\right)^k \\left(\\frac{2N-i}{2N}\\right)^{2N-k}}\n$$", "id": "2753551"}, {"introduction": "定义了模型的转移规则后，一个自然的问题是：遗传漂变的影响有多大？本练习通过计算等位基因频率单代变化的方差来回答这个问题 [@problem_id:2753537]。这个方差是衡量遗传漂变强度的关键指标，它揭示了漂变效应如何依赖于等位基因频率和群体大小，并且是连接离散模型与连续扩散近似的桥梁。", "problem": "考虑一个经典的Wright–Fisher模型中的单个双等位基因中性位点。该模型描述了一个世代不重叠、随机交配、没有选择、突变或迁移的二倍体种群，其普查规模恒定为 $N$。在第 $t$ 代，等位基因 $A$ 的种群频率为 $p_t \\in [0,1]$。每一代都是通过从亲代基因库中有放回地独立抽取 $2N$ 个配子形成的，其中每个抽取的配子是 $A$ 型的概率为 $p_t$。\n\n定义下一代的等位基因频率为 $p_{t+1}$，单代变化为 $\\Delta p \\equiv p_{t+1} - p_t$。严格从Wright–Fisher模型的生成抽样机制以及二项分布和仿射变换下方差的基本性质出发，推导精确的条件方差 $\\operatorname{Var}(\\Delta p \\mid p_t, N)$，并将其表示为关于 $p_t$ 和 $N$ 的闭式表达式。不要使用扩散近似或渐近极限；精确计算有限 $N$ 下的结果。将最终答案表示为单一的解析表达式。无需四舍五入，也不涉及任何单位。", "solution": "所述问题需进行验证。\n\n步骤1：提取已知条件。\n- 模型：经典的Wright–Fisher模型。\n- 种群：二倍体，恒定普查规模 $N$。\n- 世代：不重叠。\n- 交配：随机。\n- 位点：单个双等位基因中性位点（等位基因 $A$）。\n- 进化力：无选择、突变或迁移。\n- 第 $t$ 代的等位基因频率：$p_t \\in [0,1]$。\n- 生成机制：每一代，从亲代基因库中有放回地独立抽取 $2N$ 个配子。\n- 抽样概率：抽到 $A$ 等位基因的概率是 $p_t$。\n- 下一代等位基因频率：$p_{t+1}$。\n- 单代等位基因频率变化：$\\Delta p \\equiv p_{t+1} - p_t$。\n- 目标：推导精确的条件方差 $\\operatorname{Var}(\\Delta p \\mid p_t, N)$。\n- 约束条件：推导必须仅使用生成抽样机制、二项分布的基本性质以及仿射变换下方差的性质。它必须是针对有限 $N$ 的精确闭式表达式，不得使用扩散近似或渐近极限。\n\n步骤2：使用提取的已知条件进行验证。\n问题陈述具有科学依据，提法明确且客观。它描述了种群遗传学中的一个标准基础模型（Wright–Fisher模型），并要求推导一个经典结果。所有术语都得到了精确定义，并提供了必要的信息。该问题不基于任何事实错误，不是隐喻性的，不不完整或矛盾，没有在其理论框架内描述不切实际的条件，不是提法不当的，是可科学验证的，并且不是一个“伪深刻”的问题。该问题是有效的。\n\n步骤3：结论与行动。\n该问题是有效的。将提供完整的推导过程。\n\n推导从问题陈述中定义的基本抽样过程开始。\n设 $X_{t+1}$ 为随机变量，表示在第 $t+1$ 代种群中等位基因 $A$ 的拷贝数。由于种群是大小为 $N$ 的二倍体，该位点的等位基因总数为 $2N$。\n根据Wright–Fisher模型的生成机制，第 $t+1$ 代的这 $2N$ 个等位基因是通过从第 $t$ 代的基因库中有放回地抽样获得的。亲代基因库中等位基因 $A$ 的频率为 $p_t$。\n因此，这 $2N$ 次抽取中的每一次都是一次独立的伯努利试验，其成功概率为 $p_t$（其中“成功”定义为抽到等位基因 $A$）。在 $2N$ 次独立伯努利试验中，成功的总次数 $X_{t+1}$ 服从二项分布。我们将此条件分布写为：\n$$\nX_{t+1} \\mid p_t \\sim \\text{Binomial}(n=2N, p=p_t)\n$$\n第 $t+1$ 代的等位基因频率，记作 $p_{t+1}$，根据定义是 $A$ 等位基因的数量除以种群中等位基因的总数。\n$$\np_{t+1} = \\frac{X_{t+1}}{2N}\n$$\n我们被要求求解等位基因频率变化的条件方差 $\\operatorname{Var}(\\Delta p \\mid p_t, N)$，其中 $\\Delta p = p_{t+1} - p_t$。\n让我们首先计算下一代等位基因频率的条件方差 $\\operatorname{Var}(p_{t+1} \\mid p_t, N)$。\n我们使用标量变换下的方差性质，即对于一个随机变量 $Y$ 和一个常数 $c$，有 $\\operatorname{Var}(cY) = c^2 \\operatorname{Var}(Y)$。在我们的例子中，$Y = X_{t+1}$ 且常数是 $c = \\frac{1}{2N}$。\n$$\n\\operatorname{Var}(p_{t+1} \\mid p_t, N) = \\operatorname{Var}\\left(\\frac{X_{t+1}}{2N} \\mid p_t, N\\right) = \\left(\\frac{1}{2N}\\right)^2 \\operatorname{Var}(X_{t+1} \\mid p_t, N)\n$$\n服从二项分布的随机变量 $Z \\sim \\text{Binomial}(n, p)$ 的方差由 $\\operatorname{Var}(Z) = np(1-p)$ 给出。\n将此应用于 $X_{t+1}$，我们有：\n$$\n\\operatorname{Var}(X_{t+1} \\mid p_t, N) = (2N) p_t (1 - p_t)\n$$\n将此结果代入 $p_{t+1}$ 的方差表达式中：\n$$\n\\operatorname{Var}(p_{t+1} \\mid p_t, N) = \\frac{1}{(2N)^2} [2N p_t (1 - p_t)] = \\frac{2N p_t (1 - p_t)}{4N^2} = \\frac{p_t(1 - p_t)}{2N}\n$$\n现在，我们考虑我们感兴趣的量，$\\operatorname{Var}(\\Delta p \\mid p_t, N)$。\n$$\n\\Delta p = p_{t+1} - p_t\n$$\n这个差值的方差必须在以 $p_t$ 为条件的背景下计算。在这个条件背景下，$p_t$ 是一个固定的、非随机的量。它是系统发生转变时的状态。\n我们使用常数平移下的方差性质，即对于一个随机变量 $Y$ 和一个常数 $k$，有 $\\operatorname{Var}(Y - k) = \\operatorname{Var}(Y)$。\n这里，$Y = p_{t+1}$ 且常数是 $k = p_t$。\n因此，\n$$\n\\operatorname{Var}(\\Delta p \\mid p_t, N) = \\operatorname{Var}(p_{t+1} - p_t \\mid p_t, N) = \\operatorname{Var}(p_{t+1} \\mid p_t, N)\n$$\n这就确定了等位基因频率变化的方差等于下一代等位基因频率的方差。\n综合我们的结果，我们得到最终的表达式：\n$$\n\\operatorname{Var}(\\Delta p \\mid p_t, N) = \\frac{p_t(1 - p_t)}{2N}\n$$\n这就是Wright–Fisher模型中单代等位基因频率变化的条件方差的精确闭式表达式，它是严格按照要求从模型的生成过程和基本统计学原理推导出来的。", "answer": "$$\n\\boxed{\\frac{p_t(1 - p_t)}{2N}}\n$$", "id": "2753537"}, {"introduction": "虽然Wright-Fisher模型是离散的，但其长期动态可以通过一个连续的随机微分方程（SDE）来近似，这便是强大的扩散近似。本练习要求你从理论走向计算，通过实现欧拉-丸山方法来模拟包含选择、突变和漂变的广义Wright-Fisher扩散过程 [@problem_id:2753540]。这项编码实践不仅能让你直观地观察等位基因频率的随机轨迹，还能让你深入理解不同演化力如何相互作用，并应对边界条件等数值挑战。", "problem": "您需要实现一个针对带有选择和双向突变的 Wright–Fisher 扩散的数值模拟器，该模拟器使用随机微分方程的 Euler–Maruyama 离散化方法。等位基因频率过程被建模为等位基因1频率 $p_t \\in [0,1]$ 的一维 Itô 扩散，其漂移系数和扩散系数源于经典群体遗传学。模型假设如下：\n\n- 存在一个恒定的有效种群大小 $N_e > 0$。\n- 存在作用于等位基因1的基因选择，其选择系数为 $s \\in \\mathbb{R}$。\n- 从等位基因1到等位基因0的突变率为 $u \\ge 0$，从等位基因0到等位基因1的突变率为 $v \\ge 0$。\n- Wright–Fisher 扩散的漂移 $a(p)$ 和扩散 $b(p)$ 由以下公式给出：\n  $$ a(p) = s\\,p\\,(1-p) + v\\,(1-p) - u\\,p, \\qquad b(p) = \\frac{p\\,(1-p)}{2\\,N_e}. $$\n- $p_t$ 的随机微分方程（Itô 形式）为：\n  $$ \\mathrm{d}p_t = a(p_t)\\,\\mathrm{d}t + \\sqrt{b(p_t)}\\,\\mathrm{d}W_t, $$\n  其中 $W_t$ 是一个标准 Wiener 过程。\n\n您的任务是：\n\n1. 基于上述模型规范（这是基本依据），实现单路径 Euler–Maruyama 时间离散化，以在均匀网格 $t_n = n\\,\\Delta t$（其中 $n=0,1,\\dots, T/\\Delta t$）上模拟 $p_t$，并使用给定的初始条件 $p_0 \\in [0,1]$。每个时间步使用独立的标准正态增量。\n2. 按如下方式强制执行状态约束：\n   - 在每个 Euler–Maruyama 步骤之后，如果状态离开闭区间 $[0,1]$，则通过钳位将其投影回该区间，即用 $\\min\\{\\max\\{\\tilde p,0\\},1\\}$ 替换任何提议值 $\\tilde p$。\n   - 如果 $u = 0$ 且 $v = 0$（无突变），则将 $p=0$ 和 $p=1$ 视为吸收边界：一旦过程达到 $p=0$ 或 $p=1$，它将在所有后续步骤中保持不变。如果突变非零（即 $u>0$ 或 $v>0$），则不进行吸收。\n3. 在您的内部设计中讨论数值稳定性，并在测试套件中选择能反映 $p=0$ 和 $p=1$ 附近稳定和潜在不稳定区域的 $\\Delta t$ 值。数值方法应具有鲁棒性，即对于所有指定的测试用例，它都能终止并返回一个在 $[0,1]$ 区间内的值。\n\n使用以下测试套件。对于每个测试用例，使用指定的参数模拟单个轨迹，并使用提供的伪随机种子以保证可复现性。返回在时间 $T$（即在 $t = T$ 时）的最终等位基因频率，以小数形式表示，并四舍五入到小数点后恰好六位。\n\n- 测试用例 1 (理想路径，中性，内部起始)：$N_e = 10000$, $s = 0$, $u = 0$, $v = 0$, $p_0 = 0.5$, $T = 1.0$, $\\Delta t = 0.0005$, seed $= 12345$。\n- 测试用例 2 (接近 $0$，弱正选择和微小正向突变)：$N_e = 5000$, $s = 0.01$, $u = 0$, $v = 0.00001$, $p_0 = 0.001$, $T = 2.0$, $\\Delta t = 0.0005$, seed $= 2021$。\n- 测试用例 3 (接近 $1$，负选择和远离等位基因1的突变)：$N_e = 5000$, $s = -0.02$, $u = 0.00002$, $v = 0$, $p_0 = 0.999$, $T = 1.5$, $\\Delta t = 0.0005$, seed $= 2022$。\n- 测试用例 4 (较粗的时间步以探测稳定性)：$N_e = 2000$, $s = 0$, $u = 0$, $v = 0$, $p_0 = 0.3$, $T = 1.0$, $\\Delta t = 0.01$, seed $= 7$。\n- 测试用例 5 (小 $N_e$，对称突变和更强的漂移)：$N_e = 50$, $s = 0$, $u = 0.001$, $v = 0.001$, $p_0 = 0.5$, $T = 0.5$, $\\Delta t = 0.0005$, seed $= 4242$。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。例如，输出必须如下所示：\n  $$ [x_1,x_2,x_3,x_4,x_5], $$\n  其中每个 $x_i$ 是测试用例 $i$ 的最终等位基因频率，四舍五入到小数点后六位，并以小数形式表示（无百分号）。\n\n不需要也不允许用户输入。给定上述种子，输出应该是确定性的。根据构造，所有结果都必须在闭区间 $[0,1]$ 内。", "solution": "所提出的问题是 Wright–Fisher 扩散的数值模拟，这是群体遗传学中的一个基本随机过程，用于模拟等位基因频率在突变、选择和遗传漂变作用下的演化。任务是实现 Euler–Maruyama 方法来求解相应的随机微分方程 (SDE)。问题陈述的有效性得到了确认，因为它在既有理论中有科学依据，提供了所有必需的参数，是良定的，并且被客观地表述为一个计算任务。\n\n等位基因频率的演化（表示为 $p_t$）由一维 Itô SDE 描述：\n$$\n\\mathrm{d}p_t = a(p_t)\\,\\mathrm{d}t + \\sqrt{b(p_t)}\\,\\mathrm{d}W_t\n$$\n其中 $W_t$ 是一个标准 Wiener 过程。漂移系数 $a(p)$ 和扩散系数 $b(p)$ 分别概括了确定性力和随机力。\n\n漂移项 $a(p) = s\\,p\\,(1-p) + v\\,(1-p) - u\\,p$ 模拟了等位基因频率的系统性变化。项 $s\\,p\\,(1-p)$ 代表基因选择，其中 $s$ 是选择系数。项 $v\\,(1-p)$ 和 $-u\\,p$ 分别代表从等位基因0到等位基因1的突变（速率为 $v$）和从等位基因1到等位基因0的突变（速率为 $u$）。\n\n扩散项 $b(p) = \\frac{p\\,(1-p)}{2\\,N_e}$ 模拟了由于有限种群大小而引起的随机波动，这被称为遗传漂变。这些波动的幅度与有效种群大小 $N_e$ 成反比。\n\n为了模拟该过程的轨迹，我们将时间离散化为大小为 $\\Delta t$ 的步长，使得 $t_n = n\\,\\Delta t$。Euler–Maruyama 格式通过以下递推关系来近似 SDE：\n$$\np_{n+1} = p_n + a(p_n)\\,\\Delta t + \\sqrt{b(p_n)}\\,\\Delta W_n\n$$\n其中 $p_n \\approx p(t_n)$ 且 $\\Delta W_n = W_{t_{n+1}} - W_{t_n}$ 是 Wiener 过程的一个增量。这些增量是独立同分布的正态随机变量，均值为0，方差为 $\\Delta t$。因此我们可以写成 $\\Delta W_n = \\sqrt{\\Delta t}\\,Z_n$，其中 $Z_n$ 是一个标准正态随机变量，$Z_n \\sim \\mathcal{N}(0, 1)$。\n\n代入 $a(p)$、$b(p)$ 和 $\\Delta W_n$ 的表达式，提议的下一状态 $\\tilde{p}_{n+1}$ 的完整更新规则是：\n$$\n\\tilde{p}_{n+1} = p_n + \\left( s\\,p_n\\,(1-p_n) + v\\,(1-p_n) - u\\,p_n \\right)\\Delta t + \\sqrt{\\frac{p_n\\,(1-p_n)}{2\\,N_e}}\\sqrt{\\Delta t}\\,Z_n\n$$\n\n此数值模拟的一个关键方面是处理 $p=0$ 和 $p=1$ 处的状态空间边界。根据定义，等位基因频率局限于区间 $[0,1]$ 内。然而，Euler–Maruyama 步骤中的随机项可能导致 $\\tilde{p}_{n+1}$ 落在此区间之外，这在数学上和生物学上都是无意义的。这是该数值格式的一个常见的人为现象。\n为确保过程保持在其有效域内，强制执行两条规则：\n\n1.  **钳位**：每一步之后，将提议值 $\\tilde{p}_{n+1}$ 投影回区间 $[0,1]$。这是通过操作 $p_{n+1} = \\max(0, \\min(1, \\tilde{p}_{n+1}))$ 实现的。此方法是鲁棒的，并能确保状态变量始终保持有效。\n\n2.  **吸收边界**：在没有突变（$u=0$ 和 $v=0$）的情况下，边界 $p=0$ 和 $p=1$ 代表一个等位基因的固定。在这些点，漂移 $a(p)$ 和扩散系数 $b(p)$ 均为零。因此，一旦频率达到0或1，它就被“吸收”并且不能再改变。在模拟中，如果在这些条件下 $p_n$ 为0或1，它将在所有后续时间步中保持固定。当存在突变时（$u>0$ 或 $v>0$），边界不再是吸收性的。例如，在 $p=0$ 处，漂移变为 $a(0)=v>0$，将频率推回到区间 $(0,1]$ 内。类似的效果发生在 $p=1$ 处，此时 $a(1)=-u<0$。钳位机制正确地处理了这种来自边界的“反射”（更准确地说是重新进入）。\n\n数值稳定性是一个需要关注的问题，尤其是在使用较大的时间步长 $\\Delta t$ 时。大的 $\\Delta t$ 会增加随机增量的方差，使得发生大的、非物理的跳跃的可能性更高。测试用例4通过使用比其他用例大20倍的 $\\Delta t$ 来探讨这一点。尽管存在解析的稳定性条件，但指定的钳位程序提供了一个实用且鲁棒的解决方案，可以防止模拟失败，代价是如果时间步相对于动力学过程过大，可能会引入小的偏差。\n\n单个模拟路径的算法如下：\n1.  初始化参数：$N_e, s, u, v, p_0, T, \\Delta t$，以及伪随机数生成器的种子。\n2.  设置初始等位基因频率 $p = p_0$。\n3.  计算总时间步数 $N_{\\text{steps}} = \\text{round}(T / \\Delta t)$。\n4.  迭代 $N_{\\text{steps}}$ 次：\n    a.  如果 $u=0$，$v=0$，并且 $p=0$ 或 $p=1$，则状态被吸收；该路径的模拟可以终止，返回当前的 $p$ 值。\n    b.  计算漂移 $a(p)$ 和扩散标准差因子 $\\sigma_p = \\sqrt{p(1-p)/(2N_e)}$。\n    c.  生成一个标准正态随机数 $Z \\sim \\mathcal{N}(0,1)$。\n    d.  计算下一个提议状态：$\\tilde{p} = p + a(p)\\Delta t + \\sigma_p \\sqrt{\\Delta t} Z$。\n    e.  应用钳位规则：$p = \\max(0, \\min(1, \\tilde{p}))$。\n5.  循环终止后，最终的 $p$ 值即为结果 $p_T$。\n\n此过程将应用于每个测试用例，以生成所需的结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the suite of Wright-Fisher diffusion simulations.\n    \"\"\"\n\n    test_cases = [\n        # (Ne, s, u, v, p0, T, dt, seed)\n        (10000, 0.0, 0.0, 0.0, 0.5, 1.0, 0.0005, 12345),\n        (5000, 0.01, 0.0, 0.00001, 0.001, 2.0, 0.0005, 2021),\n        (5000, -0.02, 0.00002, 0.0, 0.999, 1.5, 0.0005, 2022),\n        (2000, 0.0, 0.0, 0.0, 0.3, 1.0, 0.01, 7),\n        (50, 0.0, 0.001, 0.001, 0.5, 0.5, 0.0005, 4242),\n    ]\n\n    results = []\n    for params in test_cases:\n        final_p = simulate_wf_diffusion(*params)\n        # Format the result to exactly six decimal places.\n        results.append(f\"{final_p:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef simulate_wf_diffusion(Ne, s, u, v, p0, T, dt, seed):\n    \"\"\"\n    Simulates a single path of the Wright-Fisher diffusion using Euler-Maruyama.\n\n    Args:\n        Ne (int): Effective population size.\n        s (float): Selection coefficient.\n        u (float): Mutation rate from allele 1 to 0.\n        v (float): Mutation rate from allele 0 to 1.\n        p0 (float): Initial allele frequency.\n        T (float): Total simulation time.\n        dt (float): Time step size.\n        seed (int): Seed for the pseudo-random number generator.\n\n    Returns:\n        float: The final allele frequency at time T.\n    \"\"\"\n    \n    # Initialize the pseudo-random number generator for reproducibility.\n    rng = np.random.default_rng(seed)\n\n    # Current allele frequency.\n    p = p0\n    \n    # Calculate the number of steps, ensuring it is an integer.\n    # Using round() is robust against floating-point inaccuracies.\n    num_steps = int(round(T / dt))\n    \n    # Pre-calculate sqrt(dt) for efficiency in the loop.\n    sqrt_dt = np.sqrt(dt)\n\n    # Check for absorbing boundaries case at the start.\n    is_absorbing = (u == 0.0 and v == 0.0)\n\n    for _ in range(num_steps):\n        # Handle absorbing boundaries if applicable.\n        if is_absorbing and (p == 0.0 or p == 1.0):\n            # If the state is absorbed, it remains fixed.\n            break\n\n        # Calculate drift coefficient a(p).\n        drift_a = s * p * (1 - p) + v * (1 - p) - u * p\n\n        # Calculate diffusion coefficient b(p).\n        # This will be zero if p=0 or p=1, correctly nullifying the stochastic term.\n        diffusion_b_term = np.sqrt(p * (1 - p) / (2 * Ne))\n\n        # Generate a standard normal random increment.\n        Z = rng.normal(0, 1)\n\n        # Euler-Maruyama step.\n        # The stochastic increment is sqrt(b(p)) * dW = sqrt(b(p)) * Z * sqrt(dt).\n        p_tilde = p + drift_a * dt + diffusion_b_term * Z * sqrt_dt\n        \n        # Enforce state constraints [0, 1] by clamping.\n        p = min(max(p_tilde, 0.0), 1.0)\n    \n    return p\n\n# Execute the simulation.\nsolve()\n```", "id": "2753540"}]}