{"hands_on_practices": [{"introduction": "近交系数 $F$ 是量化非随机交配效应的基石概念。本练习提供了一种将这个抽象概率转化为具体、可观察结果的直接方法：即基因型频率以及在显性效应下的不同表型比例。通过从第一性原理出发，推导近交如何改变哈迪-温伯格平衡下的基因型频率，本练习旨在巩固应用Sewall Wright经典模型的核心计算技能。[@problem_id:2832910]", "problem": "一个泛交基线群体被一个部分非随机交配系统所取代，该系统的特征是导致近亲繁殖的正向选型交配。考虑一个具有两个等位基因 $A$ 和 $a$ 的常染色体座位，其中 $A$ 的等位基因频率为 $p$，$a$ 的等位基因频率为 $q=1-p$。该交配结构由 Sewall Wright 意义上的个体近交系数 $F$ 概括：$F$ 是指在一个随机选择的个体中，某一座位上的两个等位基因是同源相同的概率。假设在所研究的世代中没有选择、没有突变、也没有迁移，并且除了由 $F$ 捕捉到的非随机交配外，配子的形成和结合是随机的。\n\n在 $A$ 完全显性的情况下，基因型 $AA$ 和 $Aa$ 表现出相同的显性表型，而 $aa$ 表现出隐性表型。从作为随机交配基线的哈代-温伯格定律和近交系数 $F$ 作为同源相同概率的定义出发，推导近交情况下的基因型频率，然后将预期的显性和隐性表型比例表示为 $p$、$q$ 和 $F$ 的函数。最后，对 $p=0.2$ 和 $F=0.3$ 的情况计算这些表达式的值，并以“显性，隐性”的形式报告表型比例的有序对。\n\n提供精确值（不要四舍五入），并以两个不带单位的纯数字形式表示您的最终答案。", "solution": "问题陈述具有科学依据且表述清晰。它要求在一个近交模型下推导基因型和表型频率，然后进行数值计算。我们将开始求解。\n\n近交系数 $F$ 定义为一个个体中某一座位上的两个等位基因是同源相同（IBD）的概率。其互补概率 $1-F$ 是它们不是 IBD 的概率。我们可以通过考虑一个随机选择个体的这两种可能性来推导基因型频率。\n\n设群体基因库中等位基因 $A$ 的频率为 $p$，等位基因 $a$ 的频率为 $q=1-p$。假设不存在选择、突变和迁移等进化力量，因此这些等位基因频率在所研究的世代中保持不变。\n\n1.  **等位基因是 IBD**：这种情况发生的概率为 $F$。如果两个等位基因是 IBD，它们必定是同一个等位基因。祖先等位基因为 $A$ 的概率是 $p$，从而产生 $AA$ 基因型。祖先等位基因为 $a$ 的概率是 $q$，从而产生 $aa$ 基因型。因此，来自 IBD 等位基因对基因型频率的贡献是 $AA$ 为 $Fp$，$aa$ 为 $Fq$。通过这种途径不可能产生杂合子。\n\n2.  **等位基因不是 IBD**：这种情况发生的概率为 $1-F$。如果等位基因不是 IBD，它们可以被看作是从基因库中进行的两次独立抽样。在这种情况下，基因型频率由哈代-温伯格定律给出：$AA$ 为 $p^2$，$Aa$ 为 $2pq$，$aa$ 为 $q^2$。来自这种非 IBD 途径对总基因型频率的贡献是 $AA$ 为 $(1-F)p^2$，$Aa$ 为 $(1-F)2pq$，$aa$ 为 $(1-F)q^2$。\n\n通过将这两个互斥途径的概率相加，我们得到近交情况下的基因型频率：\n纯合基因型 $AA$ 的频率，记作 $f(AA)$，是：\n$$f(AA) = Fp + (1-F)p^2 = Fp + p^2 - Fp^2 = p^2 + Fp(1-p) = p^2 + Fpq$$\n杂合基因型 $Aa$ 的频率，记作 $f(Aa)$，是：\n$$f(Aa) = F \\cdot 0 + (1-F)2pq = 2pq(1-F)$$\n纯合基因型 $aa$ 的频率，记作 $f(aa)$，是：\n$$f(aa) = Fq + (1-F)q^2 = Fq + q^2 - Fq^2 = q^2 + Fq(1-q) = q^2 + Fpq$$\n\n这些是在近交系数为 $F$ 的情况下，单个座位上两个等位基因的基因型频率的一般表达式。作为检验，它们的和是 $f(AA) + f(Aa) + f(aa) = (p^2+Fpq) + (2pq-2Fpq) + (q^2+Fpq) = p^2+2pq+q^2 = (p+q)^2 = 1$，这是正确的。\n\n接下来，我们确定表型的比例。问题陈述了等位基因 $A$ 对等位基因 $a$ 是完全显性。这意味着具有基因型 $AA$ 和 $Aa$ 的个体会表现出显性表型，而具有基因型 $aa$ 的个体将表现出隐性表型。\n\n显性表型的比例是 $AA$ 和 $Aa$ 基因型频率的总和：\n$$\\text{Proportion(Dominant)} = f(AA) + f(Aa) = (p^2 + Fpq) + 2pq(1-F) = p^2 + Fpq + 2pq - 2Fpq = p^2 + 2pq - Fpq$$\n注意到总比例必须为 $1$，可以推导出一个更方便的形式：\n$$\\text{Proportion(Dominant)} = 1 - f(aa) = 1 - (q^2 + Fpq)$$\n\n隐性表型的比例就是 $aa$ 基因型的频率：\n$$\\text{Proportion(Recessive)} = f(aa) = q^2 + Fpq$$\n\n我们被给予具体数值 $p = 0.2$ 和 $F = 0.3$。\n由此，我们计算隐性等位基因 $a$ 的频率：\n$$q = 1 - p = 1 - 0.2 = 0.8$$\n\n现在我们将这些数值代入表型比例的表达式中。\n首先，我们计算隐性表型的比例：\n$$\\text{Proportion(Recessive)} = q^2 + Fpq = (0.8)^2 + (0.3)(0.2)(0.8)$$\n$$\\text{Proportion(Recessive)} = 0.64 + (0.3)(0.16) = 0.64 + 0.048 = 0.688$$\n\n接下来，我们计算显性表型的比例。由于只有两种表型，这个比例必须是 $1$ 减去隐性表型的比例。\n$$\\text{Proportion(Dominant)} = 1 - \\text{Proportion(Recessive)} = 1 - 0.688 = 0.312$$\n\n问题要求以“显性，隐性”的形式给出表型比例的有序对。这对应于有序对 $(0.312, 0.688)$。这些是精确的小数值。", "answer": "$$\\boxed{\\begin{pmatrix} 0.312  0.688 \\end{pmatrix}}$$", "id": "2832910"}, {"introduction": "这个练习是科学推理中的一个关键环节。在学习了近交如何导致杂合子缺失后，理解其逆命题并非总是成立至关重要。本实践通过一个思想实验，展示了经典的瓦伦德效应（Wahlund effect）：即使在亚群内部交配是完全随机的，仅因存在种群结构，在合并样本中也会出现表观上的杂合子缺失。这项练习强调了在遗传分析中考虑种群亚结构的重要性，并培养了对数据进行批判性解读的能力。[@problem_id:2832903]", "problem": "考虑一个具有等位基因 $A$ 和 $a$ 的单位点双等位基因座。两个地理上隔离的亚群 $S_{1}$ 和 $S_{2}$，各自内部随机交配，无选择性交配，也无近亲繁殖。在每个亚群内部，基因型频率假定满足 Hardy–Weinberg 平衡 (HWE)。亚群 $S_{1}$ 的抽样权重为 $w_{1} = 0.30$，等位基因 $A$ 的频率为 $p_{1} = 0.20$；亚群 $S_{2}$ 的抽样权重为 $w_{2} = 0.70$，等位基因 $A$ 的频率为 $p_{2} = 0.80$。一位研究者将 $S_{1}$ 和 $S_{2}$ 的样本混合，但在计算杂合度时忽略了亚群的身份。\n\n仅使用第一性原理（亚群内部随机交配、亚群内部的 HWE、杂合度定义为杂合子频率，以及 Wright 固定指数在亚群相对于总体的定义，$F_{IS}$），计算混合样本的 $F_{IS}$ 值，其定义为 $F_{IS} = 1 - H_{\\mathrm{obs}}/H_{\\mathrm{exp}}$，其中 $H_{\\mathrm{obs}}$ 是混合样本的观测杂合度，$H_{\\mathrm{exp}}$ 是根据混合等位基因频率计算的 Hardy–Weinberg 期望杂合度。\n\n报告 $F_{IS}$ 的数值，并将答案四舍五入至四位有效数字。无需单位。", "solution": "首先将对问题陈述进行严格验证。\n\n步骤 1：提取已知条件\n-   系统：一个具有等位基因 $A$ 和 $a$ 的单位点双等位基因座。\n-   亚群：$S_1$ 和 $S_2$，地理上隔离。\n-   交配系统：每个亚群内部随机交配；无选择性交配；无近亲繁殖。\n-   基因型频率：假定在每个亚群内部处于 Hardy–Weinberg 平衡 (HWE)。\n-   $S_1$ 的参数：抽样权重 $w_1 = 0.30$，等位基因 $A$ 的频率为 $p_1 = 0.20$。\n-   $S_2$ 的参数：抽样权重 $w_2 = 0.70$，等位基因 $A$ 的频率为 $p_2 = 0.80$。\n-   分析：样本被混合，亚群结构被忽略。\n-   目标：计算混合样本的 $F_{IS}$ 值。\n-   提供的定义：$F_{IS} = 1 - H_{\\mathrm{obs}}/H_{\\mathrm{exp}}$。\n-   $H_{\\mathrm{obs}}$ 的定义：混合观测杂合度。\n-   $H_{\\mathrm{exp}}$ 的定义：根据混合等位基因频率计算的 Hardy–Weinberg 期望杂合度。\n-   约束：仅使用第一性原理。\n-   报告要求：最终数值必须四舍五入到四位有效数字。\n\n步骤 2：使用提取的已知条件进行验证\n该问题在科学上是合理的、定义明确的且客观的。它描述了群体遗传学中的一个经典场景，即 Wahlund 效应，该效应表明当不同的亚群被混合并作为一个单一单元进行分析时，会出现杂合子缺失。所有必要的参数（$w_1$, $w_2$, $p_1$, $p_2$）均已提供，并且它们是一致的（$w_1 + w_2 = 0.30 + 0.70 = 1.0$）。计算所需术语的定义已明确说明。\n\n必须指出，问题对符号 $F_{IS}$ 的使用是非标准的。数量 $F_{IS}$ 通常衡量亚群内部相对于该亚群等位基因频率的非随机交配效应。鉴于亚群内部随机交配的前提，$S_1$ 和 $S_2$ 的真实 $F_{IS}$ 为 $0$。所提供的公式 $1 - H_{\\mathrm{obs}}/H_{\\mathrm{exp}}$，其中 $H_{\\mathrm{obs}}$ 是跨亚群的平均杂合度，$H_{\\mathrm{exp}}$ 是总群体的期望杂合度，实际上定义的是 Wright 的固定指数 $F_{ST}$。该指数衡量了种群亚结构的影响。然而，由于问题为其标记为“$F_{IS}$”的数量提供了一个明确、无歧义的局部定义，因此术语上的不一致性并不会使问题无效或定义不善。我们将按照给定的具体公式继续计算该值。\n\n步骤 3：结论与行动\n问题有效。将推导出一个完整的解决方案。\n\n问题要求计算一个定义为 $F_{IS} = 1 - H_{\\mathrm{obs}}/H_{\\mathrm{exp}}$ 的量。这将分三个阶段完成：首先，计算总群体的期望杂合度 $H_{\\mathrm{exp}}$；其次，计算混合样本中的观测杂合度 $H_{\\mathrm{obs}}$；第三，将这些值代入给定的公式。\n\n首先，我们确定混合总群体中等位基因 $A$ 的频率，记为 $p_T$。这是两个亚群中等位基因频率的加权平均值，权重是它们对混合池的相对贡献。\n$$p_T = w_1 p_1 + w_2 p_2$$\n代入给定值：\n$$p_T = (0.30)(0.20) + (0.70)(0.80) = 0.06 + 0.56 = 0.62$$\n因此，总群体中等位基因 $a$ 的频率 $q_T$ 为：\n$$q_T = 1 - p_T = 1 - 0.62 = 0.38$$\n期望杂合度 $H_{\\mathrm{exp}}$ 是在等位基因频率为 $p_T$ 和 $q_T$ 的总群体中，根据 Hardy–Weinberg 平衡所期望的杂合子（$Aa$）频率。\n$$H_{\\mathrm{exp}} = 2 p_T q_T$$\n代入计算出的值：\n$$H_{\\mathrm{exp}} = 2 (0.62)(0.38) = 0.4712$$\n\n接下来，我们计算混合样本的“观测”杂合度 $H_{\\mathrm{obs}}$。问题陈述每个亚群都处于 HWE 状态。这意味着亚群 $S_i$ 内杂合子的实际频率由 $H_i = 2 p_i q_i$ 给出。混合观测杂合度是这些亚群内部杂合度的加权平均值。\n\n对于亚群 $S_1$：\n等位基因 $a$ 的频率为 $q_1 = 1 - p_1 = 1 - 0.20 = 0.80$。\n杂合度为 $H_1 = 2 p_1 q_1 = 2 (0.20)(0.80) = 0.32$。\n\n对于亚群 $S_2$：\n等位基因 $a$ 的频率为 $q_2 = 1 - p_2 = 1 - 0.80 = 0.20$。\n杂合度为 $H_2 = 2 p_2 q_2 = 2 (0.80)(0.20) = 0.32$。\n\n混合观测杂合度 $H_{\\mathrm{obs}}$ 是 $H_1$ 和 $H_2$ 的加权平均值：\n$$H_{\\mathrm{obs}} = w_1 H_1 + w_2 H_2$$\n代入数值：\n$$H_{\\mathrm{obs}} = (0.30)(0.32) + (0.70)(0.32) = (0.30 + 0.70)(0.32) = (1.0)(0.32) = 0.32$$\n\n最后，我们根据问题陈述中定义的指数计算其值：\n$$F_{IS} = 1 - \\frac{H_{\\mathrm{obs}}}{H_{\\mathrm{exp}}}$$\n代入计算出的 $H_{\\mathrm{obs}}$ 和 $H_{\\mathrm{exp}}$ 的值：\n$$F_{IS} = 1 - \\frac{0.32}{0.4712}$$\n$$F_{IS} = 1 - 0.679117147...$$\n$$F_{IS} = 0.320882852...$$\n\n问题要求答案四舍五入至四位有效数字。\n$$F_{IS} \\approx 0.3209$$\n这个结果量化了混合样本中杂合子相对于该样本的 Hardy-Weinberg 期望值的缺失，这是由种群亚结构引起的 Wahlund 效应的直接后果。", "answer": "$$\\boxed{0.3209}$$", "id": "2832903"}, {"introduction": "本练习将我们从静态的单代计算提升到动态的多代建模。通过构建一个确定性模拟，您可以直接比较两种不同非随机交配方式——按基因型选型交配与按表型选型交配——的长期后果。这项实践不仅能培养您的计算建模能力，还能让您更深入地洞察不同交配规则如何随时间塑造一个群体的遗传结构，这是一个从理论走向应用的重要步骤。[@problem_id:2832933]", "problem": "在一个恒定大小的种群中，实现一个确定性的、逐代模拟，针对单一、常染色体、双等位基因座（等位基因为 $A$ 和 $a$）的非随机交配进行模拟（因此只关心基因型频率的动态变化）。目的是比较按基因型选择性交配与按表型选择性交配对基因型分布和等位基因频率在离散世代中的影响。假设遵循以下基本基础和建模选择。\n\n基本基础：\n- 孟德尔分离定律，杂合子中的等位基因均等分离，且每个交配对内雌雄配子随机结合。\n- 哈迪-温伯格平衡（HWE）作为随机交配的无效模型，它被理解为在没有选择、迁移或突变的情况下，雌雄配子随机结合的结果。\n- 近交系数 $F$ 在双等位基因座上定义为 $F = 1 - \\dfrac{f_{Aa}}{2p(1-p)}$，其中 $p$ 是等位基因 $A$ 的频率，$f_{Aa}$ 是杂合子频率。\n\n需实现的建模假设：\n- 设 $x_{AA}(t)$、$x_{Aa}(t)$ 和 $x_{aa}(t)$ 表示第 $t$ 代的基因型频率，且 $x_{AA}(t) + x_{Aa}(t) + x_{aa}(t) = 1$。设 $p(t) = x_{AA}(t) + \\dfrac{1}{2} x_{Aa}(t)$。\n- 非随机交配由参数 $s \\in [0,1]$ 引入，即对于每个交配事件，有 $s$ 的概率选择选择性交配，有 $1-s$ 的概率从整个种群中随机选择配偶。\n- 需要比较两种选择性交配模式：\n  1. 基因型选择性交配模式：选择性交配的配偶必须与焦点亲本的基因型完全匹配。\n  2. 表型选择性交配模式：假设等位基因 $A$ 对表型完全显性，因此 $AA$ 和 $Aa$ 在表型上无法区分，而 $aa$ 则不同。在选择性交配下，焦点亲本与其自身表型类别中的任何伴侣交配（在该类别内均匀随机）。\n- 该模拟是确定性的，追踪在指定交配模式下的预期基因型频率，无生存力或繁殖力选择，无突变，无迁移，且世代不重叠。每一代的更新都必须根据孟德尔分离定律和指定的交配模式推导得出。\n\n每个测试用例所需的计算：\n- 根据等位基因频率 $p(0)$ 和近交系数 $F(0)$ 初始化种群，通过 $(p,F)$ 与基因型频率之间的标准关系转换为基因型频率：$x_{AA}(0)$、$x_{Aa}(0)$、$x_{aa}(0)$ 必须与 $p(0)$ 和 $F(0)$ 一致且总和为 $1$。\n- 在每种模式（基因型选择性和表型选择性）下分别迭代整整 $T$ 代，使用相同的 $s$ 和相同的初始状态，为每种模式获取 $x_{AA}(T)$、$x_{Aa}(T)$、$x_{aa}(T)$ 和 $p(T)$。\n- 对于每种模式，报告：\n  - $H = x_{Aa}(T)$（第 $T$ 代的杂合子频率），\n  - $F(T) = 1 - \\dfrac{x_{Aa}(T)}{2p(T)(1-p(T))}$（从最终状态计算出的近交系数），\n  - $\\Delta p = p(T) - p(0)$。\n- 所有浮点数输出在最终打印结果中必须四舍五入到 $6$ 位小数。比例以小数表示（而非百分比）。\n\n测试套件：\n您的程序必须运行以下四个测试用例，每个用例由元组 $(p(0), F(0), s, T)$ 指定：\n- 用例 1：$(0.5, 0, 0.8, 10)$\n- 用例 2：$(0.3, 0, 0.5, 30)$\n- 用例 3：$(0.4, 0.6, 0, 1)$\n- 用例 4：$(0.5, 0, 1, 5)$\n\n最终输出格式：\n- 对于每个测试用例，按顺序生成 $6$ 个数字 $[H_{\\mathrm{G}}, H_{\\mathrm{P}}, F_{\\mathrm{G}}, F_{\\mathrm{P}}, \\Delta p_{\\mathrm{G}}, \\Delta p_{\\mathrm{P}}]$，其中下标 $\\mathrm{G}$ 和 $\\mathrm{P}$ 分别指基因型选择性交配和表型选择性交配模式。\n- 将所有测试用例聚合到一个扁平列表中，连接每个用例的六个数字，顺序与上面列出的用例顺序相同。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如 $[r_1,r_2,\\dots]$），每个实数四舍五入到 $6$ 位小数。\n- 程序不提供外部输入；测试套件如上所述是硬编码的。\n\n澄清：\n- 不涉及角度。\n- 不涉及物理单位；所有量均为 $[0,1]$ 范围内的无单位频率或概率。\n- 您的算法必须能够仅根据所述的基本基础和建模假设来实现，无需任何额外的外部数据或随机抽样。", "solution": "首先将对问题进行严格的验证程序，以确定其科学和逻辑上的完整性。只有在成功验证后，才会构建解决方案。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n\n- **基因座：** 单一、常染色体、双等位基因座，等位基因为 $A$ 和 $a$。\n- **状态变量：** 第 $t$ 代的基因型频率 $x_{AA}(t)$、$x_{Aa}(t)$、$x_{aa}(t)$，满足约束条件 $x_{AA}(t) + x_{Aa}(t) + x_{aa}(t) = 1$。\n- **派生变量：** 等位基因 $A$ 的频率 $p(t) = x_{AA}(t) + \\frac{1}{2} x_{Aa}(t)$。\n- **近交系数：** $F = 1 - \\frac{f_{Aa}}{2p(1-p)}$，其中 $f_{Aa}$ 是杂合子频率。\n- **交配参数：** $s \\in [0,1]$，选择性交配的比例。剩余比例 $1-s$ 为随机交配。\n- **交配模式：**\n    1.  **基因型选择性交配：** 个体与相同基因型的伴侣交配。\n    2.  **表型选择性交配：** 个体与自身表型类别中的随机伴侣交配。等位基因 $A$ 对 $a$ 完全显性，因此表型为 $\\{AA, Aa\\}$ 和 $\\{aa\\}$。\n- **模型假设：** 预期频率的确定性模拟、孟德尔分离、非重叠世代、恒定种群大小、无选择、无突变、无迁移。\n- **初始条件：** 由初始等位基因频率 $p(0)$ 和近交系数 $F(0)$ 确定。\n- **任务：** 在每种模式下模拟系统 $T$ 代。对每种模式，报告最终杂合子频率 $H(T) = x_{Aa}(T)$、最终近交系数 $F(T)$ 以及等位基因频率的变化 $\\Delta p = p(T) - p(0)$。\n- **测试用例：**\n    1.  $(p(0), F(0), s, T) = (0.5, 0, 0.8, 10)$\n    2.  $(p(0), F(0), s, T) = (0.3, 0, 0.5, 30)$\n    3.  $(p(0), F(0), s, T) = (0.4, 0.6, 0, 1)$\n    4.  $(p(0), F(0), s, T) = (0.5, 0, 1, 5)$\n\n**第 2 步：使用提取的已知条件进行验证**\n\n根据所需标准对问题进行评估。\n- **科学依据与客观性：** 该问题是理论群体遗传学中的一个标准练习。它利用了基因型和等位基因频率、哈迪-温伯格原理、近交系数以及非随机交配模型等核心概念。所有术语都经过数学上的精确定义，不含主观或非科学内容。\n- **适定性与完整性：** 该问题是适定的。系统状态由基因型频率明确定义。初始状态由给定的参数 $p(0)$ 和 $F(0)$ 唯一确定。从一代到下一代的转换规则（动态）对随机和选择性交配部分都有明确说明，从而可以推导出确定性的递推关系。迭代次数 $T$ 已指定。这种结构保证了每个测试用例都存在唯一、有意义的解。\n- **一致性与可行性：** 这些假设（无选择等）是用于分离交配系统影响的标准理想化处理。所提供的 $(p, F)$ 与基因型频率之间的关系是标准的且内部一致的：$x_{Aa} = 2p(1-p)(1-F)$、$x_{AA} = p^2 + p(1-p)F$ 和 $x_{aa} = (1-p)^2 + p(1-p)F$。它们之和为 $1$。测试用例中的参数都在有效范围内。没有矛盾或科学上不可行的条件。\n\n**第 3 步：结论与行动**\n\n问题陈述是**有效的**。这是一个定义明确、科学上合理的群体遗传学问题。现在将推导并实现一个解决方案。\n\n### 递推关系的推导\n\n模拟的核心是从第 $t$ 代到第 $t+1$ 代基因型频率的更新规则。设第 $t$ 代的频率为 $x_{AA}$、$x_{Aa}$ 和 $x_{aa}$。等位基因 $A$ 的频率为 $p = x_{AA} + \\frac{1}{2}x_{Aa}$，等位基因 $a$ 的频率为 $q = 1-p$。第 $t+1$ 代的基因型频率（表示为 $x'_{AA}$、$x'_{Aa}$、$x'_{aa}$）是选择性交配（比例为 $s$）和随机交配（比例为 $1-s$）结果的加权和。\n\n$x'_{\\text{genotype}} = s \\cdot x'_{\\text{genotype, assortative}} + (1-s) \\cdot x'_{\\text{genotype, random}}$\n\n随机交配部分总是根据亲代的等位基因频率产生哈迪-温伯格比例：\n$x'_{AA, \\text{random}} = p^2$\n$x'_{Aa, \\text{random}} = 2pq$\n$x'_{aa, \\text{random}} = q^2$\n\n选择性交配部分取决于具体的模式。\n\n**1. 基因型选择性交配模式**\n交配只在相同基因型的个体之间发生。\n- $AA \\times AA$ 交配的频率为 $x_{AA}$，只产生 $AA$ 后代。\n- $Aa \\times Aa$ 交配的频率为 $x_{Aa}$，产生的后代比例为 $\\frac{1}{4}AA : \\frac{1}{2}Aa : \\frac{1}{4}aa$。\n- $aa \\times aa$ 交配的频率为 $x_{aa}$，只产生 $aa$ 后代。\n\n在纯基因型选择性交配下，产生的后代频率为：\n$x'_{AA, \\text{assort(G)}} = x_{AA} + \\frac{1}{4}x_{Aa}$\n$x'_{Aa, \\text{assort(G)}} = \\frac{1}{2}x_{Aa}$\n$x'_{aa, \\text{assort(G)}} = x_{aa} + \\frac{1}{4}x_{Aa}$\n\n将这些与随机交配部分结合，得到模式 G 的完整递推关系：\n$x'_{AA} = s \\left( x_{AA} + \\frac{1}{4}x_{Aa} \\right) + (1-s) p^2$\n$x'_{Aa} = s \\left( \\frac{1}{2}x_{Aa} \\right) + (1-s) 2pq$\n$x'_{aa} = s \\left( x_{aa} + \\frac{1}{4}x_{Aa} \\right) + (1-s) q^2$\n\n**2. 表型选择性交配模式**\n交配在相同表型的个体之间发生。在完全显性的情况下，基因型 $AA$ 和 $Aa$ 的表型为“显性”（D），基因型 $aa$ 的表型为“隐性”（r）。显性表型的频率是 $x_D = x_{AA} + x_{Aa}$，隐性表型的频率是 $x_r = x_{aa}$。\n- 隐性类别内的交配（r $\\times$ r）就是 $aa \\times aa$，发生频率为 $x_{aa}$。所有后代都是 $aa$。\n- 显性类别内的交配（D $\\times$ D）发生频率为 $x_D$。在这个亚群内，个体随机交配。显性群体内部的等位基因频率为：等位基因 $A$ 是 $p_D = \\frac{x_{AA} + \\frac{1}{2}x_{Aa}}{x_{AA}+x_{Aa}} = \\frac{p}{x_D}$，等位基因 $a$ 是 $q_D = \\frac{\\frac{1}{2}x_{Aa}}{x_{AA}+x_{Aa}}$。该群体内的随机交配会产生相对于 $p_D$ 和 $q_D$ 的哈迪-温伯格平衡比例的后代基因型。对总后代种群的贡献按 $x_D$进行缩放。\n\n如果 $x_D  0$，在纯表型选择性交配下，产生的后代频率为：\n$x'_{AA, \\text{assort(P)}} = x_D \\cdot p_D^2 = x_D \\left(\\frac{p}{x_D}\\right)^2 = \\frac{p^2}{x_D}$\n$x'_{Aa, \\text{assort(P)}} = x_D \\cdot 2p_D q_D = x_D \\cdot 2 \\frac{p}{x_D} \\frac{\\frac{1}{2}x_{Aa}}{x_D} = \\frac{p \\cdot x_{Aa}}{x_D}$\n$x'_{aa, \\text{assort(P)}} = x_{aa} + x_D \\cdot q_D^2 = x_{aa} + x_D \\left(\\frac{\\frac{1}{2}x_{Aa}}{x_D}\\right)^2 = x_{aa} + \\frac{(\\frac{1}{2}x_{Aa})^2}{x_D}$\n如果 $x_D = 0$，则种群完全由 $aa$ 个体组成，因此所有后代也必须是 $aa$。\n\n将这些与随机交配部分结合，得到模式 P 的完整递推关系：\n$x'_{AA} = s \\left( \\frac{p^2}{x_D} \\right) + (1-s) p^2$\n$x'_{Aa} = s \\left( \\frac{p \\cdot x_{Aa}}{x_D} \\right) + (1-s) 2pq$\n$x'_{aa} = s \\left( x_{aa} + \\frac{(\\frac{1}{2}x_{Aa})^2}{x_D} \\right) + (1-s) q^2$\n（条件是当 $x_D=0$ 时，选择性交配部分分别为 $0, 0, 1$）。\n\n**等位基因频率动态**\n对于这两种模式，代数代换表明 $p' = x'_{AA} + \\frac{1}{2}x'_{Aa} = p$。交配系统本身不会改变等位基因频率。因此，我们预期对所有 $t$ 都有 $p(t) = p(0)$，所以 $\\Delta p = p(T) - p(0) = 0$。\n\n### 算法与实现\n\n模拟过程如下：\n1.  根据给定的 $p(0)$ 和 $F(0)$ 初始化基因型频率 $x_{AA}(0)$、$x_{Aa}(0)$、$x_{aa}(0)$。\n    $x_{Aa}(0) = 2p(0)(1-p(0))(1-F(0))$\n    $x_{AA}(0) = p(0)^2 + p(0)(1-p(0))F(0)$\n    $x_{aa}(0) = (1-p(0))^2 + p(0)(1-p(0))F(0)$\n2.  对于从 $t=0$ 到 $t=T-1$ 的每一代：\n    a. 根据当前基因型频率计算当前等位基因频率 $p(t)$。\n    b. 应用相应的递推关系（模式 G 或 P）计算 $x_{AA}(t+1)$、$x_{Aa}(t+1)$、$x_{aa}(t+1)$。\n3.  经过 $T$ 代后，得到最终频率 $x_{AA}(T)$、$x_{Aa}(T)$、$x_{aa}(T)$。\n4.  计算所需的输出指标：\n    - $H(T) = x_{Aa}(T)$\n    - $p(T) = x_{AA}(T) + \\frac{1}{2}x_{Aa}(T)$\n    - $F(T) = 1 - \\frac{H(T)}{2p(T)(1-p(T))}$（由于 $p(T)=p(0)$ 且没有测试用例的 $p(0)=0$ 或 $1$，此式有效）。\n    - $\\Delta p = p(T) - p(0)$。\n对每个测试用例和两种交配模式执行此过程。收集结果并按规定格式化。", "answer": "```python\nimport numpy as np\n\ndef get_initial_freqs(p0, F0):\n    \"\"\"\n    Calculates initial genotype frequencies from allele frequency and inbreeding coefficient.\n    \n    Args:\n        p0 (float): Initial frequency of allele A.\n        F0 (float): Initial inbreeding coefficient.\n\n    Returns:\n        tuple: A tuple of floats (x_AA, x_Aa, x_aa).\n    \"\"\"\n    q0 = 1.0 - p0\n    x_Aa = 2.0 * p0 * q0 * (1.0 - F0)\n    x_AA = p0**2 + p0 * q0 * F0\n    x_aa = q0**2 + p0 * q0 * F0\n    return (x_AA, x_Aa, x_aa)\n\ndef run_simulation(p0, F0, s, T, regime):\n    \"\"\"\n    Runs the deterministic generation-by-generation simulation.\n\n    Args:\n        p0 (float): Initial frequency of allele A.\n        F0 (float): Initial inbreeding coefficient.\n        s (float): Proportion of assortative mating.\n        T (int): Number of generations to simulate.\n        regime (str): The mating regime, either 'genotype' or 'phenotype'.\n\n    Returns:\n        tuple: A tuple of final genotype frequencies (x_AA, x_Aa, x_aa).\n    \"\"\"\n    freqs = np.array(get_initial_freqs(p0, F0))\n\n    for _ in range(T):\n        x_AA, x_Aa, x_aa = freqs[0], freqs[1], freqs[2]\n        \n        p = x_AA + 0.5 * x_Aa\n        q = 1.0 - p\n\n        # Random mating component (HWE frequencies)\n        x_AA_rand = p**2\n        x_Aa_rand = 2.0 * p * q\n        x_aa_rand = q**2\n\n        # Assortative mating component\n        if regime == 'genotype':\n            x_AA_assort = x_AA + 0.25 * x_Aa\n            x_Aa_assort = 0.5 * x_Aa\n            x_aa_assort = x_aa + 0.25 * x_Aa\n        elif regime == 'phenotype':\n            x_D = x_AA + x_Aa\n            if x_D  1e-9: # Effectively no dominant phenotype individuals\n                x_AA_assort = 0.0\n                x_Aa_assort = 0.0\n                x_aa_assort = 1.0\n            else:\n                x_AA_assort = p**2 / x_D\n                x_Aa_assort = (p * x_Aa) / x_D\n                x_aa_assort = x_aa + (0.5 * x_Aa)**2 / x_D\n        else:\n            raise ValueError(\"Unknown regime specified.\")\n\n        # Weighted average for next generation's frequencies\n        x_AA_next = s * x_AA_assort + (1.0 - s) * x_AA_rand\n        x_Aa_next = s * x_Aa_assort + (1.0 - s) * x_Aa_rand\n        x_aa_next = s * x_aa_assort + (1.0 - s) * x_aa_rand\n        \n        freqs = np.array([x_AA_next, x_Aa_next, x_aa_next])\n\n    return tuple(freqs)\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    test_cases = [\n        (0.5, 0.0, 0.8, 10),\n        (0.3, 0.0, 0.5, 30),\n        (0.4, 0.6, 0.0, 1),\n        (0.5, 0.0, 1.0, 5)\n    ]\n\n    all_results = []\n    for p0, F0, s, T in test_cases:\n        # Run simulation for genotype-assortative regime\n        final_freqs_G = run_simulation(p0, F0, s, T, 'genotype')\n        x_AA_G, x_Aa_G, x_aa_G = final_freqs_G\n        H_G = x_Aa_G\n        pT_G = x_AA_G + 0.5 * x_Aa_G\n        delta_p_G = pT_G - p0\n        # Denominator 2*p*q will not be zero for the given test cases\n        F_G = 1.0 - H_G / (2.0 * pT_G * (1.0 - pT_G)) if (pT_G > 1e-9 and pT_G  1.0 - 1e-9) else (1.0 if H_G  1e-9 else 0.0)\n\n        # Run simulation for phenotype-assortative regime\n        final_freqs_P = run_simulation(p0, F0, s, T, 'phenotype')\n        x_AA_P, x_Aa_P, x_aa_P = final_freqs_P\n        H_P = x_Aa_P\n        pT_P = x_AA_P + 0.5 * x_Aa_P\n        delta_p_P = pT_P - p0\n        F_P = 1.0 - H_P / (2.0 * pT_P * (1.0 - pT_P)) if (pT_P > 1e-9 and pT_P  1.0 - 1e-9) else (1.0 if H_P  1e-9 else 0.0)\n\n        case_results = [H_G, H_P, F_G, F_P, delta_p_G, delta_p_P]\n        all_results.extend(case_results)\n\n    # Format the final output string\n    formatted_results = [f\"{num:.6f}\" for num in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2832933"}]}