{"hands_on_practices": [{"introduction": "本练习介绍了溯祖理论的基本构件：等待第一个溯祖事件发生的时间。通过计算四个谱系合并为三个的期望时间，你将练习应用溯祖速率取决于可用谱系数量的核心原则[@problem_id:1477286]。这个练习为你理解整个回溯过程奠定了基础。", "problem": "考虑一个大小恒为 $N$ 个个体的理想化二倍体种群。在此模型中，世代是离散且不重叠的。我们假设，给定世代中的每个等位基因都是从上一代的完整基因库中随机选择的一个等位基因的完美复制。任何亲代世代的基因库总共包含 $2N$ 个等位基因。\n\n在向后追溯等位基因的祖先时，“溯祖事件”被定义为两个不同的遗传谱系在紧邻的上一代中源自同一个亲本等位基因的时刻。\n\n假设您从当前种群中收集了一个包含四个不同等位基因的样本。您希望向后追溯它们的祖先。计算在这四个谱系中的任意一对发生首次溯祖事件所需回溯的期望代数。这样的事件将使您样本中的不同祖先谱系的数量从四个减少到三个。\n\n请用种群大小 $N$ 的解析式表达您的答案。", "solution": "我们使用 Wright-Fisher 模型来模拟一个大小恒为 $N$ 的二倍体种群的繁殖，因此，第 $t-1$ 代中的 $2N$ 个等位基因中的每一个，对于第 $t$ 代的任何等位基因来说，都是一个等可能的亲本。将 $k$ 个抽样谱系向后追溯一代，每个谱系都从 $2N$ 个亲本等位基因中独立且均匀地选择一个亲本等位基因。\n\n对于任何特定的谱系对，它们在紧邻的上一代发生溯祖（即，两者选择了相同的亲本等位基因）的概率是\n$$\n\\frac{1}{2N},\n$$\n因为在第一个谱系选择了一个祖先后，第二个谱系必须在 $2N$ 个等可能的等位基因中选择与之相同的那个。\n\n对于 $k=4$ 个谱系，存在 $\\binom{4}{2}=6$ 个无序对。在标准溯祖近似（忽略了多个谱系同时发生溯祖的概率，这是一个 $(2N)^{-2}$ 阶的事件）下，每一代至少有一对谱系发生溯祖的概率是\n$$\np=\\binom{4}{2}\\cdot\\frac{1}{2N}=\\frac{6}{2N}=\\frac{3}{N}.\n$$\n因为每回溯一代，要么发生一次溯祖事件（减少谱系数量），要么四个谱系保持独立，并且每一步的情况都以相同的概率更新，所以到第一次溯祖事件的等待时间 $T$（以代为单位）服从成功参数为 $p$ 的几何分布。因此，到第一次溯祖事件的期望代数是\n$$\n\\mathbb{E}[T]=\\frac{1}{p}=\\frac{N}{3}.\n$$", "answer": "$$\\boxed{\\frac{N}{3}}$$", "id": "1477286"}, {"introduction": "现实世界中的种群大小很少保持不变。本练习探讨了种群大小波动，特别是瓶颈效应，如何影响溯祖过程[@problem_id:1914452]。通过为一个周期性变化的种群计算有效种群大小（$N_e$），你将发现为何调和平均数而非算术平均数是合适的度量，并深入了解种群历史对遗传多样性的深远影响。", "problem": "一群单倍体古菌栖息在一个表现出可预测活动周期的间歇泉中。在间歇泉的稳定阶段，该阶段持续 $g_1 = 90$ 代，种群繁荣发展，并维持着 $N_{large} = 5.0 \\times 10^5$ 个体的庞大规模。此后，间歇泉进入一个持续 $g_2 = 10$ 代的剧烈喷发阶段，在此期间种群数量骤降至 $N_{small} = 5.0 \\times 10^2$ 个体的瓶颈规模。这个由 $g_1 + g_2$ 代构成的完整周期会无限重复。\n\n在一个大小为 $N$ 的单倍体种群中，任意两个随机选择的基因谱系发生溯祖（即追溯到前一代的单个共同祖先）的概率由溯祖率 $1/N$ 给出。这个波动种群的长期遗传行为可以用一个有效种群大小 $N_e$ 来描述。有效种群大小被定义为一个理想化的、大小恒定的种群的大小，该理想种群将经历与实际波动的种群相同的平均溯祖率。\n\n计算该古菌种群的有效种群大小 $N_e$。将您的最终答案四舍五入到三位有效数字。", "solution": "在一个单倍体种群中，当某一代的普查规模为 $N_{t}$ 时，两个谱系的每代溯祖率为 $1/N_{t}$。有效种群大小 $N_{e}$ 的定义是使其恒定的溯祖率等于波动溯祖率的长期时间平均值。因此，\n$$\n\\frac{1}{N_{e}}=\\left\\langle \\frac{1}{N_{t}}\\right\\rangle=\\frac{g_{1}}{g_{1}+g_{2}}\\cdot\\frac{1}{N_{large}}+\\frac{g_{2}}{g_{1}+g_{2}}\\cdot\\frac{1}{N_{small}}.\n$$\n等价地，\n$$\n\\frac{1}{N_{e}}=\\frac{g_{1}\\left(\\frac{1}{N_{large}}\\right)+g_{2}\\left(\\frac{1}{N_{small}}\\right)}{g_{1}+g_{2}},\\quad\\text{所以}\\quad N_{e}=\\frac{g_{1}+g_{2}}{\\frac{g_{1}}{N_{large}}+\\frac{g_{2}}{N_{small}}}.\n$$\n代入 $g_{1}=90$、$g_{2}=10$、$N_{large}=5.0\\times 10^{5}$ 和 $N_{small}=5.0\\times 10^{2}$：\n$$\n\\frac{1}{N_{e}}=\\frac{90\\left(\\frac{1}{5.0\\times 10^{5}}\\right)+10\\left(\\frac{1}{5.0\\times 10^{2}}\\right)}{100}\n=\\frac{\\frac{90}{5.0\\times 10^{5}}+\\frac{10}{5.0\\times 10^{2}}}{100}.\n$$\n精确计算分子：\n$$\n\\frac{90}{5.0\\times 10^{5}}=\\frac{9}{5\\times 10^{4}}=\\frac{9}{50000},\\qquad\n\\frac{10}{5.0\\times 10^{2}}=\\frac{1}{50}=\\frac{1000}{50000},\n$$\n所以\n$$\n\\frac{1}{N_{e}}=\\frac{\\frac{9}{50000}+\\frac{1000}{50000}}{100}=\\frac{\\frac{1009}{50000}}{100}=\\frac{1009}{5\\times 10^{6}}.\n$$\n因此\n$$\nN_{e}=\\frac{5\\times 10^{6}}{1009}\\approx 4.955\\times 10^{3}.\n$$\n四舍五入到三位有效数字，得到 $N_{e}=4.96\\times 10^{3}$。", "answer": "$$\\boxed{4.96 \\times 10^{3}}$$", "id": "1914452"}, {"introduction": "在单个等待时间概念的基础上，本练习要求你将它们综合起来，以计算样本到达最近共同祖先（TMRCA）所需的总时间[@problem_id:2800316]。这个推导是溯祖理论的基石，需要你对过程的每个阶段（从 $n$ 到 $n-1$ 个谱系，一直到 2 个到 1 个）的期望等待时间进行求和。成功完成此练习表明你对整个溯祖树的结构有了全面的理解。", "problem": "一个有效种群大小恒为 $N_{e}$ 的随机交配二倍体种群，从中抽取了 $n \\ge 2$ 条染色体作为样本。时间以溯祖单位（coalescent unit）计量，即以 $2N_{e}$ 为单位进行重标度的世代数，使得任意一对谱系以每单位重标度时间为 $1$ 的速率发生合并。根据Kingman的溯祖模型，当存在 $k$ 个祖先谱系时，任意一个无序对以总速率 $\\binom{k}{2}$ 合并，且到下一次合并事件的等待时间服从指数分布。仅使用这些定义和该过程的马尔可夫性质，推导样本回溯至最近共同祖先（MRCA）所需总时间的期望值 $E[T_{\\mathrm{MRCA}}]$ 的闭式表达式（作为 $n$ 的函数），并以溯祖时间单位表示。请给出最简闭式形式的最终表达式。无需四舍五入。", "solution": "目标是求出 $n$ 条染色体样本回溯至最近共同祖先（MRCA）所需总时间的期望值，记为 $E[T_{\\mathrm{MRCA}}]$。溯祖过程对样本的祖先谱系进行时间回溯建模。该过程从当前时刻（$t=0$）的 $k=n$ 个谱系开始，到只剩下 $k=1$ 个谱系时结束，这个剩下的谱系就是整个样本的MRCA。\n\n设 $T_k$ 为随机变量，表示当存在 $k$ 个祖先谱系时，等待一次合并事件发生的时间。该过程从有 $k$ 个谱系的状态转换到有 $k-1$ 个谱系的状态。到达MRCA的总时间是从 $k=n$ 到 $k=2$ 的这些等待时间之和。最后一次合并事件，即从 $k=2$ 到 $k=1$ 的事件，确立了MRCA。因此，总时间为：\n$$T_{\\mathrm{MRCA}} = T_n + T_{n-1} + \\dots + T_2 = \\sum_{k=2}^{n} T_k$$\n根据期望的线性性质，总时间的期望值是每个区间等待时间期望值的总和：\n$$E[T_{\\mathrm{MRCA}}] = E\\left[\\sum_{k=2}^{n} T_k\\right] = \\sum_{k=2}^{n} E[T_k]$$\n这一步的合理性基于该过程的马尔可夫性质，该性质意味着在每种状态下的等待时间都独立于之前的历史。\n\n现在我们必须求出期望等待时间 $E[T_k]$。根据问题陈述，当有 $k$ 个谱系时，任何无序对都可以合并，总合并速率为 $\\binom{k}{2}$。这是因为存在 $\\binom{k}{2}$ 个不同的谱系对，并且时间被标度，使得任何单对谱系以速率 $1$ 合并。第一个合并事件发生总速率 $\\lambda_k$ 是所有独立竞争谱系对的速率之和，即 $\\lambda_k = \\binom{k}{2}$。\n\n该事件的等待时间 $T_k$ 服从速率为 $\\lambda_k$ 的指数分布：\n$$T_k \\sim \\mathrm{Exp}\\left(\\lambda_k\\right) = \\mathrm{Exp}\\left(\\binom{k}{2}\\right)$$\n速率为 $\\lambda$ 的指数分布随机变量的期望值为 $1/\\lambda$。因此，具有 $k$ 个谱系的区间的期望持续时间为：\n$$E[T_k] = \\frac{1}{\\lambda_k} = \\frac{1}{\\binom{k}{2}}$$\n代入二项式系数的公式 $\\binom{k}{2} = \\frac{k(k-1)}{2}$，我们得到：\n$$E[T_k] = \\frac{1}{\\frac{k(k-1)}{2}} = \\frac{2}{k(k-1)}$$\n如前所述，所有时间都以溯祖单位计量。\n\n现在，我们将此表达式代回到总期望时间的求和公式中：\n$$E[T_{\\mathrm{MRCA}}] = \\sum_{k=2}^{n} \\frac{2}{k(k-1)}$$\n为计算此求和，我们对通项使用部分分式分解法：\n$$\\frac{2}{k(k-1)} = 2\\left(\\frac{1}{k-1} - \\frac{1}{k}\\right)$$\n该求和变成了一个裂项级数：\n$$E[T_{\\mathrm{MRCA}}] = \\sum_{k=2}^{n} 2\\left(\\frac{1}{k-1} - \\frac{1}{k}\\right) = 2 \\sum_{k=2}^{n} \\left(\\frac{1}{k-1} - \\frac{1}{k}\\right)$$\n展开求和项可以展示各项的抵消过程：\n$$E[T_{\\mathrm{MRCA}}] = 2 \\left[ \\left(\\frac{1}{1} - \\frac{1}{2}\\right) + \\left(\\frac{1}{2} - \\frac{1}{3}\\right) + \\left(\\frac{1}{3} - \\frac{1}{4}\\right) + \\dots + \\left(\\frac{1}{n-1} - \\frac{1}{n}\\right) \\right]$$\n所有形式为 $\\pm \\frac{1}{j}$（其中 $j \\in \\{2, 3, \\dots, n-1\\}$）的中间项都相互抵消，只剩下括号内的第一项和最后一项：\n$$E[T_{\\mathrm{MRCA}}] = 2 \\left(\\frac{1}{1} - \\frac{1}{n}\\right) = 2 \\left(1 - \\frac{1}{n}\\right)$$\n最后，我们将此表达式写成最简闭式形式的单个分数：\n$$E[T_{\\mathrm{MRCA}}] = \\frac{2(n-1)}{n}$$\n这就是样本量为 $n$ 时，回溯至最近共同祖先所需时间的期望值的最终表达式，以溯祖时间单位表示。", "answer": "$$\\boxed{\\frac{2(n-1)}{n}}$$", "id": "2800316"}]}