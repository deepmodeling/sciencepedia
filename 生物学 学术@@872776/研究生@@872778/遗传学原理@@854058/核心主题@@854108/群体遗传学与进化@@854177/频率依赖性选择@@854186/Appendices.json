{"hands_on_practices": [{"introduction": "第一个练习旨在帮助你建立一项基本技能：计算在负频率依赖选择下，一个种群的平衡基因型频率。该练习提供了一个清晰的捕食-被捕食动态场景，让你能够将抽象的适应度函数与一个合理的生态机制联系起来，并推导出稳定的多态性状态。[@problem_id:1912580]", "problem": "考虑一个大的、随机交配的二倍体种群，其中一个具有两个等位基因 $A_1$ 和 $A_2$ 的单个基因座控制着一个特定的表型性状。等位基因 $A_1$ 对 $A_2$ 完全显性，这意味着基因型为 $A_1A_1$ 和 $A_1A_2$ 的个体表现出显性表型，而基因型为 $A_2A_2$ 的个体表现出隐性表型。\n\n该种群受到负频率依赖选择的作用，个体的适应度由其表型的频率决定。这种选择是由捕食者驱动的，捕食者捕食更常见表型的成功率更高。显性表型个体的适应度 $W_{dom}$ 和隐性表型个体的适应度 $W_{rec}$ 由以下关于它们各自表型频率 $F_{dom}$ 和 $F_{rec}$ 的线性函数给出：\n$$W_{dom} = k - s_1 F_{dom}$$\n$$W_{rec} = k - s_2 F_{rec}$$\n此处，$k$ 是一个基础适应度分量，$s_1$ 和 $s_2$ 是正常数，分别代表针对显性表型和隐性表型的频率依赖选择的强度。\n\n假设种群达到一个稳定的多态性平衡（即两种等位基因都存在的平衡状态），确定在此平衡状态下三种基因型 $A_1A_1$、$A_1A_2$ 和 $A_2A_2$ 的频率。你的答案需用 $s_1$ 和 $s_2$ 表示。", "solution": "设等位基因 $A_1$ 的频率为 $p$，等位基因 $A_2$ 的频率为 $q$，使得 $p+q=1$。由于种群是大的且随机交配的，合子阶段的基因型频率可以用哈代-温伯格原理来描述：\n- $A_1A_1$ 的频率：$f(A_1A_1) = p^2$\n- $A_1A_2$ 的频率：$f(A_1A_2) = 2pq$\n- $A_2A_2$ 的频率：$f(A_2A_2) = q^2$\n\n等位基因 $A_1$ 对 $A_2$ 是显性的。因此，存在两种表型。\n显性表型由基因型 $A_1A_1$ 和 $A_1A_2$ 表达。其频率为 $F_{dom} = f(A_1A_1) + f(A_1A_2) = p^2 + 2pq$。\n隐性表型由基因型 $A_2A_2$ 表达。其频率为 $F_{rec} = f(A_2A_2) = q^2$。\n\n我们可以用 $q$ 来表示 $F_{dom}$：$F_{dom} = p^2 + 2pq = p(p+2q) = (1-q)(1-q+2q) = (1-q)(1+q) = 1-q^2$。\n\n每种基因型的适应度值由其表型决定。\n- $A_1A_1$ 的适应度：$W_{11} = W_{dom} = k - s_1 F_{dom} = k - s_1(1-q^2)$\n- $A_1A_2$ 的适应度：$W_{12} = W_{dom} = k - s_1 F_{dom} = k - s_1(1-q^2)$\n- $A_2A_2$ 的适应度：$W_{22} = W_{rec} = k - s_2 F_{rec} = k - s_2 q^2$\n\n当等位基因频率停止改变时，达到多态性平衡。这发生在两种等位基因的边际适应度相等时，或者在这种显性情况下，当不同表型的适应度相等时。在平衡状态下，设 $A_2$ 的平衡频率为 $q_e$，我们必须有 $W_{dom} = W_{rec}$。\n$k - s_1(1 - q_e^2) = k - s_2 q_e^2$\n基础适应度 $k$ 消掉了：\n$-s_1(1 - q_e^2) = -s_2 q_e^2$\n$s_1(1 - q_e^2) = s_2 q_e^2$\n$s_1 - s_1 q_e^2 = s_2 q_e^2$\n$s_1 = s_1 q_e^2 + s_2 q_e^2$\n$s_1 = (s_1 + s_2) q_e^2$\n$q_e^2 = \\frac{s_1}{s_1 + s_2}$\n\n由于 $q_e$ 必须是正的频率，我们取正平方根：\n$q_e = \\sqrt{\\frac{s_1}{s_1 + s_2}}$\n那么等位基因 $A_1$ 的平衡频率是：\n$p_e = 1 - q_e = 1 - \\sqrt{\\frac{s_1}{s_1 + s_2}}$\n\n这种类型的选择（负频率依赖）会导致一个稳定的平衡，因为任何对 $q_e$ 的偏离都会产生选择压力，将频率推回到 $q_e$。\n\n问题要求的是平衡基因型频率。我们通过将 $p_e$ 和 $q_e$ 代回到哈代-温伯格表达式中来找到这些频率：\n- $A_2A_2$ 的频率：$f(A_2A_2)_{eq} = q_e^2 = \\frac{s_1}{s_1 + s_2}$\n- $A_1A_1$ 的频率：$f(A_1A_1)_{eq} = p_e^2 = \\left(1 - \\sqrt{\\frac{s_1}{s_1 + s_2}}\\right)^2$\n- $A_1A_2$ 的频率：$f(A_1A_2)_{eq} = 2p_e q_e = 2\\left(1 - \\sqrt{\\frac{s_1}{s_1 + s_2}}\\right)\\sqrt{\\frac{s_1}{s_1 + s_2}}$\n\n这些是在稳定多态性平衡下基因型 $A_1A_1$、$A_1A_2$ 和 $A_2A_2$ 的频率。", "answer": "$$\\boxed{\\begin{pmatrix} \\left(1 - \\sqrt{\\frac{s_1}{s_1 + s_2}}\\right)^{2},  2\\left(1 - \\sqrt{\\frac{s_1}{s_1 + s_2}}\\right)\\sqrt{\\frac{s_1}{s_1 + s_2}},  \\frac{s_1}{s_1 + s_2} \\end{pmatrix}}$$", "id": "1912580"}, {"introduction": "尽管负频率依赖选择和超显性都可以维持遗传多态性，但它们的内在动态有所不同。这个高级问题挑战你超越仅仅寻找平衡点，转而分析该平衡点的*稳定性*。通过这种方式，你将更深入地理解这两种关键的进化驱动力是如何以不同的方式运作的。[@problem_id:2811536]", "problem": "一个具有等位基因 $A$ 和 $a$ 的单常染色体基因座，在一个随机交配、世代不重叠的种群中，在生存力选择下发生分离。考虑两种模型，它们都能产生一个稳定的内部平衡等位基因频率，但在选择如何响应偏离平衡状态方面有所不同。\n\n模型 $\\mathrm{OD}$ (超显性)：基因型生存力是恒定的，由 $w_{AA}=1-s$，$w_{Aa}=1$，$w_{aa}=1-t$ 给出，其中 $s>0$ 和 $t>0$ 且 $s1$ 和 $t1$，因此所有生存力均为正。\n\n模型 $\\mathrm{NFDS}$ (负频率依赖选择)：构建一个对称的、二倍体的、频率依赖的生存力方案，其内部平衡等位基因频率 $p^{\\*}$ 与模型 $\\mathrm{OD}$ 相同。这需要满足以下条件：当 $p=p^{\\*}$ 时，所有基因型的生存力均为 $1$；对于所有 $p\\in[0,1]$，杂合子的生存力为 $w_{Aa}(p)\\equiv 1$；纯合子的生存力围绕 $p^{\\*}$ 线性变化，其变化量大小相等、符号相反，即 $w_{AA}(p)=1-\\kappa\\,(p-p^{\\*})$ 和 $w_{aa}(p)=1+\\kappa\\,(p-p^{\\*})$，其中 $\\kappa>0$ 且选择的值足够小，以确保在 $[0,1]$ 上所有生存力都保持为正。\n\n令 $\\Delta p$ 表示在每个模型下等位基因 $A$ 频率的单代变化，即 $\\Delta p=p'-p$。将局部恢复斜率定义为导数 $\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}}$，其大小概括了在受到微小扰动后返回平衡的一阶趋势强度。\n\n仅使用随机交配下标准的二倍体生存力选择递推式，并围绕共同的平衡点 $p^{\\*}$ 进行线性化，计算模型 $\\mathrm{NFDS}$ 和模型 $\\mathrm{OD}$ 下这些局部恢复斜率大小的比值 $R$。结果需用 $s$、$t$ 和 $\\kappa$ 以封闭形式表示。你的最终答案必须是单个符号表达式。不要近似或四舍五入。", "solution": "问题要求计算两种平衡选择模型——超显性（模型 OD）和负频率依赖选择（模型 NFDS）——的局部恢复斜率大小之比。在平衡等位基因频率 $p^{\\*}$ 处的局部恢复斜率定义为等位基因频率单代变化的导数，即 $\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}}$。\n\n令 $p$ 为等位基因 $A$ 的频率，$q=1-p$ 为等位基因 $a$ 的频率。在随机交配的二倍体种群中，受生存力选择作用，下一代中等位基因 $A$ 的频率 $p'$ 由下式给出：\n$$p' = \\frac{p^2 w_{AA} + pq w_{Aa}}{\\bar{w}}$$\n其中 $w_{ij}$ 是基因型生存力，$\\bar{w} = p^2 w_{AA} + 2pq w_{Aa} + q^2 w_{aa}$ 是种群的平均生存力。等位基因频率的单代变化是 $\\Delta p = p' - p$。代入 $p'$ 的表达式，我们得到 $\\Delta p$ 的标准表达式：\n$$\\Delta p = \\frac{p(1-p)[p(w_{AA} - w_{Aa}) + (1-p)(w_{Aa} - w_{aa})]}{\\bar{w}}$$\n当 $p \\in (0,1)$ 时，若 $\\Delta p = 0$，则存在一个内部平衡频率 $p^{\\*}$。这要求方括号中的项为零：\n$$p^{\\*}(w_{AA} - w_{Aa}) + (1-p^{\\*})(w_{Aa} - w_{aa}) = 0$$\n\n为了求得局部恢复斜率，我们将 $\\Delta p$ 对 $p$ 求导，并在 $p^{\\*}$ 处求值。令 $\\Delta p(p) = \\frac{N(p)}{D(p)}$，其中 $N(p)$ 是分子，$D(p) = \\bar{w}(p)$ 是分母。在平衡点 $p=p^{\\*}$ 处，$N(p^{\\*}) = 0$。其导数为：\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}} = \\frac{N'(p^{\\*})D(p^{\\*}) - N(p^{\\*})D'(p^{\\*})}{[D(p^{\\*})]^2} = \\frac{N'(p^{\\*})}{D(p^{\\*})} = \\frac{N'(p^{\\*})}{\\bar{w}(p^{\\*})}$$\n令 $F(p) = p(w_{AA}(p) - w_{Aa}(p)) + (1-p)(w_{Aa}(p) - w_{aa}(p))$，则 $N(p) = p(1-p)F(p)$。那么 $N'(p) = (1-2p)F(p) + p(1-p)F'(p)$。在平衡点，$F(p^{\\*})=0$，因此 $N'(p^{\\*}) = p^{\\*}(1-p^{\\*})F'(p^{\\*})$。\n因此，局部恢复斜率为：\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}} = \\frac{p^{\\*}(1-p^{\\*})F'(p^{\\*})}{\\bar{w}(p^{\\*})}$$\n\n首先，我们分析模型 OD。生存力是恒定的：$w_{AA}=1-s$，$w_{Aa}=1$，$w_{aa}=1-t$。\n平衡条件 $p^{\\*}(-s) + (1-p^{\\*})(t) = 0$ 可解得平衡频率：\n$$p^{\\*} = \\frac{t}{s+t}$$\n在平衡状态下，等位基因 $a$ 的频率为 $1-p^{\\*} = \\frac{s}{s+t}$。\n对于模型 OD，生存力不是 $p$ 的函数，因此它们的导数为零。$F'(p) = (w_{AA}-w_{Aa}) - (w_{Aa}-w_{aa}) = -s - t = -(s+t)$。\n所以，$F'(p^{\\*}) = -(s+t)$。\n平衡时的平均生存力为：\n$$\\bar{w}_{\\mathrm{OD}}(p^{\\*}) = 1 - s(p^*)^2 - t(1-p^*)^2 = 1 - s(\\frac{t}{s+t})^2 - t(\\frac{s}{s+t})^2 = 1 - \\frac{st^2+ts^2}{(s+t)^2} = 1 - \\frac{st(s+t)}{(s+t)^2} = 1 - \\frac{st}{s+t}$$\n模型 OD 的斜率为：\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{OD}} = \\frac{p^{\\*}(1-p^{\\*})(-(s+t))}{1 - \\frac{st}{s+t}} = \\frac{(\\frac{t}{s+t})(\\frac{s}{s+t})(-(s+t))}{\\frac{s+t-st}{s+t}} = \\frac{-\\frac{st}{s+t}}{\\frac{s+t-st}{s+t}} = -\\frac{st}{s+t-st}$$\n该斜率的大小为 $\\left|\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{OD}}\\right| = \\frac{st}{s+t-st}$，因为 $s>0$，$t>0$ 且 $s,t1$ 保证了分母为正。\n\n接下来，我们分析模型 NFDS。该模型被构造成具有相同的平衡点 $p^{\\*} = \\frac{t}{s+t}$。\n生存力是频率依赖的：$w_{AA}(p)=1-\\kappa(p-p^{\\*})$, $w_{Aa}(p)=1$ 和 $w_{aa}(p)=1+\\kappa(p-p^{\\*})$.\n在 $p=p^{\\*}$ 时，所有生存力都等于 $1$。平衡时的平均生存力为 $\\bar{w}_{\\mathrm{NFDS}}(p^{\\*}) = (p^{\\*})^2(1) + 2p^{\\*}(1-p^{\\*})(1) + (1-p^{\\*})^2(1) = 1$。\n现在我们为此模型计算 $F'(p^{\\*})$。\n$F'(p) = (w_{AA}(p) - w_{Aa}(p)) - (w_{Aa}(p) - w_{aa}(p)) + p w'_{AA}(p) - (1-p)w'_{aa}(p)$\n注意到 $w'_{Aa}(p) = 0$。纯合子生存力的导数是 $w'_{AA}(p) = -\\kappa$ 和 $w'_{aa}(p) = \\kappa$。\n在 $p=p^{\\*}$ 处求值，此时 $w_{AA}=w_{Aa}=w_{aa}=1$：\n$F'(p^{\\*}) = (1-1) - (1-1) + p^{\\*}(-\\kappa) - (1-p^{\\*})(\\kappa) = 0 - 0 - \\kappa p^{\\*} - \\kappa + \\kappa p^{\\*} = -\\kappa$\n模型 NFDS 的斜率为：\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{NFDS}} = \\frac{p^{\\*}(1-p^{\\*})F'(p^{\\*})}{\\bar{w}_{\\mathrm{NFDS}}(p^{\\*})} = \\frac{p^{\\*}(1-p^{\\*})(-\\kappa)}{1} = -\\kappa p^{\\*}(1-p^{\\*})$$\n代入 $p^{\\*} = t/(s+t)$：\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{NFDS}} = -\\kappa \\frac{t}{s+t} \\frac{s}{s+t} = -\\frac{\\kappa st}{(s+t)^2}$$\n其大小为 $\\left|\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{NFDS}}\\right| = \\frac{\\kappa st}{(s+t)^2}$。\n\n最后，我们计算恢复斜率大小的比值 $R$，即模型 NFDS 与模型 OD 之比：\n$$R = \\frac{\\left|\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{NFDS}}\\right|}{\\left|\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{OD}}\\right|} = \\frac{\\frac{\\kappa st}{(s+t)^2}}{\\frac{st}{s+t-st}}$$\n项 $st$ 可以消去 (因为 $s, t > 0$)：\n$$R = \\frac{\\kappa}{(s+t)^2} \\cdot (s+t-st) = \\frac{\\kappa (s+t-st)}{(s+t)^2}$$\n这就是以给定参数表示的比值的最终封闭形式表达式。", "answer": "$$\\boxed{\\frac{\\kappa(s+t-st)}{(s+t)^2}}$$", "id": "2811536"}, {"introduction": "理论模型是强大的，但它们的最终检验在于其解释真实世界数据的能力。本计算练习将指导你建立一个统计学框架，根据时间序列遗传数据来区分超显性和负频率依赖选择。这是现代进化生物学中的一项核心任务，它将理论与实证研究紧密地联系在一起。[@problem_id:2811510]", "problem": "给定从一个二倍体病原体抗原基因座中，每个离散世代采样一次获得的纵向基因型计数数据。目标是仅使用这些基因型时间序列，构建一个定量的、基于似然的检验，以区分负频率依赖选择（NFDS）和超显性（具有恒定基因型适合度的杂合子优势）。您的程序必须从第一性原理出发实现这两种模型，通过最大似然估计其参数，使用信息论准则对它们进行比较，并对每个数据集分类，判断哪个模型能更好地解释数据。\n\n使用的基本基础包括群体遗传学和数量遗传学中以下经过充分检验的原理：\n- 在一个大的二倍体种群中随机交配意味着在合子阶段基因型比例遵循哈迪-温伯格平衡：如果第 $t$ 代等位基因 $A$ 的频率是 $p_t \\in (0,1)$，那么选择前的基因型频率对于 $AA$ 是 $p_t^2$，对于 $Aa$ 是 $2 p_t (1-p_t)$，对于 $aa$ 是 $(1-p_t)^2$。\n- 选择通过相对适合度作用于基因型，下一代的等位基因频率 $p_{t+1}$ 是通过将合子基因型频率按其适合度加权并应用孟德尔分离定律得出的。这是离散世代中标准的 Wright-Fisher选择递归。\n- 每个世代观察到的基因型计数（在选择前采样）是独立的多元多项式抽样，其概率由该世代真实 $p_t$ 对应的哈迪-温伯格基因型频率给出。\n- 校正的赤池信息量准则（AICc）为有限样本下基于似然的拟合提供了一种信息论模型比较方法。\n\n需要实现的模型定义：\n- 超显性（OD）：恒定的基因型适合度，$w_{AA} = 1 - s$, $w_{Aa} = 1$, $w_{aa} = 1 - t$，其中 $s \\in (0,1)$ 且 $t \\in (0,1)$。等位基因频率递归 $p_{t} \\mapsto p_{t+1}$ 必须从上述原理推导得出。模型的自由参数是 $(s, t, p_0)$，其中 $p_0 \\in (0,1)$ 是第一个观察世代的初始等位基因 $A$ 的频率。\n- 负频率依赖选择（NFDS）：等位基因特异性的适合度惩罚随当前等位基因频率的增加而增加，并对基因型适合度有加性贡献。令 $\\alpha_A \\in (0,1)$ 和 $\\alpha_a \\in (0,1)$ 分别量化作用于等位基因 $A$ 和 $a$ 的 NFDS 强度。在第 $t$ 代，通过对等位基因惩罚进行平均来定义依赖于等位基因频率的基因型适合度：$w_{AA}(p_t)$, $w_{Aa}(p_t)$, $w_{aa}(p_t)$。等位基因频率递归 $p_{t} \\mapsto p_{t+1}$ 必须从上述原理推导得出。模型的自由参数是 $(\\alpha_A, \\alpha_a, p_0)$。\n\n需要实现的统计推断：\n- 对于一个给定模型 $M$，其参数向量为 $\\theta$，所隐含的等位基因频率轨迹为 $\\{p_t(\\theta)\\}_{t=0}^{T}$，观察到的基因型计数 $\\{(n_{AA,t}, n_{Aa,t}, n_{aa,t})\\}_{t=0}^{T}$ 的似然函数是各世代多项式概率的乘积，其概率为 $(p_t^2, 2 p_t (1-p_t), (1-p_t)^2)$。您必须使用对数似然函数 $\\ell(\\theta) = \\sum_{t=0}^{T} \\sum_{g \\in \\{AA,Aa,aa\\}} n_{g,t} \\log q_{g,t}$，其中 $q_{AA,t} = p_t^2$，$q_{Aa,t} = 2 p_t (1-p_t)$，$q_{aa,t} = (1-p_t)^2$。\n- 对每个模型，在其参数边界内数值最大化对数似然函数，以获得最大似然估计（MLE）和最大对数似然值 $\\ell_{\\max}$。\n- 为每个模型计算校正的赤池信息量准则（AICc）为\n$$\n\\mathrm{AICc} = -2 \\,\\ell_{\\max} + 2 k + \\frac{2 k (k+1)}{n - k - 1},\n$$\n其中 $k$ 是模型的自由参数数量，$n$ 是观察到的世代数（即多项式观察的次数）。如果 $n - k - 1 \\le 0$，则使用 $\\mathrm{AIC} = -2 \\,\\ell_{\\max} + 2 k$。\n- 每个数据集的决策规则：如果 $\\mathrm{AICc}_{\\mathrm{NFDS}} + \\Delta  \\mathrm{AICc}_{\\mathrm{OD}}$，则选择 NFDS，否则选择 OD，其中 $\\Delta = 2.0$ 是选择阈值。如果选择 NFDS，报告 $1$，如果选择 OD，报告 $0$。\n\n必须遵守的实现细节：\n- 您必须根据上述原理为每个模型推导并实现等位基因频率递归 $p_{t} \\mapsto p_{t+1}$，确保对于所有 $t$ 都有 $p_t \\in (0,1)$，并且在给定参数边界的情况下，适合度保持为正。\n- 优化器必须能处理边界约束，并且在计算 $\\log$ 时，您应通过将概率下限设置为一个远离 $0$ 的值来稳定计算，以避免出现未定义的值。\n\n测试套件（三个数据集）以确保覆盖不同的动态机制：\n- 数据集A（预期的类OD动态；从高 $p_t$ 单调趋近）：\n  - 时间索引的基因型计数 $(n_{AA,t}, n_{Aa,t}, n_{aa,t})$，对于 $t = 0, 1, 2, 3, 4, 5, 6$：\n    - $[(256,128,16),(218,155,27),(184,175,41),(155,188,57),(131,196,73),(112,199,89),(98,200,102)]$\n- 数据集B（预期的类NFDS动态；不对称的稀有等位基因优势）：\n  - 时间索引的基因型计数 $(n_{AA,t}, n_{Aa,t}, n_{aa,t})$，对于 $t = 0, 1, 2, 3, 4, 5, 6$：\n    - $[(256,128,16),(221,153,26),(191,171,38),(164,184,52),(142,193,65),(124,197,79),(110,200,90)]$\n- 数据集C（接近中性的边缘情况，在中间频率附近动态变化非常缓慢）：\n  - 时间索引的基因型计数 $(n_{AA,t}, n_{Aa,t}, n_{aa,t})$，对于 $t = 0, 1, 2, 3, 4, 5, 6$：\n    - $[(108,200,92),(108,199,93),(108,200,92),(107,200,93),(107,200,93),(107,200,93),(106,200,94)]$\n\n您的程序必须：\n- 对每个数据集的每个模型，实现带边界约束数值优化的最大似然参数估计。\n- 对每个数据集的每个模型计算 $\\mathrm{AICc}$。\n- 应用阈值为 $\\Delta = 2.0$ 的决策规则，将每个数据集分类为 NFDS（$1$）或 OD（$0$）。\n- 生成单行输出，其中包含三个整数结果，按数据集 A、B、C 的顺序排列，形式为用方括号括起来的逗号分隔列表（例如，$[0,1,0]$）。不允许有其他输出。", "solution": "该问题要求我们从第一性原理出发，为超显性（OD）和负频率依赖选择（NFDS）这两个模型推导等位基因频率的递归方程，并构建一个基于似然的统计框架来比较它们。\n\n我们分析的基础是针对一个大型、随机交配、世代离散的二倍体种群的标准 Wright-Fisher 模型。设 $p_t$ 为第 $t$ 代等位基因 $A$ 的频率，$q_t=1-p_t$ 为等位基因 $a$ 的频率。在随机交配的假设下，合子阶段的基因型频率由哈迪-温伯格比例给出：\n$$\n\\begin{cases}\n    \\text{freq}(AA)_t = p_t^2 \\\\\n    \\text{freq}(Aa)_t = 2 p_t q_t \\\\\n    \\text{freq}(aa)_t = q_t^2\n\\end{cases}\n$$\n选择作用于这些基因型，其相对适合度分别为 $w_{AA}$、$w_{Aa}$ 和 $w_{aa}$。在第 $t$ 代，种群的平均适合度是基因型适合度的加权平均值：\n$$\n\\bar{w}_t = p_t^2 w_{AA} + 2 p_t q_t w_{Aa} + q_t^2 w_{aa}\n$$\n下一代中等位基因 $A$ 的频率 $p_{t+1}$ 是从选择后基因库中 $A$ 等位基因的比例推导出来的。这得出了通用递归式：\n$$\np_{t+1} = \\frac{p_t^2 w_{AA} + p_t q_t w_{Aa}}{\\bar{w}_t}\n$$\n我们现在为这两个竞争模型具体化这个递归式。\n\n**1. 超显性 (OD) 模型**\n适合度是恒定的：$w_{AA} = 1-s$, $w_{Aa}=1$, $w_{aa}=1-t$。\n将这些代入通用递归式：\n$$\n\\bar{w}_t = p_t^2(1-s) + 2p_t q_t(1) + q_t^2(1-t) = 1 - s p_t^2 - t q_t^2\n$$\n$$\np_{t+1}^{\\mathrm{OD}} = \\frac{p_t^2(1-s) + p_t q_t(1)}{1 - s p_t^2 - t q_t^2} = \\frac{p_t - s p_t^2}{1 - s p_t^2 - t(1-p_t)^2}\n$$\n\n**2. 负频率依赖选择 (NFDS) 模型**\n问题描述了一个模型，其中等位基因的惩罚是频率依赖的，并且对基因型适合度有加性贡献。一个合理的实现（杂合子适合度是纯合子适合度的平均值）是：\n$$\nw_{AA}(p_t) = 1 - \\alpha_A p_t\n$$\n$$\nw_{aa}(p_t) = 1 - \\alpha_a q_t\n$$\n$$\nw_{Aa}(p_t) = \\frac{w_{AA}(p_t) + w_{aa}(p_t)}{2} = 1 - \\frac{1}{2}(\\alpha_A p_t + \\alpha_a q_t)\n$$\n将这些频率依赖的适合度代入通用递归式：\n$$\n\\bar{w}_t = p_t^2 w_{AA}(p_t) + 2p_t q_t w_{Aa}(p_t) + q_t^2 w_{aa}(p_t)\n$$\n$$\np_{t+1}^{\\mathrm{NFDS}} = \\frac{p_t^2 w_{AA}(p_t) + p_t q_t w_{Aa}(p_t)}{\\bar{w}_t}\n$$\n这个完整的表达式将在下面的代码中实现。\n\n**统计推断**\n对于每个模型，我们将使用数值优化来寻找参数 $\\theta$（OD模型为 $(s, t, p_0)$，NFDS模型为 $(\\alpha_A, \\alpha_a, p_0)$），以最大化对数似然函数 $\\ell(\\theta)$。然后，我们将使用 $\\ell_{max}$ 计算每个模型的 AICc 值，并根据给定的决策规则进行选择。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Main function to solve the model selection problem for the three datasets.\n    \"\"\"\n    \n    # Define test cases from the problem statement\n    test_cases = [\n        # Dataset A\n        np.array([(256, 128, 16), (218, 155, 27), (184, 175, 41), (155, 188, 57), \n                  (131, 196, 73), (112, 199, 89), (98, 200, 102)]),\n        # Dataset B\n        np.array([(256, 128, 16), (221, 153, 26), (191, 171, 38), (164, 184, 52), \n                  (142, 193, 65), (124, 197, 79), (110, 200, 90)]),\n        # Dataset C\n        np.array([(108, 200, 92), (108, 199, 93), (108, 200, 92), (107, 200, 93), \n                  (107, 200, 93), (107, 200, 93), (106, 200, 94)])\n    ]\n    \n    results = []\n    for counts in test_cases:\n        results.append(process_dataset(counts))\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\ndef process_dataset(counts):\n    \"\"\"\n    Performs model fitting and selection for a single dataset.\n    \n    Args:\n        counts (np.ndarray): A (T x 3) array of genotype counts (n_AA, n_Aa, n_aa).\n    \n    Returns:\n        int: 1 if NFDS is selected, 0 if OD is selected.\n    \"\"\"\n    n = counts.shape[0]  # Number of generations\n    k = 3  # Number of parameters for both models\n    delta = 2.0\n    \n    # Estimate initial p0 from data for a better starting guess\n    n_AA_0, n_Aa_0, n_aa_0 = counts[0]\n    total_alleles_0 = 2 * (n_AA_0 + n_Aa_0 + n_aa_0)\n    p0_guess = (2 * n_AA_0 + n_Aa_0) / total_alleles_0\n\n    # Bounds for parameters (s, t, p0) or (alpha_A, alpha_a, p0)\n    epsilon = 1e-9\n    bounds = [(epsilon, 1 - epsilon), (epsilon, 1 - epsilon), (epsilon, 1 - epsilon)]\n\n    # --- Overdominance (OD) Model Fitting ---\n    x0_od = [0.1, 0.1, p0_guess]  # Initial guess for (s, t, p0)\n    res_od = minimize(\n        neg_log_likelihood,\n        x0_od,\n        args=(counts, 'OD'),\n        method='L-BFGS-B',\n        bounds=bounds\n    )\n    ll_max_od = -res_od.fun\n\n    # --- Negative Frequency-Dependent Selection (NFDS) Model Fitting ---\n    x0_nfds = [0.1, 0.1, p0_guess] # Initial guess for (alpha_A, alpha_a, p0)\n    res_nfds = minimize(\n        neg_log_likelihood,\n        x0_nfds,\n        args=(counts, 'NFDS'),\n        method='L-BFGS-B',\n        bounds=bounds\n    )\n    ll_max_nfds = -res_nfds.fun\n\n    # --- Model Comparison using AICc ---\n    aicc_od = calculate_aicc(ll_max_od, k, n)\n    aicc_nfds = calculate_aicc(ll_max_nfds, k, n)\n\n    if aicc_nfds + delta  aicc_od:\n        return 1  # Select NFDS\n    else:\n        return 0  # Select OD\n\ndef neg_log_likelihood(params, counts, model):\n    \"\"\"\n    Calculates the negative log-likelihood for a given model and parameters.\n    \n    Args:\n        params (list): Model parameters: (s, t, p0) for OD or (alpha_A, alpha_a, p0) for NFDS.\n        counts (np.ndarray): Genotype counts data.\n        model (str): 'OD' or 'NFDS'.\n        \n    Returns:\n        float: Negative log-likelihood.\n    \"\"\"\n    num_generations = counts.shape[0]\n    p_traj = np.zeros(num_generations)\n    p_traj[0] = params[2] # p0\n    \n    # Generate allele frequency trajectory\n    for t in range(num_generations - 1):\n        p_curr = np.clip(p_traj[t], 1e-9, 1 - 1e-9)\n        if model == 'OD':\n            s, t_param = params[0], params[1]\n            p_traj[t+1] = p_next_od(p_curr, s, t_param)\n        elif model == 'NFDS':\n            alpha_A, alpha_a = params[0], params[1]\n            p_traj[t+1] = p_next_nfds(p_curr, alpha_A, alpha_a)\n\n    # Clip entire trajectory for stability in log\n    p_traj = np.clip(p_traj, 1e-9, 1 - 1e-9)\n    q_traj = 1 - p_traj\n\n    # Calculate HWE frequencies from trajectory\n    prob_AA = p_traj**2\n    prob_Aa = 2 * p_traj * q_traj\n    prob_aa = q_traj**2\n\n    # Calculate log-likelihood\n    log_lik = np.sum(\n        counts[:, 0] * np.log(prob_AA) +\n        counts[:, 1] * np.log(prob_Aa) +\n        counts[:, 2] * np.log(prob_aa)\n    )\n    \n    if np.isnan(log_lik):\n        return np.inf\n        \n    return -log_lik\n\ndef p_next_od(p_curr, s, t):\n    \"\"\"Allele frequency recursion for the OD model.\"\"\"\n    w_AA = 1 - s\n    w_Aa = 1\n    w_aa = 1 - t\n    q_curr = 1 - p_curr\n    \n    w_bar = p_curr**2 * w_AA + 2 * p_curr * q_curr * w_Aa + q_curr**2 * w_aa\n    if w_bar = 0: return p_curr\n    \n    numerator = p_curr**2 * w_AA + p_curr * q_curr * w_Aa\n    return numerator / w_bar\n\ndef p_next_nfds(p_curr, alpha_A, alpha_a):\n    \"\"\"\n    Allele frequency recursion for the NFDS model.\n    Fitness model: w_AA = 1 - alpha_A*p, w_aa = 1 - alpha_a*(1-p), w_Aa is the average.\n    \"\"\"\n    p = p_curr\n    q = 1 - p\n    \n    w_AA = 1 - alpha_A * p\n    w_aa = 1 - alpha_a * q\n    w_Aa = (w_AA + w_aa) / 2\n    \n    w_bar = p*p*w_AA + 2*p*q*w_Aa + q*q*w_aa\n    if w_bar = 0: return p_curr\n    \n    num_term = p*p*w_AA + p*q*w_Aa\n    return num_term / w_bar\n\ndef calculate_aicc(ll_max, k, n):\n    \"\"\"Calculates the corrected Akaike Information Criterion.\"\"\"\n    if n - k - 1 = 0: # Fallback to AIC as per problem statement\n        return -2 * ll_max + 2 * k\n    else:\n        correction = (2 * k * (k + 1)) / (n - k - 1)\n        return -2 * ll_max + 2 * k + correction\n\nif __name__ == '__main__':\n    solve()\n```\n[0,1,0]", "id": "2811510"}]}