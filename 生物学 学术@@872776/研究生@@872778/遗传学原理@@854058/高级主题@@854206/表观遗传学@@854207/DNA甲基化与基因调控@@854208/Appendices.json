{"hands_on_practices": [{"introduction": "DNA甲基化的稳定性是表观遗传记忆的关键，但这并非一个完美的过程。此练习将引导你通过第一性原理，为被动去甲基化过程建立一个数学模型，阐明在没有从头甲基化的情况下，维持性甲基转移酶DNMT1的不完美效率如何导致甲基化模式在细胞分裂过程中的稀释。通过这个练习，你将把分子层面的随机事件（甲基化失败）与细胞群体水平的宏观动态联系起来[@problem_id:2805059]。", "problem": "一个常染色体基因座包含一个5'-胞嘧啶-磷酸-鸟嘌呤-3' (CpG) 二联体，在第 $n=0$ 代的一个克隆细胞群体中，该二联体在两条DNA链上都是对称甲基化的。假设以下有实验依据的原则：\n- 脱氧核糖核酸（DNA）复制是半保留的：在每个S期，每条亲代链都作为模板，用于合成一条新的互补链，从而产生两个子代双链体。\n- DNA甲基转移酶1 (DNMT1) 是一种维持性甲基转移酶，在复制后作用于半甲基化的CpG二联体。对于给定S期中的每个半甲基化二联体，DNMT1能以概率 $1-p$ 成功甲基化新生的胞嘧啶，并以概率 $p$ 失败，其中 $0 \\leq p \\leq 1$ 在各代和各细胞中是恒定的。\n- 不存在从头甲基化：完全未甲基化的二联体不会被甲基化。\n- 考虑一个“新生链追踪”世系：在每次分裂中，从两个子代双链体中，关注包含在前一个S期新合成的那条链的双链体（因此，在 $n$ 代中，你始终追踪在每一步中新合成的那条链）。\n\n定义 $M_n$ 为在第 $n$ 代维持性甲基化后，被追踪链上的CpG胞嘧啶被甲基化的概率（等价于，在一组独立同演化的世系中，被甲基化的期望分数）。初始条件为 $M_0=1$，因为在 $n=0$ 时的起始链是甲基化的。\n\n仅使用上述原则，并将跨代的维持事件视为独立的，推导出一个关于 $p$ 和 $n$ 的 $M_n$ 的封闭形式表达式。你的最终答案必须是单一的解析表达式。不需要四舍五入，也不需要单位。", "solution": "问题陈述已经过验证，并被认定为有效。它在科学上基于DNA复制和维持性甲基化的既定原则，问题设定良好，具有明确的初始条件和演化规则，并以客观、正式的语言表述。这是一个概率建模中的可解问题。\n\n设 $M_n$ 为在第 $n$ 代维持性甲基化后，被追踪链上的胞嘧啶被甲基化的概率。初始条件为 $M_0 = 1$，因为在第 $n=0$ 代时CpG二联体是对称甲基化的。我们的任务是找到 $M_n$ 的封闭形式表达式。\n\n问题的核心在于正确理解“新生链追踪”世系。该规则指出，在每一代，我们追踪的是新合成的那条链。这意味着第 $n+1$ 代被追踪的链是使用第 $n$ 代被追踪的链作为模板合成的新生链。因此，我们可以为 $M_n$ 建立一个递推关系。\n\n我们来考虑从第 $n$ 代到第 $n+1$ 代的转变。第 $n+1$ 代被追踪链的状态完全取决于其模板的状态，也就是第 $n$ 代被追踪的链。我们可以通过以第 $n$ 代被追踪链的甲基化状态为条件，来求得 $M_{n+1}$，即第 $n+1$ 代被追踪链被甲基化的概率。我们应用全概率定律。\n\n对于第 $n$ 代被追踪的链，有两种互斥的可能性：\n\n情况1：第 $n$ 代被追踪的链是甲基化的。\n根据定义，此事件的概率是 $M_n$。当这条链在DNA复制过程中作为模板时，它会产生一个半甲基化的CpG二联体：模板链是甲基化的，而新生链是未甲基化的。根据问题描述，维持性甲基转移酶DNMT1作用于这个半甲基化二联体。DNMT1以 $1-p$ 的概率成功甲基化新生的胞嘧啶。由于新生链是第 $n+1$ 代被追踪的链，因此在这种情况下它被甲基化的概率是 $1-p$。\n\n情况2：第 $n$ 代被追踪的链是未甲基化的。\n此事件的概率是 $1 - M_n$。当这条未甲基化的链作为模板时，它会产生一个完全未甲基化的CpG二联体：模板链和新生链都是未甲基化的。问题明确指出不存在*从头*甲基化。因此，这个未甲基化的二联体保持未甲基化状态。在这种情况下，新生链（即第 $n+1$ 代被追踪的链）被甲基化的概率是 $0$。\n\n结合这两种情况，概率 $M_{n+1}$ 可以写成：\n$$\nM_{n+1} = P(\\text{nascent strand is methylated} | \\text{template is methylated}) \\cdot P(\\text{template is methylated}) + P(\\text{nascent strand is methylated} | \\text{template is unmethylated}) \\cdot P(\\text{template is unmethylated})\n$$\n代入从问题陈述中推导出的概率：\n$$\nM_{n+1} = (1-p) \\cdot M_n + (0) \\cdot (1-M_n)\n$$\n这可以简化为以下线性递推关系：\n$$\nM_{n+1} = (1-p)M_n\n$$\n这是一个几何级数。我们可以从给定的初始条件 $M_0 = 1$ 开始，通过迭代来求解。\n对于 $n=1$：\n$$\nM_1 = (1-p)M_0 = (1-p) \\cdot 1 = 1-p\n$$\n对于 $n=2$：\n$$\nM_2 = (1-p)M_1 = (1-p)(1-p) = (1-p)^2\n$$\n对于 $n=3$：\n$$\nM_3 = (1-p)M_2 = (1-p)(1-p)^2 = (1-p)^3\n$$\n通过数学归纳法，对于任何代数 $n \\geq 0$，通解为：\n$$\nM_n = (1-p)^n M_0\n$$\n由于 $M_0 = 1$，$M_n$ 的最终表达式为：\n$$\nM_n = (1-p)^n\n$$\n该表达式给出了在第 $n$ 代，被追踪的新生链上的胞嘧啶被甲基化的概率，它是维持失败概率 $p$ 和代数 $n$ 的函数。", "answer": "$$\\boxed{(1-p)^{n}}$$", "id": "2805059"}, {"introduction": "标准的亚硫酸氢盐测序虽然功能强大，但无法区分5-甲基胞嘧啶（5mC）和功能上不同的5-羟甲基胞嘧啶（5hmC）。本练习将介绍一种更先进的技术——氧化亚硫酸氢盐测序（oxBS-seq），并要求你建立一个数学模型，以校正不完全的氧化效率和非转化率等实验偏差。通过解决这个问题，你将学会如何从多组实验数据中解构并准确定量不同的表观遗传标记[@problem_id:2805008]。", "problem": "对一个神经元表达基因的基因体中的单个CpG位点，通过常规亚硫酸氢盐测序（BS-seq）和氧化亚硫酸氢盐测序（oxBS-seq）进行分析。常规亚硫酸氢盐测序（BS-seq）报告的甲基化信号（即被读取为胞嘧啶的测序读数）比例，包括5-甲基胞嘧啶和5-羟甲基胞嘧啶，以及未修饰胞嘧啶的残留未转化部分。氧化亚硫酸氢盐测序（oxBS-seq）使用一个前置氧化步骤，旨在将5-羟甲基胞嘧啶转化为一种可被亚硫酸氢盐脱氨基的形式，从而只有5-甲基胞嘧啶被保留并读取为胞嘧啶，同样也存在少量未修饰胞嘧啶的残留未转化。假设如下，其中每个概率指的是在所有测序读数中均匀随机抽样的一个CpG位点：\n- 处于5-甲基胞嘧啶、5-羟甲基胞嘧啶和未修饰胞嘧啶状态的胞嘧啶的真实比例分别为$m$、$h$和$u$，且满足$m + h + u = 1$。\n- 在BS-seq中，5-甲基胞嘧啶和5-羟甲基胞嘧啶总是被读取为胞嘧啶，而未修饰的胞嘧啶以未转化概率$b_{BS}$被读取为胞嘧啶。\n- 在oxBS-seq中，5-甲基胞嘧啶总是被读取为胞嘧啶，5-羟甲基胞嘧啶以效率$\\epsilon_{ox}$被氧化，如果被氧化，则被脱氨基并读取为胸腺嘧啶；如果未被氧化，则被读取为胞嘧啶。未修饰的胞嘧啶以未转化概率$b_{ox}$被读取为胞嘧啶。\n在此位点，你测量得到观测的甲基化比例为 $ \\beta_{BS} = 0.78 $ 和 $ \\beta_{ox} = 0.65 $。独立的spike-in对照实验估计氧化效率为 $ \\epsilon_{ox} = 0.92 $，亚硫酸氢盐未转化率分别为 $ b_{BS} = 0.005 $ 和 $ b_{ox} = 0.004 $。仅使用全概率定律和上述定义，推导出真实的5-羟甲基胞嘧啶比例$h$关于$ \\beta_{BS}, \\beta_{ox}, \\epsilon_{ox}, b_{BS}, b_{ox} $的表达式，然后根据给定参数计算其值。将$h$的最终值以小数形式报告，并四舍五入到四位有效数字。", "solution": "该问题要求从通过常规亚硫酸氢盐测序（BS-seq）和氧化亚硫酸氢盐测序（oxBS-seq）获得的实验测量值中，推导出真实的5-羟甲基胞嘧啶比例（用$h$表示）。求解过程首先基于全概率定律建立一个数学模型，将可观测的量与真实的分子组分比例联系起来，然后求解得到的方程组。\n\n设$m$、$h$和$u$分别为CpG位点上5-甲基胞嘧啶、5-羟甲基胞嘧啶和未修饰胞嘧啶的真实比例。这些比例之和必须为1。\n$$m + h + u = 1$$\n\n在任何实验中，观测到的甲基化比例（记为$\\beta$）是在CpG位点上的一个测序读数被报告为胞嘧啶（C）的概率。我们可以使用全概率定律，以胞嘧啶碱基的真实状态为条件来表示这个概率。\n$$P(\\text{read C}) = \\sum_{\\text{state } S \\in \\{m, h, u\\}} P(\\text{read C} | \\text{state is } S) \\cdot P(\\text{state is } S)$$\n\n对于常规亚硫酸氢盐测序（BS-seq），观测到的甲基化比例是$\\beta_{BS}$。根据题目陈述：\n- 5-甲基胞嘧啶总是被读取为胞嘧啶，因此$P(\\text{read C} | \\text{state is } m) = 1$。\n- 5-羟甲基胞嘧啶总是被读取为胞嘧啶，因此$P(\\text{read C} | \\text{state is } h) = 1$。\n- 未修饰的胞嘧啶以未转化概率$b_{BS}$被读取为胞嘧啶，因此$P(\\text{read C} | \\text{state is } u) = b_{BS}$。\n\n将这些概率和真实比例（$P(\\text{state is } m)=m$, $P(\\text{state is } h)=h$, $P(\\text{state is } u)=u$）代入全概率定律，我们得到第一个方程：\n$$\\beta_{BS} = (1 \\cdot m) + (1 \\cdot h) + (b_{BS} \\cdot u) = m + h + b_{BS} u \\quad (1)$$\n\n对于氧化亚硫酸氢盐测序（oxBS-seq），观测到的甲基化比例是$\\beta_{ox}$。概率定义如下：\n- 5-甲基胞嘧啶总是被读取为胞嘧啶，因此$P(\\text{read C} | \\text{state is } m) = 1$。\n- 5-羟甲基胞嘧啶只有在未能被氧化时才被读取为胞嘧啶。未被氧化的概率是$1 - \\epsilon_{ox}$。因此，$P(\\text{read C} | \\text{state is } h) = 1 - \\epsilon_{ox}$。\n- 未修饰的胞嘧啶以未转化概率$b_{ox}$被读取为胞嘧啶，因此$P(\\text{read C} | \\text{state is } u) = b_{ox}$。\n\n这给出第二个方程：\n$$\\beta_{ox} = (1 \\cdot m) + ((1 - \\epsilon_{ox}) \\cdot h) + (b_{ox} \\cdot u) = m + (1 - \\epsilon_{ox})h + b_{ox} u \\quad (2)$$\n\n我们得到了一个关于三个未知数$m$、$h$和$u$的线性方程组：\n1. $m + h + b_{BS} u = \\beta_{BS}$\n2. $m + (1 - \\epsilon_{ox})h + b_{ox} u = \\beta_{ox}$\n3. $m + h + u = 1$\n\n我们的目标是推导$h$的表达式。一个系统的方法是首先消去$m$。用方程（1）减去方程（3），我们可以得到$u$的表达式。\n$$(m + h + b_{BS} u) - (m + h + u) = \\beta_{BS} - 1$$\n$$u(b_{BS} - 1) = \\beta_{BS} - 1$$\n$$u = \\frac{\\beta_{BS} - 1}{b_{BS} - 1} = \\frac{1 - \\beta_{BS}}{1 - b_{BS}}$$\n这个表达式给出了未修饰胞嘧啶的真实比例$u$，用BS-seq的测量值$\\beta_{BS}$及其对应的未转化率$b_{BS}$来表示。\n\n接下来，我们用方程（1）减去方程（2）来消去$m$：\n$$(\\beta_{BS}) - (\\beta_{ox}) = (m + h + b_{BS} u) - (m + (1 - \\epsilon_{ox})h + b_{ox} u)$$\n$$\\beta_{BS} - \\beta_{ox} = h - (1 - \\epsilon_{ox})h + u(b_{BS} - b_{ox})$$\n$$\\beta_{BS} - \\beta_{ox} = h(1 - (1 - \\epsilon_{ox})) + u(b_{BS} - b_{ox})$$\n$$\\beta_{BS} - \\beta_{ox} = h \\epsilon_{ox} + u(b_{BS} - b_{ox})$$\n这个方程将$h$和$u$联系起来。我们现在可以将我们先前推导出的$u$的表达式代入这个方程：\n$$\\beta_{BS} - \\beta_{ox} = h \\epsilon_{ox} + \\left(\\frac{1 - \\beta_{BS}}{1 - b_{BS}}\\right)(b_{BS} - b_{ox})$$\n现在，我们求解$h$。首先，分离出$h \\epsilon_{ox}$项：\n$$h \\epsilon_{ox} = (\\beta_{BS} - \\beta_{ox}) - (b_{BS} - b_{ox})\\frac{1 - \\beta_{BS}}{1 - b_{BS}}$$\n最后，除以$\\epsilon_{ox}$，得到$h$的所求表达式：\n$$h = \\frac{1}{\\epsilon_{ox}} \\left[ (\\beta_{BS} - \\beta_{ox}) - (b_{BS} - b_{ox})\\frac{1 - \\beta_{BS}}{1 - b_{BS}} \\right]$$\n\n现在，我们将给定的数值代入这个表达式：\n$\\beta_{BS} = 0.78$\n$\\beta_{ox} = 0.65$\n$\\epsilon_{ox} = 0.92$\n$b_{BS} = 0.005$\n$b_{ox} = 0.004$\n\n$$h = \\frac{1}{0.92} \\left[ (0.78 - 0.65) - (0.005 - 0.004)\\frac{1 - 0.78}{1 - 0.005} \\right]$$\n$$h = \\frac{1}{0.92} \\left[ 0.13 - (0.001)\\frac{0.22}{0.995} \\right]$$\n我们计算方括号内的项：\n$$0.13 - (0.001) \\cdot \\frac{0.22}{0.995} = 0.13 - \\frac{0.00022}{0.995}$$\n$$0.13 - 0.0002211055... = 0.1297788944...$$\n现在我们完成对$h$的计算：\n$$h = \\frac{0.1297788944...}{0.92} \\approx 0.1410640157...$$\n根据题目要求，将结果四舍五入到四位有效数字，得到：\n$$h \\approx 0.1411$$\n这个值代表了在指定位点上5-羟甲基胞嘧啶的真实比例。", "answer": "$$\\boxed{0.1411}$$", "id": "2805008"}, {"introduction": "在基因组学研究中，一个核心问题是DNA甲基化如何影响转录因子（TF）的结合。本练习模拟了一个真实的生物信息学分析场景，要求你整合染色质免疫共沉淀测序（ChIP-seq）和全基因组亚硫酸氢盐测序（WGBS）的数据，以检验TF结合位点的甲基化水平是否显著低于基因组背景。你将通过实施分层置换检验来学习如何严格地评估统计显著性，同时控制潜在的混杂变量[@problem_id:2805078]。", "problem": "给定一个转录因子（TF）的染色质免疫沉淀测序（ChIP-seq）峰的程式化表示，以及每个峰内TF基序核心CpG处的全基因组亚硫酸氢盐测序（WGBS）甲基化测量值。任务是形式化并实现一个基于置换的富集检验，以确定在TF结合位点中未甲基化的基序CpG的比例是否相对于匹配的基因组背景预期更高，并通过分层来解释混杂结构。\n\n基本原理和定义：\n- 中心法则和基因调控确立了转录活动受蛋白质-DNA相互作用的影响。胞嘧啶-磷酸-鸟嘌呤（CpG）二核苷酸处的表观遗传DNA甲基化是一种被广泛接受的可以调节TF结合的调控标记。\n- 全基因组亚硫酸氢盐测序（WGBS）在每个CpG处产生一个估计的甲基化比例，可以表示为闭区间$[0,1]$内的实数。\n- 考虑一个阈值 $\\tau \\in [0,1]$，定义甲基化比例小于或等于 $\\tau$ 的位点为“未甲基化”。\n- 设有一组有限的峰（候选TF结合位点），索引为 $i \\in \\{1,\\dots,n\\}$。对于每个峰 $i$，给定基序CpG的甲基化比例 $m_i \\in [0,1]$ 和一个分层标签 $s_i \\in \\{0,1,\\dots,K-1\\}$，该标签指示一个匹配的协变量类别（例如，GC含量或CpG密度的分箱）。\n- 对于每个分层 $k \\in \\{0,1,\\dots,K-1\\}$，给定一个背景池 $M^{(k)} = \\{b^{(k)}_1,\\dots,b^{(k)}_{N_k}\\}$，其中包含代表未被TF结合的匹配基因组位点的甲基化比例。您可以假设在所提供的测试套件中，$N_k$ 对于无放回抽样来说足够大。\n\n您的程序必须：\n1. 使用给定的 $\\tau$ 计算所有峰中未甲基化基序CpG的观测比例。\n2. 在零假设（TF结合位点中的未甲基化比例不大于匹配的背景）下，通过分层置换程序执行单侧富集检验：\n   - 对于 $B$ 次置换中的每一次，并对于每个分层 $k$，从 $M^{(k)}$ 中无放回地抽取恰好 $n_k$ 个值，其中 $n_k$ 是分层 $k$ 中的峰数量（即，满足 $s_i = k$ 的索引 $i$ 的计数）。合并各分层抽样得到的值，并计算在阈值 $\\tau$ 下未甲基化位点的置换比例。\n   - 根据每个测试用例的规定，使用固定的伪随机种子以保证可复现性。\n   - 使用加一校正计算富集的单侧右尾P值，以避免P值为零。将观测比例与由 $B$ 次置换生成的经验零分布进行比较。\n3. 对于每个测试用例，以小数形式输出由观测到的未甲基化比例和P值组成的数对。\n\n测试套件：\n对于下方的每个测试用例，请完全按照给定的参数使用。\n\n- 测试用例1（两个分层，预期有富集）：\n  - $\\tau = 0.2$\n  - 峰甲基化值 $[0.05, 0.10, 0.80, 0.15, 0.25, 0.02, 0.30, 0.05, 0.18, 0.19, 0.40, 0.10]$\n  - 峰分层 $[0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1]$\n  - 每个分层的背景：\n    - 分层 $0$: $[0.35, 0.60, 0.45, 0.50, 0.70, 0.55, 0.40, 0.65, 0.48, 0.52, 0.33, 0.47, 0.58, 0.62, 0.41, 0.75, 0.28, 0.31, 0.36, 0.44]$\n    - 分层 $1$: $[0.25, 0.20, 0.15, 0.10, 0.05, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.60, 0.18, 0.22, 0.27, 0.33, 0.12, 0.08, 0.38, 0.42]$\n  - $B = 2000$\n  - 随机种子 $= 42$\n\n- 测试用例2（两个分层，预期行为接近零假设）：\n  - $\\tau = 0.25$\n  - 峰甲基化值 $[0.20, 0.26, 0.24, 0.35, 0.40, 0.23, 0.28, 0.18, 0.38, 0.27]$\n  - 峰分层 $[0, 0, 0, 0, 0, 1, 1, 1, 1, 1]$\n  - 每个分层的背景：\n    - 分层 $0$: $[0.10, 0.12, 0.20, 0.26, 0.24, 0.30, 0.35, 0.40, 0.45, 0.50, 0.22, 0.27, 0.29, 0.33, 0.37, 0.41, 0.23, 0.19, 0.28, 0.32]$\n    - 分层 $1$: $[0.15, 0.18, 0.22, 0.26, 0.28, 0.30, 0.12, 0.35, 0.40, 0.45, 0.50, 0.55, 0.20, 0.24, 0.27, 0.29, 0.31, 0.33, 0.17, 0.19]$\n  - $B = 2000$\n  - 随机种子 $= 123$\n\n- 测试用例3（一个分层，所有峰均未甲基化，预期有强富集）：\n  - $\\tau = 0.2$\n  - 峰甲基化值 $[0.00, 0.02, 0.05, 0.10, 0.12, 0.15, 0.18, 0.19]$\n  - 峰分层 $[0, 0, 0, 0, 0, 0, 0, 0]$\n  - 每个分层的背景：\n    - 分层 $0$: $[0.30, 0.35, 0.40, 0.45, 0.50, 0.60, 0.55, 0.48, 0.52, 0.58, 0.62, 0.70, 0.75, 0.80, 0.28, 0.33, 0.37, 0.42, 0.47, 0.53, 0.57, 0.63, 0.68, 0.73, 0.77, 0.82, 0.85, 0.90, 0.95, 0.99]$\n  - $B = 2000$\n  - 随机种子 $= 7$\n\n- 测试用例4（一个分层，观测到耗尽；单侧富集P值应该很大）：\n  - $\\tau = 0.5$\n  - 峰甲基化值 $[0.60, 0.70, 0.40, 0.55, 0.65]$\n  - 峰分层 $[0, 0, 0, 0, 0]$\n  - 每个分层的背景：\n    - 分层 $0$: $[0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.60, 0.65, 0.70, 0.75, 0.80, 0.85, 0.90, 0.33, 0.47]$\n  - $B = 2000$\n  - 随机种子 $= 99$\n\n最终输出规格：\n- 对每个测试用例，返回观测到的未甲基化比例和P值，均为小数，且四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含结果，格式为一个用方括号括起来的逗号分隔列表，其中每个元素本身是 $[\\text{fraction}, \\text{pvalue}]$ 形式的二元列表；例如：$[[0.500000,0.123000],[0.400000,0.876000]]$。", "solution": "在进行求解之前，需要对问题的有效性进行批判性评估。\n\n### 步骤1：提取给定信息\n\n- **主题**：遗传学原理；DNA甲基化与基因调控。\n- **背景**：转录因子（TF）的染色质免疫沉淀测序（ChIP-seq）和全基因组亚硫酸氢盐测序（WGBS）数据的程式化表示。\n- **定义**：\n    - 甲基化比例：闭区间 $[0,1]$ 内的一个实数。\n    - 未甲基化阈值 $\\tau \\in [0,1]$：如果一个位点的甲基化比例 $\\le \\tau$，则该位点是“未甲基化的”。\n    - 峰：$n$ 个候选TF结合位点的有限集合，索引为 $i \\in \\{1,\\dots,n\\}$。\n    - 峰数据：对于每个峰 $i$，有一个甲基化比例 $m_i \\in [0,1]$ 和一个分层标签 $s_i \\in \\{0,1,\\dots,K-1\\}$。\n    - 背景数据：对于每个分层 $k$，有一个背景池 $M^{(k)} = \\{b^{(k)}_1,\\dots,b^{(k)}_{N_k}\\}$，包含来自非TF结合位点的甲基化比例。假定 $N_k$ 对于无放回抽样来说足够大。\n- **任务**：\n    1.  计算所有峰中未甲基化基序CpG的观测比例。\n    2.  使用包含 $B$ 次置换的分层置换程序进行单侧富集检验。\n        - 对于每次置换，为每个分层 $k$ 从背景池 $M^{(k)}$ 中抽样 $n_k$ 个值，其中 $n_k$ 是分层 $k$ 中的峰数量。\n        - 合并抽样值并计算未甲基化位点的置换比例。\n        - 使用指定的伪随机种子以保证可复现性。\n    3.  使用加一校正计算单侧右尾P值：$(C+1)/(B+1)$，其中 $C$ 是置换比例大于或等于观测比例的次数。\n    4.  为每个测试用例输出数对 [观测到的未甲基化比例, P值]。\n- **测试用例**：\n    - **测试用例1**：$\\tau = 0.2$，$B = 2000$，种子 $= 42$。提供了峰（甲基化，分层）和背景池（分层 $0$，$1$）的数据。\n    - **测试用例2**：$\\tau = 0.25$，$B = 2000$，种子 $= 123$。提供了峰（甲基化，分层）和背景池（分层 $0$，$1$）的数据。\n    - **测试用例3**：$\\tau = 0.2$，$B = 2000$，种子 $= 7$。提供了峰（甲基化，分层）和背景池（分层 $0$）的数据。\n    - **测试用例4**：$\\tau = 0.5$，$B = 2000$，种子 $= 99$。提供了峰（甲基化，分层）和背景池（分层 $0$）的数据。\n- **输出格式**：单行字符串 `[[fraction1,pvalue1],[fraction2,pvalue2],...]`，其中每个值都四舍五入到六位小数。\n\n### 步骤2：使用提取的给定信息进行验证\n\n- **科学依据**：该问题在分子生物学和计算生物学方面有坚实的基础。TF结合、DNA甲基化、ChIP-seq、WGBS以及使用置换检验评估统计显著性的概念，在基因组学领域是标准和基础的。其前提在事实上是可靠的。\n- **定义明确**：该问题是定义明确的（良构的）。它指定了输入、确切的计算过程（分层置换检验）、零假设、P值的计算公式以及所需的输出格式。根据给定的数据和过程可以确定一个唯一且稳定的解。\n- **客观性**：该问题以精确、客观和定量的术语陈述。它要求实现一个标准的统计检验，没有主观解释的余地。\n- **完整性和一致性**：该问题是自洽的。每个测试用例都提供了所有必要的数据，包括甲基化值、分层标签、背景池、置换次数（$B$）和随机种子。明确说明了背景池足够大以进行无放回抽样的条件，消除了潜在的歧义。没有矛盾之处。\n- **真实性**：数据值（0到1之间的甲基化比例）是符合现实的。在TF结合位点与基因组背景之间检验差异甲基化的场景是生物信息学研究中一个常见且实用的任务。\n- **其他缺陷**：该问题并非琐碎、无法形式化、不适定或故作高深。它需要正确实现一个特定且有意义的统计程序。\n\n### 步骤3：结论与行动\n\n该问题是有效的。它科学可靠、定义明确、客观且完整。将制定一个合理的解决方案。\n\n### 解决方案\n\n任务是实现一个分层置换检验，以确定一组转录因子（TF）结合位点（峰）与匹配的基因组背景相比，是否在未甲基化的CpG上显著富集。分层用于控制潜在的混杂变量，例如局部GC含量，这些变量可能独立于TF结合而影响DNA甲基化。\n\n设 $n$ 个峰的甲基化值集合为 $\\{m_1, m_2, \\dots, m_n\\}$，其对应的分层标签为 $\\{s_1, s_2, \\dots, s_n\\}$，其中 $s_i \\in \\{0, 1, \\dots, K-1\\}$。定义“未甲基化”的甲基化阈值为 $\\tau$。\n\n1.  **计算观测到的检验统计量**\n    检验统计量是未甲基化峰的比例。设该观测比例为 $F_{obs}$。其计算方式如下：\n    $$ F_{obs} = \\frac{1}{n} \\sum_{i=1}^{n} \\mathbb{I}(m_i \\le \\tau) $$\n    其中 $\\mathbb{I}(\\cdot)$ 是指示函数，如果其参数为真则为 $1$，否则为 $0$。\n\n2.  **通过分层置换生成零分布**\n    零假设 $H_0$ 是，TF结合位点的甲基化水平与匹配的背景位点来自同一分布。置换检验在此零假设下为检验统计量生成一个经验分布。分层确保了置换后的数据集与观测数据保持相同的混杂结构。\n\n    首先，我们确定每个分层 $k$ 内的峰数量，记为 $n_k$：\n    $$ n_k = \\sum_{i=1}^{n} \\mathbb{I}(s_i = k) \\quad \\text{for } k \\in \\{0, 1, \\dots, K-1\\} $$\n    请注意，峰的总数是 $n = \\sum_{k=0}^{K-1} n_k$。\n\n    置换过程重复 $B$ 次。对于每次置换 $j \\in \\{1, \\dots, B\\}$：\n    a. 构建一个新的`重抽样`甲基化值集合。\n    b. 对于每个分层 $k$，我们从相应的背景池 $M^{(k)}$ 中无放回地随机抽取 $n_k$ 个甲基化值。\n    c. 将来自所有分层的这些抽样值合并成一个包含 $n$ 个值的单一集合。\n    d. 对此置换集合计算检验统计量，得到一个置换比例 $F_{perm}^{(j)}$：\n    $$ F_{perm}^{(j)} = \\frac{1}{n} \\sum_{m' \\in \\text{resampled set } j} \\mathbb{I}(m' \\le \\tau) $$\n    这 $B$ 个值的集合 $\\{F_{perm}^{(1)}, F_{perm}^{(2)}, \\dots, F_{perm}^{(B)}\\}$ 构成了经验零分布。\n\n3.  **计算P值**\n    我们正在执行一个单侧富集检验，这意味着我们想知道 $F_{obs}$ 是否显著*大于*随机预期的值。P值是在假设零假设为真的情况下，观测到与 $F_{obs}$ 一样极端或更极端的检验统计量的概率。这个概率是根据经验零分布估算出来的。\n\n    计算产生大于或等于观测比例的置换次数：\n    $$ C = \\sum_{j=1}^{B} \\mathbb{I}(F_{perm}^{(j)} \\ge F_{obs}) $$\n    为了避免在没有置换统计量超过观测值时P值为0（这可能导致对结果的过度自信），在分子和分母上都加上一个伪计数1。最终的P值为：\n    $$ P = \\frac{C + 1}{B + 1} $$\n\n此过程将针对每个测试用例实施，使用指定的参数、数据和随机种子以确保可复现性。每个用例的最终结果将是数对 $[F_{obs}, P]$，其值格式化为六位小数。", "answer": "[[0.666667,0.000500],[0.400000,0.490255],[1.000000,0.000500],[0.200000,0.941029]]", "id": "2805078"}]}