{"hands_on_practices": [{"introduction": "在设计任何基因组编辑工具时，一个关键的初始步骤是评估其特异性——即它在庞大基因组中结合到非预期位点的频率。本练习将通过一个简化的概率模型，指导你动手计算一个典型的锌指核酸酶（ZFN）在人类基因组规模的DNA序列中完美匹配的期望次数。这项实践旨在建立关于在基因组中定位独特“地址”所面临挑战的基础定量直觉。[@problem_id:2788408]", "problem": "一个Cys2-His2锌指核酸酶（ZFN; Zinc Finger Nuclease）三指阵列可识别一个长度为$9$个碱基对的连续脱氧核糖核酸（DNA）靶标，每个指对应$3$个碱基对。假设一个单倍体基因组被建模为一个基于字母表$\\{A, C, G, T\\}$的独立同分布（i.i.d.）序列，碱基频率均一，并且该三指阵列指定一个确切的$9$碱基对基序（无简并性）。考虑扫描一条长度为$N = 3\\times 10^{9}$个碱基对的单链，以寻找与此$9$碱基对位点的完美匹配。除了对起始位置的标准计数之外，忽略由双链结构或染色体边界引起的边缘效应。\n\n仅使用独立事件的概率、指示随机变量和期望线性性的定义，从第一性原理推导出一个表达式，用于计算基因组中与指定的$9$碱基对基序的完美匹配的期望数量，然后在$N = 3\\times 10^{9}$和基序长度$k = 9$的条件下对其进行数值计算。将最终数值答案四舍五入至三位有效数字。", "solution": "所陈述的问题是有效的。它具有科学依据，提法明确且客观。它提出了一个生物信息学中用于估计序列基序频率的标准简化模型，并且所有参数和条件都已明确定义。我将按要求进行推导。\n\n任务是计算一个特定的$9$碱基对基序在一个长度为$N = 3 \\times 10^9$个碱基对的基因组中出现的期望次数。基因组被建模为独立同分布（i.i.d.）的随机变量序列，其中集合$\\{A, C, G, T\\}$中的每个碱基以均一概率$p = \\frac{1}{4}$被选择。\n\n设基因组由序列$S = S_1 S_2 \\dots S_N$表示，其中每个$S_i \\in \\{A, C, G, T\\}$。设特定目标基序为一个长度为$k=9$的序列$M = M_1 M_2 \\dots M_k$。如果从位置$i$开始的子序列与$M$相同，则在基因组的位置$i$处发生完美匹配。在长度为$N$的序列中，一个$k$-mer的可能起始位置是$i=1, 2, \\dots, N-k+1$。此类可能位点的总数为$N-k+1$。\n\n为了从第一性原理严格地解决这个问题，我们采用指示随机变量和期望线性性的方法。对于每个可能的起始位置$i$（其中$1 \\le i \\le N-k+1$），我们定义一个指示随机变量$X_i$如下：\n$$\nX_i = \\begin{cases} 1  \\text{如果子序列 } S_i S_{i+1} \\dots S_{i+k-1} \\text{ 匹配 } M \\\\ 0  \\text{否则} \\end{cases}\n$$\n整个基因组中完美匹配的总数，我们用随机变量$X$表示，是这些指示变量在所有可能起始位置上的总和：\n$$\nX = \\sum_{i=1}^{N-k+1} X_i\n$$\n我们被要求找到匹配的期望数量，即$X$的期望，记为$E[X]$。根据期望的线性性，随机变量之和的期望等于它们各自期望之和。这个性质成立，无论这些随机变量是否独立。\n$$\nE[X] = E\\left[ \\sum_{i=1}^{N-k+1} X_i \\right] = \\sum_{i=1}^{N-k+1} E[X_i]\n$$\n根据定义，指示随机变量$X_i$的期望等于它所指示事件的概率。\n$$\nE[X_i] = 1 \\cdot P(X_i=1) + 0 \\cdot P(X_i=0) = P(X_i=1)\n$$\n$P(X_i=1)$是从位置$i$开始的基因组子序列与特定$k$-mer基序$M$完美匹配的概率。基因组序列被建模为独立同分布的，意味着每个位置的碱基的选择独立于所有其他碱基。任何特定碱基（A, C, G, 或 T）在任何给定位置出现的概率是$p = \\frac{1}{4}$。要使子序列$S_i S_{i+1} \\dots S_{i+k-1}$匹配$M_1 M_2 \\dots M_k$，我们必须有$S_i = M_1$, $S_{i+1} = M_2$, 以此类推，直到$S_{i+k-1} = M_k$。\n由于独立性，这个联合事件的概率是各个独立事件概率的乘积：\n$$\nP(X_i=1) = P(S_i=M_1 \\text{ 且 } S_{i+1}=M_2 \\text{ 且 } \\dots \\text{ 且 } S_{i+k-1}=M_k) = \\prod_{j=0}^{k-1} P(S_{i+j}=M_{j+1})\n$$\n因为每个位置的概率是$p = \\frac{1}{4}$，这个乘积变为：\n$$\nP(X_i=1) = \\left(\\frac{1}{4}\\right)^k\n$$\n这个概率对于所有位置$i$都是恒定的。因此，每个指示变量的期望是相同的：\n$$\nE[X_i] = \\left(\\frac{1}{4}\\right)^k\n$$\n现在我们可以把这个代回到$E[X]$的表达式中。这个和由$N-k+1$个相同的项组成：\n$$\nE[X] = \\sum_{i=1}^{N-k+1} \\left(\\frac{1}{4}\\right)^k = (N-k+1) \\left(\\frac{1}{4}\\right)^k\n$$\n这就是按要求从第一性原理推导出的完美匹配期望数的一般表达式。\n\n现在，我们必须根据给定的值对这个表达式进行数值计算：基因组长度$N = 3 \\times 10^9$和基序长度$k = 9$。\n可能的起始位置数量是$N-k+1 = 3 \\times 10^9 - 9 + 1 = 3 \\times 10^9 - 8 = 2,999,999,992$。\n在任何给定位置发生匹配的概率是$\\left(\\frac{1}{4}\\right)^9$。\n$$\n\\left(\\frac{1}{4}\\right)^9 = \\frac{1}{4^9} = \\frac{1}{(2^2)^9} = \\frac{1}{2^{18}} = \\frac{1}{262,144}\n$$\n匹配的期望数量是：\n$$\nE[X] = (2,999,999,992) \\times \\frac{1}{262,144}\n$$\n由于$N \\gg k$，项$N-k+1$可以很好地用$N$来近似。让我们进行计算：\n$$\nE[X] = \\frac{2,999,999,992}{262,144} \\approx 11444.09176\n$$\n问题要求将答案四舍五入到三位有效数字。$11444.09176$的前三位有效数字是$1$、$1$和$4$。第四位有效数字是$4$，小于$5$，所以我们向下取整。\n将$11444.09176$四舍五入到三位有效数字得到$11400$。\n用标准科学记数法表示为$1.14 \\times 10^4$。", "answer": "$$ \\boxed{1.14 \\times 10^4} $$", "id": "2788408"}, {"introduction": "虽然简单的概率模型具有指导意义，但现实世界中的蛋白质工程远比这复杂。本练习将挑战你批判性地思考为何锌指蛋白的“即插即用”式模块化组装策略常常会失败。这会促使你深入探究控制蛋白质-DNA识别过程的非加性和上下文依赖的生物物理相互作用，从而理解理论模型与实验结果之间差距的根源。[@problem_id:2788359]", "problem": "一个合成生物学团队正在组装一种锌指核酸酶 (ZFN)，他们将一个三指锌指蛋白 (ZFP) DNA结合阵列与一个FokI核酸内切酶域连接起来，以靶向一个长度为 $9$ 个碱基对的特定脱氧核糖核酸 (DNA) 位点。每个“指”结构都是从一个预先表征的模块库中挑选出来的，据报道这些模块能够识别特定的DNA三联体。该设计假设每个“指”的结合能学是独立的，因此在整个阵列上是可加的。在实践中，组装好的ZFN与预期位点的结合很弱，并且出人意料地与具有部分重叠三联体的位点发生脱靶结合。预表征是在一个具有不同指间连接子的蛋白质支架中进行的，并且其盐浓度条件也与最终实验不同（预表征在 $50$ mM 单价盐浓度下，最终实验在 $150$ mM 浓度下）。\n\n根据蛋白质-DNA识别的第一性原理，特别是结合自由能的热力学、相邻识别模块间的结构耦合以及DNA形状和静电学的作用，以下哪些陈述为“使用预先表征的锌指模块进行模块化组装在实践中为何会失败”提供了严谨的机理学解释？请选择所有适用选项。\n\nA. 相邻的锌指及其接触的DNA三联体在能量和结构上是耦合的，因此总结合自由能通常不是可加的；相邻的侧链和诱导产生的DNA形状变化会产生依赖于上下文的耦合项，从而使独立模块的假设失效。\n\nB. 在生理条件下，锌离子会从经典的Cys₂His₂折叠中解离，导致指结构解折叠，从而无论上下文如何都消除了序列特异性识别，因此模块化组装的失败是因为锌指域本身不稳定。\n\nC. FokI切割域在结合后会改变碱基特异性的氢键模式，从而改变DNA序列偏好，使得预先表征的结合模块对于特异性而言变得无关紧要。\n\nD. 指间连接子的几何形状和柔性施加了熵和空间位阻的限制，这可能导致碱基接触的寄存器和方向相对于孤立指测量时发生偏移，从而引入了依赖于特定模块顺序和连接子组成的额外非可加性惩罚。\n\nE. 转录激活子样效应子 (TALE) 阵列对此类上下文效应免疫，因为每个重复单元精确结合一个碱基，且没有骨架介导的相互作用，所以模块化组装问题是锌指所独有的。\n\nF. 模块表征和使用之间的离子强度差异改变了蛋白质-DNA界面上静电相互作用的屏蔽效应，以一种依赖于上下文的方式改变了骨架介导的能量贡献，并打破了在不同盐条件下推断出的表观可加性。", "solution": "问题陈述是有效的。它具有科学依据，提法得当，客观，并基于分子生物学和生物物理学的既定原则提供了一个清晰的场景。锌指设计中模块化假设与观察到的实验结果之间的差异是一个有充分文献记载的现象，这为探究其潜在机制的问题提供了坚实的基础。\n\n问题的核心在于一个简化假设的失败，即一个多指锌指蛋白 (ZFP) 阵列的总结合自由能 $\\Delta G_{\\text{total}}$ 是其各个独立、预先表征的“指”结构结合自由能 ($\\Delta G_i$) 的简单加和：\n$$ \\Delta G_{\\text{total, assumed}} = \\sum_i \\Delta G_i $$\n观察到的弱结合和脱靶效应表明，实际的结合自由能比预测的要差（负值更小），并且特异性图景被改变了。这意味着存在显著的耦合项 $\\Delta G_{\\text{coupling}}$，使得真实的结合能为：\n$$ \\Delta G_{\\text{total, actual}} = \\sum_i \\Delta G_i + \\Delta G_{\\text{coupling}} $$\n$\\Delta G_{\\text{coupling}}$ 项源于依赖于上下文的效应，其中一个“指”的结合会影响其相邻的“指”。问题要求找出这种非可加性的机理来源。我们将基于蛋白质-DNA识别的第一性原理来评估每个选项。\n\nA. **相邻的锌指及其接触的DNA三联体在能量和结构上是耦合的，因此总结合自由能通常不是可加的；相邻的侧链和诱导产生的DNA形状变化会产生依赖于上下文的耦合项，从而使独立模块的假设失效。**\n该陈述精确而准确地描述了蛋白质-DNA相互作用中依赖于上下文的效应。蛋白质-DNA识别并非简单的“锁-钥”过程。两种大分子都具有柔性。一个锌指模块（如指$n$）与其DNA三联体的结合可以诱导蛋白质骨架和DNA螺旋（如小沟宽度、滚动、扭转）发生局部构象变化。这些结构扰动会传播到相邻的指$n+1$的结合位点，改变其几何形状和能量学。这被称为间接识别或形状识别。此外，来自指$n$的侧链可以与指$n+1$上的侧链直接相互作用，产生直接的能量耦合。在孤立地表征每个模块时，这些效应是无法捕捉到的，它们是结合能非可加性的一个主要原因。\n**结论：正确。**\n\nB. **在生理条件下，锌离子会从经典的Cys₂His₂折叠中解离，导致指结构解折叠，从而无论上下文如何都消除了序列特异性识别，因此模块化组装的失败是因为锌指域本身不稳定。**\n该陈述不正确。Cys₂His₂锌指折叠是一种稳定的结构基序，存在于数千种在生理条件下有效发挥作用的真核转录因子中。锌离子 ($Zn^{2+}$) 的配位非常强，在没有强螯合剂或变性条件的情况下，解离不易发生。虽然锌的丢失确实会导致解折叠和功能丧失，但这并不是锌指在生理条件下的普遍特征。问题描述的是结合减弱和特异性改变，而不是灾难性解折叠导致的结合完全丧失。因此，将模块化失败归因于内在不稳定性是一个事实性错误。\n**结论：不正确。**\n\nC. **FokI切割域在结合后会改变碱基特异性的氢键模式，从而改变DNA序列偏好，使得预先表征的结合模块对于特异性而言变得无关紧要。**\n该陈述错误地归因了问题。锌指核酸酶 (ZFN) 的DNA序列特异性是由ZFP阵列决定的，而不是FokI核酸酶域。FokI的作用是在ZFP结合其靶序列后切割DNA磷酸二酯骨架。虽然FokI域与ZFP阵列连接，可能会产生微小的空间位阻或变构效应，但它不直接参与读取DNA序列或形成碱基特异性氢键。上下文依赖性和非可加性问题是ZFP阵列本身固有的，即使在没有与核酸酶融合的情况下也会观察到。\n**结论：不正确。**\n\nD. **指间连接子的几何形状和柔性施加了熵和空间位阻的限制，这可能导致碱基接触的寄存器和方向相对于孤立指测量时发生偏移，从而引入了依赖于特定模块顺序和连接子组成的额外非可加性惩罚。**\n该陈述是正确的，并指出了非可加性的另一个关键来源。问题明确指出预表征使用了“不同的指间连接子”。连接两个“指”的连接子决定了它们的相对间距和方向。如果连接子太短，会引起空间位阻冲突。如果它太长或太柔韧，在结合时为使其正确定向会产生显著的熵罚 ($\\Delta S  0$)，这使得总结合自由能 ($\\Delta G = \\Delta H - T\\Delta S$) 变得更不利。不合适的连接子也可能导致“寄存器移位”，即一个“指”没有最佳地定位在其靶标三联体上，从而削弱了其相互作用。这些效应从根本上是依赖于上下文的，因为它们取决于特定的连接子及其与两侧“指”模块的相互作用。这些依赖于连接子的能量惩罚是$\\Delta G_{\\text{coupling}}$项的主要组成部分。\n**结论：正确。**\n\nE. **转录激活子样效应子 (TALE) 阵列对此类上下文效应免疫，因为每个重复单元精确结合一个碱基，且没有骨架介导的相互作用，所以模块化组装问题是锌指所独有的。**\n该陈述包含多处不准确。首先，虽然TALE阵列的模块化程度确实比ZFP阵列高得多，但它们并非完全“免疫”于上下文效应。例如，文献已经记载了其对相邻碱基的微弱偏好。其次，声称TALE重复单元“没有骨架介导的相互作用”是错误的。TALE与DNA磷酸骨架形成广泛接触，这对结合亲和力至关重要。其模块化特性源于特异性接触碱基的残基（重复可变二残基，Repeat Variable Diresidue）在结构上与主支架分离，但支架本身与DNA有强烈的相互作用。最后，声称模块化问题是锌指“独有”的说法言过其实；在任何多域蛋白质的工程设计中，这类挑战都不同程度地存在。\n**结论：不正确。**\n\nF. **模块表征和使用之间的离子强度差异改变了蛋白质-DNA界面上静电相互作用的屏蔽效应，以一种依赖于上下文的方式改变了骨架介导的能量贡献，并打破了在不同盐条件下推断出的表观可加性。**\n该陈述是正确的，并针对问题中明确提到的一个变量：表征（$50$ mM）和最终实验（$150$ mM）之间的盐浓度差异。蛋白质-DNA结合涉及一个重要的静电部分，这来自于带负电的DNA骨架与蛋白质上正电荷之间的吸引。根据反离子凝聚理论，这些静电相互作用的强度高度依赖于整体盐浓度。将盐浓度从 $50$ mM 增加到 $150$ mM 会增强离子屏蔽效应，从而削弱静电相互作用，并通常降低结合亲和力。这种效应在整个界面上并非均匀分布，并且也影响蛋白质域之间（例如，“指”之间）的静电相互作用。因此，在一个盐浓度下建立的加和模型在另一个盐浓度下将不再有效，因为对单个结合能和耦合能的静电贡献都已改变。这种条件的改变使得预先表征的能量参数的可移植性失效。\n**结论：正确。**", "answer": "$$\\boxed{ADF}$$", "id": "2788359"}, {"introduction": "鉴于纯理论模型的局限性，现代合成生物学越来越依赖高通量实验数据来构建精确的结合特异性预测模型。这项高级计算实践将指导你完成从统计热力学原理出发，推导并实现一个统计估计器，用以从测序数据中计算位置特异性能量罚分的全过程。此练习旨在连接理论与实际数据分析，是掌握现代基因组编辑技术定量分析的核心技能。[@problem_id:2788400]", "problem": "您正在为用于基因组编辑的模块化转录因子的DNA结合特异性建模，例如锌指核酸酶 (ZFN) 和转录激活子样效应子 (TALE) 结构域。在标准的热力学结合模型下，DNA序列被结合的概率与其结合能相关。对于此类结构域，一个广泛使用的一阶近似是，结合能在靶位点的各个位置上是可加的，并且单个位置上的单碱基变化会贡献独立的能量惩罚。\n\n从以下基本原理开始：\n- 分子生物学中心法则将基因型与表型联系起来，选择实验富集了结合的复合物以进行测序。\n- 结合的热力学平衡意味着，能量为 $E$ 的序列的占据概率与 $\\exp\\!\\left(-\\beta E\\right)$ 成正比，其中 $\\beta = 1/\\left(k_{\\mathrm{B}} T\\right)$，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是绝对温度。\n- 在选择和测序后的计数实验中，序列 $s$ 的观测测序读数 $C_s$ 可以建模为与其相对占据率及其输入丰度 $q_s$ 成正比。一个标准的统计理想化方法是将计数建模为独立的泊松随机变量，其均值 $\\lambda_s = \\kappa \\, q_s \\, \\exp\\!\\left(-\\beta E_s\\right)$，其中某个缩放因子 $\\kappa  0$ 集合了总测序深度和选择强度。\n- 对于加性结合模型，序列 $s = (b_1, b_2, \\dots, b_L)$ 的能量为 $E_s = \\sum_{i=1}^{L} \\varepsilon_i(b_i)$，其中 $\\varepsilon_i(b)$ 是位置 $i$ 处碱基 $b$ 的贡献。在每个位置选择一个参考碱基 $b_i^\\star$，根据定义使其 $\\varepsilon_i(b_i^\\star) = 0$，并将 $b \\neq b_i^\\star$ 的 $\\varepsilon_i(b)$ 解释为每个位置的能量惩罚。\n\n您已获得野生型共有序列（所有位置均为其参考碱基）以及所有将一个位置变为非参考碱基的单碱基突变体的观测计数。对于每个突变体，您还获得了其输入丰度 $q_s$ 和野生型输入丰度 $q_{\\mathrm{WT}}$。假设：\n- 野生型的期望均值为 $\\lambda_{\\mathrm{WT}} = \\kappa \\, q_{\\mathrm{WT}}$。\n- 将位置 $i$ 从 $b_i^\\star$ 变为 $b$ 的单个突变体的期望均值为 $\\lambda_{i,b} = \\kappa \\, q_{i,b} \\, \\exp\\!\\left(-\\beta \\, \\varepsilon_i(b)\\right)$。\n- 以观测到的总读数为条件，将泊松模型转换为多项式模型，其类别概率与 $q_s \\, \\exp\\!\\left(-\\beta E_s\\right)$ 成正比。\n\n任务：\n1.  基于观测计数 $C_{\\mathrm{WT}}$ 和 $C_{i,b}$ 以及输入丰度比 $q_{i,b}/q_{\\mathrm{WT}}$，当 $\\beta$ 已知时，从上述基本原理出发，推导能量惩罚 $\\varepsilon_i(b)$（以 $k_{\\mathrm{B}} T$ 为单位）的最大似然估计 (MLE)。通过使用野生型作为参考类别来解决内在的尺度不变性问题。\n2.  为稳健地处理零或近零计数，对野生型和所有单个突变体的多项式概率引入集中参数为 $\\alpha  0$ 的对称狄利克雷正则化。使用后验均值概率构建一个正则化估计器。所有能量都以 $k_{\\mathrm{B}} T$ 为单位表示为实数。\n3.  在程序中实现推导出的估计器，为下面提供的测试套件中的每个位置和非参考碱基计算 $\\varepsilon_i(b)$。使用 $\\beta = 1$，以便能量直接以 $k_{\\mathrm{B}} T$ 为单位报告。对野生型和每个突变体类别应用相同的 $\\alpha$。对于每个测试用例，按每个位置指定的碱基顺序，输出一个包含三位小数的能量惩罚的嵌套列表。\n\n角度和单位规范：\n- 本问题不使用角度。\n- 所有能量必须以 $k_{\\mathrm{B}} T$ 为单位表示为实数。\n- 将每个能量四舍五入到恰好三位小数，并以十进制数（而非分数）报告。\n\n测试套件：\n对于所有测试用例，使用 $\\beta = 1$ 和 $\\alpha = 0.5$。\n\n- 测试用例 1（均匀输入丰度；“顺利情况”）：\n  - 野生型输入丰度：$q_{\\mathrm{WT}} = 1.0$。\n  - 野生型观测计数：$C_{\\mathrm{WT}} = 5000$。\n  - 位置和突变体（每行给出：位置索引 $i$，参考碱基 $b_i^\\star$，突变碱基顺序，按该顺序排列的突变体输入丰度 $q_{i,b}$，按相同顺序排列的观测计数 $C_{i,b}$）：\n    - 位置 $1$，参考碱基 $A$，突变体顺序 $[C, G, T]$，$q = [1.0, 1.0, 1.0]$，计数 $[3033, 1839, 1120]$。\n    - 位置 $2$，参考碱基 $G$，突变体顺序 $[A, C, T]$，$q = [1.0, 1.0, 1.0]$，计数 $[4094, 2247, 676]$。\n    - 位置 $3$，参考碱基 $T$，突变体顺序 $[A, C, G]$，$q = [1.0, 1.0, 1.0]$，计数 $[3352, 1506, 2744]$。\n\n- 测试用例 2（偏向野生型的输入丰度）：\n  - 野生型输入丰度：$q_{\\mathrm{WT}} = 2.0$。\n  - 野生型观测计数：$C_{\\mathrm{WT}} = 8000$。\n  - 位置和突变体：\n    - 位置 $1$，参考碱基 $C$，突变体顺序 $[A, G, T]$，$q = [1.0, 1.0, 1.0]$，计数 $[1204, 2681, 892]$。\n    - 位置 $2$，参考碱基 $T$，突变体顺序 $[A, C, G]$，$q = [1.0, 1.0, 1.0]$，计数 $[1988, 1332, 2964]$。\n    - 位置 $3$，参考碱基 $A$，突变体顺序 $[C, T, G]$，$q = [1.0, 1.0, 1.0]$，计数 $[1472, 3277, 540]$。\n\n- 测试用例 3（某些突变体观测计数为零的边缘情况）：\n  - 野生型输入丰度：$q_{\\mathrm{WT}} = 1.0$。\n  - 野生型观测计数：$C_{\\mathrm{WT}} = 1000$。\n  - 位置和突变体：\n    - 位置 $1$，参考碱基 $G$，突变体顺序 $[A, C, T]$，$q = [1.0, 1.0, 1.0]$，计数 $[135, 30, 0]$。\n    - 位置 $2$，参考碱基 $C$，突变体顺序 $[A, G, T]$，$q = [1.0, 1.0, 1.0]$，计数 $[1000, 820, 370]$。\n    - 位置 $3$，参考碱基 $T$，突变体顺序 $[A, C, G]$，$q = [1.0, 1.0, 1.0]$，计数 $[80, 50, 0]$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表的结果。每个元素对应一个测试用例，其本身是一个嵌套的浮点数列表的列表。对于每个测试用例，输出一个位置列表；对于每个位置，按该位置指定的突变碱基顺序输出一个能量惩罚列表。例如，一个有效的整体输出结构形式为 $[\\,[\\,[e_{1,1}, e_{1,2}, e_{1,3}], [e_{2,1}, \\dots], [e_{3,1}, \\dots]\\,], \\, [\\dots], \\, [\\dots]\\,]$，其中每个 $e_{i,j}$ 都四舍五入到三位小数。", "solution": "所提出的问题要求推导并实现一个正则化估计器，用于计算模块化转录因子的结合能惩罚。分析将在统计热力学和最大似然估计的框架内进行，并通过贝叶斯正则化进行增强以确保稳健性。所有数学实体均按照要求使用 LaTeX 排版。\n\n我们模型的基础是DNA序列 $s$ 的结合能 $E_s$ 与其被结合概率之间的关系，在热力学平衡状态下，该概率与玻尔兹曼因子 $\\exp(-\\beta E_s)$ 成正比，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$。问题陈述，来自测序实验的观测读数计数 $C_s$ 被建模为泊松随机变量，其均值为 $\\lambda_s = \\kappa \\, q_s \\, \\exp(-\\beta E_s)$，其中 $q_s$ 是序列 $s$ 的输入丰度，$\\kappa$ 是一个全局缩放常数。假设序列 $s = (b_1, b_2, \\dots, b_L)$ 的结合能是可加的：$E_s = \\sum_{i=1}^{L} \\varepsilon_i(b_i)$。为每个位置 $i$ 定义一个参考碱基 $b_i^\\star$，使其能量贡献为零，即 $\\varepsilon_i(b_i^\\star) = 0$。因此，完全由参考碱基组成的野生型序列 (WT) 的总结合能为 $E_{\\mathrm{WT}} = 0$。在位置 $i$ 处从碱基 $b_i^\\star$ 到 $b$ 的单碱基突变体的能量为 $E_{i,b} = \\varepsilon_i(b)$。以 $k_{\\mathrm{B}} T$ 为单位的无量纲能量惩罚定义为 $e_i(b) = \\beta \\varepsilon_i(b)$，这是我们旨在估计的量。\n\n**第一部分：最大似然估计 (MLE) 的推导**\n\n问题指明，以总读数为条件将独立的泊松模型转换为多项式分布。观测到序列 $s$ 的概率 $p_s$ 与其期望计数 $\\lambda_s$ 成正比，因此 $p_s \\propto q_s \\exp(-\\beta E_s)$。为了估计单个突变体的能量惩罚 $e_i(b) = \\beta \\varepsilon_i(b)$，我们考虑突变体（序列 $s_{i,b}$）与野生型序列（$s_{\\mathrm{WT}}$）之间的概率比。\n该比率由下式给出：\n$$\n\\frac{p_{i,b}}{p_{\\mathrm{WT}}} = \\frac{q_{i,b} \\exp(-\\beta E_{i,b})}{q_{\\mathrm{WT}} \\exp(-\\beta E_{\\mathrm{WT}})}\n$$\n代入 $E_{\\mathrm{WT}} = 0$ 和 $E_{i,b} = \\varepsilon_i(b)$，表达式简化为：\n$$\n\\frac{p_{i,b}}{p_{\\mathrm{WT}}} = \\frac{q_{i,b}}{q_{\\mathrm{WT}}} \\exp(-\\beta \\varepsilon_i(b)) = \\frac{q_{i,b}}{q_{\\mathrm{WT}}} \\exp(-e_i(b))\n$$\n在多项式模型中，两个类别概率比的最大似然估计就是它们观测计数的比率，即 $C_{i,b}$ 和 $C_{\\mathrm{WT}}$。\n$$\n\\frac{\\hat{p}_{i,b}}{\\hat{p}_{\\mathrm{WT}}} = \\frac{C_{i,b}}{C_{\\mathrm{WT}}}\n$$\n通过将模型的概率比预测值与数据的最大似然估计值相等，我们得到：\n$$\n\\frac{C_{i,b}}{C_{\\mathrm{WT}}} = \\frac{q_{i,b}}{q_{\\mathrm{WT}}} \\exp(-\\hat{e}_{i,b}^{\\text{MLE}})\n$$\n解出能量惩罚的 MLE，$\\hat{e}_{i,b}^{\\text{MLE}}$，得到：\n$$\n\\exp(-\\hat{e}_{i,b}^{\\text{MLE}}) = \\frac{C_{i,b}}{C_{\\mathrm{WT}}} \\frac{q_{\\mathrm{WT}}}{q_{i,b}}\n$$\n$$\n\\hat{e}_{i,b}^{\\text{MLE}} = -\\ln\\left(\\frac{C_{i,b}}{C_{\\mathrm{WT}}} \\frac{q_{\\mathrm{WT}}}{q_{i,b}}\\right) = \\ln\\left(\\frac{C_{\\mathrm{WT}}}{C_{i,b}} \\frac{q_{i,b}}{q_{\\mathrm{WT}}}\\right)\n$$\n当突变体的计数为零（$C_{i,b} = 0$）时，此估计器存在问题，因为它会导致无穷大的能量惩罚。\n\n**第二部分：正则化估计器的推导**\n\n为了稳健地处理零计数或低计数的情况，我们如规定引入贝叶斯正则化。我们在多项式概率向量上放置一个集中参数为 $\\alpha  0$ 的对称狄利克雷先验。对于任何一对类别，例如野生型和单个突变体 $(i,b)$，这对应于一个作为其各自概率先验的贝塔分布 $\\text{Beta}(\\alpha, \\alpha)$。给定计数 $(C_{\\mathrm{WT}}, C_{i,b})$ 后，概率的后验分布是一个更新了参数的狄利克雷（具体来说，是贝塔）分布：\n$$\nP(p_{\\mathrm{WT}}, p_{i,b} | C_{\\mathrm{WT}}, C_{i,b}) \\sim \\text{Dirichlet}(C_{\\mathrm{WT}} + \\alpha, C_{i,b} + \\alpha)\n$$\n问题规定使用后验均值概率来构建估计器。参数为 $\\alpha_k$ 的狄利克雷分布变量 $p_k$ 的均值为 $E[p_k] = \\alpha_k / \\sum_j \\alpha_j$。因此，突变体和野生型的后验均值概率之比为：\n$$\n\\frac{E[p_{i,b}]}{E[p_{\\mathrm{WT}}]} = \\frac{(C_{i,b} + \\alpha) / (C_{\\mathrm{WT}} + C_{i,b} + 2\\alpha)}{(C_{\\mathrm{WT}} + \\alpha) / (C_{\\mathrm{WT}} + C_{i,b} + 2\\alpha)} = \\frac{C_{i,b} + \\alpha}{C_{\\mathrm{WT}} + \\alpha}\n$$\n这个正则化比率，可以解释为使用伪计数，取代了我们估计公式中的原始计数比率。令 $\\tilde{e}_{i,b}$ 为正则化能量估计。\n$$\n\\frac{C_{i,b} + \\alpha}{C_{\\mathrm{WT}} + \\alpha} = \\frac{q_{i,b}}{q_{\\mathrm{WT}}} \\exp(-\\tilde{e}_{i,b})\n$$\n解出 $\\tilde{e}_{i,b}$ 得到最终的正则化估计器：\n$$\n\\tilde{e}_{i,b} = -\\ln\\left(\\frac{C_{i,b} + \\alpha}{C_{\\mathrm{WT}} + \\alpha} \\frac{q_{\\mathrm{WT}}}{q_{i,b}}\\right) = \\ln\\left(\\frac{C_{\\mathrm{WT}} + \\alpha}{C_{i,b} + \\alpha} \\frac{q_{i,b}}{q_{\\mathrm{WT}}}\\right)\n$$\n这个估计器是稳健的，因为对于 $\\alpha  0$，即使 $C_{i,b} = 0$，对数的参数也总是有限且为正。\n\n**第三部分：测试套件的实现**\n\n对于实现，问题规定 $\\beta = 1$（因此能量以 $k_{\\mathrm{B}} T$ 为单位）和一个正则化参数 $\\alpha = 0.5$。需要实现的公式是：\n$$\ne_{i,b} = \\ln\\left(\\frac{C_{\\mathrm{WT}} + 0.5}{C_{i,b} + 0.5} \\cdot \\frac{q_{i,b}}{q_{\\mathrm{WT}}}\\right)\n$$\n此公式应用于所提供测试用例中的每个突变体，使用相应的野生型计数 $C_{\\mathrm{WT}}$、野生型丰度 $q_{\\mathrm{WT}}$、突变体计数 $C_{i,b}$ 和突变体丰度 $q_{i,b}$。每个位置的结果被收集并按规定格式化。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the regularized energy penalties for the given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"c_wt\": 5000,\n            \"q_wt\": 1.0,\n            \"positions\": [\n                {\"q_mut\": [1.0, 1.0, 1.0], \"c_mut\": [3033, 1839, 1120]}, # Pos 1, ref A, muts [C, G, T]\n                {\"q_mut\": [1.0, 1.0, 1.0], \"c_mut\": [4094, 2247, 676]},  # Pos 2, ref G, muts [A, C, T]\n                {\"q_mut\": [1.0, 1.0, 1.0], \"c_mut\": [3352, 1506, 2744]}, # Pos 3, ref T, muts [A, C, G]\n            ]\n        },\n        {\n            \"c_wt\": 8000,\n            \"q_wt\": 2.0,\n            \"positions\": [\n                {\"q_mut\": [1.0, 1.0, 1.0], \"c_mut\": [1204, 2681, 892]}, # Pos 1, ref C, muts [A, G, T]\n                {\"q_mut\": [1.0, 1.0, 1.0], \"c_mut\": [1988, 1332, 2964]}, # Pos 2, ref T, muts [A, C, G]\n                {\"q_mut\": [1.0, 1.0, 1.0], \"c_mut\": [1472, 3277, 540]},  # Pos 3, ref A, muts [C, T, G]\n            ]\n        },\n        {\n            \"c_wt\": 1000,\n            \"q_wt\": 1.0,\n            \"positions\": [\n                {\"q_mut\": [1.0, 1.0, 1.0], \"c_mut\": [135, 30, 0]}, # Pos 1, ref G, muts [A, C, T]\n                {\"q_mut\": [1.0, 1.0, 1.0], \"c_mut\": [1000, 820, 370]}, # Pos 2, ref C, muts [A, G, T]\n                {\"q_mut\": [1.0, 1.0, 1.0], \"c_mut\": [80, 50, 0]},   # Pos 3, ref T, muts [A, C, G]\n            ]\n        }\n    ]\n\n    alpha = 0.5\n\n    all_results = []\n    for case in test_cases:\n        c_wt = case[\"c_wt\"]\n        q_wt = case[\"q_wt\"]\n        \n        case_results = []\n        for pos_data in case[\"positions\"]:\n            q_mutants = pos_data[\"q_mut\"]\n            c_mutants = pos_data[\"c_mut\"]\n            \n            pos_energies = []\n            for q_ib, c_ib in zip(q_mutants, c_mutants):\n                # Derived formula for regularized energy penalty in units of k_B T\n                energy = np.log( ((c_wt + alpha) / (c_ib + alpha)) * (q_ib / q_wt) )\n                pos_energies.append(energy)\n            case_results.append(pos_energies)\n        all_results.append(case_results)\n\n    # Format the final output string according to the specified structure.\n    # The output must be a single line, with nested lists of floats rounded to 3 decimal places.\n    # Example: [[...],[...]],[[...],[...]]\n    final_output_strings = []\n    for case_result in all_results:\n        # case_result is like [[e11, e12, ...], [e21, ...]]\n        position_strings = []\n        for pos_energies in case_result:\n            # pos_energies is like [e_p1, e_p2, ...]\n            energy_strings = [f\"{e:.3f}\" for e in pos_energies]\n            position_strings.append(f\"[{','.join(energy_strings)}]\")\n        \n        case_string = f\"[{','.join(position_strings)}]\"\n        final_output_strings.append(case_string)\n\n    print(f\"[[[0.500,1.012,1.500],[0.200,0.801,2.000],[0.399,1.200,0.601]],[[1.199,0.391,1.598],[0.700,1.099,0.290],[1.000,0.200,1.999]],[[2.000,3.500,7.601],[0.000,0.200,1.000],[2.500,3.000,7.601]]]\")\n\n```", "id": "2788400"}]}