{"hands_on_practices": [{"introduction": "理解转录终止子功能的第一步是量化其对基因表达的影响。本练习将探讨在一个操纵子中，通过改变两个基因之间终止子的效率来精确调控它们相对表达水平的方法，这是合成基因线路设计中的一个基本概念。通过这个假想的场景，你可以练习推导转录通读（transcriptional read-through）如何影响下游基因的蛋白产量。[@problem_id:2065883]", "problem": "一位合成生物学家正在*大肠杆菌*(*Escherichia coli*)中构建一个双基因操纵子，用于生物传感器应用。该操纵子被命名为 `Construct 1`，受单个诱导型启动子控制。第一个基因 `gene_X` 编码一种用作报告基因的荧光蛋白。第二个基因 `gene_Y` 位于 `gene_X` 的紧邻下游，编码一种信号放大酶。在 `gene_X` 的编码序列和 `gene_Y` 的核糖体结合位点 (RBS) 之间，插入了一个强的 Rho-非依赖性转录终止子 `Terminator_S`。实验表征表明，`Terminator_S` 的终止效率为 98%，这意味着转录 `gene_X` 的核糖核酸 (RNA) 聚合酶复合物中有 98% 会在该位点终止转录。\n\n为了调节生物传感器的输出，该生物学家创建了一个新版本的操纵子 `Construct 2`。在 `Construct 2` 中，`Terminator_S` 被一个经过理性设计的较弱的终止子 `Terminator_W` 所取代，其终止效率为 49%。所有其他遗传元件（启动子、`gene_X`、`gene_Y` 以及所有 RBS 序列）在 `Construct 1` 和 `Construct 2` 之间是相同的。\n\n假设在诱导时，启动子活性、两个基因的翻译速率以及所有 mRNA 和蛋白质产物的稳定性对于两种构建体都是恒定且相同的，那么当细胞群体从使用 `Construct 1` 切换到使用 `Construct 2` 时，下列哪个陈述最准确地预测了稳态蛋白质表达水平的变化？\n\nA. 蛋白质 X 的表达量将大约减半，而蛋白质 Y 的表达量将显著增加。\n\nB. 蛋白质 X 的表达量将保持大致相同，而蛋白质 Y 的表达量将显著增加。\n\nC. 蛋白质 X 和蛋白质 Y 的表达量都将显著增加。\n\nD. 蛋白质 X 的表达量将保持大致相同，而蛋白质 Y 的表达量将显著减少。\n\nE. 蛋白质 X 和蛋白质 Y 的表达量都将大约减半。", "solution": "将启动子处的转录起始速率定义为 $r$（单位时间的转录本数），对两种构建体均相同。令 $p_{\\text{term}}$ 为 RNA 聚合酶在基因间终止子处终止的概率，并令 $p_{\\text{rt}} = 1 - p_{\\text{term}}$ 为转录进入 $gene\\_Y$ 的通读概率。根据题意，对于构建体 1，$p_{\\text{term}}^{(1)} = 0.98 = \\frac{49}{50}$，因此 $p_{\\text{rt}}^{(1)} = 1 - 0.98 = 0.02 = \\frac{1}{50}$。对于构建体 2，$p_{\\text{term}}^{(2)} = 0.49 = \\frac{49}{100}$，因此 $p_{\\text{rt}}^{(2)} = 1 - 0.49 = 0.51 = \\frac{51}{100}$。\n\n因为终止子位于 $gene\\_X$ 编码序列的下游，所以每个起始的转录本都必然包含 $gene\\_X$。因此，在两种构建体中，$gene\\_X$ mRNA 的生成速率均为 $r$。在 mRNA 和蛋白质的稳定性以及翻译速率在两种构建体之间恒定且相同的情况下，令 $\\delta_{M,X}$ 和 $\\delta_{P,X}$ 分别表示 $gene\\_X$ mRNA 和蛋白质 X 的降解速率，令 $k_{\\text{tl},X}$ 表示翻译速率常数。稳态 mRNA 水平满足\n$$\n\\frac{dM_{X}}{dt} = r - \\delta_{M,X} M_{X} \\quad \\Rightarrow \\quad M_{X}^{*} = \\frac{r}{\\delta_{M,X}},\n$$\n稳态蛋白质水平满足\n$$\n\\frac{dP_{X}}{dt} = k_{\\text{tl},X} M_{X} - \\delta_{P,X} P_{X} \\quad \\Rightarrow \\quad P_{X}^{*} = \\frac{k_{\\text{tl},X}}{\\delta_{P,X}} M_{X}^{*} = \\frac{k_{\\text{tl},X}}{\\delta_{P,X}} \\frac{r}{\\delta_{M,X}}.\n$$\n右侧的所有参数在两种构建体之间是相同的，因此当从构建体 1 切换到构建体 2 时，$P_{X}^{*}$ 保持不变。\n\n对于 $gene\\_Y$，只有通读的转录本才包含 $gene\\_Y$，所以进入 $gene\\_Y$ 的有效转录速率是 $r p_{\\text{rt}}$。在 $gene\\_Y$ mRNA 和蛋白质 Y 的降解速率 $\\delta_{M,Y}$ 和 $\\delta_{P,Y}$ 以及翻译速率 $k_{\\text{tl},Y}$ 在两种构建体之间保持不变的情况下，\n$$\nM_{Y}^{*} = \\frac{r p_{\\text{rt}}}{\\delta_{M,Y}}, \\quad P_{Y}^{*} = \\frac{k_{\\text{tl},Y}}{\\delta_{P,Y}} M_{Y}^{*} = \\frac{k_{\\text{tl},Y}}{\\delta_{P,Y}} \\frac{r p_{\\text{rt}}}{\\delta_{M,Y}}.\n$$\n因此，从构建体 1 到构建体 2，蛋白质 Y 稳态水平的倍数变化是\n$$\n\\frac{P_{Y,2}^{*}}{P_{Y,1}^{*}} = \\frac{p_{\\text{rt}}^{(2)}}{p_{\\text{rt}}^{(1)}} = \\frac{0.51}{0.02} = \\frac{51}{2} = 25.5,\n$$\n这是一个大幅增加。同时，$P_{X}^{*}$ 保持不变。\n\n因此，正确的定性预测是蛋白质 X 的表达量保持大致相同，而蛋白质 Y 的表达量显著增加。", "answer": "$$\\boxed{B}$$", "id": "2065883"}, {"introduction": "在构建可预测的生物系统中，对生物元件进行精确的定量表征至关重要。这项实践要求你基于一个精巧的分裂蛋白互补实验设计，从第一性原理推导出计算终止子效率的分析表达式。这个过程不仅能加深你对比率型测量（ratiometric measurement）的理解，也凸显了在定量生物学中设置恰当对照组的重要性。[@problem_id:2074202]", "problem": "一个合成生物学团队正在设计一个遗传回路，以表征一个新型转录终止子（命名为 `Term-X`）的效率。他们的表征检测依赖于一个使用荧光素酶的蛋白质片段互补系统。该荧光素酶被分裂成一个N端片段（`N-Luc`）和一个C端片段（`C-Luc`）。当这两个片段同时存在于一个细胞中时，它们可以自发地重组，形成一个有功能的、能发光的酶。\n\n该团队使用三种不同的细菌培养物设计了以下实验装置：\n\n1.  **培养物A（测试组）：** 这些细胞被两种质粒共转化。\n    *   质粒1包含一个受强组成型启动子调控的 `C-Luc` 基因。\n    *   质粒2，即测试构建体，包含一个按以下顺序排列的基因盒：`Promoter_A - Term-X - Gene_N-Luc - Terminator_strong`。`Promoter_A` 是一个强诱导型启动子，`Gene_N-Luc` 编码 `N-Luc` 片段，而 `Terminator_strong` 是一个已知的、用于终止转录本的高效终止子。\n\n2.  **培养物B（阳性对照组）：** 这些细胞也被两种质粒共转化。\n    *   它包含与培养物A相同的质粒1。\n    *   它包含一个移除了 `Term-X` 的质粒2的对照版本。其基因盒为：`Promoter_A - Gene_N-Luc - Terminator_strong`。这个构建体模拟了一个效率为0%（或100%转录通读）的终止子。\n\n3.  **培养物C（阴性对照组）：** 这些细胞只用质粒1进行转化。这个培养物用于测量细胞和检测试剂的背景荧光。\n\n在所有培养物中诱导 `Promoter_A` 并让它们达到稳态后，该团队测量了每个培养物的荧光信号，分别获得了 $L_{A}$、$L_{B}$ 和 $L_{C}$ 这三个值。\n\n假设如下：\n*   在相关培养物中，`Promoter_A` 的活性和 `C-Luc` 的浓度是相同的。\n*   `C-Luc` 的浓度远超过量，因此功能性荧光素酶的形成速率与 `N-Luc` 片段的浓度成正比。\n*   测得的荧光信号与功能性荧光素酶的浓度成正比。\n*   在培养物C中测得的背景荧光是培养物A和B中所测信号的一个可加性组分。\n\n终止子效率 $E_T$ 定义为在 `Promoter_A` 处起始的转录事件中，被 `Term-X` 成功终止的比例。推导一个以测得的荧光值 $L_{A}$、$L_{B}$ 和 $L_{C}$ 表示的 $E_T$ 的闭式解析表达式。", "solution": "目标是基于测得的荧光值 $L_A$、$L_B$ 和 $L_C$ 推导出终止子效率 $E_T$ 的表达式。\n\n首先，我们来定义关键术语。终止子效率 $E_T$ 是被终止的转录事件的比例。转录通读 $T_{read}$ 是未被终止并继续通过终止子的转录事件的比例。根据定义，这两个量之和必须为1：\n$$ E_T + T_{read} = 1 $$\n因此，我们可以将效率表示为：\n$$ E_T = 1 - T_{read} $$\n我们的任务现在简化为找到一个用可测量的荧光值表示 $T_{read}$ 的表达式。\n\n让我们对荧光信号进行建模。根据问题的假设，测得的总荧光 $L_{total}$ 是与重构的功能性荧光素酶浓度 [Luc] 成正比的信号和背景信号 $L_{bg}$ 的总和。\n$$ L_{total} = k_1 [\\text{Luc}] + L_{bg} $$\n其中 $k_1$ 是一个比例常数。\n\n问题还指出，`C-Luc` 是过量的，因此功能性荧光素酶的形成受 `N-Luc` 片段的限制。这意味着功能性荧光素酶的浓度与 `N-Luc` 片段的浓度 [N-Luc] 成正比。\n$$ [\\text{Luc}] = k_2 [\\text{N-Luc}] $$\n其中 $k_2$ 是另一个比例常数。\n\n结合这两个关系，我们得到：\n$$ L_{total} = k_1 (k_2 [\\text{N-Luc}]) + L_{bg} = K [\\text{N-Luc}] + L_{bg} $$\n其中 $K = k_1 k_2$ 是一个合并的比例常数。\n\n在稳态下，蛋白质的浓度与其产生速率成正比。`N-Luc` 的产生速率与其基因 `Gene_N-Luc` 的转录速率成正比。设 $J_p$ 为从 `Promoter_A` 开始的转录起始速率。转录 `Gene_N-Luc` 的RNA聚合酶分子的通量取决于它们是否通读 `Term-X`。因此，`N-Luc` 的稳态浓度与该转录通量成正比。\n$$ [\\text{N-Luc}] \\propto (\\text{Transcription flux reaching Gene_N-Luc}) $$\n\n现在，让我们将这个模型应用于三种培养物中的每一种。\n\n对于培养物C（阴性对照组），没有 `N-Luc` 产生，所以 $[\\text{N-Luc}]_C = 0$。测得的荧光纯粹是背景信号。\n$$ L_C = K \\cdot 0 + L_{bg} \\implies L_{bg} = L_C $$\n\n对于培养物B（阳性对照组），`Term-X` 不存在，意味着有100%的通读进入 `Gene_N-Luc`。到达 `Gene_N-Luc` 的转录通量是来自 `Promoter_A` 的全部起始通量，即 $J_p$。\n因此，培养物B中 `N-Luc` 的稳态浓度与 $J_p$ 成正比：\n$$ [\\text{N-Luc}]_B = c \\cdot J_p $$\n其中 $c$ 是一个包含了翻译效率和蛋白质降解速率的常数。\n培养物B的荧光为：\n$$ L_B = K [\\text{N-Luc}]_B + L_{bg} = K (c J_p) + L_C $$\n重新整理此式，得到100%通读情况下超出背景的荧光信号：\n$$ L_B - L_C = K c J_p $$\n\n对于培养物A（测试组），`Term-X` 存在。通读终止子的聚合酶比例为 $T_{read}$。因此，到达 `Gene_N-Luc` 的转录通量是 $J_p \\cdot T_{read}$。\n培养物A中 `N-Luc` 的稳态浓度为：\n$$ [\\text{N-Luc}]_A = c \\cdot (J_p \\cdot T_{read}) $$\n培养物A的荧光为：\n$$ L_A = K [\\text{N-Luc}]_A + L_{bg} = K (c J_p T_{read}) + L_C $$\n重新整理得到测试情况下超出背景的荧光信号：\n$$ L_A - L_C = K c J_p T_{read} $$\n\n我们现在有一个由两个方程组成的方程组：\n1. $L_B - L_C = K c J_p$\n2. $L_A - L_C = (K c J_p) T_{read}$\n\n为了求出 $T_{read}$，我们可以将第二个方程除以第一个方程。包含所有未知分子参数的项 $K c J_p$ 被消掉了：\n$$ \\frac{L_A - L_C}{L_B - L_C} = \\frac{(K c J_p) T_{read}}{K c J_p} = T_{read} $$\n\n最后，我们将这个 $T_{read}$ 的表达式代入终止子效率的定义 $E_T = 1 - T_{read}$ 中：\n$$ E_T = 1 - \\frac{L_A - L_C}{L_B - L_C} $$\n为了将其合并成一个分数，我们找到一个公分母：\n$$ E_T = \\frac{(L_B - L_C)}{(L_B - L_C)} - \\frac{L_A - L_C}{L_B - L_C} $$\n$$ E_T = \\frac{(L_B - L_C) - (L_A - L_C)}{L_B - L_C} $$\n$$ E_T = \\frac{L_B - L_C - L_A + L_C}{L_B - L_C} $$\n$$ E_T = \\frac{L_B - L_A}{L_B - L_C} $$\n这就是终止子效率的最终闭式表达式。", "answer": "$$\\boxed{\\frac{L_{B} - L_{A}}{L_{B} - L_{C}}}$$", "id": "2074202"}, {"introduction": "从序列预测功能是合成生物学的核心目标之一，这为从头设计或发现新生物元件提供了基础。这项高级练习旨在将内在转录终止的生物物理模型形式化为一个计算算法，用于扫描基因组序列中潜在的“隐性”终止子。通过这个练习，你将获得将理论原理转化为计算机辅助设计（in silico design）和元件发现工具的实践经验。[@problem_id:2727089]", "problem": "要求您使用滑动窗口，对核糖核酸 (RNA) 编码区中的隐性内源性转录终止子进行计算扫描，并将其形式化和实现。该扫描必须结合发夹结构自由能的热力学估算和发夹茎下游的尿嘧啶含量标准。您的任务是根据适用于细菌转录终止的第一性原理推导检测规则，并将其实现为一个程序来评估指定的测试用例。\n\n基本依据和建模假设：\n- 细菌中的内源性终止通常涉及形成一个稳定的RNA发夹结构，其后紧跟着一段富含尿嘧啶的序列，这段序列会使转录泡内的核糖核酸 (RNA)–脱氧核糖核酸 (DNA) 杂合链失稳。这是一个广为接受的经验事实，与分子生物学的中心法则相符。中心法则提出DNA转录成RNA，而RNA的结构可以调控转录的延伸和终止。\n- RNA发夹结构的稳定性可以通过一个粗粒度自由能模型来近似，该模型将碱基对的贡献和环的熵罚项相加。设发夹结构由长度为 $s$ 的左茎段、长度为 $l$ 的环以及与左茎段反向互补的长度为 $s$ 的右茎段定义。估算的折叠自由能为\n$$\n\\Delta G_{\\text{hairpin}} = \\sum_{k=1}^{s} \\varepsilon\\big(b_{\\text{L}}(k), b_{\\text{R}}(s-k+1)\\big) + \\varepsilon_{\\text{init}} + \\varepsilon_{\\text{loop}}(l),\n$$\n其中 $b_{\\text{L}}(k)$ 是左茎段位置 $k$ 处的碱基，$b_{\\text{R}}(k)$ 是右茎段位置 $k$ 处的碱基，$\\varepsilon(\\cdot,\\cdot)$ 是碱基对能量，$\\varepsilon_{\\text{init}}$ 是起始罚分，$\\varepsilon_{\\text{loop}}(l)$ 是捕捉熵成本的环罚分。所有能量单位均为千卡/摩尔 (kcal/mol)。\n\n待使用的能量参数：\n- Watson–Crick碱基对和摆动碱基对的能量：\n  - $\\varepsilon(\\text{G},\\text{C}) = \\varepsilon(\\text{C},\\text{G}) = -3.4$，\n  - $\\varepsilon(\\text{A},\\text{U}) = \\varepsilon(\\text{U},\\text{A}) = -2.1$，\n  - 如果允许，可选的摆动配对 (G–U) 能量：$\\varepsilon(\\text{G},\\text{U}) = \\varepsilon(\\text{U},\\text{G}) = -0.9$。\n- 任何未列出的碱基对均被视为错配，罚分为 $\\varepsilon_{\\text{mm}} = +1.0$。\n- 起始罚分：$\\varepsilon_{\\text{init}} = +3.0$。\n- 环罚分 (自然对数)：$\\varepsilon_{\\text{loop}}(l) = \\alpha \\ln(l) + \\beta$，其中 $\\alpha = 1.75$，$\\beta = 0.5$。\n\n在每个滑动窗口内要实现的检测规则：\n- 对于RNA序列 $S$ 上的一个长度为 $W$ 的给定窗口，该窗口由集合 $\\{\\text{A},\\text{C},\\text{G},\\text{U}\\}$ 中的字符组成（包含任何其他字符的窗口将被忽略），评估所有由茎长度 $s \\in [s_{\\min}, s_{\\max}]$ 和环长度 $l \\in [l_{\\min}, l_{\\max}]$ 参数化的候选发夹结构，使得完整结构（左茎、环、右茎）以及一个长度为 $T$ 个核苷酸的下游序列段（“尾部”）完全位于该窗口内。对于每个候选结构，计算其 $\\Delta G_{\\text{hairpin}}$ 以及紧邻的下游长度为 $T$ 的尾部中的尿嘧啶分数，定义为 $f_{\\text{U}} = n_{\\text{U}}/T$，其中 $n_{\\text{U}}$ 是尾部中 $\\text{U}$ 的计数。\n- 如果 $f_{\\text{U}} \\ge \\theta_U$，则该候选结构满足生物化学合理性过滤器。在窗口内所有通过此过滤器的候选结构中，找到最小的 $\\Delta G_{\\text{hairpin}}$。当且仅当该最小 $\\Delta G_{\\text{hairpin}} \\le \\theta_G$ 时，该窗口被标记为预测的终止子。\n- 窗口以 $1$ 个核苷酸的步长从索引 $0$ 滑动到 $|S|-W$（含）。计算每个测试用例中被标记的窗口数量。不要尝试跨窗口去重；每个被标记的窗口都对计数贡献 $1$。\n\n角度和单位约定：\n- 所有能量必须视为以 kcal/mol 为单位的值。环罚分使用自然对数。此问题中没有角度。像 $f_{\\text{U}}$ 这样的分数必须作为 $[0,1]$ 区间内的小数处理。\n\n边界情况规则：\n- 如果窗口中出现 $\\{\\text{A},\\text{C},\\text{G},\\text{U}\\}$ 之外的任何字符，则该窗口必须被忽略，不能被标记。\n- 如果候选结构的长度为 $T$ 的尾部会延伸到当前窗口之外，则该候选结构在该窗口中不被考虑。\n\n测试套件：\n实现您的程序以评估以下四个测试用例。每个用例指定一个RNA序列和参数。布尔值“wobble”指示是否允许能量为 $-0.9$ 的G–U摆动配对；如果为false，则将G–U视为错配，罚分为 $+1.0$。\n\n- 用例 1 (正常路径，带有U序列段的强发夹结构):\n  - $S_1 =$ \"AUGGCCGCAACGACGGAUCCGAACGUGGAGCGCGAAAAUCGCGCUUUUUUUGGAACGCCGAAGGCUACGGA\"\n  - $W_1 = 40$, $s_{\\min,1} = 4$, $s_{\\max,1} = 8$, $l_{\\min,1} = 3$, $l_{\\max,1} = 8$, $T_1 = 7$,\n  - $\\theta_{G,1} = -9.0$, $\\theta_{U,1} = 0.8$, wobble allowed $=\\text{true}$。\n\n- 用例 2 (接近阈值的边界条件，茎主要由A–U组成，尿嘧啶分数恰好在阈值上):\n  - $S_2 =$ \"AUGGAGGCCGAAUCGGACGU\" + \"AAAAAAAAAUUUUUUUUUUUGGG\" + \"GCAAGCUAGCGGAACUCGGA\"\n  - $W_2 = 36$, $s_{\\min,2} = 4$, $s_{\\max,2} = 8$, $l_{\\min,2} = 3$, $l_{\\max,2} = 6$, $T_2 = 10$,\n  - $\\theta_{G,2} = -7.1$, $\\theta_{U,2} = 0.7$, wobble allowed $=\\text{false}$。\n\n- 用例 3 (强发夹结构但尾部富含G/C；应无法通过U含量过滤器):\n  - $S_3 =$ \"GGAUGCGGCGGCCGCAAUGGA\" + \"GCGCGAAAAUCGCGCGGGGGGG\" + \"CCGGAUCGAGGCCGGAUCGG\"\n  - $W_3 = 40$, $s_{\\min,3} = 4$, $s_{\\max,3} = 8$, $l_{\\min,3} = 3$, $l_{\\max,3} = 8$, $T_3 = 7$,\n  - $\\theta_{G,3} = -9.0$, $\\theta_{U,3} = 0.8$, wobble allowed $=\\text{true}$。\n\n- 用例 4 (存在不明确碱基'N'；包含它的窗口必须被忽略):\n  - $S_4 =$ \"AUGGCCGUAANCCGAU\" + \"GCGCGAAAAUCGCGCUUUUUUU\" + \"GGAACGU\"\n  - $W_4 = 40$, $s_{\\min,4} = 4$, $s_{\\max,4} = 8$, $l_{\\min,4} = 3$, $l_{\\max,4} = 8$, $T_4 = 7$,\n  - $\\theta_{G,4} = -9.0$, $\\theta_{U,4} = 0.8$, wobble allowed $=\\text{true}$。\n\n程序要求和最终输出格式：\n- 严格按照规定实现滑动窗口扫描，使用提供的热力学和环参数。该算法必须具有通用性，能够处理以上所有测试用例而无需特殊处理。\n- 对四个用例中的每一个，计算被标记窗口的整数数量。\n- 您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表，例如，“[n1,n2,n3,n4]”。输出必须是整数，不含任何附加文本。\n\n在您的推导中讨论潜在的假阳性，并解释 $\\Delta G_{\\text{hairpin}}$ 和尿嘧啶含量标准的组合如何基于所述的生物物理模型来解决这些问题。最终程序不输出此讨论；它必须只输出所要求的列表。", "solution": "该问题要求形式化并实现一种计算方法，用以在给定的核糖核酸 (RNA) 序列 $S$ 中检测内源性转录终止子。该方法基于滑动窗口扫描，并结合了终止子结构的生物物理模型。内源性终止子的特征是一个稳定的发夹结构，其后紧跟着一段富含尿嘧啶的序列。解决方案是通过将这些生物物理标准转化为具体算法而得出的。\n\n首先，我们形式化检测算法。该过程使用一个固定长度为 $W$ 的窗口遍历长度为 $|S|$ 的RNA序列 $S$。窗口从每个可能的索引 $i$ 开始，范围从 $i=0$ 到 $i=|S|-W$。对于每个窗口，我们搜索潜在的终止子结构。\n\n从索引 $i$ 开始的窗口对应子序列 $S_i = S[i:i+W]$。第一步是验证窗口的内容。如果子序列 $S_i$ 包含集合 $\\{\\text{A, C, G, U}\\}$ 之外的任何字符，则该窗口被视为无效并被忽略。\n\n对于一个有效窗口，我们搜索所有可能的候选发夹结构。一个发夹结构由其茎长度 $s$、环长度 $l$ 及其相对于当前窗口起点的起始位置 $j$ 参数化。这些参数受约束：$s \\in [s_{\\min}, s_{\\max}]$ 且 $l \\in [l_{\\min}, l_{\\max}]$。发夹结构由一个左茎（长度 $s$）、一个环（长度 $l$）和一个右茎（长度 $s$）组成。该发夹结构之后是一个长度为 $T$ 的“尾部”区域。整个复合结构（发夹加尾部）必须位于当前窗口内。此结构的总长度为 $2s+l+T$。因此，对于给定的几何形状 $(s, l)$，发夹的相对起始位置 $j$ 的范围可以从 $j=0$ 到 $j=W - (2s+l+T)$。\n\n对于窗口 $S_i$ 内每个有效位置 $j$ 上的每个有效候选发夹几何结构 $(s, l)$，我们应用一个两阶段过滤器：\n\n1.  **尿嘧啶序列段过滤器**：富含U的序列段的主要功能是使RNA-DNA杂合链失稳。我们通过紧跟在发夹结构之后的长度为 $T$ 的尾部区域中尿嘧啶碱基的分数 $f_{\\text{U}}$ 来量化这一点。尾部序列是 $S[i+j+2s+l : i+j+2s+l+T]$。我们计算 $f_{\\text{U}} = n_{\\text{U}}/T$，其中 $n_{\\text{U}}$ 是尾部中 'U' 碱基的计数。只有当 $f_{\\text{U}} \\ge \\theta_U$（其中 $\\theta_U$ 是一个指定的阈值）时，候选结构才是合理的。如果不满足此条件，则丢弃该候选结构。\n\n2.  **热力学稳定性过滤器**：对于通过了尿嘧啶序列段过滤器的候选结构，我们评估其发夹结构的热力学稳定性。稳定性由其折叠的吉布斯自由能 $\\Delta G_{\\text{hairpin}}$ 给出。$\\Delta G$ 越负，意味着发夹结构越稳定。问题提供了一个粗粒度模型：\n    $$\n    \\Delta G_{\\text{hairpin}} = \\Delta G_{\\text{stem}} + \\varepsilon_{\\text{init}} + \\varepsilon_{\\text{loop}}(l)\n    $$\n    各项为：\n    -   $\\Delta G_{\\text{stem}}$：来自茎中碱基配对的能量贡献。问题陈述意味着左茎的第 $k$ 个碱基 $b_{\\text{L}}(k)$ 与右茎的第 $(s-k+1)$ 个碱基 $b_{\\text{R}}(s-k+1)$ 配对。这对应于从茎的外部碱基开始配对，然后向内移动。在实现中使用从0开始的索引，这个总和是 $\\sum_{k=0}^{s-1} \\varepsilon(S[i+j+k], S[i+j+2s+l-1-k])$。能量函数 $\\varepsilon(\\cdot, \\cdot)$ 考虑了Watson-Crick对、摆动对（如果允许）和错配。\n    -   $\\varepsilon_{\\text{init}}$：发夹结构起始的恒定能量罚分，给定值为 $+3.0 \\text{ kcal/mol}$。\n    -   $\\varepsilon_{\\text{loop}}(l)$：依赖于环长度的罚分，用于模拟约束聚合物链的熵成本。其公式为 $\\varepsilon_{\\text{loop}}(l) = \\alpha \\ln(l) + \\beta$，其中 $\\alpha = 1.75$，$\\beta = 0.5$。\n\n检查完窗口内所有可能的候选发夹结构 $(s, l, j)$ 后，我们在所有通过 $f_{\\text{U}}$ 过滤器的候选结构中找到最小自由能 $\\min(\\Delta G_{\\text{hairpin}})$。如果这个最小能量小于或等于一个稳定性阈值，即 $\\min(\\Delta G_{\\text{hairpin}}) \\le \\theta_G$，那么该窗口最终被标记为预测的终止子位点。每个测试用例的最终输出是此类被标记窗口的总数。\n\n**关于假阳性的讨论**：\n双重标准方法对于确保特异性和减少假阳性至关重要。\n仅仅依赖稳定的发夹结构 ($\\Delta G_{\\text{hairpin}} \\le \\theta_G$) 是不够的。RNA分子会折叠成许多稳定的二级结构，这些结构服务于转录终止以外的功能（例如，核酶催化、核糖开关的配体结合、蛋白质识别）。任何足够长的回文序列都可以形成稳定的发夹结构。因此，仅使用低 $\\Delta G$ 标准会标记许多并非终止子的功能性结构。\n\n相反地，仅仅依赖富含尿嘧啶的序列段 ($f_{\\text{U}} \\ge \\theta_U$) 也是不充分的。多聚U序列段（或DNA中的多聚T序列段）可能偶然出现，并且它们本身并不能有效地导致终止。内源性终止的生物物理模型要求RNA聚合酶暂停，而这种暂停是由上游发夹结构的形成诱导的。这种暂停提供了一个时间窗口，在此期间RNA-DNA杂合链中较弱的rU-dA碱基对可以解离，从而导致转录本的释放。\n\n通过结合这两个标准——一个稳定的发夹结构**紧随其后**的是一个富含U的序列段——该算法特异性地靶向内源性终止子的经典结构基序。这通过过滤掉以下情况，显著降低了假阳性率：1. 缺少富含U尾部的稳定发夹结构。2. 前面没有能够诱导聚合酶暂停的发夹结构的富含U的序列段。\n\n尽管有此改进，该模型仍是一种简化，假阳性仍然可能出现。发夹结构的体内稳定性受到模型未包含的因素影响，例如温度、离子强度以及对碱基堆积能的最近邻效应。此外，细胞内的终止效率受到其他蛋白质（例如，NusA）和转录局部环境的调节，这些都未被此基于序列的算法所捕捉。阈值 $\\theta_G$ 和 $\\theta_U$ 的选择代表了在灵敏度（找到真正的终止子）和特异性（避免假阳性）之间的关键权衡。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the terminator scan on all test cases.\n    \"\"\"\n\n    # Define base pairing energy maps\n    base_energies_no_wobble = {\n        ('A', 'U'): -2.1, ('U', 'A'): -2.1,\n        ('G', 'C'): -3.4, ('C', 'G'): -3.4,\n    }\n    base_energies_wobble = {\n        **base_energies_no_wobble,\n        ('G', 'U'): -0.9, ('U', 'G'): -0.9,\n    }\n    mismatch_penalty = 1.0\n    init_penalty = 3.0\n    alpha_loop = 1.75\n    beta_loop = 0.5\n    \n    valid_chars = {'A', 'C', 'G', 'U'}\n\n    def calculate_flagged_windows(S, W, s_min, s_max, l_min, l_max, T, theta_G, theta_U, wobble_allowed):\n        \"\"\"\n        Scans an RNA sequence for terminators and returns the count of flagged windows.\n        \"\"\"\n        energy_map = base_energies_wobble if wobble_allowed else base_energies_no_wobble\n        flagged_count = 0\n        \n        num_windows = len(S) - W + 1\n        if num_windows = 0:\n            return 0\n        \n        for i in range(num_windows):\n            window_seq = S[i : i + W]\n            \n            # Rule: Ignore windows with non-standard bases\n            if not set(window_seq).issubset(valid_chars):\n                continue\n                \n            min_G_in_window = float('inf')\n            \n            # Iterate through all possible hairpin geometries\n            for s in range(s_min, s_max + 1):\n                for l in range(l_min, l_max + 1):\n                    \n                    # Total length of hairpin + tail must be within the window\n                    structure_len = 2 * s + l + T\n                    if structure_len > W:\n                        continue\n                    \n                    # Iterate through all possible start positions j within the window\n                    max_j = W - structure_len\n                    for j in range(max_j + 1):\n                        \n                        # Step 1: Check U-tract filter\n                        tail_start_abs = i + j + 2 * s + l\n                        tail_end_abs = tail_start_abs + T\n                        tail = S[tail_start_abs:tail_end_abs]\n                        \n                        n_U = tail.count('U')\n                        f_U = n_U / T if T > 0 else 0\n                        \n                        if f_U >= theta_U:\n                            # Step 2: Calculate Gibbs free energy for the hairpin\n                            # Extract stem sequences\n                            left_stem_start_abs = i + j\n                            left_stem = S[left_stem_start_abs : left_stem_start_abs + s]\n                            \n                            right_stem_start_abs = i + j + s + l\n                            right_stem = S[right_stem_start_abs : right_stem_start_abs + s]\n                            \n                            # Calculate stem energy\n                            delta_G_stem = 0.0\n                            for k in range(s):\n                                pair = (left_stem[k], right_stem[s - 1 - k])\n                                delta_G_stem += energy_map.get(pair, mismatch_penalty)\n                            \n                            # Calculate loop penalty\n                            loop_penalty = alpha_loop * np.log(l) + beta_loop\n                            \n                            # Calculate total hairpin energy\n                            total_G = delta_G_stem + init_penalty + loop_penalty\n                            \n                            min_G_in_window = min(min_G_in_window, total_G)\n                            \n            # Check if the window is flagged\n            if min_G_in_window = theta_G:\n                flagged_count += 1\n                \n        return flagged_count\n\n    # Test cases from the problem statement\n    test_cases = [\n        {\n            \"S\": \"AUGGCCGCAACGACGGAUCCGAACGUGGAGCGCGAAAAUCGCGCUUUUUUUGGAACGCCGAAGGCUACGGA\",\n            \"W\": 40, \"s_min\": 4, \"s_max\": 8, \"l_min\": 3, \"l_max\": 8, \"T\": 7,\n            \"theta_G\": -9.0, \"theta_U\": 0.8, \"wobble\": True,\n        },\n        {\n            \"S\": \"AUGGAGGCCGAAUCGGACGU\" + \"AAAAAAAAAUUUUUUUUUUUGGG\" + \"GCAAGCUAGCGGAACUCGGA\",\n            \"W\": 36, \"s_min\": 4, \"s_max\": 8, \"l_min\": 3, \"l_max\": 6, \"T\": 10,\n            \"theta_G\": -7.1, \"theta_U\": 0.7, \"wobble\": False,\n        },\n        {\n            \"S\": \"GGAUGCGGCGGCCGCAAUGGA\" + \"GCGCGAAAAUCGCGCGGGGGGG\" + \"CCGGAUCGAGGCCGGAUCGG\",\n            \"W\": 40, \"s_min\": 4, \"s_max\": 8, \"l_min\": 3, \"l_max\": 8, \"T\": 7,\n            \"theta_G\": -9.0, \"theta_U\": 0.8, \"wobble\": True,\n        },\n        {\n            \"S\": \"AUGGCCGUAANCCGAU\" + \"GCGCGAAAAUCGCGCUUUUUUU\" + \"GGAACGU\",\n            \"W\": 40, \"s_min\": 4, \"s_max\": 8, \"l_min\": 3, \"l_max\": 8, \"T\": 7,\n            \"theta_G\": -9.0, \"theta_U\": 0.8, \"wobble\": True,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_flagged_windows(\n            S=case[\"S\"], W=case[\"W\"], \n            s_min=case[\"s_min\"], s_max=case[\"s_max\"],\n            l_min=case[\"l_min\"], l_max=case[\"l_max\"],\n            T=case[\"T\"], theta_G=case[\"theta_G\"], theta_U=case[\"theta_U\"],\n            wobble_allowed=case[\"wobble\"]\n        )\n        results.append(result)\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2727089"}]}