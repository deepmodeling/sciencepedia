{"hands_on_practices": [{"introduction": "确定性模型是理解基因回路动力学行为的基石。通过使用基于质量作用定律的常微分方程（ODE），我们可以预测大量分子系统在宏观尺度上的平均行为。本次练习将引导你分析一个经典的转录起始模型，通过求解系统的稳态来掌握确定性分析的核心技能([@problem_id:2728827])。这项实践对于从基本反应速率推断基因回路的长期平均输出至关重要。", "problem": "考虑一个单拷贝细菌启动子，在确定性质量作用动力学下，通过三态转录起始循环驱动蛋白质的表达。启动子状态包括：游离启动子、闭合复合物和开放复合物。RNA聚合酶（RNAP）的结合和异构化步骤被明确建模；有效起始会产生一个信使核糖核酸（mRNA），并使启动子返回到游离状态，将RNAP释放回溶液中。假设混合均匀，且由于RNAP相对于启动子过量，其总浓度恒定。\n\n启动子状态的反应方案如下：\n- 游离启动子 $F$ 与RNAP $R$ 结合形成闭合复合物 $C$：$F + R \\xrightarrow{k_1} C$。\n- 闭合复合物解离：$C \\xrightarrow{k_{-1}} F + R$。\n- 闭合复合物异构化为开放复合物 $O$：$C \\xrightarrow{k_2} O$。\n- 开放复合物逆转为闭合复合物：$O \\xrightarrow{k_{-2}} C$。\n- 开放复合物经历有效起始，产生一个mRNA并重置启动子：$O \\xrightarrow{k_3} F + R + \\text{mRNA}$。\n\n设启动子总浓度为 $[G_{\\mathrm{tot}}]$，其中 $[F] + [C] + [O] = [G_{\\mathrm{tot}}]$。设 $[R]$ 为恒定的RNAP浓度。mRNA和蛋白质的动力学如下：\n- mRNA的产生速率等于 $k_3 [O]$。mRNA以一级速率常数 $\\gamma_m$ 降解。\n- 蛋白质从mRNA翻译而来，一级速率常数为 $k_{\\mathrm{tl}}$，并以一级速率常数 $\\gamma_p$ 被稀释/降解。\n\n从质量作用定律和质量守恒出发，通过求解启动子状态的稳态平衡，推导出稳态开放复合物浓度 $[O]^*$，用 $k_1, k_{-1}, k_2, k_{-2}, k_3, [R]$ 和 $[G_{\\mathrm{tot}}]$ 表示。然后，使用 $[O]^*$ 计算稳态蛋白质浓度 $[P]^*$。\n\n使用以下科学上合理的参数值：\n- $k_1 = 1.0 \\times 10^{-3}$ (nM$^{-1}$ s$^{-1}$)\n- $k_{-1} = 0.1$ (s$^{-1}$)\n- $k_2 = 10$ (s$^{-1}$)\n- $k_{-2} = 1$ (s$^{-1}$)\n- $k_3 = 0.5$ (s$^{-1}$)\n- $[R] = 1000$ (nM)\n- $[G_{\\mathrm{tot}}] = 1$ (nM)\n- $\\gamma_m = 2.0 \\times 10^{-3}$ (s$^{-1}$)\n- $k_{\\mathrm{tl}} = 3.0 \\times 10^{-2}$ (s$^{-1}$)\n- $\\gamma_p = 2.0 \\times 10^{-4}$ (s$^{-1}$)\n\n将最终的稳态蛋白质浓度 $[P]^*$ 以微摩尔（micromolar）为单位表示。将答案四舍五入到三位有效数字。", "solution": "问题陈述经过验证，被认为是科学上合理的、适定的和客观的。它描述了一个使用确定性质量作用动力学的标准基因表达模型，这是定量生物学中的一个基本方法。所有必要的参数和约束都已提供，不存在矛盾或模糊之处。因此，我们进行严谨的求解推导。\n\n启动子状态——游离态 ($[F]$)、闭合复合物 ($[C]$) 和开放复合物 ($[O]$)——的动力学由一组基于质量作用定律的常微分方程（ODE）描述。RNA聚合酶的浓度 $[R]$ 假定为常数。\n\n$$\n\\frac{d[F]}{dt} = -k_1 [F][R] + k_{-1}[C] + k_3[O]\n$$\n$$\n\\frac{d[C]}{dt} = k_1 [F][R] - (k_{-1} + k_2)[C] + k_{-2}[O]\n$$\n$$\n\\frac{d[O]}{dt} = k_2[C] - (k_{-2} + k_3)[O]\n$$\n\n启动子的总浓度 $[G_{\\mathrm{tot}}]$ 是守恒的：\n$$\n[F] + [C] + [O] = [G_{\\mathrm{tot}}]\n$$\n\n为了求稳态浓度，我们将时间导数设为零。用星号 ($*$) 表示稳态浓度。从 $[O]$ 的常微分方程，我们得到：\n$$\n0 = k_2[C]^* - (k_{-2} + k_3)[O]^*\n$$\n这使我们能够用 $[O]^*$ 来表示 $[C]^*$：\n$$\n[C]^* = \\frac{k_{-2} + k_3}{k_2} [O]^*\n$$\n\n接着，从 $[C]$ 的稳态常微分方程，我们得到：\n$$\n0 = k_1 [F]^*[R] - (k_{-1} + k_2)[C]^* + k_{-2}[O]^*\n$$\n代入 $[C]^*$ 的表达式，我们可以解出用 $[O]^*$ 表示的 $[F]^*$：\n$$\nk_1 [F]^*[R] = (k_{-1} + k_2)[C]^* - k_{-2}[O]^* = (k_{-1} + k_2)\\left(\\frac{k_{-2} + k_3}{k_2}\\right)[O]^* - k_{-2}[O]^*\n$$\n$$\nk_1 [F]^*[R] = \\frac{(k_{-1} + k_2)(k_{-2} + k_3) - k_2 k_{-2}}{k_2} [O]^* = \\frac{k_{-1}k_{-2} + k_{-1}k_3 + k_2 k_3}{k_2} [O]^*\n$$\n$$\n[F]^* = \\frac{k_{-1}k_{-2} + k_{-1}k_3 + k_2 k_3}{k_1 k_2 [R]} [O]^*\n$$\n\n现在，我们应用总启动子浓度的守恒定律：\n$$\n[F]^* + [C]^* + [O]^* = [G_{\\mathrm{tot}}]\n$$\n代入 $[F]^*$ 和 $[C]^*$ 的表达式，得到一个只含 $[O]^*$ 的方程：\n$$\n\\left( \\frac{k_{-1}k_{-2} + k_{-1}k_3 + k_2 k_3}{k_1 k_2 [R]} \\right)[O]^* + \\left( \\frac{k_{-2} + k_3}{k_2} \\right)[O]^* + [O]^* = [G_{\\mathrm{tot}}]\n$$\n提出因子 $[O]^*$ 并求解，得到稳态开放复合物浓度：\n$$\n[O]^* \\left( \\frac{k_{-1}k_{-2} + k_{-1}k_3 + k_2 k_3 + k_1[R](k_{-2}+k_3) + k_1k_2[R]}{k_1 k_2 [R]} \\right) = [G_{\\mathrm{tot}}]\n$$\n$$\n[O]^* = \\frac{[G_{\\mathrm{tot}}] k_1 k_2 [R]}{k_{-1}k_{-2} + k_{-1}k_3 + k_2 k_3 + k_1[R](k_{-2}+k_3) + k_1k_2[R]}\n$$\n\nmRNA ($[m]$) 和蛋白质 ($[P]$) 浓度的动力学由以下方程给出：\n$$\n\\frac{d[m]}{dt} = k_3 [O] - \\gamma_m [m]\n$$\n$$\n\\frac{d[P]}{dt} = k_{\\mathrm{tl}} [m] - \\gamma_p [P]\n$$\n在稳态时，它们的时间导数也为零。\n从mRNA方程：\n$$\nk_3 [O]^* = \\gamma_m [m]^* \\implies [m]^* = \\frac{k_3}{\\gamma_m} [O]^*\n$$\n从蛋白质方程：\n$$\nk_{\\mathrm{tl}} [m]^* = \\gamma_p [P]^* \\implies [P]^* = \\frac{k_{\\mathrm{tl}}}{\\gamma_p} [m]^*\n$$\n代入 $[m]^*$ 的表达式，我们得到用 $[O]^*$ 表示的稳态蛋白质浓度 $[P]^*$：\n$$\n[P]^* = \\frac{k_{\\mathrm{tl}}}{\\gamma_p} \\left( \\frac{k_3}{\\gamma_m} [O]^* \\right) = \\frac{k_{\\mathrm{tl}} k_3}{\\gamma_p \\gamma_m} [O]^*\n$$\n通过代入 $[O]^*$ 的完整表达式，我们得到了 $[P]^*$ 的最终解析解。\n\n我们现在代入所提供的参数值：\n$k_1 = 1.0 \\times 10^{-3}$ nM$^{-1}$ s$^{-1}$，$k_{-1} = 0.1$ s$^{-1}$，$k_2 = 10$ s$^{-1}$，$k_{-2} = 1$ s$^{-1}$，$k_3 = 0.5$ s$^{-1}$，$[R] = 1000$ nM，$ [G_{\\mathrm{tot}}] = 1$ nM，$\\gamma_m = 2.0 \\times 10^{-3}$ s$^{-1}$，$k_{\\mathrm{tl}} = 3.0 \\times 10^{-2}$ s$^{-1}$，以及 $\\gamma_p = 2.0 \\times 10^{-4}$ s$^{-1}$。\n\n首先，我们计算 $[O]^*$ 表达式的分母：\n项 $k_1[R] = (1.0 \\times 10^{-3}) \\times 1000 = 1.0$ s$^{-1}$。\n分母为 $D = k_{-1}k_{-2} + k_{-1}k_3 + k_2 k_3 + k_1[R](k_{-2}+k_3) + k_1[R]k_2$。\n$D = (0.1)(1) + (0.1)(0.5) + (10)(0.5) + (1.0)(1 + 0.5) + (1.0)(10)$\n$D = 0.1 + 0.05 + 5.0 + 1.5 + 10.0 = 16.65$ s$^{-2}$。\n\n接下来，我们计算 $[O]^*$ 表达式的分子：\n$N_O = [G_{\\mathrm{tot}}] k_1 k_2 [R] = (1) \\times (1.0 \\times 10^{-3}) \\times (10) \\times (1000) = 10$ nM s$^{-2}$。\n\n稳态开放复合物浓度为：\n$$\n[O]^* = \\frac{N_O}{D} = \\frac{10}{16.65} \\text{ nM}\n$$\n\n最后，我们计算稳态蛋白质浓度 $[P]^*$：\n$$\n[P]^* = \\frac{k_{\\mathrm{tl}} k_3}{\\gamma_p \\gamma_m} [O]^* = \\frac{(3.0 \\times 10^{-2})(0.5)}{(2.0 \\times 10^{-4})(2.0 \\times 10^{-3})} \\times \\frac{10}{16.65} \\text{ nM}\n$$\n$$\n[P]^* = \\frac{1.5 \\times 10^{-2}}{4.0 \\times 10^{-7}} \\times \\frac{10}{16.65} \\text{ nM} = 37500 \\times \\frac{10}{16.65} \\text{ nM}\n$$\n$$\n[P]^* = \\frac{375000}{16.65} \\text{ nM} \\approx 22522.52 \\text{ nM}\n$$\n\n问题要求最终答案以微摩尔（$\\mu$M）为单位。由于 $1$ $\\mu$M $= 1000$ nM，我们必须将结果除以 $1000$：\n$$\n[P]^* \\approx \\frac{22522.52}{1000} \\text{ } \\mu\\text{M} \\approx 22.52252 \\text{ } \\mu\\text{M}\n$$\n按要求四舍五入到三位有效数字，得到最终答案。\n$$\n[P]^* \\approx 22.5 \\text{ } \\mu\\text{M}\n$$", "answer": "$$\n\\boxed{22.5}\n$$", "id": "2728827"}, {"introduction": "尽管确定性模型描述了平均行为，但真实的生物系统本质上是随机的。分子噪声不仅仅是干扰，它还能驱动关键的生物决策，例如细胞命运的选择。这个思想实验将探讨一个经典的双稳态“拨动开关”回路，让你比较确定性模型和随机模型在系统从一个不稳定的平衡点出发时的预测([@problem_id:1492568])。通过这个练习，你将深刻理解内在噪声在打破对称性、驱动系统走向多个可能稳态之一的关键作用——这是一个确定性模型完全忽略的概念。", "problem": "考虑一个用于对称基因触发开关的简化模型，这是合成生物学中的一个基本电路。该系统包含两种蛋白质U和V，它们相互抑制对方的合成。其浓度（用 $u(t)$ 和 $v(t)$ 表示）的动态变化可以用一组确定性常微分方程来描述：\n\n$$\n\\frac{du}{dt} = \\frac{\\alpha}{1 + v^n} - \\gamma u\n$$\n$$\n\\frac{dv}{dt} = \\frac{\\alpha}{1 + u^n} - \\gamma v\n$$\n\n其中，$\\alpha > 0$ 是最大生产速率，$\\gamma > 0$ 是一阶降解速率常数，Hill系数 $n > 1$ 量化了抑制的强度。对于这些参数的某些选择，该系统是双稳态的，拥有两个不同的稳定稳态，分别对应于一种蛋白质高表达而另一种蛋白质被抑制的情况，例如（高 $u$，低 $v$）和（低 $u$，高 $v$）。除了这两个稳定状态，还存在一个单一的不稳定稳态 $(u^*, v^*)$，它是对称的，满足 $u^* = v^*$。\n\n想象我们可以将系统恰好初始化在这个不稳定稳态上，即 $(u(0), v(0)) = (u^*, v^*)$。我们希望比较由两种不同建模范式所预测的长期行为（当 $t \\to \\infty$ 时）：\n\n1.  一个**确定性模型**，该模型由上述精确的微分方程控制。\n2.  一个**随机模型**，该模型将单个的合成和降解事件视为离散的随机过程。该模型内在地包含了内在分子噪声的影响。\n\n从不稳定稳态开始，下列哪个陈述最准确地对比了这两种模型的长期预测？\n\nA. 确定性模型和随机模型都预测系统将无限期地保持在不稳定稳态 $(u^*, v^*)$。\n\nB. 确定性模型预测系统将演化到一个两种浓度都为零的状态，即 $(u,v) = (0,0)$。随机模型预测系统将移动到两个稳定状态之一。\n\nC. 确定性模型预测系统将无限期地保持在 $(u^*, v^*)$。与此相反，随机模型预测由于内在噪声，系统将不可避免地被推离这个点，并以相等的概率向两个稳定状态之一演化。\n\nD. 随机模型预测系统将无限期地保持在 $(u^*, v^*)$。与此相反，确定性模型预测系统将演化到两个稳定状态之一。\n\nE. 两种模型都预测系统将以相等的概率向两个稳定稳态之一演化。", "solution": "我们分析由以下方程定义的确定性动力学\n$$\n\\frac{du}{dt} = \\frac{\\alpha}{1 + v^{n}} - \\gamma u, \\qquad\n\\frac{dv}{dt} = \\frac{\\alpha}{1 + u^{n}} - \\gamma v,\n$$\n其中参数 $\\alpha0$, $\\gamma0$ 且 $n1$。一个稳态 $(u^{*},v^{*})$ 满足\n$$\n\\frac{\\alpha}{1 + (v^{*})^{n}} - \\gamma u^{*} = 0, \\qquad\n\\frac{\\alpha}{1 + (u^{*})^{n}} - \\gamma v^{*} = 0.\n$$\n根据对称性，不稳定稳态满足 $u^{*}=v^{*}$，因此解出\n$$\n\\gamma u^{*} = \\frac{\\alpha}{1 + (u^{*})^{n}}.\n$$\n对于确定性模型，其控制向量场是光滑的，因此根据 Picard–Lindelöf 定理，对于任何初始条件，初值问题都有唯一解。如果初始条件等于一个平衡点，即 $(u(0),v(0))=(u^{*},v^{*})$ 且 $f(u^{*},v^{*})=(0,0)$，那么常数轨迹 $(u(t),v(t)) \\equiv (u^{*},v^{*})$ 满足微分方程，并且根据唯一性，是唯一的解。因此，确定性模型预测，从 $(u^{*},v^{*})$ 精确开始，系统将在所有 $t \\geq 0$ 的时间内保持在该点，尽管该平衡点对于扰动是不稳定的。\n\n为了刻画这种不稳定性，我们在 $(u^{*},v^{*})$ 附近进行线性化。雅可比矩阵是\n$$\nJ(u,v) =\n\\begin{pmatrix}\n\\frac{\\partial}{\\partial u}\\left(\\frac{\\alpha}{1+v^{n}} - \\gamma u\\right)  \\frac{\\partial}{\\partial v}\\left(\\frac{\\alpha}{1+v^{n}} - \\gamma u\\right) \\\\\n\\frac{\\partial}{\\partial u}\\left(\\frac{\\alpha}{1+u^{n}} - \\gamma v\\right)  \\frac{\\partial}{\\partial v}\\left(\\frac{\\alpha}{1+u^{n}} - \\gamma v\\right)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-\\gamma  -\\alpha \\frac{n v^{n-1}}{(1+v^{n})^{2}} \\\\\n-\\alpha \\frac{n u^{n-1}}{(1+u^{n})^{2}}  -\\gamma\n\\end{pmatrix}.\n$$\n在 $u^{*}=v^{*}$ 处，非对角线项相等，因此设\n$$\nk \\equiv \\alpha \\frac{n (u^{*})^{n-1}}{(1+(u^{*})^{n})^{2}},\n$$\n我们有\n$$\nJ(u^{*},v^{*}) =\n\\begin{pmatrix}\n-\\gamma  -k \\\\\n-\\,k  -\\gamma\n\\end{pmatrix}.\n$$\n特征值为 $\\lambda_{1}=-\\gamma-k$ 和 $\\lambda_{2}=-\\gamma+k$。在双稳态区域，一个特征值为正，即 $-\\gamma + k > 0$，这使得 $(u^{*},v^{*})$ 成为一个不稳定的鞍点：无穷小的扰动通常会沿着不稳定的特征方向离开该平衡点。然而，在没有任何扰动且精确地从平衡点开始的情况下，确定性轨迹会无限期地停留在 $(u^{*},v^{*})$。\n\n与此相反，随机模型将合成和降解视为离散的随机事件，这些事件由倾向性函数控制，在对应于 $(u^{*},v^{*})$ 的浓度下，这些倾向性函数不为零。因此，不存在与确定性不稳定稳态相对应的吸收随机状态。内在噪声产生的波动会立即将系统从由 $u=v$ 定义的分界线上移开。由于系统和初始条件是对称的，这些波动相对于两个吸引盆是无偏的。因此，随机动力学将以相等的概率向两个稳定稳态中任意一个的邻域移动。在足够长的时间和有限系统中，可能会发生罕见的由噪声引起的在两个稳定状态之间的转换，但从不稳定不动点开始的直接推论是，内在噪声驱动系统逃离该点，并且根据对称性，两种结果以相等的概率发生。\n\n因此，正确的对比是：确定性模型无限期地保持在 $(u^{*},v^{*})$，而随机模型由于内在噪声会离开这个点，并以相等的概率演化到两个稳定状态之一。\n\n最准确的选项是C。", "answer": "$$\\boxed{C}$$", "id": "1492568"}, {"introduction": "为了真正理解和预测随机性带来的后果，我们需要能够对其进行精确仿真的工具。Daniel T. Gillespie 的随机模拟算法（Stochastic Simulation Algorithm, SSA）提供了一种精确生成化学反应系统轨迹的方法，能够逐个反应地追踪系统演化。本次编程练习将应用SSA于之前探讨的拨动开关模型，研究其在瞬时信号下的响应([@problem_id:2630111])。通过亲手实现这个仿真，你将获得第一手经验，模拟环境信号和内在噪声如何相互作用，共同控制表型转换的概率和时间，这是理解发育可塑性的一个核心方面。", "problem": "一个双稳态基因调控网络可以通过两个转录因子之间的相互抑制，产生离散的可替代表型（多表型）。当一个瞬时环境输入使系统偏向某个稳定状态时，就会出现发育可塑性。考虑一个相互抑制的拨动开关的最小模型，该模型包含两种分子种类，用$X$和$Y$表示（分子拷贝数），并具有合成和一级降解反应。有效合成倾向通过希尔函数被拮抗物所抑制，而一个环境脉冲会瞬时增加$X$的合成倾向。目标是使用Daniel T. Gillespie的随机模拟算法（SSA）进行精确的随机模拟，计算响应瞬时脉冲时进入$X$-高表达状态的首次通过转换时间的分布，并按参数集进行总结。\n\n基本原理：\n- 化学主方程（CME）：在恒定体积和温度下，一个充分混合系统的反应事件遵循一个连续时间马尔可夫过程，其倾向依赖于状态。精确的样本路径由随机模拟算法（SSA）生成。\n- 对于给定状态，到下一次反应的等待时间呈指数分布，其速率等于总倾向，而反应类型的选择与其倾向成正比。\n- 希尔抑制是基因调控中一个经过充分检验的现象学规则：拮抗物（拷贝数为$Z$）对目标合成速率的抑制被建模为$1/\\left(1+\\left(Z/K\\right)^n\\right)$，其中$K$是解离参数，$n$是希尔系数。\n\n模型详述：\n- 物种：$X$，$Y$（非负整数，分子）。\n- 在时间$t$和状态$\\left(X,Y\\right)$下的反应和倾向：\n  - $R_1$：$X \\to X+1$，倾向为\n    $$ a_1\\left(X,Y,t\\right) \\;=\\; \\frac{k_X\\left(t\\right)}{1+\\left(\\frac{Y}{K}\\right)^n}。$$\n  - $R_2$：$X \\to X-1$，倾向为\n    $$ a_2\\left(X,Y,t\\right) \\;=\\; d_X \\, X。$$\n  - $R_3$：$Y \\to Y+1$，倾向为\n    $$ a_3\\left(X,Y,t\\right) \\;=\\; \\frac{k_Y}{1+\\left(\\frac{X}{K}\\right)^n}。$$\n  - $R_4$：$Y \\to Y-1$，倾向为\n    $$ a_4\\left(X,Y,t\\right) \\;=\\; d_Y \\, Y。$$\n- 环境脉冲：\n  $$ k_X\\left(t\\right) \\;=\\; \\begin{cases}\n  p \\, k_{X,0}  \\text{若 } 0 \\le t  T_p,\\\\\n  k_{X,0}  \\text{若 } t \\ge T_p,\n  \\end{cases} $$\n  其中脉冲因子$p \\ge 1$，脉冲持续时间$T_p$（每个测试案例中指定）。参数$k_Y$不随时间变化。\n- 初始条件：$t=0$，$X\\left(0\\right)=X_0$，$Y\\left(0\\right)=Y_0$，且$X_0 - Y_0 \\le -h$（即，初始位于$Y$-高表达盆地，并有一个裕度$h$）。\n- 转换时间定义（首次通过）：转换时间$\\tau$是使得$X\\left(t\\right) - Y\\left(t\\right) \\ge h$成立的第一个时间$t$，其中$h$是一个正阈值（单位：分子）。如果在最大模拟时间$T_{\\max}$之前没有这样的时间发生，则该次运行被视为未转换。\n\n单位：\n- 时间单位为分钟，反应速率常数$k_{X,0}$、$k_Y$的单位为分子/分钟，降解常数$d_X$、$d_Y$的单位为/分钟，$K$和$h$的单位为分子。输出的平均转换时间必须以分钟报告。转换轨迹的比例必须以小数形式报告（而非百分比）。\n\n计算方案：\n- 对每个参数集（测试案例），模拟$N$个独立的SSA轨迹，每个轨迹直到时间$T_{\\max}$或发生转换为止。设$M$为发生转换的轨迹数量。计算：\n  - 转换比例$f = M/N$（小数）。\n  - 平均转换时间$\\bar{\\tau} = \\left(\\sum_{i=1}^{M} \\tau_i\\right)/M$，单位为分钟，仅对发生转换的轨迹进行计算。如果$M=0$，按惯例定义$\\bar{\\tau} = -1.0$。\n- 随机性控制：使用固定的基础种子$s_0$以保证可复现性，并为每个轨迹使用独立的流。对于测试案例索引$i$（从$0$开始）和重复实验索引$j$（从$0$开始），使用以下公式为该次重复实验的伪随机数生成器设定种子：\n  $$ s_{i,j} \\;=\\; s_0 \\;+\\; 104729\\, i \\;+\\; 10007\\, j, $$\n  其中$104729$和$10007$是固定整数。SSA使用的所有均匀分布随机变量必须从此带种子的流中生成。\n- 四舍五入：报告的$f$和$\\bar{\\tau}$四舍五入到三位小数。\n\n测试套件：\n使用以下四个参数集，每个参数集有$N=64$次重复实验，基础种子$s_0 = 1357911$。所有案例中未明确变化的参数均相同。具体如下：\n- 所有案例的共享参数：\n  - $k_{X,0} = 12.0$ 分子/分钟，\n  - $k_Y = 12.0$ 分子/分钟，\n  - $d_X = 0.2$ /分钟，\n  - $d_Y = 0.2$ /分钟，\n  - $K = 40$ 分子，\n  - $n = 2$（无量纲的希尔系数），\n  - $h = 20$ 分子，\n  - $X_0 = 10$ 分子，\n  - $Y_0 = 90$ 分子，\n  - $T_{\\max} = 200.0$ 分钟，\n  - $N = 64$，\n  - $s_0 = 1357911$。\n- 案例$0$（理想情况）：$p = 3.0$，$T_p = 10.0$ 分钟。\n- 案例$1$（边界/弱脉冲）：$p = 1.5$，$T_p = 10.0$ 分钟。\n- 案例$2$（无脉冲对照）：$p = 1.0$，$T_p = 0.0$ 分钟。\n- 案例$3$（强/短脉冲）：$p = 4.0$，$T_p = 5.0$ 分钟。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含按$0,1,2,3$顺序排列的案例结果，形式为逗号分隔的$\\left[f,\\bar{\\tau}\\right]$对列表，并用方括号括起来，不含任何空白字符。例如，语法形式必须是\n  $$\\left[\\left[f_0,\\bar{\\tau}_0\\right],\\left[f_1,\\bar{\\tau}_1\\right],\\left[f_2,\\bar{\\tau}_2\\right],\\left[f_3,\\bar{\\tau}_3\\right]\\right],$$\n  其中$f_i$和$\\bar{\\tau}_i$都四舍五入到三位小数，如果在案例$i$中未观察到转换，则$\\bar{\\tau}_i$等于$-1.0$。", "solution": "我们基于化学主方程（CME）和随机模拟算法（SSA）的基本原理，为一个受瞬时环境脉冲影响的双稳态拨动开关推导了一种精确的随机模拟方法和一个可计算的首次通过转换时间的定义。\n\n双稳态和环境控制的原理性建模：\n- 在恒温且充分混合的体积中，CME对分子数量概率分布的时间演化进行建模。每个反应通道都是一个泊松过程，其瞬时风险率等于其倾向。精确的样本路径可以通过Daniel T. Gillespie的SSA生成。\n- 相互抑制通过希尔型抑制来体现。如果物种$Y$抑制$X$，那么$X$的有效合成速率为$k_X\\left(t\\right)\\,/\\left(1+\\left(\\frac{Y}{K}\\right)^n\\right)$，其中$K$是解离参数，$n$是希尔系数。在确定性模拟中，足够强的非线性可以导致双稳态；而在随机设定下，系统表现出对应于$X$主导和$Y$主导表型的亚稳态。这为多表型提供了定量基础：环境可以瞬时修改参数以偏向某个状态的占据。\n- 在此模型中，环境以瞬时脉冲的形式作用，在$0 \\le t  T_p$的时间窗口内将$X$的合成倾向乘以一个因子$p$。\n\n反应系统和倾向：\n- 我们为$X$和$Y$各建立合成与降解两个反应，共四个反应。\n- 在状态$\\left(X,Y\\right)$和时间$t$时的倾向为\n  $$ a_1\\left(X,Y,t\\right) \\;=\\; \\frac{k_X\\left(t\\right)}{1+\\left(\\frac{Y}{K}\\right)^n}, \\quad a_2\\left(X,Y,t\\right) \\;=\\; d_X X, $$\n  $$ a_3\\left(X,Y,t\\right) \\;=\\; \\frac{k_Y}{1+\\left(\\frac{X}{K}\\right)^n}, \\quad a_4\\left(X,Y,t\\right) \\;=\\; d_Y Y, $$\n  其中当$0 \\le t  T_p$时，$k_X\\left(t\\right) = p\\,k_{X,0}$，否则$k_X\\left(t\\right) = k_{X,0}$。希尔系数$n$是无量纲的，$K$的单位是分子，与作为离散计数的$X$和$Y$保持一致。\n\n精确随机模拟（Gillespie SSA）：\n- 给定倾向$a_1,\\dots,a_4$，总倾向为$a_0 = \\sum_{r=1}^{4} a_r$。CME意味着到下一次反应的等待时间$\\Delta t$服从速率为$a_0$的指数分布，因此我们可以通过以下方式抽样：\n  $$ \\Delta t \\;=\\; \\frac{1}{a_0} \\ln\\left(\\frac{1}{u_1}\\right), $$\n  其中$u_1 \\sim \\text{Uniform}\\left(0,1\\right)$。通过抽取$u_2 \\sim \\text{Uniform}\\left(0,1\\right)$并选择满足$\\sum_{q=1}^{r} a_q \\ge u_2 a_0$的最小$r$来确定反应索引$r$。根据反应$r$的化学计量变化更新状态，时间推进$\\Delta t$。重复此过程直到满足停止条件。\n- 上述算法对于CME是精确的，因此是抽样转换时间的正确基础。\n\n转换时间的定义和检测：\n- 我们将转换时间定义为从初始状态$X_0 - Y_0 \\le -h$出发，首次到达集合$\\left\\{ \\left(X,Y\\right): X-Y \\ge h \\right\\}$的时间。由于SSA生成的是在反应时刻跳跃的右连续分段常数样本路径，我们在时间$t$的反应更新后，若$X-Y \\ge h$成立，则立即检测到转换。\n- 如果在$T_{\\max}$之前没有发生转换，则该轨迹被归类为未转换。\n\n每个参数集的蒙特卡洛估计：\n- 对每个测试案例，我们运行$N$次独立的重复实验。设$M$为发生转换的重复实验次数，$\\tau_1,\\dots,\\tau_M$为对应的转换时间。我们计算转换比例$f = M/N$和条件平均转换时间$\\bar{\\tau} = \\left(\\sum_{i=1}^M \\tau_i\\right)/M$，单位为分钟。如果$M=0$，我们采用惯例$\\bar{\\tau}=-1.0$以避免未定义的除法。\n- 为确保可复现性和重复实验的独立性，我们为每个重复实验的伪随机数生成器（PRNG）确定性地设定种子。使用固定的基础种子$s_0$和互质的偏移量，我们选择\n  $$ s_{i,j} \\;=\\; s_0 \\;+\\; 104729\\, i \\;+\\; 10007\\, j, $$\n  其中$i \\in \\left\\{0,1,2,3\\right\\}$是测试案例索引，$j \\in \\left\\{0,\\dots,N-1\\right\\}$是重复实验索引。这在保持完全可复现性的同时提供了独立的流。\n\n算法步骤：\n- 对每个案例$i$：\n  - 对每个重复实验$j$：\n    1. 初始化$\\left(t,X,Y\\right) \\leftarrow \\left(0,X_0,Y_0\\right)$；如果$X-Y \\ge h$，记录$\\tau=0$并继续下一个重复实验。\n    2. 循环：\n       - 根据脉冲规则和倾向$a_1,\\dots,a_4$计算$k_X\\left(t\\right)$。\n       - 计算$a_0 = \\sum_{r=1}^4 a_r$。\n       - 使用种子为$s_{i,j}$的PRNG从均匀分布$\\text{Uniform}\\left(0,1\\right)$中抽取$u_1,u_2$。\n       - 设置$\\Delta t = \\left(1/a_0\\right)\\ln\\left(1/u_1\\right)$，并通过累积和与$u_2 a_0$比较来选择反应$r$。\n       - 更新$\\left(X,Y\\right)$和$t \\leftarrow t + \\Delta t$。\n       - 如果$X-Y \\ge h$，设置$\\tau = t$并停止循环；如果$t \\ge T_{\\max}$，标记为未转换并停止。\n  - 汇总$M$、$f = M/N$和$\\bar{\\tau}$（如果$M=0$，则$\\bar{\\tau}=-1.0$）。\n  - 将$f$和$\\bar{\\tau}$四舍五入到三位小数。\n- 将结果输出为单行：一个包含案例0,1,2,3的四个$\\left[f,\\bar{\\tau}\\right]$对的列表，不含空白字符。\n\n科学真实性及与发育可塑性的联系：\n- 带有希尔抑制的拨动开关是双稳态基因回路的一个已确立的最小模型。基因表达的随机性会引起波动，可能导致概率性转换。一个修改$k_X\\left(t\\right)$的瞬时环境脉冲会暂时改变（势能）景观，使系统偏向$X$-高表达表型。计算出的首次通过时间分布确定了脉冲强度和持续时间如何调节多表型结果。\n- 该测试套件涵盖了一个理想情况（中等脉冲促进频繁转换）、一个边界情况（弱脉冲导致罕见转换）、一个对照（无脉冲，有效测试在设定时间范围内的自发转换），以及一个强/短脉冲（确保快速且频繁的转换）。\n\n测试套件的数值规格：\n- 共享参数：$k_{X,0}=12.0$, $k_Y=12.0$, $d_X=0.2$, $d_Y=0.2$, $K=40$, $n=2$, $h=20$, $X_0=10$, $Y_0=90$, $T_{\\max}=200.0$, $N=64$, $s_0=1357911$。各案例的脉冲参数：\n  - 案例$0$：$p=3.0$, $T_p=10.0$。\n  - 案例$1$：$p=1.5$, $T_p=10.0$。\n  - 案例$2$：$p=1.0$, $T_p=0.0$。\n  - 案例$3$：$p=4.0$, $T_p=5.0$。\n所有时间单位为分钟，速率常数单位酌情为分子/分钟或/分钟，分子计数为无量纲整数。最终输出按指定格式进行。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef hill_repression(z, K, n):\n    # Returns 1 / (1 + (z/K)^n) as a float\n    return 1.0 / (1.0 + (float(z) / float(K)) ** float(n))\n\ndef gillespie_switch_time(params, rng):\n    # Unpack parameters\n    kX0 = params[\"kX0\"]\n    kY = params[\"kY\"]\n    dX = params[\"dX\"]\n    dY = params[\"dY\"]\n    K = params[\"K\"]\n    n = params[\"n\"]\n    p = params[\"pulse_factor\"]\n    Tp = params[\"pulse_duration\"]\n    h = params[\"h\"]\n    Tmax = params[\"Tmax\"]\n    X = int(params[\"X0\"])\n    Y = int(params[\"Y0\"])\n\n    t = 0.0\n\n    # Immediate check: already in X-dominant state by threshold?\n    if X - Y >= h:\n        return 0.0  # switched at time 0\n\n    # Safety cap on maximum reaction events to avoid runaway loops (should not trigger)\n    max_events = 10_000_000\n    event_count = 0\n\n    while t  Tmax and event_count  max_events:\n        # Compute time-dependent kX(t) due to pulse\n        kXt = (p * kX0) if t  Tp else kX0\n\n        # Compute propensities\n        a1 = kXt * hill_repression(Y, K, n)       # X synthesis\n        a2 = dX * X                                # X degradation\n        a3 = kY * hill_repression(X, K, n)         # Y synthesis\n        a4 = dY * Y                                # Y degradation\n\n        a0 = a1 + a2 + a3 + a4\n\n        # If a0 is zero (should not occur with given params), stop\n        if a0 == 0.0:\n            break\n\n        # Draw two uniforms\n        u1 = rng.random()\n        while u1 == 0.0:\n            u1 = rng.random()\n        u2 = rng.random()\n\n        # Time to next event\n        dt = (1.0 / a0) * np.log(1.0 / u1)\n        t_next = t + dt\n\n        # Determine which reaction fires\n        thresh = u2 * a0\n        # Cumulative sum\n        c = a1\n        if thresh  c:\n            # X synthesis\n            X += 1\n        else:\n            c += a2\n            if thresh  c:\n                # X degradation\n                if X > 0:\n                    X -= 1\n            else:\n                c += a3\n                if thresh  c:\n                    # Y synthesis\n                    Y += 1\n                else:\n                    # Y degradation\n                    if Y > 0:\n                        Y -= 1\n\n        # Advance time\n        t = t_next\n        event_count += 1\n\n        # Check switching condition after state update\n        if X - Y >= params[\"h\"]:\n            return t\n\n    # If loop ends without switching before Tmax, return None\n    return None\n\ndef simulate_case(case_params, case_index, N, base_seed):\n    switch_times = []\n    for j in range(N):\n        # Independent, reproducible seed per replicate\n        seed = int(base_seed + 104729 * case_index + 10007 * j)\n        rng = np.random.default_rng(seed)\n        tau = gillespie_switch_time(case_params, rng)\n        if tau is not None:\n            switch_times.append(tau)\n\n    M = len(switch_times)\n    f = M / float(N)\n    if M == 0:\n        mean_tau = -1.0\n    else:\n        mean_tau = float(np.mean(switch_times))\n\n    # Round to three decimals for reporting\n    f_rounded = round(f, 3)\n    mean_tau_rounded = round(mean_tau, 3)\n    return f_rounded, mean_tau_rounded\n\ndef solve():\n    # Shared parameters\n    shared = {\n        \"kX0\": 12.0,        # molecules/min\n        \"kY\": 12.0,         # molecules/min\n        \"dX\": 0.2,          # per min\n        \"dY\": 0.2,          # per min\n        \"K\": 40,            # molecules\n        \"n\": 2,             # Hill coefficient\n        \"h\": 20,            # molecules\n        \"X0\": 10,           # molecules\n        \"Y0\": 90,           # molecules\n        \"Tmax\": 200.0       # minutes\n    }\n\n    # Test suite cases\n    test_cases = [\n        # Case 0: happy path\n        {\n            **shared,\n            \"pulse_factor\": 3.0,\n            \"pulse_duration\": 10.0\n        },\n        # Case 1: boundary/weak pulse\n        {\n            **shared,\n            \"pulse_factor\": 1.5,\n            \"pulse_duration\": 10.0\n        },\n        # Case 2: no pulse control\n        {\n            **shared,\n            \"pulse_factor\": 1.0,\n            \"pulse_duration\": 0.0\n        },\n        # Case 3: strong/brief pulse\n        {\n            **shared,\n            \"pulse_factor\": 4.0,\n            \"pulse_duration\": 5.0\n        }\n    ]\n\n    N = 64\n    base_seed = 1357911\n\n    results = []\n    for i, params in enumerate(test_cases):\n        f, mt = simulate_case(params, i, N, base_seed)\n        results.append((f, mt))\n\n    # Produce exact required format: [[f0,mt0],[f1,mt1],[f2,mt2],[f3,mt3]]\n    out = \"[\" + \",\".join(f\"[{f:.3f},{mt:.3f}]\" for (f, mt) in results) + \"]\"\n    print(out)\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2630111"}]}