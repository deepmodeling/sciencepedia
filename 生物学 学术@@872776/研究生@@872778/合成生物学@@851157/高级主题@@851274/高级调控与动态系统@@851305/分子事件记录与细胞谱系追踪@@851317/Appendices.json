{"hands_on_practices": [{"introduction": "为了定量分析谱系数据，我们首先需要为记录过程本身建立一个数学模型。这个练习将指导你为不可逆的编辑事件构建一个最基本的模型——连续时间马尔可夫过程。这个模型是所有后续分析的基石，它使我们能够用精确的数学语言描述编辑事件随时间累积的动态。[@problem_id:2752006]", "problem": "在用于细胞谱系追踪的脱氧核糖核酸 (DNA) 分子事件记录器中，每个靶位点初始时是未经编辑的，当腺嘌呤碱基编辑器处于活动状态时，它会发生不可逆的编辑。经验证据表明，单个位点的编辑事件是独立的泊松事件，具有恒定的风险率。考虑一个基因组位点，其状态空间为 $\\{\\text{未经编辑}, \\text{已编辑}\\}$。假设一旦进入 $\\text{已编辑}$ 状态，该位点将无限期地保持在该状态（没有逆转），并且从 $\\text{未经编辑}$ 到 $\\text{已编辑}$ 的瞬时转换率是一个常数 $\\mu$，单位为 $\\text{时间}^{-1}$。令 $t$ 表示经过的时间，其时间单位与 $\\mu$ 相同。\n\n仅从以下基本原理出发：\n- 具有恒定风险 $\\mu$ 的泊松事件的等待时间服从指数分布，其生存函数为 $\\exp(-\\mu t)$。\n- 时间齐次连续时间马尔可夫链 (CTMC) 满足马尔可夫性质和柯尔莫哥洛夫方程，其生成元矩阵的非对角线元素为非负率，且行和为零。\n\n将此单位点编辑过程建模为一个两状态 CTMC，并从第一性原理出发，按 $\\{\\text{未经编辑}, \\text{已编辑}\\}$ 的状态顺序，推导在时间 $t$ 的 $2 \\times 2$ 转移概率矩阵 $P(t)$。您的最终答案必须是关于 $\\mu$ 和 $t$ 的单个闭式解析表达式。由于 $P(t)$ 的元素是概率，最终答案中不需要物理单位。不要对您的答案进行四舍五入。", "solution": "我们被要求为一个代表单个分子记录器位点上不可逆编辑过程的两状态时间齐次连续时间马尔可夫链 (CTMC) 推导其转移概率矩阵 $P(t)$。状态为 $\\{\\text{未经编辑}, \\text{已编辑}\\}$，我们将按此顺序为 $P(t)$ 的行和列建立索引。\n\n根据问题陈述，该过程是从 $\\text{未经编辑}$ 到 $\\text{已编辑}$ 的转换具有恒定风险 $\\mu$ 的泊松事件过程，且没有反向转换。用 CTMC 的语言来说，生成元矩阵 $Q$ 的非对角线率必须为非负，且行和为零。因此，在状态顺序为 $\\{\\text{未经编辑}, \\text{已编辑}\\}$ 的情况下，我们有\n$$\nQ \\;=\\; \\begin{pmatrix}\n-\\mu  \\mu \\\\\n0  0\n\\end{pmatrix}.\n$$\n这反映了从 $\\text{未经编辑}$ 状态离开的速率为 $\\mu$，且全部转移到 $\\text{已编辑}$ 状态，而 $\\text{已编辑}$ 状态是吸收态。\n\n从第一性原理出发，有两种互补的途径来获得 $P(t)$：(i) 利用泊松过程的指数等待时间特性，为相关的转移概率写出并求解柯尔莫哥洛夫前向方程；或者 (ii) 使用由时间齐次 CTMC 的柯尔莫哥洛夫方程所支持的矩阵指数 $P(t) = \\exp(Q t)$。我们采用途径 (i) 以更贴近生物化学的解释，然后验证其与途径 (ii) 的一致性。\n\n令 $p_{ij}(t)$ 表示在时间 $t$ 从初始状态 $i$ 转移到状态 $j$ 的转移概率，其中 $i,j \\in \\{\\text{未经编辑}, \\text{已编辑}\\}$。我们要求解的是以 $p_{ij}(t)$ 为元素的 $2 \\times 2$ 矩阵 $P(t)$。\n\n根据速率为 $\\mu$ 的首次编辑事件等待时间的指数生存函数，一个位点从未经编辑状态开始，直到时间 $t$ 仍然保持未经编辑状态的概率是\n$$\np_{\\text{未经编辑},\\text{未经编辑}}(t) \\;=\\; \\exp(-\\mu t).\n$$\n因为没有逆转，如果过程从已编辑状态开始，它将永远保持已编辑状态，所以\n$$\np_{\\text{已编辑},\\text{已编辑}}(t) \\;=\\; 1,\n\\qquad\np_{\\text{已编辑},\\text{未经编辑}}(t) \\;=\\; 0.\n$$\n剩下的元素 $p_{\\text{未经编辑},\\text{已编辑}}(t)$ 可以通过第一行的概率守恒得到，因为从未经编辑状态开始，在时间 $t$ 只有两种可能：未经编辑或已编辑：\n$$\np_{\\text{未经编辑},\\text{已编辑}}(t) \\;=\\; 1 - p_{\\text{未经编辑},\\text{未经编辑}}(t) \\;=\\; 1 - \\exp(-\\mu t).\n$$\n\n按照规定的行和列状态顺序 $\\{\\text{未经编辑}, \\text{已编辑}\\}$ 收集这些元素，我们得到\n$$\nP(t) \\;=\\; \\begin{pmatrix}\np_{\\text{未经编辑},\\text{未经编辑}}(t)  p_{\\text{未经编辑},\\text{已编辑}}(t) \\\\\np_{\\text{已编辑},\\text{未经编辑}}(t)  p_{\\text{已编辑},\\text{已编辑}}(t)\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n\\exp(-\\mu t)  1 - \\exp(-\\mu t) \\\\\n0  1\n\\end{pmatrix}.\n$$\n\n为求完整，我们验证该解满足柯尔莫哥洛夫前向方程 $ \\frac{d}{dt} P(t) = P(t) Q$，且 $P(0)=I$，其中 $I$ 是单位矩阵。首先，注意 $P(0) = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$，符合要求。接下来，计算时间导数：\n$$\n\\frac{d}{dt} P(t) \\;=\\; \\begin{pmatrix}\n-\\mu \\exp(-\\mu t)  \\mu \\exp(-\\mu t) \\\\\n0  0\n\\end{pmatrix}.\n$$\n计算 $P(t) Q$：\n$$\nP(t) Q \\;=\\; \n\\begin{pmatrix}\n\\exp(-\\mu t)  1 - \\exp(-\\mu t) \\\\\n0  1\n\\end{pmatrix}\n\\begin{pmatrix}\n-\\mu  \\mu \\\\\n0  0\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n-\\mu \\exp(-\\mu t)  \\mu \\exp(-\\mu t) \\\\\n0  0\n\\end{pmatrix}.\n$$\n因此 $\\frac{d}{dt} P(t) = P(t) Q$，这证实了与 CTMC 框架的一致性。根据该线性系统在初始条件 $P(0)=I$ 下解的唯一性，所推导出的 $P(t)$ 就是转移概率矩阵。\n\n因此，在时间 $t$ 内，速率为 $\\mu$ 的转移矩阵是\n$$\n\\begin{pmatrix}\n\\exp(-\\mu t)  1 - \\exp(-\\mu t) \\\\\n0  1\n\\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}\\exp(-\\mu t)  1-\\exp(-\\mu t) \\\\ 0  1\\end{pmatrix}}$$", "id": "2752006"}, {"introduction": "一个模型只有当其参数可以从数据中学习时才真正有用。这个练习将前一个练习中建立的连续时间马尔可夫模型应用于一个核心任务：使用强大的最大似然估计原理，从实验观测数据中估算关键参数——编辑速率 $\\mu$。它将抽象的理论模型与具体的数据分析实践联系起来，展示了如何从谱系数据中提取定量的生物学见解。[@problem_id:2752064]", "problem": "一个实验室使用基于成簇规律间隔短回文重复序列 (CRISPR) 的分子事件记录器来追踪细胞谱系。该记录器由 $L$ 个独立的基因组条形码位点组成，在时间 $t=0$ 时，这些位点在根细胞中初始状态为未编辑。每个位点被建模为一个具有状态 $\\{0,1\\}$ 的双态连续时间过程，其中 $0$ 表示未编辑，$1$ 表示不可逆编辑。在任何时长为 $t$ 的谱系分支上，从 $0 \\to 1$ 的转变遵循一个泊松过程，其恒定速率为 $\\mu$ (每个位点每单位时间)，并且不可能发生 $1 \\to 0$ 的逆向突变。细胞谱系形成一个具有已知分支时长的有根树拓扑 $\\mathcal{T}$。所有采样的叶节点都在同一最终时间被观测。观测数据是每个位点在叶节点的状态（已编辑或未编辑）。\n\n仅从泊松过程和连续时间马尔可夫链的定义出发，并假设位点之间独立且速率相同：\n\n- 在给定拓扑 $\\mathcal{T}$ 和速率 $\\mu$ 的条件下，通过对内部节点上未观测到的祖先状态求和，推导出观测到的叶节点状态的单位点似然。然后写出 $L$ 个独立位点的完整似然。\n\n- 现在，将问题特化为 $\\mathcal{T}$ 是一个有 $m$ 个叶节点的有根星形拓扑，每个分支的时长均为 $t$。在这种情况下，对于每个位点，叶节点都从已知的根状态 $0$ 独立演化。假设 $m=4$，$t=20$ 小时，且 $L=1000$。在所有 $mL$ 个叶节点-位点对中，你观测到总共 $K=1230$ 个已编辑状态（$1$）和 $mL-K$ 个未编辑状态（$0$）。计算此星形拓扑数据集下 $\\mu$ 的最大似然估计 $\\hat{\\mu}$。将最终速率以 h$^{-1}$ 为单位表示，并将答案四舍五入到四位有效数字。", "solution": "问题分为两部分。第一，推导分子记录器在树上的通用似然函数。第二，在特定的实验场景下计算记录速率 $\\mu$ 的最大似然估计。\n\n第一部分：似然函数的推导\n\n单个条形码位点的状态被建模为一个双态连续时间马尔可夫链，其状态为 $\\{0, 1\\}$，分别代表未编辑和已编辑。从状态 $0$ 到状态 $1$ 的转变以恒定速率 $\\mu$ 发生。反向转变 $1 \\to 0$ 是被禁止的，这使得状态 $1$ 成为一个吸收态。该过程的速率矩阵（或称生成元） $Q$ 为：\n$$\nQ = \\begin{pmatrix} -\\mu  \\mu \\\\ 0  0 \\end{pmatrix}\n$$\n在时间间隔 $t$ 内的概率转移矩阵 $P(t)$ 由矩阵指数 $P(t) = \\exp(Qt)$ 给出。元素 $P_{ij}(t)$ 表示在时间 $0$ 时状态为 $i$ 的条件下，在时间 $t$ 时处于状态 $j$ 的概率。主方程 $\\frac{d P(t)}{dt} = P(t)Q$ 的解给出了这些概率。具体来说，对于保持在状态 $0$ 的概率 $P_{00}(t)$：\n$$\n\\frac{d P_{00}(t)}{dt} = -\\mu P_{00}(t)\n$$\n在初始条件 $P_{00}(0) = 1$ 下，解为：\n$$\nP_{00}(t) = \\exp(-\\mu t)\n$$\n这是在时间间隔 $t$ 内发生零次编辑事件的概率，与泊松过程一致。由于只有两个状态，从 $0$ 转变到 $1$ 的概率为：\n$$\nP_{01}(t) = 1 - P_{00}(t) = 1 - \\exp(-\\mu t)\n$$\n因为状态 $1$ 是吸收态，我们有：\n$$\nP_{11}(t) = 1\n$$\n$$\nP_{10}(t) = 0\n$$\n现在，考虑在一个给定的具有已知分支时长的有根树拓扑 $\\mathcal{T}$ 上的单个位点。时间 $t=0$ 时的根细胞在该位点上处于状态 $0$。设叶节点集合为 $\\mathcal{L}$，内部节点集合为 $\\mathcal{I}$（包括根节点 $r$）。该位点的观测数据是状态集合 $D = \\{s_v | v \\in \\mathcal{L}\\}$，其中 $s_v \\in \\{0, 1\\}$。\n\n在给定速率 $\\mu$ 的条件下观测到数据 $D$ 的似然是概率 $P(D | \\mu, \\mathcal{T})$。这可以通过对所有未观测到的内部节点（不包括根节点，其状态固定为 $0$）的可能状态赋值求和得到。\n设 $s_{\\mathcal{I} \\setminus \\{r\\}}$ 是除根节点外内部节点的一种特定状态分配。单个位点的似然为：\n$$\nL_{\\text{site}}(\\mu) = P(D | s_r=0, \\mu, \\mathcal{T}) = \\sum_{s_{\\mathcal{I} \\setminus \\{r\\}}} P(D, s_{\\mathcal{I} \\setminus \\{r\\}} | s_r=0, \\mu, \\mathcal{T})\n$$\n树中所有节点状态的一个完整分配的联合概率是沿每个分支的转移概率的乘积。设 $u$ 是节点 $v$ 的父节点，$t_{uv}$ 是连接它们的分支的时长。\n$$\nP(D, s_{\\mathcal{I} \\setminus \\{r\\}} | s_r=0, \\mu, \\mathcal{T}) = \\prod_{(u,v) \\in \\text{edges}} P_{s_u s_v}(t_{uv})\n$$\n这个和可以使用动态规划方法高效计算，该方法通常被称为 Felsenstein 剪枝算法。我们为每个节点 $v$ 和每个状态 $i \\in \\{0, 1\\}$ 定义一个条件似然 $L_v(i)$，它表示在给定节点 $v$ 处于状态 $i$ 的条件下，观测到从 $v$ 派生的子树中状态的概率。计算从叶节点向根节点进行。该位点的最终似然是在根节点 $v=r$ 处计算的 $L_v(0)$。\n\n由于 $L$ 个条形码位点是独立的并且具有相同的速率 $\\mu$，所有位点上观测到的状态的总似然是各个位点似然的乘积。设 $D_j$ 是位点 $j$ 的数据。\n$$\nL_{\\text{total}}(\\mu) = \\prod_{j=1}^{L} L_{\\text{site}, j}(\\mu)\n$$\n其中 $L_{\\text{site}, j}(\\mu)$ 是如上所述计算的位点 $j$ 的似然。\n\n第二部分：星形拓扑的最大似然估计\n\n问题现在特化为一个有 $m$ 个叶节点的有根星形拓扑，其中每个叶节点通过一个时长为 $t$ 的分支连接到根节点。所有位点的根状态已知为 $0$。这种结构极大地简化了似然计算。在给定根状态为 $0$ 的情况下，$m$ 个叶节点的状态沿着它们各自的分支独立演化。\n\n对于任何给定叶节点的任何给定位点，其状态是从状态 $0$ 开始，经过时长为 $t$ 的过程的结果。该叶节点-位点为未编辑（状态 $0$）的概率是：\n$$\np_0 = P(\\text{state}=0) = P_{00}(t) = \\exp(-\\mu t)\n$$\n该叶节点-位点为已编辑（状态 $1$）的概率是：\n$$\np_1 = P(\\text{state}=1) = P_{01}(t) = 1 - \\exp(-\\mu t)\n$$\n我们总共有 $N = m \\times L$ 个叶节点-位点对。每一个都构成一个独立的伯努利试验，其成功概率为 $p_1$（其中成功定义为处于已编辑状态 $1$）。\n数据总结为观测到总共 $K$ 个已编辑状态（$1$）和 $N-K$ 个未编辑状态（$0$）。在 $N$ 次独立试验中观测到 $K$ 次成功的似然遵循二项分布：\n$$\nL(\\mu) = \\binom{N}{K} (p_1)^K (p_0)^{N-K}\n$$\n代入 $p_0$ 和 $p_1$ 的表达式：\n$$\nL(\\mu) = \\binom{N}{K} (1 - \\exp(-\\mu t))^K (\\exp(-\\mu t))^{N-K}\n$$\n为了找到最大似然估计 (MLE) $\\hat{\\mu}$，我们对 $\\mu$ 最大化 $L(\\mu)$。更方便的是最大化对数似然 $\\ln L(\\mu)$：\n$$\n\\ln L(\\mu) = \\ln\\binom{N}{K} + K \\ln(1 - \\exp(-\\mu t)) + (N-K) \\ln(\\exp(-\\mu t))\n$$\n$$\n\\ln L(\\mu) = \\ln\\binom{N}{K} + K \\ln(1 - \\exp(-\\mu t)) - (N-K)\\mu t\n$$\n我们对 $\\mu$ 求导，并令结果为零：\n$$\n\\frac{d}{d\\mu} \\ln L(\\mu) = K \\left( \\frac{1}{1 - \\exp(-\\mu t)} \\right) ( - \\exp(-\\mu t) ) (-t) - (N-K)t = 0\n$$\n$$\n\\frac{K t \\exp(-\\mu t)}{1 - \\exp(-\\mu t)} - (N-K)t = 0\n$$\n假设 $t \\neq 0$，我们可以两边除以 $t$：\n$$\n\\frac{K \\exp(-\\mu t)}{1 - \\exp(-\\mu t)} = N-K\n$$\n$$\nK \\exp(-\\mu t) = (N-K)(1 - \\exp(-\\mu t))\n$$\n$$\nK \\exp(-\\mu t) = N - K - (N-K)\\exp(-\\mu t)\n$$\n$$\n(K + N - K) \\exp(-\\mu t) = N - K\n$$\n$$\nN \\exp(-\\mu t) = N - K\n$$\n$$\n\\exp(-\\mu t) = \\frac{N-K}{N} = 1 - \\frac{K}{N}\n$$\n求解 $\\mu$ 得到最大似然估计 $\\hat{\\mu}$：\n$$\n-\\hat{\\mu} t = \\ln\\left(1 - \\frac{K}{N}\\right)\n$$\n$$\n\\hat{\\mu} = -\\frac{1}{t} \\ln\\left(1 - \\frac{K}{N}\\right)\n$$\n现在我们代入给定的数值：\n$m = 4$\n$L = 1000$\n$t = 20$ 小时\n$K = 1230$\n总观测数为 $N = m \\times L = 4 \\times 1000 = 4000$。\n\n将这些值代入 $\\hat{\\mu}$ 的公式：\n$$\n\\hat{\\mu} = -\\frac{1}{20} \\ln\\left(1 - \\frac{1230}{4000}\\right)\n$$\n$$\n\\hat{\\mu} = -\\frac{1}{20} \\ln\\left(1 - 0.3075\\right)\n$$\n$$\n\\hat{\\mu} = -\\frac{1}{20} \\ln(0.6925)\n$$\n计算该值：\n$$\n\\hat{\\mu} \\approx -\\frac{1}{20} (-0.3674608) \\approx 0.01837304 \\, \\text{h}^{-1}\n$$\n按要求四舍五入到四位有效数字：\n$$\n\\hat{\\mu} \\approx 0.01837 \\, \\text{h}^{-1}\n$$", "answer": "$$\n\\boxed{0.01837}\n$$", "id": "2752064"}, {"introduction": "在建立了生物学过程的模型并学会了如何从数据中推断其参数后，我们必须考虑数据本身的保真度。现实世界的数据总是伴随着噪声，例如来自 DNA 测序的错误。本练习探讨了一种源于信息论的实用策略——添加校验位——来设计能够抵抗不可避免的测量错误的 DNA 条形码，这对于确保细胞谱系追踪实验的可靠性至关重要。[@problem_id:2752009]", "problem": "在分子事件记录和细胞谱系追踪系统中，长度为 $L$ 的脱氧核糖核酸（DNA）条形码被整合到细胞中，随后通过新一代测序（NGS）进行读出。为了降低由碱基识别替换引起的未检测到的错误读取率，您决定添加一个校验碱基，对核苷酸的二进制重编码实现一个简单的奇偶校验。\n\n您实施了以下方案：\n- 通过将嘌呤与嘧啶分组，将每个核苷酸映射到一个比特位：将腺嘌呤 $(\\mathrm{A})$ 和鸟嘌呤 $(\\mathrm{G})$ 分配为 $0$，将胞嘧啶 $(\\mathrm{C})$ 和胸腺嘧啶 $(\\mathrm{T})$ 分配为 $1$。\n- 追加一个校验碱基，其映射的比特位在所有 $L+1$ 个位置上强制实现偶校验，即这 $L+1$ 个比特位之和模 $2$ 等于 $0$。\n\n假设以下经过充分测试的NGS碱基识别错误模型：\n- $L+1$ 个碱基中的每一个都是独立读取的，并且可以以概率 $p$ 被替换为其他三个核苷酸中的任意一个，在发生错误的情况下，替换为三种错误核苷酸中每一种的可能性是均等的。\n- 不发生插入和缺失。\n\n将未检测到的错误定义为以下事件：在 $(L+1)$ 个碱基的读出序列中任何位置发生一次或多次碱基替换，但奇偶校验通过（即，观察到的映射比特位的奇偶性仍为偶数）。推导出一个关于未检测到错误的概率的闭式解析表达式，该表达式是 $L$ 和 $p$ 的函数。您的最终答案必须是仅含 $L$ 和 $p$ 的单个表达式。不要进行近似，也不要包含单位。", "solution": "设序列中的碱基总数为 $N = L+1$。该序列由一个长度为 $L$ 的初始条形码和一个附加的校验碱基组成。\n\n核苷酸到比特的映射定义如下：\n- 嘌呤：$\\mathrm{A}, \\mathrm{G} \\to 0$\n- 嘧啶：$\\mathrm{C}, \\mathrm{T} \\to 1$\n\n校验规则确保对应于真实核苷酸序列的 $N$ 个比特序列具有偶校验性。即，真实比特位之和模 $2$ 为 $0$。\n\n单个碱基位置上的错误是指替换为其他3个核苷酸中的一个，且每种替换的可能性均等。在任何给定位置上发生此类错误的概率为 $p$。因此，变为某个特定错误核苷酸的概率是 $\\frac{p}{3}$。\n\n让我们确定单个核苷酸位置对应的比特位发生翻转的概率。当且仅当一个嘌呤被一个嘧啶替换，或一个嘧啶被一个嘌呤替换时，才会发生比特翻转。\n- 假设原始核苷酸是嘌呤（比特 $0$）。存在另外1种嘌呤和2种嘧啶。一次替换错误会以概率 $\\frac{p}{3}$ 将其变为另一种嘌呤，导致比特不翻转。该错误会以总概率 $2 \\times \\frac{p}{3} = \\frac{2p}{3}$ 将其变为2种嘧啶中的一种，导致比特翻转。\n- 假设原始核苷酸是嘧啶（比特 $1$）。存在另外1种嘧啶和2种嘌呤。类似地，该替换将以概率 $\\frac{p}{3}$ 导致比特不翻转，以概率 $\\frac{2p}{3}$ 导致比特翻转。\n\n因此，在任何单个位置上发生比特翻转的概率（我们将其记为 $p_{\\text{flip}}$）与原始核苷酸无关，由下式给出：\n$$p_{\\text{flip}} = \\frac{2}{3}p$$\n在给定位置上比特不翻转的概率是 $1 - p_{\\text{flip}} = 1 - \\frac{2}{3}p$。这些是在 $N$ 个位置上每个位置进行伯努利试验的参数。\n\n未检测到的错误被定义为至少发生一次碱基替换，但观察到的比特序列的奇偶性仍为偶数的事件。\n设 $E$ 为在 $N$ 碱基序列中至少发生一次替换的事件。设 $F_{\\text{even}}$ 为在 $N$ 个位置上比特翻转总数为偶数的事件。未检测到错误的概率是 $P(E \\cap F_{\\text{even}})$。\n\n使用补事件来计算此概率更为直接。事件空间可以划分为 $E$（至少一个错误）和 $E^c$（零错误）。我们有以下关系：\n$$P(F_{\\text{even}}) = P(F_{\\text{even}} \\cap E) + P(F_{\\text{even}} \\cap E^c)$$\n项 $P(F_{\\text{even}} \\cap E)$ 是所求的未检测到错误的概率。\n事件 $E^c$，即零替换，意味着没有比特会翻转。翻转的次数为 $0$，这是一个偶数。因此，$E^c$ 的发生蕴含着 $F_{\\text{even}}$ 的发生。这意味着 $E^c \\subseteq F_{\\text{even}}$，所以 $F_{\\text{even}} \\cap E^c = E^c$。\n该方程变为：\n$$P(F_{\\text{even}}) = P(\\text{未检测到的错误}) + P(E^c)$$\n从中我们推导出：\n$$P(\\text{未检测到的错误}) = P(F_{\\text{even}}) - P(E^c)$$\n\n我们现在计算等式右边的两个概率。\n\n首先，计算 $P(F_{\\text{even}})$。在 $N$ 个位置上比特翻转的次数服从二项分布，试验次数为 $N$，成功概率为 $p_{\\text{flip}}$。恰好发生 $k$ 次翻转的概率为 $\\binom{N}{k} (p_{\\text{flip}})^k (1-p_{\\text{flip}})^{N-k}$。\n$P(F_{\\text{even}})$ 是对所有偶数 $k$ 的这些概率之和：\n$$P(F_{\\text{even}}) = \\sum_{j=0}^{\\lfloor N/2 \\rfloor} \\binom{N}{2j} (p_{\\text{flip}})^{2j} (1-p_{\\text{flip}})^{N-2j}$$\n这个和有一个众所周知的闭式表达式，可以从 $(x+y)^N$ 和 $(x-y)^N$ 的二项式展开中推导出来。设 $x = 1 - p_{\\text{flip}}$ 和 $y = p_{\\text{flip}}$，我们得到：\n$$P(F_{\\text{even}}) = \\frac{1}{2} \\left[ ((1-p_{\\text{flip}}) + p_{\\text{flip}})^N + ((1-p_{\\text{flip}}) - p_{\\text{flip}})^N \\right]$$\n$$P(F_{\\text{even}}) = \\frac{1}{2} \\left[ 1^N + (1-2p_{\\text{flip}})^N \\right] = \\frac{1}{2} \\left[ 1 + (1-2p_{\\text{flip}})^N \\right]$$\n代入 $p_{\\text{flip}} = \\frac{2}{3}p$ 和 $N=L+1$：\n$$P(F_{\\text{even}}) = \\frac{1}{2} \\left[ 1 + \\left(1 - \\frac{4}{3}p\\right)^{L+1} \\right]$$\n\n其次，计算 $P(E^c)$。事件 $E^c$ 是指没有替换发生。在单个位置上不发生替换的概率是 $1-p$。由于在 $N$ 个位置上每个位置的替换是独立事件，所以在所有 $N$ 个位置上都不发生替换的概率是：\n$$P(E^c) = (1-p)^N = (1-p)^{L+1}$$\n\n最后，我们结合这些结果来求未检测到错误的概率：\n$$P(\\text{未检测到的错误}) = P(F_{\\text{even}}) - P(E^c) = \\frac{1}{2} \\left[ 1 + \\left(1 - \\frac{4}{3}p\\right)^{L+1} \\right] - (1-p)^{L+1}$$\n这就是作为 $L$ 和 $p$ 的函数的最终闭式表达式。", "answer": "$$\\boxed{\\frac{1}{2}\\left[1 + \\left(1 - \\frac{4}{3}p\\right)^{L+1}\\right] - (1-p)^{L+1}}$$", "id": "2752009"}]}