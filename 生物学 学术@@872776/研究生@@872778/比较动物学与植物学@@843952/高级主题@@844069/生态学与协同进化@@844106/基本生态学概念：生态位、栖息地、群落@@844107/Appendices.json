{"hands_on_practices": [{"introduction": "生态位的概念是生态学的基石，但如何将其从抽象理论转化为可量化的指标，是研究中的关键挑战。这项实践将G. Evelyn Hutchinson的n维超体积生态位概念付诸实践，要求您基于性能曲线模型来界定物种的生存边界，并定量计算其在二维非生物环境空间中的生态位面积[@problem_id:2575478]。通过这个过程，您将掌握如何将生态学原理形式化为数学模型，并从中提取出有意义的生态学度量。", "problem": "在受控的实验室微观生态系统中，对一种淡水大型藻类进行测定，以量化其瞬时生长性能如何依赖于两个非生物轴：温度和氢离子浓度指数(pH)。在没有种间相互作用的情况下，沿温度和pH轴的边际性能曲线的经验拟合，可以很好地用以经验确定的最适值为中心的正态化高斯函数来描述。具体而言，该多维性能模型被假定为跨轴可乘的，这与独立的非生物限制相一致：\n\n- 温度轴：边际性能因子为 $f_{T}(T)=\\exp\\!\\left(-\\dfrac{(T-T_{\\mathrm{opt}})^{2}}{2\\sigma_{T}^{2}}\\right)$，其中 $T_{\\mathrm{opt}}=20\\,^{\\circ}\\mathrm{C}$ 且 $\\sigma_{T}=4\\,^{\\circ}\\mathrm{C}$。\n- pH轴：边际性能因子为 $f_{H}(H)=\\exp\\!\\left(-\\dfrac{(H-H_{\\mathrm{opt}})^{2}}{2\\sigma_{H}^{2}}\\right)$，其中 $H_{\\mathrm{opt}}=7.5$ 且 $\\sigma_{H}=0.6$ (pH单位)。\n\n完整的性能曲面为 $P(T,H)=P_{\\max}\\, f_{T}(T)\\, f_{H}(H)$，其中 $P_{\\max}$ 是在 $(T_{\\mathrm{opt}},H_{\\mathrm{opt}})$ 处达到的最大性能。\n\n仅使用生态位的基本定义（即支持特定性能的一组非生物状态）和给定的经验性能模型，从第一性原理推导在 $(T,H)$ 状态空间中由条件 $P(T,H)\\geq 0.5\\,P_{\\max}$ 定义的生态位轮廓的几何形状。然后计算该轮廓在 $(T,H)$ 平面中所包围的面积。\n\n请用摄氏度乘以氢离子浓度指数单位 ($^{\\circ}\\mathrm{C}\\cdot\\mathrm{pH}$) 表示最终面积。将答案四舍五入到四位有效数字。结合比较动物学和植物学中的生态位概念，简要解释这个面积在没有生物相互作用的实验室环境中作为一个实现的耐受窗口的意义。", "solution": "本任务是描述生物体性能达到或超过其最大值一半时的非生物状态 $(T,H)$ 集合的特征，并计算该集合在温度-氢离子浓度指数(pH)平面上的面积。我们从两个基本依据出发：\n\n1. Hutchinson生态位概念将一个$n$维超体积定义为一组环境状态，在这些状态下，某个核心性能度量（例如，适应度代理指标）满足一个标准。这里的标准是 $P(T,H)\\geq \\alpha P_{\\max}$，其中 $\\alpha=0.5$。\n2. 在最适值附近，许多经验性能曲线可以很好地用高斯函数来近似，并且当不同的非生物因素独立地起限制作用时，其联合效应可以建模为边际效应的乘积。由此可得：\n$$\nP(T,H)=P_{\\max}\\,\\exp\\!\\left(-\\frac{(T-T_{\\mathrm{opt}})^{2}}{2\\sigma_{T}^{2}}\\right)\\,\\exp\\!\\left(-\\frac{(H-H_{\\mathrm{opt}})^{2}}{2\\sigma_{H}^{2}}\\right).\n$$\n\n施加阈值条件 $P(T,H)\\geq 0.5\\,P_{\\max}$，并在不等式两边同除以 $P_{\\max}>0$，可得：\n$$\n\\exp\\!\\left(-\\frac{(T-T_{\\mathrm{opt}})^{2}}{2\\sigma_{T}^{2}}\\right)\\,\\exp\\!\\left(-\\frac{(H-H_{\\mathrm{opt}})^{2}}{2\\sigma_{H}^{2}}\\right)\\geq 0.5.\n$$\n利用指数和对数的性质，指数的乘积可以写成单个指数形式：\n$$\n\\exp\\!\\left(-\\frac{(T-T_{\\mathrm{opt}})^{2}}{2\\sigma_{T}^{2}}-\\frac{(H-H_{\\mathrm{opt}})^{2}}{2\\sigma_{H}^{2}}\\right)\\geq 0.5.\n$$\n对不等式两边取自然对数（注意到 $\\ln$ 是严格递增函数），得出：\n$$\n-\\frac{(T-T_{\\mathrm{opt}})^{2}}{2\\sigma_{T}^{2}}-\\frac{(H-H_{\\mathrm{opt}})^{2}}{2\\sigma_{H}^{2}}\\geq \\ln(0.5).\n$$\n因为 $\\ln(0.5)=-\\ln(2)$，我们可以将不等式两边同乘以 $-1$ 并反转不等号方向：\n$$\n\\frac{(T-T_{\\mathrm{opt}})^{2}}{2\\sigma_{T}^{2}}+\\frac{(H-H_{\\mathrm{opt}})^{2}}{2\\sigma_{H}^{2}}\\leq \\ln(2).\n$$\n重新整理后，我们得到：\n$$\n\\frac{(T-T_{\\mathrm{opt}})^{2}}{\\left(\\sqrt{2\\ln(2)}\\,\\sigma_{T}\\right)^{2}}+\\frac{(H-H_{\\mathrm{opt}})^{2}}{\\left(\\sqrt{2\\ln(2)}\\,\\sigma_{H}\\right)^{2}}\\leq 1.\n$$\n这个不等式是在 $(T,H)$ 平面中，以 $(T_{\\mathrm{opt}},H_{\\mathrm{opt}})$ 为中心、轴与坐标轴平行的椭圆的标准形式，其半轴为：\n$$\na_{T}=\\sqrt{2\\ln(2)}\\,\\sigma_{T},\\qquad a_{H}=\\sqrt{2\\ln(2)}\\,\\sigma_{H}.\n$$\n\n半轴为 $a_{T}$ 和 $a_{H}$ 的椭圆的面积 $A$ 是：\n$$\nA=\\pi\\,a_{T}\\,a_{H}=\\pi\\left(\\sqrt{2\\ln(2)}\\,\\sigma_{T}\\right)\\left(\\sqrt{2\\ln(2)}\\,\\sigma_{H}\\right)=2\\pi\\ln(2)\\,\\sigma_{T}\\sigma_{H}.\n$$\n\n代入给定的标准差 $\\sigma_{T}=4$（单位为 $^{\\circ}\\mathrm{C}$）和 $\\sigma_{H}=0.6$（单位为 pH），得到：\n$$\nA=2\\pi\\ln(2)\\times 4\\times 0.6.\n$$\n为了进行数值计算，我们先将符号常数保持不变，直到最后一步：\n$$\nA=2\\pi\\ln(2)\\cdot 2.4.\n$$\n计算乘积：\n$$\n2\\pi\\ln(2)\\approx 2\\times 3.141592653589793\\times 0.6931471805599453\\approx 4.355172180607.\n$$\n然后\n$$\nA\\approx 4.355172180607\\times 2.4\\approx 10.45241323346.\n$$\n四舍五入到四位有效数字，面积为：\n$$\nA\\approx 10.45.\n$$\n单位是摄氏度乘以氢离子浓度指数单位，即 $^{\\circ}\\mathrm{C}\\cdot\\mathrm{pH}$。\n\n解释：推导出的轮廓 $P(T,H)\\geq 0.5\\,P_{\\max}$ 是一个以 $(T_{\\mathrm{opt}},H_{\\mathrm{opt}})$ 为中心的椭圆，其面积量化了在没有种间相互作用的实验室条件下，能产生至少一半最大性能的温度和pH非生物耐受窗口的宽度。在操作层面上，从Hutchinson生态位的意义上讲，这是沿着这两个轴的基础耐受窗口；在没有生物相互作用的情况下，它与测定中实现的耐受性相吻合。在比较动物学和植物学中，同样的推导同样适用于动物和植物：不同分类单元之间的 $\\sigma_{T}$ 和 $\\sigma_{H}$ 差异通过 $A=2\\pi\\ln(2)\\,\\sigma_{T}\\sigma_{H}$ 直接缩放椭圆，从而使得对不同支系间非生物生态位宽度的原则性比较成为可能。", "answer": "$$\\boxed{10.45}$$", "id": "2575478"}, {"introduction": "在量化了单个物种的生态位之后，我们将视野扩展到整个群落，探究其组成如何沿环境梯度发生变化。这项实践模拟了一次沿山体海拔梯度的生态调查，要求您利用物种有无数据来量化群落组成的周转率（即β多样性）[@problem_id:2575472]。通过这个练习，您将掌握如何运用Jaccard相异度等标准指数，从原始的群落数据中揭示出物种对环境变化的响应模式，这是群落生态学分析的基础。", "problem": "一条山地样带包含 $5$ 个森林样方，这些样方沿着海拔梯度排列，其中点海拔分别为 $E_{1}=200\\,\\text{m}$、$E_{2}=600\\,\\text{m}$、$E_{3}=1000\\,\\text{m}$、$E_{4}=1400\\,\\text{m}$ 和 $E_{5}=1800\\,\\text{m}$。将每个样方视为一个局域生态群落（即生境中共存的物种集合），并将海拔梯度视为构建物种已实现生态位的一个主要非生物轴。\n\n现给出 $7$ 个分类单元（涵盖维管植物和节肢动物）的物种-样点出现（存在-缺失）数据，这些分类单元共同定义了每个样方的群落。物种的存在由其是否属于该样点的物种集合来表示：\n- 样点 $1$ ($200\\,\\text{m}$): $\\{A, B, G\\}$\n- 样点 $2$ ($600\\,\\text{m}$): $\\{A, B, C, G\\}$\n- 样点 $3$ ($1000\\,\\text{m}$): $\\{B, C, E, F, G\\}$\n- 样点 $4$ ($1400\\,\\text{m}$): $\\{C, D, E, G\\}$\n- 样点 $5$ ($1800\\,\\text{m}$): $\\{D, E, G\\}$\n\n从生境、群落和生态位的核心定义出发，并且只使用基本的基于集合的存在-缺失推理，完成以下任务：\n- 对于所有满足 $i<j$ 的样方对 $(i,j)$，计算其Jaccard相异度 $D_J(S_i, S_j)$。\n- 计算所有这些相异度值的算术平均值。\n\n请以最简分数的精确形式给出平均Jaccard相异度。", "solution": "该任务要求计算沿海拔梯度的5个样方之间的平均β多样性，以Jaccard相异度来衡量。\n\n**步骤 1：明确数据和公式**\n- 样方物种集合：\n  - $S_1 = \\{A, B, G\\}$\n  - $S_2 = \\{A, B, C, G\\}$\n  - $S_3 = \\{B, C, E, F, G\\}$\n  - $S_4 = \\{C, D, E, G\\}$\n  - $S_5 = \\{D, E, G\\}$\n- Jaccard相异度公式：$D_J(S_i, S_j) = 1 - \\frac{|S_i \\cap S_j|}{|S_i \\cup S_j|}$。\n- 需要计算所有10个唯一成对组合（$i<j$）的$D_J$值。\n\n**步骤 2：计算成对Jaccard相异度**\n我们逐一计算每个样方对的交集和并集大小，然后得出相异度。\n- $S_1, S_2$: $|S_1 \\cap S_2| = 3$, $|S_1 \\cup S_2| = 4 \\implies D_{1,2} = 1 - 3/4 = 1/4$\n- $S_1, S_3$: $|S_1 \\cap S_3| = 2$, $|S_1 \\cup S_3| = 6 \\implies D_{1,3} = 1 - 2/6 = 4/6 = 2/3$\n- $S_1, S_4$: $|S_1 \\cap S_4| = 1$, $|S_1 \\cup S_4| = 6 \\implies D_{1,4} = 1 - 1/6 = 5/6$\n- $S_1, S_5$: $|S_1 \\cap S_5| = 1$, $|S_1 \\cup S_5| = 5 \\implies D_{1,5} = 1 - 1/5 = 4/5$\n- $S_2, S_3$: $|S_2 \\cap S_3| = 3$, $|S_2 \\cup S_3| = 6 \\implies D_{2,3} = 1 - 3/6 = 3/6 = 1/2$\n- $S_2, S_4$: $|S_2 \\cap S_4| = 2$, $|S_2 \\cup S_4| = 6 \\implies D_{2,4} = 1 - 2/6 = 4/6 = 2/3$\n- $S_2, S_5$: $|S_2 \\cap S_5| = 1$, $|S_2 \\cup S_5| = 6 \\implies D_{2,5} = 1 - 1/6 = 5/6$\n- $S_3, S_4$: $|S_3 \\cap S_4| = 3$, $|S_3 \\cup S_4| = 6 \\implies D_{3,4} = 1 - 3/6 = 3/6 = 1/2$\n- $S_3, S_5$: $|S_3 \\cap S_5| = 2$, $|S_3 \\cup S_5| = 6 \\implies D_{3,5} = 1 - 2/6 = 4/6 = 2/3$\n- $S_4, S_5$: $|S_4 \\cap S_5| = 3$, $|S_4 \\cup S_5| = 4 \\implies D_{4,5} = 1 - 3/4 = 1/4$\n\n**步骤 3：计算平均相异度**\n将所有10个相异度值相加：\n$$\n\\text{总和} = \\frac{1}{4} + \\frac{2}{3} + \\frac{5}{6} + \\frac{4}{5} + \\frac{1}{2} + \\frac{2}{3} + \\frac{5}{6} + \\frac{1}{2} + \\frac{2}{3} + \\frac{1}{4}\n$$\n为了便于相加，找到公分母（60）：\n$$\n\\text{总和} = \\frac{15}{60} + \\frac{40}{60} + \\frac{50}{60} + \\frac{48}{60} + \\frac{30}{60} + \\frac{40}{60} + \\frac{50}{60} + \\frac{30}{60} + \\frac{40}{60} + \\frac{15}{60} = \\frac{358}{60} = \\frac{179}{30}\n$$\n平均相异度为总和除以成对比较的数量（10）：\n$$\n\\bar{D}_J = \\frac{179/30}{10} = \\frac{179}{300}\n$$\n\n**最终答案的阐述**\n该值 $\\frac{179}{300}$ 代表了沿着海拔梯度采样的群落之间平均的物种组成周转率。最终答案必须以精确分数形式给出。", "answer": "$$\n\\boxed{\\frac{179}{300}}\n$$", "id": "2575472"}, {"introduction": "我们已经观察到群落结构会随环境变化，但其背后的驱动机制是什么？群落构建是遵循确定性的生态位法则，还是更接近于随机的中性过程？这项高级实践将引导您深入这一核心辩论，要求您设计并实施一个计算测试，以评估一个假设群落的性状分布是否偏离了中性模型的预期[@problem_id:2575534]。通过构建零模型并进行统计检验，您将掌握当代生态学中用于推断群落组装机制的强大计算工具。", "problem": "在比较动植物学中，一个群落是一组共存的物种，每个物种都有其多度。生境是物种出现的物理环境。生态位由一套环境条件和资源利用轴定义，在这些条件下，一个物种可以维持其种群。在中性组合下，除了随机取样之外，物种身份及相关功能性状与群落组成无关；而在基于生态位的组合下，功能性状介导环境过滤或限制相似性，这会在性状离散中留下可检测的信号。使用这些核心定义，设计一个程序化检验，利用功能性状离散来评估一个目标热带树木群落是否偏离中性零假设。该检验必须基于以下基本原则构建：零假设下的随机化应切断物种身份和性状值之间的任何确定性联系，同时保留经验群落多度结构；离散度应计算为成对性状距离的加权平均值；统计推断应基于蒙特卡洛置换分布。\n\n精确定义以下量。假设有一个大小为 $S$ 的区域物种库，其功能性状向量为 $\\mathbf{t} = (t_1,\\dots,t_S)$，其中 $t_i$ 是物种 $i$ 的一个连续、无单位的功能性状。对于一个目标群落（一个样地），设物种多度向量为 $\\mathbf{a} = (a_1,\\dots,a_S)$，其中 $a_i \\in \\mathbb{N}_0$ 且 $\\sum_{i=1}^S a_i > 0$。定义相对多度 $w_i = a_i / \\sum_{k=1}^S a_k$。令 $\\mathcal{I} = \\{i \\mid a_i > 0\\}$ 表示存在的物种集合。观测到的多度加权平均成对性状距离是归一化的量\n$$\n\\mathrm{MPD}_{\\mathrm{obs}} = \\frac{\\sum_{i<j, i,j \\in \\mathcal{I}} w_i w_j |t_i - t_j|}{\\sum_{i<j, i,j \\in \\mathcal{I}} w_i w_j}.\n$$\n该公式可被解释为从群落中随机抽取两个不同物种的个体时，它们性状距离的期望值。\n\n要实现这个程序化检验：\n1. **中性零假设**：物种性状值对其在群落中的多度没有影响。\n2. **零模型**：通过在区域物种库的 $S$ 个物种间随机置换性状向量 $\\mathbf{t}$ 来生成一个零分布。这会创建一个新的性状向量 $\\mathbf{t}_p$，其中元素被随机重新排序。使用这个置换后的向量 $\\mathbf{t}_p$ 和**未改变的**观测多度向量 $\\mathbf{a}$，计算一个零 $\\mathrm{MPD}_p$。\n3. **统计检验**：\n   - 从观测数据（$\\mathbf{t}, \\mathbf{a}$）计算 $\\mathrm{MPD}_{\\mathrm{obs}}$。\n   - 通过重复步骤(2) $N_{\\mathrm{perm}}$ 次来生成一个 $\\mathrm{MPD}_p$ 值的零分布。\n   - 计算该零分布的均值 $\\mu_{\\mathrm{null}}$ 和标准差 $\\sigma_{\\mathrm{null}}$。\n   - 计算双侧蒙特卡洛$p$值，$p_{\\mathrm{two}} = (1 + C) / (1 + N_{\\mathrm{perm}})$，其中 $C$ 是满足 $|\\mathrm{MPD}_p - \\mu_{\\mathrm{null}}| \\geq |\\mathrm{MPD}_{\\mathrm{obs}} - \\mu_{\\mathrm{null}}|$ 的置换次数。\n   - 如果 $p_{\\mathrm{two}} < \\alpha$，则拒绝零假设。\n\n**数据与参数**\n- 区域物种库大小 $S=8$。\n- 物种库的功能性状向量 $\\mathbf{t} = (1.0, 1.2, 1.4, 2.0, 3.5, 4.0, 4.5, 5.0)$。\n- 置换次数 $N_{\\mathrm{perm}}=999$。\n- 显著性水平 $\\alpha=0.05$。\n- 用于可复现性的伪随机数种子：`2025`。\n- 三个目标群落的多度向量：\n  - 群落 A：$\\mathbf{a} = (30, 25, 20, 1, 1, 1, 1, 1)$。\n  - 群落 B：$\\mathbf{a} = (5, 5, 5, 5, 5, 5, 5, 5)$。\n  - 群落 C：$\\mathbf{a} = (40, 1, 1, 1, 1, 1, 1, 40)$。\n\n编写一个 Python 3 脚本，为上述三个群落中的每一个执行此检验，并确定是否应拒绝中性零假设。您的脚本必须以一个包含三个布尔值的列表形式打印其输出，每个值对应一个群落的决策（`True`表示拒绝，$False$表示不拒绝）。格式应为`[Result_A,Result_B,Result_C]`。\n\n**注意**：$\\mathrm{MPD}$ 的定义要求 $i, j$ 是不同物种的索引。在计算中，如果一个群落只包含一个物种，$\\mathrm{MPD}$ 是未定义的，但为了方便计算，可以将其设为$0$。", "solution": "问题陈述已经过严格审查，并被认定为有效。它在科学上是合理的、良构的、客观的，并为标准的生态学分析提供了一套完整且一致的定义和数据。该问题是关于实现一个蒙特卡洛置换检验的形式化练习，用以区分中性与基于生态位的群落构建模型，这是定量生态学中的一个基本课题。所有数学量都得到了严格定义，并且为得到唯一、可复现的解所需的所有参数都已提供。\n\n任务是为三个不同的生态群落以编程方式实现一个统计检验。该检验的核心是将群落中观测到的功能性状离散与一个零分布进行比较。这个零分布代表了在中性构建过程中预期的离散度，在该过程中，物种的性状与其多度无关。观测到的离散度与零期望的显著偏差是反对中性模型的证据，表明像环境过滤或限制相似性这样的基于生态位的过程可能正在构建该群落。\n\n选择的性状离散度量是多度加权的平均成对距离（Mean Pairwise Distance），即 $\\mathrm{MPD}$。对于一个拥有现存物种集合 $\\mathcal{I}$、物种多度向量 $\\mathbf{a}$ 和区域性状向量 $\\mathbf{t}$ 的群落，其观测值 $\\mathrm{MPD}_{\\mathrm{obs}}$ 计算如下：\n$$\n\\mathrm{MPD}_{\\mathrm{obs}} = \\frac{\\sum_{i<j, i,j \\in \\mathcal{I}} w_i w_j |t_i - t_j|}{\\sum_{i<j, i,j \\in \\mathcal{I}} w_i w_j}.\n$$\n其中 $w_i$ 是物种 $i$ 的相对多度。\n\n零假设是群落是中性构建的，即物种性状与其多度无关。零模型通过在区域物种库的 $S$ 个物种之间随机置换（洗牌）性状值来模拟这一假设。对于每次置换，使用置换后的性状向量和**固定的**观测多度向量重新计算 $\\mathrm{MPD}_p$。重复此过程 $N_{\\mathrm{perm}}$ 次，以生成 $\\mathrm{MPD}$ 值的零分布。\n\n统计决策基于双侧蒙特卡洛 $p$ 值。我们计算观测到的 $\\mathrm{MPD}_{\\mathrm{obs}}$ 与零分布均值 $\\mu_{\\mathrm{null}}$ 的绝对偏差。然后，我们计算零分布中有多少个值的绝对偏差至少与观测到的偏差一样大。如果这个比例（经过小样本校正）低于预定的显著性水平 $\\alpha$，我们拒绝零假设，并得出结论，群落的性状结构不太可能是由中性过程产生的。\n\n我们将此检验应用于三个具有不同多度结构的群落：\n- **群落A**：多度集中在性状相似的物种上（$1.0, 1.2, 1.4$）。这可能代表环境过滤，预期会导致 $\\mathrm{MPD}_{\\mathrm{obs}} < \\mu_{\\mathrm{null}}$（性状聚类）。\n- **群落B**：所有物种多度相等。预期 $\\mathrm{MPD}_{\\mathrm{obs}}$ 将接近 $\\mu_{\\mathrm{null}}$，因为多度是均匀的，不偏向任何特定的性状值。\n- **群落C**：多度集中在性状最不相似的物种上（$1.0, 5.0$）。这可能代表限制相似性，预期会导致 $\\mathrm{MPD}_{\\mathrm{obs}} > \\mu_{\\mathrm{null}}$（性状过度离散）。\n\n提供的Python代码完全实现了这一逻辑，它计算观测到的MPD，生成零分布，并根据双侧$p$值做出统计决策。我们执行此代码以获得三个群落的结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_mpd(traits: np.ndarray, abundances: np.ndarray) -> float:\n    \"\"\"\n    Computes the abundance-weighted Mean Pairwise Trait Distance (MPD).\n\n    Args:\n        traits: A 1D numpy array of trait values for all species in the pool.\n        abundances: A 1D numpy array of species abundances.\n\n    Returns:\n        The calculated MPD value.\n    \"\"\"\n    present_indices = np.where(abundances > 0)[0]\n    num_present = len(present_indices)\n\n    if num_present <= 1:\n        return 0.0\n\n    # Subset to only include present species for efficient calculation\n    present_abundances = abundances[present_indices]\n    present_traits = traits[present_indices]\n\n    total_abundance = np.sum(abundances)\n    if total_abundance == 0:\n        return 0.0\n    \n    # Calculate relative abundances for the present species\n    # These correspond to w_i for i in I\n    w = present_abundances / total_abundance\n\n    # Use broadcasting to create matrices of pairwise products and differences\n    weight_outer_product = np.outer(w, w)\n    trait_diff_matrix = np.abs(np.subtract.outer(present_traits, present_traits))\n\n    # The sums are over pairs i  j, which corresponds to the upper triangle (k=1)\n    # of the pairwise matrices.\n    numerator = np.sum(np.triu(weight_outer_product * trait_diff_matrix, k=1))\n    denominator = np.sum(np.triu(weight_outer_product, k=1))\n\n    if denominator == 0.0:\n        return 0.0\n\n    return numerator / denominator\n\ndef run_neutrality_test(traits_pool: np.ndarray, abundances: np.ndarray, \n                        n_perm: int, alpha: float) - bool:\n    \"\"\"\n    Performs a Monte Carlo test to check for deviation from a neutral null model.\n\n    Args:\n        traits_pool: The trait vector for the regional species pool.\n        abundances: The abundance vector for the focal community.\n        n_perm: The number of permutations for the null model.\n        alpha: The significance level for the test.\n\n    Returns:\n        A boolean indicating whether to reject the neutral null hypothesis (True) or not (False).\n    \"\"\"\n    # Calculate the observed MPD for the community\n    mpd_obs = calculate_mpd(traits_pool, abundances)\n\n    # Generate the null distribution of MPD values\n    mpd_null_dist = np.zeros(n_perm)\n    for i in range(n_perm):\n        # Null model: shuffle trait labels across the entire species pool\n        permuted_traits = np.random.permutation(traits_pool)\n        mpd_null_dist[i] = calculate_mpd(permuted_traits, abundances)\n\n    # Calculate summary statistics of the null distribution\n    mu_null = np.mean(mpd_null_dist)\n    # Use ddof=1 for sample standard deviation, as is standard practice\n    sigma_null = np.std(mpd_null_dist, ddof=1)\n\n    # If null distribution has zero variance, p_value is 1 (cannot reject)\n    if sigma_null == 0.0:\n        # This occurs when MPD is invariant to trait permutation, e.g., Case B.\n        # In this situation, mpd_obs must equal mu_null.\n        # The condition |MPD_p - mu_null| >= |mpd_obs - mu_null| becomes 0 >= 0,\n        # which is true for all permutations.\n        # p_two = (1 + n_perm) / (1 + n_perm) = 1.0.\n        # Since 1.0  alpha is always false, we can return False directly.\n        return False\n\n    # Calculate the two-sided Monte Carlo p-value\n    abs_dev_obs = np.abs(mpd_obs - mu_null)\n    abs_dev_null = np.abs(mpd_null_dist - mu_null)\n    \n    # Count how many null deviations are at least as extreme as the observed one\n    count_extreme = np.sum(abs_dev_null = abs_dev_obs)\n    \n    p_two = (1.0 + count_extreme) / (1.0 + n_perm)\n    \n    # Reject the null hypothesis if the p-value is below the significance level\n    return p_two  alpha\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for all specified test cases.\n    \"\"\"\n    # Define parameters from the problem statement\n    S = 8\n    traits_pool = np.array([1.0, 1.2, 1.4, 2.0, 3.5, 4.0, 4.5, 5.0])\n    N_perm = 999\n    alpha = 0.05\n    seed = 2025\n    \n    # Set the pseudorandom seed for reproducibility\n    np.random.seed(seed)\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        # Case A (clustered weights on similar traits)\n        np.array([30, 25, 20, 1, 1, 1, 1, 1]),\n        # Case B (balanced across the pool)\n        np.array([5, 5, 5, 5, 5, 5, 5, 5]),\n        # Case C (weights on extreme trait values)\n        np.array([40, 1, 1, 1, 1, 1, 1, 40]),\n    ]\n\n    results = []\n    for abundances in test_cases:\n        decision = run_neutrality_test(traits_pool, abundances, N_perm, alpha)\n        results.append(decision)\n\n    # Final print statement in the exact required format\n    # The map(str,...) on booleans produces \"True\" and \"False\" as required.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2575534"}]}