{"hands_on_practices": [{"introduction": "性别之谜的核心在于其巨大的繁殖成本。这项练习将引导你通过基本的人口统计学原理，推导“有性生殖的双重代价”，即在其他条件相同的情况下，有性生殖种群的增长速度为何仅为无性生殖种群的一半。掌握这一基本计算是理解为何有性生殖的维持是进化生物学中一个核心问题的关键。[@problem_id:2547512]", "problem": "在一个比较动物学和植物学的背景下，考虑两个专性繁殖的种群：一个专性无性繁殖谱系和一个专性有性繁殖谱系。假设种群规模庞大，种群动态与密度无关，且时间是连续的。对于这两种策略，假设雌性个体的人均繁殖力 $b$ 相等，定义为成年雌性产下新生个体（合子或克隆后代）的瞬时速率，且雌性个体的人均死亡率 $d$ 也相等。在有性繁殖谱系中，假设 Fisher 原理产生相等的初始性别比，因此新生个体中有 $1/2$ 的比例是雌性，并且只有雌性后代对下一代的繁殖雌性群体有贡献。在无性繁殖谱系中，假设所有后代都是雌性（克隆雌性）。通过将 $b$ 和 $d$ 解释为繁殖雌性群体的有效速率，忽略幼年阶段和成熟延迟。\n\n使用马尔萨斯参数的定义，即繁殖雌性种群的瞬时人均指数增长率，从第一性原理出发，推导出无性繁殖谱系的马尔萨斯参数与有性繁殖谱系的马尔萨斯参数之比，并用 $b$ 和 $d$ 表示。您的推导必须从雌性人均出生和死亡过程的定义开始，并应论证任何性别比因子的合理性。请将您的最终答案表示为关于 $b$ 和 $d$ 的单个闭式解析表达式。无需四舍五入。最终答案中不要包含单位。", "solution": "本题要求推导专性无性繁殖谱系的马尔萨斯参数与专性有性繁殖谱系的马尔萨斯参数之比。马尔萨斯参数，我们记为 $r$，定义为繁殖雌性种群的瞬时人均指数增长率。\n\n令 $N(t)$ 表示时间 $t$ 时的繁殖雌性数量。在密度无关的假设下，该种群的动态由以下微分方程描述：\n$$\n\\frac{dN}{dt} = r N\n$$\n参数 $r$ 是人均出生和死亡的净结果。具体来说，它是雌性的人均出生率 $b_f$ 减去雌性的人均死亡率 $d_f$。\n$$\nr = b_f - d_f\n$$\n我们现在将这一基本原理应用于问题描述中的每个谱系。\n\n首先，考虑**专性无性繁殖谱系**。设其马尔萨斯参数为 $r_a$。雌性的人均繁殖力给定为 $b$。在这个谱系中，所有后代都是克隆雌性。因此，单个雌性产生新雌性的速率恰好是 $b$。因此，无性繁殖种群的雌性人均出生率 $b_{f, a}$ 为：\n$$\nb_{f, a} = b\n$$\n雌性的人均死亡率给定为 $d$。因此，$d_{f, a} = d$。\n因此，无性繁殖谱系的马尔萨斯参数 $r_a$ 为：\n$$\nr_a = b_{f, a} - d_{f, a} = b - d\n$$\n\n接下来，考虑**专性有性繁殖谱系**。设其马尔萨斯参数为 $r_s$。雌性的人均繁殖力同样给定为 $b$。然而，问题陈述指出，对于这个谱系，维持了相等的初始性别比，这意味着新生个体中只有 $1/2$ 的比例是雌性。雌性种群的增长完全取决于新雌性的产生。因此，雌性的有效人均出生率 $b_{f, s}$ 是总繁殖率 $b$ 乘以雌性后代的比例，即 $1/2$。\n$$\nb_{f, s} = b \\times \\frac{1}{2} = \\frac{b}{2}\n$$\n这种有效雌性出生率减半是“有性生殖双重代价”的数学表示，其中繁殖资源被分配用于产生雄性，而雄性并不直接贡献于下一代繁殖个体的数量。雌性的人均死亡率与无性繁殖情况相同，即 $d_{f, s} = d$。\n因此，有性繁殖谱系的马尔萨斯参数 $r_s$ 为：\n$$\nr_s = b_{f, s} - d_{f, s} = \\frac{b}{2} - d\n$$\n\n最后，我们必须计算无性繁殖马尔萨斯参数与有性繁殖马尔萨斯参数之比，即 $\\frac{r_a}{r_s}$。使用上面推导出的表达式：\n$$\n\\frac{r_a}{r_s} = \\frac{b - d}{\\frac{b}{2} - d}\n$$\n为了将此表达式简化为所需的闭式形式，我们将分子和分母同时乘以 $2$：\n$$\n\\frac{r_a}{r_s} = \\frac{2(b - d)}{2 \\left(\\frac{b}{2} - d\\right)} = \\frac{2(b - d)}{b - 2d}\n$$\n这就是所要求的比率的最终解析表达式。", "answer": "$$\\boxed{\\frac{2(b - d)}{b - 2d}}$$", "id": "2547512"}, {"introduction": "有性生殖的代价不仅限于产生雄性。通过孟德尔遗传的分离定律，有性生殖还会持续性地拆散适应性强的基因组合，这个过程会产生“分离负荷”（segregation load）。此练习通过一个经典的杂合子优势模型，让你量化无性生殖系（能够克隆最优基因型）相对于有性生殖种群（因基因分离而不断产生次优后代）的适合度优势。[@problem_id:2547339]", "problem": "一个二倍体物种（动物或植物）携带一个具有等位基因 $A$ 和 $a$ 的单一位点。生存力选择仅作用于该位点，并表现出对称性杂合子优势（超显性）：基因型生存力分别为 $w_{\\mathrm{AA}}=1-s$，$w_{\\mathrm{Aa}}=1$ 和 $w_{\\mathrm{aa}}=1-s$，其中 $0  s \\le 1$。一个克隆的无性繁殖谱系已经出现，它可以完美地繁殖最优基因型（$Aa$）。该无性繁殖谱系的适合度 $w_{\\mathrm{asex}}$ 定义为它所繁殖的基因型的生存力。一个与之竞争的有性繁殖种群正在进行随机交配，并且处于由选择维持的多态性平衡状态。该有性种群的平均适合度 $\\bar{w}_{\\mathrm{sex}}$ 由哈代-温伯格原理和选择后的基因型频率加权平均值给出。\n\n计算无性繁殖谱系和有性种群之间的适合度差异 $D = w_{\\mathrm{asex}} - \\bar{w}_{\\mathrm{sex}}$。然后，将此差异评估为 $s=0.1$ 时的数值，四舍五入到两位小数。", "solution": "该问题要求计算一个无性繁殖谱系与一个处于平衡状态的有性种群之间的适合度差异 $D$。其定义为 $D = w_{\\mathrm{asex}} - \\bar{w}_{\\mathrm{sex}}$。我们将首先验证问题陈述的有效性，然后通过分别计算 $w_{\\mathrm{asex}}$ 和 $\\bar{w}_{\\mathrm{sex}}$ 这两项来解决问题。\n\n首先，验证问题陈述的有效性。\n给定条件如下：\n- 一个二倍体物种，拥有一个双等位基因座，等位基因为 $A$ 和 $a$。\n- 基因型生存力（适合度）：$w_{\\mathrm{AA}}=1-s$，$w_{\\mathrm{Aa}}=1$，$w_{\\mathrm{aa}}=1-s$。\n- 选择系数 $s$ 的范围是：$0  s \\le 1$。\n- 无性繁殖谱系完美地繁殖最优基因型。在杂合子优势模型中，最优基因型是 $Aa$，其适合度为 $1$。\n- 有性种群处于多态性平衡状态，并进行随机交配。\n\n这些条件共同定义了一个经典的单一位点超显性模型，该模型是群体遗传学中的一个标准场景。因此，该问题是有效的。\n\n**第 1 步：计算无性繁殖谱系的适合度 ($w_{\\mathrm{asex}}$)**\n无性繁殖谱系克隆最优基因型 $Aa$。根据定义，其适合度等于该基因型的适合度：\n$w_{\\mathrm{asex}} = w_{\\mathrm{Aa}} = 1$。\n\n**第 2 步：计算有性种群的平均适合度 ($\\bar{w}_{\\mathrm{sex}}$)**\n有性种群处于平衡状态。对于具有对称性杂合子优势的单一位点模型，等位基因 $A$ 的平衡频率 $p_{eq}$ 和等位基因 $a$ 的平衡频率 $q_{eq}$ 都是 $1/2$。\n$p_{eq} = q_{eq} = 0.5$。\n\n在随机交配下，受精时的基因型频率遵循哈代-温伯格比例：\n- 基因型 $AA$ 的频率 $= p_{eq}^2 = (0.5)^2 = 0.25$\n- 基因型 $Aa$ 的频率 $= 2 p_{eq} q_{eq} = 2(0.5)(0.5) = 0.5$\n- 基因型 $aa$ 的频率 $= q_{eq}^2 = (0.5)^2 = 0.25$\n\n种群的平均适合度 $\\bar{w}_{\\mathrm{sex}}$ 是这些基因型频率乘以其各自适合度的加权平均值：\n$\\bar{w}_{\\mathrm{sex}} = (p_{eq}^2) w_{\\mathrm{AA}} + (2 p_{eq} q_{eq}) w_{\\mathrm{Aa}} + (q_{eq}^2) w_{\\mathrm{aa}}$\n$\\bar{w}_{\\mathrm{sex}} = 0.25(1-s) + 0.5(1) + 0.25(1-s)$\n$\\bar{w}_{\\mathrm{sex}} = (0.25 + 0.5 + 0.25) - 0.25s - 0.25s$\n$\\bar{w}_{\\mathrm{sex}} = 1 - 0.5s$\n\n**第 3 步：计算适合度差异 $D$**\n$D = w_{\\mathrm{asex}} - \\bar{w}_{\\mathrm{sex}}$\n$D = 1 - (1 - 0.5s)$\n$D = 0.5s$\n\n**第 4 步：评估 $s=0.1$ 时的 $D$**\n将 $s=0.1$ 代入上式：\n$D = 0.5 \\times 0.1 = 0.05$\n\n该结果表示，在这种情况下，有性种群的平均适合度比能够克隆最优杂合子的无性繁殖谱系低 $5\\%$。这种适合度下降是由孟德尔遗传的分离作用引起的，它不断地从杂合子亲本中产生适合度较低的纯合子后代，即“分离负荷”。", "answer": "$$\\boxed{0.05}$$", "id": "2547339"}, {"introduction": "面对如此高昂的成本，有性生殖为何能广泛存在？“红色皇后假说”（Red Queen hypothesis）提供了一个强有力的解释，即与寄生虫等敌手的持续共同进化可能是有性生殖的关键优势。这项实践将让你从理论推导转向计算模拟，通过编写程序来模拟宿主与寄生虫的动态，并运用时间序列分析方法来验证红色皇后动力学的标志性特征，从而深入理解负频率依赖选择如何维持有性生殖。[@problem_id:2547486]", "problem": "给定一个宿主-寄生虫在负频率依赖选择下的协同进化概念框架，该框架通常被用来解释红皇后假说下有性繁殖的优势。考虑一个宿主物种，它有两种单倍体基因型，标记为 $A$ 和 $B$。在离散时间 $t$，基因型 $A$ 的频率记为 $x_t \\in (0,1)$，基因型 $B$ 的频率则为 $1 - x_t$。有两种寄生虫株，分别特化于每种宿主基因型。特化于 $A$ 的寄生虫株的流行率记为 $y_{A,t} \\in (0,1)$, 特化于 $B$ 的寄生虫株的流行率记为 $y_{B,t} = 1 - y_{A,t}$。所有量均为无量纲的频率和流行率。\n\n基本的种群遗传动力学由选择的离散时间复制子方程定义。如果在时间 $t$，宿主基因型 $A$ 和 $B$ 的相对适应度分别为 $w_{A,t}$ 和 $w_{B,t}$，那么宿主基因型频率的变化由以下方程决定：\n$$\nx_{t+1} \\;=\\; \\frac{x_t \\, w_{A,t}}{x_t \\, w_{A,t} + (1 - x_t) \\, w_{B,t}}.\n$$\n假设寄生虫通过基因型特异性的适应度抑制来施加负频率依赖选择，抑制的幅度 $s \\ge 0$ 与匹配的寄生虫流行率成正比：\n$$\nw_{A,t} \\;=\\; 1 - s\\, y_{A,t}, \\qquad w_{B,t} \\;=\\; 1 - s\\, y_{B,t}.\n$$\n假设寄生虫流行率通过一个引入了延迟的线性追踪规则来适应宿主的构成：\n$$\ny_{A,t+1} \\;=\\; y_{A,t} \\;+\\; \\gamma \\, (x_t - y_{A,t}), \\qquad \\gamma \\in [0,1],\n$$\n并且 $y_{B,t} = 1 - y_{A,t}$。\n\n根据这些定义，一个经过充分检验的复制子更新的弱选择近似得出\n$$\nx_{t+1} - x_t \\;\\approx\\; s \\, x_t \\, (1 - x_t) \\, \\big(y_{B,t} - y_{A,t}\\big),\n$$\n这意味着转换后的频率变化与寄生虫差异 $\\big(y_{B,t} - y_{A,t}\\big)$ 之間存在线性关系。这为使用回归从时间序列估计 $s$ 提供了一条有原则的途径。\n\n你的任务是编写一个完整的程序，对下面指定的每个测试用例，完成以下操作：\n- 对于给定的参数 $(T, s, \\gamma, x_0, y_{A,0})$，使用上述方程模拟宿主-寄生虫时间序列 $\\{x_t, y_{A,t}\\}_{t=0}^{T-1}$。\n- 仅使用模拟的时间序列，而不使用已知的参数值，推断模拟数据中是否出现了与红皇后假说一致的循环动力学。\n- 使用基于弱选择近似的回归方法，从模拟的时间序列中估计选择强度 $s$。\n\n本问题中“与红皇后假说一致”的定义：\n- 在 $x_t$ 中必须存在一个非零频率的主导振荡分量。将此形式化为：计算后续分析窗口内均值中心化的宿主序列的离散傅里葉變換（DFT）功率谱，识别出周期为 $P$（单位为时间步）的最大非零频率峰值，并要求该峰值的功率与所有非零频率功率中位数的比率超过一个阈值 $\\rho^\\star$。\n- 必须存在与对抗性协同进化一致的“宿主引导寄生虫”的相位关系：计算分析窗口内 $x_t$ 和 $y_{A,t}$ 之间的互相关，将其作为非负整数延迟 $\\ell$ 的函数，并找出使 $x_t$ 和 $y_{A,t+\\ell}$ 之间相关性最大化的延迟 $\\ell^\\star \\in \\{1,2,\\dots,\\lfloor P \\rfloor - 1\\}$。计算相位分数 $\\phi = \\ell^\\star / P$ 并要求 $|\\phi - 1/4| \\le \\delta^\\star$。\n- 基于回归的 $s$ 估计值必须为正，并超过一个最小可检测值 $s^\\star$。\n\n$s$ 的估计：\n- 对于分析窗口中的每个 $t$，定义转换后的响应变量\n$$\nr_t \\;=\\; \\frac{x_{t+1} - x_t}{x_t \\, (1 - x_t)},\n$$\n和预测变量\n$$\nz_t \\;=\\; y_{B,t} - y_{A,t} \\;=\\; 1 - 2 y_{A,t}.\n$$\n在线性模型 $r_t = s \\, z_t + \\varepsilon_t$ 中通过普通最小二乘法估计 $s$，即\n$$\n\\hat{s} \\;=\\; \\frac{\\sum_t z_t \\, r_t}{\\sum_t z_t^2},\n$$\n计算时，$t$ 的取值范围是分析窗口内滿足 $x_t \\in [\\epsilon, 1 - \\epsilon]$ 的部分，其中 $\\epsilon$ 是一个很小的数，以避免除以接近 $0$ 的值。\n\n分析窗口和阈值：\n- 使用后续窗口，包含时间序列的后 $3/4$ 部分，即时间索引 $t \\in \\{\\lfloor T/4 \\rfloor, \\dots, T-1\\}$。\n- 使用阈值 $\\rho^\\star = 2.0$, $\\delta^\\star = 0.2$ 和 $s^\\star = 0.05$。\n- 为保证数值稳定性，使用 $\\epsilon = 10^{-6}$。\n\n测试套件：\n- 案例 1: $(T, s, \\gamma, x_0, y_{A,0}) = (256, 0.6, 0.2, 0.55, 0.45)$。\n- 案例 2: $(T, s, \\gamma, x_0, y_{A,0}) = (256, 0.0, 0.3, 0.52, 0.50)$。\n- 案例 3: $(T, s, \\gamma, x_0, y_{A,0}) = (256, 0.2, 0.25, 0.60, 0.40)$。\n- 案例 4: $(T, s, \\gamma, x_0, y_{A,0}) = (256, 0.5, 0.0, 0.50, 0.50)$。\n\n输出规格：\n- 对每个案例，输出一个包含 $2$ 个元素的列表 $[b, \\hat{s}]$，其中 $b$ 是一个布尔值，表示根据上述决策规则是否推断出与红皇后假说一致的循环，$\\hat{s}$ 是估计的选择强度，四舍五入到三位小数（作为数值浮点数）。将 $4$ 个案例的结果按顺序汇总到一个列表中。\n- 你的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表（例如：\"[[True,0.603],[False,0.000],[True,0.198],[False,0.000]]\"）。不要打印任何其他文本。\n\n所有量都是无量纲的；不涉及物理单位或角度。计算必须仅使用给定的更新方程和分析规则，不得参考外部数据。", "solution": "该问题提出了一个定义明确的计算任务，它基于一个标准的宿主-寄生虫在负频率依赖选择下的协同进化模型，这是红皇后假说的基石。该问题具有科学依据、数学上完备且算法上明确。因此，它是有效的。\n\n任务是模拟协同进化动力学，然后分析生成的时间序列，以检验是否存在红皇后动力学的特征，并估计选择强度 $s$。解决方案分为两个主要阶段：模拟和分析。\n\n**1. 宿主-寄生虫动力学模拟**\n\n在任何离散时间步 $t$，系统状态由宿主基因型频率 $x_t$（对于基因型 $A$）和寄生虫流行率 $y_{A,t}$（对于适应 $A$ 的寄生虫株）描述。给定了初始状态 $(x_0, y_{A,0})$，以及总模拟时间 $T$、选择强度 $s$ 和寄生虫追踪率 $\\gamma$ 等参数。\n\n时间序列 $\\{x_t\\}_{t=0}^{T-1}$ 和 $\\{y_{A,t}\\}_{t=0}^{T-1}$ 是迭代生成的。对于从 $0$ 到 $T-2$ 的每个时间步 $t$，我们计算时间 $t+1$ 的状态：\n\n首先，我们将宿主基因型 $B$ 的频率定义为 $1 - x_t$，并将适应 $B$ 的寄生虫株的流行率定义为 $y_{B,t} = 1 - y_{A,t}$。\n\n宿主基因型的相对适应度由匹配的寄生虫株的流行率决定，并受选择系数 $s$ 的影响：\n$$\nw_{A,t} = 1 - s \\cdot y_{A,t}\n$$\n$$\nw_{B,t} = 1 - s \\cdot (1 - y_{A,t})\n$$\n\n下一时间步的宿主基因型 $A$ 的频率 $x_{t+1}$ 使用离散时间复制子方程计算，该方程描述了基因型频率在选择作用下的变化。新频率是旧频率乘以其相对适应度，再通过种群的平均适应度 $\\bar{w}_t$进行归一化：\n$$\n\\bar{w}_t = x_t \\, w_{A,t} + (1 - x_t) \\, w_{B,t}\n$$\n$$\nx_{t+1} = \\frac{x_t \\, w_{A,t}}{\\bar{w}_t}\n$$\n\n与此同时，寄生虫的流行率会适应宿主的基因型频率。下一时间步适应宿主 $A$ 的寄生虫株的流行率 $y_{A,t+1}$ 根据带有延迟参数 $\\gamma$ 的线性追踪规则进行更新：\n$$\ny_{A,t+1} = y_{A,t} + \\gamma \\, (x_t - y_{A,t})\n$$\n这个过程重复 $T-1$ 步以生成完整的时间序列。\n\n**2. 时间序列分析**\n\n分析在模拟数据的后续窗口上进行，该窗口定义为时间索引 $t \\in \\{\\lfloor T/4 \\rfloor, \\dots, T-1\\}$。设 $N_w = T - \\lfloor T/4 \\rfloor$ 为此分析窗口的长度。红皇后动力学的推断基于三个具体标准。\n\n**条件 1：主导振荡分量**\n该条件验证宿主动态是否表现出持续振荡，这是红皇后协同进化的一个标志。\n- 分析窗口内的宿主频率时间序列 $x_w = \\{x_t\\}_{t=\\lfloor T/4 \\rfloor}^{T-1}$ 首先进行均值中心化处理。\n- 使用实值离散傅里葉變換（DFT）计算这个均值中心化序列的功率谱。功率是 DFT 系数的幅度平方。\n- 我们在所有非零频率中识别出峰值功率。设此峰值频率对应的周期为 $P$。\n- 计算此峰值功率与所有非零频率功率中位数的比率 $\\rho$。\n- 如果 $\\rho > \\rho^\\star$（其中 $\\rho^\\star = 2.0$），则满足此条件。这确保了峰值是显著的，而不仅仅是随机波动。\n\n**条件 2：宿主引导寄生虫的相位关系**\n对抗性协同进化预测，宿主种群的变化之后应跟随着寄生虫种群的适应性变化。这意味着一个特定的相位滞后。\n- 仅当条件 1 满足且找到了一个周期 $P \\ge 2$ 时，才检查此条件。\n- 我们计算宿主序列 $x_t$ 和一个时间提前的寄生虫序列 $y_{A,t+\\ell}$ 之间的皮尔逊相关系数，其中整数延迟 $\\ell$ 的范围为 $\\{1, 2, \\dots, \\lfloor P \\rfloor-1\\}$。对于给定的 $\\ell$，相关性在分析窗口的重叠部分上计算。\n- 找出使该相关性最大化的延迟 $\\ell^\\star$。\n- 计算相位分数 $\\phi = \\ell^\\star / P$。红皇后假说预测存在四分之一周期的延迟（$\\phi \\approx 1/4$）。\n- 如果 $|\\phi - 1/4| \\le \\delta^\\star$（其中 $\\delta^\\star = 0.2$），则满足此条件。\n\n**条件 3：正向选择估计**\n整个动力学都基于选择是活跃的（$s > 0$）这一前提。我们从数据中估计 $s$ 并验证它足够大。\n- 估计使用提供的弱选择近似：$x_{t+1} - x_t \\approx s \\, x_t(1-x_t)(y_{B,t} - y_{A,t})$。\n- 这可以重新排列成一个过原点的线性回归模型：$r_t = s \\, z_t$，其中响应变量是 $r_t = \\frac{x_{t+1} - x_t}{x_t(1 - x_t)}$，预测变量是 $z_t = y_{B,t} - y_{A,t} = 1 - 2y_{A,t}$。\n- $s$ 的普通最小二乘（OLS）估计是 $\\hat{s} = \\frac{\\sum z_t r_t}{\\sum z_t^2}$。\n- 总和是在分析窗口（从 $t = \\lfloor T/4 \\rfloor$ 到 $T-2$）上计算的，排除了 $x_t$ 太接近 $0$ 或 $1$ 的点（即，对于 $\\epsilon = 10^{-6}$，$x_t \\notin [\\epsilon, 1-\\epsilon]$），以确保数值稳定性。\n- 如果分母 $\\sum z_t^2$ 为零，这意味着预测变量没有变化，则 $\\hat{s}$ 取为 $0$。\n- 如果 $\\hat{s} > s^\\star$（其中 $s^\\star = 0.05$），则满足此条件。\n\n最后，当且仅当所有三个条件都满足时，给定测试用例的动力学才被归类为“与红皇后假说一致”。然后程序报告这个布尔结果以及估计的选择强度 $\\hat{s}$（四舍五入到三位小数）。", "answer": "```python\nimport numpy as np\nfrom scipy import fft\n\ndef solve():\n    \"\"\"\n    Solves the host-parasite coevolution problem for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        (256, 0.6, 0.2, 0.55, 0.45),\n        (256, 0.0, 0.3, 0.52, 0.50),\n        (256, 0.2, 0.25, 0.60, 0.40),\n        (256, 0.5, 0.0, 0.50, 0.50),\n    ]\n\n    results = []\n    for params in test_cases:\n        result = analyze_case(*params)\n        results.append(result)\n\n    # Format the output string as per the specification\n    final_strings = []\n    for res in results:\n        bool_str = str(res[0])\n        # Ensure float is formatted with 3 decimal places\n        float_str = f\"{res[1]:.3f}\"\n        final_strings.append(f\"[{bool_str},{float_str}]\")\n    \n    print(f\"[{','.join(final_strings)}]\")\n\ndef analyze_case(T, s, gamma, x0, yA0):\n    \"\"\"\n    Runs the simulation and analysis for a single test case.\n\n    Args:\n        T (int): Total number of time steps.\n        s (float): Selection strength.\n        gamma (float): Parasite tracking rate.\n        x0 (float): Initial host genotype frequency.\n        yA0 (float): Initial parasite prevalence.\n\n    Returns:\n        list: A list [b, s_hat] where b is a boolean indicating Red Queen\n              consistency and s_hat is the estimated selection strength.\n    \"\"\"\n    # Define thresholds and constants\n    rho_star = 2.0\n    delta_star = 0.2\n    s_star = 0.05\n    epsilon = 1e-6\n\n    # 1. Simulation\n    x = np.zeros(T)\n    yA = np.zeros(T)\n    x[0], yA[0] = x0, yA0\n\n    for t in range(T - 1):\n        yB_t = 1.0 - yA[t]\n        wA_t = 1.0 - s * yA[t]\n        wB_t = 1.0 - s * yB_t\n        \n        mean_fitness = x[t] * wA_t + (1.0 - x[t]) * wB_t\n        \n        if mean_fitness  0:\n            x[t+1] = (x[t] * wA_t) / mean_fitness\n        else: # Should not happen with given constraints but good practice.\n            x[t+1] = x[t]\n\n        yA[t+1] = yA[t] + gamma * (x[t] - yA[t])\n    \n    # 2. Analysis\n    t_start = T // 4\n    analysis_window_len = T - t_start\n    x_w = x[t_start:]\n    yA_w = yA[t_start:]\n\n    # Condition 1: Oscillation\n    cond1 = False\n    P = 0.0\n    x_w_centered = x_w - np.mean(x_w)\n    \n    power_spectrum = np.abs(fft.rfft(x_w_centered))**2\n    freqs = fft.rfftfreq(analysis_window_len)\n    \n    power_nonzero = power_spectrum[1:]\n    freqs_nonzero = freqs[1:]\n    \n    median_power = np.median(power_nonzero) if len(power_nonzero)  0 else 0.0\n\n    if median_power  1e-9: # Use a small tolerance instead of zero\n        peak_power_idx_nz = np.argmax(power_nonzero)\n        peak_power = power_nonzero[peak_power_idx_nz]\n        rho = peak_power / median_power\n        if rho  rho_star:\n            cond1 = True\n            peak_freq = freqs_nonzero[peak_power_idx_nz]\n            if peak_freq  0:\n                P = 1.0 / peak_freq\n    \n    # Condition 2: Phase\n    cond2 = False\n    if cond1 and P = 2.0:\n        lag_max = int(np.floor(P)) - 1\n        lags = range(1, lag_max + 1)\n        if lags:\n            corrs = []\n            for l in lags:\n                # Correlate x_w(t) with yA_w(t+l)\n                # Slices must be of length  1 to compute correlation\n                if len(x_w) - l  1:\n                    corr_matrix = np.corrcoef(x_w[:-l], yA_w[l:])\n                    corrs.append(corr_matrix[0, 1])\n            \n            if corrs:\n                best_lag_idx = np.argmax(corrs)\n                l_star = lags[best_lag_idx]\n                phi = l_star / P\n                if abs(phi - 0.25) = delta_star:\n                    cond2 = True\n\n    # Condition 3: Selection estimate\n    sum_zr = 0.0\n    sum_z_sq = 0.0\n    \n    for t in range(t_start, T - 1):\n        if epsilon = x[t] = 1.0 - epsilon:\n            r_t = (x[t+1] - x[t]) / (x[t] * (1.0 - x[t]))\n            z_t = 1.0 - 2.0 * yA[t]\n            sum_zr += z_t * r_t\n            sum_z_sq += z_t**2\n\n    s_hat = 0.0\n    if sum_z_sq  1e-9: # Use a small tolerance\n        s_hat = sum_zr / sum_z_sq\n    \n    cond3 = s_hat  s_star\n        \n    is_red_queen = cond1 and cond2 and cond3\n    \n    return [is_red_queen, s_hat]\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2547486"}]}