{"hands_on_practices": [{"introduction": "在物种界定中，量化群体间的遗传分化是一种基本方法。固定指数 $F_{ST}$ 是衡量这一分化的核心指标，它反映了总遗传变异中由群体间差异所占的比例。本练习将引导你从原始的等位基因计数数据出发，亲手计算全基因组的 $F_{ST}$ 值，并运用自助法（bootstrapping）构建其置信区间，这是现代群体遗传学研究中评估物种分化程度的一项关键技能。然后，基于此分化程度，做出是否支持将这两个种群划分为不同物种的二元决策。", "problem": "给定两个种群在多个独立的双等位基因座上的等位基因计数数据。您的任务是编写一个程序，为每个数据集计算全基因组固定指数（表示为 $F_{ST}$），推导 $F_{ST}$ 的自举置信区间，然后根据生物学物种概念（BSC）和系统发育物种概念（PSC）的操作性解释，就是否有足够的遗传分化来支持将这两个种群识别为不同物种做出二元决策。仅使用等位基因计数中包含的信息。\n\n基本和建模假设：\n- 在每个位点，每个种群中，假设在采样时是一个处于Hardy–Weinberg平衡比例的随机交配二倍体种群，并且等位基因在不同位点间是独立抽样的。令 $p$ 表示某位点上参考等位基因的频率，预期杂合度（基因多样性）定义为 $H = 2 p (1 - p)$，即从同一群体中随机抽取的两个基因拷贝处于不同等位基因状态的概率。\n- 对于两个种群，将在一个位点上的种群内多样性组分定义为 $H_S$，其计算方法是种群内基因多样性的样本量加权平均值；将在该位点上的总（混合）多样性定义为 $H_T$，其由两个种群的混合等位基因频率计算得出。种群间多样性组分为 $H_T - H_S$。\n- 全基因组固定指数 $F_{ST}$ 定义为总基因多样性中可归因于种群间分化的比例，该比例在所有位点上进行汇总。通过对所有位点的种群间组分和总组分求和，然后取其比率，来跨位点进行汇总。$H_T = 0$ 的位点对分子和分母均无贡献。如果在自举过程中，某个重复的总分母为 $0$（即所有重采样位点的 $H_T = 0$），则按照惯例将其 $F_{ST}$ 值定义为 $0$。\n\n自举法（Bootstrapping）：\n- 对位点实施非参数自举法，进行 $B$ 次重采样。每个自举重复从 $L$ 个观测位点中有放回地重采样 $L$ 个位点，按上述方法重新计算汇总的 $F_{ST}$，并存储该值。\n- 使用百分位数法计算置信水平为 $0.95$ 的双侧置信区间，即自举分布的 $0.025$ 和 $0.975$ 经验分位数之间的区间。\n\n物种支持决策规则：\n- 给定一个物种分化阈值 $\\tau$（以小数形式表示，不带百分号），如果 $0.95$ 自举置信区间的下限超过 $\\tau$，则决策为真（true），否则为假（false）。\n\n数值细节和约束：\n- 使用 $B = 5000$ 次自举重复，并将伪随机数生成器的种子设置为 $1729$ 以保证可复现性。\n- 使用 $\\tau = 0.25$ 作为物种分化阈值。\n- 所有报告的 $F_{ST}$ 和置信区间界限值必须以小数形式打印，并精确到小数点后 $6$ 位。\n\n每个数据集的输入规范：\n- 对于种群 $i \\in \\{1,2\\}$ 和位点 $\\ell \\in \\{1,\\dots,L\\}$，给定非负整数的有序对 $(A_{i\\ell}, a_{i\\ell})$，分别代表在种群 $i$ 的位点 $\\ell$ 处抽样的基因拷贝中参考等位基因和替代等位基因的计数。令 $n_{i\\ell} = A_{i\\ell} + a_{i\\ell}$ 表示在种群 $i$ 的位点 $\\ell$ 处观测到的基因拷贝总数，并假设 $n_{i\\ell} \\ge 1$。\n\n单个位点 $\\ell$ 处的计算：\n- 计算 $p_{1\\ell} = A_{1\\ell} / n_{1\\ell}$ 和 $p_{2\\ell} = A_{2\\ell} / n_{2\\ell}$。\n- 计算 $H_{1\\ell} = 2 p_{1\\ell} (1 - p_{1\\ell})$ 和 $H_{2\\ell} = 2 p_{2\\ell} (1 - p_{2\\ell})$。\n- 令 $w_{1\\ell} = n_{1\\ell}/(n_{1\\ell} + n_{2\\ell})$ 和 $w_{2\\ell} = 1 - w_{1\\ell}$。\n- 计算 $H_{S\\ell} = w_{1\\ell} H_{1\\ell} + w_{2\\ell} H_{2\\ell}$。\n- 计算混合等位基因频率 $p_{T\\ell} = (A_{1\\ell} + A_{2\\ell})/(n_{1\\ell} + n_{2\\ell})$ 和 $H_{T\\ell} = 2 p_{T\\ell} (1 - p_{T\\ell})$。\n\n全基因组汇总：\n- 令 $\\mathcal{I} = \\{\\ell : H_{T\\ell} > 0\\}$ 为信息性位点的集合。计算\n$$\n\\widehat{F}_{ST} \\;=\\; \\frac{\\sum_{\\ell \\in \\mathcal{I}} \\left( H_{T\\ell} - H_{S\\ell} \\right)}{\\sum_{\\ell \\in \\mathcal{I}} H_{T\\ell}}.\n$$\n如果 $\\mathcal{I}$ 为空，则定义 $\\widehat{F}_{ST} = 0$。\n\n测试套件：\n为以下四个数据集提供结果。每个数据集是一个位点列表，每个位点以种群1和种群2的两个有序对 $(A,a)$ 的形式给出：\n\n- 数据集1（中等分化，6个位点）：\n  - 位点1：种群1 $(30,10)$，种群2 $(10,30)$。\n  - 位点2：种群1 $(18,22)$，种群2 $(12,28)$。\n  - 位点3：种群1 $(40,0)$，种群2 $(38,2)$。\n  - 位点4：种群1 $(25,15)$，种群2 $(15,25)$。\n  - 位点5：种群1 $(35,5)$，种群2 $(20,20)$。\n  - 位点6：种群1 $(28,12)$，种群2 $(12,28)$。\n- 数据集2（包括单态边缘案例，5个位点）：\n  - 位点1：种群1 $(40,0)$，种群2 $(0,40)$。\n  - 位点2：种群1 $(40,0)$，种群2 $(40,0)$。\n  - 位点3：种群1 $(20,20)$，种群2 $(10,30)$。\n  - 位点4：种群1 $(5,35)$，种群2 $(35,5)$。\n  - 位点5：种群1 $(18,22)$，种群2 $(18,22)$。\n- 数据集3（种群间接近一致，5个位点）：\n  - 位点1：种群1 $(24,16)$，种群2 $(24,16)$。\n  - 位点2：种群1 $(30,10)$，种群2 $(30,10)$。\n  - 位点3：种群1 $(10,30)$，种群2 $(10,30)$。\n  - 位点4：种群1 $(35,5)$，种群2 $(35,5)$。\n  - 位点5：种群1 $(20,20)$，种群2 $(20,20)$。\n- 数据集4（高度分化，小样本，6个位点；此处每个种群每个位点有20个基因拷贝）：\n  - 位点1：种群1 $(20,0)$，种群2 $(0,20)$。\n  - 位点2：种群1 $(18,2)$，种群2 $(1,19)$。\n  - 位点3：种群1 $(20,0)$，种群2 $(2,18)$。\n  - 位点4：种群1 $(17,3)$，种群2 $(0,20)$。\n  - 位点5：种群1 $(19,1)$，种群2 $(0,20)$。\n  - 位点6：种群1 $(16,4)$，种群2 $(0,20)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个Python风格的结果列表，每个数据集一个结果，顺序与上述相同。每个结果本身必须是一个包含四个元素的列表：$[\\widehat{F}_{ST}, \\text{CI\\_low}, \\text{CI\\_high}, \\text{decision}]$，其中三个实数四舍五入到小数点后恰好$6$位，决策值为True或False。例如，一个有效的单个结果可以是$[0.271234,0.198765,0.345678,True]$。整个输出必须是类似 $[[...],[...],[...],[...]]$ 的单行，不含任何额外文本。", "solution": "该问题是有效的，因为它在群体遗传学方面有科学依据，定义清晰，约束明确，表述客观。任务是根据等位基因计数数据计算固定指数$F_{ST}$及其自举置信区间，然后应用物种分化决策规则。该方法实现如下。\n\n分析的核心是计算Wright的固定指数 $\\widehat{F}_{ST}$，它量化了种群分化。它被定义为总基因多样性（$H_T$）中由种群间等位基因频率差异（$H_T - H_S$）引起的部分所占的比例。\n\n对于总共 $L$ 个位点中的每个双等位基因座 $\\ell$，我们给出了两个种群（索引为 $i \\in \\{1, 2\\}$）的等位基因计数 $(A_{i\\ell}, a_{i\\ell})$。\n\n首先，对于每个位点 $\\ell$，我们计算各种群和混合种群的遗传多样性统计数据。\n1.  从种群 $i$ 中抽样的基因拷贝数为 $n_{i\\ell} = A_{i\\ell} + a_{i\\ell}$。问题保证 $n_{i\\ell} \\ge 1$。\n2.  种群 $i$ 中参考等位基因的频率是 $p_{i\\ell} = A_{i\\ell} / n_{i\\ell}$。\n3.  种群 $i$ 内的预期杂合度（或基因多样性）为 $H_{i\\ell} = 2 p_{i\\ell} (1 - p_{i\\ell})$。这代表了从种群 $i$ 中随机选择的两个基因拷贝属于不同等位基因类型的概率。\n4.  平均种群内基因多样性 $H_{S\\ell}$ 是各种群多样性的加权平均值，权重是各种群的相对样本量：\n    $$ H_{S\\ell} = w_{1\\ell} H_{1\\ell} + w_{2\\ell} H_{2\\ell} $$\n    其中 $w_{i\\ell} = n_{i\\ell} / (n_{1\\ell} + n_{2\\ell})$。\n5.  为了计算总基因多样性 $H_{T\\ell}$，我们首先计算跨两个种群的混合等位基因频率 $p_{T\\ell}$：\n    $$ p_{T\\ell} = \\frac{A_{1\\ell} + A_{2\\ell}}{n_{1\\ell} + n_{2\\ell}} $$\n    然后，总基因多样性就是混合种群中的预期杂合度：\n    $$ H_{T\\ell} = 2 p_{T\\ell} (1 - p_{T\\ell}) $$\n\n接下来，我们将这些统计数据在所有位点上进行汇总，以获得全基因组估计值 $\\widehat{F}_{ST}$。该估计量是和的比率，而不是比率的和。我们只考虑信息性位点，即 $H_{T\\ell} > 0$ 的位点。令 $\\mathcal{I}$ 为这些信息性位点的索引集。点估计值为：\n$$ \\widehat{F}_{ST} = \\frac{\\sum_{\\ell \\in \\mathcal{I}} (H_{T\\ell} - H_{S\\ell})}{\\sum_{\\ell \\in \\mathcal{I}} H_{T\\ell}} $$\n如果分母为零（即混合样本中没有多态性位点），则 $\\widehat{F}_{ST}$ 定义为 $0$。\n\n为了评估 $\\widehat{F}_{ST}$ 的统计不确定性，我们采用非参数自举程序。\n1.  为保证可复现性，使用 $1729$ 作为伪随机数生成器的种子。\n2.  我们执行 $B = 5000$ 次自举重复。在每次重复中，我们通过从原始的 $L$ 个位点集合中有放回地抽样，创建一个包含 $L$ 个位点的新数据集。\n3.  对于每个自举数据集，我们使用预先计算的各位点组分 $(H_{T\\ell} - H_{S\\ell})$ 和 $H_{T\\ell}$ 重新计算全基因组 $F_{ST}$ 值。如果某个自举重复的 $F_{ST}$ 计算分母为零，则其值设为 $0$。\n4.  这个过程产生了一个包含 $5000$ 个 $F_{ST}$ 自举估计值的分布。\n\n根据这个自举分布，我们使用百分位数法构建一个 $95\\%$ 的置信区间。下界 $\\text{CI\\_low}$ 是排序后自举值的第 $2.5$ 个百分位数（经验分位数为 $0.025$），上界 $\\text{CI\\_high}$ 是第 $97.5$ 个百分位数（经验分位数为 $0.975$）。\n\n最后，根据观察到的遗传分化是否支持将这些种群识别为不同物种做出决策。该决策基于一个预定义阈值 $\\tau = 0.25$。\n-   如果置信区间的下界严格大于阈值：$\\text{CI\\_low} > \\tau$，则决策为 `True`。\n-   否则，决策为 `False`。\n\n此程序独立应用于所提供的四个数据集中的每一个。最终的数值结果（$\\widehat{F}_{ST}$、$\\text{CI\\_low}$、$\\text{CI\\_high}$）四舍五入至小数点后六位进行报告。", "answer": "```python\nimport numpy as np\n\ndef process_dataset(locus_data, B, tau, seed):\n    \"\"\"\n    Computes F_ST, bootstrap CI, and species differentiation decision for a single dataset.\n    \n    Args:\n        locus_data (list): A list of tuples, where each tuple represents a locus and\n                           contains two sub-tuples with allele counts for pop1 and pop2.\n                           Format: [((A1, a1), (A2, a2)), ...].\n        B (int): The number of bootstrap replicates.\n        tau (float): The species-differentiation threshold.\n        seed (int): The seed for the random number generator.\n    \n    Returns:\n        list: A list containing [F_ST_hat, CI_low, CI_high, decision].\n    \"\"\"\n    \n    # 1. Pre-calculate per-locus components for F_ST\n    num_components = []\n    den_components = []\n\n    for pop1_counts, pop2_counts in locus_data:\n        A1, a1 = pop1_counts\n        A2, a2 = pop2_counts\n\n        n1 = A1 + a1\n        n2 = A2 + a2\n        \n        # Allele frequencies for each population\n        p1 = A1 / n1\n        p2 = A2 / n2\n        \n        # Gene diversity (expected heterozygosity) within each population\n        H1 = 2.0 * p1 * (1.0 - p1)\n        H2 = 2.0 * p2 * (1.0 - p2)\n        \n        # Total sample size for the locus\n        n_total = n1 + n2\n        \n        # Average within-population gene diversity\n        w1 = n1 / n_total\n        H_S = w1 * H1 + (1.0 - w1) * H2\n        \n        # Total gene diversity from pooled allele frequencies\n        p_T = (A1 + A2) / n_total\n        H_T = 2.0 * p_T * (1.0 - p_T)\n\n        num_components.append(H_T - H_S)\n        den_components.append(H_T)\n        \n    num_components = np.array(num_components)\n    den_components = np.array(den_components)\n    \n    # 2. Calculate the point estimate of F_ST\n    informative_loci_mask = den_components > 0\n    \n    numerator_sum = np.sum(num_components[informative_loci_mask])\n    denominator_sum = np.sum(den_components[informative_loci_mask])\n    \n    f_st_hat = 0.0\n    if denominator_sum > 0:\n        f_st_hat = numerator_sum / denominator_sum\n        \n    # 3. Perform non-parametric bootstrap over loci\n    L = len(locus_data)\n    rng = np.random.default_rng(seed)\n    \n    bootstrap_indices = rng.choice(L, size=(B, L), replace=True)\n    \n    # Sum components for each bootstrap replicate\n    bootstrap_num_sum = np.sum(num_components[bootstrap_indices], axis=1)\n    bootstrap_den_sum = np.sum(den_components[bootstrap_indices], axis=1)\n    \n    # Calculate F_ST for each bootstrap replicate\n    bootstrap_f_st = np.zeros(B, dtype=np.float64)\n    den_not_zero_mask = bootstrap_den_sum != 0\n    bootstrap_f_st[den_not_zero_mask] = bootstrap_num_sum[den_not_zero_mask] / bootstrap_den_sum[den_not_zero_mask]\n    \n    # 4. Calculate the 95% percentile confidence interval\n    ci_low = np.quantile(bootstrap_f_st, 0.025)\n    ci_high = np.quantile(bootstrap_f_st, 0.975)\n    \n    # 5. Apply the decision rule\n    decision = ci_low > tau\n    \n    # 6. Return the collected results\n    return [f_st_hat, ci_low, ci_high, decision]\n\ndef solve():\n    \"\"\"\n    Main function to process all datasets and print the final results.\n    \"\"\"\n    # Define the test cases from the problem statement\n    datasets = [\n        # Dataset 1\n        [((30, 10), (10, 30)), ((18, 22), (12, 28)), ((40, 0), (38, 2)), \n         ((25, 15), (15, 25)), ((35, 5), (20, 20)), ((28, 12), (12, 28))],\n        # Dataset 2\n        [((40, 0), (0, 40)), ((40, 0), (40, 0)), ((20, 20), (10, 30)), \n         ((5, 35), (35, 5)), ((18, 22), (18, 22))],\n        # Dataset 3\n        [((24, 16), (24, 16)), ((30, 10), (30, 10)), ((10, 30), (10, 30)), \n         ((35, 5), (35, 5)), ((20, 20), (20, 20))],\n        # Dataset 4\n        [((20, 0), (0, 20)), ((18, 2), (1, 19)), ((20, 0), (2, 18)), \n         ((17, 3), (0, 20)), ((19, 1), (0, 20)), ((16, 4), (0, 20))]\n    ]\n\n    B = 5000\n    tau = 0.25\n    seed = 1729\n    \n    all_results_formatted = []\n    \n    for data in datasets:\n        result = process_dataset(data, B, tau, seed)\n        f_st, ci_low, ci_high, decision = result\n        \n        # Format the result list as a string, with numbers rounded to 6 decimal places.\n        result_str = (\n            f\"[{f_st:.6f},\"\n            f\"{ci_low:.6f},\"\n            f\"{ci_high:.6f},\"\n            f\"{'True' if decision else 'False'}]\"\n        )\n        all_results_formatted.append(result_str)\n\n    # Print the final output in the required single-line format\n    print(f\"[{','.join(all_results_formatted)}]\")\n\nsolve()\n```", "id": "2611128"}, {"introduction": "超越基于频率的统计量，系统发育物种概念强调谱系树上的可诊断性。谱系分选指数（gsi）为我们提供了一个强有力的工具，用以量化特定群体在基因树上的排他性程度。此练习不仅要求你从基本原理推导出 gsi 的计算公式，还将让你将其应用于多位点数据，从而将单系性这一抽象概念与一个具体的、可量化的指标联系起来。", "problem": "一个研究团队正在多物种溯祖 (MSC) 模型下，使用多位点数据评估一个假定物种类群的系统发育物种概念 (PSC)。目标候选类群记为 $X$，由 $n=5$ 个采样个体组成，这些个体嵌入在每个有根基因树上一个包含 $N=20$ 个个体的更广泛样本中。物种树在各位点间是一致的，其分支长度以溯祖单位表示：将 $X$ 与其姐妹谱系 $Y$ 分开的主干分支长度为 $t_{XY}=1.1$，从 $X\\!+\\!Y$ 的祖先到下一个外群 $Z$ 的祖先分支长度为 $t_{(XY)Z}=0.3$。这些值作为不完全谱系分选预期的生物学背景提供，但不应直接代入任何计算中。\n\n你需要使用谱系分选指数 (gsi) 来量化 $X$ 在每个有根基因树上的谱系排他性程度。对于一个给定的基因树，设 $s$ 表示包含 $X$ 所有 $n$ 个成员的最小演化支中的末端节点数（最小包围演化支大小）。$X$ 的 gsi 必须满足以下源于单系性和排他性核心定义的概念性约束：\n- 如果 $X$ 在一个基因树上是严格单系的，则 $s=n$，该指数必须达到其最大值。\n- 如果 $X$ 是完全非排他性的，以至于需要整个树才能包围其所有成员，则 $s=N$，该指数必须达到其最小值。\n- 当 $s$ 在 $n$ 和 $N$ 之间变化时，该指数应呈线性变化，从而排他性损失的等量增加会导致指数的等量减少。\n\n仅使用这些约束，首先推导出 gsi 作为 $s$、$n$ 和 $N$ 的函数的显式表达式。\n\n在 $5$ 个独立的基因树（位点）上，观测到的 $X$ 的最小包围演化支大小为：\n- 位点 1: $s_{1}=5$\n- 位点 2: $s_{2}=6$\n- 位点 3: $s_{3}=7$\n- 位点 4: $s_{4}=20$\n- 位点 5: $s_{5}=5$\n\n通过对你推导出的每个位点的 gsi 值求平均，计算 $X$ 的跨位点平均 gsi。然后，在给定溯祖分支长度的情况下，引用多物种溯祖模型的预期，简要解释你获得的数值是否与将 $X$ 识别为一个独立谱系的 PSC 标准相一致。\n\n最终答案只提供跨位点平均 gsi 的数值。将最终值表示为一个无单位的数，并将答案四舍五入到 $4$ 位有效数字。", "solution": "问题陈述已经过评估，并被确定为有效。它在科学上基于系统发育和群体遗传学理论的原理，特别是多物种溯祖模型和谱系分选指数 ($gsi$)。问题设置合理，具有足够的约束来推导所需的函数，并提供了用于后续计算的完整数据。语言客观而精确。因此，我将开始解答。\n\n主要任务是推导谱系分选指数 $gsi$ 的表达式，该表达式是最小包围演化支大小 $s$、目标群体中个体数 $n$ 和样本中总个体数 $N$ 的函数。问题指明了三个约束条件：\n1. 当目标群体 $X$ 是严格单系时，指数必须达到最大值，此时对应 $s=n$。\n2. 当群体完全非排他性时，即最小包围演化支是整个树，指数必须达到最小值，此时对应 $s=N$。\n3. 当 $s$ 从 $n$ 变化到 $N$ 时，指数必须线性变化。\n\n$gsi$ 和 $s$ 之间的线性关系可以表示为 $gsi(s) = as + b$，其中 $a$ 和 $b$ 是常数。按照惯例，这类指数被归一化到区间 $[0, 1]$。我们将完全排他性的最大值设为 $1$，完全不具排他性的最小值设为 $0$。\n\n这根据边界条件建立了一个二元线性方程组：\n1. 对于 $s=n$ (单系)：$gsi(n) = an + b = 1$\n2. 对于 $s=N$ (完全非排他性)：$gsi(N) = aN + b = 0$\n\n我们可以解这个方程组来求出常数 $a$ 和 $b$。从第二个方程，我们得到 $b = -aN$。将 $b$ 的这个表达式代入第一个方程，得到：\n$an - aN = 1$\n$a(n - N) = 1$\n$a = \\frac{1}{n-N}$\n\n现在，我们求解 $b$：\n$b = -aN = -N \\left( \\frac{1}{n-N} \\right) = \\frac{-N}{n-N} = \\frac{N}{N-n}$\n\n将 $a$ 和 $b$ 的表达式代回线性函数 $gsi(s) = as + b$，我们得到该指数的通用公式：\n$gsi(s) = \\left( \\frac{1}{n-N} \\right) s + \\frac{N}{N-n} = \\frac{s - N}{n-N}$\n这个公式更常规的写法是：\n$$gsi(s, n, N) = \\frac{N-s}{N-n}$$\n这个推导出的表达式正确地满足了所有三个初始约束。\n\n接下来，我们将此公式应用于所提供的数据。参数为 $n=5$ 和 $N=20$。本研究的具体公式是：\n$$gsi(s) = \\frac{20-s}{20-5} = \\frac{20-s}{15}$$\n\n我们现在使用观测到的最小包围演化支大小 ($s_i$)，计算 $5$ 个位点中每一个的 $gsi$ 值：\n- 位点 1 ($s_1=5$): $gsi_1 = \\frac{20-5}{15} = \\frac{15}{15} = 1$\n- 位点 2 ($s_2=6$): $gsi_2 = \\frac{20-6}{15} = \\frac{14}{15}$\n- 位点 3 ($s_3=7$): $gsi_3 = \\frac{20-7}{15} = \\frac{13}{15}$\n- 位点 4 ($s_4=20$): $gsi_4 = \\frac{20-20}{15} = \\frac{0}{15} = 0$\n- 位点 5 ($s_5=5$): $gsi_5 = \\frac{20-5}{15} = \\frac{15}{15} = 1$\n\n跨位点平均 $gsi$，记为 $\\overline{gsi}$，是这些单个值的算术平均值：\n$$\\overline{gsi} = \\frac{1}{5} \\sum_{i=1}^{5} gsi_i = \\frac{1}{5} \\left( 1 + \\frac{14}{15} + \\frac{13}{15} + 0 + 1 \\right)$$\n为了计算这个值，我们将所有项转换为以 $15$ 为公分母：\n$$\\overline{gsi} = \\frac{1}{5} \\left( \\frac{15}{15} + \\frac{14}{15} + \\frac{13}{15} + \\frac{0}{15} + \\frac{15}{15} \\right) = \\frac{1}{5} \\left( \\frac{15+14+13+0+15}{15} \\right)$$\n$$\\overline{gsi} = \\frac{1}{5} \\left( \\frac{57}{15} \\right) = \\frac{57}{75}$$\n将分子和分母同除以它们的最大公约数 $3$，我们简化分数：\n$$\\overline{gsi} = \\frac{19}{25} = 0.76$$\n\n最后，我们必须解释这个结果。平均 $gsi$ 为 $0.76$ 表明候选物种 $X$ 具有强烈的、但非绝对的谱系排他性信号。系统发育物种概念 (PSC) 强调可诊断的排他性。观测到的模式——两个位点显示完全单系 ($gsi=1$)，两个显示接近单系，一个显示完全非排他性 ($gsi=0$)——是具有信息量的。\n在多物种溯祖 (MSC) 模型下，一个物种获得单系基因树的概率是其主干分支长度（以溯祖单位计）的函数。不完全谱系分选 (ILS) 预期会在一部分基因树上阻止单系的形成，并且这个比例随着主干分支长度的增加而减少。两个谱系在一个长度为 $t$（以溯祖单位计）的分支中未能溯祖合并的概率是 $\\exp(-t)$。对于给定的主干分支长度 $t_{XY}=1.1$，$X$ 和 $Y$ 群体间发生不完全谱系分选的概率是 $\\exp(-1.1) \\approx 0.33$。这表明大约三分之一的基因树预期会显示非单系性。我们在 $5$ 个位点中有 $3$ 个观测到非单系性（程度不同）的经验结果与这一理论预期相符。位点 $4$ 的完全分选失败（$s=20$, $gsi=0$）表明发生了深度不完全谱系分选，即来自 $X$ 的谱系甚至在长度为 $t_{(XY)Z}=0.3$ 的祖先分支上都未能溯祖合并。这种深度溯祖的概率是 $\\exp(-(t_{XY}+t_{(XY)Z})) = \\exp(-1.4) \\approx 0.25$。在五次试验中观测到一次这样的事件并非不可能。\n总之，$0.76$ 的高平均 $gsi$ 值，连同跨位点的特定分选模式，与多物种溯祖模型对于一个近期分化、主干分支长度为 $t_{XY}=1.1$ 的谱系的预测完全一致。这为在 PSC 标准下将 $X$ 识别为一个独立的物种提供了强有力的定量支持。\n\n要求的最终数值答案是跨位点平均 $gsi$，四舍五入到 $4$ 位有效数字。\n$\\overline{gsi} = 0.7600$。", "answer": "$$\n\\boxed{0.7600}\n$$", "id": "2611143"}, {"introduction": "为了深刻理解经验数据背后的模式，我们必须掌握其生成过程的理论模型——溯祖过程。本练习将带你深入多物种溯祖模型的核心，通过计算深度溯祖和相互单系性等事件的概率，来探索谱系分选的随机性。通过这个练习，你将对不完全谱系分选（ILS）的概率性质建立更深的直觉，并理解为何即使是明确分化的物种，也未必在所有基因上都表现出完美的相互单系性，这为正确解读诸如 [@problem_id:2611143] 中的经验结果提供了必要的理论基础。", "problem": "在系统发育物种概念中，基因谱系的相互单系性常被用来诊断物种边界。考虑两个候选物种 A 和 B，它们在 $T$ 代前发生分化，并且自分化以来没有发生过基因流。从每个物种中，您在一个二倍体生物的单个中性常染色体位点上，分别采样 $n_{A} = 2$ 和 $n_{B} = 2$ 个基因拷贝。假设后代有效种群大小恒定为 $N_{e,A} = N_{e,B} = N_{e}$，且祖先有效种群大小为大于零的常数。将感兴趣的时间窗口定义为每个后代种群在分化后的时间区间 $[0, T]$。将深度溯祖定义为：在给定物种中，采样的谱系未能在时间段 $[0, T]$ 内在该物种内发生溯祖的任何情况（因此在时间 $T$ 将多于一个谱系带入祖先种群）。使用标准的二倍体中性溯祖模型，其中在恒定大小的种群中，成对谱系的溯祖时间服从均值为 $2 N_{e}$ 代的指数分布。\n\n给定 $T = 4.0 \\times 10^{5}$ 代和两个后代物种的 $N_{e} = 1.0 \\times 10^{5}$，请执行以下操作：\n\n1. 计算在此样本配置下，跨越时间 $T$ 分化点的深度溯祖的期望数量。\n2. 利用您的结果，计算两个采样支系（每个物种一个）在时间窗口 $[0, T]$ 内是相互单系的概率（即，两个物种内的最近共同祖先都在时间 $T$ 之前形成）。\n\n将最终概率表示为保留四位有效数字的小数。最终概率无需单位。", "solution": "在尝试任何解决方案之前，对问题陈述进行验证。\n\n**步骤 1：提取已知条件**\n- 物种：两个候选物种，A 和 B。\n- 分化时间：$T$ 代前。\n- 基因流：自分化以来无。\n- 样本量：$n_{A} = 2$ 和 $n_{B} = 2$ 个基因拷贝。\n- 位点：二倍体生物中的单个中性常染色体位点。\n- 有效种群大小：恒定的后代大小 $N_{e,A} = N_{e,B} = N_{e}$。祖先大小恒定且为正。\n- 时间窗口：分化后区间 $[0, T]$。\n- 深度溯祖的定义：采样的谱系未能在时间窗口 $[0, T]$ 内溯祖。\n- 溯祖模型：标准的二倍体中性溯祖模型。\n- 成对溯祖时间分布：均值为 $2 N_{e}$ 代的指数分布。\n- 数值：$T = 4.0 \\times 10^{5}$ 代， $N_{e} = 1.0 \\times 10^{5}$。\n- 任务：\n    1. 计算跨越时间 $T$ 分化点的深度溯祖的期望数量。\n    2. 计算在时间窗口 $[0, T]$ 内相互单系的概率。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题基于科学原理，依赖于标准的中性溯祖理论，这是群体遗传学中的一个基本模型。所有概念，如有效种群大小、深度溯祖和相互单系，在该领域内都是标准且定义明确的。问题表述清晰；它提供了推导唯一解所需的所有必要参数（$T$, $N_{e}$, $n_{A}$, $n_{B}$）和明确的定义。语言客观且技术性强。给定的值在理论背景下是物理上合理的。该问题是溯祖理论的标准应用，既不简单也非自相矛盾。\n\n**步骤 3：结论与行动**\n问题有效。我将继续进行解答。\n\n根据问题陈述的要求，解答分为两部分。\n\n**第 1 部分：深度溯祖的期望数量**\n\n我们正在考虑二倍体种群中的一个中性位点。根据标准的中性溯祖模型，一对谱系（$k=2$）的溯祖时间遵循指数分布。$k$ 个谱系的溯祖速率为 $\\lambda_k = \\frac{\\binom{k}{2}}{2N_e}$。对于 $k=2$ 个谱系，此速率为 $\\lambda_2 = \\frac{\\binom{2}{2}}{2N_e} = \\frac{1}{2N_e}$。因此，溯祖时间 $t_{coal}$ 是一个随机变量，其分布为 $t_{coal} \\sim \\text{Exp}(\\frac{1}{2N_e})$。\n\n对于一个给定的物种，“深度溯祖”被定义为采样谱系未能在时间区间 $[0, T]$ 内溯祖的事件，这意味着溯祖时间 $t_{coal}$ 大于 $T$。\n\n考虑物种 A，从中采样了 $n_{A}=2$ 个谱系。种群大小为 $N_e$。物种 A 中发生深度溯祖的概率，记为 $P(D_{A})$，是两个谱系在时间 $T$ 之前没有溯祖的概率：\n$$ P(D_{A}) = P(t_{coal, A} > T) $$\n对于一个速率为 $\\lambda$ 的指数分布随机变量，其生存函数为 $P(X > x) = \\exp(-\\lambda x)$。这里，$\\lambda = \\frac{1}{2N_e}$ 且 $x = T$。\n$$ P(D_{A}) = \\exp\\left(-\\frac{T}{2N_e}\\right) $$\n设 $D_A$ 是一个指示随机变量，如果物种 A 中发生深度溯祖，则为 $1$，否则为 $0$。该指示变量的期望值就是事件发生的概率：\n$$ E[D_A] = 1 \\cdot P(D_A=1) + 0 \\cdot P(D_A=0) = P(D_A=1) = \\exp\\left(-\\frac{T}{2N_e}\\right) $$\n物种 B 的情况完全相同，有 $n_B=2$ 且种群大小为 $N_e$。因此，物种 B 的深度溯祖期望数量为：\n$$ E[D_B] = \\exp\\left(-\\frac{T}{2N_e}\\right) $$\n深度溯祖的总数是每个物种中深度溯祖数量之和，$D_{total} = D_A + D_B$。根据期望的线性性，总的深度溯祖期望数量是：\n$$ E[D_{total}] = E[D_A + D_B] = E[D_A] + E[D_B] = 2 \\exp\\left(-\\frac{T}{2N_e}\\right) $$\n这完成了问题的第一部分。\n\n**第 2 部分：相互单系的概率**\n\n在时间窗口 $[0, T]$ 内的相互单系是指物种 A 内的谱系在时间 $T$ 之前溯祖，并且物种 B 内的谱系也在时间 $T$ 之前溯祖的事件。这等同于发生零次深度溯祖的事件。\n\n设 $M_A$ 为物种 A 中的谱系在 $[0, T]$ 内是单系的事件。这在其溯祖时间 $t_{coal, A}$ 小于或等于 $T$ 时发生。这是深度溯祖事件的补集。\n$$ P(M_A) = P(t_{coal, A} \\le T) = 1 - P(t_{coal, A} > T) = 1 - \\exp\\left(-\\frac{T}{2N_e}\\right) $$\n类似地，对于物种 B，在 $[0, T]$ 内单系的概率是：\n$$ P(M_B) = P(t_{coal, B} \\le T) = 1 - \\exp\\left(-\\frac{T}{2N_e}\\right) $$\n问题陈述说明自分化以来没有基因流。这意味着两个后代种群中的溯祖过程是独立事件。相互单系的概率 $P(RM)$ 是事件 $M_A$ 和 $M_B$ 同时发生的概率。\n$$ P(RM) = P(M_A \\text{ and } M_B) = P(M_A) \\times P(M_B) $$\n$$ P(RM) = \\left(1 - \\exp\\left(-\\frac{T}{2N_e}\\right)\\right) \\times \\left(1 - \\exp\\left(-\\frac{T}{2N_e}\\right)\\right) = \\left(1 - \\exp\\left(-\\frac{T}{2N_e}\\right)\\right)^2 $$\n现在我们代入给定的数值：$T = 4.0 \\times 10^5$ 和 $N_e = 1.0 \\times 10^5$。时间以溯祖单位衡量，即代数除以 $2N_e$。\n$$ \\frac{T}{2N_e} = \\frac{4.0 \\times 10^5}{2 \\times (1.0 \\times 10^5)} = \\frac{4.0 \\times 10^5}{2.0 \\times 10^5} = 2 $$\n无量纲时间为 $2$。我们将此值代入相互单系概率的表达式中。\n$$ P(RM) = \\left(1 - \\exp(-2)\\right)^2 $$\n我们计算其数值：\n$$ \\exp(-2) \\approx 0.13533528... $$\n$$ 1 - \\exp(-2) \\approx 1 - 0.13533528 = 0.86466471... $$\n$$ P(RM) \\approx (0.86466471...)^2 \\approx 0.747643... $$\n四舍五入到四位有效数字，最终概率为 $0.7476$。", "answer": "$$\\boxed{0.7476}$$", "id": "2611208"}]}