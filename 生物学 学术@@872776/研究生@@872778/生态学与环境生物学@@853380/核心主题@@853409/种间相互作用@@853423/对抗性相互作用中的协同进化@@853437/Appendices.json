{"hands_on_practices": [{"introduction": "对抗性协同进化的一个核心主题是权衡假说（trade-off hypothesis），尤其是在寄生生物的毒力（virulence）方面。此练习 [@problem_id:2476623] 提供了一个运用微积分的实践机会，旨在寻找能够通过平衡传播和对宿主的伤害来最大化寄生生物适合度的演化稳定毒力水平。通过推导基本繁殖数 $R_0$ 的最大值，您可以亲身体验如何将生态学原理与演化优化思想结合起来。", "problem": "考虑一个均匀混合种群中的拮抗性宿主-寄生体相互作用，其中一个毒力（额外的宿主死亡率）为 $ \\alpha $ 的稀有突变寄生体株试图入侵一个处于生态准平衡状态的常驻种群。假设在一个易感-感染-易感 (SIS) 感染过程中，在突变体入侵的时间尺度上，易感宿主的密度 $ S $ 保持不变。设基线宿主恢复率为 $ \\gamma  0 $，并假设寄生体的传播率 $ \\beta(\\alpha) $ 随毒力的增加而增加，这源于一个由下式给出的饱和权衡关系：\n$$\n\\beta(\\alpha) \\;=\\; \\beta_{\\max} \\,\\frac{\\alpha}{\\alpha + k},\n$$\n其中 $ \\beta_{\\max}  0 $ 是最大传播率，$ k  0 $ 决定了权衡关系的曲率。一个稀有突变体的入侵适应度由其基本再生数 $ R_{0}(\\alpha) $ 决定，在 SIS 框架中定义为：\n$$\nR_{0}(\\alpha) \\;=\\; \\frac{\\beta(\\alpha)\\, S}{\\gamma + \\alpha},\n$$\n它指的是在一个其他成员均为易感者的种群中，由单个新感染宿主引起的预期二次感染数。\n\n在此类系统中，对于稀有突变体，标准假设是进化动力学偏好于局部最大化 $ R_{0}(\\alpha) $ 的策略。在该假设下，请从第一性原理出发，推导当 $ \\alpha  0 $ 时能使 $ R_{0}(\\alpha) $ 最大化的进化稳定策略 (ESS) 毒力 $ \\alpha^{*} $。假设 $ S  0 $，$ \\beta_{\\max}  0 $，$ \\gamma  0 $ 且 $ k  0 $。请提供 $ \\alpha^{*} $ 关于各参数的闭式表达式，不要进行任何数值代入。您的最终答案必须是单个解析表达式。无需四舍五入，也无需单位。", "solution": "我们从易感-感染-易感 (SIS) 模型的生态学和流行病学基础出发。当一个毒力为 $ \\alpha $ 的稀有突变寄生体株出现在一个常驻种群中，并且在短暂的入侵时间尺度上，易感宿主的密度可视为常数 $ S $ 时，突变体的感染数量 $ I_{m} $ 的演化遵循以下方程：\n$$\n\\frac{d I_{m}}{dt} \\;\\approx\\; \\left[\\beta(\\alpha)\\, S \\;-\\; (\\gamma + \\alpha)\\right] I_{m}.\n$$\n入侵要求突变体的人均增长率为正，即 $ \\beta(\\alpha) S - (\\gamma + \\alpha)  0 $，这可以由基本再生数（SIS模型的第一性原理定义）来概括：\n$$\nR_{0}(\\alpha) \\;=\\; \\frac{\\beta(\\alpha)\\, S}{\\gamma + \\alpha}.\n$$\n在稀有突变、小效应适应性动力学的假设下，一个进化稳定策略 (ESS) 对应于入侵适应度代理指标 $ R_{0}(\\alpha) $ 相对于性状 $ \\alpha $ 的一个局部最大化子，前提是标准的正则性条件成立。\n\n我们已知饱和权衡关系为：\n$$\n\\beta(\\alpha) \\;=\\; \\beta_{\\max}\\,\\frac{\\alpha}{\\alpha + k},\n$$\n其中 $ \\beta_{\\max}  0 $ 且 $ k  0 $。代入 $ R_{0}(\\alpha) $ 可得：\n$$\nR_{0}(\\alpha) \\;=\\; \\frac{\\beta_{\\max}\\,\\frac{\\alpha}{\\alpha + k}\\, S}{\\gamma + \\alpha}\n\\;=\\; \\beta_{\\max} S \\,\\frac{\\alpha}{(\\alpha + k)(\\gamma + \\alpha)}.\n$$\n因为 $ \\beta_{\\max} S  0 $ 是一个正的乘法常数，所以在 $ \\alpha  0 $ 的范围内最大化 $ R_{0}(\\alpha) $ 等价于最大化：\n$$\nf(\\alpha) \\;=\\; \\frac{\\alpha}{(\\alpha + k)(\\alpha + \\gamma)}\n\\;=\\; \\frac{\\alpha}{\\alpha^{2} + \\alpha(k + \\gamma) + k\\gamma}.\n$$\n我们现在对 $ f(\\alpha) $ 关于 $ \\alpha $ 求导，并令其导数为零以寻找临界点。使用商法则，设：\n$$\ng(\\alpha) \\;=\\; \\alpha,\\qquad h(\\alpha) \\;=\\; (\\alpha + k)(\\alpha + \\gamma) \\;=\\; \\alpha^{2} + \\alpha(k + \\gamma) + k\\gamma,\n$$\n我们有 $ g'(\\alpha) = 1 $ 和 $ h'(\\alpha) = 2\\alpha + (k + \\gamma) $。于是：\n$$\nf'(\\alpha) \\;=\\; \\frac{g'(\\alpha)\\,h(\\alpha) - g(\\alpha)\\,h'(\\alpha)}{[h(\\alpha)]^{2}}\n\\;=\\; \\frac{\\left[\\alpha^{2} + \\alpha(k + \\gamma) + k\\gamma\\right] - \\alpha\\left[2\\alpha + (k + \\gamma)\\right]}{\\left[\\alpha^{2} + \\alpha(k + \\gamma) + k\\gamma\\right]^{2}}.\n$$\n简化分子，\n$$\n\\left[\\alpha^{2} + \\alpha(k + \\gamma) + k\\gamma\\right] - \\left[2\\alpha^{2} + \\alpha(k + \\gamma)\\right]\n\\;=\\; -\\alpha^{2} + k\\gamma.\n$$\n因此，\n$$\nf'(\\alpha) \\;=\\; \\frac{k\\gamma - \\alpha^{2}}{\\left[\\alpha^{2} + \\alpha(k + \\gamma) + k\\gamma\\right]^{2}}.\n$$\n临界点满足 $ f'(\\alpha) = 0 $，可简化为\n$$\nk\\gamma - \\alpha^{2} \\;=\\; 0 \\quad\\Longrightarrow\\quad \\alpha^{2} \\;=\\; k\\gamma.\n$$\n因为根据毒力的定义有 $ \\alpha  0 $，且 $ k  0 $，$ \\gamma  0 $，所以唯一具有生物学意义的临界点是\n$$\n\\alpha^{*} \\;=\\; \\sqrt{k\\gamma}.\n$$\n为验证该临界点是一个严格的局部最大化子，注意到对于所有 $ \\alpha  0 $，$ f'(\\alpha) $ 的分母都严格为正，而 $ f'(\\alpha) $ 的符号由 $ k\\gamma - \\alpha^{2} $ 决定。因此，当 $0  \\alpha  \\sqrt{k\\gamma}$ 时，$f'(\\alpha) > 0$；当 $\\alpha > \\sqrt{k\\gamma}$ 时，$f'(\\alpha)  0$。这表明 $ \\alpha^{*} $ 是在 $ (0,\\infty) $ 上的唯一全局最大化子。等价地，可以观察边界行为 $ \\lim_{\\alpha \\to 0^{+}} f(\\alpha) = 0 $ 和 $ \\lim_{\\alpha \\to \\infty} f(\\alpha) = 0 $，由于内部只有一个临界点，这证实了在 $ \\alpha^{*} $ 处存在一个单峰。\n\n最后，因为 $ \\beta_{\\max} $ 和 $ S $ 是乘法因子，它们不影响使 $ \\alpha^{*} $ 最大化的位置。因此，使基本再生数最大化的进化稳定毒力是：\n$$\n\\alpha^{*} \\;=\\; \\sqrt{k\\gamma}.\n$$", "answer": "$$\\boxed{\\sqrt{k\\gamma}}$$", "id": "2476623"}, {"introduction": "演化变革始于新突变的成功入侵。本练习 [@problem_id:2476591] 探讨了在经典的“基因对基因”（gene-for-gene）互动模型中这一关键的第一步，要求您推导出一个新的寄生生物毒力等位基因能够克服宿主抗性并得以传播的精确条件。这个过程将加深您对入侵适合度（invasion fitness）分析的理解，这是判断演化轨迹的核心工具。", "problem": "在一个具有基因对基因识别机制的单倍体宿主-寄生虫系统中，考虑一个固有的寄生虫种群，该种群固定了一个无毒力等位基因，该基因无法感染抗性宿主。宿主携带一个频率为 $p$ 的抗性等位基因，因此有比例为 $p$ 的宿主个体是抗性的，比例为 $1 - p$ 的宿主是易感的。假设在生态时间尺度上，混合是随机的，且种群动态是平稳的，因此稀有寄生虫所遇到的各类宿主的频率与其种群权重成正比。\n\n寄生虫在相容宿主上的基准感染成功率归一化为 $1$。无毒力寄生虫无法感染抗性宿主（在抗性宿主上的感染成功率为 $0$），而有毒力寄生虫可以感染两类宿主，但需要支付一个直接的、乘性的毒力生活史代价 $c_v \\in (0,1)$，这使其在所有宿主类别上的感染成功率乘以一个因子 $(1 - c_v)$。携带抗性等位基因的宿主需要支付一个固有代价 $c_R \\in (0,1)$，这使其种群权重（以及因此被遇到的可能性）乘以一个因子 $(1 - c_R)$。因此，从稀有寄生虫的角度来看，与易感宿主和抗性宿主的有效相遇权重分别与 $(1 - p)$ 和 $(1 - c_R)\\,p$ 成正比。假设时间尺度分离：在有毒力等位基因入侵期间，宿主等位基因频率 $p$以及代价 $c_v$、$c_R$ 保持不变。\n\n仅使用入侵分析的基本定义（当一个稀有突变体在稀有时的人均繁殖成功率超过其在固有环境中固有类型的繁殖成功率时，该突变体便能入侵）和上述假设，推导出临界抗性等位基因频率 $p^\\ast$，使得稀有有毒力等位基因能够入侵的充要条件是 $p  p^\\ast$。将 $p^\\ast$ 表示为仅包含 $c_v$ 和 $c_R$ 的闭合形式函数。提供您的最终答案，形式为一个单一的、无单位的闭合解析表达式。不要提供不等式或方程式。不需要进行数值四舍五入。", "solution": "该问题基于演化生态学中入侵分析的既定原则，提法恰当且科学合理。我们将着手推导临界抗性频率 $p^\\ast$。\n\n入侵分析的核心原则指出，如果一个稀有突变等位基因在稀有时的人均繁殖成功率高于同一环境中固有种群的人均繁殖成功率，那么该突变体就能入侵。设 $W$ 代表这个适应度度量。稀有有毒力寄生虫的入侵条件是 $W_{vir}  W_{avir}$，其中 $W_{vir}$ 是有毒力突变体的适应度，$W_{avir}$ 是无毒力固有类型的适应度。\n\n环境由宿主种群定义。携带抗性等位基因的宿主频率为 $p$，易感宿主频率为 $1 - p$。抗性代价 $c_R$ 使抗性宿主的种群权重减少一个因子 $1 - c_R$。因此，寄生虫与易感宿主和抗性宿主的有效相遇权重分别与 $(1 - p)$ 和 $(1 - c_R)p$ 成正比。\n\n为了计算人均繁殖成功率，我们考虑两种宿主类型的感染结果的加权平均值。可供相遇的宿主种群的总种群权重与 $K = (1 - p) + (1 - c_R)p$ 成正比。因此，寄生虫遇到易感宿主的概率是 $P_{S} = \\frac{1-p}{K}$，遇到抗性宿主的概率是 $P_{R} = \\frac{(1-c_R)p}{K}$。\n\n首先，我们确定固有无毒力寄生虫的适应度 $W_{avir}$。无毒力寄生虫在易感宿主上的感染成功率为 $1$，在抗性宿主上为 $0$。其适应度是按相遇概率加权的结果之和：\n$$\nW_{avir} = (1) \\cdot P_{S} + (0) \\cdot P_{R} = \\frac{1-p}{(1-p) + (1-c_R)p}\n$$\n\n接下来，我们确定稀有有毒力突变体的适应度 $W_{vir}$。这种寄生虫可以感染两种宿主类型，但其感染成功率因毒力的乘性代价 $c_v$ 而降低。因此，在两种宿主类型上的成功率均为 $(1-c_v)$。其适应度为：\n$$\nW_{vir} = (1 - c_v) \\cdot P_{S} + (1 - c_v) \\cdot P_{R} = (1 - c_v) (P_{S} + P_{R})\n$$\n由于 $P_{S} + P_{R} = 1$，有毒力寄生虫的适应度简化为：\n$$\nW_{vir} = 1 - c_v\n$$\n\n入侵条件是 $W_{vir}  W_{avir}$。代入适应度的表达式，我们得到不等式：\n$$\n1 - c_v  \\frac{1-p}{(1 - p) + (1 - c_R)p}\n$$\n分母可以简化为：$(1 - p) + (1 - c_R)p = 1 - p + p - c_R p = 1 - c_R p$。不等式变为：\n$$\n1 - c_v  \\frac{1-p}{1 - c_R p}\n$$\n鉴于 $c_R \\in (0,1)$ 且 $p \\in [0,1]$，分母 $1 - c_R p$ 严格为正。因此，我们可以将不等式两边同乘以 $1 - c_R p$ 而不改变不等号的方向：\n$$\n(1 - c_v)(1 - c_R p)  1 - p\n$$\n展开左侧得到：\n$$\n1 - c_R p - c_v + c_v c_R p  1 - p\n$$\n我们重新整理各项以求解 $p$。我们将所有含 $p$ 的项移到左边，常数项移到右边：\n$$\np - c_R p + c_v c_R p  1 - (1 - c_v)\n$$\n$$\np - c_R p + c_v c_R p  c_v\n$$\n提出因子 $p$：\n$$\np(1 - c_R + c_v c_R)  c_v\n$$\n让我们分析 $p$ 的系数，即 $1 - c_R + c_v c_R = 1 - c_R(1 - c_v)$。因为 $c_v \\in (0,1)$ 和 $c_R \\in (0,1)$，所以项 $1 - c_v$ 介于 $0$ 和 $1$ 之间。因此，乘积 $c_R(1 - c_v)$ 也介于 $0$ 和 $1$ 之间。这确保了整个系数 $1 - c_R(1 - c_v)$ 是正的。我们可以用这个系数除以不等式两边而不改变不等号方向：\n$$\np  \\frac{c_v}{1 - c_R(1 - c_v)}\n$$\n这个不等式指明了有毒力等位基因入侵的条件。临界频率 $p^\\ast$ 是该条件中的阈值。因此，入侵发生的充要条件是 $p  p^\\ast$。\n临界抗性等位基因频率的表达式为：\n$$\np^\\ast = \\frac{c_v}{1 - c_R(1 - c_v)}\n$$", "answer": "$$\\boxed{\\frac{c_v}{1 - c_R(1 - c_v)}}$$", "id": "2476591"}, {"introduction": "虽然解析模型可以预测平衡点或入侵条件，但计算机模拟是可视化协同进化动态“博弈”随时间变化的强大工具。这项编码练习 [@problem_id:2476589] 要求您从头开始构建一个协同进化模型，并用它来衡量“时滞优势”（time-shift advantage），这是“红色皇后”动态的一个关键实证特征。通过这个实践，您将把抽象的动力学方程转化为可观察和可量化的演化模式。", "problem": "在以下假设下，构建一个最小的、离散时间的、基于频率的、双物种、双基因座的拮抗性共同进化模型，并根据第一性原理推导出所有必要的动力学方程。一个基因座位于宿主（抗性），一个位于寄生生物（侵染力），每个基因座都是单倍体，有两个等位基因。宿主携带等位基因 $R$（抗性）或 $r$（易感性）。寄生生物携带等位基因 $V$（侵染力）或 $v$（无毒力）。侵染遵循基因对基因法则：$V$ 侵染 $R$ 和 $r$，而 $v$ 只侵染 $r$。宿主的抗性带有繁殖力成本 $c_H \\in [0,1)$，寄生生物的侵染力带有成本 $c_P \\in [0,1)$，成功的侵染会使宿主繁殖力降低 $s \\in (0,1)$。假设随机交配、无限种群大小和非重叠世代。令时间以世代为索引 $t \\in \\{0,1,2,\\dots\\}$。\n\n仅从以下原理出发：(i) 预期基因型适应度等于基线繁殖力减去由抗性或侵染产生的任何实际成本，(ii) 侵染成功遵循上述侵染矩阵，以及 (iii) 等位基因频率根据标准比例选择 $p'(t)=\\dfrac{p(t) w(p(t))}{\\overline{w}(t)}$ 进行更新，推导宿主抗性等位基因频率 $p_H(t)$ 和寄生生物侵染力等位基因频率 $p_P(t)$ 的确定性递归式。\n\n将时间 $t$ 的宿主基因型适应度定义如下。易感宿主等位基因 $r$ 始终完全可被侵染，因此其预期适应度为 $w_r(t)=1-s$。抗性宿主等位基因 $R$ 承受抗性成本 $c_H$，且只能被 $V$ 侵染，因此其预期适应度为 $w_R(t)=1-c_H-s\\,p_P(t)$。根据每种寄生生物可侵染的宿主种群比例来定义其基因型适应度，并受侵染力成本的调节。不失一般性地，将基线寄生生物繁殖系数设为1。那么 $w_V(t)=1-c_P$，因为 $V$ 侵染所有宿主；而 $w_v(t)=1-p_H(t)$，因为 $v$ 只侵染占宿主总数一部分的 $r$ 宿主。\n\n使用这些定义，必须将等位基因频率递归式推导为\n$$\np_H(t+1)=\\frac{p_H(t)\\,w_R(t)}{p_H(t)\\,w_R(t)+\\big(1-p_H(t)\\big)w_r(t)},\\qquad\np_P(t+1)=\\frac{p_P(t)\\,w_V(t)}{p_P(t)\\,w_V(t)+\\big(1-p_P(t)\\big)w_v(t)}.\n$$\n不得引入任何其他模型组件。\n\n按如下方式定义时移交叉侵染分析。在焦点时间 $t$，取由 $p_P(t)$ 表征的同期寄生生物种群，并用其测试来自时间 $t+\\Delta$ 的宿主种群，其中 $\\Delta$ 可以是负数（过去）、零（现在）或正数（未来）。在此分析中，成功被侵染的宿主的预期比例为\n$$\nE(t,\\Delta) \\equiv p_P(t)\\cdot 1 + \\big(1-p_P(t)\\big)\\cdot\\big(1-p_H(t+\\Delta)\\big)\n=1-\\big(1-p_P(t)\\big)\\,p_H(t+\\Delta).\n$$\n将滞后 $k\\in \\mathbb{N}$ 下在 $t$ 时的对称时移优势定义为\n$$\nM_k(t) \\equiv E(t,-k)-E(t,+k).\n$$\n$M_k(t)$ 的正值表示，在 $k$ 个世代的对称时间窗口内，取自时间 $t$ 的寄生生物侵染过去宿主的效果优于侵染未来宿主，这是寄生生物时移优势的标准特征。\n\n您的程序必须：\n- 完全按照规定实现上述动力学系统，从 $[0,1]$ 内的初始等位基因频率 $p_H(0)$ 和 $p_P(0)$ 开始。\n- 模拟 $T$ 个世代，以产生轨迹 $\\{p_H(t)\\}_{t=0}^{T}$ 和 $\\{p_P(t)\\}_{t=0}^{T}$。\n- 对于给定的对称滞后 $k$ 和用于消除初始瞬态效应的老化期 $B$，对所有满足 $t-k\\ge 0$、$t+k\\le T$ 和 $t\\ge B$ 的整数 $t$ 计算 $M_k(t)$，并返回最大时移优势\n$$\nM_k^{\\max} \\equiv \\max_{t \\in \\{B,\\dots,T\\}} \\left\\{ M_k(t) \\ \\text{with} \\ t-k\\ge 0,\\ t+k\\le T \\right\\}.\n$$\n- 对于下面测试套件中的每组参数，输出这个单一标量 $M_k^{\\max}$，形式为浮点数，保留六位小数。\n\n测试套件。使用以下三组参数来测试不同机制：\n- 情况1（有成本的频率依赖性共同进化；预期出现正时移优势）：$s=0.45$, $c_H=0.10$, $c_P=0.25$, $p_H(0)=0.50$, $p_P(0)=0.50$, $T=800$, $B=200$, $k=15$。\n- 情况2（无成本的边界情况；预期时移优势消失）：$s=0.45$, $c_H=0.00$, $c_P=0.00$, $p_H(0)=0.50$, $p_P(0)=0.50$, $T=800$, $B=200$, $k=15$。\n- 情况3（宿主抗性成本高，抗性被清除；预期时移优势消失）：$s=0.45$, $c_H=0.40$, $c_P=0.05$, $p_H(0)=0.50, p_P(0)=0.50, T=800, B=200, k=15$。\n\n最终输出格式。您的程序应生成一行输出，其中包含一个逗号分隔的列表，用方括号括起来，按情况1到情况3的顺序排列结果，例如 `\"[x_1,x_2,x_3]\"`，其中每个 $x_i$ 是对应情况下四舍五入到六位小数的 $M_k^{\\max}$。不应打印任何其他文本。角度和物理单位不适用；所有量均为无量纲。您不得读取任何输入。程序必须是完整的，并且可以直接运行。", "solution": "问题陈述在科学上是合理的、自洽的且定义明确的。它描述了一个经典的宿主-寄生生物共同进化的基因对基因模型，这是理论生态学中的一个基本课题。所有参数、方程和目标都已明确说明，足以得出一个唯一的解。我们着手进行推导和求解。\n\n问题的核心是推导选择作用下等位基因频率的动力学方程。我们从第一性原理开始。\n\n设 $p_H(t)$ 为第 $t$ 代宿主种群中抗性等位基因 $R$ 的频率， $p_P(t)$ 为第 $t$ 代寄生生物种群中侵染力等位基因 $V$ 的频率。相应的替代等位基因，即易感等位基因 $r$ 和无毒力等位基因 $v$ 的频率分别为 $1-p_H(t)$ 和 $1-p_P(t)$。假设种群为单倍体、随机交配、大小无限，且世代不重叠。\n\n等位基因频率随时间因选择而变化，其中等位基因的适应度决定了其在下一代中的比例。离散时间单倍体模型中比例选择的标准方程是：\n$$\np'(t) = \\frac{p(t) w(p(t))}{\\overline{w}(t)}\n$$\n其中 $p(t)$ 是时间 $t$ 的等位基因频率，$p'(t)$ 是时间 $t+1$ 的频率，$w(p(t))$ 是该等位基因的适应度，$\\overline{w}(t)$ 是种群的平均适应度。\n\n我们必须首先根据所提供的生物相互作用和成本来定义每个等位基因的适应度。适应度表示为相对繁殖力，基线为 $1$。\n\n**宿主适应度：**\n宿主等位基因的适应度是其基线繁殖力（$1$）减去任何实际产生的成本。\n1.  **易感等位基因 ($r$)**：拥有 $r$ 等位基因的个体易受两种寄生生物类型 $V$ 和 $v$ 的侵染。寄生生物的总频率为 $p_P(t) + (1-p_P(t)) = 1$。因此，$r$ 宿主总是被侵染，并承受 $s$ 的繁殖力损失。没有抗性成本。其适应度是恒定的：\n    $$\n    w_r(t) = 1 - s\n    $$\n2.  **抗性等位基因 ($R$)**：拥有 $R$ 等位基因的个体对 $v$ 寄生生物有抗性，但可以被 $V$ 寄生生物侵染。遇到 $V$ 寄生生物的概率是 $p_P(t)$。该宿主还承担着固有的抗性成本 $c_H$。其适应度总是因 $c_H$ 而降低，并且仅在被 $V$ 寄生生物侵染时因 $s$ 而降低：\n    $$\n    w_R(t) = 1 - c_H - s \\cdot p_P(t)\n    $$\n\n宿主种群的平均适应度 $\\overline{w}_H(t)$ 是等位基因适应度的加权平均值：\n$$\n\\overline{w}_H(t) = p_H(t) w_R(t) + (1-p_H(t)) w_r(t)\n$$\n\n使用比例选择公式，下一代中 $R$ 等位基因的频率 $p_H(t+1)$ 为：\n$$\np_H(t+1) = \\frac{p_H(t) w_R(t)}{\\overline{w}_H(t)} = \\frac{p_H(t) [1 - c_H - s \\cdot p_P(t)]}{p_H(t) [1 - c_H - s \\cdot p_P(t)] + (1-p_H(t)) [1 - s]}\n$$\n\n**寄生生物适应度：**\n寄生生物等位基因的适应度与其能成功侵染的宿主种群比例成正比，并受任何侵染力成本的调节。基线繁殖系数设为 $1$。\n1.  **侵染力等位基因 ($V$)**：$V$ 寄生生物可以侵染 $R$ 和 $r$ 两种宿主，它们构成了整个宿主种群（比例为 $1$）。它承担侵染力成本 $c_P$。其适应度为：\n    $$\n    w_V(t) = 1 - c_P\n    $$\n2.  **无毒力等位基因 ($v$)**：$v$ 寄生生物只能侵染易感的 $r$ 宿主，其频率为 $1-p_H(t)$。它不承担任何成本。其适应度与可用宿主的比例成正比：\n    $$\n    w_v(t) = 1 - p_H(t)\n    $$\n\n寄生生物种群的平均适应度 $\\overline{w}_P(t)$ 是其等位基因适应度的加权平均值：\n$$\n\\overline{w}_P(t) = p_P(t) w_V(t) + (1-p_P(t)) w_v(t)\n$$\n\n下一代中 $V$ 等位基因的频率 $p_P(t+1)$ 为：\n$$\np_P(t+1) = \\frac{p_P(t) w_V(t)}{\\overline{w}_P(t)} = \\frac{p_P(t) [1 - c_P]}{p_P(t) [1 - c_P] + (1-p_P(t)) [1 - p_H(t)]}\n$$\n这些推导出的递归式与问题陈述中指定的相符。\n\n**时移优势分析：**\n为了量化共同进化动力学，我们使用时移交叉侵染分析。当来自时间 $t$ 的寄生生物被用于测试来自时间 $t+\\Delta$ 的宿主时，被侵染宿主的预期比例 $E(t, \\Delta)$ 被计算出来。拥有等位基因 $V$（频率 $p_P(t)$）的寄生生物侵染所有宿主（比例 $1$）。拥有等位基因 $v$（频率 $1-p_P(t)$）的寄生生物只侵染 $r$ 宿主（比例 $1-p_H(t+\\Delta)$）。\n$$\nE(t, \\Delta) = p_P(t) \\cdot 1 + (1-p_P(t)) \\cdot (1-p_H(t+\\Delta)) = 1 - (1-p_P(t)) p_H(t+\\Delta)\n$$\n在时间 $t$ 滞后 $k$ 的对称时移优势被定义为对过去宿主（$t-k$）与未来宿主（$t+k$）侵染成功率的差异：\n$$\nM_k(t) = E(t, -k) - E(t, +k)\n$$\n代入 $E(t,\\Delta)$ 的表达式：\n$$\nM_k(t) = [1 - (1-p_P(t)) p_H(t-k)] - [1 - (1-p_P(t)) p_H(t+k)]\n$$\n该表达式简化为：\n$$\nM_k(t) = (1 - p_P(t)) [p_H(t+k) - p_H(t-k)]\n$$\n$M_k(t)$ 为正值表示寄生生物对过去宿主的适应性优于对未来宿主的适应性，这是“红皇后”追逐动力学的一个标志。\n\n最后的任务是计算在指定的瞬态后时间窗口内的最大时移优势 $M_k^{\\max}$。算法如下：\n1.  初始化大小为 $T+1$ 的等位基因频率数组 $p_H$ 和 $p_P$，使用初始条件 $p_H(0)$ 和 $p_P(0)$。\n2.  从 $t=0$ 到 $t=T-1$ 进行迭代，使用推导的递归关系计算 $p_H(t+1)$ 和 $p_P(t+1)$。存储这些值。\n3.  生成完整轨迹后，对有效范围内的每个 $t$ 计算 $M_k(t)$。$t$ 的范围由 $t \\in \\{B, \\dots, T\\}$、$t-k \\ge 0$ 和 $t+k \\le T$ 指定。这对应于整数区间 $[\\max(B, k), T-k]$。\n4.  $M_k(t)$ 在此区间上的最大值即为所求结果 $M_k^{\\max}$。\n\n对提供的三个测试案例分别执行此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(s, c_H, c_P, p_H0, p_P0, T, B, k):\n    \"\"\"\n    Simulates the coevolutionary dynamics and calculates the maximum time-shift advantage.\n\n    Args:\n        s (float): Cost of infection for the host.\n        c_H (float): Cost of resistance for the host.\n        c_P (float): Cost of infectivity for the parasite.\n        p_H0 (float): Initial frequency of host resistance allele R.\n        p_P0 (float): Initial frequency of parasite infectivity allele V.\n        T (int): Total number of generations to simulate.\n        B (int): Burn-in period to exclude from analysis.\n        k (int): Time lag for the cross-infection assay.\n\n    Returns:\n        float: The maximum time-shift advantage, M_k^max.\n    \"\"\"\n    p_H_traj = np.zeros(T + 1)\n    p_P_traj = np.zeros(T + 1)\n\n    p_H_traj[0] = p_H0\n    p_P_traj[0] = p_P0\n\n    for t in range(T):\n        p_H_t = p_H_traj[t]\n        p_P_t = p_P_traj[t]\n\n        # Fitness calculations based on the derived equations\n        # Host fitnesses\n        w_R = 1.0 - c_H - s * p_P_t\n        w_r = 1.0 - s\n        \n        # Parasite fitnesses\n        w_V = 1.0 - c_P\n        w_v = 1.0 - p_H_t\n\n        # Calculate mean fitness for the host population\n        mean_w_H = p_H_t * w_R + (1.0 - p_H_t) * w_r\n        \n        # Calculate mean fitness for the parasite population\n        mean_w_P = p_P_t * w_V + (1.0 - p_P_t) * w_v\n\n        # Update host allele frequency\n        if mean_w_H > 0:\n            p_H_traj[t + 1] = (p_H_t * w_R) / mean_w_H\n        else:\n            # This case should not be reached with the given constraints\n            p_H_traj[t + 1] = p_H_t\n\n        # Update parasite allele frequency\n        if mean_w_P > 0:\n            p_P_traj[t + 1] = (p_P_t * w_V) / mean_w_P\n        else:\n            # This case should not be reached\n            p_P_traj[t + 1] = p_P_t\n            \n        # Clamp frequencies to [0, 1] to handle potential floating point inaccuracies\n        p_H_traj[t + 1] = np.clip(p_H_traj[t + 1], 0.0, 1.0)\n        p_P_traj[t + 1] = np.clip(p_P_traj[t + 1], 0.0, 1.0)\n\n\n    # Calculate the maximum time-shift advantage M_k^max\n    m_k_values = []\n    \n    # The valid time range for t is [max(B, k), T-k]\n    # Given B=200, k=15, T=800, the range is [200, 785]\n    start_t = max(B, k)\n    end_t = T - k\n\n    if start_t > end_t:\n        return 0.0\n\n    for t in range(start_t, end_t + 1):\n        # M_k(t) = (1 - p_P(t)) * (p_H(t+k) - p_H(t-k))\n        p_P_present = p_P_traj[t]\n        p_H_future = p_H_traj[t + k]\n        p_H_past = p_H_traj[t - k]\n        \n        m_k = (1.0 - p_P_present) * (p_H_future - p_H_past)\n        m_k_values.append(m_k)\n\n    if not m_k_values:\n        return 0.0\n        \n    m_k_max = np.max(m_k_values)\n    return m_k_max\n\ndef solve():\n    \"\"\"\n    Runs the simulation for all test cases and prints the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: (s, c_H, c_P, p_H0, p_P0, T, B, k)\n        (0.45, 0.10, 0.25, 0.50, 0.50, 800, 200, 15),\n        # Case 2: No costs\n        (0.45, 0.00, 0.00, 0.50, 0.50, 800, 200, 15),\n        # Case 3: High host resistance cost\n        (0.45, 0.40, 0.05, 0.50, 0.50, 800, 200, 15),\n    ]\n\n    results = []\n    for case in test_cases:\n        s, c_H, c_P, p_H0, p_P0, T, B, k = case\n        m_k_max = run_simulation(s, c_H, c_P, p_H0, p_P0, T, B, k)\n        results.append(f\"{m_k_max:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2476589"}]}