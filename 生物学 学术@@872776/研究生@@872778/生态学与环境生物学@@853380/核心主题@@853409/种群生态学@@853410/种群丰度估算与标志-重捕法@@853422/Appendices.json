{"hands_on_practices": [{"introduction": "本练习是标志重捕分析的基石。通过一组经典的双样本捕获数据，您将练习推导和计算两种最基本的种群数量估算方法——Lincoln-Petersen估算和Chapman估算。这项实践旨在建立您将原始数据转化为种群估算值及其不确定性的核心计算技能。[@problem_id:2523184]", "problem": "一项针对单个种群的封闭双样本捕获-再捕获研究在以下标准假设下进行：在两次抽样期间，该种群在人口学和地理学上是封闭的；标记是永久性的，被正确记录，且不影响捕获概率；并且所有个体在每次抽样中都有相同的捕获概率。在第一次抽样中，捕获、标记并释放了 $M=100$ 个个体。在第二次抽样中，捕获了 $n=120$ 个个体，其中发现有 $m=15$ 个是第一次抽样时标记的个体。\n\n在独立性和封闭性假设下，第二次抽样中观察到的标记个体数 $m$ 服从由真实丰度 $N$ 决定的超几何分布，其均值为 $\\mathbb{E}[m]=\\frac{nM}{N}$，方差为 $\\mathrm{Var}(m)=n\\left(\\frac{M}{N}\\right)\\left(1-\\frac{M}{N}\\right)\\left(\\frac{N-n}{N-1}\\right)$。\n\n从这些基本事实和用于平滑变换的大样本delta方法出发，完成以下任务：\n\n1. 通过将 $\\mathbb{E}[m]$ 与其观测值相等，推导出经典的矩估计法 Lincoln–Petersen 丰度估计量 $\\hat N_{\\mathrm{LP}}$，并根据观测数据计算其值。\n2. 采用标准的一阶偏差校正替代方法，即 Chapman 估计量 $\\hat N_{\\mathrm{Ch}}$，并根据观测数据计算其值。\n3. 使用delta方法，结合 $m$ 的超几何方差以及对每个估计量适用的未知数 $N$ 的代入值，推导并计算 $\\hat N_{\\mathrm{LP}}$ 和 $\\hat N_{\\mathrm{Ch}}$ 的近似标准误。\n4. 使用正态近似法为每个估计量构建近似的 $95\\%$ 置信区间。\n\n按以下顺序报告你的最终数值结果，共八个数字：$\\hat N_{\\mathrm{LP}}$，$\\hat N_{\\mathrm{LP}}$ 的标准误，$\\hat N_{\\mathrm{LP}}$ 的 $95\\%$ 置信区间的下限和上限，然后是 $\\hat N_{\\mathrm{Ch}}$，$\\hat N_{\\mathrm{Ch}}$ 的标准误，以及 $\\hat N_{\\mathrm{Ch}}$ 的 $95\\%$ 置信区间的下限和上限。将所有报告的数值四舍五入到三位有效数字。最终报告值中不要包含任何单位。", "solution": "所提出的问题是使用标记-重捕数据进行种群丰度估计的一个标准练习。我们首先验证问题陈述。给定条件是：第一次抽样中标记的个体数，$M=100$；第二次抽样的大小，$n=120$；第二次抽样中重捕的标记个体数，$m=15$。问题陈述了封闭种群模型的标准假设，并正确地将 $m$ 的分布确定为超几何分布，为其均值和方差提供了正确的公式。这些任务在数学上和统计学上都是明确定义的。因此，该问题具有科学依据，提法恰当且客观。可以进行求解。\n\n我们将按顺序完成四个指定的任务。所有数值结果将按要求四舍五入到三位有效数字。\n\n1. Lincoln–Petersen 估计量 ($\\hat{N}_{\\mathrm{LP}}$)\n\n矩估计法将统计量的理论期望值与其观测值相等。在这里，统计量是重捕获数 $m$。其期望值为 $\\mathbb{E}[m] = \\frac{nM}{N}$。我们将其设置为 $m$ 的观测值：\n$$m = \\frac{nM}{N}$$\n求解未知的种群大小 $N$ 得到 Lincoln–Petersen 估计量 $\\hat{N}_{\\mathrm{LP}}$：\n$$\\hat{N}_{\\mathrm{LP}} = \\frac{nM}{m}$$\n代入给定数据：$M=100$，$n=120$ 和 $m=15$：\n$$\\hat{N}_{\\mathrm{LP}} = \\frac{120 \\times 100}{15} = \\frac{12000}{15} = 800$$\n保留三位有效数字，结果为 $8.00 \\times 10^{2}$。\n\n2. Chapman 估计量 ($\\hat{N}_{\\mathrm{Ch}}$)\n\nChapman 估计量是 Lincoln–Petersen 估计量的一种偏差校正修正。我们按指示采用其公式：\n$$\\hat{N}_{\\mathrm{Ch}} = \\frac{(M+1)(n+1)}{m+1} - 1$$\n代入给定数据：\n$$\\hat{N}_{\\mathrm{Ch}} = \\frac{(100+1)(120+1)}{15+1} - 1 = \\frac{101 \\times 121}{16} - 1 = \\frac{12221}{16} - 1 = 763.8125 - 1 = 762.8125$$\n四舍五入到三位有效数字，我们得到 $\\hat{N}_{\\mathrm{Ch}} = 763$。\n\n3. 近似标准误\n\n我们使用delta方法推导标准误。对于一个作为随机变量 $m$ 的函数的估计量 $\\hat{N}$，比如 $\\hat{N} = g(m)$，其近似方差由以下公式给出：\n$$\\mathrm{Var}(\\hat{N}) \\approx \\left( \\frac{dg}{dm} \\right)^2 \\mathrm{Var}(m)$$\n问题给出了 $m$ 的超几何方差：\n$$\\mathrm{Var}(m) = n \\left(\\frac{M}{N}\\right) \\left(1-\\frac{M}{N}\\right) \\left(\\frac{N-n}{N-1}\\right)$$\n我们将通过代入适当的估计值 $\\hat{N}$ 来代替未知的真实值 $N$ 来计算这个表达式。标准误是这个估计方差的平方根。\n\n$\\hat{N}_{\\mathrm{LP}}$ 的标准误：\n估计量为 $\\hat{N}_{\\mathrm{LP}} = g(m) = \\frac{nM}{m}$。其导数为：\n$$\\frac{dg}{dm} = -\\frac{nM}{m^2}$$\n因此，估计方差 $\\widehat{\\mathrm{Var}}(\\hat{N}_{\\mathrm{LP}})$ 为：\n$$\\widehat{\\mathrm{Var}}(\\hat{N}_{\\mathrm{LP}}) \\approx \\left(-\\frac{nM}{m^2}\\right)^2 \\widehat{\\mathrm{Var}}(m) = \\left(\\frac{\\hat{N}_{\\mathrm{LP}}}{m}\\right)^2 \\widehat{\\mathrm{Var}}(m)$$\n我们通过代入 $N = \\hat{N}_{\\mathrm{LP}} = 800$ 来估计 $\\mathrm{Var}(m)$。\n$$\\widehat{\\mathrm{Var}}(m) = n \\left(\\frac{M}{\\hat{N}_{\\mathrm{LP}}}\\right) \\left(1-\\frac{M}{\\hat{N}_{\\mathrm{LP}}}\\right) \\left(\\frac{\\hat{N}_{\\mathrm{LP}}-n}{\\hat{N}_{\\mathrm{LP}}-1}\\right)$$\n利用关系式 $\\frac{M}{\\hat{N}_{\\mathrm{LP}}} = \\frac{m}{n}$，可以简化 $\\widehat{\\mathrm{Var}}(\\hat{N}_{\\mathrm{LP}})$ 的表达式：\n$$\\widehat{\\mathrm{Var}}(\\hat{N}_{\\mathrm{LP}}) \\approx \\left(\\frac{\\hat{N}_{\\mathrm{LP}}}{m}\\right)^2 \\left[ n \\left(\\frac{m}{n}\\right) \\left(1-\\frac{m}{n}\\right) \\left(\\frac{\\hat{N}_{\\mathrm{LP}}-n}{\\hat{N}_{\\mathrm{LP}}-1}\\right) \\right] = \\frac{\\hat{N}_{\\mathrm{LP}}^2 (n-m)}{mn} \\left(\\frac{\\hat{N}_{\\mathrm{LP}}-n}{\\hat{N}_{\\mathrm{LP}}-1}\\right)$$\n代入数值：\n$$\\widehat{\\mathrm{Var}}(\\hat{N}_{\\mathrm{LP}}) \\approx \\frac{(800)^2 (120-15)}{(15)(120)} \\left(\\frac{800-120}{800-1}\\right) = \\frac{640000 \\times 105}{1800} \\left(\\frac{680}{799}\\right) \\approx 31771.5$$\n标准误是其平方根：\n$$\\mathrm{SE}(\\hat{N}_{\\mathrm{LP}}) = \\sqrt{31771.5} \\approx 178.2456$$\n保留三位有效数字，$\\mathrm{SE}(\\hat{N}_{\\mathrm{LP}}) = 178$。\n\n$\\hat{N}_{\\mathrm{Ch}}$ 的标准误：\n估计量为 $\\hat{N}_{\\mathrm{Ch}} = g(m) = \\frac{(M+1)(n+1)}{m+1} - 1$。其导数为：\n$$\\frac{dg}{dm} = -\\frac{(M+1)(n+1)}{(m+1)^2}$$\n根据 $\\hat{N}_{\\mathrm{Ch}}$ 的定义，我们有 $\\hat{N}_{\\mathrm{Ch}} + 1 = \\frac{(M+1)(n+1)}{m+1}$，所以 $\\frac{dg}{dm} = -\\frac{\\hat{N}_{\\mathrm{Ch}}+1}{m+1}$。\n估计方差为：\n$$\\widehat{\\mathrm{Var}}(\\hat{N}_{\\mathrm{Ch}}) \\approx \\left(-\\frac{\\hat{N}_{\\mathrm{Ch}}+1}{m+1}\\right)^2 \\widehat{\\mathrm{Var}}(m)$$\n现在我们将 $N = \\hat{N}_{\\mathrm{Ch}} = 762.8125$ 代入 $m$ 的方差公式：\n$$\\widehat{\\mathrm{Var}}(\\hat{N}_{\\mathrm{Ch}}) \\approx \\left(\\frac{\\hat{N}_{\\mathrm{Ch}}+1}{m+1}\\right)^2 \\left[ n \\left(\\frac{M}{\\hat{N}_{\\mathrm{Ch}}}\\right) \\left(1-\\frac{M}{\\hat{N}_{\\mathrm{Ch}}}\\right) \\left(\\frac{\\hat{N}_{\\mathrm{Ch}}-n}{\\hat{N}_{\\mathrm{Ch}}-1}\\right) \\right]$$\n代入数值：\n$$\\widehat{\\mathrm{Var}}(\\hat{N}_{\\mathrm{Ch}}) \\approx \\left(\\frac{763.8125}{16}\\right)^2 \\left[ 120 \\left(\\frac{100}{762.8125}\\right) \\left(1-\\frac{100}{762.8125}\\right) \\left(\\frac{762.8125-120}{762.8125-1}\\right) \\right]$$\n$$\\widehat{\\mathrm{Var}}(\\hat{N}_{\\mathrm{Ch}}) \\approx (47.738...)^2 \\left[ 120 (0.13109...) (0.86890...) (0.84379...) \\right] \\approx (2278.94) (11.5286) \\approx 26274.5$$\n标准误是其平方根：\n$$\\mathrm{SE}(\\hat{N}_{\\mathrm{Ch}}) = \\sqrt{26274.5} \\approx 162.094$$\n保留三位有效数字，$\\mathrm{SE}(\\hat{N}_{\\mathrm{Ch}}) = 162$。\n\n4. 近似 $95\\%$ 置信区间\n\n我们使用正态近似来构建置信区间。通用公式为 $\\hat{N} \\pm z_{\\alpha/2} \\mathrm{SE}(\\hat{N})$。对于 $95\\%$ 的置信水平，$\\alpha=0.05$，临界值为 $z_{0.025} = 1.96$。\n\n$\\hat{N}_{\\mathrm{LP}}$ 的置信区间：\n$$\\mathrm{CI}_{\\mathrm{LP}} = 800 \\pm 1.96 \\times 178.2456 = 800 \\pm 349.36$$\n下限：$800 - 349.36 = 450.64$。四舍五入到三位有效数字，为 $451$。\n上限：$800 + 349.36 = 1149.36$。四舍五入到三位有效数字，为 $1.15 \\times 10^3$。\n\n$\\hat{N}_{\\mathrm{Ch}}$ 的置信区间：\n$$\\mathrm{CI}_{\\mathrm{Ch}} = 762.8125 \\pm 1.96 \\times 162.094 = 762.8125 \\pm 317.704$$\n下限：$762.8125 - 317.704 = 445.1085$。四舍五入到三位有效数字，为 $445$。\n上限：$762.8125 + 317.704 = 1080.5165$。四舍五入到三位有效数字，为 $1.08 \\times 10^3$。\n\n按顺序排列并四舍五入到三位有效数字的八个所需数值为：\n1. $\\hat{N}_{\\mathrm{LP}} = 8.00 \\times 10^2$\n2. $\\mathrm{SE}(\\hat{N}_{\\mathrm{LP}}) = 178$\n3. $\\hat{N}_{\\mathrm{LP}}$ 的置信区间下限 = 451\n4. $\\hat{N}_{\\mathrm{LP}}$ 的置信区间上限 = $1.15 \\times 10^3$\n5. $\\hat{N}_{\\mathrm{Ch}} = 763$\n6. $\\mathrm{SE}(\\hat{N}_{\\mathrm{Ch}}) = 162$\n7. $\\hat{N}_{\\mathrm{Ch}}$ 的置信区间下限 = 445\n8. $\\hat{N}_{\\mathrm{Ch}}$ 的置信区间上限 = $1.08 \\times 10^3$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n8.00 \\times 10^{2}  178  451  1.15 \\times 10^{3}  763  162  445  1.08 \\times 10^{3}\n\\end{pmatrix}\n}\n$$", "id": "2523184"}, {"introduction": "虽然方差的解析公式很有用，但它们依赖于可能不成立的大样本近似。本练习将介绍参数自举法（parametric bootstrap），这是一种强大的、基于模拟的方法，用于估算偏差和置信区间，且不依赖于正态性假设。通过亲手实现这一过程，您将更深入地理解潜在的抽样分布，并掌握一个进行稳健统计推断的关键工具。[@problem_id:2523164]", "problem": "在标准的两次捕获-再捕获设置下，对一个封闭种群进行两次抽样。令 $N$ 表示未知的种群大小，$n_1$ 表示在第一次捕获并标记的个体数量，$n_2$ 表示在第二次捕获的个体数量，$m$ 表示在第二次样本中之前被标记过的个体数量。假设在这两次捕获期间种群是封闭的，捕获概率在个体和时间上是同质的，且个体之间和捕获时机之间的捕获是独立的。在这些假设和无放回抽样的条件下，以 $N$、$n_1$ 和 $n_2$ 为条件，$m$ 是一个服从超几何分布的离散随机变量。任务是为双样本模型构建一个参数化自助法（parametric bootstrap），以估计偏差和一个对于 $N$ 的置信水平为 $1-\\alpha$ 的双侧置信区间，同时选择一个当 $m=0$ 时保持有限的估计量。你的构建必须仅基于这些基本假设和超几何抽样结构；不得调用渐近正态近似。\n\n你的程序必须实现以下几个部分：\n\n- 选择一个适用于小样本、偏差已减小、且当 $m=0$ 时为有限值的双样本估计量 $\\widehat{N}$，作为自助法数据生成模型的置入参数。仅使用两次捕获的数据 $(n_1,n_2,m)$。\n\n- 参数化自助法机制：以根据 $\\widehat{N}$ 构建的置入值 $N_0$ 为条件，从基本假设所蕴含的正确分布（即从大小为 $N_0$ 的种群中进行两次大小分别为 $n_1$ 和 $n_2$ 的独立无放回抽样所产生的分布）中模拟自助法再捕获数 $m^\\ast$。对于每次自助法重复，通过将相同的估计量应用于 $(n_1,n_2,m^\\ast)$ 来计算自助法估计值 $\\widehat{N}^\\ast$。\n\n- 将自助法偏差估计为 $\\widehat{\\text{bias}}=\\mathbb{E}^\\ast[\\widehat{N}^\\ast]-\\widehat{N}$，其中 $\\mathbb{E}^\\ast[\\cdot]$ 表示在自助法分布下的期望。通过在尾部概率 $\\alpha/2$ 和 $1-\\alpha/2$ 处使用百分位法对 $\\{\\widehat{N}^\\ast\\}$ 的经验累积分布函数进行求逆，来构建 $N$ 的一个置信水平为 $1-\\alpha$ 的双侧置信区间。\n\n- 在你的算法设计中，根据 $m$ 的离散性及其支撑集依赖于 $N$、$n_1$ 和 $n_2$ 的约束条件，论证选择参数化自助法的原因。\n\n本问题中的所有输出都是无单位的计数（没有物理单位）。概率必须解释为小数（例如，写 $0.95$ 而不是任何百分比表示法）。不涉及角度。\n\n测试套件和要求的输出：\n\n为下面的每个测试用例，实现你的程序以计算一个包含四个浮点数的列表 $[\\widehat{N},\\widehat{\\text{bias}},L,U]$，其中 $L$ 和 $U$ 分别是置信水平为 $1-\\alpha$ 的百分位区间下端点和上端点。使用以下测试套件：\n- 用例 A（典型）：$(n_1,n_2,m,\\alpha,B,\\text{seed})=(120,150,30,0.05,10000,42)$。\n- 用例 B（近边界小重叠）：$(n_1,n_2,m,\\alpha,B,\\text{seed})=(50,60,1,0.05,10000,12345)$。\n- 用例 C（大重叠）：$(n_1,n_2,m,\\alpha,B,\\text{seed})=(200,180,150,0.05,10000,2024)$。\n\n在每个用例中，在抽取任何自助法样本之前，使用给定的整数种子初始化随机数生成器，并使用恰好 $B$ 次独立的自助法重复。\n\n你的程序应生成单行输出，其中包含三个用例的结果，格式为用方括号括起来的逗号分隔列表，每个浮点数四舍五入到 $6$ 位小数，顺序为 $[\\text{用例 A},\\text{用例 B},\\text{用例 C}]$。例如，输出格式必须类似于\n$[[x_{A,1},x_{A,2},x_{A,3},x_{A,4}],[x_{B,1},x_{B,2},x_{B,3},x_{B,4}],[x_{C,1},x_{C,2},x_{C,3},x_{C,4}]]$,\n其中每个 $x_{\\cdot,\\cdot}$ 是以标准十进制表示法书写的浮点数。", "solution": "问题陈述已经过验证，并被确定为有效。这是一个在数量生态学和统计学中定义明确的问题，基于种群估计的既定第一性原理。它提供了所有必要的信息，没有科学错误、歧义和矛盾。我们可以着手解决。\n\n该问题要求构建一个参数化自助法程序，以估计在双样本捕获-再捕获研究中种群大小 $N$ 的偏差和置信区间。基本假设是封闭种群、同质的捕获概率和独立的捕获，这些假设意味着再捕获的个体数 $m$ 在以种群大小 $N$、第一次样本大小 $n_1$ 和第二次样本大小 $n_2$ 为条件下，服从超几何分布。\n\n首先，必须为 $N$ 选择一个合适的估计量。问题指明该估计量必须对小样本是偏差已减小的，并且在再捕获数 $m=0$ 时保持有限。经典的 Lincoln-Petersen 估计量 $\\widehat{N}_{LP} = \\frac{n_1 n_2}{m}$ 在这两方面都不满足要求，因为它在 $m=0$ 时无定义，并且已知是有偏的。一个满足这些要求的合适选择是 Chapman 估计量：\n$$\n\\widehat{N} = \\frac{(n_1+1)(n_2+1)}{m+1} - 1\n$$\n这个估计量是一个成熟的修正方法，它对所有有效的 $m \\ge 0$ 都是有限的，并且比 $\\widehat{N}_{LP}$ 具有更小的偏差，尤其是在 $n_1+n_2$ 接近 $N$ 时。这个估计量将用于初始估计和自助法再估计。\n\n参数化自助法程序构建如下：\n\n1.  **初始点估计**：给定观测数据 $(n_1, n_2, m)$，使用 Chapman 估计量计算种群大小的初始估计值：\n    $$\n    \\widehat{N} = \\frac{(n_1+1)(n_2+1)}{m+1} - 1\n    $$\n2.  **自助法模型构建**：参数化自助法从一个完全指定的模型中模拟数据，其中未知参数被其估计值替换。在这里，$m$ 的数据生成过程中唯一的未知参数是 $N$。我们将自助法模拟的种群大小设置为 $N_0 = \\text{round}(\\widehat{N})$。我们必须确保 $N_0 \\ge n_1$ 和 $N_0 \\ge n_2$。Chapman 估计量保证 $\\widehat{N} \\ge \\max(n_1, n_2)-1$，因此经过四舍五入后，$N_0$ 对于观测到的样本是一个有效的种群大小。\n3.  **自助法重复**：对于指定数量的重复次数 $B$，对 $b = 1, \\dots, B$ 重复以下步骤：\n    a. **数据生成**：通过从超几何分布中抽取一个随机变量来生成自助法再捕获样本 $m^{\\ast}_b$。该分布的参数对应于从一个大小为 $N_0$、包含 $n_1$ 个已标记个体的种群中，抽取一个大小为 $n_2$ 的第二次样本。其概率质量函数为：\n       $$\n       P(m^{\\ast} | N_0, n_1, n_2) = \\frac{\\binom{n_1}{m^{\\ast}} \\binom{N_0 - n_1}{n_2 - m^{\\ast}}}{\\binom{N_0}{n_2}}\n       $$\n       $m^{\\ast}$ 的有效支撑集为 $[\\max(0, n_1+n_2-N_0), \\min(n_1, n_2)]$。\n    b. **再估计**：使用自助法再捕获计数 $m^{\\ast}_b$，通过应用相同的 Chapman 估计量来计算种群大小的自助法估计值 $\\widehat{N}^{\\ast}_b$：\n       $$\n       \\widehat{N}^{\\ast}_b = \\frac{(n_1+1)(n_2+1)}{m^{\\ast}_b+1} - 1\n       $$\n    这个过程产生一个包含 $B$ 个自助法估计值的集合 $\\{\\widehat{N}^{\\ast}_1, \\widehat{N}^{\\ast}_2, \\dots, \\widehat{N}^{\\ast}_B\\}$，它构成了估计量 $\\widehat{N}$ 的一个经验分布。\n\n在这种情况下，使用参数化自助法是合理且必要的。关键统计量 $m$ 的分布是离散的，其支撑集关键性地依赖于未知参数 $N$。标准的非参数重抽样方法（例如，对个体进行重抽样）不能直接应用，也不容易调整以保持双样本的依赖结构。然而，参数化自助法直接遵循了抽样过程的基本理论模型。通过使用 $N$ 的置入估计值从超几何分布中进行模拟，我们正确地传播了研究设计中固有的抽样变异性。当 $m$ 很小时，这一点尤其关键，因为由此产生的 $\\widehat{N}$ 分布是高度偏斜的，这使得依赖于渐近正态性（已被明确禁止）的方法变得不准确。自助法提供了一种更稳健、更可靠的不确定性评估方法。\n\n最后，我们从自助法分布中计算所需的量：\n\n-   **自助法偏差**：估计量的偏差通过自助法估计值的均值与原始样本估计值之差来估计：\n    $$\n    \\widehat{\\text{bias}} = \\mathbb{E}^\\ast[\\widehat{N}^\\ast] - \\widehat{N} = \\left(\\frac{1}{B} \\sum_{b=1}^{B} \\widehat{N}^{\\ast}_b\\right) - \\widehat{N}\n    $$\n-   **百分位置信区间**：对于 $1-\\alpha$ 的置信水平，双侧百分位区间由经验自助法分布的分位数构成。下界 $L$ 是排序后的自助法估计值 $\\{\\widehat{N}^{\\ast}_{(b)}\\}$ 的第 $100(\\alpha/2)$ 百分位数，上界 $U$ 是第 $100(1-\\alpha/2)$ 百分位数。\n\n现在将实施该算法来解决所提供的测试用例。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import hypergeom\n\ndef solve():\n    \"\"\"\n    Solves the parametric bootstrap problem for capture-recapture analysis.\n    \"\"\"\n    # Test suite: (n1, n2, m, alpha, B, seed)\n    test_cases = [\n        (120, 150, 30, 0.05, 10000, 42),      # Case A\n        (50, 60, 1, 0.05, 10000, 12345),   # Case B\n        (200, 180, 150, 0.05, 10000, 2024),  # Case C\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        n1, n2, m, alpha, B, seed = case\n\n        # Initialize the random number generator for reproducibility\n        rng = np.random.default_rng(seed)\n\n        # Step 1: Compute the initial estimate of N using Chapman's estimator.\n        # This estimator is finite for m=0 and has reduced bias.\n        N_hat = ((n1 + 1) * (n2 + 1) / (m + 1)) - 1\n\n        # Step 2: Define the parameter for the bootstrap data-generating model.\n        # The population size is a discrete parameter.\n        N0 = int(round(N_hat))\n\n        # Basic check for hypergeometric distribution parameter validity.\n        # Chapman's estimator ensures N_hat >= max(n1, n2) - 1, so N0 is valid.\n        if N0  n1 or N0  n2:\n            # This case should not be reached with a valid estimator.\n            # Handle as an error or skip, but here we assume validity.\n            pass\n\n        # Step 3: Parametric Bootstrap - generate B bootstrap samples.\n        # a. Simulate m* from the hypergeometric distribution.\n        # M: total number of objects (population size N0)\n        # n: total number of type I objects (marked individuals n1)\n        # N: number of draws (second sample size n2)\n        m_star_samples = hypergeom.rvs(M=N0, n=n1, N=n2, size=B, random_state=rng)\n        \n        # b. Compute N* for each bootstrap sample m*.\n        # The operation is vectorized for efficiency.\n        N_star_estimates = ((n1 + 1) * (n2 + 1) / (m_star_samples + 1)) - 1\n        \n        # Step 4: Compute bias and confidence interval from bootstrap distribution.\n        \n        # Estimate the bootstrap bias.\n        bias = np.mean(N_star_estimates) - N_hat\n        \n        # Construct the percentile confidence interval.\n        lower_percentile = 100 * (alpha / 2)\n        upper_percentile = 100 * (1 - alpha / 2)\n        \n        L = np.percentile(N_star_estimates, lower_percentile)\n        U = np.percentile(N_star_estimates, upper_percentile)\n        \n        # Assemble the results for the current case.\n        # [N_hat, bias, lower_bound, upper_bound]\n        case_results = [N_hat, bias, L, U]\n        all_results.append(case_results)\n\n    # Format the final output string exactly as specified.\n    formatted_cases = [\n        f\"[{','.join(f'{val:.6f}' for val in res)}]\" for res in all_results\n    ]\n    final_output_string = f\"[{','.join(formatted_cases)}]\"\n    \n    print(final_output_string)\n\nsolve()\n```", "id": "2523164"}, {"introduction": "在实际研究中，生态学家常常需要在多个合理的捕获概率模型（如恒定、时变或异质性模型）之间做出选择。与其仅选择一个“最佳”模型，不如采用一种更稳健的方法，即对多个模型的结果进行平均。本练习将演示如何使用赤池信息准则（Akaike Information Criterion, AIC）为不同模型赋权，并计算模型平均的种群估算值及其无条件方差，从而正确地同时考虑抽样误差和模型选择的不确定性。[@problem_id:2523129]", "problem": "在一个种群封闭性合理的短时间内，使用 $T=5$ 次捕捉对一个封闭的溪流蝾螈种群进行了抽样。该研究记录了 $n_{\\text{obs}}=73$ 个独立个体。考虑了三种封闭种群捕获模型：模型 $M_{0}$（恒定捕获概率）、模型 $M_{t}$（时变捕获概率）和模型 $M_{h}$（捕获概率的个体异质性）。对于每个模型，最大似然（ML）分析产生了以下摘要，其中 $K$ 是模型估计的总自由参数数量（包括种群大小 $N$），$\\ell$ 是最大化对数似然，$\\hat{N}_{i}$ 是 $N$ 的特定模型点估计，$\\widehat{\\operatorname{Var}}_{i}$ 是模型 $i \\in \\{0,t,h\\}$ 下 $\\hat{N}_{i}$ 的基于模型的方差：\n\n- $M_{0}$：$K_{0}=2$，$\\ell_{0}=-210.3$，$\\hat{N}_{0}=92.4$，$\\widehat{\\operatorname{Var}}_{0}=56.7$。\n- $M_{t}$：$K_{t}=6$，$\\ell_{t}=-205.9$，$\\hat{N}_{t}=95.1$，$\\widehat{\\operatorname{Var}}_{t}=72.4$。\n- $M_{h}$：$K_{h}=4$，$\\ell_{h}=-205.1$，$\\hat{N}_{h}=98.7$，$\\widehat{\\operatorname{Var}}_{h}=64.5$。\n\n从赤池信息准则 (AIC) 的定义、使用有效样本量 $n_{\\text{obs}}$ 的小样本校正 (AICc)，以及全期望定律和全方差定律出发，完成以下任务：\n\n1. 计算 $M_{0}$、$M_{t}$ 和 $M_{h}$ 的小样本校正赤池值 (AICc)，然后推导出在模型集 $\\{M_{0},M_{t},M_{h}\\}$ 上构成概率质量函数的归一化赤池权重。\n2. 将这些权重解释为在相等模型先验下的经验模型分布，从第一性原理推导出 $N$ 的模型平均估计量，并计算其值。\n3. 应用全方差定律于模型平均估计量，推导出一个无条件方差表达式，该表达式同时考虑了模型内估计不确定性和模型间选择不确定性，并计算其数值。\n\n将第3部分的无条件方差报告为一个纯数。将您的答案四舍五入到四位有效数字。", "solution": "在尝试任何解答之前，对问题陈述进行验证。\n\n**步骤1：提取的已知条件**\n- 捕捉时机次数：$T=5$。\n- 观测到的独立个体数量（有效样本量）：$n_{\\text{obs}}=73$。\n- 评估的模型集：$\\{M_{0}, M_{t}, M_{h}\\}$。\n- 模型 $M_{0}$（恒定捕获概率）：\n  - 参数数量：$K_{0}=2$。\n  - 最大化对数似然：$\\ell_{0}=-210.3$。\n  - 种群大小估计：$\\hat{N}_{0}=92.4$。\n  - $\\hat{N}_{0}$ 的估计方差：$\\widehat{\\operatorname{Var}}_{0}=56.7$。\n- 模型 $M_{t}$（时变捕获概率）：\n  - 参数数量：$K_{t}=6$。\n  - 最大化对数似然：$\\ell_{t}=-205.9$。\n  - 种群大小估计：$\\hat{N}_{t}=95.1$。\n  - $\\hat{N}_{t}$ 的估计方差：$\\widehat{\\operatorname{Var}}_{t}=72.4$。\n- 模型 $M_{h}$（捕获概率的个体异质性）：\n  - 参数数量：$K_{h}=4$。\n  - 最大化对数似然：$\\ell_{h}=-205.1$。\n  - 种群大小估计：$\\hat{N}_{h}=98.7$。\n  - $\\hat{N}_{h}$ 的估计方差：$\\widehat{\\operatorname{Var}}_{h}=64.5$。\n\n**步骤2：验证**\n该问题具有科学依据，植根于标志重捕分析和信息论模型选择的既定生态学和统计学实践。所提出的模型（$M_{0}$、$M_{t}$、$M_{h}$）构成了封闭种群研究的标准模型集。提供了所有必要数据，术语精确，目标可量化。该问题不含科学谬误、矛盾或歧义。这是一个定量生态学中的良定问题。\n\n**步骤3：结论**\n问题有效。将构建解答。\n\n解答按规定分为三部分进行。\n\n**第1部分：AICc 和赤池权重**\n\n小样本校正的赤池信息准则 (AICc) 对于一个有 $K$ 个参数、最大化对数似然为 $\\ell$、样本量为 $n$ 的模型，定义如下：\n$$\n\\text{AICc} = -2\\ell + 2K + \\frac{2K(K+1)}{n-K-1}\n$$\n此处，有效样本量为 $n = n_{\\text{obs}} = 73$。我们计算三个模型中每一个的 AICc 值，其中 $i \\in \\{0, t, h\\}$。\n\n对于模型 $M_{0}$：\n$$\n\\text{AICc}_{0} = -2(-210.3) + 2(2) + \\frac{2(2)(2+1)}{73-2-1} = 420.6 + 4 + \\frac{12}{70} \\approx 424.7714\n$$\n对于模型 $M_{t}$：\n$$\n\\text{AICc}_{t} = -2(-205.9) + 2(6) + \\frac{2(6)(6+1)}{73-6-1} = 411.8 + 12 + \\frac{84}{66} \\approx 425.0727\n$$\n对于模型 $M_{h}$：\n$$\n\\text{AICc}_{h} = -2(-205.1) + 2(4) + \\frac{2(4)(4+1)}{73-4-1} = 410.2 + 8 + \\frac{40}{68} \\approx 418.7882\n$$\nAICc 值最小的模型是支持度最高的模型。我们发现 $\\text{AICc}_{\\min} = \\text{AICc}_{h} \\approx 418.7882$。\n\n接下来，我们计算 delta AICc 值，$\\Delta_i = \\text{AICc}_i - \\text{AICc}_{\\min}$：\n$$\n\\Delta_{0} = 424.7714 - 418.7882 = 5.9832\n$$\n$$\n\\Delta_{t} = 425.0727 - 418.7882 = 6.2845\n$$\n$$\n\\Delta_{h} = 418.7882 - 418.7882 = 0\n$$\n模型 $i$ 的赤池权重 $w_i$ 表示模型 $i$ 是该模型集中最佳模型的概率，其计算公式为：\n$$\nw_i = \\frac{\\exp(-\\frac{1}{2}\\Delta_i)}{\\sum_{j \\in \\{0,t,h\\}} \\exp(-\\frac{1}{2}\\Delta_j)}\n$$\n分母为：\n$$\n\\sum_{j} \\exp(-\\frac{1}{2}\\Delta_j) = \\exp(-\\frac{5.9832}{2}) + \\exp(-\\frac{6.2845}{2}) + \\exp(-\\frac{0}{2}) \\approx 0.05021 + 0.04319 + 1 = 1.0934\n$$\n各个权重为：\n$$\nw_{0} = \\frac{0.05021}{1.0934} \\approx 0.04592\n$$\n$$\nw_{t} = \\frac{0.04319}{1.0934} \\approx 0.03950\n$$\n$$\nw_{h} = \\frac{1}{1.0934} \\approx 0.91458\n$$\n\n**第2部分：N 的模型平均估计量**\n\n我们的任务是使用全期望定律从第一性原理推导 $N$ 的模型平均估计量。设 $\\hat{N}_a$ 是真实种群大小 $N$ 的模型平均估计量。设 $M$ 是一个离散随机变量，表示从集合 $\\{M_0, M_t, M_h\\}$ 中选择的模型，其概率质量函数为 $P(M=M_i) = w_i$。全期望定律指出，一个随机变量的期望值是其条件期望的期望值。应用于我们的估计量 $\\hat{N}_a$：\n$$\n\\hat{N}_a = E[\\hat{N}] = E_M[E[\\hat{N} | M]]\n$$\n内层期望 $E[\\hat{N} | M=M_i]$ 是在模型 $M_i$ 为真的条件下 $N$ 的点估计，即 $\\hat{N}_i$。外层期望是关于模型分布的期望，由赤池权重 $w_i$ 加权。展开为：\n$$\n\\hat{N}_a = \\sum_{i \\in \\{0,t,h\\}} E[\\hat{N} | M=M_i] P(M=M_i) = \\sum_{i \\in \\{0,t,h\\}} \\hat{N}_i w_i\n$$\n使用计算出的权重和给定的估计值：\n$$\n\\hat{N}_a = (92.4)(0.04592) + (95.1)(0.03950) + (98.7)(0.91458)\n$$\n$$\n\\hat{N}_a \\approx 4.243 + 3.756 + 90.269 = 98.268\n$$\n使用更高精度的权重值：$w_0 \\approx 0.04592186$，$w_t \\approx 0.03950005$，$w_h \\approx 0.91457809$。\n$$\n\\hat{N}_a = (92.4)(0.04592186) + (95.1)(0.03950005) + (98.7)(0.91457809) \\approx 98.26849\n$$\n\n**第3部分：无条件方差**\n\n我们必须使用全方差定律推导 $\\hat{N}_a$ 的无条件方差。该定律指出，对于随机变量 $X$ 和 $Y$，$\\operatorname{Var}(X) = E[\\operatorname{Var}(X|Y)] + \\operatorname{Var}(E[X|Y])$。将此应用于我们的估计量 $\\hat{N}_a$，并以模型选择 $M$ 为条件：\n$$\n\\widehat{\\operatorname{Var}}(\\hat{N}_a) = E_M[\\widehat{\\operatorname{Var}}(\\hat{N} | M)] + \\operatorname{Var}_M(E[\\hat{N} | M])\n$$\n第一项，$E_M[\\widehat{\\operatorname{Var}}(\\hat{N} | M)]$，是期望的模型内方差。条件方差 $\\widehat{\\operatorname{Var}}(\\hat{N} | M=M_i)$ 是在模型 $M_i$ 下计算的估计量 $\\hat{N}_i$ 的方差，即给定的 $\\widehat{\\operatorname{Var}}_i$。期望则是所有模型的加权平均：\n$$\nE_M[\\widehat{\\operatorname{Var}}(\\hat{N} | M)] = \\sum_{i} \\widehat{\\operatorname{Var}}_i w_i\n$$\n第二项，$\\operatorname{Var}_M(E[\\hat{N} | M])$，是条件期望的方差，代表了由于模型选择而产生的不确定性。条件期望 $E[\\hat{N} | M=M_i]$ 是点估计 $\\hat{N}_i$。我们需要计算一个取值为 $\\hat{N}_i$、概率为 $w_i$ 的离散随机变量的方差。该变量的均值为 $\\hat{N}_a$。因此方差为：\n$$\n\\operatorname{Var}_M(E[\\hat{N} | M]) = \\sum_{i} (\\hat{N}_i - E[\\hat{N}])^2 w_i = \\sum_{i} (\\hat{N}_i - \\hat{N}_a)^2 w_i\n$$\n结合这两项，得到由 Buckland、Burnham 和 Augustin (1997) 提出的无条件方差的估计量：\n$$\n\\widehat{\\operatorname{Var}}(\\hat{N}_a) = \\sum_{i} w_i \\widehat{\\operatorname{Var}}_i + \\sum_{i} w_i (\\hat{N}_i - \\hat{N}_a)^2 = \\sum_{i} w_i \\left( \\widehat{\\operatorname{Var}}_i + (\\hat{N}_i - \\hat{N}_a)^2 \\right)\n$$\n现在我们计算这个值。首先，是分量项 $(\\hat{N}_i - \\hat{N}_a)^2$：\n- $(\\hat{N}_0 - \\hat{N}_a)^2 = (92.4 - 98.26849)^2 \\approx (-5.86849)^2 \\approx 34.43927$\n- $(\\hat{N}_t - \\hat{N}_a)^2 = (95.1 - 98.26849)^2 \\approx (-3.16849)^2 \\approx 10.03943$\n- $(\\hat{N}_h - \\hat{N}_a)^2 = (98.7 - 98.26849)^2 \\approx (0.43151)^2 \\approx 0.18620$\n\n方差的第一个分量（模型内）：\n$$\n\\sum_{i} w_i \\widehat{\\operatorname{Var}}_i = (0.04592186)(56.7) + (0.03950005)(72.4) + (0.91457809)(64.5) \\approx 2.60477 + 2.85980 + 58.99029 \\approx 64.45486\n$$\n方差的第二个分量（模型间）：\n$$\n\\sum_{i} w_i (\\hat{N}_i - \\hat{N}_a)^2 = (0.04592186)(34.43927) + (0.03950005)(10.03943) + (0.91457809)(0.17024) \\approx 1.58148 + 0.39656 + 0.17024 \\approx 2.14828\n$$\n总无条件方差是这两个分量之和：\n$$\n\\widehat{\\operatorname{Var}}(\\hat{N}_a) = 64.45486 + 2.14828 = 66.60314\n$$\n四舍五入到四位有效数字，结果是 $66.60$。", "answer": "$$\n\\boxed{66.60}\n$$", "id": "2523129"}]}