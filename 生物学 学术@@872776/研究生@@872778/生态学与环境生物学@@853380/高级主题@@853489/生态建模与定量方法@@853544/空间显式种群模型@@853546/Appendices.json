{"hands_on_practices": [{"introduction": "我们的实践环节始于空间种群动态的基石——Fisher-KPP 方程。此练习 [@problem_id:2534611] 将引导你完成无量纲化，这是一种揭示系统内在尺度的强大技术，并通过行波分析来计算生物入侵的最小速度。掌握这些分析技能对于理解种群如何在连续景观中扩散至关重要。", "problem": "一个具有局部逻辑斯谛增长和沿一维（$1$-D）无界生境随机扩散的空间显式种群，可用Fisher–Kolmogorov–Petrovsky–Piskunov (Fisher–KPP) 反应扩散方程来建模：\n$$\n\\frac{\\partial N}{\\partial t} \\;=\\; D\\,\\frac{\\partial^{2}N}{\\partial x^{2}} \\;+\\; r\\,N\\Bigl(1-\\frac{N}{K}\\Bigr),\n$$\n其中 $N(x,t)$ 是种群密度，$D$ 是扩散系数，$r$ 是内禀增长率，$K$ 是环境承载力。考虑一个物种，其参数为 $D=0.5\\,\\text{km}^{2}/\\text{yr}$，$r=0.2\\,\\text{yr}^{-1}$，$K=100\\,\\text{ind}/\\text{km}^{2}$。\n\n使用量纲分析和标度变换的基本原理，执行以下操作：\n\n1) 引入无量纲变量，通过选择空间的特征尺度 $L$、时间的特征尺度 $T$ 和密度的特征尺度 $K$ 将方程变换为无量纲形式。选择 $L$ 和 $T$ 使得变换后方程中扩散项和增长项的系数均等于 $1$。写出得到的无量纲偏微分方程，并指出方程中剩余的任何内蕴无量纲参数。\n\n2) 在无界直线上，考虑连接不稳定状态和稳定状态的单调行进入侵波。从第(1)部分得到的无量纲方程出发，使用行波约化以及关于前缘的线性化来确定最小无量纲入侵速度。然后将此最小速度转换回有量纲单位，以得到一个用 $D$ 和 $r$ 表示的显式表达式。最后，对给定物种，数值计算这个最小入侵速度。以 $\\text{km}/\\text{yr}$ 为单位表示您的最终数值答案，并四舍五入到四位有效数字。\n\n您最终报告的答案必须是一个实数，代表以 $\\text{km}/\\text{yr}$ 为单位的最小入侵速度，并四舍五入到四位有效数字。", "solution": "所提出的问题是反应扩散方程分析中的一个标准且适定的练习，特别是针对Fisher-Kolmogorov-Petrovsky-Piskunov (Fisher-KPP)方程。它具有科学依据，内部一致，并包含了获得唯一解所需的所有必要信息。我们将着手进行分析。\n\n控制方程如下：\n$$\n\\frac{\\partial N}{\\partial t} \\;=\\; D\\,\\frac{\\partial^{2}N}{\\partial x^{2}} \\;+\\; r\\,N\\Bigl(1-\\frac{N}{K}\\Bigr)\n$$\n其中$N(x,t)$是种群密度，$D$是扩散系数，$r$是内禀增长率，$K$是环境承载力。给定的参数值为$D=0.5\\,\\text{km}^{2}/\\text{yr}$，$r=0.2\\,\\text{yr}^{-1}$，$K=100\\,\\text{ind}/\\text{km}^{2}$。\n\n**第1部分：无量纲化**\n\n我们引入以下无量纲变量，使用长度的特征尺度$L$、时间的特征尺度$T$和种群密度的特征尺度$K$：\n$$\nu = \\frac{N}{K}, \\quad \\xi = \\frac{x}{L}, \\quad \\tau = \\frac{t}{T}\n$$\n此处，$u$、$\\xi$和$\\tau$分别是无量纲的密度、空间和时间变量。我们使用链式法则，用这些新变量来表示原方程中的导数：\n$$\n\\frac{\\partial N}{\\partial t} = \\frac{\\partial (Ku)}{\\partial \\tau} \\frac{\\partial \\tau}{\\partial t} = \\frac{K}{T} \\frac{\\partial u}{\\partial \\tau}\n$$\n$$\n\\frac{\\partial N}{\\partial x} = \\frac{\\partial (Ku)}{\\partial \\xi} \\frac{\\partial \\xi}{\\partial x} = \\frac{K}{L} \\frac{\\partial u}{\\partial \\xi} \\quad \\implies \\quad \\frac{\\partial^{2} N}{\\partial x^{2}} = \\frac{\\partial}{\\partial x}\\left(\\frac{K}{L}\\frac{\\partial u}{\\partial \\xi}\\right) = \\frac{K}{L} \\frac{\\partial}{\\partial \\xi}\\left(\\frac{\\partial u}{\\partial \\xi}\\right) \\frac{\\partial \\xi}{\\partial x} = \\frac{K}{L^2} \\frac{\\partial^{2} u}{\\partial \\xi^{2}}\n$$\n将这些表达式代入Fisher-KPP方程，得到：\n$$\n\\frac{K}{T} \\frac{\\partial u}{\\partial \\tau} = D \\frac{K}{L^2} \\frac{\\partial^{2} u}{\\partial \\xi^{2}} + r (Ku) \\left(1 - \\frac{Ku}{K}\\right)\n$$\n整个方程除以$K$并重新整理，得到：\n$$\n\\frac{1}{T} \\frac{\\partial u}{\\partial \\tau} = \\frac{D}{L^2} \\frac{\\partial^{2} u}{\\partial \\xi^{2}} + r u(1 - u)\n$$\n乘以$T$，我们得到：\n$$\n\\frac{\\partial u}{\\partial \\tau} = \\frac{DT}{L^2} \\frac{\\partial^{2} u}{\\partial \\xi^{2}} + rT u(1 - u)\n$$\n问题要求我们选择特征尺度$L$和$T$，使得扩散项和反应项的系数都等于$1$。这给出了一个关于$L$和$T$的两个代数方程组：\n$$\n\\frac{DT}{L^2} = 1\n$$\n$$\nrT = 1\n$$\n从第二个方程，我们求得特征时间尺度$T$：\n$$\nT = \\frac{1}{r}\n$$\n将此结果代入第一个方程，我们可以解出特征长度尺度$L$：\n$$\n\\frac{D(1/r)}{L^2} = 1 \\quad \\implies \\quad \\frac{D}{r} = L^2 \\quad \\implies \\quad L = \\sqrt{\\frac{D}{r}}\n$$\n使用这些特征尺度，Fisher-KPP方程的无量纲形式变为：\n$$\n\\frac{\\partial u}{\\partial \\tau} = \\frac{\\partial^2 u}{\\partial \\xi^2} + u(1-u)\n$$\n在这个标准形式中，所有有量纲参数（$D$、$r$、$K$）都已被吸收到变量的标度变换中。因此，方程本身不再含有内蕴的无量纲参数。\n\n**第2部分：最小入侵速度**\n\n我们分析无量纲方程的行波解，其形式为 $u(\\xi, \\tau) = U(z)$，其中 $z = \\xi - c\\tau$ 是行波坐标，$c$ 是常数，即无量纲波速。该波连接了不稳定平衡态 $u=0$ 和稳定平衡态 $u=1$。导数变换如下：\n$$\n\\frac{\\partial u}{\\partial \\tau} = -c \\frac{dU}{dz}, \\quad \\frac{\\partial^2 u}{\\partial \\xi^2} = \\frac{d^2 U}{dz^2}\n$$\n将这些代入无量纲偏微分方程，得到一个关于波形$U(z)$的二阶常微分方程：\n$$\n-c U' = U'' + U(1-U) \\quad \\text{或} \\quad U'' + cU' + U(1-U) = 0\n$$\n入侵锋的边界条件是，当 $z \\to \\infty$ 时 $U(z) \\to 0$（前缘），当 $z \\to -\\infty$ 时 $U(z) \\to 1$（后缘）。\n\n为了确定最小速度，我们分析波前缘的行为，此处$U$接近于$0$。在此极限下，项 $U(1-U) = U - U^2$ 可以线性化为 $U$。该常微分方程变为：\n$$\nU'' + cU' + U \\approx 0\n$$\n这是一个常系数线性齐次常微分方程。我们寻找形如 $U(z) \\propto \\exp(-\\lambda z)$ 的指数解，它在$z$很大时必须衰减（因此$\\lambda  0$）。代入线性化的常微分方程，得到关于$\\lambda$的特征方程：\n$$\n\\lambda^2 - c\\lambda + 1 = 0\n$$\n$\\lambda$的根由二次求根公式给出：\n$$\n\\lambda = \\frac{c \\pm \\sqrt{c^2 - 4}}{2}\n$$\n为了使种群密度在前缘处呈单调（非振荡）衰减，根$\\lambda$必须是实数且为正。实数根的条件是判别式必须为非负：\n$$\nc^2 - 4 \\ge 0 \\quad \\implies \\quad c^2 \\ge 4\n$$\n由于入侵速度$c$必须为正，这意味着$c \\ge 2$。因此，最小可能的无量纲速度是：\n$$\nc_{min} = 2\n$$\n现在，我们必须将这个最小无量纲速度转换回有量纲单位。有量纲速度$v$与无量纲速度$c$通过特征速度$L/T$相关联：\n$$\nv = c \\frac{L}{T}\n$$\n使用我们前面推导出的$L$和$T$的表达式：\n$$\n\\frac{L}{T} = \\frac{\\sqrt{D/r}}{1/r} = r \\sqrt{\\frac{D}{r}} = \\sqrt{r^2 \\frac{D}{r}} = \\sqrt{Dr}\n$$\n因此，有量纲速度为 $v = c \\sqrt{Dr}$。最小入侵速度$v_{min}$对应于$c_{min}=2$：\n$$\nv_{min} = 2\\sqrt{Dr}\n$$\n这就是著名的Fisher-KPP方程最小入侵速度公式。\n\n最后，我们使用给定的参数值来计算这个速度：$D = 0.5\\,\\text{km}^{2}/\\text{yr}$ 和 $r = 0.2\\,\\text{yr}^{-1}$。\n$$\nv_{min} = 2 \\sqrt{(0.5\\,\\text{km}^{2}/\\text{yr})(0.2\\,\\text{yr}^{-1})} = 2 \\sqrt{0.1\\,\\text{km}^{2}/\\text{yr}^{2}}\n$$\n$$\nv_{min} = 2 \\sqrt{0.1} \\, \\text{km}/\\text{yr} \\approx 2 \\times 0.316227766... \\, \\text{km}/\\text{yr}\n$$\n$$\nv_{min} \\approx 0.632455532... \\, \\text{km}/\\text{yr}\n$$\n按照要求将结果四舍五入到四位有效数字，我们得到 $0.6325\\,\\text{km}/\\text{yr}$。", "answer": "$$\n\\boxed{0.6325}\n$$", "id": "2534611"}, {"introduction": "从连续景观转向离散的生境斑块，我们来探索集合种群动态，这是保护生物学中的一个关键概念。这个实践 [@problem_id:2534600] 要求你实现一个斑块占据模型，在该模型中，你将首先根据种群统计数据将生境分为“源”和“汇”。然后，你将求解集合种群的平衡状态，从而深入了解扩散连通性如何使源种群能够维持汇种群的存在。", "problem": "给定一个空间显式、密度无关的斑块模型。对于每个由 $i \\in \\{0,1,2,3,4\\}$ 索引的斑块，您拥有每个时间步的人均存活率 $s_i$ 和以普查新员衡量的每个时间步人均繁殖力 $f_i$。假设采用繁殖后普查，因此局部有限增长率为 $\\lambda_i = s_i + f_i$。将内禀增长率定义为 $r_i = \\ln(\\lambda_i)$。如果 $r_i  0$，则斑块为源；如果 $r_i  0$，则为汇。\n\n扩散驱动的定殖由一个连接性矩阵 $A(\\alpha)$ 建模，其元素为\n$$\nA_{ij}(\\alpha) = \n\\begin{cases}\n\\exp\\left(-\\dfrac{d_{ij}}{\\alpha}\\right),  \\text{若 } i \\neq j, \\\\\n0,  \\text{若 } i = j,\n\\end{cases}\n$$\n其中 $d_{ij}$ 是斑块 $i$ 和 $j$ 形心之间的欧几里得距离，$\\alpha  0$ 是一个扩散长度尺度参数。对于每个斑块 $i$，定殖压力为 $c_i = \\beta \\sum_{j=0}^{4} A_{ij}(\\alpha) p_j$，其中 $p_i \\in [0,1]$ 是斑块 $i$ 在平衡状态下的占据概率，$\\beta  0$ 是一个全局定殖标度。局部灭绝率依赖于斑块类型：如果斑块 $i$ 是源，则 $e_i = e_{\\text{src}}$；如果斑块 $i$ 是汇，则 $e_i = e_{\\text{snk}}$。占据动态遵循经典的斑块占据微分方程\n$$\n\\frac{dp_i}{dt} = \\left(1 - p_i\\right) c_i - e_i p_i,\n$$\n平衡状态由不动点条件确定\n$$\np_i = \\frac{c_i}{c_i + e_i} \\quad \\text{其中} \\quad c_i = \\beta \\sum_{j=0}^{4} A_{ij}(\\alpha) p_j.\n$$\n您必须对每个指定的 $\\alpha$，通过不动点迭代求解稳定不动点 $p \\in [0,1]^5$，从任何合理的初始猜测开始，并迭代直到连续迭代之间的无穷范数差小于一个严格的容差。\n\n使用以下数据：\n- 斑块坐标 $(x_i,y_i)$:\n  - 斑块 $0$: $(0.0, 0.0)$\n  - 斑块 $1$: $(1.5, 0.2)$\n  - 斑块 $2$: $(0.8, 1.0)$\n  - 斑块 $3$: $(2.5, 1.7)$\n  - 斑块 $4$: $(3.0, 0.1)$\n- 存活率 $s_i$ 和繁殖力 $f_i$:\n  - $s = [0.70, 0.50, 0.65, 0.40, 0.55]$\n  - $f = [0.60, 0.30, 0.55, 0.35, 0.30]$\n- 定殖标度和灭绝参数：\n  - $\\beta = 0.60$\n  - $e_{\\text{src}} = 0.10$\n  - $e_{\\text{snk}} = 0.50$\n\n您的任务：\n1. 对每个 $i \\in \\{0,1,2,3,4\\}$，计算 $\\lambda_i = s_i + f_i$ 和 $r_i = \\ln(\\lambda_i)$。如果 $r_i  0$，将每个斑块分类为源；如果 $r_i  0$，则分类为汇。将分类表示为一个长度为 $5$ 的整数列表，其中源为 $1$，汇为 $0$，按斑块索引升序排列。\n2. 对于扩散长度尺度 $\\alpha$ 的每个情景值，求解平衡不动点系统\n   $$\n   p_i = \\frac{\\beta \\sum_{j=0}^{4} A_{ij}(\\alpha) p_j}{\\beta \\sum_{j=0}^{4} A_{ij}(\\alpha) p_j + e_i}\n   $$\n   使用不动点迭代法，对无穷范数设置严格的收敛容差 $\\varepsilon = 10^{-12}$，并设置 $10^6$ 次迭代的硬性上限，以避免在收敛失败时不终止。使用步骤 $1$ 的分类为每个斑块设置 $e_i$。\n3. 对于每个情景，仅报告汇斑块的占据概率，按斑块索引升序排列，每个概率四舍五入到恰好三位小数。\n\n测试套件：\n- 使用以下四个 $\\alpha$ 值构成测试套件，以评估模型在不同连接性机制下的行为：$\\alpha \\in \\{0.50, 1.00, 2.00, 4.00\\}$。该集合包括一个低连接性案例、两个中等连接性案例和一个高连接性案例。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个外层方括号内的两个项目。\n  1. 第一个项目是长度为 $5$ 的分类列表，其条目在 $\\{0,1\\}$ 中，表示汇（$0$）或源（$1$），按斑块索引顺序 $[0,1,2,3,4]$ 排列。\n  2. 第二个项目是列表的列表，每个 $\\alpha$（按 $\\alpha = 0.50, 1.00, 2.00, 4.00$ 的顺序）对应一个内部列表，其中每个内部列表仅包含汇斑块的平衡占据概率，按斑块索引升序排列并四舍五入到三位小数。\n- 例如，最后一行应如下所示：\n  $$\n  [[b_0,b_1,b_2,b_3,b_4],[[q_{1}^{(1)},q_{3}^{(1)},q_{4}^{(1)}],[q_{1}^{(2)},q_{3}^{(2)},q_{4}^{(2)}],[q_{1}^{(3)},q_{3}^{(3)},q_{4}^{(3)}],[q_{1}^{(4)},q_{3}^{(4)},q_{4}^{(4)}]]]\n  $$\n  其中 $b_i \\in \\{0,1\\}$，每个 $q_{k}^{(\\ell)}$ 是一个四舍五入到三位的小数。确保程序仅打印此行，不含多余的空格或文本。\n\n本问题中的所有量都是无单位的，且以每个时间步为单位。不涉及角度。所要求的答案是如上指定的整数列表和浮点数列表。您的解决方案必须实现为一个完整、可运行的程序。", "solution": "问题陈述已经过验证，被认为是科学上合理、定义明确且自洽的。它提出了一个来自理论生态学的标准斑块占据集合种群模型。所有参数和控制方程都已明确定义。我们将着手解决。\n\n该问题需要一个分两部分的计算。首先，我们必须根据每个斑块的内禀种群统计学特性将其分类为源或汇。其次，对于一组给定的扩散长度尺度 $\\alpha$，我们必须使用不动点迭代方案求解平衡斑块占据概率 $p_i$。\n\n**第一部分：斑块分类**\n\n一个斑块被分类为源或汇取决于其内禀增长率 $r_i$。这源于每个斑块 $i \\in \\{0, 1, 2, 3, 4\\}$ 的人均存活率 $s_i$ 和繁殖力 $f_i$。对于一个繁殖后普查模型，局部有限增长率 $\\lambda_i$ 定义为存活率和繁殖力之和：\n$$\n\\lambda_i = s_i + f_i\n$$\n内禀增长率 $r_i$ 是 $\\lambda_i$ 的自然对数：\n$$\nr_i = \\ln(\\lambda_i)\n$$\n如果一个斑块 $i$ 的种群在隔离状态下会增长（$r_i  0$），则它是一个源；如果会减少（$r_i  0$），则它是一个汇。\n\n给定的数据是：\n- 存活率：$s = [0.70, 0.50, 0.65, 0.40, 0.55]$\n- 繁殖率：$f = [0.60, 0.30, 0.55, 0.35, 0.30]$\n\n我们为每个斑块 $i$ 计算 $\\lambda_i$：\n- $\\lambda_0 = s_0 + f_0 = 0.70 + 0.60 = 1.30$\n- $\\lambda_1 = s_1 + f_1 = 0.50 + 0.30 = 0.80$\n- $\\lambda_2 = s_2 + f_2 = 0.65 + 0.55 = 1.20$\n- $\\lambda_3 = s_3 + f_3 = 0.40 + 0.35 = 0.75$\n- $\\lambda_4 = s_4 + f_4 = 0.55 + 0.30 = 0.85$\n\n接下来，我们计算 $r_i = \\ln(\\lambda_i)$:\n- $r_0 = \\ln(1.30) \\approx 0.262  0 \\implies$ 源\n- $r_1 = \\ln(0.80) \\approx -0.223  0 \\implies$ 汇\n- $r_2 = \\ln(1.20) \\approx 0.182  0 \\implies$ 源\n- $r_3 = \\ln(0.75) \\approx -0.288  0 \\implies$ 汇\n- $r_4 = \\ln(0.85) \\approx -0.163  0 \\implies$ 汇\n\n分类结果，用 $1$ 表示源，$0$ 表示汇，为 $[1, 0, 1, 0, 0]$。\n相应的局部灭绝率 $e_i$ 根据此分类使用提供的参数 $e_{\\text{src}} = 0.10$ 和 $e_{\\text{snk}} = 0.50$ 进行设置：\n$$\ne = [0.10, 0.50, 0.10, 0.50, 0.50]\n$$\n\n**第二部分：平衡占据概率**\n\n平衡占据概率 $p = [p_0, p_1, p_2, p_3, p_4]$ 由不动点方程确定：\n$$\np_i = \\frac{c_i}{c_i + e_i}\n$$\n其中定殖压力 $c_i$ 由下式给出\n$$\nc_i = \\beta \\sum_{j=0}^{4} A_{ij}(\\alpha) p_j\n$$\n全局定殖标度为 $\\beta = 0.60$。连接性矩阵 $A(\\alpha)$ 取决于扩散长度尺度 $\\alpha$ 和斑块形心之间的欧几里得距离 $d_{ij}$。其元素为 $A_{ij}(\\alpha) = \\exp(-d_{ij}/\\alpha)$（当 $i \\neq j$ 时）和 $A_{ii}(\\alpha) = 0$。\n\n首先，我们使用斑块坐标计算对称距离矩阵 $D$，其中 $D_{ij} = d_{ij}$：\n- $P_0=(0.0, 0.0)$, $P_1=(1.5, 0.2)$, $P_2=(0.8, 1.0)$, $P_3=(2.5, 1.7)$, $P_4=(3.0, 0.1)$。\n这产生诸如 $d_{01} = \\sqrt{(1.5-0.0)^2 + (0.2-0.0)^2} \\approx 1.513$ 的距离。\n\n我们必须为每个指定的 $\\alpha \\in \\{0.50, 1.00, 2.00, 4.00\\}$ 值求解该系统。问题指定使用不动点迭代法。设第 $k$ 次迭代的概率向量为 $p^{(k)}$。下一个迭代 $p^{(k+1)}$ 由映射 $F$ 给出：\n$$\np^{(k+1)} = F(p^{(k)})\n$$\n其中映射的第 $i$ 个分量是：\n$$\n[F(p)]_i = \\frac{\\beta \\sum_{j=0}^{4} A_{ij}(\\alpha) p_j}{\\beta \\sum_{j=0}^{4} A_{ij}(\\alpha) p_j + e_i}\n$$\n对于每个 $\\alpha$，迭代过程如下：\n1.  使用预计算的距离矩阵 $D$ 计算连接性矩阵 $A(\\alpha)$。\n2.  初始化概率向量 $p^{(0)}$。一个合理的选择是 $p^{(0)}_i = 0.5$（对于所有 $i$），以避免 $p=0$ 处的平凡不动点。\n3.  迭代 $p^{(k+1)} = F(p^{(k)})$，其中 $k = 0, 1, 2, \\ldots$\n4.  当连续迭代之间的无穷范数差小于容差 $\\varepsilon = 10^{-12}$ 时停止：\n    $$\n    \\|p^{(k+1)} - p^{(k)}\\|_{\\infty} = \\max_i |p_{i}^{(k+1)} - p_{i}^{(k)}|  \\varepsilon\n    $$\n5.  为防止不终止，强制执行最多 $10^6$ 次迭代。\n\n一旦迭代收敛到不动点 $p^*$，我们提取汇斑块（即斑块 $1, 3, 4$）的概率。然后将这些概率（$p_1^*, p_3^*, p_4^*$）四舍五入到三位小数。对测试套件中的每个 $\\alpha$ 重复此过程。\n\n最终输出是一个包含两个元素的列表：斑块分类列表和一个列表的列表，其中每个内部列表包含对应给定 $\\alpha$ 的汇斑块的四舍五入后的平衡占据概率。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the patch-occupancy model problem as specified.\n\n    1. Classifies patches as sources or sinks.\n    2. For each alpha, solves for equilibrium occupancies using fixed-point iteration.\n    3. Formats the results into the required output string.\n    \"\"\"\n    # Define given parameters\n    coords = np.array([\n        [0.0, 0.0],  # Patch 0\n        [1.5, 0.2],  # Patch 1\n        [0.8, 1.0],  # Patch 2\n        [2.5, 1.7],  # Patch 3\n        [3.0, 0.1]   # Patch 4\n    ])\n    s = np.array([0.70, 0.50, 0.65, 0.40, 0.55])\n    f = np.array([0.60, 0.30, 0.55, 0.35, 0.30])\n    \n    beta = 0.60\n    e_src = 0.10\n    e_snk = 0.50\n    \n    alphas = [0.50, 1.00, 2.00, 4.00]\n    tolerance = 1e-12\n    max_iterations = 1_000_000\n    n_patches = len(coords)\n\n    # --- Task 1: Patch Classification ---\n    lambda_vals = s + f\n    r_vals = np.log(lambda_vals)\n    \n    # Classification: 1 for source (r > 0), 0 for sink (r  0)\n    classification = (r_vals > 0).astype(int).tolist()\n    \n    # Assign extinction rates based on classification\n    e_rates = np.where(r_vals > 0, e_src, e_snk)\n    \n    # Identify indices of sink patches for final reporting\n    sink_indices = np.where(r_vals  0)[0]\n    \n    # --- Pre-computation: Distance Matrix ---\n    dist_matrix = np.zeros((n_patches, n_patches))\n    for i in range(n_patches):\n        for j in range(i, n_patches):\n            dist = np.linalg.norm(coords[i] - coords[j])\n            dist_matrix[i, j] = dist\n            dist_matrix[j, i] = dist\n\n    # --- Task 2  3: Fixed-Point Iteration and Result Collection ---\n    all_sink_occupancies = []\n    \n    for alpha in alphas:\n        # Compute connectivity matrix A(alpha)\n        # We explicitly set a large value where alpha is zero to avoid division by zero,\n        # though the problem states alpha > 0. This is just for robustness.\n        # The exponential of a large negative number will be zero.\n        with np.errstate(divide='ignore', invalid='ignore'):\n            A = np.exp(-dist_matrix / alpha)\n        \n        # Diagonal entries are 0\n        np.fill_diagonal(A, 0)\n        \n        # Initialize occupancy probabilities (vector p)\n        # Start with 0.5 to avoid the trivial fixed point at p=0\n        p = np.full(n_patches, 0.5)\n\n        for _ in range(max_iterations):\n            p_old = p.copy()\n            \n            # Calculate colonization pressure (vector c)\n            c = beta * (A @ p_old)\n            \n            # Update occupancy probabilities using the fixed-point equation\n            # p_i = c_i / (c_i + e_i)\n            # Handle c_i + e_i = 0 case, though unlikely as e_i > 0\n            denominator = c + e_rates\n            p = np.divide(c, denominator, out=np.zeros_like(c), where=denominator!=0)\n\n            # Check for convergence using the infinity norm\n            if np.linalg.norm(p - p_old, ord=np.inf)  tolerance:\n                break\n        \n        # Extract occupancy probabilities for sink patches\n        sink_p = p[sink_indices]\n        \n        # Round to three decimal places\n        rounded_sink_p = np.round(sink_p, 3).tolist()\n        all_sink_occupancies.append(rounded_sink_p)\n        \n    # --- Final Output Formatting ---\n    # Assemble the final data structure\n    final_result = [classification, all_sink_occupancies]\n    \n    # Convert the result to a string representation without spaces\n    output_str = str(final_result).replace(\" \", \"\")\n    \n    print(output_str)\n\nsolve()\n```", "id": "2534600"}, {"introduction": "我们最后的实践将斑块模型提升到一个随机和应用框架中，以应对保护领域的一个常见挑战：设计有效的保护区网络。在此练习 [@problem_id:2534612] 中，你将为一个集合种群的动态构建一个完整的马尔可夫链模型，其中包含了局部灭绝和定殖的概率。你的目标是利用此模型找到保护区的最优布局，以最大化集合种群的存续概率，这展示了理论模型与实际决策之间的强大联系。", "problem": "要求您为一个定义在有限图上的离散时间、随机、空间显式的异质种群，形式化并解决一个优化问题。该系统是一组由节点表示的生境斑块，潜在的定殖尝试沿着由距离依赖核函数加权的边进行。在每个时间步，已占据的斑块可能会灭绝，而空的斑块可能会被传入的繁殖体定殖。一个保护区网络通过降低选定斑块子集的灭绝率来保护它们。目标是在固定预算的约束下，选择要保护哪些斑块，以最大化该异质种群在指定的未来时间点持续存在（即未全局灭绝）的概率。\n\n建模假设与基本基础：\n- 设有$n$个生境斑块（节点）。斑块$i$在离散时间$t$的占据状态是一个二元随机变量$X_i(t) \\in \\{0,1\\}$，其中$X_i(t)=1$表示被占据，$X_i(t)=0$表示为空。系统状态为$X(t) = (X_1(t),\\dots,X_n(t)) \\in \\{0,1\\}^n$。\n- 灭绝过程：对于在时间$t$每个被占据的斑块$i$，到时间$t+1$发生局部灭绝的事件概率为$e_i'$，如果该斑块未受保护，则$e_i'$等于基线灭绝概率$e_i$；如果该斑块受保护，则$e_i'$等于降低后的灭绝概率$r \\cdot e_i$，其中$r \\in (0,1)$是一个给定的保护因子。\n- 定殖过程：对于在时间$t$每个空的斑块$i$，每个被占据的供体斑块$j \\neq i$独立地尝试进行定殖，成功概率为$p_{ji}$，其中$p_{ji} = 1 - \\exp(-\\beta K_{ji})$，扩散核函数为$K_{ji} = \\exp(-\\alpha d_{ji})$，其中$d_{ji}$是给定的斑块间距离，$\\alpha  0$是距离衰减参数，$\\beta  0$是扩散强度参数。不存在自我定殖，因此$K_{ii} = 0$。根据供体尝试的独立性，给定时间$t$的供体集合，斑块$i$到时间$t+1$被定殖的概率等于$1 - \\prod_{j: X_j(t)=1, j \\neq i} (1 - p_{ji})$。\n- 接收斑块间的条件独立性：给定$X(t)$，不同斑块的转变是独立的。因此，占据状态$X(t)$构成状态空间$\\{0,1\\}^n$上的一个有限、时间齐次的马尔可夫链（MC），从$x \\in \\{0,1\\}^n$到$y \\in \\{0,1\\}^n$的转移概率等于由上述规则所蕴含的各单个斑块转移概率在$i \\in \\{1,\\dots,n\\}$上的乘积。\n\n目标定义：\n- 对于一个固定的时间范围$T \\in \\mathbb{N}$和一个初始状态$x^{(0)} \\in \\{0,1\\}^n$，令$P_R$表示当受保护斑块集合为$R \\subseteq \\{1,\\dots,n\\}$时的转移核。令$\\pi_0$为$x^{(0)}$上的单点分布。通过$\\pi_{t+1} = \\pi_t P_R$来演化该分布。在保护集$R$下，到时间$T$的持续存在概率是在时间$T$到达状态空间的非灭绝区域的概率，即$1 - \\pi_T(\\mathbf{0})$，其中$\\mathbf{0}$是全零向量。您的任务是选择一个$|R| = B$的集合$R$来最大化这个概率。\n- 对于给定的小型图，必须通过对所有大小为$B$的子集进行穷举搜索来精确解决此问题。\n\n程序要求：\n- 完全按照上述描述实现模型，为每个保护集$R$显式构建有限状态马尔可夫链转移核，从给定的初始状态$x^{(0)}$精确演化分布$T$步，并计算得到的到时间$T$的持续存在概率。然后返回所有大小为$B$的保护集$R$中的最大概率。\n- 程序不得使用任何随机化方法。所有概率都必须根据模型规范精确计算，不得进行模拟。\n- 所有答案必须报告为浮点数，并四舍五入到小数点后六位。\n\n不使用角度单位。没有物理单位。\n\n测试套件：\n对于每个案例，您将获得斑块数量$n$、斑块间距离矩阵$D = (d_{ij})$、基线灭绝向量$e = (e_1,\\dots,e_n)$、初始占据状态$x^{(0)}$、时间范围$T$、预算$B$、保护因子$r$以及核参数$\\alpha$和$\\beta$。对于距离矩阵，$d_{ii} = 0$对所有$i$成立，且$d_{ij} = d_{ji}  0$对$i \\neq j$成立。扩散核函数为$K_{ji} = \\exp(-\\alpha d_{ji})$，且$p_{ji} = 1 - \\exp(-\\beta K_{ji})$。\n\n- 案例A（四个斑块组成的线形图）：\n  - $n = 4$\n  - $D = \\begin{bmatrix} 0  1  2  3 \\\\ 1  0  1  2 \\\\ 2  1  0  1 \\\\ 3  2  1  0 \\end{bmatrix}$\n  - $e = [\\,0.20,\\,0.25,\\,0.25,\\,0.20\\,]$\n  - $x^{(0)} = [\\,0,\\,1,\\,0,\\,0\\,]$\n  - $T = 5$\n  - $B = 1$\n  - $r = 0.40$\n  - $\\alpha = 1.00$\n  - $\\beta = 0.90$\n\n- 案例B（单位间距的四个斑块组成的正方形）：\n  - $n = 4$\n  - $D = \\begin{bmatrix} 0  1  1.4142135624  1 \\\\ 1  0  1  1.4142135624 \\\\ 1.4142135624  1  0  1 \\\\ 1  1.4142135624  1  0 \\end{bmatrix}$\n  - $e = [\\,0.05,\\,0.06,\\,0.05,\\,0.06\\,]$\n  - $x^{(0)} = [\\,1,\\,0,\\,1,\\,0\\,]$\n  - $T = 10$\n  - $B = 2$\n  - $r = 0.50$\n  - $\\alpha = 0.70$\n  - $\\beta = 0.60$\n\n- 案例C（四个斑块组成的线形图上的无定殖边缘情况）：\n  - $n = 4$\n  - $D = \\begin{bmatrix} 0  1  2  3 \\\\ 1  0  1  2 \\\\ 2  1  0  1 \\\\ 3  2  1  0 \\end{bmatrix}$\n  - $e = [\\,0.15,\\,0.20,\\,0.18,\\,0.22\\,]$\n  - $x^{(0)} = [\\,1,\\,0,\\,0,\\,1\\,]$\n  - $T = 6$\n  - $B = 1$\n  - $r = 0.30$\n  - $\\alpha = 1.00$\n  - $\\beta = 0.00$\n\n- 案例D（五个斑块组成的星形几何结构：一个中心和四个叶节点）：\n  - $n = 5$\n  - $D$对应于坐标$[\\, (0,0),\\,(1,0),\\,(-1,0),\\,(0,1),\\,(0,-1) \\,]$，即中心-叶节点距离为$1$，相对叶节点距离为$2$，正交叶节点距离为$\\sqrt{2}$。数值上，\n    $D = \\begin{bmatrix}\n    0  1  1  1  1 \\\\\n    1  0  2  1.4142135624  1.4142135624 \\\\\n    1  2  0  1.4142135624  1.4142135624 \\\\\n    1  1.4142135624  1.4142135624  0  2 \\\\\n    1  1.4142135624  1.4142135624  2  0\n    \\end{bmatrix}$\n  - $e = [\\,0.25,\\,0.20,\\,0.20,\\,0.20,\\,0.20\\,]$\n  - $x^{(0)} = [\\,1,\\,0,\\,0,\\,0,\\,0\\,]$\n  - $T = 7$\n  - $B = 1$\n  - $r = 0.30$\n  - $\\alpha = 1.20$\n  - $\\beta = 0.80$\n\n您的程序必须生成单行输出，其中包含四个最大“到时间T的持续存在概率”，按A、B、C、D的顺序排列，四舍五入到小数点后六位，并以逗号分隔的列表形式封装在方括号中。例如，输出可能看起来像“[0.123456,0.234567,0.345678,0.456789]”，但应使用上述测试套件的正确值。", "solution": "提交分析的问题陈述经过了严格的验证过程。\n\n### 步骤1：提取的给定信息\n- **系统**：一个定义在具有$n$个斑块（节点）的图上的离散时间、随机、空间显式的异质种群模型。\n- **状态**：斑块$i$在时间$t$的状态是$X_i(t) \\in \\{0, 1\\}$。系统状态是$X(t) = (X_1(t), \\dots, X_n(t))$。\n- **灭绝**：一个被占据的斑块$i$以概率$e'_i$灭绝。如果斑块$i$在受保护集合$R$中，则$e'_i = r \\cdot e_i$；否则，$e'_i = e_i$。$r \\in (0,1)$是保护因子。\n- **定殖**：一个空的斑块$i$被一个被占据的供体斑块$j \\neq i$定殖的成功概率为$p_{ji} = 1 - \\exp(-\\beta K_{ji})$。扩散核函数是$K_{ji} = \\exp(-\\alpha d_{ji})$，其中$d_{ji}$是斑块间的距离，$\\alpha > 0$，$\\beta > 0$。禁止自我定殖（$K_{ii} = 0$）。斑块$i$的总定殖概率是$C_i(X(t)) = 1 - \\prod_{j: X_j(t)=1, j \\neq i} (1 - p_{ji})$。\n- **动态**：系统是一个在状态空间$\\{0,1\\}^n$上的时间齐次马尔可夫链。在给定状态$X(t)$的条件下，不同斑块的转变是条件独立的。\n- **目标**：给定一个初始状态$x^{(0)}$、一个时间范围$T$和一个预算$B$，选择一个保护集$R$（其中$|R| = B$），以最大化在时间$T$的持续存在概率。持续存在概率是$1 - \\pi_T(\\mathbf{0})$，其中$\\pi_T$是时间$T$的状态概率分布，$\\mathbf{0}$是全空状态。\n- **方法**：该问题将通过对所有有效的保护集$R$进行穷举搜索来解决。\n- **数据**：为四个测试案例提供了$n$、距离矩阵$D$、基线灭绝率$e$、初始状态$x^{(0)}$、时间范围$T$、预算$B$、保护因子$r$以及核参数$\\alpha, \\beta$的具体数值。\n\n### 步骤2：验证\n根据验证标准对问题进行评估：\n- **科学依据**：该模型是一个标准的随机斑块占据模型（SPOM），是生态学中异质种群理论的基石。其公式基于已建立的原则。该问题在科学上是合理的。\n- **适定性**：问题定义明确。它要求在一个有限的选择集合上最大化一个明确指定的目标函数。对于任何选择，系统的演化都由一个明确定义的有限状态马尔可夫链控制，保证了所产生的概率分布的存在性和唯一性。最大持续存在概率必然存在。\n- **客观性**：问题以精确的数学定义加以说明，没有歧义或主观性语言。\n- **完整性与一致性**：为每个测试案例提供了构建和解决模型所需的所有参数和条件。没有矛盾之处。\n- **可行性**：给定案例的状态空间（$n=4$和$n=5$）很小（分别为$2^4=16$和$2^5=32$个状态），使得马尔可夫链转移矩阵的构建和分析在计算上是可行的，符合要求。\n\n### 步骤3：结论\n问题是 **有效的**。将提供解决方案。\n\n### 求解推导\n该问题旨在为离散时间有限状态马尔可夫链寻找一个最优控制策略。控制动作是一次性选择一个永久性的受保护斑块集合。\n\n**状态空间**\n状态空间是$S = \\{0, 1\\}^n$，包含$N = 2^n$个可能的状态。我们可以使用二进制表示法在状态向量$x = (X_1, \\dots, X_n)$和整数索引$s \\in \\{0, 1, \\dots, N-1\\}$之间建立一个双射：$s = \\sum_{i=1}^{n} X_i 2^{i-1}$。在此映射下，全局灭绝状态$\\mathbf{0} = (0, \\dots, 0)$对应于索引$s=0$。\n\n**马尔可夫链转移矩阵**\n对于给定的保护集$R$，系统的演化由一个$N \\times N$的转移矩阵$P_R$控制。条目$P_R(x, y)$表示在一个时间步内从状态$x$转移到状态$y$的概率。由于斑块动态条件独立的假设，这个概率是单斑块转移概率的乘积：\n$$ P_R(x \\rightarrow y) = \\prod_{i=1}^{n} \\text{Pr}(X_i(t+1)=y_i | X(t)=x, R) $$\n单斑块转移概率$\\text{Pr}(X_i(t+1)=y_i | X(t)=x, R)$的确定如下：\n1.  **如果斑块$i$被占据 ($x_i=1$)**：该斑块以概率$(1 - e'_i)$保持占据状态（$y_i=1$），并以概率$e'_i$变为空（$y_i=0$）。有效灭绝率是$e'_i = r \\cdot e_i$ for $i \\in R$ and $e'_i = e_i$ for $i \\notin R$。\n2.  **如果斑块$i$为空 ($x_i=0$)**：该斑块通过定殖以概率$C_i(x)$变为占据状态（$y_i=1$）。它以概率$(1 - C_i(x))$保持为空（$y_i=0$）。\n\n空斑块$i$的定殖概率$C_i(x)$由任何被占据的供体斑块$j$均未能定殖的互补概率给出：\n$$ C_i(x) = 1 - \\prod_{j: x_j=1} (1 - p_{ji}) $$\n其中$p_{ji} = 1 - \\exp(-\\beta K_{ji})$且$K_{ji} = \\exp(-\\alpha d_{ji})$。注意，由于规定$K_{ii}=0$，乘积可以对所有$x_j=1$的$j$进行。此表达式更可靠的计算方式为：\n$$ C_i(x) = 1 - \\exp\\left(-\\beta \\sum_{j: x_j=1} K_{ji}\\right) $$\n项$\\sum_{j: x_j=1} K_{ji}$表示在状态$x$下所有被占据斑块对斑块$i$的总定殖压力。\n\n**优化算法**\n目标是最大化在时间$T$的持续存在概率，$J(R) = 1 - \\pi_T(\\mathbf{0})$，其中$\\pi_T$是在时间$T$的概率分布向量。\n初始分布$\\pi_0$是一个长度为$N=2^n$的向量，在对应于初始状态$x^{(0)}$的索引处为1，其他位置为0。分布通过关系$\\pi_{t+1} = \\pi_t P_R$演化$T$步。这等价于计算$\\pi_T = \\pi_0 (P_R)^T$。\n优化通过穷举搜索进行：\n1.  生成所有大小为$|R|=B$的可能保护集$R \\subseteq \\{1, \\dots, n\\}$。这构成了$\\binom{n}{B}$种组合。\n2.  对于每个候选集$R$：\n    a. 根据上述规则构建$2^n \\times 2^n$的转移矩阵$P_R$。\n    b. 根据$x^{(0)}$初始化概率分布向量$\\pi_0$。\n    c. 通过迭代$\\pi_{t+1} = \\pi_t P_R$共$T$步来计算时间$T$的分布。\n    d. 计算持续存在概率$J(R) = 1 - \\pi_T(0)$，其中$\\pi_T(0)$是索引为$s=0$的状态的概率。\n3.  解是所有候选集中找到的$J(R)$的最大值。此过程在模型假设下得出精确的最优值。", "answer": "```python\nimport numpy as np\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Solves the metapopulation persistence optimization problem for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        # Case A\n        {\n            \"n\": 4,\n            \"D\": np.array([\n                [0, 1, 2, 3],\n                [1, 0, 1, 2],\n                [2, 1, 0, 1],\n                [3, 2, 1, 0]\n            ], dtype=float),\n            \"e\": np.array([0.20, 0.25, 0.25, 0.20]),\n            \"x0\": np.array([0, 1, 0, 0]),\n            \"T\": 5, \"B\": 1, \"r\": 0.40, \"alpha\": 1.00, \"beta\": 0.90\n        },\n        # Case B\n        {\n            \"n\": 4,\n            \"D\": np.array([\n                [0, 1, 1.4142135624, 1],\n                [1, 0, 1, 1.4142135624],\n                [1.4142135624, 1, 0, 1],\n                [1, 1.4142135624, 1, 0]\n            ], dtype=float),\n            \"e\": np.array([0.05, 0.06, 0.05, 0.06]),\n            \"x0\": np.array([1, 0, 1, 0]),\n            \"T\": 10, \"B\": 2, \"r\": 0.50, \"alpha\": 0.70, \"beta\": 0.60\n        },\n        # Case C\n        {\n            \"n\": 4,\n            \"D\": np.array([\n                [0, 1, 2, 3],\n                [1, 0, 1, 2],\n                [2, 1, 0, 1],\n                [3, 2, 1, 0]\n            ], dtype=float),\n            \"e\": np.array([0.15, 0.20, 0.18, 0.22]),\n            \"x0\": np.array([1, 0, 0, 1]),\n            \"T\": 6, \"B\": 1, \"r\": 0.30, \"alpha\": 1.00, \"beta\": 0.00\n        },\n        # Case D\n        {\n            \"n\": 5,\n            \"D\": np.array([\n                [0, 1, 1, 1, 1],\n                [1, 0, 2, 1.4142135624, 1.4142135624],\n                [1, 2, 0, 1.4142135624, 1.4142135624],\n                [1, 1.4142135624, 1.4142135624, 0, 2],\n                [1, 1.4142135624, 1.4142135624, 2, 0]\n            ], dtype=float),\n            \"e\": np.array([0.25, 0.20, 0.20, 0.20, 0.20]),\n            \"x0\": np.array([1, 0, 0, 0, 0]),\n            \"T\": 7, \"B\": 1, \"r\": 0.30, \"alpha\": 1.20, \"beta\": 0.80\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        n, D, e, x0, T, B = case[\"n\"], case[\"D\"], case[\"e\"], case[\"x0\"], case[\"T\"], case[\"B\"]\n        r, alpha, beta = case[\"r\"], case[\"alpha\"], case[\"beta\"]\n\n        patch_indices = range(n)\n        possible_protections = combinations(patch_indices, B)\n        \n        K_matrix = np.exp(-alpha * D)\n        np.fill_diagonal(K_matrix, 0)\n        \n        num_states = 2**n\n        \n        # Pre-calculate state vectors\n        state_vectors = []\n        for s in range(num_states):\n            state_vectors.append(np.array([(s >> i)  1 for i in range(n)]))\n\n        max_persistence_prob = 0.0\n\n        for R in possible_protections:\n            # 1. Determine effective extinction rates for this protection set R\n            e_prime = e.copy()\n            for protected_idx in R:\n                e_prime[protected_idx] *= r\n\n            # 2. Build the transition matrix P_R\n            P_matrix = np.zeros((num_states, num_states))\n            for s_from in range(num_states):\n                x = state_vectors[s_from]\n                \n                # Colonization probabilities for empty patches\n                # Colonization pressure on patch i is sum_j K_ij*x_j\n                # As K is symmetric, this is sum_j K_ji*x_j\n                colonization_pressure = K_matrix @ x\n                C_i_of_x = 1 - np.exp(-beta * colonization_pressure)\n                \n                for s_to in range(num_states):\n                    y = state_vectors[s_to]\n                    \n                    prob_x_to_y = 1.0\n                    for i in range(n):\n                        if x[i] == 1:\n                            prob_i = (1 - e_prime[i]) if y[i] == 1 else e_prime[i]\n                        else:  # x[i] == 0\n                            prob_i = C_i_of_x[i] if y[i] == 1 else (1 - C_i_of_x[i])\n                        prob_x_to_y *= prob_i\n                    \n                    P_matrix[s_from, s_to] = prob_x_to_y\n            \n            # 3. Evolve the distribution starting from x0\n            s0_idx = sum(val * (1  i) for i, val in enumerate(x0))\n            \n            pi = np.zeros(num_states)\n            pi[s0_idx] = 1.0\n            \n            for _ in range(T):\n                pi = pi @ P_matrix\n                \n            # 4. Calculate persistence probability\n            persistence_prob = 1.0 - pi[0]  # State 0 is global extinction\n            if persistence_prob > max_persistence_prob:\n                max_persistence_prob = persistence_prob\n        \n        results.append(f\"{max_persistence_prob:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2534612"}]}