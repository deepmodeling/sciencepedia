{"hands_on_practices": [{"introduction": "现实世界中的地表并不是在所有方向上都均匀地反射阳光，即它们不是理想的朗伯体。本练习旨在介绍“双向反射分布函数”（Bidirectional Reflectance Distribution Function, BRDF）这一核心概念，它用于模拟这种具有方向性的反射行为。通过这项动手实践[@problem_id:2527964]，你将学习如何利用多角度观测数据来拟合一个BRDF模型，并量化由特定观测几何引起的“各向异性偏差”，这对于校正和比较不同时间或不同传感器获取的遥感影像至关重要。", "problem": "为您提供一个用于双向反射分布函数 (BRDF) 的线性、核驱动模型，该模型将方向性表面反射率表示为已知基函数（核）的线性组合。该模型为\n$$\nR(\\theta_{i},\\theta_{v},\\phi) \\;=\\; f_{\\text{iso}} \\;+\\; f_{\\text{vol}}\\,K_{\\text{vol}}(\\theta_{i},\\theta_{v},\\phi) \\;+\\; f_{\\text{geo}}\\,K_{\\text{geo}}(\\theta_{i},\\theta_{v},\\phi),\n$$\n其中，$R$ 是方向反射率（无量纲），$f_{\\text{iso}}$ 是各向同性（朗伯）项，$f_{\\text{vol}}$ 乘以体散射核 $K_{\\text{vol}}$，$f_{\\text{geo}}$ 乘以几何光学核 $K_{\\text{geo}}$。核 $K_{\\text{vol}}$ 和 $K_{\\text{geo}}$ 被假定为关于光照天顶角 $\\theta_{i}$、观测天顶角 $\\theta_{v}$ 和相对方位角 $\\phi$ 的已知固定函数。在此问题中，您将把核值视为给定的数值输入，而不会根据角度计算它们。\n\n基本原理：\n- 上述反射率模型对于系数 $\\{f_{\\text{iso}}, f_{\\text{vol}}, f_{\\text{geo}}\\}$ 是线性的。\n- 给定 $N$ 个观测值 $\\{(R_n, K_{\\text{vol},n}, K_{\\text{geo},n})\\}_{n=1}^{N}$，最小二乘估计通过最小化残差平方和来实现\n$$\n\\min_{\\boldsymbol{f}} \\sum_{n=1}^{N} \\left(R_n - \\left[f_{\\text{iso}} + f_{\\text{vol}} K_{\\text{vol},n} + f_{\\text{geo}} K_{\\text{geo},n}\\right]\\right)^2,\n$$\n这可以通过基本线性代数推导出的正规方程来求解。\n\n您的任务：\n1. 使用提供的多角度观测值（每个观测值包含反射率和核值），通过普通最小二乘法估计参数矢量 $\\boldsymbol{f} = [f_{\\text{iso}}, f_{\\text{vol}}, f_{\\text{geo}}]^{\\top}$。\n2. 通过将建模的单视角反射率与各向同性项进行比较，评估在指定的单视角核配置下，单视角反射率的各向异性偏差。将在核为 $(K_{\\text{vol}}, K_{\\text{geo}})$ 的单个视角下的各向异性偏差定义为\n$$\nb \\;=\\; \\widehat{R} - \\widehat{f}_{\\text{iso}} \\;=\\; \\widehat{f}_{\\text{vol}}\\,K_{\\text{vol}} + \\widehat{f}_{\\text{geo}}\\,K_{\\text{geo}},\n$$\n其中帽子符号表示最小二乘估计值。将 $b$ 作为无量纲浮点数报告。\n\n用于最小二乘拟合的数据（多角度观测）：\n- 共有 $N = 6$ 个观测值。对于每个观测值 $n \\in \\{1,2,3,4,5,6\\}$，给定元组 $(K_{\\text{vol},n}, K_{\\text{geo},n}, R_n)$：\n    - 观测值 $1$：$(K_{\\text{vol},1}, K_{\\text{geo},1}, R_1) = (\\,0.050\\,,\\,0.010\\,,\\,0.1213\\,)$\n    - 观测值 $2$：$(K_{\\text{vol},2}, K_{\\text{geo},2}, R_2) = (\\,0.120\\,,\\,-0.020\\,,\\,0.1240\\,)$\n    - 观测值 $3$：$(K_{\\text{vol},3}, K_{\\text{geo},3}, R_3) = (\\,-0.030\\,,\\,0.040\\,,\\,0.1183\\,)$\n    - 观测值 $4$：$(K_{\\text{vol},4}, K_{\\text{geo},4}, R_4) = (\\,0.200\\,,\\,-0.050\\,,\\,0.1270\\,)$\n    - 观测值 $5$：$(K_{\\text{vol},5}, K_{\\text{geo},5}, R_5) = (\\,0.000\\,,\\,0.000\\,,\\,0.1200\\,)$\n    - 观测值 $6$：$(K_{\\text{vol},6}, K_{\\text{geo},6}, R_6) = (\\,0.080\\,,\\,-0.010\\,,\\,0.1226\\,)$\n\n用于各向异性偏差评估的测试套件（单视角案例）：\n- 案例 $A$：$(K_{\\text{vol}}, K_{\\text{geo}}) = (\\,0.050\\,,\\,0.010\\,)$\n- 案例 $B$：$(K_{\\text{vol}}, K_{\\text{geo}}) = (\\,0.000\\,,\\,0.000\\,)$\n- 案例 $C$：$(K_{\\text{vol}}, K_{\\text{geo}}) = (\\,0.250\\,,\\,-0.080\\,)$\n\n要求：\n- 根据 $N$ 个观测值计算最小二乘估计值 $\\widehat{\\boldsymbol{f}} = [\\widehat{f}_{\\text{iso}}, \\widehat{f}_{\\text{vol}}, \\widehat{f}_{\\text{geo}}]^{\\top}$。\n- 使用 $\\widehat{\\boldsymbol{f}}$，按上述定义计算每个单视角案例 A、B 和 C 的各向异性偏差 $b$。\n- 所有反射率和偏差均为无量纲；无需进行物理单位转换。\n\n最终输出规格：\n- 您的程序应生成一行输出，其中包含一个由方括号括起来的逗号分隔列表，列表内按此顺序精确包含 $6$ 个浮点数：\n$$\n\\left[\\widehat{f}_{\\text{iso}},\\ \\widehat{f}_{\\text{vol}},\\ \\widehat{f}_{\\text{geo}},\\ b_A,\\ b_B,\\ b_C\\right].\n$$\n- 每个值必须精确四舍五入到 $6$ 位小数。\n- 输出必须为单行，例如：\"[0.123456,0.012345,-0.001234,0.000111,0.000000,0.009999]\"。", "solution": "问题陈述已经过分析并被确定为有效。它在科学上基于遥感中的辐射传输建模原理，在数学上是适定的，并且具有客观、明确的数据和指令。它代表了一个标准的线性模型反演任务，这是地球物理数据分析的基础。我们将继续进行求解。\n\n所提供的双向反射分布函数 (BRDF) 模型相对于参数 $\\boldsymbol{f} = [f_{\\text{iso}}, f_{\\text{vol}}, f_{\\text{geo}}]^{\\top}$ 是线性的。对于一组 $N$ 个观测值，该模型可以表示为矩阵形式：\n$$\n\\boldsymbol{R} = \\boldsymbol{K}\\boldsymbol{f} + \\boldsymbol{\\epsilon}\n$$\n其中 $\\boldsymbol{R}$ 是观测反射率的 $N \\times 1$ 矢量，$\\boldsymbol{K}$ 是包含核值的 $N \\times 3$ 设计矩阵，$\\boldsymbol{f}$ 是待估计参数的 $3 \\times 1$ 矢量，$\\boldsymbol{\\epsilon}$ 是残差矢量。\n\n第一个任务是找到普通最小二乘 (OLS) 估计值 $\\widehat{\\boldsymbol{f}}$，它使残差平方和 $\\boldsymbol{\\epsilon}^{\\top}\\boldsymbol{\\epsilon}$ 最小化。解由正规方程给出：\n$$\n(\\boldsymbol{K}^{\\top}\\boldsymbol{K})\\widehat{\\boldsymbol{f}} = \\boldsymbol{K}^{\\top}\\boldsymbol{R}\n$$\n假设矩阵 $\\boldsymbol{K}^{\\top}\\boldsymbol{K}$ 是可逆的（如果 $\\boldsymbol{K}$ 的列是线性无关的，则该假设成立），那么估计参数的唯一解为：\n$$\n\\widehat{\\boldsymbol{f}} = (\\boldsymbol{K}^{\\top}\\boldsymbol{K})^{-1}\\boldsymbol{K}^{\\top}\\boldsymbol{R}\n$$\n\n根据问题中提供的 $N=6$ 个观测值，我们构造设计矩阵 $\\boldsymbol{K}$ 和反射率矢量 $\\boldsymbol{R}$。每个观测值 $n$ 的模型是 $R_n = f_{\\text{iso}} \\cdot 1 + f_{\\text{vol}} \\cdot K_{\\text{vol},n} + f_{\\text{geo}} \\cdot K_{\\text{geo},n}$。因此，$\\boldsymbol{K}$ 的列分别是一个全为 1 的列、一个由 $K_{\\text{vol},n}$ 值组成的矢量，以及一个由 $K_{\\text{geo},n}$ 值组成的矢量。\n\n设计矩阵 $\\boldsymbol{K}$ 为：\n$$\n\\boldsymbol{K} = \\begin{pmatrix}\n1  0.050  0.010 \\\\\n1  0.120  -0.020 \\\\\n1  -0.030  0.040 \\\\\n1  0.200  -0.050 \\\\\n1  0.000  0.000 \\\\\n1  0.080  -0.010\n\\end{pmatrix}\n$$\n观测矢量 $\\boldsymbol{R}$ 为：\n$$\n\\boldsymbol{R} = \\begin{pmatrix}\n0.1213 \\\\ 0.1240 \\\\ 0.1183 \\\\ 0.1270 \\\\ 0.1200 \\\\ 0.1226\n\\end{pmatrix}\n$$\n\n我们计算正规方程所需的矩阵。首先，$\\boldsymbol{K}^{\\top}\\boldsymbol{K}$：\n$$\n\\boldsymbol{K}^{\\top}\\boldsymbol{K} = \\begin{pmatrix}\n6  0.42  -0.03 \\\\\n0.42  0.0642  -0.0139 \\\\\n-0.03  -0.0139  0.0047\n\\end{pmatrix}\n$$\n接下来，我们计算 $\\boldsymbol{K}^{\\top}\\boldsymbol{R}$：\n$$\n\\boldsymbol{K}^{\\top}\\boldsymbol{R} = \\begin{pmatrix}\n0.7332 \\\\\n0.052604 \\\\\n-0.004111\n\\end{pmatrix}\n$$\n求解线性方程组 $(\\boldsymbol{K}^{\\top}\\boldsymbol{K})\\widehat{\\boldsymbol{f}} = \\boldsymbol{K}^{\\top}\\boldsymbol{R}$ 可得估计参数矢量 $\\widehat{\\boldsymbol{f}}$：\n$$\n\\widehat{\\boldsymbol{f}} = \\begin{pmatrix} \\widehat{f}_{\\text{iso}} \\\\ \\widehat{f}_{\\text{vol}} \\\\ \\widehat{f}_{\\text{geo}} \\end{pmatrix} = \\begin{pmatrix} 0.12003058... \\\\ 0.05011743... \\\\ -0.01980074... \\end{pmatrix}\n$$\n观测值 5 的核值为 $(K_{\\text{vol},5}, K_{\\text{geo},5}) = (0.000, 0.000)$，测得的反射率为 $R_5 = 0.1200$。在这种情况下，模型得出 $R_5 = f_{\\text{iso}}$。估计值 $\\widehat{f}_{\\text{iso}} \\approx 0.120031$ 与该测量值极为接近，这为解提供了一致性检验。\n\n第二个任务是计算三个指定案例的各向异性偏差 $b$。偏差定义为 $b = \\widehat{f}_{\\text{vol}}\\,K_{\\text{vol}} + \\widehat{f}_{\\text{geo}}\\,K_{\\text{geo}}$。使用估计的参数 $\\widehat{f}_{\\text{vol}}$ 和 $\\widehat{f}_{\\text{geo}}$，我们计算每个案例的偏差。\n\n案例 A：$(K_{\\text{vol}}, K_{\\text{geo}}) = (0.050, 0.010)$\n$$\nb_A = (0.05011743...)(0.050) + (-0.01980074...)(0.010) = 0.00250587... - 0.00019801... = 0.00230786...\n$$\n\n案例 B：$(K_{\\text{vol}}, K_{\\text{geo}}) = (0.000, 0.000)$\n$$\nb_B = (0.05011743...)(0.000) + (-0.01980074...)(0.000) = 0.0\n$$\n这个结果是显而易见的，因为对于两个核都为零的观测几何（通常是天底观测、天底太阳），反射率等于各向同性项，因此根据定义，各向异性偏差必须为零。\n\n案例 C：$(K_{\\text{vol}}, K_{\\text{geo}}) = (0.250, -0.080)$\n$$\nb_C = (0.05011743...)(0.250) + (-0.01980074...)(-0.080) = 0.01252936... + 0.00158406... = 0.01411342...\n$$\n\n最终结果，按要求四舍五入到 6 位小数，为：\n$\\widehat{f}_{\\text{iso}} = 0.120031$\n$\\widehat{f}_{\\text{vol}} = 0.050117$\n$\\widehat{f}_{\\text{geo}} = -0.019801$\n$b_A = 0.002308$\n$b_B = 0.000000$\n$b_C = 0.014113$", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for BRDF model parameters and anisotropy bias using ordinary least squares.\n    \"\"\"\n    # Define the multi-angle observation data from the problem statement.\n    # Each tuple is (K_vol, K_geo, R).\n    observations = [\n        (0.050, 0.010, 0.1213),\n        (0.120, -0.020, 0.1240),\n        (-0.030, 0.040, 0.1183),\n        (0.200, -0.050, 0.1270),\n        (0.000, 0.000, 0.1200),\n        (0.080, -0.010, 0.1226)\n    ]\n\n    # The linear model is R = f_iso * 1 + f_vol * K_vol + f_geo * K_geo.\n    # Construct the design matrix K and the observation vector R.\n    # The first column of K is 1, for the f_iso (intercept) term.\n    K = np.array([[1, obs[0], obs[1]] for obs in observations])\n    R = np.array([obs[2] for obs in observations])\n\n    # The least squares solution f_hat minimizes ||R - K*f_hat||^2.\n    # It is found by solving the normal equations: (K.T @ K) @ f_hat = K.T @ R.\n    # Using numpy.linalg.solve is numerically stable and efficient.\n    try:\n        KTK = K.T @ K\n        KTR = K.T @ R\n        f_hat = np.linalg.solve(KTK, KTR)\n    except np.linalg.LinAlgError:\n        # This case is unlikely for a well-posed problem, but included for robustness.\n        # This occurs if K.T @ K is singular, implying linearly dependent columns in K.\n        # If it occurs, return zeros as an error indicator.\n        results = [0.0] * 6\n        print(f\"[{','.join(f'{x:.6f}' for x in results)}]\")\n        return\n\n    f_iso, f_vol, f_geo = f_hat[0], f_hat[1], f_hat[2]\n\n    # Define the single-view kernel configurations for anisotropy bias assessment.\n    # Each tuple is (K_vol, K_geo).\n    bias_cases = {\n        'A': (0.050, 0.010),\n        'B': (0.000, 0.000),\n        'C': (0.250, -0.080),\n    }\n\n    # Calculate anisotropy bias b = f_vol * K_vol + f_geo * K_geo for each case.\n    b_A = f_vol * bias_cases['A'][0] + f_geo * bias_cases['A'][1]\n    b_B = f_vol * bias_cases['B'][0] + f_geo * bias_cases['B'][1]\n    b_C = f_vol * bias_cases['C'][0] + f_geo * bias_cases['C'][1]\n\n    # Assemble the final results in the specified order.\n    # [f_iso, f_vol, f_geo, b_A, b_B, b_C]\n    final_results = [f_iso, f_vol, f_geo, b_A, b_B, b_C]\n\n    # Format the output string according to the problem specification:\n    # A comma-separated list in brackets, with each value rounded to 6 decimal places.\n    output_str = ','.join([f'{value:.6f}' for value in final_results])\n    \n    # The final print statement must produce only the required output.\n    print(f\"[{output_str}]\")\n\n# Execute the solver function.\nsolve()\n```", "id": "2527964"}, {"introduction": "本节练习将理论知识应用于一个完整的生态遥感分析流程。我们将模拟一项真实的研究任务：利用灾前和灾后的多光谱影像绘制森林火灾的燃烧严重程度等级图。这项综合性练习[@problem_id:2527969]将引导你完成几个关键步骤，包括校正地形起伏对光照条件的影响，计算对植被和土壤变化敏感的光谱指数，并最终使用野外实测数据对你的遥感产品进行验证。", "problem": "您将获得代表火前和火后多光谱反射率的小型合成栅格瓦片，以及地形坡度、坡向和太阳几何参数。您的任务是实现一个物理上一致的算法，对反射率波段执行地形光照校正，计算源自归一化差异指数变化的火烧严重度度量，并通过校准和留出法评估，与实地综合火烧指数（CBI）样地测量值进行验证。\n\n此问题的基本原理如下。\n\n- 在朗伯表面假设下，倾斜面上的入射辐照度与局部太阳入射角的余弦成正比。如果太阳天顶角表示为$\\theta_{z}$，地形坡度为$\\alpha$，坡向为$\\gamma$，太阳方位角为$\\phi_{s}$，则入射角的余弦由下式给出\n$$\n\\cos i \\;=\\; \\cos \\alpha \\,\\cos \\theta_{z} \\;+\\; \\sin \\alpha \\,\\sin \\theta_{z} \\,\\cos(\\phi_{s}-\\gamma).\n$$\n在计算中，所有角度都必须以弧度处理。太阳天顶角与太阳高度角$\\varepsilon_{s}$的关系为$\\theta_{z} = \\pi/2 - \\varepsilon_{s}$。$\\cos i \\le 0$的像素处于太阳的自阴影中，必须从进一步的分析中排除。\n\n- 对于朗伯表面，一个简单的余弦地形校正通过以下公式将观测到的反射率$R_{\\text{obs}}$缩放为地形归一化的反射率$R_{\\text{corr}}$\n$$\nR_{\\text{corr}} \\;=\\; R_{\\text{obs}} \\cdot \\frac{\\cos \\theta_{z}}{\\cos i},\n$$\n该公式仅在$\\cos i > 0$时应用；在其他情况下，该像素的反射率应被视为无效。\n\n- 近红外波段$R_{N}$和短波红外波段$R_{S}$之间的双波段归一化差异指数定义为\n$$\nI \\;=\\; \\frac{R_{N} - R_{S}}{R_{N} + R_{S}},\n$$\n仅在分母不为零时计算。\n\n- 时序间指数变化为$\\Delta I = I_{\\text{pre}} - I_{\\text{post}}$。通过事件前的量级对变化进行归一化的相对差分指数由下式获得\n$$\nI_{R} \\;=\\; \\frac{\\Delta I}{\\sqrt{\\lvert I_{\\text{pre}} \\rvert + \\epsilon}},\n$$\n其中有一个小的稳定因子$\\epsilon = 10^{-6}$以避免除以零。在此任务中，$I$是根据地形校正后的近红外和短波红外反射率计算的，而$I_{R}$是待与综合火烧指数（CBI）验证的火烧严重度度量。\n\n- 为了用CBI验证$I_{R}$，在一个样地位置的校准子集上拟合一个线性模型，\n$$\n\\widehat{\\mathrm{CBI}} \\;=\\; a \\, I_{R} \\;+\\; b,\n$$\n通过普通最小二乘法，并在一个验证子集上报告留出法均方根误差（RMSE），\n$$\n\\mathrm{RMSE} \\;=\\; \\sqrt{\\frac{1}{n}\\sum_{k=1}^{n} \\left(\\mathrm{CBI}_{k} - \\widehat{\\mathrm{CBI}}_{k}\\right)^{2}}.\n$$\n\n角度单位和反射率单位。\n\n- 所有输入角度均以度为单位提供。您的实现必须将其转换为弧度以进行三角函数计算。任何中间推导所需的角度单位都是弧度。太阳高度角和方位角遵循常见的遥感惯例：方位角从地理北方向顺时针测量，坡向从北方向顺时针测量，坡度是与水平面的倾斜度。\n- 反射率值是$[0,1]$范围内的无单位分数。\n\n数值要求和掩膜。\n\n- 对火前和火后影像中的近红外和短波红外波段独立进行地形校正。\n- 任何$\\cos i \\le 0$的像素，或在归一化差异计算中分母为零的像素，都必须被视为无效；在样地提取中不包括无效像素。\n- 在相对差分指数归一化中使用$\\epsilon = 10^{-6}$。\n\n测试套件。\n\n实现您的程序以处理以下三个案例。每个案例提供用于火前和火后近红外（NIR）和短波红外（SWIR）反射率的$3 \\times 3$数组、地形坡度和坡向、标量的太阳高度角和方位角、作为从零开始的行-列对的样地位置列表、相应的CBI值列表，以及划分为校准和验证子集。\n\n案例A。\n\n- 火前近红外反射率$R_{N,\\text{pre}}$:\n$$\n\\begin{bmatrix}\n0.45  0.42  0.40 \\\\\n0.43  0.41  0.44 \\\\\n0.46  0.40  0.42\n\\end{bmatrix}\n$$\n- 火前短波红外反射率$R_{S,\\text{pre}}$:\n$$\n\\begin{bmatrix}\n0.14  0.15  0.16 \\\\\n0.13  0.17  0.15 \\\\\n0.14  0.16  0.13\n\\end{bmatrix}\n$$\n- 火后近红外反射率$R_{N,\\text{post}}$:\n$$\n\\begin{bmatrix}\n0.30  0.28  0.26 \\\\\n0.27  0.29  0.25 \\\\\n0.28  0.26  0.24\n\\end{bmatrix}\n$$\n- 火后短波红外反射率$R_{S,\\text{post}}$:\n$$\n\\begin{bmatrix}\n0.22  0.24  0.23 \\\\\n0.25  0.22  0.24 \\\\\n0.26  0.23  0.25\n\\end{bmatrix}\n$$\n- 坡度（单位：度）$\\alpha$:\n$$\n\\begin{bmatrix}\n15  20  10 \\\\\n25  15  30 \\\\\n12  18  22\n\\end{bmatrix}\n$$\n- 坡向（单位：度）$\\gamma$:\n$$\n\\begin{bmatrix}\n90  120  150 \\\\\n135  180  210 \\\\\n60  75  105\n\\end{bmatrix}\n$$\n- 太阳高度角（单位：度）$\\varepsilon_{s} = 45$，太阳方位角（单位：度）$\\phi_{s} = 135$。\n- 样地位置（从零开始的索引）：$\\{(0,0), (0,2), (1,1), (1,2), (2,0), (2,2)\\}$，CBI值为$\\{0.90, 0.80, 1.10, 1.20, 0.85, 1.00\\}$。\n- 校准子集位置：$\\{(0,0), (0,2), (1,1), (2,2)\\}$。验证子集位置：$\\{(1,2), (2,0)\\}$。\n\n案例B。\n\n- 火前近红外反射率$R_{N,\\text{pre}}$:\n$$\n\\begin{bmatrix}\n0.50  0.48  0.47 \\\\\n0.49  0.51  0.50 \\\\\n0.48  0.47  0.49\n\\end{bmatrix}\n$$\n- 火前短波红外反射率$R_{S,\\text{pre}}$:\n$$\n\\begin{bmatrix\n0.12  0.13  0.12 \\\\\n0.14  0.12  0.13 \\\\\n0.15  0.13  0.14\n\\end{bmatrix}\n$$\n- 火后近红外反射率$R_{N,\\text{post}}$:\n$$\n\\begin{bmatrix\n0.46  0.45  0.44 \\\\\n0.45  0.47  0.46 \\\\\n0.46  0.44  0.45\n\\end{bmatrix}\n$$\n- 火后短波红外反射率$R_{S,\\text{post}}$:\n$$\n\\begin{bmatrix\n0.13  0.14  0.13 \\\\\n0.15  0.13  0.14 \\\\\n0.16  0.14  0.15\n\\end{bmatrix}\n$$\n- 坡度（单位：度）$\\alpha$:\n$$\n\\begin{bmatrix}\n0  0  0 \\\\\n0  0  0 \\\\\n0  0  0\n\\end{bmatrix}\n$$\n- 坡向（单位：度）$\\gamma$:\n$$\n\\begin{bmatrix}\n0  0  0 \\\\\n0  0  0 \\\\\n0  0  0\n\\end{bmatrix}\n$$\n- 太阳高度角（单位：度）$\\varepsilon_{s} = 60$，太阳方位角（单位：度）$\\phi_{s} = 150$。\n- 样地位置：$\\{(0,0), (0,1), (1,0), (1,2), (2,1), (2,2)\\}$，CBI值为$\\{0.35, 0.40, 0.38, 0.45, 0.42, 0.50\\}$。\n- 校准子集位置：$\\{(0,0), (0,1), (1,0), (2,1)\\}$。验证子集位置：$\\{(1,2), (2,2)\\}$。\n\n案例C。\n\n- 火前近红外反射率$R_{N,\\text{pre}}$:\n$$\n\\begin{bmatrix}\n0.43  0.42  0.20 \\\\\n0.44  0.46  0.21 \\\\\n0.45  0.47  0.22\n\\end{bmatrix}\n$$\n- 火前短波红外反射率$R_{S,\\text{pre}}$:\n$$\n\\begin{bmatrix}\n0.18  0.19  0.20 \\\\\n0.17  0.18  0.21 \\\\\n0.19  0.20  0.22\n\\end{bmatrix}\n$$\n- 火后近红外反射率$R_{N,\\text{post}}$:\n$$\n\\begin{bmatrix}\n0.25  0.24  0.18 \\\\\n0.26  0.27  0.19 \\\\\n0.24  0.26  0.20\n\\end{bmatrix}\n$$\n- 火后短波红外反射率$R_{S,\\text{post}}$:\n$$\n\\begin{bmatrix\n0.28  0.30  0.22 \\\\\n0.29  0.27  0.23 \\\\\n0.30  0.28  0.24\n\\end{bmatrix}\n$$\n- 坡度（单位：度）$\\alpha$:\n$$\n\\begin{bmatrix\n50  60  70 \\\\\n65  75  80 \\\\\n55  45  70\n\\end{bmatrix}\n$$\n- 坡向（单位：度）$\\gamma$:\n$$\n\\begin{bmatrix\n200  220  180 \\\\\n200  160  140 \\\\\n220  200  110\n\\end{bmatrix}\n$$\n- 太阳高度角（单位：度）$\\varepsilon_{s} = 30$，太阳方位角（单位：度）$\\phi_{s} = 200$。\n- 样地位置：$\\{(0,0), (0,1), (1,0), (1,1), (2,1), (2,2)\\}$，CBI值为$\\{2.20, 2.00, 2.40, 1.80, 2.10, 1.60\\}$。\n- 校准子集位置：$\\{(0,0), (0,1), (1,0), (1,1)\\}$。验证子集位置：$\\{(2,1), (2,2)\\}$。\n\n程序要求。\n\n- 按照描述实现朗伯余弦地形校正，在三角函数计算中使用弧度。排除$\\cos i \\le 0$的像素。\n- 根据校正后的火前和火后影像波段计算归一化差异指数。使用$\\epsilon = 10^{-6}$计算时序间变化和相对差分度量$I_{R}$。\n- 对于每个案例，在指定的样地位置提取$I_{R}$值，通过最小二乘法在校准子集上拟合线性模型，并在验证子集上计算RMSE。\n- 您的程序应生成单行输出，其中包含案例A、B和C各自的RMSE值，每个值四舍五入到小数点后四位，形式为用方括号括起来的逗号分隔列表（例如，$\\left[\\mathrm{r}_{A},\\mathrm{r}_{B},\\mathrm{r}_{C}\\right]$）。\n\n最终输出必须严格遵循以下格式：单行，一个包含三个浮点数的列表，用方括号括起来，此外无任何其他内容。", "solution": "该问题陈述经过了严格验证，被确定为科学上合理、提法明确、客观且自成体系。它描述了定量遥感在生态应用中的一个标准工作流程，特别是火烧严重度评估。其物理原理、数学公式和数据处理步骤均基于已确立的方法。所提供的数据对于完成该任务是完整和一致的。因此，有必要提供一个解法。\n\n解法系统地分为几个阶段：地形建模、辐射校正、光谱指数计算和统计验证。每个阶段都应用于每个测试案例提供的栅格数据。\n\n**1. 初步设置和角度转换**\n\n初始步骤是为计算准备几何参数。所有以度为单位提供的角度都必须转换为弧度，因为计算库中的三角函数对弧度进行操作。设$\\alpha_{\\text{deg}}$、$\\gamma_{\\text{deg}}$、$\\varepsilon_{s, \\text{deg}}$和$\\phi_{s, \\text{deg}}$为输入的坡度、坡向、太阳高度角和太阳方位角（单位：度）。转换公式为：\n$$ \\alpha = \\alpha_{\\text{deg}} \\cdot \\frac{\\pi}{180}, \\quad \\gamma = \\gamma_{\\text{deg}} \\cdot \\frac{\\pi}{180}, \\quad \\varepsilon_{s} = \\varepsilon_{s, \\text{deg}} \\cdot \\frac{\\pi}{180}, \\quad \\phi_{s} = \\phi_{s, \\text{deg}} \\cdot \\frac{\\pi}{180} $$\n太阳天顶角$\\theta_{z}$由太阳高度角$\\varepsilon_{s}$推导得出：\n$$ \\theta_{z} = \\frac{\\pi}{2} - \\varepsilon_{s} $$\n对于坡度和坡向，这些计算是针对每个像素执行的；对于太阳角度，则是作为标量值进行计算。\n\n**2. 光照建模和地形校正**\n\n物理校正的核心在于对倾斜表面上的太阳光照进行建模。假设为朗伯表面，局部辐照度与太阳入射角的余弦$\\cos i$成正比。这使用以下公式为每个像素计算：\n$$ \\cos i = \\cos \\alpha \\cos \\theta_{z} + \\sin \\alpha \\sin \\theta_{z} \\cos(\\phi_{s} - \\gamma) $$\n一个关键条件是，只有当$\\cos i > 0$时，像素才被照亮。$\\cos i \\le 0$的像素处于自阴影中，必须从分析中排除。这些无效像素通过例如赋给它们一个“非数字”（`NaN`）值来标记。\n\n对于所有有效（被照亮）的像素，观测到的反射率$R_{\\text{obs}}$被校正以对地形效应进行归一化。校正后的反射率$R_{\\text{corr}}$模拟了表面平坦时的反射率。此余弦校正的公式是：\n$$ R_{\\text{corr}} = R_{\\text{obs}} \\cdot \\frac{\\cos \\theta_{z}}{\\cos i} $$\n此校正独立应用于四个输入反射率波段中的每一个：火前近红外（$R_{N,\\text{pre}}$）、火前短波红外（$R_{S,\\text{pre}}$）、火后近红外（$R_{N,\\text{post}}$）和火后短波红外（$R_{S,\\text{post}}$）。阴影中像素的反射率值被设置为`NaN`。\n\n**3. 火烧严重度指数计算**\n\n有了经过地形校正的反射率值，我们就可以计算对地形效应更具稳健性的光谱指数。使用校正后的近红外（$R_{N,\\text{corr}}$）和短波红外（$R_{S,\\text{corr}}$）波段，为火前和火后时期计算一个归一化差异指数$I$。\n$$ I_{\\text{pre}} = \\frac{R_{N,\\text{pre,corr}} - R_{S,\\text{pre,corr}}}{R_{N,\\text{pre,corr}} + R_{S,\\text{pre,corr}}} $$\n$$ I_{\\text{post}} = \\frac{R_{N,\\text{post,corr}} - R_{S,\\text{post,corr}}}{R_{N,\\text{post,corr}} + R_{S,\\text{post,corr}}} $$\n任何分母$(R_{N,\\text{corr}} + R_{S,\\text{corr}})$为零的像素，或输入反射率为`NaN`的像素，将产生一个`NaN`结果，从而确保无效数据被传播。\n\n从这些指数中，计算由火灾引起的变化$\\Delta I$：\n$$ \\Delta I = I_{\\text{pre}} - I_{\\text{post}} $$\n为创建最终的火烧严重度度量$I_{R}$，此变化相对于火前指数的量级进行归一化。加入一个小的稳定因子$\\epsilon = 10^{-6}$，以防止除以零或接近零的值。\n$$ I_{R} = \\frac{\\Delta I}{\\sqrt{|I_{\\text{pre}}| + \\epsilon}} $$\n得到的$I_R$栅格是用于与实地数据验证的主要输入。\n\n**4. 使用实地数据进行统计验证**\n\n最后阶段是将推导出的$I_R$度量与地面真值的综合火烧指数（CBI）测量值进行验证。对于每个测试案例，我们都获得了一组样地位置、它们对应的CBI值，以及一个划分为校准和验证子集的分区。\n\n首先，为每个样地位置提取$I_R$值和CBI值。如果任何样地位置在$I_R$栅格中对应一个值为`NaN`的像素，则根据问题说明，该样地将从分析中舍弃。\n\n接下来，使用数据的校准子集拟合一个简单线性回归模型：\n$$ \\widehat{\\mathrm{CBI}} = a \\cdot I_{R} + b $$\n系数$a$（斜率）和$b$（截距）通过普通最小二乘法（OLS）确定。这在我们的遥感度量和实地测量的火烧严重度之间建立了一种预测关系。\n\n最后，在留出验证子集上评估此模型的性能。使用拟合的模型，根据每个验证点$k$的$I_{R,k}$值预测其CBI值（$\\widehat{\\mathrm{CBI}}_{k}$）。然后计算均方根误差（RMSE）以量化预测误差：\n$$ \\mathrm{RMSE} = \\sqrt{\\frac{1}{n} \\sum_{k=1}^{n} (\\mathrm{CBI}_{k} - \\widehat{\\mathrm{CBI}}_{k})^{2}} $$\n其中$n$是验证集中的有效点数。此RMSE值作为每个案例的最终结果，为算法的准确性提供了定量度量。对三个测试案例中的每一个重复整个过程。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print the final results.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A\n        {\n            \"R_n_pre\": np.array([[0.45, 0.42, 0.40], [0.43, 0.41, 0.44], [0.46, 0.40, 0.42]]),\n            \"R_s_pre\": np.array([[0.14, 0.15, 0.16], [0.13, 0.17, 0.15], [0.14, 0.16, 0.13]]),\n            \"R_n_post\": np.array([[0.30, 0.28, 0.26], [0.27, 0.29, 0.25], [0.28, 0.26, 0.24]]),\n            \"R_s_post\": np.array([[0.22, 0.24, 0.23], [0.25, 0.22, 0.24], [0.26, 0.23, 0.25]]),\n            \"slope\": np.array([[15, 20, 10], [25, 15, 30], [12, 18, 22]]),\n            \"aspect\": np.array([[90, 120, 150], [135, 180, 210], [60, 75, 105]]),\n            \"solar_elev\": 45, \"solar_azim\": 135,\n            \"plot_cbi\": {(0, 0): 0.90, (0, 2): 0.80, (1, 1): 1.10, (1, 2): 1.20, (2, 0): 0.85, (2, 2): 1.00},\n            \"cal_locs\": [(0, 0), (0, 2), (1, 1), (2, 2)],\n            \"val_locs\": [(1, 2), (2, 0)],\n        },\n        # Case B\n        {\n            \"R_n_pre\": np.array([[0.50, 0.48, 0.47], [0.49, 0.51, 0.50], [0.48, 0.47, 0.49]]),\n            \"R_s_pre\": np.array([[0.12, 0.13, 0.12], [0.14, 0.12, 0.13], [0.15, 0.13, 0.14]]),\n            \"R_n_post\": np.array([[0.46, 0.45, 0.44], [0.45, 0.47, 0.46], [0.46, 0.44, 0.45]]),\n            \"R_s_post\": np.array([[0.13, 0.14, 0.13], [0.15, 0.13, 0.14], [0.16, 0.14, 0.15]]),\n            \"slope\": np.array([[0, 0, 0], [0, 0, 0], [0, 0, 0]]),\n            \"aspect\": np.array([[0, 0, 0], [0, 0, 0], [0, 0, 0]]),\n            \"solar_elev\": 60, \"solar_azim\": 150,\n            \"plot_cbi\": {(0, 0): 0.35, (0, 1): 0.40, (1, 0): 0.38, (1, 2): 0.45, (2, 1): 0.42, (2, 2): 0.50},\n            \"cal_locs\": [(0, 0), (0, 1), (1, 0), (2, 1)],\n            \"val_locs\": [(1, 2), (2, 2)],\n        },\n        # Case C\n        {\n            \"R_n_pre\": np.array([[0.43, 0.42, 0.20], [0.44, 0.46, 0.21], [0.45, 0.47, 0.22]]),\n            \"R_s_pre\": np.array([[0.18, 0.19, 0.20], [0.17, 0.18, 0.21], [0.19, 0.20, 0.22]]),\n            \"R_n_post\": np.array([[0.25, 0.24, 0.18], [0.26, 0.27, 0.19], [0.24, 0.26, 0.20]]),\n            \"R_s_post\": np.array([[0.28, 0.30, 0.22], [0.29, 0.27, 0.23], [0.30, 0.28, 0.24]]),\n            \"slope\": np.array([[50, 60, 70], [65, 75, 80], [55, 45, 70]]),\n            \"aspect\": np.array([[200, 220, 180], [200, 160, 140], [220, 200, 110]]),\n            \"solar_elev\": 30, \"solar_azim\": 200,\n            \"plot_cbi\": {(0, 0): 2.20, (0, 1): 2.00, (1, 0): 2.40, (1, 1): 1.80, (2, 1): 2.10, (2, 2): 1.60},\n            \"cal_locs\": [(0, 0), (0, 1), (1, 0), (1, 1)],\n            \"val_locs\": [(2, 1), (2, 2)],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        rmse = process_case(case)\n        results.append(f\"{rmse:.4f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef process_case(case):\n    \"\"\"\n    Processes a single test case from data preparation to RMSE calculation.\n    \"\"\"\n    epsilon = 1e-6\n\n    # 1. Convert angles to radians and calculate solar zenith\n    slope_rad = np.deg2rad(case[\"slope\"])\n    aspect_rad = np.deg2rad(case[\"aspect\"])\n    solar_elev_rad = np.deg2rad(case[\"solar_elev\"])\n    solar_azim_rad = np.deg2rad(case[\"solar_azim\"])\n    solar_zenith_rad = np.pi / 2 - solar_elev_rad\n    \n    # 2. Illumination modeling\n    cos_i = (np.cos(slope_rad) * np.cos(solar_zenith_rad) +\n             np.sin(slope_rad) * np.sin(solar_zenith_rad) * np.cos(solar_azim_rad - aspect_rad))\n\n    # Mask for shadowed areas\n    valid_mask = cos_i > 0\n    \n    # 3. Topographic correction function\n    def correct_reflectance(r_obs):\n        r_corr = np.full_like(r_obs, np.nan, dtype=np.float64)\n        corr_factor = np.cos(solar_zenith_rad) / cos_i[valid_mask]\n        r_corr[valid_mask] = r_obs[valid_mask] * corr_factor\n        return r_corr\n\n    r_n_pre_corr = correct_reflectance(case[\"R_n_pre\"])\n    r_s_pre_corr = correct_reflectance(case[\"R_s_pre\"])\n    r_n_post_corr = correct_reflectance(case[\"R_n_post\"])\n    r_s_post_corr = correct_reflectance(case[\"R_s_post\"])\n\n    # 4. Normalized difference index calculation function\n    def calculate_ndi(r_n, r_s):\n        denominator = r_n + r_s\n        # Suppress division by zero warning, as we handle it\n        with np.errstate(divide='ignore', invalid='ignore'):\n            ndi = (r_n - r_s) / denominator\n        # Set to NaN where denominator is zero or inputs were NaN\n        ndi[denominator == 0] = np.nan\n        return ndi\n\n    i_pre = calculate_ndi(r_n_pre_corr, r_s_pre_corr)\n    i_post = calculate_ndi(r_n_post_corr, r_s_post_corr)\n\n    # 5. Burn severity metric calculation\n    delta_i = i_pre - i_post\n    # Suppress invalid value warning from sqrt of negative number\n    with np.errstate(invalid='ignore'):\n        i_r = delta_i / np.sqrt(np.abs(i_pre) + epsilon)\n\n    # 6. Extract data and perform validation\n    cal_ir, cal_cbi = [], []\n    for r, c in case[\"cal_locs\"]:\n        ir_val = i_r[r, c]\n        if not np.isnan(ir_val):\n            cal_ir.append(ir_val)\n            cal_cbi.append(case[\"plot_cbi\"][(r, c)])\n    \n    val_ir, val_cbi = [], []\n    for r, c in case[\"val_locs\"]:\n        ir_val = i_r[r, c]\n        if not np.isnan(ir_val):\n            val_ir.append(ir_val)\n            val_cbi.append(case[\"plot_cbi\"][(r, c)])\n\n    cal_ir, cal_cbi = np.array(cal_ir), np.array(cal_cbi)\n    val_ir, val_cbi = np.array(val_ir), np.array(val_cbi)\n\n    if len(cal_ir)  2 or len(val_ir) == 0:\n        return np.nan # Not enough data to fit model or validate\n\n    # 7. Linear regression on calibration data\n    slope, intercept, _, _, _ = linregress(cal_ir, cal_cbi)\n    \n    # 8. Predict on validation data and compute RMSE\n    pred_cbi = slope * val_ir + intercept\n    rmse = np.sqrt(np.mean((val_cbi - pred_cbi)**2))\n    \n    return rmse\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2527969"}, {"introduction": "制作一张土地覆盖分类图远非终点，对其进行严格的精度评估并得出可靠的结论才是关键。本练习[@problem_id:2527995]超越了计算总体精度等简单指标，展示了如何利用基于科学抽样设计得出的混淆矩阵，来生成统计上更稳健的地物面积估算值，从而校正地图本身的分类误差。这项技能对于在生态学研究和环境管理中，准确报告栖息地面积变化或土地利用统计数据至关重要。", "problem": "一幅通过卫星地球观测生成并在地理信息系统（GIS）中进行分析的区域生境地图，将总面积为 $A = 25000$ $\\mathrm{km^2}$ 的景观区域划分为 $K = 4$ 个图上类别：森林、农业、湿地和城市。各图上类别的面积分别为 $M_{\\text{Forest}} = 12000$ $\\mathrm{km^2}$，$M_{\\text{Agriculture}} = 9000$ $\\mathrm{km^2}$，$M_{\\text{Wetland}} = 3000$ $\\mathrm{km^2}$，以及 $M_{\\text{Urban}} = 1000$ $\\mathrm{km^2}$。一项精度评估采用分层随机抽样法，以图上类别作为分层。在每个层内，从甚高分辨率影像中判读一个独立的简单随机参考位置样本。按图上类别划分的样本量为 $n_{\\text{Forest}} = 200$，$n_{\\text{Agriculture}} = 150$，$n_{\\text{Wetland}} = 120$，以及 $n_{\\text{Urban}} = 80$。得到的计数混淆矩阵 $n_{ij}$ （行 $i$ = 图上类别，列 $j$ = 参考类别）如下：\n- 图上森林类别：$n_{\\text{Forest},\\text{Forest}} = 178$，$n_{\\text{Forest},\\text{Agriculture}} = 12$，$n_{\\text{Forest},\\text{Wetland}} = 8$，$n_{\\text{Forest},\\text{Urban}} = 2$。\n- 图上农业类别：$n_{\\text{Agriculture},\\text{Forest}} = 9$，$n_{\\text{Agriculture},\\text{Agriculture}} = 126$，$n_{\\text{Agriculture},\\text{Wetland}} = 10$，$n_{\\text{Agriculture},\\text{Urban}} = 5$。\n- 图上湿地类别：$n_{\\text{Wetland},\\text{Forest}} = 6$，$n_{\\text{Wetland},\\text{Agriculture}} = 16$，$n_{\\text{Wetland},\\text{Wetland}} = 92$，$n_{\\text{Wetland},\\text{Urban}} = 6$。\n- 图上城市类别：$n_{\\text{Urban},\\text{Forest}} = 1$，$n_{\\text{Urban},\\text{Agriculture}} = 5$，$n_{\\text{Urban},\\text{Wetland}} = 3$，$n_{\\text{Urban},\\text{Urban}} = 71$。\n\n假设以下设计和建模前提：\n- 图上类别定义了 $K$ 个层，层权重为 $W_i = M_i / A$。\n- 在每个层 $i$ 内，样本是大小为 $n_i$ 的简单随机样本，并且对于给定的目标参考类别 $j$ 的参考标签可以建模为成功概率为 $p_{ij}$ 的独立伯努利试验。\n- 在进行方差计算时，各层是独立的。\n- 当使用正态近似法为调整后面积构建双侧置信区间时，使用标准正态分位数 $z_{0.975} = 1.96$。\n\n根据分层随机抽样的基本原理，计算所有4个参考类别的调整后面积估计值及其标准误。然后，重点关注湿地类别，为其调整后面积构建95%的双侧置信区间。\n\n最终答案仅报告调整后湿地面积的95%置信下限，以 $\\mathrm{km^2}$ 为单位，并四舍五入至四位有效数字。最终答案框中请勿包含单位。", "solution": "所提供的问题是在遥感数据统计分析领域中一个定义明确且具有科学依据的练习，具体涉及使用分层随机抽样对分类地图进行精度评估。所有提供的数据内部一致，足以得出唯一解。该问题是有效的。\n\n目标是基于参考数据样本，估计不同土地覆盖类别的真实面积，并校正原始地图中的分类误差。这可以通过分层估计的原理来实现，其中图上类别作为分层。\n\n设类别数量为 $K$，本题中 $K=4$。我们用索引 $i$ 表示图上类别（层），用索引 $j$ 表示参考类别，其中 $i, j \\in \\{1, 2, 3, 4\\}$ 分别对应森林、农业、湿地和城市。\n\n给定数据如下：\n景观总面积，$A = 25000$ $\\mathrm{km^2}$。\n层 $i$ 的图上面积，$M_i$。\n$M_1 = 12000$ $\\mathrm{km^2}$，$M_2 = 9000$ $\\mathrm{km^2}$，$M_3 = 3000$ $\\mathrm{km^2}$，$M_4 = 1000$ $\\mathrm{km^2}$。\n层 $i$ 的层权重为 $W_i = \\frac{M_i}{A}$。\n$W_1 = \\frac{12000}{25000} = 0.48$，$W_2 = \\frac{9000}{25000} = 0.36$，$W_3 = \\frac{3000}{25000} = 0.12$，$W_4 = \\frac{1000}{25000} = 0.04$。\n每个层 $i$ 内的样本量为 $n_i$。\n$n_1 = 200$，$n_2 = 150$，$n_3 = 120$，$n_4 = 80$。\n混淆矩阵的计数由 $n_{ij}$ 给出，表示在层 $i$（图上类别）中被识别为类别 $j$（参考类别）的样本点数量。\n\n第一步是估计每个图上类别（层） $i$ 内，各个参考类别 $j$ 的比例。这个比例记为 $\\hat{p}_{ij}$，根据样本计数估计如下：\n$$ \\hat{p}_{ij} = \\frac{n_{ij}}{n_i} $$\n该项表示在被划分为类别 $i$ 的区域内随机选择的一个点，其真实类别为 $j$ 的估计概率。\n\n参考类别 $j$ 的总面积，记为 $\\hat{A}_j$，通过对每个层的面积贡献求和来估计。层 $i$ 对参考类别 $j$ 的面积贡献是层 $i$ 的图上面积 $M_i$ 乘以估计比例 $\\hat{p}_{ij}$。因此，类别 $j$ 的总调整后面积为：\n$$ \\hat{A}_j = \\sum_{i=1}^{K} M_i \\hat{p}_{ij} $$\n\n我们现在计算 $K=4$ 个参考类别中每一个的调整后面积。\n\n对于森林（$j=1$）：\n$$ \\hat{A}_{\\text{Forest}} = (12000 \\times \\frac{178}{200}) + (9000 \\times \\frac{9}{150}) + (3000 \\times \\frac{6}{120}) + (1000 \\times \\frac{1}{80}) $$\n$$ \\hat{A}_{\\text{Forest}} = 10680 + 540 + 150 + 12.5 = 11382.5 \\text{ km}^2 $$\n\n对于农业（$j=2$）：\n$$ \\hat{A}_{\\text{Agriculture}} = (12000 \\times \\frac{12}{200}) + (9000 \\times \\frac{126}{150}) + (3000 \\times \\frac{16}{120}) + (1000 \\times \\frac{5}{80}) $$\n$$ \\hat{A}_{\\text{Agriculture}} = 720 + 7560 + 400 + 62.5 = 8742.5 \\text{ km}^2 $$\n\n对于湿地（$j=3$）：\n$$ \\hat{A}_{\\text{Wetland}} = (12000 \\times \\frac{8}{200}) + (9000 \\times \\frac{10}{150}) + (3000 \\times \\frac{92}{120}) + (1000 \\times \\frac{3}{80}) $$\n$$ \\hat{A}_{\\text{Wetland}} = 480 + 600 + 2300 + 37.5 = 3417.5 \\text{ km}^2 $$\n\n对于城市（$j=4$）：\n$$ \\hat{A}_{\\text{Urban}} = (12000 \\times \\frac{2}{200}) + (9000 \\times \\frac{5}{150}) + (3000 \\times \\frac{6}{120}) + (1000 \\times \\frac{71}{80}) $$\n$$ \\hat{A}_{\\text{Urban}} = 120 + 300 + 150 + 887.5 = 1457.5 \\text{ km}^2 $$\n\n调整后面积的总和为 $11382.5 + 8742.5 + 3417.5 + 1457.5 = 25000$ km$^2$，这与总面积 $A$ 相符，是正确的。\n\n接下来，我们计算每个调整后面积估计值的标准误。由于来自不同层的样本是独立的，总估计面积 $\\hat{A}_j$ 的方差是来自每个层的面积估计值方差的总和。\n$$ V(\\hat{A}_j) = V\\left(\\sum_{i=1}^{K} M_i \\hat{p}_{ij}\\right) = \\sum_{i=1}^{K} M_i^2 V(\\hat{p}_{ij}) $$\n来自简单随机样本的样本比例 $\\hat{p}_{ij}$ 的方差估计为：\n$$ \\hat{V}(\\hat{p}_{ij}) = \\frac{\\hat{p}_{ij}(1-\\hat{p}_{ij})}{n_i - 1} $$\n这里使用了伯努利试验过程方差的无偏估计量。因此，调整后面积的估计方差为：\n$$ \\hat{V}(\\hat{A}_j) = \\sum_{i=1}^{K} M_i^2 \\frac{\\hat{p}_{ij}(1-\\hat{p}_{ij})}{n_i - 1} $$\n标准误是方差的平方根：$SE(\\hat{A}_j) = \\sqrt{\\hat{V}(\\hat{A}_j)}$。\n\n题目要求我们重点关注湿地类别（$j=3$）。我们将计算其标准误和置信区间。\n调整后面积为 $\\hat{A}_{\\text{Wetland}} = 3417.5$ km$^2$。\n方差计算需要对四项求和，每一项对应一个层 $i$：\n对于层 $i=1$ (森林)：$M_1 = 12000$, $n_1 = 200$, $\\hat{p}_{13} = \\frac{8}{200} = 0.04$。\n$$ \\text{Term}_1 = (12000)^2 \\frac{0.04(1 - 0.04)}{200 - 1} = 144000000 \\times \\frac{0.0384}{199} \\approx 27803.015 $$\n对于层 $i=2$ (农业)：$M_2 = 9000$, $n_2 = 150$, $\\hat{p}_{23} = \\frac{10}{150} = \\frac{1}{15}$。\n$$ \\text{Term}_2 = (9000)^2 \\frac{(\\frac{1}{15})(1 - \\frac{1}{15})}{150 - 1} = 81000000 \\times \\frac{14/225}{149} \\approx 33833.893 $$\n对于层 $i=3$ (湿地)：$M_3 = 3000$, $n_3 = 120$, $\\hat{p}_{33} = \\frac{92}{120} = \\frac{23}{30}$。\n$$ \\text{Term}_3 = (3000)^2 \\frac{(\\frac{23}{30})(1 - \\frac{23}{30})}{120 - 1} = 9000000 \\times \\frac{161/900}{119} \\approx 13529.412 $$\n对于层 $i=4$ (城市)：$M_4 = 1000$, $n_4 = 80$, $\\hat{p}_{43} = \\frac{3}{80} = 0.0375$。\n$$ \\text{Term}_4 = (1000)^2 \\frac{0.0375(1 - 0.0375)}{80 - 1} = 1000000 \\times \\frac{0.03609375}{79} \\approx 456.883 $$\n\n调整后湿地面积的总估计方差为：\n$$ \\hat{V}(\\hat{A}_{\\text{Wetland}}) \\approx 27803.015 + 33833.893 + 13529.412 + 456.883 \\approx 75623.203 \\text{ (km}^2)^2 $$\n标准误为：\n$$ SE(\\hat{A}_{\\text{Wetland}}) = \\sqrt{75623.203} \\approx 274.99673 \\text{ km}^2 $$\n\n使用正态近似法构建调整后面积的95%双侧置信区间：\n$$ CI = \\hat{A}_{\\text{Wetland}} \\pm z_{0.975} \\times SE(\\hat{A}_{\\text{Wetland}}) $$\n使用给定值 $z_{0.975} = 1.96$：\n$$ CI = 3417.5 \\pm 1.96 \\times 274.99673 $$\n$$ CI = 3417.5 \\pm 538.99359 $$\n置信下限为：\n$$ LCL = 3417.5 - 538.99359 = 2878.50641 $$\n置信上限为：\n$$ UCL = 3417.5 + 538.99359 = 3956.49359 $$\n题目要求报告调整后湿地面积的95%置信下限，并四舍五入至四位有效数字。\n该值为 $2878.50641$。第五位有效数字是 $5$，因此我们将第四位数字向上取整。\n$$ LCL \\approx 2879 \\text{ km}^2 $$\n至此，所需计算已完成。为完整起见，其他类别的标准误约为：$SE(\\hat{A}_{\\text{Forest}}) \\approx 324.52$ km$^2$，$SE(\\hat{A}_{\\text{Agriculture}}) \\approx 351.26$ km$^2$，以及 $SE(\\hat{A}_{\\text{Urban}}) \\approx 171.94$ km$^2$。", "answer": "$$\n\\boxed{2879}\n$$", "id": "2527995"}]}