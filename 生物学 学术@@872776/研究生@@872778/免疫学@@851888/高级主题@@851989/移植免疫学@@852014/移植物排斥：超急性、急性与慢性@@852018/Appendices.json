{"hands_on_practices": [{"introduction": "移植排斥反应的诊断依赖于对活检组织样本的精确解读，而班夫（Banff）分类标准是这一领域的通用语言。本练习将挑战您综合运用组织学、血清学和补体染色数据，对一个复杂的临床病例做出精确诊断。通过这项实践，您将掌握区分T细胞介导排斥（TCMR）和抗体介导排斥（ABMR）核心标准的能力，这是移植免疫学研究和临床决策的关键技能。[@problem_id:2850468]", "problem": "一名肾移植受者在移植后$3$个月出现血清肌酐升高和蛋白尿。无临床感染证据。因故进行的活检根据Banff病变评分判读如下：间质炎症$i=2$，肾小管炎$t=2$，动脉内膜炎$v=0$，肾小球炎$g=1$，管周毛细血管炎$ptc=2$。通过免疫荧光（IF）和免疫组化（IHC）检测，补体成分$4$d（C4d）染色均为阴性。单抗原微珠检测发现人类白细胞抗原（HLA）II类供者特异性抗体（DSA）。光镜下未见慢性肾小球双轨征，电镜下也无肾小球基底膜重复的证据；无其他慢性瘢痕形成评分升高。\n\n仅使用同种异体移植物排斥反应的基础免疫学原理（细胞介导途径与体液介导途径）和Banff分类的定义标准（病变定义和诊断阈值），确定最准确的排斥反应表型。选择唯一的最佳选项，并准备好论证每项必需标准是如何被满足或未被满足的。\n\n选项：\n\nA. 仅为急性T细胞介导的排斥反应（TCMR），Banff IA级\n\nB. 仅为活动性抗体介导的排斥反应（ABMR），C4d阴性\n\nC. 混合性排斥反应：急性T细胞介导的排斥反应（TCMR）Banff IA级和活动性抗体介导的排斥反应（ABMR），C4d阴性\n\nD. 慢性活动性抗体介导的排斥反应（ABMR）\n\nE. 无排斥反应；仅为临界性或非特异性改变", "solution": "首先必须对问题陈述进行严格验证，以确保其科学上合理、信息自足且表述清晰。\n\n**步骤1：提取已知条件**\n问题陈述中提供了以下数据：\n-   **受者**：肾移植受者。\n-   **移植后时间**：$3$个月。\n-   **临床表现**：血清肌酐升高和蛋白尿。\n-   **排除项**：无临床感染证据。\n-   **活检病变评分（Banff分类）**：\n    -   间质炎症：$i=2$（皮质区$26-50$%的炎症）。\n    -   肾小管炎：$t=2$（每个肾小管横断面有$5-10$个单核细胞）。\n    -   动脉内膜炎：$v=0$（无动脉内膜炎）。\n    -   肾小球炎：$g=1$（$25-75$%的肾小球存在肾小球炎症）。\n    -   管周毛细血管炎：$ptc=2$（超过$10$%的毛细血管管腔内细胞$\\geq 3$个）。\n-   **免疫组化/免疫荧光**：\n    -   补体成分$4$d（$C4d$）为阴性。\n-   **血清学**：\n    -   存在人类白细胞抗原（HLA）II类供者特异性抗体（DSA）。\n-   **慢性标志物**：\n    -   光镜下无慢性肾小球双轨征。\n    -   电镜下无肾小球基底膜重复的证据。\n    -   无其他慢性瘢痕形成评分升高。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，植根于成熟的移植免疫学和病理学领域。它采用了国际标准化的Banff同种异体移植物病理学分类，这是移植领域诊断和研究的基石。所提供的临床情景和组织病理学评分代表了临床实践中一个现实且常见的病例。语言精确、客观。问题表述清晰，提供了所有必要信息（组织学评分、血清学和C4d状态）以使用Banff标准得出诊断。问题信息自足，没有矛盾或含糊之处。\n\n**步骤3：结论与行动**\n问题陈述有效。可以通过应用Banff分类的诊断标准得出明确的解决方案。\n\n**解决方案的推导**\n\n目标是通过将所提供的数据与T细胞介导的排斥反应（TCMR）和抗体介导的排斥反应（ABMR）的正式Banff标准进行系统性评估，来确定最准确的排斥反应表型。\n\n**1. T细胞介导的排斥反应（TCMR）评估**\n急性TCMR的诊断依赖于肾小管间质和动脉中的炎症证据。\n-   **急性TCMR IA级**：要求有显著的间质炎症（$i=2$或$i=3$）和中度肾小管炎（$t=2$）。\n    -   给出的评分为$i=2$和$t=2$。\n    -   这些评分精确地满足了急性TCMR，IA级的标准。\n-   **急性TCMR IB级**：要求有显著的间质炎症（$i=2$或$i=3$）和重度肾小管炎（$t=3$）。此项不满足。\n-   **急性TCMR II级和III级**：要求有动脉内膜炎的证据（$v>0$）。\n    -   给出的评分为$v=0$。\n    -   因此，排除了更高级别的TCMR。\n\n根据评分$i=2$和$t=2$，可以明确诊断为**急性TCMR，IA级**。\n\n**2. 抗体介导的排斥反应（ABMR）评估**\n活动性ABMR的诊断需要同时满足三个标准：\n\n-   **标准1：急性组织损伤的组织学证据。**\n    这包括以下一项或多项：\n    -   微血管炎症，定义为肾小球炎和管周毛细血管炎评分之和$(g + ptc) \\geq 2$。\n    -   动脉内膜炎或穿壁性动脉炎（$v > 0$）。\n    -   急性血栓性微血管病。\n    在本案例中，评分为$g=1$和$ptc=2$。其和为$g + ptc = 1 + 2 = 3$。\n    由于$3 \\geq 2$，满足了显著微血管炎症的标准。\n\n-   **标准2：当前/近期抗体与血管内皮相互作用的证据。**\n    这包括以下一项或多项：\n    -   管周毛细血管中线性$C4d$染色。\n    -   在C4d阴性的情况下，至少有中度微血管炎症（$g+ptc \\geq 2$）。\n    -   指示内皮损伤的基因转录本表达增加（未提供，但鉴于其他发现，此项不是必需的）。\n    问题陈述中指出$C4d$染色为阴性。然而，微血管炎症评分为$g+ptc=3$，即$\\geq 2$。根据Banff标准，即使$C4d$为阴性，此水平的炎症也足以满足标准2。这就是**$C4d$阴性ABMR**的定义。\n\n-   **标准3：循环中存在供者特异性抗体（DSA）的血清学证据。**\n    问题明确指出检测到HLA II类DSA。此标准被满足。\n\n由于所有三个标准均得到满足，因此同时存在**活动性抗体介导的排斥反应，C4d阴性**的诊断。\n\n**3. 慢性排斥反应评估**\n慢性活动性ABMR的诊断需要慢性组织损伤的证据，主要是移植肾肾小球病（TG），其病理学定义为肾小球基底膜重复（双轨征），评分为$cg > 0$。\n-   问题明确指出“光镜下未见慢性肾小球双轨征，电镜下也无肾小球基底膜重复的证据”以及“无其他慢性瘢痕形成评分升高”。\n-   这意味着$cg=0$且不存在其他慢性评分。\n-   因此，排除了慢性活动性ABMR的诊断。该过程完全是活动性的。\n\n**结论**\n受者的活检同时满足急性TCMR，IA级和活动性ABMR，C4d阴性的诊断标准。当同一标本中同时满足两种排斥类型的标准时，诊断为**混合性排斥反应**。\n\n**逐项分析选项**\n\n-   **A. 仅为急性T细胞介导的排斥反应（TCMR），Banff IA级**: **不正确**。该诊断不完整。虽然满足了TCMR的标准，但该选项忽略了同时存在ABMR的有力证据：在存在DSA的情况下，有显著的微血管炎症（$g+ptc=3$）。\n-   **B. 仅为活动性抗体介导的排斥反应（ABMR），C4d阴性**: **不正确**。该诊断同样不完整。虽然满足了活动性$C4d$阴性ABMR的标准，但该选项忽略了诊断TCMR IA级的肾小管间质炎症（$i=2$, $t=2$）。\n-   **C. 混合性排斥反应：急性T细胞介导的排斥反应（TCMR）Banff IA级和活动性抗体介导的排斥反应（ABMR），C4d阴性**: **正确**。这是最准确和最完整的诊断，因为它解释了所有提供的组织病理学和血清学发现。活检显示了细胞和体液排斥途径同时发生的清晰、独立的证据。\n-   **D. 慢性活动性抗体介导的排斥反应（ABMR)**: **不正确**。问题明确指出没有慢性改变，特别是没有肾小球基底膜重复（$cg = 0$），而这是慢性ABMR的标志。\n-   **E. 无排斥反应；仅为临界性或非特异性改变**: **不正确**。组织病理学评分不是临界性的。$i=2$和$t=2$的组合可诊断为TCMR IA级。$g=1$、$ptc=2$和DSA阳性的组合可诊断为活动性ABMR。这些都是明确的发现，而非临界性或非特异性的。", "answer": "$$\\boxed{C}$$", "id": "2850468"}, {"introduction": "诊断测试的价值不仅在于其结果，更在于它如何改变我们对患者风险的评估。本练习将引导您从定性解读转向定量分析，运用贝叶斯定理（Bayes' theorem）来计算一项关键移植前测试——流式细胞术交叉配型（Flow Cytometric Crossmatch）的真实临床价值。通过计算阳性结果后的后验概率，您将深刻理解先验风险、敏感性和特异性是如何共同决定诊断结论的可靠性的。[@problem_id:2850452]", "problem": "一名有多次妊娠史和既往致敏输血史的肾移植候选人，其临床估计的检验前概率为存在临床上显著的、可导致移植后即刻发生抗体介导的移植物排斥反应（ABMR）的预形成供体特异性同种抗体，该概率为 $p_{0} = 0.30$。她使用供体T细胞进行了一次流式细胞术交叉配血（FCXM）检测。为了检测由预形成供体特异性抗体（DSA）引起的ABMR，该检测的灵敏度为 $S_{e} = 0.93$，特异性为 $S_{p} = 0.85$。FCXM检测结果为阳性。\n\n请从条件概率、灵敏度和特异性的定义出发，在不假设任何未提及的检验或人群特性的前提下，推导在FCXM结果为阳性的条件下发生ABMR的检验后概率的表达式，并计算其数值。将最终答案表示为小数（而非百分比），并四舍五入至四位有效数字。", "solution": "所述问题需经过验证。\n\n逐字提取已知条件：\n1.  导致抗体介导的移植物排斥反应（ABMR）的临床显著预形成供体特异性同种抗体的检验前概率，$p_{0} = 0.30$。\n2.  流式细胞术交叉配血（FCXM）的灵敏度，$S_{e} = 0.93$。\n3.  FCXM的特异性，$S_{p} = 0.85$。\n4.  FCXM结果为阳性。\n5.  推导在FCXM阳性的情况下发生ABMR的检验后概率表达式。\n6.  计算其数值，并四舍五入至四位有效数字。\n\n验证过程如下：\n该问题具有科学依据，运用了应用于医学诊断的贝叶斯推断的标准原理。检验前概率（患病率）、灵敏度和特异性的概念是生物统计学的基础。问题提法明确，提供了计算唯一检验后概率所需的所有信息。语言客观精确。因此，该问题被认为是有效的，有必要给出解答。\n\n我们首先定义事件。设$D$为患者患有该病症的事件，即存在导致ABMR的临床显著预形成供体特异性同种抗体。设$T^+$为FCXM检验返回阳性结果的事件。$D$的补集，记为$D^c$，是患者未患该病症的事件。\n\n问题提供了以下概率：\n患有该病症的检验前概率（或先验概率）为$p_{0}$。\n$$P(D) = p_{0} = 0.30$$\n由此，未患该病症的概率为：\n$$P(D^c) = 1 - P(D) = 1 - p_{0} = 1 - 0.30 = 0.70$$\n\n灵敏度 $S_{e}$ 是指在患者患有该病症的条件下，检验结果为阳性的概率。\n$$S_{e} = P(T^{+} | D) = 0.93$$\n特异性 $S_{p}$ 是指在患者未患该病症的条件下，检验结果为阴性的概率。\n$$S_{p} = P(T^{-} | D^c) = 0.85$$\n根据特异性的定义，我们可以确定在患者未患该病症的情况下检验结果为阳性的概率（假阳性）。这是特异性的补集。\n$$P(T^{+} | D^c) = 1 - P(T^{-} | D^c) = 1 - S_{p} = 1 - 0.85 = 0.15$$\n\n目标是求在检验结果为阳性的条件下，患有该病症的检验后概率，即条件概率 $P(D | T^{+})$。我们使用条件概率的基本定义来推导它，该定义陈述为：\n$$P(D | T^{+}) = \\frac{P(D \\cap T^{+})}{P(T^{+})}$$\n分子 $P(D \\cap T^{+})$ 是患有该病症且检验结果为阳性的联合概率。它可以利用概率的乘法法则重写为：\n$$P(D \\cap T^{+}) = P(T^{+} | D) P(D)$$\n分母 $P(T^{+})$ 是获得阳性检验结果的总概率。我们使用全概率定律来表示它，对所有可能的病症状态（存在或不存在）求和：\n$$P(T^{+}) = P(T^{+} | D) P(D) + P(T^{+} | D^c) P(D^c)$$\n将这些表达式代回 $P(D | T^{+})$ 的公式，得到贝叶斯定理：\n$$P(D | T^{+}) = \\frac{P(T^{+} | D) P(D)}{P(T^{+} | D) P(D) + P(T^{+} | D^c) P(D^c)}$$\n这就是所要求的一般表达式。现在，我们代入问题陈述中给出的符号项：$p_{0}$、$S_{e}$ 和 $S_{p}$。\n$$P(D | T^{+}) = \\frac{S_{e} \\cdot p_{0}}{S_{e} \\cdot p_{0} + (1 - S_{p}) \\cdot (1 - p_{0})}$$\n这就是推导出的检验后概率的解析表达式。\n\n我们现在通过代入给定数据来计算数值：\n$$p_{0} = 0.30$$\n$$S_{e} = 0.93$$\n$$S_{p} = 0.85$$\n将这些值代入我们推导出的公式：\n$$P(D | T^{+}) = \\frac{0.93 \\cdot 0.30}{(0.93 \\cdot 0.30) + (1 - 0.85) \\cdot (1 - 0.30)}$$\n首先，我们计算分子和分母中的各项。\n分子：\n$$S_{e} \\cdot p_{0} = 0.93 \\cdot 0.30 = 0.279$$\n分母：\n$$(S_{e} \\cdot p_{0}) + ((1 - S_{p}) \\cdot (1 - p_{0})) = (0.279) + (0.15 \\cdot 0.70)$$\n$$(S_{e} \\cdot p_{0}) + ((1 - S_{p}) \\cdot (1 - p_{0})) = 0.279 + 0.105 = 0.384$$\n最后，我们计算比率：\n$$P(D | T^{+}) = \\frac{0.279}{0.384}$$\n$$P(D | T^{+}) \\approx 0.7265625$$\n问题要求答案四舍五入至四位有效数字。\n$$P(D | T^{+}) \\approx 0.7266$$\n因此，在FCXM结果为阳性的情况下，患者患有导致ABMR的病症的检验后概率约为 $0.7266$。", "answer": "$$\\boxed{0.7266}$$", "id": "2850452"}, {"introduction": "活检和血清学测试提供了免疫反应的静态快照，但排斥反应的本质是一个动态演化的过程。这项高级实践将带您进入系统免疫学的世界，通过构建和求解常微分方程（ordinary differential equations）模型来模拟移植排斥的动态轨迹。通过调整关键免疫参数，您将亲手探索超急性、急性及慢性排斥反应是如何从相同的基本免疫动力学规则中涌现出来的，从而获得对排斥反应发生机制的深层理解。[@problem_id:2850420]", "problem": "您的任务是根据质量作用样免疫动力学和克隆选择动力学的第一原理，形式化并模拟一个移植物排斥的机理常微分方程模型，以将排斥轨迹分类为超急性、急性或慢性。您的程序必须实现该系统，随时间进行积分，并为每个提供的参数集返回一个离散的分类。\n\n模型状态与解释：\n- $E(t)$：标准化的移植物同种异体抗原表达（无量纲，范围 $0$ 到 $1$）。\n- $T(t)$：活化的效应T细胞群体（任意标准化单位，无量纲）。\n- $B(t)$：活化的B细胞/浆细胞群体（任意标准化单位，无量纲）。\n- $A(t)$：供体特异性抗体滴度（任意标准化单位，无量纲）。\n- $D(t)$：累积移植物损伤指数（任意标准化单位，无量纲）。\n\n基本基础和建模假设：\n- 克隆选择和活化由抗原识别驱动；活化速率随抗原饱和，遵循Michaelis–Menten样的项 $E/(K_E + E)$，对于B细胞，还需要T细胞通过饱和因子 $T/(K_T + T)$ 的辅助。\n- 抗体和T细胞通过与其水平和可用的带抗原组织成比例的相互作用来介导移植物损伤。组织损伤会累积，但会以与现有损伤成比例的速率（一级修复）进行部分修复，而慢性重塑引入一个缓慢的正反馈，随着 $D$ 的增长而增加损伤累积。\n- 抗原可用性由于自然更新、抗体介导的带抗原内皮细胞清除以及T细胞的细胞毒性作用而下降，其速率分别与 $A E$ 和 $T E$ 成比例。\n\n需要实现的动力学：\n对于以天为单位的时间 $t$，模型为：\n$$\n\\frac{dT}{dt} = s_T \\frac{E}{K_E + E} - d_T T,\n\\quad\n\\frac{dB}{dt} = s_B \\frac{E}{K_E + E} \\frac{T}{K_T + T} - d_B B,\n$$\n$$\n\\frac{dA}{dt} = p_A B - d_A A,\n\\quad\n\\frac{dE}{dt} = -k_{\\mathrm{clear}} A E - k_{\\mathrm{Tkill}} T E - k_{\\mathrm{base}} E,\n$$\n$$\n\\frac{dD}{dt} = q_T T E + q_A A E + \\alpha_{\\mathrm{remod}} D - r_{\\mathrm{repair}} D.\n$$\n\n初始条件和时间范围：\n- $E(0) = 1$，\n- $T(0) = 0$，\n- $B(0) = 0$，\n- $A(0) = A_0$（根据测试用例指定），\n- $D(0) = 0$。\n模拟从 $t = 0$ 到 $t_{\\max} = 200$ 天。\n\n基本参数值（适用时单位为每天）：\n- $s_T = 0.8$, $s_B = 0.4$,\n- $K_E = 0.5$, $K_T = 0.5$,\n- $d_T = 0.3$, $d_B = 0.2$,\n- $p_A = 0.6$, $d_A = 0.1$,\n- $k_{\\mathrm{clear}} = 0.3$, $k_{\\mathrm{Tkill}} = 0.2$, $k_{\\mathrm{base}} = 0.01$,\n- $q_T = 0.05$, $q_A = 0.6$,\n- $r_{\\mathrm{repair}} = 0.01$, $\\alpha_{\\mathrm{remod}} = 0.002$.\n\n分类规则：\n- 设 $D_{\\mathrm{th}} = 1.0$ 为临床排斥的损伤阈值。\n- 定义 $t_{\\mathrm{cross}}$ 为在 $[0, t_{\\max}]$ 内满足 $D(t) \\ge D_{\\mathrm{th}}$ 的最早时间 $t$。\n- 如果在 $[0, t_{\\max}]$ 内不存在这样的时间，返回 $0$（观察窗口内无排斥）。\n- 如果 $t_{\\mathrm{cross}} < 1$，返回 $1$（超急性排斥）。\n- 如果 $1 \\le t_{\\mathrm{cross}} < 30$，返回 $2$（急性排斥）。\n- 如果 $30 \\le t_{\\mathrm{cross}} \\le 200$，返回 $3$（慢性排斥）。\n\n说明和单位：\n- 在整个模拟过程中，时间必须以天为单位。所有速率都是每天。累积损伤阈值 $D_{\\mathrm{th}}$ 是无量纲的。您的程序应计算以天为单位的 $t_{\\mathrm{cross}}$ 并应用上述分类规则。\n\n测试套件（五个参数集）：\n- 案例1（带有预形成供体特异性抗体的超急性排斥）：覆盖 $A_0 = 3.0$。\n- 案例2（急性细胞主导的排斥）：覆盖 $s_T = 1.2$，$q_T = 0.12$，$s_B = 0.2$，$A_0 = 0.0$。\n- 案例3（伴有缓慢重塑的慢性轨迹）：覆盖 $s_T = 0.2$，$s_B = 0.3$，$q_T = 0.02$，$q_A = 0.05$，$p_A = 0.15$，$d_A = 0.15$，$\\alpha_{\\mathrm{remod}} = 0.01$，$A_0 = 0.0$。\n- 案例4（操作性耐受/无排斥）：覆盖 $s_T = 0.08$，$s_B = 0.08$，$q_T = 0.005$，$q_A = 0.01$，$p_A = 0.3$，$r_{\\mathrm{repair}} = 0.05$，$k_{\\mathrm{base}} = 0.1$，$A_0 = 0.0$。\n- 案例5（急性体液主导的排斥）：覆盖 $s_B = 1.0$，$p_A = 0.8$，$s_T = 0.6$，$A_0 = 0.0$。\n\n算法要求：\n- 实现常微分方程组，并为每个参数集在 $[0, 200]$ 天的时间间隔内进行数值积分。\n- 检测 $t_{\\mathrm{cross}}$ 并根据上述规则计算分类整数。\n- 您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如，“[result1,result2,result3,result4,result5]”）。\n\n您的最终输出必须是恰好五个整数的列表，按上面介绍的顺序对应五个测试案例。", "solution": "问题已经过分析，并被确定为有效。\n\n**1. 问题验证**\n\n根据要求，逐字提取给定信息。\n\n**给定信息：**\n- 状态变量：$E(t)$、$T(t)$、$B(t)$、$A(t)$、$D(t)$。\n- 常微分方程组（ODEs）：\n$$\n\\frac{dT}{dt} = s_T \\frac{E}{K_E + E} - d_T T\n$$\n$$\n\\frac{dB}{dt} = s_B \\frac{E}{K_E + E} \\frac{T}{K_T + T} - d_B B\n$$\n$$\n\\frac{dA}{dt} = p_A B - d_A A\n$$\n$$\n\\frac{dE}{dt} = -k_{\\mathrm{clear}} A E - k_{\\mathrm{Tkill}} T E - k_{\\mathrm{base}} E\n$$\n$$\n\\frac{dD}{dt} = q_T T E + q_A A E + \\alpha_{\\mathrm{remod}} D - r_{\\mathrm{repair}} D\n$$\n- 初始条件：$E(0) = 1$，$T(0) = 0$，$B(0) = 0$，$A(0) = A_0$，$D(0) = 0$。\n- 时间范围：$t \\in [0, 200]$ 天。\n- 基本参数：\n  - $s_T = 0.8$, $s_B = 0.4$\n  - $K_E = 0.5$, $K_T = 0.5$\n  - $d_T = 0.3$, $d_B = 0.2$\n  - $p_A = 0.6$, $d_A = 0.1$\n  - $k_{\\mathrm{clear}} = 0.3$, $k_{\\mathrm{Tkill}} = 0.2$, $k_{\\mathrm{base}} = 0.01$\n  - $q_T = 0.05$, $q_A = 0.6$\n  - $r_{\\mathrm{repair}} = 0.01$, $\\alpha_{\\mathrm{remod}} = 0.002$\n- 分类规则：\n  - 损伤阈值 $D_{\\mathrm{th}} = 1.0$。\n  - $t_{\\mathrm{cross}}$ 是满足 $D(t) \\ge D_{\\mathrm{th}}$ 的最早时间 $t$。\n  - 在 $[0, 200]$ 内没有穿越：返回 $0$。\n  - $t_{\\mathrm{cross}} < 1$：返回 $1$（超急性）。\n  - $1 \\le t_{\\mathrm{cross}} < 30$：返回 $2$（急性）。\n  - $30 \\le t_{\\mathrm{cross}} \\le 200$：返回 $3$（慢性）。\n- 测试案例：提供了5组参数覆盖。\n\n**验证结论：**\n问题具有科学依据，是适定的、客观的且自洽的。\n- **科学依据**：该模型基于化学和免疫动力学的既定原理，特别是质量作用和Michaelis-Menten饱和，以表示克隆选择和效应功能。这是数学免疫学中一种标准且合理的方法。\n- **适定性**：问题定义了一个常微分方程的初值问题系统。右侧函数是连续且局部Lipschitz的，这保证了解的存在性和唯一性。分类标准明确。\n- **完整性和一致性**：所有必要的参数、初始条件和规则都已明确提供。单位（天、每天、无量纲）在整个模型中得到一致应用。\n- 根据检查清单，未检测到**其他缺陷**。该问题是一项标准的数值模拟和分析任务，并非微不足道，并且可以形式化。\n\n问题是有效的。将构建一个解决方案。\n\n**2. 求解方法**\n\n问题的核心是为5个不同的参数集求解一个包含5个耦合非线性常微分方程的系统，并对得到的轨迹进行分类。\n\n系统在任意时间 $t$ 的状态由向量 $y(t) = [T(t), B(t), A(t), E(t), D(t)]^T$ 表示。其动力学由 $\\frac{dy}{dt} = f(t, y, P)$ 给出，其中 $f$ 是问题中定义的函数集，而 $P$ 是参数集。\n\n数值解将通过在 $[0, 200]$ 天的时间间隔内积分该系统来获得。为此，我们将使用 `scipy.integrate` 库中的 `solve_ivp` 函数，它是一个鲁棒的自适应ODE求解器。\n\n对于每个测试案例，执行以下步骤：\n1.  使用当前案例的特定覆盖值更新基本参数集。\n2.  构建初始条件向量 $y(0) = [T(0), B(0), A(0), E(0), D(0)]^T = [0, 0, A_0, 1, 0]$，其中 $A_0$ 是为该案例指定的。\n3.  关键步骤是确定排斥时间 $t_{\\mathrm{cross}}$，定义为累积损伤 $D(t)$ 首次达到阈值 $D_{\\mathrm{th}} = 1.0$ 的时间 $t$。找到此时间最准确、最高效的方法是使用 `solve_ivp` 的事件检测功能。定义一个事件函数 $g(t, y) = D(t) - D_{\\mathrm{th}} = y_5(t) - 1.0$。求解器被配置为查找该函数值从负到正穿越的根。\n4.  求解器的输出将包含事件发生的时间。如果在模拟区间 $[0, 200]$ 内未检测到事件，则意味着没有排斥，分类为 $0$。\n5.  如果检测到事件，$t_{\\mathrm{cross}}$ 是记录的第一个时间。然后根据提供的规则使用该值对排斥类型进行分类：\n    - $t_{\\mathrm{cross}} < 1$ 天：分类 $1$（超急性）。\n    - $1 \\le t_{\\mathrm{cross}} < 30$ 天：分类 $2$（急性）。\n    - $30 \\le t_{\\mathrm{cross}} \\le 200$ 天：分类 $3$（慢性）。\n6.  对所有五个测试案例重复此过程，并收集得到的整数分类。最终输出是这五个整数的列表。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the graft rejection ODE model for five test cases and classifies the outcomes.\n    \"\"\"\n    # Base parameter values as specified in the problem statement.\n    base_params = {\n        's_T': 0.8, 's_B': 0.4,\n        'K_E': 0.5, 'K_T': 0.5,\n        'd_T': 0.3, 'd_B': 0.2,\n        'p_A': 0.6, 'd_A': 0.1,\n        'k_clear': 0.3, 'k_Tkill': 0.2, 'k_base': 0.01,\n        'q_T': 0.05, 'q_A': 0.6,\n        'r_repair': 0.01, 'alpha_remod': 0.002,\n        'D_th': 1.0\n    }\n\n    # Test cases defined by their overrides to the base parameters.\n    test_cases = [\n        # Case 1 (Hyperacute)\n        {'A_0': 3.0},\n        # Case 2 (Acute cellular)\n        {'s_T': 1.2, 'q_T': 0.12, 's_B': 0.2, 'A_0': 0.0},\n        # Case 3 (Chronic)\n        {'s_T': 0.2, 's_B': 0.3, 'q_T': 0.02, 'q_A': 0.05, \n         'p_A': 0.15, 'd_A': 0.15, 'alpha_remod': 0.01, 'A_0': 0.0},\n        # Case 4 (No rejection)\n        {'s_T': 0.08, 's_B': 0.08, 'q_T': 0.005, 'q_A': 0.01, 'p_A': 0.3,\n         'r_repair': 0.05, 'k_base': 0.1, 'A_0': 0.0},\n        # Case 5 (Acute humoral)\n        {'s_B': 1.0, 'p_A': 0.8, 's_T': 0.6, 'A_0': 0.0}\n    ]\n\n    def ode_system(t, y, p):\n        \"\"\"\n        Defines the system of ordinary differential equations.\n        y is the state vector [T, B, A, E, D].\n        p is the dictionary of parameters.\n        \"\"\"\n        T, B, A, E, D = y\n        \n        # Ensure state variables remain non-negative, which they should naturally\n        # due to the model structure, but this is a safeguard.\n        T = max(0, T); B = max(0, B); A = max(0, A); E = max(0, E); D = max(0, D)\n\n        # Michaelis-Menten saturation terms\n        e_saturation = E / (p['K_E'] + E)\n        t_saturation = T / (p['K_T'] + T)\n\n        # Derivatives\n        dT_dt = p['s_T'] * e_saturation - p['d_T'] * T\n        dB_dt = p['s_B'] * e_saturation * t_saturation - p['d_B'] * B\n        dA_dt = p['p_A'] * B - p['d_A'] * A\n        # Antigen expression change includes a factor of E in all terms\n        dE_dt = (-p['k_clear'] * A - p['k_Tkill'] * T - p['k_base']) * E\n        # Damage dynamics\n        dD_dt = (p['q_T'] * T + p['q_A'] * A) * E + p['alpha_remod'] * D - p['r_repair'] * D\n\n        return [dT_dt, dB_dt, dA_dt, dE_dt, dD_dt]\n\n    def damage_threshold_event(t, y, p):\n        \"\"\"Event function to detect when damage D crosses the threshold D_th.\"\"\"\n        return y[4] - p['D_th']\n    \n    # Event should trigger when damage crosses D_th from below.\n    damage_threshold_event.direction = 1  \n    # Do not terminate integration upon event detection.\n    damage_threshold_event.terminal = False \n\n    results = []\n    \n    for case_config in test_cases:\n        # Create a parameter set for the current simulation\n        params = base_params.copy()\n        params.update(case_config)\n\n        # Initial conditions\n        A0 = params.pop('A_0', 0.0) # Extract A0 and remove from main params dict\n        y0 = [0.0, 0.0, A0, 1.0, 0.0]  # T, B, A, E, D\n\n        # Time span for the simulation\n        t_span = [0.0, 200.0]\n\n        # Numerically integrate the ODE system\n        sol = solve_ivp(\n            ode_system, \n            t_span, \n            y0, \n            args=(params,), \n            events=damage_threshold_event,\n            dense_output=True\n        )\n\n        t_cross = None\n        if sol.t_events[0].size > 0:\n            # The first time the threshold is crossed\n            t_cross = sol.t_events[0][0]\n\n        # Apply classification logic\n        if t_cross is None:\n            classification = 0  # No rejection\n        elif t_cross  1.0:\n            classification = 1  # Hyperacute\n        elif 1.0 = t_cross  30.0:\n            classification = 2  # Acute\n        else: # 30.0 = t_cross = 200.0\n            classification = 3  # Chronic\n\n        results.append(classification)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2850420"}]}