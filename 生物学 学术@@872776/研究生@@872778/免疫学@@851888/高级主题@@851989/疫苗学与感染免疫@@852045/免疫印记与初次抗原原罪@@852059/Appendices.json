{"hands_on_practices": [{"introduction": "本练习将介绍一种量化“原始抗原原罪”现象的基本方法。通过分析假设的血凝抑制（HI）滴度数据，你将学习如何计算一个指标，该指标能够捕捉到即使在接种不同亚型疫苗后，针对初次印记病毒亚型的抗体反应不成比例增强的现象。这项练习将抽象的免疫印记概念建立在一个具体的、可测量的数值之上[@problem_id:2856748]。", "problem": "一名成年个体，其童年早期有记录的首次流感感染为H3亚型（最初的印记亚型），接种了与当代H1抗原相匹配的三价灭活流感疫苗。为了量化免疫印记和抗原原罪（OAS）现象，我们使用血凝抑制（HI；Hemagglutination Inhibition）试验来考察疫苗接种后在一组抗原中的血清学增强分配情况。\n\n基本事实：\n- HI滴度定义为能够抑制血凝的最高血清稀释倒数，并以两倍系列稀释法进行测量。因此，如果对于某一给定抗原，接种后滴度相对于接种前滴度增加了$k$倍，那么这种变化可以表示为$\\log_{2}(k)$个“两倍滴度阶”。\n- 对各抗原经过$\\log_{2}$变换的倍数变化进行求和，是量化总增长量的合适方法，因为两倍滴定梯度在对数尺度上是可加的。\n\n现给出某一个体接种疫苗前后HI滴度测量值如下：\n- 最初印记亚型组（三种不同的H3抗原）：\n  - 抗原Alpha：接种前$40$，接种后$320$。\n  - 抗原Beta：接种前$20$，接种后$160$。\n  - 抗原Gamma：接种前$10$，接种后$40$。\n- 疫苗匹配抗原（疫苗中包含的当代H1）：\n  - 抗原V：接种前$20$，接种后$80$。\n\n定义“印记集中比”$R$，用以操作化地衡量接种后增长集中于最初印记亚型相对于疫苗匹配亚型的程度，定义如下：\n1. 对每种抗原，通过计算$\\log_{2}\\!\\big(\\text{post}/\\text{pre}\\big)$，将接种前到接种后的变化转换为两倍滴度阶。\n2. 设$\\Delta I$为印记亚型组（Alpha, Beta, Gamma）中这些两倍滴度阶的总和。\n3. 设$\\Delta V$为疫苗匹配抗原（V）的两倍滴度阶。\n4. 计算$R$为印记组的总两倍滴度阶与疫苗匹配抗原的两倍滴度阶之比，即$R = \\Delta I / \\Delta V$。\n\n根据以上数据计算$R$。请以小数形式表示最终答案，并四舍五入至四位有效数字。答案中不要包含单位或百分号。", "solution": "问题陈述已经过验证，被认为是科学上合理、提法得当且客观的。它为计算所需指标提供了清晰的量化定义和所有必要数据。我们现在开始解题。\n\n问题要求计算“印记集中比”，记为$R$。该比率量化了对印记抗原亚型与疫苗匹配抗原亚型的血清学反应的相对强度。该方法基于血凝抑制（HI）滴度，该滴度通过两倍系列稀释法测量。滴度变化$k$倍在对数尺度上恰当地表示为$\\log_{2}(k)$个“两倍滴度阶”。\n\n首先，我们定义每种抗原的两倍滴度阶变化。设$T_{pre}$为接种前HI滴度，$T_{post}$为接种后HI滴度。单个抗原的两倍滴度阶变化$\\Delta$由下式给出：\n$$\n\\Delta = \\log_{2}\\left(\\frac{T_{post}}{T_{pre}}\\right)\n$$\n\n我们使用所提供的数据，将此公式应用于每种抗原。\n\n对于印记亚型组（H3抗原）：\n1.  抗原Alpha：$T_{pre} = 40$，$T_{post} = 320$。\n    $$\n    \\Delta_{Alpha} = \\log_{2}\\left(\\frac{320}{40}\\right) = \\log_{2}(8) = \\log_{2}(2^{3}) = 3\n    $$\n2.  抗原Beta：$T_{pre} = 20$，$T_{post} = 160$。\n    $$\n    \\Delta_{Beta} = \\log_{2}\\left(\\frac{160}{20}\\right) = \\log_{2}(8) = \\log_{2}(2^{3}) = 3\n    $$\n3.  抗原Gamma：$T_{pre} = 10$，$T_{post} = 40$。\n    $$\n    \\Delta_{Gamma} = \\log_{2}\\left(\\frac{40}{10}\\right) = \\log_{2}(4) = \\log_{2}(2^{2}) = 2\n    $$\n\n接下来，对于疫苗匹配抗原（H1）：\n1.  抗原V：$T_{pre} = 20$，$T_{post} = 80$。\n    $$\n    \\Delta_{V} = \\log_{2}\\left(\\frac{80}{20}\\right) = \\log_{2}(4) = \\log_{2}(2^{2}) = 2\n    $$\n\n问题将$\\Delta I$定义为印记亚型组的两倍滴度阶的总和。因此：\n$$\n\\Delta I = \\Delta_{Alpha} + \\Delta_{Beta} + \\Delta_{Gamma} = 3 + 3 + 2 = 8\n$$\n\n$\\Delta V$值被定义为疫苗匹配抗原的两倍滴度阶。根据我们上面的计算：\n$$\n\\Delta V = \\Delta_{V} = 2\n$$\n\n最后，印记集中比$R$计算为$\\Delta I$与$\\Delta V$之比：\n$$\nR = \\frac{\\Delta I}{\\Delta V} = \\frac{8}{2} = 4\n$$\n\n问题要求答案以小数形式表示，并四舍五入到四位有效数字。确切值为$4$。为用四位有效数字表示，我们将其写作$4.000$。", "answer": "$$\\boxed{4.000}$$", "id": "2856748"}, {"introduction": "超越了整体滴度测量，这项练习将挑战你像一位现代免疫学家一样思考。你将评估一项深度突变扫描（DMS）实验的分析策略，这是一种能以氨基酸分辨率绘制抗体特异性的强大技术。本练习的目标是设计一个严谨的分析方案，以识别原始印记反应的“足迹”，同时控制各种混杂因素，这是现代病毒学研究中的一项关键技能[@problem_id:2856763]。", "problem": "一家免疫学实验室希望检验一个假设：用一种漂移的病毒变体进行加强免疫，会优先召回靶向与初始免疫株相同表位足迹的记忆B细胞特异性，这一现象被称为免疫印记或抗原原罪。他们使用深度突变扫描（DMS; Deep Mutational Scanning）来量化血清如何与该变体的受体结合域（RBD; receptor-binding domain）结合，具体方法如下。\n\n他们构建了一个该变体RBD的全面单氨基酸突变文库，将其展示在酵母上，并在用多克隆血清筛选前后收集深度测序计数。对于在位点$i$处发生的每一种到残基$a$的氨基酸替换，他们量化了一个逃逸分数$e_{i,a}$。该分数来自于在血清吸附后，该变体相对于模拟选择对照组的富集或耗尽，并且是在过滤掉那些与病毒受体结合能力低于活力阈值的变体之后得到的。然后，他们定义了一个位点水平血清逃逸得分$s_{i}=\\sum_{a} e_{i,a}$和一个血清逃逸谱向量$\\mathbf{s}=(s_{1},s_{2},\\dots,s_{L})$，该向量涵盖了RBD上$L$个表面可及的位点。\n\n他们有三种样本类型：\n- 来自2年前用毒株$X$进行初始免疫的个体，在加强免疫前的血清，记为时间$t=0$，其位点得分为$s_{i}^{(0)}$。\n- 来自同一批个体，用漂移毒株$Y$加强免疫后的血清，记为时间$t=1$，其位点得分为$s_{i}^{(1)}$。\n- 来自用$Y$进行初次免疫的（对毒株X）初免个体的血清，记为时间$t=1$, 其位点得分为$s_{i}^{(1,\\text{naive})}$。\n\n来自原始队列的独立单克隆图谱分析先前已经定义了一个“原始表位足迹”$S_{\\text{orig}}\\subset\\{1,\\dots,L\\}$，它是被毒株$X$引发的主要中和性单克隆抗体特异性所接触的RBD位点集合。另一个集合$S_{\\text{other}}$包含了已知在未免疫宿主中由$Y$引发的正交单克隆抗体所接触的位点。结构分析提供了一个二元表面暴露掩码$M\\subset\\{1,\\dots,L\\}$，而在没有血清的情况下进行的深度突变扫描为每个位点$i$提供了一个突变耐受性得分$\\tau_{i}$（越高的$\\tau_{i}$意味着在不破坏表达或受体结合的情况下，可以耐受越多的替换）。\n\n根据克隆选择和亲和力成熟的基本原理，血清结合是抗体克隆的加权混合物，而位点$i$的DMS逃逸反映了该混合物对$i$处扰动的边际敏感性，这一关系受到总抗体浓度和$i$的内在突变耐受性的混淆。该实验室希望利用这些数据来 (i) 绘制DMS的血清逃逸谱，以及 (ii) 检验用$Y$加强免疫是否相对于适当的零假设富集了$S_{\\text{orig}}$内的逃逸，从而与免疫印记的假设一致。\n\n下列哪种分析设计最恰当地使用DMS来识别加强免疫后原始表位足迹的富集，同时控制了全局滴度效应和位点特异性混杂因素，并区分了印记反应和初次应答？\n\nA. 计算加强免疫后的总逃逸量$\\sum_{i} s_{i}^{(1)}$，并将其与$\\sum_{i} s_{i}^{(0)}$和$\\sum_{i} s_{i}^{(1,\\text{naive})}$进行比较。如果$\\sum_{i} s_{i}^{(1)}$最大，则断定由于印记效应导致$S_{\\text{orig}}$富集。\n\nB. 将每个血清逃逸谱归一化到单位$L^{1}$范数，即$\\tilde{\\mathbf{s}}^{(t)}=\\mathbf{s}^{(t)}/\\sum_{i}s_{i}^{(t)}$，剔除$i\\notin M$的位点，并通过比较$\\sum_{i\\in S_{\\text{orig}}}\\tilde{s}_{i}^{(1)}-\\sum_{i\\in S_{\\text{orig}}}\\tilde{s}_{i}^{(0)}$与一个零分布来检验$S_{\\text{orig}}$内的逃逸富集。该零分布是通过重复抽样与$S_{\\text{orig}}$在大小、表面暴露和$\\tau_{i}$上匹配的位点集生成的。此外，要求在$\\tilde{\\mathbf{s}}^{(1,\\text{naive})}$中相同的统计量没有升高。将富集的位点映射到结构上，以验证足迹的空间邻接性，并确认在$S_{\\text{other}}$中没有可比的富集。\n\nC. 计算毒株$X$和$Y$之间的抗原距离$d$（作为氨基酸序列的汉明距离），并将$d$与不同个体间的$\\sum_{i\\in S_{\\text{orig}}} s_{i}^{(1)}$进行相关性分析。正相关表示存在印记效应，因为更大的$d$应该更强烈地召回原始特异性。\n\nD. 找出加强免疫后单个逃逸最显著的位点$i^{\\star}=\\arg\\max_{i} s_{i}^{(1)}$，如果$i^{\\star}\\in S_{\\text{orig}}$，则宣布存在印记效应；否则，拒绝印记效应。这种方法避免了归一化，并通过关注主要位点来解决异质性问题。\n\nE. 计算$\\mathbf{s}^{(1)}$与一个指示向量$\\mathbf{1}_{S_{\\text{orig}}}$之间的余弦相似度，如果相似度从$t=0$到$t=1$增加，则接受印记效应，无需进一步控制，因为余弦相似度在构建上就消除了滴度依赖性。", "solution": "该问题要求评估几种分析设计，以检验免疫印记（也称为抗原原罪）的假设。该假设的核心是，用一种漂移的病毒株（$Y$）进行加强免疫将优先召回靶向原始免疫株（$X$）表位足迹的记忆B细胞。最佳的分析设计必须能够检测到这种优先召回，同时对几个特定的混杂因素具有鲁棒性，并能利用可用的对照数据。\n\n根据问题陈述，一个有效的分析设计必须满足以下要求：\n1.  它必须专门检验针对原始表位足迹$S_{\\text{orig}}$的抗体应答是否富集。\n2.  它必须控制全局效应，例如总抗体浓度（滴度）的变化，这会影响所有逃逸分数。\n3.  它必须控制位点特异性混杂因素，特别是位点的内在突变耐受性$\\tau_{i}$，这会独立于抗体结合而影响逃逸分数。\n4.  它必须能够区分印记效应（记忆应答的召回）和对新毒株$Y$的标准初次应答。这要求正确使用初次应答对照组的数据$s_{i}^{(1,\\text{naive})}$。\n5.  它必须使用加强免疫前的数据$s_{i}^{(0)}$作为基线，以量化加强免疫后的变化。\n\n让我们根据这些标准来评估每个选项。\n\n**A. 计算加强免疫后的总逃逸量$\\sum_{i} s_{i}^{(1)}$，并将其与$\\sum_{i} s_{i}^{(0)}$和$\\sum_{i} s_{i}^{(1,\\text{naive})}$进行比较。如果$\\sum_{i} s_{i}^{(1)}$最大，则断定由于印记效应导致$S_{\\text{orig}}$富集。**\n\n这种方法存在几个缺陷。首先，总逃逸分数$\\sum_{i} s_{i}$是血清总结合抑制活性的一个代理指标。在加强免疫后（$t=1$ vs $t=0$），这个总和的增加是预料之中的，这仅仅是因为总抗体滴度的增加，这种现象被称为记忆性应答。该方法没有对这种全局滴度效应进行归一化，因此无法区分应答*特异性*的变化和其*强度*的简单增加。其次，它对所有位点$i$求和，而不仅仅是原始表位足迹$S_{\\text{orig}}$中的位点。从全局总和的变化推断出$S_{\\text{orig}}$内部的特异性富集，在逻辑上是不合理的；这种增加可能完全由$S_{\\text{orig}}$之外的位点驱动。因此，该方法未能特异性地检验假设，并且受到滴度的混淆。\n\n**结论：不正确。**\n\n**B. 将每个血清逃逸谱归一化到单位$L^{1}$范数，即$\\tilde{\\mathbf{s}}^{(t)}=\\mathbf{s}^{(t)}/\\sum_{i}s_{i}^{(t)}$，剔除$i\\notin M$的位点，并通过比较$\\sum_{i\\in S_{\\text{orig}}}\\tilde{s}_{i}^{(1)}-\\sum_{i\\in S_{\\text{orig}}}\\tilde{s}_{i}^{(0)}$与一个零分布来检验$S_{\\text{orig}}$内的逃逸富集。该零分布是通过重复抽样与$S_{\\text{orig}}$在大小、表面暴露和$\\tau_{i}$上匹配的位点集生成的。此外，要求在$\\tilde{\\mathbf{s}}^{(1,\\text{naive})}$中相同的统计量没有升高。将富集的位点映射到结构上，以验证足迹的空间邻接性，并确认在$S_{\\text{other}}$中没有可比的富集。**\n\n这种设计在方法上是合理且全面的。\n1.  **归一化**：$L^{1}$归一化，$\\tilde{\\mathbf{s}}^{(t)}=\\mathbf{s}^{(t)}/\\sum_{i}s_{i}^{(t)}$，将原始逃逸分数转换为每个位点的相对分数或比例。这有效地控制了全局滴度，因为所有$s_{i}^{(t)}$被一个常数因子进行统一缩放不会改变归一化后的谱$\\tilde{\\mathbf{s}}^{(t)}$。这解决了滴度混淆的问题。\n2.  **假设检验**：被检验的统计量是总逃逸信号中落在原始表位内的*比例*的变化，即$\\sum_{i\\in S_{\\text{orig}}}\\tilde{s}_{i}^{(1)}-\\sum_{i\\in S_{\\text{orig}}}\\tilde{s}_{i}^{(0)}$。这直接量化了多克隆抗体特异性向原始足迹的转变，这正是印记假设的核心主张。它正确地使用了加强免疫前的数据作为基线。\n3.  **控制位点特异性混杂因素**：使用从大小、表面暴露($M$)和突变耐受性($\\tau_{i}$)相匹配的位点集生成的零分布是一个关键且复杂的控制手段。它确保在$S_{\\text{orig}}$中观察到的任何富集都不是因为$S_{\\text{orig}}$中的位点恰好（例如）对突变具有更高的内在耐受性。这稳健地控制了已知的位点特异性混杂因素。\n4.  **控制初次应答**：要求在初次应答对照组($\\tilde{\\mathbf{s}}^{(1,\\text{naive})}$)中没有观察到同样的富集是至关重要的。它将这种效应分离出来，确定其为对预先存在的记忆应答的特异性召回，从而与可能偶然靶向$S_{\\text{orig}}$中某些位点的新生应答区分开来。\n5.  **进一步验证**：最后对空间邻接性和在$S_{\\text{other}}$（毒株Y特有的表位）中缺乏富集的检查，为这一发现提供了强有力的正交验证。\n该方法正确地解决了严格检验该假设的所有要求。\n\n**结论：正确。**\n\n**C. 计算毒株$X$和$Y$之间的抗原距离$d$（作为氨基酸序列的汉明距离），并将$d$与不同个体间的$\\sum_{i\\in S_{\\text{orig}}} s_{i}^{(1)}$进行相关性分析。正相关表示存在印记效应，因为更大的$d$应该更强烈地召回原始特异性。**\n\n这个提议有根本性的缺陷。 priming 株$X$和 booster 株$Y$之间的抗原距离$d$对于实验中的所有个体来说都是一个固定的常数。我们无法计算一个变量（在不同个体间变化的逃逸总和）和一个常数（$d$）之间的相关性。因此，提议的统计分析是不可能进行的。此外，该方法使用原始的逃逸分数总和，未能控制滴度，并且忽略了使用加强免疫前的基线或初次应答对照数据。\n\n**结论：不正确。**\n\n**D. 找出加强免疫后单个逃逸最显著的位点$i^{\\star}=\\arg\\max_{i} s_{i}^{(1)}$，如果$i^{\\star}\\in S_{\\text{orig}}$，则宣布存在印记效应；否则，拒绝印记效应。这种方法避免了归一化，并通过关注主要位点来解决异质性问题。**\n\n这是一种极度的过度简化。一个表位是一个通常由多个氨基酸位点组成的表面区域。将整个多克隆应答简化为单个“赢者通吃”的位点，丢弃了绝大多数数据，并忽略了表位的分布式特性。这种方法不稳健，并且极易受到噪声的影响；单个最大值位点可能由于测量误差或高的内在突变耐受性($\\tau_i$)而成为异常值。声称避免归一化是一个优点是错误的；这种方法仍然受到滴度和位点特异性属性的混淆。它也未能整合基线和初次应答对照数据，使得任何结论都不可靠。\n\n**结论：不正确。**\n\n**E. 计算$\\mathbf{s}^{(1)}$与一个指示向量$\\mathbf{1}_{S_{\\text{orig}}}$之间的余弦相似度，如果相似度从$t=0$到$t=1$增加，则接受印记效应，无需进一步控制，因为余弦相似度在构建上就消除了滴度依赖性。**\n\n这种方法有一些优点，但也有关键的缺陷。计算余弦相似度，$\\text{sim}(\\mathbf{s}, \\mathbf{v}) = (\\mathbf{s} \\cdot \\mathbf{v}) / (\\|\\mathbf{s}\\|_{2} \\|\\mathbf{v}\\|_{2})$，确实控制了向量的大小，从而提供了一种针对滴度效应的归一化形式。通过比较$t=1$和$t=0$时的相似度，它正确地使用了加强免疫前的数据作为基线。然而，它的主要缺陷在其描述中就已说明：“无需进一步控制”。它未能控制像突变耐受性$\\tau_i$这样的位点特异性属性。如果$S_{\\text{orig}}$内的位点恰好对突变高度耐受，它们可能会因为与抗体靶向无关的原因而具有较高的$s_i$值，这会人为地夸大余弦相似度。最重要的是，它完全忽略了初次应答对照组的数据($s_{i}^{(1, \\text{naive})}$)。没有这个对照，就无法确定对$S_{\\text{orig}}$的增强关注是记忆召回的一个特有特征，还是对毒株$Y$的任何免疫应答的普遍特征。选项B中的方法更为优越，因为它明确地控制了这两个关键因素。\n\n**结论：不正确。**", "answer": "$$\\boxed{B}$$", "id": "2856763"}, {"introduction": "最后的这项练习将免疫印记的概念整合到一个计算框架中，并将其应用于SARS-CoV-2这一紧迫的实例。你将实现一个混合模型，该模型将血清中和作用视为“祖先株印记”和“变异株特异性”抗体组分的组合。通过将此模型与中和数据进行拟合，你将能够估计印记反应的相对贡献，从而展示如何利用定量模型来解析复杂的免疫学现象[@problem_id:2856726]。", "problem": "考虑严重急性呼吸综合征冠状病毒2 (SARS-CoV-2) 的血清中和作用源于由免疫印迹塑造的两种抗体特异性：一个祖先印迹组分和一个Omicron特异性组分。抗原原罪 (OAS) 理论提出，先前的暴露会使记忆反应偏向于与首次遇到的表位相似的表位，我们将其编码为作用于两个免疫学组分上的混合权重。我们采用一个简化的、有机制基础的模型，该模型基于以下基本假设：(i) 针对给定变体的总中和效价在独立的抗体特异性之间近似可加，以及 (ii) 在固定中和阈值下，稀释滴度的倒数与总中和效价成正比。在这些假设下，针对一个变体的预期滴度被建模为多个固定组分效能的非负线性组合。\n\n设有两个组分：祖先印迹组分，索引为 $A$；Omicron特异性组分，索引为 $O$。设有 $V$ 个变体，索引为 $v \\in \\{1,2,\\dots,V\\}$。令 $e_A(v) \\ge 0$ 和 $e_O(v) \\ge 0$ 表示两个组分针对变体 $v$ 的固定、已知的相对中和效能（无量纲），令 $w_A \\ge 0$ 和 $w_O \\ge 0$ 表示满足 $w_A + w_O = 1$ 的未知混合权重。令 $s  0$ 为一个血清特异性尺度因子（与总抗体浓度成正比），该因子也未知。对于在相同的 $V$ 个变体上测量得到的观测滴度向量 $\\mathbf{y} \\in \\mathbb{R}_{\\ge 0}^V$，模型假设\n$$\ny_v \\approx s \\left( w_A \\, e_A(v) + w_O \\, e_O(v) \\right), \\quad \\text{for } v = 1,\\dots,V,\n$$\n其偏差归因于测量噪声。估计的目标是通过最小化残差平方和\n$$\n\\mathrm{SSE}(w_O, s) = \\sum_{v=1}^{V} \\left( y_v - s \\left( (1 - w_O) e_A(v) + w_O e_O(v) \\right) \\right)^2,\n$$\n来确定 $w_O$（并由此确定 $w_A = 1 - w_O$）和冗余尺度 $s$，约束条件为 $w_O \\in [0,1]$ 和 $s \\ge 0$。向量 $e_A$ 和 $e_O$ 假设为已知且非共线，这确保了混合结构在尺度 $s$ 的意义下的可识别性。\n\n你的任务是编写一个程序，对于一对固定的效能向量 $e_A$ 和 $e_O$ 以及一组观测到的多变体滴度向量 $\\{\\mathbf{y}^{(i)}\\}$（每个向量对应一个不同的血清），通过解决上述约束最小二乘问题，来估计每个血清的Omicron特异性混合权重 $\\hat{w}_O^{(i)}$。请实现以下计算方法：对每个血清，在 $w_O \\in [0,1]$ 上进行搜索，并对每个候选的 $w_O$，以闭合形式计算出能在 $s \\ge 0$ 范围内最小化 $\\mathrm{SSE}(w_O, s)$ 的最优 $\\hat{s}(w_O)$。然后，选择能够最小化 $\\mathrm{SSE}(w_O, \\hat{s}(w_O))$ 的 $\\hat{w}_O$。\n\n允许用于推理的基本原理：独立抗体中和效价的可加性、中和滴度与总中和效价之间的比例关系、非负混合建模以及欧几里得空间中的最小二乘投影。\n\n使用以下固定的效能向量（按变体顺序排列：Wuhan-Hu-1, Delta, Omicron BA.1, Omicron BA.5）：\n$$\ne_A = [1.0, \\, 0.7, \\, 0.1, \\, 0.2], \\quad e_O = [0.25, \\, 0.3, \\, 1.0, \\, 0.9].\n$$\n\n测试套件：对于每个血清 $i \\in \\{1,2,3,4,5\\}$，观测到的多变体滴度向量 $\\mathbf{y}^{(i)}$（单位为稀释倍数的倒数；在建模中作为无量纲比率处理，因此无单位）如下：\n$$\n\\mathbf{y}^{(1)} = [1000, \\, 700, \\, 100, \\, 200], \\\\\n\\mathbf{y}^{(2)} = [200, \\, 240, \\, 800, \\, 720], \\\\\n\\mathbf{y}^{(3)} = [630, \\, 486, \\, 414, \\, 432], \\\\\n\\mathbf{y}^{(4)} = [200, \\, 190, \\, 410, \\, 380], \\\\\n\\mathbf{y}^{(5)} = [1020, \\, 744, \\, 336, \\, 408].\n$$\n\n对于数值实现，你必须强制执行约束 $w_O \\in [0,1]$ 和 $s \\ge 0$。程序必须为每个血清 $i$ 输出估计的Omicron特异性权重 $\\hat{w}_O^{(i)}$，结果应为 $[0,1]$ 范围内四舍五入到三位小数的小数。\n\n最终输出格式：你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[r_1, r_2, r_3, r_4, r_5]$），其中每个 $r_i$ 是 $\\hat{w}_O^{(i)}$ 的三位小数表示形式。\n\n程序必须使用上面提供的精确效能向量和滴度向量，并且不得要求任何用户输入。", "solution": "问题陈述将首先进行严格的验证。\n\n步骤1：提取已知条件。\n问题提供了以下数据、定义和约束：\n- 针对变体 $v$ 的观测滴度 $y_v$ 的模型：$y_v \\approx s ( w_A e_A(v) + w_O e_O(v) )$。\n- 两种抗体组分：祖先印迹组分 ($A$) 和 Omicron特异性组分 ($O$)。\n- 针对 $V$ 个变体的组分效能：$e_A(v) \\ge 0$ 和 $e_O(v) \\ge 0$。\n- 混合权重：$w_A \\ge 0$，$w_O \\ge 0$，约束条件为 $w_A + w_O = 1$。这意味着 $w_O \\in [0,1]$。\n- 一个血清特异性尺度因子：$s  0$，在优化问题中放宽为 $s \\ge 0$。\n- 对于给定的血清，观测到的滴度向量：$\\mathbf{y} \\in \\mathbb{R}_{\\ge 0}^V$。\n- 目标是找到 $w_O$ 和 $s$ 以最小化残差平方和：\n$$\n\\mathrm{SSE}(w_O, s) = \\sum_{v=1}^{V} \\left( y_v - s \\left( (1 - w_O) e_A(v) + w_O e_O(v) \\right) \\right)^2\n$$\n- 最小化问题的约束条件是 $w_O \\in [0,1]$ 和 $s \\ge 0$。\n- 效能向量 $\\mathbf{e}_A$ 和 $\\mathbf{e}_O$ 假设为已知且非共线。\n- 针对变体（Wuhan-Hu-1, Delta, Omicron BA.1, Omicron BA.5）的固定效能向量：\n$$\n\\mathbf{e}_A = [1.0, \\, 0.7, \\, 0.1, \\, 0.2] \\\\\n\\mathbf{e}_O = [0.25, \\, 0.3, \\, 1.0, \\, 0.9]\n$$\n- 用于估计的五个观测到的多变体滴度向量：\n$$\n\\mathbf{y}^{(1)} = [1000, \\, 700, \\, 100, \\, 200] \\\\\n\\mathbf{y}^{(2)} = [200, \\, 240, \\, 800, \\, 720] \\\\\n\\mathbf{y}^{(3)} = [630, \\, 486, \\, 414, \\, 432] \\\\\n\\mathbf{y}^{(4)} = [200, \\, 190, \\, 410, \\, 380] \\\\\n\\mathbf{y}^{(5)} = [1020, \\, 744, \\, 336, \\, 408]\n$$\n- 一种指定的计算方法：对每个血清，在 $w_O \\in [0,1]$ 上进行搜索，并对每个候选的 $w_O$，以闭合形式计算最优的 $\\hat{s}(w_O)$。然后，找到能最小化所得目标函数的 $\\hat{w}_O$。\n- 每个血清 $i$ 的输出是估计的Omicron特异性权重 $\\hat{w}_O^{(i)}$，四舍五入到三位小数。\n\n步骤2：使用提取的已知条件进行验证。根据指定的标准对问题进行评估：\n- **科学基础：** 该问题基于一个简化但有机制合理性的血清中和模型，借鉴了免疫学中的既定概念，如免疫印迹和抗原原罪。中和效价的可加性以及滴度的比例性假设是该领域的标准简化方法。该模型是一种非负线性混合建模，是一种合理的数学和统计技术。对于定量建模练习而言，该问题具有科学基础。\n- **适定性：** 该问题是一个约束最小二乘估计问题。目标函数对于 $s$ 是二次的，对于 $w_O$ 是非线性的。约束条件 $w_O \\in [0,1]$ 和 $s \\ge 0$ 定义了一个用于优化的紧致凸集。问题陈述效能向量 $\\mathbf{e}_A$ 和 $\\mathbf{e}_O$ 非共线，这一点可通过检查验证，并确保了混合组分的可识别性（在冗余尺度参数 $s$ 的意义下），从而防止退化解。因此，预期存在唯一最小值。\n- **客观性：** 该问题以精确、形式化的数学语言陈述，没有主观或模糊的术语。\n- **其他缺陷：** 该问题未违反任何列出的无效标准。它是自洽的、逻辑一致的，并且在计算上是可行的。所提供的数据在数值上是一致且合理的。\n\n步骤3：结论与行动。该问题被认为是有效的。将开发并提出一个解决方案。\n\n任务是通过最小化残差平方和 ($\\mathrm{SSE}$) 来为每个给定的血清向量 $\\mathbf{y}^{(i)}$ 估计参数 $w_O$ 和 $s$。预测滴度向量 $\\hat{\\mathbf{y}}$ 的模型方程可以使用一个依赖于混合权重 $w_O$ 的复合效能向量 $\\mathbf{E}(w_O)$ 来写出：\n$$ \\mathbf{E}(w_O) = (1 - w_O)\\mathbf{e}_A + w_O\\mathbf{e}_O $$\n于是模型可以紧凑地写作 $\\hat{\\mathbf{y}} = s \\mathbf{E}(w_O)$。目标函数是最小化残差向量的欧几里得范数的平方：\n$$ \\mathrm{SSE}(w_O, s) = \\|\\mathbf{y} - s \\mathbf{E}(w_O)\\|_2^2 = \\sum_{v=1}^{V} \\left( y_v - s E_v(w_O) \\right)^2 $$\n我们必须在 $w_O \\in [0,1]$ 和 $s \\ge 0$ 的约束下最小化这个函数。遵循指定的方法，我们采用一种嵌套优化策略。首先，对于一个固定的 $w_O$ 值，我们找到能最小化 $\\mathrm{SSE}(w_O, s)$ 的最优尺度因子 $\\hat{s}(w_O)$。这是一个关于参数 $s$ 的标准线性最小二乘问题。为了找到最小值，我们求 $\\mathrm{SSE}$ 关于 $s$ 的偏导数，并令其为零：\n$$ \\frac{\\partial \\mathrm{SSE}}{\\partial s} = \\sum_{v=1}^{V} 2 \\left( y_v - s E_v(w_O) \\right) \\left( -E_v(w_O) \\right) = 0 $$\n$$ \\sum_{v=1}^{V} y_v E_v(w_O) - s \\sum_{v=1}^{V} E_v(w_O)^2 = 0 $$\n解出 $s$ 得到最优值，我们将其记为 $\\hat{s}(w_O)$：\n$$ \\hat{s}(w_O) = \\frac{\\sum_{v=1}^{V} y_v E_v(w_O)}{\\sum_{v=1}^{V} E_v(w_O)^2} = \\frac{\\mathbf{y} \\cdot \\mathbf{E}(w_O)}{\\mathbf{E}(w_O) \\cdot \\mathbf{E}(w_O)} $$\n必须满足约束 $s \\ge 0$。鉴于 $\\mathbf{y} \\ge 0$, $\\mathbf{e}_A \\ge 0$, $\\mathbf{e}_O \\ge 0$, 且 $w_O \\in [0,1]$，复合向量 $\\mathbf{E}(w_O)$ 是逐元素非负的。因此，分子 $\\mathbf{y} \\cdot \\mathbf{E}(w_O)$ 是非负的。分母 $\\|\\mathbf{E}(w_O)\\|_2^2$ 是严格为正的，因为 $\\mathbf{e}_A$ 和 $\\mathbf{e}_O$ 非共线且非零向量。所以，最优的 $\\hat{s}(w_O)$ 总是非负的，约束条件被自动满足。\n\n有了 $\\hat{s}(w_O)$ 的闭合形式解，我们将其代回到目标函数中，该函数现在变成一个仅关于 $w_O$ 的函数：\n$$ f(w_O) = \\mathrm{SSE}(w_O, \\hat{s}(w_O)) = \\sum_{v=1}^{V} \\left( y_v - \\hat{s}(w_O) E_v(w_O) \\right)^2 $$\n问题现在被简化为一个一维优化问题：\n$$ \\hat{w}_O = \\arg\\min_{w_O \\in [0,1]} f(w_O) $$\n这是一个关于 $w_O$ 的非线性但连续且良态的函数。按照规定，需要在区间 $[0,1]$ 上进行搜索。这将通过使用一个针对一维有界函数的数值优化程序在计算上实现，该程序能高效地执行此搜索，以找到最小化 $f(w_O)$ 的 $w_O$ 值。\n\n对于每个血清 $\\mathbf{y}^{(i)}$，我们将定义目标函数 $f(w_O)$ 并使用此过程找到最优的 $\\hat{w}_O^{(i)}$。最终结果将按要求四舍五入到三位小数。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves for the Omicron-specific mixture weight w_O for multiple serum samples\n    by minimizing a constrained least squares problem.\n    \"\"\"\n    # Fixed efficacy vectors for variants (Wuhan-Hu-1, Delta, Omicron BA.1, Omicron BA.5)\n    e_A = np.array([1.0, 0.7, 0.1, 0.2])\n    e_O = np.array([0.25, 0.3, 1.0, 0.9])\n\n    # Observed multi-variant titer vectors for 5 serum samples\n    test_cases = [\n        np.array([1000, 700, 100, 200]),    # Serum 1\n        np.array([200, 240, 800, 720]),    # Serum 2\n        np.array([630, 486, 414, 432]),    # Serum 3\n        np.array([200, 190, 410, 380]),    # Serum 4\n        np.array([1020, 744, 336, 408]),   # Serum 5\n    ]\n\n    estimated_weights = []\n\n    for y_obs in test_cases:\n        \n        def objective_function(w_o, y, e_A_vec, e_O_vec):\n            \"\"\"\n            Calculates the Sum of Squared Errors (SSE) for a given w_o.\n\n            Args:\n                w_o (float): The Omicron-specific mixture weight, w_O.\n                y (np.ndarray): The observed titer vector.\n                e_A_vec (np.ndarray): The ancestral-imprinted efficacy vector.\n                e_O_vec (np.ndarray): The Omicron-specific efficacy vector.\n\n            Returns:\n                float: The sum of squared errors.\n            \"\"\"\n            # Calculate the composite efficacy vector E(w_o)\n            # E(w_o) = (1 - w_o) * e_A + w_o * e_O\n            e_composite = (1 - w_o) * e_A_vec + w_o * e_O_vec\n\n            # Calculate the optimal scale factor s_hat(w_o) in closed form.\n            # s_hat = (y . E) / (E . E)\n            numerator = np.dot(y, e_composite)\n            denominator = np.dot(e_composite, e_composite)\n\n            # Avoid division by zero, though unlikely with non-collinear e_A and e_O\n            if denominator == 0:\n                # If E is a zero vector, s can be anything, but SSE is ||y||^2.\n                # If E is not zero but orthogonal to y, s_hat is 0.\n                s_hat = 0.0\n            else:\n                s_hat = numerator / denominator\n\n            # Calculate the predicted titer vector y_hat\n            y_pred = s_hat * e_composite\n\n            # Calculate the Sum of Squared Errors\n            sse = np.sum((y - y_pred)**2)\n            \n            return sse\n\n        # Perform the 1D constrained optimization to find the best w_o\n        # The search for w_o is bounded in the interval [0, 1].\n        result = minimize_scalar(\n            objective_function,\n            args=(y_obs, e_A, e_O),\n            bounds=(0, 1),\n            method='bounded'\n        )\n\n        w_o_hat = result.x\n        \n        # Round the result to three decimal places and append\n        estimated_weights.append(round(w_o_hat, 3))\n\n    # Format the final output string as specified\n    output_str = f\"[{','.join(f'{w:.3f}' for w in estimated_weights)}]\"\n    print(output_str)\n\nsolve()\n```", "id": "2856726"}]}