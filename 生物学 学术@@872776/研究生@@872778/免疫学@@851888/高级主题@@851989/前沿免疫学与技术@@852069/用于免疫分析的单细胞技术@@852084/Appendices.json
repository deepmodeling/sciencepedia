{"hands_on_practices": [{"introduction": "成功的单细胞研究始于精心的实验设计。一个核心问题是：为了可靠地分析目标细胞群体，我们需要捕获多少细胞？这个实践练习将引导您完成一项关键的统计计算，特别是当研究对象是稀有细胞群体时，这对于确保下游分析的统计功效至关重要[@problem_id:2888909]。", "problem": "一项基于液滴的单细胞RNA测序 (scRNA-seq) 实验旨在从实体组织中捕获一个具有代表性的免疫细胞样本，其中一个稀有细胞群的预期比例为 $f = 0.001$。假设细胞捕获事件相对于细胞身份是独立且无偏的，双细胞可以忽略不计，并且在捕获的样本中 $f$ 是恒定的。设 $X$ 为在 $n$ 个捕获细胞中观察到的稀有细胞数。仅使用二项模型和稀有事件的泊松近似的基本定义，确定最小整数 $n$，使得观察到至少 $k = 10$ 个稀有细胞的概率满足 $\\mathbb{P}(X \\geq 10) \\geq 0.95$。请明确陈述您的建模假设。报告满足该标准的最小整数 $n$。最终答案中不要包含单位。", "solution": "首先将对问题陈述的科学性和逻辑完整性进行验证。\n\n步骤1：提取已知条件\n- 稀有细胞群的预期比例：$f = 0.001$。\n- 捕获的细胞数：$n$。\n- 观察到的稀有细胞数的随机变量：$X$。\n- 假设：细胞捕获事件是独立的且无偏的；双细胞可以忽略不计；$f$ 是恒定的。\n- 待用模型：二项模型和泊松近似。\n- 目标观察到的稀有细胞数：至少 $k = 10$。\n- 概率标准：$\\mathbb{P}(X \\geq 10) \\geq 0.95$。\n- 目标：确定满足该标准的最小整数 $n$。\n\n步骤2：使用提取的已知条件进行验证\n- **具有科学依据**：该问题描述了单细胞基因组学中一个标准的实验设计计算。使用二项模型进行抽样及其对稀有事件的泊松近似，是此背景下基本且正确的统计实践。所提供的参数（$f=0.001$, $k=10$）是现实的。\n- **提法恰当**：该问题在数学上是明确定义的。它要求找到满足特定概率不等式的最小整数 $n$，对此存在唯一解。\n- **客观性**：问题以精确、定量的术语陈述，没有歧义或主观内容。\n\n步骤3：结论与行动\n问题被认为是有效的，因为它具有科学依据、提法恰当且客观。现在将推导解答。\n\n在 $n$ 个总捕获细胞中观察到的稀有细胞数 $X$ 是一个随机变量。每次细胞捕获都是一次独立的伯努利试验，成功（捕获一个稀有细胞）的概率为 $p = f = 0.001$。试验总次数为 $n$。因此，$X$ 服从二项分布：\n$$X \\sim \\text{Binomial}(n, p)$$\n其概率质量函数由 $\\mathbb{P}(X=j) = \\binom{n}{j} p^j (1-p)^{n-j}$ 给出。\n\n问题要求使用泊松近似，这在这里是合适的，因为试验次数 $n$ 预计很大，而成功概率 $p$ 很小。二项分布可以用参数为 $\\lambda$ 的泊松分布来近似，$\\lambda$ 等于成功的期望次数：\n$$\\lambda = E[X] = np$$\n因此，我们将 $X$ 建模为：\n$$X \\approx \\text{Poisson}(\\lambda)$$\n其中 $\\lambda = n \\times 0.001$。在此近似下，概率质量函数为 $\\mathbb{P}(X=j) \\approx \\frac{e^{-\\lambda}\\lambda^j}{j!}$。\n\n问题是找到最小整数 $n$，使得观察到至少 $k=10$ 个稀有细胞的概率不小于 $0.95$：\n$$\\mathbb{P}(X \\geq 10) \\geq 0.95$$\n处理其互补事件 $\\mathbb{P}(X  10)$ 更为方便。该不等式可以重写为：\n$$1 - \\mathbb{P}(X  10) \\geq 0.95$$\n$$\\mathbb{P}(X \\leq 9) \\leq 0.05$$\n使用泊松近似，该条件为：\n$$\\sum_{j=0}^{9} \\frac{e^{-\\lambda}\\lambda^j}{j!} \\leq 0.05$$\n令 $F(\\lambda; m) = \\sum_{j=0}^{m} \\frac{e^{-\\lambda}\\lambda^j}{j!}$ 表示参数为 $\\lambda$ 的泊松分布的累积分布函数 (CDF)。对于固定的 $m$，$F(\\lambda; m)$ 是关于 $\\lambda$ 的单调递减函数。因此，对于所有大于或等于某个临界值 $\\lambda_{crit}$ 的 $\\lambda$，不等式 $F(\\lambda; 9) \\leq 0.05$ 都成立，其中 $F(\\lambda_{crit}; 9) = 0.05$。\n\n为了找到 $\\lambda_{crit}$，我们使用将泊松CDF与上不完全伽马函数正则化形式联系起来的基本恒等式，而后者又与卡方($\\chi^2$)分布的CDF相关：\n$$\\mathbb{P}(X \\leq m) = \\frac{\\Gamma(m+1, \\lambda)}{\\Gamma(m+1)} = \\mathbb{P}(\\chi^2_{2(m+1)} > 2\\lambda)$$\n其中 $\\chi^2_{2(m+1)}$ 是一个自由度为 $2(m+1)$ 的卡方随机变量。\n\n对于我们的问题，$m=9$，所以我们有：\n$$\\mathbb{P}(X \\leq 9) = \\mathbb{P}(\\chi^2_{2(9+1)} > 2\\lambda) = \\mathbb{P}(\\chi^2_{20} > 2\\lambda)$$\n条件 $\\mathbb{P}(X \\leq 9) \\leq 0.05$ 变为：\n$$\\mathbb{P}(\\chi^2_{20} > 2\\lambda) \\leq 0.05$$\n令 $\\chi^2_{\\alpha, \\nu}$ 表示自由度为 $\\nu$、显著性水平为 $\\alpha$ 的卡方分布的上临界值，即 $\\mathbb{P}(\\chi^2_{\\nu} > \\chi^2_{\\alpha, \\nu}) = \\alpha$。从标准统计表中，自由度 $\\nu=20$、显著性水平 $\\alpha=0.05$ 的临界值为：\n$$\\chi^2_{0.05, 20} \\approx 31.4104$$\n由于尾部概率函数 $\\mathbb{P}(\\chi^2_{20} > x)$ 是关于 $x$ 的单调递减函数，不等式 $\\mathbb{P}(\\chi^2_{20} > 2\\lambda) \\leq 0.05$ 意味着：\n$$2\\lambda \\geq \\chi^2_{0.05, 20}$$\n$$2\\lambda \\geq 31.4104$$\n$$\\lambda \\geq \\frac{31.4104}{2} = 15.7052$$\n现在，我们将 $\\lambda = np = n \\times 0.001$ 代回不等式中：\n$$n \\times 0.001 \\geq 15.7052$$\n解出 $n$：\n$$n \\geq \\frac{15.7052}{0.001}$$\n$$n \\geq 15705.2$$\n由于细胞数 $n$ 必须是整数，满足此条件的最小整数值是大于或等于 $15705.2$ 的最小整数，即：\n$$n_{min} = \\lceil 15705.2 \\rceil = 15706$$\n因此，在给定假设下，必须最少捕获 $15706$ 个细胞，以确保观察到至少 $10$ 个稀有细胞的概率至少为 $0.95$。", "answer": "$$\\boxed{15706}$$", "id": "2888909"}, {"introduction": "单细胞实验产生的数据量是巨大的，理解其计算需求是高效分析的前提。本练习将深入探讨用于存储稀疏单细胞计数矩阵的常用数据结构——压缩稀疏列（CSC）格式。通过亲手计算一个大规模数据集的内存占用，您将对现代单细胞免疫分析的规模有更具体的认识[@problem_id:2888883]。", "problem": "用于免疫分析的单细胞核糖核酸（RNA）计数矩阵可以建模为一个非负整数矩阵 $X \\in \\mathbb{N}_{0}^{G \\times C}$，其中 $G$ 是基因数量，$C$ 是细胞数量。在高通量单细胞分析中，$X$ 通常是稀疏的：大多数元素为零，因为对于任何给定的细胞，只有一小部分基因具有非零计数。定义密度 $\\rho \\in [0,1]$ 为 $X$ 中非零元素的比例。\n\n此类计数矩阵的一种标准机器表示法是压缩稀疏列（CSC）格式。在 CSC 格式中，矩阵使用三个一维数组进行存储：\n- 一个长度为 $\\mathrm{nnz}$ 的值数组，用于存储非零计数值，\n- 一个长度为 $\\mathrm{nnz}$ 的行索引数组，用于存储每个非零元素的行索引（基因索引），\n- 一个长度为 $C+1$ 的列指针数组，用于标记每个列（细胞）在值数组中的起始偏移量，其中 $\\mathrm{nnz}$ 表示非零元素的总数。\n\n假设使用以下数据类型：\n- 非零值（唯一分子标识符计数）存储为 $32$ 位无符号整数（每个占用 $4$ 字节），\n- 行索引存储为 $32$ 位无符号整数（每个占用 $4$ 字节），\n- 列指针存储为 $64$ 位无符号整数（每个占用 $8$ 字节）。\n\n从以上定义出发，且不假设任何预先推导的内存公式，推导出一个以 $G$、$C$ 和 $\\rho$ 为函数的、用于以 CSC 格式存储 $X$ 所需总内存（以字节为单位）的通用表达式。然后，对该表达式在 $C = 10^{6}$ 个细胞、$G = 2.0 \\times 10^{4}$ 个基因和 $\\rho = 0.01$ 的条件下进行求值。将最终内存需求以千兆字节（GB）为单位表示，使用 $1\\,\\mathrm{GB} = 10^{9}$ 字节，并将最终数值答案四舍五入至四位有效数字。", "solution": "首先将对问题进行严格的验证过程。\n\n**步骤1：提取已知条件**\n\n问题逐字提供了以下定义、参数和条件：\n- 计数矩阵 $X \\in \\mathbb{N}_{0}^{G \\times C}$，其中 $G$ 是基因数量，$C$ 是细胞数量。\n- 矩阵 $X$ 是稀疏的。\n- 密度 $\\rho \\in [0,1]$ 是 $X$ 中非零元素的比例。\n- 矩阵以压缩稀疏列（CSC）格式存储，使用三个数组：\n    - 一个长度为 $\\mathrm{nnz}$ 的值数组，用于存储非零计数值。\n    - 一个长度为 $\\mathrm{nnz}$ 的行索引数组，用于存储行索引。\n    - 一个长度为 $C+1$ 的列指针数组。\n- $\\mathrm{nnz}$ 表示非零元素的总数。\n- 指定了数据类型和内存大小：\n    - 非零值为 $32$ 位无符号整数，每个占用 $4$ 字节。\n    - 行索引为 $32$ 位无符号整数，每个占用 $4$ 字节。\n    - 列指针为 $64$ 位无符号整数，每个占用 $8$ 字节。\n- 目标是推导出一个以 $G$、$C$ 和 $\\rho$ 为函数的总内存（以字节为单位）$M$ 的通用表达式。\n- 该表达式需要在 $C = 10^{6}$ 个细胞、$G = 2.0 \\times 10^{4}$ 个基因和 $\\rho = 0.01$ 的条件下进行求值。\n- 最终数值结果必须以千兆字节（GB）为单位表示，使用换算关系 $1\\,\\mathrm{GB} = 10^{9}$ 字节，并四舍五入至四位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n\n根据所需标准对问题进行审查。\n- **科学依据**：该问题基于计算生物学和计算机科学。关于单细胞RNA测序计数矩阵及其在 CSC 格式中存储的描述在事实上是正确的，并且是该领域的标准实践。\n- **适定性**：该问题是适定的。所有必需的变量（$G$、$C$、$\\rho$）、数据类型大小和存储格式规范都已提供，从而可以推导出唯一且有意义的解。\n- **客观性**：问题以精确、客观的语言陈述。没有主观或模糊的术语。\n\n该问题没有任何使其无效的缺陷。它在科学上是合理的、自洽的，并且可以进行量化形式化。所提供的 $G$、$C$ 和 $\\rho$ 值对于大规模单细胞免疫学研究是符合实际的。对于这种规模的数据集，使用 $64$ 位指针，虽然对于给定的非零元素数量（$\\mathrm{nnz} = 2 \\times 10^8  2^{32}$）并非严格必需，但在为可扩展性而设计的软件库中是一个常见且合理的选择，因此不构成矛盾或不切实际的条件。\n\n**步骤3：结论与行动**\n\n问题是**有效的**。将推导解答。\n\n**内存表达式的推导**\n\n设 $M$ 为所需的总内存（以字节为单位）。总内存是构成 CSC 格式的三个数组所消耗内存的总和：值数组（$M_{\\text{val}}$）、行索引数组（$M_{\\text{row}}$）和列指针数组（$M_{\\text{ptr}}$）。\n\n$$M = M_{\\text{val}} + M_{\\text{row}} + M_{\\text{ptr}}$$\n\n首先，我们根据问题陈述定义每个数组的内存需求。\n值数组存储 $\\mathrm{nnz}$ 个元素，每个元素是一个 $32$ 位整数，指定为 $4$ 字节。\n$$M_{\\text{val}} = \\mathrm{nnz} \\times 4$$\n行索引数组也存储 $\\mathrm{nnz}$ 个元素。每个行索引是一个 $32$ 位整数，使用 $4$ 字节。\n$$M_{\\text{row}} = \\mathrm{nnz} \\times 4$$\n列指针数组包含 $C+1$ 个元素。每个元素是一个 $64$ 位整数，使用 $8$ 字节。\n$$M_{\\text{ptr}} = (C+1) \\times 8$$\n\n将这些部分相加，得到以字节为单位的总内存：\n$$M = (\\mathrm{nnz} \\times 4) + (\\mathrm{nnz} \\times 4) + ((C+1) \\times 8)$$\n$$M = \\mathrm{nnz} \\times 8 + (C+1) \\times 8$$\n$$M = 8(\\mathrm{nnz} + C + 1)$$\n\n非零元素的数量 $\\mathrm{nnz}$ 由密度 $\\rho$ 乘以矩阵中的总元素数（即 $G \\times C$）给出。\n$$\\mathrm{nnz} = \\rho G C$$\n\n将此 $\\mathrm{nnz}$ 的表达式代入 $M$ 的方程，得到总内存作为 $G$、$C$ 和 $\\rho$ 的函数的通用表达式：\n$$M(G, C, \\rho) = 8(\\rho G C + C + 1)$$\n\n此表达式是按要求从第一性原理推导出来的。\n\n**数值计算**\n\n现在我们对给定参数计算此表达式的值：\n- $G = 2.0 \\times 10^{4}$\n- $C = 10^{6}$\n- $\\rho = 0.01 = 10^{-2}$\n\n首先，计算非零元素的数量 $\\mathrm{nnz}$：\n$$\\mathrm{nnz} = \\rho G C = (10^{-2}) \\times (2.0 \\times 10^{4}) \\times (10^{6}) = 2.0 \\times 10^{8}$$\n\n现在将这个值和 $C$ 的值代入以字节为单位的内存公式 $M$ 中：\n$$M = 8(\\mathrm{nnz} + C + 1)$$\n$$M = 8(2.0 \\times 10^{8} + 10^{6} + 1)$$\n$$M = 8(200,000,000 + 1,000,000 + 1)$$\n$$M = 8(201,000,001)$$\n$$M = 1,608,000,008 \\text{ 字节}$$\n\n问题要求答案以千兆字节（GB）为单位，换算关系为 $1\\,\\mathrm{GB} = 10^{9}$ 字节。\n$$M_{\\text{GB}} = \\frac{1,608,000,008}{10^{9}} = 1.608000008 \\text{ GB}$$\n\n最后，该值必须四舍五入到四位有效数字。前四位有效数字是 $1$、$6$、$0$ 和 $8$。第五位数字是 $0$，所以我们不进位。\n$$M_{\\text{GB}} \\approx 1.608$$\n\n最终数值答案是 $1.608$。", "answer": "$$\n\\boxed{1.608}\n$$", "id": "2888883"}, {"introduction": "原始的单细胞数据并非完美，其中包含了必须校正的技术噪音，而“环境RNA”污染是液滴法测序中的一个主要技术假象。这项进阶练习要求您建立一个概率混合模型来估计和校正这种污染。掌握这种数据清理技术对于从数据中获得准确的生物学见解至关重要[@problem_id:2888861]。", "problem": "您的任务是为一种概率混合模型进行形式化和求解，该模型用于处理在采用独特分子标识符（UMI）计数的单细胞液滴测序中的环境核糖核酸（RNA）污染问题，这是单细胞分辨率下免疫分析的标准设置。每个液滴（无论是含细胞的液滴还是空液滴）都会产生每个基因的计数。请将以下经过充分检验的事实和定义作为您推导的基础：\n\n- 在采用独特分子标识符（UMI）计数的基于液滴的单细胞RNA测序中，将基因特异性分子的计数建模为独立的泊松随机变量是标准做法。对于液滴 $j$ 和基因 $g$，计数 $X_{jg}$ 的模型为\n$$\nX_{jg} \\sim \\text{Poisson}\\left(s_j \\cdot \\lambda_{jg}\\right),\n$$\n其中 $s_j$ 是一个捕捉总取样深度的液滴特异性缩放因子，$\\lambda_{jg}$ 是在液滴 $j$ 中基因特异性的期望分数。\n- 对于污染建模，一个常用的混合结构是\n$$\n\\lambda_{jg} = (1 - \\rho_j)\\,\\phi_{jg} + \\rho_j\\,\\alpha_g,\n$$\n其中 $\\rho_j \\in [0,1)$ 是液滴 $j$ 的污染分数，$\\phi_{j} = (\\phi_{jg})_{g=1}^G$ 是液滴 $j$ 的潜在真实细胞图谱（一个概率向量，满足 $\\phi_{jg} \\ge 0$ 且 $\\sum_{g=1}^G \\phi_{jg} = 1$），而 $\\alpha = (\\alpha_g)_{g=1}^G$ 是所有液滴共享的环境图谱（一个概率向量，满足 $\\alpha_g \\ge 0$ 且 $\\sum_{g=1}^G \\alpha_g = 1$）。\n- 以液滴 $j$ 中的总计数 $N_j = \\sum_{g=1}^G X_{jg}$ 为条件，计数向量服从一个多项分布，其概率与 $\\lambda_{jg}$ 成正比，即\n$$\n(X_{j1},\\dots,X_{jG}) \\,\\big|\\, N_j \\sim \\text{Multinomial}\\left(N_j,\\, y_j\\right), \\quad \\text{其中} \\quad y_{jg} = (1 - \\rho_j)\\,\\phi_{jg} + \\rho_j\\,\\alpha_g.\n$$\n\n您的任务：\n\n1) 从空液滴中估计环境图谱。假设有一系列空液滴 $\\mathcal{E}$，它们只包含环境RNA，因此对于每个 $e \\in \\mathcal{E}$ 和每个基因 $g$，\n$$\nX_{eg} \\sim \\text{Poisson}\\!\\left(s_e \\cdot \\rho_e \\cdot \\alpha_g\\right).\n$$\n证明环境图谱 $\\alpha$ 的最大似然估计（MLE）是空液滴计数的归一化总和，\n$$\n\\widehat{\\alpha}_g \\;=\\; \\frac{\\sum_{e \\in \\mathcal{E}} X_{eg}}{\\sum_{e \\in \\mathcal{E}} \\sum_{h=1}^G X_{eh}}.\n$$\n\n2) 通过最大似然法进行细胞图谱去污染。对于一个含细胞的液滴 $j$，其观测计数为 $c_g = X_{jg}$，总计数为 $N = \\sum_{g=1}^G c_g$，并已知污染分数 $\\rho \\in [0,1)$ 和已知的环境图谱 $\\widehat{\\alpha}$，推导去污染后的细胞图谱 $\\phi = (\\phi_g)_{g=1}^G$ 的最大似然估计，约束条件为 $\\phi_g \\ge 0$ 和 $\\sum_{g=1}^G \\phi_g = 1$。仅使用上面提供的基础知识。具体来说，利用以下事实：以 $N$ 为条件，似然函数是一个多项分布的似然，其概率为 $y_g = (1 - \\rho)\\phi_g + \\rho \\widehat{\\alpha}_g$，并且在无约束条件下多项分布概率的MLE为 $\\widehat{y}_g = c_g / N$。通过一种有原则的优化方法，结合约束条件 $y_g \\ge \\rho \\widehat{\\alpha}_g$ 和 $\\sum_{g=1}^G y_g = 1$，得出一个用于求解 $\\widehat{\\phi}$ 的算法解。\n\n3) 算法设计要求。您的推导必须最终形成一个数值稳定的算法，该算法：\n- 根据任务1中的MLE从空液滴中计算 $\\widehat{\\alpha}$。\n- 通过在约束条件 $y_g \\ge a_g$（其中 $a_g = \\rho \\widehat{\\alpha}_g$）和 $\\sum_g y_g = 1$ 下找到 Kullback–Leibler 最优的 $y^{\\star}$，然后通过以下方式映射回去，从而计算细胞的 $\\widehat{\\phi}$：\n$$\n\\widehat{\\phi}_g \\;=\\; \\frac{y_g^{\\star} - a_g}{1 - \\rho}.\n$$\n该算法必须满足约束条件，即使某些 $\\widehat{y}_g = c_g/N$ 的值低于 $a_g$。您最终的 $\\widehat{\\phi}$ 表达式必须是非负的且总和为1。\n\n4) 测试套件和要求的输出。将您的推导实现为一个完整的、可运行的程序，解决以下六个测试用例。在所有情况下，都有 $G = 4$ 个基因，案例 $i$ 的空液滴计数表示为 $E^{(i)}$，细胞计数表示为 $C^{(i)}$，污染分数表示为 $r^{(i)}$。对于每个案例，从提供的空液滴中估计 $\\widehat{\\alpha}^{(i)}$，然后为提供的细胞计数和 $r^{(i)}$ 计算 $\\widehat{\\phi}^{(i)}$。\n\n- 案例 1：$E^{(1)} = [100, 30, 20, 10]$，$C^{(1)} = [50, 5, 3, 2]$，$r^{(1)} = 0.2$。\n- 案例 2：$E^{(2)} = [0, 50, 50, 0]$，$C^{(2)} = [0, 10, 5, 5]$，$r^{(2)} = 0.1$。\n- 案例 3：$E^{(3)} = [200, 0, 0, 0]$，$C^{(3)} = [80, 10, 5, 5]$，$r^{(3)} = 0.6$。\n- 案例 4：$E^{(4)} = [90, 10, 0, 0]$，$C^{(4)} = [5, 3, 1, 1]$，$r^{(4)} = 0.5$。\n- 案例 5：$E^{(5)} = [70, 20, 10, 0]$，$C^{(5)} = [10, 0, 0, 0]$，$r^{(5)} = 0.3$。\n- 案例 6：$E^{(6)} = [1, 1, 1, 1]$，$C^{(6)} = [1, 2, 3, 4]$，$r^{(6)} = 0$。\n\n5) 最终输出格式。对于每个案例，将去污染后的图谱 $\\widehat{\\phi}^{(i)}$ 作为长度为4的向量按基因顺序列出。按顺序将这六个向量连接成一个包含24个浮点数的单一列表。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如\n$[v_1, v_2, \\dots, v_{24}]$，\n其中 $v_k$ 是按顺序连接的 $\\widehat{\\phi}^{(1)}, \\widehat{\\phi}^{(2)}, \\dots, \\widehat{\\phi}^{(6)}$ 的条目。所有数字均表示为四舍五入到六位小数的小数。", "solution": "所提出的问题在科学上是合理的、定义明确的，并且包含了获得唯一解的充分信息。这是计算生物学中分析单细胞测序数据的标准问题。我将继续进行推导和求解。\n\n根据任务分解的要求，解决方案分三部分呈现。首先，推导环境RNA图谱 $\\alpha$ 的最大似然估计。其次，将估计真实细胞图谱 $\\phi$ 的问题构建为一个约束优化问题。第三，通过 Karush-Kuhn-Tucker (KKT) 条件推导出一个数值稳定的算法来解决这个优化问题，从而得到 $\\phi$ 的最终估计。\n\n**第一部分：环境图谱 $\\alpha$ 的最大似然估计**\n\n我们给定一组空液滴 $\\mathcal{E}$。对于每个液滴 $e \\in \\mathcal{E}$ 和基因 $g$，观测到的UMI计数 $X_{eg}$ 服从泊松分布，$X_{eg} \\sim \\text{Poisson}(s_e \\cdot \\rho_e \\cdot \\alpha_g)$。参数 $s_e$ 和 $\\rho_e$ 是每个空液滴特有的无关参数。我们感兴趣的参数是环境图谱 $\\alpha = (\\alpha_g)_{g=1}^G$，它是一个满足 $\\alpha_g \\ge 0$ 和 $\\sum_{g=1}^G \\alpha_g = 1$ 的概率向量。\n\n观测计数 $\\{X_{eg}\\}_{e\\in\\mathcal{E}, g=1..G}$ 的似然函数是各个泊松概率的乘积，假设基因和液滴之间相互独立：\n$$\nL(\\alpha, \\{s_e, \\rho_e\\}) = \\prod_{e \\in \\mathcal{E}} \\prod_{g=1}^G \\frac{(s_e \\rho_e \\alpha_g)^{X_{eg}} e^{-(s_e \\rho_e \\alpha_g)}}{X_{eg}!}\n$$\n对数似然 $\\mathcal{L} = \\log L$ 由下式给出：\n$$\n\\mathcal{L} = \\sum_{e \\in \\mathcal{E}} \\sum_{g=1}^G \\left( X_{eg} \\log(s_e \\rho_e \\alpha_g) - s_e \\rho_e \\alpha_g - \\log(X_{eg}!) \\right)\n$$\n我们可以将涉及 $\\alpha$ 的项与其他项分开：\n$$\n\\mathcal{L} = \\sum_{e,g} X_{eg} \\log(\\alpha_g) + \\sum_{e,g} X_{eg} \\log(s_e \\rho_e) - \\sum_{e,g} s_e \\rho_e \\alpha_g - \\sum_{e,g} \\log(X_{eg}!)\n$$\n令 $C_g = \\sum_{e \\in \\mathcal{E}} X_{eg}$ 为所有空液滴中基因 $g$ 的总计数。对数似然可以重写为：\n$$\n\\mathcal{L} = \\sum_{g=1}^G C_g \\log(\\alpha_g) - \\sum_{e \\in \\mathcal{E}} (s_e \\rho_e) \\sum_{g=1}^G \\alpha_g + \\text{const}\n$$\n使用约束条件 $\\sum_g \\alpha_g = 1$，表达式简化为：\n$$\n\\mathcal{L} = \\sum_{g=1}^G C_g \\log(\\alpha_g) - \\sum_{e \\in \\mathcal{E}} s_e \\rho_e + \\text{const}\n$$\n为了找到 $\\alpha$ 的最大似然估计（MLE），我们必须在约束条件 $\\alpha_g \\ge 0$ 和 $\\sum_g \\alpha_g = 1$ 下最大化 $\\mathcal{L}$。这等价于最大化 $\\sum_g C_g \\log(\\alpha_g)$ 这一项。我们使用拉格朗日乘子法。拉格朗日函数是：\n$$\n\\Lambda(\\alpha, \\lambda) = \\sum_{g=1}^G C_g \\log(\\alpha_g) - \\lambda \\left(\\sum_{g=1}^G \\alpha_g - 1\\right)\n$$\n对 $\\alpha_g$ 求偏导数并令其为零，得到：\n$$\n\\frac{\\partial \\Lambda}{\\partial \\alpha_g} = \\frac{C_g}{\\alpha_g} - \\lambda = 0 \\implies \\alpha_g = \\frac{C_g}{\\lambda}\n$$\n为了找到拉格朗日乘子 $\\lambda$，我们应用总和为一的约束：\n$$\n\\sum_{g=1}^G \\alpha_g = \\sum_{g=1}^G \\frac{C_g}{\\lambda} = \\frac{1}{\\lambda} \\sum_{g=1}^G C_g = 1 \\implies \\lambda = \\sum_{h=1}^G C_h\n$$\n将 $\\lambda$ 代回 $\\alpha_g$ 的表达式，我们得到 MLE：\n$$\n\\widehat{\\alpha}_g = \\frac{C_g}{\\sum_{h=1}^G C_h} = \\frac{\\sum_{e \\in \\mathcal{E}} X_{eg}}{\\sum_{h=1}^G \\sum_{e \\in \\mathcal{E}} X_{eh}}\n$$\n这证明了环境图谱的MLE是所有空液滴计数的归一化总和，如问题所述。\n\n**第二部分：通过约束最大似然法进行细胞图谱去污染**\n\n对于单个含细胞的液滴，我们观测到计数 $c = (c_1, \\dots, c_G)$，总计数为 $N = \\sum_g c_g$。以 $N$ 为条件，计数服从多项分布 $c \\sim \\text{Multinomial}(N, y)$，其中概率向量 $y=(y_g)_{g=1}^G$ 是真实细胞图谱 $\\phi$ 和环境图谱 $\\widehat{\\alpha}$ 的混合：\n$$\ny_g = (1 - \\rho)\\phi_g + \\rho \\widehat{\\alpha}_g\n$$\n在这里，污染分数 $\\rho$ 和环境图谱 $\\widehat{\\alpha}$ 假定为已知。我们寻求 $\\phi$ 的MLE。多项分布的对数似然函数为：\n$$\n\\mathcal{L}(y | c) = K + \\sum_{g=1}^G c_g \\log(y_g)\n$$\n其中 $K$ 是一个常数。最大化此对数似然等价于最小化从经验分布 $\\widehat{y} = (c_g/N)_{g=1}^G$ 到模型分布 $y$ 的 Kullback-Leibler (KL) 散度。\n\n对 $\\phi$ 的约束（$\\phi_g \\ge 0$ 和 $\\sum_g \\phi_g = 1$）必须转化为对 $y$ 的约束。整理混合方程得到：\n$$\n\\phi_g = \\frac{y_g - \\rho \\widehat{\\alpha}_g}{1 - \\rho}\n$$\n约束 $\\phi_g \\ge 0$ 意味着 $y_g - \\rho \\widehat{\\alpha}_g \\ge 0$，或 $y_g \\ge \\rho \\widehat{\\alpha}_g$。我们定义下界 $a_g = \\rho \\widehat{\\alpha}_g$。约束变为 $y_g \\ge a_g$。\n约束 $\\sum_g \\phi_g = 1$ 意味着：\n$$\n\\sum_{g=1}^G \\frac{y_g - a_g}{1 - \\rho} = 1 \\implies \\frac{1}{1 - \\rho} \\left( \\sum_g y_g - \\sum_g a_g \\right) = 1\n$$\n由于 $\\sum_g a_g = \\sum_g \\rho \\widehat{\\alpha}_g = \\rho \\sum_g \\widehat{\\alpha}_g = \\rho \\cdot 1 = \\rho$，该约束简化为：\n$$\n\\frac{1}{1-\\rho} \\left( \\sum_g y_g - \\rho \\right) = 1 \\implies \\sum_g y_g = 1\n$$\n因此，估计 $\\phi$ 等价于为 $y$ 求解以下约束优化问题：\n$$\n\\begin{aligned}\n\\text{最大化} \\quad  \\sum_{g=1}^G c_g \\log(y_g) \\\\\n\\text{约束于} \\quad  y_g \\ge a_g, \\quad \\forall g \\in \\{1, \\dots, G\\} \\\\\n \\sum_{g=1}^G y_g = 1\n\\end{aligned}\n$$\n最优解 $y^{\\star}$ 随后可用于通过 $\\widehat{\\phi}_g = (y^{\\star}_g - a_g)/(1-\\rho)$ 找到 $\\phi$ 的 MLE。\n\n**第三部分：通过KKT条件的算法解**\n\n我们使用 Karush-Kuhn-Tucker (KKT) 条件来解决这个约束优化问题。拉格朗日函数是：\n$$\nL(y, \\lambda, \\mu) = \\sum_{g=1}^G c_g \\log(y_g) - \\lambda \\left(\\sum_{g=1}^G y_g - 1\\right) + \\sum_{g=1}^G \\mu_g(y_g - a_g)\n$$\n其中 $\\lambda$ 是等式约束的乘子，$\\mu_g \\ge 0$ 是不等式约束的乘子。KKT条件是：\n1.  **平稳性 (Stationarity):** $\\frac{\\partial L}{\\partial y_g} = \\frac{c_g}{y_g} - \\lambda + \\mu_g = 0$\n2.  **原始可行性 (Primal Feasibility):** $y_g \\ge a_g$ 和 $\\sum_g y_g = 1$\n3.  **对偶可行性 (Dual Feasibility):** $\\mu_g \\ge 0$\n4.  **互补松弛性 (Complementary Slackness):** $\\mu_g(y_g - a_g) = 0$\n\n从互补松弛性可知，对于每个基因 $g$，要么 $\\mu_g = 0$，要么 $y_g = a_g$。\n- 如果约束未激活 ($y_g  a_g$)，则 $\\mu_g=0$。平稳性意味着 $\\frac{c_g}{y_g} = \\lambda$，所以 $y_g = c_g/\\lambda$。这发生在 $c_g/\\lambda  a_g$ 或 $c_g/a_g  \\lambda$ 时。\n- 如果约束被激活 ($y_g = a_g$)，则 $\\mu_g \\ge 0$。平稳性意味着 $\\mu_g = \\lambda - c_g/a_g \\ge 0$，所以 $\\lambda \\ge c_g/a_g$。\n\n这将基因集合划分为两个子集：\n- $S_{over} = \\{g \\mid y_g  a_g\\}$，对于这些基因，$y_g = c_g/\\lambda$。\n- $S_{under} = \\{g \\mid y_g = a_g\\}$，对于这些基因，解被固定在下界。\n\n$\\lambda$ 的值作为比率 $c_g/a_g$ 的阈值。我们需要找到正确的划分和相应的 $\\lambda$。对 $y$ 的总和为一的约束给出：\n$$\n\\sum_{g=1}^G y_g = \\sum_{g \\in S_{over}} \\frac{c_g}{\\lambda} + \\sum_{g \\in S_{under}} a_g = 1\n$$\n由此，我们可以解出 $\\lambda$：\n$$\n\\lambda = \\frac{\\sum_{g \\in S_{over}} c_g}{1 - \\sum_{g \\in S_{under}} a_g}\n$$\n这提出了一个迭代算法：\n1.  初始化 $S_{over} = \\{1, \\dots, G\\}$ 和 $S_{under} = \\emptyset$。\n2.  迭代直至收敛：\n    a. 使用当前划分 $(S_{over}, S_{under})$ 计算 $\\lambda$。\n    b. 识别基因集合 $V = \\{g \\in S_{over} \\mid c_g/\\lambda \\le a_g\\}$，其中建议的解 $c_g/\\lambda$ 违反了约束。\n    c. 如果 $V$ 为空，则划分正确，算法收敛。跳出循环。\n    d. 如果 $V$ 不为空，则将 $V$ 中的所有基因从 $S_{over}$ 移动到 $S_{under}$ 来更新划分，并从步骤2a重复。\n\n这个迭代过程保证会收敛，因为基因只从 $S_{over}$ 移动到 $S_{under}$，而且基因数量是有限的。\n\n一旦找到最终划分 $(S_{over}^{\\star}, S_{under}^{\\star})$ 和相应的 $\\lambda^{\\star}$，最优解 $y^{\\star}$ 就是：\n$$\ny_g^{\\star} = \\begin{cases} c_g / \\lambda^{\\star}  \\text{if } g \\in S_{over}^{\\star} \\\\ a_g  \\text{if } g \\in S_{under}^{\\star} \\end{cases}\n$$\n最后，计算去污染图谱 $\\phi$ 的MLE：\n$$\n\\widehat{\\phi}_g = \\frac{y_g^{\\star} - a_g}{1 - \\rho}\n$$\n对于 $S_{under}^{\\star}$ 中的基因，$y_g^{\\star} = a_g$，所以 $\\widehat{\\phi}_g = 0$。对于 $S_{over}^{\\star}$ 中的基因，$y_g^{\\star} \\ge a_g$，所以 $\\widehat{\\phi}_g \\ge 0$。如思路过程所示，得到的 $\\widehat{\\phi}$ 向量保证具有非负项且总和为1。这提供了一个完整、有原则且数值稳定的算法。", "answer": "[0.895315,0.000000,0.000000,0.104685,0.000000,0.388889,0.111111,0.500000,0.500000,0.166667,0.166667,0.166667,0.000000,0.500000,0.250000,0.250000,1.000000,0.000000,0.000000,0.000000,0.100000,0.200000,0.300000,0.400000]", "id": "2888861"}]}