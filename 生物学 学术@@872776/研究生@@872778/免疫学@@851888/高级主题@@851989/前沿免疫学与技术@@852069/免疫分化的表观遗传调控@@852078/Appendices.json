{"hands_on_practices": [{"introduction": "免疫分化由精确的基因表达程序引导，而组蛋白修饰作为一种“密码”，决定了基因的表达潜能。本练习要求您将我们对关键组蛋白标记——H3K4me1（预备状态）、H3K27ac（激活状态）和H3K27me3（抑制状态）——的定性理解，转化为一个定量的“基因预备分数”。这项实践将培养您从多模态表观基因组数据构建预测模型的能力，这是现代计算免疫学的一项核心技能。[@problem_id:2847287]", "problem": "给定当前分化阶段的染色质免疫沉淀后测序 (ChIP-seq) 的组蛋白修饰信号，以及一组基因在当前和下一阶段的信使核糖核酸 (mRNA) 表达。三种组蛋白标记分别是组蛋白 H3 赖氨酸 4 单甲基化 (H3K4me1)、组蛋白 H3 赖氨酸 27 乙酰化 (H3K27ac) 和组蛋白 H3 赖氨酸 27 三甲基化 (H3K27me3)。根据免疫学和基因调控的基本原理，我们假设以下经过充分验证的定性事实：(i) 预备增强子的开放染色质标记（如 H3K4me1）与未来的基因激活呈正相关；(ii) 与激活相关的标记（如 H3K27ac）表示当前的激活状态，并削弱了仅仅是“蓄势待发”的概念；(iii) Polycomb 介导的抑制（如 H3K27me3）与激活呈负相关。从这些单调影响和分子生物学中心法则出发，设计一个数学上原则性的程序，为当前时间的每个基因计算一个标量“蓄势分数”，并评估其预测下一时间点即时激活的能力。\n\n您的程序必须实现以下规范：\n\n- 设有 $G$ 个基因，索引为 $i \\in \\{1,\\dots,G\\}$。对于每个基因，您会获得在当前时间 $t$ 的三个 ChIP-seq 信号向量：$x^{(1)} \\in \\mathbb{R}^G$ (H3K4me1)，$x^{(2)} \\in \\mathbb{R}^G$ (H3K27ac)，以及 $x^{(3)} \\in \\mathbb{R}^G$ (H3K27me3)。您还会获得表达向量 $e_t \\in \\mathbb{R}^G$ 和 $e_{t+1} \\in \\mathbb{R}^G$。\n- 通过表达变化的阈值定义即时激活标签：对于一个固定的 $\\Delta > 0$，如果 $e_{t+1,i} - e_{t,i} \\ge \\Delta$，则设置 $y_i = 1$，否则 $y_i = 0$。\n- 为每个基因 $i$ 构建一个蓄势分数 $s_i$，仅使用时间 $t$ 的 $x^{(1)}$、$x^{(2)}$ 和 $x^{(3)}$，同时遵循上述单调影响，并在可通约的尺度上组合特征。您的设计必须纯粹是所提供向量的函数（无外部训练），并且必须对任何单一标记在所有基因间的仿射重缩放保持不变。\n- 使用蓄势分数 $\\{s_i\\}_{i=1}^G$ 通过排序来预测标签 $\\{y_i\\}_{i=1}^G$。使用受试者工作特征曲线下面积 (ROC-AUC) 来量化预测能力，其定义为随机选择的正例排名高于随机选择的负例的概率，平局计为 0.5。如果所有标签都相同（没有正例或没有负例），则按惯例将 ROC-AUC 定义为 $0.5$。\n- 角度和物理单位不适用。所有输入均为任意归一化单位；您必须将它们视作无单位的标量。\n\n测试套件：\n\n在以下四个独立的测试案例上实现并评估您的方法。在每个案例中，取 $\\Delta = 0.5$。\n\n- 案例 A（平衡、信号清晰）：\n  - $x^{(1)} = [1.0, 0.8, 1.2, -0.5, -0.2, 0.6, -1.0, 0.9]$\n  - $x^{(2)} = [0.1, 0.3, 0.0, 0.8, 0.5, 0.2, 0.7, 0.1]$\n  - $x^{(3)} = [0.2, 0.1, 0.0, 1.0, 0.8, 0.3, 1.2, 0.1]$\n  - $e_t = [1.0, 0.5, 0.7, 0.2, 0.3, 0.6, 0.1, 0.4]$\n  - $e_{t+1} = [1.8, 1.2, 1.6, 0.1, 0.2, 1.3, 0.0, 1.1]$\n- 案例 B（边界情况：t+1 时没有正例）：\n  - $x^{(1)} = [0.2, -0.1, 0.0, -0.2, 0.1, -0.3]$\n  - $x^{(2)} = [0.5, 0.4, 0.6, 0.3, 0.5, 0.6]$\n  - $x^{(3)} = [0.7, 0.8, 0.6, 0.9, 0.7, 0.8]$\n  - $e_t = [0.5, 0.4, 0.6, 0.3, 0.7, 0.5]$\n  - $e_{t+1} = [0.6, 0.5, 0.7, 0.4, 0.8, 0.6]$\n- 案例 C（关联反转：强烈的反预测标记）：\n  - $x^{(1)} = [1.5, 1.2, 1.0, -0.5, -0.8, -1.0]$\n  - $x^{(2)} = [0.1, 0.2, 0.3, 0.6, 0.5, 0.4]$\n  - $x^{(3)} = [0.2, 0.3, 0.2, 0.8, 0.9, 0.7]$\n  - $e_t = [0.2, 0.3, 0.4, 0.1, 0.2, 0.2]$\n  - $e_{t+1} = [0.4, 0.3, 0.5, 0.9, 0.8, 0.7]$\n- 案例 D（标记内部存在平局，可通过一个特征区分）：\n  - $x^{(1)} = [0.5, 0.5, 0.0, 0.0]$\n  - $x^{(2)} = [0.2, 0.2, 0.2, 0.2]$\n  - $x^{(3)} = [0.2, 0.2, 0.2, 0.2]$\n  - $e_t = [0.2, 0.2, 0.2, 0.2]$\n  - $e_{t+1} = [0.8, 0.7, 0.3, 0.1]$\n\n程序要求：\n\n- 仅使用提供的数据，实现您描述的蓄势分数和 ROC-AUC 计算。\n- 对于每个案例（A–D），计算 ROC-AUC 作为浮点数。\n- 输出一行，包含一个逗号分隔的列表，按 [A,B,C,D] 的顺序列出四个 ROC-AUC 值，每个值四舍五入到四位小数，并用方括号括起来。例如，以“[a,b,c,d]”的形式输出，其中 $a$、$b$、$c$ 和 $d$ 是四舍五入后的值。", "solution": "在尝试解决方案之前，对问题进行验证。\n\n**第 1 步：提取的已知条件**\n- **每个基因集的数据**：三个在时间 $t$ 的组蛋白修饰信号向量 $x^{(1)}$ (H3K4me1)、$x^{(2)}$ (H3K27ac) 和 $x^{(3)}$ (H3K27me3)，以及两个基因表达向量 $e_t$ 和 $e_{t+1}$。所有向量均为 $\\mathbb{R}^G$，其中 $G$ 为基因数量。\n- **生物学原理**：\n    - (i) H3K4me1 对未来基因激活具有正向单调影响。\n    - (ii) H3K27ac 表示当前激活，并否定蓄势待发（poising）的概念。\n    - (iii) H3K27me3 对激活具有负向单调影响。\n- **定义**：\n    - 即时激活标签 $y_i$：对于阈值 $\\Delta > 0$，$y_i=1$ 如果 $e_{t+1,i} - e_{t,i} \\ge \\Delta$，$y_i=0$ 否则。\n    - 蓄势分数 $s_i$：为每个基因 $i$ 计算的标量分数，由 $x^{(1)}$、$x^{(2)}$ 和 $x^{(3)}$ 构建，且对任何输入标记的仿射重缩放保持不变。\n- **评估指标**：受试者工作特征曲线下面积 (ROC-AUC)。如果所有标签都相同，ROC-AUC 定义为 $0.5$。\n- **测试参数**：提供了四个测试案例（A、B、C、D）。对于所有案例，$\\Delta = 0.5$。\n\n**第 2 步：验证结论**\n问题陈述是**有效的**。\n1.  **科学依据充分**：该问题基于表观遗传基因调控的既定原理，特别是 H3K4me1、H3K27ac 和 H3K27me3 在定义染色质状态（如蓄势、激活和抑制）中的作用。这些概念是分子生物学的基础。\n2.  **问题定义明确**：任务是设计一个有原则的程序。虽然设计空间很大，但约束条件——单调性、仿射不变性以及仅使用所提供的数据——是清晰且具有足够限制性的，可以指导构建一个非任意、有意义的评分函数。评估指标的定义是明确的。\n3.  **客观性**：问题使用精确的数学和生物学术语陈述，没有主观或含糊的语言。\n\n该问题是一个形式良好的定量生物学任务，要求将生物学第一原理综合到一个数学模型中。没有逻辑矛盾、科学不准确或缺失信息会妨碍严谨的解决方案。\n\n**解法推导**\n\n我们将分三个阶段构建解决方案：首先，设计蓄势分数；其次，定义真实标签；第三，指定评估程序。\n\n**1. 蓄势分数 ($s_i$) 的设计**\n\n设计必须满足三个主要约束：仿射不变性、在可通约的尺度上组合特征，以及遵守指定的单调影响。\n\n**A. 仿射不变性和特征缩放**\n要求分数在任何特征向量 $x^{(j)}$ 经过仿射变换 $x^{(j)} \\to a \\cdot x^{(j)} + b$（对于 $a>0$）后保持不变，是一个强有力的约束。通过标准化每个特征向量可以自然地实现此属性。我们将使用 Z-score 标准化。对于每个特征向量 $x^{(j)} \\in \\mathbb{R}^G$，我们计算一个标准化的向量 $z^{(j)}$，其中第 $i$ 个分量由以下公式给出：\n$$ z_i^{(j)} = \\frac{x_i^{(j)} - \\mu_j}{\\sigma_j} $$\n这里，$\\mu_j$ 和 $\\sigma_j$ 分别是向量 $x^{(j)}$ 的均值和标准差。此变换将每个特征向量重新缩放，使其均值为 $0$，标准差为 $1$，从而将所有特征置于一个共同的、无量纲的尺度上。如果 $\\sigma_j=0$（即 $x^{(j)}$ 的所有元素都相同），则该特征不提供用于对基因进行相对排序的信息。在这种情况下，我们为所有 $i$ 定义 $z_i^{(j)} = 0$。\n\n**B. 生物学原理的整合**\n基因的蓄势分数必须反映其为未来激活所做的准备。问题提供了以下定性关系：\n- **H3K4me1 ($x^{(1)}$)**：一种蓄势增强子的标记，其存在与未来激活呈正相关。因此，较高的 $z^{(1)}$ 值应增加蓄势分数。\n- **H3K27ac ($x^{(2)}$)**：一种活性启动子和增强子的标记，其存在表示当前而非未来的激活，从而降低了“蓄势”状态。较高的 $z^{(2)}$ 值应降低蓄势分数。\n- **H3K27me3 ($x^{(3)}$)**：一种抑制性标记，其存在与激活呈负相关。较高的 $z^{(3)}$ 值应降低蓄势分数。\n\n在不引入额外参数或假设的情况下，组合这些影响的最直接和有原则的方法是线性模型。基因 $i$ 的蓄势分数 $s_i$ 被表述为标准化特征值的加权和：\n$$ s_i = w_1 z_i^{(1)} + w_2 z_i^{(2)} + w_3 z_i^{(3)} $$\n根据生物学原理，权重的符号必须是 $w_1 > 0$、$w_2  0$ 和 $w_3  0$。在没有任何信息来证明差异化加权的合理性的情况下，我们应用简约原则并赋予权重相等的绝对值。尊重这些符号的最简单选择是 $w_1=1$、$w_2=-1$ 和 $w_3=-1$。\n\n**C. 最终蓄势分数公式**\n这导出了基因 $i$ 的蓄势分数的最终定义：\n$$ s_i = z_i^{(1)} - z_i^{(2)} - z_i^{(3)} $$\n对于具有强预备标记但活性和抑制性标记水平较低的基因，该分数较高，这是基因准备激活的典型特征。\n\n**2. 即时激活标签 ($y_i$) 的定义**\n\n评估蓄势分数预测能力的真实标签源自基因表达的变化。如规范所述，基因 $i$ 的即时激活是通过比较表达变化 $\\Delta e_i = e_{t+1,i} - e_{t,i}$ 与固定阈值 $\\Delta = 0.5$ 来确定的。二元标签 $y_i$ 定义为：\n$$ y_i = \\begin{cases} 1  \\text{if } e_{t+1,i} - e_{t,i} \\ge 0.5 \\\\ 0  \\text{if } e_{t+1,i} - e_{t,i}  0.5 \\end{cases} $$\n标签 $y_i=1$ 表示该基因被激活，而 $y_i=0$ 表示未被激活。\n\n**3. 通过 ROC-AUC 进行评估**\n\n蓄势分数 $s$ 的预测性能通过受试者工作特征曲线下面积 (ROC-AUC) 进行量化。ROC-AUC 等价于随机选择的正样本（$y_i=1$ 的基因）的分数 $s_i$ 高于随机选择的负样本（$y_j=0$ 的基因）的分数 $s_j$ 的概率。\n\n设 $P = \\{i \\mid y_i=1\\}$ 为正实例的索引集，$N = \\{j \\mid y_j=0\\}$ 为负实例的索引集。设它们各自的大小为 $N_P = |P|$ 和 $N_N = |N|$。ROC-AUC 的计算公式为：\n$$ \\text{ROC-AUC} = \\frac{1}{N_P N_N} \\sum_{i \\in P} \\sum_{j \\in N} \\mathbb{I}(s_i, s_j) $$\n其中比较函数 $\\mathbb{I}(s_i, s_j)$ 考虑了平局情况：\n$$ \\mathbb{I}(s_i, s_j) = \\begin{cases} 1  \\text{if } s_i  s_j \\\\ 0.5  \\text{if } s_i = s_j \\\\ 0  \\text{if } s_i  s_j \\end{cases} $$\n如果 $N_P=0$ 或 $N_N=0$，则没有可比较的对，ROC-AUC 按惯例定义为 $0.5$。该程序将以计算方式实现，并应用于提供的四个测试案例。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by defining a poising score, calculating it for four test cases,\n    and evaluating its predictive power using ROC-AUC.\n    \"\"\"\n\n    test_cases = {\n        'A': {\n            'x1': np.array([1.0, 0.8, 1.2, -0.5, -0.2, 0.6, -1.0, 0.9]),\n            'x2': np.array([0.1, 0.3, 0.0, 0.8, 0.5, 0.2, 0.7, 0.1]),\n            'x3': np.array([0.2, 0.1, 0.0, 1.0, 0.8, 0.3, 1.2, 0.1]),\n            'et': np.array([1.0, 0.5, 0.7, 0.2, 0.3, 0.6, 0.1, 0.4]),\n            'et1': np.array([1.8, 1.2, 1.6, 0.1, 0.2, 1.3, 0.0, 1.1]),\n        },\n        'B': {\n            'x1': np.array([0.2, -0.1, 0.0, -0.2, 0.1, -0.3]),\n            'x2': np.array([0.5, 0.4, 0.6, 0.3, 0.5, 0.6]),\n            'x3': np.array([0.7, 0.8, 0.6, 0.9, 0.7, 0.8]),\n            'et': np.array([0.5, 0.4, 0.6, 0.3, 0.7, 0.5]),\n            'et1': np.array([0.6, 0.5, 0.7, 0.4, 0.8, 0.6]),\n        },\n        'C': {\n            'x1': np.array([1.5, 1.2, 1.0, -0.5, -0.8, -1.0]),\n            'x2': np.array([0.1, 0.2, 0.3, 0.6, 0.5, 0.4]),\n            'x3': np.array([0.2, 0.3, 0.2, 0.8, 0.9, 0.7]),\n            'et': np.array([0.2, 0.3, 0.4, 0.1, 0.2, 0.2]),\n            'et1': np.array([0.4, 0.3, 0.5, 0.9, 0.8, 0.7]),\n        },\n        'D': {\n            'x1': np.array([0.5, 0.5, 0.0, 0.0]),\n            'x2': np.array([0.2, 0.2, 0.2, 0.2]),\n            'x3': np.array([0.2, 0.2, 0.2, 0.2]),\n            'et': np.array([0.2, 0.2, 0.2, 0.2]),\n            'et1': np.array([0.8, 0.7, 0.3, 0.1]),\n        }\n    }\n\n    DELTA_THRESHOLD = 0.5\n\n    def compute_roc_auc(x1, x2, x3, et, et1, delta):\n        \"\"\"\n        Computes the poising score and evaluates its predictive power using ROC-AUC.\n        \n        Args:\n            x1, x2, x3: Histone mark signal vectors.\n            et, et1: Gene expression vectors at time t and t+1.\n            delta: Threshold for defining imminent activation.\n            \n        Returns:\n            The ROC-AUC score as a float.\n        \"\"\"\n        \n        # 1. Define imminent activation labels\n        delta_e = et1 - et\n        y = (delta_e >= delta).astype(int)\n        \n        # Get indices for positive and negative classes\n        pos_indices = np.where(y == 1)[0]\n        neg_indices = np.where(y == 0)[0]\n        \n        # 2. Handle edge case where all labels are the same\n        if len(pos_indices) == 0 or len(neg_indices) == 0:\n            return 0.5\n\n        # 3. Standardize feature vectors (Z-score)\n        def standardize(v):\n            std = np.std(v)\n            if std == 0:\n                return np.zeros_like(v)\n            return (v - np.mean(v)) / std\n        \n        z1 = standardize(x1)\n        z2 = standardize(x2)\n        z3 = standardize(x3)\n        \n        # 4. Compute the poising score\n        s = z1 - z2 - z3\n        \n        # 5. Calculate ROC-AUC\n        scores_pos = s[pos_indices]\n        scores_neg = s[neg_indices]\n        \n        n_pos = len(scores_pos)\n        n_neg = len(scores_neg)\n        \n        comparison_sum = 0.0\n        for sp in scores_pos:\n            for sn in scores_neg:\n                if sp > sn:\n                    comparison_sum += 1.0\n                elif sp == sn:\n                    comparison_sum += 0.5\n        \n        roc_auc = comparison_sum / (n_pos * n_neg)\n        return roc_auc\n\n    results = []\n    case_order = ['A', 'B', 'C', 'D']\n    for case_id in case_order:\n        case_data = test_cases[case_id]\n        roc_auc = compute_roc_auc(\n            case_data['x1'],\n            case_data['x2'],\n            case_data['x3'],\n            case_data['et'],\n            case_data['et1'],\n            DELTA_THRESHOLD\n        )\n        results.append(roc_auc)\n        \n    # Format output as a comma-separated list of rounded values in brackets\n    formatted_results = [f\"{r:.4f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2847287"}, {"introduction": "基因表达并非一个简单的开关，而是一个充满噪音的随机过程，这种“转录爆发”是细胞间异质性的根本原因。本练习将探讨经典的基因转录双态模型，其中基因启动子在活性和非活性状态之间随机切换，您将推导由H3K27ac等表观遗传标记调节的这种转换行为，如何共同决定基因的平均表达水平及其变异性。掌握该模型能让您从机理上深刻理解表观遗传调控不仅控制着基因产物的数量，还影响其表达噪音，这对细胞命运决定具有深远影响。[@problem_id:2847319]", "problem": "在一个表观遗传调控的免疫分化背景中，考虑一个正在分化的T辅助细胞中的细胞因子基因，其启动子被组蛋白H3赖氨酸27乙酰化 (H3K27ac) 标记。该启动子在非激活状态和激活状态之间表现出典型的双态随机转换。该系统被建模为一个连续时间马尔可夫过程，其要素基于中心法则和标准随机化学动力学：当启动子处于非激活状态时，不发生转录；当启动子处于激活状态时，以速率 $r$ (单位时间的事件数) 启动信使RNA (mRNA) 的转录。启动子以速率 $k_{on}$ 从非激活状态转换到激活状态，并以速率 $k_{off}$ 从激活状态转换到非激活状态。每个mRNA分子以速率 $\\gamma$ (每分子每单位时间) 独立降解。令 $N$ 表示mRNA拷贝数的稳态随机变量。\n\n从随机生灭过程和启动子状态转换的第一性原理出发（不使用双态模型的预先推导出的公式），推导稳态均值 $\\mathbb{E}[N]$ 和方差 $\\mathrm{Var}(N)$ 的闭式解，用 $r$、$k_{on}$、$k_{off}$ 和 $\\gamma$ 表示。定义法诺因子为 $F \\equiv \\mathrm{Var}(N)/\\mathbb{E}[N]$。\n\n从表观遗传学角度看，启动子上增加的H3K27ac与增强的染色质可及性和转录能力相关。将此建模为启动子激活速率的乘性增加：$k_{on} \\mapsto \\alpha\\,k_{on}$，其中 $\\alpha1$，而 $k_{off}$、$r$ 和 $\\gamma$ 保持不变。推导比值 $F(\\alpha)/F(1)$ 的精确闭式表达式，作为 $\\alpha$、$r$、$k_{on}$、$k_{off}$ 和 $\\gamma$ 的函数。\n\n将你的最终答案以单行矩阵的形式给出，其中按顺序列出 $\\mathbb{E}[N]$、$\\mathrm{Var}(N)$ 和 $F(\\alpha)/F(1)$ 的表达式。不包含单位。不需要进行数值近似。", "solution": "我们用一个二元随机过程 $S(t)\\in\\{0,1\\}$ 来模拟启动子的状态，其中 $S(t)=1$ 表示激活状态，$S(t)=0$ 表示非激活状态。启动子作为一个连续时间马尔可夫链进行转换，其转移速率为 $k_{on}$ (非激活到激活) 和 $k_{off}$ (激活到非激活)。当 $S(t)=1$ 时，mRNA以速率 $r$ 产生；每个mRNA以速率 $\\gamma$ 降解，且独立于启动子状态。令 $N(t)$ 为mRNA的数量。相关反应如下：\n- 启动子转换：$S=0 \\xrightleftharpoons[k_{off}]{k_{on}} S=1$。\n- 转录：当 $S=1$ 时，$N\\to N+1$ 速率为 $r$。\n- 降解：$N\\to N-1$ 速率为 $\\gamma N$。\n\n激活状态启动子的稳态占据率由一个双态马尔可夫链的平稳分布给出：\n$$\np_{on} \\equiv \\mathbb{E}[S] = \\frac{k_{on}}{k_{on}+k_{off}}.\n$$\n平均mRNA数量可以从由 $S(t)$ 驱动的线性生灭过程的平均场平衡方程得出：\n$$\n\\frac{d}{dt}\\mathbb{E}[N] = r\\,\\mathbb{E}[S] - \\gamma\\,\\mathbb{E}[N].\n$$\n在稳态下，$\\frac{d}{dt}\\mathbb{E}[N]=0$，因此\n$$\n\\mathbb{E}[N] = \\frac{r\\,\\mathbb{E}[S]}{\\gamma} = \\frac{r\\,k_{on}}{\\gamma\\,(k_{on}+k_{off})}.\n$$\n\n为了求得方差，我们推导矩方程。首先，对于二阶矩，使用对 $N$ 的标准跳跃矩更新方法，\n$$\n\\frac{d}{dt}\\mathbb{E}[N^{2}] = \\mathbb{E}\\big[(2N+1)\\,rS\\big] + \\mathbb{E}\\big[(-2N+1)\\,\\gamma N\\big]\n= 2r\\,\\mathbb{E}[NS] + r\\,\\mathbb{E}[S] - 2\\gamma\\,\\mathbb{E}[N^{2}] + \\gamma\\,\\mathbb{E}[N].\n$$\n这引入了混合矩 $\\mathbb{E}[NS]$，我们通过考虑所有改变 $NS$ 的反应来为其写出平衡方程：\n- 启动子转换的贡献为 $k_{on}\\big(\\mathbb{E}[N]-\\mathbb{E}[NS]\\big) - k_{off}\\,\\mathbb{E}[NS]$。\n- 转录（仅当 $S=1$ 时）使 $N$ 增加1而不改变 $S$，其贡献为 $r\\,\\mathbb{E}[S]$。\n- 降解以速率 $\\gamma N$ 使 $N$ 减少1，其贡献为 $-\\gamma\\,\\mathbb{E}[NS]$。\n因此，\n$$\n\\frac{d}{dt}\\mathbb{E}[NS] = k_{on}\\,\\mathbb{E}[N] - (k_{on}+k_{off}+\\gamma)\\,\\mathbb{E}[NS] + r\\,\\mathbb{E}[S].\n$$\n在稳态下，$\\frac{d}{dt}\\mathbb{E}[NS]=0$，并且已知 $\\mathbb{E}[N]=\\frac{r p_{on}}{\\gamma}$ 和 $\\mathbb{E}[S]=p_{on}$，我们得到\n$$\n\\mathbb{E}[NS] = \\frac{k_{on}\\,\\mathbb{E}[N] + r\\,\\mathbb{E}[S]}{k_{on}+k_{off}+\\gamma}\n= \\frac{k_{on}\\,\\frac{r p_{on}}{\\gamma} + r p_{on}}{k_{on}+k_{off}+\\gamma}\n= \\frac{r\\,p_{on}\\,(k_{on}+\\gamma)}{\\gamma\\,(k_{on}+k_{off}+\\gamma)}.\n$$\n回到二阶矩方程并施加稳态条件，\n$$\n0 = 2r\\,\\mathbb{E}[NS] + r\\,p_{on} - 2\\gamma\\,\\mathbb{E}[N^{2}] + \\gamma\\,\\mathbb{E}[N],\n$$\n得到\n$$\n\\mathbb{E}[N^{2}] = \\frac{1}{2\\gamma}\\Big(2r\\,\\mathbb{E}[NS] + r\\,p_{on} + \\gamma\\,\\mathbb{E}[N]\\Big)\n= \\frac{r^{2} p_{on} (k_{on}+\\gamma)}{\\gamma^{2}\\,(k_{on}+k_{off}+\\gamma)} + \\frac{r\\,p_{on}}{\\gamma}.\n$$\n因此，方差为\n$$\n\\mathrm{Var}(N) = \\mathbb{E}[N^{2}] - \\big(\\mathbb{E}[N]\\big)^{2}\n= \\frac{r\\,p_{on}}{\\gamma} + \\frac{r^{2} p_{on} (k_{on}+\\gamma)}{\\gamma^{2}\\,(k_{on}+k_{off}+\\gamma)} - \\left(\\frac{r\\,p_{on}}{\\gamma}\\right)^{2}.\n$$\n代入 $p_{on}=\\frac{k_{on}}{k_{on}+k_{off}}$ 并化简多余的项，\n$$\n\\mathrm{Var}(N) = \\mathbb{E}[N] + \\frac{r^{2}\\,k_{on}\\,k_{off}}{\\gamma\\,(k_{on}+k_{off})^{2}\\,(k_{on}+k_{off}+\\gamma)}.\n$$\n因此，法诺因子 $F\\equiv \\mathrm{Var}(N)/\\mathbb{E}[N]$ 为\n$$\nF = 1 + \\frac{r^{2}\\,k_{on}\\,k_{off}}{\\gamma\\,(k_{on}+k_{off})^{2}\\,(k_{on}+k_{off}+\\gamma)}\\cdot \\frac{1}{\\mathbb{E}[N]}\n= 1 + \\frac{r\\,k_{off}}{(k_{on}+k_{off})\\,(k_{on}+k_{off}+\\gamma)}.\n$$\n\n为模拟因组蛋白H3赖氨酸27乙酰化(H3K27ac)导致的启动子活性的表观遗传增加，我们令 $k_{on}\\mapsto \\alpha\\,k_{on}$ 且 $\\alpha1$，并保持 $r$，$k_{off}$ 和 $\\gamma$ 不变。修饰后的法诺因子为\n$$\nF(\\alpha) = 1 + \\frac{r\\,k_{off}}{(\\alpha k_{on}+k_{off})\\,(\\alpha k_{on}+k_{off}+\\gamma)}.\n$$\n基线（修饰前）的法诺因子为\n$$\nF(1) = 1 + \\frac{r\\,k_{off}}{(k_{on}+k_{off})\\,(k_{on}+k_{off}+\\gamma)}.\n$$\n因此，精确的闭式比值为\n$\n\\displaystyle\n\\frac{F(\\alpha)}{F(1)} = \\frac{1 + \\frac{r\\,k_{off}}{(\\alpha k_{on}+k_{off})\\,(\\alpha k_{on}+k_{off}+\\gamma)}}{1 + \\frac{r\\,k_{off}}{(k_{on}+k_{off})\\,(k_{on}+k_{off}+\\gamma)}}.\n$\n该表达式表明，增加 $\\alpha$ (即增加 $k_{on}$) 会减小分子中的第二项，从而降低 $F(\\alpha)$ 和该比值，这与增强的H3K27ac在增加均值的同时减少转录爆发噪声的生物学预期相符。", "answer": "$$\\boxed{\\begin{pmatrix}\\dfrac{r\\,k_{on}}{\\gamma\\,(k_{on}+k_{off})}  \\dfrac{r\\,k_{on}}{\\gamma\\,(k_{on}+k_{off})} + \\dfrac{r^{2}\\,k_{on}\\,k_{off}}{\\gamma\\,(k_{on}+k_{off})^{2}\\,(k_{on}+k_{off}+\\gamma)}  \\dfrac{1 + \\dfrac{r\\,k_{off}}{(\\alpha k_{on}+k_{off})\\,(\\alpha k_{on}+k_{off}+\\gamma)}}{1 + \\dfrac{r\\,k_{off}}{(k_{on}+k_{off})\\,(k_{on}+k_{off}+\\gamma)}}\\end{pmatrix}}$$", "id": "2847319"}, {"introduction": "提出一个科学假说，例如“EZH2敲低会促进Th17细胞分化”，这仅仅是第一步，一项成功的实验还需要精心的设计以确保结果在统计学上是稳健的。本练习将引导您完成功效分析（power analysis），这是实验设计中的关键步骤，用以确定可靠地检测出预期效应所需的最小细胞数量。您将把基于细胞分类的二项分布模型的统计学原理，应用于一个真实的免疫学场景，这项动手计算连接了理论知识与实验操作，使您具备设计出决定性且高效实验所需的统计学前瞻能力。[@problem_id:2847314]", "problem": "您正在评估组蛋白甲基转移酶 Enhancer of Zeste Homolog 2 (EZH2)（Polycomb 抑制复合物 2 的一个核心组分）如何通过表观遗传学调控 T 辅助细胞 17 (Th17) 的谱系分化。在一项流式细胞术检测中，如果单个测量细胞表达白细胞介素-17A，则将其分类为 Th17 阳性。设给定条件下的每个细胞为一个独立的伯努利试验，其成功概率等于该条件下的 Th17 分化频率，因此大小为 $n$ 的样本中 Th17 阳性细胞的总数服从二项分布。在对照组小干扰 RNA (siRNA) 条件下的先前测量给出了 $p_{0} = 0.12$ 的基线 Th17 频率。基于先前关于 EZH2 介导的抑制作用的机理数据，您计划进行一个双臂实验，每臂细胞数相等，以检测 EZH2 敲低后 Th17 频率出现 $20\\%$ 的相对增加，即备择频率为 $p_{1} = 1.2\\,p_{0}$。假设在显著性水平 $\\alpha = 0.05$ 下进行双侧假设检验，目标功效至少为 $0.8$。使用大样本正态近似二项模型，对每臂样本量相等的两个独立比例的相等性进行检验。\n\n从二项模型和中心极限定理的定义出发，并且不使用任何未经推导的快捷公式，推导一个满足设计标准的最小每臂样本量 $n$ 的解析表达式。然后，根据上述数值进行数值计算，并报告满足要求的最小整数 $n$。将最终答案表示为每臂所需的最小整数细胞数。", "solution": "所述问题定义明确且内部一致。它提出了实验设计中的一个标准任务——双样本比例检验的功效计算。所有必要的参数都已提供，并且该场景在免疫学和分子生物学的背景下是科学合理的。因此，我们可以直接进行推导。\n\n设 $n$ 为两个实验臂中每臂的样本量。设 $X_0$ 和 $X_1$ 分别表示对照臂（siRNA 对照）和处理臂（EZH2 敲低）中 Th17 阳性细胞的数量。根据问题陈述，每个样本中阳性细胞的数量服从二项分布。\n$$\nX_0 \\sim \\text{Binomial}(n, p_0)\n$$\n$$\nX_1 \\sim \\text{Binomial}(n, p_1)\n$$\n此处，$p_0$ 是基线 Th17 频率，$p_1$ 是 EZH2 敲低后的频率。相应的样本比例为 $\\hat{p}_0 = X_0/n$ 和 $\\hat{p}_1 = X_1/n$。\n\n对于足够大的样本量 $n$，中心极限定理允许用正态分布来近似二项分布。样本比例的分布可近似为：\n$$\n\\hat{p}_0 \\approx \\mathcal{N}\\left(p_0, \\frac{p_0(1-p_0)}{n}\\right)\n$$\n$$\n\\hat{p}_1 \\approx \\mathcal{N}\\left(p_1, \\frac{p_1(1-p_1)}{n}\\right)\n$$\n由于两个样本是独立的，样本比例之差 $\\hat{p}_1 - \\hat{p}_0$ 的分布也近似于正态分布，其均值为 $p_1 - p_0$，方差等于各自方差之和：\n$$\n\\hat{p}_1 - \\hat{p}_0 \\approx \\mathcal{N}\\left(p_1 - p_0, \\frac{p_0(1-p_0)}{n} + \\frac{p_1(1-p_1)}{n}\\right)\n$$\n我们进行双侧假设检验来评估这两个比例是否相等。原假设和备择假设为：\n$$\nH_0: p_1 = p_0\n$$\n$$\nH_1: p_1 \\neq p_0\n$$\n在原假设 $H_0$ 下，两个比例等于某个公共值 $p$。差值的方差简化为 $\\frac{2p(1-p)}{n}$。通过标准化观测到的差值 $\\hat{p}_1 - \\hat{p}_0$ 来构建检验统计量。对于标准误，我们使用公共比例 $p$ 的合并估计值，即 $\\hat{p}_{\\text{pool}} = \\frac{X_0 + X_1}{2n} = \\frac{\\hat{p}_0 + \\hat{p}_1}{2}$。检验统计量为：\n$$\nZ = \\frac{\\hat{p}_1 - \\hat{p}_0}{\\sqrt{\\hat{p}_{\\text{pool}}(1-\\hat{p}_{\\text{pool}})\\left(\\frac{1}{n} + \\frac{1}{n}\\right)}} = \\frac{\\hat{p}_1 - \\hat{p}_0}{\\sqrt{\\frac{2\\hat{p}_{\\text{pool}}(1-\\hat{p}_{\\text{pool}})}{n}}}\n$$\n在 $H_0$ 下，此统计量 $Z$ 服从标准正态分布 $\\mathcal{N}(0, 1)$。\n\n检验在显著性水平 $\\alpha$ 下进行。对于双侧检验，如果检验统计量的绝对值超过临界值 $z_{\\alpha/2}$，我们就拒绝 $H_0$，其中 $z_{\\alpha/2}$ 是标准正态分布的上 $\\alpha/2$ 分位数。也就是说，如果 $|Z|  z_{\\alpha/2}$，我们就拒绝 $H_0$。\n\n功效是在 $H_1$ 为真时正确拒绝 $H_0$ 的概率。它用 $1-\\beta$ 表示，其中 $\\beta$ 是第二类错误的概率。功效由下式给出：\n$$\n\\text{Power} = P(\\text{Reject } H_0 \\mid H_1 \\text{ is true}) = P(|Z|  z_{\\alpha/2} \\mid H_1)\n$$\n对于在实验前进行的功效计算，我们没有样本数据来计算 $\\hat{p}_{\\text{pool}}$。因此，我们用其期望值来代替它。在 $H_1$ 下，$\\hat{p}_{\\text{pool}}$ 的期望值是 $\\frac{p_0+p_1}{2}$，我们将其表示为 $\\bar{p}$。因此，拒绝标准近似为 $|\\hat{p}_1 - \\hat{p}_0|  z_{\\alpha/2}\\sqrt{\\frac{2\\bar{p}(1-\\bar{p})}{n}}$。\n\n我们设计实验所针对的具体备择假设是 $p_1 = 1.2 p_0  p_0$。在这种情况下，$\\hat{p}_1 - \\hat{p}_0$ 的分布以一个正值 $p_1 - p_0  0$ 为中心。通过观测到 $\\hat{p}_1 - \\hat{p}_0$ 的一个大的负值（即在下尾部）来拒绝 $H_0$ 的概率可以忽略不计。因此，功效主要由拒绝域的上尾部决定：\n$$\n1-\\beta \\approx P\\left(\\hat{p}_1 - \\hat{p}_0  z_{\\alpha/2}\\sqrt{\\frac{2\\bar{p}(1-\\bar{p})}{n}} \\mid H_1\\right)\n$$\n为了评估这个概率，我们必须使用 $\\hat{p}_1 - \\hat{p}_0$ 在 $H_1$ 下的分布对其进行标准化。在 $H_1$ 下，均值为 $p_1 - p_0$，方差为 $\\sigma^2_{H_1} = \\frac{p_0(1-p_0) + p_1(1-p_1)}{n}$。\n$$\n1-\\beta \\approx P\\left(\\frac{(\\hat{p}_1 - \\hat{p}_0) - (p_1 - p_0)}{\\sqrt{\\frac{p_0(1-p_0) + p_1(1-p_1)}{n}}}  \\frac{z_{\\alpha/2}\\sqrt{\\frac{2\\bar{p}(1-\\bar{p})}{n}} - (p_1-p_0)}{\\sqrt{\\frac{p_0(1-p_0) + p_1(1-p_1)}{n}}}\\right)\n$$\n概率内部左侧的表达式是一个标准正态变量。我们称之为 $Z'$。对于 $P(Z'  k) = 1-\\beta$，参数 $k$ 必须等于 $z_{1-\\beta} = -z_{\\beta}$。因此：\n$$\n\\frac{z_{\\alpha/2}\\sqrt{\\frac{2\\bar{p}(1-\\bar{p})}{n}} - (p_1-p_0)}{\\sqrt{\\frac{p_0(1-p_0) + p_1(1-p_1)}{n}}} = -z_{\\beta}\n$$\n现在我们求解每臂的样本量 $n$。\n$$\nz_{\\alpha/2}\\frac{\\sqrt{2\\bar{p}(1-\\bar{p})}}{\\sqrt{n}} - (p_1-p_0) = -z_{\\beta}\\frac{\\sqrt{p_0(1-p_0) + p_1(1-p_1)}}{\\sqrt{n}}\n$$\n$$\np_1-p_0 = \\frac{1}{\\sqrt{n}} \\left( z_{\\alpha/2}\\sqrt{2\\bar{p}(1-\\bar{p})} + z_{\\beta}\\sqrt{p_0(1-p_0) + p_1(1-p_1)} \\right)\n$$\n两边平方并分离出 $n$，得到每臂最小样本量的解析表达式：\n$$\nn = \\frac{\\left( z_{\\alpha/2}\\sqrt{2\\bar{p}(1-\\bar{p})} + z_{\\beta}\\sqrt{p_0(1-p_0) + p_1(1-p_1)} \\right)^2}{(p_1-p_0)^2}\n$$\n现在，我们将指定的数值代入此表达式。给定的值为：\n- 基线频率：$p_0 = 0.12$\n- 备择频率：$p_1 = 1.2 \\times p_0 = 1.2 \\times 0.12 = 0.144$\n- 显著性水平：$\\alpha = 0.05$\n- 功效：$1-\\beta = 0.8$，所以 $\\beta = 0.2$\n\n由此，我们找到标准正态分布的相应分位数：\n- 对于双侧检验，$z_{\\alpha/2} = z_{0.05/2} = z_{0.025} \\approx 1.95996$。\n- 对于功效，$z_{\\beta} = z_{0.2} \\approx 0.84162$。\n\n我们计算公式所需的各组成部分：\n- 比例之差：$p_1 - p_0 = 0.144 - 0.12 = 0.024$\n- 用于检验统计量方差的合并比例：$\\bar{p} = \\frac{p_0 + p_1}{2} = \\frac{0.12 + 0.144}{2} = 0.132$\n- 检验统计量的方差项：$2\\bar{p}(1-\\bar{p}) = 2 \\times 0.132 \\times (1 - 0.132) = 0.229152$\n- 备择分布的方差项：$p_0(1-p_0) + p_1(1-p_1) = 0.12(0.88) + 0.144(0.856) = 0.1056 + 0.123264 = 0.228864$\n\n将这些值代入 $n$ 的表达式中：\n$$\nn = \\frac{\\left( 1.95996 \\sqrt{0.229152} + 0.84162 \\sqrt{0.228864} \\right)^2}{(0.024)^2}\n$$\n$$\nn = \\frac{\\left( 1.95996 \\times 0.478698 + 0.84162 \\times 0.478397 \\right)^2}{0.000576}\n$$\n$$\nn = \\frac{\\left( 0.93823 + 0.40263 \\right)^2}{0.000576}\n$$\n$$\nn = \\frac{(1.34086)^2}{0.000576} = \\frac{1.79791}{0.000576} \\approx 3121.37\n$$\n由于细胞数量必须是整数，我们必须对该值取上整，以确保功效至少为 $0.8$。\n$$\nn = \\lceil 3121.37 \\rceil = 3122\n$$\n因此，为达到指定的设计标准，每臂所需的最小细胞数为 $3122$。", "answer": "$$\n\\boxed{3122}\n$$", "id": "2847314"}]}