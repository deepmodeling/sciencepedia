{"hands_on_practices": [{"introduction": "估算造血干细胞（HSC）等稀有细胞的频率是免疫学研究中的一项基本挑战。此练习将指导您应用经典的极限稀释分析法，这是一种通过在不同剂量下观察功能性“成功”事件来量化稀有祖细胞频率的强大实验策略。通过应用泊松统计和最大似然估计原理，您将从假设的实验数据中推导出长期造血干细胞（LT-HSC）的频率，并为其构建置信区间，从而掌握将原始实验结果转化为严谨统计推断的核心技能 [@problem_id:2852659]。", "problem": "一个造血干细胞移植实验室进行了一项极限稀释实验，以估计长期造血干细胞（LT-HSCs）的频率。在单击模型下，受体植入成功的条件是当且仅当其接受了至少一个LT-HSC。假设LT-HSCs在供体细胞中是稀有且独立分布的，因此大小为 $c$ 的接种物中LT-HSCs的数量服从均值为 $\\lambda c$ 的泊松分布，其中 $\\lambda$ 是LT-HSC的频率，单位为 $\\text{cells}^{-1}$。因此，对于给定的剂量 $c$，受体未植入成功的概率是 $\\exp(-\\lambda c)$。\n\n在一项实验中，受体在四种不同的供体细胞剂量下进行移植，每个剂量组有 $n_i = 10$ 只小鼠。剂量及对应的未植入成功受体数量（$x_i$）为：\n- $c_1 = 2.231435513 \\times 10^{4}$，其中 $x_1 = 8$，\n- $c_2 = 5.108256238 \\times 10^{4}$，其中 $x_2 = 6$，\n- $c_3 = 9.162907319 \\times 10^{4}$，其中 $x_3 = 4$，\n- $c_4 = 1.609437912 \\times 10^{5}$，其中 $x_4 = 2$。\n\n从独立性假设和稀有事件的泊松定律出发，将每个剂量组视为独立的伯努利试验，其未植入成功的概率为剂量相关的 $\\exp(-\\lambda c_i)$，通过写出并最大化跨剂量的联合对数似然函数，推导出 $\\lambda$ 的最大似然估计。然后，使用观测到的费雪信息（即在最大似然估计值处计算的对数似然函数的负二阶导数），通过瓦尔德近似方法为 $\\lambda$ 构建一个近似的 $95\\%$ 置信区间。\n\n按顺序报告最终结果的三个量：点估计 $\\hat{\\lambda}$、置信下界和置信上界。将所有三个答案以 $\\text{cells}^{-1}$ 为单位表示，并将每个答案四舍五入到四位有效数字。在最终答案中不提供任何中间值。", "solution": "该问题要求使用最大似然法估计造血干细胞频率 $\\lambda$，并为该估计构建一个置信区间。\n\n首先，必须为观测数据构建似然函数。对于每个剂量组 $i$（其中 $i \\in \\{1, 2, 3, 4\\}$），我们有 $n_i$ 个受体。每个受体代表一个独立的伯努利试验。结果是二元的：植入成功或不成功。我们已知 $n_i$ 个受体中有 $x_i$ 个未植入成功。根据单击泊松模型，对于给定的剂量 $c_i$，未植入成功的概率为 $p_i = \\exp(-\\lambda c_i)$。因此，植入成功的概率是 $1 - p_i = 1 - \\exp(-\\lambda c_i)$。\n\n在一组 $n_i$ 只小鼠中，未植入成功的数量 $x_i$ 服从二项分布，其概率质量函数为：\n$$ L_i(\\lambda) = \\binom{n_i}{x_i} p_i^{x_i} (1-p_i)^{n_i-x_i} = \\binom{n_i}{x_i} [\\exp(-\\lambda c_i)]^{x_i} [1 - \\exp(-\\lambda c_i)]^{n_i-x_i} $$\n由于四个剂量组是独立的，总似然函数 $L(\\lambda)$ 是各个似然函数的乘积：\n$$ L(\\lambda) = \\prod_{i=1}^{4} L_i(\\lambda) = \\prod_{i=1}^{4} \\binom{n_i}{x_i} \\exp(-\\lambda c_i x_i) [1 - \\exp(-\\lambda c_i)]^{n_i-x_i} $$\n为了找到 $\\lambda$ 的最大似然估计（MLE），更方便的做法是最大化对数似然函数 $\\ell(\\lambda) = \\ln(L(\\lambda))$：\n$$ \\ell(\\lambda) = \\sum_{i=1}^{4} \\left[ \\ln\\binom{n_i}{x_i} - \\lambda c_i x_i + (n_i - x_i) \\ln(1 - \\exp(-\\lambda c_i)) \\right] $$\nMLE $\\hat{\\lambda}$ 是通过将对数似然函数关于 $\\lambda$ 的一阶导数（得分函数）设为零来找到的。\n$$ \\frac{d\\ell}{d\\lambda} = \\sum_{i=1}^{4} \\left[ -c_i x_i + (n_i - x_i) \\frac{d}{d\\lambda}\\ln(1 - \\exp(-\\lambda c_i)) \\right] $$\n$$ \\frac{d\\ell}{d\\lambda} = \\sum_{i=1}^{4} \\left[ -c_i x_i + (n_i - x_i) \\frac{c_i \\exp(-\\lambda c_i)}{1 - \\exp(-\\lambda c_i)} \\right] $$\n令 $\\frac{d\\ell}{d\\lambda} = 0$：\n$$ \\sum_{i=1}^{4} c_i \\left[ -x_i + \\frac{(n_i - x_i) \\exp(-\\lambda c_i)}{1 - \\exp(-\\lambda c_i)} \\right] = 0 $$\n这个方程可以重新整理为：\n$$ \\sum_{i=1}^{4} c_i \\frac{-x_i(1 - \\exp(-\\lambda c_i)) + (n_i - x_i) \\exp(-\\lambda c_i)}{1 - \\exp(-\\lambda c_i)} = \\sum_{i=1}^{4} c_i \\frac{n_i \\exp(-\\lambda c_i) - x_i}{1 - \\exp(-\\lambda c_i)} = 0 $$\n虽然这个方程通常需要数值求解，但所提供的数据揭示了一个特殊的结构。观测到的未植入成功小鼠的比例为 $x_1/n_1 = 8/10 = 0.8$，$x_2/n_2 = 6/10 = 0.6$，$x_3/n_3 = 4/10 = 0.4$，以及 $x_4/n_4 = 2/10 = 0.2$。让我们检验是否存在一个估计值 $\\hat{\\lambda}$，使得模型概率 $\\exp(-\\hat{\\lambda} c_i)$ 与这些观测比例相匹配。如果 $\\hat{\\lambda} = 1 \\times 10^{-5} \\, \\text{cells}^{-1}$，则该条件成立，因为：\n- $\\hat{\\lambda} c_1 = (10^{-5}) (2.231435513 \\times 10^4) = 0.2231435513 = \\ln(1.25)$，所以 $\\exp(-\\hat{\\lambda} c_1) = 1/1.25 = 0.8$。\n- $\\hat{\\lambda} c_2 = (10^{-5}) (5.108256238 \\times 10^4) = 0.5108256238 = \\ln(5/3)$，所以 $\\exp(-\\hat{\\lambda} c_2) = 3/5 = 0.6$。\n- $\\hat{\\lambda} c_3 = (10^{-5}) (9.162907319 \\times 10^4) = 0.9162907319 = \\ln(2.5)$，所以 $\\exp(-\\hat{\\lambda} c_3) = 1/2.5 = 0.4$。\n- $\\hat{\\lambda} c_4 = (10^{-5}) (1.609437912 \\times 10^5) = 1.609437912 = \\ln(5)$，所以 $\\exp(-\\hat{\\lambda} c_4) = 1/5 = 0.2$。\n对于这个 $\\lambda$ 值，项 $n_i \\exp(-\\lambda c_i) - x_i$ 对于所有的 $i$ 都变为 $n_i(x_i/n_i) - x_i = x_i - x_i = 0$。因此，得分方程求和中的每一项都为零，该方程得到满足。所以，最大似然估计为 $\\hat{\\lambda} = 1 \\times 10^{-5} \\, \\text{cells}^{-1}$。\n\n接下来，我们使用瓦尔德近似构建一个 $95\\%$ 的置信区间：$\\hat{\\lambda} \\pm z_{0.025} \\sqrt{\\widehat{\\text{Var}}(\\hat{\\lambda})}$。MLE的方差可以通过观测到的费雪信息 $J(\\hat{\\lambda})$ 的倒数来近似，而费雪信息是在 $\\hat{\\lambda}$ 处计算的对数似然函数的负二阶导数。\n$$ J(\\lambda) = -\\frac{d^2\\ell}{d\\lambda^2} $$\n让我们计算二阶导数：\n$$ \\frac{d^2\\ell}{d\\lambda^2} = \\frac{d}{d\\lambda} \\sum_{i=1}^{4} (n_i-x_i) c_i \\frac{\\exp(-\\lambda c_i)}{1 - \\exp(-\\lambda c_i)} $$\n令 $u_i = \\exp(-\\lambda c_i)$。$\\frac{u_i}{1-u_i}$ 关于 $\\lambda$ 的导数是 $\\frac{d}{d\\lambda} \\left(\\frac{u_i}{1-u_i}\\right) = \\frac{-c_i u_i}{(1-u_i)^2} = \\frac{-c_i \\exp(-\\lambda c_i)}{(1 - \\exp(-\\lambda c_i))^2}$。\n$$ \\frac{d^2\\ell}{d\\lambda^2} = \\sum_{i=1}^{4} (n_i - x_i) c_i \\left(\\frac{-c_i \\exp(-\\lambda c_i)}{(1 - \\exp(-\\lambda c_i))^2}\\right) = - \\sum_{i=1}^{4} \\frac{(n_i - x_i) c_i^2 \\exp(-\\lambda c_i)}{(1 - \\exp(-\\lambda c_i))^2} $$\n观测到的费雪信息是：\n$$ J(\\lambda) = \\sum_{i=1}^{4} \\frac{(n_i - x_i) c_i^2 \\exp(-\\lambda c_i)}{(1 - \\exp(-\\lambda c_i))^2} $$\n我们在 $\\hat{\\lambda} = 10^{-5}$ 处计算这个值。在这个值上，$x_i = n_i \\exp(-\\hat{\\lambda} c_i)$，所以 $n_i - x_i = n_i(1 - \\exp(-\\hat{\\lambda} c_i))$。将此代入 $J(\\hat{\\lambda})$ 的表达式中，得到：\n$$ J(\\hat{\\lambda}) = \\sum_{i=1}^{4} \\frac{n_i(1 - \\exp(-\\hat{\\lambda} c_i)) c_i^2 \\exp(-\\hat{\\lambda} c_i)}{(1 - \\exp(-\\hat{\\lambda} c_i))^2} = \\sum_{i=1}^{4} \\frac{n_i c_i^2 \\exp(-\\hat{\\lambda} c_i)}{1 - \\exp(-\\hat{\\lambda} c_i)} $$\n使用 $n_i=10$，$\\hat{\\lambda} = 10^{-5}$，以及之前计算出的 $c_i$ 和 $\\exp(-\\hat{\\lambda} c_i)$ 的值：\n$J(\\hat{\\lambda}) = 10 \\left[ \\frac{c_1^2 (0.8)}{0.2} + \\frac{c_2^2 (0.6)}{0.4} + \\frac{c_3^2 (0.4)}{0.6} + \\frac{c_4^2 (0.2)}{0.8} \\right] = 10 \\left[ 4 c_1^2 + 1.5 c_2^2 + \\frac{2}{3} c_3^2 + 0.25 c_4^2 \\right]$\n使用 $c_i$ 关于 $\\hat{\\lambda}$ 的精确表达式：$c_i = \\ln(k_i)/\\hat{\\lambda}$，其中 $k_i = 1/\\exp(-\\hat{\\lambda} c_i)$。\n$k_1=1.25$, $k_2=5/3$, $k_3=2.5$, $k_4=5$.\n求和中的各项简化为 $\\frac{10}{\\hat{\\lambda}^2} \\sum_{i=1}^{4} \\frac{(\\ln(k_i))^2}{k_i - 1}$。\n$i=1$ 的被加数：$4(\\ln(1.25))^2 \\approx 0.1991705$\n$i=2$ 的被加数：$1.5(\\ln(5/3))^2 \\approx 0.3914142$\n$i=3$ 的被加数：$(2/3)(\\ln(2.5))^2 \\approx 0.5597253$\n$i=4$ 的被加数：$0.25(\\ln(5))^2 \\approx 0.6475736$\n总和约为 $1.7978836$。\n$$ J(\\hat{\\lambda}) = \\frac{10}{(10^{-5})^2} (1.7978836) = 1.7978836 \\times 10^{11} $$\n$\\hat{\\lambda}$ 的估计方差是 $\\widehat{\\text{Var}}(\\hat{\\lambda}) = J(\\hat{\\lambda})^{-1} = (1.7978836 \\times 10^{11})^{-1} \\approx 5.56209 \\times 10^{-12}$。\n标准误是 $\\text{SE}(\\hat{\\lambda}) = \\sqrt{\\widehat{\\text{Var}}(\\hat{\\lambda})} \\approx \\sqrt{5.56209 \\times 10^{-12}} \\approx 2.358408 \\times 10^{-6}$。\n对于一个 $95\\%$ 的置信区间，$z_{0.025} \\approx 1.959964$。误差范围是 $ME = z_{0.025} \\times \\text{SE}(\\hat{\\lambda}) \\approx 1.959964 \\times 2.358408 \\times 10^{-6} \\approx 4.62237 \\times 10^{-6}$。\n置信区间是 $\\hat{\\lambda} \\pm ME$：\n下界：$1 \\times 10^{-5} - 4.62237 \\times 10^{-6} = 10 \\times 10^{-6} - 4.62237 \\times 10^{-6} = 5.37763 \\times 10^{-6}$。\n上界：$1 \\times 10^{-5} + 4.62237 \\times 10^{-6} = 10 \\times 10^{-6} + 4.62237 \\times 10^{-6} = 1.462237 \\times 10^{-5}$。\n\n将结果四舍五入到四位有效数字：\n- 点估计 $\\hat{\\lambda} = 1.000 \\times 10^{-5}$。\n- 置信下界 = $5.378 \\times 10^{-6}$。\n- 置信上界 = $1.462 \\times 10^{-5}$。", "answer": "$$ \\boxed{ \\begin{pmatrix} 1.000 \\times 10^{-5} & 5.378 \\times 10^{-6} & 1.462 \\times 10^{-5} \\end{pmatrix} } $$", "id": "2852659"}, {"introduction": "除了静态地量化细胞数量，理解细胞群体的动态平衡——即细胞的生成、增殖和损失速率——对于揭示免疫系统的运作机制至关重要。本练习利用B细胞发育过程中产生的天然分子标记——KREC（Kappa-deleting Recombination Excision Circles）——来构建一个群体动态模型。您将从基本原理出发，推导出一个计算新生B细胞产出率的方程，这能够让您亲身体验如何将生物学假设转化为一个可用于定量分析和预测的数学框架 [@problem_id:2852642]。", "problem": "您正在分析κ缺失重组切除环 (Kappa-deleting Recombination Excision Circles, KREC)，它是在发育中的B细胞进行免疫球蛋白轻链受体编辑过程中产生的附加型DNA副产物。KREC在细胞分裂过程中不被复制，并假定在所考虑的时间范围内能稳定保持而不降解。在一个处于稳态且充分混合的初始B细胞区室中，从骨髓新生成的初始B细胞以恒定速率进入该区室，而区室内的细胞可能会分裂和丢失（通过死亡或移出）。设$N(t)$为初始B细胞的总数，$K(t)$为该区室内KREC的总数。假设：\n- 每个新生成的初始B细胞在进入时平均携带$k_0$个KREC（例如，如果比例为$f$的进入细胞携带正好一个KREC，则$k_0 = f$）。\n- KREC在细胞分裂期间不复制，并在子细胞间平均分配，因此总KREC数$K(t)$在分裂过程中是守恒的。\n- 分裂以单细胞速率$r$（单位：$\\text{day}^{-1}$）发生，丢失以单细胞速率$d$（单位：$\\text{day}^{-1}$）发生。\n- 该区室处于稳态。\n\n将每个初始B细胞的稳态平均KREC含量定义为$C = K/N$。仅使用这些假设和守恒定律，从第一性原理推导出骨髓输出量（即初始B细胞的稳态生成速率，记为$S$，单位：细胞/天）的表达式，用$r$、$N$、$k_0$和$C$表示。\n\n现提供两个队列的测量值：\n\n年轻队列：\n- 初始B细胞总池大小：$N_{\\text{y}} = 2.0 \\times 10^{9}$ 个细胞。\n- 单细胞分裂速率：$r_{\\text{y}} = 0.004 \\ \\text{day}^{-1}$。\n- 每个细胞的平均KREC数：$C_{\\text{y}} = 0.12$ 环/细胞。\n\n老年队列：\n- 初始B细胞总池大小：$N_{\\text{a}} = 1.2 \\times 10^{9}$ 个细胞。\n- 单细胞分裂速率：$r_{\\text{a}} = 0.002 \\ \\text{day}^{-1}$。\n- 每个细胞的平均KREC数：$C_{\\text{a}} = 0.05$ 环/细胞。\n\n假设每个新生成的初始B细胞的平均KREC含量在不同队列中是不变的，等于$k_0 = 0.40$环/新生成初始B细胞。使用您推导的表达式，计算年轻队列和老年队列的骨髓输出量之比，$S_{\\text{y}} / S_{\\text{a}}$。请提供一个精确值（不要四舍五入）。最终答案应该是一个无单位的纯数。", "solution": "此问题经过严格验证，被认为是有效的，因为它具有科学依据、问题设定良好、客观且内部一致。我们将开始进行推导和求解。\n\n该问题要求推导初始B细胞的稳态生成速率$S$的表达式，并随后计算两个队列中该速率的比值。我们首先为区室内的初始B细胞总数$N(t)$和κ缺失重组切除环(KREC)总数$K(t)$建立守恒方程。\n\n设$N(t)$为时刻$t$的初始B细胞总数，$K(t)$为KREC总数。该系统的动力学由以下过程决定：\n$1$. 来源：新的初始B细胞以恒定速率$S$从骨髓进入区室。每个新细胞平均引入$k_0$个KREC。\n$2$. 分裂：细胞以单细胞速率$r$进行分裂。这会增加细胞数量，但KREC总数保持守恒，因为它们不被复制。\n$3$. 丢失：细胞以单细胞速率$d$从区室中丢失（由于死亡或移出）。这会同时移除细胞及其所含的KREC。\n\n初始B细胞总数的变化率$\\frac{dN}{dt}$由生成、分裂和丢失的平衡给出：\n$$\n\\frac{dN}{dt} = S + rN - dN\n$$\n第一项$S$是来自骨髓的流入。第二项$rN$是通过分裂产生的细胞生成速率。第三项$-dN$是细胞丢失速率。\n\nKREC总数的变化率$\\frac{dK}{dt}$由以下公式描述：\n$$\n\\frac{dK}{dt} = S k_0 - dK\n$$\n第一项$S k_0$代表由来自骨髓的新细胞携带的KREC的流入。第二项$-dK$代表从区室中丢失的KREC。细胞的丢失速率是$dN$。每个细胞的平均KREC数是$C = K/N$。因此，KREC的丢失速率是$d \\cdot N \\cdot (K/N) = dK$。如问题所述，细胞分裂保持KREC总数守恒，因此它不对该方程贡献项。\n\n问题指明系统处于稳态。这意味着$N$和$K$的净变化率均为零：\n$$\n\\frac{dN}{dt} = 0 \\quad \\text{and} \\quad \\frac{dK}{dt} = 0\n$$\n将此条件应用于我们的方程组，得到两个代数方程：\n$$\nS + rN - dN = 0 \\quad \\implies \\quad S = (d - r)N \\quad (1)\n$$\n$$\nS k_0 - dK = 0 \\quad \\implies \\quad S k_0 = dK \\quad (2)\n$$\n此处，$N$和$K$代表它们的稳态值。我们的目标是找到一个用$r$、$N$、$k_0$和稳态平均KREC含量$C = K/N$表示的$S$的表达式。为实现此目标，我们必须消去未知的丢失速率$d$。\n\n从方程$(2)$，我们可以将$d$表示为：\n$$\nd = \\frac{S k_0}{K}\n$$\n问题将每个细胞的平均KREC含量定义为$C = K/N$。因此我们可以写出$K = CN$。将此代入$d$的表达式中：\n$$\nd = \\frac{S k_0}{CN}\n$$\n现在，将这个$d$的表达式代入方程$(1)$：\n$$\nS = \\left(\\frac{S k_0}{CN} - r\\right)N\n$$\n我们继续解这个关于$S$的方程。将右侧的$N$分配进去得到：\n$$\nS = \\frac{S k_0 N}{CN} - rN\n$$\n$$\nS = S \\frac{k_0}{C} - rN\n$$\n为了分离出$S$，我们将所有包含$S$的项移到方程的一边：\n$$\nrN = S \\frac{k_0}{C} - S\n$$\n提出因子$S$：\n$$\nrN = S \\left(\\frac{k_0}{C} - 1\\right)\n$$\n$$\nrN = S \\left(\\frac{k_0 - C}{C}\\right)\n$$\n最后，解出$S$得到所需的骨髓输出量表达式：\n$$\nS = rN \\frac{C}{k_0 - C}\n$$\n这个公式用可测量的量$r$、$N$、$C$以及给定的参数$k_0$来表示稳态生成速率$S$。为了使生成速率$S > 0$具有物理意义，并且已知$r, N, C$均为正值，要求$k_0 - C > 0$，即$k_0 > C$。问题中描述的两个队列都满足此条件（$k_0 = 0.40$大于$C_{\\text{y}} = 0.12$和$C_{\\text{a}} = 0.05$）。\n\n我们的任务是计算年轻队列和老年队列的骨髓输出量之比，$S_{\\text{y}} / S_{\\text{a}}$。对每个队列使用推导出的公式：\n$$\nS_{\\text{y}} = r_{\\text{y}} N_{\\text{y}} \\frac{C_{\\text{y}}}{k_0 - C_{\\text{y}}}\n$$\n$$\nS_{\\text{a}} = r_{\\text{a}} N_{\\text{a}} \\frac{C_{\\text{a}}}{k_0 - C_{\\text{a}}}\n$$\n因此，比值为：\n$$\n\\frac{S_{\\text{y}}}{S_{\\text{a}}} = \\frac{r_{\\text{y}} N_{\\text{y}} \\frac{C_{\\text{y}}}{k_0 - C_{\\text{y}}}}{r_{\\text{a}} N_{\\text{a}} \\frac{C_{\\text{a}}}{k_0 - C_{\\text{a}}}} = \\left(\\frac{r_{\\text{y}} N_{\\text{y}}}{r_{\\text{a}} N_{\\text{a}}}\\right) \\left(\\frac{C_{\\text{y}}}{C_{\\text{a}}}\\right) \\left(\\frac{k_0 - C_{\\text{a}}}{k_0 - C_{\\text{y}}}\\right)\n$$\n我们现在代入提供的数值：\n对于年轻队列：$N_{\\text{y}} = 2.0 \\times 10^{9}$，$r_{\\text{y}} = 0.004 \\ \\text{day}^{-1}$，$C_{\\text{y}} = 0.12$。\n对于老年队列：$N_{\\text{a}} = 1.2 \\times 10^{9}$，$r_{\\text{a}} = 0.002 \\ \\text{day}^{-1}$，$C_{\\text{a}} = 0.05$。\n不变参数为$k_0 = 0.40$。\n\n让我们计算比率的每个组成部分：\n$$\n\\frac{r_{\\text{y}} N_{\\text{y}}}{r_{\\text{a}} N_{\\text{a}}} = \\frac{(0.004) \\cdot (2.0 \\times 10^{9})}{(0.002) \\cdot (1.2 \\times 10^{9})} = \\frac{0.008}{0.0024} = \\frac{80}{24} = \\frac{10}{3}\n$$\n$$\n\\frac{C_{\\text{y}}}{C_{\\text{a}}} = \\frac{0.12}{0.05} = \\frac{12}{5}\n$$\n$$\n\\frac{k_0 - C_{\\text{a}}}{k_0 - C_{\\text{y}}} = \\frac{0.40 - 0.05}{0.40 - 0.12} = \\frac{0.35}{0.28} = \\frac{35}{28} = \\frac{5}{4}\n$$\n将这些部分相乘得到最终的比率：\n$$\n\\frac{S_{\\text{y}}}{S_{\\text{a}}} = \\left(\\frac{10}{3}\\right) \\left(\\frac{12}{5}\\right) \\left(\\frac{5}{4}\\right)\n$$\n这些项可以简化：\n$$\n\\frac{S_{\\text{y}}}{S_{\\text{a}}} = \\frac{10 \\cdot 12 \\cdot 5}{3 \\cdot 5 \\cdot 4} = \\frac{10 \\cdot (3 \\cdot 4) \\cdot 5}{3 \\cdot 5 \\cdot 4}\n$$\n从分子和分母中约去公因数$3$、$4$和$5$，我们得到：\n$$\n\\frac{S_{\\text{y}}}{S_{\\text{a}}} = 10\n$$\n年轻队列和老年队列的骨髓输出量之比恰好为$10$。", "answer": "$$\n\\boxed{10}\n$$", "id": "2852642"}, {"introduction": "现代单细胞组学技术以前所未有的分辨率揭示了造血过程的复杂图景，但从这些静态快照中提取动态信息，则需要复杂的计算方法。本练习将带您进入RNA速度分析的前沿领域，这是一种通过分析新生（未剪接）和成熟（已剪接）mRNA的比例来预测单细胞未来状态变化方向的技术。您将亲手实现一个算法，利用RNA速度向量构建细胞状态的转移概率模型，并使用独立的谱系追踪数据对其进行验证，从而深入了解如何从计算层面解析细胞的分化轨迹 [@problem_id:2852618]。", "problem": "给定一个概念化的单细胞核糖核酸测序 (scRNA-seq) 设置，该设置专注于造血过程。其中，每个细胞的状态被嵌入一个低维空间，一个RNA速度矢量近似于该细胞状态的瞬时时间导数。其生物学背景是经典的髓系轨迹，即从造血干细胞 (HSC) 经由中间祖细胞到粒细胞-巨噬细胞祖细胞 (GMP)。您的任务是形式化并实现一个算法，利用基于速度对齐的簇间转换来推断从HSC到GMP的定向流，并使用独立的谱系条形码轨迹来验证推断出的转换。\n\n基本基础（待使用的定义和事实）：\n- 造血层级结构包含可表示为簇的祖细胞类别；经典的髓系分化进程在到达GMP之前，会从HSC进展到下游祖细胞。\n- RNA速度近似于基因表达状态的瞬时时间导数，并可被建模为连续嵌入空间中的一个矢量场；矢量投影量化了速度矢量和位移矢量之间的对齐程度。\n- 对于矢量 $\\mathbf{a}$ 和 $\\mathbf{b}$，余弦相似度为 $\\cos(\\theta) = \\dfrac{\\mathbf{a} \\cdot \\mathbf{b}}{\\|\\mathbf{a}\\|\\,\\|\\mathbf{b}\\|}$，其中 $\\cdot$ 是点积，$\\|\\cdot\\|$ 是欧几里得范数。\n- 一个行随机马尔可夫转换矩阵的每一行都包含非负项，且各项之和为 $1$，多步转换概率通过矩阵的整数次幂获得。\n\n问题要求：\n1) 您将按以下固定顺序处理簇：$\\{\\mathrm{HSC}, \\mathrm{MPP}, \\mathrm{CMP}, \\mathrm{GMP}\\}$。对于每个测试用例，您将获得：\n   - 每个簇中单个细胞的一组二维坐标。\n   - 相应的一组这些细胞的二维RNA速度矢量。\n   - 一个独立的、在相同簇之间的谱系条形码转换矩阵，该矩阵是行随机的，且按上述顺序排列。\n2) 令 $\\mathbf{c}_k$ 表示簇 $k$ 的质心，计算为其细胞坐标的算术平均值。对于源簇 $s$ 中的细胞 $i$，其位置为 $\\mathbf{x}_i$，速度为 $\\mathbf{v}_i$，定义到簇 $t$ 的位移为 $\\mathbf{d}_{i,t} = \\mathbf{c}_t - \\mathbf{x}_i$。定义对齐分数 $a_{i,t}$ 如下：\n   - 如果 $\\|\\mathbf{v}_i\\| = 0$ 或 $\\|\\mathbf{d}_{i,t}\\| = 0$，则设 $a_{i,t} = 0$。\n   - 否则，设 $a_{i,t} = \\max\\{0, \\cos(\\theta_{i,t})\\}$，其中 $\\cos(\\theta_{i,t}) = \\dfrac{\\mathbf{v}_i \\cdot \\mathbf{d}_{i,t}}{\\|\\mathbf{v}_i\\|\\,\\|\\mathbf{d}_{i,t}\\|}$。\n   对于每个细胞 $i$，通过以下方式定义其对所有目标 $t \\in \\{\\mathrm{HSC}, \\mathrm{MPP}, \\mathrm{CMP}, \\mathrm{GMP}\\}$ 的单细胞转换概率 $p_{i,t}$：\n   - 如果 $\\sum_t a_{i,t} > 0$，则 $p_{i,t} = \\dfrac{a_{i,t}}{\\sum_{u} a_{i,u}}$。\n   - 否则（完全缺乏正向对齐），使用基于距离的备用方案，温度参数为 $\\sigma$：$p_{i,t} \\propto \\exp\\!\\left(-\\dfrac{\\|\\mathbf{d}_{i,t}\\|}{\\sigma}\\right)$，并进行归一化以使 $\\sum_t p_{i,t} = 1$。使用 $\\sigma = 1.0$。\n3) 簇级转换概率 $P_{s,t}$ 定义为对源簇 $s$ 中所有细胞 $i$ 的 $p_{i,t}$ 取算术平均值。归一化每一行以确保 $\\sum_t P_{s,t} = 1$。将得到的 $4 \\times 4$ 行随机矩阵表示为 $\\mathbf{P}$。\n4) 定义从HSC到GMP的 $k$ 步转换概率为 $\\mathbf{P}^k$ 的 $(\\mathrm{HSC}, \\mathrm{GMP})$ 项。使用 $k = 3$ 来表示从HSC经由中间体到GMP的经典步数。\n5) 定义HSC到GMP流的“定向支持”为一个布尔谓词，当且仅当从HSC到达GMP的3步概率严格大于从HSC到达HSC、MPP或CMP的相应3步概率时，该谓词为真。\n6) 使用谱系条形码进行验证：令 $\\mathbf{B}$ 为给定的条形码转换矩阵。计算 $\\mathbf{P}$ 的HSC行与 $\\mathbf{B}$ 的HSC行之间的Jensen-Shannon散度 (JSD)：\n   - 对于两个在相同支撑集上、各项之和为 $1$ 且具有非负项的离散分布 $\\mathbf{p}$ 和 $\\mathbf{q}$，定义 $\\mathbf{m} = \\dfrac{\\mathbf{p} + \\mathbf{q}}{2}$ 以及使用自然对数的Kullback-Leibler散度为 $\\mathrm{KL}(\\mathbf{p}\\|\\mathbf{m}) = \\sum_j p_j \\log\\!\\left(\\dfrac{p_j}{m_j}\\right)$，并约定 $0 \\log(0/r) = 0$。则 $\\mathrm{JSD}(\\mathbf{p}, \\mathbf{q}) = \\dfrac{1}{2}\\mathrm{KL}(\\mathbf{p}\\|\\mathbf{m}) + \\dfrac{1}{2}\\mathrm{KL}(\\mathbf{q}\\|\\mathbf{m})$。\n   - 如果 $JSD \\le \\tau$，则声明验证通过，阈值 $\\tau = 0.25$。\n7) 数值输出：\n   - 对于每个测试用例，您的程序必须输出一个四元素列表：[定向支持布尔值, 从HSC到GMP的三步概率, HSC行的JSD, 验证布尔值]。\n   - 三步概率和Jensen-Shannon散度必须是实数。将两者四舍五入到6位小数。\n8) 最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表的每个元素是上述的四元素列表。例如：\"[[true,0.123456,0.234567,false],[...],...]\"。\n\n测试套件（三个案例）：\n- 全局常量：$\\sigma = 1.0$, $k = 3$, $\\tau = 0.25$。\n- 簇顺序固定为 [$\\mathrm{HSC}$, $\\mathrm{MPP}$, $\\mathrm{CMP}$, $\\mathrm{GMP}$]。\n\n案例1：\n- 细胞坐标和速度：\n  - HSC 坐标: $[(0.00, 0.00), (-0.10, 0.00), (0.05, 0.02)]$; HSC 速度: $[(0.80, 0.00), (0.70, 0.05), (0.60, -0.02)]$.\n  - MPP 坐标: $[(1.00, 0.00), (1.02, 0.01)]$; MPP 速度: $[(0.70, 0.00), (0.65, 0.01)]$.\n  - CMP 坐标: $[(2.00, 0.00), (2.05, -0.01)]$; CMP 速度: $[(0.60, 0.00), (0.55, 0.00)]$.\n  - GMP 坐标: $[(3.00, 0.00)]$; GMP 速度: $[(0.00, 0.00)]$.\n- 谱系条形码矩阵 $\\mathbf{B}$（行按簇顺序排列，每行总和为 $1$）：\n  - HSC 行: $[0.00, 0.85, 0.10, 0.05]$。\n  - MPP 行: $[0.10, 0.00, 0.70, 0.20]$。\n  - CMP 行: $[0.00, 0.20, 0.00, 0.80]$。\n  - GMP 行: $[0.00, 0.00, 0.00, 1.00]$。\n\n案例2：\n- 细胞坐标和速度：\n  - HSC 坐标: $[(0.00, 0.00), (-0.10, 0.00), (0.05, 0.02)]$; HSC 速度: $[(0.30, 0.00), (-0.10, 0.20), (0.00, 0.00)]$.\n  - MPP 坐标: $[(1.00, 0.00), (1.02, 0.01)]$; MPP 速度: $[(0.60, 0.02), (0.55, 0.00)]$.\n  - CMP 坐标: $[(2.00, 0.00), (2.05, -0.01)]$; CMP 速度: $[(0.50, 0.00), (0.45, 0.00)]$.\n  - GMP 坐标: $[(3.00, 0.00)]$; GMP 速度: $[(0.00, 0.00)]$.\n- 谱系条形码矩阵 $\\mathbf{B}$：\n  - HSC 行: $[0.00, 0.60, 0.25, 0.15]$。\n  - MPP 行: $[0.05, 0.10, 0.65, 0.20]$。\n  - CMP 行: $[0.00, 0.15, 0.05, 0.80]$。\n  - GMP 行: $[0.00, 0.00, 0.00, 1.00]$。\n\n案例3：\n- 细胞坐标和速度：\n  - HSC 坐标: $[(0.00, 0.00), (-0.10, 0.00), (0.05, 0.02)]$; HSC 速度: $[(0.00, 0.00), (0.00, 0.00), (0.00, 0.00)]$.\n  - MPP 坐标: $[(1.00, 0.00), (1.02, 0.01)]$; MPP 速度: $[(0.00, 0.00), (0.00, 0.00)]$.\n  - CMP 坐标: $[(2.00, 0.00), (2.05, -0.01)]$; CMP 速度: $[(0.00, 0.00), (0.00, 0.00)]$.\n  - GMP 坐标: $[(3.00, 0.00)]$; GMP 速度: $[(0.00, 0.00)]$.\n- 谱系条形码矩阵 $\\mathbf{B}$：\n  - HSC 行: $[0.40, 0.30, 0.20, 0.10]$。\n  - MPP 行: $[0.20, 0.30, 0.30, 0.20]$。\n  - CMP 行: $[0.10, 0.20, 0.30, 0.40]$。\n  - GMP 行: $[0.00, 0.00, 0.00, 1.00]$。\n\n您的程序必须：\n- 实现上述过程来计算 $\\mathbf{P}$、从HSC到GMP的3步概率、定向支持布尔值、$\\mathbf{P}$ 和 $\\mathbf{B}$ 的HSC行之间的Jensen-Shannon散度，以及使用阈值 $\\tau = 0.25$ 的验证布尔值。\n- 生成单行输出，包含一个逗号分隔的、针对每个测试用例的四元素列表，并用方括号括起来。将实数四舍五入到6位小数。如果您的语言使用类似 `true/false` 的表示法，请使用小写布尔字面量；在Python中，布尔值呈现为 `True/False`，这也是可接受的。", "solution": "此问题有效。它提出了一个定义明确的计算任务，该任务基于单细胞数据分析的原理，特别是利用RNA速度模型来推断造血过程中的细胞命运轨迹。所有必要的数据、数学定义和参数都已提供，使得问题自成体系、客观且科学上合理。我将着手提供一个解决方案。\n\n任务是根据RNA速度矢量构建一个细胞状态转换的马尔可夫模型，并对照独立的谱系条形码数据验证该模型。该系统包含四个细胞簇，代表一条造血分化路径：造血干细胞 (HSC)、多能祖细胞 (MPP)、共同髓系祖细胞 (CMP) 和粒细胞-巨噬细胞祖细胞 (GMP)。这些簇按此顺序从 $0$ 到 $3$ 进行索引。\n\n首先，我们通过计算每个簇 $k$ 的质心 $\\mathbf{c}_k$ 来为其建立一个参考点，质心是该簇内所有细胞坐标的算术平均值。\n$$\n\\mathbf{c}_k = \\frac{1}{N_k} \\sum_{i \\in \\text{cluster } k} \\mathbf{x}_i\n$$\n其中 $N_k$ 是簇 $k$ 中的细胞数量，$\\mathbf{x}_i$ 是细胞 $i$ 的坐标矢量。\n\n接下来，我们计算从每个细胞到所有可能目标簇的转换概率。对于源簇 $s$ 中的一个细胞 $i$，其位置为 $\\mathbf{x}_i$，速度为 $\\mathbf{v}_i$，它朝向目标簇 $t$ 的转换趋势通过其速度矢量与指向目标簇质心的位移矢量的对齐程度来量化。位移矢量为 $\\mathbf{d}_{i,t} = \\mathbf{c}_t - \\mathbf{x}_i$。对齐程度由 $\\mathbf{v}_i$ 和 $\\mathbf{d}_{i,t}$ 之间的余弦相似度来衡量。我们将对齐分数 $a_{i,t}$ 定义为该余弦相似度的非负部分：\n$$\na_{i,t} = \\max\\left\\{0, \\frac{\\mathbf{v}_i \\cdot \\mathbf{d}_{i,t}}{\\|\\mathbf{v}_i\\|_2 \\|\\mathbf{d}_{i,t}\\|_2}\\right\\}\n$$\n其中 $\\|\\cdot\\|_2$ 是欧几里得范数。如果 $\\mathbf{v}_i$ 或 $\\mathbf{d}_{i,t}$ 是零矢量，其范数为 $0$，我们定义 $a_{i,t} = 0$。然后将这些分数归一化，得到单细胞转换概率 $p_{i,t}$：\n$$\np_{i,t} = \\frac{a_{i,t}}{\\sum_{u=0}^{3} a_{i,u}}\n$$\n仅当 $\\sum_{u} a_{i,u} > 0$ 时才执行此归一化。如果一个细胞的速度矢量与任何簇质心都没有正向对齐（即 $\\sum_{u} a_{i,u} = 0$），我们采用一个备用机制。此时，概率基于到簇质心的欧几里得距离的负指数，由温度参数 $\\sigma = 1.0$ 控制：\n$$\np_{i,t} \\propto \\exp\\left(-\\frac{\\|\\mathbf{d}_{i,t}\\|_2}{\\sigma}\\right)\n$$\n随后将这些值归一化，使其总和为 $1$。\n\n从源簇 $s$ 到目标簇 $t$ 的簇到簇转换概率 $P_{s,t}$，通过对属于簇 $s$ 的所有细胞 $i$ 的单细胞概率 $p_{i,t}$ 求平均值来计算。然后，对所得矩阵 $\\mathbf{P}$ 的每一行进行重新归一化，以确保其为行随机。\n$$\nP_{s,t} = \\frac{1}{N_s} \\sum_{i \\in \\text{cluster } s} p_{i,t} \\quad \\text{随后进行行归一化}\n$$\n\n为了模拟多步分化过程，我们通过计算 $\\mathbf{P}$ 的 $k$ 次幂来得到 $k$ 步转换矩阵，记为 $\\mathbf{P}^k$。问题指定 $k=3$ 来代表从HSC到GMP的经典步数。因此，项 $(\\mathbf{P}^3)_{0,3}$ 代表从HSC（索引0）到GMP（索引3）的3步转换概率。\n\n然后我们评估HSC到GMP轨迹的“定向支持”。这是一个布尔条件，当且仅当从HSC转换到GMP的3步概率严格大于从HSC转换到任何其他簇（包括其自身）的3步概率时，该条件为真。令 $\\mathbf{P}^{(3)} = \\mathbf{P}^3$。该条件是：\n$$\n\\mathbf{P}^{(3)}_{0,3} > \\mathbf{P}^{(3)}_{0,0} \\quad \\land \\quad \\mathbf{P}^{(3)}_{0,3} > \\mathbf{P}^{(3)}_{0,1} \\quad \\land \\quad \\mathbf{P}^{(3)}_{0,3} > \\mathbf{P}^{(3)}_{0,2}\n$$\n\n最后，我们对照一种独立的实验模式——谱系条形码（由给定的转换矩阵 $\\mathbf{B}$ 表示），来验证由速度推断的单步转换概率。使用Jensen-Shannon散度 (JSD) 对HSC源簇（即矩阵 $\\mathbf{P}$ 和 $\\mathbf{B}$ 的第一行）进行比较。对于两个概率分布 $\\mathbf{p}$ 和 $\\mathbf{q}$，JSD定义为：\n$$\n\\mathrm{JSD}(\\mathbf{p}, \\mathbf{q}) = \\frac{1}{2} D_{KL}(\\mathbf{p} \\| \\mathbf{m}) + \\frac{1}{2} D_{KL}(\\mathbf{q} \\| \\mathbf{m})\n$$\n其中 $\\mathbf{m} = \\frac{1}{2}(\\mathbf{p} + \\mathbf{q})$ 是混合分布，而 $D_{KL}(\\mathbf{p} \\| \\mathbf{m}) = \\sum_j p_j \\ln\\left(\\frac{p_j}{m_j}\\right)$ 是Kullback-Leibler散度。采用约定 $0 \\ln(0/x) = 0$。如果计算出的JSD小于或等于阈值 $\\tau = 0.25$，则认为验证成功。\n\n对于每个测试用例，我们将计算四个值：定向支持布尔值、3步HSC到GMP的概率、$\\mathbf{P}$ 和 $\\mathbf{B}$ 的HSC行之间的JSD，以及验证通过布尔值。浮点数将四舍五入到6位小数。", "answer": "`[[false,0.449769,0.569429,false],[false,0.413797,0.380962,false],[false,0.245033,0.016335,true]]`", "id": "2852618"}]}