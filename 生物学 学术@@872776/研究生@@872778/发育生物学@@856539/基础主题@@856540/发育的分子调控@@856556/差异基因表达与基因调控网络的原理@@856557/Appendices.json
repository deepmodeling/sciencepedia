{"hands_on_practices": [{"introduction": "基因调控网络的一个核心功能是产生明确的、开关一样的响应，这使得细胞能够做出决定性的命运选择。本练习将探讨一个简单的正反馈回路如何产生这种被称为“双稳态”的行为。通过运用动力系统的分析工具，我们将精确计算出系统状态发生质变的关键点——鞍结分岔点，从而理解细胞状态转换的数学基础。[@problem_id:2665261]", "problem": "一个单基因正反馈模块嵌入在基因调控网络（GRN）中，并由一个空间均匀的形态发生素输入驱动，该输入提高了该基因的基础转录率。设 $x(t)$ 表示基因产物浓度，并假设以下最简化的、生物物理学上标准的要素：(i) 转录-翻译产生基因产物，(ii) 降解/稀释为一级反应，(iii) 转录自动激活源于启动子的协同占据。经由蛋白质衰变率和自激活物的解离常数进行无量纲化后，动力学简化为以下一维常微分方程\n$$\n\\frac{dx}{dt} \\;=\\; s \\;+\\; a\\,\\frac{x^{2}}{1 + x^{2}} \\;-\\; x,\n$$\n其中 $x \\ge 0$ 是无量纲浓度，$a>0$ 是相对于降解的无量纲最大自激活强度，$s \\ge 0$ 是由形态发生素控制的无量纲基础产物输入。\n\n根据一维动力系统的基本定义，不动点是一个值 $x^{\\ast}$，使得 $\\frac{dx}{dt}=0$。鞍结（折叠）分岔发生在两个不动点合并并湮灭的参数值处，这在几何上对应于零斜线相对于流的横截性的丧失。\n\n假设 $a$ 固定为 $a=2.5$，而 $s$ 可变。仅使用上述定义和标准微积分，确定当 $s$ 从 0 增加时，发生鞍结分岔的最小非负值 $s_{c}$。你的计算必须从稳态条件和一维不动点的几何合并准则开始，并通过消去 $x$ 来获得 $s_{c}$。将最终数值答案四舍五入到四位有效数字。将最终答案表示为纯无量纲数（无单位）。", "solution": "所述问题具有科学依据、提法明确、客观且自成一体。它描述了系统生物学中的一个标准模型，并就其动力学提出了一个数学上精确的问题。因此，该问题是有效的，并将在此给出解答。\n\n基因产物浓度 $x(t)$ 的动力学由以下常微分方程给出：\n$$\n\\frac{dx}{dt} = f(x, s) = s + a\\,\\frac{x^{2}}{1 + x^{2}} - x\n$$\n其中 $x \\ge 0$，$a > 0$，$s \\ge 0$。最大自激活强度的值固定为 $a=2.5$。\n\n不动点，记作 $x^{\\ast}$，是系统处于稳态时的浓度，意味着 $\\frac{dx}{dt} = 0$。不动点的条件是：\n$$\nf(x^{\\ast}, s) = s + a\\,\\frac{(x^{\\ast})^{2}}{1 + (x^{\\ast})^{2}} - x^{\\ast} = 0\n$$\n鞍结分岔发生在参数值 $(x_c, s_c)$ 处，此时两个不动点合并。这对应于函数 $f(x, s)$ 与 $x$ 轴相切的点。在数学上，这要求函数及其关于状态变量 $x$ 的一阶导数都为零。在分岔点 $(x_c, s_c)$ 必须同时满足的两个条件是：\n$$\n(1) \\quad f(x_c, s_c) = s_c + a\\,\\frac{x_c^2}{1 + x_c^2} - x_c = 0\n$$\n$$\n(2) \\quad \\left.\\frac{\\partial f(x,s)}{\\partial x}\\right|_{(x_c,s_c)} = 0\n$$\n首先，我们计算导数 $\\frac{\\partial f}{\\partial x}$：\n$$\n\\frac{\\partial f}{\\partial x} = \\frac{d}{dx} \\left( s + a\\,\\frac{x^{2}}{1 + x^{2}} - x \\right) = a \\left( \\frac{2x(1+x^2) - x^2(2x)}{(1+x^2)^2} \\right) - 1 = a\\,\\frac{2x}{(1+x^2)^2} - 1\n$$\n在分岔点 $x_c$ 应用条件 $(2)$：\n$$\na\\,\\frac{2x_c}{(1+x_c^2)^2} - 1 = 0 \\quad \\implies \\quad a = \\frac{(1+x_c^2)^2}{2x_c}\n$$\n问题指定 $a=2.5$。代入此值可得到关于 $x_c$ 的多项式方程：\n$$\n2.5 = \\frac{(1+x_c^2)^2}{2x_c} \\quad \\implies \\quad 5x_c = (1+x_c^2)^2 = 1 + 2x_c^2 + x_c^4\n$$\n重新整理后得到关于临界浓度 $x_c$ 的四次方程：\n$$\nx_c^4 + 2x_c^2 - 5x_c + 1 = 0\n$$\n现在，我们找出临界参数 $s_c$ 关于 $x_c$ 的表达式。根据条件 $(1)$，我们有 $s_c = x_c - a\\,\\frac{x_c^2}{1 + x_c^2}$。我们可以代入分岔条件中 $a$ 的表达式：\n$$\ns_c = x_c - \\left( \\frac{(1+x_c^2)^2}{2x_c} \\right) \\frac{x_c^2}{1+x_c^2} = x_c - \\frac{x_c(1+x_c^2)}{2}\n$$\n简化此表达式，我们得到 $s_c$ 和 $x_c$ 之间的直接关系：\n$$\ns_c = \\frac{2x_c - x_c - x_c^3}{2} = \\frac{x_c - x_c^3}{2}\n$$\n问题现在简化为求解四次方程 $x_c^4 + 2x_c^2 - 5x_c + 1 = 0$ 的正实数根，然后计算相应的 $s_c$ 值。令 $h(x) = x^4 + 2x^2 - 5x + 1$。分析表明 $h(x)=0$ 有两个正实数根：一个根 $x_{c1} \\in (0, 1)$ 和另一个根 $x_{c2} > 1$。\n对于第一个根 $x_{c1} < 1$， $s_c$ 的值将是正的，因为 $s_c = \\frac{x_{c1}(1-x_{c1}^2)}{2} > 0$。\n对于第二个根 $x_{c2} > 1$， $s_c$ 的值将是负的，因为 $s_c = \\frac{x_{c2}(1-x_{c2}^2)}{2} < 0$。\n问题要求的是最小的非负值 $s_c$，因为物理上输入 $s$ 被限制为 $s \\ge 0$。因此，负的 $s_c$ 值没有物理意义。我们必须找到与根 $x_{c1}$ 对应的正值 $s_c$。\n\n我们可以使用诸如牛顿-拉夫逊法之类的数值方法来找到 $x_{c1}$。设 $x_0 = 0.2$ 为初始猜测值。\n$h(x) = x^4 + 2x^2 - 5x + 1$\n$h'(x) = 4x^3 + 4x - 5$\n迭代 1：$h(0.2) = 0.0816$，$h'(0.2) = -4.168$。$x_1 = 0.2 - \\frac{0.0816}{-4.168} \\approx 0.21958$。\n迭代 2：使用 $x_1 = 0.2198$：$h(0.2198) \\approx -0.000049$，$h'(0.2198) \\approx -4.078$。$x_2 = 0.2198 - \\frac{-0.000049}{-4.078} \\approx 0.219788$。\n这个值足够精确。令 $x_{c1} \\approx 0.21979$。\n\n现在，我们计算相应的临界值 $s_c$：\n$$\ns_c = \\frac{x_{c1} - x_{c1}^3}{2} = \\frac{0.21979 - (0.21979)^3}{2} = \\frac{0.21979 - 0.010620}{2} = \\frac{0.20917}{2} = 0.104585\n$$\n按照要求将结果四舍五入到四位有效数字，得到 $s_c = 0.1046$。这是发生鞍结分岔的 $s$ 的最小非负值。此分岔对应于随着 $s$ 的增加，低浓度稳定不动点和中等浓度不稳定不动点的湮灭。", "answer": "$$\n\\boxed{0.1046}\n$$", "id": "2665261"}, {"introduction": "在双稳态开关的基础上，本练习引入了内在噪声的关键作用，因为真实的生物决策过程并非纯粹确定性的。分子数量的随机波动可以将细胞推向不同的命运终点。我们将使用随机微分方程来模拟一个经典的“拨动开关”基因回路，计算在一个微小的不对称偏向和内在噪声的共同作用下，细胞最终承诺于特定谱系的精确概率。[@problem_id:2665202]", "problem": "一个双能祖细胞中的典型发育决策可由一个遗传拨动开关控制，其中两个转录因子 $A$ 和 $B$ 相互抑制。考虑其确定性平均场动力学\n$$\n\\frac{dA}{dt} = \\frac{\\alpha_A}{1 + \\left(\\frac{B}{K}\\right)^{n}} - \\beta A,\\qquad\n\\frac{dB}{dt} = \\frac{\\alpha_B}{1 + \\left(\\frac{A}{K}\\right)^{n}} - \\beta B,\n$$\n其中希尔系数 $n \\ge 2$，解离常数 $K>0$，蛋白质降解率 $\\beta>0$。最大产生速率是轻微不对称的，\n$$\n\\alpha_A = \\alpha(1+\\delta),\\qquad \\alpha_B = \\alpha(1-\\delta),\n$$\n其中 $0<|\\delta|\\ll 1$ 且基线 $\\alpha>0$。在对称极限 $\\delta=0$ 下，系统存在一个对称点 $A=B=A^{*}$，它由下式隐式定义：\n$$\n\\frac{\\alpha}{1 + \\left(\\frac{A^{*}}{K}\\right)^{n}} = \\beta A^{*}.\n$$\n由有限蛋白质拷贝数引起的内在基因表达噪声，在对称点附近沿着不稳定决策坐标 $x \\equiv \\frac{A-B}{2}$，可以通过一个一维随机微分方程 (SDE) 来建模：\n$$\ndx = \\varepsilon\\, dt + \\sqrt{2D}\\, dW_t,\n$$\n其中 $D>0$ 是一个捕捉内在涨落的有效扩散系数，$W_t$ 是一个标准维纳过程。产生速率的微小不对称性沿着 $x$ 产生了一个恒定的漂移偏置 $\\varepsilon$，它在主导阶上与 $\\delta$ 线性相关，即 $\\varepsilon = \\kappa\\, \\delta$，其中 $\\kappa>0$ 取决于 $A^{*}$ 附近确定性矢量场在 $x$ 上的投影。当 $x$ 首次达到 $+L$ 时，细胞被认为定型为谱系 $A$；当 $x$ 首次达到 $-L$ 时，则定型为谱系 $B$。其中 $L>0$ 是沿着 $x$ 的定型阈值。假设祖细胞起始于未定状态 $x(0)=0$。\n\n仅使用应用于基因调控网络的随机过程基本原理，推导两个谱系定型概率 $p_A$ 和 $p_B$ 的闭式表达式，该表达式应为 $\\delta$、$D$、$L$ 和 $\\kappa$ 的函数，在 $|\\delta|$ 的主导阶上有效，但在 $D$ 和 $L$ 上是非微擾的。您可以将最终结果表示为将 $\\kappa$ 视为常数的函数。如果您选择将 $\\kappa$ 与拨动开关的生化参数联系起来，您可以使用从 $A^{*}$ 附近的线性化得到的主导阶关系 $\\kappa=\\beta A^{*}$，其中 $A^{*}$ 的定义如上。请将两个概率作为一个单一的解析表达式提供。不需要四舍五入，概率也无需报告单位。", "solution": "该问题陈述提出了一个基于理论系统生物学和随机过程原理的有效且良态的问题。它要求计算一个双能祖细胞的定型概率，该细胞的命运由一个遗传拨动开关控制。决策变量 $x \\equiv \\frac{A-B}{2}$ 的动力学由一个描述有偏维纳过程的一维伊藤随机微分方程 (SDE) 近似。\n\n该 SDE 如下：\n$$ dx = \\varepsilon\\, dt + \\sqrt{2D}\\, dW_t $$\n其中 $x(t)$ 表示细胞在时间 $t$ 沿决策坐标的状态。祖细胞从一个未定状态 $x(0) = 0$ 开始。小的常数漂移项 $\\varepsilon = \\kappa \\delta$ 代表了由于产生速率不对称而导致的朝向一个谱系的偏置，其中 $|\\delta| \\ll 1$。项 $\\sqrt{2D}\\, dW_t$ 模拟了内在噪声，其中 $D > 0$ 是有效扩散系数，$W_t$ 是标准维纳过程。\n\n当过程 $x(t)$ 首次到达位于 $x = +L$ 的吸收边界时，细胞定型为谱系 $A$。当它首次到达位于 $x = -L$ 的吸收边界时，细胞定型为谱系 $B$。因此，问题就是找到一个从 $x_0=0$ 开始的粒子通过 $+L$ 或 $-L$ 处的边界离开区间 $[-L, L]$ 的概率。这是一个经典的首次穿越问题。\n\n设 $p_A(x)$ 为从 $x$ 开始的过程在到達 $-L$ 之前到达 $+L$ 的概率。这个概率，被称为分裂概率或提交函数，满足稳态后向 Kolmogorov 方程。对于一个一般的时间齐次伊藤过程 $dX_t = \\mu(X_t) dt + \\sigma(X_t) dW_t$，其在区间 $[a, b]$ 的右边界退出的提交函数 $p(x)$ 满足以下二阶常微分方程 (ODE)：\n$$ \\mu(x) \\frac{dp}{dx} + \\frac{1}{2}\\sigma(x)^2 \\frac{d^2p}{dx^2} = 0 $$\n边界条件由边界的性质决定：从目标边界开始保证成功，因此 $p(b)=1$，而从另一个边界开始保证失败，因此 $p(a)=0$。\n\n对于当前特定问题，漂移是常数 $\\mu(x) = \\varepsilon$，扩散项也是常数 $\\sigma(x) = \\sqrt{2D}$，这意味着 $\\sigma(x)^2 = 2D$。区间是 $[-L, L]$。因此，$p_A(x)$ 的控制 ODE 是：\n$$ \\varepsilon \\frac{dp_A}{dx} + D \\frac{d^2p_A}{dx^2} = 0 $$\n边界条件为 $p_A(L) = 1$ 和 $p_A(-L) = 0$。\n\n这是一个线性、二阶、齐次常系数常微分方程。其通解形式为：\n$$ p_A(x) = C_1 + C_2 \\exp\\left(-\\frac{\\varepsilon}{D}x\\right) $$\n其中 $C_1$ 和 $C_2$ 是待由边界条件确定的常数。\n\n应用 $x=-L$ 处的边界条件：\n$$ p_A(-L) = 0 \\implies C_1 + C_2 \\exp\\left(-\\frac{\\varepsilon}{D}(-L)\\right) = C_1 + C_2 \\exp\\left(\\frac{\\varepsilon L}{D}\\right) = 0 $$\n应用 $x=L$ 处的边界条件：\n$$ p_A(L) = 1 \\implies C_1 + C_2 \\exp\\left(-\\frac{\\varepsilon}{D}L\\right) = 1 $$\n\n我们得到一个关于 $C_1$ 和 $C_2$ 的二元线性方程组。由第一个方程，我们得到 $C_1 = -C_2 \\exp\\left(\\frac{\\varepsilon L}{D}\\right)$。将此代入第二个方程得到：\n$$ -C_2 \\exp\\left(\\frac{\\varepsilon L}{D}\\right) + C_2 \\exp\\left(-\\frac{\\varepsilon L}{D}\\right) = 1 $$\n$$ C_2 \\left(\\exp\\left(-\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(\\frac{\\varepsilon L}{D}\\right)\\right) = 1 $$\n这得到：\n$$ C_2 = \\frac{1}{\\exp\\left(-\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(\\frac{\\varepsilon L}{D}\\right)} $$\n对于 $C_1$：\n$$ C_1 = -\\frac{\\exp\\left(\\frac{\\varepsilon L}{D}\\right)}{\\exp\\left(-\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(\\frac{\\varepsilon L}{D}\\right)} = \\frac{\\exp\\left(\\frac{\\varepsilon L}{D}\\right)}{\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(-\\frac{\\varepsilon L}{D}\\right)} $$\n将这些常数代回 $p_A(x)$ 的通解中：\n$$ p_A(x) = \\frac{\\exp\\left(\\frac{\\varepsilon L}{D}\\right)}{\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(-\\frac{\\varepsilon L}{D}\\right)} + \\frac{\\exp\\left(-\\frac{\\varepsilon x}{D}\\right)}{\\exp\\left(-\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(\\frac{\\varepsilon L}{D}\\right)} $$\n$$ p_A(x) = \\frac{\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(-\\frac{\\varepsilon x}{D}\\right)}{\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(-\\frac{\\varepsilon L}{D}\\right)} $$\n问题陈述祖细胞起始于 $x(0)=0$。因此，定型为谱系 $A$ 的概率（我们简记为 $p_A$）是 $p_A(0)$：\n$$ p_A = p_A(0) = \\frac{\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - \\exp(0)}{\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(-\\frac{\\varepsilon L}{D}\\right)} = \\frac{\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - 1}{\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(-\\frac{\\varepsilon L}{D}\\right)} $$\n由于定型是在谱系 $A$ 和谱系 $B$ 之间的二元选择，它们的概率之和必须为 1：$p_A + p_B = 1$。因此，定型为谱系 $B$ 的概率 $p_B$ 是：\n$$ p_B = 1 - p_A = 1 - \\frac{\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - 1}{\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(-\\frac{\\varepsilon L}{D}\\right)} = \\frac{\\left(\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(-\\frac{\\varepsilon L}{D}\\right)\\right) - \\left(\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - 1\\right)}{\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(-\\frac{\\varepsilon L}{D}\\right)} $$\n$$ p_B = \\frac{1 - \\exp\\left(-\\frac{\\varepsilon L}{D}\\right)}{\\exp\\left(\\frac{\\varepsilon L}{D}\\right) - \\exp\\left(-\\frac{\\varepsilon L}{D}\\right)} $$\n问题指定漂移 $\\varepsilon$ 在主导阶上由不对称性 $\\delta$ 产生，即 $\\varepsilon = \\kappa \\delta$。将此代入 $p_A$ 和 $p_B$ 的表达式，得到以给定参数 $\\delta$、$D$、$L$ 和 $\\kappa$ 为函数的最终结果。问题指出所求表达式应“在 $|\\delta|$ 的主导阶上有效，但在 $D$ 和 $L$ 上是非微擾的”。这意味着我们应该使用已经是 $\\delta$ 主导阶近似的 SDE，但不应在参数组 $\\frac{\\kappa \\delta L}{D}$ 上对所得概率进行后续的泰勒展开，因为这将隐式地假设 $\\frac{\\kappa L}{D}$ 为 1 阶，从而违背了对 $L$ 和 $D$ 的非微擾要求。推导出的表达式是指定 SDE 模型的精确解。与生化参数 $\\kappa = \\beta A^*$ 的可选联系仅仅提供了 $\\kappa$ 的微观解释，但并不改变概率的数学形式。\n\n两个概率是：\n$$ p_A = \\frac{\\exp\\left(\\frac{\\kappa \\delta L}{D}\\right) - 1}{\\exp\\left(\\frac{\\kappa \\delta L}{D}\\right) - \\exp\\left(-\\frac{\\kappa \\delta L}{D}\\right)} $$\n$$ p_B = \\frac{1 - \\exp\\left(-\\frac{\\kappa \\delta L}{D}\\right)}{\\exp\\left(\\frac{\\kappa \\delta L}{D}\\right) - \\exp\\left(-\\frac{\\kappa \\delta L}{D}\\right)} $$\n这些就是所要求的定型概率的闭式表达式。", "answer": "$$ \\boxed{\n\\begin{pmatrix}\n\\frac{\\exp\\left(\\frac{\\kappa \\delta L}{D}\\right) - 1}{\\exp\\left(\\frac{\\kappa \\delta L}{D}\\right) - \\exp\\left(-\\frac{\\kappa \\delta L}{D}\\right)} & \\frac{1 - \\exp\\left(-\\frac{\\kappa \\delta L}{D}\\right)}{\\exp\\left(\\frac{\\kappa \\delta L}{D}\\right) - \\exp\\left(-\\frac{\\kappa \\delta L}{D}\\right)}\n\\end{pmatrix}\n} $$", "id": "2665202"}, {"introduction": "前面的练习侧重于理论模型，而本练习则旨在连接理论与实验数据。我们将模拟并分析在现代发育生物学研究中已常规获得的单细胞基因表达数据。通过探索这些数据中噪声的统计特性——特别是噪声如何随平均表达水平变化——我们将学习如何推断细胞调控其基因表达水平时所采用的基础分子策略：是调控转录爆发的频率，还是调控其大小。[@problem_id:2665250]", "problem": "给定一个用于单细胞水平基因表达的机制性统计框架，该框架基于转录爆发的双态（电报）模型，此模型在发育生物学和系统生物学中被广泛接受。在该模型中，启动子在非激活态和激活态之间交替转换。当处于激活态时，转录本以恒定速率产生，并以一级速率常数降解。在与爆发性转录一致的时间尺度分离机制下，每个细胞中信使核糖核酸（mRNA）拷贝数的稳态分布可以表示为一个泊松随机变量，其速率参数本身服从Gamma分布（即Gamma-泊松混合），这等效于一个负二项（NB）分布。记爆发频率为 $f$（每个mRNA寿命内的爆发次数），平均爆发大小为 $b$（每次启动子激活产生的mRNA数量），mRNA降解速率为 $\\gamma$。在此表示中，Gamma分布的形状参数为 $\\alpha = f/\\gamma$，尺度参数为 $\\beta = b$，稳态平均mRNA为 $\\mu = \\alpha \\beta$。您可以假设分子生物学的中心法则以及转录和降解的质量作用动力学成立。您也可以假设在爆发机制下稳态mRNA分布的负二项表示法以及Gamma-泊松混合构造的有效性成立。\n\n您的任务是编写一个完整的、可运行的程序。对于几个合成实验中的每一个，该程序使用单细胞数据来拟合一个标度指数，该指数将跨实验条件的超泊松噪声项与均值关联起来，然后使用该指数来检验跨条件的均值变化主要是由爆发频率调控还是爆发大小调控驱动的。程序必须使用固定的随机种子，通过Gamma-泊松混合模型来模拟单细胞mRNA计数，计算每个条件的样本均值和方差，通过对数线性回归估计标度指数，并根据该指数对驱动机制进行分类。\n\n基本原理：\n- 中心法则：脱氧核糖核酸（DNA）转录为mRNA，mRNA翻译为蛋白质；此处我们关注mRNA。\n- 双态启动子模型（电报模型），具有爆发频率 $f$、爆发大小 $b$ 和mRNA降解速率 $\\gamma$。\n- 在爆发条件下，细胞间的稳态mRNA计数服从通过形状参数为 $\\alpha = f/\\gamma$、尺度参数为 $\\beta = b$ 的Gamma-泊松混合得到的负二项分布；其均值为 $\\mu = \\alpha \\beta$，方差为泊松方差与一个超泊松项之和。\n\n需要执行的计算：\n1. 对每个测试用例，使用Gamma-泊松混合模型为多个条件模拟单细胞计数：\n   - 对每个条件 $j$，从Gamma分布 $\\lambda_{j,i} \\sim \\mathrm{Gamma}(\\text{shape}=\\alpha_j, \\text{scale}=\\beta_j)$ 中抽取 $N$ 个独立同分布的随机变量，其中 $\\alpha_j = f_j/\\gamma$ 且 $\\beta_j = b_j$。\n   - 然后，对每个 $\\lambda_{j,i}$，从泊松分布 $X_{j,i} \\sim \\mathrm{Poisson}(\\lambda_{j,i})$ 中抽取一个值，以获得单细胞mRNA计数。\n2. 对每个条件，计算样本均值 $\\hat{\\mu}_j$ 和样本方差 $\\widehat{\\mathrm{Var}}_j$（使用除数为 $N$ 的总体方差，而非无偏估计量）。\n3. 在一个测试用例的各个条件之间，估计一个标度指数 $\\hat{\\beta}$，使得超泊松噪声项 $E_j = \\widehat{\\mathrm{Var}}_j - \\hat{\\mu}_j$ 与 $\\hat{\\mu}_j$ 的标度关系近似为 $E_j \\propto \\hat{\\mu}_j^{\\hat{\\beta}}$。使用自然对数，将 $\\hat{\\beta}$ 估计为对数据点 $\\left(\\log \\hat{\\mu}_j, \\log E_j\\right)$ 进行最小二乘线性拟合得到的斜率。拟合时排除任何 $E_j \\le 0$ 或 $\\hat{\\mu}_j \\le 0$ 的条件；确保至少保留3个点以进行可靠拟合。\n4. 使用估计的指数对均值变化的主要驱动因素进行分类：\n   - 如果 $|\\hat{\\beta} - 1| \\le 0.25$，返回整数 $1$（与频率调控主导一致）。\n   - 如果 $|\\hat{\\beta} - 2| \\le 0.25$，返回整数 $2$（与大小调控主导一致）。\n   - 否则返回整数 $0$（混合或不确定）。\n\n角度单位不适用。由于计数是无量纲的，因此不需要物理单位。\n\n在您的程序中实现的测试套件，使用固定的随机种子 $12345$ 以保证可复现性。在所有情况下，每个条件使用 $N = 20000$ 个细胞，且 $\\gamma = 1$。\n- 用例A（频率调控）：恒定爆发大小 $b = 3$，爆发频率向量 $f \\in \\{0.5, 1.0, 2.0, 4.0\\}$。\n- 用例B（大小调控）：恒定爆发频率 $f = 1.5$，爆发大小向量 $b \\in \\{1, 2, 4, 8\\}$。\n- 用例C（混合）：爆发频率向量 $f \\in \\{0.5, 1.0, 2.0, 4.0\\}$，爆发大小向量 $b \\in \\{1.0, 1.5, 2.3, 3.5\\}$。\n- 用例D（具有极小爆发的类泊松边界，频率调控）：恒定爆发大小 $b = 0.2$，爆发频率向量 $f \\in \\{0.5, 1.0, 2.0, 4.0\\}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按用例A、B、C、D的顺序列出结果。每个元素必须是按上文规定对该用例进行的整数分类。例如，输出必须类似于“[1,2,0,1]”，但要使用为这四个用例实际计算出的整数。", "solution": "问题陈述经过验证，被认为是科学上合理的、定义明确的、客观的且内部一致的。它基于已建立的基因转录双态（电报）模型，这是定量生物学中的一个基本概念。在特定假设下，该模型可简化为负二项分布的Gamma-泊松混合统计表示，是该领域一个标准且广为接受的结果。所提供的参数和计算任务定义清晰，并直接检验了模型的理论预测。因此，可以推导出一个解决方案。\n\n该问题要求开发一个计算程序，以根据模拟的单细胞mRNA计数数据，对基因表达调控的主要机制（爆发频率或爆发大小）进行分类。该分类依赖于估计一个标度指数，该指数关联了平均表达水平与转录噪声的大小。\n\n**理论框架**\n\n该模型的基础是稳态mRNA计数 $X$ 的Gamma-泊松混合模型。单个细胞中的mRNA分子数是一个服从泊松分布的随机变量 $X \\sim \\mathrm{Poisson}(\\lambda)$，其中速率参数 $\\lambda$ 在细胞群体中不是恒定的，其本身就是一个随机变量。在爆发性转录机制中，$\\lambda$ 服从Gamma分布，$\\lambda \\sim \\mathrm{Gamma}(\\text{shape}=\\alpha, \\text{scale}=\\beta)$。\n\nGamma分布的参数由转录的生物物理参数决定：\n- 形状参数 $\\alpha$ 由 $\\alpha = f/\\gamma$ 给出，其中 $f$ 是爆发频率，$\\gamma$ 是mRNA降解速率。\n- 尺度参数 $\\beta$ 是平均爆发大小，即 $\\beta = b$。\n\n$X$ 的最终边际分布是负二项分布。此分布的关键统计矩是均值 $\\mu$ 和方差 $\\mathrm{Var}(X)$。\n平均表达量是泊松速率在Gamma分布上的期望值：\n$$ \\mu = \\mathbb{E}[X] = \\mathbb{E}[\\lambda] = \\alpha\\beta $$\n方差使用全方差公式推导得出，$\\mathrm{Var}(X) = \\mathbb{E}[\\mathrm{Var}(X|\\lambda)] + \\mathrm{Var}(\\mathbb{E}[X|\\lambda])$。由于泊松分布的均值和方差相等，$\\mathbb{E}[X|\\lambda] = \\mathrm{Var}(X|\\lambda) = \\lambda$。\n$$ \\mathrm{Var}(X) = \\mathbb{E}[\\lambda] + \\mathrm{Var}(\\lambda) $$\nGamma$(\\alpha, \\beta)$ 分布的均值和方差分别为 $\\mathbb{E}[\\lambda] = \\alpha\\beta$ 和 $\\mathrm{Var}(\\lambda) = \\alpha\\beta^2$。代入这些值可得：\n$$ \\mathrm{Var}(X) = \\alpha\\beta + \\alpha\\beta^2 = \\mu + \\alpha\\beta^2 $$\n方差可以分解为一个等于均值的项（泊松噪声）和一个“超泊松”噪声项 $E$，后者捕捉了由转录爆发引起的过度离散：\n$$ E = \\mathrm{Var}(X) - \\mu = \\alpha\\beta^2 $$\n\n**标度指数的推导**\n\n分类任务的核心是确定在不同调控情景下，超泊松噪声 $E$ 如何随平均表达量 $\\mu$ 变化。我们假设存在一个幂律关系 $E \\propto \\mu^{\\hat{\\beta}}$，其中 $\\hat{\\beta}$ 是待估计的标度指数。取自然对数后得到一个线性关系：$\\log E = \\hat{\\beta} \\log \\mu + \\text{constant}$。指数 $\\hat{\\beta}$ 是这条线的斜率。\n\n我们分析两种纯粹的调控策略：\n\n1.  **频率调控**：爆发大小 $b$ 保持恒定，而爆发频率 $f$ 在不同条件下变化。在降解速率 $\\gamma$ 恒定的情况下，这意味着尺度参数 $\\beta = b$ 是恒定的，而形状参数 $\\alpha = f/\\gamma$ 发生变化。\n    - 均值：$\\mu = \\alpha\\beta$\n    - 超泊松噪声：$E = \\alpha\\beta^2$\n    我们可以通过代入 $\\alpha = \\mu/\\beta$ 来用 $\\mu$ 表示 $E$：\n    $$ E = \\left(\\frac{\\mu}{\\beta}\\right)\\beta^2 = \\mu\\beta $$\n    由于 $\\beta$ 是常数，所以 $E$ 与 $\\mu$ 成正比。标度关系为 $E \\propto \\mu^1$，理论指数为 $\\hat{\\beta} = 1$。\n\n2.  **大小调控**：爆发频率 $f$ 保持恒定，而爆发大小 $b$ 发生变化。这意味着形状参数 $\\alpha = f/\\gamma$ 是恒定的，而尺度参数 $\\beta = b$ 发生变化。\n    - 均值：$\\mu = \\alpha\\beta$\n    - 超泊松噪声：$E = \\alpha\\beta^2$\n    我们通过代入 $\\beta = \\mu/\\alpha$ 来用 $\\mu$ 表示 $E$：\n    $$ E = \\alpha\\left(\\frac{\\mu}{\\alpha}\\right)^2 = \\frac{\\mu^2}{\\alpha} $$\n    由于 $\\alpha$ 是常数，所以 $E$ 与 $\\mu$ 的平方成正比。标度关系为 $E \\propto \\mu^2$，理论指数为 $\\hat{\\beta} = 2$。\n\n**计算算法设计**\n\n程序将为每个测试用例实现以下步骤，并遵循所提供的参数（$N=20000$ 个细胞，$\\gamma=1$，以及用于可复现性的随机种子 $12345$）。\n\n1.  **数据模拟**：对于测试用例中的每个实验条件 $j$（由一对参数 $f_j$ 和 $b_j$ 定义）：\n    - 计算Gamma分布的参数：形状 $\\alpha_j = f_j / \\gamma$ 和尺度 $\\beta_j = b_j$。\n    - 通过从Gamma分布中抽样生成 $N$ 个随机速率参数 $\\lambda_{j,i}$：$\\lambda_{j,i} \\sim \\mathrm{Gamma}(\\alpha_j, \\beta_j)$。\n    - 对每个 $\\lambda_{j,i}$，通过从泊松分布中抽样生成一个单细胞mRNA计数 $X_{j,i}$：$X_{j,i} \\sim \\mathrm{Poisson}(\\lambda_{j,i})$。\n\n2.  **统计估计**：对于每个条件 $j$，根据模拟计数 $\\{X_{j,i}\\}_{i=1}^N$ 计算样本均值 $\\hat{\\mu}_j$ 和样本总体方差 $\\widehat{\\mathrm{Var}}_j$。方差计算时除数为 $N$。\n\n3.  **标度指数估计**：\n    - 对每个条件 $j$，计算估计的超泊松噪声 $E_j = \\widehat{\\mathrm{Var}}_j - \\hat{\\mu}_j$。\n    - 创建一组数据点 $(\\log \\hat{\\mu}_j, \\log E_j)$。排除任何 $\\hat{\\mu}_j \\le 0$ 或 $E_j \\le 0$ 的点。问题保证至少会剩下3个有效点用于拟合。\n    - 对这些对数转换后的点进行简单线性回归，以找到斜率，即估计的标度指数 $\\hat{\\beta}$。这是通过为模型 $\\log E = \\hat{\\beta} \\log \\mu + c$ 寻找最佳拟合线来实现的。\n\n4.  **分类**：根据估计的指数 $\\hat{\\beta}$ 的值对调控机制进行分类：\n    - 如果 $|\\hat{\\beta} - 1| \\le 0.25$，则分类为频率调控（返回 $1$）。\n    - 如果 $|\\hat{\\beta} - 2| \\le 0.25$，则分类为大小调控（返回 $2$）。\n    - 否则，结果为混合或不确定（返回 $0$）。\n\n此过程将应用于指定的四个测试用例：用例A（频率调控）、用例B（大小调控）、用例C（混合调控）和用例D（接近泊松极限的频率调控情况）。最终输出将是这四个用例的整数分类列表。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates single-cell mRNA counts, fits a noise-mean scaling exponent,\n    and classifies the transcriptional regulatory strategy.\n    \"\"\"\n    # Define global parameters as specified in the problem statement.\n    SEED = 12345\n    N_CELLS = 20000\n    GAMMA = 1.0\n\n    # Define the test cases, each with a set of conditions.\n    # Each condition is defined by a burst frequency (f) and burst size (b).\n    # Using full arrays for f and b in each case for uniform processing.\n    test_cases = [\n        # Case A: Frequency-modulated, constant burst size b = 3.\n        # Expected exponent: 1\n        {'f_params': np.array([0.5, 1.0, 2.0, 4.0]),\n         'b_params': np.array([3.0, 3.0, 3.0, 3.0])},\n\n        # Case B: Size-modulated, constant burst frequency f = 1.5.\n        # Expected exponent: 2\n        {'f_params': np.array([1.5, 1.5, 1.5, 1.5]),\n         'b_params': np.array([1.0, 2.0, 4.0, 8.0])},\n\n        # Case C: Mixed modulation.\n        # Expected exponent: between 1 and 2, classification 0\n        {'f_params': np.array([0.5, 1.0, 2.0, 4.0]),\n         'b_params': np.array([1.0, 1.5, 2.3, 3.5])},\n\n        # Case D: Frequency-modulated, small constant burst size b = 0.2.\n        # Expected exponent: 1\n        {'f_params': np.array([0.5, 1.0, 2.0, 4.0]),\n         'b_params': np.array([0.2, 0.2, 0.2, 0.2])}\n    ]\n\n    results = []\n    # Initialize the random number generator for reproducibility.\n    rng = np.random.default_rng(SEED)\n\n    for case in test_cases:\n        means = []\n        variances = []\n\n        # Iterate through each condition within the test case.\n        for f, b in zip(case['f_params'], case['b_params']):\n            # Calculate Gamma distribution parameters from biophysical parameters.\n            # Shape alpha = f / gamma\n            # Scale beta = b\n            alpha = f / GAMMA\n            beta_param = b\n\n            # Simulate single-cell data using the Gamma-Poisson mixture model.\n            # 1. Draw transcription rates from a Gamma distribution.\n            rates = rng.gamma(shape=alpha, scale=beta_param, size=N_CELLS)\n            # 2. Draw mRNA counts from a Poisson distribution for each rate.\n            counts = rng.poisson(lam=rates)\n\n            # Compute sample mean and population variance for the condition.\n            # np.var by default uses ddof=0, which is the population variance.\n            mu_hat = np.mean(counts)\n            var_hat = np.var(counts)\n            \n            means.append(mu_hat)\n            variances.append(var_hat)\n\n        # Prepare data for linear regression on log-transformed values.\n        log_means = []\n        log_noises = []\n        \n        for mu, var in zip(means, variances):\n            extra_noise = var - mu\n            # Filter out conditions where log is not defined or data is unreliable.\n            if mu > 0 and extra_noise > 0:\n                log_means.append(np.log(mu))\n                log_noises.append(np.log(extra_noise))\n        \n        # Check if enough data points remain for a reliable fit.\n        if len(log_means) < 3:\n            # If not, classify as inconclusive.\n            classification = 0\n        else:\n            # Perform linear regression to find the scaling exponent.\n            # The model is: log(noise) = beta_hat * log(mean) + intercept.\n            # np.polyfit(x, y, 1) returns [slope, intercept].\n            slope, _ = np.polyfit(log_means, log_noises, 1)\n            beta_hat = slope\n            \n            # Classify the regulatory mechanism based on the estimated exponent.\n            if abs(beta_hat - 1.0) <= 0.25:\n                classification = 1  # Frequency modulation\n            elif abs(beta_hat - 2.0) <= 0.25:\n                classification = 2  # Size modulation\n            else:\n                classification = 0  # Mixed or inconclusive\n        \n        results.append(classification)\n\n    # Format and print the final output as a single comma-separated list.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2665250"}]}