{"hands_on_practices": [{"introduction": "许多多表型现象的触发，源于环境信号越过某个阈值，从而导致在不同表型之间发生“全或无”的切换。本练习将探讨如何使用希尔函数（Hill function）——生物化学和药理学中的一个基石模型——来为此类现象建模。通过将此模型拟合到虚拟的激素操纵实验数据中 [@problem_id:2630130]，你将学会定量描述一个发育开关的敏感度（由半数激活浓度 $K$ 体现）和陡峭度（由希尔系数 $n$ 体现），这为解析可塑性的生理学基础提供了强有力的工具。", "problem": "一项内分泌操控实验测量了响应单一激素的外源浓度时，表现出一种离散替代表型（记为B-表型）的个体比例。该系统中的发育可塑性很可能是由具有潜在协同性的受体介导信号传导所调控，从而产生一个从激素浓度到B-表型出现概率的单调、饱和、开关样映射。假设以下基本原理：(i) 配体-受体结合遵循质量作用定律，(ii) 协同性结合可由一个控制陡峭度的单一Hill型参数概括，以及 (iii) 每个个体的表型结果是一次伯努利试验，因此在固定剂量下的计数来自二项采样过程。使用这些原理由此构建一个参数化的、归一化的、单调的剂量-反应函数，其下渐近线为$0$，上渐近线为$1$，具有一个半激活浓度$K$（单位为纳摩尔，nM），在该浓度下反应等于$0.5$，以及一个陡峭度参数$n$（无量纲），该参数控制开关在$K$附近的锐度。通过最大化给定以下数据的二项似然来拟合$K$和$n$。\n\n数据以剂量-反应数据集的形式提供，每个数据集列出了激素浓度（单位为纳摩尔，nM）、B-表型个体数（成功次数）以及在该剂量下测定的总个体数。概率必须以小数形式处理，而不是百分比。\n\n为确保数值稳定性，您的算法必须保证在任何剂量下模型预测的概率严格介于$0$和$1$之间。如果需要，应用一个小的数值偏移量$\\epsilon$（$0  \\epsilon \\ll 1$），以避免在似然计算中对$0$或$1$求对数。\n\n测试套件（四个数据集，涵盖典型、平缓、尖锐和和小样本情况）：\n- 数据集A（典型的陡峭开关）：\n  - 浓度 [nM]：$[0.5, 1, 2, 5, 10, 20, 50]$\n  - B-表型个体数：$[0, 1, 6, 50, 89, 98, 100]$\n  - 总数：$[100, 100, 100, 100, 100, 100, 100]$\n- 数据集B（平缓的开关）：\n  - 浓度 [nM]：$[1, 3, 10, 30, 100]$\n  - B-表型个体数：$[18, 46, 100, 150, 182]$\n  - 总数：$[200, 200, 200, 200, 200]$\n- 数据集C（非常尖锐的开关）：\n  - 浓度 [nM]：$[4, 8, 12, 16, 24, 48]$\n  - B-表型个体数：$[0, 12, 75, 127, 148, 150]$\n  - 总数：$[150, 150, 150, 150, 150, 150]$\n- 数据集D（小样本覆盖）：\n  - 浓度 [nM]：$[0.25, 0.5, 1, 2, 4, 8]$\n  - B-表型个体数：$[0, 1, 4, 10, 16, 19]$\n  - 总数：$[20, 20, 20, 20, 20, 20]$\n\n任务：\n1. 在二项采样模型下，为每个剂量的表型计数构建一个似然函数，该模型基于一个由$K$（单位nM）和$n$（无量纲）表征的双参数Hill型开关，并满足约束条件$K  0$和$n  0$。\n2. 实现一个数值优化程序，为每个数据集获取$K$和$n$的最大似然估计。使用多个初始值或重参数化方法来合理地缓解局部最优解问题。\n3. 生物学解释要求（在您的解答说明中报告，而非在程序输出中）：将$K$解释为半最大概率对应的浓度，将$n$解释为开关锐度（协同性）的度量，并将较大的$n$与$K$附近更突兀的转变和更高的局部敏感性联系起来。\n\n角度单位不适用。物理单位：所有浓度单位均为纳摩尔（nM），您必须以nM报告$K$。陡峭度参数$n$是无量纲的。概率以小数形式报告。将所有报告的参数估计值四舍五入到恰好$3$位小数。\n\n最终输出规范：\n- 您的程序应生成单行输出，包含一个方括号括起来的逗号分隔列表。该列表应按顺序包含每个数据集的拟合参数，格式为$[K_{\\mathrm{A}}, n_{\\mathrm{A}}, K_{\\mathrm{B}}, n_{\\mathrm{B}}, K_{\\mathrm{C}}, n_{\\mathrm{C}}, K_{\\mathrm{D}}, n_{\\mathrm{D}}]$，每个值四舍五入到$3$位小数，且$K$的单位默认为nM。", "solution": "问题陈述已提交以供验证。\n\n### 步骤1：提取已知条件\n已知条件如下：\n- **模型框架**：\n    - 该系统将激素浓度映射到表达替代表型（B-表型）的概率。\n    - 该映射函数是一个参数化的、归一化的、单调的剂量-反应函数。\n    - 下渐近线为$0$，上渐近线为$1$。\n    - 该函数有一个半激活浓度参数$K$（单位为纳摩尔，nM），在该浓度下反应为$0.5$。\n    - 该函数有一个陡峭度参数$n$（无量纲）。\n    - 其潜在过程由具有Hill型协同性的配体-受体结合所描述。\n    - 表型决定是一次伯努利试验，给定剂量下的表型计数遵循二项分布。\n- **约束条件**：\n    - $K > 0$\n    - $n > 0$\n- **数据（四个数据集）**：\n    - 数据集A：\n        - 浓度 C [nM]：$[0.5, 1, 2, 5, 10, 20, 50]$\n        - B-表型个体数 s：$[0, 1, 6, 50, 89, 98, 100]$\n        - 总数 t：$[100, 100, 100, 100, 100, 100, 100]$\n    - 数据集B：\n        - 浓度 C [nM]：$[1, 3, 10, 30, 100]$\n        - B-表型个体数 s：$[18, 46, 100, 150, 182]$\n        - 总数 t：$[200, 200, 200, 200, 200]$\n    - 数据集C：\n        - 浓度 C [nM]：$[4, 8, 12, 16, 24, 48]$\n        - B-表型个体数 s：$[0, 12, 75, 127, 148, 150]$\n        - 总数 t：$[150, 150, 150, 150, 150, 150]$\n    - 数据集D：\n        - 浓度 C [nM]：$[0.25, 0.5, 1, 2, 4, 8]$\n        - B-表型个体数 s：$[0, 1, 4, 10, 16, 19]$\n        - 总数 t：$[20, 20, 20, 20, 20, 20]$\n- **任务**：\n    - 构建二项似然函数。\n    - 为每个数据集找到最大似然估计($\\hat{K}, \\hat{n}$)。\n    - 对参数$K$和$n$进行生物学解释。\n- **数值要求**：\n    - 使用数值偏移量$\\epsilon$以确保对数计算的稳定性。\n    - 参数估计值报告时四舍五入到3位小数。\n\n### 步骤2：使用已知条件进行验证\n根据指定标准对问题进行评估。\n\n- **科学依据**：此问题是合理的。它使用了Hill方程，这是生物化学和药理学中描述协同结合现象的标准和基本模型。将其与计数数据的二项似然相结合，代表了分析生物学中定量剂量-反应实验的经典方法。在发育生物学和内分泌学的背景下，这些假设是明确且科学有效的。\n- **适定性**：此问题是适定的。它要求通过最大化一个明确定义的目标函数（似然函数）来估计两个参数（$K$，$n$）。数据和模型都已指定，因此解是存在的。问题要求缓解局部最优解问题，这认识到数值优化中可能存在的不适定性，并为此提供了合理的指导。\n- **客观性**：问题以客观、正式的语言陈述。它提供了定量数据，并要求执行标准的数学和统计程序（最大似然估计）。没有主观或基于意见的成分。\n\n该问题不存在任何列出的缺陷。它不是科学上不合理、不可形式化、不完整、不切实际、不适定、微不足道或超出科学可验证范围的。\n\n### 步骤3：结论与行动\n问题是有效的。将提供解答。\n\n---\n\n### 解答推导\n\n任务是从实验数据中估计剂量-反应模型的参数。这是一个统计推断问题，我们将使用最大似然估计（MLE）方法来解决。\n\n**1. 剂量-反应模型构建**\n\n问题要求一个S型剂量-反应曲线，将激素浓度$C$映射到个体发育为B-表型的概率$P$。该函数必须具有$0$的下渐近线，$1$的上渐近线，一个半最大效应浓度$K$和一个协同性参数$n$。标准的Hill方程恰好满足这些要求：\n$$ P(C; K, n) = \\frac{C^n}{K^n + C^n} $$\n这可以重写为一种在数值上更优的形式，以减轻大$C$或$K$值可能导致的溢出问题：\n$$ P(C; K, n) = \\frac{(C/K)^n}{1 + (C/K)^n} $$\n在这个模型中，$K$代表概率为$0.5$时的浓度，因为$P(K; K, n) = \\frac{(K/K)^n}{1 + (K/K)^n} = \\frac{1^n}{1+1^n} = \\frac{1}{2}$。参数$n$，即Hill系数，控制着开关样反应的陡峭度。\n\n**2. 似然函数**\n\n每个浓度$C_i$的数据包括总共$t_i$个个体中的成功次数（B-表型个体）$s_i$。问题指出这是一个二项采样过程。在给定成功概率$p_i = P(C_i; K, n)$的情况下，在$t_i$次试验中观察到$s_i$次成功的概率由二项概率质量函数给出：\n$$ \\mathcal{L}_i(K, n | C_i, s_i, t_i) = \\binom{t_i}{s_i} p_i^{s_i} (1 - p_i)^{t_i - s_i} $$\n假设不同浓度下的结果是独立的，整个数据集的总似然是各个似然的乘积：\n$$ \\mathcal{L}(K, n) = \\prod_{i} \\mathcal{L}_i = \\prod_{i} \\binom{t_i}{s_i} p_i^{s_i} (1 - p_i)^{t_i - s_i} $$\n为便于分析和计算，我们使用对数似然函数$\\ln(\\mathcal{L})$。最大化$\\mathcal{L}$等同于最大化$\\ln(\\mathcal{L})$。\n$$ \\ln \\mathcal{L}(K, n) = \\sum_{i} \\left[ \\ln\\binom{t_i}{s_i} + s_i \\ln(p_i) + (t_i - s_i) \\ln(1 - p_i) \\right] $$\n二项式系数项$\\ln\\binom{t_i}{s_i}$不依赖于参数$K$和$n$。因此，在优化过程中可以忽略它。需要最大化的目标函数，即对数似然核，是：\n$$ \\ell(K, n) = \\sum_{i} \\left[ s_i \\ln(p_i) + (t_i - s_i) \\ln(1 - p_i) \\right] $$\n其中$p_i = P(C_i; K, n)$。\n\n**3. 最大似然估计与优化**\n\n最大似然估计$(\\hat{K}, \\hat{n})$是使$\\ell(K, n)$最大化的$(K, n)$值，并满足约束条件$K > 0$和$n > 0$。这是一个非线性优化问题。标准的数值优化算法旨在最小化一个函数。因此，我们将问题重新表述为最小化负对数似然：\n$$ (\\hat{K}, \\hat{n}) = \\arg\\min_{K>0, n>0} \\left( -\\ell(K, n) \\right) $$\n为了强制$K$和$n$的正值约束，我们采用重参数化方法。我们定义新的无约束参数$\\alpha$和$\\beta$，使得：\n$$ K = e^{\\alpha} \\quad \\text{和} \\quad n = e^{\\beta} $$\n然后对$\\alpha, \\beta \\in \\mathbb{R}$进行优化。目标函数变为：\n$$ f(\\alpha, \\beta) = - \\sum_{i} \\left[ s_i \\ln(p_i) + (t_i - s_i) \\ln(1 - p_i) \\right] $$\n其中$p_i$现在是$\\alpha$和$\\beta$的函数。\n\n为了数值稳定性，如前所述，概率$p_i$必须严格限制在$0$和$1$之外，以防止对$\\ln(0)$或$\\ln(1-1)$进行求值。我们会将计算出的概率限制在一个小区间$[\\epsilon, 1-\\epsilon]$内，其中$\\epsilon$是一个很小的正数（例如，$10^{-9}$）。\n\n为了降低收敛到局部最小值的风险，优化程序将从多个起始点启动。一个合理的策略是为$K$使用一个有根据的猜测值（例如浓度的几何平均数），并为陡峭度参数$n$测试几个可能的起始值（例如，$1, 2, 5, 10$）。在所有运行中产生最低负对数似然值的参数集被选为最终估计值。\n\n**4. 参数的生物学解释**\n\n- **参数$K$（半最大效应浓度）**：该参数在药理学中通常表示为EC$_{50}$，代表能诱导$0.5$反应概率的激素浓度。在此背景下，它是导致群体中半数个体转换为B-表型所需的浓度。它作为衡量发育系统对激素信号敏感性的一个基本指标。较低的$K$值表示较高的敏感性。\n\n- **参数$n$（Hill系数）**：这个无量纲参数量化了反应曲线的陡峭程度。它是协同性的一个指标。\n    - $n = 1$意味着非协同性的、渐进的反应，类似于Michaelis-Menten动力学。\n    - $n  1$意味着正协同性，即初始的结合事件增加了系统对后续事件的亲和力。这导致在很窄的激素浓度范围内，从低概率状态到高概率状态发生急剧的、开关样的转变。较大的$n$表示更超敏的、开关样的行为。\n    - $0  n  1$则意味着负协同性，这在发育开关中较不常见，并导致比非协同情况更平缓的反应。\n\n从实验数据中估计这些参数，可以对发育开关进行定量表征，从而深入了解其潜在调控网络的特性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Fits a Hill-type dose-response model to binomial data for four datasets\n    using maximum likelihood estimation.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"C\": np.array([0.5, 1, 2, 5, 10, 20, 50]),\n            \"s\": np.array([0, 1, 6, 50, 89, 98, 100]),\n            \"t\": np.array([100, 100, 100, 100, 100, 100, 100]),\n        },\n        {\n            \"C\": np.array([1, 3, 10, 30, 100]),\n            \"s\": np.array([18, 46, 100, 150, 182]),\n            \"t\": np.array([200, 200, 200, 200, 200]),\n        },\n        {\n            \"C\": np.array([4, 8, 12, 16, 24, 48]),\n            \"s\": np.array([0, 12, 75, 127, 148, 150]),\n            \"t\": np.array([150, 150, 150, 150, 150, 150]),\n        },\n        {\n            \"C\": np.array([0.25, 0.5, 1, 2, 4, 8]),\n            \"s\": np.array([0, 1, 4, 10, 16, 19]),\n            \"t\": np.array([20, 20, 20, 20, 20, 20]),\n        },\n    ]\n\n    def neg_log_likelihood(params, C, s, t):\n        \"\"\"\n        Calculates the negative log-likelihood for the Hill model.\n        Parameters are log-transformed for unconstrained optimization.\n        `params` is a list or array [log_K, log_n].\n        \"\"\"\n        log_K, log_n = params\n        K = np.exp(log_K)\n        n = np.exp(log_n)\n\n        # Avoid division by zero if K is extremely small\n        if K  1e-12:\n            return np.inf\n            \n        # Calculate predicted probabilities using the Hill equation\n        # p = C^n / (K^n + C^n)\n        # Numerically stable form: (C/K)^n / (1 + (C/K)^n)\n        # Handle C=0 case to avoid 0**n issues if n is negative (not here, but good practice)\n        C_safe = np.where(C == 0, 1e-12, C)\n        ratio_powered = (C_safe / K)**n\n        p = ratio_powered / (1.0 + ratio_powered)\n        \n        # Clamp probabilities to avoid log(0) or log(1)\n        epsilon = 1e-9\n        p = np.clip(p, epsilon, 1.0 - epsilon)\n\n        # Calculate binomial log-likelihood (ignoring constant combinatorial term)\n        logL = np.sum(s * np.log(p) + (t - s) * np.log(1.0 - p))\n\n        # Return the negative log-likelihood for minimization\n        return -logL\n\n    all_results = []\n    for case in test_cases:\n        C, s, t = case[\"C\"], case[\"s\"], case[\"t\"]\n\n        best_result = None\n        min_neg_log_lik = np.inf\n\n        # Strategy to mitigate local optima: use multiple starting points for n\n        # Use geometric mean of concentrations as a starting point for K\n        # Exclude C=0 from geometric mean calculation\n        valid_C = C[C  0]\n        if len(valid_C)  0:\n            k_guess = np.exp(np.mean(np.log(valid_C)))\n        else:\n            k_guess = 1.0 # Fallback if all concentrations are 0\n\n        n_guesses = [1.0, 2.0, 5.0, 10.0]\n\n        for n_guess in n_guesses:\n            initial_params = [np.log(k_guess), np.log(n_guess)]\n            \n            opt_result = minimize(\n                neg_log_likelihood,\n                initial_params,\n                args=(C, s, t),\n                method='BFGS'\n            )\n\n            if opt_result.success and opt_result.fun  min_neg_log_lik:\n                min_neg_log_lik = opt_result.fun\n                best_result = opt_result.x\n\n        if best_result is None:\n            # This case should ideally not happen with the given data\n            # If all optimizations fail, append NaN or raise an error\n            K_opt, n_opt = np.nan, np.nan\n        else:\n            log_K_opt, log_n_opt = best_result\n            K_opt = np.exp(log_K_opt)\n            n_opt = np.exp(log_n_opt)\n        \n        all_results.extend([K_opt, n_opt])\n    \n    # Format the final output according to specification\n    formatted_results = [f\"{val:.3f}\" for val in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2630130"}, {"introduction": "生物体产生可塑性反应的能力并非一成不变；它在个体间存在差异，并能随时间演化。这要求群体中存在可塑性的遗传变异，通常称为基因型与环境互作（Genotype-by-Environment Interaction, GxE）。本练习 [@problem_id:2630142] 深入探讨了研究 GxE 的数量遗传学框架，使用线性混合效应模型来表示基因型特异的反应规范。你将推导出总遗传方差如何在不同环境中被分解，并学会如何分离出由 GxE 贡献的方差组分（$V_{G \\times E}$），后者是衡量群体可塑性演化潜力的关键指标。", "problem": "将发育可塑性和多表型现象形式化的一个常用方法是通过基因型特异性反应范式，该范式将一个环境指数映射到一个表型。考虑一个实验，该实验在一组 $n$ 个克隆基因型上进行，这些基因型在 $m$ 个受控环境中生长。这些环境由一个连续的环境指数 $z$ 来表征，该指数已经过均值中心化处理，因此 $\\sum_{j=1}^{m} z_{j} = 0$。对于每个基因型 $g \\in \\{1,\\dots,n\\}$ 和每个环境 $j \\in \\{1,\\dots,m\\}$，都有 $r_{gj} \\ge 2$ 个由 $i$ 索引的重复个体，其表型为 $y_{igj}$。假设每个基因型都具有线性的反应范式，包括基因型特异性的截距和斜率，并带有重复水平的噪声。\n\n仅使用反应范式、线性混合效应模型以及线性变换的基本概率法则的核心定义，完成以下任务：\n\n1) 构建一个分层混合效应模型来估计基因型特异性的截距和斜率。您的模型必须指明：\n- 关于 $y_{igj}$ 的个体水平方程，用固定截距、关于 $z_{j}$ 的固定斜率、随机的基因型特异性截距和斜率以及残差噪声来表示。\n- 随机基因型特异性效应的联合分布和残差的分布，包括所有必需的方差分量和任何协方差。\n- 为保证可识别性和有效推断所需的独立性假设。\n\n2) 从您的模型出发，仅使用线性组合的方差和协方差性质，推导在任意环境值 $x$ 下表型的遗传方差的显式表达式，记为 $V_{G}(x)$。该表达式需用随机截距和斜率的方差分量及其协方差来表示。然后，将“在 $x$ 处的基因型-环境互作 (GxE) 方差”（$V_{G\\times E}(x)$）有原则地定义为 $V_{G}(x)$ 中源于基因型之间相对于平均环境 $x=0$ 的环境依赖性差异的部分，并用闭合形式表示 $V_{G\\times E}(x)$。\n\n3) 假设对完整数据集进行限制性最大似然 (REML) 估计，得到随机截距和斜率及其协方差，以及残差方差的方差分量估计值如下：$\\sigma_{b0}^{2} = 0.20$, $\\sigma_{b1}^{2} = 0.10$, $\\sigma_{b0b1} = -0.02$, 以及 $\\sigma_{e}^{2} = 0.50$。使用第 (2) 部分的推导结果，计算在环境值 $x^{\\star} = 1.5$ 时，可归因于 GxE 的总表型方差的比例，定义为 $V_{G\\times E}(x^{\\star})/\\left[V_{G}(x^{\\star}) + \\sigma_{e}^{2}\\right]$。将您的答案四舍五入到四位有效数字，并以无单位的小数形式报告。", "solution": "科学基础包括反应范式的定义、线性混合效应（随机系数）模型以及线性组合的方差法则。反应范式为每个基因型将一个环境指数映射到一个表型。具有跨基因型随机截距和斜率的线性混合效应模型可以捕捉基因型特异性的反应范式，同时在各基因型之间“借用信息”。使用的方差法则包括 $\\,\\operatorname{Var}(aX+bY)=a^{2}\\operatorname{Var}(X)+b^{2}\\operatorname{Var}(Y)+2ab\\,\\operatorname{Cov}(X,Y)\\,$ 以及独立分量的方差线性性质。\n\n1) 模型构建。设 $z_{j}$ 经过均值中心化。分层模型为\n$$\ny_{igj} \\;=\\; \\big(\\beta_{0} + \\beta_{1} z_{j}\\big) \\;+\\; \\big(b_{0g} + b_{1g} z_{j}\\big) \\;+\\; \\varepsilon_{igj},\n$$\n其中 $\\,\\beta_{0}\\,$ 和 $\\,\\beta_{1}\\,$ 是固定效应，代表反应范式的群体平均截距和斜率，而 $\\,b_{0g}\\,$ 和 $\\,b_{1g}\\,$ 是基因型特异性的随机偏差（随机截距和随机斜率）。我们假设随机效应服从联合高斯分布：\n$$\n\\begin{pmatrix}\nb_{0g}\\\n$$4pt]\nb_{1g}\n\\end{pmatrix}\n\\sim \\mathcal{N}\\!\\left(\n\\begin{pmatrix}\n0\\\n$$2pt]\n0\n\\end{pmatrix},\n\\;\\;\n\\boldsymbol{\\Sigma}_{b}\n\\right),\n\\qquad\n\\boldsymbol{\\Sigma}_{b} \\;=\\;\n\\begin{pmatrix}\n\\sigma_{b0}^{2}  \\sigma_{b0b1}\\\n$$4pt]\n\\sigma_{b0b1}  \\sigma_{b1}^{2}\n\\end{pmatrix}.\n$$\n残差是独立同分布的，且\n$$\n\\varepsilon_{igj} \\sim \\mathcal{N}(0,\\sigma_{e}^{2}).\n$$\n独立性假设：$\\,\\{(b_{0g},b_{1g})\\}\\,$ 在各基因型之间是独立的，残差 $\\,\\varepsilon_{igj}\\,$ 在所有个体之间是独立的，并且与所有随机效应都独立，$\\,z_{j}\\,$ 被视为实验设计中的固定值（受控环境），并经过均值中心化以提高 $\\,\\beta_{0}\\,$ 和 $\\,\\sigma_{b0b1}\\,$ 的可解释性和可识别性。\n\n这是一个随机系数（随机回归）混合效应模型，通过随机效应 $\\,b_{0g}\\,$ 和 $\\,b_{1g}\\,$ 来估计基因型特异性的斜率和截距。\n\n2) 在环境值 $x$ 处的遗传方差。在环境值 $x$ 处，对表型的基因型特异性贡献是随机线性预测子\n$$\n\\eta_{g}(x) \\;=\\; b_{0g} + b_{1g} x.\n$$\n根据线性组合的方差公式，\n$$\nV_{G}(x) \\;\\equiv\\; \\operatorname{Var}\\!\\big(\\eta_{g}(x)\\big)\n\\;=\\; \\operatorname{Var}(b_{0g}) \\;+\\; x^{2}\\operatorname{Var}(b_{1g}) \\;+\\; 2x\\,\\operatorname{Cov}(b_{0g},b_{1g})\n\\;=\\; \\sigma_{b0}^{2} \\;+\\; x^{2}\\sigma_{b1}^{2} \\;+\\; 2x\\,\\sigma_{b0b1}.\n$$\n因为 $\\,z\\,$ 经过均值中心化，所以在平均环境下的遗传方差是\n$$\nV_{G}(0) \\;=\\; \\sigma_{b0}^{2}.\n$$\n一种有原则地定义在 $x$ 处的基因型-环境互作 (GxE) 方差的方法是，将其定义为遗传方差中源于基因型之间相对于平均环境的环境依赖性分歧的部分。即，\n$$\nV_{G\\times E}(x) \\;\\equiv\\; V_{G}(x) \\;-\\; V_{G}(0)\n\\;=\\; \\big(\\sigma_{b0}^{2} + x^{2}\\sigma_{b1}^{2} + 2x\\,\\sigma_{b0b1}\\big) \\;-\\; \\sigma_{b0}^{2}\n\\;=\\; x^{2}\\sigma_{b1}^{2} \\;+\\; 2x\\,\\sigma_{b0b1}.\n$$\n因此，$\\,\\sigma_{b1}^{2}\\,$ 是捕捉斜率异质性（一个核心的 GxE 特征）的方差分量，而 $\\,\\sigma_{b0b1}\\,$ 则捕捉了具有较高截距的基因型是否倾向于随环境更陡峭地上升或下降，从而线性地调节 $\\,V_{G\\times E}(x)\\,$。\n\n在该模型下，在 $x$ 处的总表型方差为\n$$\nV_{P}(x) \\;=\\; V_{G}(x) \\;+\\; \\sigma_{e}^{2}.\n$$\n\n3) 使用提供的方差分量，在 $\\,x^{\\star}=1.5\\,$ 处进行数值计算。首先计算\n$$\nV_{G}(x^{\\star}) \\;=\\; \\sigma_{b0}^{2} \\;+\\; (x^{\\star})^{2}\\sigma_{b1}^{2} \\;+\\; 2x^{\\star}\\sigma_{b0b1}\n\\;=\\; 0.20 \\;+\\; (1.5)^{2}\\cdot 0.10 \\;+\\; 2\\cdot 1.5 \\cdot (-0.02).\n$$\n计算各项：\n- $(1.5)^{2}\\cdot 0.10 \\;=\\; 2.25 \\cdot 0.10 \\;=\\; 0.225$,\n- $2\\cdot 1.5 \\cdot (-0.02) \\;=\\; -0.06$。\n因此，\n$$\nV_{G}(1.5) \\;=\\; 0.20 + 0.225 - 0.06 \\;=\\; 0.365.\n$$\n然后\n$$\nV_{G\\times E}(1.5) \\;=\\; V_{G}(1.5) - V_{G}(0) \\;=\\; 0.365 - 0.20 \\;=\\; 0.165.\n$$\n在 $\\,x^{\\star}\\,$ 处的总表型方差是\n$$\nV_{P}(1.5) \\;=\\; V_{G}(1.5) + \\sigma_{e}^{2} \\;=\\; 0.365 + 0.50 \\;=\\; 0.865.\n$$\n因此所求的比例为\n$$\n\\frac{V_{G\\times E}(1.5)}{V_{P}(1.5)} \\;=\\; \\frac{0.165}{0.865} \\;=\\; \\frac{33}{173} \\;\\approx\\; 0.190751\\ldots\n$$\n四舍五入到四位有效数字，结果为 $\\,0.1908\\,$，是一个无单位的小数。", "answer": "$$\\boxed{0.1908}$$", "id": "2630142"}, {"introduction": "在研究发育过程时，时间是一个棘手的变量。一个环境因素（如温度）可以同时改变发育的速率和在任何特定阶段所表达的表型。本练习 [@problem_id:2629995] 旨在解决这一根本性的混淆问题。运用微积分中的链式法则，你将把观测到的环境总效应分解为直接的、阶段特 ειδ的效应，以及通过发育速率起作用的间接效应。此过程不仅揭示了为何在固定时间点进行测量会产生误导，还让你能探索消除这种偏差的有效方法。", "problem": "一个研究小组旨在量化两栖动物早期发育过程中，颅面测量指标在一个热梯度下的基因型特异性反应范式。设焦点表型为 $y$，外部环境（温度）为 $E$，受精后的时序时间为 $t$，一维发育进程变量（阶段）为 $s$。假设基因型固定，母体效应可忽略不计，且对于所有 $E$，$s$ 都是 $t$ 的严格递增函数，使得 $s = g(t,E)$，其中 $g$ 可微且 $\\partial g/\\partial t \\gt 0$。表型由一个可微的阶段条件响应面 $f$ 生成，使得 $y = f(s,E) + \\varepsilon$，其中 $\\varepsilon$ 是一个均值为零的误差项，在给定 $s$ 的条件下独立于 $E$。然而，该团队在固定时序时间 $t^\\star$ 收集了跨环境的测量数据，并将 $y$ 对 $E$ 进行回归，以估计在 $t^\\star$ 时的表观反应范式斜率。\n\n仅从上述定义和微分学的标准结果出发，解释在固定时序时间估计反应范式是否会将环境对 $y$ 的影响与环境引起的发育速率变异相混淆。然后，评估各种方法论上的补救措施，看它们在多大程度上能够恢复因果性的、特定于阶段的环境效应，即偏导数 $\\left.\\partial f/\\partial E\\right|_{s}$。\n\n哪些陈述是正确的？\n\nA. 在固定的时序时间 $t^\\star$，观测到的导数 $\\left.\\mathrm{d}\\,\\mathbb{E}[y\\mid t^\\star,E]/\\mathrm{d}E\\right|_{t^\\star}$ 通过链式法则分解为一个直接分量 $\\left.\\partial f/\\partial E\\right|_{s}$ 加上一个间接分量 $\\left.(\\partial f/\\partial s)\\right|_{E}\\cdot \\left.\\left(\\partial s/\\partial E\\right)\\right|_{t}$，并在 $s=g(t^\\star,E)$ 处进行评估。因此，在固定的 $t^\\star$ 进行测量通常会将环境对发育速率的影响与因果性的、特定于阶段的对 $y$ 的影响相混淆。按阶段对齐观察结果（例如，在相同的形态学标志点对所有个体进行抽样）并估计 $\\left.\\partial f/\\partial E\\right|_{s}$ 可以消除这种混淆。\n\nB. 将时序时间 $t$ 作为协变量纳入 $y$ 的线性模型中，可以消除因环境依赖性发育速率引起的偏差，因为对 $t$ 进行调整阻断了从 $E$ 经过 $s$ 到 $y$ 的伪路径。\n\nC. 通过发育标志（例如，肢芽出现）对样本进行标准化，使得 $s$ 在不同 $E$ 之间均等化，然后拟合一个以 $s$ 为条件的 $y$ 模型——例如，在固定的 $s$ 下使用 $y$ 对 $E$ 的非参数回归，或通过动态时间规整（DTW, Dynamic Time Warping）将整个轨迹对齐到共同的阶段轴，然后估计 $\\partial f/\\partial E$——可以恢复因果性的、特定于阶段的环境效应。\n\nD. 在 $t^\\star$ 周围的一个宽时序时间窗口内对 $y$ 进行平均，可以得到阶段特异性反应范式的无偏估计，因为发育较快和较慢的个体在该窗口内相互平衡。\n\nE. 在不按阶段重新采样的情况下，一个在 $t^\\star$ 的有效校正方法是，从标志点时间的随环境变化来估计 $\\left.\\partial s/\\partial E\\right|_{t^\\star}$，并从 $y$ 的局部阶段轨迹来估计 $\\left.\\partial f/\\partial s\\right|_{E}$。在平滑性和局部可识别性条件下，校正后的阶段特异性效应满足 $\\left.\\partial f/\\partial E\\right|_{s} = \\left.\\mathrm{d}\\,\\mathbb{E}[y\\mid t^\\star,E]/\\mathrm{d}E\\right|_{t^\\star} - \\left.(\\partial f/\\partial s)\\right|_{E}\\cdot \\left.\\left(\\partial s/\\partial E\\right)\\right|_{t^\\star}$，并在参考阶段进行评估。\n\n选择所有适用的选项。", "solution": "问题陈述是有效的。这是一个表述清晰、自成体系的问题，它探讨了发育可塑性研究中的一个根本性问题，即直接环境效应与环境诱导的发育速率变化之间的混淆。定义是精确的，并且问题可以通过严格应用微分学来回答。我们现在开始进行形式推导和评估。\n\n系统由以下方程定义：\n$$ y = f(s, E) + \\varepsilon $$\n$$ s = g(t, E) $$\n其中 $y$ 是表型，$E$ 是环境，$t$ 是时序时间，$s$ 是发育阶段。误差项 $\\varepsilon$ 的条件均值为零，$\\mathbb{E}[\\varepsilon \\mid s, E] = 0$。\n\n在给定的时间 $t$ 和环境 $E$ 下，预期表型可以通过将 $s$ 的表达式代入 $y$ 的模型并求期望值得到：\n$$ \\mathbb{E}[y \\mid t, E] = \\mathbb{E}[f(g(t, E), E) + \\varepsilon \\mid t, E] $$\n鉴于 $s$ 完全由 $t$ 和 $E$ 决定，我们有：\n$$ \\mathbb{E}[y \\mid t, E] = f(g(t, E), E) + \\mathbb{E}[\\varepsilon \\mid s=g(t,E), E] = f(g(t, E), E) $$\n\n所描述的实验涉及在固定的时序时间 $t = t^\\star$ 进行的测量。“表观反应范式斜率”是预期表型相对于环境 $E$ 的全导数，同时保持时间在 $t^\\star$ 不变。该量表示为 $\\left.\\mathrm{d}\\,\\mathbb{E}[y\\mid t^\\star,E]/\\mathrm{d}E\\right|_{t^\\star}$。为计算此导数，我们将多元函数的链式法则应用于复合函数 $\\phi(E) = f(g(t^\\star, E), E)$：\n$$ \\left.\\frac{\\mathrm{d}\\,\\mathbb{E}[y\\mid t^\\star,E]}{\\mathrm{d}E}\\right|_{t^\\star} = \\frac{\\mathrm{d}}{\\mathrm{d}E} f(g(t^\\star, E), E) $$\n设 $f$ 的第一个参数为 $s$，第二个参数为 $E$。第一个参数 $s$ 是 $E$ 的函数（因为 $t$ 固定在 $t^\\star$），而第二个参数是 $E$ 本身。链式法则得出：\n$$ \\frac{\\mathrm{d}}{\\mathrm{d}E} f(s(E), E) = \\frac{\\partial f}{\\partial s} \\frac{\\mathrm{d}s}{\\mathrm{d}E} + \\frac{\\partial f}{\\partial E} \\frac{\\mathrm{d}E}{\\mathrm{d}E} $$\n代入 $s(E) = g(t^\\star, E)$，我们发现 $\\frac{\\mathrm{d}s}{\\mathrm{d}E} = \\left.\\frac{\\partial g}{\\partial E}\\right|_{t=t^\\star}$。使用问题中对此偏导数的符号表示 $\\left.\\left(\\partial s/\\partial E\\right)\\right|_{t}$，我们得到核心的分解式：\n$$ \\left.\\frac{\\mathrm{d}\\,\\mathbb{E}[y\\mid t^\\star,E]}{\\mathrm{d}E}\\right|_{t^\\star} = \\left.\\frac{\\partial f}{\\partial E}\\right|_{s} + \\left.\\frac{\\partial f}{\\partial s}\\right|_{E} \\cdot \\left.\\frac{\\partial s}{\\partial E}\\right|_{t} $$\n右侧的所有导数都在对应于 $(t^\\star, E)$ 的点上进行评估，即在阶段 $s = g(t^\\star, E)$ 和环境 $E$ 处。\n\n这个方程表明，观测到的斜率（左侧）是两项之和：\n1. $\\left.\\partial f/\\partial E\\right|_{s}$：对表型的因果性的、特定于阶段的环境效应，这是我们感兴趣的量。这代表了在恒定发育阶段下，$E$ 对 $y$ 的“直接”效应。\n2. $\\left.(\\partial f/\\partial s)\\right|_{E} \\cdot \\left.\\left(\\partial s/\\partial E\\right)\\right|_{t}$：一个“间接”效应，其产生原因在于环境 $E$ 改变了在时序时间 $t^\\star$ 所达到的发育阶段 $s$。该项是表型随阶段的变化（$\\partial f/\\partial s$）与在固定时间下阶段随环境的变化（$\\partial s/\\partial E$）的乘积。\n\n因此，在固定的时序时间 $t^\\star$ 进行实验，会将我们感兴趣的直接效应与由发育速率介导的间接效应相混淆。观测到的斜率是因果效应 $\\left.\\partial f/\\partial E\\right|_{s}$ 的一个有偏估计量，除非 $\\partial f/\\partial s = 0$（表型在不同阶段间恒定）或 $\\partial s/\\partial E = 0$（环境不影响发育速率）。我们现在来评估每个选项。\n\nA. 在固定的时序时间 $t^\\star$，观测到的导数 $\\left.\\mathrm{d}\\,\\mathbb{E}[y\\mid t^\\star,E]/\\mathrm{d}E\\right|_{t^\\star}$ 通过链式法则分解为一个直接分量 $\\left.\\partial f/\\partial E\\right|_{s}$ 加上一个间接分量 $\\left.(\\partial f/\\partial s)\\right|_{E}\\cdot \\left.\\left(\\partial s/\\partial E\\right)\\right|_{t}$，并在 $s=g(t^\\star,E)$ 处进行评估。因此，在固定的 $t^\\star$ 进行测量通常会将环境对发育速率的影响与因果性的、特定于阶段的对 $y$ 的影响相混淆。按阶段对齐观察结果（例如，在相同的形态学标志点对所有个体进行抽样）并估计 $\\left.\\partial f/\\partial E\\right|_{s}$ 可以消除这种混淆。\n该陈述是我们推导的精确且正确的总结。分解公式是准确的。由此得出存在混淆的结论是正确的。所提出的补救措施——按阶段 $s$ 对齐观察结果——是分离我们感兴趣的参数的最直接方法。如果将 $s$ 保持在某个值 $s^\\star$ 不变，那么观察到的 $y$ 相对于 $E$ 的任何变异都必须归因于直接效应，因为通过阶段变异的间接路径已被实验设计所阻断。这直接估计了 $\\left.\\partial f/\\partial E\\right|_{s=s^\\star}$。\n结论：**正确**。\n\nB. 将时序时间 $t$ 作为协变量纳入 $y$ 的线性模型中，可以消除因环境依赖性发育速率引起的偏差，因为对 $t$ 进行调整阻断了从 $E$ 经过 $s$ 到 $y$ 的伪路径。\n这个陈述是错误的，原因有多个。首先，指定的实验是在一个*固定*的时序时间 $t^\\star$ 进行的。在这样的数据集中，$t$ 是一个常数，不能作为协变量包含在任何模型中；它的方差为零。其次，即使数据是在一系列的 $t$ 和 $E$ 下获得的，简单地在线性模型 $y \\sim E + t$ 中“调整 $t$”也是对真实函数关系 $y \\approx f(g(t, E), E)$ 的严重错误指定。第三，从因果角度来看，混淆的产生是因为在固定的 $t$ 下，$s$ 是 $E$ 的函数。对 $t$ 进行条件化并不能阻断路径 $E \\to s \\to y$；相反，正是在这个条件下，这个混淆路径才起作用。为了阻断这条路径而需要进行条件化的正确变量是中介变量 $s$，而不是其原因 $t$。\n结论：**错误**。\n\nC. 通过发育标志（例如，肢芽出现）对样本进行标准化，使得 $s$ 在不同 $E$ 之间均等化，然后拟合一个以 $s$ 为条件的 $y$ 模型——例如，在固定的 $s$ 下使用 $y$ 对 $E$ 的非参数回归，或通过动态时间规整（DTW, Dynamic Time Warping）将整个轨迹对齐到共同的阶段轴，然后估计 $\\partial f/\\partial E$——可以恢复因果性的、特定于阶段的环境效应。\n该陈述提出了方法论上可靠的解决问题的方法。通过发育标志进行标准化是“按阶段对齐观察结果”的一种实际操作，如选项A中所讨论。这确保了比较是在固定的 $s$ 下进行的，从而分离出 $\\partial f/\\partial E$。动态时间规整是一种更复杂的技术，用于将整个发育轨迹 $y(t)$ 对齐到一个代表发育阶段而非时序时间的共同轴上。一旦完成这种对齐，就可以在共享阶段轴上的任何点分析 $y$ 和 $E$ 之间的关系，从而估计出对于任何选定 $s$ 的 $\\left.\\partial f/\\partial E\\right|_{s}$。这两种方法都是解开直接和间接效应的有效策略。\n结论：**正确**。\n\nD. 在 $t^\\star$ 周围的一个宽时序时间窗口内对 $y$ 进行平均，可以得到阶段特异性反应范式的无偏估计，因为发育较快和较慢的个体在该窗口内相互平衡。\n这一论断毫无根据。正如前面所推导的，在任何给定时间 $t$ 测量的量都是直接效应和间接效应的混杂混合物。在一个时间窗口 $[t^\\star - \\Delta t, t^\\star + \\Delta t]$ 内对这个混杂的量进行平均，将产生一堆混杂估计值的平均值。没有任何数学或生物学原理能保证混淆项 $\\left((\\partial f/\\partial s) \\cdot (\\partial s/\\partial E)\\right)$ 在这个窗口内的积分会为零。“平衡”的概念是毫无根据的一厢情愿。例如，如果较高的温度总是加速发育（$\\partial s/\\partial E  0$）并且表型总是随阶段增加（$\\partial f/\\partial s  0$），那么混淆项是严格为正的，其积分也将是正的。这种方法并不能消除偏差。\n结论：**错误**。\n\nE. 在不按阶段重新采样的情况下，一个在 $t^\\star$ 的有效校正方法是，从标志点时间的随环境变化来估计 $\\left.\\partial s/\\partial E\\right|_{t^\\star}$，并从 $y$ 的局部阶段轨迹来估计 $\\left.\\partial f/\\partial s\\right|_{E}$。在平滑性和局部可识别性条件下，校正后的阶段特异性效应满足 $\\left.\\partial f/\\partial E\\right|_{s} = \\left.\\mathrm{d}\\,\\mathbb{E}[y\\mid t^\\star,E]/\\mathrm{d}E\\right|_{t^\\star} - \\left.(\\partial f/\\partial s)\\right|_{E}\\cdot \\left.\\left(\\partial s/\\partial E\\right)\\right|_{t^\\star}$，并在参考阶段进行评估。\n该陈述提出了一种统计校正而非实验校正。所提供的方程只是我们基本分解式的简单代数重排：\n$$ \\left.\\frac{\\partial f}{\\partial E}\\right|_{s} = \\left.\\frac{\\mathrm{d}\\,\\mathbb{E}[y\\mid t^\\star,E]}{\\mathrm{d}E}\\right|_{t^\\star} - \\left.\\frac{\\partial f}{\\partial s}\\right|_{E} \\cdot \\left.\\frac{\\partial s}{\\partial E}\\right|_{t} $$\n这个方程在数学上是正确的。该选项接着正确地假设，减法中的各项可以从额外的数据中估计出来。观测到的斜率 $\\mathrm{d}\\,\\mathbb{E}[y\\mid t^\\star,E]/\\mathrm{d}E$ 来自于最初的有缺陷的实验。项 $\\partial s/\\partial E$ 可以从关于达到标志点的时间如何随环境变化的数据中估计。项 $\\partial f/\\partial s$ 可以从关于在给定环境中表型如何随阶段变化的数据中估计。只要这些分量可以被足够精确地估计，就可以通过从观测到的总效应中减去估计的混淆效应，来计算因果效应 $\\partial f/\\partial E$ 的无偏估计。这是一种有效但可能需要大量数据的分析策略。\n结论：**正确**。", "answer": "$$\\boxed{ACE}$$", "id": "2629995"}]}