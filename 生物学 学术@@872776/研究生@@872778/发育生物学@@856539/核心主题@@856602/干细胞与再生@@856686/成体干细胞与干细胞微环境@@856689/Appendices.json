{"hands_on_practices": [{"introduction": "成体干细胞群的维持是组织稳态的核心。这个练习旨在通过一个基本的数学模型来探索控制干细胞数量的动态平衡。通过定义自我更新概率 $s$、分裂速率 $r$ 和丢失速率 $\\delta$ 等关键参数，我们能够推导出一个描述干细胞群体大小随时间变化的微分方程 [@problem_id:2617075]，从而深入理解决定组织再生、稳定或衰退的临界条件。", "problem": "在成年上皮组织中，每个干细胞都存在于一个局部微环境（即“生态位”）中，该环境维持着自我更新与分化之间的平衡。考虑以下基于标准干细胞命运模型的机制性假设。每个干细胞以单位细胞速率 $r$（单位：$\\text{time}^{-1}$）进行分裂。分裂后，两个子细胞中的每一个都独立地以概率 $s \\in [0,1]$ 自我更新为干细胞，并以概率 $1-s$ 分化为非干细胞。因此，每次分裂产生的干细胞子代的期望数量为 $2s$。此外，干细胞会因离开生态位或死亡而丢失，其单位细胞速率为 $\\delta \\ge 0$（单位：$\\text{time}^{-1}$），且此过程与分裂无关。设 $S(t)$ 表示时间 $t$ 时干细胞的期望数量。\n\n仅使用这些定义和标准期望论证，首先推导由此命运过程所蕴含的关于 $S(t)$ 的常微分方程。然后，将该微分方程视为精确模型，在给定初始条件 $S(0)=S_{0}>0$ 的情况下，求解其通解 $S(t)$，确定其稳态，并根据参数范围对其稳定性进行分类。最后，确定临界自我更新概率 $s_{\\mathrm{crit}}$，该值是区分种群长期衰减与长期增长的界限（即种群处于临界稳定状态时的 $s$ 值）。\n\n你的最终答案必须是 $s_{\\mathrm{crit}}$ 关于 $r$ 和 $\\delta$ 的闭式解析表达式。最终答案中不要包含单位。", "solution": "首先需要对问题陈述进行验证。\n\n步骤1：提取给定条件。\n- $r$：干细胞分裂的单位细胞速率 [$\\text{time}^{-1}$]。\n- $s$：子细胞自我更新的概率，$s \\in [0,1]$。\n- $1-s$：子细胞分化的概率。\n- $\\delta$：干细胞丢失（与分裂无关）的单位细胞速率，$\\delta \\ge 0$ [$\\text{time}^{-1}$]。\n- $S(t)$：时间 $t$ 时干细胞的期望数量。\n- $S(0) = S_{0} > 0$：初始条件。\n\n步骤2：使用提取的给定条件进行验证。\n该问题是关于构建和分析生灭过程的一个标准练习，这是数学生物学和种群动力学的基石。所提供的假设是机制性的，并为干细胞种群动力学建模提供了一个简化但科学上合理的基础。该问题是适定的，提供了推导和求解微分方程所需的所有必要参数和初始条件。术语精确且客观。没有违反科学原理、逻辑矛盾或含糊不清之处。因此，该问题被认为是**有效的**。\n\n步骤3：结论与行动。\n问题有效。我将继续进行解答。\n\n主要任务是为干细胞的期望数量 $S(t)$ 构建一个常微分方程（ODE）。我们通过考虑所有增加或减少干细胞种群的过程来为 $S(t)$ 的变化率（记为 $\\frac{dS}{dt}$）建模。\n\n干细胞期望数量的变化是期望产生速率和期望损失速率的总和。\n1.  **由细胞分裂引起的变化：** 在一个大小为 $S(t)$ 的种群中，分裂发生的总速率是 $rS(t)$。每个分裂事件涉及一个亲代干细胞（被消耗）和两个子细胞的产生。每个子细胞以概率 $s$ 成为干细胞。因此，每次分裂产生的新的干细胞的期望数量是 $2s$。一次分裂事件中干细胞数量的净变化是新产生的干细胞数量减去失去的一个亲代干细胞：$2s - 1$。由于分裂引起的干细胞种群总变化率是分裂速率与每次分裂净变化的乘积：\n    $$\n    \\text{由分裂引起的变化率} = (2s - 1) \\cdot rS(t)\n    $$\n2.  **由细胞丢失引起的变化：** 干细胞通过与分裂无关的过程以单位细胞速率 $\\delta$ 丢失。对于一个大小为 $S(t)$ 的种群，总丢失速率是：\n    $$\n    \\text{由丢失引起的变化率} = -\\delta S(t)\n    $$\n\n结合这两个速率，得到干细胞期望种群 $S(t)$ 的总变化率：\n$$\n\\frac{dS}{dt} = r(2s - 1)S(t) - \\delta S(t)\n$$\n该方程可以通过提出公因子 $S(t)$ 来简化：\n$$\n\\frac{dS}{dt} = \\left[ r(2s - 1) - \\delta \\right] S(t)\n$$\n这就是所要求的一阶线性齐次常微分方程。为方便起见，令常数系数 $\\lambda = r(2s - 1) - \\delta$。则常微分方程变为 $\\frac{dS}{dt} = \\lambda S(t)$。\n\n接下来，我们求解这个带有初始条件 $S(0) = S_{0}$ 的常微分方程。这是一个可分离方程：\n$$\n\\frac{dS}{S} = \\lambda dt\n$$\n对两边从初始状态 $(0, S_{0})$ 到状态 $(t, S(t))$ 进行积分：\n$$\n\\int_{S_{0}}^{S(t)} \\frac{1}{S'} dS' = \\int_{0}^{t} \\lambda dt'\n$$\n$$\n[\\ln|S'|]_{S_{0}}^{S(t)} = [\\lambda t']_{0}^{t}\n$$\n由于 $S(t)$ 代表一个种群，所以 $S(t) > 0$。因此，$\\ln(S(t)) - \\ln(S_{0}) = \\lambda t$。\n$$\n\\ln\\left(\\frac{S(t)}{S_{0}}\\right) = \\lambda t\n$$\n对两边取指数以求解 $S(t)$，得到通解：\n$$\nS(t) = S_{0} \\exp(\\lambda t) = S_{0} \\exp\\left( \\left[ r(2s - 1) - \\delta \\right] t \\right)\n$$\n\n现在，我们确定稳态及其稳定性。稳态 $S^*$ 是使 $\\frac{dS}{dt} = 0$ 的 $S$ 值。\n$$\n\\left[ r(2s - 1) - \\delta \\right] S^* = 0\n$$\n唯一的解是 $S^* = 0$，代表种群灭绝。该稳态的稳定性由指数 $\\lambda = r(2s - 1) - \\delta$ 的符号决定。\n- 如果 $\\lambda  0$，那么当 $t \\to \\infty$ 时，$S(t) \\to 0$。种群衰减至灭绝。稳态 $S^*=0$ 是**稳定的**。这种情况发生在 $s  \\frac{r+\\delta}{2r}$ 时。\n- 如果 $\\lambda > 0$，那么当 $t \\to \\infty$ 时，$S(t) \\to \\infty$（假设 $S_0 > 0$）。种群呈指数增长。稳态 $S^*=0$ 是**不稳定的**。这种情况发生在 $s > \\frac{r+\\delta}{2r}$ 时。\n- 如果 $\\lambda = 0$，那么对于所有 $t$，$S(t) = S_{0}$。种群大小保持不变。这是一种**临界稳定**的情况，存在一条非孤立不动点线。\n\n临界自我更新概率 $s_{\\mathrm{crit}}$ 定义为区分长期衰减与长期增长的 $s$ 值。这对应于临界稳定的情况，此时净增长率为零。\n$$\n\\lambda = r(2s_{\\mathrm{crit}} - 1) - \\delta = 0\n$$\n我们求解这个方程以得到 $s_{\\mathrm{crit}}$：\n$$\nr(2s_{\\mathrm{crit}} - 1) = \\delta\n$$\n$$\n2s_{\\mathrm{crit}} - 1 = \\frac{\\delta}{r}\n$$\n$$\n2s_{\\mathrm{crit}} = 1 + \\frac{\\delta}{r}\n$$\n$$\n2s_{\\mathrm{crit}} = \\frac{r + \\delta}{r}\n$$\n$$\ns_{\\mathrm{crit}} = \\frac{r + \\delta}{2r}\n$$\n此表达式提供了自我更新概率的临界阈值。如果 $s > s_{\\mathrm{crit}}$，干细胞种群会扩张。如果 $s  s_{\\mathrm{crit}}$，它会收缩至灭绝。如果 $s = s_{\\mathrm{crit}}$，它会维持在初始大小。", "answer": "$$\\boxed{\\frac{r+\\delta}{2r}}$$", "id": "2617075"}, {"introduction": "理论模型为理解干细胞行为提供了框架，但我们如何在复杂的活体组织中识别并研究这些细胞呢？本练习聚焦于一种经典的实验方法——标记保留分析（label-retaining assay），它被广泛用于识别静息或缓慢分裂的干细胞。通过分析该技术背后的原理、优点和固有的局限性 [@problem_id:2617096]，你将学会如何批判性地评估实验设计和解读其产生的数据，这是将理论应用于实践的关键一步。", "problem": "一个实验室正在研究在小鼠表皮中体内识别静息成体干细胞的策略。他们采用了两种脉冲-追踪标记保留分析设计：(i) 使用5-乙炔基-2'-脱氧尿苷 (EdU) 或 5-溴-2'-脱氧尿苷 (BrdU) 的胸苷类似物脉冲，以及 (ii) 由角蛋白启动子驱动的四环素调控组蛋白 H2B-绿色荧光蛋白 (H2B-GFP) 系统。实验逻辑基于以下经过充分检验的事实和定义：在细胞周期中，DNA在S期合成并通过半保留复制进行复制；S期掺入的标记分子在有丝分裂时被分配到子细胞中；脉冲-追踪实验在脉冲结束时停止标记物的掺入，此后标记物仅因细胞分裂和分子更新而被稀释。\n\n在对周期性分裂的表皮细胞进行为期$7$天的脉冲标记以使其饱和后，研究人员进行了为期$60$天的追踪，期间不再添加标记物。他们观察到一小群表皮细胞保留了H2B-GFP，其荧光强度约为脉冲标记刚结束时测得的平均荧光强度的$12.5\\%$。在胸苷类似物脉冲标记期间，他们还检测到DNA损伤应答标记物的染色增强。\n\n仅使用上述基本原理，对标记物的预期稀释和标记保留细胞的解释进行推理。以下哪个/些陈述最准确地概括了用于在体内识别静息干细胞的标记保留分析的原理、优点和局限性？\n\nA. 标记保留分析依赖于在S期掺入可追踪的标记物，并在每次分裂时该标记物在子细胞间近似减半，从而使慢周期细胞能更长时间地保留标记物，因此在可能包含静息干细胞的标记保留细胞中得到富集。\n\nB. 标记保留细胞必定是干细胞，因为在成体组织中只有干细胞是慢周期的；因此，标记保留是干细胞特性的特异性标记。\n\nC. 诸如EdU或BrdU的胸苷类似物脉冲在标记剂量下是生物惰性的，不会改变DNA损伤应答或增殖速率；因此，标记物本身不会对哪些细胞成为标记保留细胞产生偏向。\n\nD. 组蛋白H2B-GFP标记稳定地与染色质结合，因此不随细胞分裂而稀释；在追踪期间H2B-GFP荧光的丧失必定反映了蛋白质降解或细胞丢失，而非增殖。\n\nE. 标记保留分析的一个局限性是它们可能会漏掉快周期干细胞（例如，富含亮氨酸重复序列的G蛋白偶联受体5阳性的肠道干细胞）；将标记保留与功能性谱系追踪或移植相结合可以提高对干细胞特性的特异性。\n\nF. 一个解释上的警示是，在某些干细胞中可能存在模板DNA的非随机（所谓的“不朽链”）分离；如果存在这种情况，分裂中的干细胞保留标记物可能不是因为它处于静息状态，而是因为它选择性地保留了较旧的、被标记的DNA链，这使得标记保留与细胞周期速率之间的联系变得复杂。\n\nG. 在$60$天追踪后观察到约$12.5\\%$的H2B-GFP强度，这与这些细胞在追踪期间经历了约$3$次细胞分裂是一致的，从而支持了平均细胞周期时间长达数十天的推论。\n\n选择所有适用项。", "solution": "问题陈述描述了一组旨在通过标记保留分析来识别静息成体干细胞的实验。该陈述在科学上是合理的，提法得当，并且基于发育和干细胞生物学中既定的原理和技术。所有提供的信息都是一致且充分的，足以对后续陈述进行严格评估。因此，该问题是有效的，我们可以开始分析。\n\n标记保留细胞 (LRC) 分析的核心原理是识别慢周期细胞。首先施加一个稳定标记物的脉冲，增殖细胞会将其掺入。随后是一个不含标记物的追踪期。在追踪期间，快速增殖的细胞会分裂多次，将标记物稀释到无法检测的水平。相比之下，静息或慢周期细胞很少分裂（如果分裂的话），因此能更长时间地保留标记物。由于许多成体干细胞群体相对静息，该方法有助于富集这些细胞。问题描述了两种此类标记策略：在S期掺入DNA的胸苷类似物（如EdU/BrdU），以及掺入染色质的基因编码的、四环素诱导的组蛋白H2B-GFP融合蛋白。\n\n让我们根据这些原理和所提供的信息来评估每个陈述。\n\n**A. 标记保留分析依赖于在S期掺入可追踪的标记物，并在每次分裂时该标记物在子细胞间近似减半，从而使慢周期细胞能更长时间地保留标记物，因此在可能包含静息干细胞的标记保留细胞中得到富集。**\n该陈述正确地总结了该分析的基本逻辑。\n1.  **标记掺入**：胸苷类似物（进入DNA）和新的组蛋白（进入染色质）都在细胞周期的S期被掺入，此时细胞正准备分裂。\n2.  **标记稀释**：有丝分裂时，被标记的物质被分配到两个子细胞中。对于DNA，半保留复制确保每个子细胞接收一条旧的（模板，可能被标记）链和一条新链，相对于亲代细胞，每个细胞中被标记链的浓度有效地减半。对于组蛋白，亲代细胞中标记的H2B-GFP池与新合成的未标记组蛋白一起，大致均匀地分布到两组子染色单体上。这也导致每次分裂后每个细胞的荧光信号近似减半。\n3.  **富集慢周期细胞**：分裂频率较低的细胞将经历更少轮次的稀释，从而在更长的时间内保留可检测水平的标记物。静息干细胞是此类慢周期群体的一个主要例子。“可能包含静息干细胞”的措辞是适当谨慎的，因为标记保留并非干细胞所独有。\n因此，该陈述是对该原理的正确而准确的描述。\n**结论：正确**\n\n**B. 标记保留细胞必定是干细胞，因为在成体组织中只有干细胞是慢周期的；因此，标记保留是干细胞特性的特异性标记。**\n该陈述做出了在生物学上不符合事实的确定性和排他性断言。\n1.  并非所有LRC都是干细胞。已进入有丝分裂后期的终末分化细胞（即永久停止分裂的细胞）也会保留它们在最后一个细胞周期中掺入的任何标记物。这类细胞是LRC，但不是干细胞。其他长寿命、慢周期的祖细胞也可能是LRC。\n2.  并非所有干细胞都是慢周期的。一些干细胞群体，例如肠道或处于活跃生长期的毛囊中的干细胞，是高度增殖的。问题本身在选项E中也暗示了这种可能性。\n3.  因为标记保留并非干细胞所独有，所以它不是干细胞特性的*特异性*标记。它是一个操作性定义，富集了与某些（但非全部）干细胞*相关*的细胞特征（慢周期）。\n因此，该陈述中的确定性和绝对性断言是不正确的。\n**结论：不正确**\n\n**C. 诸如EdU或BrdU的胸苷类似物脉冲在标记剂量下是生物惰性的，不会改变DNA损伤应答或增殖速率；因此，标记物本身不会对哪些细胞成为标记保留细胞产生偏向。**\n该陈述在事实上是不正确的，并与问题描述中提供的信息直接矛盾。问题明确指出：“在胸苷类似物脉冲标记期间，他们还检测到DNA损伤应答标记物的染色增强。”这一观察表明这些类似物并非生物惰性的。在该领域中，这是一个众所周知的警示：胸苷类似物可能具有诱变性，引起DNA损伤，并触发细胞周期停滞，尤其是在浓度高到足以确保稳健标记的情况下。这可能会混淆结果，例如，通过在仅仅因DNA损伤而停滞的细胞中人为地诱导一种类似静息的、标记保留的状态。该前提是错误的，因此结论也是不成立的。\n**结论：不正确**\n\n**D. 组蛋白H2B-GFP标记稳定地与染色质结合，因此不随细胞分裂而稀释；在追踪期间H2B-GFP荧光的丧失必定反映了蛋白质降解或细胞丢失，而非增殖。**\n该陈述从根本上误解了细胞分裂过程中组蛋白分离的机制。虽然单个组蛋白确实稳定地与DNA结合形成染色质，但整个染色质组在S期被复制，这一过程需要合成新的、未标记的组蛋白。在有丝分裂期间，现有的标记组蛋白和新的未标记组蛋白被分配到两个子细胞中。这个过程导致每次分裂后每个细胞中H2B-GFP的浓度近似减半。这种因增殖而产生的稀释是使用H2B-GFP系统作为标记保留分析的主要基础。虽然蛋白质更新（降解）确实会发生，并在很长的时间尺度上导致信号损失，但在追踪期间增殖细胞中信号减弱的主要驱动力是通过分裂进行的稀释。该陈述中“标记不随细胞分裂而稀释”的说法是错误的。\n**结论：不正确**\n\n**E. 标记保留分析的一个局限性是它们可能会漏掉快周期干细胞（例如，富含亮氨酸重复序列的G蛋白偶联受体5阳性的肠道干细胞）；将标记保留与功能性谱系追踪或移植相结合可以提高对干细胞特性的特异性。**\n该陈述正确地指出了LRC分析的一个关键局限性以及解决该局限性的标准方法。\n1.  **局限性**：该分析旨在寻找慢周期细胞。就其本质而言，它将无法识别快速增殖的干细胞，因为这些细胞会像其他过渡扩增细胞一样迅速稀释标记物。Lgr5阳性肠道干细胞就是一个典型的例子；这些是真正的、高度活跃的干细胞，在长追踪期的LRC实验中会被漏掉。\n2.  **提高特异性**：正如对选项B的分析所确立的，标记保留不是干细胞特性的确定性标记。要证明一个细胞是干细胞，必须证明其功能特性：自我更新和产生分化后代的能力。体内谱系追踪和连续移植是用于此目的的金标准功能性分析。将LRC的识别与这些功能性测试相结合，为证明一个给定的LRC确实是干细胞提供了更强有力的证据。\n**结论：正确**\n\n**F. 一个解释上的警示是，在某些干细胞中可能存在模板DNA的非随机（所谓的“不朽链”）分离；如果存在这种情况，分裂中的干细胞保留标记物可能不是因为它处于静息状态，而是因为它选择性地保留了较旧的、被标记的DNA链，这使得标记保留与细胞周期速率之间的联系变得复杂。**\n该陈述准确地描述了“不朽链假说”，这是使用像BrdU/EdU这样的DNA标记的LRC分析中的一个重要理论考量。该假说提出，在干细胞不对称分裂过程中，原始的模板DNA链被选择性地保留在仍然是干细胞的子细胞中，而新合成的链则被分配到注定分化的子细胞中。如果发生这种情况，干细胞将通过多次分裂保留其原始的标记DNA，无论其实际分裂速率如何，都会表现为LRC。这将混淆“标记保留完全反映了细胞分裂速率慢”的解释。虽然支持该机制的证据存在争议且可能具有组织依赖性，但它仍然是解释这些实验时一个有效且重要的警示。H2B-GFP系统不受此特定复杂因素的影响，但该陈述正确地将其界定为与整体方法学相关的一个警示。\n**结论：正确**\n\n**G. 在$60$天追踪后观察到约$12.5\\%$的H2B-GFP强度，这与这些细胞在追踪期间经历了约$3$次细胞分裂是一致的，从而支持了平均细胞周期时间长达数十天的推论。**\n该陈述需要对标记稀释进行定量分析。假设H2B-GFP信号每次细胞分裂减半，我们可以计算出导致最终强度为初始强度$12.5\\%$所需的分裂次数$n$。\n设初始强度为$I_0$。经过$n$次分裂后，最终强度$I_f$由$I_f = I_0 \\times (1/2)^n$给出。\n问题陈述$I_f / I_0 \\approx 0.125$。\n我们求解$n$：\n$$0.125 = \\left(\\frac{1}{2}\\right)^n$$\n$$\\frac{1}{8} = \\left(\\frac{1}{2}\\right)^n$$\n$$\\left(\\frac{1}{2}\\right)^3 = \\left(\\frac{1}{2}\\right)^n$$\n因此，$n=3$。该观察结果与$3$次细胞分裂是一致的。\n追踪期为$60$天。平均细胞周期时间将是总时间除以周期数：\n$$\\text{Average cell cycle time} = \\frac{60 \\text{ days}}{3 \\text{ divisions}} = 20 \\text{ days/division}$$\n$20$天的细胞周期时间确实是一个“长的平均细胞周期时间”，并且在“数十天”的量级上。该分析在数量上是合理的，结论也是合理的。\n**结论：正确**", "answer": "$$\\boxed{AEFG}$$", "id": "2617096"}, {"introduction": "随着单细胞测序等高通量技术的发展，我们现在能够以前所未有的分辨率来解析组织异质性。这个计算练习将带你进入这一前沿领域，要求你设计并实现一个分析流程，用以从单细胞转录组数据中识别干细胞状态并推断其与微环境（即“干细胞微巢”）之间的信号交流 [@problem_id:2617121]。这项实践不仅能加深你对干细胞及其微巢互作的理解，还能锻炼你将生物学问题转化为可执行计算策略的关键能力。", "problem": "您将要完成一个概念与计算任务，该任务基于成体干细胞及其微环境（即干细胞微环境）的发育生物学。目标是形式化一个最小但有原则的、基于配体-受体的推理流程，该流程能从单细胞RNA测序（scRNA-seq）数据中识别干细胞状态，并量化微环境向这些细胞传递的信号。您的程序必须实现指定的流程，并在提供的测试套件上计算所要求的摘要输出。所有计算都必须按照下文的定义执行，最终输出必须是包含所有测试用例结果的单行，并采用规定的格式。\n\n基本原理：\n- 分子生物学中心法则：基因表达过程为，从脱氧核糖核酸（DNA）转录为信使核糖核酸（mRNA），再翻译为蛋白质。在scRNA-seq中，测得的mRNA丰度在稳态假设下可作为蛋白质水平的代理指标，并被广泛用于推断细胞状态和细胞间信号传导。\n- 旁分泌信号传导：要求发送细胞和接收细胞分别表达相容的配体和受体。一个用于衡量潜在信号强度的最小计算代理可以通过发送细胞的配体活性与接收细胞的受体活性的乘积来构建，该乘积在所有配体-受体对上进行汇总，并按空间或接触邻近度加权。\n\n定义和流程（需严格按照规定实现）：\n1) 数据表示：\n   - 假设有 $n$ 个细胞和 $m$ 个基因。设 $E \\in \\mathbb{R}^{n \\times m}$ 为非负表达矩阵，其中 $E_{i,g}$ 是基因 $g$ 在细胞 $i$ 中的表达量。设 $G = [g_{1}, g_{2}, \\dots, g_{m}]$ 是与 $E$ 的列相对应的有序基因符号列表。\n   - 设 $M_{\\mathrm{stem}} \\subseteq G$ 是一个非空的干性标记基因集合。设 $M_{\\mathrm{diff}} \\subseteq G$ 是一个非空的分化标记基因集合。\n   - 设 $\\mathcal{P}$ 是一个配体-受体基因符号对 $(\\ell, r)$ 的集合。对于 $\\ell \\notin G$ 或 $r \\notin G$ 的基因对，必须予以忽略。\n   - 设 $W \\in \\mathbb{R}_{\\ge 0}^{n \\times n}$ 是一个有向接触或邻近矩阵，其中 $W_{a,b}$ 是从发送细胞 $a$到接收细胞 $b$的潜在影响权重。值为零的条目表示没有影响。\n2) 逐基因归一化与激活：\n   - 对每个基因 $g$，计算均值 $\\mu_{g} = \\frac{1}{n} \\sum_{i=1}^{n} E_{i,g}$ 和标准差 $\\sigma_{g} = \\sqrt{\\frac{1}{n} \\sum_{i=1}^{n} \\left(E_{i,g} - \\mu_{g}\\right)^{2}}$。\n   - 使用数值稳定器 $\\epsilon = 10^{-8}$，并定义标准化表达（z-score）为 $Z_{i,g} = \\frac{E_{i,g} - \\mu_{g}}{\\sigma_{g} + \\epsilon}$，适用于所有的 $i, g$。\n   - 定义校正激活值 $A_{i,g} = \\max\\{Z_{i,g}, 0\\}$，适用于所有的 $i, g$。\n3) 干性评分与筛选：\n   - 对每个细胞 $i$，计算其干性分数\n     $$ s_{i} = \\frac{1}{|M_{\\mathrm{stem}}|} \\sum_{g \\in M_{\\mathrm{stem}}} Z_{i,g} \\;-\\; \\frac{1}{|M_{\\mathrm{diff}}|} \\sum_{g \\in M_{\\mathrm{diff}}} Z_{i,g}. $$\n   - 给定筛选比例 $f \\in (0,1]$，令 $k = \\left\\lfloor f \\cdot n \\right\\rfloor$。如果 $k = 0$，则设 $k = 1$。精确选择 $k$ 个具有最大 $s_{i}$ 值的细胞。如遇平分，必须优先选择细胞索引较小者。设筛选出的类干细胞索引集合为 $S \\subseteq \\{0,1,\\dots,n-1\\}$。\n4) 配体-受体信号分数：\n   - 设 $\\mathcal{P}^{\\star} = \\{(\\ell, r) \\in \\mathcal{P} \\mid \\ell \\in G, r \\in G\\}$ 为过滤后的有效基因对集合。对于任意发送细胞 $a$ 和接收细胞 $b$，定义\n     $$ \\mathrm{LR}(a,b) = \\sum_{(\\ell, r) \\in \\mathcal{P}^{\\star}} A_{a,\\ell} \\cdot A_{b,r}, $$\n     其中 $A_{a,\\ell}$ 表示配体基因 $\\ell$ 在细胞 $a$ 中的激活值，$A_{b,r}$ 表示受体基因 $r$ 在细胞 $b$ 中的激活值。如果 $\\mathcal{P}^{\\star}$ 为空，则对所有的 $a,b$，$\\mathrm{LR}(a,b) = 0$。\n   - 细胞 $b$ 接收到的微环境分数为\n     $$ N_{b} = \\sum_{a=0}^{n-1} W_{a,b} \\cdot \\mathrm{LR}(a,b). $$\n5) 每个测试用例的必需输出：\n   - 设 $n_{\\mathrm{stem}} = |S|$。\n   - 设 $b^{\\star} \\in S$ 为 $b \\in S$ 中具有最大微环境分数 $N_{b}$ 的类干细胞的索引。如遇平分，选择较小的索引。\n   - 设 $\\overline{N}_{S} = \\frac{1}{|S|} \\sum_{b \\in S} N_{b}$ 为所选类干细胞的平均微环境分数。将此值报告为四舍五入到三位小数的实数。\n   - 对于每个测试用例，您的程序必须输出三元组 $[n_{\\mathrm{stem}}, b^{\\star}, \\overline{N}_{S}]$。\n6) 所有测试用例的最终输出格式：\n   - 您的程序应生成单行输出，其中包含所有结果，格式为每个测试用例三元组组成的逗号分隔列表，并用方括号括起，例如：$[[\\dots],[\\dots],[\\dots]]$。\n\n测试套件：\n实现您的程序以在以下三个测试用例上运行。在所有情况下，索引都是从零开始的，并且 $G$ 中基因的顺序与 $E$ 的列相匹配。\n\n- 测试用例1（具有多个配体-受体对和链式邻接的一般情况）：\n  - $G = [\\mathrm{SOX2}, \\mathrm{LGR5}, \\mathrm{KRT20}, \\mathrm{WNT2}, \\mathrm{FZD7}, \\mathrm{TGFB1}, \\mathrm{TGFBR2}, \\mathrm{GAPDH}]$.\n  - $n = 6$, $m = 8$.\n  - $E$（行是细胞 $0$ 到 $5$；列遵循 $G$ 的顺序）：\n    - 细胞 $0$: $[8, 7, 1, 5, 4, 1, 2, 50]$\n    - 细胞 $1$: $[7, 6, 2, 4, 3, 0, 3, 48]$\n    - 细胞 $2$: $[2, 1, 8, 2, 2, 6, 5, 47]$\n    - 细胞 $3$: $[1, 1, 9, 1, 1, 7, 7, 52]$\n    - 细胞 $4$: $[3, 2, 4, 6, 5, 1, 2, 49]$\n    - 细胞 $5$: $[2, 2, 3, 7, 6, 0, 1, 51]$\n  - $M_{\\mathrm{stem}} = \\{\\mathrm{SOX2}, \\mathrm{LGR5}\\}$, $M_{\\mathrm{diff}} = \\{\\mathrm{KRT20}\\}$.\n  - $\\mathcal{P} = \\{(\\mathrm{WNT2}, \\mathrm{FZD7}), (\\mathrm{TGFB1}, \\mathrm{TGFBR2})\\}$.\n  - $W$ 是一个带有自权重的链：对所有 $i$，$W_{i,i} = 0.5$；对 $i \\in \\{0,1,2,3,4\\}$，$W_{i,i+1} = 1$ 且 $W_{i+1,i} = 1$；所有其他条目均为 $0$。\n  - $f = 1/3$。\n- 测试用例2（干性分数出现平分；单个配体-受体对）：\n  - $G = [\\mathrm{SOX2}, \\mathrm{LGR5}, \\mathrm{KRT20}, \\mathrm{WNT2}, \\mathrm{FZD7}]$.\n  - $n = 4$, $m = 5$.\n  - $E$:\n    - 细胞 $0$: $[5, 5, 5, 1, 1]$\n    - 细胞 $1$: $[5, 5, 5, 2, 2]$\n    - 细胞 $2$: $[5, 5, 5, 3, 3]$\n    - 细胞 $3$: $[5, 5, 5, 4, 4]$\n  - $M_{\\mathrm{stem}} = \\{\\mathrm{SOX2}, \\mathrm{LGR5}\\}$, $M_{\\mathrm{diff}} = \\{\\mathrm{KRT20}\\}$.\n  - $\\mathcal{P} = \\{(\\mathrm{WNT2}, \\mathrm{FZD7})\\}$.\n  - $W$ 是一个带有自权重的链：对所有 $i$，$W_{i,i} = 0.5$；对 $i \\in \\{0,1,2\\}$，$W_{i,i+1} = 1$ 且 $W_{i+1,i} = 1$；所有其他条目均为 $0$。\n  - $f = 1/2$。\n- 测试用例3（基因对中存在缺失基因及一个断开连接的接收细胞）：\n  - $G = [\\mathrm{SOX2}, \\mathrm{LGR5}, \\mathrm{KRT20}, \\mathrm{TGFB1}, \\mathrm{TGFBR2}, \\mathrm{GAPDH}]$.\n  - $n = 5$, $m = 6$.\n  - $E$:\n    - 细胞 $0$: $[9, 8, 1, 0, 5, 40]$\n    - 细胞 $1$: $[1, 1, 9, 7, 2, 50]$\n    - 细胞 $2$: $[3, 2, 3, 0, 0, 55]$\n    - 细胞 $3$: $[2, 2, 4, 8, 1, 45]$\n    - 细胞 $4$: $[4, 3, 2, 0, 0, 60]$\n  - $M_{\\mathrm{stem}} = \\{\\mathrm{SOX2}, \\mathrm{LGR5}\\}$, $M_{\\mathrm{diff}} = \\{\\mathrm{KRT20}\\}$.\n  - $\\mathcal{P} = \\{(\\mathrm{WNT2}, \\mathrm{FZD7}), (\\mathrm{TGFB1}, \\mathrm{TGFBR2})\\}$；第一对将被忽略，因为 $\\mathrm{WNT2}$ 和 $\\mathrm{FZD7}$ 都不在 $G$ 中。\n  - $W$ 对细胞 $0$ 的影响为零，并稀疏地连接其他细胞。具体来说，当 $b=0$ 时，对所有 $a$ 都有 $W_{a,b} = 0$。非零条目为 $W_{1,2} = 1$，$W_{2,1} = 1$，$W_{2,3} = 1$，$W_{3,1} = 1$，$W_{3,4} = 1$，$W_{4,3} = 1$；所有对角线元素均为 $0$，所有未指定的条目也均为 $0$。\n  - $f = 2/5$。\n\n实现和数值要求：\n- 严格使用上述定义。在标准化中使用 $\\epsilon = 10^{-8}$。使用从零开始的索引。当为选择前 $k$ 个干性分数或为 $b^{\\star}$ 打破平分而排序时，总是优先选择较小的索引。\n- 不涉及物理单位或角度。\n- 您的程序应生成单行输出，其中包含所有结果，格式为每个测试用例三元组组成的逗号分隔列表，并用方括号括起，例如：$[[n_{\\mathrm{stem}},b^{\\star},\\overline{N}_{S}],\\dots]$。", "solution": "该问题要求实现一个计算流程，用以从单细胞RNA测序（scRNA-seq）数据中识别类干细胞，并量化其微环境（或称“龛”）的信号传导。该过程基于发育生物学和计算生物学中的既定原则。该问题的有效性已得到确认，因为它具有科学依据、定义明确，并且所有必要的数据和流程都得到了精确无误的说明。我将着手解决该问题，这将涉及对所定义流程的逐步实现。\n\n该流程包括五个主要阶段：(1) 数据表示，(2) 逐基因归一化与激活，(3) 干性评分与细胞筛选，(4) 配体-受体信号量化，以及 (5) 摘要输出的计算。下面我们对每个步骤进行形式化说明。\n\n**1. 数据表示与预处理**\n\n每个测试用例的输入数据包括一个表达矩阵 $E \\in \\mathbb{R}^{n \\times m}$，其中 $n$ 是细胞数量，$m$ 是基因数量。$E_{i,g}$ 表示基因 $g$ 在细胞 $i$ 中的表达水平。基因符号由一个有序列表 $G$ 给出。此外，还给定了一组干性标记基因 $M_{\\mathrm{stem}}$、一组分化标记基因 $M_{\\mathrm{diff}}$、一组配体-受体对 $\\mathcal{P}$，以及一个细胞间影响矩阵 $W$。\n\n为方便计算，我们首先创建一个从 $G$ 中的基因符号到其在矩阵 $E$ 中对应列索引（从 $0$ 到 $m-1$）的映射。这使得基因表达数据的检索更为高效。\n\n**2. 逐基因归一化与激活**\n\n由于测量尺度和转录率的差异，$E$ 中的原始基因表达值在不同基因之间不具有直接可比性。一种标准的数据归一化方法是计算z-score。对于每个基因 $g$，我们首先计算其在所有 $n$ 个细胞中的平均表达量 $\\mu_g$ 和总体标准差 $\\sigma_g$：\n$$ \\mu_{g} = \\frac{1}{n} \\sum_{i=1}^{n} E_{i,g} $$\n$$ \\sigma_{g} = \\sqrt{\\frac{1}{n} \\sum_{i=1}^{n} \\left(E_{i,g} - \\mu_{g}\\right)^{2}} $$\n一个小的数值稳定器 $\\epsilon = 10^{-8}$ 被加到标准差上，以防止在基因表达无方差时出现除以零的情况。基因 $g$ 在细胞 $i$ 中的标准化表达（即z-score）$Z_{i,g}$ 则为：\n$$ Z_{i,g} = \\frac{E_{i,g} - \\mu_{g}}{\\sigma_{g} + \\epsilon} $$\n这一转换使每个基因的表达以均值约为 $0$ 为中心，并将其缩放至标准差约为 $1$。\n\n为了模拟基因活性，我们应用一个校正函数。激活值 $A_{i,g}$ 定义为z-score的非负部分，表示相对于平均值的上调：\n$$ A_{i,g} = \\max\\{Z_{i,g}, 0\\} $$\n这会产生两个大小均为 $n \\times m$ 的矩阵 $Z$ 和 $A$。\n\n**3. 干性评分与筛选**\n\n类干细胞是根据其标记基因的表达来识别的。通过对比干性标记基因（$M_{\\mathrm{stem}}$）与分化标记基因（$M_{\\mathrm{diff}}$）的平均标准化表达，计算出每个细胞 $i$ 的干性分数 $s_i$：\n$$ s_{i} = \\frac{1}{|M_{\\mathrm{stem}}|} \\sum_{g \\in M_{\\mathrm{stem}}} Z_{i,g} \\;-\\; \\frac{1}{|M_{\\mathrm{diff}}|} \\sum_{g \\in M_{\\mathrm{diff}}} Z_{i,g} $$\n分数越高，表明细胞状态越符合干性特征。\n\n接下来，我们筛选出一组最像干细胞的细胞。给定一个筛选比例 $f \\in (0,1]$，要选择的细胞数量为 $k = \\left\\lfloor f \\cdot n \\right\\rfloor$。一个特殊条件确保至少有一个细胞被选中，即如果向下取整操作导致 $k=0$，则设置 $k=1$。我们找出具有最高干性分数的 $k$ 个细胞。$s_i$ 出现平分时，通过选择原始索引较小的细胞来打破。这将产生一个唯一的已筛选类干细胞索引集合，记为 $S$。筛选出的细胞数量为 $n_{\\mathrm{stem}} = |S| = k$。\n\n**4. 配体-受体信号传导与微环境分数计算**\n\n细胞间的通讯通过配体-受体相互作用进行建模。首先，过滤所提供的基因对列表 $\\mathcal{P}$，只保留那些配体基因 $\\ell$ 和受体基因 $r$ 都存在于基因列表 $G$ 中的基因对 $(\\ell, r)$。设这个有效集合为 $\\mathcal{P}^{\\star}$。\n\n从发送细胞 $a$ 到接收细胞 $b$ 的潜在信号强度，记为 $\\mathrm{LR}(a,b)$，是通过对所有有效基因对，将发送细胞中的配体激活值与接收细胞中的受体激活值相乘，然后求和计算得出的：\n$$ \\mathrm{LR}(a,b) = \\sum_{(\\ell, r) \\in \\mathcal{P}^{\\star}} A_{a,\\ell} \\cdot A_{b,r} $$\n其中 $A_{a,\\ell}$ 和 $A_{b,r}$ 是校正后的激活值。如果 $\\mathcal{P}^{\\star}$ 为空，则对所有的 $a,b$，$\\mathrm{LR}(a,b)=0$。这可以通过矩阵乘法为所有细胞对进行高效计算。设 $A_L$ 为所有细胞中 $\\mathcal{P}^{\\star}$ 内所有配体的 $n \\times |\\mathcal{P}^{\\star}|$ 激活矩阵，而 $A_R$ 是相应的受体 $n \\times |\\mathcal{P}^{\\star}|$ 矩阵。那么 $n \\times n$ 矩阵 $\\mathrm{LR}$ 由 $\\mathrm{LR} = A_L A_R^T$ 给出。\n\n细胞 $b$ 接收到的总信号输入，即微环境分数 $N_b$，是来自所有潜在发送细胞 $a$ 的信号强度的加权和。权重由邻近矩阵 $W$ 给出，其中 $W_{a,b}$ 代表从发送者 $a$ 到接收者 $b$ 的影响：\n$$ N_{b} = \\sum_{a=0}^{n-1} W_{a,b} \\cdot \\mathrm{LR}(a,b) $$\n该计算针对所有接收细胞 $b \\in \\{0, 1, \\dots, n-1\\}$ 执行。这对应于对矩阵 $W$ 和 $\\mathrm{LR}$ 的逐元素乘积按列求和。\n\n**5. 最终输出的推导**\n\n对于每个测试用例，我们必须报告三个值：\n1. $n_{\\mathrm{stem}}$：筛选出的类干细胞数量，等于 $k$。\n2. $b^{\\star}$：在筛选集合 $S$ 中，具有最高微环境分数 $N_b$ 的细胞的索引。平分时选择较小的细胞索引。\n3. $\\overline{N}_{S}$：筛选集合 $S$ 中所有细胞的平均微环境分数，计算公式为 $\\overline{N}_{S} = \\frac{1}{|S|} \\sum_{b \\in S} N_{b}$，并四舍五入到三位小数。\n\n最终输出是一个单一字符串，其中包含每个测试用例的一个三元组列表，格式为 `[[...],[...],[...]]`。实现将严格遵循这些步骤以确保正确性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef process_case(case_data):\n    \"\"\"\n    Processes a single test case according to the specified pipeline.\n    \"\"\"\n    E, G, M_stem, M_diff, P, W, f, n, m = case_data\n    epsilon = 1e-8\n\n    # 1. Data representation and pre-processing\n    gene_to_idx = {gene: i for i, gene in enumerate(G)}\n\n    # 2. Gene-wise normalization and activation\n    mu_g = np.mean(E, axis=0)\n    sigma_g = np.std(E, axis=0)\n    Z = (E - mu_g) / (sigma_g + epsilon)\n    A = np.maximum(Z, 0)\n    \n    # 3. Stemness scoring and selection\n    stem_marker_indices = [gene_to_idx[g] for g in M_stem if g in gene_to_idx]\n    diff_marker_indices = [gene_to_idx[g] for g in M_diff if g in gene_to_idx]\n    \n    # Ensure marker sets are not empty after filtering\n    if not stem_marker_indices or not diff_marker_indices:\n          # This scenario is not expected with the given test cases but is a good practice.\n          # We define behavior based on problem statement that M_stem and M_diff are non-empty.\n          # Stemness score would be ill-defined if either list is empty.\n          # Here we assume the input is well-formed as per the problem.\n          pass\n\n    stem_z_scores = Z[:, stem_marker_indices]\n    diff_z_scores = Z[:, diff_marker_indices]\n    \n    s_stem = np.mean(stem_z_scores, axis=1)\n    s_diff = np.mean(diff_z_scores, axis=1)\n    s = s_stem - s_diff\n\n    k = int(f * n)\n    if k == 0:\n        k = 1\n    \n    n_stem = k\n    \n    # Sort by score (desc) and then index (asc) to break ties\n    sorted_cell_indices = sorted(range(n), key=lambda i: (-s[i], i))\n    S = sorted(sorted_cell_indices[:k]) # Keep original indices, sorted\n\n    # 4. Ligand-receptor signaling score\n    P_star = [(l, r) for l, r in P if l in gene_to_idx and r in gene_to_idx]\n    \n    if not P_star:\n        LR = np.zeros((n, n))\n    else:\n        ligand_indices = [gene_to_idx[l] for l, r in P_star]\n        receptor_indices = [gene_to_idx[r] for l, r in P_star]\n        \n        A_L = A[:, ligand_indices]\n        A_R = A[:, receptor_indices]\n        \n        LR = A_L @ A_R.T\n\n    # Niche score: N_b = sum_a W_ab * LR_ab\n    # In numpy, if W[a, b] is sender a to receiver b, and LR[a,b] is sender a to receiver b,\n    # then niche score vector N for receivers b=0..n-1 is (W.T * LR).sum(axis=1) or (W * LR).sum(axis=0).\n    # W shape is (sender, receiver), LR shape is (sender, receiver).\n    # We need to sum over senders `a`. So we sum over axis 0.\n    N = np.sum(W.T * LR.T, axis=1) # Alternative: np.sum(W * LR, axis=0) gives scores for receivers. W is sender-to-receiver, so W_ab means W[a, b].\n    # Let's verify W_ab is from sender a to receiver b. `W_a,b` is from sender a to receiver b.\n    # W should be indexed as W[sender, receiver].\n    # N_b = sum_a W[a, b] * LR[a, b].\n    # This means for a fixed b, we sum over a. This is summing down a column.\n    N = np.sum(W * LR, axis=0)\n    \n    # 5. Required outputs\n    # Find b_star: cell in S with maximal niche score N\n    \n    stem_cells_scores = [(N[i], i) for i in S]\n    # Sort by score (desc), then index (asc)\n    best_stem_cell = sorted(stem_cells_scores, key=lambda x: (-x[0], x[1]))[0]\n    b_star = best_stem_cell[1]\n\n    # Calculate mean niche score over S\n    N_S_scores = N[S]\n    N_S_mean = np.mean(N_S_scores)\n\n    return [n_stem, b_star, round(N_S_mean, 3)]\n\ndef solve():\n    \"\"\"\n    Defines test cases and runs the pipeline for each, printing the final result.\n    \"\"\"\n    \n    # Test Case 1\n    G1 = [\"SOX2\", \"LGR5\", \"KRT20\", \"WNT2\", \"FZD7\", \"TGFB1\", \"TGFBR2\", \"GAPDH\"]\n    n1, m1 = 6, 8\n    E1 = np.array([\n        [8, 7, 1, 5, 4, 1, 2, 50],\n        [7, 6, 2, 4, 3, 0, 3, 48],\n        [2, 1, 8, 2, 2, 6, 5, 47],\n        [1, 1, 9, 1, 1, 7, 7, 52],\n        [3, 2, 4, 6, 5, 1, 2, 49],\n        [2, 2, 3, 7, 6, 0, 1, 51]\n    ])\n    M_stem1 = {\"SOX2\", \"LGR5\"}\n    M_diff1 = {\"KRT20\"}\n    P1 = {(\"WNT2\", \"FZD7\"), (\"TGFB1\", \"TGFBR2\")}\n    f1 = 1/3\n    # W[sender, receiver]\n    W1 = np.zeros((n1, n1))\n    for i in range(n1):\n        W1[i, i] = 0.5\n    for i in range(n1 - 1):\n        W1[i, i + 1] = 1\n        W1[i + 1, i] = 1\n    case1 = (E1, G1, M_stem1, M_diff1, P1, W1, f1, n1, m1)\n\n    # Test Case 2\n    G2 = [\"SOX2\", \"LGR5\", \"KRT20\", \"WNT2\", \"FZD7\"]\n    n2, m2 = 4, 5\n    E2 = np.array([\n        [5, 5, 5, 1, 1],\n        [5, 5, 5, 2, 2],\n        [5, 5, 5, 3, 3],\n        [5, 5, 5, 4, 4]\n    ])\n    M_stem2 = {\"SOX2\", \"LGR5\"}\n    M_diff2 = {\"KRT20\"}\n    P2 = {(\"WNT2\", \"FZD7\")}\n    f2 = 1/2\n    W2 = np.zeros((n2, n2))\n    for i in range(n2):\n        W2[i, i] = 0.5\n    for i in range(n2 - 1):\n        W2[i, i + 1] = 1\n        W2[i + 1, i] = 1\n    case2 = (E2, G2, M_stem2, M_diff2, P2, W2, f2, n2, m2)\n\n    # Test Case 3\n    G3 = [\"SOX2\", \"LGR5\", \"KRT20\", \"TGFB1\", \"TGFBR2\", \"GAPDH\"]\n    n3, m3 = 5, 6\n    E3 = np.array([\n        [9, 8, 1, 0, 5, 40],\n        [1, 1, 9, 7, 2, 50],\n        [3, 2, 3, 0, 0, 55],\n        [2, 2, 4, 8, 1, 45],\n        [4, 3, 2, 0, 0, 60]\n    ])\n    M_stem3 = {\"SOX2\", \"LGR5\"}\n    M_diff3 = {\"KRT20\"}\n    P3 = {(\"WNT2\", \"FZD7\"), (\"TGFB1\", \"TGFBR2\")}\n    f3 = 2/5\n    W3 = np.zeros((n3, n3))\n    # W[sender, receiver]\n    # W_ab is from a to b. Here it says W_a,b is from a to b.\n    # W_1,2 = 1\n    W3[1, 2] = 1; W3[2, 1] = 1\n    W3[2, 3] = 1; W3[3, 1] = 1\n    W3[3, 4] = 1; W3[4, 3] = 1\n    # All others are 0, as per spec (including diagonals)\n    case3 = (E3, G3, M_stem3, M_diff3, P3, W3, f3, n3, m3)\n\n    test_cases = [case1, case2, case3]\n    results = []\n    for case in test_cases:\n        result = process_case(case)\n        results.append(result)\n\n    result_str = str(results).replace(\" \", \"\")\n    print(result_str)\n\nsolve()\n```", "id": "2617121"}]}