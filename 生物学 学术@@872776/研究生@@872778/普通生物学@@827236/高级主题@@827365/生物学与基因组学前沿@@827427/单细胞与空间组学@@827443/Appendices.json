{"hands_on_practices": [{"introduction": "液滴微流控技术是高通量单细胞测序的核心，但它也引入了一个关键的权衡。为了提高细胞捕获效率，研究者必须增加细胞悬液的浓度，但这同时会增加“多细胞体”（multiplets）的概率，从而混淆下游分析。本练习 [@problem_id:2837411] 将通过泊松分布模型，帮助您亲手推导细胞上样密度与多细胞体率之间的定量关系，从而深刻理解实验设计中的这一基本权衡。", "problem": "在一次基于液滴的单细胞RNA测序（scRNA-seq）实验中，将单细胞悬液加载到大量的纳升级液滴中。假设每个液滴中的细胞数（由随机变量 $N$ 表示）服从平均值为 $\\lambda$ 的泊松分布，且各个液滴之间相互独立。将“液滴占有率”定义为一个液滴中含有至少一个细胞的概率，即 $P(N \\ge 1)$。将“含细胞液滴中的多重体比例”定义为在液滴中至少含有一个细胞的条件下，该液滴含有至少两个细胞的条件概率，即 $P(N \\ge 2 \\mid N \\ge 1)$。\n\n从泊松分布的假设和液滴占有率的定义出发，推导含细胞液滴中的多重体比例关于 $\\lambda$ 的表达式。然后：\n\n1. 当实验的目标液滴占有率为 $0.10$ 时，计算预期的多重体比例。\n2. 现在减少加载量以达到 $\\lambda = 0.05$，同时保持液滴总数不变。计算新的多重体比例。\n3. 报告多重体比例的倍数变化（新值除以原值），以小数形式表示。\n\n将最终的倍数变化四舍五入到四位有效数字。最终答案中不要包含任何单位。", "solution": "首先将对问题陈述的科学合理性、清晰度和完整性进行验证。\n\n**步骤1：提取已知条件**\n- 每个液滴的细胞数 $N$ 是一个随机变量，服从平均值为 $\\lambda$ 的泊松分布：$N \\sim \\text{Poisson}(\\lambda)$。\n- 概率质量函数（PMF）为 $P(N=k) = \\frac{\\lambda^k e^{-\\lambda}}{k!}$，其中 $k$ 为非负整数。\n- “液滴占有率”定义为 $O = P(N \\ge 1)$。\n- “含细胞液滴中的多重体比例”定义为 $M = P(N \\ge 2 \\mid N \\ge 1)$。\n- 第1部分：进行一次实验，液滴占有率为 $O_1 = 0.10$。\n- 第2部分：使用新的加载参数 $\\lambda_2 = 0.05$ 重复实验。\n- 第3部分：任务是计算多重体比例的倍数变化 $F = \\frac{M_2}{M_1}$，并四舍五入到四位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n对问题进行验证。\n- **科学依据：** 使用泊松分布来模拟细胞加载到液滴中的过程，是分析基于液滴的单细胞测序数据时的一个标准和基本假设。该模型在科学上已得到充分证实，并在该领域常规使用。\n- **适定性：** 问题为所有量提供了精确、无歧义的定义。问题在数学上是可解的，并能导出一个唯一的数值解。所提供的数据（$O_1=0.10$, $\\lambda_2=0.05$）在实验背景下是符合实际的。\n- **客观性：** 问题以客观、正式的语言陈述，不含任何主观或推测性内容。\n\n**步骤3：结论与行动**\n该问题科学合理、适定且客观。它是有效的。将提供解答。\n\n**通用表达式的推导**\n\n多重体比例 $M$ 是一个条件概率：\n$$M = P(N \\ge 2 \\mid N \\ge 1)$$\n根据条件概率的定义，$P(A \\mid B) = \\frac{P(A \\cap B)}{P(B)}$，我们有：\n$$M = \\frac{P((N \\ge 2) \\cap (N \\ge 1))}{P(N \\ge 1)}$$\n事件 $(N \\ge 2) \\cap (N \\ge 1)$ 与事件 $(N \\ge 2)$ 相同。因此，表达式简化为：\n$$M = \\frac{P(N \\ge 2)}{P(N \\ge 1)}$$\n我们现在使用泊松概率质量函数来表示分子和分母。一个液滴含有零个细胞（$k=0$）的概率是：\n$$P(N=0) = \\frac{\\lambda^0 \\exp(-\\lambda)}{0!} = \\exp(-\\lambda)$$\n一个液滴恰好含有一个细胞（$k=1$）的概率是：\n$$P(N=1) = \\frac{\\lambda^1 \\exp(-\\lambda)}{1!} = \\lambda \\exp(-\\lambda)$$\n分母 $P(N \\ge 1)$ 是含有零个细胞的互补事件：\n$$P(N \\ge 1) = 1 - P(N=0) = 1 - \\exp(-\\lambda)$$\n分子 $P(N \\ge 2)$ 是含有零个或一个细胞的互补事件：\n$$P(N \\ge 2) = 1 - P(N=0) - P(N=1) = 1 - \\exp(-\\lambda) - \\lambda \\exp(-\\lambda)$$\n将这些代入 $M$ 的表达式中：\n$$M(\\lambda) = \\frac{1 - \\exp(-\\lambda) - \\lambda \\exp(-\\lambda)}{1 - \\exp(-\\lambda)}$$\n为使分析更清晰，可以将其简化：\n$$M(\\lambda) = \\frac{(1 - \\exp(-\\lambda)) - \\lambda \\exp(-\\lambda)}{1 - \\exp(-\\lambda)} = 1 - \\frac{\\lambda \\exp(-\\lambda)}{1 - \\exp(-\\lambda)}$$\n这就是多重体比例作为加载参数 $\\lambda$ 的函数的通用表达式。\n\n**第1部分：计算原始多重体比例 ($M_1$)**\n\n给定初始液滴占有率 $O_1 = P(N \\ge 1) = 0.10$。使用占有率的公式：\n$$0.10 = 1 - \\exp(-\\lambda_1)$$\n求解 $\\exp(-\\lambda_1)$：\n$$\\exp(-\\lambda_1) = 1 - 0.10 = 0.90$$\n这意味着原始加载参数为 $\\lambda_1 = -\\ln(0.90)$。\n现在，我们使用 $M(\\lambda)$ 的通用公式，并令 $\\lambda = \\lambda_1$ 来计算原始多重体比例 $M_1$。\n$$M_1 = M(\\lambda_1) = 1 - \\frac{\\lambda_1 \\exp(-\\lambda_1)}{1 - \\exp(-\\lambda_1)}$$\n代入已知值 $\\lambda_1 = -\\ln(0.90)$, $\\exp(-\\lambda_1) = 0.90$ 和 $1 - \\exp(-\\lambda_1) = 0.10$：\n$$M_1 = 1 - \\frac{(-\\ln(0.90)) \\times 0.90}{0.10} = 1 - 9(-\\ln(0.90)) = 1 + 9\\ln(0.90)$$\n\n**第2部分：计算新的多重体比例 ($M_2$)**\n\n加载参数被减小到一个新值 $\\lambda_2 = 0.05$。我们将 $\\lambda_2$ 代入通用公式来计算新的多重体比例 $M_2$：\n$$M_2 = M(0.05) = 1 - \\frac{0.05 \\exp(-0.05)}{1 - \\exp(-0.05)}$$\n\n**第3部分：计算倍数变化**\n\n倍数变化 $F$ 是新的多重体比例与原始多重体比例的比值：\n$$F = \\frac{M_2}{M_1} = \\frac{1 - \\frac{0.05 \\exp(-0.05)}{1 - \\exp(-0.05)}}{1 + 9\\ln(0.90)}$$\n我们现在必须计算其数值。\n首先，我们计算 $M_1$：\n$$M_1 = 1 + 9 \\ln(0.90) \\approx 1 + 9(-0.10536051565) = 1 - 0.94824464085 = 0.05175535915$$\n接下来，我们计算 $M_2$：\n$$\\exp(-0.05) \\approx 0.9512294245$$\n$$1 - \\exp(-0.05) \\approx 0.0487705755$$\n$$M_2 = 1 - \\frac{0.05 \\times 0.9512294245}{0.0487705755} = 1 - \\frac{0.047561471225}{0.0487705755} \\approx 1 - 0.975207387 = 0.024792613$$\n最后，我们计算倍数变化 $F$：\n$$F = \\frac{M_2}{M_1} \\approx \\frac{0.024792613}{0.05175535915} \\approx 0.47903874$$\n根据题目要求，四舍五入到四位有效数字，得到 $0.4790$。", "answer": "$$\\boxed{0.4790}$$", "id": "2837411"}, {"introduction": "单细胞原始计数数据必须经过归一化以消除技术差异，而对数转换是一种常见方法。然而，这种看似简单的方法可能会引入系统性偏差，尤其对于低表达量的基因，会压缩其真实的表达差异倍数。本练习 [@problem_id:2837391] 旨在引导您批判性地审视标准的数据处理流程，并理解为何流行的 $\\log(1+x)$ 转换会产生偏差，同时探索更具统计学原理的替代方案。", "problem": "一个带有唯一分子标识符 (UMI) 计数的单细胞核糖核酸测序（single-cell ribonucleic acid sequencing）计数矩阵，其中细胞 $i$ 中基因 $g$ 的计数表示为 $x_{gi}$。一种常见的基于大小因子的对数归一化定义为\n$$\ny_{gi} \\;=\\; \\log_{2}\\!\\Big(1 \\;+\\; s_i\\,x_{gi}\\Big),\\quad s_i \\;=\\; \\dfrac{10^{4}}{\\sum_{g} x_{gi}},\n$$\n该方法通过每个细胞的大小因子 $s_i$ 来重新缩放计数，并应用一个伪计数为 $1$、以 $2$ 为底的对数。假设一个计数生成模型，其中 $x_{gi}$ 是从均值为 $\\mu_{gi}$、基因特异性离散度为 $\\alpha_g$ 的负二项 (NB) 分布中抽取的样本，因此 $\\operatorname{Var}(x_{gi}\\mid \\mu_{gi},\\alpha_g)=\\mu_{gi}+\\alpha_g \\mu_{gi}^{2}$。考虑一个在两个匹配条件 $A$ 和 $B$ 下测量的基因 $g$，其每个细胞的大小因子是受控的（即文库大小相当），组均值分别为 $\\mu_{gA}$ 和 $\\mu_{gB}$，倍数变化为 $F=\\mu_{gB}/\\mu_{gA}$。利用以下核心事实：(i) 上述负二项方差定律适用，(ii) 对于 $s>0$，函数 $f(x)=\\log_{2}(1+s x)$ 是光滑且单调递增的，以及 (iii) 泰勒展开和delta方法可以近似随机变量在其均值附近的光滑函数的偏差和方差。\n\n基于这些基础，推理变换 $y_{gi}$ 如何影响低计数时对数倍数变化的估计。特别是，比较小 $\\mu_{gA}$ 和 $\\mu_{gB}$ 与大 $\\mu_{gA}$ 和 $\\mu_{gB}$ 情况下的期望差 $\\mathbb{E}[y_{gB}]-\\mathbb{E}[y_{gA}]$，并推断在低计数区间内乘法差异是被保留还是被压缩。然后，提出一种有原则的、适用于单细胞计数数据的替代方差稳定变换，该变换能解决泊松或负二项模型下的均值-方差依赖性问题。\n\n哪些选项正确地描述了这种效应并提供了有效的替代方案？选择所有适用选项。\n\nA. 对于低计数，大小归一化后的 $\\log_{2}(1+s_i x_{gi})$ 在 $x_{gi}$ 中表现出近似线性行为，因此 $y_{gi}$ 的差异反映的是绝对差异而非乘法倍数变化，从而将对数倍数变化压缩至 $0$。一个有原则的替代方案是使用来自负二项广义线性模型 (GLM) 的负二项Pearson残差 $r_{gi}=(x_{gi}-\\hat{\\mu}_{gi})/\\sqrt{\\hat{\\mu}_{gi}+\\alpha_g \\hat{\\mu}_{gi}^{2}}$，这些残差在均值范围内是近似方差稳定的。\n\nB. 伪计数 $1$ 保证了在所有表达水平上对数倍数变化的估计都是无偏的；如果仍存在残余偏差，进一步增加伪计数会减少该偏差。最简单的方差稳定变换是按基因对所有细胞的原始计数进行z-score标准化。\n\nC. 对于低计数，归一化会夸大倍数变化，因为除以 $\\sum_{g} x_{gi}$ 会放大较小的值；一个合适的补救措施是计算每百万转录本 (TPM) 并保持值不转换，这通过其构造稳定了方差。\n\nD. 对于低计数，使用 $s_i=10^{4}/\\sum_{g}x_{gi}$ 的 $\\log_{2}(1+s_i x_{gi})$ 会将对数倍数变化压缩至 $0$，因为加性项 $1$ 和较小的 $s_i x_{gi}$ 使变换近似线性。一个有原则的替代方案是在除以一个使文库大小均等化的大小因子 $c_i$ 后，应用泊松Anscombe变换 $y^{A}_{gi}=2\\sqrt{x_{gi}/c_i+3/8}$，当离散度较小时，这种变换可以近似稳定方差。", "solution": "对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n-   单细胞RNA测序计数矩阵，带有唯一分子标识符 (UMI) 计数：$x_{gi}$ 代表细胞 $i$ 中的基因 $g$。\n-   对数归一化变换：$y_{gi} = \\log_{2}(1 + s_i x_{gi})$。\n-   每个细胞的大小因子：$s_i = \\frac{10^{4}}{\\sum_{g} x_{gi}}$。\n-   计数生成模型：$x_{gi}$ 从负二项 (NB) 分布中抽取。\n-   NB分布的均值：$\\mu_{gi}$。\n-   基因特异性离散度参数：$\\alpha_g$。\n-   NB分布的方差：$\\operatorname{Var}(x_{gi}\\mid \\mu_{gi},\\alpha_g)=\\mu_{gi}+\\alpha_g \\mu_{gi}^{2}$。\n-   实验设置：两个条件 $A$ 和 $B$，具有受控（可比）的大小因子。\n-   组均值：$\\mu_{gA}$ 和 $\\mu_{gB}$。\n-   倍数变化：$F=\\mu_{gB}/\\mu_{gA}$。\n-   陈述的事实/工具：\n    1.  NB方差定律成立。\n    2.  对于 $s>0$，函数 $f(x)=\\log_{2}(1+s x)$ 是光滑且单调递增的。\n    3.  泰勒展开和delta方法适用。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题描述了计算生物学中分析单细胞转录组数据的标准场景。其组成部分在科学上是严谨的：\n-   **科学依据**：使用UMI计数、大小因子归一化和负二项分布来对此类数据建模是现代单细胞生物信息学的基石。方差结构 $\\mu + \\alpha\\mu^2$ 是NB2族的规范形式。该问题探讨了一个基本且众所周知的问题：数据变换对下游统计推断的影响，特别是对倍数变化估计的影响。\n-   **适定性**：该问题定义清晰。它明确了数据、模型、变换和分析任务。假设“受控的大小因子”是一个合理的简化，它允许在不受文库大小变化的混杂效应影响的情况下，集中分析变换的性质，并将 $s_i$ 视为一个代表性常数 $s$ 进行比较。\n-   **客观性**：该问题以精确的数学术语陈述，并要求基于已建立的统计学原理进行合理的推导和评估。它没有主观或模糊的语言。\n\n该问题的所有方面都与已建立的统计学和分子生物学原理一致。该问题是可形式化的且非平凡的。\n\n**步骤3：结论与行动**\n问题陈述有效。可以推导出严谨的解决方案。\n\n### 解答推导\n\n该问题要求分析归一化函数 $y_{gi} = \\log_{2}(1 + s_i x_{gi})$ 并提出一个有原则的替代方案。为简单起见，鉴于大小因子受控的条件，我们考虑一个恒定的代表性大小因子 $s$。\n\n**第1部分：对数变换分析**\n\n变换为 $f(x) = \\log_2(1+sx)$。我们使用 $\\log_2(1+z)$ 的泰勒级数展开（其中 $z=sx$）在两个区间内分析其行为。其展开式为 $\\log_2(1+z) = \\frac{1}{\\ln 2}\\left(z - \\frac{z^2}{2} + O(z^3)\\right)$。\n\n1.  **低计数区间 (小 $\\mu_{gi}$)**：\n    当期望计数 $\\mu_{gi}$ 较低时，乘积 $s x_{gi}$ 也预期较小。该变换可以用其一阶泰勒展开项来近似：\n    $$y_{gi} = \\log_2(1+s x_{gi}) \\approx \\frac{s}{\\ln 2} x_{gi}$$\n    在此区间内，变换在计数 $x_{gi}$ 上是近似线性的。条件 $B$ 和 $A$ 之间的期望差为：\n    $$\\mathbb{E}[y_{gB}] - \\mathbb{E}[y_{gA}] \\approx \\mathbb{E}\\left[\\frac{s}{\\ln 2} x_{gB}\\right] - \\mathbb{E}\\left[\\frac{s}{\\ln 2} x_{gA}\\right] = \\frac{s}{\\ln 2}(\\mu_{gB} - \\mu_{gA})$$\n    这个量与均值的*绝对*差异成正比，而不是与它们的比率成正比。真实的对数倍数变化是 $\\log_2(F) = \\log_2(\\mu_{gB}/\\mu_{gA})$。在线性区间内，该变换未能将数据置于对数尺度上。因此，对于一个固定的倍数变化 $F$，比较两个较小的均值（例如 $\\mu_{gA}=0.1, \\mu_{gB}=0.5, F=5$）所得到的变换后值的差异，将远小于比较两个较大的均值（例如 $\\mu_{gA}=10, \\mu_{gB}=50, F=5$）时的差异。这种效应被称为对数倍数变化向 $0$ 的**压缩**或收缩。\n\n2.  **高计数区间 (大 $\\mu_{gi}$)**：\n    当 $\\mu_{gi}$ 较大时，$s x_{gi} \\gg 1$。该变换可以近似为：\n    $$y_{gi} = \\log_2(1+s x_{gi}) \\approx \\log_2(s x_{gi}) = \\log_2(s) + \\log_2(x_{gi})$$\n    在这里，变换是对数的。期望差近似为：\n    $$\\mathbb{E}[y_{gB}] - \\mathbb{E}[y_{gA}] \\approx \\mathbb{E}[\\log_2(x_{gB})] - \\mathbb{E}[\\log_2(x_{gA})]$$\n    使用一阶近似 $\\mathbb{E}[\\log_2(x_g)] \\approx \\log_2(\\mu_g)$，我们得到：\n    $$\\mathbb{E}[y_{gB}] - \\mathbb{E}[y_{gA}] \\approx \\log_2(\\mu_{gB}) - \\log_2(\\mu_{gA}) = \\log_2(\\mu_{gB}/\\mu_{gA}) = \\log_2(F)$$\n    在高计数区间，该变换能正确估计真实的对数倍数变化。\n\n结论是，$\\log_2(1+sx)$ 变换在对数倍数变化估计中引入了依赖于均值的偏差，压缩了低表达基因的估计值。\n\n**第2部分：替代的方差稳定变换 (VSTs)**\n\nVST 是一个函数 $h(x)$，使得 $\\operatorname{Var}(h(x))$ 近似独立于均值 $\\mathbb{E}[x]$。使用delta方法，变换后变量的方差为 $\\operatorname{Var}(h(x)) \\approx [h'(\\mathbb{E}[x])]^2 \\operatorname{Var}(x)$。为了使方差为常数 $C$，我们需要 $h'(\\mu) \\propto 1/\\sqrt{\\operatorname{Var}(x|\\mu)}$。\n\n问题陈述 $\\operatorname{Var}(x_{gi}) = \\mu_{gi} + \\alpha_g \\mu_{gi}^2$。因此，一个VST应具有形式 $h(\\mu) = \\int \\frac{d\\mu}{\\sqrt{\\mu + \\alpha_g \\mu^2}}$。这个积分不会得到一个简单的初等函数，这促使我们寻找有原则的替代方案。\n\n1.  **基于泊松的VST**：如果过度离散程度低（$\\alpha_g \\to 0$），NB分布会趋近于泊松分布，对于泊松分布，$\\operatorname{Var}(x_{gi}) = \\mu_{gi}$。VST积分变为 $h(\\mu) = \\int \\mu^{-1/2} d\\mu = 2\\sqrt{\\mu}$。这证明了平方根变换的合理性。**Anscombe变换** $y^A_{gi} = 2\\sqrt{x_{gi}+3/8}$ 是一个精炼版本，它改善了小均值下的方差稳定性。当应用于大小归一化后的计数 $x_{gi}/c_i$ 时，变换变为 $2\\sqrt{x_{gi}/c_i+3/8}$。这是对泊松或低离散度NB数据的有效VST。\n\n2.  **基于NB的残差**：变换数据的另一种方法是使用模型残差。**Pearson残差**定义为 $r_{gi} = \\frac{x_{gi}-\\hat{\\mu}_{gi}}{\\sqrt{\\operatorname{Var}(x_{gi}|\\hat{\\mu}_{gi})}}$。对于给定的NB模型，这变为：\n    $$r_{gi} = \\frac{x_{gi}-\\hat{\\mu}_{gi}}{\\sqrt{\\hat{\\mu}_{gi}+\\hat{\\alpha}_g \\hat{\\mu}_{gi}^{2}}}$$\n    其中 $\\hat{\\mu}_{gi}$ 和 $\\hat{\\alpha}_g$ 是从一个模型（例如，负二项广义线性模型）中估计出来的。根据其构造，这些残差是近似方差稳定的，其 $\\mathbb{E}[r_{gi}] \\approx 0$ 且 $\\operatorname{Var}(r_{gi}) \\approx 1$，而与均值 $\\mu_{gi}$ 无关。这是scRNA-seq分析中一种现代且稳健的方法。\n\n### 逐项分析\n\n**A. 对对数变换效应的描述是正确的，如推导的第1部分所示。低计数时的线性导致LFC压缩。所提出的替代方案，即NB Pearson残差，是一种有原则且有效的方法，用于方差稳定，它直接使用了问题中提供的方差结构。公式是正确的。**\n\n- 对对数变换效应的描述是正确的，如推导的第1部分所示。低计数时的线性导致LFC（对数倍数变化）压缩。\n- 所提出的替代方案，即NB Pearson残差，是一种有原则且有效的方差稳定方法，它直接使用了问题中提供的方差结构。公式是正确的。\n- **结论：正确。**\n\n**B. 声称伪计数能保证无偏估计的说法是错误的。它正是低计数时偏差（LFC压缩）的来源。增加伪计数会加剧在更宽的低至中表达水平范围内的压缩，而不是减少偏差。对原始计数进行Z-score标准化是一种标准化方法，而不是正式意义上的VST。它没有恰当考虑计数数据固有的均值-方差关系。它仅仅是强制给定基因的值的方差为1，而这不是目标。**\n\n- 声称伪计数能保证无偏估计的说法是错误的。它正是低计数时偏差（LFC压缩）的来源。\n- 增加伪计数会加剧在更宽的低至中表达水平范围内的压缩，而不是减少偏差。\n- 对原始计数进行Z-score标准化是一种标准化方法，而不是正式意义上的VST。它没有恰当考虑计数数据固有的均值-方差关系。它仅仅是强制给定基因的值的方差为1，而这不是目标。\n- **结论：不正确。**\n\n**C. 声称归一化“夸大倍数变化”的说法是不正确的。如推导所示，$\\log(1+x)$ 型变换会*压缩*倍数变化。TPM是另一种形式的文库大小归一化，与给定的方法在根本上是相似的。它不能解决这个问题。保持TPM值不作变换是不正确的。TPM值是缩放后的计数，其方差仍然强烈依赖于其均值。它们不是方差稳定的。**\n\n- 声称归一化“夸大倍数变化”的说法是不正确的。如推导所示，$\\log(1+x)$ 型变换会*压缩*倍数变化。\n- TPM是另一种形式的文库大小归一化，与给定的方法在根本上是相似的。它不能解决这个问题。\n- 保持TPM值不作变换是不正确的。TPM值是缩放后的计数，其方差仍然强烈依赖于其均值。它们不是方差稳定的。\n- **结论：不正确。**\n\n**D. 对对数变换效应的描述是正确的，与我们的推导相符。对于较小的 $s_i x_{gi}$ 值，其线性是LFC压缩的根本原因。所提出的替代方案，即Anscombe变换，是对泊松数据的有效且有原则的VST。提供的公式是正确的。“当离散度较小时”这个限定条件正确地指出了在这种情况下，这种基于泊松的VST是NB分布数据的一个合理近似。**\n\n- 对对数变换效应的描述是正确的，与我们的推导相符。对于较小的 $s_i x_{gi}$ 值，其线性是LFC压缩的根本原因。\n- 所提出的替代方案，即Anscombe变换，是对泊松数据的有效且有原则的VST。提供的公式是正确的。\n- “当离散度较小时”这个限定条件正确地指出了在这种情况下，这种基于泊सों的VST是NB分布数据的一个合理近似。\n- **结论：正确。**\n\n选项A和D都对标准对数归一化的问题进行了正确的分析，并提出了一个有效且有原则的方差稳定替代方法。", "answer": "$$\\boxed{AD}$$", "id": "2837391"}, {"introduction": "在单细胞和空间组学研究中，我们通常需要同时对成千上万个基因进行假设检验。如果不进行多重检验校正，仅凭随机性就可能产生大量的假阳性结果，从而误导我们的生物学结论。本练习 [@problem_id:2837373] 将指导您应用Benjamini-Hochberg（BH）方法来控制假发现率（FDR），这是组学数据分析中一项不可或缺的统计技能，以确保我们发现的显著基因列表的可靠性。", "problem": "一项空间分辨单细胞核糖核酸测序 (scRNA-seq) 实验分析了整个组织切片的基因表达谱，并使用一个一致的统计模型检验每个基因在不同空间域中的差异表达，该模型在原假设下产生有效的原始p值（即，零p值是独立同分布于 $\\left[0,1\\right]$ 上的均匀分布）。假设测试了 $n = 10{,}000$ 个基因，产生了一系列原始p值，将其按升序排列后满足 $p_{(1)} \\leq p_{(2)} \\leq \\dots \\leq p_{(n)}$。您将使用 Benjamini–Hochberg (BH) 程序来控制错误发现率 (FDR)，其中错误发现率 (FDR) 定义为所有发现中假阳性所占的期望比例。在此背景下，BH校正值（通常称为q值）是每个基因被判为显著的最小FDR水平。\n\n假设前六个有序的原始p值为：\n- $p_{(1)} = 1.2 \\times 10^{-6}$,\n- $p_{(2)} = 2.0 \\times 10^{-6}$,\n- $p_{(3)} = 4.9 \\times 10^{-6}$,\n- $p_{(4)} = 7.5 \\times 10^{-6}$,\n- $p_{(5)} = 1.0 \\times 10^{-4}$,\n- $p_{(6)} = 1.5 \\times 10^{-3}$。\n\n进一步假设，对于所有 $j \\geq 7$，剩余的原始p值满足 $p_{(j)} \\geq 0.05$ 且随 $j$ 非递减。\n\n从FDR控制的定义和Benjamini–Hochberg程序的“步升”性质出发（不预先假设任何闭式校正形式），推导排名为 $i$ 的基因的BH校正值的表达式，用有序原始p值和 $n$ 表示，并解释为何以及如何应用单调性（“步降”）校正以获得有效的校正值。然后，在上述假设下，计算原始p值为 $p_{(3)} = 4.9 \\times 10^{-6}$ 的基因的BH校正值（q值）。\n\n将最终答案四舍五入到 $4$ 位有效数字。将答案表示为无单位的小数比例。", "solution": "该问题要求从一组空间分辨单细胞RNA测序数据中，推导Benjamini-Hochberg (BH) 校正p值（q值），并为一个特定基因计算该值。\n\n首先，对问题进行验证。\n已知条件：\n- 进行了一组 $n = 10,000$ 次的假设检验。\n- 零p值是独立同分布于 $[0, 1]$ 上的均匀分布。\n- 原始p值按升序排列：$p_{(1)} \\leq p_{(2)} \\leq \\dots \\leq p_{(n)}$。\n- 前六个有序p值为 $p_{(1)} = 1.2 \\times 10^{-6}$，$p_{(2)} = 2.0 \\times 10^{-6}$，$p_{(3)} = 4.9 \\times 10^{-6}$，$p_{(4)} = 7.5 \\times 10^{-6}$，$p_{(5)} = 1.0 \\times 10^{-4}$，以及 $p_{(6)} = 1.5 \\times 10^{-3}$。\n- 对于所有排名 $j \\geq 7$，原始p值满足 $p_{(j)} \\geq 0.05$。\n- 使用BH程序控制错误发现率 (FDR)。\n- BH校正值（q值）定义为基因被判为显著的最小FDR水平。\n\n验证结论：\n该问题具有科学依据，提法明确，且客观。它描述了生物信息学中一个标准且重要的统计程序。所有必要的数据和定义都已提供，没有矛盾或含糊不清之处。因此，该问题被认定为 **有效**。\n\nBH校正值（q值）的推导：\nBenjamini-Hochberg程序在选定的水平 $\\alpha$ 上控制FDR。该程序如下：给定有序的原始p值 $p_{(1)}, p_{(2)}, \\dots, p_{(n)}$，找到满足 $p_{(k)} \\leq \\frac{k}{n}\\alpha$ 的最大整数 $k$。如果存在这样的 $k$，则拒绝与p值 $p_{(1)}, p_{(2)}, \\dots, p_{(k)}$ 对应的原假设。\n\n对于具有第 $i$ 个有序p值 $p_{(i)}$ 的基因，其q值定义为能够拒绝该基因的原假设 $H_{(i)}$ 的最小FDR水平 $\\alpha$。为了拒绝 $H_{(i)}$，满足BH条件的最大索引 $k$ 必须大于或等于 $i$。换句话说，必须存在某个索引 $j \\geq i$，使得条件 $p_{(j)} \\leq \\frac{j}{n}\\alpha$ 成立。\n\n这个不等式可以重新整理以求解 $\\alpha$：$\\alpha \\geq \\frac{n p_{(j)}}{j}$。\n为了拒绝 $H_{(i)}$，此条件必须对至少一个 $j \\in \\{i, i+1, \\dots, n\\}$ 成立。保证这一点的最小 $\\alpha$ 是 $\\alpha$ 的所有这些下界中的最小值。\n因此，第 $i$ 个有序p值的q值，记为 $q_{(i)}$，由以下表达式给出：\n$$q_{(i)} = \\min_{j=i, \\dots, n} \\left\\{ \\frac{n p_{(j)}}{j} \\right\\}$$\n这个值也必须以1为上限，因此更正式地，$q_{(i)} = \\min_{j=i, \\dots, n} \\left\\{ \\min\\left(1, \\frac{n p_{(j)}}{j}\\right) \\right\\}$。\n\n单调性校正的解释：\n根据定义，原始的排序p值是非递减的：$p_{(1)} \\leq p_{(2)} \\leq \\dots \\leq p_{(n)}$。校正后的p值也应具有非递减的理想属性，即 $q_{(1)} \\leq q_{(2)} \\leq \\dots \\leq q_{(n)}$。一个具有更显著（更小）原始p值的基因，不应得到一个更不显著（更大）的校正p值。\n\n如果简单地将排名为 $i$ 的校正p值定义为 $\\frac{n p_{(i)}}{i}$，则无法保证这种单调性，因为比率 $\\frac{p_{(i)}}{i}$ 不一定是非递减的。上面推导的表达式 $q_{(i)} = \\min_{j=i, \\dots, n} \\{ \\frac{n p_{(j)}}{j} \\}$ 强制实现了这种单调性。这可以通过观察 $q_{(i)}$ 和 $q_{(i+1)}$ 之间的关系看出：\n$$q_{(i)} = \\min\\left( \\frac{n p_{(i)}}{i}, \\min_{j=i+1, \\dots, n} \\left\\{ \\frac{n p_{(j)}}{j} \\right\\} \\right) = \\min\\left( \\frac{n p_{(i)}}{i}, q_{(i+1)} \\right)$$\n由此可见，对于所有 $i=1, \\dots, n-1$，$q_{(i)} \\leq q_{(i+1)}$。\n\n校正的“步降”性质指的是计算这些q值的一种高效算法。从最大排名 $i=n$ 开始，向下进行到 $i=1$：\n1. 设置 $q_{(n)} = \\frac{n p_{(n)}}{n} = p_{(n)}$。\n2. 对于 $i = n-1, n-2, \\dots, 1$，计算 $q_{(i)} = \\min\\left(q_{(i+1)}, \\frac{n p_{(i)}}{i}\\right)$。\n这种递归计算等价于前面推导的闭式表达式，并确保得到的q值序列 $\\{q_{(i)}\\}$ 是单调非递减的。“校正”是指取其与先前计算的（且更宽松的）q值 $q_{(i+1)}$ 的最小值，这可以防止 $q_{(i)}$ 变得比 $q_{(i+1)}$ 更大。\n\n计算 $p_{(3)}$ 的q值：\n我们需要使用推导出的公式计算 $q_{(3)}$：\n$$q_{(3)} = \\min_{k=3, \\dots, 10000} \\left\\{ \\frac{10000 \\cdot p_{(k)}}{k} \\right\\}$$\n让我们计算序列 $\\frac{n p_{(k)}}{k}$ 的前几项：\n当 $k=3$ 时：\n$$\\frac{10000 \\cdot p_{(3)}}{3} = \\frac{10000 \\cdot (4.9 \\times 10^{-6})}{3} = \\frac{0.049}{3} \\approx 0.016333...$$\n当 $k=4$ 时：\n$$\\frac{10000 \\cdot p_{(4)}}{4} = \\frac{10000 \\cdot (7.5 \\times 10^{-6})}{4} = \\frac{0.075}{4} = 0.01875$$\n当 $k=5$ 时：\n$$\\frac{10000 \\cdot p_{(5)}}{5} = \\frac{10000 \\cdot (1.0 \\times 10^{-4})}{5} = \\frac{1}{5} = 0.2$$\n当 $k=6$ 时：\n$$\\frac{10000 \\cdot p_{(6)}}{6} = \\frac{10000 \\cdot (1.5 \\times 10^{-3})}{6} = \\frac{15}{6} = 2.5$$\n对于任何 $k \\geq 7$，我们已知 $p_{(k)} \\geq 0.05$。因此，序列中的相应项有如下界：\n$$\\frac{10000 \\cdot p_{(k)}}{k} \\geq \\frac{10000 \\cdot 0.05}{k} = \\frac{500}{k}$$\n这个下界的最小可能值出现在最大的 $k$（即 $k=10000$）时，为 $\\frac{500}{10000} = 0.05$。即使对于该范围内的最小索引 $k=7$，下界也是 $\\frac{500}{7} \\approx 71.4$。在任何情况下，对于所有 $k \\geq 7$，项 $\\frac{n p_{(k)}}{k}$ 都大于或等于 $0.05$。\n\n我们寻求集合：\n$$\\{0.016333..., 0.01875, 0.2, 2.5, \\text{以及所有 } k \\geq 7 \\text{ 的项}\\}$$\n的最小值。\n由于所有 $k \\geq 7$ 的项都至少为 $0.05$，它们都比 $k=3$ 时的项大。因此，整个集合的最小值是为 $k=3$ 计算出的值。\n$$q_{(3)} = \\frac{0.049}{3} \\approx 0.016333...$$\n将此结果四舍五入到 $4$ 位有效数字，得到 $0.01633$。", "answer": "$$\\boxed{0.01633}$$", "id": "2837373"}]}