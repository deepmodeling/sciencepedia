{"hands_on_practices": [{"introduction": "系统发育比较方法的一个根本性挑战是，由于物种共享进化历史，它们并非统计上的独立样本。由Joe Felsenstein开创的系统发育独立比较法（Phylogenetic Independent Contrasts, PIC）是第一个严谨解决此问题的方法，它通过一个进化模型来转换性状数据。这个练习[@problem_id:2823608]将引导你从第一性原理出发，在布朗运动模型下推导独立比较，帮助你理解如何将树尖上相互关联的性状值转化为一组统计独立的变量。", "problem": "考虑一个包含 $3$ 个分类单元 $A$、$B$ 和 $C$ 的有根超度量系统发育树。设节点 $1$ 是 $A$ 和 $B$ 的最近共同祖先，节点 $2$ 是根节点。分支长度如下：从节点 $1$ 到 $A$ 的长度为 $t$，从节点 $1$ 到 $B$ 的长度为 $t$，从节点 $2$ 到节点 $1$ 的长度为 $s$，从节点 $2$ 到 $C$ 的长度为 $s + t$，因此每条从根到叶的路径总长度为 $s + t$。一个连续性状沿着该树根据布朗运动（BM）模型演化，其速率参数为每单位分支长度 $\\sigma^{2}$：在任何长度为 $b$ 的分支上，性状值的增量是一个均值为零、方差为 $\\sigma^{2} b$ 的正态随机变量，且在不相交分支上的增量是独立的。\n\n你观测到叶节点的性状值，记为 $X_{A}$、$X_{B}$ 和 $X_{C}$。仅使用上述布朗运动模型的假设，以及对于方差已知的独立正态观测，其共同均值的最小方差无偏线性估计量是方差倒数加权平均这一事实，完成以下任务：\n\n$1.$ 推导节点 $1$ 处祖先状态的最小方差无偏线性估计量 $\\hat{X}_{1}$（用 $X_{A}$ 和 $X_{B}$ 表示），并计算其估计方差 $\\operatorname{Var}(\\hat{X}_{1} \\mid X_{1})$。\n\n$2.$ 将 $\\hat{X}_{1}$ 及其在第1部分中得到的估计方差，视为通向节点 $1$ 谱系上的一个观测值。使用 $\\hat{X}_{1}$ 和 $X_{C}$，推导节点 $2$ 处状态的最小方差无偏线性估计量 $\\hat{X}_{2}$ 及其估计方差 $\\operatorname{Var}(\\hat{X}_{2} \\mid X_{2})$。\n\n$3.$ 定义两个系统发育独立比较（PIC）：节点 $1$ 处的后代比较 $U_{1} = \\dfrac{X_{A} - X_{B}}{\\sqrt{V_{1}}}$，和节点 $2$ 处的根节点比较 $U_{2} = \\dfrac{\\hat{X}_{1} - X_{C}}{\\sqrt{V_{2}}}$，其中 $V_{1}$ 和 $V_{2}$ 是适当的分母，其值等于相应分子的总方差（以分支长度为单位表示，即 $V_{1}$ 或 $V_{2}$ 中不包含因子 $\\sigma^{2}$）。利用布朗运动模型以及你在第1和第2部分得到的结果，从基本原理推导 $V_{1}$ 和 $V_{2}$。\n\n$4.$ 在布朗运动模型下，计算 $\\operatorname{Var}(U_{1})$ 和 $\\operatorname{Var}(U_{2})$，并证明它们相等且不依赖于 $s$ 或 $t$。\n\n给出 $\\operatorname{Var}(U_{1})$ 和 $\\operatorname{Var}(U_{2})$ 的共同值作为最终答案，该答案应为以 $\\sigma^{2}$ 表示的单个闭式表达式。不包含任何单位。无需进行数值四舍五入。", "solution": "该问题陈述具有科学依据，内部一致且良定。它是在系统发育比较方法领域中一个标准的（尽管是简化的）练习，具体涉及祖先状态重建和在布朗运动模型下推导系统发育独立比较。所有必要的参数和条件都已提供，以获得唯一的数学解。我们将按要求进行推导，依次解决这四个部分。\n\n在布朗运动（BM）模型下，沿长度为 $b$ 的分支的性状值变化是一个从均值为 $0$、方差为 $\\sigma^2 b$ 的正态分布中抽取的随机变量。不相交分支上的变化是独立的。设 $X_i$ 表示节点或叶节点 $i$ 处的性状值。\n\n第1部分：节点1处状态的估计量 $\\hat{X}_{1}$ 及其方差的推导。\n节点 $1$ 是叶节点 $A$ 和 $B$ 的共同祖先。从节点 $1$ 到 $A$ 和从节点 $1$ 到 $B$ 的分支是不相交的，每个分支的长度都为 $t$。因此，在给定节点 $1$ 状态 $X_{1}$ 的条件下，叶节点处的性状值是独立的、服从正态分布的随机变量：\n$$X_{A} \\mid X_{1} \\sim N(X_{1}, \\sigma^{2} t)$$\n$$X_{B} \\mid X_{1} \\sim N(X_{1}, \\sigma^{2} t)$$\n我们已知，对于独立的、服从正态分布的观测，共同均值的最小方差无偏线性估计量（MVUE）是方差倒数加权平均。观测值 $X_{A}$ 和 $X_{B}$ 的方差（在均值 $X_{1}$ 的条件下）为 $v_A = \\sigma^2 t$ 和 $v_B = \\sigma^2 t$。相应的权重为 $w_A = 1/v_A = 1/(\\sigma^2 t)$ 和 $w_B = 1/v_B = 1/(\\sigma^2 t)$。\n因此，估计量 $\\hat{X}_{1}$ 为：\n$$\\hat{X}_{1} = \\frac{w_{A} X_{A} + w_{B} X_{B}}{w_{A} + w_{B}} = \\frac{\\frac{1}{\\sigma^{2} t} X_{A} + \\frac{1}{\\sigma^{2} t} X_{B}}{\\frac{1}{\\sigma^{2} t} + \\frac{1}{\\sigma^{2} t}} = \\frac{X_{A} + X_{B}}{2}$$\n估计方差 $\\operatorname{Var}(\\hat{X}_{1} \\mid X_{1})$ 是该估计量在真值 $X_{1}$ 条件下的方差。它由公式 $1/\\sum w_i$ 给出。\n$$\\operatorname{Var}(\\hat{X}_{1} \\mid X_{1}) = \\frac{1}{w_{A} + w_{B}} = \\frac{1}{\\frac{1}{\\sigma^{2} t} + \\frac{1}{\\sigma^{2} t}} = \\frac{1}{2/(\\sigma^{2} t)} = \\frac{\\sigma^{2} t}{2}$$\n\n第2部分：根节点（节点2）处状态的估计量 $\\hat{X}_{2}$ 及其方差的推导。\n我们使用叶节点观测值 $X_{C}$ 和估计的状态 $\\hat{X}_{1}$ 来估计根节点状态 $X_{2}$。这两条信息是独立的，因为它们是从根节点沿着不相交的路径演化而来的。我们必须确定它们在 $X_2$ 条件下各自的方差。\n对于叶节点 $C$，从根节点到它的分支长度为 $s+t$。因此，$X_{C}$ 在 $X_{2}$ 条件下的方差为：\n$$\\operatorname{Var}(X_{C} \\mid X_{2}) = \\sigma^{2} (s+t)$$\n对于估计状态 $\\hat{X}_{1}$，我们必须同时考虑从根节点到节点 $1$ 的演化方差（分支长度 $s$）和 $\\hat{X}_{1}$ 相对于 $X_{1}$ 的估计方差（来自第1部分）。$\\hat{X}_{1}$ 作为 $X_{2}$ 的一个观测值，其总有效方差是这些方差之和，因为它们源于独立的过程：\n$$\\operatorname{Var}(\\hat{X}_{1} \\mid X_{2}) = \\operatorname{Var}((\\hat{X}_{1} - X_{1}) + (X_{1} - X_{2}) \\mid X_{2}) = \\operatorname{Var}(\\hat{X}_{1} - X_{1}) + \\operatorname{Var}(X_{1} - X_{2})$$\n$$ \\operatorname{Var}(\\hat{X}_{1} \\mid X_{2}) = \\operatorname{Var}(\\hat{X}_{1} \\mid X_{1}) + \\sigma^{2} s = \\frac{\\sigma^{2} t}{2} + \\sigma^{2} s = \\sigma^{2} \\left(s + \\frac{t}{2}\\right) $$\n现在，我们通过对 $\\hat{X}_{1}$ 和 $X_{C}$ 进行方差倒数加权平均来找到最小方差无偏估计量 $\\hat{X}_{2}$。权重为 $w_{\\hat{X}_1} = 1/(\\sigma^2(s + t/2))$ 和 $w_{X_C} = 1/(\\sigma^2(s+t))$。\n$$\\hat{X}_{2} = \\frac{w_{\\hat{X}_1} \\hat{X}_{1} + w_{X_C} X_{C}}{w_{\\hat{X}_1} + w_{X_C}} = \\frac{\\frac{\\hat{X}_{1}}{\\sigma^{2} (s + t/2)} + \\frac{X_{C}}{\\sigma^{2}(s+t)}}{\\frac{1}{\\sigma^{2} (s + t/2)} + \\frac{1}{\\sigma^{2}(s+t)}} = \\frac{\\frac{\\hat{X}_{1}}{s + t/2} + \\frac{X_{C}}{s+t}}{\\frac{1}{s + t/2} + \\frac{1}{s+t}}$$\n估计方差 $\\operatorname{Var}(\\hat{X}_{2} \\mid X_{2})$ 为：\n$$\\operatorname{Var}(\\hat{X}_{2} \\mid X_{2}) = \\frac{1}{w_{\\hat{X}_1} + w_{X_C}} = \\frac{1}{\\frac{1}{\\sigma^{2}(s+t/2)} + \\frac{1}{\\sigma^{2}(s+t)}} = \\sigma^{2} \\frac{(s+t/2)(s+t)}{s+t+s+t/2} = \\sigma^{2} \\frac{(s+t/2)(s+t)}{2s + 3t/2}$$\n\n第3部分：方差分母 $V_{1}$ 和 $V_{2}$ 的推导。\n项 $V_1$ 的定义使得 $\\sigma^2 V_1 = \\operatorname{Var}(X_A - X_B)$。差值 $X_A - X_B$ 可以用从节点 $1$ 出发的各分支上的独立演化变化 $\\epsilon_A \\sim N(0, \\sigma^2 t)$ 和 $\\epsilon_B \\sim N(0, \\sigma^2 t)$ 来表示：\n$$X_A - X_B = (X_1 + \\epsilon_A) - (X_1 + \\epsilon_B) = \\epsilon_A - \\epsilon_B$$\n其方差为：\n$$\\operatorname{Var}(X_A - X_B) = \\operatorname{Var}(\\epsilon_A) + \\operatorname{Var}(\\epsilon_B) = \\sigma^2 t + \\sigma^2 t = 2\\sigma^2 t$$\n根据定义，$\\sigma^2 V_1 = 2\\sigma^2 t$，可得：\n$$V_1 = 2t$$\n项 $V_2$ 的定义使得 $\\sigma^2 V_2 = \\operatorname{Var}(\\hat{X}_1 - X_C)$。这是我们用来估计 $X_2$ 的两个独立观测值之差的方差。两个独立随机变量之差的方差等于它们的方差之和。\n$$\\operatorname{Var}(\\hat{X}_1 - X_C) = \\operatorname{Var}((\\hat{X}_1 - X_2) - (X_C - X_2)) = \\operatorname{Var}(\\hat{X}_1 - X_2) + \\operatorname{Var}(X_C - X_2)$$\n使用在第2部分推导的条件方差：\n$$\\operatorname{Var}(\\hat{X}_1 - X_C) = \\operatorname{Var}(\\hat{X}_1 \\mid X_2) + \\operatorname{Var}(X_C \\mid X_2) = \\sigma^{2} \\left(s + \\frac{t}{2}\\right) + \\sigma^{2}(s+t)$$\n$$\\operatorname{Var}(\\hat{X}_1 - X_C) = \\sigma^{2} \\left(2s + \\frac{3t}{2}\\right)$$\n根据定义，$\\sigma^2 V_2 = \\sigma^{2} (2s + 3t/2)$，可得：\n$$V_2 = 2s + \\frac{3t}{2}$$\n\n第4部分：系统发育独立比较的方差计算。\n第一个比较是 $U_{1} = \\frac{X_{A} - X_{B}}{\\sqrt{V_{1}}}$。其方差为：\n$$\\operatorname{Var}(U_{1}) = \\operatorname{Var}\\left(\\frac{X_{A} - X_{B}}{\\sqrt{V_{1}}}\\right) = \\frac{1}{V_1} \\operatorname{Var}(X_{A} - X_{B})$$\n使用第3部分的结果，$\\operatorname{Var}(X_A - X_B) = \\sigma^2 V_1 = 2\\sigma^2 t$ 且 $V_1 = 2t$：\n$$\\operatorname{Var}(U_{1}) = \\frac{1}{2t} (2\\sigma^2 t) = \\sigma^2$$\n第二个比较是 $U_{2} = \\frac{\\hat{X}_{1} - X_{C}}{\\sqrt{V_{2}}}$。其方差为：\n$$\\operatorname{Var}(U_{2}) = \\operatorname{Var}\\left(\\frac{\\hat{X}_{1} - X_{C}}{\\sqrt{V_{2}}}\\right) = \\frac{1}{V_2} \\operatorname{Var}(\\hat{X}_{1} - X_{C})$$\n使用第3部分的结果，$\\operatorname{Var}(\\hat{X}_1 - X_C) = \\sigma^2 V_2 = \\sigma^2 (2s + 3t/2)$ 且 $V_2 = 2s + 3t/2$：\n$$\\operatorname{Var}(U_{2}) = \\frac{1}{2s + 3t/2} \\left( \\sigma^2 \\left(2s + \\frac{3t}{2}\\right) \\right) = \\sigma^2$$\n如上所示，$\\operatorname{Var}(U_{1}) = \\operatorname{Var}(U_{2}) = \\sigma^2$。标准化比较的方差彼此相等，并且都等于布朗运动模型的速率参数 $\\sigma^2$。这个值是一个不依赖于分支长度参数 $s$ 或 $t$ 的常数。这一结果是系统发育独立比较的核心属性：它们将相关的性状数据转化为一组独立同分布的变量，其方差与演化速率直接相关。", "answer": "$$\\boxed{\\sigma^{2}}$$", "id": "2823608"}, {"introduction": "虽然独立比较法为研究相关性提供了强有力的手段，但系统发育广义最小二乘法（Phylogenetic Generalized Least Squares, PGLS）框架为拟合比较数据的回归模型提供了一种更通用、更灵活的方法。PGLS利用从系统发育树和进化模型推导出的方差-协方差矩阵，将预期的系统发育非独立性直接整合到模型的误差结构中。在这个问题中[@problem_id:2823588]，你将构建这个方差-协方差矩阵，并应用完整的GLS机制来估计回归参数，从而亲身体验这一现代比较方法的基石。", "problem": "一位比较生物学家试图在一个物种集合中，估计一个定量响应和一个生态预测因子之间的关系，同时在具有 Pagel's lambda 变换的布朗运动模型下，考虑系统发育的非独立性。假设一个三物种有根超度量系统发育树的拓扑结构为 $((A{:}1,B{:}1){:}1,C{:}2)$（分支长度以时间单位计），因此每个物种的根到尖端距离为 $2$。在速率为 $\\sigma^{2}$ 的布朗运动下，物种 $i$ 和 $j$ 的系统发育协方差是 $\\sigma^{2}$ 乘以它们从根到最近共同祖先的共享路径长度，每个尖端的方差是 $\\sigma^{2}$ 乘以总的根到尖端长度。参数为 $\\lambda$ 的 Pagel's lambda 变换将所有非对角线协方差乘以 $\\lambda$，并保持对角线元素不变。设 $\\sigma^{2} = 1$ 且 $\\lambda = 1$。将物种排序为 $(A,B,C)$。\n\n- 构建三个物种的系统发育方差-协方差矩阵 $V$。\n- 考虑响应向量 $y$ 的广义最小二乘（GLS）模型，其设计矩阵为 $X$，协方差矩阵为 $V$：\n  - 设计矩阵有两列（截距和预测因子）和三行，与 $(A,B,C)$ 匹配：\n    $$\n    X \\;=\\; \\begin{pmatrix}\n    1  0 \\\\\n    1  1 \\\\\n    1  2\n    \\end{pmatrix}.\n    $$\n  - 响应向量为：\n    $$\n    y \\;=\\; \\begin{pmatrix}\n    1 \\\\\n    2 \\\\\n    3\n    \\end{pmatrix}.\n    $$\n- 在多元正态模型 $y \\sim \\mathcal{N}(X\\beta, V)$ 下，从多元正态分布的对数似然和 Pagel's lambda 变换的定义出发，推导 GLS 估计量 $\\hat{\\beta}$ 及其抽样协方差，然后计算它们对于上述指定的 $X$、$y$ 和 $V$ 的数值。\n\n将最终答案以单行矩阵的形式报告，按顺序依次列出 $\\hat{\\beta}$ 的两个元素，然后是 $2 \\times 2$ 协方差矩阵 $(X^{\\prime}V^{-1}X)^{-1}$ 按行主序排列的四个元素。给出精确值（无四舍五入）。", "solution": "必须首先对问题陈述进行严格验证。\n\n步骤1：提取已知条件。\n- 模型：具有 Pagel's lambda 变换的布朗运动。\n- 系统发育：一个三物种有根超度量树，拓扑结构为 $((A{:}1,B{:}1){:}1,C{:}2)$。\n- 分支长度以时间单位计。\n- 每个物种的根到尖端距离为 $2$。\n- 在速率为 $\\sigma^{2}$ 的布朗运动下：\n  - 物种 $i$ 和 $j$ 的系统发育协方差是 $\\sigma^{2}$ 乘以它们从根开始的共享路径长度。\n  - 每个尖端的方差是 $\\sigma^{2}$ 乘以总的根到尖端长度。\n- Pagel's lambda ($\\lambda$) 变换：将所有非对角线协方差乘以 $\\lambda$，并保持对角线元素不变。\n- 参数：$\\sigma^{2} = 1$ 和 $\\lambda = 1$。\n- 物种顺序：$(A,B,C)$。\n- 设计矩阵 $X$：\n$$\nX = \\begin{pmatrix}\n1  0 \\\\\n1  1 \\\\\n1  2\n\\end{pmatrix}\n$$\n- 响应向量 $y$：\n$$\ny = \\begin{pmatrix}\n1 \\\\\n2 \\\\\n3\n\\end{pmatrix}\n$$\n- 统计模型为 $y \\sim \\mathcal{N}(X\\beta, V)$。\n\n步骤2：使用提取的已知条件进行验证。\n该问题具有科学依据，因为它使用了系统发育比较生物学领域的标准模型（布朗运动、Pagel's lambda）和方法（广义最小二乘法）。该问题是良定的，提供了计算唯一解所需的所有数据——系统发育、模型参数、设计矩阵和响应向量。术语精确客观。没有内部矛盾；该系统发育确如所述是超度量的，A、B 和 C 的根到尖端距离分别为 $(1+1)=2$、$(1+1)=2$ 和 $2$。该问题是统计系统发育学中一个标准、可解的练习。\n\n步骤3：结论与行动。\n问题是有效的。我现在将提供一个完整的解决方案。\n\n解决方案需要三个主要部分：1) 构建系统发育方差-协方差矩阵 $V$；2) 推导 $\\beta$ 的广义最小二乘（GLS）估计量及其抽样协方差；3) 计算给定数据的数值。\n\n第1部分：构建方差-协方差矩阵 $V$。\n首先，我们构建纯布朗运动模型下的协方差矩阵，记为 $C$。物种排序为 $(A, B, C)$。元素 $C_{ij}$ 由物种 $i$ 和 $j$ 从根到最近共同祖先（MRCA）的共享进化路径长度乘以速率参数 $\\sigma^2$ 给出。对角元素 $C_{ii}$ 是从根到尖端的总路径长度乘以 $\\sigma^2$。已知 $\\sigma^2=1$。\n\n- 对于对角元素（方差）：\n  - $V_{AA} = \\text{pathlength(root, A)} \\times \\sigma^2 = (1+1) \\times 1 = 2$。\n  - $V_{BB} = \\text{pathlength(root, B)} \\times \\sigma^2 = (1+1) \\times 1 = 2$。\n  - $V_{CC} = \\text{pathlength(root, C)} \\times \\sigma^2 = 2 \\times 1 = 2$。\n\n- 对于非对角元素（协方差）：\n  - $V_{AB} = \\text{pathlength(root, MRCA(A,B))} \\times \\sigma^2 = 1 \\times 1 = 1$。\n  - $V_{AC} = \\text{pathlength(root, MRCA(A,C))} \\times \\sigma^2 = 0 \\times 1 = 0$。（最近共同祖先是根本身）。\n  - $V_{BC} = \\text{pathlength(root, MRCA(B,C))} \\times \\sigma^2 = 0 \\times 1 = 0$。\n\n根据对称性，$V_{BA}=V_{AB}$，$V_{CA}=V_{AC}$，$V_{CB}=V_{BC}$。因此，布朗运动协方差矩阵 $C$ 是：\n$$ C = \\begin{pmatrix} 2  1  0 \\\\ 1  2  0 \\\\ 0  0  2 \\end{pmatrix} $$\n接下来，我们应用 Pagel's lambda 变换得到最终矩阵 $V$。对角元素保持不变，而非对角元素乘以 $\\lambda$。问题指定 $\\lambda=1$。\n$$ V_{ii} = C_{ii} $$\n$$ V_{ij} = \\lambda C_{ij} \\quad \\text{for } i \\neq j $$\n当 $\\lambda=1$ 时，变换不会改变矩阵。因此，$V = C$。\n$$ V = \\begin{pmatrix} 2  1  0 \\\\ 1  2  0 \\\\ 0  0  2 \\end{pmatrix} $$\n\n第2部分：GLS估计量及其协方差的推导。\n模型为 $y \\sim \\mathcal{N}(X\\beta, V)$。参数向量 $\\beta$ 的对数似然函数是：\n$$ \\ell(\\beta | y, X, V) = -\\frac{n}{2}\\ln(2\\pi) - \\frac{1}{2}\\ln(\\det(V)) - \\frac{1}{2}(y - X\\beta)^{\\prime} V^{-1} (y - X\\beta) $$\n为了找到最大似然估计量 $\\hat{\\beta}$，我们必须最大化 $\\ell(\\beta)$。这等价于最小化二次型 $Q(\\beta) = (y - X\\beta)^{\\prime} V^{-1} (y - X\\beta)$。我们展开此表达式：\n$$ Q(\\beta) = (y^{\\prime} - \\beta^{\\prime}X^{\\prime})V^{-1}(y - X\\beta) = y^{\\prime}V^{-1}y - y^{\\prime}V^{-1}X\\beta - \\beta^{\\prime}X^{\\prime}V^{-1}y + \\beta^{\\prime}X^{\\prime}V^{-1}X\\beta $$\n由于 $y^{\\prime}V^{-1}X\\beta$ 是一个标量，它等于其转置 $(\\beta^{\\prime}X^{\\prime}V^{-1}y)$。因此：\n$$ Q(\\beta) = y^{\\prime}V^{-1}y - 2\\beta^{\\prime}X^{\\prime}V^{-1}y + \\beta^{\\prime}X^{\\prime}V^{-1}X\\beta $$\n为了找到最小值，我们计算关于 $\\beta$ 的梯度并将其设为零：\n$$ \\frac{\\partial Q(\\beta)}{\\partial \\beta} = -2X^{\\prime}V^{-1}y + 2X^{\\prime}V^{-1}X\\beta = 0 $$\n$$ X^{\\prime}V^{-1}X\\hat{\\beta} = X^{\\prime}V^{-1}y $$\n求解 $\\hat{\\beta}$ 得到 GLS 估计量：\n$$ \\hat{\\beta} = (X^{\\prime}V^{-1}X)^{-1}X^{\\prime}V^{-1}y $$\n此估计量的抽样协方差推导如下：\n$$ \\text{Cov}(\\hat{\\beta}) = \\text{Cov}((X^{\\prime}V^{-1}X)^{-1}X^{\\prime}V^{-1}y) $$\n使用性质 $\\text{Cov}(Ay) = A\\text{Cov}(y)A^{\\prime}$，其中 $A = (X^{\\prime}V^{-1}X)^{-1}X^{\\prime}V^{-1}$ 且 $\\text{Cov}(y) = V$：\n$$ \\text{Cov}(\\hat{\\beta}) = [(X^{\\prime}V^{-1}X)^{-1}X^{\\prime}V^{-1}] V [(X^{\\prime}V^{-1}X)^{-1}X^{\\prime}V^{-1}]^{\\prime} $$\n$$ \\text{Cov}(\\hat{\\beta}) = (X^{\\prime}V^{-1}X)^{-1}X^{\\prime}V^{-1} V (V^{-1})^{\\prime}X(X^{\\prime}V^{-1}X)^{-1} $$\n由于 $V$ 是对称的，$V^{-1}$ 也是对称的，所以 $(V^{-1})^{\\prime} = V^{-1}$。\n$$ \\text{Cov}(\\hat{\\beta}) = (X^{\\prime}V^{-1}X)^{-1}X^{\\prime}(V^{-1}V)V^{-1}X(X^{\\prime}V^{-1}X)^{-1} $$\n$$ \\text{Cov}(\\hat{\\beta}) = (X^{\\prime}V^{-1}X)^{-1}(X^{\\prime}V^{-1}X)(X^{\\prime}V^{-1}X)^{-1} = (X^{\\prime}V^{-1}X)^{-1} $$\n\n第3部分：数值计算。\n我们有以下矩阵：\n$$ V = \\begin{pmatrix} 2  1  0 \\\\ 1  2  0 \\\\ 0  0  2 \\end{pmatrix}, \\quad X = \\begin{pmatrix} 1  0 \\\\ 1  1 \\\\ 1  2 \\end{pmatrix}, \\quad y = \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} $$\n首先，我们求 $V$ 的逆矩阵。由于 $V$ 是块对角矩阵，其逆矩阵是其块的逆矩阵。\n左上角的 $2 \\times 2$ 块是 $\\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}$，其行列式为 $(2)(2)-(1)(1) = 3$。其逆矩阵是 $\\frac{1}{3}\\begin{pmatrix} 2  -1 \\\\ -1  2 \\end{pmatrix}$。右下角的 $1 \\times 1$ 块是 $(2)$，其逆是 $(1/2)$。\n$$ V^{-1} = \\begin{pmatrix} \\frac{2}{3}  -\\frac{1}{3}  0 \\\\ -\\frac{1}{3}  \\frac{2}{3}  0 \\\\ 0  0  \\frac{1}{2} \\end{pmatrix} $$\n接下来，我们计算 $X^{\\prime}V^{-1}X$。\n$$ X^{\\prime}V^{-1} = \\begin{pmatrix} 1  1  1 \\\\ 0  1  2 \\end{pmatrix} \\begin{pmatrix} \\frac{2}{3}  -\\frac{1}{3}  0 \\\\ -\\frac{1}{3}  \\frac{2}{3}  0 \\\\ 0  0  \\frac{1}{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{2} \\\\ -\\frac{1}{3}  \\frac{2}{3}  1 \\end{pmatrix} $$\n$$ X^{\\prime}V^{-1}X = \\begin{pmatrix} \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{2} \\\\ -\\frac{1}{3}  \\frac{2}{3}  1 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ 1  1 \\\\ 1  2 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{3}+\\frac{1}{3}+\\frac{1}{2}  0+\\frac{1}{3}+1 \\\\ -\\frac{1}{3}+\\frac{2}{3}+1  0+\\frac{2}{3}+2 \\end{pmatrix} = \\begin{pmatrix} \\frac{7}{6}  \\frac{4}{3} \\\\ \\frac{4}{3}  \\frac{8}{3} \\end{pmatrix} $$\n现在我们计算这个矩阵的逆，它就是 $\\hat{\\beta}$ 的抽样协方差 $\\text{Cov}(\\hat{\\beta})$。\n$$ \\det(X^{\\prime}V^{-1}X) = \\left(\\frac{7}{6}\\right)\\left(\\frac{8}{3}\\right) - \\left(\\frac{4}{3}\\right)^2 = \\frac{56}{18} - \\frac{16}{9} = \\frac{28}{9} - \\frac{16}{9} = \\frac{12}{9} = \\frac{4}{3} $$\n$$ \\text{Cov}(\\hat{\\beta}) = (X^{\\prime}V^{-1}X)^{-1} = \\frac{1}{4/3} \\begin{pmatrix} \\frac{8}{3}  -\\frac{4}{3} \\\\ -\\frac{4}{3}  \\frac{7}{6} \\end{pmatrix} = \\frac{3}{4} \\begin{pmatrix} \\frac{8}{3}  -\\frac{4}{3} \\\\ -\\frac{4}{3}  \\frac{7}{6} \\end{pmatrix} = \\begin{pmatrix} 2  -1 \\\\ -1  \\frac{7}{8} \\end{pmatrix} $$\n这就得到了抽样协方差矩阵的四个元素。\n\n最后，我们计算估计量 $\\hat{\\beta}$。首先，我们需要 $X^{\\prime}V^{-1}y$：\n$$ X^{\\prime}V^{-1}y = \\begin{pmatrix} \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{2} \\\\ -\\frac{1}{3}  \\frac{2}{3}  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{3}+\\frac{2}{3}+\\frac{3}{2} \\\\ -\\frac{1}{3}+\\frac{4}{3}+3 \\end{pmatrix} = \\begin{pmatrix} 1+\\frac{3}{2} \\\\ 1+3 \\end{pmatrix} = \\begin{pmatrix} \\frac{5}{2} \\\\ 4 \\end{pmatrix} $$\n现在，我们可以计算 $\\hat{\\beta}$：\n$$ \\hat{\\beta} = (X^{\\prime}V^{-1}X)^{-1} (X^{\\prime}V^{-1}y) = \\begin{pmatrix} 2  -1 \\\\ -1  \\frac{7}{8} \\end{pmatrix} \\begin{pmatrix} \\frac{5}{2} \\\\ 4 \\end{pmatrix} = \\begin{pmatrix} 2(\\frac{5}{2}) - 1(4) \\\\ -1(\\frac{5}{2}) + \\frac{7}{8}(4) \\end{pmatrix} = \\begin{pmatrix} 5-4 \\\\ -\\frac{5}{2} + \\frac{7}{2} \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} $$\n$\\hat{\\beta}$ 的两个元素是 $\\hat{\\beta}_0=1$ 和 $\\hat{\\beta}_1=1$。\n\n最终答案要求一个行矩阵，列出 $\\hat{\\beta}$ 的两个元素，然后是 $(X^{\\prime}V^{-1}X)^{-1}$ 按行主序排列的四个元素：$(\\hat{\\beta}_0, \\hat{\\beta}_1, \\text{Cov}_{11}, \\text{Cov}_{12}, \\text{Cov}_{21}, \\text{Cov}_{22})$。\n这对应于 $(1, 1, 2, -1, -1, \\frac{7}{8})$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 1  1  2  -1  -1  \\frac{7}{8} \\end{pmatrix}}\n$$", "id": "2823588"}, {"introduction": "当我们从物种的尺度转向基因的尺度时，会遇到另一层复杂性：单个基因的历史可能与承载它的物种的历史不一致。多物种溯祖（Multispecies Coalescent, MSC）模型为理解这种不一致性提供了框架，并将其与遗传漂变等基本群体遗传过程联系起来。不完全谱系分选（Incomplete Lineage Sorting, ILS）是导致这种不一致的主要原因，它发生在基因谱系未能在其直接共同祖先群体中完成溯祖合并的情况下。这项练习[@problem_id:2823645]将指导你推导出三分类单元情况下基因树不一致的经典概率，揭示了节点间分支长度（以世代计）和有效种群大小（$N_e$）在塑造我们在基因组中观察到的模式中的直接关系。", "problem": "考虑一个有根三物种树，其拓扑结构为 $((A,B),C)$。在该树中，物种 $A$ 和 $B$ 分化后，经过一个长度为 $T$ 代的节间，然后通向 $(A,B)$ 的谱系与 $C$ 的谱系发生溯祖合并。假设每个分支上的种群均为中性且大小恒定，有效种群大小为 $N_e$，每个物种采样一个谱系，物种形成事件是瞬时发生的，并且分化后没有迁移。在标准的多物种溯祖（MSC）模型下进行分析。\n\n从以下基本事实出发：(i) 在一个大小恒定为 $N_e$ 的随机交配种群中，两个谱系的溯祖合并等待时间（以代为单位）服从速率为 $1/(2N_e)$ 的指数分布；(ii) 当三个谱系进入同一个祖先种群时，下一次溯祖合并事件会以相等的概率选择 $\\binom{3}{2}$ 对中的任意一对。请从第一性原理出发，推导与物种树拓扑不一致的基因树的期望分数，并将其表示为无量纲节间长度 $\\tau$ 的函数。首先，使用参数值 $N_e = 750{,}000$ 和 $T = 1{,}200{,}000$ 代，计算以溯祖单位表示的节间长度 $\\tau = T/(2N_e)$。然后，计算不一致基因树的期望分数。\n\n将你的最终答案表示为一个行向量，依次包含 $\\tau$ 的值和不一致基因树的期望分数。将报告的每个数字四舍五入到四位有效数字。不需要单位。", "solution": "在尝试任何解答之前，需对问题进行验证。\n\n步骤1：提取已知条件。\n- 物种树拓扑：$((A,B),C)$。\n- 节间长度：$T$ 代。\n- 有效种群大小：$N_e$，在所有分支上恒定。\n- 采样方案：每个物种一个谱系。\n- 物种形成模型：瞬时事件。\n- 迁移：无分化后基因流。\n- 模型：标准多物种溯祖（MSC）。\n- 基本事实(i)：在大小恒定的种群 $N_e$ 中，两个谱系的溯祖合并等待时间（以代为单位）服从速率为 $1/(2N_e)$ 的指数分布。\n- 基本事实(ii)：对于进入祖先种群的三个谱系，$\\binom{3}{2}$ 对中的任何一对首先发生溯祖合并的概率相等。\n- 无量纲节间长度的定义：$\\tau = T/(2N_e)$。\n- 用于计算的参数值：$N_e = 750{,}000$ 和 $T = 1{,}200{,}000$ 代。\n- 要求输出：$\\tau$ 的值和不一致基因树的期望分数，四舍五入到四位有效数字。\n\n步骤2：验证。\n- 科学依据：该问题是溯祖理论领域的一个典型范例。它基于标准的多物种溯祖模型，该模型是现代系统发育学和群体遗传学的基石。所给的假设和事实是该理论的基础。该问题在科学上是合理的。\n- 良定性：该问题提供了所有必要的参数、定义和明确的目标。其结构保证了存在唯一、稳定且有意义的解。\n- 客观性：该问题以精确、定量的术语陈述，没有主观或模糊的语言。\n\n步骤3：结论。\n该问题有效，因为它具有科学依据、良定性和客观性。它没有违反任何指定的无效标准。将推导解答。\n\n从第一性原理推导：\n物种树拓扑为 $((A,B),C)$，这表明物种 $A$ 和 $B$ 是姐妹群，它们的共同祖先与物种 $C$ 共享一个更早的共同祖先。我们从三个物종（$A$、$B$ 和 $C$）中各采样一个基因拷贝，并向后追溯其谱系。\n\n来自 $A$ 和 $B$ 的谱系进入它们的共同祖先种群。这个祖先种群持续了 $T$ 代的节间时长。我们以溯祖单位定义节间长度为 $\\tau = T / (2N_e)$，其中一个溯祖时间单位等于 $2N_e$ 代。根据问题陈述，两个谱系溯祖合并的等待时间服从速率参数为 $1/(2N_e)$ 代$^{-1}$ 的指数分布。以溯祖时间单位衡量，速率参数为 $1$。\n\n在这个长度为 $\\tau$ 的节间内，可能发生两个互斥事件：\n1. 来自 $A$ 和 $B$ 的谱系在节间内发生溯祖合并。\n2. 来自 $A$ 和 $B$ 的谱系未能在节间内发生溯祖合并。\n\n让我们分析每个事件的概率。在时间 $\\tau$ 之前发生溯祖合并的概率由速率为 $1$ 的指数分布的累积分布函数（CDF）在 $\\tau$ 处的值给出：\n$$P(\\text{coalescence in internode}) = \\int_0^\\tau \\exp(-t) dt = \\left[ -\\exp(-t) \\right]_0^\\tau = 1 - \\exp(-\\tau)$$\n如果来自 $A$ 和 $B$ 的谱系发生溯祖合并，得到的基因树拓扑将是 $((A,B),C)$。这种拓扑与物种树是一致的。\n\n来自 $A$ 和 $B$ 的谱系在节间内不发生溯祖合并的概率是其互补概率：\n$$P(\\text{no coalescence in internode}) = 1 - P(\\text{coalescence in internode}) = 1 - (1 - \\exp(-\\tau)) = \\exp(-\\tau)$$\n如果这两个谱系未能溯祖合并，那么在过去的 $T$ 时刻（或以溯祖单位计的 $\\tau$ 时刻），三个不同的谱系——$A$ 样本的祖先、$B$ 样本的祖先和 $C$ 样本的祖先——将进入所有三个物种共有的更深层祖先种群。\n\n根据问题的假设，当三个谱系存在于一个随机交配种群中时，下一次溯祖合并事件会以相等的概率涉及 $\\binom{3}{2} = 3$ 种可能的谱系对中的任何一对。这三对是 $(A,B)$、$(A,C)$ 和 $(B,C)$。任何特定谱系对首先发生溯祖合并的概率是 $\\frac{1}{3}$。\n- 如果 $(A,B)$ 对首先溯祖合并，得到的基因树是 $((A,B),C)$。这是一个一致的拓扑。此事件发生的条件概率为 $\\frac{1}{3}$。\n- 如果 $(A,C)$ 对首先溯祖合并，得到的基因树是 $((A,C),B)$。这是一个不一致的拓扑。此事件发生的条件概率为 $\\frac{1}{3}$。\n- 如果 $(B,C)$ 对首先溯祖合并，得到的基因树是 $((B,C),A)$。这也是一个不一致的拓扑。此事件发生的条件概率为 $\\frac{1}{3}$。\n\n只有当来自 $A$ 和 $B$ 的谱系未在节间内溯祖合并，*并且* 在更深层的祖先种群中，第一次溯祖合并事件涉及 $(A,C)$ 或 $(B,C)$ 对时，才会产生不一致的基因树。\n\n观察到不一致基因树的总概率是这两种结果的概率之和：\n$$P(\\text{discordant}) = P(\\text{no coalescence in internode}) \\times \\left( P((A,C) \\text{ coalesces first}) + P((B,C) \\text{ coalesces first}) \\right)$$\n$$P(\\text{discordant}) = \\exp(-\\tau) \\times \\left( \\frac{1}{3} + \\frac{1}{3} \\right)$$\n$$P(\\text{discordant}) = \\frac{2}{3}\\exp(-\\tau)$$\n这是针对此三物种情况，不一致基因树期望分数的一般公式。\n\n接下来，我们按要求进行数值计算。\n首先，我们使用给定的参数 $N_e = 750{,}000$ 和 $T = 1{,}200{,}000$ 计算无量纲节间长度 $\\tau$：\n$$\\tau = \\frac{T}{2N_e} = \\frac{1{,}200{,}000}{2 \\times 750{,}000} = \\frac{1{,}200{,}000}{1{,}500{,}000} = \\frac{12}{15} = \\frac{4}{5} = 0.8$$\n\n其次，我们计算此 $\\tau$ 值下不一致基因树的期望分数：\n$$P(\\text{discordant}) = \\frac{2}{3}\\exp(-0.8)$$\n使用值 $\\exp(-0.8) \\approx 0.44932896$，我们得到：\n$$P(\\text{discordant}) \\approx \\frac{2}{3} \\times 0.44932896 \\approx 0.29955264$$\n\n问题要求将每个数字四舍五入到四位有效数字。\n- 对于 $\\tau = 0.8$，四位有效数字为 $0.8000$。\n- 对于 $P(\\text{discordant}) \\approx 0.29955264$，四舍五入到四位有效数字为 $0.2996$。\n\n最终答案是一个依次包含这两个值的行向量。", "answer": "$$\\boxed{\\begin{pmatrix} 0.8000  0.2996 \\end{pmatrix}}$$", "id": "2823645"}]}