{"hands_on_practices": [{"introduction": "tau-leaping方法的核心在于，在一个时间步长 $\\tau$ 内，根据每个化学反应发生的次数来更新系统中各种分子的数量。这个练习将通过一个简单的可逆二聚化反应，帮助你掌握这一基本更新规则。通过推导单体和二聚体数量的更新方程，你将亲身体会化学计量学（stoichiometry）如何在随机模拟的每一步中塑造系统状态的演变。", "problem": "在系统生物学中，随机模拟算法对于模拟细胞内的生化反应网络至关重要，其中少量分子可能导致显著的随机波动。考虑一个蛋白质 $P$ 聚合成二聚体 $P_2$ 的简化模型，这是一个与许多细胞功能相关的过程。\n\n该系统由两个可逆反应组成：一个正向二聚化反应，其中两个蛋白质单体形成一个二聚体；以及一个逆向反应，其中一个二聚体解离回两个单体。这可以表示为：\n$$2P \\underset{k_r}{\\stackrel{k_f}{\\rightleftharpoons}} P_2$$\n其中 $k_f$ 和 $k_r$ 分别是正向和逆向随机速率常数。\n\n在任何给定时间 $t$，系统的状态由单体分子数 $N_P(t)$ 和二聚体分子数 $N_{P2}(t)$ 描述。\n\n我们希望使用 tau-leaping 近似法来模拟该系统的演化，该方法以固定的时间步长 $\\tau$ 推进系统。在这种方法中，每个反应通道在时间间隔 $[t, t+\\tau]$ 内发生的次数被建模为一个随机变量。设 $K_f$ 是在持续时间为 $\\tau$ 的单个时间步内发生的正向反应事件（二聚化）的次数， $K_r$ 是逆向反应事件（解离）的次数。\n\n确定在时间 $t+\\tau$ 时单体和二聚体分子数量的更新方程。你的最终答案应包含两个表达式，一个用于 $N_P(t+\\tau)$，另一个用于 $N_{P2}(t+\\tau)$，用时间 $t$ 时的状态（即 $N_P(t)$ 和 $N_{P2}(t)$）以及反应事件的次数（$K_f$ 和 $K_r$）来表示。", "solution": "我们用状态向量 $X(t) = \\big(N_{P}(t),\\, N_{P2}(t)\\big)$ 来对系统建模。在 tau-leaping 方法中，在持续时间为 $\\tau$ 的时间间隔内，状态的变化是每个反应的化学计量变化乘以该反应在该时间间隔内发生的次数的总和。用 $K_{f}$ 和 $K_{r}$ 分别表示在 $[t, t+\\tau]$ 内正向和逆向反应事件的次数。\n\n对于反应 $2P \\to P_{2}$（正向），化学计量变化向量为\n$$\nv_{f} = \\big(-2,\\; +1\\big),\n$$\n因为每次反应发生会消耗 $2$ 个单体并产生 $1$ 个二聚体。\n\n对于反应 $P_{2} \\to 2P$（逆向），化学计量变化向量为\n$$\nv_{r} = \\big(+2,\\; -1\\big),\n$$\n因为每次反应发生会产生 $2$ 个单体并消耗 $1$ 个二聚体。\n\n于是，tau-leaping 的更新规则为\n$$\nX(t+\\tau) = X(t) + v_{f}\\,K_{f} + v_{r}\\,K_{r}.\n$$\n将各分量明确写出，得到\n$$\nN_{P}(t+\\tau) = N_{P}(t) - 2K_{f} + 2K_{r},\n$$\n$$\nN_{P2}(t+\\tau) = N_{P2}(t) + K_{f} - K_{r}.\n$$\n这些就是所要求的更新方程，用时间 $t$ 时的状态以及在持续时间为 $\\tau$ 的步长内的反应次数 $K_{f}$ 和 $K_{r}$ 来表示。", "answer": "$$\\boxed{\\begin{pmatrix}N_{P}(t+\\tau)  N_{P2}(t+\\tau)\\end{pmatrix}=\\begin{pmatrix}N_{P}(t)-2K_{f}+2K_{r}  N_{P2}(t)+K_{f}-K_{r}\\end{pmatrix}}$$", "id": "1470711"}, {"introduction": "虽然tau-leaping方法在计算上很高效，但它依赖于一个关键假设：在一个时间步长 $\\tau$ 内，反应倾向性（propensities）保持不变。如果 $\\tau$ 选择得过大，这个假设就会失效。这个实践练习提供了一个鲜明的数值例子，展示了当时间步长选择不当时，该近似方法会如何崩溃并导致非物理性的结果（如负数的分子数量）[@problem_id:1470716]。这凸显了谨慎选择步长或使用自适应步长策略的重要性。", "problem": "一名系统生物学课程的学生正在研究单细胞内代谢途径的简化模型。该模型由两个不可逆的化学反应组成：底物 $A$ 转化为中间产物 $B$，然后 $B$ 降解。反应遵循质量作用动力学：\n1.  $A \\xrightarrow{k_1} B$\n2.  $B \\xrightarrow{k_2} \\emptyset$\n\n系统的状态由物种 $A$ 和 $B$ 的分子数描述，分别表示为 $n_A$ 和 $n_B$。这两个反应的倾向函数由 $a_1 = k_1 n_A$ 和 $a_2 = k_2 n_B$ 给出。\n\n该学生决定使用一种基本的显式 tau-leaping 方法来模拟系统的演化。在此近似中，在持续时间为 $\\tau$ 的时间间隔内，每个反应 $j$ 发生的次数（表示为 $N_j$）被确定性地估计为 $N_j = a_j(t) \\cdot \\tau$，其中倾向函数 $a_j(t)$ 使用该时间间隔开始时（即 $t$ 时刻）的系统状态来计算。\n\n在时间 $t=0$ 时，系统包含 $n_A(0) = 100$ 个分子和 $n_B(0) = 20$ 个分子。速率常数为 $k_1 = 0.05 \\text{ s}^{-1}$ 和 $k_2 = 1.0 \\text{ s}^{-1}$。该学生选择的时间步长为 $\\tau = 10 \\text{ s}$。\n\n计算在此单个时间步长后物种 B 的分子数 $n_B(\\tau)$。用分子数表示你的答案。", "solution": "反应及其每次发生时的化学计量效应为：对于 $A \\to B$，$\\Delta n_{A}=-1$ 和 $\\Delta n_{B}=+1$；对于 $B \\to \\emptyset$，$\\Delta n_{A}=0$ 和 $\\Delta n_{B}=-1$。在时间 $t$ 的质量作用倾向函数为 $a_{1}(t)=k_{1}n_{A}(t)$ 和 $a_{2}(t)=k_{2}n_{B}(t)$。在显式 tau-leaping 近似中，在 $[t,t+\\tau)$ 时间段内反应的触发次数为 $N_{j}=a_{j}(t)\\tau$，使用的是该时间间隔开始时的状态。\n\n给定 $n_{A}(0)=100$，$n_{B}(0)=20$，$k_{1}=0.05$，$k_{2}=1.0$ 以及 $\\tau=10$，计算初始倾向函数：\n$$\na_{1}(0)=k_{1}n_{A}(0)=0.05\\times 100=5,\\qquad a_{2}(0)=k_{2}n_{B}(0)=1.0\\times 20=20.\n$$\n那么，该步长内的确定性事件计数为：\n$$\nN_{1}=a_{1}(0)\\tau=5\\times 10=50,\\qquad N_{2}=a_{2}(0)\\tau=20\\times 10=200.\n$$\n使用化学计量关系更新 $n_{B}$，\n$$\nn_{B}(\\tau)=n_{B}(0)+(+1)N_{1}+(-1)N_{2}=20+50-200=-130.\n$$\n这个负数结果表明所选的 tau-leaping 步长失效了，但这是所述近似方法的直接结果。", "answer": "$$\\boxed{-130}$$", "id": "1470716"}, {"introduction": "在认识到基本tau-leaping方法可能因步长过大而失效后，一个自然的问题是如何改进它。这个进阶练习探索了一种提高算法精度的方法，即推导一个二阶校正项，这类似于数值积分中的梯形法则。通过这个练习，你将学习如何利用泰勒展开来估算倾向性在一个时间步内的变化，从而构建一个更精确的随机积分器 [@problem_id:1470747]。这不仅加深了你对tau-leaping近似本质的理解，也为你展示了从简单的一阶方法迈向更复杂、更鲁棒算法的路径。", "problem": "考虑一个由 $N$ 个化学物种组成的系统，该系统经历了 $M$ 个反应通道。在时间 $t$，系统的状态由分子数量向量 $\\mathbf{X}(t) = (X_1(t), \\dots, X_N(t))^T$ 给出。每个反应通道 $j \\in \\{1, \\dots, M\\}$ 的动力学由其倾向函数 $a_j(\\mathbf{X})$ 和其状态改变向量 $\\mathbf{v}_j$ 描述，后者是 $N \\times M$ 化学计量矩阵 $\\mathbf{S}$ 的第 $j$ 列。矩阵元素 $S_{ik}$ 表示由于反应 $k$ 发生一次而引起的物种 $i$ 的分子数量变化。\n\nGillespie 随机模拟算法 (SSA) 提供了该系统轨迹的精确模拟。然而，对于具有大量分子数量的系统，SSA 的计算成本可能过高。显式 tau-leaping 方法通过以大小为 $\\tau$ 的离散步长推进时间来加速模拟。在其最简单的形式（泊松步长近似）中，每个反应 $j$ 在区间 $[t, t+\\tau]$ 内发生的次数服从泊松分布 $K_j \\sim \\mathcal{P}(\\lambda_j)$，其均值为 $\\lambda_j = a_j(\\mathbf{X}(t))\\tau$。\n\n该近似假设倾向函数在整个区间内保持不变，但随着 $\\tau$ 的增大，这一假设不再成立。为了提高精度，我们可以构建一个类似梯形的更新规则。这涉及到使用区间 $[t, t+\\tau]$ 上的平均倾向函数来近似反应事件的平均次数，而不仅仅是使用起始点的倾向函数。\n\n您的任务是推导用于反应通道 $j$ 的 tau-leaping 方法中泊松分布均值的二阶修正项。假设修正后的均值为 $\\lambda_j^* = a_j(\\mathbf{X}(t))\\tau + \\delta_j$。请找出修正项 $\\delta_j$ 的表达式。\n\n为了推导这个表达式，您应该使用倾向函数 $a_j$ 的一阶多元泰勒展开来估计其在时间 $t+\\tau$ 的值。此展开所需的状态向量的期望变化应使用未经校正的一阶泊松步长近似来计算。\n\n请提供修正项 $\\delta_j$ 的闭式解析表达式，该表达式应以 $\\tau$、倾向函数 $a_k(\\mathbf{X}(t))$、化学计量矩阵的元素 $S_{ik}$ 以及倾向函数 $a_j(\\mathbf{X}(t))$ 对物种数量 $X_i$ 的偏导数来表示。", "solution": "我们寻求对反应通道 $j$ 在 $[t,t+\\tau]$ 区间内发生次数均值的一个类似梯形的修正。确切的均值是倾向函数在该区间上的积分，梯形近似法得出\n$$\n\\lambda_{j}^{*} \\approx \\frac{\\tau}{2}\\left(a_{j}(\\mathbf{X}(t)) + \\mathbb{E}\\left[a_{j}(\\mathbf{X}(t+\\tau))\\right]\\right).\n$$\n根据定义 $\\lambda_{j}^{*} = a_{j}(\\mathbf{X}(t))\\tau + \\delta_{j}$，我们有\n$$\n\\delta_{j} = \\frac{\\tau}{2}\\left(\\mathbb{E}\\left[a_{j}(\\mathbf{X}(t+\\tau))\\right]-a_{j}(\\mathbf{X}(t))\\right).\n$$\n为近似 $a_{j}(\\mathbf{X}(t+\\tau))$，使用关于 $\\mathbf{X}(t)$ 的一阶多元泰勒展开：\n$$\na_{j}(\\mathbf{X}(t+\\tau)) \\approx a_{j}(\\mathbf{X}(t)) + \\sum_{i=1}^{N} \\frac{\\partial a_{j}}{\\partial X_{i}}(\\mathbf{X}(t))\\left(X_{i}(t+\\tau) - X_{i}(t)\\right).\n$$\n取期望，\n$$\n\\mathbb{E}\\left[a_{j}(\\mathbf{X}(t+\\tau))\\right] \\approx a_{j}(\\mathbf{X}(t)) + \\sum_{i=1}^{N} \\frac{\\partial a_{j}}{\\partial X_{i}}(\\mathbf{X}(t))\\,\\mathbb{E}\\left[\\Delta X_{i}\\right],\n$$\n其中 $\\Delta \\mathbf{X} = \\mathbf{X}(t+\\tau)-\\mathbf{X}(t)$。在未经校正的泊松步长 tau-leap 方法下，反应计数向量 $\\mathbf{K}$ 的分量为 $K_{k} \\sim \\mathcal{P}(a_{k}(\\mathbf{X}(t))\\tau)$ 且 $\\Delta \\mathbf{X} = \\mathbf{S}\\mathbf{K}$。因此\n$$\n\\mathbb{E}\\left[\\Delta X_{i}\\right] = \\sum_{k=1}^{M} S_{ik}\\,\\mathbb{E}[K_{k}] = \\sum_{k=1}^{M} S_{ik}\\,a_{k}(\\mathbf{X}(t))\\,\\tau.\n$$\n代入 $\\delta_{j}$ 的表达式中，得到\n$$\n\\delta_{j} = \\frac{\\tau}{2}\\sum_{i=1}^{N} \\frac{\\partial a_{j}}{\\partial X_{i}}(\\mathbf{X}(t)) \\left(\\tau \\sum_{k=1}^{M} S_{ik}\\,a_{k}(\\mathbf{X}(t))\\right)\n= \\frac{\\tau^{2}}{2}\\sum_{i=1}^{N}\\sum_{k=1}^{M} S_{ik}\\,a_{k}(\\mathbf{X}(t))\\,\\frac{\\partial a_{j}}{\\partial X_{i}}(\\mathbf{X}(t)).\n$$\n这就是所求的闭式修正项。", "answer": "$$\\boxed{\\delta_{j}=\\frac{\\tau^{2}}{2}\\sum_{i=1}^{N}\\sum_{k=1}^{M}S_{ik}\\,a_{k}(\\mathbf{X}(t))\\,\\frac{\\partial a_{j}}{\\partial X_{i}}(\\mathbf{X}(t))}$$", "id": "1470747"}]}