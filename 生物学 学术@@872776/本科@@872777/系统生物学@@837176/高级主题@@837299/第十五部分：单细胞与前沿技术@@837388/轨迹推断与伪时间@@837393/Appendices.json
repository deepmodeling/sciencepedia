{"hands_on_practices": [{"introduction": "在进行轨迹推断之前，最关键的第一步是处理原始基因表达数据。由于测序深度等技术差异，不同细胞的原始基因计数值（raw counts）不具可比性。本练习将通过一个简单的场景，阐明为何必须进行数据标准化，以及如何通过计算相对表达丰度来准确比较细胞在发育过程中的相对位置 [@problem_id:1475523]。", "problem": "在系统生物学领域，单细胞RNA测序（scRNA-seq）是一种强大的技术，用于测量数千个单个细胞的基因表达谱。scRNA-seq 的一个常见应用是轨迹推断，其目的是通过分析细胞的基因表达模式，将细胞沿着一个连续的生物学过程（如细胞分化）进行计算排序。这种排序创建了一个代表该过程进展的“伪时间”轴。\n\n一位研究人员收集了一群正在经历分化的细胞的 scRNA-seq 数据。他们从这个细胞群体中分离出了两个特定的细胞，细胞 A 和细胞 B。这些细胞的原始数据包括每个基因的唯一分子标识符（UMI）的计数，该计数与最初存在的信使RNA分子的数量成正比。在一个细胞中计数的UMI总数被称为其“文库大小”，由于技术因素，它在不同细胞之间可能存在显著差异。\n\n已知该分化过程由两个关键的标记基因调控：\n1.  `Gene_Start`：该基因在分化过程开始时高表达，随着细胞成熟其表达量逐渐减少。\n2.  `Gene_End`：该基因最初表达水平较低，随着细胞到达分化过程的末端，其表达量逐渐增加。\n\n这两个细胞的原始UMI计数数据如下：\n\n*   **细胞 A**：\n    *   总文库大小（总UMI计数）：2,000\n    *   `Gene_Start` 的UMI计数：200\n    *   `Gene_End` 的UMI计数：10\n\n*   **细胞 B**：\n    *   总文库大小（总UMI计数）：10,000\n    *   `Gene_Start` 的UMI计数：500\n    *   `Gene_End` 的UMI计数：200\n\n根据这些数据和标记基因的已知作用，关于细胞 A 和细胞 B 在分化轨迹上的相对位置，最科学合理的结论是什么？\n\nA. 细胞 A 处于比细胞 B 更早的分化阶段。\n\nB. 细胞 B 处于比细胞 A 更早的分化阶段。\n\nC. 数据无法得出结论，因为细胞 B 的两个标记基因的原始计数都更高，呈现出矛盾的生物学信号。\n\nD. 两个细胞很可能都处于稳定的终末分化状态，因为它们的表达谱无法以有意义的方式排序。\n\nE. 与细胞 B 相比，细胞 A 的文库大小太小，无法得出任何可靠的结论。", "solution": "为了比较具有不同文库大小的细胞间的基因表达，需要使用文库大小归一化。相关原理是比较每个细胞内各个基因的UMI所占的比例，定义为\n$$\np_{g,c}=\\frac{\\text{UMI count of gene }g\\text{ in cell }c}{\\text{total UMI count (library size) of cell }c}.\n$$\n计算细胞 A 的归一化表达量：\n$$\np_{\\text{Gene\\_Start}, A}=\\frac{200}{2000}=\\frac{1}{10},\\quad p_{\\text{Gene\\_End}, A}=\\frac{10}{2000}=\\frac{1}{200}.\n$$\n计算细胞 B 的归一化表达量：\n$$\np_{\\text{Gene\\_Start}, B}=\\frac{500}{10000}=\\frac{1}{20},\\quad p_{\\text{Gene\\_End}, B}=\\frac{200}{10000}=\\frac{1}{50}.\n$$\n比较归一化后的值：\n$$\np_{\\text{Gene\\_Start}, A} > p_{\\text{Gene\\_Start}, B} \\quad (\\frac{1}{10} > \\frac{1}{20}),\\quad \\text{and} \\quad p_{\\text{Gene\\_End}, A}  p_{\\text{Gene\\_End}, B} \\quad (\\frac{1}{200}  \\frac{1}{50}).\n$$\n根据所述的标记基因行为进行解读：`Gene_Start` 的相对表达量较高而 `Gene_End` 的相对表达量较低，表明处于较早的伪时间位置；而 `Gene_Start` 较低、`Gene_End` 较高则表明处于较晚的伪时间位置。因此，细胞 A 在分化轨迹上比细胞 B 更早。\n\n这就排除了其他选项，即原始计数是矛盾的（归一化解决了这个问题）、两个细胞都处于终末状态（相反的标记基因趋势表明了进程）、或细胞 A 的文库大小使得无法进行推断（比例是可解释的）。", "answer": "$$\\boxed{A}$$", "id": "1475523"}, {"introduction": "许多轨迹推断算法通过构建一个连接相似细胞的图来工作，但参数选择不当可能导致图中出现错误的“短路”连接，例如将祖细胞直接连接到终末状态的细胞。为了提高轨迹的准确性，我们可以设计量化指标来识别和修剪这些伪影。本练习介绍了一种“邻域不一致性评分”，让你亲手计算并评估一条可疑连接的可靠性 [@problem_id:1475469]。", "problem": "在单细胞转录组学领域，轨迹推断旨在从基因表达数据的静态快照中重建细胞的发育路径。一种常见的方法是构建一个k-最近邻（k-NN）图，其中每个细胞是一个节点，边连接着表达谱相似的细胞。从这个图中，为每个细胞计算一个“伪时间”值，将它们沿着发育轨迹进行排序。当参数（如邻居数 $k$）的选择不佳时，会出现一个关键挑战，即产生人为的“短路”边，错误地将早期祖细胞直接连接到晚期终末细胞，绕过了中间状态。\n\n为了识别和修剪此类人为产物，需要一个定量的度量标准。考虑细胞图中任意给定边 $(u, v)$ 的“邻域不一致性分数”（NIS）。其原理是，对于一条有效的边，细胞 $v$ 的伪时间应与细胞 $u$ 的其他邻居的伪时间一致，反之亦然。\n\nNIS 的定义如下：对于一条边 $(u, v)$，设 $P_i$ 是细胞 $i$ 预先计算好的伪时间。设 $N'(u)$ 是 $u$ 的邻居集合（不包括 $v$），$N'(v)$ 是 $v$ 的邻居集合（不包括 $u$）。设 $\\langle P \\rangle_{N'}$ 和 $\\sigma_{N'}$ 分别表示给定邻域集合内伪时间的均值和标准差。那么，NIS 由以下公式给出：\n\n$$ \\text{NIS}(u, v) = \\frac{1}{2} \\left( \\frac{|P_v - \\langle P \\rangle_{N'(u)}|}{\\sigma_{N'(u)}} + \\frac{|P_u - \\langle P \\rangle_{N'(v)}|}{\\sigma_{N'(v)}} \\right) $$\n\n你的任务是评估一条连接祖细胞 $c_A$ 和终末分化细胞 $c_B$ 的可疑边。相关的预计算值如下：\n\n- 细胞 $c_A$ 的伪时间：$P_A = 0.05$\n- 细胞 $c_B$ 的伪时间：$P_B = 0.95$\n- 对于 $c_A$ 的邻域（不包括 $c_B$）：$\\langle P \\rangle_{N'(A)} = 0.08$ 且 $\\sigma_{N'(A)} = 0.030$\n- 对于 $c_B$ 的邻域（不包括 $c_A$）：$\\langle P \\rangle_{N'(B)} = 0.91$ 且 $\\sigma_{N'(B)} = 0.040$\n\n计算边 $(c_A, c_B)$ 的邻域不一致性分数。将你的最终答案四舍五入到三位有效数字。", "solution": "我们使用给定的邻域不一致性分数定义：\n$$\n\\text{NIS}(u, v) = \\frac{1}{2} \\left( \\frac{|P_v - \\langle P \\rangle_{N'(u)}|}{\\sigma_{N'(u)}} + \\frac{|P_u - \\langle P \\rangle_{N'(v)}|}{\\sigma_{N'(v)}} \\right).\n$$\n对于边 $u=c_{A}$ 和 $v=c_{B}$，代入所提供的值：\n- $P_{A} = 0.05$, $P_{B} = 0.95$,\n- $\\langle P \\rangle_{N'(A)} = 0.08$, $\\sigma_{N'(A)} = 0.030$,\n- $\\langle P \\rangle_{N'(B)} = 0.91$, $\\sigma_{N'(B)} = 0.040$.\n\n计算每个标准化偏差项：\n$$\n\\frac{|P_{B} - \\langle P \\rangle_{N'(A)}|}{\\sigma_{N'(A)}} = \\frac{|0.95 - 0.08|}{0.030} = \\frac{0.87}{0.030} = 29,\n$$\n$$\n\\frac{|P_{A} - \\langle P \\rangle_{N'(B)}|}{\\sigma_{N'(B)}} = \\frac{|0.05 - 0.91|}{0.040} = \\frac{0.86}{0.040} = 21.5.\n$$\n将两项取平均值以获得 NIS：\n$$\n\\text{NIS}(c_{A}, c_{B}) = \\frac{1}{2}\\left(29 + 21.5\\right) = \\frac{50.5}{2} = 25.25.\n$$\n四舍五入到三位有效数字得到 $25.3$。", "answer": "$$\\boxed{25.3}$$", "id": "1475469"}, {"introduction": "面对众多的轨迹推断算法，如何客观地评估它们的性能至关重要。一种常见的方法是使用具有已知“真实”细胞分化路径的模拟数据进行基准检验。本练习将引导你使用一套标准的性能指标，来评估一个虚构算法在拓扑结构预测和伪时间排序两方面的准确性，从而让你掌握算法评估的核心方法 [@problem_id:1475509]。", "problem": "在系统生物学中，评估轨迹推断 (TI) 算法的性能至关重要。一种常见的方法是使用具有已知基准真相细胞分化路径的模拟数据。您的任务是使用一个预定义的综合指标来评估一种名为“PathFinder”的新型 TI 算法。\n\n基准真相的发育过程被建模为一个有向图，其中节点是不同的细胞簇，边代表它们之间的转换。真实的拓扑结构由四个簇组成：一个祖细胞 (P)、一个中间状态 (I)、终点 A (A) 和终点 B (B)。代表真实分化路径的基准真相边集为 $G_{true} = \\{(P, I), (I, A), (I, B)\\}$。\n\nPathFinder 算法在模拟数据上运行，并推断出一个拓扑结构，其边集为 $G_{inferred} = \\{(P, I), (I, A), (P, B)\\}$。\n\nTI 的一个关键方面也是细胞沿谱系的正确排序，这被称为伪时间。对于真实谱系 P $\\rightarrow$ I $\\rightarrow$ A，五个特定细胞的基准真相时间顺序由列表 $O_{true} = [c_1, c_2, c_3, c_4, c_5]$ 给出，其中列表中较早的位置表示较早的伪时间。PathFinder 算法推断出这五个相同细胞的顺序为 $O_{inferred} = [c_2, c_1, c_4, c_3, c_5]$。\n\n为了量化算法的性能，定义了一个综合分数 $S$，它是拓扑分数 ($S_{topo}$) 和伪时间分数 ($S_{pseudo}$) 的加权平均值：\n$$S = 0.6 \\cdot S_{topo} + 0.4 \\cdot S_{pseudo}$$\n\n拓扑分数 $S_{topo}$ 是根据边集计算出的 F1 分数。F1 分数是精确率和召回率的调和平均数，其中如果一条边同时存在于 $G_{true}$ 和 $G_{inferred}$ 中，则为真阳性 (TP)；如果它存在于 $G_{inferred}$ 中但不存在于 $G_{true}$ 中，则为假阳性 (FP)；如果它存在于 $G_{true}$ 中但不存在于 $G_{inferred}$ 中，则为假阴性 (FN)。\n\n伪时间分数 $S_{pseudo}$ 仅对正确识别的谱系进行计算。它被定义为基准真相与推断的细胞排序之间的 Kendall's Tau-a 等级相关系数 ($\\tau_a$)。对于一个包含 $n$ 个项目的列表，$\\tau_a$ 由以下公式给出：\n$$\\tau_a = \\frac{N_c - N_d}{\\frac{1}{2} n(n-1)}$$\n其中 $N_c$是一致对的数量，$N_d$ 是不一致对的数量。如果一对细胞在两个列表中的相对顺序相同，则它们是一致的；如果它们的相对顺序相反，则它们是不一致的。如果构成从起点到终点路径的所有边都是真阳性，则该谱系被认为是“正确识别的”。\n\n计算 PathFinder 算法的综合分数 $S$。将您的最终答案四舍五入到三位有效数字。", "solution": "识别拓扑结构中的真阳性、假阳性和假阴性。基准真相的边集是 $G_{true}=\\{(P,I),(I,A),(I,B)\\}$，推断的边集是 $G_{inferred}=\\{(P,I),(I, A),(P,B)\\}$。因此，\n- 真阳性：$(P,I)$ 和 $(I,A)$，所以 $\\mathrm{TP}=2$。\n- 假阳性：$(P,B)$，所以 $\\mathrm{FP}=1$。\n- 假阴性：$(I,B)$，所以 $\\mathrm{FN}=1$。\n\n计算精确率和召回率：\n$$\\mathrm{Precision}=\\frac{\\mathrm{TP}}{\\mathrm{TP}+\\mathrm{FP}}=\\frac{2}{2+1}=\\frac{2}{3},\\quad \\mathrm{Recall}=\\frac{\\mathrm{TP}}{\\mathrm{TP}+\\mathrm{FN}}=\\frac{2}{2+1}=\\frac{2}{3}.$$\nF1 分数是调和平均数：\n$$S_{topo}=\\frac{2\\cdot \\mathrm{Precision}\\cdot \\mathrm{Recall}}{\\mathrm{Precision}+\\mathrm{Recall}}=\\frac{2\\cdot \\frac{2}{3}\\cdot \\frac{2}{3}}{\\frac{2}{3}+\\frac{2}{3}}=\\frac{2}{3}.$$\n\n检查谱系 $P\\rightarrow I\\rightarrow A$ 是否被正确识别。它的边是 $(P,I)$ 和 $(I,A)$，两者都是真阳性，因此它被正确识别，可以进行伪时间评估。\n\n计算 $O_{true}=[c_{1},c_{2},c_{3},c_{4},c_{5}]$ 和 $O_{inferred}=[c_{2},c_{1},c_{4},c_{3},c_{5}]$ 的 Kendall's $\\tau_{a}$，其中 $n=5$，因此总对数为 $\\frac{1}{2}n(n-1)=10$。使用真实位置 $\\{c_{1}:1,c_{2}:2,c_{3}:3,c_{4}:4,c_{5}:5\\}$ 和推断位置 $\\{c_{2}:1,c_{1}:2,c_{4}:3,c_{3}:4,c_{5}:5\\}$，按真实顺序评估所有对：\n- $(c_{1},c_{2})$ 不一致；$(c_{1},c_{3})$ 一致；$(c_{1},c_{4})$ 一致；$(c_{1},c_{5})$ 一致；\n- $(c_{2},c_{3})$ 一致；$(c_{2},c_{4})$ 一致；$(c_{2},c_{5})$ 一致；\n- $(c_{3},c_{4})$ 不一致；$(c_{3},c_{5})$ 一致；$(c_{4},c_{5})$ 一致。\n\n因此 $N_{c}=8$ 且 $N_{d}=2$，得出\n$$S_{pseudo}=\\tau_{a}=\\frac{N_{c}-N_{d}}{\\frac{1}{2}n(n-1)}=\\frac{8-2}{10}=\\frac{6}{10}=0.6.$$\n\n将分数与给定的权重相结合：\n$$S=0.6\\cdot S_{topo}+0.4\\cdot S_{pseudo}=0.6\\cdot \\frac{2}{3}+0.4\\cdot 0.6=\\frac{3}{5}\\cdot \\frac{2}{3}+\\frac{2}{5}\\cdot \\frac{3}{5}=\\frac{2}{5}+\\frac{6}{25}=\\frac{10}{25}+\\frac{6}{25}=\\frac{16}{25}=0.64.$$\n四舍五入到三位有效数字，结果是 $0.640$。", "answer": "$$\\boxed{0.640}$$", "id": "1475509"}]}