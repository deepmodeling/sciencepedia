{"hands_on_practices": [{"introduction": "处理批次效应的最佳策略是“防患于未然”。本练习将带你从实验设计的源头出发，思考如何通过巧妙安排样本来最大程度地减少技术变异对生物学结论的干扰。通过选择一个最优的平衡设计，你将亲身体会到良好的实验设计是如何解开生物学效应和批次效应之间的混杂，从而确保后续数据分析的有效性和可靠性 [@problem_id:1418479]。", "problem": "一个系统生物学研究小组正在进行一项蛋白质组学研究，以鉴定癌组织和健康组织之间的蛋白质表达差异。他们收集了20个肿瘤样本（T）和20个健康对照样本（C）。分析将使用质谱仪进行，样本被加载到24孔板上进行处理。由于总共有40个样本，实验必须分两个独立的批次进行，使用两个24孔板（板1和板2）。\n\n众所周知，不同批次之间可能会出现非生物性的系统性变异（例如，由于仪器校准或试剂制备在不同日期的微小差异）。这被称为“批次效应”。如果无法将感兴趣的生物学效应（癌症 vs. 健康）与技术性的批次效应区分开来，则称该实验设计是“混杂的”(confounded)。\n\n在将40个样本分配到两个24孔板的以下实验设计中，哪一种最能减少处理效应（T vs. C）和批次效应（板1 vs. 板2）之间的混杂？\n\nA. 将所有20个肿瘤样本（T）放在板1上，所有20个健康对照样本（C）放在板2上。\n\nB. 将40个样本完全随机地分配到两个板上的48个可用孔中，随机留下8个空孔。\n\nC. 在板1上放置10个肿瘤样本（T）和10个健康对照样本（C）。将其余的10个肿瘤样本（T）和10个健康对照样本（C）放在板2上。每个板上留下4个空孔。\n\nD. 将板1完全填满，放置12个肿瘤样本（T）和12个健康对照样本（C）。将其余的8个肿瘤样本（T）和8个健康对照样本（C）放在板2上。", "solution": "我们使用线性模型和设计列的正交性来形式化生物学处理（肿瘤 vs. 对照）和技术批次（板1 vs. 板2）之间的混杂概念。\n\n假设有 $N=40$ 个样本。对于样本 $i$，定义：\n- 处理指标 $x_{i}=1$（如果为肿瘤样本T），$x_{i}=0$（如果为对照样本C），\n- 批次指标 $z_{i}=1$（如果在板1上），$z_{i}=0$（如果在板2上）。\n\n在线性模型 $y_{i}=\\mu+\\tau x_{i}+\\beta z_{i}+\\epsilon_{i}$ 中，如果 $x$ 和 $z$ 的设计列不正交，则处理和批次之间存在混杂。一个实用的诊断方法是计算 $x$ 和 $z$ 之间的样本协方差：\n$$\n\\operatorname{Cov}(x,z)\\ \\propto\\ \\bar{xz}-\\bar{x}\\,\\bar{z},\n$$\n其中 $\\bar{x}$、$\\bar{z}$ 和 $\\bar{xz}$ 分别是 $x$、$z$ 和 $xz$ 的样本均值。没有混杂对应于 $\\bar{xz}=\\bar{x}\\,\\bar{z}$，即设计中处理和批次的正交性。用计数来表示，令 $n$ 表示总样本数，$n_{1}$ 表示板1上的样本数，$t_{1}$ 表示板1上的肿瘤样本数，我们有\n$$\n\\bar{x}=\\frac{20}{40}=\\frac{1}{2},\\quad \\bar{z}=\\frac{n_{1}}{40},\\quad \\bar{xz}=\\frac{t_{1}}{40}.\n$$\n因此，正交性等价于\n$$\n\\frac{t_{1}}{40}=\\frac{1}{2}\\cdot\\frac{n_{1}}{40}\\quad\\Longleftrightarrow\\quad t_{1}=\\frac{n_{1}}{2},\n$$\n这意味着每个板上肿瘤和对照的比例应与整个研究的比例相同，即一半是肿瘤，一半是对照。\n\n我们现在评估每个选项。\n\nA. 所有肿瘤样本在板1上，所有对照样本在板2上。这里 $n_{1}=20$ 且 $t_{1}=20$，因此\n$$\n\\bar{xz}=\\frac{20}{40}=\\frac{1}{2},\\quad \\bar{x}\\bar{z}=\\frac{1}{2}\\cdot\\frac{20}{40}=\\frac{1}{4},\n$$\n因此 $\\bar{xz}-\\bar{x}\\bar{z}\\neq 0$。这是完全混杂。\n\nB. 完全随机分配到48个孔中，随机留8个空孔。虽然每个板上肿瘤样本的期望比例等于总体比例，但随机化不能保证在实际分配中 $t_{1}=n_{1}/2$。因此 $\\bar{xz}-\\bar{x}\\bar{z}$ 不必为零，混杂可能会偶然发生。当存在确定性的平衡分配方案时，这不是最优的。\n\nC. 在板1上放置10个肿瘤和10个对照样本，在板2上放置10个肿瘤和10个对照样本，每个板有4个空孔。这里 $n_{1}=20$ 且 $t_{1}=10$，因此\n$$\n\\bar{xz}=\\frac{10}{40}=\\frac{1}{4},\\quad \\bar{x}\\bar{z}=\\frac{1}{2}\\cdot\\frac{20}{40}=\\frac{1}{4},\n$$\n因此 $\\bar{xz}-\\bar{x}\\bar{z}=0$。处理和批次是正交的，所以没有混杂。此外，批次大小相等，这提高了校正后处理效应估计的精度。\n\nD. 将板1填满，放置12个肿瘤和12个对照样本，将其余8个肿瘤和8个对照样本放在板2上。这里 $n_{1}=24$ 且 $t_{1}=12$，因此\n$$\n\\bar{xz}=\\frac{12}{40}=\\frac{3}{10},\\quad \\bar{x}\\bar{z}=\\frac{1}{2}\\cdot\\frac{24}{40}=\\frac{3}{10},\n$$\n因此 $\\bar{xz}-\\bar{x}\\bar{z}=0$。处理和批次也是正交的，所以没有混杂。然而，在估计经批次校正的处理效应时，与每批数量相等的设计相比，不相等的批次大小会降低效率。\n\n在提供的选项中，C和D都通过确保每个板内肿瘤与对照的比例相等来消除混杂。在这两者之间，C是最优的，因为它还平衡了每个板上的总样本数，这能产生更高效的估计，并防止与处理无关的板级差异，同时保持零混杂。", "answer": "$$\\boxed{C}$$", "id": "1418479"}, {"introduction": "尽管良好的设计至关重要，但在实际研究中，批次效应有时仍不可避免。这个练习将引导你动手处理一个已经存在批次效应的简化数据集，运用一种基础而直观的校正方法——基因水平的均值中心化。通过具体的计算，你将揭开批次校正算法的神秘面纱，理解其如何通过简单的数学调整来对齐不同批次间的数据，为更复杂的算法学习打下坚实基础 [@problem_id:1418467]。", "problem": "在一项旨在分析癌细胞对一种新药的转录反应的系统生物学实验中，研究人员收集了基因表达数据。由于后勤限制，实验分两个独立的批次进行。数据采集后，研究人员怀疑存在显著的批次效应，即测量平台的校准在两次运行之间存在差异。\n\n下表是两个基因 G1 和 G2 在六个细胞样本中的原始、无单位的基因表达值。样本 S1、S2 和 S3 属于批次 1，而样本 S4、S5 和 S6 属于批次 2。\n\n| | S1 | S2 | S3 | S4 | S5 | S6 |\n| :---- | :- | :- | :- | :- | :- | :- |\n| **G1**| 5 | 7 | 9 | 12 | 15 | 18 |\n| **G2**| 22 | 30 | 26 | 35 | 41 | 38 |\n\n为了校正批次效应，研究人员决定采用基因层面的均值调整方法。这种校正方法对每个基因的数据进行单独调整，使得校正后，每个批次内的平均表达值等于该基因在所有样本中的总体平均表达值。\n\n计算完整的校正后数据矩阵，基因作为行，样本作为列。以一个 2x6 矩阵的形式呈现你的最终答案。", "solution": "目标是调整每个基因的表达数据，使得每个批次内的数值均值等于该基因在所有样本中的总体均值。我们将对每个基因 G1 和 G2 分别独立进行此校正。\n\n设 $x_{g,s}$ 为基因 $g$ 在样本 $s$ 中的表达值。批次 $b$ 中样本的调整后值 $x'_{g,s}$ 由以下公式给出：\n$$x'_{g,s} = x_{g,s} + (\\text{Mean}_{g,\\text{overall}} - \\text{Mean}_{g,b})$$\n其中 $\\text{Mean}_{g,b}$ 是基因 $g$ 在批次 $b$ 中的平均表达量，而 $\\text{Mean}_{g,\\text{overall}}$ 是基因 $g$ 在所有样本中的平均表达量。\n\n**步骤 1：基因 G1 的校正**\n\n首先，我们计算基因 G1 所需的均值。\nG1 在批次 1 中的样本为 {5, 7, 9}。批次 1 的均值为：\n$$ \\text{Mean}_{\\text{G1, Batch 1}} = \\frac{5 + 7 + 9}{3} = \\frac{21}{3} = 7 $$\nG1 在批次 2 中的样本为 {12, 15, 18}。批次 2 的均值为：\n$$ \\text{Mean}_{\\text{G1, Batch 2}} = \\frac{12 + 15 + 18}{3} = \\frac{45}{3} = 15 $$\nG1 在所有六个样本中的总体均值为：\n$$ \\text{Mean}_{\\text{G1, overall}} = \\frac{5 + 7 + 9 + 12 + 15 + 18}{6} = \\frac{66}{6} = 11 $$\n现在，我们计算每个批次的调整因子。\n对于批次 1，调整因子为：\n$$ \\Delta_1 = \\text{Mean}_{\\text{G1, overall}} - \\text{Mean}_{\\text{G1, Batch 1}} = 11 - 7 = +4 $$\n对于批次 2，调整因子为：\n$$ \\Delta_2 = \\text{Mean}_{\\text{G1, overall}} - \\text{Mean}_{\\text{G1, Batch 2}} = 11 - 15 = -4 $$\n我们将这些调整应用于原始的 G1 数据。\n对于批次 1 (S1, S2, S3)：\n$$ x'_{\\text{G1,S1}} = 5 + 4 = 9 $$\n$$ x'_{\\text{G1,S2}} = 7 + 4 = 11 $$\n$$ x'_{\\text{G1,S3}} = 9 + 4 = 13 $$\n对于批次 2 (S4, S5, S6)：\n$$ x'_{\\text{G1,S4}} = 12 - 4 = 8 $$\n$$ x'_{\\text{G1,S5}} = 15 - 4 = 11 $$\n$$ x'_{\\text{G1,S6}} = 18 - 4 = 14 $$\nG1 的校正后表达行向量为 [9, 11, 13, 8, 11, 14]。\n\n**步骤 2：基因 G2 的校正**\n\n接下来，我们对基因 G2 重复此过程。\nG2 在批次 1 中的样本为 {22, 30, 26}。批次 1 的均值为：\n$$ \\text{Mean}_{\\text{G2, Batch 1}} = \\frac{22 + 30 + 26}{3} = \\frac{78}{3} = 26 $$\nG2 在批次 2 中的样本为 {35, 41, 38}。批次 2 的均值为：\n$$ \\text{Mean}_{\\text{G2, Batch 2}} = \\frac{35 + 41 + 38}{3} = \\frac{114}{3} = 38 $$\nG2 在所有六个样本中的总体均值为：\n$$ \\text{Mean}_{\\text{G2, overall}} = \\frac{22 + 30 + 26 + 35 + 41 + 38}{6} = \\frac{192}{6} = 32 $$\n现在，我们计算 G2 每个批次的调整因子。\n对于批次 1，调整因子为：\n$$ \\Delta_1 = \\text{Mean}_{\\text{G2, overall}} - \\text{Mean}_{\\text{G2, Batch 1}} = 32 - 26 = +6 $$\n对于批次 2，调整因子为：\n$$ \\Delta_2 = \\text{Mean}_{\\text{G2, overall}} - \\text{Mean}_{\\text{G2, Batch 2}} = 32 - 38 = -6 $$\n我们将这些调整应用于原始的 G2 数据。\n对于批次 1 (S1, S2, S3)：\n$$ x'_{\\text{G2,S1}} = 22 + 6 = 28 $$\n$$ x'_{\\text{G2,S2}} = 30 + 6 = 36 $$\n$$ x'_{\\text{G2,S3}} = 26 + 6 = 32 $$\n对于批次 2 (S4, S5, S6)：\n$$ x'_{\\text{G2,S4}} = 35 - 6 = 29 $$\n$$ x'_{\\text{G2,S5}} = 41 - 6 = 35 $$\n$$ x'_{\\text{G2,S6}} = 38 - 6 = 32 $$\nG2 的校正后表达行向量为 [28, 36, 32, 29, 35, 32]。\n\n**步骤 3：组合最终矩阵**\n\n我们现在按要求将 G1 和 G2 的校正后行向量组合成一个最终的 2x6 矩阵。第一行对应 G1，第二行对应 G2。\n$$\n\\text{Corrected Matrix} = \\begin{pmatrix}\n9  11  13  8  11  14 \\\\\n28  36  32  29  35  32\n\\end{pmatrix}\n$$", "answer": "$$\\boxed{\\begin{pmatrix} 9  11  13  8  11  14 \\\\ 28  36  32  29  35  32 \\end{pmatrix}}$$", "id": "1418467"}, {"introduction": "应用了校正算法后，我们必须提出一个关键问题：“校正是否成功，有没有矫枉过正？”。本练习聚焦于批次校正后的关键验证步骤，探讨如何确保在消除技术噪音的同时，没有意外地抹去我们真正关心的生物学信号。你将学习利用先验知识（如管家基因和已知的生物标志物）进行视觉检查，这是一种在系统生物学研究中至关重要的质量控制技能 [@problem_id:1418485]。", "problem": "一位系统生物学研究者正在进行一项转录组学研究，以比较一个患者队列中肿瘤样本与邻近健康组织样本的基因表达谱。由于样本数量众多，核糖核酸（RNA）的提取和测序分两个独立的实验批次进行。研究者怀疑这引入了“批次效应”——一种混淆数据的系统性非生物学变异。\n\n为了解决这个问题，研究者对基因表达数据应用了一种计算批次校正算法。然而，存在一个担忧，即该算法可能矫枉过正，不仅去除了不必要的技术变异，还可能去除了肿瘤和健康组织之间真实的生物学差异。研究者希望进行一次简单的、非统计性的可视化检查，以确保有意义的生物学信号在校正后得以保留。\n\n为此，研究者从先前的文献中确定了两组基因：\n1.  **看家基因（Housekeeping Genes）**：一组已知在大多数细胞类型和条件下（包括肿瘤和健康组织）具有稳定表达水平的基因。\n2.  **已知癌症生物标志物（Known Cancer Biomarkers）**：一组已知在这种特定类型的肿瘤和健康组织之间显著差异表达的基因。\n\n以下哪种方法是确认批次校正过程中保留了目标生物学信号的最合适的可视化检查？\n\nA. 为所有样本生成所有基因的热图，并目视检查两个批次是否形成不同的簇。如果不形成，则生物学信号被保留。\n\nB. 在校正后的数据上使用像主成分分析（PCA）这样的降维技术。将样本绘制在前两个主成分上，并按其生物学分组（肿瘤 vs. 健康）为点着色。如果这些组别显示出明显的分离，则生物学信号被保留。\n\nC. 对于一些选定的看家基因和一些选定的已知癌症生物标志物，绘制它们在每个样本中的表达水平。一个保留了生物学信号的成功校正，应该显示看家基因在所有样本中表达水平相似，而已知癌症生物标志物在肿瘤组和健康组之间仍然显示出明显的表达水平差异，无论其原始批次如何。\n\nD. 对于每个基因，计算其在肿瘤组和健康组内的平均表达量。将这些平均值相互绘制（肿瘤平均值 vs. 健康平均值）。如果这些点在 y=x 线周围形成一个云团，则校正不成功。如果它们显著偏离，则生物学信号被保留。", "solution": "目标是验证批次校正是否在去除与批次相关的非生物学变异的同时，保留了肿瘤和健康组织之间真实的生物学差异。一个非统计性的可视化检查应利用先前的生物学知识，并直接评估两个标准：\n1) 预期在各种条件下（如看家基因）表达不变的基因的表达稳定性。\n2) 作为肿瘤类型生物标志物的基因的已知差异表达的保留情况。\n\n根据这些标准评估每种提议的方法：\n\n- 选项A关注的是批次是否在所有基因的热图中形成簇。虽然批次聚类的缺乏表明批次效应有所减少，但这并不能说明肿瘤与健康组织之间的生物学信号是否被保留。此外，使用所有基因会稀释检查的效果，因为许多基因与生物学对比无关。\n\n- 选项B使用PCA，并按肿瘤与健康为样本着色。这是一种常见的探索性可视化方法，但它是间接的：即使肿瘤-健康对比被保留下来，主导的主成分也可能无法捕捉到它，而且分离情况可能会受到残留混杂因素的影响。尽管已知稳定基因和已知生物标志物是可用的，并且对于此目的信息最丰富，但该方法并未明确测试它们的行为。\n\n- 选项C直接绘制选定的看家基因和已知癌症生物标志物在所有样本中的表达。一次成功的校正应使得看家基因在所有样本中表达水平相似（表明技术变异已被去除），而已知的生物标志物在不同批次中仍然在肿瘤和健康组织之间显示出明显的表达差异（表明生物学信号得以保留）。这是一种有针对性的、非统计性的可视化验证，它使用的先前生物学知识与目标精确一致。\n\n- 选项D比较每个基因在肿瘤组和健康组的平均值，并将靠近$y=x$线解释为校正不成功。这个逻辑是有缺陷的，因为大多数基因并非差异表达基因，即使在校正成功的情况下，它们也应该位于 $y=x$ 线附近。它也忽略了批次因素，并且没有利用精选的基因集。\n\n因此，考虑到既定目标以及看家基因集和生物标志物基因集的可用性，最合适的可视化检查是使用有针对性的图表，以证明看家基因表达的稳定性以及已知生物标志物差异表达在不同批次间的保留情况，这在选项C中有所描述。", "answer": "$$\\boxed{C}$$", "id": "1418485"}]}