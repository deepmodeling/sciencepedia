{"hands_on_practices": [{"introduction": "在单细胞RNA测序（scRNA-seq）分析中，一个关键的初始步骤是降维，而主成分分析（PCA）是其中最常用的技术。选择合适数量的主成分（PCs）至关重要，因为它直接影响后续的细胞聚类和生物学解读。这个练习旨在通过一个简化的数学模型，让你亲手计算并理解如何在保留真实生物学信号和避免引入技术噪声之间做出权衡，这是所有scRNA-seq分析师都必须掌握的核心技能。 [@problem_id:2268292]", "problem": "一位免疫学家正在分析一项单细胞RNA测序（scRNA-seq）实验的数据，该实验旨在表征肿瘤微环境中的免疫细胞图景。分析的第一步是主成分分析（PCA），这是一种降维技术，用于识别高维基因表达数据中的主要变异轴。\n\n提出了一个简化模型来描述每个主成分（PC）所捕获的方差。第 $i$ 个PC的总方差 $V_i$ 由生物信号分量 $S_i$ 和随机噪声分量 $N_i$ 组成，因此 $V_i = S_i + N_i$。\n\n信号方差源于细胞类型之间的真实生物学差异（例如，T细胞与不同巨噬细胞亚型之间的差异），被建模为随连续的PC呈指数衰减：\n$$S_i = A \\exp(-\\alpha (i-1)) \\quad \\text{for } i \\ge 1$$\n噪声方差源于技术性伪迹和随机基因表达，被假设为对每个PC贡献一个恒定的量：\n$$N_i = N_0$$\n从数据中推导出的该模型参数为：$A = 100$（任意方差单位），$\\alpha = 0.5$ 和 $N_0 = 5$。\n\n为了选择用于下游聚类的最佳PC数量，采用了一种两步策略，以在捕获足够生物信号和引入过多噪声之间取得平衡。\n1.  确定“肘点” $k_{elbow}$，定义为信号方差小于噪声方差（$S_k  N_k$）的最小整数 $k$。使用超过此点的PC被认为主要增加噪声。\n2.  确定捕获所有可能PC中*总*生物信号至少 $f_S = 0.99$ 比例所需的最小PC数量 $k_{signal}$。\n\n用于分析的最终PC数量 $k_{final}$ 被选为这两个值的最大值，即 $k_{final} = \\max(k_{elbow}, k_{signal})$，以确保两个标准都得到满足。\n\n计算 $k_{final}$ 的整数值。", "solution": "该问题要求我们计算用于下游分析的最终主成分数量 $k_{final}$，它被定义为 $k_{elbow}$ 和 $k_{signal}$ 的最大值。\n\n**步骤 1：计算“肘点” $k_{elbow}$**\n\n$k_{elbow}$ 是满足信号方差小于噪声方差 ($S_k  N_k$) 的最小整数 $k$。\n给定的模型是：\n$S_k = A \\exp(-\\alpha (k-1))$，其中 $A=100$, $\\alpha=0.5$。\n$N_k = N_0 = 5$。\n\n我们设置不等式 $S_k  N_k$：\n$$100 \\exp(-0.5(k-1))  5$$\n$$\\exp(-0.5(k-1))  \\frac{5}{100} = 0.05$$\n对两边取自然对数：\n$$-0.5(k-1)  \\ln(0.05) \\approx -2.9957$$\n将不等式两边乘以 -1（并反转不等号）：\n$$0.5(k-1) > 2.9957$$\n$$k-1 > \\frac{2.9957}{0.5} \\approx 5.9914$$\n$$k > 6.9914$$\n因此，满足此条件的最小整数 $k$ 是 7。所以，$k_{elbow} = 7$。\n\n**步骤 2：计算捕获足够信号所需的PC数量 $k_{signal}$**\n\n$k_{signal}$ 是捕获总生物信号至少 $f_S = 0.99$ 比例所需的最小PC数量。\n首先，计算总生物信号 $S_{total}$，它是所有PC的信号方差之和：\n$$S_{total} = \\sum_{i=1}^{\\infty} S_i = \\sum_{j=0}^{\\infty} 100 \\exp(-0.5j) \\quad (\\text{令 } j=i-1)$$\n这是一个首项为 $a=100$、公比为 $r=\\exp(-0.5) \\approx 0.6065$ 的几何级数。其总和为：\n$$S_{total} = \\frac{a}{1-r} = \\frac{100}{1 - \\exp(-0.5)}$$\n前 $k$ 个PC的累积信号为：\n$$\\sum_{i=1}^{k} S_i = \\sum_{j=0}^{k-1} 100 \\exp(-0.5j) = 100 \\frac{1 - (\\exp(-0.5))^k}{1 - \\exp(-0.5)}$$\n我们需要找到满足以下条件的最小整数 $k$：\n$$\\frac{\\sum_{i=1}^{k} S_i}{S_{total}} \\ge 0.99$$\n$$1 - (\\exp(-0.5))^k \\ge 0.99$$\n$$(\\exp(-0.5))^k \\le 0.01$$\n对两边取自然对数：\n$$-0.5k \\le \\ln(0.01) \\approx -4.6052$$\n将不等式两边乘以 -1（并反转不等号）：\n$$0.5k \\ge 4.6052$$\n$$k \\ge \\frac{4.6052}{0.5} \\approx 9.2104$$\n因此，满足此条件的最小整数 $k$ 是 10。所以，$k_{signal} = 10$。\n\n**步骤 3：确定最终的PC数量 $k_{final}$**\n\n最终的PC数量是 $k_{elbow}$ 和 $k_{signal}$ 中的较大值：\n$$k_{final} = \\max(k_{elbow}, k_{signal}) = \\max(7, 10) = 10$$\n因此，用于分析的最终PC数量为10。", "answer": "$$\\boxed{10}$$", "id": "2268292"}, {"introduction": "成功将细胞分群后，下一步是解读这些细胞群的生物学意义。小提琴图（Violin plot）是一种直观展示基因在不同细胞群中表达分布的强大工具。通过这个练习，你将学习如何解读小提琴图的形状、宽度和中位数，从而推断不同巨噬细胞亚群的异质性和功能状态，这是从复杂数据中提取生物学见解的关键一步。 [@problem_id:2268290]", "problem": "一个免疫学家团队正在使用单细胞RNA测序（scRNA-seq）技术研究巨噬细胞的活化，该技术可以测量成千上万个单个细胞中的基因表达水平。在处理数据后，他们识别出了三个不同的巨噬细胞簇，并将其标记为簇A、簇B和簇C。然后，他们生成了小提琴图，以可视化每个簇内肿瘤坏死因子（*TNF*）基因的表达情况，TNF是一种强效的促炎细胞因子。\n\n小提琴图是一种绘制数值数据的方法。“小提琴”的形状表示数据在不同数值上的概率密度，较宽的部分表示在该表达水平上具有更高频率的细胞。内部的点或线通常标记了该簇的中位表达量。\n\n研究人员观察到 *TNF* 基因表达小提琴图具有以下特征：\n\n*   **簇A：**该图宽阔且呈明显的双峰分布，即有两个峰。一个峰接近于零表达，第二个明显的峰处于高表达水平。中位表达量为中等。\n*   **簇B：**该图非常狭窄，并集中在高表达水平。该簇中绝大多数细胞都表现出相似的高水平 *TNF* 表达。\n*   **簇C：**该图宽阔且向零表达严重偏斜。大多数细胞几乎不表达 *TNF*，但有一条长“尾巴”，包含了表达水平逐渐升高的细胞。中位表达量非常低。\n\n根据对 *TNF* 表达小提琴图的这些描述，以下哪个陈述提供了最准确的生物学解释？\n\nA. 簇C代表了最强的促炎巨噬细胞群体，因为其小提琴图最宽，表明反应具有多样性。\n\nB. 簇A中的细胞对促炎刺激作出了一致且强烈的反应，其 *TNF* 中位表达量为中等水平即可表明这一点。\n\nC. 簇B代表一个高度同质的巨噬细胞群体，正在产生强烈且一致的促炎反应，而簇A包含一个异质性群体，其中有一个强烈反应的细胞亚群。\n\nD. 簇C中所有细胞产生的TNF蛋白总量可能大于簇B产生的总量，因为簇C的分布覆盖了更宽的表达值范围。", "solution": "小提琴图的解释原则：在给定表达值 $x$ 处的宽度反映了在该表达水平上细胞的概率密度 $p(x)$；多个峰表示多峰性；中位数概括了集中趋势；偏度表示长尾的方向。对于通过TNF进行促炎反应的生物学解释，大量细胞的高表达表示更强且更一致的活化，而异质性表示混合了有反应和无反应的亚群。\n\n对于簇A，小提琴图宽阔且呈双峰分布，一个峰接近零，另一个峰在高表达处，中位数为中等。设 $p_{A}(x)$ 表示表达分布。两个峰，一个接近 $x \\approx 0$，另一个在较高的 $x$ 处，这意味著这是一个混合模型，包含一个无反应或低反应的亚群和一个强反应的亚群。中等的中位数是因为累积分布函数在两个峰之间穿过 $0.5$，而不是因为大多数细胞处于中等水平。因此，簇A是异质的，而不是一致地强烈反应。\n\n对于簇B，小提琴图非常狭窄，并集中在高表达水平。设 $p_{B}(x)$ 紧密集中在一个大均值 $\\mu_{B}$ 和中位数 $m_{B}$ 周围，方差很小，且均值和中位数都很高。这表明几乎所有细胞都具有相似的高TNF表达；从生物学上讲，这是一个正在产生强烈、一致的促炎反应的同质群体。\n\n对于簇C，小提琴图宽阔且严重偏向零，有一个长的右尾和一个非常低的中位数。设 $p_{C}(x)$ 的权重主要集中在 $x \\approx 0$ 附近，并向更大的 $x$ 值延伸出一条长尾。低中位数 $m_{C}$ 和接近零的高密度意味着大多数细胞几乎不表达TNF，只有少数细胞表现出逐渐升高的水平。这表明主要是弱反应或无反应，带有一个小的更高反应者亚群；变异性（宽度）反映了异质性，而不是效力。\n\n评估选项：\n- 选项A声称簇C是最强的，因为其小提琴图最宽。这混淆了变异性与效力。鉴于 $m_{C}$ 非常低且大部分密度接近于零，簇C并非最强；宽度反映的是异质性和长尾，而不是强烈的整体活化。因此A是错误的。\n- 选项B声称基于中等的中位数，簇A是一致且强烈反应的。$p_{A}(x)$ 的双峰性以及一个接近零的峰与一致的强烈反应相矛盾；中等的中位数是混合了低表达和高表达亚群的结果。因此B是错误的。\n- 选项C指出，簇B是一个高度同质、强烈反应的群体，而簇A是一个异质群体，其中有一个强烈反应的细胞亚群。这与狭窄、集中在高位的 $p_{B}(x)$ 以及具有高表达亚群的双峰 $p_{A}(x)$ 相符。因此C是正确的。\n- 选项D声称簇C产生的TNF总量可能超过簇B，因为簇C的分布跨越了更宽的范围。总产量与总和（或平均值 $\\mu$ 乘以细胞数）成正比，而不是与范围或宽度成正比。鉴于簇B中绝大多数细胞具有高表达（大的 $\\mu_{B}$），而簇C中大多数细胞接近于零（尽管有尾部，但 $\\mu_{C}$ 仍然很小），没有证据支持簇C会产生更多的总TNF；通过范围来论证是有缺陷的。因此D是错误的。\n\n因此，最准确的解释是，簇B是具有强烈、一致反应的同质群体，而簇A是具有一个强烈反应细胞亚群的异质群体。", "answer": "$$\\boxed{C}$$", "id": "2268290"}, {"introduction": "为了超越单个基因的分析，研究人员经常计算“模块评分”（module score）来量化一个细胞中特定生物学通路或功能的活性。这种方法将一组相关基因的表达水平整合为一个综合指标。本练习将指导你计算一个“细胞毒性评分”，这是一个具体的模块评分实例，用于量化和比较不同CD8+ T细胞群的杀伤潜能，从而将基因表达数据与细胞功能直接联系起来。 [@problem_id:2268244]", "problem": "一位免疫学家正在分析来自肿瘤浸润淋巴细胞 (TILs) 的单细胞RNA测序 (scRNA-seq) 数据集，以了解细胞毒性T细胞的功能状态。经过初步处理和使用均匀流形逼近与投影 (UMAP) 进行降维后，鉴定出了两个不同的CD8+ T细胞簇，分别记为簇 A和簇 B。为了定量比较它们的细胞毒性潜力，我们根据关键基因的表达情况为每个细胞计算了一个“细胞毒性评分”($S_{\\text{cyto}}$)。\n\n该评分定义为效应基因集 ($G_{\\text{eff}}$) 的平均表达量与对照基因集 ($G_{\\text{ctrl}}$) 的平均表达量之差。计算公式为：\n$$S_{\\text{cyto}} = \\left( \\frac{1}{N_{\\text{eff}}} \\sum_{i \\in G_{\\text{eff}}} E_i \\right) - \\left( \\frac{1}{N_{\\text{ctrl}}} \\sum_{j \\in G_{\\text{ctrl}}} E_j \\right)$$\n其中，$E_k$ 是基因 $k$ 的对数归一化表达值，$N_{\\text{eff}}$ 是效应基因集中的基因数量，$N_{\\text{ctrl}}$ 是对照基因集中的基因数量。表达值和最终的评分都是无量纲的。\n\n基因集定义如下：\n- 效应基因集，$G_{\\text{eff}} = \\{\\text{GZMB, PRF1, IFNG}\\}$\n- 对照基因集，$G_{\\text{ctrl}} = \\{\\text{ACTB, GAPDH}\\}$\n\n以下是每个簇中三个代表性细胞的对数归一化表达值：\n\n**簇 A：**\n- 细胞 A1: GZMB = 4.5, PRF1 = 5.0, IFNG = 3.1, ACTB = 2.1, GAPDH = 2.3\n- 细胞 A2: GZMB = 4.8, PRF1 = 4.7, IFNG = 3.5, ACTB = 2.0, GAPDH = 2.2\n- 细胞 A3: GZMB = 4.2, PRF1 = 5.3, IFNG = 3.3, ACTB = 2.2, GAPDH = 2.4\n\n**簇 B：**\n- 细胞 B1: GZMB = 1.2, PRF1 = 1.5, IFNG = 0.8, ACTB = 2.3, GAPDH = 2.5\n- 细胞 B2: GZMB = 0.9, PRF1 = 1.3, IFNG = 0.5, ACTB = 2.1, GAPDH = 2.1\n- 细胞 B3: GZMB = 1.4, PRF1 = 1.1, IFNG = 1.0, ACTB = 2.2, GAPDH = 2.4\n\n你的任务是计算簇 A 的平均细胞毒性评分 ($\\bar{S}_A$) 和簇 B 的平均细胞毒性评分 ($\\bar{S}_B$) 。然后，确定簇 A 的平均评分与簇 B 的平均评分之比。\n\n将比率 $\\frac{\\bar{S}_A}{\\bar{S}_B}$ 的最终答案表示为一个数值，并四舍五入到三位有效数字。", "solution": "我们将每个细胞的细胞毒性评分定义为\n$$S_{\\text{cyto}}=\\left(\\frac{1}{N_{\\text{eff}}}\\sum_{i\\in G_{\\text{eff}}}E_{i}\\right)-\\left(\\frac{1}{N_{\\text{ctrl}}}\\sum_{j\\in G_{\\text{ctrl}}}E_{j}\\right),$$\n其中 $N_{\\text{eff}}=3$ 且 $N_{\\text{ctrl}}=2$。\n\n对于簇 A：\n- 细胞 A1：\n$$S_{\\text{cyto}}(\\text{A1})=\\left(\\frac{4.5+5.0+3.1}{3}\\right)-\\left(\\frac{2.1+2.3}{2}\\right)=\\left(\\frac{12.6}{3}\\right)-\\left(\\frac{4.4}{2}\\right)=4.2-2.2=2.0.$$\n- 细胞 A2：\n$$S_{\\text{cyto}}(\\text{A2})=\\left(\\frac{4.8+4.7+3.5}{3}\\right)-\\left(\\frac{2.0+2.2}{2}\\right)=\\left(\\frac{13.0}{3}\\right)-\\left(\\frac{4.2}{2}\\right)=\\frac{13}{3}-2.1=\\frac{67}{30}\\approx 2.233\\ldots.$$\n- 细胞 A3：\n$$S_{\\text{cyto}}(\\text{A3})=\\left(\\frac{4.2+5.3+3.3}{3}\\right)-\\left(\\frac{2.2+2.4}{2}\\right)=\\left(\\frac{12.8}{3}\\right)-\\left(\\frac{4.6}{2}\\right)=\\frac{64}{15}-2.3=\\frac{59}{30}\\approx 1.966\\ldots.$$\n簇 A 的平均值：\n$$\\bar{S}_{A}=\\frac{2.0+\\frac{67}{30}+\\frac{59}{30}}{3}=\\frac{\\frac{60}{30}+\\frac{67}{30}+\\frac{59}{30}}{3}=\\frac{\\frac{186}{30}}{3}=\\frac{31}{15}\\approx 2.066\\ldots.$$\n\n对于簇 B：\n- 细胞 B1：\n$$S_{\\text{cyto}}(\\text{B1})=\\left(\\frac{1.2+1.5+0.8}{3}\\right)-\\left(\\frac{2.3+2.5}{2}\\right)=\\left(\\frac{3.5}{3}\\right)-2.4=\\frac{7}{6}-\\frac{12}{5}=-\\frac{37}{30}\\approx -1.233\\ldots.$$\n- 细胞 B2：\n$$S_{\\text{cyto}}(\\text{B2})=\\left(\\frac{0.9+1.3+0.5}{3}\\right)-\\left(\\frac{2.1+2.1}{2}\\right)=0.9-2.1=-1.2=-\\frac{6}{5}.$$\n- 细胞 B3：\n$$S_{\\text{cyto}}(\\text{B3})=\\left(\\frac{1.4+1.1+1.0}{3}\\right)-\\left(\\frac{2.2+2.4}{2}\\right)=\\left(\\frac{3.5}{3}\\right)-2.3=\\frac{7}{6}-\\frac{23}{10}=-\\frac{17}{15}\\approx -1.133\\ldots.$$\n簇 B 的平均值：\n$$\\bar{S}_{B}=\\frac{-\\frac{37}{30}-\\frac{6}{5}-\\frac{17}{15}}{3}=\\frac{-\\frac{37}{30}-\\frac{36}{30}-\\frac{34}{30}}{3}=\\frac{-\\frac{107}{30}}{3}=-\\frac{107}{90}\\approx -1.188\\ldots.$$\n\n平均值的比率为\n$$\\frac{\\bar{S}_{A}}{\\bar{S}_{B}}=\\frac{\\frac{31}{15}}{-\\frac{107}{90}}=-\\frac{31}{15}\\cdot\\frac{90}{107}=-\\frac{186}{107}\\approx -1.738317\\ldots.$$\n四舍五入到三位有效数字，比率为 $-1.74$。", "answer": "$$\\boxed{-1.74}$$", "id": "2268244"}]}