{"hands_on_practices": [{"introduction": "在用于研究湍流的 $\\delta f$ 模拟方法中，我们只追踪分布函数相对于已知平衡态 $f_0$ 的微小偏离 $\\delta f$。这种方法的关键在于为代表背景分布的标记粒子赋予一个“权重”$w = \\delta f / f_0$。本练习 [@problem_id:264074] 将引导你完成一个至关重要的初始步骤：如何正确设置初始粒子权重，以构建一个纯粹的温度微扰，同时确保不引入任何非物理的密度微扰。", "problem": "在用于等离子体模拟的 delta-f ($\\delta f$) 粒子模拟 (PIC) 方法中，总分布函数 $f$ 被分解为一个较大的静态背景部分 $f_0$ 和一个较小的演化微扰 $\\delta f$，使得 $f = f_0 + \\delta f$。该模拟追踪标记粒子的演化，这些粒子根据背景分布 $f_0$ 对相空间进行采样。每个标记为 $p$ 的粒子被赋予一个权重 $w_p$，定义为在该粒子的相空间位置 $\\mathbf{Z}_p$ 处，微扰与背景分布之比：\n$$w_p(t) = \\frac{\\delta f(\\mathbf{Z}_p, t)}{f_0(\\mathbf{Z}_p)}$$\n微扰数密度 $\\delta n$ 是微扰分布函数的一个矩，由其在速度空间上的积分给出：\n$$\\delta n(\\mathbf{x}, t) = \\int \\delta f(\\mathbf{x}, \\mathbf{v}, t) d^3v$$\n考虑一个空间均匀、无磁化的等离子体，其中给定粒子种类的背景分布函数 $f_0$ 是一个三维麦克斯韦分布：\n$$f_0(\\mathbf{v}) = n_0 \\left(\\frac{m}{2\\pi T_0}\\right)^{3/2} \\exp\\left(-\\frac{m|\\mathbf{v}|^2}{2T_0}\\right)$$\n此处，$n_0$ 是平衡数密度，$m$ 是粒子质量，$T_0$ 是以能量为单位的平衡温度。\n\n一个模拟将使用一种特定类型的微扰进行初始化，该微扰对应于纯温度微扰，不带任何相关的密度微扰。为此，模拟粒子的初始权重根据以下依赖于粒子动能的形式进行设置：\n$$w_p = A\\left(\\frac{m v_p^2}{2 T_0} - C\\right)$$\n其中 $v_p=|\\mathbf{v}_p|$ 是粒子 $p$ 的速率，$A$ 是一个任意非零振幅常数，$C$ 是一个无量纲常数。\n\n假设在时间 $t=0$ 时的粒子加载提供了对连续背景分布 $f_0$ 的完美采样，推导为确保初始微扰数密度 $\\delta n$ 在空间各处均为零所需的常数 $C$ 的精确数值。", "solution": "我们要求初始微扰密度\n$$\\delta n \\;=\\;\\int \\delta f\\,d^3v \\;=\\;\\int w(\\mathbf v)\\,f_0(\\mathbf v)\\,d^3v \\;=\\;0.$$\n由于 $w(\\mathbf v)=A\\bigl(\\frac{m v^2}{2T_0}-C\\bigr)$ 且 $A\\neq0$，我们有\n$$\\int\\!f_0\\frac{m v^2}{2T_0}\\,d^3v \\;-\\;C\\int\\!f_0\\,d^3v \\;=\\;0.$$\n计算麦克斯韦分布的矩：\n$$\\int f_0\\,d^3v = n_0,$$\n$$\\int f_0\\,\\frac{m v^2}{2}\\,d^3v = \\frac{3}{2}n_0T_0\n\\quad\\Longrightarrow\\quad\n\\int f_0\\,\\frac{m v^2}{2T_0}\\,d^3v = \\frac{3}{2}n_0.$$\n因此\n$$C = \\frac{\\displaystyle\\int f_0\\,\\frac{m v^2}{2T_0}\\,d^3v}{\\displaystyle\\int f_0\\,d^3v}\n= \\frac{\\frac{3}{2}n_0}{n_0} = \\frac{3}{2}.$$", "answer": "$$\\boxed{\\frac{3}{2}}$$", "id": "264074"}, {"introduction": "在定义了粒子上的微扰表示后，我们必须正确地模拟它们与场的相互作用。回旋动理学理论的一个核心特征是通过“回旋平均”来考虑粒子有限拉莫尔半径效应，这在数值上需要将粒子感受到的电场在其拉莫尔轨道上进行平均。本练习 [@problem_id:263858] 提供了将此抽象算符转化为计算机模拟中具体有限差分格式的实践，这是连接理论与实际代码实现的关键一步。", "problem": "在磁约束等离子体的陀螺动理学模拟中，粒子的有限拉莫尔半径（FLR）效应由陀螺平均算子来描述。在傅里叶空间中，对于一个涨落量 $\\phi$，此操作对应于将其垂直波矢分量 $\\hat{\\phi}(\\mathbf{k}_\\perp)$ 乘以第一类零阶贝塞尔函数 $J_0(k_\\perp \\rho)$，其中 $k_\\perp=|\\mathbf{k}_\\perp|$ 是垂直波数，$\\rho$ 是粒子拉莫尔半径。\n\n为了在空间网格上进行数值实现，该算子必须使用有限差分格式进行近似。考虑一个一维问题，其中物理量仅在 $x$ 方向上变化，因此 $k_\\perp = k_x$。网格具有均匀间距 $\\Delta x$。我们希望构建一个对称的5点有限差分模板来近似陀螺平均算子。该有限差分算子 $\\mathcal{J}_{FD}$ 作用于网格点 $x_i$ 上的场 $\\phi$ 的结果由下式给出：\n$$\n(\\mathcal{J}_{FD}\\phi)_i = c_2 \\phi_{i-2} + c_1 \\phi_{i-1} + c_0 \\phi_i + c_1 \\phi_{i+1} + c_2 \\phi_{i+2}\n$$\n该模板的傅里叶表示（或符号）为：\n$$\n\\widehat{\\mathcal{J}_{FD}}(k_x) = c_0 + 2c_1\\cos(k_x \\Delta x) + 2c_2\\cos(2k_x \\Delta x)\n$$\n为了确定系数 $c_0, c_1, c_2$，我们要求 $\\widehat{\\mathcal{J}_{FD}}(k_x)$ 按 $k_x$ 幂次的泰勒级数展开式与精确算子 $J_0(k_x \\rho)$ 的展开式在 $k_x$ 的四阶项上相匹配。这确保了该格式具有四阶精度。\n\n相关的泰勒级数展开式为：\n$$\nJ_0(z) = 1 - \\frac{z^2}{4} + \\frac{z^4}{64} - \\mathcal{O}(z^6)\n$$\n$$\n\\cos(u) = 1 - \\frac{u^2}{2!} + \\frac{u^4}{4!} - \\mathcal{O}(u^6)\n$$\n令无量纲参数为 $b = \\left(\\frac{\\rho}{\\Delta x}\\right)^2$。\n\n推导该四阶有限差分格式的系数 $c_1$，并将其表示为参数 $b$ 的函数。", "solution": "我们将 \n$$\\widehat{\\mathcal{J}_{FD}}(k_x)=c_0+2c_1\\cos(u)+2c_2\\cos(2u),\\quad u=k_x\\Delta x$$ \n的泰勒展开与 \n$$J_0(k_x\\rho)=1-\\frac{(k_x\\rho)^2}{4}+\\frac{(k_x\\rho)^4}{64}+\\mathcal{O}(k_x^6)$$ \n的泰勒展开进行匹配，其中 $b=(\\rho/\\Delta x)^2$，因此 $k_x\\rho=u\\sqrt b$。\n\n1. 将模板符号按 $u$ 展开至四阶：\n$$\\cos(u)=1-\\frac{u^2}{2}+\\frac{u^4}{24},\\quad\n\\cos(2u)=1-2u^2+\\frac{2u^4}{3}.$$\n因此\n$$\\widehat{\\mathcal{J}_{FD}}=c_0+2c_1\\Bigl(1-\\frac{u^2}{2}+\\frac{u^4}{24}\\Bigr)\n+2c_2\\Bigl(1-2u^2+\\frac{2u^4}{3}\\Bigr)+\\mathcal{O}(u^6).$$\n\n2. 收集各项系数：\n常数项：$c_0+2c_1+2c_2=1.$  \n$u^2$ 项：$-c_1-4c_2=-\\frac b4.$  \n$u^4$ 项：$\\frac{c_1}{12}+\\frac{4c_2}{3}=\\frac{b^2}{64}.$\n\n3. 解此线性方程组。由\n$$c_1+4c_2=\\frac b4,\\quad c_1+16c_2=\\frac{3b^2}{16},$$\n两式相减可得 \n$$12c_2=\\frac{3b^2-4b}{16},\\quad c_2=\\frac{3b^2-4b}{192}.$$\n那么 \n$$c_1=\\frac b4-4c_2=\\frac{12b-(3b^2-4b)}{48}=\\frac{16b-3b^2}{48}.$$", "answer": "$$\\boxed{\\frac{b(16 - 3b)}{48}}$$", "id": "263858"}, {"introduction": "在定义了粒子表示和空间相互作用之后, 模拟的最后一块拼图是精确地随时间推进系统。带电粒子的导心运动具有哈密顿结构，对于需要长期积分的湍流模拟，保持这种结构至关重要。本练习 [@problem_id:263875] 深入探讨了如何构建一个辛积分器，这是一种能够保持运动方程几何结构的高级数值格式，对于确保导心模拟的长期稳定性和物理保真度至关重要。", "problem": "一个质量为 $m$、电荷为 $e$ 的带电粒子在一个静态、空间非均匀的磁场 $\\mathbf{B}(\\mathbf{X}) = B_0(1+\\alpha y) \\mathbf{\\hat{z}}$ 中运动，其中 $B_0$ 和 $\\alpha$ 是正常数，$\\mathbf{X}=(x,y,z)$ 是位置矢量。在导心近似下，粒子的运动由以下哈密顿量控制：\n$$H(\\mathbf{X}, p_{\\|}) = \\frac{p_{\\|}^2}{2m} + \\mu B(\\mathbf{X})$$\n其中 $p_{\\|} = m v_{\\|}$ 是平行于磁场的动量，而磁矩 $\\mu$ 是一个运动常数。导心速度 $\\dot{\\mathbf{X}}$ 和平行方向动量的变化率 $\\dot{p}_{\\|}$ 由非正则哈密顿方程给出：\n$$ \\dot{\\mathbf{X}} = \\frac{\\mathbf{B}^*}{m B_{\\|}^*} \\cdot (\\nabla \\mathbf{X} \\times \\nabla H) + \\frac{B_{\\|}^*}{m} \\frac{\\partial H}{\\partial p_{\\|}} \\mathbf{b} = v_{\\|} \\mathbf{b} + \\frac{c}{e B_{\\|}^{*}} (\\mathbf{b} \\times \\nabla H) $$\n$$ \\dot{p}_{\\|} = - \\frac{\\mathbf{B}^*}{B_{\\|}^*} \\cdot \\nabla H $$\n其中 $\\mathbf{b} = \\mathbf{B}/B$ 是沿磁场方向的单位矢量，$\\mathbf{B}^*(\\mathbf{X}, p_{\\|}) = \\mathbf{B}(\\mathbf{X}) + \\frac{c p_{\\|}}{e} \\nabla \\times \\mathbf{b}$，以及 $B_{\\|}^* = \\mathbf{b} \\cdot \\mathbf{B}^*$。为了本问题的目的，假设导心序级允许近似 $\\mathbf{B}^* \\approx \\mathbf{B}$，因此 $B_{\\|}^* \\approx B$。\n\n该系统的一个二阶、显式、辛积分器通过算子分裂法构建。哈密顿量被分裂成两个可积部分，$H = H_A + H_B$，其中：\n$$ H_A = \\frac{p_{\\|}^2}{2m} \\quad \\text{和} \\quad H_B = \\mu B(\\mathbf{X}) $$\n将系统从时间 $t_k$ 推进到 $t_{k+1} = t_k + \\Delta t$ 的数值积分映射 $\\Phi_{\\Delta t}$ 由二阶对称 Strang 分裂给出：\n$$ \\Phi_{\\Delta t} = \\phi_{A, \\Delta t/2} \\circ \\phi_{B, \\Delta t} \\circ \\phi_{A, \\Delta t/2} $$\n其中 $\\phi_{H, \\tau}$ 表示在时间间隔 $\\tau$ 内由哈密顿量 $H$ 控制的系统的精确流。\n\n推导在时间 $t_{k+1}$ 时导心坐标 $x_{k+1}$ 的显式更新方程，用在时间 $t_k$ 时的状态 $(\\mathbf{X}_k, v_{\\|,k})$ 表示。", "solution": "本题是要求使用分裂步长辛积分器推导导心运动中 $x_{k+1}$ 的更新规则。在时间 $t_k$ 的状态由 $(\\mathbf{X}_k, p_{\\|,k}) = (x_k, y_k, z_k, m v_{\\|,k})$ 给出。更新映射为 $\\Phi_{\\Delta t} = \\phi_{A, \\Delta t/2} \\circ \\phi_{B, \\Delta t} \\circ \\phi_{A, \\Delta t/2}$。我们需要依次计算这些映射中的每一个的作用。\n\n**1. 磁场及其性质**\n磁场为 $\\mathbf{B} = B_0(1+\\alpha y)\\mathbf{\\hat{z}}$。\n磁场强度为 $B = |\\mathbf{B}| = B_0(1+\\alpha y)$。\n单位矢量为 $\\mathbf{b} = \\mathbf{B}/B = \\mathbf{\\hat{z}}$。\n场强的梯度为 $\\nabla B = \\nabla(B_0(1+\\alpha y)) = B_0 \\alpha \\mathbf{\\hat{y}}$。\n由于 $\\mathbf{b}$ 是一个常矢量，$\\nabla \\times \\mathbf{b} = 0$，这证明了给定的近似 $\\mathbf{B}^* \\approx \\mathbf{B}$ 和 $B_{\\|}^* \\approx B$ 是合理的。\n\n**2. 哈密顿量 $H_A = p_{\\|}^2/(2m)$ 对应的流 $\\phi_{A, \\tau}$**\n$H_A$ 控制下的运动方程为：\n$\\dot{p}_{\\|} = - \\mathbf{b} \\cdot \\nabla H_A = -\\mathbf{\\hat{z}} \\cdot \\nabla(\\frac{p_{\\|}^2}{2m}) = 0$。\n$\\dot{\\mathbf{X}} = v_{\\|} \\mathbf{b} = v_{\\|} \\mathbf{\\hat{z}}$。\n由于在此步骤中 $p_{\\|}$（以及 $v_{\\|}$）是恒定的，$\\dot{\\mathbf{X}}$ 的积分是直接的。\n如果初始状态为 $(\\mathbf{X}_0, p_{\\|,0})$，经过时间 $\\tau$ 后的状态为：\n$p_{\\|}(\\tau) = p_{\\|,0}$\n$\\mathbf{X}(\\tau) = \\mathbf{X}_0 + v_{\\|,0} \\mathbf{\\hat{z}} \\tau$。\n因此，$\\phi_{A, \\tau}(\\mathbf{X}_0, p_{\\|,0}) = (\\mathbf{X}_0 + v_{\\|,0} \\mathbf{\\hat{z}} \\tau, p_{\\|,0})$。\n\n**3. 哈密顿量 $H_B = \\mu B(\\mathbf{X})$ 对应的流 $\\phi_{B, \\tau}$**\n$H_B$ 控制下的运动方程为：\n$\\dot{p}_{\\|} = - \\mathbf{b} \\cdot \\nabla H_B = - \\mathbf{\\hat{z}} \\cdot (\\mu \\nabla B) = - \\mu (\\mathbf{\\hat{z}} \\cdot B_0 \\alpha \\mathbf{\\hat{y}}) = 0$。\n$\\dot{\\mathbf{X}} = \\frac{c}{eB}(\\mathbf{b} \\times \\nabla H_B) = \\frac{c\\mu}{eB} (\\mathbf{b} \\times \\nabla B)$。\n代入 $\\mathbf{b}$ 和 $\\nabla B$ 的表达式：\n$\\dot{\\mathbf{X}} = \\frac{c\\mu}{e B_0(1+\\alpha y)} (\\mathbf{\\hat{z}} \\times B_0 \\alpha \\mathbf{\\hat{y}}) = \\frac{c\\mu \\alpha}{e(1+\\alpha y)} (-\\mathbf{\\hat{x}})$。\n$\\mathbf{X}$ 各分量的方程为：\n$\\dot{x} = -\\frac{c\\mu\\alpha}{e(1+\\alpha y)}$\n$\\dot{y} = 0$\n$\\dot{z} = 0$\n由于 $p_{\\|}$ 是恒定的，$v_\\|$ 也是恒定的。因为 $\\dot{y}=0$，所以在此步骤中 $y$ 是恒定的。因此，$\\dot{x}$ 也是恒定的。\n从初始状态 $(\\mathbf{X}_0, p_{\\|,0})$ 开始，对这些方程在一个时间间隔 $\\tau$ 内积分，得到：\n$p_{\\|}(\\tau) = p_{\\|,0}$\n$y(\\tau) = y_0$\n$z(\\tau) = z_0$\n$x(\\tau) = x_0 - \\frac{c\\mu\\alpha}{e(1+\\alpha y_0)} \\tau$。\n因此，$\\phi_{B, \\tau}(\\mathbf{X}_0, p_{\\|,0}) = (x_0 - \\frac{c\\mu\\alpha\\tau}{e(1+\\alpha y_0)}, y_0, z_0, p_{\\|,0})$。\n\n**4. 组合映射以求得 $\\Phi_{\\Delta t}$**\n设在 $t_k$ 时的状态为 $(\\mathbf{X}_k, p_{\\|,k})$。\n**步骤 1：** 应用 $\\phi_{A, \\Delta t/2}$。\n设 $(\\mathbf{X}', p_{\\|}') = \\phi_{A, \\Delta t/2}(\\mathbf{X}_k, p_{\\|,k})$。\n$p_{\\|}' = p_{\\|,k}$。\n$\\mathbf{X}' = \\mathbf{X}_k + v_{\\|,k} \\mathbf{\\hat{z}} \\frac{\\Delta t}{2} = (x_k, y_k, z_k + \\frac{v_{\\|,k} \\Delta t}{2})$。\n\n**步骤 2：** 将 $\\phi_{B, \\Delta t}$ 应用于步骤 1 的结果。\n设 $(\\mathbf{X}'', p_{\\|''}) = \\phi_{B, \\Delta t}(\\mathbf{X}', p_{\\|}')$。\n$p_{\\|''} = p_{\\|}' = p_{\\|,k}$。\n$y'' = y' = y_k$。\n$z'' = z' = z_k + \\frac{v_{\\|,k} \\Delta t}{2}$。\n$x'' = x' - \\frac{c\\mu\\alpha\\Delta t}{e(1+\\alpha y')} = x_k - \\frac{c\\mu\\alpha\\Delta t}{e(1+\\alpha y_k)}$。\n\n**步骤 3：** 将 $\\phi_{A, \\Delta t/2}$ 应用于步骤 2 的结果。\n设 $(\\mathbf{X}_{k+1}, p_{\\|,k+1}) = \\phi_{A, \\Delta t/2}(\\mathbf{X}'', p_{\\|''})$。\n$p_{\\|,k+1} = p_{\\|''} = p_{\\|,k}$。这意味着 $v_{\\|,k+1}=v_{\\|,k}$。\n$\\mathbf{X}_{k+1} = \\mathbf{X}'' + v_{\\|,k} \\mathbf{\\hat{z}} \\frac{\\Delta t}{2}$。\n我们来求 $\\mathbf{X}_{k+1}$ 的分量：\n$x_{k+1} = x'' = x_k - \\frac{c\\mu\\alpha\\Delta t}{e(1+\\alpha y_k)}$。\n$y_{k+1} = y'' = y_k$。\n$z_{k+1} = z'' + \\frac{v_{\\|,k} \\Delta t}{2} = \\left(z_k + \\frac{v_{\\|,k} \\Delta t}{2}\\right) + \\frac{v_{\\|,k} \\Delta t}{2} = z_k + v_{\\|,k} \\Delta t$。\n\n题目具体要求 $x_{k+1}$ 的更新方程。从最后一步可知，该方程为：\n$x_{k+1} = x_k - \\frac{c\\mu\\alpha\\Delta t}{e(1+\\alpha y_k)}$。", "answer": "$$\n\\boxed{x_k - \\frac{c\\mu\\alpha\\Delta t}{e(1+\\alpha y_k)}}\n$$", "id": "263875"}]}