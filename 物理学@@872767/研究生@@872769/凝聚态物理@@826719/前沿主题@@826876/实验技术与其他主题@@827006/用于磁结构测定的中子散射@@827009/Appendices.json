{"hands_on_practices": [{"introduction": "与源自点状原子核的核散射不同，磁散射源于电子的自旋和轨道角动量，这些电子在原子周围有一定的空间分布。这种扩展的分布导致了磁形状因子$f(Q)$的出现，它是磁矩密度的傅里叶变换，并随着散射矢量$Q$的增加而减小。本练习[@problem_id:3007114]提供了一个具体的计算，让您能够亲手探究$f(Q)$如何影响磁布拉格峰的强度，并理解为什么磁散射信号在高角度下会迅速衰减，这是区分磁散射和核散射的关键特征之一。", "problem": "一个共线铁磁体在其原胞中包含一个晶体学等效的铁离子，该离子处于高自旋铁(II)构型，电子构型为 $3d^{6}$。忽略核散射和Debye–Waller衰减，并假设自旋是完全有序的，因此磁结构因子简化为离子的标量磁形状因子乘以一个在所考虑的反射之间不发生变化的恒定取向因子。铁(II)的磁形状因子 $f(Q)$ 通过磁化密度的球张量分解的前导项进行建模，保留与阶数 $l=0$ 和 $l=2$ 的球贝塞尔函数相关的径向积分。在此模型中，各向同性部分和前导四极矩校正组合为\n$$\nf(Q)=j_{0}(Q)-\\alpha\\,j_{2}(Q),\n$$\n其中 $j_{0}(Q)$ 和 $j_{2}(Q)$ 是铁(II)的表格化径向积分，$\\alpha$ 是一个无量纲系数，源于晶体场中 $3d$ 自旋密度的残余非球面性。使用 $\\alpha=0.20$。\n\n对于三个动量转移 $Q_{1}=2.0\\ \\text{\\AA}^{-1}$、$Q_{2}=4.0\\ \\text{\\AA}^{-1}$ 和 $Q_{3}=6.0\\ \\text{\\AA}^{-1}$，使用以下铁(II)的表格化值：\n- 在 $Q_{1}$ 处：$j_{0}(Q_{1})=0.90$，$j_{2}(Q_{1})=0.050$。\n- 在 $Q_{2}$ 处：$j_{0}(Q_{2})=0.60$，$j_{2}(Q_{2})=0.030$。\n- 在 $Q_{3}$ 处：$j_{0}(Q_{3})=0.35$，$j_{2}(Q_{3})=0.015$。\n\n从磁性中子散射强度的通用表达式出发，并将其应用于所述条件，推导出磁布拉格峰强度对 $f(Q)$ 的依赖关系，计算上述三个 $Q$ 值下各自的 $f(Q)$，然后确定高角度强度与低角度强度的比率 $I(Q_{3})/I(Q_{1})$。将最终比率表示为一个无量纲十进制数。将答案四舍五入到三位有效数字。在你的推理过程中，解释 $f(Q)$ 对 $Q$ 的依赖性如何影响高角度磁布拉格强度。", "solution": "### 第1步：推导强度与形状因子的关系\n磁布拉格峰的散射强度 $I(Q)$ 与磁结构因子垂直分量的模平方成正比，即 $I(Q) \\propto |\\mathbf{F}_{M\\perp}(\\mathbf{Q})|^2$。对于一个单原子在原胞中的共线铁磁体，磁结构因子矢量 $\\mathbf{F}_M(\\mathbf{Q})$ 可以简化为 $\\mathbf{F}_M(\\mathbf{Q}) = f(Q)\\mathbf{m}$，其中 $f(Q)$ 是磁形状因子，$\\mathbf{m}$ 是磁矩矢量。\n强度则为 $I(Q) \\propto |f(Q)\\mathbf{m}_{\\perp}|^2 = [f(Q)]^2 |\\mathbf{m}|^2 \\sin^2\\phi$，其中 $\\phi$ 是磁矩 $\\mathbf{m}$ 与散射矢量 $\\mathbf{Q}$ 之间的夹角。根据题意，取向因子 $\\sin^2\\phi$ 和磁矩大小 $|\\mathbf{m}|$ 对于所考虑的反射是恒定的。因此，强度正比于磁形状因子的平方：\n$$\nI(Q) \\propto [f(Q)]^2\n$$\n\n### 第2步：计算磁形状因子\n使用给定的模型 $f(Q)=j_{0}(Q)-\\alpha\\,j_{2}(Q)$ 和参数 $\\alpha=0.20$：\n- 对于 $Q_{1} = 2.0\\ \\text{\\AA}^{-1}$：\n  $$\n  f(Q_{1}) = j_{0}(Q_{1}) - \\alpha j_{2}(Q_{1}) = 0.90 - (0.20)(0.050) = 0.90 - 0.010 = 0.890\n  $$\n- 对于 $Q_{3} = 6.0\\ \\text{\\AA}^{-1}$：\n  $$\n  f(Q_{3}) = j_{0}(Q_{3}) - \\alpha j_{2}(Q_{3}) = 0.35 - (0.20)(0.015) = 0.35 - 0.003 = 0.347\n  $$\n\n### 第3步：计算强度比\n高角度强度与低角度强度的比率 $I(Q_{3})/I(Q_{1})$ 可以通过它们对应的形状因子计算得出：\n$$\n\\frac{I(Q_{3})}{I(Q_{1})} = \\frac{K [f(Q_{3})]^2}{K [f(Q_{1})]^2} = \\left( \\frac{f(Q_{3})}{f(Q_{1})} \\right)^2\n$$\n代入计算出的值：\n$$\n\\frac{I(Q_{3})}{I(Q_{1})} = \\left( \\frac{0.347}{0.890} \\right)^2 \\approx (0.389887...)^2 \\approx 0.15199...\n$$\n将结果四舍五入到三位有效数字，得到 $0.152$。\n\n### 第4步：物理解释\n磁形状因子 $f(Q)$ 是磁性电子在原子周围空间分布的傅里叶变换。由于电子云具有有限的大小，当中子散射时，从电子云不同部分散射的波会发生干涉。随着散射矢量 $Q$ 的增加（对应于探测更短的实空间距离），这种干涉效应变得更加显著，导致相消干涉，从而使 $f(Q)$ 的值迅速减小。由于磁散射强度 $I(Q)$ 与 $[f(Q)]^2$ 成正比，这种衰减效应被放大。如本例所示，当 $Q$ 从 $2.0\\ \\text{\\AA}^{-1}$ 增加到 $6.0\\ \\text{\\AA}^{-1}$ 时，形状因子下降到约原值的39%，而强度则急剧下降到仅约15%。这种磁散射强度随 $Q$ 快速衰减的特性，是其与几乎不依赖于 $Q$ 的核散射（源于点状原子核）相区分的一个关键实验标志。", "answer": "$$\n\\boxed{0.152}\n$$", "id": "3007114"}, {"introduction": "从中子源到探测器的整个路径上，样品本身的形式对我们最终能获得的信息有着决定性的影响。虽然单晶样品能提供最完整的数据，但许多重要材料最初只能以多晶粉末的形式合成。本练习[@problem_id:3007075]将引导您推导一个在粉末衍射中至关重要的常数——磁极化因子在粉末平均后的$2/3$因子。更重要的是，这个练习促使我们思考这一平均过程带来的深刻后果：它本质上让我们丢失了关于磁矩绝对方向的信息，并启发我们思考如何通过巧妙的实验设计（如使用单晶或施加磁场）来克服这一基本限制。", "problem": "使用非偏振中子对具有有序磁矩大小为$\\mu$的共线反铁磁体的多晶粉末进行弹性中子衍射测量。所有微晶随机取向，并且每个微晶中的有序磁矩在其自身的晶体学坐标系中严格固定于单个单位矢量$\\hat{\\mathbf{m}}$方向。考虑散射矢量为$\\mathbf{Q}$（其中$|\\mathbf{Q}| = Q$）的磁布拉格反射，并假设对于满足$|\\mathbf{G}_{1}| = |\\mathbf{G}_{2}| = Q$的两个不同倒格矢$\\mathbf{G}_{1}$和$\\mathbf{G}_{2}$，其磁形状因子$f(Q)$和磁结构因子振幅$|F_{\\mathrm{mag}}(\\mathbf{Q})|$是已知且相同的。\n\n仅使用已公认的磁中子散射基本原理和在单位球面上的旋转平均，推导对粉末微晶的取向平均如何改变磁极化因子，并因此改变仅凭粉末衍射区分$\\hat{\\mathbf{m}}$绝对方向的能力。具体而言：\n\n1) 从磁相互作用在垂直于$\\hat{\\mathbf{Q}} = \\mathbf{Q}/Q$的分量上的投影出发，对所有微晶取向进行完全的取向平均，以获得在衍射强度中与$|F_{\\mathrm{mag}}(\\mathbf{Q})|^{2}$相乘的粉末平均极化因子$\\mathcal{P}_{\\mathrm{powder}}$。\n\n2) 使用第1)部分的结果，当两个候选磁结构之间的唯一区别是$\\hat{\\mathbf{m}}$在晶体学坐标系中的绝对方向（例如，$\\hat{\\mathbf{m}} \\parallel \\hat{\\mathbf{a}}$与$\\hat{\\mathbf{m}} \\parallel \\hat{\\mathbf{c}}$）时，评估上述在$\\mathbf{G}_{1}$和$\\mathbf{G}_{2}$处的两个反射的粉末平均磁衍射强度之比$I_{1}/I_{2}$。解释这对于仅从粉末衍射解析绝对磁矩方向意味着什么。\n\n3) 提出至少两种辅助中子测量或实验策略，以解决$\\hat{\\mathbf{m}}$绝对方向上的模糊性，并简要说明每种策略通过何种物理原理来消除由粉末平均引入的简并。\n\n请提供粉末平均极化因子$\\mathcal{P}_{\\mathrm{powder}}$作为最终答案，表示为单个无量纲数。无需四舍五入。", "solution": "### 1) 粉末平均极化因子的推导\n\n对于非偏振中子，磁散射强度与磁结构因子中垂直于散射矢量 $\\mathbf{Q}$ 的分量 $\\mathbf{M}_{\\perp}(\\mathbf{Q})$ 的模平方成正比。对于一个共线磁结构，其磁结构因子矢量可以写成 $\\mathbf{M}(\\mathbf{Q}) = \\hat{\\mathbf{m}} F_{\\mathrm{mag}}(\\mathbf{Q})$，其中 $\\hat{\\mathbf{m}}$ 是磁矩方向的单位矢量，$F_{\\mathrm{mag}}(\\mathbf{Q})$ 是标量结构因子振幅。\n\n单个微晶的散射强度 $I_{\\mathrm{single}}$ 正比于 $|\\mathbf{M}_{\\perp}(\\mathbf{Q})|^2$。\n$$\n|\\mathbf{M}_{\\perp}(\\mathbf{Q})|^2 = |\\mathbf{M}(\\mathbf{Q})|^2 - |\\hat{\\mathbf{Q}} \\cdot \\mathbf{M}(\\mathbf{Q})|^2 = |F_{\\mathrm{mag}}(\\mathbf{Q})|^2 (|\\hat{\\mathbf{m}}|^2 - |\\hat{\\mathbf{Q}} \\cdot \\hat{\\mathbf{m}}|^2)\n$$\n由于 $\\hat{\\mathbf{m}}$ 和 $\\hat{\\mathbf{Q}}$ 都是单位矢量，上式简化为：\n$$\n|\\mathbf{M}_{\\perp}(\\mathbf{Q})|^2 = |F_{\\mathrm{mag}}(\\mathbf{Q})|^2 (1 - \\cos^2\\alpha) = |F_{\\mathrm{mag}}(\\mathbf{Q})|^2 \\sin^2\\alpha\n$$\n其中 $\\alpha$ 是磁矩方向 $\\hat{\\mathbf{m}}$ 和散射矢量 $\\mathbf{Q}$ 之间的夹角。$\\sin^2\\alpha$ 项就是极化因子。\n\n对于粉末样品，所有微晶随机取向，因此我们需要对 $\\sin^2\\alpha$ 在所有方向上进行平均。这等效于在单位球面上对该函数进行积分。我们将 $\\mathbf{Q}$ 的方向固定为球坐标系的 $z$ 轴，那么 $\\alpha$ 就对应于极角 $\\theta$。粉末平均极化因子 $\\mathcal{P}_{\\mathrm{powder}}$ 为：\n$$\n\\mathcal{P}_{\\mathrm{powder}} = \\langle \\sin^2\\alpha \\rangle = \\frac{\\int_{0}^{2\\pi} \\int_{0}^{\\pi} \\sin^2\\theta \\cdot \\sin\\theta \\,d\\theta d\\phi}{\\int_{0}^{2\\pi} \\int_{0}^{\\pi} \\sin\\theta \\,d\\theta d\\phi}\n$$\n分母是单位球的总立体角，即 $4\\pi$。分子积分计算如下：\n$$\n\\int_0^{2\\pi} d\\phi \\int_0^{\\pi} \\sin^3(\\theta) d\\theta = 2\\pi \\int_0^{\\pi} (1-\\cos^2\\theta)\\sin\\theta d\\theta\n$$\n令 $u = \\cos\\theta$，则 $du = -\\sin\\theta d\\theta$。积分限从 $\\cos(0)=1$ 变为 $\\cos(\\pi)=-1$。\n$$\n2\\pi \\int_1^{-1} (1-u^2) (-du) = 2\\pi \\int_{-1}^{1} (1-u^2) du = 2\\pi \\left[ u - \\frac{u^3}{3} \\right]_{-1}^{1} = 2\\pi \\left[ \\left(1-\\frac{1}{3}\\right) - \\left(-1+\\frac{1}{3}\\right) \\right] = 2\\pi \\left[ \\frac{2}{3} - \\left(-\\frac{2}{3}\\right) \\right] = 2\\pi \\left(\\frac{4}{3}\\right) = \\frac{8\\pi}{3}\n$$\n因此，粉末平均极化因子为：\n$$\n\\mathcal{P}_{\\mathrm{powder}} = \\frac{8\\pi/3}{4\\pi} = \\frac{2}{3}\n$$\n\n### 2) 强度比及对磁矩方向的推论\n\n粉末衍射的磁布拉格峰强度为 $I(\\mathbf{Q}) \\propto j(\\mathbf{Q}) |F_{\\mathrm{mag}}(\\mathbf{Q})|^2 \\mathcal{P}_{\\mathrm{powder}}$，其中 $j(\\mathbf{Q})$ 是等效反射的多重度。将 $\\mathcal{P}_{\\mathrm{powder}} = 2/3$ 代入，得到：\n$$\nI(\\mathbf{Q}) \\propto j(\\mathbf{Q}) |F_{\\mathrm{mag}}(\\mathbf{Q})|^2 \\left(\\frac{2}{3}\\right)\n$$\n对于两个仅在磁矩绝对方向 $\\hat{\\mathbf{m}}$ 上不同的候选结构（例如，$\\hat{\\mathbf{m}} \\parallel \\hat{\\mathbf{a}}$ vs $\\hat{\\mathbf{m}} \\parallel \\hat{\\mathbf{c}}$），它们的 $|F_{\\mathrm{mag}}(\\mathbf{Q})|$ 是相同的。由于粉末平均极化因子是一个与 $\\hat{\\mathbf{m}}$ 无关的常数 $2/3$，因此这两个候选结构将产生完全相同的粉末衍射图谱。\n两个反射的强度比 $I_1/I_2$ 仅取决于多重度比 $j(\\mathbf{G}_1)/j(\\mathbf{G}_2)$，与磁矩方向无关。\n**推论：** 仅从非偏振中子的粉末衍射数据，无法确定共线磁结构中有序磁矩的绝对方向。取向平均过程系统性地丢失了这一信息。\n\n### 3) 解决模糊性的辅助策略\n\n为了确定 $\\hat{\\mathbf{m}}$ 的绝对方向，必须打破取向平均的简并性。\n\n*   **策略1：单晶中子衍射。**\n    *   **原理：** 使用单晶样品时，晶格相对于中子束的方向是固定的。对于每个布拉格反射 $\\mathbf{G}$，磁矩方向 $\\hat{\\mathbf{m}}$ 与散射矢量 $\\mathbf{G}$ 之间的夹角 $\\alpha$ 是确定的。测量的强度正比于 $\\sin^2\\alpha$。通过测量一组具有不同 $\\mathbf{G}$ 方向的反射强度，可以检验不同 $\\hat{\\mathbf{m}}$ 方向模型的预测。例如，如果一个模型预测 $\\hat{\\mathbf{m}}$ 平行于 $\\mathbf{G}$（即 $\\alpha=0$），则该反射的磁散射强度应为零。观察到这种系统性消光可以证实该模型。\n\n*   **策略2：施加外磁场。**\n    *   **原理：** 对粉末样品施加一个外磁场 $\\mathbf{H}$，可以优先排列那些磁矩方向与磁场方向夹角较小的微晶（如果磁各向异性允许）。这打破了磁畴的随机取向分布。现在，磁矩方向的分布不再是各向同性的，而是相对于磁场方向有一个优势取向。因此，测量的散射强度将依赖于散射矢量 $\\mathbf{Q}$ 和磁场 $\\mathbf{H}$ 之间的夹角。通过比较在不同磁场-样品几何构型下（例如 $\\mathbf{Q} \\parallel \\mathbf{H}$ 和 $\\mathbf{Q} \\perp \\mathbf{H}$）测量的强度变化，可以推断出磁各向异性的性质，进而确定零场下磁矩的易磁化轴方向。\n\n*   **策略3：其他各向异性测量。**\n    *   **原理：** 某些宏观测量技术对磁各向异性敏感，可以提供补充信息。例如，测量单晶样品的磁化率，其在不同晶轴方向上的数值差异可以直接揭示易磁化轴/面。将这些宏观测量结果与中子衍射数据相结合，可以有效地区分不同的磁矩方向模型。", "answer": "$$\\boxed{\\frac{2}{3}}$$", "id": "3007075"}, {"introduction": "磁结构解析的最终目标是将理论模型与实验数据相结合，以精确确定材料中的自旋排列方式。在掌握了基本原理和实验方法的局限性之后，本练习[@problem_id:3007109]将带您进入现代磁结构精修的核心。您将面对一个更复杂的非共线螺旋磁结构，并需要从单晶衍射数据中提取关键的结构参数。这个实践要求您将散射截面的理论公式转化为一个可计算的模型，并通过最小二乘法拟合实验强度数据，从而精确解析出自旋分量之间的相位角，真实地模拟了磁晶体学家的日常研究工作。", "problem": "给定单晶磁性中子衍射强度，这些强度是在卫星峰位置 $\\mathbf{Q} = \\mathbf{G} \\pm \\mathbf{k}$ 处测得的，该晶体具有单一的非公度传播矢量 $\\mathbf{k}$。磁结构是在一个位置上的单$\\mathbf{k}$非共线调制，其自旋分量沿两个正交的晶体学单位矢量 $\\hat{\\mathbf{a}}$ 和 $\\hat{\\mathbf{b}}$，具有固定的大小 $M_a$ 和 $M_b$，以及分量之间未知的相对相位 $\\phi$。假设使用非偏振中子，且标准磁性截面与垂直于 $\\mathbf{Q}$ 的磁相互作用矢量的平方成正比，并忽略在所用的小范围 $\\mathbf{Q}$ 集合上磁性形状因子和消光效应的任何变化。使用以下基本原理：\n- 非偏振中子的微分截面与 $\\left\\| \\mathbf{Q}^{\\wedge} \\times \\mathbf{F}(\\mathbf{Q}) \\times \\mathbf{Q}^{\\wedge} \\right\\|^2$ 成正比，其中 $\\mathbf{Q}^{\\wedge} = \\mathbf{Q} / \\|\\mathbf{Q}\\|$，$\\mathbf{F}(\\mathbf{Q})$ 是磁结构因子矢量。\n- 只有垂直于 $\\mathbf{Q}$ 的磁性傅里叶分量有贡献，这可以用垂直投影算符 $\\mathsf{P}_{\\perp}(\\mathbf{Q}^{\\wedge})$ 作用于任意矢量 $\\mathbf{v}$ 来表示为 $\\mathsf{P}_{\\perp}(\\mathbf{Q}^{\\wedge})\\,\\mathbf{v} = \\mathbf{v} - \\mathbf{Q}^{\\wedge} \\left( \\mathbf{Q}^{\\wedge} \\cdot \\mathbf{v} \\right)$。\n- 晶格位置 $\\mathbf{R}$ 处的实空间磁矩模型为 $\\mathbf{m}(\\mathbf{R}) = M_a \\,\\hat{\\mathbf{a}} \\cos( \\mathbf{k}\\cdot\\mathbf{R}) + M_b \\,\\hat{\\mathbf{b}} \\cos( \\mathbf{k}\\cdot\\mathbf{R} + \\phi )$，其中 $M_a  0$，$M_b  0$，待定未知量 $\\phi \\in [0,\\pi]$。正交条件为 $\\hat{\\mathbf{a}} \\cdot \\hat{\\mathbf{b}} = 0$，且两者均为单位矢量。\n\n从第一性原理出发，推导出一个在计算上可用的关系式，该关系式关联了在 $\\mathbf{G} \\pm \\mathbf{k}$ 处测得的卫星峰强度与未知数 $\\phi$ 以及一个总体的正尺度因子 $s$（无量纲）。该因子 $s$ 包含了在给定测试案例中所有卫星峰共有的比例常数。然后，实现一个算法，根据提供的强度数据集，通过最小二乘法来精修 $\\phi$ 和 $s$。所有角度必须以弧度为单位。所有强度均为无量纲。对于每个测试案例，您的程序应输出序对 $[\\hat{\\phi}, \\hat{s}]$，其中 $\\hat{\\phi}$ 限制在 $[0,\\pi]$ 范围内。报告的 $\\hat{\\phi}$ 和 $\\hat{s}$ 均需四舍五入到 $6$ 位小数。\n\n下面提供了三个独立测试案例的输入数据。对于每个案例，都给定了 $M_a$、$M_b$、笛卡尔坐标系中的单位矢量 $\\hat{\\mathbf{a}}$ 和 $\\hat{\\mathbf{b}}$、一个 $\\mathbf{Q}$ 方向列表（每个都是一个非零笛卡尔矢量，使用前必须在内部归一化为单位矢量 $\\mathbf{Q}^{\\wedge}$），以及在相应的 $\\mathbf{G} + \\mathbf{k}$ 和 $\\mathbf{G} - \\mathbf{k}$ 卫星峰处测得的强度。将所有强度视为精确值（无不确定性）。\n\n测试案例 1：\n- $M_a = 2.0$, $M_b = 1.5$。\n- $\\hat{\\mathbf{a}} = (1,0,0)$, $\\hat{\\mathbf{b}} = (0,1,0)$。\n- $\\mathbf{Q}$ 列表（每个都需在内部归一化）：$(0,0,1)$, $(1,0,0)$, $(1,1,0)$, $(1,0,1)$, $(0,1,1)$。\n- 在 $\\mathbf{G} + \\mathbf{k}$ 处测得的强度：$[31.25, 11.25, 5.174399365, 21.25, 25.625]$。\n- 在 $\\mathbf{G} - \\mathbf{k}$ 处测得的强度：$[31.25, 11.25, 5.174399365, 21.25, 25.625]$。\n\n测试案例 2：\n- $M_a = 1.0$, $M_b = 2.0$。\n- $\\hat{\\mathbf{a}} = (1,0,0)$, $\\hat{\\mathbf{b}} = (0,1,0)$。\n- $\\mathbf{Q}$ 列表（每个都需在内部归一化）：$(0,0,1)$, $(0,1,0), (1,1,0), (1,0,1), (0,1,1), (1,-1,0)$。\n- 在 $\\mathbf{G} + \\mathbf{k}$ 处测得的强度：$[18.5, 3.7, 16.65, 16.65, 11.1, 1.85]$。\n- 在 $\\mathbf{G} - \\mathbf{k}$ 处测得的强度：$[18.5, 3.7, 16.65, 16.65, 11.1, 1.85]$。\n\n测试案例 3：\n- $M_a = 1.8, $M_b = 1.8$。\n- $\\hat{\\mathbf{a}} = (1,0,0)$, $\\hat{\\mathbf{b}} = (0,1,0)$。\n- $\\mathbf{Q}$ 列表（每个都需在内部归一化）：$(1,0,0)$, $(0,1,0)$, $(0,0,1)$, $(1,2,0)$, $(1,-2,0)$。\n- 在 $\\mathbf{G} + \\mathbf{k}$ 处测得的强度：$[3.888, 3.888, 7.776, 0.7776, 6.9984]$。\n- 在 $\\mathbf{G} - \\mathbf{k}$ 处测得的强度：$[3.888, 3.888, 7.776, 0.7776, 6.9984]$。\n\n您的任务：\n- 从上述基本原理和给定模型出发，推导出一个可线性化的关系式，该关系式关联了测得的强度与未知数 $\\phi$ 和 $s$。该关系式对非偏振中子有效，并能正确处理对 $\\mathbf{Q}$ 的垂直投影。\n- 实现一个程序，对每个测试案例，将每个 $\\mathbf{Q}$ 归一化为 $\\mathbf{Q}^{\\wedge}$，构建所需的投影矢量，建立一个适当的最小二乘系统，求解 $\\hat{\\phi}$ 和 $\\hat{s}$，并将所有测试案例的结果输出到单行。\n\n角度单位要求：\n- 以弧度表示 $\\hat{\\phi}$。\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含形如 $[[\\hat{\\phi}_1,\\hat{s}_1],[\\hat{\\phi}_2,\\hat{s}_2],[\\hat{\\phi}_3,\\hat{s}_3]]$ 的逗号分隔列表形式的结果，每个数字都四舍五入到 $6$ 位小数，并且不出现任何额外文本。", "solution": "### 1. 理论模型推导\n\n首先，我们从实空间磁矩模型出发，推导磁结构因子。实空间模型为：\n$$ \\mathbf{m}(\\mathbf{R}) = M_a \\,\\hat{\\mathbf{a}} \\cos( \\mathbf{k}\\cdot\\mathbf{R}) + M_b \\,\\hat{\\mathbf{b}} \\cos( \\mathbf{k}\\cdot\\mathbf{R} + \\phi ) $$\n利用欧拉公式 $\\cos x = (e^{ix} + e^{-ix})/2$，我们将模型重写为傅里叶级数形式：\n$$ \\mathbf{m}(\\mathbf{R}) = \\frac{1}{2} \\left( M_a \\hat{\\mathbf{a}} + M_b \\hat{\\mathbf{b}} e^{i\\phi} \\right) e^{i\\mathbf{k}\\cdot\\mathbf{R}} + \\frac{1}{2} \\left( M_a \\hat{\\mathbf{a}} + M_b \\hat{\\mathbf{b}} e^{-i\\phi} \\right) e^{-i\\mathbf{k}\\cdot\\mathbf{R}} $$\n磁结构因子 $\\mathbf{F}(\\mathbf{Q})$ 是磁矩分布的傅里叶变换。对于单$\\mathbf{k}$结构，磁散射仅出现在卫星峰位置 $\\mathbf{Q} = \\mathbf{G} \\pm \\mathbf{k}$ 处，其中 $\\mathbf{G}$ 是倒易格点矢量。\n在 $\\mathbf{Q} = \\mathbf{G} - \\mathbf{k}$ 处的结构因子 $\\mathbf{F}_{-\\mathbf{k}}$ 与 $e^{i\\mathbf{k}\\cdot\\mathbf{R}}$ 项的系数成正比：\n$$ \\mathbf{F}_{-\\mathbf{k}} \\propto M_a \\hat{\\mathbf{a}} + M_b \\hat{\\mathbf{b}} e^{i\\phi} $$\n在 $\\mathbf{Q} = \\mathbf{G} + \\mathbf{k}$ 处的结构因子 $\\mathbf{F}_{+\\mathbf{k}}$ 与 $e^{-i\\mathbf{k}\\cdot\\mathbf{R}}$ 项的系数成正比：\n$$ \\mathbf{F}_{+\\mathbf{k}} \\propto M_a \\hat{\\mathbf{a}} + M_b \\hat{\\mathbf{b}} e^{-i\\phi} $$\n注意 $\\mathbf{F}_{-\\mathbf{k}} = \\mathbf{F}_{+\\mathbf{k}}^*$，这保证了磁矩是实数。对于非偏振中子，两个卫星峰的强度 $I(\\mathbf{G} \\pm \\mathbf{k})$ 是相同的。\n\n散射强度 $I(\\mathbf{Q})$ 与垂直于散射矢量 $\\mathbf{Q}$ 的磁结构因子分量 $\\mathbf{F}_{\\perp}(\\mathbf{Q})$ 的模平方成正比。令 $\\mathbf{q} = \\mathbf{Q}^{\\wedge}$ 为单位散射矢量，则：\n$$ I(\\mathbf{Q}) \\propto \\|\\mathbf{F}_{\\perp}(\\mathbf{Q})\\|^2 = \\|\\mathbf{F}(\\mathbf{Q})\\|^2 - |\\mathbf{q} \\cdot \\mathbf{F}(\\mathbf{Q})|^2 $$\n我们以 $\\mathbf{F} = \\mathbf{F}_{+\\mathbf{k}}$ 为例进行计算：\n$$ \\|\\mathbf{F}\\|^2 = (M_a \\hat{\\mathbf{a}} + M_b \\hat{\\mathbf{b}} e^{-i\\phi}) \\cdot (M_a \\hat{\\mathbf{a}} + M_b \\hat{\\mathbf{b}} e^{i\\phi}) = M_a^2 + M_b^2 $$\n$$ |\\mathbf{q} \\cdot \\mathbf{F}|^2 = |M_a (\\mathbf{q}\\cdot\\hat{\\mathbf{a}}) + M_b (\\mathbf{q}\\cdot\\hat{\\mathbf{b}}) e^{-i\\phi}|^2 $$\n令 $q_a = \\mathbf{q}\\cdot\\hat{\\mathbf{a}}$ 和 $q_b = \\mathbf{q}\\cdot\\hat{\\mathbf{b}}$。上式变为：\n$$ |M_a q_a + M_b q_b (\\cos\\phi - i\\sin\\phi)|^2 = (M_a q_a + M_b q_b \\cos\\phi)^2 + (-M_b q_b \\sin\\phi)^2 = M_a^2 q_a^2 + M_b^2 q_b^2 + 2 M_a M_b q_a q_b \\cos\\phi $$\n将各项合并，得到计算强度 $I_{calc}$ 的表达式：\n$$ I_{calc}(\\mathbf{q}) = s \\left[ (M_a^2 + M_b^2) - (M_a^2 q_a^2 + M_b^2 q_b^2 + 2 M_a M_b q_a q_b \\cos\\phi) \\right] $$\n$$ I_{calc}(\\mathbf{q}) = s \\left[ M_a^2(1-q_a^2) + M_b^2(1-q_b^2) - 2 M_a M_b q_a q_b \\cos\\phi \\right] $$\n其中 $s$ 是一个总尺度因子。\n\n### 2. 线性最小二乘法公式\n\n为了使用线性最小二乘法求解，我们将模型方程重写为：\n$$ I_{calc}(\\mathbf{q}) = s \\left( M_a^2(1-q_a^2) + M_b^2(1-q_b^2) \\right) + s\\cos\\phi \\left( -2 M_a M_b q_a q_b \\right) $$\n我们定义两个待求的线性参数 $x_1 = s$ 和 $x_2 = s\\cos\\phi$。对于每一次观测 $i$（对应一个散射方向 $\\mathbf{q}_i$），我们定义系数：\n$$ A_i = M_a^2(1-q_{a,i}^2) + M_b^2(1-q_{b,i}^2) $$\n$$ B_i = -2 M_a M_b q_{a,i} q_{b,i} $$\n这样，模型方程变为线性形式：$I_{obs,i} \\approx A_i x_1 + B_i x_2$。对于 $N$ 次观测，可以写成矩阵方程 $\\mathbf{y} \\approx \\mathbf{M} \\mathbf{x}$，其中：\n$$ \\mathbf{y} = \\begin{pmatrix} I_{obs, 1} \\\\ \\vdots \\\\ I_{obs, N} \\end{pmatrix}, \\quad \\mathbf{M} = \\begin{pmatrix} A_1  B_1 \\\\ \\vdots  \\vdots \\\\ A_N  B_N \\end{pmatrix}, \\quad \\mathbf{x} = \\begin{pmatrix} x_1 \\\\ x_2 \\end{pmatrix} $$\n该线性系统的最小二乘解 $\\hat{\\mathbf{x}}$ 可以通过求解正规方程 $(\\mathbf{M}^T \\mathbf{M}) \\hat{\\mathbf{x}} = \\mathbf{M}^T \\mathbf{y}$ 得到。\n从解 $\\hat{\\mathbf{x}} = (\\hat{x}_1, \\hat{x}_2)^T$ 中，我们可以恢复物理参数：\n$$ \\hat{s} = \\hat{x}_1 $$\n$$ \\cos\\hat{\\phi} = \\frac{\\hat{x}_2}{\\hat{x}_1} \\implies \\hat{\\phi} = \\arccos\\left(\\frac{\\hat{x}_2}{\\hat{s}}\\right) $$\n该方法将问题转化为一个标准的线性回归问题，可以通过数值方法高效求解。\n\n### 3. 实现算法\n以下Python代码实现了上述最小二乘精修算法，并应用于给定的三个测试案例。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the magnetic structure phase angle and scale factor from neutron\n    diffraction data for multiple test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"Ma\": 2.0, \"Mb\": 1.5,\n            \"a_hat\": np.array([1.0, 0.0, 0.0]),\n            \"b_hat\": np.array([0.0, 1.0, 0.0]),\n            \"Q_vectors\": [np.array(v) for v in [(0,0,1), (1,0,0), (1,1,0), (1,0,1), (0,1,1)]],\n            \"intensities\": [31.25, 11.25, 5.174399365, 21.25, 25.625]\n        },\n        {\n            \"Ma\": 1.0, \"Mb\": 2.0,\n            \"a_hat\": np.array([1.0, 0.0, 0.0]),\n            \"b_hat\": np.array([0.0, 1.0, 0.0]),\n            \"Q_vectors\": [np.array(v) for v in [(0,0,1), (0,1,0), (1,1,0), (1,0,1), (0,1,1), (1,-1,0)]],\n            \"intensities\": [18.5, 3.7, 16.65, 16.65, 11.1, 1.85]\n        },\n        {\n            \"Ma\": 1.8, \"Mb\": 1.8,\n            \"a_hat\": np.array([1.0, 0.0, 0.0]),\n            \"b_hat\": np.array([0.0, 1.0, 0.0]),\n            \"Q_vectors\": [np.array(v) for v in [(1,0,0), (0,1,0), (0,0,1), (1,2,0), (1,-2,0)]],\n            \"intensities\": [3.888, 3.888, 7.776, 0.7776, 6.9984]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        Ma = case[\"Ma\"]\n        Mb = case[\"Mb\"]\n        a_hat = case[\"a_hat\"]\n        b_hat = case[\"b_hat\"]\n        Q_vectors = case[\"Q_vectors\"]\n        y_obs = np.array(case[\"intensities\"])\n\n        Ma2 = Ma**2\n        Mb2 = Mb**2\n        \n        A_coeffs = []\n        B_coeffs = []\n\n        for Q_vec in Q_vectors:\n            # Normalize the scattering vector Q\n            q_hat = Q_vec / np.linalg.norm(Q_vec)\n            \n            # Projections of q_hat onto spin component axes\n            qa = np.dot(q_hat, a_hat)\n            qb = np.dot(q_hat, b_hat)\n\n            # Calculate coefficients for the linearized model\n            # I_calc = s * (A + B * cos(phi))\n            # A = Ma^2*(1-qa^2) + Mb^2*(1-qb^2)\n            # B = -2*Ma*Mb*qa*qb\n            A = Ma2 * (1 - qa**2) + Mb2 * (1 - qb**2)\n            B = -2 * Ma * Mb * qa * qb\n            \n            A_coeffs.append(A)\n            B_coeffs.append(B)\n\n        # Construct the design matrix M for the linear system M*x = y_obs\n        # where x = [s, s*cos(phi)]\n        M = np.array([A_coeffs, B_coeffs]).T\n        \n        # Solve the linear least-squares problem\n        x_sol, _, _, _ = np.linalg.lstsq(M, y_obs, rcond=None)\n        \n        x1 = x_sol[0]  # This is our estimate for s\n        x2 = x_sol[1]  # This is our estimate for s*cos(phi)\n\n        s_hat = x1\n        \n        # Calculate cos(phi) = (s*cos(phi)) / s\n        if abs(s_hat)  1e-9:\n             cos_phi_val = 0.0\n        else:\n             cos_phi_val = x2 / s_hat\n        \n        # Clip the value to the valid range [-1, 1] for arccos\n        cos_phi_val = np.clip(cos_phi_val, -1.0, 1.0)\n        \n        phi_hat = np.arccos(cos_phi_val)\n\n        results.append([round(phi_hat, 6), round(s_hat, 6)])\n\n    # Format the final output string\n    result_str = \"[\" + \",\".join([f\"[{phi},{s}]\" for phi, s in results]) + \"]\"\n    print(result_str)\n\nsolve()\n```", "id": "3007109"}]}