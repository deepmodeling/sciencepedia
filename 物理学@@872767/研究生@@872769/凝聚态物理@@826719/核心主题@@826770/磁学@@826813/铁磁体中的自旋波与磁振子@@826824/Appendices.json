{"hands_on_practices": [{"introduction": "为了理解自旋波，我们首先必须对其产生的背景——铁磁基态——有一个清晰的认识。第一个动手实践将带您回归基础，运用海森堡哈密顿量的基本对称性来确定系统在零温下对外磁场的响应。通过完成这项练习 [@problem_id:3017163]，您将巩固对自发对称性破缺和磁饱和等概念的理解。", "problem": "考虑一个具有周期性边界条件的 $N$ 个格点连通晶格上的量子海森堡铁磁体。每个格点上有一个自旋，其大小为 $S \\in \\{\\tfrac{1}{2}, 1, \\tfrac{3}{2}, \\dots\\}$。哈密顿量为\n$$\nH \\;=\\; H_{\\text{ex}} \\;+\\; H_{Z}, \\qquad H_{\\text{ex}} \\;=\\; -J \\sum_{\\langle i j\\rangle} \\mathbf{S}_{i}\\cdot \\mathbf{S}_{j}, \\qquad H_{Z} \\;=\\; -\\, g\\,\\mu_{B}\\, B \\sum_{i=1}^{N} S_{i}^{z},\n$$\n其中 $J>0$ (铁磁交换)，$g>0$ 为朗德因子，$\\mu_{B}$ 为玻尔磁子，$B \\in \\mathbb{R}$ 为沿 z 轴的均匀磁场。假设温度为零 ($T=0$)，除了所示的各向同性交换作用外没有其他磁各向异性，并且晶格结构允许存在完全对齐的自旋构型（这对任何连通格点都成立）。\n\n从转动不变性和角动量代数的第一性原理出发，确定在 $T=0$ 时，基态总磁化强度作为 $B$ 的函数。具体来说，推导基态的函数 $M_{\\text{tot}}(B) \\equiv g\\,\\mu_{B}\\,\\langle S_{\\text{tot}}^{z}\\rangle$，其中 $S_{\\text{tot}}^{z} \\equiv \\sum_{i=1}^{N} S_{i}^{z}$，并说明塞曼项如何在 $B\\neq 0$ 时从基态多重态中挑选出唯一的成员。\n\n将你的最终答案表示为总磁化强度除以 $g\\,\\mu_{B}$，即 $M_{\\text{tot}}(B)/(g\\,\\mu_{B})$，作为 $B$ 的函数的单一闭合形式解析表达式。如果需要在 $B=0$ 处赋值，请使用符号函数满足 $\\mathrm{sgn}(0)=0$ 的约定。不要对答案进行四舍五入。", "solution": "该问题要求确定量子海森堡铁磁体在零温 ($T=0$) 下的基态总磁化强度，作为外磁场 $B$ 的函数。分析将基于哈密顿量的对称性和量子角动量原理。\n\n系统的哈密顿量由 $H = H_{\\text{ex}} + H_{Z}$ 给出，其中：\n$$\nH_{\\text{ex}} = -J \\sum_{\\langle i j\\rangle} \\mathbf{S}_{i}\\cdot \\mathbf{S}_{j} \\quad (J>0)\n$$\n$$\nH_{Z} = -g\\mu_{B} B \\sum_{i=1}^{N} S_{i}^{z}\n$$\n此处，$\\mathbf{S}_i$ 是格点 $i$ 处的自旋算符，$J$ 是铁磁交换耦合，$\\langle ij \\rangle$ 表示对最近邻对的求和，$g$ 是朗德 g 因子，$\\mu_B$ 是玻尔磁子，$B$ 是沿 z 轴的外磁场，$N$ 是总格点数。\n\n首先，我们分析交换哈密顿量 $H_{\\text{ex}}$ 的对称性。令 $\\mathbf{S}_{\\text{tot}} = \\sum_{i=1}^{N} \\mathbf{S}_i$ 为系统的总自旋算符。总自旋的分量 $S_{\\text{tot}}^x$、$S_{\\text{tot}}^y$ 和 $S_{\\text{tot}}^z$ 遵守标准的 SU(2) 对易关系，例如 $[S_{\\text{tot}}^x, S_{\\text{tot}}^y] = i S_{\\text{tot}}^z$ (在 $\\hbar=1$ 的单位制中)。算符 $\\mathbf{S}_i \\cdot \\mathbf{S}_j$ 是一个标量积，在对两个自旋 $\\mathbf{S}_i$ 和 $\\mathbf{S}_j$ 进行同时转动时保持不变。由于 $H_{\\text{ex}}$ 是此类标量积的和，因此它在对所有自旋同时施加全局转动时保持不变。这意味着 $H_{\\text{ex}}$ 与总自旋算符的所有分量对易：\n$$\n[H_{\\text{ex}}, \\mathbf{S}_{\\text{tot}}] = 0\n$$\n这种转动不变性意味着 $H_{\\text{ex}}$ 的本征态可以与 $\\mathbf{S}_{\\text{tot}}^2$ 和其中一个分量（例如 $S_{\\text{tot}}^z$）同时对角化。本征态可以用总自旋量子数 $S_{\\text{tot}}$ 和总磁量子数 $m_{\\text{tot}}$ 来标记。由于对称性，$H_{\\text{ex}}$ 的能量本征值仅依赖于 $S_{\\text{tot}}$，并且对于 $m_{\\text{tot}}$ 是简并的，$m_{\\text{tot}}$ 可以取从 $-S_{\\text{tot}}$ 到 $S_{\\text{tot}}$ 的任何整数值。总自旋为 $S_{\\text{tot}}$ 的能级的简并度为 $(2S_{\\text{tot}}+1)$。\n\n为了找到 $H_{\\text{ex}}$ 的基态，我们需要使其能量最小化。由于 $J > 0$，当所有对 $\\langle ij \\rangle$ 的期望值 $\\langle \\mathbf{S}_i \\cdot \\mathbf{S}_j \\rangle$ 都最大化时，能量 $E_{\\text{ex}} = -J \\sum_{\\langle ij \\rangle} \\langle \\mathbf{S}_i \\cdot \\mathbf{S}_j \\rangle$ 达到最小值。这种情况发生在自旋最大程度对齐时，即它们都相互平行。这样的态具有最大可能的总自旋量子数，即 $S_{\\text{tot}} = NS$，其中 $S$ 是每个格点上的自旋大小。因此，交换哈密顿量的基态是由 $S_{\\text{tot}} = NS$ 表征的态的多重态。这个基态流形是 $(2(NS)+1)$ 度简并的，由 $m_{\\text{tot}} = -NS, -NS+1, \\dots, NS$ 的态 $|S_{\\text{tot}}=NS, m_{\\text{tot}}\\rangle$ 组成。所有这些态都具有相同的基态能量 $E_{0, \\text{ex}}$。\n\n接下来，我们考虑完整哈密顿量 $H = H_{\\text{ex}} + H_Z$。塞曼项可以写成 $H_Z = -g\\mu_B B S_{\\text{tot}}^z$。沿 z 轴的磁场 $B$ 的存在破坏了完全的 SU(2) 转动对称性。虽然 $H$ 仍然与 $S_{\\text{tot}}^z$ 对易（因为 $H_{\\text{ex}}$ 和 $S_{\\text{tot}}^z$ 都与 $S_{\\text{tot}}^z$ 对易），但在 $B \\neq 0$ 时，它不再与 $S_{\\text{tot}}^x$ 或 $S_{\\text{tot}}^y$ 对易。具体来说，$[H, S_{\\text{tot}}^x] = [H_Z, S_{\\text{tot}}^x] = -g\\mu_B B [S_{\\text{tot}}^z, S_{\\text{tot}}^x] = -i g\\mu_B B S_{\\text{tot}}^y \\neq 0$。\n\n构成 $H_{\\text{ex}}$ 基态多重态的态 $|NS, m_{\\text{tot}}\\rangle$ 也是 $S_{\\text{tot}}^z$ 的本征态。因此，它们也是完整哈密顿量 $H$ 的本征态：\n$$\nH |NS, m_{\\text{tot}}\\rangle = (H_{\\text{ex}} + H_Z) |NS, m_{\\text{tot}}\\rangle = H_{\\text{ex}}|NS, m_{\\text{tot}}\\rangle - g\\mu_B B S_{\\text{tot}}^z |NS, m_{\\text{tot}}\\rangle\n$$\n多重态中每个态的能量本征值 $E(m_{\\text{tot}})$ 为：\n$$\nE(m_{\\text{tot}}) = E_{0, \\text{ex}} - g\\mu_B B m_{\\text{tot}}\n$$\n塞曼项解除了基态多重态的简并。在零温 ($T=0$) 时，系统将处于具有绝对最小能量的态。为了找到这个态，我们必须在 $m_{\\text{tot}}$ 的允许范围 $\\{-NS, \\dots, NS\\}$ 内，关于 $m_{\\text{tot}}$ 最小化 $E(m_{\\text{tot}})$。\n\n$E(m_{\\text{tot}})$ 的最小化取决于磁场 $B$ 的符号，因为 $g$ 和 $\\mu_B$ 都是正常数。\n\n情况 1：$B>0$。为了最小化 $E(m_{\\text{tot}})$，我们必须最大化 $m_{\\text{tot}}$ 项。$m_{\\text{tot}}$ 的最大可能值为 $NS$。因此，对于 $B>0$，唯一的基态是 $|GS\\rangle = |NS, m_{\\text{tot}}=NS\\rangle$。此态下总自旋投影的期望值为 $\\langle S_{\\text{tot}}^z \\rangle = NS$。\n\n情况 2：$B0$。为了最小化 $E(m_{\\text{tot}})$，我们必须最小化 $m_{\\text{tot}}$ 项（因为 $B$ 是负的）。$m_{\\text{tot}}$ 的最小可能值为 $-NS$。因此，对于 $B0$，唯一的基态是 $|GS\\rangle = |NS, m_{\\text{tot}}=-NS\\rangle$。此态下总自旋投影的期望值为 $\\langle S_{\\text{tot}}^z \\rangle = -NS$。\n\n情况 3：$B=0$。哈密顿量简化为 $H=H_{\\text{ex}}$，塞曼项消失。基态是 $(2NS+1)$ 度简并的多重态 $|NS, m_{\\text{tot}}\\rangle$。在这种情况下，一个非转动不变量（如 $S_{\\text{tot}}^z$）的期望值通常取为在简并基态系综上的平均值，这在物理上对应于自发磁化没有优选方向。系综平均值为：\n$$\n\\langle S_{\\text{tot}}^z \\rangle_{B=0} = \\frac{\\sum_{m_{\\text{tot}}=-NS}^{NS} \\langle NS, m_{\\text{tot}}| S_{\\text{tot}}^z |NS, m_{\\text{tot}}\\rangle}{\\sum_{m_{\\text{tot}}=-NS}^{NS} 1} = \\frac{1}{2NS+1} \\sum_{m_{\\text{tot}}=-NS}^{NS} m_{\\text{tot}}\n$$\n这个求和是在关于零的对称范围内进行的，因此和恰好为零。因此，对于 $B=0$，我们有 $\\langle S_{\\text{tot}}^z \\rangle = 0$。\n\n结合这三种情况，我们可以将基态期望值 $\\langle S_{\\text{tot}}^z \\rangle$ 表示为 $B$ 的函数：\n$$\n\\langle S_{\\text{tot}}^z \\rangle (B) = \\begin{cases} NS  \\text{若 } B  0 \\\\ 0  \\text{若 } B = 0 \\\\ -NS  \\text{若 } B  0 \\end{cases}\n$$\n这个分段函数可以使用符号函数 $\\mathrm{sgn}(B)$ 紧凑地写出，并采用指定的约定 $\\mathrm{sgn}(0)=0$：\n$$\n\\langle S_{\\text{tot}}^z \\rangle (B) = NS \\, \\mathrm{sgn}(B)\n$$\n问题要求的是量 $M_{\\text{tot}}(B)/(g\\mu_B)$。总磁化强度定义为 $M_{\\text{tot}}(B) = g\\mu_B \\langle S_{\\text{tot}}^z \\rangle$。因此，\n$$\n\\frac{M_{\\text{tot}}(B)}{g\\mu_B} = \\langle S_{\\text{tot}}^z \\rangle (B) = NS \\, \\mathrm{sgn}(B)\n$$\n该表达式表示以 $\\hbar$ 为单位的基态总自旋投影，对于任何非零场，它都会（正向或负向）完全饱和，而在零场时由于基态流形中完全转动对称性的恢复而消失。", "answer": "$$\n\\boxed{NS \\, \\mathrm{sgn}(B)}\n$$", "id": "3017163"}, {"introduction": "在确定了基态之后，我们现在引入温度，并探讨热激发磁振子带来的后果。这项练习 [@problem_id:3017157] 至关重要，它将引导您通过分析二维长程有序的稳定性，来发现统计力学中的一个深刻结论——Mermin-Wagner 定理。您将研究各向异性如何能够稳定铁磁相，从而在理论模型与真实的二维磁性材料之间建立起关键的联系。", "problem": "考虑一个二维各向同性海森堡铁磁体，在长波、低温区域，其自旋动力学可以很好地由无相互作用的磁振子（线性自旋波理论）描述。设磁振子色散由无能隙形式 $\\epsilon_{\\mathbf{k}}=D k^{2}$（各向同性情况）或有能隙形式 $\\epsilon_{\\mathbf{k}}=\\Delta + D k^{2}$（易轴各向异性情况）给出，其中 $D$ 是自旋波刚度，$\\Delta0$ 是各向异性能隙。由热磁振子引起的磁化密度减少量为\n$$\n\\delta M(T)= (g\\,\\mu_{B}) \\int \\frac{d^{2}k}{(2\\pi)^{2}}\\, n_{B}(\\epsilon_{\\mathbf{k}}),\n$$\n其中 $g$ 是朗德因子，$\\mu_{B}$ 是玻尔磁子，$n_{B}(x)=\\left[\\exp(x/T)-1\\right]^{-1}$ 是玻色-爱因斯坦（BE）分布。使用的单位制中，玻尔兹曼常数 $k_{B}=1$，因此温度 $T$ 的单位是能量。\n\n(a) 仅使用 $\\epsilon_{\\mathbf{k}}$ 的长波形式，分析无能隙情况 $\\epsilon_{\\mathbf{k}}=Dk^{2}$ 下积分的红外行为，并确定对于任意固定的 $T0$，$\\delta M(T)$ 是有限的还是发散的。\n\n(b) 对于有能隙情况 $\\epsilon_{\\mathbf{k}}=\\Delta + D k^{2}$，在低温极限 $T\\ll \\Delta$ 下，推导 $\\delta M(T)$ 的领头阶渐近形式。你的推导必须从上面的表达式出发，并基于玻色-爱因斯坦分布和连续 $\\mathbf{k}$ 空间积分的第一性原理进行，不得引用任何预先制表的渐近结果。\n\n对于有能隙情况，请提供单位面积上 $\\delta M(T)$ 的领头阶低温渐近形式的单一闭式解析表达式，用 $g$、$\\mu_{B}$、$D$、$\\Delta$ 和 $T$ 表示。通过显式保留 $g\\,\\mu_{B}$，以单位面积的磁矩为单位来表示答案。不需要进行数值计算。", "solution": "### 解答\n\n**(a) 无能隙情况（$\\epsilon_{\\mathbf{k}}=Dk^{2}$）的分析**\n\n对于无能隙情况，磁化密度的减少量由下式给出：\n$$ \\delta M(T) = (g\\,\\mu_{B}) \\int \\frac{d^{2}k}{(2\\pi)^{2}}\\, n_{B}(Dk^{2}) = (g\\,\\mu_{B}) \\int \\frac{d^{2}k}{(2\\pi)^{2}}\\, \\frac{1}{\\exp(Dk^{2}/T) - 1} $$\n我们需要分析红外行为，这对应于小波矢（即 $k \\to 0$）时积分的行为。对于任意固定温度 $T0$，当 $k \\to 0$ 时，指数的自变量 $Dk^{2}/T \\to 0$。在此极限下，我们可以使用指数函数的泰勒展开，对于小的 $x$，有 $\\exp(x) \\approx 1 + x$。\n将此应用于玻色-爱因斯坦分布：\n$$ n_{B}(Dk^{2}) = \\frac{1}{\\exp(Dk^{2}/T) - 1} \\approx \\frac{1}{(1 + Dk^{2}/T) - 1} = \\frac{T}{Dk^{2}} \\quad \\text{for } k \\to 0 $$\n$\\delta M(T)$ 的积分是在二维 $\\mathbf{k}$ 空间上进行的。方便起见，我们转换到极坐标，其中面积微元为 $d^{2}k = 2\\pi k \\, dk$。积分变为：\n$$ \\delta M(T) = \\frac{g\\,\\mu_{B}}{(2\\pi)^2} \\int_{0}^{k_{c}} 2\\pi k \\, dk \\, n_{B}(Dk^{2}) = \\frac{g\\,\\mu_{B}}{2\\pi} \\int_{0}^{k_{c}} k \\, dk \\, \\frac{1}{\\exp(Dk^{2}/T) - 1} $$\n其中 $k_{c}$ 是一个上限截止波矢，定义了长波区域的边界。积分的收敛性由其在下限 $k=0$ 附近的行为决定。代入被积函数的小 $k$ 近似：\n$$ \\int_{0}^{k_{c}} k \\left(\\frac{T}{Dk^{2}}\\right) dk = \\frac{T}{D} \\int_{0}^{k_{c}} \\frac{1}{k} \\, dk $$\n该积分的形式为 $\\int (1/k) \\, dk = \\ln(k)$。从一个小的、非零的下限 $\\epsilon \\to 0$ 开始计算：\n$$ \\lim_{\\epsilon \\to 0} \\left[ \\ln(k) \\right]_{\\epsilon}^{k_{c}} = \\ln(k_{c}) - \\lim_{\\epsilon \\to 0} \\ln(\\epsilon) $$\n当 $\\epsilon \\to 0$ 时，$\\ln(\\epsilon) \\to -\\infty$。因此，积分在下限处对数发散。这被称为红外发散。\n因此，对于任何有限温度 $T  0$，计算出的磁化减少量 $\\delta M(T)$ 是无穷大的。这意味着热涨落完全破坏了长程铁磁序，这一结果与适用于具有连续对称性和短程相互作用的二维系统的 Mermin-Wagner 定理一致。\n\n**(a) 的结论：** 对于任意 $T0$，$\\delta M(T)$ 是发散的。\n\n**(b) 有能隙情况（$\\epsilon_{\\mathbf{k}}=\\Delta + D k^{2}$）的渐近形式**\n\n对于有能隙情况，磁化减少量为：\n$$ \\delta M(T) = (g\\,\\mu_{B}) \\int \\frac{d^{2}k}{(2\\pi)^{2}}\\, \\frac{1}{\\exp((\\Delta + D k^{2})/T) - 1} $$\n我们关心的是低温极限，其中 $T \\ll \\Delta$。这意味着比率 $\\Delta/T \\gg 1$。\n玻色-爱因斯坦分布的自变量是 $(\\Delta + Dk^2)/T$。由于 $\\Delta  0$、$D  0$ 且 $k^2 \\ge 0$，该自变量总是大于或等于 $\\Delta/T$。鉴于 $T \\ll \\Delta$，该自变量总是大的。\n对于一个大的自变量 $x \\gg 1$，玻色-爱因斯坦分布可以通过忽略分母中与大的 $\\exp(x)$ 项相比的 $-1$ 来近似：\n$$ n_{B}(x) = \\frac{1}{\\exp(x) - 1} \\approx \\frac{1}{\\exp(x)} = \\exp(-x) $$\n将此近似应用于我们的积分：\n$$ \\delta M(T) \\approx (g\\,\\mu_{B}) \\int \\frac{d^{2}k}{(2\\pi)^{2}}\\, \\exp\\left(-\\frac{\\Delta + D k^{2}}{T}\\right) $$\n我们将 $\\mathbf{k}$ 空间上的积分转换为极坐标，其中 $k = |\\mathbf{k}|$，$d^{2}k = 2\\pi k \\, dk$。$k$ 的积分范围是从 $0$ 到 $\\infty$。来自大 $k$ 的贡献被指数抑制，因此将上限从有限的截止值 $k_c$ 扩展到无穷大不会影响领头阶渐近行为。\n$$ \\delta M(T) \\approx \\frac{g\\,\\mu_{B}}{(2\\pi)^2} \\int_0^\\infty (2\\pi k \\, dk) \\, \\exp\\left(-\\frac{\\Delta}{T}\\right) \\exp\\left(-\\frac{D k^{2}}{T}\\right) $$\n简化并提出与 $k$ 无关的项：\n$$ \\delta M(T) \\approx \\frac{g\\,\\mu_{B}}{2\\pi} \\exp\\left(-\\frac{\\Delta}{T}\\right) \\int_0^\\infty k \\exp\\left(-\\frac{D}{T} k^{2}\\right) dk $$\n剩下的积分是一个标准的高斯积分。我们来计算它。我们进行变量代换。令 $u = \\frac{D}{T} k^{2}$。则 $du = \\frac{2D}{T} k \\, dk$，这给出 $k \\, dk = \\frac{T}{2D} du$。$u$ 的积分上下限为从 $u(k=0)=0$ 到 $u(k=\\infty)=\\infty$。\n$$ \\int_0^\\infty k \\exp\\left(-\\frac{D}{T} k^{2}\\right) dk = \\int_0^\\infty \\exp(-u) \\left(\\frac{T}{2D} du\\right) = \\frac{T}{2D} \\int_0^\\infty \\exp(-u) du $$\n定积分 $\\int_0^\\infty \\exp(-u) du = [-\\exp(-u)]_0^\\infty = (0) - (-1) = 1$。\n所以，该积分的值是 $\\frac{T}{2D}$。\n将此结果代回到 $\\delta M(T)$ 的表达式中：\n$$ \\delta M(T) \\approx \\frac{g\\,\\mu_{B}}{2\\pi} \\exp\\left(-\\frac{\\Delta}{T}\\right) \\left(\\frac{T}{2D}\\right) $$\n合并各项，得到低温极限下磁化减少量的领头阶渐近形式：\n$$ \\delta M(T) \\approx \\frac{g\\,\\mu_{B} T}{4\\pi D} \\exp\\left(-\\frac{\\Delta}{T}\\right) $$\n这个表达式表明，由于能隙 $\\Delta$ 的存在，在低温下磁化减少量被指数抑制。", "answer": "$$\n\\boxed{\\frac{g \\mu_{B} T}{4 \\pi D} \\exp\\left(-\\frac{\\Delta}{T}\\right)}\n$$", "id": "3017157"}, {"introduction": "理论模型固然强大，但其最终的检验标准在于实验。这最后一个实践将带您从解析推导走向计算物理，挑战您去弥合理论与非弹性中子散射实验数据之间的鸿沟。您将设计一个程序，从模拟的实验数据中提取交换常数等基本参数，同时还要考虑仪器分辨率等实际的复杂因素。这项练习 [@problem_id:3017112] 将为您提供宝贵的实践经验，让您了解物理学家是如何量化和验证他们的理论的。", "problem": "您的任务是构建一个完整、有理论依据的估计器，使用第一性原理基线并考虑仪器分辨率，从铁磁体中磁振子的合成非弹性中子散射数据中提取交换常数。您的估计器必须实现为一个程序，该程序能够 (i) 从已知的基准实况参数合成测量数据，(ii) 使用源于仪器分辨率、具有物理基础的权重对合成数据进行模型参数拟合，以及 (iii) 报告从费雪信息中估计出的不确定度。所有结果必须以毫电子伏特 (meV) 为单位报告，并且所有三角函数参数必须以弧度为单位进行计算。最终程序必须打印一行包含列表的列表的浮点数，具体格式见“最终输出格式”部分。\n\n本问题的基础是布拉维格子上具有自旋 $S$ 和弱单轴各向异性的量子海森堡铁磁体。其哈密顿量为\n$$\n\\hat{H} \\;=\\; -\\sum_{\\langle i,j \\rangle} J_{ij}\\,\\hat{\\mathbf{S}}_i\\cdot \\hat{\\mathbf{S}}_j \\;-\\; K\\sum_i \\left(\\hat{S}_i^z\\right)^2,\n$$\n其中交换常数 $J_{ij} \\ge 0$ 倾向于铁磁排列，各向异性 $K \\ge 0$。在线性自旋波近似下，围绕铁磁基态存在一个能量为 $\\epsilon_{\\mathbf{q}}$ 的单磁振子分支和一个集中在 $\\omega = \\epsilon_{\\mathbf{q}}/\\hbar$ 的类 delta 函数的动力学结构因子 $S(\\mathbf{q},\\omega)$。非弹性中子谱仪的仪器分辨率可以通过动量和能量上的高斯展宽来建模。当在固定的名义波矢 $\\mathbf{q}$ 下进行能量 $\\omega$ 扫描时，通过误差传播，会产生一个由内禀能量分辨率和色散斜率共同导致的有效能量宽度。\n\n您必须设计并实现一个程序，该程序能够：\n- 从线性自旋波框架出发，为一维空间中的铁磁体（最多包含次近邻交换作用）以及二维方晶格沿 $\\Gamma$–$X$ 方向（仅限近邻交换作用）构建磁振子色散关系 $\\epsilon_{\\mathbf{q}}$。各向异性在 $\\mathbf{q}=0$ 处引入一个能隙 $\\Delta$。\n- 在离散动量 $\\{\\mathbf{q}_i\\}$ 处合成“测量的”峰值能量 $\\{\\epsilon_i\\}$，以及相应的动力学结构因子 $S(\\mathbf{q}_i,\\omega)$。该结构因子在能量上是一个以 $\\epsilon_i$ 为中心的高斯函数，其有效宽度通过传播仪器分辨率得到。就本任务而言，您应将测量的峰值位置视为在采样动量下的真实色散值，同时使用有效宽度来定义参数估计中的统计权重。\n- 通过加权非线性最小二乘法估计未知的交换常数和各向异性能隙，其中每个点的权重使用受仪器分辨率限制的有效方差。使用费雪信息（等效于加权最小二乘目标函数的曲率）来估计拟合参数的一个标准差不确定度。\n- 为每个指定的测试用例生成结果，并将它们汇总为单行输出。\n\n您的估计器必须遵循以下物理和数学规范：\n\n- 从线性自旋波理论的结果出发，即 $S(\\mathbf{q},\\omega)$ 中的单磁振子峰位于磁振子色散 $\\epsilon_{\\mathbf{q}}$ 处，并且该色散由铁磁相中交换耦合的傅里叶变换以及一个各向异性诱导的能隙 $\\Delta$ 共同决定。\n- 对于具有近邻间距 $a$、交换常数 $J_1$（近邻）和 $J_2$（次近邻）以及自旋 $S$ 的一维链，您必须推导出色散 $\\epsilon_q$ 作为波矢 $q$ 的函数，以及不确定度传播所需的动量导数 $\\partial \\epsilon_q/\\partial q$。能隙 $\\Delta$ 以能量单位加和的形式进入方程。对于仅有近邻交换作用 $J_1$ 的二维方晶格，沿着 $q_y = 0$ 的 $\\Gamma$–$X$ 路径，您必须推导出沿此路径的类似色散关系和斜率。\n- 将每个名义动量下的动力学结构因子建模为\n$$\nS(\\mathbf{q}_i,\\omega) \\;=\\; A_i \\exp\\!\\left[-\\frac{\\left(\\omega - \\epsilon_{\\mathbf{q}_i}\\right)^2}{2\\,\\sigma_{\\mathrm{eff}}(\\mathbf{q}_i)^2}\\right],\n$$\n其中振幅 $A_i$ 为常数，可取为1，以及一个有效能量宽度\n$$\n\\sigma_{\\mathrm{eff}}(\\mathbf{q}_i) \\;=\\; \\sqrt{ \\sigma_\\omega^2 \\;+\\; \\left(\\frac{\\partial \\epsilon_{\\mathbf{q}}}{\\partial q}\\bigg|_{\\mathbf{q}_i}\\right)^2 \\sigma_q^2 }.\n$$\n此处，$\\sigma_\\omega$ 是仪器的能量分辨率（单位 meV），$\\sigma_q$ 是动量分辨率（单位 埃⁻¹），而 $\\partial \\epsilon_{\\mathbf{q}}/\\partial q$ 是对于一维切割，色散斜率在扫描方向上的投影。将 $q a$ 视为弧度。\n- 在对测量峰值能量 $\\{\\epsilon_i\\}$ 进行模型参数 $\\boldsymbol{\\theta}$ 的加权非线性最小二乘拟合时，使用有效方差 $\\sigma_{\\mathrm{eff}}(\\mathbf{q}_i)^2$ 作为权重。即，最小化残差平方和\n$$\n\\chi^2(\\boldsymbol{\\theta}) \\;=\\; \\sum_i \\frac{\\left[ \\epsilon_i - \\epsilon_{\\mathrm{model}}(\\mathbf{q}_i;\\boldsymbol{\\theta}) \\right]^2}{\\sigma_{\\mathrm{eff}}(\\mathbf{q}_i;\\boldsymbol{\\theta})^2},\n$$\n将有效方差视为已知。在优化过程中，您可以使用当前的参数估计值迭代地重新计算 $\\sigma_{\\mathrm{eff}}$。\n- 从费雪信息矩阵估计参数不确定度\n$$\n\\mathcal{I}(\\boldsymbol{\\theta}^\\star) \\;=\\; \\mathbf{J}(\\boldsymbol{\\theta}^\\star)^\\top \\mathbf{W}(\\boldsymbol{\\theta}^\\star) \\mathbf{J}(\\boldsymbol{\\theta}^\\star),\n$$\n其中 $\\mathbf{J}$ 是无权模型 $\\epsilon_{\\mathrm{model}}(\\mathbf{q}_i;\\boldsymbol{\\theta})$ 关于参数的雅可比矩阵，在最佳拟合参数 $\\boldsymbol{\\theta}^\\star$ 处求值；$\\mathbf{W}$ 是对角权重矩阵，其元素为 $1/\\sigma_{\\mathrm{eff}}^2$。将 $\\mathcal{I}^{-1}$ 对角线元素的平方根作为一倍标准差不确定度进行报告。\n\n测试套件。实现并解决以下三个测试用例。对于每个用例，使用提供的基准实况参数合成数据，然后通过您的程序估计参数。\n\n- 用例 1（一维链，仅近邻）：\n  - 自旋 $S = 1$。\n  - 晶格间距 $a = 2.7$ 埃。\n  - 基准实况：$J_1 = 3.2$ meV, $\\Delta = 0.35$ meV。\n  - 仪器分辨率：$\\sigma_q = 0.03$ 埃⁻¹，$\\sigma_\\omega = 0.12$ meV。\n  - 采样：波矢 $q$ 在 $[0.0, 1.0]$ 埃⁻¹ 区间内均匀取样，步长为 $0.05$ 埃⁻¹。\n  - 待拟合并报告的未知量：$J_1$ 和 $\\Delta$。\n- 用例 2（一维链，含次近邻）：\n  - 自旋 $S = 1$。\n  - 晶格间距 $a = 3.0$ 埃。\n  - 基准实况：$J_1 = 2.8$ meV, $J_2 = 0.6$ meV, $\\Delta = 0.20$ meV。\n  - 仪器分辨率：$\\sigma_q = 0.02$ 埃⁻¹，$\\sigma_\\omega = 0.08$ meV。\n  - 采样：波矢 $q$ 在 $[0.0, 0.9]$ 埃⁻¹ 区间内均匀取样，步长为 $0.03$ 埃⁻¹。\n  - 待拟合并报告的未知量：$J_1$, $J_2$ 和 $\\Delta$。\n- 用例 3（二维方晶格沿 $\\Gamma$–$X$，仅近邻）：\n  - 自旋 $S = 1$。\n  - 晶格间距 $a = 3.1$ 埃。\n  - 基准实况：$J_1 = 5.0$ meV, $\\Delta = 0.40$ meV。\n  - 仪器分辨率：$\\sigma_q = 0.04$ 埃⁻¹，$\\sigma_\\omega = 0.15$ meV。\n  - 采样：波矢沿 $\\Gamma$–$X$ 路径，其中 $q_x$ 在 $[0.0, 0.8]$ 埃⁻¹ 区间内均匀取样，步长为 $0.04$ 埃⁻¹，且 $q_y = 0$。\n  - 待拟合并报告的未知量：$J_1$ 和 $\\Delta$。\n\n角度约定和单位：\n- 始终使用以弧度为单位的 $q a$ 来计算三角函数。\n- 所有交换常数 $J_1$, $J_2$ 和能隙 $\\Delta$ 的单位均为 meV。\n- 动量 $q$ 的单位为 埃⁻¹。\n- 仪器分辨率 $\\sigma_q$ 和 $\\sigma_\\omega$ 的单位分别为 埃⁻¹ 和 meV。\n\n最终输出格式：\n- 对于用例 1，输出列表 $[J_1,\\Delta,\\sigma_{J_1},\\sigma_{\\Delta}]$。\n- 对于用例 2，输出列表 $[J_1,J_2,\\Delta,\\sigma_{J_1},\\sigma_{J_2},\\sigma_{\\Delta}]$。\n- 对于用例 3，输出列表 $[J_1,\\Delta,\\sigma_{J_1},\\sigma_{\\Delta}]$。\n- 您的程序应生成单行输出，其中包含一个由这三个特定用例列表组成的列表，所有数字四舍五入到三位小数，并以方括号括起来的逗号分隔列表形式呈现。例如：\n  - \"[[case1_vals],[case2_vals],[case3_vals]]\"\n- 不应打印任何其他文本。\n\n您的实现必须是确定性的，且不得使用任何外部输入。不要向合成数据添加随机噪声；仅通过指定的有效宽度来包含仪器分辨率。所有三角函数参数使用弧度，并报告所有能量值，单位为 meV，四舍五入到三位小数。", "solution": "### 第1部分：理论模型推导\n\n分析始于包含单轴各向异性项的海森堡哈密顿量：\n$$\n\\hat{H} = -\\sum_{\\langle i,j \\rangle} J_{ij}\\,\\hat{\\mathbf{S}}_i\\cdot \\hat{\\mathbf{S}}_j - K\\sum_i \\left(\\hat{S}_i^z\\right)^2\n$$\n在线性自旋波近似下，可以推导出布拉维晶格的磁振子色散关系 $\\epsilon_{\\mathbf{q}}$。通过 Holstein-Primakoff 变换并保留玻色子算符的二次项，得到的标准结果是：\n$$\n\\epsilon_{\\mathbf{q}} = \\Delta + 2S \\left[ J(\\mathbf{0}) - J(\\mathbf{q}) \\right]\n$$\n此处，$J(\\mathbf{q}) = \\sum_{\\mathbf{R}} J_{\\mathbf{R}} e^{i\\mathbf{q}\\cdot\\mathbf{R}}$ 是交换相互作用 $J_{ij} = J(\\mathbf{R}_i - \\mathbf{R}_j)$ 的傅里叶变换。项 $\\Delta$ 是在 $\\mathbf{q}=\\mathbf{0}$ 处的能隙，源于对称性破缺的各向异性项。根据问题陈述，我们将 $\\Delta$ 视为一个唯象的附加参数。基于这些原理，我们推导测试用例所需的特定色散关系及其斜率。\n\n**用例1和3：具有近邻（NN）相互作用的一维链和二维方晶格（$\\Gamma-X$）**\n对于晶格间距为 $a$ 且具有近邻交换作用 $J_1$ 的一维链，以及沿 $\\Gamma-X$ 路径（$q_y=0, q_x=q$）的二维方晶格，其色散关系具有相同的函数形式。\n给定自旋 $S=1$，模型为：\n$$\n\\epsilon(q; J_1, \\Delta) = \\Delta + 4 J_1 (1 - \\cos(qa))\n$$\n对于有效分辨率计算所需的关于波矢 $q$ 的导数是：\n$$\n\\frac{\\partial\\epsilon}{\\partial q} = 4 J_1 a \\sin(qa)\n$$\n\n**用例2：具有次近邻（NNN）相互作用的一维链**\n该模型同时包括近邻交换作用 $J_1$（距离为 $a$）和次近邻交换作用 $J_2$（距离为 $2a$）。当 $S=1$ 时：\n$$\n\\epsilon(q; J_1, J_2, \\Delta) = \\Delta + 4 J_1 (1 - \\cos(qa)) + 4 J_2 (1 - \\cos(2qa))\n$$\n相应的色散斜率是：\n$$\n\\frac{\\partial\\epsilon}{\\partial q} = 4 J_1 a \\sin(qa) + 8 J_2 a \\sin(2qa)\n$$\n\n### 第2部分：参数估计和不确定度量化\n\n估计过程基于加权非线性最小二乘法。我们的目标是找到使卡方函数最小化的参数 $\\boldsymbol{\\theta}$：\n$$\n\\chi^2(\\boldsymbol{\\theta}) = \\sum_i \\frac{\\left[ \\epsilon_i - \\epsilon_{\\mathrm{model}}(\\mathbf{q}_i;\\boldsymbol{\\theta}) \\right]^2}{\\sigma_{\\mathrm{eff}}(\\mathbf{q}_i;\\boldsymbol{\\theta})^2}\n$$\n数据点 $\\{\\epsilon_i\\}$ 是使用基准实况参数合成的，不添加噪声：$\\epsilon_i = \\epsilon_{\\mathrm{model}}(\\mathbf{q}_i; \\boldsymbol{\\theta}_{\\text{true}})$。统计权重由有效能量方差 $\\sigma_{\\mathrm{eff}}^2$ 推导得出。\n\n由于权重 $w_i = 1/\\sigma_{\\mathrm{eff}}^2$ 通过色散斜率 $\\partial\\epsilon/\\partial q$ 依赖于模型参数 $\\boldsymbol{\\theta}$，因此采用迭代重加权最小二乘（IRLS）程序。\n\n1.  **初始化**：从参数的初始猜测值 $\\boldsymbol{\\theta}_0$ 开始。\n2.  **迭代**：对于步骤 $k=0, 1, 2, \\dots$：\n    a.  为每个动量点计算色散斜率 $\\frac{\\partial\\epsilon}{\\partial q}(\\mathbf{q}_i; \\boldsymbol{\\theta}_k)$。\n    b.  计算有效标准差 $\\sigma_{\\mathrm{eff}}(\\mathbf{q}_i; \\boldsymbol{\\theta}_k) = \\sqrt{\\sigma_\\omega^2 + \\left(\\frac{\\partial\\epsilon}{\\partial q}\\right)^2 \\sigma_q^2}$。\n    c.  使用权重 $w_i = 1/\\sigma_{\\mathrm{eff}}^2(\\mathbf{q}_i; \\boldsymbol{\\theta}_k)$ 求解关于 $\\boldsymbol{\\theta}_{k+1}$ 的加权最小二乘问题。这可通过 `scipy.optimize.curve_fit` 实现。\n3.  **收敛**：当参数估计值收敛时，即 $\\|\\boldsymbol{\\theta}_{k+1} - \\boldsymbol{\\theta}_k\\|$ 低于一个小的容差时，循环终止。\n\n在收敛到最佳拟合参数 $\\boldsymbol{\\theta}^\\star$ 后，估计参数的不确定度。`curve_fit` 函数在使用 `absolute_sigma=True` 时，返回协方差矩阵 $\\mathbf{C} = \\mathcal{I}^{-1}$，其中 $\\mathcal{I}$ 是费雪信息矩阵：\n$$\n\\mathcal{I}_{jk} = \\sum_i \\frac{1}{\\sigma_{\\mathrm{eff}}(\\mathbf{q}_i; \\boldsymbol{\\theta}^\\star)^2} \\frac{\\partial\\epsilon_{\\mathrm{model}}(\\mathbf{q}_i)}{\\partial\\theta_j} \\frac{\\partial\\epsilon_{\\mathrm{model}}(\\mathbf{q}_i)}{\\partial\\theta_k}\n$$\n参数 $\\theta_j$ 的一倍标准差不确定度由 $\\sigma_j = \\sqrt{C_{jj}} = \\sqrt{(\\mathcal{I}^{-1})_{jj}}$ 给出。\n\n### 第3部分：测试用例的实现\n\n构建了一个 Python 程序，为三个指定的测试用例中的每一个实现这整个工作流程。\n\n-   一个通用的求解器函数封装了 IRLS 程序和不确定度计算。\n-   具体的物理模型及其导数被定义为独立的函数。\n-   对于每个用例，将适当的模型、基准实况参数以及仪器/采样参数提供给求解器。\n-   拟合程序中所有参数的初始猜测值都设置为 $1.0$。由于合成数据是无噪声的，拟合预期会精确收敛到基准实况值。计算的非平凡部分在于不确定度的确定。\n-   收集每个用例的最终结果，格式化为三位小数，并严格按照指定的输出格式，作为单行的列表的列表打印出来。\n-   该代码被设计为确定性和自包含的，使用 `numpy` 进行数值运算，并使用 `scipy.optimize.curve_fit` 作为核心拟合算法。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import curve_fit\nfrom functools import partial\n\n# --- Part 1: Physical Models and Derivatives ---\n\n# For cases 1 and 3 (NN model on 1D chain or Gamma-X in 2D)\ndef model_nn(q, J1, Delta, S, a):\n    \"\"\"Magnon dispersion for NN model.\"\"\"\n    return Delta + 4 * S * J1 * (1 - np.cos(q * a))\n\ndef slope_nn(q, J1, Delta, S, a):\n    \"\"\"Dispersion slope for NN model. Delta is a dummy arg for signature matching.\"\"\"\n    return 4 * S * J1 * a * np.sin(q * a)\n\n# For case 2 (NNN model on 1D chain)\ndef model_nnn(q, J1, J2, Delta, S, a):\n    \"\"\"Magnon dispersion for NNN model.\"\"\"\n    return Delta + 4 * S * J1 * (1 - np.cos(q * a)) + 4 * S * J2 * (1 - np.cos(2 * q * a))\n\ndef slope_nnn(q, J1, J2, Delta, S, a):\n    \"\"\"Dispersion slope for NNN model. Delta is a dummy arg for signature matching.\"\"\"\n    return 4 * S * J1 * a * np.sin(q * a) + 8 * S * J2 * a * np.sin(2 * q * a)\n\n# --- Part 2: Parameter Estimation ---\n\ndef estimate_parameters(q_data, model_func, slope_func, true_params, sigma_q, sigma_omega, p0):\n    \"\"\"\n    Synthesizes data and fits parameters using Iteratively Reweighted Least Squares.\n    \n    Args:\n        q_data (np.array): Array of wavevectors.\n        model_func (callable): The dispersion model function f(q, *params).\n        slope_func (callable): The dispersion slope function df/dq(q, *params).\n        true_params (list): Ground-truth parameters for data synthesis.\n        sigma_q (float): Momentum resolution.\n        sigma_omega (float): Energy resolution.\n        p0 (list): Initial guess for parameters.\n\n    Returns:\n        tuple: (best_fit_params, uncertainties)\n    \"\"\"\n    # Synthesize \"measured\" data using ground-truth parameters (no noise)\n    epsilon_data = model_func(q_data, *true_params)\n    \n    p_k = np.array(p0, dtype=float)\n    \n    # Iteratively Reweighted Least Squares (IRLS) loop\n    for _ in range(15):  # 15 iterations is more than sufficient for convergence\n        p_prev = p_k.copy()\n        \n        # Calculate weights based on current parameter estimates\n        slope_k = slope_func(q_data, *p_k)\n        sigma_eff_k = np.sqrt(sigma_omega**2 + (slope_k**2) * sigma_q**2)\n        # Prevent division by zero if sigma_eff is ever zero.\n        sigma_eff_k[sigma_eff_k  1e-12] = 1e-12\n        \n        # Perform weighted non-linear least squares fit\n        try:\n            popt, _ = curve_fit(model_func, q_data, epsilon_data, p0=p_k, sigma=sigma_eff_k, absolute_sigma=True)\n            p_k = popt\n        except RuntimeError:\n            # Fit failed, break with last good parameters\n            p_k = p_prev  # Revert to previous\n            break\n\n        # Check for convergence\n        if np.allclose(p_k, p_prev, rtol=1e-9, atol=1e-9):\n            break\n            \n    # Final fit at converged parameters to get the covariance matrix\n    p_final = p_k\n    slope_final = slope_func(q_data, *p_final)\n    sigma_eff_final = np.sqrt(sigma_omega**2 + (slope_final**2) * sigma_q**2)\n    sigma_eff_final[sigma_eff_final  1e-12] = 1e-12\n\n    popt, pcov = curve_fit(model_func, q_data, epsilon_data, p0=p_final, sigma=sigma_eff_final, absolute_sigma=True)\n    \n    # Uncertainties are the sqrt of the diagonal of the covariance matrix\n    perr = np.sqrt(np.diag(pcov))\n    \n    return popt, perr\n\ndef solve():\n    \"\"\"\n    Main function to solve the specified test cases and print the results.\n    \"\"\"\n    # --- Part 3: Test Suite ---\n    \n    # Case 1: 1D chain, NN\n    case1 = {\n        'S': 1.0, 'a': 2.7,\n        'true_params': [3.2, 0.35],  # [J1, Delta]\n        'p0': [1.0, 1.0],\n        'sigma_q': 0.03, 'sigma_omega': 0.12,\n        'q_range': (0.0, 1.0, 21), # start, stop, num_points\n        'model': model_nn, 'slope': slope_nn,\n        'num_params': 2\n    }\n\n    # Case 2: 1D chain, NNN\n    case2 = {\n        'S': 1.0, 'a': 3.0,\n        'true_params': [2.8, 0.6, 0.20],  # [J1, J2, Delta]\n        'p0': [1.0, 1.0, 1.0],\n        'sigma_q': 0.02, 'sigma_omega': 0.08,\n        'q_range': (0.0, 0.9, 31),\n        'model': model_nnn, 'slope': slope_nnn,\n        'num_params': 3\n    }\n    \n    # Case 3: 2D square lattice, NN, Gamma-X\n    case3 = {\n        'S': 1.0, 'a': 3.1,\n        'true_params': [5.0, 0.40], # [J1, Delta]\n        'p0': [1.0, 1.0],\n        'sigma_q': 0.04, 'sigma_omega': 0.15,\n        'q_range': (0.0, 0.8, 21),\n        'model': model_nn, 'slope': slope_nn,\n        'num_params': 2\n    }\n\n    test_cases = [case1, case2, case3]\n    all_results = []\n\n    for case in test_cases:\n        # Generate q-vector\n        q_start, q_stop, q_num = case['q_range']\n        q_data = np.linspace(q_start, q_stop, q_num)\n\n        # Create model and slope functions with fixed S and a\n        model = partial(case['model'], S=case['S'], a=case['a'])\n        slope = partial(case['slope'], S=case['S'], a=case['a'])\n        \n        # Estimate parameters and uncertainties\n        popt, perr = estimate_parameters(\n            q_data, model, slope,\n            case['true_params'], case['sigma_q'], case['sigma_omega'], case['p0']\n        )\n        \n        # Format results as [param1, param2, ..., err1, err2, ...]\n        result_list = list(popt) + list(perr)\n        \n        # Reorder for case 2: [J1, J2, Delta, err_J1, err_J2, err_Delta]\n        if len(result_list) == 6: # Case 2 specific ordering\n             result_list = [popt[0], popt[1], popt[2], perr[0], perr[1], perr[2]]\n        \n        all_results.append(result_list)\n\n    # Final printing in the exact required format\n    # Case 2: order is [J1, J2, Delta, err_J1, err_J2, err_Delta]\n    case2_popt = all_results[1][:3]\n    case2_perr = all_results[1][3:]\n    # `curve_fit` returns params in order J1, J2, Delta\n    # The output format is J1, J2, Delta, sigma_J1, sigma_J2, sigma_Delta\n    all_results[1] = [case2_popt[0], case2_popt[1], case2_popt[2], case2_perr[0], case2_perr[1], case2_perr[2]]\n\n    formatted_case_results = []\n    for res_list in all_results:\n        formatted_vals = [f\"{val:.3f}\" for val in res_list]\n        formatted_case_results.append(f\"[{','.join(formatted_vals)}]\")\n    \n    print(f\"[[{formatted_case_results[0][1:-1]}],[{formatted_case_results[1][1:-1]}],[{formatted_case_results[2][1:-1]}]]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3017112"}]}