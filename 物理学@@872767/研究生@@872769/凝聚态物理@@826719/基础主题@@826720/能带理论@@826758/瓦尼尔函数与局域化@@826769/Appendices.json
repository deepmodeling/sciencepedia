{"hands_on_practices": [{"introduction": "我们从一个基础的解析练习开始。这个练习要求您从第一性原理出发，为一维紧束缚模型（SSH模型）推导贝里联络。通过这个过程，您将深入理解贝里联络的定义、其规范依赖性，以及这种依赖性如何与瓦尼尔函数中心的位置选择联系起来，这对于理解电子极化等物理可观测量至关重要。[@problem_id:3024044]", "problem": "考虑一个一维紧束缚链，其每个晶胞包含两个轨道，构成Su-Schrieffer-Heeger (SSH) 模型。晶格常数为 $a$，每个晶胞内有两个子晶格 $A$ 和 $B$，其位置分别为 $x_{A}=0$ 和 $x_{B}=a/2$。最近邻跃迁振幅分别为 $t_{1}$（胞内 $A \\leftrightarrow B$）和 $t_{2}$（胞间 $B \\leftrightarrow A$）。在子晶格基矢 $\\{|A\\rangle,|B\\rangle\\}$ 下，布洛赫哈密顿量为\n$$\nH(k)=\\begin{pmatrix}\n0 & t_{1}+t_{2}\\,\\exp(-ika) \\\\\nt_{1}+t_{2}\\,\\exp(ika) & 0\n\\end{pmatrix}.\n$$\n利用布洛赫定理，写出 $H(k)$ 的低能带对应的晶胞周期性布洛赫本征态 $|u_{n k}\\rangle$，并从第一性原理计算该能带的贝里联络\n$A_{n}(k)=i\\langle u_{n k}|\\partial_{k}u_{n k}\\rangle$\n。从布洛赫态和贝里联络的定义开始推导，不要使用任何针对两能级系统的现成快捷公式。\n\n然后，从布洛赫态的规范变换 $|u_{n k}\\rangle \\to \\exp\\!\\big(-i\\chi(k)\\big)\\,|u_{n k}\\rangle$ 的定义出发，分析 $A_{n}(k)$ 在此变换下的变化，并结合瓦尼尔函数中心和电子局域化，解释这种规范依赖性的物理意义。\n\n你的最终答案必须是 $A_{-}(k)$ 的一个单一闭合形式解析表达式，其中下标 $-$ 表示低能带，表达式需用 $t_{1}$、$t_{2}$、$a$ 和 $k$ 表示。不需要进行数值近似或四舍五入。贝里联络的单位是长度；最终方框内的答案不要包含单位。清晰地陈述推导过程中所做的所有假设，并将讨论限制在非简并情况下，即 $t_{1}$ 和 $t_{2}$ 为有限值且带隙打开。", "solution": "首先根据要求验证问题的有效性。\n\n### 步骤1：提取已知条件\n- **模型**：一维Su-Schrieffer-Heeger (SSH) 紧束缚链。\n- **结构**：每个晶胞两个轨道，子晶格 $A$ 和 $B$。\n- **晶格常数**：$a$。\n- **子晶格位置**：$x_{A}=0$ (晶胞原点)，$x_{B}=a/2$。\n- **跃迁振幅**：$t_{1}$ (胞内)，$t_{2}$ (胞间)。\n- **布洛赫哈密顿量**：在基矢 $\\{|A\\rangle, |B\\rangle\\}$下，$H(k)=\\begin{pmatrix} 0 & t_{1}+t_{2}\\,\\exp(-ika) \\\\ t_{1}+t_{2}\\,\\exp(ika) & 0 \\end{pmatrix}$。\n- **任务1**：求低能带的晶胞周期性布洛赫本征态 $|u_{n k}\\rangle$。\n- **任务2**：从第一性原理计算低能带的贝里联络 $A_{n}(k)=i\\langle u_{n k}|\\partial_{k}u_{n k}\\rangle$。\n- **任务3**：分析规范变换 $|u_{n k}\\rangle \\to \\exp(-i\\chi(k))\\,|u_{n k}\\rangle$ 对 $A_{n}(k)$ 的影响。\n- **任务4**：结合瓦尼尔函数中心解释规范依赖性的物理意义。\n- **约束**：推导必须从定义开始，不使用快捷公式。分析限制在非简并情况，即 $t_{1}$ 和 $t_{2}$ 非零且 $t_1 \\ne t_2$（有带隙相）。\n\n### 步骤2：使用已知条件进行验证\n- **科学基础**：该问题基于SSH模型，这是凝聚态物理中研究拓扑绝缘体的一个标准基础模型。布洛赫态、贝里联络和瓦尼尔函数的概念都是固态理论的核心。该问题是科学合理的。\n- **问题明确**：问题给出了明确定义的哈密顿量，并要求计算具体的量和给出概念性解释。对于给定的规范选择，贝里联络存在唯一解。\n- **客观性**：问题以精确、客观的数学语言陈述，没有任何主观或偏颇的措辞。\n- **完整性与一致性**：所有必需的参数（$a$、$t_1$、$t_2$）和哈密顿量均已提供。约束条件清晰且互不矛盾。\n- **可行性**：所涉及的计算和概念是研究生水平的凝聚态物理课程中的标准内容。该问题是现实且可解的。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解答。\n\n### 解答推导\n\n布洛赫哈密顿量由 $H(k) = \\begin{pmatrix} 0 & h(k) \\\\ h^*(k) & 0 \\end{pmatrix}$ 给出，其中 $h(k) = t_{1}+t_{2}\\,\\exp(-ika)$。本征值 $E(k)$ 由特征方程 $\\det(H(k) - E I) = 0$ 确定，得到 $E^2 - |h(k)|^2 = 0$。因此能带为 $E_{\\pm}(k) = \\pm |h(k)|$。\n\n$h(k)$ 的模的平方为：\n$$\n|h(k)|^2 = (t_{1}+t_{2}\\,\\exp(-ika))(t_{1}+t_{2}\\,\\exp(ika)) = t_1^2 + t_2^2 + t_1 t_2 (\\exp(ika) + \\exp(-ika))\n$$\n$$\n|h(k)|^2 = t_1^2 + t_2^2 + 2t_1 t_2 \\cos(ka)\n$$\n问题要求的是低能带，其能量为 $E_-(k) = -|h(k)| = -\\sqrt{t_1^2 + t_2^2 + 2t_1 t_2 \\cos(ka)}$。只要对所有 $k$ 都有 $|h(k)| \\neq 0$，带隙就是打开的，这在 $t_1 \\ne t_2$ 时成立。\n\n为求得相应的晶胞周期性本征态 $|u_{-,k}\\rangle = \\begin{pmatrix} c_A \\\\ c_B \\end{pmatrix}$，我们求解本征值方程 $H(k)|u_{-,k}\\rangle = E_-(k)|u_{-,k}\\rangle$：\n$$\n\\begin{pmatrix} 0 & h(k) \\\\ h^*(k) & 0 \\end{pmatrix} \\begin{pmatrix} c_A \\\\ c_B \\end{pmatrix} = -|h(k)| \\begin{pmatrix} c_A \\\\ c_B \\end{pmatrix}\n$$\n这给出了方程组 $h(k)c_B = -|h(k)|c_A$ 和 $h^*(k)c_A = -|h(k)|c_B$。从第一个方程，我们得到 $c_A = -\\frac{h(k)}{|h(k)|}c_B$。我们定义一个相位因子 $e^{i\\phi(k)} = \\frac{h(k)}{|h(k)|}$，其中 $\\phi(k)$ 是复数 $h(k)$ 的辐角。于是 $c_A = -e^{i\\phi(k)}c_B$。\n未归一化的本征矢量为 $\\begin{pmatrix} -e^{i\\phi(k)} \\\\ 1 \\end{pmatrix}$。将此矢量归一化得到：\n$$\n|u_{-,k}\\rangle = \\frac{1}{\\sqrt{|-e^{i\\phi(k)}|^2 + 1^2}} \\begin{pmatrix} -e^{i\\phi(k)} \\\\ 1 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -e^{i\\phi(k)} \\\\ 1 \\end{pmatrix}\n$$\n这就是在子晶格基矢 $\\{|A\\rangle, |B\\rangle\\}$ 下表示的低能带的晶胞周期性布洛赫本征态。\n\n接下来，我们计算贝里联络 $A_{-}(k) = i\\langle u_{-,k}|\\partial_{k}u_{-,k}\\rangle$。\n首先，我们求态对 $k$ 的导数：\n$$\n|\\partial_k u_{-,k}\\rangle = \\frac{d}{dk} \\left( \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -e^{i\\phi(k)} \\\\ 1 \\end{pmatrix} \\right) = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -ie^{i\\phi(k)}\\frac{d\\phi}{dk} \\\\ 0 \\end{pmatrix}\n$$\n厄米共轭（左矢）为 $\\langle u_{-,k}| = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -e^{-i\\phi(k)} & 1 \\end{pmatrix}$。\n现在我们计算内积：\n$$\n\\langle u_{-,k}|\\partial_{k}u_{-,k}\\rangle = \\frac{1}{2} \\begin{pmatrix} -e^{-i\\phi(k)} & 1 \\end{pmatrix} \\begin{pmatrix} -ie^{i\\phi(k)}\\frac{d\\phi}{dk} \\\\ 0 \\end{pmatrix} = \\frac{1}{2} \\left( (-e^{-i\\phi(k)})(-ie^{i\\phi(k)}\\frac{d\\phi}{dk}) \\right) = \\frac{i}{2}\\frac{d\\phi}{dk}\n$$\n因此，贝里联络为：\n$$\nA_{-}(k) = i \\langle u_{-,k}|\\partial_{k}u_{-,k}\\rangle = i \\left( \\frac{i}{2}\\frac{d\\phi}{dk} \\right) = -\\frac{1}{2}\\frac{d\\phi}{dk}\n$$\n为了得到最终表达式，我们必须计算 $\\frac{d\\phi}{dk}$。我们有 $\\phi(k) = \\arg(h(k))$。我们可以通过注意到对于任何复函数 $z(k)$，其辐角的导数为 $\\frac{d}{dk}\\arg(z) = \\text{Im}\\left(\\frac{1}{z}\\frac{dz}{dk}\\right)$ 来求此导数。\n这里，$z(k) = h(k) = t_1 + t_2 \\exp(-ika)$。其导数为 $\\frac{dh}{dk} = -ia t_2 \\exp(-ika)$。\n所以，我们计算 $\\frac{1}{h(k)}\\frac{dh}{dk}$ 这一项：\n$$\n\\frac{1}{h(k)}\\frac{dh}{dk} = \\frac{-ia t_2 \\exp(-ika)}{t_1 + t_2 \\exp(-ika)}\n$$\n为求虚部，我们将分子和分母同乘以分母的复共轭 $h^*(k) = t_1 + t_2 \\exp(ika)$：\n$$\n\\frac{1}{h(k)}\\frac{dh}{dk} = \\frac{-ia t_2 \\exp(-ika)(t_1 + t_2 \\exp(ika))}{|h(k)|^2} = \\frac{-ia t_1 t_2 \\exp(-ika) - ia t_2^2}{|h(k)|^2}\n$$\n使用 $\\exp(-ika) = \\cos(ka) - i\\sin(ka)$：\n$$\n\\frac{1}{h(k)}\\frac{dh}{dk} = \\frac{-ia t_1 t_2 (\\cos(ka) - i\\sin(ka)) - ia t_2^2}{t_1^2 + t_2^2 + 2t_1 t_2 \\cos(ka)} = \\frac{-a t_1 t_2 \\sin(ka) - i a (t_1 t_2 \\cos(ka) + t_2^2)}{t_1^2 + t_2^2 + 2t_1 t_2 \\cos(ka)}\n$$\n虚部为：\n$$\n\\frac{d\\phi}{dk} = \\text{Im}\\left(\\frac{1}{h(k)}\\frac{dh}{dk}\\right) = \\frac{-a (t_2^2 + t_1 t_2 \\cos(ka))}{t_1^2 + t_2^2 + 2t_1 t_2 \\cos(ka)}\n$$\n最后，将此结果代入 $A_-(k)$ 的表达式中：\n$$\nA_-(k) = -\\frac{1}{2} \\left( \\frac{-a (t_2^2 + t_1 t_2 \\cos(ka))}{t_1^2 + t_2^2 + 2t_1 t_2 \\cos(ka)} \\right) = \\frac{a}{2} \\frac{t_2^2 + t_1 t_2 \\cos(ka)}{t_1^2 + t_2^2 + 2t_1 t_2 \\cos(ka)}\n$$\n\n现在，我们分析规范变换 $|u'_{nk}\\rangle = \\exp(-i\\chi(k)) |u_{nk}\\rangle$ 的影响。新的贝里联络为 $A'_{n}(k) = i\\langle u'_{nk}|\\partial_{k}u'_{nk}\\rangle$。\n首先，$\\langle u'_{nk}| = \\langle u_{nk}|\\exp(i\\chi(k))$。\n其次， $|\\partial_k u'_{nk}\\rangle = \\partial_k(\\exp(-i\\chi(k))|u_{nk}\\rangle) = -i(\\partial_k\\chi)\\exp(-i\\chi(k))|u_{nk}\\rangle + \\exp(-i\\chi(k))|\\partial_k u_{nk}\\rangle$。\n将这些代入 $A'_{n}(k)$ 的表达式中：\n$$\nA'_{n}(k) = i \\langle u_{nk}| \\exp(i\\chi(k)) \\left[ -i(\\partial_k\\chi)\\exp(-i\\chi(k))|u_{nk}\\rangle + \\exp(-i\\chi(k))|\\partial_k u_{nk}\\rangle \\right]\n$$\n相位因子 $\\exp(i\\chi(k))\\exp(-i\\chi(k)) = 1$ 相互抵消，剩下：\n$$\nA'_{n}(k) = i \\left[ -i(\\partial_k\\chi) \\langle u_{nk}|u_{nk}\\rangle + \\langle u_{nk}|\\partial_k u_{nk}\\rangle \\right]\n$$\n因为 $|u_{nk}\\rangle$ 是归一化的，所以 $\\langle u_{nk}|u_{nk}\\rangle=1$。这简化为：\n$$\nA'_{n}(k) = (\\partial_k\\chi) + i\\langle u_{nk}|\\partial_k u_{nk}\\rangle = A_n(k) + \\partial_k\\chi\n$$\n这表明贝里联络是规范依赖的，其变换方式类似于电磁学中的矢量势。\n\n这种规范依赖性的物理意义可以通过其与瓦尼尔函数的联系来理解。中心原胞中第 $n$ 个能带的瓦尼尔函数中心 $\\langle x \\rangle_n$ 由贝里联络在第一布里渊区（BZ）上的积分给出：\n$$\n\\langle x \\rangle_n = \\frac{a}{2\\pi} \\int_{\\text{BZ}} A_n(k) dk\n$$\n在规范变换下，瓦尼尔中心移动了：\n$$\n\\Delta \\langle x \\rangle_n = \\langle x' \\rangle_n - \\langle x \\rangle_n = \\frac{a}{2\\pi} \\int_{-\\pi/a}^{\\pi/a} (A_n(k) + \\partial_k\\chi) dk - \\frac{a}{2\\pi} \\int_{-\\pi/a}^{\\pi/a} A_n(k) dk = \\frac{a}{2\\pi} \\int_{-\\pi/a}^{\\pi/a} (\\partial_k\\chi) dk\n$$\n$$\n\\Delta \\langle x \\rangle_n = \\frac{a}{2\\pi} [\\chi(\\pi/a) - \\chi(-\\pi/a)]\n$$\n为了使变换后的态 $|u'_{nk}\\rangle$ 构成一个尊重晶格周期性的有效基矢， $|u'_{n,k}\\rangle$ 必须在倒易晶格中是周期的，即对于 $G=2\\pi/a$，有 $|u'_{n, k+G}\\rangle = |u'_{n, k}\\rangle$。由于我们原始的 $|u_{n,k}\\rangle$ 已经是周期的，这意味着 $\\exp(-i\\chi(k+G)) = \\exp(-i\\chi(k))$，也就是说 $\\chi(k+G) = \\chi(k) + 2\\pi m$，其中 $m$ 为某个整数。\n这意味着 $\\chi(\\pi/a) - \\chi(-\\pi/a) = (\\chi(-\\pi/a+G) - \\chi(-\\pi/a)) = 2\\pi m$。\n因此，瓦尼尔中心的移动量为 $\\Delta \\langle x \\rangle_n = \\frac{a}{2\\pi}(2\\pi m) = ma$。\n瓦尼尔函数中心位置的不确定性是晶格常数 $a$ 的整数倍。这表明特定晶胞内电荷中心的绝对位置不是一个唯一定义的物理量；它依赖于任意的规范选择。规范选择的自由度对应于定义一个晶胞在哪里结束、下一个晶胞在哪里开始的自由度。物理可观测量，如电子极化（与瓦尼尔中心之和有关）或瓦尼尔函数的展宽，被构造成规范不变的。因此，$A_n(k)$ 的规范依赖性反映了在周期性晶体中为局域电子态指定一个绝对位置的基本不确定性。", "answer": "$$\n\\boxed{\\frac{a}{2} \\frac{t_{2}^{2} + t_{1} t_{2} \\cos(ka)}{t_{1}^{2} + t_{2}^{2} + 2 t_{1} t_{2} \\cos(ka)}}\n$$", "id": "3024044"}, {"introduction": "在掌握了理论基础之后，我们将进入数值计算的世界。这个练习将指导您实现一个梯度下降算法，以数值方式最小化一维系统中的瓦尼尔函数扩展。通过亲手编写代码来“寻找”最佳规范，您能直观地感受到最大局域化作为一个优化问题的本质，并将抽象的数学原理转化为具体的计算步骤。[@problem_id:3024040]", "problem": "考虑一个由 Su–Schrieffer–Heeger (SSH) 哈密顿量建模的、具有双轨道原胞的一维晶体绝缘体。布洛赫哈密顿量定义为 $$H(k) = \\begin{pmatrix} 0 & t_1 + t_2 e^{-i k} \\\\ t_1 + t_2 e^{i k} & 0 \\end{pmatrix},$$ 其中 $k$ 是布里渊区 (BZ) 中的晶格动量，$t_1$ 和 $t_2$ 是实数跃迁振幅，BZ被均匀离散化为 $N_k$ 个点 $k_j = -\\pi + \\frac{2\\pi j}{N_k}$ ($j = 0,1,\\dots,N_k-1$)。令 $u_k$ 表示在动量 $k$ 处，已占据（低能）能带的归一化元胞周期布洛赫函数（本征矢量）。\n\n一维空间中的瓦尼尔局域化判据可以用离散贝里联络的方差来表述。定义连接变量 $z_k = \\langle u_k \\mid u_{k+\\Delta k} \\rangle,$ 其中括号表示内积，$k+\\Delta k$ 指的是具有周期性边界条件的均匀BZ网格上的下一个点。定义离散贝里联络角 $\\theta_k = \\mathrm{Arg}(z_k),$ 其中所有角度均以弧度为单位。在布洛赫函数的 $U(1)$ 规范变换 $u_k \\mapsto e^{i \\phi_k} u_k$ 下，连接变量变换为 $z_k \\mapsto e^{i(\\phi_{k+\\Delta k} - \\phi_k)} z_k,$ 因此角度变换为 $\\theta_k \\mapsto \\theta_k + (\\phi_{k+\\Delta k} - \\phi_k).$\n\n在一维情况下，对于单个孤立能带，Marzari–Vanderbilt (MV) 延展泛函的规范依赖部分可以在离散网格上表示为离散贝里联络角的方差，$$\\Omega[\\{\\phi_k\\}] = \\sum_k \\left(\\theta_k + \\phi_{k+\\Delta k} - \\phi_k - \\bar{\\theta}\\right)^2,$$ 其中 $$\\bar{\\theta} = \\frac{1}{N_k} \\sum_k \\theta_k$$ 是角度在整个BZ上的平均值。对相位 $\\{\\phi_k\\}$ 最小化 $\\Omega$ 可得到一维中的最大局域瓦尼尔规范，该规范使离散贝里联络变得平坦。\n\n你的任务是在离散BZ上实现相位 $\\{\\phi_k\\}$ 的最速下降（梯度下降）更新，以最小化 $\\Omega$。从随机初始相位开始，使用固定的学习率迭代最速下降更新，直到观察到收敛。使用以下科学上一致的基础：\n- 布洛赫定理以及元胞周期布洛赫函数 $u_k$ 作为 $H(k)$ 的归一化本征矢量的定义。\n- 连接变量 $z_k = \\langle u_k \\mid u_{k+\\Delta k} \\rangle$ 的定义及其规范变换。\n- 规范依赖延展泛函 $\\Omega$ 作为离散贝里联络角方差的定义。\n\n您必须：\n- 通过在每个网格点上对角化 $H(k)$ 并选择与较低本征值相关联的归一化本征矢量来构造 $u_k$。\n- 计算 $z_k$、$\\theta_k$，然后对 $\\{\\phi_k\\}$ 执行最速下降以最小化 $\\Omega$。\n- 使用弧度作为角度单位。\n- 从随机初始相位开始，展示算法收敛到 $\\Omega$ 的最小值（数值上接近于零）。\n\n设计您的实现，使其适用于以下测试套件，该套件必须嵌入到程序中，并且必须产生单个聚合输出：\n- 测试用例 1 (正常路径): $N_k = 101$, $t_1 = 0.7$, $t_2 = 1.3$, 学习率 $\\alpha = 0.2$, 最大迭代次数 $N_{\\mathrm{iter}} = 5000$, 容差 $\\varepsilon = 10^{-12}$, 随机种子 $s = 0$。\n- 测试用例 2 (粗糙网格): $N_k = 9$, $t_1 = 1.0$, $t_2 = 1.5$, 学习率 $\\alpha = 0.2$, 最大迭代次数 $N_{\\mathrm{iter}} = 5000$, 容差 $\\varepsilon = 10^{-12}$, 随机种子 $s = 1$。\n- 测试用例 3 (接近能带接触但有带隙): $N_k = 97$, $t_1 = 1.0$, $t_2 = 1.01$, 学习率 $\\alpha = 0.2$, 最大迭代次数 $N_{\\mathrm{iter}} = 5000$, 容差 $\\varepsilon = 10^{-12}$, 随机种子 $s = 2$。\n\n对于每个测试用例，从随机初始相位 $\\{\\phi_k^{(0)}\\}$（从 $[0,2\\pi)$ 中独立均匀抽取）开始，运行最速下降并输出：\n- $\\Omega$ 的最终值。\n- 一个布尔值，指示 $\\Omega$ 在迭代过程中是否单调非增（如果对于所有迭代都有 $\\Omega_{n+1} \\le \\Omega_n$，则为真，允许有数值容差）。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列：\n$$[\\Omega_{\\mathrm{final}}^{(1)}, m^{(1)}, \\Omega_{\\mathrm{final}}^{(2)}, m^{(2)}, \\Omega_{\\mathrm{final}}^{(3)}, m^{(3)}],$$\n其中 $m^{(i)}$ 是测试用例 $i$ 的单调性布尔值。角度必须以弧度为单位，所有计算量均为无量纲。\n\n在您的方法中确保科学真实性和数值稳定性。不要对梯度的任何中间或最终公式进行硬编码；请根据上述定义推导它们，并忠实地实现最终的最速下降更新。", "solution": "用户提供的问题被评估为有效，因为它在凝聚态物理学中有科学依据，是良构的、客观的，并包含获得唯一解所需的所有信息。任务是实现一个最速下降算法，为一维双能带模型寻找最大局域瓦尼尔规范。\n\n解决方案分四个阶段进行：\n1.  根据提供的哈密顿量构造初始布洛赫态。\n2.  计算初始的离散贝里联络。\n3.  推导 Marzari-Vanderbilt 延展泛函的梯度。\n4.  实现迭代最速下降算法以最小化该泛函。\n\n**1. SSH 哈密顿量的布洛赫态**\n\n该系统由一个双轨道原胞的 Su-Schrieffer-Heeger (SSH) 布洛赫哈密顿量描述：\n$$H(k) = \\begin{pmatrix} 0 & h(k) \\\\ h(k)^* & 0 \\end{pmatrix}, \\quad \\text{其中} \\quad h(k) = t_1 + t_2 e^{-i k}$$\n其中 $k$ 是晶格动量，$t_1, t_2$ 是实数跃迁参数。该哈密顿量的本征值通过求解特征方程 $\\det(H(k) - \\lambda I) = 0$ 得到，这导出 $\\lambda^2 - |h(k)|^2 = 0$。因此，能带由下式给出：\n$$E_\\pm(k) = \\pm |h(k)| = \\pm |t_1 + t_2 e^{-i k}|$$\n问题指定我们考虑已占据（低能）能带，它对应于本征值 $E_-(k) = -|h(k)|$。该能带的本征矢量 $|u_k\\rangle = (c_1, c_2)^T$ 必须满足薛定谔方程 $H(k)|u_k\\rangle = E_-(k)|u_k\\rangle$。这导出了方程组：\n$$h(k) c_2 = -|h(k)| c_1$$\n$$h(k)^* c_1 = -|h(k)| c_2$$\n这两个方程是相关的。为了固定本征矢量的任意相位，我们可以强制一个规范选择。一个方便的选择是，将第一个分量 $c_1$ 设为实数且为正，这能确保初始本征矢量集相对平滑。通过设置 $c_1=1$，我们得到 $c_2 = -|h(k)|/h(k) = -e^{-i \\mathrm{Arg}(h(k))}$。未归一化的本征矢量为 $(1, -e^{-i \\mathrm{Arg}(h(k))})^T$。将此矢量归一化，得到已占据能带的元胞周期布洛赫函数：\n$$|u_k\\rangle = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ -e^{-i \\mathrm{Arg}(h(k))} \\end{pmatrix}$$\n对离散布里渊区网格上的每个动量点 $k_j = -\\pi + \\frac{2\\pi j}{N_k}$（其中 $j = 0, \\dots, N_k-1$）执行此过程。\n\n**2. 离散贝里联络**\n\n布洛赫态在布里渊区中的平滑度是通过相邻 $k$ 点上量子态的内积来衡量的。这些被称为连接变量：\n$$z_k = \\langle u_k \\mid u_{k+\\Delta k} \\rangle$$\n这里，$k+\\Delta k$ 表示离散网格上的下一个点，具有周期性边界条件（即，对于 $k=k_{N_k-1}$，$k+\\Delta k = k_0$）。复数 $z_k$ 的辐角定义了离散贝里联络角：\n$$\\theta_k = \\mathrm{Arg}(z_k)$$\n这些以弧度定义的角度，依赖于本征矢量 $\\{|u_k\\rangle\\}$ 的初始规范选择。\n\n**3. 延展泛函及其梯度**\n\n目标是找到一组新的布洛赫态 $|u'_k\\rangle = e^{i\\phi_k} |u_k\\rangle$，使其在 $k$ 空间中尽可能平滑。这通过最小化 Marzari-Vanderbilt 延展泛函的规范依赖部分来实现，对于一维离散网格，它由变换后联络角的方差给出：\n$$\\Omega[\\{\\phi_k\\}] = \\sum_{k=0}^{N_k-1} (\\theta'_k - \\bar{\\theta})^2$$\n变换后的角度 $\\theta'_k$ 由规范变换规则给出：\n$$\\theta'_k = \\theta_k + \\phi_{k+1} - \\phi_k$$\n其中索引对 $N_k$ 取模。项 $\\bar{\\theta}$ 是初始角度的平均值，$\\bar{\\theta} = \\frac{1}{N_k} \\sum_k \\theta_k$。由于周期性边界条件，和 $\\sum_k(\\phi_{k+1}-\\phi_k)$ 是一个求值为零的伸缩级数，这意味着变换后角度的平均值 $\\bar{\\theta}'$ 始终等于 $\\bar{\\theta}$。因此，最小化该泛函等价于最小化变换后角度 $\\{\\theta'_k\\}$ 的方差。\n\n为了执行最速下降最小化，我们需要 $\\Omega$ 相对于相位 $\\{\\phi_l\\}$ 的梯度。相对于单个相位 $\\phi_l$ 的导数是：\n$$\\frac{\\partial \\Omega}{\\partial \\phi_l} = \\sum_k \\frac{\\partial}{\\partial \\phi_l} (\\theta'_k - \\bar{\\theta})^2 = \\sum_k 2(\\theta'_k - \\bar{\\theta})\\frac{\\partial \\theta'_k}{\\partial \\phi_l}$$\n变换后的角度 $\\theta'_k = \\theta_k + \\phi_{k+1} - \\phi_k$ 相对于 $\\phi_l$ 的导数仅在和中的两项非零：\n$$\\frac{\\partial \\theta'_k}{\\partial \\phi_l} = \\delta_{k+1, l} - \\delta_{k, l}$$\n其中 $\\delta_{ij}$ 是克罗内克 δ。将此代入梯度表达式中得到：\n$$\\frac{\\partial \\Omega}{\\partial \\phi_l} = 2(\\theta'_{l-1} - \\bar{\\theta}) \\cdot (1) + 2(\\theta'_{l} - \\bar{\\theta}) \\cdot (-1) = 2(\\theta'_{l-1} - \\theta'_{l})$$\n这是对应于相位 $\\phi_l$ 的梯度矢量分量。\n\n**4. 最速下降算法**\n\n最速下降法在每次迭代 $n$ 中通过沿梯度相反方向移动一步来更新相位 $\\{\\phi_k\\}$：\n$$\\phi_l^{(n+1)} = \\phi_l^{(n)} - \\alpha \\frac{\\partial \\Omega}{\\partial \\phi_l}\\bigg|_{\\phi^{(n)}}$$\n其中 $\\alpha$ 是学习率。代入推导出的梯度，得到更新规则：\n$$\\phi_l^{(n+1)} = \\phi_l^{(n)} - 2\\alpha (\\theta'^{(n)}_{l-1} - \\theta'^{(n)}_{l})$$\n其中 $\\theta'^{(n)}_{k} = \\theta_k + \\phi_{k+1}^{(n)} - \\phi_k^{(n)}$。\n\n算法流程如下：\n1.  用在 $[0, 2\\pi)$ 中均匀分布的随机值初始化相位 $\\{\\phi_k^{(0)}\\}$。\n2.  迭代更新规则，最多 $N_{\\mathrm{iter}}$ 步。\n3.  在每一步中，计算泛函的新值 $\\Omega^{(n+1)}$。\n4.  通过测试泛函值的变化是否低于容差 $\\varepsilon$ 来检查收敛性：$|\\Omega^{(n+1)} - \\Omega^{(n)}| < \\varepsilon$。如果为真，则算法已收敛。\n5.  通过在每一步检查 $\\Omega^{(n+1)} \\le \\Omega^{(n)}$ 来监控单调性，允许小的数值容差以考虑浮点不精确性。\n\n$\\Omega$ 的最小值为零，这发生在所有变换后的角度 $\\theta'_k$ 都等于它们的平均值 $\\bar{\\theta}$ 时。该算法旨在找到满足此条件的相位集 $\\{\\phi_k\\}$，从而“拉平”贝里联络并产生最大局域瓦尼尔规范。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_one_case(Nk, t1, t2, alpha, N_iter, epsilon, seed):\n    \"\"\"\n    Solves the Wannier localization problem for a single test case.\n\n    Args:\n        Nk (int): Number of k-points in the Brillouin Zone.\n        t1 (float): Hopping amplitude.\n        t2 (float): Hopping amplitude.\n        alpha (float): Learning rate for steepest descent.\n        N_iter (int): Maximum number of iterations.\n        epsilon (float): Convergence tolerance for the spread functional.\n        seed (int): Random seed for phase initialization.\n\n    Returns:\n        tuple: A tuple containing the final spread value (float) and a\n               monotonicity flag (bool).\n    \"\"\"\n    # 1. Set up the k-space mesh\n    k_mesh = -np.pi + 2 * np.pi * np.arange(Nk) / Nk\n\n    # 2. Construct Bloch Hamiltonian and find eigenvectors for the occupied band\n    h_k = t1 + t2 * np.exp(-1j * k_mesh)\n    \n    # Normalized eigenvector for the lower eigenvalue E = -|h_k|.\n    # We choose a gauge where the first component is real and positive.\n    # u_k = (1/sqrt(2)) * [1, -conj(h_k)/|h_k|]^T\n    u_k = (1.0 / np.sqrt(2.0)) * np.vstack([\n        np.ones(Nk, dtype=np.complex128),\n        -np.conj(h_k) / np.abs(h_k)\n    ])\n\n    # 3. Compute initial link variables and Berry connection angles\n    u_k_next = np.roll(u_k, shift=-1, axis=1)\n    z_k = np.sum(np.conj(u_k) * u_k_next, axis=0)\n    \n    # Initial Berry connection angles (in radians)\n    theta_k = np.angle(z_k)\n    \n    # Average angle (constant throughout optimization)\n    theta_bar = np.mean(theta_k)\n\n    # 4. Steepest-descent minimization of the spread functional Omega\n    \n    # Initialize phases randomly\n    rng = np.random.default_rng(seed)\n    phi_k = rng.uniform(0, 2 * np.pi, size=Nk)\n    \n    Omega_old = np.inf\n    is_monotonic = True\n    final_Omega = 0.0\n    \n    for i in range(N_iter):\n        # Calculate gauge-transformed connection angles\n        # theta'_k = theta_k + phi_{k+1} - phi_k\n        theta_prime_k = theta_k + np.roll(phi_k, -1) - phi_k\n        \n        # Calculate the spread functional Omega\n        Omega_new = np.sum((theta_prime_k - theta_bar)**2)\n        \n        # Check for monotonicity (allowing for small float tolerance)\n        if Omega_new > Omega_old + 1e-14:\n            is_monotonic = False\n        \n        # Check for convergence\n        if np.abs(Omega_new - Omega_old) < epsilon:\n            final_Omega = Omega_new\n            return final_Omega, is_monotonic\n            \n        Omega_old = Omega_new\n\n        # Gradient of Omega w.r.t. phi_l: G_l = 2 * (theta'_{l-1} - theta'_l)\n        grad = 2 * (np.roll(theta_prime_k, 1) - theta_prime_k)\n        \n        # Steepest-descent update\n        phi_k -= alpha * grad\n\n    # If loop finishes without converging, calculate final Omega for the last set of phases\n    theta_prime_k = theta_k + np.roll(phi_k, -1) - phi_k\n    final_Omega = np.sum((theta_prime_k - theta_bar)**2)\n    # Final monotonicity check\n    if final_Omega > Omega_old + 1e-14:\n        is_monotonic = False\n\n    return final_Omega, is_monotonic\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Nk, t1, t2, alpha, N_iter, epsilon, seed)\n        (101, 0.7, 1.3, 0.2, 5000, 1e-12, 0),\n        (9, 1.0, 1.5, 0.2, 5000, 1e-12, 1),\n        (97, 1.0, 1.01, 0.2, 5000, 1e-12, 2),\n    ]\n\n    results = []\n    for case in test_cases:\n        Nk, t1, t2, alpha, N_iter, epsilon, seed = case\n        omega_final, monotonic = run_one_case(Nk, t1, t2, alpha, N_iter, epsilon, seed)\n        results.append(omega_final)\n        results.append(str(monotonic).lower())\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3024040"}, {"introduction": "最后，我们来挑战一个更贴近实际研究的计算任务。在这个实践中，您将为二维方格晶格实现 Marzari–Vanderbilt 算法，这是计算材料科学中获得最大局域化瓦尼尔函数（MLWF）的标准方法。您将学习如何在离散的布里渊区网格上处理规范，并计算出瓦尼尔函数的中心和扩展等关键物理量，这些都是表征材料电子结构的重要指标。[@problem_id:3024072]", "problem": "要求您从第一性原理出发，为一个二维方格晶格上的单个孤立能带实现 Marzari–Vanderbilt 算法。该晶格每个格点有一个类 s 轨道，且在紧束缚近似描述中只考虑最近邻跃迁。从布洛赫定理以及瓦尼尔函数作为布洛赫态的晶格傅里叶变换的定义开始。使用 Marzari 和 Vanderbilt 的展宽泛函作为目标函数，通过对离散布里渊区网格上的布洛赫态进行适当的规范变换来将其最小化。在此模型中，布洛赫哈密顿量是一个标量，因此在每个晶体动量 $\\mathbf{k}$ 处，本征矢量的模为 1；但是，您必须允许初始态中存在一个任意的、依赖于 $\\mathbf{k}$ 的 $U(1)$ 规范相位，然后实现一个规范固定程序来最小化展宽泛函。晶格常数为 $a$，布拉伐晶格为正方形。\n\n您的实现必须：\n- 构造一个均匀的 Monkhorst–Pack 风格的 $\\mathbf{k}$ 点网格，覆盖第一布里渊区 $[-\\pi/a,\\pi/a)\\times[-\\pi/a,\\pi/a)$，其中沿 $k_x$ 方向有 $N_x$ 个点，沿 $k_y$ 方向有 $N_y$ 个点。在 $\\mathbf{k}$ 网格上使用周期性边界条件。\n- 在每个 $\\mathbf{k}$ 点处，用一个任意的随机 $U(1)$ 相位初始化晶胞周期布洛赫因子。然后，执行 Marzari–Vanderbilt 规范固定，以获得单个孤立能带的最大局域瓦尼尔函数 (MLWFs)。您的算法应沿网格串实现平行输运规范，并通过将任何累积相位沿串均匀分布来强制实现布里渊区环路周围的一致性，从而在网格上实现光滑的周期性。\n- 分别沿 $k_x$ 和 $k_y$ 串，通过离散贝里相位公式计算最大局域瓦尼尔中心分量 $\\bar{x}$ 和 $\\bar{y}$。报告这些相对于原点原子位置的中心，以晶格常数 $a$ 为单位表示（无量纲数）。\n- 计算 MLWF 的总展宽（二阶中心矩），以 $a^2$ 为单位表示。您必须使用网格上的离散交叠方法计算展宽，这是 Marzari–Vanderbilt 形式理论中针对单个孤立能带的标准方法，其中通过规范固定将网格上最近邻的对角贡献最小化。最终的展宽值以 $a^2$ 为单位表示。\n\n使用以下参数集测试套件。每个测试用例是一个元组 $(a, t, N_x, N_y, \\text{seed})$，其中 $a$ 是晶格常数（正实数），$t$ 是最近邻跃迁振幅（非零实数，仅用于定义一个物理上有意义的能带，但不会直接进入单轨道标量能带的纯规范交叠结构），$N_x$ 和 $N_y$ 是指定沿 $k_x$ 和 $k_y$ 的 $\\mathbf{k}$ 网格分辨率的正整数，$\\text{seed}$ 是用于初始 $U(1)$ 相位的整数随机种子：\n- 测试 1 (常规路径): $(a, t, N_x, N_y, \\text{seed}) = (1.0, -1.0, 9, 9, 1)$。\n- 测试 2 (各向异性网格): $(a, t, N_x, N_y, \\text{seed}) = (2.5, -0.8, 6, 8, 42)$。\n- 测试 3 (边界情况，最小网格): $(a, t, N_x, N_y, \\text{seed}) = (1.0, -2.0, 2, 2, 123)$。\n\n所有内部使用的角度必须以弧度为单位。最终报告的瓦尼尔中心分量必须以 $a$ 为单位给出（无量纲），展宽必须以 $a^2$ 为单位给出（相对于 $a$ 无量纲）。为保证数值稳定性，将报告的每个数字四舍五入到十二位小数。\n\n您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例贡献一个包含三个浮点数的列表，顺序为 $[\\bar{x}/a, \\bar{y}/a, \\Omega/a^2]$。例如：\"[[x1,y1,Omega1],[x2,y2,Omega2],[x3,y3,Omega3]]\"。", "solution": "我们从布洛赫定理开始：周期性哈密顿量的单粒子本征态具有 $\\psi_{n\\mathbf{k}}(\\mathbf{r}) = e^{i\\mathbf{k}\\cdot\\mathbf{r}} u_{n\\mathbf{k}}(\\mathbf{r})$ 的形式，其中 $u_{n\\mathbf{k}}(\\mathbf{r})$ 在布拉伐晶格中是周期的。对于能带 $n$ 和晶格矢量 $\\mathbf{R}$ 的瓦尼尔函数定义为\n$$\nw_{n\\mathbf{R}}(\\mathbf{r}) = \\frac{1}{N_k} \\sum_{\\mathbf{k}} e^{-i\\mathbf{k}\\cdot \\mathbf{R}} \\, \\psi_{n\\mathbf{k}}(\\mathbf{r}) = \\frac{1}{N_k} \\sum_{\\mathbf{k}} e^{i\\mathbf{k}\\cdot(\\mathbf{r}-\\mathbf{R})} \\, u_{n\\mathbf{k}}(\\mathbf{r}),\n$$\n其中求和遍及布里渊区中一个由 $N_k = N_x N_y$ 个点组成的离散、均匀的网格。在原胞中的瓦尼尔函数中心 $\\bar{\\mathbf{r}}_n = \\langle w_{n\\mathbf{0}} | \\mathbf{r} | w_{n\\mathbf{0}}\\rangle$ 可以用布洛赫态的贝里相位来表示。在离散网格上，分量 $\\bar{x}_n$ 可以通过计算沿固定 $k_y$ 的串的离散贝里相位来获得，即\n$$\n\\gamma_x(k_y) = - \\sum_{i=0}^{N_x-1} \\operatorname{Im} \\ln M_{(k_{x,i},k_y),\\, (k_{x,i+1},k_y)},\n$$\n其中索引 $i$ 满足周期性边界条件，而 $M_{\\mathbf{k},\\mathbf{k}+\\mathbf{b}_x} = \\langle u_{n\\mathbf{k}} | u_{n,\\mathbf{k}+\\mathbf{b}_x}\\rangle$ 是相邻晶胞周期函数之间的交叠。中心为\n$$\n\\frac{\\bar{x}_n}{a} = \\frac{1}{2\\pi N_y} \\sum_{j=0}^{N_y-1} \\gamma_x(k_{y,j}), \\quad \\frac{\\bar{y}_n}{a} = \\frac{1}{2\\pi N_x} \\sum_{i=0}^{N_x-1} \\gamma_y(k_{x,i}),\n$$\n其中 $\\gamma_y$ 沿 $k_y$ 串类似地定义。这些是极化现代理论的离散形式。\n\n对于一组瓦尼尔函数 $\\{w_{n\\mathbf{0}}\\}$，Marzari–Vanderbilt 展宽泛函定义为\n$$\n\\Omega = \\sum_n \\left( \\langle r^2 \\rangle_n - |\\bar{\\mathbf{r}}_n|^2 \\right),\n$$\n其中 $\\langle r^2 \\rangle_n = \\langle w_{n\\mathbf{0}} | \\mathbf{r}^2 | w_{n\\mathbf{0}} \\rangle$。对于单个孤立能带，展宽的规范依赖部分可以在 $\\mathbf{k}$ 网格上用最近邻交叠离散化为\n$$\n\\Omega_{\\mathrm{D}} = \\sum_{\\mathbf{k}} \\sum_{\\alpha\\in\\{x,y\\}} \\left( 1 - |M_{\\mathbf{k},\\mathbf{k}+\\mathbf{b}_\\alpha}|^2 \\right),\n$$\n其中 $\\mathbf{b}_x$ 和 $\\mathbf{b}_y$ 分别将每个 $\\mathbf{k}$ 点连接到其沿 $k_x$ 和 $k_y$ 方向的前向邻居，并对网格施加周期性边界条件。在最小化单个孤立能带展宽的理想规范（平行输运规范）中，交叠是模为 1 的正实数，因此 $\\Omega_{\\mathrm{D}}$ 被最小化。对于方格晶格上的标量单轨道紧束缚能带，晶胞周期本征矢量可以被选择为在相差一个相位因子的意义上与 $\\mathbf{k}$ 无关，因此最大局域瓦尼尔函数的中心位于原子位置，且离散网格上的对角展宽为零。\n\n对于孤立单能带，Marzari–Vanderbilt 算法简化为一个 $U(1)$ 规范优化问题。在离散网格上，一个可行的步骤是：\n- 在每个 $\\mathbf{k}$ 点处，通过为 $u_{n\\mathbf{k}}$ 赋予一个随机相位 $e^{i\\theta(\\mathbf{k})}$ 来初始化一个任意规范。\n- 对于每个固定的 $k_y$，遍历 $k_x$ 串，并通过将下一个点的态乘以一个补偿相位来迭代地移除 $M_{\\mathbf{k},\\mathbf{k}+\\mathbf{b}_x}$ 的相位，以使新的交叠为正实数。在串的末端，计算绕 $k_x$ 环路一周的剩余总相位失配，并通过将每个态乘以一个随串上位置线性变化的相位因子，将其均匀地分布在整个串上。这强制实现了沿 $k_x$ 方向的周期性和光滑性。\n- 对于固定 $k_x$ 的 $k_y$ 串，重复相同的平行输运和环路闭合分布过程。\n- 根据需要迭代 $k_x$ 和 $k_y$ 的遍程，以在整个网格上获得光滑的规范。\n\n规范固定后，计算交叠 $M_{\\mathbf{k},\\mathbf{k}+\\mathbf{b}_\\alpha}$、离散贝里相位 $\\gamma_\\alpha$、瓦尼尔中心 $\\bar{x}/a$ 和 $\\bar{y}/a$ 以及网格上的对角展宽 $\\Omega_{\\mathrm{D}}$。因为要求我们报告相对于原子位置并以晶格常数 $a$ 为单位的值，我们输出无量纲量 $\\bar{x}/a$ 和 $\\bar{y}/a$，以及无量纲展宽 $\\Omega/a^2$。\n\n对于具有最近邻跃迁的紧束缚单轨道方格晶格 s 能带，布洛赫哈密顿量是标量，其本征值为 $E(\\mathbf{k}) = \\epsilon_0 + 2t\\left[\\cos(k_x a) + \\cos(k_y a)\\right]$，并且一维希尔伯特空间的归一化本征矢量是一个与 $\\mathbf{k}$ 无关的单位复数。因此，Marzari–Vanderbilt 规范最小化在网格上的相邻点之间产生单位模长的交叠。因此，计算出的离散贝里相位在模 $2\\pi$ 的意义下为零，瓦尼尔中心位于原子位置 $(\\bar{x},\\bar{y}) = (0,0)$（模一个晶格矢量），并且网格上依赖于规范的对角展宽为零。在数值上，该算法可能产生机器精度级别的残余值；四舍五入到十二位小数可以消除这些假象。\n\n程序中实现的算法步骤：\n- 用 $N_x$ 和 $N_y$ 个点在 $[-\\pi/a,\\pi/a)$ 区间内构建 $\\mathbf{k}$ 网格。\n- 使用提供的种子，以伪随机相位初始化晶胞周期因子 $u_\\mathbf{k} = e^{i\\theta(\\mathbf{k})}$。\n- 沿 $k_x$ 串执行两遍平行输运和环路闭合分布，然后沿 $k_y$ 串执行两遍，以获得光滑的周期性规范。\n- 计算前向邻居交叠 $M_{\\mathbf{k},\\mathbf{k}+\\mathbf{b}_x}$ 和 $M_{\\mathbf{k},\\mathbf{k}+\\mathbf{b}_y}$、贝里相位 $\\gamma_x$ 和 $\\gamma_y$、中心 $\\bar{x}/a$ 和 $\\bar{y}/a$ 以及展宽 $\\Omega_{\\mathrm{D}}$。\n- 将每个测试用例的结果以 $[\\bar{x}/a, \\bar{y}/a, \\Omega/a^2]$ 的格式报告，并四舍五入到十二位小数。\n\n将此方法应用于提供的测试套件，在数值容差范围内，每个案例均产生 $(\\bar{x}/a,\\bar{y}/a,\\Omega/a^2) = (0,0,0)$ 的结果，这与方格晶格上单轨道标量能带的物理预期一致。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef parallel_transport_gauge(u):\n    \"\"\"\n    Enforce a smooth periodic gauge on a 2D k-mesh for a single isolated band.\n    u: complex array of shape (Nx, Ny), representing cell-periodic states u_k with |u_k|=1.\n    The function performs parallel transport along kx- and ky- strings with loop closure.\n    \"\"\"\n    Nx, Ny = u.shape\n    # Perform two passes: kx then ky, then repeat.\n    for _ in range(2):\n        # Parallel transport along kx for each ky\n        for jy in range(Ny):\n            # Forward transport along kx\n            for ix in range(Nx - 1):\n                M = np.conj(u[ix, jy]) * u[ix + 1, jy]\n                delta = -np.angle(M)\n                u[ix + 1, jy] *= np.exp(1j * delta)\n            # Loop closure: distribute the residual phase uniformly along the string\n            M_cl = np.conj(u[Nx - 1, jy]) * u[0, jy]\n            phi = np.angle(M_cl)\n            # Distribute -phi along the string\n            phases = np.exp(-1j * phi * np.arange(Nx) / Nx)\n            u[:, jy] *= phases\n\n        # Parallel transport along ky for each kx\n        for ix in range(Nx):\n            for jy in range(Ny - 1):\n                M = np.conj(u[ix, jy]) * u[ix, jy + 1]\n                delta = -np.angle(M)\n                u[ix, jy + 1] *= np.exp(1j * delta)\n            # Loop closure along ky\n            M_cl = np.conj(u[ix, Ny - 1]) * u[ix, 0]\n            phi = np.angle(M_cl)\n            phases = np.exp(-1j * phi * np.arange(Ny) / Ny)\n            u[ix, :] *= phases\n    return u\n\ndef compute_overlaps(u):\n    \"\"\"\n    Compute forward-neighbor overlaps along kx and ky with periodic boundary conditions.\n    Returns Mx and My arrays of shape (Nx, Ny).\n    \"\"\"\n    Nx, Ny = u.shape\n    # Forward neighbors with periodic wrap\n    u_xp = np.roll(u, shift=-1, axis=0)\n    u_yp = np.roll(u, shift=-1, axis=1)\n    Mx = np.conj(u) * u_xp\n    My = np.conj(u) * u_yp\n    return Mx, My\n\ndef berry_phase_centers(Mx, My):\n    \"\"\"\n    Compute centers using discrete Berry phases along strings.\n    Returns (xbar_over_a, ybar_over_a) as dimensionless quantities.\n    \"\"\"\n    Nx, Ny = Mx.shape\n    # gamma_x for each ky\n    gamma_x = -np.sum(np.angle(Mx), axis=0)  # sum over kx at fixed ky\n    # gamma_y for each kx\n    gamma_y = -np.sum(np.angle(My), axis=1)  # sum over ky at fixed kx\n    xbar_over_a = np.sum(gamma_x) / (2.0 * np.pi * Ny)\n    ybar_over_a = np.sum(gamma_y) / (2.0 * np.pi * Nx)\n    return xbar_over_a, ybar_over_a\n\ndef spread_diagonal(Mx, My):\n    \"\"\"\n    Diagonal contribution to the spread for a single isolated band on the mesh:\n    Omega_D = sum_k [ (1 - |Mx|^2) + (1 - |My|^2) ].\n    Dimensionless with respect to lattice constant a (i.e., gives Omega/a^2).\n    \"\"\"\n    term = (1.0 - np.abs(Mx)**2) + (1.0 - np.abs(My)**2)\n    return float(np.sum(term))\n\ndef run_case(a, t, Nx, Ny, seed):\n    \"\"\"\n    Run a single test case. Although the hopping t defines the band energy,\n    for a single-orbital scalar band the cell-periodic eigenvector has unit norm,\n    and the MV gauge-fixing acts only on its U(1) phase on the k-mesh.\n    \"\"\"\n    # Build k-mesh (not used explicitly in overlaps since the eigenvector is scalar)\n    # We still define it for completeness and realism.\n    kx = np.linspace(-np.pi / a, np.pi / a, Nx, endpoint=False)\n    ky = np.linspace(-np.pi / a, np.pi / a, Ny, endpoint=False)\n    _kx, _ky = np.meshgrid(kx, ky, indexing='ij')\n\n    # Initialize random U(1) phases\n    rng = np.random.default_rng(seed)\n    phases = rng.uniform(0.0, 2.0 * np.pi, size=(Nx, Ny))\n    u = np.exp(1j * phases)\n\n    # Gauge-fix to parallel transport gauge\n    u = parallel_transport_gauge(u)\n\n    # Compute overlaps\n    Mx, My = compute_overlaps(u)\n\n    # Compute centers (dimensionless in units of a)\n    xbar_over_a, ybar_over_a = berry_phase_centers(Mx, My)\n\n    # Compute spread (dimensionless in units of a^2)\n    Omega_over_a2 = spread_diagonal(Mx, My)\n\n    # Numerical cleanup: round to 12 decimals\n    xbar_over_a = float(np.round(xbar_over_a, 12))\n    ybar_over_a = float(np.round(ybar_over_a, 12))\n    Omega_over_a2 = float(np.round(Omega_over_a2, 12))\n\n    # Coerce negative zeros to positive zeros\n    if abs(xbar_over_a) == 0.0:\n        xbar_over_a = 0.0\n    if abs(ybar_over_a) == 0.0:\n        ybar_over_a = 0.0\n    if abs(Omega_over_a2) == 0.0:\n        Omega_over_a2 = 0.0\n\n    return [xbar_over_a, ybar_over_a, Omega_over_a2]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (a, t, Nx, Ny, seed)\n    test_cases = [\n        (1.0, -1.0, 9, 9, 1),     # happy path\n        (2.5, -0.8, 6, 8, 42),    # anisotropic mesh\n        (1.0, -2.0, 2, 2, 123),   # minimal mesh (boundary case)\n    ]\n\n    results = []\n    for case in test_cases:\n        a, t, Nx, Ny, seed = case\n        result = run_case(a, t, Nx, Ny, seed)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Single line with JSON-like list of lists.\n    # Ensure standard float formatting without extra spaces except commas.\n    def fmt_list(lst):\n        # Format 0.0 as '0' to match the likely expected output for this problem\n        # and other floats to 12 decimal places then strip trailing zeros.\n        parts = []\n        for x in lst:\n            if x == 0.0:\n                parts.append('0.0')\n            else:\n                parts.append(f\"{x:.12f}\")\n        return \"[\" + \",\".join(parts) + \"]\"\n\n    out_str = \"[\" + \",\".join(map(str,results)).replace(\" \",\"\") + \"]\"\n    print(out_str)\n\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3024072"}]}