{"hands_on_practices": [{"introduction": "GW近似的核心在于格林函数 $G$ 与屏蔽相互作用 $W$ 的频率卷积。本练习 [@problem_id:1147621] 将通过复变函数的留数定理，让您亲手完成这一关键计算。通过一个简化的极点模型，您将清晰地看到 $G$ 和 $W$ 的解析结构如何决定电子自能，并深入理解自能虚部与准粒子寿命之间的联系。", "problem": "在多体微扰理论的框架内，GW近似提供了一种计算电子自能 $\\Sigma$ 的方法，该自能描述了超出平均场Hartree-Fock近似的交换和关联效应。自能通常由频域卷积 $\\Sigma = iGW$ 给出，其中 $G$ 是单粒子格林函数，$W$ 是动态屏蔽库仑相互作用。\n\n考虑一个模型系统，需要计算其自能的关联部分 $\\Sigma_c(\\omega)$。自能由以下卷积给出：\n$$ \\Sigma_c(\\omega) = i \\int_{-\\infty}^{\\infty} \\frac{d\\omega'}{2\\pi} G_0(\\omega+\\omega') W_c(\\omega') e^{i\\omega' 0^+} $$\n其中因子 $e^{i\\omega' 0^+}$ 通过在复数 $\\omega'$ 的上半平面闭合积分路径来确保收敛。\n\n无相互作用格林函数 $G_0(\\nu)$ 表示系统中粒子和空穴的传播。对于这个问题，我们用一个能量为 $\\varepsilon_p > 0$ 的单粒子态和一个能量为 $\\varepsilon_h  0$ 的单空穴态来模拟可用的中间态，能量是相对于化学势 $\\mu=0$ 而言的。因此，时间序格林函数为：\n$$ G_0(\\nu) = \\frac{1}{\\nu - \\varepsilon_p + i\\delta} + \\frac{1}{\\nu - \\varepsilon_h - i\\delta} \\quad (\\delta \\to 0^+) $$\n\n屏蔽相互作用的关联部分 $W_c(\\omega')$ 由一个阻尼等离激元-极点模型描述：\n$$ W_c(\\omega') = \\frac{Z}{\\omega' - \\omega_{pl} + i\\gamma} - \\frac{Z}{\\omega' + \\omega_{pl} - i\\gamma} $$\n其中 $Z > 0$ 是极点强度，$\\omega_{pl} > 0$ 是等离激元频率，$\\gamma > 0$ 是等离激元阻尼率。假设除 $\\varepsilon_h$ 为负外，所有参数（$\\varepsilon_p, Z, \\omega_{pl}, \\gamma$）均为正。\n\n你的任务是计算自能的虚部 $\\text{Im} \\, \\Sigma_c(\\omega)$ 在空穴态能量 $\\omega = \\varepsilon_h$ 处的值。", "solution": "我们从关联自能的表达式开始：\n$$\n\\Sigma_c(\\omega)\n= i\\int_{-\\infty}^{\\infty}\\frac{d\\omega'}{2\\pi}\\;G_0(\\omega+\\omega')\\,W_c(\\omega')\\,e^{i\\omega'0^+}\\,.\n$$\n为了计算 $\\Sigma_c(\\varepsilon_h)$，我们需要对 $\\omega'$-平面积分。由于收敛因子 $e^{i\\omega'0^+}$ 的存在，我们将积分围线闭合于上半平面 (UHP)。因此，我们需要找到被积函数 $G_0(\\varepsilon_h+\\omega')\\,W_c(\\omega')$ 在上半平面的所有极点。\n\n1.  **$W_c(\\omega')$ 的极点**：$W_c(\\omega')$ 在 $\\omega' = \\omega_{pl} - i\\gamma$（下半平面）和 $\\omega'_1 = -\\omega_{pl} + i\\gamma$（上半平面）处有极点。\n2.  **$G_0(\\varepsilon_h+\\omega')$ 的极点**：$G_0(\\nu)$ 在 $\\nu = \\varepsilon_p - i\\delta$ 和 $\\nu = \\varepsilon_h + i\\delta$ 处有极点。由于 $\\varepsilon_p > 0$ 且 $\\varepsilon_h  0$，这两个极点都位于复 $\\nu$-平面的下半平面。因此，$G_0(\\varepsilon_h+\\omega')$ 的极点位于 $\\omega' = \\varepsilon_p - \\varepsilon_h - i\\delta$ 和 $\\omega' = -i\\delta$ 处，两者也都在下半平面。\n\n综上所述，积分围线所包围的区域（上半平面）中只有一个极点：$\\omega'_1 = -\\omega_{pl} + i\\gamma$，它来自屏蔽相互作用 $W_c(\\omega')$。\n\n根据留数定理，积分值为 $2\\pi i$ 乘以该极点处的留数。\n$$\n\\Sigma_c(\\varepsilon_h) = i \\times \\frac{2\\pi i}{2\\pi} \\times \\text{Res}\\left[G_0(\\varepsilon_h+\\omega')W_c(\\omega'),\\; \\omega'=-\\omega_{pl}+i\\gamma\\right]\n$$\n留数计算如下：\n$$\n\\text{Res} = \\lim_{\\omega' \\to -\\omega_{pl}+i\\gamma} (\\omega' - (-\\omega_{pl}+i\\gamma)) W_c(\\omega') \\times G_0(\\varepsilon_h+\\omega')\n$$\n由于极点来自 $W_c$ 的第二项，我们可以得到：\n$$\n\\text{Res} = -Z \\times G_0(\\varepsilon_h - \\omega_{pl} + i\\gamma)\n$$\n将 $G_0$ 的表达式代入：\n$$\n\\text{Res} = -Z \\left[ \\frac{1}{(\\varepsilon_h - \\omega_{pl} + i\\gamma) - \\varepsilon_p + i\\delta} + \\frac{1}{(\\varepsilon_h - \\omega_{pl} + i\\gamma) - \\varepsilon_h - i\\delta} \\right]\n$$\n化简分母，并取 $\\delta \\to 0^+$ 的极限：\n$$\n\\text{Res} = -Z \\left[ \\frac{1}{(\\varepsilon_h - \\varepsilon_p - \\omega_{pl}) + i\\gamma} + \\frac{1}{-\\omega_{pl} + i\\gamma} \\right]\n$$\n因此，自能为：\n$$\n\\Sigma_c(\\varepsilon_h) = - \\text{Res} = Z \\left[ \\frac{1}{(\\varepsilon_h - \\varepsilon_p - \\omega_{pl}) + i\\gamma} + \\frac{1}{-\\omega_{pl} + i\\gamma} \\right]\n$$\n最后，我们取其虚部。对于一个复数 $\\frac{1}{a+ib} = \\frac{a-ib}{a^2+b^2}$，其虚部为 $\\frac{-b}{a^2+b^2}$。\n$$\n\\text{Im}\\,\\Sigma_c(\\varepsilon_h) = Z \\left[ \\frac{-\\gamma}{(\\varepsilon_h - \\varepsilon_p - \\omega_{pl})^2 + \\gamma^2} + \\frac{-\\gamma}{(-\\omega_{pl})^2 + \\gamma^2} \\right]\n$$\n$$\n\\text{Im}\\,\\Sigma_c(\\varepsilon_h) = -Z\\gamma \\left[ \\frac{1}{(\\varepsilon_h - \\varepsilon_p - \\omega_{pl})^2 + \\gamma^2} + \\frac{1}{\\omega_{pl}^2 + \\gamma^2} \\right]\n$$", "answer": "$$\\boxed{-Z\\gamma\\left(\\frac{1}{(\\varepsilon_h-\\varepsilon_p-\\omega_{pl})^2+\\gamma^2} + \\frac{1}{\\omega_{pl}^2+\\gamma^2}\\right)}$$", "id": "1147621"}, {"introduction": "从理论转向计算实践，我们需要面对GW计算中的一个核心挑战：收敛性。实际计算中，用于构建极化率的空态求和必须在有限的数目下截断。本练习 [@problem_id:2464600] 通过一个针对硅材料的简化模型，让您动手研究准粒子带隙如何依赖于求和中所包含的空态（或称导带）数目。您将看到，屏蔽效应的精确度以及最终的GW修正值，都与这一截断参数密切相关。", "problem": "你将实现一个小型的数值研究，模拟在独立粒子极化率中截断空导带数量如何影响屏蔽相互作用，进而影响格林函数（$G$）与屏蔽库仑相互作用（$W$）近似下的准粒子带隙。你的目标是计算晶体硅的预测准粒子带隙，将其作为独立粒子极化率求和中所保留导带数量的函数。\n\n从随机相位近似（RPA）中独立粒子极化率的定义出发。在静态、长波长极限下，该极化率可以写为从占据（价）单电子态到未占据（导）单电子态的跃迁之和。在一个简化的单价带、多导带模型中，假设跃迁矩阵元的大小为常数，静态独立粒子极化率可以近似为一个对导带求和的、由能量分母加权的形式。为确保随导带数量增加的收敛性，采用一个模型，其中向导带指数为 $m$ 的跃迁的跃迁矩阵元平方以 $|M_m|^2 \\propto 1/(1+m^2)$ 的形式衰减，这反映了高能振子强度的抑制效应。假设在 Kohn-Sham（KS）带隙 $E_g^{\\mathrm{KS}}$ 之上存在一个能量间距为 $\\Delta E$ 的导带能量阶梯，因此导带 $m$ 相对于价带顶的跃迁能量为 $E_g^{\\mathrm{KS}} + m \\Delta E$。在此模型中，截断至 $N_c$ 个导带的静态独立粒子极化率为\n$$\n\\chi_0(N_c) \\;=\\; A \\sum_{m=1}^{N_c} \\frac{|M_m|^2}{E_g^{\\mathrm{KS}} + m \\Delta E},\n$$\n其中 $|M_m|^2 = \\dfrac{M_0^2}{1+m^2}$，$A$ 是一个包含常数和单位约定的正常数。对于本问题，在任意一致的单位制下设置 $A=1$ 和 $M_0=1$，以便专注于由 $N_c$ 驱动的相对屏蔽变化。\n\n通过一个标量、无量纲的模型介电函数，在静态极限下将屏蔽与极化率联系起来，\n$$\n\\varepsilon(N_c) \\;=\\; 1 + \\beta \\,\\chi_0(N_c),\n$$\n其中 $\\beta$ 是一个校准常数，其确定方式为：在某个较大但有限的参考能带数 $N_{\\mathrm{ref}}$ 下，介电常数与目标收敛值 $\\varepsilon_\\infty$ 相匹配。对于晶体硅，使用 $\\varepsilon_\\infty = 12$ 和 $N_{\\mathrm{ref}} = 2000$，因此\n$$\n\\beta \\;=\\; \\frac{\\varepsilon_\\infty - 1}{\\chi_0(N_{\\mathrm{ref}})}.\n$$\n\n为了将屏蔽映射到准粒子带隙，采用一个与屏蔽交换直觉一致的静态屏蔽敏感性模型：假设准粒子带隙与静态介电常数成反比，\n$$\nE_g^{\\mathrm{GW}}(N_c) \\;=\\; E_g^{\\mathrm{KS}} \\;+\\; \\frac{S_0}{\\varepsilon(N_c)},\n$$\n其中 $S_0$ 的选择方式是，在 $N_{\\mathrm{ref}}$ 下，带隙等于目标收敛值 $E_g^{\\mathrm{GW}}(\\infty) \\approx E_g^{\\mathrm{GW}}(N_{\\mathrm{ref}}) = E_g^{\\mathrm{target}}$。对于硅，设置 $E_g^{\\mathrm{KS}} = 0.60\\,\\mathrm{eV}$、$\\Delta E = 0.50\\,\\mathrm{eV}$ 和 $E_g^{\\mathrm{target}} = 1.23\\,\\mathrm{eV}$。此校准给出\n$$\nS_0 \\;=\\; \\bigl(E_g^{\\mathrm{target}} - E_g^{\\mathrm{KS}}\\bigr)\\,\\varepsilon(N_{\\mathrm{ref}}).\n$$\n该模型确保 $E_g^{\\mathrm{GW}}(N_{\\mathrm{ref}}) = E_g^{\\mathrm{target}}$，并且当 $N_c$ 减小时（由于屏蔽减弱），带隙会增加，这与物理预期一致。\n\n按如下方式在程序中实现计算。\n\n- 对任意非负整数 $N_c$，使用以下公式计算 $\\chi_0(N_c)$\n  $$\n  \\chi_0(N_c) \\;=\\; \\sum_{m=1}^{N_c} \\frac{1}{(1+m^2)\\,\\bigl(E_g^{\\mathrm{KS}} + m \\Delta E\\bigr)}.\n  $$\n  如果 $N_c = 0$，定义空和为 $0$。\n\n- 使用 $N_{\\mathrm{ref}} = 2000$ 计算 $\\chi_0(N_{\\mathrm{ref}})$，然后使用 $\\varepsilon_\\infty = 12$ 计算 $\\beta = \\dfrac{\\varepsilon_\\infty - 1}{\\chi_0(N_{\\mathrm{ref}})}$。\n\n- 计算 $\\varepsilon(N_c) = 1 + \\beta \\chi_0(N_c)$。\n\n- 使用 $E_g^{\\mathrm{KS}} = 0.60\\,\\mathrm{eV}$ 和 $E_g^{\\mathrm{target}} = 1.23\\,\\mathrm{eV}$ 计算 $S_0 = \\bigl(E_g^{\\mathrm{target}} - E_g^{\\mathrm{KS}}\\bigr)\\,\\varepsilon(N_{\\mathrm{ref}})$。\n\n- 计算 $E_g^{\\mathrm{GW}}(N_c) = E_g^{\\mathrm{KS}} + \\dfrac{S_0}{\\varepsilon(N_c)}$。\n\n数值和单位要求：\n\n- 所有能量必须以 $\\mathrm{eV}$ 表示。\n- 报告 $E_g^{\\mathrm{GW}}(N_c)$，单位为 $\\mathrm{eV}$，四舍五入到三位小数。\n\n测试组：\n\n对以下 $N_c$ 值评估模型：$0$、$1$、$2$、$5$、$10$、$50$、$200$、$2000$。\n\n最终输出格式：\n\n- 你的程序应生成单行输出，其中包含八个计算出的带隙值（单位为 $\\mathrm{eV}$），格式为逗号分隔的 Python 风格列表，不含多余空格，例如 $[x_1,x_2,\\dots,x_8]$，其中每个 $x_i$ 是四舍五入到三位小数的十进制数。\n- 不应打印任何其他文本。\n\n你的程序必须是在指定语言和环境下的完整、可运行的实现，并且不得要求任何输入。数值算法应直接遵循上述定义，不使用任何闭合形式的求和捷径或外部数据源。", "solution": "所呈现的问题陈述是一个自洽、有科学依据且定义明确的计算练习。它概述了一个简化但具有物理动机的模型，用于研究准粒子带隙相对于 GW 计算中包含的空带数量的收敛性。所有参数、方程和边界条件都已明确定义，不存在内部矛盾、事实错误或含糊之处。该模型正确地捕捉了定性物理：由介电函数 $\\varepsilon$ 表示的屏蔽效应随包含的跃迁通道数 $N_c$ 的增加而增强，这反过来又减小了对 Kohn-Sham 带隙的 GW 校正，导致准粒子带隙 $E_g^{\\mathrm{GW}}$ 向下收敛至最终值。因此，该问题是有效的，并将推导求解。\n\n目标是计算晶体硅的准粒子带隙 $E_g^{\\mathrm{GW}}(N_c)$，作为独立粒子极化率 $\\chi_0$ 求和中包含的导带数量 $N_c$ 的函数。计算通过一系列校准步骤进行。\n\n首先，我们必须实现静态独立粒子极化率 $\\chi_0(N_c)$ 的函数。根据提供的模型，它由以下求和给出：\n$$\n\\chi_0(N_c) \\;=\\; \\sum_{m=1}^{N_c} \\frac{1}{(1+m^2)\\,\\bigl(E_g^{\\mathrm{KS}} + m \\Delta E\\bigr)}\n$$\n此计算使用 Kohn-Sham 带隙 $E_g^{\\mathrm{KS}} = 0.60\\,\\mathrm{eV}$ 和导带能级间距 $\\Delta E = 0.50\\,\\mathrm{eV}$。按照规定，在不包含任何导带的情况下（$N_c=0$），空和定义为 $\\chi_0(0) = 0$。对于任何 $N_c > 0$，这需要对能带指数 $m$ 从 $1$ 到 $N_c$ 进行直接的数值求和。\n\n其次，我们确定模型的校准常数。这是在一个大的参考能带数 $N_{\\mathrm{ref}} = 2000$ 下进行的，此时物理性质被假定已收敛到其目标值。介电函数的模型为\n$$\n\\varepsilon(N_c) \\;=\\; 1 + \\beta \\,\\chi_0(N_c)\n$$\n常数 $\\beta$ 将极化率与屏蔽联系起来，并通过强制 $\\varepsilon(N_{\\mathrm{ref}})$ 等于已知的硅静态介电常数 $\\varepsilon_\\infty = 12$ 来进行校准。这得到：\n$$\n\\beta \\;=\\; \\frac{\\varepsilon_\\infty - 1}{\\chi_0(N_{\\mathrm{ref}})} \\;=\\; \\frac{12 - 1}{\\chi_0(2000)} \\;=\\; \\frac{11}{\\chi_0(2000)}\n$$\n为了计算 $\\beta$，我们首先使用求和公式在 $N_c = 2000$ 的情况下计算 $\\chi_0(N_{\\mathrm{ref}})$。\n\n第三，我们确定准粒子带隙模型的敏感性参数 $S_0$。带隙由以下公式给出：\n$$\nE_g^{\\mathrm{GW}}(N_c) \\;=\\; E_g^{\\mathrm{KS}} \\;+\\; \\frac{S_0}{\\varepsilon(N_c)}\n$$\n参数 $S_0$ 通过要求在参考能带数下计算出的带隙 $E_g^{\\mathrm{GW}}(N_{\\mathrm{ref}})$ 与目标实验带隙 $E_g^{\\mathrm{target}} = 1.23\\,\\mathrm{eV}$ 相匹配来进行校准。这得到：\n$$\nS_0 \\;=\\; \\bigl(E_g^{\\mathrm{target}} - E_g^{\\mathrm{KS}}\\bigr)\\,\\varepsilon(N_{\\mathrm{ref}})\n$$\n根据构造，$\\varepsilon(N_{\\mathrm{ref}}) = 1 + \\beta \\chi_0(N_{\\mathrm{ref}}) = 1 + \\frac{\\varepsilon_\\infty - 1}{\\chi_0(N_{\\mathrm{ref}})} \\chi_0(N_{\\mathrm{ref}}) = \\varepsilon_\\infty$。因此，我们可以更直接地写出 $S_0$：\n$$\nS_0 \\;=\\; \\bigl(E_g^{\\mathrm{target}} - E_g^{\\mathrm{KS}}\\bigr)\\,\\varepsilon_\\infty \\;=\\; (1.23\\,\\mathrm{eV} - 0.60\\,\\mathrm{eV}) \\times 12 \\;=\\; 0.63\\,\\mathrm{eV} \\times 12 \\;=\\; 7.56\\,\\mathrm{eV}\n$$\n\n第四，在确定了校准参数 $\\beta$ 和 $S_0$ 之后，我们现在可以计算任意 $N_c$ 值下的准粒子带隙 $E_g^{\\mathrm{GW}}(N_c)$。对于每个指定的 $N_c$ 值（即 $N_c \\in \\{0, 1, 2, 5, 10, 50, 200, 2000\\}$），计算步骤如下：\n1.  使用其求和定义计算 $\\chi_0(N_c)$。\n2.  计算介电函数 $\\varepsilon(N_c) = 1 + \\beta \\chi_0(N_c)$。\n3.  计算准粒子带隙 $E_g^{\\mathrm{GW}}(N_c) = E_g^{\\mathrm{KS}} + \\frac{S_0}{\\varepsilon(N_c)}$。\n4.  最终值以 $\\mathrm{eV}$ 为单位报告，并四舍五入到三位小数。\n\n这个系统化的过程将进行数值实现。对于 $N_c=0$，我们有 $\\chi_0(0)=0$，这导致 $\\varepsilon(0)=1$，带隙变为 $E_g^{\\mathrm{GW}}(0) = E_g^{\\mathrm{KS}} + S_0 = 0.60\\,\\mathrm{eV} + 7.56\\,\\mathrm{eV} = 8.16\\,\\mathrm{eV}$。这代表了带间跃迁屏蔽为零的极限情况。对于 $N_c=2000$，根据构造，计算必须得出目标带隙：$E_g^{\\mathrm{GW}}(2000) = E_g^{\\mathrm{target}} = 1.23\\,\\mathrm{eV}$。这两点可作为数值实现的分析性检验。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the GW quasiparticle band gap of silicon as a function of the\n    number of conduction bands (Nc) used in the polarizability calculation,\n    based on a simplified model.\n    \"\"\"\n    \n    # Define the test cases and physical constants from the problem statement.\n    test_cases_Nc = [0, 1, 2, 5, 10, 50, 200, 2000]\n    \n    E_g_KS = 0.60      # Kohn-Sham gap in eV\n    delta_E = 0.50     # Conduction band energy spacing in eV\n    E_g_target = 1.23  # Target GW quasiparticle gap in eV\n    eps_inf = 12.0     # Target static dielectric constant\n    N_ref = 2000       # Reference number of bands for calibration\n\n    def calculate_chi_0(Nc, E_g_KS_val, delta_E_val):\n        \"\"\"\n        Computes the independent-particle polarizability chi_0 for a given\n        number of conduction bands Nc.\n        \"\"\"\n        if Nc == 0:\n            return 0.0\n        \n        # m is the conduction band index, from 1 to Nc\n        m = np.arange(1, Nc + 1)\n        \n        # Denominator terms\n        matrix_element_sq_decay = 1.0 / (1.0 + m**2)\n        energy_denominator = E_g_KS_val + m * delta_E_val\n        \n        # Summation over all bands\n        sum_val = np.sum(matrix_element_sq_decay / energy_denominator)\n        \n        return sum_val\n\n    # Step 1: Calculate chi_0 at the reference number of bands\n    chi_0_ref = calculate_chi_0(N_ref, E_g_KS, delta_E)\n    \n    # Step 2: Calibrate the dielectric model by computing beta\n    # beta = (eps_inf - 1) / chi_0(N_ref)\n    beta = (eps_inf - 1.0) / chi_0_ref\n    \n    # Step 3: Calibrate the quasiparticle gap model by computing S_0\n    # S_0 = (E_g_target - E_g_KS) * epsilon(N_ref)\n    # Since epsilon(N_ref) = eps_inf by construction, we can simplify this.\n    S_0 = (E_g_target - E_g_KS) * eps_inf\n\n    # Step 4: Compute the quasiparticle gap for each Nc in the test suite\n    results = []\n    for Nc in test_cases_Nc:\n        # Compute polarizability for the current Nc\n        chi_0_Nc = calculate_chi_0(Nc, E_g_KS, delta_E)\n        \n        # Compute the dielectric constant for the current Nc\n        eps_Nc = 1.0 + beta * chi_0_Nc\n        \n        # Compute the GW quasiparticle gap\n        E_g_GW_Nc = E_g_KS + S_0 / eps_Nc\n        \n        results.append(E_g_GW_Nc)\n\n    # Format the results to three decimal places and prepare for printing.\n    # The f-string format ensures trailing zeros, e.g., 1.230\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2464600"}, {"introduction": "单次（one-shot）$G_0W_0$ 计算只是GW方法的第一步，更高精度的计算需要考虑自洽性。本高级练习 [@problem_id:2930191] 将指导您构建一个迭代自洽计算方案。在此方案中，电子屏蔽将根据计算出的准粒子能量进行更新，而更新后的屏蔽又反过来影响准粒子能量，形成一个反馈闭环。这个练习不仅能加深您对准粒子与其屏蔽环境相互作用的理解，还要求您为戴森方程实现一个数值求解器，是一次宝贵的综合性实践。", "problem": "设计并实现一个完整且可运行的程序，该程序在格林函数-屏蔽库仑相互作用 (GW) 近似下模拟一个$2$能级系统，具体为一个在屏蔽相互作用$W$上迭代至自洽的$GW_0$方案。该程序必须计算准粒子能量和准粒子重整化因子向收敛的演化过程。程序必须采用一种基于原理的构造方法，从Dyson方程和GW近似下的自能定义出发，然后特化为一个下面将完整说明的、简化的、内部自洽的$2$能级模型。\n\n您必须使用的基本出发点是：\n- 相互作用单粒子格林函数的Dyson方程，该方程意味着状态$i$的准粒子 (QP) 能量$E_{i}$满足标量Dyson条件\n$$\nE_{i} = \\varepsilon_{i}^{(0)} + \\operatorname{Re}\\,\\Sigma_{i}\\!\\left(E_{i}\\right),\n$$\n其中$\\varepsilon_{i}^{(0)}$是一个无相互作用的参考能量，$\\Sigma_{i}(\\omega)$是状态$i$的自能的对角矩阵元。\n- 格林函数-屏蔽库仑相互作用 (GW) 近似将自能定义为\n$$\n\\Sigma(\\omega) = \\mathrm{i}\\,G(\\omega)\\,W(\\omega),\n$$\n其中$G(\\omega)$是单粒子格林函数，$W(\\omega)$是动态屏蔽库仑相互作用。在$GW_0$方案中，屏蔽相互作用$W$被迭代至自洽，而用于构建自能分母的格林函数保持与无相互作用能量$\\{\\varepsilon_{i}^{(0)}\\}$挂钩。\n\n特化为一个具有一个占据能级$v$和一个未占据能级$c$的$2$能级模型，占据数分别为$f_{v} = 1$和$f_{c} = 0$。所有能量必须以电子伏特 (eV) 表示。无相互作用能量为$\\varepsilon_{v}^{(0)}$和$\\varepsilon_{c}^{(0)}$，初始带隙为$\\Delta^{(0)} = \\varepsilon_{c}^{(0)} - \\varepsilon_{v}^{(0)}$。\n\n屏蔽相互作用模型与$GW_0$更新规则：\n- 零频屏蔽相互作用由一个类随机相近似 (RPA) 的标量表达式建模\n$$\nW(0) \\equiv W_{0} = \\frac{v}{1 - v\\,\\Pi(0)},\n$$\n其中$2$能级系统的唯象静态独立粒子极化率为\n$$\n\\Pi(0) = -\\frac{\\alpha_{0}}{\\Delta},\n$$\n其中$\\Delta$是当前的准粒子带隙$\\Delta = E_{c} - E_{v}$，$v$是裸库仑尺度，$\\alpha_{0}  0$是一个给定的常数。这种形式保证了当$\\Delta  0$时$W_{0} \\le v$，并提供了准粒子带隙对屏蔽的反馈。在$GW_0$循环中，您必须使用当前的准粒子带隙$\\Delta$重新计算$W_{0}$，并在$W_{0}$上迭代至收敛。\n\n各能级$i \\in \\{v,c\\}$的动态自能模型：\n- 使用一个单玻色子（等离激元-极点）自能拟设，该拟设保留了非平凡的频率依赖性，并遵循$GW_0$中固定无相互作用分母的精神，\n$$\n\\Sigma_{i}(\\omega) = \\Sigma_{x,i} + A_{i}\\left[\\frac{1 - f_{i}}{\\omega - \\varepsilon_{i}^{(0)} - \\Omega} + \\frac{f_{i}}{\\omega - \\varepsilon_{i}^{(0)} + \\Omega}\\right],\n$$\n其中$\\Sigma_{x,i}$是依赖于能级的静态交换移动，$A_{i} \\ge 0$是关联振幅，$f_{i}\\in\\{0,1\\}$是占据数，$\\Omega$是有效玻色子频率。将关联振幅设置为与静态屏蔽修正成比例，\n$$\n\\Delta W \\equiv W_{0} - v \\le 0,\\quad A_{i} = -c_{i}\\,\\Delta W,\n$$\n其中$c_{i}  0$是给定的，并使用依赖于带隙的玻色子频率\n$$\n\\Omega = \\sqrt{\\Omega_{0}^{2} + \\beta\\,\\Delta^{2}},\n$$\n其中$\\Omega_{0}  0$和$\\beta \\ge 0$是给定的常数。注意，当$f_{v} = 1$和$f_{c} = 0$时，有\n$$\n\\Sigma_{v}(\\omega) = \\Sigma_{x,v} + \\frac{A_{v}}{\\omega - \\varepsilon_{v}^{(0)} + \\Omega},\\qquad\n\\Sigma_{c}(\\omega) = \\Sigma_{x,c} + \\frac{A_{c}}{\\omega - \\varepsilon_{c}^{(0)} - \\Omega}.\n$$\n\n准粒子重整化因子：\n- 对每个能级$i \\in \\{v,c\\}$，定义\n$$\nZ_{i} = \\left[1 - \\left.\\frac{\\partial}{\\partial \\omega}\\operatorname{Re}\\,\\Sigma_{i}(\\omega)\\right|_{\\omega = E_{i}}\\right]^{-1},\n$$\n在此模型中，其计算结果为\n$$\n\\frac{\\partial}{\\partial \\omega}\\Sigma_{v}(\\omega) = -\\frac{A_{v}}{\\left(\\omega - \\varepsilon_{v}^{(0)} + \\Omega\\right)^{2}},\\qquad\n\\frac{\\partial}{\\partial \\omega}\\Sigma_{c}(\\omega) = -\\frac{A_{c}}{\\left(\\omega - \\varepsilon_{c}^{(0)} - \\Omega\\right)^{2}}.\n$$\n\n算法要求：\n- 将带隙$\\Delta$初始化为$\\Delta^{(0)} = \\varepsilon_{c}^{(0)} - \\varepsilon_{v}^{(0)}$。\n- 迭代以下步骤直至$W_{0}$收敛：\n  - 根据当前$\\Delta$使用$W_{0} = v / \\left(1 + v\\,\\alpha_{0}/\\Delta\\right)$计算$W_{0}$。\n  - 设置$\\Delta W = W_{0} - v$和$A_{i} = -c_{i}\\,\\Delta W$（对于$i\\in\\{v,c\\}$）。\n  - 计算$\\Omega = \\sqrt{\\Omega_{0}^{2} + \\beta\\,\\Delta^{2}}$。\n  - 对每个能级$i\\in\\{v,c\\}$，求解标量Dyson方程$E_{i} = \\varepsilon_{i}^{(0)} + \\Sigma_{i}(E_{i})$，以找到与$\\varepsilon_{i}^{(0)}$连续相连的根。使用一个能避开$\\Sigma_{i}(\\omega)$在$i=v$时位于$\\omega = \\varepsilon_{v}^{(0)} - \\Omega$处和$i=c$时位于$\\omega = \\varepsilon_{c}^{(0)} + \\Omega$处的简单极点的稳健求根器。\n  - 更新带隙$\\Delta \\leftarrow E_{c} - E_{v}$并重新计算$W_{0}$。\n  - 当连续迭代中$W_{0}$的绝对变化小于容差$\\tau_{W}$或达到最大迭代次数$N_{\\max}$后停止。\n- 收敛后，使用上述导数公式，在收敛的$E_{v}$和$E_{c}$处计算$Z_{v}$和$Z_{c}$。\n\n数值单位与输出：\n- 所有能量，包括$\\varepsilon_{v}^{(0)}$、$\\varepsilon_{c}^{(0)}$、$v$、$\\Omega_{0}$、$E_{v}$、$E_{c}$和$W_{0}$，都必须以电子伏特 (eV) 为单位处理。报告$E_{v}$和$E_{c}$时，以eV为单位并四舍五入到六位小数。重整化因子$Z_{v}$和$Z_{c}$是无量纲的，必须报告并四舍五入到六位小数。\n\n收敛参数：\n- 使用绝对容差$\\tau_{W} = 10^{-10}$（对于$W_{0}$，单位为eV）和最大迭代次数$N_{\\max} = 200$。\n- 为求解Dyson方程，通过使用带有步长阻尼和步长拒绝的保护性牛顿法来确保数值稳定性，拒绝那些会使迭代点比固定安全距离$\\delta = 10^{-8}$ (eV) 更靠近自能极点的步长。对每个根使用停止准则$|E_{i} - \\varepsilon_{i}^{(0)} - \\Sigma_{i}(E_{i})| \\le 10^{-12}$。\n\n测试套件：\n提供以下三个参数集的结果，每个参数集以有序元组$(\\varepsilon_{v}^{(0)}, \\varepsilon_{c}^{(0)}, v, \\alpha_{0}, \\Omega_{0}, \\beta, \\Sigma_{x,v}, \\Sigma_{x,c}, c_{v}, c_{c})$的形式给出，其中所有能量单位为eV，无量纲参数无单位：\n- 情况1（一般中等强度屏蔽）：$(-5.00, 2.00, 5.00, 3.00, 10.00, 0.20, -1.00, -0.50, 1.00, 0.80)$。\n- 情况2（弱屏蔽极限）：$(-6.00, 1.50, 4.00, 0.20, 8.00, 0.10, -0.80, -0.40, 0.90, 0.70)$。\n- 情况3（接近强屏蔽边界但稳定）：$(-1.00, 2.00, 6.00, 0.45, 5.00, 0.50, -0.50, -0.20, 1.20, 1.10)$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，包含一个逗号分隔的列表之列表形式的结果，按顺序对每种情况包含四个数字$[E_{v}, E_{c}, Z_{v}, Z_{c}]$，并按指定精度四舍五入，例如，一个形如\n\"[ [Ev_case1,Ec_case1,Zv_case1,Zc_case1], [Ev_case2,Ec_case2,Zv_case2,Zc_case2], [Ev_case3,Ec_case3,Zv_case3,Zc_case3] ]\"\n的字符串，不含任何额外字符或换行。\n\n您的实现必须是完全自包含的，不要求任何用户输入。计算必须遵循上述基于原理的构建过程，保持数值稳定，并严格遵守指定的容差和输出格式。", "solution": "问题陈述已经过严格审查，并被确定为有效。这是一个自包含、数学上一致且有科学依据的问题，它使用多体理论中一个简化但定义明确的近似来模拟一个物理系统。它提出了一个具有特定算法和数值要求的清晰计算任务。因此，我们将着手推导和实现解决方案。\n\n该问题要求实现一个针对二能级电子系统的自洽$GW_{0}$计算。目标是计算价能级$v$和导能级$c$的准粒子 (QP) 能量$E_{v}$和$E_{c}$，以及相应的准粒子重整化因子$Z_{v}$和$Z_{c}$。该计算必须迭代进行，直到静态屏蔽库仑相互作用$W_{0}$收敛为止。\n\n该过程基于一组描述系统的耦合非线性方程。对于$i \\in \\{v, c\\}$，准粒子能量$E_{i}$是Dyson方程的解：\n$$\nE_{i} = \\varepsilon_{i}^{(0)} + \\operatorname{Re}\\,\\Sigma_{i}(E_{i})\n$$\n其中$\\varepsilon_{i}^{(0)}$是无相互作用（裸）能量，$\\Sigma_{i}(\\omega)$是自能。在指定模型中，自能是实值的，因此$\\operatorname{Re}$算符是多余的。对于占据的价能级 ($f_{v}=1$) 和未占据的导能级 ($f_{c}=0$)，自能由下式给出：\n$$\n\\Sigma_{v}(\\omega) = \\Sigma_{x,v} + \\frac{A_{v}}{\\omega - \\varepsilon_{v}^{(0)} + \\Omega}\n$$\n$$\n\\Sigma_{c}(\\omega) = \\Sigma_{x,c} + \\frac{A_{c}}{\\omega - \\varepsilon_{c}^{(0)} - \\Omega}\n$$\n这些量依赖于几个参数，而这些参数又依赖于准粒子带隙$\\Delta = E_{c} - E_{v}$。这就产生了一个自洽性问题。\n\n自洽循环按以下方式构建。设迭代指数为$n$。\n1.  从初始准粒子带隙$\\Delta^{(0)} = \\varepsilon_{c}^{(0)} - \\varepsilon_{v}^{(0)}$开始。对于迭代$n \\ge 0$，我们有一个带隙$\\Delta^{(n)}$。\n\n2.  使用所提供的类随机相近似 (RPA) 模型计算静态屏蔽相互作用$W_{0}^{(n)}$：\n    $$\n    W_{0}^{(n)} = \\frac{v}{1 - v\\,\\Pi^{(n)}(0)} = \\frac{v}{1 + v\\,\\alpha_{0}/\\Delta^{(n)}}\n    $$\n    此处，$\\Pi^{(n)}(0) = -\\alpha_{0}/\\Delta^{(n)}$是静态极化率。介电常数$\\epsilon(0) = 1 - v\\Pi(0)$必须为正的物理约束要求$1 + v\\alpha_0/\\Delta^{(n)}  0$。鉴于$\\Delta  0$，$v  0$，$\\alpha_0  0$，此条件总是满足的。\n\n3.  从$W_{0}^{(n)}$确定关联振幅$A_{i}^{(n)}$和有效玻色子频率$\\Omega^{(n)}$：\n    $$\n    \\Delta W^{(n)} = W_{0}^{(n)} - v\n    $$\n    $$\n    A_{i}^{(n)} = -c_{i}\\,\\Delta W^{(n)} \\quad \\text{for } i \\in \\{v, c\\}\n    $$\n    $$\n    \\Omega^{(n)} = \\sqrt{\\Omega_{0}^{2} + \\beta\\,(\\Delta^{(n)})^{2}}\n    $$\n    注意$\\Delta W^{(n)} = v / (1 + v\\alpha_0/\\Delta^{(n)}) - v = -v^2\\alpha_0/(\\Delta^{(n)} + v\\alpha_0)$。由于所有常数均为正，$\\Delta W^{(n)} \\le 0$，这确保了按要求$A_{i}^{(n)} \\ge 0$。\n\n4.  求解每个能级的Dyson方程，以获得下一次迭代的准粒子能量$E_{v}^{(n+1)}$和$E_{c}^{(n+1)}$。这需要找到非线性标量方程$g_{i}(E) = 0$的根，其中：\n    $$\n    g_{i}(E) = E - \\varepsilon_{i}^{(0)} - \\Sigma_{i}^{(n)}(E)\n    $$\n    这是最关键的数值步骤。对于每个能级$i$，函数$g_i(E)$是单调的，因为其导数严格为正：\n    $$\n    \\frac{d g_{v}(E)}{dE} = 1 + \\frac{A_{v}^{(n)}}{\\left(E - \\varepsilon_{v}^{(0)} + \\Omega^{(n)}\\right)^{2}}  1\n    $$\n    $$\n    \\frac{d g_{c}(E)}{dE} = 1 + \\frac{A_{c}^{(n)}}{\\left(E - \\varepsilon_{c}^{(0)} - \\Omega^{(n)}\\right)^{2}}  1\n    $$\n    函数$g_v(E)$在$E = \\varepsilon_{v}^{(0)} - \\Omega^{(n)}$处有一个简单极点，而$g_c(E)$在$E = \\varepsilon_{c}^{(0)} + \\Omega^{(n)}$处有一个。单调性保证了在不含极点且包含裸能量$\\varepsilon_i^{(0)}$的区域内存在唯一的根。\n    实现了一个稳健的Newton-Raphson求根算法。迭代式为$E_{k+1} = E_k - g_i(E_k)/g'_i(E_k)$。为确保稳定性，引入了一个保护措施：如果一个牛顿步会使下一个迭代点$E_{k+1}$太靠近（在$\\delta=10^{-8}\\,\\text{eV}$的距离内）自能极点，则拒绝该步，并代之以二分步，将迭代点移动到其当前位置和安全边界的中间。初始猜测值是裸能量$E_0 = \\varepsilon_i^{(0)}$，它总是位于正确的解域中。求解器迭代直到残差$|g_i(E)|$低于$10^{-12}$的容差。\n\n5.  为下一次迭代更新准粒子带隙：$\\Delta^{(n+1)} = E_{c}^{(n+1)} - E_{v}^{(n+1)}$。\n\n6.  检查自洽循环的收敛性。当屏蔽相互作用的变化量$|W_{0}^{(n)} - W_{0}^{(n-1)}|$小于容差$\\tau_{W} = 10^{-10}\\,\\text{eV}$时，过程终止。如果在$N_{\\max} = 200$次迭代内未达到收敛，则循环终止，并使用最后一次迭代的结果。\n\n收敛后，获得了最终的准粒子能量$E_v$和$E_c$以及最终参数$A_v, A_c, \\Omega$，便计算准粒子重整化因子$Z_i$。这些因子衡量了准粒子态在单粒子态上的投影。\n$$\nZ_{i} = \\left[1 - \\left.\\frac{\\partial\\Sigma_{i}(\\omega)}{\\partial\\omega}\\right|_{\\omega = E_{i}}\\right]^{-1}\n$$\n使用指定模型，在各自的准粒子能量处计算的导数为：\n$$\n\\left.\\frac{\\partial\\Sigma_{v}(\\omega)}{\\partial\\omega}\\right|_{\\omega=E_{v}} = -\\frac{A_{v}}{\\left(E_{v} - \\varepsilon_{v}^{(0)} + \\Omega\\right)^{2}}\n$$\n$$\n\\left.\\frac{\\partial\\Sigma_{c}(\\omega)}{\\partial\\omega}\\right|_{\\omega=E_{c}} = -\\frac{A_{c}}{\\left(E_{c} - \\varepsilon_{c}^{(0)} - \\Omega\\right)^{2}}\n$$\n然后，对每个测试用例，以指定的精度报告最终计算出的值$E_v, E_c, Z_v, Z_c$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the self-consistent GW0 calculations for all test cases\n    and print the final results in the specified format.\n    \"\"\"\n\n    # Test cases as specified in the problem statement.\n    # (eps_v0, eps_c0, v, alpha0, Omega0, beta, Sigma_xv, Sigma_xc, cv, cc)\n    test_cases = [\n        (-5.00, 2.00, 5.00, 3.00, 10.00, 0.20, -1.00, -0.50, 1.00, 0.80),\n        (-6.00, 1.50, 4.00, 0.20, 8.00, 0.10, -0.80, -0.40, 0.90, 0.70),\n        (-1.00, 2.00, 6.00, 0.45, 5.00, 0.50, -0.50, -0.20, 1.20, 1.10),\n    ]\n\n    # Convergence and numerical parameters\n    tol_W = 1e-10\n    max_iter_gw = 200\n    \n    all_results = []\n    for case_params in test_cases:\n        result = run_gw_calculation(case_params, tol_W, max_iter_gw)\n        all_results.append(result)\n\n    # Format the final output string exactly as specified.\n    inner_strings = []\n    for res_case in all_results:\n        # Format numbers to 6 decimal places.\n        formatted_nums = [f\"{v:.6f}\" for v in res_case]\n        s = \"[\" + \",\".join(formatted_nums) + \"]\"\n        inner_strings.append(s)\n\n    # Join with \", \" and add outer brackets with spaces.\n    final_output = \"[ \" + \", \".join(inner_strings) + \" ]\"\n    # The problem statement example has spaces inside the brackets, but requires no extra chars. Let's follow the format string.\n    final_output_string = \"[\" + \",\".join(inner_strings) + \"]\"\n    print(final_output_string)\n\ndef solve_dyson_equation(eps0, Sigma_x, A, Omega, is_valence, tol=1e-12, max_iter=100, safety_dist=1e-8):\n    \"\"\"\n    Solves the scalar Dyson equation using a safeguarded Newton-Raphson method.\n\n    Args:\n        eps0 (float): Bare energy.\n        Sigma_x (float): Static exchange self-energy.\n        A (float): Correlation amplitude.\n        Omega (float): Effective boson frequency.\n        is_valence (bool): True for valence level (v), False for conduction level (c).\n        tol (float): Convergence tolerance on the residual value.\n        max_iter (int): Maximum number of iterations.\n        safety_dist (float): Safety distance from the pole.\n\n    Returns:\n        float: The converged quasiparticle energy E.\n    \"\"\"\n    if is_valence:\n        pole = eps0 - Omega\n        func = lambda E: E - eps0 - Sigma_x - A / (E - eps0 + Omega)\n        fprime = lambda E: 1.0 + A / (E - eps0 + Omega)**2\n    else:\n        pole = eps0 + Omega\n        func = lambda E: E - eps0 - Sigma_x - A / (E - eps0 - Omega)\n        fprime = lambda E: 1.0 + A / (E - eps0 - Omega)**2\n\n    E = eps0  # Initial guess\n\n    for _ in range(max_iter):\n        residual = func(E)\n        if abs(residual)  tol:\n            return E\n\n        deriv = fprime(E)\n        if abs(deriv)  1e-20: # Should not happen as deriv > 1\n             raise RuntimeError(\"Derivative is near zero. Newton method fails.\")\n\n        step = residual / deriv\n        E_new = E - step\n\n        # Safeguard: Pole avoidance\n        if is_valence:  # Root must be E > pole\n            if E_new = pole + safety_dist:\n                E = (E + pole + safety_dist) / 2.0  # Bisection step\n                continue\n        else:  # Root must be E  pole\n            if E_new >= pole - safety_dist:\n                E = (E + pole - safety_dist) / 2.0  # Bisection step\n                continue\n        \n        E = E_new\n\n    raise RuntimeError(f\"Dyson equation solver did not converge for eps0={eps0}.\")\n\ndef run_gw_calculation(params, tol_W, max_iter_gw):\n    \"\"\"\n    Performs the self-consistent GW0 calculation for a single parameter set.\n    \"\"\"\n    (eps_v0, eps_c0, v, alpha0, Omega0, beta, \n     Sigma_xv, Sigma_xc, cv, cc) = params\n    \n    # Initialization\n    delta = eps_c0 - eps_v0\n    W0 = 0.0  # Initial value for W0\n\n    for _ in range(max_iter_gw):\n        W0_old = W0\n\n        # Check for screening instability\n        if delta = 0 or (1.0 + v * alpha0 / delta) = 0:\n            raise ValueError(f\"Screening instability encountered: Delta = {delta:.4f} eV.\")\n\n        # 1. Update W0\n        W0 = v / (1.0 + v * alpha0 / delta)\n\n        # 2. Update self-energy parameters\n        delta_W = W0 - v\n        Av = -cv * delta_W\n        Ac = -cc * delta_W\n        Omega = np.sqrt(Omega0**2 + beta * delta**2)\n\n        # 3. Solve Dyson equations for Ev and Ec\n        Ev = solve_dyson_equation(eps_v0, Sigma_xv, Av, Omega, is_valence=True)\n        Ec = solve_dyson_equation(eps_c0, Sigma_xc, Ac, Omega, is_valence=False)\n        \n        # 4. Update gap\n        delta = Ec - Ev\n\n        # 5. Check convergence\n        if abs(W0 - W0_old)  tol_W:\n            break\n    \n    # After convergence, calculate renormalization factors Z\n    dSigma_domega_v = -Av / (Ev - eps_v0 + Omega)**2\n    Zv = 1.0 / (1.0 - dSigma_domega_v)\n    \n    dSigma_domega_c = -Ac / (Ec - eps_c0 - Omega)**2\n    Zc = 1.0 / (1.0 - dSigma_domega_c)\n\n    return [Ev, Ec, Zv, Zc]\n\n\n# Execute the main function\nsolve()\n```", "id": "2930191"}]}