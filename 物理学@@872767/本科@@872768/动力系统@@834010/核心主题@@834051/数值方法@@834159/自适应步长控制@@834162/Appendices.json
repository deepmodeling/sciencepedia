{"hands_on_practices": [{"introduction": "任何自适应求解器其核心都在于调节步长的控制器。本练习将这一核心机制分解为其最简单的形式。通过理解求解器如何根据观测误差、目标容差和方法阶数来提出新步长，你将掌握所有自适应积分器都遵循的基本缩放定律[@problem_id:1659045]。", "problem": "在计算科学领域，数值方法被用于求常微分方程 (ODEs) 的近似解。现代求解器的一个关键方面是自适应步长控制，它通过调整积分步长 $h$ 来在维持期望精度水平的同时最小化计算成本。\n\n考虑一个 $p$ 阶的数值积分方法。已知在单步中产生的局部截断误差 $\\epsilon$ 与步长的 $(p+1)$ 次方成正比。这种关系可以表示为 $\\epsilon \\propto h^{p+1}$。\n\n一位工程师正在使用一个基于 $p=4$ 阶方法的此类求解器。该求解器为局部误差配置了一个恒定的目标容差 $tol$。在使用步长 $h_{old}$ 执行一步后，误差估计模块报告的局部误差为 $\\epsilon_{old} = \\frac{1}{2} tol$。为了准备下一个积分步骤，控制算法必须提出一个新的步长 $h_{new}$。选择新的步长，使得下一步的预测误差 $\\epsilon_{new}$ 恰好等于目标容差 $tol$。\n\n假设在这两个连续步骤之间，关联误差与步长的比例常数没有显著变化，请确定用旧步长 $h_{old}$ 表示所提出的新步长 $h_{new}$ 的表达式。", "solution": "一个 $p$ 阶方法的局部截断误差满足 $\\epsilon = C h^{p+1}$，其中 $C$ 是连续步骤之间一个近似恒定的比例因子。对于旧的步长，\n$$\n\\epsilon_{old} = C h_{old}^{p+1} = \\frac{1}{2} tol.\n$$\n对于提议的新步长，我们要求\n$$\n\\epsilon_{new} = C h_{new}^{p+1} = tol.\n$$\n两式相除，\n$$\n\\frac{\\epsilon_{new}}{\\epsilon_{old}} = \\frac{C h_{new}^{p+1}}{C h_{old}^{p+1}} = \\left(\\frac{h_{new}}{h_{old}}\\right)^{p+1} = \\frac{tol}{\\frac{1}{2} tol} = 2.\n$$\n因此，\n$$\n\\left(\\frac{h_{new}}{h_{old}}\\right)^{p+1} = 2 \\quad \\Rightarrow \\quad \\frac{h_{new}}{h_{old}} = 2^{\\frac{1}{p+1}}.\n$$\n对于 $p=4$，我们得到\n$$\nh_{new} = 2^{\\frac{1}{5}} h_{old}.\n$$", "answer": "$$\\boxed{2^{\\frac{1}{5}} h_{old}}$$", "id": "1659045"}, {"introduction": "一个自适应算法不仅需要知道如何调整步长，还需要知道当一个尝试步长因精度不足而被“拒绝”时该怎么办。本练习探讨了一个关键的决策点：在一次失败的步进后，我们是应该完全放弃该步，从起点用更小的步长重试，还是可以接受一个精度较低的低阶结果来推进计算？通过量化这一选择所带来的后果，你将更深刻地体会到稳健的求解器为何采用保守的“重试”策略 [@problem_id:1658979]。", "problem": "一位工程师正在模拟一个简单的冷却过程，该过程由初值问题 (IVP) $y' = -y$ 和初始条件 $y(0) = 1$ 控制。用于验证的已知解析解为 $y_{true}(t) = \\exp(-t)$。该模拟使用一个基于3阶显式龙格-库塔方法的自适应步长积分器，该方法包含一个用于误差估计的嵌入式2阶解。\n\n该方法从点 $(t_n, y_n)$ 开始，对于一个大小为 $h$ 的步长，计算三个中间阶段 $k_1, k_2, k_3$：\n- $k_1 = f(t_n, y_n)$\n- $k_2 = f(t_n + \\frac{1}{2}h, y_n + \\frac{1}{2}h k_1)$\n- $k_3 = f(t_n + h, y_n - h k_1 + 2h k_2)$\n其中对于这个特定的IVP，有 $f(t,y) = -y$。\n\n下一步的三阶近似由下式给出：\n$y_{n+1} = y_n + \\frac{h}{6}(k_1 + 4k_2 + k_3)$\n\n嵌入的二阶近似为：\n$\\tilde{y}_{n+1} = y_n + h k_2$\n\n步长控制算法按以下步骤进行：\n1. 估计该步的局部误差为 $\\Delta = |y_{n+1} - \\tilde{y}_{n+1}|$。\n2. 如果 $\\Delta \\le \\text{TOL}$，则接受该步。\n3. 如果 $\\Delta > \\text{TOL}$，则拒绝该步。使用以下公式计算一个新的、更小的步长 $h_{new}$：\n   $h_{new} = S \\cdot h_{old} \\cdot \\left(\\frac{\\text{TOL}}{\\Delta}\\right)^{1/3}$\n   常数设置为安全因子 $S=0.9$ 和绝对容差 $\\text{TOL} = 1/48$。\n\n从初始条件 $(t_0, y_0)=(0, 1)$ 开始，尝试了一个过大的第一步，步长为 $h_0=1$。这一步将被控制器拒绝。您的任务是比较在这次拒绝后继续进行的两种不同策略。\n\n**策略 A (重试)：**\n这是一种标准的、保守的方法。求解器完全丢弃失败的步，返回到状态 $(t_0, y_0)$，并从该点开始使用新计算的步长 $h_{new}$ 尝试一个新步。设得到的状态为 $(t_A, y_A)$。\n\n**策略 B (使用低阶解推进)：**\n在这种更激进且可能存在缺陷的策略中，求解器将时间推进 $h_0$，但接受低阶（且精度较低）的解。系统状态更新为 $(t_0 + h_0, \\tilde{y}_1)$。从这个新点开始，求解器使用相同的新步长 $h_{new}$ 进行下一步。设最终状态为 $(t_B, y_B)$。\n\n计算策略 B 的真实绝对误差与策略 A 的真实绝对误差之比，该比率定义为 $\\frac{|y_B - y_{true}(t_B)|}{|y_A - y_{true}(t_A)|}$。将您的最终答案四舍五入到四位有效数字。", "solution": "我们用给定的嵌入式 RK 对求解 IVP $y'=-y$，$y(0)=1$：\n- 从 $(t_{n},y_{n})$ 开始，步长为 $h$ 的阶段计算：\n$$\nk_{1}=f(t_{n},y_{n}),\\quad\nk_{2}=f\\!\\left(t_{n}+\\tfrac{1}{2}h,\\,y_{n}+\\tfrac{1}{2}hk_{1}\\right),\\quad\nk_{3}=f\\!\\left(t_{n}+h,\\,y_{n}-hk_{1}+2hk_{2}\\right),\n$$\n其中 $f(t,y)=-y$。\n- 三阶更新：\n$$\ny_{n+1}=y_{n}+\\tfrac{h}{6}\\,(k_{1}+4k_{2}+k_{3}).\n$$\n- 嵌入式二阶更新：\n$$\n\\tilde{y}_{n+1}=y_{n}+h\\,k_{2}.\n$$\n- 误差估计 $\\Delta=|y_{n+1}-\\tilde{y}_{n+1}|$ 和拒绝步的步长控制\n$$\nh_{\\text{new}}=S\\,h_{\\text{old}}\\left(\\frac{\\text{TOL}}{\\Delta}\\right)^{1/3},\\quad S=0.9,\\quad \\text{TOL}=\\frac{1}{48}.\n$$\n\n首先，从 $(t_{0},y_{0})=(0,1)$ 开始尝试步长 $h_{0}=1$：\n$$\nk_{1}=f(0,1)=-1,\\quad\nk_{2}=f\\!\\left(\\tfrac{1}{2},1+\\tfrac{1}{2}\\cdot 1\\cdot(-1)\\right)=f\\!\\left(\\tfrac{1}{2},\\tfrac{1}{2}\\right)=-\\tfrac{1}{2},\n$$\n$$\nk_{3}=f\\!\\left(1,\\,1-1\\cdot(-1)+2\\cdot 1\\cdot\\left(-\\tfrac{1}{2}\\right)\\right)=f(1,1)=-1.\n$$\n因此\n$$\ny_{1}=1+\\tfrac{1}{6}\\left(-1+4\\left(-\\tfrac{1}{2}\\right)-1\\right)=\\tfrac{1}{3},\\qquad\n\\tilde{y}_{1}=1+1\\cdot\\left(-\\tfrac{1}{2}\\right)=\\tfrac{1}{2}.\n$$\n误差估计为 $\\Delta=\\left|\\tfrac{1}{3}-\\tfrac{1}{2}\\right|=\\tfrac{1}{6}$，超过了 $\\text{TOL}=\\tfrac{1}{48}$，因此该步被拒绝。新的步长为\n$$\nh_{\\text{new}}=0.9\\cdot 1\\cdot\\left(\\frac{\\tfrac{1}{48}}{\\tfrac{1}{6}}\\right)^{1/3}\n=0.9\\left(\\frac{6}{48}\\right)^{1/3}=0.9\\left(\\frac{1}{8}\\right)^{1/3}=0.9\\cdot\\frac{1}{2}=0.45.\n$$\n\n方便注意到，对于线性标量测试方程 $y'=\\lambda y$（此处 $\\lambda=-1$），三阶 RK 更新为 $y_{n+1}=R(h\\lambda)\\,y_{n}$，其稳定性多项式为\n$$\nR(z)=1+z+\\frac{z^{2}}{2}+\\frac{z^{3}}{6}.\n$$\n等价地，可以通过阶段公式直接验证。对于从 $y_{n}$ 开始，步长为 $h=0.45$ 的情况，直接计算可得\n$$\ny_{n+1}=y_{n}\\left(1-h+\\frac{h^{2}}{2}-\\frac{h^{3}}{6}\\right)=y_{n}\\,R(-h).\n$$\n当 $h_{\\text{new}}=0.45=\\frac{9}{20}$ 时，我们得到\n$$\nR(-0.45)=1-0.45+\\frac{0.45^{2}}{2}-\\frac{0.45^{3}}{6}\n=1-\\frac{9}{20}+\\frac{81}{800}-\\frac{243}{16000}=\\frac{10177}{16000}=0.6360625.\n$$\n\n策略 A (重试)：用 $h_{\\text{new}}=0.45$ 从 $(0,1)$ 重新开始。在 $t_{A}=0.45$ 处的数值解和真实解分别为\n$$\ny_{A}=R(-0.45)\\cdot 1=0.6360625,\\qquad y_{\\text{true}}(t_{A})=\\exp(-0.45).\n$$\n因此绝对误差为\n$$\nE_{A}=|y_{A}-y_{\\text{true}}(t_{A})|=\\big|R(-0.45)-\\exp(-0.45)\\big|.\n$$\n数值上，$\\exp(-0.45)=0.6376281516217733$，所以\n$$\nE_{A}=|0.6360625-0.6376281516217733|=0.0015656516217733.\n$$\n\n策略 B (使用低阶解推进)：用嵌入值 $\\tilde{y}_{1}=\\tfrac{1}{2}$ 推进到 $t=1$，然后进行一个步长为 $h_{\\text{new}}=0.45$ 的步。在 $t_{B}=1+0.45$ 处的新数值解和真实解分别为\n$$\ny_{B}=R(-0.45)\\,\\tilde{y}_{1}=0.6360625\\cdot \\tfrac{1}{2}=0.31803125,\n$$\n$$\ny_{\\text{true}}(t_{B})=\\exp(-(1+0.45))=\\exp(-1)\\exp(-0.45).\n$$\n因此绝对误差为\n$$\nE_{B}=|y_{B}-y_{\\text{true}}(t_{B})|\n=\\big|R(-0.45)\\,\\tilde{y}_{1}-\\exp(-1)\\exp(-0.45)\\big|.\n$$\n使用分解式\n$$\nR(-0.45)\\,\\tilde{y}_{1}-\\exp(-1)\\exp(-0.45)\n=\\big(R(-0.45)-\\exp(-0.45)\\big)\\exp(-1)+R(-0.45)\\big(\\tilde{y}_{1}-\\exp(-1)\\big),\n$$\n其中 $\\exp(-1)=0.36787944117144233$ 且 $\\tilde{y}_{1}-\\exp(-1)=\\tfrac{1}{2}-\\exp(-1)=0.13212055882855767$，我们得到\n$$\nE_{B}=\\big|-E_{A}\\exp(-1)+R(-0.45)\\big(\\tfrac{1}{2}-\\exp(-1)\\big)\\big|\n=\\big|-0.0015656516217733\\cdot 0.36787944117144233+0.6360625\\cdot 0.13212055882855767\\big|.\n$$\n计算得，\n$$\n0.6360625\\cdot 0.13212055882855767=0.08403693294988947,\\quad\n0.0015656516217733\\cdot 0.36787944117144233=0.000575971043687124,\n$$\n所以\n$$\nE_{B}=|0.08403693294988947-0.000575971043687124|=0.08346096190620235.\n$$\n\n所求的比率为\n$$\n\\frac{|y_{B}-y_{\\text{true}}(t_{B})|}{|y_{A}-y_{\\text{true}}(t_{A})|}\n=\\frac{E_{B}}{E_{A}}\n=\\frac{0.08346096190620235}{0.0015656516217733}\\approx 53.3074923856.\n$$\n四舍五入到四位有效数字得到 $53.31$。", "answer": "$$\\boxed{53.31}$$", "id": "1658979"}, {"introduction": "自适应步长控制不仅是提高效率和精度的工具，它也是一种强大的诊断仪器。求解器选择的步长序列可以揭示解本身内在行为的深刻信息。本练习将挑战你分析当解趋近于有限时间奇点时，求解器的步长是如何自然地以可预测的方式缩小的，从而展示数值行为如何能够预示潜在的数学现象 [@problem_id:1659002]。", "problem": "一位工程师正在使用数值求解器模拟一个特定的化学反应。一种物质的浓度，记为 $y(t)$，由以下常微分方程控制：\n$$\n\\frac{dy}{dt} = A y^{n}\n$$\n其中 $t$ 是时间。对于这个特定的反应，常数参数为 $A > 0$ 和 $n=3$。在 $t=0$ 时的初始浓度为 $y(0) = y_0 > 0$。已知该方程的解 $y(t)$ 会经历一个有限时间奇点，意味着它在一个有限时间 $t_s > 0$ 时趋于无穷大。\n\n该数值求解器采用一种自适应步长控制策略。它使用一个 $p=4$ 阶的积分方法。该自适应算法的核心是调整步长 $h$，以在每一步中保持一个近似恒定的局部截断误差 $\\epsilon$。单步的局部截断误差由以下公式估计：\n$$\n\\text{Err} \\approx C |y^{(p+1)}(t)| h^{p+1}\n$$\n其中 $y^{(p+1)}(t)$ 是精确解关于时间的 $(p+1)$ 阶导数，而 $C$ 是一个表征该数值方法的常数。求解器调整 $h$ 以使得 $\\text{Err} \\approx \\epsilon$。\n\n当模拟时间 $t$ 接近奇点时间 $t_s$ 时，观察到步长 $h$ 会根据与剩余时间 $\\tau = t_s - t$ 的幂律关系而缩小。这个关系可以表示为：\n$$\nh \\approx K \\tau^{\\beta}\n$$\n对于某个常数 $K$ 和一个标度指数 $\\beta$，在极限 $\\tau \\to 0$ 的情况下。\n\n确定指数 $\\beta$ 的数值。", "solution": "我们从给定的常微分方程开始，其中 $n=3$：\n$$\n\\frac{dy}{dt} = A y^{3}, \\quad A>0, \\quad y(0)=y_{0}>0.\n$$\n分离变量并积分：\n$$\n\\int y^{-3}\\,dy = \\int A\\,dt \\quad \\Longrightarrow \\quad -\\frac{1}{2} y^{-2} = A t + c.\n$$\n代入 $y(0)=y_{0}$ 来求 $c$：\n$$\n-\\frac{1}{2} y_{0}^{-2} = c \\quad \\Longrightarrow \\quad y^{-2}(t) = y_{0}^{-2} - 2 A t.\n$$\n爆破（有限时间奇点）发生在时间 $t_{s}$，此时 $y^{-2}(t_{s})=0$，因此\n$$\nt_{s} = \\frac{y_{0}^{-2}}{2A}.\n$$\n定义剩余时间 $\\tau = t_{s}-t$。在 $t_{s}$ 附近（即，当 $\\tau \\to 0^{+}$ 时），\n$$\ny^{-2}(t) = 2A \\tau \\quad \\Longrightarrow \\quad y(t) \\sim (2A)^{-\\frac{1}{2}} \\tau^{-\\frac{1}{2}}.\n$$\n因此，渐近地，$y(t)$ 的行为类似于 $c \\tau^{-m}$，其中 $c=(2A)^{-\\frac{1}{2}}$ 且 $m=\\frac{1}{2}$。关于 $t$ 的导数可以通过 $d/dt = - d/d\\tau$ 关联到关于 $\\tau$ 的导数。对于 $k \\in \\mathbb{N}$，\n$$\n\\frac{d^{k}}{dt^{k}} y(t) = (-1)^{k} \\frac{d^{k}}{d\\tau^{k}} \\big(c \\tau^{-m}\\big) \\sim \\text{const} \\cdot \\tau^{-m-k},\n$$\n其中常数取决于 $c$、$m$ 和 $k$，但 $\\tau$ 的幂是 $-m-k$。因此，对于一个 $p=4$ 阶的方法，我们需要 $(p+1)$ 阶导数，即 $k=5$，我们得到\n$$\n\\big|y^{(5)}(t)\\big| \\sim \\text{const} \\cdot \\tau^{-\\left(m+5\\right)} = \\text{const} \\cdot \\tau^{-\\frac{11}{2}}.\n$$\n自适应步长控制使用局部截断误差模型\n$$\n\\text{Err} \\approx C \\big|y^{(p+1)}(t)\\big| h^{p+1},\n$$\n并保持 $\\text{Err} \\approx \\epsilon$ 且 $p=4$，所以\n$$\n\\epsilon \\approx C \\big|y^{(5)}(t)\\big| h^{5} \\quad \\Longrightarrow \\quad h^{5} \\approx \\frac{\\epsilon}{C \\big|y^{(5)}(t)\\big|}.\n$$\n使用渐近标度关系 $\\big|y^{(5)}(t)\\big| \\sim \\text{const} \\cdot \\tau^{-\\frac{11}{2}}$，我们发现\n$$\nh \\sim \\left(\\frac{\\epsilon}{C}\\right)^{\\frac{1}{5}} \\big(\\text{const}\\big)^{-\\frac{1}{5}} \\tau^{\\frac{11}{10}}.\n$$\n因此，在关系式 $h \\approx K \\tau^{\\beta}$ 中，当 $\\tau \\to 0^{+}$ 时，指数为\n$$\n\\beta = \\frac{11}{10}.\n$$", "answer": "$$\\boxed{\\frac{11}{10}}$$", "id": "1659002"}]}