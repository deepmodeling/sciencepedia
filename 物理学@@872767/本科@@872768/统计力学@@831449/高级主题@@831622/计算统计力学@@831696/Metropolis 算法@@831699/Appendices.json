{"hands_on_practices": [{"introduction": "理解一个算法的最好方法之一就是亲手执行一遍。此练习将引导您逐步完成Metropolis算法的核心步骤，模拟一个在一维势场中运动的单个粒子。通过手动计算能量变化、接受概率，并根据随机数做出接受或拒绝的决定，您将对蒙特卡洛模拟的基本机制建立起一个坚实而具体的认识 [@problem_id:2005962]。", "problem": "一个经典粒子在一维空间中运动，其所受势由 $V(x) = x^4 - 2x^2$ 给出。该粒子与温度为 $T$ 的热浴处于热平衡状态。我们希望通过使用 Metropolis 算法进行一次小规模的蒙特卡洛模拟来估计其平均势能 $\\langle V \\rangle$。\n\n模拟按离散步骤进行。从初始位置 $x_0$ 开始，在第 $i$ 步，通过一个随机步长 $\\delta_i$ 提出一个新位置 $x_{new}$：$x_{new} = x_{old} + \\delta_i$。势能的变化量为 $\\Delta V = V(x_{new}) - V(x_{old})$。提议的移动被接受的概率 $P_{acc}$ 由下式给出：\n$$P_{acc} = \\min\\left(1, \\exp\\left(-\\frac{\\Delta V}{k_B T}\\right)\\right)$$\n为了决定是否接受该移动，我们将一个从区间 $[0, 1)$ 中均匀抽取的随机数 $r_i$ 与 $P_{acc}$ 进行比较。如果 $r_i  P_{acc}$，则接受该移动，粒子的新位置为 $x_i = x_{new}$。如果 $r_i \\ge P_{acc}$，则拒绝该移动，粒子保持在原位置，因此 $x_i = x_{old}$。请注意，无论接受还是拒绝，该构型（新的或重复的旧构型）都会被加入轨迹中，用于计算平均值。\n\n本次模拟使用以下参数：\n- 热能为 $k_B T = 1.0$（任意能量单位）。势 $V(x)$ 也用这些相同单位表示。\n- 粒子的初始位置为 $x_0 = 1.0$。\n- 模拟将进行 4 步（从 $i=1$ 到 $i=4$）。\n- 随机步长位移序列为：$\\delta_1 = 0.40$, $\\delta_2 = -0.30$, $\\delta_3 = 0.10$, $\\delta_4 = -0.50$。\n- 用于接受检验的随机数序列为：$r_1 = 0.50$, $r_2 = 0.20$, $r_3 = 0.90$, $r_4 = 0.10$。\n\n计算包含 5 个状态（$i=0$ 时的初始状态以及 4 步之后每个时刻的状态）的完整轨迹上的平均势能。将你的答案表示为一个实数，并四舍五入到三位有效数字。", "solution": "我们使用 Metropolis 算法，其中势为 $V(x)=x^{4}-2x^{2}$，热能为 $k_{B}T=1$，初始位置为 $x_{0}=1.0$，以及给定的序列 $\\delta_{i}$ 和 $r_{i}$。在每一步中，提出 $x_{\\text{new}}=x_{\\text{old}}+\\delta_{i}$，计算 $\\Delta V=V(x_{\\text{new}})-V(x_{\\text{old}})$，并以概率 $P_{\\text{acc}}=\\min\\left(1,\\exp\\left(-\\frac{\\Delta V}{k_{B}T}\\right)\\right)=\\min\\left(1,\\exp(-\\Delta V)\\right)$ 接受（因为 $k_{B}T=1$）。\n\n初始状态 $i=0$：$x_{0}=1.0$，所以\n$$\nV(x_{0})=1^{4}-2\\cdot 1^{2}=1-2=-1.\n$$\n\n第 $i=1$ 步：$\\delta_{1}=0.40$。提出 $x_{\\text{new}}=1.0+0.40=1.40$。\n$$\nV(1.40)=1.40^{4}-2\\cdot 1.40^{2}=3.8416-3.92=-0.0784.\n$$\n$$\n\\Delta V=-0.0784-(-1)=0.9216,\\quad P_{\\text{acc}}=\\exp(-0.9216)\\approx 0.398.\n$$\n因为 $r_{1}=0.50 > 0.398$，拒绝。因此 $x_{1}=1.0$ 且 $V(x_{1})=-1$。\n\n第 $i=2$ 步：$\\delta_{2}=-0.30$。提出 $x_{\\text{new}}=1.0-0.30=0.70$。\n$$\nV(0.70)=0.70^{4}-2\\cdot 0.70^{2}=0.2401-0.98=-0.7399.\n$$\n$$\n\\Delta V=-0.7399-(-1)=0.2601,\\quad P_{\\text{acc}}=\\exp(-0.2601)\\approx 0.771.\n$$\n因为 $r_{2}=0.20  0.771$，接受。因此 $x_{2}=0.70$ 且 $V(x_{2})=-0.7399$。\n\n第 $i=3$ 步：$\\delta_{3}=0.10$。提出 $x_{\\text{new}}=0.70+0.10=0.80$。\n$$\nV(0.80)=0.80^{4}-2\\cdot 0.80^{2}=0.4096-1.28=-0.8704.\n$$\n$$\n\\Delta V=-0.8704-(-0.7399)=-0.1305.\n$$\n因为 $\\Delta V  0$，$P_{\\text{acc}}=1$，所以接受。因此 $x_{3}=0.80$ 且 $V(x_{3})=-0.8704$。\n\n第 $i=4$ 步：$\\delta_{4}=-0.50$。提出 $x_{\\text{new}}=0.80-0.50=0.30$。\n$$\nV(0.30)=0.30^{4}-2\\cdot 0.30^{2}=0.0081-0.18=-0.1719.\n$$\n$$\n\\Delta V=-0.1719-(-0.8704)=0.6985,\\quad P_{\\text{acc}}=\\exp(-0.6985)\\approx 0.498.\n$$\n因为 $r_{4}=0.10  0.498$，接受。因此 $x_{4}=0.30$ 且 $V(x_{4})=-0.1719$。\n\n轨迹上的势能为\n$$\nV(x_{0})=-1,\\quad V(x_{1})=-1,\\quad V(x_{2})=-0.7399,\\quad V(x_{3})=-0.8704,\\quad V(x_{4})=-0.1719.\n$$\n总和：\n$$\nS=-1-1-0.7399-0.8704-0.1719=-3.7822.\n$$\n5个状态的平均值为：\n$$\n\\langle V\\rangle=\\frac{S}{5}=\\frac{-3.7822}{5}=-0.75644\\approx -0.756\\ \\text{（保留三位有效数字）}.\n$$", "answer": "$$\\boxed{-0.756}$$", "id": "2005962"}, {"introduction": "现在，让我们从单个粒子系统转向包含多个相互作用组分的系统，这是统计力学中更普遍的情形。我们将Metropolis算法应用于研究磁性的基石模型——二维伊辛模型（Ising model）。这个实践练习 [@problem_id:2005989] 将演示局部改变（翻转一个自旋）如何通过最近邻相互作用影响总能量，以及系统如何逐步向热平衡态演化。", "problem": "考虑一个由四个经典自旋组成的2x2方形晶格所代表的磁性材料简化模型。自旋位于位置$(i,j)$处，其中$i,j \\in \\{1, 2\\}$，并记为$s_{ij}$。每个自旋只能指向两个方向之一，由数值$s_{ij} = +1$或$s_{ij} = -1$表示。系统的总能量由铁磁伊辛哈密顿量给出：\n$$H = -J \\sum_{\\langle (ij), (kl) \\rangle} s_{ij} s_{kl}$$\n其中，求和遍历晶格上所有唯一的最近邻自旋对，$J$是一个正常数耦合常数。系统最初处于铁磁基态，其中所有四个自旋都对齐：$s_{11} = s_{12} = s_{21} = s_{22} = +1$。\n\n系统通过蒙特卡洛模拟，在恒定温度$T$下与热浴接触进行演化。模拟以离散步长进行。在每一步中，选择一个自旋并尝试将其翻转（即改变其符号）。计算由此提议的翻转引起的能量变化$\\Delta E$。\n- 如果$\\Delta E \\le 0$，则该翻转总是被接受。\n- 如果$\\Delta E  0$，则该翻转以概率$P = \\exp(-\\Delta E / (k_B T))$被接受，其中$k_B$是玻尔兹曼常数。\n\n为了使此问题的过程具有确定性，概率性决策按如下方式处理：对于需要此类决策的第$k$步移动，当且仅当计算出的概率$P$大于给定的比较值$R_k$时，该移动才被接受。\n\n系统处于某一温度下，其热能由$k_B T = \\frac{4J}{\\ln 2}$给出。模拟的两个步骤按以下顺序执行：\n1.  尝试翻转自旋$s_{11}$。如果需要，此步的比较值为$R_1 = 0.4$。\n2.  从第一步产生的构型开始，尝试翻转自旋$s_{22}$。如果需要，此步的比较值为$R_2 = 0.4$。\n\n计算这两步之后系统的最终能量$H_{final}/J$。你的答案应该是一个整数。", "solution": "我们考虑一个具有开放边界条件的2x2晶格，因此对唯一最近邻对的求和恰好包含四个键：$(11)-(12)$、$(11)-(21)$、$(12)-(22)$和$(21)-(22)$。伊辛哈密顿量为$H=-J\\sum_{\\langle (ij),(kl)\\rangle}s_{ij}s_{kl}$，其中$J0$。在完全对齐的初始状态下，每一对都有$s_{ij}s_{kl}=+1$，因此初始能量为\n$$\nH_{0}=-J\\,(1+1+1+1)=-4J.\n$$\n\n在格点$p$处的单自旋翻转只改变与该格点接触的键。能量变化的标准结果是\n$$\n\\Delta E=2J\\,s_{p}\\sum_{q\\in \\text{nn}(p)}s_{q},\n$$\n其中求和遍历$p$的最近邻。对于$\\Delta E0$的Metropolis接受概率为$P=\\exp\\!\\big(-\\Delta E/(k_{B}T)\\big)$，此处的确定性规则是：当且仅当$PR_{k}$时接受。\n\n第1步：提议翻转$s_{11}$。它的邻居是$s_{12}$和$s_{21}$，初始值都为$+1$，且$s_{11}=+1$。因此\n$$\n\\Delta E_{1}=2J\\,(+1)\\big[(+1)+(+1)\\big]=4J0.\n$$\n在$k_{B}T=\\frac{4J}{\\ln 2}$的条件下，接受概率为\n$$\nP_{1}=\\exp\\!\\left(-\\frac{\\Delta E_{1}}{k_{B}T}\\right)=\\exp\\!\\left(-\\frac{4J}{4J/\\ln 2}\\right)=\\exp(-\\ln 2)=2^{-1}.\n$$\n由于$2^{-1}=0.5R_{1}=0.4$，该翻转被接受。新的能量是\n$$\nH_{1}=H_{0}+\\Delta E_{1}=-4J+4J=0.\n$$\n\n第2步：从此构型开始，提议翻转$s_{22}$。它的邻居是$s_{12}=+1$和$s_{21}=+1$，且$s_{22}=+1$，所以\n$$\n\\Delta E_{2}=2J\\,(+1)\\big[(+1)+(+1)\\big]=4J0.\n$$\n接受概率与之前相同，\n$$\nP_{2}=\\exp\\!\\left(-\\frac{4J}{4J/\\ln 2}\\right)=2^{-1}.\n$$\n由于$2^{-1}=0.5R_{2}=0.4$，这个翻转也被接受。因此，最终能量是\n$$\nH_{\\text{final}}=H_{1}+\\Delta E_{2}=0+4J=4J,\n$$\n所以\n$$\n\\frac{H_{\\text{final}}}{J}=4.\n$$", "answer": "$$\\boxed{4}$$", "id": "2005989"}, {"introduction": "一个蒙特卡洛模拟的效率在很大程度上取决于我们如何提出新的系统状态。在这个问题中，我们将分析和比较在一个点阵气体模型中两种不同类型的“移动”：移动一个粒子到空格点，以及交换两个粒子的位置。此练习 [@problem_id:2005984] 突出了模拟设计中一个更高级的方面，促使我们思考系统的物理性质（例如，粒子是否不可区分）及其对算法效率和结果的影响。", "problem": "一个计算模型被用来模拟一种薄膜材料的行为，该材料被简化为二维晶格气体。该系统由一个$4 \\times 4$的方形晶格组成，具有周期性边界条件，即晶格的右边界与左边界相连，上边界与下边界相连。在这个晶格上，有$M=4$个相同的、不可区分的粒子。系统的总能量由相邻格点上粒子间的相互作用决定。能量由 $E = -\\epsilon \\sum_{\\langle i,j \\rangle} n_i n_j$ 给出，其中 $\\epsilon$ 是一个表示键能的正数常量，求和遍及所有唯一的最近邻格点对 $\\langle i,j \\rangle$，$n_k$ 是格点 $k$ 的占据数（如果被占据则 $n_k=1$，如果为空则 $n_k=0$）。系统维持在恒定温度 $T$ 下，使得无量纲量 $\\frac{\\epsilon}{k_B T}$ 等于 $2.0$，其中 $k_B$ 是玻尔兹曼常数。\n\n模拟从一个初始构型 $C_0$ 开始，其中四个粒子位于坐标为 (1,1), (1,2), (2,1) 和 (4,4) 的格点上。坐标（行，列）的索引从1开始。从这个初始状态出发，提出了两种不同的微观移动，并使用Metropolis算法评估它们的接受概率。\n\n- **移动A：** 提议将位于格点 (1,2) 的粒子移动到空格点 (3,3)。\n- **移动B：** 提议交换位于格点 (1,1) 的粒子和位于格点 (4,4) 的粒子。\n\n计算移动A的接受概率与移动B的接受概率之比，即 $P_{\\text{acc,A}} / P_{\\text{acc,B}}$。将你的最终答案四舍五入到三位有效数字。", "solution": "题目要求计算从同一初始构型 $C_0$ 开始，对两种不同的提议移动A和B，其Metropolis接受概率之比。从能量为 $E_i$ 的状态移动到能量为 $E_f$ 的状态，其接受概率 $P_{\\text{acc}}$ 由 $P_{\\text{acc}} = \\min(1, \\exp(-\\Delta E/k_B T))$ 给出，其中 $\\Delta E = E_f - E_i$。\n\n首先，我们必须计算初始构型 $C_0$ 的能量。粒子位于格点 (1,1), (1,2), (2,1) 和 (4,4) 上。能量是 $E = -\\epsilon$ 乘以最近邻键的数量。我们必须检查所有被占据格点的已占据邻居，同时考虑到 $4 \\times 4$ 晶格的周期性边界条件。\n- 格点 (1,1) 的邻居是 (1,2), (2,1), (1,4) 和 (4,1)。已占据的邻居是 (1,2) 和 (2,1)。\n- 格点 (1,2) 的邻居是 (1,1), (2,2), (1,3) 和 (4,2)。唯一已占据的邻居是 (1,1)。\n- 格点 (2,1) 的邻居是 (1,1), (2,2), (3,1) 和 (4,1)。唯一已占据的邻居是 (1,1)。\n- 格点 (4,4) 的邻居是 (4,3), (1,4), (4,1) 和 (3,4)。这些邻居都没有被占据。\n唯一的键在 ((1,1), (1,2)) 和 ((1,1), (2,1)) 之间。总共有2个这样的键。\n所以，初始能量为 $E_0 = -2\\epsilon$。\n\n接下来，我们分析移动A。一个粒子从 (1,2) 移动到 (3,3)。新的构型 $C_A$ 中，粒子位于 (1,1), (2,1), (3,3) 和 (4,4)。我们计算这个新状态的能量 $E_A$。\n- (1,1) 的邻居是 (1,2), (2,1), (1,4), (4,1)。唯一已占据的邻居是 (2,1)。\n- (2,1) 的邻居是 (1,1), (2,2), (3,1), (4,1)。唯一已占据的邻居是 (1,1)。\n- 格点 (3,3) 和 (4,4) 没有已占据的邻居。\n唯一的键在 (1,1) 和 (2,1) 之间。总共有1个这样的键。\n所以，构型 $C_A$ 的能量是 $E_A = -1\\epsilon = -\\epsilon$。\n\n移动A的能量变化是 $\\Delta E_A = E_A - E_0 = (-\\epsilon) - (-2\\epsilon) = \\epsilon$。\n移动A的接受概率是 $P_{\\text{acc,A}} = \\min(1, \\exp(-\\Delta E_A / k_B T))$。由于 $\\epsilon0$，所以 $\\Delta E_A  0$，因此概率小于1。\n$P_{\\text{acc,A}} = \\exp(-\\epsilon / k_B T)$。\n\n现在，我们分析移动B。这个移动提议交换位于 (1,1) 的粒子和位于 (4,4) 的粒子。题目说明粒子是相同的且不可区分的。交换两个不可区分的粒子不会产生新的物理构型。被占据的格点集合仍然是 {(1,1), (1,2), (2,1), (4,4)}，这与初始构型 $C_0$ 完全相同。\n因此，最终构型 $C_B$ 与初始构型 $C_0$ 相同。\n最终能量 $E_B$ 等于初始能量 $E_0$。\n移动B的能量变化是 $\\Delta E_B = E_B - E_0 = E_0 - E_0 = 0$。\n移动B的接受概率是 $P_{\\text{acc,B}} = \\min(1, \\exp(-\\Delta E_B / k_B T)) = \\min(1, \\exp(0)) = \\min(1,1) = 1$。\n\n最后，我们计算所要求的比率，$R = P_{\\text{acc,A}} / P_{\\text{acc,B}}$。\n$R = \\frac{\\exp(-\\epsilon / k_B T)}{1} = \\exp(-\\epsilon / k_B T)$。\n我们已知无量纲量 $\\frac{\\epsilon}{k_B T} = 2.0$。\n代入这个值，我们得到 $R = \\exp(-2.0)$。\n\n为了得到数值答案，我们计算其值并四舍五入到三位有效数字。\n$R = \\exp(-2.0) \\approx 0.135335...$\n四舍五入到三位有效数字得到 $0.135$。", "answer": "$$\\boxed{0.135}$$", "id": "2005984"}]}