{"hands_on_practices": [{"introduction": "液体池电子显微镜（LCTEM）中的液体层是一把双刃剑：它为样品创造了原生环境，但也会引起显著的电子散射，从而可能掩盖信号。理解这种散射的程度是设计更好实验的第一步。本练习旨在让你应用非弹性平均自由程（$\\lambda$）和泊松统计等基本概念，来量化穿过液体而未损失能量的电子束比例，这是影响图像对比度和能谱分析的关键因素。[@problem_id:2492582]", "problem": "在一个液体池透射电子显微镜 (LCTEM) 实验中，一束加速电压为 $200\\,\\mathrm{keV}$ 的单能电子束穿过一个厚度均匀为 $t=300\\,\\mathrm{nm}$ 的水层。假设非弹性散射事件沿路径是独立且稀少的，因此单个电子在路径长度上累积的非弹性事件数量可以用泊松过程来建模，其非弹性平均自由程 $\\lambda=120\\,\\mathrm{nm}$ 且与深度无关。仅使用平均自由程的定义、独立事件的泊松分布性质以及独立散射过程的指数衰减概念，推导经历了零次非弹性散射事件的透射电子所占的比例（表示为 $I_{0}/I_{t}$）以及每个透射电子发生非弹性散射事件的期望数（表示为 $\\langle N\\rangle$）的表达式。然后，对给定的 $t$ 和 $\\lambda$ 进行数值计算。将两个结果均四舍五入至 $4$ 位有效数字，并以无量纲的小数形式报告。按顺序 $\\left(I_{0}/I_{t},\\,\\langle N\\rangle\\right)$ 提供这两个数。", "solution": "首先，必须严格检验题目陈述的科学性与逻辑一致性。\n\n**步骤1：提取已知条件**\n题目给出了以下参数和条件：\n- 电子束加速电压：$200\\,\\mathrm{keV}$。\n- 水层均匀厚度：$t = 300\\,\\mathrm{nm}$。\n- 非弹性平均自由程（与深度无关）：$\\lambda = 120\\,\\mathrm{nm}$。\n- 非弹性散射事件的数量被建模为泊松过程。\n- 目标是推导表达式并进行数值计算：\n    1.  $I_{0}/I_{t}$：发生零次非弹性散射的透射电子所占的比例。\n    2.  $\\langle N\\rangle$：每个透射电子发生非弹性散射事件的期望数。\n- 数值结果必须四舍五入到 $4$ 位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据。该场景描述了电子显微学中的一个标准问题，特别是对薄液相样品中电子散射的分析。非弹性平均自由程（$\\lambda$）、散射的泊松统计以及指数衰减（比尔-朗伯定律）等概念是该领域的基本原理。所提供的厚度（$t = 300\\,\\mathrm{nm}$）、平均自由程（$\\lambda = 120\\,\\mathrm{nm}$）和加速电压（$200\\,\\mathrm{keV}$）的值对于液体池TEM实验是符合实际的。该问题提法恰当、内容自洽、表述客观，为获得无歧义、无矛盾的唯一解提供了所有必要信息。加速电压参数虽然在上下文中相关，但对于涉及 $t$ 和 $\\lambda$ 的具体计算并非必需，这不构成一个缺陷。该问题是对基本原理的有效检验。\n\n**步骤3：结论与行动**\n问题有效。我将继续进行推导和求解。\n\n**解的推导**\n该问题要求基于第一性原理进行推导。我们定义 $P_k(x)$ 为一个电子在材料中行进距离 $x$ 后，恰好经历了 $k$ 次非弹性散射事件的概率。因此，发生零次非弹性散射事件的电子比例为 $P_0(t)$，对应于比值 $I_0/I_t$。\n\n非弹性平均自由程 $\\lambda$ 是电子在两次非弹性碰撞之间行进的平均距离。因此，在无限小路径长度 $\\mathrm{d}x$ 内发生一次非弹性散射事件的概率由 $\\mathrm{d}p = \\frac{\\mathrm{d}x}{\\lambda}$ 给出。\n\n首先，我们推导 $I_{0}/I_{t} = P_0(t)$ 的表达式。\n一个电子要在行进距离 $x + \\mathrm{d}x$ 后没有发生散射事件，它必须在行进至距离 $x$ 时没有发生事件，并且在随后的区间 $\\mathrm{d}x$ 中也没有发生事件。在 $\\mathrm{d}x$ 内不发生散射的概率是 $(1 - \\mathrm{d}p) = (1 - \\frac{\\mathrm{d}x}{\\lambda})$。由于这些事件是独立的，我们可以写出：\n$$P_0(x + \\mathrm{d}x) = P_0(x) \\left(1 - \\frac{\\mathrm{d}x}{\\lambda}\\right)$$\n整理这个表达式，我们得到：\n$$\\frac{P_0(x + \\mathrm{d}x) - P_0(x)}{\\mathrm{d}x} = -\\frac{P_0(x)}{\\lambda}$$\n当 $\\mathrm{d}x \\to 0$ 时取极限，我们得到一个一阶常微分方程：\n$$\\frac{\\mathrm{d}P_0(x)}{\\mathrm{d}x} = -\\frac{1}{\\lambda} P_0(x)$$\n此方程在初始条件 $P_0(0) = 1$（即在材料入口处（$x=0$）未发生散射）下求解。其解是一个标准的指数衰减函数：\n$$P_0(x) = \\exp\\left(-\\frac{x}{\\lambda}\\right)$$\n对总厚度 $t$ 计算该式，我们得到零损失电子的比例：\n$$ \\frac{I_0}{I_t} = P_0(t) = \\exp\\left(-\\frac{t}{\\lambda}\\right) $$\n这个结果与泊松分布一致。在长度 $t$ 上的平均事件数是 $\\mu = t/\\lambda$。对于泊松过程，观察到 $k=0$ 个事件的概率是 $P(N=0) = \\frac{\\mu^0 e^{-\\mu}}{0!} = e^{-\\mu} = \\exp(-t/\\lambda)$。\n\n接下来，我们推导非弹性散射事件的期望数 $\\langle N\\rangle$ 的表达式。\n根据定义，这个量是散射事件的泊松分布的均值。单位长度上的事件发生率是常数，等于 $1/\\lambda$。对于总路径长度 $t$，期望事件数是发生率乘以路径长度。\n$$ \\langle N\\rangle = \\left(\\frac{1}{\\lambda}\\right) \\times t = \\frac{t}{\\lambda} $$\n这正是泊松分布的参数 $\\mu$，也就是其期望值。\n\n**数值计算**\n我们已知 $t = 300\\,\\mathrm{nm}$ 和 $\\lambda = 120\\,\\mathrm{nm}$。首先，我们计算关键的无量纲参数 $t/\\lambda$。\n$$ \\frac{t}{\\lambda} = \\frac{300\\,\\mathrm{nm}}{120\\,\\mathrm{nm}} = 2.5 $$\n现在我们可以计算这两个所需的量。\n\n1.  零损失电子的比例，$I_{0}/I_{t}$：\n$$ \\frac{I_0}{I_t} = \\exp\\left(-\\frac{t}{\\lambda}\\right) = \\exp(-2.5) $$\n其数值为 $0.08208499...$。四舍五入到 $4$ 位有效数字得到 $0.08208$。\n\n2.  非弹性散射事件的期望数，$\\langle N\\rangle$：\n$$ \\langle N\\rangle = \\frac{t}{\\lambda} = 2.5 $$\n为了用 $4$ 位有效数字表示，我们写作 $2.500$。\n\n最终答案要求按顺序给出 $I_{0}/I_{t}$ 和 $\\langle N\\rangle$ 这两个数。", "answer": "$$ \\boxed{ \\begin{pmatrix} 0.08208 & 2.500 \\end{pmatrix} } $$", "id": "2492582"}, {"introduction": "真正的*原位operando*显微技术涉及在受控的、动态的条件下观察过程，这通常需要在液体池中流过反应物。这类实验的成败取决于这些反应物如何被输运到感兴趣的区域。本练习引入了佩克莱数（$Pe$），这是一个无量纲数，可帮助你判断质量输运是由受控的流动（平流）主导还是由随机扩散主导，这是设计和解释任何动态LCTEM实验时的关键考量。[@problem_id:2492561]", "problem": "在一项液体池透射电子显微镜 (LC-TEM) 实验中，一种稀溶质在作为两个电子透明膜之间观察区域的纳米流体通道中被输运。该流动可近似为不可压缩的稳态流，并具有沿轴向空间均匀的平均速度。溶质进行菲克扩散，并且在观察的时间尺度上不发生反应。从稀疏物质的质量守恒和扩散通量的本构关系出发，对控制输运方程进行无量纲化，以确定当特征长度取为通道高度时，比较平流与扩散量级的唯一无量纲群。然后，针对以下实验相关参数，计算该无量纲群的值：平均速度 $u = 1.0\\,\\mathrm{mm\\,s^{-1}}$，通道高度 $L = 200\\,\\mathrm{nm}$，以及示踪剂扩散系数 $D = 10^{-9}\\,\\mathrm{m^2\\,s^{-1}}$。报告最终值，结果为纯数（无单位），并四舍五入到三位有效数字。", "solution": "该问题陈述具有科学依据、是适定的、客观的，并包含足够的信息以得到唯一解。该问题被验证为输运现象领域中的一个合理问题，特别是在其应用于材料化学和原位显微学方面。\n\n控制稀疏、非反应性化学物质输运的基本原理是质量守恒。对于浓度为 $c(\\mathbf{x}, t)$ 的物质，质量守恒的普适表述为：\n$$\n\\frac{\\partial c}{\\partial t} + \\nabla \\cdot \\mathbf{J} = R\n$$\n此处，$\\frac{\\partial c}{\\partial t}$ 是某点浓度的变化率，$\\mathbf{J}$ 是该物质的总通量，$R$ 是化学反应的生成或消耗速率。问题指明了稳态条件（$\\frac{\\partial c}{\\partial t} = 0$）和非反应性溶质（$R = 0$）。因此，控制方程简化为：\n$$\n\\nabla \\cdot \\mathbf{J} = 0\n$$\n总通量 $\\mathbf{J}$ 是由流体宏观运动引起的平流通量和由随机热运动引起的扩散通量之和。平流通量由 $\\mathbf{J}_{adv} = \\mathbf{u}c$ 给出，其中 $\\mathbf{u}$ 是流体速度场。扩散通量由菲克第一定律 $\\mathbf{J}_{diff} = -D \\nabla c$ 描述，其中 $D$ 是溶质的扩散系数。将这两者结合，得到总通量的本构关系：\n$$\n\\mathbf{J} = \\mathbf{u}c - D \\nabla c\n$$\n将此通量表达式代入稳态守恒方程，得到：\n$$\n\\nabla \\cdot (\\mathbf{u}c - D \\nabla c) = 0\n$$\n展开散度算子，并假设扩散系数 $D$ 是一个常数，我们得到：\n$$\n\\nabla \\cdot (\\mathbf{u}c) - D \\nabla \\cdot (\\nabla c) = 0\n$$\n$$\n\\nabla \\cdot (\\mathbf{u}c) - D \\nabla^2 c = 0\n$$\n使用矢量恒等式 $\\nabla \\cdot (\\mathbf{u}c) = c(\\nabla \\cdot \\mathbf{u}) + \\mathbf{u} \\cdot \\nabla c$，方程变为：\n$$\nc(\\nabla \\cdot \\mathbf{u}) + \\mathbf{u} \\cdot \\nabla c - D \\nabla^2 c = 0\n$$\n问题指出流动是不可压缩的，这意味着速度场的散度为零：$\\nabla \\cdot \\mathbf{u} = 0$。因此，控制性的平流-扩散方程简化为其最终形式：\n$$\n\\mathbf{u} \\cdot \\nabla c - D \\nabla^2 c = 0\n$$\n为使此方程无量纲化，我们引入无量纲变量。令 $L_{char}$ 为特征长度尺度，$U_{char}$ 为特征速度尺度，$c_0$ 为参考浓度。我们定义无量纲变量（用星号表示）如下：\n$$\n\\mathbf{x}^* = \\frac{\\mathbf{x}}{L_{char}} \\quad , \\quad \\mathbf{u}^* = \\frac{\\mathbf{u}}{U_{char}} \\quad , \\quad c^* = \\frac{c}{c_0}\n$$\n以无量纲坐标表示的梯度和拉普拉斯算子为：\n$$\n\\nabla = \\frac{1}{L_{char}}\\nabla^* \\quad , \\quad \\nabla^2 = \\frac{1}{L_{char}^2}\\nabla^{*2}\n$$\n将这些代入控制方程：\n$$\n(U_{char}\\mathbf{u}^*) \\cdot \\left(\\frac{1}{L_{char}}\\nabla^* (c_0 c^*)\\right) - D \\left(\\frac{1}{L_{char}^2}\\nabla^{*2} (c_0 c^*)\\right) = 0\n$$\n提取出恒定的特征尺度：\n$$\n\\frac{U_{char}c_0}{L_{char}} (\\mathbf{u}^* \\cdot \\nabla^* c^*) - \\frac{Dc_0}{L_{char}^2} (\\nabla^{*2} c^*) = 0\n$$\n为了使方程无量纲化，我们将所有项除以其中一组系数，例如，除以 $\\frac{Dc_0}{L_{char}^2}$：\n$$\n\\left(\\frac{U_{char}c_0}{L_{char}} \\cdot \\frac{L_{char}^2}{Dc_0}\\right) (\\mathbf{u}^* \\cdot \\nabla^* c^*) - \\nabla^{*2} c^* = 0\n$$\n简化平流项的前置因子，得到：\n$$\n\\left(\\frac{U_{char}L_{char}}{D}\\right) (\\mathbf{u}^* \\cdot \\nabla^* c^*) - \\nabla^{*2} c^* = 0\n$$\n出现的无量纲群是佩克莱特数（Péclet number），$Pe$。它表示平流输运速率与扩散输运速率之比。\n$$\nPe = \\frac{U_{char}L_{char}}{D}\n$$\n问题指定特征长度为通道高度 $L$，特征速度为平均速度 $u$。因此，待计算的无量纲群是：\n$$\nPe = \\frac{uL}{D}\n$$\n给定以下参数：\n- 平均速度，$u = 1.0\\,\\mathrm{mm\\,s^{-1}}$\n- 通道高度，$L = 200\\,\\mathrm{nm}$\n- 示踪剂扩散系数，$D = 10^{-9}\\,\\mathrm{m^2\\,s^{-1}}$\n\n计算前，所有参数必须转换为统一的单位制，即国际单位制（SI）。\n$$\nu = 1.0 \\times 10^{-3}\\,\\mathrm{m\\,s^{-1}}\n$$\n$$\nL = 200 \\times 10^{-9}\\,\\mathrm{m} = 2.0 \\times 10^{-7}\\,\\mathrm{m}\n$$\n$$\nD = 10^{-9}\\,\\mathrm{m^2\\,s^{-1}}\n$$\n现在，我们将这些值代入佩克莱特数的表达式中：\n$$\nPe = \\frac{(1.0 \\times 10^{-3}\\,\\mathrm{m\\,s^{-1}})(2.0 \\times 10^{-7}\\,\\mathrm{m})}{10^{-9}\\,\\mathrm{m^2\\,s^{-1}}} = \\frac{2.0 \\times 10^{-10}}{1.0 \\times 10^{-9}} = 0.2\n$$\n所得的佩克莱特数是无量纲量，与预期相符。问题要求结果报告为三位有效数字。\n$$\nPe = 0.200\n$$\n该值表明，在此特定实验装置中，扩散传质比平流传质占主导地位。", "answer": "$$\n\\boxed{0.200}\n$$", "id": "2492561"}, {"introduction": "获取高质量的图像不仅需要管理电子束和样品，还需要优化散射电子的探测。在液体池STEM中，来自纳米颗粒的微弱信号常常被淹没在来自液体的强烈、弥散的背景中。这个计算练习让你扮演实验者的角色，任务是优化环形探测器的几何形状以最大化信噪比（SNR），从而在散射理论和实际数据采集策略之间架起一座桥梁。[@problem_id:2492589]", "problem": "您正在研究在原位 (in situ) 或操作 (operando) 条件下，微流控池内液体中分散的纳米颗粒的扫描透射电子显微镜 (STEM) 成像。在带有环形探测器的STEM中，探测到的强度是通过在探测器的角接收范围内对依赖于极角的散射强度进行积分得到的。对于轴对称的电子束和探测器，适用立体角元的小角度近似。因此，在内半角和外半角之间收集的强度可以通过对立体角元 $d\\Omega \\approx 2\\pi \\theta \\, d\\theta$ 进行积分来计算，其中 $\\theta$ 是散射半角。假设颗粒（信号）和液体（背景）对单位立体角的微分强度的贡献由以下具有物理动机且被广泛使用的形式给出：\n- 颗粒（信号）的角分布被建模为屏蔽类卢瑟福 (Rutherford) 散射尾：$S(\\theta) = \\dfrac{A_{\\mathrm{P}}}{\\left(\\theta^{2} + \\theta_{s}^{2}\\right)^{2}}$，其中 $A_{\\mathrm{P}}$ 是一个正振幅，$\\theta_{s}$ 是一个正屏蔽角。\n- 液体（背景）的角分布被建模为一个宽的类洛伦兹 (Lorentzian) 尾：$B(\\theta) = \\dfrac{A_{\\mathrm{L}} \\, \\theta_{\\mathrm{L}}^{2}}{\\theta^{2} + \\theta_{\\mathrm{L}}^{2}}$，其中 $A_{\\mathrm{L}}$ 和 $\\theta_{\\mathrm{L}}$ 是表征液体散射强度和宽度的正参数。\n\n假设采用泊松 (Poisson) 计数统计，因此由内半角 $\\alpha_{i}$ 和外半角 $\\alpha_{o}$ 定义的环带的信噪比 (SNR) 由 $ \\mathrm{SNR} = \\dfrac{I_{S}}{\\sqrt{I_{S} + I_{B}}}$ 给出，其中 $I_{S}$ 和 $I_{B}$ 是该环带收集到的信号和背景计数：\n- $I_{S} = \\displaystyle \\int_{\\alpha_{i}}^{\\alpha_{o}} S(\\theta)\\, 2\\pi \\theta \\, d\\theta$，\n- $I_{B} = \\displaystyle \\int_{\\alpha_{i}}^{\\alpha_{o}} B(\\theta)\\, 2\\pi \\theta \\, d\\theta$。\n\n所有角度都将以毫弧度 (mrad) 为单位进行处理和报告。所有 $A_{\\mathrm{P}}$ 和 $A_{\\mathrm{L}}$ 都是正实数，SNR 是无量纲的。\n\n您的任务是编写一个完整的程序，该程序能够：\n1. 根据上述定义、使用小角度立体角元和给定的 $S(\\theta)$ 和 $B(\\theta)$ 函数，推导并实现用于计算 $I_{S}$ 和 $I_{B}$ 的数值稳定表达式，且不引入非物理的发散。\n2. 对于给定的探测器几何结构和材料参数，计算 $\\mathrm{SNR}(\\alpha_{i}, \\alpha_{o})$。\n3. 通过在满足最小环带宽度约束的可行设计区域内优化探测器的内半角和外半角，来提出一个提升SNR的改进方案。该优化问题为：在满足 $\\alpha_{\\min} \\le \\alpha_{i} < \\alpha_{o} \\le \\alpha_{\\max}$ 和 $\\alpha_{o} - \\alpha_{i} \\ge \\Delta_{\\min}$ 的条件下，最大化 $\\mathrm{SNR}(\\alpha_{i}, \\alpha_{o})$。在可行域上使用步长均匀的离散网格搜索（步长为 $\\Delta_{\\theta}$），以产生一个可复现的最优解。\n\n使用以下测试套件。对于每个案例，计算在指定的当前探测器几何结构下的当前信噪比，然后计算优化后的信噪比和相应的优化角度，最后计算信噪比增益，其定义为优化后的信噪比与当前信噪比的比率。所有角度单位均为毫弧度 (mrad)。将信噪比值报告为十进制浮点数，角度报告为 mrad。\n\n测试案例：\n- 案例 1 (典型): $A_{\\mathrm{P}} = 100.0$, $\\theta_{s} = 0.6$, $A_{\\mathrm{L}} = 0.02$, $\\theta_{\\mathrm{L}} = 8.0$, 当前探测器 $\\left[\\alpha_{i}, \\alpha_{o}\\right] = \\left[20.0, 80.0\\right]$, 可行区域 $\\alpha_{\\min} = 5.0$, $\\alpha_{\\max} = 120.0$, 最小环带宽度 $\\Delta_{\\min} = 5.0$, 网格步长 $\\Delta_{\\theta} = 0.5$。\n- 案例 2 (边界聚焦): $A_{\\mathrm{P}} = 80.0$, $\\theta_{s} = 0.6$, $A_{\\mathrm{L}} = 0.005$, $\\theta_{\\mathrm{L}} = 5.0$, 当前探测器 $\\left[\\alpha_{i}, \\alpha_{o}\\right] = \\left[10.0, 40.0\\right]$, 可行区域 $\\alpha_{\\min} = 5.0$, $\\alpha_{\\max} = 60.0$, 最小环带宽度 $\\Delta_{\\min} = 5.0$, 网格步长 $\\Delta_{\\theta} = 0.5$。\n- 案例 3 (宽液体背景): $A_{\\mathrm{P}} = 60.0$, $\\theta_{s} = 0.8$, $A_{\\mathrm{L}} = 0.05$, $\\theta_{\\mathrm{L}} = 20.0$, 当前探测器 $\\left[\\alpha_{i}, \\alpha_{o}\\right] = \\left[40.0, 100.0\\right]$, 可行区域 $\\alpha_{\\min} = 5.0$, $\\alpha_{\\max} = 120.0$, 最小环带宽度 $\\Delta_{\\min} = 5.0$, 网格步长 $\\Delta_{\\theta} = 0.5$。\n\n角度单位：毫弧度。数值输出必须使用以下单位和舍入规则进行报告：\n- 将信噪比值和增益报告为保留 $6$ 位小数的十进制浮点数。\n- 将角度 $\\alpha_{i}$ 和 $\\alpha_{o}$ 以毫弧度为单位报告，并保留 $1$ 位小数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素是对应一个测试用例的5元素列表，按给定顺序排列，格式为 $[\\mathrm{SNR}_{\\mathrm{current}}, \\mathrm{SNR}_{\\mathrm{opt}}, \\alpha_{i,\\mathrm{opt}}, \\alpha_{o,\\mathrm{opt}}, \\mathrm{gain}]$。例如，输出必须类似于：$[[\\dots],[\\dots],[\\dots]]$。", "solution": "该问题陈述经过了严格的验证。\n\n### 步骤 1：提取已知条件\n提供了以下数据和定义：\n- 颗粒（信号）微分强度: $S(\\theta) = \\dfrac{A_{\\mathrm{P}}}{\\left(\\theta^{2} + \\theta_{s}^{2}\\right)^{2}}$，其中 $A_{\\mathrm{P}} > 0$ 且 $\\theta_{s} > 0$。\n- 液体（背景）微分强度: $B(\\theta) = \\dfrac{A_{\\mathrm{L}} \\, \\theta_{\\mathrm{L}}^{2}}{\\theta^{2} + \\theta_{\\mathrm{L}}^{2}}$，其中 $A_{\\mathrm{L}} > 0$ 且 $\\theta_{\\mathrm{L}} > 0$。\n- 小角度立体角元: $d\\Omega \\approx 2\\pi \\theta \\, d\\theta$。\n- 环带 $[\\alpha_{i}, \\alpha_{o}]$ 上的积分信号计数: $I_{S} = \\displaystyle \\int_{\\alpha_{i}}^{\\alpha_{o}} S(\\theta)\\, 2\\pi \\theta \\, d\\theta$。\n- 环带 $[\\alpha_{i}, \\alpha_{o}]$ 上的积分背景计数: $I_{B} = \\displaystyle \\int_{\\alpha_{i}}^{\\alpha_{o}} B(\\theta)\\, 2\\pi \\theta \\, d\\theta$。\n- 泊松统计下的信噪比 (SNR): $\\mathrm{SNR} = \\dfrac{I_{S}}{\\sqrt{I_{S} + I_{B}}}$。\n- 优化目标：最大化 $\\mathrm{SNR}(\\alpha_{i}, \\alpha_{o})$。\n- 优化约束：$\\alpha_{\\min} \\le \\alpha_{i} < \\alpha_{o} \\le \\alpha_{\\max}$ 且 $\\alpha_{o} - \\alpha_{i} \\ge \\Delta_{\\min}$。\n- 优化方法：使用均匀步长 $\\Delta_{\\theta}$ 的离散网格搜索。\n- 提供了三个测试用例，其中包含所有参数的具体数值。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据指定标准对问题进行评估：\n- **科学性（关键）**：该问题基于成熟的STEM电子散射物理模型。用于颗粒散射的屏蔽卢瑟福模型和用于液体弥散背景的类洛伦兹模型是标准的、具有物理动机的近似。SNR公式是假设检测受散粒噪声限制（由泊松统计控制）的直接结果，这是计数实验中的一个基本概念。\n- **适定性**：该问题在数学上是适定的。对于 $\\theta > 0$，$I_S$ 和 $I_B$ 的被积函数是非负且有限的，并且在任何有限区间 $[\\alpha_i, \\alpha_o]$ 上的积分都是收敛的。优化是在一个离散、紧凑的可行角度对集合上执行的，这保证了最大值的存在，并且指定的网格搜索可以复现地找到该最大值。\n- **客观性（关键）**：该问题使用精确的数学语言以客观、定量的方式陈述，没有任何主观或模糊的术语。\n- **完整性和一致性**：问题陈述是自洽的。所有必需的方程、参数、约束和测试数据都已提供。设置中没有矛盾之处。\n- **可行性**：参数和条件在液体池STEM实验的物理合理范围内。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。该问题在科学上是合理的，数学上是适定的，并且为其求解提供了所有必要的信息。将逐步制定解决方案。\n\n### 求解推导\n\n解决方案需要三个主要部分：积分强度的解析计算、SNR的计算，以及通过网格搜索对探测器几何结构进行优化。\n\n**1. 积分强度的解析计算**\n\n为了确保数值稳定性和准确性，我们首先推导积分信号 $I_S$ 和背景 $I_B$ 的闭式解析表达式。\n\n积分信号 $I_S$ 由下式给出：\n$$ I_{S} = \\int_{\\alpha_{i}}^{\\alpha_{o}} S(\\theta)\\, 2\\pi \\theta \\, d\\theta = \\int_{\\alpha_{i}}^{\\alpha_{o}} \\frac{A_{\\mathrm{P}}}{(\\theta^2 + \\theta_s^2)^2} 2\\pi \\theta \\, d\\theta $$\n我们进行换元。令 $u = \\theta^2 + \\theta_s^2$。那么，其微分为 $du = 2\\theta \\, d\\theta$。积分限变为 $u(\\alpha_i) = \\alpha_i^2 + \\theta_s^2$ 和 $u(\\alpha_o) = \\alpha_o^2 + \\theta_s^2$。积分变为：\n$$ I_{S} = \\pi A_{\\mathrm{P}} \\int_{\\alpha_i^2 + \\theta_s^2}^{\\alpha_o^2 + \\theta_s^2} \\frac{du}{u^2} = \\pi A_{\\mathrm{P}} \\left[ -\\frac{1}{u} \\right]_{\\alpha_i^2 + \\theta_s^2}^{\\alpha_o^2 + \\theta_s^2} $$\n$$ I_{S}(\\alpha_i, \\alpha_o) = \\pi A_{\\mathrm{P}} \\left( -\\frac{1}{\\alpha_o^2 + \\theta_s^2} - \\left(-\\frac{1}{\\alpha_i^2 + \\theta_s^2}\\right) \\right) = \\pi A_{\\mathrm{P}} \\left( \\frac{1}{\\alpha_i^2 + \\theta_s^2} - \\frac{1}{\\alpha_o^2 + \\theta_s^2} \\right) $$\n该表达式是数值稳定的，因为 $\\theta_s^2 > 0$ 可以防止任何除以零的情况。\n\n积分背景 $I_B$ 由下式给出：\n$$ I_{B} = \\int_{\\alpha_{i}}^{\\alpha_{o}} B(\\theta)\\, 2\\pi \\theta \\, d\\theta = \\int_{\\alpha_{i}}^{\\alpha_{o}} \\frac{A_{\\mathrm{L}} \\theta_{\\mathrm{L}}^2}{\\theta^2 + \\theta_{\\mathrm{L}}^2} 2\\pi \\theta \\, d\\theta $$\n我们进行类似的换元。令 $v = \\theta^2 + \\theta_{\\mathrm{L}}^2$。那么，$dv = 2\\theta \\, d\\theta$。积分限变为 $v(\\alpha_i) = \\alpha_i^2 + \\theta_{\\mathrm{L}}^2$ 和 $v(\\alpha_o) = \\alpha_o^2 + \\theta_{\\mathrm{L}}^2$。积分变为：\n$$ I_{B} = \\pi A_{\\mathrm{L}} \\theta_{\\mathrm{L}}^2 \\int_{\\alpha_i^2 + \\theta_{\\mathrm{L}}^2}^{\\alpha_o^2 + \\theta_{\\mathrm{L}}^2} \\frac{dv}{v} = \\pi A_{\\mathrm{L}} \\theta_{\\mathrm{L}}^2 \\left[ \\ln(v) \\right]_{\\alpha_i^2 + \\theta_{\\mathrm{L}}^2}^{\\alpha_o^2 + \\theta_{\\mathrm{L}}^2} $$\n$$ I_{B}(\\alpha_i, \\alpha_o) = \\pi A_{\\mathrm{L}} \\theta_{\\mathrm{L}}^2 \\left( \\ln(\\alpha_o^2 + \\theta_{\\mathrm{L}}^2) - \\ln(\\alpha_i^2 + \\theta_{\\mathrm{L}}^2) \\right) = \\pi A_{\\mathrm{L}} \\theta_{\\mathrm{L}}^2 \\ln\\left(\\frac{\\alpha_o^2 + \\theta_{\\mathrm{L}}^2}{\\alpha_i^2 + \\theta_{\\mathrm{L}}^2}\\right) $$\n该表达式也是数值稳定的，因为 $\\theta_L^2 > 0$ 且 $\\alpha_o > \\alpha_i \\ge 0$ 确保了对数的参数始终大于 $1$。\n\n**2. 信噪比 (SNR) 计算**\n\n有了 $I_S$ 和 $I_B$ 的解析表达式，对于给定的探测器几何结构 $[\\alpha_i, \\alpha_o]$，可以直接计算 SNR：\n$$ \\mathrm{SNR}(\\alpha_i, \\alpha_o) = \\frac{I_S(\\alpha_i, \\alpha_o)}{\\sqrt{I_S(\\alpha_i, \\alpha_o) + I_B(\\alpha_i, \\alpha_o)}} $$\n对于每个测试用例，使用提供的当前探测器角度计算当前 SNR，即 $\\mathrm{SNR}_{\\mathrm{current}}$。\n\n**3. 通过网格搜索进行优化**\n\n主要任务是找到能够使SNR最大化的最佳探测器角度 $[\\alpha_{i,\\mathrm{opt}}, \\alpha_{o,\\mathrm{opt}}]$。问题指定了离散网格搜索，其实现如下：\n1.  生成一个一维角度值网格，范围从 $\\alpha_{\\min}$到$\\alpha_{\\max}$，均匀步长为 $\\Delta_{\\theta}$。\n2.  使用嵌套循环遍历该网格中所有可能的对 $(\\alpha_{i}, \\alpha_{o})$。\n3.  对每一对角度，检查以下可行性约束：\n    - $\\alpha_i < \\alpha_o$（内角必须小于外角）。\n    - $\\alpha_o - \\alpha_i \\ge \\Delta_{\\min}$（环带必须有最小宽度）。\n4.  如果一对角度是可行的，则使用推导出的公式计算 $\\mathrm{SNR}(\\alpha_i, \\alpha_o)$。\n5.  将此SNR与目前找到的最大SNR进行比较。如果当前SNR更高，则将其存储为新的最大值，并将相应的角度 $(\\alpha_i, \\alpha_o)$ 存储为新的最佳角度。\n这种暴力搜索方法保证能在离散网格上找到最大的SNR。\n\n在找到 $\\mathrm{SNR}_{\\mathrm{opt}}$、$\\alpha_{i, \\mathrm{opt}}$ 和 $\\alpha_{o, \\mathrm{opt}}$ 之后，信噪比增益按以下比率计算：\n$$ \\mathrm{gain} = \\frac{\\mathrm{SNR}_{\\mathrm{opt}}}{\\mathrm{SNR}_{\\mathrm{current}}} $$\n然后，将每个测试用例的结果格式化为指定精度，并以所要求的列表的列表格式呈现。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the STEM SNR optimization problem for the given test cases.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1: typical\n        {'AP': 100.0, 'ts': 0.6, 'AL': 0.02, 'tL': 8.0, \n         'current_detector': [20.0, 80.0], 'alpha_min': 5.0, 'alpha_max': 120.0, \n         'delta_min': 5.0, 'delta_theta': 0.5},\n        # Case 2: boundary-focused\n        {'AP': 80.0, 'ts': 0.6, 'AL': 0.005, 'tL': 5.0, \n         'current_detector': [10.0, 40.0], 'alpha_min': 5.0, 'alpha_max': 60.0, \n         'delta_min': 5.0, 'delta_theta': 0.5},\n        # Case 3: broad liquid background\n        {'AP': 60.0, 'ts': 0.8, 'AL': 0.05, 'tL': 20.0, \n         'current_detector': [40.0, 100.0], 'alpha_min': 5.0, 'alpha_max': 120.0, \n         'delta_min': 5.0, 'delta_theta': 0.5},\n    ]\n\n    all_results = []\n\n    def calculate_Is(ai, ao, AP, ts):\n        \"\"\"Calculates integrated signal intensity Is.\"\"\"\n        if ai >= ao:\n            return 0.0\n        term1 = 1.0 / (ai**2 + ts**2)\n        term2 = 1.0 / (ao**2 + ts**2)\n        return np.pi * AP * (term1 - term2)\n\n    def calculate_Ib(ai, ao, AL, tL):\n        \"\"\"Calculates integrated background intensity Ib.\"\"\"\n        if ai >= ao:\n            return 0.0\n        # To avoid log(1)=0 which can happen if ai=ao.\n        # But this case is already handled by the ai >= ao check.\n        # Condition ao > ai ensures the argument to log is > 1.\n        arg = (ao**2 + tL**2) / (ai**2 + tL**2)\n        return np.pi * AL * tL**2 * np.log(arg)\n    \n    def calculate_snr(ai, ao, AP, ts, AL, tL):\n        \"\"\"Calculates the Signal-to-Noise Ratio (SNR).\"\"\"\n        Is = calculate_Is(ai, ao, AP, ts)\n        Ib = calculate_Ib(ai, ao, AL, tL)\n        total_intensity = Is + Ib\n        # SNR is defined for Is > 0. For Is=0, SNR=0. \n        # Total intensity must be > 0 to avoid division by zero or sqrt of negative.\n        if Is == 0.0 or total_intensity = 0.0:\n            return 0.0\n        return Is / np.sqrt(total_intensity)\n\n    for case in test_cases:\n        AP = case['AP']\n        ts = case['ts']\n        AL = case['AL']\n        tL = case['tL']\n        current_ai, current_ao = case['current_detector']\n        alpha_min = case['alpha_min']\n        alpha_max = case['alpha_max']\n        delta_min = case['delta_min']\n        delta_theta = case['delta_theta']\n\n        # 1. Calculate current SNR\n        snr_current = calculate_snr(current_ai, current_ao, AP, ts, AL, tL)\n\n        # 2. Optimize SNR via grid search\n        # Using arange with a small epsilon to ensure endpoint inclusion.\n        angle_grid = np.arange(alpha_min, alpha_max + delta_theta / 2, delta_theta)\n        \n        max_snr = -1.0\n        opt_ai = -1.0\n        opt_ao = -1.0\n\n        for ai in angle_grid:\n            # Optimization: start search for ao from a valid point\n            # ao must be > ai and also ao >= ai + delta_min\n            start_ao_val = ai + delta_min\n            # Find the index in the grid to start the inner loop\n            start_idx = np.searchsorted(angle_grid, start_ao_val, side='left')\n\n            for j in range(start_idx, len(angle_grid)):\n                ao = angle_grid[j]\n                \n                # The constraints ai  ao and ao - ai >= delta_min are handled\n                # by the optimized loop structure itself.\n                \n                snr = calculate_snr(ai, ao, AP, ts, AL, tL)\n                if snr > max_snr:\n                    max_snr = snr\n                    opt_ai = ai\n                    opt_ao = ao\n        \n        snr_opt = max_snr\n\n        # 3. Calculate SNR gain\n        # handle case where current_snr is zero to avoid division by zero\n        if snr_current > 1e-9:\n            gain = snr_opt / snr_current\n        else:\n            gain = 0.0  # Or np.inf, depends on definition. 0 is safer.\n\n        # 4. Format and store results\n        case_result_str = [\n            f\"{snr_current:.6f}\",\n            f\"{snr_opt:.6f}\",\n            f\"{opt_ai:.1f}\",\n            f\"{opt_ao:.1f}\",\n            f\"{gain:.6f}\"\n        ]\n        all_results.append(f\"[{','.join(case_result_str)}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[[{','.join(all_results)}]]\")\n\nsolve()\n```", "id": "2492589"}]}