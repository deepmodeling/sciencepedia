{"hands_on_practices": [{"introduction": "对于一种未知材料，从其粉末衍射图谱中确定晶体结构的第一步，也是最关键的一步，就是晶胞索引。本练习将引导你完成这一过程，通过一组高质量的（尽管是假设的）衍射峰位数据，推导出晶体的布拉维晶格类型和晶胞参数。这项实践旨在锻炼你从实验数据中提取基本结构信息的核心能力，这是利用粉末衍射进行结构解析的基础。[@problem_id:2515451]", "problem": "一个多晶样品产生了一张高分辨率粉末衍射图谱，从中提取了前二十个衍射峰的位置，表示为晶面间距。峰位已经针对仪器零点漂移和样品位移进行了校正，可以认为其相对不确定度在 $1 \\times 10^{-4}$ 以内是准确的。测得的晶面间距（单位为埃）按 $d$ 值降序排列如下：\n$d_1 = 2.121320$, $d_2 = 1.500000$, $d_3 = 1.224745$, $d_4 = 1.060660$, $d_5 = 0.9486833$, $d_6 = 0.8660254$, $d_7 = 0.8017837$, $d_8 = 0.7500000$, $d_9 = 0.7071068$, $d_{10} = 0.6708204$, $d_{11} = 0.6390097$, $d_{12} = 0.6123724$, $d_{13} = 0.5883484$, $d_{14} = 0.5477226$, $d_{15} = 0.5303301$, $d_{16} = 0.5144958$, $d_{17} = 0.5000000$, $d_{18} = 0.4866643$, $d_{19} = 0.4743417$, $d_{20} = 0.4629100$。\n\n仅从 Bragg 定律 $2 d \\sin \\theta = \\lambda$ 和七大晶系的倒易晶格度规出发，概述现代软件中实现的典型粉末衍射指标化算法的主要逻辑步骤（例如，先进行晶带指标化，然后是穷举晶胞搜索和精修策略），包括：\n- 将晶面间距转换为倒易空间量，并识别简单的有理数关系。\n- 利用系统消光判据和倒易空间中的线性检验来区分不同的 Bravais 晶格。\n- 根据前二十条衍射线提出并验证一个候选晶胞。\n- 为这二十个峰指定与所选 Bravais 晶格和倒易度规一致的米勒指数 $(h k l)$。\n- 针对这二十个 $d$ 间距，对晶格参数进行简单的最小二乘精修。\n\n然后，对给定数据执行这些步骤，确定最可能的 Bravais 晶格和晶胞参数，为前二十个峰指定 $(h k l)$，并计算晶胞体积。报告最佳候选晶胞的晶格参数 $a$（单位为埃）和晶胞体积 $V$（单位为立方埃）作为最终答案。将报告的两个量都四舍五入到四位有效数字。最终的数值答案必须在答案框内给出，不带单位，但为清晰起见，此处指明了您应使用的单位：$a$ 的单位是埃，$V$ 的单位是 $\\text{\\AA}^3$。", "solution": "在尝试任何解答之前，首先对问题进行验证。\n\n首先，从问题陈述中逐字提取已知条件：\n- 来自多晶样品的二十个晶面间距集合：\n$d_1 = 2.121320$ Å, $d_2 = 1.500000$ Å, $d_3 = 1.224745$ Å, $d_4 = 1.060660$ Å, $d_5 = 0.9486833$ Å, $d_6 = 0.8660254$ Å, $d_7 = 0.8017837$ Å, $d_8 = 0.7500000$ Å, $d_9 = 0.7071068$ Å, $d_{10} = 0.6708204$ Å, $d_{11} = 0.6390097$ Å, $d_{12} = 0.6123724$ Å, $d_{13} = 0.5883484$ Å, $d_{14} = 0.5477226$ Å, $d_{15} = 0.5303301$ Å, $d_{16} = 0.5144958$ Å, $d_{17} = 0.5000000$ Å, $d_{18} = 0.4866643$ Å, $d_{19} = 0.4743417$ Å, $d_{20} = 0.4629100$ Å。\n- 晶面间距的相对不确定度：$1 \\times 10^{-4}$。\n- 待使用的基本定律：Bragg 定律, $2 d \\sin \\theta = \\lambda$, 和七大晶系的倒易晶格度规。\n- 任务：\n    1. 概述粉末衍射指标化算法的逻辑步骤。\n    2. 将这些步骤应用于给定数据。\n    3. 确定 Bravais 晶格和晶胞参数。\n    4. 为前二十个峰指定米勒指数 $(h k l)$。\n    5. 计算晶胞体积 $V$。\n- 报告要求：报告晶格参数 $a$ 和体积 $V$，四舍五入到四位有效数字。\n\n该问题是X射线晶体学中的一个典型练习，科学上合理、问题明確且客观。它基于基本原理，并提供了一套完整的理想化数据，适合教学环境。因此，该问题被认为是**有效的**，并将构建一个解答。\n\n对于未知结构材料（特别是在此类问题中通常假设具有高晶体对称性）的粉末衍射图谱进行指标化的通用程序遵循一系列逻辑步骤。虽然现代算法高度复杂，并常采用穷举搜索策略，但其核心逻辑基于下述原理。\n\n首先，必须将在正空间中测得的晶面间距 $d_{hkl}$ 转换为倒易空间中的量。这是因为衍射之间的关系在倒易空间中更为简单。Bragg 定律 $2 d \\sin \\theta = \\lambda$ 可以平方后重新整理。利用倒易晶格矢量大小的定义 $Q_{hkl} = 1/d_{hkl} = (2 \\sin \\theta)/\\lambda$，我们得到一个量 $Q_{hkl}^2 = 1/d_{hkl}^2$。$Q_{hkl}^2$ 的表达式是关于米勒指数 $(h, k, l)$ 和倒易晶格参数的二次型。对于一般的三斜晶系，该表达式为 $Q_{hkl}^2 = h^2 a^{*2} + k^2 b^{*2} + l^2 c^{*2} + 2hk a^* b^* \\cos \\gamma^* + 2hl a^* c^* \\cos \\beta^* + 2kl b^* c^* \\cos \\alpha^*$。对于更高对称性的晶系，此方程会显著简化。对于立方晶系，它变为 $Q_{hkl}^2 = (h^2+k^2+l^2)/a^2$，其中 $a$ 是晶格参数。\n\n其次，尝试区分不同的 Bravais 晶格。这通过搜索观测到的 $Q_i^2$ 值之间的简单有理数关系来实现。对于立方晶格，$Q_i^2$ 值的比率必须是整数的比率，其中这些整数是三个平方数之和，$N = h^2+k^2+l^2$。此外，观测到的衍射集合中的系统消光对允许的 $(hkl)$ 指数施加了约束，这些约束是 Bravais 晶格类型的特征。对于简单立方 (P) 晶格，所有可以写成三个平方数之和的整数 $N$ 值都是允许的（例如，$1, 2, 3, 4, 5, 6, 8, 9, ...$；而 $7, 15, 23, 28, ...$ 是禁戒的）。对于体心立方 (I) 晶格，衍射条件是 $h+k+l = 2n$ (偶数)，这意味着 $h^2+k^2+l^2$ 必须是偶数（例如，$N = 2, 4, 6, 8, 10, ...$）。对于面心立方 (F) 晶格，指数必须全为偶数或全为奇数，这导致允许的 $N$ 序列为 $3, 4, 8, 11, 12, 16, ...$。通过识别关联观测到的 $Q_i^2$ 值的乘数序列，可以推断出晶系和 Bravais 晶格。\n\n第三，提出一个候选晶胞。对于立方晶系，一旦确定了 Bravais 晶格，任何单个衍射都可以用来提出一个试探性的晶格参数。例如，如果第一个峰的指标为 $(h_1k_1l_1)$，则 $a^2 = (h_1^2+k_1^2+l_1^2)/Q_1^2$。\n\n第四，必须通过为所有观测到的峰一致地指定米勒指数来验证所提出的晶胞。已指标化峰的计算 $Q_{calc}^2$ 值必须在实验不确定度范围内与观测到的 $Q_{obs}^2$ 值匹配。为了成功指标化，所有观测到的衍射线都必须得到解释，在低角度区域没有任何未指标化的线，并且指数必须满足所提出的 Bravais 晶格的系统消光规律。\n\n第五，一旦找到有效的指标化解，就使用最小二乘法对晶格参数进行精修。该过程最小化了观测峰位和计算峰位之间加权平方差的总和。对于模型为 $Q_i^2 = N_i/a^2$ 的立方晶系，以及要拟合的参数 $P = 1/a^2$，要最小化的函数是 $\\chi^2 = \\sum_i w_i (Q_{i,obs}^2 - N_i P)^2$，其中 $w_i$ 是统计权重，通常与每次观测不确定度的平方倒数有关。\n\n将此程序应用于所提供的数据：\n\n步骤1：将给定的二十个 $d$ 间距转换为 $Q_i^2 = 1/d_i^2$ 值（单位为 Å$^{-2}$）。\n$Q_1^2 = 1/(2.121320)^2 = 0.22222223$\n$Q_2^2 = 1/(1.500000)^2 = 0.44444444$\n$Q_3^2 = 1/(1.224745)^2 = 0.66666667$\n$Q_4^2 = 1/(1.060660)^2 = 0.88888889$\n以此类推。\n\n步骤2：我们检查这些 $Q^2$ 值的比率。令 $S = Q_1^2 = 0.22222223$。\n$Q_2^2/S = 2.0000000$\n$Q_3^2/S = 3.0000000$\n$Q_4^2/S = 4.0000000$\n这表明 $Q^2$ 值可能某个基本值的整数倍。我们通过将每个 $Q_i^2$ 除以小的整数来寻找这个基本值，直到出现一个一致的常数。我们观察到 $Q_1^2/2 = 0.11111111$，$Q_2^2/4 = 0.11111111$，$Q_3^2/6 = 0.11111111$ 等等。一个公因子 $C_0 = 1/9 \\approx 0.11111111$ Å$^{-2}$ 是显而易见的。因此，观测到的 $Q_i^2$ 值为 $Q_i^2 = N_i \\cdot C_0$，其中整数 $N_i$ 的序列是：\n$N_1 = 2$, $N_2 = 4$, $N_3 = 6$, $N_4 = 8$, $N_5 = 10$, $N_6 = 12$, $N_7 = 14$, $N_8 = 16$, $N_9 = 18$, $N_{10} = 20$, $N_{11} = 22$, $N_{12} = 24$, $N_{13} = 26$。\n对所有20个峰继续计算，我们发现 $N$ 值的序列为：$2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 30, 32, 34, 36, 38, 40, 42$。\n该序列包含从 $2$ 到 $26$ 的所有偶数，跳过了 $28$，然后从 $30$ 继续。整数 $28$ 不能写成三个整数的平方和。这个序列是体心立方 (BCC 或 I) 晶格的独特标志。\n\n步骤3：该晶系为立方晶系，Bravais 晶格为体心。$Q^2$ 的关系式是一个特例：$Q_{hkl}^2 = (h^2+k^2+l^2)/a^2$。我们发现的常数因子是 $C_0 = 1/a^2$。根据我们的分析，$C_0 \\approx 1/9$ Å$^{-2}$，这给出了一个试探性的晶格参数 $a = \\sqrt{9} = 3$ Å。\n\n步骤4：我们为每个观测到的峰指定符合 BCC 选择定则（$h+k+l = \\text{偶数}$）的米勒指数 $(hkl)$。\n- $d_1, N=2: (110)$\n- $d_2, N=4: (200)$\n- $d_3, N=6: (211)$\n- $d_4, N=8: (220)$\n- $d_5, N=10: (310)$\n- $d_6, N=12: (222)$\n- $d_7, N=14: (321)$\n- $d_8, N=16: (400)$\n- $d_9, N=18: (330)$ 或 $(411)$\n- $d_{10}, N=20: (420)$\n- $d_{11}, N=22: (332)$\n- $d_{12}, N=24: (422)$\n- $d_{13}, N=26: (510)$ 或 $(431)$\n- $d_{14}, N=30: (521)$\n- $d_{15}, N=32: (440)$\n- $d_{16}, N=34: (530)$ 或 $(433)$\n- $d_{17}, N=36: (600)$ 或 $(442)$\n- $d_{18}, N=38: (611)$ 或 $(532)$\n- $d_{19}, N=40: (620)$\n- $d_{20}, N=42: (541)$\n所有二十个峰都已指标化，且图谱与 BCC 晶格完全一致。\n\n步骤5：执行最小二乘精修以获得晶格参数 $a$ 的最佳值。模型为 $Q_i^2 = P \\cdot N_i$，其中 $P = 1/a^2$。一种统计上合理的方法是通过每个数据点方差的倒数对其进行加权。$Q^2$ 的不确定度为 $\\delta(Q_i^2) = 2 Q_i^2 (\\delta d_i/d_i)$。由于 $\\delta d/d$ 是常数，因此 $Q_i^2$ 的标准差 $\\sigma_i$ 与 $Q_i^2$ 成正比。权重为 $w_i = 1/\\sigma_i^2 \\propto 1/(Q_i^2)^2$。使用 $Q_i^2 \\approx P N_i$，权重为 $w_i \\propto 1/N_i^2$。对于通过原点的直线的斜率 $P$，其加权最小二乘解为 $P = (\\sum w_i N_i Q_i^2) / (\\sum w_i N_i^2)$。代入 $w_i = 1/N_i^2$ 将其简化为 $P = \\frac{1}{n} \\sum_{i=1}^{n} \\frac{Q_i^2}{N_i}$，其中 $n = 20$。\n我们为每个峰计算 $Q_i^2/N_i = 1/(d_i^2 N_i)$ 的值：\n$1/(2.121320^2 \\times 2) = 0.111111115$\n$1/(1.500000^2 \\times 4) = 0.111111111$\n...\n$1/(0.4629100^2 \\times 42) = 0.111111111$\n每个单独的值都非常接近 $1/9$。对这二十个值求平均：\n$P = \\frac{1}{20} \\sum_{i=1}^{20} \\frac{1}{d_i^2 N_i} = 0.11111111105$ Å$^{-2}$。\n然后从 $a = 1/\\sqrt{P}$ 计算精修后的晶格参数 $a$。\n$a = 1/\\sqrt{0.11111111105} = 3.00000000075$ Å。\n按要求四舍五入到四位有效数字，我们得到 $a = 3.000$ Å。\n立方晶格的晶胞体积为 $V = a^3$。\n$V = (3.00000000075 \\text{ Å})^3 = 27.00000000675$ Å$^3$。\n四舍五入到四位有效数字，体积为 $V = 27.00$ Å$^3$。\n确定的晶格是体心立方，晶格参数 $a = 3.000$ Å。", "answer": "$$\n\\boxed{\\begin{pmatrix} 3.000 & 27.00 \\end{pmatrix}}\n$$", "id": "2515451"}, {"introduction": "在确定了晶胞的基本框架后，下一步通常是尽可能精确地测定其参数。本练习超越了简单的索引，引入了针对实验数据进行物理模型精修的概念，你需要同时校正常见的系统误差，如仪器零点漂移和样品位移。这是一个实用的计算练习，它模拟了现代晶体学分析软件的核心功能，旨在提升你进行精确定量分析的能力。[@problem_id:2515523]", "problem": "您将获得由 Bragg–Brentano 衍射仪测量的、来自美国国家标准与技术研究院 (NIST) 硅标准品的人造粉末X射线衍射峰位数据。您的任务是编写一个程序，通过对测得的 $2\\theta$ 值进行非线性最小二乘拟合来精修立方晶格参数 $a$，同时精修一个恒定的零点偏移和一个样品位移参数。\n\n从以下基本原理入手：\n- 布拉格定律：$n \\lambda = 2 d \\sin \\theta$，其中 $n = 1$。\n- 对于立方晶格，晶面间距为：$d_{hkl}(a) = \\dfrac{a}{\\sqrt{h^2 + k^2 + l^2}}$。\n- 计算出的布拉格角（以弧度为单位）：$\\theta_{hkl}(a) = \\arcsin\\!\\left(\\dfrac{\\lambda}{2 d_{hkl}(a)}\\right)$。\n- 理想的计算峰位（以度为单位）：$2\\theta_{B,hkl}(a) = 2 \\, \\theta_{hkl}(a) \\times \\dfrac{180}{\\pi}$。\n- Bragg–Brentano 准聚焦几何中的系统误差模型：\n  - 一个恒定的零点偏移（仪器未对准）会给所有 $2\\theta$ 值增加一个均匀的偏移量 $z$（以度为单位）。\n  - 一个平面样品的位移 $h$（沿垂直于衍射仪轴线的方向），在衍射仪半径为 $R$ 的情况下，产生的峰位偏移由下式给出\n    $$\\Delta(2\\theta)_{\\mathrm{disp}} = -\\dfrac{2 h}{R} \\cos\\!\\theta_{hkl}(a),$$\n    其中 $\\Delta(2\\theta)_{\\mathrm{disp}}$ 以弧度为单位。相应的角度偏移为 $\\Delta(2\\theta)_{\\mathrm{disp,deg}} = \\Delta(2\\theta)_{\\mathrm{disp}} \\times \\dfrac{180}{\\pi}$。\n- 因此，预测的峰位（以度为单位）为\n  $$2\\theta_{\\mathrm{calc},i}(a,z,h) = 2\\theta_{B,i}(a) + z + \\Delta(2\\theta)_{\\mathrm{disp,deg},i}(a,h)。$$\n\n您必须找到能使残差平方和最小化的 $(a, z, h)$\n$$S(a,z,h) = \\sum_{i=1}^{N} \\left[ 2\\theta_{\\mathrm{meas},i} - 2\\theta_{\\mathrm{calc},i}(a,z,h) \\right]^2。$$\n\n角度单位：\n- 所有给定的 $2\\theta$ 值均以度为单位。\n- 在三角函数内部使用弧度。\n- 最终的 $z$ 必须以度为单位报告。\n- 参数 $h$ 必须以毫米（mm）为单位报告。\n- 衍射仪半径 $R$ 以毫米（mm）为单位给出。\n- 波长 $\\lambda$ 以埃（Å）为单位给出。\n- 晶格参数 $a$ 必须以埃（Å）为单位报告。\n\n为 $(a,z,h)$ 实现一个稳健的非线性最小二乘法精修。\n\n测试套件：\n- 所有案例的通用常数：\n  - 波长：$\\lambda = 1.5406 \\ \\mathrm{\\AA}$。\n  - 衍射仪半径：$R = 240.0 \\ \\mathrm{mm}$。\n  - 使用的衍射（米勒指数）：$(1,1,1)$、$(2,2,0)$、$(3,1,1)$、$(4,0,0)$、$(3,3,1)$、$(4,2,2)$、$(3,3,3)$、$(4,4,0)$。\n- 案例A（典型的较小正零点偏移和较小正位移）：\n  - 测量的 $2\\theta$ 值（度）：$[28.4167, 47.2802, 56.0978, 69.1087, 76.3544, 88.0186, 94.9368, 106.9185]$。\n- 案例B（负零点偏移，无位移）：\n  - 测量的 $2\\theta$ 值（度）：$[28.4280, 47.2890, 56.1050, 69.1130, 76.3570, 88.0180, 94.9340, 106.9120]$。\n- 案例C（中等正零点偏移，较大正位移）：\n  - 测量的 $2\\theta$ 值（度）：$[28.3080, 47.1785, 56.0013, 69.0208, 76.2717, 87.9457, 94.8702, 106.8632]$。\n\n科学真实性和约束条件：\n- 假设材料为具有金刚石立方对称性的硅；仅对所列衍射进行建模。\n- 使用物理上合理的参数边界，例如 $a \\in [3.0, 7.0] \\ \\mathrm{\\AA}$，$z \\in [-1.0, 1.0] \\ \\mathrm{deg}$ 和 $h \\in [-2.0, 2.0] \\ \\mathrm{mm}$。\n- 使用数值稳定的方法（例如，信赖域或 Levenberg–Marquardt 算法）来解决非线性最小二乘问题。\n\n您的程序必须：\n- 对于每个案例，使用给定的测量 $2\\theta$ 值、$\\lambda$、$R$ 和指定的衍射集合，通过最小化 $S(a,z,h)$ 来精修 $(a, z, h)$。\n- 使用初始猜测值 $a_0 = 5.43 \\ \\mathrm{\\AA}$，$z_0 = 0.0 \\ \\mathrm{deg}$，$h_0 = 0.0 \\ \\mathrm{mm}$。\n- 生成单行输出，其中包含一个三元组列表，每个测试案例一个三元组，每个三元组的形式为 $[a, z, h]$，每个值均按上述指定单位四舍五入到六位小数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表形式的结果，例如：\n  - $[[a_A,z_A,h_A],[a_B,z_B,h_B],[a_C,z_C,h_C]]$\n- 每个 $a$ 必须以埃为单位，每个 $z$ 以度为单位，每个 $h$ 以毫米为单位，所有值都四舍五入到六位小数。", "solution": "所述问题具有科学依据，定义明确且完整。它提出了X射线晶体学中的一个标准任务：从粉末衍射数据中精修晶体学和仪器参数。我们将着手解决此问题。\n\n目标是确定立方晶格参数 $a$、仪器零点偏移误差 $z$ 和样品位移误差参数 $h$ 的最优值。这些参数可以表示为向量 $\\mathbf{p} = [a, z, h]$，必须通过精修来最小化测量到的2-theta峰位 $2\\theta_{\\mathrm{meas},i}$ 与物理模型计算出的峰位 $2\\theta_{\\mathrm{calc},i}(\\mathbf{p})$ 之间的残差平方和 $S(\\mathbf{p})$。目标函数为：\n$$S(a,z,h) = \\sum_{i=1}^{N} \\left[ 2\\theta_{\\mathrm{meas},i} - 2\\theta_{\\mathrm{calc},i}(a,z,h) \\right]^2$$\n其中 $N$ 是观测到的衍射数。这是一个经典的非线性最小二乘优化问题。求解该问题需要构建模型函数 $2\\theta_{\\mathrm{calc},i}(a,z,h)$，并使用数值算法找到 $S$ 的最小值。\n\n模型函数 $2\\theta_{\\mathrm{calc},i}(a,z,h)$ 由三个不同的物理部分组成：\n$1$. 立方晶体结构的理想布拉格峰位 $2\\theta_{B,i}(a)$。这源于布拉格定律 $n\\lambda = 2d_{hkl}\\sin\\theta$（反射级数$n=1$）和立方晶格的晶面间距公式 $d_{hkl}$。\n$$d_{hkl}(a) = \\frac{a}{\\sqrt{h^2+k^2+l^2}}$$\n其中 $(h, k, l)$ 是该衍射的米勒指数。结合这些，理想的布拉格角 $\\theta_{hkl}$（以弧度为单位）为：\n$$\\theta_{hkl}(a) = \\arcsin\\left(\\frac{\\lambda}{2d_{hkl}(a)}\\right) = \\arcsin\\left(\\frac{\\lambda \\sqrt{h^2+k^2+l^2}}{2a}\\right)$$\n衍射图上的位置以度为单位给出，即 $2\\theta_{B,i}(a) = 2 \\times \\theta_{hkl,i}(a) \\times \\frac{180}{\\pi}$。\n\n$2$. 仪器零点偏移 $z$。这是一个恒定的角度偏移，以度为单位，由测角仪的轻微未对准引起。它是一个加法项，因此通过将其包含进来，模型改进为 $2\\theta_{B,i}(a) + z$。\n\n$3$. 样品位移误差 $\\Delta(2\\theta)_{\\mathrm{disp,deg}}$。如果平坦的样品表面与测角仪的旋转轴有距离为 $h$ 的位移，就会出现这种系统误差。对于半径为 $R$ 的 Bragg-Brentano 几何结构，该误差（以度为单位）是布拉格角 $\\theta$ 本身的函数：\n$$\\Delta(2\\theta)_{\\mathrm{disp,deg},i}(a, h) = -\\frac{2h}{R} \\cos(\\theta_{hkl,i}(a)) \\times \\frac{180}{\\pi}$$\n此处使用参数 $h$（单位 $\\mathrm{mm}$）和 $R$（单位 $\\mathrm{mm}$），使比率 $h/R$ 无量纲。该误差在低角度时最为显著，此时 $\\cos(\\theta) \\approx 1$。\n\n将这三个部分结合起来，得到计算峰位的完整模型（以度为单位）：\n$$2\\theta_{\\mathrm{calc},i}(a,z,h) = 2\\theta_{B,i}(a) + z + \\Delta(2\\theta)_{\\mathrm{disp,deg},i}(a, h)$$\n\n为了解决最小化问题，我们将实现一个函数，对于给定的参数集 $(a, z, h)$，该函数计算所有观测衍射的残差向量 $r_i = 2\\theta_{\\mathrm{meas},i} - 2\\theta_{\\mathrm{calc},i}(a,z,h)$。然后将该向量值函数传递给数值求解器。`scipy.optimize.least_squares` 例程实现了信赖域反射算法，适用于此任务，因为它稳健且能处理指定的参数边界：$a \\in [3.0, 7.0] \\ \\mathrm{\\AA}$，$z \\in [-1.0, 1.0] \\ \\mathrm{deg}$ 和 $h \\in [-2.0, 2.0] \\ \\mathrm{mm}$。\n\n步骤如下：对于每个测试案例，使用通用常数（$\\lambda = 1.5406 \\ \\mathrm{\\AA}$，$R = 240.0 \\ \\mathrm{mm}$）、米勒指数集、测量的 $2\\theta$ 值、初始参数猜测值（$a_0 = 5.43 \\ \\mathrm{\\AA}$，$z_0 = 0.0 \\ \\mathrm{deg}$，$h_0 = 0.0 \\ \\mathrm{mm}$）和参数边界来启动求解器。求解器通过迭代调整 $(a, z, h)$ 来找到使残差平方和最小化的向量。然后报告每个案例的最终精修参数。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef solve():\n    \"\"\"\n    Solves for the lattice parameter 'a', zero shift 'z', and specimen\n    displacement 'h' for synthetic powder XRD data using non-linear least squares.\n    \"\"\"\n    # Common constants for all test cases\n    LAMBDA_A = 1.5406  # Wavelength in Angstroms\n    R_MM = 240.0      # Diffractometer radius in millimeters\n\n    # Miller indices for the reflections of silicon\n    HKL_VALUES = np.array([\n        [1, 1, 1], [2, 2, 0], [3, 1, 1], [4, 0, 0],\n        [3, 3, 1], [4, 2, 2], [3, 3, 3], [4, 4, 0]\n    ])\n\n    # Measured 2-theta values for each test case\n    test_cases_data = [\n        # Case A: typical small positive zero and small positive displacement\n        [28.4167, 47.2802, 56.0978, 69.1087, 76.3544, 88.0186, 94.9368, 106.9185],\n        # Case B: negative zero shift, no displacement\n        [28.4280, 47.2890, 56.1050, 69.1130, 76.3570, 88.0180, 94.9340, 106.9120],\n        # Case C: moderate positive zero, large positive displacement\n        [28.3080, 47.1785, 56.0013, 69.0208, 76.2717, 87.9457, 94.8702, 106.8632]\n    ]\n\n    def residuals(params, hkl, two_theta_meas_deg, R, lamb):\n        \"\"\"\n        Calculates the residuals between measured and calculated 2-theta values.\n        \n        Args:\n            params (list): [a, z, h]\n                - a: lattice parameter in Angstroms\n                - z: zero shift in degrees\n                - h: specimen displacement in mm\n            hkl (np.ndarray): Array of Miller indices (h, k, l) for each peak.\n            two_theta_meas_deg (np.ndarray): Array of measured 2-theta values in degrees.\n            R (float): Diffractometer radius in mm.\n            lamb (float): X-ray wavelength in Angstroms.\n            \n        Returns:\n            np.ndarray: Vector of residuals (measured - calculated).\n        \"\"\"\n        a, z, h = params\n        \n        # Calculate ideal Bragg peak positions (2*theta_B)\n        hkl_sq_sum = np.sum(hkl**2, axis=1)\n        \n        # Argument for arcsin: lambda / (2 * d_hkl)\n        # d_hkl = a / sqrt(h^2 + k^2 + l^2)\n        arg = (lamb * np.sqrt(hkl_sq_sum)) / (2 * a)\n\n        # Clip argument to [-1, 1] to prevent domain errors from floating point inaccuracies\n        arg = np.clip(arg, -1.0, 1.0)\n        \n        theta_rad = np.arcsin(arg)\n        two_theta_B_deg = 2 * np.rad2deg(theta_rad)\n        \n        # Calculate specimen displacement error\n        # Delta(2theta) = -(2*h/R)*cos(theta)\n        disp_error_deg = -(2 * h / R) * np.cos(theta_rad) * (180 / np.pi)\n        \n        # Calculate the full model for peak positions\n        two_theta_calc_deg = two_theta_B_deg + z + disp_error_deg\n        \n        return two_theta_meas_deg - two_theta_calc_deg\n\n    results = []\n    initial_guess = [5.43, 0.0, 0.0]  # a_0, z_0, h_0\n    bounds = ([3.0, -1.0, -2.0], [7.0, 1.0, 2.0])  # Lower and upper bounds for a, z, h\n\n    for case_data in test_cases_data:\n        two_theta_meas_np = np.array(case_data)\n        \n        # Perform non-linear least squares optimization\n        opt_result = least_squares(\n            residuals,\n            initial_guess,\n            bounds=bounds,\n            method='trf',  # Trust Region Reflective algorithm\n            args=(HKL_VALUES, two_theta_meas_np, R_MM, LAMBDA_A)\n        )\n        \n        # Extract refined parameters\n        a_refined, z_refined, h_refined = opt_result.x\n        \n        # Store rounded results\n        results.append([\n            round(a_refined, 6),\n            round(z_refined, 6),\n            round(h_refined, 6)\n        ])\n        \n    # Format and print the final output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2515523"}, {"introduction": "分析衍射数据固然重要，但高质量数据的获取是成功分析的前提。本练习将让你扮演实验科学家的角色，为一次单晶衍射实验设计最佳的数据收集策略。你需要权衡分辨率、完整度、冗余度和衍射点重叠等关键因素，尤其是在面对具有大晶胞等挑战性样品时，这对于培养实验设计中的战略思维至关重要。[@problem_id:2515465]", "problem": "一个三斜单晶（空间群 $P1$）的晶胞参数为 $a = 46.2\\,\\text{\\AA}$，$b = 63.0\\,\\text{\\AA}$，$c = 65.5\\,\\text{\\AA}$，$\\alpha = 79.3^\\circ$，$\\beta = 88.1^\\circ$，$\\gamma = 69.7^\\circ$。您将使用波长为 $\\lambda = 0.71073\\,\\text{\\AA}$ 的单色X射线和一个有效面积为 $300\\,\\mathrm{mm} \\times 300\\,\\mathrm{mm}$ 的方形光子计数面探测器来收集衍射数据，其中主光束位于探测器中心。样品到探测器的距离 $L$ 是可调的。测角仪提供一个单一的连续旋转轴。测得的晶体嵌镶度为 $\\sigma_\\text{mos} = 0.25^\\circ$，投影到旋转轴上的光束发散度为 $\\sigma_\\text{div} = 0.05^\\circ$。您的目标是在最小d-间距为 $d_{\\min} = 1.0\\,\\text{\\AA}$ 时，达到至少 $99\\,\\%$ 的数据完整度和至少 $2.0$ 的重复度（多重度），同时避免明显的衍射点重叠。\n\n根据衍射几何学和衍射点摇摆行为的基本原理，选择在这些约束条件下最能满足上述目标的数据收集策略。\n\n选项：\n\nA. 将探测器设置在 $L = 230\\,\\mathrm{mm}$；使用精细切片法收集一个完整的 $360^\\circ$ 的$\\phi$角旋转，每张图像的摆动角为 $\\Delta\\phi = 0.10^\\circ$。\n\nB. 将探测器设置在 $L = 280\\,\\mathrm{mm}$；收集 $180^\\circ$ 的$\\phi$角范围，每张图像的摆动角为 $\\Delta\\phi = 0.50^\\circ$。\n\nC. 将探测器设置在 $L = 230\\,\\mathrm{mm}$；收集 $180^\\circ$ 的$\\phi$角范围，每张图像的摆动角为 $\\Delta\\phi = 1.00^\\circ$。\n\nD. 将探测器设置在 $L = 230\\,\\mathrm{mm}$；收集 $220^\\circ$ 的$\\phi$角范围，每张图像的摆动角为 $\\Delta\\phi = 0.20^\\circ$。", "solution": "该问题要求基于X射线衍射几何学的基本原理，对一个具有非常大的三斜晶胞的单晶，评估四种被提出的数据收集策略。目标是选择一种策略，能够在达到指定分辨率下实现高完整度和高重复度，同时最小化衍射点重叠。\n\n首先，我们验证问题陈述的有效性。已知条件如下：\n- 晶体：三斜晶系，空间群 $P1$\n- 晶胞参数：$a = 46.2\\,\\text{\\AA}$，$b = 63.0\\,\\text{\\AA}$，$c = 65.5\\,\\text{\\AA}$，$\\alpha = 79.3^\\circ$，$\\beta = 88.1^\\circ$，$\\gamma = 69.7^\\circ$\n- 辐射波长：$\\lambda = 0.71073\\,\\text{\\AA}$\n- 探测器：$300\\,\\mathrm{mm} \\times 300\\,\\mathrm{mm}$ 方形面积，光束中心对准\n- 样品到探测器距离：$L$（可调）\n- 测角仪：单$\\phi$旋转轴\n- 晶体/光束特性：嵌镶度 $\\sigma_\\text{mos} = 0.25^\\circ$，光束发散度 $\\sigma_\\text{div} = 0.05^\\circ$\n- 数据质量目标：完整度 $\\ge 99\\,\\%$，重复度 $\\ge 2.0$，最小d-间距 $d_{\\min} = 1.0\\,\\text{\\AA}$，避免明显的衍射点重叠。\n\n该问题陈述具有科学依据，提法得当且客观。它描述了晶体学实验设计中一个标准但具有挑战性的问题。这些参数对于大分子晶体学是符合实际的。进行定量评估所需的所有信息都已提供。该问题是有效的。\n\n我们现在将分析成功的数据收集策略所需满足的标准，并评估每个选项。\n\n**1. 探测器距离（$L$）和分辨率（$d_{\\min}$）**\n\nd-间距（$d$）与衍射角（$2\\theta$）之间的关系由Bragg定律给出：\n$$ \\lambda = 2d\\sin\\theta $$\n对于最小d-间距 $d_{\\min} = 1.0\\,\\text{\\AA}$，所需的最大衍射角 $\\theta_{\\max}$ 为：\n$$ \\sin\\theta_{\\max} = \\frac{\\lambda}{2d_{\\min}} = \\frac{0.71073\\,\\text{\\AA}}{2 \\times 1.0\\,\\text{\\AA}} = 0.355365 $$\n$$ \\theta_{\\max} = \\arcsin(0.355365) \\approx 20.81^\\circ $$\n总衍射角为 $2\\theta_{\\max} \\approx 41.62^\\circ$。\n\n要捕捉到此角度的衍射点，它们必须落在探测器的有效区域内。该探测器是一个 $300\\,\\mathrm{mm} \\times 300\\,\\mathrm{mm}$ 的正方形。从中心（主光束）到探测器上某一点的最大距离是到其角点的距离。这个距离 $R_{\\max}$ 是：\n$$ R_{\\max} = \\sqrt{\\left(\\frac{300}{2}\\right)^2 + \\left(\\frac{300}{2}\\right)^2} = 150\\sqrt{2} \\approx 212.1\\,\\mathrm{mm} $$\n样品到探测器的距离 $L$、探测器半径 $R$ 和衍射角 $2\\theta$ 之间的关系是：\n$$ \\tan(2\\theta) = \\frac{R}{L} $$\n为了记录到 $d_{\\min} = 1.0\\,\\text{\\AA}$ 的数据，探测器必须被放置在一个距离 $L$ 的位置，使得 $2\\theta_{\\max}$ 的衍射点能被捕捉到，即 $L \\tan(2\\theta_{\\max}) \\le R_{\\max}$。这设定了一个最大允许距离 $L_{\\max}$：\n$$ L_{\\max} = \\frac{R_{\\max}}{\\tan(2\\theta_{\\max})} = \\frac{212.1\\,\\mathrm{mm}}{\\tan(41.62^\\circ)} \\approx \\frac{212.1\\,\\mathrm{mm}}{0.8884} \\approx 238.8\\,\\mathrm{mm} $$\n\n现在，我们评估选项中提出的距离：\n- $L = 230\\,\\mathrm{mm}$：该距离小于 $L_{\\max}$（$230\\,\\text{mm} < 238.8\\,\\text{mm}$）。在此距离上，探测器角点处记录的最小d-间距是 $d = \\frac{\\lambda}{2\\sin(\\theta)}$，其中 $2\\theta = \\arctan(R_{\\max}/L) = \\arctan(212.1/230) \\approx 42.68^\\circ$。这给出的 $d_{\\min} \\approx 0.976\\,\\text{\\AA}$，满足了达到至少 $1.0\\,\\text{\\AA}$ 分辨率的目标。因此，$L = 230\\,\\mathrm{mm}$ 是一个可接受的距离。\n- $L = 280\\,\\mathrm{mm}$：该距离大于 $L_{\\max}$。可达到的最高分辨率是 $d_{\\min} = \\frac{\\lambda}{2\\sin(\\theta)}$，其中 $2\\theta = \\arctan(212.1/280) \\approx 37.14^\\circ$。这给出的 $d_{\\min} \\approx 1.12\\,\\text{\\AA}$。这未达到 $1.0\\,\\text{\\AA}$ 的分辨率要求。\n\n基于此分析，任何 $L=280\\,\\mathrm{mm}$ 的策略都是无效的。\n\n**2. 旋转范围（$\\phi$）、完整度和重复度**\n\n该晶体的空间群为 $P1$，属于三斜晶系。其Laue群为 $\\bar{1}$。这是三维空间中最低的对称性。独立衍射点集（倒易空间的不对称单元）占据整个半球。\n- $180^\\circ$ 的旋转是测量这个独立半球一次的理论最小值（重复度约为 $1.0$）。由于几何限制，如围绕旋转轴的“盲区”，$180^\\circ$ 的扫描通常导致完整度低于 $100\\,\\%$。\n- $360^\\circ$ 的旋转测量整个衍射球。对于中心对称的Laue群 $\\bar{1}$，其中 $I(hkl) = I(\\bar{h}\\bar{k}\\bar{l})$，这意味着每个独立衍射点被测量两次。因此，$360^\\circ$ 的扫描提供了理论上2.0的重复度。\n\n目标是达到至少2.0的重复度。\n- 总旋转 $180^\\circ$（选项C）产生的重复度约为 $1.0$，未能达到目标。\n- 总旋转 $220^\\circ$（选项D）产生的重复度约为 $220^\\circ/180^\\circ \\approx 1.22$，也未能达到目标。\n- 总旋转 $360^\\circ$（选项A）是达到2.0重复度目标所必需的。\n\n**3. 摆动角（$\\Delta\\phi$）和衍射点重叠**\n\n该晶胞非常大（$a, b, c > 45\\,\\text{\\AA}$），这意味着倒易阵点（RLPs）非常密集。这带来了衍射点重叠的高风险，包括空间上的重叠（在探测器上）和旋转上的重叠（在一次 $\\Delta\\phi$ 摆动内有多个倒易阵点被激发）。\n\n衍射点的摇摆宽度取决于晶体嵌镶度、光束发散度和光谱色散。对全摇摆宽度 $\\Delta\\theta_\\text{rock}$ 的保守估计是给定的内在参数之和：\n$$ \\Delta\\theta_\\text{rock} \\approx \\sigma_\\text{mos} + \\sigma_\\text{div} = 0.25^\\circ + 0.05^\\circ = 0.30^\\circ $$\n为避免旋转重叠并能准确描绘强度轮廓，每张图像的摆动角 $\\Delta\\phi$ 应被仔细选择。\n- 如果 $\\Delta\\phi$ 远大于 $\\Delta\\theta_\\text{rock}$，在单次曝光中会有多个衍射点被激发，导致严重重叠。这对于大晶胞是不可接受的。\n- “精细切片”策略，即 $\\Delta\\phi \\le \\Delta\\theta_\\text{rock}$，是标准且必要的方法。它通过对倒易空间进行更精细的采样来最小化重叠，并允许每个衍射点的强度在几个连续的图像帧上进行积分。\n\n让我们检查所提出的 $\\Delta\\phi$ 值：\n- $\\Delta\\phi = 1.00^\\circ$（选项C）：这比估计的摇摆宽度（$1.00^\\circ \\gg 0.30^\\circ$）大三倍以上。这将导致灾难性的衍射点重叠，对于此晶体是错误的策略。\n- $\\Delta\\phi = 0.50^\\circ$（选项B）：仍显著大于摇摆宽度。这也是一个糟糕的选择。\n- $\\Delta\\phi = 0.20^\\circ$（选项D）：这是一种精细切片方法（$\\Delta\\phi < \\Delta\\theta_\\text{rock}$）。这是一个合理的策略。\n- $\\Delta\\phi = 0.10^\\circ$（选项A）：这是一种更精细的切片方法。对于非常大的晶胞，更精细的切片为防止重叠提供了更大的安全余量。这是最稳妥的选择。\n\n**评估选项**\n\n- **选项A**：将探测器设置在 $L = 230\\,\\mathrm{mm}$；使用精细切片法收集一个完整的 $360^\\circ$ 的$\\phi$角旋转，每张图像的摆动角为 $\\Delta\\phi = 0.10^\\circ$。\n  - $L=230\\,\\mathrm{mm}$：**正确**。满足分辨率目标。\n  - $\\phi$角范围 $360^\\circ$：**正确**。满足 $\\ge 2.0$ 的重复度目标。\n  - $\\Delta\\phi = 0.10^\\circ$：**正确**。这是一个优秀的精细切片策略，以防止重叠。\n  - 总体而言：该策略满足所有指定目标，并代表了此类实验的最佳实践。\n\n- **选项B**：将探测器设置在 $L = 280\\,\\mathrm{mm}$；收集 $180^\\circ$ 的$\\phi$角范围，每张图像的摆动角为 $\\Delta\\phi = 0.50^\\circ$。\n  - $L=280\\,\\mathrm{mm}$：**不正确**。未能达到 $1.0\\,\\text{\\AA}$ 的分辨率目标。\n  - 仅因探测器距离一项，该策略就存在根本性缺陷。\n\n- **选项C**：将探测器设置在 $L = 230\\,\\mathrm{mm}$；收集 $180^\\circ$ 的$\\phi$角范围，每张图像的摆动角为 $\\Delta\\phi = 1.00^\\circ$。\n  - $\\phi$角范围 $180^\\circ$：**不正确**。未能达到 $\\ge 2.0$ 的重复度目标。\n  - $\\Delta\\phi = 1.00^\\circ$：**不正确**。这个摆动角过大，会导致严重的衍射点重叠。\n  - 该策略在两个关键点上失败。\n\n- **选项D**：将探测器设置在 $L = 230\\,\\mathrm{mm}$；收集 $220^\\circ$ 的$\\phi$角范围，每张图像的摆动角为 $\\Delta\\phi = 0.20^\\circ$。\n  - $\\phi$角范围 $220^\\circ$：**不正确**。未能达到 $\\ge 2.0$ 的重复度目标。\n  - 虽然 $L$ 和 $\\Delta\\phi$ 的选择是合理的，但总旋转范围不足。\n\n**结论**\n\n只有选项A成功满足了问题中列出的所有约束和目标。探测器距离适合目标分辨率，总旋转范围对于所需的重复度是必要的，而精细切片对于最小化这个大晶胞的衍射点重叠至关重要。\n因此，选项A是正确的选择。", "answer": "$$\\boxed{A}$$", "id": "2515465"}]}