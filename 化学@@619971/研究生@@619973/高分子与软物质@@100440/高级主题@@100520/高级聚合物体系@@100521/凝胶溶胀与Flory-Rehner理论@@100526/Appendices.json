{"hands_on_practices": [{"introduction": "本练习旨在通过推导和应用高溶胀体系下的 Flory-Rehner 理论标度形式，来巩固其核心原理。通过将 Flory-Huggins 相互作用参数 $\\chi$ 与溶解度参数这一概念联系起来，你将建立起关于溶剂选择如何决定凝胶平衡溶胀度的实践直觉 [@problem_id:2930303]。这项练习将提升你应用热力学模型预测材料行为的能力。", "problem": "一个轻度交联、不可压缩的聚合物网络分别与两种不同的纯溶剂（标记为溶剂1和溶剂2）接触，达到溶胀平衡。该聚合物是各向同性的，其链统计服从高斯分布，且有限伸长性可以忽略。浴压为环境压力，没有施加外部渗透压。设 $T$ 表示绝对温度，$R$ 表示普适气体常数。设 $\\nu_{e}$ 为单位干聚合物体积内弹性活性网络链的有效数密度。两种溶剂的摩尔体积相同，均为 $v_{s}$。聚合物的溶解度参数为 $\\delta_{p}$，而两种溶剂的溶解度参数分别为 $\\delta_{1}$ 和 $\\delta_{2}$。假设溶剂 $i$ 的 Flory–Huggins 相互作用参数可以通过以下公式估算\n$$\n\\chi_{i} \\approx \\frac{v_{s}}{R T}\\left(\\delta_{p}-\\delta_{i}\\right)^{2}, \\quad i \\in \\{1,2\\}.\n$$\n将溶胀凝胶中聚合物的体积分数定义为 $\\phi$，在体积不可压缩相加的假设下，将平衡体积溶胀比定义为 $Q^{\\ast} \\equiv \\phi^{-1}$。\n\n从 Flory–Huggins 混合自由能和高斯网络弹性自由能出发，基于凝胶中和纯溶剂库中溶剂化学势相等的平衡条件，在 $0<\\phi \\ll 1$ 的高溶胀极限下，系统地推导溶剂 $i$ 中平衡聚合物体积分数 $\\phi_{i}^{\\ast}$ 的主阶标度形式，并由此获得平衡溶胀比之比 $Q_{1}^{\\ast}/Q_{2}^{\\ast}$ 的解析表达式，该表达式用 $\\delta_{p}$, $\\delta_{1}$, $\\delta_{2}$, $v_{s}$, $R$ 和 $T$ 表示。\n\n请以 $Q_{1}^{\\ast}/Q_{2}^{\\ast}$ 的单一闭合形式表达式给出您的最终结果。不要代入任何数值。最终答案不带单位。", "solution": "合适的的基本出发点是不可压缩各向同性凝胶的 Flory–Huggins 混合自由能和高斯网络弹性自由能之和。设 $V$ 为溶胀凝胶体积，$V_{0}$ 为干聚合物体积。聚合物体积分数为 $\\phi = V_{0}/V$（不可压缩性），溶胀比为 $Q = V/V_{0} = \\phi^{-1}$。\n\n对于长链聚合物溶液，当聚合物的平动熵可以忽略时，其混合对无量纲渗透压（相对于 $R T$）的贡献由经过充分验证的 Flory–Huggins 形式给出\n$$\n\\frac{\\Pi_{\\mathrm{mix}}}{R T} = -\\frac{1}{v_{s}}\\left[\\ln\\left(1-\\phi\\right)+\\phi+\\chi\\,\\phi^{2}\\right],\n$$\n其中 $\\chi$ 是 Flory–Huggins 相互作用参数。对于各向同性溶胀，其主拉伸比为 $\\lambda = \\phi^{-1/3}$。根据高斯网络弹性理论（仿射模型），相应的弹性对渗透压的贡献为\n$$\n\\frac{\\Pi_{\\mathrm{el}}}{R T} = \\nu_{e}\\left(\\phi^{1/3}-\\frac{\\phi}{2}\\right).\n$$\n在环境压力下与纯溶剂库达到平衡时，总渗透压为零，即 $\\Pi_{\\mathrm{mix}}+\\Pi_{\\mathrm{el}} = 0$。两边乘以 $v_{s}$ 并整理，Flory–Rehner 平衡条件可以写为\n$$\n\\ln\\left(1-\\phi\\right)+\\phi+\\chi\\,\\phi^{2} + \\nu_{e} v_{s}\\left(\\phi^{1/3}-\\frac{\\phi}{2}\\right) = 0.\n$$\n我们现在在高溶胀极限 $0<\\phi \\ll 1$ 下分析这个隐式方程。将对数项展开到二阶：$\\ln(1-\\phi) = -\\phi - \\phi^{2}/2 + \\mathcal{O}(\\phi^{3})$。代入平衡条件并保留小 $\\phi$ 的主导项，可得\n$$\n\\left(-\\phi - \\frac{\\phi^{2}}{2}\\right) + \\phi + \\chi\\,\\phi^{2} + \\nu_{e} v_{s}\\left(\\phi^{1/3} - \\frac{\\phi}{2}\\right) \\approx 0.\n$$\n$\\phi$ 的线性项相互抵消，在余下的项中，对于足够小的 $\\phi$，弹性项 $\\nu_{e} v_{s}\\,\\phi^{1/3}$ 远大于 $\\nu_{e} v_{s}\\,(\\phi/2)$。因此主阶平衡关系是\n$$\n\\left(\\chi - \\frac{1}{2}\\right)\\phi^{2} + \\nu_{e} v_{s}\\,\\phi^{1/3} \\approx 0.\n$$\n对于良溶剂，$\\chi < 1/2$，因此我们整理得到\n$$\n\\nu_{e} v_{s}\\,\\phi^{1/3} \\approx \\left(\\frac{1}{2} - \\chi\\right)\\phi^{2},\n$$\n简化为\n$$\n\\phi^{5/3} \\approx \\frac{\\nu_{e} v_{s}}{\\frac{1}{2} - \\chi}.\n$$\n因此，主阶平衡聚合物体积分数为\n$$\n\\phi^{\\ast} \\approx \\left(\\frac{\\nu_{e} v_{s}}{\\frac{1}{2} - \\chi}\\right)^{3/5},\n$$\n相应的平衡溶胀比为\n$$\nQ^{\\ast} = \\phi^{\\ast\\, -1} \\approx \\left(\\frac{\\frac{1}{2} - \\chi}{\\nu_{e} v_{s}}\\right)^{3/5}.\n$$\n对于两种溶剂，$v_{s}$、$\\nu_{e}$ 和 $T$ 相同，但相互作用参数 $\\chi_{1}$ 和 $\\chi_{2}$ 不同，其平衡溶胀比之比为\n$$\n\\frac{Q_{1}^{\\ast}}{Q_{2}^{\\ast}} \\approx \\left(\\frac{\\frac{1}{2} - \\chi_{1}}{\\frac{1}{2} - \\chi_{2}}\\right)^{3/5}.\n$$\n引用所述的 Flory–Huggins 相互作用参数的溶解度参数估算式，\n$$\n\\chi_{i} \\approx \\frac{v_{s}}{R T}\\left(\\delta_{p}-\\delta_{i}\\right)^{2}, \\quad i \\in \\{1,2\\},\n$$\n我们将其代入该比值，得到所需的闭合形式表达式：\n$$\n\\frac{Q_{1}^{\\ast}}{Q_{2}^{\\ast}} \\approx \\left[\\frac{\\frac{1}{2} - \\frac{v_{s}}{R T}\\left(\\delta_{p}-\\delta_{1}\\right)^{2}}{\\frac{1}{2} - \\frac{v_{s}}{R T}\\left(\\delta_{p}-\\delta_{2}\\right)^{2}}\\right]^{3/5}.\n$$\n该表达式表明，在其他条件相同的情况下，溶解度参数越接近聚合物溶解度参数的溶剂（使得 $(\\delta_{p}-\\delta_{i})^{2}$ 更小，从而 $\\chi_{i}$ 更小），会产生更大的因子 $\\frac{1}{2}-\\chi_{i}$，因此在这种高溶胀极限下，其平衡溶胀比 $Q_{i}^{\\ast}$ 也更大。", "answer": "$$\\boxed{\\left[\\dfrac{\\tfrac{1}{2}-\\dfrac{v_{s}}{R T}\\left(\\delta_{p}-\\delta_{1}\\right)^{2}}{\\tfrac{1}{2}-\\dfrac{v_{s}}{R T}\\left(\\delta_{p}-\\delta_{2}\\right)^{2}}\\right]^{\\tfrac{3}{5}}}$$", "id": "2930303"}, {"introduction": "本实践将超越简单的中性凝胶，通过对弱电解质凝胶进行建模，带你进入刺激响应材料这一引人入胜的领域。你将构建一个自洽模型，该模型结合了用于离子分配的 Donnan 平衡与凝胶内部的电中性和化学平衡原理 [@problem_id:2930238]。这个计算练习有力地展示了如何综合运用基础物理化学概念，来预测例如 pH 诱导的溶胀与塌缩等复杂行为。", "problem": "考虑一个化学交联的弱聚电解质凝胶，其带有单质子酸基团，可根据反应 $\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^+ + \\mathrm{A}^-$ 解离。该网络与一个大型水相槽在固定温度和压力下达到平衡，该水相槽含有对称单价盐和水。假设为理想混合，并忽略除静电学和化学平衡之外的特定离子效应。使用以下基本依据：\n\n1. 凝胶内部的电中性：单位凝胶体积内所有电荷的总和必须为零。若 $z_i$ 和 $c_i^{\\mathrm{in}}$ 分别表示凝胶内移动离子种类 $i$ 的化合价和浓度，且由网络产生的固定电荷密度为 $-c_f$（负号是因为去质子化的酸基团是阴离子），则 $\\sum_i z_i c_i^{\\mathrm{in}} - c_f = 0$。\n\n2. 单价离子的Donnan分配：凝胶边界两侧电化学势相等意味着 $c_i^{\\mathrm{in}} = c_i^{\\mathrm{res}} \\exp(-z_i \\psi_D)$，其中 $\\psi_D \\equiv e \\Delta \\psi/(k_{\\mathrm{B}} T)$ 是无量纲Donnan电势，$e$ 是元电荷，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是温度，$c_i^{\\mathrm{res}}$ 是槽内浓度。\n\n3. 接枝基团的酸解离（以浓度近似活度的Henderson-Hasselbalch关系）：电离度 $\\alpha$ 满足 $\\alpha/(1-\\alpha) = K_a/[\\mathrm{H}^+]_{\\mathrm{in}}$，其中 $K_a$ 是酸解离常数，$[\\mathrm{H}^+]_{\\mathrm{in}}$ 是凝胶内的氢离子浓度。\n\n4. 槽内水的自电离：$K_w = [\\mathrm{H}^+]_{\\mathrm{res}} [\\mathrm{OH}^-]_{\\mathrm{res}}$，其中 $K_w$ 是水的离子积，槽内pH为 $pH_{\\mathrm{res}} = -\\log_{10} [\\mathrm{H}^+]_{\\mathrm{res}}$。\n\n5. 由网络产生的固定电荷密度：若单位干聚合物体积内可滴定酸位点的摩尔浓度为 $C_A^{\\mathrm{dry}}$（单位为 $\\text{mol/L}_{\\text{polymer}}$），凝胶内的聚合物体积分数为 $\\phi$（无量纲），则单位凝胶体积内电离固定电荷的浓度为 $c_f = \\alpha \\, C_A^{\\mathrm{dry}} \\, \\phi$。\n\n假设槽内对称单价盐的浓度为 $c_s$（单位为 $\\mathrm{mol/L}$）。令 $[\\mathrm{H}^+]_{\\mathrm{res}} = 10^{-pH_{\\mathrm{res}}}$，$[\\mathrm{OH}^-]_{\\mathrm{res}} = K_w / [\\mathrm{H}^+]_{\\mathrm{res}}$，并使用Donnan关系 $[\\mathrm{H}^+]_{\\mathrm{in}} = [\\mathrm{H}^+]_{\\mathrm{res}} \\exp(-\\psi_D)$ 和 $[\\mathrm{OH}^-]_{\\mathrm{in}} = [\\mathrm{OH}^-]_{\\mathrm{res}} \\exp(+\\psi_D)$。对于盐离子，$c_+^{\\mathrm{in}} = c_s \\exp(-\\psi_D)$ 和 $c_-^{\\mathrm{in}} = c_s \\exp(+\\psi_D)$。将这些关系与电中性条件和酸解离关系结合，得到一个关于 $\\psi_D$ 的非线性标量方程，该方程通过 $[\\mathrm{H}^+]_{\\mathrm{in}}$ 与 $\\alpha$ 耦合。自洽地求解此方程，以获得作为 $pH_{\\mathrm{res}}$ 和 $\\phi$ 函数的 $\\alpha$。\n\n实现一个程序，对下述每个测试用例，通过求解上述方程来计算电离度 $\\alpha$。使用以下常数和单位：\n\n- 所有浓度（包括 $K_a$、$c_s$、$C_A^{\\mathrm{dry}}$）必须以 $\\mathrm{mol/L}$ 表示。\n- 聚合物体积分数 $\\phi$ 是无量纲的。\n- 槽内酸度 $pH_{\\mathrm{res}}$ 是无量纲的十进制对数。\n- 使用 $K_w = 10^{-14}$，单位为 $(\\text{mol/L})^2$（对应于标准环境条件）。\n- Donnan因子 $\\psi_D$ 如上定义，是无量纲的；您的算法可以直接使用 $\\psi_D$ 和指数玻尔兹曼因子。\n\n您的程序必须使用稳健的区间求根方法来求解 $\\psi_D$，然后计算 $\\alpha = 1/(1 + [\\mathrm{H}^+]_{\\mathrm{in}}/K_a)$，其中 $[\\mathrm{H}^+]_{\\mathrm{in}} = 10^{-pH_{\\mathrm{res}}} \\exp(-\\psi_D)$。为保证数值稳定性，您应将 $\\psi_D$ 限定在一个能确保电中性函数符号改变的有限区间内。\n\n测试套件（每个元组为 $(K_a, pH_{\\mathrm{res}}, c_s, \\phi, C_A^{\\mathrm{dry}})$，均采用上述指定单位）：\n- 用例 A（一般情况）： $(10^{-5}, 7.0, 0.1, 0.05, 10.0)$\n- 用例 B（无外加盐）： $(10^{-5}, 7.0, 0.0, 0.05, 10.0)$\n- 用例 C（酸性槽）： $(10^{-6}, 3.0, 0.1, 0.05, 10.0)$\n- 用例 D（碱性槽，稀凝胶）： $(10^{-4}, 10.0, 0.01, 0.01, 10.0)$\n- 用例 E（高聚合物分数，较低位点密度）： $(10^{-5}, 7.0, 0.1, 0.3, 8.0)$\n\n最终输出要求：\n- 对每个测试用例，输出计算得到的 $\\alpha$ 值，格式为开区间 $[0,1]$ 内的小数，保留小数点后六位。\n- 您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，结果顺序与上述测试套件一致（例如，$[\\alpha_A,\\alpha_B,\\alpha_C,\\alpha_D,\\alpha_E]$）。", "solution": "该问题要求在指定的平衡条件下，确定弱聚电解质凝胶的电离度 $\\alpha$。在进行求解之前，必须对问题陈述进行严格的验证。\n\n我们根据科学基础、适定性(well-posedness)和客观性的要求来审查该问题。\n所提出的模型基于已确立的Donnan平衡离子分配原理、带电介质内的电中性原理以及标准的酸解离化学平衡（Henderson-Hasselbalch方程）。这些概念构成了聚电解质物理化学的基石，并且完全科学合理。为测试用例提供的参数——酸解离常数（$K_a$）、pH值、盐浓度（$c_s$）、聚合物体积分数（$\\phi$）和固定电荷密度（$C_A^{\\mathrm{dry}}$）——都处于此类系统的物理现实范围之内。\n\n该问题是适定的。它要求构建一个关于无量纲Donnan电势 $\\psi_D$ 的非线性标量方程，然后进行数值求解。该方程的推导以及其解的存在性和唯一性的证明，都证实了可以获得有意义的结果。指令清晰、客观，并提供了所有必要的信息，没有留下任何歧义的空间。该问题是自洽且内部一致的。\n\n结论是该问题是**有效**的。现在将给出解答。\n\n核心任务是求解凝胶的平衡状态，该状态由电离度 $\\alpha$ 表征。此量与凝胶和外部溶液之间的静电势差，即Donnan电势 $\\Delta \\psi$耦合，我们用其无量纲形式表示，即 $\\psi_D = e \\Delta \\psi / (k_B T)$。通过施加凝胶内部的局部电中性条件来找到解。\n\n电中性条件规定，每单位体积内所有电荷的总和必须为零。对电荷平衡有贡献的物种包括来自外部溶液的移动离子（质子 $\\text{H}^+$、氢氧根 $\\text{OH}^-$ 和盐离子）以及聚合物网络上的固定电荷（$\\text{A}^-$）。对于外部溶液浓度为 $c_s$ 的对称单价盐，阳离子和阴离子的化合价分别为 $z_+ = +1$ 和 $z_- = -1$。电中性方程为：\n$$ (+1)[\\text{H}^+]_{\\text{in}} + (+1)c_+^{\\text{in}} + (-1)[\\text{OH}^-]_{\\text{in}} + (-1)c_-^{\\text{in}} - c_f = 0 $$\n其中 $c_i^{\\text{in}}$ 表示凝胶内物种 $i$ 的浓度，$c_f$ 是网络上电离酸基团的浓度。\n\n凝胶内移动离子的浓度通过Donnan平衡关系与其在外部溶液中的浓度（$c_i^{\\text{res}}$）相关联：\n$$ c_i^{\\text{in}} = c_i^{\\text{res}} \\exp(-z_i \\psi_D) $$\n外部溶液的浓度为：$[\\text{H}^+]_{\\text{res}} = 10^{-pH_{\\text{res}}}$，$[\\text{OH}^-]_{\\text{res}} = K_w / [\\text{H}^+]_{\\text{res}}$，$c_+^{\\text{res}} = c_s$，以及 $c_-^{\\text{res}} = c_s$。应用Donnan关系可得：\n$$ [\\text{H}^+]_{\\text{in}} = [\\text{H}^+]_{\\text{res}} e^{-\\psi_D} $$\n$$ [\\text{OH}^-]_{\\text{in}} = [\\text{OH}^-]_{\\text{res}} e^{\\psi_D} $$\n$$ c_+^{\\text{in}} = c_s e^{-\\psi_D} $$\n$$ c_-^{\\text{in}} = c_s e^{\\psi_D} $$\n将这些代入电中性方程，得到：\n$$ \\left( [\\text{H}^+]_{\\text{res}} + c_s \\right) e^{-\\psi_D} - \\left( [\\text{OH}^-]_{\\text{res}} + c_s \\right) e^{\\psi_D} - c_f = 0 $$\n\n固定电荷浓度 $c_f$ 源于聚合物网络上酸基团的解离。它由 $c_f = \\alpha C_A^{\\mathrm{dry}} \\phi$ 给出，其中 $\\alpha$ 是电离度，$C_A^{\\mathrm{dry}}$ 是每单位干聚合物体积的可滴定酸位点浓度，$\\phi$ 是聚合物体积分数。\n\n电离度 $\\alpha$ 由酸解离平衡决定，这取决于凝胶内部的局部质子浓度 $[\\text{H}^+]_{\\text{in}}$。该关系由Henderson-Hasselbalch型方程给出：\n$$ \\frac{\\alpha}{1-\\alpha} = \\frac{K_a}{[\\text{H}^+]_{\\text{in}}} $$\n可以重新排列此式，将 $\\alpha$ 表示为 $[\\text{H}^+]_{\\text{in}}$ 的函数：\n$$ \\alpha = \\frac{K_a}{K_a + [\\text{H}^+]_{\\text{in}}} $$\n由于 $[\\text{H}^+]_{\\text{in}}$ 本身依赖于 $\\psi_D$，$\\alpha$ 也成为 $\\psi_D$ 的函数：\n$$ \\alpha(\\psi_D) = \\frac{K_a}{K_a + [\\text{H}^+]_{\\text{res}} e^{-\\psi_D}} $$\n\n通过将 $c_f$ 和 $\\alpha(\\psi_D)$ 的表达式代入电中性方程，我们得到了一个关于未知数 $\\psi_D$ 的非线性标量方程：\n$$ f(\\psi_D) = \\left( [\\text{H}^+]_{\\text{res}} + c_s \\right) e^{-\\psi_D} - \\left( [\\text{OH}^-]_{\\text{res}} + c_s \\right) e^{\\psi_D} - \\frac{K_a C_A^{\\mathrm{dry}} \\phi}{K_a + [\\text{H}^+]_{\\text{res}} e^{-\\psi_D}} = 0 $$\n该方程必须为 $\\psi_D$ 进行数值求解。函数 $f(\\psi_D)$ 是连续且单调递减的，因为其导数 $f'(\\psi_D)$ 对所有 $\\psi_D \\in \\mathbb{R}$ 都严格为负。此外，$\\lim_{\\psi_D \\to -\\infty} f(\\psi_D) = +\\infty$ 且 $\\lim_{\\psi_D \\to +\\infty} f(\\psi_D) = -\\infty$。这些性质保证了唯一根的存在。\n\n数值策略如下：\n1. 对于每组参数 $(K_a, pH_{\\mathrm{res}}, c_s, \\phi, C_A^{\\mathrm{dry}})$，首先计算恒定的槽内浓度：$[\\text{H}^+]_{\\text{res}} = 10^{-pH_{\\mathrm{res}}}$ 和 $[\\text{OH}^-]_{\\text{res}} = 10^{-14} / [\\text{H}^+]_{\\text{res}}$。\n2. 定义如上推导的函数 $f(\\psi_D)$。\n3. 采用稳健的区间求根算法，例如Brent方法，找到方程 $f(\\psi_D) = 0$ 的唯一根 $\\psi_D^*$。一个足够大的搜索区间，如 $[-50, 50]$，将可靠地包围根。\n4. 一旦确定了根 $\\psi_D^*$，使用Donnan电势的值计算电离度 $\\alpha$：\n$$ \\alpha = \\frac{K_a}{K_a + [\\text{H}^+]_{\\text{res}} e^{-\\psi_D^*}} $$\n5. 每个用例的最终结果是此 $\\alpha$ 值，按要求格式化。\n\n此过程为求解提供了完整而正确的路径。程序的实现将精确遵循此算法。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves for the degree of ionization alpha for a series of polyelectrolyte gel test cases.\n    \"\"\"\n    # Define constants\n    K_w = 1e-14  # Ionic product of water in (mol/L)^2\n\n    # Test cases: (K_a, pH_res, c_s, phi, C_A_dry)\n    # Units: K_a (mol/L), pH_res (-), c_s (mol/L), phi (-), C_A_dry (mol/L_polymer)\n    test_cases = [\n        (1e-5, 7.0, 0.1, 0.05, 10.0),    # Case A\n        (1e-5, 7.0, 0.0, 0.05, 10.0),    # Case B\n        (1e-6, 3.0, 0.1, 0.05, 10.0),    # Case C\n        (1e-4, 10.0, 0.01, 0.01, 10.0),   # Case D\n        (1e-5, 7.0, 0.1, 0.3, 8.0)       # Case E\n    ]\n\n    results = []\n    \n    # Bracket for root-finding. Analysis shows the function is monotonic and crosses\n    # zero, so a wide bracket is safe. Physically, |psi_D| > 20 is rare.\n    psi_d_bracket = [-50.0, 50.0]\n\n    for case in test_cases:\n        K_a, pH_res, c_s, phi, C_A_dry = case\n\n        # Step 1: Calculate reservoir concentrations\n        H_res = 10**(-pH_res)\n        OH_res = K_w / H_res\n\n        # Step 2: Define the electroneutrality function f(psi_D) = 0\n        def electroneutrality_func(psi_d):\n            \"\"\"\n            This function represents the electroneutrality condition inside the gel.\n            The root of this function is the equilibrium Donnan potential.\n            f(psi_d) = (sum of positive charges) - (sum of negative charges)\n            \"\"\"\n            exp_neg_psi = np.exp(-psi_d)\n            exp_pos_psi = np.exp(psi_d)\n            \n            # Term 1: Mobile positive ions (H+ and salt cations)\n            positive_mobile_charge = (H_res + c_s) * exp_neg_psi\n            \n            # Term 2: Mobile negative ions (OH- and salt anions)\n            negative_mobile_charge = (OH_res + c_s) * exp_pos_psi\n\n            # Term 3: Fixed negative charges on the polymer network\n            # alpha(psi_d) = K_a / (K_a + H_in) where H_in = H_res * exp(-psi_d)\n            # c_f = alpha * C_A_dry * phi\n            fixed_charge_density = (K_a * C_A_dry * phi) / (K_a + H_res * exp_neg_psi)\n            \n            return positive_mobile_charge - negative_mobile_charge - fixed_charge_density\n\n        # Step 3: Find the root for psi_D\n        try:\n            psi_d_root = brentq(electroneutrality_func, psi_d_bracket[0], psi_d_bracket[1])\n        except ValueError:\n            # This should not happen if the analysis of the function is correct.\n            # Handle potential failure for robustness.\n            results.append(float('nan'))\n            continue\n\n        # Step 4: Calculate the degree of ionization alpha\n        H_in = H_res * np.exp(-psi_d_root)\n        alpha = K_a / (K_a + H_in)\n        \n        # Step 5: Store the result, rounded to six decimal places\n        results.append(round(alpha, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2930238"}, {"introduction": "最后一项实践通过将参数估计构建为一个反问题，从而在理论建模与实验现实之间架起一座桥梁。你将利用凝胶在混合溶剂体系中的模拟溶胀数据，来提取底层的聚合物-溶剂相互作用参数 $\\chi_{P1}$ 和 $\\chi_{P2}$ [@problem_id:2930302]。本练习介绍了加权最小二乘回归和参数可辨识性评估等强大的数据分析技术，这些都是现代科学研究中不可或缺的技能。", "problem": "当一个交联聚合物网络（凝胶）浸入小分子溶剂浴中时，由于混合热力学与网络弹性之间的平衡，它会发生溶胀。考虑一个在恒定温度下的凝胶，置于一个由两种理想小分子溶剂（标记为组分1和组分2）组成的大溶剂浴中，其溶剂浴摩尔分数分别为 $x_1$ 和 $x_2 = 1 - x_1$。令 $\\phi$ 表示溶胀平衡状态下凝胶中的聚合物体积分数。假设存在以下建模要素。\n\n- 混合自由能密度由 Flory-Huggins (FH) 理论描述，凝胶弹性由高斯网络弹性理论描述。在这些假设下，凝胶在单位活度的小分子大溶剂浴中溶胀的 Flory-Rehner (FR) 平衡条件可以写成以下典范形式\n$$\n\\ln(1 - \\phi) + \\phi + \\chi_{\\mathrm{eff}}\\, \\phi^2 + C \\left(\\phi^{1/3} - \\frac{\\phi}{2}\\right) = 0,\n$$\n其中 $C$ 是一个已知的正常数，其值与溶剂参考摩尔体积和弹性活性网络链密度的乘积成正比，而 $\\chi_{\\mathrm{eff}}$ 是聚合物所感受到的溶剂浴的有效聚合物-溶剂相互作用参数。\n- 有效相互作用参数被建模为各组分的线性组成平均值，\n$$\n\\chi_{\\mathrm{eff}} = x_1 \\chi_{P1} + x_2 \\chi_{P2},\n$$\n其中 $\\chi_{P1}$ 和 $\\chi_{P2}$ 分别是聚合物与组分1和组分2之间的特定组分Flory-Huggins相互作用参数。\n\n您的任务是提出并解决一个逆问题，根据在不同溶剂浴组分下进行的多组溶胀测量 $(x_{1,j}, \\phi_j)$ 来估计 $(\\chi_{P1}, \\chi_{P2})$。您还必须在 $\\phi$ 存在实验噪声的情况下，量化 $(\\chi_{P1}, \\chi_{P2})$ 的可辨识性。\n\n从上述的 Flory-Rehner 平衡条件出发，完成以下步骤。\n\n1) 推导一个能分离出标量函数 $y(\\phi)$ 的显式表达式，使得在给定的建模假设下，对于每次测量 $j$，都满足\n$$\ny(\\phi_j) \\approx x_{1,j}\\,\\chi_{P1} + x_{2,j}\\,\\chi_{P2},\n$$\n的关系。目标是将此逆问题转换为一个关于未知数 $(\\chi_{P1}, \\chi_{P2})$ 的线性回归问题。\n\n2) 推导在 $\\phi_j$ 处求值的灵敏度 $\\frac{dy}{d\\phi}$，并利用一阶（线性）误差传播，在给定 $\\phi_j$ 的已知测量标准差 $\\sigma_{\\phi,j}$ 的情况下，表达转换后响应的近似标准差 $\\sigma_{y,j}$，\n$$\n\\sigma_{y,j} \\approx \\left|\\frac{dy}{d\\phi}(\\phi_j)\\right| \\sigma_{\\phi,j},\n$$\n\n3) 提出并实现一个针对 $(\\chi_{P1}, \\chi_{P2})$ 的加权最小二乘估计器，使用权重 $w_j = 1/\\sigma_{y,j}^2$。将加权正规矩阵的逆矩阵作为参数协方差矩阵进行计算，并提取其对角线元素的平方根作为估计值的标准误差。\n\n4) 定义一个同时取决于设计几何和噪声水平的可辨识性准则，如下所示。令 $\\mathbf{X}$ 为一个 $N \\times 2$ 的设计矩阵，其列为 $[x_{1,j}]$ 和 $[x_{2,j}]$，并令 $\\mathbf{W} = \\text{diag}(w_1,\\dots,w_N)$。构造加权设计矩阵 $\\mathbf{X}_w = \\mathbf{W}^{1/2}\\mathbf{X}$ 并计算其谱条件数 $\\kappa = \\kappa_2(\\mathbf{X}_w)$。如果以下两个条件都满足，则声明参数对 $(\\chi_{P1}, \\chi_{P2})$ 是可辨识的：\n- $\\kappa \\le 10^4$，\n- 每个参数的估计标准误差小于 0.05。\n否则，声明其不可辨识。\n\n本问题中的所有量均为无量纲。\n\n在一个程序中实现上述估计器和可辨识性测试，该程序能处理以下测试套件。对于每个测试用例，您将获得弹性常数 $C$、溶剂浴摩尔分数 $x_1$ 列表、相应的测量聚合物体积分数 $\\phi$ 以及该用例中所有数据点的通用测量标准差 $\\sigma_\\phi$。\n\n使用以下测试套件。\n- 测试用例A（组分分布广泛，低噪声）：\n  - $C = 0.005$,\n  - $x_1 = [0.05, 0.25, 0.50, 0.75, 0.95]$,\n  - $\\phi = [0.220, 0.180, 0.140, 0.110, 0.095]$,\n  - $\\sigma_\\phi = 0.003$.\n- 测试用例B（组分分布狭窄，中等噪声）：\n  - $C = 0.005$,\n  - $x_1 = [0.45, 0.48, 0.52, 0.55]$,\n  - $\\phi = [0.142, 0.141, 0.139, 0.138]$,\n  - $\\sigma_\\phi = 0.004$.\n- 测试用例C（数据量最少，较高噪声）：\n  - $C = 0.005$,\n  - $x_1 = [0.20, 0.80]$,\n  - $\\phi = [0.190, 0.100]$,\n  - $\\sigma_\\phi = 0.010$.\n\n您的程序必须为每个测试用例计算：\n- 加权最小二乘估计值 $\\widehat{\\chi}_{P1}$ 和 $\\widehat{\\chi}_{P2}$，\n- $\\mathbf{X}_w$ 的谱条件数 $\\kappa$，\n- 可辨识性判定（布尔值）。\n\n最终输出格式：\n- 对于每个测试用例，返回一个形式为 $[\\widehat{\\chi}_{P1}, \\widehat{\\chi}_{P2}, \\kappa, \\text{identifiable}]$ 的列表，其中前三项是四舍五入到六位小数的浮点数，最后一项是布尔值。\n- 将三个测试用例的结果汇总到一个列表中，并精确地打印一行包含此列表的 Python 列表字面量形式。例如，一个有效的输出格式是\n$[[\\text{float},\\text{float},\\text{float},\\text{bool}],[\\text{float},\\text{float},\\text{float},\\text{bool}],[\\text{float},\\text{float},\\text{float},\\text{bool}]]$。", "solution": "该问题陈述在科学上是合理的、适定的，并提供了继续进行所需的所有必要信息。它基于已建立的关于聚合物凝胶溶胀的 Flory-Rehner 理论，这是聚合物物理学中的一个标准课题。这些任务涉及推导和数值实现的逻辑序列，构成了一个有效且实质性的问题。\n\n解决方案按要求分四个阶段进行：1) 线性回归模型的推导，2) 误差传播公式的推导，3) 加权最小二乘估计器的说明，以及 4) 可辨识性准则的定义。\n\n**1. 模型的线性化**\n出发点是在溶剂浴中溶胀的凝胶的Flory-Rehner (FR) 平衡条件：\n$$\n\\ln(1 - \\phi) + \\phi + \\chi_{\\mathrm{eff}}\\, \\phi^2 + C \\left(\\phi^{1/3} - \\frac{\\phi}{2}\\right) = 0\n$$\n在此，$\\phi$ 是聚合物体积分数，$C$ 是弹性常数，$\\chi_{\\mathrm{eff}}$ 是有效的聚合物-溶剂相互作用参数。问题陈述指出，对于一个摩尔分数为 $x_1$ 和 $x_2=1-x_1$ 的二元溶剂混合物，有效相互作用参数被建模为线性平均：\n$$\n\\chi_{\\mathrm{eff}} = x_1 \\chi_{P1} + x_2 \\chi_{P2}\n$$\n其中 $\\chi_{P1}$ 和 $\\chi_{P2}$ 是待估计的参数。\n\n为了将其转换为线性回归问题，我们必须从 FR 方程中分离出 $\\chi_{\\mathrm{eff}}$。假设 $\\phi \\neq 0$，我们可以如下重排各项：\n$$\n\\chi_{\\mathrm{eff}}\\, \\phi^2 = -\\left[ \\ln(1 - \\phi) + \\phi + C \\left(\\phi^{1/3} - \\frac{\\phi}{2}\\right) \\right]\n$$\n两边除以 $\\phi^2$ 即可得到一个用可测量量 $\\phi$ 和已知常数 $C$ 表示的 $\\chi_{\\mathrm{eff}}$ 表达式。我们将其定义为转换后的响应变量 $y(\\phi)$：\n$$\ny(\\phi) = -\\frac{1}{\\phi^2} \\left[ \\ln(1 - \\phi) + \\phi + C \\left(\\phi^{1/3} - \\frac{\\phi}{2}\\right) \\right]\n$$\n对于每次测量 $j$，我们可以计算出一个值 $y_j = y(\\phi_j)$。通过将其与 $\\chi_{\\mathrm{eff},j}$ 的模型相结合，我们得到了所需的线性关系：\n$$\ny(\\phi_j) \\approx x_{1,j}\\,\\chi_{P1} + (1-x_{1,j})\\,\\chi_{P2}\n$$\n该方程具有线性模型的形式，从而可以使用线性回归技术来估计未知参数 $\\chi_{P1}$ 和 $\\chi_{P2}$。\n\n**2. 误差传播**\n$\\phi_j$ 的实验测量会受到噪声的影响，其特征是标准差为 $\\sigma_{\\phi,j}$。这种不确定性会传播到计算出的响应变量 $y_j$ 中。使用一阶泰勒展开（线性误差传播），$y_j$ 的方差由下式给出：\n$$\n\\sigma_{y,j}^2 \\approx \\left(\\frac{dy}{d\\phi}\\bigg|_{\\phi_j}\\right)^2 \\sigma_{\\phi,j}^2 \\implies \\sigma_{y,j} \\approx \\left|\\frac{dy}{d\\phi}(\\phi_j)\\right| \\sigma_{\\phi,j}\n$$\n为应用此公式，我们必须计算导数 $\\frac{dy}{d\\phi}$。我们可以将 $y(\\phi)$ 写为：\n$$\ny(\\phi) = -\\phi^{-2}\\ln(1-\\phi) - \\phi^{-1} - C \\phi^{-5/3} + \\frac{C}{2}\\phi^{-1}\n$$\n对 $\\phi$ 逐项求导可得：\n$$\n\\frac{dy}{d\\phi} = \\left( 2\\phi^{-3}\\ln(1-\\phi) + \\frac{\\phi^{-2}}{1-\\phi} \\right) + \\phi^{-2} + \\frac{5C}{3}\\phi^{-8/3} - \\frac{C}{2}\\phi^{-2}\n$$\n合并具有共同代数结构的项，得到灵敏度的最终表达式：\n$$\n\\frac{dy}{d\\phi} = \\frac{2\\ln(1 - \\phi)}{\\phi^3} + \\frac{2-\\phi}{\\phi^2(1-\\phi)} - \\frac{C}{2\\phi^2} + \\frac{5C}{3\\phi^{8/3}}\n$$\n该导数在每个测量值 $\\phi_j$ 处求值后，我们便可以估算出转换后响应的标准差 $\\sigma_{y,j}$。\n\n**3. 加权最小二乘 (WLS) 估计**\n对于 $N$ 次测量，该线性系统可以写成矩阵形式 $\\mathbf{y} \\approx \\mathbf{X}\\boldsymbol{\\beta}$，其中：\n- $\\mathbf{y} = [y(\\phi_1), \\dots, y(\\phi_N)]^T$ 是转换后响应的向量。\n- $\\mathbf{X}$ 是 $N \\times 2$ 的设计矩阵，其第 $j$ 行为 $[x_{1,j}, 1-x_{1,j}]$。\n- $\\boldsymbol{\\beta} = [\\chi_{P1}, \\chi_{P2}]^T$ 是未知参数的向量。\n\n由于不确定性 $\\sigma_{y,j}$ 不均匀，噪声是异方差的。合适的估计器是加权最小二乘 (WLS)，它为方差较小的数据点赋予更大的权重。权重为 $w_j = 1/\\sigma_{y,j}^2$，构成对角权重矩阵 $\\mathbf{W} = \\mathrm{diag}(w_j)$。\n\n参数的 WLS 估计值 $\\widehat{\\boldsymbol{\\beta}}$ 由以下正规方程组的解给出：\n$$\n\\widehat{\\boldsymbol{\\beta}} = (\\mathbf{X}^T \\mathbf{W} \\mathbf{X})^{-1} \\mathbf{X}^T \\mathbf{W} \\mathbf{y}\n$$\n该估计的统计不确定性由参数协方差矩阵捕获，对于 WLS 而言，该矩阵是加权正规矩阵的逆：\n$$\n\\mathrm{Cov}(\\widehat{\\boldsymbol{\\beta}}) = (\\mathbf{X}^T \\mathbf{W} \\mathbf{X})^{-1}\n$$\n估计参数的标准误差 $\\sigma_{\\widehat{\\chi}_{P1}}$ 和 $\\sigma_{\\widehat{\\chi}_{P2}}$ 是此协方差矩阵对角线元素的平方根。\n\n**4. 可辨识性准则**\n可靠地确定 $\\chi_{P1}$ 和 $\\chi_{P2}$ 的能力取决于两个因素：实验设计（$x_1$ 值的分布范围）和噪声水平。\n- **数值稳定性：** 最小二乘问题的条件是通过加权设计矩阵 $\\mathbf{X}_w = \\mathbf{W}^{1/2}\\mathbf{X}$ 的谱条件数 $\\kappa = \\kappa_2(\\mathbf{X}_w)$ 来评估的。大的 $\\kappa$ 值表明 $\\mathbf{X}_w$ 的列近似线性相关，这使得解对数据中的小扰动高度敏感。问题指定了一个阈值 $\\kappa \\le 10^4$。\n- **统计显著性：** 只有当估计参数的标准误差相对于其量值较小时，这些参数才有意义。问题指定每个参数的标准误差必须小于 0.05。\n\n当且仅当 $\\kappa \\le 10^4$ 且两个标准误差都小于 0.05 这两个条件都满足时，参数对 $(\\chi_{P1}, \\chi_{P2})$ 才被认为是可辨识的。\n\n**算法总结**\n对于每个测试用例，执行以下程序：\n1.  使用提供的数据 $(\\phi_j, C)$ 和推导出的 $y(\\phi)$ 公式，计算转换后响应的向量 $\\mathbf{y}$。\n2.  计算灵敏度向量 $\\frac{d\\mathbf{y}}{d\\phi}$ 并传播测量误差 $\\sigma_\\phi$ 以找到响应误差 $\\sigma_{y,j}$。\n3.  计算权重 $w_j=1/\\sigma_{y,j}^2$ 并构造设计矩阵 $\\mathbf{X}$ 和权重矩阵 $\\mathbf{W}$。\n4.  求解 WLS 系统以获得参数估计值 $\\widehat{\\boldsymbol{\\beta}} = [\\widehat{\\chi}_{P1}, \\widehat{\\chi}_{P2}]^T$。\n5.  计算参数协方差矩阵并提取标准误差。\n6.  构造加权设计矩阵 $\\mathbf{X}_w$ 并计算其谱条件数 $\\kappa$。\n7.  应用双重可辨识性准则来确定参数是否可辨识。\n8.  按规定收集并格式化结果。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for Flory-Huggins parameters from swelling data using weighted least squares\n    and assesses parameter identifiability.\n    \"\"\"\n\n    test_cases = [\n        {\n            'C': 0.005,\n            'x1': [0.05, 0.25, 0.50, 0.75, 0.95],\n            'phi': [0.220, 0.180, 0.140, 0.110, 0.095],\n            'sigma_phi': 0.003\n        },\n        {\n            'C': 0.005,\n            'x1': [0.45, 0.48, 0.52, 0.55],\n            'phi': [0.142, 0.141, 0.139, 0.138],\n            'sigma_phi': 0.004\n        },\n        {\n            'C': 0.005,\n            'x1': [0.20, 0.80],\n            'phi': [0.190, 0.100],\n            'sigma_phi': 0.010\n        }\n    ]\n\n    all_results = []\n\n    for case_data in test_cases:\n        C = case_data['C']\n        x1_vec = np.array(case_data['x1'])\n        phi_vec = np.array(case_data['phi'])\n        sigma_phi = case_data['sigma_phi']\n        \n        # Step 1: Calculate the transformed response variable y(phi)\n        term_log = np.log(1 - phi_vec)\n        term_elastic = C * (phi_vec**(1/3) - phi_vec / 2)\n        y_vec = -(term_log + phi_vec + term_elastic) / phi_vec**2\n        \n        # Step 2: Calculate the sensitivity dy/dphi and propagate error\n        dydphi_vec = (2 * np.log(1 - phi_vec) / phi_vec**3 +\n                      (2 - phi_vec) / (phi_vec**2 * (1 - phi_vec)) -\n                      C / (2 * phi_vec**2) +\n                      5 * C / (3 * phi_vec**(8/3)))\n        sigma_y_vec = np.abs(dydphi_vec) * sigma_phi\n        \n        # Step 3: Set up and solve the Weighted Least Squares problem\n        w_vec = 1 / sigma_y_vec**2\n        W = np.diag(w_vec)\n        \n        x2_vec = 1 - x1_vec\n        X = np.stack([x1_vec, x2_vec], axis=1)\n        \n        # Normal matrix for WLS\n        X_T_W_X = X.T @ W @ X\n        \n        # Right-hand side vector\n        X_T_W_y = X.T @ W @ y_vec\n        \n        # It is assumed the matrix is invertible for the given test cases.\n        # Solve for parameter estimates\n        beta_hat = np.linalg.solve(X_T_W_X, X_T_W_y)\n        chi_P1_hat, chi_P2_hat = beta_hat\n        \n        # Calculate covariance matrix and standard errors\n        cov_beta = np.linalg.inv(X_T_W_X)\n        std_err = np.sqrt(np.diag(cov_beta))\n        \n        # Step 4: Assess identifiability\n        W_sqrt = np.diag(np.sqrt(w_vec))\n        X_w = W_sqrt @ X\n        kappa = np.linalg.cond(X_w, p=2)\n        \n        # Apply identifiability criteria\n        is_identifiable = (kappa <= 1e4) and (std_err[0] < 0.05) and (std_err[1] < 0.05)\n        \n        result = [\n            round(chi_P1_hat, 6),\n            round(chi_P2_hat, 6),\n            round(kappa, 6),\n            bool(is_identifiable)\n        ]\n        all_results.append(result)\n\n    print(f\"{all_results}\")\n\nsolve()\n```", "id": "2930302"}]}