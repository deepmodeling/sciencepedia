{"hands_on_practices": [{"introduction": "在静态光散射实验中，最基础也是最关键的一步是将探测器记录的原始光子计数率转换为具有明确物理意义的量——超额瑞利比 $R_{\\text{ex}}(\\theta)$。本练习将指导你完成这一数据处理的核心流程，包括扣除暗计数和杂散光等背景信号，并应用仪器常数进行校准。通过这个实践，你不仅将掌握数据处理的基本方法，还将学会如何严谨地进行误差传递分析，为后续的所有分析奠定坚实的基础 [@problem_id:2928743]。", "problem": "您的任务是构建一个程序，从第一性原理出发，实现静态光散射 (SLS) 测量中过剩瑞利比的构建，并传播相关的不确定度。目标是计算聚合物溶液的过剩瑞利比，其定义为在散射角 $\\theta$ 处，溶液的瑞利比与在相同光学几何条件下测得的纯溶剂的瑞利比之差。您的程序必须基于每次测量，对原始测量强度进行暗计数和杂散光校正，并使用一个校准常数将校正后的计数率转换为瑞利比。您还必须在所有输入量均为统计独立且服从高斯分布的假设下，传播标准不确定度。\n\n使用以下基本定义作为起点：\n- 瑞利比 $R(\\theta)$ 是指在距离 $r$ 处，单位立体角的散射强度经入射强度归一化后的值，其在扣除背景后与仪器记录的计数率成正比。仪器校准将几何和通量因子合并为一个校准常数。\n- 过剩瑞利比定义为 $R_{\\text{ex}}(\\theta) = R_{\\text{solution}}(\\theta) - R_{\\text{solvent}}(\\theta)$。\n- 在应用校准之前，必须对在相同条件下测得的原始记录计数率进行暗计数和杂散光贡献的校正。\n- 对于独立变量 $\\{x_i\\}$，函数 $f(\\{x_i\\})$ 的一阶（线性）高斯不确定度传播公式为 $\\sigma_f^2 = \\sum_i \\left(\\frac{\\partial f}{\\partial x_i}\\right)^2 \\sigma_{x_i}^2$。\n\n您的程序必须实现的输入和建模假设：\n- 对于在散射角 $\\theta$（角度以度为单位给出）下的每次测量，仪器为聚合物溶液和纯溶剂提供以下数据：\n  - 测量计数率 $I_{\\mathrm{meas}}(\\theta)$（单位 $\\mathrm{cts/s}$）及其标准不确定度。\n  - 暗计数率 $D(\\theta)$（单位 $\\mathrm{cts/s}$）及其标准不确定度。\n  - 杂散光率 $S(\\theta)$（单位 $\\mathrm{cts/s}$）及其标准不确定度。\n- 校准常数 $C$ 通过公式 $R(\\theta) = C \\times I_{\\mathrm{net}}(\\theta)$ 将校正后的计数率（单位 $\\mathrm{cts/s}$）转换为瑞利比（单位 $\\mathrm{m^{-1}}$），其中净计数率为 $I_{\\mathrm{net}}(\\theta) = I_{\\mathrm{meas}}(\\theta) - D(\\theta) - S(\\theta)$。该校准常数自身也带有标准不确定度。\n- 将所有报告的标准不确定度视为一倍标准差 (one-sigma) 值，并假设所有测量量之间统计独立。\n\n必要的计算：\n- 在每个 $\\theta$ 处，通过减去相应的暗计数率和杂散光率，计算聚合物溶液和溶剂的净计数率。\n- 使用校准常数 $C$ 将每个净计数率转换为瑞利比，然后求差值，以计算过剩瑞利比 $R_{\\text{ex}}(\\theta)$。\n- 使用一阶不确定度传播法，计算 $R_{\\text{ex}}(\\theta)$ 的标准不确定度。\n\n单位与报告：\n- 报告每个 $R_{\\text{ex}}(\\theta)$（单位 $\\mathrm{m^{-1}}$）及其相关的标准不确定度（单位 $\\mathrm{m^{-1}}$）。\n- 角度 $\\theta$ 以度为单位指定，为此计算目的无需进行转换。\n\n需实现的测试套件：\n提供一个程序，计算以下四种情况的结果。在每种情况下，所有计数率的单位为 $\\mathrm{cts/s}$，角度单位为度，校准常数的单位为 $\\mathrm{m^{-1}}\\cdot(\\mathrm{cts/s})^{-1}$。\n\n- 情况 $1$ (理想情况, $\\theta = 90^\\circ$):\n  - 聚合物溶液: $I_{\\mathrm{meas}} = 15230$, $\\sigma_{I} = 50$; $D = 120$, $\\sigma_D = 10$; $S = 30$, $\\sigma_S = 5$。\n  - 纯溶剂: $I_{\\mathrm{meas}} = 8120$, $\\sigma_{I} = 40$; $D = 118$, $\\sigma_D = 10$; $S = 32$, $\\sigma_S = 5$。\n  - 校准: $C = 2.1\\times 10^{-7}$, $\\sigma_C = 2.1\\times 10^{-9}$。\n\n- 情况 $2$ (近乎抵消, $\\theta = 60^\\circ$):\n  - 聚合物溶液: $I_{\\mathrm{meas}} = 10050$, $\\sigma_{I} = 60$; $D = 130$, $\\sigma_D = 8$; $S = 45$, $\\sigma_S = 6$。\n  - 纯溶剂: $I_{\\mathrm{meas}} = 10020$, $\\sigma_{I} = 60$; $D = 128$, $\\sigma_D = 8$; $S = 46$, $\\sigma_S = 6$。\n  - 校准: $C = 2.0\\times 10^{-7}$, $\\sigma_C = 3.0\\times 10^{-9}$。\n\n- 情况 $3$ (背景漂移, $\\theta = 30^\\circ$):\n  - 聚合物溶液: $I_{\\mathrm{meas}} = 4500$, $\\sigma_{I} = 30$; $D = 200$, $\\sigma_D = 15$; $S = 100$, $\\sigma_S = 12$。\n  - 纯溶剂: $I_{\\mathrm{meas}} = 4200$, $\\sigma_{I} = 30$; $D = 150$, $\\sigma_D = 15$; $S = 80$, $\\sigma_S = 12$。\n  - 校准: $C = 1.8\\times 10^{-7}$, $\\sigma_C = 2.0\\times 10^{-9}$。\n\n- 情况 $4$ (低计数，可能出现负过剩值, $\\theta = 120^\\circ$):\n  - 聚合物溶液: $I_{\\mathrm{meas}} = 500$, $\\sigma_{I} = 20$; $D = 50$, $\\sigma_D = 5$; $S = 30$, $\\sigma_S = 5$。\n  - 纯溶剂: $I_{\\mathrm{meas}} = 520$, $\\sigma_{I} = 20$; $D = 50$, $\\sigma_D = 5$; $S = 30$, $\\sigma_S = 5$。\n  - 校准: $C = 2.2\\times 10^{-7}$, $\\sigma_C = 2.2\\times 10^{-9}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由各情况列表组成的逗号分隔列表，每个内部列表包含两个浮点数：$\\left[R_{\\text{ex}}(\\theta), \\sigma_{R_{\\text{ex}}}(\\theta)\\right]$，其顺序与上述情况的顺序相同。\n- 例如，一个有效的输出格式如下所示：$\\left[[x_1,y_1],[x_2,y_2],[x_3,y_3],[x_4,y_4]\\right]$，其中每个 $x_i$ 和 $y_i$ 都是单位为 $\\mathrm{m^{-1}}$ 的浮点数。", "solution": "所提出的问题是一项实验数据分析的标准练习，特别是涉及静态光散射实验原始数据的归约以及相关不确定度的传播。该问题定义明确、科学上合理且内部一致。它要求将误差分析的基本原理应用于一次特定的物理测量。我们将着手推导必要的公式并加以实现。\n\n设在给定散射角 $\\theta$ 下，聚合物溶液的测量量用下标 `sol` 表示，纯溶剂的测量量用下标 `sv` 表示。提供的输入有：\n- 测量计数率：$I_{\\text{meas,sol}}$ 和 $I_{\\text{meas,sv}}$\n- 暗计数率：$D_{\\text{sol}}$ 和 $D_{\\text{sv}}$\n- 杂散光率：$S_{\\text{sol}}$ 和 $S_{\\text{sv}}$\n- 校准常数：$C$\n- 及其相应的标准不确定度：$\\sigma_{I,\\text{sol}}$, $\\sigma_{I,\\text{sv}}$, $\\sigma_{D,\\text{sol}}$, $\\sigma_{D,\\text{sv}}$, $\\sigma_{S,\\text{sol}}$, $\\sigma_{S,\\text{sv}}$ 和 $\\sigma_C$。\n\n这 $13$ 个输入量均被假设为统计独立的。\n第一步是计算溶液和溶剂的净计数率 $I_{\\text{net}}(\\theta)$。净计数率是经过背景贡献校正后的测量速率。\n对于聚合物溶液：\n$$I_{\\text{net,sol}} = I_{\\text{meas,sol}} - D_{\\text{sol}} - S_{\\text{sol}}$$\n对于纯溶剂：\n$$I_{\\text{net,sv}} = I_{\\text{meas,sv}} - D_{\\text{sv}} - S_{\\text{sv}}$$\n\n过剩瑞利比 $R_{\\text{ex}}(\\theta)$ 定义为溶液的瑞利比 $R_{\\text{sol}}(\\theta)$ 与溶剂的瑞利比 $R_{\\text{sv}}(\\theta)$ 之差。每个组分的瑞利比是通过将其净计数率乘以校准常数 $C$ 得到的。\n$$R_{\\text{sol}}(\\theta) = C \\cdot I_{\\text{net,sol}}$$\n$$R_{\\text{sv}}(\\theta) = C \\cdot I_{\\text{net,sv}}$$\n因此，过剩瑞利比为：\n$$R_{\\text{ex}}(\\theta) = R_{\\text{sol}}(\\theta) - R_{\\text{sv}}(\\theta) = C \\cdot I_{\\text{net,sol}} - C \\cdot I_{\\text{net,sv}}$$\n这可以简化为：\n$$R_{\\text{ex}}(\\theta) = C \\cdot (I_{\\text{net,sol}} - I_{\\text{net,sv}})$$\n将净计数率的表达式代入，我们得到以直接测量量表示的 $R_{\\text{ex}}(\\theta)$ 最终公式：\n$$R_{\\text{ex}}(\\theta) = C \\cdot \\left( (I_{\\text{meas,sol}} - D_{\\text{sol}} - S_{\\text{sol}}) - (I_{\\text{meas,sv}} - D_{\\text{sv}} - S_{\\text{sv}}) \\right)$$\n\n接下来，我们必须推导 $R_{\\text{ex}}(\\theta)$ 的标准不确定度（记为 $\\sigma_{R_{\\text{ex}}}$）的公式。我们使用针对独立变量 $\\{x_i\\}$ 的函数 $f$ 的一阶高斯误差传播公式：\n$$\\sigma_f^2 = \\sum_i \\left(\\frac{\\partial f}{\\partial x_i}\\right)^2 \\sigma_{x_i}^2$$\n在我们的情况中，函数是 $f = R_{\\text{ex}}(\\theta)$，独立变量集合为 $\\{x_i\\} = \\{C, I_{\\text{meas,sol}}, D_{\\text{sol}}, S_{\\text{sol}}, I_{\\text{meas,sv}}, D_{\\text{sv}}, S_{\\text{sv}}\\}$。\n\n我们必须计算 $R_{\\text{ex}}(\\theta)$ 对其中每个变量的偏导数。\n1. 对 $C$ 的导数：\n$$\\frac{\\partial R_{\\text{ex}}}{\\partial C} = (I_{\\text{meas,sol}} - D_{\\text{sol}} - S_{\\text{sol}}) - (I_{\\text{meas,sv}} - D_{\\text{sv}} - S_{\\text{sv}}) = I_{\\text{net,sol}} - I_{\\text{net,sv}}$$\n2. 对溶液测量量的导数：\n$$\\frac{\\partial R_{\\text{ex}}}{\\partial I_{\\text{meas,sol}}} = C$$\n$$\\frac{\\partial R_{\\text{ex}}}{\\partial D_{\\text{sol}}} = -C$$\n$$\\frac{\\partial R_{\\text{ex}}}{\\partial S_{\\text{sol}}} = -C$$\n3. 对溶剂测量量的导数：\n$$\\frac{\\partial R_{\\text{ex}}}{\\partial I_{\\text{meas,sv}}} = -C$$\n$$\\frac{\\partial R_{\\text{ex}}}{\\partial D_{\\text{sv}}} = C$$\n$$\\frac{\\partial R_{\\text{ex}}}{\\partial S_{\\text{sv}}} = C$$\n\n现在，我们将这些导数代入方差公式：\n$$\\sigma_{R_{\\text{ex}}}^2 = \\left(\\frac{\\partial R_{\\text{ex}}}{\\partial C}\\right)^2 \\sigma_C^2 + \\left(\\frac{\\partial R_{\\text{ex}}}{\\partial I_{\\text{meas,sol}}}\\right)^2 \\sigma_{I,\\text{sol}}^2 + \\left(\\frac{\\partial R_{\\text{ex}}}{\\partial D_{\\text{sol}}}\\right)^2 \\sigma_{D,\\text{sol}}^2 + \\left(\\frac{\\partial R_{\\text{ex}}}{\\partial S_{\\text{sol}}}\\right)^2 \\sigma_{S,\\text{sol}}^2 + \\ldots$$\n$$\\ldots + \\left(\\frac{\\partial R_{\\text{ex}}}{\\partial I_{\\text{meas,sv}}}\\right)^2 \\sigma_{I,\\text{sv}}^2 + \\left(\\frac{\\partial R_{\\text{ex}}}{\\partial D_{\\text{sv}}}\\right)^2 \\sigma_{D,\\text{sv}}^2 + \\left(\\frac{\\partial R_{\\text{ex}}}{\\partial S_{\\text{sv}}}\\right)^2 \\sigma_{S,\\text{sv}}^2$$\n代入偏导数的表达式：\n$$\\sigma_{R_{\\text{ex}}}^2 = (I_{\\text{net,sol}} - I_{\\text{net,sv}})^2 \\sigma_C^2 + (C)^2 \\sigma_{I,\\text{sol}}^2 + (-C)^2 \\sigma_{D,\\text{sol}}^2 + (-C)^2 \\sigma_{S,\\text{sol}}^2 + (-C)^2 \\sigma_{I,\\text{sv}}^2 + (C)^2 \\sigma_{D,\\text{sv}}^2 + (C)^2 \\sigma_{S,\\text{sv}}^2$$\n提出公因子 $C^2$：\n$$\\sigma_{R_{\\text{ex}}}^2 = (I_{\\text{net,sol}} - I_{\\text{net,sv}})^2 \\sigma_C^2 + C^2 \\left( \\sigma_{I,\\text{sol}}^2 + \\sigma_{D,\\text{sol}}^2 + \\sigma_{S,\\text{sol}}^2 \\right) + C^2 \\left( \\sigma_{I,\\text{sv}}^2 + \\sigma_{D,\\text{sv}}^2 + \\sigma_{S,\\text{sv}}^2 \\right)$$\n括号中的项是净计数率的方差。令 $\\sigma_{I_{\\text{net,sol}}}^2 = \\sigma_{I,\\text{sol}}^2 + \\sigma_{D,\\text{sol}}^2 + \\sigma_{S,\\text{sol}}^2$ 且 $\\sigma_{I_{\\text{net,sv}}}^2 = \\sigma_{I,\\text{sv}}^2 + \\sigma_{D,\\text{sv}}^2 + \\sigma_{S,\\text{sv}}^2$，因为每个净计数率的组成部分是独立的。过剩瑞利比的方差表达式简化为：\n$$\\sigma_{R_{\\text{ex}}}^2 = (I_{\\text{net,sol}} - I_{\\text{net,sv}})^2 \\sigma_C^2 + C^2 \\left( \\sigma_{I_{\\text{net,sol}}}^2 + \\sigma_{I_{\\text{net,sv}}}^2 \\right)$$\n标准不确定度是该方差的平方根：\n$$\\sigma_{R_{\\text{ex}}} = \\sqrt{ (I_{\\text{net,sol}} - I_{\\text{net,sv}})^2 \\sigma_C^2 + C^2 \\left( \\sigma_{I_{\\text{net,sol}}}^2 + \\sigma_{I_{\\text{net,sv}}}^2 \\right) }$$\n这是需要实现的最终公式。它正确地考虑了校准常数 $C$ 的不确定度在计算出的溶液和溶剂的瑞利比中引入了一个相关的误差分量，而溶液和溶剂的计数统计是独立的这一事实。\n\n待构建的程序将直接实现这些推导出的公式。对于每个测试用例，程序将：\n1. 计算 $I_{\\text{net,sol}}$ 和 $I_{\\text{net,sv}}$。\n2. 使用净计数率的差值计算 $R_{\\text{ex}}(\\theta)$。\n3. 计算方差 $\\sigma_{I_{\\text{net,sol}}}^2$ 和 $\\sigma_{I_{\\text{net,sv}}}^2$。\n4. 计算最终方差 $\\sigma_{R_{\\text{ex}}}^2$ 并取其平方根求得 $\\sigma_{R_{\\text{ex}}}$。\n5. 报告每种情况下的配对 $[R_{\\text{ex}}, \\sigma_{R_{\\text{ex}}}]$。\n该实现将采用过程化方法，将这些步骤系统地应用于问题中提供的每个数据集。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the excess Rayleigh ratio and its uncertainty for a series of\n    Static Light Scattering (SLS) measurement cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (happy path, theta = 90 deg)\n        {\n            \"sol\": {\"I_meas\": 15230, \"s_I\": 50, \"D\": 120, \"s_D\": 10, \"S\": 30, \"s_S\": 5},\n            \"sv\": {\"I_meas\": 8120, \"s_I\": 40, \"D\": 118, \"s_D\": 10, \"S\": 32, \"s_S\": 5},\n            \"cal\": {\"C\": 2.1e-7, \"s_C\": 2.1e-9},\n        },\n        # Case 2 (near cancellation, theta = 60 deg)\n        {\n            \"sol\": {\"I_meas\": 10050, \"s_I\": 60, \"D\": 130, \"s_D\": 8, \"S\": 45, \"s_S\": 6},\n            \"sv\": {\"I_meas\": 10020, \"s_I\": 60, \"D\": 128, \"s_D\": 8, \"S\": 46, \"s_S\": 6},\n            \"cal\": {\"C\": 2.0e-7, \"s_C\": 3.0e-9},\n        },\n        # Case 3 (drifted backgrounds, theta = 30 deg)\n        {\n            \"sol\": {\"I_meas\": 4500, \"s_I\": 30, \"D\": 200, \"s_D\": 15, \"S\": 100, \"s_S\": 12},\n            \"sv\": {\"I_meas\": 4200, \"s_I\": 30, \"D\": 150, \"s_D\": 15, \"S\": 80, \"s_S\": 12},\n            \"cal\": {\"C\": 1.8e-7, \"s_C\": 2.0e-9},\n        },\n        # Case 4 (low counts, possible negative excess, theta = 120 deg)\n        {\n            \"sol\": {\"I_meas\": 500, \"s_I\": 20, \"D\": 50, \"s_D\": 5, \"S\": 30, \"s_S\": 5},\n            \"sv\": {\"I_meas\": 520, \"s_I\": 20, \"D\": 50, \"s_D\": 5, \"S\": 30, \"s_S\": 5},\n            \"cal\": {\"C\": 2.2e-7, \"s_C\": 2.2e-9},\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        # Extract data for solution (sol), solvent (sv), and calibration (cal)\n        sol_data = case[\"sol\"]\n        sv_data = case[\"sv\"]\n        cal_data = case[\"cal\"]\n\n        # Step 1: Compute net count rates for solution and solvent\n        I_net_sol = sol_data[\"I_meas\"] - sol_data[\"D\"] - sol_data[\"S\"]\n        I_net_sv = sv_data[\"I_meas\"] - sv_data[\"D\"] - sv_data[\"S\"]\n\n        # Step 2: Compute excess Rayleigh ratio, R_ex\n        C = cal_data[\"C\"]\n        delta_I_net = I_net_sol - I_net_sv\n        R_ex = C * delta_I_net\n\n        # Step 3: Compute variances of the net count rates\n        var_I_net_sol = sol_data[\"s_I\"]**2 + sol_data[\"s_D\"]**2 + sol_data[\"s_S\"]**2\n        var_I_net_sv = sv_data[\"s_I\"]**2 + sv_data[\"s_D\"]**2 + sv_data[\"s_S\"]**2\n\n        # Step 4: Compute variance of the excess Rayleigh ratio\n        # var(R_ex) = (I_net_sol - I_net_sv)^2 * var(C) + C^2 * (var(I_net_sol) + var(I_net_sv))\n        s_C = cal_data[\"s_C\"]\n        var_R_ex = (delta_I_net**2 * s_C**2) + (C**2 * (var_I_net_sol + var_I_net_sv))\n        \n        # Final uncertainty is the square root of the variance\n        s_R_ex = np.sqrt(var_R_ex)\n\n        results.append([R_ex, s_R_ex])\n\n    # Format the final output string exactly as required\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2928743"}, {"introduction": "真实的聚合物样品几乎总是多分散的，即由不同分子量的链组成，理解静态光散射如何“平均”这些性质至关重要。本练习通过分析一个双峰混合物，引导你推导并计算静态光散射测得的表观分子量和回转半径，揭示它们分别对应重均分子量 $M_w$ 和 z-均回转半径 $R_{g,z}$ [@problem_id:2928726]。", "problem": "一个由两种单分散聚合物组成的稀二元混合物通过静态光散射 (SLS) 和 Zimm 图 (Zimm 分析) 进行分析。该溶液在一种溶剂中制备，在该测量浓度下，颗粒间的相互作用可以忽略不计（第二维里系数可视为零），两种组分的折射率增量相同，且单次散射条件成立。每条链的散射振幅与其质量成正比，对于较小的散射矢量大小 $q$，单链形状因子允许进行关于 $q^{2}$ 的主导阶展开。该混合物包含组分 $1$ 和 $2$，其摩尔质量分别为 $M_{1}$ 和 $M_{2}$，回旋半径分别为 $R_{g,1}$ 和 $R_{g,2}$，质量分数（相对于总溶质质量）分别为 $w_{1}$ 和 $w_{2}$，且 $w_{1}+w_{2}=1$。从独立颗粒散射强度的可加性和单链形状因子的小 $q$ 展开出发，推导在多分散混合物的 Zimm 分析中，由截距和初始角斜率（当 $q \\to 0$ 时）给出的表观重均摩尔质量和 z-均回旋半径的表达式。然后，对以下混合物，对这些表达式进行数值计算：\n- $M_{1} = 1.00 \\times 10^{5}$ $\\mathrm{g\\,mol^{-1}}$, $R_{g,1} = 12.0$ $\\mathrm{nm}$,\n- $M_{2} = 1.00 \\times 10^{6}$ $\\mathrm{g\\,mol^{-1}}$, $R_{g,2} = 38.0$ $\\mathrm{nm}$,\n- $w_{1} = 0.70$, $w_{2} = 0.30$。\n\n报告表观重均摩尔质量 $M_{w}$（单位为 $\\mathrm{g\\,mol^{-1}}$）和 z-均回旋半径 $R_{g,z}$（单位为 $\\mathrm{nm}$）。将两个数值答案四舍五入到三位有效数字。", "solution": "该问题要求从多分散聚合物混合物的静态光散射 (SLS) 分析中，推导重均摩尔质量 $M_w$ 和 z-均回旋半径 $R_{g,z}$ 的表达式，然后对一个特定的二元混合物进行数值计算。该问题已经过验证，科学上合理，提法明确，并包含了所有必要信息。\n\n稀聚合物溶液静态光散射的基本方程是 Zimm 方程。对于一个总溶质质量浓度为 $c$ 的多分散体系，并假设第二维里系数 $A_2$ 为零（如给定溶剂所述），该方程为：\n$$ \\frac{K c}{R_\\theta(q)} = \\frac{1}{\\sum_{i} w_i M_i P_i(q)} $$\n其中 $K$ 是一个光学常数，取决于溶剂折射率、波长和折射率增量 $dn/dc$（假设对所有组分都恒定），$R_\\theta(q)$ 是在散射矢量大小 $q$ 处的超额瑞利比，$w_i$ 是组分 $i$ 的质量分数，$M_i$ 是其摩尔质量，$P_i(q)$ 是其单链形状因子。散射矢量大小与散射角 $\\theta$ 的关系为 $q = \\frac{4\\pi n}{\\lambda} \\sin(\\frac{\\theta}{2})$，其中 $n$ 是溶剂的折射率，$\\lambda$ 是入射光的真空波长。\n\n问题指出，对于小的 $q$，单链形状因子可以展开为关于 $q^2$ 的主导阶。这就是 Guinier 近似：\n$$ P_i(q) \\approx 1 - \\frac{q^2 R_{g,i}^2}{3} $$\n其中 $R_{g,i}$ 是组分 $i$ 的回旋半径。\n\n将此展开式代入 Zimm 方程的分母，得到：\n$$ \\sum_i w_i M_i P_i(q) \\approx \\sum_i w_i M_i \\left(1 - \\frac{q^2 R_{g,i}^2}{3}\\right) = \\sum_i w_i M_i - \\frac{q^2}{3} \\sum_i w_i M_i R_{g,i}^2 $$\n第一项 $\\sum_i w_i M_i$ 根据定义是重均摩尔质量 $M_w$。\n$$ M_w \\equiv \\frac{\\sum_i c_i M_i}{\\sum_i c_i} = \\sum_i \\frac{c_i}{c} M_i = \\sum_i w_i M_i $$\n所以分母变为 $M_w - \\frac{q^2}{3} \\sum_i w_i M_i R_{g,i}^2$。\n\n因此，对于小 $q$ 的 Zimm 方程为：\n$$ \\frac{K c}{R_\\theta(q)} \\approx \\frac{1}{M_w - \\frac{q^2}{3} \\sum_i w_i M_i R_{g,i}^2} $$\n为了以线性图的形式分析此表达式，我们对小 $q^2$ 进行泰勒展开，使用对于小 $x$ 的近似 $(1-x)^{-1} \\approx 1+x$：\n$$ \\frac{K c}{R_\\theta(q)} \\approx \\frac{1}{M_w} \\left( \\frac{1}{1 - \\frac{q^2}{3M_w} \\sum_i w_i M_i R_{g,i}^2} \\right) \\approx \\frac{1}{M_w} \\left( 1 + \\frac{q^2}{3M_w} \\sum_i w_i M_i R_{g,i}^2 \\right) $$\n该表达式表明，在 $q^2$ 较小时，$\\frac{K c}{R_\\theta(q)}$ 对 $q^2$ 的作图是线性的。\n\n在 Zimm 分析中，表观摩尔质量是通过外推到零散射角（$q \\to 0$）得到的。从推导的表达式可知：\n$$ \\lim_{q\\to 0} \\frac{K c}{R_\\theta(q)} = \\frac{1}{M_w} $$\n因此，通过 SLS 测量的表观摩尔质量是重均摩尔质量 $M_w$。第一个推导出的表达式是：\n$$ M_w = \\sum_i w_i M_i $$\n\n表观回旋半径由 $\\frac{K c}{R_\\theta(q)}$ 对 $q^2$ 作图的初始斜率确定。对于单分散体系，该方程为 $\\frac{K c}{R_\\theta(q)} \\approx \\frac{1}{M}(1 + \\frac{q^2 R_g^2}{3})$。初始斜率与截距之比为 $\\frac{R_g^2/ (3M)}{1/M} = \\frac{R_g^2}{3}$。\n对于我们的多分散体系，截距是 $I = \\frac{1}{M_w}$，相对于 $q^2$ 的初始斜率是 $S_{q^2} = \\frac{1}{3M_w^2} \\sum_i w_i M_i R_{g,i}^2$。斜率与截距之比得出：\n$$ \\frac{S_{q^2}}{I} = \\frac{\\frac{1}{3M_w^2} \\sum_i w_i M_i R_{g,i}^2}{\\frac{1}{M_w}} = \\frac{1}{3M_w} \\sum_i w_i M_i R_{g,i}^2 $$\n这个比率定义了表观均方回旋半径 $\\langle R_g^2 \\rangle_{app}$ 除以 $3$：\n$$ \\frac{\\langle R_g^2 \\rangle_{app}}{3} = \\frac{\\sum_i w_i M_i R_{g,i}^2}{3 M_w} \\implies \\langle R_g^2 \\rangle_{app} = \\frac{\\sum_i w_i M_i R_{g,i}^2}{M_w} = \\frac{\\sum_i w_i M_i R_{g,i}^2}{\\sum_i w_i M_i} $$\n这个表达式是 z-均均方回旋半径 $R_{g,z}^2$ 的定义。因此，SLS 报告的回旋半径是 z-均回旋半径 $R_{g,z}$。第二个推导出的表达式是：\n$$ R_{g,z} = \\sqrt{\\frac{\\sum_i w_i M_i R_{g,i}^2}{\\sum_i w_i M_i}} $$\n\n现在，我们为给定的二元混合物（$i=1, 2$）计算这些表达式的值：\n- $M_1 = 1.00 \\times 10^5 \\ \\mathrm{g\\,mol^{-1}}$，$R_{g,1} = 12.0 \\ \\mathrm{nm}$，$w_1 = 0.70$\n- $M_2 = 1.00 \\times 10^6 \\ \\mathrm{g\\,mol^{-1}}$，$R_{g,2} = 38.0 \\ \\mathrm{nm}$，$w_2 = 0.30$\n\n重均摩尔质量 $M_w$ 是：\n$$ M_w = w_1 M_1 + w_2 M_2 = (0.70)(1.00 \\times 10^5 \\ \\mathrm{g\\,mol^{-1}}) + (0.30)(1.00 \\times 10^6 \\ \\mathrm{g\\,mol^{-1}}) $$\n$$ M_w = 7.0 \\times 10^4 \\ \\mathrm{g\\,mol^{-1}} + 3.0 \\times 10^5 \\ \\mathrm{g\\,mol^{-1}} = 3.7 \\times 10^5 \\ \\mathrm{g\\,mol^{-1}} $$\n根据要求四舍五入到三位有效数字：\n$$ M_w = 3.70 \\times 10^5 \\ \\mathrm{g\\,mol^{-1}} $$\n\nz-均均方回旋半径 $R_{g,z}^2$ 是：\n$$ R_{g,z}^2 = \\frac{w_1 M_1 R_{g,1}^2 + w_2 M_2 R_{g,2}^2}{M_w} $$\n分子是：\n$$ w_1 M_1 R_{g,1}^2 + w_2 M_2 R_{g,2}^2 = (0.70)(1.00 \\times 10^5 \\ \\mathrm{g\\,mol^{-1}})(12.0 \\ \\mathrm{nm})^2 + (0.30)(1.00 \\times 10^6 \\ \\mathrm{g\\,mol^{-1}})(38.0 \\ \\mathrm{nm})^2 $$\n$$ = (7.0 \\times 10^4)(144) \\ \\mathrm{g\\,mol^{-1}\\,nm^2} + (3.0 \\times 10^5)(1444) \\ \\mathrm{g\\,mol^{-1}\\,nm^2} $$\n$$ = 1.008 \\times 10^7 \\ \\mathrm{g\\,mol^{-1}\\,nm^2} + 4.332 \\times 10^8 \\ \\mathrm{g\\,mol^{-1}\\,nm^2} $$\n$$ = 4.4328 \\times 10^8 \\ \\mathrm{g\\,mol^{-1}\\,nm^2} $$\n现在，我们计算 $R_{g,z}^2$：\n$$ R_{g,z}^2 = \\frac{4.4328 \\times 10^8 \\ \\mathrm{g\\,mol^{-1}\\,nm^2}}{3.7 \\times 10^5 \\ \\mathrm{g\\,mol^{-1}}} \\approx 1198.05 \\ \\mathrm{nm}^2 $$\nz-均回旋半径 $R_{g,z}$ 是其平方根：\n$$ R_{g,z} = \\sqrt{1198.05 \\ \\mathrm{nm}^2} \\approx 34.613 \\ \\mathrm{nm} $$\n四舍五入到三位有效数字：\n$$ R_{g,z} = 34.6 \\ \\mathrm{nm} $$\n\n计算出的值为 $M_w = 3.70 \\times 10^5 \\ \\mathrm{g\\,mol^{-1}}$ 和 $R_{g,z} = 34.6 \\ \\mathrm{nm}$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 3.70 \\times 10^{5} & 34.6 \\end{pmatrix}}\n$$", "id": "2928726"}, {"introduction": "静态光散射不仅能测量大分子的尺寸和质量，更是探测聚合物-溶剂相互作用的强大工具。Zimm图分析得到的第二维里系数 $A_2$ 是量化这种相互作用的关键参数，当 $A_2=0$ 时对应的温度即为 $\\theta$ 温度。本项高级实践将带你通过分析 $A_2$ 随温度的变化来精确确定 $\\theta$ 温度，并处理实际研究中一个重要的复杂因素：折射率增量 $dn/dc$ 的温度依赖性 [@problem_id:2928727]。", "problem": "一个高分子溶液通过静态光散射 (SLS) 进行表征。在使用 Zimm 方法的 SLS 分析中，通过对散射强度的浓度和角度依赖性进行建模，可以提取重均摩尔质量和第二维里系数。在所谓的 $\\theta$ 温度附近，排除体积效应消失，第二维里系数穿过零点。\n\n从以下基本原理出发：\n- 在散射矢量大小和浓度趋于零时，Zimm 方程为\n  $$\\frac{K(T)\\,c}{R_\\theta(T,c)} = \\frac{1}{M_w} + 2\\,A_2(T)\\,c + \\cdots,$$\n  其中，$K(T)$ 是光学常数，$c$ 是浓度，$R_\\theta$ 是瑞利比，$M_w$ 是重均摩尔质量，$A_2(T)$ 是第二维里系数。\n- 光学常数为\n  $$K(T) = \\frac{4\\pi^2 n_0^2(T)}{N_A \\lambda^4}\\,\\left(\\frac{dn}{dc}(T)\\right)^2,$$\n  其中，$n_0(T)$ 是溶剂的折射率，$N_A$ 是阿伏伽德罗常数，$\\lambda$ 是真空波长，$dn/dc(T)$ 是折射率增量。\n- $\\theta$ 温度 $T_\\theta$ 由以下条件定义\n  $$A_2(T_\\theta)=0.$$\n- 在 $T_\\theta$ 附近一个足够窄的温度窗口内，$A_2(T)$ 的温度依赖性可以通过一个线性模型来近似，该模型源于对底层的高分子-溶剂相互作用参数和排除体积贡献进行线性化处理。\n\n您的任务是编写一个程序，给定在 $T_\\theta$ 附近一个温度窗口内的 $A_2(T)$ 测量值及其标准不确定度，对 $A_2$ 与 $T$ 进行加权线性回归，将拟合线的零点作为 $T_\\theta$ 的估计值，并传播回归不确定度以获得 $T_\\theta$ 的标准不确定度。此外，在报告的 $A_2(T)$ 值是使用一个与温度无关的折射率增量 $\\left(dn/dc\\right)_\\mathrm{ref}$ 计算的，而真实的 $\\left(dn/dc\\right)(T)$ 随温度变化的情况下，您必须：\n- 对未校正的 $A_2^\\mathrm{app}(T)$ 值进行“朴素”线性模型拟合，以获得一个表观的 $T_\\theta^\\mathrm{naive}$ 及其不确定度。\n- 使用已知的 $dn/dc(T)$ 的温度依赖性来校正 $A_2^\\mathrm{app}(T)$ 值，以在噪声范围内重构 $A_2^\\mathrm{true}(T)$，然后重新拟合并报告校正后的估计值 $T_\\theta^\\mathrm{corr}$ 及其不确定度。\n\n数学上：\n- 使用加权最小二乘法拟合模型\n  $$A_2(T) = m\\,T + b,$$\n  其中每个数据点 $(T_i, A_{2,i}, \\sigma_{A_2,i})$ 的权重为 $w_i = 1/\\sigma_{A_2,i}^2$。\n- 通过拟合线的零点来估计 $\\theta$ 温度，\n  $$\\widehat{T}_\\theta = -\\frac{b}{m}.$$\n- 从加权正规方程计算 $(m,b)$ 的协方差矩阵，并用约化卡方值对其进行缩放，以考虑模型与数据可能存在的不匹配。使用一阶误差传播来传播不确定度。如果 $f(m,b) = -b/m$，那么其梯度为\n  $$\\nabla f = \\begin{bmatrix}\\partial f/\\partial m \\\\ \\partial f/\\partial b\\end{bmatrix} = \\begin{bmatrix} b/m^2 \\\\ -1/m\\end{bmatrix},$$\n  $\\widehat{T}_\\theta$ 的方差为\n  $$u^2(\\widehat{T}_\\theta) = \\nabla f^\\top\\,\\mathrm{Cov}(m,b)\\,\\nabla f.$$\n\n在 $A_2$ 值是使用与温度无关的 $\\left(dn/dc\\right)_\\mathrm{ref}$ 形成，而真实的 $\\left(dn/dc\\right)(T)$ 变化的情况下，请注意，根据 Zimm 方程，用 $K_\\mathrm{ref}\\propto \\left(dn/dc\\right)_\\mathrm{ref}^2$ 重构的表观 $A_2^\\mathrm{app}(T)$ 通过一个乘法因子与真实的 $A_2^\\mathrm{true}(T)$ 相关联\n$$A_2^\\mathrm{app}(T) = \\left(\\frac{\\left(dn/dc\\right)_\\mathrm{ref}}{\\left(dn/dc\\right)(T)}\\right)^2 A_2^\\mathrm{true}(T).$$\n因此，要校正到真实尺度，需要除以因子 $s(T) = \\left(\\left(dn/dc\\right)_\\mathrm{ref} / \\left(dn/dc\\right)(T)\\right)^2$。标准不确定度也应进行一致的缩放。\n\n物理单位和数值报告：\n- 温度必须以开尔文 (K) 为单位处理和报告。\n- 您必须以开尔文 (K) 为单位报告每个估计的 $\\theta$ 温度及其标准不确定度，并四舍五入到三位小数。\n\n测试套件和输入数据：\n- 对于每个测试用例，您将获得温度数组 $T_i$ (单位 K)、测量的 $A_{2,i}$ 值及其标准不确定度 $\\sigma_{A_2,i}$。在测试用例 2 中，您还将额外获得用于校正的 $\\left(dn/dc\\right)(T_i)$ 值和参考值 $\\left(dn/dc\\right)_\\mathrm{ref}$。\n\n测试用例 1 (理想情况，明显线性，中等斜率)：\n- $T$ [K]: [300.0, 302.0, 304.0, 306.0, 308.0]\n- $A_2$ [任意一致单位]: [-0.0201, -0.0121, -0.0039, 0.0042, 0.0118]\n- $\\sigma_{A_2}$: [0.0003, 0.0003, 0.0003, 0.0003, 0.0003]\n\n测试用例 2 (提供了随温度变化的折射率增量；计算朴素拟合和校正后拟合)：\n- $T$ [K]: [300.0, 301.5, 303.0, 304.5, 306.0, 307.5, 309.0]\n- $A_2^\\mathrm{app}$: [-0.01395, -0.00890, -0.00352, 0.00173, 0.00706, 0.01230, 0.01774]\n- $\\sigma_{A_2^\\mathrm{app}}$: [0.00025, 0.00025, 0.00025, 0.00025, 0.00025, 0.00025, 0.00025]\n- $\\left(dn/dc\\right)_\\mathrm{ref}$ [mL g$^{-1}$]: 0.1850\n- $\\left(dn/dc\\right)(T)$ [mL g$^{-1}$]: [0.1858, 0.1855, 0.1852, 0.1849, 0.1846, 0.1843, 0.1840]\n\n测试用例 3 (边界情况，斜率非常平缓，导致不确定度较大)：\n- $T$ [K]: [308.0, 309.0, 310.0, 311.0, 312.0]\n- $A_2$: [-0.0021, -0.0011, 0.0002, 0.0010, 0.0022]\n- $\\sigma_{A_2}$: [0.00025, 0.00025, 0.00025, 0.00025, 0.00025]\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，结果按以下顺序排列：\n  1. 测试用例 1 的 $\\widehat{T}_{\\theta,1}$，\n  2. 测试用例 1 的 $u(\\widehat{T}_{\\theta,1})$，\n  3. 测试用例 2 的 $\\widehat{T}_{\\theta,2}^\\mathrm{naive}$ (未校正)，\n  4. 测试用例 2 的 $u(\\widehat{T}_{\\theta,2}^\\mathrm{naive})$ (未校正)，\n  5. 测试用例 2 的 $\\widehat{T}_{\\theta,2}^\\mathrm{corr}$ (使用提供的 $\\left(dn/dc\\right)(T)$ 校正)，\n  6. 测试用例 2 的 $u(\\widehat{T}_{\\theta,2}^\\mathrm{corr})$ (校正后)，\n  7. 测试用例 3 的 $\\widehat{T}_{\\theta,3}$，\n  8. 测试用例 3 的 $u(\\widehat{T}_{\\theta,3})$。\n\n所有八个数字都必须以开尔文 (K) 为单位，每个都四舍五入到三位小数，并按指定列表格式单行打印，不含任何额外文本。", "solution": "所述问题在科学上是合理的、客观的且定义明确的。它基于高分子溶液热力学和统计数据分析的既定原则。必要的数据、物理模型和数学程序以完整且一致的方式提供。因此，可以构建一个解决方案。\n\n这个问题的核心是从静态光散射数据中确定高分子溶液的 $\\theta$ 温度，即 $T_\\theta$。这是通过分析第二维里系数 $A_2(T)$ 的温度依赖性来实现的，在 $T_\\theta$ 附近，它可以用一个线性模型来近似：\n$$A_2(T) = mT + b$$\n$\\theta$ 温度被定义为 $A_2(T)$ 等于零时的温度，因此根据线性模型，$T_\\theta = -b/m$。该任务要求从实验数据点 $(T_i, A_{2,i}, \\sigma_{A_{2,i}})$ 中估计参数 $m$ 和 $b$ 及其不确定度，然后传播这些不确定度以求得导出量 $\\widehat{T}_\\theta$ 的不确定度。\n\n加权最小二乘法 (WLS) 是将线性模型拟合到数据的适当统计工具。WLS 最小化加权残差平方和 $\\chi^2$，其定义为：\n$$\\chi^2 = \\sum_{i=1}^N w_i(A_{2,i} - (mT_i + b))^2$$\n其中 $N$ 是数据点的数量，权重 $w_i = 1/\\sigma_{A_{2,i}}^2$ 确保不确定度较小（即精度较高）的测量值对拟合有更大的影响。\n\n相对于参数 $m$ 和 $b$ 对 $\\chi^2$ 进行最小化，会得到一个线性方程组，称为正规方程。用矩阵形式表示，该方程组写为：\n$$(\\mathbf{A}^\\top \\mathbf{W} \\mathbf{A})\\hat{\\beta} = \\mathbf{A}^\\top \\mathbf{W} \\mathbf{y}$$\n这里，$\\hat{\\beta} = [m, b]^\\top$ 是估计参数的向量。向量 $\\mathbf{y}$ 包含测量的 $A_{2,i}$ 值。矩阵 $\\mathbf{W}$ 是一个对角矩阵，其对角线上是权重 $w_i$。设计矩阵 $\\mathbf{A}$ 的构造方式是每一行对应一个数据点，并由 $[T_i, 1]$ 给出，反映了模型 $mT_i+b$。\n\n参数向量的解是 $\\hat{\\beta} = (\\mathbf{A}^\\top \\mathbf{W} \\mathbf{A})^{-1} (\\mathbf{A}^\\top \\mathbf{W} \\mathbf{y})$。由此，我们得到 $m$ 和 $b$ 的估计值，并可以计算估计的 $\\theta$ 温度 $\\widehat{T}_\\theta = -b/m$。\n\n为了确定 $\\widehat{T}_\\theta$ 的不确定度，我们首先需要拟合参数的协方差矩阵 $\\mathrm{Cov}(m,b)$。未缩放的协方差矩阵由 $(\\mathbf{A}^\\top \\mathbf{W} \\mathbf{A})^{-1}$ 给出。根据规定，该矩阵必须用约化卡方值 $\\chi^2_\\nu$ 进行缩放，以考虑模型与数据之间的任何潜在不匹配或测量不确定度的错误估计。约化卡方值的计算公式为：\n$$\\chi^2_\\nu = \\frac{\\chi^2}{N-p} = \\frac{1}{N-2} \\sum_{i=1}^N w_i(A_{2,i} - (mT_i + b))^2$$\n其中 $p=2$ 是拟合参数的数量。那么，缩放后的协方差矩阵为 $\\mathrm{Cov}(m,b) = \\chi^2_\\nu (\\mathbf{A}^\\top \\mathbf{W} \\mathbf{A})^{-1}$。\n\n$\\widehat{T}_\\theta$ 的不确定度是使用不确定度传播定律找到的。对于函数 $f(m,b) = -b/m$，其方差由下式给出：\n$$u^2(\\widehat{T}_\\theta) = \\nabla f^\\top\\,\\mathrm{Cov}(m,b)\\,\\nabla f$$\n梯度向量 $\\nabla f$ 包含 $f$ 相对于 $m$ 和 $b$ 的偏导数：\n$$\\nabla f = \\begin{bmatrix}\\partial f/\\partial m \\\\ \\partial f/\\partial b\\end{bmatrix} = \\begin{bmatrix} b/m^2 \\\\ -1/m\\end{bmatrix}$$\n标准不确定度 $u(\\widehat{T}_\\theta)$ 是该方差的平方根。此过程在一个通用函数中实现，并应用于每个测试用例。\n\n对于测试用例 2，我们处理一个系统误差。表观第二维里系数 $A_2^\\mathrm{app}(T)$ 是使用一个恒定的参考折射率增量 $(dn/dc)_\\mathrm{ref}$ 计算的，而真实的增量 $(dn/dc)(T)$ 随温度变化。表观系数和真实系数之间的关系是：\n$$A_2^\\mathrm{app}(T) = \\left(\\frac{(dn/dc)_\\mathrm{ref}}{(dn/dc)(T)}\\right)^2 A_2^\\mathrm{true}(T)$$\n为了获得正确的 $\\theta$ 温度，必须首先校正表观数据。我们定义一个缩放因子 $s(T) = \\left((dn/dc)_\\mathrm{ref} / (dn/dc)(T)\\right)^2$。然后通过重新排列方程来找到真实的第二维里系数：$A_2^\\mathrm{true}(T) = A_2^\\mathrm{app}(T) / s(T)$。相应的不确定度也必须进行缩放：$\\sigma_{A_2^\\mathrm{true}}(T) = \\sigma_{A_2^\\mathrm{app}}(T) / s(T)$。在进行此校正后，对校正后的数据 $(T_i, A_{2,i}^\\mathrm{true}, \\sigma_{A_{2,i}^\\mathrm{true}})$ 应用 WLS 过程，以确定校正后的 $\\theta$ 温度 $\\widehat{T}_\\theta^\\mathrm{corr}$ 及其不确定度。朴素估计值则是通过直接对未校正的表观数据应用 WLS 过程得到的。\n\n最终的程序实现了这一逻辑。一个专用函数执行 WLS 拟合和不确定度传播。该函数被每个测试用例调用：测试用例 1 和测试用例 3 各调用一次，测试用例 2 调用两次（一次用于朴素数据，一次用于校正后数据）。将得到的八个值收集起来，格式化为三位小数，并作为单个逗号分隔的列表打印出来。", "answer": "```python\nimport numpy as np\n\ndef perform_wls_and_propagate(T, A2, sigma_A2):\n    \"\"\"\n    Performs weighted linear regression for A2(T) = m*T + b, calculates\n    the theta temperature T_theta = -b/m, and propagates the uncertainty.\n\n    Args:\n        T (list or np.ndarray): Temperatures in Kelvin.\n        A2 (list or np.ndarray): Second virial coefficient values.\n        sigma_A2 (list or np.ndarray): Standard uncertainties of A2 values.\n\n    Returns:\n        tuple: A tuple containing (T_theta_hat, u_T_theta), where\n               T_theta_hat is the estimated theta temperature and\n               u_T_theta is its standard uncertainty.\n    \"\"\"\n    x = np.array(T)\n    y = np.array(A2)\n    sigma_y = np.array(sigma_A2)\n\n    N = len(x)\n    if N < 3:\n        raise ValueError(\"Weighted least squares with reduced chi-square scaling \"\n                         \"requires at least 3 data points.\")\n\n    # Weights for the regression\n    w = 1.0 / sigma_y**2\n\n    # Design matrix A for the model y = m*x + b\n    # The parameters are ordered [m, b]\n    A = np.vstack([x, np.ones(N)]).T\n\n    # Solve the normal equations (A.T @ W @ A) @ params = A.T @ W @ y\n    # W is a diagonal matrix, which simplifies calculations\n    w_matrix = np.diag(w)\n    C = A.T @ w_matrix @ A\n    v = A.T @ w_matrix @ y\n\n    try:\n        params = np.linalg.solve(C, v)\n    except np.linalg.LinAlgError:\n        return (np.nan, np.nan)\n\n    m, b = params[0], params[1]\n\n    # Estimate theta temperature\n    T_theta_hat = -b / m\n\n    # Calculate reduced chi-squared to scale the covariance matrix\n    residuals = y - (m * x + b)\n    chi_squared = np.sum(w * residuals**2)\n    degrees_of_freedom = N - 2\n    reduced_chi_squared = chi_squared / degrees_of_freedom\n\n    # The unscaled covariance matrix is inv(C)\n    C_inv = np.linalg.inv(C)\n    \n    # Scale the covariance matrix by reduced chi-squared\n    cov_mb = reduced_chi_squared * C_inv\n\n    # Propagate uncertainty for T_theta = f(m, b) = -b/m\n    # Gradient of f(m, b)\n    grad_f = np.array([b / m**2, -1 / m])\n\n    # Variance of T_theta is grad_f.T @ cov_mb @ grad_f\n    var_T_theta = grad_f.T @ cov_mb @ grad_f\n    u_T_theta = np.sqrt(var_T_theta)\n\n    return T_theta_hat, u_T_theta\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print the final result.\n    \"\"\"\n    # Test Case 1\n    T1 = [300.0, 302.0, 304.0, 306.0, 308.0]\n    A2_1 = [-0.0201, -0.0121, -0.0039, 0.0042, 0.0118]\n    sigma_A2_1 = [0.0003, 0.0003, 0.0003, 0.0003, 0.0003]\n    T_theta_1, u_T_theta_1 = perform_wls_and_propagate(T1, A2_1, sigma_A2_1)\n\n    # Test Case 2\n    T2 = [300.0, 301.5, 303.0, 304.5, 306.0, 307.5, 309.0]\n    A2_app_2 = [-0.01395, -0.00890, -0.00352, 0.00173, 0.00706, 0.01230, 0.01774]\n    sigma_A2_app_2 = [0.00025, 0.00025, 0.00025, 0.00025, 0.00025, 0.00025, 0.00025]\n    dndc_ref_2 = 0.1850\n    dndc_T_2 = [0.1858, 0.1855, 0.1852, 0.1849, 0.1846, 0.1843, 0.1840]\n\n    # Part A: Naive (uncorrected) calculation\n    T_theta_2_naive, u_T_theta_2_naive = perform_wls_and_propagate(T2, A2_app_2, sigma_A2_app_2)\n\n    # Part B: Corrected calculation\n    A2_app_2_np = np.array(A2_app_2)\n    sigma_A2_app_2_np = np.array(sigma_A2_app_2)\n    dndc_T_2_np = np.array(dndc_T_2)\n\n    # Calculate the temperature-dependent scaling factor s(T)\n    s_T = (dndc_ref_2 / dndc_T_2_np)**2\n\n    # Correct the A2 values and their uncertainties\n    A2_true_2 = A2_app_2_np / s_T\n    sigma_A2_true_2 = sigma_A2_app_2_np / s_T\n    \n    T_theta_2_corr, u_T_theta_2_corr = perform_wls_and_propagate(T2, A2_true_2, sigma_A2_true_2)\n\n    # Test Case 3\n    T3 = [308.0, 309.0, 310.0, 311.0, 312.0]\n    A2_3 = [-0.0021, -0.0011, 0.0002, 0.0010, 0.0022]\n    sigma_A2_3 = [0.00025, 0.00025, 0.00025, 0.00025, 0.00025]\n    T_theta_3, u_T_theta_3 = perform_wls_and_propagate(T3, A2_3, sigma_A2_3)\n\n    # Consolidate all results\n    all_results = [\n        T_theta_1, u_T_theta_1,\n        T_theta_2_naive, u_T_theta_2_naive,\n        T_theta_2_corr, u_T_theta_2_corr,\n        T_theta_3, u_T_theta_3\n    ]\n\n    # Format for printing as specified\n    formatted_results = [f\"{val:.3f}\" for val in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2928727"}]}