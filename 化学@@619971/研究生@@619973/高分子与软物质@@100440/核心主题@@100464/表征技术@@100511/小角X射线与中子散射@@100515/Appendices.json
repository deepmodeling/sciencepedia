{"hands_on_practices": [{"introduction": "小角散射实验中最直接的定量信息之一来自前向散射强度 $I(0)$。这个数值直接关联着样品的宏观浓度与其中纳米颗粒的微观特性。本练习将引导你推导一个重要的基本关系式，该关系式连接了 $I(0)$、颗粒体积、散射衬度和颗粒数密度，你将以一种在现代材料科学中常见的核壳纳米颗粒为模型进行推导 [@problem_id:142638]。通过这个实践，你将掌握如何从绝对散射强度中提取胶体分散体系关键定量参数的核心技能。", "problem": "在小角X射线或中子散射（SAXS/SANS）中，来自相同的、单分散粒子的稀悬浮液的绝对标定散射强度 $I(q)$ 由下式给出：\n$$\nI(q) = n_p P(q)\n$$\n其中 $n_p$ 是数密度（单位体积内的粒子数），$P(q)$ 是单个粒子的形状因子。形状因子是粒子散射振幅的平方，$P(q) = |A(q)|^2$。散射振幅由粒子相对于溶剂的散射长度密度（SLD）分布的傅里叶变换定义：\n$$\nA(q) = \\int_{V_p} (\\rho(\\vec{r}) - \\rho_s) e^{-i\\vec{q}\\cdot\\vec{r}} d^3r\n$$\n在这里，$\\rho(\\vec{r})$ 是粒子的SLD，$\\rho_s$ 是溶剂的恒定SLD，$V_p$ 是粒子体积，$\\vec{q}$ 是散射矢量，其模为 $q$。\n\n对于前向散射（$q \\to 0$），该关系式简化，因为指数项变为1。前向散射强度 $I(0)$ 特别有用，因为它直接与粒子体积和浓度相关。\n\n考虑一个悬浮在溶剂中的单分散球形核壳纳米粒子体系。每个粒子由一个半径为 $R_c$、SLD均匀为 $\\rho_c$ 的球形核心，以及一个外半径为 $R_t$、SLD均匀为 $\\rho_{sh}$ 的同心球壳组成。粒子分散在SLD均匀为 $\\rho_s$ 的溶剂中。一次散射实验测得绝对前向散射强度为 $I(0)$。\n\n假设悬浮液足够稀，使得粒子间相互作用可以忽略不计，请推导核壳纳米粒子的数密度 $n_p$ 的表达式。最终表达式应以 $I(0)$、半径 $R_c$ 和 $R_t$ 以及散射长度密度 $\\rho_c$、$\\rho_{sh}$ 和 $\\rho_s$ 表示。", "solution": "对于前向散射（$q\\to0$），我们有：\n$$I(0)=n_p\\,P(0)=n_p\\,|A(0)|^2.$$\n在 $q=0$ 时的振幅为\n$$A(0)=\\int_{V_p}(\\rho(\\mathbf r)-\\rho_s)\\,d^3r\n=(\\rho_c-\\rho_s)V_c+(\\rho_{sh}-\\rho_s)(V_t-V_c),$$\n其中\n$$V_c=\\frac{4\\pi}{3}R_c^3,\\quad V_t=\\frac{4\\pi}{3}R_t^3.$$\n因此\n$$A(0)\n=\\frac{4\\pi}{3}\\bigl[R_c^3(\\rho_c-\\rho_s)+(R_t^3-R_c^3)(\\rho_{sh}-\\rho_s)\\bigr].$$\n所以\n$$P(0)=|A(0)|^2\n=\\left(\\frac{4\\pi}{3}\\bigl[R_c^3(\\rho_c-\\rho_s)+(R_t^3-R_c^3)(\\rho_{sh}-\\rho_s)\\bigr]\\right)^2.$$\n求解 $n_p$ 可得\n$$n_p=\\frac{I(0)}{P(0)}\n=\\frac{I(0)}{\\left(\\frac{4\\pi}{3}\\bigl[R_c^3(\\rho_c-\\rho_s)+(R_t^3-R_c^3)(\\rho_{sh}-\\rho_s)\\bigr]\\right)^2}.$$", "answer": "$$\\boxed{\\frac{I(0)}{\\left(\\frac{4\\pi}{3}\\bigl[R_c^3(\\rho_c-\\rho_s)+(R_t^3-R_c^3)(\\rho_{sh}-\\rho_s)\\bigr]\\right)^2}}$$", "id": "142638"}, {"introduction": "在理解了散射衬度的基本概念后，我们可以进一步探索中子散射独有的强大技术——衬度变化法。通过使用同位素（例如氢和氘）替换，研究人员可以精确调控溶剂的散射长度密度，从而选择性地“点亮”或“隐藏”复杂体系中的特定组分。本练习将让你实践“衬度匹配”这一核心原理，你将计算出 H₂O 和 D₂O 混合溶剂的精确组分，以使得溶解在其中的聚合物对中子而言变得“不可见” [@problem_id:2928096]。这个计算揭示了分离复杂散射信号、聚焦于特定结构的关键实验策略。", "problem": "通过小角中子散射（SANS）研究一种均相聚合物溶液，SANS是小角散射技术的一个子集，该技术还包括小角X射线散射（SAXS）。溶剂是重水和轻水的二元同位素混合物。散射长度密度（SLD）定义为单位体积内的相干核散射长度。假设如下：\n\n- 在SANS探测的尺度上，该混合物是理想且不可压缩的，因此体积是可加和的，且与仪器分辨率相比，组分涨落可以忽略不计。\n- 该混合物在宏观上是均相和各向同性的。\n- 每种纯组分的SLD都是均匀的，且等于其体相值。\n- 计入前向散射振幅的空间平均SLD是局域SLD场的体积平均值。\n\n从散射振幅的定义（SLD场乘以相位因子的空间积分）出发，并利用上述假设，推导溶剂混合物的SLD与重水体积分数之间的关系。然后，使用公认的纯同位素溶剂的SLD值，$\\rho_{H_{2}O}=-0.56\\times 10^{-6}\\ \\text{\\AA}^{-2}$ 和 $\\rho_{D_{2}O}=6.34\\times 10^{-6}\\ \\text{\\AA}^{-2}$，计算与SLD为 $\\rho_{p}=1.80\\times 10^{-6}\\ \\text{\\AA}^{-2}$ 的氢化聚合物相匹配的氧化氘体积分数，即聚合物-溶剂对比度消失时的组分。\n\n将最终答案表示为十进制体积分数（无量纲），并四舍五入到四位有效数字。", "solution": "该问题要求推导理想二元同位素溶剂混合物的散射长度密度（SLD）关系式，并随后计算与溶解的聚合物实现对比度匹配所需的混合物组分。验证过程确认问题陈述在科学上是合理的、提法是恰当的，并包含了所有必要信息。我们开始进行解答。\n\n问题陈述指出，空间平均SLD是局域SLD场的体积平均值。让我们将其公式化。溶剂混合物的平均SLD（我们记为 $\\rho_{solv}$）定义为给定体积 $V_{solv}$ 内的总相干散射长度 $B_{solv}$ 除以该体积。\n$$\n\\rho_{solv} = \\frac{B_{solv}}{V_{solv}}\n$$\n溶剂是重水（$D_2O$）和轻水（$H_2O$）的二元混合物。根据理想、不可压缩混合物的假设，总体积是其各组分体积之和。\n$$\nV_{solv} = V_{D_2O} + V_{H_2O}\n$$\n此处，$V_{D_2O}$ 是混合物中重水的体积，$V_{H_2O}$ 是轻水的体积。同样，总相干散射长度 $B_{solv}$ 是各组分散射长度之和。组分的散射长度是其均匀SLD与其体积的乘积。设 $\\rho_{D_2O}$ 为纯重水的SLD，$\\rho_{H_2O}$ 为纯轻水的SLD。那么，总散射长度为：\n$$\nB_{solv} = \\rho_{D_2O} V_{D_2O} + \\rho_{H_2O} V_{H_2O}\n$$\n将 $B_{solv}$ 和 $V_{solv}$ 的表达式代入平均SLD的定义中，得到：\n$$\n\\rho_{solv} = \\frac{\\rho_{D_2O} V_{D_2O} + \\rho_{H_2O} V_{H_2O}}{V_{D_2O} + V_{H_2O}}\n$$\n我们可以用体积分数来重写这个表达式。设 $\\phi$ 为溶剂混合物中重水的体积分数，定义为：\n$$\n\\phi = \\frac{V_{D_2O}}{V_{solv}} = \\frac{V_{D_2O}}{V_{D_2O} + V_{H_2O}}\n$$\n由于是二元混合物，轻水的体积分数必然是 $(1-\\phi)$。\n$$\n1 - \\phi = 1 - \\frac{V_{D_2O}}{V_{D_2O} + V_{H_2O}} = \\frac{V_{H_2O}}{V_{D_2O} + V_{H_2O}} = \\frac{V_{H_2O}}{V_{solv}}\n$$\n将 $\\rho_{solv}$ 表达式的分子和分母同除以 $V_{solv}$，我们得到：\n$$\n\\rho_{solv} = \\rho_{D_2O} \\left(\\frac{V_{D_2O}}{V_{solv}}\\right) + \\rho_{H_2O} \\left(\\frac{V_{H_2O}}{V_{solv}}\\right)\n$$\n代入体积分数，我们便得到了第一个要求的结果：溶剂混合物SLD与重水体积分数 $\\phi$ 之间的线性关系。\n$$\n\\rho_{solv}(\\phi) = \\phi \\rho_{D_2O} + (1-\\phi) \\rho_{H_2O}\n$$\n这种线性混合法则是理想混合物体积可加和假设的直接结果。\n\n问题的第二部分要求计算使溶剂SLD与聚合物SLD $\\rho_p$ 相匹配时的特定体积分数 $\\phi$。这个条件被称为对比度匹配，意味着来自聚合物的净散射为零。在数学上，我们令 $\\rho_{solv}(\\phi) = \\rho_p$。\n$$\n\\rho_p = \\phi \\rho_{D_2O} + (1-\\phi) \\rho_{H_2O}\n$$\n我们现在必须求解这个方程以得到 $\\phi$。展开右边，得到：\n$$\n\\rho_p = \\phi \\rho_{D_2O} + \\rho_{H_2O} - \\phi \\rho_{H_2O}\n$$\n我们将含有 $\\phi$ 的项归类：\n$$\n\\rho_p - \\rho_{H_2O} = \\phi (\\rho_{D_2O} - \\rho_{H_2O})\n$$\n分离出 $\\phi$ 可得到对比度匹配体积分数的解析表达式：\n$$\n\\phi = \\frac{\\rho_p - \\rho_{H_2O}}{\\rho_{D_2O} - \\rho_{H_2O}}\n$$\n给定的SLD数值如下：\n$$\n\\rho_{H_2O} = -0.56 \\times 10^{-6}\\ \\text{\\AA}^{-2}\n$$\n$$\n\\rho_{D_2O} = 6.34 \\times 10^{-6}\\ \\text{\\AA}^{-2}\n$$\n$$\n\\rho_{p} = 1.80 \\times 10^{-6}\\ \\text{\\AA}^{-2}\n$$\n将这些值代入 $\\phi$ 的表达式中：\n$$\n\\phi = \\frac{(1.80 \\times 10^{-6}) - (-0.56 \\times 10^{-6})}{(6.34 \\times 10^{-6}) - (-0.56 \\times 10^{-6})}\n$$\n$10^{-6}\\ \\text{\\AA}^{-2}$ 这个公因子在分子和分母中被消去。\n$$\n\\phi = \\frac{1.80 - (-0.56)}{6.34 - (-0.56)} = \\frac{1.80 + 0.56}{6.34 + 0.56} = \\frac{2.36}{6.90}\n$$\n进行除法运算：\n$$\n\\phi \\approx 0.34202898...\n$$\n问题要求答案四舍五入到四位有效数字。前四位有效数字是 $3$、$4$、$2$ 和 $0$。第五位数字是 $2$，小于 $5$，所以舍去。\n$$\n\\phi \\approx 0.3420\n$$\n因此，溶剂混合物中需要大约 $0.3420$ 的重水体积分数，才能与氢化聚合物的散射长度密度相匹配。", "answer": "$$\n\\boxed{0.3420}\n$$", "id": "2928096"}, {"introduction": "现在，我们的焦点从分析稀疏、无关联的颗粒转向自组装形成的有序结构，例如嵌段共聚物形成的介观相。这些材料中的长程有序性会产生一系列尖锐的布拉格衍射峰，而非连续的散射曲线。这个高级实践模拟了一个完整的数据分析流程：你将通过分析峰位之间的比例关系来识别晶格对称性，计算晶格常数，并探究峰强度随 $q$ 变化的规律以推断其背后的形状因子 [@problem_id:2928108]。这项综合性练习将使你掌握从软物质的衍射图谱中解码复杂结构信息的关键技能。", "problem": "给定您有序嵌段共聚物介晶相的小角X射线散射数据。对于每个数据集，都会提供一个倒易空间中测得的峰位列表及相应的峰强度。您的任务是根据峰位比率推断晶体或介晶相的对称性（在候选结构中指定空间群），估算晶格常数，并对峰强度拟合平滑的形态因子包络。\n\n您的推导和算法应基于以下基本事实和定义：\n- 散射矢量的大小定义为 $q = \\frac{4\\pi}{\\lambda} \\sin \\theta$，但在此问题中，您可以使用直接测量的 $q$ 值，单位为 $\\mathrm{nm}^{-1}$。\n- 在倒易空间中的布拉格定律给出峰位为 $q_{hkl} = \\frac{2\\pi}{d_{hkl}}$。\n- 对于晶格常数为 $a$ 的立方晶格，$d_{hkl} = \\frac{a}{\\sqrt{h^2 + k^2 + l^2}}$，因此 $q_{hkl} = \\frac{2\\pi}{a} \\sqrt{h^2 + k^2 + l^2}$。\n- 对于晶格常数为 $a_{\\mathrm{hex}}$ 的二维六方（三角）圆柱晶格，其面内峰满足 $q_{hk} = \\frac{4\\pi}{\\sqrt{3}\\, a_{\\mathrm{hex}}} \\sqrt{h^2 + hk + k^2}$。\n- 对于周期为 $d$ 的一维层状结构，$q_n = n \\frac{2\\pi}{d}$，其中 $n$ 为正整数。\n- 对于粉末平均数据集，相对峰位由允许的衍射组决定。对于此处考虑的候选结构，前几个峰请使用以下允许的 $\\sqrt{\\cdot}$ 参数序列（相差一个整体比例因子）：\n  - 层状结构：$n \\in \\{1, 2, 3, \\dots\\}$ 且 $q_n \\propto n$。\n  - 六方圆柱相 (空间群 $P6/mmm$)：$h^2 + hk + k^2 \\in \\{1, 3, 4, 7, 9, 12, \\dots\\}$ 且 $q \\propto \\sqrt{h^2 + hk + k^2}$。\n  - 体心立方球相 (空间群 $Im\\bar{3}m$)：$h + k + l$ 为偶数，$h^2 + k^2 + l^2 \\in \\{2, 4, 6, 8, 10, \\dots\\}$ 且 $q \\propto \\sqrt{h^2 + k^2 + l^2}$。\n  - 双螺旋gyroid相 (空间群 $Ia\\bar{3}d$)：常见的前几个衍射为 $(211),(220),(321),(400),(420),(332),\\dots$ 且 $h^2 + k^2 + l^2 \\in \\{6, 8, 14, 16, 20, 22, \\dots\\}$ 且 $q \\propto \\sqrt{h^2 + k^2 + l^2}$。\n- 平滑的形态因子包络通常可以近似为 $I(q) \\approx C \\exp\\!\\left(-\\left(\\frac{q}{\\kappa}\\right)^2\\right)$，其中 $C$ 是某个振幅，$\\kappa$ 是衰减参数。\n\n您的程序必须：\n1. 对于每个数据集，通过最小二乘法计算最佳比例因子 $K$，使测量的峰位 $\\{q_i\\}$ 与每个候选结构的无量纲比率序列 $\\{r_i\\}$ 最佳拟合，即，关于 $K$ 最小化 $\\sum_i \\left(q_i - K r_i\\right)^2$。从最佳 $K$ 值推断出相应候选结构的晶格常数：\n   - 层状结构：$d = \\frac{2\\pi}{K}$。\n   - 六方圆柱相 ($P6/mmm$)：$a_{\\mathrm{hex}} = \\frac{4\\pi}{\\sqrt{3} K}$。\n   - 体心立方 ($Im\\bar{3}m$)：$a = \\frac{2\\pi}{K}$。\n   - 双螺旋gyroid相 ($Ia\\bar{3}d$)：$a = \\frac{2\\pi}{K}$。\n2. 选择在峰位上产生最小归一化残差的空间群候选结构，其定义为 $\\frac{\\sum_i \\left(q_i - K r_i\\right)^2}{\\sum_i q_i^2}$。\n3. 通过线性化 $\\ln I(q) = \\ln C - \\left(\\frac{1}{\\kappa^2}\\right) q^2$ 并执行最小二乘回归，对测量的强度 $\\{I_i\\}$ 在测量的 $\\{q_i\\}$ 位置上拟合高斯形态因子包络 $I(q) \\approx C \\exp\\!\\left(-\\left(\\frac{q}{\\kappa}\\right)^2\\right)$，以获得 $C$ 和 $\\kappa$。\n\n单位与输出要求：\n- 所有提供的 $q$ 值单位均为 $\\mathrm{nm}^{-1}$。\n- 晶格常数（或层状周期）必须以 $\\mathrm{nm}$ 报告。\n- 衰减参数 $\\kappa$ 必须以 $\\mathrm{nm}^{-1}$ 报告。\n- 振幅 $C$ 是无量纲的（任意单位）。\n- 将所有报告的浮点数输出四舍五入到恰好三位小数。\n\n空间群编码：\n- 层状结构（一维堆叠，此处作为特例报告）：代码 $0$。\n- 六方圆柱相 ($P6/mmm$)：代码 $1$。\n- 体心立方球相 ($Im\\bar{3}m$)：代码 $2$。\n- 双螺旋gyroid相 ($Ia\\bar{3}d$)：代码 $3$。\n\n测试套件：\n提供以下四个数据集。每个数据集都是一个列表对：测量的峰位 $\\{q_i\\}$（单位为 $\\mathrm{nm}^{-1}$）和相应的峰强度 $\\{I_i\\}$（单位为任意单位）。\n\n- 数据集 A:\n  - $q = [\\,0.2539,\\;0.3590,\\;0.4396,\\;0.5077,\\;0.5678\\,]$\n  - $I = [\\,836.0,\\;698.9,\\;584.9,\\;489.0,\\;408.6\\,]$\n- 数据集 B:\n  - $q = [\\,0.1728,\\;0.2994,\\;0.3456,\\;0.4571,\\;0.5184\\,]$\n  - $I = [\\,1065.1,\\;838.3,\\;744.4,\\;520.3,\\;409.4\\,]$\n- 数据集 C:\n  - $q = [\\,0.3078,\\;0.3554,\\;0.4704,\\;0.5028,\\;0.5620,\\;0.5894\\,]$\n  - $I = [\\,742.0,\\;695.0,\\;572.0,\\;536.0,\\;472.0,\\;443.0\\,]$\n- 数据集 D:\n  - $q = [\\,0.2094,\\;0.4188,\\;0.6282,\\;0.8376\\,]$\n  - $I = [\\,708.0,\\;492.0,\\;268.0,\\;114.0\\,]$\n\n实现细节：\n- 对每个数据集，评估所有四个候选结构，拟合最佳比例因子 $K$ 并选择归一化残差最小的候选结构。然后计算相应的晶格常数，拟合高斯包络以获得 $\\kappa$ 和 $C$，并生成输出。\n- 您的程序应生成单行输出，包含一个以逗号分隔的列表的列表形式的结果，每个数据集一个子列表，顺序为 A, B, C, D。每个子列表必须采用 $[\\text{code}, a, \\kappa, C]$ 的形式，其中 $a$ 是立方/六方晶格的晶格常数（或层状结构的周期），单位为 $\\mathrm{nm}$，$\\kappa$ 的单位为 $\\mathrm{nm}^{-1}$，而 $C$ 是无量纲的。所有浮点数都必须四舍五入到恰好三位小数。\n- 最终输出格式示例（使用占位符值）：$[[2,35.000,0.600,1000.000],[1,42.000,0.500,1200.000],\\dots]$。\n\n您的程序必须是自包含的，除了打印最终结果行外不执行任何输入/输出，并且不得需要任何外部文件或用户交互。", "solution": "所提出的问题是分析嵌段共聚物介晶相小角散射数据中一个明确定义的任务。它在科学上基于晶体学和散射理论的原理，在数学上是自洽的，并提供了所有必要的数据和公式。因此，该问题被认为是**有效的**，并将提供一个解决方案。\n\n如规定所示，对于每个数据集，解决方案采用三步法进行：\n1.  **相鉴定**：通过将测量的峰位与四种候选结构的理论衍射图谱进行比较，来确定晶体对称性（介晶相类型）。\n2.  **晶格常数计算**：一旦确定了相，就根据最佳拟合的比例常数计算其特征长度尺度（晶格常数或层状周期）。\n3.  **形态因子包络拟合**：使用高斯包络对峰强度的衰减进行建模，以提取其特征振幅和衰减长度。\n\n**第1步：通过最小二乘法拟合进行相鉴定**\n\n对于一个给定的有序结构，倒易空间中布拉格峰的位置 $q$ 由晶格对称性及其晶格常数决定。对于粉末平均样品，预计峰位 $\\{q_i\\}$ 会遵循一个特定序列：\n$$ q_i = K \\cdot r_i $$\n其中 $\\{r_i\\}$ 是由允许衍射的米勒指数决定的无量纲数字序列，$K$ 是一个取决于晶格常数的比例因子。该问题为四种候选结构提供了理论序列 $\\{r_i\\}$：\n\n*   **层状结构 (1D, 代码 0)**: $r_i \\in \\{1, 2, 3, \\dots\\}$\n*   **六方圆柱相 ($P6/mmm$, 代码 1)**: $r_i \\in \\{\\sqrt{1}, \\sqrt{3}, \\sqrt{4}, \\sqrt{7}, \\dots\\}$\n*   **体心立方 ($Im\\bar{3}m$, 代码 2)**: $r_i \\in \\{\\sqrt{2}, \\sqrt{4}, \\sqrt{6}, \\sqrt{8}, \\dots\\}$\n*   **双螺旋gyroid相 ($Ia\\bar{3}d$, 代码 3)**: $r_i \\in \\{\\sqrt{6}, \\sqrt{8}, \\sqrt{14}, \\sqrt{16}, \\dots\\}$\n\n对于每个数据集，我们得到一组包含 $N_p$ 个测量峰位的数据，表示为向量 $\\mathbf{q}_{\\text{obs}} = (q_1, q_2, \\dots, q_{N_p})$。对于每个候选结构，我们取其理论比率序列的前 $N_p$ 个元素，形成一个向量 $\\mathbf{r}_{\\text{theory}} = (r_1, r_2, \\dots, r_{N_p})$。\n\n任务是找到最优比例因子 $K$，以最小化残差平方和 $S$：\n$$ S(K) = \\sum_{i=1}^{N_p} (q_i - K r_i)^2 $$\n为了找到最小值，我们将 $S(K)$ 对 $K$ 求导并令结果为零：\n$$ \\frac{dS}{dK} = \\sum_{i=1}^{N_p} 2(q_i - K r_i)(-r_i) = -2 \\left( \\sum_{i=1}^{N_p} q_i r_i - K \\sum_{i=1}^{N_p} r_i^2 \\right) = 0 $$\n这得出了最优比例因子 $K_{\\text{opt}}$ 的解：\n$$ K_{\\text{opt}} = \\frac{\\sum_{i=1}^{N_p} q_i r_i}{\\sum_{i=1}^{N_p} r_i^2} = \\frac{\\mathbf{q}_{\\text{obs}} \\cdot \\mathbf{r}_{\\text{theory}}}{\\mathbf{r}_{\\text{theory}} \\cdot \\mathbf{r}_{\\text{theory}}} $$\n\n对四种候选结构中的每一种都执行此计算。最佳拟合结构是使归一化残差 $\\mathcal{R}$ 最小化的那个：\n$$ \\mathcal{R} = \\frac{\\sum_{i=1}^{N_p} (q_i - K_{\\text{opt}} r_i)^2}{\\sum_{i=1}^{N_p} q_i^2} $$\n\n**第2步：晶格常数的计算**\n\n比例因子 $K_{\\text{opt}}$ 与晶格常数（或层状周期 $d$）内在地联系在一起。该关系从 $q_{hkl}$ 的定义中导出：\n\n*   对于**层状结构** ($q_n = n \\frac{2\\pi}{d}$)，其中 $r_i=i$: $K = \\frac{2\\pi}{d} \\implies d = \\frac{2\\pi}{K}$。\n*   对于**立方结构** ($q_{hkl} = \\frac{2\\pi}{a} \\sqrt{h^2+k^2+l^2}$) ($Im\\bar{3}m$, $Ia\\bar{3}d$): $K = \\frac{2\\pi}{a} \\implies a = \\frac{2\\pi}{K}$。\n*   对于**二维六方结构** ($q_{hk} = \\frac{4\\pi}{\\sqrt{3} a_{\\text{hex}}} \\sqrt{h^2+hk+k^2}$): $K = \\frac{4\\pi}{\\sqrt{3} a_{\\text{hex}}} \\implies a_{\\text{hex}} = \\frac{4\\pi}{\\sqrt{3}K}$。\n\n使用从选定的最佳拟合结构中得到的 $K_{\\text{opt}}$，我们计算相应的晶格常数。\n\n**第3步：拟合形态因子包络**\n\n散射峰的强度 $I(q)$ 受到一个形态因子的调制，该形态因子取决于散射物体（例如，聚合物畴区）的形状和内部结构。问题指出，这可以由一个高斯函数近似：\n$$ I(q) \\approx C \\exp\\!\\left(-\\left(\\frac{q}{\\kappa}\\right)^2\\right) $$\n其中 $C$ 是振幅，$\\kappa$ 是一个与结构特征的特征尺寸相关的衰减参数。\n\n为了从位置 $\\{q_i\\}$ 处的测量峰强度 $\\{I_i\\}$ 来确定 $C$ 和 $\\kappa$，我们通过取自然对数来线性化模型：\n$$ \\ln(I(q)) = \\ln(C) - \\frac{1}{\\kappa^2} q^2 $$\n该方程的形式为 $y = b + m x$，其中：\n*   $y_i = \\ln(I_i)$\n*   $x_i = q_i^2$\n*   截距为 $b = \\ln(C)$\n*   斜率为 $m = - \\frac{1}{\\kappa^2}$\n\n我们对数据点 $(x_i, y_i)$ 执行标准的简单线性回归，以找到最佳拟合的斜率 $m$ 和截距 $b$。然后可以恢复参数 $C$ 和 $\\kappa$：\n$$ C = e^b $$\n$$ \\kappa = \\sqrt{-\\frac{1}{m}} $$\n对于一个有物理意义的解，斜率 $m$ 必须为负，这对应于强度随 $q$ 衰减。\n\n最终答案中实现的算法将对四个提供的数据集中的每一个执行这三个步骤。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of identifying block copolymer mesophase symmetry, estimating\n    the lattice parameter, and fitting a form-factor envelope to SAXS data.\n    \"\"\"\n\n    # Define the theoretical ratio sequences for candidate structures.\n    # These sequences must be long enough for the dataset with the most peaks.\n    candidates = [\n        {\n            \"code\": 0,\n            \"name\": \"Lamellar\",\n            \"ratios\": np.array([1, 2, 3, 4, 5, 6, 7]),\n            \"lattice_param_func\": lambda K: 2 * np.pi / K,\n        },\n        {\n            \"code\": 1,\n            \"name\": \"Hexagonal\",\n            \"ratios\": np.sqrt([1, 3, 4, 7, 9, 12, 13]),\n            \"lattice_param_func\": lambda K: 4 * np.pi / (np.sqrt(3) * K),\n        },\n        {\n            \"code\": 2,\n            \"name\": \"BCC ($Im\\\\bar{3}m$)\",\n            \"ratios\": np.sqrt([2, 4, 6, 8, 10, 12, 14]),\n            \"lattice_param_func\": lambda K: 2 * np.pi / K,\n        },\n        {\n            \"code\": 3,\n            \"name\": \"Gyroid ($Ia\\\\bar{3}d$)\",\n            \"ratios\": np.sqrt([6, 8, 14, 16, 20, 22, 24]),\n            \"lattice_param_func\": lambda K: 2 * np.pi / K,\n        }\n    ]\n\n    # Test suite datasets\n    test_cases = [\n        (\n            [0.2539, 0.3590, 0.4396, 0.5077, 0.5678],\n            [836.0, 698.9, 584.9, 489.0, 408.6]\n        ),\n        (\n            [0.1728, 0.2994, 0.3456, 0.4571, 0.5184],\n            [1065.1, 838.3, 744.4, 520.3, 409.4]\n        ),\n        (\n            [0.3078, 0.3554, 0.4704, 0.5028, 0.5620, 0.5894],\n            [742.0, 695.0, 572.0, 536.0, 472.0, 443.0]\n        ),\n        (\n            [0.2094, 0.4188, 0.6282, 0.8376],\n            [708.0, 492.0, 268.0, 114.0]\n        )\n    ]\n\n    all_results = []\n\n    for q_obs_list, I_obs_list in test_cases:\n        q_obs = np.array(q_obs_list)\n        I_obs = np.array(I_obs_list)\n        num_peaks = len(q_obs)\n\n        best_fit = {\n            'residual': np.inf,\n            'code': -1,\n            'K': None,\n            'lattice_param_func': None,\n        }\n\n        # Step 1: Identify best-fit structure\n        for candidate in candidates:\n            if len(candidate[\"ratios\"]) < num_peaks:\n                continue\n            \n            r_theory = candidate[\"ratios\"][:num_peaks]\n\n            # Calculate optimal scale factor K\n            K_opt = np.dot(q_obs, r_theory) / np.dot(r_theory, r_theory)\n\n            # Calculate predicted q-values and normalized residual\n            q_pred = K_opt * r_theory\n            residual = np.sum((q_obs - q_pred)**2) / np.sum(q_obs**2)\n\n            if residual < best_fit['residual']:\n                best_fit['residual'] = residual\n                best_fit['code'] = candidate['code']\n                best_fit['K'] = K_opt\n                best_fit['lattice_param_func'] = candidate['lattice_param_func']\n        \n        # Step 2: Calculate lattice parameter for the best fit\n        lattice_param = best_fit['lattice_param_func'](best_fit['K'])\n\n        # Step 3: Fit form factor envelope\n        # Linearize: ln(I) = ln(C) - (1/kappa^2) * q^2\n        # y = b + m*x\n        x_data = q_obs**2\n        y_data = np.log(I_obs)\n\n        # Perform linear regression to find slope (m) and intercept (b)\n        m, b = np.polyfit(x_data, y_data, 1)\n\n        # Calculate C and kappa from regression parameters\n        C = np.exp(b)\n        kappa = np.sqrt(-1.0 / m)\n\n        all_results.append([best_fit['code'], lattice_param, kappa, C])\n\n    # Format the final output string according to the specifications\n    def format_single_result(res):\n        code, a, k, c = res\n        return f\"[{code},{a:.3f},{k:.3f},{c:.3f}]\"\n\n    formatted_results = [format_single_result(r) for r in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2928108"}]}