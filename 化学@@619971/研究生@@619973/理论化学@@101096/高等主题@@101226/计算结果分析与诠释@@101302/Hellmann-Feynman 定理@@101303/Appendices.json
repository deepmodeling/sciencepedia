{"hands_on_practices": [{"introduction": "赫尔曼-费曼定理最直接的应用之一，是为计算算符的期望值提供了一条捷径，我们甚至无需知道波函数的具体形式，只需要了解能量对某个参数的依赖关系。量子谐振子是阐释这一强大功能的绝佳起点。通过该练习，你将学习如何将力常数 $k$ 视为一个变量，从而仅利用基态能量表达式来推导位置平方算符的期望值 $\\langle x^2 \\rangle$。[@problem_id:1406901]", "problem": "一个质量为 $m$ 的粒子由一维量子谐振子哈密顿量 $\\hat{H}(k) = -\\frac{\\hbar^2}{2m}\\frac{d^2}{dx^2} + \\frac{1}{2}kx^2$ 描述，其中 $k$ 是力常数，$\\hbar$ 是约化普朗克常数。已知该系统的精确基态能量由表达式 $E_0(k) = \\frac{1}{2}\\hbar\\sqrt{\\frac{k}{m}}$ 给出。由于这是精确能量，它也是通过完全优化的变分计算可得到的结果。\n\n将 Hellmann-Feynman 定理应用于此系统，将力常数 $k$ 视为一个连续参数。使用该定理推导粒子在基态时位置算符平方 $\\langle x^2 \\rangle$ 的期望值的表达式。\n\n以 $\\hbar$、$m$ 和 $k$ 的符号表达式给出你的答案。", "solution": "我们将哈密顿量 $\\hat{H}(k) = -\\frac{\\hbar^{2}}{2m}\\frac{d^{2}}{dx^{2}} + \\frac{1}{2}k x^{2}$ 中的 $k$ 视为一个连续参数。对于能量为 $E_{0}(k)$ 的精确、归一化的基态 $\\lvert \\psi_{0}(k) \\rangle$，Hellmann-Feynman 定理表明\n$$\n\\frac{dE_{0}}{dk} \\;=\\; \\left\\langle \\psi_{0}(k) \\middle| \\frac{\\partial \\hat{H}(k)}{\\partial k} \\middle| \\psi_{0}(k) \\right\\rangle.\n$$\n由于 $\\frac{\\partial \\hat{H}(k)}{\\partial k} = \\frac{1}{2}x^{2}$，我们得到\n$$\n\\frac{dE_{0}}{dk} \\;=\\; \\frac{1}{2}\\langle x^{2} \\rangle,\n$$\n因此\n$$\n\\langle x^{2} \\rangle \\;=\\; 2\\,\\frac{dE_{0}}{dk}.\n$$\n使用精确基态能量 $E_{0}(k) = \\frac{1}{2}\\hbar\\left(\\frac{k}{m}\\right)^{1/2}$，对 $k$ 求导：\n$$\n\\frac{dE_{0}}{dk} \\;=\\; \\frac{1}{2}\\hbar \\cdot \\frac{1}{2}\\left(\\frac{k}{m}\\right)^{-1/2}\\cdot \\frac{1}{m} \\;=\\; \\frac{1}{4}\\hbar\\,m^{-1/2}k^{-1/2}.\n$$\n因此，\n$$\n\\langle x^{2} \\rangle \\;=\\; 2 \\times \\frac{1}{4}\\hbar\\,m^{-1/2}k^{-1/2} \\;=\\; \\frac{\\hbar}{2}\\,m^{-1/2}k^{-1/2} \\;=\\; \\frac{\\hbar}{2\\sqrt{m k}}.\n$$\n这就是所求的基态下 $x^{2}$ 的期望值。", "answer": "$$\\boxed{\\frac{\\hbar}{2\\sqrt{m k}}}$$", "id": "1406901"}, {"introduction": "在初步应用之后，让我们深入探究该定理的理论核心。本练习将引导你首先从薛定谔方程出发，亲自推导赫尔曼-费曼定理，然后将其应用于量子力学中无处不在的二能级模型。通过两种不同方式（使用定理和直接对本征值求导）显式地计算能量导数，我们不仅可以验证定理的正确性，还能更深刻地理解其成立的条件。[@problem_id:2814495]", "problem": "一个作用于有限维希尔伯特空间上的参数哈密顿量 $H(\\lambda)$，其瞬时本征对 $\\{E_{n}(\\lambda),\\,|\\psi_{n}(\\lambda)\\rangle\\}$ 满足不含时薛定谔方程 $H(\\lambda)\\,|\\psi_{n}(\\lambda)\\rangle=E_{n}(\\lambda)\\,|\\psi_{n}(\\lambda)\\rangle$ 和归一化条件 $\\langle\\psi_{n}(\\lambda)|\\psi_{n}(\\lambda)\\rangle=1$。假设对于一个固定的本征值标签 $n$，$E_{n}(\\lambda)$ 是非简并的，并且映射 $\\lambda\\mapsto H(\\lambda)$ 在所关心的开区间内是可微的。\n\n从这些基本关系出发，并且不援引任何外部定理，首先推导一个关于能量对参数的导数 $dE_{n}(\\lambda)/d\\lambda$ 的通用恒等式，该恒等式用 $|\\psi_{n}(\\lambda)\\rangle$ 和 $\\partial H(\\lambda)/\\partial\\lambda$ 来表示。然后，将其特化到两能级哈密顿量\n$$\nH(\\lambda)=\\begin{pmatrix}\\Delta & \\lambda\\\\ \\lambda & -\\Delta\\end{pmatrix},\n$$\n其中 $\\Delta\\in\\mathbb{R}$ 是一个固定参数，$\\lambda\\in\\mathbb{R}$ 是控制参数，并计算其两个本征值 $E_{\\pm}(\\lambda)$ 对应的 $dE_{\\pm}(\\lambda)/d\\lambda$。为了使您的计算明确，您可以构造 $H(\\lambda)$ 的归一化本征矢量，并计算出现的任何内积。\n\n另外，独立地对 $H(\\lambda)$ 进行解析对角化，以获得 $E_{\\pm}(\\lambda)$ 的闭合形式表达式，并直接对它们求 $\\lambda$ 的导数。将结果与您之前的结果进行比较，并简要解释您推导的恒等式在此模型下成立或可能失效的任何条件。\n\n将您的最终答案以有序对 $\\big(dE_{+}(\\lambda)/d\\lambda,\\,dE_{-}(\\lambda)/d\\lambda\\big)$ 的形式报告为一个单一的闭合形式解析表达式。无需单位。不要对您的答案进行四舍五入。", "solution": "所提出的问题是量子力学微扰理论中的一个标准练习，且定义明确。它具有科学依据、自洽且客观。我们将着手解答。\n\n首先，我们推导能量本征值对参数的导数的通用恒等式，这被称为 Hellmann-Feynman 定理。我们从非简并本征态 $|\\psi_{n}(\\lambda)\\rangle$ 的不含时薛定谔方程开始：\n$$\nH(\\lambda)\\,|\\psi_{n}(\\lambda)\\rangle=E_{n}(\\lambda)\\,|\\psi_{n}(\\lambda)\\rangle\n$$\n鉴于归一化条件 $\\langle\\psi_{n}(\\lambda)|\\psi_{n}(\\lambda)\\rangle=1$，能量本征值 $E_{n}(\\lambda)$ 可以表示为哈密顿量在该状态下的期望值：\n$$\nE_{n}(\\lambda) = \\langle\\psi_{n}(\\lambda)|H(\\lambda)|\\psi_{n}(\\lambda)\\rangle\n$$\n现在我们对这个表达式关于参数 $\\lambda$ 求导，应用微分的乘法法则：\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = \\frac{d}{d\\lambda} \\Big( \\langle\\psi_{n}(\\lambda)|H(\\lambda)|\\psi_{n}(\\lambda)\\rangle \\Big)\n$$\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = \\left(\\frac{d\\langle\\psi_{n}(\\lambda)|}{d\\lambda}\\right) H(\\lambda) |\\psi_{n}(\\lambda)\\rangle + \\langle\\psi_{n}(\\lambda)| \\left(\\frac{\\partial H(\\lambda)}{\\partial\\lambda}\\right) |\\psi_{n}(\\lambda)\\rangle + \\langle\\psi_{n}(\\lambda)| H(\\lambda) \\left(\\frac{d|\\psi_{n}(\\lambda)\\rangle}{d\\lambda}\\right)\n$$\n由于哈密顿量 $H(\\lambda)$ 是厄米的，我们可以让它作用在左矢或右矢上。使用薛定谔方程 $H(\\lambda) |\\psi_{n}(\\lambda)\\rangle = E_n(\\lambda)|\\psi_{n}(\\lambda)\\rangle$ 及其厄米共轭 $\\langle\\psi_{n}(\\lambda)| H(\\lambda) = \\langle\\psi_{n}(\\lambda)| E_n(\\lambda) = E_n(\\lambda)\\langle\\psi_{n}(\\lambda)|$。将这些代入表达式中得到：\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = E_{n}(\\lambda) \\left(\\frac{d\\langle\\psi_{n}(\\lambda)|}{d\\lambda}\\right) |\\psi_{n}(\\lambda)\\rangle + \\left\\langle\\psi_{n}(\\lambda)\\left|\\frac{\\partial H(\\lambda)}{\\partial\\lambda}\\right|\\psi_{n}(\\lambda)\\right\\rangle + E_{n}(\\lambda) \\langle\\psi_{n}(\\lambda)| \\left(\\frac{d|\\psi_{n}(\\lambda)\\rangle}{d\\lambda}\\right)\n$$\n将标量能量本征值 $E_{n}(\\lambda)$ 提取出来：\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = E_{n}(\\lambda) \\left[ \\left(\\frac{d\\langle\\psi_{n}(\\lambda)|}{d\\lambda}\\right) |\\psi_{n}(\\lambda)\\rangle + \\langle\\psi_{n}(\\lambda)| \\left(\\frac{d|\\psi_{n}(\\lambda)\\rangle}{d\\lambda}\\right) \\right] + \\left\\langle\\psi_{n}(\\lambda)\\left|\\frac{\\partial H(\\lambda)}{\\partial\\lambda}\\right|\\psi_{n}(\\lambda)\\right\\rangle\n$$\n方括号中的项恰好是归一化条件的导数：\n$$\n\\frac{d}{d\\lambda} \\langle\\psi_{n}(\\lambda)|\\psi_{n}(\\lambda)\\rangle = \\frac{d}{d\\lambda}(1) = 0\n$$\n因此，第一项消失，我们得到恒等式：\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = \\left\\langle\\psi_{n}(\\lambda)\\left|\\frac{\\partial H(\\lambda)}{\\partial\\lambda}\\right|\\psi_{n}(\\lambda)\\right\\rangle\n$$\n这就是 Hellmann-Feynman 定理。\n\n接下来，我们特化到给定的两能级哈密顿量：\n$$\nH(\\lambda) = \\begin{pmatrix} \\Delta & \\lambda \\\\ \\lambda & -\\Delta \\end{pmatrix}\n$$\n哈密顿量相对于 $\\lambda$ 的导数是平凡的：\n$$\n\\frac{\\partial H(\\lambda)}{\\partial\\lambda} = \\begin{pmatrix} 0 & 1 \\\\ 1 & 0 \\end{pmatrix}\n$$\n要应用推导出的恒等式，我们需要 $H(\\lambda)$ 的本征矢量。首先，我们从特征方程 $\\det(H(\\lambda) - E I) = 0$ 中找到本征值 $E_{\\pm}(\\lambda)$：\n$$\n(\\Delta - E)(-\\Delta - E) - \\lambda^{2} = 0 \\implies -(\\Delta^{2} - E^{2}) - \\lambda^{2} = 0 \\implies E^{2} = \\Delta^{2} + \\lambda^{2}\n$$\n两个本征值为 $E_{+}(\\lambda) = \\sqrt{\\Delta^{2} + \\lambda^{2}}$ 和 $E_{-}(\\lambda) = -\\sqrt{\\Delta^{2} + \\lambda^{2}}$。\n\n现在我们寻找相应的本征矢量 $|\\psi_{\\pm}(\\lambda)\\rangle = \\begin{pmatrix} a \\\\ b \\end{pmatrix}$。对于给定的本征值 $E$，其分量满足 $(\\Delta-E)a + \\lambda b = 0$。我们可以将未归一化的本征矢量表示为 $\\begin{pmatrix} \\lambda \\\\ E-\\Delta \\end{pmatrix}$。\n归一化常数 $N$ 可由 $N^{-2} = |\\lambda|^{2} + |E-\\Delta|^{2}$ 求得。我们来计算这个归一化因子：\n$$\n|\\lambda|^{2} + |E_{\\pm}-\\Delta|^{2} = \\lambda^{2} + (E_{\\pm}-\\Delta)^{2} = \\lambda^{2} + E_{\\pm}^{2} - 2\\Delta E_{\\pm} + \\Delta^{2}\n$$\n代入 $E_{\\pm}^{2} = \\Delta^{2} + \\lambda^{2}$，我们得到：\n$$\n= (\\lambda^{2}+\\Delta^{2}) + E_{\\pm}^{2} - 2\\Delta E_{\\pm} = E_{\\pm}^{2} + E_{\\pm}^{2} - 2\\Delta E_{\\pm} = 2E_{\\pm}^{2} - 2\\Delta E_{\\pm} = 2E_{\\pm}(E_{\\pm}-\\Delta)\n$$\n因此，归一化的本征矢量是 $|\\psi_{\\pm}(\\lambda)\\rangle = \\frac{1}{\\sqrt{2E_{\\pm}(E_{\\pm}-\\Delta)}} \\begin{pmatrix} \\lambda \\\\ E_{\\pm}-\\Delta \\end{pmatrix}$。\n\n现在我们计算期望值 $\\langle\\psi_{\\pm}|\\frac{\\partial H}{\\partial\\lambda}|\\psi_{\\pm}\\rangle$：\n$$\n\\frac{dE_{\\pm}}{d\\lambda} = \\frac{1}{2E_{\\pm}(E_{\\pm}-\\Delta)} \\begin{pmatrix} \\lambda & E_{\\pm}-\\Delta \\end{pmatrix} \\begin{pmatrix} 0 & 1 \\\\ 1 & 0 \\end{pmatrix} \\begin{pmatrix} \\lambda \\\\ E_{\\pm}-\\Delta \\end{pmatrix}\n$$\n$$\n= \\frac{1}{2E_{\\pm}(E_{\\pm}-\\Delta)} \\begin{pmatrix} \\lambda & E_{\\pm}-\\Delta \\end{pmatrix} \\begin{pmatrix} E_{\\pm}-\\Delta \\\\ \\lambda \\end{pmatrix}\n$$\n$$\n= \\frac{\\lambda(E_{\\pm}-\\Delta) + (E_{\\pm}-\\Delta)\\lambda}{2E_{\\pm}(E_{\\pm}-\\Delta)} = \\frac{2\\lambda(E_{\\pm}-\\Delta)}{2E_{\\pm}(E_{\\pm}-\\Delta)} = \\frac{\\lambda}{E_{\\pm}}\n$$\n代入 $E_{\\pm}(\\lambda)$ 的表达式：\n$$\n\\frac{dE_{+}(\\lambda)}{d\\lambda} = \\frac{\\lambda}{E_{+}(\\lambda)} = \\frac{\\lambda}{\\sqrt{\\Delta^{2}+\\lambda^{2}}}\n$$\n$$\n\\frac{dE_{-}(\\lambda)}{d\\lambda} = \\frac{\\lambda}{E_{-}(\\lambda)} = \\frac{\\lambda}{-\\sqrt{\\Delta^{2}+\\lambda^{2}}} = -\\frac{\\lambda}{\\sqrt{\\Delta^{2}+\\lambda^{2}}}\n$$\n这就完成了使用 Hellmann-Feynman 定理的计算。\n\n为作独立验证，我们直接对本征值求导。\n$$\nE_{\\pm}(\\lambda) = \\pm\\sqrt{\\Delta^{2} + \\lambda^{2}}\n$$\n$$\n\\frac{dE_{\\pm}(\\lambda)}{d\\lambda} = \\pm \\frac{1}{2\\sqrt{\\Delta^{2}+\\lambda^{2}}} \\cdot (2\\lambda) = \\pm \\frac{\\lambda}{\\sqrt{\\Delta^{2}+\\lambda^{2}}}\n$$\n这证实了我们之前的结果。\n\n最后，我们讨论 Hellmann-Feynman 定理的有效性条件。该推导假设了本征态 $|\\psi_{n}(\\lambda)\\rangle$ 对 $\\lambda$ 是可微的。在能量本征值发生简并的点，这个条件可能会失效。对于给定的哈密顿量，$E_{+}(\\lambda) = E_{-}(\\lambda)$ 仅当 $\\sqrt{\\Delta^{2}+\\lambda^{2}} = -\\sqrt{\\Delta^{2}+\\lambda^{2}}$ 时成立，这意味着 $\\Delta^{2}+\\lambda^{2} = 0$。由于 $\\Delta$ 和 $\\lambda$ 都是实数，这只在 $\\Delta=0$ 且 $\\lambda=0$ 时发生。\n情况1：$\\Delta \\neq 0$。对于任何实数 $\\lambda$，本征值 $E_{+}(\\lambda)$ 和 $E_{-}(\\lambda)$ 永不相等。能谱处处非简并。该定理对所有 $\\lambda \\in \\mathbb{R}$ 都有效。\n情况2：$\\Delta = 0$。哈密顿量为 $H(\\lambda) = \\lambda \\begin{pmatrix} 0 & 1 \\\\ 1 & 0 \\end{pmatrix}$，本征值为 $E_{\\pm}(\\lambda) = \\pm\\sqrt{\\lambda^{2}} = \\pm|\\lambda|$。在 $\\lambda=0$ 处，本征值发生简并，$E_{+}(0) = E_{-}(0) = 0$。函数 $|\\lambda|$ 在 $\\lambda=0$ 处不可微。因此，Hellmann-Feynman 恒等式的左侧 $dE_{\\pm}/d\\lambda$ 在 $\\lambda=0$ 处没有定义。因此，对于 $\\Delta = 0$，该定理在简并点 $\\lambda=0$ 失效。对于任何 $\\lambda \\neq 0$，本征值是非简并的，定理成立。", "answer": "$$\n\\boxed{\\left(\\frac{\\lambda}{\\sqrt{\\Delta^{2} + \\lambda^{2}}}, -\\frac{\\lambda}{\\sqrt{\\Delta^{2} + \\lambda^{2}}}\\right)}\n$$", "id": "2814495"}, {"introduction": "最后的这项实践将连接抽象理论与真实的计算化学世界。你将探索赫尔曼-费曼定理是如何用于计算分子模拟中原子间的作用力，这是分子动力学和几何结构优化的核心环节。这个练习要求你设计一个简化的计算模型，来测试定理的数值实现，并理解变分一致性（variational consistency）这一至关重要的概念。[@problem_id:2814531]", "problem": "设计并实现一个完整的、可运行的程序，该程序在一个与理论化学相关的简化一维平面波框架中，演示、验证和压力测试基于 Hellmann-Feynman 定理的力的实现。从以下基本基础出发：由原子核坐标 $R$ 参数化的电子哈密顿量的时间无关薛定谔方程、归一化本征态的变分原理，以及周期性超晶胞中平面波基组的定义。不使用或假设任何预先推导出的力表达式。相反，需推导出必须计算什么、其有效性为何，以及它如何从这些基本原理中得出。您的程序应实现一个最小的一维平面波模型，该模型具有平滑的局域赝势，并评估在不同数值网格分辨率下 Hellmann-Feynman 力的变分一致性。完全在原子单位（长度单位为玻尔，能量单位为哈特里，力单位为哈特里/玻尔）下工作，并以布尔值的形式返回最终结果，指示指定的数值一致性检查是否在给定容差内通过。\n\n您必须在以下物理上和数值上合理的假设下进行，这些假设在此作为您将实现和测试的模型定义的一部分进行陈述：\n\n- 电子哈密顿量依赖于长度为 $L$ 的周期性晶胞中的单个原子核位置 $R$，在 $\\Gamma$ 点具有平面波基组 $\\{\\lvert G \\rangle\\}$。动能算符在平面波基组中是对角的，其矩阵元为 $T_{GG'}=\\frac{1}{2}G^2 \\,\\delta_{GG'}$，其中 $G=\\frac{2\\pi}{L}n$ 且 $n\\in\\mathbb{Z}$ 受动能截断 $G_{\\text{cut}}$ 限制，满足 $\\lvert G \\rvert \\le G_{\\text{cut}}$。\n- 外部局域赝势是一个以 $R$ 为中心、振幅为 $V_0>0$ 且宽度为 $\\sigma>0$ 的光滑、周期性高斯梳状函数，\n  $$V(x;R) = -V_0 \\sum_{m\\in\\mathbb{Z}} \\exp\\!\\left(-\\frac{(x-R-mL)^2}{2\\sigma^2}\\right),$$\n  这导致其傅里叶系数绝对收敛，并对于波矢 $q$ 以 $\\exp(-\\sigma^2 q^2/2)$ 的形式衰减。\n- 在平面波离散傅里叶变换（数值意义上的 DFT，而非密度泛函理论）中，局域势矩阵元 $V_{GG'}(R)$ 既可以使用解析傅里叶系数在倒易空间中精确构建，也可以通过在具有 $N$ 个点的实空间网格上采样来近似构建，\n  $$V_{GG'}(R) \\approx \\frac{L}{N}\\sum_{j=0}^{N-1} V(x_j;R)\\,e^{-i(G-G')x_j},\\quad x_j=\\frac{jL}{N},$$\n  如果网格的奈奎斯特波数 $G_{\\text{Nyq}}=\\pi N/L$ 未能覆盖平面波哈密顿量所需的所有重要傅里叶分量（特别是对于差值 $G-G'$ 高达 $2G_{\\text{cut}}$ 的支持集以及局域势傅里叶谱的尾部），则会受到混叠效应的影响。这捕捉了控制平面波实现中变分一致性的数值网格考量。\n\n您的程序必须实现以下内容，严格遵守基于原理的推导和数值构建：\n\n1.  根据 $L$ 和 $G_{\\text{cut}}$ 构建平面波基组 $\\{G\\}$。\n2.  以两种方式构建哈密顿矩阵 $H(R)=T+V(R)$：\n    -   一种是倒易空间路径，使用周期性高斯梳状函数的解析傅里叶表示，确保对于在 $H(R)$ 中使用的任何截断值都能进行无混叠构建。\n    -   一种是实空间网格路径，通过在晶胞中的 $N$ 个网格点上对 $V(x;R)$ 进行采样，并通过离散傅里叶求和来组装 $V_{GG'}(R)$。\n3.  求解厄米本征问题 $H(R)\\lvert \\psi(R)\\rangle = E(R)\\lvert \\psi(R)\\rangle$，得到基态能量 $E(R)$ 和平面波基组中的归一化本征向量系数 $c_G(R)$。\n4.  计算 Hellmann-Feynman 力，该力定义为总电子能量对原子核坐标 $R$ 的负导数，使用哈密顿量对 $R$ 的导数来评估，即仅使用算符导数和在 $R$ 处的归一化本征向量。基组必须被视为与 $R$ 无关（这与固定晶胞中的平面波一致），因此在该模型中不会出现 Pulay 项。\n5.  独立地，使用中心差分法计算能量导数的有限差分估计，\n    $$\\frac{dE}{dR}\\bigg\\rvert_{R} \\approx \\frac{E(R+h)-E(R-h)}{2h},$$\n    其中 $h$ 是一个很小的位移。\n6.  对于指定的测试用例，使用相同或不同的哈密顿量构建路径，比较 Hellmann-Feynman 力与中心差分导数，以评估在网格分辨率变化下的变分一致性。对每种情况返回一个布尔值，报告其绝对差值是否小于指定的容差。\n\n作为您推导和实施计划的一部分，您必须确保以下概念的覆盖，即使您的数值模型仅包含局域势：\n-   枚举在一个完整的平面波 Kohn-Sham 密度泛函理论（DFT）代码中对力有贡献的各项，以展示对完备性的理解：局域赝势、可分离的非局域赝势投影算符、Hartree 能量贡献、交换关联能量贡献以及离子-离子相互作用（例如，通过 Ewald 求和）。说明在使用固定的平面波基组时 Pulay 项在何处消失，并解释增广项在诸如投影缀加波（PAW）方法或超软赝势等方法中的作用。\n-   解释为确保能量及其导数一致所需的数值网格考量，包括网格需要能够表示高达约 $2G_{\\text{cut}}$ 的傅里叶分量（用于算符乘积）以及来自外部势谱的任何额外尾部。将此与常见的实践规则联系起来，例如密度网格截断和用于混叠控制的所谓“3/2规则”启发式方法。\n\n使用下面的参数值作为测试套件。如上所述，所有输入均为原子单位且无量纲，不使用角度。您的代码必须在内部设置这些参数并产生输出，无需任何用户输入。\n\n-   晶胞长度: $L=20$。\n-   平面波截断: $G_{\\text{cut}}=2.5$。\n-   高斯赝势参数: $V_0=2.0$, $\\sigma=1.0$。\n-   原子核位置: $R_0=5.3$。\n-   中心差分步长: $h=10^{-4}$。\n-   用于测试的实空间网格尺寸：\n    -   情况 A（参考，仅倒易空间）：Hellmann-Feynman 力和能量导数均由倒易空间哈密顿量构建，无实空间采样。\n    -   情况 B（网格，充分解析）：Hellmann-Feynman 力和能量导数均由具有 $N=128$ 的实空间采样构建，这应足以表示高达约 $2G_{\\text{cut}}$ 的差值以及 $\\sigma=1.0$ 的高斯尾部。\n    -   情况 C（不匹配，故意不一致）：Hellmann-Feynman 力由具有 $N=32$ 的实空间网格构建，而能量导数由倒易空间构建。这种不匹配预计会破坏变分一致性。\n    -   情况 D（网格，欠采样但内部一致）：Hellmann-Feynman 力和能量导数均由具有 $N=32$ 的实空间网格构建。虽然表示可能不准确，但内部一致性应该成立。\n\n每种情况的数值接受标准：\n-   如果 $\\lvert F_{\\text{HF}} - \\frac{E(R+h)-E(R-h)}{2h} \\rvert < \\tau$，则生成一个布尔值 $ \\text{True}$，否则为 $ \\text{False}$，其中 $\\tau=10^{-5}$。\n\n您的程序应产生单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，顺序为 $[\\text{情况 A},\\text{情况 B},\\text{情况 C},\\text{情况 D}]$。\n\n最终输出必须匹配此确切格式，例如，$[\\text{True},\\text{True},\\text{False},\\text{True}]$（确切的布尔值必须由您的计算确定）。", "solution": "所提出的问题是计算理论化学中一个有效且适定的练习。它要求在简化的一维平面波模型框架内，演示 Hellmann-Feynman 定理并分析其数值-变分一致性。所有必要的物理参数、数学定义和数值约束都已提供，从而可以得到一个唯一且可验证的解。该问题在科学上植根于量子力学和电子结构理论的标准数值技术。我将进行完整的推导和实现。\n\n此分析的基础是描述一个电子系统的时间无关薛定谔方程，其中哈密顿量 $H(\\lambda)$ 依赖于一个参数 $\\lambda$。在我们的案例中，$\\lambda$ 是原子核坐标，我们用 $R$ 表示。方程为：\n$$ H(R) |\\psi(R)\\rangle = E(R) |\\psi(R)\\rangle $$\n其中 $|\\psi(R)\\rangle$ 是一个本征态，其对应的能量本征值为 $E(R)$。我们考虑基态，此时能量为最小值，且波函数是归一化的，$\\langle \\psi(R) | \\psi(R) \\rangle = 1$。\n\n能量可以表示为哈密顿量的期望值：\n$$ E(R) = \\langle \\psi(R) | H(R) | \\psi(R) \\rangle $$\n在位置 $R$ 处的原子核上的力定义为总能量的负梯度，即 $F(R) = -\\frac{dE(R)}{dR}$。为了推导 Hellmann-Feynman 定理，我们使用乘法法则对能量表达式关于 $R$ 求导：\n$$ \\frac{dE}{dR} = \\left\\langle \\frac{d\\psi}{dR} \\right| H | \\psi \\rangle + \\left\\langle \\psi \\left| \\frac{\\partial H}{\\partial R} \\right| \\psi \\right\\rangle + \\left\\langle \\psi \\right| H \\left| \\frac{d\\psi}{dR} \\right\\rangle $$\n由于 $|\\psi\\rangle$ 是一个本征态，所以 $H|\\psi\\rangle = E|\\psi\\rangle$。第一项变为 $E\\langle \\frac{d\\psi}{dR} | \\psi \\rangle$。利用哈密顿量的厄米性，$H^\\dagger=H$，最后一项变为 $\\langle H\\psi | \\frac{d\\psi}{dR} \\rangle = \\langle E\\psi | \\frac{d\\psi}{dR} \\rangle = E^* \\langle \\psi | \\frac{d\\psi}{dR} \\rangle$。由于厄米算符的能量本征值为实数，因此 $E^*=E$。第一项和最后一项的和为：\n$$ E \\left( \\left\\langle \\frac{d\\psi}{dR} | \\psi \\right\\rangle + \\left\\langle \\psi | \\frac{d\\psi}{dR} \\right\\rangle \\right) = E \\frac{d}{dR} \\langle \\psi | \\psi \\rangle $$\n因为波函数是归一化的，$\\langle \\psi | \\psi \\rangle = 1$，所以其导数为零。因此，这两项相互抵消，得到 Hellmann-Feynman 定理：\n$$ \\frac{dE}{dR} = \\left\\langle \\psi(R) \\left| \\frac{\\partial H(R)}{\\partial R} \\right| \\psi(R) \\right\\rangle $$\n因此，力由哈密顿量导数的期望值给出：\n$$ F_{\\text{HF}}(R) = - \\left\\langle \\psi(R) \\left| \\frac{\\partial H(R)}{\\partial R} \\right| \\psi(R) \\right\\rangle $$\n该定理有效的条件是 $|\\psi(R)\\rangle$ 是 $H(R)$ 的精确本征态。变分原理确保了它对于通过变分计算得到的波函数也成立，这是像 Hartree-Fock 和密度泛函理论（DFT）这类方法的基石。\n\n在我们的平面波模型中，哈密顿量是 $H(R) = T + V(R)$。动能算符 $T$ 和平面波基函数 $\\{|G\\rangle\\}$ 与原子核位置 $R$ 无关。基函数由 $\\langle x | G \\rangle = (1/\\sqrt{L})e^{iGx}$ 给出，是相对于模拟晶胞固定的。因此，哈密顿量中唯一依赖于 $R$ 的部分是势算符 $V(R)$。力的表达式简化为：\n$$ F_{\\text{HF}}(R) = - \\left\\langle \\psi(R) \\left| \\frac{\\partial V(R)}{\\partial R} \\right| \\psi(R) \\right\\rangle $$\n\n将基态波函数 $|\\psi\\rangle$ 在平面波基组中展开，即 $|\\psi\\rangle = \\sum_G c_G |G\\rangle$，力以矩阵形式计算：\n$$ F_{\\text{HF}} = - \\sum_{G, G'} c_{G'}^* \\left\\langle G' \\left| \\frac{\\partial V(R)}{\\partial R} \\right| G \\right\\rangle c_G = - \\mathbf{c}^\\dagger \\left( \\frac{\\partial \\mathbf{V}}{\\partial R} \\right) \\mathbf{c} $$\n其中 $\\mathbf{c}$ 是系数 $c_G$ 的列向量，而 $\\frac{\\partial \\mathbf{V}}{\\partial R}$ 是势导数算符的矩阵。\n\n该问题要求对完整平面波 DFT 计算中的力进行更广泛的概念性讨论。作用在离子上的总力是几个贡献之和：\n1.  **局域赝势**：对应于本问题中的项。它是赝势局域部分导数的期望值。\n2.  **非局域赝势**：大多数现代赝势包含非局域投影算符。其力的贡献涉及这些投影算符对原子位置的导数。\n3.  **Hartree 势**：电子经典静电能的导数。它依赖于电子密度对原子核坐标的导数。\n4.  **交换关联 (XC)**：该力项产生于交换关联能量泛函对原子核位置的导数，此过程也通过链式法则，经由电子密度及其梯度进行。\n5.  **离子-离子相互作用**：原子核之间的直接经典库仑力，通常对于周期性体系通过 Ewald 求和计算。\n\n如所推导，Hellmann-Feynman 定理假设基组与求导参数 $R$ 无关。在平面波基组中，基向量与模拟晶胞而非原子绑定，因此它们确实与 $R$ 无关。这意味着没有 **Pulay 力**（也称为 Pulay 修正）。Pulay 力出现在使用原子中心基组（如高斯型轨道）的方法中，其中基函数随原子移动。这些力是解释基组本身变化的修正项。在诸如投影缀加波（PAW）等高级方法中，额外的力项来自于位于原子上的增广电荷的导数，必须小心处理。\n\n数值实现的一个关键方面是**变分一致性**。Hellmann-Feynman 定理的有效性依赖于波函数是所用*精确*哈密顿量的本征态。在数值计算中，如果我们使用一个近似的哈密顿量 $\\tilde{H}$（例如，在粗糙的实空间网格上构建），那么计算出的力 $F_{\\text{HF}} = -\\langle \\tilde{\\psi} | \\partial \\tilde{H}/\\partial R | \\tilde{\\psi} \\rangle$ 只有在使用*相同*的近似方案 $\\tilde{H}$ 进行两种计算时，才会与有限差分力 $F_{\\text{FD}} = -(\\tilde{E}(R+h)-\\tilde{E}(R-h))/(2h)$ 保持一致。方案不匹配，例如对 $F_{\\text{HF}}$ 使用粗糙网格而对 $F_{\\text{FD}}$ 使用精确公式，会破坏这种变分一致性并导致差异。\n\n这种一致性主要由用于表示算符的实空间网格的分辨率决定。两个基函数的乘积，$\\langle G'|...|G \\rangle$，涉及像 $e^{-i(G-G')x}$ 这样的项。在平面波截断值为 $G_{\\text{cut}}$ 的情况下，差分向量 $G-G'$ 的大小可达 $2G_{\\text{cut}}$。对于势矩阵元 $\\langle G'|V|G\\rangle = \\int V(x) e^{-i(G-G')x} dx$，网格必须足够精细，以便在没有显著混叠的情况下表示高达 $2G_{\\text{cut}}$ 的振荡以及势 $V(x)$ 的傅里叶分量。网格的奈奎斯特频率 $G_{\\text{Nyq}} = \\pi N/L$ 必须大于被变换量的最大频率内容。一个常见的经验法则是使用能够表示密度的网格，这涉及高达 $2G_{\\text{cut}}$ 的频率。有时，对于具有尖锐特征的势，需要更密的网格。“3/2规则”是在某些情况下使用的一种启发式方法，用于在 FFTs 之前填充数组，以完全消除二次量的混叠。在这个问题中，我们将直接测试这个原理。\n\n现在，我们继续进行实现，该实现分为四个测试用例来验证这些概念。\n\n-   **情况 A**（参考）：两种力的计算都使用解析的、无混叠的倒易空间哈密顿量。预计这将是一致的。\n-   **情况 B**（足够精细的网格）：两种计算都使用一个精细的实空间网格 ($N=128$)，这足以精确地表示哈密顿量。预计会有一致性。\n-   **情况 C**（不匹配）：Hellmann-Feynman 力使用粗糙网格 ($N=32$)，而能量导数使用精确的倒易空间哈密顿量。变分一致性被破坏，预计会出现不匹配。\n-   **情况 D**（一致但粗糙）：两种计算都使用相同的粗糙网格 ($N=32$)。尽管绝对结果可能不准确，但这两种计算力的方法应该相互一致。\n\n实现将根据问题定义构建哈密顿矩阵，求解得到的本征问题以获得基态，并为每种情况计算力以验证这些预测。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to demonstrate and test the Hellmann-Feynman theorem.\n    \"\"\"\n    \n    # --- Model Parameters (atomic units) ---\n    L = 20.0       # Cell length\n    G_cut = 2.5    # Plane-wave kinetic energy cutoff\n    V0 = 2.0       # Pseudopotential amplitude\n    sigma = 1.0    # Pseudopotential width\n    R0 = 5.3       # Nuclear position\n    h = 1.0e-4     # Central-difference step\n    tau = 1.0e-5   # Tolerance for comparison\n\n    # --- Test Case Definitions ---\n    # (N_hf, N_fd): Grid points for Hellmann-Feynman and Finite-Difference calculations.\n    # None indicates using the exact reciprocal-space representation.\n    test_cases_params = [\n        ('Case A (reciprocal only)', None, None),\n        ('Case B (grid, adequately resolved)', 128, 128),\n        ('Case C (mismatched, inconsistent)', 32, None),\n        ('Case D (grid, undersampled but consistent)', 32, 32),\n    ]\n\n    # --- Generate Plane-Wave Basis ---\n    n_max = int(np.floor(G_cut * L / (2.0 * np.pi)))\n    G_vec = (2.0 * np.pi / L) * np.arange(-n_max, n_max + 1)\n    T_matrix = 0.5 * np.diag(G_vec**2)\n    \n    # --- Helper Functions ---\n\n    def _get_periodic_potential(x_grid, R):\n        \"\"\"Calculates V(x;R) on a grid, handling periodic images of the potential.\"\"\"\n        # Find the distance to the nearest periodic image of R for each x\n        dist = x_grid - R\n        dist_periodic = dist - L * np.round(dist / L)\n        return -V0 * np.exp(-dist_periodic**2 / (2.0 * sigma**2))\n\n    def _get_periodic_potential_derivative(x_grid, R):\n        \"\"\"Calculates dV(x;R)/dR on a grid.\"\"\"\n        dist = x_grid - R\n        dist_periodic = dist - L * np.round(dist / L)\n        V_val = -V0 * np.exp(-dist_periodic**2 / (2.0 * sigma**2))\n        # d/dR = -d/dx\n        # d/dR exp(-(x-R)^2 / 2*sigma^2) = exp(...) * -(x-R)/sigma^2 * (-1)\n        # So it is V(x;R) * (x_periodic - R) / sigma^2, but our x is x_grid, R is R.\n        # The relevant distance is dist_periodic = x_grid - R_eff\n        # So dV/dR = V * (x - R_eff) / sigma^2 is incorrect. Chain rule:\n        # d/dR V(x;R) = -(-1/sigma^2)(x-R_eff) * V(x;R) = V(x;R) * (x-R_eff)/sigma^2\n        # where R_eff is the periodic image of R closest to x. So x-R_eff = dist_periodic\n        return V_val * dist_periodic / sigma**2\n        \n    def build_hamiltonian(R, N):\n        \"\"\"Constructs the Hamiltonian matrix H(R) = T + V(R).\"\"\"\n        num_basis = len(G_vec)\n        V_matrix = np.zeros((num_basis, num_basis), dtype=np.complex128)\n        \n        # Create a mesh of q = G - G' vectors\n        G_prime_mesh, G_mesh = np.meshgrid(G_vec, G_vec)\n        q_mesh = G_mesh - G_prime_mesh\n        \n        if N is None: # Reciprocal-space route\n            # V_{GG'} = Integral[ V(x)exp(-i(G-G')x) ] dx\n            # This integral equals L * V_fourier_coeff(q=G-G')\n            # The problem statement's real-space sum implies we want the integral itself.\n            # I_V(q) = -V0 * sqrt(2*pi)*sigma * exp(-iqR) * exp(-sigma^2*q^2/2)\n            v_analytic = -V0 * np.sqrt(2.0 * np.pi) * sigma * np.exp(-1j * q_mesh * R) * \\\n                         np.exp(-0.5 * sigma**2 * q_mesh**2)\n            V_matrix = v_analytic\n        else: # Real-space grid route\n            x_grid = np.linspace(0, L, N, endpoint=False)\n            v_real = _get_periodic_potential(x_grid, R)\n            \n            # Use FFT for efficiency. V_GG' = (L/N) * sum_j V(x_j) exp(-i(G-G')x_j)\n            # This is (L/N) * N * ifft(V) at frequencies corresponding to q.\n            # It's safer to compute directly via sums to match definition.\n            # Using broadcasting for speed:\n            exp_term = np.exp(-1j * np.outer(q_mesh.flatten(), x_grid))\n            v_fourier = exp_term @ v_real\n            V_matrix = (L / N) * v_fourier.reshape(num_basis, num_basis)\n            \n        return T_matrix + V_matrix\n\n    def get_ground_state(H):\n        \"\"\"Solves the eigenproblem for the ground state.\"\"\"\n        eigvals, eigvecs = np.linalg.eigh(H)\n        ground_energy = eigvals[0]\n        ground_state_vec = eigvecs[:, 0]\n        return ground_energy, ground_state_vec\n\n    def compute_hf_force(R, c_vec, N):\n        \"\"\"Computes the Hellmann-Feynman force.\"\"\"\n        num_basis = len(G_vec)\n        dV_dR_matrix = np.zeros((num_basis, num_basis), dtype=np.complex128)\n        \n        G_prime_mesh, G_mesh = np.meshgrid(G_vec, G_vec)\n        q_mesh = G_mesh - G_prime_mesh\n        \n        if N is None: # Reciprocal-space route\n            # dV_{GG'}/dR = -i(G-G') * V_{GG'}\n            v_analytic = -V0 * np.sqrt(2.0 * np.pi) * sigma * np.exp(-1j * q_mesh * R) * \\\n                         np.exp(-0.5 * sigma**2 * q_mesh**2)\n            dV_dR_matrix = -1j * q_mesh * v_analytic\n        else: # Real-space grid route\n            x_grid = np.linspace(0, L, N, endpoint=False)\n            dv_dr_real = _get_periodic_potential_derivative(x_grid, R)\n            \n            exp_term = np.exp(-1j * np.outer(q_mesh.flatten(), x_grid))\n            dv_dr_fourier = exp_term @ dv_dr_real\n            dV_dR_matrix = (L / N) * dv_dr_fourier.reshape(num_basis, num_basis)\n\n        force = -np.vdot(c_vec, dV_dR_matrix @ c_vec)\n        return force.real\n\n    def run_case(N_hf, N_fd):\n        \"\"\"Runs a single test case comparing HF and FD forces.\"\"\"\n        # 1. Compute Hellmann-Feynman force at R0\n        H_hf = build_hamiltonian(R0, N_hf)\n        _, c0 = get_ground_state(H_hf)\n        f_hf = compute_hf_force(R0, c0, N_hf)\n        \n        # 2. Compute Finite Difference force around R0\n        H_plus = build_hamiltonian(R0 + h, N_fd)\n        E_plus, _ = get_ground_state(H_plus)\n        \n        H_minus = build_hamiltonian(R0 - h, N_fd)\n        E_minus, _ = get_ground_state(H_minus)\n        \n        f_fd = -(E_plus - E_minus) / (2.0 * h)\n        \n        # 3. Compare and return boolean\n        is_consistent = np.abs(f_hf - f_fd)  tau\n        return is_consistent\n\n    # --- Execute Test Cases ---\n    results = []\n    for _, N_hf, N_fd in test_cases_params:\n        result = run_case(N_hf, N_fd)\n        results.append(str(result))\n        \n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2814531"}]}