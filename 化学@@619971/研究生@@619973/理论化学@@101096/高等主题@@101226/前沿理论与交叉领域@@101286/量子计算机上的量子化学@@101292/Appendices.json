{"hands_on_practices": [{"introduction": "在将任何量子化学问题部署到量子计算机之前，我们必须首先精确地构建其数学表示。这项实践的核心是从第一性原理出发，利用给定的单电子和双电子积分，手动构建一个小型分子的完整哈密顿量矩阵，即全组态相互作用（FCI）矩阵。通过这个过程，你将加深对电子哈密顿量结构 $H$ 的理解，并将抽象的二次量子化形式转化为一个具体的、可对角化的数值对象 [@problem_id:2797542]——这正是量子算法旨在求解的目标。", "id": "2797542", "problem": "考虑一个非相对论性的、固定原子核的二次量子化下的双电子问题，该问题有四个标准正交的自旋轨道，由索引 $p \\in \\{1,2,3,4\\}$ 标记，分别对应于 $\\{1\\alpha, 1\\beta, 2\\alpha, 2\\beta\\}$。电子哈密顿量为\n$$\n\\hat{H} \\;=\\; \\sum_{p,q} h_{pq}\\, \\hat{a}_{p}^{\\dagger}\\hat{a}_{q} \\;+\\; \\frac{1}{2}\\sum_{p,q,r,s} (pq|rs)\\, \\hat{a}_{p}^{\\dagger}\\hat{a}_{q}^{\\dagger}\\hat{a}_{s}\\hat{a}_{r},\n$$\n其中 $\\hat{a}_{p}^{\\dagger}$ 和 $\\hat{a}_{p}$ 是费米子产生和湮灭算符，遵循正则反对易关系，$h_{pq}$ 是单电子积分，而 $(pq|rs)$ 是化学家标记法下的双电子库仑积分。所有量均以 Hartree 原子单位表示。\n\n给定以下非零单电子积分 $h_{pq}$（厄米共轭，故 $h_{pq}=h_{qp}$）：\n- $h_{11} = h_{22} = -1.000$, $h_{33} = h_{44} = -0.500$,\n- $h_{13} = h_{31} = -0.100$, $h_{24} = h_{42} = -0.100$,\n- 所有其他 $h_{pq} = 0$。\n\n双电子自旋轨道积分 $(pq|rs)$ 由以下非零空间轨道库仑交换数据构建，所有排列对称性均已考虑，所有其他空间积分为零：\n- $(11|11) = 0.700$, $(22|22) = 0.600$,\n- $(11|22) = (22|11) = 0.500$,\n- $(12|21) = (21|12) = 0.200$,\n- 所有其他空间 $(\\mu\\nu|\\lambda\\kappa) = 0$。\n通过自旋选择定则映射到自旋轨道积分：$(p q|r s)$ 仅在 $p$ 的自旋等于 $r$ 的自旋且 $q$ 的自旋等于 $s$ 的自旋时才非零，此时 $(p q|r s)$ 等于相应的空间积分 $(\\mu\\nu|\\lambda\\kappa)$，其中 $p\\to\\mu$, $q\\to\\nu$, $r\\to\\lambda$, $s\\to\\kappa$ 表示相关的空间轨道标签。\n\n在由四个自旋轨道构建的所有双电子行列式组成的 Slater 行列式基组中进行计算，按自旋轨道索引递增排序以固定相位：\n- $\\lvert D_{1} \\rangle = \\lvert 1,2 \\rangle$, $\\lvert D_{2} \\rangle = \\lvert 1,3 \\rangle$, $\\lvert D_{3} \\rangle = \\lvert 1,4 \\rangle$,\n- $\\lvert D_{4} \\rangle = \\lvert 2,3 \\rangle$, $\\lvert D_{5} \\rangle = \\lvert 2,4 \\rangle$, $\\lvert D_{6} \\rangle = \\lvert 3,4 \\rangle$。\n\n任务：\n1. 从二次量子化的哈密顿量和费米子反对易关系出发，通过直接计算给定 $h_{pq}$ 和 $(pq|rs)$ 的所有矩阵元 $\\langle D_{I} \\lvert \\hat{H} \\rvert D_{J} \\rangle$，在上述行列式基组中构建完整的 $6\\times 6$ 全组态相互作用 (FCI) 哈密顿矩阵。\n2. 使用您构建的矩阵，明确验证其厄米性以及与反对称性的一致性（即由反对易和 $(pq|rs)$ 的对称性推导出的 Slater-Condon 规则所蕴含的结构）。\n3. FCI 哈密顿矩阵的迹是多少？以 Hartree 为单位表示最终答案。无需四舍五入，报告精确值。", "solution": "问题陈述是量子化学中一个标准的、适定的问题，具体是在四个自旋轨道基组内对一个双电子系统进行全组态相互作用 (FCI) 计算。该问题具有科学依据，是完整且客观的。没有瑕疵。我们开始解题。\n\n解答需要构建在给定的 Slater 行列式基组中的 $6 \\times 6$ 哈密顿矩阵 $\\mathbf{H}$。矩阵元 $H_{IJ} = \\langle D_{I} | \\hat{H} | D_{J} \\rangle$ 使用 Slater-Condon 规则进行计算，这些规则是将二次量子化的哈密顿量应用于 Slater 行列式，并使用费米子反对易关系 $\\{\\hat{a}_p, \\hat{a}_q\\} = 0$, $\\{\\hat{a}_p^\\dagger, \\hat{a}_q^\\dagger\\} = 0$ 和 $\\{\\hat{a}_p, \\hat{a}_q^\\dagger\\} = \\delta_{pq}$ 的直接结果。\n\n基行列式为：\n$\\lvert D_{1} \\rangle = \\lvert 1,2 \\rangle$ ($M_S=0$), $\\lvert D_{2} \\rangle = \\lvert 1,3 \\rangle$ ($M_S=1$), $\\lvert D_{3} \\rangle = \\lvert 1,4 \\rangle$ ($M_S=0$),\n$\\lvert D_{4} \\rangle = \\lvert 2,3 \\rangle$ ($M_S=0$), $\\lvert D_{5} \\rangle = \\lvert 2,4 \\rangle$ ($M_S=-1$), $\\lvert D_{6} \\rangle = \\lvert 3,4 \\rangle$ ($M_S=0$)。\n\n哈密顿量是非相对论性的且与自旋无关，因此它与总自旋投影算符 $\\hat{S}_z$ 对易。这意味着哈密顿矩阵在行列式基组中是块对角的，非零元仅存在于具有相同 $M_S$ 值的行列式之间。基组分为三个块：$M_S=1$ ($\\{D_2\\}$)，$M_S=-1$ ($\\{D_5\\}$)，和 $M_S=0$ ($\\{D_1, D_3, D_4, D_6\\}$)。\n\n首先，我们必须根据给定的空间积分 $(\\mu\\nu|\\lambda\\kappa)$ 和选择定则，推导出必要的非零自旋轨道积分 $(pq|rs)$。自旋轨道的映射关系为 $1 \\to (1, \\alpha)$，$2 \\to (1, \\beta)$，$3 \\to (2, \\alpha)$，$4 \\to (2, \\beta)$。\n一个积分 $(pq|rs)$ 仅在 $\\sigma(p)=\\sigma(r)$ 且 $\\sigma(q)=\\sigma(s)$ 时非零，其值由空间积分 $(\\mu(p)\\mu(q)|\\mu(r)\\mu(s))$ 给出。\n\n由 $(11|11) = 0.700$ 得：$(12|12)=0.700$。其他像 $(11|11)$ 这样的积分不会被使用，因为它们涉及一对相同的自旋轨道。\n由 $(22|22) = 0.600$ 得：$(34|34)=0.600$。\n由 $(11|22) = 0.500$ 得：这对应于 $\\mu(p)=1, \\mu(q)=1, \\mu(r)=2, \\mu(s)=2$。根据自旋规则，这生成了 $(12|34)=0.500$（自旋 $(\\alpha,\\beta) \\to (\\alpha,\\beta)$）和 $(21|43)=0.500$（自旋 $(\\beta,\\alpha) \\to (\\beta,\\alpha)$）。\n由 $(12|21) = 0.200$ 得：这对应于 $\\mu(p)=1, \\mu(q)=2, \\mu(r)=2, \\mu(s)=1$。这生成了 $(13|31)=0.200$（自旋 $(\\alpha,\\alpha) \\to (\\alpha,\\alpha)$），$(24|42)=0.200$（自旋 $(\\beta,\\beta) \\to (\\beta,\\beta)$），$(14|32)=0.200$（自旋 $(\\alpha,\\beta) \\to (\\alpha,\\beta)$），以及 $(23|41)=0.200$（自旋 $(\\beta,\\alpha) \\to (\\beta,\\alpha)$）。\n\n现在我们应用 Slater-Condon 规则。\n对于对角元 $\\langle D | \\hat{H} | D \\rangle$ 其中 $|D\\rangle = |i,j\\rangle$：\n$\\langle i,j | \\hat{H} | i,j \\rangle = h_{ii} + h_{jj} + (ij|ij) - (ij|ji)$。\n$H_{11} = \\langle 1,2|\\hat{H}|1,2\\rangle = h_{11}+h_{22}+(12|12)-(12|21) = -1.000-1.000+0.700-0 = -1.300$。\n$H_{22} = \\langle 1,3|\\hat{H}|1,3\\rangle = h_{11}+h_{33}+(13|13)-(13|31) = -1.000-0.500+0-0.200 = -1.700$。\n$H_{33} = \\langle 1,4|\\hat{H}|1,4\\rangle = h_{11}+h_{44}+(14|14)-(14|41) = -1.000-0.500+0-0 = -1.500$。\n$H_{44} = \\langle 2,3|\\hat{H}|2,3\\rangle = h_{22}+h_{33}+(23|23)-(23|32) = -1.000-0.500+0-0 = -1.500$。\n$H_{55} = \\langle 2,4|\\hat{H}|2,4\\rangle = h_{22}+h_{44}+(24|24)-(24|42) = -1.000-0.500+0-0.200 = -1.700$。\n$H_{66} = \\langle 3,4|\\hat{H}|3,4\\rangle = h_{33}+h_{44}+(34|34)-(34|43) = -0.500-0.500+0.600-0 = -0.400$。\n\n对于相差一个自旋轨道的行列式之间的非对角元，例如 $\\langle i,j|\\hat{H}|k,j\\rangle$（激发 $i \\to k$）：\n$H_I \\neq H_J$：$\\langle i,j|\\hat{H}|k,j\\rangle = \\pm (h_{ik} + (ij|kj)-(ij|jk))$。符号取决于算符的排序。\n$H_{13}=\\langle 1,2|\\hat{H}|1,4\\rangle$：激发 $2 \\to 4$，共同轨道为 $1$。矩阵元为 $h_{24} + (21|41) - (21|14) = -0.100+0-0 = -0.100$。\n$H_{14}=\\langle 1,2|\\hat{H}|2,3\\rangle$：激发 $1 \\to 3$，共同轨道为 $2$。经过轨道顺序的符号校正后，矩阵元为 $-h_{13} - ((12|32)-(12|23)) = -(-0.100) - (0-0) = 0.100$。\n$H_{36}=\\langle 1,4|\\hat{H}|3,4\\rangle$：激发 $1 \\to 3$，共同轨道为 $4$。矩阵元为 $h_{13} + (14|34) - (14|43) = -0.100+0-0 = -0.100$。\n$H_{46}=\\langle 2,3|\\hat{H}|3,4\\rangle$：激发 $2 \\to 4$，共同轨道为 $3$。经过符号校正后，矩阵元为 $-h_{24} - ((23|43)-(23|34)) = -(-0.100) - (0-0) = 0.100$。\n\n对于相差两个自旋轨道的行列式之间的非对角元，例如 $\\langle i,j|\\hat{H}|k,l\\rangle$：\n$H_I \\neq H_J$: $\\langle i,j|\\hat{H}|k,l\\rangle = \\pm ((ij|kl)-(ij|lk))$。\n$H_{16}=\\langle 1,2|\\hat{H}|3,4\\rangle$：激发 $(1,2) \\to (3,4)$。矩阵元为 $(12|34) - (12|43) = 0.500-0 = 0.500$。\n$H_{34}=\\langle 1,4|\\hat{H}|2,3\\rangle$：激发 $(1,4) \\to (2,3)$。矩阵元为 $(14|23)-(14|32) = 0-0.200 = -0.200$。\n\n所有其他非对角矩阵元均为零，这是由于 $M_S$ 守恒或因为相关积分为零。\n\n**1. 全 CI 哈密顿矩阵**\n将这些矩阵元组合起来，得到 $6 \\times 6$ 的 FCI 矩阵 $\\mathbf{H}$：\n$$\n\\mathbf{H} =\n\\begin{pmatrix}\n-1.300 & 0 & -0.100 & 0.100 & 0 & 0.500 \\\\\n0 & -1.700 & 0 & 0 & 0 & 0 \\\\\n-0.100 & 0 & -1.500 & -0.200 & 0 & -0.100 \\\\\n0.100 & 0 & -0.200 & -1.500 & 0 & 0.100 \\\\\n0 & 0 & 0 & 0 & -1.700 & 0 \\\\\n0.500 & 0 & -0.100 & 0.100 & 0 & -0.400\n\\end{pmatrix}\n$$\n\n**2. 厄米性和一致性**\n构建的矩阵是显式厄米的，因为对所有 $I,J$ 都有 $H_{IJ} = H_{JI}$（因为所有元都是实数）。该结构完全符合 Slater-Condon 规则和基本对称性的推论。相对于 $M_S$ 的块对角性质是明显的：如果 $D_I$ 和 $D_J$ 具有不同的 $M_S$ 值，则矩阵元 $H_{IJ}$ 为零。具体来说，基态 $D_2$ ($M_S=1$) 和 $D_5$ ($M_S=-1$) 与所有其他态以及彼此之间是解耦的。余下的态 $D_1, D_3, D_4, D_6$ 构成了 $M_S=0$ 块。这证实了计算的物理一致性。\n\n**3. FCI 哈密顿矩阵的迹**\n矩阵的迹是对角元之和。\n$$ \\text{Tr}(\\mathbf{H}) = \\sum_{I=1}^{6} H_{II} $$\n$$ \\text{Tr}(\\mathbf{H}) = (-1.300) + (-1.700) + (-1.500) + (-1.500) + (-1.700) + (-0.400) $$\n$$ \\text{Tr}(\\mathbf{H}) = -8.100 $$\n迹为 $-8.100$ Hartree。\n\n作为验证，迹也可以计算为所有行列式上的哈密顿量期望值之和。对于一个在 $N=4$ 个自旋轨道基组中的双电子系统，这为：\n$$ \\text{Tr}(\\mathbf{H}) = \\binom{N-2}{n-1}\\sum_{p=1}^N h_{pp} + \\binom{N-2}{n-2}\\sum_{p<q}^N \\left((pq|pq) - (pq|qp)\\right) $$\n对于 $N=4, n=2$：\n$$ \\text{Tr}(\\mathbf{H}) = \\binom{2}{1}\\sum_{p=1}^4 h_{pp} + \\binom{2}{0}\\sum_{p<q}^4 \\left((pq|pq) - (pq|qp)\\right) $$\n$$ \\text{Tr}(\\mathbf{H}) = 2(h_{11}+h_{22}+h_{33}+h_{44}) + \\sum_{1 \\le p < q \\le 4} \\left((pq|pq) - (pq|qp)\\right) $$\n单电子部分为 $2(-1.000-1.000-0.500-0.500) = 2(-3.000) = -6.000$。\n双电子部分是先前计算的每个对角元中的双电子贡献之和：$(0.700) + (-0.200) + (0) + (0) + (-0.200) + (0.600) = 0.900$。\n注意到，包含任意给定轨道 $p$ 的行列式有 $\\binom{4-1}{2-1} = 3$ 个。因此，对迹的单电子贡献是 $\\sum_p 3 h_{pp} = 3(-3.000) = -9.000$。双电子贡献是 $\\sum_{p<q} ((pq|pq)-(pq|qp)) = 0.900$。总迹是 $-9.000 + 0.900 = -8.100$。\n两种方法得出相同的结果，证实了计算的正确性。", "answer": "$$\\boxed{-8.100}$$"}, {"introduction": "一旦我们定义了问题的哈密顿量，下一步就是设计一种能在量子计算机上制备试探波函数（即“ansatz”）的方法。这项实践涉及一个关键的转换步骤：将化学中描述电子激发的算符（如在UCCSD理论中使用的）翻译成量子计算机的基本语言——泡利算符串 [@problem_id:2797393]。通过计算一个特定激发操作所需的CNOT门数量，你还将接触到量子资源估算这一实用问题，这对于评估未来量子算法的可行性至关重要。", "id": "2797393", "problem": "考虑在从费米子到量子比特的 Jordan–Wigner (JW) 映射下，逐项分析酉耦合簇单双激发 (UCCSD) 拟设。您将使用一个包含 $8$ 个自旋轨道的寄存器，这些自旋轨道线性排序，并按递增顺序索引为 $0,1,2,3,4,5,6,7$。使用由以下公式定义的 JW 变换\n$a_p = \\left(\\prod_{m=0}^{p-1} Z_m\\right)\\frac{X_p + i Y_p}{2}$ 和 $a_p^{\\dagger} = \\left(\\prod_{m=0}^{p-1} Z_m\\right)\\frac{X_p - i Y_p}{2}$，其中 $X_p$、$Y_p$ 和 $Z_p$ 是作用在量子比特 $p$ 上的 Pauli 算符。UCC 生成元的形式为：对于单激发是 $\\tau_{pq} = a_p^{\\dagger} a_q - a_q^{\\dagger} a_p$，对于双激发是 $\\tau_{abij} = a_a^{\\dagger} a_b^{\\dagger} a_j a_i - a_i^{\\dagger} a_j^{\\dagger} a_b a_a$。\n\n采用以下编译策略：\n- 使用一阶 Trotter 分解，并只取一个 Trotter 步长，因此 $\\exp(-i \\theta (A+B+\\dots))$ 被编译为 $\\exp(-i \\theta A)$、$\\exp(-i \\theta B)$ 等的有序乘积。\n- 编译每个 Pauli 串指数 $\\exp\\!\\left(-i \\theta P\\right)$ 时，使用单量子比特基变换将 $P$ 中所有非 $Z$ 的 Pauli 算符转换为 $Z$，然后是一个仅作用于 $P$ 的非单位算符所在的量子比特上的线性奇偶校验网络，最后是用于撤销计算的逆操作。只计算受控非门（CNOT）；忽略单量子比特门。\n- 不要-在不同的指数项之间重用或抵消纠缠门。独立处理每个指数项。\n\n请从第一性原理出发，计算出生成元的 Jordan–Wigner 镜像及其产生的 Pauli 串的结构，然后根据上述编译策略，为以下情况推导出所需 CNOT 门的数量：\n- 一次从 $q=1$ 到 $p=5$ 的单激发。\n- 一次从占据轨道 $i=0, j=2$ 到虚拟轨道 $b=5, a=7$ 的双激发（因此 $i<j<b<a$）。\n\n最后，计算在此策略下实现这两个酉变换各一次（每个一个 Trotter 步长）所需的 CNOT 总数。以一个整数作为最终答案。无需四舍五入，也无需报告物理单位。", "solution": "在尝试任何解答之前，需要对问题陈述进行验证。\n\n步骤 1：提取已知条件\n- 系统：$8$ 个自旋轨道，索引为 $p \\in \\{0, 1, ..., 7\\}$。\n- Jordan-Wigner (JW) 变换：\n  - 湮灭算符：$a_p = \\left(\\prod_{m=0}^{p-1} Z_m\\right)\\frac{X_p + i Y_p}{2}$\n  - 产生算符：$a_p^{\\dagger} = \\left(\\prod_{m=0}^{p-1} Z_m\\right)\\frac{X_p - i Y_p}{2}$\n- 酉耦合簇 (UCC) 生成元：\n  - 单激发：$\\tau_{pq} = a_p^{\\dagger} a_q - a_q^{\\dagger} a_p$\n  - 双激发：$\\tau_{abij} = a_a^{\\dagger} a_b^{\\dagger} a_j a_i - a_i^{\\dagger} a_j^{\\dagger} a_b a_a$\n- 编译与成本计算策略：\n  - Trotter 分解：一阶，单步。\n  - Pauli 指数编译：一个权重为 $k$ 的 Pauli 串指数项 $\\exp(-i \\theta P)$ 需要 $2(k-1)$ 个 CNOT 门。忽略单量子比特门。\n  - 无交叉项优化：每个 Pauli 指数项独立编译和计数。\n- 特定激发：\n  - 单激发：从 $q=1$ 到 $p=5$。\n  - 双激发：从 $i=0, j=2$ 到 $b=5, a=7$，并指定排序 $i<j<b<a$。\n- 目标：计算实现两个酉变换 $\\exp(\\theta_1 \\tau_{51})$ 和 $\\exp(\\theta_2 \\tau_{7520})$ 各一个 Trotter 步长所需的 CNOT 总数。\n\n步骤 2：使用提取的已知条件进行验证\n- **科学性：** 问题使用了量子化学计算中的标准定义，包括 UCCSD 拟设、Jordan-Wigner 变换和标准的门编译策略。所有概念都牢固地植根于理论化学和量子信息科学。\n- **良态性：** 问题具有数学上的精确性。所有必要的定义、参数和成本度量均已提供，可得到一个唯一的、可计算的整数结果。\n- **客观性：** 语言正式，没有主观或含糊的术语。\n- **完整性与一致性：** 问题是自洽的。提供的索引和排序规则是一致的。自旋轨道的数量对于指定的激发是足够的。\n- **现实性：** 该场景代表了为化学问题实现变分量子算法的一个标准（尽管是简化的）过程。\n\n步骤 3：结论与行动\n问题有效。将推导解答。\n\n生成元 $\\tau$ 是反厄米算符，因此对应的酉变换形式为 $\\exp(\\theta \\tau) = \\exp(-i\\theta H)$，其中 $H = i\\tau$ 是一个厄米算符。我们将确定这些厄米算符 $H$ 的 Pauli 串分解，并计算相关的 CNOT 成本。\n\n实现 Pauli 串 $P = \\otimes_{k=1}^N O_k$（其中 $O_k \\in \\{I, X, Y, Z\\}$）的指数项的 CNOT 成本由其权重决定，权重是指非单位算符的数量。如果权重为 $k$，则 CNOT 成本为 $2(k-1)$。\n\n第 1 部分：从 $q=1$ 到 $p=5$ 的单激发\n\n单激发算符为 $\\tau_{pq} = a_p^{\\dagger} a_q - a_q^{\\dagger} a_p$。对于 $p > q$，我们首先确定 $a_p^{\\dagger} a_q$ 的 JW 串。令 $\\sigma_k^{\\pm} = (X_k \\pm iY_k)/2$。\n$$a_p^{\\dagger} a_q = \\left[ \\left(\\prod_{m=0}^{p-1} Z_m\\right) \\sigma_p^{+} \\right] \\left[ \\left(\\prod_{k=0}^{q-1} Z_k\\right) \\sigma_q^{-} \\right]$$\n由于 $p>q$，算符 $\\sigma_p^{+}$（作用于量子比特 $p$）与项 $(\\prod_{k=0}^{q-1} Z_k)\\sigma_q^{-}$（作用于量子比特 $0, \\dots, q$）对易。\n$$a_p^{\\dagger} a_q = \\left(\\prod_{m=0}^{p-1} Z_m\\right) \\left(\\prod_{k=0}^{q-1} Z_k\\right) \\sigma_p^{+} \\sigma_q^{-}$$\n$Z$ 串的乘积可简化为：\n$$ \\left(\\prod_{m=0}^{p-1} Z_m\\right) \\left(\\prod_{k=0}^{q-1} Z_k\\right) = \\left(\\prod_{m=q}^{p-1} Z_m\\right) \\left(\\prod_{k=0}^{q-1} Z_k^2\\right) = \\left(\\prod_{m=q}^{p-1} Z_m\\right) $$\n因此，$a_p^{\\dagger} a_q = \\left(\\prod_{k=q}^{p-1} Z_k\\right) \\sigma_p^{+} \\sigma_q^{-}$。\n其厄米共轭为 $a_q^{\\dagger} a_p = (a_p^{\\dagger} a_q)^{\\dagger} = \\left(\\prod_{k=q}^{p-1} Z_k\\right) \\sigma_q^{+} \\sigma_p^{-}$。\n生成元为 $\\tau_{pq} = a_p^{\\dagger} a_q - a_q^{\\dagger} a_p = \\left(\\prod_{k=q}^{p-1} Z_k\\right) (\\sigma_p^{+} \\sigma_q^{-} - \\sigma_q^{+} \\sigma_p^{-})$。\n展开 sigma 算符：\n$$ \\sigma_p^{+} \\sigma_q^{-} - \\sigma_q^{+} \\sigma_p^{-} = \\frac{1}{4} \\left[ (X_p-iY_p)(X_q+iY_q) - (X_q-iY_q)(X_p+iY_p) \\right] $$\n$$ = \\frac{1}{4} \\left[ (iX_pY_q - iY_pX_q) - (-iX_qY_p + iY_qX_p) \\right] = \\frac{i}{2} (X_pY_q - Y_pX_q) $$\n所以，$\\tau_{pq} = \\frac{i}{2} \\left(\\prod_{k=q}^{p-1} Z_k\\right) (X_p Y_q - Y_p X_q)$。\n对应的厄米算符是 $H_{pq} = i\\tau_{pq} = -\\frac{1}{2} \\left(\\prod_{k=q}^{p-1} Z_k\\right) (X_p Y_q - Y_p X_q) = \\frac{1}{2} \\left[ \\left(\\prod_{k=q}^{p-1} Z_k\\right) Y_p X_q - \\left(\\prod_{k=q}^{p-1} Z_k\\right) X_p Y_q \\right]$。\n\n对于特定情况 $p=5, q=1$：\n$H_{51} = \\frac{1}{2} (Y_5 Z_4 Z_3 Z_2 X_1 - X_5 Z_4 Z_3 Z_2 Y_1)$。\n注意，不同量子比特上的 Pauli 算符互相对易，因此我们按索引重新排序。\n$H_{51} = \\frac{1}{2} (P_1 - P_2)$，其中：\n$P_1 = X_1 Z_2 Z_3 Z_4 Y_5$\n$P_2 = Y_1 Z_2 Z_3 Z_4 X_5$\n酉变换 $\\exp(-i\\theta H_{51})$ 被 Trotter 分解为 $\\exp(-i\\frac{\\theta}{2}P_1)\\exp(i\\frac{\\theta}{2}P_2)$。我们必须计算每一项的 CNOT 数量。\n两个 Pauli 串 $P_1$ 和 $P_2$ 都非平凡地作用于量子比特 $\\{1, 2, 3, 4, 5\\}$。\n两个串的权重均为 $k=5$。\n一个串的 CNOT 成本为 $2(k-1) = 2(5-1) = 8$。\n由于有两个 Pauli 串，单激发的总 CNOT 成本为 $2 \\times 8 = 16$。\n\n第 2 部分：从 $i=0, j=2$ 到 $b=5, a=7$ 的双激发\n\n生成元为 $\\tau_{abij} = a_a^{\\dagger} a_b^{\\dagger} a_j a_i - a_i^{\\dagger} a_j^{\\dagger} a_b a_a$。问题指定了排序 $i<j<b<a$。\n我们首先分析项 $T = a_a^{\\dagger} a_b^{\\dagger} a_j a_i$。由于占据态 $\\{i,j\\}$ 和虚态 $\\{a,b\\}$ 的费米子算符定义在不相交的自旋轨道集上，它们反对易，而这样成对的算符则对易：$(a_a^{\\dagger} a_b^{\\dagger})(a_j a_i) = a_j a_i a_a^{\\dagger} a_b^{\\dagger}$。\n我们计算每对算符的 JW 形式。对于 $j>i$：\n$a_j a_i = \\left(\\prod_{k=i}^{j-1} Z_k\\right) \\sigma_j^{-} \\sigma_i^{-}$。\n对于 $a>b$：\n$a_a^{\\dagger} a_b^{\\dagger} = (a_b a_a)^{\\dagger} = \\left[ \\left(\\prod_{k=b}^{a-1} Z_k\\right) \\sigma_a^{-} \\sigma_b^{-} \\right]^{\\dagger} = \\left(\\prod_{k=b}^{a-1} Z_k\\right) \\sigma_a^{+} \\sigma_b^{+}$。\n由于 $i<j<b<a$，$(a_a^{\\dagger} a_b^{\\dagger})$ 和 $(a_j a_i)$ 作用的量子比特是不相交的。因此，它们的 JW 串表示互相对易：\n$T = a_a^{\\dagger} a_b^{\\dagger} a_j a_i = \\left[ \\left(\\prod_{k=b}^{a-1} Z_k\\right) \\sigma_a^{+} \\sigma_b^{+} \\right] \\left[ \\left(\\prod_{l=i}^{j-1} Z_l\\right) \\sigma_j^{-} \\sigma_i^{-} \\right] = \\left(\\prod_{k=b}^{a-1} Z_k\\right) \\left(\\prod_{l=i}^{j-1} Z_l\\right) (\\sigma_a^{+} \\sigma_b^{+} \\sigma_j^{-} \\sigma_i^{-})$。\n厄米算符为 $H_{abij} = i\\tau_{abij} = i(T^\\dagger - T)$。\n项 $i(T^\\dagger - T)$ 对应于取 $T$ 的实部的 $2$ 倍。\n展开 $\\sigma_a^{+} \\sigma_b^{+} \\sigma_j^{-} \\sigma_i^{-}$：\n$\\frac{1}{16}(X_a-iY_a)(X_b-iY_b)(X_j+iY_j)(X_i+iY_i) = \\frac{1}{16} [(X_aX_b-Y_aY_b)-i(X_aY_b+Y_aX_b)][(X_jX_i-Y_jY_i)+i(X_jY_i+Y_jX_i)]$。\n此乘积的实部，再乘以 Z 串，得到 $H_{abij}$。该乘积产生 $8$ 个不同的 Pauli 串。\n$H_{abij} = \\frac{1}{8} \\left(\\prod_{k=b}^{a-1} Z_k\\right) \\left(\\prod_{l=i}^{j-1} Z_l\\right) \\times [ (X_aX_bX_jX_i - X_aX_bY_jY_i - Y_aY_bX_jX_i + Y_aY_bY_jY_i) - (X_aY_bX_jY_i + X_aY_bY_jX_i + Y_aX_bX_jY_i + Y_aX_bY_jX_i) ]$\n这是一个包含 8 个 Pauli 串的和。我们必须找出每个串的权重。\n对于 $i=0, j=2, b=5, a=7$：\nZ 串为 $(\\prod_{l=0}^{1} Z_l) = Z_0 Z_1$ 和 $(\\prod_{k=5}^{6} Z_k) = Z_5 Z_6$。\n四体 Pauli 算符作用于量子比特 $\\{0, 2, 5, 7\\}$。\n对于这 8 个 Pauli 串中的任何一个，所涉及的量子比特总集合（支撑集）是 Z 串和四体算符的索引的并集：$\\{0,1\\} \\cup \\{5,6\\} \\cup \\{0,2,5,7\\} = \\{0,1,2,5,6,7\\}$。\n这 8 个 Pauli 串中每一个的权重 $k$ 是该集合的大小，即 $k=6$。\n这 8 个 Pauli 指数项中每一个的 CNOT 成本为 $2(k-1) = 2(6-1) = 10$。\n双激发的总 CNOT 成本为 $8 \\times 10 = 80$。\n\n第 3 部分：CNOT 总数\n\nCNOT 总数是单激发和双激发成本的总和。\nCNOT 总数 = CNOTs(单激发) + CNOTs(双激发)\nCNOT 总数 = $16 + 80 = 96$。\n这是最终结果。", "answer": "$$\\boxed{96}$$"}, {"introduction": "变分量子算法（VQE）并非静态过程，而是涉及一个动态的优化循环。这项实践将通过实现自适应变分量子本征求解器（ADAPT-VQE）的一个核心迭代步骤，让你亲身体验这一过程 [@problem_id:2797401]。你需要整合前面练习中的概念——构建哈密顿量并处理激发算符——并将它们应用于一个具体的算法框架中，通过计算能量梯度来智能地选择并构建ansatz。这个练习虽然规模不大，但构成了一个完整的计算化学任务，将抽象的算法循环变得具体可感。", "id": "2797401", "problem": "实现自适应导数组装伪 Trotter (ADAPT) 变分量子本征求解器的单次迭代，该迭代用于氢化铍的最小活性空间模型。具体方法是：计算给定态上一组反厄米激发生成元的能量梯度，并选择梯度模最大的算符进行追加。实现必须是一个完整、可运行的程序，它能在二次量子化中构建电子哈密顿量，使用 Jordan–Wigner 变换将其映射到量子比特希尔伯特空间，构建由守恒粒子数的单激发和双激发组成的反厄米生成元算符池，评估三个指定测试态的一阶能量导数，并报告每个测试用例的选择决策。\n\n从以下基本原理开始：\n- 在自旋轨道基下，二次量子化中的 Born–Oppenheimer 电子哈密顿量为\n  $$\\hat{H} = \\sum_{p,q} h_{pq}\\,\\hat{a}^{\\dagger}_p \\hat{a}_q + \\frac{1}{2}\\sum_{p,q,r,s} g_{pqrs}\\,\\hat{a}^{\\dagger}_p \\hat{a}^{\\dagger}_q \\hat{a}_s \\hat{a}_r,$$\n  其中 $h_{pq}$ 是单电子积分，$g_{pqrs}$ 是化学家标记法中的双电子库仑积分。\n- Jordan–Wigner 映射将费米子生成和湮灭算符变换为作用于由占据数比特串构成的计算基矢上的量子比特算符。在由长度为 $N$ 的比特串（其中比特 $j$ 编码自旋轨道 $j$ 的占据数）索引的计算基矢 $\\{\\lvert n\\rangle\\}$ 中，$\\hat{a}_j$ 和 $\\hat{a}^{\\dagger}_j$ 在基矢态上的作用由它们的代数关系以及源于费米子反对易关系的符号规则定义。用算法形式描述，对于一个具有占据比特 $n_k \\in \\{0,1\\}$ 的基矢态 $\\lvert n\\rangle$：\n  - 如果 $n_j = 1$，则\n    $$\\hat{a}_j \\lvert n\\rangle = (-1)^{\\sum_{k<j} n_k}\\,\\lvert n_0,\\dots,n_j-1,\\dots,n_{N-1}\\rangle,$$\n    否则 $\\hat{a}_j \\lvert n\\rangle = 0$。\n  - 如果 $n_j = 0$，则\n    $$\\hat{a}^{\\dagger}_j \\lvert n\\rangle = (-1)^{\\sum_{k<j} n_k}\\,\\lvert n_0,\\dots,n_j+1,\\dots,n_{N-1}\\rangle,$$\n    否则 $\\hat{a}^{\\dagger}_j \\lvert n\\rangle = 0$。\n- 由一个反厄米算符 $\\hat{A}_k$ 生成的幺正拟设因子是 $\\exp(\\theta_k \\hat{A}_k)$。对于一个给定的态 $\\lvert \\psi\\rangle$，能量泛函为\n  $$E_k(\\theta_k) = \\langle \\psi \\rvert e^{-\\theta_k \\hat{A}_k} \\hat{H}\\, e^{\\theta_k \\hat{A}_k} \\lvert \\psi \\rangle,$$\n  其在 $\\theta_k = 0$ 处的一阶导数定义了用于算符选择的梯度。你的程序必须根据上述基本定义，从头计算池中每个生成元的一阶导数。\n\n系统规格：\n- 使用一个最小活性空间，其中有 $N=4$ 个索引为 $j \\in \\{0,1,2,3\\}$ 的自旋轨道，并为态制备固定电子数为 $2$。在原子单位 (Hartree) 下进行计算。所有角度必须按弧度处理。\n- 单电子积分 $h_{pq}$ 构成一个实对称矩阵。使用以下数值（单位：Hartree），其中索引 $p,q \\in \\{0,1,2,3\\}$：\n  $$h = \\begin{bmatrix}\n  -1.256 & -0.050 & -0.020 & 0.000 \\\\\n  -0.050 & -1.000 & -0.060 & -0.010 \\\\\n  -0.020 & -0.060 & -0.200 & -0.030 \\\\\n  0.000 & -0.010 & -0.030 & 0.150\n  \\end{bmatrix}.$$\n- 双电子积分 $g_{pqrs}$（单位：Hartree）遵循化学家对称性\n  $$(pq\\vert rs) = (qp\\vert rs) = (pq\\vert sr) = (rs\\vert pq),$$\n  除以下非冗余值外，其余均为零。这些非冗余值必须根据上述对称性对称地展开到所有隐含的排列组合：\n  - 类库仑项：\n    $(0,0\\vert 0,0) = 0.700$, $(1,1\\vert 1,1) = 0.600$, $(2,2\\vert 2,2) = 0.500$, $(3,3\\vert 3,3) = 0.480$,\n    $(0,0\\vert 1,1) = 0.675$, $(0,0\\vert 2,2) = 0.450$, $(0,0\\vert 3,3) = 0.430$,\n    $(1,1\\vert 2,2) = 0.420$, $(1,1\\vert 3,3) = 0.410$, $(2,2\\vert 3,3) = 0.400$。\n  - 类交换项：\n    $(0,1\\vert 1,0) = 0.100$, $(0,2\\vert 2,0) = 0.080$, $(1,2\\vert 2,1) = 0.070$,\n    $(0,3\\vert 3,0) = 0.060$, $(1,3\\vert 3,1) = 0.050$, $(2,3\\vert 3,2) = 0.040$。\n  所有其他未由这些对称性隐含的 $g_{pqrs}$ 必须设为 $0$。\n- 构建相对于闭壳层参考态（占据自旋轨道为 $\\{0,1\\}$，虚轨道为 $\\{2,3\\}$）的反厄米、粒子数守恒的激发算符池：\n  - 对于所有 $p \\in \\{0,1\\}$ 和 $r \\in \\{2,3\\}$ 的单激发 $(p \\rightarrow r)$，形式为\n    $$\\hat{A}^{(1)}_{p\\rightarrow r} = \\hat{a}^{\\dagger}_r \\hat{a}_p - \\hat{a}^{\\dagger}_p \\hat{a}_r.$$\n  - 一个将电子对 $(0,1)$ 移动到 $(2,3)$ 的双激发，\n    $$\\hat{A}^{(2)}_{01\\rightarrow 23} = \\hat{a}^{\\dagger}_2 \\hat{a}^{\\dagger}_3 \\hat{a}_1 \\hat{a}_0 - \\hat{a}^{\\dagger}_0 \\hat{a}^{\\dagger}_1 \\hat{a}_3 \\hat{a}_2.$$\n  请使用书面形式的算符排序约定。最终的算符池包含 $5$ 个生成元，顺序为\n  $(0\\rightarrow 2)$、$(0\\rightarrow 3)$、$(1\\rightarrow 2)$、$(1\\rightarrow 3)$、$(01\\rightarrow 23)$，它们必须按此顺序索引为 $0,1,2,3,4$。\n\n需要实现的能量梯度定义：\n- 对于每个反厄米生成元 $\\hat{A}_k$，定义 $E_k(\\theta_k) = \\langle \\psi \\rvert e^{-\\theta_k \\hat{A}_k} \\hat{H}\\, e^{\\theta_k \\hat{A}_k} \\lvert \\psi \\rangle$。你的程序必须根据上述基本定义，计算每个 $k$ 在 $\\theta_k = 0$ 处的一阶导数 $\\left.\\frac{dE_k}{d\\theta_k}\\right\\vert_{\\theta_k = 0}$。使用该导数的模作为选择标准。如果池中最大的模值低于容差 $\\tau = 10^{-8}$，则使用整数 $-1$ 报告不作选择。\n\n测试套件与测试态：\n- 使用三个测试态 $\\lvert \\psi^{(t)}\\rangle$，$t \\in \\{1,2,3\\}$，它们都在 $N=4$ 的量子比特希尔伯特空间中归一化，该空间按二进制计数排序，其中比特 $j$ 表示轨道 $j$ 的占据情况：\n  1) $\\lvert \\psi^{(1)}\\rangle$ 是占据轨道为 $\\{0,1\\}$ 的闭壳层参考行列式，即计算基矢 $\\lvert 1100\\rangle$。\n  2) $\\lvert \\psi^{(2)}\\rangle$ 是通过在 $\\lvert \\psi^{(1)}\\rangle$ 上应用由单激发 $(0\\rightarrow 2)$ 生成的一个小幺正旋转得到的，\n     $$\\lvert \\psi^{(2)}\\rangle = e^{\\epsilon \\hat{A}^{(1)}_{0\\rightarrow 2}} \\lvert \\psi^{(1)}\\rangle,$$\n     其中 $\\epsilon = 0.15$ 弧度。\n  3) $\\lvert \\psi^{(3)}\\rangle$ 是 $\\hat{H}$ 限制在双电子子空间（即，由所有汉明权重为 $2$ 的比特串张成的子空间）中的精确基态。该态必须通过对投射到该子空间上的 $\\hat{H}$ 进行对角化，并选择与最低本征值对应的本征矢量来获得，然后将其嵌入回完整的 $2^N$ 维希尔伯特空间。\n\n程序要求：\n- 根据提供的 $h_{pq}$ 和 $g_{pqrs}$、Jordan–Wigner 定义的 $\\hat{a}_j$ 和 $\\hat{a}^{\\dagger}_j$ 矩阵以及二次量子化表达式来构建 $\\hat{H}$。使用双精度复数算术。\n- 对于每个测试态，计算在 $\\theta_k = 0$ 处评估的 $5$ 个生成元的梯度模值列表，如上定义。选择具有最大模值的生成元的索引，并应用容差规则来声明不作选择（$-1$）。\n- 最终输出格式：你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，\"[result1,result2,result3]\"），每个结果是所选算符的索引（一个在 $\\{0,1,2,3,4\\}$ 中的整数）或在未作选择时为 $-1$。\n\n角度单位：所有角度必须以弧度为单位。输出中不需要其他物理单位，因为程序仅报告整数索引。\n\n你的程序必须是自包含的，且不应需要任何输入。它必须计算并以确切要求的格式打印出三个指定测试用例的索引。", "solution": "该问题已经受验证。\n\n### 步骤 1：提取给定条件\n- **电子哈密顿量**：$\\hat{H} = \\sum_{p,q} h_{pq}\\,\\hat{a}^{\\dagger}_p \\hat{a}_q + \\frac{1}{2}\\sum_{p,q,r,s} g_{pqrs}\\,\\hat{a}^{\\dagger}_p \\hat{a}^{\\dagger}_q \\hat{a}_s \\hat{a}_r$。\n- **Jordan-Wigner (JW) 变换**：定义了 $\\hat{a}_j$ 和 $\\hat{a}^{\\dagger}_j$ 在计算基矢态 $\\lvert n\\rangle$ 上的作用。对于具有占据比特 $n_k \\in \\{0,1\\}$ 的 $\\lvert n\\rangle$：\n  - 若 $n_j=1$，则 $\\hat{a}_j \\lvert n\\rangle = (-1)^{\\sum_{k<j} n_k}\\,\\lvert n_0,\\dots,n_j-1,\\dots,n_{N-1}\\rangle$，否则为 $0$。\n  - 若 $n_j=0$，则 $\\hat{a}^{\\dagger}_j \\lvert n\\rangle = (-1)^{\\sum_{k<j} n_k}\\,\\lvert n_0,\\dots,n_j+1,\\dots,n_{N-1}\\rangle$，否则为 $0$。\n- **能量梯度**：选择标准是能量梯度在 $\\theta_k = 0$ 时的模，其中 $E_k(\\theta_k) = \\langle \\psi \\rvert e^{-\\theta_k \\hat{A}_k} \\hat{H}\\, e^{\\theta_k \\hat{A}_k} \\lvert \\psi \\rangle$。\n- **系统参数**：$N=4$ 个自旋轨道，$N_e=2$ 个电子。\n- **单电子积分 ($h_{pq}$)**：提供了一个 $4 \\times 4$ 的实对称矩阵。\n- **双电子积分 ($g_{pqrs}$)**：提供了一系列化学家标记法积分 $(pq\\vert rs)$ 的非冗余值，以及对称性 $(pq\\vert rs) = (qp\\vert rs) = (pq\\vert sr) = (rs\\vert pq)$。\n- **算符池**：\n  - 单激发：对于 $p \\in \\{0,1\\}, r \\in \\{2,3\\}$，$\\hat{A}^{(1)}_{p\\rightarrow r} = \\hat{a}^{\\dagger}_r \\hat{a}_p - \\hat{a}^{\\dagger}_p \\hat{a}_r$。\n  - 双激发：$\\hat{A}^{(2)}_{01\\rightarrow 23} = \\hat{a}^{\\dagger}_2 \\hat{a}^{\\dagger}_3 \\hat{a}_1 \\hat{a}_0 - \\hat{a}^{\\dagger}_0 \\hat{a}^{\\dagger}_1 \\hat{a}_3 \\hat{a}_2$。\n  - $5$ 个算符按 $(0\\rightarrow 2)$、$(0\\rightarrow 3)$、$(1\\rightarrow 2)$、$(1\\rightarrow 3)$、$(01\\rightarrow 23)$ 的顺序索引为 $0$ 到 $4$。\n- **选择容差**：$\\tau = 10^{-8}$。如果最大梯度模小于 $\\tau$，则选择的索引为 $-1$。\n- **测试态**：\n  1. $\\lvert \\psi^{(1)}\\rangle$：占据轨道为 $\\{0,1\\}$ 的闭壳层参考态，记为 $\\lvert 1100\\rangle$。\n  2. $\\lvert \\psi^{(2)}\\rangle = e^{\\epsilon \\hat{A}^{(1)}_{0\\rightarrow 2}} \\lvert \\psi^{(1)}\\rangle$，其中 $\\epsilon = 0.15$ 弧度。\n  3. $\\lvert \\psi^{(3)}\\rangle$：$\\hat{H}$ 在 $2$ 电子子空间中的精确基态。\n- **计算基矢**：希尔伯特空间按比特串 $\\lvert n_{N-1}...n_0 \\rangle$ 的二进制计数排序，其中比特 $j$ 对应轨道 $j$。\n\n### 步骤 2：使用提取的给定条件进行验证\n该问题具有科学依据，定义明确且客观。它指定了量子化学中的一个标准算法 (ADAPT-VQE)，并为一个小而明确的计算模型提供了所有必要的参数。然而，存在两点模糊之处，必须通过上下文一致性来解决。\n\n1.  **基矢态约定**：参考态 $\\lvert \\psi^{(1)} \\rangle$ 被描述为“占据自旋轨道 $\\{0,1\\}$”，但也表示为基矢“$\\lvert 1100 \\rangle$”。在标准的比特-整数映射 $i = \\sum_j n_j 2^j$（对于一个基矢ket $\\lvert n_{N-1}\\dots n_0\\rangle$）中，占据轨道 $0$ 和 $1$ 对应于态 $\\lvert 0011 \\rangle$（索引为 $3$），而 ket $\\lvert 1100 \\rangle$ 对应于占据轨道 $2$ 和 $3$（索引为 $12$）。激发池是相对于占据轨道 $\\{0,1\\}$ 定义的，这提供了强有力的上下文证据，表明预期的参考态是占据轨道 $0$ 和 $1$ 的。因此，可以得出结论，“$\\lvert 1100 \\rangle$” 是表示 $n_0=1, n_1=1$ 的态的一种非标准表示法，该态矢量在计算基矢中对应于索引 $3$。这种解释解决了矛盾。\n\n2.  **双电子积分约定**：哈密顿量给定为 $\\hat{H} = \\dots + \\frac{1}{2}\\sum_{p,q,r,s} g_{pqrs}\\,\\hat{a}^{\\dagger}_p \\hat{a}^{\\dagger}_q \\hat{a}_s \\hat{a}_r$。问题陈述 \"$g_{pqrs}$... 遵循化学家对称性 $(pq\\vert rs) = (qp\\vert rs) = \\dots$”。若字面解释为 $g_{pqrs}=(pq|rs)$，将导致数学上的不一致；具体来说，由于费米子算符的反对易性和积分的对称性，双电子项求和将为零。标准且物理上一致的公式将哈密顿量系数 $g_{pqrs}$（物理学家标记法）与化学家积分 $(pr|qs)$ 通过恒等式 $g_{pqrs} = (pr|qs)$ 关联起来。这种解释确保了哈密顿量是厄米的和非平凡的。我们假设意指的是这种标准约定。\n\n通过基于内部一致性和既定科学原则的这些澄清，该问题被认为是有效的。\n\n### 步骤 3：结论与行动\n该问题有效。现在将提供一个完整的解决方案。\n\n### 解决过程\n\nADAPT-VQE 选择步骤的核心是计算算符池中每个算符 $\\hat{A}_k$ 的能量梯度。对于一个态 $\\lvert \\psi \\rangle$，梯度由能量泛函 $E_k(\\theta_k)$ 在 $\\theta_k=0$ 处的一阶导数给出：\n$$ \\left.\\frac{dE_k}{d\\theta_k}\\right\\vert_{\\theta_k = 0} = \\left. \\frac{d}{d\\theta_k} \\langle \\psi \\rvert e^{-\\theta_k \\hat{A}_k} \\hat{H}\\, e^{\\theta_k \\hat{A}_k} \\lvert \\psi \\rangle \\right\\vert_{\\theta_k = 0} $$\n应用乘积法则并在 $\\theta_k=0$ 处求值，得到：\n$$ \\left.\\frac{dE_k}{d\\theta_k}\\right\\vert_{\\theta_k = 0} = \\langle \\psi \\rvert (-\\hat{A}_k \\hat{H} + \\hat{H} \\hat{A}_k) \\lvert \\psi \\rangle = \\langle \\psi \\rvert [\\hat{H}, \\hat{A}_k] \\lvert \\psi \\rangle $$\n由于 $\\hat{H}$ 是厄米的，而 $\\hat{A}_k$ 是反厄米的，对易子 $[\\hat{H}, \\hat{A}_k]$ 是一个厄米算符，其期望值为实数。该算法要求找到使该梯度模 $|\\langle \\psi \\rvert [\\hat{H}, \\hat{A}_k] \\lvert \\psi \\rangle|$ 最大化的索引 $k$。\n\n解决方案按以下步骤实现：\n\n1.  **费米子算符的矩阵表示**：使用 Jordan-Wigner 变换为 $N=4$ 个自旋轨道中的每一个构建费米子湮灭 ($\\hat{a}_j$) 和生成 ($\\hat{a}^{\\dagger}_j$) 算符的 $2^N \\times 2^N$ 矩阵表示。这是通过对 $16$ 维希尔伯特空间中的每个基矢态 $\\lvert n \\rangle$ 实现符号规则和占据数变化来完成的。\n\n2.  **哈密顿量构建**：\n    *   使用提供的化学家标记法中非冗余的双电子积分 $(pq|rs)$，通过应用指定对称性，填充一个完整的 $4 \\times 4 \\times 4 \\times 4$ 张量 `g_chem`。\n    *   然后，使用标准关系 $g_{pqrs} = (pr|qs)$ 从 `g_chem` 构建哈密顿量的系数张量 $g_{pqrs}$。\n    *   使用 $\\hat{a}_j$ 和 $\\hat{a}^{\\dagger}_j$ 的矩阵表示以及积分张量 $h_{pq}$ 和 $g_{pqrs}$，组装完整的电子哈密顿量矩阵 $\\hat{H}$：\n      $$ \\hat{H}_{\\text{matrix}} = \\sum_{p,q=0}^{3} h_{pq}(\\hat{a}^{\\dagger}_p \\hat{a}_q) + \\frac{1}{2}\\sum_{p,q,r,s=0}^{3} g_{pqrs}(\\hat{a}^{\\dagger}_p \\hat{a}^{\\dagger}_q \\hat{a}_s \\hat{a}_r) $$\n\n3.  **算符池构建**：根据五个反厄米激发生成元 $\\hat{A}_k$ 的定义，从费米子算符矩阵构建它们的矩阵表示。\n\n4.  **测试态制备**：将三个测试态制备为 $16$ 维列向量：\n    *   $\\lvert \\psi^{(1)} \\rangle$：这是占据轨道 $0$ 和 $1$ 的 Hartree-Fock 参考态。这对应于计算基矢态 $\\lvert 0011_2 \\rangle$，是一个在索引 $3$ 处为 $1$ 的向量。\n    *   $\\lvert \\psi^{(2)} \\rangle$：通过将幺正算符 $e^{\\epsilon \\hat{A}_{0\\rightarrow 2}}$ 应用于 $\\lvert \\psi^{(1)} \\rangle$ 来制备此态，其中 $\\epsilon=0.15$。矩阵指数通过数值方法计算。\n    *   $\\lvert \\psi^{(3)} \\rangle$：识别 $2$ 电子子空间。它由对应于汉明权重为 $2$ 的比特串的 $\\binom{4}{2}=6$ 个基矢态张成。哈密顿量矩阵 $\\hat{H}$ 被投影到该子空间上。将得到的 $6 \\times 6$ 矩阵对角化，并选择与最低本征值对应的本征矢量。然后将此本征矢量嵌入回完整的 $16$ 维空间以形成 $\\lvert \\psi^{(3)} \\rangle$。\n\n5.  **梯度评估与选择**：对于每个测试态 $\\lvert\\psi\\rangle$ 和每个生成元 $\\hat{A}_k$：\n    *   计算对易子矩阵 $[\\hat{H}, \\hat{A}_k] = \\hat{H}\\hat{A}_k - \\hat{A}_k\\hat{H}$。\n    *   梯度按期望值 $\\text{grad}_k = \\langle \\psi \\rvert [\\hat{H}, \\hat{A}_k] \\lvert \\psi \\rangle$ 计算。\n    *   比较所有 $k$ 的梯度绝对值。选择具有最大梯度模的算符的索引。如果此最大值小于容差 $\\tau = 10^{-8}$，则报告索引为 $-1$。\n\n整个过程封装在一个自包含的程序中，该程序执行这些步骤并为三个测试用例打印最终的选择索引。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Implements a single iteration of the ADAPT-VQE algorithm for a BeH model.\n    \"\"\"\n    \n    # --- System and problem parameters ---\n    N_QUBITS = 4\n    N_ELECTRONS = 2\n    HILBERT_DIM = 2**N_QUBITS\n    TOLERANCE = 1e-8\n\n    # --- Step 1: Matrix Representation of Fermionic Operators (Jordan-Wigner) ---\n    def get_jw_operators(n_qubits):\n        \"\"\"Constructs Jordan-Wigner matrices for creation and annihilation operators.\"\"\"\n        dim = 2**n_qubits\n        a_ops = [np.zeros((dim, dim), dtype=np.complex128) for _ in range(n_qubits)]\n        adag_ops = [np.zeros((dim, dim), dtype=np.complex128) for _ in range(n_qubits)]\n\n        for i in range(dim):\n            for j in range(n_qubits):\n                parity_mask = (1 << j) - 1\n                parity = bin(i & parity_mask).count('1')\n                sign = (-1)**parity\n\n                bit_mask = 1 << j\n                is_occupied = (i & bit_mask) != 0\n\n                if is_occupied:\n                    # Annihilation operator a_j\n                    final_state_idx = i ^ bit_mask\n                    a_ops[j][final_state_idx, i] = sign\n                else:\n                    # Creation operator a_j^\\dagger\n                    final_state_idx = i | bit_mask\n                    adag_ops[j][final_state_idx, i] = sign\n        return a_ops, adag_ops\n\n    a_ops, adag_ops = get_jw_operators(N_QUBITS)\n\n    # --- Step 2: Construct the Hamiltonian Matrix ---\n    # One-electron integrals h_pq\n    h_pq = np.array([\n        [-1.256, -0.050, -0.020, 0.000],\n        [-0.050, -1.000, -0.060, -0.010],\n        [-0.020, -0.060, -0.200, -0.030],\n        [ 0.000, -0.010, -0.030, 0.150]\n    ])\n\n    # Two-electron integrals g_pqrs (chemist's notation)\n    g_raw = {\n        (0,0,0,0): 0.700, (1,1,1,1): 0.600, (2,2,2,2): 0.500, (3,3,3,3): 0.480,\n        (0,0,1,1): 0.675, (0,0,2,2): 0.450, (0,0,3,3): 0.430,\n        (1,1,2,2): 0.420, (1,1,3,3): 0.410, (2,2,3,3): 0.400,\n        (0,1,0,1): 0.100, (0,2,0,2): 0.080, (1,2,1,2): 0.070,\n        (0,3,0,3): 0.060, (1,3,1,3): 0.050, (2,3,2,3): 0.040,\n    }\n\n    # Symmetrize g_raw keys, e.g., (0,1|1,0) -> (0,1,0,1)\n    # The problem gives (0,1|1,0) = 0.1, which corresponds to p=0, q=1, r=1, s=0.\n    # Canonical key for (0,1,1,0) is ((0,1),(0,1)), representing (0,1,0,1) in flattened form.\n    # The dictionary above is already in canonical key form.\n    g_chem = np.zeros((N_QUBITS, N_QUBITS, N_QUBITS, N_QUBITS))\n    for p in range(N_QUBITS):\n        for q in range(N_QUBITS):\n            for r in range(N_QUBITS):\n                for s in range(N_QUBITS):\n                    # Create canonical key for lookup\n                    ps, qs = min(p, q), max(p, q)\n                    rs, ss = min(r, s), max(r, s)\n                    pair1 = (ps, qs)\n                    pair2 = (rs, ss)\n\n                    key_tuple = tuple(sorted([pair1, pair2]))\n                    key = key_tuple[0] + key_tuple[1]\n                    g_chem[p, q, r, s] = g_raw.get(key, 0.0)\n    \n    # Construct Hamiltonian matrix\n    H = np.zeros((HILBERT_DIM, HILBERT_DIM), dtype=np.complex128)\n    # One-electron part\n    for p in range(N_QUBITS):\n        for q in range(N_QUBITS):\n            H += h_pq[p, q] * (adag_ops[p] @ a_ops[q])\n            \n    # Two-electron part using physics convention g_pqrs=(pr|qs)\n    for p in range(N_QUBITS):\n        for q in range(N_QUBITS):\n            for r in range(N_QUBITS):\n                for s in range(N_QUBITS):\n                    g_phys_val = g_chem[p, r, q, s]\n                    op_term = adag_ops[p] @ adag_ops[q] @ a_ops[s] @ a_ops[r]\n                    H += 0.5 * g_phys_val * op_term\n\n    # --- Step 3: Construct the Operator Pool Matrices ---\n    pool = []\n    # Single excitations\n    singles_map = [(0, 2), (0, 3), (1, 2), (1, 3)]\n    for p, r in singles_map:\n        A_k = (adag_ops[r] @ a_ops[p]) - (adag_ops[p] @ a_ops[r])\n        pool.append(A_k)\n    # Double excitation\n    p, q, r, s = 0, 1, 2, 3\n    A_double = (adag_ops[r] @ adag_ops[s] @ a_ops[q] @ a_ops[p]) - \\\n               (adag_ops[p] @ adag_ops[q] @ a_ops[s] @ a_ops[r])\n    pool.append(A_double)\n\n    # --- Step 4: Prepare the Test States ---\n    test_states = []\n    \n    # State 1: |1100> ket means occupied orbitals {0,1}, which is bitstring 0011_2 = 3\n    psi1 = np.zeros(HILBERT_DIM, dtype=np.complex128)\n    psi1[3] = 1.0\n    test_states.append(psi1)\n    \n    # State 2: Rotated state\n    epsilon = 0.15\n    A0 = pool[0] # A^(1)_{0->2}\n    U = expm(epsilon * A0)\n    psi2 = U @ psi1\n    test_states.append(psi2)\n    \n    # State 3: Exact ground state in 2-electron subspace\n    subspace_indices = []\n    for c in combinations(range(N_QUBITS), N_ELECTRONS):\n        idx = (1 << c[0]) | (1 << c[1])\n        subspace_indices.append(idx)\n    subspace_indices.sort()\n    \n    H_subspace = H[np.ix_(subspace_indices, subspace_indices)]\n    eigvals, eigvecs = np.linalg.eigh(H_subspace)\n    \n    gs_subspace_vec = eigvecs[:, 0]\n    psi3 = np.zeros(HILBERT_DIM, dtype=np.complex128)\n    psi3[subspace_indices] = gs_subspace_vec\n    test_states.append(psi3)\n\n    # --- Step 5: Gradient Evaluation and Selection ---\n    final_results = []\n    for psi in test_states:\n        gradients = []\n        for A_k in pool:\n            commutator = (H @ A_k) - (A_k @ H)\n            grad = np.vdot(psi, commutator @ psi)\n            gradients.append(grad.real)\n        \n        gradients = np.array(gradients)\n        abs_gradients = np.abs(gradients)\n        \n        max_grad_mag = np.max(abs_gradients)\n        \n        if max_grad_mag < TOLERANCE:\n            selected_index = -1\n        else:\n            selected_index = np.argmax(abs_gradients)\n            \n        final_results.append(selected_index)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n\n```"}]}