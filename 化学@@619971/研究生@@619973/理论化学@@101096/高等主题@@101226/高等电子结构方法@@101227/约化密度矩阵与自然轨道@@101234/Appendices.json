{"hands_on_practices": [{"introduction": "我们的第一个实践练习旨在将约化密度矩阵（RDM）的概念植根于最熟悉的场景中：Hartree-Fock 波函数。通过为一个简单的双电子体系构建单粒子约化密度矩阵（1-RDM），我们将具体地验证其幂等性。这个练习将清晰地揭示，在单行列式近似下，正则 Hartree-Fock 轨道本身就是自然轨道，其占据数只能是 $1$ 或 $0$ [@problem_id:2919921]。", "problem": "考虑一个归一化的哈特里-福克 (HF) 参考态，它是由 $N$ 个电子占据一组由 $M$ 个正则自旋轨道 $\\{\\chi_{p}\\}_{p=1}^{M}$ 构成的标准正交集所形成的单一斯莱特行列式。在二次量子化中，单粒子约化密度矩阵 (1-RDM) 由矩阵元 $\\gamma_{pq} \\equiv \\langle \\Phi | \\hat{a}_{q}^{\\dagger}\\hat{a}_{p} | \\Phi \\rangle$ 定义，其中 $\\hat{a}_{p}$ 和 $\\hat{a}_{p}^{\\dagger}$ 是满足正则反对易关系的费米子湮灭和产生算符。从这些定义和费米子算符的代数出发。 \n\n将其特殊化到 $M=4$ 和 $N=2$ 的情况，其中 HF 行列式占据自旋轨道 $\\chi_{1}$ 和 $\\chi_{2}$，而 $\\chi_{3}$ 和 $\\chi_{4}$ 未被占据。仅使用上述定义和斯莱特行列式的性质，在给定的 $\\{\\chi_{p}\\}$ 基中推导出显式的 $4\\times 4$ 矩阵 $\\gamma$，然后确定 $\\gamma$ 的本征值。使用自然轨道是 1-RDM 的本征函数的定义来验证你的结果。 \n\n将排序后的本征值列表以单行的形式报告。你的最终答案必须是写成单行矩阵形式的本征值行向量。无需四舍五入，不涉及单位。", "solution": "该问题陈述在科学上是合理的且表述清晰。我们将着手进行推导。\n\n该系统由 $N=2$ 个电子组成，由一个哈特里-福克 (HF) 态 $|\\Phi\\rangle$ 描述。这个态是由 $M=4$ 个标准正交自旋轨道 $\\{\\chi_p\\}_{p=1}^{4}$ 构建的单一斯莱特行列式。已占据的自旋轨道是 $\\chi_1$ 和 $\\chi_2$，而 $\\chi_3$ 和 $\\chi_4$ 是未占据的（虚轨道）。\n\n在二次量子化的形式体系中，通过将已占据自旋轨道的产生算符作用于真空态 $|0\\rangle$，可以构建归一化的 HF 态 $|\\Phi\\rangle$：\n$$\n|\\Phi\\rangle = \\hat{a}_1^{\\dagger}\\hat{a}_2^{\\dagger}|0\\rangle\n$$\n产生 ($\\hat{a}_p^{\\dagger}$) 和湮灭 ($\\hat{a}_p$) 算符遵循正则费米子反对易关系：\n$$\n\\{\\hat{a}_p, \\hat{a}_q\\} = \\hat{a}_p\\hat{a}_q + \\hat{a}_q\\hat{a}_p = 0\n$$\n$$\n\\{\\hat{a}_p^{\\dagger}, \\hat{a}_q^{\\dagger}\\} = \\hat{a}_p^{\\dagger}\\hat{a}_q^{\\dagger} + \\hat{a}_q^{\\dagger}\\hat{a}_p^{\\dagger} = 0\n$$\n$$\n\\{\\hat{a}_p, \\hat{a}_q^{\\dagger}\\} = \\hat{a}_p\\hat{a}_q^{\\dagger} + \\hat{a}_q^{\\dagger}\\hat{a}_p = \\delta_{pq}\n$$\n其中 $\\delta_{pq}$ 是克罗内克 δ 符号。\n\n单粒子约化密度矩阵 (1-RDM)，用矩阵 $\\boldsymbol{\\gamma}$ 表示，其矩阵元 $\\gamma_{pq}$ 定义为算符乘积 $\\hat{a}_q^{\\dagger}\\hat{a}_p$ 相对于态 $|\\Phi\\rangle$ 的期望值：\n$$\n\\gamma_{pq} = \\langle \\Phi | \\hat{a}_q^{\\dagger}\\hat{a}_p | \\Phi \\rangle\n$$\n我们可以将此表达式重写为两个态的内积：\n$$\n\\gamma_{pq} = \\langle \\hat{a}_q \\Phi | \\hat{a}_p \\Phi \\rangle\n$$\n为了计算 $4 \\times 4$ 矩阵 $\\boldsymbol{\\gamma}$，我们必须对每个基指标 $p \\in \\{1, 2, 3, 4\\}$ 计算态 $|\\Psi_p\\rangle \\equiv \\hat{a}_p |\\Phi\\rangle$。\n\n我们首先考虑 $p$ 是已占据轨道指标的情况，即 $p \\in \\{1, 2\\}$。\n对于 $p=1$：\n$$\n|\\Psi_1\\rangle = \\hat{a}_1 |\\Phi\\rangle = \\hat{a}_1 (\\hat{a}_1^{\\dagger}\\hat{a}_2^{\\dagger}|0\\rangle) = (\\hat{a}_1\\hat{a}_1^{\\dagger})\\hat{a}_2^{\\dagger}|0\\rangle\n$$\n使用反对易关系 $\\hat{a}_1\\hat{a}_1^{\\dagger} = 1 - \\hat{a}_1^{\\dagger}\\hat{a}_1$，我们有：\n$$\n|\\Psi_1\\rangle = (1 - \\hat{a}_1^{\\dagger}\\hat{a}_1)\\hat{a}_2^{\\dagger}|0\\rangle = \\hat{a}_2^{\\dagger}|0\\rangle - \\hat{a}_1^{\\dagger}\\hat{a}_1\\hat{a}_2^{\\dagger}|0\\rangle\n$$\n由于 $\\hat{a}_1$ 和 $\\hat{a}_2^{\\dagger}$ 反对易，所以 $\\hat{a}_1\\hat{a}_2^{\\dagger} = -\\hat{a}_2^{\\dagger}\\hat{a}_1$。此外，$\\hat{a}_1|0\\rangle=0$。因此：\n$$\n|\\Psi_1\\rangle = \\hat{a}_2^{\\dagger}|0\\rangle - \\hat{a}_1^{\\dagger}(-\\hat{a}_2^{\\dagger}\\hat{a}_1)|0\\rangle = \\hat{a}_2^{\\dagger}|0\\rangle + \\hat{a}_1^{\\dagger}\\hat{a}_2^{\\dagger}(\\hat{a}_1|0\\rangle) = \\hat{a}_2^{\\dagger}|0\\rangle\n$$\n对于 $p=2$：\n$$\n|\\Psi_2\\rangle = \\hat{a}_2 |\\Phi\\rangle = \\hat{a}_2 (\\hat{a}_1^{\\dagger}\\hat{a}_2^{\\dagger}|0\\rangle) = -\\hat{a}_1^{\\dagger}\\hat{a}_2\\hat{a}_2^{\\dagger}|0\\rangle\n$$\n使用 $\\hat{a}_2\\hat{a}_2^{\\dagger} = 1 - \\hat{a}_2^{\\dagger}\\hat{a}_2$ 且 $\\hat{a}_2|0\\rangle=0$：\n$$\n|\\Psi_2\\rangle = -\\hat{a}_1^{\\dagger}(1 - \\hat{a}_2^{\\dagger}\\hat{a}_2)|0\\rangle = -\\hat{a}_1^{\\dagger}|0\\rangle + \\hat{a}_1^{\\dagger}\\hat{a}_2^{\\dagger}(\\hat{a}_2|0\\rangle) = -\\hat{a}_1^{\\dagger}|0\\rangle\n$$\n现在，考虑 $p$ 是未占据（虚）轨道指标的情况，即 $p \\in \\{3, 4\\}$。\n对于 $p=3$：\n$$\n|\\Psi_3\\rangle = \\hat{a}_3 |\\Phi\\rangle = \\hat{a}_3 \\hat{a}_1^{\\dagger}\\hat{a}_2^{\\dagger}|0\\rangle = -\\hat{a}_1^{\\dagger}\\hat{a}_3\\hat{a}_2^{\\dagger}|0\\rangle = \\hat{a}_1^{\\dagger}\\hat{a}_2^{\\dagger}\\hat{a}_3|0\\rangle = 0\n$$\n同理，对于 $p=4$：\n$$\n|\\Psi_4\\rangle = \\hat{a}_4 |\\Phi\\rangle = 0\n$$\n总而言之，我们得到以下各态：\n$|\\Psi_1\\rangle = \\hat{a}_2^{\\dagger}|0\\rangle$\n$|\\Psi_2\\rangle = -\\hat{a}_1^{\\dagger}|0\\rangle$\n$|\\Psi_3\\rangle = 0$\n$|\\Psi_4\\rangle = 0$\n\n现在我们可以计算矩阵元 $\\gamma_{pq} = \\langle \\Psi_q | \\Psi_p \\rangle$。\n\n对角元 ($p=q$)：\n$$\n\\gamma_{11} = \\langle \\Psi_1 | \\Psi_1 \\rangle = \\langle \\hat{a}_2^{\\dagger}0 | \\hat{a}_2^{\\dagger}0 \\rangle = \\langle 0 | \\hat{a}_2 \\hat{a}_2^{\\dagger} | 0 \\rangle = \\langle 0 | (1 - \\hat{a}_2^{\\dagger}\\hat{a}_2) | 0 \\rangle = \\langle 0 | 0 \\rangle = 1\n$$\n$$\n\\gamma_{22} = \\langle \\Psi_2 | \\Psi_2 \\rangle = \\langle -\\hat{a}_1^{\\dagger}0 | -\\hat{a}_1^{\\dagger}0 \\rangle = \\langle 0 | \\hat{a}_1 \\hat{a}_1^{\\dagger} | 0 \\rangle = 1\n$$\n$$\n\\gamma_{33} = \\langle \\Psi_3 | \\Psi_3 \\rangle = \\langle 0 | 0 \\rangle = 0\n$$\n$$\n\\gamma_{44} = \\langle \\Psi_4 | \\Psi_4 \\rangle = \\langle 0 | 0 \\rangle = 0\n$$\n\n非对角元 ($p \\neq q$)：\n态 $|\\Psi_1\\rangle = \\hat{a}_2^{\\dagger}|0\\rangle$ 和 $|\\Psi_2\\rangle = -\\hat{a}_1^{\\dagger}|0\\rangle$ 分别表示处于标准正交自旋轨道 $\\chi_2$ 和 $\\chi_1$ 中的单粒子。因此，它们是正交的。\n$$\n\\gamma_{12} = \\langle \\Psi_2 | \\Psi_1 \\rangle = \\langle -\\hat{a}_1^{\\dagger}0 | \\hat{a}_2^{\\dagger}0 \\rangle = -\\langle 0 | \\hat{a}_1 \\hat{a}_2^{\\dagger} | 0 \\rangle = \\langle 0 | \\hat{a}_2^{\\dagger} \\hat{a}_1 | 0 \\rangle = 0\n$$\n同样，$\\gamma_{21} = \\gamma_{12}^* = 0$。\n任何涉及虚轨道指标 $p \\in \\{3, 4\\}$ 的矩阵元都将为零，因为 $|\\Psi_3\\rangle=0$ 且 $|\\Psi_4\\rangle=0$。例如：\n$$\n\\gamma_{13} = \\langle \\Psi_3 | \\Psi_1 \\rangle = \\langle 0 | \\Psi_1 \\rangle = 0\n$$\n$$\n\\gamma_{34} = \\langle \\Psi_4 | \\Psi_3 \\rangle = \\langle 0 | 0 \\rangle = 0\n$$\n$\\boldsymbol{\\gamma}$ 矩阵的所有非对角元都为零。\n\n综合这些结果，在自旋轨道基 $\\{\\chi_1, \\chi_2, \\chi_3, \\chi_4\\}$ 下，1-RDM 的 $4 \\times 4$ 矩阵为：\n$$\n\\boldsymbol{\\gamma} = \\begin{pmatrix} 1 & 0 & 0 & 0 \\\\ 0 & 1 & 0 & 0 \\\\ 0 & 0 & 0 & 0 \\\\ 0 & 0 & 0 & 0 \\end{pmatrix}\n$$\n由于该矩阵是对角矩阵，其本征值就是其对角元。因此，$\\boldsymbol{\\gamma}$ 的本征值为 $1$, $1$, $0$, $0$。将它们从大到小排序，我们得到列表 $(1, 1, 0, 0)$。矩阵的迹为 $\\text{Tr}(\\boldsymbol{\\gamma}) = 1+1+0+0 = 2$，这正确地等于电子数 $N$。\n\n这个结果可以通过自然轨道的定义来验证。自然轨道是 1-RDM 的本征函数，相应的本征值是自然占据数。1-RDM 矩阵的本征值方程是 $\\boldsymbol{\\gamma} \\mathbf{c} = n \\mathbf{c}$，其中 $n$ 是一个占据数，本征矢量 $\\mathbf{c}$ 给出了自然轨道在初始基 $\\{\\chi_p\\}$ 中的系数。\n在这种情况下，1-RDM 矩阵 $\\boldsymbol{\\gamma}$ 在 HF 自旋轨道基 $\\{\\chi_p\\}$ 中是对角的。这表明 HF 轨道 $\\{\\chi_1, \\chi_2, \\chi_3, \\chi_4\\}$ 本身就是该系统的自然轨道。$\\boldsymbol{\\gamma}$ 的本征值是对角元，它们直接表示这些自然轨道的占据数。\n本征值 $n_1=1$ 和 $n_2=1$ 对应于已占据轨道 $\\chi_1$ 和 $\\chi_2$。本征值 $n_3=0$ 和 $n_4=0$ 对应于未占据的虚轨道 $\\chi_3$ 和 $\\chi_4$。这证实了一条普遍原理：对于任何单行列式波函数，自然轨道的占据数只能是 $1$ 或 $0$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & 1 & 0 & 0\n\\end{pmatrix}\n}\n$$", "id": "2919921"}, {"introduction": "接下来，我们将超越单行列式的图像，探讨电子关联如何体现在 1-RDM 中。通过分析一个包含多个组态的 CASSCF 波函数，我们将计算其 1-RDM 并发现其本征值——即自然轨道占据数——不再是简单的整数。这个练习旨在强调自然轨道作为一个强大的诊断工具，它揭示了化学键的本质，并为在更高级的计算中选择活性空间提供了定量依据 [@problem_id:2919927]。", "problem": "考虑一个在正交归一的空间轨道集 $\\{\\phi_{1}, \\phi_{2}, \\phi_{3}\\}$ 中定义的全活性空间 $\\mathrm{CAS}(2,3)$ 自旋单重态波函数。设对于每个空间轨道指标 $p$，其自旋轨道为 $\\{\\phi_{p}\\alpha, \\phi_{p}\\beta\\}$。使用二次量子化方法定义以下归一化的自旋匹配组态态函数 (CSF)：轨道 $p$ 上的双占据单重态 $|D_{p}\\rangle \\equiv a_{p\\alpha}^{\\dagger}a_{p\\beta}^{\\dagger}|0\\rangle$，以及跨越轨道 $p$ 和 $q$ 的开壳层单重态 $|S_{pq}\\rangle \\equiv \\frac{1}{\\sqrt{2}}\\left(a_{p\\alpha}^{\\dagger}a_{q\\beta}^{\\dagger}-a_{p\\beta}^{\\dagger}a_{q\\alpha}^{\\dagger}\\right)|0\\rangle$。考虑归一化的 $\\mathrm{CAS}(2,3)$ 波函数\n$$\n|\\Psi\\rangle \\;=\\; a\\,|D_{1}\\rangle \\;+\\; b\\,|S_{12}\\rangle \\;+\\; c\\,|S_{13}\\rangle,\n$$\n其系数 $a = \\sqrt{\\frac{1}{2}}$、$b = \\sqrt{\\frac{1}{3}}$ 和 $c = \\sqrt{\\frac{1}{6}}$ 均为实数。\n\n仅使用基本定义，完成以下任务：\n- 在空间轨道基下，构建自旋求和的单粒子约化密度矩阵（1-RDM），其定义为\n$$\n\\gamma_{pq} \\;=\\; \\langle \\Psi | \\hat{E}^{p}_{q} | \\Psi \\rangle, \\quad \\text{with} \\quad \\hat{E}^{p}_{q} \\;=\\; \\sum_{\\sigma \\in \\{\\alpha,\\beta\\}} a_{p\\sigma}^{\\dagger} a_{q\\sigma}.\n$$\n- 将 $3\\times 3$ 矩阵 $\\boldsymbol{\\gamma}$ 对角化，以获得自然轨道（$\\boldsymbol{\\gamma}$ 的本征向量）及其自然占有数 $\\{n_{i}\\}$（$\\boldsymbol{\\gamma}$ 的本征值）。\n- 根据标准的活性空间选择启发法“包含那些占有数满足 $0.02 < n_{i} < 1.98$ 的空间自然轨道”，确定对于此状态，应在活性空间中保留多少个空间轨道。\n\n你的最终答案必须是根据此标准选出的空间轨道数量的单个整数。不需要四舍五入，也不涉及单位。不要报告本征向量；最终答案只要求整数数量。", "solution": "该问题陈述经过验证，被认为是科学上可靠、定义明确、客观且自洽的。它提出了一个量子化学中的标准练习，涉及对给定的多组态波函数计算和解释其单粒子约化密度矩阵 (1-RDM)。所有定义都是标准的，所有数据都是一致的。因此，该问题被视为有效，并将提供解答。\n\n主要任务是为给定的 $\\mathrm{CAS}(2,3)$ 波函数 $|\\Psi\\rangle$ 计算自旋求和的单粒子约化密度矩阵 $\\boldsymbol{\\gamma}$，求出其本征值（自然占有数），然后应用给定的标准来计算活性轨道的数量。\n\n给定的归一化波函数为\n$$\n|\\Psi\\rangle = a|D_{1}\\rangle + b|S_{12}\\rangle + c|S_{13}\\rangle,\n$$\n其系数 $a = \\sqrt{\\frac{1}{2}}$、$b = \\sqrt{\\frac{1}{3}}$ 和 $c = \\sqrt{\\frac{1}{6}}$ 均为实数。组态态函数 (CSF) 定义在一个正交归一的空间轨道基 $\\{\\phi_1, \\phi_2, \\phi_3\\}$ 中。\n\n$1$-RDM 的矩阵元 $\\gamma_{pq}$ 定义为\n$$\n\\gamma_{pq} = \\langle \\Psi | \\hat{E}^{p}_{q} | \\Psi \\rangle, \\quad \\text{where} \\quad \\hat{E}^{p}_{q} = \\sum_{\\sigma \\in \\{\\alpha,\\beta\\}} a_{p\\sigma}^{\\dagger} a_{q\\sigma}.\n$$\n通过展开期望值直接计算 $3 \\times 3$ 矩阵 $\\boldsymbol{\\gamma}$ 的所有九个元素是可行的，但很繁琐。一种更巧妙的方法是识别波函数的结构。CSF $|S_{12}\\rangle$ 和 $|S_{13}\\rangle$ 都代表从双占据轨道 $\\phi_1$ 到轨道 $\\phi_2$ 和 $\\phi_3$ 的单重态耦合单激发。这表明，通过在 $\\{\\phi_2, \\phi_3\\}$ 子空间内定义一组新轨道，可以简化问题。\n\n我们定义一个新的正交归一基 $\\{\\phi_1, \\phi'_2, \\phi'_3\\}$，其中 $\\phi_1$ 不变，而 $\\{\\phi'_2, \\phi'_3\\}$ 是通过对 $\\{\\phi_2, \\phi_3\\}$ 进行旋转得到的：\n$$\n\\phi'_2 = \\frac{1}{\\sqrt{b^2+c^2}}(b\\phi_2 + c\\phi_3)\n$$\n$$\n\\phi'_3 = \\frac{1}{\\sqrt{b^2+c^2}}(c\\phi_2 - b\\phi_3)\n$$\n归一化常数为 $\\sqrt{b^2+c^2} = \\sqrt{\\frac{1}{3}+\\frac{1}{6}} = \\sqrt{\\frac{3}{6}} = \\sqrt{\\frac{1}{2}}$。\n设 $a'_{p\\sigma}, a'^{\\dagger}_{p\\sigma}$ 为这些新轨道的湮灭和产生算符。产生算符的变换为：\n$$\na'^{\\dagger}_{2\\sigma} = \\frac{1}{\\sqrt{b^2+c^2}}(b a^{\\dagger}_{2\\sigma} + c a^{\\dagger}_{3\\sigma}) = \\sqrt{2}(b a^{\\dagger}_{2\\sigma} + c a^{\\dagger}_{3\\sigma})\n$$\n$|\\Psi\\rangle$ 中 CSF 的线性组合可以重写为：\n$$\nb|S_{12}\\rangle + c|S_{13}\\rangle = \\frac{1}{\\sqrt{2}} \\left[ a_{1\\alpha}^{\\dagger}(b a_{2\\beta}^{\\dagger} + c a_{3\\beta}^{\\dagger}) - a_{1\\beta}^{\\dagger}(b a_{2\\alpha}^{\\dagger} + c a_{3\\alpha}^{\\dagger}) \\right] |0\\rangle\n$$\n使用逆变换 $b a^{\\dagger}_{2\\sigma} + c a^{\\dagger}_{3\\sigma} = \\sqrt{b^2+c^2} a'^{\\dagger}_{2\\sigma}$，这变为：\n$$\nb|S_{12}\\rangle + c|S_{13}\\rangle = \\frac{\\sqrt{b^2+c^2}}{\\sqrt{2}} \\left( a_{1\\alpha}^{\\dagger} a'^{\\dagger}_{2\\beta} - a_{1\\beta}^{\\dagger} a'^{\\dagger}_{2\\alpha} \\right) |0\\rangle = \\sqrt{b^2+c^2}|S_{12'}\\rangle\n$$\n其中 $|S_{12'}\\rangle$ 是用轨道 $\\phi_1$ 和 $\\phi'_2$ 定义的开壳层单重态 CSF。\n在新基 $\\{\\phi_1, \\phi'_2, \\phi'_3\\}$ 中的波函数是：\n$$\n|\\Psi\\rangle = a|D_1\\rangle + \\sqrt{b^2+c^2}|S_{12'}\\rangle\n$$\n代入给定值 $a=\\sqrt{\\frac{1}{2}}$ 和 $\\sqrt{b^2+c^2}=\\sqrt{\\frac{1}{2}}$，我们得到：\n$$\n|\\Psi\\rangle = \\sqrt{\\frac{1}{2}}|D_1\\rangle + \\sqrt{\\frac{1}{2}}|S_{12'}\\rangle\n$$\n这是一个仅涉及轨道 $\\phi_1$ 和 $\\phi'_2$ 的简单双组态波函数。轨道 $\\phi'_3$ 在两个组态中均未被占据。因此，在基 $\\{\\phi_1, \\phi'_2, \\phi'_3\\}$ 中，我们记为 $\\boldsymbol{\\gamma'}$ 的 $1$-RDM 必定是块对角的。$\\phi'_3$ 的占有数为零，所以 $\\boldsymbol{\\gamma'}$ 的第三行和第三列全为零。问题简化为求解与 $\\{\\phi_1, \\phi'_2\\}$ 空间对应的 $2\\times 2$ 子矩阵的本征值。\n\n这个 $2\\times 2$ 子矩阵的矩阵元是：\n$$\n\\gamma'_{11} = \\langle \\Psi | \\hat{n}_1 | \\Psi \\rangle = \\left(\\sqrt{\\frac{1}{2}}\\right)^2 \\langle D_1 | \\hat{n}_1 | D_1 \\rangle + \\left(\\sqrt{\\frac{1}{2}}\\right)^2 \\langle S_{12'} | \\hat{n}_1 | S_{12'} \\rangle = \\frac{1}{2}(2) + \\frac{1}{2}(1) = \\frac{3}{2}\n$$\n$$\n\\gamma'_{22} = \\langle \\Psi | \\hat{n}_{2'} | \\Psi \\rangle = \\left(\\sqrt{\\frac{1}{2}}\\right)^2 \\langle D_1 | \\hat{n}_{2'} | D_1 \\rangle + \\left(\\sqrt{\\frac{1}{2}}\\right)^2 \\langle S_{12'} | \\hat{n}_{2'} | S_{12'} \\rangle = \\frac{1}{2}(0) + \\frac{1}{2}(1) = \\frac{1}{2}\n$$\n$$\n\\gamma'_{12} = \\langle \\Psi | \\hat{E}^{1}_{2'} | \\Psi \\rangle = \\sqrt{\\frac{1}{2}}\\sqrt{\\frac{1}{2}} \\langle D_1 | \\hat{E}^{1}_{2'} | S_{12'} \\rangle\n$$\n矩阵元 $\\langle D_1 | \\hat{E}^{1}_{2'} | S_{12'} \\rangle$ 对于双电子/双轨道系统是一个标准结果，其值为 $-\\sqrt{2}$。因此，\n$$\n\\gamma'_{12} = \\frac{1}{2}(-\\sqrt{2}) = -\\frac{1}{\\sqrt{2}}\n$$\n根据厄米性，$\\gamma'_{21} = \\gamma'_{12} = -\\frac{1}{\\sqrt{2}}$。\n变换后基矢下的完整 $1$-RDM 为：\n$$\n\\boldsymbol{\\gamma'} = \\begin{pmatrix} \\frac{3}{2} & -\\frac{1}{\\sqrt{2}} & 0 \\\\ -\\frac{1}{\\sqrt{2}} & \\frac{1}{2} & 0 \\\\ 0 & 0 & 0 \\end{pmatrix}\n$$\n矩阵的本征值在幺正基变换下是不变的。因此，$\\boldsymbol{\\gamma}$ 的本征值（自然占有数）与 $\\boldsymbol{\\gamma'}$ 的本征值相同。\n一个本征值显然是 $n_3=0$。另外两个是左上角 $2 \\times 2$ 块的本征值。我们求解特征方程：\n$$\n\\det \\begin{pmatrix} \\frac{3}{2} - n & -\\frac{1}{\\sqrt{2}} \\\\ -\\frac{1}{\\sqrt{2}} & \\frac{1}{2} - n \\end{pmatrix} = 0\n$$\n$$\n\\left(\\frac{3}{2} - n\\right)\\left(\\frac{1}{2} - n\\right) - \\left(-\\frac{1}{\\sqrt{2}}\\right)^2 = 0\n$$\n$$\n\\frac{3}{4} - 2n + n^2 - \\frac{1}{2} = 0\n$$\n$$\nn^2 - 2n + \\frac{1}{4} = 0\n$$\n$$\n4n^2 - 8n + 1 = 0\n$$\n使用二次方程求根公式，本征值为：\n$$\nn = \\frac{-(-8) \\pm \\sqrt{(-8)^2 - 4(4)(1)}}{2(4)} = \\frac{8 \\pm \\sqrt{64 - 16}}{8} = \\frac{8 \\pm \\sqrt{48}}{8} = \\frac{8 \\pm 4\\sqrt{3}}{8} = 1 \\pm \\frac{\\sqrt{3}}{2}\n$$\n因此，三个自然占有数 $\\{n_i\\}$ 分别为：\n$$\nn_1 = 1 + \\frac{\\sqrt{3}}{2} \\approx 1 + \\frac{1.732}{2} = 1.866\n$$\n$$\nn_2 = 1 - \\frac{\\sqrt{3}}{2} \\approx 1 - \\frac{1.732}{2} = 0.134\n$$\n$$\nn_3 = 0\n$$\n占有数之和为 $n_1+n_2+n_3 = (1+\\frac{\\sqrt{3}}{2})+(1-\\frac{\\sqrt{3}}{2})+0 = 2$，这正确地等于电子数。\n\n最后一步是应用活性空间选择标准，该标准规定，如果一个轨道的占有数 $n_i$ 满足 $0.02 < n_i < 1.98$，则该轨道被包含在内。\n\\begin{itemize}\n    \\item 对于 $n_1 = 1 + \\frac{\\sqrt{3}}{2}$：我们有 $0.02 < 1.866 < 1.98$。条件满足。\n    \\item 对于 $n_2 = 1 - \\frac{\\sqrt{3}}{2}$：我们有 $0.02 < 0.134 < 1.98$。条件满足。\n    \\item 对于 $n_3 = 0$：条件 $0.02 < 0$ 不满足。\n\\end{itemize}\n有两个自然轨道的占有数落在指定范围内，可以被包含在活性空间中。因此，应保留的空间轨道数量为 $2$。", "answer": "$$\\boxed{2}$$", "id": "2919927"}, {"introduction": "最后的这个高级实践将理论与计算实践联系起来，触及了 RDM 理论中的一个核心问题：N-可表示性（N-representability）。并非任何满足基本对称性的矩阵都可以成为一个物理上真实的约化密度矩阵，它必须满足源于泡利不相容原理的更深刻的约束。通过编写一个程序来数值检验一个试探性的双粒子约化密度矩阵（2-RDM）是否满足 $P$、$Q$ 和 $G$ 这三个必要的半正定条件，您将获得对这些基本物理约束的实践性理解 [@problem_id:2919901]。", "problem": "要求您编写一个完整、可运行的程序，该程序为一个正交自旋轨道基中的小费米子体系，数值上检验一个给定的试验性双电子约化密度矩阵是否满足三个标准的系综可表示性正定条件，即所谓的$P$、$Q$和$G$条件。该程序必须计算三个作为双电子约化密度矩阵线性映射的矩阵的本征值，并返回布尔值以指示每个矩阵是否为半正定。\n\n请从多体量子化学中的以下标准基础和定义开始：\n\n- 考虑一个包含$M$个正交自旋轨道和$N$个电子的费米子体系。费米子湮灭算符$a_i$和产生算符$a_i^\\dagger$遵循正则反对易关系$\\{a_i,a_j^\\dagger\\}=\\delta_{ij}$和$\\{a_i,a_j\\}=\\{a_i^\\dagger,a_j^\\dagger\\}=0$。\n- 单电子约化密度矩阵（$1$-RDM）为$\\gamma_i^{\\,k}=\\langle \\Psi|\\,a_i^\\dagger a_k\\,|\\Psi\\rangle$。\n- 双电子约化密度矩阵（$2$-RDM）为$\\Gamma_{ij}^{\\,kl}=\\langle \\Psi|\\,a_i^\\dagger a_j^\\dagger a_l a_k\\,|\\Psi\\rangle$。它在指标对$(i,j)$和$(k,l)$上满足反对称性，并满足厄米关系$\\Gamma_{ij}^{\\,kl}=\\left(\\Gamma_{kl}^{\\,ij}\\right)^\\ast$。对于实数值情况，您可以假定所有矩阵元均为实数。\n- 连接$2$-RDM和$1$-RDM的收缩恒等式为$\\sum_{j=1}^{M}\\Gamma_{ij}^{\\,kj}=(N-1)\\,\\gamma_i^{\\,k}$。\n- 定义三个算符导出的矩阵（在适当的复合指标空间上）：\n  - $P$-映射作用于反对称化的双粒子指标，并直接对应于$2$-RDM：$P_{(ij),(kl)}=\\Gamma_{ij}^{\\,kl}$，其中$i<j$且$k<l$。\n  - $Q$-映射作用于反对称化的双空穴指标：$Q_{ij}^{\\,kl}=\\langle \\Psi|\\,a_i a_j a_l^\\dagger a_k^\\dagger\\,|\\Psi\\rangle$，其中$i<j$且$k<l$。您必须仅使用费米子反对易关系和上述定义，将$Q_{ij}^{\\,kl}$用$2$-RDM、$1$-RDM和克罗内克符号表示。\n  - $G$-映射作用于粒子-空穴空间：$G_{ik}^{\\,jl}=\\langle \\Psi|\\,a_i^\\dagger a_k a_l^\\dagger a_j\\,|\\Psi\\rangle$。您必须仅使用费米子反对易关系和上述定义，将$G_{ik}^{\\,jl}$用$2$-RDM、$1$-RDM和克罗内克符号表示。\n- $P$，$Q$和$G$条件要求相应的矩阵是半正定的。在数值上，您应检查最小本征值是否大于或等于一个小的非负容差$\\varepsilon$，即$\\lambda_{\\min}\\ge -\\varepsilon$。\n\n您的程序必须：\n\n- 为下面指定的几个测试用例构造试验性$2$-RDM，通过收缩$\\sum_j \\Gamma_{ij}^{\\,kj}=(N-1)\\gamma_i^{\\,k}$计算相关的$1$-RDM，据此构建$P$，$Q$和$G$矩阵，并通过本征值分析检验它们的半正定性。\n- 对于本征值阈值处理，使用固定的数值容差$\\varepsilon=10^{-8}$。\n\n实现要求：\n\n- 将指标表示为从$0$到$M-1$的整数。\n- 对于在反对称化的双粒子（或双空穴）空间上定义的对象，使用字典序排列的指标集$\\{(i,j)\\,|\\,0\\le i<j\\le M-1\\}$来构建具有复合指标$(ij)$和$(kl)$的矩阵。\n- 对于粒子-空穴$G$-矩阵，在完整的$M\\times M$空间上使用复合指标$(i,k)$和$(j,l)$。\n- 当$1$-RDM $\\gamma$是秩为$N$的幂等投影算符时，使用Slater行列式恒等式$\\Gamma_{ij}^{\\,kl}=\\gamma_i^{\\,k}\\gamma_j^{\\,l}-\\gamma_i^{\\,l}\\gamma_j^{\\,k}$来构造行列式$2$-RDM。\n\n测试套件规范：\n\n为以下四种情况提供结果。在每种情况下，您必须按照描述组装试验性$2$-RDM $\\Gamma_{ij}^{\\,kl}$，然后通过收缩计算$1$-RDM $\\gamma$，最后检验$P$，$Q$和$G$条件。\n\n- 情况1（行列式，双电子）：$M=4$，$N=2$，一个占据自旋轨道为$\\{0,1\\}$的单一Slater行列式。将$\\gamma$构造为一个在被占据轨道上为1、其他地方为0的对角投影算符，然后通过$\\Gamma_{ij}^{\\,kl}=\\gamma_i^{\\,k}\\gamma_j^{\\,l}-\\gamma_i^{\\,l}\\gamma_j^{\\,k}$形成$\\Gamma_{ij}^{\\,kl}$。\n- 情况2（行列式，三电子）：$M=4$，$N=3$，一个占据自旋轨道为$\\{0,1,2\\}$的单一Slater行列式；如上所述构造$\\gamma$然后构造$\\Gamma$。\n- 情况3（行列式的凸系综）：$M=4$，$N=2$，两个不同Slater行列式的系综平均，权重相等，为$\\lambda=1/2$。行列式$\\mathcal{A}$占据$\\{0,1\\}$，行列式$\\mathcal{B}$占据$\\{0,2\\}$。使用前面情况中构建的两个行列式$2$-RDM，将$\\Gamma$构造为凸组合$\\Gamma=\\lambda\\,\\Gamma^{(\\mathcal{A})}+(1-\\lambda)\\,\\Gamma^{(\\mathcal{B})}$。\n- 情况4（为触发失败而构造的非物理$2$-RDM）：$M=4$，$N=2$，定义一个$6\\times 6$维的反对称化对基矩阵$P_{\\text{pair}}$，其所有元素均为零，除了$(0,0)$元素等于$-\\alpha$（其中$\\alpha=10^{-1}$）。对指标排序必须是字典序列表$(0,1),(0,2),(0,3),(1,2),(1,3),(2,3)$。通过以下方式将$P_{\\text{pair}}$映射到一个完整的四指标张量$\\Gamma_{ij}^{\\,kl}$：对于$i<j$和$k<l$，设置$\\Gamma_{ij}^{\\,kl}=(P_{\\text{pair}})_{(ij),(kl)}$；通过$\\Gamma_{ji}^{\\,kl}=-\\Gamma_{ij}^{\\,kl}$和$\\Gamma_{ij}^{\\,lk}=-\\Gamma_{ij}^{\\,kl}$在每对指标内进行反对称扩展；并通过取$\\Gamma_{ij}^{\\,kl}=\\Gamma_{kl}^{\\,ij}$（实数值）来确保厄米性。将这个$\\Gamma$完全作为试验输入，不施加任何进一步的物理约束，并通过收缩计算其诱导的$\\gamma$。\n\n对于每种情况，执行以下步骤：\n\n- 从给定或构造的$\\Gamma$出发，根据收缩恒等式计算$\\gamma$。\n- 仅使用正则反对易关系和上述定义，将$Q$和$G$用$\\Gamma$，$\\gamma$和克罗内克符号表示，从而构建$P$，$Q$和$G$。\n- 计算$P$，$Q$和$G$的所有本征值，并通过检查最小本征值是否大于或等于$-\\varepsilon$（其中$\\varepsilon=10^{-8}$）来判断半正定性。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含结果，形式为一个包含四个条目的逗号分隔列表，每个条目对应上述顺序的一个测试用例。每个条目本身必须是一个逗号分隔的布尔值列表，顺序为$(P,Q,G)$，并用方括号括起来。完整的输出应看起来像这四个带括号的三元组组成的单个带括号列表，不含任何额外文本，例如，`[[\\text{True},\\text{True},\\text{True}],[\\dots],[\\dots],[\\dots]]`。", "solution": "用户要求实现一个数值测试，用于检验双电子约化密度矩阵（$2$-RDM）的N-可表示性的$P$，$Q$和$G$正定条件。该问题定义明确，科学上可靠，并为数值求解提供了所有必要的规范。我将着手提供一个完整且论证充分的解决方案。\n\n问题的核心涉及约化密度矩阵（$1$-RDM和$2$-RDM）及相关线性映射（$P$，$Q$和$G$）的定义和操作。首先将推导必要的理论背景和公式，然后是计算实现策略。\n\n**1. 定义和基本关系**\n让我们考虑一个包含$N$个费米子的系统，这些费米子分布在$M$个正交自旋轨道上，轨道索引从$0$到$M-1$。这些轨道的产生和湮灭算符分别是$a_i^\\dagger$和$a_i$。\n\n$1$-RDM $\\gamma$ 和 $2$-RDM $\\Gamma$ 由其矩阵元定义：\n- $1$-RDM: $\\gamma_i^{\\,k} = \\langle \\Psi | a_i^\\dagger a_k | \\Psi \\rangle$\n- $2$-RDM: $\\Gamma_{ij}^{\\,kl} = \\langle \\Psi | a_i^\\dagger a_j^\\dagger a_l a_k | \\Psi \\rangle$\n\n由于底层算符的费米子性质，$2$-RDM具有内在的对称性：\n- 反对称性：$\\Gamma_{ij}^{\\,kl} = -\\Gamma_{ji}^{\\,kl} = -\\Gamma_{ij}^{\\,lk}$\n- 厄米性：$\\Gamma_{ij}^{\\,kl} = (\\Gamma_{kl}^{\\,ij})^*$（对于本问题，我们只考虑实数值RDM，因此$\\Gamma_{ij}^{\\,kl} = \\Gamma_{kl}^{\\,ij}$）\n\n$1$-RDM可以通过对$2$-RDM进行收缩得到。根据问题陈述，我们使用关系式 $\\sum_{j=0}^{M-1} \\Gamma_{ij}^{\\,kj} = (N-1)\\gamma_i^{\\,k}$。对于张量 `Gamma[i,j,k,l]`，用基于索引的表示法，这对应于 `gamma[i,k] = (1/(N-1)) * sum_j Gamma[i,j,k,j]`。\n\n**2. $Q$和$G$矩阵的推导**\n问题要求用$\\Gamma$和$\\gamma$来表示$Q$和$G$矩阵。\n\n**G-映射推导：**\n$G$-映射定义为 $G_{ik}^{\\,jl} = \\langle \\Psi | a_i^\\dagger a_k a_l^\\dagger a_j | \\Psi \\rangle$。\n使用反对易关系 $\\{a_k, a_l^\\dagger\\} = \\delta_{kl}$，我们得到 $a_k a_l^\\dagger = \\delta_{kl} - a_l^\\dagger a_k$。\n将其代入定义中：\n$G_{ik}^{\\,jl} = \\langle \\Psi | a_i^\\dagger (\\delta_{kl} - a_l^\\dagger a_k) a_j | \\Psi \\rangle = \\delta_{kl} \\langle \\Psi | a_i^\\dagger a_j | \\Psi \\rangle - \\langle \\Psi | a_i^\\dagger a_l^\\dagger a_k a_j | \\Psi \\rangle$\n识别出$\\gamma$和$\\Gamma$的定义：\n$G_{ik}^{\\,jl} = \\delta_{kl} \\gamma_i^{\\,j} - \\Gamma_{il}^{\\,jk}$\n\n**Q-映射推导：**\n$Q$-映射，或称双空穴RDM，定义为 $Q_{ij}^{\\,kl} = \\langle \\Psi | a_i a_j a_l^\\dagger a_k^\\dagger | \\Psi \\rangle$。\n这个表达式可以通过反复应用反对易关系将产生算符移到左边来展开。对一般态使用Wick定理，这个四算符串的完全展开式给出：\n$Q_{ij}^{\\,kl} = \\langle \\Psi | :a_i a_j a_l^\\dagger a_k^\\dagger: | \\Psi \\rangle + (\\text{收缩项})$\n正规排序项是 $\\langle \\Psi | a_l^\\dagger a_k^\\dagger a_i a_j | \\Psi \\rangle = \\Gamma_{lk}^{\\,ji}$。因为$\\Gamma$是实数，厄米性意味着$\\Gamma_{lk}^{\\,ji} = \\Gamma_{ji}^{\\,lk}$，反对称性给出$\\Gamma_{ji}^{\\,lk} = \\Gamma_{ij}^{\\,kl}$。因此，$\\langle : \\dots : \\rangle = \\Gamma_{ij}^{\\,kl}$。\n完整的展开式是多体理论中的一个标准结果：\n$Q_{ij}^{\\,kl} = \\Gamma_{ij}^{\\,kl} - (\\delta_{ik}\\gamma_j^l - \\delta_{il}\\gamma_j^k - \\delta_{jk}\\gamma_i^l + \\delta_{jl}\\gamma_i^k) + (\\delta_{ik}\\delta_{jl} - \\delta_{il}\\delta_{jk})$\n本问题涉及实数RDM，其中$\\gamma_j^l = \\gamma_l^j$。简化表达式可得：\n$Q_{ij}^{\\,kl} = \\Gamma_{ij}^{\\,kl} - \\delta_{ik}\\gamma_l^j + \\delta_{il}\\gamma_k^j + \\delta_{jk}\\gamma_l^i - \\delta_{jl}\\gamma_k^i + (\\delta_{ik}\\delta_{jl} - \\delta_{il}\\delta_{jk})$\n\n**3. 矩阵构造**\n$P$，$Q$和$G$矩阵构造如下：\n\n- $P$-矩阵：一个大小为 $\\binom{M}{2} \\times \\binom{M}{2}$ 的矩阵，由字典序排列的指标对 $(i,j)$（其中 $i<j$）索引。其元素就是 $P_{(ij),(kl)} = \\Gamma_{ij}^{\\,kl}$。\n\n- $Q$-矩阵：大小也为 $\\binom{M}{2} \\times \\binom{M}{2}$，由满足 $i<j$ 和 $k<l$ 的指标对索引。其元素 $Q_{(ij),(kl)}$ 使用上面推导的公式计算。\n\n- $G$-矩阵：一个大小为 $M^2 \\times M^2$ 的矩阵，由复合指标 $(i,k)$ 和 $(j,l)$ 索引，其中每个单独的指标范围都是从 $0$ 到 $M-1$。可以使用一个简单的映射，如 $(i,k) \\to i \\cdot M + k$。其元素 $G_{(ik),(jl)}$ 使用推导出的公式计算：$G_{ik}^{\\,jl} = \\delta_{kl}\\gamma_i^j - \\Gamma_{il}^{\\,jk}$。\n\n**4. 测试用例实现**\n\n- 情况1和2（行列式）：对于单个Slater行列式，$1$-RDM $\\gamma$ 是一个幂等投影算符（$\\gamma^2=\\gamma$），其迹等于$N$。$2$-RDM由Slater-Condon规则给出：$\\Gamma_{ij}^{\\,kl} = \\gamma_i^{\\,k}\\gamma_j^{\\,l} - \\gamma_i^{\\,l}\\gamma_j^{\\,k}$。我们首先将$\\gamma$构造为一个对角矩阵，其被占据轨道对应元素为1，虚轨道对应元素为0，然后构造$\\Gamma$。\n\n- 情况3（系综）：N-可表示RDM的集合是凸集。因此，N-可表示RDM的凸组合也是N-可表示的。试验$\\Gamma$被构造为对应于两个不同Slater行列式的$\\Gamma$矩阵的加权平均。\n\n- 情况4（构造）：从一个非半正定的对基矩阵$P_{\\text{pair}}$构造一个非物理的$2$-RDM。我们将$P_{\\text{pair}}$定义为只有一个负值元素，这转换成$\\Gamma_{01}^{01} = -0.1$。然后通过应用所需的反对称性和厄米性关系来系统地构造完整的$\\Gamma$张量。预计这个过程会产生一个违反N-可表示性条件的$\\Gamma$。\n\n**5. 数值验证**\n对于每个测试用例，程序将：\n1. 构造四指标张量$\\Gamma$。\n2. 通过收缩$\\Gamma$来计算$1$-RDM $\\gamma$。\n3. 构建$P$，$Q$和$G$矩阵。\n4. 计算每个矩阵的本征值。因为它们是厄米矩阵，我们使用 `scipy.linalg.eigh`。\n5. 通过验证最小本征值 $\\lambda_{\\min}$ 是否大于或等于一个容差 $-\\varepsilon$（其中 $\\varepsilon = 10^{-8}$）来检查半正定性。\n结果将以每个案例的布尔三元组 $(P, Q, G)$ 列表的形式报告。", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        {'id': 1, 'M': 4, 'N': 2, 'type': 'determinant', 'occ': [0, 1]},\n        {'id': 2, 'M': 4, 'N': 3, 'type': 'determinant', 'occ': [0, 1, 2]},\n        {'id': 3, 'M': 4, 'N': 2, 'type': 'ensemble', 'dets': [([0, 1], 0.5), ([0, 2], 0.5)]},\n        {'id': 4, 'M': 4, 'N': 2, 'type': 'contrived', 'alpha': 0.1}\n    ]\n\n    results = []\n    for spec in test_cases:\n        result_tuple = run_case(spec)\n        results.append(list(result_tuple))\n\n    # Format the output as specified in the problem statement.\n    formatted_results = [f\"[{str(r[0])},{str(r[1])},{str(r[2])}]\" for r in results]\n    final_output = f\"[{','.join(formatted_results)}]\"\n    # Python's bool `True` needs to be lowercase `true` for some platforms, but problem implies uppercase.\n    # The default string conversion is fine as per problem example `[[True,True,True]...`.\n    print(final_output)\n\ndef run_case(spec):\n    \"\"\"\n    Runs a single test case for N-representability conditions.\n    \"\"\"\n    M = spec['M']\n    N = spec['N']\n    epsilon = 1e-8\n\n    # 1. Construct the 2-RDM Gamma tensor from the specification.\n    Gamma = assemble_gamma_from_spec(spec)\n\n    # 2. Compute the 1-RDM gamma by contracting Gamma.\n    # The relation is (N-1) * gamma_i^k = sum_j Gamma_ij^kj.\n    # With tensor indices, this is (N-1)*gamma[i,k] = einsum('ijkj->ik', Gamma).\n    if N > 1:\n        gamma = np.einsum('ijkj->ik', Gamma) / (N - 1)\n    else:\n        # The contraction is ill-defined for N=1. This case is not in the test suite.\n        # For a single electron, Gamma is zero and gamma is a projector of rank 1.\n        # A robust implementation would handle this, but it's not required here.\n        gamma = np.zeros((M, M)) \n\n    # 3. Build P, Q, and G matrices.\n    pairs = list(combinations(range(M), 2))\n    num_pairs = len(pairs)\n\n    # P-matrix\n    P_mat = np.zeros((num_pairs, num_pairs))\n    for p1_idx, (i, j) in enumerate(pairs):\n        for p2_idx, (k, l) in enumerate(pairs):\n            P_mat[p1_idx, p2_idx] = Gamma[i, j, k, l]\n\n    # Q-matrix\n    Q_mat = np.zeros((num_pairs, num_pairs))\n    Id = np.eye(M)\n    for p1_idx, (i, j) in enumerate(pairs):\n        for p2_idx, (k, l) in enumerate(pairs):\n            val = Gamma[i, j, k, l]\n            val -= Id[i, k] * gamma[l, j]\n            val += Id[i, l] * gamma[k, j]\n            val += Id[j, k] * gamma[l, i]\n            val -= Id[j, l] * gamma[k, i]\n            val += Id[i, k] * Id[j, l]\n            val -= Id[i, l] * Id[j, k]\n            Q_mat[p1_idx, p2_idx] = val\n\n    # G-matrix\n    G_mat = np.zeros((M * M, M * M))\n    for i in range(M):\n        for k in range(M):\n            for j in range(M):\n                for l in range(M):\n                    idx1 = i * M + k\n                    idx2 = j * M + l\n                    val = Id[k, l] * gamma[i, j]\n                    val -= Gamma[i, l, j, k]\n                    G_mat[idx1, idx2] = val\n\n    # 4. Compute eigenvalues and check for positive semidefiniteness.\n    # eigh is used for Hermitian matrices; it is numerically stable and returns real eigenvalues.\n    eig_P = eigh(P_mat, eigvals_only=True)\n    eig_Q = eigh(Q_mat, eigvals_only=True)\n    eig_G = eigh(G_mat, eigvals_only=True)\n\n    p_ok = np.min(eig_P) >= -epsilon\n    q_ok = np.min(eig_Q) >= -epsilon\n    g_ok = np.min(eig_G) >= -epsilon\n\n    return p_ok, q_ok, g_ok\n\n\ndef assemble_gamma_from_spec(spec):\n    \"\"\"\n    Constructs the 2-RDM Gamma tensor based on the test case specification.\n    \"\"\"\n    M = spec['M']\n\n    if spec['type'] == 'determinant':\n        gamma_proj = np.zeros((M, M))\n        occ = np.array(spec['occ'])\n        gamma_proj[occ, occ] = 1.0\n        Gamma = np.einsum('ik,jl->ijkl', gamma_proj, gamma_proj) - \\\n                np.einsum('il,jk->ijkl', gamma_proj, gamma_proj)\n        return Gamma\n    \n    elif spec['type'] == 'ensemble':\n        Gamma = np.zeros((M, M, M, M))\n        for occ_list, weight in spec['dets']:\n            gamma_proj = np.zeros((M, M))\n            occ = np.array(occ_list)\n            gamma_proj[occ, occ] = 1.0\n            Gamma_det = np.einsum('ik,jl->ijkl', gamma_proj, gamma_proj) - \\\n                        np.einsum('il,jk->ijkl', gamma_proj, gamma_proj)\n            Gamma += weight * Gamma_det\n        return Gamma\n        \n    elif spec['type'] == 'contrived':\n        pairs = list(combinations(range(M), 2))\n        pair_to_idx = {p: i for i, p in enumerate(pairs)}\n        \n        P_pair = np.zeros((len(pairs), len(pairs)))\n        idx_01 = pair_to_idx.get((0, 1))\n        if idx_01 is not None:\n            P_pair[idx_01, idx_01] = -spec['alpha']\n        \n        Gamma = np.zeros((M, M, M, M))\n        # Set Gamma for i<j, k<l from P_pair, then extend by antisymmetry & hermiticity\n        for p1_idx, (i, j) in enumerate(pairs):\n             for p2_idx, (k, l) in enumerate(pairs):\n                val = P_pair[p1_idx, p2_idx]\n                if abs(val) > 1e-15:\n                    Gamma[i, j, k, l] = val\n                    Gamma[j, i, k, l] = -val\n                    Gamma[i, j, l, k] = -val\n                    Gamma[j, i, l, k] = val\n\n        Gamma_herm = np.einsum('klij->ijkl', Gamma)\n        Gamma = (Gamma + Gamma_herm) / 2.0\n        return Gamma\n        \n    return None\n\nif __name__ == '__main__':\n    # The actual execution of solve() would produce the final string answer, \n    # but the problem asks for the program itself.\n    # Expected output: [[True,True,True],[True,True,True],[True,True,True],[False,False,False]]\n    solve()\n```", "id": "2919901"}]}