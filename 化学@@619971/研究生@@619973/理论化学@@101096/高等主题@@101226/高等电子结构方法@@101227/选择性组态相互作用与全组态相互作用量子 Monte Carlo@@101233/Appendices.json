{"hands_on_practices": [{"introduction": "在深入研究选择性 CI (Selected CI) 和 FCIQMC (Full CI Quantum Monte Carlo) 的复杂算法之前，我们必须首先掌握指导其发展的基本理论原则。第一个练习 [@problem_id:2803703] 通过一个简单的、可精确求解的模型，阐明了尺寸一致性 (size consistency) 这一关键概念。通过比较截断组态相互作用方法 (truncated configuration interaction)，如 $CISD$，和完整的全组态相互作用 ($FCI$) 方法对两个无相互作用片段的处理，您将亲眼见证为何像 $CISD$ 这样的简化方法会失效，并理解为何对于精确的化学预测而言，逼近 $FCI$ 极限是如此重要。", "problem": "考虑两个相同的、无相互作用的、标记为 $A$ 和 $B$ 的闭壳层片段。每个片段都在一个由 Hartree-Fock (HF) 参考行列式 $\\lvert 0_{F} \\rangle$ 和一个双激发行列式 $\\lvert 2_{F} \\rangle$ ($F \\in \\{A,B\\}$) 张成的最小希尔伯特空间中建模。假设 Brillouin 定理成立，因此对于每个片段，单激发不与 HF 参考态耦合。在这个最小模型中，片段的哈密顿量在有序基 $\\{\\lvert 0_{F} \\rangle,\\lvert 2_{F} \\rangle\\}$ 下具有对角元 $E_{0}$ 和 $E_{2}$ 以及一个非零的非对角耦合项 $K$，能量差为 $\\Delta \\equiv E_{2}-E_{0} > 0$。使用原子单位，并且不失一般性地将能量零点移动到 $E_{0}=0$ 处，因此片段的哈密顿量由矩阵 $\\begin{pmatrix} 0 & K \\\\ K & \\Delta \\end{pmatrix}$ 表示。二聚体的总哈密顿量是可加的，$H=H_{A}\\otimes I_{B}+I_{A}\\otimes H_{B}$，并且片段之间没有相互作用。\n\n二聚体的单双激发组态相互作用 (CISD) 在此定义为在由 HF 乘积参考态 $\\lvert 0_{A}0_{B} \\rangle$ 以及相对于该参考态最多激发两个电子的所有行列式所张成的子空间中对角化 $H$。在该模型中，CISD 子空间为 $\\{\\lvert 0_{A}0_{B} \\rangle,\\lvert 2_{A}0_{B} \\rangle,\\lvert 0_{A}2_{B} \\rangle\\}$，但不包括 $\\lvert 2_{A}2_{B} \\rangle$。完全组态相互作用 (FCI) 包括所有四个乘积行列式。完全组态相互作用量子蒙特卡罗 (FCIQMC) 是一种投影量子蒙特卡罗算法，在无限采样极限下，它可以在所选的单粒子基组内给出精确的 FCI 基态能量。\n\n从以上定义和标准的多电子量子力学出发，完成以下任务：\n\n1. 对于单个片段，解析地对角化 $2 \\times 2$ 的哈密顿量，以获得其精确的基态能量 $E_{\\mathrm{mono}}(\\Delta,K)$。\n2. 对于二聚体，在基 $\\{\\lvert 0_{A}0_{B} \\rangle,\\lvert 2_{A}0_{B} \\rangle,\\lvert 0_{A}2_{B} \\rangle\\}$ 中构建并对角化 $3 \\times 3$ 的 CISD 哈密顿量，以获得 CISD 基态能量 $E_{\\mathrm{dimer}}^{\\mathrm{CISD}}(\\Delta,K)$。\n3. 使用大小一致性的定义，构建大小一致性误差 $\\delta(\\Delta,K) \\equiv E_{\\mathrm{dimer}}^{\\mathrm{CISD}}(\\Delta,K) - 2E_{\\mathrm{mono}}(\\Delta,K)$。\n4. 在不进行进一步数值对角化的情况下，论证在这种无相互作用的情况下，精确的 FCI 二聚体基态能量必须是多少，并简要解释为什么 FCIQMC 计算在精确采样的极限下会避免在步骤3中发现的病态问题。\n\n请以关于 $\\Delta$ 和 $K$ 的单个闭式解析表达式（原子单位）形式给出 $\\delta(\\Delta,K)$ 的最终答案。不要进行近似或展开；给出精确表达式。", "solution": "提出的问题需要经过验证。所有给定条件均逐字提取。\n- 片段：两个相同的、无相互作用的、闭壳层的片段 $A$ 和 $B$。\n- 片段希尔伯特空间：$\\{\\lvert 0_{F} \\rangle, \\lvert 2_{F} \\rangle\\}$，其中 $F \\in \\{A,B\\}$。\n- 片段哈密顿量 ($E_0=0$)：$H_F = \\begin{pmatrix} 0 & K \\\\ K & \\Delta \\end{pmatrix}$，其中 $\\Delta > 0$。\n- 总哈密顿量: $H=H_{A}\\otimes I_{B}+I_{A}\\otimes H_{B}$。\n- 二聚体的 CISD 子空间：$\\{\\lvert 0_{A}0_{B} \\rangle,\\lvert 2_{A}0_{B} \\rangle,\\lvert 0_{A}2_{B} \\rangle\\}$。\n- 二聚体的 FCI 子空间：$\\{\\lvert 0_{A}0_{B} \\rangle,\\lvert 2_{A}0_{B} \\rangle,\\lvert 0_{A}2_{B} \\rangle, \\lvert 2_{A}2_{B} \\rangle\\}$。\n- FCIQMC 特性：在无限采样极限下，给出精确的 FCI 基态能量。\n\n该问题具有科学依据，提法明确，且客观。这是一个理论化学中的标准教学问题，用于说明截断的组态相互作用 (CI) 方法的大小一致性失效问题。该模型虽然简化，但建立在多体量子力学的严谨数学框架之上，包括张量积空间和矩阵对角化。它不包含科学缺陷、歧义或矛盾。问题有效。解答过程如下。\n\n1. 单个片段的基态能量。\n单个片段 $F$ 的哈密顿量是一个 $2 \\times 2$ 矩阵：\n$$ H_F = \\begin{pmatrix} 0 & K \\\\ K & \\Delta \\end{pmatrix} $$\n能量本征值 $E$ 是特征方程 $\\det(H_F - E I) = 0$ 的根。\n$$ \\det \\begin{pmatrix} -E & K \\\\ K & \\Delta - E \\end{pmatrix} = 0 $$\n$$ (-E)(\\Delta - E) - K^2 = 0 $$\n$$ E^2 - \\Delta E - K^2 = 0 $$\n求解此二次方程得到 $E$：\n$$ E = \\frac{\\Delta \\pm \\sqrt{(-\\Delta)^2 - 4(1)(-K^2)}}{2} = \\frac{\\Delta \\pm \\sqrt{\\Delta^2 + 4K^2}}{2} $$\n基态能量是两个本征值中较小的一个。给定 $\\Delta > 0$ 且 $K$ 为实数耦合，则 $\\sqrt{\\Delta^2 + 4K^2} > \\Delta$。因此，基态能量为：\n$$ E_{\\mathrm{mono}}(\\Delta,K) = \\frac{\\Delta - \\sqrt{\\Delta^2 + 4K^2}}{2} $$\n\n2. 二聚体的 CISD 基态能量。\n总哈密顿量为 $H = H_A \\otimes I_B + I_A \\otimes H_B$。CISD 哈密顿矩阵在指定的截断基 $\\{\\lvert 0_A 0_B \\rangle, \\lvert 2_A 0_B \\rangle, \\lvert 0_A 2_B \\rangle \\}$ 中构建。矩阵元 $H_{ij} = \\langle \\phi_i | H | \\phi_j \\rangle$ 计算如下：\n$H_{11} = \\langle 0_A 0_B | H | 0_A 0_B \\rangle = \\langle 0_A|H_A|0_A\\rangle + \\langle 0_B|H_B|0_B\\rangle = 0 + 0 = 0$。\n$H_{22} = \\langle 2_A 0_B | H | 2_A 0_B \\rangle = \\langle 2_A|H_A|2_A\\rangle + \\langle 0_B|H_B|0_B\\rangle = \\Delta + 0 = \\Delta$。\n$H_{33} = \\langle 0_A 2_B | H | 0_A 2_B \\rangle = \\langle 0_A|H_A|0_A\\rangle + \\langle 2_B|H_B|2_B\\rangle = 0 + \\Delta = \\Delta$。\n$H_{12} = \\langle 0_A 0_B | H | 2_A 0_B \\rangle = \\langle 0_A|H_A|2_A\\rangle\\langle 0_B|0_B\\rangle = K \\cdot 1 = K$。\n$H_{13} = \\langle 0_A 0_B | H | 0_A 2_B \\rangle = \\langle 0_A|0_A\\rangle\\langle 0_B|H_B|2_B\\rangle = 1 \\cdot K = K$。\n$H_{23} = \\langle 2_A 0_B | H | 0_A 2_B \\rangle = \\langle 2_A|H_A|0_A\\rangle\\langle 0_B|2_B\\rangle + \\langle 2_A|0_A\\rangle\\langle 0_B|H_B|2_B\\rangle = K \\cdot 0 + 0 \\cdot K = 0$。\n根据厄米性，$H_{21}=K$，$H_{31}=K$ 且 $H_{32}=0$。CISD 哈密顿矩阵为：\n$$ H^{\\mathrm{CISD}} = \\begin{pmatrix} 0 & K & K \\\\ K & \\Delta & 0 \\\\ K & 0 & \\Delta \\end{pmatrix} $$\n为求本征值，解方程 $\\det(H^{\\mathrm{CISD}} - E I) = 0$：\n$$ \\det \\begin{pmatrix} -E & K & K \\\\ K & \\Delta - E & 0 \\\\ K & 0 & \\Delta - E \\end{pmatrix} = 0 $$\n$$ -E(\\Delta-E)^2 - K(K(\\Delta-E)) + K(-K(\\Delta-E)) = 0 $$\n$$ -E(\\Delta-E)^2 - 2K^2(\\Delta-E) = 0 $$\n$$ -(\\Delta-E)[E(\\Delta-E) + 2K^2] = 0 $$\n这给出一个根 $E = \\Delta$，以及二次方程 $E(\\Delta-E) + 2K^2 = 0$（即 $E^2 - \\Delta E - 2K^2 = 0$）的根。\n$$ E = \\frac{\\Delta \\pm \\sqrt{(-\\Delta)^2 - 4(1)(-2K^2)}}{2} = \\frac{\\Delta \\pm \\sqrt{\\Delta^2 + 8K^2}}{2} $$\n三个本征值为 $\\Delta$、$\\frac{\\Delta + \\sqrt{\\Delta^2 + 8K^2}}{2}$ 和 $\\frac{\\Delta - \\sqrt{\\Delta^2 + 8K^2}}{2}$。基态能量是最小值：\n$$ E_{\\mathrm{dimer}}^{\\mathrm{CISD}}(\\Delta,K) = \\frac{\\Delta - \\sqrt{\\Delta^2 + 8K^2}}{2} $$\n\n3. 大小一致性误差。\n误差定义为 $\\delta(\\Delta,K) \\equiv E_{\\mathrm{dimer}}^{\\mathrm{CISD}} - 2E_{\\mathrm{mono}}$。\n$$ \\delta(\\Delta,K) = \\left( \\frac{\\Delta - \\sqrt{\\Delta^2 + 8K^2}}{2} \\right) - 2 \\left( \\frac{\\Delta - \\sqrt{\\Delta^2 + 4K^2}}{2} \\right) $$\n$$ \\delta(\\Delta,K) = \\frac{\\Delta - \\sqrt{\\Delta^2 + 8K^2}}{2} - (\\Delta - \\sqrt{\\Delta^2 + 4K^2}) $$\n$$ \\delta(\\Delta,K) = \\frac{\\Delta - \\sqrt{\\Delta^2 + 8K^2} - 2\\Delta + 2\\sqrt{\\Delta^2 + 4K^2}}{2} $$\n$$ \\delta(\\Delta,K) = \\frac{2\\sqrt{\\Delta^2 + 4K^2} - \\sqrt{\\Delta^2 + 8K^2} - \\Delta}{2} $$\n对于 $K \\neq 0$，这个非零误差表明了截断 CISD 的大小不一致性。\n\n4. FCI 能量与 FCIQMC。\n对于由两个无相互作用的片段 $A$ 和 $B$ 组成的体系，总哈密顿量为 $H = H_A + H_B$（$H_A \\otimes I_B + I_A \\otimes H_B$ 的简写）。$H$ 的本征值是 $H_A$ 和 $H_B$ 本征值的所有可能组合之和。因此，二聚体的精确基态能量是两个片段基态能量之和。这就是大小一致性的定义，FCI 正确地再现了这一点。\n$$ E_{\\mathrm{dimer}}^{\\mathrm{FCI}} = E_{\\mathrm{mono}} + E_{\\mathrm{mono}} = 2E_{\\mathrm{mono}} = \\Delta - \\sqrt{\\Delta^2 + 4K^2} $$\nCISD 的病态问题源于对多电子基组的截断。无相互作用二聚体的真实基态是片段基态的乘积。每个片段的基态是 $\\lvert 0_F \\rangle$ 和 $\\lvert 2_F \\rangle$ 的线性组合。因此，它们的乘积包含一个 $\\lvert 2_A 2_B \\rangle$ 形式的分量，这是相对于参考态 $\\lvert 0_A 0_B \\rangle$ 的四重激发。根据定义，CISD 方法排除了具有两个以上激发的行列式，因此无法表示真实的基态波函数。FCIQMC 是一种随机投影方法，它在整个 CI 空间中进行采样。在精确采样的极限下，它收敛到精确的 FCI 基态能量。因此，FCIQMC 将得到 $E_{\\mathrm{dimer}}^{\\mathrm{FCI}} = 2E_{\\mathrm{mono}}$，从而不表现出大小一致性误差。它通过在完整、未截断（在单粒子基组内）的多电子空间中进行计算，避免了截断 CISD 的病态问题。", "answer": "$$\\boxed{\\frac{2\\sqrt{\\Delta^2 + 4K^2} - \\sqrt{\\Delta^2 + 8K^2} - \\Delta}{2}}$$", "id": "2803703"}, {"introduction": "在理解了为何需要 $FCI$ 之后，我们现在转向 $FCIQMC$ 方法的“如何实现”这一问题。这个练习 [@problem_id:2803677] 将揭开该算法核心的神秘面纱，让您亲手执行一个完整的投影步。通过为一个微小的系统手动模拟行走子 (walker) 的衍生 (spawning)、死亡/克隆 (death/cloning) 和湮灭 (annihilation) 事件，您将对驱动整个体系向基态波函数演化的随机动力学过程，以及能量是如何被估计的，获得一个具体而深入的理解。", "problem": "在一个由两个Slater行列式 $\\lvert D_{0} \\rangle$ 和 $\\lvert D_{1} \\rangle$ 构成的最小选择构型相互作用（Selected CI）子空间中，考虑全构型相互作用量子蒙特卡洛（Full CI Quantum Monte Carlo, FCIQMC）的虚时间随机投影动力学。该子空间中的有效哈密顿矩阵具有非零元 $H_{00}=-1.0$、$H_{11}=+0.5$ 以及 $H_{01}=H_{10}=+0.2$，单位均为Hartree。离散时间步长为 $\\delta \\tau = 0.1$，固定的粒子数控制偏移为 $S=-0.8$（单位均为Hartree）。\n\n在该时间步开始时，游走子分布如下：\n- 在 $\\lvert D_{0} \\rangle$ 上：$3$个正游走子和$1$个负游走子。\n- 在 $\\lvert D_{1} \\rangle$ 上：$1$个负游走子。\n\n采用标准的FCIQMC更新规则，在一个时间步内按以下规则和顺序进行：\n- 派生（Spawning）：对于行列式 $i$ 上的每个游走子，在这个双行列式模型中以概率 $p_{\\mathrm{gen}}(j \\mid i)=1$ 选择一个相连的行列式 $j$。以概率 $p_{\\mathrm{s}}(j \\leftarrow i)=\\delta \\tau \\left| H_{ji} \\right|$ 提议一次到 $j$ 的派生。如果派生发生，子代游走子的符号为 $s_{\\mathrm{child}}=-\\mathrm{sgn}(H_{ji})\\, s_{\\mathrm{parent}}$。\n- 死亡/克隆（Death/Cloning）：对于行列式 $i$ 上的每个母代游走子，以概率 $p_{\\mathrm{d}}(i)=\\delta \\tau \\left( H_{ii}-S \\right)$ 应用一个对角事件。如果 $p_{\\mathrm{d}}(i) \\ge 0$，该游走子以概率 $p_{\\mathrm{d}}(i)$ 死亡。如果 $p_{\\mathrm{d}}(i)<0$，则以概率 $-p_{\\mathrm{d}}(i)$ 创建一个克隆（具有相同的符号和行列式）。\n- 湮灭（Annihilation）：在完成对母代游走子的派生和死亡/克隆步骤后，汇总每个行列式上的所有贡献（幸存的原始游走子、派生的子代和克隆体），并通过局部抵消符号相反的游走子来进行湮灭。\n\n使用以下在 $\\left[0,1\\right)$ 区间内的独立均匀随机数来决定每个伯努利事件：\n- 从 $\\lvert D_{0} \\rangle$ 到 $\\lvert D_{1} \\rangle$ 对四个初始游走子的派生尝试，序列如下：正-a 使用 $0.4$，正-b 使用 $0.015$，正-c 使用 $0.8$，负-a 使用 $0.010$。\n- 从 $\\lvert D_{1} \\rangle$ 到 $\\lvert D_{0} \\rangle$ 对其初始游走子的派生尝试：$0.70$。\n- 在 $\\lvert D_{0} \\rangle$ 上对同样四个初始游走子的死亡/克隆事件，序列相同：$0.010$、$0.50$、$0.50$、$0.30$。\n- 在 $\\lvert D_{1} \\rangle$ 上对其初始游走子的死亡事件：$0.50$。\n\n以 $\\lvert D_{0} \\rangle$ 为参考的投影能量估计量定义为\n$$\nE_{\\mathrm{proj}} \\equiv \\frac{\\sum_{j \\in \\{0,1\\}} H_{0j} \\, N_{j}}{N_{0}},\n$$\n其中 $N_{j}$ 是湮灭后 $\\lvert D_{j} \\rangle$ 上的带符号游走子数量。计算这一个时间步内投影能量估计量的变化量，\n$$\n\\Delta E_{\\mathrm{proj}} \\equiv E_{\\mathrm{proj}}^{\\text{after}} - E_{\\mathrm{proj}}^{\\text{before}},\n$$\n并以Hartree为单位给出你的最终答案的精确值（不要四舍五入）。最终答案必须是一个单独的数字。", "solution": "该问题陈述经核实具有科学依据、提法恰当且客观。它提供了一套完整且一致的数据和规则，用于执行标准全构型相互作用量子蒙特卡洛（FCIQMC）模拟中的单个确定性步骤。该问题是理论化学原理的直接且可形式化的应用。因此，将提供解答。\n\n目标是计算在一个时间步长 $\\delta \\tau = 0.1$ 内投影能量的变化量 $\\Delta E_{\\mathrm{proj}} = E_{\\mathrm{proj}}^{\\text{after}} - E_{\\mathrm{proj}}^{\\text{before}}$。\n\n首先，我们确定初始状态并计算该步开始前的投影能量 $E_{\\mathrm{proj}}^{\\text{before}}$。\nSlater行列式 $\\lvert D_{0} \\rangle$ 和 $\\lvert D_{1} \\rangle$ 上的初始带符号游走子数量为：\n- $N_{0}^{\\text{before}} = (+1) \\times 3 + (-1) \\times 1 = 2$\n- $N_{1}^{\\text{before}} = (+1) \\times 0 + (-1) \\times 1 = -1$\n\n投影能量估计量定义为 $E_{\\mathrm{proj}} \\equiv \\frac{\\sum_{j} H_{0j} \\, N_{j}}{N_{0}}$。相关的哈密顿矩阵元是 $H_{00}=-1.0$ 和 $H_{01}=+0.2$。\n初始投影能量为：\n$$\nE_{\\mathrm{proj}}^{\\text{before}} = \\frac{H_{00} N_{0}^{\\text{before}} + H_{01} N_{1}^{\\text{before}}}{N_{0}^{\\text{before}}} = \\frac{(-1.0)(2) + (0.2)(-1)}{2} = \\frac{-2.0 - 0.2}{2} = \\frac{-2.2}{2} = -1.1\n$$\n\n接下来，我们根据指定的规则，按照派生、死亡/克隆和湮灭的顺序模拟一个时间步。\n\n派生步骤：\n从行列式 $\\lvert D_{i} \\rangle$ 到 $\\lvert D_{j} \\rangle$ 的派生以概率 $p_{\\mathrm{s}}(j \\leftarrow i) = \\delta \\tau \\left| H_{ji} \\right|$ 发生。派生出的子代游走子的符号为 $s_{\\mathrm{child}} = -\\mathrm{sgn}(H_{ji}) s_{\\mathrm{parent}}$。\n\n- 从 $\\lvert D_{0} \\rangle$ 到 $\\lvert D_{1} \\rangle$ 的派生：\n  概率为 $p_{\\mathrm{s}}(1 \\leftarrow 0) = \\delta \\tau \\left| H_{10} \\right| = (0.1) |+0.2| = 0.02$。\n  符号规则为 $s_{\\mathrm{child}} = -\\mathrm{sgn}(+0.2) s_{\\mathrm{parent}} = -s_{\\mathrm{parent}}$。\n  在 $\\lvert D_{0} \\rangle$ 上有4个母代游走子：3个正（p-a, p-b, p-c）和1个负（n-a）。我们将每个游走子与其随机数 $u$ 进行比较。\n  1. 游走子 p-a ($u=0.4$): $0.4 \\ge 0.02$。不发生派生。\n  2. 游走子 p-b ($u=0.015$): $0.015 < 0.02$。发生派生。母代为正，因此在 $\\lvert D_{1} \\rangle$ 上创建一个负的子代游走子。\n  3. 游走子 p-c ($u=0.8$): $0.8 \\ge 0.02$。不发生派生。\n  4. 游走子 n-a ($u=0.010$): $0.010 < 0.02$。发生派生。母代为负，因此在 $\\lvert D_{1} \\rangle$ 上创建一个正的子代游走子。\n  总计，从 $\\lvert D_{0} \\rangle$ 的派生在 $\\lvert D_{1} \\rangle$ 上创建了一个正游走子和一个负游走子。\n\n- 从 $\\lvert D_{1} \\rangle$ 到 $\\lvert D_{0} \\rangle$ 的派生：\n  概率为 $p_{\\mathrm{s}}(0 \\leftarrow 1) = \\delta \\tau \\left| H_{01} \\right| = (0.1) |+0.2| = 0.02$。\n  符号规则为 $s_{\\mathrm{child}} = -\\mathrm{sgn}(+0.2) s_{\\mathrm{parent}} = -s_{\\mathrm{parent}}$。\n  在 $\\lvert D_{1} \\rangle$ 上有1个负的母代游走子。\n  1. 游走子 ($u=0.70$): $0.70 \\ge 0.02$。不发生派生。\n  没有游走子派生到 $\\lvert D_{0} \\rangle$ 上。\n\n死亡/克隆步骤：\n此步骤应用于原始的母代游走子。事件概率为 $p_{\\mathrm{d}}(i) = \\delta \\tau (H_{ii} - S)$，其中 $S = -0.8$。\n\n- 在 $\\lvert D_{0} \\rangle$ 上：\n  概率为 $p_{\\mathrm{d}}(0) = (0.1) \\left( H_{00} - S \\right) = (0.1)(-1.0 - (-0.8)) = (0.1)(-0.2) = -0.02$。\n  由于 $p_{\\mathrm{d}}(0) < 0$，克隆以概率 $-p_{\\mathrm{d}}(0) = 0.02$ 发生。\n  我们将 $\\lvert D_{0} \\rangle$ 上的4个母代游走子与其随机数 $u$ 进行比较。\n  1. 游走子 p-a ($u=0.010$): $0.010 < 0.02$。创建了一个克隆。一个新的正游走子出现在 $\\lvert D_{0} \\rangle$ 上。\n  2. 游走子 p-b ($u=0.50$): $0.50 \\ge 0.02$。没有克隆。\n  3. 游走子 p-c ($u=0.50$): $0.50 \\ge 0.02$。没有克隆。\n  4. 游走子 n-a ($u=0.30$): $0.30 \\ge 0.02$。没有克隆。\n  原始的4个游走子幸存，并且一个正的克隆被添加到 $\\lvert D_{0} \\rangle$ 上。\n\n- 在 $\\lvert D_{1} \\rangle$ 上：\n  概率为 $p_{\\mathrm{d}}(1) = (0.1) \\left( H_{11} - S \\right) = (0.1)(0.5 - (-0.8)) = (0.1)(1.3) = 0.13$。\n  由于 $p_{\\mathrm{d}}(1) \\ge 0$，死亡以概率 $0.13$ 发生。\n  我们将 $\\lvert D_{1} \\rangle$ 上的1个负的母代游走子与其随机数 $u=0.50$进行比较。\n  1. 游走子 ($u=0.50$): $0.50 \\ge 0.13$。该游走子幸存。\n  $\\lvert D_{1} \\rangle$ 上的原始负游走子幸存。\n\n湮灭步骤：\n现在我们汇总每个行列式上的所有游走子（幸存者、克隆体、派生的子代），并湮灭符号相反的配对。\n\n- 在 $\\lvert D_{0} \\rangle$ 上：\n  - 原始幸存者：$3$个正，$1$个负。\n  - 派生的子代：$0$。\n  - 克隆体：$1$个正。\n  - 湮灭前总计：$(3+1)$个正，$1$个负 $= 4$个正，$1$个负。\n  - 湮灭：剩下 $4 - 1 = 3$ 个正游走子。\n  - 最终的带符号数量为 $N_{0}^{\\text{after}} = +3$。\n\n- 在 $\\lvert D_{1} \\rangle$ 上：\n  - 原始幸存者：$1$个负。\n  - 派生的子代：$1$个正，$1$个负。\n  - 克隆体：$0$。\n  - 湮灭前总计：$1$个正，$(1+1)$个负 $= 1$个正，$2$个负。\n  - 湮灭：剩下 $2 - 1 = 1$ 个负游走子。\n  - 最终的带符号数量为 $N_{1}^{\\text{after}} = -1$。\n\n最后，我们计算该步结束后的投影能量 $E_{\\mathrm{proj}}^{\\text{after}}$ 及其变化量 $\\Delta E_{\\mathrm{proj}}$。\n$$\nE_{\\mathrm{proj}}^{\\text{after}} = \\frac{H_{00} N_{0}^{\\text{after}} + H_{01} N_{1}^{\\text{after}}}{N_{0}^{\\text{after}}} = \\frac{(-1.0)(3) + (0.2)(-1)}{3} = \\frac{-3.0 - 0.2}{3} = -\\frac{3.2}{3}\n$$\n投影能量的变化量是：\n$$\n\\Delta E_{\\mathrm{proj}} = E_{\\mathrm{proj}}^{\\text{after}} - E_{\\mathrm{proj}}^{\\text{before}} = \\left(-\\frac{3.2}{3}\\right) - (-1.1) = -\\frac{3.2}{3} + \\frac{1.1}{1}\n$$\n将其表示为精确分数：\n$$\n\\Delta E_{\\mathrm{proj}} = -\\frac{32}{30} + \\frac{11}{10} = -\\frac{32}{30} + \\frac{33}{30} = \\frac{33 - 32}{30} = \\frac{1}{30}\n$$\n在这一个时间步内，投影能量估计量的变化量恰好是 $\\frac{1}{30}$ Hartree。", "answer": "$$\\boxed{\\frac{1}{30}}$$", "id": "2803677"}, {"introduction": "现代计算化学方法的威力在于它们能够高效地表示和操作复杂的量子态。最后一个练习 [@problem_id:2803686] 旨在搭建从斯莱特行列式 ($Slater~determinant$) 的抽象理论到其在高性能 $SCI$ 和 $FCIQMC$ 代码中具体实现之间的桥梁。您将推导并应用基于位运算 (bitwise operations) 的算法，以高效地确定两个行列式之间的激发等级和相对的费米子相位因子 (fermionic phase factor)，从而揭示这些方法能够处理巨大希尔伯特空间的计算引擎的奥秘。", "problem": "在选定组态相互作用 (Selected Configuration Interaction, SCI) 和完全组态相互作用量子蒙特卡洛 (Full Configuration Interaction Quantum Monte Carlo, FCIQMC) 中，Slater行列式由占据位串表示。考虑一种表示方法，其中每个自旋扇区使用两个 $64$ 位无符号整数：一个低位字编码索引为 $0$ 到 $63$ 的自旋轨道，一个高位字编码索引为 $64$ 到 $127$ 的自旋轨道。当且仅当自旋轨道 $p$ 被占据时，相应字中位置 $p$ 处的比特为 $1$。\n\n设 $\\lvert D \\rangle$ 和 $\\lvert D' \\rangle$ 是此表示法中的两个行列式，由以下十六进制字指定：\n- 对于 $\\alpha$ 自旋扇区：\n  - $\\lvert D \\rangle$：低位字 $= 0x100000000010002A$，高位字 $= 0x0000000000000000$。\n  - $\\lvert D' \\rangle$：低位字 $= 0x1000000002000122$，高位字 $= 0x0000000000000000$。\n- 对于 $\\beta$ 自旋扇区：\n  - $\\lvert D \\rangle$：低位字 $= 0x0000000000000009$，高位字 $= 0x0000000000000001$。\n  - $\\lvert D' \\rangle$：低位字 $= 0x0000000000000009$，高位字 $= 0x0000000000000001$。\n\n假设在每个自旋扇区内，自旋轨道按索引递增的标准顺序排列，并且 Slater 行列式是通过按自旋轨道索引递增的顺序应用产生算符来构建的。假设采用非相对论电子哈密顿量，因此非零的非对角矩阵元连接的是在同一自旋扇区内最多相差双激发的行列式。\n\n任务：\n1. 仅从 Slater 行列式的定义以及激发度是将 $\\lvert D \\rangle$ 变换为 $\\lvert D' \\rangle$ 所需的最小电子激发次数 $k$ 这一概念出发，推导一种能高效计算激发度 $\\nu(\\lvert D \\rangle,\\lvert D' \\rangle)$ 的算法，该算法用对双字编码的位运算来表示。你的推导必须从这些定义开始，并论证为何该算法返回 $\\nu$，且不依赖于任何未经证明的简化公式。\n\n2. 仅以费米子波函数的反对称性和二次量子化的算符代数为出发点，推导一种算法来计算同自旋双激发的费米子相位因子 $\\phi(\\lvert D \\rangle \\to \\lvert D' \\rangle) \\in \\{+1,-1\\}$。采用以下约定：当 $\\lvert D \\rangle$ 和 $\\lvert D' \\rangle$ 的 $\\alpha$ 自旋占据情况的差异在于从占据轨道指标 $\\{i_{1},i_{2}\\}$ 移除电子并在未占据轨道指标 $\\{a_{1},a_{2}\\}$ 添加电子时，该映射将递增排序的指标配对，即 $i_{1} \\to a_{1}$ 和 $i_{2} \\to a_{2}$。用指标之间占据轨道数量的奇偶性（模 $2$）来表示你的算法，并展示如何使用位掩码和跨两个 $64$ 位字的布居数统计来实现这些计数。\n\n3. 对给定的 $\\lvert D \\rangle$ 和 $\\lvert D' \\rangle$ 应用你推导的算法，并计算 $s = \\phi(\\lvert D \\rangle \\to \\lvert D' \\rangle) \\times \\nu(\\lvert D \\rangle,\\lvert D' \\rangle)$。将 $s$ 作为一个整数报告。无需四舍五入，也无需报告单位。", "solution": "该问题论述严谨，科学基础扎实，并为得出唯一解提供了充足信息。我将开始进行推导和计算。\n\n问题分为三个部分。第一，推导计算激发度 $\\nu$ 的算法。第二，推导计算费米子相位因子 $\\phi$ 的算法。第三，将这些算法应用于给定的数据。\n\n1. 激发度算法的推导\n\n激发度 $\\nu(\\lvert D \\rangle, \\lvert D' \\rangle)$ 定义为将行列式 $\\lvert D \\rangle$ 变换为行列式 $\\lvert D' \\rangle$ 所需的最小单粒子激发次数。一次单粒子激发将一个电子从一个已占据的自旋轨道 $i$ 移动到一个未占据的自旋轨道 $a$。为使变换成为可能，$\\lvert D \\rangle$ 和 $\\lvert D' \\rangle$ 之间的电子数必须守恒。\n\n设 $O$ 和 $O'$ 分别为行列式 $\\lvert D \\rangle$ 和 $\\lvert D' \\rangle$ 的占据自旋轨道指标集。要将 $\\lvert D \\rangle$ 变换为 $\\lvert D' \\rangle$，我们必须：\n- 从在 $\\lvert D \\rangle$ 中占据但在 $\\lvert D' \\rangle$ 中不占据的自旋轨道中湮灭电子。这类轨道的集合是 $O \\setminus O'$。\n- 在 $\\lvert D' \\rangle$ 中占据但在 $\\lvert D \\rangle$ 中不占据的自旋轨道中产生电子。这类轨道的集合是 $O' \\setminus O$。\n\n所需的湮灭次数为 $N_{annihilate} = |O \\setminus O'|$。所需的产生次数为 $N_{create} = |O' \\setminus O|$。由于每次激发包含一次湮灭和一次产生，且总电子数守恒（$|O|=|O'|$），我们必然有 $N_{annihilate} = N_{create}$。激发度 $\\nu$ 就是这个数值。\n$$ \\nu = |O \\setminus O'| = |O' \\setminus O| $$\n$\\lvert D \\rangle$ 和 $\\lvert D' \\rangle$ 之间占据情况不同的轨道集合是集合 $O$ 和 $O'$ 的对称差，记作 $O \\Delta O'$。\n$$ O \\Delta O' = (O \\setminus O') \\cup (O' \\setminus O) $$\n对称差的大小为 $|O \\Delta O'| = |O \\setminus O'| + |O' \\setminus O| = \\nu + \\nu = 2\\nu$。\n因此，激发度可以从对称差的大小计算得出：\n$$ \\nu = \\frac{1}{2} |O \\Delta O'| $$\n在位串表示法中，每个行列式 $\\lvert D \\rangle$ 由一系列字表示，其中如果自旋轨道 $p$ 在 $O$ 中，则比特 $p$ 为 $1$，否则为 $0$。两个指标集的对称差对应于其位串表示的按位异或（$\\oplus$）运算。设 $w_D$ 和 $w_{D'}$ 是给定自旋扇区的位串字。表示集合 $O \\Delta O'$ 的位串是 $w_D \\oplus w_{D'}$。\n\n集合 $O \\Delta O'$ 的大小 $|O \\Delta O'|$ 是异或操作后所得位串中被置位（为1）的比特数。这通过布居数统计操作 $\\text{popcount}(\\cdot)$ 计算。\n因此，单个自旋扇区 $s$ 内的激发度 $\\nu_s$ 的算法是：\n$$ \\nu_s = \\frac{1}{2} \\text{popcount}(w_{D,s} \\oplus w_{D',s}) $$\n在我们的情况下，每个自旋扇区由两个 $64$ 位字表示，一个低位字（$L$）用于索引 $0-63$，一个高位字（$U$）用于索引 $64-127$。自旋扇区 $s \\in \\{\\alpha, \\beta\\}$ 的算法是：\n$$ \\nu_s = \\frac{1}{2} \\left[ \\text{popcount}(w_{D,s,L} \\oplus w_{D',s,L}) + \\text{popcount}(w_{D,s,U} \\oplus w_{D',s,U}) \\right] $$\n总激发度是各自旋扇区激发度之和：$\\nu = \\nu_\\alpha + \\nu_\\beta$。\n\n2. 相位因子算法的推导\n\n我们被要求找出从轨道 $\\{i_1, i_2\\}$ 到 $\\{a_1, a_2\\}$ （其中 $i_1 < i_2$ 且 $a_1 < a_2$）的同自旋双激发所关联的相位因子 $\\phi$。问题指定了一个约定，即该变换是两次单激发的序列：先是 $i_1 \\to a_1$，然后是 $i_2 \\to a_2$。我们必须从第一性原理推导这个序列过程的相位。\n\n一个占据了自旋轨道 $p_1 < p_2 < \\dots < p_N$ 的 Slater 行列式定义为 $\\lvert D \\rangle = c_{p_1}^\\dagger c_{p_2}^\\dagger \\dots c_{p_N}^\\dagger \\lvert \\text{vac} \\rangle$。费米子产生算符（$c_p^\\dagger$）和湮灭算符（$c_p$）遵循反对易关系：$\\{c_p, c_q\\} = 0$，$\\{c_p^\\dagger, c_q^\\dagger\\} = 0$，以及 $\\{c_p, c_q^\\dagger\\} = \\delta_{pq}$。\n\n让我们找出单次激发 $i \\to a$ 的相位。这对应于算符 $c_a^\\dagger c_i$ 作用于 $\\lvert D \\rangle$。\n首先，应用湮灭算符 $c_i$。设 $i$ 是已占据轨道排序列表 $\\{p_1, \\dots, p_N\\}$ 中的第 $m$ 个轨道。要将 $c_i = c_{p_m}$ 从乘积 $c_{p_1}^\\dagger \\dots c_{p_N}^\\dagger$ 的左侧移动到 $c_{p_m}^\\dagger$ 的位置，它必须与前面的 $m-1$ 个算符 $c_{p_1}^\\dagger, \\dots, c_{p_{m-1}}^\\dagger$ 反对易。这会引入一个 $(-1)^{m-1}$ 的符号。\n$$ c_i \\lvert D \\rangle = (-1)^{m-1} c_{p_1}^\\dagger \\dots c_{p_{m-1}}^\\dagger (c_{p_m} c_{p_m}^\\dagger) c_{p_{m+1}}^\\dagger \\dots c_{p_N}^\\dagger \\lvert \\text{vac} \\rangle $$\n因为 $c_{p_m}$ 作用于轨道 $p_m$ 已被占据的状态，所以项 $c_{p_m}c_{p_m}^\\dagger$ 变为 $1-c_{p_m}^\\dagger c_{p_m}$，将其作用于（其中 $p_m$ 未被占据的）其余状态会得到 $1$。结果状态是 $\\lvert D_{-i} \\rangle$，即从行列式 $\\lvert D \\rangle$ 中移除了轨道 $i$。\n数字 $m-1$ 是 $\\lvert D \\rangle$ 中指标小于 $i$ 的占据轨道数量。我们将其记为 $N_D(<i)$。\n所以，$c_i \\lvert D \\rangle = (-1)^{N_D(<i)} \\lvert D_{-i} \\rangle$。\n\n接下来，将产生算符 $c_a^\\dagger$ 作用于 $\\lvert D_{-i} \\rangle$。为获得正则排序的行列式 $\\lvert D_{-i+a} \\rangle$，我们必须将 $c_a^\\dagger$ 插入到构成 $\\lvert D_{-i} \\rangle$ 的产生算符乘积中的正确排序位置。这需要将 $c_a^\\dagger$ 与所有在 $\\lvert D_{-i} \\rangle$ 中占据且指标 $p < a$ 的产生算符 $c_p^\\dagger$ 反对易。其相位为 $(-1)^{N_{D-i}(<a)}$。\n$$ c_a^\\dagger \\lvert D_{-i} \\rangle = (-1)^{N_{D-i}(<a)} \\lvert D_{-i+a} \\rangle $$\n总变换为 $c_a^\\dagger c_i \\lvert D \\rangle = (-1)^{N_D(<i) + N_{D-i}(<a)} \\lvert D_{-i+a} \\rangle$。其指数决定了相位。\n$N_{D-i}(<a) = N_D(<a) - \\mathbb{I}(i < a)$，其中 $\\mathbb{I}$ 是指示函数。相位指数为 $P(i,a) = N_D(<i) + N_D(<a) - \\mathbb{I}(i < a)$。这等价于在 $i$ 和 $a$ 严格之间（即不含端点）的占据轨道数量的奇偶性。我们将其记为 $\\pi_D(i,a)$。$i \\to a$ 的相位因子是 $(-1)^{\\pi_D(i,a)}$。\n\n遵循问题中对双激发的约定：\n步骤1：对 $\\lvert D \\rangle$ 应用激发 $i_1 \\to a_1$。\n状态变为 $\\lvert D_{int} \\rangle$，并累积一个相位因子 $\\phi_1 = (-1)^{\\pi_D(i_1, a_1)}$。$\\lvert D_{int} \\rangle$ 的占据集为 $O_{int} = (O_D \\setminus \\{i_1\\}) \\cup \\{a_1\\}$。\n\n步骤2：对 $\\lvert D_{int} \\rangle$ 应用激发 $i_2 \\to a_2$。\n最终状态为 $\\lvert D' \\rangle$，并累积一个相位因子 $\\phi_2 = (-1)^{\\pi_{D_{int}}(i_2, a_2)}$。\n总相位因子为 $\\phi = \\phi_1 \\phi_2 = (-1)^{\\pi_D(i_1, a_1) + \\pi_{D_{int}}(i_2, a_2)}$。\n\n项 $\\pi_{D_{int}}(i_2, a_2)$ 是 $D_{int}$ 中 $i_2$ 和 $a_2$ 之间的占据轨道的奇偶性。这可以与 $D$ 中的占据情况关联起来：\n$$ \\pi_{D_{int}}(i_2, a_2) = \\pi_D(i_2, a_2) - I(i_2, a_2, i_1) + I(i_2, a_2, a_1) $$\n其中，如果 $z$ 严格位于 $x$ 和 $y$ 之间，则 $I(x,y,z)$ 为 $1$，否则为 $0$。\n相位因子 $\\phi = (-1)^P$ 的最终指数为：\n$$ P = \\left( \\pi_D(i_1, a_1) + \\pi_D(i_2, a_2) - I(i_2, a_2, i_1) + I(i_2, a_2, a_1) \\right) \\pmod 2 $$\n要计算 $\\pi_D(p,q)$，即 $p$ 和 $q$ 之间占据轨道的奇偶性，我们使用位运算。设 $p_{min} = \\min(p,q)$ 和 $p_{max} = \\max(p,q)$。我们需要计算 $\\lvert D \\rangle$ 的位串表示中，索引在范围 $[p_{min}+1, p_{max}-1]$ 内的置位比特数。这可以通过为该范围创建一个位掩码，与行列式的字进行按位与操作，然后对结果进行布居数统计来完成。对于 $64$ 位字内的范围 $[p_1, p_2]$，掩码是 `((1ULL << (p2-p1+1)) - 1) << p1`。该方法可以扩展以处理跨越双字边界的范围。\n\n3. 应用与计算\n\n给定的行列式由十六进制字指定。\n对于 $\\lvert D \\rangle$：\n$w_{D,\\alpha,L} = 0x100000000010002A$, $w_{D,\\alpha,U} = 0x0$。\n$w_{D,\\beta,L} = 0x9$, $w_{D,\\beta,U} = 0x1$。\n\n对于 $\\lvert D' \\rangle$：\n$w_{D',\\alpha,L} = 0x1000000002000122$, $w_{D',\\alpha,U} = 0x0$。\n$w_{D',\\beta,L} = 0x9$, $w_{D',\\beta,U} = 0x1$。\n\n首先，计算激发度 $\\nu$。\n$\\beta$ 自旋的字对于 $\\lvert D \\rangle$ 和 $\\lvert D' \\rangle$ 是相同的，所以 $\\nu_\\beta = 0$。\n对于 $\\alpha$ 自旋扇区，我们计算低位字的异或（高位字均为 $0$）：\n$$ w_{D,\\alpha,L} \\oplus w_{D',\\alpha,L} = 0x100000000010002A \\oplus 0x1000000002000122 = 0x0000000002100108 $$\n我们计算该结果的布居数：\n$$ \\text{popcount}(0x02100108) = \\text{popcount}(2) + \\text{popcount}(1) + \\text{popcount}(1) + \\text{popcount}(8) = 1+1+1+1 = 4 $$\n激发度为 $\\nu = \\nu_\\alpha = \\frac{1}{2} \\times 4 = 2$。\n这证实了这是一个在 $\\alpha$ 自旋扇区内的双激发。\n\n接下来，计算相位因子 $\\phi$。我们必须确定被湮灭的轨道 $\\{i_1, i_2\\}$ 和被产生的轨道 $\\{a_1, a_2\\}$。它们对应于被翻转的 $4$ 个比特，也就是异或结果 $0x02100108$ 中的置位比特。\n置位比特位于对应于 $2$ 的幂的索引处：\n$0x0...8 = 2^3 \\implies$ 比特 $3$。\n$0x0...100 = 16^2 = 2^8 \\implies$ 比特 $8$。\n$0x...100000 = 16^5 = 2^{20} \\implies$ 比特 $20$。\n$0x...2000000 = 2 \\times 16^6 = 2 \\times 2^{24} = 2^{25} \\implies$ 比特 $25$。\n被翻转的轨道指标集合是 $\\{3, 8, 20, 25\\}$。\n\n为了确定哪些被湮灭，哪些被产生，我们检查它们在 $\\lvert D \\rangle$ 中的占据情况。根据 $w_{D,\\alpha,L} = 0x100000000010002A$，$\\lvert D \\rangle$ 中被占据的 $\\alpha$ 自旋轨道为 $O_\\alpha(D) = \\{1, 3, 5, 20, 44, 60\\}$。\n- 被湮灭的轨道（在 $O_\\alpha(D)$ 中且在 $\\{3, 8, 20, 25\\}$ 中）：$\\{3, 20\\}$。\n- 被产生的轨道（不在 $O_\\alpha(D)$ 中且在 $\\{3, 8, 20, 25\\}$ 中）：$\\{8, 25\\}$。\n排序后，它们是 $i_1=3, i_2=20$ 和 $a_1=8, a_2=25$。\n指定的映射是 $i_1 \\to a_1$ 和 $i_2 \\to a_2$，因此我们有变换 $3 \\to 8$ 和 $20 \\to 25$。\n\n现在我们计算相位指数 $P$ 模 $2$：\n$P = \\pi_D(3, 8) + \\pi_D(20, 25) - I(20, 25, 3) + I(20, 25, 8)$。\n- $\\pi_D(3, 8)$：在 $O_\\alpha(D) = \\{1, 3, 5, 20, 44, 60\\}$ 中，索引 $3$ 和 $8$ 之间的占据轨道的奇偶性。区间 $(3,8)$ 只包含一个占据轨道 $\\{5\\}$。所以 $\\pi_D(3,8) = 1$。\n- $\\pi_D(20, 25)$：在 $O_\\alpha(D)$ 中，索引 $20$ 和 $25$ 之间的占据轨道的奇偶性。区间 $(20,25)$ 不包含占据轨道。所以 $\\pi_D(20,25) = 0$。\n- $I(20, 25, 3)$：$3$ 是否在 $20$ 和 $25$ 之间？否。$I=0$。\n- $I(20, 25, 8)$：$8$ 是否在 $20$ 和 $25$ 之间？否。$I=0$。\n总指数为 $P = (1 + 0 - 0 + 0) \\pmod 2 = 1$。\n相位因子为 $\\phi = (-1)^P = (-1)^1 = -1$。\n\n最后，我们计算所要求的值 $s = \\phi \\times \\nu$。\n$s = (-1) \\times 2 = -2$。", "answer": "$$\\boxed{-2}$$", "id": "2803686"}]}