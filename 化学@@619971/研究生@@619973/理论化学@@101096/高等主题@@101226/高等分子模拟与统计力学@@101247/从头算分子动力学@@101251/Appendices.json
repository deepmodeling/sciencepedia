{"hands_on_practices": [{"introduction": "理论的理解最终要落实到实践的参数选择上。在从头算分子动力学中，最基本也是最关键的参数之一就是积分时间步长 $\\Delta t$。这个练习将引导你通过一个基本计算来掌握选择 $\\Delta t$ 的核心原则，即它必须能够解析系统中速度最快的运动模式。你将亲手计算并比较 Born-Oppenheimer 分子动力学 (BOMD) 和 Car-Parrinello 分子动力学 (CPMD) 在面对一个典型高频振动（如 O–H 伸缩振动）时，如何根据各自的限制条件确定合理的时间步长 [@problem_id:2759558]。", "problem": "一个双原子分子的最高物理振动波数为 $3600\\,\\text{cm}^{-1}$，这是 O–H 伸缩振动的特征。您需要比较两种从头算分子动力学方案：Born–Oppenheimer 分子动力学 (BOMD) 和 Car–Parrinello 分子动力学 (CPMD)。在 BOMD 中，原子核的运动通过标准的辛算法（例如，速度–Verlet 算法）进行积分，其稳定性和准确性由最快的物理振动模式决定。在 CPMD 中，电子自由度以一个虚拟质量进行传播，这导致一个最高的虚拟电子振荡，其角频率被给定为 $3600\\,\\text{cm}^{-1}$ 模式的十倍。\n\n从最快模式的谐振子图像出发，假设数值稳定性和可接受的能量守恒要求每个周期至少用二十个步长来解析最快的振荡。使用波数和频率之间的关系 $\\nu = c\\,\\tilde{\\nu}$（其中 $c = 2.99792458\\times 10^{10}\\,\\text{cm}\\,\\text{s}^{-1}$）以及周期 $T = 1/\\nu$。对于 CPMD，应用高十倍的虚拟频率来确定其相应的约束条件。\n\n在这些假设下，计算合理的时间步长 $\\Delta t_{\\text{BOMD}}$ 和 $\\Delta t_{\\text{CPMD}}$。将两个时间步长都以飞秒 (fs) 表示，并以有序对 $\\big(\\Delta t_{\\text{BOMD}}, \\Delta t_{\\text{CPMD}}\\big)$ 的形式报告您的最终结果。将您的答案四舍五入至三位有效数字。", "solution": "本问题要求基于两种*从头算*分子动力学方法——Born-Oppenheimer 分子动力学 (BOMD) 和 Car-Parrinello 分子动力学 (CPMD)——中各自系统内最快振荡的稳定性判据，计算出合适的数值积分时间步长。问题陈述在科学上是合理的，并为得出唯一解提供了所有必要信息。\n\n首先，我们分析 Born-Oppenheimer 分子动力学 (BOMD) 的情况。在 BOMD 中，每个时间步长都会针对静态的原子核构型求解电子结构。然后，原子核的动力学在由此得到的势能面上进行传播。数值积分器（如速度-Verlet算法）的稳定性受到原子核最快物理运动的制约。问题中指出这是一个振动模式，其波数为 $\\tilde{\\nu}_{\\text{phys}} = 3600\\,\\text{cm}^{-1}$。\n\n波数 $\\tilde{\\nu}$ (单位 $\\text{cm}^{-1}$)、频率 $\\nu$ (单位 $\\text{s}^{-1}$) 和光速 $c$ 之间的关系由 $\\nu = c\\tilde{\\nu}$ 给出。此振荡的周期 $T$ 是频率的倒数，即 $T = 1/\\nu$。因此，最快物理振动的周期 $T_{\\text{phys}}$ 为：\n$$T_{\\text{phys}} = \\frac{1}{\\nu_{\\text{phys}}} = \\frac{1}{c\\tilde{\\nu}_{\\text{phys}}}$$\n问题指出，为了保证数值稳定性，这个最快的振荡必须在每个周期内至少用 $N_{\\text{steps}} = 20$ 个步长来解析。因此，一个合理的最大时间步长 $\\Delta t_{\\text{BOMD}}$ 由此条件确定：\n$$\\Delta t_{\\text{BOMD}} = \\frac{T_{\\text{phys}}}{N_{\\text{steps}}} = \\frac{1}{N_{\\text{steps}} c \\tilde{\\nu}_{\\text{phys}}}$$\n代入给定值 $\\tilde{\\nu}_{\\text{phys}} = 3600\\,\\text{cm}^{-1}$，$c = 2.99792458\\times 10^{10}\\,\\text{cm}\\,\\text{s}^{-1}$，以及 $N_{\\text{steps}} = 20$：\n$$\\Delta t_{\\text{BOMD}} = \\frac{1}{20 \\times (2.99792458\\times 10^{10}\\,\\text{cm}\\,\\text{s}^{-1}) \\times (3600\\,\\text{cm}^{-1})}$$\n$$\\Delta t_{\\text{BOMD}} = \\frac{1}{2.1585056976 \\times 10^{15}\\,\\text{s}^{-1}} \\approx 4.63283 \\times 10^{-16}\\,\\text{s}$$\n为了以飞秒表示（其中 $1\\,\\text{fs} = 10^{-15}\\,\\text{s}$），我们乘以 $10^{15}$：\n$$\\Delta t_{\\text{BOMD}} \\approx 0.463283\\,\\text{fs}$$\n\n接下来，我们分析 Car-Parrinello 分子动力学 (CPMD) 的情况。在 CPMD 中，原子核和电子轨道（由系数表示）都使用一个扩展拉格朗日量同时进行传播。电子自由度被赋予一个虚拟质量，这导致了虚拟的电子振荡。CPMD 的稳定性受限于该耦合系统中的最高频率，这通常是虚拟电子频率。\n\n问题明确指出，最高的虚拟电子角频率 $\\omega_{\\text{fict}}$ 是 $3600\\,\\text{cm}^{-1}$ 物理模式角频率 $\\omega_{\\text{phys}}$ 的十倍。角频率 $\\omega$ 通过 $\\omega = 2\\pi\\nu$ 与频率 $\\nu$ 相关。因此：\n$$\\omega_{\\text{fict}} = 10 \\cdot \\omega_{\\text{phys}} = 10 \\cdot (2\\pi \\nu_{\\text{phys}})$$\n虚拟振荡的周期 $T_{\\text{fict}}$ 由 $T_{\\text{fict}} = 2\\pi/\\omega_{\\text{fict}}$ 给出。代入 $\\omega_{\\text{fict}}$ 的表达式：\n$$T_{\\text{fict}} = \\frac{2\\pi}{10 \\cdot (2\\pi \\nu_{\\text{phys}})} = \\frac{1}{10 \\cdot \\nu_{\\text{phys}}}$$\n由于物理周期为 $T_{\\text{phys}} = 1/\\nu_{\\text{phys}}$，我们发现两个周期之间存在直接关系：\n$$T_{\\text{fict}} = \\frac{T_{\\text{phys}}}{10}$$\nCPMD 的时间步长 $\\Delta t_{\\text{CPMD}}$ 受这个快得多的虚拟振荡的制约。应用每个周期 $N_{\\text{steps}} = 20$ 个步长的相同稳定性判据：\n$$\\Delta t_{\\text{CPMD}} = \\frac{T_{\\text{fict}}}{N_{\\text{steps}}} = \\frac{T_{\\text{phys}}/10}{N_{\\text{steps}}} = \\frac{T_{\\text{phys}}}{200}$$\n这表明，在这些条件下，CPMD 的时间步长是 BOMD 时间步长的十分之一：\n$$\\Delta t_{\\text{CPMD}} = \\frac{\\Delta t_{\\text{BOMD}}}{10}$$\n使用先前计算的 $\\Delta t_{\\text{BOMD}}$ 的值：\n$$\\Delta t_{\\text{CPMD}} \\approx \\frac{0.463283\\,\\text{fs}}{10} = 0.0463283\\,\\text{fs}$$\n\n最后，我们按要求将两个结果四舍五入到三位有效数字。\n$$\\Delta t_{\\text{BOMD}} \\approx 0.463\\,\\text{fs}$$\n$$\\Delta t_{\\text{CPMD}} \\approx 0.0463\\,\\text{fs}$$\n最终答案是有序对 $\\left(\\Delta t_{\\text{BOMD}}, \\Delta t_{\\text{CPMD}}\\right)$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.463 & 0.0463\n\\end{pmatrix}\n}\n$$", "id": "2759558"}, {"introduction": "成功运行模拟只是工作的一半，对结果的严谨分析同样至关重要。特别是在 CPMD 中，我们必须警惕虚构的电子动力学对真实核运动的干扰。这个练习聚焦于模拟后处理的一个关键技能：通过功率谱分析来识别非物理的共振信号 [@problem_id:2448284]。你将学习如何处理速度自相关函数的傅里叶变换，并从中辨别出由虚构电子频率混叠 (aliasing) 效应所导致的虚假峰，这是确保 CPMD 模拟结果可靠性的必要步骤。", "problem": "考虑一个来自从头算分子动力学 (AIMD) 轨迹的一维核速度信号，该轨迹使用 Car–Parrinello 分子动力学 (CP-MD) 方案，其中电子自由度通过一个虚拟质量进行传播。设测量得到的速度是一个离散时间实信号 $v_n = v(t_n)$，它在时间点 $t_n = n\\,\\Delta t$ (对于 $n \\in \\{0,1,\\dots,N-1\\}$) 上均匀采样，采样间隔 $\\Delta t$ 以 fs 为单位。采样频率为 $f_s = 1/\\Delta t$，单位为 Hz，奈奎斯特频率为 $f_s/2$。频率将以太赫兹 (THz) 为单位报告，其中 $1\\,\\mathrm{THz} = 10^{12}\\,\\mathrm{Hz}$。单边离散功率谱定义为 $P_k = \\lvert V_k \\rvert^2$，其中 $V_k$ 是 $v_n$ 的离散傅里叶变换，在单边频率网格 $f_k = k\\,f_s/N$ (对于 $k \\in \\{0,1,\\dots,\\lfloor N/2 \\rfloor\\}$) 上求值。如果功率谱在折叠电子频率 $f_\\mathrm{alias}$ 周围半宽为 $\\delta$ 的容差窗口内出现一个峰，则认为在频率 $f_\\mathrm{e}$ 处存在一个赝 Car–Parrinello 电子共振。折叠电子频率 $f_\\mathrm{alias}$ 是通过将 $f_\\mathrm{e}$ 折叠到奈奎斯特频带内得到的，其计算公式如下：$$f_\\mathrm{alias} = \\begin{cases} f_\\mathrm{mod}, & 0 \\le f_\\mathrm{mod} \\le \\dfrac{f_s}{2}, \\\\ f_s - f_\\mathrm{mod}, & \\dfrac{f_s}{2} < f_\\mathrm{mod} < f_s, \\end{cases} \\quad \\text{其中} \\quad f_\\mathrm{mod} = f_\\mathrm{e} \\bmod f_s.$$ 在实践中，只有功率至少为全局最大功率的相对分数 $\\alpha$ 的局域极大值才被视为峰。输入中的所有频率都以 THz 为单位给出并处理，所有时间步长以 fs 为单位，所有速度振幅以 m/s 为单位。为每个测试案例构建合成速度信号，该信号为零相位的余弦分量之和：$$v(t) = \\sum_{i=1}^{M} A_i \\cos\\big(2\\pi f_i t\\big) + A_\\mathrm{e}\\cos\\big(2\\pi f_\\mathrm{e} t\\big),$$ 其中 $f_i$ 是核振动频率（单位 THz），振幅为 $A_i$（单位 m/s），$f_\\mathrm{e}$ 是虚拟电子频率（单位 THz），$A_\\mathrm{e}$ 是泄漏振幅（单位 m/s），用于模拟赝电子与核速度的耦合。使用以 ps 为单位的 $t$，以使余弦函数的参数无量纲；等效地，对于以 fs 为单位的采样步长 $\\Delta t_\\mathrm{fs}$，采样时间为 $t_n = n\\,\\Delta t_\\mathrm{fs}\\times 10^{-3}$ ps。识别所有其频率 $f_\\text{peak}$ 满足 $\\lvert f_\\text{peak} - f_\\mathrm{alias}\\rvert \\le \\delta$ 的赝峰，仅关注满足 $P_k \\ge \\alpha \\max_j P_j$ 的局域极大值，并忽略 $k=0$ 处的直流分量。所有报告的频率均以 THz 为单位，并四舍五入到三位小数。\n\n测试套件。对于以下每个案例，根据所述参数生成 $v_n$ 并检测如上定义的赝共振峰。所有案例的相对阈值均为 $\\alpha = 10^{-3}$。按每个案例指定使用以 THz 为单位的容差 $\\delta$。\n\n- 案例 A (理想情况，带内电子共振)：$N = 4096$，$\\Delta t = 1.0$ fs，核模式 $\\{(f_1,A_1),(f_2,A_2)\\} = \\{(30.0,300.0),(60.0,200.0)\\}$，虚拟电子频率 $f_\\mathrm{e} = 480.0$ THz，泄漏振幅 $A_\\mathrm{e} = 20.0$ m/s，容差 $\\delta = 5.0$ THz。\n- 案例 B (无赝分量，带外电子频率)：$N = 4096$，$\\Delta t = 1.0$ fs，核模式 $\\{(20.0,300.0),(45.0,200.0),(90.0,100.0)\\}$，虚拟电子频率 $f_\\mathrm{e} = 700.0$ THz，泄漏振幅 $A_\\mathrm{e} = 0.0$ m/s，容差 $\\delta = 5.0$ THz。\n- 案例 C (混叠边缘情况与重叠)：$N = 4096$，$\\Delta t = 1.25$ fs，核模式 $\\{(80.0,250.0),(160.0,150.0)\\}$，虚拟电子频率 $f_\\mathrm{e} = 720.0$ THz，泄漏振幅 $A_\\mathrm{e} = 15.0$ m/s，容差 $\\delta = 5.0$ THz。\n\n您的程序必须输出一行内容，包含三个案例的结果，结果为逗号分隔的列表，并用方括号括起来。每个案例的结果必须是一个列表（用方括号括起），包含检测到的赝峰频率（单位 THz），四舍五入到三位小数并按升序排列。例如，总输出格式必须为 “[[fA1,fA2],[fB1,fB2,fB3],[fC1]]”，其中每个 $f$ 是一个 THz 单位的、小数点后有三位的小数。如果在某个案例中未检测到赝峰，则输出空列表 “[]”。所有频率必须以 THz 为单位，四舍五入到三位小数，本问题不使用角度。", "solution": "该问题陈述已经过验证，被认为是自洽的、有科学依据且定义明确的。它提出了分子动力学轨迹分析中的一个标准任务：检测由模拟方法产生的谱伪影。我们着手构建解决方案。\n\n该方法包括四个不同的步骤：($1$) 基于所提供的连续模型合成离散速度信号，($2$) 使用离散傅里叶变换 (DFT) 计算单边功率谱，($3$) 识别谱中的显著峰，以及 ($4$) 过滤这些峰以分离出赝电子共振。\n\n**1. 信号合成**\n合成速度信号 $v(t)$ 是代表核振动和一个赝电子分量的余弦函数的叠加：\n$$v(t) = \\sum_{i=1}^{M} A_i \\cos\\big(2\\pi f_i t\\big) + A_\\mathrm{e}\\cos\\big(2\\pi f_\\mathrm{e} t\\big)$$\n问题指定频率 $f_i$ 和 $f_\\mathrm{e}$ 以太赫兹 (THz) 为单位给出，时间 $t$ 以皮秒 (ps) 为单位。这在量纲上是一致的，因为 $1\\,\\mathrm{THz} = 1\\,\\mathrm{ps}^{-1}$，使得参数 $2\\pi f t$ 无量纲。离散信号 $v_n$ 是通过在均匀时间间隔 $t_n = n\\,\\Delta t$ 上对 $v(t)$ 进行采样获得的，其中 $\\Delta t$ 是采样间隔。以皮秒为单位的采样时间由给定的以飞秒为单位的 $\\Delta t_\\text{fs}$ 计算得出，即 $t_n = n \\cdot (\\Delta t_\\text{fs} \\times 10^{-3})$，其中 $n \\in \\{0, 1, \\dots, N-1\\}$。\n\n**2. 谱分析**\n需要离散信号 $v_n$ 的功率谱来识别其组成成分的频率。我们计算单边离散傅里叶变换 (DFT)，这对实值信号很高效，可产生复系数 $V_k$。然后，单边功率谱由 $P_k = \\lvert V_k \\rvert^2$ 给出。\n每个谱点 $k$ 对应的频率由采样率 $f_s$ 和总样本数 $N$ 决定。以 THz 为单位的采样频率与以 fs 为单位的采样间隔的关系为 $f_s[\\mathrm{THz}] = 1000 / \\Delta t_\\text{fs}$。单边谱的频率网格则为：\n$$f_k = k \\frac{f_s}{N}, \\quad \\text{对于 } k \\in \\{0, 1, \\dots, \\lfloor N/2 \\rfloor\\}$$\n此计算使用 `numpy.fft.rfft` 函数进行变换，并使用 `numpy.fft.rfftfreq` 函数获取频率网格。\n\n**3. 峰检测算法**\n一个具有物理意义的峰必须满足两个条件。首先，其功率相对于最强信号分量必须是显著的。其次，它必须代表谱中的一个局域极大值。问题将这些条件定义为：\n- **相对功率阈值**：频率为 $f_k$ 的峰必须具有功率 $P_k \\ge \\alpha \\max_j P_j$，其中 $\\max_j P_j$ 是全局最大功率，$\\alpha$ 是给定的相对阈值。在确定最大功率和搜索峰时，明确忽略 $k=0$ 处的直流 (DC) 分量。\n- **局域极大性**：如果点 $P_k$ 的功率大于其直接相邻点的功率：$P_k > P_{k-1}$ 和 $P_k > P_{k+1}$，则该点为局域极大值。\n我们的算法遍历功率谱的索引 $k \\in \\{1, \\dots, \\lfloor N/2 \\rfloor - 1\\}$，并识别所有满足这两个标准的频率 $f_k$。\n\n**4. 赝共振识别**\n高于奈奎斯特频率 ($f_s/2$) 的虚拟电子频率 $f_\\mathrm{e}$ 将会发生混叠，映射到主频带 $[0, f_s/2]$ 内的一个较低频率。问题为此混叠提供了正确的公式，我们称之为折叠频率 $f_\\mathrm{alias}$：\n$$f_\\mathrm{alias} = \\begin{cases} f_\\mathrm{mod}, & 0 \\le f_\\mathrm{mod} \\le \\dfrac{f_s}{2}, \\\\ f_s - f_\\mathrm{mod}, & \\dfrac{f_s}{2} < f_\\mathrm{mod} < f_s, \\end{cases}$$\n其中 $f_\\mathrm{mod} = f_\\mathrm{e} \\pmod{f_s}$。\n\n如果一个检测到的频率为 $f_\\text{peak}$ 的峰位于围绕此折叠电子频率的半宽为 $\\delta$ 的容差窗口内，则将其归类为赝 Car-Parrinello 共振。条件是：\n$$\\lvert f_\\text{peak} - f_\\mathrm{alias}\\rvert \\le \\delta$$\n收集所有满足此条件的峰的频率，按升序排序，并为每个测试案例报告。\n\n该实现将这整个过程封装在一个函数中，并应用于每个指定的测试案例。", "answer": "```\n[[479.980],[],[80.078]]\n```", "id": "2448284"}]}