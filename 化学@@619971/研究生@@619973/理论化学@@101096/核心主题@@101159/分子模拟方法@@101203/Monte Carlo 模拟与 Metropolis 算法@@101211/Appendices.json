{"hands_on_practices": [{"introduction": "在优化蒙特卡洛模拟之前，我们必须首先确保其正确性。这第一个练习涉及在使用周期性边界条件（Periodic Boundary Conditions, PBC）进行模拟时的一个基本问题：确定试探性移动的最大允许位移。通过推导在保证相互作用始终与最近周期性镜像计算的前提下的最大步长，您将对算法、粒子相互作用范围和模拟盒子几何形状之间的相互作用有一个具体的理解。[@problem_id:2788157]", "problem": "一个由相同粒子组成的均匀经典流体，在边长为 $L$ 的三维立方体盒子中，采用周期性边界条件（PBC），通过Metropolis蒙特卡罗（MMC）算法进行模拟。对相互作用是有限程的，系统采用半径为 $r_{c}$ 的球形截断，并结合最小镜像约定（MIC）。MIC通过将分离矢量的每个笛卡尔分量包裹到区间 $\\left(-\\frac{L}{2}, \\frac{L}{2}\\right]$ 内来定义对间距。数密度为 $\\rho$，粒子总数为 $N$，盒子边长满足数密度的定义 $\\,\\rho = \\frac{N}{L^{3}}\\,$。截断半径满足 $\\,r_{c} < \\frac{L}{2}\\,$，以确保MIC的明确性。\n\n对于一个随机选择的单个粒子，MMC的试探移动包括加上一个随机位移矢量 $\\boldsymbol{\\Delta}$，其模长受可调参数 $\\delta_{\\max}$ 的限制，即 $|\\boldsymbol{\\Delta}| \\le \\delta_{\\max}$。为确保在评估单粒子试探移动的能量变化时，永远不需要考虑超出最近周期性镜像的对相互作用，您采用以下平移不变方案：在为所选粒子提议位移之前，将所有粒子的位置平移一个公共矢量（这在PBC下是允许的），使得所选粒子恰好位于主模拟单元的几何中心。然后，您应用位移 $\\boldsymbol{\\Delta}$，并根据需要将坐标包裹回主单元内。\n\n在此方案下，仅使用上述基本定义，确定最大的位移模长 $\\delta_{\\max}$，使得在任何单粒子试探移动后，以试探位置为中心、半径为 $r_{c}$ 的整个相互作用球都保证位于MIC唯一选择中心镜像的区域内（因此，根据构造，永远不需要考虑与非最近镜像之间超出截断距离的相互作用）。将您的答案表示为用 $N$、$\\rho$ 和 $r_{c}$ 表示的闭式解析表达式。最终答案必须是单个解析表达式。不需要四舍五入，也未提供或需要任何数值。", "solution": "问题陈述已经过严格验证，被认为是科学上成立、定义明确、客观且内部一致的。它提出了一个在理论化学和计算物理领域内可解的问题。我们将开始推导。\n\n系统是一个边长为 $L$、采用周期性边界条件（PBC）的立方体模拟盒子。坐标定义在主模拟单元内，我们将其视为以原点为中心、顶点位于 $(\\pm \\frac{L}{2}, \\pm \\frac{L}{2}, \\pm \\frac{L}{2})$ 的立方体 $C$。因此，该单元内的任何位置矢量 $\\mathbf{r} = (x, y, z)$ 的分量都满足 $-\\frac{L}{2} < x \\le \\frac{L}{2}$，对于 $y$ 和 $z$ 也是如此。\n\n问题描述了Metropolis蒙特卡罗（MMC）试探移动的一个特定方案。对于一个随机选择的粒子（比如粒子 $i$），系统中所有粒子的位置都通过一个公共矢量进行平移，使得粒子 $i$ 被重新定位到主单元的几何中心，即原点 $\\mathbf{0} = (0, 0, 0)$。然后，一个随机位移矢量 $\\boldsymbol{\\Delta}$ 被加到粒子 $i$ 的位置上，得到其新的试探位置 $\\mathbf{r}_{i}^{\\text{new}} = \\boldsymbol{\\Delta}$。位移的模长受限于 $|\\boldsymbol{\\Delta}| \\le \\delta_{\\max}$。\n\n核心要求是找到 $\\delta_{\\max}$ 的最大值，以保证“以试探位置为中心、半径为 $r_{c}$ 的整个相互作用球都保证位于MIC唯一选择中心镜像的区域内”。“MIC唯一选择中心镜像的区域”指的是主模拟单元 $C$ 本身。对于该单元内的任何位置矢量 $\\mathbf{p}$，最小镜像约定（MIC）返回 $\\mathbf{p}$ 作为其自身的最近镜像矢量。如果相互作用球的任何部分位于主单元之外，就需要考虑与那些中心镜像靠近盒子对面的粒子的距离，而这正是该方案旨在避免的情况。\n\n因此，条件是，以新试探位置 $\\mathbf{r}_{i}^{\\text{new}} = \\boldsymbol{\\Delta}$ 为中心、半径为 $r_c$ 的球体必须完全包含在主单元 $C = [-\\frac{L}{2}, \\frac{L}{2}]^3$ 内。\n\n设试探位置为 $\\mathbf{r}_{i}^{\\text{new}} = \\boldsymbol{\\Delta} = (\\Delta_x, \\Delta_y, \\Delta_z)$。一个半径为 $r_c$ 的球体 $S$ 以此点为中心。为使该球体包含在由 $-\\frac{L}{2} \\le x,y,z \\le \\frac{L}{2}$ 定义的立方体内，该球体在每个笛卡尔方向上的最大和最小范围都必须落在此区间内。\n\n考虑 $x$ 分量。球体沿 $x$ 轴的范围是从 $\\Delta_x - r_c$ 到 $\\Delta_x + r_c$。我们必须满足以下两个不等式：\n$$\n\\Delta_x + r_c \\le \\frac{L}{2}\n$$\n$$\n\\Delta_x - r_c \\ge -\\frac{L}{2}\n$$\n这两个不等式可以合并为关于分量 $\\Delta_x$ 绝对值的单个条件：\n$$\n|\\Delta_x| \\le \\frac{L}{2} - r_c\n$$\n这个条件必须对所有三个笛卡尔分量都成立，因此我们要求对于 $\\alpha \\in \\{x, y, z\\}$，有 $|\\Delta_\\alpha| \\le \\frac{L}{2} - r_c$。\n\n对于*任何*满足 $|\\boldsymbol{\\Delta}| \\le \\delta_{\\max}$ 的可能试探位移矢量 $\\boldsymbol{\\Delta}$，都必须满足此约束。为了保证这一点，我们必须考虑最坏情况，即位移使其某个分量 $|\\Delta_\\alpha|$ 的模长达到最大。在约束 $|\\boldsymbol{\\Delta}| = \\sqrt{\\Delta_x^2 + \\Delta_y^2 + \\Delta_z^2} \\le \\delta_{\\max}$ 下，任何单个分量（例如 $|\\Delta_x|$）能达到的最大值是 $\\delta_{\\max}$。这种情况发生在位移矢量与该坐标轴对齐时，例如 $\\boldsymbol{\\Delta} = (\\delta_{\\max}, 0, 0)$。\n\n为确保我们的条件对所有有效位移都成立，我们必须将其施加于这个最坏情况的模长上。将 $|\\Delta_\\alpha| = \\delta_{\\max}$ 代入推导出的不等式，得到：\n$$\n\\delta_{\\max} \\le \\frac{L}{2} - r_c\n$$\n问题要求满足此保证的最大位移模长 $\\delta_{\\max}$。这是等式成立时的极限情况：\n$$\n\\delta_{\\max} = \\frac{L}{2} - r_c\n$$\n问题陈述要求最终答案用粒子数 $N$、数密度 $\\rho$ 和截断半径 $r_c$ 来表示。数密度由定义 $\\rho = \\frac{N}{L^3}$ 给出。我们可以解出盒子边长 $L$：\n$$\nL^3 = \\frac{N}{\\rho} \\implies L = \\left(\\frac{N}{\\rho}\\right)^{1/3}\n$$\n将这个 $L$ 的表达式代入我们的 $\\delta_{\\max}$ 方程，得到最终结果：\n$$\n\\delta_{\\max} = \\frac{1}{2}\\left(\\frac{N}{\\rho}\\right)^{1/3} - r_c\n$$\n该表达式是与所述方案和几何约束一致的最大位移参数 $\\delta_{\\max}$ 的最大可能值。初始给定的条件 $r_c < L/2$ 确保了 $\\delta_{\\max}$ 是一个正的、具有物理意义的量。", "answer": "$$\n\\boxed{\\frac{1}{2}\\left(\\frac{N}{\\rho}\\right)^{1/3} - r_{c}}\n$$", "id": "2788157"}, {"introduction": "在确定了移动的几何边界后，下一个选择是试探性移动的统计性质。本练习将两种常见的策略——立方体内的均匀位移和高斯位移——在移动频繁被拒绝的稠密流体环境中进行对比。您将探索采样效率这一微妙的概念，并认识到决定快速收敛的并非仅仅是接受率，而是在构型空间中有效移动的距离。[@problem_id:2788218]", "problem": "考虑在正则系综（粒子数 $N$、体积 $V$ 和温度 $T$ 恒定）中对稠密的 Lennard-Jones 流体进行 Metropolis Monte Carlo 抽样。势能是标准的对 Lennard-Jones 形式，\n$$\nU(\\mathbf{r}^{N})=4\\varepsilon\\sum_{i<j}\\left[\\left(\\frac{\\sigma}{r_{ij}}\\right)^{12}-\\left(\\frac{\\sigma}{r_{ij}}\\right)^{6}\\right],\n$$\n其中 $r_{ij}=|\\mathbf{r}_{i}-\\mathbf{r}_{j}|$，数密度足够高，以至于短程排斥部分主导了局域能量的变化。考虑用于原子平移的单粒子随机行走 Metropolis 提议，\n$$\n\\mathbf{r}_{k}\\mapsto \\mathbf{r}_{k}+\\Delta \\mathbf{r},\\quad \\Delta \\mathbf{r}=(\\Delta x,\\Delta y,\\Delta z),\n$$\n有两种对称的提议类别：\n\n- 均匀立方体：每个分量都是独立的，并且在 $[-\\delta,\\delta]$ 上均匀分布。\n\n- 高斯：每个分量都是独立的，并且服从均值为 $0$、方差为 $\\sigma^{2}$ 的正态分布。\n\n从状态 $\\mathbf{x}$ 移动到状态 $\\mathbf{y}$ 的一个提议移动的 Metropolis 接受概率是\n$$\n\\alpha(\\mathbf{x}\\to\\mathbf{y})=\\min\\left\\{1,\\exp\\left[-\\beta\\left(U(\\mathbf{y})-U(\\mathbf{x})\\right)\\right]\\right\\},\n$$\n其中 $\\beta=1/(k_{\\mathrm{B}}T)$，且提议是对称的 $q(\\mathbf{y}\\mid \\mathbf{x})=q(\\mathbf{x}\\mid \\mathbf{y})$。假设提议被调整，使得两类提议的均方步长保持固定，\n$$\n\\mathbb{E}\\left[|\\Delta \\mathbf{r}|^{2}\\right]\\equiv \\mathbb{E}\\left[\\Delta x^{2}+\\Delta y^{2}+\\Delta z^{2}\\right]=s^{2},\n$$\n其中期望是针对提议分布计算的。定义每次尝试的期望平方跳跃距离，\n$$\nJ\\equiv \\mathbb{E}\\left[|\\Delta \\mathbf{r}|^{2}\\,\\alpha\\right],\n$$\n这里的平均是针对当前构型和提议的联合分布计算的。假设我们感兴趣的可观测量是构型的平滑函数，并且在这种稠密体系中，由于陡峭的排斥核，单个粒子位移的局域能量增量 $\\Delta U$ 通常是位移大小 $|\\Delta \\mathbf{r}|$ 的快速递增函数，因此接受因子是 $|\\Delta \\mathbf{r}|$ 的快速递减函数。\n\n在这些条件下，以下哪些陈述是正确的？\n\nA. 在固定的逆温度 $\\beta$ 下，对于稠密的 Lennard-Jones 流体，当两个对称的随机行走 Metropolis 提议被调整到具有相同的 $\\mathbb{E}[|\\Delta \\mathbf{r}|^{2}]$ 时，与高斯提议相比，均匀立方体提议会产生更高的每次提议的期望平方跳跃距离 $J=\\mathbb{E}[|\\Delta \\mathbf{r}|^{2}\\,\\alpha]$，因此对于平滑可观测量会产生更低的渐近方差。\n\nB. 当校准到相同的 $\\mathbb{E}[|\\Delta \\mathbf{r}|^{2}]$ 时，高斯提议比均匀立方体提议具有更高的接受概率，因为它将概率集中在 $\\Delta \\mathbf{r}=\\mathbf{0}$ 附近，而这必然意味着所有可观测量都具有严格更小的积分自相关时间。\n\nC. 如果满足细致平衡条件且 $\\mathbb{E}[|\\Delta \\mathbf{r}|^{2}]$ 相匹配，则均匀立方体链和高斯链是 Peskun 等价的，因此它们对每个可观测量的渐近方差是相同的。\n\nD. 在稀薄气体极限下（在固定 $\\beta$ 下的低数密度），这些提议之间的 $J$ 值差异趋于零，因为对于典型的步长 $\\alpha\\approx 1$；相反，在具有强短程排斥的稠密体系中，均匀立方体提议的紧支集避免了极不可能的大移动，因此在相同的 $\\mathbb{E}[|\\Delta \\mathbf{r}|^{2}]$下，相对于高斯提议增加了 $J$ 值。\n\nE. 匹配不同提议的 $\\mathbb{E}[|\\Delta \\mathbf{r}|^{2}]$ 意味着 $\\sigma^{2}=\\delta^{2}$，其中 $\\sigma^{2}$ 是高斯提议的每个分量的方差，$\\delta$ 是均匀分量分布的半宽度。\n\n选择所有适用的选项。", "solution": "问题陈述经过验证。\n\n**步骤 1：提取已知条件**\n- **系统**：正则系综（$N, V, T$ 恒定）中的稠密 Lennard-Jones (LJ) 流体。\n- **势能**：$U(\\mathbf{r}^{N})=4\\varepsilon\\sum_{i<j}\\left[\\left(\\frac{\\sigma}{r_{ij}}\\right)^{12}-\\left(\\frac{\\sigma}{r_{ij}}\\right)^{6}\\right]$，其中 $r_{ij}=|\\mathbf{r}_{i}-\\mathbf{r}_{j}|$。系统处于高密度状态，因此排斥部分主导局域能量变化。\n- **模拟方法**：采用单粒子尝试移动的 Metropolis Monte Carlo，$\\mathbf{r}_{k}\\mapsto \\mathbf{r}_{k}+\\Delta \\mathbf{r}$。\n- **$\\Delta \\mathbf{r}=(\\Delta x,\\Delta y,\\Delta z)$ 的提议分布**：\n    1.  **均匀立方体**：分量 $\\Delta x, \\Delta y, \\Delta z$ 相互独立，并在 $[-\\delta, \\delta]$ 上均匀分布。\n    2.  **高斯**：分量 $\\Delta x, \\Delta y, \\Delta z$ 相互独立，并服从均值为 $0$、方差为 $\\sigma^{2}$ 的正态分布。\n- **提议对称性**：提议是对称的，$q(\\mathbf{y} \\mid \\mathbf{x})=q(\\mathbf{x} \\mid \\mathbf{y})$。\n- **接受概率**：$\\alpha(\\mathbf{x}\\to\\mathbf{y})=\\min\\left\\{1,\\exp\\left[-\\beta\\left(U(\\mathbf{y})-U(\\mathbf{x})\\right)\\right]\\right\\}$，其中 $\\beta=1/(k_{\\mathrm{B}}T)$。\n- **约束条件**：提议被调整为具有固定的均方步长：$\\mathbb{E}\\left[|\\Delta \\mathbf{r}|^{2}\\right]=s^{2}$。\n- **性能度量**：每次尝试的期望平方跳跃距离为 $J\\equiv \\mathbb{E}\\left[|\\Delta \\mathbf{r}|^{2}\\,\\alpha\\right]$。\n- **假设**：在稠密体系中，接受因子 $\\alpha$ 是位移大小 $|\\Delta \\mathbf{r}|$ 的快速递减函数。注意：符号 $\\sigma$ 同时用于 LJ 势参数和高斯提议方差。这略有不清晰之处，但上下文使得区别明确，因此不会使问题无效。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学基础**：该问题是计算统计力学中一个标准且基础的课题，涉及 Monte Carlo 模拟的效率。所有原理（Lennard-Jones 势、正则系综、Metropolis 算法）都是公认的。这是有效的。\n- **适定性**：问题定义清晰，提出了在精确约束下比较两种标准提议方案的具体问题。可以基于已建立的理论推导出唯一答案。这是有效的。\n- **客观性**：问题以精确、客观、技术性的语言陈述。这是有效的。\n\n**步骤 3：结论与行动**\n问题陈述在科学上是合理的、适定的、客观的，并包含足够的信息以进行严谨的分析。因此，该问题是有效的。我们继续进行求解。\n\n首先，我们必须在固定均方步长 $\\mathbb{E}\\left[|\\Delta \\mathbf{r}|^{2}\\right] = s^{2}$ 的约束下，建立两种提议分布的参数 $\\delta$ 和 $\\sigma$ 之间的关系。位移 $\\Delta \\mathbf{r}$ 的各分量是独立同分布的。\n\n对于**均匀立方体提议**，每个分量（例如 $\\Delta x$）从均匀分布 $U[-\\delta, \\delta]$ 中抽取。均值为 $\\mathbb{E}[\\Delta x] = 0$。方差（等于均方值）为 $\\mathbb{E}[\\Delta x^{2}] = \\text{Var}(\\Delta x) = \\frac{(\\delta - (-\\delta))^{2}}{12} = \\frac{4\\delta^{2}}{12} = \\frac{\\delta^{2}}{3}$。\n总均方位移为：\n$$\n\\mathbb{E}\\left[|\\Delta \\mathbf{r}|^{2}\\right] = \\mathbb{E}[\\Delta x^{2} + \\Delta y^{2} + \\Delta z^{2}] = \\mathbb{E}[\\Delta x^{2}] + \\mathbb{E}[\\Delta y^{2}] + \\mathbb{E}[\\Delta z^{2}] = 3 \\left(\\frac{\\delta^{2}}{3}\\right) = \\delta^{2}\n$$\n因此，对于均匀立方体提议，$s^{2} = \\delta^{2}$。\n\n对于**高斯提议**，每个分量（例如 $\\Delta x$）从正态分布 $N(0, \\sigma^{2})$ 中抽取。根据定义，均值为 $\\mathbb{E}[\\Delta x] = 0$，方差（即均方值）为 $\\mathbb{E}[\\Delta x^{2}] = \\sigma^{2}$。\n总均方位移为：\n$$\n\\mathbb{E}\\left[|\\Delta \\mathbf{r}|^{2}\\right] = \\mathbb{E}[\\Delta x^{2} + \\Delta y^{2} + \\Delta z^{2}] = \\sigma^{2} + \\sigma^{2} + \\sigma^{2} = 3\\sigma^{2}\n$$\n因此，对于高斯提议，$s^{2} = 3\\sigma^{2}$。\n\n均方步长相匹配的约束条件 $\\mathbb{E}[|\\Delta \\mathbf{r}|^2] = s^2$ 意味着参数之间存在以下关系：\n$$\n\\delta^{2} = 3\\sigma^{2}\n$$\n这是在给定条件下比较两种提议的基本关系。\n\n我们感兴趣的量是 $J = \\mathbb{E}[|\\Delta \\mathbf{r}|^2 \\alpha]$。这个量衡量每次 Monte Carlo 尝试的有效平方位移，并作为算法探索构型空间效率的代理指标。通常，较大的 $J$ 对应于自相关函数的更快衰减，从而使得平滑可观测量的估计量具有更小的渐近方差。\n\n在稠密流体中，Lennard-Jones 势的短程排斥部分 $\\sim (r_{ij})^{-12}$ 占主导地位。这意味着即使是中等大小的位移 $\\Delta \\mathbf{r}$ 也可能导致粒子与邻近粒子发生显著重叠，从而引起非常大的正能量变化，即 $\\Delta U \\gg k_{\\mathrm{B}}T$。因此，对于大的 $|\\Delta \\mathbf{r}|$，接受概率 $\\alpha = \\exp(-\\beta \\Delta U)$ 变得极小。函数 $\\alpha(|\\Delta \\mathbf{r}|)$ 对大位移起到软截止滤波器的作用。\n\n两种提议的关键区别在于它们的支集和尾部行为。\n- **均匀立方体**提议具有紧支集：它从不提议在由 $|\\Delta x|, |\\Delta y|, |\\Delta z| \\le \\delta$ 定义的立方体之外的移动。可能的最大平方位移是 $3\\delta^2$。\n- **高斯**提议具有无限支集：原则上，它可以提议任何大小的移动。然而，非常大的移动的概率很小。\n\n高斯提议通过提议非常大的位移而“浪费”了一部分尝试。在稠密流体中，这些大移动几乎肯定会被拒绝（$\\alpha \\approx 0$），因此对 $J$ 没有贡献。而均匀提议，根据其构造，避免了这些无效的大位移提议。它将其所有提议集中在一个有界区域内。通过调整 $\\delta$（从而调整 $s$），可以确保该区域对应的步长既有合理的接受机会，又足够大以有效探索构型空间。对于相同的均方步长 $s^2$，高斯提议被迫具有更长的尾部，这是低效的。因此，对于稠密系统，预期均匀立方体提议会产生更高的 $J$ 值。\n\n现在，我们逐一评估每个选项。\n\n**A. 在固定的逆温度 $\\beta$ 下，对于稠密的 Lennard-Jones 流体，当两个对称的随机行走 Metropolis 提议被调整到具有相同的 $\\mathbb{E}[|\\Delta \\mathbf{r}|^{2}]$ 时，与高斯提议相比，均匀立方体提议会产生更高的每次提议的期望平方跳跃距离 $J=\\mathbb{E}[|\\Delta \\mathbf{r}|^{2}\\,\\alpha]$，因此对于平滑可观测量会产生更低的渐近方差。**\n该陈述与我们的分析完全一致。在稠密体系中，均匀提议的紧支集是一个优势，因为它避免了提议会被系统性拒绝的大能量移动。这导致了对提议的更有效利用，从而产生更大的有效平方跳跃距离 $J$。较大的 $J$ 表示对构型空间的探索更快，这转化为更小的积分自相关时间，并因此导致平滑可观测量估计量的渐近方差更低。\n结论：**正确**。\n\n**B. 当校准到相同的 $\\mathbb{E}[|\\Delta \\mathbf{r}|^{2}]$ 时，高斯提议比均匀立方体提议具有更高的接受概率，因为它将概率集中在 $\\Delta \\mathbf{r}=\\mathbf{0}$ 附近，而这必然意味着所有可观测量都具有严格更小的积分自相关时间。**\n陈述的第一部分是合理的。高斯分布在原点处的峰值比均匀分布更尖锐（对于 $\\delta^2=3\\sigma^2$）。由于小 $|\\Delta \\mathbf{r}|$ 的移动具有 $\\Delta U \\approx 0$ 从而 $\\alpha \\approx 1$，高斯提议可能确实具有更高的整体接受率。然而，由此得出的结论是错误的。高接受率本身并不是效率的指标。极高的接受率（例如 $> 90\\%$）通常意味着提议的步长太小，导致系统扩散非常缓慢。这导致连续状态之间的高度相关性，从而导致*大*的积分自相关时间。效率由接受率和步长的乘积决定，而 $J$ 正是这个乘积的近似。均匀提议有更高的 $J$ 值（如 A 中所论证）意味着效率*更高*，而不是更差。\n结论：**不正确**。\n\n**C. 如果满足细致平衡条件且 $\\mathbb{E}[|\\Delta \\mathbf{r}|^{2}]$ 相匹配，则均匀立方体链和高斯链是 Peskun 等价的，因此它们对每个可观测量的渐近方差是相同的。**\n细致平衡条件 $p(x)P(x \\to y) = p(y)P(y \\to x)$ 对于对称提议的 Metropolis-Hastings 算法是满足的。Peskun 定理为比较不同马尔可夫链的效率提供了基础。如果对于所有状态 $x \\ne y$，转移核为 $P_1$ 的链满足 $P_1(x, y) \\ge P_2(x, y)$，则称该链在 Peskun 意义上优于核为 $P_2$ 的链。这将意味着使用 $P_1$ 的任何可观测量的渐近方差小于或等于使用 $P_2$ 的渐近方差。只有当对于所有 $x \\ne y$ 都有 $P_1(x, y) = P_2(x, y)$ 时，两条链对于所有可观测量才会具有相同的渐近方差。在这里，转移概率是 $P(x \\to y) = q(\\Delta \\mathbf{r}) \\alpha(x \\to y)$。提议密度 $q_{uni}(\\Delta \\mathbf{r})$ 和 $q_{gauss}(\\Delta \\mathbf{r})$ 是根本不同的函数。在整个位移空间 $\\Delta \\mathbf{r}$ 上，两者都不是逐点大于或等于另一个的。因此，这两个核之间不存在 Peskun 序，它们当然也不等价到能意味着对所有可观测量都有相同的渐近方差。\n结论：**不正确**。\n\n**D. 在稀薄气体极限下（在固定 $\\beta$ 下的低数密度），这些提议之间的 $J$ 值差异趋于零，因为对于典型的步长 $\\alpha\\approx 1$；相反，在具有强短程排斥的稠密体系中，均匀立方体提议的紧支集避免了极不可能的大移动，因此在相同的 $\\mathbb{E}[|\\Delta \\mathbf{r}|^{2}]$下，相对于高斯提议增加了 $J$ 值。**\n该陈述在两个相反的物理体系中对这两种提议进行了比较。\n- **稀薄气体极限**：在低密度下，粒子相距很远。一个中等大小的尝试移动非常不可能引起能量上的冲突。因此，能量变化 $\\Delta U$ 通常接近于零，接受概率 $\\alpha \\approx 1$。在这个极限下，$J$ 的表达式简化为 $J = \\mathbb{E}[|\\Delta \\mathbf{r}|^2 \\alpha] \\approx \\mathbb{E}[|\\Delta \\mathbf{r}|^2]$。由于提议的构造使得它们具有相同的 $\\mathbb{E}[|\\Delta \\mathbf{r}|^2] = s^2$，它们各自的 $J$ 值将近似相等，$J_{uni} \\approx J_{gauss} \\approx s^2$。陈述的第一部分是正确的。\n- **稠密体系**：陈述的第二部分重复了选项 A 的论点：在稠密流体中，均匀提议的紧支集通过避免提议会被拒绝的大步长而使其更有效。这相对于高斯提议增加了 $J_{uni}$。这种对比在物理上和方法论上都是正确的。\n整个陈述是对该行为的一个复杂而准确的总结。\n结论：**正确**。\n\n**E. 匹配不同提议的 $\\mathbb{E}[|\\Delta \\mathbf{r}|^{2}]$ 意味着 $\\sigma^{2}=\\delta^{2}$，其中 $\\sigma^{2}$ 是高斯提议的每个分量的方差，$\\delta$ 是均匀分量分布的半宽度。**\n这是一个定量事实的陈述，我们可以直接从我们最初的推导中进行核查。\n我们发现：\n- 对于均匀立方体提议，$\\mathbb{E}[|\\Delta \\mathbf{r}|^2] = \\delta^2$。\n- 对于高斯提议，$\\mathbb{E}[|\\Delta \\mathbf{r}|^2] = 3\\sigma^2$，其中 $\\sigma^2$ 确实是单分量方差。\n将这两者相等可得 $\\delta^2 = 3\\sigma^2$。该陈述声称 $\\delta^2 = \\sigma^2$，这在数学上是错误的。它错误地将均匀情况下的总均方位移与高斯情况下的单分量方差等同起来。\n结论：**不正确**。\n\n总之，选项 A 和 D 是正确的。", "answer": "$$\\boxed{AD}$$", "id": "2788218"}, {"introduction": "优化局部移动的最后一步是调整步长，这个决策通常依赖于经验法则。本练习为其中一个最著名的规则——高维系统中约 23.4% 的最优接受率——提供了严谨的理论基础。通过在一个简化的谐振子模型中完成推导，您将看到强大的概率论结果如何为复杂模拟中实现最高效率提供具体而实用的指导方针。[@problem_id:2788234]", "problem": "理论化学中的一个常见场景是，对一个多自由度系统在势能面局部极小点附近进行构型玻尔兹曼分布的采样，在该区域，势能可以用适当的质量加权简正模式下的谐振子来近似。考虑一个具有 $d$ 个独立简正模式的系统，其在无量纲单位下的势能为 $U(\\mathbf{x}) = \\frac{1}{2} \\sum_{i=1}^{d} x_{i}^{2}$。在逆温度 $\\beta = 1$ 时，坐标 $\\mathbf{x} \\in \\mathbb{R}^{d}$ 的目标分布为 $ \\pi(\\mathbf{x}) \\propto \\exp\\!\\left(-U(\\mathbf{x})\\right)$，即一个 $d$ 维标准正态分布。\n\n我们执行形式为 $\\mathbf{y} = \\mathbf{x} + s\\,\\boldsymbol{\\eta}$ 的局部Metropolis随机游走提议，其中 $\\boldsymbol{\\eta} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}_{d})$ 且与 $\\mathbf{x}$ 独立。Metropolis接受概率为 $a(\\mathbf{x},\\mathbf{y}) = \\min\\!\\left\\{1, \\exp\\!\\left[\\log \\pi(\\mathbf{y}) - \\log \\pi(\\mathbf{x})\\right]\\right\\}$，并假设马尔可夫链处于平稳状态，因此 $\\mathbf{x} \\sim \\pi$。为研究高维行为，我们考虑标度关系 $s = \\ell / \\sqrt{d}$，其中 $\\ell > 0$ 为固定值，并令 $d \\to \\infty$。\n\n仅从上述定义、标准正态分布的性质以及概率论的经典极限定理出发，完成以下步骤：\n1. 推导当 $d \\to \\infty$ 时，平均接受概率 $\\alpha(\\ell) = \\mathbb{E}[a(\\mathbf{x},\\mathbf{y})]$ 作为 $\\ell$ 的函数的极限，并用标准正态累积分布函数表示。你可以使用以下事实：对于独立的标准正态变量，适当缩放后的和弱收敛于一个标准正态分布；经验平均几乎必然收敛于其期望值。\n2. 在上述标度关系下，将每次提议的渐近期望平方跳跃距离定义为 $J(\\ell) = \\lim_{d \\to \\infty} \\mathbb{E}\\!\\left[\\|\\mathbf{y} - \\mathbf{x}\\|^{2} \\, a(\\mathbf{x},\\mathbf{y})\\right]$，并证明在极限情况下 $J(\\ell)$ 与 $\\ell^{2} \\alpha(\\ell)$ 成正比。\n3. 在 $\\ell > 0$ 的范围内最大化 $J(\\ell)$，并确定在 $d \\to \\infty$ 极限下相应的最优接受概率 $\\alpha^{\\star}$。\n\n最终答案只报告最优接受概率 $\\alpha^{\\star}$ 的数值，四舍五入到三位有效数字。该答案是无量纲的；不要包含任何单位。", "solution": "给定目标分布为一个 $d$ 维标准正态分布 $\\pi(\\mathbf{x}) \\propto \\exp\\!\\left(-\\|\\mathbf{x}\\|^{2}/2\\right)$，以及一个对称随机游走提议 $\\mathbf{y} = \\mathbf{x} + s\\,\\boldsymbol{\\eta}$，其中 $\\boldsymbol{\\eta} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}_{d})$，$s = \\ell/\\sqrt{d}$。Metropolis接受概率为\n$$\na(\\mathbf{x},\\mathbf{y}) = \\min\\!\\left\\{1, \\exp\\!\\left[\\log \\pi(\\mathbf{y}) - \\log \\pi(\\mathbf{x})\\right]\\right\\}。\n$$\n由于提议是对称的，Hastings比率简化为目标密度的比率。我们在 $d \\to \\infty$ 且 $\\ell > 0$ 为固定值的情况下分析其高维极限。\n\n步骤 1：推导极限平均接受概率 $\\alpha(\\ell)$。\n\n对数密度差为\n$$\n\\Delta \\equiv \\log \\pi(\\mathbf{y}) - \\log \\pi(\\mathbf{x}) \\;=\\; -\\frac{1}{2}\\big(\\|\\mathbf{y}\\|^{2} - \\|\\mathbf{x}\\|^{2}\\big)。\n$$\n当 $\\mathbf{y} = \\mathbf{x} + s\\,\\boldsymbol{\\eta}$ 且 $s = \\ell/\\sqrt{d}$ 时，\n$$\n\\|\\mathbf{y}\\|^{2} - \\|\\mathbf{x}\\|^{2} \\;=\\; \\|\\mathbf{x} + s\\,\\boldsymbol{\\eta}\\|^{2} - \\|\\mathbf{x}\\|^{2}\n\\;=\\; 2 s\\, \\mathbf{x} \\cdot \\boldsymbol{\\eta} + s^{2} \\|\\boldsymbol{\\eta}\\|^{2}。\n$$\n因此\n$$\n\\Delta \\;=\\; - s\\, \\mathbf{x} \\cdot \\boldsymbol{\\eta} \\;-\\; \\frac{1}{2} s^{2} \\|\\boldsymbol{\\eta}\\|^{2}。\n$$\n在平稳状态下，$\\mathbf{x} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}_{d})$ 且与 $\\boldsymbol{\\eta} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}_{d})$ 独立。在 $s = \\ell/\\sqrt{d}$ 的标度关系下，分别考虑这两项。\n\n- 根据独立性以及三角阵中心极限定理，或通过直接计算方差可知，投影\n$$\n\\frac{1}{\\sqrt{d}} \\mathbf{x} \\cdot \\boldsymbol{\\eta} \\;=\\; \\frac{1}{\\sqrt{d}} \\sum_{i=1}^{d} x_{i} \\eta_{i}\n$$\n依分布收敛于一个标准正态随机变量 $Z \\sim \\mathcal{N}(0,1)$，因为加和项 $x_{i}\\eta_{i}$ 是独立的、均值为零且方差为1。因此，\n$$\ns\\, \\mathbf{x} \\cdot \\boldsymbol{\\eta} \\;=\\; \\frac{\\ell}{\\sqrt{d}} \\, \\mathbf{x} \\cdot \\boldsymbol{\\eta} \\;\\xrightarrow[d\\to\\infty]{\\mathcal{D}}\\; \\ell\\, Z.\n$$\n\n- 根据强大数定律，\n$$\n\\frac{1}{d}\\|\\boldsymbol{\\eta}\\|^{2} \\;=\\; \\frac{1}{d} \\sum_{i=1}^{d} \\eta_{i}^{2} \\;\\xrightarrow[d\\to\\infty]{\\text{a.s.}}\\; \\mathbb{E}[\\eta_{1}^{2}] \\;=\\; 1.\n$$\n因此\n$$\n\\frac{1}{2} s^{2} \\|\\boldsymbol{\\eta}\\|^{2} \\;=\\; \\frac{1}{2} \\frac{\\ell^{2}}{d} \\|\\boldsymbol{\\eta}\\|^{2} \\;\\xrightarrow[d\\to\\infty]{\\text{a.s.}}\\; \\frac{1}{2} \\ell^{2}.\n$$\n\n结合这两种收敛，并引用有界连续泛函收敛的标准论证，可得到 $\\Delta$ 的极限分布：\n$$\n\\Delta \\;\\xrightarrow[d\\to\\infty]{\\mathcal{D}}\\; - \\ell Z \\;-\\; \\frac{1}{2}\\ell^{2},\n$$\n其中 $Z \\sim \\mathcal{N}(0,1)$ 与其他所有变量独立。因此，极限情况下的平均接受概率为\n$$\n\\alpha(\\ell) \\;=\\; \\mathbb{E}\\!\\left[\\min\\!\\left\\{1, \\exp(\\Delta)\\right\\}\\right] \\;=\\; \\mathbb{E}\\!\\left[\\min\\!\\left\\{1, \\exp\\!\\left(-\\ell Z - \\frac{1}{2}\\ell^{2}\\right)\\right\\}\\right]。\n$$\n令 $\\phi(z) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-z^{2}/2)$ 表示标准正态概率密度函数，$\\Phi$ 表示其累积分布函数。事件 $\\exp(-\\ell Z - \\ell^{2}/2) \\geq 1$ 等价于 $-\\ell Z - \\ell^{2}/2 \\geq 0$，即 $Z \\leq -\\ell/2$。因此\n$$\n\\alpha(\\ell) \\;=\\; \\mathbb{P}(Z \\leq -\\ell/2) \\;+\\; \\mathbb{E}\\!\\left[\\exp\\!\\left(-\\ell Z - \\frac{1}{2}\\ell^{2}\\right)\\, \\mathbf{1}_{\\{Z > -\\ell/2\\}}\\right]。\n$$\n通过配方法计算第二项：\n\\begin{align*}\n\\mathbb{E}\\!\\left[\\exp\\!\\left(-\\ell Z - \\frac{1}{2}\\ell^{2}\\right)\\, \\mathbf{1}_{\\{Z > -\\ell/2\\}}\\right]\n&= \\int_{-\\ell/2}^{\\infty} \\exp\\!\\left(-\\ell z - \\frac{1}{2}\\ell^{2}\\right) \\phi(z)\\, \\mathrm{d}z \\\\\n&= \\int_{-\\ell/2}^{\\infty} \\frac{1}{\\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{z^{2}}{2} - \\ell z - \\frac{1}{2}\\ell^{2}\\right) \\, \\mathrm{d}z \\\\\n&= \\int_{-\\ell/2}^{\\infty} \\frac{1}{\\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(z+\\ell)^{2}}{2}\\right) \\, \\mathrm{d}z \\\\\n&= \\int_{-\\ell/2+\\ell}^{\\infty} \\frac{1}{\\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{u^{2}}{2}\\right) \\, \\mathrm{d}u \\\\\n&= 1 - \\Phi(\\ell/2).\n\\end{align*}\n因此，\n$$\n\\alpha(\\ell) \\;=\\; \\Phi(-\\ell/2) \\;+\\; \\big(1 - \\Phi(\\ell/2)\\big) \\;=\\; 2 \\big(1 - \\Phi(\\ell/2)\\big) \\;=\\; 2 \\, \\Phi(-\\ell/2)。\n$$\n这就是所求的作为 $\\ell$ 函数的极限接受概率。\n\n步骤 2：定义并简化渐近期望平方跳跃距离 $J(\\ell)$。\n\n平方跳跃长度为 $\\|\\mathbf{y} - \\mathbf{x}\\|^{2} = s^{2} \\|\\boldsymbol{\\eta}\\|^{2}$。因此\n$$\n\\mathbb{E}\\!\\left[\\|\\mathbf{y} - \\mathbf{x}\\|^{2} \\, a(\\mathbf{x},\\mathbf{y})\\right]\n\\;=\\; s^{2} \\, \\mathbb{E}\\!\\left[\\|\\boldsymbol{\\eta}\\|^{2} \\, a(\\mathbf{x},\\mathbf{y})\\right]。\n$$\n在 $s = \\ell/\\sqrt{d}$ 的标度关系下，并利用 $\\|\\boldsymbol{\\eta}\\|^{2}/d \\to 1$ (几乎必然)，而 $a(\\mathbf{x},\\mathbf{y})$ 依分布收敛于 $\\min\\{1, \\exp(-\\ell Z - \\ell^{2}/2)\\}$ (其期望为 $\\alpha(\\ell)$)，通过标准的控制收敛论证（接受概率有界为1，范数的平方随 $d$ 线性增长，而 $s^2$ 按 $1/d$ 缩放）可得\n$$\nJ(\\ell) \\;\\equiv\\; \\lim_{d \\to \\infty} \\mathbb{E}\\!\\left[\\|\\mathbf{y} - \\mathbf{x}\\|^{2} \\, a(\\mathbf{x},\\mathbf{y})\\right]\n\\;=\\; \\ell^{2} \\, \\alpha(\\ell)。\n$$\n因此，在不考虑比例常数的情况下，最大化 $\\ell^{2} \\alpha(\\ell)$ 即可最大化渐近期望平方跳跃距离。\n\n步骤 3：最大化 $J(\\ell)$ 并计算最优接受概率 $\\alpha^{\\star}$。\n\n我们需要最大化\n$$\nH(\\ell) \\;=\\; \\ell^{2} \\, \\alpha(\\ell) \\;=\\; 2 \\, \\ell^{2} \\, \\Phi(-\\ell/2), \\quad \\ell > 0。\n$$\n对 $H(\\ell)$ 关于 $\\ell$ 求导，利用 $\\frac{\\mathrm{d}}{\\mathrm{d}\\ell} \\Phi(-\\ell/2) = -\\frac{1}{2} \\phi(\\ell/2)$ 以及标准正态密度函数是偶函数这一性质：\n\\begin{align*}\nH'(\\ell)\n&= 4 \\ell \\, \\Phi(-\\ell/2) \\;+\\; 2 \\ell^{2} \\left(-\\frac{1}{2}\\right) \\phi(\\ell/2) \\\\\n&= 4 \\ell \\, \\Phi(-\\ell/2) \\;-\\; \\ell^{2} \\, \\phi(\\ell/2)。\n\\end{align*}\n令 $H'(\\ell) = 0$ 并限定 $\\ell > 0$，可得到最优性条件\n$$\n4 \\, \\Phi(-\\ell/2) \\;=\\; \\ell \\, \\phi(\\ell/2)。\n$$\n令 $t = \\ell/2 > 0$。则该条件变为\n$$\n2 \\, \\Phi(-t) \\;=\\; t \\, \\phi(t)。\n$$\n这个标量方程在 $(0,\\infty)$ 内有唯一解。数值求解得到 $t^{\\star} \\approx 1.19$，等价地，$\\ell^{\\star} \\approx 2.38$。相应的最优接受概率为\n$$\n\\alpha^{\\star} \\;=\\; \\alpha(\\ell^{\\star}) \\;=\\; 2 \\, \\Phi\\!\\left(-\\frac{\\ell^{\\star}}{2}\\right) \\;=\\; 2 \\, \\Phi(-t^{\\star})。\n$$\n代入 $t^{\\star} \\approx 1.19$ 得\n$$\n\\alpha^{\\star} \\;\\approx\\; 2 \\, \\Phi(-1.19)。\n$$\n使用标准正态累积分布函数的值 $\\Phi(-1.19) \\approx 0.117$，我们得到\n$$\n\\alpha^{\\star} \\;\\approx\\; 0.234。\n$$\n该值是在谐振子（高斯）近似和 $\\ell/\\sqrt{d}$ 标度下，局部随机游走Metropolis移动在高维情况下的最优接受概率，常被用作高维分子蒙特卡洛模拟中的启发式目标接受率。\n\n四舍五入到三位有效数字，最优接受概率为 $0.234$。", "answer": "$$\\boxed{0.234}$$", "id": "2788234"}]}