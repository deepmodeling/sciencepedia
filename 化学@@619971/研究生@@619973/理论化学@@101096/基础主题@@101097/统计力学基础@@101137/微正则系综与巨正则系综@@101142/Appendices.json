{"hands_on_practices": [{"introduction": "微正则系综的核心在于对微观状态进行计数，从而与宏观热力学量建立联系。本练习将通过一个经典案例——理想气体的混合过程——来实践这一核心思想。你将直接从相空间体积的定义出发，通过微观状态计数来推导宏观上可测量的混合熵，深刻体会玻尔兹曼熵公式 $S = k_B \\ln \\Omega$ 的物理内涵 [@problem_id:2816785]。", "problem": "考虑两种不发生反应的单原子理想气体，组分 $A$ 和 $B$，最初被一个不可渗透的隔板限制在一个总体积为 $V = V_A + V_B$ 的孤立刚性容器中。左侧的子系统包含 $N_A$ 个质量为 $m_A$ 的粒子，体积为 $V_A$，总能量为 $E_A$；右侧的子系统包含 $N_B$ 个质量为 $m_B$ 的粒子，体积为 $V_B$，总能量为 $E_B$。这些气体彼此之间不相互作用，也不与任何外场相互作用，并且每个子系统内部都已达到平衡。假设最初两个子系统处于相同的温度和压力下，并且隔板的移除过程是准静态且绝热的，因此总能量 $E = E_A + E_B$ 和总体积 $V$ 守恒。移除隔板后，允许气体混合并达到平衡，同时保持其理想和不反应的特性。\n\n使用熵的微正则定义 $S = k_B \\ln \\Omega$，其中，对于哈密顿量为 $H = \\sum_{i=1}^{N} \\frac{|\\mathbf{p}_i|^2}{2m}$ 的经典 $N$ 粒子理想气体，其可及相空间体积为\n$$\n\\Omega(E,V,N) = \\frac{1}{h^{3N} N!} \\int \\mathrm{d}^{3N}x\\, \\mathrm{d}^{3N}p\\, \\Theta\\!\\big(E - H(\\{\\mathbf{p}_i\\})\\big),\n$$\n其中 $\\Theta$ 是 Heaviside 函数，$h$ 是 Planck 常数，通过显式的微正则态计数，计算混合过程的熵变，\n$$\n\\Delta S_{\\mathrm{mix}} = S_{\\mathrm{after}} - S_{\\mathrm{before}},\n$$\n在整个计算过程中，将 $A$ 和 $B$ 视为不同的组分，并在计数中包含不可区分性 (Gibbs) 修正因子 $1/N_A!$ 和 $1/N_B!$。你可以假设在热力学极限下，Stirling 近似成立，并且对于熵差的计算，基于表面和基于体积的微正则定义是等价的。\n\n然后，从你的表达式出发，证明如果两个隔间中的初始压力和温度相等（因此 $V_A/V_B = N_A/N_B$），你的结果就等价于用摩尔分数 $x_A = N_A/(N_A+N_B)$ 和 $x_B = N_B/(N_A+N_B)$ 来表示混合熵。\n\n将 $\\Delta S_{\\mathrm{mix}}$ 的最终答案表示为包含 $N_A$、$N_B$、$V_A$、$V_B$ 和 $k_B$ 的单个闭合形式解析表达式。将熵变以焦耳/开尔文为单位表示，并显式保留 $k_B$。无需进行数值计算。", "solution": "该问题要求使用微正则系综计算两种不同的、不发生反应的单原子理想气体 A 和 B 的混合熵。该系统是孤立的。\n\n首先，我们确定系统的初始状态。两种气体分别位于体积为 $V_A$ 和 $V_B$ 的独立隔间中。气体 A 有 $N_A$ 个粒子，能量为 $E_A$，被限制在体积 $V_A$ 内。气体 B 有 $N_B$ 个粒子，能量为 $E_B$，被限制在体积 $V_B$ 内。由于子系统之间不相互作用，初始构型的可及微观态总数是每个子系统可及微观态的乘积：\n$$\n\\Omega_{\\mathrm{before}} = \\Omega_A(E_A, V_A, N_A) \\Omega_B(E_B, V_B, N_B)\n$$\n因此，初始总熵是各子系统熵的总和：\n$$\nS_{\\mathrm{before}} = k_B \\ln \\Omega_{\\mathrm{before}} = k_B \\ln \\Omega_A(E_A, V_A, N_A) + k_B \\ln \\Omega_B(E_B, V_B, N_B) = S_A + S_B\n$$\n其中 $k_B$ 是 Boltzmann 常数。\n\n接下来，我们描述最终状态。隔板被移除，气体在总体积 $V = V_A + V_B$ 中混合。由于该过程对于孤立的总系统是绝热的，总能量 $E = E_A + E_B$ 守恒。由于气体是理想且不反应的，它们彼此之间不相互作用。因此，即使在混合之后，它们也可以被视为共存于同一体积 $V$ 中的两个独立系统。最终系统的微观态总数是每种气体在总体积 $V$ 中可用微观态的乘积，其中总能量 $E$ 分配为 $E'_A$ 和 $E'_B$，使得 $E'_A + E'_B = E$。\n$$\n\\Omega_{\\mathrm{after}} = \\Omega_A(E'_A, V, N_A) \\Omega_B(E'_B, V, N_B)\n$$\n问题指出，最初两种气体处于相同的温度 $T$ 和压力 $P$。对于单原子理想气体，能量与温度的关系为 $E = \\frac{3}{2} N k_B T$。初始温度相等（$T_A = T_B = T$）的条件意味着两种气体的每个粒子的能量是相同的：\n$$\n\\frac{E_A}{N_A} = \\frac{E_B}{N_B} = \\frac{3}{2} k_B T\n$$\n混合后，两种组分将平衡到一个共同的最终温度 $T_f$。最终能量将是 $E'_A = \\frac{3}{2} N_A k_B T_f$ 和 $E'_B = \\frac{3}{2} N_B k_B T_f$。总能量是守恒的，$E'_A + E'_B = E_A + E_B$。因此，\n$$\nT_f = \\frac{E'_A + E'_B}{\\frac{3}{2} (N_A+N_B) k_B} = \\frac{E_A + E_B}{\\frac{3}{2} (N_A+N_B) k_B}\n$$\n代入 $E_A = \\frac{3}{2} N_A k_B T$ 和 $E_B = \\frac{3}{2} N_B k_B T$，我们发现：\n$$\nT_f = \\frac{\\frac{3}{2} N_A k_B T + \\frac{3}{2} N_B k_B T}{\\frac{3}{2} (N_A+N_B) k_B} = \\frac{(\\frac{3}{2} k_B T)(N_A+N_B)}{(\\frac{3}{2} k_B)(N_A+N_B)} = T\n$$\n最终温度与初始温度相同。这意味着混合时两种组分之间没有净能量转移。每个组分的能量是分别守恒的：$E'_A = E_A$ 和 $E'_B = E_B$。\n\n因此，最终状态的微观态数目由下式给出：\n$$\n\\Omega_{\\mathrm{after}} = \\Omega_A(E_A, V, N_A) \\Omega_B(E_B, V, N_B)\n$$\n最终熵为：\n$$\nS_{\\mathrm{after}} = k_B \\ln\\Omega_{\\mathrm{after}} = k_B \\ln\\Omega_A(E_A, V, N_A) + k_B \\ln\\Omega_B(E_B, V, N_B)\n$$\n混合过程中的熵变 $\\Delta S_{\\mathrm{mix}}$ 是最终熵与初始熵之差：\n$$\n\\Delta S_{\\mathrm{mix}} = S_{\\mathrm{after}} - S_{\\mathrm{before}} = \\left(k_B \\ln\\Omega_A(E_A, V, N_A) - k_B \\ln\\Omega_A(E_A, V_A, N_A)\\right) + \\left(k_B \\ln\\Omega_B(E_B, V, N_B) - k_B \\ln\\Omega_B(E_B, V_B, N_B)\\right)\n$$\n$$\n\\Delta S_{\\mathrm{mix}} = k_B \\ln\\left(\\frac{\\Omega_A(E_A, V, N_A)}{\\Omega_A(E_A, V_A, N_A)}\\right) + k_B \\ln\\left(\\frac{\\Omega_B(E_B, V, N_B)}{\\Omega_B(E_B, V_B, N_B)}\\right)\n$$\n我们现在使用给定的微正则相空间体积表达式：\n$$\n\\Omega(E,V,N) = \\frac{V^N}{h^{3N} N!} \\int \\mathrm{d}^{3N}p\\, \\Theta\\!\\big(E - H(\\{\\mathbf{p}_i\\})\\big) = \\frac{V^N}{h^{3N} N!} \\times (\\text{动量空间体积})\n$$\n对于气体 A，当其从体积 $V_A$ 膨胀到 $V$ 而其能量 $E_A$ 和粒子数 $N_A$ 保持不变时，其微观态的比值为：\n$$\n\\frac{\\Omega_A(E_A, V, N_A)}{\\Omega_A(E_A, V_A, N_A)} = \\frac{\\frac{V^{N_A}}{h^{3N_A} N_A!} \\times (\\text{动量空间体积})}{\\frac{V_A^{N_A}}{h^{3N_A} N_A!} \\times (\\text{动量空间体积})} = \\left(\\frac{V}{V_A}\\right)^{N_A}\n$$\n与动量相关的部分完全抵消了。类似地，对于气体 B：\n$$\n\\frac{\\Omega_B(E_B, V, N_B)}{\\Omega_B(E_B, V_B, N_B)} = \\left(\\frac{V}{V_B}\\right)^{N_B}\n$$\n将这些比值代入 $\\Delta S_{\\mathrm{mix}}$ 的表达式中：\n$$\n\\Delta S_{\\mathrm{mix}} = k_B \\ln\\left(\\left(\\frac{V}{V_A}\\right)^{N_A}\\right) + k_B \\ln\\left(\\left(\\frac{V}{V_B}\\right)^{N_B}\\right) = N_A k_B \\ln\\left(\\frac{V}{V_A}\\right) + N_B k_B \\ln\\left(\\frac{V}{V_B}\\right)\n$$\n用 $V_A + V_B$ 替换 $V$，我们得到混合熵的表达式：\n$$\n\\Delta S_{\\mathrm{mix}} = N_A k_B \\ln\\left(\\frac{V_A+V_B}{V_A}\\right) + N_B k_B \\ln\\left(\\frac{V_A+V_B}{V_B}\\right)\n$$\n这就是所要求的结果，用 $N_A$、$N_B$、$V_A$、$V_B$ 和 $k_B$ 表示。\n\n问题的第二部分要求证明，在初始压力和温度相等的条件下，该结果等价于用摩尔分数表示的标准表达式。理想气体定律为 $PV = Nk_BT$。由于 $P_A=P_B$ 和 $T_A=T_B$，可得：\n$$\n\\frac{N_A k_B T_A}{V_A} = \\frac{N_B k_B T_B}{V_B} \\implies \\frac{N_A}{V_A} = \\frac{N_B}{V_B}\n$$\n这意味着 $\\frac{V_A}{N_A} = \\frac{V_B}{N_B}$。每种气体所占的体积与其粒子数成正比。\n摩尔分数为 $x_A = \\frac{N_A}{N_A+N_B}$ 和 $x_B = \\frac{N_B}{N_A+N_B}$。\n根据条件 $\\frac{V_A}{N_A} = \\frac{V_B}{N_B}$，我们可以写出 $V_A = c N_A$ 和 $V_B = c N_B$，其中 $c$ 为某个常数。总体积为 $V_A+V_B = c(N_A+N_B)$。\n我们现在可以计算对数中的参数：\n$$\n\\frac{V_A+V_B}{V_A} = \\frac{c(N_A+N_B)}{c N_A} = \\frac{N_A+N_B}{N_A} = \\frac{1}{x_A}\n$$\n$$\n\\frac{V_A+V_B}{V_B} = \\frac{c(N_A+N_B)}{c N_B} = \\frac{N_A+N_B}{N_B} = \\frac{1}{x_B}\n$$\n将这些代入我们关于 $\\Delta S_{\\mathrm{mix}}$ 的表达式中：\n$$\n\\Delta S_{\\mathrm{mix}} = N_A k_B \\ln\\left(\\frac{1}{x_A}\\right) + N_B k_B \\ln\\left(\\frac{1}{x_B}\\right) = -N_A k_B \\ln(x_A) - N_B k_B \\ln(x_B)\n$$\n令 $N = N_A+N_B$，从而 $N_A=N x_A$ 和 $N_B=N x_B$，我们可以写成：\n$$\n\\Delta S_{\\mathrm{mix}} = -N x_A k_B \\ln(x_A) - N x_B k_B \\ln(x_B) = -N k_B (x_A \\ln x_A + x_B \\ln x_B)\n$$\n这证实了在指定条件下，我们从微正则计算得到的结果与著名的理想气体混合熵的统计力学公式是等价的。", "answer": "$$\n\\boxed{N_A k_B \\ln\\left(\\frac{V_A+V_B}{V_A}\\right) + N_B k_B \\ln\\left(\\frac{V_A+V_B}{V_B}\\right)}\n$$", "id": "2816785"}, {"introduction": "从微正则系综的孤立系统过渡到巨正则系综所描述的开放系统，一个关键性的新物理现象便是粒子数的涨落。本练习将引导你运用巨正则配分函数 $\\Xi$ 来分析一个与粒子库和热库接触的理想气体系统。通过推导其粒子数分布并计算粒子数涨落的方差，你将具体地掌握巨正则系综如何描述和量化开放系统中的基本统计行为 [@problem_id:2816826]。", "problem": "一个由质量为 $m$ 的粒子组成的单原子经典理想气体，与温度为 $T$、化学势为 $\\mu$ 的热库和粒子库接触，占据固定体积 $V$。请在巨正则系综 (GCE) 框架内处理该系统。仅从以下基本定义出发：\n- 将$N$粒子经典正则配分函数定义为带有吉布斯修正的相空间积分，\n- 将巨配分函数定义为按逸度加权的粒子数求和，\n推导出粒子数分布，并证明粒子数涨落是泊松分布的。然后以闭合形式计算粒子数方差 $\\langle(\\Delta N)^{2}\\rangle$。你可以符号化地定义热德布罗意波长 $\\lambda$，但除了从所述定义中可推导出的性质外，不要假定任何其他性质。\n\n将你的最终答案表示为关于 $z$、$V$ 和 $\\lambda$ 的单个闭合形式解析表达式，其中逸度 $z = \\exp(\\beta \\mu)$ 且 $\\beta = 1/(k_{B}T)$。不包含单位。不要提供不等式或方程式。最终答案必须是单个表达式。", "solution": "所述问题在科学上是合理的、适定的和客观的。它代表了统计力学中的一个标准推导，并且可以从指定的第一性原理出发进行求解。我们将着手进行推导。\n\n这个问题的基础是 $N$ 粒子经典正则配分函数 $Q_N(T,V)$，它描述了一个包含 $N$ 个不可区分、无相互作用的质量为 $m$ 的粒子，在体积 $V$ 中，逆温度为 $\\beta = 1/(k_B T)$ 的系统。其定义包含了针对不可区分性的吉布斯修正，由在 $6N$ 维相空间上的积分给出：\n$$\nQ_N(T,V) = \\frac{1}{N! h^{3N}} \\int \\prod_{i=1}^N d^3\\mathbf{q}_i d^3\\mathbf{p}_i \\, \\exp(-\\beta H(\\{\\mathbf{q}_i, \\mathbf{p}_i\\}))\n$$\n对于单原子理想气体，哈密顿量 $H$ 仅包含粒子的动能，且与它们的位置 $\\{\\mathbf{q}_i\\}$ 无关：\n$$\nH(\\{\\mathbf{p}_i\\}) = \\sum_{i=1}^N \\frac{|\\mathbf{p}_i|^2}{2m}\n$$\n由于哈密顿量的可分离性，相空间积分可以分解为对位置坐标和动量坐标的积分。对 $N$ 个粒子的空间坐标积分得到体积项：\n$$\n\\int \\prod_{i=1}^N d^3\\mathbf{q}_i = \\left(\\int_V d^3\\mathbf{q}\\right)^N = V^N\n$$\n对动量坐标的积分也分离为 $N$ 个相同的单粒子积分的乘积：\n$$\n\\int \\prod_{i=1}^N d^3\\mathbf{p}_i \\, \\exp\\left(-\\beta \\sum_{j=1}^N \\frac{|\\mathbf{p}_j|^2}{2m}\\right) = \\left[ \\int d^3\\mathbf{p} \\, \\exp\\left(-\\frac{\\beta |\\mathbf{p}|^2}{2m}\\right) \\right]^N\n$$\n单粒子动量积分是一个标准的三维高斯积分：\n$$\n\\int d^3\\mathbf{p} \\, \\exp\\left(-\\frac{\\beta |\\mathbf{p}|^2}{2m}\\right) = \\left[ \\int_{-\\infty}^{\\infty} dp \\, \\exp\\left(-\\frac{\\beta p^2}{2m}\\right) \\right]^3\n$$\n使用一维高斯积分的结果 $\\int_{-\\infty}^{\\infty} \\exp(-ax^2)dx = \\sqrt{\\pi/a}$，我们得到：\n$$\n\\int_{-\\infty}^{\\infty} dp \\, \\exp\\left(-\\frac{\\beta p^2}{2m}\\right) = \\sqrt{\\frac{2\\pi m}{\\beta}}\n$$\n这给出三维动量积分的值为 $(2\\pi m/\\beta)^{3/2}$。\n将这些结果代回 $Q_N(T,V)$ 的表达式中，我们发现：\n$$\nQ_N(T,V) = \\frac{1}{N! h^{3N}} V^N \\left(\\frac{2\\pi m}{\\beta}\\right)^{3N/2} = \\frac{1}{N!} \\left[ V \\left(\\frac{2\\pi m}{h^2 \\beta}\\right)^{3/2} \\right]^N\n$$\n我们定义热德布罗意波长 $\\lambda$ 为 $\\lambda = h\\sqrt{\\beta/(2\\pi m)}$。通过这个定义，正则配分函数获得一个紧凑的形式：\n$$\nQ_N(T,V) = \\frac{1}{N!} \\left(\\frac{V}{\\lambda^3}\\right)^N\n$$\n这是 $N$ 个经典理想气体粒子的正则配分函数。它通过 $Q_N = Q_1^N/N!$ 与单粒子配分函数 $Q_1 = V/\\lambda^3$ 相关联。\n\n现在，我们转向巨正则系综 (GCE)。巨配分函数 $\\Xi(T,V,\\mu)$ 定义为对所有可能的粒子数 $N \\in \\{0, 1, 2, ...\\}$ 的状态求和，并通过逸度 $z = \\exp(\\beta\\mu)$ 由化学势 $\\mu$ 加权：\n$$\n\\Xi(T,V,\\mu) = \\sum_{N=0}^{\\infty} z^N Q_N(T,V)\n$$\n代入我们得到的 $Q_N$ 结果，可得：\n$$\n\\Xi = \\sum_{N=0}^{\\infty} z^N \\frac{1}{N!} \\left(\\frac{V}{\\lambda^3}\\right)^N = \\sum_{N=0}^{\\infty} \\frac{1}{N!} \\left(\\frac{zV}{\\lambda^3}\\right)^N\n$$\n这个求和是指数函数 $\\exp(x) = \\sum_{k=0}^{\\infty} x^k/k!$ 的麦克劳林级数。令 $x = zV/\\lambda^3$，我们得到巨配分函数的闭合形式：\n$$\n\\Xi = \\exp\\left(\\frac{zV}{\\lambda^3}\\right)\n$$\n找到系统中含有特定粒子数 $N$ 的概率 $P(N)$ 是求和中相应项与总和 $\\Xi$ 的比值：\n$$\nP(N) = \\frac{z^N Q_N}{\\Xi} = \\frac{\\frac{1}{N!} (zV/\\lambda^3)^N}{\\exp(zV/\\lambda^3)} = \\frac{(zV/\\lambda^3)^N}{N!} \\exp\\left(-\\frac{zV}{\\lambda^3}\\right)\n$$\n这就是粒子数分布函数。为了证明它是泊松分布的，我们将其与离散随机变量 $k$ 的泊松分布标准形式 $P(k;\\alpha) = \\frac{\\alpha^k e^{-\\alpha}}{k!}$进行比较，其中 $\\alpha$ 是平均值 $\\langle k \\rangle$。我们推导出的 $P(N)$ 精确地匹配此形式，其参数 $\\alpha$ 由下式给出：\n$$\n\\alpha = \\frac{zV}{\\lambda^3}\n$$\n因此，粒子数的分布确实是泊松分布的。系统中的平均粒子数为 $\\langle N \\rangle = \\alpha = zV/\\lambda^3$。\n\n最后，我们计算粒子数的方差 $\\langle(\\Delta N)^2\\rangle$。泊松分布的一个著名性质是其方差等于其均值：\n$$\n\\langle(\\Delta N)^2\\rangle = \\langle N^2 \\rangle - \\langle N \\rangle^2 = \\langle N \\rangle\n$$\n因此，理想气体在巨正则系综中的粒子数方差为：\n$$\n\\langle(\\Delta N)^2\\rangle = \\langle N \\rangle = \\frac{zV}{\\lambda^3}\n$$\n这是从给定定义严格推导出的粒子数方差的最终闭合形式表达式。", "answer": "$$\\boxed{\\frac{zV}{\\lambda^3}}$$", "id": "2816826"}, {"introduction": "理论的生命力在于其应用，本练习旨在搭建从抽象理论到计算实践的桥梁。你将学习如何将巨正则系综的基本原理，特别是化学势 $\\mu$ 和细致平衡条件，转化为一个强大的模拟工具——巨正则蒙特卡洛（GCMC）算法。通过为硬球系统推导和实现粒子插入与删除的接收概率，你将亲身体验如何设计出能够正确对开放系统进行抽样的计算方案 [@problem_id:2816799]。", "problem": "你需要推导、实现并评估在一个具有硬壁的立方体盒子中，三维硬球系统的巨正则蒙特卡洛（GCMC）插入和删除移动的单次尝试预期接受概率。你的推导必须从第一性原理开始：即巨正则系综的定义和细致平衡条件。然后，你必须将结果特化到硬球系统，明确指出接受概率如何依赖于化学势和排除体积。对于数值评估，你将使用约化单位，以便所有输出都是无量纲的概率。\n\n背景和建模假设：\n- 考虑一个边长为 $L$ 的立方体盒子，其中包含 $N$ 个直径为 $\\sigma$ 的不重叠硬球，其位置为 $\\{\\mathbf{r}_i\\}_{i=1}^N$。硬壁意味着球心距离每个盒子壁面的距离必须至少为 $\\sigma/2$。\n- 一次提议的插入操作是在壁面可及的盒子 $V_\\mathrm{w}$（体积为 $V_\\mathrm{w} = (L - \\sigma)^3$）内均匀随机地选择一个中心；一次提议的删除操作是从现有的 $N$ 个粒子中均匀随机地选择一个。\n- 使用约化单位，其中玻尔兹曼常数乘以温度设为单位一，$k_\\mathrm{B} T = 1$，热德布罗意波长设为单位一，$\\Lambda = 1$。在这些单位中，活度为 $z = \\exp(\\mu)$，其中 $\\mu$ 是化学势。\n- 对于任何没有重叠的构型，硬球势能 $U$ 为 $0$；如果发生任何重叠，则为 $+\\infty$。\n\n你的任务：\n1) 从巨正则分布和细致平衡出发，推导硬球系统的插入和删除移动的单次尝试Metropolis接受概率。推导必须从与 $\\exp(\\beta \\mu N) \\exp(-\\beta U) / (\\Lambda^{3N} N!)$（其中 $\\beta = 1/(k_\\mathrm{B} T)$）成正比的巨正则权重开始，并且必须考虑到在 $V_\\mathrm{w}$ 中均匀插入和在 $N$ 个粒子中均匀删除的相应提议概率。然后，将其特化到硬球系统，使得插入接受概率取决于试验位置是否位于排除区域内。将自由（允许插入的）体积 $V_\\mathrm{free}$ 定义为 $V_\\mathrm{w}$ 中插入新球心不会与任何现有球重叠的子集。展示单次随机插入尝试的预期接受概率如何依赖于比率 $V_\\mathrm{free}/V_\\mathrm{w}$ 和 $\\mu$；以及删除接受概率如何依赖于 $\\mu$ 和 $N$。\n2) 对于一个现有球心周围半径为 $\\sigma$ 的排除球体互不相交且完全包含在 $V_\\mathrm{w}$ 内的构型，证明 $V_\\mathrm{free} = V_\\mathrm{w} - N \\, v_\\mathrm{excl}$ 精确成立，其中 $v_\\mathrm{excl} = \\frac{4}{3}\\pi \\sigma^3$。对于下面的所有测试用例，你可以假设这个不相交且包含的条件成立，并直接使用此表达式。\n3) 实现一个程序，为每个测试用例计算：\n   - 单次插入尝试的预期接受概率，定义为在 $V_\\mathrm{w}$ 中均匀采样的试验位置既能避免重叠又被Metropolis准则接受的概率。\n   - 单次删除尝试的接受概率，定义为对现有 $N$ 个粒子进行均匀随机选择的概率。\n   使用约化单位 $k_\\mathrm{B} T = 1$ 和 $\\Lambda = 1$，因此 $z = \\exp(\\mu)$。\n4) 测试套件。对于下面的每个案例，计算第3项中描述的两个概率：\n   - 案例 A: $L = 10$, $\\sigma = 1$, $N = 1$, 球心位于 $(5,5,5)$, $\\mu = \\ln(0.05)$。\n   - 案例 B: $L = 12$, $\\sigma = 2$, $N = 2$, 球心位于 $(3,3,3)$ 和 $(9,9,9)$, $\\mu = \\ln(0.001)$。\n   - 案例 C: $L = 8$, $\\sigma = 1$, $N = 0$, 无球心, $\\mu = \\ln(0.001)$。\n   - 案例 D: $L = 12$, $\\sigma = 2$, $N = 2$, 球心位于 $(3,3,3)$ 和 $(9,9,9)$, $\\mu = \\ln(0.01)$。\n   对于每个案例，你可以假设排除球体是不相交且被包含的，因此 $V_\\mathrm{free} = V_\\mathrm{w} - N \\, v_\\mathrm{excl}$ 是精确的。\n5) 最终输出格式。你的程序应该生成单行输出，包含一个由方括号括起来的逗号分隔列表，顺序为\n   $[\\mathrm{ins}_A,\\mathrm{del}_A,\\mathrm{ins}_B,\\mathrm{del}_B,\\mathrm{ins}_C,\\mathrm{del}_C,\\mathrm{ins}_D,\\mathrm{del}_D]$，\n   其中每个条目都是一个浮点数。由于这些是概率，数字是无量纲的，必须以默认Python格式的十进制数字打印。不应打印任何附加文本。\n\n注意：\n- 确保你计算中使用的每个中间量都是从上述基本原理中定义的；不要在没有推导的情况下依赖任何未经证实的接受公式。\n- 计算中的所有几何量必须以与 $\\sigma$ 一致的约化长度单位表示，所有概率都是无量纲的。", "solution": "该问题是流体统计力学中的一个标准练习，具有科学上的合理性、客观性和良定性。唯一解所需的所有必要参数和假设都已提供。因此，该问题是有效的。我们将着手进行推导和求解。\n\n巨正则蒙特卡洛（GCMC）移动的接受概率的推导源于细致平衡原理，也称为微观可逆性原理。该原理确保蒙特卡洛模拟能从所需统计系综中正确抽样状态。对于从状态 $o$（旧）到状态 $n$（新）的跃迁，细致平衡要求：\n$$ W(o) P(o \\to n) = W(n) P(n \\to o) $$\n其中 $W(x)$ 是状态 $x$ 的平衡概率，$P(x \\to y)$ 是跃迁概率。跃迁概率是提议概率 $\\alpha(x \\to y)$ 和接受概率 $A(x \\to y)$ 的乘积，即 $P(x \\to y) = \\alpha(x \\to y) A(x \\to y)$。这导出了Metropolis-Hastings接受准则：\n$$ A(o \\to n) = \\min\\left(1, \\frac{W(n)}{W(o)} \\frac{\\alpha(n \\to o)}{\\alpha(o \\to n)}\\right) $$\n\n在巨正则系综中，一个微观状态由粒子数 $N$ 及其位置 $\\{\\mathbf{r}_i\\}_{i=1}^N$ 定义。问题要求从巨正则权重 $W \\propto \\exp(\\beta \\mu N) \\exp(-\\beta U) / (\\Lambda^{3N} N!)$ 开始。然而，在推导GCMC接受规则时，一个微妙但关键的点是，$1/N!$ 因子是为了校正在配分函数对可分辨粒子坐标的积分中对相同构型的重复计数。单个物理上不同的微观状态（即粒子位置的无序集合）的权重与 $z^N \\exp(-\\beta U)$ 成正比，其中活度 $z = \\exp(\\beta \\mu) / \\Lambda^3$。问题指定了约化单位，其中玻尔兹曼常数乘以温度为单位一，$k_B T = 1$（因此 $\\beta=1$），热德布罗意波长为单位一，$\\Lambda = 1$。使用这些单位，活度简化为 $z = \\exp(\\mu)$。\n因此，具有 $N$ 个粒子的微观状态的平衡概率与以下成正比：\n$$ W(\\{\\mathbf{r}_i\\}, N) \\propto z^N e^{-U(\\{\\mathbf{r}_i\\})} $$\n\n我们首先推导插入移动的接受概率，这是一个从具有 $N$ 个粒子的初始状态 $o$ 到具有 $N+1$ 个粒子的新状态 $n$ 的跃迁。\n平衡概率的比值为：\n$$ \\frac{W(n)}{W(o)} = \\frac{z^{N+1} e^{-U(N+1)}}{z^N e^{-U(N)}} = z e^{-\\Delta U} $$\n其中 $\\Delta U = U(N+1) - U(N)$ 是插入新粒子后势能的变化。\n\n接下来，我们考虑提议概率的比值。\n正向移动，$o \\to n$（插入），涉及在壁面可及体积 $V_\\mathrm{w}$ 内均匀随机地为新粒子提议一个试验位置。选择特定位置的概率密度为 $\\alpha(o \\to n) = 1/V_\\mathrm{w}$。\n反向移动，$n \\to o$（删除），涉及从现有的 $N+1$ 个粒子中均匀随机地选择一个并将其移除。选择刚刚添加的特定粒子的概率为 $\\alpha(n \\to o) = 1/(N+1)$。\n\n提议概率的比值为：\n$$ \\frac{\\alpha(n \\to o)}{\\alpha(o \\to n)} = \\frac{1/(N+1)}{1/V_\\mathrm{w}} = \\frac{V_\\mathrm{w}}{N+1} $$\n结合这些比值，Metropolis接受准则中用于插入尝试的参数为：\n$$ \\frac{W(n)}{W(o)} \\frac{\\alpha(n \\to o)}{\\alpha(o \\to n)} = \\left(z e^{-\\Delta U}\\right) \\left(\\frac{V_\\mathrm{w}}{N+1}\\right) = \\frac{z V_\\mathrm{w}}{N+1} e^{-\\Delta U} $$\n特定插入试验的接受概率为：\n$$ A_{\\mathrm{ins}}(N \\to N+1) = \\min\\left(1, \\frac{z V_\\mathrm{w}}{N+1} e^{-\\Delta U}\\right) $$\n对于硬球系统，势能 $U$ 要么为 $0$（无重叠），要么为 $+\\infty$（有任何重叠）。如果试验性插入导致重叠，则 $\\Delta U = +\\infty$，且 $A_{\\mathrm{ins}} = 0$。如果插入不引起任何重叠，并且假设初始的 $N$ 粒子状态是有效的（$U(N)=0$），则 $U(N+1)=0$，因此 $\\Delta U = 0$。在这种无重叠情况下的接受概率为 $\\min\\left(1, \\frac{z V_\\mathrm{w}}{N+1}\\right)$。\n\n问题要求的是*预期*单次尝试接受概率。这需要在 $V_\\mathrm{w}$ 中所有可能的试验位置上进行平均。一次试验移动只有在新粒子被放置在“自由体积” $V_\\mathrm{free}$（即不发生重叠的区域）中，并且随后的Metropolis检查通过时才算成功。在自由体积中选择一个试验位置的概率是 $P(\\text{no overlap}) = V_\\mathrm{free} / V_\\mathrm{w}$。\n因此，预期接受概率是：\n$$ \\langle A_{\\mathrm{ins}} \\rangle = P(\\text{no overlap}) \\times A_{\\mathrm{ins}}(\\Delta U=0) + P(\\text{overlap}) \\times A_{\\mathrm{ins}}(\\Delta U=\\infty) $$\n$$ \\langle A_{\\mathrm{ins}} \\rangle = \\frac{V_\\mathrm{free}}{V_\\mathrm{w}} \\min\\left(1, \\frac{z V_\\mathrm{w}}{N+1}\\right) $$\n在给定的假设下，即排除球（半径为 $\\sigma$）互不相交且被包含在 $V_\\mathrm{w}$ 内，自由体积就是壁面可及体积减去 $N$ 个排除球体积的总和：$V_\\mathrm{free} = V_\\mathrm{w} - N v_\\mathrm{excl}$，其中 $v_\\mathrm{excl} = \\frac{4}{3}\\pi\\sigma^3$。\n\n现在我们推导删除移动的接受概率，这是一个从具有 $N$ 个粒子的状态到具有 $N-1$ 个粒子的状态的跃迁。此移动是向一个包含 $N-1$ 个粒子的系统中进行插入的逆过程。删除的接受规则 $A_{\\mathrm{del}}(N \\to N-1)$ 可以通过细致平衡从插入规则 $A_{\\mathrm{ins}}(N-1 \\to N)$ 中得到：\n$$ A_{\\mathrm{del}}(N \\to N-1) = \\min\\left(1, \\left[ \\frac{z V_\\mathrm{w}}{N} e^{-\\Delta U_{ins}} \\right]^{-1} \\right) = \\min\\left(1, \\frac{N}{z V_\\mathrm{w}} e^{\\Delta U_{ins}}\\right) $$\n这里 $\\Delta U_{ins}$ 是逆向移动的能量变化，即把粒子插回 $N-1$ 粒子系统。由于我们从一个有效的 $N$ 粒子状态开始，被删除的粒子处于一个有效位置。因此，将其重新插入相同位置不会导致能量变化，即 $\\Delta U_{ins} = U(N) - U(N-1) = 0$。因此，删除接受概率是：\n$$ A_{\\mathrm{del}} = \\min\\left(1, \\frac{N}{z V_\\mathrm{w}}\\right) $$\n只要初始状态是有效的，这个概率不依赖于选择哪个特定粒子进行删除。如果 $N=0$，删除的概率正确地为 $0$。\n\n有了这些推导出的公式，我们就可以为给定的测试用例计算所需的概率。\n\n案例 A: $L = 10$, $\\sigma = 1$, $N = 1$, $\\mu = \\ln(0.05)$。\n$z=0.05$, $V_\\mathrm{w}=(10-1)^3=729$, $v_\\mathrm{excl}=\\frac{4}{3}\\pi(1)^3$, $V_\\mathrm{free}=729-\\frac{4}{3}\\pi$。\n$\\langle A_{\\mathrm{ins}} \\rangle = \\frac{729 - 4\\pi/3}{729} \\min\\left(1, \\frac{0.05 \\times 729}{1+1}\\right) = \\left(1-\\frac{4\\pi}{2187}\\right) \\times \\min(1, 18.225) \\approx 0.99426$。\n$A_{\\mathrm{del}} = \\min\\left(1, \\frac{1}{0.05 \\times 729}\\right) = \\min(1, 0.02743) \\approx 0.02743$。\n\n案例 B: $L = 12$, $\\sigma = 2$, $N = 2$, $\\mu = \\ln(0.001)$。\n$z=0.001$, $V_\\mathrm{w}=(12-2)^3=1000$, $v_\\mathrm{excl}=\\frac{4}{3}\\pi(2)^3=\\frac{32\\pi}{3}$, $V_\\mathrm{free}=1000-2\\frac{32\\pi}{3}=1000-\\frac{64\\pi}{3}$。\n$\\langle A_{\\mathrm{ins}} \\rangle = \\frac{1000 - 64\\pi/3}{1000} \\min\\left(1, \\frac{0.001 \\times 1000}{2+1}\\right) = \\left(1-\\frac{64\\pi}{3000}\\right) \\times \\min(1, 1/3) \\approx 0.31099$。\n$A_{\\mathrm{del}} = \\min\\left(1, \\frac{2}{0.001 \\times 1000}\\right) = \\min(1, 2) = 1$。\n\n案例 C: $L = 8$, $\\sigma = 1$, $N = 0$, $\\mu = \\ln(0.001)$。\n$z=0.001$, $V_\\mathrm{w}=(8-1)^3=343$, $N=0 \\implies V_\\mathrm{free}=V_\\mathrm{w}$。\n$\\langle A_{\\mathrm{ins}} \\rangle = \\frac{343}{343} \\min\\left(1, \\frac{0.001 \\times 343}{0+1}\\right) = \\min(1, 0.343) = 0.343$。\n$A_{\\mathrm{del}} = \\min\\left(1, \\frac{0}{0.001 \\times 343}\\right) = 0$。\n\n案例 D: $L = 12$, $\\sigma = 2$, $N = 2$, $\\mu = \\ln(0.01)$。\n$z=0.01$, $V_\\mathrm{w}=1000$, $V_\\mathrm{free}=1000-\\frac{64\\pi}{3}$。\n$\\langle A_{\\mathrm{ins}} \\rangle = \\frac{1000 - 64\\pi/3}{1000} \\min\\left(1, \\frac{0.01 \\times 1000}{2+1}\\right) = \\left(1-\\frac{64\\pi}{3000}\\right) \\times \\min(1, 10/3) \\approx 0.93298$。\n$A_{\\mathrm{del}} = \\min\\left(1, \\frac{2}{0.01 \\times 1000}\\right) = \\min(1, 0.2) = 0.2$。\n以下程序实现了这些计算。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes GCMC acceptance probabilities for hard spheres based on derived formulas.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: L=10, sigma=1, N=1, centers at (5,5,5), mu=ln(0.05)\n        {'L': 10.0, 'sigma': 1.0, 'N': 1, 'mu': np.log(0.05)},\n        # Case B: L=12, sigma=2, N=2, centers at (3,3,3) and (9,9,9), mu=ln(0.001)\n        {'L': 12.0, 'sigma': 2.0, 'N': 2, 'mu': np.log(0.001)},\n        # Case C: L=8, sigma=1, N=0, no centers, mu=ln(0.001)\n        {'L': 8.0, 'sigma': 1.0, 'N': 0, 'mu': np.log(0.001)},\n        # Case D: L=12, sigma=2, N=2, centers at (3,3,3) and (9,9,9), mu=ln(0.01)\n        {'L': 12.0, 'sigma': 2.0, 'N': 2, 'mu': np.log(0.01)},\n    ]\n\n    results = []\n    for case in test_cases:\n        L = case['L']\n        sigma = case['sigma']\n        N = case['N']\n        mu = case['mu']\n\n        # In reduced units k_B*T = 1 and Lambda = 1, the activity z = exp(mu).\n        z = np.exp(mu)\n\n        # The wall-accessible volume for sphere centers.\n        V_w = (L - sigma)**3\n\n        # The excluded volume created by a single sphere for the center of another.\n        # This is the volume of a sphere of radius sigma, not sigma/2.\n        v_excl = (4.0 / 3.0) * np.pi * sigma**3\n\n        # The free volume is the portion of V_w where a new particle center\n        # can be placed without overlapping existing spheres. The problem states\n        # to assume exclusion spheres are disjoint and contained.\n        V_free = V_w - N * v_excl\n        \n        # --- 1. Expected acceptance probability for an insertion attempt (N -> N+1) ---\n        \n        # The probability of proposing a valid move (no overlap) by picking a random\n        # position in V_w. If V_free is negative (high density), probability is 0.\n        prob_no_overlap = max(0.0, V_free / V_w)\n        \n        # The Metropolis acceptance probability, given that the trial move causes no overlap (Delta_U = 0).\n        # This is for a transition from N to N+1 particles.\n        arg_ins = (z * V_w) / (N + 1)\n        prob_accept_if_no_overlap = min(1.0, arg_ins)\n        \n        # The total expected acceptance probability is the product of finding a\n        # valid spot and that spot being accepted by the Metropolis criterion.\n        expected_ins_prob = prob_no_overlap * prob_accept_if_no_overlap\n        results.append(expected_ins_prob)\n\n        # --- 2. Acceptance probability for a deletion attempt (N -> N-1) ---\n\n        if N == 0:\n            # A deletion move is not possible if there are no particles.\n            del_prob = 0.0\n        else:\n            # The Metropolis acceptance probability for deleting a particle.\n            # This is for a transition from N to N-1 particles.\n            arg_del = N / (z * V_w)\n            del_prob = min(1.0, arg_del)\n        results.append(del_prob)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2816799"}]}