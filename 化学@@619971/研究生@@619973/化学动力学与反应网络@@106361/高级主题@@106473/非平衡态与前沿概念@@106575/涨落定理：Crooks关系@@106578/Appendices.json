{"hands_on_practices": [{"introduction": "理论的优雅之处通常在可解模型中得到最清晰的体现。本练习提供了一个从第一性原理出发，为谐振子势中的过阻尼粒子这一经典模型推导 Crooks 关系的机会。通过解析计算正向和反向过程的功分布，你将亲手验证该定理的数学结构，并加深对非平衡功与平衡自由能之间深刻联系的理解。", "problem": "考虑一个单一反应坐标 $x$，它在固定温度 $T$ 下的一维谐振势 $U(x,t)=\\frac{1}{2}k(t)x^{2}$ 中演化，如同一个Ornstein–Uhlenbeck过程。其动力学由过阻尼Langevin方程 $\\gamma\\,\\dot{x}(t)=-k(t)\\,x(t)+\\xi(t)$ 支配，其中 $\\gamma$ 是摩擦系数，$\\xi(t)$ 是高斯白噪声，满足 $\\langle \\xi(t)\\rangle=0$ 和 $\\langle \\xi(t)\\xi(t')\\rangle=2\\gamma k_{B}T\\,\\delta(t-t')$, 而 $k_{B}$ 是Boltzmann常数。系统初始在刚度为 $k_{i}>0$ 的谐振势阱中达到平衡，因此 $x$ 遵循逆温度 $\\beta=1/(k_{B}T)$ 下的正则系综平衡分布。在时刻 $t=0$，势阱刚度被瞬间淬火至 $k_{f}>k_{i}$（一个正向协议）。对于瞬时淬火，对系统做的随机功 $W$ 等于淬火瞬间势能的变化量，即 $W=\\Delta U=\\frac{1}{2}\\left(k_{f}-k_{i}\\right)x_{0}^{2}$，其中 $x_{0}$ 是淬火前的坐标。\n\n定义逆向协议为时间反演的过程，该过程从刚度为 $k_{f}$ 的势阱中、在相同温度 $T$ 下的平衡态开始，并瞬间淬火至 $k_{i}$，产生随机功 $W_{R}=\\frac{1}{2}\\left(k_{i}-k_{f}\\right)x_{0}'^{2}$。\n\n仅使用平衡统计力学和随机能量学的基本定义，完成以下步骤：\n\n1. 推导正向协议下功 $W$ 的概率密度 $P_{F}(W)$，以 $W$, $\\beta$, $k_{i}$, 和 $k_{f}$ 的闭合解析形式表示。\n2. 推导逆向协议下产生功的负值的相应密度 $P_{R}(-W)$。\n3. 根据正则配分函数，计算刚度分别为 $k_{f}$ 和 $k_{i}$ 的谐振势阱之间的平衡自由能差 $\\Delta F=F_{f}-F_{i}$。\n4. 确定比率 $P_{F}(W)/P_{R}(-W)$ 的显式表达式，并在连接非平衡过程中功与自由能的涨落关系的背景下解释你的结果。\n\n将你的最终答案表示为 $P_{F}(W)$ 关于 $W$ 和模型参数的显式公式。无需进行数值计算，也无需四舍五入。假设 $k_{f}>k_{i}$，因此在正向淬火下 $W\\ge 0$。所有结果均以符号表示；最终答案中不要包含单位。", "solution": "我们从一维谐振势的正则系综平衡分布开始。对于逆温度 $\\beta=1/(k_{B}T)$ 下刚度为 $k>0$ 的情况，$x$ 的平衡密度为\n$$\np_{\\text{eq}}^{(k)}(x)=\\sqrt{\\frac{\\beta k}{2\\pi}}\\exp\\!\\left(-\\frac{1}{2}\\beta k x^{2}\\right).\n$$\n因此，在正向协议下，$x_{0}$ 服从均值为 $0$、方差为 $\\sigma_{i}^{2}=\\langle x_{0}^{2}\\rangle=\\frac{1}{\\beta k_{i}}$ 的高斯分布。\n\n由于淬火是瞬时的，随机功由参数变化时固定状态 $x_{0}$ 下的哈密顿量变化定义：\n$$\nW=\\Delta U=\\frac{1}{2}\\left(k_{f}-k_{i}\\right)x_{0}^{2}.\n$$\n令 $\\Delta k\\equiv k_{f}-k_{i}>0$。那么 $W=\\frac{\\Delta k}{2}\\,x_{0}^{2}\\ge 0$。为了得到 $W$ 的分布，我们需要高斯变量 $x_{0}^{2}$ 的分布。如果 $X\\sim \\mathcal{N}(0,\\sigma^{2})$，那么 $Y\\equiv X^{2}$ 的密度为\n$$\nf_{Y}(y)=\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,y^{-1/2}\\exp\\!\\left(-\\frac{y}{2\\sigma^{2}}\\right),\\quad y\\ge 0.\n$$\n在我们的例子中，$\\sigma=\\sigma_{i}=\\sqrt{\\frac{1}{\\beta k_{i}}}$ 且 $Y=x_{0}^{2}$。根据 $W=\\frac{\\Delta k}{2}\\,Y$ 和变量替换公式，对于 $w\\ge 0$ 有，\n$$\nP_{F}(w)=\\frac{1}{a}\\,f_{Y}\\!\\left(\\frac{w}{a}\\right),\\quad a\\equiv \\frac{\\Delta k}{2}.\n$$\n代入表达式，\n$$\nP_{F}(w)=\\frac{1}{\\sqrt{2\\pi}\\,\\sigma_{i}}\\,a^{-1}\\left(\\frac{w}{a}\\right)^{-1/2}\\exp\\!\\left[-\\frac{1}{2\\sigma_{i}^{2}}\\left(\\frac{w}{a}\\right)\\right].\n$$\n化简得，\n$$\nP_{F}(w)=\\frac{1}{\\sqrt{2\\pi}\\,\\sigma_{i}}\\,a^{-1/2}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{w}{2a\\sigma_{i}^{2}}\\right).\n$$\n使用 $a=\\frac{\\Delta k}{2}$ 和 $\\sigma_{i}^{2}=\\frac{1}{\\beta k_{i}}$，我们得到\n$$\nP_{F}(w)=\\frac{1}{\\sqrt{\\pi}\\,\\sigma_{i}\\sqrt{\\Delta k}}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{w}{\\Delta k\\,\\sigma_{i}^{2}}\\right)\n=\\sqrt{\\frac{\\beta k_{i}}{\\pi\\,\\Delta k}}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{\\beta k_{i}}{\\Delta k}\\,w\\right),\\quad w\\ge 0.\n$$\n\n对于逆向协议，$x_{0}'$ 从刚度为 $k_{f}$ 的平衡态中抽取，即一个方差为 $\\sigma_{f}^{2}=\\frac{1}{\\beta k_{f}}$ 的高斯分布。逆向功为\n$$\nW_{R}=\\frac{1}{2}(k_{i}-k_{f})\\,x_{0}'^{2}=-\\frac{\\Delta k}{2}\\,x_{0}'^{2}\\le 0,\n$$\n于是 $-W_{R}=\\frac{\\Delta k}{2}\\,x_{0}'^{2}\\ge 0$。用 $\\sigma_{f}$ 重复同样的变量替换，我们发现\n$$\nP_{R}(-w)=\\sqrt{\\frac{\\beta k_{f}}{\\pi\\,\\Delta k}}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{\\beta k_{f}}{\\Delta k}\\,w\\right),\\quad w\\ge 0.\n$$\n\n接下来，我们根据正则配分函数计算两个谐振势阱之间的平衡自由能差。一维谐振势 $U(x)=\\frac{1}{2}k x^{2}$ 的配分函数是\n$$\nZ(k)=\\int_{-\\infty}^{\\infty}\\mathrm{d}x\\,\\exp\\!\\left(-\\beta \\frac{1}{2}k x^{2}\\right)=\\sqrt{\\frac{2\\pi}{\\beta k}}.\n$$\n因此，Helmholtz自由能 $F(k)$ 是\n$$\nF(k)=-\\beta^{-1}\\ln Z(k)=-\\beta^{-1}\\left[\\frac{1}{2}\\ln\\!\\left(\\frac{2\\pi}{\\beta k}\\right)\\right],\n$$\n自由能差为\n$$\n\\Delta F\\equiv F_{f}-F_{i}=-\\beta^{-1}\\left[\\frac{1}{2}\\ln\\!\\left(\\frac{2\\pi}{\\beta k_{f}}\\right)-\\frac{1}{2}\\ln\\!\\left(\\frac{2\\pi}{\\beta k_{i}}\\right)\\right]\n=\\frac{1}{2\\beta}\\ln\\!\\left(\\frac{k_{f}}{k_{i}}\\right).\n$$\n\n最后，我们计算比率 $P_{F}(w)/P_{R}(-w)$：\n$$\n\\frac{P_{F}(w)}{P_{R}(-w)}=\\frac{\\sqrt{\\frac{\\beta k_{i}}{\\pi\\,\\Delta k}}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{\\beta k_{i}}{\\Delta k}\\,w\\right)}{\\sqrt{\\frac{\\beta k_{f}}{\\pi\\,\\Delta k}}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{\\beta k_{f}}{\\Delta k}\\,w\\right)}\n=\\sqrt{\\frac{k_{i}}{k_{f}}}\\,\\exp\\!\\left(\\frac{\\beta (k_{f}-k_{i})}{\\Delta k}\\,w\\right).\n$$\n因为 $\\Delta k=k_{f}-k_{i}$，这可以化简为\n$$\n\\frac{P_{F}(w)}{P_{R}(-w)}=\\sqrt{\\frac{k_{i}}{k_{f}}}\\,\\exp\\!\\left(\\beta w\\right).\n$$\n使用 $\\beta\\Delta F=\\frac{1}{2}\\ln\\!\\left(\\frac{k_{f}}{k_{i}}\\right)$，我们可以重写\n$$\n\\sqrt{\\frac{k_{i}}{k_{f}}}=\\exp\\!\\left(-\\frac{1}{2}\\ln\\!\\frac{k_{f}}{k_{i}}\\right)=\\exp\\!\\left(-\\beta\\Delta F\\right),\n$$\n所以\n$$\n\\frac{P_{F}(w)}{P_{R}(-w)}=\\exp\\!\\left[\\beta w-\\beta\\Delta F\\right].\n$$\n这恰好是Crooks涨落定理 (CFT) 所预测的结构，该定理指出，正向功分布与在负功值处求值的逆向功分布之比，是耗散功的指数，即功减去平衡自由能差。\n\n因此，对于瞬时刚度淬火，正向功分布的闭合形式表达式为\n$$\nP_{F}(w)=\\sqrt{\\frac{\\beta k_{i}}{\\pi\\,\\Delta k}}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{\\beta k_{i}}{\\Delta k}\\,w\\right),\\quad w\\ge 0,\\quad \\Delta k=k_{f}-k_{i}>0.\n$$\n这个分布，连同其逆向对应项和计算出的 $\\Delta F$，在一个谐振反应坐标模型中，为该非平衡协议解析地验证了Crooks涨落定理。", "answer": "$$\\boxed{\\sqrt{\\frac{\\beta k_{i}}{\\pi\\left(k_{f}-k_{i}\\right)}}\\,W^{-1/2}\\,\\exp\\!\\left(-\\frac{\\beta k_{i}}{k_{f}-k_{i}}\\,W\\right)}$$", "id": "2644011"}, {"introduction": "在更复杂的、无法解析求解的系统中，数值模拟成为检验理论预测的强大工具。本练习将指导你为一个受外部协议驱动的简单两态化学反应网络建立随机模拟，以数值方式检验 Crooks 关系。完成此练习将使你掌握模拟非平衡过程和处理随机轨迹数据的核心计算技能，这是现代化学动力学研究的基础。", "problem": "考虑一个由物种 $A$ 和 $B$ 组成的双态化学反应网络 (CRN)，两者通过单一可逆反应 $A \\rightleftharpoons B$ 相连。该系统被建模为连续时间马尔可夫跳跃过程 (CTMC)。状态 $A$ 的能量为 $E_A(t) \\equiv 0$，状态 $B$ 的能量为 $E_B(t) \\equiv \\Delta E(t)$，其中外部控制的能量差 $\\Delta E(t)$ 在有限时间区间 $t \\in [0, \\tau]$ 内根据预设协议进行变化。逆热能用 $\\beta \\equiv 1/(k_\\mathrm{B} T)$ 表示，其中 $k_\\mathrm{B}$ 是玻尔兹曼常数，$T$ 是温度。在全文中，使用无量纲单位，其中能量以 $k_\\mathrm{B} T$ 为单位进行测量，时间以如下指定的 $1/k_0$ 为单位；无需进行物理单位转换。\n\n假设局域细致平衡始终成立：瞬时跃迁速率 $k_{A \\to B}(t)$ 和 $k_{B \\to A}(t)$ 满足\n$$\n\\frac{k_{A \\to B}(t)}{k_{B \\to A}(t)} \\;=\\; e^{-\\beta \\, \\Delta E(t)} \\, .\n$$\n固定对称的类阿伦尼乌斯参数化\n$$\nk_{A \\to B}(t) \\equiv k_0 \\, e^{-\\frac{\\beta}{2} \\Delta E(t)} \\quad \\text{和} \\quad\nk_{B \\to A}(t) \\equiv k_0 \\, e^{+\\frac{\\beta}{2} \\Delta E(t)} \\, ,\n$$\n其中 $k_0 > 0$ 是一个恒定速率标度。\n\n对于在时间 $t \\in [0,\\tau]$ 内、随时间变化的协议 $\\Delta E(t)$ 下的给定轨迹 $x(t) \\in \\{A,B\\}$，将协议所做的随机功定义为黎曼–斯蒂尔切斯积分\n$$\nW[x(\\cdot)] \\;=\\; \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} \\, d\\Delta E(t) \\, ,\n$$\n其中 $\\mathbf{1}_{\\{x(t)=B\\}}$ 是系统在时间 $t$ 占据状态 $B$ 的指示函数。在参数值为 $\\Delta E$ 时的平衡自由能为\n$$\nF(\\Delta E) \\;=\\; -\\frac{1}{\\beta} \\ln\\!\\big( 1 + e^{-\\beta \\Delta E} \\big) \\, ,\n$$\n且从 $\\Delta E(0)=\\Delta E_i$ 到 $\\Delta E(\\tau)=\\Delta E_f$ 的整个协议过程中的自由能差为 $\\Delta F \\equiv F(\\Delta E_f) - F(\\Delta E_i)$。\n\n您将数值地检验功的 Crooks 涨落定理，该定理指出，对于一个正向协议 $\\Delta E_F(t)$ 及其时间反演的逆向协议 $\\Delta E_R(t) \\equiv \\Delta E_F(\\tau - t)$（其初始系综分别从 $\\Delta E_i$ 和 $\\Delta E_f$ 处的相应平衡态中抽取），功的分布 $P_F(W)$ 和 $P_R(W)$ 满足\n$$\n\\frac{P_F(W)}{P_R(-W)} \\;=\\; e^{\\beta \\, (W - \\Delta F)} \\, .\n$$\n\n实现一个程序，该程序：\n- 使用时间非齐次跳跃过程的精确采样，为正向和逆向协议模拟一个独立轨迹的系综。对于正向协议，使用线性斜坡\n$$\n\\Delta E_F(t) \\;=\\; \\Delta E_i + \\frac{\\Delta E_f - \\Delta E_i}{\\tau} \\, t \\, ,\n$$\n对于逆向协议，使用时间反演的线性斜坡\n$$\n\\Delta E_R(t) \\;=\\; \\Delta E_f - \\frac{\\Delta E_f - \\Delta E_i}{\\tau} \\, t \\, .\n$$\n- 从协议起始参数值处的正则平衡态中为每条轨迹抽取初始状态。即，在参数 $\\Delta E$ 下，平衡概率为 $p_A^{\\mathrm{eq}}(\\Delta E) = \\frac{1}{1+e^{-\\beta \\Delta E}}$ 和 $p_B^{\\mathrm{eq}}(\\Delta E) = \\frac{e^{-\\beta \\Delta E}}{1+e^{-\\beta \\Delta E}}$。\n- 使用上述积分定义，计算沿每条轨迹所做的功 $W$。\n- 通过在覆盖正向功样本和符号翻转的逆向功样本的公共范围内使用固定数量的区间（箱）$n_b$ 的直方图，来估计功分布 $P_F(W)$ 和 $P_R(W)$。使用 $n_b = 60$。根据合并数据 $\\{W_F\\} \\cup \\{-W_R\\}$ 的最小值和最大值构建公共范围。如果该范围的宽度可忽略不计（例如，所有采样功在数值上重合），则将其扩展到围绕零的一个小的对称区间，以避免退化直方图。\n- 仅在两个直方图都严格为正的区间上，将经验对数比 $\\ln\\!\\big( P_F(W) / P_R(-W) \\big)$ 与理论预测 $\\beta (W - \\Delta F)$ 进行比较，并报告这些区间上的最大绝对偏差是否低于预设容差 $\\varepsilon$。\n\n为保证可复现性，使用固定的随机种子。将种子设置为 $12345$。\n\n您的程序必须为此驱动双态过程实现事件时间的精确采样。对于上述线性协议，每个状态的总出射率是时间的指数函数，这允许对非齐次等待时间分布进行精确反演。您不得采用任何时间离散化近似。\n\n测试套件：\n模拟以下三种情况，并对每种情况返回一个布尔值，指示 Crooks 关系是否在指定的容差内成立。对所有情况使用相同的直方图设置 $(n_b = 60)$ 和相同的偏差容差 $\\varepsilon = 0.35$。\n\n- 情况 1 (理想情况，中等速度):\n  - $\\beta = 1.0$, $k_0 = 1.0$, $\\Delta E_i = 0.0$, $\\Delta E_f = 4.0$, $\\tau = 8.0$, 正向和逆向的轨迹数 $N = 20000$。\n\n- 情况 2 (快速驱动):\n  - $\\beta = 1.0$, $k_0 = 1.0$, $\\Delta E_i = 0.0$, $\\Delta E_f = 4.0$, $\\tau = 0.5$, 正向和逆向的轨迹数 $N = 20000$。\n\n- 情况 3 (边界情况，参数无变化):\n  - $\\beta = 1.0$, $k_0 = 1.0$, $\\Delta E_i = 1.0$, $\\Delta E_f = 1.0$, $\\tau = 3.0$, 正向和逆向的轨迹数 $N = 20000$。\n\n答案规格：\n- 对每种情况，计算一个布尔值，指示最大绝对偏差\n$$\n\\max_{\\text{重叠区间}} \\left| \\ln\\!\\frac{P_F(W)}{P_R(-W)} - \\beta \\, (W - \\Delta F) \\right|\n$$\n是否不超过 $\\varepsilon = 0.35$。如果没有具有严格为正的密度的重叠区间，则对该情况返回布尔值 $False$。\n- 最终输出必须是单行，包含三个布尔结果，格式为方括号括起来的逗号分隔列表 (例如, \"[True,False,True]\")。\n\n您的程序必须是完整且可直接运行的，不得要求任何输入，并且必须遵守上面给出的种子、直方图和容差规格。所有量都应以指定的无量纲单位报告；不需要物理单位。", "solution": "所述问题已经过验证，并被认定是有效的。它提出了一个在非平衡统计力学领域中定义明确、有科学依据的问题，具体是针对一个驱动双态系统对 Crooks 涨落定理进行数值验证。所有参数、定义和约束均已提供，构成了一个自洽且可解的问题。核心任务涉及对一个时间非齐次马尔可夫跳跃过程进行精确的随机模拟，这是计算物理学中一个标准但并非无足轻重的程序。\n\n一个双态系统经历反应 $A \\rightleftharpoons B$。能量分别为 $E_A = 0$ 和 $E_B = \\Delta E(t)$。跃迁速率由对称参数化给出：\n$$\nk_{A \\to B}(t) = k_0 \\, e^{-\\frac{\\beta}{2} \\Delta E(t)} \\quad \\text{和} \\quad\nk_{B \\to A}(t) = k_0 \\, e^{+\\frac{\\beta}{2} \\Delta E(t)}\n$$\n这些速率满足局域细致平衡条件 $\\frac{k_{A \\to B}(t)}{k_{B \\to A}(t)} = e^{-\\beta \\Delta E(t)}$。外部参数 $\\Delta E(t)$ 随时间线性驱动，$\\Delta E(t) = \\Delta E_{start} + v t$，其中速率 $v = (\\Delta E_{end} - \\Delta E_{start}) / \\tau$。\n\n模拟的核心是为这个时间非齐次过程生成跳跃时间。如果系统在时间 $t_0$ 处于状态 $X$，那么在没有发生跳跃的情况下存活到时间 $t$ 的概率是 $P(t) = \\exp\\left(-\\int_{t_0}^t k_{exit}(s) ds\\right)$，其中 $k_{exit}(s)$ 是在时间 $s$ 从状态 $X$ 的出射率。下一个跳跃时间 $t_{jump}$ 可以通过求解方程 $\\int_{t_0}^{t_{jump}} k_{exit}(s) ds = R$ 来采样，其中 $R$ 是从速率为 $1$ 的指数分布中抽取的随机变量。\n\n对于给定的线性协议，出射率的形式为 $k_{exit}(t) = C e^{\\alpha t}$，其中常数 $C$ 和 $\\alpha$ 取决于状态。\n如果状态是 $A$，出射率是 $k_{A \\to B}(t)$。那么：\n$$\n\\alpha_A = -\\frac{\\beta v}{2} \\quad \\text{和} \\quad C_A = k_0 \\, e^{-\\frac{\\beta}{2} \\Delta E_{start}}\n$$\n如果状态是 $B$，出射率是 $k_{B \\to A}(t)$。那么：\n$$\n\\alpha_B = +\\frac{\\beta v}{2} \\quad \\text{和} \\quad C_B = k_0 \\, e^{+\\frac{\\beta}{2} \\Delta E_{start}}\n$$\n对于非平凡情况 $v \\neq 0$（因此 $\\alpha \\neq 0$），该积分是可解析处理的：\n$$\n\\int_{t_0}^{t_0 + \\Delta t} C e^{\\alpha s} ds \\;=\\; \\frac{C}{\\alpha} \\left[ e^{\\alpha(t_0+\\Delta t)} - e^{\\alpha t_0} \\right] \\;=\\; \\frac{C e^{\\alpha t_0}}{\\alpha} \\left( e^{\\alpha \\Delta t} - 1 \\right) \\;=\\; \\frac{k_{exit}(t_0)}{\\alpha} \\left( e^{\\alpha \\Delta t} - 1 \\right)\n$$\n将此式设为等于 $R$ 并求解等待时间 $\\Delta t$ 可得：\n$$\n\\Delta t = \\frac{1}{\\alpha} \\ln\\left(1 + \\frac{\\alpha R}{k_{exit}(t_0)}\\right)\n$$\n该公式在对数的参数为正时有效。如果 $1 + \\frac{\\alpha R}{k_{exit}(t_0)} \\le 0$（这只可能在 $\\alpha < 0$ 时发生），则意味着从 $t_0$ 到无穷大的总积分速率收敛到一个小于 $R$ 的值，即不会发生跳跃。在这种情况下，我们设置 $\\Delta t = \\infty$。此方法提供了等待时间的精确样本。对于 $v=0$（因此 $\\alpha=0$）的特殊情况，速率是恒定的，等待时间就是 $\\Delta t = R / k_{exit}$。\n\n对于线性协议 $\\Delta E(t)$，随机功的计算大大简化。黎曼-斯蒂尔切斯积分为：\n$$\nW = \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} \\, d\\Delta E(t) = \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} \\frac{d\\Delta E}{dt} dt = v \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} dt\n$$\n因此，功是协议速率 $v$ 与系统在状态 $B$ 中所花费的总时间的乘积。这将计算简化为对系统处于状态 $B$ 的所有时间间隔的持续时间求和。\n\nCrooks 关系 $\\frac{P_F(W)}{P_R(-W)} = e^{\\beta (W - \\Delta F)}$ 的验证是数值进行的。为正向协议 ($\\Delta E_i \\to \\Delta E_f$) 和逆向协议 ($\\Delta E_f \\to \\Delta E_i$) 生成轨迹系综，分别从它们各自的初始平衡分布开始。为每条轨迹计算功值 $W_F$ 和 $W_R$。\n\n概率分布 $P_F(W)$ 和 $P_R(W)$ 使用直方图进行估计。在合并数据 $\\{W_F\\} \\cup \\{-W_R\\}$ 的范围内构建一组公共的区间（箱）。逆向过程的直方图是为符号翻转的功值 $-W_R$ 计算的。归一化的直方图提供了在区间中心 $W_k$ 处对 $P_F(W)$ 和 $P_R(-W)$ 的经验估计。\n\n自由能差计算为 $\\Delta F = F(\\Delta E_f) - F(\\Delta E_i)$，其中自由能由 $F(\\Delta E) = -\\frac{1}{\\beta} \\ln(1 + e^{-\\beta \\Delta E})$ 给出。对于每个 $P_F(W_k)$ 和 $P_R(-W_k)$ 都严格为正的区间 $k$，计算偏差：\n$$\nd_k = \\left| \\ln\\left(\\frac{P_F(W_k)}{P_R(-W_k)}\\right) - \\beta (W_k - \\Delta F) \\right|\n$$\n将这些偏差的最大值 $\\max_k d_k$ 与容差 $\\varepsilon=0.35$ 进行比较。如果该最大偏差在容差范围内，则认为该定理在该情况下得到了数值验证。如果两个分布之间没有显示重叠的区间，则验证失败。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the Crooks fluctuation theorem.\n    \"\"\"\n    # Fixed parameters for all test cases\n    N_TRAJECTORIES = 20000\n    N_BINS = 60\n    TOLERANCE = 0.35\n    RANDOM_SEED = 12345\n\n    # Test suite from the problem statement\n    test_cases = [\n        # Case 1 (happy path, moderate speed)\n        {'beta': 1.0, 'k0': 1.0, 'delta_E_i': 0.0, 'delta_E_f': 4.0, 'tau': 8.0},\n        # Case 2 (fast driving)\n        {'beta': 1.0, 'k0': 1.0, 'delta_E_i': 0.0, 'delta_E_f': 4.0, 'tau': 0.5},\n        # Case 3 (boundary case, no change in parameter)\n        {'beta': 1.0, 'k0': 1.0, 'delta_E_i': 1.0, 'delta_E_f': 1.0, 'tau': 3.0},\n    ]\n\n    rng = np.random.default_rng(RANDOM_SEED)\n    results = []\n\n    for case in test_cases:\n        # Run forward and reverse simulations\n        W_F = _simulate_protocol(params=case, is_forward=True, n_traj=N_TRAJECTORIES, rng=rng)\n        W_R = _simulate_protocol(params=case, is_forward=False, n_traj=N_TRAJECTORIES, rng=rng)\n\n        # Prepare data for histogramming\n        neg_W_R = -np.array(W_R)\n        \n        # Determine common histogram range\n        combined_works = np.concatenate((W_F, neg_W_R))\n        w_min, w_max = combined_works.min(), combined_works.max()\n        \n        if w_max - w_min  1e-9:\n             w_min, w_max = -1.0, 1.0\n        else: # Add padding to avoid issues at edges\n            padding = 0.01 * (w_max-w_min) if (w_max-w_min) > 0 else 0.1\n            w_min -= padding\n            w_max += padding\n\n        bins = np.linspace(w_min, w_max, N_BINS + 1)\n        bin_centers = (bins[:-1] + bins[1:]) / 2.0\n\n        # Create normalized histograms (probability densities)\n        P_F, _ = np.histogram(W_F, bins=bins, density=True)\n        P_R_neg, _ = np.histogram(neg_W_R, bins=bins, density=True)\n\n        # Calculate free energy difference\n        beta = case['beta']\n        delta_E_i = case['delta_E_i']\n        delta_E_f = case['delta_E_f']\n        \n        def free_energy(E, b):\n            return -1.0 / b * np.log(1.0 + np.exp(-b * E))\n            \n        delta_F = free_energy(delta_E_f, beta) - free_energy(delta_E_i, beta)\n\n        # Check Crooks relation\n        max_deviation = 0.0\n        found_overlap = False\n        \n        for i in range(N_BINS):\n            if P_F[i] > 0 and P_R_neg[i] > 0:\n                found_overlap = True\n                W_k = bin_centers[i]\n                \n                log_ratio_empirical = np.log(P_F[i] / P_R_neg[i])\n                log_ratio_theoretical = beta * (W_k - delta_F)\n                \n                deviation = np.abs(log_ratio_empirical - log_ratio_theoretical)\n                if deviation > max_deviation:\n                    max_deviation = deviation\n        \n        if not found_overlap:\n            results.append(False)\n        else:\n            results.append(max_deviation = TOLERANCE)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef _simulate_protocol(params, is_forward, n_traj, rng):\n    \"\"\"\n    Simulates trajectories for a given protocol (forward or reverse).\n    \"\"\"\n    beta, k0, tau = params['beta'], params['k0'], params['tau']\n\n    if is_forward:\n        E_start, E_end = params['delta_E_i'], params['delta_E_f']\n    else: # Reverse protocol\n        E_start, E_end = params['delta_E_f'], params['delta_E_i']\n\n    v = (E_end - E_start) / tau if tau > 0 else 0.0\n\n    work_values = []\n    \n    for _ in range(n_traj):\n        # Initialize state from equilibrium at E_start\n        p_B_eq = np.exp(-beta * E_start) / (1.0 + np.exp(-beta * E_start))\n        state = 1 if rng.random()  p_B_eq else 0  # 0 for A, 1 for B\n        \n        current_time = 0.0\n        time_in_B = 0.0\n\n        while current_time  tau:\n            t_prev = current_time\n            \n            # Sample waiting time dt for the next jump\n            if v == 0: # Homogeneous process\n                rate_A_to_B = k0 * np.exp(-beta * E_start / 2.0)\n                rate_B_to_A = k0 * np.exp(beta * E_start / 2.0)\n                rate = rate_A_to_B if state == 0 else rate_B_to_A\n                dt = rng.exponential(1.0 / rate) if rate > 0 else np.inf\n            else: # Inhomogeneous process\n                R = rng.exponential(1.0)\n                if state == 0: # From A\n                    alpha = -beta * v / 2.0\n                    C = k0 * np.exp(-beta * E_start / 2.0)\n                else: # From B\n                    alpha = beta * v / 2.0\n                    C = k0 * np.exp(beta * E_start / 2.0)\n                \n                rate_at_t = C * np.exp(alpha * current_time)\n                \n                arg = 1.0 + alpha * R / rate_at_t\n                if arg > 0:\n                    dt = (1.0 / alpha) * np.log1p(alpha * R / rate_at_t)\n                else:\n                    dt = np.inf\n\n            t_jump = current_time + dt\n            t_final_interval = min(t_jump, tau)\n\n            if state == 1: # If in state B\n                time_in_B += t_final_interval - t_prev\n            \n            if t_jump  tau:\n                current_time = t_jump\n                state = 1 - state # Flip state\n            else:\n                current_time = tau # End of trajectory\n        \n        work = v * time_in_B\n        work_values.append(work)\n        \n    return work_values\n\nsolve()\n```", "id": "2644035"}, {"introduction": "任何强大的定理都建立在特定的假设之上，Crooks 关系也不例外，其核心是局部细致平衡原理。本练习要求你扮演批判性科学家的角色，评估一个经验性的反应速率模型是否在热力学上自洽。通过检验速率函数是否满足局部细致平衡所施加的约束，你将学会如何判断一个动力学模型应用涨落定理的先决条件是否成立。", "problem": "考虑单步开放化学反应网络\n$$\n\\mathrm{X} + \\mathrm{F} \\rightleftharpoons \\mathrm{Y} + \\mathrm{W},\n$$\n该反应在绝对温度 $T$（逆温度 $\\beta \\equiv 1/(k_{B}T)$）下等温进行，其中 $\\mathrm{F}$（燃料）和 $\\mathrm{W}$（废物）是化学恒势物种，其化学势分别为 $\\mu_{\\mathrm{F}}$ 和 $\\mu_{\\mathrm{W}}$。定义化学恒势器的化学亲和势为\n$$\nA \\equiv \\mu_{\\mathrm{F}} - \\mu_{\\mathrm{W}}.\n$$\n$\\mathrm{Y}$ 和 $\\mathrm{X}$ 之间的内标准自由能差是一个常数\n$$\n\\Delta G_{\\mathrm{int}} \\equiv G^{\\circ}_{\\mathrm{Y}} - G^{\\circ}_{\\mathrm{X}},\n$$\n与 $A$ 无关。在基元反应层面，动力学被建模为一个连续时间马尔可夫跳跃过程，其正向和反向跃迁速率（在一系列 $A$ 值上）通过经验拟合得到：\n$$\nk_{+}(A) = k_{\\ast}\\,\\exp\\!\\big(\\beta\\,[\\,0.47\\,A - 1.2\\,]\\big), \\qquad\nk_{-}(A) = k_{\\ast}\\,\\exp\\!\\big(\\beta\\,[\\,-0.53\\,A + 0.8 + \\Delta G_{\\mathrm{int}}\\,]\\big),\n$$\n其中 $k_{\\ast}$ 是一个常数前置因子，所有能量量 $(A, \\Delta G_{\\mathrm{int}}, 1.2, 0.8)$ 均以与 $\\beta$ 一致的单位表示，从而使每个指数参数都无量纲。\n\n(i) 仅从等温开放化学系统的第一和第二定律以及马尔可夫跳跃过程的微观可逆性出发，推导速率比 $k_{+}(A)/k_{-}(A)$ 必须满足的热力学约束。该约束是模型对于任何始于固定 $A$ 的平衡态、并遵循时变协议 $A(t)$ 的过程都能满足 Crooks 关系的条件。\n\n(ii) 使用你在 (i) 部分得到的结果，定义偏差\n$$\n\\Delta(A) \\equiv \\ln\\!\\bigg(\\frac{k_{+}(A)}{k_{-}(A)}\\bigg) \\,-\\, \\text{[你的(i)部分约束的右侧]}.\n$$\n对于上述经验速率，计算 $\\Delta(A)$ 并说明其是否依赖于 $A$。如果 $\\Delta$ 是与 $A$ 无关的常数，请用 $\\beta$ 表示其单一的闭合形式表达式。在最终报告的值中不要包含单位。", "solution": "该问题已经过验证，被认为是有效的。这是一个在化学物理学中定义明确的问题，基于非平衡统计力学的原理，并且不包含任何科学或逻辑上的缺陷。\n\n任务分为两部分。首先，我们必须推导正向和反向反应速率之比的热力学约束，这个条件被称为局域细致平衡，它是系统动力学与 Crooks 类型的涨落定理相一致的必要条件。其次，我们必须用这个推导出的约束来检验给定的速率经验模型。\n\n(i) 热力学约束的推导\n\n我们考虑一个在恒定温度 $T$ 下运行的开放化学系统。该系统本身由一个可以存在于两种状态（$\\mathrm{X}$ 或 $\\mathrm{Y}$）之一的分子组成。此系统与燃料（$\\mathrm{F}$）和废物（$\\mathrm{W}$）物种的化学恒势库接触，这些恒势库分别维持恒定的化学势 $\\mu_{\\mathrm{F}}$ 和 $\\mu_{\\mathrm{W}}$。基元反应过程为 $\\mathrm{X} + \\mathrm{F} \\rightleftharpoons \\mathrm{Y} + \\mathrm{W}$。\n\nCrooks 涨落关系以及更广泛的涨落定理，都依赖于应用于非平衡系统的微观可逆性原理。对于连续时间马尔可夫跳跃过程，该原理表现为局域细致平衡的形式。它要求正向跃迁速率与反向跃迁速率之比由该跃迁过程中宇宙（系统+热库）产生的总熵决定。\n\n我们来分析一个正向反应事件：$\\mathrm{X} + \\mathrm{F} \\rightarrow \\mathrm{Y} + \\mathrm{W}$。\n此过程包括两个部分：\n1. 内部系统从状态 $\\mathrm{X}$ 跃迁到状态 $\\mathrm{Y}$。\n2. 外部热库消耗一个 $\\mathrm{F}$ 分子并生成一个 $\\mathrm{W}$ 分子。\n\n根据等温等压过程的热力学第二定律，宇宙的吉布斯自由能总变化 $\\Delta G_{\\mathrm{tot}}$ 必须为非正值，即 $\\Delta G_{\\mathrm{tot}} \\le 0$。以热量形式耗散的能量为 $Q_{\\mathrm{diss}} = -T \\Delta S_{\\mathrm{tot}} = -\\Delta G_{\\mathrm{tot}}$。总熵产生 $\\Delta S_{\\mathrm{tot}}$ 由 $\\Delta S_{\\mathrm{tot}} = - \\Delta G_{\\mathrm{tot}}/T$ 给出。\n\n总自由能变化 $\\Delta G_{\\mathrm{tot}}$ 是系统和热库变化的总和：\n$$\n\\Delta G_{\\mathrm{tot}} = \\Delta G_{\\mathrm{sys}} + \\Delta G_{\\mathrm{res}}\n$$\n对于系统的跃迁 $\\mathrm{X} \\rightarrow \\mathrm{Y}$，标准自由能的变化为 $\\Delta G_{\\mathrm{sys}} = G^{\\circ}_{\\mathrm{Y}} - G^{\\circ}_{\\mathrm{X}} \\equiv \\Delta G_{\\mathrm{int}}$。\n对于热库，一个 $\\mathrm{F}$ 分子被消耗，一个 $\\mathrm{W}$ 分子被产生。因此，热库自由能的变化是 $\\Delta G_{\\mathrm{res}} = \\mu_{\\mathrm{W}} - \\mu_{\\mathrm{F}}$。根据定义，化学恒势器的化学亲和势为 $A \\equiv \\mu_{\\mathrm{F}} - \\mu_{\\mathrm{W}}$，所以 $\\Delta G_{\\mathrm{res}} = -A$。\n\n将这些结合起来，单步正向反应的总自由能变化为：\n$$\n\\Delta G_{\\mathrm{tot}} = \\Delta G_{\\mathrm{int}} - A\n$$\n在此步骤中，宇宙产生的总熵为：\n$$\n\\Delta S_{\\mathrm{tot}} = -\\frac{\\Delta G_{\\mathrm{tot}}}{T} = -\\frac{\\Delta G_{\\mathrm{int}} - A}{T}\n$$\n使用逆温度 $\\beta = 1/(k_{B}T)$，我们可以将无量纲的熵产生写作：\n$$\n\\frac{\\Delta S_{\\mathrm{tot}}}{k_{B}} = -\\beta (\\Delta G_{\\mathrm{int}} - A) = \\beta (A - \\Delta G_{\\mathrm{int}})\n$$\n局域细致平衡条件要求正向速率 $k_{+}(A)$ 与反向速率 $k_{-}(A)$ 之比的对数等于无量纲的熵产生：\n$$\n\\ln\\left(\\frac{k_{+}(A)}{k_{-}(A)}\\right) = \\frac{\\Delta S_{\\mathrm{tot}}}{k_{B}}\n$$\n因此，速率的热力学约束为：\n$$\n\\ln\\left(\\frac{k_{+}(A)}{k_{-}(A)}\\right) = \\beta(A - \\Delta G_{\\mathrm{int}})\n$$\n这就是所要求的关系。等式右边是反应的总热力学驱动力（或称亲和势）乘以 $\\beta$。\n\n(ii) 偏差 $\\Delta(A)$ 的计算\n\n我们被要求计算给定经验速率表达式的偏差 $\\Delta(A)$：\n$$\n\\Delta(A) \\equiv \\ln\\left(\\frac{k_{+}(A)}{k_{-}(A)}\\right) - \\beta(A - \\Delta G_{\\mathrm{int}})\n$$\n提供的速率为：\n$$\nk_{+}(A) = k_{\\ast}\\,\\exp\\big(\\beta\\,[0.47\\,A - 1.2]\\big)\n$$\n$$\nk_{-}(A) = k_{\\ast}\\,\\exp\\big(\\beta\\,[-0.53\\,A + 0.8 + \\Delta G_{\\mathrm{int}}]\\big)\n$$\n首先，我们计算这些速率之比的对数：\n$$\n\\ln\\left(\\frac{k_{+}(A)}{k_{-}(A)}\\right) = \\ln\\left(\\frac{k_{\\ast}\\,\\exp\\big(\\beta\\,[0.47\\,A - 1.2]\\big)}{k_{\\ast}\\,\\exp\\big(\\beta\\,[-0.53\\,A + 0.8 + \\Delta G_{\\mathrm{int}}]\\big)}\\right)\n$$\n前置因子 $k_{\\ast}$ 被消去。使用性质 $\\ln(\\exp(x)) = x$，我们得到：\n$$\n\\ln\\left(\\frac{k_{+}(A)}{k_{-}(A)}\\right) = \\beta\\,(0.47\\,A - 1.2) - \\beta\\,(-0.53\\,A + 0.8 + \\Delta G_{\\mathrm{int}})\n$$\n我们分配 $\\beta$ 并合并各项：\n$$\n\\ln\\left(\\frac{k_{+}(A)}{k_{-}(A)}\\right) = \\beta\\,(0.47\\,A - 1.2 + 0.53\\,A - 0.8 - \\Delta G_{\\mathrm{int}})\n$$\n$$\n\\ln\\left(\\frac{k_{+}(A)}{k_{-}(A)}\\right) = \\beta\\,((0.47 + 0.53)A - (1.2 + 0.8) - \\Delta G_{\\mathrm{int}})\n$$\n$$\n\\ln\\left(\\frac{k_{+}(A)}{k_{-}(A)}\\right) = \\beta\\,(A - 2 - \\Delta G_{\\mathrm{int}})\n$$\n现在，我们将此结果代入 $\\Delta(A)$ 的表达式中：\n$$\n\\Delta(A) = \\big[\\beta(A - 2 - \\Delta G_{\\mathrm{int}})\\big] - \\big[\\beta(A - \\Delta G_{\\mathrm{int}})\\big]\n$$\n$$\n\\Delta(A) = \\beta A - 2\\beta - \\beta\\Delta G_{\\mathrm{int}} - \\beta A + \\beta\\Delta G_{\\mathrm{int}}\n$$\n项 $\\beta A$ 和 $\\beta\\Delta G_{\\mathrm{int}}$ 相互抵消，剩下：\n$$\n\\Delta(A) = -2\\beta\n$$\n偏差 $\\Delta(A)$ 确实与化学亲和势 $A$ 无关。它是一个常数值，$\\Delta = -2\\beta$。这表明，虽然经验模型正确地捕捉了速率比对驱动亲和势 $A$ 的依赖性，但它与热力学一致的形式之间存在一个恒定的偏移。这个偏移意味着对局域细致平衡的违反，除非重新定义标准自由能差 $\\Delta G_{\\mathrm{int}}$ 来吸收这个常数项，但这与问题陈述相悖。", "answer": "$$\\boxed{-2\\beta}$$", "id": "2644038"}]}