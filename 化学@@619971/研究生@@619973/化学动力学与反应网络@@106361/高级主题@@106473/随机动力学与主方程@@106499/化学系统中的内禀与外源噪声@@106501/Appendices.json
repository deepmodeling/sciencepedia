{"hands_on_practices": [{"introduction": "理解内在噪声的起源，第一步是能够从基本原理出发进行量化。这个练习将指导你处理一个经典的生灭过程——这是化学反应网络中内在随机性的一个基本模型。通过直接从化学主方程（CME）推导其均值和方差的精确时间演化，你将掌握分析随机动力学核心统计特性的关键技能。[@problem_id:2649020]", "problem": "考虑一个代表了均匀混合化学系统中内在噪声的单物种随机反应网络：\n$$\\varnothing \\xrightarrow{\\lambda} X, \\quad X \\xrightarrow{\\mu} \\varnothing,$$\n其中 $X$ 是该物种的分子数，$\\lambda>0$ 是一个常数生成速率（零级），$\\mu>0$ 是一级降解速率。令 $X(t)$ 表示时间 $t\\ge 0$ 时的随机分子数，并假设一个确定性初始条件 $X(0)=n_{0}$，其中 $n_{0}$ 是一个非负整数。仅使用随机化学主方程（CME）的第一性原理，推导在所有 $t\\ge 0$ 时均值 $m(t)=\\mathbb{E}[X(t)]$ 和方差 $v(t)=\\operatorname{Var}(X(t))$ 的闭式表达式。然后分析长时间极限以确定稳态均值和方差，并明确验证当 $\\lambda=\\mu$ 时，稳态方差趋近于稳态均值。用 $\\lambda$、$\\mu$、$t$ 和 $n_{0}$ 来表示你的最终答案，形式为 $(m(t),v(t))$。不需要数值近似或四舍五入，也无需单位。", "solution": "现在将对该问题进行严格验证。\n\n### 步骤1：提取已知条件\n从问题陈述中得到的明确已知条件是：\n- 化学反应网络：$\\varnothing \\xrightarrow{\\lambda} X$ 和 $X \\xrightarrow{\\mu} \\varnothing$。\n- 生成速率 $\\lambda > 0$ 是一个常数（零级）。\n- 降解速率是一级的，速率常数为 $\\mu > 0$。\n- $X(t)$ 是物种 $X$ 在时间 $t \\ge 0$ 时分子数的随机变量。\n- 初始条件是确定性的：$X(0) = n_0$，其中 $n_0$ 是一个非负整数。\n- 需要推导的量是均值 $m(t) = \\mathbb{E}[X(t)]$ 和方差 $v(t) = \\operatorname{Var}(X(t))$。\n- 推导必须使用化学主方程（CME）的第一性原理。\n\n### 步骤2：使用提取的已知条件进行验证\n根据所需标准对问题进行评估：\n- **科学依据**：该问题描述了一个线性生灭过程，这是随机化学动力学中用于描述内在噪声的一个基础和典型的模型。该模型在科学上是可靠且公认的。\n- **适定性**：该问题是适定的。它提供了随机过程的完整规范（反应、倾向函数）和一个明确定义的初始条件。这些足以唯一地确定系统统计矩的时间演化。\n- **客观性**：该问题以精确、客观的数学和科学语言陈述。它不包含任何主观或模糊的术语。\n- **无其他缺陷**：该问题是完整的、一致的且科学上可行的。它是该领域的标准问题，既不简单也非不适定。\n\n### 步骤3：结论与行动\n该问题是**有效的**。将推导一个解。\n\n该问题要求推导由反应 $\\varnothing \\xrightarrow{\\lambda} X$ 和 $X \\xrightarrow{\\mu} \\varnothing$ 控制的分子数 $X(t)$ 的均值 $m(t)$ 和方差 $v(t)$。这需要从化学主方程（CME）开始。\n\n令 $P(n, t) = \\mathbb{P}(X(t)=n)$ 为在时间 $t$ 有 $n$ 个分子的概率。反应的倾向函数为：生成反应 $a_1 = \\lambda$，降解反应 $a_2(n) = \\mu n$。CME由下式给出：\n$$ \\frac{dP(n,t)}{dt} = \\lambda P(n-1,t) + \\mu(n+1)P(n+1,t) - (\\lambda + \\mu n)P(n,t) $$\n对于 $n \\ge 1$，以及当 $n=0$ 时为 $\\frac{dP(0,t)}{dt} = \\mu P(1,t) - \\lambda P(0,t)$。\n\n从CME可以推导出 $X(t)$ 各阶矩的常微分方程（ODE）。对于任意函数 $f(X)$，其期望值 $\\mathbb{E}[f(X)] = \\langle f(X) \\rangle$ 的时间演化由下式给出：\n$$ \\frac{d\\langle f(X) \\rangle}{dt} = \\sum_{j} \\langle a_j(X) [f(X+\\nu_j) - f(X)] \\rangle $$\n其中，求和遍历所有反应通道 $j$，$a_j(X)$ 是反应 $j$ 的倾向函数，$\\nu_j$ 是由于反应 $j$ 引起的 $X$ 的化学计量变化。\n对于本系统，我们有：\n- 反应1（生成）：$a_1(n) = \\lambda$，$\\nu_1 = +1$。\n- 反应2（降解）：$a_2(n) = \\mu n$，$\\nu_2 = -1$。\n\n**均值 $m(t) = \\langle X(t) \\rangle$ 的推导**\n令 $f(X)=X$。矩方程变为：\n$$ \\frac{d\\langle X \\rangle}{dt} = \\langle \\lambda ((X+1) - X) \\rangle + \\langle \\mu X ((X-1) - X) \\rangle $$\n$$ \\frac{d\\langle X \\rangle}{dt} = \\langle \\lambda \\cdot 1 \\rangle + \\langle \\mu X \\cdot (-1) \\rangle $$\n$$ \\frac{dm(t)}{dt} = \\lambda - \\mu \\langle X \\rangle = \\lambda - \\mu m(t) $$\n这是一个一阶线性ODE：$\\frac{dm}{dt} + \\mu m = \\lambda$。积分因子为 $\\exp(\\int \\mu dt) = \\exp(\\mu t)$。\n乘以积分因子得到：\n$$ \\frac{d}{dt}(m(t)\\exp(\\mu t)) = \\lambda \\exp(\\mu t) $$\n对 $t$ 积分：\n$$ m(t)\\exp(\\mu t) = \\int \\lambda \\exp(\\mu t) dt = \\frac{\\lambda}{\\mu} \\exp(\\mu t) + C_1 $$\n其中 $C_1$ 是积分常数。两边除以 $\\exp(\\mu t)$：\n$$ m(t) = \\frac{\\lambda}{\\mu} + C_1 \\exp(-\\mu t) $$\n初始条件是 $X(0) = n_0$，这是确定性的。因此，$m(0) = \\mathbb{E}[X(0)] = n_0$。\n$$ n_0 = \\frac{\\lambda}{\\mu} + C_1 \\implies C_1 = n_0 - \\frac{\\lambda}{\\mu} $$\n将 $C_1$ 代回，我们得到均值的表达式：\n$$ m(t) = \\frac{\\lambda}{\\mu} + \\left(n_0 - \\frac{\\lambda}{\\mu}\\right)\\exp(-\\mu t) $$\n\n**方差 $v(t) = \\operatorname{Var}(X(t))$ 的推导**\n方差为 $v(t) = \\langle X(t)^2 \\rangle - m(t)^2$。我们首先推导二阶矩 $\\langle X^2 \\rangle$ 的ODE。令 $f(X)=X^2$。\n$$ \\frac{d\\langle X^2 \\rangle}{dt} = \\langle \\lambda ((X+1)^2 - X^2) \\rangle + \\langle \\mu X ((X-1)^2 - X^2) \\rangle $$\n$$ \\frac{d\\langle X^2 \\rangle}{dt} = \\langle \\lambda (2X+1) \\rangle + \\langle \\mu X (-2X+1) \\rangle $$\n$$ \\frac{d\\langle X^2 \\rangle}{dt} = 2\\lambda\\langle X \\rangle + \\lambda - 2\\mu\\langle X^2 \\rangle + \\mu\\langle X \\rangle = (2\\lambda+\\mu)m(t) + \\lambda - 2\\mu\\langle X^2 \\rangle $$\n现在，考虑方差 $v(t) = \\langle X^2 \\rangle - m(t)^2$ 的时间导数：\n$$ \\frac{dv}{dt} = \\frac{d\\langle X^2 \\rangle}{dt} - 2m(t)\\frac{dm(t)}{dt} $$\n代入导数的表达式：\n$$ \\frac{dv}{dt} = \\left[ (2\\lambda+\\mu)m(t) + \\lambda - 2\\mu\\langle X^2 \\rangle \\right] - 2m(t)[\\lambda - \\mu m(t)] $$\n$$ \\frac{dv}{dt} = (2\\lambda+\\mu)m(t) + \\lambda - 2\\mu\\langle X^2 \\rangle - 2\\lambda m(t) + 2\\mu m(t)^2 $$\n$$ \\frac{dv}{dt} = \\mu m(t) + \\lambda - 2\\mu(\\langle X^2 \\rangle - m(t)^2) $$\n注意到 $v(t) = \\langle X^2 \\rangle - m(t)^2$，我们有：\n$$ \\frac{dv(t)}{dt} = \\mu m(t) + \\lambda - 2\\mu v(t) $$\n这是一个关于 $v(t)$ 的一阶线性ODE：$\\frac{dv}{dt} + 2\\mu v = \\lambda + \\mu m(t)$。\n一个求解 $v(t)$ 的巧妙方法是考虑差值 $f(t) = m(t) - v(t)$ 的演化。\n$$ \\frac{df(t)}{dt} = \\frac{dm(t)}{dt} - \\frac{dv(t)}{dt} = (\\lambda - \\mu m(t)) - (\\lambda + \\mu m(t) - 2\\mu v(t)) $$\n$$ \\frac{df(t)}{dt} = -2\\mu m(t) + 2\\mu v(t) = -2\\mu (m(t) - v(t)) = -2\\mu f(t) $$\n这个简单ODE的解是 $f(t) = f(0)\\exp(-2\\mu t)$。\n初始条件 $X(0) = n_0$ 是确定性的，所以 $t=0$ 时的方差为零。\n$m(0) = n_0$ 且 $v(0) = 0$。\n因此，$f(0) = m(0) - v(0) = n_0 - 0 = n_0$。\n这得到 $m(t) - v(t) = n_0 \\exp(-2\\mu t)$。\n由此，我们可以用均值表示方差：\n$$ v(t) = m(t) - n_0 \\exp(-2\\mu t) $$\n代入 $m(t)$ 的表达式：\n$$ v(t) = \\left[ \\frac{\\lambda}{\\mu} + \\left(n_0 - \\frac{\\lambda}{\\mu}\\right)\\exp(-\\mu t) \\right] - n_0 \\exp(-2\\mu t) $$\n\n**长时间极限分析**\n当 $t \\to \\infty$ 时，由于 $\\mu > 0$，指数项 $\\exp(-\\mu t)$ 和 $\\exp(-2\\mu t)$ 都衰减到零。\n稳态均值为：\n$$ m_{ss} = \\lim_{t \\to \\infty} m(t) = \\frac{\\lambda}{\\mu} $$\n稳态方差为：\n$$ v_{ss} = \\lim_{t \\to \\infty} v(t) = \\frac{\\lambda}{\\mu} $$\n因此，在稳态下，均值等于方差。这意味着 $X$ 的稳态分布是参数为 $\\lambda/\\mu$ 的泊松分布。\n\n问题要求验证当 $\\lambda = \\mu$ 时，稳态方差趋近于稳态均值。我们的分析表明，对于任何正的 $\\lambda$ 和 $\\mu$，$m_{ss} = v_{ss} = \\lambda/\\mu$。$\\lambda=\\mu$ 的特殊情况只是这个一般结果的一个实例，此时 $m_{ss} = v_{ss} = 1$。因此，从一般表达式可以立即得到验证。\n\n对于 $t \\ge 0$，推导出的均值和方差的最终表达式是：\n$m(t) = \\frac{\\lambda}{\\mu} + (n_0 - \\frac{\\lambda}{\\mu})\\exp(-\\mu t)$\n$v(t) = \\frac{\\lambda}{\\mu} + (n_0 - \\frac{\\lambda}{\\mu})\\exp(-\\mu t) - n_0 \\exp(-2\\mu t)$\n这些是完整、合理的解。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\lambda}{\\mu} + \\left(n_{0} - \\frac{\\lambda}{\\mu}\\right)\\exp(-\\mu t) & \\frac{\\lambda}{\\mu} + \\left(n_{0} - \\frac{\\lambda}{\\mu}\\right)\\exp(-\\mu t) - n_{0}\\exp(-2\\mu t)\n\\end{pmatrix}\n}\n$$", "id": "2649020"}, {"introduction": "真实的生物系统不仅受到内在噪声的影响，还受到外部环境波动的强烈调节，这被称为外在噪声。这项练习在前一个练习的基础上，引入了反应速率的波动，并要求你运用全方差定律来剖析总噪声。通过将总噪声精确地分解为内在和外在两个部分，你将深入理解不同噪声源如何共同塑造系统的整体行为。[@problem_id:2648986]", "problem": "考虑一个充分混合的等温反应器，其中包含一个单一分子物种，该物种经历线性生灭反应\n$$\\varnothing \\xrightarrow{\\ \\lambda\\ } X, \\quad X \\xrightarrow{\\ \\gamma\\ } \\varnothing,$$\n其中 $\\lambda$ 是零级合成速率，$\\gamma$ 是一级降解速率常数。假设存在一个由相同方法制备的反应器系综，其中 $\\lambda$ 受到相对于内禀反应动力学而言是准静态的慢外在涨落的影响。在给定一个固定的 $\\lambda$ 的条件下，系统会达到其稳态。在整个系综中，外在涨落使得 $\\ln \\lambda$ 服从均值为 $\\mu$、方差为 $\\sigma^{2}$ 的正态分布，即 $\\ln \\lambda \\sim \\mathcal{N}(\\mu,\\sigma^{2})$。\n\n令 $N$ 表示从系综中随机选取的一个反应器中 $X$ 的稳态分子数。法诺因子 (Fano factor) 定义为\n$$F \\equiv \\frac{\\operatorname{Var}(N)}{\\mathbb{E}[N]}.$$\n\n从化学动力学和线性反应网络的随机过程的第一性原理出发，推导稳态系综平均法诺因子 $F$ 关于 $\\mu$、$\\sigma^{2}$ 和 $\\gamma$ 的显式解析表达式。此外，将 $F$ 分解为来自 $\\lambda$ 涨落的内禀贡献和外在贡献。将您的最终答案表示为一个行矩阵，其中包含按以下顺序排列的三个条目\n$$\\bigl[F,\\ F_{\\text{intrinsic}},\\ F_{\\text{extrinsic}}\\bigr],$$\n其中 $F_{\\text{intrinsic}}$ 是当 $\\lambda$ 固定时仍然存在的贡献，而 $F_{\\text{extrinsic}}$ 是完全由 $\\lambda$ 在系综中的可变性引起的附加贡献。不需要四舍五入。法诺因子是无量纲的；最终答案中不要包含单位。", "solution": "该问题具有科学依据，提法明确且客观。它提出了一个来自随机化学动力学的经典模型。所有必要的参数和分布都已给出，任务是推导明确定义的特定物理量。问题中没有矛盾、歧义或违反物理原理之处。因此，可以构建一个严谨的解。\n\n该问题研究由以下反应描述的线性生灭过程\n$$\n\\varnothing \\xrightarrow{\\ \\lambda\\ } X, \\quad X \\xrightarrow{\\ \\gamma\\ } \\varnothing\n$$\n合成速率 $\\lambda$ 不是恒定的，而是受到慢外在涨落的影响。在给定一个特定的 $\\lambda$ 值时，系统达到一个稳态。在这样的系统系综中，$\\lambda$ 是一个随机变量，其自然对数服从正态分布：$\\ln \\lambda \\sim \\mathcal{N}(\\mu, \\sigma^2)$。这意味着 $\\lambda$ 服从对数正态分布。\n\n我们的第一步是分析系统在给定一个固定 $\\lambda$ 值时的行为。对于这个线性生灭过程，分子数 $N$ 的稳态分布是泊松分布 (Poisson distribution)。这可以从化学主方程 (chemical master equation) 推导出来。在稳态下，给定 $\\lambda$ 时有 $n$ 个分子的概率分布 $P(n|\\lambda)$ 由下式给出：\n$$\nP(n|\\lambda) = \\frac{(\\lambda/\\gamma)^n}{n!} \\exp\\left(-\\frac{\\lambda}{\\gamma}\\right)\n$$\n对于泊松分布，其均值等于方差。因此，分子数 $N$ 的条件均值和条件方差为：\n$$\n\\mathbb{E}[N|\\lambda] = \\frac{\\lambda}{\\gamma}\n$$\n$$\n\\operatorname{Var}(N|\\lambda) = \\frac{\\lambda}{\\gamma}\n$$\n\n遍布系综的 $N$ 的总体统计量是通过对 $\\lambda$ 的分布进行平均得到的。我们使用全期望定律 (law of total expectation) 和全方差定律 (law of total variance)。$N$ 的系综平均均值，记作 $\\mathbb{E}[N]$，是：\n$$\n\\mathbb{E}[N] = \\mathbb{E}_{\\lambda}\\bigl[\\mathbb{E}[N|\\lambda]\\bigr]\n$$\n$N$ 的系综平均方差，记作 $\\operatorname{Var}(N)$，由全方差定律给出：\n$$\n\\operatorname{Var}(N) = \\mathbb{E}_{\\lambda}\\bigl[\\operatorname{Var}(N|\\lambda)\\bigr] + \\operatorname{Var}_{\\lambda}\\bigl[\\mathbb{E}[N|\\lambda]\\bigr]\n$$\n第一项 $\\mathbb{E}_{\\lambda}[\\operatorname{Var}(N|\\lambda)]$ 代表平均内禀方差，而第二项 $\\operatorname{Var}_{\\lambda}[\\mathbb{E}[N|\\lambda]]$ 代表由条件均值的涨落引起的外在方差。\n\n为了计算这些表达式，我们需要对数正态分布速率 $\\lambda$ 的矩。给定 $Y = \\ln \\lambda \\sim \\mathcal{N}(\\mu, \\sigma^2)$，$\\lambda = \\exp(Y)$ 的矩可以通过使用正态分布的矩生成函数 (moment-generating function) $M_Y(t) = \\mathbb{E}[\\exp(tY)] = \\exp(\\mu t + \\frac{1}{2}\\sigma^2 t^2)$ 来找到。\n$\\lambda$ 的均值是：\n$$\n\\mathbb{E}[\\lambda] = \\mathbb{E}[\\exp(Y)] = M_Y(1) = \\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)\n$$\n$\\lambda$ 的二阶矩是：\n$$\n\\mathbb{E}[\\lambda^2] = \\mathbb{E}[\\exp(2Y)] = M_Y(2) = \\exp\\left(2\\mu + \\frac{1}{2}\\sigma^2(2^2)\\right) = \\exp(2\\mu + 2\\sigma^2)\n$$\n那么 $\\lambda$ 的方差是：\n$$\n\\operatorname{Var}(\\lambda) = \\mathbb{E}[\\lambda^2] - (\\mathbb{E}[\\lambda])^2 = \\exp(2\\mu + 2\\sigma^2) - \\left[\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)\\right]^2 = \\exp(2\\mu + 2\\sigma^2) - \\exp(2\\mu + \\sigma^2) = \\exp(2\\mu + \\sigma^2)\\bigl(\\exp(\\sigma^2) - 1\\bigr)\n$$\n现在我们可以计算 $N$ 的系综矩。分子的平均数是：\n$$\n\\mathbb{E}[N] = \\mathbb{E}_{\\lambda}\\left[\\frac{\\lambda}{\\gamma}\\right] = \\frac{1}{\\gamma}\\mathbb{E}[\\lambda] = \\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)\n$$\n对于 $N$ 的方差，我们计算其两个分量：\n1. 平均内禀方差：\n$$\n\\mathbb{E}_{\\lambda}\\bigl[\\operatorname{Var}(N|\\lambda)\\bigr] = \\mathbb{E}_{\\lambda}\\left[\\frac{\\lambda}{\\gamma}\\right] = \\frac{1}{\\gamma}\\mathbb{E}[\\lambda] = \\mathbb{E}[N] = \\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)\n$$\n2. 外在方差：\n$$\n\\operatorname{Var}_{\\lambda}\\bigl[\\mathbb{E}[N|\\lambda]\\bigr] = \\operatorname{Var}_{\\lambda}\\left[\\frac{\\lambda}{\\gamma}\\right] = \\frac{1}{\\gamma^2}\\operatorname{Var}(\\lambda) = \\frac{1}{\\gamma^2}\\exp(2\\mu + \\sigma^2)\\bigl(\\exp(\\sigma^2) - 1\\bigr)\n$$\n总方差是这两项的和：\n$$\n\\operatorname{Var}(N) = \\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right) + \\frac{1}{\\gamma^2}\\exp(2\\mu + \\sigma^2)\\bigl(\\exp(\\sigma^2) - 1\\bigr)\n$$\n法诺因子定义为 $F \\equiv \\operatorname{Var}(N)/\\mathbb{E}[N]$。代入我们得到的 $\\operatorname{Var}(N)$ 和 $\\mathbb{E}[N]$ 的表达式：\n$$\nF = \\frac{\\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right) + \\frac{1}{\\gamma^2}\\exp(2\\mu + \\sigma^2)\\bigl(\\exp(\\sigma^2) - 1\\bigr)}{\\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)}\n$$\n$$\nF = 1 + \\frac{\\frac{1}{\\gamma^2}\\exp(2\\mu + \\sigma^2)\\bigl(\\exp(\\sigma^2) - 1\\bigr)}{\\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)}\n$$\n简化第二项：\n$$\n\\frac{1}{\\gamma}\\frac{\\exp(2\\mu + \\sigma^2)}{\\exp(\\mu + \\frac{\\sigma^2}{2})}\\bigl(\\exp(\\sigma^2) - 1\\bigr) = \\frac{1}{\\gamma}\\exp\\left(2\\mu - \\mu + \\sigma^2 - \\frac{\\sigma^2}{2}\\right)\\bigl(\\exp(\\sigma^2) - 1\\bigr) = \\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)\\bigl(\\exp(\\sigma^2) - 1\\bigr)\n$$\n所以，总法诺因子是：\n$$\nF = 1 + \\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)\\bigl(\\exp(\\sigma^2) - 1\\bigr)\n$$\n问题要求将 $F$ 分解为内禀和外在贡献。方差的分解自然地导致了法诺因子的分解：\n$$\nF = \\frac{\\mathbb{E}_{\\lambda}[\\operatorname{Var}(N|\\lambda)]}{\\mathbb{E}[N]} + \\frac{\\operatorname{Var}_{\\lambda}[\\mathbb{E}[N|\\lambda]]}{\\mathbb{E}[N]} = F_{\\text{intrinsic}} + F_{\\text{extrinsic}}\n$$\n内禀贡献 $F_{\\text{intrinsic}}$ 是在 $\\lambda$ 固定（$\\sigma^2=0$）时所剩下的部分。从方差分解的结构来看：\n$$\nF_{\\text{intrinsic}} = \\frac{\\mathbb{E}_{\\lambda}[\\operatorname{Var}(N|\\lambda)]}{\\mathbb{E}[N]} = \\frac{\\mathbb{E}[N]}{\\mathbb{E}[N]} = 1\n$$\n这对应于泊松过程的法诺因子，而泊松过程是其潜在的内禀过程。\n外在贡献 $F_{\\text{extrinsic}}$ 是由 $\\lambda$ 的可变性引起的附加项：\n$$\nF_{\\text{extrinsic}} = \\frac{\\operatorname{Var}_{\\lambda}[\\mathbb{E}[N|\\lambda]]}{\\mathbb{E}[N]} = F - F_{\\text{intrinsic}} = \\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)\\bigl(\\exp(\\sigma^2) - 1\\bigr)\n$$\n因此，所要求的三个量是：\n$F = 1 + \\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)\\left(\\exp(\\sigma^2) - 1\\right)$\n$F_{\\text{intrinsic}} = 1$\n$F_{\\text{extrinsic}} = \\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)\\left(\\exp(\\sigma^2) - 1\\right)$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 + \\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)\\left(\\exp(\\sigma^2) - 1\\right) & 1 & \\frac{1}{\\gamma}\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)\\left(\\exp(\\sigma^2) - 1\\right)\n\\end{pmatrix}\n}\n$$", "id": "2648986"}, {"introduction": "当系统变得复杂或我们关心罕见但关键的事件（如细胞状态转换）时，解析分析往往变得不可行，计算方法便成为必需。这项练习将引导你从分析转向计算，通过实现一种名为重要性抽样的高级模拟技术来解决问题。你将学习如何加速对内在噪声驱动的罕见转变事件的模拟，同时确保估计结果的无偏性，这是计算生物物理学中的一项强大技能。[@problem_id:2648940]", "problem": "考虑一个充分混合的等温生灭反应网络，该网络模拟了受内在涨落影响的单一化学物种。该网络在化学主方程 (CME) 的框架下包含两个反应：生成反应 $\\varnothing \\to X$，其倾向为 $a_1(n) = \\lambda$；以及死亡反应 $X \\to \\varnothing$，其倾向为 $a_2(n) = \\mu n$，其中 $n \\in \\mathbb{Z}_{\\ge 0}$ 是分子数，$\\lambda > 0$ 和 $\\mu > 0$ 是常数。精确的随机模拟算法 (SSA) 通过以速率 $a_0(n) = a_1(n) + a_2(n)$ 抽取服从指数分布的等待时间，并以与其倾向成正比的概率选择下一个反应，来模拟此连续时间马尔可夫跳跃过程。\n\n将在有限时间域 $[0,T]$ 内，从 $n(0) = n_0$ 开始，首次到达集合 $\\{n \\ge M\\}$ 的事件定义为一次噪声诱导的跃迁。记到达时间为 $\\tau_M = \\inf\\{t \\ge 0 : n(t) \\ge M\\}$，跃迁概率为 $p = \\mathbb{P}[\\tau_M \\le T \\mid n(0) = n_0]$。\n\n您的任务是设计并实现一个嵌入到 SSA 中的重要性采样方案，该方案能加速对此类稀有跃迁的采样，同时不扭曲其概率。请遵循第一性原理，按以下步骤进行：\n\n1. 基于连续时间马尔可夫跳跃过程的 CME 定义以及精确 SSA 通过指数分布等待时间构造路径的方法进行推导。考虑一个有偏 SSA，它模拟一个具有修改后生成倾向 $a_1'(n) = b \\lambda$ 和相同死亡倾向 $a_2'(n) = \\mu n$ 的替代过程，其中 $b > 0$ 是用户选择的倾斜因子。令 $a_0'(n) = a_1'(n) + a_2'(n)$ 表示总有偏倾向。\n\n2. 从马尔可夫跳跃过程的 Radon–Nikodym 导数出发，推导出在事件由条件 $\\{\\tau_M \\le T\\}$ 定义时，直至停止时间 $\\tau = \\min\\{T,\\tau_M\\}$ 的原始动力学和有偏动力学之间的路径似然比 $L(\\omega)$。将 $L(\\omega)$ 仅用直至 $\\tau$ 的路径上的模拟等待时间和反应索引来表示。\n\n3. 证明在有偏动力学下，$p$ 的一个无偏估计量具有以下形式\n$$\n\\widehat{p} = \\frac{1}{N}\\sum_{k=1}^N L(\\omega^{(k)}) \\,\\mathbf{1}\\{\\tau_M^{(k)} \\le T\\},\n$$\n其中 $\\omega^{(k)}$ 是由有偏 SSA 生成的独立轨迹，$N \\in \\mathbb{N}$ 是模拟轨迹的数量，$\\mathbf{1}\\{\\cdot\\}$ 是指示函数。请精确说明，根据 $\\tau_M \\le T$ 是否发生，最后的无反应生存区间是否对 $L(\\omega)$ 有贡献。\n\n4. 实现一个程序，该程序：\n   - 使用有偏倾向 $a_1'(n) = b\\lambda$、$a_2'(n) = \\mu n$下的精确 SSA，生成从 $n(0)=n_0$ 开始并在时间 $\\tau = \\min\\{T,\\tau_M\\}$ 停止的独立轨迹，其中 $\\tau_M$ 是过程首次达到或超过 $M$ 的时间。\n   - 根据您的推导，通过等待时间和反应选择的贡献，沿着每条轨迹累积对数似然比 $\\log L$，并注意仅在未发生到达事件时（即当 $\\tau = T$ 时），才将区间 $[t, T]$ 上的最终生存贡献包括在内。\n   - 返回噪声诱导跃迁概率 $p$ 的蒙特卡洛估计 $\\widehat{p}$。\n\n为保证可复现性，请使用固定的随机种子 $12345$。此问题不涉及任何需要报告的物理单位。\n\n测试套件：\n对于以下每个参数集，计算并以浮点数形式返回无偏重要性采样估计值 $\\widehat{p}$。\n\n- 情况 A（理想情况，加速）：$(\\lambda, \\mu, n_0, M, T, b, N) = (2.0, 0.2, 10, 40, 10.0, 2.5, 5000)$。\n- 情况 B（边界情况，无偏置）：$(\\lambda, \\mu, n_0, M, T, b, N) = (2.0, 0.2, 10, 40, 10.0, 1.0, 5000)$。\n- 情况 C（短时间域，加速）：$(\\lambda, \\mu, n_0, M, T, b, N) = (2.0, 0.2, 10, 40, 5.0, 2.5, 5000)$。\n- 情况 D（更难的目标，更强的倾斜）：$(\\lambda, \\mu, n_0, M, T, b, N) = (2.0, 0.2, 10, 50, 10.0, 3.0, 5000)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果顺序与上述情况的顺序相同，例如 $[\\widehat{p}_A,\\widehat{p}_B,\\widehat{p}_C,\\widehat{p}_D]$。每个 $\\widehat{p}$ 都必须打印为十进制数。", "solution": "所述问题是有效的。它在科学上基于随机过程和化学动力学的既有理论，特别是化学主方程 (CME) 和随机模拟算法 (SSA)。任务是应用标准但重要的重要性采样技术，来估计一个典型生灭模型中稀有事件的概率。所有参数和定义都已给出，使得问题自洽、适定且客观。不存在科学缺陷、歧义或矛盾。我将继续进行推导和实现。\n\n问题的核心是计算概率 $p = \\mathbb{P}[\\tau_M \\le T \\mid n(0) = n_0]$，其中 $\\tau_M = \\inf\\{t \\ge 0 : n(t) \\ge M\\}$ 是首次到达集合 $\\{n \\ge M\\}$ 的时间。由于对于所选参数而言，这是一个稀有事件，直接蒙特卡洛模拟是低效的。我们采用重要性采样，通过在一个有偏概率测度 $\\mathbb{P}'$ 下模拟系统，并对结果进行重新加权，以恢复在原始测度 $\\mathbb{P}$ 下的无偏估计。\n\n系统的路径 $\\omega$ 是一个状态和反应时间的序列。在停止时间 $\\tau$ 之前，设路径由在时间 $t_1, t_2, \\dots, t_K$（其中 $t_0=0$）发生的 $K$ 个反应 $j_0, j_1, \\dots, j_{K-1}$ 组成。在区间 $[t_i, t_{i+1})$ 内状态为 $n_i$。在原始动力学 $\\mathbb{P}$ 下观测到这样一条路径的概率密度由反应选择和等待时间的概率乘积给出：\n$$\nf_{\\mathbb{P}}(\\omega) = \\left( \\prod_{i=0}^{K-1} a_{j_i}(n_i) e^{-a_0(n_i)(t_{i+1}-t_i)} \\right) e^{-a_0(n_K)(\\tau-t_K)}\n$$\n其中 $a_{j_i}(n_i)$ 是所选反应 $j_i$ 的倾向，$a_0(n_i)$ 是状态 $n_i$ 下的总倾向。最后一项表示在区间 $[t_K, \\tau]$ 内没有反应发生的概率。\n\n类似地，在具有倾向 $a'_j(n)$ 的有偏动力学 $\\mathbb{P}'$ 下，其密度为：\n$$\nf_{\\mathbb{P}'}(\\omega) = \\left( \\prod_{i=0}^{K-1} a'_{j_i}(n_i) e^{-a'_0(n_i)(t_{i+1}-t_i)} \\right) e^{-a'_0(n_K)(\\tau-t_K)}\n$$\n\n似然比，或 Radon-Nikodym 导数 $L(\\omega) = \\frac{d\\mathbb{P}}{d\\mathbb{P}'}(\\omega)$，是这些路径密度的比率：\n$$\nL(\\omega) = \\frac{f_{\\mathbb{P}}(\\omega)}{f_{\\mathbb{P}'}(\\omega)} = \\left( \\prod_{i=0}^{K-1} \\frac{a_{j_i}(n_i)}{a'_{j_i}(n_i)} \\right) \\exp\\left( \\sum_{i=0}^{K-1} (a'_0(n_i) - a_0(n_i))(t_{i+1}-t_i) + (a'_0(n_K) - a_0(n_K))(\\tau-t_K) \\right)\n$$\n指数中的和是一个随时间分段常数的积分。我们可以将其更紧凑地写为：\n$$\nL(\\omega) = \\left( \\prod_{i=0}^{K-1} \\frac{a_{j_i}(n(t_i))}{a'_{j_i}(n(t_i))} \\right) \\exp\\left( \\int_0^\\tau [a'_0(n(s)) - a_0(n(s))] ds \\right)\n$$\n为了数值稳定性，我们使用对数似然：\n$$\n\\log L(\\omega) = \\sum_{i=0}^{K-1} \\log\\left(\\frac{a_{j_i}(n(t_i))}{a'_{j_i}(n(t_i))}\\right) + \\int_0^\\tau [a'_0(n(s)) - a_0(n(s))] ds\n$$\n现在，我们将给定的生灭过程的具体倾向代入：\n原始倾向：$a_1(n) = \\lambda$，$a_2(n) = \\mu n$。总倾向：$a_0(n) = \\lambda + \\mu n$。\n有偏倾向：$a'_1(n) = b\\lambda$，$a'_2(n) = \\mu n$。总倾向：$a'_0(n) = b\\lambda + \\mu n$。\n\n总倾向的差值是恒定的：$a'_0(n) - a_0(n) = (b\\lambda + \\mu n) - (\\lambda + \\mu n) = (b-1)\\lambda$。\n积分项简化为 $\\int_0^\\tau (b-1)\\lambda ds = (b-1)\\lambda\\tau$。\n\n比率项取决于发生哪个反应：\n- 对于生成反应 ($j=1$)：$\\frac{a_1(n)}{a'_1(n)} = \\frac{\\lambda}{b\\lambda} = \\frac{1}{b}$。其对数贡献为 $-\\log(b)$。\n- 对于死亡反应 ($j=2$)：$\\frac{a_2(n)}{a'_2(n)} = \\frac{\\mu n}{\\mu n} = 1$。其对数贡献为 $\\log(1) = 0$。\n\n如果一条路径在停止时间 $\\tau$ 之前经历了 $K_{birth}$ 次生成反应，则对数似然比变为：\n$$\n\\log L(\\omega) = -K_{birth} \\log(b) + (b-1)\\lambda\\tau\n$$\n此问题的停止时间为 $\\tau = \\min(T, \\tau_M)$。\n\n概率 $p$ 是一个指示函数的期望，$p = \\mathbb{E}_{\\mathbb{P}}[\\mathbf{1}_{\\{\\tau_M \\le T\\}}]$。使用重要性采样，这个期望被转换为在有偏测度 $\\mathbb{P}'$ 下的期望：\n$$\np = \\mathbb{E}_{\\mathbb{P}'}[L(\\omega) \\cdot \\mathbf{1}_{\\{\\tau_M \\le T\\}}]\n$$\n$p$ 的蒙特卡洛估计量是在 $\\mathbb{P}'$ 下模拟的 $N$ 条独立轨迹 $\\{\\omega^{(k)}\\}$ 的样本均值：\n$$\n\\widehat{p} = \\frac{1}{N}\\sum_{k=1}^N L(\\omega^{(k)}) \\cdot \\mathbf{1}_{\\{\\tau_M^{(k)} \\le T\\}}\n$$\n这确认了问题中给出的估计量的形式。请注意，如果一条轨迹 $\\omega^{(k)}$ 在时间 $T$ 之前没有到达目标状态 $M$，即 $\\tau_M^{(k)} > T$，则指示函数为零。因此，无论其似然比 $L(\\omega^{(k)})$ 的值是多少，该路径对总和的贡献都为零。因此，我们只需要为在时间域内成功到达目标状态的轨迹计算并累积 $L(\\omega)$。\n\n模拟的算法如下：\n对于 $N$ 条轨迹中的每一条：\n1. 初始化时间 $t=0$，分子数 $n=n_0$，以及生成事件计数 $K_{birth}=0$。\n2. 使用带有有偏倾向 $a'_1(n) = b\\lambda$ 和 $a'_2(n) = \\mu n$ 的 SSA 模拟轨迹。模拟以一系列跳跃的形式进行。\n3. 单条轨迹的模拟在 $n \\ge M$ (到达) 或 $t \\ge T$ (超时) 时停止。\n4. 如果轨迹因在某个时间 $t_{hit} \\le T$ 达到 $n \\ge M$ 而停止，则事件 $\\{\\tau_M \\le T\\}$ 已发生。停止时间为 $\\tau = t_{hit}$。计算此路径的似然权重 $L = \\exp(-K_{birth} \\log(b) + (b-1)\\lambda\\tau)$，并将其加到累加和中。\n5. 如果轨迹因时间 $t$ 达到或超过 $T$ 而 $n < M$ 时停止，则事件未发生。对总和的贡献为 $0$。\n6. 最终估计值 $\\widehat{p}$ 是累积的总权重除以轨迹数 $N$。\n\n此过程在以下 Python 代码中实现。固定的随机种子确保了可复现性。对于 $b=1$ 的情况，有偏动力学与原始动力学相同，所有路径的 $L(\\omega)=1$，该方法简化为标准的（直接）蒙特卡洛模拟，为比较提供了一个有价值的基准。", "answer": "```python\nimport numpy as np\n\ndef run_is_simulation(lambda_, mu, n0, M, T, b, N, rng):\n    \"\"\"\n    Runs an importance sampling simulation for the birth-death process.\n\n    Args:\n        lambda_ (float): Birth rate parameter.\n        mu (float): Death rate parameter.\n        n0 (int): Initial number of molecules.\n        M (int): Target threshold for the number of molecules.\n        T (float): Time horizon.\n        b (float): Importance sampling tilt factor for the birth propensity.\n        N (int): Number of simulation trajectories.\n        rng (numpy.random.Generator): A NumPy random number generator.\n\n    Returns:\n        float: The estimated probability of hitting the threshold M before time T.\n    \"\"\"\n    total_p_weighted_sum = 0.0\n\n    # Pre-compute constants for the likelihood calculation\n    log_b = np.log(b)\n    lambda_term = (b - 1) * lambda_\n\n    for _ in range(N):\n        t = 0.0\n        n = n0\n        n_births = 0\n\n        # Simulate a single trajectory until it hits the target or times out\n        while t < T and n < M:\n            # Biased propensities\n            a1_prime = b * lambda_\n            # Death propensity is 0 if n=0\n            a2_prime = mu * n if n > 0 else 0.0\n            a0_prime = a1_prime + a2_prime\n\n            # All parameters are positive, so a0_prime > 0 is guaranteed.\n            # Draw waiting time from exponential distribution under biased dynamics\n            dt = rng.exponential(scale=1.0 / a0_prime)\n\n            # Determine next state and time\n            t_next = t + dt\n\n            # If the next event would occur after the time horizon T,\n            # this trajectory does not hit the target. The loop will terminate.\n            if t_next >= T:\n                break\n\n            # Advance time and update state\n            t = t_next\n            \n            # Select reaction based on biased propensities\n            if rng.random() < a1_prime / a0_prime:\n                # Birth reaction\n                n += 1\n                n_births += 1\n            else:\n                # Death reaction\n                n -= 1\n        \n        # After the loop, check if the trajectory was a \"hit\"\n        # A hit occurs if the loop terminated because n >= M. \n        # The condition t < T is implicitly satisfied because of the loop break logic.\n        if n >= M:\n            # The path has hit the target M at time t.\n            # The stopping time is tau = t.\n            # Calculate the log-likelihood ratio for this path.\n            log_L = -n_births * log_b + lambda_term * t\n            \n            # Add the likelihood weight to the total sum.\n            L = np.exp(log_L)\n            total_p_weighted_sum += L\n\n    # The Monte Carlo estimate is the average of the weighted samples.\n    # Paths that did not hit contribute 0 to the sum.\n    return total_p_weighted_sum / N\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    # Set fixed random seed for reproducibility as required by the problem\n    rng = np.random.default_rng(12345)\n\n    # Test cases from the problem statement\n    test_cases = [\n        # (lambda, mu, n0, M, T, b, N)\n        (2.0, 0.2, 10, 40, 10.0, 2.5, 5000),  # Case A\n        (2.0, 0.2, 10, 40, 10.0, 1.0, 5000),  # Case B\n        (2.0, 0.2, 10, 40, 5.0, 2.5, 5000),   # Case C\n        (2.0, 0.2, 10, 50, 10.0, 3.0, 5000),  # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        lambda_, mu, n0, M, T, b, N = case\n        p_hat = run_is_simulation(lambda_, mu, n0, M, T, b, N, rng)\n        results.append(p_hat)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2648940"}]}