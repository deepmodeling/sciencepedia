{"hands_on_practices": [{"introduction": "在随机化学动力学的核心，单个反应事件被视为概率性的。此练习将引导您从第一性原理出发，为多个相互竞争的、遵循马尔可夫过程的反应通道推导出等待时间的分布。掌握这一基础推导，对于理解单分子实验中停留时间为何呈指数分布以及随机模拟算法（如Gillespie算法）的理论依据至关重要。[@problem_id:2694227]", "problem": "在一个体积恒定的均匀混合等温反应器中，考虑一个单分子动力学子系统，该系统有三个反应通道，其倾向在所关注的时间区间内不随时间变化。假设倾向分别为 $a_1=2$、$a_2=3$ 和 $a_3=5$，单位均为 $\\mathrm{s}^{-1}$。假设化学主方程 (CME) 描述适用，并且倾向代表了相应通道的瞬时风险率。从竞争指数风险的第一性原理出发，推导下一个反应事件的等待时间分布以及每个通道首先发生的概率。具体来说：根据无穷小定义，即在之前没有事件发生的条件下，通道 $i$ 在 $[t,t+\\mathrm{d}t)$ 内发生的概率为 $a_i\\,\\mathrm{d}t+o(\\mathrm{d}t)$，推导生存函数、等待时间 $T$ 的概率密度函数以及下一反应通道的概率。\n\n时间单位使用秒。请给出 $t \\ge 0$ 时概率密度函数 $f_T(t)$ 的解析表达式，以及通道 $1$、$2$ 和 $3$ 分别作为下一个事件的概率 $p_1$、$p_2$ 和 $p_3$。给出精确表达式，无需四舍五入。\n\n将你的最终答案表示为行矩阵 $\\big(f_T(t),\\,p_1,\\,p_2,\\,p_3\\big)$。", "solution": "所述问题具有科学依据、是良定的、客观的，并包含得出唯一且有意义解所需的所有信息。这是随机化学动力学理论中的一个标准问题，具体与 Gillespie 算法的基础有关。该问题是有效的。我们将从第一性原理开始进行推导。\n\n设 $T$ 为随机变量，表示到下一个反应事件发生的等待时间。给定三个独立的竞争反应通道，索引为 $i \\in \\{1, 2, 3\\}$。每个通道的倾向 $a_i$ 代表该反应的瞬时风险率。在时间 $t$ 之前没有反应发生的条件下，通道 $i$ 在无穷小时间区间 $[t, t+\\mathrm{d}t)$ 内发生的概率为 $a_i\\,\\mathrm{d}t + o(\\mathrm{d}t)$。\n\n*任何*反应发生的总倾向是各独立倾向之和，因为对于第一个反应来说，这些通道代表了互斥事件。设 $a_0$ 为总倾向：\n$$a_0 = \\sum_{i=1}^{3} a_i$$\n因此，在存活到时间 $t$ 的条件下，*任何*反应在 $[t, t+\\mathrm{d}t)$ 内发生的概率是 $a_0\\,\\mathrm{d}t + o(\\mathrm{d}t)$。\n\n首先，我们推导生存函数 $S(t) = P(T > t)$，它表示到时间 $t$ 为止没有反应发生的概率。存活超过时间 $t+\\mathrm{d}t$ 的概率是存活超过时间 $t$ 的概率乘以在区间 $[t, t+\\mathrm{d}t)$ 内没有事件发生的概率。\n$$S(t + \\mathrm{d}t) = S(t) \\times P(\\text{no event in } [t, t+\\mathrm{d}t) | T > t)$$\n在 $[t, t+\\mathrm{d}t)$ 内发生一个事件的概率是 $a_0\\,\\mathrm{d}t$，因此没有事件发生的概率是 $1 - a_0\\,\\mathrm{d}t$。我们忽略高阶项 $o(\\mathrm{d}t)$。\n$$S(t + \\mathrm{d}t) = S(t) (1 - a_0\\,\\mathrm{d}t)$$\n整理该表达式，得到微分形式：\n$$\\frac{S(t + \\mathrm{d}t) - S(t)}{\\mathrm{d}t} = -a_0 S(t)$$\n当 $\\mathrm{d}t \\to 0$ 时取极限，我们得到关于 $S(t)$ 的一阶常微分方程：\n$$\\frac{\\mathrm{d}S(t)}{\\mathrm{d}t} = -a_0 S(t)$$\n初始条件是在时间 $t=0$ 时存活是确定的，所以 $S(0) = 1$。该微分方程的解是：\n$$S(t) = \\exp(-a_0 t)$$\n\n接下来，我们推导等待时间 $T$ 的概率密度函数 (PDF) $f_T(t)$。PDF 与累积分布函数 (CDF) $F_T(t) = P(T \\le t)$ 的关系为 $f_T(t) = \\frac{\\mathrm{d}F_T(t)}{\\mathrm{d}t}$。CDF 与生存函数的关系为 $F_T(t) = 1 - S(t)$。因此：\n$$f_T(t) = \\frac{\\mathrm{d}}{\\mathrm{d}t} (1 - S(t)) = -\\frac{\\mathrm{d}S(t)}{\\mathrm{d}t}$$\n代入 $S(t)$ 的表达式：\n$$f_T(t) = -\\frac{\\mathrm{d}}{\\mathrm{d}t} (\\exp(-a_0 t)) = -(-a_0 \\exp(-a_0 t)) = a_0 \\exp(-a_0 t)$$\n这是速率参数为 $a_0$ 的指数分布的 PDF。\n使用给定的倾向值：\n$a_1 = 2 \\, \\mathrm{s}^{-1}$\n$a_2 = 3 \\, \\mathrm{s}^{-1}$\n$a_3 = 5 \\, \\mathrm{s}^{-1}$\n总倾向为：\n$$a_0 = a_1 + a_2 + a_3 = 2 + 3 + 5 = 10 \\, \\mathrm{s}^{-1}$$\n因此，等待时间 $T$ 的 PDF 为：\n$$f_T(t) = 10 \\exp(-10 t) \\quad \\text{for } t \\ge 0$$\n\n最后，我们推导通道 $i$ 作为特定发生通道的概率 $p_i$。这就是反应 $i$ “赢得竞争”的概率。通道 $i$ 在区间 $[t, t+\\mathrm{d}t)$ 内发生并且是第一个发生的事件的联合概率，是截至时间 $t$ 之前无事件发生的概率 $S(t)$ 与通道 $i$ 在 $[t, t+\\mathrm{d}t)$ 内发生的概率 $a_i\\,\\mathrm{d}t$ 的乘积。因此，概率元为 $S(t) a_i\\,\\mathrm{d}t = a_i \\exp(-a_0 t)\\,\\mathrm{d}t$。为求得总概率 $p_i$，我们对这个概率元在所有可能的等待时间 $t \\in [0, \\infty)$ 上积分：\n$$p_i = \\int_0^\\infty a_i \\exp(-a_0 t) \\,\\mathrm{d}t$$\n由于 $a_i$ 是一个不随时间变化的常数，我们可以将其从积分中提出：\n$$p_i = a_i \\int_0^\\infty \\exp(-a_0 t) \\,\\mathrm{d}t = a_i \\left[ -\\frac{1}{a_0} \\exp(-a_0 t) \\right]_0^\\infty$$\n$$p_i = a_i \\left( -\\frac{1}{a_0} (0) - \\left(-\\frac{1}{a_0} (1)\\right) \\right) = \\frac{a_i}{a_0}$$\n这证实了一个众所周知的结果：对于竞争泊松过程，某个特定过程最先发生的概率是其速率与总速率之比。\n现在我们计算具体的概率：\n$$p_1 = \\frac{a_1}{a_0} = \\frac{2}{10} = \\frac{1}{5}$$\n$$p_2 = \\frac{a_2}{a_0} = \\frac{3}{10}$$\n$$p_3 = \\frac{a_3}{a_0} = \\frac{5}{10} = \\frac{1}{2}$$\n作为检验，这些概率的总和必须为 1：$p_1 + p_2 + p_3 = \\frac{2}{10} + \\frac{3}{10} + \\frac{5}{10} = \\frac{10}{10} = 1$，这是正确的。\n\n所要求的量为 PDF $f_T(t)$ 和概率 $p_1$、$p_2$、$p_3$。\n$f_T(t) = 10 \\exp(-10 t)$\n$p_1 = \\frac{1}{5}$\n$p_2 = \\frac{3}{10}$\n$p_3 = \\frac{1}{2}$", "answer": "$$\\boxed{\\begin{pmatrix} 10 \\exp(-10 t) & \\frac{1}{5} & \\frac{3}{10} & \\frac{1}{2} \\end{pmatrix}}$$", "id": "2694227"}, {"introduction": "除了观测时间的限制，单分子实验通常还受到离散时间采样的影响，例如通过摄像机逐帧记录。这意味着我们无法精确知道状态转换的瞬间，而只能确定它发生在哪一个时间间隔 $\\Delta$ 内，这造成了所谓的“区间删失”。本练习将探讨这种时间离散化如何影响表观停留时间的测量，通过推导真实停留时间与观测值之间的概率关系，帮助您理解和建模这种重要的实验伪影。[@problem_id:2694298]", "problem": "一个双态化学反应网络的单分子报告系统在状态 $A$ 和状态 $B$ 之间交替变换。其潜在动力学被建模为连续时间马尔可夫链 (CTMC)，因此在任一给定状态下的每次停留都有一个连续的正持续时间 $T$。轨迹仅在离散的采样时间 $n\\Delta$（其中 $n \\in \\mathbb{Z}_{\\ge 0}$ 且 $\\Delta > 0$ 是采样间隔）被观测。在时间 $n\\Delta$ 的读出值定义为在开区间 $( (n-1)\\Delta, n\\Delta ]$ 内占主导地位的状态，因此在某个间隔内发生的任何状态转换都将在下一个采样时间首次被记录。记录的停留时长定义为分配给同一状态的连续采样点数量乘以 $\\Delta$。\n\n假设任何一次特定停留的开始时间相对于采样网格有一个未知的相位 $U$，其中 $U$ 与 $T$ 独立，并在 $(0,\\Delta]$ 上均匀分布。当采样与反应动力学异步时，这种均匀相位在平稳性和遍历性条件下出现。由于一次停留的开始和结束只能被定位到最近的采样时刻，离散采样的轨迹引入了区间删失：记录的停留时长等于一组 $\\Delta$ 的倍数中的一个，而这些值将真实持续时间 $T$ 包夹在内。\n\n固定一个整数 $k \\ge 1$，并考虑一次特定的停留，其真实持续时间 $T$ 满足 $T \\in ((k-1)\\Delta, k\\Delta]$。针对相位 $U$ 的随机性，推导这次真实停留被记录为恰好 $k\\Delta$ 的概率的闭式表达式（仅用 $T$ 和 $\\Delta$ 表示）。您的最终答案必须是一个无单位的单一解析表达式。", "solution": "该问题要求推导一个与连续时间过程的离散时间观测相关的概率。我们必须首先根据所提供的描述建立一个形式化模型。\n\n设时间轴被整数 $n$ 对应的采样时刻 $n\\Delta$ 所分割。在某个特定状态（比如状态 $A$）的一次停留开始于时间 $t_{start}$，结束于时间 $t_{end}$，其真实持续时间为 $T = t_{end} - t_{start}$。系统在 $t < t_{start}$ 和 $t \\ge t_{end}$ 时处于状态 $B$。\n\n问题陈述，停留的开始时间相对于采样网格有一个相位 $U$，其中 $U$ 在 $(0, \\Delta]$ 上均匀分布。不失一般性地，我们对齐时间轴，使得紧邻停留开始前的采样间隔为 $(-\\Delta, 0]$。那么停留开始于 $t_{start} = u_0$，其中 $u_0 \\in (0, \\Delta]$。相位 $U$ 就是这个值 $u_0$。为简化符号，我们用 $U$ 来表示开始时间这个随机变量本身，即 $t_{start}=U$，其中 $U \\sim \\text{Uniform}(0, \\Delta]$。因此，从状态 $B$ 到状态 $A$ 的转换发生在时间 $U$。停留随着在时间 $t_{end} = U+T$ 发生的从 $A$ 到 $B$ 的转换而结束。\n\n问题的核心在于解释连续时间轨迹如何被转换为离散的观测状态序列。问题为读出值的定义提供了两个条款：\n1. “在时间 $n\\Delta$ 的读出值定义为在开区间 $((n-1)\\Delta, n\\Delta]$ 内占主导地位的状态”\n2. “因此在某个间隔内发生的任何状态转换都将在下一个采样时间首次被记录。”\n\n第二个条款提供了一个更精确、无歧义的规则，澄清了第一个条款。设 $S_n$ 表示为区间 $I_n = ((n-1)\\Delta, n\\Delta]$ 记录的状态。该规则意味着，如果在 $I_n$ 内发生了状态转换，则记录的状态 $S_n$ 是紧邻区间 $I_n$ 开始前存在的状态。如果在 $I_n$ 内没有发生转换，$S_n$ 就是在整个区间内都存在的状态。\n\n让我们将此规则应用于停留过程。\n从 $B \\to A$ 的转换发生在时间 $t_{start} = U \\in (0, \\Delta]$。这个转换落在区间 $I_1 = (0, \\Delta]$ 内。根据该规则，为该区间记录的状态 $S_1$ 必须是该区间之前的状态，即 $B$。\n\n从 $A \\to B$ 的转换发生在时间 $t_{end} = U+T$。我们假设这个转换落在某个区间 $I_m = ((m-1)\\Delta, m\\Delta]$ 内（对于某个整数 $m$）。根据该规则，为这个区间记录的状态 $S_m$ 必须是区间 $I_m$ 之前的状态。由于 $m > 1$ (因为 $T>0, U>0$)，区间 $I_m$ 之前的状态是 $A$。因此，$S_m=A$。\n\n对于在开始和结束转换区间之间的任何区间 $I_n$，即对于 $1 < n < m$，在 $I_n$ 内没有转换发生。系统在每个这样的区间的整个持续时间内都处于状态 $A$。因此，对于 $n \\in \\{2, 3, \\ldots, m-1\\}$，记录的状态为 $S_n = A$。\n\n对于停留结束后的区间 $I_{m+1} = (m\\Delta, (m+1)\\Delta]$，系统自始至终处于状态 $B$。因此，$S_{m+1}=B$。\n\n因此，记录的状态序列为：$\\dots, S_0=B, S_1=B, S_2=A, S_3=A, \\dots, S_m=A, S_{m+1}=B, \\dots$。记录为状态 $A$ 的连续块由采样点 $S_2, \\dots, S_m$ 组成。分配给状态 $A$ 的连续采样点数量是 $m-1$。\n\n记录的停留时长定义为这个数量乘以 $\\Delta$。所以，记录的时长为 $(m-1)\\Delta$。问题要求这个记录的时长恰好为 $k\\Delta$（其中 $k \\ge 1$ 是一个固定整数）的概率。这要求连续的 $A$ 采样点数量为 $k$，即：$m-1 = k \\implies m = k+1$。\n\n条件 $m=k+1$ 意味着在 $t_{end}=U+T$ 的结束转换必须落在区间 $I_{k+1}$ 内。\n$t_{end} \\in I_{k+1} \\implies (k\\Delta, (k+1)\\Delta]$。\n所以，我们必须满足条件：\n$$k\\Delta < U+T \\le (k+1)\\Delta$$\n我们被要求找出此事件发生的概率。随机性在于 $U$，它在 $(0, \\Delta]$ 上均匀分布。真实持续时间 $T$ 被视为一个固定参数，并附带给定的约束条件 $T \\in ((k-1)\\Delta, k\\Delta]$。\n\n为了求此概率，我们可以在不等式中分离出 $U$：\n$$k\\Delta - T < U \\le (k+1)\\Delta - T$$\n该概率是满足此条件的 $U$ 的结果集合的测度，除以 $U$ 的总样本空间的测度。由于 $U$ 在 $(0, \\Delta]$ 上服从均匀分布，其概率密度函数为 $f_U(u) = 1/\\Delta$（当 $u \\in (0, \\Delta]$ 时）否则为 $0$。所求概率是成功区间 $(k\\Delta - T, (k+1)\\Delta - T]$ 与支撑区间 $(0, \\Delta]$ 的交集的长度，再全部除以 $\\Delta$。\n\n让我们分析 $U$ 的成功区间（我们将其记为 $J = (k\\Delta - T, (k+1)\\Delta - T]$）的边界。我们已知 $(k-1)\\Delta < T \\le k\\Delta$。\n对于 $J$ 的下界：\n$T \\le k\\Delta \\implies -T \\ge -k\\Delta \\implies k\\Delta - T \\ge k\\Delta - k\\Delta = 0$。\n$T > (k-1)\\Delta \\implies -T < -(k-1)\\Delta \\implies k\\Delta - T < k\\Delta - (k-1)\\Delta = \\Delta$。\n所以，下界 $k\\Delta-T$ 位于 $[0, \\Delta)$ 内。\n\n对于 $J$ 的上界：\n$T \\le k\\Delta \\implies -T \\ge -k\\Delta \\implies (k+1)\\Delta - T \\ge (k+1)\\Delta - k\\Delta = \\Delta$。\n$T > (k-1)\\Delta \\implies -T < -(k-1)\\Delta \\implies (k+1)\\Delta - T < (k+1)\\Delta - (k-1)\\Delta = 2\\Delta$。\n所以，上界 $(k+1)\\Delta-T$ 位于 $[\\Delta, 2\\Delta)$ 内。\n\n$U$ 的成功区间是 $(k\\Delta - T, (k+1)\\Delta - T]$，$U$ 的支撑区间是 $(0, \\Delta]$。这两个区间的交集是：\n$$ (k\\Delta - T, (k+1)\\Delta - T] \\cap (0, \\Delta] = (k\\Delta - T, \\Delta] $$\n这个交集的长度是 $\\Delta - (k\\Delta - T) = \\Delta - k\\Delta + T = T - (k-1)\\Delta$。\n\n概率是这个交集的长度除以 $U$ 的支撑区间的长度（即 $\\Delta$）：\n$$ P(\\text{Recorded length} = k\\Delta) = \\frac{\\text{Length of } (k\\Delta - T, \\Delta]}{\\text{Length of } (0, \\Delta]} = \\frac{T - (k-1)\\Delta}{\\Delta} $$\n这也可以写作 $\\frac{T}{\\Delta} - k + 1$。该表达式是最终答案，它用 $T$ 和 $\\Delta$ 给出了概率，其中 $k$ 是定义 $T$ 范围的整数。\n\n作为检验，对于一个给定的 $T \\in ((k-1)\\Delta, k\\Delta]$，记录的时长只能是 $(k-1)\\Delta$ 或 $k\\Delta$。记录的时长为 $(k-1)\\Delta$ 的概率可以通过条件 $U+T \\in ((k-1)\\Delta, k\\Delta]$ 计算。这导出的概率为 $k - T/\\Delta$。这两个唯一可能结果的概率之和为 $(\\frac{T}{\\Delta} - k + 1) + (k - \\frac{T}{\\Delta}) = 1$，这证实了该模型的一致性。", "answer": "$$\\boxed{\\frac{T - (k-1)\\Delta}{\\Delta}}$$", "id": "2694303"}, {"introduction": "理论模型通常假设观测是无限的，但所有实际实验都在有限时间内结束，这导致了数据中的“右删失”问题。本练习将介绍一种处理此类不完整数据的核心统计方法——右删失下的最大似然估计（MLE）。通过构建一个同时考虑已完成事件和删失事件的似然函数，您将学会如何从真实的、有限的单分子轨迹中准确地推断动力学速率（如 $k_{\\mathrm{on}}$ 和 $k_{\\mathrm{off}}$）。[@problem_id:2694303]", "problem": "一个单分子受体在“开启”状态和“关闭”状态之间切换，其过程遵循一个连续时间双态可逆反应网络。当受体处于“开启”状态时，它以一级速率常数 $k_{\\mathrm{off}}$ 离开该状态；当受体处于“关闭”状态时，它以一级速率常数 $k_{\\mathrm{on}}$ 离开该状态。在标准的停留时间分析假设下，每个状态的逗留（停留）时间是独立的，并服从指数分布，其参数为相应的离开速率。一个持续时间为 $T_{\\mathrm{obs}}$ 的有限观测窗口会产生独立的右删失：任何在时间 $T_{\\mathrm{obs}}$ 仍在进行的停留事件，其持续时间只记录到其被观测到的长度，并标记为删失数据。\n\n你观测到 $d_{\\mathrm{on}}$ 个完整的“开启”状态停留，其持续时间为 $\\{t_{i}^{\\mathrm{on}}\\}_{i=1}^{d_{\\mathrm{on}}}$ （每个都满足 $0<t_{i}^{\\mathrm{on}}<T_{\\mathrm{obs}}$），以及 $c_{\\mathrm{on}}$ 个右删失的“开启”状态停留，其观测长度为 $\\{u_{j}^{\\mathrm{on}}\\}_{j=1}^{c_{\\mathrm{on}}}$，其中每个 $u_{j}^{\\mathrm{on}}$ 等于 $T_{\\mathrm{obs}}-s_{j}^{\\mathrm{on}}$，$s_{j}^{\\mathrm{on}}\\in[0,T_{\\mathrm{obs}})$ 为其对应的开始时间。类似地，你观测到 $d_{\\mathrm{off}}$ 个完整的“关闭”状态停留，其持续时间为 $\\{t_{i}^{\\mathrm{off}}\\}_{i=1}^{d_{\\mathrm{off}}}$，以及 $c_{\\mathrm{off}}$ 个右删失的“关闭”状态停留，其观测长度为 $\\{u_{j}^{\\mathrm{off}}\\}_{j=1}^{c_{\\mathrm{off}}}$，其中每个 $u_{j}^{\\mathrm{off}}=T_{\\mathrm{obs}}-s_{j}^{\\mathrm{off}}$，$s_{j}^{\\mathrm{off}}\\in[0,T_{\\mathrm{obs}})$ 为其某个对应的开始时间。假设样本独立且删失为非信息性的（即在 $T_{\\mathrm{obs}}$ 停止观测与底层的转变动力学无关）。\n\n仅从指数概率密度函数 $f(t\\mid \\lambda)=\\lambda \\exp(-\\lambda t)$（对于 $t>0$）及其生存函数 $S(t\\mid \\lambda)=\\exp(-\\lambda t)$ 出发，并利用独立观测的似然乘积法则，执行以下操作：\n\n1. 针对右删失的观测数据，用 $k_{\\mathrm{off}}$ 和 $k_{\\mathrm{on}}$ 构建完整的似然函数。\n2. 在此删失方案下，推导 $k_{\\mathrm{off}}$ 和 $k_{\\mathrm{on}}$ 的最大似然估计量，将每个估计量纯粹用相应状态的已观测到的完整停留持续时间和删失长度来表示。\n\n以 $d_{\\mathrm{on}}$、$d_{\\mathrm{off}}$、$\\{t_{i}^{\\mathrm{on}}\\}$、$\\{u_{j}^{\\mathrm{on}}\\}$、$\\{t_{i}^{\\mathrm{off}}\\}$ 和 $\\{u_{j}^{\\mathrm{off}}\\}$ 的形式，给出 $\\hat{k}_{\\mathrm{off}}$ 和 $\\hat{k}_{\\mathrm{on}}$ 的闭式解析表达式作为最终答案。速率以 $\\mathrm{s}^{-1}$ 为单位表示，但最终答案的方框中不包含单位。不需要进行数值近似或四舍五入。", "solution": "问题陈述已经过验证，被认定为有效。它在科学上基于化学动力学和统计推断的原理，问题提法恰当、客观，并包含了严谨求解所需的所有必要信息。不存在不一致、矛盾或不科学的前提。因此，我们可以进行推导。\n\n该问题要求基于一个包含每个状态的完整（非删失）和右删失停留时间的数据集，推导一个双态动力学系统的速率常数 $k_{\\mathrm{off}}$ 和 $k_{\\mathrm{on}}$ 的最大似然估计量（MLEs）。\n\n为一组独立观测（其中一些可能被右删失）构建似然函数的基本原则如下：\n1. 对于一个非删失观测，即一个在时间 $t$ 被观测到完成的事件，其对似然的贡献是在 $t$ 处求值的概率密度函数（PDF），即 $f(t)$。\n2. 对于一个右删失观测，即一个只知道持续到至少时间 $u$ 的事件，其对似然的贡献是存活超过 $u$ 的概率。这由生存函数 $S(u)$ 给出。\n\n一组独立观测的总似然函数是各个贡献的乘积。\n\n问题陈述指出，“开启”和“关闭”状态的停留时间是独立的过程。“开启”状态的停留仅由速率常数 $k_{\\mathrm{off}}$ 决定，“关闭”状态的停留仅由 $k_{\\mathrm{on}}$ 决定。因此，总似然函数 $L(k_{\\mathrm{off}}, k_{\\mathrm{on}})$ 可以分解为两个独立的分量，每个状态一个：\n$$L(k_{\\mathrm{off}}, k_{\\mathrm{on}}) = L_{\\mathrm{on}}(k_{\\mathrm{off}}) \\cdot L_{\\mathrm{off}}(k_{\\mathrm{on}})$$\n这种分离使我们能够独立地最大化每个分量，以找到各自的最大似然估计量。\n\n我们首先考虑“开启”状态。停留时间 $t$ 服从指数分布，其速率参数为 $\\lambda = k_{\\mathrm{off}}$。其概率密度函数为 $f(t \\mid k_{\\mathrm{off}}) = k_{\\mathrm{off}} \\exp(-k_{\\mathrm{off}} t)$，生存函数为 $S(t \\mid k_{\\mathrm{off}}) = \\exp(-k_{\\mathrm{off}} t)$。\n“开启”状态的观测数据包括 $d_{\\mathrm{on}}$ 个完整的停留 $\\{t_{i}^{\\mathrm{on}}\\}_{i=1}^{d_{\\mathrm{on}}}$ 和 $c_{\\mathrm{on}}$ 个右删失的停留 $\\{u_{j}^{\\mathrm{on}}\\}_{j=1}^{c_{\\mathrm{on}}}$。\n\n“开启”状态数据的似然函数 $L_{\\mathrm{on}}(k_{\\mathrm{off}})$ 是完整停留的概率密度函数与删失停留的生存函数的乘积：\n$$L_{\\mathrm{on}}(k_{\\mathrm{off}}) = \\left( \\prod_{i=1}^{d_{\\mathrm{on}}} f(t_{i}^{\\mathrm{on}} \\mid k_{\\mathrm{off}}) \\right) \\left( \\prod_{j=1}^{c_{\\mathrm{on}}} S(u_{j}^{\\mathrm{on}} \\mid k_{\\mathrm{off}}) \\right)$$\n代入指数概率密度函数和生存函数的表达式：\n$$L_{\\mathrm{on}}(k_{\\mathrm{off}}) = \\left( \\prod_{i=1}^{d_{\\mathrm{on}}} k_{\\mathrm{off}} \\exp(-k_{\\mathrm{off}} t_{i}^{\\mathrm{on}}) \\right) \\left( \\prod_{j=1}^{c_{\\mathrm{on}}} \\exp(-k_{\\mathrm{off}} u_{j}^{\\mathrm{on}}) \\right)$$\n这个表达式可以通过合并项来简化：\n$$L_{\\mathrm{on}}(k_{\\mathrm{off}}) = (k_{\\mathrm{off}})^{d_{\\mathrm{on}}} \\exp\\left(-k_{\\mathrm{off}} \\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}}\\right) \\exp\\left(-k_{\\mathrm{off}} \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}}\\right)$$\n$$L_{\\mathrm{on}}(k_{\\mathrm{off}}) = (k_{\\mathrm{off}})^{d_{\\mathrm{on}}} \\exp\\left[-k_{\\mathrm{off}} \\left( \\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}} \\right)\\right]$$\n通过完全类似的推导，依赖于参数 $k_{\\mathrm{on}}$ 的“关闭”状态数据的似然函数是：\n$$L_{\\mathrm{off}}(k_{\\mathrm{on}}) = (k_{\\mathrm{on}})^{d_{\\mathrm{off}}} \\exp\\left[-k_{\\mathrm{on}} \\left( \\sum_{i=1}^{d_{\\mathrm{off}}} t_{i}^{\\mathrm{off}} + \\sum_{j=1}^{c_{\\mathrm{off}}} u_{j}^{\\mathrm{off}} \\right)\\right]$$\n完整的似然函数是乘积 $L(k_{\\mathrm{off}}, k_{\\mathrm{on}}) = L_{\\mathrm{on}}(k_{\\mathrm{off}}) \\cdot L_{\\mathrm{off}}(k_{\\mathrm{on}})$。这完成了第一个任务。\n\n为了推导最大似然估计量，我们需要最大化似然函数。通常更方便的做法是最大化似然函数的自然对数，即对数似然函数 $\\mathcal{L} = \\ln L$。由于 $\\ln$ 是一个单调函数，$\\mathcal{L}$ 的最大值与 $L$ 的最大值在相同的参数值处取得。\n总对数似然函数为：\n$$\\mathcal{L}(k_{\\mathrm{off}}, k_{\\mathrm{on}}) = \\ln L_{\\mathrm{on}}(k_{\\mathrm{off}}) + \\ln L_{\\mathrm{off}}(k_{\\mathrm{on}}) = \\mathcal{L}_{\\mathrm{on}}(k_{\\mathrm{off}}) + \\mathcal{L}_{\\mathrm{off}}(k_{\\mathrm{on}})$$\n我们可以分别对 $k_{\\mathrm{off}}$ 最大化 $\\mathcal{L}_{\\mathrm{on}}$ 和对 $k_{\\mathrm{on}}$ 最大化 $\\mathcal{L}_{\\mathrm{off}}$。\n\n对于“开启”状态：\n$$\\mathcal{L}_{\\mathrm{on}}(k_{\\mathrm{off}}) = \\ln\\left( (k_{\\mathrm{off}})^{d_{\\mathrm{on}}} \\exp\\left[-k_{\\mathrm{off}} \\left( \\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}} \\right)\\right] \\right)$$\n$$\\mathcal{L}_{\\mathrm{on}}(k_{\\mathrm{off}}) = d_{\\mathrm{on}} \\ln(k_{\\mathrm{off}}) - k_{\\mathrm{off}} \\left( \\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}} \\right)$$\n为了找到最大似然估计量 $\\hat{k}_{\\mathrm{off}}$，我们将 $\\mathcal{L}_{\\mathrm{on}}$ 对 $k_{\\mathrm{off}}$ 求一阶导数，并令其等于零：\n$$\\frac{\\partial \\mathcal{L}_{\\mathrm{on}}}{\\partial k_{\\mathrm{off}}} = \\frac{d_{\\mathrm{on}}}{k_{\\mathrm{off}}} - \\left( \\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}} \\right) = 0$$\n求解 $k_{\\mathrm{off}}$ 得到估计量 $\\hat{k}_{\\mathrm{off}}$：\n$$\\frac{d_{\\mathrm{on}}}{\\hat{k}_{\\mathrm{off}}} = \\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}}$$\n$$\\hat{k}_{\\mathrm{off}} = \\frac{d_{\\mathrm{on}}}{\\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}}}$$\n二阶导数 $\\frac{\\partial^2 \\mathcal{L}_{\\mathrm{on}}}{\\partial k_{\\mathrm{off}}^2} = -\\frac{d_{\\mathrm{on}}}{k_{\\mathrm{off}}^2}$，对于任何 $d_{\\mathrm{on}} > 0$ 都是负的，这证实了该临界点是一个最大值点。这个结果的物理解释是，估计的速率是在该状态下观测到的离开事件数（$d_{\\mathrm{on}}$）除以在该状态下观测到的总时间（所有完整持续时间和删失持续时间的总和）。\n\n$\\hat{k}_{\\mathrm{on}}$ 的推导形式上是完全相同的。“关闭”状态的对数似然函数是：\n$$\\mathcal{L}_{\\mathrm{off}}(k_{\\mathrm{on}}) = d_{\\mathrm{off}} \\ln(k_{\\mathrm{on}}) - k_{\\mathrm{on}} \\left( \\sum_{i=1}^{d_{\\mathrm{off}}} t_{i}^{\\mathrm{off}} + \\sum_{j=1}^{c_{\\mathrm{off}}} u_{j}^{\\mathrm{off}} \\right)$$\n将其对 $k_{\\mathrm{on}}$ 的导数设为零，得到最大似然估计量 $\\hat{k}_{\\mathrm{on}}$：\n$$\\frac{\\partial \\mathcal{L}_{\\mathrm{off}}}{\\partial k_{\\mathrm{on}}} = \\frac{d_{\\mathrm{off}}}{k_{\\mathrm{on}}} - \\left( \\sum_{i=1}^{d_{\\mathrm{off}}} t_{i}^{\\mathrm{off}} + \\sum_{j=1}^{c_{\\mathrm{off}}} u_{j}^{\\mathrm{off}} \\right) = 0$$\n$$\\hat{k}_{\\mathrm{on}} = \\frac{d_{\\mathrm{off}}}{\\sum_{i=1}^{d_{\\mathrm{off}}} t_{i}^{\\mathrm{off}} + \\sum_{j=1}^{c_{\\mathrm{off}}} u_{j}^{\\mathrm{off}}}$$\n最终答案给出了这两个估计量。矩阵的第一个元素对应于 $k_{\\mathrm{off}}$ 的估计量，第二个元素对应于 $k_{\\mathrm{on}}$ 的估计量。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{d_{\\mathrm{on}}}{\\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}}} & \\frac{d_{\\mathrm{off}}}{\\sum_{i=1}^{d_{\\mathrm{off}}} t_{i}^{\\mathrm{off}} + \\sum_{j=1}^{c_{\\mathrm{off}}} u_{j}^{\\mathrm{off}}}\n\\end{pmatrix}\n}\n$$", "id": "2694298"}]}