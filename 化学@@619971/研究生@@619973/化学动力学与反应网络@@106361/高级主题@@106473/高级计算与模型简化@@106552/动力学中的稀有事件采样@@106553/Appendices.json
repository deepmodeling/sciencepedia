{"hands_on_practices": [{"introduction": "在稀有事件动力学中，“committor”概率是定义反应坐标和理解过渡路径的核心概念。本练习将通过一个简化的线性链模型，引导您从基本原理出发，解析地推导出committor概率。通过这个实践，您将深刻理解committor是如何由系统底层的转移速率决定的，为掌握更复杂的稀有事件方法奠定坚实的理论基础。[@problem_id:2667193]", "problem": "考虑一个连续时间马尔可夫链 (CTMC)，其状态空间为一个包含 $N+1$ 个状态 $\\{0,1,2,\\dots,N\\}$ 的线性链，且仅有最近邻跃迁。对于每个内部状态 $i \\in \\{1,2,\\dots,N-1\\}$，向右跃迁的速率为 $k_{i,i+1} > 0$，向左跃迁的速率为 $k_{i,i-1} > 0$。状态 $0$ 和 $N$ 分别是吸收集 $A$ 和 $B$，在稀有事件采样情境中代表反应物盆和产物盆。定义承诺概率 (committor) $q_i$ 为从状态 $i$ 出发，过程在到达 $A$ 之前先到达 $B$ 的概率。\n\n请仅使用CTMC随机动力学的基础原理以及承诺概率作为吸收概率的定义，推导所有状态 $i \\in \\{0,1,\\dots,N\\}$ 的承诺概率 $q_i$ 的解析表达式，并满足边界条件 $q_0 = 0$ 和 $q_N = 1$。然后，设过程从一个指定的内部状态 $i_0 \\in \\{1,2,\\dots,N-1\\}$ 开始，计算在到达 $A$ 之前先到达 $B$ 的分裂概率（此概率等于 $q_{i_0}$），并将其表示为关于速率 $k_{i,i\\pm 1}$ 和下标的单一闭式表达式。请将最终答案表示为单个解析表达式。无需进行数值计算或四舍五入。", "solution": "所述问题具有科学依据，提法明确且客观。这是随机过程理论中的一个标准问题，具体涉及一维连续时间马尔可夫链的击中概率计算。下面我将进行其形式化推导。\n\n该系统是一个定义在离散状态空间 $\\mathcal{S} = \\{0, 1, 2, \\dots, N\\}$ 上的连续时间马尔可夫链。状态 $0$ 和 $N$ 是吸收态，分别代表集合 $A$ 和 $B$。对于任意内部状态 $i \\in \\{1, 2, \\dots, N-1\\}$，跃迁只允许发生在相邻的状态 $i-1$ 和 $i+1$ 之间，其速率分别为 $k_{i,i-1} > 0$ 和 $k_{i,i+1} > 0$。\n\n承诺概率 $q_i$ 是指过程从状态 $i$ 出发，在到达状态 $0$ 之前先到达状态 $N$ 的概率。根据定义，对于吸收边界，我们有以下条件：\n$$q_0 = 0$$\n$$q_N = 1$$\n\n对于任意内部状态 $i \\in \\{1, 2, \\dots, N-1\\}$，我们可以通过对第一次跃迁事件设置条件来建立关于 $q_i$ 的方程。离开状态 $i$ 的总速率为 $K_i = k_{i,i+1} + k_{i,i-1}$。下一次跃迁到状态 $i+1$ 的概率为 $p_{i,i+1} = \\frac{k_{i,i+1}}{K_i}$，跃迁到状态 $i-1$ 的概率为 $p_{i,i-1} = \\frac{k_{i,i-1}}{K_i}$。\n\n根据全概率定律，$q_i$ 是其后继状态的承诺概率的加权平均，权重为各自的跃迁概率：\n$$q_i = q_{i+1} \\cdot p_{i,i+1} + q_{i-1} \\cdot p_{i,i-1}$$\n代入概率的表达式：\n$$q_i = q_{i+1} \\frac{k_{i,i+1}}{k_{i,i+1} + k_{i,i-1}} + q_{i-1} \\frac{k_{i,i-1}}{k_{i,i+1} + k_{i,i-1}}$$\n两边乘以分母 $(k_{i,i+1} + k_{i,i-1})$ 得：\n$$q_i (k_{i,i+1} + k_{i,i-1}) = q_{i+1} k_{i,i+1} + q_{i-1} k_{i,i-1}$$\n这就是承诺概率的后向主方程。我们可以重新整理这个方程以揭示一个更简单的结构。\n$$q_i k_{i,i+1} - q_{i+1} k_{i,i+1} = q_{i-1} k_{i,i-1} - q_i k_{i,i-1}$$\n$$-k_{i,i+1}(q_{i+1} - q_i) = -k_{i,i-1}(q_i - q_{i-1})$$\n$$k_{i,i+1}(q_{i+1} - q_i) = k_{i,i-1}(q_i - q_{i-1})$$\n该方程对所有 $i \\in \\{1, 2, \\dots, N-1\\}$ 成立。我们定义差值 $\\Delta_j = q_{j+1} - q_j$，其中 $j \\in \\{0, 1, \\dots, N-1\\}$。对于 $i \\in \\{1, 2, \\dots, N-1\\}$，上述方程可以写作：\n$$k_{i,i+1} \\Delta_i = k_{i,i-1} \\Delta_{i-1}$$\n这给出了差值 $\\Delta_i$ 的一阶递推关系：\n$$\\Delta_i = \\frac{k_{i,i-1}}{k_{i,i+1}} \\Delta_{i-1}$$\n我们可以通过迭代来解这个递推关系。对于 $i=1$，我们有 $\\Delta_1 = \\frac{k_{1,0}}{k_{1,2}} \\Delta_0$。对于 $i=2$，我们有 $\\Delta_2 = \\frac{k_{2,1}}{k_{2,3}} \\Delta_1 = \\frac{k_{2,1}}{k_{2,3}} \\frac{k_{1,0}}{k_{1,2}} \\Delta_0$。\n通过归纳法，对于 $j \\in \\{1, \\dots, N-1\\}$，$\\Delta_j$ 的通解是：\n$$\\Delta_j = \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right) \\Delta_0$$\n如果我们采用标准约定，即空积（对于 $j=0$）等于 $1$，那么这个表达式对 $j=0$ 也成立。\n\n现在，我们可以通过对这些差值求和来表示 $q_i$。使用裂项求和法：\n$$q_i - q_0 = \\sum_{j=0}^{i-1} (q_{j+1} - q_j) = \\sum_{j=0}^{i-1} \\Delta_j$$\n由于边界条件为 $q_0 = 0$，我们得到：\n$$q_i = \\sum_{j=0}^{i-1} \\Delta_j = \\sum_{j=0}^{i-1} \\left( \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right) \\Delta_0 \\right)$$\n提出常数 $\\Delta_0$：\n$$q_i = \\Delta_0 \\sum_{j=0}^{i-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)$$\n未知常数 $\\Delta_0 = q_1 - q_0 = q_1$ 可以通过应用第二个边界条件 $q_N=1$ 来确定。我们在上述表达式中令 $i=N$：\n$$q_N = 1 = \\Delta_0 \\sum_{j=0}^{N-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)$$\n由此，我们解出 $\\Delta_0$：\n$$\\Delta_0 = \\frac{1}{\\sum_{j=0}^{N-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)}$$\n将这个 $\\Delta_0$ 的表达式代回到 $q_i$ 的方程中，我们便得到对于任意状态 $i \\in \\{0, 1, \\dots, N\\}$ 的承诺概率的通解：\n$$q_i = \\frac{\\sum_{j=0}^{i-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)}{\\sum_{j=0}^{N-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)}$$\n对于 $i=0$，分子中的和是空和，其值为 $0$，因此得到 $q_0=0$。对于 $i=N$，分子和分母相同，因此得到 $q_N=1$。两个边界条件都得到满足。\n\n问题要求的是从内部状态 $i_0 \\in \\{1, 2, \\dots, N-1\\}$ 出发，在到达 $A$ 之前先到达 $B$ 的分裂概率。根据定义，这个概率就是 $q_{i_0}$。因此，最终的解析表达式可以通过在通解中令 $i=i_0$ 来获得。", "answer": "$$\n\\boxed{\n\\frac{\\sum_{j=0}^{i_0-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)}{\\sum_{j=0}^{N-1} \\left( \\prod_{m=1}^{j} \\frac{k_{m,m-1}}{k_{m,m+1}} \\right)}\n}\n$$", "id": "2667193"}, {"introduction": "过渡态理论（Transition State Theory, TST）是计算反应速率的基石，其准确性在很大程度上依赖于一个无重穿（no-recrossing）的分割面的选择。本练习探讨当分割面选择不佳时，对计算速率产生的影响。通过在一个谐波势垒模型上解析地量化这种偏差，您将亲身体会到为何反应坐标的选择至关重要，并理解更先进的采样方法旨在解决的核心难题。[@problem_id:2667175]", "problem": "考虑一个鞍点附近的二维哈密顿越垒模型，这是化学动力学和反应网络中稀有事件越垒的标准局域模型。其哈密顿量为\n$$\nH(x,y,p_x,p_y) \\;=\\; \\frac{p_x^2}{2m} \\;+\\; \\frac{p_y^2}{2m} \\;+\\; V(x,y),\n$$\n其二次势为\n$$\nV(x,y) \\;=\\; E^{\\ddagger} \\;-\\; \\frac{1}{2} m \\lambda^2 x^2 \\;+\\; \\frac{1}{2} m \\omega^2 y^2,\n$$\n其中 $m>0$ 是质量，$\\lambda>0$ 是沿 $x$ 轴的（不稳定）势垒频率，$\\omega>0$ 是沿 $y$ 轴的（稳定）频率，$E^{\\ddagger}$ 是垒顶能量。系统在温度 $T$ 下处于热平衡状态，因此初始条件根据 Maxwell–Boltzmann 分布抽取，其逆温度为 $\\beta = 1/(k_B T)$，其中 $k_B$ 是 Boltzmann 常数。\n\n在过渡态理论（TST）中，速率常数通过穿过一个分界面的平衡正通量来估计。对于这个谐振鞍，精确的无重穿分界面是满足 $p_x$ 为正的 $x=0$ 平面。假设我们改用一个次优的平面分界面，它由单位法向量 $\\boldsymbol{n}=(\\cos\\theta,\\sin\\theta)$ 定义，该法向量与不稳定的 $x$ 轴的夹角为 $\\theta\\in(-\\pi/2,\\pi/2)$，即\n$$\n\\boldsymbol{n}\\cdot\\boldsymbol{q} \\;=\\; \\cos\\theta\\,x \\;+\\; \\sin\\theta\\,y \\;=\\; 0,\n$$\n且具有正的法向动量分量 $p_n = \\boldsymbol{n}\\cdot\\boldsymbol{p} > 0$。令 $k_{\\mathrm{TST}}(\\theta)$ 表示使用这个倾斜分界面得到的 TST 估计速率，令 $k_{\\mathrm{true}}$ 表示该谐振模型的精确速率，由于 $x=0$ 曲面在该模型中是无重穿的，因此 $k_{\\mathrm{true}}$ 等于 $k_{\\mathrm{TST}}(0)$。\n\n仅使用正则 Maxwell–Boltzmann 分布、鞍点附近的哈密顿动力学以及过渡态理论的平衡正通量定义（不使用任何预先推导的透射系数），推导乘性偏差因子\n$$\nb(\\theta) \\;=\\; \\frac{k_{\\mathrm{TST}}(\\theta)}{k_{\\mathrm{true}}}\n$$\n该因子适用于上述具有未对准分界面的谐振势垒。您的推导必须从跨越分界面的相空间通量积分开始，并通过显式高斯积分进行。请说明谐振鞍通量积分收敛时 $\\theta$ 需满足的任何条件。\n\n请以 $\\lambda$、$\\omega$ 和 $\\theta$ 的单个闭式解析表达式的形式给出 $b(\\theta)$ 的最终答案。不需要进行数值计算，最终答案中不应包含单位。", "solution": "本问题要求推导在一个二维谐振鞍点模型中，使用未对准分界面进行过渡态理论（TST）速率计算时的乘性偏差因子 $b(\\theta) = k_{\\mathrm{TST}}(\\theta)/k_{\\mathrm{true}}$。真实速率 $k_{\\mathrm{true}}$ 对应于使用最优分界面（$\\theta=0$）时的 TST 速率，因此 $k_{\\mathrm{true}} = k_{\\mathrm{TST}}(0)$。所以，偏差因子为 $b(\\theta) = k_{\\mathrm{TST}}(\\theta)/k_{\\mathrm{TST}}(0)$。\n\nTST 速率常数与通过分界面的平衡通量成正比。由于我们计算的是同一系统的两个速率常数的比率，出现在完整 TST 表达式分母中的反应物配分函数将会被消去。因此，我们只需要计算通量积分本身的比率。\n\n通过由 $f(\\boldsymbol{q})=0$ 定义的分界面的平衡通量 $\\Phi$ 由以下相空间积分给出：\n$$\n\\Phi = \\int d\\boldsymbol{p} \\int d\\boldsymbol{q} \\; \\delta(f(\\boldsymbol{q})) \\; (\\boldsymbol{v} \\cdot \\boldsymbol{n}) \\; \\Theta(\\boldsymbol{v} \\cdot \\boldsymbol{n}) \\; \\frac{\\exp(-\\beta H(\\boldsymbol{p}, \\boldsymbol{q}))}{Z_{\\text{total}}}\n$$\n其中 $\\boldsymbol{v}=\\boldsymbol{p}/m$ 是速度，$\\boldsymbol{n}$ 是曲面的单位法向量，$\\Theta$ 是 Heaviside 阶跃函数，$H$ 是哈密顿量，$\\beta = 1/(k_B T)$。总配分函数 $Z_{\\text{total}}$ 是一个常数，在比率计算中会被消去。因此，我们可以使用一个与通量成正比的量，并省略配分函数的归一化。\n\n指定的分界面是一个由 $\\boldsymbol{n}\\cdot\\boldsymbol{q} = x\\cos\\theta + y\\sin\\theta = 0$ 定义的平面，其法向量为 $\\boldsymbol{n}=(\\cos\\theta,\\sin\\theta)$。对应的法向速度分量为 $v_n = (\\boldsymbol{p}\\cdot\\boldsymbol{n})/m = (p_x\\cos\\theta + p_y\\sin\\theta)/m$。对于给定的角度 $\\theta$，我们记为 $\\Phi(\\theta)$ 的通量积分为：\n$$\n\\Phi(\\theta) \\propto \\int dp_x dp_y dx dy \\; \\delta(x\\cos\\theta + y\\sin\\theta) \\; \\frac{p_x\\cos\\theta + p_y\\sin\\theta}{m} \\; \\Theta(p_x\\cos\\theta + p_y\\sin\\theta) \\; \\exp(-\\beta H)\n$$\n其哈密顿量为 $H = \\frac{p_x^2 + p_y^2}{2m} + E^{\\ddagger} - \\frac{1}{2} m \\lambda^2 x^2 + \\frac{1}{2} m \\omega^2 y^2$。\n\n为了简化积分，我们进行坐标系旋转。设新坐标为位置坐标 $(q_n, q_s)$ 和动量坐标 $(p_n, p_s)$，分别与法向量 $\\boldsymbol{n}=(\\cos\\theta, \\sin\\theta)$ 和切向量 $\\boldsymbol{s}=(-\\sin\\theta, \\cos\\theta)$ 对齐。\n变换关系为：\n$q_n = x\\cos\\theta + y\\sin\\theta$\n$q_s = -x\\sin\\theta + y\\cos\\theta$\n$x = q_n\\cos\\theta - q_s\\sin\\theta$\n$y = q_n\\sin\\theta + q_s\\cos\\theta$\n\n对于动量：\n$p_n = p_x\\cos\\theta + p_y\\sin\\theta$\n$p_s = -p_x\\sin\\theta + p_y\\cos\\theta$\n此变换的雅可比行列式为 1，所以 $dx dy dp_x dp_y = dq_n dq_s dp_n dp_s$。动能变为 $\\frac{p_x^2+p_y^2}{2m} = \\frac{p_n^2+p_s^2}{2m}$。现在分界面简化为 $q_n = 0$，通量条件为 $p_n > 0$。\n\ndelta 函数 $\\delta(x\\cos\\theta + y\\sin\\theta)$ 变为 $\\delta(q_n)$。对 $q_n$ 积分会将积分表达式的其余部分中的 $q_n$ 设为 0。当 $q_n=0$ 时，势能项 $V(x,y)$ 变为 $q_s$ 的函数：\n$$\nV(q_n=0, q_s) = E^{\\ddagger} - \\frac{1}{2} m \\lambda^2 (-q_s\\sin\\theta)^2 + \\frac{1}{2} m \\omega^2 (q_s\\cos\\theta)^2 \\\\\n= E^{\\ddagger} + \\frac{1}{2} m (\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta) q_s^2\n$$\n在新坐标系下，通量积分 $\\Phi(\\theta)$ 为：\n$$\n\\Phi(\\theta) \\propto \\int dp_n dp_s dq_s dq_n \\; \\delta(q_n) \\; \\frac{p_n}{m} \\; \\Theta(p_n) \\; \\exp\\left(-\\beta \\left[ \\frac{p_n^2+p_s^2}{2m} + V(q_n=0, q_s) \\right]\\right)\n$$\n对 $q_n$ 积分并代入势能后，积分可以分离为：\n$$\n\\Phi(\\theta) \\propto \\frac{\\exp(-\\beta E^{\\ddagger})}{m} \\left( \\int_0^{\\infty} dp_n \\, p_n \\exp\\left(-\\frac{\\beta p_n^2}{2m}\\right) \\right) \\left( \\int_{-\\infty}^{\\infty} dp_s \\, \\exp\\left(-\\frac{\\beta p_s^2}{2m}\\right) \\right) \\left( \\int_{-\\infty}^{\\infty} dq_s \\, \\exp\\left(-\\frac{\\beta m}{2}(\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta)q_s^2\\right) \\right)\n$$\n我们计算这三个标准积分：\n1.  对 $p_n$ 的积分：令 $u = \\beta p_n^2 / (2m)$，则 $du = (\\beta p_n / m) dp_n$。\n    $$ \\int_0^{\\infty} p_n \\exp\\left(-\\frac{\\beta p_n^2}{2m}\\right) dp_n = \\frac{m}{\\beta} \\int_0^{\\infty} e^{-u} du = \\frac{m}{\\beta} $$\n2.  对 $p_s$ 的积分是一个高斯积分：\n    $$ \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta}{2m} p_s^2\\right) dp_s = \\sqrt{\\frac{2\\pi m}{\\beta}} $$\n3.  对 $q_s$ 的积分也是一个高斯积分。为使此积分收敛，指数中的二次项系数必须为正：$\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta > 0$。这意味着 $\\omega^2 > \\lambda^2 \\tan^2\\theta$，即 $|\\tan\\theta| < \\omega/\\lambda$。这是 TST 通量积分为有限值时 $\\theta$ 需满足的条件。假设此条件成立：\n    $$ \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta m}{2}(\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta)q_s^2\\right) dq_s = \\sqrt{\\frac{2\\pi}{\\beta m (\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta)}} $$\n\n综合这些结果，通量 $\\Phi(\\theta)$ 与以下表达式成正比：\n$$\n\\Phi(\\theta) \\propto \\frac{\\exp(-\\beta E^{\\ddagger})}{m} \\cdot \\frac{m}{\\beta} \\cdot \\sqrt{\\frac{2\\pi m}{\\beta}} \\cdot \\sqrt{\\frac{2\\pi}{\\beta m (\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta)}}\n$$\n$$\n\\Phi(\\theta) \\propto \\frac{2\\pi \\exp(-\\beta E^{\\ddagger})}{\\beta^2 \\sqrt{\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta}}\n$$\n我们关心的是比率 $b(\\theta) = \\Phi(\\theta)/\\Phi(0)$。我们将 $\\theta=0$ 代入上述表达式来求 $\\Phi(0)$：\n$$\n\\Phi(0) \\propto \\frac{2\\pi \\exp(-\\beta E^{\\ddagger})}{\\beta^2 \\sqrt{\\omega^2 \\cos^2(0) - \\lambda^2 \\sin^2(0)}} = \\frac{2\\pi \\exp(-\\beta E^{\\ddagger})}{\\beta^2 \\omega}\n$$\n偏差因子即为该比率：\n$$\nb(\\theta) = \\frac{\\Phi(\\theta)}{\\Phi(0)} = \\frac{\\frac{2\\pi \\exp(-\\beta E^{\\ddagger})}{\\beta^2 \\sqrt{\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta}}}{\\frac{2\\pi \\exp(-\\beta E^{\\ddagger})}{\\beta^2 \\omega}} = \\frac{\\omega}{\\sqrt{\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta}}\n$$\n这就是乘性偏差因子的最终表达式。该因子大于或等于 $1$，这反映了非最优分界面允许重穿，而 TST 会错误地将重穿计为反应事件，从而高估了速率。\n此计算有效的条件是倾斜曲面的通量积分收敛，即 $|\\tan\\theta| < \\omega/\\lambda$。", "answer": "$$\n\\boxed{\\frac{\\omega}{\\sqrt{\\omega^2 \\cos^2\\theta - \\lambda^2 \\sin^2\\theta}}}\n$$", "id": "2667175"}, {"introduction": "在理解了传统理论的局限性后，我们将目光转向一种强大的现代稀有事件采样算法：前向通量采样（Forward Flux Sampling, FFS）。FFS通过一系列界面将稀有事件分解为多个更概然的步骤，并直接计算成功前进的路径概率。本练习将理论与计算实践相结合，要求您基于FFS的核心原理设计一个协议，并利用模拟数据估算真实的转变速率，从而将committor和路径概率的概念付诸实践。[@problem_id:2667199]", "problem": "考虑一个由化学主方程（CME）控制的连续时间马尔可夫跳跃过程，该过程具有两个长寿命的吸引盆，记为状态 $A$ 和状态 $B$，并且有一个序参量 $\\lambda(x)$，它沿着从 $A$ 到 $B$ 的典型反应轨迹单调增加。假设在稀有转变到 $B$ 的时间尺度上，系统具有平稳性，即 $A$ 盆内的概率分布是时不变的。前向通量采样（FFS）是一种稀有事件采样策略，它将稀有的 $A \\to B$ 转变分解为一系列在序参量空间中位于 $A$ 和 $B$ 之间的界面，并使用经验频率来估计转变速率。\n\n您必须从以下基本定义出发：\n- 稳态通量是单位物理时间内特定事件的期望数量。如果在物理时间 $T$（以秒为单位）内观测到事件计数为 $c$，则经验通量为 $c/T$，单位为 $\\text{s}^{-1}$。\n- 在指定替代事件发生之前，一个成功事件发生的条件概率是观测到的成功次数与从条件集合开始的试验总次数之比，前提是这些试验是从该集合开始的独立重启。\n\n任务 A（概念性）：仅从这些定义和 CME 的马尔可夫性质出发，为具有序参量 $\\lambda(x)$ 的双稳态反应网络指定一个有效的前向通量采样（FFS）协议，用于估计 $A \\to B$ 的转变速率。您的描述必须明确指出：\n- 一系列界面 $\\lambda_0, \\lambda_1, \\dots, \\lambda_M$ 的作用，其中 $\\lambda_0$ 刚过 $A$ 区域，$\\lambda_M$ 定义了进入 $B$ 区域的边界。\n- 测量从 $A$ 出发首次穿越 $\\lambda_0$ 的稳态通量的过程。\n- 在每个界面 $\\lambda_i$ 处，使用在 $\\lambda_i$ 处开始的独立试验，估计在返回 $A$ 之前到达 $\\lambda_{i+1}$ 的条件分裂概率的过程。\n- 确保经验频率是底层通量和条件概率的有效估计量所需的独立性和初始化要求。\n\n任务 B（计算性）：仅使用上述基本原理，推导出一个以 $\\text{s}^{-1}$ 为单位的 $A \\to B$ 转变速率的估计量，该估计量用以下参数表示：\n- 在观测时间 $T$（以秒为单位）内，从 $A$ 首次穿越 $\\lambda_0$ 的测量计数 $c$。\n- 对于每个界面索引 $i \\in \\{0,1,\\dots,M-1\\}$，在 $\\lambda_i$ 处开始的试验次数 $n_i$，以及其中在返回 $A$ 之前到达 $\\lambda_{i+1}$ 的试验次数 $s_i$。\n\n实现一个程序，为以下每个测试用例计算估计的转变速率。对每个用例，使用经验频率 $c/T$ 作为通量，使用经验频率 $s_i/n_i$ 作为每个条件概率，并在指定序列的所有界面上取乘积。如果任何 $s_i = 0$ 且 $n_i > 0$，根据经验频率的定义，该用例的估计值为 $0$。如果 $c=0$，则估计值为 $0$，因为经验通量为 $0$。假设所有给定的 $n_i$ 均为严格正数，并且 $0 \\le s_i \\le n_i$ 成立。\n\n将所有最终数值答案以 $\\text{s}^{-1}$ 为单位表示为浮点数。\n\n测试套件：\n- 用例 1：$T = 10^7$ 秒, $c = 500$, $M = 4$, $n = \\{2000, 1500, 1000, 800\\}$, $s = \\{600, 180, 36, 18\\}$。\n- 用例 2：$T = 5 \\times 10^6$ 秒, $c = 50$, $M = 1$, $n = \\{1000\\}$, $s = \\{5\\}$。\n- 用例 3：$T = 10^7$ 秒, $c = 1000$, $M = 3$, $n = \\{1000, 500, 500\\}$, $s = \\{400, 0, 250\\}$。\n- 用例 4：$T = 10^6$ 秒, $c = 0$, $M = 2$, $n = \\{100, 100\\}$, $s = \\{12, 3\\}$。\n- 用例 5：$T = 2 \\times 10^8$ 秒, $c = 1200$, $M = 6$, $n = \\{5000, 4000, 3000, 2500, 2000, 1500\\}$, $s = \\{250, 80, 24, 6, 2, 1\\}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用例 1 到 5 的估计速率，作为一个逗号分隔的列表，并用方括号括起来，顺序如上所示（例如，$[r_1,r_2,r_3,r_4,r_5]$），其中每个 $r_i$ 是一个以 $\\text{s}^{-1}$ 为单位的浮点数。不要包含任何额外的文本。", "solution": "所提出的问题是在稀有事件采样理论中一个适定且有科学依据的练习。它要求从第一性原理出发，推导并应用前向通量采样（FFS）速率常数估计量。问题陈述是完整、一致的，并遵循了随机化学动力学的既定框架。我们将开始进行解答。\n\n基本目标是估计一个系统的转变速率常数，记为 $k_{AB}$，该系统从一个亚稳态 $A$ 转变到另一个状态 $B$，其动力学由一个连续时间马尔可夫跳跃过程描述。这种转变是一个稀有事件，意味着在直接模拟中观测到它在计算上是不可行的。FFS 通过将稀有转变路径分解为一系列更可能发生的小步骤来解决这个问题。\n\n速率常数 $k_{AB}$ 代表了源于状态 $A$ 并成功转变到状态 $B$ 的轨迹的稳态通量。FFS 的核心原理是将这个总通量表示为一个初始通量和一系列条件概率的乘积。让我们将其形式化。\n\n我们使用一个序参量 $\\lambda(x)$ 来定义状态 $A$ 和 $B$，其中 $x$ 是系统的状态向量。状态 $A$ 是转变起始的吸引盆，状态 $B$ 是目标盆。我们引入一系列由序参量定义的不重叠界面：$\\lambda_0, \\lambda_1, \\dots, \\lambda_M$。状态 $A$ 定义为 $\\lambda(x) < \\lambda_0$ 的区域，状态 $B$ 定义为 $\\lambda(x) \\ge \\lambda_M$ 的区域。界面排序为 $\\lambda_0 < \\lambda_1 < \\dots < \\lambda_M$。如果一条轨迹的序参量降至 $\\lambda_0$ 以下，则认为它已返回到 $A$。\n\n转变速率 $k_{AB}$ 可以写成两项的乘积：\n$$k_{AB} = \\Phi_0 \\times P(B|\\lambda_0)$$\n在此，$\\Phi_0$ 是源于状态 $A$ 并穿越第一个界面 $\\lambda_0$ 的轨迹的稳态通量。项 $P(B|\\lambda_0)$ 是指一个刚从 $A$ 穿越 $\\lambda_0$ 的轨迹，在返回状态 $A$（即，向后穿越低于 $\\lambda_0$）之前，将继续前进到达状态 $B$（即，穿越 $\\lambda_M$）的条件概率。\n\n由于过程的马尔可夫性质，$P(B|\\lambda_0)$ 的概率可以分解为连续界面之间的一系列条件概率的乘积。一条从 $\\lambda_{i-1}$ 到达界面 $\\lambda_i$ 的轨迹已经“忘记”了其到达 $\\lambda_i$ 之前的历史。因此，继续前进到 $\\lambda_{i+1}$ 的概率仅取决于其当前状态。这使我们可以写出：\n$$P(B|\\lambda_0) = P(\\lambda_1|\\lambda_0) \\times P(\\lambda_2|\\lambda_1) \\times \\dots \\times P(\\lambda_M|\\lambda_{M-1})$$\n其中 $P(\\lambda_{i+1}|\\lambda_i)$ 是从界面 $\\lambda_i$ 开始的轨迹在返回状态 $A$ 之前到达界面 $\\lambda_{i+1}$ 的条件概率。将这些表达式组合起来，得到 FFS 的核心方程：\n$$k_{AB} = \\Phi_0 \\prod_{i=0}^{M-1} P(\\lambda_{i+1}|\\lambda_i)$$\n\nFFS 算法是一个旨在估计此乘积中每一项的数值程序。它包括两个主要阶段。\n\n**第 1 阶段：初始通量 $\\Phi_0$ 的测量**\n该阶段处理第一项 $\\Phi_0$。\n- 进行一次长时间的模拟，系统在状态 $A$ 中初始化并达到平衡。设此模拟的总物理时长为 $T$。\n- 我们监测序参量 $\\lambda(x(t))$。每当轨迹在状态 $A$（其中 $\\lambda(x) < \\lambda_0$）中，并沿正向穿越界面 $\\lambda_0$（即，$\\lambda(x)$ 变为 $\\ge \\lambda_0$）时，就记录一个事件。\n- 设在时间 $T$ 内此类首次穿越事件的总数为 $c$。\n- 根据所提供的经验通量定义，$\\Phi_0$ 的估计量为：\n$$\\Phi_0 \\approx \\frac{c}{T}$$\n$A$ 盆内的平稳性假设至关重要，它确保了这个时间平均频率是稳态通量的有效估计量。系统在 $c$ 次穿越中每次穿越瞬间的构型都会被保存下来。这些构型代表了界面 $\\lambda_0$ 上以从 $A$ 到达为条件的态的系综，并作为下一阶段的起始点。\n\n**第 2 阶段：条件概率 $P(\\lambda_{i+1}|\\lambda_i)$ 的估计**\n该阶段估计条件概率的乘积。这是一个迭代过程，对于 $i = 0, 1, \\dots, M-1$，从界面 $\\lambda_i$ 进行到 $\\lambda_{i+1}$。\n- **对于 $i=0$**：为了估计 $P(\\lambda_1|\\lambda_0)$，我们执行一组共 $n_0$ 次独立试验。每次试验都从界面 $\\lambda_0$ 上的一个构型开始。这些初始构型是从第 1 阶段收集的集合中抽取的。通过使用不同的起始构型，以及必要时使用不同的随机数种子，我们确保这些试验是马尔可夫过程的独立实现。\n- $n_0$ 次试验中的每一次都一直运行，直到轨迹到达 $\\lambda_1$（“成功”），或通过反向穿越 $\\lambda_0$ 返回状态 $A$（“失败”）。\n- 计数成功试验的次数 $s_0$。根据所提供的条件概率定义，估计量为：\n$$P(\\lambda_1|\\lambda_0) \\approx \\frac{s_0}{n_0}$$\n- 系统成功到达 $\\lambda_1$ 瞬间的构型被保存下来。这些构型构成了下一次迭代的起始池。\n\n- **对于 $i > 0$**：对从 $1$ 到 $M-1$ 的每个后续界面 $i$ 重复此过程。为了估计 $P(\\lambda_{i+1}|\\lambda_i)$，我们从界面 $\\lambda_i$ 上的构型开始，执行 $n_i$ 次独立试验。这些起始构型是从前一次迭代的成功终点集合中抽取的（即，从那些从 $\\lambda_{i-1}$ 到达 $\\lambda_i$ 的试验中）。\n- 我们计数成功的次数 $s_i$，即在返回 $A$ 之前到达 $\\lambda_{i+1}$ 的试验。\n- 条件概率的估计量为：\n$$P(\\lambda_{i+1}|\\lambda_i) \\approx \\frac{s_i}{n_i}$$\n这个迭代过程生成了一系列级联的轨迹，逐步弥合 $A$ 和 $B$ 之间的差距，在每个界面处，轨迹的数量根据分裂概率被“修剪”。\n\n**速率常数的最终估计量（任务 B）**\n通过将通量和每个条件概率的经验估计量代入 FFS 的核心方程，我们得到了估计的 $A \\to B$ 转变速率的最终表达式。\n给定：\n- 在观测时间 $T$ 内测得的首次穿越计数 $c$。\n- 对于每个界面索引 $i \\in \\{0, 1, \\dots, M-1\\}$，试验次数 $n_i$ 和成功次数 $s_i$。\n\n速率常数 $k_{AB}$ 的估计量是：\n$$k_{AB}^{\\text{est}} = \\left(\\frac{c}{T}\\right) \\times \\left(\\frac{s_0}{n_0}\\right) \\times \\left(\\frac{s_1}{n_1}\\right) \\times \\dots \\times \\left(\\frac{s_{M-1}}{n_{M-1}}\\right)$$\n这可以紧凑地写成：\n$$k_{AB}^{\\text{est}} = \\frac{c}{T} \\prod_{i=0}^{M-1} \\frac{s_i}{n_i}$$\n这个表达式是所要求的结果。它是直接从通量和条件概率的基本定义，结合马尔可夫性质所实现的分解推导出来的。如果 $c=0$，经验通量为 $0$，因此速率估计值为 $0$。同样，如果对于某个 $n_i>0$ 有任何 $s_i=0$，则相应的经验概率为 $0$，这使得整个乘积，从而速率估计值，等于 $0$。这与经验观察到在界面 $\\lambda_i$ 之外没有找到成功路径是一致的。这就是需要实现的公式。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Forward Flux Sampling (FFS) transition rate estimate\n    for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a dictionary containing the required parameters.\n    test_cases = [\n        # Case 1\n        {\n            \"T\": 1e7, \"c\": 500, \"M\": 4, \n            \"n\": np.array([2000, 1500, 1000, 800]), \n            \"s\": np.array([600, 180, 36, 18])\n        },\n        # Case 2\n        {\n            \"T\": 5e6, \"c\": 50, \"M\": 1, \n            \"n\": np.array([1000]), \n            \"s\": np.array([5])\n        },\n        # Case 3\n        {\n            \"T\": 1e7, \"c\": 1000, \"M\": 3, \n            \"n\": np.array([1000, 500, 500]), \n            \"s\": np.array([400, 0, 250])\n        },\n        # Case 4\n        {\n            \"T\": 1e6, \"c\": 0, \"M\": 2, \n            \"n\": np.array([100, 100]), \n            \"s\": np.array([12, 3])\n        },\n        # Case 5\n        {\n            \"T\": 2e8, \"c\": 1200, \"M\": 6, \n            \"n\": np.array([5000, 4000, 3000, 2500, 2000, 1500]), \n            \"s\": np.array([250, 80, 24, 6, 2, 1])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        T = case[\"T\"]\n        c = case[\"c\"]\n        n = case[\"n\"]\n        s = case[\"s\"]\n        \n        # The FFS rate estimator is k_est = (c/T) * product(s_i / n_i).\n        \n        # Calculate the initial flux, Phi_0 = c / T.\n        # If c is 0, the flux is 0, and the final rate estimate is 0.\n        if c == 0:\n            results.append(0.0)\n            continue\n            \n        initial_flux = c / T\n        \n        # Calculate the product of conditional probabilities, P = product(s_i / n_i).\n        # According to the problem, all n_i are strictly positive.\n        # If any s_i is 0, the product will be 0, and the rate is 0.\n        # The np.prod function on an empty array returns 1, which is correct for M=0.\n        # Here we compute the probabilities s_i/n_i and then their product.\n        probabilities = s / n\n        prob_product = np.prod(probabilities)\n        \n        # The final rate is the product of the initial flux and the probability product.\n        rate_estimate = initial_flux * prob_product\n        results.append(rate_estimate)\n\n    # Print the final results in the specified format. The output is a single\n    # line containing a comma-separated list of floating-point numbers\n    # enclosed in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2667199"}]}