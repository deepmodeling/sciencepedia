{"hands_on_practices": [{"introduction": "许多现代双杂化泛函的一个关键创新是分别对自旋相反（opposite-spin）和平行自旋（same-spin）的二阶微扰（PT2）相关能进行标度。本练习将通过一个具体的计算任务，帮助你熟悉这种自旋组分标度（spin-component scaling, SCS）公式的应用。掌握这一基本构建模块的计算，是理解这些高级泛函结构的第一步。[@problem_id:2886705]", "problem": "在双杂化密度泛函近似 (DH-DFAs) 中，微扰相关部分通常取自Møller–Plesset二阶微扰理论 (MP2)。在Rayleigh–Schrödinger微扰理论中，二阶相关能由正则Hartree–Fock参考态得到，并可通过根据电子对的自旋投影对其进行分类，分解为自旋相反和自旋相同的贡献。在双杂化密度泛函中采用的自旋分量标度 (SCS) 方法里，自旋相反和自旋相同的总能量在被纳入双杂化能量之前，会乘以不同的前置因子。\n\n考虑一个闭壳层小分子，在价基组下对其进行正则Hartree–Fock计算，得到以下成对的二阶相关贡献列表（每项是从标准MP2单对激发表达式计算出的对能量贡献），按自旋类别分开并以Hartree为单位报告：\n- 自旋相反对能量：$-0.018432, -0.006517, -0.002981, -0.001257, -0.000843$。\n- 自旋相同对能量：$-0.003876, -0.001142, -0.000328$。\n\n使用双杂化密度泛函中采用的自旋分量标度微扰相关能的定义，并给定系数 $c_{\\text{OS}}=1.20$ 和 $c_{\\text{SS}}=0.330$，计算自旋分量标度的二阶微扰相关能。请以Hartree为单位表示最终能量，并将答案四舍五入到五位有效数字。", "solution": "对问题陈述进行审视后，确认其有效。它在科学上基于量子化学的原理，特别是关于双杂化密度泛函理论和Møller–Plesset微扰理论。该问题提法恰当，为获得唯一解提供了所有必要的数据和定义。术语客观而精确。\n\n目标是计算自旋分量标度的二阶微扰相关能，记为 $E_c^{\\text{SCS-MP2}}$。该量被定义为总的自旋相反 ($E_c^{\\text{OS}}$) 和自旋相同 ($E_c^{\\text{SS}}$) 的二阶Møller–Plesset (MP2) 相关能的线性组合。通用表达式为：\n$$E_c^{\\text{SCS-MP2}} = c_{\\text{OS}} E_c^{\\text{OS}} + c_{\\text{SS}} E_c^{\\text{SS}}$$\n其中 $c_{\\text{OS}}$ 和 $c_{\\text{SS}}$ 分别是针对自旋相反和自旋相同分量的经验确定标度系数。\n\n首先，通过将所提供的各个自旋相反对能量贡献相加来计算总的自旋相反相关能 $E_c^{\\text{OS}}$。给定的对能量为：$-0.018432$、$-0.006517$、$-0.002981$、$-0.001257$ 和 $-0.000843$，单位均为Hartree。\n$$E_c^{\\text{OS}} = (-0.018432) + (-0.006517) + (-0.002981) + (-0.001257) + (-0.000843) \\text{ Hartree}$$\n$$E_c^{\\text{OS}} = -0.030030 \\text{ Hartree}$$\n\n其次，通过将所提供的各个自旋相同对能量贡献相加来计算总的自旋相同相关能 $E_c^{\\text{SS}}$。给定的对能量为：$-0.003876$、$-0.001142$ 和 $-0.000328$，单位均为Hartree。\n$$E_c^{\\text{SS}} = (-0.003876) + (-0.001142) + (-0.000328) \\text{ Hartree}$$\n$$E_c^{\\text{SS}} = -0.005346 \\text{ Hartree}$$\n\n现在，将这些总的自旋分量能量与给定的标度系数 $c_{\\text{OS}} = 1.20$ 和 $c_{\\text{SS}} = 0.330$ 一同代入 $E_c^{\\text{SCS-MP2}}$ 的定义方程。\n$$E_c^{\\text{SCS-MP2}} = (1.20) \\times E_c^{\\text{OS}} + (0.330) \\times E_c^{\\text{SS}}$$\n$$E_c^{\\text{SCS-MP2}} = (1.20) \\times (-0.030030) + (0.330) \\times (-0.005346) \\text{ Hartree}$$\n分别计算每一项：\n标度后的自旋相反贡献为：\n$$(1.20) \\times (-0.030030) = -0.036036 \\text{ Hartree}$$\n标度后的自旋相同贡献为：\n$$(0.330) \\times (-0.005346) = -0.00176418 \\text{ Hartree}$$\n总的自旋分量标度能量是这两项的和：\n$$E_c^{\\text{SCS-MP2}} = -0.036036 - 0.00176418 = -0.03780018 \\text{ Hartree}$$\n问题要求将最终答案四舍五入到五位有效数字。计算值为-0.03780018。前五位有效数字是 $3$、$7$、$8$、$0$ 和 $0$。随后的数字是 $1$，小于 $5$，因此向下舍入（即截断）。所以，舍入后的值为-0.037800。", "answer": "$$\n\\boxed{-0.037800}\n$$", "id": "2886705"}, {"introduction": "理解了核心的微扰能量项后，我们可以着眼于全局，即如何将所有能量组分整合成一个完整的双杂化能量表达式。本练习要求你基于一组固定的分子轨道，将哈特里-福克交换能 $E_{x}^{\\mathrm{HF}}$、密度泛函的交换相关能 $E_{\\mathrm{xc}}^{\\mathrm{DFA}}$，以及二阶微扰相关能 $E_{c}^{\\mathrm{PT2}}$ 等部分线性组合起来。这个过程不仅能加深你对双杂化泛函复合结构的理解，还能让你体会到在非自洽计算中如何避免对不同能量项的双重计算。[@problem_id:2886706]", "problem": "给定一个由广义 Kohn–Sham 哈密顿量生成的固定的父系杂化 Kohn–Sham 轨道集。您的任务是设计并实现一个计算工作流，仅使用从此固定轨道集计算出的量来评估非自洽双杂化能量，而无需重新优化轨道。\n\n从以下基本原理开始：\n- Kohn–Sham 总能量分解：$$E_{\\mathrm{tot}} = T_s + V_{\\mathrm{ne}} + J + E_{\\mathrm{xc}}$$，其中 $T_s$ 是无相互作用动能，$V_{\\mathrm{ne}}$ 是核-电子吸引能，$J$ 是经典库仑（哈特里）能，$E_{\\mathrm{xc}}$ 是交换-相关能。\n- Hartree–Fock 精确交换能 $E_{x}^{\\mathrm{HF}}$ 可通过福克算符的交换部分，从相同的轨道计算得到。\n- 当在实空间格点上，使用相同的轨道和密度进行计算时，一个半局域交换-相关能量泛函会产生 $E_{x}^{\\mathrm{DFA}}$ 和 $E_{c}^{\\mathrm{DFA}}$，其中 DFA 表示密度泛函近似。\n- 在相同轨道上计算的二阶 Møller–Plesset (MP2) 相关能（分解为相反自旋和相同自旋）定义为：$$E_{2}^{\\mathrm{OS}} = \\sum_{i a j b}^{\\mathrm{OS}} \\frac{\\lvert \\langle i a \\Vert j b \\rangle \\rvert^2}{\\epsilon_i + \\epsilon_j - \\epsilon_a - \\epsilon_b}, \\quad E_{2}^{\\mathrm{SS}} = \\sum_{i a j b}^{\\mathrm{SS}} \\frac{\\lvert \\langle i a \\Vert j b \\rangle \\rvert^2}{\\epsilon_i + \\epsilon_j - \\epsilon_a - \\epsilon_b}$$，其中索引 $i, j$ 遍历占据轨道，$a, b$ 遍历虚拟轨道，双电子积分 $\\langle i a \\Vert j b \\rangle$ 是反对称化的，$\\epsilon_p$ 是轨道能。$E_{2}^{\\mathrm{OS}}$ 和 $E_{2}^{\\mathrm{SS}}$ 均使用相同的父系轨道计算。\n\n因为您不能重新优化轨道，所以请将总和 $$E_{\\mathrm{base}} \\equiv T_s + V_{\\mathrm{ne}} + J$$ 视为给定父系轨道集的常数。一个非自洽双杂化能量由这些分量的线性组合构成，使用标量系数对固定轨道的精确交换、半局域交换、半局域相关以及二阶微扰相关部分进行加权。这些系数是给定的，并且必须一致地应用，以确保没有交换或相关贡献被重复计算。\n\n您的目标：\n1. 根据上述基本原理，推导如何构建一个非自洽双杂化总能量表达式 $E_{\\mathrm{DH}}$，该表达式仅使用固定轨道的量 $E_{\\mathrm{base}}$、$E_{x}^{\\mathrm{HF}}$、$E_{x}^{\\mathrm{DFA}}$、$E_{c}^{\\mathrm{DFA}}$、$E_{2}^{\\mathrm{OS}}$、$E_{2}^{\\mathrm{SS}}$ 以及用户指定的系数 $c_x$、$c_c$、$c_{2}^{\\mathrm{OS}}$、$c_{2}^{\\mathrm{SS}}$。解释为什么 $E_{\\mathrm{base}}$ 保持不变，以及如何防止在 $E_{x}^{\\mathrm{HF}}$、$E_{x}^{\\mathrm{DFA}}$ 和微扰相关之间出现重复计算。\n2. 实现一个程序，为以下测试套件评估推导出的 $E_{\\mathrm{DH}}$。所有能量必须以哈特里（$E_h$）表示。您的程序应计算每种情况并将结果四舍五入到 $10$ 位小数。\n\n测试套件（每种情况依次列出标量系数元组 $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}})$ 和固定轨道能量分量 $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}})$，单位均为 $E_h$）：\n- 情况 A（通用双杂化）：系数 $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (0.68, 0.36, 0.55, 0.12)$; 分量 $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-75.00000000, -3.50000000, -3.20000000, -0.90000000, -0.45000000, -0.15000000)$.\n- 情况 B（纯杂化边界，无微扰相关）：系数 $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (0.50, 1.00, 0.00, 0.00)$; 分量 $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-40.00000000, -2.00000000, -1.80000000, -0.40000000, -0.20000000, -0.05000000)$.\n- 情况 C（Hartree–Fock 交换极限与完全 MP2）：系数 $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (1.00, 0.00, 1.00, 1.00)$; 分量 $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-15.00000000, -1.00000000, -0.90000000, -0.20000000, -0.05000000, -0.02000000)$.\n- 情况 D（自旋分量标度，具有负的相同自旋系数）：系数 $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (0.72, 0.42, 0.65, -0.05)$; 分量 $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-100.00000000, -6.70000000, -6.10000000, -1.60000000, -0.95000000, -0.35000000)$.\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含四个计算出的能量值（单位为 $E_h$），每个值四舍五入到 $10$ 位小数，以逗号分隔，并用方括号括起来，不含空格。例如：`[x_1,x_2,x_3,x_4]`，其中每个 $x_k$ 是一个浮点数，单位为 $E_h$，四舍五入到 $10$ 位小数。", "solution": "该问题要求公式化并实现一个非自洽双杂化能量的计算。验证问题陈述是强制性的第一步。\n\n### 问题验证\n\n#### 第 1 步：提取给定信息\n\n提供的信息包括：\n- Kohn-Sham 总能量分解：$E_{\\mathrm{tot}} = T_s + V_{\\mathrm{ne}} + J + E_{\\mathrm{xc}}$。\n- 来自固定轨道集的恒定基础能量：$E_{\\mathrm{base}} \\equiv T_s + V_{\\mathrm{ne}} + J$。\n- 从固定轨道集计算出的可用能量分量：\n    - Hartree–Fock 精确交换能：$E_{x}^{\\mathrm{HF}}$。\n    - 来自密度泛函近似（DFA）的半局域交换能：$E_{x}^{\\mathrm{DFA}}$。\n    - 来自 DFA 的半局域相关能：$E_{c}^{\\mathrm{DFA}}$。\n    - 相反自旋二阶 Møller–Plesset (MP2) 相关能：$E_{2}^{\\mathrm{OS}}$。\n    - 相同自旋二阶 Møller–Plesset (MP2) 相关能：$E_{2}^{\\mathrm{SS}}$。\n- MP2 分量的定义：$$E_{2}^{\\mathrm{OS}} = \\sum_{i a j b}^{\\mathrm{OS}} \\frac{\\lvert \\langle i a \\Vert j b \\rangle \\rvert^2}{\\epsilon_i + \\epsilon_j - \\epsilon_a - \\epsilon_b}, \\quad E_{2}^{\\mathrm{SS}} = \\sum_{i a j b}^{\\mathrm{SS}} \\frac{\\lvert \\langle i a \\Vert j b \\rangle \\rvert^2}{\\epsilon_i + \\epsilon_j - \\epsilon_a - \\epsilon_b}$$\n- 用于构建双杂化能量的用户指定系数：$c_x$, $c_c$, $c_{2}^{\\mathrm{OS}}$, $c_{2}^{\\mathrm{SS}}$。\n- 一个包含四种情况的测试套件，每种情况提供一组系数和相应的能量分量，单位为哈特里（$E_h$）。\n    - 情况 A: $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (0.68, 0.36, 0.55, 0.12)$; $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-75.0, -3.5, -3.2, -0.9, -0.45, -0.15)$。\n    - 情况 B: $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (0.50, 1.00, 0.00, 0.00)$; $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-40.0, -2.0, -1.8, -0.4, -0.2, -0.05)$。\n    - 情况 C: $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (1.00, 0.00, 1.00, 1.00)$; $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-15.0, -1.0, -0.9, -0.2, -0.05, -0.02)$。\n    - 情况 D: $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (0.72, 0.42, 0.65, -0.05)$; $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-100.0, -6.7, -6.1, -1.6, -0.95, -0.35)$。\n\n#### 第 2 步：使用提取的给定信息进行验证\n\n根据所需标准对问题陈述进行评估：\n- **科学依据**：该问题是对量子化学中一个标准后处理步骤的准确表述，具体来说是非自洽双杂化泛函能量的计算。所有术语（$E_x^{\\mathrm{HF}}$、$E_c^{\\mathrm{DFA}}$、$E_c^{\\mathrm{MP2}}$ 等）在该领域都有明确定义和标准用法。该过程在物理和数学上是合理的。\n- **良态问题**：问题结构为一个推导过程，然后将推导出的公式直接应用于给定数据。问题是自洽的，并且每个测试案例都存在唯一、稳定的解。\n- **客观性**：语言正式，使用了来自理论和计算化学的精确术语，没有模糊性或主观性陈述。\n\n该问题没有表现出任何科学上不合理、不完整、矛盾或不可行等缺陷。\n\n#### 第 3 步：结论与行动\n该问题是**有效的**。将着手制定解决方案。\n\n### 解决方案\n\n目标是根据一组预先计算好的、源自固定 Kohn-Sham 轨道集的能量分量，构建一个非自洽双杂化能量 $E_{\\mathrm{DH}}$。\n\n#### 1. 双杂化能量表达式的推导\n\n总能量由一个基础分量和一个交换-相关分量组成：\n$$E_{\\mathrm{DH}} = E_{\\mathrm{base}} + E_{\\mathrm{xc}}^{\\mathrm{DH}}$$\n$E_{\\mathrm{base}} = T_s + V_{\\mathrm{ne}} + J$ 项取决于单电子动能（$T_s$）、核-电子势能（$V_{\\mathrm{ne}}$）和经典电子-电子库仑排斥能（$J$）。这些量是电子密度 $\\rho$ 和 Kohn-Sham 轨道 $\\{\\psi_i\\}$ 的泛函。由于问题指定轨道是固定的（即，不针对双杂化泛函重新优化），因此对于给定的计算，$E_{\\mathrm{base}}$ 是一个恒定值。\n\n交换-相关能 $E_{\\mathrm{xc}}^{\\mathrm{DH}}$ 由其交换和相关部分的线性组合构成：\n$$E_{\\mathrm{xc}}^{\\mathrm{DH}} = E_{x}^{\\mathrm{DH}} + E_{c}^{\\mathrm{DH}}$$\n\n**交换分量 ($E_{x}^{\\mathrm{DH}}$):**\n杂化泛函中的交换能是 Hartree-Fock (HF) 精确交换 $E_{x}^{\\mathrm{HF}}$ 和半局域 DFA 交换 $E_{x}^{\\mathrm{DFA}}$ 的混合。系数 $c_x$ 决定了精确交换的比例。为防止交换效应的重复计算，来自 DFA 交换的贡献必须是互补的。因此，总交换能为：\n$$E_{x}^{\\mathrm{DH}} = c_x E_{x}^{\\mathrm{HF}} + (1 - c_x) E_{x}^{\\mathrm{DFA}}$$\n这种形式确保了总交换贡献被正确归一化。例如，如果 $c_x = 1$，则所有 DFA 交换都被移除；如果 $c_x = 0$，泛函则退化为纯 DFA 交换。\n\n**相关分量 ($E_{c}^{\\mathrm{DH}}$):**\n双杂化泛函中的相关能结合了 DFA 相关项 $E_{c}^{\\mathrm{DFA}}$ 和来自二阶 Møller-Plesset 微扰理论 (MP2) 的非局域相关校正。问题为 DFA 相关（$c_c$）以及 MP2 相关的相反自旋（$c_{2}^{\\mathrm{OS}}$）和相同自旋（$c_{2}^{\\mathrm{SS}}$）分量提供了单独的系数。$E_{c}^{\\mathrm{DFA}}$ 和 $E_{c}^{\\mathrm{MP2}}$ 项是对真实相关能的不同近似，捕捉了不同的物理方面（例如，静态与动态相关）。因此，它们被视为可加的分量，每个分量都由其自身的经验确定系数进行缩放。这在现代自旋分量标度的双杂化泛函中是标准做法。其形式为：\n$$E_{c}^{\\mathrm{DH}} = c_c E_{c}^{\\mathrm{DFA}} + c_{2}^{\\mathrm{OS}} E_{2}^{\\mathrm{OS}} + c_{2}^{\\mathrm{SS}} E_{2}^{\\mathrm{SS}}$$\n避免重复计算的指令得到了满足，因为 $E_{c}^{\\mathrm{DFA}}$ 和微扰校正是根本不同类型的能量项，它们的加权和正是泛函的定义方式。这些系数是通过拟合以重现高质量基准数据而得到的参数。\n\n**总双杂化能量 ($E_{\\mathrm{DH}}$):**\n将所有分量组合起来，得到非自洽双杂化能量的最终表达式：\n$$E_{\\mathrm{DH}} = E_{\\mathrm{base}} + \\left[ c_x E_{x}^{\\mathrm{HF}} + (1 - c_x) E_{x}^{\\mathrm{DFA}} \\right] + \\left[ c_c E_{c}^{\\mathrm{DFA}} + c_{2}^{\\mathrm{OS}} E_{2}^{\\mathrm{OS}} + c_{2}^{\\mathrm{SS}} E_{2}^{\\mathrm{SS}} \\right]$$\n该方程是给定分量的清晰、分步组合，遵循了量子化学模型构建的原则。\n\n#### 2. 测试套件的实现\n\n现在将实现推导出的公式，以计算四个指定测试案例的总能量。逻辑直接遵循该方程。对于每种情况，将提供的系数和能量分量代入公式中。结果按要求四舍五入到 $10$ 位小数。\n\n例如，对于情况 A：\n$c_x = 0.68$, $c_c = 0.36$, $c_{2}^{\\mathrm{OS}} = 0.55$, $c_{2}^{\\mathrm{SS}} = 0.12$\n$E_{\\mathrm{base}} = -75.0$, $E_{x}^{\\mathrm{HF}} = -3.5$, $E_{x}^{\\mathrm{DFA}} = -3.2$, $E_{c}^{\\mathrm{DFA}} = -0.9$, $E_{2}^{\\mathrm{OS}} = -0.45$, $E_{2}^{\\mathrm{SS}} = -0.15$\n\n$E_{\\mathrm{DH}} = -75.0 + [0.68(-3.5) + (1-0.68)(-3.2)] + [0.36(-0.9) + 0.55(-0.45) + 0.12(-0.15)]$\n$E_{\\mathrm{DH}} = -75.0 + [-2.38 - 1.024] + [-0.324 - 0.2475 - 0.018]$\n$E_{\\mathrm{DH}} = -75.0 - 3.404 - 0.5895 = -78.9935$\n\n对所有情况重复此过程。最终的实现在下一节中提供。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the non-self-consistent double-hybrid energy for a suite of test cases.\n    \"\"\"\n\n    # Test suite: each case is a tuple containing:\n    # 1. A tuple of coefficients: (c_x, c_c, c_2_os, c_2_ss)\n    # 2. A tuple of energy components: (E_base, E_x_HF, E_x_DFA, E_c_DFA, E_2_os, E_2_ss)\n    # All energies are in hartree (E_h).\n    test_cases = [\n        # Case A: General double-hybrid\n        ( (0.68, 0.36, 0.55, 0.12), \n          (-75.00000000, -3.50000000, -3.20000000, -0.90000000, -0.45000000, -0.15000000) ),\n        # Case B: Pure hybrid boundary, no perturbative correlation\n        ( (0.50, 1.00, 0.00, 0.00), \n          (-40.00000000, -2.00000000, -1.80000000, -0.40000000, -0.20000000, -0.05000000) ),\n        # Case C: Hartree-Fock exchange limit with full MP2\n        ( (1.00, 0.00, 1.00, 1.00), \n          (-15.00000000, -1.00000000, -0.90000000, -0.20000000, -0.05000000, -0.02000000) ),\n        # Case D: Spin-component scaled with negative same-spin coefficient\n        ( (0.72, 0.42, 0.65, -0.05), \n          (-100.00000000, -6.70000000, -6.10000000, -1.60000000, -0.95000000, -0.35000000) )\n    ]\n\n    results = []\n    for case in test_cases:\n        coeffs, energies = case\n        c_x, c_c, c_2_os, c_2_ss = coeffs\n        e_base, e_x_hf, e_x_dfa, e_c_dfa, e_2_os, e_2_ss = energies\n\n        # Assemble the exchange component\n        # E_x_DH = c_x * E_x_HF + (1 - c_x) * E_x_DFA\n        e_x_dh = c_x * e_x_hf + (1 - c_x) * e_x_dfa\n\n        # Assemble the correlation component\n        # E_c_DH = c_c * E_c_DFA + c_2_os * E_2_os + c_2_ss * E_2_ss\n        e_c_dh = c_c * e_c_dfa + c_2_os * e_2_os + c_2_ss * e_2_ss\n\n        # Assemble the total double-hybrid energy\n        # E_DH = E_base + E_x_DH + E_c_DH\n        e_dh = e_base + e_x_dh + e_c_dh\n\n        # Round the result to 10 decimal places as required.\n        # Use formatting to ensure trailing zeros are preserved if needed.\n        # The rounding is effectively handled by the format string.\n        results.append(f\"{e_dh:.10f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2886706"}, {"introduction": "计算出能量只是第一步，对于高级研究者而言，理解近似方法中误差的来源至关重要。本实践介绍了一种强大的诊断技术，即将总误差分解为由泛函本身的近似性引起的“泛函驱动误差”和由计算中使用的近似密度引起的“密度驱动误差”。通过实现这一误差分解算法，你将能更深刻地洞察密度泛函方法的性能与局限性，这对于方法的正确应用和未来发展都至关重要。[@problem_id:2886674]", "problem": "您的任务是为量子化学中的双杂化密度泛函所预测的能量，以一种普适且纯数学的方式，实现一个基于原理的误差分解。该分解将总误差分离为一个源于近似能量模型本身的分量，以及一个源于该模型所使用的近似自洽密度的分量。\n\n请使用以下基本依据作为您推理和算法设计的起点。除这些经过充分检验的定律和定义外，不要假定任何其他结果：\n- 密度泛函理论（DFT）的 Hohenberg–Kohn 定理保证了基态密度与外势之间存在一一对应的映射，并且存在一个普适泛函，其变分最小值可得出精确的基态能量。\n- Rayleigh–Ritz 变分原理确保了通过在精确基态密度下最小化精确泛函，可以获得精确的基态能量。\n- Kohn–Sham DFT 将相互作用体系替换为一个无相互作用的参考体系，该体系通过一个辅助有效势再现相同的密度，其中的交换相关效应由一个交换相关泛函来描述。\n- 双杂化密度泛函是一种近似的能量模型，它将半局域交换与相关、一部分 Hartree–Fock (HF) 交换以及一部分来自二阶微扰理论（例如，二阶 Møller–Plesset 微扰理论 (MP2)）的相关混合在一起，同时仍被用于 Kohn–Sham 框架内。\n- 在密度校正评估（常称为密度校正密度泛函理论 (DC-DFT) 评估）中，一个近似的能量泛函是在一个高质量的参考密度上进行非自洽评估，而不是在其自身的自洽密度上进行评估。\n\n您的目标是：\n1. 根据上述变分结构和密度校正评估的定义，推导出一个数学上精确的方法，将双杂化预测的总误差分解为两个可加和的组分，这两个组分可被识别为泛函驱动的贡献和密度驱动的贡献。请采用误差定义为“近似值减去参考值”的符号约定。\n2. 设计一个算法，对于每个体系，给定三个标量能量值：\n   - 精确或基准参考能量（基态能量），单位为哈特里，\n   - 在其自身的近似密度上自洽评估的双杂化能量，单位为哈特里，\n   - 在一个高质量参考密度上非自洽评估的同一个双杂化能量，单位为哈特里，\n   该算法为每个体系计算三个输出值，单位为哈特里：\n   - 总误差，\n   - 泛函驱动误差，\n   - 密度驱动误差，\n   这些输出需与您在第1项中的推导保持一致。\n3. 将此算法实现为一个完整且可运行的程序，该程序仅使用指定的环境和库。计算必须是纯代数的，仅使用所提供的数字，并且不得假定除上述内容所隐含的之外的任何特定领域的参数。\n\n测试套件：\n- 使用以下五个测试用例。每个用例是一个能量三元组，单位为哈特里 $(E_{\\mathrm{ref}}, E_{\\mathrm{DH}}^{\\mathrm{self}}, E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}})$，其中 $E_{\\mathrm{ref}}$ 是参考基态能量，$E_{\\mathrm{DH}}^{\\mathrm{self}}$ 是在其自洽密度上评估的双杂化能量，$E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}}$ 是在高质量参考密度上评估的双杂化能量：\n  - 用例 1（一般情况）：$( -76.420000,\\ -76.400000,\\ -76.415000 )$。\n  - 用例 2（无密度驱动误差）：$( -100.000000,\\ -99.900000,\\ -99.900000 )$。\n  - 用例 3（无泛函驱动误差）：$( -40.000000,\\ -39.950000,\\ -40.000000 )$。\n  - 用例 4（负的密度驱动贡献）：$( -20.000000,\\ -19.850000,\\ -19.800000 )$。\n  - 用例 5（总误差为零，因抵消）：$( -10.000000,\\ -10.000000,\\ -10.030000 )$。\n\n数值与单位要求：\n- 所有能量和误差必须以哈特里表示。此问题不涉及角度或百分比。\n- 对每个测试用例，按顺序计算三个浮点数：总误差、泛函驱动误差、密度驱动误差。对每个分量使用“近似值减去参考值”的符号约定。将每个浮点数四舍五入到恰好 $10^{-6}$ 哈特里（小数点后六位）。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个类似 Python 的列表字面量，该列表包含五个列表。每个内部列表对应一个测试用例，必须包含三个浮点数，格式化为小数点后恰好六位，单位为哈特里，并按顺序排列为 `[总误差, 泛函驱动误差, 密度驱动误差]`。例如，一个有效的输出形状是 `[[x_11,x_12,x_13],[x_21,x_22,x_23],...,[x_51,x_52,x_53]]`，其中每个 $x_{ij}$ 都是一个小数点后恰好有六位的浮点数。", "solution": "该问题要求对双杂化密度泛函理论计算推导并实现一个基于原理的误差分解。能量的总误差必须被分解为一个泛函驱动分量和一个密度驱动分量。此任务需基于密度泛函理论 (DFT) 的基本原理来完成。\n\n首先，我们必须根据所提供的定义，建立一套清晰明确的符号表示。\n令 $E_{\\mathrm{ref}}$ 为体系的精确、真实的基态能量。在 DFT 的背景下，这对应于精确的普适能量泛函 $E[\\rho]$ 在精确的基态电子密度 $\\rho_{\\mathrm{ex}}$ 处评估的最小值。因此，$E_{\\mathrm{ref}} = E[\\rho_{\\mathrm{ex}}]$。\n令 $\\tilde{E}[\\rho]$ 表示近似的能量泛函，在本例中为双杂化 (DH) 泛函。\n使用此泛函进行自洽计算会产生一个近似密度 $\\tilde{\\rho}_{\\mathrm{sc}}$，该密度旨在最小化能量表达式的 Kohn-Sham 部分。从此自洽过程中获得的能量记为 $E_{\\mathrm{DH}}^{\\mathrm{self}} = \\tilde{E}[\\tilde{\\rho}_{\\mathrm{sc}}]$。\n问题还提供了同一个双杂化泛函在高质量参考密度（我们将其记为 $\\rho_{\\mathrm{ref}}$）上非自洽评估的能量。为了进行此分解，我们视 $\\rho_{\\mathrm{ref}}$ 为对精确密度 $\\rho_{\\mathrm{ex}}$ 的一个足够精确的近似。此能量记为 $E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}} = \\tilde{E}[\\rho_{\\mathrm{ref}}]$。\n\n问题将误差定义为“近似值减去参考值”。因此，自洽双杂化计算的总误差 $\\Delta E_{\\mathrm{tot}}$ 为：\n$$ \\Delta E_{\\mathrm{tot}} = E_{\\mathrm{DH}}^{\\mathrm{self}} - E_{\\mathrm{ref}} $$\n\n为了将这个总误差分解为可归因于泛函内在不准确性和密度不准确性的分量，我们使用一个标准的数学恒等式，即加上再减去一个公共项。这个中间项的逻辑选择是在参考密度上评估的近似泛函的能量，$E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}}$。\n\n我们可以将总误差重写为：\n$$ \\Delta E_{\\mathrm{tot}} = (E_{\\mathrm{DH}}^{\\mathrm{self}} - E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}}) + (E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}} - E_{\\mathrm{ref}}) $$\n\n该恒等式提供了一个清晰且可加和的分解，将总误差分成了两个不同的项。我们现在必须根据它们的物理意义来识别每一项。\n\n第二项 $(E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}} - E_{\\mathrm{ref}})$，代表了近似泛函的能量与精确能量之间的差异，两者都在相同的参考密度 $\\rho_{\\mathrm{ref}}$ 下进行评估。由于密度保持不变且被假定为高质量的，该项分离出了完全由近似泛函 $\\tilde{E}$ 自身形式所内在地导致的误差。根据定义，这就是**泛函驱动误差**，我们记作 $\\Delta E_{\\mathrm{FDE}}$。\n$$ \\Delta E_{\\mathrm{FDE}} = E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}} - E_{\\mathrm{ref}} $$\n\n第一项 $(E_{\\mathrm{DH}}^{\\mathrm{self}} - E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}})$，代表了当密度从高质量的参考密度 $\\rho_{\\mathrm{ref}}$ 变为自洽的近似密度 $\\tilde{\\rho}_{\\mathrm{sc}}$ 时，*同一个*近似泛函 $\\tilde{E}$ 的能量变化。因此，该项分离出了因使用近似密度而非参考密度所引起的误差贡献。根据定义，这就是**密度驱动误差**，记作 $\\Delta E_{\\mathrm{DDE}}$。\n$$ \\Delta E_{\\mathrm{DDE}} = E_{\\mathrm{DH}}^{\\mathrm{self}} - E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}} $$\n\n因此，完整的误差分解为：\n$$ \\Delta E_{\\mathrm{tot}} = \\Delta E_{\\mathrm{DDE}} + \\Delta E_{\\mathrm{FDE}} $$\n\n必须说明一个与变分原理相关的微妙之处。对于一个严格的变分泛函 $\\tilde{E}$，自洽过程会找到最小化 $\\tilde{E}[\\rho]$ 的密度 $\\tilde{\\rho}_{\\mathrm{sc}}$。根据 Rayleigh-Ritz 原理，这将意味着对于任何其他密度 $\\rho$（包括 $\\rho_{\\mathrm{ref}}$），都有 $\\tilde{E}[\\tilde{\\rho}_{\\mathrm{sc}}] \\le \\tilde{E}[\\rho]$。因此，对于严格的变分泛函，密度驱动误差 $\\Delta E_{\\mathrm{DDE}} = \\tilde{E}[\\tilde{\\rho}_{\\mathrm{sc}}] - \\tilde{E}[\\rho_{\\mathrm{ref}}]$ 必须小于或等于零。然而，双杂化泛函包含一个来自二阶微扰理论（例如 MP2）的非变分项。自洽场过程优化的是泛函中 DFT 部分的 Kohn-Sham 轨道，而不是整个双杂化能量表达式。因此，总的双杂化能量 $E_{\\mathrm{DH}}^{\\mathrm{self}}$ 不保证是泛函 $\\tilde{E}$ 的最小值。因此，密度驱动误差 $\\Delta E_{\\mathrm{DDE}}$ 不被限制为非正值，可以取正号或负号，正如所提供的测试用例中观察到的那样。无论如何，此分解在算术上是精确的，在概念上是合理的。\n\n基于此推导，从每个体系给定的三个能量值计算三个误差分量的算法如下：\n\n设一个体系的输入为三元组 $(E_{\\mathrm{ref}}, E_{\\mathrm{DH}}^{\\mathrm{self}}, E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}})$。\n\n1.  **计算总误差 ($\\Delta E_{\\mathrm{tot}}$)**：从自洽双杂化能量中减去参考能量。\n    $$ \\Delta E_{\\mathrm{tot}} = E_{\\mathrm{DH}}^{\\mathrm{self}} - E_{\\mathrm{ref}} $$\n2.  **计算泛函驱动误差 ($\\Delta E_{\\mathrm{FDE}}$)**：从在参考密度上评估的双杂化能量中减去参考能量。\n    $$ \\Delta E_{\\mathrm{FDE}} = E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}} - E_{\\mathrm{ref}} $$\n3.  **计算密度驱动误差 ($\\Delta E_{\\mathrm{DDE}}$)**：从自洽双杂化能量中减去在参考密度上评估的双杂化能量。\n    $$ \\Delta E_{\\mathrm{DDE}} = E_{\\mathrm{DH}}^{\\mathrm{self}} - E_{\\mathrm{DH}}^{\\mathrm{ref\\text{-}dens}} $$\n\n这三个公式为解决该问题提供了完整且明确的算法。实现时只需将这些减法运算应用于测试套件中提供的数值数据即可。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the functional-driven and density-driven errors\n    for a double-hybrid density functional calculation based on three energy values.\n    \"\"\"\n    # Test cases as tuples of (E_ref, E_DH_self, E_DH_ref-dens) in hartree.\n    test_cases = [\n        # Case 1 (general)\n        (-76.420000, -76.400000, -76.415000),\n        # Case 2 (no density-driven error)\n        (-100.000000, -99.900000, -99.900000),\n        # Case 3 (no functional-driven error)\n        (-40.000000, -39.950000, -40.000000),\n        # Case 4 (negative density-driven contribution)\n        (-20.000000, -19.850000, -19.800000),\n        # Case 5 (zero total error with cancellation)\n        (-10.000000, -10.000000, -10.030000),\n    ]\n\n    all_results_str = []\n    \n    for case in test_cases:\n        E_ref, E_dh_self, E_dh_ref_dens = case\n\n        # Total error: (approximate self-consistent) - (exact reference)\n        total_error = E_dh_self - E_ref\n\n        # Functional-driven error: (approximate functional on reference density) - (exact reference)\n        # This isolates the error of the functional itself.\n        functional_driven_error = E_dh_ref_dens - E_ref\n\n        # Density-driven error: (approximate self-consistent) - (approximate functional on reference density)\n        # This isolates the error from using the self-consistent density instead of the reference one.\n        density_driven_error = E_dh_self - E_dh_ref_dens\n\n        # The decomposition must be consistent: total_error = functional_driven_error + density_driven_error\n        # np.isclose(total_error, functional_driven_error + density_driven_error) should be True.\n\n        # Format each component to exactly 6 decimal places and create a string representation of the inner list.\n        # The format \"[v1,v2,v3]\" is constructed manually to avoid spaces.\n        inner_list_str = f\"[{total_error:.6f},{functional_driven_error:.6f},{density_driven_error:.6f}]\"\n        \n        all_results_str.append(inner_list_str)\n\n    # Join the string representations of the inner lists to form the final output string.\n    # The final format is \"[[...],[...],...]\"\n    final_output = f\"[{','.join(all_results_str)}]\"\n    \n    print(final_output)\n\nsolve()\n\n```", "id": "2886674"}]}