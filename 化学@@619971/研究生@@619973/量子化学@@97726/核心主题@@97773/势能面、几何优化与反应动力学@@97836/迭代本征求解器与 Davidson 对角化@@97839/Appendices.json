{"hands_on_practices": [{"introduction": "在深入研究戴维森(Davidson)方法之前，理解其所属的更广泛的Krylov子空间方法族是很有帮助的。本练习将引导你手动执行几步Lanczos迭代，这是一个基础算法，它将一个大型哈密顿矩阵 $H$ 投影到一个小的三对角矩阵 $T$ 上，从而能够高效地近似求解其本征值。通过这个实践，你将具体地体会到将问题简化到子空间中求解的核心思想，并为理解戴维森方法的优势奠定基础。[@problem_id:2900289]", "problem": "考虑厄米哈密顿矩阵 $H \\in \\mathbb{R}^{4 \\times 4}$，其定义为\n$$\nH=\\begin{pmatrix}\n2 & -1 & 0 & 0\\\\\n-1 & 2 & -1 & 0\\\\\n0 & -1 & 2 & -1\\\\\n0 & 0 & -1 & 2\n\\end{pmatrix}.\n$$\n从归一化初始向量 $v_{1}=\\begin{pmatrix}1 & 0 & 0 & 0\\end{pmatrix}^{\\mathsf{T}}$ 出发，执行 $2$ 步 Lanczos 迭代，为 Krylov 子空间 $\\mathcal{K}_{2}(H,v_{1})=\\operatorname{span}\\{v_{1},Hv_{1}\\}$ 构建正交归一基 $V_{2}=\\begin{pmatrix}v_{1} & v_{2}\\end{pmatrix}$，并构建投影三对角矩阵 $T_{2}=V_{2}^{\\mathsf{T}} H V_{2}$。然后，使用 Rayleigh–Ritz (RR) 过程，计算 $i\\in\\{1,2\\}$ 的 Ritz 对 $(\\theta_{i},y_{i})$，其中 $\\theta_{i}$ 和 $u_{i}$ 是 $T_{2}$ 的特征对，且 $y_{i}=V_{2}u_{i}$。对于每个 Ritz 对，构建残差向量 $r_{i}=Hy_{i}-\\theta_{i}y_{i}$。\n\n将经过 $2$ 步 Lanczos 迭代后，与最低 Ritz 值对应的残差的欧几里得范数 $\\|r_{\\min}\\|_{2}$ 作为您的最终答案。请用精确表达式（不要四舍五入）给出最终答案。", "solution": "对问题陈述进行验证。\n\n**步骤 1：提取已知条件**\n- 厄米哈密顿矩阵 $H \\in \\mathbb{R}^{4 \\times 4}$ 为：\n$$\nH=\\begin{pmatrix}\n2 & -1 & 0 & 0\\\\\n-1 & 2 & -1 & 0\\\\\n0 & -1 & 2 & -1\\\\\n0 & 0 & -1 & 2\n\\end{pmatrix}\n$$\n- 归一化初始向量为 $v_{1}=\\begin{pmatrix}1 & 0 & 0 & 0\\end{pmatrix}^{\\mathsf{T}}$。\n- 需要执行的 Lanczos 迭代次数为 $2$。\n- 任务是为 Krylov 子空间 $\\mathcal{K}_{2}(H,v_{1})$ 构建正交归一基 $V_{2}=\\begin{pmatrix}v_{1} & v_{2}\\end{pmatrix}$，构建投影矩阵 $T_{2}=V_{2}^{\\mathsf{T}} H V_{2}$，计算 Ritz 对，并求出与最低 Ritz 值对应的残差向量的欧几里得范数。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，因为它涉及 Lanczos 算法，这是数值线性代数中一种用于寻找厄米矩阵特征值的标准和基本方法。矩阵 $H$ 是一个著名的对称三对角矩阵（一个 Toeplitz 矩阵），代表一个离散二阶导数算子，这在物理和工程问题中很常见。所有需要的数据（$H$、$v_{1}$、步数）都已提供，并且该问题在数学上是适定的和自洽的。初始向量 $v_{1}$ 确实是归一化的，因为 $\\|v_1\\|_2 = \\sqrt{1^2+0^2+0^2+0^2} = 1$。不存在矛盾、歧义或事实不准确之处。该问题是计算科学中的一个标准练习题。\n\n**步骤 3：结论与行动**\n问题有效。将构建解答。\n\nLanczos 算法生成一系列正交归一向量 $v_{j}$ 和一个三对角矩阵 $T_{k}$，其元素由以下递归关系定义：\n$w'_{j} = H v_{j} - \\sum_{i=1}^{j} (v_{i}^{\\mathsf{T}}H v_{j}) v_{i}$。对于厄米矩阵 $H$，在三项递推关系中，这可以简化为：\n$\\beta_{j+1} v_{j+1} = H v_{j} - \\alpha_{j} v_{j} - \\beta_{j} v_{j-1}$，其中 $\\alpha_{j} = v_{j}^{\\mathsf{T}} H v_{j}$ 且 $\\beta_{j+1} = \\| H v_{j} - \\alpha_{j} v_{j} - \\beta_{j} v_{j-1} \\|_{2}$。我们从 $\\beta_{1}=0$ 和 $v_{0}=0$ 开始。\n\n**Lanczos 迭代的第 1 步 ($j=1$):**\n初始向量为 $v_{1} = \\begin{pmatrix} 1 & 0 & 0 & 0 \\end{pmatrix}^{\\mathsf{T}}$。\n首先，我们计算向量 $w_1 = H v_{1}$：\n$$\nw_{1} = H v_{1} = \\begin{pmatrix} 2 & -1 & 0 & 0\\\\ -1 & 2 & -1 & 0\\\\ 0 & -1 & 2 & -1\\\\ 0 & 0 & -1 & 2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$T$ 的第一个对角元素是 $\\alpha_{1}$：\n$$\n\\alpha_{1} = v_{1}^{\\mathsf{T}} w_{1} = \\begin{pmatrix} 1 & 0 & 0 & 0 \\end{pmatrix} \\begin{pmatrix} 2 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = 2\n$$\n接下来，我们计算未归一化的下一个向量：\n$$\nw'_{1} = w_{1} - \\alpha_{1} v_{1} = \\begin{pmatrix} 2 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} - 2 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$T$ 的第一个次对角元素是 $\\beta_{2}$，它是 $w'_{1}$ 的范数：\n$$\n\\beta_{2} = \\| w'_{1} \\|_{2} = \\sqrt{0^2 + (-1)^2 + 0^2 + 0^2} = 1\n$$\n第二个 Lanczos 向量 $v_{2}$ 是通过对 $w'_{1}$ 进行归一化得到的：\n$$\nv_{2} = \\frac{w'_{1}}{\\beta_{2}} = \\frac{1}{1} \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n\n**Lanczos 迭代的第 2 步 ($j=2$):**\n我们计算 $w_2 = H v_{2}$：\n$$\nw_{2} = H v_{2} = \\begin{pmatrix} 2 & -1 & 0 & 0\\\\ -1 & 2 & -1 & 0\\\\ 0 & -1 & 2 & -1\\\\ 0 & 0 & -1 & 2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ -2 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n$T$ 的第二个对角元素是 $\\alpha_{2}$：\n$$\n\\alpha_{2} = v_{2}^{\\mathsf{T}} w_{2} = \\begin{pmatrix} 0 & -1 & 0 & 0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -2 \\\\ 1 \\\\ 0 \\end{pmatrix} = 2\n$$\n下一个未归一化向量的迭代为 $w'_{2} = w_2 - \\alpha_2 v_2 - \\beta_2 v_1$：\n$$\nw'_{2} = \\begin{pmatrix} 1 \\\\ -2 \\\\ 1 \\\\ 0 \\end{pmatrix} - 2 \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} - 1 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1-0-1 \\\\ -2-(-2)-0 \\\\ 1-0-0 \\\\ 0-0-0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n下一个次对角元素是 $\\beta_{3}$：\n$$\n\\beta_{3} = \\| w'_{2} \\|_{2} = \\sqrt{0^2 + 0^2 + 1^2 + 0^2} = 1\n$$\n由于我们只需要 $2$ 步，过程到此终止。Krylov 子空间 $\\mathcal{K}_{2}(H, v_1)$ 的正交归一基是 $V_{2} = \\begin{pmatrix} v_{1} & v_{2} \\end{pmatrix} = \\begin{pmatrix} 1 & 0 \\\\ 0 & -1 \\\\ 0 & 0 \\\\ 0 & 0 \\end{pmatrix}$。\n\n投影的 $2 \\times 2$ 三对角矩阵 $T_{2}$ 是：\n$$\nT_{2} = \\begin{pmatrix} \\alpha_{1} & \\beta_{2} \\\\ \\beta_{2} & \\alpha_{2} \\end{pmatrix} = \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix}\n$$\n\n**Rayleigh–Ritz 过程：**\n我们求 $T_2$ 的特征对 $(\\theta_i, u_i)$。特征方程是 $\\det(T_2 - \\theta I) = 0$：\n$$\n\\det \\begin{pmatrix} 2-\\theta & 1 \\\\ 1 & 2-\\theta \\end{pmatrix} = (2-\\theta)^2 - 1 = 0\n$$\n这得到 $2-\\theta = \\pm 1$，因此 Ritz 值为 $\\theta_{1} = 2-1 = 1$ 和 $\\theta_{2} = 2+1 = 3$。\n最低的 Ritz 值为 $\\theta_{\\min} = \\theta_1 = 1$。\n\n我们现在求 $T_2$ 对应于 $\\theta_1 = 1$ 的特征向量 $u_1$：\n$$\n(T_{2} - \\theta_{1}I) u_{1} = \\begin{pmatrix} 1 & 1 \\\\ 1 & 1 \\end{pmatrix} \\begin{pmatrix} u_{11} \\\\ u_{12} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n这得出 $u_{11} + u_{12} = 0$，所以 $u_{11} = -u_{12}$。一个未归一化的特征向量是 $\\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n归一化的特征向量是 $u_{1} = \\frac{1}{\\sqrt{1^2+(-1)^2}} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n\n对应的 Ritz 向量 $y_1$ 是 $y_1 = V_2 u_1$：\n$$\ny_{1} = V_{2} u_{1} = \\begin{pmatrix} 1 & 0 \\\\ 0 & -1 \\\\ 0 & 0 \\\\ 0 & 0 \\end{pmatrix} \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n\n**残差计算：**\nRitz 对 $(\\theta_1, y_1)$ 的残差向量是 $r_{1} = Hy_{1} - \\theta_{1}y_{1}$。\n首先，计算 $Hy_1$：\n$$\nHy_{1} = \\begin{pmatrix} 2 & -1 & 0 & 0\\\\ -1 & 2 & -1 & 0\\\\ 0 & -1 & 2 & -1\\\\ 0 & 0 & -1 & 2 \\end{pmatrix} \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 2(1) - 1(1) \\\\ -1(1) + 2(1) \\\\ 0(1) - 1(1) \\\\ 0 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ -1 \\\\ 0 \\end{pmatrix}\n$$\n现在，计算残差向量 $r_1$：\n$$\nr_{1} = Hy_{1} - \\theta_{1}y_{1} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ -1 \\\\ 0 \\end{pmatrix} - 1 \\cdot \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1-1 \\\\ 1-1 \\\\ -1-0 \\\\ 0-0 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 0 \\\\ 0 \\\\ -1 \\\\ 0 \\end{pmatrix}\n$$\n该问题要求此残差向量的欧几里得范数 $\\|r_{1}\\|_{2}$：\n$$\n\\|r_{1}\\|_{2} = \\left\\| \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 0 \\\\ 0 \\\\ -1 \\\\ 0 \\end{pmatrix} \\right\\|_{2} = \\frac{1}{\\sqrt{2}} \\sqrt{0^2 + 0^2 + (-1)^2 + 0^2} = \\frac{1}{\\sqrt{2}}\n$$\n\n另外，根据 Lanczos 算法的一个性质，Ritz 对 $(\\theta_i, y_i=V_k u_i)$ 的残差范数由 $\\|r_i\\|_2 = \\beta_{k+1} |u_{i,k}|$ 给出，其中 $u_{i,k}$ 是 $T_k$ 对应特征向量的最后一个分量。在我们的例子中，$k=2$，所以我们需要 $\\|r_1\\|_2 = \\beta_3 |u_{1,2}|$。\n我们计算出 $\\beta_{3} = 1$。对应于 $\\theta_1=1$ 的特征向量是 $u_1 = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。最后一个分量是 $u_{1,2} = -1/\\sqrt{2}$。\n因此，残差的范数是：\n$$\n\\|r_{1}\\|_{2} = (1) \\left| -\\frac{1}{\\sqrt{2}} \\right| = \\frac{1}{\\sqrt{2}}\n$$\n这证实了通过直接计算得到的结果。", "answer": "$$\\boxed{\\frac{1}{\\sqrt{2}}}$$", "id": "2900289"}, {"introduction": "戴维森(Davidson)方法相较于Lanczos等方法的关键改进在于其选择扩展子空间向量的巧妙方式。这个练习将聚焦于戴维森方法的核心步骤：构建预处理校正向量。你将学习如何利用哈密顿矩阵的对角元信息来近似求解校正方程，生成一个能有效指向真实本征向量误差方向的校正向量，并用它来扩展试探子空间以获得更精确的解。[@problem_id:2900262]", "problem": "一个厄米矩阵 $A$ 是在正交归一原子轨道基组下，电子哈密顿量的一个小区块。考虑以下实对称 $4 \\times 4$ 矩阵\n$$\nA=\\begin{pmatrix}\n1 & \\tfrac{1}{5} & 0 & 0 \\\\\n\\tfrac{1}{5} & 2 & \\tfrac{3}{10} & 0 \\\\\n0 & \\tfrac{3}{10} & 3 & \\tfrac{2}{5} \\\\\n0 & 0 & \\tfrac{2}{5} & 4\n\\end{pmatrix}.\n$$\n假设 Davidson 对角化的当前子空间包含一个单一的归一化试探向量 $u=\\begin{pmatrix}1&0&0&0\\end{pmatrix}^{\\mathsf{T}}$，该向量旨在近似基态本征向量。令相关的 Ritz 值 $\\theta$ 由 Rayleigh 商 $\\theta=\\dfrac{u^{\\mathsf{T}}Au}{u^{\\mathsf{T}}u}$ 定义。使用 Rayleigh-Ritz 过程的基本原理和残差 $r$ 的定义，执行一个 Davidson 展开步骤：使用对角预条件子 $D=\\mathrm{diag}(A)$ 形成校正向量 $t$，将 $t$ 与当前子空间正交化，然后在增广子空间中进行 Rayleigh-Ritz 提取。\n\n你的任务是：\n- 从试探对 $(\\theta,u)$ 计算残差 $r$。\n- 使用带有移位 $\\theta$ 的对角预条件子 $D=\\mathrm{diag}(A)$ 构建标准 Davidson 校正 $t$。\n- 将 $t$ 与当前子空间 $\\mathrm{span}\\{u\\}$ 正交化，将其归一化以获得单位向量 $w$，并形成双列基 $W=[u\\;w]$。\n- 构建投影的 $2\\times 2$ Rayleigh-Ritz 矩阵 $B=W^{\\mathsf{T}}AW$ 并提取其最小本征值作为更新后的基态 Ritz 值。\n\n经过这单个 Davidson 展开步骤后，更新后的最小 Ritz 值是多少？请用精确的解析表达式表示你的最终答案。不要进行四舍五入。", "solution": "问题陈述经验证具有科学依据、形式适定、客观且内容自洽。它描述了 Davidson 对角化算法一个步骤的标准应用，这是一种用于寻找大型矩阵本征值的成熟迭代方法，常用于量子化学领域。所有必要的数据和定义均已提供，不存在不一致或歧义之处。我们将开始进行解答。\n\n该问题要求执行 Davidson 迭代过程的一个步骤，以精化给定矩阵 $A$ 的最低本征值的估计。我们将按照规定的步骤进行。\n\n给定的实对称矩阵是\n$$\nA = \\begin{pmatrix}\n1 & \\frac{1}{5} & 0 & 0 \\\\\n\\frac{1}{5} & 2 & \\frac{3}{10} & 0 \\\\\n0 & \\frac{3}{10} & 3 & \\frac{2}{5} \\\\\n0 & 0 & \\frac{2}{5} & 4\n\\end{pmatrix}\n$$\n初始子空间由单个归一化试探向量张成\n$$\nu = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n由于 $u$ 是归一化的，所以 $u^{\\mathsf{T}}u = 1$。\n\n首先，我们计算初始 Ritz 值 $\\theta$，它是当前试探向量 $u$ 的 Rayleigh 商。\n$$\n\\theta = \\frac{u^{\\mathsf{T}}Au}{u^{\\mathsf{T}}u} = u^{\\mathsf{T}}Au\n$$\n我们计算乘积 $Au$：\n$$\nAu = \\begin{pmatrix}\n1 & \\frac{1}{5} & 0 & 0 \\\\\n\\frac{1}{5} & 2 & \\frac{3}{10} & 0 \\\\\n0 & \\frac{3}{10} & 3 & \\frac{2}{5} \\\\\n0 & 0 & \\frac{2}{5} & 4\n\\end{pmatrix}\n\\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} =\n\\begin{pmatrix} 1 \\\\ \\frac{1}{5} \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n于是，Ritz 值 $\\theta$ 为：\n$$\n\\theta = u^{\\mathsf{T}}(Au) = \\begin{pmatrix} 1 & 0 & 0 & 0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ \\frac{1}{5} \\\\ 0 \\\\ 0 \\end{pmatrix} = 1\n$$\n对本征值的初始近似为 $\\theta = 1$。\n\n接下来，我们计算与当前 Ritz 对 $(\\theta, u)$ 相关的残差向量 $r$。\n$$\nr = Au - \\theta u = \\begin{pmatrix} 1 \\\\ \\frac{1}{5} \\\\ 0 \\\\ 0 \\end{pmatrix} - 1 \\cdot \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\frac{1}{5} \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n\n下一步是通过近似求解校正方程 $(A - \\theta I)t = -r$来计算校正向量 $t$。在 Davidson 方法中，矩阵 $(A - \\theta I)$ 由其对角线近似，从而得到预条件子 $(D - \\theta I)$，其中 $D = \\mathrm{diag}(A)$。\n$$\nD = \\mathrm{diag}(1, 2, 3, 4)\n$$\n校正方程变为 $(D - \\theta I)t = -r$。\n$$\n\\left( \\begin{pmatrix} 1 & 0 & 0 & 0 \\\\ 0 & 2 & 0 & 0 \\\\ 0 & 0 & 3 & 0 \\\\ 0 & 0 & 0 & 4 \\end{pmatrix} - 1 \\cdot \\begin{pmatrix} 1 & 0 & 0 & 0 \\\\ 0 & 1 & 0 & 0 \\\\ 0 & 0 & 1 & 0 \\\\ 0 & 0 & 0 & 1 \\end{pmatrix} \\right) t = -r\n$$\n$$\n\\begin{pmatrix} 0 & 0 & 0 & 0 \\\\ 0 & 1 & 0 & 0 \\\\ 0 & 0 & 2 & 0 \\\\ 0 & 0 & 0 & 3 \\end{pmatrix} t = -\\begin{pmatrix} 0 \\\\ \\frac{1}{5} \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$t = (t_1, t_2, t_3, t_4)^{\\mathsf{T}}$ 的分量通过 $t_i = -r_i / (D_{ii} - \\theta)$ 求得。对于索引 $i=1$，分母 $D_{11}-\\theta = 1-1=0$。由于相应的残差分量 $r_1$ 也为 $0$，该分量在形式上是未定义的。标准 Davidson 过程要求校正向量与当前解向量 $u$ 正交。由于 $u$ 是第一个标准基向量，此条件意味着 $t_1 = 0$。对于其他分量：\n$$\nt_2 = \\frac{-r_2}{D_{22}-\\theta} = \\frac{-1/5}{2-1} = -\\frac{1}{5}\n$$\n$$\nt_3 = \\frac{-r_3}{D_{33}-\\theta} = \\frac{-0}{3-1} = 0\n$$\n$$\nt_4 = \\frac{-r_4}{D_{44}-\\theta} = \\frac{-0}{4-1} = 0\n$$\n所以校正向量为\n$$\nt = \\begin{pmatrix} 0 \\\\ -1/5 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n现在，我们必须将校正向量 $t$ 与当前基（仅由 $u$ 组成）正交化。我们使用 Gram-Schmidt 过程。设正交化后的向量为 $t'$。\n$$\nt' = t - (u^{\\mathsf{T}}t)u\n$$\n内积为\n$$\nu^{\\mathsf{T}}t = \\begin{pmatrix} 1 & 0 & 0 & 0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ -1/5 \\\\ 0 \\\\ 0 \\end{pmatrix} = 0\n$$\n由于 $t$ 已经与 $u$ 正交，我们有 $t' = t$。然后我们归一化该向量以获得新的基向量 $w$。\n$$\n\\|t'\\| = \\sqrt{0^2 + \\left(-\\frac{1}{5}\\right)^2 + 0^2 + 0^2} = \\frac{1}{5}\n$$\n$$\nw = \\frac{t'}{\\|t'\\|} = \\frac{1}{1/5} \\begin{pmatrix} 0 \\\\ -1/5 \\\\ 0 \\\\ 0 \\end{pmatrix} = 5 \\begin{pmatrix} 0 \\\\ -1/5 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n新的、扩充的正交归一基为 $\\{u, w\\}$。我们以这些向量为列构成矩阵 $W$。\n$$\nW = \\begin{bmatrix} u & w \\end{bmatrix} = \\begin{pmatrix} 1 & 0 \\\\ 0 & -1 \\\\ 0 & 0 \\\\ 0 & 0 \\end{pmatrix}\n$$\n我们现在构建投影的 $2 \\times 2$ Rayleigh-Ritz 矩阵 $B = W^{\\mathsf{T}}AW$。\n首先，我们计算 $AW$：\n$$\nAW = A \\begin{pmatrix} 1 & 0 \\\\ 0 & -1 \\\\ 0 & 0 \\\\ 0 & 0 \\end{pmatrix} = \\begin{pmatrix} 1 & -\\frac{1}{5} \\\\ \\frac{1}{5} & -2 \\\\ 0 & -\\frac{3}{10} \\\\ 0 & 0 \\end{pmatrix}\n$$\n然后我们计算 $B$：\n$$\nB = W^{\\mathsf{T}} (AW) = \\begin{pmatrix} 1 & 0 & 0 & 0 \\\\ 0 & -1 & 0 & 0 \\end{pmatrix} \\begin{pmatrix} 1 & -\\frac{1}{5} \\\\ \\frac{1}{5} & -2 \\\\ 0 & -\\frac{3}{10} \\\\ 0 & 0 \\end{pmatrix} = \\begin{pmatrix} 1 & -\\frac{1}{5} \\\\ -\\frac{1}{5} & 2 \\end{pmatrix}\n$$\n最后一步是通过求解特征方程 $\\det(B - \\lambda I) = 0$ 来找到 $B$ 的本征值。\n$$\n\\det \\begin{pmatrix} 1-\\lambda & -\\frac{1}{5} \\\\ -\\frac{1}{5} & 2-\\lambda \\end{pmatrix} = (1-\\lambda)(2-\\lambda) - \\left(-\\frac{1}{5}\\right)^2 = 0\n$$\n$$\n\\lambda^2 - 3\\lambda + 2 - \\frac{1}{25} = 0\n$$\n$$\n\\lambda^2 - 3\\lambda + \\frac{50 - 1}{25} = 0\n$$\n$$\n\\lambda^2 - 3\\lambda + \\frac{49}{25} = 0\n$$\n我们求解这个关于 $\\lambda$ 的二次方程：\n$$\n\\lambda = \\frac{-(-3) \\pm \\sqrt{(-3)^2 - 4(1)\\left(\\frac{49}{25}\\right)}}{2(1)} = \\frac{3 \\pm \\sqrt{9 - \\frac{196}{25}}}{2}\n$$\n$$\n\\lambda = \\frac{3 \\pm \\sqrt{\\frac{225 - 196}{25}}}{2} = \\frac{3 \\pm \\sqrt{\\frac{29}{25}}}{2} = \\frac{3 \\pm \\frac{\\sqrt{29}}{5}}{2}\n$$\n两个本征值是 $\\lambda_1 = \\frac{3}{2} + \\frac{\\sqrt{29}}{10}$ 和 $\\lambda_2 = \\frac{3}{2} - \\frac{\\sqrt{29}}{10}$。\n问题要求的是更新后的最小 Ritz 值，它对应于 $B$ 的最小本征值。这个值是 $\\lambda_2$。\n$$\n\\lambda_{\\min} = \\frac{3}{2} - \\frac{\\sqrt{29}}{10}\n$$\n这就是经过一次 Davidson 展开步骤后，对基态本征值的更新估计。", "answer": "$$\\boxed{\\frac{3}{2} - \\frac{\\sqrt{29}}{10}}$$", "id": "2900262"}, {"introduction": "在真实的量子化学计算中，原子轨道等基函数通常是非正交的，这导致我们需要求解形式为 $H c = \\theta S c$ 的广义本征值问题。因此，标准的戴维森算法必须进行调整以正确处理重叠矩阵 $S$ 的影响。本练习将向你展示如何修改残差向量和对角预处理条件，以构建一个“$S$-感知”的戴维森校正步骤，这是将该方法应用于实际电子结构计算的关键一步。[@problem_id:2900312]", "problem": "给定一个在非正交原子轨道 (AO) 基下的广义对称特征值问题，其中重叠矩阵用 $S$ 表示，哈密顿 (或类Fock) 矩阵用 $H$ 表示。该广义特征问题旨在求解一对 $(\\theta, c)$，使得\n$$\nH c = \\theta S c,\n$$\n其中 $S$ 是对称正定矩阵，$H$ 是对称矩阵。在 Davidson 方法中，子空间扩展向量由当前 Ritz 对的残差和一个近似移位算子逆的预条件子构造而成。你的任务是：从第一性原理推导广义特征问题的残差构造；在非正交基下证明对角预条件子的合理性；使用对角预条件子实现一个考虑 $S$ 的 Davidson 步骤；并为一组小型测试用例计算子空间扩展向量。\n\n你必须使用的基本依据和定义：\n- 向量 $c$ 关于 $(H, S)$ 的广义瑞利商定义为\n$$\n\\theta(c) = \\frac{c^{\\mathsf{T}} H c}{c^{\\mathsf{T}} S c}。\n$$\n- 与广义特征问题的 $(\\theta, c)$ 相关联的残差是\n$$\nr = H c - \\theta S c。\n$$\n- 在 Davidson 方法中，我们通过一个对角矩阵 $D$ 来近似算子 $H - \\theta S$ 的逆，该矩阵 $D$ 在 AO 基中是 $H$ 的一个近似。在非正交 AO 基中，一个考虑 $S$ 的对角预条件子通过对角矩阵（其对角元素为 $D_{ii} - \\theta S_{ii}$）的逆来逐元素地近似 $(H - \\theta S)^{-1}$。\n\n需要实现的算法任务：\n1. 对于每个测试用例，输入包括对称矩阵 $H \\in \\mathbb{R}^{n \\times n}$、对称正定矩阵 $S \\in \\mathbb{R}^{n \\times n}$、一个对角近似 $D \\in \\mathbb{R}^{n}$（除非另有说明，否则为 $H$ 的对角线），以及一个非零向量 $c \\in \\mathbb{R}^{n}$。\n2. 计算广义瑞利商\n$$\n\\theta = \\frac{c^{\\mathsf{T}} H c}{c^{\\mathsf{T}} S c}。\n$$\n3. 计算残差\n$$\nr = H c - \\theta S c。\n$$\n4. 逐元素构造分母\n$$\n\\delta_i = D_{ii} - \\theta S_{ii}。\n$$\n5. 为了安全地对接近零的分母求逆，使用一个阻尼参数 $\\tau > 0$ 进行数值限幅：定义有效分母 $\\tilde{\\delta}_i$ 如下：\n- 如果 $|\\delta_i| \\ge \\tau$，则设 $\\tilde{\\delta}_i = \\delta_i$。\n- 如果 $|\\delta_i| < \\tau$ 且 $\\delta_i > 0$，则设 $\\tilde{\\delta}_i = \\tau$。\n- 如果 $|\\delta_i| < \\tau$ 且 $\\delta_i < 0$，则设 $\\tilde{\\delta}_i = -\\tau$。\n- 如果 $\\delta_i = 0$，则设 $\\tilde{\\delta}_i = \\tau$。\n6. 计算考虑 $S$ 的 Davidson 子空间扩展向量，即带负号的预条件化残差：\n$$\nt_i = - \\frac{r_i}{\\tilde{\\delta}_i}, \\quad i = 1, \\dots, n。\n$$\n在本任务中不执行任何正交化；返回原始的预条件化校正向量 $t$。\n\n数值稳定性要求：\n- 除非另有规定，在所有情况下均使用阻尼参数 $\\tau = 10^{-4}$。\n\n测试套件：\n实现你的程序，为以下每个用例计算向量 $t$。所有矩阵和向量均已明确给出。下面出现的每个数字都应被视为标准双精度算术中的实标量。\n\n- 用例 A (基准, 尺寸 $3 \\times 3$):\n  - $H = \\begin{bmatrix} 1.2 & 0.1 & 0.0 \\\\ 0.1 & 0.9 & 0.05 \\\\ 0.0 & 0.05 & 1.5 \\end{bmatrix}$,\n    $S = \\begin{bmatrix} 1.0 & 0.02 & 0.0 \\\\ 0.02 & 1.0 & 0.01 \\\\ 0.0 & 0.01 & 1.0 \\end{bmatrix}$,\n    $D = \\operatorname{diag}(1.2, 0.9, 1.5)$,\n    $c = \\begin{bmatrix} 0.6 \\\\ 0.3 \\\\ 0.2 \\end{bmatrix}$,\n    $\\tau = 10^{-4}$。\n- 用例 B (近奇异分母, 尺寸 $3 \\times 3$):\n  - $H = \\operatorname{diag}(1.0, 2.0, 3.0)$,\n    $S = I_{3}$,\n    $D = \\operatorname{diag}(1.0, 2.0, 3.0)$,\n    $c = \\begin{bmatrix} 0.01 \\\\ 1.0 \\\\ 0.01 \\end{bmatrix}$,\n    $\\tau = 10^{-4}$。\n- 用例 C (具有非对角元素的非正交重叠, 尺寸 $3 \\times 3$):\n  - $H = \\begin{bmatrix} 1.8 & 0.3 & 0.2 \\\\ 0.3 & 1.1 & 0.4 \\\\ 0.2 & 0.4 & 1.6 \\end{bmatrix}$,\n    $S = \\begin{bmatrix} 1.0 & 0.2 & 0.0 \\\\ 0.2 & 1.0 & 0.1 \\\\ 0.0 & 0.1 & 1.0 \\end{bmatrix}$,\n    $D = \\operatorname{diag}(1.8, 1.1, 1.6)$,\n    $c = \\begin{bmatrix} 0.3 \\\\ -0.4 \\\\ 0.5 \\end{bmatrix}$,\n    $\\tau = 10^{-4}$。\n- 用例 D (具有显著重叠的小体系, 尺寸 $2 \\times 2$):\n  - $H = \\begin{bmatrix} 0.7 & 0.05 \\\\ 0.05 & 1.9 \\end{bmatrix}$,\n    $S = \\begin{bmatrix} 1.0 & 0.3 \\\\ 0.3 & 1.0 \\end{bmatrix}$,\n    $D = \\operatorname{diag}(0.7, 1.9)$,\n    $c = \\begin{bmatrix} 1.0 \\\\ 0.2 \\end{bmatrix}$,\n    $\\tau = 10^{-4}$。\n- 用例 E (精确特征向量，零残差检验, 尺寸 $2 \\times 2$):\n  - $H = \\operatorname{diag}(1.0, 3.0)$,\n    $S = I_{2}$,\n    $D = \\operatorname{diag}(1.0, 3.0)$,\n    $c = \\begin{bmatrix} 1.0 \\\\ 0.0 \\end{bmatrix}$,\n    $\\tau = 10^{-4}$。\n\n你的程序应使用上述过程计算每个用例的向量 $t$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个方括号括起来的、以逗号分隔的结果列表。列表中的每个元素本身也是一个列表，代表给定用例的子空间扩展向量 $t$，顺序与上面列出的一致。例如，输出格式应如下所示：\n$[ [t^{(A)}_1, t^{(A)}_2, \\dots], [t^{(B)}_1, \\dots], \\dots ]$。\n- 所有条目均使用标准浮点十进制表示法。不涉及任何物理单位。", "solution": "所给出的问题是数值线性代数领域一个精确且表述清晰的练习，具体涉及用于求解广义对称特征值问题的 Davidson 迭代法的一个步骤。该问题在科学上合理，逻辑上一致，并为获得唯一解提供了所有必要信息。我们将着手给出一个完整且有理有据的解答。\n\n许多量子化学计算（如 Hartree-Fock 方法）的核心任务是求解广义特征值问题：\n$$\nH c = \\theta S c\n$$\n这里，$H$ 是哈密顿（或Fock）矩阵，它是对称的；$S$ 是非正交原子轨道基的重叠矩阵，它是对称且正定的。特征值 $\\theta$ 对应于轨道能量，特征向量 $c$ 代表构成自分子轨道的原子轨道系数。\n\n对于规模庞大的体系，对完整矩阵进行直接对角化在计算上是不可行的。因此，人们转而采用迭代方法，例如 Davidson 提出的方法。这些方法通过构建一个小型的子空间，在该子空间内求解特征值问题，然后用一个新向量系统地扩展该子空间，该向量被期望能有效地改进对所求特征对的近似。\n\n假设我们已有一个对某特征向量的近似，记为向量 $c$。这个近似的质量通过广义瑞利商来评估：\n$$\n\\theta = \\theta(c) = \\frac{c^{\\mathsf{T}} H c}{c^{\\mathsf{T}} S c}\n$$\n对于给定的试验向量 $c$，这个值 $\\theta$ 是对特征值的最佳近似。相应的残差向量 $r$ 量化了对于这个近似对 $(\\theta, c)$ 的特征值方程中的误差：\n$$\nr = H c - \\theta S c\n$$\n如果 $c$ 是一个精确的特征向量，残差 $r$ 将是零向量。非零残差表明该近似必须被改进。Davidson 方法的核心思想是计算一个校正向量 $\\delta c$，使得 $c + \\delta c$ 成为对真实特征向量更好的近似。\n\n精确的校正 $\\delta c$ 应满足方程 $H(c + \\delta c) = \\theta_{\\text{exact}} S(c + \\delta c)$，这是非线性的且难以求解。通过要求新向量 $c + \\delta c$ 满足使用当前近似特征值 $\\theta$ 的原始方程，可以推导出一个线性近似，称为校正方程：\n$$\nH(c + \\delta c) = \\theta S (c + \\delta c)\n$$\n整理后得到：\n$$\n(H - \\theta S) \\delta c = - (H c - \\theta S c) = -r\n$$\n这就产生了一个关于校正的线性系统：$\\delta c = -(H - \\theta S)^{-1} r$。然而，求解该系统的计算成本与求解原始问题相当。Davidson 方法的创新之处在于用一个更简单、可逆的算子（称为预条件子）来近似算子 $(H - \\theta S)^{-1}$。\n\n在典型的原子轨道基中，哈密顿矩阵 $H$ 通常是对角占优的，意味着其对角元素在量级上远大于非对角元素。这表明 $H$ 的对角线（我们记为 $D$）是 $H$ 的一个合理的一阶近似。遵循这个逻辑，我们仅用其对角分量来近似算子 $(H - \\theta S)$。这就引出了所谓的考虑 $S$ 的对角预条件子。矩阵 $(H - \\theta S)$ 被一个主对角元素如下的对角矩阵 $P$ 近似：\n$$\nP_{ii} = D_{ii} - \\theta S_{ii}\n$$\n这个对角矩阵的逆可以轻易计算：$(P^{-1})_{ii} = 1/P_{ii}$。将该预条件子应用于残差，得到新的子空间扩展向量，问题中记为 $t$：\n$$\nt = -P^{-1} r\n$$\n按元素写出，即为：\n$$\nt_i = -\\frac{r_i}{D_{ii} - \\theta S_{ii}}\n$$\n这个向量 $t$ 就是预处理后的残差。它被用于 Davidson 算法的下一次迭代中扩展子空间。\n\n当分母 $\\delta_i = D_{ii} - \\theta S_{ii}$ 接近零时，会出现一个关键问题。这种情况发生在当前的瑞利商 $\\theta$ 接近于某个近似特征值 $D_{ii}/S_{ii}$ 时。此时，相应分量 $t_i$ 的量级会变得过大，导致迭代过程中的数值不稳定性。为防止这种情况，我们采用一种正则化技术。引入一个小的正阻尼参数 $\\tau$。分母 $\\delta_i$ 被“限幅”，使其量级不小于 $\\tau$。有效分母 $\\tilde{\\delta}_i$ 定义如下：\n- 如果 $|\\delta_i| \\ge \\tau$，则 $\\tilde{\\delta}_i = \\delta_i$。\n- 如果 $|\\delta_i| < \\tau$，则该值被推到允许区间的边界，并保持其符号。对于 $\\delta_i > 0$，$\\tilde{\\delta}_i = \\tau$；对于 $\\delta_i < 0$，$\\tilde{\\delta}_i = -\\tau$。\n- 特殊情况 $\\delta_i = 0$ 通过设置 $\\tilde{\\delta}_i = \\tau$ 来处理。\n\n这种限幅过程确保了校正向量 $t$ 保持在合理的量级，从而稳定了 Davidson 方法的收敛。\n\n按照规定，单个 Davidson 步骤的完整算法如下：\n1.  给定 $H$、$S$、$D$、一个非零向量 $c$ 和一个阻尼参数 $\\tau$。\n2.  计算广义瑞利商：$\\theta = (c^{\\mathsf{T}} H c) / (c^{\\mathsf{T}} S c)$。\n3.  计算残差向量：$r = H c - \\theta S c$。\n4.  逐个构成对角预条件子的分母：$\\delta_i = D_{ii} - \\theta S_{ii}$。\n5.  使用参数 $\\tau$ 进行数值限幅，得到稳定化的分母 $\\tilde{\\delta}_i$。\n6.  计算子空间扩展向量：$t_i = -r_i / \\tilde{\\delta}_i$。\n\n这个稳健的过程构成了 Davidson 特征求解器一次迭代的核心，现在我们将为给定的测试用例实现它。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by computing the S-aware Davidson subspace expansion\n    vector for a suite of test cases.\n    \"\"\"\n\n    def compute_expansion_vector(H, S, D, c, tau):\n        \"\"\"\n        Computes the S-aware Davidson subspace expansion vector for a single case.\n\n        Args:\n            H (np.ndarray): The Hamiltonian matrix.\n            S (np.ndarray): The overlap matrix.\n            D (np.ndarray): The diagonal approximation of H.\n            c (np.ndarray): The current approximate eigenvector.\n            tau (float): The damping parameter for the preconditioner.\n\n        Returns:\n            np.ndarray: The computed subspace expansion vector t.\n        \"\"\"\n        # 1. Ensure inputs are numpy arrays for consistent operations.\n        H = np.asarray(H, dtype=float)\n        S = np.asarray(S, dtype=float)\n        D = np.asarray(D, dtype=float)\n        c = np.asarray(c, dtype=float)\n\n        # 2. Compute the generalized Rayleigh quotient theta.\n        c_T_H_c = c.T @ H @ c\n        c_T_S_c = c.T @ S @ c\n        \n        # Avoid division by zero if c is the zero vector, though problem states non-zero.\n        if c_T_S_c == 0:\n            # This case is not expected with valid inputs (S is SPD, c is non-zero)\n            # but as a safeguard, we can define theta as 0 or handle the error.\n            # A zero residual will result if Hc is also zero.\n            theta = 0.0\n        else:\n            theta = c_T_H_c / c_T_S_c\n\n        # 3. Compute the residual r.\n        r = H @ c - theta * (S @ c)\n\n        # 4. Form the elementwise denominators for the preconditioner.\n        # S.diagonal() extracts the main diagonal of the overlap matrix S.\n        denominators = D - theta * S.diagonal()\n\n        # 5. Apply magnitude clamping with the damping parameter tau.\n        tilde_denominators = np.zeros_like(denominators)\n        for i, delta in enumerate(denominators):\n            if abs(delta) >= tau:\n                tilde_denominators[i] = delta\n            else:\n                if delta == 0:\n                    tilde_denominators[i] = tau\n                elif delta > 0:\n                    tilde_denominators[i] = tau\n                else: # delta < 0\n                    tilde_denominators[i] = -tau\n\n        # 6. Compute the subspace expansion vector t.\n        # We must handle the case where tilde_denominators can still be zero,\n        # although the logic above prevents this for non-zero tau.\n        # The elementwise division is safe.\n        t = -r / tilde_denominators\n        \n        return t\n\n    # Define the test cases from the problem statement.\n    tau_global = 1e-4\n\n    test_cases = [\n        # Case A\n        (\n            [[1.2, 0.1, 0.0], [0.1, 0.9, 0.05], [0.0, 0.05, 1.5]],\n            [[1.0, 0.02, 0.0], [0.02, 1.0, 0.01], [0.0, 0.01, 1.0]],\n            [1.2, 0.9, 1.5],\n            [0.6, 0.3, 0.2],\n            tau_global\n        ),\n        # Case B\n        (\n            [[1.0, 0.0, 0.0], [0.0, 2.0, 0.0], [0.0, 0.0, 3.0]],\n            [[1.0, 0.0, 0.0], [0.0, 1.0, 0.0], [0.0, 0.0, 1.0]],\n            [1.0, 2.0, 3.0],\n            [0.01, 1.0, 0.01],\n            tau_global\n        ),\n        # Case C\n        (\n            [[1.8, 0.3, 0.2], [0.3, 1.1, 0.4], [0.2, 0.4, 1.6]],\n            [[1.0, 0.2, 0.0], [0.2, 1.0, 0.1], [0.0, 0.1, 1.0]],\n            [1.8, 1.1, 1.6],\n            [0.3, -0.4, 0.5],\n            tau_global\n        ),\n        # Case D\n        (\n            [[0.7, 0.05], [0.05, 1.9]],\n            [[1.0, 0.3], [0.3, 1.0]],\n            [0.7, 1.9],\n            [1.0, 0.2],\n            tau_global\n        ),\n        # Case E\n        (\n            [[1.0, 0.0], [0.0, 3.0]],\n            [[1.0, 0.0], [0.0, 1.0]],\n            [1.0, 3.0],\n            [1.0, 0.0],\n            tau_global\n        )\n    ]\n\n    results = []\n    for case in test_cases:\n        H_case, S_case, D_case, c_case, tau_case = case\n        t_vector = compute_expansion_vector(H_case, S_case, D_case, c_case, tau_case)\n        results.append(t_vector.tolist())\n\n    # Final print statement in the exact required format.\n    # The default string representation of a list of lists matches the required format.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "2900312"}]}