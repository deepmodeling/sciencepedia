{"hands_on_practices": [{"introduction": "在深入研究解析梯度的复杂性之前，理解其数值对应物至关重要，因为数值梯度是验证解析梯度代码的关键工具。本练习探讨了使用有限差分法计算梯度时遇到的实际挑战。通过分析随着步长 $h$ 减小而减小的截断误差与随之增大的数值舍入误差之间的相互作用，你将推导出最小化总误差的最佳步长，从而深刻理解数值微分的内在局限性。[@problem_id:2874113]", "problem": "在玻恩-奥本海默(Born–Oppenheimer)量子化学中，沿着单个内坐标 $R$ 的分子力分量为 $F(R)=-\\frac{dE(R)}{dR}$，其中 $E(R)$ 是在固定原子核坐标下的电子能量。假设 $E(R)$ 足够平滑，您使用中心有限差分估计量来近似导数 $\\frac{dE(R)}{dR}$\n$$\nG_{h}(R)\\;=\\;\\frac{E(R+h)\\;-\\;E(R-h)}{2h}.\n$$\n假设存在两个独立的误差来源：\n- 截断误差源于泰勒级数余项，随 $h$ 的变化尺度为 $\\mathcal{O}(h^{2})$。\n- 数值噪音的产生是由于每次计算的能量值 $E(R\\pm h)$ 都受到因浮点舍入和未完全的自洽场（SCF）收敛所导致的附加误差的污染。通过假设计算出的能量为 $\\tilde{E}(R\\pm h)=E(R\\pm h)+\\delta_{\\pm}$ 来对此建模，其中 $|\\delta_{\\pm}|\\le \\sigma_{E}$，$\\sigma_{E}$ 是一个已知的绝对能量误差界限，该界限整合了机器舍入误差和 SCF 残差。\n\n仅从 $E(R\\pm h)$ 关于 $R$ 的带有积分形式余项的泰勒展开式和上述噪音模型出发，推导 $G_{h}(R)$ 中总误差大小的主导阶表达式，该表达式是 $h$、$E^{(3)}(R)$ 和 $\\sigma_{E}$ 的函数。然后，确定使此主导阶误差最小化的步长 $h$。将您的最终答案表示为最优步长 $h_{\\text{opt}}$ 关于 $\\sigma_{E}$ 和 $E^{(3)}(R)$ 的单个闭式解析表达式。不要在最终表达式中代入数值，也不要包含单位。", "solution": "该问题要求推导用于能量导数的中心有限差分近似的最优步长 $h_{\\text{opt}}$。推导过程必须考虑两种相互竞争的误差来源：有限差分公式固有的截断误差和能量计算产生的数值噪音。必须首先将总误差表示为步长 $h$ 的函数，然后通过最小化该函数来找到最优的 $h$。\n\n需要近似的量是能量的一阶导数，$E'(R) = \\frac{dE(R)}{dR}$。该量的中心有限差分估计量由 $D_h(R) = \\frac{E(R+h) - E(R-h)}{2h}$ 给出。注意，力是 $F(R) = -E'(R)$，因此我们正在计算 $-F(R)$ 的近似值。我们计算导数的总误差是包含数值噪音的计算值与导数的真实值之间的差。\n\n我们首先来确定截断误差 $\\epsilon_{\\text{trunc}}$。此误差是使用精确能量的有限差分近似值与真实导数之间的差：$\\epsilon_{\\text{trunc}}(h) = D_h(R) - E'(R)$。根据题意，我们使用带有积分形式余项的泰勒级数展开。对于一个足够平滑的函数 $E(R)$， $E(R+h)$ 和 $E(R-h)$ 关于 $R$ 直到二阶项的展开式为：\n$$\nE(R+h) = E(R) + E'(R)h + \\frac{E''(R)}{2!}h^2 + \\frac{1}{2!} \\int_R^{R+h} (R+h-t)^2 E^{(3)}(t) dt\n$$\n$$\nE(R-h) = E(R) - E'(R)h + \\frac{E''(R)}{2!}h^2 + \\frac{1}{2!} \\int_R^{R-h} (R-h-t)^2 E^{(3)}(t) dt\n$$\n将第二个方程从第一个方程中减去，得到：\n$$\nE(R+h) - E(R-h) = 2E'(R)h + \\frac{1}{2} \\left( \\int_R^{R+h} (R+h-t)^2 E^{(3)}(t) dt - \\int_R^{R-h} (R-h-t)^2 E^{(3)}(t) dt \\right)\n$$\n除以 $2h$ 以构成有限差分表达式 $D_h(R)$：\n$$\nD_h(R) = E'(R) + \\frac{1}{4h} \\left( \\int_R^{R+h} (R+h-t)^2 E^{(3)}(t) dt - \\int_R^{R-h} (R-h-t)^2 E^{(3)}(t) dt \\right)\n$$\n因此，截断误差为：\n$$\n\\epsilon_{\\text{trunc}}(h) = \\frac{1}{4h} \\left( \\int_R^{R+h} (R+h-t)^2 E^{(3)}(t) dt - \\int_R^{R-h} (R-h-t)^2 E^{(3)}(t) dt \\right)\n$$\n为了找到主导阶行为，我们假设 $h$ 很小。对于积分区间 $[R-h, R+h]$ 中的 $t$，我们可以用区间中心点的值 $E^{(3)}(R)$ 来近似三阶导数 $E^{(3)}(t)$，即 $E^{(3)}(t) \\approx E^{(3)}(R)$。这样做是合理的，因为函数 $E(R)$ 被假设是平滑的。\n$$\n\\epsilon_{\\text{trunc}}(h) \\approx \\frac{E^{(3)}(R)}{4h} \\left( \\int_R^{R+h} (R+h-t)^2 dt - \\int_R^{R-h} (R-h-t)^2 dt \\right)\n$$\n积分计算结果为：\n$$\n\\int_R^{R+h} (R+h-t)^2 dt = \\left[ -\\frac{(R+h-t)^3}{3} \\right]_R^{R+h} = 0 - \\left(-\\frac{h^3}{3}\\right) = \\frac{h^3}{3}\n$$\n$$\n\\int_R^{R-h} (R-h-t)^2 dt = \\left[ -\\frac{(R-h-t)^3}{3} \\right]_R^{R-h} = 0 - \\left(-\\frac{(-h)^3}{3}\\right) = -\\frac{h^3}{3}\n$$\n将这些结果代回到 $\\epsilon_{\\text{trunc}}(h)$ 的表达式中：\n$$\n\\epsilon_{\\text{trunc}}(h) \\approx \\frac{E^{(3)}(R)}{4h} \\left( \\frac{h^3}{3} - \\left(-\\frac{h^3}{3}\\right) \\right) = \\frac{E^{(3)}(R)}{4h} \\left( \\frac{2h^3}{3} \\right) = \\frac{E^{(3)}(R)}{6}h^2\n$$\n主导阶截断误差的大小为 $|\\epsilon_{\\text{trunc}}(h)| \\approx \\frac{|E^{(3)}(R)|}{6}h^2$。\n\n接下来，我们分析数值噪音带来的误差。计算出的梯度估计量 $\\tilde{G}_h(R)$ 使用的是被误差 $\\delta_{\\pm}$ 污染的能量：\n$$\n\\tilde{G}_h(R) = \\frac{\\tilde{E}(R+h) - \\tilde{E}(R-h)}{2h} = \\frac{(E(R+h) + \\delta_+) - (E(R-h) + \\delta_-)}{2h}\n$$\n$$\n\\tilde{G}_h(R) = \\frac{E(R+h) - E(R-h)}{2h} + \\frac{\\delta_+ - \\delta_-}{2h} = D_h(R) + \\epsilon_{\\text{noise}}(h)\n$$\n由数值噪音引起的误差是 $\\epsilon_{\\text{noise}}(h) = \\frac{\\delta_+ - \\delta_-}{2h}$。我们已知单个能量误差大小的上限：$|\\delta_{\\pm}| \\le \\sigma_E$。我们寻求噪音误差大小 $|\\epsilon_{\\text{noise}}(h)|$ 的一个界限：\n$$\n|\\epsilon_{\\text{noise}}(h)| = \\left| \\frac{\\delta_+ - \\delta_-}{2h} \\right| = \\frac{|\\delta_+ - \\delta_-|}{2h}\n$$\n使用三角不等式，有 $|\\delta_+ - \\delta_-| \\le |\\delta_+| + |-\\delta_-| = |\\delta_+| + |\\delta_-|$。最坏情况发生在误差符号相反且大小达到最大值时：\n$$\n|\\epsilon_{\\text{noise}}(h)| \\le \\frac{|\\delta_+| + |\\delta_-|}{2h} \\le \\frac{\\sigma_E + \\sigma_E}{2h} = \\frac{2\\sigma_E}{2h} = \\frac{\\sigma_E}{h}\n$$\n计算出的梯度的总误差是 $\\epsilon_{\\text{total}} = \\tilde{G}_h(R) - E'(R) = \\epsilon_{\\text{trunc}}(h) + \\epsilon_{\\text{noise}}(h)$。总误差的大小受各个误差贡献大小之和的限制（同样根据三角不等式）：\n$$\n|\\epsilon_{\\text{total}}(h)| \\le |\\epsilon_{\\text{trunc}}(h)| + |\\epsilon_{\\text{noise}}(h)|\n$$\n我们使用主导阶截断误差和最坏情况下的噪音误差来定义总误差函数 $\\mathcal{E}(h)$：\n$$\n\\mathcal{E}(h) = \\frac{|E^{(3)}(R)|}{6}h^2 + \\frac{\\sigma_E}{h}\n$$\n为了找到使该总误差最小化的步长 $h$，我们将 $\\mathcal{E}(h)$ 对 $h$ 求导，并令结果为零：\n$$\n\\frac{d\\mathcal{E}(h)}{dh} = \\frac{d}{dh} \\left( \\frac{|E^{(3)}(R)|}{6}h^2 + \\sigma_E h^{-1} \\right) = 2 \\frac{|E^{(3)}(R)|}{6}h - \\sigma_E h^{-2} = \\frac{|E^{(3)}(R)|}{3}h - \\frac{\\sigma_E}{h^2}\n$$\n将导数设为零以求得最优步长 $h_{\\text{opt}}$：\n$$\n\\frac{|E^{(3)}(R)|}{3}h_{\\text{opt}} - \\frac{\\sigma_E}{h_{\\text{opt}}^2} = 0\n$$\n$$\n\\frac{|E^{(3)}(R)|}{3}h_{\\text{opt}} = \\frac{\\sigma_E}{h_{\\text{opt}}^2}\n$$\n$$\nh_{\\text{opt}}^3 = \\frac{3\\sigma_E}{|E^{(3)}(R)|}\n$$\n求解 $h_{\\text{opt}}$ 可得：\n$$\nh_{\\text{opt}} = \\left( \\frac{3\\sigma_E}{|E^{(3)}(R)|} \\right)^{\\frac{1}{3}}\n$$\n二阶导数 $\\frac{d^2\\mathcal{E}}{dh^2} = \\frac{|E^{(3)}(R)|}{3} + \\frac{2\\sigma_E}{h^3}$，对于正的 $h$、$\\sigma_E$ 和非零的 $E^{(3)}(R)$ 恒为正，这证实了该 $h$ 值对应于误差函数的最小值。使用绝对值 $|E^{(3)}(R)|$ 是必要的，以确保步长 $h_{\\text{opt}}$ 是一个实数和正数。", "answer": "$$\n\\boxed{\\left( \\frac{3\\sigma_{E}}{|E^{(3)}(R)|} \\right)^{\\frac{1}{3}}}\n$$", "id": "2874113"}, {"introduction": "解析梯度是分子几何优化的引擎。虽然梯度可以用笛卡尔坐标表示，但使用键角和二面角等内坐标通常能实现更高效的优化。本练习要求你应用链式法则，推导决定分子构象的基本四体项——二面角——对原子笛卡尔坐标的解析梯度。这个过程不仅能巩固你的向量微积分技能，还能揭示在共线原子排列中出现的奇点等实际挑战。[@problem_id:2874054]", "problem": "在量子化学中用于几何优化的内坐标中，与四个原子 $\\,i,j,k,l\\,$ 相关的二面角 $\\,\\phi(i,j,k,l)\\,$ 是平面 $\\, (i,j,k)\\,$ 和 $\\, (j,k,l)\\,$ 之间的带符号夹角，其符号由关于从 $\\,j\\,$ 到 $\\,k\\,$ 的键矢量的右手定则确定。设笛卡尔坐标位置为 $\\,\\mathbf{r}_i,\\mathbf{r}_j,\\mathbf{r}_k,\\mathbf{r}_l \\in \\mathbb{R}^3$。定义键矢量 $\\,\\mathbf{b}_1 = \\mathbf{r}_j - \\mathbf{r}_i\\,$, $\\,\\mathbf{b}_2 = \\mathbf{r}_k - \\mathbf{r}_j\\,$ 及 $\\,\\mathbf{b}_3 = \\mathbf{r}_l - \\mathbf{r}_k\\,$。定义平面法向量 $\\,\\mathbf{u} = \\mathbf{b}_1 \\times \\mathbf{b}_2\\,$ 和 $\\,\\mathbf{v} = \\mathbf{b}_2 \\times \\mathbf{b}_3\\,$。二面角的一个平滑带符号定义为 $\\,\\phi = \\arctan2(\\beta,\\alpha)\\,$，其中 $\\,\\alpha = \\mathbf{u}\\cdot\\mathbf{v}\\,$ 且 $\\,\\beta = \\|\\mathbf{b}_2\\|\\,(\\mathbf{b}_1\\cdot \\mathbf{v})\\,$，这里 $\\,\\arctan2(y,x)\\,$ 返回正切值为 $\\,y/x\\,$ 且位于正确象限的角度。\n\n任务：\n1. 从这些定义出发，仅使用标准矢量微积分和微分恒等式，推导出一阶微分 $\\,\\mathrm{d}\\phi\\,$，用 $\\,\\mathrm{d}\\mathbf{r}_i, \\mathrm{d}\\mathbf{r}_j, \\mathrm{d}\\mathbf{r}_k, \\mathrm{d}\\mathbf{r}_l\\,$ 表示。通过 $\\,\\mathrm{d}\\alpha\\,$ 和 $\\,\\mathrm{d}\\beta\\,$ 表达 $\\,\\mathrm{d}\\phi\\,$，然后通过 $\\,\\mathrm{d}\\mathbf{b}_1, \\mathrm{d}\\mathbf{b}_2, \\mathrm{d}\\mathbf{b}_3\\,$ 将其表示为笛卡尔坐标微分的函数。你可以使用乘积法则 $\\,\\mathrm{d}(\\mathbf{a}\\cdot\\mathbf{b}) = \\mathrm{d}\\mathbf{a}\\cdot\\mathbf{b} + \\mathbf{a}\\cdot\\mathrm{d}\\mathbf{b}\\,$ 和 $\\,\\mathrm{d}(\\mathbf{a}\\times\\mathbf{b}) = \\mathrm{d}\\mathbf{a}\\times\\mathbf{b} + \\mathbf{a}\\times\\mathrm{d}\\mathbf{b}\\,$，以及 $\\,\\mathrm{d}\\|\\mathbf{b}_2\\| = (\\mathbf{b}_2\\cdot \\mathrm{d}\\mathbf{b}_2)/\\|\\mathbf{b}_2\\|\\,$。\n2. 使用你得到的 $\\,\\mathrm{d}\\phi\\,$ 的一般表达式，确定当原子变为共线时，解析导数 $\\,\\partial \\phi/\\partial \\mathbf{r}_a\\,$（其中 $\\,a\\in\\{i,j,k,l\\}$）的奇异条件。描述哪些共线情况会导致奇异行为，以及这在你的公式中是如何体现的。\n3. 将你的一般结果应用于以下具体几何构型（所有坐标单位为埃）：$\\,\\mathbf{r}_i = (0,0,0)\\,$，$\\,\\mathbf{r}_j=(1,0,0)\\,$，$\\,\\mathbf{r}_k=(1,1,0)\\,$，$\\,\\mathbf{r}_l=(1,1,1)\\,$。计算在该几何构型下的单个笛卡尔偏导数 $\\,\\partial \\phi / \\partial z_i\\,$。将导数以弧度/埃为单位表示。提供精确值（不要四舍五入）。", "solution": "该问题陈述清晰，具有科学依据，并包含了完整推导和计算所需的所有信息。这是一个理论化学中的标准问题，涉及分子结构优化所需的几何导数。我们按以下步骤进行求解。\n\n二面角 $\\,\\phi\\,$ 定义为 $\\,\\phi = \\arctan2(\\beta, \\alpha)\\,$，其中 $\\,\\alpha = \\mathbf{u} \\cdot \\mathbf{v}\\,$ 且 $\\,\\beta = \\|\\mathbf{b}_2\\| (\\mathbf{b}_1 \\cdot \\mathbf{v})\\,$。矢量 $\\,\\mathbf{u} = \\mathbf{b}_1 \\times \\mathbf{b}_2\\,$ 和 $\\,\\mathbf{v} = \\mathbf{b}_2 \\times \\mathbf{b}_3\\,$ 分别是平面 $\\,(i,j,k)\\,$ 和 $\\,(j,k,l)\\,$ 的法向量。键矢量为 $\\,\\mathbf{b}_1 = \\mathbf{r}_j - \\mathbf{r}_i\\,$, $\\,\\mathbf{b}_2 = \\mathbf{r}_k - \\mathbf{r}_j\\,$ 及 $\\,\\mathbf{b}_3 = \\mathbf{r}_l - \\mathbf{r}_k\\,$。\n\n首先，我们建立 $\\,\\alpha, \\beta, \\mathbf{u}, \\mathbf{v}\\,$ 之间的一个关键关系。矢量四重积 $\\,\\mathbf{u} \\times \\mathbf{v} = (\\mathbf{b}_1 \\times \\mathbf{b}_2) \\times (\\mathbf{b}_2 \\times \\mathbf{b}_3)\\,$ 可以通过矢量恒等式简化为 $[\\mathbf{b}_1, \\mathbf{b}_2, \\mathbf{b}_3] \\mathbf{b}_2$。利用标量三重积 $[\\mathbf{b}_1, \\mathbf{b}_2, \\mathbf{b}_3] = \\mathbf{b}_1 \\cdot (\\mathbf{b}_2 \\times \\mathbf{b}_3) = \\mathbf{b}_1 \\cdot \\mathbf{v}$，我们得到 $\\,\\mathbf{u} \\times \\mathbf{v} = (\\mathbf{b}_1 \\cdot \\mathbf{v}) \\mathbf{b}_2\\,$。代入 $\\,\\beta\\,$ 的定义，我们得到 $\\,\\mathbf{u} \\times \\mathbf{v} = \\frac{\\beta}{\\|\\mathbf{b}_2\\|} \\mathbf{b}_2\\,$。该矢量的模的平方为 $\\,\\|\\mathbf{u} \\times \\mathbf{v}\\|^2 = \\frac{\\beta^2}{\\|\\mathbf{b}_2\\|^2} \\|\\mathbf{b}_2\\|^2 = \\beta^2\\,$。另外，$\\,\\|\\mathbf{u} \\times \\mathbf{v}\\|^2 = \\|\\mathbf{u}\\|^2 \\|\\mathbf{v}\\|^2 \\sin^2(\\phi) = \\|\\mathbf{u}\\|^2 \\|\\mathbf{v}\\|^2 - (\\mathbf{u} \\cdot \\mathbf{v})^2 = \\|\\mathbf{u}\\|^2 \\|\\mathbf{v}\\|^2 - \\alpha^2\\,$。因此，我们得到了重要关系 $\\,\\alpha^2 + \\beta^2 = \\|\\mathbf{u}\\|^2 \\|\\mathbf{v}\\|^2\\,$。\n\n**任务1：微分 $\\,\\mathrm{d}\\phi\\,$ 的推导**\n\n$\\,\\phi = \\arctan2(\\beta, \\alpha)\\,$ 的微分由标准公式给出：\n$$\n\\mathrm{d}\\phi = \\frac{\\alpha\\,\\mathrm{d}\\beta - \\beta\\,\\mathrm{d}\\alpha}{\\alpha^2 + \\beta^2} = \\frac{\\alpha\\,\\mathrm{d}\\beta - \\beta\\,\\mathrm{d}\\alpha}{\\|\\mathbf{u}\\|^2 \\|\\mathbf{v}\\|^2}\n$$\n现在我们必须求出微分 $\\,\\mathrm{d}\\alpha\\,$ 和 $\\,\\mathrm{d}\\beta\\,$，用键矢量的微分 $\\,\\mathrm{d}\\mathbf{b}_1, \\mathrm{d}\\mathbf{b}_2, \\mathrm{d}\\mathbf{b}_3\\,$ 表示。\n使用给定的乘积法则：\n$$\n\\mathrm{d}\\alpha = \\mathrm{d}(\\mathbf{u}\\cdot\\mathbf{v}) = \\mathrm{d}\\mathbf{u}\\cdot\\mathbf{v} + \\mathbf{u}\\cdot\\mathrm{d}\\mathbf{v}\n$$\n$$\n\\mathrm{d}\\beta = \\mathrm{d}(\\|\\mathbf{b}_2\\|(\\mathbf{b}_1\\cdot\\mathbf{v})) = \\mathrm{d}\\|\\mathbf{b}_2\\|(\\mathbf{b}_1\\cdot\\mathbf{v}) + \\|\\mathbf{b}_2\\|\\mathrm{d}(\\mathbf{b}_1\\cdot\\mathbf{v}) = \\frac{\\mathbf{b}_2\\cdot\\mathrm{d}\\mathbf{b}_2}{\\|\\mathbf{b}_2\\|}(\\mathbf{b}_1\\cdot\\mathbf{v}) + \\|\\mathbf{b}_2\\|(\\mathrm{d}\\mathbf{b}_1\\cdot\\mathbf{v} + \\mathbf{b}_1\\cdot\\mathrm{d}\\mathbf{v})\n$$\n法向量的微分是：\n$$\n\\mathrm{d}\\mathbf{u} = \\mathrm{d}(\\mathbf{b}_1\\times\\mathbf{b}_2) = \\mathrm{d}\\mathbf{b}_1\\times\\mathbf{b}_2 + \\mathbf{b}_1\\times\\mathrm{d}\\mathbf{b}_2\n$$\n$$\n\\mathrm{d}\\mathbf{v} = \\mathrm{d}(\\mathbf{b}_2\\times\\mathbf{b}_3) = \\mathrm{d}\\mathbf{b}_2\\times\\mathbf{b}_3 + \\mathbf{b}_2\\times\\mathrm{d}\\mathbf{b}_3\n$$\n将这些代入 $\\,\\mathrm{d}\\alpha\\,$ 和 $\\,\\mathrm{d}\\beta\\,$，并对每个 $\\,\\mathrm{d}\\mathbf{b}_n\\,$ 收集项：\n$\\mathrm{d}\\alpha = (\\mathrm{d}\\mathbf{b}_1 \\times \\mathbf{b}_2)\\cdot\\mathbf{v} + (\\mathbf{b}_1 \\times \\mathrm{d}\\mathbf{b}_2)\\cdot\\mathbf{v} + \\mathbf{u}\\cdot(\\mathrm{d}\\mathbf{b}_2 \\times \\mathbf{b}_3) + \\mathbf{u}\\cdot(\\mathbf{b}_2 \\times \\mathrm{d}\\mathbf{b}_3) = (\\mathbf{b}_2\\times\\mathbf{v})\\cdot \\mathrm{d}\\mathbf{b}_1 + ((\\mathbf{v}\\times\\mathbf{b}_1)+(\\mathbf{b}_3\\times\\mathbf{u}))\\cdot \\mathrm{d}\\mathbf{b}_2 + (\\mathbf{u}\\times\\mathbf{b}_2)\\cdot \\mathrm{d}\\mathbf{b}_3$。\n\n$\\mathrm{d}\\beta = \\frac{\\beta}{\\|\\mathbf{b}_2\\|^2}(\\mathbf{b}_2\\cdot\\mathrm{d}\\mathbf{b}_2) + \\|\\mathbf{b}_2\\|(\\mathbf{v}\\cdot\\mathrm{d}\\mathbf{b}_1) + \\|\\mathbf{b}_2\\|((\\mathbf{b}_3\\times\\mathbf{b}_1)\\cdot\\mathrm{d}\\mathbf{b}_2) + \\|\\mathbf{b}_2\\|((\\mathbf{b}_1\\times\\mathbf{b}_2)\\cdot\\mathrm{d}\\mathbf{b}_3)$。\n\n全微分为 $\\,\\mathrm{d}\\phi = \\sum_{n=1}^3 \\mathbf{C}_{\\mathbf{b}_n}\\cdot \\mathrm{d}\\mathbf{b}_n\\,$，其中 $\\,\\mathbf{C}_{\\mathbf{b}_n} = \\frac{\\alpha \\mathbf{B}_n - \\beta \\mathbf{A}_n}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2}\\,$。这里 $\\,\\mathbf{A}_n\\,$ 和 $\\,\\mathbf{B}_n\\,$ 是 $\\,\\mathrm{d}\\alpha\\,$ 和 $\\,\\mathrm{d}\\beta\\,$ 展开式中 $\\,\\mathrm{d}\\mathbf{b}_n\\,$ 的矢量系数。\n\n让我们使用矢量恒等式来求 $\\,\\mathbf{C}_{\\mathbf{b}_1}\\,$ 和 $\\,\\mathbf{C}_{\\mathbf{b}_3}\\,$。\n对于 $\\,\\mathbf{C}_{\\mathbf{b}_1}\\,$：$\\mathbf{A}_1 = \\mathbf{b}_2\\times\\mathbf{v}$ 且 $\\mathbf{B}_1 = \\|\\mathbf{b}_2\\|\\mathbf{v}$。\n$\\mathbf{C}_{\\mathbf{b}_1} = \\frac{\\alpha(\\|\\mathbf{b}_2\\|\\mathbf{v}) - \\beta(\\mathbf{b}_2\\times\\mathbf{v})}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2} = \\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2}(\\alpha\\mathbf{v}-(\\mathbf{b}_1\\cdot\\mathbf{v})(\\mathbf{b}_2\\times\\mathbf{v}))$。\n我们使用恒等式 $\\,\\mathbf{v}\\times(\\mathbf{v}\\times\\mathbf{u}) = (\\mathbf{v}\\cdot\\mathbf{u})\\mathbf{v} - \\|\\mathbf{v}\\|^2\\mathbf{u} = \\alpha\\mathbf{v}-\\|\\mathbf{v}\\|^2\\mathbf{u}\\,$。\n此外，$\\,\\mathbf{v}\\times(\\mathbf{v}\\times\\mathbf{u}) = \\mathbf{v}\\times(-\\mathbf{u}\\times\\mathbf{v}) = \\mathbf{v}\\times(-\\frac{\\beta}{\\|\\mathbf{b}_2\\|}\\mathbf{b}_2) = \\frac{\\beta}{\\|\\mathbf{b}_2\\|}(\\mathbf{b}_2\\times\\mathbf{v}) = (\\mathbf{b}_1\\cdot\\mathbf{v})(\\mathbf{b}_2\\times\\mathbf{v})\\,$。\n令两个表达式相等得到 $\\,\\alpha\\mathbf{v}-(\\mathbf{b}_1\\cdot\\mathbf{v})(\\mathbf{b}_2\\times\\mathbf{v}) = \\|\\mathbf{v}\\|^2\\mathbf{u}\\,$。\n将此代入 $\\,\\mathbf{C}_{\\mathbf{b}_1}\\,$ 得到：\n$$\n\\mathbf{C}_{\\mathbf{b}_1} = \\frac{\\|\\mathbf{b}_2\\|(\\|\\mathbf{v}\\|^2\\mathbf{u})}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2} = \\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{u}\\|^2}\\mathbf{u}\n$$\n对于 $\\,\\mathbf{C}_{\\mathbf{b}_3}\\,$：$\\mathbf{A}_3 = \\mathbf{u}\\times\\mathbf{b}_2$ 且 $\\mathbf{B}_3 = \\|\\mathbf{b}_2\\|\\mathbf{u}$。\n$\\mathbf{C}_{\\mathbf{b}_3} = \\frac{\\alpha(\\|\\mathbf{b}_2\\|\\mathbf{u}) - \\beta(\\mathbf{u}\\times\\mathbf{b}_2)}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2} = \\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2}(\\alpha\\mathbf{u}-(\\mathbf{b}_1\\cdot\\mathbf{v})(\\mathbf{u}\\times\\mathbf{b}_2))\\,$.\n使用一个类似的恒等式 $\\,\\mathbf{u}\\times(\\mathbf{u}\\times\\mathbf{v}) = (\\mathbf{u}\\cdot\\mathbf{v})\\mathbf{u}-\\|\\mathbf{u}\\|^2\\mathbf{v} = \\alpha\\mathbf{u}-\\|\\mathbf{u}\\|^2\\mathbf{v}\\,$。\n并且 $\\,\\mathbf{u}\\times(\\mathbf{u}\\times\\mathbf{v}) = \\mathbf{u}\\times(\\frac{\\beta}{\\|\\mathbf{b}_2\\|}\\mathbf{b}_2) = \\frac{\\beta}{\\|\\mathbf{b}_2\\|}(\\mathbf{u}\\times\\mathbf{b}_2) = (\\mathbf{b}_1\\cdot\\mathbf{v})(\\mathbf{u}\\times\\mathbf{b}_2)\\,$。\n这给出 $\\,\\alpha\\mathbf{u}-(\\mathbf{b}_1\\cdot\\mathbf{v})(\\mathbf{u}\\times\\mathbf{b}_2) = \\|\\mathbf{u}\\|^2\\mathbf{v}\\,$。\n将此代入 $\\,\\mathbf{C}_{\\mathbf{b}_3}\\,$ 得到：\n$$\n\\mathbf{C}_{\\mathbf{b}_3} = \\frac{\\|\\mathbf{b}_2\\|(\\|\\mathbf{u}\\|^2\\mathbf{v})}{\\|\\mathbf{u}\\|^2\\|\\mathbf{v}\\|^2} = \\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{v}\\|^2}\\mathbf{v}\n$$\n系数 $\\,\\mathbf{C}_{\\mathbf{b}_2}\\,$ 更为复杂，但我们有来自平移不变性的力的关系，$\\,\\nabla_i + \\nabla_j + \\nabla_k + \\nabla_l = \\mathbf{0}\\,$。\n全微分为：\n$$\n\\mathrm{d}\\phi = \\left(\\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{u}\\|^2}\\mathbf{u}\\right)\\cdot \\mathrm{d}\\mathbf{b}_1 + \\mathbf{C}_{\\mathbf{b}_2}\\cdot \\mathrm{d}\\mathbf{b}_2 + \\left(\\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{v}\\|^2}\\mathbf{v}\\right)\\cdot \\mathrm{d}\\mathbf{b}_3\n$$\n代入 $\\,\\mathrm{d}\\mathbf{b}_1 = \\mathrm{d}\\mathbf{r}_j - \\mathrm{d}\\mathbf{r}_i\\,$, $\\,\\mathrm{d}\\mathbf{b}_2=\\mathrm{d}\\mathbf{r}_k - \\mathrm{d}\\mathbf{r}_j\\,$, $\\,\\mathrm{d}\\mathbf{b}_3=\\mathrm{d}\\mathbf{r}_l - \\mathrm{d}\\mathbf{r}_k\\,$ 得到 $\\,\\mathrm{d}\\phi = \\sum_{a=i,j,k,l} \\frac{\\partial\\phi}{\\partial\\mathbf{r}_a}\\cdot\\mathrm{d}\\mathbf{r}_a\\,$。梯度为：\n$$\n\\frac{\\partial\\phi}{\\partial\\mathbf{r}_i} = -\\mathbf{C}_{\\mathbf{b}_1} = -\\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{u}\\|^2}\\mathbf{u}\n$$\n$$\n\\frac{\\partial\\phi}{\\partial\\mathbf{r}_l} = \\mathbf{C}_{\\mathbf{b}_3} = \\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{v}\\|^2}\\mathbf{v}\n$$\n$$\n\\frac{\\partial\\phi}{\\partial\\mathbf{r}_j} = \\mathbf{C}_{\\mathbf{b}_1} - \\mathbf{C}_{\\mathbf{b}_2} \\quad , \\quad \\frac{\\partial\\phi}{\\partial\\mathbf{r}_k} = \\mathbf{C}_{\\mathbf{b}_2} - \\mathbf{C}_{\\mathbf{b}_3}\n$$\n\n**任务2：奇异条件**\n\n解析导数 $\\,\\frac{\\partial\\phi}{\\partial\\mathbf{r}_a}\\,$ 包含分母 $\\,\\|\\mathbf{u}\\|^2\\,$ 和 $\\,\\|\\mathbf{v}\\|^2\\,$。如果其中任何一个为零，就会出现奇异点。\n$\\,\\|\\mathbf{u}\\| = \\|\\mathbf{b}_1 \\times \\mathbf{b}_2\\| = 0\\,$ 当且仅当矢量 $\\,\\mathbf{b}_1 = \\mathbf{r}_j - \\mathbf{r}_i\\,$ 和 $\\,\\mathbf{b}_2 = \\mathbf{r}_k - \\mathbf{r}_j\\,$ 共线。这对应于原子 $\\,i, j, k\\,$ 位于同一直线上。\n类似地，$\\,\\|\\mathbf{v}\\| = \\|\\mathbf{b}_2 \\times \\mathbf{b}_3\\| = 0\\,$ 当且仅当矢量 $\\,\\mathbf{b}_2 = \\mathbf{r}_k - \\mathbf{r}_j\\,$ 和 $\\,\\mathbf{b}_3 = \\mathbf{r}_l - \\mathbf{r}_k\\,$ 共线。这对应于原子 $\\,j, k, l\\,$ 位于同一直线上。\n\n当原子 $\\,i,j,k\\,$ 共线时，$\\,\\mathbf{u} = \\mathbf{0}\\,$。这导致 $\\,\\alpha = \\mathbf{u}\\cdot\\mathbf{v} = 0\\,$。此外，$\\,\\beta = \\|\\mathbf{b}_2\\|(\\mathbf{b}_1\\cdot\\mathbf{v}) = \\|\\mathbf{b}_2\\|(\\mathbf{b}_1\\cdot(\\mathbf{b}_2\\times\\mathbf{b}_3)) = \\|\\mathbf{b}_2\\|((\\mathbf{b}_1\\times\\mathbf{b}_2)\\cdot\\mathbf{b}_3) = \\|\\mathbf{b}_2\\|(\\mathbf{u}\\cdot\\mathbf{b}_3)=0\\,$。\n在这种情况下，原始微分表达式的分母 $\\,\\alpha^2+\\beta^2\\,$ 变为 $\\,0\\,$。这表明存在一个奇点，此时二面角本身没有明确定义，因此其导数也未定义。\n同样的逻辑适用于原子 $\\,j,k,l\\,$ 共线的情况，这会使 $\\,\\mathbf{v}=\\mathbf{0}\\,$，因此 $\\,\\alpha=0\\,$ 且 $\\,\\beta=0\\,$。\n因此，只要序列 $\\,(i,j,k,l)\\,$ 中任意三个连续的原子变为共线，二面角的解析导数就是奇异的。\n\n**任务3：针对特定几何构型的计算**\n\n给定笛卡尔坐标：$\\,\\mathbf{r}_i = (0,0,0)\\,$，$\\,\\mathbf{r}_j=(1,0,0)\\,$，$\\,\\mathbf{r}_k=(1,1,0)\\,$，以及 $\\,\\mathbf{r}_l=(1,1,1)\\,$。我们需要计算偏导数 $\\,\\partial \\phi / \\partial z_i\\,$。这是梯度矢量 $\\,\\frac{\\partial \\phi}{\\partial \\mathbf{r}_i}\\,$ 的 $\\,z\\,$ 分量。\n\n首先，我们计算该几何构型所需的矢量：\n1. 键矢量：\n$$\n\\mathbf{b}_1 = \\mathbf{r}_j - \\mathbf{r}_i = (1,0,0) - (0,0,0) = (1,0,0)\n$$\n$$\n\\mathbf{b}_2 = \\mathbf{r}_k - \\mathbf{r}_j = (1,1,0) - (1,0,0) = (0,1,0)\n$$\n2. $\\,\\mathbf{b}_2\\,$ 的模：\n$$\n\\|\\mathbf{b}_2\\| = \\sqrt{0^2 + 1^2 + 0^2} = 1\n$$\n3. 法向量 $\\,\\mathbf{u}\\,$：\n$$\n\\mathbf{u} = \\mathbf{b}_1 \\times \\mathbf{b}_2 = (1,0,0) \\times (0,1,0) = \\begin{vmatrix} \\mathbf{i} & \\mathbf{j} & \\mathbf{k} \\\\ 1 & 0 & 0 \\\\ 0 & 1 & 0 \\end{vmatrix} = (0,0,1)\n$$\n4. $\\,\\mathbf{u}\\,$ 的模的平方：\n$$\n\\|\\mathbf{u}\\|^2 = 0^2 + 0^2 + 1^2 = 1\n$$\n相对于原子 $\\,i\\,$ 坐标的梯度由任务1中推导的公式给出：\n$$\n\\frac{\\partial \\phi}{\\partial \\mathbf{r}_i} = -\\frac{\\|\\mathbf{b}_2\\|}{\\|\\mathbf{u}\\|^2}\\mathbf{u}\n$$\n代入计算出的值：\n$$\n\\frac{\\partial \\phi}{\\partial \\mathbf{r}_i} = -\\frac{1}{1}(0,0,1) = (0,0,-1)\n$$\n该梯度矢量的分量是相对于原子 $\\,i\\,$ 的笛卡尔坐标的偏导数：\n$$\n\\frac{\\partial \\phi}{\\partial \\mathbf{r}_i} = \\left(\\frac{\\partial \\phi}{\\partial x_i}, \\frac{\\partial \\phi}{\\partial y_i}, \\frac{\\partial \\phi}{\\partial z_i}\\right)\n$$\n因此，所求的特定偏导数是该矢量的 $\\,z\\,$ 分量：\n$$\n\\frac{\\partial \\phi}{\\partial z_i} = -1\n$$\n坐标单位为埃，因此导数的单位为弧度/埃。", "answer": "$$\\boxed{-1}$$", "id": "2874054"}, {"introduction": "为了完全实现解析梯度，我们必须深入了解其最基本的构成部分：分子积分。电子排斥积分 (ERI) 对原子核位置的导数是必不可少的，其计算涉及到特殊数学函数的导数。本练习聚焦于在高斯基组中计算 ERI 的核心——Boys 函数 $F_n(T)$，要求你为其导数推导出一个关键的递推关系，并分析其计算的数值稳定性。[@problem_id:2874088]", "problem": "考虑指数分别为 $\\alpha$ 和 $\\beta$ 的基元高斯型轨道，它们分别以位于 $\\mathbf{A}$ 和 $\\mathbf{B}$ 的原子核为中心。根据高斯乘积定理，以 $\\mathbf{A}$ 和 $\\mathbf{B}$ 为中心的两个高斯函数的乘积可以写成一个以复合中心 $\\mathbf{P}$ 为中心、指数为 $\\zeta = \\alpha + \\beta$ 的高斯函数，再乘以一个取决于 $\\mathbf{A}$ 和 $\\mathbf{B}$ 的高斯前因子。在推导高斯函数上的电子排斥积分（ERI）的解析表达式的标准过程中，会遇到定义 Boys 函数的一维径向积分，其形式如下：\n$$\nF_{n}(T) \\equiv \\int_{0}^{1} t^{2n} \\exp\\!\\big(-T t^{2}\\big)\\,\\mathrm{d}t,\n$$\n其中 $n \\in \\mathbb{N}_{0}$，$T \\ge 0$ 是一个标量，它取决于高斯指数和核间距，例如 $T = \\rho\\,|\\mathbf{P}-\\mathbf{Q}|^{2}$，其中 $\\rho = \\frac{\\alpha \\beta}{\\alpha + \\beta}$，而 $\\mathbf{P}, \\mathbf{Q}$ 分别是通过对电子1和电子2的坐标应用高斯乘积定理得到的复合中心。\n\n在解析能量梯度和 Hessian 矩阵中，会出现 ERI 对原子核笛卡尔坐标的导数。通过链式法则，对 ERI 求导会引入 $F_{n}(T)$ 对 $T$ 的导数，再乘以 $T$ 对原子核坐标的导数。从上面 $F_{n}(T)$ 的基本定义和高斯积分的标准性质出发，完成以下任务：\n\n- 解释为什么 ERI 对原子核坐标的导数必然包含因子 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 乘以 $T$ 的导数。\n- 严格从 $F_{n}(T)$ 的定义积分出发，推导一个用 Boys 函数表示的 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 的闭式表达式。\n- 在小 $T$（即 $T \\to 0$）和大 $T$（即 $T \\to \\infty$）的区间，分析用于 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 的直接微分恒等式的数值稳定性，并指出任何可能的有效数字损失。\n- 为 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 构建一个稳定的计算方案，该方案在小 $T$ 时能避免灾难性抵消，在大 $T$ 时能保持精度。你的方案应仅依赖于从积分定义推导出的、经过充分检验的展开式和递推关系，即：\n  - 小 $T$ 情况下的 $F_{n}(T)$ 的麦克劳林级数，\n  - 大 $T$ 情况下的 $F_{n}(T)$ 的渐近形式，\n  - 以及连接 $F_{n+1}(T)$ 和 $F_{n}(T)$ 的一个方向性稳定的三项递推关系。\n解释递推的哪个方向是稳定的及其原因，以及如何结合初始化和递推来覆盖所有 $T$ 的情况。\n\n作为最终答案，请提供你推导出的用 Boys 函数表示的 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 的单一闭式解析表达式。无需进行数值计算，也无需单位，因为 $F_{n}(T)$ 是无量纲的。将你的最终答案表示为单一的解析表达式。", "solution": "所提出的问题是量子化学中分子积分解析理论的一个标准、定义明确的练习。它具有科学依据，是客观的，并包含足够的信息以进行严谨的分析。我们将按要求进行推导和讨论。\n\n首先，我们解决为什么电子排斥积分（ERI）对原子核坐标的导数必须涉及 Boys 函数 $F_n(T)$ 的导数。四个高斯基函数上的一个 ERI 可写作 $(\\mu\\nu|\\lambda\\sigma)$。根据高斯乘积定理，两个高斯函数（例如 $\\phi_{\\mu}$ 和 $\\phi_{\\nu}$）的乘积可以表示为一个以新点 $\\mathbf{P}$ 为中心的单一高斯函数。ERI 随之简化为在以 $\\mathbf{P}$ 和 $\\mathbf{Q}$ 为中心的两个新电荷分布上的双电子积分。这个积分最终表示为一系列项的有限和，其中每一项都是一些常数和一个 Boys 函数 $F_n(T)$ 的乘积。其自变量 $T$ 由 $T = \\rho |\\mathbf{P}-\\mathbf{Q}|^2$ 给出，其中 $\\rho$ 是高斯指数的函数，而中心 $\\mathbf{P}$ 和 $\\mathbf{Q}$ 是原始原子核坐标 $\\{\\mathbf{R}_A\\}$ 的函数。\n因此，任何 ERI 都可以通过其对自变量 $T_k$ 的依赖关系，概括地写成原子核坐标 $\\mathbf{R}_A$ 的函数：\n$$\n\\text{ERI}(\\{\\mathbf{R}_A\\}) = \\sum_k C_k F_{n_k}(T_k(\\{\\mathbf{R}_A\\}))\n$$\n其中 $C_k$ 是同样依赖于原子核坐标的系数。当对原子核位置的某个笛卡尔分量（比如 $R_{A,x}$）求导时，必须应用链式法则：\n$$\n\\frac{\\partial (\\text{ERI})}{\\partial R_{A,x}} = \\sum_k \\left( \\frac{\\partial C_k}{\\partial R_{A,x}} F_{n_k}(T_k) + C_k \\frac{\\mathrm{d}F_{n_k}}{\\mathrm{d}T_k} \\frac{\\partial T_k}{\\partial R_{A,x}} \\right)\n$$\n中心 $\\mathbf{P}$ 和 $\\mathbf{Q}$ 是原子核坐标的加权平均，因此它们的位置，以及它们之间的距离 $|\\mathbf{P}-\\mathbf{Q}|$，都依赖于 $\\{\\mathbf{R}_A\\}$。因此，$\\frac{\\partial T_k}{\\partial R_{A,x}}$ 项通常不为零。这使得导数 $\\frac{\\mathrm{d}F_{n_k}}{\\mathrm{d}T_k}$ 的出现成为解析梯度理论的必然结果。\n\n接下来，我们推导 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 的闭式表达式。我们从 Boys 函数的积分定义开始：\n$$\nF_{n}(T) = \\int_{0}^{1} t^{2n} \\exp(-T t^{2})\\,\\mathrm{d}t\n$$\n被积函数及其对 $T$ 的偏导数在积分域上以及对于 $T \\ge 0$ 都是 $t$ 和 $T$ 的连续函数。因此，我们可以在积分号下进行微分（莱布尼茨积分法则）：\n$$\n\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T} = \\frac{\\mathrm{d}}{\\mathrm{d}T} \\int_{0}^{1} t^{2n} \\exp(-T t^{2})\\,\\mathrm{d}t = \\int_{0}^{1} \\frac{\\partial}{\\partial T} \\left( t^{2n} \\exp(-T t^{2}) \\right) \\,\\mathrm{d}t\n$$\n被积函数的偏导数是：\n$$\n\\frac{\\partial}{\\partial T} \\left( t^{2n} \\exp(-T t^{2}) \\right) = t^{2n} \\left( -t^2 \\exp(-T t^{2}) \\right) = -t^{2n+2} \\exp(-T t^{2})\n$$\n将此代回积分中，得到：\n$$\n\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T} = \\int_{0}^{1} (-1) t^{2(n+1)} \\exp(-T t^{2}) \\,\\mathrm{d}t = - \\int_{0}^{1} t^{2(n+1)} \\exp(-T t^{2}) \\,\\mathrm{d}t\n$$\n经观察，所得积分即为 $F_{n+1}(T)$ 的定义。因此，我们得到了这个紧凑而基本的关系式：\n$$\n\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T} = -F_{n+1}(T)\n$$\n\n现在我们分析使用此恒等式的数值稳定性。该恒等式本身是精确的。任何数值不稳定性都源于用于计算 $F_{n+1}(T)$ 的方法。一个常见但有缺陷的方法是使用 Boys 函数的向上递推关系，该关系可通过分部积分法推导得出：\n$$\nF_{n+1}(T) = \\frac{(2n+1)F_n(T) - \\exp(-T)}{2T}\n$$\n如果已知一个精确的 $F_n(T)$ 值，并使用此公式计算 $F_{n+1}(T)$，可能会发生严重的有效数字损失，尤其是在 $T$ 值较大时。在这个区间，$\\exp(-T)$ 极小，$F_n(T)$ 也变得很小。分子涉及两个数字 $(2n+1)F_n(T)$ 和 $\\exp(-T)$ 的相减，它们的数量级可能相似，从而导致灾难性抵消。随后的除以 $2T$ 会进一步传播任何误差。因此，向上递推在数值上是不稳定的，在计算 Boys 函数序列时必须避免使用。“直接微分恒等式”只有在与不稳定的 $F_{n+1}(T)$ 计算方法结合使用时才不稳定。\n\n最后，我们为 $\\frac{\\mathrm{d}F_{n}}{\\mathrm{d}T}$ 构建一个稳定的计算方案，这等同于为计算 $F_{n+1}(T)$ 构建一个稳定的方案。该策略根据 $T$ 的值进行划分。\n\n对于小 $T$：\n$F_n(T)$ 的麦克劳林级数展开式是通过在其定义积分中展开指数项得到的：\n$$\nF_n(T) = \\int_{0}^{1} t^{2n} \\sum_{k=0}^{\\infty} \\frac{(-Tt^2)^k}{k!} \\,\\mathrm{d}t = \\sum_{k=0}^{\\infty} \\frac{(-T)^k}{k!} \\int_{0}^{1} t^{2n+2k} \\,\\mathrm{d}t = \\sum_{k=0}^{\\infty} \\frac{(-T)^k}{k! (2n+2k+1)}\n$$\n对于小 $T$，这是一个项快速递减的交错级数，它在数值上是稳定的，并且收敛迅速。要计算 $\\frac{\\mathrm{d}F_n}{\\mathrm{d}T} = -F_{n+1}(T)$，只需使用 $F_{n+1}(T)$ 自身的麦克劳林级数来计算它：\n$$\nF_{n+1}(T) = \\sum_{k=0}^{\\infty} \\frac{(-T)^k}{k! (2n+2k+3)}\n$$\n对于低于某个阈值（例如 $T < 10$）的 $T$，此方法是稳健的。\n\n对于大 $T$：\n级数展开变得不适用。相反，我们使用向下递推关系，这是稳定的方向。通过重新整理先前展示的递推关系，我们得到：\n$$\nF_{n}(T) = \\frac{2T F_{n+1}(T) + \\exp(-T)}{2n+1}\n$$\n对于递减的 $n$，该关系是稳定的，因为除以因子 $2n+1$ 会抑制任何传播的误差。为了计算一组 Boys 函数 $\\{ F_k(T) \\}_{k=0}^{N_{max}}$，需要从一个足够大以至于 $F_M(T)$ 可以被精确近似的索引 $M > N_{max}$ 开始。对于大 $T$ 的渐近形式是 $F_M(T) \\sim \\frac{(2M-1)!!\\sqrt{\\pi}}{2^{M+1}} T^{-M-1/2}$。对于足够大的 $M$，可以简单地将 $F_M(T) = 0$ 设为起始猜测值。\n稳定的计算过程如下：\n1. 选择一个远高于所需最大索引 $n+1$ 的起始索引 $M$。一个典型的选择是 $M \\approx n_{max} + T$。\n2. 以 $F_M(T) = 0$ 初始化。\n3. 使用关系式 $F_{k-1}(T) = \\frac{2TF_k(T) + \\exp(-T)}{2k-1}$ 从 $k=M$ 向下递推到 $k=1$，以生成一个未归一化的序列 $\\{F'_{k}(T)\\}$。\n4. 精确计算 $F_0(T)$ 的值。对于非零 $T$，该值由 $F_0(T) = \\frac{\\sqrt{\\pi}}{2\\sqrt{T}}\\text{erf}(\\sqrt{T})$ 给出，其本身可以使用稳定方法（如大 $T$ 时的连分式展开）来计算。\n5. 从向下递推得到的未归一化值 $F'_0(T)$ 与真实值 $F_0(T)$ 成正比。归一化常数为 $C = F'_0(T) / F_0(T)$。\n6. 重新缩放整个序列：对于所有需要的 $k$（包括 $k=n+1$），$F_k(T) = F'_k(T) / C$。\n7. 所需的导数则由 $-F_{n+1}(T)$ 给出，该值通过此稳定过程计算得出。\n\n这种混合方案，结合了小 $T$ 的麦克劳林级数和 大 $T$ 的归一化向下递推，为在整个定义域 $T \\ge 0$ 上计算 Boys 函数及其对 $T$ 的导数提供了一种数值上稳健的方法。", "answer": "$$\n\\boxed{-F_{n+1}(T)}\n$$", "id": "2874088"}]}