{"hands_on_practices": [{"introduction": "本练习是掌握穆里肯（Mulliken）布居分析计算机制的基础。通过一个具体的三维基组实例，我们将从第一性原理出发，推导并应用穆里肯布居的计算公式。这个实践旨在巩固您对密度矩阵 $D$、重叠矩阵 $S$ 与原子总布居数 $G_A$ 之间关系的理解，是进行更深入探讨的前提。[@problem_id:2906541]", "problem": "一个分子体系在由$3$个实的、线性无关的、非正交的原子轨道(AO)基函数构成的基组中进行描述。设在此AO基组中，单粒子自旋求和密度矩阵 (1PDM) 为$D$，重叠矩阵为$S$：\n$$ D=\\begin{pmatrix}1.8 & 0.3 & 0\\\\ 0.3 & 1.2 & 0.1\\\\ 0 & 0.1 & 0.0\\end{pmatrix}, \\quad S=\\begin{pmatrix}1 & 0.2 & 0\\\\ 0.2 & 1 & 0.1\\\\ 0 & 0.1 & 1\\end{pmatrix} $$\n基函数 $\\{1,2\\}$ 以原子 $A$ 为中心，基函数 $\\{3\\}$ 以原子 $B$ 为中心。核电荷分别为 $Z_A=3$ 和 $Z_B=1$。\n\n从Mulliken布居分析的第一性原理定义出发，即根据AO对的重叠加权贡献来划分非正交AO基组中的总电子数，推导Mulliken原子总布居 $G_A$ 和 $G_B$ 关于 $D$ 和 $S$ 的表达式。利用给定的 $D$ 和 $S$ 计算 $G_A$ 和 $G_B$ 的值。然后根据核电荷和总布居计算相应的Mulliken原子净电荷 $q_A$ 和 $q_B$。\n\n按 $G_A$、$G_B$、$q_A$、$q_B$ 的顺序报告这四个数值。将最终报告的数值四舍五入至四位有效数字。无需单位。", "solution": "该问题陈述科学严谨、表述清晰且客观。所有必要数据均已提供，不存在内部矛盾或逻辑缺陷。在量子化学计算的背景下，所描述的体系是物理上合理的。因此，该问题被视为有效，并将提供解答。\n\n本题的任务是为给定的分子体系推导并计算Mulliken原子总布居和原子净电荷。\n\n首先，我们必须推导Mulliken原子总布居的表达式。在一个由一组实的、非正交的原子轨道 $\\{\\chi_\\mu\\}$ 描述的分子体系中，总电子数 $N_e$ 由电子概率密度 $\\rho(\\mathbf{r})$ 的空间积分给出。密度本身由单粒子密度矩阵 (1PDM) $D$ 和基函数构成：\n$$ \\rho(\\mathbf{r}) = \\sum_{\\mu, \\nu} D_{\\mu\\nu} \\chi_\\mu(\\mathbf{r}) \\chi_\\nu(\\mathbf{r}) $$\n因此，总电子数为：\n$$ N_e = \\int \\rho(\\mathbf{r}) d\\mathbf{r} = \\int \\sum_{\\mu, \\nu} D_{\\mu\\nu} \\chi_\\mu(\\mathbf{r}) \\chi_\\nu(\\mathbf{r}) d\\mathbf{r} = \\sum_{\\mu, \\nu} D_{\\mu\\nu} \\int \\chi_\\mu(\\mathbf{r}) \\chi_\\nu(\\mathbf{r}) d\\mathbf{r} $$\n其中的积分项是重叠矩阵元 $S_{\\mu\\nu} = \\int \\chi_\\mu(\\mathbf{r}) \\chi_\\nu(\\mathbf{r}) d\\mathbf{r}$ 的定义。这导出了总电子数的基本表达式：\n$$ N_e = \\sum_{\\mu, \\nu} D_{\\mu\\nu} S_{\\mu\\nu} $$\nMulliken布居分析提供了一种将此总电子数分配到各个原子上的方法。该求和由对角项 ($\\mu = \\nu$) 和非对角项 ($\\mu \\neq \\nu$) 组成。一个对角项 $D_{\\mu\\mu}S_{\\mu\\mu}$ 代表了纯粹与轨道 $\\chi_\\mu$ 相关的布居。一个非对角项 $D_{\\mu\\nu}S_{\\mu\\nu}$ 是轨道 $\\chi_\\mu$ 和 $\\chi_\\nu$ 之间的重叠布居。Mulliken方案将一对轨道间的总重叠布居 $(D_{\\mu\\nu}S_{\\mu\\nu} + D_{\\nu\\mu}S_{\\nu\\mu})$ 在两个参与轨道之间平均分配。\n\n单个原子轨道 $\\mu$ 的总布居，记为 $N_\\mu$，定义为其对角布居加上其所有相关重叠布居的一半：\n$$ N_\\mu = D_{\\mu\\mu}S_{\\mu\\mu} + \\frac{1}{2} \\sum_{\\nu \\neq \\mu} (D_{\\mu\\nu}S_{\\mu\\nu} + D_{\\nu\\mu}S_{\\nu\\mu}) $$\n对于给定的具有实基函数的体系，密度矩阵 $D$ 和重叠矩阵 $S$ 都是对称的，即 $D_{\\mu\\nu} = D_{\\nu\\mu}$ 和 $S_{\\mu\\nu} = S_{\\nu\\mu}$。$N_\\mu$ 的表达式可大大简化：\n$$ N_\\mu = D_{\\mu\\mu}S_{\\mu\\mu} + \\frac{1}{2} \\sum_{\\nu \\neq \\mu} (2 D_{\\mu\\nu}S_{\\mu\\nu}) = D_{\\mu\\mu}S_{\\mu\\mu} + \\sum_{\\nu \\neq \\mu} D_{\\mu\\nu}S_{\\mu\\nu} $$\n这可以紧凑地写成对所有轨道 $\\nu$ 的单个求和：\n$$ N_\\mu = \\sum_{\\nu=1}^{n} D_{\\mu\\nu}S_{\\mu\\nu} $$\n其中 $n=3$ 是基函数的总数。因为重叠矩阵 $S$ 是对称的 ($S_{\\mu\\nu} = S_{\\nu\\mu}$)，这等价于：\n$$ N_\\mu = \\sum_{\\nu=1}^{n} D_{\\mu\\nu}S_{\\nu\\mu} $$\n这个最终表达式恰好是矩阵乘积 $DS$ 的对角元 $(\\mu, \\mu)$ 的定义。因此，轨道 $\\mu$ 的总布居可以优雅地表示为：\n$$ N_\\mu = (DS)_{\\mu\\mu} $$\n原子 $A$ 的Mulliken原子总布居，记为 $G_A$，是所有以该原子为中心的基函数 $\\{\\chi_\\mu\\}$ 的轨道总布居之和：\n$$ G_A = \\sum_{\\mu \\in A} N_\\mu = \\sum_{\\mu \\in A} (DS)_{\\mu\\mu} $$\n类似地，对于原子 $B$：\n$$ G_B = \\sum_{\\mu \\in B} (DS)_{\\mu\\mu} $$\n原子 $A$ 上的Mulliken原子净电荷 $q_A$ 是其核电荷 $Z_A$ 与其原子总布居 $G_A$ 之差：\n$$ q_A = Z_A - G_A $$\n\n现在，我们将这些推导出的公式应用于给定的问题。\n密度矩阵 $D$ 和重叠矩阵 $S$ 分别为：\n$$ D = \\begin{pmatrix} 1.8 & 0.3 & 0 \\\\ 0.3 & 1.2 & 0.1 \\\\ 0 & 0.1 & 0.0 \\end{pmatrix}, \\quad S = \\begin{pmatrix} 1 & 0.2 & 0 \\\\ 0.2 & 1 & 0.1 \\\\ 0 & 0.1 & 1 \\end{pmatrix} $$\n我们首先计算矩阵乘积 $DS$：\n$$ DS = \\begin{pmatrix} 1.8 & 0.3 & 0 \\\\ 0.3 & 1.2 & 0.1 \\\\ 0 & 0.1 & 0.0 \\end{pmatrix} \\begin{pmatrix} 1 & 0.2 & 0 \\\\ 0.2 & 1 & 0.1 \\\\ 0 & 0.1 & 1 \\end{pmatrix} $$\n$$ DS = \\begin{pmatrix} (1.8)(1)+(0.3)(0.2)+(0)(0) & (1.8)(0.2)+(0.3)(1)+(0)(0.1) & (1.8)(0)+(0.3)(0.1)+(0)(1) \\\\ (0.3)(1)+(1.2)(0.2)+(0.1)(0) & (0.3)(0.2)+(1.2)(1)+(0.1)(0.1) & (0.3)(0)+(1.2)(0.1)+(0.1)(1) \\\\ (0)(1)+(0.1)(0.2)+(0.0)(0) & (0)(0.2)+(0.1)(1)+(0.0)(0.1) & (0)(0)+(0.1)(0.1)+(0.0)(1) \\end{pmatrix} $$\n$$ DS = \\begin{pmatrix} 1.8+0.06 & 0.36+0.3 & 0.03 \\\\ 0.3+0.24 & 0.06+1.2+0.01 & 0.12+0.1 \\\\ 0.02 & 0.1 & 0.01 \\end{pmatrix} = \\begin{pmatrix} 1.86 & 0.66 & 0.03 \\\\ 0.54 & 1.27 & 0.22 \\\\ 0.02 & 0.1 & 0.01 \\end{pmatrix} $$\n基函数 $\\{1, 2\\}$ 属于原子 $A$，基函数 $\\{3\\}$ 属于原子 $B$。我们计算原子总布居：\n$$ G_A = (DS)_{11} + (DS)_{22} = 1.86 + 1.27 = 3.13 $$\n$$ G_B = (DS)_{33} = 0.01 $$\n总电子数为 $N_e = G_A + G_B = 3.13 + 0.01 = 3.14$，这与 $\\text{Tr}(DS) = 1.86 + 1.27 + 0.01 = 3.14$ 相一致。\n\n接下来，我们使用给定的核电荷 $Z_A=3$ 和 $Z_B=1$ 计算原子净电荷：\n$$ q_A = Z_A - G_A = 3 - 3.13 = -0.13 $$\n$$ q_B = Z_B - G_B = 1 - 0.01 = 0.99 $$\n作为检验，净电荷之和为 $q_A + q_B = -0.13 + 0.99 = 0.86$。总核电荷为 $Z_A + Z_B = 3 + 1 = 4$。分子的总电荷为 $Z_{total} - N_e = 4 - 3.14 = 0.86$，这证实了计算的一致性。\n\n最后，我们将所需的四个值 ($G_A, G_B, q_A, q_B$) 四舍五入至四位有效数字。\n$G_A = 3.13 \\rightarrow 3.130$\n$G_B = 0.01 \\rightarrow 0.01000$\n$q_A = -0.13 \\rightarrow -0.1300$\n$q_B = 0.99 \\rightarrow 0.9900$\n\n结果按所要求的顺序报告。", "answer": "$$\n\\boxed{\\begin{pmatrix} 3.130 & 0.01000 & -0.1300 & 0.9900 \\end{pmatrix}}\n$$", "id": "2906541"}, {"introduction": "在掌握了基本计算之后，我们来探讨穆里肯（Mulliken）分析法一个著名的固有缺陷。本练习设计了一个特殊场景，其中穆里肯分析会得出非物理的“负布居数”结果。通过构建这个例子，您将深入理解这种反直觉现象的代数根源，并认识到布居分析方案作为一种定义而非物理可观测量所具有的局限性。[@problem_id:2906519]", "problem": "在一个最小双函数基组中，考虑一个理想化的双原子碎片，其原子 $A$ 上有一个原子轨道 (AO) $\\chi_{A}$，原子 $B$ 上有一个AO $\\chi_{B}$。在AO基下的重叠矩阵为\n$$\nS \\;=\\; \\begin{pmatrix}\n1 & 0.4\\\\\n0.4 & 1\n\\end{pmatrix}.\n$$\n假设一个单自旋电子占据一个分子轨道 (MO)，该MO在两个中心上的AO系数向量具有相反的相位，\n$$\n\\mathbf{c} \\;=\\; \\begin{pmatrix} a \\\\ -\\,b \\end{pmatrix},\n$$\n其中 $b/a = 0.2$ 且 $\\mathbf{c}^{\\top} S \\,\\mathbf{c} = 1$。设单粒子密度矩阵为秩一投影算符 $D = \\mathbf{c}\\mathbf{c}^{\\top}$ (单占据)。原子 $A$ 的核电荷为 $Z_{A} = 1$。\n\n从非正交AO基中Mulliken布居分析的定义出发，推导原子 $A$ 上的Mulliken总原子布居 $N_{A}^{\\mathrm{M}}$ 关于 $S$ 和 $D$ 的表达式，利用上述给定的矩阵和参数对其进行求值，并求出原子 $A$ 上的Mulliken净原子电荷 $q_{A} = Z_{A} - N_{A}^{\\mathrm{M}}$。根据你推导的表达式的代数结构，简要解释本例中Mulliken布居出现负贡献的来源。以精确值（不进行四舍五入）表示 $q_{A}$ 的最终数值。", "solution": "此问题已经过验证，被认为是理论量子化学中一个提法恰当、有科学依据的问题。我们将给出规范解法。\n\n在一个由密度矩阵 $D$ 和重叠矩阵 $S$ 描述的非正交原子轨道 (AO) 基 $\\{\\chi_{\\mu}\\}$ 系统中，总电子数 $N$ 由密度矩阵和重叠矩阵乘积的迹给出：\n$$\nN = \\mathrm{Tr}(DS)\n$$\n其中 $S_{\\mu\\nu} = \\int \\chi_{\\mu}^*(\\mathbf{r})\\chi_{\\nu}(\\mathbf{r})d\\mathbf{r}$，密度为 $\\rho(\\mathbf{r}) = \\sum_{\\mu,\\nu} D_{\\mu\\nu} \\chi_{\\mu}(\\mathbf{r})\\chi_{\\nu}^*(\\mathbf{r})$。对于占据一个实分子轨道 (MO) $\\psi = \\sum_{\\mu} c_{\\mu}\\chi_{\\mu}$ 的单个电子，密度矩阵为 $D_{\\mu\\nu} = c_{\\mu}c_{\\nu}$。由于MO是归一化的，$\\mathbf{c}^{\\top}S\\mathbf{c} = 1$，总电子数确实为 $N = \\mathrm{Tr}(\\mathbf{c}\\mathbf{c}^{\\top}S) = \\mathrm{Tr}(\\mathbf{c}^{\\top}S\\mathbf{c}) = \\mathbf{c}^{\\top}S\\mathbf{c} = 1$。\n\nMulliken布居分析将总电子布居分配到各个原子上。给定原子 $K$ 上的布居数，记为 $N_K^{\\mathrm{M}}$，定义为归属于该原子上的AO的电子布居之和。在此方案中，任意两个AO $\\chi_{\\mu}$ 和 $\\chi_{\\nu}$ 之间的总重叠布居在相应的原子间被均等分配。这导出了原子 $K$ 上总原子布居的如下表达式：\n$$\nN_K^{\\mathrm{M}} = \\sum_{\\mu \\in K} \\sum_{\\nu} D_{\\mu\\nu}S_{\\nu\\mu}\n$$\n其中内部求和遍历基组中的所有AO，而外部求和仅限于以原子 $K$ 为中心的AO。项 $\\sum_{\\nu} D_{\\mu\\nu}S_{\\nu\\mu}$ 正是矩阵乘积 $DS$ 的第 $\\mu$ 个对角元。因此，原子 $K$ 上的Mulliken布居是 $DS$ 矩阵中对应于原子 $K$ 上AO的对角元之和：\n$$\nN_K^{\\mathrm{M}} = \\sum_{\\mu \\in K} (DS)_{\\mu\\mu}\n$$\n在给定问题中，原子 $A$ 与单个AO相关联，我们用索引 $1$ 标记它。因此，原子 $A$ 上的Mulliken总原子布居为：\n$$\nN_A^{\\mathrm{M}} = (DS)_{11}\n$$\n\n为了计算该表达式，我们必须首先确定MO向量 $\\mathbf{c} = \\begin{pmatrix} a \\\\ -b \\end{pmatrix}$ 的系数 $a$ 和 $b$。给定比率 $b/a = 0.2$，这意味着 $b = 0.2a$。第二个条件是MO的归一化，$\\mathbf{c}^{\\top}S\\mathbf{c} = 1$。\n$$\n\\mathbf{c}^{\\top}S\\mathbf{c} = \\begin{pmatrix} a & -b \\end{pmatrix} \\begin{pmatrix} 1 & 0.4 \\\\ 0.4 & 1 \\end{pmatrix} \\begin{pmatrix} a \\\\ -b \\end{pmatrix} = 1\n$$\n展开此矩阵乘积可得：\n$$\na^2 - 0.4ab - 0.4ab + b^2 = 1\n$$\n$$\na^2 - 0.8ab + b^2 = 1\n$$\n将 $b = 0.2a$ 代入此方程：\n$$\na^2 - 0.8a(0.2a) + (0.2a)^2 = 1\n$$\n$$\na^2 - 0.16a^2 + 0.04a^2 = 1\n$$\n$$\n0.88a^2 = 1 \\implies a^2 = \\frac{1}{0.88} = \\frac{100}{88} = \\frac{25}{22}\n$$\n我们选择 $a$ 的正根，所以 $a = \\sqrt{\\frac{25}{22}} = \\frac{5}{\\sqrt{22}}$。因此，$b = 0.2a = \\frac{1}{5} \\left( \\frac{5}{\\sqrt{22}} \\right) = \\frac{1}{\\sqrt{22}}$。\n因此，系数向量为：\n$$\n\\mathbf{c} = \\frac{1}{\\sqrt{22}} \\begin{pmatrix} 5 \\\\ -1 \\end{pmatrix}\n$$\n接下来，我们构建密度矩阵 $D = \\mathbf{c}\\mathbf{c}^{\\top}$：\n$$\nD = \\left( \\frac{1}{\\sqrt{22}} \\begin{pmatrix} 5 \\\\ -1 \\end{pmatrix} \\right) \\left( \\frac{1}{\\sqrt{22}} \\begin{pmatrix} 5 & -1 \\end{pmatrix} \\right) = \\frac{1}{22} \\begin{pmatrix} 25 & -5 \\\\ -5 & 1 \\end{pmatrix}\n$$\n现在，我们计算乘积矩阵 $DS$：\n$$\nDS = \\frac{1}{22} \\begin{pmatrix} 25 & -5 \\\\ -5 & 1 \\end{pmatrix} \\begin{pmatrix} 1 & 0.4 \\\\ 0.4 & 1 \\end{pmatrix}\n$$\n$$\nDS = \\frac{1}{22} \\begin{pmatrix} (25)(1)+(-5)(0.4) & (25)(0.4)+(-5)(1) \\\\ (-5)(1)+(1)(0.4) & (-5)(0.4)+(1)(1) \\end{pmatrix}\n$$\n$$\nDS = \\frac{1}{22} \\begin{pmatrix} 25 - 2 & 10 - 5 \\\\ -5 + 0.4 & -2 + 1 \\end{pmatrix} = \\frac{1}{22} \\begin{pmatrix} 23 & 5 \\\\ -4.6 & -1 \\end{pmatrix}\n$$\n原子 $A$ 上的Mulliken总原子布居是该矩阵的第一个对角元：\n$$\nN_A^{\\mathrm{M}} = (DS)_{11} = \\frac{23}{22}\n$$\n原子 $A$ 上的Mulliken净原子电荷 $q_A$ 定义为核电荷 $Z_A$ 减去总原子布居 $N_A^{\\mathrm{M}}$。给定 $Z_A = 1$：\n$$\nq_A = Z_A - N_A^{\\mathrm{M}} = 1 - \\frac{23}{22} = \\frac{22 - 23}{22} = -\\frac{1}{22}\n$$\n题目还要求解释Mulliken布居中负贡献的来源。从矩阵 $DS$ 中我们可以观察到，原子 $B$ 上的布居将是 $N_B^{\\mathrm{M}} = (DS)_{22} = -1/22$。这是一个非物理的负布居数，是Mulliken分析中一个众所周知的病态问题。这种行为的根源在于Mulliken划分方案的代数结构。\n\n原子 $B$（索引为 $2$）上的布居是 $N_B^{\\mathrm{M}} = (DS)_{22} = D_{21}S_{12} + D_{22}S_{22}$。我们来分析这两项：\n$1.$ “在位”贡献是 $D_{22}S_{22} = c_2^2 S_{22}$。由于 $S_{22}=1$ 且 $c_2^2 = (-b)^2 = b^2$ 必须为非负数，因此该项总是非负的。在此例中，其值为 $(\\frac{-1}{\\sqrt{22}})^2 (1) = \\frac{1}{22}$。\n$2.$ “重叠”贡献是 $D_{21}S_{12} = c_2 c_1 S_{12}$。该项的符号取决于 $c_1$、$c_2$ 和 $S_{12}$ 的符号。\n在我们的例子中，MO的系数相位相反（$a = \\frac{5}{\\sqrt{22}} > 0$ 和 $-b = \\frac{-1}{\\sqrt{22}} < 0$），这是反键轨道的特征。这使得非对角密度矩阵元 $D_{21} = c_2 c_1 = (\\frac{-1}{\\sqrt{22}})(\\frac{5}{\\sqrt{22}}) = -\\frac{5}{22}$ 为负值。重叠积分 $S_{12}=0.4$ 是正的。\n因此，对原子 $B$ 布居的重叠贡献是负的：$D_{21}S_{12} = (-\\frac{5}{22})(0.4) = -\\frac{2}{22}$。\n\n原子 $B$ 上的总布居是这两项贡献之和：\n$$\nN_B^{\\mathrm{M}} = \\frac{1}{22} + \\left(-\\frac{2}{22}\\right) = -\\frac{1}{22}\n$$\n因此，负贡献的代数根源在于公式 $N_K^{\\mathrm{M}} = \\sum_{\\mu \\in K}(DS)_{\\mu\\mu}$ 展开式中的项 $D_{\\mu\\nu}S_{\\nu\\mu}$。当密度矩阵和重叠矩阵的相应元素之积 $D_{\\mu\\nu}S_{\\nu\\mu}$ 为负时（如此处具有正AO重叠的反键轨道的情况），它会对布居产生负贡献。如果这个负的重叠贡献的绝对值大于正的在位贡献，该中心上的总原子布居就可能变为负值。这就是原子 $B$ 发生的情况。注意，同样的负项 $D_{12}S_{21} = -\\frac{2}{22}$ 也对原子 $A$ 上的布居有贡献，将其从“在位”值 $D_{11}S_{11} = \\frac{25}{22}$ 减少到最终值 $N_A^{\\mathrm{M}} = \\frac{23}{22}$。", "answer": "$$\n\\boxed{-\\frac{1}{22}}\n$$", "id": "2906519"}, {"introduction": "最后的这个实践练习将理论与计算实践相结合，是一个综合性的挑战。您需要设计一个包含穆里肯（Mulliken）和勒夫丁（Löwdin）两种布居分析方法的完整工作流程，并建立一套验证标准以确保其正确性。这个练习不仅要求您实现两种分析的核心算法（包括计算矩阵平方根 $S^{1/2}$），更重要的是，它将培养您在计算化学研究中进行严谨验证和对比分析的思维习惯。[@problem_id:2906487]", "problem": "你的任务是，在以原子为中心、通常非正交的原子轨道 (AO) 基组所表示的分子电子结构背景下，实现并验证一个布居分析工作流。其核心输入是 AO 基组中的重叠矩阵和单粒子密度矩阵。请从以下基本依据出发：重叠矩阵由 AO 内积定义，密度矩阵编码了 AO 基组中的电子占据情况，总电子数等于密度矩阵与重叠矩阵乘积的迹。仅使用这些基本事实，完全以线性代数的方式推导并实现以下操作。\n\n对于每个测试用例，你的程序必须：\n- 构建 AO 重叠矩阵 $S$ 和 AO 密度矩阵 $D$，二者均为 $N \\times N$ 大小，其中 $S$ 是对称正定矩阵，$D$ 是实对称矩阵。\n- 通过正交对角化及其谱上的泛函演算，构造 $S$ 唯一的对称正定平方根 $S^{1/2}$。\n- 在由 $S^{1/2}$ 得到的 Löwdin 正交 AO 基组中，构成 Löwdin 正交化密度矩阵 $D^{\\mathrm{L}}$。\n- 通过均等划分共享的 AO 重叠贡献，并对属于每个原子的 AO 指数进行聚合，计算 Mulliken 原子总电子布居数；然后通过从给定的核电荷中减去电子布居数来计算 Mulliken 原子电荷。\n- 在 Löwdin 正交 AO 基组中计算 Löwdin 原子总电子布居数，并通过从给定的核电荷中减去这些布居数来计算相应的 Löwdin 原子电荷。\n\n用于验证实现的验证标准如下（需在给定的绝对容差 $\\tau$ 内进行检查）：\n- 电子数守恒：Mulliken 原子布居数之和等于由 $\\mathrm{tr}(D S)$ 给出的总电子数，Löwdin 原子布居数之和也等于该总电子数；此外，$\\mathrm{tr}(D^{\\mathrm{L}})$ 也必须等于该总电子数。\n- 非负性：所有 Mulliken 和 Löwdin 原子布居数必须在容差范围内 $\\geq 0$。\n- 正交性一致性：当 $S$ 为单位矩阵时，每个原子的 Mulliken 和 Löwdin 原子布居数必须在容差范围内匹配。\n- 对称性一致性：对于一个对称双原子分子，其两个原子具有相等的核电荷，且其对称的 2x2 重叠矩阵具有相等的对角元素和相等的非对角元素，则两个原子间的 Mulliken 原子布居数必须在容差范围内相等，Löwdin 原子布居数也必须在容差范围内相等。\n\n使用以下测试套件。每个测试用例提供：\n- 重叠矩阵 $S$。\n- 密度矩阵 $D$。\n- AO 指数到原子的划分，其形式为每个原子的零基 AO 指数列表的列表。\n- 每个原子的核电荷 $Z$ 列表，顺序相同。\n- 用于验证的容差 $\\tau$（所有测试使用相同的 $\\tau$）。\n\n测试用例 1 (理想情况，最小基组中的对称双原子分子)：\n- 维度 $N = 2$。\n- 重叠矩阵 $S = \\begin{bmatrix} 1 & 0.45 \\\\ 0.45 & 1 \\end{bmatrix}$。\n- 定义 $s = 0.45$，密度为 $D = \\dfrac{1}{1+s}\\begin{bmatrix} 1 & 1 \\\\ 1 & 1 \\end{bmatrix}$，对应于此基组中成键分子轨道的闭壳层占据。\n- AO 到原子的映射：$\\big[[0],[1]\\big]$ (每个原子上有一个 AO)。\n- 核电荷 $Z = [1, 1]$。\n- 预期适用的特殊验证：电子数守恒、非负性、对称性一致性。\n\n测试用例 2 (正交基组边界条件)：\n- 维度 $N = 3$。\n- 重叠矩阵 $S = I_{3}$ (3x3 单位矩阵)。\n- 密度矩阵 $D = \\mathrm{diag}(1, 1, 2)$。\n- AO 到原子的映射：$\\big[[0,1],[2]\\big]$ (第一个原子有两个 AO，第二个原子有一个 AO)。\n- 核电荷 $Z = [2, 2]$。\n- 预期适用的特殊验证：电子数守恒、非负性、正交性一致性。\n\n测试用例 3 (病态但正定的重叠矩阵)：\n- 维度 $N = 2$。\n- 重叠矩阵 $S = \\begin{bmatrix} 1 & 0.999 \\\\ 0.999 & 1 \\end{bmatrix}$。\n- 定义 $s = 0.999$，密度为 $D = \\dfrac{1}{1+s}\\begin{bmatrix} 1 & 1 \\\\ 1 & 1 \\end{bmatrix}$。\n- AO 到原子的映射：$\\big[[0],[1]\\big]$。\n- 核电荷 $Z = [1, 1]$。\n- 预期适用的特殊验证：电子数守恒、非负性，以及由于上述特定的对称性选择，对称性一致性。\n\n对所有检查，将绝对容差固定为 $\\tau = 10^{-8}$。对于每个测试用例，你的程序应评估所有适用的验证标准，并生成一个布尔值，以指示所有适用的检查是否都在容差范围内通过。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含三个测试用例的布尔结果，形式为用方括号括起来的逗号分隔列表，例如 $[{\\tt True},{\\tt False},{\\tt True}]$。\n- 除此单行外，不应打印任何其他文本或空白字符。\n- 此处所有角度（若有）均不相关。此任务不涉及物理单位。所有数值比较必须仅使用规定的绝对容差 $\\tau$。", "solution": "我们从适用于量子化学中 AO 表示的基本依据开始。重叠矩阵 $S$ 定义为 $S_{\\mu\\nu} = \\langle \\chi_{\\mu} \\mid \\chi_{\\nu} \\rangle$，其中 $\\chi_{\\mu}$ 是原子轨道 (AO) 基函数。AO 基组中的单粒子密度矩阵 $D$ 编码了电子占据情况，并且对于实 AO 基组中的实闭壳层体系，满足电子数恒等式\n$$\nN_{e} = \\mathrm{tr}(D S),\n$$\n此恒等式是通过将 $D$ 表示为 $D_{\\mu\\nu} = 2 \\sum_{i}^{\\mathrm{occ}} C_{\\mu i} C_{\\nu i}$ 推导得出的，其中 $C$ 是分子轨道 (MO) 系数。在正交归一的 MO 基组中使用 $C^{\\top} S C = I$，可得\n$$\n\\mathrm{tr}(D S) = 2 \\sum_{i}^{\\mathrm{occ}} \\mathrm{tr}\\big( C_{\\cdot i} C_{\\cdot i}^{\\top} S \\big) = 2 \\sum_{i}^{\\mathrm{occ}} \\langle \\phi_{i} \\mid \\phi_{i} \\rangle = 2 \\sum_{i}^{\\mathrm{occ}} 1,\n$$\n这与双占据轨道的总电子数相匹配。\n\nMulliken 布居分析将与重叠 $\\chi_{\\mu}\\chi_{\\nu}$ 相关的电子密度在 $\\mu$ 和 $\\nu$ 之间均等划分。根据这种均等划分，AO $\\mu$ 上的 AO 总布居数是 $D S$ 的对角元素：\n$$\np_{\\mu}^{\\mathrm{M}} = (D S)_{\\mu\\mu} = \\sum_{\\nu} D_{\\mu\\nu} S_{\\nu\\mu}.\n$$\n将属于原子 $A$ 的所有 AO $\\mu$ 上的 $p_{\\mu}^{\\mathrm{M}}$ 求和，得到 Mulliken 原子总布居数 $P_{A}^{\\mathrm{M}}$。于是，Mulliken 原子电荷为\n$$\nq_{A}^{\\mathrm{M}} = Z_{A} - P_{A}^{\\mathrm{M}},\n$$\n其中 $Z_{A}$ 是原子 $A$ 的核电荷。电子数守恒可由下式得出\n$$\n\\sum_{A} P_{A}^{\\mathrm{M}} = \\sum_{\\mu} p_{\\mu}^{\\mathrm{M}} = \\sum_{\\mu} (D S)_{\\mu\\mu} = \\mathrm{tr}(D S) = N_{e}.\n$$\n关于非负性，如果 $D$ 是半正定的且 $S$ 是正定的，那么在许多典型情况下，Mulliken AO 布居数 $p_{\\mu}^{\\mathrm{M}}$ 是非负的，尽管对于任意的 $D$ 和 $S$ 并不能普遍保证严格的非负性。在我们的测试套件中，所构造的 $D$ 和 $S$ 确保了非负性。\n\nLöwdin 布居分析通过对 AO 基组进行对称正交化来进行。将对称正定重叠矩阵 $S$ 对角化为\n$$\nS = U \\Lambda U^{\\top},\n$$\n其中 $U$ 是正交矩阵，$\\Lambda = \\mathrm{diag}(\\lambda_{1},\\ldots,\\lambda_{N})$ 且 $\\lambda_{i} > 0$。通过泛函演算定义唯一的对称正定平方根：\n$$\nS^{1/2} = U \\Lambda^{1/2} U^{\\top}, \\quad \\Lambda^{1/2} = \\mathrm{diag}(\\sqrt{\\lambda_{1}},\\ldots,\\sqrt{\\lambda_{N}})。\n$$\nLöwdin 正交化的 AO 基函数是 $\\tilde{\\chi} = S^{1/2} \\chi$，根据构造它们是正交归一的，因为\n$$\n\\langle \\tilde{\\chi} \\mid \\tilde{\\chi} \\rangle = (S^{1/2})^{\\top} S^{-1} (S^{1/2}) = I.\n$$\n在此正交归一的 AO 基组中，密度矩阵变换为\n$$\nD^{\\mathrm{L}} = S^{1/2} D S^{1/2}.\n$$\n在任何正交归一基组中，AO 总布居数等于密度矩阵的对角元，因此 Löwdin AO 布居数为 $p_{\\mu}^{\\mathrm{L}} = (D^{\\mathrm{L}})_{\\mu\\mu}$，而 Löwdin 原子总布居数为 $P_{A}^{\\mathrm{L}} = \\sum_{\\mu \\in A} p_{\\mu}^{\\mathrm{L}}$。Löwdin 原子电荷为\n$$\nq_{A}^{\\mathrm{L}} = Z_{A} - P_{A}^{\\mathrm{L}}.\n$$\n电子数守恒成立，因为\n$$\n\\sum_{\\mu} p_{\\mu}^{\\mathrm{L}} = \\mathrm{tr}(D^{\\mathrm{L}}) = \\mathrm{tr}(S^{1/2} D S^{1/2}) = \\mathrm{tr}(D S) = N_{e},\n$$\n我们在此处使用了迹的循环不变性。关于非负性，当 $D$ 是半正定时，$D^{\\mathrm{L}}$ 也是半正定的，因此 $p_{\\mu}^{\\mathrm{L}} \\ge 0$。\n\n正交性一致性：如果 $S = I$，则 $S^{1/2} = I$ 且 $D^{\\mathrm{L}} = D$，所以 Mulliken AO 布居数简化为 $(D S)_{\\mu\\mu} = D_{\\mu\\mu}$，而 Löwdin AO 布居数为 $(D^{\\mathrm{L}})_{\\mu\\mu} = D_{\\mu\\mu}$；因此，原子布居数相匹配。\n\n对称双原子分子中的对称性一致性：对于一个双 AO、双原子体系，其 $S = \\begin{bmatrix} 1 & s \\\\ s & 1 \\end{bmatrix}$，$s \\in (0,1)$，以及闭壳层成键密度\n$$\nD = \\frac{1}{1+s} \\begin{bmatrix} 1 & 1 \\\\ 1 & 1 \\end{bmatrix},\n$$\n我们有\n$$\nD S = \\frac{1}{1+s} \\begin{bmatrix} 1 & 1 \\\\ 1 & 1 \\end{bmatrix} \\begin{bmatrix} 1 & s \\\\ s & 1 \\end{bmatrix} = \\frac{1}{1+s} \\begin{bmatrix} 1+s & 1+s \\\\ 1+s & 1+s \\end{bmatrix},\n$$\n所以 Mulliken AO 布居数均为 1，当 $Z_{1} = Z_{2}$ 时，这会得到相等的原子布居数，从而得到相等的电荷。对于 Löwdin 分析，$S$ 的特征值为 $1+s$ 和 $1-s$，具有正交的特征向量，且 $S^{1/2}$ 是良定义的；由此得到的 $D^{\\mathrm{L}}$ 的对角线元素之和为 2，并且根据对称性，各元素贡献相等，这同样会产生相等的原子布居数和电荷。\n\n算法设计：\n- 通过对称特征分解 $S = U \\Lambda U^{\\top}$ 计算 $S^{1/2}$，并重构 $U \\Lambda^{1/2} U^{\\top}$。对于对称正定矩阵 $S$，该方法是数值稳定的。对于病态的 $S$，小的正特征值仍然是良定义的，使用容差将微小的负数值误差下舍入到零是合适的。\n- Mulliken 布居数：构成 $M = D S$ 并取其对角线作为 AO 布居数，然后按原子块求和。\n- Löwdin 布居数：构成 $D^{\\mathrm{L}} = S^{1/2} D S^{1/2}$，取其对角线作为 AO 布居数，然后按原子块求和。\n- 两种分析的电荷均计算为 $q_{A} = Z_{A} - P_{A}$。\n- 验证：\n  - 电子数守恒：检查 $\\left|\\sum_{A} P_{A}^{\\mathrm{M}} - \\mathrm{tr}(D S)\\right| \\le \\tau$，$\\left|\\sum_{A} P_{A}^{\\mathrm{L}} - \\mathrm{tr}(D S)\\right| \\le \\tau$ 和 $\\left| \\mathrm{tr}(D^{\\mathrm{L}}) - \\mathrm{tr}(D S) \\right| \\le \\tau$。\n  - 非负性：检查 $\\min_{A} P_{A}^{\\mathrm{M}} \\ge -\\tau$ 和 $\\min_{A} P_{A}^{\\mathrm{L}} \\ge -\\tau$。\n  - 正交性一致性（当 $S = I$ 时适用）：检查 $\\max_{A} |P_{A}^{\\mathrm{M}} - P_{A}^{\\mathrm{L}}| \\le \\tau$。\n  - 对称性一致性（适用于对称双原子分子和第三个对称情况）：检查 $|P_{1}^{\\mathrm{M}} - P_{2}^{\\mathrm{M}}| \\le \\tau$ 和 $|P_{1}^{\\mathrm{L}} - P_{2}^{\\mathrm{L}}| \\le \\tau$。\n\n测试套件详情：\n- 测试 1：$N = 2$，$S = \\begin{bmatrix} 1 & 0.45 \\\\ 0.45 & 1 \\end{bmatrix}$，$D = \\dfrac{1}{1+0.45} \\begin{bmatrix} 1 & 1 \\\\ 1 & 1 \\end{bmatrix}$，原子 $\\big[[0],[1]\\big]$，$Z = [1,1]$。适用检查：电子数守恒、非负性、对称性一致性。\n- 测试 2：$N = 3$，$S = I_{3}$，$D = \\mathrm{diag}(1,1,2)$，原子 $\\big[[0,1],[2]\\big]$，$Z = [2,2]$。适用检查：电子数守恒、非负性、正交性一致性。\n- 测试 3：$N = 2$，$S = \\begin{bmatrix} 1 & 0.999 \\\\ 0.999 & 1 \\end{bmatrix}$，$D = \\dfrac{1}{1+0.999} \\begin{bmatrix} 1 & 1 \\\\ 1 & 1 \\end{bmatrix}$，原子 $\\big[[0],[1]\\big]$，$Z = [1,1]$。适用检查：电子数守恒、非负性、对称性一致性。\n\n使用 $\\tau = 10^{-8}$，每个测试生成一个布尔值，说明所有适用的验证是否通过。程序将这三个布尔值聚合在单行中，作为 Python 列表字面量，例如 $[{\\tt True},{\\tt True},{\\tt True}]$。", "answer": "```python\nimport numpy as np\n\ndef symmetric_matrix_sqrt(S, tol=1e-14):\n    \"\"\"Compute the unique symmetric positive-definite square root S^{1/2} of S via eigendecomposition.\"\"\"\n    # Ensure symmetry\n    S = 0.5 * (S + S.T)\n    vals, vecs = np.linalg.eigh(S)\n    # Clean small negatives due to numerical roundoff\n    vals = np.where(vals < 0, np.where(np.abs(vals) < tol, 0.0, vals), vals)\n    if np.any(vals <= 0):\n        # For strict SPD assumption, tiny nonpositive eigenvalues indicate ill-conditioning.\n        # Floor them to a tiny positive number to keep S^{1/2} well-defined.\n        floor = tol\n        vals = np.maximum(vals, floor)\n    sqrt_vals = np.sqrt(vals)\n    S_half = (vecs * sqrt_vals) @ vecs.T\n    # Enforce symmetry\n    S_half = 0.5 * (S_half + S_half.T)\n    return S_half\n\ndef mulliken_atomic_populations(S, P, atom_blocks):\n    \"\"\"Compute Mulliken gross atomic populations: diag(P S) summed over AO blocks per atom.\"\"\"\n    M = P @ S\n    ao_pops = np.diag(M)\n    atom_pops = []\n    for block in atom_blocks:\n        atom_pops.append(float(np.sum(ao_pops[block])))\n    return np.array(atom_pops)\n\ndef lowdin_atomic_populations(S, P, atom_blocks):\n    \"\"\"Compute Löwdin gross atomic populations using P^L = S^{1/2} P S^{1/2}.\"\"\"\n    S_half = symmetric_matrix_sqrt(S)\n    P_L = S_half @ P @ S_half\n    P_L = 0.5 * (P_L + P_L.T)  # enforce symmetry\n    ao_pops = np.diag(P_L)\n    atom_pops = []\n    for block in atom_blocks:\n        atom_pops.append(float(np.sum(ao_pops[block])))\n    return np.array(atom_pops)\n\ndef total_electrons(S, P):\n    \"\"\"Compute total electron count N_e = tr(P S).\"\"\"\n    return float(np.trace(P @ S))\n\ndef is_identity(S, tol=1e-12):\n    I = np.eye(S.shape[0])\n    return np.allclose(S, I, atol=tol, rtol=0.0)\n\ndef solve():\n    tau = 1e-8\n\n    # Test case 1: symmetric diatomic, minimal basis\n    s1 = 0.45\n    S1 = np.array([[1.0, s1],\n                   [s1, 1.0]])\n    P1 = (1.0 / (1.0 + s1)) * np.array([[1.0, 1.0],\n                                        [1.0, 1.0]])\n    atoms1 = [[0], [1]]\n    Z1 = np.array([1.0, 1.0])\n\n    # Test case 2: orthogonal basis\n    S2 = np.eye(3)\n    P2 = np.diag([1.0, 1.0, 2.0])\n    atoms2 = [[0, 1], [2]]\n    Z2 = np.array([2.0, 2.0])\n\n    # Test case 3: ill-conditioned overlap\n    s3 = 0.999\n    S3 = np.array([[1.0, s3],\n                   [s3, 1.0]])\n    P3 = (1.0 / (1.0 + s3)) * np.array([[1.0, 1.0],\n                                        [1.0, 1.0]])\n    atoms3 = [[0], [1]]\n    Z3 = np.array([1.0, 1.0])\n\n    test_cases = [\n        (S1, P1, atoms1, Z1, {'check_symmetry': True, 'check_orthogonality': False}),\n        (S2, P2, atoms2, Z2, {'check_symmetry': False, 'check_orthogonality': True}),\n        (S3, P3, atoms3, Z3, {'check_symmetry': True, 'check_orthogonality': False}),\n    ]\n\n    results = []\n    for S, P, atom_blocks, Z, flags in test_cases:\n        # Populations\n        Pm = mulliken_atomic_populations(S, P, atom_blocks)\n        Pl = lowdin_atomic_populations(S, P, atom_blocks)\n        # Charges (not directly validated here, but computed per instruction)\n        qm = Z - Pm\n        ql = Z - Pl\n\n        # Electron conservation\n        Ne = total_electrons(S, P)\n        P_L_trace = np.trace(symmetric_matrix_sqrt(S) @ P @ symmetric_matrix_sqrt(S))\n        cons_ok = (\n            abs(np.sum(Pm) - Ne) <= tau and\n            abs(np.sum(Pl) - Ne) <= tau and\n            abs(P_L_trace - Ne) <= tau\n        )\n\n        # Non-negativity\n        nonneg_ok = (np.min(Pm) >= -tau) and (np.min(Pl) >= -tau)\n\n        # Orthogonality consistency (if S is identity, Mulliken and Löwdin populations must match)\n        if flags.get('check_orthogonality', False):\n            ortho_ok = np.allclose(Pm, Pl, atol=tau, rtol=0.0) and is_identity(S)\n        else:\n            ortho_ok = True\n\n        # Symmetry consistency (for symmetric diatomic, populations equal between atoms)\n        if flags.get('check_symmetry', False):\n            if len(atom_blocks) == 2 and len(atom_blocks[0]) == 1 and len(atom_blocks[1]) == 1:\n                sym_ok = (abs(Pm[0] - Pm[1]) <= tau) and (abs(Pl[0] - Pl[1]) <= tau)\n            else:\n                sym_ok = False\n        else:\n            sym_ok = True\n\n        all_ok = cons_ok and nonneg_ok and ortho_ok and sym_ok\n        results.append(all_ok)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2906487"}]}