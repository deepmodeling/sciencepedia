{"hands_on_practices": [{"introduction": "要准确计算磁学性质，我们必须首先解决一个棘手的理论问题：规范不变性。本练习将引导你深入探讨规范变换的本质，以及“包含规范的原子轨道”（GIAO）是如何通过在基函数中引入一个巧妙的含场相位因子来解决规范原点依赖性问题的。通过分析这个思想实验 [@problem_id:2916068]，你将理解为什么 GIAO 方法是现代量子化学计算磁学性质的基石。", "problem": "一个均匀静磁场 $\\mathbf{B}$ 可以由许多通过规范变换相关的矢势 $\\mathbf{A}(\\mathbf{r})$ 来表示。在采用最小耦合的非相对论电子结构理论中，电子哈密顿量使用 $\\mathbf{p}\\to \\mathbf{p}+q\\,\\mathbf{A}(\\mathbf{r})$，其中 $q$ 是原子单位下的电子电荷，$\\mathbf{p}$ 是正则动量算符。对于一个均匀场 $\\mathbf{B}$，一个常见的选择是以原点为中心的势 $\\mathbf{A}_{\\mathbf{R}_0}(\\mathbf{r})=\\tfrac{1}{2}\\,\\mathbf{B}\\times\\left(\\mathbf{r}-\\mathbf{R}_0\\right)$，它依赖于规范原点 $\\mathbf{R}_0$。精确的可观测量（包括核磁共振（NMR）屏蔽）是规范原点无关的，因为规范变换 $\\mathbf{A}\\mapsto \\mathbf{A}+\\nabla \\chi(\\mathbf{r})$ 可以通过对精确波函数进行相位变换 $\\psi(\\mathbf{r})\\mapsto e^{i q \\chi(\\mathbf{r})}\\psi(\\mathbf{r})$ 来补偿。然而，在一个没有场相关相位的有限实高斯基组中，变分空间在 $\\mathbf{A}\\mapsto \\mathbf{A}+\\nabla \\chi$ 下并非协变地变换，并且计算出的磁响应性质会伪依赖于 $\\mathbf{R}_0$。一个已知的解决方法是使用伦敦轨道，也称为包含规范的原子轨道（GIAOs），它为每个原子基函数附加一个场相关的相位。考虑在单行列式响应框架和收缩高斯基组内计算苯的各向同性NMR屏蔽常数。\n\n下列哪个陈述最好地解释了伦敦轨道如何减少对规范原点的依赖性，以及为何在计算苯的NMR屏蔽时，使用伦敦轨道通常会减少对极端弥散基函数的需求？\n\nA. 伦敦轨道为每个中心在 $\\mathbf{R}_\\mu$ 的原子基函数附加一个场相关的复相位，确保有限变分空间在规范原点 $\\mathbf{R}_0$ 的平移下能正确变换。这极大地抑制了有限基组下磁响应的原点依赖性。因为正确的长波规范行为已内建于基组中，所以极端弥散的 $s$ 型和 $p$ 型函数对于苯的屏蔽计算变得不那么关键，尽管极化函数对于描述感应环电流仍然至关重要。\n\nB. 伦敦轨道完全消除了屏蔽张量的顺磁项，因此原点依赖性消失，但对抗磁电流的描述需要比标准高斯基组增加更多的弥散函数。\n\nC. 规范原点依赖性完全源于电子相关；因此，在Hartree–Fock计算中引入伦敦轨道对原点依赖性没有影响，只有增加弥散函数才能解决这个问题。\n\nD. 选择满足 $\\nabla\\cdot \\mathbf{A}=0$ 的库仑规范，可以在任何有限高斯基组中精确消除原点依赖性，而无需添加相位因子；因此伦敦轨道是不必要的，而弥散函数仅用于描述苯的芯层轨道。\n\nE. 伦敦轨道中的相位因子再现了所有场致各向异性，因此不再需要极化函数；对于苯的屏蔽计算，带有伦敦相位的最小非极化基组就足够了，弥散函数变得完全多余。", "solution": "对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n\n-   一个均匀静磁场用 $\\mathbf{B}$ 表示。\n-   矢势为 $\\mathbf{A}(\\mathbf{r})$。\n-   在采用最小耦合的非相对论电子结构理论中，正则动量算符 $\\mathbf{p}$ 被替换为力学动量算符 $\\mathbf{p}+q\\,\\mathbf{A}(\\mathbf{r})$，其中 $q$ 是原子单位下的电子电荷。\n-   对于均匀场 $\\mathbf{B}$，一个常见的矢势选择是 $\\mathbf{A}_{\\mathbf{R}_0}(\\mathbf{r})=\\tfrac{1}{2}\\,\\mathbf{B}\\times\\left(\\mathbf{r}-\\mathbf{R}_0\\right)$，它依赖于一个规范原点 $\\mathbf{R}_0$。\n-   精确的可观测量与规范原点无关。\n-   一个规范变换 $\\mathbf{A}\\mapsto \\mathbf{A}+\\nabla \\chi(\\mathbf{r})$ 可以通过对精确波函数进行相位变换 $\\psi(\\mathbf{r})\\mapsto e^{i q \\chi(\\mathbf{r})}\\psi(\\mathbf{r})$ 来补偿。\n-   在一个没有场相关相位的有限实高斯基组中，计算出的磁学性质依赖于规范原点 $\\mathbf{R}_0$。\n-   包含规范的原子轨道（GIAOs），或称伦敦轨道，是一种解决方法，它为每个原子基函数附加一个场相关的相位。\n-   研究的体系是苯，性质是各向同性NMR屏蔽常数，在单行列式响应框架下使用收缩高斯基组进行计算。\n-   问题要求对伦敦轨道如何减少规范原点依赖性，以及为何其使用会减少对此类计算中极端弥散基函数的需求，作出最佳解释。\n\n**步骤2：使用提取的已知条件进行验证**\n\n-   **科学基础**：该问题基于成熟且完善的分子磁学性质的量子力学理论。矢势、规范变换、最小耦合规则、有限基组中的规范原点问题以及GIAO方法等概念都是该领域的基石。描述内容真实准确，科学上合理。\n-   **问题的适定性**：问题是适定的。它要求对一个已知的计算方法的有效性进行科学解释，这在理论中有明确和公认的答案。\n-   **客观性**：问题以精确、技术性的语言陈述，没有主观或含糊的术语。\n\n**步骤3：结论与行动**\n\n问题陈述在科学上是合理的、适定的和客观的。没有矛盾、信息缺失或其他缺陷。该问题是有效的。我们继续进行完整解答。\n\n**推导与评估**\n\n核心问题是量子力学可观测量的规范不变性。薛定谔方程在以下同步变换下是不变的：\n$$\n\\mathbf{A}(\\mathbf{r}) \\rightarrow \\mathbf{A}'(\\mathbf{r}) = \\mathbf{A}(\\mathbf{r}) + \\nabla\\chi(\\mathbf{r})\n$$\n$$\n\\psi(\\mathbf{r}) \\rightarrow \\psi'(\\mathbf{r}) = e^{iq\\chi(\\mathbf{r})/\\hbar} \\psi(\\mathbf{r})\n$$\n在原子单位中，$\\hbar=1$，对于电子 $q=-1$。问题陈述使用了一个通用电荷 $q$。\n\n当我们使用有限基组展开来表示分子轨道 $\\psi_i = \\sum_{\\mu} c_{\\mu i} \\phi_\\mu$ 时，精确波函数 $\\psi$ 被近似了。一套标准的原子轨道基组 $\\{\\phi_\\mu(\\mathbf{r}-\\mathbf{R}_\\mu)\\}$ 是固定的，不依赖于矢势 $\\mathbf{A}(\\mathbf{r})$。如果我们改变规范，例如通过平移 $\\mathbf{A}_{\\mathbf{R}_0}(\\mathbf{r})=\\tfrac{1}{2}\\,\\mathbf{B}\\times\\left(\\mathbf{r}-\\mathbf{R}_0\\right)$ 中的规范原点 $\\mathbf{R}_0$，由 $\\{\\phi_\\mu\\}$ 张成的空间中的任意函数都无法重现所需的相位变换 $e^{iq\\chi(\\mathbf{r})/\\hbar}\\psi(\\mathbf{r})$。变分空间在该变换下是不封闭的。基组的这种不完备性是计算性质（如NMR屏蔽常数）出现伪规范原点依赖性的根源。\n\n由 Fritz London 在1937年引入的伦敦轨道（或GIAO）方法，在基函数层面上弥补了这一缺陷。它使用一个场相关的基函数，而不是场无关的基函数 $\\phi_\\mu$：\n$$\n\\chi_\\mu(\\mathbf{r}, \\mathbf{B}) = e^{-iq\\frac{1}{2}(\\mathbf{B}\\times\\mathbf{R}_\\mu)\\cdot\\mathbf{r}} \\, \\phi_\\mu(\\mathbf{r}-\\mathbf{R}_\\mu)\n$$\n这种特定形式是针对规范原点位于坐标系原点的情况，即 $\\mathbf{R}_0 = \\mathbf{0}$ 和 $\\mathbf{A}(\\mathbf{r}) = \\frac{1}{2}\\mathbf{B}\\times\\mathbf{r}$。相位因子是 $e^{-iq\\mathbf{A}(\\mathbf{R}_\\mu)\\cdot\\mathbf{r}}$。这个相位因子赋予了基函数在磁场下正确的平移性质。当力学动量算符 $\\hat{\\boldsymbol{\\pi}} = \\mathbf{p} + q\\mathbf{A}(\\mathbf{r})$ 作用于这个GIAO时，结果是\n$$\n\\hat{\\boldsymbol{\\pi}} \\chi_\\mu(\\mathbf{r}, \\mathbf{B}) = e^{-iq\\mathbf{A}(\\mathbf{R}_\\mu)\\cdot\\mathbf{r}} \\left( \\mathbf{p} + q\\mathbf{A}(\\mathbf{r}) - q\\mathbf{A}(\\mathbf{R}_\\mu) \\right) \\phi_\\mu(\\mathbf{r}-\\mathbf{R}_\\mu) = e^{-iq\\mathbf{A}(\\mathbf{R}_\\mu)\\cdot\\mathbf{r}} \\left( \\mathbf{p} + q\\frac{1}{2}\\mathbf{B}\\times(\\mathbf{r}-\\mathbf{R}_\\mu) \\right) \\phi_\\mu(\\mathbf{r}-\\mathbf{R}_\\mu)\n$$\n关键的是，作用于原始高斯函数 $\\phi_\\mu$ 的算符中出现的矢势，现在是以基函数自身的原点 $\\mathbf{R}_\\mu$ 为中心的。任何涉及动量算符的矩阵元 $\\langle \\chi_\\mu | \\hat{\\mathcal{O}} | \\chi_\\nu \\rangle$ 现在都依赖于以各自原子位置 $\\mathbf{R}_\\mu$ 和 $\\mathbf{R}_\\nu$ 为中心的矢势，并且与全局的、任意的规范原点 $\\mathbf{R}_0$ 无关。这确保了即使在使用有限基组时，计算出的性质在很大程度上也与 $\\mathbf{R}_0$ 无关。\n\n现在，我们考虑对弥散函数的需求。在没有GIAO的情况下，如果选择的规范原点 $\\mathbf{R}_0$ 远离位于 $\\mathbf{R}_\\mu$ 的原子，基函数 $\\{\\phi_\\mu\\}$ 就必须描述在一个大的矢势 $\\mathbf{A}_{\\mathbf{R}_0}(\\mathbf{r})$ 下的电子响应。这要求基组在长距离上具有非常大的灵活性，以正确模拟感应电流密度，这反过来又需要使用具有大空间延展性的基函数（即非常弥散的函数）。这是一个由于选择了不佳的共同规范原点而产生的人为需求。有了GIAO，规范问题的长程部分通过复相位因子得到了解析解决。每个基函数实际上都在其自己的局域规范中运行，因此它只需要足够灵活来描述其紧邻区域内电子密度的*物理*响应。因此，为处理长程规范效应而对弥散函数的人为需求被大大减少了。\n\n然而，对电子电流（如苯中的芳香环电流）的物理解释需要分子轨道的形变。这种形变是通过在基组中混合不同角动量的函数（例如，碳上的 $p$ 和 $d$ 轨道）来实现的。这些就是极化函数。GIAO并没有消除对物理响应进行充分描述的需求，因此极化函数对于精确计算像NMR屏蔽各向异性这样的性质仍然至关重要，而这种性质在苯中主要由环电流决定。\n\n基于此理解，我们来评估各个选项。\n\n**逐项分析选项**\n\n**A.** “伦敦轨道为每个中心在 $\\mathbf{R}_\\mu$ 的原子基函数附加一个场相关的复相位，确保有限变分空间在规范原点 $\\mathbf{R}_0$ 的平移下能正确变换。这极大地抑制了有限基组下磁响应的原点依赖性。因为正确的长波规范行为已内建于基组中，所以极端弥散的 $s$ 型和 $p$ 型函数对于苯的屏蔽计算变得不那么关键，尽管极化函数对于描述感应环电流仍然至关重要。”\n这个陈述与我们的推导完全一致。它正确地指出了相位因子在恢复正确的变换性质和抑制原点依赖性方面的作用。它正确地将内建的“长波规范行为”与减少对弥散函数的需求联系起来。最后，它正确地指出，为了描述感应电流这一物理现象，极化函数仍然是必需的。\n**结论：正确。**\n\n**B.** “伦敦轨道完全消除了屏蔽张量的顺磁项，因此原点依赖性消失，但对抗磁电流的描述需要比标准高斯基组增加更多的弥散函数。”\n这是不正确的。GIAO并不消除顺磁项，顺磁项是屏蔽中一个具有物理意义（尽管依赖于规范）的组成部分。它们确保了顺磁项和抗磁项之和近似于规范不变。声称它们增加了对弥散函数的需求与事实恰恰相反。\n**结论：不正确。**\n\n**C.** “规范原点依赖性完全源于电子相关；因此，在Hartree–Fock计算中引入伦敦轨道对原点依赖性没有影响，只有增加弥散函数才能解决这个问题。”\n这是不正确的。规范原点依赖性是有限基组的人为产物，即使在忽略电子相关的Hartree–Fock（单行列式）理论中也很突出。GIAO在Hartree-Fock水平上极其有效。声称只有弥散函数才能解决这个问题也是错误的。\n**结论：不正确。**\n\n**D.** “选择满足 $\\nabla\\cdot \\mathbf{A}=0$ 的库仑规范，可以在任何有限高斯基组中精确消除原点依赖性，而无需添加相位因子；因此伦敦轨道是不必要的，而弥散函数仅用于描述苯的芯层轨道。”\n这是不正确的。库仑规范条件 $\\nabla\\cdot \\mathbf{A}=0$ 并不能唯一确定 $\\mathbf{A}$，在该规范族内仍然存在平移规范原点的自由度。因此，规范原点问题并未被消除。此外，关于弥散函数用于描述芯层轨道的说法是无稽之谈；它们是用于描述价层和长程现象的。\n**结论：不正确。**\n\n**E.** “伦敦轨道中的相位因子再现了所有场致各向异性，因此不再需要极化函数；对于苯的屏蔽计算，带有伦敦相位的最小非极化基组就足够了，弥散函数变得完全多余。”\n这是不正确的。相位因子纠正了一个数学上的缺陷（规范依赖性）。它不能替代描述电子云各向异性畸变的物理必要性，而极化函数对此至关重要。即使带有GIAO，一个最小基组也无法为像苯这样的分子得出准确的屏蔽常数。\n**结论：不正确。**\n\n因此，只有陈述A提供了科学上正确和完整的解释。", "answer": "$$\\boxed{A}$$", "id": "2916068"}, {"introduction": "理解了 GIAO 如何解决规范依赖问题后，我们下一个核心任务是为磁响应计算选择合适的基组。本练习将挑战你对收缩高斯基组中不同类型基函数作用的理解 [@problem_id:2766304]。你将从第一性原理出发，辨析极化函数和弥散函数在分别描述顺磁性贡献（paramagnetic contribution）和抗磁性贡献（diamagnetic contribution）时的关键物理角色。", "problem": "一位理论化学家正在评估收缩高斯基组的选择如何影响计算得到的核磁共振（NMR）屏蔽张量和磁化率。设静态均匀磁场 $\\mathbf{B}$ 中的电子能量为 $E(\\mathbf{B})$，原子核 $K$ 的核磁矩为 $\\boldsymbol{\\mu}_{K}$。根据响应性质的标准定义，磁化率张量为\n$$\n\\chi_{\\alpha\\beta} \\;=\\; -\\,\\left.\\frac{\\partial^{2}E}{\\partial B_{\\alpha}\\,\\partial B_{\\beta}}\\right|_{\\mathbf{B}=\\mathbf{0}},\n$$\n原子核 $K$ 处的 NMR 屏蔽张量为\n$$\n\\sigma_{K,\\alpha\\beta} \\;=\\; \\left.\\frac{\\partial^{2}E}{\\partial B_{\\alpha}\\,\\partial \\mu_{K,\\beta}}\\right|_{\\mathbf{B}=\\mathbf{0},\\,\\boldsymbol{\\mu}_{K}=\\mathbf{0}}.\n$$\n在最小耦合哈密顿量和库仑规范内，将哈密顿量按 $\\mathbf{B}$的幂次展开，可从 $\\mathbf{A}^{2}(\\mathbf{r})$ 得到一个抗磁（二次）项，从 $\\mathbf{A}(\\mathbf{r})\\cdot \\mathbf{p}$ 得到一个顺磁（线性）项，其中 $\\mathbf{A}(\\mathbf{r}) = \\tfrac{1}{2}\\,\\mathbf{B}\\times \\mathbf{r}$ 是矢量势，$\\mathbf{p}$ 是正则动量算符。抗磁贡献涉及随 $\\mathbf{r}$ 的矩缩放的期望值，而顺磁贡献涉及由类角动量算符介导的虚态耦合，强制执行 $\\Delta \\ell = \\pm 1$ 的选择定则。\n\n该化学家目前使用的是一种分段、强收缩的价层双泽塔（$2$-zeta）基组，未添加任何弥散或极化函数，并发现计算出的各向同性磁化率 $\\bar{\\chi}$ 以及阴离子和 π 体系的 $\\boldsymbol{\\sigma}_{K}$ 各向异性分量具有很大的基组敏感性。他们考虑了三种可能的修改：添加弥散函数（小指数）、添加极化函数（更高角动量）以及部分解收缩选定的壳层。他们还考虑改用规范不变原子轨道（Gauge-Including Atomic Orbitals, GIAOs），这种方法在基函数中嵌入了一个场依赖相位以减少规范原点误差。\n\n以下哪个陈述从第一性原理出发，最好地解释了为什么在收缩高斯基组中，弥散函数和极化函数对于精确计算 $\\boldsymbol{\\sigma}_{K}$ 和 $\\boldsymbol{\\chi}$ 至关重要，以及 GIAOs 能修正和不能修正什么？\n\nA. 弥散函数改善了对长程密度和感生电流分布的描述，因为抗磁算符通过 $r^{2}$ 因子（通过 $\\mathbf{A}^{2}\\propto (\\mathbf{B}\\times \\mathbf{r})^{2}$）对期望值进行加权，因此磁化率和面外屏蔽分量在阴离子和易于形成里德伯态的体系中尤其敏感。包含弥散函数可以减少规范原点敏感性和 $\\bar{\\chi}$ 与 $\\boldsymbol{\\sigma}_{K}$ 中的基组不完备性误差。\n\nB. 极化函数（更高的 $\\ell$）使顺磁项能够通过强制执行 $\\Delta \\ell=\\pm 1$ 的类角动量算符将占据空间和虚空间耦合起来。解收缩极化壳层增加了这些耦合的变分灵活性，从而改善了 $\\boldsymbol{\\sigma}_{K}$ 和 $\\boldsymbol{\\chi}$ 的各向异性和绝对值。\n\nC. 强收缩消除了磁响应性质中的误差，因为收缩系数是为基态能量优化的；因此，添加弥散或极化函数对 $\\boldsymbol{\\chi}$ 和 $\\boldsymbol{\\sigma}_{K}$ 的影响可以忽略不计。\n\nD. 使用规范不变原子轨道（GIAOs）消除了对弥散和极化函数的需求，因为 GIAOs 在任何有限基组中都能为磁响应算符精确地强制实现规范原点不变性和完备性。\n\nE. 对于阳离子和紧凑的中性分子，弥散函数对 $\\boldsymbol{\\chi}$ 或 $\\boldsymbol{\\sigma}_{K}$ 从来没有好处，因为其密度衰减很快；对于这些性质，只有紧束（大指数）核心层函数才重要。\n\n选择所有正确的选项。", "solution": "该问题要求评估关于收缩高斯基组（特别是弥散函数和极化函数）以及规范不变原子轨道（GIAO）方法在计算 NMR 屏蔽张量（$\\boldsymbol{\\sigma}_{K}$）和磁化率（$\\boldsymbol{\\chi}$）中作用的陈述。\n\n首先，我们必须从磁场中的电子哈密顿量来剖析这些性质的来源。分子在存在外部均匀磁场 $\\mathbf{B}$ 和核磁偶极矩 $\\boldsymbol{\\mu}_{K}$ 时的能量可以展开为泰勒级数。所讨论的性质是这个能量 $E(\\mathbf{B}, \\boldsymbol{\\mu}_{K})$ 的二阶导数：\n$$\n\\chi_{\\alpha\\beta} = -\\left.\\frac{\\partial^{2}E}{\\partial B_{\\alpha}\\,\\partial B_{\\beta}}\\right|_{\\mathbf{B}=\\mathbf{0}, \\boldsymbol{\\mu}=\\mathbf{0}}\n$$\n$$\n\\sigma_{K,\\alpha\\beta} = \\left.\\frac{\\partial^{2}E}{\\partial B_{\\alpha}\\,\\partial \\mu_{K,\\beta}}\\right|_{\\mathbf{B}=\\mathbf{0}, \\boldsymbol{\\mu}=\\mathbf{0}}\n$$\n在最小耦合形式中，包含这些场的哈密顿算符涉及到将每个电子 $i$ 的正则动量算符 $\\mathbf{p}_i$ 替换为力学动量 $\\boldsymbol{\\pi}_i = \\mathbf{p}_i + e\\mathbf{A}(\\mathbf{r}_i)$，其中 $e$ 是电子电荷（在原子单位中为-1），$\\mathbf{A}(\\mathbf{r}_i)$ 是电子位置 $\\mathbf{r}_i$ 处的矢量势。总矢量势是来自外部场的贡献 $\\mathbf{A}_{\\text{ext}}(\\mathbf{r}) = \\frac{1}{2}\\mathbf{B} \\times (\\mathbf{r} - \\mathbf{R}_O)$（其中 $\\mathbf{R}_O$ 是规范原点）和来自核矩的贡献 $\\mathbf{A}_K(\\mathbf{r}) \\propto \\boldsymbol{\\mu}_K \\times (\\mathbf{r} - \\mathbf{R}_K) / |\\mathbf{r} - \\mathbf{R}_K|^3$ 的总和。\n\n展开动能项 $\\frac{1}{2m_e}\\sum_i (\\mathbf{p}_i + e\\mathbf{A}_i)^2$ 会产生对场强线性和二次的微扰算符。因此，计算出的二阶性质 $\\boldsymbol{\\chi}$ 和 $\\boldsymbol{\\sigma}_K$ 分为两个贡献：\n\n1.  **抗磁贡献（$\\boldsymbol{\\chi}^d, \\boldsymbol{\\sigma}_K^d$）**：这来自于哈密顿量中对矢量势呈二次的项，$\\hat{H}^{(2)} \\propto \\sum_i \\mathbf{A}(\\mathbf{r}_i)^2$。它对能量的贡献是作为一阶微扰计算的，即作为 $\\hat{H}^{(2)}$ 相对于基态波函数 $\\Psi_0$ 的期望值。对于磁化率，该算符涉及 $(\\mathbf{B} \\times (\\mathbf{r}-\\mathbf{R}_O))^2$，它随距规范原点距离的平方（例如 $r^2$）缩放。因此，抗磁贡献本质上是 $\\langle \\Psi_0 | \\sum_i f(\\mathbf{r}_i^2) | \\Psi_0 \\rangle$ 形式的期望值。其精确计算严重依赖于基态波函数的质量，特别是在电子分布的外部区域，因为那里的 $r^2$ 因子很大。\n\n2.  **顺磁贡献（$\\boldsymbol{\\chi}^p, \\boldsymbol{\\sigma}_K^p$）**：这来自于哈密顿量中对矢量势呈线性的项，$\\hat{H}^{(1)} \\propto \\sum_i \\mathbf{A}(\\mathbf{r}_i) \\cdot \\mathbf{p}_i$。它对能量的贡献是使用二阶微扰理论计算的，涉及对激发态 $|n\\rangle$ 的求和：\n    $$\n    E^{(2)} \\propto \\sum_{n \\neq 0} \\frac{\\langle 0 | \\hat{H}^{(1)} | n \\rangle \\langle n | \\hat{H}^{(1)} | 0 \\rangle}{E_0 - E_n}\n    $$\n    外部场微扰的算符 $\\mathbf{A}_{\\text{ext}} \\cdot \\mathbf{p}$ 与 $(\\mathbf{B} \\times (\\mathbf{r}-\\mathbf{R}_O)) \\cdot \\mathbf{p} = \\mathbf{B} \\cdot ((\\mathbf{r}-\\mathbf{R}_O) \\times \\mathbf{p}) = \\mathbf{B} \\cdot \\mathbf{L}_O$ 成正比，其中 $\\mathbf{L}_O$ 是相对于规范原点 $\\mathbf{R}_O$ 的电子角动量算符。该算符将基态与激发态耦合。角动量算符的选择定则将角动量量子数为 $\\ell$ 的态与 $\\ell \\pm 1$ 的态连接起来。因此，对顺磁项的精确描述需要一个能够充分表示这些虚实混合的激发态的基组，这些激发态具有与它们被激发所来源的占据轨道不同的角动量特征。\n\n基于此，我们评估所提供的选项。\n\n**选项 A**：弥散函数改善了对长程密度和感生电流分布的描述，因为抗磁算符通过 $r^{2}$ 因子（通过 $\\mathbf{A}^{2}\\propto (\\mathbf{B}\\times \\mathbf{r})^{2}$）对期望值进行加权，因此磁化率和面外屏蔽分量在阴离子和易于形成里德伯态的体系中尤其敏感。包含弥散函数可以减少规范原点敏感性和 $\\bar{\\chi}$ 与 $\\boldsymbol{\\sigma}_{K}$ 中的基组不完备性误差。\n\n这个陈述是正确的。如前所述，抗磁贡献取决于类似 $r^2$ 的算符的期望值。对于具有空间延展性电子云的体系，如阴离子或 π 体系，电子密度在“尾部”区域非常重要。缺乏弥散函数（即小指数的高斯函数）的基组无法准确模拟这个尾部，导致严重低估 $\\langle r^2 \\rangle$，从而导致抗磁项不准确。问题正确地指出了对阴离子和 π 体系的敏感性。通过添加任何必要的函数来改进基组，自然会减少基组不完备性误差（BSIE）。由于规范原点依赖性是 BSIE 的一种表现，添加弥散函数也能减少这种人为效应（在共同规范原点计算中）。\n结论：**正确**。\n\n**选项 B**：极化函数（更高的 $\\ell$）使顺磁项能够通过强制执行 $\\Delta \\ell=\\pm 1$ 的类角动量算符将占据空间和虚空间耦合起来。解收缩极化壳层增加了这些耦合的变分灵活性，从而改善了 $\\boldsymbol{\\sigma}_{K}$ 和 $\\boldsymbol{\\chi}$ 的各向异性和绝对值。\n\n这个陈述是正确的。顺磁贡献是由一个类角动量算符 $\\mathbf{L}_O$ 介导的。为了通过二阶微扰理论描述电子响应，基组必须在虚（未占据）轨道空间中提供足够的灵活性。具体来说，如果一个占据轨道的角动量特征为 $\\ell$，$\\mathbf{L}_O$ 算符将尝试将其与具有 $\\ell \\pm 1$ 特征的虚轨道耦合。极化函数（例如，碳的 $d$ 函数，氢的 $p$ 函数）将这些更高角动量的函数引入基组，这对于描述这种耦合至关重要。没有它们，顺磁项的计算会非常差。化学屏蔽的各向异性通常由顺磁项主导，因此其精确描述至关重要。解收缩壳层增强了变分灵活性，使自洽场过程能够形成更适应微扰的分子轨道，从而进一步改善结果。\n结论：**正确**。\n\n**选项 C**：强收缩消除了磁响应性质中的误差，因为收缩系数是为基态能量优化的；因此，添加弥散或极化函数对 $\\boldsymbol{\\chi}$ 和 $\\boldsymbol{\\sigma}_{K}$ 的影响可以忽略不计。\n\n这个陈述有根本性的缺陷。基组收缩是一种计算上的便利措施，但它降低了变分灵活性。虽然收缩系数通常是为很好地再现原子基态能量或波函数而优化的，但这种优化并不能转移到响应性质的精确预测上。响应性质衡量的是波函数因微扰而发生的变化，对于这一特性，收缩基组通常过于刚性。断言添加弥散或极化函数影响可以忽略不计的说法，与计算化学中所有已建立的知识相悖，并与问题本身提出的“大的基组敏感性”的前提相矛盾。\n结论：**不正确**。\n\n**选项 D**：使用规范不变原子轨道（GIAOs）消除了对弥散和极化函数的需求，因为 GIAOs 在任何有限基组中都能为磁响应算符精确地强制实现规范原点不变性和完备性。\n\n这个陈述歪曲了 GIAOs 的功能。GIAOs 是具有显式、场依赖相位因子的基函数，$\\chi_\\mu(\\mathbf{B}) = e^{i\\frac{1}{2c}(\\mathbf{B}\\times\\mathbf{R}_\\mu)\\cdot\\mathbf{r}}\\phi_\\mu(\\mathbf{r}-\\mathbf{R}_\\mu)$。这种构造确保了计算得到的总磁性质与所选的规范原点 $\\mathbf{R}_O$ 无关，即使使用有限基组也是如此。然而，GIAO 计算并**不会**使有限基组变得完备。它只是消除了一个特定的人为效应（规范原点依赖性）。如果底层的基组（$\\{\\phi_\\mu\\}$）在物理上是不充分的（例如，缺乏描述顺磁耦合的极化函数或描述电子分布尾部的弥散函数），GIAO 计算将产生一个规范不变的结果，但该结果在数值上仍然是不准确的。它将收敛到错误的物理答案。声称强制实现“完备性”是错误的；没有有限基组是完备的。\n结论：**不正确**。\n\n**选项 E**：对于阳离子和紧凑的中性分子，弥散函数对 $\\boldsymbol{\\chi}$ 或 $\\boldsymbol{\\sigma}_{K}$ 从来没有好处，因为其密度衰减很快；对于这些性质，只有紧束（大指数）核心层函数才重要。\n\n这个陈述是错误的。“从不”这个词是一个不科学的绝对说法。虽然对弥散函数的需求在阴离子中最为迫切，但它们仍然可以通过更好地描述价层区域的尾部来提高中性分子甚至阳离子的计算精度。陈述的第二部分，“只有紧束（大指数）核心层函数才重要”，是严重错误的。磁屏蔽和磁化率主要是价电子现象。核心层电子被紧密束缚且不易极化；与直接参与化学环境且更容易被外场微扰的价电子相比，它们的贡献相对较小。价层空间需要最精确和最灵活的描述。\n结论：**不正确**。", "answer": "$$\\boxed{AB}$$", "id": "2766304"}, {"introduction": "理论的深度最终要在实践中得到检验。这项综合性练习将理论付诸代码，要求你基于预先计算好的 GIAO 矩阵，亲手实现一个完整的 NMR 屏蔽常数计算程序 [@problem_id:2893981]。通过解决这个编码问题，你将把关于哈特里-福克方程、微扰理论和 GIAO 屏蔽贡献（抗磁项和顺磁项）的知识融会贯通，将抽象的公式转化为具体的数值结果。", "problem": "一个处于均匀外磁场中的闭壳层分子，由采用库仑规范中矢量势的最小耦合哈密顿量描述，其中矢量势由 $\\mathbf{A}(\\mathbf{r}) = \\tfrac{1}{2}\\,\\mathbf{B} \\times (\\mathbf{r} - \\mathbf{R}_g)$ 给出。电子能量同时依赖于外磁场 $\\mathbf{B}$ 和所选原子核 $K$ 的磁偶极矩 $\\boldsymbol{\\mu}_K$。原子核 $K$ 处的核磁共振（NMR）屏蔽张量定义为电子能量对这些微扰的混合二阶导数，并在零场和零核磁矩条件下求值。在线性响应框架下，采用规范不变原子轨道（Gauge-Including Atomic Orbitals, GIAO）和闭壳层限制性Hartree–Fock（RHF）参考态，屏蔽张量分解为一个来自单电子抗磁算符期望值的抗磁贡献和一个源于波函数一阶变化的顺磁贡献。你需要从最小耦合哈密顿量和屏蔽张量的定义出发，推导出一个在包含GIAO相位因子的原子轨道（AO）基组下适合进行数值计算的可执行表达式，推导需遵循以下假设：闭壳层RHF参考态，顺磁项采用独立粒子线性响应（态求和）方法，以及性质积分已在GIAO基组中计算完毕。\n\n你的任务是编写一个完整的程序，对每个提供的测试用例，仅使用测试套件数据中提供的信息执行以下步骤：\n- 在非正交AO基组中求解Fock矩阵的广义本征值问题，以获得分子轨道（MO）能量和系数。\n- 根据占据的MO系数构建闭壳层单粒子密度矩阵。\n- 将指定原子核处的屏蔽张量抗磁部分，作为所提供的抗磁AO算符矩阵与密度矩阵的期望值进行求值。\n- 使用独立粒子态求和表达式，评估屏蔽张量的顺磁部分。该表达式涉及耦合至原子核 $K$ 处核磁偶极矩和外磁场的、所提供的AO性质矩阵的占据-虚MO矩阵元。\n- 构成总屏蔽张量并报告其各向同性值。\n\n你必须将以下对象视为每个用例的给定数值输入：\n- AO重叠矩阵 $\\mathbf{S}$，一个大小为 $N \\times N$ 的实对称正定矩阵。\n- AO Fock矩阵 $\\mathbf{F}$，一个大小为 $N \\times N$ 的实对称矩阵，对应于零场下未微扰的RHF解。\n- 电子数 $N_e$，一个偶数，决定了占据空间轨道数 $N_{\\mathrm{occ}} = N_e / 2$。\n- 所选原子核 $K$ 的抗磁AO算符矩阵，每个笛卡尔分量一个，即 $\\mathbf{D}_{xx}^K$、$\\mathbf{D}_{yy}^K$ 和 $\\mathbf{D}_{zz}^K$，每个矩阵大小为 $N \\times N$。\n- 原子核 $K$ 处的磁偶极耦合AO矩阵 $\\mathbf{M}_x^K$、$\\mathbf{M}_y^K$ 和 $\\mathbf{M}_z^K$，每个矩阵大小为 $N \\times N$。\n- 外磁场耦合AO矩阵 $\\mathbf{L}_x$、$\\mathbf{L}_y$ 和 $\\mathbf{L}_z$，每个矩阵大小为 $N \\times N$。\n- 一个规范原点向量 $\\mathbf{R}_g$（对于GIAO处理，这不应影响最终结果），指定为三个实数。\n\n你的程序必须：\n- 通过对称正交化方法对AO基组进行正交化，对角化变换后的Fock矩阵，并反变换以获得AO基组中的MO系数矩阵，从而求解MO能量和系数。\n- 构建闭壳层密度矩阵 $\\mathbf{P} = 2\\,\\mathbf{C}_{\\mathrm{occ}} \\mathbf{C}_{\\mathrm{occ}}^{\\top}$，其中 $\\mathbf{C}_{\\mathrm{occ}}$ 包含MO系数矩阵 $\\mathbf{C}$ 的前 $N_{\\mathrm{occ}}$ 列。\n- 计算抗磁对角屏蔽分量 $\\sigma_{d,uu} = \\mathrm{Tr}(\\mathbf{P}\\,\\mathbf{D}_{uu}^K)$，其中 $u \\in \\{x,y,z\\}$，仅使用所提供的对角算符分量 $\\mathbf{D}_{xx}^K$、$\\mathbf{D}_{yy}^K$ 和 $\\mathbf{D}_{zz}^K$。\n- 对 $u \\in \\{x,y,z\\}$，使用MO基组中的态求和表达式计算顺磁对角屏蔽分量：\n  1. 通过 $\\tilde{\\mathbf{M}}_u^K = \\mathbf{C}^{\\top} \\mathbf{M}_u^K \\mathbf{C}$ 和 $\\tilde{\\mathbf{L}}_u = \\mathbf{C}^{\\top} \\mathbf{L}_u \\mathbf{C}$ 将 $\\mathbf{M}_u^K$ 和 $\\mathbf{L}_u$ 变换到MO基组。\n  2. 设 $\\{\\varepsilon_p\\}$ 为升序排列的MO能量。用 $i$ 索引占据轨道，用 $a$ 索引虚轨道，计算\n     $\\sigma_{p,uu} = -2 \\sum_{i=1}^{N_{\\mathrm{occ}}} \\sum_{a=N_{\\mathrm{occ}}+1}^{N} \\dfrac{ \\tilde{M}_{u,ia}^K \\, \\tilde{L}_{u,ai} }{ \\varepsilon_{a} - \\varepsilon_{i} }$。\n- 构成总对角分量 $\\sigma_{uu} = \\sigma_{d,uu} + \\sigma_{p,uu}$ 并计算各向同性屏蔽 $\\sigma_{\\mathrm{iso}} = (\\sigma_{xx} + \\sigma_{yy} + \\sigma_{zz})/3$。\n- 通过计算 $\\sigma_{\\mathrm{ppm}} = 10^{6}\\,\\sigma_{\\mathrm{iso}}$，以百万分率（ppm）报告结果。\n\n除非另有说明，所有量均以原子单位给出。每个测试用例的输出必须是一个浮点数，表示 $\\sigma_{\\mathrm{ppm}}$，精确到小数点后 $6$ 位。你的程序应生成单行输出，包含所有测试用例的结果，格式为方括号内逗号分隔的列表，例如 $[x_1,x_2,x_3]$。\n\n使用以下测试套件。每个测试用例通过提供 $N$、$N_e$、$\\mathbf{S}$、$\\mathbf{F}$、$\\mathbf{D}_{xx}^K$、$\\mathbf{D}_{yy}^K$、$\\mathbf{D}_{zz}^K$、$\\mathbf{M}_x^K$、$\\mathbf{M}_y^K$、$\\mathbf{M}_z^K$、$\\mathbf{L}_x$、$\\mathbf{L}_y$、$\\mathbf{L}_z$ 和 $\\mathbf{R}_g$ 来指定。\n\n测试用例 $1$（闭壳层双原子分子，二-AO最小基组，轻微AO重叠）：\n- $N = 2$, $N_e = 2$。\n- $\\mathbf{S} = \\begin{bmatrix} $1.0$ & $0.05$ \\\\ $0.05$ & $1.0$ \\end{bmatrix}$。\n- $\\mathbf{F} = \\begin{bmatrix} -$0.7$ & -$0.15$ \\\\ -$0.15$ & $0.2$ \\end{bmatrix}$。\n- $\\mathbf{D}_{xx}^K = \\begin{bmatrix} $3.1\\times 10^{-5}$ & $0.2\\times 10^{-5}$ \\\\ $0.2\\times 10^{-5}$ & $2.9\\times 10^{-5}$ \\end{bmatrix}$。\n- $\\mathbf{D}_{yy}^K = \\begin{bmatrix} $3.0\\times 10^{-5}$ & $0.1\\times 10^{-5}$ \\\\ $0.1\\times 10^{-5}$ & $3.0\\times 10^{-5}$ \\end{bmatrix}$。\n- $\\mathbf{D}_{zz}^K = \\begin{bmatrix} $3.2\\times 10^{-5}$ & -$0.1\\times 10^{-5}$ \\\\ -$0.1\\times 10^{-5}$ & $2.8\\times 10^{-5}$ \\end{bmatrix}$。\n- $\\mathbf{M}_x^K = \\begin{bmatrix} $0.0$ & $1.5\\times 10^{-3}$ \\\\ $1.5\\times 10^{-3}$ & $0.0$ \\end{bmatrix}$。\n- $\\mathbf{M}_y^K = \\begin{bmatrix} $0.0$ & -$1.1\\times 10^{-3}$ \\\\ -$1.1\\times 10^{-3}$ & $0.0$ \\end{bmatrix}$。\n- $\\mathbf{M}_z^K = \\begin{bmatrix} $0.0$ & $0.9\\times 10^{-3}$ \\\\ $0.9\\times 10^{-3}$ & $0.0$ \\end{bmatrix}$。\n- $\\mathbf{L}_x = \\begin{bmatrix} $0.0$ & $2.0\\times 10^{-3}$ \\\\ $2.0\\times 10^{-3}$ & $0.0$ \\end{bmatrix}$。\n- $\\mathbf{L}_y = \\begin{bmatrix} $0.0$ & -$1.8\\times 10^{-3}$ \\\\ -$1.8\\times 10^{-3}$ & $0.0$ \\end{bmatrix}$。\n- $\\mathbf{L}_z = \\begin{bmatrix} $0.0$ & $1.6\\times 10^{-3}$ \\\\ $1.6\\times 10^{-3}$ & $0.0$ \\end{bmatrix}$。\n- $\\mathbf{R}_g = ($0.0$, $0.0$, $0.0$)$。\n\n测试用例 $2$（相同的积分，不同的规范原点，以测试GIAO下的规范原点不变性）：\n- $N = 2$, $N_e = 2$。\n- $\\mathbf{S} = \\begin{bmatrix} $1.0$ & $0.05$ \\\\ $0.05$ & $1.0$ \\end{bmatrix}$。\n- $\\mathbf{F} = \\begin{bmatrix} -$0.7$ & -$0.15$ \\\\ -$0.15$ & $0.2$ \\end{bmatrix}$。\n- $\\mathbf{D}_{xx}^K = \\begin{bmatrix} $3.1\\times 10^{-5}$ & $0.2\\times 10^{-5}$ \\\\ $0.2\\times 10^{-5}$ & $2.9\\times 10^{-5}$ \\end{bmatrix}$。\n- $\\mathbf{D}_{yy}^K = \\begin{bmatrix} $3.0\\times 10^{-5}$ & $0.1\\times 10^{-5}$ \\\\ $0.1\\times 10^{-5}$ & $3.0\\times 10^{-5}$ \\end{bmatrix}$。\n- $\\mathbf{D}_{zz}^K = \\begin{bmatrix} $3.2\\times 10^{-5}$ & -$0.1\\times 10^{-5}$ \\\\ -$0.1\\times 10^{-5}$ & $2.8\\times 10^{-5}$ \\end{bmatrix}$。\n- $\\mathbf{M}_x^K = \\begin{bmatrix} $0.0$ & $1.5\\times 10^{-3}$ \\\\ $1.5\\times 10^{-3}$ & $0.0$ \\end{bmatrix}$。\n- $\\mathbf{M}_y^K = \\begin{bmatrix} $0.0$ & -$1.1\\times 10^{-3}$ \\\\ -$1.1\\times 10^{-3}$ & $0.0$ \\end{bmatrix}$。\n- $\\mathbf{M}_z^K = \\begin{bmatrix} $0.0$ & $0.9\\times 10^{-3}$ \\\\ $0.9\\times 10^{-3}$ & $0.0$ \\end{bmatrix}$。\n- $\\mathbf{L}_x = \\begin{bmatrix} $0.0$ & $2.0\\times 10^{-3}$ \\\\ $2.0\\times 10^{-3}$ & $0.0$ \\end{bmatrix}$。\n- $\\mathbf{L}_y = \\begin{bmatrix} $0.0$ & -$1.8\\times 10^{-3}$ \\\\ -$1.8\\times 10^{-3}$ & $0.0$ \\end{bmatrix}$。\n- $\\mathbf{L}_z = \\begin{bmatrix} $0.0$ & $1.6\\times 10^{-3}$ \\\\ $1.6\\times 10^{-3}$ & $0.0$ \\end{bmatrix}$。\n- $\\mathbf{R}_g = ($1.0$, -$2.0$, $0.5$)$。\n\n测试用例 $3$（单-AO闭壳层，无虚轨道；顺磁贡献消失）：\n- $N = 1$, $N_e = 2$。\n- $\\mathbf{S} = \\begin{bmatrix} $1.0$ \\end{bmatrix}$。\n- $\\mathbf{F} = \\begin{bmatrix} -$0.5$ \\end{bmatrix}$。\n- $\\mathbf{D}_{xx}^K = \\begin{bmatrix} $3.0\\times 10^{-5}$ \\end{bmatrix}$。\n- $\\mathbf{D}_{yy}^K = \\begin{bmatrix} $3.0\\times 10^{-5}$ \\end{bmatrix}$。\n- $\\mathbf{D}_{zz}^K = \\begin{bmatrix} $3.0\\times 10^{-5}$ \\end{bmatrix}$。\n- $\\mathbf{M}_x^K = \\begin{bmatrix} $0.0$ \\end{bmatrix}$, $\\mathbf{M}_y^K = \\begin{bmatrix} $0.0$ \\end{bmatrix}$, $\\mathbf{M}_z^K = \\begin{bmatrix} $0.0$ \\end{bmatrix}$。\n- $\\mathbf{L}_x = \\begin{bmatrix} $0.0$ \\end{bmatrix}$, $\\mathbf{L}_y = \\begin{bmatrix} $0.0$ \\end{bmatrix}$, $\\mathbf{L}_z = \\begin{bmatrix} $0.0$ \\end{bmatrix}$。\n- $\\mathbf{R}_g = ($0.0$, $0.0$, $0.0$)$。\n\n角度单位不适用。将每个用例的最终各向同性屏蔽值以百万分率（无量纲）表示，精确到小数点后六位，并将三个结果在单行上打印为方括号内的逗号分隔列表，例如 $[12.345678,23.456789,34.567890]$。", "solution": "该问题要求使用规范不变原子轨道（GIAO）计算由限制性Hartree-Fock（RHF）理论描述的闭壳层分子的各向同性核磁共振（NMR）屏蔽常数。所提供的数据包含各种算符在原子轨道（AO）基组中预先计算好的矩阵元。任务是实现屏蔽张量的抗磁和顺磁贡献的标准量子化学表达式，并将其组合以求得总的各向同性屏蔽值。该问题在科学上是合理的，并提供了一套完整的数据和清晰的计算流程，使其成为计算量子化学领域中一个有效且可解的问题。\n\n理论框架始于求解未微扰的电子结构问题，对于闭壳层RHF波函数，这由Roothaan-Hall广义本征值方程给出：\n$$\n\\mathbf{F}\\mathbf{C} = \\mathbf{S}\\mathbf{C}\\boldsymbol{\\varepsilon}\n$$\n此处，$\\mathbf{F}$ 是Fock矩阵，$\\mathbf{S}$ 是AO重叠矩阵，$\\mathbf{C}$ 是分子轨道（MO）系数矩阵，$\\boldsymbol{\\varepsilon}$ 是MO能量的对角矩阵。所有矩阵都在由 $N$ 个原子轨道构成的基组中表示。\n\n电子态由单粒子密度矩阵 $\\mathbf{P}$ 描述。对于一个有 $N_e$ 个电子的闭壳层体系，存在 $N_{\\mathrm{occ}} = N_e / 2$ 个双占据空间轨道。AO基组中的密度矩阵由这些占据轨道的MO系数 $\\mathbf{C}_{\\mathrm{occ}}$ 构建：\n$$\n\\mathbf{P} = 2\\,\\mathbf{C}_{\\mathrm{occ}} \\mathbf{C}_{\\mathrm{occ}}^{\\top}\n$$\n\n原子核 $K$ 处的NMR屏蔽张量 $\\boldsymbol{\\sigma}^K$ 是电子能量对外磁场 $\\mathbf{B}$ 和核磁矩 $\\boldsymbol{\\mu}_K$ 的混合二阶导数。在线性响应理论中，它可分为两个贡献：抗磁部分 $\\boldsymbol{\\sigma}_d^K$ 和顺磁部分 $\\boldsymbol{\\sigma}_p^K$。\n$$\n\\boldsymbol{\\sigma}^K = \\boldsymbol{\\sigma}_d^K + \\boldsymbol{\\sigma}_p^K\n$$\n\n对于笛卡尔分量 $u \\in \\{x, y, z\\}$，抗磁贡献 $\\sigma_{d,uu}^K$ 是相应二阶导数算符的基态期望值。给定该算符的AO矩阵表示 $\\mathbf{D}_{uu}^K$，抗磁屏蔽分量通过与密度矩阵的矩阵迹计算得出：\n$$\n\\sigma_{d,uu}^K = \\mathrm{Tr}(\\mathbf{P}\\,\\mathbf{D}_{uu}^K)\n$$\n\n顺磁贡献 $\\sigma_{p,uu}^K$ 源于占据轨道和虚（未占据）轨道因磁微扰而发生的一阶混合。问题为此项提供了一个基于独立粒子模型的态求和表达式。设 $\\mathbf{M}_u^K$ 是耦合到核磁矩 $\\boldsymbol{\\mu}_K$ 的 $u$ 分量的算符的AO矩阵，$\\mathbf{L}_u$ 是耦合到外磁场 $\\mathbf{B}$ 的 $u$ 分量的算符的AO矩阵。顺磁屏蔽分量由下式给出：\n$$\n\\sigma_{p,uu}^K = -2 \\sum_{i=1}^{N_{\\mathrm{occ}}} \\sum_{a=N_{\\mathrm{occ}}+1}^{N} \\frac{ \\tilde{M}_{u,ia}^K \\, \\tilde{L}_{u,ai} }{ \\varepsilon_{a} - \\varepsilon_{i} }\n$$\n其中 $i$ 索引占据MO，$a$ 索引虚MO。项 $\\tilde{M}_{u,ia}^K$ 和 $\\tilde{L}_{u,ai}$ 是微扰算符在MO基组中的矩阵元，通过变换AO矩阵获得：\n$$\n\\tilde{\\mathbf{M}}_u^K = \\mathbf{C}^{\\top} \\mathbf{M}_u^K \\mathbf{C} \\quad \\text{和} \\quad \\tilde{\\mathbf{L}}_u = \\mathbf{C}^{\\top} \\mathbf{L}_u \\mathbf{C}\n$$\n由于提供的AO矩阵 $\\mathbf{M}_u^K$ 和 $\\mathbf{L}_u$ 是实对称的，它们在MO基组中的表示 $\\tilde{\\mathbf{M}}_u^K$ 和 $\\tilde{\\mathbf{L}}_u$ 也是实对称的。因此，$\\tilde{L}_{u,ai} = \\tilde{L}_{u,ia}$。\n\n最后，总的各向同性屏蔽常数 $\\sigma_{\\mathrm{iso}}$ 是总屏蔽张量迹的三分之一。我们根据对角分量计算此值：\n$$\n\\sigma_{\\mathrm{iso}} = \\frac{1}{3} (\\sigma_{xx} + \\sigma_{yy} + \\sigma_{zz}) = \\frac{1}{3} \\sum_{u \\in \\{x,y,z\\}} (\\sigma_{d,uu}^K + \\sigma_{p,uu}^K)\n$$\n然后将结果转换为百万分率（ppm）以供报告：$\\sigma_{\\mathrm{ppm}} = 10^6 \\sigma_{\\mathrm{iso}}$。\n\n计算流程如下：\n1.  求解广义本征值问题 $\\mathbf{F}\\mathbf{C} = \\mathbf{S}\\mathbf{C}\\boldsymbol{\\varepsilon}$ 以找到MO能量 $\\varepsilon_p$ 和系数 $\\mathbf{C}$。这通过对称正交化AO基组来完成。首先，从 $\\mathbf{S}$ 的本征值和本征向量构造变换矩阵 $\\mathbf{X} = \\mathbf{S}^{-1/2}$。然后，将Fock矩阵变换到正交基组中，$\\mathbf{F}' = \\mathbf{X}^{\\top} \\mathbf{F} \\mathbf{X}$。\n2.  求解标准本征值问题 $\\mathbf{F}'\\mathbf{C}' = \\mathbf{C}'\\boldsymbol{\\varepsilon}$ 以得到正交MO系数 $\\mathbf{C}'$ 和能量 $\\boldsymbol{\\varepsilon}$。\n3.  将MO系数反变换回原始AO基组：$\\mathbf{C} = \\mathbf{X}\\mathbf{C}'$。得到的能量和系数矩阵的列必须按能量升序排序。\n4.  使用 $\\mathbf{C}$ 的前 $N_{\\mathrm{occ}} = N_e/2$ 列构建密度矩阵 $\\mathbf{P}$。\n5.  通过计算 $\\mathbf{P}$ 与每个给定 $\\mathbf{D}_{uu}^K$ 矩阵乘积的迹，来计算抗磁分量 $\\sigma_{d,uu}^K$。\n6.  首先将 $\\mathbf{M}_u^K$ 和 $\\mathbf{L}_u$ 矩阵变换到MO基组，然后评估态求和表达式，以计算顺磁分量 $\\sigma_{p,uu}^K$。\n7.  将总对角分量 $\\sigma_{uu}$ 相加，取平均得到 $\\sigma_{\\mathrm{iso}}$，再乘以 $10^6$ 以获得ppm单位的最终结果。\n\nGIAO方法确保计算出的屏蔽张量与规范原点 $\\mathbf{R}_g$ 无关。假定所提供的算符矩阵在GIAO框架内已正确构建。因此，向量 $\\mathbf{R}_g$ 并未在计算中显式使用，这一点由测试用例验证。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef calculate_shielding(N, Ne, S, F, D_xx, D_yy, D_zz, M_x, M_y, M_z, L_x, L_y, L_z, R_g):\n    \"\"\"\n    Calculates the isotropic NMR shielding constant using GIAO-RHF theory.\n    \"\"\"\n    # Number of occupied orbitals\n    N_occ = Ne // 2\n    \n    # Step 1-3: Solve the generalized eigenvalue problem using explicit symmetric orthonormalization.\n    # The problem statement specifies this procedure.\n    \n    # 1.a: Find eigenvalues (s_vals) and eigenvectors (U) of the overlap matrix S.\n    s_vals, U = np.linalg.eigh(S)\n    \n    # 1.b: Construct S^(-1/2)\n    s_inv_sqrt = np.diag(s_vals**-0.5)\n    X = U @ s_inv_sqrt @ U.T # Transformation matrix S^(-1/2)\n    \n    # 2: Transform F to the orthonormal basis\n    F_prime = X.T @ F @ X\n    \n    # 3.a: Solve the standard eigenvalue problem for F_prime\n    eps, C_prime = np.linalg.eigh(F_prime) # eps are MO energies, C_prime are coeffs in ortho basis\n    \n    # eps and C_prime are already sorted by eigenvalue.\n    \n    # 3.b: Back-transform coefficients to the AO basis\n    C = X @ C_prime\n    \n    # Step 4: Build the closed-shell density matrix\n    C_occ = C[:, :N_occ]\n    P = 2 * (C_occ @ C_occ.T)\n    \n    # Step 5: Compute the diamagnetic part of the shielding tensor\n    sigma_d_xx = np.trace(P @ D_xx)\n    sigma_d_yy = np.trace(P @ D_yy)\n    sigma_d_zz = np.trace(P @ D_zz)\n    \n    # Step 6: Compute the paramagnetic part of the shielding tensor\n    sigma_p_xx, sigma_p_yy, sigma_p_zz = 0.0, 0.0, 0.0\n    \n    # Only if there are virtual orbitals\n    if N > N_occ:\n        # Transform M and L operators to MO basis\n        M_x_mo = C.T @ M_x @ C\n        M_y_mo = C.T @ M_y @ C\n        M_z_mo = C.T @ M_z @ C\n        L_x_mo = C.T @ L_x @ C\n        L_y_mo = C.T @ L_y @ C\n        L_z_mo = C.T @ L_z @ C\n        \n        # Sum-over-states expression\n        for i in range(N_occ):\n            for a in range(N_occ, N):\n                energy_diff = eps[a] - eps[i]\n                if np.abs(energy_diff) > 1e-12: # Avoid division by zero\n                    # Since operators are symmetric, L_ai = L_ia\n                    sigma_p_xx -= 2 * M_x_mo[i, a] * L_x_mo[i, a] / energy_diff\n                    sigma_p_yy -= 2 * M_y_mo[i, a] * L_y_mo[i, a] / energy_diff\n                    sigma_p_zz -= 2 * M_z_mo[i, a] * L_z_mo[i, a] / energy_diff\n\n    # Step 7: Form the total shielding tensor and compute the isotropic value\n    sigma_xx = sigma_d_xx + sigma_p_xx\n    sigma_yy = sigma_d_yy + sigma_p_yy\n    sigma_zz = sigma_d_zz + sigma_p_zz\n    \n    sigma_iso = (sigma_xx + sigma_yy + sigma_zz) / 3.0\n    \n    # Convert to parts per million (ppm)\n    sigma_ppm = 1e6 * sigma_iso\n    \n    return sigma_ppm\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1\n        {\n            \"N\": 2, \"Ne\": 2,\n            \"S\": np.array([[1.0, 0.05], [0.05, 1.0]]),\n            \"F\": np.array([[-0.7, -0.15], [-0.15, 0.2]]),\n            \"D_xx\": np.array([[3.1e-5, 0.2e-5], [0.2e-5, 2.9e-5]]),\n            \"D_yy\": np.array([[3.0e-5, 0.1e-5], [0.1e-5, 3.0e-5]]),\n            \"D_zz\": np.array([[3.2e-5, -0.1e-5], [-0.1e-5, 2.8e-5]]),\n            \"M_x\": np.array([[0.0, 1.5e-3], [1.5e-3, 0.0]]),\n            \"M_y\": np.array([[0.0, -1.1e-3], [-1.1e-3, 0.0]]),\n            \"M_z\": np.array([[0.0, 0.9e-3], [0.9e-3, 0.0]]),\n            \"L_x\": np.array([[0.0, 2.0e-3], [2.0e-3, 0.0]]),\n            \"L_y\": np.array([[0.0, -1.8e-3], [-1.8e-3, 0.0]]),\n            \"L_z\": np.array([[0.0, 1.6e-3], [1.6e-3, 0.0]]),\n            \"R_g\": np.array([0.0, 0.0, 0.0])\n        },\n        # Test case 2\n        {\n            \"N\": 2, \"Ne\": 2,\n            \"S\": np.array([[1.0, 0.05], [0.05, 1.0]]),\n            \"F\": np.array([[-0.7, -0.15], [-0.15, 0.2]]),\n            \"D_xx\": np.array([[3.1e-5, 0.2e-5], [0.2e-5, 2.9e-5]]),\n            \"D_yy\": np.array([[3.0e-5, 0.1e-5], [0.1e-5, 3.0e-5]]),\n            \"D_zz\": np.array([[3.2e-5, -0.1e-5], [-0.1e-5, 2.8e-5]]),\n            \"M_x\": np.array([[0.0, 1.5e-3], [1.5e-3, 0.0]]),\n            \"M_y\": np.array([[0.0, -1.1e-3], [-1.1e-3, 0.0]]),\n            \"M_z\": np.array([[0.0, 0.9e-3], [0.9e-3, 0.0]]),\n            \"L_x\": np.array([[0.0, 2.0e-3], [2.0e-3, 0.0]]),\n            \"L_y\": np.array([[0.0, -1.8e-3], [-1.8e-3, 0.0]]),\n            \"L_z\": np.array([[0.0, 1.6e-3], [1.6e-3, 0.0]]),\n            \"R_g\": np.array([1.0, -2.0, 0.5])\n        },\n        # Test case 3\n        {\n            \"N\": 1, \"Ne\": 2,\n            \"S\": np.array([[1.0]]),\n            \"F\": np.array([[-0.5]]),\n            \"D_xx\": np.array([[3.0e-5]]),\n            \"D_yy\": np.array([[3.0e-5]]),\n            \"D_zz\": np.array([[3.0e-5]]),\n            \"M_x\": np.array([[0.0]]), \"M_y\": np.array([[0.0]]), \"M_z\": np.array([[0.0]]),\n            \"L_x\": np.array([[0.0]]), \"L_y\": np.array([[0.0]]), \"L_z\": np.array([[0.0]]),\n            \"R_g\": np.array([0.0, 0.0, 0.0])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_shielding(\n            case[\"N\"], case[\"Ne\"], case[\"S\"], case[\"F\"],\n            case[\"D_xx\"], case[\"D_yy\"], case[\"D_zz\"],\n            case[\"M_x\"], case[\"M_y\"], case[\"M_z\"],\n            case[\"L_x\"], case[\"L_y\"], case[\"L_z\"],\n            case[\"R_g\"]\n        )\n        results.append(f\"{result:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2893981"}]}