{"hands_on_practices": [{"introduction": "在深入研究复杂的模拟方法之前，从统计力学角度理解平均力势（Potential of Mean Force, PMF）的严格定义和计算方式至关重要。本练习将通过一个简单的、可解析求解的系统，为您提供亲手实践基础理论的机会。通过构建约束系综的定义并应用热力学积分，您将巩固对PMF真正含义的理解。[@problem_id:2685152]", "problem": "考虑一个二维经典系统，其笛卡尔坐标为 $x$ 和 $y$，温度为 $T$，逆温度为 $\\beta = 1/(k_{\\mathrm{B}}T)$，势能为\n$$\nU(x,y) \\;=\\; \\tfrac{1}{2}\\,k_{x}\\,x^{2} \\;+\\; \\tfrac{1}{2}\\,k_{y}\\,\\bigl(y - \\alpha\\,x\\bigr)^{2},\n$$\n其中 $k_{x} > 0$，$k_{y} > 0$ 和 $\\alpha$ 是常数。令集体变量为笛卡尔坐标 $s(x,y) = x$。沿 $s$ 的平均力势 $F(s)$ 在固定 $s$ 的约束（条件）平衡系综下定义，其定义可相差一个加性常数。热力学积分恒等式将自由能差与约束平均广义力联系起来，其形式为\n$$\nF(b) - F(a) \\;=\\; \\int_{a}^{b} \\mathrm{d}s \\,\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s},\n$$\n其中对于笛卡尔集体变量 $s=x$，应将 $\\tfrac{\\partial U}{\\partial s}$ 解释为在超曲面 $x=s$ 上求值的 $\\tfrac{\\partial U}{\\partial x}$。\n\n从正则系综和条件期望的定义出发，完成以下任务：\n\n1. 将固定 $s$ 时可观测量 $A(x,y)$ 的约束系综平均 $\\langle A \\rangle_{s}$ 定义为构型积分之比，该比值明确包含用于施加完整约束 $s(x,y)=s$ 的狄拉克δ函数。仔细考虑将完整构型空间积分限制到超曲面 $s(x,y)=s$ 时出现的适当的曲面测度。将您的定义具体化到当前的笛卡尔情况，并尽可能地进行简化。\n\n2. 使用您的定义，以闭合形式计算该系统的约束平均 $\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s}$，并保留所有参数为符号形式。\n\n3. 使用热力学积分求得 $F(s)$，选择参考点使得 $F(0)=0$，从而唯一确定 $F(s)$。将您的最终答案表示为关于 $k_{x}$ 和 $s$ 的闭合形式解析表达式。最终表达式中不要包含单位。", "solution": "该问题陈述具有科学依据，提法恰当且客观。它提出了统计力学中一个标准的理论问题，即计算具有二次势能函数的系统的平均力势。所有必要的参数和条件都已给出，且任务结构逻辑清晰。该问题有效，我们将着手进行求解。\n\n按照问题陈述的要求，解答分为三个部分。\n\n1. 约束系综平均的定义。\n\n可观测量 $A(q)$ 的正则系综平均由下式给出，其中 $q$ 代表所有坐标的集合：\n$$\n\\langle A \\rangle = \\frac{\\int A(q) \\exp(-\\beta U(q)) \\, dq}{\\int \\exp(-\\beta U(q)) \\, dq},\n$$\n其中 $U(q)$ 是势能，$\\beta = 1/(k_{\\mathrm{B}}T)$ 是逆温度，积分遍及整个构型空间。\n\n为了定义在集体变量 $s(q)$ 的一个固定值 $s$ 上的约束系综平均 $\\langle A \\rangle_{s}$，我们必须将构型空间限制在由完整约束 $s(q)=s$ 定义的超曲面上。这在形式上是通过引入狄拉克δ函数 $\\delta(s(q)-s)$ 来实现的。在约束系综中，发现系统处于特定构型 $q$ 的概率密度正比于 $\\exp(-\\beta U(q)) \\delta(s(q)-s)$。\n\n因此，可观测量 $A(q)$ 的约束系综平均定义为积分之比：\n$$\n\\langle A \\rangle_{s} = \\frac{\\int A(q) \\exp(-\\beta U(q)) \\delta(s(q)-s) \\, dq}{\\int \\exp(-\\beta U(q)) \\delta(s(q)-s) \\, dq}.\n$$\n在当前情况下，构型由笛卡尔坐标 $q=(x,y)$ 指定，因此 $dq=dx\\,dy$。集体变量是 $s(x,y)=x$。因此，约束为 $x=s$，δ函数为 $\\delta(x-s)$。\n\n将这些代入一般定义，我们得到：\n$$\n\\langle A \\rangle_{s} = \\frac{\\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} A(x,y) \\exp[-\\beta U(x,y)] \\delta(x-s) \\, dx \\, dy}{\\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\exp[-\\beta U(x,y)] \\delta(x-s) \\, dx \\, dy}.\n$$\n现在我们可以使用狄拉克δ函数的筛选性质 $\\int f(x) \\delta(x-s) \\, dx = f(s)$ 来执行对 $x$ 的积分。这得到：\n$$\n\\langle A \\rangle_{s} = \\frac{\\int_{-\\infty}^{\\infty} A(s,y) \\exp[-\\beta U(s,y)] \\, dy}{\\int_{-\\infty}^{\\infty} \\exp[-\\beta U(s,y)] \\, dy}.\n$$\n这就是在该笛卡尔情况下约束平均的简化定义。在超曲面 $x=s$ 上的曲面测度元 $d\\Sigma$ 就是 $dy$。一般的曲面元包含一个雅可比因子 $d\\Sigma = |\\nabla s|^{-1} dq_s$，其中 $dq_s$ 是曲面的体积元。此处，$s(x,y)=x$，所以 $\\nabla s = (1,0)$ 且 $|\\nabla s| = 1$。雅可比因子为1，这与我们的直接简化是一致的。\n\n2. 约束平均广义力的计算。\n\n沿集体变量 $s=x$ 的广义力是 $\\frac{\\partial U}{\\partial s}$，它被解释为在超曲面 $x=s$ 上求值的 $\\frac{\\partial U}{\\partial x}$。首先，我们计算势能 $U(x,y) = \\tfrac{1}{2}\\,k_{x}\\,x^{2} + \\tfrac{1}{2}\\,k_{y}\\,(y - \\alpha\\,x)^{2}$ 的偏导数：\n$$\n\\frac{\\partial U}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ \\tfrac{1}{2}\\,k_{x}\\,x^{2} + \\tfrac{1}{2}\\,k_{y}\\,(y - \\alpha\\,x)^{2} \\right] = k_{x}\\,x + k_{y}(y-\\alpha x)(-\\alpha) = k_{x}\\,x - \\alpha k_{y}(y - \\alpha x).\n$$\n我们需要计算约束平均 $\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s}$。需要求平均的可观测量是 $\\frac{\\partial U}{\\partial x}$ 的表达式，其中 $x$ 被替换为 $s$：\n$$\nA(s,y) = \\left. \\frac{\\partial U}{\\partial x} \\right|_{x=s} = k_{x}s - \\alpha k_{y}(y - \\alpha s).\n$$\n使用第1部分的定义，平均值为：\n$$\n\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s} = \\frac{\\int_{-\\infty}^{\\infty} [k_{x}s - \\alpha k_{y}(y - \\alpha s)] \\exp[-\\beta U(s,y)] \\, dy}{\\int_{-\\infty}^{\\infty} \\exp[-\\beta U(s,y)] \\, dy},\n$$\n其中 $U(s,y) = \\tfrac{1}{2}\\,k_{x}\\,s^{2} + \\tfrac{1}{2}\\,k_{y}\\,(y - \\alpha s)^{2}$。\n项 $\\exp[-\\beta (\\tfrac{1}{2} k_x s^2)]$ 相对于积分变量 $y$ 是一个常数，并将从分子和分母中消去。表达式简化为：\n$$\n\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s} = \\frac{\\int_{-\\infty}^{\\infty} [k_{x}s - \\alpha k_{y}(y - \\alpha s)] \\exp[-\\beta \\tfrac{1}{2} k_{y}(y-\\alpha s)^2] \\, dy}{\\int_{-\\infty}^{\\infty} \\exp[-\\beta \\tfrac{1}{2} k_{y}(y-\\alpha s)^2] \\, dy}.\n$$\n我们可以将其分成两项：\n$$\n\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s} = \\frac{\\int_{-\\infty}^{\\infty} k_{x}s \\exp[\\dots] \\, dy}{\\int_{-\\infty}^{\\infty} \\exp[\\dots] \\, dy} - \\frac{\\int_{-\\infty}^{\\infty} \\alpha k_{y}(y - \\alpha s) \\exp[\\dots] \\, dy}{\\int_{-\\infty}^{\\infty} \\exp[\\dots] \\, dy}.\n$$\n对于第一项，$k_x s$ 是一个常数，所以可以从积分中提出，然后与分母相消，剩下 $k_x s$。\n对于第二项，我们考虑积分 $\\int_{-\\infty}^{\\infty} (y - \\alpha s) \\exp[-\\beta \\tfrac{1}{2} k_{y}(y-\\alpha s)^2] \\, dy$。令 $z = y - \\alpha s$，则 $dy = dz$。积分变为 $\\int_{-\\infty}^{\\infty} z \\exp(-\\frac{\\beta k_y}{2} z^2) \\, dz$。被积函数 $f(z) = z \\exp(-C z^2)$（其中 $C = \\frac{\\beta k_y}{2} > 0$）是 $z$ 的奇函数。奇函数在对称区间 $(-\\infty, \\infty)$ 上的积分为零。因此，第二项为零。\n结合结果，约束平均力为：\n$$\n\\bigl\\langle \\tfrac{\\partial U}{\\partial s} \\bigr\\rangle_{s} = k_{x}s.\n$$\n\n3. 通过热力学积分求得平均力势 $F(s)$。\n\n平均力势 $F(s)$ 是通过从一个参考点开始，沿集体变量对平均力进行积分得到的。热力学积分恒等式给出如下：\n$$\nF(b) - F(a) = \\int_{a}^{b} \\bigl\\langle \\tfrac{\\partial U}{\\partial s'} \\bigr\\rangle_{s'} \\, ds'.\n$$\n我们设置 $a=0$ 和 $b=s$，并使用第2部分的结果 $\\bigl\\langle \\tfrac{\\partial U}{\\partial s'} \\bigr\\rangle_{s'} = k_{x}s'$。\n$$\nF(s) - F(0) = \\int_{0}^{s} k_{x}s' \\, ds'.\n$$\n执行这个初等积分：\n$$\n\\int_{0}^{s} k_{x}s' \\, ds' = k_{x} \\left[ \\frac{(s')^{2}}{2} \\right]_{0}^{s} = k_{x} \\left( \\frac{s^{2}}{2} - \\frac{0^{2}}{2} \\right) = \\frac{1}{2}k_{x}s^{2}.\n$$\n所以，我们有 $F(s) - F(0) = \\frac{1}{2}k_{x}s^{2}$。问题指定了参考值 $F(0)=0$，这唯一地确定了平均力势。\n代入 $F(0)=0$ 得到最终表达式：\n$$\nF(s) = \\frac{1}{2}k_{x}s^{2}.\n$$\n这个结果与参数 $\\alpha$ 和 $k_y$ 无关。这是因为对于任何固定的 $x=s$，对 $y$ 自由度积分对自由能的贡献是一个与 $s$ 无关的常数。这个常数被吸收到平均力势的参考值中。PMF（平均力势）对 $s$ 的依赖性完全来自于势能中无法通过对其他自由度积分来平均掉的部分。在本例中，即为项 $\\frac{1}{2}k_x x^2$。", "answer": "$$\\boxed{\\frac{1}{2} k_{x} s^{2}}$$", "id": "2685152"}, {"introduction": "良好调节元动力学（Well-Tempered Metadynamics）是一种强大的工具，但其准确性依赖于模拟参数的选择。本练习探讨了一个关键的实际问题：用于构建偏置势的高斯“山丘”（Gaussian hills）的有限宽度所引入的系统误差。您将通过解析推导该误差，并将其应用于一个模型系统，从而深入了解模拟参数的选择如何直接影响重建的自由能形貌的准确性。[@problem_id:2685048]", "problem": "一个一维集体变量 $s$ 用于描述分子系统在温度 $T$ 下的慢转变。沿 $s$ 的均力势（自由能）由正则边际分布 $P_{0}(s)$ 定义，关系为 $F(s) = -\\beta^{-1} \\ln P_{0}(s) + C$，其中 $\\beta = (k_{\\mathrm{B}} T)^{-1}$，$k_{\\mathrm{B}}$ 是玻尔兹曼常数。进行了一次偏置因子为 $\\gamma > 1$ 的 Well-Tempered Metadynamics (WTMetaD) 模拟，在 $s$ 上沉积宽度为 $\\sigma$ 的高斯山，并假定其已收敛到一个稳态偏置 $V_{\\infty}(s)$。\n\n从正则定义出发，并利用 WTMetaD 中沿 $s$ 的长时间稳态分布满足 $P_{V}(s) \\propto \\left[P_{0}(s)\\right]^{1/\\gamma}$ 这一已知性质，完成以下任务：\n\n1. 在 $\\sigma \\to 0$ 的极限下，推导 $F(s)$ 和 $V_{\\infty}(s)$ 之间的关系，并写出一个以 $V_{\\infty}(s)$、$\\gamma$ 和 $\\beta$ 表示的显式重构公式 $F_{\\mathrm{rec}}(s)$（可相差一个加性常数）。\n\n2. 将有限的高斯山宽度 $\\sigma$ 视为引起 $\\exp(-\\beta F)$ 的高斯卷积。在一维情况下，进行到首个非零阶的小 $\\sigma$ 展开，以获得朴素重构（忽略 $\\sigma$）与真实 $F(s)$ 之间的、依赖于 $s$ 的系统性偏差 $\\Delta(s)$。你的推导必须从以下定义开始：\n$$\nF_{\\sigma}(s) \\equiv -\\beta^{-1} \\ln \\int_{-\\infty}^{\\infty} \\mathrm{d}s' \\, \\exp\\!\\left[-\\beta F(s')\\right] \\, \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\!\\left[-\\frac{(s-s')^{2}}{2\\sigma^{2}}\\right] + C',\n$$\n并通过对 $\\sigma$ 进行对足够光滑的 $F(s)$ 有效的受控泰勒展开来继续。\n\n3. 考虑一个特定的双阱自由能：\n$$\nF(s) = \\Delta U \\left(\\frac{s^{4}}{4 a^{4}} - \\frac{s^{2}}{2 a^{2}}\\right) + C'',\n$$\n其势阱位于 $s=\\pm a$，势垒位于 $s=0$。使用你对 $\\Delta(s)$ 的结果，计算由朴素 WTMetaD 重构（忽略有限 $\\sigma$）得到的势垒高度的带符号系统误差，其定义为：\n$$\n\\delta \\Delta F^{\\ddagger} \\equiv \\big[F_{\\mathrm{naive}}(0) - F_{\\mathrm{true}}(0)\\big] - \\big[F_{\\mathrm{naive}}(a) - F_{\\mathrm{true}}(a)\\big].\n$$\n使用参数 $\\Delta U = 12\\,\\mathrm{kJ\\,mol^{-1}}$，$a = 0.25\\,\\mathrm{nm}$，$\\sigma = 0.05\\,\\mathrm{nm}$，$T = 300\\,\\mathrm{K}$ 和 $\\gamma = 10$。\n\n将 $\\delta \\Delta F^{\\ddagger}$ 的最终答案以 $\\mathrm{kJ\\,mol^{-1}}$ 为单位表示，并四舍五入到三位有效数字。", "solution": "所提出的问题是有效的、有科学依据的，并且在统计力学和增强采样模拟理论的框架内是适定的。我们将分三部分进行求解。\n\n均力势 (PMF) $F(s)$ 与沿集体变量 $s$ 的正则概率分布 $P_{0}(s)$ 之间的基本关系由 $F(s) = -\\beta^{-1} \\ln P_{0}(s) + C$ 给出，其中 $\\beta = (k_{\\mathrm{B}} T)^{-1}$，$C$ 是一个任意常数。这等价于 $P_{0}(s) \\propto \\exp(-\\beta F(s))$。\n在收敛的 Well-Tempered Metadynamics (WTMetaD) 模拟中，由于存在稳态偏置势 $V_{\\infty}(s)$，系统会采样一个修正的概率分布 $P_{V}(s)$。该分布由 $P_{V}(s) \\propto \\exp(-\\beta[F(s) + V_{\\infty}(s)])$ 给出。问题陈述了 WTMetaD 的一个关键性质：$P_{V}(s) \\propto [P_{0}(s)]^{1/\\gamma}$，其中 $\\gamma$ 是偏置因子。\n\n第一部分：在理想极限（$\\sigma \\to 0$）下推导 $F(s)$ 的重构公式。\n\n我们令偏置分布 $P_{V}(s)$ 的两个表达式相等：\n$$\n\\exp(-\\beta[F(s) + V_{\\infty}(s)]) \\propto \\left[\\exp(-\\beta F(s))\\right]^{1/\\gamma} = \\exp\\left(-\\frac{\\beta}{\\gamma} F(s)\\right)\n$$\n对两边取自然对数，得到势能之间的一个线性关系（相差一个加性常数）：\n$$\n-\\beta[F(s) + V_{\\infty}(s)] = -\\frac{\\beta}{\\gamma} F(s) + \\mathrm{const.}\n$$\n我们重新整理这个方程，以用收敛的偏置势 $V_{\\infty}(s)$ 来求解均力势 $F(s)$。\n$$\n\\beta V_{\\infty}(s) = -\\frac{\\beta}{\\gamma} F(s) + \\beta F(s) + \\mathrm{const'} = \\beta F(s) \\left(1 - \\frac{1}{\\gamma}\\right) + \\mathrm{const'}\n$$\n$$\nV_{\\infty}(s) = \\left(\\frac{\\gamma - 1}{\\gamma}\\right) F(s) + \\mathrm{const''}\n$$\n这表明，收敛的偏置势在相差一个标度因子和常数的情况下，等于真实均力势的负值，这与预期相符，因为偏置势的建立是为了抵消自由能形貌。自由能的重构公式 $F_{\\mathrm{rec}}(s)$ 通过反转此关系得到：\n$$\nF_{\\mathrm{rec}}(s) = \\frac{\\gamma}{\\gamma - 1} V_{\\infty}(s) + \\mathrm{const'''}\n$$\n这就是在无限窄高斯山（$\\sigma \\to 0$）极限下有效的、所求的重构公式。\n\n第二部分：推导有限 $\\sigma$ 下的系统性偏差 $\\Delta(s)$。\n\n对于有限的高斯宽度 $\\sigma$，沉积的偏置势并不能完美地抵消真实的均力势。相反，它抵消的是一个“平滑”或卷积后的均力势版本。被重构出来的有效均力势，我们称之为朴素重构 $F_{\\mathrm{naive}}(s)$，是这个卷积后均力势 $F_{\\sigma}(s)$ 的一个估计量。问题将 $F_{\\sigma}(s)$ 定义为：\n$$\nF_{\\sigma}(s) = -\\beta^{-1} \\ln \\int_{-\\infty}^{\\infty} \\mathrm{d}s' \\, \\exp[-\\beta F(s')] \\, \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\left[-\\frac{(s-s')^{2}}{2\\sigma^{2}}\\right] + C'\n$$\n该积分表示 $g(s) = \\exp[-\\beta F(s)]$ 与高斯核 $K_{\\sigma}(s)$ 的卷积。我们通过对 $F(s')$ 在 $s' = s$ 附近进行泰勒展开来分析这个积分。令 $u = s' - s$。\n$$\nF(s') = F(s) + F'(s) u + \\frac{1}{2} F''(s) u^{2} + O(u^{3})\n$$\n将此代入积分：\n$$\nI(s) = \\int_{-\\infty}^{\\infty} \\mathrm{d}u \\, \\exp\\left[-\\beta \\left(F(s) + F'(s) u + \\frac{1}{2} F''(s) u^{2} + \\dots\\right)\\right] \\, \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\left[-\\frac{u^{2}}{2\\sigma^{2}}\\right]\n$$\n提出与 $u$ 无关的项：\n$$\nI(s) = \\exp[-\\beta F(s)] \\int_{-\\infty}^{\\infty} \\mathrm{d}u \\, \\exp\\left[-\\beta \\left(F'(s) u + \\frac{1}{2} F''(s) u^{2} + \\dots\\right)\\right] \\frac{\\exp\\left[-u^{2}/(2\\sigma^{2})\\right]}{\\sqrt{2\\pi}\\,\\sigma}\n$$\n对于小 $\\sigma$，高斯核在 $u=0$ 处有尖峰，因此我们可以对另一个指数项进行小 $u$ 展开：\n$$\n\\exp\\left[-\\beta \\left(F'(s) u + \\frac{1}{2} F''(s) u^{2} + \\dots\\right)\\right] \\approx 1 - \\beta F'(s) u + \\left( \\frac{1}{2} \\beta^{2} [F'(s)]^{2} - \\frac{1}{2} \\beta F''(s) \\right) u^{2} + \\dots\n$$\n该积分变成了此展开式在均值为 $0$、方差为 $\\sigma^{2}$ 的高斯分布下的期望值。该分布的矩为 $\\langle u \\rangle = 0$，$\\langle u^{2} \\rangle = \\sigma^{2}$，$\\langle u^{3} \\rangle = 0$ 等。\n$$\nI(s) \\approx \\exp[-\\beta F(s)] \\left( 1 - \\beta F'(s) \\langle u \\rangle + \\left( \\frac{1}{2} \\beta^{2} [F'(s)]^{2} - \\frac{1}{2} \\beta F''(s) \\right) \\langle u^{2} \\rangle \\right)\n$$\n$$\nI(s) \\approx \\exp[-\\beta F(s)] \\left( 1 + \\frac{\\sigma^{2}}{2} \\left( \\beta^{2} [F'(s)]^{2} - \\beta F''(s) \\right) \\right)\n$$\n现在我们将此结果代回到 $F_{\\sigma}(s)$ 的表达式中：\n$$\nF_{\\sigma}(s) \\approx -\\beta^{-1} \\ln \\left[ \\exp[-\\beta F(s)] \\left( 1 + \\frac{\\sigma^{2}}{2} \\left( \\beta^{2} [F'(s)]^{2} - \\beta F''(s) \\right) \\right) \\right] + C'\n$$\n使用 $\\ln(ab) = \\ln(a) + \\ln(b)$以及对于小 $x$ 的近似 $\\ln(1+x) \\approx x$：\n$$\nF_{\\sigma}(s) \\approx -\\beta^{-1} \\left[ -\\beta F(s) + \\ln \\left( 1 + \\frac{\\sigma^{2}}{2} \\left( \\beta^{2} [F'(s)]^{2} - \\beta F''(s) \\right) \\right) \\right] + C'\n$$\n$$\nF_{\\sigma}(s) \\approx F(s) - \\beta^{-1} \\left[ \\frac{\\sigma^{2}}{2} \\left( \\beta^{2} [F'(s)]^{2} - \\beta F''(s) \\right) \\right] + C''\n$$\n$$\nF_{\\sigma}(s) \\approx F(s) + \\frac{\\sigma^{2}}{2} \\left( F''(s) - \\beta [F'(s)]^{2} \\right) + C''\n$$\n系统性偏差为 $\\Delta(s) = F_{\\mathrm{naive}}(s) - F_{\\mathrm{true}}(s)$。由于 $F_{\\mathrm{naive}}(s) \\approx F_{\\sigma}(s)$ 且 $F_{\\mathrm{true}}(s) = F(s)$，我们有：\n$$\n\\Delta(s) = \\frac{\\sigma^{2}}{2} \\left( F''(s) - \\beta [F'(s)]^{2} \\right)\n$$\n这是首个非零阶（$\\sigma^2$）修正项。\n\n第三部分：计算势垒高度的带符号系统误差。\n\n势垒高度的误差定义为 $\\delta \\Delta F^{\\ddagger} \\equiv [F_{\\mathrm{naive}}(0) - F_{\\mathrm{true}}(0)] - [F_{\\mathrm{naive}}(a) - F_{\\mathrm{true}}(a)]$。这等于 $\\Delta(0) - \\Delta(a)$。\n给定的均力势为 $F(s) = \\Delta U (\\frac{s^{4}}{4 a^{4}} - \\frac{s^{2}}{2 a^{2}}) + C''$。我们计算其一阶和二阶导数：\n$$\nF'(s) = \\Delta U \\left( \\frac{s^{3}}{a^{4}} - \\frac{s}{a^{2}} \\right)\n$$\n$$\nF''(s) = \\Delta U \\left( \\frac{3s^{2}}{a^{4}} - \\frac{1}{a^{2}} \\right)\n$$\n我们在势垒顶端（$s=0$）和势阱中（$s=a$）计算这些导数的值：\n当 $s=0$ 时：\n$F'(0) = 0$\n$F''(0) = \\Delta U (0 - \\frac{1}{a^{2}}) = -\\frac{\\Delta U}{a^{2}}$\n当 $s=a$ 时：\n$F'(a) = \\Delta U (\\frac{a^{3}}{a^{4}} - \\frac{a}{a^{2}}) = 0$\n$F''(a) = \\Delta U (\\frac{3a^{2}}{a^{4}} - \\frac{1}{a^{2}}) = \\Delta U (\\frac{3}{a^{2}} - \\frac{1}{a^{2}}) = \\frac{2\\Delta U}{a^{2}}$\n现在我们使用第二部分的公式计算 $\\Delta(0)$ 和 $\\Delta(a)$：\n$$\n\\Delta(0) = \\frac{\\sigma^{2}}{2} \\left( F''(0) - \\beta [F'(0)]^{2} \\right) = \\frac{\\sigma^{2}}{2} \\left( -\\frac{\\Delta U}{a^{2}} - 0 \\right) = -\\frac{\\sigma^{2} \\Delta U}{2 a^{2}}\n$$\n$$\n\\Delta(a) = \\frac{\\sigma^{2}}{2} \\left( F''(a) - \\beta [F'(a)]^{2} \\right) = \\frac{\\sigma^{2}}{2} \\left( \\frac{2\\Delta U}{a^{2}} - 0 \\right) = \\frac{\\sigma^{2} \\Delta U}{a^{2}}\n$$\n注意，由于我们是在均力势的驻点处计算误差，涉及 $\\beta$ 的项为零。\n势垒高度的系统误差为：\n$$\n\\delta \\Delta F^{\\ddagger} = \\Delta(0) - \\Delta(a) = -\\frac{\\sigma^{2} \\Delta U}{2 a^{2}} - \\frac{\\sigma^{2} \\Delta U}{a^{2}} = -\\frac{3 \\sigma^{2} \\Delta U}{2 a^{2}}\n$$\n现在，我们代入给定的数值：$\\Delta U = 12\\,\\mathrm{kJ\\,mol^{-1}}$，$a = 0.25\\,\\mathrm{nm}$，以及 $\\sigma = 0.05\\,\\mathrm{nm}$。\n$$\n\\delta \\Delta F^{\\ddagger} = -\\frac{3 \\times (0.05\\,\\mathrm{nm})^{2} \\times (12\\,\\mathrm{kJ\\,mol^{-1}})}{2 \\times (0.25\\,\\mathrm{nm})^{2}}\n$$\n$$\n\\delta \\Delta F^{\\ddagger} = -\\frac{3 \\times 0.0025}{2 \\times 0.0625} \\times 12\\,\\mathrm{kJ\\,mol^{-1}} = -\\frac{3}{2} \\left(\\frac{0.05}{0.25}\\right)^{2} \\times 12\\,\\mathrm{kJ\\,mol^{-1}}\n$$\n$$\n\\delta \\Delta F^{\\ddagger} = -\\frac{3}{2} \\left(\\frac{1}{5}\\right)^{2} \\times 12\\,\\mathrm{kJ\\,mol^{-1}} = -\\frac{3}{2} \\times \\frac{1}{25} \\times 12\\,\\mathrm{kJ\\,mol^{-1}}\n$$\n$$\n\\delta \\Delta F^{\\ddagger} = -\\frac{36}{50}\\,\\mathrm{kJ\\,mol^{-1}} = -0.72\\,\\mathrm{kJ\\,mol^{-1}}\n$$\n四舍五入到三位有效数字，最终结果是 $-0.720\\,\\mathrm{kJ\\,mol^{-1}}$。负号表示有限的高斯山宽度导致对自由能势垒高度的系统性低估。", "answer": "$$\n\\boxed{-0.720}\n$$", "id": "2685048"}, {"introduction": "如果没有对其不确定性的估计，计算出的自由能曲线是不完整的。本练习聚焦于自助法（bootstrap method），这是一种从相关联的模拟数据中确定置信区间的稳健统计技术。通过思考针对伞形采样的正确流程，您将学习如何恰当地处理统计抽样和时间相关性，这是产出可靠且可复现的科学结果的一项关键技能。[@problem_id:2685134]", "problem": "在一个温度为 $T$ 的分子系统中，沿着一个标量集体变量 $s(x)$ 进行研究。其平均力势 (PMF) 通过正则系综定义为 $F(s) = -k_{\\mathrm{B}} T \\ln p(s) + C$，其中 $p(s)$ 是 $s$ 的无偏边缘密度，$C$ 是一个任意常数。为了增强采样，在 $K$ 个重叠的窗口中执行伞形采样，并施加谐波偏置 $U_k(s) = \\tfrac{1}{2} k_k (s - s_k^\\star)^2$。在窗口 $k$ 中，在总势能 $U(x) + U_k(s(x))$ 下收集到一个时间序列 $\\{s_{k,t}\\}_{t=1}^{N_k}$，这会产生相关样本，其可观测量 $s$ 的积分自相关时间为 $\\tau_k$。无偏的 $F(s)$ 通过加权直方图分析方法 (WHAM) 或多态 Bennett 接受率方法 (MBAR) 进行估计，这两种方法结合所有窗口的信息，从有偏数据中重构 $p(s)$。\n\n要求您为 $F(s)$ 获取逐点的 95% 置信区间，该区间需要考虑有限样本不确定性和时间相关性。从第一性原理出发，回顾以下几点：(i) 正则分布为 $p(x) \\propto \\exp[-\\beta U(x)]$，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$；(ii) 施加偏置会通过 $\\exp[-\\beta U_k(s)]$ 修改采样权重；(iii) 自助法通过以一种尊重数据生成过程的方式对数据进行重采样，来近似估计量的采样分布，这包括了相关结构和按不同采样条件进行的分层。\n\n下列哪种方案能利用上述伞形采样数据，通过 WHAM 或 MBAR 为 $F(s)$ 正确构建统计上可靠的自助法置信区间？\n\nA. 对每个窗口 $k$，从 $\\{s_{k,t}\\}_{t=1}^{N_k}$ 估计 $\\tau_k$，并选择一个块长度 $L_k \\ge 2 \\tau_k$（以采样间隔为单位）。将时间序列划分为长度为 $L_k$ 的非重叠块（如果需要，丢弃一个较短的余数），然后对这些块进行有放回的重采样，直到为窗口 $k$ 重构出 $N_k$ 个样本。对所有 $k$ 独立重复此过程以形成一个自助法复制数据集，应用相同的 WHAM 分箱或 MBAR 分析得到 $\\hat{F}^{(b)}(s)$，并对 $b = 1, \\dots, B$ 进行迭代。从 $\\{\\hat{F}^{(b)}(s)\\}_{b=1}^B$ 的经验分位数构建逐点 95% 置信区间。确保重采样按窗口分层，以便每个自助法复制都保留原始的 $\\{N_k\\}$ 和特定于窗口的偏置函数。\n\nB. 将所有窗口的 $\\{s_{k,t}\\}$ 汇集到一个大小为 $\\sum_{k=1}^K N_k$ 的集合中，忽略窗口标签和偏置，从中抽取相同大小的独立自助样本，应用 WHAM 并选择一个等于窗口偏置平均值的单一有效偏置，并将不同自助法实现的样本标准差作为 95% 置信区间的半宽度。\n\nC. 执行“整群”自助法，即有放回地重采样 $K$ 个窗口，保留任何被选中窗口的完整时间序列，并丢弃任何未被选中的窗口，然后对每个自助法选出的样本应用 WHAM 或 MBAR。使用这些选择之间的变异性来形成 95% 置信区间。\n\nD. 在每个窗口内，将所有 $\\{s_{k,t}\\}$ 视为独立的（$L_k = 1$），对单个数据点进行有放回的重采样至大小为 $N_k$，通过拼接每个窗口的重采样结果来重构自助数据集，运行 WHAM 或 MBAR 以获得 $\\hat{F}^{(b)}(s)$，并从经验分位数计算逐点 95% 置信区间。\n\nE. 完全避免重采样，通过在解的周围线性化 WHAM 不动点方程，并使用带费希尔信息的一阶（delta 方法）误差传播来获得 $F(s)$ 的渐近高斯误差棒；将这些报告为 95% 置信区间。\n\n选择最能反映完成此任务的正确自助法方案的选项。", "solution": "我们从正则定义 $p(x) \\propto \\exp[-\\beta U(x)]$ 开始，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$。平均力势为 $F(s) = -k_{\\mathrm{B}} T \\ln p(s) + C$，其中 $p(s) = \\int \\mathrm{d}x\\, \\delta(s - s(x))\\, p(x)$。在伞形采样中，窗口 $k$ 中的构象是在 $U_k^{\\mathrm{tot}}(x) = U(x) + U_k(s(x))$ 下生成的，因此在该窗口中观测到的边缘密度为 $p_k^{\\mathrm{obs}}(s) \\propto p(s)\\, \\exp[-\\beta U_k(s)]$。WHAM 和多态 Bennett 接受率方法 (MBAR) 是基于似然的估计量，它们通过适当地对有偏样本进行重加权来结合所有窗口的数据，以重构 $p(s)$（并因此重构 $F(s)$）。\n\n不确定性量化应反映估计量在实际数据生成过程下的有限样本变异性。自助法通过以一种保留两个关键特征的方式对收集到的数据进行重采样来模拟重复实验：(i) 按窗口 $k$ 分层（每个窗口都有由 $U_k$ 及其自身样本大小 $N_k$ 决定的独特采样分布），以及 (ii) 由于分子动力学导致的每个窗口内部的时间相关性，该相关性由 $s$（或与 $F(s)$ 估计相关的任何慢集体变量）的积分自相关时间 $\\tau_k$ 来量化。因为对单个数据点的朴素重采样会过度计算相关信息，所以需要使用块自助法，其块长度至少在 $2 \\tau_k$ 的量级，以近似独立的块。然后，每个自助法复制样本都应通过相同的估计量（WHAM 或 MBAR）进行处理，并且得到的 $\\hat{F}^{(b)}(s)$ 在 $b = 1, \\dots, B$ 次复制中的分布可用于通过经验百分位数（或者，如果合理的话，通过自助法标准误和正态近似）来形成逐点 95% 置信区间。\n\n我们评估每个选项：\n\nA. 此方案明确：\n- 估计每个窗口的 $\\tau_k$ 并选择一个块长度 $L_k \\ge 2 \\tau_k$，这是一个标准的经验法则，确保数据块近似独立，从而保留窗口内的相关结构。\n- 执行分层块自助法：在每个窗口内重采样数据块以重构 $N_k$ 个样本，从而保持特定于窗口的采样分布和样本大小。\n- 对每个自助数据集运行相同的 WHAM 分箱或 MBAR 分析，以通过非线性估计量传播不 Uncertainty，而无需进行线性化。\n- 对每个 $s$，从 $\\hat{F}^{(b)}(s)$ 的经验分位数 $\\{2.5\\%, 97.5\\%\\}$ 构建逐点 95% 置信区间。\n这符合基本要求：保留每个窗口的有偏数据生成过程和相关结构，并通过重新应用完整的估计量来传播不确定性。这在统计上是可靠的。结论：正确。\n\nB. 汇集所有样本并忽略窗口标签会破坏分层结构，并消除由 $U_k(s)$ 引起的已知采样分布差异。指定一个单一的“平均偏置”没有第一性原理的依据：观测到的 $p_k^{\\mathrm{obs}}(s)$ 因 $\\exp[-\\beta U_k(s)]$ 而异，而 WHAM/MBAR 正是依赖于这些差异。这种重采样方案不能近似原始实验，因此产生无效的不确定性。结论：不正确。\n\nC. 对窗口进行纯粹的“整群”自助法会重采样整个窗口并丢弃其他窗口，这能捕捉到窗口间的变异性，但不能以正确的尺度捕捉窗口内的采样变异性。对于固定的 $K$，这会严重扭曲有效样本大小和偏置覆盖范围；除非辅以窗口内的块重采样，否则它也无法表示每个窗口内的相关结构。就其陈述而言，这不是完成此任务的合适自助法。结论：不正确。\n\nD. 使用 $L_k = 1$ 对单个点进行重采样，是将相关数据视为独立数据。积分自相关时间 $\\tau_k$ 意味着有效样本大小为 $N_k^{\\mathrm{eff}} \\approx N_k / (2 \\tau_k)$，因此朴素的独立重采样将大大低估方差，并产生反保守的置信区间。结论：不正确。\n\nE. 这描述了一种通过线性化和费希尔信息进行的解析性、渐近方差计算方法，该方法在满足大样本正则性条件下可能是有效的，但它不是一个自助法程序，并且需要非平凡的推导和假设。问题要求的是一个基于自助法的方案；此外，对于强非线性估计量或在有限样本中，解析性线性化可能不准确。结论：不正确。\n\n因此，选项中唯一正确的自助法方案是 A。", "answer": "$$\\boxed{A}$$", "id": "2685134"}]}