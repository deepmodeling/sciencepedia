{"hands_on_practices": [{"introduction": "虽然化学主方程是随机动力学的基石，但直接求解它往往非常困难。概率生成函数 (Probability Generating Function, PGF) 是一种强大的数学工具，它能将描述概率 $P(n,t)$ 演化的一组耦合常微分方程转化为一个单一的偏微分方程 (PDE)，从而为解析求解提供了可能。本练习将引导你对一个纯生过程（Yule 过程）应用此方法，这是一个代表自催化和种群增长的基础模型。通过解决这个问题 [@problem_id:2669255]，你将掌握一项关键的分析技术，并能从第一性原理出发，推导出随机过程的完整概率分布及其矩，而不仅仅是依赖于近似或模拟。", "problem": "考虑一个充分混合、等温、等容的系统，其中包含一个根据基元反应 $X \\to 2X$ 进行自催化复制的单一化学物种。假设在稀释极限下遵循质量作用随机动力学，因此在时刻 $t$ 有 $n$ 个分子的条件下，事件 $X \\to 2X$ 的瞬时倾向（风险）为 $a(n) = \\lambda n$，其中 $\\lambda > 0$ 是一个常数。令 $N(t)$ 表示时刻 $t$ 的分子数，并假设 $N(0) = n_{0}$ 的概率为 $1$，其中 $n_{0} \\in \\mathbb{N}$。\n\n从该线性纯生过程的化学主方程 (CME) 出发，定义概率生成函数 (PGF) $G(s,t) = \\sum_{n=0}^{\\infty} s^{n} \\mathbb{P}(N(t)=n)$，并推导其满足的偏微分方程 (PDE) 及相应的初始条件。然后求解此 PDE，得到 $G(s,t)$ 的闭式解。使用 PGF 的闭式解，提取对于 $n \\in \\{n_{0}, n_{0}+1, \\dots \\}$ 的概率质量函数 $\\mathbb{P}(N(t)=n \\mid N(0)=n_{0})$，并计算前两阶矩 $\\mathbb{E}[N(t)]$ 和 $\\mathrm{Var}[N(t)]$（用 $\\lambda$、$t$ 和 $n_{0}$ 表示）。最后，以单一简化的解析表达式形式，给出 $G(s,t)$ 的闭式表达式。你的最终答案应为这个用 $s$、$\\lambda$、$t$ 和 $n_{0}$ 表示的 $G(s,t)$ 的单一解析表达式。不包含单位。不要进行四舍五入。", "solution": "所述问题需进行验证。\n\n**步骤 1：提取已知条件**\n\n*   **反应**：$X \\to 2X$\n*   **系统**：充分混合、等温、等容。\n*   **动力学**：质量作用随机动力学，稀释极限。\n*   **倾向函数**：对于分子数 $n$，$a(n) = \\lambda n$，其中 $\\lambda > 0$。\n*   **随机过程**：$N(t)$ 是物种 $X$ 在时刻 $t$ 的分子数量。\n*   **初始条件**：$N(0) = n_{0}$ 的概率为 $1$，其中 $n_{0} \\in \\mathbb{N}$（即 $n_0$ 是一个正整数）。\n*   **概率生成函数 (PGF)**：定义为 $G(s,t) = \\sum_{n=0}^{\\infty} s^{n} \\mathbb{P}(N(t)=n)$。\n*   **目标**：\n    1.  从化学主方程 (CME) 推导 $G(s,t)$ 的偏微分方程 (PDE)。\n    2.  陈述该 PDE 的初始条件。\n    3.  求解该 PDE 以得到 $G(s,t)$ 的闭式解。\n    4.  提取概率质量函数 (PMF) $\\mathbb{P}(N(t)=n \\mid N(0)=n_{0})$。\n    5.  计算前两阶矩 $\\mathbb{E}[N(t)]$ 和 $\\mathrm{Var}[N(t)]$。\n    6.  提供 $G(s,t)$ 的最终闭式表达式。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n*   **科学依据**：该问题描述了一个线性纯生过程，也称为 Yule 过程。这是随机化学动力学和种群动力学中的一个典型模型，代表自催化复制或简单出生。质量作用倾向函数 $a(n) = \\lambda n$ 对于稀释、充分混合系统中的单分子反应是一个标准且物理上合理的假设。该模型是基础且科学上正确的。\n*   **适定性**：该问题被完整地规定。它提供了反应、其随机速率定律、一个精确的初始条件和一组明确的任务。存在唯一、稳定且有意义的解。\n*   **客观性**：该问题以精确、无歧义的数学语言陈述，不含主观内容。\n\n**步骤 3：结论与行动**\n\n该问题有效。这是一个物理化学中适定且有科学依据的问题。开始求解。\n\n该过程是一个纯生过程，其中每个反应 $X \\to 2X$ 使分子数增加一。系统的状态是分子数 $n$。状态的变化是 $n \\to n+1$。\n\n令 $P(n, t) = \\mathbb{P}(N(t) = n \\mid N(0) = n_{0})$。$P(n, t)$ 的时间演化由化学主方程 (CME) 控制。$P(n, t)$ 的变化源于进出状态 $n$ 的跃迁。\n*   系统以倾向 $a(n-1) = \\lambda(n-1)$ 从状态 $n-1$ 跃迁到状态 $n$。\n*   系统以倾向 $a(n) = \\lambda n$ 从状态 $n$ 跃迁到状态 $n+1$。\n\n因此，CME 为：\n$$\n\\frac{d P(n, t)}{d t} = \\lambda(n-1) P(n-1, t) - \\lambda n P(n, t) \\quad \\text{for } n > n_{0}\n$$\n初始群体数量为 $n_0$，因此无法达到小于 $n_0$ 的状态。对于 $n=n_0$，系统只能跃迁出去，所以没有增益项：\n$$\n\\frac{d P(n_{0}, t)}{d t} = - \\lambda n_{0} P(n_{0}, t)\n$$\n初始条件为 $P(n, 0) = \\delta_{n, n_{0}}$，其中 $\\delta_{n, n_{0}}$ 是克罗内克 δ 函数。\n\n接下来，我们推导概率生成函数 $G(s,t) = \\sum_{n=n_0}^{\\infty} s^n P(n,t)$ 的 PDE。我们将 $G(s,t)$ 对时间 $t$ 求导，并代入 CME 表达式：\n$$\n\\frac{\\partial G}{\\partial t} = \\sum_{n=n_0}^{\\infty} s^n \\frac{d P(n,t)}{d t} = \\sum_{n=n_0}^{\\infty} s^n \\left[ \\lambda(n-1) P(n-1, t) - \\lambda n P(n, t) \\right]\n$$\n我们将方程分为两个和：\n$$\n\\frac{\\partial G}{\\partial t} = \\lambda \\sum_{n=n_0}^{\\infty} s^n (n-1) P(n-1, t) - \\lambda \\sum_{n=n_0}^{\\infty} s^n n P(n, t)\n$$\n对于第一个和，令 $m = n-1$，则 $n = m+1$。当 $n$ 从 $n_0$ 开始时，$m$ 从 $n_0-1$ 开始。但由于 $P(n_0-1,t)=0$，我们可以从 $m=n_0$ 开始求和。\n$$\n\\lambda \\sum_{m=n_0}^{\\infty} s^{m+1} m P(m, t) = \\lambda s \\sum_{m=n_0}^{\\infty} m s^m P(m, t) = \\lambda s \\left( s \\frac{\\partial G}{\\partial s} \\right) = \\lambda s^2 \\frac{\\partial G}{\\partial s}\n$$\n第二个和是：\n$$\n- \\lambda \\sum_{n=n_0}^{\\infty} n s^n P(n, t) = - \\lambda s \\frac{\\partial G}{\\partial s}\n$$\n合并这两个部分，得到一阶线性 PDE：\n$$\n\\frac{\\partial G}{\\partial t} = \\lambda s^2 \\frac{\\partial G}{\\partial s} - \\lambda s \\frac{\\partial G}{\\partial s} = \\lambda s(s-1) \\frac{\\partial G}{\\partial s}\n$$\n$G(s, t)$ 在 $t=0$ 的初始条件由 $P(n, 0) = \\delta_{n, n_{0}}$ 推导得出：\n$$\nG(s, 0) = \\sum_{n=n_0}^{\\infty} s^n P(n, 0) = \\sum_{n=n_0}^{\\infty} s^n \\delta_{n, n_{0}} = s^{n_{0}}\n$$\n我们使用特征线法求解该 PDE。特征方程为：\n$$\n\\frac{dt}{1} = \\frac{ds}{-\\lambda s(s-1)} = \\frac{dG}{0}\n$$\n从 $\\frac{dG}{0}=0$可知，$G$ 沿特征线为常数。从另一对方程：\n$$\n-\\lambda dt = \\frac{ds}{s(s-1)}\n$$\n使用部分分式分解 $\\frac{1}{s(s-1)} = \\frac{1}{s-1} - \\frac{1}{s}$：\n$$\n-\\lambda \\int dt = \\int \\left( \\frac{1}{s-1} - \\frac{1}{s} \\right) ds\n$$\n$$\n-\\lambda t = \\ln|s-1| - \\ln|s| + C \\implies \\ln\\left(\\frac{s-1}{s}\\right) + \\lambda t = C'\n$$\n特征曲线由 $\\left(\\frac{s-1}{s}\\right) e^{\\lambda t} = \\text{常数}$ 给出。通解的形式为 $G(s,t) = f\\left(\\left(\\frac{s-1}{s}\\right) e^{\\lambda t}\\right)$。\n我们应用初始条件 $G(s,0) = s^{n_0}$：\n$$\nf\\left(\\frac{s-1}{s}\\right) = s^{n_{0}}\n$$\n令 $u = \\frac{s-1}{s} = 1 - \\frac{1}{s}$。那么 $\\frac{1}{s} = 1-u$，所以 $s = \\frac{1}{1-u}$。\n函数 $f$ 是 $f(u) = \\left(\\frac{1}{1-u}\\right)^{n_{0}}$。\n代回 $G(s, t)$ 的通解：\n$$\nG(s,t) = f\\left(\\left(\\frac{s-1}{s}\\right) e^{\\lambda t}\\right) = \\left( \\frac{1}{1 - \\left(\\frac{s-1}{s}\\right) e^{\\lambda t}} \\right)^{n_{0}} = \\left( \\frac{s}{s - (s-1)e^{\\lambda t}} \\right)^{n_{0}}\n$$\n化简分母：\n$$\ns - (s-1)e^{\\lambda t} = s - se^{\\lambda t} + e^{\\lambda t} = s(1-e^{\\lambda t}) + e^{\\lambda t}\n$$\n因此，PGF 的闭式表达式是：\n$$\nG(s,t) = \\left( \\frac{s}{s(1-e^{\\lambda t}) + e^{\\lambda t}} \\right)^{n_{0}}\n$$\n为了求出 PMF，我们通过给分子和分母同乘以 $e^{-\\lambda t}$ 来重新整理 $G(s,t)$：\n$$\nG(s,t) = \\left( \\frac{s \\cdot e^{-\\lambda t}}{[s(1-e^{\\lambda t}) + e^{\\lambda t}] \\cdot e^{-\\lambda t}} \\right)^{n_{0}} = \\left( \\frac{s e^{-\\lambda t}}{s(e^{-\\lambda t}-1) + 1} \\right)^{n_{0}} = \\left( \\frac{s e^{-\\lambda t}}{1 - s(1-e^{-\\lambda t})} \\right)^{n_{0}}\n$$\n$$\nG(s,t) = \\left( \\frac{p s}{1 - (1-p)s} \\right)^{n_{0}} \\quad \\text{其中 } p = e^{-\\lambda t}\n$$\n这是在 $\\{1, 2, ...\\}$ 上、成功概率为 $p$ 的 $n_0$ 个独立同分布的几何随机变量之和的 PGF。总数 $N(t)$ 服从为达到 $n_0$ 次“成功”而进行的试验次数 $n$ 的负二项分布 $NB(n_0, p)$。PMF 为：\n$$\n\\mathbb{P}(N(t)=n \\mid N(0)=n_0) = \\binom{n-1}{n_0-1} p^{n_0} (1-p)^{n-n_0} \\quad \\text{for } n \\ge n_0\n$$\n$$\n\\mathbb{P}(N(t)=n \\mid N(0)=n_0) = \\binom{n-1}{n_0-1} (e^{-\\lambda t})^{n_0} (1-e^{-\\lambda t})^{n-n_0}\n$$\n矩可以从 PGF 求得。均值为 $\\mathbb{E}[N(t)] = \\frac{\\partial G}{\\partial s} \\bigg|_{s=1}$。在 $s=1$ 时，分母 $s(1-e^{\\lambda t}) + e^{\\lambda t}$ 变为 $1-e^{\\lambda t} + e^{\\lambda t} = 1$。\n$$\n\\frac{\\partial G}{\\partial s} = n_{0} \\left( \\frac{s}{s(1-e^{\\lambda t}) + e^{\\lambda t}} \\right)^{n_{0}-1} \\frac{e^{\\lambda t}}{\\left(s(1-e^{\\lambda t}) + e^{\\lambda t}\\right)^{2}}\n$$\n在 $s=1$ 处求值：\n$$\n\\mathbb{E}[N(t)] = n_{0} (1)^{n_{0}-1} \\frac{e^{\\lambda t}}{1^{2}} = n_{0} e^{\\lambda t}\n$$\n方差为 $\\mathrm{Var}[N(t)] = G''(1,t) + G'(1,t) - (G'(1,t))^2$。或者，利用负二项分布的性质，其方差是 $n_0 \\frac{1-p}{p^2}$。\n$$\n\\mathrm{Var}[N(t)] = n_{0} \\frac{1-p}{p^2} = n_{0} \\frac{1-e^{-\\lambda t}}{(e^{-\\lambda t})^2} = n_{0} \\frac{1-e^{-\\lambda t}}{e^{-2\\lambda t}}\n$$\n$$\n\\mathrm{Var}[N(t)] = n_{0} (e^{2\\lambda t} - e^{\\lambda t}) = n_{0} e^{\\lambda t} (e^{\\lambda t} - 1)\n$$\n问题要求提供 $G(s,t)$ 的单一简化解析表达式。这就是上面推导和给出的表达式。", "answer": "$$\n\\boxed{\\left( \\frac{s}{s(1-\\exp(\\lambda t)) + \\exp(\\lambda t)} \\right)^{n_{0}}}\n$$", "id": "2669255"}, {"introduction": "对于复杂的化学网络，精确的解析解非常罕见，因此掌握有效的近似方法至关重要。van Kampen 系统尺寸展开是在微观随机描述（主方程）和宏观确定性描述（速率方程）之间建立联系的核心理论工具。本练习 [@problem_id:2669217] 旨在引导你从主方程出发，执行此展开并推导线性噪声近似 (LNA)，它将系统在宏观稳定不动点附近的涨落 $\\xi(t)$ 描述为一个易于处理的 Ornstein-Uhlenbeck 过程。完成这一推导将使你深刻理解宏观确定性行为如何从微观随机事件中涌现，以及如何量化化学系统固有的随机噪声。", "problem": "考虑一个固定体积为 $\\Omega$ 的充分混合的等温反应器，其中包含单一化学物种 $X$。该物种经历两个基元反应：$\\varnothing \\xrightarrow{k_{0}\\,\\Omega} X$ 和 $X \\xrightarrow{k_{1}} \\varnothing$。令 $n(t)$ 表示在时刻 $t$ 物种 $X$ 的分子数，令 $P(n,t)$ 表示在时刻 $t$ 有 $n$ 个分子的概率。该系统由化学主方程 (CME) 描述，其倾向函数为 $a_{1}(n)=k_{0}\\,\\Omega$ 和 $a_{2}(n)=k_{1}\\,n$，化学计量变化为 $\\nu_{1}=+1$ 和 $\\nu_{2}=-1$。使用 van Kampen 系统大小展开，围绕由 $n(t)=\\Omega\\,x(t)+\\Omega^{1/2}\\,\\xi(t)$ 定义的宏观浓度轨迹 $x(t)$，从第一性原理出发完成以下步骤：\n \n(1) 从 CME 出发，推导 $x(t)$ 的确定性速率方程，并确定其稳定不动点 $x^{\\ast}$。\n\n(2) 在展开式中保留至 $\\Omega^{0}$ 阶的项，对涨落 $\\xi(t)$ 围绕 $x^{\\ast}$ 的介观动力学进行线性化。推导相应的线性朗之万方程，并用 $k_{0}$、$k_{1}$ 和 $x^{\\ast}$ 表示漂移和噪声强度。\n\n(3) 仅使用前面步骤中已证明的结果和基础的随机微积分，计算浓度涨落 $\\delta x(t) \\equiv \\hat{x}(t)-x^{\\ast}$ 在 $\\Omega^{-1}$ 主导阶下的稳态方差，其中 $\\hat{x}(t)\\equiv n(t)/\\Omega$ 是随机浓度。\n\n你的最终答案必须是仅含 $k_{0}$、$k_{1}$ 和 $\\Omega$ 的单个闭式解析表达式。不要提供中间量。不需要进行数值计算。最终结果以无单位形式表示。", "solution": "我们从单个物种的化学主方程 (CME) 开始，该物种有两个反应，其特征在于化学计量变化 $\\nu_{1}=+1$ 和 $\\nu_{2}=-1$ 以及倾向函数 $a_{1}(n)=k_{0}\\,\\Omega$ 和 $a_{2}(n)=k_{1}\\,n$。CME 的形式如下\n$$\n\\frac{\\partial}{\\partial t}P(n,t)\n= a_{1}(n-1)\\,P(n-1,t)+a_{2}(n+1)\\,P(n+1,t)-\\big[a_{1}(n)+a_{2}(n)\\big]\\,P(n,t).\n$$\n根据 van Kampen 系统大小展开，我们将分子数写为\n$$\nn(t)=\\Omega\\,x(t)+\\Omega^{1/2}\\,\\xi(t),\n$$\n其中 $x(t)$ 是确定性浓度，$\\xi(t)$ 代表 $\\Omega^{0}$ 阶的介观涨落。按体积缩放后的倾向函数为 $g_{1}(x)=a_{1}(\\Omega x)/\\Omega=k_{0}$ 和 $g_{2}(x)=a_{2}(\\Omega x)/\\Omega=k_{1}\\,x$。\n\n收集 $\\Omega^{1}$ 阶的项，得到宏观（确定性）速率方程。净宏观漂移是缩放后倾向函数的化学计量加权和，\n$$\n\\frac{d x}{dt}=\\nu_{1}\\,g_{1}(x)+\\nu_{2}\\,g_{2}(x)=k_{0}-k_{1}\\,x.\n$$\n不动点 $x^{\\ast}$ 满足 $k_{0}-k_{1}\\,x^{\\ast}=0$，因此\n$$\nx^{\\ast}=\\frac{k_{0}}{k_{1}}.\n$$\n线性稳定性由在 $x^{\\ast}$ 处求值的雅可比矩阵 $J=\\frac{d}{dx}(k_{0}-k_{1}x)=-k_{1}$ 决定。当 $k_{1}>0$ 时，该值为负，因此 $x^{\\ast}$ 是稳定的。\n\n接下来，为了获得涨落动力学，我们将 CME 展开到 $\\Omega^{0}$ 阶。线性噪声近似给出了 $\\xi(t)$ 的线性朗之万方程，其形式为\n$$\n\\frac{d\\xi}{dt}=J\\,\\xi+\\eta(t),\n$$\n其中 $J=-k_{1}$ 是线性化漂移，$\\eta(t)$ 是零均值高斯白噪声，其协方差由宏观反应噪声强度决定。对于一维系统，扩散系数（在主导阶上）是按化学计量数平方加权的缩放后倾向函数的总和，\n$$\nB(x)=\\sum_{r=1}^{2}\\nu_{r}^{2}\\,g_{r}(x)= (+1)^{2}\\,k_{0}+(-1)^{2}\\,k_{1}\\,x=k_{0}+k_{1}\\,x.\n$$\n在不动点 $x^{\\ast}$ 处求值，得到\n$$\nB^{\\ast}=B(x^{\\ast})=k_{0}+k_{1}\\,\\frac{k_{0}}{k_{1}}=2\\,k_{0}.\n$$\n因此，介观涨落满足线性朗之万方程\n$$\n\\frac{d\\xi}{dt}=-k_{1}\\,\\xi+\\eta(t), \\quad \\langle \\eta(t)\\rangle=0,\\quad \\langle \\eta(t)\\,\\eta(t')\\rangle=B^{\\ast}\\,\\delta(t-t')=2\\,k_{0}\\,\\delta(t-t').\n$$\n等价地，以随机微分方程 (SDE) 的形式表示，\n$$\nd\\xi=-k_{1}\\,\\xi\\,dt+\\sqrt{B^{\\ast}}\\,dW_{t}=-k_{1}\\,\\xi\\,dt+\\sqrt{2\\,k_{0}}\\,dW_{t},\n$$\n这是一个 Ornstein-Uhlenbeck (OU) 过程，其衰减率为 $k_{1}$，扩散强度为 $B^{\\ast}$。\n\n我们需要计算浓度涨落 $\\delta x(t)\\equiv \\hat{x}(t)-x^{\\ast}$ 在 $\\Omega^{-1}$ 主导阶下的稳态方差，其中 $\\hat{x}(t)=n(t)/\\Omega$。根据定义 $n(t)=\\Omega\\,x(t)+\\Omega^{1/2}\\,\\xi(t)$，随机浓度为\n$$\n\\hat{x}(t)=x(t)+\\Omega^{-1/2}\\,\\xi(t),\n$$\n在稳态附近，$x(t)\\to x^{\\ast}$，因此主导阶上 $\\delta x(t)=\\Omega^{-1/2}\\,\\xi(t)$。所以，\n$$\n\\operatorname{Var}[\\delta x] = \\Omega^{-1}\\,\\operatorname{Var}[\\xi].\n$$\n对于 OU 过程 $d\\xi=-k_{1}\\,\\xi\\,dt+\\sqrt{B^{\\ast}}\\,dW_{t}$，其稳态二阶矩满足 Itō 矩方程\n$$\n\\frac{d}{dt}\\langle \\xi^{2}\\rangle = 2\\,\\langle \\xi\\,\\dot{\\xi}\\rangle + \\langle (\\sqrt{B^{\\ast}})^{2}\\rangle\n= 2\\,\\langle \\xi\\,(-k_{1}\\,\\xi)\\rangle + B^{\\ast}\n= -2\\,k_{1}\\,\\langle \\xi^{2}\\rangle + B^{\\ast}.\n$$\n在稳态时，$d\\langle \\xi^{2}\\rangle/dt=0$，所以\n$$\n\\langle \\xi^{2}\\rangle_{\\text{st}}=\\frac{B^{\\ast}}{2\\,k_{1}}=\\frac{2\\,k_{0}}{2\\,k_{1}}=\\frac{k_{0}}{k_{1}}.\n$$\n因此，\n$$\n\\operatorname{Var}[\\delta x]_{\\text{st}}=\\Omega^{-1}\\,\\langle \\xi^{2}\\rangle_{\\text{st}}=\\frac{1}{\\Omega}\\,\\frac{k_{0}}{k_{1}}=\\frac{k_{0}}{k_{1}\\,\\Omega}.\n$$\n这就是围绕稳定不动点的浓度涨落的主导阶稳态方差。", "answer": "$$\\boxed{\\frac{k_{0}}{k_{1}\\,\\Omega}}$$", "id": "2669217"}, {"introduction": "当解析方法不再适用时，数值模拟成为我们研究随机系统的主要工具。Gillespie 随机模拟算法 (SSA) 是精确模拟化学主方程的黄金标准，但对于包含大量 ($R$) 反应的系统，其计算成本可能成为瓶颈。本练习 [@problem_id:2669219] 将视角从连续数学转向离散算法和数据结构，要求你分析不同 SSA 实现方式的计算复杂度。通过评估这些算法的优劣，你将培养出为复杂反应网络选择或设计高效模拟策略所需的实践洞察力，这是计算系统生物学和化学领域的一项基本技能。", "problem": "一个具有 $N$ 种分子和 $R$ 个反应通道的充分混合化学反应网络，使用 Gillespie 随机模拟算法 (SSA) 进行模拟。设状态为 $X(t)\\in\\mathbb{N}^N$，对于反应 $\\mu\\in\\{1,\\dots,R\\}$，其倾向为 $a_{\\mu}(X(t))$。在一个 SSA 步骤中，等待时间 $\\tau$ 从速率为 $a_0(X)=\\sum_{\\mu=1}^{R} a_{\\mu}(X)$ 的指数分布中抽样，反应索引 $J$ 以 $\\mathbb{P}(J=\\mu\\mid X)=a_{\\mu}(X)/a_0(X)$ 的概率被抽取。在反应 $J$ 触发后，状态通过化学计量变化向量进行更新，并且每个依赖于任何已变化物种的倾向 $a_{\\mu}$ 都被重新计算。假设每次反应触发后必须更新的倾向数量是一个随机变量，其均值为 $\\bar{d}$，该值由一个依赖图决定，除了通过网络连接性外，该图独立于 $R$。\n\n假设：\n- 计算任何单个倾向 $a_{\\mu}$ 的时间复杂度为 $\\mathcal{O}(1)$。\n- 更新状态的时间复杂度为 $\\mathcal{O}(1)$。\n- 生成每个均匀分布随机变量的时间复杂度为 $\\mathcal{O}(1)$。\n- 你可以选择数据结构和更新策略，但必须遵循上述随机规则。\n\n考虑不同实现选择下的每步计算复杂度。选择所有正确的陈述。\n\nA. 在一个朴素的直接法实现中，每一步都重建累积和数组 $\\left(\\sum_{\\nu=1}^{\\mu} a_{\\nu}\\right)_{\\mu=1}^{R}$，然后线性扫描该数组以选择 $J$，选择工作的复杂度是 $\\mathcal{O}(R)$。加上重新计算 $\\bar{d}$ 个受影响的倾向，每步的成本是 $\\mathcal{O}(R+\\bar{d})$。\n\nB. 如果总倾向 $a_0$ 是增量维护的（通过在每次触发后将在受影响的 $a_{\\mu}$ 上的变化量相加），那么抽样指数等待时间变为 $\\mathcal{O}(1)$；然而，在没有额外数据结构的情况下，通过对累积倾向进行线性扫描来选择 $J$ 的复杂度仍然是 $\\mathcal{O}(R)$。\n\nC. 将倾向存储在以索引 $1,\\dots,R$ 为键的树状数组（也称为 Fenwick 树）中，支持通过前缀和搜索以 $\\mathcal{O}(\\log R)$ 的时间进行逆变换采样来选择 $J$，并以 $\\mathcal{O}(\\log R)$ 的时间更新单个 $a_{\\mu}$。因此，一个步骤的成本是选择加上更新的 $\\mathcal{O}(\\log R+\\bar{d}\\log R)$。\n\nD. 维护一个以当前倾向 $a_{\\mu}$ 为键的二叉堆，使得 SSA 选择的复杂度为 $\\mathcal{O}(\\log R)$，因为下一个反应是具有最大 $a_{\\mu}$ 的反应。\n\nE. 对于固定权重，别名方法能实现 $\\mathcal{O}(1)$ 期望时间的采样，但由于 SSA 的倾向在每次反应触发后都会改变，重建别名表通常每步需要 $\\mathcal{O}(R)$ 的成本；在没有额外结构支持动态更新的情况下，摊销的每步成本为 $\\mathcal{O}(R)$。\n\nF. 在使用依赖图和存储暂定绝对触发时间的二叉堆的下一反应法 (Next Reaction Method, NRM) 中，提取下一个反应的复杂度是 $\\mathcal{O}(\\log R)$，更新 $\\bar{d}$ 个受影响键的复杂度是 $\\mathcal{O}(\\bar{d}\\log R)$，前提是假设评估受影响的指数时钟的转换公式为常数时间。\n\nG. 对于直接法，任何实现了选择时间亚线性于 $R$ 的数据结构，由于需要维护累积和，在单次倾向变化时必然会产生 $\\mathcal{O}(R)$ 的最坏情况更新时间。\n\n选择所有适用的选项。", "solution": "该问题陈述是随机模拟算法分析中的一个有效练习。它具有科学依据，问题良定，并使用了精确、客观的语言。我们现在将对每个陈述进行审慎的评估。\n\n**陈述 A 的分析**\n\n该陈述描述了 Gillespie 算法“直接法”的最基本实现。选择下一个反应 $J$ 需要从离散概率分布 $\\mathbb{P}(J=\\mu | X) = a_{\\mu}(X) / a_0(X)$ 中进行抽样。\n\n1.  为了执行逆变换采样，通常会计算总倾向 $a_0 = \\sum_{\\mu=1}^{R} a_{\\mu}$，然后找到满足 $\\sum_{\\nu=1}^{J} a_{\\nu} > r \\cdot a_0$ 的最小整数 $J$，其中 $r \\sim U(0,1)$。\n2.  该陈述指明了在每一步都重建累积和数组 $\\left(\\sum_{\\nu=1}^{\\mu} a_{\\nu}\\right)_{\\mu=1}^{R}$。构建这个包含 $R$ 个元素的数组需要顺序求和，这是一个 $\\mathcal{O}(R)$ 的操作。\n3.  一旦累积和数组构建完成，通过线性扫描找到正确的索引 $J$ 在平均情况和最坏情况下都需要 $\\mathcal{O}(R)$ 的时间。因此，总的选择工作量是 $\\mathcal{O}(R)$。\n4.  除了选择之外，算法还必须更新受状态变化影响的倾向。问题假定平均有 $\\bar{d}$ 个倾向需要重新计算。由于每次评估都假定为 $\\mathcal{O}(1)$，这部分步骤的成本为 $\\mathcal{O}(\\bar{d})$。\n\n每步的总计算成本是选择和更新成本的总和，即 $\\mathcal{O}(R + \\bar{d})$。该陈述是对这个朴素算法复杂度的正确评估。\n\n**对 A 的结论**：**正确**。\n\n**陈述 B 的分析**\n\n该陈述考虑了一个微小的优化，即总倾向 $a_0$ 不是从头开始重新计算，而是进行增量维护。\n\n1.  一个反应发生后，$\\bar{d}$ 个倾向发生变化。对于每个受影响的倾向 $a_\\mu$，我们可以找到其变化量 $\\Delta a_\\mu = a_\\mu^{\\text{new}} - a_\\mu^{\\text{old}}$。然后通过 $a_0^{\\text{new}} = a_0^{\\text{old}} + \\sum_{\\text{affected}} \\Delta a_\\mu$ 来更新总倾向。这个更新过程需要 $\\mathcal{O}(\\bar{d})$ 的工作量。\n2.  在 $a_0$ 的值可用后，抽样等待时间 $\\tau = -\\frac{1}{a_0} \\ln(r_1)$ 涉及一个随机数生成、一个对数运算和一个除法运算，所有这些都是 $\\mathcal{O}(1)$ 的操作。因此，该陈述的第一部分是正确的。\n3.  然而，选择反应索引 $J$ 仍然需要从由单个倾向 $\\{a_\\mu\\}$ 定义的离散分布中进行抽样。该陈述指明不使用额外的数据结构。在这种情况下，执行逆变换采样的唯一方法是遍历所有倾向，动态计算部分和，即找到满足 $\\sum_{\\nu=1}^{J-1} a_\\nu < r_2 a_0 \\leq \\sum_{\\nu=1}^{J} a_\\nu$ 的 $J$。这种线性扫描是一个 $\\mathcal{O}(R)$ 的操作。\n\n该陈述在给定的实现策略下，正确地分解了每步的工作量，并为每个部分精确地分配了复杂度。\n\n**对 B 的结论**：**正确**。\n\n**陈述 C 的分析**\n\n该陈述提议使用树状数组 (BIT) 或 Fenwick 树，这是一种能够实现高效动态前缀和计算的数据结构。\n\n1.  树状数组支持在 $\\mathcal{O}(\\log R)$ 时间内更新单个索引的值和查询到任意索引的前缀和。\n2.  **更新倾向**：当 $\\bar{d}$ 个倾向必须更新时，这转化为对树状数组进行的 $\\bar{d}$ 次单独的更新操作。此阶段的总成本为 $\\mathcal{O}(\\bar{d} \\log R)$。\n3.  **抽样 $J$**：选择过程需要找到与从 $U(0, a_0)$ 中抽取的值相对应的索引 $J$。首先，通过查询到 $R$ 的前缀和来找到总倾向 $a_0$，这需要 $\\mathcal{O}(\\log R)$ 的时间。然后，必须在树状数组上执行搜索，以找到前缀和首次超过随机阈值的索引 $J$。在树状数组上的这种搜索可以实现在 $\\mathcal{O}(\\log R)$ 时间内运行。因此，总的选择过程是 $\\mathcal{O}(\\log R)$。\n4.  每步的总成本是选择和更新复杂度的总和：$\\mathcal{O}(\\log R) + \\mathcal{O}(\\bar{d}\\log R) = \\mathcal{O}(\\log R + \\bar{d}\\log R)$。\n\n该陈述正确地识别了在树状数组上相关操作的复杂度，并正确地将它们结合起来以得出每步的总复杂度。\n\n**对 C 的结论**：**正确**。\n\n**陈述 D 的分析**\n\n该陈述断言 SSA 的选择过程涉及挑选具有最大倾向 $a_{\\mu}$ 的反应。这个前提从根本上是错误的。根据定义，随机模拟算法是随机的。选择规则是概率性的：反应 $\\mu$ 以与其倾向 $a_{\\mu}$ 成正比的概率被选中，而不是因为其倾向是最大的。一个确定性地选择具有最大倾向的反应的算法不是 Gillespie 算法，并且会导致定性上不同、非物理的系统动力学。一个以倾向值为键的二叉堆是寻找最大值的有效数据结构，但此操作与正确的 SSA 选择步骤无关。\n\n**对 D 的结论**：**不正确**。\n\n**陈述 E 的分析**\n\n别名方法是一种从离散分布中进行抽样的著名技术。它包括一个用于构建内部表格的 $\\mathcal{O}(R)$ 设置阶段，之后可以在 $\\mathcal{O}(1)$ 时间内进行抽样。在 SSA 的背景下，底层的概率分布（由倾向定义）在每一步都会改变。因此，使用别名方法的朴素实现将需要在每个模拟步骤中执行昂贵的 $\\mathcal{O}(R)$ 设置阶段。后续抽样是 $\\mathcal{O}(1)$ 的事实并不能改变每步成本由 $\\mathcal{O}(R)$ 的重建主导的事实。因此，如陈述所正确指出的，摊销成本为 $\\mathcal{O}(R)$。\n\n**对 E 的结论**：**正确**。\n\n**陈述 F 的分析**\n\n该陈述描述了 Gibson 和 Bruck 的下一反应法 (NRM)，这是 SSA 的一种精确但结构上不同的表述。它不是维护一个等待时间，而是维护 $R$ 个暂定的绝对触发时间 $\\{T_\\mu\\}$，通常存储在最小优先队列（例如，二叉堆）中。\n\n1.  **提取下一个反应**：下一个要发生的反应是具有最小触发时间的反应，即 $T_J = \\min_{\\mu} \\{T_\\mu\\}$。从一个大小为 $R$ 的二叉堆中查找并移除这个最小元素是一个`extract-min`操作，其成本为 $\\mathcal{O}(\\log R)$。\n2.  **更新**：在反应 $J$ 触发后，状态发生变化，这继而改变了其他反应子集的倾向。使用依赖图来识别这些受影响的反应，平均有 $\\bar{d}$ 个。对于这 $\\bar{d}$ 个反应中的每一个，其暂定触发时间必须重新计算，并且其在堆中的位置必须调整。在二叉堆中更新一个键是一个 $\\mathcal{O}(\\log R)$ 的操作。执行 $\\bar{d}$ 次这样的更新成本为 $\\mathcal{O}(\\bar{d} \\log R)$。\n\n该陈述为 NRM 的计算复杂度提供了一个精确且准确的总结。\n\n**对 F 的结论**：**正确**。\n\n**陈述 G 的分析**\n\n该陈述声称，任何为直接法提供亚线性选择时间的数据结构，对于单个倾向变化，其最坏情况更新时间必须为 $\\mathcal{O}(R)$。这一说法是错误的。它错误地假设了一个必要的权衡，而这个权衡是可以通过适当的数据结构来规避的。\n\n陈述 C 的分析提供了一个明确的反例。树状数组允许选择（通过逆前缀和搜索）和单个倾向的更新都在 $\\mathcal{O}(\\log R)$ 时间内完成。由于 $\\log R$ 相对于 $R$ 是亚线性的，这表明同时为两个操作实现亚线性复杂度是可能的。该陈述关于“需要维护累积和”的推理是基于对实现的狭隘看法；像树状数组和线段树这样的高级数据结构隐式地维护这些信息，从而避免了与简单的累积和数组相关的线性时间成本。\n\n**对 G 的结论**：**不正确**。", "answer": "$$\\boxed{ABCEF}$$", "id": "2669219"}]}