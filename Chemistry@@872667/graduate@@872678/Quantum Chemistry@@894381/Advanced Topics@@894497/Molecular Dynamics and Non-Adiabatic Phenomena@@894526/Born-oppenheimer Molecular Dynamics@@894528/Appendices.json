{"hands_on_practices": [{"introduction": "The foundation of any molecular dynamics simulation is the propagator, the algorithm that advances the system in time. This first exercise [@problem_id:2451186] focuses on implementing the widely-used Velocity Verlet algorithm for a single time step. To isolate the core mechanics of the integrator, this problem uses a simple analytical potential as a stand-in for a full quantum chemical calculation, allowing you to focus on correctly updating nuclear positions and velocities according to Newtonian mechanics.", "problem": "Implement a single nuclear time-step of Born-Oppenheimer molecular dynamics (BOMD) for a system of point nuclei evolving on a ground-state electronic potential energy surface under Newtonian mechanics. The electronic potential energy and forces are provided by a callable electronic-structure oracle. Work in one spatial dimension for all atoms. Use atomic units: distances in bohr, masses in electron-mass units, time in atomic time units, and energy in Hartree. Return the total energy (potential plus kinetic) after one time-step for each test case, expressed in Hartree and rounded to eight decimal places.\n\nDefinitions and requirements:\n- The nuclei obey Newton’s second law on the Born-Oppenheimer surface: for atom index $i$, with mass $m_i$, position $R_i(t)$, velocity $v_i(t)$, and force $F_i(\\mathbf{R}) = -\\partial E(\\mathbf{R})/\\partial R_i$, the accelerations are $a_i(t) = F_i(\\mathbf{R}(t))/m_i$.\n- One time-step from $t$ to $t+\\Delta t$ is defined by the following update equations for positions and velocities, where $\\Delta t$ is the time-step and the force at the new positions must be evaluated at the end of the step:\n  1. Update positions using current positions, velocities, and accelerations:\n     $$R_i(t+\\Delta t) = R_i(t) + v_i(t)\\,\\Delta t + \\frac{1}{2}a_i(t)\\,\\Delta t^2.$$\n  2. Evaluate new forces at the updated positions, $F_i(\\mathbf{R}(t+\\Delta t))$, and the corresponding new accelerations $a_i(t+\\Delta t) = F_i(\\mathbf{R}(t+\\Delta t))/m_i$.\n  3. Update velocities using the average of the old and new accelerations:\n     $$v_i(t+\\Delta t) = v_i(t) + \\frac{1}{2}\\big(a_i(t) + a_i(t+\\Delta t)\\big)\\,\\Delta t.$$\n- The electronic-structure oracle to be used in this problem returns the following model ground-state potential energy and forces. Let the set of bonds be specified as pairs with parameters $(i,j,k,r_0)$. The potential energy is the sum of harmonic bond contributions:\n  $$E(\\mathbf{R}) = \\sum_{\\text{bonds }(i,j)} \\frac{1}{2}k\\left(\\lvert R_j - R_i\\rvert - r_0\\right)^2,$$\n  and the force on atom $i$ from bond $(i,j)$ is the negative gradient of this energy. In one dimension with $R_j \\ge R_i$, the bond force on atom $j$ is $F_j = -k\\left((R_j-R_i)-r_0\\right)$ and on atom $i$ is $F_i = -F_j$; for $R_j < R_i$, replace $(R_j-R_i)$ by $\\lvert R_j-R_i\\rvert$ with the appropriate sign given by the derivative of the absolute value.\n- The total energy to be reported at the end of the step is\n  $$E_{\\text{tot}}(t+\\Delta t) = E(\\mathbf{R}(t+\\Delta t)) + \\sum_i \\frac{1}{2} m_i\\, v_i(t+\\Delta t)^2.$$\n\nTest suite:\nProvide results for the following four independent test cases. In each case, the system is one dimensional, and all arrays are ordered by atom index. Indices in the bond list are zero-based.\n\n- Test case A (zero force, stationary at equilibrium):\n  - Number of atoms: $2$.\n  - Masses: $\\big[m_0, m_1\\big] = \\big[1836, 1836\\big]$.\n  - Initial positions: $\\big[R_0(0), R_1(0)\\big] = \\big[0.0, 1.0\\big]$.\n  - Initial velocities: $\\big[v_0(0), v_1(0)\\big] = \\big[0.0, 0.0\\big]$.\n  - Time-step: $\\Delta t = 0.05$.\n  - Bonds: one bond $(i,j,k,r_0) = (0, 1, 0.5, 1.0)$.\n\n- Test case B (diatomic stretch, released from rest):\n  - Number of atoms: $2$.\n  - Masses: $\\big[m_0, m_1\\big] = \\big[1836, 1836\\big]$.\n  - Initial positions: $\\big[R_0(0), R_1(0)\\big] = \\big[0.0, 1.1\\big]$.\n  - Initial velocities: $\\big[v_0(0), v_1(0)\\big] = \\big[0.0, 0.0\\big]$.\n  - Time-step: $\\Delta t = 0.05$.\n  - Bonds: one bond $(i,j,k,r_0) = (0, 1, 0.5, 1.0)$.\n\n- Test case C (linear triatomic, symmetric stretch, middle atom heavier):\n  - Number of atoms: $3$.\n  - Masses: $\\big[m_0, m_1, m_2\\big] = \\big[1836, 3672, 1836\\big]$.\n  - Initial positions: $\\big[R_0(0), R_1(0), R_2(0)\\big] = \\big[0.0, 1.1, 2.2\\big]$.\n  - Initial velocities: $\\big[v_0(0), v_1(0), v_2(0)\\big] = \\big[0.0, 0.0, 0.0\\big]$.\n  - Time-step: $\\Delta t = 0.05$.\n  - Bonds: two bonds $(i,j,k,r_0) \\in \\{(0, 1, 0.7, 1.0), (1, 2, 0.7, 1.0)\\}$.\n\n- Test case D (boundary case $\\Delta t = 0$):\n  - Number of atoms: $2$.\n  - Masses: $\\big[m_0, m_1\\big] = \\big[1836, 1836\\big]$.\n  - Initial positions: $\\big[R_0(0), R_1(0)\\big] = \\big[0.0, 1.1\\big]$.\n  - Initial velocities: $\\big[v_0(0), v_1(0)\\big] = \\big[0.01, -0.02\\big]$.\n  - Time-step: $\\Delta t = 0.0$.\n  - Bonds: one bond $(i,j,k,r_0) = (0, 1, 0.5, 1.0)$.\n\nYour program must:\n- Implement the time-stepping update exactly as stated above.\n- Call the electronic-structure oracle exactly once at the initial positions (to obtain $E(\\mathbf{R}(0))$ and $\\mathbf{F}(\\mathbf{R}(0))$) and exactly once at the updated positions (to obtain $E(\\mathbf{R}(\\Delta t))$ and $\\mathbf{F}(\\mathbf{R}(\\Delta t))$) for each test case.\n- For each test case, compute $E_{\\text{tot}}(\\Delta t)$ and round it to eight decimal places in Hartree.\n\nFinal output format:\n- Your program should produce a single line of output containing the four results as a comma-separated list enclosed in square brackets, e.g., $\\big[\\text{result}_A,\\text{result}_B,\\text{result}_C,\\text{result}_D\\big]$, where each entry is a floating-point number formatted to eight digits after the decimal point, in Hartree.", "solution": "The problem has been validated and is deemed scientifically grounded, well-posed, and objective. It presents a standard computational task in the field of theoretical chemistry. No flaws were found. A solution is therefore provided.\n\nThe problem requires the implementation of a single time-step of Born-Oppenheimer molecular dynamics (BOMD) for a one-dimensional system of point nuclei. The dynamics are governed by classical Newtonian mechanics on a potential energy surface (PES) provided by an electronic structure oracle. All calculations are performed in atomic units.\n\nFirst, we define the physical model. The Born-Oppenheimer approximation assumes that the electronic and nuclear motions are decoupled. This allows for the concept of a PES, $E(\\mathbf{R})$, where the total electronic energy is a function of the nuclear coordinates $\\mathbf{R} = \\{R_i\\}$. The nuclei are treated as classical point particles with masses $\\{m_i\\}$ moving according to Newton's second law, where the force on each nucleus is derived from the PES:\n$$\n\\mathbf{F}(\\mathbf{R}) = -\\nabla_{\\mathbf{R}} E(\\mathbf{R}) \\implies F_i(\\mathbf{R}) = -\\frac{\\partial E(\\mathbf{R})}{\\partial R_i}\n$$\nThe acceleration of each nucleus is then given by $a_i(t) = F_i(\\mathbf{R}(t)) / m_i$.\n\nThe specific PES for this problem is a sum of harmonic bond potentials:\n$$\nE(\\mathbf{R}) = \\sum_{\\text{bonds }(i,j)} E_{ij}(R_i, R_j) = \\sum_{\\text{bonds }(i,j)} \\frac{1}{2}k\\left(\\lvert R_j - R_i\\rvert - r_0\\right)^2\n$$\nwhere for each bond $(i, j)$, $k$ is the force constant and $r_0$ is the equilibrium bond length. The force on atom $j$ due to the bond with atom $i$ is:\n$$\nF_{j \\leftarrow ij} = -\\frac{\\partial E_{ij}}{\\partial R_j} = -k\\left(\\lvert R_j - R_i\\rvert - r_0\\right) \\frac{\\partial \\lvert R_j - R_i\\rvert}{\\partial R_j} = -k\\left(\\lvert R_j - R_i\\rvert - r_0\\right) \\text{sgn}(R_j - R_i)\n$$\nBy Newton's third law, the force on atom $i$ from this bond is $F_{i \\leftarrow ij} = -F_{j \\leftarrow ij}$. The total force on any given atom $i$, $F_i$, is the vector sum of forces from all bonds it participates in.\n\nTo propagate the system in time from $t$ to $t+\\Delta t$, a numerical integration scheme is required. The problem specifies an algorithm which is a form of the well-known Velocity Verlet integrator. The procedure for a single time-step is as follows:\n\n1.  **Given**: At time $t$, the positions $\\mathbf{R}(t)$, velocities $\\mathbf{v}(t)$, and accelerations $\\mathbf{a}(t)$ are known. The accelerations are computed from the forces at the current positions: $\\mathbf{a}(t) = \\mathbf{F}(\\mathbf{R}(t)) / \\mathbf{m}$.\n\n2.  **Position Update**: The new positions $\\mathbf{R}(t+\\Delta t)$ are calculated using a Taylor expansion to second order:\n    $$\n    R_i(t+\\Delta t) = R_i(t) + v_i(t)\\Delta t + \\frac{1}{2}a_i(t)\\Delta t^2\n    $$\n\n3.  **Force/Acceleration Update**: With the new positions $\\mathbf{R}(t+\\Delta t)$, the forces $\\mathbf{F}(\\mathbf{R}(t+\\Delta t))$ are re-evaluated using the electronic structure oracle. The new accelerations $\\mathbf{a}(t+\\Delta t)$ are then computed:\n    $$\n    a_i(t+\\Delta t) = F_i(\\mathbf{R}(t+\\Delta t)) / m_i\n    $$\n\n4.  **Velocity Update**: The new velocities $\\mathbf{v}(t+\\Delta t)$ are calculated using the average of the old and new accelerations. This step is characteristic of the Velocity Verlet algorithm and is responsible for its good energy conservation properties.\n    $$\n    v_i(t+\\Delta t) = v_i(t) + \\frac{1}{2}\\left(a_i(t) + a_i(t+\\Delta t)\\right)\\Delta t\n    $$\n\nFinally, the total energy of the system at the end of the time-step, $t+\\Delta t$, is computed. This is the sum of the potential energy at the new positions, $E(\\mathbf{R}(t+\\Delta t))$, and the kinetic energy calculated with the new velocities, $K(\\mathbf{v}(t+\\Delta t))$:\n$$\nE_{\\text{tot}}(t+\\Delta t) = E(\\mathbf{R}(t+\\Delta t)) + K(\\mathbf{v}(t+\\Delta t)) = E(\\mathbf{R}(t+\\Delta t)) + \\sum_i \\frac{1}{2} m_i v_i(t+\\Delta t)^2\n$$\nThis quantity is the required output for each test case, rounded to eight decimal places. The implementation will consist of a function to calculate the energy and forces from the given potential model and a main propagator function that executes the steps outlined above.", "answer": "```python\nimport numpy as np\n\ndef compute_energy_and_forces(positions, bonds):\n    \"\"\"\n    Computes the potential energy and forces for a given set of atomic positions.\n    This function acts as the electronic-structure oracle.\n\n    Args:\n        positions (np.ndarray): 1D array of atomic positions.\n        bonds (list): List of bond tuples (i, j, k, r0).\n\n    Returns:\n        tuple: A tuple containing:\n            - potential_energy (float): The total potential energy in Hartree.\n            - forces (np.ndarray): 1D array of forces on each atom in Hartree/bohr.\n    \"\"\"\n    num_atoms = len(positions)\n    potential_energy = 0.0\n    forces = np.zeros(num_atoms, dtype=np.float64)\n\n    for i, j, k, r0 in bonds:\n        pos_i = positions[i]\n        pos_j = positions[j]\n\n        # Calculate bond vector and distance (scalar in 1D)\n        r_ij_vec = pos_j - pos_i\n        r_ij_mag = np.abs(r_ij_vec)\n\n        # Potential energy contribution\n        displacement = r_ij_mag - r0\n        potential_energy += 0.5 * k * displacement**2\n\n        # Force calculation: F = -grad(E) = -k * ( |r| - r0 ) * grad(|r|)\n        # The term grad_j(|r_j - r_i|) is sgn(r_j - r_i), which is r_ij_vec / r_ij_mag\n        if r_ij_mag > 1e-12:  # Avoid division by zero for coincident atoms\n            force_on_j = -k * displacement * (r_ij_vec / r_ij_mag)\n        else:\n            force_on_j = 0.0\n        \n        forces[j] += force_on_j\n        forces[i] -= force_on_j # Newton's third law\n\n    return potential_energy, forces\n\ndef run_timestep(masses, initial_positions, initial_velocities, bonds, dt):\n    \"\"\"\n    Performs a single time-step of Born-Oppenheimer Molecular Dynamics.\n\n    Args:\n        masses (np.ndarray): Array of atomic masses.\n        initial_positions (np.ndarray): Array of initial atomic positions.\n        initial_velocities (np.ndarray): Array of initial atomic velocities.\n        bonds (list): List of bond tuples.\n        dt (float): The time-step duration.\n\n    Returns:\n        float: The total energy (potential + kinetic) after the time-step.\n    \"\"\"\n    masses_arr = np.array(masses, dtype=np.float64)\n    R_t = np.array(initial_positions, dtype=np.float64)\n    v_t = np.array(initial_velocities, dtype=np.float64)\n\n    # Step 0: Calculate forces and accelerations at time t\n    _, F_t = compute_energy_and_forces(R_t, bonds)\n    a_t = F_t / masses_arr\n\n    # Step 1: Update positions to get R(t + dt)\n    R_t_dt = R_t + v_t * dt + 0.5 * a_t * dt**2\n\n    # Step 2: Calculate forces and accelerations at time t + dt\n    E_t_dt, F_t_dt = compute_energy_and_forces(R_t_dt, bonds)\n    a_t_dt = F_t_dt / masses_arr\n\n    # Step 3: Update velocities to get v(t + dt)\n    v_t_dt = v_t + 0.5 * (a_t + a_t_dt) * dt\n\n    # Step 4: Calculate final total energy at t + dt\n    kinetic_energy_final = 0.5 * np.sum(masses_arr * v_t_dt**2)\n    total_energy_final = E_t_dt + kinetic_energy_final\n\n    return total_energy_final\n\ndef solve():\n    \"\"\"\n    Defines and runs the test cases, then prints the results.\n    \"\"\"\n    # Test cases defined in the problem statement\n    test_cases = [\n        { # Case A\n            \"masses\": [1836, 1836],\n            \"initial_positions\": [0.0, 1.0],\n            \"initial_velocities\": [0.0, 0.0],\n            \"dt\": 0.05,\n            \"bonds\": [(0, 1, 0.5, 1.0)]\n        },\n        { # Case B\n            \"masses\": [1836, 1836],\n            \"initial_positions\": [0.0, 1.1],\n            \"initial_velocities\": [0.0, 0.0],\n            \"dt\": 0.05,\n            \"bonds\": [(0, 1, 0.5, 1.0)]\n        },\n        { # Case C\n            \"masses\": [1836, 3672, 1836],\n            \"initial_positions\": [0.0, 1.1, 2.2],\n            \"initial_velocities\": [0.0, 0.0, 0.0],\n            \"dt\": 0.05,\n            \"bonds\": [(0, 1, 0.7, 1.0), (1, 2, 0.7, 1.0)]\n        },\n        { # Case D\n            \"masses\": [1836, 1836],\n            \"initial_positions\": [0.0, 1.1],\n            \"initial_velocities\": [0.01, -0.02],\n            \"dt\": 0.0,\n            \"bonds\": [(0, 1, 0.5, 1.0)]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_timestep(\n            case[\"masses\"],\n            case[\"initial_positions\"],\n            case[\"initial_velocities\"],\n            case[\"bonds\"],\n            case[\"dt\"]\n        )\n        results.append(f\"{result:.8f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2451186"}, {"introduction": "Once a trajectory is generated, a critical step is to validate its physical realism. In the microcanonical ensemble, total energy should be conserved, but numerical simulations introduce approximations that can violate this principle. This thought experiment [@problem_id:2451175] challenges you to diagnose the source of energy drift in a BOMD simulation, distinguishing between errors arising from the finite integration timestep and those unique to *ab initio* dynamics, namely the imperfect convergence of the electronic self-consistent field (SCF) calculation.", "problem": "You run Born-Oppenheimer molecular dynamics (BOMD), where at each nuclear configuration the electronic ground state is computed and the nuclei are propagated according to Newton’s equations on the resulting potential energy surface. The simulation is in the microcanonical ensemble (NVE), with no thermostat or barostat, and uses a standard time-reversible, symplectic integrator. Over a long trajectory, you observe that the total energy $E_{\\mathrm{tot}}(t)$ increases approximately linearly with time $t$. Which of the following is the more likely primary cause of this behavior?\n\nA. An overly large timestep $ \\Delta t $, because it produces secular growth of $E_{\\mathrm{tot}}(t)$ in symplectic integrators.\n\nB. An unconverged self-consistent field (SCF) at each step, because the resulting forces are not exactly conservative.\n\nC. Both are equally likely in standard BOMD, because both mechanisms produce comparable linear drifts.\n\nD. Neither; in exact BOMD $E_{\\mathrm{tot}}(t)$ is strictly constant, so the observed trend must be a plotting artifact unrelated to the dynamics.", "solution": "The problem statement must first be validated for scientific soundness and logical consistency.\n\n**Step 1: Extract Givens**\n- The simulation method is Born-Oppenheimer molecular dynamics (BOMD).\n- The electronic state is the ground state, computed at each nuclear configuration.\n- Nuclear motion follows Newton’s equations on the ground-state potential energy surface.\n- The thermodynamic ensemble is microcanonical (NVE), meaning constant number of particles ($N$), volume ($V$), and total energy ($E$).\n- No thermostat or barostat is applied.\n- The numerical integrator for nuclear motion is a standard time-reversible, symplectic integrator.\n- The primary observation is that the total energy, $E_{\\mathrm{tot}}(t)$, exhibits an approximate linear increase with time $t$ over a long trajectory.\n- The question asks for the \"more likely primary cause\" of this observed linear energy drift.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem describes a standard computational chemistry simulation. All concepts—BOMD, NVE ensemble, symplectic integrators, self-consistent field (SCF) calculations for the electronic ground state, and energy conservation—are fundamental to the field. The observation of energy drift is a well-documented and highly relevant practical issue in such simulations. The problem is scientifically grounded, well-posed, and objective. It is free from contradictions, ambiguities, or factual errors.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A rigorous solution can be derived.\n\n**Derivation of the Solution**\nIn the microcanonical (NVE) ensemble, the total energy of the system, $E_{\\mathrm{tot}}$, should be a conserved quantity. The total energy is the sum of the nuclear kinetic energy $T_{\\mathrm{nuc}}$ and the potential energy $V$. In the context of BOMD, the potential energy is the electronic ground state energy $E_{0}$.\n$$E_{\\mathrm{tot}} = T_{\\mathrm{nuc}}(\\{\\dot{\\mathbf{R}}_I(t)\\}) + E_{0}(\\{\\mathbf{R}_I(t)\\})$$\nwhere $\\{\\mathbf{R}_I\\}$ and $\\{\\dot{\\mathbf{R}}_I\\}$ are the positions and velocities of the nuclei, respectively.\n\nEnergy conservation holds if and only if the forces acting on the particles are conservative, meaning they can be expressed as the negative gradient of a time-independent potential energy function, $\\mathbf{F}_I = -\\nabla_{\\mathbf{R}_I} V(\\{\\mathbf{R}_I\\})$. In an ideal BOMD simulation, the force on nucleus $I$ is precisely this:\n$$\\mathbf{F}_I(t) = -\\nabla_{\\mathbf{R}_I} E_{0}(\\{\\mathbf{R}_I(t)\\})$$\nIf these forces were computed exactly and the equations of motion were integrated exactly, $E_{\\mathrm{tot}}$ would be strictly conserved. The problem states that $E_{\\mathrm{tot}}$ is not conserved but instead drifts linearly. We must analyze the sources of non-conservation in a practical BOMD simulation.\n\nTwo primary sources of error exist in any numerical MD simulation:\n1.  **Discretization of time**: Newton's equations are integrated using a finite timestep, $\\Delta t$.\n2.  **Force evaluation**: The forces themselves may not be exact.\n\nLet us analyze the effect of each source of error in the context of the problem.\n\nThe problem specifies the use of a \"standard time-reversible, symplectic integrator\" (e.g., the Velocity Verlet algorithm). A key property of symplectic integrators is that they do not conserve the true Hamiltonian $H$ of the system. Instead, they exactly conserve a nearby \"shadow\" Hamiltonian, $H'$. For sufficiently small timesteps $\\Delta t$, the difference between $H$ and $H'$ is small. Consequently, the energy $E_{\\mathrm{tot}}$ computed from the true Hamiltonian does not drift secularly (i.e., linearly or quadratically) with time. Instead, it exhibits bounded oscillations around a constant mean value. The amplitude of these oscillations scales with the timestep (e.g., as $(\\Delta t)^2$ for Velocity Verlet), but there is no systematic, long-term drift. Therefore, a large timestep $\\Delta t$ would increase the amplitude of energy fluctuations but would not, by itself, cause a linear drift.\n\nThe second source of error is in the force calculation. In BOMD, the potential energy $E_{0}(\\{\\mathbf{R}_I\\})$ is determined by solving the electronic structure problem, typically using a self-consistent field (SCF) method (e.g., Hartree-Fock or Density Functional Theory). This iterative procedure is terminated when a certain convergence criterion is met. In practice, this criterion is never infinitely strict. Let the incompletely converged electronic energy at a given configuration $\\mathbf{R}$ be $E_{0}^{\\mathrm{SCF}}(\\mathbf{R})$. The forces used to propagate the nuclei are then $\\mathbf{F}_I^{\\mathrm{SCF}} = -\\nabla_{\\mathbf{R}_I} E_{0}^{\\mathrm{SCF}}(\\mathbf{R})$.\n\nBecause the SCF convergence contains a small, residual error at each timestep, the force $\\mathbf{F}^{\\mathrm{SCF}}(\\mathbf{R}(t))$ is not the exact gradient of a single, consistent potential energy surface $V(\\mathbf{R})$. The \"noise\" introduced by the incomplete convergence means that the effective potential energy surface is slightly different at each timestep. This \"force noise\" breaks the condition that the forces must be conservative. Non-conservative forces do not conserve energy. When integrated over many timesteps, the work done by the non-conservative component of the force can accumulate, leading to a systematic drift in the total energy. This drift is often observed to be approximately linear over long timescales. This phenomenon is a well-known artifact in BOMD and is often referred to as \"SCF noise-induced heating.\"\n\nWe now evaluate the given options.\n\n**Option A: An overly large timestep $ \\Delta t $, because it produces secular growth of $E_{\\mathrm{tot}}(t)$ in symplectic integrators.**\nThis statement is **Incorrect**. A defining feature of symplectic integrators is the *absence* of secular energy drift. They are specifically chosen for long-term simulations *because* they provide excellent long-term energy conservation, characterized by bounded oscillations rather than a systematic drift. Secular energy drift is a hallmark of non-symplectic integrators (e.g., the forward Euler method).\n\n**Option B: An unconverged self-consistent field (SCF) at each step, because the resulting forces are not exactly conservative.**\nThis statement is **Correct**. As derived above, the iterative nature of the SCF procedure means that the electronic energy and its gradient (the forces) are never computed to infinite precision. The residual error in the forces from one step to the next makes them non-conservative. A non-conservative force field does not lead to the conservation of total energy. This effect is known to cause a systematic, often linear, drift in the total energy over long simulation times. This is the most plausible physical explanation for the observed phenomenon in a BOMD simulation.\n\n**Option C: Both are equally likely in standard BOMD, because both mechanisms produce comparable linear drifts.**\nThis statement is **Incorrect**. As established in the analysis of Option A, a symplectic integrator does not cause linear drift. Therefore, the two proposed mechanisms do not produce comparable linear drifts. One mechanism (unconverged SCF) produces a linear drift, while the other (symplectic integrator with large $\\Delta t$) produces bounded oscillations. They are not \"equally likely\" to be the cause of the observed behavior.\n\n**Option D: Neither; in exact BOMD $E_{\\mathrm{tot}}(t)$ is strictly constant, so the observed trend must be a plotting artifact unrelated to the dynamics.**\nThis statement is **Incorrect**. While the premise that total energy in *exact* BOMD is constant is true, the conclusion is flawed. A practical simulation is never exact. Dismissing a systematic, reproducible numerical result as a \"plotting artifact\" is unscientific. The observed energy drift is a real effect stemming from the inherent numerical approximations in the simulation protocol, specifically the incomplete convergence of the SCF. The effect is directly related to the dynamics, as it is caused by the errors in the forces that govern said dynamics.\n\n**Conclusion**\nThe primary cause of a linear drift in total energy in a BOMD simulation run in the NVE ensemble with a symplectic integrator is the non-conservative nature of the forces arising from incompletely converged SCF calculations at each timestep.", "answer": "$$\\boxed{B}$$", "id": "2451175"}, {"introduction": "The ultimate purpose of a BOMD simulation is to connect microscopic dynamics to macroscopic, experimentally relevant properties. This final practice [@problem_id:2877597] guides you through this process, showing how to extract fundamental thermodynamic quantities such as temperature, pressure, and heat capacity from the statistical analysis of a trajectory. Mastering this skill involves not only applying the correct formulas from statistical mechanics but also understanding the crucial step of estimating the statistical uncertainty of your results, a prerequisite for any meaningful scientific conclusion.", "problem": "A finite-temperature Born-Oppenheimer molecular dynamics (BOMD) simulation is run for a periodic system of $N$ atoms, sampling the canonical ensemble (constant number of particles, volume, and temperature; NVT) using a weak Nosé–Hoover thermostat that yields canonical statistics for the nuclear coordinates and momenta. The electronic structure is converged such that Pulay forces and Pulay stress are negligible (e.g., a plane-wave basis set with sufficient cutoff). The center-of-mass linear momentum of the nuclei is constrained to zero.\n\nYou are given the following statistically stationary trajectory data and system parameters:\n- Number of atoms: $N = 20$.\n- Number of unconstrained quadratic degrees of freedom: $f = 3N - 3$.\n- Periodic cell volume: $V = 4.0000 \\times 10^{-26}\\ \\mathrm{m}^{3}$.\n- Time step: $\\Delta t = 0.5\\ \\mathrm{fs}$.\n- Number of saved steps: $M = 200000$.\n- Time-averaged kinetic energy of the nuclei: $\\langle K \\rangle = 1.180495 \\times 10^{-19}\\ \\mathrm{J}$.\n- Time-averaged virial (the configurational contribution), defined as $\\Phi \\equiv \\sum_{i} \\mathbf{r}_{i} \\cdot \\mathbf{F}_{i}$, averaged over the trajectory: $\\langle \\Phi \\rangle = -2.239000 \\times 10^{-19}\\ \\mathrm{J}$.\n- Sample variance of the total energy (nuclear kinetic plus potential), computed from the trajectory: $s_{E}^{2} = 1.029000 \\times 10^{-39}\\ \\mathrm{J}^{2}$.\n- Integrated autocorrelation times (obtained from block analysis) for the observables: $\\tau_{K} = 0.20\\ \\mathrm{ps}$, $\\tau_{\\Phi} = 0.50\\ \\mathrm{ps}$, and $\\tau_{E} = 0.50\\ \\mathrm{ps}$.\n\nAssume classical nuclei and that the thermostat samples the canonical distribution for the physical nuclear degrees of freedom. Use the exact Boltzmann constant $k_{B} = 1.380649 \\times 10^{-23}\\ \\mathrm{J}\\,\\mathrm{K}^{-1}$.\n\nTasks:\n1) Starting from the equipartition theorem for classical quadratic degrees of freedom and the definition of thermodynamic temperature, derive an estimator for the temperature $T$ from a BOMD trajectory in terms of the time-averaged nuclear kinetic energy and the number of unconstrained quadratic degrees of freedom. Then compute the numerical value of $T$ in $\\mathrm{K}$.\n\n2) Starting from the virial theorem and the mechanical definition of pressure in molecular dynamics, derive an estimator for the pressure $P$ in terms of the time-averaged kinetic energy, the time-averaged virial $\\langle \\Phi \\rangle$, and the volume $V$. Then compute the numerical value of $P$ in $\\mathrm{Pa}$.\n\n3) Starting from the canonical ensemble definition of the constant-volume heat capacity $C_{V}$, derive an estimator that uses fluctuations of the total energy. Then express the per-atom heat capacity in units of $k_{B}$ as $c_{V} \\equiv C_{V}/(N k_{B})$ in terms of the sample variance $s_{E}^{2}$ and the temperature $T$. Compute the numerical value of $c_{V}$ as a dimensionless number.\n\n4) Discuss, without inserting numerical values, how to estimate the standard errors (statistical uncertainties) of the estimators in parts (1)–(3) from a finite, time-correlated trajectory by using the integrated autocorrelation time to determine an effective sample size. Write down the formulas you would use for the standard errors of the mean-based estimators and for the variance-based estimator, and explain how you would propagate uncertainties to obtain the uncertainty of $c_{V}$.\n\nProvide the final answer as the dimensionless per-atom heat capacity $c_{V}$ in units of $k_{B}$, rounded to four significant figures. Do not include units in your final boxed answer; all intermediate quantities must carry the appropriate physical units.", "solution": "The problem as stated is scientifically sound, well-posed, and contains all necessary information for a complete solution. We proceed with the derivations and calculations for the four tasks.\n\n1) Derivation and calculation of Temperature ($T$)\n\nThe system is described by classical mechanics and samples the canonical ensemble. According to the equipartition theorem, the average energy associated with each unconstrained quadratic degree of freedom is $\\frac{1}{2} k_{B} T$, where $k_{B}$ is the Boltzmann constant and $T$ is the thermodynamic temperature.\n\nThe kinetic energy of the $N$ nuclei is a sum of quadratic terms in momentum: $K = \\sum_{i=1}^{N} \\frac{|\\mathbf{p}_{i}|^2}{2m_{i}}$. The total number of such terms is $3N$. The problem states that the center-of-mass momentum is constrained to zero, which removes $3$ translational degrees of freedom. Therefore, the number of unconstrained quadratic degrees of freedom for the kinetic energy is $f = 3N - 3$.\n\nThe time-averaged nuclear kinetic energy, $\\langle K \\rangle$, must be equal to the ensemble average. By the equipartition theorem:\n$$\n\\langle K \\rangle = \\frac{f}{2} k_{B} T\n$$\nFrom this, we derive the estimator for the temperature $T$:\n$$\nT = \\frac{2 \\langle K \\rangle}{f k_{B}}\n$$\nWe are given the following values:\n- Number of atoms: $N = 20$.\n- Time-averaged kinetic energy: $\\langle K \\rangle = 1.180495 \\times 10^{-19}\\ \\mathrm{J}$.\n- Boltzmann constant: $k_{B} = 1.380649 \\times 10^{-23}\\ \\mathrm{J}\\,\\mathrm{K}^{-1}$.\n\nFirst, we compute the number of degrees of freedom:\n$f = 3N - 3 = 3(20) - 3 = 57$.\n\nNow, we compute the temperature:\n$$\nT = \\frac{2 \\times (1.180495 \\times 10^{-19}\\ \\mathrm{J})}{57 \\times (1.380649 \\times 10^{-23}\\ \\mathrm{J}\\,\\mathrm{K}^{-1})} = \\frac{2.36099 \\times 10^{-19}\\ \\mathrm{J}}{7.8696993 \\times 10^{-22}\\ \\mathrm{J}\\,\\mathrm{K}^{-1}} \\approx 300.011\\ \\mathrm{K}\n$$\n\n2) Derivation and calculation of Pressure ($P$)\n\nThe mechanical pressure $P$ in a periodic system is given by the trace of the ensemble-averaged pressure tensor $\\langle \\boldsymbol{\\sigma} \\rangle$. The instantaneous pressure tensor is defined as:\n$$\n\\boldsymbol{\\sigma} = \\frac{1}{V} \\left( \\sum_{i=1}^{N} m_{i} \\mathbf{v}_{i} \\otimes \\mathbf{v}_{i} + \\sum_{i=1}^{N} \\mathbf{r}_{i} \\otimes \\mathbf{F}_{i} \\right)\n$$\nwhere $V$ is the volume, $m_i$, $\\mathbf{v}_i$, and $\\mathbf{r}_i$ are the mass, velocity, and position of atom $i$, respectively, and $\\mathbf{F}_i$ is the total force on atom $i$ from all other atoms. The symbol $\\otimes$ denotes the tensor product.\n\nThe hydrostatic pressure is $P = \\frac{1}{3} \\mathrm{Tr}(\\langle \\boldsymbol{\\sigma} \\rangle)$. Taking the trace of the instantaneous tensor:\n$$\n\\mathrm{Tr}(\\boldsymbol{\\sigma}) = \\frac{1}{V} \\left( \\sum_{i=1}^{N} m_{i} |\\mathbf{v}_{i}|^2 + \\sum_{i=1}^{N} \\mathbf{r}_{i} \\cdot \\mathbf{F}_{i} \\right)\n$$\nThe first term is twice the total kinetic energy, $\\sum_{i} m_{i} |\\mathbf{v}_{i}|^2 = 2K$. The second term is the virial of the forces, which is given as $\\Phi = \\sum_{i} \\mathbf{r}_{i} \\cdot \\mathbf{F}_{i}$. Thus, the estimator for pressure is the time average of this expression:\n$$\nP = \\frac{1}{3V} \\langle 2K + \\Phi \\rangle = \\frac{2\\langle K \\rangle + \\langle \\Phi \\rangle}{3V}\n$$\nWe are given:\n- $\\langle K \\rangle = 1.180495 \\times 10^{-19}\\ \\mathrm{J}$.\n- Time-averaged virial: $\\langle \\Phi \\rangle = -2.239000 \\times 10^{-19}\\ \\mathrm{J}$.\n- Volume: $V = 4.0000 \\times 10^{-26}\\ \\mathrm{m}^{3}$.\n\nSubstituting these values:\n$$\nP = \\frac{2(1.180495 \\times 10^{-19}\\ \\mathrm{J}) + (-2.239000 \\times 10^{-19}\\ \\mathrm{J})}{3 \\times (4.0000 \\times 10^{-26}\\ \\mathrm{m}^{3})} = \\frac{1.2199 \\times 10^{-20}\\ \\mathrm{J}}{1.20000 \\times 10^{-25}\\ \\mathrm{m}^{3}} \\approx 1.0166 \\times 10^5\\ \\mathrm{Pa}\n$$\n\n3) Derivation and calculation of Heat Capacity ($c_{V}$)\n\nThe constant-volume heat capacity, $C_{V}$, is defined as the partial derivative of the average total energy $\\langle E \\rangle$ with respect to temperature $T$ at constant volume $V$:\n$$\nC_{V} = \\left( \\frac{\\partial \\langle E \\rangle}{\\partial T} \\right)_{V}\n$$\nIn the canonical (NVT) ensemble, this derivative can be expressed in terms of energy fluctuations. Using the statistical mechanical definition of $\\langle E \\rangle$ and the relation $\\beta = (k_{B}T)^{-1}$:\n$$\n\\frac{\\partial \\langle E \\rangle}{\\partial T} = \\frac{\\partial \\langle E \\rangle}{\\partial \\beta} \\frac{d\\beta}{dT} = \\frac{\\partial \\langle E \\rangle}{\\partial \\beta} \\left( -\\frac{1}{k_{B}T^2} \\right)\n$$\nThe derivative of $\\langle E \\rangle$ with respect to $\\beta$ is a standard result:\n$$\n\\frac{\\partial \\langle E \\rangle}{\\partial \\beta} = -(\\langle E^2 \\rangle - \\langle E \\rangle^2) = -\\mathrm{Var}(E)\n$$\nCombining these gives the fluctuation formula for heat capacity:\n$$\nC_{V} = \\frac{\\mathrm{Var}(E)}{k_{B} T^2}\n$$\nThe problem provides the sample variance of the total energy, $s_{E}^{2}$, which is our estimator for $\\mathrm{Var}(E)$. Thus, the estimator for $C_{V}$ is:\n$$\nC_{V} \\approx \\frac{s_{E}^{2}}{k_{B} T^2}\n$$\nWe are asked for the per-atom heat capacity in units of $k_{B}$, defined as $c_{V} \\equiv C_{V}/(N k_{B})$. Substituting our expression for $C_V$:\n$$\nc_{V} = \\frac{1}{N k_{B}} \\left( \\frac{s_{E}^{2}}{k_{B} T^2} \\right) = \\frac{s_{E}^{2}}{N k_{B}^2 T^2}\n$$\nWe are given:\n- Sample variance of total energy: $s_{E}^{2} = 1.029000 \\times 10^{-39}\\ \\mathrm{J}^{2}$.\n- $N = 20$, $k_{B} = 1.380649 \\times 10^{-23}\\ \\mathrm{J}\\,\\mathrm{K}^{-1}$.\n- And from part 1, $T \\approx 300.011\\ \\mathrm{K}$.\n\nWe compute the denominator $N k_{B}^2 T^2$:\n$$\nN k_{B}^2 T^2 = 20 \\times (1.380649 \\times 10^{-23}\\ \\mathrm{J}\\,\\mathrm{K}^{-1})^2 \\times (300.011\\ \\mathrm{K})^2 \\approx 3.43138 \\times 10^{-40}\\ \\mathrm{J}^2\n$$\nNow we compute the dimensionless value of $c_{V}$:\n$$\nc_{V} = \\frac{1.029000 \\times 10^{-39}\\ \\mathrm{J}^{2}}{3.43138 \\times 10^{-40}\\ \\mathrm{J}^2} \\approx 2.9986\n$$\n\n4) Discussion of statistical error estimation\n\nThe estimators for $T$, $P$, and $C_V$ are computed from a finite, time-correlated trajectory. To estimate the standard error (SE) of these quantities, one must account for this correlation. The concept of an effective sample size, $N_{\\text{eff}}$, is used. For an observable $A$ with an integrated autocorrelation time $\\tau_A$, sampled over a total simulation time $T_{\\text{sim}} = M \\Delta t$, the number of effectively independent samples is $N_{\\text{eff}} = T_{\\text{sim}} / (2\\tau_A)$.\n\nFor estimators based on the mean of an observable $A$ (e.g., $T$ from $\\langle K \\rangle$ and $P$ from $\\langle 2K+\\Phi \\rangle$), the standard error of the mean is:\n$$\n\\mathrm{SE}(\\langle A \\rangle) = \\sqrt{\\frac{\\mathrm{Var}(A)}{N_{\\text{eff}}}} = \\sqrt{\\frac{2\\tau_A}{T_{\\text{sim}}}\\mathrm{Var}(A)}\n$$\nwhere $\\mathrm{Var}(A)$ is the variance of the observable $A$ over the trajectory.\n\n- For temperature, $T = \\frac{2\\langle K \\rangle}{f k_{B}}$, the uncertainty is propagated from $\\langle K \\rangle$:\n$\\mathrm{SE}(T) = \\frac{2}{f k_{B}} \\mathrm{SE}(\\langle K \\rangle)$, where $\\mathrm{SE}(\\langle K \\rangle) = \\sqrt{\\frac{2\\tau_K}{T_{\\text{sim}}}\\mathrm{Var}(K)}$.\n\n- For pressure, $P = \\frac{\\langle 2K+\\Phi \\rangle}{3V}$, it is best to define a new observable $\\Pi = 2K+\\Phi$ and calculate its autocorrelation time $\\tau_{\\Pi}$ and variance $\\mathrm{Var}(\\Pi)$. The uncertainty is then:\n$\\mathrm{SE}(P) = \\frac{1}{3V} \\mathrm{SE}(\\langle \\Pi \\rangle)$, with $\\mathrm{SE}(\\langle \\Pi \\rangle) = \\sqrt{\\frac{2\\tau_{\\Pi}}{T_{\\text{sim}}}\\mathrm{Var}(\\Pi)}$.\n\nFor estimators based on variance (e.g., $C_V$ from $s_E^2$), the error analysis is more complex. The standard error of the sample variance $s_E^2$ can be approximated, assuming the distribution of $E$ is nearly Gaussian, as:\n$$\n\\mathrm{SE}(s_E^2) \\approx s_E^2 \\sqrt{\\frac{2}{N_{\\text{eff},E}-1}}\n$$\nwhere $N_{\\text{eff},E} = T_{\\text{sim}} / (2\\tau_E)$.\n\nTo find the standard error of $c_V = \\frac{s_{E}^{2}}{N k_{B}^2 T^2}$, one must propagate the uncertainties from both $s_E^2$ and $T$:\n$$\n\\left(\\frac{\\mathrm{SE}(c_V)}{c_V}\\right)^2 = \\left(\\frac{\\mathrm{SE}(s_E^2)}{s_E^2}\\right)^2 + \\left(-2 \\frac{\\mathrm{SE}(T)}{T}\\right)^2 + 2 \\frac{(-2)}{T s_E^2} \\mathrm{Cov}(s_E^2, T)\n$$\nAssuming the covariance between the estimators for $T$ and $s_E^2$ is negligible, the relative error simplifies to:\n$$\n\\frac{\\mathrm{SE}(c_V)}{c_V} \\approx \\sqrt{\\left(\\frac{\\mathrm{SE}(s_E^2)}{s_E^2}\\right)^2 + 4\\left(\\frac{\\mathrm{SE}(T)}{T}\\right)^2}\n$$\nThis formula combines the relative uncertainty in the energy variance and the temperature to estimate the final uncertainty in the dimensionless heat capacity.", "answer": "$$\\boxed{2.999}$$", "id": "2877597"}]}