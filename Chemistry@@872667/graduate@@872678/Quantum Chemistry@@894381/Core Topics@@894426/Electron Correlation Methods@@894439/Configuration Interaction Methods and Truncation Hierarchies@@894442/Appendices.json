{"hands_on_practices": [{"introduction": "The power of the Configuration Interaction (CI) method lies in its systematic improvability, but this comes at a steep price. Before diving into the complexities of constructing and diagonalizing the CI matrix, it is crucial to first appreciate the sheer size of the problem space. This exercise [@problem_id:2881654] will guide you through the fundamental combinatorial counting of excited determinants, providing a direct glimpse into the 'exponential wall' that limits the applicability of highly-truncated CI methods and motivates the entire field of efficient electron correlation models.", "problem": "Consider a single-reference Configuration Interaction (CI) expansion built from a Hartree–Fock (HF) determinant in a spin-orbital basis. Let $n_o$ denote the number of occupied spin-orbitals in an active space and $n_v$ denote the number of virtual spin-orbitals in that same space. An excitation of rank $k$ replaces $k$ distinct occupied spin-orbitals by $k$ distinct virtual spin-orbitals, generating a new Slater determinant. Assume that determinants are constructed directly in the spin-orbital representation (no spin adaptation), and that the CI space at a given truncation rank includes the HF reference determinant and all distinct Slater determinants with excitation rank up to the truncation. \n\nStarting from standard definitions of Slater determinants and electron excitations in second quantization, derive a general counting expression for the number of distinct $k$-fold excited determinants in terms of $n_o$ and $n_v$, and thereby obtain the total dimension of the truncated CI space at the singles (Configuration Interaction Singles, CIS), singles and doubles (Configuration Interaction Singles and Doubles, CISD), and singles, doubles, and triples (Configuration Interaction Singles, Doubles, and Triples, CISDT) levels. \n\nThen, for an effective active-space model of a water system with $n_o=5$ occupied and $n_v=10$ virtual spin-orbitals, evaluate the CIS, CISD, and CISDT dimensions numerically as exact integers. Finally, briefly discuss the computational implications of these dimensions for Hamiltonian construction and diagonalization within CI.\n\nProvide your final numerical results for the CIS, CISD, and CISDT dimensions as three exact integers. No rounding is required. The final answer must contain only these three values.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- The system is a single-reference Configuration Interaction (CI) expansion from a Hartree–Fock (HF) determinant in a spin-orbital basis.\n- $n_o$: number of occupied spin-orbitals in an active space.\n- $n_v$: number of virtual spin-orbitals in an active space.\n- An excitation of rank $k$ replaces $k$ distinct occupied spin-orbitals with $k$ distinct virtual spin-orbitals.\n- Determinants are constructed in the spin-orbital representation without spin adaptation.\n- A truncated CI space at a given rank includes the HF reference and all distinct Slater determinants up to that excitation rank.\n- A specific active-space model is given with $n_o=5$ and $n_v=10$.\n- The tasks are to:\n    1. Derive a general counting expression for the number of $k$-fold excited determinants.\n    2. Derive expressions for the dimensions of CIS, CISD, and CISDT spaces.\n    3. Numerically evaluate these dimensions for the given model.\n    4. Discuss computational implications.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem is based on fundamental principles of quantum chemistry, specifically Configuration Interaction theory. All terms and concepts are standard and well-defined. It is scientifically sound.\n- **Well-Posed**: The problem is well-posed. It provides all necessary definitions and numerical values to derive the required expressions and compute the final answers. The questions asked have unique, derivable solutions.\n- **Objective**: The problem is stated in precise, objective language, free of ambiguity or subjective claims.\n\n**Step 3: Verdict and Action**\nThe problem is valid as it is scientifically sound, well-posed, objective, and complete. A solution will be provided.\n\nThe foundation of Configuration Interaction is the expansion of the exact many-electron wavefunction in a basis of Slater determinants. These determinants are constructed from a set of one-electron spin-orbitals, which are partitioned into occupied spin-orbitals (in the reference Hartree-Fock determinant, $|\\Psi_0\\rangle$) and virtual (unoccupied) spin-orbitals.\n\nAn excited determinant of rank $k$ is formed by promoting $k$ electrons from $k$ distinct occupied spin-orbitals to $k$ distinct virtual spin-orbitals. We are asked to find the number of unique Slater determinants that can be generated for a given excitation rank $k$. Let this number be $N_k$.\n\nThe process of creating a $k$-fold excited determinant involves two independent choices:\n1.  Choosing which $k$ occupied spin-orbitals to depopulate.\n2.  Choosing which $k$ virtual spin-orbitals to populate.\n\nGiven $n_o$ occupied spin-orbitals, the number of ways to choose $k$ distinct spin-orbitals from this set is given by the binomial coefficient $\\binom{n_o}{k}$.\n$$ \\binom{n_o}{k} = \\frac{n_o!}{k!(n_o - k)!} $$\nThis expression is valid for $0 \\le k \\le n_o$.\n\nSimilarly, given $n_v$ virtual spin-orbitals, the number of ways to choose $k$ distinct spin-orbitals to place the excited electrons into is given by the binomial coefficient $\\binom{n_v}{k}$.\n$$ \\binom{n_v}{k} = \\frac{n_v!}{k!(n_v - k)!} $$\nThis is valid for $0 \\le k \\le n_v$.\n\nSince the choice of occupied orbitals and the choice of virtual orbitals are independent, the total number of distinct $k$-fold excited determinants, $N_k$, is the product of these two combinatorial factors.\n$$ N_k = \\binom{n_o}{k} \\binom{n_v}{k} $$\nThis is the general counting expression for the number of distinct $k$-fold excited determinants in a spin-orbital basis. Note that for $k=0$, we have $N_0 = \\binom{n_o}{0}\\binom{n_v}{0} = 1 \\times 1 = 1$, which represents the single Hartree-Fock reference determinant itself.\n\nThe total dimension of a truncated CI space is the sum of the number of determinants at each included excitation level.\nThe CIS (Configuration Interaction Singles) space includes the reference determinant ($k=0$) and all single excitations ($k=1$). Its dimension, $D_{CIS}$, is:\n$$ D_{CIS} = N_0 + N_1 = 1 + \\binom{n_o}{1}\\binom{n_v}{1} = 1 + n_o n_v $$\n\nThe CISD (Configuration Interaction Singles and Doubles) space includes the reference, singles, and doubles ($k=2$). Its dimension, $D_{CISD}$, is:\n$$ D_{CISD} = N_0 + N_1 + N_2 = 1 + \\binom{n_o}{1}\\binom{n_v}{1} + \\binom{n_o}{2}\\binom{n_v}{2} = D_{CIS} + \\binom{n_o}{2}\\binom{n_v}{2} $$\n\nThe CISDT (Configuration Interaction Singles, Doubles, and Triples) space includes the reference, singles, doubles, and triples ($k=3$). Its dimension, $D_{CISDT}$, is:\n$$ D_{CISDT} = N_0 + N_1 + N_2 + N_3 = 1 + \\binom{n_o}{1}\\binom{n_v}{1} + \\binom{n_o}{2}\\binom{n_v}{2} + \\binom{n_o}{3}\\binom{n_v}{3} = D_{CISD} + \\binom{n_o}{3}\\binom{n_v}{3} $$\n\nNow, we evaluate these dimensions for the given active-space model with $n_o=5$ and $n_v=10$.\n\nFor CIS:\n$$ D_{CIS} = 1 + n_o n_v = 1 + (5)(10) = 1 + 50 = 51 $$\n\nFor CISD:\nFirst, we calculate the number of double excitations, $N_2$.\n$$ N_2 = \\binom{n_o}{2}\\binom{n_v}{2} = \\binom{5}{2}\\binom{10}{2} $$\n$$ \\binom{5}{2} = \\frac{5 \\times 4}{2 \\times 1} = 10 $$\n$$ \\binom{10}{2} = \\frac{10 \\times 9}{2 \\times 1} = 45 $$\n$$ N_2 = 10 \\times 45 = 450 $$\nThe dimension of the CISD space is:\n$$ D_{CISD} = D_{CIS} + N_2 = 51 + 450 = 501 $$\n\nFor CISDT:\nFirst, we calculate the number of triple excitations, $N_3$.\n$$ N_3 = \\binom{n_o}{3}\\binom{n_v}{3} = \\binom{5}{3}\\binom{10}{3} $$\n$$ \\binom{5}{3} = \\frac{5 \\times 4 \\times 3}{3 \\times 2 \\times 1} = 10 $$\n$$ \\binom{10}{3} = \\frac{10 \\times 9 \\times 8}{3 \\times 2 \\times 1} = 10 \\times 3 \\times 4 = 120 $$\n$$ N_3 = 10 \\times 120 = 1200 $$\nThe dimension of the CISDT space is:\n$$ D_{CISDT} = D_{CISD} + N_3 = 501 + 1200 = 1701 $$\n\nThe dimensions are $D_{CIS}=51$, $D_{CISD}=501$, and $D_{CISDT}=1701$.\n\nFinally, a brief discussion of the computational implications is required. The dimension of the CI space, $D_{CI}$, dictates the size of the Hamiltonian matrix, $\\mathbf{H}$, which must be constructed and diagonalized. The matrix has dimensions $D_{CI} \\times D_{CI}$. The computational cost of a CI calculation has two dominant components:\n$1$. Construction of the Hamiltonian matrix elements $H_{IJ} = \\langle \\Psi_I | \\hat{H} | \\Psi_J \\rangle$. The number of such elements is approximately $\\frac{1}{2}D_{CI}^2$.\n$2$. Diagonalization of the matrix $\\mathbf{H}$ to obtain its eigenvalues (energies) and eigenvectors (wavefunctions). Standard diagonalization algorithms scale as $O(D_{CI}^3)$. For large problems, iterative methods like the Davidson algorithm are employed, with a cost that scales roughly as $O(N_{iter} D_{CI}^2)$ per root, where $N_{iter}$ is the number of iterations required for convergence.\n\nThe expressions derived show that $D_{CI}$ grows combinatorially with the excitation level $k$ and polynomially with the number of orbitals ($n_o$ and $n_v$). Specifically, for a fixed large $k$, $N_k \\sim O(n_o^k n_v^k)$. This rapid, factorial-like growth is known as the \"exponential wall\" of quantum chemistry. As seen from our calculation ($51 \\to 501 \\to 1701$), even for a small system and low excitation levels, the dimension of the CI matrix increases dramatically. This makes higher-order CI methods computationally prohibitive for all but the smallest molecular systems, necessitating the use of more computationally efficient, approximate methods.", "answer": "$$\\boxed{\\begin{pmatrix} 51 & 501 & 1701 \\end{pmatrix}}$$", "id": "2881654"}, {"introduction": "Having confronted the rapid growth of the CI expansion, we now turn to a powerful tool for managing this complexity: symmetry. Since the non-relativistic electronic Hamiltonian commutes with the total spin operator $\\hat{S}^2$, its eigenstates must be pure spin states. This fundamental practice [@problem_id:2881681] involves constructing spin-adapted Configuration State Functions (CSFs) for a model system, moving from a simple basis of Slater determinants to a more physically meaningful basis that simplifies the Hamiltonian matrix into block-diagonal form.", "problem": "Consider a nonrelativistic, fixed-nuclei, two-electron ($N=2$) system in a minimal spatial basis of two orthonormal spin-free spatial orbitals $\\{\\phi_{a}(\\mathbf{r}),\\phi_{b}(\\mathbf{r})\\}$ with $\\langle \\phi_{p} | \\phi_{q} \\rangle = \\delta_{pq}$ for $p,q \\in \\{a,b\\}$. Let the one-electron spin functions be the normalized eigenfunctions of $\\hat{S}_{z}$, denoted $\\alpha$ and $\\beta$, with $\\hat{S}_{z}\\,\\alpha = \\frac{\\hbar}{2}\\,\\alpha$ and $\\hat{S}_{z}\\,\\beta = -\\frac{\\hbar}{2}\\,\\beta$. The total electronic wavefunction must be antisymmetric under particle exchange $\\hat{P}_{12}$, and the total spin operator is $\\hat{\\mathbf{S}} = \\hat{\\mathbf{S}}_{1} + \\hat{\\mathbf{S}}_{2}$ with $\\hat{S}^{2} = \\hat{\\mathbf{S}}\\cdot\\hat{\\mathbf{S}}$. In the context of spin-adapted Configuration State Functions (CSFs), which are eigenfunctions of $\\hat{S}^{2}$ and $\\hat{S}_{z}$ built as antisymmetric, properly symmetrized linear combinations of Slater determinants, proceed as follows:\n\n- Construct the complete set of spin-adapted CSFs (all singlets and triplets) that span the two-electron Hilbert space generated by the four spin-orbitals $\\{\\phi_{a}\\alpha,\\phi_{a}\\beta,\\phi_{b}\\alpha,\\phi_{b}\\beta\\}$, ensuring that each CSF is an eigenfunction of $\\hat{S}_{z}$ and that the total fermionic wavefunction is antisymmetric under $\\hat{P}_{12}$.\n- Starting only from the fundamental spin commutation relations, the definitions of the ladder operators $\\hat{S}_{\\pm}=\\hat{S}_{x}\\pm i\\hat{S}_{y}$, and the identities $\\hat{S}^{2} = \\hat{S}_{-}\\hat{S}_{+} + \\hat{S}_{z}(\\hat{S}_{z}+\\hbar) = \\hat{S}_{+}\\hat{S}_{-} + \\hat{S}_{z}(\\hat{S}_{z}-\\hbar)$ together with the spin-$\\frac{1}{2}$ actions $\\hat{S}_{+}\\beta=\\hbar\\,\\alpha$, $\\hat{S}_{-}\\alpha=\\hbar\\,\\beta$, $\\hat{S}_{+}\\alpha=0$, $\\hat{S}_{-}\\beta=0$, prove that your CSFs are orthonormal assuming the orthonormality of the underlying spatial orbitals and spinors, and verify that each CSF is an eigenfunction of $\\hat{S}^{2}$ with eigenvalue $S(S+1)\\hbar^{2}$ for the appropriate total spin quantum number $S \\in \\{0,1\\}$.\n- As your final answer, report the six eigenvalues of $\\hat{S}^{2}$, in units of $\\hbar^{2}$, corresponding to the following ordered list of CSFs: first the three singlets in the order $\\{\\text{singlet with double occupation of } \\phi_{a},\\ \\text{singlet with one electron in each orbital},\\ \\text{singlet with double occupation of } \\phi_{b}\\}$, then the three triplets in the order $\\{M_{S}=+1,\\ M_{S}=0,\\ M_{S}=-1\\}$. Express the six eigenvalues as a single row matrix. Do not include units in your final boxed matrix.", "solution": "The problem statement is validated as scientifically grounded, well-posed, objective, and self-contained. It presents a standard, fundamental exercise in quantum chemistry concerning the construction and verification of spin-adapted Configuration State Functions (CSFs) for a two-electron system in a minimal basis. The problem is free of logical contradictions, ambiguities, or factual errors. We proceed with the solution.\n\nThe system consists of $N=2$ electrons described within a basis of two orthonormal spatial orbitals, $\\{\\phi_{a}, \\phi_{b}\\}$, and two spin functions, $\\{\\alpha, \\beta\\}$. This generates a basis of $2 \\times 2 = 4$ orthonormal spin-orbitals: $\\{\\phi_{a}\\alpha, \\phi_{a}\\beta, \\phi_{b}\\alpha, \\phi_{b}\\beta\\}$. The total number of two-electron Slater determinants (SDs) that can be formed by choosing two distinct spin-orbitals from this set is given by the binomial coefficient $\\binom{4}{2}$, which equals $6$. These $6$ SDs form a complete orthonormal basis for the two-electron Hilbert space. We denote an SD formed from spin-orbitals $\\chi_{i}$ and $\\chi_{j}$ as $|\\chi_{i} \\chi_{j}\\rangle$.\n\nThe total electronic wavefunction must be an eigenfunction of the total spin-squared operator $\\hat{S}^{2}$ and its $z$-component $\\hat{S}_{z}$, and must be antisymmetric with respect to the exchange of the two electrons. Such functions are known as Configuration State Functions (CSFs). We construct the complete set of $6$ CSFs, which will consist of $3$ singlets ($S=0$) and $3$ triplets ($S=1$).\n\nA two-electron wavefunction $\\Psi(1,2)$ can be factorized into a spatial part $\\Phi(1,2)$ and a spin part $\\Theta(1,2)$. For the total wavefunction $\\Psi = \\Phi\\Theta$ to be antisymmetric, a symmetric spatial part must be paired with an antisymmetric spin part (a singlet), and an antisymmetric spatial part must be paired with a symmetric spin part (a triplet).\n\nThe two-electron spin functions that are eigenfunctions of $\\hat{S}^{2}$ and $\\hat{S}_{z}$ are:\nSinglet ($S=0$, $M_{S}=0$, antisymmetric):\n$$ \\Theta_{S=0, M_S=0} = \\frac{1}{\\sqrt{2}}(\\alpha(1)\\beta(2) - \\beta(1)\\alpha(2)) $$\nTriplets ($S=1$, symmetric):\n$$ \\Theta_{S=1, M_S=+1} = \\alpha(1)\\alpha(2) $$\n$$ \\Theta_{S=1, M_S=0} = \\frac{1}{\\sqrt{2}}(\\alpha(1)\\beta(2) + \\beta(1)\\alpha(2)) $$\n$$ \\Theta_{S=1, M_S=-1} = \\beta(1)\\beta(2) $$\n\nWe now construct the spatial functions from the orbitals $\\phi_{a}$ and $\\phi_{b}$. There are three types of spatial configurations:\n$1$. Double occupation of $\\phi_a$: The spatial function is $\\phi_{a}(1)\\phi_{a}(2)$, which is symmetric under particle exchange.\n$2$. Double occupation of $\\phi_b$: The spatial function is $\\phi_{b}(1)\\phi_{b}(2)$, which is symmetric.\n$3$. Single occupation of $\\phi_a$ and $\\phi_b$: We can form one symmetric and one antisymmetric combination:\n$$ \\Phi_{\\text{sym}} = \\frac{1}{\\sqrt{2}}(\\phi_{a}(1)\\phi_{b}(2) + \\phi_{b}(1)\\phi_{a}(2)) $$\n$$ \\Phi_{\\text{antisym}} = \\frac{1}{\\sqrt{2}}(\\phi_{a}(1)\\phi_{b}(2) - \\phi_{b}(1)\\phi_{a}(2)) $$\n\nBy combining the spatial and spin parts according to the Pauli principle, we construct the $6$ CSFs. The normalization factors ensure that $\\langle \\Psi | \\Psi \\rangle = 1$, given the orthonormality of the underlying orbitals.\n\nThe three singlet CSFs ($S=0$):\nThe symmetric spatial functions must combine with the antisymmetric singlet spin function $\\Theta_{S=0, M_S=0}$.\n$1$. Double occupation of $\\phi_a$:\n$$ {}^{1}\\Psi_{a^2} = \\phi_{a}(1)\\phi_{a}(2) \\cdot \\frac{1}{\\sqrt{2}}(\\alpha(1)\\beta(2) - \\beta(1)\\alpha(2)) = |\\phi_{a}\\alpha \\ \\phi_{a}\\beta\\rangle $$\n$2$. Single occupation of $\\phi_a, \\phi_b$:\n$$ {}^{1}\\Psi_{ab} = \\frac{1}{\\sqrt{2}}(\\phi_{a}(1)\\phi_{b}(2) + \\phi_{b}(1)\\phi_{a}(2)) \\cdot \\frac{1}{\\sqrt{2}}(\\alpha(1)\\beta(2) - \\beta(1)\\alpha(2)) = \\frac{1}{\\sqrt{2}}(|\\phi_{a}\\alpha \\ \\phi_{b}\\beta\\rangle - |\\phi_{a}\\beta \\ \\phi_{b}\\alpha\\rangle) $$\n$3$. Double occupation of $\\phi_b$:\n$$ {}^{1}\\Psi_{b^2} = \\phi_{b}(1)\\phi_{b}(2) \\cdot \\frac{1}{\\sqrt{2}}(\\alpha(1)\\beta(2) - \\beta(1)\\alpha(2)) = |\\phi_{b}\\alpha \\ \\phi_{b}\\beta\\rangle $$\n\nThe three triplet CSFs ($S=1$):\nThe antisymmetric spatial function $\\Phi_{\\text{antisym}}$ must combine with the three symmetric triplet spin functions.\n$4$. $M_{S}=+1$:\n$$ {}^{3}\\Psi_{ab,+1} = \\frac{1}{\\sqrt{2}}(\\phi_{a}(1)\\phi_{b}(2) - \\phi_{b}(1)\\phi_{a}(2)) \\cdot \\alpha(1)\\alpha(2) = |\\phi_{a}\\alpha \\ \\phi_{b}\\alpha\\rangle $$\n$5$. $M_{S}=0$:\n$$ {}^{3}\\Psi_{ab,0} = \\frac{1}{\\sqrt{2}}(\\phi_{a}(1)\\phi_{b}(2) - \\phi_{b}(1)\\phi_{a}(2)) \\cdot \\frac{1}{\\sqrt{2}}(\\alpha(1)\\beta(2) + \\beta(1)\\alpha(2)) = \\frac{1}{\\sqrt{2}}(|\\phi_{a}\\alpha \\ \\phi_{b}\\beta\\rangle + |\\phi_{a}\\beta \\ \\phi_{b}\\alpha\\rangle) $$\n$6$. $M_{S}=-1$:\n$$ {}^{3}\\Psi_{ab,-1} = \\frac{1}{\\sqrt{2}}(\\phi_{a}(1)\\phi_{b}(2) - \\phi_{b}(1)\\phi_{a}(2)) \\cdot \\beta(1)\\beta(2) = |\\phi_{a}\\beta \\ \\phi_{b}\\beta\\rangle $$\n\nNext, we prove orthonormality.\nThe basis of $6$ SDs $\\{|\\phi_{a}\\alpha \\ \\phi_{a}\\beta\\rangle, |\\phi_{b}\\alpha \\ \\phi_{b}\\beta\\rangle, |\\phi_{a}\\alpha \\ \\phi_{b}\\alpha\\rangle, |\\phi_{a}\\beta \\ \\phi_{b}\\beta\\rangle, |\\phi_{a}\\alpha \\ \\phi_{b}\\beta\\rangle, |\\phi_{a}\\beta \\ \\phi_{b}\\alpha\\rangle\\}$ is orthonormal because the underlying spin-orbitals are orthonormal.\nThe CSFs ${}^{1}\\Psi_{a^2}$, ${}^{1}\\Psi_{b^2}$, ${}^{3}\\Psi_{ab,+1}$, ${}^{3}\\Psi_{ab,-1}$ are single SDs and are thus normalized and mutually orthogonal because they differ by at least two spin-orbitals.\nFor the mixed CSFs, we have already verified their normalization upon construction. Let's check their orthogonality to each other and to the other CSFs.\nCSFs with different spin quantum numbers ($S$ or $M_S$) are orthogonal because $\\hat{S}^2$ and $\\hat{S}_z$ are Hermitian operators. For instance, any singlet is orthogonal to any triplet.\nThe only remaining check is between the two $M_S=0$ CSFs arising from the $(a^1 b^1)$ configuration, ${}^{1}\\Psi_{ab}$ and ${}^{3}\\Psi_{ab,0}$.\n$$ \\langle {}^{1}\\Psi_{ab} | {}^{3}\\Psi_{ab,0} \\rangle = \\frac{1}{2}\\langle (|\\phi_{a}\\alpha \\ \\phi_{b}\\beta\\rangle - |\\phi_{a}\\beta \\ \\phi_{b}\\alpha\\rangle) | (|\\phi_{a}\\alpha \\ \\phi_{b}\\beta\\rangle + |\\phi_{a}\\beta \\ \\phi_{b}\\alpha\\rangle) \\rangle $$\n$$ = \\frac{1}{2} (\\langle |\\phi_{a}\\alpha \\ \\phi_{b}\\beta\\rangle | |\\phi_{a}\\alpha \\ \\phi_{b}\\beta\\rangle\\rangle + \\langle |\\phi_{a}\\alpha \\ \\phi_{b}\\beta\\rangle | |\\phi_{a}\\beta \\ \\phi_{b}\\alpha\\rangle\\rangle - \\langle |\\phi_{a}\\beta \\ \\phi_{b}\\alpha\\rangle | |\\phi_{a}\\alpha \\ \\phi_{b}\\beta\\rangle\\rangle - \\langle |\\phi_{a}\\beta \\ \\phi_{b}\\alpha\\rangle | |\\phi_{a}\\beta \\ \\phi_{b}\\alpha\\rangle\\rangle) $$\nThe two SDs $|\\phi_{a}\\alpha \\ \\phi_{b}\\beta\\rangle$ and $|\\phi_{a}\\beta \\ \\phi_{b}\\alpha\\rangle$ differ by two spin-orbitals, so their overlap is zero. The SDs are normalized.\n$$ \\langle {}^{1}\\Psi_{ab} | {}^{3}\\Psi_{ab,0} \\rangle = \\frac{1}{2}(1 + 0 - 0 - 1) = 0 $$\nThus, the set of $6$ CSFs is orthonormal.\n\nFinally, we verify that the CSFs are eigenfunctions of $\\hat{S}^2 = \\hat{\\mathbf{S}}\\cdot\\hat{\\mathbf{S}}$ with the appropriate eigenvalues $S(S+1)\\hbar^2$. The operator $\\hat{S}^2$ acts only on the spin part of the wavefunction. The total spin operators are $\\hat{S}_{\\pm} = \\hat{S}_{1\\pm} + \\hat{S}_{2\\pm}$ and $\\hat{S}_z = \\hat{S}_{1z} + \\hat{S}_{2z}$. We use the given identities $\\hat{S}^{2} = \\hat{S}_{-}\\hat{S}_{+} + \\hat{S}_{z}(\\hat{S}_{z}+\\hbar)$ and $\\hat{S}^{2} = \\hat{S}_{+}\\hat{S}_{-} + \\hat{S}_{z}(\\hat{S}_{z}-\\hbar)$.\n\nFor any triplet state ${}^{3}\\Psi$:\nThe spin functions are $\\Theta_{1,+1} = \\alpha\\alpha$, $\\Theta_{1,0} = \\frac{1}{\\sqrt{2}}(\\alpha\\beta+\\beta\\alpha)$, $\\Theta_{1,-1}=\\beta\\beta$.\nFor ${}^{3}\\Psi_{ab,+1}$ (spin part $\\alpha\\alpha$): $M_S=1$.\n$\\hat{S}_{+}(\\alpha\\alpha) = (\\hat{S}_{1+}+\\hat{S}_{2+})\\alpha(1)\\alpha(2) = 0$.\n$\\hat{S}^2({}^{3}\\Psi_{ab,+1}) = (\\hat{S}_{-}\\hat{S}_{+} + \\hat{S}_{z}(\\hat{S}_{z}+\\hbar)){}^{3}\\Psi_{ab,+1}$. Since $\\hat{S}_{+}{}^{3}\\Psi_{ab,+1}=0$, the first term vanishes.\n$\\hat{S}_z({}^{3}\\Psi_{ab,+1}) = \\hbar({}^{3}\\Psi_{ab,+1})$.\n$\\hat{S}^2({}^{3}\\Psi_{ab,+1}) = \\hbar(\\hbar+\\hbar)({}^{3}\\Psi_{ab,+1}) = 2\\hbar^2({}^{3}\\Psi_{ab,+1})$. This is the eigenvalue for $S=1$ ($1(1+1)\\hbar^2=2\\hbar^2$).\n\nFor ${}^{3}\\Psi_{ab,-1}$ (spin part $\\beta\\beta$): $M_S=-1$.\n$\\hat{S}_{-}(\\beta\\beta) = 0$. Using the second identity for $\\hat{S}^2$:\n$\\hat{S}^2({}^{3}\\Psi_{ab,-1}) = (\\hat{S}_{+}\\hat{S}_{-} + \\hat{S}_{z}(\\hat{S}_{z}-\\hbar)){}^{3}\\Psi_{ab,-1}$. The $\\hat{S}_{+}\\hat{S}_{-}$ term is zero.\n$\\hat{S}_z({}^{3}\\Psi_{ab,-1}) = -\\hbar({}^{3}\\Psi_{ab,-1})$.\n$\\hat{S}^2({}^{3}\\Psi_{ab,-1}) = -\\hbar(-\\hbar-\\hbar)({}^{3}\\Psi_{ab,-1}) = 2\\hbar^2({}^{3}\\Psi_{ab,-1})$. This is the eigenvalue for $S=1$.\n\nFor ${}^{3}\\Psi_{ab,0}$ (spin part $\\frac{1}{\\sqrt{2}}(\\alpha\\beta+\\beta\\alpha)$): $M_S=0$.\n$\\hat{S}_z({}^{3}\\Psi_{ab,0}) = 0$.\n$\\hat{S}^2({}^{3}\\Psi_{ab,0}) = \\hat{S}_{-}\\hat{S}_{+}({}^{3}\\Psi_{ab,0})$.\n$\\hat{S}_{+}(\\frac{1}{\\sqrt{2}}(\\alpha\\beta+\\beta\\alpha)) = \\frac{1}{\\sqrt{2}}(\\hat{S}_{1+}+\\hat{S}_{2+})(\\alpha\\beta+\\beta\\alpha) = \\frac{1}{\\sqrt{2}}(\\hbar\\alpha\\alpha + \\hbar\\alpha\\alpha) = \\sqrt{2}\\hbar(\\alpha\\alpha)$.\n$\\hat{S}_{-}(\\sqrt{2}\\hbar(\\alpha\\alpha)) = \\sqrt{2}\\hbar(\\hat{S}_{1-}+\\hat{S}_{2-})(\\alpha\\alpha) = \\sqrt{2}\\hbar(\\hbar\\beta\\alpha+\\hbar\\alpha\\beta) = 2\\hbar^2 \\frac{1}{\\sqrt{2}}(\\alpha\\beta+\\beta\\alpha)$.\nSo, $\\hat{S}^2({}^{3}\\Psi_{ab,0}) = 2\\hbar^2({}^{3}\\Psi_{ab,0})$. This is the eigenvalue for $S=1$.\nAll three triplet states are eigenfunctions of $\\hat{S}^2$ with eigenvalue $2\\hbar^2$.\n\nFor any singlet state ${}^{1}\\Psi$:\nThe spin function is $\\Theta_S = \\frac{1}{\\sqrt{2}}(\\alpha\\beta - \\beta\\alpha)$. This applies to all three singlets, ${}^{1}\\Psi_{a^2}$, ${}^{1}\\Psi_{ab}$, and ${}^{1}\\Psi_{b^2}$.\nFor all singlets, $M_S=0$.\n$\\hat{S}_z({}^{1}\\Psi) = 0$.\n$\\hat{S}^2({}^{1}\\Psi) = \\hat{S}_{-}\\hat{S}_{+}({}^{1}\\Psi)$.\nWe evaluate the action of $\\hat{S}_{+}$ on the singlet spin part:\n$\\hat{S}_{+}(\\frac{1}{\\sqrt{2}}(\\alpha\\beta - \\beta\\alpha)) = \\frac{1}{\\sqrt{2}}(\\hat{S}_{1+}+\\hat{S}_{2+})(\\alpha\\beta - \\beta\\alpha) = \\frac{1}{\\sqrt{2}}((\\hat{S}_{1+}\\alpha\\beta + \\hat{S}_{2+}\\alpha\\beta) - (\\hat{S}_{1+}\\beta\\alpha + \\hat{S}_{2+}\\beta\\alpha))$\n$= \\frac{1}{\\sqrt{2}}((0 + \\hbar\\alpha\\alpha) - (\\hbar\\alpha\\alpha + 0)) = 0$.\nSince $\\hat{S}_{+}({}^{1}\\Psi)=0$, it immediately follows that $\\hat{S}^2({}^{1}\\Psi) = 0$.\nThis is the eigenvalue for $S=0$ ($0(0+1)\\hbar^2=0$).\nAll three singlet states are eigenfunctions of $\\hat{S}^2$ with eigenvalue $0$.\n\nThe problem asks for the six eigenvalues of $\\hat{S}^2$, in units of $\\hbar^2$, for the ordered list of CSFs:\n$1$. Singlet with double occupation of $\\phi_a$ (${}^{1}\\Psi_{a^2}$): $S=0$, eigenvalue is $0$.\n$2$. Singlet with one electron in each orbital (${}^{1}\\Psi_{ab}$): $S=0$, eigenvalue is $0$.\n$3$. Singlet with double occupation of $\\phi_b$ (${}^{1}\\Psi_{b^2}$): $S=0$, eigenvalue is $0$.\n$4$. Triplet with $M_S=+1$ (${}^{3}\\Psi_{ab,+1}$): $S=1$, eigenvalue is $2$.\n$5$. Triplet with $M_S=0$ (${}^{3}\\Psi_{ab,0}$): $S=1$, eigenvalue is $2$.\n$6$. Triplet with $M_S=-1$ (${}^{3}\\Psi_{ab,-1}$): $S=1$, eigenvalue is $2$.\n\nThe resulting list of eigenvalues is $(0, 0, 0, 2, 2, 2)$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & 0 & 0 & 2 & 2 & 2\n\\end{pmatrix}\n}\n$$", "id": "2881681"}, {"introduction": "The efficiency of a CI calculation depends critically on the choice of the underlying one-electron orbitals. While Hartree-Fock orbitals provide a reasonable starting point, a more optimal basis exists that can dramatically accelerate the convergence of the CI expansion. This advanced computational exercise [@problem_id:2881679] delves into the concept of natural orbitals, guiding you to implement a full CISD calculation, compute the density matrix, and demonstrate firsthand how transforming to the natural orbital basis leads to a more compact and efficient representation of the correlated wavefunction.", "problem": "You are given a family of finite-dimensional fermionic Hamiltonians in second quantization and asked to implement a configuration interaction with singles and doubles (CISD) procedure, construct the one-particle reduced density matrix, transform the integrals to the natural orbital basis, and quantify how determinant selection affects the energy error in both the original and natural orbital bases. Your program must compute all quantities from first principles using fermionic anti-commutation relations, without using pre-coded Slater–Condon shortcuts. All energies are in Hartree.\n\nFundamental base and definitions to be used:\n- The electronic Hamiltonian in a fixed orthonormal spin-orbital basis is\n$$\n\\hat{H} \\;=\\; \\sum_{p,q} h_{pq}\\, \\hat{a}_p^\\dagger \\hat{a}_q \\;+\\; \\tfrac{1}{2} \\sum_{p,q,r,s} (pq|rs)\\, \\hat{a}_p^\\dagger \\hat{a}_q^\\dagger \\hat{a}_s \\hat{a}_r,\n$$\nwhere $\\hat{a}_p^\\dagger$ and $\\hat{a}_p$ obey canonical anti-commutation relations, $h_{pq}$ are one-electron integrals, and $(pq|rs)$ are two-electron Coulomb integrals in the chemist’s notation with standard permutation symmetries.\n- A Slater determinant is represented by an occupation bitstring over $N_{\\mathrm{so}}$ spin orbitals with $N_{\\mathrm{e}}$ electrons. The CISD space relative to a chosen reference determinant $\\lvert \\Phi_0 \\rangle$ contains $\\lvert \\Phi_0 \\rangle$, all single excitations (replace one occupied orbital by one unoccupied orbital), and all double excitations (replace two occupied orbitals by two unoccupied orbitals).\n- The one-particle reduced density matrix is\n$$\n\\gamma_{pq} \\;=\\; \\langle \\Psi \\lvert \\hat{a}_p^\\dagger \\hat{a}_q \\rvert \\Psi \\rangle,\n$$\nfor the normalized CISD ground-state wavefunction $\\lvert \\Psi \\rangle$. By definition, natural orbitals are the eigenvectors of $\\gamma$; if $U$ is the orthogonal matrix whose columns are these eigenvectors, the orbitals transform as $\\hat{b}_a^\\dagger = \\sum_p U_{pa}\\, \\hat{a}_p^\\dagger$ and the integrals transform as\n$$\nh'_{ab} \\;=\\; \\sum_{p,q} U_{pa}\\, h_{pq}\\, U_{qb}, \\qquad\n(pq|rs)' \\;=\\; \\sum_{a,b,c,d} U_{pa}\\, U_{qb}\\, U_{rc}\\, U_{sd}\\, (ab|cd).\n$$\n- For a normalized vector of CISD coefficients $\\mathbf{c}$ over a chosen CISD determinant basis, the variational energy is the Rayleigh quotient $E = \\mathbf{c}^\\top H\\, \\mathbf{c}$, where $H$ is the Hamiltonian matrix restricted to the CISD space. Given a tolerance $\\tau$ (in Hartree) and a fixed basis, define $k^\\star$ to be the smallest integer $k$ such that if one truncates $\\mathbf{c}$ to its $k$ largest components in magnitude, renormalizes, and computes the Rayleigh quotient with the same $H$, the absolute energy error is at most $\\tau$.\n\nYour tasks for each test case:\n1. Construct the reference determinant $\\lvert \\Phi_0 \\rangle$ in the original basis by occupying the $N_{\\mathrm{e}}$ spin orbitals with the smallest diagonal one-electron energies $h_{pp}$ (breaking ties by smaller orbital index). Build the CISD determinant space relative to this reference.\n2. Build the CISD Hamiltonian matrix $H$ by evaluating matrix elements from the second-quantized definition using fermionic anti-commutation and operator application on determinants.\n3. Diagonalize $H$ to obtain the lowest-energy normalized eigenvector $\\mathbf{c}$ and energy $E_{\\mathrm{CISD}}$.\n4. Compute the one-particle reduced density matrix $\\gamma$ from $\\mathbf{c}$ using its definition $\\gamma_{pq} = \\langle \\Psi \\lvert \\hat{a}_p^\\dagger \\hat{a}_q \\rvert \\Psi \\rangle$.\n5. Diagonalize $\\gamma$ to obtain the natural orbital rotation $U$ (columns are eigenvectors), ordered by descending occupation numbers (eigenvalues). Transform $h$ and $(pq|rs)$ to the natural orbital basis to get $h'$ and $(pq|rs)'$ using the formulas above.\n6. In the natural orbital basis, define the reference determinant by occupying the $N_{\\mathrm{e}}$ spin orbitals with the largest diagonal $\\gamma$ occupations (i.e., the $N_{\\mathrm{e}}$ largest diagonal elements of $\\gamma$ in that basis; break ties by smaller orbital index). Build the CISD space, Hamiltonian $H'$, energy $E'_{\\mathrm{CISD}}$, and lowest eigenvector $\\mathbf{c}'$ in the same way.\n7. For each basis (original and natural orbital), determine the smallest determinant count $k^\\star$ and $k^{\\star\\prime}$, respectively, needed to achieve the given energy tolerance $\\tau$ via coefficient-magnitude truncation as defined above. Quantify the reduction by reporting the tuple $(k^\\star, k^{\\star\\prime}, \\rho)$ where $\\rho = k^\\star / k^{\\star\\prime}$.\n\nTest suite (three cases). For each case, you must construct the one- and two-electron integrals by the following deterministic formulas from the provided parameters. Indices $p,q,r,s$ range from $0$ to $N_{\\mathrm{so}}-1$.\n- One-electron integrals:\n$$\nh_{pq} \\;=\\; \\delta_{pq} \\, \\big( E_0 + \\Delta \\, p \\big) \\;+\\; t \\, \\big(1-\\delta_{pq}\\big) \\, e^{-\\lambda \\lvert p-q \\rvert}.\n$$\n- Two-electron integrals before symmetrization:\n$$\n\\tilde{V}_{pqrs} \\;=\\; g \\, \\exp\\!\\big( -\\alpha \\, (\\lvert p-r \\rvert + \\lvert q-s \\rvert) \\big).\n$$\nImpose standard chemist’s permutation symmetries by setting\n$V \\leftarrow \\tfrac{1}{2}( \\tilde{V} + \\tilde{V}^{(pq)\\leftrightarrow(qp)} )$\n$V \\leftarrow \\tfrac{1}{2}( V + V^{(rs)\\leftrightarrow(sr)} )$\n$V \\leftarrow \\tfrac{1}{2}( V + V^{(pq)\\leftrightarrow(rs)} )$\nwhich correspond to symmetrizing over $(p,q)$, over $(r,s)$, and enforcing $(pq|rs)=(rs|pq)$, respectively, yielding $(pq|rs)=V_{pqrs}$ to be used in $\\hat{H}$.\n\nTest cases:\n- Case A: $N_{\\mathrm{so}}=4$, $N_{\\mathrm{e}}=2$, $E_0=-1.0$, $\\Delta=0.4$, $t=0.15$, $\\lambda=1.0$, $g=0.6$, $\\alpha=0.8$, $\\tau=1\\times 10^{-6}$ Hartree.\n- Case B: $N_{\\mathrm{so}}=6$, $N_{\\mathrm{e}}=3$, $E_0=-1.2$, $\\Delta=0.35$, $t=0.12$, $\\lambda=0.7$, $g=0.5$, $\\alpha=0.6$, $\\tau=1\\times 10^{-6}$ Hartree.\n- Case C: $N_{\\mathrm{so}}=8$, $N_{\\mathrm{e}}=4$, $E_0=-1.5$, $\\Delta=0.3$, $t=0.10$, $\\lambda=0.6$, $g=0.45$, $\\alpha=0.5$, $\\tau=2\\times 10^{-6}$ Hartree.\n\nRequired final output:\n- Your program must produce a single line containing a comma-separated flat list with, for each case in order A, B, C, the triple $(k^\\star, k^{\\star\\prime}, \\rho)$, flattened across cases. Thus the final output must be of the form\n`[k^\\star_A, k^{\\star\\prime}_A, \\rho_A, k^\\star_B, k^{\\star\\prime}_B, \\rho_B, k^\\star_C, k^{\\star\\prime}_C, \\rho_C]`.\nAll $k$ are integers and each $\\rho$ is a real number. The single line of output must be exactly this bracketed list with commas and no additional text. Energies must be handled internally in Hartree, and the truncation tolerances $\\tau$ must be enforced as given (in Hartree).", "solution": "The user has provided a complex, multi-step problem in quantum chemistry requiring the implementation of the Configuration Interaction with Singles and Doubles (CISD) method from first principles. I will first validate the problem statement and then proceed with a detailed solution.\n\n### Step 1: Extract Givens\n- **Hamiltonian**: $\\hat{H} = \\sum_{p,q} h_{pq} \\hat{a}_p^\\dagger \\hat{a}_q + \\frac{1}{2} \\sum_{p,q,r,s} (pq|rs) \\hat{a}_p^\\dagger \\hat{a}_q^\\dagger \\hat{a}_s \\hat{a}_r$, with canonical fermionic anti-commutation relations.\n- **CISD Space**: Defined relative to a reference Slater determinant $|\\Phi_0\\rangle$, it includes $|\\Phi_0\\rangle$, all single excitations $|\\Phi_i^a\\rangle$, and all double excitations $|\\Phi_{ij}^{ab}\\rangle$.\n- **One-Particle Reduced Density Matrix (1-RDM)**: $\\gamma_{pq} = \\langle \\Psi | \\hat{a}_p^\\dagger \\hat{a}_q | \\Psi \\rangle$ for the normalized CISD ground state $|\\Psi\\rangle.\n- **Natural Orbitals (NOs)**: Eigenvectors of the 1-RDM $\\gamma$. The transformation matrix $U$ consists of these eigenvectors as columns.\n- **Integral Transformation**: $h'_{ab} = \\sum_{p,q} U_{pa} h_{pq} U_{qb}$ and $(pq|rs)' = \\sum_{a,b,c,d} U_{pa} U_{qb} U_{rc} U_{sd} (ab|cd)$. The latter formula appears to describe a back-transformation. I will assume this is a notational ambiguity and implement the standard forward transformation to compute new integrals from old ones: $(ab|cd)_{\\text{new}} = \\sum_{p,q,r,s} U_{pa} U_{qb} U_{rc} U_{sd} (pq|rs)_{\\text{old}}$. This is a common and necessary step.\n- **Truncation Metric $k^\\star$**: The smallest integer $k$ such that truncating the CISD coefficient vector $\\mathbf{c}$ to its $k$ largest-magnitude components, renormalizing, and computing the Rayleigh quotient results in an absolute energy error no greater than a given tolerance $\\tau$.\n- **Task Sequence**:\n    1.  Construct reference determinant $|\\Phi_0\\rangle$ by filling the $N_{\\mathrm{e}}$ orbitals with the lowest diagonal one-electron energies $h_{pp}$. Build the CISD space.\n    2.  Construct the CISD Hamiltonian matrix $H$ strictly from its second-quantized definition.\n    3.  Diagonalize $H$ to find the CISD ground state energy $E_{\\mathrm{CISD}}$ and eigenvector $\\mathbf{c}$.\n    4.  Compute the 1-RDM $\\gamma$.\n    5.  Find the NO transformation $U$ and transform the integrals to obtain $h'$ and $(pq|rs)'$.\n    6.  Repeat the CISD procedure in the NO basis, using a reference determinant formed by occupying the $N_{\\mathrm{e}}$ NOs with the largest occupation numbers, to find $E'_{\\mathrm{CISD}}$ and $\\mathbf{c}'$.\n    7.  Determine $k^\\star$ (original basis) and $k^{\\star\\prime}$ (NO basis) for the given $\\tau$. Report $(k^\\star, k^{\\star\\prime}, \\rho=k^\\star/k^{\\star\\prime})$.\n- **Integral Formulas**:\n    - One-electron: $h_{pq} = \\delta_{pq} ( E_0 + \\Delta p ) + t (1-\\delta_{pq}) e^{-\\lambda |p-q|}$.\n    - Two-electron (pre-symmetrization): $\\tilde{V}_{pqrs} = g \\exp( -\\alpha (|p-r| + |q-s|) )$.\n    - Symmetrization for $(pq|rs)$: Three sequential symmetrizations over pairs $(p,q)$, $(r,s)$, and finally swapping $(pq) \\leftrightarrow (rs)$.\n- **Test Cases**: Three cases (A, B, C) are provided with specific parameters for $N_{\\mathrm{so}}, N_{\\mathrm{e}}, E_0, \\Delta, t, \\lambda, g, \\alpha, \\tau$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is a standard, albeit computationally demanding, exercise in theoretical and computational chemistry. The concepts of CISD, 1-RDM, natural orbitals, and Hamiltonian construction are all fundamental to the field. It is scientifically sound.\n- **Well-Posed**: The problem is well-posed. All required parameters, formulas, and procedures are specified in detail. The problem sizes are small enough ($N_{\\mathrm{so}} \\le 8$) to be computationally tractable for a from-scratch implementation as demanded. The sequence of tasks is logical and leads to a unique, meaningful result.\n- **Objective**: The problem is stated in precise, objective, and quantitative terms. There are no subjective or ambiguous components, with the minor exception of the integral transformation formula noted above, which has a standard, unambiguous physical meaning that I will adopt.\n\nThe problem does not violate any of the invalidity criteria. It is a valid, challenging scientific problem.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. I will proceed to construct a complete solution.\n\n### Principle-Based Design\nThe solution will be implemented in Python using the `numpy` and `scipy` libraries. The design is modular, breaking the complex problem into manageable functions, each responsible for a specific physical or algorithmic task.\n\n1.  **Determinant Representation**: A Slater determinant is represented as an integer bitmask, where the $p$-th bit being set signifies that spin-orbital $p$ is occupied. This is computationally efficient for the necessary fermionic algebra.\n\n2.  **Fermionic Operators**: The core of the \"from-first-principles\" requirement is the implementation of creation ($\\hat{a}_p^\\dagger$) and annihilation ($\\hat{a}_p$) operators. Helper functions `apply_creation` and `apply_annihilation` are designed. They take a determinant bitmask and an orbital index $p$ as input. They return a new bitmask and a phase factor of $\\pm 1$. The phase factor is calculated as $(-1)^N$, where $N$ is the number of occupied orbitals with an index less than $p$. This correctly implements the anti-commutation rules for moving an operator to its position in the Jordan-Wigner string.\n\n3.  **Integral Generation**: A function will generate the one- and two-electron integrals ($h_{pq}$ and $(pq|rs)$) based on the provided analytical formulas. The three-step symmetrization of the two-electron integrals is performed using `numpy` tensor manipulations, which corresponds to the described algebraic operations.\n\n4.  **CISD Space Construction**: For a given number of spin-orbitals $N_{\\mathrm{so}}$, electrons $N_{\\mathrm{e}}$, and a set of occupied reference orbitals, a function generates the complete CISD space. It starts with the reference determinant and systematically generates all single and double excitations by swapping occupied orbital indices with virtual ones. The resulting determinants are stored as a list of unique bitmasks.\n\n5.  **Hamiltonian Construction**: The central part of the calculation is building the Hamiltonian matrix $H$ in the CISD basis. We iterate through each determinant $|\\Phi_j\\rangle$ in our basis and compute the state vector $\\hat{H}|\\Phi_j\\rangle$. This is done by applying the Hamiltonian term-by-term:\n    - For the one-electron term $\\sum_{p,q} h_{pq} \\hat{a}_p^\\dagger \\hat{a}_q$, we loop over $p, q$ and apply $\\hat{a}_q$ then $\\hat{a}_p^\\dagger$ to $|\\Phi_j\\rangle$.\n    - For the two-electron term $\\frac{1}{2} \\sum_{p,q,r,s} (pq|rs) \\hat{a}_p^\\dagger \\hat{a}_q^\\dagger \\hat{a}_s \\hat{a}_r$, we loop over $p,q,r,s$ and apply the four operators in sequence ($\\hat{a}_r$, then $\\hat{a}_s$, then $\\hat{a}_q^\\dagger$, then $\\hat{a}_p^\\dagger$).\n    The resulting state vector $\\hat{H}|\\Phi_j\\rangle$ is a linear combination of determinants in the CISD space. The matrix element $H_{ij}$ is then the coefficient of $|\\Phi_i\\rangle$ in this expansion, obtained via an inner product $\\langle\\Phi_i|\\hat{H}|\\Phi_j\\rangle$. A dictionary mapping bitmasks to basis indices is used for efficient lookup.\n\n6.  **Eigenvalue Problem and 1-RDM**: The resulting real, symmetric Hamiltonian matrix $H$ is diagonalized using `scipy.linalg.eigh` to obtain the lowest eigenvalue (CISD ground-state energy $E_{\\mathrm{CISD}}$) and corresponding eigenvector ($\\mathbf{c}$). The 1-RDM $\\gamma_{pq}$ is then computed via its definition $\\gamma_{pq} = \\sum_{I,J} c_I^* c_J \\langle \\Phi_I | \\hat{a}_p^\\dagger \\hat{a}_q | \\Phi_J \\rangle$. The matrix elements $\\langle \\Phi_I | \\hat{a}_p^\\dagger \\hat{a}_q | \\Phi_J \\rangle$ are evaluated using the same fermionic operator helpers.\n\n7.  **Natural Orbital Transformation**: The 1-RDM $\\gamma$ is diagonalized to find the natural occupations (eigenvalues) and orbitals (eigenvectors, forming the columns of matrix $U$). To ensure deterministic ordering, the eigenvectors are sorted by descending occupation number, breaking any ties by the original orbital index. The one- and two-electron integrals are then transformed to this new NO basis. The one-electron transformation is a matrix product $h' = U^T h U$. The four-index two-electron integral transformation is efficiently handled using `numpy.einsum`.\n\n8.  **NO Basis Calculation**: The entire CISD procedure is repeated in the natural orbital basis using the transformed integrals $h'$ and $(pq|rs)'$. The reference determinant is now defined by occupying the first $N_{\\mathrm{e}}$ natural orbitals (those with the highest occupations).\n\n9.  **Truncation Analysis**: For both the original and NO basis wavefunctions, a function determines the smallest number of determinants, $k^\\star$ and $k^{\\star\\prime}$, required to approximate the full CISD energy within the tolerance $\\tau$. This involves iterating through $k=1, 2, \\dots$, selecting the $k$ determinants with the largest coefficients, forming a truncated (and renormalized) wavefunction, and calculating its energy expectation value. The search stops when the energy error is below $\\tau$.\n\nFinally, the results $(k^\\star, k^{\\star\\prime}, k^\\star/k^{\\star\\prime})$ are collected for each test case and formatted into a single flat list for the output.\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\nimport itertools\n\ndef popcount(n: int) -> int:\n    \"\"\"Counts the number of set bits in an integer (population count).\"\"\"\n    return n.bit_count()\n\ndef apply_annihilation(det_mask: int, orb_idx: int) -> tuple[int, int]:\n    \"\"\"Applies annihilation operator a_p to a determinant.\n    Returns (new_det_mask, phase). Phase is 0 if orbital is not occupied.\"\"\"\n    orb_mask = 1 << orb_idx\n    if (det_mask & orb_mask) == 0:\n        return 0, 0\n    \n    lower_mask = orb_mask - 1\n    num_lower_occ = popcount(det_mask & lower_mask)\n    phase = 1 if (num_lower_occ % 2 == 0) else -1\n    \n    new_det_mask = det_mask & ~orb_mask\n    return new_det_mask, phase\n\ndef apply_creation(det_mask: int, orb_idx: int) -> tuple[int, int]:\n    \"\"\"Applies creation operator a_p^dagger to a determinant.\n    Returns (new_det_mask, phase). Phase is 0 if orbital is already occupied.\"\"\"\n    orb_mask = 1 << orb_idx\n    if (det_mask & orb_mask) != 0:\n        return 0, 0\n\n    lower_mask = orb_mask - 1\n    num_lower_occ = popcount(det_mask & lower_mask)\n    phase = 1 if (num_lower_occ % 2 == 0) else -1\n    \n    new_det_mask = det_mask | orb_mask\n    return new_det_mask, phase\n\ndef generate_integrals(N_so, E0, Delta, t, lam, g, alpha):\n    \"\"\"Generates one- and two-electron integrals based on the problem formulas.\"\"\"\n    p, q, r, s = np.ogrid[:N_so, :N_so, :N_so, :N_so]\n    \n    # One-electron integrals h_pq\n    h = np.zeros((N_so, N_so))\n    for p_idx in range(N_so):\n        for q_idx in range(N_so):\n            if p_idx == q_idx:\n                h[p_idx, q_idx] = E0 + Delta * p_idx\n            else:\n                h[p_idx, q_idx] = t * np.exp(-lam * np.abs(p_idx - q_idx))\n    \n    # Two-electron integrals V_pqrs before symmetrization\n    V_tilde = g * np.exp(-alpha * (np.abs(p - r) + np.abs(q - s)))\n    \n    # Symmetrization steps\n    V1 = 0.5 * (V_tilde + V_tilde.transpose(1, 0, 2, 3))\n    V2 = 0.5 * (V1 + V1.transpose(0, 1, 3, 2))\n    V = 0.5 * (V2 + V2.transpose(2, 3, 0, 1))\n    \n    return h, V\n\ndef generate_cisd_space(N_so, N_e, occ_ref_indices):\n    \"\"\"Generates the CISD space relative to a reference determinant.\"\"\"\n    occ_ref = tuple(sorted(occ_ref_indices))\n    virt_ref = tuple(sorted(set(range(N_so)) - set(occ_ref)))\n    \n    ref_det_mask = 0\n    for i in occ_ref:\n        ref_det_mask |= (1 << i)\n    \n    determinants = {ref_det_mask}\n    \n    # Singles\n    for i in occ_ref:\n        for a in virt_ref:\n            det_mask = ref_det_mask\n            det_mask &= ~(1 << i)\n            det_mask |= (1 << a)\n            determinants.add(det_mask)\n            \n    # Doubles\n    for i, j in itertools.combinations(occ_ref, 2):\n        for a, b in itertools.combinations(virt_ref, 2):\n            det_mask = ref_det_mask\n            det_mask &= ~(1 << i)\n            det_mask &= ~(1 << j)\n            det_mask |= (1 << a)\n            det_mask |= (1 << b)\n            determinants.add(det_mask)\n            \n    return sorted(list(determinants))\n\ndef build_hamiltonian(determinants, h, V, N_so):\n    \"\"\"Builds the Hamiltonian matrix in the CISD basis from first principles.\"\"\"\n    n_dets = len(determinants)\n    H_mat = np.zeros((n_dets, n_dets))\n    det_map = {det: i for i, det in enumerate(determinants)}\n\n    for j, det_j in enumerate(determinants):\n        # One-electron part\n        for p in range(N_so):\n            for q in range(N_so):\n                if np.abs(h[p, q]) < 1e-15: continue\n                det_r, phase_q = apply_annihilation(det_j, q)\n                if det_r == 0: continue\n                det_i, phase_p = apply_creation(det_r, p)\n                if det_i in det_map:\n                    i = det_map[det_i]\n                    H_mat[i, j] += h[p, q] * phase_p * phase_q\n        \n        # Two-electron part\n        for p in range(N_so):\n            for q in range(N_so):\n                for r in range(N_so):\n                    for s in range(N_so):\n                        if np.abs(V[p, q, r, s]) < 1e-15: continue\n                        det1, phase_r = apply_annihilation(det_j, r)\n                        if det1 == 0: continue\n                        det2, phase_s = apply_annihilation(det1, s)\n                        if det2 == 0: continue\n                        det3, phase_q = apply_creation(det2, q)\n                        if det3 == 0: continue\n                        det4, phase_p = apply_creation(det3, p)\n                        if det4 in det_map:\n                            i = det_map[det4]\n                            H_mat[i, j] += 0.5 * V[p, q, r, s] * phase_p * phase_q * phase_s * phase_r\n                            \n    return H_mat\n\ndef compute_rdm(c, determinants, N_so):\n    \"\"\"Computes the one-particle reduced density matrix.\"\"\"\n    n_dets = len(determinants)\n    gamma = np.zeros((N_so, N_so))\n    \n    for p in range(N_so):\n        for q in range(N_so):\n            for i in range(n_dets):\n                for j in range(n_dets):\n                    det_i_mask = determinants[i]\n                    det_j_mask = determinants[j]\n                    \n                    det_temp, phase_q = apply_annihilation(det_j_mask, q)\n                    if det_temp == 0: continue\n                    \n                    det_final, phase_p = apply_creation(det_temp, p)\n                    if det_final == det_i_mask:\n                        gamma[p, q] += c[i] * c[j] * phase_p * phase_q\n    return gamma\n\ndef find_k_star(H_mat, c_gs, E_gs, tau):\n    \"\"\"Finds the smallest number of determinants k to achieve energy tolerance tau.\"\"\"\n    n_dets = len(c_gs)\n    sorted_indices = np.argsort(np.abs(c_gs))[::-1]\n    \n    for k in range(1, n_dets + 1):\n        trunc_indices = sorted_indices[:k]\n        \n        c_trunc = c_gs[trunc_indices]\n        c_trunc_norm = c_trunc / np.linalg.norm(c_trunc)\n        \n        H_trunc = H_mat[np.ix_(trunc_indices, trunc_indices)]\n        \n        E_trunc = c_trunc_norm.T.conj() @ H_trunc @ c_trunc_norm\n        \n        if np.abs(E_trunc - E_gs) <= tau:\n            return k\n    return n_dets\n\n\ndef process_case(N_so, N_e, E0, Delta, t, lam, g, alpha, tau):\n    \"\"\"Processes a single test case from start to finish.\"\"\"\n    \n    # 1. Original Basis Calculation\n    h, V = generate_integrals(N_so, E0, Delta, t, lam, g, alpha)\n    \n    # Reference selection\n    diag_h = np.diag(h)\n    occ_indices_orig = np.argsort(diag_h)[:N_e]\n\n    # CISD space and Hamiltonian\n    determinants_orig = generate_cisd_space(N_so, N_e, occ_indices_orig)\n    H_orig = build_hamiltonian(determinants_orig, h, V, N_so)\n    \n    # Diagonalization\n    E_vals_orig, E_vecs_orig = eigh(H_orig)\n    E_cisd_orig = E_vals_orig[0]\n    c_cisd_orig = E_vecs_orig[:, 0]\n    \n    # Truncation analysis for original basis\n    k_star = find_k_star(H_orig, c_cisd_orig, E_cisd_orig, tau)\n    \n    # 2. Natural Orbital Transformation\n    gamma = compute_rdm(c_cisd_orig, determinants_orig, N_so)\n    occ_vals, U = eigh(gamma)\n    \n    # Sort NOs by descending occupation, breaking ties with original index\n    # We create pairs (occupation, original_index) to sort\n    sorted_occs_indices = sorted(enumerate(occ_vals), key=lambda x: x[1], reverse=True)\n    # The new U has columns ordered by descending occupation\n    no_indices_sorted = [x[0] for x in sorted_occs_indices]\n    U_sorted = U[:, no_indices_sorted]\n    \n    # Transform integrals to NO basis\n    h_prime = U_sorted.T @ h @ U_sorted\n    V_prime = np.einsum('pa,qb,rc,sd,pqrs->abcd', U_sorted, U_sorted, U_sorted, U_sorted, V, optimize=True)\n\n    # 3. Natural Orbital Basis Calculation\n    # Reference are the first N_e NOs (highest occupation)\n    occ_indices_no = np.arange(N_e)\n    \n    # CISD space and Hamiltonian in NO basis\n    determinants_no = generate_cisd_space(N_so, N_e, occ_indices_no)\n    H_no = build_hamiltonian(determinants_no, h_prime, V_prime, N_so)\n    \n    # Diagonalization\n    E_vals_no, E_vecs_no = eigh(H_no)\n    E_cisd_no = E_vals_no[0]\n    c_cisd_no = E_vecs_no[:, 0]\n    \n    # Truncation analysis for NO basis\n    k_star_prime = find_k_star(H_no, c_cisd_no, E_cisd_no, tau)\n\n    # 4. Final results for the case\n    rho = k_star / k_star_prime if k_star_prime != 0 else float('inf')\n    return k_star, k_star_prime, rho\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: N_so=4, N_e=2, E0=-1.0, Delta=0.4, t=0.15, lambda=1.0, g=0.6, alpha=0.8, tau=1e-6\n        (4, 2, -1.0, 0.4, 0.15, 1.0, 0.6, 0.8, 1e-6),\n        # Case B: N_so=6, N_e=3, E0=-1.2, Delta=0.35, t=0.12, lambda=0.7, g=0.5, alpha=0.6, tau=1e-6\n        (6, 3, -1.2, 0.35, 0.12, 0.7, 0.5, 0.6, 1e-6),\n        # Case C: N_so=8, N_e=4, E0=-1.5, Delta=0.3, t=0.10, lambda=0.6, g=0.45, alpha=0.5, tau=2e-6\n        (8, 4, -1.5, 0.3, 0.10, 0.6, 0.45, 0.5, 2e-6)\n    ]\n\n    all_results = []\n    for params in test_cases:\n        N_so, N_e, E0, Delta, t, lam, g, alpha, tau = params\n        k_star, k_star_prime, rho = process_case(N_so, N_e, E0, Delta, t, lam, g, alpha, tau)\n        all_results.extend([k_star, k_star_prime, rho])\n\n    # Final print statement in the exact required format.\n    formatted_results = []\n    for item in all_results:\n        if isinstance(item, int):\n            formatted_results.append(str(item))\n        else: # float (rho)\n            formatted_results.append(f\"{item:.10f}\".rstrip('0').rstrip('.') if '.' in f\"{item:.10f}\" else f\"{item:.1f}\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "answer": "[6,2,3.0,16,4,4.0,43,5,8.6]", "id": "2881679"}]}