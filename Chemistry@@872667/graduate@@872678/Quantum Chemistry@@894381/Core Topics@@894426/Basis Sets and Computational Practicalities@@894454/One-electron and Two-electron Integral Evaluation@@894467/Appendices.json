{"hands_on_practices": [{"introduction": "Before embarking on the complex task of numerically evaluating integrals, a crucial first step is to identify the unique integrals that must be computed. This exercise demonstrates how to leverage molecular symmetry and the inherent properties of the integral operators to systematically reduce the list of required one- and two-electron integrals. Mastering this conceptual analysis [@problem_id:2910082] is fundamental to designing efficient quantum chemistry algorithms and understanding the structure of the underlying matrices.", "problem": "Consider the minimal atomic-orbital basis description of the dihydrogen molecule $\\mathrm{H_2}$ at a fixed internuclear separation. Let the basis be $\\{\\chi_A,\\chi_B\\}$, where $\\chi_A$ and $\\chi_B$ are real, normalized, hydrogenic $1s$-like functions centered on nuclei $A$ and $B$, respectively. Define the overlap integrals $S_{\\mu\\nu}=\\langle \\chi_\\mu|\\chi_\\nu\\rangle$, the one-electron (core) integrals $h_{\\mu\\nu}=\\langle \\chi_\\mu|\\hat{T}+\\hat{V}_{ne}|\\chi_\\nu\\rangle$ with $\\hat{T}$ the kinetic energy operator and $\\hat{V}_{ne}$ the electron–nuclear attraction operator for the two equal nuclear charges, and the two-electron (electron–electron repulsion) integrals in chemists’ notation\n$$(\\mu\\nu|\\lambda\\sigma)=\\iint \\chi_\\mu(\\mathbf{r}_1)\\chi_\\nu(\\mathbf{r}_1)\\frac{1}{r_{12}}\\chi_\\lambda(\\mathbf{r}_2)\\chi_\\sigma(\\mathbf{r}_2)\\,d\\mathbf{r}_1\\,d\\mathbf{r}_2.$$\nAssume the nuclei are identical and the molecule is collinear with an inversion center at the midpoint, and assume all basis functions are real and individually normalized. Using only these definitions and symmetry arguments (hermiticity, real-valuedness, homonuclear interchange $A\\leftrightarrow B$, and the intrinsic permutation symmetries of $(\\mu\\nu|\\lambda\\sigma)$), select the option that correctly identifies a minimal independent set of nonredundant one-electron and two-electron integrals that must be evaluated in the atomic-orbital basis to construct the Hartree–Fock Fock matrix for $\\mathrm{H_2}$, together with the symmetry-induced equalities that eliminate all other members of the corresponding integral families.\n\nA. Independent set:\n- Overlap: $S_{AB}$ (with $S_{AA}=S_{BB}=1$ by normalization and $S_{BA}=S_{AB}$ by hermiticity).\n- One-electron core: $h_{AA}$ and $h_{AB}$ (with $h_{BB}=h_{AA}$ by $A\\leftrightarrow B$ and $h_{BA}=h_{AB}$ by hermiticity).\n- Two-electron: $(AA|AA)$, $(AA|BB)$, $(AB|AB)$, $(AA|AB)$.\nRedundancies: $(BB|BB)=(AA|AA)$ by $A\\leftrightarrow B$; $(BB|AB)=(AA|AB)$ by $A\\leftrightarrow B$; all other index permutations follow from $(\\mu\\nu|\\lambda\\sigma)=(\\nu\\mu|\\lambda\\sigma)=(\\mu\\nu|\\sigma\\lambda)=(\\lambda\\sigma|\\mu\\nu)$ for real orbitals.\n\nB. Independent set:\n- Overlap: none beyond $S_{AA}=S_{BB}=1$; $S_{AB}=0$ by orthogonality of different centers.\n- One-electron core: $h_{AA}$ only; $h_{AB}=0$ by orthogonality.\n- Two-electron: $(AA|AA)$ and $(AA|BB)$ only; all mixed-center three-index objects like $(AA|AB)$ vanish by inversion symmetry; $(AB|AB)=0$ because $\\chi_A$ and $\\chi_B$ do not overlap.\n\nC. Independent set:\n- Overlap: $S_{AA}$, $S_{BB}$, $S_{AB}$ (all distinct).\n- One-electron core: $h_{AA}$, $h_{BB}$, $h_{AB}$, $h_{BA}$ (all distinct).\n- Two-electron: $(AA|AA)$, $(BB|BB)$, $(AA|BB)$, $(AB|AB)$, $(AB|BA)$, $(AA|AB)$, $(BB|AB)$ (all distinct).\nRedundancies: none beyond $(\\mu\\nu|\\lambda\\sigma)=(\\nu\\mu|\\lambda\\sigma)$.\n\nD. Independent set:\n- Use symmetry-adapted molecular orbitals so only $S_{gg}=S_{uu}=1$ and $h_{gg}$, $h_{uu}$ are needed; off-diagonal one-electron and all three-center two-electron integrals vanish by symmetry; two-electron integrals reduce to $(gg|gg)$ and $(uu|uu)$ only.\nRedundancies: all others are zero in the chosen basis; no atomic-orbital two-center integrals are required.\n\nWhich option is correct?", "solution": "The task is to determine the set of unique one- and two-electron integrals over the atomic orbital basis $\\{\\chi_\\mu\\} = \\{\\chi_A, \\chi_B\\}$ by applying the given symmetry principles.\n\n**1. Overlap Integrals ($S_{\\mu\\nu}$)**\nThe overlap matrix $\\mathbf{S}$ has elements $S_{\\mu\\nu} = \\langle\\chi_\\mu|\\chi_\\nu\\rangle$.\n- **Normalization:** The basis functions are normalized, so $S_{AA} = \\langle\\chi_A|\\chi_A\\rangle = 1$ and $S_{BB} = \\langle\\chi_B|\\chi_B\\rangle = 1$. These are not integrals to be calculated but are fixed by definition.\n- **Hermiticity:** The inner product is Hermitian, so $S_{\\mu\\nu} = S_{\\nu\\mu}^*$. Since the basis functions are real, this simplifies to $S_{\\mu\\nu} = S_{\\nu\\mu}$. Thus, $S_{AB} = S_{BA}$.\n- **Homonuclear Interchange ($A \\leftrightarrow B$):** The system is unchanged by swapping the identical nuclei. This operation sends $\\chi_A \\to \\chi_B$ and $\\chi_B \\to \\chi_A$.\n    - $S_{AA} = \\langle\\chi_A|\\chi_A\\rangle \\xrightarrow{A\\leftrightarrow B} \\langle\\chi_B|\\chi_B\\rangle = S_{BB}$. This confirms $S_{AA} = S_{BB}$, consistent with normalization.\n- **Conclusion:** Of the four formal entries in the $\\mathbf{S}$ matrix, only one, $S_{AB}$, is an independent, non-trivial integral that must be evaluated.\n\n**2. One-Electron Core Integrals ($h_{\\mu\\nu}$)**\nThe core Hamiltonian matrix $\\mathbf{h}$ has elements $h_{\\mu\\nu} = \\langle\\chi_\\mu|\\hat{h}|\\chi_\\nu\\rangle$, where the core Hamiltonian operator $\\hat{h}=\\hat{T}+\\hat{V}_{ne}$ is symmetric with respect to nuclear interchange.\n- **Hermiticity:** $\\hat{h}$ is a Hermitian operator. For a real basis, this implies $h_{\\mu\\nu} = h_{\\nu\\mu}$. Thus, $h_{AB} = h_{BA}$.\n- **Homonuclear Interchange ($A \\leftrightarrow B$):**\n    - $h_{AA} = \\langle\\chi_A|\\hat{h}|\\chi_A\\rangle \\xrightarrow{A\\leftrightarrow B} \\langle\\chi_B|\\hat{h}|\\chi_B\\rangle = h_{BB}$.\n- **Conclusion:** Of the four entries in the $\\mathbf{h}$ matrix, there are only two independent integrals to evaluate: the Coulomb-type integral $h_{AA}$ and the resonance integral $h_{AB}$.\n\n**3. Two-Electron Integrals ($(\\mu\\nu|\\lambda\\sigma)$)**\nThere are $2^4 = 16$ such integrals. We reduce this number using symmetry.\n- **Intrinsic Permutation Symmetry (real orbitals):** The definition of the integral leads to several identities.\n    1.  $(\\mu\\nu|\\lambda\\sigma) = (\\nu\\mu|\\lambda\\sigma)$ (symmetry within electron 1 distribution)\n    2.  $(\\mu\\nu|\\lambda\\sigma) = (\\mu\\nu|\\sigma\\lambda)$ (symmetry within electron 2 distribution)\n    3.  $(\\mu\\nu|\\lambda\\sigma) = (\\lambda\\sigma|\\mu\\nu)$ (swapping electron 1 and 2 coordinates)\n    These relations taken together generate an 8-fold permutation symmetry for general indices.\n- **Homonuclear Interchange ($A \\leftrightarrow B$):** This symmetry relates integrals by swapping all $A$ and $B$ labels.\n\nLet us enumerate the distinct classes of integrals:\n- **One-center:** $(AA|AA)$. The integral $(BB|BB)$ is related by homonuclear symmetry: $(BB|BB) = (AA|AA)$. This is one independent integral.\n- **Two-center, Coulomb:** $(AA|BB)$. Note that $(\\mu\\nu|\\lambda\\sigma) = (\\lambda\\sigma|\\mu\\nu)$ implies $(AA|BB) = (BB|AA)$, which is also evident from homonuclear symmetry. This is a second independent integral.\n- **Two-center, hybrid:** $(AA|AB)$. There are formally $8$ integrals of this type (3 indices of one type, 1 of the other), e.g., $(AA|BA)$, $(AB|AA)$, $(BB|AB)$, etc.\n    - Intrinsic symmetry: $(AA|AB) = (AA|BA)$ and $(AA|AB) = (AB|AA)$. All permutations of $(AA|AB)$ without changing index counts are equal.\n    - Homonuclear symmetry: $(AA|AB) \\xrightarrow{A\\leftrightarrow B} (BB|BA)$.\n    - We know from intrinsic symmetry that $(BB|BA) = (BB|AB)$. Therefore, all integrals with three of one index and one of the other are related to $(AA|AB)$. This is a third independent integral.\n- **Two-center, exchange-type:** $(AB|AB)$. There are formally $4$ integrals of this type, $(AB|AB)$, $(AB|BA)$, $(BA|AB)$, and $(BA|BA)$.\n    - Intrinsic symmetry shows these are all equal. For example, $(AB|AB) = (BA|AB)$ by symmetry (1). Also, $(AB|AB) = (AB|BA)$ by symmetry (2). Finally, $(AB|AB) = (AB|AB)$ from symmetry (3). Thus we have $(AB|AB) = (BA|AB) = (AB|BA) = (BA|BA)$. This is a fourth independent integral.\n\n**Summary of Independent Integrals:**\n- **Overlap:** $S_{AB}$ ($1$ value)\n- **One-electron:** $h_{AA}$, $h_{AB}$ ($2$ values)\n- **Two-electron:** $(AA|AA)$, $(AA|BB)$, $(AA|AB)$, $(AB|AB)$ ($4$ values)\n\nNow, we evaluate the given options.\n\n**Option A Analysis**\n- **Independent set:** Proposes $S_{AB}$; $h_{AA}$ and $h_{AB}$; and $(AA|AA)$, $(AA|BB)$, $(AB|AB)$, $(AA|AB)$. This matches our derived minimal independent set precisely.\n- **Redundancies:**\n    - Correctly states $S_{AA}=S_{BB}=1$ and $S_{BA}=S_{AB}$.\n    - Correctly states $h_{BB}=h_{AA}$ and $h_{BA}=h_{AB}$.\n    - Correctly states $(BB|BB)=(AA|AA)$.\n    - Correctly states $(BB|AB) = (AA|AB)$. As derived, $(AA|AB) \\xrightarrow{A\\leftrightarrow B} (BB|BA)$. Also $(BB|BA) = (BB|AB)$ by intrinsic permutation symmetry. So the relation holds.\n    - Correctly identifies the source of other redundancies as the intrinsic permutation symmetries.\nThis option is a complete and correct accounting of the problem.\n**Verdict: Correct**\n\n**Option B Analysis**\n- This option claims $S_{AB}=0$ and $h_{AB}=0$ because atomic orbitals on different centers are orthogonal. This premise is fundamentally false. Atomic orbitals in a molecular context are non-orthogonal, and their overlap is essential for describing chemical bonding. For $1s$ orbitals, $S_{AB} > 0$. The integral $h_{AB}$ is the resonance integral, which is also non-zero and negative, and is the primary source of the bond energy.\n- It further claims that integrals such as $(AA|AB)$ and $(AB|AB)$ are zero, which is also incorrect and follows from the same flawed premise. The overlap density $\\chi_A(\\mathbf{r})\\chi_B(\\mathbf{r})$ is not zero, and therefore $(AB|AB)$ is not zero.\n**Verdict: Incorrect**\n\n**Option C Analysis**\n- This option claims that $S_{AA}$, $S_{BB}$, $S_{AB}$ are all distinct, which violates homonuclear symmetry ($S_{AA}=S_{BB}=1$).\n- It claims $h_{AA}, h_{BB}, h_{AB}, h_{BA}$ are all distinct, which violates both homonuclear symmetry ($h_{AA}=h_{BB}$) and Hermiticity ($h_{AB}=h_{BA}$).\n- It lists a large number of two-electron integrals as distinct, failing to apply homonuclear symmetry (e.g., $(AA|AA)=(BB|BB)$) and intrinsic permutation symmetries (e.g., $(AB|AB)=(AB|BA)$).\n- This option demonstrates a failure to apply any of the relevant symmetries, apart from the most trivial one.\n**Verdict: Incorrect**\n\n**Option D Analysis**\n- This option proposes to switch from the atomic orbital (AO) basis to the symmetry-adapted molecular orbital (MO) basis. The question explicitly asks for the analysis **in the atomic-orbital basis**. Therefore, this option does not answer the question posed.\n- Furthermore, its claims about the MO basis are themselves flawed. While some off-diagonal and odd-symmetry integrals do vanish in the MO basis (e.g., $\\langle g | \\hat{h} | u \\rangle = 0$, $(gg|gu)=0$), it incorrectly claims that the two-electron integrals reduce to only $(gg|gg)$ and $(uu|uu)$. This is false; the integrals $(gg|uu)$ (Coulomb) and $(gu|gu)$ (exchange) are also non-zero and are essential for describing electron correlation and excited states.\n**Verdict: Incorrect**\n\nBased on the rigorous application of symmetry principles, only Option A provides a correct and complete description of the independent integrals and their associated redundancy relations in the atomic orbital basis.", "answer": "$$\\boxed{A}$$", "id": "2910082"}, {"introduction": "While formal integral expressions are exact, their finite-precision numerical evaluation can be fraught with peril, especially when using flexible basis sets with nearly linearly dependent functions. This practice explores the critical issue of catastrophic cancellation that arises when computing matrix elements between two very similar, diffuse Gaussian orbitals. By working through the analytical expansion [@problem_id:2910089], you will gain insight into the origin of this numerical instability and learn how to derive stable computational formulas, a vital skill for robust software implementation.", "problem": "Consider two real, normalized, $s$-type primitive Gaussian-type orbitals (GTOs) centered at the origin in atomic units, defined by $\\phi_{\\alpha}(\\mathbf{r}) = N_{\\alpha} \\exp(-\\alpha r^{2})$ and $\\phi_{\\beta}(\\mathbf{r}) = N_{\\beta} \\exp(-\\beta r^{2})$, where $N_{\\alpha}$ and $N_{\\beta}$ are normalization constants and $r = |\\mathbf{r}|$. Take the kinetic energy operator to be $\\hat{T} = -\\frac{1}{2}\\nabla^{2}$. Let the exponents satisfy $\\beta = \\alpha(1+\\varepsilon)$ with $0 < \\varepsilon \\ll 1$, and choose the specific values $\\alpha = 1.0 \\times 10^{-4}$ and $\\varepsilon = 1.0 \\times 10^{-8}$.\n\nStarting only from the definitions of normalization, overlap, and kinetic energy integrals and from standard three-dimensional Gaussian integrals, do the following:\n\n- Derive a closed-form expression for the overlap integral $S_{\\alpha\\beta} = \\langle \\phi_{\\alpha} | \\phi_{\\beta} \\rangle$ and the kinetic energy integral $T_{\\alpha\\beta} = \\langle \\phi_{\\alpha} | \\hat{T} | \\phi_{\\beta} \\rangle$ between these two functions.\n- Using these expressions, construct the normalized difference combination $\\chi_{-} = (\\phi_{\\alpha} - \\phi_{\\beta})/\\sqrt{2(1 - S_{\\alpha\\beta})}$ and derive the exact expression for its kinetic energy expectation value\n$$E_{-} = \\frac{\\langle \\chi_{-} | \\hat{T} | \\chi_{-} \\rangle}{\\langle \\chi_{-} | \\chi_{-} \\rangle} = \\frac{T_{\\alpha\\alpha} + T_{\\beta\\beta} - 2 T_{\\alpha\\beta}}{2(1 - S_{\\alpha\\beta})}.$$\n- Show analytically, by expanding in powers of $\\varepsilon$, how both the numerator and denominator of $E_{-}$ exhibit cancellations of leading terms (loss of significance) for $\\varepsilon \\to 0$, and obtain the leading terms of the expansion of $E_{-}$ in $\\varepsilon$.\n\nFinally, evaluate $E_{-}$ for $\\alpha = 1.0 \\times 10^{-4}$ and $\\varepsilon = 1.0 \\times 10^{-8}$ using the asymptotic expansion you derived to avoid catastrophic cancellation, and report the result in hartree. Round your answer to four significant figures.", "solution": "We begin by deriving the necessary integral expressions. The primitive Gaussian-type orbitals (GTOs) are given as $\\phi_{\\alpha}(\\mathbf{r}) = N_{\\alpha} \\exp(-\\alpha r^{2})$ and $\\phi_{\\beta}(\\mathbf{r}) = N_{\\beta} \\exp(-\\beta r^{2})$.\n\nFirst, we determine the normalization constant, $N_{\\gamma}$, for a general $s$-type GTO, $\\phi_{\\gamma}$, by requiring $\\langle \\phi_{\\gamma} | \\phi_{\\gamma} \\rangle = 1$. The integration is over all space, $d^3r$.\n$$ \\langle \\phi_{\\gamma} | \\phi_{\\gamma} \\rangle = \\int \\left[ N_{\\gamma} \\exp(-\\gamma r^2) \\right]^2 d^3r = N_{\\gamma}^2 \\int \\exp(-2\\gamma r^2) d^3r = 1 $$\nThe standard three-dimensional Gaussian integral is $\\int \\exp(-ar^2)d^3r = (\\frac{\\pi}{a})^{3/2}$. Using this with $a=2\\gamma$, we have:\n$$ N_{\\gamma}^2 \\left(\\frac{\\pi}{2\\gamma}\\right)^{3/2} = 1 \\implies N_{\\gamma} = \\left(\\frac{2\\gamma}{\\pi}\\right)^{3/4} $$\nThus, $N_{\\alpha} = (\\frac{2\\alpha}{\\pi})^{3/4}$ and $N_{\\beta} = (\\frac{2\\beta}{\\pi})^{3/4}$.\n\nNext, we derive the overlap integral, $S_{\\alpha\\beta} = \\langle \\phi_{\\alpha} | \\phi_{\\beta} \\rangle$.\n$$ S_{\\alpha\\beta} = \\int N_{\\alpha} \\exp(-\\alpha r^2) N_{\\beta} \\exp(-\\beta r^2) d^3r = N_{\\alpha} N_{\\beta} \\int \\exp(-(\\alpha+\\beta)r^2) d^3r $$\nUsing the Gaussian integral formula with $a = \\alpha+\\beta$:\n$$ S_{\\alpha\\beta} = N_{\\alpha} N_{\\beta} \\left(\\frac{\\pi}{\\alpha+\\beta}\\right)^{3/2} = \\left(\\frac{2\\alpha}{\\pi}\\right)^{3/4} \\left(\\frac{2\\beta}{\\pi}\\right)^{3/4} \\left(\\frac{\\pi}{\\alpha+\\beta}\\right)^{3/2} $$\n$$ S_{\\alpha\\beta} = \\frac{(4\\alpha\\beta)^{3/4}}{\\pi^{3/2}} \\frac{\\pi^{3/2}}{(\\alpha+\\beta)^{3/2}} = \\left( \\frac{4\\alpha\\beta}{(\\alpha+\\beta)^2} \\right)^{3/4} $$\n\nNow, we derive the kinetic energy integral, $T_{\\alpha\\beta} = \\langle \\phi_{\\alpha} | \\hat{T} | \\phi_{\\beta} \\rangle$, with $\\hat{T} = -\\frac{1}{2}\\nabla^2$.\n$$ T_{\\alpha\\beta} = \\int \\phi_{\\alpha}(\\mathbf{r}) \\left(-\\frac{1}{2}\\nabla^2\\right) \\phi_{\\beta}(\\mathbf{r}) d^3r $$\nWe must first compute $\\nabla^2 \\phi_{\\beta}(\\mathbf{r})$:\n$$ \\nabla^2 \\phi_{\\beta} = \\nabla^2 \\left[ N_{\\beta} \\exp(-\\beta r^2) \\right] = N_{\\beta} \\left( \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2} + \\frac{\\partial^2}{\\partial z^2} \\right) \\exp(-\\beta(x^2+y^2+z^2)) $$\nThe second partial derivative with respect to $x$ is:\n$$ \\frac{\\partial^2}{\\partial x^2} \\exp(-\\beta r^2) = \\frac{\\partial}{\\partial x} [-2\\beta x \\exp(-\\beta r^2)] = [-2\\beta + 4\\beta^2 x^2] \\exp(-\\beta r^2) $$\nSumming the contributions from $x$, $y$, and $z$:\n$$ \\nabla^2 \\phi_{\\beta} = N_{\\beta} [-6\\beta + 4\\beta^2 (x^2+y^2+z^2)] \\exp(-\\beta r^2) = N_{\\beta} (4\\beta^2 r^2 - 6\\beta) \\exp(-\\beta r^2) $$\nSubstituting this into the integral for $T_{\\alpha\\beta}$:\n$$ T_{\\alpha\\beta} = -\\frac{1}{2} \\int N_{\\alpha}\\exp(-\\alpha r^2) N_{\\beta}(4\\beta^2 r^2 - 6\\beta) \\exp(-\\beta r^2) d^3r $$\n$$ T_{\\alpha\\beta} = N_{\\alpha} N_{\\beta} \\int (3\\beta - 2\\beta^2 r^2) \\exp(-(\\alpha+\\beta)r^2) d^3r $$\nLet $p = \\alpha+\\beta$. The integral splits into two parts:\n$$ T_{\\alpha\\beta} = 3\\beta N_{\\alpha} N_{\\beta} \\int \\exp(-p r^2) d^3r - 2\\beta^2 N_{\\alpha} N_{\\beta} \\int r^2 \\exp(-p r^2) d^3r $$\nThe first part is $3\\beta S_{\\alpha\\beta}$. The second integral can be evaluated by differentiating the basic Gaussian integral with respect to the parameter $p$:\n$$ \\int r^2 \\exp(-p r^2) d^3r = -\\frac{\\partial}{\\partial p} \\int \\exp(-p r^2) d^3r = -\\frac{\\partial}{\\partial p} \\left(\\frac{\\pi}{p}\\right)^{3/2} = - \\pi^{3/2} \\left(-\\frac{3}{2} p^{-5/2}\\right) = \\frac{3}{2p} \\left(\\frac{\\pi}{p}\\right)^{3/2} $$\nSubstituting this back:\n$$ T_{\\alpha\\beta} = 3\\beta S_{\\alpha\\beta} - 2\\beta^2 N_{\\alpha} N_{\\beta} \\left( \\frac{3}{2(\\alpha+\\beta)} \\left(\\frac{\\pi}{\\alpha+\\beta}\\right)^{3/2} \\right) = 3\\beta S_{\\alpha\\beta} - \\frac{3\\beta^2}{\\alpha+\\beta} S_{\\alpha\\beta} $$\n$$ T_{\\alpha\\beta} = \\left( 3\\beta - \\frac{3\\beta^2}{\\alpha+\\beta} \\right) S_{\\alpha\\beta} = 3\\beta \\left( \\frac{\\alpha+\\beta-\\beta}{\\alpha+\\beta} \\right) S_{\\alpha\\beta} = \\frac{3\\alpha\\beta}{\\alpha+\\beta} S_{\\alpha\\beta} $$\nFor the diagonal elements, with $S_{\\alpha\\alpha}=1$ and $S_{\\beta\\beta}=1$:\n$$ T_{\\alpha\\alpha} = \\frac{3\\alpha^2}{2\\alpha}S_{\\alpha\\alpha} = \\frac{3}{2}\\alpha \\quad \\text{and} \\quad T_{\\beta\\beta} = \\frac{3\\beta^2}{2\\beta}S_{\\beta\\beta} = \\frac{3}{2}\\beta $$\nThe expectation value $E_{-}$ is given by:\n$$ E_{-} = \\frac{T_{\\alpha\\alpha} + T_{\\beta\\beta} - 2 T_{\\alpha\\beta}}{2(1 - S_{\\alpha\\beta})} = \\frac{\\frac{3}{2}(\\alpha+\\beta) - 2 \\left(\\frac{3\\alpha\\beta}{\\alpha+\\beta}\\right) S_{\\alpha\\beta}}{2(1 - S_{\\alpha\\beta})} $$\nWe are given $\\beta = \\alpha(1+\\varepsilon)$ with $0 < \\varepsilon \\ll 1$. As $\\varepsilon \\to 0$, $\\beta \\to \\alpha$, $S_{\\alpha\\beta} \\to S_{\\alpha\\alpha} = 1$. Both the numerator and denominator of $E_{-}$ approach $0$, indicating numerical instability due to catastrophic cancellation. To find the limiting value, we must expand the components in powers of $\\varepsilon$.\n\nExpansion of $S_{\\alpha\\beta}$:\n$$ \\frac{4\\alpha\\beta}{(\\alpha+\\beta)^2} = \\frac{4\\alpha^2(1+\\varepsilon)}{(\\alpha+\\alpha(1+\\varepsilon))^2} = \\frac{4(1+\\varepsilon)}{(2+\\varepsilon)^2} = \\frac{1+\\varepsilon}{(1+\\varepsilon/2)^2} $$\nLet $u = \\varepsilon/2$. The argument is $\\frac{1+2u}{(1+u)^2} = (1+2u)(1-2u+3u^2-\\dots) = 1-u^2+O(u^3) = 1 - \\frac{\\varepsilon^2}{4} + O(\\varepsilon^3)$.\nSo, $S_{\\alpha\\beta} = \\left(1 - \\frac{\\varepsilon^2}{4} + O(\\varepsilon^3)\\right)^{3/4}$. Using the binomial expansion $(1+x)^k \\approx 1+kx$:\n$$ S_{\\alpha\\beta} = 1 - \\frac{3}{4}\\left(\\frac{\\varepsilon^2}{4}\\right) + O(\\varepsilon^4) = 1 - \\frac{3}{16}\\varepsilon^2 + O(\\varepsilon^4) $$\nThe denominator of $E_{-}$ is then:\n$$ 2(1 - S_{\\alpha\\beta}) = 2\\left(1 - \\left(1 - \\frac{3}{16}\\varepsilon^2\\right)\\right) + O(\\varepsilon^4) = \\frac{3}{8}\\varepsilon^2 + O(\\varepsilon^4) $$\nThe denominator vanishes as $\\varepsilon^2$.\n\nExpansion of the numerator, $Num = T_{\\alpha\\alpha} + T_{\\beta\\beta} - 2 T_{\\alpha\\beta}$:\n$$ Num = \\frac{3}{2}\\alpha + \\frac{3}{2}\\alpha(1+\\varepsilon) - 2 T_{\\alpha\\beta} = \\frac{3}{2}\\alpha(2+\\varepsilon) - 2 T_{\\alpha\\beta} = 3\\alpha(1+\\varepsilon/2) - 2 T_{\\alpha\\beta} $$\nThe coefficient in $T_{\\alpha\\beta}$ is $\\frac{3\\alpha\\beta}{\\alpha+\\beta} = \\frac{3\\alpha^2(1+\\varepsilon)}{\\alpha(2+\\varepsilon)} = \\frac{3\\alpha(1+\\varepsilon)}{2+\\varepsilon} = \\frac{3}{2}\\alpha \\frac{1+\\varepsilon}{1+\\varepsilon/2}$.\nThe fraction expands as $\\frac{1+\\varepsilon}{1+\\varepsilon/2} = (1+\\varepsilon)(1-\\varepsilon/2+\\varepsilon^2/4-\\dots) = 1+\\frac{\\varepsilon}{2}-\\frac{\\varepsilon^2}{4}+O(\\varepsilon^3)$.\nSo, $T_{\\alpha\\beta} = \\left(\\frac{3}{2}\\alpha \\left(1+\\frac{\\varepsilon}{2}-\\frac{\\varepsilon^2}{4}+O(\\varepsilon^3)\\right)\\right) \\left(1 - \\frac{3}{16}\\varepsilon^2 + O(\\varepsilon^4)\\right)$.\n$$ T_{\\alpha\\beta} = \\frac{3}{2}\\alpha \\left[ 1+\\frac{\\varepsilon}{2}-\\frac{\\varepsilon^2}{4} - \\frac{3}{16}\\varepsilon^2 \\right] + O(\\varepsilon^3) = \\frac{3}{2}\\alpha \\left[ 1+\\frac{\\varepsilon}{2}-\\frac{7}{16}\\varepsilon^2 \\right] + O(\\varepsilon^3) $$\n$$ 2T_{\\alpha\\beta} = 3\\alpha \\left[ 1+\\frac{\\varepsilon}{2}-\\frac{7}{16}\\varepsilon^2 \\right] + O(\\varepsilon^3) = 3\\alpha + \\frac{3}{2}\\alpha\\varepsilon - \\frac{21}{16}\\alpha\\varepsilon^2 + O(\\varepsilon^3) $$\nSubstituting into the numerator expression:\n$$ Num = (3\\alpha + \\frac{3}{2}\\alpha\\varepsilon) - \\left(3\\alpha + \\frac{3}{2}\\alpha\\varepsilon - \\frac{21}{16}\\alpha\\varepsilon^2\\right) + O(\\varepsilon^3) = \\frac{21}{16}\\alpha\\varepsilon^2 + O(\\varepsilon^3) $$\nThe numerator also vanishes as $\\varepsilon^2$, demonstrating the cancellation.\n\nNow we compute the limit of $E_{-}$:\n$$ E_{-} = \\frac{\\frac{21}{16}\\alpha\\varepsilon^2 + O(\\varepsilon^3)}{\\frac{3}{8}\\varepsilon^2 + O(\\varepsilon^4)} = \\frac{\\frac{21}{16}\\alpha}{\\frac{3}{8}} \\left( \\frac{1+O(\\varepsilon)}{1+O(\\varepsilon^2)} \\right) = \\frac{21 \\times 8}{16 \\times 3} \\alpha + O(\\varepsilon) = \\frac{7}{2}\\alpha + O(\\varepsilon) $$\nThe leading term of the expansion is $\\frac{7}{2}\\alpha$.\n\nFinally, we evaluate $E_{-}$ for the given parameters $\\alpha = 1.0 \\times 10^{-4}$ and $\\varepsilon = 1.0 \\times 10^{-8}$.\nUsing the leading term of the expansion:\n$$ E_{-} \\approx \\frac{7}{2}\\alpha = \\frac{7}{2}(1.0 \\times 10^{-4}) = 3.5 \\times 10^{-4} \\text{ hartree} $$\nThe next term in the expansion is of order $\\alpha\\varepsilon$, which is $O(10^{-12})$, and is negligible for an answer required to four significant figures.\nThus, the numerically stable result is obtained from the leading term of the asymptotic expansion.\nRounding the result to four significant figures gives $3.500 \\times 10^{-4}$ hartree.", "answer": "$$\\boxed{3.500 \\times 10^{-4}}$$", "id": "2910089"}, {"introduction": "The sheer number of two-electron integrals, scaling as the fourth power of the basis set size, presents a formidable challenge for storage and computation. This exercise introduces an advanced and powerful strategy for compressing this information by recasting the integral tensor as a positive semidefinite Coulomb metric matrix. You will implement a workflow [@problem_id:2910099] that combines thresholding with a pivoted Cholesky factorization to construct a guaranteed positive semidefinite low-rank approximation, a technique at the heart of modern methods that dramatically reduces computational cost.", "problem": "Design and implement a program that constructs a symmetric positive semidefinite approximation of a thresholded two-electron repulsion integral tensor and compresses it using a low-rank factorization that preserves Coulomb metric symmetry. Work entirely in the atomic-orbital product basis and in purely mathematical terms. No physical units are required.\n\nStart from the following fundamental base:\n- The two-electron repulsion integral tensor in chemists’ notation is $$(\\mu \\nu \\mid \\lambda \\sigma) = \\iint \\phi_{\\mu}(\\mathbf{r}_1)\\phi_{\\nu}(\\mathbf{r}_1)\\,\\frac{1}{\\lVert \\mathbf{r}_1 - \\mathbf{r}_2 \\rVert}\\,\\phi_{\\lambda}(\\mathbf{r}_2)\\phi_{\\sigma}(\\mathbf{r}_2)\\,d\\mathbf{r}_1\\,d\\mathbf{r}_2,$$ where $\\{\\phi_{\\mu}\\}$ are atomic orbital basis functions.\n- Introduce the composite index $p \\equiv p(\\mu,\\nu)$ that enumerates the unique symmetric pairs with $\\mu \\le \\nu$. Define the Coulomb metric matrix $G \\in \\mathbb{R}^{n_p \\times n_p}$ with elements $G_{p(\\mu,\\nu),\\,p(\\lambda,\\sigma)} = (\\mu \\nu \\mid \\lambda \\sigma)$. The matrix $G$ is symmetric positive semidefinite because for any symmetric coefficient vector $x \\in \\mathbb{R}^{n_p}$ representing a trial charge density $\\rho(\\mathbf{r}) = \\sum_{\\mu \\le \\nu} x_{p(\\mu,\\nu)} \\phi_{\\mu}(\\mathbf{r})\\phi_{\\nu}(\\mathbf{r})$, its quadratic form equals a Coulomb self-energy $x^{\\top} G x = \\iint \\rho(\\mathbf{r}_1)\\rho(\\mathbf{r}_2)\\lVert \\mathbf{r}_1 - \\mathbf{r}_2 \\rVert^{-1} d\\mathbf{r}_1 d\\mathbf{r}_2 \\ge 0$.\n- The chemists’ permutation symmetries are $(\\mu \\nu \\mid \\lambda \\sigma) = (\\nu \\mu \\mid \\lambda \\sigma) = (\\mu \\nu \\mid \\sigma \\lambda) = (\\lambda \\sigma \\mid \\mu \\nu)$.\n\nYour program must:\n1. Construct synthetic, ground-truth Coulomb metric matrices $G_{\\mathrm{true}}$ for several small atomic-orbital dimensions by generating low-rank factors $B \\in \\mathbb{R}^{n_p \\times r_{\\mathrm{true}}}$ and forming $G_{\\mathrm{true}} = B B^{\\top}$. Then interpret $G_{\\mathrm{true}}$ as a four-index tensor $(\\mu \\nu \\mid \\lambda \\sigma)$ consistent with the above symmetries by using the composite index map $p(\\mu,\\nu)$ with $\\mu \\le \\nu$ and $\\lambda \\le \\sigma$.\n2. Apply elementwise thresholding in the Coulomb metric matrix to obtain a thresholded matrix $G_{\\mathrm{thr}}$ by setting entries with absolute value less than $\\varepsilon$ to zero. Then re-enforce the Coulomb metric symmetry by symmetrization $G_{\\mathrm{sym}} = \\tfrac{1}{2}\\left(G_{\\mathrm{thr}} + G_{\\mathrm{thr}}^{\\top}\\right)$ and positiveness by projecting to the positive semidefinite cone: compute an eigenvalue decomposition of $G_{\\mathrm{sym}}$, set negative eigenvalues to zero, and reconstruct $G_{\\mathrm{psd}}$.\n3. Compress $G_{\\mathrm{psd}}$ by computing a low-rank approximation $G_{\\mathrm{approx}} \\approx L L^{\\top}$ using a pivoted Cholesky factorization terminated when the largest residual diagonal element is less than a tolerance $\\tau$. This guarantees the approximation preserves symmetry and positive semidefiniteness in the Coulomb metric.\n4. Quantify the compression quality using the relative Frobenius norm error\n$$\\eta = \\frac{\\lVert G_{\\mathrm{psd}} - G_{\\mathrm{approx}} \\rVert_{\\mathrm{F}}}{\\lVert G_{\\mathrm{psd}} \\rVert_{\\mathrm{F}}},$$\nwith the convention that $\\eta = 0$ if the denominator is zero. Also report the numerical rank $r$ of the approximation, equal to the number of Cholesky pivots taken.\n\nAlgorithmic constraints:\n- Enumerate composite indices $p(\\mu,\\nu)$ using only unique symmetric pairs with $\\mu \\le \\nu$ for $\\mu,\\nu \\in \\{0,\\dots, n_{\\mathrm{orb}}-1\\}$. The number of unique pairs is $n_p = n_{\\mathrm{orb}}(n_{\\mathrm{orb}}+1)/2$.\n- The pivoted Cholesky algorithm must be implemented explicitly. It may assume that its input is symmetric positive semidefinite and should terminate when the maximum residual diagonal entry is less than $\\tau$ or when all remaining residuals are nonpositive within floating point tolerance.\n\nTest suite:\nImplement and run the program on the following parameter sets, where each tuple is $(n_{\\mathrm{orb}}, r_{\\mathrm{true}}, \\varepsilon, \\tau, \\mathrm{seed})$:\n- Case A (happy path): $(4, 3, 10^{-8}, 10^{-10}, 1)$.\n- Case B (aggressive thresholding): $(4, 3, 10^{-2}, 10^{-8}, 2)$.\n- Case C (boundary zero case): $(4, 0, 10^{-8}, 10^{-10}, 3)$.\n- Case D (larger system): $(6, 4, 10^{-8}, 10^{-6}, 4)$.\n\nFor each case, generate $G_{\\mathrm{true}}$ by sampling independent standard normal entries for $B$ and forming $G_{\\mathrm{true}} = B B^{\\top}$. Then follow steps $2$ and $3$ to obtain $G_{\\mathrm{psd}}$ and $G_{\\mathrm{approx}}$ and compute $\\eta$ and $r$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For the four test cases A, B, C, and D, output the eight numbers in the order $[\\eta_{\\mathrm{A}}, r_{\\mathrm{A}}, \\eta_{\\mathrm{B}}, r_{\\mathrm{B}}, \\eta_{\\mathrm{C}}, r_{\\mathrm{C}}, \\eta_{\\mathrm{D}}, r_{\\mathrm{D}}]$, where each $\\eta$ is a floating-point number and each $r$ is an integer.", "solution": "The core object of study is the two-electron repulsion integral (ERI) tensor, $(\\mu \\nu \\mid \\lambda \\sigma)$, which is computationally prohibitive to store and manipulate for large systems. The problem models a common strategy to overcome this bottleneck: approximating the tensor in a compressed form that preserves its essential physical properties, namely symmetry and positive semidefiniteness. We operate not on the four-index tensor directly, but on its two-index matrix representation, the Coulomb metric $G$, defined over a basis of atomic orbital products.\n\nThe dimension of the atomic orbital basis is denoted by $n_{\\mathrm{orb}}$. The basis for charge densities is formed by products of atomic orbitals, $\\phi_{\\mu}(\\mathbf{r})\\phi_{\\nu}(\\mathbf{r})$. Due to the symmetry $\\phi_{\\mu}\\phi_{\\nu} = \\phi_{\\nu}\\phi_{\\mu}$, we need only consider unique pairs $(\\mu, \\nu)$ with $\\mu \\le \\nu$. The number of such pairs, which defines the dimension of our matrix problem, is $n_p = n_{\\mathrm{orb}}(n_{\\mathrm{orb}}+1)/2$. We establish a composite index mapping $p \\leftrightarrow (\\mu, \\nu)$ that enumerates these unique pairs.\n\nThe full procedure is executed in four main steps for each test case.\n\nStep 1: Generation of the Ground-Truth Coulomb Metric Matrix $G_{\\mathrm{true}}$\nWe begin by constructing a synthetic ground-truth matrix, $G_{\\mathrm{true}}$, that is symmetric and positive semidefinite by design. This avoids the complexity of computing actual ERI values while providing a valid object for testing the numerical algorithms.\nGiven the parameters $n_{\\mathrm{orb}}$ and a target rank $r_{\\mathrm{true}}$, we first compute the matrix dimension $n_p = n_{\\mathrm{orb}}(n_{\\mathrm{orb}}+1)/2$. We then generate a random matrix $B \\in \\mathbb{R}^{n_p \\times r_{\\mathrm{true}}}$ whose entries are sampled independently from a standard normal distribution, $B_{ij} \\sim \\mathcal{N}(0,1)$. The ground-truth matrix is then formed by the outer product:\n$$\nG_{\\mathrm{true}} = B B^{\\top}\n$$\nThe resulting matrix $G_{\\mathrm{true}} \\in \\mathbb{R}^{n_p \\times n_p}$ is symmetric ($G_{\\mathrm{true}} = (BB^{\\top})^{\\top} = (B^{\\top})^{\\top}B^{\\top} = BB^{\\top} = G_{\\mathrm{true}}$) and positive semidefinite. For any vector $x \\in \\mathbb{R}^{n_p}$, the quadratic form is $x^{\\top}G_{\\mathrm{true}}x = x^{\\top}BB^{\\top}x = (B^{\\top}x)^{\\top}(B^{\\top}x) = \\lVert B^{\\top}x \\rVert_2^2 \\ge 0$. The rank of $G_{\\mathrm{true}}$ is at most $r_{\\mathrm{true}}$. For the special case $r_{\\mathrm{true}}=0$, $B$ is a matrix with zero columns, and $G_{\\mathrm{true}}$ is the zero matrix.\n\nStep 2: Thresholding and Projection to the Positive Semidefinite Cone\nIn practical applications, many ERIs are small and can be neglected to reduce computational cost. This is modeled by an element-wise thresholding operation. We create a matrix $G_{\\mathrm{thr}}$ by setting all elements of $G_{\\mathrm{true}}$ with magnitude less than a threshold $\\varepsilon > 0$ to zero:\n$$\n(G_{\\mathrm{thr}})_{pq} = \n\\begin{cases}\n(G_{\\mathrm{true}})_{pq} & \\text{if } |(G_{\\mathrm{true}})_{pq}| \\ge \\varepsilon \\\\\n0 & \\text{otherwise}\n\\end{cases}\n$$\nThis operation can destroy the symmetry of the original matrix if, for instance, $|(G_{\\mathrm{true}})_{pq}| \\ge \\varepsilon$ but $|(G_{\\mathrm{true}})_{qp}| < \\varepsilon$. We restore symmetry by averaging with the transpose:\n$$\nG_{\\mathrm{sym}} = \\frac{1}{2}\\left(G_{\\mathrm{thr}} + G_{\\mathrm{thr}}^{\\top}\\right)\n$$\nWhile symmetric, $G_{\\mathrm{sym}}$ is not guaranteed to be positive semidefinite; the thresholding can introduce negative eigenvalues. A physically meaningful Coulomb metric must be positive semidefinite. We enforce this by projecting $G_{\\mathrm{sym}}$ onto the cone of positive semidefinite matrices. This is achieved through the eigendecomposition of $G_{\\mathrm{sym}} = V \\Lambda V^{\\top}$, where $V$ is the orthogonal matrix of eigenvectors and $\\Lambda$ is the diagonal matrix of real eigenvalues $\\lambda_i$. We form a new diagonal matrix $\\Lambda'$ by clipping all negative eigenvalues to zero: $\\Lambda'_{ii} = \\max(0, \\lambda_i)$. The projected matrix is then reconstructed:\n$$\nG_{\\mathrm{psd}} = V \\Lambda' V^{\\top}\n$$\nThis $G_{\\mathrm{psd}}$ is the closest positive semidefinite matrix to $G_{\\mathrm{sym}}$ with respect to the Frobenius norm. It serves as the input for the compression step.\n\nStep 3: Low-Rank Approximation via Pivoted Cholesky Factorization\nThe core of the compression is a low-rank approximation of $G_{\\mathrm{psd}}$ using a pivoted Cholesky factorization. The goal is to find a matrix $L \\in \\mathbb{R}^{n_p \\times r}$ with $r \\ll n_p$ such that $G_{\\mathrm{approx}} = LL^{\\top} \\approx G_{\\mathrm{psd}}$. The factorization algorithm for a symmetric positive semidefinite matrix $A \\in \\mathbb{R}^{n \\times n}$ proceeds as follows:\n1. Initialize a permutation vector $p= (0, 1, \\dots, n-1)$ and a copy of the input matrix, $C = A$.\n2. For $k = 0, 1, \\dots, n-1$:\n   a. Find the index $m \\ge k$ corresponding to the largest diagonal element of the current matrix, $C_{mm} = \\max_{j \\ge k} C_{jj}$. This is the pivot.\n   b. If $C_{mm} < \\tau$, where $\\tau$ is a predefined tolerance, terminate the factorization. The current iteration count $k$ is the numerical rank $r$.\n   c. Swap entries $k$ and $m$ in the permutation vector $p$.\n   d. Apply the same swap to the rows and columns of matrix $C$ to bring the pivot element to position $(k,k)$.\n   e. Compute the $k$-th column of the Cholesky factor. The diagonal element is $C_{kk} \\leftarrow \\sqrt{C_{kk}}$. The subdiagonal elements are $C_{j,k} \\leftarrow C_{j,k} / C_{k,k}$ for $j > k$.\n   f. Update the trailing submatrix of size $(n-k-1) \\times (n-k-1)$ by subtracting the outer product of the newly computed column vector: $C_{j>k,\\, l>k} \\leftarrow C_{j>k,\\, l>k} - C_{j>k,\\, k} C_{l>k,\\, k}^{\\top}$.\n3. After termination at rank $r$, the lower triangle of the modified matrix $C$ contains the Cholesky factor $L_{\\mathrm{perm}}$ of the permuted input matrix. Let $L_r$ be the first $r$ columns of $L_{\\mathrm{perm}}$. The approximation for the permuted matrix is $P A P^{\\top} \\approx L_r L_r^{\\top}$, where $P$ is the permutation matrix derived from $p$.\n4. The final approximate matrix is obtained by reversing the permutation:\n$$\nG_{\\mathrm{approx}} = P^{\\top} (L_r L_r^{\\top}) P = (P^{\\top} L_r)(P^{\\top} L_r)^{\\top}\n$$\nThis construction guarantees that $G_{\\mathrm{approx}}$ is symmetric, positive semidefinite, and has a rank of at most $r$.\n\nStep 4: Error Quantification\nThe quality of the compression is quantified by two metrics: the numerical rank $r$ of the approximation and the relative Frobenius norm error $\\eta$. The rank $r$ indicates the degree of compression. The error $\\eta$ measures the accuracy:\n$$\n\\eta = \\frac{\\lVert G_{\\mathrm{psd}} - G_{\\mathrm{approx}} \\rVert_{\\mathrm{F}}}{\\lVert G_{\\mathrm{psd}} \\rVert_{\\mathrm{F}}}\n$$\nwhere $\\lVert A \\rVert_{\\mathrm{F}} = \\sqrt{\\sum_{i,j} |A_{ij}|^2}$. If the denominator is zero (i.e., $G_{\\mathrm{psd}}$ is the zero matrix), we define $\\eta = 0$.\n\nThe implementation will execute these four steps for each specified test case and report the resulting $(r, \\eta)$ pairs.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef pivoted_cholesky(A, tau):\n    \"\"\"\n    Performs a pivoted Cholesky factorization of a symmetric positive semidefinite matrix.\n\n    Args:\n        A (np.ndarray): The symmetric positive semidefinite matrix to factorize.\n        tau (float): The tolerance for termination.\n\n    Returns:\n        tuple: A tuple containing:\n            - G_approx (np.ndarray): The low-rank approximation matrix LL^T.\n            - rank (int): The numerical rank of the approximation.\n    \"\"\"\n    n = A.shape[0]\n    C = A.copy()\n    p = np.arange(n)\n\n    for k in range(n):\n        # Find pivot in the remaining diagonal\n        # This is the diagonal of the Schur complement\n        diag_sub = np.diagonal(C)[k:]\n        \n        rel_pivot_idx = np.argmax(diag_sub)\n        max_diag_val = diag_sub[rel_pivot_idx]\n\n        if max_diag_val < tau:\n            rank = k\n            break\n        \n        abs_pivot_idx = k + rel_pivot_idx\n\n        # Swap permutation vector entries\n        p[k], p[abs_pivot_idx] = p[abs_pivot_idx], p[k]\n\n        # Swap rows and columns of C to bring pivot to C[k, k]\n        C[[k, abs_pivot_idx], :] = C[[abs_pivot_idx, k], :]\n        C[:, [k, abs_pivot_idx]] = C[:, [abs_pivot_idx, k]]\n\n        # Cholesky update for column k\n        pivot_val = C[k, k]\n        # Due to floating point arithmetic, pivot_val could be slightly negative\n        # even for PSD input. The check max_diag_val < tau handles this,\n        # but taking abs is a safe guard for sqrt.\n        l_kk = np.sqrt(max(0.0, pivot_val))\n        C[k, k] = l_kk\n        \n        if k + 1 < n:\n            l_col = C[k+1:, k] / l_kk\n            C[k+1:, k] = l_col\n            # Update trailing submatrix (Schur complement)\n            C[k+1:, k+1:] -= np.outer(l_col, l_col)\n    else: # Loop completed without break\n        rank = n\n\n    # Extract the permuted Cholesky factor L_perm from the lower triangle of C\n    L_perm = np.tril(C)\n    L_perm_r = L_perm[:, :rank]\n\n    # Reconstruct the approximate matrix G_approx = P^T (L_r L_r^T) P\n    # First, compute G_approx_perm = L_r L_r^T\n    G_approx_perm = L_perm_r @ L_perm_r.T\n\n    # Then, un-permute using the inverse permutation\n    inv_p = np.empty_like(p)\n    inv_p[p] = np.arange(n)\n    \n    G_approx = G_approx_perm[inv_p, :][:, inv_p]\n\n    return G_approx, rank\n\n\ndef run_case(n_orb, r_true, eps, tau, seed):\n    \"\"\"\n    Runs a single test case for the Coulomb metric approximation.\n    \"\"\"\n    # Set seed for reproducibility\n    rng = np.random.default_rng(seed)\n\n    # 1. Construct synthetic G_true\n    n_p = n_orb * (n_orb + 1) // 2\n    if r_true > 0:\n        B = rng.standard_normal(size=(n_p, r_true))\n        G_true = B @ B.T\n    else: # Special case for r_true = 0\n        G_true = np.zeros((n_p, n_p))\n\n    # 2. Apply thresholding and project to PSD cone\n    G_thr = np.where(np.abs(G_true) >= eps, G_true, 0.0)\n    G_sym = 0.5 * (G_thr + G_thr.T)\n    \n    eigvals, eigvecs = np.linalg.eigh(G_sym)\n    eigvals[eigvals < 0] = 0.0\n    G_psd = eigvecs @ np.diag(eigvals) @ eigvecs.T\n\n    # 3. Compress G_psd via pivoted Cholesky factorization\n    G_approx, rank = pivoted_cholesky(G_psd, tau)\n\n    # 4. Quantify compression quality\n    norm_psd = np.linalg.norm(G_psd, 'fro')\n    if norm_psd == 0.0:\n        eta = 0.0\n    else:\n        norm_diff = np.linalg.norm(G_psd - G_approx, 'fro')\n        eta = norm_diff / norm_psd\n        \n    return eta, rank\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Test suite: (n_orb, r_true, epsilon, tau, seed)\n    test_cases = [\n        # Case A (happy path)\n        (4, 3, 1e-8, 1e-10, 1),\n        # Case B (aggressive thresholding)\n        (4, 3, 1e-2, 1e-8, 2),\n        # Case C (boundary zero case)\n        (4, 0, 1e-8, 1e-10, 3),\n        # Case D (larger system)\n        (6, 4, 1e-8, 1e-6, 4),\n    ]\n\n    results = []\n    for case in test_cases:\n        eta, r = run_case(*case)\n        results.append(eta)\n        results.append(r)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2910099"}]}