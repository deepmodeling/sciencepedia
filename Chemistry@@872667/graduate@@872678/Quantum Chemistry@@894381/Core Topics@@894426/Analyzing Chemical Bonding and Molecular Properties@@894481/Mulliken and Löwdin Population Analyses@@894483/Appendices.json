{"hands_on_practices": [{"introduction": "Understanding any theoretical model begins with mastering its fundamental mechanics. This first practice focuses on the direct application of the Mulliken population analysis formula. By working through this exercise, you will translate the abstract definitions of the density matrix ($\\mathbf{P}$) and overlap matrix ($\\mathbf{S}$) into concrete numerical values for atomic populations and charges, solidifying your understanding of the core calculation [@problem_id:2906541].", "problem": "A molecular system is described in an Atomic Orbital (AO) basis consisting of $3$ real, linearly independent, non-orthogonal basis functions. Let the one-particle spin-summed density matrix (1PDM) in this AO basis be $P=\\begin{pmatrix}1.8  0.3  0\\\\ 0.3  1.2  0.1\\\\ 0  0.1  0.0\\end{pmatrix}$ and the overlap matrix be $S=\\begin{pmatrix}1  0.2  0\\\\ 0.2  1  0.1\\\\ 0  0.1  1\\end{pmatrix}$. Basis functions $\\{1,2\\}$ are centered on atom $A$ and basis function $\\{3\\}$ is centered on atom $B$. The nuclear charges are $Z_A=3$ and $Z_B=1$.\n\nStarting from the first-principles definition of Mulliken population analysis as a partition of the total electron number in a non-orthogonal AO basis according to the overlap-weighted contributions of AO pairs, derive the expressions for the Mulliken gross atomic populations $G_A$ and $G_B$ in terms of $P$ and $S$. Evaluate $G_A$ and $G_B$ for the given $P$ and $S$. Then compute the corresponding Mulliken net atomic charges $q_A$ and $q_B$ from the nuclear charges and the gross populations.\n\nReport the four numbers in the order $G_A$, $G_B$, $q_A$, $q_B$. Round your final reported numbers to four significant figures. No units are required.", "solution": "The problem statement is scientifically grounded, well-posed, and objective. All necessary data are provided, and there are no internal contradictions or logical flaws. The system described is physically plausible within the context of a quantum chemical calculation. Therefore, the problem is deemed valid and a solution will be provided.\n\nThe task is to derive and calculate the Mulliken gross atomic populations and net atomic charges for a given molecular system.\n\nFirst, we must derive the expression for the Mulliken gross atomic population. The total number of electrons, $N_e$, in a molecular system described by a set of real, non-orthogonal atomic orbitals $\\{\\chi_\\mu\\}$ is given by the spatial integral of the electron probability density, $\\rho(\\mathbf{r})$. The density itself is constructed from the one-particle density matrix (1PDM), $P$, and the basis functions:\n$$ \\rho(\\mathbf{r}) = \\sum_{\\mu, \\nu} P_{\\mu\\nu} \\chi_\\mu(\\mathbf{r}) \\chi_\\nu(\\mathbf{r}) $$\nThe total number of electrons is therefore:\n$$ N_e = \\int \\rho(\\mathbf{r}) d\\mathbf{r} = \\int \\sum_{\\mu, \\nu} P_{\\mu\\nu} \\chi_\\mu(\\mathbf{r}) \\chi_\\nu(\\mathbf{r}) d\\mathbf{r} = \\sum_{\\mu, \\nu} P_{\\mu\\nu} \\int \\chi_\\mu(\\mathbf{r}) \\chi_\\nu(\\mathbf{r}) d\\mathbf{r} $$\nThe integral term is the definition of the overlap matrix element, $S_{\\mu\\nu} = \\int \\chi_\\mu(\\mathbf{r}) \\chi_\\nu(\\mathbf{r}) d\\mathbf{r}$. This leads to the fundamental expression for the total number of electrons:\n$$ N_e = \\sum_{\\mu, \\nu} P_{\\mu\\nu} S_{\\mu\\nu} $$\nMulliken population analysis provides a method to partition this total electron count among the individual atoms. The sum is composed of diagonal terms ($\\mu = \\nu$) and off-diagonal terms ($\\mu \\neq \\nu$). A diagonal term, $P_{\\mu\\mu}S_{\\mu\\mu}$, represents a population associated purely with orbital $\\chi_\\mu$. An off-diagonal term, $P_{\\mu\\nu}S_{\\mu\\nu}$, is an overlap population between orbitals $\\chi_\\mu$ and $\\chi_\\nu$. The Mulliken scheme partitions the total overlap population between a pair of orbitals, $(P_{\\mu\\nu}S_{\\mu\\nu} + P_{\\nu\\mu}S_{\\nu\\mu})$, equally between the two participating orbitals.\n\nThe gross population of an individual atomic orbital $\\mu$, denoted $N_\\mu$, is defined as its diagonal population plus one-half of all its associated overlap populations:\n$$ N_\\mu = P_{\\mu\\mu}S_{\\mu\\mu} + \\frac{1}{2} \\sum_{\\nu \\neq \\mu} (P_{\\mu\\nu}S_{\\mu\\nu} + P_{\\nu\\mu}S_{\\nu\\mu}) $$\nFor the given system with real basis functions, the density matrix $P$ and the overlap matrix $S$ are symmetric, i.e., $P_{\\mu\\nu} = P_{\\nu\\mu}$ and $S_{\\mu\\nu} = S_{\\nu\\mu}$. The expression for $N_\\mu$ simplifies considerably:\n$$ N_\\mu = P_{\\mu\\mu}S_{\\mu\\mu} + \\frac{1}{2} \\sum_{\\nu \\neq \\mu} (2 P_{\\mu\\nu}S_{\\mu\\nu}) = P_{\\mu\\mu}S_{\\mu\\mu} + \\sum_{\\nu \\neq \\mu} P_{\\mu\\nu}S_{\\mu\\nu} $$\nThis can be written compactly as a single summation over all orbitals $\\nu$:\n$$ N_\\mu = \\sum_{\\nu=1}^{n} P_{\\mu\\nu}S_{\\mu\\nu} $$\nwhere $n=3$ is the total number of basis functions. Because the overlap matrix $S$ is symmetric ($S_{\\mu\\nu} = S_{\\nu\\mu}$), this is equivalent to:\n$$ N_\\mu = \\sum_{\\nu=1}^{n} P_{\\mu\\nu}S_{\\nu\\mu} $$\nThis final expression is precisely the definition of the diagonal element $(\\mu, \\mu)$ of the matrix product $PS$. Thus, the gross population for orbital $\\mu$ is elegantly expressed as:\n$$ N_\\mu = (PS)_{\\mu\\mu} $$\nThe Mulliken gross atomic population of an atom $A$, denoted $G_A$, is the sum of the gross orbital populations for all basis functions $\\{\\chi_\\mu\\}$ centered on that atom:\n$$ G_A = \\sum_{\\mu \\in A} N_\\mu = \\sum_{\\mu \\in A} (PS)_{\\mu\\mu} $$\nSimilarly, for atom $B$:\n$$ G_B = \\sum_{\\mu \\in B} (PS)_{\\mu\\mu} $$\nThe Mulliken net atomic charge on an atom, $q_A$, is the difference between its nuclear charge, $Z_A$, and its gross atomic population, $G_A$:\n$$ q_A = Z_A - G_A $$\n\nNow, we apply these derived formulae to the given problem.\nThe density matrix $P$ and overlap matrix $S$ are:\n$$ P = \\begin{pmatrix} 1.8  0.3  0 \\\\ 0.3  1.2  0.1 \\\\ 0  0.1  0.0 \\end{pmatrix}, \\quad S = \\begin{pmatrix} 1  0.2  0 \\\\ 0.2  1  0.1 \\\\ 0  0.1  1 \\end{pmatrix} $$\nWe first compute the matrix product $PS$:\n$$ PS = \\begin{pmatrix} 1.8  0.3  0 \\\\ 0.3  1.2  0.1 \\\\ 0  0.1  0.0 \\end{pmatrix} \\begin{pmatrix} 1  0.2  0 \\\\ 0.2  1  0.1 \\\\ 0  0.1  1 \\end{pmatrix} $$\n$$ PS = \\begin{pmatrix} (1.8)(1)+(0.3)(0.2)+(0)(0)  (1.8)(0.2)+(0.3)(1)+(0)(0.1)  (1.8)(0)+(0.3)(0.1)+(0)(1) \\\\ (0.3)(1)+(1.2)(0.2)+(0.1)(0)  (0.3)(0.2)+(1.2)(1)+(0.1)(0.1)  (0.3)(0)+(1.2)(0.1)+(0.1)(1) \\\\ (0)(1)+(0.1)(0.2)+(0.0)(0)  (0)(0.2)+(0.1)(1)+(0.0)(0.1)  (0)(0)+(0.1)(0.1)+(0.0)(1) \\end{pmatrix} $$\n$$ PS = \\begin{pmatrix} 1.8+0.06  0.36+0.3  0.03 \\\\ 0.3+0.24  0.06+1.2+0.01  0.12+0.1 \\\\ 0.02  0.1  0.01 \\end{pmatrix} = \\begin{pmatrix} 1.86  0.66  0.03 \\\\ 0.54  1.27  0.22 \\\\ 0.02  0.1  0.01 \\end{pmatrix} $$\nThe basis functions $\\{1, 2\\}$ belong to atom $A$, and basis function $\\{3\\}$ belongs to atom $B$. We compute the gross atomic populations:\n$$ G_A = (PS)_{11} + (PS)_{22} = 1.86 + 1.27 = 3.13 $$\n$$ G_B = (PS)_{33} = 0.01 $$\nThe total number of electrons is $N_e = G_A + G_B = 3.13 + 0.01 = 3.14$, which is consistent with $\\text{Tr}(PS) = 1.86 + 1.27 + 0.01 = 3.14$.\n\nNext, we compute the net atomic charges using the given nuclear charges $Z_A=3$ and $Z_B=1$:\n$$ q_A = Z_A - G_A = 3 - 3.13 = -0.13 $$\n$$ q_B = Z_B - G_B = 1 - 0.01 = 0.99 $$\nAs a check, the sum of net charges is $q_A + q_B = -0.13 + 0.99 = 0.86$. The total nuclear charge is $Z_A + Z_B = 3 + 1 = 4$. The total charge of the molecule is $Z_{total} - N_e = 4 - 3.14 = 0.86$, which confirms the consistency of the calculation.\n\nFinally, we round the four required values ($G_A, G_B, q_A, q_B$) to four significant figures.\n$G_A = 3.13 \\rightarrow 3.130$\n$G_B = 0.01 \\rightarrow 0.01000$\n$q_A = -0.13 \\rightarrow -0.1300$\n$q_B = 0.99 \\rightarrow 0.9900$\n\nThe results are reported in the requested order.", "answer": "$$\n\\boxed{\\begin{pmatrix} 3.130  0.01000  -0.1300  0.9900 \\end{pmatrix}}\n$$", "id": "2906541"}, {"introduction": "A crucial aspect of scientific literacy is understanding the limitations of a model. This exercise is a thought experiment designed to reveal a well-known pathology of Mulliken analysis: its potential to yield unphysical negative electron populations. By constructing a specific case involving an antibonding molecular orbital, you will discover how the method's partitioning scheme can break down, providing critical insight into why Mulliken charges must be interpreted with caution [@problem_id:2906519].", "problem": "In a minimal two-function basis, consider an idealized diatomic fragment with one Atomic Orbital (AO) $\\chi_{A}$ on atom $A$ and one AO $\\chi_{B}$ on atom $B$. The overlap matrix in the AO basis is\n$$\nS \\;=\\; \\begin{pmatrix}\n1  0.4\\\\\n0.4  1\n\\end{pmatrix}.\n$$\nAssume a single spin electron occupies one Molecular Orbital (MO) whose AO coefficient vector is of opposite phase on the two centers,\n$$\n\\mathbf{c} \\;=\\; \\begin{pmatrix} a \\\\ -\\,b \\end{pmatrix},\n$$\nwith $b/a = 0.2$ and $\\mathbf{c}^{\\top} S \\,\\mathbf{c} = 1$. Let the one-particle density matrix be the rank-one projector $P = \\mathbf{c}\\mathbf{c}^{\\top}$ (single occupancy). Atom $A$ has nuclear charge $Z_{A} = 1$.\n\nStarting from the definition of Mulliken population analysis in a non-orthogonal AO basis, derive the expression for the Mulliken gross atomic population on $A$ in terms of $S$ and $P$, evaluate it for the matrices and parameters given above, and obtain the Mulliken net atomic charge $q_{A} = Z_{A} - N_{A}^{\\mathrm{M}}$ on atom $A$. Briefly explain, in terms of the algebraic structure of the expressions you derive, the origin of any negative contributions to the Mulliken populations in this example. Express the final numerical value of $q_{A}$ exactly (no rounding).", "solution": "The problem has been validated and is deemed a well-posed, scientifically grounded problem in theoretical quantum chemistry. We shall proceed with a formal solution.\n\nThe total number of electrons, $N$, in a system described by a density matrix $P$ in a non-orthogonal Atomic Orbital (AO) basis $\\{\\chi_{\\mu}\\}$ with overlap matrix $S$ is given by the trace of the product of the density and overlap matrices:\n$$\nN = \\mathrm{Tr}(PS)\n$$\nwhere $S_{\\mu\\nu} = \\int \\chi_{\\mu}^*(\\mathbf{r})\\chi_{\\nu}(\\mathbf{r})d\\mathbf{r}$ and the density is $\\rho(\\mathbf{r}) = \\sum_{\\mu,\\nu} P_{\\mu\\nu} \\chi_{\\mu}(\\mathbf{r})\\chi_{\\nu}^*(\\mathbf{r})$. For a single electron in a real Molecular Orbital (MO) $\\psi = \\sum_{\\mu} c_{\\mu}\\chi_{\\mu}$, the density matrix is $P_{\\mu\\nu} = c_{\\mu}c_{\\nu}$. Since the MO is normalized, $\\mathbf{c}^{\\top}S\\mathbf{c} = 1$, the total number of electrons is indeed $N = \\mathrm{Tr}(\\mathbf{c}\\mathbf{c}^{\\top}S) = \\mathrm{Tr}(\\mathbf{c}^{\\top}S\\mathbf{c}) = \\mathbf{c}^{\\top}S\\mathbf{c} = 1$.\n\nMulliken population analysis partitions the total electron population among the atoms. The population on a given atom $K$, denoted $N_K^{\\mathrm{M}}$, is defined as the sum of the electronic populations attributed to the AOs centered on that atom. In this scheme, the total overlap population between any two AOs, $\\chi_{\\mu}$ and $\\chi_{\\nu}$, is partitioned equally between the corresponding atoms. This leads to the following expression for the gross atomic population on atom $K$:\n$$\nN_K^{\\mathrm{M}} = \\sum_{\\mu \\in K} \\sum_{\\nu} P_{\\mu\\nu}S_{\\nu\\mu}\n$$\nwhere the inner summation runs over all AOs in the basis, and the outer summation is restricted to AOs centered on atom $K$. The term $\\sum_{\\nu} P_{\\mu\\nu}S_{\\nu\\mu}$ is precisely the $\\mu$-th diagonal element of the matrix product $PS$. Therefore, the Mulliken population on atom $K$ is the sum of the diagonal elements of the $PS$ matrix corresponding to the AOs on atom $K$:\n$$\nN_K^{\\mathrm{M}} = \\sum_{\\mu \\in K} (PS)_{\\mu\\mu}\n$$\nIn the given problem, atom $A$ is associated with a single AO, which we label with index $1$. Thus, the Mulliken gross atomic population on $A$ is:\n$$\nN_A^{\\mathrm{M}} = (PS)_{11}\n$$\n\nTo evaluate this expression, we must first determine the coefficients $a$ and $b$ of the MO vector $\\mathbf{c} = \\begin{pmatrix} a \\\\ -b \\end{pmatrix}$. We are given the ratio $b/a = 0.2$, which implies $b = 0.2a$. The second condition is the MO normalization, $\\mathbf{c}^{\\top}S\\mathbf{c} = 1$.\n$$\n\\mathbf{c}^{\\top}S\\mathbf{c} = \\begin{pmatrix} a  -b \\end{pmatrix} \\begin{pmatrix} 1  0.4 \\\\ 0.4  1 \\end{pmatrix} \\begin{pmatrix} a \\\\ -b \\end{pmatrix} = 1\n$$\nExpanding this matrix product yields:\n$$\na^2 - 0.4ab - 0.4ab + b^2 = 1\n$$\n$$\na^2 - 0.8ab + b^2 = 1\n$$\nSubstituting $b = 0.2a$ into this equation:\n$$\na^2 - 0.8a(0.2a) + (0.2a)^2 = 1\n$$\n$$\na^2 - 0.16a^2 + 0.04a^2 = 1\n$$\n$$\n0.88a^2 = 1 \\implies a^2 = \\frac{1}{0.88} = \\frac{100}{88} = \\frac{25}{22}\n$$\nWe choose the positive root for $a$, so $a = \\sqrt{\\frac{25}{22}} = \\frac{5}{\\sqrt{22}}$. Consequently, $b = 0.2a = \\frac{1}{5} \\left( \\frac{5}{\\sqrt{22}} \\right) = \\frac{1}{\\sqrt{22}}$.\nThe coefficient vector is therefore:\n$$\n\\mathbf{c} = \\frac{1}{\\sqrt{22}} \\begin{pmatrix} 5 \\\\ -1 \\end{pmatrix}\n$$\nNext, we construct the density matrix $P = \\mathbf{c}\\mathbf{c}^{\\top}$:\n$$\nP = \\left( \\frac{1}{\\sqrt{22}} \\begin{pmatrix} 5 \\\\ -1 \\end{pmatrix} \\right) \\left( \\frac{1}{\\sqrt{22}} \\begin{pmatrix} 5  -1 \\end{pmatrix} \\right) = \\frac{1}{22} \\begin{pmatrix} 25  -5 \\\\ -5  1 \\end{pmatrix}\n$$\nNow, we compute the product matrix $PS$:\n$$\nPS = \\frac{1}{22} \\begin{pmatrix} 25  -5 \\\\ -5  1 \\end{pmatrix} \\begin{pmatrix} 1  0.4 \\\\ 0.4  1 \\end{pmatrix}\n$$\n$$\nPS = \\frac{1}{22} \\begin{pmatrix} (25)(1)+(-5)(0.4)  (25)(0.4)+(-5)(1) \\\\ (-5)(1)+(1)(0.4)  (-5)(0.4)+(1)(1) \\end{pmatrix}\n$$\n$$\nPS = \\frac{1}{22} \\begin{pmatrix} 25 - 2  10 - 5 \\\\ -5 + 0.4  -2 + 1 \\end{pmatrix} = \\frac{1}{22} \\begin{pmatrix} 23  5 \\\\ -4.6  -1 \\end{pmatrix}\n$$\nThe Mulliken gross atomic population on atom $A$ is the first diagonal element of this matrix:\n$$\nN_A^{\\mathrm{M}} = (PS)_{11} = \\frac{23}{22}\n$$\nThe Mulliken net atomic charge on atom $A$, $q_A$, is defined as the nuclear charge $Z_A$ minus the gross atomic population $N_A^{\\mathrm{M}}$. Given $Z_A = 1$:\n$$\nq_A = Z_A - N_A^{\\mathrm{M}} = 1 - \\frac{23}{22} = \\frac{22 - 23}{22} = -\\frac{1}{22}\n$$\nThe problem also requires an explanation of negative contributions to Mulliken populations. We can observe from the matrix $PS$ that the population on atom $B$ would be $N_B^{\\mathrm{M}} = (PS)_{22} = -1/22$. This is an unphysical negative population, a known pathology of Mulliken analysis. The origin of this behavior lies in the algebraic structure of the Mulliken partitioning scheme.\n\nThe population on atom $B$ (index $2$) is $N_B^{\\mathrm{M}} = (PS)_{22} = P_{21}S_{12} + P_{22}S_{22}$. Let us analyze the two terms:\n$1.$ The \"on-site\" contribution is $P_{22}S_{22} = c_2^2 S_{22}$. Since $S_{22}=1$ and $c_2^2 = (-b)^2 = b^2$ must be non-negative, this term is always non-negative. Here, it is $(\\frac{-1}{\\sqrt{22}})^2 (1) = \\frac{1}{22}$.\n$2.$ The \"overlap\" contribution is $P_{21}S_{12} = c_2 c_1 S_{12}$. This term's sign depends on the signs of $c_1$, $c_2$, and $S_{12}$.\nIn our case, the MO has coefficients of opposite phase ($a = \\frac{5}{\\sqrt{22}} > 0$ and $-b = \\frac{-1}{\\sqrt{22}}  0$), which is characteristic of an antibonding orbital. This makes the off-diagonal density matrix element $P_{21} = c_2 c_1 = (\\frac{-1}{\\sqrt{22}})(\\frac{5}{\\sqrt{22}}) = -\\frac{5}{22}$ negative. The overlap integral $S_{12}=0.4$ is positive.\nConsequently, the overlap contribution to the population on $B$ is negative: $P_{21}S_{12} = (-\\frac{5}{22})(0.4) = -\\frac{2}{22}$.\n\nThe total population on atom $B$ is the sum of these two contributions:\n$$\nN_B^{\\mathrm{M}} = \\frac{1}{22} + \\left(-\\frac{2}{22}\\right) = -\\frac{1}{22}\n$$\nThus, the algebraic origin of the negative contribution is the term $P_{\\mu\\nu}S_{\\nu\\mu}$ in the formula $N_K^{\\mathrm{M}} = \\sum_{\\mu \\in K}(PS)_{\\mu\\mu}$. When the product of the corresponding elements of the density and overlap matrices, $P_{\\mu\\nu}S_{\\nu\\mu}$, is negative (as occurs here for an antibonding orbital with positive AO overlap), it contributes negatively to the population. If this negative overlap contribution is larger in magnitude than the positive on-site contribution, the total gross atomic population for that center can become negative. This is what occurs for atom $B$. Note that the same negative term $P_{12}S_{21} = -\\frac{2}{22}$ also contributes to the population on atom $A$, reducing it from an \"on-site\" value of $P_{11}S_{11} = \\frac{25}{22}$ to the final value of $N_A^{\\mathrm{M}} = \\frac{23}{22}$.", "answer": "$$\n\\boxed{-\\frac{1}{22}}\n$$", "id": "2906519"}, {"introduction": "Moving from manual calculation to robust implementation is a key step in computational science. This final practice challenges you to design and validate an algorithmic workflow for both Mulliken and Löwdin population analyses, including the non-trivial computation of the matrix square root $\\mathbf{S}^{1/2}$. This capstone exercise bridges theory and practice, developing essential skills in translating mathematical definitions into code and verifying the results against fundamental physical and mathematical principles [@problem_id:2906487].", "problem": "You are to implement and verify a population analysis workflow in the context of molecular electronic structure represented in an atom-centered, generally non-orthogonal basis of Atomic Orbitals (AO). The core inputs are the overlap matrix and the one-particle density matrix in the AO basis. Begin from the following fundamental base: the overlap matrix is defined by the AO inner products, the density matrix encodes electron occupancy in the AO basis, and the total number of electrons equals the trace of the product of the density and overlap matrices. Using only these base facts, derive and implement the following operations entirely in linear algebraic terms.\n\nYour program must, for each test case:\n- Assemble the AO overlap matrix $S$ and the AO density matrix $P$, both of size $N \\times N$, with $S$ symmetric positive-definite and $P$ real symmetric.\n- Construct the unique symmetric positive-definite square root $S^{1/2}$ of $S$ by orthogonal diagonalization and functional calculus on its spectrum.\n- Form the Löwdin-orthogonalized density matrix $P^{\\mathrm{L}}$ in the Löwdin-orthogonal AO basis obtained from $S^{1/2}$.\n- Compute Mulliken gross atomic electron populations by equally partitioning shared AO overlap contributions and aggregating over the AO indices belonging to each atom, and then compute Mulliken atomic charges by subtracting the electron populations from the provided nuclear charges.\n- Compute Löwdin gross atomic electron populations in the Löwdin-orthogonal AO basis and the corresponding Löwdin atomic charges by subtracting these populations from the provided nuclear charges.\n\nValidation criteria to verify the implementation, to be checked within a given absolute tolerance $\\tau$, are:\n- Electron conservation: the sum of Mulliken atomic populations equals the total electron count given by $\\mathrm{tr}(P S)$, and the sum of Löwdin atomic populations equals the same total electron count; additionally, $\\mathrm{tr}(P^{\\mathrm{L}})$ must equal that total electron count.\n- Non-negativity: all Mulliken and Löwdin atomic populations must be $\\geq 0$ within tolerance.\n- Orthogonality consistency: when $S$ is the identity matrix, Mulliken and Löwdin atomic populations must match within tolerance for each atom.\n- Symmetry consistency: for a symmetric diatomic with two atoms possessing equal nuclear charges and a symmetric two-by-two overlap matrix with equal on-site elements and equal off-diagonal elements, the Mulliken atomic populations must be equal between the two atoms within tolerance, and the Löwdin atomic populations must also be equal between the two atoms within tolerance.\n\nUse the following test suite. Each test case supplies:\n- The overlap matrix $S$.\n- The density matrix $P$.\n- A partition of AO indices into atoms as a list of lists of zero-based AO indices per atom.\n- The list of nuclear charges $Z$ for each atom in the same order.\n- The tolerance $\\tau$ for validations (use the same $\\tau$ for all tests).\n\nTest case $1$ (happy path, symmetric diatomic in a minimal basis):\n- Dimension $N = 2$.\n- Overlap $S = \\begin{bmatrix} 1  0.45 \\\\ 0.45  1 \\end{bmatrix}$.\n- Define $s = 0.45$ and the density as $P = \\dfrac{1}{1+s}\\begin{bmatrix} 1  1 \\\\ 1  1 \\end{bmatrix}$, corresponding to a closed-shell occupancy in the bonding molecular orbital in this basis.\n- AO-to-atom mapping: $\\big[[0],[1]\\big]$ (one AO on each atom).\n- Nuclear charges $Z = [1, 1]$.\n- Expected special validations to apply: electron conservation, non-negativity, symmetry consistency.\n\nTest case $2$ (orthogonal basis boundary condition):\n- Dimension $N = 3$.\n- Overlap $S = I_{3}$ (the identity of size $3$).\n- Density $P = \\mathrm{diag}(1, 1, 2)$.\n- AO-to-atom mapping: $\\big[[0,1],[2]\\big]$ (first atom has two AOs, second atom has one AO).\n- Nuclear charges $Z = [2, 2]$.\n- Expected special validations to apply: electron conservation, non-negativity, orthogonality consistency.\n\nTest case $3$ (ill-conditioned but positive-definite overlap):\n- Dimension $N = 2$.\n- Overlap $S = \\begin{bmatrix} 1  0.999 \\\\ 0.999  1 \\end{bmatrix}$.\n- Define $s = 0.999$ and the density as $P = \\dfrac{1}{1+s}\\begin{bmatrix} 1  1 \\\\ 1  1 \\end{bmatrix}$.\n- AO-to-atom mapping: $\\big[[0],[1]\\big]$.\n- Nuclear charges $Z = [1, 1]$.\n- Expected special validations to apply: electron conservation, non-negativity, and, because of the specific symmetric choice above, symmetry consistency.\n\nFix the absolute tolerance at $\\tau = 10^{-8}$ for all checks. For each test case, your program should evaluate the applicable validation criteria and produce a single Boolean indicating whether all the applicable checks passed within tolerance.\n\nFinal output format:\n- Your program should produce a single line of output containing the Boolean results for the three test cases as a comma-separated list enclosed in square brackets, for example, $[{\\tt True},{\\tt False},{\\tt True}]$.\n- No additional text or whitespace should be printed beyond this single line.\n- All angles, if any, are irrelevant here. No physical units are involved in this task. All numerical comparisons must employ the stated absolute tolerance $\\tau$ only.", "solution": "We begin from the fundamental base appropriate to quantum chemistry in an AO representation. The overlap matrix $S$ is defined by $S_{\\mu\\nu} = \\langle \\chi_{\\mu} \\mid \\chi_{\\nu} \\rangle$, where $\\chi_{\\mu}$ are Atomic Orbital (AO) basis functions. The one-particle density matrix $P$ in the AO basis encodes electron occupancy and satisfies the electron count identity\n$$\nN_{e} = \\mathrm{tr}(P S),\n$$\nfor a real closed-shell system in a real AO basis. This identity follows from expressing $P$ as $P_{\\mu\\nu} = 2 \\sum_{i}^{\\mathrm{occ}} C_{\\mu i} C_{\\nu i}$ with $C$ the Molecular Orbital (MO) coefficients and using $C^{\\top} S C = I$ in an orthonormal MO basis, leading to\n$$\n\\mathrm{tr}(P S) = 2 \\sum_{i}^{\\mathrm{occ}} \\mathrm{tr}\\big( C_{\\cdot i} C_{\\cdot i}^{\\top} S \\big) = 2 \\sum_{i}^{\\mathrm{occ}} \\langle \\phi_{i} \\mid \\phi_{i} \\rangle = 2 \\sum_{i}^{\\mathrm{occ}} 1,\n$$\nwhich matches the total number of electrons for doubly occupied orbitals.\n\nMulliken population analysis partitions the electron density associated with overlap $\\chi_{\\mu}\\chi_{\\nu}$ equally between $\\mu$ and $\\nu$. From this equal partitioning, the gross AO population on AO $\\mu$ is the diagonal element of $P S$:\n$$\np_{\\mu}^{\\mathrm{M}} = (P S)_{\\mu\\mu} = \\sum_{\\nu} P_{\\mu\\nu} S_{\\nu\\mu}.\n$$\nSumming $p_{\\mu}^{\\mathrm{M}}$ over all AOs $\\mu$ belonging to atom $A$ gives the Mulliken gross atomic population $P_{A}^{\\mathrm{M}}$. The Mulliken atomic charge is then\n$$\nq_{A}^{\\mathrm{M}} = Z_{A} - P_{A}^{\\mathrm{M}},\n$$\nwith $Z_{A}$ the nuclear charge of atom $A$. Electron conservation follows from\n$$\n\\sum_{A} P_{A}^{\\mathrm{M}} = \\sum_{\\mu} p_{\\mu}^{\\mathrm{M}} = \\sum_{\\mu} (P S)_{\\mu\\mu} = \\mathrm{tr}(P S) = N_{e}.\n$$\nFor non-negativity, if $P$ is positive semidefinite and $S$ is positive definite, Mulliken AO populations $p_{\\mu}^{\\mathrm{M}}$ are non-negative in many typical scenarios, although strict non-negativity is not universally guaranteed for arbitrary $P$ and $S$. In our test suite, the constructed $P$ and $S$ ensure non-negativity.\n\nLöwdin population analysis proceeds by symmetric orthogonalization of the AO basis. Diagonalize the symmetric positive-definite overlap matrix $S$ as\n$$\nS = U \\Lambda U^{\\top},\n$$\nwhere $U$ is orthogonal and $\\Lambda = \\mathrm{diag}(\\lambda_{1},\\ldots,\\lambda_{N})$ with $\\lambda_{i}  0$. Define the unique symmetric positive-definite square root by functional calculus:\n$$\nS^{1/2} = U \\Lambda^{1/2} U^{\\top}, \\quad \\Lambda^{1/2} = \\mathrm{diag}(\\sqrt{\\lambda_{1}},\\ldots,\\sqrt{\\lambda_{N}}).\n$$\nThe Löwdin-orthogonalized AO basis functions are $\\tilde{\\chi} = S^{1/2} \\chi$, which are orthonormal by construction, since\n$$\n\\langle \\tilde{\\chi} \\mid \\tilde{\\chi} \\rangle = (S^{1/2})^{\\top} S^{-1} (S^{1/2}) = I.\n$$\nThe density matrix in this orthonormal AO basis transforms as\n$$\nP^{\\mathrm{L}} = S^{1/2} P S^{1/2}.\n$$\nIn any orthonormal basis, the gross AO population equals the diagonal of the density matrix, so the Löwdin AO populations are $p_{\\mu}^{\\mathrm{L}} = (P^{\\mathrm{L}})_{\\mu\\mu}$, and the Löwdin gross atomic population is $P_{A}^{\\mathrm{L}} = \\sum_{\\mu \\in A} p_{\\mu}^{\\mathrm{L}}$. Löwdin atomic charges are\n$$\nq_{A}^{\\mathrm{L}} = Z_{A} - P_{A}^{\\mathrm{L}}.\n$$\nElectron conservation holds because\n$$\n\\sum_{\\mu} p_{\\mu}^{\\mathrm{L}} = \\mathrm{tr}(P^{\\mathrm{L}}) = \\mathrm{tr}(S^{1/2} P S^{1/2}) = \\mathrm{tr}(P S) = N_{e},\n$$\nwhere we used cyclic invariance of the trace. For non-negativity, $P^{\\mathrm{L}}$ is positive semidefinite when $P$ is positive semidefinite, so $p_{\\mu}^{\\mathrm{L}} \\ge 0$.\n\nOrthogonality consistency: if $S = I$, then $S^{1/2} = I$ and $P^{\\mathrm{L}} = P$, so Mulliken AO populations reduce to $(P S)_{\\mu\\mu} = P_{\\mu\\mu}$ and Löwdin AO populations are $(P^{\\mathrm{L}})_{\\mu\\mu} = P_{\\mu\\mu}$; hence the atomic populations match.\n\nSymmetry consistency in the symmetric diatomic: for a two-AO, two-atom system with $S = \\begin{bmatrix} 1  s \\\\ s  1 \\end{bmatrix}$, $s \\in (0,1)$, and a closed-shell bonding density\n$$\nP = \\frac{1}{1+s} \\begin{bmatrix} 1  1 \\\\ 1  1 \\end{bmatrix},\n$$\nwe have\n$$\nP S = \\frac{1}{1+s} \\begin{bmatrix} 1  1 \\\\ 1  1 \\end{bmatrix} \\begin{bmatrix} 1  s \\\\ s  1 \\end{bmatrix} = \\frac{1}{1+s} \\begin{bmatrix} 1+s  1+s \\\\ 1+s  1+s \\end{bmatrix},\n$$\nso the Mulliken AO populations are both $1$, giving equal atomic populations and thus equal charges when $Z_{1} = Z_{2}$. For Löwdin, $S$ has eigenvalues $1+s$ and $1-s$ with orthogonal eigenvectors, and $S^{1/2}$ is well-defined; the resulting $P^{\\mathrm{L}}$ has diagonal entries summing to $2$ with equal contributions by symmetry, again yielding equal atomic populations and charges.\n\nAlgorithmic design:\n- Compute $S^{1/2}$ via symmetric eigendecomposition $S = U \\Lambda U^{\\top}$ and reconstruct $U \\Lambda^{1/2} U^{\\top}$. This is numerically stable for symmetric positive-definite $S$. For ill-conditioned $S$, small positive eigenvalues remain well-defined, and using a tolerance to floor tiny negative numerical artifacts to zero is appropriate.\n- Mulliken populations: form $M = P S$ and take its diagonal as AO populations, then sum per-atom blocks.\n- Löwdin populations: form $P^{\\mathrm{L}} = S^{1/2} P S^{1/2}$, take its diagonal as AO populations, then sum per-atom blocks.\n- Compute charges as $q_{A} = Z_{A} - P_{A}$ for both analyses.\n- Validations:\n  - Electron conservation: check $\\left|\\sum_{A} P_{A}^{\\mathrm{M}} - \\mathrm{tr}(P S)\\right| \\le \\tau$, $\\left|\\sum_{A} P_{A}^{\\mathrm{L}} - \\mathrm{tr}(P S)\\right| \\le \\tau$, and $\\left| \\mathrm{tr}(P^{\\mathrm{L}}) - \\mathrm{tr}(P S) \\right| \\le \\tau$.\n  - Non-negativity: check $\\min_{A} P_{A}^{\\mathrm{M}} \\ge -\\tau$ and $\\min_{A} P_{A}^{\\mathrm{L}} \\ge -\\tau$.\n  - Orthogonality consistency (applicable when $S = I$): check $\\max_{A} |P_{A}^{\\mathrm{M}} - P_{A}^{\\mathrm{L}}| \\le \\tau$.\n  - Symmetry consistency (applicable for the symmetric diatomic and the third symmetric case): check $|P_{1}^{\\mathrm{M}} - P_{2}^{\\mathrm{M}}| \\le \\tau$ and $|P_{1}^{\\mathrm{L}} - P_{2}^{\\mathrm{L}}| \\le \\tau$.\n\nTest suite specifics:\n- Test $1$: $N = 2$, $S = \\begin{bmatrix} 1  0.45 \\\\ 0.45  1 \\end{bmatrix}$, $P = \\dfrac{1}{1+0.45} \\begin{bmatrix} 1  1 \\\\ 1  1 \\end{bmatrix}$, atoms $\\big[[0],[1]\\big]$, $Z = [1,1]$. Applicable checks: electron conservation, non-negativity, symmetry consistency.\n- Test $2$: $N = 3$, $S = I_{3}$, $P = \\mathrm{diag}(1,1,2)$, atoms $\\big[[0,1],[2]\\big]$, $Z = [2,2]$. Applicable checks: electron conservation, non-negativity, orthogonality consistency.\n- Test $3$: $N = 2$, $S = \\begin{bmatrix} 1  0.999 \\\\ 0.999  1 \\end{bmatrix}$, $P = \\dfrac{1}{1+0.999} \\begin{bmatrix} 1  1 \\\\ 1  1 \\end{bmatrix}$, atoms $\\big[[0],[1]\\big]$, $Z = [1,1]$. Applicable checks: electron conservation, non-negativity, symmetry consistency.\n\nWith $\\tau = 10^{-8}$, each test produces a Boolean stating whether all applicable validations passed. The program aggregates these three Booleans in a single line as a Python list literal, for example $[{\\tt True},{\\tt True},{\\tt True}]$.\n\n```python\nimport numpy as np\n\ndef symmetric_matrix_sqrt(S, tol=1e-14):\n    \"\"\"Compute the unique symmetric positive-definite square root S^{1/2} of S via eigendecomposition.\"\"\"\n    # Ensure symmetry\n    S = 0.5 * (S + S.T)\n    vals, vecs = np.linalg.eigh(S)\n    # Clean small negatives due to numerical roundoff\n    vals = np.where(vals  0, np.where(np.abs(vals)  tol, 0.0, vals), vals)\n    if np.any(vals = 0):\n        # For strict SPD assumption, tiny nonpositive eigenvalues indicate ill-conditioning.\n        # Floor them to a tiny positive number to keep S^{1/2} well-defined.\n        floor = tol\n        vals = np.maximum(vals, floor)\n    sqrt_vals = np.sqrt(vals)\n    S_half = (vecs * sqrt_vals) @ vecs.T\n    # Enforce symmetry\n    S_half = 0.5 * (S_half + S_half.T)\n    return S_half\n\ndef mulliken_atomic_populations(S, P, atom_blocks):\n    \"\"\"Compute Mulliken gross atomic populations: diag(P S) summed over AO blocks per atom.\"\"\"\n    M = P @ S\n    ao_pops = np.diag(M)\n    atom_pops = []\n    for block in atom_blocks:\n        atom_pops.append(float(np.sum(ao_pops[block])))\n    return np.array(atom_pops)\n\ndef lowdin_atomic_populations(S, P, atom_blocks):\n    \"\"\"Compute Löwdin gross atomic populations using P^L = S^{1/2} P S^{1/2}.\"\"\"\n    S_half = symmetric_matrix_sqrt(S)\n    P_L = S_half @ P @ S_half\n    P_L = 0.5 * (P_L + P_L.T)  # enforce symmetry\n    ao_pops = np.diag(P_L)\n    atom_pops = []\n    for block in atom_blocks:\n        atom_pops.append(float(np.sum(ao_pops[block])))\n    return np.array(atom_pops)\n\ndef total_electrons(S, P):\n    \"\"\"Compute total electron count N_e = tr(P S).\"\"\"\n    return float(np.trace(P @ S))\n\ndef is_identity(S, tol=1e-12):\n    I = np.eye(S.shape[0])\n    return np.allclose(S, I, atol=tol, rtol=0.0)\n\ndef solve():\n    tau = 1e-8\n\n    # Test case 1: symmetric diatomic, minimal basis\n    s1 = 0.45\n    S1 = np.array([[1.0, s1],\n                   [s1, 1.0]])\n    P1 = (1.0 / (1.0 + s1)) * np.array([[1.0, 1.0],\n                                        [1.0, 1.0]])\n    atoms1 = [[0], [1]]\n    Z1 = np.array([1.0, 1.0])\n\n    # Test case 2: orthogonal basis\n    S2 = np.eye(3)\n    P2 = np.diag([1.0, 1.0, 2.0])\n    atoms2 = [[0, 1], [2]]\n    Z2 = np.array([2.0, 2.0])\n\n    # Test case 3: ill-conditioned overlap\n    s3 = 0.999\n    S3 = np.array([[1.0, s3],\n                   [s3, 1.0]])\n    P3 = (1.0 / (1.0 + s3)) * np.array([[1.0, 1.0],\n                                        [1.0, 1.0]])\n    atoms3 = [[0], [1]]\n    Z3 = np.array([1.0, 1.0])\n\n    test_cases = [\n        (S1, P1, atoms1, Z1, {'check_symmetry': True, 'check_orthogonality': False}),\n        (S2, P2, atoms2, Z2, {'check_symmetry': False, 'check_orthogonality': True}),\n        (S3, P3, atoms3, Z3, {'check_symmetry': True, 'check_orthogonality': False}),\n    ]\n\n    results = []\n    for S, P, atom_blocks, Z, flags in test_cases:\n        # Populations\n        Pm = mulliken_atomic_populations(S, P, atom_blocks)\n        Pl = lowdin_atomic_populations(S, P, atom_blocks)\n        # Charges (not directly validated here, but computed per instruction)\n        qm = Z - Pm\n        ql = Z - Pl\n\n        # Electron conservation\n        Ne = total_electrons(S, P)\n        P_L_trace = np.trace(symmetric_matrix_sqrt(S) @ P @ symmetric_matrix_sqrt(S))\n        cons_ok = (\n            abs(np.sum(Pm) - Ne) = tau and\n            abs(np.sum(Pl) - Ne) = tau and\n            abs(P_L_trace - Ne) = tau\n        )\n\n        # Non-negativity\n        nonneg_ok = (np.min(Pm) = -tau) and (np.min(Pl) = -tau)\n\n        # Orthogonality consistency (if S is identity, Mulliken and Löwdin populations must match)\n        if flags.get('check_orthogonality', False):\n            ortho_ok = np.allclose(Pm, Pl, atol=tau, rtol=0.0) and is_identity(S)\n        else:\n            ortho_ok = True\n\n        # Symmetry consistency (for symmetric diatomic, populations equal between atoms)\n        if flags.get('check_symmetry', False):\n            if len(atom_blocks) == 2 and len(atom_blocks[0]) == 1 and len(atom_blocks[1]) == 1:\n                sym_ok = (abs(Pm[0] - Pm[1]) = tau) and (abs(Pl[0] - Pl[1]) = tau)\n            else:\n                sym_ok = False\n        else:\n            sym_ok = True\n\n        all_ok = cons_ok and nonneg_ok and ortho_ok and sym_ok\n        results.append(all_ok)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "answer": "[True,True,True]", "id": "2906487"}]}