{"hands_on_practices": [{"introduction": "The absolute intensity of forward scattering, $I(0)$, provides a direct link between a macroscopic measurement and the microscopic properties of a colloidal system. This first practice challenges you to derive this relationship for a core-shell nanoparticle, a common model for many advanced materials. By working through this derivation, you will solidify your understanding of how scattering contrast and particle volume determine the overall signal strength, enabling you to extract quantitative information like particle concentration from experimental data. [@problem_id:142638]", "problem": "In small-angle X-ray or neutron scattering (SAXS/SANS), the absolute calibrated scattered intensity $I(q)$ from a dilute suspension of identical, monodisperse particles is given by:\n$$\nI(q) = n_p P(q)\n$$\nwhere $n_p$ is the number density (number of particles per unit volume) and $P(q)$ is the form factor of a single particle. The form factor is the square of the particle's scattering amplitude, $P(q) = |A(q)|^2$. The scattering amplitude is defined by the Fourier transform of the particle's scattering length density (SLD) profile relative to the solvent:\n$$\nA(q) = \\int_{V_p} (\\rho(\\mathbf{r}) - \\rho_s) e^{-i\\mathbf{q}\\cdot\\mathbf{r}} d^3r\n$$\nHere, $\\rho(\\mathbf{r})$ is the SLD of the particle, $\\rho_s$ is the constant SLD of the solvent, $V_p$ is the particle volume, and $\\mathbf{q}$ is the scattering vector with magnitude $q$.\n\nFor forward scattering ($q \\to 0$), this relationship simplifies, as the exponential term becomes unity. The forward scattering intensity, $I(0)$, is particularly useful as it relates directly to the particle volume and concentration.\n\nConsider a system of monodisperse, spherical core-shell nanoparticles suspended in a solvent. Each particle consists of a spherical core of radius $R_c$ with a uniform SLD of $\\rho_c$, surrounded by a concentric spherical shell of outer radius $R_t$ with a uniform SLD of $\\rho_{sh}$. The particles are dispersed in a solvent with a uniform SLD of $\\rho_s$. A scattering experiment measures the absolute forward scattering intensity to be $I(0)$.\n\nAssuming the suspension is sufficiently dilute such that inter-particle interactions are negligible, derive an expression for the number density, $n_p$, of the core-shell nanoparticles. The final expression should be in terms of $I(0)$, the radii $R_c$ and $R_t$, and the scattering length densities $\\rho_c$, $\\rho_{sh}$, and $\\rho_s$.", "solution": "We have for forward scattering ($q\\to0$):\n$$I(0)=n_p\\,P(0)=n_p\\,|A(0)|^2.$$\nThe amplitude at $q=0$ is\n$$A(0)=\\int_{V_p}(\\rho(\\mathbf r)-\\rho_s)\\,d^3r\n=(\\rho_c-\\rho_s)V_c+(\\rho_{sh}-\\rho_s)(V_t-V_c),$$\nwhere \n$$V_c=\\frac{4\\pi}{3}R_c^3,\\quad V_t=\\frac{4\\pi}{3}R_t^3.$$\nHence\n$$A(0)\n=\\frac{4\\pi}{3}\\bigl[R_c^3(\\rho_c-\\rho_s)+(R_t^3-R_c^3)(\\rho_{sh}-\\rho_s)\\bigr].$$\nThus\n$$P(0)=|A(0)|^2\n=\\left(\\frac{4\\pi}{3}\\bigl[R_c^3(\\rho_c-\\rho_s)+(R_t^3-R_c^3)(\\rho_{sh}-\\rho_s)\\bigr]\\right)^2.$$\nSolving for $n_p$ gives\n$$n_p=\\frac{I(0)}{P(0)}\n=\\frac{I(0)}{\\left(\\frac{4\\pi}{3}\\bigl[R_c^3(\\rho_c-\\rho_s)+(R_t^3-R_c^3)(\\rho_{sh}-\\rho_s)\\bigr]\\right)^2}.$$", "answer": "$$\\boxed{\\frac{I(0)}{\\left(\\frac{4\\pi}{3}\\bigl[R_c^3(\\rho_c-\\rho_s)+(R_t^3-R_c^3)(\\rho_{sh}-\\rho_s)\\bigr]\\right)^2}}$$", "id": "142638"}, {"introduction": "One of the most powerful strategies in small-angle neutron scattering (SANS) is contrast variation, which allows researchers to selectively highlight or hide different components within a complex mixture. This is often achieved by mixing hydrogenated and deuterated solvents, such as light ($\\text{H}_2\\text{O}$) and heavy ($\\text{D}_2\\text{O}$) water, to tune the solvent's overall scattering length density (SLD). This exercise guides you through the fundamental principle of contrast matching, requiring you to calculate the precise solvent composition needed to make a polymer 'invisible' to neutrons, a critical step in isolating the scattering from other components in a multi-part system. [@problem_id:2928096]", "problem": "A homogeneous polymer solution is studied by Small-Angle Neutron Scattering (SANS), a subset of small-angle scattering techniques that also include Small-Angle X-ray Scattering (SAXS). The solvent is a binary isotopic mixture of heavy water and light water. The scattering length density (SLD) is defined as the coherent nuclear scattering length per unit volume. Assume the following:\n\n- The mixture is ideal and incompressible on the scale probed by SANS, so that volumes are additive and composition fluctuations are negligible compared to the instrument resolution.\n- The mixture is macroscopically homogeneous and isotropic.\n- Each pure component has a uniform SLD equal to its bulk value.\n- The spatially averaged SLD that enters the forward scattering amplitude is the volume-average of the local SLD field.\n\nStarting from the definition of the scattering amplitude as the spatial integral of the SLD field multiplied by a phase factor, and using the assumptions above, derive the relation between the solvent mixture SLD and the heavy-water volume fraction. Then, using the widely accepted SLD values for the pure isotopic solvents, $\\rho_{\\text{H}_2\\text{O}}=-0.56\\times 10^{-6}\\ \\text{\\AA}^{-2}$ and $\\rho_{\\text{D}_2\\text{O}}=6.34\\times 10^{-6}\\ \\text{\\AA}^{-2}$, compute the deuterium-oxide volume fraction that matches a hydrogenated polymer with SLD $\\rho_{p}=1.80\\times 10^{-6}\\ \\text{\\AA}^{-2}$, i.e., the composition at which the polymer–solvent contrast vanishes.\n\nExpress your final answer as a decimal volume fraction (dimensionless) and round to four significant figures.", "solution": "The problem requires the derivation of the relationship for the scattering length density (SLD) of an ideal binary isotopic solvent mixture and the subsequent calculation of the mixture composition required to achieve contrast matching with a dissolved polymer. The validation process confirms the problem statement is scientifically sound, well-posed, and contains all necessary information. We proceed with the solution.\n\nThe problem states that the spatially averaged SLD is the volume-average of the local SLD field. Let us formalize this. The average SLD, which we will denote as $\\rho_{solv}$ for the solvent mixture, is defined as the total coherent scattering length, $B_{solv}$, contained within a given volume, $V_{solv}$, divided by that volume.\n$$\n\\rho_{solv} = \\frac{B_{solv}}{V_{solv}}\n$$\nThe solvent is a binary mixture of heavy water ($\\text{D}_2\\text{O}$) and light water ($\\text{H}_2\\text{O}$). According to the assumption of an ideal, incompressible mixture, the total volume is the sum of the volumes of its components.\n$$\nV_{solv} = V_{\\text{D}_2\\text{O}} + V_{\\text{H}_2\\text{O}}\n$$\nHere, $V_{\\text{D}_2\\text{O}}$ is the volume of heavy water and $V_{\\text{H}_2\\text{O}}$ is the volume of light water in the mixture. The total coherent scattering length $B_{solv}$ is likewise the sum of the scattering lengths from each component. The scattering length of a component is the product of its uniform SLD and its volume. Let $\\rho_{\\text{D}_2\\text{O}}$ be the SLD of pure heavy water and $\\rho_{\\text{H}_2\\text{O}}$ be the SLD of pure light water. Then, the total scattering length is:\n$$\nB_{solv} = \\rho_{\\text{D}_2\\text{O}} V_{\\text{D}_2\\text{O}} + \\rho_{\\text{H}_2\\text{O}} V_{\\text{H}_2\\text{O}}\n$$\nSubstituting the expressions for $B_{solv}$ and $V_{solv}$ into the definition of the average SLD gives:\n$$\n\\rho_{solv} = \\frac{\\rho_{\\text{D}_2\\text{O}} V_{\\text{D}_2\\text{O}} + \\rho_{\\text{H}_2\\text{O}} V_{\\text{H}_2\\text{O}}}{V_{\\text{D}_2\\text{O}} + V_{\\text{H}_2\\text{O}}}\n$$\nWe can rewrite this expression in terms of volume fractions. Let $\\phi$ be the volume fraction of heavy water in the solvent mixture, defined as:\n$$\n\\phi = \\frac{V_{\\text{D}_2\\text{O}}}{V_{solv}} = \\frac{V_{\\text{D}_2\\text{O}}}{V_{\\text{D}_2\\text{O}} + V_{\\text{H}_2\\text{O}}}\n$$\nSince the mixture is binary, the volume fraction of light water is necessarily $(1-\\phi)$.\n$$\n1 - \\phi = 1 - \\frac{V_{\\text{D}_2\\text{O}}}{V_{\\text{D}_2\\text{O}} + V_{\\text{H}_2\\text{O}}} = \\frac{V_{\\text{H}_2\\text{O}}}{V_{\\text{D}_2\\text{O}} + V_{\\text{H}_2\\text{O}}} = \\frac{V_{\\text{H}_2\\text{O}}}{V_{solv}}\n$$\nDividing the numerator and denominator of the expression for $\\rho_{solv}$ by $V_{solv}$, we obtain:\n$$\n\\rho_{solv} = \\rho_{\\text{D}_2\\text{O}} \\left(\\frac{V_{\\text{D}_2\\text{O}}}{V_{solv}}\\right) + \\rho_{\\text{H}_2\\text{O}} \\left(\\frac{V_{\\text{H}_2\\text{O}}}{V_{solv}}\\right)\n$$\nSubstituting the volume fractions, we arrive at the first required result: the linear relationship between the solvent mixture SLD and the heavy-water volume fraction $\\phi$.\n$$\n\\rho_{solv}(\\phi) = \\phi \\rho_{\\text{D}_2\\text{O}} + (1-\\phi) \\rho_{\\text{H}_2\\text{O}}\n$$\nThis linear mixing rule is a direct consequence of the assumption of volume additivity for an ideal mixture.\n\nThe second part of the problem asks for the specific volume fraction $\\phi$ at which the solvent SLD matches the polymer SLD, $\\rho_p$. This condition, known as contrast matching, means the net scattering from the polymer becomes zero. Mathematically, we set $\\rho_{solv}(\\phi) = \\rho_p$.\n$$\n\\rho_p = \\phi \\rho_{\\text{D}_2\\text{O}} + (1-\\phi) \\rho_{\\text{H}_2\\text{O}}\n$$\nWe must now solve this equation for $\\phi$. Expanding the right-hand side gives:\n$$\n\\rho_p = \\phi \\rho_{\\text{D}_2\\text{O}} + \\rho_{\\text{H}_2\\text{O}} - \\phi \\rho_{\\text{H}_2\\text{O}}\n$$\nWe group the terms containing $\\phi$:\n$$\n\\rho_p - \\rho_{\\text{H}_2\\text{O}} = \\phi (\\rho_{\\text{D}_2\\text{O}} - \\rho_{\\text{H}_2\\text{O}})\n$$\nIsolating $\\phi$ yields the analytical expression for the contrast-matching volume fraction:\n$$\n\\phi = \\frac{\\rho_p - \\rho_{\\text{H}_2\\text{O}}}{\\rho_{\\text{D}_2\\text{O}} - \\rho_{\\text{H}_2\\text{O}}}\n$$\nWe are given the following numerical values for the SLDs:\n$$\n\\rho_{\\text{H}_2\\text{O}} = -0.56 \\times 10^{-6}\\ \\text{\\AA}^{-2}\n$$\n$$\n\\rho_{\\text{D}_2\\text{O}} = 6.34 \\times 10^{-6}\\ \\text{\\AA}^{-2}\n$$\n$$\n\\rho_{p} = 1.80 \\times 10^{-6}\\ \\text{\\AA}^{-2}\n$$\nSubstituting these values into the expression for $\\phi$:\n$$\n\\phi = \\frac{(1.80 \\times 10^{-6}) - (-0.56 \\times 10^{-6})}{(6.34 \\times 10^{-6}) - (-0.56 \\times 10^{-6})}\n$$\nThe common factor of $10^{-6}\\ \\text{\\AA}^{-2}$ cancels from the numerator and the denominator.\n$$\n\\phi = \\frac{1.80 - (-0.56)}{6.34 - (-0.56)} = \\frac{1.80 + 0.56}{6.34 + 0.56} = \\frac{2.36}{6.90}\n$$\nPerforming the division:\n$$\n\\phi \\approx 0.34202898...\n$$\nThe problem requires the answer to be rounded to four significant figures. The first four significant figures are $3$, $4$, $2$, and $0$. The fifth digit is $2$, which is less than $5$, so we round down.\n$$\n\\phi \\approx 0.3420\n$$\nThus, a volume fraction of approximately $0.3420$ of heavy water in the solvent mixture is required to match the scattering length density of the hydrogenated polymer.", "answer": "$$\n\\boxed{0.3420}\n$$", "id": "2928096"}, {"introduction": "Small-angle scattering is not limited to dilute, disordered systems; it is an essential tool for characterizing the structure of self-assembled, ordered materials like block copolymers. In these systems, scattering patterns are dominated by sharp Bragg peaks rather than diffuse form factor scattering. This computational practice will guide you through a complete data analysis workflow: identifying the mesophase symmetry from peak positions, calculating the lattice parameter, and modeling the underlying form factor envelope that modulates peak intensities. [@problem_id:2928108]", "problem": "You are given small-angle X-ray scattering data for ordered block copolymer mesophases. For each dataset, you are provided a list of measured peak positions in reciprocal space and corresponding peak intensities. Your task is to infer the crystal or mesophase symmetry from peak position ratios (space-group assignment among the candidates), estimate the lattice parameter, and fit a smooth form-factor envelope to the peak intensities.\n\nBase your derivation and algorithm on the following foundational facts and definitions:\n- The scattering vector magnitude is defined as $q = \\frac{4\\pi}{\\lambda} \\sin \\theta$, but for this problem, you may use $q$ as directly measured, in units of $\\mathrm{nm}^{-1}$.\n- Bragg’s law in reciprocal space gives peak positions at $q_{hkl} = \\frac{2\\pi}{d_{hkl}}$.\n- For cubic lattices with lattice parameter $a$, $d_{hkl} = \\frac{a}{\\sqrt{h^2 + k^2 + l^2}}$, so $q_{hkl} = \\frac{2\\pi}{a} \\sqrt{h^2 + k^2 + l^2}$.\n- For a two-dimensional hexagonal (triangular) lattice of cylinders with lattice parameter $a_{\\mathrm{hex}}$, the in-plane peaks satisfy $q_{hk} = \\frac{4\\pi}{\\sqrt{3}\\, a_{\\mathrm{hex}}} \\sqrt{h^2 + hk + k^2}$.\n- For one-dimensional lamellae with period $d$, $q_n = n \\frac{2\\pi}{d}$ for positive integers $n$.\n- For a powder-averaged dataset, the relative peak positions are determined by the sets of allowed reflections. For the candidates considered here, use the following allowed sequences of $\\sqrt{\\cdot}$-arguments (up to an overall scale) for the first few peaks:\n  - Lamellar: $n \\in \\{1, 2, 3, \\dots\\}$ with $q_n \\propto n$.\n  - Hexagonal cylinders (space group $P6/mmm$): $h^2 + hk + k^2 \\in \\{1, 3, 4, 7, 9, 12, \\dots\\}$ with $q \\propto \\sqrt{h^2 + hk + k^2}$.\n  - Body-centered cubic spheres (space group $Im\\bar{3}m$): $h + k + l$ even, $h^2 + k^2 + l^2 \\in \\{2, 4, 6, 8, 10, \\dots\\}$ with $q \\propto \\sqrt{h^2 + k^2 + l^2}$.\n  - Double gyroid (space group $Ia\\bar{3}d$): common first reflections $(211),(220),(321),(400),(420),(332),\\dots$ with $h^2 + k^2 + l^2 \\in \\{6, 8, 14, 16, 20, 22, \\dots\\}$ and $q \\propto \\sqrt{h^2 + k^2 + l^2}$.\n- A smooth form-factor envelope can often be approximated as $I(q) \\approx C \\exp\\!\\left(-\\left(\\frac{q}{\\kappa}\\right)^2\\right)$ for some amplitude $C$ and decay parameter $\\kappa$.\n\nYour program must:\n1. For each dataset, compute the optimal scale factor $K$ that best fits the measured peak positions $\\{q_i\\}$ to each candidate’s dimensionless ratio sequence $\\{r_i\\}$ via least squares, i.e., minimize $\\sum_i \\left(q_i - K r_i\\right)^2$ with respect to $K$. From the best $K$, infer the lattice parameter according to the candidate:\n   - Lamellar: $d = \\frac{2\\pi}{K}$.\n   - Hexagonal cylinders ($P6/mmm$): $a_{\\mathrm{hex}} = \\frac{4\\pi}{\\sqrt{3} K}$.\n   - Body-centered cubic ($Im\\bar{3}m$): $a = \\frac{2\\pi}{K}$.\n   - Double gyroid ($Ia\\bar{3}d$): $a = \\frac{2\\pi}{K}$.\n2. Select the space group candidate that yields the smallest normalized residual on peak positions, defined as $\\frac{\\sum_i \\left(q_i - K r_i\\right)^2}{\\sum_i q_i^2}$.\n3. Fit the Gaussian form-factor envelope $I(q) \\approx C \\exp\\!\\left(-\\left(\\frac{q}{\\kappa}\\right)^2\\right)$ to the measured intensities $\\{I_i\\}$ at the measured $\\{q_i\\}$ by linearizing $\\ln I(q) = \\ln C - \\left(\\frac{1}{\\kappa^2}\\right) q^2$ and performing least-squares regression to obtain $C$ and $\\kappa$.\n\nUnits and output requirements:\n- All provided $q$-values are in $\\mathrm{nm}^{-1}$.\n- The lattice parameter (or lamellar period) must be reported in $\\mathrm{nm}$.\n- The decay parameter $\\kappa$ must be reported in $\\mathrm{nm}^{-1}$.\n- The amplitude $C$ is unitless (arbitrary units).\n- Round all reported floating-point outputs to exactly three decimal places.\n\nSpace group encoding:\n- Lamellar (one-dimensional stacking, reported here as a special case): code $0$.\n- Hexagonal cylinders ($P6/mmm$): code $1$.\n- Body-centered cubic spheres ($Im\\bar{3}m$): code $2$.\n- Double gyroid ($Ia\\bar{3}d$): code $3$.\n\nTest suite:\nProvide the following four datasets. Each dataset is a pair of lists: measured peak positions $\\{q_i\\}$ in $\\mathrm{nm}^{-1}$ and corresponding peak intensities $\\{I_i\\}$ in arbitrary units.\n\n- Dataset A:\n  - $q = [\\,0.2539,\\;0.3590,\\;0.4396,\\;0.5077,\\;0.5678\\,]$\n  - $I = [\\,836.0,\\;698.9,\\;584.9,\\;489.0,\\;408.6\\,]$\n- Dataset B:\n  - $q = [\\,0.1728,\\;0.2994,\\;0.3456,\\;0.4571,\\;0.5184\\,]$\n  - $I = [\\,1065.1,\\;838.3,\\;744.4,\\;520.3,\\;409.4\\,]$\n- Dataset C:\n  - $q = [\\,0.3078,\\;0.3554,\\;0.4704,\\;0.5028,\\;0.5620,\\;0.5894\\,]$\n  - $I = [\\,742.0,\\;695.0,\\;572.0,\\;536.0,\\;472.0,\\;443.0\\,]$\n- Dataset D:\n  - $q = [\\,0.2094,\\;0.4188,\\;0.6282,\\;0.8376\\,]$\n  - $I = [\\,708.0,\\;492.0,\\;268.0,\\;114.0\\,]$\n\nImplementation details:\n- For each dataset, evaluate all four candidates, fit the best scale factor $K$ and choose the candidate with the smallest normalized residual. Then compute the corresponding lattice parameter, fit the Gaussian envelope to obtain $\\kappa$ and $C$, and generate the outputs.\n- Your program should produce a single line of output containing the results as a comma-separated list of lists, one sublist per dataset, in the order A, B, C, D. Each sublist must be of the form $[\\text{code}, a, \\kappa, C]$, where $a$ is the lattice parameter in $\\mathrm{nm}$ for cubic/hexagonal (or the lamellar period in $\\mathrm{nm}$), $\\kappa$ is in $\\mathrm{nm}^{-1}$, and $C$ is unitless. All floating-point numbers must be rounded to exactly three decimals.\n- Final output format example (with placeholder values): $[[2,35.000,0.600,1000.000],[1,42.000,0.500,1200.000],\\dots]$.\n\nYour program must be self-contained, perform no input/output besides printing the final result line, and must not require any external files or user interaction.", "solution": "The problem presented is a well-defined task in the analysis of small-angle scattering data from block copolymer mesophases. It is scientifically grounded in the principles of crystallography and scattering theory, is mathematically self-contained, and provides all necessary data and formulae. The problem is therefore deemed **valid** and a solution will be provided.\n\nThe solution is approached in a three-step process for each dataset, as stipulated:\n1.  **Phase Identification**: The crystallographic symmetry (mesophase type) is determined by comparing the measured peak positions to the theoretical diffraction patterns of four candidate structures.\n2.  **Lattice Parameter Calculation**: Once the phase is identified, its characteristic length scale (lattice parameter or lamellar period) is calculated from the best-fit scaling constant.\n3.  **Form Factor Envelope Fitting**: The decay of peak intensities is modeled using a Gaussian envelope to extract its characteristic amplitude and decay length.\n\n**Step 1: Phase Identification via Least-Squares Fitting**\n\nFor a given ordered structure, the positions of Bragg peaks in reciprocal space, $q$, are determined by the lattice symmetry and its lattice parameter. For a powder-averaged sample, the peak positions $\\{q_i\\}$ are expected to follow a specific sequence:\n$$ q_i = K \\cdot r_i $$\nwhere $\\{r_i\\}$ is a dimensionless sequence of numbers determined by the Miller indices of allowed reflections, and $K$ is a scale factor that depends on the lattice parameter. The problem provides the theoretical sequences $\\{r_i\\}$ for four candidate structures:\n\n*   **Lamellar (1D, code 0)**: $r_i \\in \\{1, 2, 3, \\dots\\}$\n*   **Hexagonal Cylinders ($P6/mmm$, code 1)**: $r_i \\in \\{\\sqrt{1}, \\sqrt{3}, \\sqrt{4}, \\sqrt{7}, \\dots\\}$\n*   **Body-Centered Cubic ($Im\\bar{3}m$, code 2)**: $r_i \\in \\{\\sqrt{2}, \\sqrt{4}, \\sqrt{6}, \\sqrt{8}, \\dots\\}$\n*   **Double Gyroid ($Ia\\bar{3}d$, code 3)**: $r_i \\in \\{\\sqrt{6}, \\sqrt{8}, \\sqrt{14}, \\sqrt{16}, \\dots\\}$\n\nFor each dataset, we are given a set of $N_p$ measured peak positions, denoted by the vector $\\mathbf{q}_{\\text{obs}} = (q_1, q_2, \\dots, q_{N_p})$. For each candidate structure, we take the first $N_p$ elements of its theoretical ratio sequence to form a vector $\\mathbf{r}_{\\text{theory}} = (r_1, r_2, \\dots, r_{N_p})$.\n\nThe task is to find the optimal scale factor $K$ that minimizes the sum of squared residuals, $S$:\n$$ S(K) = \\sum_{i=1}^{N_p} (q_i - K r_i)^2 $$\nTo find the minimum, we differentiate $S(K)$ with respect to $K$ and set the result to zero:\n$$ \\frac{dS}{dK} = \\sum_{i=1}^{N_p} 2(q_i - K r_i)(-r_i) = -2 \\left( \\sum_{i=1}^{N_p} q_i r_i - K \\sum_{i=1}^{N_p} r_i^2 \\right) = 0 $$\nThis yields the solution for the optimal scale factor, $K_{\\text{opt}}$:\n$$ K_{\\text{opt}} = \\frac{\\sum_{i=1}^{N_p} q_i r_i}{\\sum_{i=1}^{N_p} r_i^2} = \\frac{\\mathbf{q}_{\\text{obs}} \\cdot \\mathbf{r}_{\\text{theory}}}{\\mathbf{r}_{\\text{theory}} \\cdot \\mathbf{r}_{\\text{theory}}} $$\n\nThis calculation is performed for each of the four candidate structures. The best-fitting structure is the one that minimizes the normalized residual, $\\mathcal{R}$:\n$$ \\mathcal{R} = \\frac{\\sum_{i=1}^{N_p} (q_i - K_{\\text{opt}} r_i)^2}{\\sum_{i=1}^{N_p} q_i^2} $$\n\n**Step 2: Calculation of the Lattice Parameter**\n\nThe scale factor $K_{\\text{opt}}$ is intrinsically linked to the lattice parameter (or lamellar period, $d$). The relationship is derived from the definitions of $q_{hkl}$:\n\n*   For **Lamellar** structures ($q_n = n \\frac{2\\pi}{d}$) with $r_i=i$: $K = \\frac{2\\pi}{d} \\implies d = \\frac{2\\pi}{K}$.\n*   For **Cubic** structures ($q_{hkl} = \\frac{2\\pi}{a} \\sqrt{h^2+k^2+l^2}$) ($Im\\bar{3}m$, $Ia\\bar{3}d$): $K = \\frac{2\\pi}{a} \\implies a = \\frac{2\\pi}{K}$.\n*   For **2D Hexagonal** ($q_{hk} = \\frac{4\\pi}{\\sqrt{3} a_{\\text{hex}}} \\sqrt{h^2+hk+k^2}$): $K = \\frac{4\\pi}{\\sqrt{3} a_{\\text{hex}}} \\implies a_{\\text{hex}} = \\frac{4\\pi}{\\sqrt{3}K}$.\n\nUsing the $K_{\\text{opt}}$ from the selected best-fit structure, we calculate the corresponding lattice parameter.\n\n**Step 3: Fitting the Form Factor Envelope**\n\nThe intensity of the scattering peaks, $I(q)$, is modulated by a form factor that depends on the shape and internal structure of the scattering objects (e.g., polymer domains). The problem states this can be approximated by a Gaussian function:\n$$ I(q) \\approx C \\exp\\!\\left(-\\left(\\frac{q}{\\kappa}\\right)^2\\right) $$\nwhere $C$ is an amplitude and $\\kappa$ is a decay parameter related to the characteristic size of the structural features.\n\nTo determine $C$ and $\\kappa$ from the measured peak intensities $\\{I_i\\}$ at positions $\\{q_i\\}$, we linearize the model by taking the natural logarithm:\n$$ \\ln(I(q)) = \\ln(C) - \\frac{1}{\\kappa^2} q^2 $$\nThis equation is of the form $y = b + m x$, where:\n*   $y_i = \\ln(I_i)$\n*   $x_i = q_i^2$\n*   The intercept is $b = \\ln(C)$\n*   The slope is $m = - \\frac{1}{\\kappa^2}$\n\nWe perform a standard simple linear regression on the data points $(x_i, y_i)$ to find the best-fit slope $m$ and intercept $b$. The parameters $C$ and $\\kappa$ are then recovered:\n$$ C = e^b $$\n$$ \\kappa = \\sqrt{-\\frac{1}{m}} $$\nFor a physically meaningful solution, the slope $m$ must be negative, corresponding to an intensity that decays with $q$.\n\nThe algorithm implemented in the final answer will execute these three steps for each of the four provided datasets.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of identifying block copolymer mesophase symmetry, estimating\n    the lattice parameter, and fitting a form-factor envelope to SAXS data.\n    \"\"\"\n\n    # Define the theoretical ratio sequences for candidate structures.\n    # These sequences must be long enough for the dataset with the most peaks.\n    candidates = [\n        {\n            \"code\": 0,\n            \"name\": \"Lamellar\",\n            \"ratios\": np.array([1, 2, 3, 4, 5, 6, 7]),\n            \"lattice_param_func\": lambda K: 2 * np.pi / K,\n        },\n        {\n            \"code\": 1,\n            \"name\": \"Hexagonal\",\n            \"ratios\": np.sqrt([1, 3, 4, 7, 9, 12, 13]),\n            \"lattice_param_func\": lambda K: 4 * np.pi / (np.sqrt(3) * K),\n        },\n        {\n            \"code\": 2,\n            \"name\": \"BCC ($Im\\\\bar{3}m$)\",\n            \"ratios\": np.sqrt([2, 4, 6, 8, 10, 12, 14]),\n            \"lattice_param_func\": lambda K: 2 * np.pi / K,\n        },\n        {\n            \"code\": 3,\n            \"name\": \"Gyroid ($Ia\\\\bar{3}d$)\",\n            \"ratios\": np.sqrt([6, 8, 14, 16, 20, 22, 24]),\n            \"lattice_param_func\": lambda K: 2 * np.pi / K,\n        }\n    ]\n\n    # Test suite datasets\n    test_cases = [\n        (\n            [0.2539, 0.3590, 0.4396, 0.5077, 0.5678],\n            [836.0, 698.9, 584.9, 489.0, 408.6]\n        ),\n        (\n            [0.1728, 0.2994, 0.3456, 0.4571, 0.5184],\n            [1065.1, 838.3, 744.4, 520.3, 409.4]\n        ),\n        (\n            [0.3078, 0.3554, 0.4704, 0.5028, 0.5620, 0.5894],\n            [742.0, 695.0, 572.0, 536.0, 472.0, 443.0]\n        ),\n        (\n            [0.2094, 0.4188, 0.6282, 0.8376],\n            [708.0, 492.0, 268.0, 114.0]\n        )\n    ]\n\n    all_results = []\n\n    for q_obs_list, I_obs_list in test_cases:\n        q_obs = np.array(q_obs_list)\n        I_obs = np.array(I_obs_list)\n        num_peaks = len(q_obs)\n\n        best_fit = {\n            'residual': np.inf,\n            'code': -1,\n            'K': None,\n            'lattice_param_func': None,\n        }\n\n        # Step 1: Identify best-fit structure\n        for candidate in candidates:\n            if len(candidate[\"ratios\"]) < num_peaks:\n                continue\n            \n            r_theory = candidate[\"ratios\"][:num_peaks]\n\n            # Calculate optimal scale factor K\n            K_opt = np.dot(q_obs, r_theory) / np.dot(r_theory, r_theory)\n\n            # Calculate predicted q-values and normalized residual\n            q_pred = K_opt * r_theory\n            residual = np.sum((q_obs - q_pred)**2) / np.sum(q_obs**2)\n\n            if residual < best_fit['residual']:\n                best_fit['residual'] = residual\n                best_fit['code'] = candidate['code']\n                best_fit['K'] = K_opt\n                best_fit['lattice_param_func'] = candidate['lattice_param_func']\n        \n        # Step 2: Calculate lattice parameter for the best fit\n        lattice_param = best_fit['lattice_param_func'](best_fit['K'])\n\n        # Step 3: Fit form factor envelope\n        # Linearize: ln(I) = ln(C) - (1/kappa^2) * q^2\n        # y = b + m*x\n        x_data = q_obs**2\n        y_data = np.log(I_obs)\n\n        # Perform linear regression to find slope (m) and intercept (b)\n        m, b = np.polyfit(x_data, y_data, 1)\n\n        # Calculate C and kappa from regression parameters\n        C = np.exp(b)\n        kappa = np.sqrt(-1.0 / m)\n\n        all_results.append([best_fit['code'], lattice_param, kappa, C])\n\n    # Format the final output string according to the specifications\n    def format_single_result(res):\n        code, a, k, c = res\n        return f\"[{code},{a:.3f},{k:.3f},{c:.3f}]\"\n\n    formatted_results = [format_single_result(r) for r in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2928108"}]}