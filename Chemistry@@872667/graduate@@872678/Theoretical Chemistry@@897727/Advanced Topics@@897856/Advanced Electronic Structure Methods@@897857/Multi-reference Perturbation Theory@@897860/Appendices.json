{"hands_on_practices": [{"introduction": "To truly master Multi-reference Perturbation Theory (MRPT), we must first understand its core computational machinery. This exercise provides a hands-on opportunity to derive and compute a second-order energy correction, $E^{(2)}$, from first principles within the Complete Active Space Second-Order Perturbation Theory (CASPT2) framework. By working through a simplified yet representative model system [@problem_id:2789405], you will directly apply the concepts of the CASPT2 zeroth-order Hamiltonian and semi-canonical orbitals to calculate the energy contribution from a specific class of external excitations.", "problem": "Consider a state-specific Complete Active Space Self-Consistent Field (CASSCF) reference for a model system with orbitals partitioned into one inactive doubly occupied spatial orbital, one two-orbital active space, and one external virtual spatial orbital. Denote the inactive orbital by $i$, the two active orbitals by $a$ and $b$ (containing two electrons in total), and the single external virtual orbital by $r$. Use Complete Active Space Second-Order Perturbation Theory (CASPT2) with its standard zeroth-order Hamiltonian and assume semi-canonical orbitals, so that the Fock-like one-electron operator is diagonal within the inactive and virtual subspaces and does not couple different subspaces.\n\nStart from Rayleigh–Schrödinger perturbation theory and derive the second-order energy correction for this reference state restricted to the unique external class in which the electron pair in the inactive orbital $i$ is excited to the virtual orbital $r$ (a spin-paired double excitation). Assume the following data:\n- Diagonal one-electron (Fock-like) orbital energies: $f_{ii} = -0.90$ a.u. and $f_{rr} = 0.30$ a.u.\n- All off-diagonal one-electron couplings between the active and external spaces vanish in the semi-canonical basis.\n- All two-electron integrals that could couple the reference to external configurations are negligible except the Coulomb integral between $i$ and $r$, denoted in chemists’ notation by $(ii|rr) = 0.24$ a.u.\n- Neglect any level shifts (no real or imaginary level shift and no Ionization Potential–Electron Affinity (IPEA) shift).\n\nUsing only these assumptions and data, compute the CASPT2 second-order energy correction $E^{(2)}$ in Hartree arising from this pair-excitation class. Round your final numerical answer to three significant figures. Express the final energy in Hartree.", "solution": "The problem requires the derivation and calculation of a specific second-order energy correction within the framework of Complete Active Space Second-Order Perturbation Theory (CASPT2). The starting point is the general formula for the second-order energy correction from Rayleigh-Schrödinger Perturbation Theory (RSPT), which for a single perturbing state $|\\Psi_I\\rangle$ is given by:\n$$E^{(2)} = \\frac{|\\langle \\Psi_0 | \\hat{V} | \\Psi_I \\rangle|^2}{E_0^{(0)} - E_I^{(0)}}$$\nHere, $|\\Psi_0\\rangle$ is the zeroth-order reference wavefunction, which is the state-specific Complete Active Space Self-Consistent Field (CASSCF) wavefunction. $|\\Psi_I\\rangle$ is the perturbing state from the first-order interacting space. $\\hat{V} = \\hat{H} - \\hat{H}^{(0)}$ is the perturbation operator, where $\\hat{H}$ is the full electronic Hamiltonian and $\\hat{H}^{(0)}$ is the zeroth-order Hamiltonian. $E_0^{(0)}$ and $E_I^{(0)}$ are the zeroth-order energies of $|\\Psi_0\\rangle$ and $|\\Psi_I\\rangle$, respectively.\n\nThe problem specifies the CASPT2 method with its standard zeroth-order Hamiltonian. By construction, the reference CAS space and the external space are decoupled by $\\hat{H}^{(0)}$, meaning $\\langle \\Psi_0 | \\hat{H}^{(0)} | \\Psi_I \\rangle = 0$ for any external state $|\\Psi_I\\rangle$. Consequently, the coupling matrix element in the numerator simplifies to:\n$$\\langle \\Psi_0 | \\hat{V} | \\Psi_I \\rangle = \\langle \\Psi_0 | \\hat{H} - \\hat{H}^{(0)} | \\Psi_I \\rangle = \\langle \\Psi_0 | \\hat{H} | \\Psi_I \\rangle$$\nThe problem restricts the calculation to the contribution from a single, unique external class: a spin-paired double excitation of the electron pair from the inactive orbital $i$ to the external virtual orbital $r$. Let us denote the corresponding normalized configuration state function (CSF) as $|\\Psi_I\\rangle = |\\Psi_{i\\bar{i}}^{r\\bar{r}}\\rangle$. This state differs from any configuration in the CASSCF expansion of $|\\Psi_0\\rangle$ by two spin-orbitals. According to the Slater-Condon rules, the matrix element $\\langle \\Psi_0 | \\hat{H} | \\Psi_{i\\bar{i}}^{r\\bar{r}} \\rangle$ is non-zero only through the two-electron part of the Hamiltonian. For an excitation from a doubly-occupied inactive orbital, the multi-configurational nature of the active space in $|\\Psi_0\\rangle$ does not complicate the matrix element, which simplifies to the two-electron repulsion integral between the involved orbitals. In chemist's notation, this is:\n$$\\langle \\Psi_0 | \\hat{H} | \\Psi_{i\\bar{i}}^{r\\bar{r}} \\rangle = (ii|rr)$$\nThe problem provides that all such coupling integrals are negligible except for $(ii|rr) = 0.24$ a.u. Therefore, the numerator of the energy expression is $|(ii|rr)|^2$.\n\nNext, we evaluate the denominator, $E_0^{(0)} - E_I^{(0)}$. In the standard CASPT2 formalism, the zeroth-order energies are defined differently for the reference and external spaces. The reference energy $E_0^{(0)}$ is the full CASSCF energy, while the energy of an external configuration $E_I^{(0)}$ is defined in terms of a generalized Fock operator $\\hat{F}$. For excitations from the inactive space, the energy denominator simplifies to a difference in the sums of orbital energies of the orbitals involved in the excitation. The problem specifies semi-canonical orbitals, where the Fock operator is diagonal, and the orbital energies are its diagonal elements, $f_{pp}$.\n\nThe excitation process moves two electrons from orbital $i$ to orbital $r$. The resulting zeroth-order energy difference is:\n$$E_0^{(0)} - E_I^{(0)} = 2f_{ii} - 2f_{rr}$$\nThe problem states that level shifts are to be neglected, which confirms the use of this unshifted denominator.\n\nCombining the expressions for the numerator and the denominator, the second-order energy correction for this specific excitation class is:\n$$E^{(2)} = \\frac{|(ii|rr)|^2}{2f_{ii} - 2f_{rr}}$$\nWe substitute the given data into this expression:\n- Diagonal Fock-like orbital energies: $f_{ii} = -0.90$ a.u. and $f_{rr} = 0.30$ a.u.\n- Two-electron integral: $(ii|rr) = 0.24$ a.u.\n\nThe calculation proceeds as follows:\n$$E^{(2)} = \\frac{(0.24)^2}{2(-0.90) - 2(0.30)} = \\frac{0.0576}{-1.80 - 0.60} = \\frac{0.0576}{-2.40}$$\n$$E^{(2)} = -0.024 \\text{ a.u.}$$\nThe problem requires the answer to be rounded to three significant figures. In Hartree (a.u.), the result is $-0.0240$.", "answer": "$$\\boxed{-0.0240}$$", "id": "2789405"}, {"introduction": "While powerful, perturbation theories are susceptible to catastrophic failure when the zeroth-order energy gap between the reference state and a coupled external state becomes vanishingly small. This exercise explores this critical vulnerability, known as the 'intruder state' problem, using a minimal theoretical model [@problem_id:2789380]. By deriving the second-order energy as a function of a small energy gap $\\delta$, you will see precisely how the perturbative correction diverges and understand the fundamental justification for the level-shifting techniques essential for the practical application of MRPT.", "problem": "Consider a minimal multireference perturbation theory model representative of Complete Active Space Second-Order Perturbation Theory (CASPT2) and n-Electron Valence State Second-Order Perturbation Theory (NEVPT2). The zeroth-order space contains a single Complete Active Space (CAS) reference state $\\lvert \\Psi_{\\mathrm{CAS}} \\rangle$ with zeroth-order energy $E_{0}^{(0)} = 0$. The external space contains a single configuration $\\lvert \\Phi \\rangle$ that is coupled to $\\lvert \\Psi_{\\mathrm{CAS}} \\rangle$ by the fluctuation potential with a real coupling matrix element $v = \\langle \\Psi_{\\mathrm{CAS}} \\lvert \\hat{V} \\rvert \\Phi \\rangle$, where $v \\neq 0$. Due to an orbital degeneracy in the unperturbed Fock spectrum, the unshifted zeroth-order energy of $\\lvert \\Phi \\rangle$ is identical to $E_{0}^{(0)}$, which would cause a divergence in the second-order energy. A tiny external field is applied that perturbs the orbital energies and lifts the degeneracy by a small positive amount $\\delta$, so that the shifted zeroth-order energy of the external configuration becomes $E_{\\mathrm{ext}}^{(0)}(\\delta) = \\delta$.\n\nStarting from the general Rayleigh–Schrödinger definition of the second-order energy for a multireference state in terms of the resolvent projected onto the external space, derive the closed-form analytic expression for the second-order energy $E^{(2)}(\\delta)$ of the CAS reference in this one-dimensional external-space model as a function of $v$ and $\\delta$. Express your final answer in Hartree (atomic units). Your final answer must be a single closed-form expression.", "solution": "The problem statement has been subjected to a rigorous validation process and is found to be scientifically grounded, well-posed, objective, and self-contained. It presents a simplified but conceptually correct model of an intruder state problem in multi-reference perturbation theory, a standard topic in theoretical chemistry. All necessary data for a formal derivation are provided, and there are no contradictions or ambiguities. The problem is therefore valid, and a solution will be derived.\n\nThe starting point is the standard formula for the second-order energy correction in Rayleigh-Schrödinger perturbation theory (RSPT) for a non-degenerate reference state $\\lvert\\Psi_0^{(0)}\\rangle$. The second-order energy, $E^{(2)}$, is given by the sum over all other unperturbed eigenstates $\\lvert\\Psi_k^{(0)}\\rangle$ (where $k \\neq 0$):\n$$\nE^{(2)} = \\sum_{k \\neq 0} \\frac{\\lvert\\langle \\Psi_0^{(0)} \\lvert \\hat{V} \\rvert \\Psi_k^{(0)} \\rangle\\rvert^2}{E_0^{(0)} - E_k^{(0)}}\n$$\nwhere $\\hat{V}$ is the perturbation operator (in this context, the fluctuation potential), and $E_0^{(0)}$ and $E_k^{(0)}$ are the zeroth-order energies of the respective states.\n\nWe now adapt this general expression to the specific model provided in the problem statement. The givens are:\n1.  The zeroth-order reference state is the Complete Active Space (CAS) state, so we identify $\\lvert\\Psi_0^{(0)}\\rangle = \\lvert\\Psi_{\\mathrm{CAS}}\\rangle$.\n2.  The zeroth-order energy of this reference state is given as $E_0^{(0)} = E_{0}^{(0)} = 0$.\n3.  The space of external states, over which the summation index $k$ runs, consists of a single configuration, $\\lvert\\Phi\\rangle$. Therefore, the sum over $k$ reduces to a single term corresponding to this state. We identify $\\lvert\\Psi_k^{(0)}\\rangle = \\lvert\\Phi\\rangle$ for this single term.\n4.  The zeroth-order energy of this external configuration is given as a function of a small parameter $\\delta$, $E_k^{(0)} = E_{\\mathrm{ext}}^{(0)}(\\delta) = \\delta$.\n5.  The coupling matrix element between the reference and the external state is given as $\\langle \\Psi_{\\mathrm{CAS}} \\lvert \\hat{V} \\rvert \\Phi \\rangle = v$, which is a non-zero real number. Thus, the squared modulus of this matrix element is $\\lvert\\langle \\Psi_{\\mathrm{CAS}} \\lvert \\hat{V} \\rvert \\Phi \\rangle\\rvert^2 = |v|^2 = v^2$, since $v \\in \\mathbb{R}$.\n\nSubstituting these specific quantities into the general RSPT formula yields the second-order energy for this model, denoted as $E^{(2)}(\\delta)$:\n$$\nE^{(2)}(\\delta) = \\frac{\\lvert\\langle \\Psi_{\\mathrm{CAS}} \\lvert \\hat{V} \\rvert \\Phi \\rangle\\rvert^2}{E_{0}^{(0)} - E_{\\mathrm{ext}}^{(0)}(\\delta)}\n$$\nNow, we insert the provided values for the energy levels and the coupling element:\n$$\nE^{(2)}(\\delta) = \\frac{v^2}{0 - \\delta}\n$$\nThis simplifies to the final closed-form expression:\n$$\nE^{(2)}(\\delta) = -\\frac{v^2}{\\delta}\n$$\nThis result demonstrates the characteristic behavior of perturbation theory in the presence of a near-degenerate state, often called an \"intruder state\". As the energy gap $\\delta$ approaches zero, the second-order energy correction diverges towards negative infinity. This divergence is the central problem that level-shifting techniques in methods like CASPT2 are designed to correct. The problem as stated, however, assumes a fixed, non-zero $\\delta$ and requests the analytic expression for the unshifted RSPT energy under this condition. The derived expression is the correct result for this specific theoretical model. The units are specified to be Hartree (atomic units), and since all input quantities are assumed to be in atomic units, the result is naturally in Hartree.", "answer": "$$\n\\boxed{-\\frac{v^2}{\\delta}}\n$$", "id": "2789380"}, {"introduction": "Moving from model systems to real-world chemical problems requires a robust and reproducible computational strategy. This final practice [@problem_id:2789362] challenges you to design a complete workflow for a CASPT2 calculation, integrating concepts like active space selection and the handling of intruder states. By evaluating different proposed methodologies, you will learn to identify best practices and common pitfalls, developing the critical judgment needed to produce reliable results for complex, multireference systems.", "problem": "You are asked to design a robust, reproducible workflow for Complete Active Space Second-Order Perturbation Theory (CASPT2) calculations of low-lying excited states in a conjugated system that exhibits strong near-degeneracy between valence $\\pi$ and $\\pi^*$ orbitals. The target properties are vertical excitation energies and relative state ordering among the lowest few singlet states. Your design should follow from first principles of perturbation theory and multiconfigurational electronic structure, and it must ensure that final predictions are not artifacts of arbitrary parameter choices.\n\nYour workflow must satisfy the following fundamental constraints derived from standard Rayleigh–Schrödinger perturbation theory and multireference methodology:\n- The reference must capture static (strong) correlation associated with near-degenerate orbitals, so that the perturbation treatment primarily recovers dynamic correlation.\n- The second-order correction relies on denominators that can approach zero when there are intruder states, so some regularization and diagnosis of such pathologies is necessary.\n- Any user-adjustable parameter that changes the zeroth-order Hamiltonian or the regularization must be probed for its effect on predicted observables to assess robustness.\n- A cross-method comparison against a related but differently parameterized second-order theory can expose reference or parameter pathologies and increase confidence in the results.\n\nWhich of the following workflows best meets these criteria for a generic small-to-medium conjugated molecule with low-lying valence excited states?\n\nA. Build the active space by including only the two highest occupied and two lowest unoccupied $\\pi$ orbitals identified from a Hartree–Fock calculation without state averaging. Use an Ionization Potential–Electron Affinity (IPEA) shift of $0.00$ atomic units to avoid bias, and do not apply any level shift. If convergence problems arise, increase the basis set size; do not vary methodological parameters, since the final energy should be “variationally safe.”\n\nB. Construct a very large active space by including all valence and low-lying virtual orbitals to avoid missing correlation. Optimize orbitals on a single target state to focus the description. Use a large real level shift of $1.00$ atomic units to guarantee the absence of intruder states and set the IPEA shift to $0.00$ atomic units. Do not perform sensitivity analysis to avoid conflating convergence with parameter drift.\n\nC. Select a chemically motivated Complete Active Space Self-Consistent Field (CASSCF) active space by inspecting state-averaged natural orbital occupations for the relevant states and including orbitals with fractional occupations characteristic of static correlation (e.g., near-degenerate $\\pi/\\pi^*$). Optimize orbitals with equal state-averaging over the targeted excited states. Perform CASPT2 with a standard IPEA shift near $0.25$ atomic units, and apply a small imaginary level shift in the range $0.10$–$0.30$ atomic units to regularize intruders. Validate robustness by: varying the IPEA shift across $0.00$–$0.50$ atomic units and the imaginary shift across $0.05$–$0.30$ atomic units; expanding or trimming the active space at its boundaries; and cross-checking key excitation energies with N-Electron Valence State Second-Order Perturbation Theory (NEVPT2) using the same CASSCF reference. If strong parameter dependence is observed, revisit the active space and state averaging.\n\nD. Choose the active space by including orbitals with occupation numbers closest to $2.00$ and $0.00$ to ensure they can correlate, but exclude orbitals with occupations around $1.00$ to avoid redundancy. Use a negative IPEA shift (e.g., $-0.25$ atomic units) to counteract overcorrelation and a large imaginary level shift (e.g., $0.80$ atomic units) to eliminate intruders. Validate by comparing the resulting excitation energies to coupled-cluster singles and doubles with perturbative triples, CCSD(T), computed on a single-reference Hartree–Fock state, assuming agreement indicates robustness.\n\nSelect the most appropriate workflow.", "solution": "The problem as stated is valid. It describes a standard and non-trivial task in computational quantum chemistry—the calculation of excited states in a strongly correlated system—and lists a set of physically and mathematically sound constraints for a robust computational workflow. We shall evaluate the proposed workflows against these principles.\n\nThe core of the problem lies in the application of multi-reference second-order perturbation theory, specifically Complete Active Space Second-Order Perturbation Theory (CASPT2). This method builds upon a zeroth-order wavefunction, $\\Psi^{(0)}$, which is typically obtained from a Complete Active Space Self-Consistent Field (CASSCF) calculation. The fundamental tenets of a reliable CASPT2 workflow are:\n\n$1$. **The Reference Wavefunction ($\\Psi^{(0)}$):** The CASSCF reference must provide a balanced description of the electronic states of interest and correctly capture the static (strong) correlation arising from near-degenerate orbitals. For excited states, this necessitates a state-averaged CASSCF (SA-CASSCF) approach. The active space must be chosen judiciously to include all orbitals involved in the near-degeneracy, a decision often guided by examining natural orbital occupation numbers from a preliminary calculation.\n\n$2$. **The Perturbation Treatment:** The second-order energy correction, $E^{(2)}$, can suffer from divergences due to \"intruder states\"—states in the first-order interacting space that are nearly degenerate with the reference state. This leads to near-zero denominators of the form $(E^{(0)}_{\\text{ref}} - E^{(0)}_{\\text{pert}})$ in the perturbation expansion. This pathology must be diagnosed and regularized. The modern, and least intrusive, approach is to use a small imaginary level shift, which dampens the problematic contributions without introducing large, unphysical shifts in the energy.\n\n$3$. **The Zeroth-Order Hamiltonian ($H_0$):** The standard CASPT2 method uses the so-called Ionization Potential–Electron Affinity (IPEA) shift, a parameter that modifies $H_0$ to correct for imbalances in the treatment of states with different numbers of active electrons. A non-zero IPEA shift, typically around $0.25$ atomic units, is considered standard for achieving accurate relative energies.\n\n$4$. **Validation and Robustness:** Predictions must not be artifacts of arbitrary parameter choices. A robust workflow must involve a sensitivity analysis, where the final observables (e.g., excitation energies) are monitored as key parameters are varied: the active space composition, the IPEA shift, and the level shift. Furthermore, comparison with a method based on different physical approximations, such as N-Electron Valence State Second-Order Perturbation Theory (NEVPT2), provides a crucial cross-check on the quality of the underlying SA-CASSCF reference.\n\nNow, we shall evaluate each option based on these principles.\n\n**Analysis of Option A:**\nThis workflow proposes an active space of only two occupied and two unoccupied $\\pi$ orbitals, selected from a Hartree-Fock calculation, without state averaging. This is fundamentally flawed. State-specific optimization is highly biased for excited state calculations. An active space chosen without diagnostics like natural orbital occupations is arbitrary. The proposal to use an IPEA shift of $0.00$ a.u. is known to produce inferior results compared to the standard shifted Hamiltonian. The suggestion to ignore potential intruder states (\"do not apply any level shift\") is reckless. The idea that increasing the basis set size fixes CASPT2 \"convergence problems\" (which are typically intruder state issues) is incorrect; it can exacerbate them. The assertion that the energy should be \"variationally safe\" is a grave misunderstanding; CASPT2 is a non-variational method.\nThis option violates nearly every principle of a sound CASPT2 calculation.\n**Verdict: Incorrect.**\n\n**Analysis of Option B:**\nThis workflow advocates for a \"very large active space\" and state-specific orbital optimization. As with Option A, state-specific optimization is inappropriate for describing multiple excited states. A blindly large active space is not only computationally prohibitive but can also introduce spurious intruder states by including orbitals irrelevant to the static correlation of the low-lying states. The use of a \"large real level shift of $1.00$ atomic units\" is a poor practice. While it eliminates the intruder state singularity, it does so by introducing a large, arbitrary parameter that contaminates the final energy, making the result physically questionable. An IPEA shift of $0.00$ a.u. is also a poor choice. The explicit refusal to \"perform sensitivity analysis\" is the antithesis of a robust scientific procedure; it is an admission that the results are likely artifacts of the chosen parameters.\nThis option promotes a brute-force approach that lacks physical rigor and computational discipline.\n**Verdict: Incorrect.**\n\n**Analysis of Option C:**\nThis workflow correctly prescribes the essential elements of a high-quality calculation. It begins with the proper selection of a \"chemically motivated\" active space based on physical diagnostics (fractional natural orbital occupations). It mandates the use of state-averaging (\"SA-CASSCF\") to obtain a balanced reference for all states of interest. It proposes the use of standard, well-tested parameters: an IPEA shift near $0.25$ a.u. and a \"small imaginary level shift\" to regularize intruder states, which is the preferred modern technique. Most importantly, it describes a comprehensive validation protocol: checking the sensitivity of the results to variations in the active space, the IPEA shift, and the level shift, and cross-checking against the parameter-free NEVPT2 method. The feedback loop—revisiting the reference calculation if strong parameter dependence is found—is the hallmark of a careful and robust scientific investigation.\nThis option represents the current best practice for applying CASPT2 to complex electronic structure problems.\n**Verdict: Correct.**\n\n**Analysis of Option D:**\nThis workflow begins with a catastrophic error in active space selection: it proposes including orbitals with occupations near $2.0$ and $0.0$ while excluding those around $1.0$. This is the exact opposite of the correct procedure. Orbitals with occupations near $2.0$ and $0.0$ are weakly correlated and belong in the inactive and external spaces, respectively. It is the fractionally-occupied orbitals (occupations deviating significantly from $2.0$ and $0.0$, i.e., \"around $1.0$\") that exhibit strong static correlation and *must* form the active space. The suggestion of a negative IPEA shift is non-standard and physically questionable. The proposed validation method—comparison to single-reference CCSD(T)—is nonsensical for a system explicitly defined as having \"strong near-degeneracy.\" In such cases, the single-reference starting point for CCSD(T) is qualitatively wrong, making the CCSD(T) result itself unreliable. Comparing a multi-reference calculation to an unreliable single-reference one is not a validation.\nThis option displays a profound misunderstanding of both static correlation and the domains of applicability of different quantum chemical methods.\n**Verdict: Incorrect.**", "answer": "$$\\boxed{C}$$", "id": "2789362"}]}