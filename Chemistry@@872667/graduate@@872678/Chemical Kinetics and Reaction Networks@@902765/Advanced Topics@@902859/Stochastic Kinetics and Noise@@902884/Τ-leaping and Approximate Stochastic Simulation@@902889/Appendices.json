{"hands_on_practices": [{"introduction": "The power of $\\tau$-leaping comes from taking large time steps, but its validity depends on the 'leap condition'—that propensities do not change significantly during a leap. This practice focuses on the heart of adaptive $\\tau$-leaping: selecting an appropriate step size $\\tau$. By applying the widely used Cao-Gillespie-Petzold (CGP) selection criterion to a simple reversible reaction, you will gain hands-on experience calculating the maximal leap size that balances computational efficiency with a user-defined accuracy tolerance. [@problem_id:2695002]", "problem": "Consider a well-mixed, isothermal reaction network consisting of the reversible isomerization $A \\xrightleftharpoons[k_2]{k_1} B$. The system is modeled as a continuous-time Markov chain under the Chemical Master Equation (CME) with molecule counts $(X_A,X_B)$. The propensities follow elementary mass-action kinetics for unimolecular reactions. The stoichiometric change vectors are $(-1,+1)$ for $A \\to B$ and $(+1,-1)$ for $B \\to A$. At the current state, the counts are $(x_A,x_B)=(400,100)$ molecules. The rate constants are $k_1=0.08\\,\\mathrm{s}^{-1}$ and $k_2=0.12\\,\\mathrm{s}^{-1}$. You will use Poisson $\\tau$-leaping and select the leap size $\\tau$ following the Cao–Gillespie–Petzold (CGP) criterion to enforce the leap condition on species, with species-dependent factors $g_i$ appropriate for unimolecular reactions. Take the user-specified tolerance to be $\\epsilon=0.03$.\n\nStarting from the definitions of propensity functions under the CME and the Poisson characterization of reaction firings in $\\tau$-leaping, derive the expressions needed to enforce the CGP leap condition on each species and compute the maximal admissible $\\tau$ at the given state and parameters. Express your final answer in seconds and round your result to four significant figures.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- Reaction network: Reversible isomerization $A \\xrightleftharpoons[k_2]{k_1} B$.\n- Model: Continuous-time Markov chain under the Chemical Master Equation (CME).\n- State variables: Molecule counts $(X_A, X_B)$.\n- Propensities: Elementary mass-action kinetics for unimolecular reactions.\n- Stoichiometric change vectors: $\\nu_1 = (-1, +1)$ for the forward reaction $A \\to B$ and $\\nu_2 = (+1, -1)$ for the reverse reaction $B \\to A$.\n- Current state: $(x_A, x_B) = (400, 100)$ molecules.\n- Rate constants: $k_1 = 0.08\\,\\mathrm{s}^{-1}$ and $k_2 = 0.12\\,\\mathrm{s}^{-1}$.\n- Algorithm: Poisson $\\tau$-leaping.\n- Leap size selection: Cao–Gillespie–Petzold (CGP) criterion.\n- Leap condition enforcement: on species, with species-dependent factors $g_i$ appropriate for unimolecular reactions.\n- Tolerance: $\\epsilon = 0.03$.\n- Objective: Derive expressions and compute the maximal admissible $\\tau$.\n- Final answer format: Round to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, being a standard application of the $\\tau$-leaping algorithm in stochastic chemical kinetics. It is well-posed, as all necessary parameters, initial conditions, and methodological constraints are provided to compute a unique solution. The language is objective and precise. The problem does not violate any fundamental principles, is not based on false premises, and is not incomplete or contradictory. It is a formalizable and relevant problem within its specified domain. Thus, the problem is deemed valid.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n**Solution Derivation**\n\nThe objective is to determine the maximal admissible time step $\\tau$ for a Poisson $\\tau$-leaping simulation of the given reaction system, using the Cao-Gillespie-Petzold (CGP) criterion.\n\nThe system consists of two species, $A$ and $B$, and two unimolecular reactions:\n$R_1: A \\xrightarrow{k_1} B$\n$R_2: B \\xrightarrow{k_2} A$\n\nThe state of the system is described by the vector of molecular populations $\\mathbf{x} = (x_A, x_B)$. The propensity functions for the two reactions, under mass-action kinetics, are:\n$a_1(\\mathbf{x}) = k_1 x_A$\n$a_2(\\mathbf{x}) = k_2 x_B$\n\nAt the given state $\\mathbf{x} = (400, 100)$ and with rate constants $k_1=0.08\\,\\mathrm{s}^{-1}$ and $k_2=0.12\\,\\mathrm{s}^{-1}$, the propensities are:\n$a_1 = (0.08\\,\\mathrm{s}^{-1}) \\times 400 = 32\\,\\mathrm{s}^{-1}$\n$a_2 = (0.12\\,\\mathrm{s}^{-1}) \\times 100 = 12\\,\\mathrm{s}^{-1}$\n\nThe $\\tau$-leaping algorithm approximates the system's evolution by assuming the propensities are constant over a time interval $\\tau$. The number of firings of each reaction $j$ in this interval, $K_j$, is a Poisson random variable $K_j \\sim \\mathcal{P}(a_j \\tau)$. The CGP criterion for selecting $\\tau$ ensures that the expected change in any species population over the leap does not significantly alter the system's propensities. This is enforced by bounding the relative change in each species' population.\n\nThe maximal allowable step size $\\tau$ is the minimum of the step sizes computed for each species $i$:\n$$ \\tau = \\min_{i \\in \\{A, B\\}} \\tau_i $$\nThe step size for each species $i$, $\\tau_i$, is determined by the formula derived from bounding both the mean and the variance of the population change:\n$$ \\tau_i = \\min\\left( \\frac{N_{C,i}}{|\\mu_i(\\mathbf{x})|}, \\frac{N_{C,i}^2}{\\sigma_i^2(\\mathbf{x})} \\right) $$\nHere, $\\mu_i(\\mathbf{x})$ is the instantaneous expected rate of change (drift) of species $i$, and $\\sigma_i^2(\\mathbf{x})$ is the instantaneous variance of the rate of change. They are defined as:\n$$ \\mu_i(\\mathbf{x}) = \\sum_{j=1}^{M} \\nu_{ij} a_j(\\mathbf{x}) $$\n$$ \\sigma_i^2(\\mathbf{x}) = \\sum_{j=1}^{M} \\nu_{ij}^2 a_j(\\mathbf{x}) $$\nwhere $\\nu_{ij}$ is the stoichiometric coefficient of species $i$ in reaction $j$.\n\nThe term $N_{C,i}$ is the control bound for species $i$, defined as:\n$$ N_{C,i} = \\max\\left(\\frac{\\epsilon}{g_i} x_i, 1\\right) $$\nThe factor $g_i$ is the highest reaction order with respect to species $i$ for any reaction in the network. For this system, species $A$ is a reactant in a first-order reaction ($R_1$), and species $B$ is a reactant in a first-order reaction ($R_2$). Therefore, $g_A = 1$ and $g_B = 1$.\n\nThe stoichiometric vectors are $\\nu_1 = (-1, 1)$ and $\\nu_2 = (1, -1)$ for species $(A, B)$. Let us calculate $\\mu_i$ and $\\sigma_i^2$ for each species.\n\nFor species $A$:\n$\\mu_A(\\mathbf{x}) = \\nu_{A1} a_1 + \\nu_{A2} a_2 = (-1)(32) + (1)(12) = -20\\,\\mathrm{s}^{-1}$\n$\\sigma_A^2(\\mathbf{x}) = \\nu_{A1}^2 a_1 + \\nu_{A2}^2 a_2 = (-1)^2(32) + (1)^2(12) = 32 + 12 = 44\\,\\mathrm{s}^{-1}$\n\nFor species $B$:\n$\\mu_B(\\mathbf{x}) = \\nu_{B1} a_1 + \\nu_{B2} a_2 = (1)(32) + (-1)(12) = 20\\,\\mathrm{s}^{-1}$\n$\\sigma_B^2(\\mathbf{x}) = \\nu_{B1}^2 a_1 + \\nu_{B2}^2 a_2 = (1)^2(32) + (-1)^2(12) = 32 + 12 = 44\\,\\mathrm{s}^{-1}$\n\nNext, we calculate the control bounds $N_{C,i}$ using $\\epsilon = 0.03$.\n\nFor species $A$:\n$N_{C,A} = \\max\\left(\\frac{0.03}{1} \\times 400, 1\\right) = \\max(12, 1) = 12$\n\nFor species $B$:\n$N_{C,B} = \\max\\left(\\frac{0.03}{1} \\times 100, 1\\right) = \\max(3, 1) = 3$\n\nNow, we compute the candidate step size $\\tau_i$ for each species.\n\nFor species $A$:\n$\\tau_A = \\min\\left( \\frac{N_{C,A}}{|\\mu_A(\\mathbf{x})|}, \\frac{N_{C,A}^2}{\\sigma_A^2(\\mathbf{x})} \\right) = \\min\\left( \\frac{12}{20}, \\frac{12^2}{44} \\right) = \\min\\left( 0.6, \\frac{144}{44} \\right)$\n$\\frac{144}{44} = \\frac{36}{11} \\approx 3.2727...$\n$\\tau_A = \\min(0.6, 3.2727...) = 0.6\\,\\mathrm{s}$\n\nFor species $B$:\n$\\tau_B = \\min\\left( \\frac{N_{C,B}}{|\\mu_B(\\mathbf{x})|}, \\frac{N_{C,B}^2}{\\sigma_B^2(\\mathbf{x})} \\right) = \\min\\left( \\frac{3}{20}, \\frac{3^2}{44} \\right) = \\min\\left( 0.15, \\frac{9}{44} \\right)$\n$\\frac{9}{44} \\approx 0.2045...$\n$\\tau_B = \\min(0.15, 0.2045...) = 0.15\\,\\mathrm{s}$\n\nThe maximal admissible leap size $\\tau$ is the minimum of the individual species' step sizes:\n$\\tau = \\min(\\tau_A, \\tau_B) = \\min(0.6\\,\\mathrm{s}, 0.15\\,\\mathrm{s}) = 0.15\\,\\mathrm{s}$\n\nThe problem requires the result to be rounded to four significant figures. The exact value is $0.15$. Expressed with four significant figures, this is $0.1500$.", "answer": "$$\\boxed{0.1500}$$", "id": "2695002"}, {"introduction": "While the CGP criterion helps ensure accuracy, explicit numerical methods like $\\tau$-leaping are also subject to stability constraints. Choosing a leap size $\\tau$ that is too large can introduce unphysical artifacts, such as oscillations, even if the accuracy tolerance is met. This exercise provides a crucial lesson in numerical stability by having you analytically compare the variance dynamics of an explicit $\\tau$-leap approximation to the exact CME solution for a pure decay process, revealing the fundamental limit on $\\tau$ required to maintain qualitative fidelity. [@problem_id:2694968]", "problem": "Consider a single-species, unimolecular decay reaction network with reaction $R_{1}: X \\to \\varnothing$ and propensity $a_{1}(x)=k\\,x$, where $k0$ is a constant rate and $x \\in \\mathbb{N}$ is the current copy number. The system is initialized deterministically with $X(0)=x_{0}\\in\\mathbb{N}$. You will compare the variance dynamics produced by the exact Chemical Master Equation (CME) with those produced by the explicit $\\tau$-leaping approximation, and then determine a step-size constraint that prevents oscillations in the discrete-time variance trajectory.\n\nUsing only fundamental probabilistic properties of unimolecular decay, the thinning interpretation of survival for each molecule, and the definitions of explicit $\\tau$-leaping together with the law of total expectation and the law of total variance (no other ad hoc formulas), do the following.\n\n- Derive the exact CME variance $\\operatorname{Var}_{\\mathrm{CME}}[X(t)]$ as a function of $t\\ge 0$, $k$, and $x_{0}$.\n- Model explicit $\\tau$-leaping with a fixed step $\\tau0$ as $X_{n+1}=X_{n}-K_{n}$, where, conditional on $X_{n}$, the increment $K_{n}$ is a Poisson random variable with parameter $k\\,\\tau\\,X_{n}$. Starting from the definitions, derive a closed-form expression for the discrete-time variance $\\operatorname{Var}[X_{n}]$ at $t_{n}=n\\,\\tau$ in terms of $n\\in\\mathbb{N}$, $k$, $\\tau$, and $x_{0}$.\n- By analyzing the resulting discrete-time variance, identify the largest step size $\\tau_{\\max}$ such that for any $\\tau$ with $0\\tau\\tau_{\\max}$, the explicit $\\tau$-leaping variance trajectory does not exhibit step-to-step oscillations and decays to $0$ as $n\\to\\infty$ after at most one peak.\n\nGive your final answer as the closed-form expression for $\\tau_{\\max}$ in terms of $k$. Express $\\tau_{\\max}$ in seconds if $k$ is in $\\mathrm{s}^{-1}$. Do not include units in your final boxed expression.", "solution": "We consider the unimolecular decay reaction $R_{1}: X \\to \\varnothing$ with propensity $a_{1}(x)=k\\,x$. The initial condition is $X(0)=x_{0}\\in\\mathbb{N}$.\n\nFirst, we analyze the exact Chemical Master Equation (CME) solution. In a pure decay process with rate $k$, each individual molecule survives independently up to time $t$ with probability $p(t)=\\exp(-k t)$. This follows from the exponential distribution of the waiting time for decay and the independence of decay events across molecules under the CME. Therefore, $X(t)$ can be represented as the sum of $x_{0}$ independent Bernoulli random variables, each indicating survival at time $t$ with success probability $p(t)=\\exp(-k t)$. Consequently,\n$$\nX(t)\\sim \\mathrm{Binomial}\\!\\left(x_{0},\\,\\exp(-k t)\\right).\n$$\nIt follows that the exact mean and variance under the Chemical Master Equation (CME) are\n$$\n\\mathbb{E}[X(t)]=x_{0}\\,\\exp(-k t),\n\\qquad\n\\operatorname{Var}_{\\mathrm{CME}}[X(t)]=x_{0}\\,\\exp(-k t)\\,\\bigl(1-\\exp(-k t)\\bigr).\n$$\n\nNext, we derive the variance dynamics under explicit $\\tau$-leaping. Let $t_{n}=n\\,\\tau$ and $X_{n}=X(t_{n})$. In explicit $\\tau$-leaping, over the interval $[t_{n},t_{n+1})$ the propensity is frozen at its value at $t_{n}$, so the number of firings $K_{n}$ is modeled conditionally as\n$$\nK_{n}\\,|\\,X_{n}\\;\\sim\\;\\mathrm{Poisson}\\!\\bigl(k\\,\\tau\\,X_{n}\\bigr).\n$$\nThe state update is\n$$\nX_{n+1}=X_{n}-K_{n}.\n$$\nWe compute the mean recursion using the law of total expectation:\n$$\n\\mathbb{E}[X_{n+1}\\,|\\,X_{n}]=X_{n}-\\mathbb{E}[K_{n}\\,|\\,X_{n}]=X_{n}-k\\,\\tau\\,X_{n}=(1-k\\,\\tau)\\,X_{n}.\n$$\nTaking expectations yields\n$$\nm_{n+1}=\\mathbb{E}[X_{n+1}]=(1-k\\,\\tau)\\,\\mathbb{E}[X_{n}]=(1-k\\,\\tau)\\,m_{n},\n$$\nwith $m_{0}=x_{0}$. Hence,\n$$\nm_{n}=x_{0}\\,(1-k\\,\\tau)^{n}.\n$$\n\nWe now derive the variance recursion via the law of total variance:\n$$\n\\operatorname{Var}[X_{n+1}]=\\mathbb{E}\\!\\left[\\operatorname{Var}(X_{n+1}\\,|\\,X_{n})\\right]+\\operatorname{Var}\\!\\left(\\mathbb{E}[X_{n+1}\\,|\\,X_{n}]\\right).\n$$\nGiven $X_{n}$, we have $\\operatorname{Var}(X_{n+1}\\,|\\,X_{n})=\\operatorname{Var}(K_{n}\\,|\\,X_{n})=k\\,\\tau\\,X_{n}$ and $\\mathbb{E}[X_{n+1}\\,|\\,X_{n}]=(1-k\\,\\tau)\\,X_{n}$. Therefore,\n$$\nv_{n+1}=\\operatorname{Var}[X_{n+1}]=\\mathbb{E}[k\\,\\tau\\,X_{n}]+\\operatorname{Var}\\!\\bigl((1-k\\,\\tau)\\,X_{n}\\bigr)\n= k\\,\\tau\\,m_{n}+(1-k\\,\\tau)^{2}\\,v_{n},\n$$\nwith $v_{0}=\\operatorname{Var}[X_{0}]=0$. This is a first-order linear inhomogeneous recurrence with known mean $m_{n}$.\n\nLet $r:=1-k\\,\\tau$. Then $m_{n}=x_{0}\\,r^{n}$ and\n$$\nv_{n+1}=r^{2}\\,v_{n}+k\\,\\tau\\,x_{0}\\,r^{n}.\n$$\nWe solve this recurrence by the method of undetermined coefficients. Seek a particular solution of the form $v_{n}^{(p)}=B\\,r^{n}$. Substituting,\n$$\nB\\,r^{n+1}=r^{2}\\,(B\\,r^{n})+k\\,\\tau\\,x_{0}\\,r^{n}\\;\\;\\Longrightarrow\\;\\;B\\,r=B\\,r^{2}+k\\,\\tau\\,x_{0}.\n$$\nRearranging,\n$$\nB\\,(r-r^{2})=k\\,\\tau\\,x_{0}\\;\\;\\Longrightarrow\\;\\;B\\,r\\,(1-r)=k\\,\\tau\\,x_{0}.\n$$\nUsing $1-r=1-(1-k\\,\\tau)=k\\,\\tau$, we obtain $B\\,r\\,k\\,\\tau=k\\,\\tau\\,x_{0}$, hence $B\\,r=x_{0}$ and $B=x_{0}/r$. Therefore, a particular solution is\n$$\nv_{n}^{(p)}=\\frac{x_{0}}{r}\\,r^{n}=x_{0}\\,r^{n-1}.\n$$\nThe homogeneous solution is $v_{n}^{(h)}=A\\,r^{2n}$, where $A$ is a constant. Imposing $v_{0}=0$ gives\n$$\n0=v_{0}=A\\,r^{0}+x_{0}\\,r^{-1}\\;\\;\\Longrightarrow\\;\\;A=-x_{0}\\,r^{-1}.\n$$\nTherefore,\n$$\nv_{n}=v_{n}^{(h)}+v_{n}^{(p)}=-x_{0}\\,r^{-1}\\,r^{2n}+x_{0}\\,r^{n-1}\n= x_{0}\\,r^{n-1}\\,\\bigl(1-r^{n}\\bigr).\n$$\n\nThis closed-form expression shows how explicit $\\tau$-leaping approximates the CME variance. To compare with the exact CME result, recall $\\operatorname{Var}_{\\mathrm{CME}}[X(t)]=x_{0}\\,\\exp(-k t)\\,\\bigl(1-\\exp(-k t)\\bigr)$. Setting $t_{n}=n\\,\\tau$ and $r=1-k\\,\\tau$, we observe the pointwise convergence\n$$\n\\lim_{\\tau\\to 0}\\,r^{n}=\\lim_{\\tau\\to 0}(1-k\\,\\tau)^{t_{n}/\\tau}=\\exp(-k t_{n}),\n\\qquad\n\\lim_{\\tau\\to 0}\\,r^{n-1}=\\exp(-k t_{n}),\n$$\nso that\n$$\n\\lim_{\\tau\\to 0} v_{n}=x_{0}\\,\\exp(-k t_{n})\\,\\bigl(1-\\exp(-k t_{n})\\bigr)=\\operatorname{Var}_{\\mathrm{CME}}[X(t_{n})],\n$$\nas expected.\n\nWe now identify a range of $\\tau$ that guarantees non-oscillatory variance decay for the discrete trajectory $\\{v_{n}\\}_{n\\ge 0}$. The explicit factor $r=1-k\\,\\tau$ controls dynamical behavior:\n\n- If $|r|1$ (i.e., $0k\\,\\tau2$), then $r^{n}\\to 0$ as $n\\to\\infty$, ensuring stability (decay to $0$) in the first moment and, by the formula above, in the variance as well.\n- If $r0$ (i.e., $k\\,\\tau1$), then $r^{n}$ alternates sign with $n$, which induces step-to-step oscillations in the discrete dynamics. In particular, the factor $r^{n-1}\\,(1-r^{n})$ alternates in sign and magnitude, leading to oscillatory behavior and, for sufficiently large $\\tau$, even transient negativity in $v_{n}$ predicted by the linearized moment recursion, signaling a breakdown of the explicit Poisson $\\tau$-leap’s qualitative fidelity for this decay process.\n- If $0r1$ (i.e., $0k\\,\\tau1$), then $r^{n}$ is nonnegative and strictly decreasing to $0$. The expression $v_{n}=x_{0}\\,r^{n-1}\\,(1-r^{n})$ is nonnegative for all $n$, exhibits at most one peak, and then decays monotonically to $0$ as $n\\to\\infty$ without step-to-step oscillations.\n\nTherefore, the largest step that guarantees non-oscillatory decay is obtained by enforcing $0r1$, namely\n$$\n01-k\\,\\tau1\\;\\;\\Longleftrightarrow\\;\\;0\\tau\\frac{1}{k}.\n$$\nThe sharp upper bound is thus\n$$\n\\tau_{\\max}=\\frac{1}{k}.\n$$\nThis choice ensures that the discrete-time variance trajectory produced by explicit $\\tau$-leaping does not oscillate and decays to $0$ after at most one peak, in qualitative agreement with the exact CME behavior as $\\tau\\to 0$.", "answer": "$$\\boxed{\\frac{1}{k}}$$", "id": "2694968"}, {"introduction": "One of the most significant challenges for $\\tau$-leaping is its potential failure near boundaries, such as when a species count approaches zero. In these low-copy-number regimes, the assumption of constant propensities breaks down, leading to inaccuracies or non-physical states. This capstone practice demonstrates a powerful solution: a hybrid simulation strategy. You will implement and compare the exact Stochastic Simulation Algorithm (SSA) with a $\\tau$-leaping method that intelligently switches to SSA for the final steps before extinction, allowing you to accurately and efficiently estimate a key quantity—the mean first-passage time to extinction. [@problem_id:2695011]", "problem": "You must write a complete, runnable program that estimates the mean first-passage time to zero (extinction time) for a continuous-time birth-death process using two methods: an exact method based on the Stochastic Simulation Algorithm (SSA) and an approximate method based on the $\\tau$-leaping method enhanced with an event detection approach. The underlying system is a single-species reaction network with per capita birth and death, governed by the Chemical Master Equation. The two reactions are birth and death, where the propensities at state $x$ are $a_{\\text{birth}}(x) = \\lambda x$ and $a_{\\text{death}}(x) = \\mu x$, with $\\lambda \\ge 0$ and $\\mu \\ge 0$. The initial count of individuals is $x(0) = x_0 \\in \\{0,1,2,\\dots\\}$. The first-passage time to zero is the first time $t \\ge 0$ such that $x(t) = 0$. All time values in this problem must be expressed in seconds.\n\nThe required methods are:\n- Exact Stochastic Simulation Algorithm (SSA): Simulate sample paths by iteratively drawing exponentially distributed inter-event times based on the total propensity $a_0(x) = a_{\\text{birth}}(x) + a_{\\text{death}}(x)$ and selecting the reaction channel according to their relative propensities, until the process hits state $0$. Record the first-passage time for each trajectory and take the sample mean over a prescribed number of trajectories.\n- $\\tau$-leaping with event detection: Advance time in fixed increments $\\tau$ by approximating the number of firings of each reaction within each leap by independent Poisson random variables with parameters $a_{\\text{birth}}(x)\\tau$ and $a_{\\text{death}}(x)\\tau$. If a proposed leap would drive the state to a non-positive value, do not accept that leap. Instead, switch to an exact SSA micro-simulation from the current state and continue exactly until extinction; record the exact extinction time found in this event-detection phase. Otherwise, accept the leap and continue. Repeat until extinction and record the first-passage time. Take the sample mean over the same number of trajectories.\n\nBase your implementation on the following fundamental principles and facts:\n- The Chemical Master Equation with mass-action kinetics defines the propensity functions $a_j(x)$ for each reaction channel $j$, with $a_{\\text{birth}}(x)=\\lambda x$ and $a_{\\text{death}}(x)=\\mu x$.\n- Under the exact SSA, when at state $x$, the waiting time to the next reaction is exponentially distributed with rate $a_0(x) = \\sum_j a_j(x)$, and the next reaction channel is selected with probability $a_j(x)/a_0(x)$.\n- Under the $\\tau$-leaping approximation, for a leap of size $\\tau$, the reaction counts are modeled as independent Poisson random variables with means $a_j(x)\\tau$ computed from the state at the start of the leap.\n\nImplement both estimators and compare them across multiple test cases by reporting the absolute difference between the two estimated mean first-passage times. All random variates must be generated using a reproducible pseudo-random number generator. For each test case indexed by $i$ starting from $0$, use two independent random number generators initialized with seeds $s_{\\tau}+i$ and $s_{\\text{SSA}}+i$, respectively, where $s_{\\tau} = 12345$ and $s_{\\text{SSA}} = 67890$. For each test case, simulate exactly $M$ independent trajectories under each method and compute the sample mean first-passage time for each method. Your program must output the absolute difference between these two sample means for each test case as a float in seconds.\n\nUse the following test suite, which exercises a boundary case, a pure-death case, a subcritical birth-death case, and a near-critical case:\n- Test $0$ (boundary): $(\\lambda, \\mu, x_0, \\tau, M) = (0.3, 0.7, 0, 0.2, 1000)$.\n- Test $1$ (pure death): $(\\lambda, \\mu, x_0, \\tau, M) = (0.0, 1.0, 20, 0.05, 1000)$.\n- Test $2$ (subcritical): $(\\lambda, \\mu, x_0, \\tau, M) = (0.2, 0.5, 30, 0.1, 1000)$.\n- Test $3$ (near-critical): $(\\lambda, \\mu, x_0, \\tau, M) = (0.4, 0.5, 10, 0.05, 1000)$.\n\nAll rates are in $\\text{s}^{-1}$ and all times must be reported in seconds. For Test $0$, the first-passage time is identically $0$ seconds.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each float rounded to exactly six digits after the decimal point, in the order of the tests. For example, an output should look like \"[0.000000,0.012345,0.001234,0.056789]\".", "solution": "We begin from the Chemical Master Equation for a well-mixed system under mass-action kinetics. For a single-species linear birth-death process with state $x \\in \\{0,1,2,\\dots\\}$, the two reaction channels and their propensities are $a_{\\text{birth}}(x) = \\lambda x$ and $a_{\\text{death}}(x) = \\mu x$, where $\\lambda \\ge 0$ and $\\mu \\ge 0$ are per capita rates expressed in $\\text{s}^{-1}$. The Chemical Master Equation implies that, conditional on the current state $x$, the waiting time to the next reaction under the exact dynamics is exponentially distributed with rate $a_0(x) = a_{\\text{birth}}(x) + a_{\\text{death}}(x)$, and the identity of the next reaction is birth with probability $a_{\\text{birth}}(x)/a_0(x)$ and death with probability $a_{\\text{death}}(x)/a_0(x)$. This is the foundational basis for the exact Stochastic Simulation Algorithm (SSA), also known as the Gillespie direct method. We simulate paths until the absorbing state $x=0$ is reached; the accumulated time is the first-passage time (FPT) to zero.\n\nThe $\\tau$-leaping approximation, grounded in the assumption that propensities remain approximately constant over a small time interval of length $\\tau$, models the number of firings of reaction channel $j$ during one leap as a Poisson random variable with mean $a_j(x)\\tau$, where $x$ is the state at the beginning of the leap. For our two-channel system at state $x$, we draw independent $K_{\\text{birth}} \\sim \\text{Poisson}(a_{\\text{birth}}(x)\\tau)$ and $K_{\\text{death}} \\sim \\text{Poisson}(a_{\\text{death}}(x)\\tau)$, and propose the new state $x' = x + K_{\\text{birth}} - K_{\\text{death}}$. This approximation may occasionally propose negative values, which are non-physical. To handle first-passage detection robustly, we adopt an event detection strategy: if the proposed leap would drive the system at or below zero, we do not accept the leap. Instead, we switch to exact SSA from the current state and continue until the process exactly reaches zero. The time accrued during the SSA micro-simulation added to the elapsed $\\tau$-leaping time yields an extinction time that is exact for the terminal approach to the absorbing set, while the earlier evolution remains approximated by the $\\tau$-leaps.\n\nAlgorithmic design for exact SSA:\n1. Initialize $t \\leftarrow 0$ and $x \\leftarrow x_0$. If $x_0 = 0$, return $0$.\n2. While $x  0$, compute $a_{\\text{birth}}(x) = \\lambda x$, $a_{\\text{death}}(x) = \\mu x$, and $a_0(x) = a_{\\text{birth}}(x) + a_{\\text{death}}(x)$.\n3. Draw $\\Delta t \\sim \\text{Exponential}(1/a_0(x))$; draw $u \\sim \\text{Uniform}(0,1)$.\n4. If $u  a_{\\text{birth}}(x)/a_0(x)$, set $x \\leftarrow x + 1$, else set $x \\leftarrow x - 1$. Update $t \\leftarrow t + \\Delta t$.\n5. When $x=0$, return $t$ as the FPT.\n\nAlgorithmic design for $\\tau$-leaping with event detection:\n1. Initialize $t \\leftarrow 0$ and $x \\leftarrow x_0$. If $x_0 = 0$, return $0$.\n2. While $x  0$:\n   a. Compute $a_{\\text{birth}}(x) = \\lambda x$ and $a_{\\text{death}}(x) = \\mu x$.\n   b. Draw $K_{\\text{birth}} \\sim \\text{Poisson}(a_{\\text{birth}}(x)\\tau)$ and $K_{\\text{death}} \\sim \\text{Poisson}(a_{\\text{death}}(x)\\tau)$.\n   c. Form the tentative new state $x' = x + K_{\\text{birth}} - K_{\\text{death}}$.\n   d. If $x'  0$, accept the leap: set $x \\leftarrow x'$, $t \\leftarrow t + \\tau$, and continue.\n   e. If $x' \\le 0$, reject the leap and switch to exact SSA from the current state $x$ without changing $t$. Run SSA until $x=0$, accumulating exact time increments. Return the extinction time $t$ including the SSA micro-simulation time.\nThis event detection guarantees that the final approach to the absorbing boundary is simulated exactly whenever the leap indicates a possible crossing.\n\nStatistical estimation and reproducibility:\n- For each test case, perform $M$ independent trajectories for both SSA and $\\tau$-leaping with event detection, compute the sample mean FPT for each method, and report the absolute difference between these means.\n- For reproducibility, for test index $i \\in \\{0,1,2,3\\}$, use independent pseudo-random number generators initialized with seeds $s_{\\tau} + i$ and $s_{\\text{SSA}} + i$ for the $\\tau$-leaping and SSA methods, respectively, where $s_{\\tau} = 12345$ and $s_{\\text{SSA}} = 67890$.\n\nUnits and outputs:\n- All rates $\\lambda$ and $\\mu$ are in $\\text{s}^{-1}$ and all times are in seconds.\n- The program must output a single line containing a list of four floats, each the absolute difference in seconds between the two estimated mean FPTs for the corresponding test, rounded to exactly six digits after the decimal point, enclosed in square brackets and separated by commas.\n\nTest suite specification:\n- Test $0$: $(\\lambda, \\mu, x_0, \\tau, M) = (0.3, 0.7, 0, 0.2, 1000)$; expected FPT is identically $0$ seconds.\n- Test $1$: $(\\lambda, \\mu, x_0, \\tau, M) = (0.0, 1.0, 20, 0.05, 1000)$; pure death, finite expected FPT.\n- Test $2$: $(\\lambda, \\mu, x_0, \\tau, M) = (0.2, 0.5, 30, 0.1, 1000)$; subcritical birth-death, finite expected FPT.\n- Test $3$: $(\\lambda, \\mu, x_0, \\tau, M) = (0.4, 0.5, 10, 0.05, 1000)$; near-critical, finite expected FPT but larger variance than subcritical.\n\nRationale:\n- The SSA is exact under the Chemical Master Equation assumptions.\n- The $\\tau$-leaping approximation introduces error by freezing propensities over each leap, but the event detection correction removes the dominant boundary-crossing error by switching to exact SSA when a leap would bring the system at or below zero. This yields a practical and accurate estimator of the mean FPT, especially when $\\tau$ is small relative to the inverse of the total propensity and when the state is not too close to zero. The comparisons across the test suite highlight accuracy in a boundary case (extinction at time zero), in a monotone pure-death process, and in subcritical regimes with different degrees of stiffness.\n\nThe final program must implement the above algorithms precisely, adhere to the specified seeds and sample sizes, and print the results in the exact format.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef ssa_first_passage_time(lmbda, mu, x0, rng):\n    \"\"\"\n    Exact SSA for first-passage time to zero in a linear birth-death process.\n    Rates: birth: lmbda * x, death: mu * x\n    Returns time to hit zero (in seconds).\n    \"\"\"\n    if x0 = 0:\n        return 0.0\n    t = 0.0\n    x = int(x0)\n    while x > 0:\n        a_birth = lmbda * x\n        a_death = mu * x\n        a0 = a_birth + a_death\n        if a0 = 0.0:\n            # Trapped away from zero; treat as infinite (should not occur in provided tests)\n            return float('inf')\n        dt = rng.exponential(1.0 / a0)\n        t += dt\n        if rng.random()  (a_birth / a0):\n            x += 1\n        else:\n            x -= 1\n    return t\n\ndef tau_leap_event_detection_fpt(lmbda, mu, x0, tau, rng):\n    \"\"\"\n    Tau-leaping with event detection for first-passage time to zero.\n    Leaps of fixed size tau. If a leap would cross zero (x + K_birth - K_death = 0),\n    switch to exact SSA from the current state to compute the extinction time exactly.\n    \"\"\"\n    if x0 = 0:\n        return 0.0\n    t = 0.0\n    x = int(x0)\n    while x > 0:\n        a_birth = lmbda * x\n        a_death = mu * x\n        a0 = a_birth + a_death\n        if a0 = 0.0:\n            # No events possible; treat as infinite (should not occur in provided tests)\n            return float('inf')\n        # Draw Poisson counts for this leap\n        k_birth = rng.poisson(a_birth * tau)\n        k_death = rng.poisson(a_death * tau)\n        x_new = x + k_birth - k_death\n        if x_new > 0:\n            # Accept leap\n            x = x_new\n            t += tau\n        else:\n            # Event detection: switch to exact SSA to hit zero\n            while x > 0:\n                a_birth = lmbda * x\n                a_death = mu * x\n                a0 = a_birth + a_death\n                dt = rng.exponential(1.0 / a0)\n                t += dt\n                if rng.random()  (a_birth / a0):\n                    x += 1\n                else:\n                    x -= 1\n            # Now extinct; return time\n            return t\n    return t\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test: (lambda, mu, x0, tau, M)\n    test_cases = [\n        (0.3, 0.7, 0, 0.2, 1000),   # Test 0: boundary x0=0\n        (0.0, 1.0, 20, 0.05, 1000), # Test 1: pure death\n        (0.2, 0.5, 30, 0.1, 1000),  # Test 2: subcritical\n        (0.4, 0.5, 10, 0.05, 1000), # Test 3: near-critical\n    ]\n\n    # Base seeds for reproducibility\n    seed_tau_base = 12345\n    seed_ssa_base = 67890\n\n    results = []\n    for idx, (lmbda, mu, x0, tau, M) in enumerate(test_cases):\n        rng_tau = np.random.default_rng(seed_tau_base + idx)\n        rng_ssa = np.random.default_rng(seed_ssa_base + idx)\n\n        # Run tau-leaping with event detection\n        times_tau = []\n        for _ in range(M):\n            t = tau_leap_event_detection_fpt(lmbda, mu, x0, tau, rng_tau)\n            times_tau.append(t)\n        mean_tau = float(np.mean(times_tau)) if len(times_tau) > 0 else 0.0\n\n        # Run exact SSA\n        times_ssa = []\n        for _ in range(M):\n            t = ssa_first_passage_time(lmbda, mu, x0, rng_ssa)\n            times_ssa.append(t)\n        mean_ssa = float(np.mean(times_ssa)) if len(times_ssa) > 0 else 0.0\n\n        diff = abs(mean_tau - mean_ssa)\n        results.append(diff)\n\n    # Final print statement in the exact required format: 6 digits after decimal point.\n    print(\"[\" + \",\".join(f\"{r:.6f}\" for r in results) + \"]\")\n\nsolve()\n```", "id": "2695011"}]}