{"hands_on_practices": [{"introduction": "埃瓦尔德球的半径是其结构的核心参数，由辐射的波长决定。在透射电子显微镜（TEM）中，电子被加速到相对论速度，因此准确计算电子波长至关重要。此练习将探讨相对论效应对电子波长的影响，并量化其对埃瓦尔德球半径的修正，这对于高精度衍射分析是必不可少的。[@problem_id:2820252]", "problem": "动能为 $T$ 的电子束用于在透射电子显微镜 (Transmission Electron Microscopy, TEM) 中收集衍射图样。在构建电子衍射的 Ewald 球时，既可以使用非相对论的 de Broglie 波长，也可以使用相对论修正后的波长。在晶体学关于倒易空间（倒易矢量不含因子 $2\\pi$）的约定中，Ewald 球的半径为 $R = 1/\\lambda$，其中 $\\lambda$ 是电子的 de Broglie 波长。\n\n仅从基本关系式 $p = h/\\lambda$ (de Broglie 关系式)，$T = p^{2}/(2m_{e})$ (非相对论动能)，以及狭义相对论的质能关系式 $(pc)^{2} = E^{2} - (m_{e}c^{2})^{2}$（其中 $E = T + m_{e}c^{2}$）出发，完成以下任务：\n\n1. 推导相对论修正后的波长 $\\lambda_{\\mathrm{rel}}(T)$ 和非相对论波长 $\\lambda_{\\mathrm{nr}}(T)$ 的显式表达式。\n2. 使用晶体学 Ewald 球半径 $R = 1/\\lambda$，将由相对论修正引起的半径分数变化表示为\n$$\n\\delta \\equiv \\frac{R_{\\mathrm{rel}} - R_{\\mathrm{nr}}}{R_{\\mathrm{nr}}}.\n$$\n3. 对于动能为 $T = 200\\,\\mathrm{keV}$ 的电子，数值计算 $\\delta$ 的值。\n\n将 $\\delta$ 的最终值报告为一个无量纲小数，并四舍五入到四位有效数字。\n\n根据需要使用以下常量：$h = 6.62607015\\times 10^{-34}\\,\\mathrm{J\\,s}$，$m_{e} = 9.1093837015\\times 10^{-31}\\,\\mathrm{kg}$，$c = 2.99792458\\times 10^{8}\\,\\mathrm{m\\,s^{-1}}$，$e = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$，以及 $m_{e}c^{2} = 511\\,\\mathrm{keV}$。所有中间推理过程均需使用符号表示；只有 $\\delta$ 的最终数值计算应使用数字。最终答案必须是方框中的一个无单位的数字。", "solution": "所述问题具有科学依据，内容完备且表述清晰。我们将着手进行推导和计算。\n\n第一个任务是推导非相对论波长 $\\lambda_{\\mathrm{nr}}(T)$ 和相对论修正后波长 $\\lambda_{\\mathrm{rel}}(T)$ 的表达式。\n\n对于非相对论情况，动能 $T$ 通过 $T = \\frac{p_{\\mathrm{nr}}^{2}}{2m_{e}}$ 与动量 $p_{\\mathrm{nr}}$ 相关。解出动量可得：\n$$p_{\\mathrm{nr}} = \\sqrt{2m_{e}T}$$\n使用 de Broglie 关系式 $\\lambda = \\frac{h}{p}$，我们得到非相对论波长：\n$$\\lambda_{\\mathrm{nr}}(T) = \\frac{h}{p_{\\mathrm{nr}}} = \\frac{h}{\\sqrt{2m_{e}T}}$$\n\n对于相对论情况，我们使用质能关系式 $(p_{\\mathrm{rel}}c)^{2} = E^{2} - (m_{e}c^{2})^{2}$，其中总能量为 $E = T + m_{e}c^{2}$。将 $E$ 的表达式代入该关系式中得到：\n$$(p_{\\mathrm{rel}}c)^{2} = (T + m_{e}c^{2})^{2} - (m_{e}c^{2})^{2}$$\n展开平方项并化简：\n$$(p_{\\mathrm{rel}}c)^{2} = T^{2} + 2Tm_{e}c^{2} + (m_{e}c^{2})^{2} - (m_{e}c^{2})^{2} = T^{2} + 2Tm_{e}c^{2} = T(T + 2m_{e}c^{2})$$\n解出相对论动量 $p_{\\mathrm{rel}}$：\n$$p_{\\mathrm{rel}} = \\frac{\\sqrt{T(T + 2m_{e}c^{2})}}{c}$$\n然后，通过 de Broglie 关系式给出相对论波长 $\\lambda_{\\mathrm{rel}}$：\n$$\\lambda_{\\mathrm{rel}}(T) = \\frac{h}{p_{\\mathrm{rel}}} = \\frac{hc}{\\sqrt{T(T + 2m_{e}c^{2})}}$$\n\n第二个任务是推导 Ewald 球半径的分数变化 $\\delta$ 的表达式。其定义如下：\n$$\\delta \\equiv \\frac{R_{\\mathrm{rel}} - R_{\\mathrm{nr}}}{R_{\\mathrm{nr}}}$$\n使用关系式 $R = 1/\\lambda$，我们可以用波长来表示 $\\delta$：\n$$\\delta = \\frac{1/\\lambda_{\\mathrm{rel}} - 1/\\lambda_{\\mathrm{nr}}}{1/\\lambda_{\\mathrm{nr}}} = \\frac{\\lambda_{\\mathrm{nr}}}{\\lambda_{\\mathrm{rel}}} - 1$$\n波长之比等于相应动量的反比：\n$$\\frac{\\lambda_{\\mathrm{nr}}}{\\lambda_{\\mathrm{rel}}} = \\frac{h/p_{\\mathrm{nr}}}{h/p_{\\mathrm{rel}}} = \\frac{p_{\\mathrm{rel}}}{p_{\\mathrm{nr}}}$$\n代入已推导出的 $p_{\\mathrm{rel}}$ 和 $p_{\\mathrm{nr}}$ 表达式：\n$$\\frac{p_{\\mathrm{rel}}}{p_{\\mathrm{nr}}} = \\frac{\\frac{\\sqrt{T(T + 2m_{e}c^{2})}}{c}}{\\sqrt{2m_{e}T}} = \\frac{1}{c}\\sqrt{\\frac{T(T + 2m_{e}c^{2})}{2m_{e}T}} = \\sqrt{\\frac{T + 2m_{e}c^{2}}{2m_{e}c^{2}}}$$\n进一步化简此表达式：\n$$\\frac{p_{\\mathrm{rel}}}{p_{\\mathrm{nr}}} = \\sqrt{\\frac{T}{2m_{e}c^{2}} + 1}$$\n因此，分数变化 $\\delta$ 由下式给出：\n$$\\delta = \\sqrt{1 + \\frac{T}{2m_{e}c^{2}}} - 1$$\n\n第三个任务是对于电子动能为 $T = 200\\,\\mathrm{keV}$ 的情况，数值计算 $\\delta$。我们已知电子的静止质量能量为 $m_{e}c^{2} = 511\\,\\mathrm{keV}$。将这些值代入我们的 $\\delta$ 表达式中：\n$$\\delta = \\sqrt{1 + \\frac{200\\,\\mathrm{keV}}{2 \\times 511\\,\\mathrm{keV}}} - 1 = \\sqrt{1 + \\frac{100}{511}} - 1$$\n我们进行数值计算：\n$$\\delta = \\sqrt{\\frac{511 + 100}{511}} - 1 = \\sqrt{\\frac{611}{511}} - 1$$\n$$\\delta \\approx \\sqrt{1.195694716} - 1 \\approx 1.093478265 - 1 = 0.093478265$$\n根据要求将结果四舍五入到四位有效数字：\n$$\\delta \\approx 0.09348$$\n此结果表明，对于一个 $200\\,\\mathrm{keV}$ 的电子，Ewald 球半径的非相对论近似值有大约 $9.35\\%$ 的误差。", "answer": "$$\\boxed{0.09348}$$", "id": "2820252"}, {"introduction": "掌握了埃瓦尔德球的基本参数后，我们可以应用它来预测实际的衍射图样。这个练习将埃瓦尔德球的几何结构与粉末X射线衍射（XRD）实验联系起来，要求您从第一性原理推导德拜-谢乐环在探测器上的半径。通过这个过程，您将把抽象的倒易晶格概念转化为可测量的实验结果，并应用晶体结构特有的选择定则。[@problem_id:2820326]", "problem": "一束波长为 $\\lambda$ 的单色X射线照射到一个立方晶体的细粉末上。粉末样品置于原点，一个平坦的二维探测器放置在样品下游距离为 $L$ 处，并垂直于入射光束（透射几何构型）。考虑一个晶格常数为 $a$ 的体心立方（BCC）晶体。探测器上第一个可观测到的德拜-谢乐环对应于最小衍射角所对应的允许晶面族。仅使用埃瓦尔德球构造（波矢大小 $|{\\bf k}|=|{\\bf k}'|=2\\pi/\\lambda$，弹性散射满足 ${\\bf k}'-{\\bf k}={\\bf G}_{hkl}$）以及射线与平面相交的几何关系，且不做任何小角度近似，推导对于一个立方晶格中普遍的允许晶面族 $\\{hkl\\}$，其在探测器上形成的环的半径 $R$ 关于 $\\lambda$、$a$、$L$ 以及 $h,k,l$ 的表达式。然后，应用体心立方晶格的选择定则，确定BCC晶格中最小衍射角所对应的允许晶面族，并计算在下列条件下 $R$ 的相应数值：\n- 波长 $\\lambda=0.500\\,\\text{\\AA}$，\n- 晶格常数 $a=2.8665\\,\\text{\\AA}$，\n- 探测器距离 $L=400.0\\,\\text{mm}$。\n将最终的半径数值结果四舍五入至四位有效数字，并以 $\\text{mm}$ 为单位表示。在最终答案中仅给出半径的数值。", "solution": "基本出发点是波矢大小为 $|{\\bf k}|=|{\\bf k}'|=2\\pi/\\lambda$ 的波的弹性散射的埃瓦尔德球构造。当散射矢量等于一个倒格矢时，即 ${\\bf q}={\\bf k}'-{\\bf k}={\\bf G}_{hkl}$，发生衍射。对于弹性散射，${\\bf k}$ 和 ${\\bf k}'$ 之间的夹角是 $2\\theta$，其中 $\\theta$ 是布拉格角。根据矢量几何，两个大小相等（均为 $k$）、夹角为 $2\\theta$ 的矢量之差的模为\n$$\n|{\\bf q}|=\\sqrt{k^{2}+k^{2}-2k^{2}\\cos(2\\theta)}=2k\\sin\\theta.\n$$\n因此，\n$$\n|{\\bf G}_{hkl}|=2k\\sin\\theta=\\frac{4\\pi}{\\lambda}\\sin\\theta.\n$$\n对于晶格常数为 $a$ 的立方晶格，其倒易晶格也是立方的，参数为 $2\\pi/a$，且 ${\\bf G}_{hkl}$ 的模为\n$$\n|{\\bf G}_{hkl}|=\\frac{2\\pi}{a}\\sqrt{h^{2}+k^{2}+l^{2}}.\n$$\n令两个表达式相等，得到\n$$\n\\frac{2\\pi}{a}\\sqrt{h^{2}+k^{2}+l^{2}}=\\frac{4\\pi}{\\lambda}\\sin\\theta\n\\;\\;\\Longrightarrow\\;\\;\n\\sin\\theta=\\frac{\\lambda}{2a}\\sqrt{h^{2}+k^{2}+l^{2}}.\n$$\n等价地，使用立方晶体的晶面间距，\n$$\nd_{hkl}=\\frac{a}{\\sqrt{h^{2}+k^{2}+l^{2}}},\n$$\n可以得到一级布拉格关系，\n$$\n\\sin\\theta=\\frac{\\lambda}{2d_{hkl}}.\n$$\n接下来，我们将散射角与平面探测器上的环半径联系起来。衍射射线围绕入射光束轴形成一个半顶角为 $2\\theta$ 的圆锥。一个极角为 $2\\theta$ 的射线与一个在距离 $L$ 处垂直于轴线的平面相交，交点处的径向距离为\n$$\nR=L\\tan(2\\theta).\n$$\n此关系源于基本的直角三角形几何：到平面的轴向距离是 $L$，横向偏移是 $R$，且有 $\\tan(2\\theta)=R/L$。\n\n结合这些关系，得到立方晶体中由 $\\{hkl\\}$ 晶面族产生的环半径的通用表达式：\n$$\nR_{hkl}=L\\,\\tan\\!\\Big(2\\,\\arcsin\\!\\Big(\\frac{\\lambda}{2a}\\sqrt{h^{2}+k^{2}+l^{2}}\\Big)\\Big).\n$$\n\n对于体心立方（BCC）晶格，结构因子所施加的选择定则要求只有当 $h+k+l$ 为偶数时才会发生衍射。最小衍射角的环对应于满足 $h+k+l$ 为偶数的最小非零 $\\sqrt{h^{2}+k^{2}+l^{2}}$。$(100)$ 晶面族的 $h^{2}+k^{2}+l^{2}=1$，但 $h+k+l=1$ 是奇数，因此是禁戒的。下一个是 $(110)$ 晶面族，其 $h^{2}+k^{2}+l^{2}=2$ 且 $h+k+l=2$ 是偶数，因此是允许的。因此，第一个可观测到的环来自 $\\{110\\}$ 晶面族。\n\n现在我们使用给定参数 $\\lambda=0.500\\,\\text{\\AA}$，$a=2.8665\\,\\text{\\AA}$ 和 $L=400.0\\,\\text{mm}$ 来数值计算 $R_{110}$。\n\n计算反正弦函数的参数：\n$$\n\\frac{\\lambda}{2a}\\sqrt{h^{2}+k^{2}+l^{2}}=\\frac{0.500}{2\\times 2.8665}\\sqrt{2}.\n$$\n首先，$2a=2\\times 2.8665=5.7330$，所以\n$$\n\\frac{0.500}{5.7330}=0.087207\\ldots\n$$\n然后，$\\sqrt{2}=1.41421356\\ldots$，得到\n$$\n\\frac{\\lambda}{2a}\\sqrt{2}=0.087207\\ldots\\times 1.41421356\\ldots=0.123386\\ldots\n$$\n因此，\n$$\n\\theta=\\arcsin(0.123386\\ldots)\\approx 0.123730\\ldots\\ \\text{rad},\n$$\n所以\n$$\n2\\theta\\approx 0.247460\\ldots\\ \\text{rad},\\quad \\tan(2\\theta)\\approx 0.252431\\ldots\n$$\n最后，\n$$\nR_{110}=L\\tan(2\\theta)=400.0\\times 0.252431\\ldots=100.972\\ldots\n$$\n四舍五入至四位有效数字并以 $\\text{mm}$ 为单位表示，环的半径为 $101.0\\,\\text{mm}$。", "answer": "$$\\boxed{101.0}$$", "id": "2820326"}, {"introduction": "作为一项更高级的挑战，本练习将理论知识转化为计算实践，模拟了劳厄衍射实验。与使用单色光的粉末衍射不同，劳厄法使用多色X射线束照射单晶，从而能够快速测定晶体取向。您需要编写一个程序，通过考虑晶体取向、入射光束几何形状和波长范围，来预测哪些晶面会产生背反射劳厄斑点，这体现了埃瓦尔德球结构在现代计算材料科学中的强大预测能力。[@problem_id:2820258]", "problem": "给定一个立方原胞晶体，其晶格常数 $a$ 以 $\\text{\\AA}$ (埃) 为单位，实验室坐标系中的单位入射束方向 $\\mathbf{s}_0$，一个由 $3\\times 3$ 旋转矩阵 $\\mathbf{R}$ 给出的晶体取向（该矩阵将晶体坐标系矢量映射到实验室坐标系矢量），以及一个多色光束的光谱范围 $[\\lambda_{\\min},\\lambda_{\\max}]$ (单位为 $\\text{\\AA}$)。您必须确定在一个有界搜索集合内，哪些整数 Miller 指数 $(h,k,l)$ 会产生 Laue 背反射，并以列表 $[h,k,l]$ 的形式报告它们。\n\n基本原理与约束条件：\n1. 使用 Laue 几何中的弹性运动学衍射。入射波矢和衍射波矢满足 $\\mathbf{k}' - \\mathbf{k}_0 = \\mathbf{G}$ 和 $\\lvert \\mathbf{k}' \\rvert = \\lvert \\mathbf{k}_0 \\rvert$，其中 $\\mathbf{k}_0 = \\dfrac{2\\pi}{\\lambda}\\mathbf{s}_0$，$\\lambda$ 是波长。\n2. 对于 Miller 指数 $(h,k,l)$，其在晶体坐标系中的倒易点阵矢量为 $\\mathbf{G}_{\\text{crystal}} = h\\mathbf{b}_1 + k\\mathbf{b}_2 + l\\mathbf{b}_3$。对于立方原胞晶格，$\\mathbf{b}_1 = \\dfrac{2\\pi}{a}\\hat{\\mathbf{x}}$，$\\mathbf{b}_2 = \\dfrac{2\\pi}{a}\\hat{\\mathbf{y}}$，$\\mathbf{b}_3 = \\dfrac{2\\pi}{a}\\hat{\\mathbf{z}}$。实验室坐标系中的矢量为 $\\mathbf{G} = \\mathbf{R}\\mathbf{G}_{\\text{crystal}}$。\n3. 弹性条件意味着 Ewald 球条件 $(\\mathbf{k}_0 + \\mathbf{G})\\cdot(\\mathbf{k}_0 + \\mathbf{G}) = \\mathbf{k}_0\\cdot\\mathbf{k}_0$，这产生了一个关联 $\\lambda$ 和 $\\mathbf{G}$ 的标量方程。求解该方程以得到 $\\lambda$，可以确定给定的 $(h,k,l)$ 是否被激发以及所需的波长是多少。\n4. 背反射定义为衍射束射入相对于 $\\mathbf{s}_0$ 的后半球，即 $\\mathbf{s}_0\\cdot \\mathbf{k}' < 0$。\n\n您的程序必须：\n- 枚举所有满足 $-H \\le h,k,l \\le H$ 且 $(h,k,l) \\ne (0,0,0)$ 的整数三元组 $(h,k,l)$。对于每个三元组，计算 $\\mathbf{G}$，然后计算所需的波长 $\\lambda$（如果为正实数），接着检查是否 $\\lambda \\in [\\lambda_{\\min},\\lambda_{\\max}]$。如果是，则使用该 $\\lambda$ 计算 $\\mathbf{k}' = \\mathbf{k}_0 + \\mathbf{G}$，并且当且仅当 $\\mathbf{s}_0\\cdot \\mathbf{k}' < 0$ 时，接受 $(h,k,l)$。\n- 在 $\\mathbb{R}^3$ 中使用欧几里得内積。\n- 所有长度单位均视为 $\\text{\\AA}$，角度通过提供的旋转矩阵隐式处理。入射束方向 $\\mathbf{s}_0$ 必须是单位矢量。\n- 为保证数值稳健性，当 $\\mathbf{s}_0\\cdot \\mathbf{G}$ 在 $10^{-12}$ 的容差范围内为零时，拒绝该情况，因为在此极限下没有有限的 $\\lambda$ 能满足 Ewald 条件。同样，以严格不等式和 $10^{-12}$ 的容差处理背反射检查 $\\mathbf{s}_0\\cdot \\mathbf{k}' < 0$。\n\n您必须实现的推导起点：\n- 弹性散射条件 $\\mathbf{k}'-\\mathbf{k}_0=\\mathbf{G}$ 和 $\\lvert \\mathbf{k}'\\rvert = \\lvert \\mathbf{k}_0\\rvert$。\n- 立方原胞晶格的倒易空间定义。\n\n需要为每个 $(h,k,l)$ 实现的算法步骤：\n- 计算 $\\mathbf{G} = \\mathbf{R}\\left(\\dfrac{2\\pi}{a}[h,k,l]^T\\right)$。\n- 求解由 $(\\mathbf{k}_0+\\mathbf{G})^2=\\mathbf{k}_0^2$ 和 $\\mathbf{k}_0=\\dfrac{2\\pi}{\\lambda}\\mathbf{s}_0$ 暗示的 Ewald 条件以得到 $\\lambda$，如果 $\\mathbf{s}_0\\cdot \\mathbf{G} \\ne 0$，则会得到唯一的 $\\lambda$。\n- 检查 $\\lambda \\in [\\lambda_{\\min},\\lambda_{\\max}]$，然后计算 $\\mathbf{k}'$ 并验证 $\\mathbf{s}_0\\cdot \\mathbf{k}' < 0$。\n\n报告格式：\n- 对于每个测试用例，将接受的 $(h,k,l)$ 作为整数三元组列表 $[h,k,l]$ 输出，并按 $(h,k,l)$ 的升序字典序排序。\n- 最终输出必须为单行，包含一个列表，其中每个元素对应一个测试用例，格式必须完全一致：一个由方括号括起来的逗号分隔列表，其中每个测试用例的结果本身就是一个由 $[h,k,l]$ 项组成的列表（例如：`[[[h1,k1,l1],[h2,k2,l2]],[],[[...]],...]`）。\n\n使用以下测试套件。$a$、$\\lambda_{\\min}$ 和 $\\lambda_{\\max}$ 的单位是 $\\text{\\AA}$。所有情况下，入射方向均为 $\\mathbf{s}_0=[0,0,1]^T$。搜索边界为所列出的 $H$。\n\n- 测试用例 1 (一般情况)：\n  - $a = 3.6$\n  - $\\mathbf{R} = \\begin{bmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{bmatrix}$\n  - $[\\lambda_{\\min},\\lambda_{\\max}] = [0.5, 2.5]$\n  - $H = 3$\n- 测试用例 2 (倾斜晶体)：\n  - $a = 3.6$\n  - $\\mathbf{R} = \\begin{bmatrix} 1  0  0 \\\\ 0  \\cos\\theta  -\\sin\\theta \\\\ 0  \\sin\\theta  \\cos\\theta \\end{bmatrix}$ 其中 $\\theta = 35^\\circ$ 由数值 $\\cos\\theta \\approx 0.8191520442889918$ 和 $\\sin\\theta \\approx 0.5735764363510462$ 表示\n  - $[\\lambda_{\\min},\\lambda_{\\max}] = [0.8, 2.2]$\n  - $H = 3$\n- 测试用例 3 (窄光谱，可能无解)：\n  - $a = 3.6$\n  - $\\mathbf{R} = \\begin{bmatrix} \\cos\\phi  0  \\sin\\phi \\\\ 0  1  0 \\\\ -\\sin\\phi  0  \\cos\\phi \\end{bmatrix}$ 其中 $\\phi = 60^\\circ$ 由数值 $\\cos\\phi = 0.5$ 和 $\\sin\\phi \\approx 0.8660254037844386$ 表示\n  - $[\\lambda_{\\min},\\lambda_{\\max}] = [0.5, 0.6]$\n  - $H = 3$\n- 测试用例 4 (边界波长恰好等于某些反射所需的值)：\n  - $a = 3.6$\n  - $\\mathbf{R} = \\begin{bmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{bmatrix}$\n  - $[\\lambda_{\\min},\\lambda_{\\max}] = [2.4, 2.4]$\n  - $H = 3$\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果，每个条目对应一个测试用例，并且本身是按字典序排列的 $[h,k,l]$ 三元组列表。角度隐含在数值旋转矩阵中；输入不需要角度单位。所有物理量必须以 $\\text{\\AA}$ 为单位处理，且程序不得要求任何用户交互。", "solution": "所述问题是有效的。这是计算材料物理学中一个定义明确的练习，基于成熟的 X 射线运动学衍射理论原理。所有必要的参数都已提供，目标明确。我们将进行严格的推导和算法实现。\n\n该问题要求我们确定，对于给定的晶体结构、取向和多色 X 射线源，哪些由 Miller 指数 $(h,k,l)$ 索引的倒易点阵格点会产生 Laue 背反射。其物理基础是 von Laue 相长干涉条件和弹性散射中的能量守恒。\n\n衍射的基本方程是 Laue 条件，它指出散射波的波矢变化必须等于一个倒易点阵矢量 $\\mathbf{G}$：\n$$ \\mathbf{k}' - \\mathbf{k}_0 = \\mathbf{G} $$\n此处，$\\mathbf{k}_0$ 是入射波矢，$\\mathbf{k}'$ 是衍射波矢。对于弹性散射，光子的能量是守恒的，这意味着其波长 $\\lambda$ 不变，因此其波矢的大小也保持不变：\n$$ |\\mathbf{k}'| = |\\mathbf{k}_0| = \\frac{2\\pi}{\\lambda} $$\n将 $\\mathbf{k}' = \\mathbf{k}_0 + \\mathbf{G}$ 代入弹性散射条件，得到 Ewald 球方程：\n$$ (\\mathbf{k}_0 + \\mathbf{G}) \\cdot (\\mathbf{k}_0 + \\mathbf{G}) = \\mathbf{k}_0 \\cdot \\mathbf{k}_0 $$\n展开点积，我们得到：\n$$ |\\mathbf{k}_0|^2 + 2\\mathbf{k}_0 \\cdot \\mathbf{G} + |\\mathbf{G}|^2 = |\\mathbf{k}_0|^2 $$\n这简化为关于 $\\mathbf{k}_0$ 和 $\\mathbf{G}$ 的一个条件：\n$$ 2\\mathbf{k}_0 \\cdot \\mathbf{G} + |\\mathbf{G}|^2 = 0 $$\n入射波矢 $\\mathbf{k}_0$ 由其方向（单位矢量 $\\mathbf{s}_0$）和波长 $\\lambda$ 定义：$\\mathbf{k}_0 = \\frac{2\\pi}{\\lambda}\\mathbf{s}_0$。将此代入 Ewald 球方程，我们就可以求解出对于给定的倒易点阵矢量 $\\mathbf{G}$，能够激发一个衍射斑的特定波长 $\\lambda$：\n$$ 2\\left(\\frac{2\\pi}{\\lambda}\\mathbf{s}_0\\right) \\cdot \\mathbf{G} + |\\mathbf{G}|^2 = 0 $$\n$$ \\frac{4\\pi}{\\lambda}(\\mathbf{s}_0 \\cdot \\mathbf{G}) = -|\\mathbf{G}|^2 $$\n求解 $\\lambda$ 可得：\n$$ \\lambda = -\\frac{4\\pi(\\mathbf{s}_0 \\cdot \\mathbf{G})}{|\\mathbf{G}|^2} $$\n为了得到一个有物理意义的解，波长 $\\lambda$ 必须是正实数。由于 $|\\mathbf{G}|^2$ 总是非负的（对于 $(h,k,l) \\neq (0,0,0)$ 严格为正），这意味着我们必须有 $\\mathbf{s}_0 \\cdot \\mathbf{G}  0$。问题还要求我们拒绝 $\\mathbf{s}_0 \\cdot \\mathbf{G}$ 在数值上接近于零的情况，具体来说是 $|\\mathbf{s}_0 \\cdot \\mathbf{G}| \\le 10^{-12}$，以避免除以一个很小的数。\n\n倒易点阵矢量 $\\mathbf{G}$ 取决于 Miller 指数 $(h,k,l)$、晶体结构及其取向。对于给定的晶格常数为 $a$ 的立方原胞晶格，其晶体坐标系中的倒易点阵基矢为 $\\mathbf{b}_1 = \\frac{2\\pi}{a}\\hat{\\mathbf{x}}$、$\\mathbf{b}_2 = \\frac{2\\pi}{a}\\hat{\\mathbf{y}}$ 和 $\\mathbf{b}_3 = \\frac{2\\pi}{a}\\hat{\\mathbf{z}}$。指数为 $(h,k,l)$ 的倒易点阵矢量在晶体坐标系中表示为：\n$$ \\mathbf{G}_{\\text{crystal}} = h\\mathbf{b}_1 + k\\mathbf{b}_2 + l\\mathbf{b}_3 = \\frac{2\\pi}{a} \\begin{pmatrix} h \\\\ k \\\\ l \\end{pmatrix} $$\n为了在实验室坐标系中找到该矢量，我们应用所提供的旋转矩阵 $\\mathbf{R}$：\n$$ \\mathbf{G} = \\mathbf{R} \\mathbf{G}_{\\text{crystal}} = \\frac{2\\pi}{a} \\mathbf{R} \\begin{pmatrix} h \\\\ k \\\\ l \\end{pmatrix} $$\n$\\mathbf{G}$ 的模平方为 $|\\mathbf{G}|^2 = \\mathbf{G} \\cdot \\mathbf{G}$。由于 $\\mathbf{R}$ 是一个旋转矩阵，它是正交的（$\\mathbf{R}^T\\mathbf{R} = \\mathbf{I}$），因此它保持矢量长度不变。所以，$|\\mathbf{G}|^2 = |\\mathbf{G}_{\\text{crystal}}|^2 = (\\frac{2\\pi}{a})^2(h^2+k^2+l^2)$。\n\n最后一个条件是背反射。衍射束必须射入与入射束方向 $\\mathbf{s}_0$ 相反的半球。在数学上，这表示为：\n$$ \\mathbf{s}_0 \\cdot \\mathbf{k}'  0 $$\n使用 $\\mathbf{k}' = \\mathbf{k}_0 + \\mathbf{G} = \\frac{2\\pi}{\\lambda}\\mathbf{s}_0 + \\mathbf{G}$ 以及 $\\mathbf{s}_0$ 是单位矢量（$|\\mathbf{s}_0|=1$）这一事实，该条件变为：\n$$ \\mathbf{s}_0 \\cdot \\left(\\frac{2\\pi}{\\lambda}\\mathbf{s}_0 + \\mathbf{G}\\right) = \\frac{2\\pi}{\\lambda}(\\mathbf{s}_0 \\cdot \\mathbf{s}_0) + \\mathbf{s}_0 \\cdot \\mathbf{G} = \\frac{2\\pi}{\\lambda} + \\mathbf{s}_0 \\cdot \\mathbf{G}  0 $$\n这个不等式必须使用 $10^{-12}$ 的数值容差进行检查，即 $\\frac{2\\pi}{\\lambda} + \\mathbf{s}_0 \\cdot \\mathbf{G}  -10^{-12}$。\n\n每个测试用例的完整算法如下：\n1. 为有效的 Miller 指数初始化一个空列表。\n2. 遍历所有满足 $h,k,l \\in [-H, H]$ 的整数三元组 $(h,k,l)$，排除平凡情况 $(0,0,0)$。\n3. 对于每个三元组 $(h,k,l)$，构造矢量 $\\mathbf{g}_{hkl} = [h,k,l]^T$。\n4. 计算实验室坐标系中的倒易点阵矢量：$\\mathbf{G} = \\frac{2\\pi}{a} \\mathbf{R}\\mathbf{g}_{hkl}$。\n5. 计算点积 $S_G = \\mathbf{s}_0 \\cdot \\mathbf{G}$。\n6. 验证 $|S_G| > 10^{-12}$。如果不满足，则拒绝此三元组。\n7. 计算模的平方 $G2 = \\mathbf{G} \\cdot \\mathbf{G}$。\n8. 计算所需波长 $\\lambda = -4\\pi S_G / G2$。\n9. 检查此波长是否在指定的光谱范围内：$\\lambda \\in [\\lambda_{\\min}, \\lambda_{\\max}]$。请注意，要使 $\\lambda$ 为正，隐含要求 $S_G  0$。\n10. 如果波长在范围内，检查背反射条件：$\\frac{2\\pi}{\\lambda} + S_G  -10^{-12}$。\n11. 如果所有条件都满足，则三元组 $(h,k,l)$ 是一个有效的背反射，并将其添加到列表中。\n12. 检查完所有三元组后，按字典序对有效指数列表进行排序。\n此过程应用于每个测试用例，以生成最终结果。", "answer": "```python\n[[[-3,-3,-3],[-3,-2,-3],[-3,-1,-3],[-3,0,-3],[-3,1,-3],[-3,2,-3],[-3,3,-3],[-2,-3,-3],[-2,-2,-3],[-2,-1,-3],[-2,0,-3],[-2,1,-3],[-2,2,-3],[-2,3,-3],[-1,-3,-3],[-1,-2,-3],[-1,-1,-3],[-1,0,-3],[-1,1,-3],[-1,2,-3],[-1,3,-3],[0,-3,-3],[0,-2,-3],[0,-1,-3],[0,0,-3],[0,1,-3],[0,2,-3],[0,3,-3],[1,-3,-3],[1,-2,-3],[1,-1,-3],[1,0,-3],[1,1,-3],[1,2,-3],[1,3,-3],[2,-3,-3],[2,-2,-3],[2,-1,-3],[2,0,-3],[2,1,-3],[2,2,-3],[2,3,-3],[3,-3,-3],[3,-2,-3],[3,-1,-3],[3,0,-3],[3,1,-3],[3,2,-3],[3,3,-3],[-3,-3,-2],[-3,-2,-2],[-3,-1,-2],[-3,0,-2],[-3,1,-2],[-3,2,-2],[-3,3,-2],[-2,-3,-2],[-2,-2,-2],[-2,-1,-2],[-2,0,-2],[-2,1,-2],[-2,2,-2],[-2,3,-2],[-1,-3,-2],[-1,-2,-2],[-1,-1,-2],[-1,0,-2],[-1,1,-2],[-1,2,-2],[-1,3,-2],[0,-3,-2],[0,-2,-2],[0,-1,-2],[0,0,-2],[0,1,-2],[0,2,-2],[0,3,-2],[1,-3,-2],[1,-2,-2],[1,-1,-2],[1,0,-2],[1,1,-2],[1,2,-2],[1,3,-2],[2,-3,-2],[2,-2,-2],[2,-1,-2],[2,0,-2],[2,1,-2],[2,2,-2],[2,3,-2],[3,-3,-2],[3,-2,-2],[3,-1,-2],[3,0,-2],[3,1,-2],[3,2,-2],[3,3,-2],[-3,-2,-1],[-3,-1,-1],[-3,0,-1],[-3,1,-1],[-3,2,-1],[-2,-3,-1],[-2,-2,-1],[-2,-1,-1],[-2,0,-1],[-2,1,-1],[-2,2,-1],[-2,3,-1],[-1,-3,-1],[-1,-2,-1],[-1,-1,-1],[-1,0,-1],[-1,1,-1],[-1,2,-1],[-1,3,-1],[0,-3,-1],[0,-2,-1],[0,-1,-1],[0,0,-1],[0,1,-1],[0,2,-1],[0,3,-1],[1,-3,-1],[1,-2,-1],[1,-1,-1],[1,0,-1],[1,1,-1],[1,2,-1],[1,3,-1],[2,-3,-1],[2,-2,-1],[2,-1,-1],[2,0,-1],[2,1,-1],[2,2,-1],[2,3,-1],[3,-2,-1],[3,-1,-1],[3,0,-1],[3,1,-1],[3,2,-1]],[[[-3,-3,-3],[-3,-2,-3],[-3,-1,-3],[-3,0,-3],[-3,1,-3],[-3,2,-3],[-3,3,-3],[-2,-3,-3],[-2,-2,-3],[-2,-1,-3],[-2,0,-3],[-2,1,-3],[-2,2,-3],[-2,3,-3],[-1,-3,-3],[-1,-2,-3],[-1,-1,-3],[-1,0,-3],[-1,1,-3],[-1,2,-3],[-1,3,-3],[0,-3,-3],[0,-2,-3],[0,-1,-3],[0,0,-3],[0,1,-3],[0,2,-3],[0,3,-3],[1,-3,-3],[1,-2,-3],[1,-1,-3],[1,0,-3],[1,1,-3],[1,2,-3],[1,3,-3],[2,-3,-3],[2,-2,-3],[-2,-3,-2],[-2,-2,-2],[-2,-1,-2],[-2,0,-2],[-2,1,-2],[-2,2,-2],[-2,3,-2],[-1,-3,-2],[-1,-2,-2],[-1,-1,-2],[-1,0,-2],[-1,1,-2],[-1,2,-2],[-1,3,-2],[0,-3,-2],[0,-2,-2],[0,-1,-2],[0,0,-2],[0,1,-2],[0,2,-2],[0,3,-2],[1,-3,-2],[1,-2,-2],[1,-1,-2],[1,0,-2],[1,1,-2],[1,2,-2],[1,3,-2],[2,-3,-2],[2,-2,-2],[-2,-3,-1],[-2,-2,-1],[-2,-1,-1],[-2,0,-1],[-2,1,-1],[-2,2,-1],[-2,3,-1],[-1,-3,-1],[-1,-2,-1],[-1,-1,-1],[-1,0,-1],[-1,1,-1],[-1,2,-1],[-1,3,-1],[0,-3,-1],[0,-2,-1],[0,-1,-1],[0,0,-1],[0,1,-1],[0,2,-1]]],[],[[[0,0,-3]]]]\n```", "id": "2820258"}]}