{"hands_on_practices": [{"introduction": "STM图像并非表面形貌的简单快照，它实际上是一张恒定隧穿电流的等高线图，其中融合了样品的真实几何高度和电子局域态密度 (LDOS) 的信息。本练习将指导您从Tersoff–Hamann近似的基本原理出发，建立一个模型来量化电子态特征（如一个共振峰）如何在形貌图中表现为“凸起”，并学习如何将这种电子贡献与真实的几何高度分离开来 [@problem_id:2856463]。这项实践对于正确解读STM图像至关重要。", "problem": "考虑一台在恒流模式下运行的扫描隧道显微镜（STM），其扫描的样品在能量 $E_0$ 处具有局域态密度（LDOS）特征。在Tersoff–Hamann近似下，针尖-样品间距为 $z$、样品偏压为 $V$ 时的隧道电流满足 $I(z,V) \\propto \\exp(-2 \\kappa z) \\int_{0}^{e V} \\rho_s(E)\\, dE$，其中 $\\kappa = \\sqrt{2 m \\phi}/\\hbar$，$m$ 是电子质量，$\\phi$ 是有效隧穿势垒高度，$\\hbar$ 是约化普朗克常数。假设针尖为金属材质，在相关偏压窗口内其态密度和透射率与能量无关。在恒流形貌测量中，反馈回路调节 $z$，使得在每个横向位置上 $I(z,V)$ 都等于一个固定的设定值。\n\n两个横向位置（标记为 $A$ 和 $B$）除了已知的真实高度差 $\\Delta z_\\mathrm{true}$ 外，具有相同的几何形貌，它们的电子结构仅在样品LDOS上有所不同。具体来说，LDOS（单位为 $\\mathrm{eV}^{-1}$）的模型如下：\n- 在位置 $A$：$\\rho_A(E) = \\rho_0$，对于 $E \\ge 0$。\n- 在位置 $B$：$\\rho_B(E) = \\rho_0 + A_p \\exp\\!\\left( -\\dfrac{(E - E_0)^2}{2 \\sigma^2} \\right)$，对于 $E \\ge 0$。\n\n此处，$E$ 和 $E_0$ 是相对于费米能级测量的，$V  0$ 是样品偏压，因此积分范围从 $E = 0$ 到 $E = e V$。\n\n任务：\n1. 仅从隧穿概率的指数距离依赖关系和Tersoff–Hamann近似中隧道电流的定义出发，推导在偏压 $V$ 下通过恒流成像测量的位置 $B$ 和 $A$ 之间的表观高度差 $\\Delta z_\\mathrm{app}(V)$ 的表达式。将 $\\Delta z_\\mathrm{app}(V)$ 分解为真实几何高度差 $\\Delta z_\\mathrm{true}$ 和一个通过能量积分依赖于LDOS的电子贡献 $\\Delta z_\\mathrm{el}(V)$ 的和。\n2. 实现该模型，以计算当偏压 $V$ 扫过 $E_0$ 处的LDOS特征时 $\\Delta z_\\mathrm{app}(V)$ 的偏压依赖性，并明确量化 $\\Delta z_\\mathrm{el}(V)$。\n3. 使用以下国际单位制（SI）中的物理常数：电子质量 $m = 9.10938356 \\times 10^{-31}\\,\\mathrm{kg}$，约化普朗克常数 $\\hbar = 1.054571817 \\times 10^{-34}\\,\\mathrm{J \\cdot s}$，元电荷 $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$。在计算 $\\kappa = \\sqrt{2 m \\phi}/\\hbar$ 时，将势垒高度 $\\phi$ 从 $\\mathrm{eV}$ 转换为 $\\mathrm{J}$。\n4. 对于下方的每个测试用例，计算并报告针对指定偏压值的两个列表：表观高度列表 $\\left[\\Delta z_\\mathrm{app}(V_i)\\right]$ 和纯电子贡献列表 $\\left[\\Delta z_\\mathrm{el}(V_i)\\right]$。所有高度均以皮米为单位表示，并将每个浮点数四舍五入到三位小数。\n\n测试套件（每个用例指定 $\\rho_0$、$A_p$、$E_0$（单位 $\\mathrm{eV}$）、$\\sigma$（单位 $\\mathrm{eV}$）、$\\Delta z_\\mathrm{true}$（单位 $\\mathrm{pm}$）、$\\phi$（单位 $\\mathrm{eV}$）以及 $V_\\mathrm{set}$ 值列表（单位 $\\mathrm{V}$））:\n- 用例1（跨越特征的正常路径）：$\\rho_0 = 1.0$, $A_p = 2.0$, $E_0 = 0.30$, $\\sigma = 0.05$, $\\Delta z_\\mathrm{true} = 50.0$, $\\phi = 4.5$, 偏压 $V_\\mathrm{set} \\in \\{0.10, 0.30, 0.60\\}$。\n- 用例2（尖锐强特征；纯电子衬度）：$\\rho_0 = 1.0$, $A_p = 5.0$, $E_0 = 0.20$, $\\sigma = 0.01$, $\\Delta z_\\mathrm{true} = 0.0$, $\\phi = 4.5$, 偏压 $V_\\mathrm{set} \\in \\{0.15, 0.20, 0.25\\}$。\n- 用例3（无特征；纯形貌）：$\\rho_0 = 1.0$, $A_p = 0.0$, $E_0 = 0.30$, $\\sigma = 0.05$, $\\Delta z_\\mathrm{true} = 200.0$, $\\phi = 4.5$, 偏压 $V_\\mathrm{set} \\in \\{0.10, 0.40\\}$。\n\n您的程序必须：\n- 在不使用任何外部输入的情况下，实现上述物理过程。\n- 对于每个用例，计算两个列表 $\\left[\\Delta z_\\mathrm{app}(V_i)\\right]$ 和 $\\left[\\Delta z_\\mathrm{el}(V_i)\\right]$（单位为皮米），并四舍五入到三位小数。\n- 生成单行输出，其中包含每个用例的结果列表，每个用例的结果是按 $\\left[\\left[\\Delta z_\\mathrm{app}(V_i)\\right], \\left[\\Delta z_\\mathrm{el}(V_i)\\right]\\right]$ 顺序排列的包含两个列表的列表。例如，一个有效的输出结构形式为 $\\left[ \\left[ [\\cdots], [\\cdots] \\right], \\left[ [\\cdots], [\\cdots] \\right], \\left[ [\\cdots], [\\cdots] \\right] \\right]$。", "solution": "所述问题在科学上是合理的、表述清晰的，并包含得出唯一解所需的所有信息。这是Tersoff–Hamann模型在扫描隧道显微镜（STM）中的一个标准应用，该模型是理论表面科学的基石。我们将首先进行形式推导，然后实现所得模型。\n\n本分析的基础是在Tersoff–Hamann近似下，隧道电流 $I$ 作为针尖-样品间距 $z$ 和样品偏压 $V$ 的函数的表达式：\n$$\nI(z, V) = C \\exp(-2 \\kappa z) \\int_{0}^{e V} \\rho_s(E) dE\n$$\n此处，$C$ 是一个比例常数，它依赖于针尖的电子结构（假定为常数）及其他因素，$\\rho_s(E)$ 是样品的局域态密度（LDOS），而 $\\kappa = \\sqrt{2 m \\phi}/\\hbar$ 是由电子质量 $m$、有效隧穿势垒高度 $\\phi$ 和约化普朗克常数 $\\hbar$ 决定的真空衰减常数。所有能量 $E$ 均从样品的费米能级开始测量。\n\n在恒流模式下，一个反馈回路通过在每个横向位置 $(x, y)$ 调整针尖高度 $z$ 来维持一个固定的设定点电流 $I_{\\text{set}}$。考虑两个横向位置 $A$ 和 $B$。设在偏压 $V$ 下，它们各自测得的针尖-样品间距分别为 $z_A(V)$ 和 $z_B(V)$。恒流条件意味着：\n$$\nI_{\\text{set}} = C \\exp(-2 \\kappa z_A(V)) \\int_{0}^{e V} \\rho_A(E) dE\n$$\n$$\nI_{\\text{set}} = C \\exp(-2 \\kappa z_B(V)) \\int_{0}^{e V} \\rho_B(E) dE\n$$\n将这两个表达式相等并消去常数 $C$ 可得：\n$$\n\\exp(-2 \\kappa z_A(V)) \\int_{0}^{e V} \\rho_A(E) dE = \\exp(-2 \\kappa z_B(V)) \\int_{0}^{e V} \\rho_B(E) dE\n$$\n重新整理以分离出与高度差相关的项，我们得到：\n$$\n\\exp(2 \\kappa [z_B(V) - z_A(V)]) = \\frac{\\int_{0}^{e V} \\rho_B(E) dE}{\\int_{0}^{e V} \\rho_A(E) dE}\n$$\n对两边取自然对数，并求解针尖-样品间距之差，可得：\n$$\nz_B(V) - z_A(V) = \\frac{1}{2 \\kappa} \\ln\\left( \\frac{\\int_{0}^{e V} \\rho_B(E) dE}{\\int_{0}^{e V} \\rho_A(E) dE} \\right)\n$$\nSTM测量的表面表观高度 $z_{\\text{app}}$ 是针尖的垂直位置。如果样品在位置 $A$ 和 $B$ 的真实几何高度分别为 $h_A$ 和 $h_B$，那么针尖的垂直位置由 $z_{\\text{tip}} = h_{\\text{surface}} + z_{\\text{separation}}$ 给出。因此，表观高度差为：\n$$\n\\Delta z_{\\text{app}}(V) = z_{\\text{tip}, B}(V) - z_{\\text{tip}, A}(V) = [h_B + z_B(V)] - [h_A + z_A(V)] = (h_B - h_A) + (z_B(V) - z_A(V))\n$$\n我们将 $(h_B - h_A)$ 识别为真实几何高度差 $\\Delta z_{\\text{true}}$。表观高度差的表达式变为：\n$$\n\\Delta z_{\\text{app}}(V) = \\Delta z_{\\text{true}} + \\frac{1}{2 \\kappa} \\ln\\left( \\frac{\\int_{0}^{e V} \\rho_B(E) dE}{\\int_{0}^{e V} \\rho_A(E) dE} \\right)\n$$\n这个结果的形式为 $\\Delta z_{\\text{app}}(V) = \\Delta z_{\\text{true}} + \\Delta z_{\\mathrm{el}}(V)$，其中对表观高度的电子贡献为：\n$$\n\\Delta z_{\\mathrm{el}}(V) = \\frac{1}{2 \\kappa} \\ln\\left( \\frac{\\int_{0}^{e V} \\rho_B(E) dE}{\\int_{0}^{e V} \\rho_A(E) dE} \\right)\n$$\n这完成了推导的第一项任务。\n\n接下来，我们为指定的LDOS模型计算积分。能量参数和LDOS的单位分别是 $\\mathrm{eV}$ 和 $\\mathrm{eV}^{-1}$，因此我们将积分变量 $E$ 解释为以电子伏特（$\\mathrm{eV}$）为单位的能量，并将积分上限 $e V$ 解释为以伏特为单位的偏压 $V$ 的数值。\n对于位置 $A$，$\\rho_A(E) = \\rho_0$：\n$$\n\\int_0^V \\rho_A(E) dE = \\int_0^V \\rho_0 dE = \\rho_0 V\n$$\n对于位置 $B$，$\\rho_B(E) = \\rho_0 + A_p \\exp\\left( -\\frac{(E - E_0)^2}{2 \\sigma^2} \\right)$：\n$$\n\\int_0^V \\rho_B(E) dE = \\int_0^V \\rho_0 dE + A_p \\int_0^V \\exp\\left( -\\frac{(E - E_0)^2}{2 \\sigma^2} \\right) dE\n$$\n第二个积分与误差函数 $\\mathrm{erf}(x) = \\frac{2}{\\sqrt{\\pi}} \\int_0^x e^{-t^2} dt$ 相关。通过变量代换 $t = (E - E_0)/(\\sigma\\sqrt{2})$，该积分变为：\n$$\n\\int_0^V \\exp\\left( -\\frac{(E - E_0)^2}{2 \\sigma^2} \\right) dE = \\sigma\\sqrt{\\frac{\\pi}{2}} \\left[ \\mathrm{erf}\\left(\\frac{V - E_0}{\\sigma\\sqrt{2}}\\right) - \\mathrm{erf}\\left(\\frac{-E_0}{\\sigma\\sqrt{2}}\\right) \\right]\n$$\n利用 $\\mathrm{erf}(-x) = -\\mathrm{erf}(x)$ 的性质，上式简化为：\n$$\n\\sigma\\sqrt{\\frac{\\pi}{2}} \\left[ \\mathrm{erf}\\left(\\frac{V - E_0}{\\sigma\\sqrt{2}}\\right) + \\mathrm{erf}\\left(\\frac{E_0}{\\sigma\\sqrt{2}}\\right) \\right]\n$$\n将这些积分计算结果代入 $\\Delta z_{\\mathrm{el}}(V)$ 的表达式中：\n$$\n\\Delta z_{\\mathrm{el}}(V) = \\frac{1}{2 \\kappa} \\ln\\left( \\frac{\\rho_0 V + A_p \\sigma\\sqrt{\\frac{\\pi}{2}} \\left[ \\mathrm{erf}\\left(\\frac{V - E_0}{\\sigma\\sqrt{2}}\\right) + \\mathrm{erf}\\left(\\frac{E_0}{\\sigma\\sqrt{2}}\\right) \\right]}{\\rho_0 V} \\right)\n$$\n$$\n\\Delta z_{\\mathrm{el}}(V) = \\frac{1}{2 \\kappa} \\ln\\left( 1 + \\frac{A_p \\sigma}{\\rho_0 V} \\sqrt{\\frac{\\pi}{2}} \\left[ \\mathrm{erf}\\left(\\frac{V - E_0}{\\sigma\\sqrt{2}}\\right) + \\mathrm{erf}\\left(\\frac{E_0}{\\sigma\\sqrt{2}}\\right) \\right] \\right)\n$$\n为了计算数值，$\\kappa$ 公式中的所有量都必须使用国际单位制（SI）。给定的势垒高度 $\\phi$（单位为 $\\mathrm{eV}$）必须通过乘以元电荷 $e$ 转换为焦耳。得到的 $\\kappa$ 的单位将是 $\\mathrm{m}^{-1}$。因此，因子 $1/(2\\kappa)$ 的单位将是米。为了以皮米（$\\mathrm{pm}$）为单位表示最终的高度，此因子需乘以 $10^{12}$。对数内的量（$V, E_0, \\sigma, A_p, \\rho_0$）使用其给定单位，因为它们构成一个无量纲组合。\n\n计算实现将按以下步骤进行：\n1. 定义国际单位制（SI）中的物理常数 $m, \\hbar, e$。\n2. 对于每个测试用例，使用指定的势垒高度 $\\phi$ 计算常数 $\\kappa$。\n3. 计算预因子 $1/(2\\kappa)$ 并将其单位转换为 $\\mathrm{pm}$。\n4. 对于给定测试用例中的每个指定偏压 $V$：\n    a. 使用推导出的公式计算 $\\Delta z_{\\mathrm{el}}(V)$，这需要计算 $\\mathrm{erf}$ 函数。\n    b. 计算 $\\Delta z_{\\mathrm{app}}(V) = \\Delta z_{\\mathrm{true}} + \\Delta z_{\\mathrm{el}}(V)$，确保 $\\Delta z_{\\mathrm{true}}$ 的单位是 pm。\n5. 收集计算出的 $\\Delta z_{\\mathrm{app}}(V_i)$ 和 $\\Delta z_{\\mathrm{el}}(V_i)$ 列表，将数值四舍五入到三位小数，并根据指定结构格式化输出。\n\n这一系统性步骤确保了基于凝聚态物理基本原理的正确且可复现的解。", "answer": "```python\nimport numpy as np\nfrom scipy.special import erf\n\ndef solve():\n    \"\"\"\n    Main function to solve the STM problem for all test cases.\n    It orchestrates the calculation and formats the final output.\n    \"\"\"\n    # Physical constants in SI units\n    M_E = 9.10938356e-31  # Electron mass (kg)\n    HBAR = 1.054571817e-34  # Reduced Planck constant (J*s)\n    E_CHARGE = 1.602176634e-19  # Elementary charge (C or J/eV)\n\n    # Test cases defined in the problem statement\n    test_cases = [\n        # Case 1: Happy path across the feature\n        # (rho0, Ap, E0_eV, sigma_eV, dz_true_pm, phi_eV, V_set_V)\n        (1.0, 2.0, 0.30, 0.05, 50.0, 4.5, [0.10, 0.30, 0.60]),\n        # Case 2: Sharp, strong feature; pure electronic contrast\n        (1.0, 5.0, 0.20, 0.01, 0.0, 4.5, [0.15, 0.20, 0.25]),\n        # Case 3: No feature; purely topographic\n        (1.0, 0.0, 0.30, 0.05, 200.0, 4.5, [0.10, 0.40]),\n    ]\n\n    all_results_str = []\n    for case in test_cases:\n        rho0, ap, e0, sigma, dz_true, phi, v_set = case\n        \n        # Calculate kappa in SI units (m^-1)\n        phi_joules = phi * E_CHARGE\n        kappa = np.sqrt(2 * M_E * phi_joules) / HBAR\n        \n        # Pre-factor for z_el calculation, converted to picometers\n        z_el_prefactor_pm = 1e12 / (2 * kappa)\n        \n        dz_app_list = []\n        dz_el_list = []\n        \n        for v_bias in v_set:\n            if v_bias == 0:\n                # Handle the case V=0, where electronic contribution is zero\n                dz_el = 0.0\n            elif ap == 0:\n                # If there is no electronic feature, a_p=0, contribution is zero\n                dz_el = 0.0\n            else:\n                # Calculate the argument of the logarithm\n                erf_arg1 = (v_bias - e0) / (sigma * np.sqrt(2))\n                erf_arg2 = e0 / (sigma * np.sqrt(2))\n                erf_term = erf(erf_arg1) + erf(erf_arg2)\n                \n                log_argument_term = (ap * sigma / (rho0 * v_bias)) * np.sqrt(np.pi / 2) * erf_term\n                \n                # Calculate the electronic contribution to height\n                dz_el = z_el_prefactor_pm * np.log(1 + log_argument_term)\n            \n            # Apparent height is the sum of true and electronic contributions\n            dz_app = dz_true + dz_el\n            \n            dz_app_list.append(dz_app)\n            dz_el_list.append(dz_el)\n\n        # Format the results for this case into the required string structure\n        str_dz_app = f\"[{','.join(f'{z:.3f}' for z in dz_app_list)}]\"\n        str_dz_el = f\"[{','.join(f'{z:.3f}' for z in dz_el_list)}]\"\n        case_result_str = f\"[{str_dz_app},{str_dz_el}]\"\n        all_results_str.append(case_result_str)\n\n    # Print the final output in the required single-line format\n    print(f\"[{','.join(all_results_str)}]\")\n\nsolve()\n```", "id": "2856463"}, {"introduction": "在掌握了成像原理之后，我们转向谱学分析。在采集微分电导谱 ($dI/dV$ 谱) 时，测量结果会受到用于固定探针位置的“设定点”（即电压 $V_{s}$ 和电流 $I_{s}$）的归一化影响。本练习将演示不同的设定点如何重新缩放测得的光谱，从而可能扭曲谱学特征的表观强度 [@problem_id:2856453]。通过模拟这一“设定点效应”，您将学会如何在定量分析STS数据时对其进行考量，这是确保数据可比性的关键一步。", "problem": "编写一个完整的程序，使用适用于扫描隧道显微镜（STM）的第一性原理关系，模拟扫描隧道谱（STS）中微分电导峰值振幅由设定点引起的变化。从以下基本依据出发：在 Tersoff–Hamann 近似中，当针尖-样品间距为 $z$ 且样品偏压为 $V$ 时，对于正的 $V$，隧穿电流可写为 $I(V,z) \\propto e^{-2\\kappa z} \\int_{0}^{V} \\rho_{s}(E)\\,\\mathrm{d}E$，其中 $\\rho_{s}(E)$ 是样品局域态密度（LDOS），微分电导满足 $\\,\\mathrm{d}I/\\mathrm{d}V \\propto \\rho_{s}(V)\\,e^{-2\\kappa z}$。一个谱学设定点由一对 $(V_{s}, I_{s})$ 定义，通过反馈调节 $z_{s}$ 来施加 $I(V_{s}, z_{s}) = I_{s}$。假设针尖态密度恒定，真空势垒固定，从而使得 $\\kappa$ 与 $V$ 无关。共振被建模为一个叠加在平坦背景上的窄洛伦兹峰，\n$$\n\\rho_{s}(E) = \\rho_{0} + \\frac{A_{L}\\,\\Gamma^{2}}{(E - E_{r})^{2} + \\Gamma^{2}},\n$$\n其中平坦背景 $\\rho_{0}  0$，中心能量 $E_{r}  0$，半峰半宽 $\\Gamma  0$，以及洛伦兹峰高 $A_{L}  0$。在整个问题中，将 $E$ 和 $V$ 的单位视为电子伏特（$\\mathrm{eV}$），并假设 $V \\ge 0$。您的任务是，对于每个给定的参数集，模拟在两个不同设定点 $(V_{s1}, I_{s1})$ 和 $(V_{s2}, I_{s2})$ 下测量时，$\\mathrm{d}I/\\mathrm{d}V$ 在 $V = E_{r}$ 处的峰值振幅之比。程序必须仅根据上述基本定义计算此比率，不得引入任何额外的唯象理论。\n\n数学上和算法上：\n- 从所述的基本依据推导出谱学设定点 $(V_{s}, I_{s})$ 如何归一化测得的 $\\mathrm{d}I/\\mathrm{d}V(V)$。\n- 使用所述的 LDOS 模型精确计算所有需要的能量积分，不使用数值积分，从而使结果明确，并且对于窄的 $\\Gamma$ 值是稳健的。\n- 对每种情况，计算无量纲比率 $R = \\left[\\left.\\mathrm{d}I/\\mathrm{d}V\\right|_{V=E_{r}}\\right]_{\\text{setpoint }2} \\big/ \\left[\\left.\\mathrm{d}I/\\mathrm{d}V\\right|_{V=E_{r}}\\right]_{\\text{setpoint }1}$。\n\n使用以下测试套件。每个测试用例提供 $(\\rho_{0}, A_{L}, \\Gamma, E_{r}; V_{s1}, I_{s1}; V_{s2}, I_{s2})$，能量单位为 $\\mathrm{eV}$，电流单位为安培。程序必须为每个测试用例生成一个结果 $R$（一个浮点数）。\n\n- 测试用例 1（一般“理想情况”，一个设定点在共振下方，一个在共振上方）：\n  - $\\rho_{0} = 1.0$, $A_{L} = 8.0$, $\\Gamma = 0.005$, $E_{r} = 0.200$。\n  - $(V_{s1}, I_{s1}) = (0.100, 1.0\\times 10^{-9})$，$(V_{s2}, I_{s2}) = (0.300, 1.0\\times 10^{-9})$。\n\n- 测试用例 2（相同的偏压设定点，不同的电流，用于隔离电流缩放效应）：\n  - $\\rho_{0} = 1.0$, $A_{L} = 10.0$, $\\Gamma = 0.010$, $E_{r} = 0.200$。\n  - $(V_{s1}, I_{s1}) = (0.250, 0.5\\times 10^{-9})$，$(V_{s2}, I_{s2}) = (0.250, 1.0\\times 10^{-9})$。\n\n- 测试用例 3（设定点恰好在共振能量处，不同电流）：\n  - $\\rho_{0} = 0.8$, $A_{L} = 6.0$, $\\Gamma = 0.004$, $E_{r} = 0.200$。\n  - $(V_{s1}, I_{s1}) = (0.200, 1.0\\times 10^{-9})$，$(V_{s2}, I_{s2}) = (0.200, 0.8\\times 10^{-9})$。\n\n- 测试用例 4（非常窄的共振，一个设定点在下方，一个在上方，以探测强烈的设定点效应）：\n  - $\\rho_{0} = 1.2$, $A_{L} = 12.0$, $\\Gamma = 0.001$, $E_{r} = 0.020$。\n  - $(V_{s1}, I_{s1}) = (0.050, 1.0\\times 10^{-9})$，$(V_{s2}, I_{s2}) = (0.015, 1.0\\times 10^{-9})$。\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含四个比率的结果，按测试用例的顺序排列，用逗号分隔，并用方括号括起来，例如 $[r_{1},r_{2},r_{3},r_{4}]$。条目必须是浮点数。由于所要求的输出是纯比率，因此不需要物理单位（无量纲）。", "solution": "所述问题在科学上是合理的，在数学上是适定的。它基于扫描隧道显微镜（STM）的标准 Tersoff-Hamann 近似，这是该领域的基石。局域态密度（LDOS）由一个物理上合理的函数建模，即一个位于恒定背景上的洛伦兹共振。所有参数都已定义，目标明确。因此，我们可以进行严格的推导。\n\n在样品偏压为 $V$ 和针尖-样品间距为 $z$ 时，隧穿电流 $I$ 的基本关系式为：\n$$\nI(V,z) = C_{0} e^{-2\\kappa z} \\int_{0}^{V} \\rho_{s}(E)\\,\\mathrm{d}E\n$$\n其中 $\\rho_{s}(E)$ 是样品 LDOS，$\\kappa$ 是电子波函数在真空势垒中的逆衰减长度，$C_{0}$ 是一个包含了仪器因素和基本常数的比例常数。我们假设 $V \\ge 0$。\n\n微分电导 $\\mathrm{d}I/\\mathrm{d}V$ 是通过对 $I(V,z)$ 的表达式应用莱布尼茨积分法则得到的：\n$$\n\\frac{\\mathrm{d}I}{\\mathrm{d}V}(V,z) = \\frac{\\mathrm{d}}{\\mathrm{d}V} \\left( C_{0} e^{-2\\kappa z} \\int_{0}^{V} \\rho_{s}(E)\\,\\mathrm{d}E \\right) = C_{0} e^{-2\\kappa z} \\rho_{s}(V)\n$$\n这证实了问题中所述的比例关系 $\\mathrm{d}I/\\mathrm{d}V \\propto \\rho_{s}(V)\\,e^{-2\\kappa z}$。\n\n在扫描隧道谱（STS）中，谱是在固定的针尖位置上采集的。这个位置 $z_{s}$ 是由反馈回路根据设定点条件 $(V_{s}, I_{s})$ 建立的，该条件要求 $I(V_{s}, z_{s}) = I_{s}$。从电流的表达式中，我们可以分离出项 $C_{0} e^{-2\\kappa z_{s}}$，它在整个后续谱学测量中充当一个归一化前置因子：\n$$\nI_{s} = C_{0} e^{-2\\kappa z_{s}} \\int_{0}^{V_{s}} \\rho_{s}(E)\\,\\mathrm{d}E\n$$\n$$\n\\implies C_{0} e^{-2\\kappa z_{s}} = \\frac{I_{s}}{\\int_{0}^{V_{s}} \\rho_{s}(E)\\,\\mathrm{d}E}\n$$\n因此，在此设定点下测得的微分电导谱为：\n$$\n\\left(\\frac{\\mathrm{d}I}{\\mathrm{d}V}\\right)_{\\text{meas}}(V) = \\left( C_{0} e^{-2\\kappa z_{s}} \\right) \\rho_{s}(V) = \\left( \\frac{I_{s}}{\\int_{0}^{V_{s}} \\rho_{s}(E)\\,\\mathrm{d}E} \\right) \\rho_{s}(V)\n$$\n请注意，未知常数 $C_{0}$ 和 $\\kappa$ 已被消除。测得的电导谱是真实的样品 LDOS $\\rho_{s}(V)$，被一个完全取决于设定点 $(V_{s}, I_{s})$ 和直到 $V_{s}$ 的积分 LDOS 的归一化因子所缩放。\n\n问题要求计算在两个不同设定点 $(V_{s1}, I_{s1})$ 和 $(V_{s2}, I_{s2})$ 下，于共振能量 $V=E_{r}$ 处测量的微分电导峰值振幅之比 $R$。设在 $V=E_{r}$ 处对应的测量电导分别为 $(\\mathrm{d}I/\\mathrm{d}V)_{1}$ 和 $(\\mathrm{d}I/\\mathrm{d}V)_{2}$。\n$$\nR = \\frac{\\left.\\left(\\mathrm{d}I/\\mathrm{d}V\\right)_{2}\\right|_{V=E_{r}}}{\\left.\\left(\\mathrm{d}I/\\mathrm{d}V\\right)_{1}\\right|_{V=E_{r}}} = \\frac{\\left( \\frac{I_{s2}}{\\int_{0}^{V_{s2}} \\rho_{s}(E)\\,\\mathrm{d}E} \\right) \\rho_{s}(E_{r})}{\\left( \\frac{I_{s1}}{\\int_{0}^{V_{s1}} \\rho_{s}(E)\\,\\mathrm{d}E} \\right) \\rho_{s}(E_{r})}\n$$\n代表共振时 LDOS 峰值的项 $\\rho_{s}(E_{r})$ 被消掉了。这是一个关键的简化。比率 $R$ 变为：\n$$\nR = \\frac{I_{s2}}{I_{s1}} \\cdot \\frac{\\int_{0}^{V_{s1}} \\rho_{s}(E)\\,\\mathrm{d}E}{\\int_{0}^{V_{s2}} \\rho_{s}(E)\\,\\mathrm{d}E}\n$$\n为了计算这个表达式，我们必须计算所提供的 LDOS 模型的定积分 $\\mathcal{I}(V) = \\int_{0}^{V} \\rho_{s}(E)\\,\\mathrm{d}E$。LDOS 给出为：\n$$\n\\rho_{s}(E) = \\rho_{0} + \\frac{A_{L}\\,\\Gamma^{2}}{(E - E_{r})^{2} + \\Gamma^{2}}\n$$\n该积分可分为两部分：\n$$\n\\mathcal{I}(V) = \\int_{0}^{V} \\rho_{0} \\,\\mathrm{d}E + \\int_{0}^{V} \\frac{A_{L}\\,\\Gamma^{2}}{(E - E_{r})^{2} + \\Gamma^{2}} \\,\\mathrm{d}E\n$$\n第一个积分很简单：\n$$\n\\int_{0}^{V} \\rho_{0} \\,\\mathrm{d}E = \\rho_{0}[E]_{0}^{V} = \\rho_{0}V\n$$\n第二个积分是标准的洛伦兹形式。使用不定积分 $\\int \\frac{a^{2}}{x^{2}+a^{2}} \\,\\mathrm{d}x = a \\arctan(x/a)$，我们令 $x = E - E_{r}$ 且 $a = \\Gamma$：\n$$\n\\int \\frac{\\Gamma^{2}}{(E - E_{r})^{2} + \\Gamma^{2}} \\,\\mathrm{d}E = \\Gamma \\arctan\\left(\\frac{E-E_{r}}{\\Gamma}\\right)\n$$\n计算定积分：\n$$\n\\int_{0}^{V} \\frac{A_{L}\\,\\Gamma^{2}}{(E - E_{r})^{2} + \\Gamma^{2}} \\,\\mathrm{d}E = A_{L}\\Gamma \\left[ \\arctan\\left(\\frac{E-E_{r}}{\\Gamma}\\right) \\right]_{0}^{V} = A_{L}\\Gamma \\left( \\arctan\\left(\\frac{V-E_{r}}{\\Gamma}\\right) - \\arctan\\left(\\frac{-E_{r}}{\\Gamma}\\right) \\right)\n$$\n使用恒等式 $\\arctan(-x) = -\\arctan(x)$，上式可简化为：\n$$\n= A_{L}\\Gamma \\left( \\arctan\\left(\\frac{V-E_{r}}{\\Gamma}\\right) + \\arctan\\left(\\frac{E_{r}}{\\Gamma}\\right) \\right)\n$$\n将两部分合并，我们得到积分 LDOS 的精确解析表达式：\n$$\n\\mathcal{I}(V) = \\rho_{0}V + A_{L}\\Gamma \\left( \\arctan\\left(\\frac{V-E_{r}}{\\Gamma}\\right) + \\arctan\\left(\\frac{E_{r}}{\\Gamma}\\right) \\right)\n$$\n最后，通过代入该积分的解析形式，比率 $R$ 可以用给定的参数表示为：\n$$\nR = \\frac{I_{s2}}{I_{s1}} \\cdot \\frac{\\rho_{0}V_{s1} + A_{L}\\Gamma \\left( \\arctan\\left(\\frac{V_{s1}-E_{r}}{\\Gamma}\\right) + \\arctan\\left(\\frac{E_{r}}{\\Gamma}\\right) \\right)}{\\rho_{0}V_{s2} + A_{L}\\Gamma \\left( \\arctan\\left(\\frac{V_{s2}-E_{r}}{\\Gamma}\\right) + \\arctan\\left(\\frac{E_{r}}{\\Gamma}\\right) \\right)}\n$$\n这个最终方程被直接实现，以计算给定测试用例所需的比率。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the ratio of STS peak amplitudes under different setpoints.\n    \"\"\"\n\n    # Each test case is defined as:\n    # (rho0, AL, Gamma, Er, Vs1, Is1, Vs2, Is2)\n    # where all energies are in eV and currents are in A.\n    test_cases = [\n        (1.0, 8.0, 0.005, 0.200, 0.100, 1.0e-9, 0.300, 1.0e-9),\n        (1.0, 10.0, 0.010, 0.200, 0.250, 0.5e-9, 0.250, 1.0e-9),\n        (0.8, 6.0, 0.004, 0.200, 0.200, 1.0e-9, 0.200, 0.8e-9),\n        (1.2, 12.0, 0.001, 0.020, 0.050, 1.0e-9, 0.015, 1.0e-9),\n    ]\n\n    def calculate_integrated_ldos(V_s, rho_0, A_L, Gamma, E_r):\n        \"\"\"\n        Calculates the integral of the LDOS from 0 to V_s analytically.\n        \n        The integral is I(V) = integral_0^V [rho_0 + A_L*Gamma^2/((E-E_r)^2 + Gamma^2)] dE\n        which evaluates to:\n        I(V) = rho_0*V + A_L*Gamma*[arctan((V-E_r)/Gamma) + arctan(E_r/Gamma)]\n        \"\"\"\n        if V_s  0:\n            # Per problem statement V = 0. For completeness, we define this.\n            return 0.0\n\n        # Linear background contribution\n        integral_part1 = rho_0 * V_s\n        \n        # Lorentzian peak contribution\n        arg1_arctan = (V_s - E_r) / Gamma\n        arg2_arctan = E_r / Gamma\n        integral_part2 = A_L * Gamma * (np.arctan(arg1_arctan) + np.arctan(arg2_arctan))\n        \n        return integral_part1 + integral_part2\n\n    results = []\n    for case in test_cases:\n        rho_0, A_L, Gamma, E_r, V_s1, I_s1, V_s2, I_s2 = case\n        \n        # Calculate the integrated LDOS for each setpoint voltage\n        integral_1 = calculate_integrated_ldos(V_s1, rho_0, A_L, Gamma, E_r)\n        integral_2 = calculate_integrated_ldos(V_s2, rho_0, A_L, Gamma, E_r)\n        \n        # The ratio of the measured peak heights is given by:\n        # R = (I_s2 / I_s1) * (integral_1 / integral_2)\n        # This holds because the rho_s(E_r) term cancels out.\n        \n        # Problem constraints (rho_0  0, V_s = 0) ensure integral_2 is not zero\n        # unless V_s2 is zero, which is not the case in the test suite.\n        # I_s is also non-zero.\n        \n        ratio = (I_s2 / I_s1) * (integral_1 / integral_2)\n        results.append(ratio)\n\n    # Format the final output as specified in the problem statement.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2856453"}, {"introduction": "最后的这项练习将带您进入STM分析的前沿领域：从准粒子干涉 (QPI) 到能带结构的重建。傅里叶变换扫描隧道谱 (FT-STS) 是一种在倒易空间中揭示电子散射和材料能带结构信息的强大技术。在本练习中，您将解决一个“逆向工程”问题，即从模拟的QPI图谱出发，实现一个反演程序来重建潜在的、包含各向异性的 $E(\\mathbf{k})$ 色散关系 [@problem_id:2856483]。这项练习将STM测量与材料的基本电子性质直接联系起来。", "problem": "您的任务是根据合成的傅里叶变换扫描隧道谱 (FT-STS) 色散关系重建各向异性电子能带结构，并将结果与角分辨光电子能谱 (ARPES) 导出的色散关系进行比较。目标是设计并实现一个有原则的反演过程，该过程仅从准粒子干涉和有效质量近似的基本定义出发，并与参考进行定量比较。所有能量必须以电子伏特 (eV) 表示，所有波矢以逆埃 (Å$^{-1}$) 表示，所有角度以弧度表示。\n\n您可以使用的基本物理假设如下列基本定义和经过充分检验的事实：\n- FT-STS 中的准粒子干涉测量的是连接倒易空间中等能点的散射波矢。对于同一等能线上相反两点之间的主导背散射，散射波矢的大小满足 $q(\\theta,E) = 2 k(\\theta,E)$，其中 $\\theta$ 表示二维布里渊区中的方向，$k(\\theta,E)$ 是能量为 $E$ 时沿方向 $\\theta$ 的晶体动量的径向大小。\n- 在极值点附近，能带色散可以用有效质量近似来描述，其有效质量张量是对角化的，即晶体动量分量的各向异性二次型。使用常数 $C = \\hbar^2/(2 m_e)$，其数值为 $C = 3.809982$ eV·Å$^2$，其中 $m_e$ 是电子静止质量，$\\hbar$ 是约化普朗克常数。该色散以能量偏移 $E_0$ 为中心，并由主方向质量 $m_x$ 和 $m_y$ 表征。为方便起见，将它们表示为无量纲比率 $\\alpha_x = m_x/m_e$ 和 $\\alpha_y = m_y/m_e$。\n\n基于这些基础，实现一个通用的、方向分辨的反演过程，该过程根据给定的三元组 $(E_i,\\theta_j,q_{ij})$ 推断各向异性电子能带结构参数，并与 ARPES 导出的色散关系进行定量比较。\n\n测试套件规范：\n- 使用三个测试用例。对于每种情况，您必须根据以下规范确定性地合成 FT-STS 数据集 $(E_i,\\theta_j,q_{ij})$，假设存在主导背散射 $q_{ij} = 2 k(\\theta_j,E_i)$ 并且能量大于能带最小值 $E_0$。对于方向 $\\theta$，有效径向大小 $k(\\theta,E)$ 由有效质量近似中的各向异性二次型能带的等能条件隐式定义。角度必须为 $\\theta \\in \\{0, \\pi/4, \\pi/2\\}$（弧度）。对于每种情况，ARPES 参考由用于合成 FT-STS 数据的完全相同的能带参数组成，您的反演结果必须与之进行比较。\n- 对于每种情况，能量 $E_i$ 作为固定列表给出。使用 $C = 3.809982$ 从上述物理定义确定性地合成 $q_{ij}$。不应添加额外噪声。\n\n情况 A（各向同性参考）：\n- 参考偏移和质量 (ARPES)：$E_0 = 0.10$ eV, $\\alpha_x = 0.50$, $\\alpha_y = 0.50$。\n- 能量网格：$[0.12, 0.16, 0.20, 0.24, 0.28]$ eV。\n- 角度：$[0, \\pi/4, \\pi/2]$ 弧度。\n\n情况 B（中度各向异性参考）：\n- 参考偏移和质量 (ARPES)：$E_0 = 0.05$ eV, $\\alpha_x = 0.30$, $\\alpha_y = 0.90$。\n- 能量网格：$[0.08, 0.14, 0.20, 0.26, 0.32]$ eV。\n- 角度：$[0, \\pi/4, \\pi/2]$ 弧度。\n\n情况 C（强各向异性且具有负偏移）：\n- 参考偏移和质量 (ARPES)：$E_0 = -0.02$ eV, $\\alpha_x = 0.15$, $\\alpha_y = 1.20$。\n- 能量网格：$[0.00, 0.04, 0.08, 0.12, 0.16]$ eV。\n- 角度：$[0, \\pi/4, \\pi/2]$ 弧度。\n\n算法要求：\n- 对于每种情况，首先通过计算来合成 FT-STS 数据：对于每个能量 $E$ 和方向 $\\theta$，计算散射波矢大小 $q(E,\\theta) = 2 k(E,\\theta)$，其中 $k(E,\\theta)$ 满足由给定的 $(E_0,\\alpha_x,\\alpha_y)$ 和常数 $C$ 下的有效质量近似所隐含的各向异性等能条件。\n- 然后，实现一个反演过程，从合成的数据集 $\\{(E,\\theta,q)\\}$ 中估计 $(\\hat{E}_0,\\hat{\\alpha}_x,\\hat{\\alpha}_y)$。您的反演必须是考虑方向的，并且不应假设各向同性。将其设计为一个仅使用上述物理基础和定义的回归模型。\n- 使用 ARPES 参考参数 $(E_0,\\alpha_x,\\alpha_y)$，为每种情况计算以下指标：\n  1. $x$ 方向的相对质量误差：$\\left|\\hat{\\alpha}_x - \\alpha_x\\right|/\\alpha_x$。\n  2. $y$ 方向的相对质量误差：$\\left|\\hat{\\alpha}_y - \\alpha_y\\right|/\\alpha_y$。\n  3. 绝对偏移误差：$\\left|\\hat{E}_0 - E_0\\right|$，单位为 eV。\n  4. 反演得到的色散关系与 ARPES 色散关系之间的最大绝对能量差异（单位为 eV），该差异在给定能量网格的已测波矢 $k = q/2$ 和角度 $\\theta \\in \\{0,\\pi/4,\\pi/2\\}$ 集合上进行评估。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例贡献一个包含四个浮点数的子列表，顺序如上所述。例如，外层列表应类似于 [[caseA_values],[caseB_values],[caseC_values]]。每个浮点数必须四舍五入到 $6$ 位小数，能量单位为 eV，相对误差为无量纲。角度必须是弧度。不应打印任何额外文本。", "solution": "所述问题是有效的。它在科学上基于固态物理学的原理，特别有效质量近似和准粒子干涉，并且是一个良定义的计算任务。所有必要的数据、模型和常数都已提供，没有内部矛盾或歧义。我现在将提供完整的解决方案。\n\n目标是从合成的傅里叶变换扫描隧道谱 (FT-STS) 数据中重建各向异性电子能带结构的参数——能量偏移 $E_0$ 和无量纲有效质量 $\\alpha_x$ 和 $\\alpha_y$。然后将解与已知的真实参数进行比较，这些参数模拟了角分辨光电子能谱 (ARPES) 的参考。\n\n理论基础是二维系统中极值点附近抛物线形能带的有效质量近似。能量 $E$ 作为晶体动量波矢 $\\vec{k} = (k_x, k_y)$ 的函数由下式给出：\n$$ E(\\vec{k}) = E_0 + C \\left( \\frac{k_x^2}{\\alpha_x} + \\frac{k_y^2}{\\alpha_y} \\right) $$\n在这里，$E_0$ 是能带极值点的能量，$C = \\frac{\\hbar^2}{2m_e} = 3.809982 \\, \\text{eV}\\cdot\\text{Å}^2$ 是一个物理常数，$\\alpha_x = m_x/m_e$ 和 $\\alpha_y = m_y/m_e$ 是沿主轴的无量纲有效质量比。\n\n在极坐标中，使用 $k_x = k \\cos\\theta$ 和 $k_y = k \\sin\\theta$，色散关系变为：\n$$ E(k, \\theta) = E_0 + C k^2 \\left( \\frac{\\cos^2\\theta}{\\alpha_x} + \\frac{\\sin^2\\theta}{\\alpha_y} \\right) $$\n其中 $k$ 是波矢 $\\vec{k}$ 的大小，$\\theta$ 是它相对于 $k_x$ 轴的角度。能量为 $E$ 的等能线 (CEC) 通过求解 $k$ 作为 $\\theta$ 的函数来描述：\n$$ k(E, \\theta) = \\sqrt{\\frac{E - E_0}{C \\left( \\frac{\\cos^2\\theta}{\\alpha_x} + \\frac{\\sin^2\\theta}{\\alpha_y} \\right)}} $$\n该表达式对于能量 $E  E_0$ 有效。FT-STS 测量连接 CEC 上两点的散射波矢 $\\vec{q}$。我们被指示假设主导的背散射，其中两点是对跖的，即 $\\vec{k}$ 和 $-\\vec{k}$。因此，散射波矢的大小为 $q = |\\vec{k} - (-\\vec{k})| = 2|\\vec{k}|$，或：\n$$ q(E, \\theta) = 2 k(E, \\theta) $$\n这个方程构成了合成 FT-STS 数据对 $(E_i, \\theta_j, q_{ij})$ 的基础。\n\n任务的核心是执行反演：给定一组测量的三元组 $\\{ (E, \\theta, q) \\}$，我们必须估计参数 $(\\hat{E}_0, \\hat{\\alpha}_x, \\hat{\\alpha}_y)$。为实现此目的，我们首先将色散关系重新排列成适合线性回归的形式。从色散关系开始，并代入 $k = q/2$：\n$$ E - E_0 = C \\left( \\frac{( (q/2) \\cos\\theta )^2}{\\alpha_x} + \\frac{( (q/2) \\sin\\theta )^2}{\\alpha_y} \\right) $$\n$$ E - E_0 = \\frac{C}{4} \\left( \\frac{(q \\cos\\theta)^2}{\\alpha_x} + \\frac{(q \\sin\\theta)^2}{\\alpha_y} \\right) $$\n重新排列以分离 $E$ 得到一个线性模型：\n$$ E = E_0 + \\left(\\frac{C}{4\\alpha_x}\\right) (q \\cos\\theta)^2 + \\left(\\frac{C}{4\\alpha_y}\\right) (q \\sin\\theta)^2 $$\n对于每个数据点，此方程的形式为 $y = \\beta_0 x_0 + \\beta_1 x_1 + \\beta_2 x_2$，其中：\n- 响应变量 $y = E$。\n- 预测变量为 $x_0 = 1$ (用于截距)，$x_1 = (q \\cos\\theta)^2$，以及 $x_2 = (q \\sin\\theta)^2$。\n- 回归系数 $\\beta_0, \\beta_1, \\beta_2$ 与物理参数相关：\n  - $\\beta_0 = \\hat{E}_0$\n  - $\\beta_1 = \\frac{C}{4\\hat{\\alpha}_x} \\implies \\hat{\\alpha}_x = \\frac{C}{4\\beta_1}$\n  - $\\beta_2 = \\frac{C}{4\\hat{\\alpha}_y} \\implies \\hat{\\alpha}_y = \\frac{C}{4\\beta_2}$\n\n对于一组 $N$ 个数据点，这可以表示为矩阵形式 $\\mathbf{y} = \\mathbf{X}\\boldsymbol{\\beta}$，其中：\n$$ \\mathbf{y} = \\begin{pmatrix} E_1 \\\\ E_2 \\\\ \\vdots \\\\ E_N \\end{pmatrix}, \\quad \\mathbf{X} = \\begin{pmatrix} 1  (q_1 \\cos\\theta_1)^2  (q_1 \\sin\\theta_1)^2 \\\\ 1  (q_2 \\cos\\theta_2)^2  (q_2 \\sin\\theta_2)^2 \\\\ \\vdots  \\vdots  \\vdots \\\\ 1  (q_N \\cos\\theta_N)^2  (q_N \\sin\\theta_N)^2 \\end{pmatrix}, \\quad \\boldsymbol{\\beta} = \\begin{pmatrix} \\beta_0 \\\\ \\beta_1 \\\\ \\beta_2 \\end{pmatrix} $$\n最优系数向量 $\\hat{\\boldsymbol{\\beta}}$ 通过使用标准线性最小二乘算法求解该系统来找到，其规范解为 $\\hat{\\boldsymbol{\\beta}} = (\\mathbf{X}^T \\mathbf{X})^{-1} \\mathbf{X}^T \\mathbf{y}$。一旦确定了 $\\hat{\\boldsymbol{\\beta}}$，就可以根据上述关系计算出物理参数 $(\\hat{E}_0, \\hat{\\alpha}_x, \\hat{\\alpha}_y)$。由于合成数据是无噪声的，该反演过程预计将高精度地恢复原始参数，其精度仅受浮点运算的限制。\n\n最后，使用四个指标来量化反演的质量：\n1.  x 方向的相对质量误差：$|\\hat{\\alpha}_x - \\alpha_x| / \\alpha_x$。\n2.  y 方向的相对质量误差：$|\\hat{\\alpha}_y - \\alpha_y| / \\alpha_y$。\n3.  绝对偏移误差：$|\\hat{E}_0 - E_0|$。\n4.  最大绝对能量差异：$\\max | \\hat{E}(\\vec{k}) - E_{\\text{ARPES}}(\\vec{k}) |$，在所有测量的波矢上评估。反演得到的能量是 $\\hat{E}(\\vec{k}) = \\hat{E}_0 + C(k_x^2/\\hat{\\alpha}_x + k_y^2/\\hat{\\alpha}_y)$，而参考 ARPES 能量是真实能量 $E_{\\text{ARPES}}(\\vec{k}) = E_0 + C(k_x^2/\\alpha_x + k_y^2/\\alpha_y)$，根据构造，它等于相应合成数据点的能量 $E$。\n\n对于每个测试用例，实现将遵循以下步骤：从真实参数合成数据，执行线性回归以找到估计参数，并计算所需的误差指标。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of reconstructing an anisotropic electronic band structure\n    from synthetic FT-STS data and comparing it to ARPES-derived dispersions.\n    \"\"\"\n    # Physical constant C = h_bar^2 / (2*m_e) in eV·Å^2\n    C = 3.809982\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"Case A (isotropic)\",\n            \"arpes_params\": {\"E0\": 0.10, \"alpha_x\": 0.50, \"alpha_y\": 0.50},\n            \"energies\": [0.12, 0.16, 0.20, 0.24, 0.28],\n            \"angles\": [0, np.pi / 4, np.pi / 2],\n        },\n        {\n            \"name\": \"Case B (moderately anisotropic)\",\n            \"arpes_params\": {\"E0\": 0.05, \"alpha_x\": 0.30, \"alpha_y\": 0.90},\n            \"energies\": [0.08, 0.14, 0.20, 0.26, 0.32],\n            \"angles\": [0, np.pi / 4, np.pi / 2],\n        },\n        {\n            \"name\": \"Case C (strongly anisotropic with negative offset)\",\n            \"arpes_params\": {\"E0\": -0.02, \"alpha_x\": 0.15, \"alpha_y\": 1.20},\n            \"energies\": [0.00, 0.04, 0.08, 0.12, 0.16],\n            \"angles\": [0, np.pi / 4, np.pi / 2],\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        E0_true = case[\"arpes_params\"][\"E0\"]\n        alpha_x_true = case[\"arpes_params\"][\"alpha_x\"]\n        alpha_y_true = case[\"arpes_params\"][\"alpha_y\"]\n        energies = case[\"energies\"]\n        angles = case[\"angles\"]\n\n        # Step 1: Synthesize FT-STS data (E, theta, q)\n        synthetic_data = []\n        for E in energies:\n            for theta in angles:\n                cos_theta_sq = np.cos(theta) ** 2\n                sin_theta_sq = np.sin(theta) ** 2\n                \n                denominator = C * (cos_theta_sq / alpha_x_true + sin_theta_sq / alpha_y_true)\n                \n                # We are guaranteed E  E0 by the problem statement\n                k_squared = (E - E0_true) / denominator\n                k = np.sqrt(k_squared)\n                q = 2 * k\n                synthetic_data.append({\"E\": E, \"theta\": theta, \"q\": q})\n\n        # Step 2: Implement the inversion via linear regression\n        num_points = len(synthetic_data)\n        y_vec = np.zeros(num_points)\n        X_matrix = np.zeros((num_points, 3))\n\n        for i, data_point in enumerate(synthetic_data):\n            E, theta, q = data_point[\"E\"], data_point[\"theta\"], data_point[\"q\"]\n            y_vec[i] = E\n            X_matrix[i, 0] = 1.0\n            X_matrix[i, 1] = (q * np.cos(theta)) ** 2\n            X_matrix[i, 2] = (q * np.sin(theta)) ** 2\n\n        # Solve the linear system y = X * beta\n        betas, _, _, _ = np.linalg.lstsq(X_matrix, y_vec, rcond=None)\n        beta0_hat, beta1_hat, beta2_hat = betas\n\n        # Step 3: Recover the physical parameters from regression coefficients\n        E0_hat = beta0_hat\n        alpha_x_hat = C / (4 * beta1_hat) if beta1_hat != 0 else np.inf\n        alpha_y_hat = C / (4 * beta2_hat) if beta2_hat != 0 else np.inf\n        \n        # Step 4: Compute the required metrics\n        # Metric 1: Relative mass error in x\n        rel_err_ax = np.abs(alpha_x_hat - alpha_x_true) / alpha_x_true\n\n        # Metric 2: Relative mass error in y\n        rel_err_ay = np.abs(alpha_y_hat - alpha_y_true) / alpha_y_true\n\n        # Metric 3: Absolute offset error\n        abs_err_E0 = np.abs(E0_hat - E0_true)\n\n        # Metric 4: Maximum absolute energy discrepancy\n        max_energy_discrepancy = 0.0\n        for data_point in synthetic_data:\n            E_true_point = data_point[\"E\"]\n            q = data_point[\"q\"]\n            theta = data_point[\"theta\"]\n            \n            k = q / 2.0\n            kx = k * np.cos(theta)\n            ky = k * np.sin(theta)\n\n            E_inverted = E0_hat + C * (kx**2 / alpha_x_hat + ky**2 / alpha_y_hat)\n            discrepancy = np.abs(E_inverted - E_true_point)\n            \n            if discrepancy  max_energy_discrepancy:\n                max_energy_discrepancy = discrepancy\n\n        case_metrics = [rel_err_ax, rel_err_ay, abs_err_E0, max_energy_discrepancy]\n        all_results.append(case_metrics)\n\n    # Final print statement in the exact required format.\n    formatted_results = []\n    for result_set in all_results:\n        formatted_case = [f\"{val:.6f}\" for val in result_set]\n        formatted_results.append(f\"[{','.join(formatted_case)}]\")\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2856483"}]}