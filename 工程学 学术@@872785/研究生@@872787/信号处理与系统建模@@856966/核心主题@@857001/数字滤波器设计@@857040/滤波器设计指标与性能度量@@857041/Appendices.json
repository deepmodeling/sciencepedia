{"hands_on_practices": [{"introduction": "本练习通过将滤波器规格与巴特沃斯低通滤波器的核心参数直接联系起来，为滤波器设计奠定了基础。您将推导滤波器阶数和截止频率的方程，从而具体理解通带平坦度、阻带衰减和过渡带宽之间的权衡关系。这项练习对于掌握性能要求如何转化为滤波器的数学结构至关重要 [@problem_id:2871002]。", "problem": "一个连续时间、线性时不变（LTI）低通滤波器将由一个归一化的巴特沃斯原型设计，其通带边沿角频率为 $\\Omega_{p} = 1$，阶数 $n \\in \\mathbb{N}$ 和截止频率 $\\Omega_{c}  0$ 未知。设计指标以分贝（dB）为单位的通带和阻带衰减给出：在 $\\Omega=\\Omega_{p}$ 处，衰减不能超过 $A_{p}$；在阻带频率 $\\Omega=\\Omega_{s}$ 处，衰减必须至少为 $A_{s}$。巴特沃斯幅值平方响应定义为\n$$\n|H(j\\Omega)|^{2} \\;=\\; \\frac{1}{1 + \\left(\\frac{\\Omega}{\\Omega_{c}}\\right)^{2n}} \\, ,\n$$\n衰减定义为\n$$\nA(\\Omega) \\;=\\; -20 \\log_{10}\\big(|H(j\\Omega)|\\big) \\, .\n$$\n\n(a) 从这些定义出发，推导出实数值阶数 $n^{\\star}$ 和截止频率 $\\Omega_{c}$ 关于 $A_{p}$、$A_{s}$ 和 $\\Omega_{s}$ 的显式表达式，这些表达式需同时满足在通带边沿 $\\Omega=\\Omega_{p}$ 处的等式以及在阻带频率 $\\Omega=\\Omega_{s}$ 处的不等式。\n\n(b) 通过选择最小整数 $n=\\lceil n^{\\star}\\rceil$ 来强制执行整数阶约束，并重新选择 $\\Omega_{c}$，使得在通带边沿 $\\Omega=\\Omega_{p}$ 处的衰减恰好等于 $A_{p}$。对于这个整数 $n$，量化在 $\\Omega=\\Omega_{s}$ 处实现的阻带衰减，并由此计算出由整数取整引起的裕度。\n\n使用具体指标 $A_{p}=1$（dB）、$A_{s}=50$（dB）和 $\\Omega_{s}=2.5$。你的最终答案必须是在 $\\Omega=\\Omega_{s}$ 处实现的阻带衰减，以分贝（dB）表示，并四舍五入到四位有效数字。", "solution": "我们从巴特沃斯原型幅值平方响应的定义开始，\n$$\n|H(j\\Omega)|^{2} \\;=\\; \\frac{1}{1 + \\left(\\frac{\\Omega}{\\Omega_{c}}\\right)^{2n}} \\, ,\n$$\n以及以分贝为单位的衰减，\n$$\nA(\\Omega) \\;=\\; -20 \\log_{10}\\big(|H(j\\Omega)|\\big) \\, .\n$$\n代入幅值表达式可得\n$$\nA(\\Omega) \\;=\\; -20 \\log_{10}\\!\\left(\\frac{1}{\\sqrt{1+\\left(\\frac{\\Omega}{\\Omega_{c}}\\right)^{2n}}}\\right)\n\\;=\\; 20 \\log_{10}\\!\\left(\\sqrt{1+\\left(\\frac{\\Omega}{\\Omega_{c}}\\right)^{2n}}\\right)\n\\;=\\; 10 \\log_{10}\\!\\left(1+\\left(\\frac{\\Omega}{\\Omega_{c}}\\right)^{2n}\\right).\n$$\n\n在通带边沿 $\\Omega=\\Omega_{p}$ 处，指标要求衰减不超过 $A_{p}$。为了得到最紧凑的设计，我们在 $\\Omega=\\Omega_{p}$ 处施加等式约束，得到\n$$\nA(\\Omega_{p}) \\;=\\; A_{p}\n\\;\\;\\Longrightarrow\\;\\;\n10 \\log_{10}\\!\\left(1+\\left(\\frac{\\Omega_{p}}{\\Omega_{c}}\\right)^{2n}\\right) \\;=\\; A_{p}.\n$$\n定义标准波纹参数\n$$\n\\varepsilon^{2} \\;\\triangleq\\; 10^{A_{p}/10} - 1,\n$$\n当 $A_{p}0$ 时，该参数为严格正值。那么通带边沿的等式给出\n$$\n\\left(\\frac{\\Omega_{p}}{\\Omega_{c}}\\right)^{2n} \\;=\\; \\varepsilon^{2}\n\\;\\;\\Longrightarrow\\;\\;\n\\Omega_{c} \\;=\\; \\Omega_{p}\\,\\varepsilon^{-1/n}.\n$$\n在归一化选择 $\\Omega_{p}=1$ 的情况下，这简化为\n$$\n\\Omega_{c} \\;=\\; \\varepsilon^{-1/n}.\n$$\n\n在阻带频率 $\\Omega=\\Omega_{s}$ 处，指标要求为 $A(\\Omega_{s}) \\ge A_{s}$。代入由通带决定的关系，我们得到\n$$\nA(\\Omega_{s})\n\\;=\\;\n10 \\log_{10}\\!\\left(1+\\left(\\frac{\\Omega_{s}}{\\Omega_{c}}\\right)^{2n}\\right)\n\\;=\\;\n10 \\log_{10}\\!\\left(1+\\Omega_{s}^{2n}\\left(\\frac{1}{\\Omega_{c}}\\right)^{2n}\\right)\n\\;=\\;\n10 \\log_{10}\\!\\left(1+\\varepsilon^{2}\\,\\Omega_{s}^{2n}\\right).\n$$\n因此，阻带不等式 $A(\\Omega_{s}) \\ge A_{s}$ 等价于\n$$\n10 \\log_{10}\\!\\left(1+\\varepsilon^{2}\\,\\Omega_{s}^{2n}\\right) \\;\\ge\\; A_{s}\n\\;\\;\\Longleftrightarrow\\;\\;\n1+\\varepsilon^{2}\\,\\Omega_{s}^{2n} \\;\\ge\\; 10^{A_{s}/10}\n\\;\\;\\Longleftrightarrow\\;\\;\n\\varepsilon^{2}\\,\\Omega_{s}^{2n} \\;\\ge\\; 10^{A_{s}/10} - 1.\n$$\n求解实数值阶数可得\n$$\nn^{\\star}\n\\;=\\;\n\\frac{\\ln\\!\\left(\\frac{10^{A_{s}/10}-1}{\\varepsilon^{2}}\\right)}{2\\,\\ln(\\Omega_{s})}\n\\;=\\;\n\\frac{\\ln\\!\\left(10^{A_{s}/10}-1\\right) - \\ln\\!\\left(10^{A_{p}/10}-1\\right)}{2\\,\\ln(\\Omega_{s})}.\n$$\n这就完成了(a)部分：对于任意给定的 $A_{p}$、$A_{s}$ 和 $\\Omega_{s}$，当 $\\Omega_{p}=1$ 时，我们有\n$$\nn^{\\star} \\;=\\; \\frac{\\ln\\!\\left(\\frac{10^{A_{s}/10}-1}{10^{A_{p}/10}-1}\\right)}{2\\,\\ln(\\Omega_{s})},\n\\qquad\n\\Omega_{c} \\;=\\; \\varepsilon^{-1/n},\\;\\;\\text{其中}\\;\\; \\varepsilon^{2}=10^{A_{p}/10}-1.\n$$\n\n对于(b)部分，可实现的阶数是最小整数 $n=\\lceil n^{\\star}\\rceil$。然后我们根据通带等式重新选择 $\\Omega_{c}$，使得 $A(\\Omega_{p})=A_{p}$ 精确成立：\n$$\n\\Omega_{c} \\;=\\; \\varepsilon^{-1/n}\n\\;\\;=\\;\\; \\left(10^{A_{p}/10}-1\\right)^{-1/(2n)}.\n$$\n对于这个整数阶设计，在 $\\Omega=\\Omega_{s}$ 处实现的阻带衰减是\n$$\nA_{\\text{real}}(\\Omega_{s})\n\\;=\\;\n10 \\log_{10}\\!\\left(1+\\varepsilon^{2}\\,\\Omega_{s}^{2n}\\right),\n$$\n该值通常会超过 $A_{s}$，因为 $n$ 是向上取整的。\n\n我们现在代入具体数值指标 $A_{p}=1$（dB）、$A_{s}=50$（dB）和 $\\Omega_{s}=2.5$，其中 $\\Omega_{p}=1$。\n\n计算波纹参数：\n$$\n\\varepsilon^{2} \\;=\\; 10^{A_{p}/10}-1 \\;=\\; 10^{0.1}-1 \\;=\\; 1.2589254117941673 - 1 \\;=\\; 0.2589254117941673.\n$$\n计算实数值阶数：\n$$\nn^{\\star}\n\\;=\\;\n\\frac{\\ln\\!\\left(10^{50/10}-1\\right) - \\ln\\!\\left(10^{1/10}-1\\right)}{2\\,\\ln(2.5)}\n\\;=\\;\n\\frac{\\ln(99999) - \\ln(0.2589254117941673)}{2\\,\\ln(2.5)}.\n$$\n数值上，\n$$\n\\ln(99999) \\approx 11.512915464920230,\\quad\n\\ln(0.2589254117941673) \\approx -1.351215541995,\n$$\n所以\n$$\nn^{\\star} \\;\\approx\\; \\frac{11.512915464920230 - (-1.351215541995)}{2\\times 0.916290731874155} \\;\\approx\\; \\frac{12.864131006915}{1.83258146374831} \\;\\approx\\; 7.01968.\n$$\n因此，最小整数阶为\n$$\nn \\;=\\; \\lceil n^{\\star}\\rceil \\;=\\; 8.\n$$\n重新选择截止频率以满足使用此 $n$ 的通带等式：\n$$\n\\Omega_{c} \\;=\\; \\left(10^{A_{p}/10}-1\\right)^{-1/(2n)} \\;=\\; \\left(0.2589254117941673\\right)^{-1/16}.\n$$\n使用 $\\ln\\!\\left(0.2589254117941673\\right)\\approx -1.351215541995$，我们得到\n$$\n\\ln(\\Omega_{c}) \\;=\\; -\\frac{1}{16}\\,\\ln\\!\\left(0.2589254117941673\\right) \\;\\approx\\; 0.0844509713747,\n\\quad\\Rightarrow\\quad\n\\Omega_{c} \\;\\approx\\; \\exp(0.0844509713747) \\;\\approx\\; 1.08806.\n$$\n\n最后，计算当 $n=8$ 时在 $\\Omega_{s}=2.5$ 处实现的阻带衰减：\n$$\nA_{\\text{real}}(2.5)\n\\;=\\;\n10 \\log_{10}\\!\\left(1+\\varepsilon^{2}\\,(2.5)^{2n}\\right)\n\\;=\\;\n10 \\log_{10}\\!\\left(1+\\big(10^{0.1}-1\\big)\\,(2.5)^{16}\\right).\n$$\n注意 $(2.5)^{16} = \\left(\\frac{5}{2}\\right)^{16} = \\frac{10^{16}}{2^{32}} \\approx 2{,}328{,}306.4365386963$。因此\n$$\n\\varepsilon^{2}\\,(2.5)^{16}\n\\;\\approx\\;\n\\left(0.2589254117941673\\right)\\times 2{,}328{,}306.4365386963\n\\;\\approx\\;\n602{,}857.705,\n$$\n因此\n$$\nA_{\\text{real}}(2.5)\n\\;\\approx\\;\n10 \\log_{10}\\!\\left(1+602{,}857.705\\right)\n\\;=\\;\n10 \\log_{10}\\!\\left(602{,}858.705\\right)\n\\;\\approx\\;\n50 + 10 \\log_{10}(6.02858705)\n\\;\\approx\\;\n57.802.\n$$\n四舍五入到四位有效数字，实现的阻带衰减为 $57.80$（dB）。\n\n这个值超过了指定的 $A_{s}=50$（dB），这是因为 $n$ 从 $n^{\\star}\\approx 7.01968$ 向上取整到 $n=8$，这说明了整数阶取整带来的裕度。", "answer": "$$\\boxed{57.80}$$", "id": "2871002"}, {"introduction": "转向最优 FIR 滤波器设计，本练习将探讨强大的 Parks-McClellan 算法的基本原理。您将推导加权函数与期望的通带和阻带波纹之间的关键关系。此实践阐明了设计者如何在等波纹设计中精确控制不同频带的性能权衡，以满足特定的性能目标 [@problem_id:2871129]。", "problem": "考虑一个长度为 $N+1$ 的实系数、偶对称、I型线性相位有限冲激响应(FIR)低通滤波器的设计，其幅度响应 $A(\\omega)$ 是在 $[0,\\pi]$ 上的一个实偶三角多项式。期望的幅度响应为 $D(\\omega)=1$（对于 $\\omega \\in [0,\\omega_p]$）和 $D(\\omega)=0$（对于 $\\omega \\in [\\omega_s,\\pi]$），并在过渡带 $(\\omega_p,\\omega_s)$ 内不施加任何约束。设计目标是在并集 $\\mathcal{B}=[0,\\omega_p]\\cup[\\omega_s,\\pi]$ 上最小化近似误差的加权切比雪夫（一致）范数，即最小化\n$$\nE_{\\max} \\triangleq \\sup_{\\omega \\in \\mathcal{B}} W(\\omega)\\,|A(\\omega)-D(\\omega)|,\n$$\n其中权重是分段常数：$W(\\omega)=W_p$（对于 $\\omega \\in [0,\\omega_p]$）和 $W(\\omega)=W_s$（对于 $\\omega \\in [\\omega_s,\\pi]$），且 $W_p0$ 和 $W_s0$。设最优解处的未加权通带波纹和阻带波纹分别表示为 $\\delta_p \\triangleq \\sup_{\\omega \\in [0,\\omega_p]}|A(\\omega)-1|$ 和 $\\delta_s \\triangleq \\sup_{\\omega \\in [\\omega_s,\\pi]}|A(\\omega)-0|$。仅使用加权一致范数的基本定义以及由哈尔空间成员对连续函数进行最佳加权切比雪夫近似的交错定理，推导出为在等波纹最优解处实现指定的目标波纹 $(\\delta_p,\\delta_s)$ 所必须选择的比率 $W_p/W_s$。通过援引加权误差 $E(\\omega)=W(\\omega)\\,(A(\\omega)-D(\\omega))$ 的交错条件，明确验证您的表达式在等波纹最优解处对于两个频带都是必要的。以 $\\delta_p$ 和 $\\delta_s$ 的闭式解析表达式形式提供最终答案。无需进行数值计算。", "solution": "**推导**\n目标是找到幅度响应 $A(\\omega)$（一个三角多项式），它能在集合 $\\mathcal{B} = [0, \\omega_p] \\cup [\\omega_s, \\pi]$ 上最小化最大加权近似误差 $E_{\\max}$。根据加权切比雪夫近似的交错定理，最优解的特征在于加权误差函数 $E(\\omega) = W(\\omega)(A(\\omega) - D(\\omega))$ 的“等波纹”行为。\n\n设最优幅度响应为 $A^*(\\omega)$，相应的最大加权误差的最小值为 $E_{\\text{opt}}$。根据定义：\n$$\nE_{\\text{opt}} = \\sup_{\\omega \\in \\mathcal{B}} W(\\omega) |A^*(\\omega) - D(\\omega)|\n$$\n交错定理指出，$A^*(\\omega)$ 是唯一最优解的充要条件是，加权误差 $E(\\omega)$ 表现出足够数量的极值点，在这些点上其幅值等于 $E_{\\text{opt}}$ 且符号交错。对于多带滤波器设计，一个直接的推论是，在所有近似频带内，最大加权误差必须相同。因此，加权误差在通带上的上确界必须等于其在阻带上的上确界，且两者都必须等于 $E_{\\text{opt}}$。\n\n用数学方式表达如下：\n$$\n\\sup_{\\omega \\in [0, \\omega_p]} W(\\omega)|A^*(\\omega) - D(\\omega)| = \\sup_{\\omega \\in [\\omega_s, \\pi]} W(\\omega)|A^*(\\omega) - D(\\omega)| = E_{\\text{opt}}\n$$\n我们使用所提供的 $W(\\omega)$ 和 $D(\\omega)$ 的分段定义，分别对两个频带进行分析。\n\n对于通带 $\\omega \\in [0, \\omega_p]$，我们有 $W(\\omega) = W_p$ 和 $D(\\omega) = 1$。表达式变为：\n$$\n\\sup_{\\omega \\in [0, \\omega_p]} W_p |A^*(\\omega) - 1| = E_{\\text{opt}}\n$$\n由于 $W_p$ 是一个正常数，它可以从上确界算子中提出来：\n$$\nW_p \\left( \\sup_{\\omega \\in [0, \\omega_p]} |A^*(\\omega) - 1| \\right) = E_{\\text{opt}}\n$$\n问题将最优解的未加权通带波纹定义为 $\\delta_p \\triangleq \\sup_{\\omega \\in [0, \\omega_p]} |A^*(\\omega) - 1|$。代入该定义可得：\n$$\nW_p \\delta_p = E_{\\text{opt}}\n$$\n\n对于阻带 $\\omega \\in [\\omega_s, \\pi]$，我们有 $W(\\omega) = W_s$ 和 $D(\\omega) = 0$。表达式变为：\n$$\n\\sup_{\\omega \\in [\\omega_s, \\pi]} W_s |A^*(\\omega) - 0| = E_{\\text{opt}}\n$$\n类似地，提出正常数 $W_s$：\n$$\nW_s \\left( \\sup_{\\omega \\in [\\omega_s, \\pi]} |A^*(\\omega)| \\right) = E_{\\text{opt}}\n$$\n问题将最优解的未加权阻带波纹定义为 $\\delta_s \\triangleq \\sup_{\\omega \\in [\\omega_s, \\pi]} |A^*(\\omega)|$。代入该定义可得：\n$$\nW_s \\delta_s = E_{\\text{opt}}\n$$\n\n我们现在为最优加权误差 $E_{\\text{opt}}$ 建立了两个表达式：\n1. $W_p \\delta_p = E_{\\text{opt}}$\n2. $W_s \\delta_s = E_{\\text{opt}}$\n\n这明确地表明，加权误差的等波纹性质（这是交错定理应用于滤波器设计的基石）意味着加权通带波纹（$W_p \\delta_p$）必须等于加权阻带波纹（$W_s \\delta_s$）。为了实现指定的目标波纹 $(\\delta_p, \\delta_s)$，必须选择权重以满足这个等式。\n\n通过令这两个表达式相等，我们得到所需的关系：\n$$\nW_p \\delta_p = W_s \\delta_s\n$$\n问题要求的是比率 $W_p/W_s$。整理该方程可得：\n$$\n\\frac{W_p}{W_s} = \\frac{\\delta_s}{\\delta_p}\n$$\n对于一个最优等波纹滤波器，这个结果是必要的。选择这个权重比率可确保未加权波纹 $(\\delta_p, \\delta_s)$ 的规定与切比雪夫最优解的基本性质相一致，即加权误差在所有近似频带上具有恒定的最大幅值。", "answer": "$$\\boxed{\\frac{\\delta_s}{\\delta_p}}$$", "id": "2871129"}, {"introduction": "理论上的滤波器设计最终必须在有限精度的数字硬件上实现，这个过程会引入量化误差。这个计算实践将指导您通过蒙特卡洛模拟来量化这些误差对滤波器性能的影响。通过估计规格违规的概率，您将获得关于设计鲁棒性的实践见解，并理解考虑实现效应的重要性 [@problem_id:2871028]。", "problem": "给定一个固定的基准线性时不变 (LTI) 离散时间低通滤波器，该滤波器以抽头长度为 $M$ 的有限脉冲响应 (FIR) 形式实现，通过对理想脉冲响应进行加窗并归一化至单位直流 (DC) 增益而设计。对于脉冲响应为 $\\{h[n]\\}_{n=0}^{M-1}$ 的滤波器，其在归一化频率 $f \\in [0, \\tfrac{1}{2}]$（单位：周/采样点）下的离散时间频率响应由傅里叶级数定义为\n$$\nH(f) \\triangleq \\sum_{n=0}^{M-1} h[n] \\, e^{-j 2 \\pi f n}.\n$$\n滤波器设计指标由通带范围 $[0, f_p]$、阻带范围 $[f_s, \\tfrac{1}{2}]$ 以及通带波纹和阻带幅度的容差给出。具体来说，通带波纹指标要求对于所有 $f \\in [0, f_p]$，\n$$\n\\bigl|\\,|H(f)| - 1\\,\\bigr| \\le \\delta_p,\n$$\n而阻带衰减指标要求对于所有 $f \\in [f_s, \\tfrac{1}{2}]$，\n$$\n|H(f)| \\le \\delta_s.\n$$\n考虑一种实现方式，其中每个系数都受到量化误差的影响，该误差被建模为独立同分布的随机变量。对于固定的位深度 $b \\in \\mathbb{N}$，定义量化步长 $\\Delta = 2^{-b}$。量化后的系数模型为\n$$\nh_q[n] \\triangleq h_0[n] + \\varepsilon[n], \\quad \\varepsilon[n] \\sim \\mathcal{U}\\!\\left(-\\tfrac{\\Delta}{2}, \\tfrac{\\Delta}{2}\\right), \\quad \\text{independent over } n,\n$$\n其中 $\\{h_0[n]\\}_{n=0}^{M-1}$ 是未量化的基础设计。令 $H_q(f)$ 为使用上述相同定义，由 $\\{h_q[n]\\}$ 计算得出的相应频率响应。\n\n如果一个量化实例的通带波纹超出容差，即\n$$\n\\max_{f \\in [0, f_p]} \\bigl|\\,|H_q(f)| - 1\\,\\bigr|  \\delta_p,\n$$\n或者阻带幅度超出容差，即\n$$\n\\max_{f \\in [f_s, \\tfrac{1}{2}]} |H_q(f)|  \\delta_s,\n$$\n则发生指标违规事件。\n我们将使用蒙特卡洛 (MC) 模拟来估计指标违规的概率，并使用二项比例置信区间来量化估计器的不确定性。\n\n从以下基本原理出发：\n- 离散时间 LTI 系统的频率响应定义。\n- 蒙特卡洛原理，即通过从一个分布中独立抽样，可以用相对频率来估计事件概率。\n- 二项分布模型：如果在 $N$ 次独立试验中 $X$ 记录了违规次数，则 $X \\sim \\operatorname{Binomial}(N, p)$，其中 $p$ 是（未知的）违规概率。\n- 通过对二项分布的正态近似进行反演推导出的 Wilson 得分区间，它为概率 $p$ 提供了一个置信水平为 $c \\in (0,1)$ 的双边置信区间，其 z 值为 $z_{1-\\alpha/2}$，其中 $\\alpha = 1 - c$。\n\n您的任务是编写一个完整、可运行的程序，该程序：\n1. 通过使用 Hamming 窗对理想脉冲响应进行加窗，构建一个长度为 $M = 31$ 的基准 FIR 低通滤波器，并将其归一化至单位直流增益。使用截止频率为 $f_c = 0.20$ 周/采样点的理想低通滤波器：\n   - 加窗前的理想脉冲响应：\n     $$\n     h_{\\text{ideal}}[n] \\triangleq 2 f_c \\, \\operatorname{sinc}\\!\\bigl(2 f_c (n - \\tfrac{M-1}{2})\\bigr), \\quad n = 0,1,\\dots,M-1,\n     $$\n     其中 $\\operatorname{sinc}(x) \\triangleq \\dfrac{\\sin(\\pi x)}{\\pi x}$ 对于 $x \\neq 0$ 且 $\\operatorname{sinc}(0) \\triangleq 1$。\n   - Hamming 窗：\n     $$\n     w[n] \\triangleq 0.54 - 0.46 \\cos\\!\\left(\\dfrac{2 \\pi n}{M-1}\\right).\n     $$\n   - 加窗后的响应 $h_w[n] \\triangleq h_{\\text{ideal}}[n] \\, w[n]$ 和归一化后的基准系数 $h_0[n] \\triangleq \\dfrac{h_w[n]}{\\sum_{k=0}^{M-1} h_w[k]}$。\n2. 通过长度为 $N_{\\text{fft}} = 2048$ 的离散傅里叶变换，将频率轴在密集的均匀网格上离散化，使得被评估的频率集合为 $\\{ f_k \\triangleq \\tfrac{k}{N_{\\text{fft}}} : k = 0,1,\\dots,\\tfrac{N_{\\text{fft}}}{2} \\}$。\n3. 对于每次蒙特卡洛试验，为所有 $n$ 抽取独立的量化误差 $\\varepsilon[n] \\sim \\mathcal{U}(-\\tfrac{\\Delta}{2}, \\tfrac{\\Delta}{2})$，构成 $h_q[n] = h_0[n] + \\varepsilon[n]$，在网格上计算 $H_q(f_k)$，并在上述通带或阻带不等式被破坏时记录一次违规。\n4. 重复 $N$ 次试验，计算蒙特卡洛估计值 $\\hat{p} \\triangleq \\dfrac{X}{N}$，其中 $X$ 是违规总次数。构建置信水平为 $c = 0.95$、z 值约为 $1.959964$ 的双边 Wilson 得分置信区间，由下式给出\n   $$\n   \\hat{p}_\\text{W} \\pm \\text{half\\_width}, \\quad \\hat{p}_\\text{W} \\triangleq \\dfrac{\\hat{p} + \\dfrac{z^2}{2N}}{1 + \\dfrac{z^2}{N}}, \\quad \\text{half\\_width} \\triangleq \\dfrac{z}{1 + \\dfrac{z^2}{N}} \\sqrt{\\dfrac{\\hat{p}(1-\\hat{p})}{N} + \\dfrac{z^2}{4 N^2}}.\n   $$\n   将界限裁剪到单位区间 $[0,1]$ 内。\n\n使用以下指标\n- 通带边缘 $f_p = 0.18$，\n- 阻带边缘 $f_s = 0.22$，\n- 通带波纹容差 $\\delta_p = 0.02$，\n- 阻带幅度容差 $\\delta_s = 0.003$。\n\n角度单位是无量纲的归一化频率，单位为周/采样点。不涉及物理单位。置信水平为 $c = 0.95$。\n\n测试套件。您的程序必须对以下四个测试用例运行蒙特卡洛估计器，每个用例指定为一对 $(N, b)$，其中 $N$ 是蒙特卡洛试验的次数，$b$ 是定义 $\\Delta = 2^{-b}$ 的小数位数：\n- 用例 1：$(N, b) = (50, 10)$，\n- 用例 2：$(N, b) = (1000, 12)$，\n- 用例 3：$(N, b) = (1000, 8)$，\n- 用例 4：$(N, b) = (1000, 6)$。\n\n对于每个用例，输出三元组 $[\\hat{p}, \\text{CI}_{\\text{low}}, \\text{CI}_{\\text{high}}]$，其中 $\\hat{p}$ 是估计的违规概率，$\\text{CI}_{\\text{low}}$ 和 $\\text{CI}_{\\text{high}}$ 分别是 Wilson 区间的下界和上界。所有三个值都必须是四舍五入到六位小数的实数。\n\n最终输出格式。您的程序应生成单行输出，包含一个长度为 $4$ 的 JSON 数组，其中第 $i$ 个元素是与上面给出的第 $i$ 个用例相对应的三元素列表。例如，一个可接受的格式是\n$[[0.0,0.0,0.07],[0.01,0.004,0.02],[0.2,0.18,0.22],[0.6,0.57,0.63]]$，\n但其中的实际数字需替换为指定测试用例的计算值，并且每个浮点数都四舍五入到六位小数。", "solution": "该问题要求分析有限脉冲响应 (FIR) 滤波器在系数量化下的性能。解决方案包括三个阶段：首先，使用窗函数法设计一个基准低通 FIR 滤波器；其次，进行蒙特卡洛模拟，以估计因量化噪声导致的性能指标违规概率；第三，计算此概率估计的统计置信区间。整个过程基于数字信号处理和统计估计理论的基本原理。\n\n首先，我们解决基准滤波器的设计问题。问题指定了一个长度为 $M=31$ 的线性相位 FIR 滤波器。这种滤波器是对称的，其设计始于一个理想的低通滤波器脉冲响应，该响应是非因果且无限长的。截止频率为 $f_c$ 的理想低通滤波器的脉冲响应由一个 sinc 函数给出：\n$$\nh_{\\text{ideal, raw}}[n] = 2 f_c \\operatorname{sinc}(2 f_c n), \\quad n \\in \\mathbb{Z}\n$$\n其中 $\\operatorname{sinc}(x) \\triangleq \\frac{\\sin(\\pi x)}{\\pi x}$。为了使该响应变为有限且因果的，我们应用两个操作：截断和时移。一个长度为 $M$ 的对称滤波器以 $\\frac{M-1}{2}$ 为中心。因此，我们将理想响应移动这个量，并选择 $M$ 个样本：\n$$\nh_{\\text{ideal}}[n] \\triangleq 2 f_c \\operatorname{sinc}\\left(2 f_c \\left(n - \\frac{M-1}{2}\\right)\\right), \\quad n=0, 1, \\dots, M-1\n$$\n对于给定的参数 $M=31$ 和 $f_c=0.20$，中心点在 $\\frac{31-1}{2}=15$。突然截断脉冲响应（即使用矩形窗）会导致吉布斯现象，表现为频响在频带边缘附近出现大的波纹。为减轻此现象，我们将理想响应乘以一个在其两端平滑衰减至零的窗函数。问题指定了 Hamming 窗：\n$$\nw[n] \\triangleq 0.54 - 0.46 \\cos\\left(\\frac{2 \\pi n}{M-1}\\right), \\quad n=0, 1, \\dots, M-1\n$$\n加窗后的脉冲响应为 $h_w[n] = h_{\\text{ideal}}[n] \\cdot w[n]$。最后，滤波器必须具有单位直流增益，这意味着其在频率 $f=0$ 处的频率响应为 $H(0)=1$。频率响应为 $H(f) = \\sum_{n=0}^{M-1} h[n] e^{-j 2 \\pi f n}$，因此直流增益为 $H(0) = \\sum_{n=0}^{M-1} h[n]$。为实现单位直流增益，我们对系数进行归一化：\n$$\nh_0[n] \\triangleq \\frac{h_w[n]}{\\sum_{k=0}^{M-1} h_w[k]}\n$$\n这些归一化后的系数 $\\{h_0[n]\\}$ 构成了未量化的基准滤波器设计。\n\n其次，我们对量化效应进行建模并评估性能。系数被量化为具有 $b$ 个小数位的定点表示。量化步长为 $\\Delta = 2^{-b}$。我们将每个系数的量化误差建模为一个从均匀分布 $\\mathcal{U}(-\\Delta/2, \\Delta/2)$ 中抽取的独立随机变量 $\\varepsilon[n]$。因此，量化后的系数为 $h_q[n] = h_0[n] + \\varepsilon[n]$。量化后滤波器的频率响应 $H_q(f)$ 是一个随机函数。\n\n如果该响应的幅度 $|H_q(f)|$ 未能满足通带 $[0, f_p]$ 或阻带 $[f_s, 1/2]$ 的标准，则发生指标违规。\n- 通带违规：$\\max_{f \\in [0, f_p]} \\bigl|\\,|H_q(f)| - 1\\,\\bigr|  \\delta_p$\n- 阻带违规：$\\max_{f \\in [f_s, 1/2]} |H_q(f)|  \\delta_s$\n其中 $f_p=0.18$、$f_s=0.22$、$\\delta_p=0.02$ 和 $\\delta_s=0.003$。\n\n由于随机误差与最大值操作之间复杂的相互作用，解析计算此类违规的概率是难以处理的。因此，我们采用蒙特卡洛模拟。对于给定的试验次数 $N$，我们在每次试验中执行以下步骤：\n$1$. 生成一组 $M=31$ 个独立的量化误差 $\\{\\varepsilon[n]\\}_{n=0}^{M-1}$。\n$2$. 构成量化后的系数 $h_q[n] = h_0[n] + \\varepsilon[n]$。\n$3$. 使用长度为 $N_{\\text{fft}}=2048$ 的快速傅里叶变换 (FFT)，在密集的频率网格 $f_k = k/N_{\\text{fft}}$（其中 $k=0, \\dots, N_{\\text{fft}}/2$）上计算离散频率响应 $H_q(f_k)$。\n$4$. 在此网格上检查通带或阻带指标是否被违规。\n如果发生违规，我们进行计数。在 $N$ 次试验后，如果记录到 $X$ 次违规，则估计的违规概率为 $\\hat{p} = X/N$。\n\n第三，我们量化估计值 $\\hat{p}$ 的不确定性。每次试验都是一次独立的伯努利试验，其成功（违规）概率 $p$ 未知。违规次数 $X$ 服从二项分布，$X \\sim \\operatorname{Binomial}(N, p)$。为了构建 $p$ 的置信区间，我们使用 Wilson 得分区间，该方法比更简单的方法更可靠，尤其是在 $p$ 接近 0 或 1 时。对于置信水平 $c=0.95$，相应的 z-score 约为 $z = z_{1-(1-c)/2} \\approx 1.959964$。该区间以 $\\hat{p}_{\\text{W}}$ 为中心，半宽如下：\n$$\n\\hat{p}_{\\text{W}} = \\frac{\\hat{p} + \\frac{z^2}{2N}}{1 + \\frac{z^2}{N}}, \\quad \\text{half\\_width} = \\frac{z}{1 + \\frac{z^2}{N}} \\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{N} + \\frac{z^2}{4 N^2}}\n$$\n置信区间的下界和上界分别为 $\\text{CI}_{\\text{low}} = \\hat{p}_{\\text{W}} - \\text{half\\_width}$ 和 $\\text{CI}_{\\text{high}} = \\hat{p}_{\\text{W}} + \\text{half\\_width}$，并裁剪到区间 $[0, 1]$ 内。\n\n此过程针对四个测试用例执行，每个用例由一对 $(N, b)$ 定义：$(50, 10)$、$(1000, 12)$、$(1000, 8)$ 和 $(1000, 6)$。每个用例的最终输出由三元组 $[\\hat{p}, \\text{CI}_{\\text{low}}, \\text{CI}_{\\text{high}}]$ 组成，并四舍五入到六位小数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the Monte Carlo simulation for all test cases and print the final result.\n    \"\"\"\n    # ----------------------------------------------------------------------\n    # Define problem constants and specifications\n    # ----------------------------------------------------------------------\n    M = 31  # FIR filter tap-length\n    f_c = 0.20  # Ideal low-pass cutoff frequency\n    N_fft = 2048  # FFT length for frequency response evaluation\n\n    # Filter performance specifications\n    f_p = 0.18  # Passband edge\n    f_s = 0.22  # Stopband edge\n    delta_p = 0.02  # Passband ripple tolerance\n    delta_s = 0.003  # Stopband magnitude tolerance\n\n    # Confidence interval parameters\n    c = 0.95  # Confidence level\n    z = 1.959964  # z-value for 95% confidence\n\n    # Test cases: (N_trials, bits)\n    test_cases = [\n        (50, 10),\n        (1000, 12),\n        (1000, 8),\n        (1000, 6),\n    ]\n\n    # ----------------------------------------------------------------------\n    # Step 1: Design the base FIR filter (h0)\n    # ----------------------------------------------------------------------\n    # Time index vector, centered for linear phase\n    n = np.arange(M)\n    n_centered = n - (M - 1) / 2\n\n    # Ideal sinc impulse response\n    # np.sinc(x) computes sin(pi*x)/(pi*x)\n    h_ideal = 2 * f_c * np.sinc(2 * f_c * n_centered)\n\n    # Hamming window\n    w_hamming = 0.54 - 0.46 * np.cos(2 * np.pi * n / (M - 1))\n\n    # Windowed impulse response\n    h_w = h_ideal * w_hamming\n\n    # Normalize for unit DC gain\n    h_0 = h_w / np.sum(h_w)\n\n    # ----------------------------------------------------------------------\n    # Step 2: Set up frequency grid and band indices\n    # ----------------------------------------------------------------------\n    # Frequency grid from 0 to 0.5 cycles/sample\n    freqs = np.arange(N_fft // 2 + 1) / N_fft\n\n    # Get indices for passband and stopband\n    passband_indices = np.where(freqs = f_p)[0]\n    stopband_indices = np.where(freqs = f_s)[0]\n\n    # ----------------------------------------------------------------------\n    # Step 3  4: Run simulations and compute results\n    # ----------------------------------------------------------------------\n    results = []\n    for N, b in test_cases:\n        p_hat, ci_low, ci_high = _run_simulation(\n            N, b, h_0, N_fft, passband_indices, stopband_indices, delta_p, delta_s, z)\n        results.append([round(p_hat, 6), round(ci_low, 6), round(ci_high, 6)])\n\n    # Format the final output as a JSON-like string without spaces\n    case_strings = [f\"[{','.join(map(str, r))}]\" for r in results]\n    final_output_string = f\"[{','.join(case_strings)}]\"\n    print(final_output_string)\n\ndef _run_simulation(N, b, h_0, N_fft, passband_indices, stopband_indices, delta_p, delta_s, z):\n    \"\"\"\n    Helper function to run a single Monte Carlo simulation case.\n    \"\"\"\n    M = len(h_0)\n    delta_q = 2**(-b)\n    violation_count = 0\n\n    for _ in range(N):\n        # Generate quantization errors\n        errors = np.random.uniform(-delta_q / 2, delta_q / 2, size=M)\n\n        # Create quantized filter coefficients\n        h_q = h_0 + errors\n\n        # Compute frequency response via FFT\n        H_q = np.fft.fft(h_q, N_fft)\n        H_q_mag = np.abs(H_q[:N_fft // 2 + 1])\n\n        # Check for passband violation\n        passband_ripple = np.max(np.abs(H_q_mag[passband_indices] - 1))\n        is_passband_violated = passband_ripple  delta_p\n\n        # Check for stopband violation\n        stopband_mag = np.max(H_q_mag[stopband_indices])\n        is_stopband_violated = stopband_mag  delta_s\n\n        if is_passband_violated or is_stopband_violated:\n            violation_count += 1\n\n    # Estimated probability of violation\n    p_hat = violation_count / N\n\n    # Calculate Wilson score confidence interval\n    z2 = z**2\n    N_float = float(N)\n    \n    # Denominator of the main terms\n    denominator = 1 + z2 / N_float\n\n    # Center of the Wilson interval\n    p_hat_w = (p_hat + z2 / (2 * N_float)) / denominator\n\n    # Half-width of the interval\n    sqrt_term = np.sqrt((p_hat * (1 - p_hat) / N_float) + (z2 / (4 * N_float**2)))\n    half_width = (z / denominator) * sqrt_term\n\n    # Calculate and clip the bounds\n    ci_low = max(0.0, p_hat_w - half_width)\n    ci_high = min(1.0, p_hat_w + half_width)\n\n    return p_hat, ci_low, ci_high\n\n# Execute the main function\nsolve()\n```", "id": "2871028"}]}