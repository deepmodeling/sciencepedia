{"hands_on_practices": [{"introduction": "理论学习通常从索引为零的信号开始，但在实际应用中，信号可能位于任意时间区间。这个练习旨在从第一性原理出发，构建一个严谨的流程，用于处理具有任意起点和终点的信号的线性卷积。通过解决这个问题 [@problem_id:2880468]，您将深入掌握如何通过正确的索引重置、零填充和结果映射，利用循环卷积安全地实现线性卷积，这是任何稳健的数字信号处理实现的关键一步。", "problem": "给定具有任意支撑集的有限长离散时间信号。仅从线性卷积和离散傅里叶变换（DFT）的定义出发，构建一个严谨的、分步骤的过程，用于在信号定义于任意索引区间上时，通过DFT计算线性卷积。你的过程必须明确包括：(i) 如何确定最小变换长度，(ii) 如何将定义在非 $[0,L-1]$ 区间上的信号重新索引为从零开始的数组，(iii) 补零如何以及为何能避免混叠，以及 (iv) 如何将逆变换结果映射回原始时间索引。\n\n然后，将你的过程应用于以下定义在任意索引区间上的信号：\n- $x[n]$ 定义在 $[-2,1]$ 上，其值为 $x[-2]=2$, $x[-1]=-1$, $x[0]=3$, $x[1]=1$。\n- $h[n]$ 定义在 $[3,6]$ 上，其值为 $h[3]=1$, $h[4]=0$, $h[5]=-2$, $h[6]=4$。\n\n使用最小有效DFT长度，并计算线性卷积的输出样本 $y[4]$。请以精确数的形式提供最终结果，无需四舍五入。最终答案必须是一个数字。", "solution": "该问题是有效的。这是一个数字信号处理领域中定义明确的适定问题，具有科学依据且客观。我们首先构建通用过程，然后将其应用于所给出的具体信号。\n\n目标是使用离散傅里叶变换（DFT）计算两个有限长离散时间信号 $x[n]$ 和 $h[n]$ 的线性卷积。这些信号定义在任意整数支撑集上。\n\n线性卷积定义为：\n$$y[n] = (x * h)[n] = \\sum_{k=-\\infty}^{\\infty} x[k] h[n-k]$$\n对于长度为 $N$（定义在 $[0, N-1]$ 上）的信号 $x[n]$，$N$ 点DFT及其逆变换（IDFT）定义为：\n$$X[k] = \\sum_{n=0}^{N-1} x[n] e^{-j\\frac{2\\pi}{N}nk}, \\quad k \\in [0, N-1]$$\n$$x[n] = \\frac{1}{N} \\sum_{k=0}^{N-1} X[k] e^{j\\frac{2\\pi}{N}nk}, \\quad n \\in [0, N-1]$$\n其中 $j = \\sqrt{-1}$。DFT的卷积定理指出，两个信号的圆周卷积的DFT是它们各自DFT的乘积。设 $x_N[n]$ 和 $h_N[n]$ 是两个长度为 $N$ 的信号。它们的 $N$ 点圆周卷积定义为：\n$$(x_N \\circledast_N h_N)[n] = \\sum_{m=0}^{N-1} x_N[m] h_N[(n-m) \\pmod N]$$\n该定理表明：\n$$DFT\\{(x_N \\circledast_N h_N)[n]\\} = X_N[k] H_N[k]$$\n这意味着我们可以通过将信号变换到频域，将它们相乘，然后再变换回来，来计算圆周卷积：\n$$(x_N \\circledast_N h_N)[n] = IDFT\\{X_N[k] H_N[k]\\}$$\n该过程的核心是利用此性质来计算线性卷积。\n\n以下是分步骤的过程：\n\n**(i) 最小变换长度与 (iii) 补零以避免混叠**\n\n设信号 $x[n]$ 的支撑集从索引 $n_{x,min}$ 开始，到 $n_{x,max}$ 结束。信号的长度为 $L_x = n_{x,max} - n_{x,min} + 1$。类似地，设 $h[n]$ 的支撑集在 $[n_{h,min}, n_{h,max}]$ 上，长度为 $L_h = n_{h,max} - n_{h,min} + 1$。\n\n线性卷积 $y[n] = (x * h)[n]$ 是一个有限长信号。其支撑集从 $n_{y,min} = n_{x,min} + n_{h,min}$ 开始，到 $n_{y,max} = n_{x,max} + n_{h,max}$ 结束。结果信号 $y[n]$ 的长度为 $L_y = n_{y,max} - n_{y,min} + 1 = L_x + L_h - 1$。\n\n长度为 $N$ 的圆周卷积与线性卷积通过以下表达式相关联：\n$$(x_N \\circledast_N h_N)[n] = \\sum_{m=-\\infty}^{\\infty} y[n-mN]$$\n这表明圆周卷积是线性卷积的时域混叠版本。为确保 $N$ 点圆周卷积的结果在其整个持续时间内与线性卷积相同，我们必须防止移位副本 $y[n-mN]$ 的非零部分发生重叠。由于线性卷积 $y[n]$ 的长度为 $L_y = L_x + L_h - 1$，我们必须选择一个变换长度 $N$，使得 $N \\ge L_y$。\n\n因此，最小有效DFT长度为：\n$$N_{min} = L_x + L_h - 1$$\n要使用满足 $N \\ge N_{min}$ 的 $N$ 点DFT，我们必须将原始信号 $x[n]$ 和 $h[n]$ 扩展到这个长度。这通过补零来实现。\n\n**(ii) 重建索引为从零开始的数组**\n\nDFT是为索引区间 $[0, N-1]$ 上的信号正式定义的。我们的信号 $x[n]$ 和 $h[n]$ 具有任意支撑集。我们必须重建它们的索引以创建新的从零开始的信号，我们将其表示为 $x_p[n]$ 和 $h_p[n]$，长度为 $N$。\n\n对于定义在 $[n_{x,min}, n_{x,max}]$ 上的 $x[n]$，我们创建长度为 $N$ 的 $x_p[n]$：\n$$x_p[n] = \\begin{cases} x[n + n_{x,min}]  \\text{for } 0 \\le n  L_x \\\\ 0  \\text{for } L_x \\le n  N \\end{cases}$$\n类似地，对于定义在 $[n_{h,min}, n_{h,max}]$ 上的 $h[n]$，我们创建长度为 $N$ 的 $h_p[n]$：\n$$h_p[n] = \\begin{cases} h[n + n_{h,min}]  \\text{for } 0 \\le n  L_h \\\\ 0  \\text{for } L_h \\le n  N \\end{cases}$$\n这些补零后的信号 $x_p[n]$ 和 $h_p[n]$ 是DFT的输入。\n\n完整的计算序列是：\n1.  计算 $N$ 点DFT：$X_p[k] = DFT\\{x_p[n]\\}$ 和 $H_p[k] = DFT\\{h_p[n]\\}$。\n2.  在频域中相乘：$Y_p[k] = X_p[k] H_p[k]$。\n3.  计算 $N$ 点逆DFT：$y_p[n] = IDFT\\{Y_p[k]\\}$。结果信号 $y_p[n]$ 包含了 $n \\in [0, L_y-1]$ 时线性卷积的值。\n\n**(iv) 将逆变换结果映射回原始时间索引**\n\n计算出的信号 $y_p[n]$ 定义在 $[0, N-1]$ 上，其非零部分包含在 $[0, L_y-1]$ 内。该信号代表了真实线性卷积输出 $y[n]$ 的值，但是基于从零开始的索引。我们必须将这些值映射回 $y[n]$ 的正确支撑集，即 $[n_{y,min}, n_{y,max}]$。\n\n卷积的起始索引是 $n_{y,min} = n_{x,min} + n_{h,min}$。映射是一个简单的索引平移：\n$$y[n] = y_p[n - n_{y,min}] = y_p[n - (n_{x,min} + n_{h,min})]$$\n这提供了在其正确支撑区间上的最终线性卷积结果 $y[n]$。\n\n**应用于具体问题**\n\n给定：\n- $x[n]$ 定义在 $[-2, 1]$ 上，其值为 $\\{x[-2]=2, x[-1]=-1, x[0]=3, x[1]=1\\}$。\n- $h[n]$ 定义在 $[3, 6]$ 上，其值为 $\\{h[3]=1, h[4]=0, h[5]=-2, h[6]=4\\}$。\n\n首先，我们确定信号的属性：\n- 对于 $x[n]$：$n_{x,min} = -2$, $n_{x,max} = 1$。长度为 $L_x = 1 - (-2) + 1 = 4$。\n- 对于 $h[n]$：$n_{h,min} = 3$, $n_{h,max} = 6$。长度为 $L_h = 6 - 3 + 1 = 4$。\n\n接下来，我们应用该过程：\n\n1.  **确定最小DFT长度：**\n    $N_{min} = L_x + L_h - 1 = 4 + 4 - 1 = 7$。我们将使用 $N=7$。\n\n2.  **重建索引并补零：**\n    我们创建长度为 $N=7$ 的从零开始的信号 $x_p[n]$ 和 $h_p[n]$。\n    - 对于 $x_p[n]$，当 $n \\in [0,3]$ 时，其值为 $x[n-2]$：\n      $x_p[0] = x[-2] = 2$\n      $x_p[1] = x[-1] = -1$\n      $x_p[2] = x[0] = 3$\n      $x_p[3] = x[1] = 1$\n      $x_p[4]=x_p[5]=x_p[6]=0$。\n      因此，序列为 $x_p = \\{2, -1, 3, 1, 0, 0, 0\\}$。\n    - 对于 $h_p[n]$，当 $n \\in [0,3]$ 时，其值为 $h[n+3]$：\n      $h_p[0] = h[3] = 1$\n      $h_p[1] = h[4] = 0$\n      $h_p[2] = h[5] = -2$\n      $h_p[3] = h[6] = 4$\n      $h_p[4]=h_p[5]=h_p[6]=0$。\n      因此，序列为 $h_p = \\{1, 0, -2, 4, 0, 0, 0\\}$。\n\n3.  **确定输出映射：**\n    我们需要计算样本 $y[4]$。首先，我们找到输出 $y[n]$ 的支撑集。\n    $n_{y,min} = n_{x,min} + n_{h,min} = -2 + 3 = 1$。\n    从计算序列 $y_p[n]$ 到 $y[n]$ 的映射是 $y[n] = y_p[n-1]$。\n    因此，所需样本 $y[4]$ 对应于 $y_p[4-1] = y_p[3]$。\n\n4.  **计算所需样本：**\n    序列 $y_p[n]$ 是 $x_p[n]$ 和 $h_p[n]$ 的 $7$ 点圆周卷积的结果。我们直接根据此定义计算 $y_p[3]$：\n    $$y_p[3] = (x_p \\circledast_7 h_p)[3] = \\sum_{m=0}^{6} x_p[m] h_p[(3-m) \\pmod 7]$$\n    我们对 $m=0, 1, ..., 6$ 逐项展开求和。由于当 $m  3$ 时 $x_p[m]=0$，所以仅当 $m \\in [0,3]$ 时和才不为零。\n    - $m=0$：$x_p[0] h_p[(3-0) \\pmod 7] = x_p[0] h_p[3] = (2)(4) = 8$。\n    - $m=1$：$x_p[1] h_p[(3-1) \\pmod 7] = x_p[1] h_p[2] = (-1)(-2) = 2$。\n    - $m=2$：$x_p[2] h_p[(3-2) \\pmod 7] = x_p[2] h_p[1] = (3)(0) = 0$。\n    - $m=3$：$x_p[3] h_p[(3-3) \\pmod 7] = x_p[3] h_p[0] = (1)(1) = 1$。\n    - $m=4,5,6$：这些项为零，因为 $x_p[m]=0$。\n\n    对各项贡献求和：\n    $$y_p[3] = 8 + 2 + 0 + 1 = 11$$\n    由于 $y[4] = y_p[3]$，最终答案是 $11$。这个结果与通过直接计算线性卷积和得到的结果相同，这证实了该过程的正确性。", "answer": "$$\\boxed{11}$$", "id": "2880468"}, {"introduction": "在将理论算法转化为实际代码时，我们常常会遇到因软件库约定或疏忽而导致的细微错误，例如在快速傅里叶逆变换 (IFFT) 中遗漏缩放因子。这个问题探讨了如何诊断并纠正这类常见的实现错误。通过这个练习 [@problem_id:2880462]，您将学会如何利用离散傅里叶变换 (DFT) 在频率点 $k=0$ 处的内在性质（即直流分量特性），设计出一个仅依赖于可观测输入和输出来恢复正确结果的巧妙校正方案。", "problem": "考虑两个实值的有限长度离散时间信号 $x[n]$ 和 $h[n]$，其长度分别为 $L_{x}$ 和 $L_{h}$。将其补零至一个公共长度 $N \\geq L_{x}+L_{h}-1$，得到 $x_{N}[n]$ 和 $h_{N}[n]$。其中，当 $0 \\leq n \\leq L_{x}-1$ 时，$x_{N}[n]=x[n]$，否则 $x_{N}[n]=0$；$h_{N}[n]$ 的定义与此类似。设长度为 $N$ 的离散傅里叶变换 (DFT) 定义为\n$$\nX[k] \\triangleq \\sum_{n=0}^{N-1} x_{N}[n] \\exp\\!\\left(-j \\frac{2\\pi}{N}kn\\right), \\quad H[k] \\triangleq \\sum_{n=0}^{N-1} h_{N}[n] \\exp\\!\\left(-j \\frac{2\\pi}{N}kn\\right),\n$$\n其中 $k=0,1,\\ldots,N-1$，其对应的逆离散傅里叶变换 (IDFT) 定义为\n$$\nx_{N}[n] \\triangleq \\frac{1}{N} \\sum_{k=0}^{N-1} X[k] \\exp\\!\\left(j \\frac{2\\pi}{N}kn\\right), \\quad h_{N}[n] \\triangleq \\frac{1}{N} \\sum_{k=0}^{N-1} H[k] \\exp\\!\\left(j \\frac{2\\pi}{N}kn\\right),\n$$\n其中 $n=0,1,\\ldots,N-1$。真实的线性卷积为 $y[n] \\triangleq (x*h)[n]$，其中 $n=0,1,\\ldots,L_{x}+L_{h}-2$。\n\n一位工程师使用 DFT 和快速傅里叶变换 (FFT) 通过循环卷积嵌入来计算线性卷积，但在应用逆快速傅里叶变换 (IFFT) 时错误地省略了 $1/N$ 的缩放因子。具体来说，他们计算出\n$$\n\\tilde{y}[n] \\triangleq \\sum_{k=0}^{N-1} X[k]\\,H[k]\\,\\exp\\!\\left(j \\frac{2\\pi}{N}kn\\right), \\quad n=0,1,\\ldots,N-1,\n$$\n然后取前 $L_{x}+L_{h}-1$ 个样本作为所谓的线性卷积结果。\n\n严格依据上述定义及其推导出的标准性质，完成以下任务：\n\n1. 推导精确的标量幅度偏差 $\\alpha$，使得对于所有 $n \\in \\{0,1,\\ldots,L_{x}+L_{h}-2\\}$，都有 $\\tilde{y}[n] = \\alpha\\, y[n]$，并用 $N$ 表示 $\\alpha$。\n\n2. 提出一个检测和校正程序，该程序不假定先验知道 $N$ 或任何特定库的缩放约定。你的程序必须仅依赖于可直接从 $x[n]$、$h[n]$ 和计算出的 $\\tilde{y}[n]$ 中观测到的量。具体而言，推导一个标量校正因子 $\\hat{c}$，当它与 $\\tilde{y}[n]$ 相乘时，能对所有 $n \\in \\{0,1,\\ldots,L_{x}+L_{h}-2\\}$ 产生真实的线性卷积 $y[n]$。请纯粹使用 $\\sum_{n=0}^{L_{x}-1} x[n]$、$\\sum_{m=0}^{L_{h}-1} h[m]$ 和 $\\sum_{n=0}^{L_{x}+L_{h}-2} \\tilde{y}[n]$ 来表示 $\\hat{c}$。\n\n请给出校正因子 $\\hat{c}$ 的显式闭合形式解析表达式作为最终答案。不需要数值近似，也不涉及单位。", "solution": "审阅问题陈述的有效性。\n\n**第1步：提取已知条件**\n- 两个实值的有限长度信号，$x[n]$ 长度为 $L_x$，$h[n]$ 长度为 $L_h$。\n- 补零后的版本 $x_N[n]$ 和 $h_N[n]$，公共长度为 $N \\geq L_x+L_h-1$。\n- 长度为 $N$ 的离散傅里叶变换 (DFT) 定义：$X[k] \\triangleq \\sum_{n=0}^{N-1} x_{N}[n] \\exp(-j \\frac{2\\pi}{N}kn)$。\n- 长度为 $N$ 的逆离散傅里叶变换 (IDFT) 定义：$x_{N}[n] \\triangleq \\frac{1}{N} \\sum_{k=0}^{N-1} X[k] \\exp(j \\frac{2\\pi}{N}kn)$。\n- 线性卷积定义：$y[n] \\triangleq (x*h)[n]$，其中 $n=0,1,\\ldots,L_{x}+L_{h}-2$。\n- 错误计算的信号：$\\tilde{y}[n] \\triangleq \\sum_{k=0}^{N-1} X[k]\\,H[k]\\,\\exp(j \\frac{2\\pi}{N}kn)$。\n- 任务1：求标量偏差 $\\alpha$，使得 $\\tilde{y}[n] = \\alpha\\, y[n]$。\n- 任务2：用 $\\sum_{n=0}^{L_{x}-1} x[n]$、$\\sum_{m=0}^{L_{h}-1} h[m]$ 和 $\\sum_{n=0}^{L_{x}+L_{h}-2} \\tilde{y}[n]$ 表示校正因子 $\\hat{c}$。\n\n**第2步：使用提取的已知条件进行验证**\n该问题具有科学依据，因为它涉及使用离散傅里叶变换进行线性卷积的标准定义和应用，这是数字信号处理的基石。该问题是适定的，提供了所有必要的定义和约束，例如 $N \\geq L_x+L_h-1$，这是确保通过 DFT 实现的循环卷积等效于线性卷积的精确条件。在 IFFT 实现中缺少缩放因子的情况是一个实际且常见的错误。该问题是客观的，使用精确的数学语言并要求进行形式化推导。它没有表现出验证清单中列出的任何缺陷。\n\n**第3步：结论和行动**\n该问题被判定为**有效**。将提供完整解答。\n\n使用 DFT 执行线性卷积的基本原理是卷积定理。对于两个离散时间信号 $x_N[n]$ 和 $h_N[n]$，它们的循环卷积（表示为 $y_c[n] = (x_N \\circledast h_N)[n]$）的 DFT 是各自 DFT 的乘积：$Y_c[k] = X[k]H[k]$。\n原始信号 $x[n]$ 和 $h[n]$ 的线性卷积 $y[n]$ 的长度为 $L_y = L_x+L_h-1$。通过将输入信号补零至长度 $N \\geq L_y$，我们确保循环卷积 $y_c[n]$ 在前 $L_y$ 个样本上等同于线性卷积 $y[n]$，即当 $n \\in \\{0, 1, \\ldots, L_y-1\\}$ 时，$y_c[n] = y[n]$，而当 $n \\geq L_y$ 时，$y_c[n]=0$。\n\n我们将正确程序的结果称为 $y_N[n]$。它是通过对乘积 $X[k]H[k]$ 进行正确的逆 DFT 得到的。根据所提供的 IDFT 定义：\n$$\ny_N[n] = \\frac{1}{N} \\sum_{k=0}^{N-1} X[k]H[k] \\exp\\left(j \\frac{2\\pi}{N}kn\\right)\n$$\n对于 $n \\in \\{0, 1, \\ldots, L_x+L_h-2\\}$，这个 $y_N[n]$ 与真实的线性卷积 $y[n]$ 是相同的。\n\n**第1部分：推导标量幅度偏差 $\\alpha$**\n\n工程师计算了定义为 $\\tilde{y}[n]$ 的量：\n$$\n\\tilde{y}[n] \\triangleq \\sum_{k=0}^{N-1} X[k]H[k] \\exp\\left(j \\frac{2\\pi}{N}kn\\right)\n$$\n通过直接比较正确结果 $y_N[n]$ 和错误计算的 $\\tilde{y}[n]$ 的表达式，我们立即可以看出它们之间的关系：\n$$\n\\tilde{y}[n] = N \\cdot y_N[n]\n$$\n由于对于相关索引 $n \\in \\{0, 1, \\ldots, L_x+L_h-2\\}$，$y_N[n]=y[n]$，因此可以得出：\n$$\n\\tilde{y}[n] = N \\cdot y[n]\n$$\n因此，标量幅度偏差为 $\\alpha = N$。\n\n**第2部分：推导校正因子 $\\hat{c}$**\n\n任务是找到一个校正因子 $\\hat{c}$，使得 $\\hat{c} \\cdot \\tilde{y}[n] = y[n]$。根据第1部分，我们有 $\\tilde{y}[n] = N y[n]$，所以必须有 $\\hat{c} \\cdot (N y[n]) = y[n]$，这意味着 $\\hat{c} = \\frac{1}{N}$。然而，$N$ 是未知的。我们必须仅使用可观测的量来表示 $N$：输入信号 $x[n]$ 和 $h[n]$，以及计算出的输出 $\\tilde{y}[n]$。\n\n我们使用 DFT 在频率索引 $k=0$ 处的性质。$k=0$ 处的 DFT 是时域样本的总和。对于输入信号 $x[n]$ 和 $h[n]$，其补零版本 $x_N[n]$ 和 $h_N[n]$ 的 DFT 分别为 $X[k]$ 和 $H[k]$。\n在 $k=0$ 时：\n$$\nX[0] = \\sum_{n=0}^{N-1} x_N[n] \\exp(0) = \\sum_{n=0}^{N-1} x_N[n] = \\sum_{n=0}^{L_x-1} x[n]\n$$\n$$\nH[0] = \\sum_{m=0}^{N-1} h_N[m] \\exp(0) = \\sum_{m=0}^{N-1} h_N[m] = \\sum_{m=0}^{L_h-1} h[m]\n$$\n现在考虑计算出的信号 $\\tilde{y}[n]$ 的样本总和。我们对从 $n=0$ 到 $N-1$ 的整个周期求和：\n$$\n\\sum_{n=0}^{N-1} \\tilde{y}[n] = \\sum_{n=0}^{N-1} \\left( \\sum_{k=0}^{N-1} X[k]H[k] \\exp\\left(j \\frac{2\\pi}{N}kn\\right) \\right)\n$$\n通过交换求和顺序：\n$$\n\\sum_{n=0}^{N-1} \\tilde{y}[n] = \\sum_{k=0}^{N-1} X[k]H[k] \\left( \\sum_{n=0}^{N-1} \\exp\\left(j \\frac{2\\pi}{N}kn\\right) \\right)\n$$\n内部的和是 DFT 基向量的一个基本恒等式。当 $k=0$（或 $N$ 的任何整数倍）时，其值为 $N$，否则为 $0$。对于 $k \\in \\{0, 1, \\ldots, N-1\\}$，该和仅在 $k=0$ 时非零。\n$$\n\\sum_{n=0}^{N-1} \\exp\\left(j \\frac{2\\pi}{N}kn\\right) = N \\delta[k]\n$$\n其中 $\\delta[k]$ 是克罗内克（Kronecker）$\\delta$ 函数。\n将此代入 $\\tilde{y}[n]$ 总和的表达式中，得到：\n$$\n\\sum_{n=0}^{N-1} \\tilde{y}[n] = \\sum_{k=0}^{N-1} X[k]H[k] (N \\delta[k]) = N \\cdot X[0]H[0]\n$$\n如前所述，真实的线性卷积 $y[n]$ 仅在 $n \\in \\{0, 1, \\ldots, L_x+L_h-2\\}$ 时非零。由于 $\\tilde{y}[n] = N y[n]$，因此当 $n \\geq L_x+L_h-1$ 时，$\\tilde{y}[n]$ 也必须为零。因此，$\\tilde{y}[n]$ 从 $n=0$ 到 $N-1$ 的总和与从 $n=0$ 到 $L_x+L_h-2$ 的总和是相同的：\n$$\n\\sum_{n=0}^{L_x+L_h-2} \\tilde{y}[n] = \\sum_{n=0}^{N-1} \\tilde{y}[n]\n$$\n结合这些结果，我们在可观测量之间建立了一个关系：\n$$\n\\sum_{n=0}^{L_x+L_h-2} \\tilde{y}[n] = N \\cdot X[0]H[0] = N \\left( \\sum_{n=0}^{L_x-1} x[n] \\right) \\left( \\sum_{m=0}^{L_h-1} h[m] \\right)\n$$\n我们可以从此方程中解出 $N$，前提是输入信号总和的乘积非零这个非平凡条件成立：\n$$\nN = \\frac{\\sum_{n=0}^{L_x+L_h-2} \\tilde{y}[n]}{\\left( \\sum_{n=0}^{L_x-1} x[n] \\right) \\left( \\sum_{m=0}^{L_h-1} h[m] \\right)}\n$$\n所需的校正因子是 $\\hat{c} = \\frac{1}{N}$。因此：\n$$\n\\hat{c} = \\frac{\\left( \\sum_{n=0}^{L_x-1} x[n] \\right) \\left( \\sum_{m=0}^{L_h-1} h[m] \\right)}{\\sum_{n=0}^{L_x+L_h-2} \\tilde{y}[n]}\n$$\n此表达式仅依赖于已知输入信号 $x[n]$ 和 $h[n]$ 的样本总和，以及错误计算的输出 $\\tilde{y}[n]$ 的样本总和，符合要求。将 $\\tilde{y}[n]$ 乘以该因子 $\\hat{c}$ 将校正缩放错误，并产生真实的线性卷积 $y[n]$。", "answer": "$$\n\\boxed{\\frac{\\left( \\sum_{n=0}^{L_x-1} x[n] \\right) \\left( \\sum_{m=0}^{L_h-1} h[m] \\right)}{\\sum_{n=0}^{L_x+L_h-2} \\tilde{y}[n]}}\n$$", "id": "2880462"}, {"introduction": "对于长序列或实时信号处理，必须采用分块卷积方法，如重叠相加法 (Overlap-Add, OLA)，以在有限的内存和延迟下进行计算。然而，这些方法的性能取决于关键参数（如 FFT 长度 $N$ 和块长度 $L_b$）的选择。这个高级练习 [@problem_id:2880451] 模拟了一个真实的工程设计挑战，要求您在满足算法约束（无混叠）和系统指标（延迟预算）的前提下，通过系统优化来最小化计算成本，从而找到最佳的实现方案。", "problem": "一个因果有限脉冲响应（FIR）滤波器，其脉冲响应长度为 $M = 601$ 个采样点，将通过使用重叠相加（OLA）法并借助离散傅里叶变换（DFT）来实现线性卷积。设 $L_b$ 表示每块处理的新输入采样点数，设 $N$ 表示 DFT 的大小。假设使用基-2 快速傅里叶变换（FFT），且 $N$ 必须是 2 的幂。脉冲响应的 DFT 是离线预先计算好的，并对所有数据块重复使用。\n\n您的设计目标是选择 $N$ 和 $L_b$，以最小化每个输入采样点的平均复数乘法次数，并满足以下约束条件：\n- 无时域混叠的线性卷积要求 $N \\geq L_b + M - 1$。\n- 端到端的算法延迟是滤波器群延迟和数据块累积延迟之和。将群延迟建模为 $M - 1$ 个采样点，数据块累积延迟建模为 $L_b - 1$ 个采样点，因此总延迟为 $M + L_b - 2$ 个采样点。该总延迟不得超过预算 $L_{\\max} = 1440$ 个采样点。\n- FFT 大小 $N$ 必须是 2 的幂。\n\n仅使用线性卷积、OLA 块结构和基-2 FFT 标准复杂度缩放的基本定义，从第一性原理出发，推导每块的计算成本，将其转换为每个输入采样点的平均成本，描述约束条件所隐含的可行集，并确定使每个输入采样点的平均成本最小化的最优 $(N, L_b)$。请提供严格的最优性证明。\n\n以有序对 $(N_{\\mathrm{opt}}, L_{b,\\mathrm{opt}})$ 的形式报告您的最终答案，其中每个条目都是整数个采样点。无需四舍五入，最终答案中不包含物理单位。", "solution": "所述问题具有科学依据，提法恰当且客观。它为数字信号处理中的一个标准优化任务提供了一套完整的约束条件和一个明确的目标函数。因此，该问题是有效的，我们将继续进行其形式化求解。\n\n目标是最小化每个输入采样点的平均复数乘法次数，我们将其表示为 $C_{sample}$。该成本由使用重叠相加（OLA）法和基-2 快速傅里叶变换（FFT）实现线性卷积的方式决定。\n\n首先，我们确定每块的计算成本。对于每个新输入采样点块，OLA 方法涉及三个对乘法计数有贡献的主要步骤：\n1.  对输入块进行一次 $N$ 点 FFT。\n2.  变换后的输入与预先计算好的变换后的滤波器响应进行逐元素复数乘法。\n3.  进行一次 $N$ 点逆 FFT（IFFT）以获得时域输出块。\n\n大小为 $N$ 的基-2 FFT 的复数乘法次数为 $\\frac{N}{2} \\log_2(N)$。IFFT 具有相同的计算复杂度。两个 $N$ 点向量的逐元素乘积需要 $N$ 次复数乘法。滤波器脉冲响应的 DFT 是预先计算的，因此其成本不属于长输入信号的每块计算部分。\n\n每块的总复数乘法次数 $C_{block}$ 是这三个操作成本的总和：\n$$ C_{block} = \\left(\\frac{N}{2} \\log_2(N)\\right)_{\\text{FFT}} + (N)_{\\text{Product}} + \\left(\\frac{N}{2} \\log_2(N)\\right)_{\\text{IFFT}} = N \\log_2(N) + N = N (\\log_2(N) + 1) $$\n每个块处理 $L_b$ 个新的输入采样点。因此，每个输入采样点的平均复数乘法次数为：\n$$ C_{sample}(N, L_b) = \\frac{C_{block}}{L_b} = \\frac{N (\\log_2(N) + 1)}{L_b} $$\n我们的目标是在给定约束条件下最小化该函数 $C_{sample}(N, L_b)$。\n\n接下来，我们形式化变量 $N$ 和 $L_b$ 的约束条件。\n问题给出了滤波器脉冲响应长度 $M = 601$ 个采样点。\n\n约束 1：为避免线性卷积中的时域混叠，DFT 大小 $N$ 必须至少为卷积后序列的长度，即 $(L_b + M - 1)$。\n$$ N \\geq L_b + M - 1 \\implies N \\geq L_b + 601 - 1 \\implies N \\geq L_b + 600 $$\n这可以重写为对于给定 $N$ 的 $L_b$ 的上界：\n$$ L_b \\leq N - 600 $$\n\n约束 2：总算法延迟不得超过预算 $L_{\\max} = 1440$ 个采样点。延迟给定为 $M + L_b - 2$。\n$$ M + L_b - 2 \\leq L_{\\max} \\implies 601 + L_b - 2 \\leq 1440 \\implies L_b + 599 \\leq 1440 $$\n这为 $L_b$ 提供了一个固定的上界：\n$$ L_b \\leq 1440 - 599 \\implies L_b \\leq 841 $$\n\n约束 3：DFT 大小 $N$ 必须是 2 的幂，即对于某个正整数 $k$，$N = 2^k$。\n\n为了最小化成本函数 $C_{sample}(N, L_b) = \\frac{N (\\log_2(N) + 1)}{L_b}$，对于任何固定的 $N$ 值，我们必须选择 $L_b$ 的最大可能值。结合 $L_b$ 的两个上界，我们发现对于给定的 $N$，最优的 $L_b$ 是：\n$$ L_{b,\\mathrm{opt}}(N) = \\min(N - 600, 841) $$\n我们还必须确保 $L_b \\geq 1$，根据第一个约束，这意味着 $N - 600 \\geq 1$，所以 $N \\geq 601$。由于 $N$ 必须是 2 的幂，所以 $N$ 的最小可能值为 $2^{10} = 1024$，因为 $2^9 = 512  601$。\n\n将 $L_{b,\\mathrm{opt}}(N)$ 代入成本函数，我们得到一个只依赖于 $N$ 的成本函数：\n$$ C(N) = \\frac{N (\\log_2(N) + 1)}{\\min(N - 600, 841)} $$\n该函数的行为取决于最小值运算符中的哪一项是激活的。交叉点发生在 $N - 600 = 841$ 时，即 $N = 1441$。\n\n情况 1：$N  1441$。\n在此范围内，$N - 600  841$，所以 $\\min(N - 600, 841) = N - 600$。成本函数是：\n$$ C_1(N) = \\frac{N (\\log_2(N) + 1)}{N - 600} $$\n满足 $601 \\leq N  1441$ 的唯一的 2 的幂是 $N = 1024$。\n当 $N = 1024$ 时，最优块大小为 $L_b = 1024 - 600 = 424$。相应的成本是：\n$$ C(1024) = \\frac{1024 (\\log_2(1024) + 1)}{424} = \\frac{1024 (10 + 1)}{424} = \\frac{1024 \\times 11}{424} \\approx 26.566 $$\n\n情况 2：$N \\geq 1441$。\n在此范围内，$N - 600 \\geq 841$，所以 $\\min(N - 600, 841) = 841$。最优的 $L_b$ 固定为 $841$。成本函数是：\n$$ C_2(N) = \\frac{N (\\log_2(N) + 1)}{841} $$\n我们必须找到最小化 $C_2(N)$ 且 $N \\geq 1441$ 的 2 的幂。让我们考察分子 $f(N) = N (\\log_2(N) + 1)$。它关于 $N$ 的导数是 $f'(N) = \\log_2(N) + 1 + \\frac{1}{\\ln(2)}$。对于 $N \\geq 1441$，该导数显然为正，意味着 $f(N)$ 是 $N$ 的严格递增函数。因此，对于 $N \\geq 1441$，$C_2(N)$ 也是严格递增的。在此区域内，$C_2(N)$ 的最小值将出现在 $N$ 的最小可能 2 的幂处，即 $N = 2^{11} = 2048$。\n当 $N = 2048$ 时，最优块大小为 $L_b = 841$。相应的成本是：\n$$ C(2048) = \\frac{2048 (\\log_2(2048) + 1)}{841} = \\frac{2048 (11 + 1)}{841} = \\frac{2048 \\times 12}{841} \\approx 29.222 $$\n\n最后，我们必须比较两种情况下的最小成本以找到全局最小值。\n$$ C(1024) \\approx 26.566 $$\n$$ C(2048) \\approx 29.222 $$\n由于 $C(1024)  C(2048)$，最小平均计算成本在情况 1 中实现。因此，唯一的最优参数是 $N_{\\mathrm{opt}} = 1024$ 和相应的块大小 $L_{b,\\mathrm{opt}} = 1024 - 600 = 424$。\n\n这对参数 $(N_{\\mathrm{opt}}, L_{b,\\mathrm{opt}}) = (1024, 424)$ 满足所有约束条件：\n1.  $N = 1024 \\geq L_b + 600 = 424 + 600 = 1024$。该条件以等式成立。\n2.  $L_b = 424 \\leq 841$。该条件成立。\n3.  $N = 1024$ 是 2 的幂。\n\n该解是最优的，因为我们通过首先针对给定的 $N$ 优化 $L_b$，然后在 $N$ 的有效 2 的幂次域上分析得到的成本函数，系统地搜索了离散 $(N, L_b)$ 对的整个可行空间。\n最优对是 $(N_{\\mathrm{opt}}, L_{b,\\mathrm{opt}}) = (1024, 424)$。", "answer": "$$\n\\boxed{(1024, 424)}\n$$", "id": "2880451"}]}