{"hands_on_practices": [{"introduction": "数字滤波器中的有限字长效应首先体現在对信号本身的量化上。本练习将带领我们分析一个典型的有限脉冲响应（FIR）滤波器实现，其中的噪声源于两个主要环节：每次乘法后的乘积量化和累加和的最终量化。通过将量化误差建模为加性白噪声，我们可以推导出不同噪声源对总输出误差的贡献，这对于在硬件设计中合理分配比特数以平衡精度和成本至关重要。[@problem_id:2872520]", "problem": "考虑一个长度为 $M$ 的有限冲激响应（FIR）滤波器，其冲激响应系数为 $\\{h_k\\}_{k=0}^{M-1}$，作用于一个实值输入序列 $\\{x[n]\\}$。理想输出为 $y[n] = \\sum_{k=0}^{M-1} h_k x[n-k]$。该实现是定点的，并按以下方式进行：首先计算每个乘积 $h_k x[n-k]$，然后用一个 $B_p$ 位的有符号、对称、中央步进、均匀量化器进行舍入；之后，所有舍入后的乘积被精确累加；最后，累加和再次通过一个 $B_a$ 位的有符号、对称、中央步进、均匀量化器进行舍入以产生输出。假设如下。\n\n- 对于所有 $n$，输入满足一个已知界限 $|x[n]| \\leq X_{\\max}$，并且实现采用逐乘法器满量程归一化，使得第 $k$ 个乘积量化器覆盖对称范围 $\\pm X_{\\max} |h_k|$，而最终的输出量化器覆盖对称范围 $\\pm X_{\\max} \\sum_{k=0}^{M-1} |h_k|$，从而在最坏情况的信号组合下避免溢出。\n- 每个均匀量化器都通过一个加性、白色、与信号不相关的量化噪声来建模，该噪声均值为零，方差为 $\\Delta^2/12$，其中 $\\Delta$ 是量化步长。来自不同量化器和不同时间索引的量化噪声是相互不相关的。\n- 除了所述的两次舍入外，所有其他算术运算都是精确的。\n\n将由乘积量化引起的输出噪声定义为滤波器输出中仅源于各个乘积舍入的分量，并将由加法器量化引起的输出噪声定义为仅源于累加后最终舍入的分量。从所述的假设以及均匀量化噪声和线性系统的基本性质出发，推导乘积量化引起的输出噪声功率与加法器量化引起的输出噪声功率之比 $R$ 的闭式表达式，该表达式是 $M$、系数幅值 $\\{|h_k|\\}$、$B_p$ 和 $B_a$ 的函数。你的最终答案必须是关于 $M$、$\\{|h_k|\\}$、$B_p$ 和 $B_a$ 的单个解析表达式。除了给定的建模假设外，不要引入任何额外的近似。答案是无量纲的；不要包含单位。", "solution": "问题要求推导在定点有限冲激响应（FIR）滤波器实现中两种不同量化噪声功率的比率。分析将从问题陈述中指定的量化误差建模的基本原理出发。\n\n首先，我们对滤波器的运算进行形式化。理想输出 $y[n]$ 由下式给出\n$$y[n] = \\sum_{k=0}^{M-1} h_k x[n-k]$$\n我们用 $\\hat{y}[n]$ 表示的实现输出受到两个阶段的量化。第一阶段是每个乘积 $p_k[n] = h_k x[n-k]$ 的舍入，第二阶段是最终累加和的舍入。\n\n令 $Q_{p,k}(\\cdot)$ 表示第 $k$ 个乘积的量化器，令 $Q_a(\\cdot)$ 表示最终和的量化器。实现的输出 $\\hat{y}[n]$ 由下式给出\n$$\\hat{y}[n] = Q_a\\left(\\sum_{k=0}^{M-1} Q_{p,k}(h_k x[n-k])\\right)$$\n我们将每个量化器 $Q(\\cdot)$ 建模为一个加性噪声源 $e$，使得 $Q(z) = z + e$。假设噪声 $e$ 是一个零均值随机过程，其方差为 $\\sigma_e^2 = \\frac{\\Delta^2}{12}$，其中 $\\Delta$ 是量化步长。\n\n对于一个在范围 $\\pm F$ 内的有符号、对称、$B$ 位量化器，其量化步长 $\\Delta$ 由满量程范围 $2F$ 和量化级别数 $2^B$ 决定。因此，\n$$\\Delta = \\frac{2F}{2^B} = F \\cdot 2^{1-B}$$\n\n现在，我们分析问题中定义的两个噪声源。\n\n1.  **由乘积量化引起的输出噪声功率 ($\\sigma_{p,\\text{out}}^2$)**\n\n该噪声源于对 $M$ 个单独乘积的舍入。令 $e_{p,k}[n]$ 为舍入第 $k$ 个乘积所产生的量化误差：\n$$Q_{p,k}(h_k x[n-k]) = h_k x[n-k] + e_{p,k}[n]$$\n这些乘积量化误差对最终累加器输入的总贡献是其总和：\n$$e_p[n] = \\sum_{k=0}^{M-1} e_{p,k}[n]$$\n由于累加是精确的，这个和代表了在最终舍入前存在于系统输出端的总乘积量化噪声分量。该噪声的功率是其方差，$\\sigma_{p,\\text{out}}^2 = \\text{Var}(e_p[n])$。\n根据问题陈述，来自不同乘法器（不同的 $k$）的量化噪声 $e_{p,k}[n]$ 是不相关的。因此，和的方差是方差的和：\n$$\\sigma_{p,\\text{out}}^2 = \\text{Var}\\left(\\sum_{k=0}^{M-1} e_{p,k}[n]\\right) = \\sum_{k=0}^{M-1} \\text{Var}(e_{p,k}[n])$$\n每个单独乘积噪声的方差 $\\text{Var}(e_{p,k}[n])$ 为 $\\frac{\\Delta_{p,k}^2}{12}$，其中 $\\Delta_{p,k}$ 是第 $k$ 个乘积量化器的步长。该量化器有 $B_p$ 位，其范围被指定为 $\\pm X_{\\max} |h_k|$。所以，其满量程值为 $F_k = X_{\\max} |h_k|$。步长为：\n$$\\Delta_{p,k} = F_k \\cdot 2^{1-B_p} = X_{\\max} |h_k| 2^{1-B_p}$$\n第 $k$ 个乘积噪声的方差为：\n$$\\text{Var}(e_{p,k}[n]) = \\frac{\\Delta_{p,k}^2}{12} = \\frac{(X_{\\max} |h_k| 2^{1-B_p})^2}{12} = \\frac{X_{\\max}^2 |h_k|^2 2^{2(1-B_p)}}{12}$$\n将此代入总乘积噪声功率的求和公式中，我们得到：\n$$\\sigma_{p,\\text{out}}^2 = \\sum_{k=0}^{M-1} \\frac{X_{\\max}^2 |h_k|^2 2^{2(1-B_p)}}{12} = \\frac{X_{\\max}^2 2^{2(1-B_p)}}{12} \\sum_{k=0}^{M-1} |h_k|^2$$\n\n2.  **由加法器量化引起的输出噪声功率 ($\\sigma_{a,\\text{out}}^2$)**\n\n这个我们记为 $e_a[n]$ 的噪声是由最终的舍入操作 $Q_a(\\cdot)$ 引入的。该量化器的输入是舍入后乘积的精确和。输出为：\n$$\\hat{y}[n] = Q_a\\left(\\sum_{k=0}^{M-1} Q_{p,k}(h_k x[n-k])\\right) = \\left(\\sum_{k=0}^{M-1} Q_{p,k}(h_k x[n-k])\\right) + e_a[n]$$\n问题将“由加法器量化引起的输出噪声”定义为仅源于这次最终舍入的分量。这正是 $e_a[n]$。其功率是方差 $\\sigma_{a,\\text{out}}^2 = \\text{Var}(e_a[n])$。\n该方差由 $\\frac{\\Delta_a^2}{12}$ 给出，其中 $\\Delta_a$ 是最终累加器量化器的步长。该量化器有 $B_a$ 位，其范围被指定为 $\\pm X_{\\max} \\sum_{k=0}^{M-1} |h_k|$。满量程值为 $F_a = X_{\\max} \\sum_{k=0}^{M-1} |h_k|$。步长为：\n$$\\Delta_a = F_a \\cdot 2^{1-B_a} = \\left(X_{\\max} \\sum_{k=0}^{M-1} |h_k|\\right) 2^{1-B_a}$$\n因此，加法器量化噪声的方差为：\n$$\\sigma_{a,\\text{out}}^2 = \\frac{\\Delta_a^2}{12} = \\frac{\\left(\\left(X_{\\max} \\sum_{k=0}^{M-1} |h_k|\\right) 2^{1-B_a}\\right)^2}{12} = \\frac{X_{\\max}^2 \\left(\\sum_{k=0}^{M-1} |h_k|\\right)^2 2^{2(1-B_a)}}{12}$$\n\n3.  **噪声功率之比 ($R$)**\n\n问题要求的是由乘积量化引起的输出噪声功率与由加法器量化引起的输出噪声功率之比 $R$。\n$$R = \\frac{\\sigma_{p,\\text{out}}^2}{\\sigma_{a,\\text{out}}^2}$$\n代入上面推导出的表达式：\n$$R = \\frac{\\frac{X_{\\max}^2 2^{2(1-B_p)}}{12} \\sum_{k=0}^{M-1} |h_k|^2}{\\frac{X_{\\max}^2 \\left(\\sum_{k=0}^{M-1} |h_k|\\right)^2 2^{2(1-B_a)}}{12}}$$\n分子和分母中的公因子 $\\frac{X_{\\max}^2}{12}$ 被消掉。我们剩下：\n$$R = \\frac{2^{2(1-B_p)} \\sum_{k=0}^{M-1} |h_k|^2}{2^{2(1-B_a)} \\left(\\sum_{k=0}^{M-1} |h_k|\\right)^2}$$\n简化指数项：\n$$\\frac{2^{2(1-B_p)}}{2^{2(1-B_a)}} = 2^{2(1-B_p) - 2(1-B_a)} = 2^{2-2B_p - 2+2B_a} = 2^{2B_a - 2B_p} = 2^{2(B_a - B_p)}$$\n因此，比率 $R$ 的最终表达式为：\n$$R = 2^{2(B_a - B_p)} \\frac{\\sum_{k=0}^{M-1} |h_k|^2}{\\left(\\sum_{k=0}^{M-1} |h_k|\\right)^2}$$\n该表达式是 $M$（隐含在求和中）、系数幅值 $\\{|h_k|\\}$ 以及位深度 $B_p$ 和 $B_a$ 的函数，符合要求。", "answer": "$$ \\boxed{ 2^{2(B_a-B_p)} \\frac{\\sum_{k=0}^{M-1} |h_k|^2}{\\left(\\sum_{k=0}^{M-1} |h_k|\\right)^2} } $$", "id": "2872520"}, {"introduction": "与FIR滤波器不同，无限脉冲响应（IIR）滤波器中的反馈环路使得噪声分析更为复杂。本练习介绍了一种更为强大和通用的分析工具：状态空间法。我们将一个带有内部量化噪声的IIR滤波器表示为状态空间模型，并通过求解离散时间的李雅普诺夫方程来精确计算输出噪声的稳态方差，揭示系统内部状态协方差与输出噪声功率之间的直接联系。[@problem_id:2872507]", "problem": "考虑一个离散时间、线性时不变状态空间系统，该系统对状态更新中的有限字长舍入进行建模：\n$x[n+1] = A x[n] + w[n]$ 和 $y[n] = C x[n]$，\n其中 $A \\in \\mathbb{R}^{2 \\times 2}$ 和 $C \\in \\mathbb{R}^{1 \\times 2}$ 由下式给出\n$A = \\begin{bmatrix} \\tfrac{3}{5}  \\tfrac{1}{5} \\\\ 0  \\tfrac{1}{2} \\end{bmatrix}$ 和 $C = \\begin{bmatrix} 1  -1 \\end{bmatrix}$。\n信号 $w[n] \\in \\mathbb{R}^{2}$ 是一个零均值白扰动，用于建模状态计算中因有限字长引起的量化噪声，其协方差为 $\\mathbb{E}\\{w[n] w[n]^{\\top}\\} = \\sigma_{w}^{2} I_{2}$，且 $\\sigma_{w}^{2} = \\Delta^{2}/12$，其中 $\\Delta$ 是量化器步长。假设 $x[0]$ 是零均值，与 $w[n]$ 无关，并且系统是渐近稳定的。\n\n仅从具有白噪声输入的线性系统的二阶矩定义以及稳定线性时不变递推的平稳协方差的唯一性出发，完成以下任务：\n- 通过求解由动力学特性和 $w[n]$ 的白噪声特性所蕴含的适当的离散时间李雅普诺夫方程，推导稳态状态协方差矩阵 $P = \\mathbb{E}\\{x[n] x[n]^{\\top}\\}$。\n- 使用 $P$ 计算稳态输出方差 $\\sigma_{y}^{2} = \\mathbb{E}\\{y[n]^{2}\\}$。\n- 使用稳定、严格真离散时间系统的Hardy空间二范数（$\\mathcal{H}_{2}$范数）的定义，将 $\\sigma_{y}^{2}$ 与从 $w[n]$ 到 $y[n]$ 的传递函数的$\\mathcal{H}_{2}$范数的平方联系起来，并以 $\\sigma_{w}^{2}$ 的形式确定相应的比例常数。\n\n请仅用 $\\Delta$ 将稳态输出方差 $\\sigma_{y}^{2}$ 表示为单个、简化的闭式表达式。不要对答案进行近似或四舍五入；无需单位。", "solution": "我们的目标是计算稳态输出方差 $\\sigma_{y}^{2}$。这需要先计算稳态状态协方差矩阵 $P$。\n\n1.  **求解离散时间李雅普诺夫方程**\n\n根据定义，稳态状态协方差矩阵是 $P = \\mathbb{E}\\{x[n] x[n]^{\\top}\\}$。由于系统处于稳态， $P$ 不随时间变化，即 $\\mathbb{E}\\{x[n+1] x[n+1]^{\\top}\\} = P$。\n利用状态方程 $x[n+1] = A x[n] + w[n]$，我们有：\n$$\nP = \\mathbb{E}\\{(A x[n] + w[n])(A x[n] + w[n])^{\\top}\\}\n$$\n$$\nP = \\mathbb{E}\\{A x[n] x[n]^{\\top} A^{\\top} + A x[n] w[n]^{\\top} + w[n] x[n]^{\\top} A^{\\top} + w[n] w[n]^{\\top}\\}\n$$\n由于 $x[n]$ 仅依赖于过去的噪声样本，而 $w[n]$ 是白噪声，所以 $x[n]$ 和 $w[n]$ 是不相关的，即 $\\mathbb{E}\\{x[n] w[n]^{\\top}\\} = 0$。因此，中间两项的期望为零。方程简化为：\n$$\nP = A \\mathbb{E}\\{x[n] x[n]^{\\top}\\} A^{\\top} + \\mathbb{E}\\{w[n] w[n]^{\\top}\\}\n$$\n这就得到了离散时间李雅普诺夫方程：\n$$\nP = APA^{\\top} + Q\n$$\n其中 $Q = \\mathbb{E}\\{w[n] w[n]^{\\top}\\} = \\sigma_w^2 I_2$。\n设 $P = \\begin{bmatrix} p_{11}  p_{12} \\\\ p_{21}  p_{22} \\end{bmatrix}$。由于 $P$ 是协方差矩阵，它是对称的，$p_{12} = p_{21}$。\n我们将矩阵方程展开为一组标量方程：\n$P - APA^\\top = \\sigma_w^2 I$\n$$\n\\begin{bmatrix} p_{11}  p_{12} \\\\ p_{12}  p_{22} \\end{bmatrix} - \\begin{bmatrix} \\frac{3}{5}  \\frac{1}{5} \\\\ 0  \\frac{1}{2} \\end{bmatrix} \\begin{bmatrix} p_{11}  p_{12} \\\\ p_{12}  p_{22} \\end{bmatrix} \\begin{bmatrix} \\frac{3}{5}  0 \\\\ \\frac{1}{5}  \\frac{1}{2} \\end{bmatrix} = \\begin{bmatrix} \\sigma_w^2  0 \\\\ 0  \\sigma_w^2 \\end{bmatrix}\n$$\n计算 $APA^\\top$：\n$$\nAPA^\\top = \\begin{bmatrix} \\frac{9}{25}p_{11}+\\frac{6}{25}p_{12}+\\frac{1}{25}p_{22}  \\frac{3}{10}p_{12}+\\frac{1}{10}p_{22} \\\\ \\frac{3}{10}p_{12}+\\frac{1}{10}p_{22}  \\frac{1}{4}p_{22} \\end{bmatrix}\n$$\n这给出了三个独立的方程：\n(1) $p_{22} - \\frac{1}{4}p_{22} = \\sigma_w^2 \\implies \\frac{3}{4}p_{22} = \\sigma_w^2 \\implies p_{22} = \\frac{4}{3}\\sigma_w^2$\n(2) $p_{12} - (\\frac{3}{10}p_{12}+\\frac{1}{10}p_{22}) = 0 \\implies \\frac{7}{10}p_{12} = \\frac{1}{10}p_{22} \\implies p_{12} = \\frac{1}{7}p_{22} = \\frac{1}{7}\\left(\\frac{4}{3}\\sigma_w^2\\right) = \\frac{4}{21}\\sigma_w^2$\n(3) $p_{11} - (\\frac{9}{25}p_{11}+\\frac{6}{25}p_{12}+\\frac{1}{25}p_{22}) = \\sigma_w^2 \\implies \\frac{16}{25}p_{11} - \\frac{6}{25}p_{12} - \\frac{1}{25}p_{22} = \\sigma_w^2$\n将 $p_{12}$ 和 $p_{22}$ 代入 (3)：\n$$\n\\frac{16}{25}p_{11} = \\sigma_w^2 + \\frac{6}{25}\\left(\\frac{4}{21}\\sigma_w^2\\right) + \\frac{1}{25}\\left(\\frac{4}{3}\\sigma_w^2\\right) = \\sigma_w^2 \\left(1 + \\frac{24}{525} + \\frac{28}{525}\\right) = \\sigma_w^2 \\left(\\frac{525+24+28}{525}\\right) = \\frac{577}{525}\\sigma_w^2\n$$\n$$\np_{11} = \\frac{577}{525} \\cdot \\frac{25}{16} \\sigma_w^2 = \\frac{577}{21 \\cdot 16} \\sigma_w^2 = \\frac{577}{336}\\sigma_w^2\n$$\n所以，稳态状态协方差矩阵为 $P = \\sigma_w^2 \\begin{bmatrix} 577/336  4/21 \\\\ 4/21  4/3 \\end{bmatrix}$。\n\n2.  **计算输出方差**\n\n输出方差由 $\\sigma_y^2 = \\mathbb{E}\\{y[n]^2\\} = \\mathbb{E}\\{ (C x[n]) (C x[n])^\\top \\} = C \\mathbb{E}\\{x[n]x[n]^\\top\\} C^\\top = C P C^\\top$ 给出。\n$$\n\\sigma_y^2 = \\begin{bmatrix} 1  -1 \\end{bmatrix} P \\begin{bmatrix} 1 \\\\ -1 \\end{bmatrix} = p_{11} - 2p_{12} + p_{22}\n$$\n代入我们求得的 $P$ 的元素：\n$$\n\\sigma_y^2 = \\left(\\frac{577}{336} - 2\\cdot\\frac{4}{21} + \\frac{4}{3}\\right) \\sigma_w^2\n$$\n使用公共分母 336：\n$$\n\\sigma_y^2 = \\left(\\frac{577}{336} - \\frac{8 \\cdot 16}{21 \\cdot 16} + \\frac{4 \\cdot 112}{3 \\cdot 112}\\right) \\sigma_w^2 = \\left(\\frac{577 - 128 + 448}{336}\\right) \\sigma_w^2 = \\frac{897}{336}\\sigma_w^2\n$$\n将分数化简：$897 = 3 \\times 299$，$336 = 3 \\times 112$。\n$$\n\\sigma_y^2 = \\frac{299}{112} \\sigma_w^2\n$$\n\n3.  **与 $\\mathcal{H}_2$ 范数的关系及最终答案**\n\n对于一个由输入 $w[n]$ 驱动的系统，其传递函数为 $H(z)$，当 $w[n]$ 是方差为 $\\sigma_w^2$ 的白噪声时，输出方差为 $\\sigma_y^2 = \\sigma_w^2 \\|H\\|_2^2$。因此，从 $w[n]$ 到 $y[n]$ 的传递函数的 $\\mathcal{H}_2$ 范数平方为 $\\|H\\|_2^2 = \\frac{299}{112}$。\n最后，将 $\\sigma_w^2 = \\Delta^2/12$ 代入 $\\sigma_y^2$ 的表达式：\n$$\n\\sigma_y^2 = \\frac{299}{112} \\left(\\frac{\\Delta^2}{12}\\right) = \\frac{299}{1344}\\Delta^2\n$$", "answer": "$$\\boxed{\\frac{299}{1344}\\Delta^{2}}$$", "id": "2872507"}, {"introduction": "除了信号量化，滤波器系数的量化是另一个主要的误差来源，它会直接改变滤波器的频率响应特性。本练习探讨如何量化这种影响，核心在于进行灵敏度分析，即推导滤波器幅度响应对其系数的梯度。基于此梯度，我们可以构建一个一阶模型来预测因系数舍入而导致的通带波纹增加的期望值，这对于确定满足设计指标所需的系数精度至关重要。[@problem_id:2872536]", "problem": "考虑一个长度为$N$的实系数有限冲激响应 (FIR) 滤波器，其冲激响应为 $\\{h[n]\\}_{n=0}^{N-1}$，频率响应为 $H(\\exp(j\\omega)) = \\sum_{n=0}^{N-1} h[n] \\exp(-j\\omega n)$。角频率 $\\omega$ 的单位是 弧度/采样点。设其幅度响应为 $|H(\\exp(j\\omega))|$。假设系数存在微小扰动，并在适当之处使用一阶（线性）近似。\n\n任务 1 (梯度推导): 从幅度响应的定义 $|H(\\exp(j\\omega))| = \\sqrt{H(\\exp(j\\omega)) H^{\\ast}(\\exp(j\\omega))}$ 以及频率响应相对于系数 $\\{h[n]\\}$ 的线性特性出发，推导 $|H(\\exp(j\\omega))|$ 关于实值FIR系数的梯度，即，为每个整数 $n \\in \\{0,1,\\dots,N-1\\}$ 推导 $\\partial |H(\\exp(j\\omega))| / \\partial h[n]$ 的闭式表达式。\n\n任务 2 (系数量化下通带波纹的期望增量): 现在专门研究一个9抽头对称移动平均FIR低通滤波器，其定义为对所有 $n \\in \\{0,1,\\dots,8\\}$ 均有 $h[n] = 1/9$。该滤波器是实数、偶对称的I型线性相位滤波器。考虑通带 $0 \\le \\omega \\le \\omega_{p}$，其中 $\\omega_{p} = \\pi/6$。定义通带波纹泛函 $R$ 为衡量由系数量化引起的幅度响应的均方变化，其表达式为\n$$\nR \\triangleq \\frac{1}{\\omega_{p}} \\int_{0}^{\\omega_{p}} \\left(|\\widetilde{H}(\\exp(j\\omega))| - |H(\\exp(j\\omega))|\\right)^{2} \\, d\\omega,\n$$\n其中 $\\widetilde{H}(\\exp(j\\omega))$ 是系数量化后滤波器的频率响应。将系数量化建模为对每个系数加上一个独立同分布 (i.i.d.) 的零均值均匀随机变量 $\\varepsilon[n] \\sim \\mathcal{U}(-\\Delta/2,\\Delta/2)$，其中步长 $\\Delta  0$。使用任务1中推导的梯度和 $|\\widetilde{H}(\\exp(j\\omega))| - |H(\\exp(j\\omega))|$ 的一阶扰动模型，计算针对指定的9抽头移动平均滤波器和通带，通带波纹的期望增量 $\\mathbb{E}[R]$ 的闭式解析表达式（仅用 $\\Delta$ 表示），结果精确到 $\\Delta$ 的二阶。请以仅含 $\\Delta$ 的单一简化解析表达式形式给出最终结果。无需进行数值取整，且最终答案必须是无量纲的。", "solution": "**任务1：梯度推导**\n\n我们要求解幅度响应 $|H(\\exp(j\\omega))|$ 关于实值滤波器系数 $h[n]$ 的偏导数。我们从恒等式 $|H|^2 = H H^*$ 开始，其中 $H$ 是 $H(\\exp(j\\omega))$ 的简写，$H^*$ 是其复共轭。使用乘积法则对 $h[n]$ 求导，得到：\n$$\n\\frac{\\partial |H|^2}{\\partial h[n]} = \\frac{\\partial (H H^*)}{\\partial h[n]} = \\frac{\\partial H}{\\partial h[n]} H^* + H \\frac{\\partial H^*}{\\partial h[n]}\n$$\n对左侧使用链式法则，我们有 $\\frac{\\partial |H|^2}{\\partial h[n]} = 2|H|\\frac{\\partial |H|}{\\partial h[n]}$。结合这些式子，并假设 $|H| \\neq 0$，我们发现：\n$$\n\\frac{\\partial |H|}{\\partial h[n]} = \\frac{1}{2|H|} \\left( \\frac{\\partial H}{\\partial h[n]} H^* + H \\frac{\\partial H^*}{\\partial h[n]} \\right)\n$$\n频率响应 $H$ 是系数 $h[k]$ 的线性函数。其关于 $h[n]$ 的偏导数为：\n$$\n\\frac{\\partial H}{\\partial h[n]} = \\frac{\\partial}{\\partial h[n]} \\left( \\sum_{k=0}^{N-1} h[k] \\exp(-j\\omega k) \\right) = \\exp(-j\\omega n)\n$$\n由于系数 $h[n]$ 是实数，共轭频率响应为 $H^* = \\sum_{k=0}^{N-1} h[k] \\exp(j\\omega k)$。其导数为：\n$$\n\\frac{\\partial H^*}{\\partial h[n]} = \\frac{\\partial}{\\partial h[n]} \\left( \\sum_{k=0}^{N-1} h[k] \\exp(j\\omega k) \\right) = \\exp(j\\omega n)\n$$\n将这些导数代入梯度的表达式中：\n$$\n\\frac{\\partial |H|}{\\partial h[n]} = \\frac{1}{2|H|} \\left( \\exp(-j\\omega n) H^* + H \\exp(j\\omega n) \\right)\n$$\n括号中的项具有 $z^* + z = 2 \\operatorname{Re}(z)$ 的形式，其中 $z = H \\exp(j\\omega n)$。设频率响应的相位为 $\\theta(\\omega) = \\arg\\{H(\\exp(j\\omega))\\}$，因此 $H = |H|\\exp(j\\theta(\\omega))$。\n那么 $z = |H|\\exp(j\\theta(\\omega)) \\exp(j\\omega n) = |H|\\exp(j(\\theta(\\omega)+\\omega n))$。其实部为 $\\operatorname{Re}(z) = |H|\\cos(\\theta(\\omega)+\\omega n)$。\n将此代回，我们得到梯度的最终表达式：\n$$\n\\frac{\\partial |H|}{\\partial h[n]} = \\frac{1}{2|H|} \\left( 2 |H|\\cos(\\theta(\\omega)+\\omega n) \\right) = \\cos(\\theta(\\omega)+\\omega n)\n$$\n\n**任务2：通带波纹期望增量**\n\n量化后的系数为 $\\tilde{h}[n] = h[n] + \\varepsilon[n]$，其中 $\\varepsilon[n]$ 是来自 $\\mathcal{U}(-\\Delta/2, \\Delta/2)$ 的独立同分布随机变量。其均值为 $\\mathbb{E}[\\varepsilon[n]] = 0$，方差为 $\\sigma_{\\varepsilon}^2 = \\mathbb{E}[\\varepsilon[n]^2] = \\frac{(\\Delta/2 - (-\\Delta/2))^2}{12} = \\frac{\\Delta^2}{12}$。由于误差是独立的，$\\mathbb{E}[\\varepsilon[n]\\varepsilon[k]] = \\sigma_{\\varepsilon}^2 \\delta_{nk}$，其中 $\\delta_{nk}$ 是克罗内克δ函数。\n\n对由微小扰动 $\\varepsilon[n]$ 引起的幅度响应变化 $\\delta|H| = |\\widetilde{H}| - |H|$，使用一阶泰勒级数近似：\n$$\n\\delta|H| \\approx \\sum_{n=0}^{N-1} \\frac{\\partial |H|}{\\partial h[n]} \\varepsilon[n] = \\sum_{n=0}^{N-1} \\cos(\\theta(\\omega)+\\omega n) \\varepsilon[n]\n$$\n波纹泛函为 $R = \\frac{1}{\\omega_{p}} \\int_{0}^{\\omega_{p}} (\\delta|H|)^2 d\\omega$。我们需要计算其期望 $\\mathbb{E}[R]$。\n$$\n\\mathbb{E}[R] = \\mathbb{E}\\left[ \\frac{1}{\\omega_{p}} \\int_{0}^{\\omega_{p}} \\left( \\sum_{n=0}^{N-1} \\cos(\\theta(\\omega)+\\omega n) \\varepsilon[n] \\right)^2 d\\omega \\right]\n$$\n根据期望和积分的线性性质：\n$$\n\\mathbb{E}[R] = \\frac{1}{\\omega_{p}} \\int_{0}^{\\omega_{p}} \\mathbb{E}\\left[ \\sum_{n=0}^{N-1} \\sum_{k=0}^{N-1} \\cos(\\theta(\\omega)+\\omega n) \\cos(\\theta(\\omega)+\\omega k) \\varepsilon[n]\\varepsilon[k] \\right] d\\omega\n$$\n期望 $\\mathbb{E}[\\varepsilon[n]\\varepsilon[k]] = \\sigma_{\\varepsilon}^2 \\delta_{nk}$ 将双重求和简化为 $n=k$ 时的单重求和：\n$$\n\\mathbb{E}[R] = \\frac{1}{\\omega_{p}} \\int_{0}^{\\omega_{p}} \\sum_{n=0}^{N-1} \\cos^2(\\theta(\\omega)+\\omega n) \\sigma_{\\varepsilon}^2 d\\omega = \\frac{\\sigma_{\\varepsilon}^2}{\\omega_{p}} \\sum_{n=0}^{N-1} \\int_{0}^{\\omega_{p}} \\cos^2(\\theta(\\omega)+\\omega n) d\\omega\n$$\n现在，我们专门研究给定的9抽头移动平均滤波器，其中对 $n \\in \\{0, \\dots, 8\\}$ 有 $h[n]=1/9$。这是一个长度 $N=9$ 的I型线性相位滤波器。其相位响应为 $\\theta(\\omega) = -\\frac{N-1}{2}\\omega = -4\\omega$。通带为 $[0, \\omega_p]$，其中 $\\omega_p = \\pi/6$。\n将 $\\theta(\\omega)=-4\\omega$ 代入 $\\mathbb{E}[R]$ 的表达式中：\n$$\n\\mathbb{E}[R] = \\frac{\\sigma_{\\varepsilon}^2}{\\omega_{p}} \\sum_{n=0}^{8} \\int_{0}^{\\omega_{p}} \\cos^2(-4\\omega+\\omega n) d\\omega = \\frac{\\sigma_{\\varepsilon}^2}{\\omega_{p}} \\sum_{n=0}^{8} \\int_{0}^{\\omega_{p}} \\cos^2((n-4)\\omega) d\\omega\n$$\n我们使用恒等式 $\\cos^2(x) = \\frac{1+\\cos(2x)}{2}$ 来计算积分 $\\int_{0}^{\\omega_p} \\cos^2((n-4)\\omega) d\\omega$。\n当 $n=4$ 时，被积函数为 $\\cos^2(0)=1$，所以积分为 $\\omega_p$。\n当 $n \\neq 4$ 时，令 $k = n-4$。积分为：\n$$\n\\int_{0}^{\\omega_{p}} \\frac{1+\\cos(2k\\omega)}{2} d\\omega = \\frac{1}{2} \\left[ \\omega + \\frac{\\sin(2k\\omega)}{2k} \\right]_{0}^{\\omega_{p}} = \\frac{\\omega_p}{2} + \\frac{\\sin(2k\\omega_p)}{4k}\n$$\n对 $n \\in \\{0, \\dots, 8\\}$ 的求和等价于对 $k \\in \\{-4, \\dots, 4\\}$ 的求和。\n$$\n\\sum_{n=0}^{8} \\int_{0}^{\\omega_{p}} \\cos^2((n-4)\\omega) d\\omega = \\omega_p + \\sum_{k \\in \\{-4,.., -1, 1,..,4\\}} \\left(\\frac{\\omega_p}{2} + \\frac{\\sin(2k\\omega_p)}{4k}\\right)\n$$\n求和中有8项。这得到：\n$$\n\\omega_p + 8 \\left(\\frac{\\omega_p}{2}\\right) + \\sum_{k \\in \\{-4,.., -1, 1,..,4\\}} \\frac{\\sin(2k\\omega_p)}{4k} = 5\\omega_p + \\frac{1}{4} \\left( \\sum_{k=1}^4 \\frac{\\sin(2k\\omega_p)}{k} + \\sum_{k=-4}^{-1} \\frac{\\sin(2k\\omega_p)}{k} \\right)\n$$\n由于 $\\frac{\\sin(-2x)}{-x} = \\frac{\\sin(2x)}{x}$，这两个求和是相同的。总和为：\n$$\n5\\omega_p + \\frac{1}{2} \\sum_{k=1}^{4} \\frac{\\sin(2k\\omega_p)}{k}\n$$\n现在代入 $\\omega_p=\\pi/6$：\n$$\n\\sum_{k=1}^{4} \\frac{\\sin(2k\\pi/6)}{k} = \\sum_{k=1}^{4} \\frac{\\sin(k\\pi/3)}{k}\n$$\n各项为：\n当 $k=1$ 时: $\\frac{\\sin(\\pi/3)}{1} = \\frac{\\sqrt{3}}{2}$\n当 $k=2$ 时: $\\frac{\\sin(2\\pi/3)}{2} = \\frac{\\sqrt{3}/2}{2} = \\frac{\\sqrt{3}}{4}$\n当 $k=3$ 时: $\\frac{\\sin(\\pi)}{3} = 0$\n当 $k=4$ 时: $\\frac{\\sin(4\\pi/3)}{4} = \\frac{-\\sqrt{3}/2}{4} = -\\frac{\\sqrt{3}}{8}$\n和为 $\\frac{\\sqrt{3}}{2} + \\frac{\\sqrt{3}}{4} - \\frac{\\sqrt{3}}{8} = \\sqrt{3} \\left(\\frac{4+2-1}{8}\\right) = \\frac{5\\sqrt{3}}{8}$。\n\n积分的和是 $5\\omega_p + \\frac{1}{2} \\left(\\frac{5\\sqrt{3}}{8}\\right) = 5\\frac{\\pi}{6} + \\frac{5\\sqrt{3}}{16}$。\n最后，我们计算 $\\mathbb{E}[R]$：\n$$\n\\mathbb{E}[R] = \\frac{\\sigma_{\\varepsilon}^2}{\\omega_{p}} \\left(5\\omega_p + \\frac{5\\sqrt{3}}{16}\\right) = 5\\sigma_{\\varepsilon}^2 + \\frac{5\\sqrt{3}}{16\\omega_p}\\sigma_{\\varepsilon}^2\n$$\n代入 $\\sigma_{\\varepsilon}^2 = \\Delta^2/12$ 和 $\\omega_p = \\pi/6$：\n$$\n\\mathbb{E}[R] = 5\\frac{\\Delta^2}{12} + \\frac{5\\sqrt{3}}{16(\\pi/6)} \\frac{\\Delta^2}{12} = \\frac{5\\Delta^2}{12} + \\frac{5\\sqrt{3} \\cdot 6}{16\\pi} \\frac{\\Delta^2}{12} = \\frac{5\\Delta^2}{12} + \\frac{30\\sqrt{3}}{192\\pi}\\Delta^2\n$$\n化简第二个分数 $\\frac{30}{192} = \\frac{5 \\cdot 6}{32 \\cdot 6} = \\frac{5}{32}$。\n$$\n\\mathbb{E}[R] = \\frac{5\\Delta^2}{12} + \\frac{5\\sqrt{3}}{32\\pi}\\Delta^2 = \\Delta^2 \\left(\\frac{5}{12} + \\frac{5\\sqrt{3}}{32\\pi}\\right)\n$$\n这就是通带波纹期望增量的最终解析表达式。", "answer": "$$\n\\boxed{\\Delta^2 \\left(\\frac{5}{12} + \\frac{5\\sqrt{3}}{32\\pi}\\right)}\n$$", "id": "2872536"}]}