{"hands_on_practices": [{"introduction": "在深入研究复杂应用之前，验证离散坐标法（DOM）是否与基本原理一致至关重要。第一个实践练习要求您从第一性原理出发，证明在非参与性介质的简化情况下，用于辐射交换的DOM公式能够完美地还原经典的角系数解 [@problem_id:2528258]。这个练习在辐射传输方程（RTE）的微分方法和封闭体理论的积分方法之间建立了一座坚实的概念桥梁。", "problem": "要求您从第一性原理出发，验证在非参与介质极限情况下，离散坐标法 (DOM) 与经典角系数公式在辐射交换问题上的等效性。考虑一个一维真空腔体（平面板），其边界为两个无限大、平行、漫-灰、等温的壁面，分别位于位置 $x=0$（左壁）和 $x=L$（右壁）。两壁之间的空间为真空（非参与介质），且不存在折射率跳跃。设左壁的发射率为 $\\varepsilon_L$，温度为 $T_L$；右壁的发射率为 $\\varepsilon_R$，温度为 $T_R$。斯特藩-玻尔兹曼常数为 $\\sigma = 5.670374419\\times 10^{-8}\\ \\mathrm{W/m^2/K^4}$。所有温度必须以 $\\mathrm{K}$ 为单位提供，所有热流密度必须以 $\\mathrm{W/m^2}$ 为单位报告。\n\n从真空中的辐射传输方程和漫-灰边界条件出发，完成以下任务：\n\n1. 使用离散坐标法 (DOM) 处理一维平直平行真空问题，通过在 $\\mu\\in[0,1]$ 上使用 Gauss–Legendre 求积，将角度域离散为 $N_\\mu$ 个离散方向，其中 $\\mu=\\cos\\theta$ 是相对于壁面法线的方向余弦。在真空中，比辐射强度 $I(x,\\mu)$ 沿射线保持不变。在漫-灰壁面上，出射强度是各向同性的，由 $I_\\text{out} = J/\\pi$ 给出，其中辐射出射度 $J$ 满足 $J=\\varepsilon\\sigma T^4 + (1-\\varepsilon)G$，辐照度 $G$ 满足 $G=\\int_{\\Omega_i} I_\\text{in}\\cos\\theta\\,\\mathrm{d}\\Omega$，其中 $\\Omega_i$ 是入射半球。对于双壁平板，使用 DOM 求积，用对面壁面的出射强度表示左右壁面的辐照度 $G_L$ 和 $G_R$，并计算左壁的净辐射热流密度 $q_L''=J_L-G_L$。\n\n2. 独立地，使用真空中两个无限大平行平板的角系数解，计算参考的封闭腔理论结果：\n$$\nq_\\text{VF}''=\\frac{\\sigma\\left(T_L^4-T_R^4\\right)}{\\dfrac{1}{\\varepsilon_L}+\\dfrac{1}{\\varepsilon_R}-1}.\n$$\n\n3. 通过返回每个测试用例中以 $\\mathrm{W/m^2}$ 为单位的绝对差值 $\\left|q_\\text{DOM}''-q_\\text{VF}''\\right|$，比较 DOM 计算的左壁净热流密度 $q_\\text{DOM}''$ 与角系数热流密度 $q_\\text{VF}''$。\n\n在您的推导和实现中必须使用的基本依据和约束：\n- 真空中的辐射传输方程 (RTE)：沿任意方向 $\\mathbf{s}$，$\\mathbf{s}\\cdot\\nabla I(\\mathbf{x},\\mathbf{s})=0$（介质中无发射、吸收或散射），因此 $I$ 沿射线是恒定的。\n- 漫-灰壁面边界条件：离开壁面的强度为 $I_\\text{out}=J/\\pi$，其中 $J=\\varepsilon\\sigma T^4+(1-\\varepsilon)G$，且 $G=\\int_{\\Omega_i} I_\\text{in}\\cos\\theta\\,\\mathrm{d}\\Omega$。\n- 恒定强度在半球上的立体角积分恒等式：$\\int_{\\Omega_i}\\cos\\theta\\,\\mathrm{d}\\Omega=\\pi$。\n- 离散坐标（角度求積）：使用 Gauss–Legendre 节点 $\\mu_k\\in[0,1]$ 和权重 $w_k0$ 来近似 $\\int_0^1 f(\\mu)\\,\\mathrm{d}\\mu \\approx \\sum_{k=1}^{N_\\mu} w_k f(\\mu_k)$。\n\n由于离散化使用的是方向余弦 $\\mu\\in[0,1]$，因此不需要角度单位。对于无限大平行平板间的真空，长度 $L$ 不会出现在最终结果中，因此不应使用。\n\n您的程序必须实现这两种计算，并为每个指定的测试用例返回以 $\\mathrm{W/m^2}$ 为单位的浮点数形式的绝对差值。使用以下测试套件，每个用例指定为 $(T_L,\\varepsilon_L,T_R,\\varepsilon_R)$，其中温度单位为 $\\mathrm{K}$：\n- 测试 1：$(1200,0.8,800,0.6)$\n- 测试 2：$(1000,0.7,1000,0.9)$\n- 测试 3：$(400,1.0,300,1.0)$\n- 测试 4：$(1000,0.05,300,0.05)$\n- 测试 5：$(1500,1.0,300,0.3)$\n\n数值输出要求：\n- 每个返回值（绝对差值）以 $\\mathrm{W/m^2}$ 表示。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[a,b,c,d,e]”）。每个元素必须是浮点数。\n\n不允许用户输入；所有参数均按上述固定并嵌入程序中。", "solution": "问题陈述已经过验证。我们发现它具有科学依据、良定、客观且自洽。这是辐射传热理论中的一个标准问题，旨在在一个简化的非参与介质场景中，展示离散坐标法与角系数法的等效性。该问题有效，并将提供解答。\n\n目标是从第一性原理出发，验证在真空中被分隔的两个无限大、平行、漫-灰壁面之间，离散坐标法 (DOM) 与经典角系数公式在辐射交换问题上的等效性。\n\n首先，我们使用离散坐标法推导净辐射热流密度。\n在非参与介质（真空）中的一维辐射传输方程 (RTE) 由下式给出：\n$$\n\\mu \\frac{dI(x,\\mu)}{dx} = 0\n$$\n其中 $I(x, \\mu)$ 是在位置 $x$、沿由余弦 $\\mu = \\cos\\theta$ 指定的方向上的辐射强度。该方程意味着对于任意给定的方向 $\\mu$，强度 $I$ 沿其路径保持恒定。\n\n该系统由一个位于 $x=0$ 的左壁和一个位于 $x=L$ 的右壁组成。壁面是漫-灰体。\n离开左壁的辐射强度（对于方向 $\\mu  0$）是各向同性的，由 $I_{L}^{+} = J_L/\\pi$ 给出，其中 $J_L$ 是左壁的辐射出射度。\n类似地，离开右壁的辐射强度（对于方向 $\\mu  0$）是 $I_{R}^{-} = J_R/\\pi$。\n\n由于板间是真空，入射到右壁上的强度与离开左壁的强度相同：$I_{\\text{in},R}(\\mu  0) = I_{L}^{+} = J_L/\\pi$。\n同样地，入射到左壁上的强度与离开右壁的强度相同：$I_{\\text{in},L}(\\mu  0) = I_{R}^{-} = J_R/\\pi$。\n\n表面上的辐照度 $G$ 是入射辐射通量，定义为 $G = \\int_{\\Omega_i} I_{\\text{in}} \\cos\\theta \\, d\\Omega$，其中积分是在入射半球 $\\Omega_i$ 上进行的。对于平面，这变为：\n$$\nG = \\int_0^{2\\pi} d\\phi \\int_0^1 I_{\\text{in}}(\\mu) \\mu \\, d\\mu = 2\\pi \\int_0^1 I_{\\text{in}}(\\mu) \\mu \\, d\\mu\n$$\n左壁上的辐照度 $G_L$ 是由来自右壁的强度引起的。由于 $I_{\\text{in},L}$ 在整个入射方向半球上是恒定的（$J_R/\\pi$），我们有：\n$$\nG_L = 2\\pi \\int_0^1 \\left(\\frac{J_R}{\\pi}\\right) \\mu \\, d\\mu = 2J_R \\int_0^1 \\mu \\, d\\mu = 2J_R \\left[\\frac{\\mu^2}{2}\\right]_0^1 = J_R\n$$\n按照指定，使用离散坐标求积，$G_L$ 近似为：\n$$\nG_L \\approx 2\\pi \\sum_{k=1}^{N_\\mu} w_k I_{\\text{in},L}(\\mu_k) \\mu_k = 2\\pi \\sum_{k=1}^{N_\\mu} w_k \\left(\\frac{J_R}{\\pi}\\right) \\mu_k = 2J_R \\sum_{k=1}^{N_\\mu} w_k \\mu_k\n$$\n求和项是积分 $\\int_0^1 \\mu \\, d\\mu = 1/2$ 的 Gauss-Legendre 求积近似。一个 $N_\\mu$ 阶的 Gauss-Legendre 求积对最高 $2N_\\mu - 1$ 次的多项式是精确的。由于被积函数是一次多项式，对于任何 $N_\\mu \\ge 1$，该求积都是精确的。因此，$\\sum_{k=1}^{N_\\mu} w_k \\mu_k = 1/2$。DOM 的结果是精确的：$G_L = 2J_R(1/2) = J_R$。\n根据对称性，右壁上的辐照度为 $G_R = J_L$。\n\n辐射出射度 $J_L$ 和 $J_R$ 由漫-灰壁面边界条件定义：$J = \\varepsilon \\sigma T^4 + (1-\\varepsilon)G$。这产生了一个关于两个未知辐射出射度的二元线性方程组：\n$$\nJ_L = \\varepsilon_L \\sigma T_L^4 + (1-\\varepsilon_L)G_L = \\varepsilon_L \\sigma T_L^4 + (1-\\varepsilon_L)J_R \\\\\nJ_R = \\varepsilon_R \\sigma T_R^4 + (1-\\varepsilon_R)G_R = \\varepsilon_R \\sigma T_R^4 + (1-\\varepsilon_R)J_L\n$$\n我们求解该方程组以得到 $J_L$ 和 $J_R$。将第二个方程代入第一个方程：\n$$\nJ_L = \\varepsilon_L \\sigma T_L^4 + (1-\\varepsilon_L)[\\varepsilon_R \\sigma T_R^4 + (1-\\varepsilon_R)J_L]\n$$\n$$\nJ_L[1 - (1-\\varepsilon_L)(1-\\varepsilon_R)] = \\varepsilon_L \\sigma T_L^4 + (1-\\varepsilon_L)\\varepsilon_R \\sigma T_R^4\n$$\n方括号中的项简化为 $1 - (1 - \\varepsilon_L - \\varepsilon_R + \\varepsilon_L\\varepsilon_R) = \\varepsilon_L + \\varepsilon_R - \\varepsilon_L\\varepsilon_R$。所以，\n$$\nJ_L = \\frac{\\varepsilon_L \\sigma T_L^4 + (1-\\varepsilon_L)\\varepsilon_R \\sigma T_R^4}{\\varepsilon_L + \\varepsilon_R - \\varepsilon_L\\varepsilon_R}\n$$\n根据对称性，交换下标 $L$ 和 $R$：\n$$\nJ_R = \\frac{\\varepsilon_R \\sigma T_R^4 + (1-\\varepsilon_R)\\varepsilon_L \\sigma T_L^4}{\\varepsilon_L + \\varepsilon_R - \\varepsilon_L\\varepsilon_R}\n$$\n左壁的净辐射热流密度是出射通量（辐射出射度）与入射通量（辐照度）之差：\n$$\nq_{L, \\text{DOM}}'' = J_L - G_L = J_L - J_R\n$$\n代入 $J_L$ 和 $J_R$ 的表达式：\n$$\nq_{L, \\text{DOM}}'' = \\frac{(\\varepsilon_L \\sigma T_L^4 + (1-\\varepsilon_L)\\varepsilon_R \\sigma T_R^4) - (\\varepsilon_R \\sigma T_R^4 + (1-\\varepsilon_R)\\varepsilon_L \\sigma T_L^4)}{\\varepsilon_L + \\varepsilon_R - \\varepsilon_L\\varepsilon_R}\n$$\n$$\nq_{L, \\text{DOM}}'' = \\frac{\\sigma T_L^4(\\varepsilon_L - (1-\\varepsilon_R)\\varepsilon_L) - \\sigma T_R^4(\\varepsilon_R - (1-\\varepsilon_L)\\varepsilon_R)}{\\varepsilon_L + \\varepsilon_R - \\varepsilon_L\\varepsilon_R}\n$$\n$$\nq_{L, \\text{DOM}}'' = \\frac{\\sigma T_L^4(\\varepsilon_L - \\varepsilon_L + \\varepsilon_L\\varepsilon_R) - \\sigma T_R^4(\\varepsilon_R - \\varepsilon_R + \\varepsilon_L\\varepsilon_R)}{\\varepsilon_L + \\varepsilon_R - \\varepsilon_L\\varepsilon_R}\n$$\n$$\nq_{L, \\text{DOM}}'' = \\frac{\\varepsilon_L\\varepsilon_R \\sigma (T_L^4 - T_R^4)}{\\varepsilon_L + \\varepsilon_R - \\varepsilon_L\\varepsilon_R}\n$$\n这就是从 DOM 公式推导出的左壁净热流密度的最终表达式。\n\n接下来，我们考察所提供的用于两个无限大平行平板的角系数公式：\n$$\nq_\\text{VF}'' = \\frac{\\sigma(T_L^4 - T_R^4)}{\\frac{1}{\\varepsilon_L} + \\frac{1}{\\varepsilon_R} - 1}\n$$\n为了将其与 DOM 的结果进行比较，我们简化分母：\n$$\n\\frac{1}{\\varepsilon_L} + \\frac{1}{\\varepsilon_R} - 1 = \\frac{\\varepsilon_R + \\varepsilon_L - \\varepsilon_L\\varepsilon_R}{\\varepsilon_L\\varepsilon_R}\n$$\n将此代入角系数表达式：\n$$\nq_\\text{VF}'' = \\sigma(T_L^4 - T_R^4) \\left( \\frac{\\varepsilon_L\\varepsilon_R}{\\varepsilon_L + \\varepsilon_R - \\varepsilon_L\\varepsilon_R} \\right) = \\frac{\\varepsilon_L\\varepsilon_R \\sigma (T_L^4 - T_R^4)}{\\varepsilon_L + \\varepsilon_R - \\varepsilon_L\\varepsilon_R}\n$$\n$q_{L, \\text{DOM}}''$ 和 $q_\\text{VF}''$ 的表达式在解析上是完全相同的。因此，它们的绝对差值 $|q_{L, \\text{DOM}}'' - q_\\text{VF}''|$ 精确为零，与参数值无关。在此极限情况下，DOM 公式正确地恢复了经典封闭腔理论的结果。任何数值计算都应得出零的差值，或由于浮点运算而产生一个在机器精度数量级上的值。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Verifies the equivalence between the Discrete Ordinates Method (DOM) and\n    the view factor formulation for radiative exchange between two infinite\n    parallel plates in a vacuum.\n    \"\"\"\n    # Stefan-Boltzmann constant in W/m^2/K^4\n    sigma = 5.670374419e-8\n\n    # Test cases: (T_L, eps_L, T_R, eps_R)\n    # T in Kelvin\n    # eps is dimensionless emissivity\n    test_cases = [\n        (1200.0, 0.8, 800.0, 0.6),\n        (1000.0, 0.7, 1000.0, 0.9),\n        (400.0, 1.0, 300.0, 1.0),\n        (1000.0, 0.05, 300.0, 0.05),\n        (1500.0, 1.0, 300.0, 0.3),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        T_L, eps_L, T_R, eps_R = case\n\n        # Part 1: Calculation using the derived DOM formulation result.\n        # q_DOM = [eps_L * eps_R * sigma * (T_L^4 - T_R^4)] / [eps_L + eps_R - eps_L * eps_R]\n        \n        # Check for division by zero, although not possible for physical emissivities (0  eps = 1)\n        # unless both are zero, which is unphysical.\n        # The denominator is eps_L + eps_R * (1 - eps_L) which is positive.\n        q_dom_numerator = eps_L * eps_R * sigma * (T_L**4 - T_R**4)\n        q_dom_denominator = eps_L + eps_R - eps_L * eps_R\n        q_dom = q_dom_numerator / q_dom_denominator\n\n        # Part 2: Calculation using the classical View Factor (enclosure theory) result.\n        # q_VF = [sigma * (T_L^4 - T_R^4)] / [1/eps_L + 1/eps_R - 1]\n        \n        # Denominator of View Factor formulation\n        q_vf_denominator = (1.0 / eps_L) + (1.0 / eps_R) - 1.0\n        \n        # Check for division by zero in the view factor formula.\n        # This occurs if 1/eps_L + 1/eps_R = 1, e.g. eps_L=2, eps_R=2, unphysical.\n        # For physical eps values in (0, 1], the denominator is always >= 1.\n        if q_vf_denominator == 0:\n            # Handle cases where emissivities are such that the denominator is zero.\n            # This is physically not expected for eps in [0, 1] unless as a limit.\n            # If both T_L and T_R are equal, flux is 0. Otherwise, it might be infinite.\n            if T_L == T_R:\n                q_vf = 0.0\n            else:\n                # This case should not be reached with physical emissivities.\n                q_vf = float('inf') * np.sign(T_L - T_R)\n        else:\n            q_vf = (sigma * (T_L**4 - T_R**4)) / q_vf_denominator\n\n        # Part 3: Compute the absolute difference.\n        # Due to algebraic equivalence, this should be 0.0 or near machine precision.\n        abs_diff = abs(q_dom - q_vf)\n        results.append(abs_diff)\n        \n    # Format the results into the required string format\n    # \"[result1,result2,result3,result4,result5]\"\n    # Using 'g' format specifier to represent floats cleanly.\n    print(f\"[{','.join(f'{r:.1f}' for r in results)}]\")\n\nsolve()\n```", "id": "2528258"}, {"introduction": "DOM的核心在于将立体角离散为一组有限的方向和权重。本实践将提供构建这样一个正交集的亲身实践经验，针对一个重要的几何情况：轴对称几何 [@problem_id:2528233]。您将学习如何将标准的一维高斯-勒让德正交映射到整个立体角上，这是开发精确高效DOM模型的一项基本技术。", "problem": "一个辐射参与介质采用离散坐标法 (DOM) 进行处理，假定关于一固定轴为轴对称，因此比强度的任何角度依赖性都可以仅写作方向余弦 $\\mu=\\cos\\theta$ 的函数。设立体角元为 $d\\Omega=\\sin\\theta\\,d\\theta\\,d\\phi$，其中极角 $\\theta\\in[0,\\pi]$，方位角 $\\phi\\in[0,2\\pi)$。考虑使用在 $\\mu\\in[-1,1]$ 上的 $N$ 点一维Gauss–Legendre求积来近似一个光滑标量函数 $f(\\mu)$ 的立体角积分。\n\n任务：\n1) 从 $d\\Omega$ 的定义和变量代换 $\\mu=\\cos\\theta$ 出发，推导 $f(\\mu)$ 的全立体角积分的轴对称表示，并陈述常值函数 $f(\\mu)=1$ 在整个球面上的积分所对应的精确归一化条件。\n2) 设在 $\\mu\\in[-1,1]$ 上的一维Gauss–Legendre求积由节点 $\\{\\mu_{n}\\}_{n=1}^{N}$ 和权重 $\\{w_{n}\\}_{n=1}^{N}$ 表征，使得对于足够光滑的 $g$，有 $\\int_{-1}^{1}g(\\mu)\\,d\\mu\\approx\\sum_{n=1}^{N}w_{n}g(\\mu_{n})$。确定与相同节点 $\\{\\mu_{n}\\}$ 配对的立体角权重 $\\{W_{n}\\}_{n=1}^{N}$，使得离散近似 $\\int_{4\\pi} f\\,d\\Omega\\approx\\sum_{n=1}^{N}W_{n}f(\\mu_{n})$ 能在整个球面上精确地对 $f(\\mu)=1$ 进行积分。\n3) 特化到 $N=3$ 的情况。计算在 $\\mu\\in[-1,1]$ 上的Gauss–Legendre节点 $\\{\\mu_{n}\\}_{n=1}^{3}$ 和相应的一维权重 $\\{w_{n}\\}_{n=1}^{3}$，然后计算第 (2) 部分中得到的映射立体角权重 $\\{W_{n}\\}_{n=1}^{3}$。将节点按升序排列，$\\mu_1, \\mu_2, \\mu_3$，并以有序行向量 $\\big[W_{1}\\;\\;W_{2}\\;\\;W_{3}\\big]$ 的形式报告最终结果。\n\n答案规格：\n- 提供精确表达式；不要近似 $\\pi$。\n- 以球面度表示最终权重。\n- 你的最终答案必须是闭合形式的单个行向量 $\\big[W_{1}\\;\\;W_{2}\\;\\;W_{3}\\big]$，无任何舍入。", "solution": "所陈述的问题是适定的，有科学依据，并包含了获得唯一解所需的所有信息。我们直接进行推导和计算。\n\n该问题分为三个部分，我们将依次解决。\n\n1) 轴对称立体角积分表示及其归一化的推导。\n\n一个仅依赖于方向余弦 $\\mu = \\cos\\theta$ 的函数 $f(\\mu)$ 的立体角积分为\n$$\n\\int_{4\\pi} f(\\mu) \\, d\\Omega\n$$\n其中 $d\\Omega = \\sin\\theta \\, d\\theta \\, d\\phi$ 是球坐标系中的立体角微分。角度范围为 $\\theta \\in [0, \\pi]$ 和 $\\phi \\in [0, 2\\pi)$。代入 $d\\Omega$ 的表达式，积分为：\n$$\n\\int_{0}^{2\\pi} \\int_{0}^{\\pi} f(\\cos\\theta) \\sin\\theta \\, d\\theta \\, d\\phi\n$$\n由于被积函数 $f(\\cos\\theta)$ 与方位角 $\\phi$ 无关，因此可以先直接对 $\\phi$ 进行积分：\n$$\n\\int_{0}^{2\\pi} d\\phi = 2\\pi\n$$\n这使得我们只剩下一个关于极角 $\\theta$ 的一维积分：\n$$\n\\int_{4\\pi} f(\\mu) \\, d\\Omega = 2\\pi \\int_{0}^{\\pi} f(\\cos\\theta) \\sin\\theta \\, d\\theta\n$$\n我们现在进行从 $\\theta$ 到 $\\mu = \\cos\\theta$ 的变量代换。其微分为 $d\\mu = -\\sin\\theta \\, d\\theta$。积分限也必须进行变换：\n- 当 $\\theta = 0$ 时，$\\mu = \\cos(0) = 1$。\n- 当 $\\theta = \\pi$ 时，$\\mu = \\cos(\\pi) = -1$。\n\n将这些代入积分，我们得到：\n$$\n2\\pi \\int_{1}^{-1} f(\\mu) (-d\\mu) = 2\\pi \\int_{-1}^{1} f(\\mu) \\, d\\mu\n$$\n这就是全立体角积分的轴对称表示。\n\n对于归一化条件，我们考虑常值函数 $f(\\mu) = 1$。在整个球面上的积分必须得出总立体角 $4\\pi$ 球面度。使用我们推导的公式：\n$$\n\\int_{4\\pi} 1 \\, d\\Omega = 2\\pi \\int_{-1}^{1} 1 \\, d\\mu = 2\\pi \\left[ \\mu \\right]_{-1}^{1} = 2\\pi (1 - (-1)) = 2\\pi(2) = 4\\pi\n$$\n结果正确，从而验证了所推导的公式和归一化。\n\n2) 立体角求积权重 $W_{n}$ 的确定。\n\n问题提出使用一个 $N$ 点求积来近似立体角积分：\n$$\n\\int_{4\\pi} f(\\mu) \\, d\\Omega \\approx \\sum_{n=1}^{N} W_{n} f(\\mu_{n})\n$$\n使用第 (1) 部分的结果，我们有精确关系式：\n$$\n\\int_{4\\pi} f(\\mu) \\, d\\Omega = 2\\pi \\int_{-1}^{1} f(\\mu) \\, d\\mu\n$$\n右侧的积分将由在区间 $[-1, 1]$ 上的一个 $N$ 点Gauss-Legendre求积来近似，该求积由节点 $\\{\\mu_n\\}$ 和权重 $\\{w_n\\}$ 定义：\n$$\n\\int_{-1}^{1} g(\\mu) \\, d\\mu \\approx \\sum_{n=1}^{N} w_{n} g(\\mu_{n})\n$$\n将此应用于我们的函数 $f(\\mu)$，我们得到近似式：\n$$\n2\\pi \\int_{-1}^{1} f(\\mu) \\, d\\mu \\approx 2\\pi \\sum_{n=1}^{N} w_{n} f(\\mu_{n})\n$$\n通过比较立体角积分的两个求积公式，\n$$\n\\sum_{n=1}^{N} W_{n} f(\\mu_{n}) \\approx 2\\pi \\sum_{n=1}^{N} w_{n} f(\\mu_{n})\n$$\n并要求此式对任何足够光滑的函数 $f(\\mu)$ 都成立，我们可以辨识出每一项 $f(\\mu_n)$ 的系数：\n$$\nW_{n} = 2\\pi w_{n}\n$$\n这给出了用标准一维Gauss-Legendre权重 $w_n$ 表示的立体角权重 $W_n$。为验证这一点，我们检查该求积是否能精确积分 $f(\\mu) = 1$。对于 $f(\\mu)=1$ 的求积和为 $\\sum_{n=1}^{N} W_n$。要使其精确，该值必须等于 $4\\pi$。\n$$\n\\sum_{n=1}^{N} W_{n} = \\sum_{n=1}^{N} 2\\pi w_{n} = 2\\pi \\sum_{n=1}^{N} w_{n}\n$$\nGauss-Legendre求积的一个基本性质是它可以精确地对最高为 $2N-1$ 次的多项式进行积分。对于 $N \\ge 1$，这包括了常值函数（0次多项式）。因此，权重的总和是精确的：\n$$\n\\sum_{n=1}^{N} w_{n} = \\int_{-1}^{1} 1 \\, d\\mu = 2\n$$\n将此代入 $W_n$ 总和的表达式中：\n$$\n\\sum_{n=1}^{N} W_{n} = 2\\pi (2) = 4\\pi\n$$\n条件得到满足。因此关系式 $W_n = 2\\pi w_n$ 是正确的。\n\n3) 对于 $N=3$ 的计算。\n\n对于 $N=3$，Gauss-Legendre求积节点 $\\{\\mu_n\\}$ 是3次Legendre多项式 $P_3(\\mu)$ 的根。Legendre多项式由递推关系 $(n+1)P_{n+1}(x) = (2n+1)xP_n(x) - nP_{n-1}(x)$ 定义，其中 $P_0(x)=1$ 和 $P_1(x)=x$。这给出：\n$$\nP_3(\\mu) = \\frac{1}{2}(5\\mu^3 - 3\\mu)\n$$\n通过令 $P_3(\\mu) = 0$ 来求根：\n$$\n\\frac{1}{2}\\mu(5\\mu^2 - 3) = 0\n$$\n这得出根 $\\mu = 0$ 和 $\\mu = \\pm\\sqrt{\\frac{3}{5}}$。按升序排列，节点为：\n$$\n\\mu_1 = -\\sqrt{\\frac{3}{5}}, \\quad \\mu_2 = 0, \\quad \\mu_3 = \\sqrt{\\frac{3}{5}}\n$$\n相应的权重 $\\{w_n\\}$ 由公式 $w_n = \\frac{2}{(1-\\mu_n^2)[P_N'(\\mu_n)]^2}$ 给出。对于 $N=3$，我们需要 $P_3(\\mu)$ 的导数：\n$$\nP_3'(\\mu) = \\frac{d}{d\\mu}\\left(\\frac{1}{2}(5\\mu^3 - 3\\mu)\\right) = \\frac{1}{2}(15\\mu^2 - 3)\n$$\n现在我们计算权重：\n对于节点 $\\mu_1 = -\\sqrt{3/5}$ 和 $\\mu_3 = \\sqrt{3/5}$，我们有 $\\mu_{1,3}^2 = 3/5$。\n$$\nP_3'(\\mu_{1,3}) = \\frac{1}{2}\\left(15\\left(\\frac{3}{5}\\right) - 3\\right) = \\frac{1}{2}(9-3) = 3\n$$\n权重为：\n$$\nw_1 = w_3 = \\frac{2}{(1 - 3/5)[3]^2} = \\frac{2}{(2/5)(9)} = \\frac{10}{18} = \\frac{5}{9}\n$$\n对于节点 $\\mu_2 = 0$：\n$$\nP_3'(\\mu_2) = \\frac{1}{2}(15(0)^2 - 3) = -\\frac{3}{2}\n$$\n权重为：\n$$\nw_2 = \\frac{2}{(1 - 0^2)[-3/2]^2} = \\frac{2}{9/4} = \\frac{8}{9}\n$$\n一维权重为 $\\{w_1, w_2, w_3\\} = \\{5/9, 8/9, 5/9\\}$。\n\n最后，我们使用关系式 $W_n = 2\\pi w_n$ 计算立体角权重 $\\{W_n\\}$。它们的单位是球面度。\n$$\nW_1 = 2\\pi w_1 = 2\\pi \\left(\\frac{5}{9}\\right) = \\frac{10\\pi}{9}\n$$\n$$\nW_2 = 2\\pi w_2 = 2\\pi \\left(\\frac{8}{9}\\right) = \\frac{16\\pi}{9}\n$$\n$$\nW_3 = 2\\pi w_3 = 2\\pi \\left(\\frac{5}{9}\\right) = \\frac{10\\pi}{9}\n$$\n最终答案是这些权重的有序行向量。\n$$\n\\begin{pmatrix} W_1  W_2  W_3 \\end{pmatrix} = \\begin{pmatrix} \\frac{10\\pi}{9}  \\frac{16\\pi}{9}  \\frac{10\\pi}{9} \\end{pmatrix}\n$$", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{10\\pi}{9}  \\frac{16\\pi}{9}  \\frac{10\\pi}{9} \\end{pmatrix}}\n$$", "id": "2528233"}, {"introduction": "在将辐射传输方程离散化之后，必须求解由此产生的代数方程组。最后一个实践练习聚焦于DOM求解器的算法核心：扫描算法 [@problem_id:2528194]。您将通过构建和拓扑排序依赖关系图，实现一种确定非结构化网格上正确单元处理顺序的方法，从而确保数值解正确地遵循辐射传输的上风特性。", "problem": "你需要实现一个程序，为在非结构化二维网格上的辐射传热中的离散坐标法（DOM）构建一个扫描序列。该序列必须通过对由迁移项引起的单元依赖关系进行拓扑排序，来遵循给定离散方向的上风（upwinding）原则。\n\n从给定离散方向（由单位向量 $\\hat{\\boldsymbol{s}} \\in \\mathbb{R}^2$ 表示）的稳态辐射传输方程（RTE）的迁移项开始：\n$$\n\\hat{\\boldsymbol{s}} \\cdot \\nabla I(\\boldsymbol{x}, \\hat{\\boldsymbol{s}}) + \\kappa I(\\boldsymbol{x}, \\hat{\\boldsymbol{s}}) = S(\\boldsymbol{x}, \\hat{\\boldsymbol{s}}),\n$$\n其中 $I$ 是辐射强度，$\\kappa$ 是吸收系数，$S$ 是一个源项。在对单元 $\\{ \\mathcal{C}_i \\}_{i=0}^{N-1}$ 进行有限体积离散化时，每个单元 $i$ 的每个面 $f \\in \\mathcal{F}_i$ 都有一个外向面法向量 $\\boldsymbol{n}_{i,f}$，迁移项采用上风格式：对于单元 $i$ 的每个面 $f$，如果 $\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f}  0$ 且该面是与相邻单元 $j$ 共享的内面，则单元 $i$ 中的值依赖于穿过该面的上风邻居 $j$ 中的值。如果该面是边界且 $\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f}  0$，则入流边界强度是已知的，不会引入依赖关系。$\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f}  0$ 的面是单元 $i$ 的出流面，没有依赖关系。$\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f} = 0$ 的面是切向的，为了排序目的，可以视为无耦合。\n\n在以顶点 $\\{0,1,\\dots,N-1\\}$ 表示单元的有向图上定义关系。对于每个单元 $i$ 和每个面 $f \\in \\mathcal{F}_i$：\n- 如果面是与邻居 $j$ 共享的内面且 $\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f}  0$，则添加一条有向边 $j \\to i$。\n- 如果面是边界且 $\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f}  0$，则不添加边（边界入流是已知的）。\n- 如果 $\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f} \\ge 0$，则不添加边。\n\n一个扫描序列是这个有向无环图的任意拓扑排序，它将每个单元列在其所有上风依赖（前驱）之后。为确保当多个单元同时符合条件时行为的确定性，通过增加投影中心坐标 $t_i = \\boldsymbol{x}_i \\cdot \\hat{\\boldsymbol{s}}$ 来打破平局；如果仍然存在平局，则通过增加单元标识符 $i$ 来打破。\n\n请实现上述逻辑并为以下三个测试用例计算扫描序列。在每个用例中，网格由以下方式指定：\n- 一组单元标识符。\n- 单元中心坐标 $\\boldsymbol{x}_i \\in \\mathbb{R}^2$。\n- 对于每个单元 $i$，一个面列表。每个面由一个外向法向量 $\\boldsymbol{n}_{i,f} \\in \\mathbb{R}^2$ 和一个相邻单元标识符 $j$（内面）或值 $\\varnothing$（边界）给出。\n\n使用以下测试套件。所有向量分量都是无量纲的，并以实数形式给出。离散方向向量的分量也以实数形式给出。你必须使用严格的容差 $\\varepsilon = 10^{-12}$ 来处理切向条件：一个面当且仅当 $\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f}  -\\varepsilon$ 时被视为入流，当且仅当 $\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f}  \\varepsilon$ 时被视为出流，否则为切向（无依赖）。打破平局的投影使用 $t_i = \\boldsymbol{x}_i \\cdot \\hat{\\boldsymbol{s}}$。\n\n测试用例1（结构化 $2 \\times 2$ 网格，向右扫描）：\n- 单元与中心点：\n  - $0$: $\\boldsymbol{x}_0 = (0.5, 0.5)$\n  - $1$: $\\boldsymbol{x}_1 = (1.5, 0.5)$\n  - $2$: $\\boldsymbol{x}_2 = (0.5, 1.5)$\n  - $3$: $\\boldsymbol{x}_3 = (1.5, 1.5)$\n- 每个单元的面（每个条目为 $(\\boldsymbol{n}_{i,f}, \\text{邻居})$，其中邻居 $\\in \\{0,1,2,3\\}$ 或 $\\varnothing$）：\n  - 单元 $0$: $[ ((-1,0), \\varnothing),\\ ((+1,0), 1),\\ ((0,-1), \\varnothing),\\ ((0,+1), 2) ]$\n  - 单元 $1$: $[ ((-1,0), 0),\\ ((+1,0), \\varnothing),\\ ((0,-1), \\varnothing),\\ ((0,+1), 3) ]$\n  - 单元 $2$: $[ ((-1,0), \\varnothing),\\ ((+1,0), 3),\\ ((0,-1), 0),\\ ((0,+1), \\varnothing) ]$\n  - 单元 $3$: $[ ((-1,0), 2),\\ ((+1,0), \\varnothing),\\ ((0,-1), 1),\\ ((0,+1), \\varnothing) ]$\n- 方向: $\\hat{\\boldsymbol{s}} = (1, 0)$\n\n测试用例2（非结构化三角形链，对角线扫描）：\n- 单元与中心点：\n  - $0$: $\\boldsymbol{x}_0 = (0.0, 0.0)$\n  - $1$: $\\boldsymbol{x}_1 = (1.0, 1.0)$\n  - $2$: $\\boldsymbol{x}_2 = (2.0, 2.0)$\n- 每个单元的面：\n  - 单元 $0$: $[ ((+1,+1), 1),\\ ((-1,0), \\varnothing),\\ ((0,-1), \\varnothing) ]$\n  - 单元 $1$: $[ ((-1,-1), 0),\\ ((+1,+1), 2),\\ ((-1,+1), \\varnothing) ]$\n  - 单元 $2$: $[ ((-1,-1), 1),\\ ((+1,0), \\varnothing),\\ ((0,+1), \\varnothing) ]$\n- 方向: $\\hat{\\boldsymbol{s}} = (1, 1)$\n\n测试用例3（切向内面，向上扫描）：\n- 单元与中心点：\n  - $0$: $\\boldsymbol{x}_0 = (0.5, 0.5)$\n  - $1$: $\\boldsymbol{x}_1 = (1.5, 0.5)$\n- 每个单元的面：\n  - 单元 $0$: $[ ((-1,0), \\varnothing),\\ ((+1,0), 1),\\ ((0,-1), \\varnothing),\\ ((0,+1), \\varnothing) ]$\n  - 单元 $1$: $[ ((-1,0), 0),\\ ((+1,0), \\varnothing),\\ ((0,-1), \\varnothing),\\ ((0,+1), \\varnothing) ]$\n- 方向: $\\hat{\\boldsymbol{s}} = (0, 1)$\n\n你的程序必须：\n- 为每个测试用例构建如上定义的有向依赖图。\n- 计算一个尊重依赖关系的拓扑顺序。在任何步骤中，当多个单元的入度为零时，选择 $t_i = \\boldsymbol{x}_i \\cdot \\hat{\\boldsymbol{s}}$ 最小的单元；如果仍然平局，选择标识符 $i$ 最小的单元。\n- 将每个测试用例的扫描顺序作为整数列表输出。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含所有三个测试用例的结果，格式为一个由方括号括起来的逗号分隔列表，每个测试用例的结果本身是一个表示扫描顺序中单元标识符的整数列表。例如，格式必须严格如 $[[\\dots],[\\dots],[\\dots]]$，各项之间用逗号分隔，无附加文本。\n\n预期的输出数据类型是整数列表。此问题中无需报告物理单位。不使用角度；所有方向均通过其向量分量指定。输出中的所有数字都应为对应于单元标识符的整数。", "solution": "所提出的问题是输运现象计算方法领域中一个定义明确的标准任务。它要求为应用于辐射传输方程（RTE）的离散坐标法（DOM）构建一个扫描序列。扫描序列是一种特定的计算单元排序，它遵循信息流动的方向，这是一个由上风（upwinding）原则决定的概念。这个序列等同于表示单元依赖关系的有向图的拓扑排序。\n\n控制方程是二维稳态RTE，针对一个特定的离散方向 $\\hat{\\boldsymbol{s}}$：\n$$\n\\hat{\\boldsymbol{s}} \\cdot \\nabla I(\\boldsymbol{x}, \\hat{\\boldsymbol{s}}) + \\kappa I(\\boldsymbol{x}, \\hat{\\boldsymbol{s}}) = S(\\boldsymbol{x}, \\hat{\\boldsymbol{s}})\n$$\n在有限体积离散化中，一个单元 $\\mathcal{C}_i$ 中的强度 $I$ 与其邻居耦合。这种耦合的方向由方向向量 $\\hat{\\boldsymbol{s}}$ 和单元 $\\mathcal{C}_i$ 的面 $f$ 的外向法向量 $\\boldsymbol{n}_{i,f}$ 的点积符号决定。如果 $\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f}  0$，该面是入流面，单元 $\\mathcal{C}_i$ 的计算依赖于来自单元外部的信息。如果此面与邻近单元 $\\mathcal{C}_j$ 共享，则单元 $\\mathcal{C}_i$ 依赖于单元 $\\mathcal{C}_j$。这建立了一个有向依赖关系 $j \\to i$。\n\n该问题要求实现一个特定算法来确定此扫描顺序，这是Kahn算法用于拓扑排序的一个变种。过程如下：\n\n1.  **依赖图构建**：对于给定的网格和方向 $\\hat{\\boldsymbol{s}}$，构建一个有向图 $G = (V, E)$。顶点 $V$ 是单元标识符 $\\{0, 1, \\dots, N-1\\}$。当且仅当单元 $\\mathcal{C}_i$ 与邻居 $\\mathcal{C}_j$ 共享一个内面，并且满足条件 $\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f}  -\\varepsilon$ 时，一条有向边 $j \\to i$ 被添加到边集 $E$ 中。这里 $\\boldsymbol{n}_{i,f}$ 是从单元 $\\mathcal{C}_i$ 在该面上的外向法线，$\\varepsilon = 10^{-12}$ 是指定的数值容差。\n\n2.  **拓扑排序**：计算拓扑排序。该算法迭代进行：\n    a. 计算所有顶点（单元）的入度。\n    b. 维护一个入度为零的顶点队列。这些是准备好被处理的单元。\n    c. 当队列中有多个单元时，必须应用一个确定性的平局打破规则。选择具有最小投影中心坐标 $t_i = \\boldsymbol{x}_i \\cdot \\hat{\\boldsymbol{s}}$ 的单元。如果仍然平局，则选择具有最小数值标识符 $i$ 的单元。\n    d. 从队列中移除所选单元，并将其添加到最终的排序列表中。\n    e. 图中其所有后继单元的入度减一。如果任何后继单元的入度变为零，则将其添加到队列中。\n    f. 重复此过程，直到队列为空。\n\n我们现在将此过程应用于每个测试用例。\n\n**测试用例1：结构化 $2 \\times 2$ 网格, $\\hat{\\boldsymbol{s}} = (1, 0)$**\n\n单元为 $\\{0, 1, 2, 3\\}$。方向向量为 $\\hat{\\boldsymbol{s}} = (1, 0)$。用于打破平局的投影为 $t_i = \\boldsymbol{x}_i \\cdot \\hat{\\boldsymbol{s}}$：\n- $t_0 = (0.5, 0.5) \\cdot (1, 0) = 0.5$\n- $t_1 = (1.5, 0.5) \\cdot (1, 0) = 1.5$\n- $t_2 = (0.5, 1.5) \\cdot (1, 0) = 0.5$\n- $t_3 = (1.5, 1.5) \\cdot (1, 0) = 1.5$\n\n点积 $\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f}$ 决定了依赖关系：\n- 对于单元 $1$，与邻居 $0$ 的面：法向量为 $\\boldsymbol{n}_{1,f}=(-1, 0)$。$\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{1,f} = (1,0) \\cdot (-1,0) = -1  -\\varepsilon$。这创建了一个依赖关系 $0 \\to 1$。\n- 对于单元 $3$，与邻居 $2$ 的面：法向量为 $\\boldsymbol{n}_{3,f}=(-1, 0)$。$\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{3,f} = (1,0) \\cdot (-1,0) = -1  -\\varepsilon$。这创建了一个依赖关系 $2 \\to 3$。\n- 所有其他内面的法向量都与 $\\hat{\\boldsymbol{s}}$ 正交，导致点积为零，被视为切向（无依赖关系）。\n\n得到的图包含边 $\\{0 \\to 1, 2 \\to 3\\}$。初始入度为：$ind(0)=0, ind(1)=1, ind(2)=0, ind(3)=1$。\n\n排序过程如下：\n1.  初始的零入度单元队列：$\\{0, 2\\}$。打破平局：$t_0 = 0.5$ 且 $t_2 = 0.5$。出现投影平局。次要平局打破规则是单元ID：$0  2$。选择单元 $0$。扫描顺序：$[0]$。\n2.  处理单元 $0$。其后继单元 $1$ 的入度减为 $0$。可用单元队列变为 $\\{2, 1\\}$。\n3.  在单元 $1$ 和 $2$ 之间选择。打破平局：$t_1 = 1.5$，$t_2 = 0.5$。因为 $t_2  t_1$，选择单元 $2$。扫描顺序：$[0, 2]$。\n4.  处理单元 $2$。其后继单元 $3$ 的入度减为 $0$。队列变为 $\\{1, 3\\}$。\n5.  在单元 $1$ 和 $3$ 之间选择。打破平局：$t_1 = 1.5$，$t_3 = 1.5$。出现投影平局。次要平局打破规则：$1  3$。选择单元 $1$。扫描顺序：$[0, 2, 1]$。\n6.  唯一剩下的单元是 $3$。选择它。扫描顺序：$[0, 2, 1, 3]$。\n\n测试用例1的最终扫描顺序为 $[0, 2, 1, 3]$。\n\n**测试用例2：非结构化三角形链, $\\hat{\\boldsymbol{s}} = (1, 1)$**\n\n单元为 $\\{0, 1, 2\\}$。方向向量为 $\\hat{\\boldsymbol{s}} = (1, 1)$。打破平局的投影为：\n- $t_0 = (0, 0) \\cdot (1, 1) = 0$\n- $t_1 = (1, 1) \\cdot (1, 1) = 2$\n- $t_2 = (2, 2) \\cdot (1, 1) = 4$\n\n依赖关系由 $\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{i,f}$ 决定：\n- 对于单元 $1$，与邻居 $0$ 的面：法向量为 $\\boldsymbol{n}_{1,f}=(-1, -1)$。$\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{1,f} = (1,1) \\cdot (-1,-1) = -2  -\\varepsilon$。依赖关系 $0 \\to 1$。\n- 对于单元 $2$，与邻居 $1$ 的面：法向量为 $\\boldsymbol{n}_{2,f}=(-1, -1)$。$\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{2,f} = (1,1) \\cdot (-1,-1) = -2  -\\varepsilon$。依赖关系 $1 \\to 2$。\n- 其他面要么是出流、切向，要么是边界入流，不产生依赖关系。\n\n该图是一个简单的链：$0 \\to 1 \\to 2$。初始入度为：$ind(0)=0, ind(1)=1, ind(2)=1$。\n\n排序过程很直接，因为从没有多重选择：\n1.  初始队列：$\\{0\\}$。选择 $0$。扫描顺序：$[0]$。\n2.  单元 $1$ 的入度变为 $0$。队列：$\\{1\\}$。选择 $1$。扫描顺序：$[0, 1]$。\n3.  单元 $2$ 的入度变为 $0$。队列：$\\{2\\}$。选择 $2$。扫描顺序：$[0, 1, 2]$。\n\n测试用例2的最终扫描顺序为 $[0, 1, 2]$。\n\n**测试用例3：切向内面, $\\hat{\\boldsymbol{s}} = (0, 1)$**\n\n单元为 $\\{0, 1\\}$。方向向量为 $\\hat{\\boldsymbol{s}} = (0, 1)$。打破平局的投影为：\n- $t_0 = (0.5, 0.5) \\cdot (0, 1) = 0.5$\n- $t_1 = (1.5, 0.5) \\cdot (0, 1) = 0.5$\n\n单元 $0$ 和 $1$ 之间的面的法向量对于单元 $0$ 是 $\\boldsymbol{n}_{0,f}=(+1,0)$，对于单元 $1$ 是 $\\boldsymbol{n}_{1,f}=(-1,0)$。\n- 对于单元 $0$：$\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{0,f} = (0,1) \\cdot (1,0) = 0$。\n- 对于单元 $1$：$\\hat{\\boldsymbol{s}} \\cdot \\boldsymbol{n}_{1,f} = (0,1) \\cdot (-1,0) = 0$。\n两个点积都为 $0$，落在切向容差 $[-\\varepsilon, +\\varepsilon]$ 内。因此，这个面不产生任何依赖关系。所有其他面要么是边界入流，要么是出流。最终的依赖图没有边。\n\n初始入度为 $ind(0)=0$ 和 $ind(1)=0$。\n\n排序过程如下：\n1.  初始队列：$\\{0, 1\\}$。打破平局：$t_0 = 0.5$ 且 $t_1 = 0.5$。投影平局。次要平局打破规则（单元ID）：$0  1$。选择单元 $0$。扫描顺序：$[0]$。\n2.  队列现在只包含单元 $1$。选择它。扫描顺序：$[0, 1]$。\n\n测试用例3的最终扫描顺序为 $[0, 1]$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_sweep_schedule(cells, faces_per_cell, direction_vector, tolerance):\n    \"\"\"\n    Constructs a sweep schedule for the Discrete Ordinates Method.\n\n    This involves building a dependency graph based on upwinding rules for a given\n    sweep direction and then performing a topological sort on that graph with\n    specific tie-breaking rules.\n    \"\"\"\n    num_cells = len(cells)\n    cell_ids = sorted(cells.keys())\n    \n    # Use numpy arrays for vector operations\n    cell_centers = {cid: np.array(c) for cid, c in cells.items()}\n    s_vec = np.array(direction_vector)\n    \n    # 1. Calculate tie-breaking projections\n    projections = {cid: np.dot(cell_centers[cid], s_vec) for cid in cell_ids}\n    \n    # 2. Build the dependency graph\n    # Adjacency list: adj[j] contains list of cells i that depend on j (j -> i)\n    adj = {cid: [] for cid in cell_ids}\n    # In-degree for each cell\n    in_degrees = {cid: 0 for cid in cell_ids}\n    \n    for i in cell_ids:\n        for face_normal, neighbor_j in faces_per_cell[i]:\n            # A dependency j -> i is created if cell i has an inflow face\n            # from an internal neighbor j.\n            \n            # Boundary faces have neighbor_j as None and create no dependencies\n            if neighbor_j is None:\n                continue\n            \n            n_vec = np.array(face_normal)\n            dot_product = np.dot(s_vec, n_vec)\n            \n            # Inflow condition: s . n_i,f  -epsilon.\n            # Normal n_i,f is for cell i, neighbor is j.\n            # This means information flows from j to i. Add edge j -> i.\n            if dot_product  -tolerance:\n                adj[neighbor_j].append(i)\n                in_degrees[i] += 1\n                \n    # 3. Perform topological sort (Kahn's algorithm)\n    # The queue contains all cells with an in-degree of 0.\n    queue = [cid for cid in cell_ids if in_degrees[cid] == 0]\n    \n    sorted_order = []\n    \n    while queue:\n        # Sort the queue to apply tie-breaking rules:\n        # 1. Minimum projected coordinate t_i\n        # 2. Minimum cell identifier i\n        queue.sort(key=lambda cid: (projections[cid], cid))\n        \n        # Dequeue the cell with the highest priority (first in sorted list)\n        u = queue.pop(0)\n        sorted_order.append(u)\n        \n        # For each neighbor v of u, update in-degrees\n        # Graph stores u -> v, so v is a successor of u\n        for v in sorted(adj[u]): # Sort for deterministic behavior, though not strictly required by problem\n            in_degrees[v] -= 1\n            if in_degrees[v] == 0:\n                queue.append(v)\n                \n    # The graph must be a DAG, so the sort should include all cells.\n    if len(sorted_order) != num_cells:\n        # This should not occur for valid DOM sweep problems.\n        raise ValueError(\"The dependency graph contains a cycle.\")\n        \n    return sorted_order\n\ndef solve():\n    \"\"\"\n    Defines test cases and computes the sweep schedule for each.\n    \"\"\"\n    \n    # Define the tolerance for tangential flow\n    epsilon = 1e-12\n\n    # Test Case 1\n    cells_1 = {\n        0: (0.5, 0.5), 1: (1.5, 0.5),\n        2: (0.5, 1.5), 3: (1.5, 1.5)\n    }\n    faces_1 = {\n        0: [ ((-1.0, 0.0), None), ((1.0, 0.0), 1), ((0.0, -1.0), None), ((0.0, 1.0), 2) ],\n        1: [ ((-1.0, 0.0), 0),   ((1.0, 0.0), None),((0.0, -1.0), None), ((0.0, 1.0), 3) ],\n        2: [ ((-1.0, 0.0), None), ((1.0, 0.0), 3), ((0.0, -1.0), 0),   ((0.0, 1.0), None) ],\n        3: [ ((-1.0, 0.0), 2),   ((1.0, 0.0), None),((0.0, -1.0), 1),   ((0.0, 1.0), None) ]\n    }\n    direction_1 = (1.0, 0.0)\n\n    # Test Case 2\n    cells_2 = {\n        0: (0.0, 0.0), 1: (1.0, 1.0), 2: (2.0, 2.0)\n    }\n    faces_2 = {\n        0: [ ((1.0, 1.0), 1), ((-1.0, 0.0), None), ((0.0, -1.0), None) ],\n        1: [ ((-1.0, -1.0), 0), ((1.0, 1.0), 2), ((-1.0, 1.0), None) ],\n        2: [ ((-1.0, -1.0), 1), ((1.0, 0.0), None), ((0.0, 1.0), None) ]\n    }\n    direction_2 = (1.0, 1.0)\n    \n    # Test Case 3\n    cells_3 = {\n        0: (0.5, 0.5), 1: (1.5, 0.5)\n    }\n    faces_3 = {\n        0: [ ((-1.0, 0.0), None), ((1.0, 0.0), 1), ((0.0, -1.0), None), ((0.0, 1.0), None) ],\n        1: [ ((-1.0, 0.0), 0), ((1.0, 0.0), None), ((0.0, -1.0), None), ((0.0, 1.0), None) ]\n    }\n    direction_3 = (0.0, 1.0)\n    \n    test_cases = [\n        (cells_1, faces_1, direction_1),\n        (cells_2, faces_2, direction_2),\n        (cells_3, faces_3, direction_3)\n    ]\n\n    results = []\n    for cells, faces, direction in test_cases:\n        result = compute_sweep_schedule(cells, faces, direction, epsilon)\n        results.append(result)\n\n    # Format output as a string representation of a list of lists.\n    # e.g., [[0, 2, 1, 3],[0, 1, 2],[0, 1]]\n    output_str = \"[\" + \",\".join(map(str, results)) + \"]\"\n    \n    # Remove spaces for exact format matching\n    print(output_str.replace(\" \", \"\"))\n\nsolve()\n```", "id": "2528194"}]}