{"hands_on_practices": [{"introduction": "在着手进行复杂的计算流体动力学（CFD）模拟之前，一个至关重要的步骤是进行量纲分析，以确定控制方程中各项的相对重要性。这种初步分析可以帮助我们简化物理模型，从而节省大量的计算资源，并将模拟的重点放在主导现象上。本练习将通过一个微通道流动的具体案例，指导您计算关键的无量纲数，并基于此判断是否需要在能量方程中考虑粘性耗散这一物理效应 [@problem_id:2497439]。", "problem": "一位换热器设计师考虑在一个计算流体动力学 (CFD) 模型中，模拟一种稳态、不可压缩、物性恒定的牛顿液体流过一个矩形微通道。该液体是甘油，其主体温度接近 $40\\,^{\\circ}\\mathrm{C}$，具有以下（假定为常数的）物性参数：密度 $\\rho = 1260\\,\\mathrm{kg/m^3}$，动力粘度 $\\mu = 0.200\\,\\mathrm{Pa\\cdot s}$，热导率 $k = 0.285\\,\\mathrm{W/(m\\cdot K)}$，定压比热 $c_p = 2400\\,\\mathrm{J/(kg\\cdot K)}$。流动的主体速度为 $U = 2.00\\,\\mathrm{m/s}$，特征长度为 $L = 4.00\\,\\mathrm{mm}$（使用水力直径作为特征长度）。壁面与入口流体之间的代表性温差为 $\\Delta T = 5.00\\,\\mathrm{K}$。\n\n从质量、动量和能量守恒方程出发，并使用特征尺度 $L$（长度）、$U$（速度）和 $\\Delta T$（温度）进行无量纲化，辨识相关的无量纲数群并计算它们的值：雷诺数 $Re$、普朗特数 $Pr$、佩克莱数 $Pe$ 和埃克特数 $Ec$。然后，基于无量纲能量方程进行数量级分析，论证在此流动的 CFD 模拟中，能量方程是否必须包含粘性耗散项。\n\n请用单个数字报告你的最终决定：如果必须包含粘性耗散，则写 $1$；如果可以忽略，则写 $0$。不要将任何中间量作为最终答案报告。", "solution": "该问题要求基于无量纲控制方程的数量级分析，评估在给定流动场景下，能量方程中包含粘性耗散项的必要性。这是建立任何用于传热分析的计算流体动力学 (CFD) 模型中的一个关键步骤，因为它决定了必须求解哪些物理现象。\n\n出发点是稳态、不可压缩、物性恒定的牛顿流体的能量守恒。热能方程为：\n$$ \\rho c_p (\\mathbf{u} \\cdot \\nabla) T = k \\nabla^2 T + \\Phi_v $$\n在这里，$\\rho$ 是密度，$c_p$ 是定压比热，$\\mathbf{u}$ 是速度矢量，$T$ 是温度，$k$ 是热导率，$\\Phi_v$ 是粘性耗散函数，它表示由粘性应力所做的不可逆功的速率，将动能转化为内能。对于牛顿流体，$\\Phi_v$ 由速度梯度的二次型给出。\n\n为了进行数量级分析，我们对方程进行无量纲化。我们引入以下由星号（$*$）表示的无量纲变量，这些变量基于所提供的特征尺度：长度尺度 $L$、速度尺度 $U$ 和温度尺度 $\\Delta T$。\n$$ x_i^* = \\frac{x_i}{L}, \\quad u_i^* = \\frac{u_i}{U}, \\quad T^* = \\frac{T - T_{ref}}{\\Delta T} $$\n其中 $T_{ref}$ 是一个参考温度，如入口温度。微分算子变换为 $\\nabla = \\frac{1}{L}\\nabla^*$ 和 $\\nabla^2 = \\frac{1}{L^2}\\nabla^{*2}$。粘性耗散函数的尺度为 $\\Phi_v \\sim \\mu (U/L)^2$。将这些代入能量方程得到：\n$$ \\rho c_p \\left( (U \\mathbf{u}^*) \\cdot \\frac{1}{L}\\nabla^* \\right) (\\Delta T \\cdot T^*) = k \\frac{\\Delta T}{L^2} \\nabla^{*2} T^* + \\mathcal{O}\\left(\\frac{\\mu U^2}{L^2}\\right) $$\n整理各项：\n$$ \\left( \\frac{\\rho c_p U \\Delta T}{L} \\right) (\\mathbf{u}^* \\cdot \\nabla^*) T^* = \\left( \\frac{k \\Delta T}{L^2} \\right) \\nabla^{*2} T^* + \\left( \\frac{\\mu U^2}{L^2} \\right) \\Phi_v^* $$\n其中 $\\Phi_v^*$ 是量级为 1 的无量纲粘性耗散函数。\n\n为了比较各项的相对大小，我们对方程进行归一化。一种具有物理洞察力的归一化方法是除以传导项的系数 $\\frac{k \\Delta T}{L^2}$：\n$$ \\left( \\frac{\\rho c_p U L}{k} \\right) (\\mathbf{u}^* \\cdot \\nabla^*) T^* = \\nabla^{*2} T^* + \\left( \\frac{\\mu U^2}{k \\Delta T} \\right) \\Phi_v^* $$\n从这个方程中，我们辨识出相关的无量纲数群。对流项的系数是佩克莱数 $Pe$。粘性耗散项的系数是布林克曼数 $Br$。\n$$ Pe = \\frac{\\rho c_p U L}{k} = \\frac{\\rho U L}{\\mu} \\cdot \\frac{\\mu c_p}{k} = Re \\cdot Pr $$\n$$ Br = \\frac{\\mu U^2}{k \\Delta T} = \\frac{U^2}{c_p \\Delta T} \\cdot \\frac{\\mu c_p}{k} = Ec \\cdot Pr $$\n因此，无量纲能量方程为：\n$$ Pe \\, (\\mathbf{u}^* \\cdot \\nabla^*) T^* = \\nabla^{*2} T^* + Br \\, \\Phi_v^* $$\n只有当 $Br \\, \\Phi_v^*$ 项远小于其他项，特别是传导项 $\\nabla^{*2} T^*$（该项总是存在并定义了热边界条件的响应）时，粘性耗散才是可忽略的。因此，忽略粘性耗散的准则是 $Br \\ll 1$。\n\n现在我们使用给定的数据计算这些无量纲数：\n- 密度：$\\rho = 1260\\,\\mathrm{kg/m^3}$\n- 动力粘度：$\\mu = 0.200\\,\\mathrm{Pa\\cdot s}$\n- 热导率：$k = 0.285\\,\\mathrm{W/(m\\cdot K)}$\n- 比热：$c_p = 2400\\,\\mathrm{J/(kg\\cdot K)}$\n- 主体速度：$U = 2.00\\,\\mathrm{m/s}$\n- 特征长度：$L = 4.00\\,\\mathrm{mm} = 4.00 \\times 10^{-3}\\,\\mathrm{m}$\n- 温差：$\\Delta T = 5.00\\,\\mathrm{K}$\n\n雷诺数 $Re$ 为：\n$$ Re = \\frac{\\rho U L}{\\mu} = \\frac{(1260\\,\\mathrm{kg/m^3}) (2.00\\,\\mathrm{m/s}) (4.00 \\times 10^{-3}\\,\\mathrm{m})}{0.200\\,\\mathrm{Pa\\cdot s}} = 50.4 $$\n普朗特数 $Pr$ 为：\n$$ Pr = \\frac{\\mu c_p}{k} = \\frac{(0.200\\,\\mathrm{Pa\\cdot s}) (2400\\,\\mathrm{J/(kg\\cdot K)})}{0.285\\,\\mathrm{W/(m\\cdot K)}} = \\frac{480}{0.285} \\approx 1684.2 $$\n埃克特数 $Ec$ 为：\n$$ Ec = \\frac{U^2}{c_p \\Delta T} = \\frac{(2.00\\,\\mathrm{m/s})^2}{(2400\\,\\mathrm{J/(kg\\cdot K)}) (5.00\\,\\mathrm{K})} = \\frac{4}{12000} = \\frac{1}{3000} \\approx 3.33 \\times 10^{-4} $$\n佩克莱数 $Pe$ 为：\n$$ Pe = Re \\cdot Pr = 50.4 \\times \\frac{480}{0.285} \\approx 84884 $$\n高佩克莱数表明，在主流区，传热由对流主导。然而，要确定壁面热通量，需要考察靠近固体表面的各项之间的平衡，这需要检验布林克曼数。\n\n布林克曼数 $Br$ 为：\n$$ Br = Ec \\cdot Pr = \\left(\\frac{1}{3000}\\right) \\left(\\frac{480}{0.285}\\right) = \\frac{480}{855} = \\frac{32}{57} \\approx 0.5614 $$\n布林克曼数的值为 $Br \\approx 0.56$。这个值并不远小于 $1$。它表明，由粘性力产生的热量与由分子传导输运的热量处于同一数量级（大约为其 $56\\%$）。在一个旨在精确预测温度场和传热率的 CFD 模拟中，特别是在靠近壁面、速度梯度大的高剪切区域，这样一个相对大小的源项如果被忽略，将会引入显著的误差。\n\n因此，为了对此微通道流动进行物理上合理的模拟，能量方程中必须包含粘性耗散项。最终决定是包含该项，对应数值为 $1$。", "answer": "$$\n\\boxed{1}\n$$", "id": "2497439"}, {"introduction": "将连续的偏微分方程（PDE）转化为离散的代数方程组是CFD方法的核心。然而，离散格式的选择对解的准确性和物理真实性有着深远的影响。本练习将引导您通过编写代码，求解一个典型的一维对流-扩散问题，并比较中心差分和一阶迎风这两种常用格式的性能 [@problem_id:2497371]。通过这个过程，您将亲身体验到在数值模拟中准确性与稳定性之间的经典权衡，并理解网格佩克莱数（cell Peclet number）为何是预测非物理解振荡等数值问题的关键指标。", "problem": "考虑一个一维稳态对流-扩散问题，研究对象是定义在域 $x \\in [0,L]$ 上的标量温度场 $T(x)$，该问题具有恒定的物性和 Dirichlet 边界条件。控制微分方程由能量守恒和具有恒定系数的 Fickian 扩散导出：$$\\frac{d}{dx}\\left(\\Gamma \\frac{dT}{dx}\\right) - \\rho u \\frac{dT}{dx} = 0,$$ 其中 $\\Gamma$ 是扩散系数，$\\rho$ 是密度，而 $u$ 是沿 $x$ 正方向的均匀流速。Dirichlet 边界条件为 $T(0)=T_L$ 和 $T(L)=T_R$。假设 $\\Gamma>0$，$\\rho \\ge 0$ 以及 $u \\ge 0$。从这个基本方程出发，使用一个包含 $N$ 个区间的均匀网格（因此 $\\Delta x = L/N$），并对对流导数项采用以下两种近似方法，为内部网格点推导一个相容的有限差分离散格式：(a) 一阶迎风格式（针对 $u \\ge 0$）和 (b) 二阶中心差分格式。在两种情况下，扩散项均使用中心差分。使用 Dirichlet 数据处理边界，不引入额外的未知数。为每种格式构建并求解所得到的关于内部未知数的线性系统。\n\n您的程序还必须通过解析求解相关的常微分方程来推导和实现该微分方程的精确连续解，应用边界条件，并在网格节点 $x_j = j \\Delta x$（其中 $j = 0,1,\\dots,N$）上对其进行求值。\n\n定义单元 Peclet 数为 $$\\mathrm{Pe}_{\\Delta x} = \\frac{\\rho u \\Delta x}{\\Gamma}.$$ 对于下面的每个测试用例，计算并报告以下量：\n- $\\mathrm{Pe}_{\\Delta x}$ 的值，为一个非负实数。\n- 中心差分格式的离散节点解与精确解之间的最大范数误差（绝对值），在所有网格节点上进行评估，表示为一个实数。\n- 一阶迎风格式的离散节点解与精确解之间的最大范数误差（绝对值），在所有网格节点上进行评估，表示为一个实数。\n- 一个布尔值，指示中心差分格式的离散解在所有网格节点（包括边界）上是否界于 $\\min(T_L,T_R)$ 和 $\\max(T_L,T_R)$ 之间。\n\n测试套件包含以下参数集，旨在探测 $\\mathrm{Pe}_{\\Delta x}$ 的不同区域（其中 $L$、$T_L$ 和 $T_R$ 保持不变）：\n- 案例 A（扩散主导，一般情况）：$L=1$，$T_L=0$，$T_R=1$，$\\rho=1$，$u=0.2$，$\\Gamma=1$，$N=50$。\n- 案例 B（接近中心差分单调性极限）：$L=1$，$T_L=0$，$T_R=1$，$\\rho=1$，$u=4$，$\\Gamma=0.2$，$N=10$。\n- 案例 C（对流主导，中心差分可能出现振荡）：$L=1$，$T_L=0$，$T_R=1$，$\\rho=1$，$u=10$，$\\Gamma=0.1$，$N=10$。\n- 案例 D（纯扩散边界情况）：$L=1$，$T_L=0$，$T_R=1$，$\\rho=1$，$u=0$，$\\Gamma=1$，$N=20$。\n\n由于控制方程中隐含的归一化，所有量都是无量纲的；因此不需要也无需报告物理单位。不涉及角度，也不使用百分比。\n\n您的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表形式的结果，每个子列表对应一个测试用例，顺序与上面列出的一致。每个子列表必须为 $[\\mathrm{Pe}_{\\Delta x}, e_\\infty^{\\mathrm{central}}, e_\\infty^{\\mathrm{upwind}}, \\text{bounded}_{\\mathrm{central}}]$ 的形式，其中 $e_\\infty$ 表示最大范数误差，$\\text{bounded}_{\\mathrm{central}}$ 是一个布尔值。例如，输出格式必须类似于 $[[a,b,c,\\mathrm{True}],[d,e,f,\\mathrm{False}],\\dots]$，用适当的数值替换，并打印在单行上。", "solution": "所提出的问题是计算流体动力学领域中的一个标准的、适定的练习，具体涉及一维稳态对流-扩散方程的数值解。该问题在科学上是合理的，其参数定义清晰。因此，可以构建一个解决方案。\n\n任务是分析和比较两种有限差分格式与控制方程的精确解析解：\n$$\n\\frac{d}{dx}\\left(\\Gamma \\frac{dT}{dx}\\right) - \\rho u \\frac{dT}{dx} = 0\n$$\n鉴于热扩散系数 $\\Gamma$、密度 $\\rho$ 和速度 $u$ 均为常数，方程可简化为一个具有常系数的二阶线性常微分方程（ODE）：\n$$\n\\Gamma \\frac{d^2T}{dx^2} - \\rho u \\frac{dT}{dx} = 0\n$$\n定义域为 $x \\in [0, L]$，Dirichlet 边界条件为 $T(0) = T_L$ 和 $T(L) = T_R$。\n\n首先，我们推导精确解析解。该 ODE 对应的特征方程是：\n$$\n\\Gamma r^2 - \\rho u r = 0 \\implies r(\\Gamma r - \\rho u) = 0\n$$\n其根为 $r_1 = 0$ 和 $r_2 = \\frac{\\rho u}{\\Gamma}$。\n\n情况1：$\\rho u \\neq 0$。\n通解的形式为 $T(x) = C_1 e^{r_1 x} + C_2 e^{r_2 x}$，即：\n$$\nT(x) = C_1 + C_2 e^{(\\rho u / \\Gamma) x}\n$$\n常数 $C_1$ 和 $C_2$ 通过应用边界条件来确定：\n$T(0) = T_L \\implies C_1 + C_2 = T_L$\n$T(L) = T_R \\implies C_1 + C_2 e^{(\\rho u L / \\Gamma)} = T_R$\n\n求解这个二元线性方程组得到：\n$C_2 = \\frac{T_R - T_L}{e^{(\\rho u L / \\Gamma)} - 1}$\n$C_1 = T_L - C_2 = T_L - \\frac{T_R - T_L}{e^{(\\rho u L / \\Gamma)} - 1}$\n\n将这些常数代回通解，得到精确解：\n$$\nT(x) = T_L + (T_R - T_L) \\frac{e^{(\\rho u x / \\Gamma)} - 1}{e^{(\\rho u L / \\Gamma)} - 1}\n$$\n\n情况2：$\\rho u = 0$。\n控制方程简化为 $\\Gamma \\frac{d^2T}{dx^2} = 0$，因为 $\\Gamma > 0$，这意味着 $\\frac{d^2T}{dx^2} = 0$。通解是一个线性函数：\n$$\nT(x) = C_1 x + C_2\n$$\n应用边界条件：\n$T(0) = T_L \\implies C_2 = T_L$\n$T(L) = T_R \\implies C_1 L + C_2 = T_R \\implies C_1 = \\frac{T_R - T_L}{L}$\n\n纯扩散情况的精确解为：\n$$\nT(x) = T_L + (T_R - T_L) \\frac{x}{L}\n$$\n这个结果也是情况1的解在 $\\rho u \\to 0$ 时的极限，可以使用 L'Hôpital's rule 进行验证。\n\n接下来，我们构建有限差分格式。将域离散化为 $N$ 个大小为 $\\Delta x = L/N$ 的均匀区间。网格点为 $x_j = j \\Delta x$，其中 $j = 0, 1, \\dots, N$。这些点上的温度记为 $T_j = T(x_j)$。已知 $T_0 = T_L$ 和 $T_N = T_R$ 的值。我们需求解 $N-1$ 个内部点 $T_1, \\dots, T_{N-1}$ 的解。\n\n在任意内部节点 $j \\in \\{1, \\dots, N-1\\}$，我们对控制方程进行离散化。扩散项使用二阶中心差分格式进行近似：\n$$\n\\Gamma \\frac{d^2T}{dx^2}\\bigg|_j \\approx \\Gamma \\frac{T_{j+1} - 2T_j + T_{j-1}}{(\\Delta x)^2}\n$$\n对流项 $-\\rho u \\frac{dT}{dx}$ 通过两种方式进行近似。\n\n(a) 一阶迎风（FOU）格式：\n对于 $u \\ge 0$，流动方向为 $x$ 正方向，因此“迎风”信息来自节点 $j-1$。\n$$\n-\\rho u \\frac{dT}{dx}\\bigg|_j \\approx -\\rho u \\frac{T_j - T_{j-1}}{\\Delta x}\n$$\n合并各项，离散后的方程为：\n$$\n\\Gamma \\frac{T_{j+1} - 2T_j + T_{j-1}}{(\\Delta x)^2} - \\rho u \\frac{T_j - T_{j-1}}{\\Delta x} = 0\n$$\n两边同乘以 $(\\Delta x)^2 / \\Gamma$ 并引入单元 Peclet 数 $\\mathrm{Pe}_{\\Delta x} = \\frac{\\rho u \\Delta x}{\\Gamma}$：\n$$\n(T_{j+1} - 2T_j + T_{j-1}) - \\mathrm{Pe}_{\\Delta x} (T_j - T_{j-1}) = 0\n$$\n按节点温度分组，我们得到节点 $j$ 的代数方程：\n$$\n(1 + \\mathrm{Pe}_{\\Delta x}) T_{j-1} - (2 + \\mathrm{Pe}_{\\Delta x}) T_j + T_{j+1} = 0\n$$\n\n(b) 二阶中心差分（CD）格式：\n对流项使用二阶中心差分进行近似：\n$$\n-\\rho u \\frac{dT}{dx}\\bigg|_j \\approx -\\rho u \\frac{T_{j+1} - T_{j-1}}{2 \\Delta x}\n$$\n离散后的方程变为：\n$$\n\\Gamma \\frac{T_{j+1} - 2T_j + T_{j-1}}{(\\Delta x)^2} - \\rho u \\frac{T_{j+1} - T_{j-1}}{2 \\Delta x} = 0\n$$\n两边同乘以 $(\\Delta x)^2 / \\Gamma$：\n$$\n(T_{j+1} - 2T_j + T_{j-1}) - \\frac{\\mathrm{Pe}_{\\Delta x}}{2} (T_{j+1} - T_{j-1}) = 0\n$$\n按节点温度分组：\n$$\n\\left(1 + \\frac{\\mathrm{Pe}_{\\Delta x}}{2}\\right) T_{j-1} - 2 T_j + \\left(1 - \\frac{\\mathrm{Pe}_{\\Delta x}}{2}\\right) T_{j+1} = 0\n$$\n众所周知，如果 $|\\mathrm{Pe}_{\\Delta x}| > 2$，该格式会产生非物理振荡，因为 $T_{j+1}$ 的系数会变为负数，这违反了离散极值原理的条件。\n\n对于这两种格式，我们为 $N-1$ 个未知的内部温度构建一个包含 $N-1$ 个线性方程的方程组。该系统是三对角的，可以写成 $A \\mathbf{T} = \\mathbf{b}$ 的形式，其中 $\\mathbf{T} = [T_1, T_2, \\dots, T_{N-1}]^T$。\n\n对于 FOU 格式，节点 $j$ 处方程的系数为：\n- 下对角线 ($T_{j-1}$): $l = 1 + \\mathrm{Pe}_{\\Delta x}$\n- 主对角线 ($T_j$): $d = -(2 + \\mathrm{Pe}_{\\Delta x})$\n- 上对角线 ($T_{j+1}$): $u = 1$\n\n对于 CD 格式，系数为：\n- 下对角线 ($T_{j-1}$): $l = 1 + \\frac{\\mathrm{Pe}_{\\Delta x}}{2}$\n- 主对角线 ($T_j$): $d = -2$\n- 上对角线 ($T_{j+1}$): $u = 1 - \\frac{\\mathrm{Pe}_{\\Delta x}}{2}$\n\n右侧向量 $\\mathbf{b}$ 是通过将已知的边界项 $T_0=T_L$ 和 $T_N=T_R$ 移到节点 $j=1$ 和 $j=N-1$ 方程的右侧而形成的。\n对于 $j=1$：$d T_1 + u T_2 = -l T_0 = -l T_L$\n对于 $j=N-1$：$l T_{N-2} + d T_{N-1} = -u T_N = -u T_R$\n\n程序将实现这一逻辑，为两种格式构建并求解三对角系统，在网格节点上评估精确解，并为每个测试用例计算所需的误差范数和有界性。\n最大范数误差定义为 $e_{\\infty} = \\max_{j=0, \\dots, N} |T_j^{\\text{numerical}} - T_j^{\\text{exact}}|$。\n对中心差分格式的有界性检查将验证对于所有的 $j$，$T_j$ 是否保持在边界值范围 $[\\min(T_L, T_R), \\max(T_L, T_R)]$ 内。\n\n实现将利用 `scipy.linalg.solve_banded` 来高效地求解三对角系统。", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Solves the 1D steady convection-diffusion problem for the specified test cases.\n    \"\"\"\n    test_cases = [\n        # Case A: L=1, T_L=0, T_R=1, rho=1, u=0.2, Gamma=1, N=50\n        (1.0, 0.0, 1.0, 1.0, 0.2, 1.0, 50),\n        # Case B: L=1, T_L=0, T_R=1, rho=1, u=4, Gamma=0.2, N=10\n        (1.0, 0.0, 1.0, 1.0, 4.0, 0.2, 10),\n        # Case C: L=1, T_L=0, T_R=1, rho=1, u=10, Gamma=0.1, N=10\n        (1.0, 0.0, 1.0, 1.0, 10.0, 0.1, 10),\n        # Case D: L=1, T_L=0, T_R=1, rho=1, u=0, Gamma=1, N=20\n        (1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 20),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, T_L, T_R, rho, u, Gamma, N = case\n        results.append(solve_case(L, T_L, T_R, rho, u, Gamma, N))\n\n    # Format output as a single line string representation of a list of lists\n    # e.g., [[val1, val2, ...], [val1, val2, ...]]\n    # Using str() on each sublist handles bools and floats correctly\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef solve_case(L, T_L, T_R, rho, u, Gamma, N):\n    \"\"\"\n    Solves a single case of the convection-diffusion problem.\n\n    Returns:\n        A list containing [Pe_dx, e_inf_central, e_inf_upwind, bounded_central].\n    \"\"\"\n    delta_x = L / N\n    x_nodes = np.linspace(0, L, N + 1)\n    \n    # Handle the Gamma > 0 constraint from the problem setup\n    if Gamma = 0:\n        raise ValueError(\"Diffusion coefficient Gamma must be positive.\")\n    \n    pe_dx = (rho * u * delta_x) / Gamma\n\n    # 1. Analytical Solution\n    T_exact = np.zeros(N + 1)\n    if rho * u == 0:\n        # Pure diffusion case\n        T_exact = T_L + (T_R - T_L) * (x_nodes / L)\n    else:\n        # Convection-diffusion case\n        exp_term_x = np.exp((rho * u * x_nodes) / Gamma)\n        exp_term_L = np.exp((rho * u * L) / Gamma)\n        # Avoid division by zero if exp_term_L is close to 1\n        if np.isclose(exp_term_L, 1.0):\n            T_exact = T_L + (T_R - T_L) * (x_nodes / L) # Linear profile approx\n        else:\n            T_exact = T_L + (T_R - T_L) * (exp_term_x - 1) / (exp_term_L - 1)\n\n    # Number of interior unknowns\n    num_unknowns = N - 1\n\n    # 2. Central Differencing Scheme\n    # Matrix A is tridiagonal: [l, d, u]\n    # (1 + Pe/2)T_{j-1} - 2T_j + (1 - Pe/2)T_{j+1} = 0\n    l_cd = 1.0 + pe_dx / 2.0\n    d_cd = -2.0\n    u_cd = 1.0 - pe_dx / 2.0\n    \n    # Banded matrix for scipy.linalg.solve_banded of shape (3, num_unknowns)\n    # Row 0: super-diagonal (u_cd)\n    # Row 1: main-diagonal (d_cd)\n    # Row 2: sub-diagonal (l_cd)\n    A_cd_banded = np.zeros((3, num_unknowns))\n    A_cd_banded[0, 1:] = u_cd\n    A_cd_banded[1, :] = d_cd\n    A_cd_banded[2, :-1] = l_cd\n    \n    # RHS vector b\n    b_cd = np.zeros(num_unknowns)\n    b_cd[0] = -l_cd * T_L\n    b_cd[-1] = -u_cd * T_R\n    \n    T_interior_cd = solve_banded((1, 1), A_cd_banded, b_cd)\n    T_sol_cd = np.concatenate(([T_L], T_interior_cd, [T_R]))\n\n    # 3. First-Order Upwind Scheme\n    # (1 + Pe)T_{j-1} - (2 + Pe)T_j + T_{j+1} = 0\n    l_up = 1.0 + pe_dx\n    d_up = -(2.0 + pe_dx)\n    u_up = 1.0\n    \n    A_up_banded = np.zeros((3, num_unknowns))\n    A_up_banded[0, 1:] = u_up\n    A_up_banded[1, :] = d_up\n    A_up_banded[2, :-1] = l_up\n    \n    b_up = np.zeros(num_unknowns)\n    b_up[0] = -l_up * T_L\n    b_up[-1] = -u_up * T_R\n    \n    T_interior_up = solve_banded((1, 1), A_up_banded, b_up)\n    T_sol_up = np.concatenate(([T_L], T_interior_up, [T_R]))\n\n    # 4. Compute required quantities\n    e_inf_central = np.max(np.abs(T_sol_cd - T_exact))\n    e_inf_upwind = np.max(np.abs(T_sol_up - T_exact))\n\n    T_min, T_max = min(T_L, T_R), max(T_L, T_R)\n    # Check if all elements are within [T_min, T_max] with a small tolerance for floating point issues\n    bounded_central = bool(np.all((T_sol_cd = T_min - 1e-9)  (T_sol_cd = T_max + 1e-9)))\n\n    # Format the results for this case. Using repr() for boolean to get True/False.\n    return [round(pe_dx, 6), round(e_inf_central, 6), round(e_inf_upwind, 6), str(bounded_central)]\n\nif __name__ == \"__main__\":\n    # The actual output will be generated by calling a function that is not part of this snippet.\n    # The `solve` function is structured to fulfill the problem's output format requirement.\n    # To run this standalone for testing:\n    # try:\n    #     solve()\n    # except Exception as e:\n    #     print(e)\n    pass\n```", "id": "2497371"}, {"introduction": "当一个CFD程序编写完成后，我们必须回答一个根本性问题：“我的代码正确吗？”人造解方法（Method of Manufactured Solutions, MMS）是一种严谨的数学程序，用于验证代码是否正确地求解了其所对应的控制方程。本练习将指导您完成MMS的推导过程：首先选择一个解析函数作为“人造解”，然后将其代入能量方程，反向推导出必需的源项，从而构造出一个具有已知精确解的验证算例 [@problem_id:2497372]。", "problem": "一个二维、稳态、不可压缩的牛顿流体在边长为 $L$ 的方形区域内流动，其性质恒定。笛卡尔坐标系为 $(x,y)\\in[0,L]\\times[0,L]$。密度为 $\\rho$，定压比热为 $c_p$，导热系数为 $k$。粘性耗散和压力功可忽略不计。速度场是给定的且无散。在计算流体力学（CFD）入门的背景下，要求您对能量方程使用人造解方法（Method of Manufactured Solutions）。\n\n首先，从能量守恒原理出发，简要阐述应用于此场景下能量方程的人造解方法（MMS）的逻辑步骤。\n\n然后，考虑以下人造温度场和无散速度场：\n- 人造温度：$T(x,y)=T_0+\\Theta \\sin\\!\\big(\\tfrac{\\pi x}{L}\\big)\\cos\\!\\big(\\tfrac{\\pi y}{L}\\big)$，其中 $T_0$ 和 $\\Theta$ 是常数。\n- 速度场：$u(x,y)=U_0 \\cos\\!\\big(\\tfrac{\\pi y}{L}\\big)$ 和 $v(x,y)=U_0 \\sin\\!\\big(\\tfrac{\\pi x}{L}\\big)$，其中 $U_0$ 是一个常数。\n\n从稳态、不可压缩、物性恒定的流动（在所述建模假设下）的能量守恒出发，推导温度方程的强形式，并构建人造体积热源项 $S(x,y)$，使得给定的 $T(x,y)$ 是该方程在整个区域内的精确解。将您最终的人造源项 $S(x,y)$ 表示为包含 $x$、$y$、$L$、$\\rho$、$c_p$、$k$、$U_0$、$T_0$ 和 $\\Theta$ 的单个闭式解析表达式。不要近似或四舍五入；以精确形式给出答案。三角函数的参数必须以弧度解释。将最终的 $S(x,y)$ 以国际单位制（SI）表示为 $\\text{W}\\,\\text{m}^{-3}$。", "solution": "对问题陈述进行验证。\n\n**第 1 步：提取已知条件**\n- **区域**：二维方形区域，$(x,y) \\in [0,L] \\times [0,L]$。\n- **流体**：牛顿流体，稳态、不可压缩流动，物性恒定。\n- **物性**：密度 $\\rho$，定压比热 $c_p$，导热系数 $k$。\n- **假设**：粘性耗散和压力功可忽略不计。\n- **速度场**：给定的无散速度场，分量为 $u(x,y)=U_0 \\cos(\\frac{\\pi y}{L})$ 和 $v(x,y)=U_0 \\sin(\\frac{\\pi x}{L})$。$U_0$ 是一个常数。\n- **人造温度场**：$T(x,y)=T_0+\\Theta \\sin(\\frac{\\pi x}{L})\\cos(\\frac{\\pi y}{L})$，其中 $T_0$ 和 $\\Theta$ 是常数。\n- **任务**：阐述人造解方法（MMS），推导温度方程的强形式，并构建人造体积热源项 $S(x,y)$，使给定的 $T(x,y)$ 成为精确解。\n\n**第 2 步：使用提取的已知条件进行验证**\n该问题具有科学依据，基于能量守恒基本原理和一种标准的代码验证技术（MMS）。语言客观而精确。问题是自洽的。保持一致性的一个必要条件是，所提供的速度场必须如陈述中所述是无散的。我们对此进行验证：\n$$\n\\nabla \\cdot \\mathbf{v} = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\n$$\n$$\n\\frac{\\partial u}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ U_0 \\cos\\left(\\frac{\\pi y}{L}\\right) \\right] = 0\n$$\n$$\n\\frac{\\partial v}{\\partial y} = \\frac{\\partial}{\\partial y} \\left[ U_0 \\sin\\left(\\frac{\\pi x}{L}\\right) \\right] = 0\n$$\n因此，$\\nabla \\cdot \\mathbf{v} = 0 + 0 = 0$。速度场确实是无散的，这证实了问题陈述的内部一致性。该问题要求为给定解构建一个源项，这是一个适定的过程。未检测到科学、逻辑或结构上的缺陷。\n\n**第 3 步：结论与行动**\n问题有效。将提供解答。\n\n首先，应用于能量方程的人造解方法（MMS）的逻辑步骤如下：\n$1$. 选择控制性偏微分方程（PDE），对于本问题即能量守恒方程。\n$2$. 假定或“制造”一个光滑的解析函数作为解变量，本例中即温度场 $T(x,y)$。\n$3$. 将此人造解及其导数代入控制性偏微分方程。由于该函数不是原始齐次方程的精确解，代入后会产生一个非零的残差。\n$4$. 定义一个源项 $S(x,y)$，使其等于此残差。这将原始的偏微分方程重新定义为一个新的非齐次方程。\n$5$. 通过构造，人造函数 $T(x,y)$ 现在是这个新的非齐次偏微分方程的精确解析解。这个具有已知解析解的新问题，可用于严格验证数值代码的准确性和实现。\n\n接下来，我们推导温度方程的强形式。对于物性恒定的不可压缩流体，能量守恒方程的一般形式为：\n$$\n\\rho c_p \\left( \\frac{\\partial T}{\\partial t} + \\mathbf{v} \\cdot \\nabla T \\right) = \\nabla \\cdot (k \\nabla T) + S_{visc} + \\beta T \\frac{Dp}{Dt} + \\dot{q}\n$$\n应用问题中给出的假设：\n- 稳态：$\\frac{\\partial T}{\\partial t} = 0$。\n- 物性恒定：$\\rho$、$c_p$ 和 $k$ 是常数。扩散项变为 $k \\nabla^2 T$。\n- 可忽略的粘性耗散（$S_{visc}$）和压力功（$\\beta T \\frac{Dp}{Dt}$）：这些项为零。\n- 项 $\\dot{q}$ 是体积热源，我们将其表示为 $S(x,y)$。\n\n得到的温度方程强形式为：\n$$\n\\rho c_p (\\mathbf{v} \\cdot \\nabla T) = k \\nabla^2 T + S(x,y)\n$$\n在二维笛卡尔坐标系中，这展开为：\n$$\n\\rho c_p \\left( u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y} \\right) = k \\left( \\frac{\\partial^2 T}{\\partial x^2} + \\frac{\\partial^2 T}{\\partial y^2} \\right) + S(x,y)\n$$\n为构建人造源项，我们重排此方程以求解 $S(x,y)$：\n$$\nS(x,y) = \\rho c_p \\left( u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y} \\right) - k \\left( \\frac{\\partial^2 T}{\\partial x^2} + \\frac{\\partial^2 T}{\\partial y^2} \\right)\n$$\n现在，我们计算人造温度场 $T(x,y)=T_0+\\Theta \\sin(\\frac{\\pi x}{L})\\cos(\\frac{\\pi y}{L})$ 的必要导数。\n一阶偏导数为：\n$$\n\\frac{\\partial T}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ T_0+\\Theta \\sin\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right) \\right] = \\Theta \\left(\\frac{\\pi}{L}\\right) \\cos\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right)\n$$\n$$\n\\frac{\\partial T}{\\partial y} = \\frac{\\partial}{\\partial y} \\left[ T_0+\\Theta \\sin\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right) \\right] = -\\Theta \\left(\\frac{\\pi}{L}\\right) \\sin\\left(\\frac{\\pi x}{L}\\right)\\sin\\left(\\frac{\\pi y}{L}\\right)\n$$\n二阶偏导数为：\n$$\n\\frac{\\partial^2 T}{\\partial x^2} = \\frac{\\partial}{\\partial x} \\left[ \\Theta \\left(\\frac{\\pi}{L}\\right) \\cos\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right) \\right] = -\\Theta \\left(\\frac{\\pi}{L}\\right)^2 \\sin\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right)\n$$\n$$\n\\frac{\\partial^2 T}{\\partial y^2} = \\frac{\\partial}{\\partial y} \\left[ -\\Theta \\left(\\frac{\\pi}{L}\\right) \\sin\\left(\\frac{\\pi x}{L}\\right)\\sin\\left(\\frac{\\pi y}{L}\\right) \\right] = -\\Theta \\left(\\frac{\\pi}{L}\\right)^2 \\sin\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right)\n$$\n我们现在使用速度分量 $u(x,y)=U_0 \\cos(\\frac{\\pi y}{L})$ 和 $v(x,y)=U_0 \\sin(\\frac{\\pi x}{L})$ 来组合对流项 $\\rho c_p (u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y})$。\n$$\nu \\frac{\\partial T}{\\partial x} = \\left( U_0 \\cos\\left(\\frac{\\pi y}{L}\\right) \\right) \\left( \\Theta \\frac{\\pi}{L} \\cos\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right) \\right) = \\frac{\\pi U_0 \\Theta}{L} \\cos\\left(\\frac{\\pi x}{L}\\right)\\cos^2\\left(\\frac{\\pi y}{L}\\right)\n$$\n$$\nv \\frac{\\partial T}{\\partial y} = \\left( U_0 \\sin\\left(\\frac{\\pi x}{L}\\right) \\right) \\left( -\\Theta \\frac{\\pi}{L} \\sin\\left(\\frac{\\pi x}{L}\\right)\\sin\\left(\\frac{\\pi y}{L}\\right) \\right) = -\\frac{\\pi U_0 \\Theta}{L} \\sin^2\\left(\\frac{\\pi x}{L}\\right)\\sin\\left(\\frac{\\pi y}{L}\\right)\n$$\n完整的对流项为：\n$$\n\\rho c_p \\left( u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y} \\right) = \\frac{\\pi \\rho c_p U_0 \\Theta}{L} \\left[ \\cos\\left(\\frac{\\pi x}{L}\\right)\\cos^2\\left(\\frac{\\pi y}{L}\\right) - \\sin^2\\left(\\frac{\\pi x}{L}\\right)\\sin\\left(\\frac{\\pi y}{L}\\right) \\right]\n$$\n接下来，我们组合扩散项 $-k (\\frac{\\partial^2 T}{\\partial x^2} + \\frac{\\partial^2 T}{\\partial y^2})$。\n$$\n\\frac{\\partial^2 T}{\\partial x^2} + \\frac{\\partial^2 T}{\\partial y^2} = -\\Theta \\left(\\frac{\\pi}{L}\\right)^2 \\sin\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right) - \\Theta \\left(\\frac{\\pi}{L}\\right)^2 \\sin\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right) = -2 \\Theta \\left(\\frac{\\pi}{L}\\right)^2 \\sin\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right)\n$$\n需要减去的扩散贡献为：\n$$\n-k \\left( \\frac{\\partial^2 T}{\\partial x^2} + \\frac{\\partial^2 T}{\\partial y^2} \\right) = -k \\left[ -2 \\Theta \\left(\\frac{\\pi}{L}\\right)^2 \\sin\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right) \\right] = \\frac{2 \\pi^2 k \\Theta}{L^2} \\sin\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right)\n$$\n最后，我们将对流项和扩散项结合起来，得到人造源项 $S(x,y)$：\n$$\nS(x,y) = \\frac{\\pi \\rho c_p U_0 \\Theta}{L} \\left[ \\cos\\left(\\frac{\\pi x}{L}\\right)\\cos^2\\left(\\frac{\\pi y}{L}\\right) - \\sin^2\\left(\\frac{\\pi x}{L}\\right)\\sin\\left(\\frac{\\pi y}{L}\\right) \\right] + \\frac{2 \\pi^2 k \\Theta}{L^2} \\sin\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right)\n$$\n此表达式即为所要求的人造源项 $S(x,y)$ 的闭式解析函数。", "answer": "$$\n\\boxed{\\frac{\\pi \\rho c_p U_0 \\Theta}{L} \\left[ \\cos\\left(\\frac{\\pi x}{L}\\right)\\cos^{2}\\left(\\frac{\\pi y}{L}\\right) - \\sin^{2}\\left(\\frac{\\pi x}{L}\\right)\\sin\\left(\\frac{\\pi y}{L}\\right) \\right] + \\frac{2 \\pi^2 k \\Theta}{L^2} \\sin\\left(\\frac{\\pi x}{L}\\right)\\cos\\left(\\frac{\\pi y}{L}\\right)}\n$$", "id": "2497372"}]}