{"hands_on_practices": [{"introduction": "对辐射传热的理解始于对其几何基础的掌握。第一个练习旨在加强您的基本功，要求您从一个简单、对称的配置——从轴上点观察圆形盘——推导其立体角。通过从基本定义 $d\\omega = dA_{n}/r^{2}$ 出发并执行直接积分 [@problem_id:2517646]，您不仅将得到一个精确的解析解，还将看到常见的远场近似是如何作为一种极限情况出现的。", "problem": "一个半径为 $a$ 的圆盘位于 $z=0$ 平面，其中心在原点。一个点探测器位于对称轴上的 $(0,0,z)$ 处，其中 $z>0$。仅使用立体角的基本定义，即单位球面上的投影面积，也就是说，元立体角为 $d\\omega = dA_{n}/r^{2}$，其中 $dA_{n}$ 是元面积 $dA$ 在垂直于视线方向上的投影，$r$ 是探测器到元面积的距离，通过对圆盘进行直接积分，推导出圆盘在探测器处所张的精确总立体角 $\\Omega_{\\text{exact}}(a,z)$。然后，假设从探测器看，圆盘光学尺寸很小（即 $z$ 相对于 $a$ 很大），并在此近似下一致地应用相同的基本定义，求出远场近似 $\\Omega_{\\text{ff}}(a,z)$。最后，将相对误差定义为 $\\varepsilon(a/z) = \\left(\\Omega_{\\text{ff}} - \\Omega_{\\text{exact}}\\right)/\\Omega_{\\text{exact}}$，并以小参数 $a/z$ 的幂次形式，确定其首个非零项的显式渐近表达式。\n\n所有立体角均以球面度（角度以弧度）为单位表示。将最终答案表示为一个行矩阵，其中依次包含 $\\Omega_{\\text{exact}}(a,z)$、$\\Omega_{\\text{ff}}(a,z)$ 以及当 $a/z \\to 0$ 时 $\\varepsilon(a/z)$ 的主阶渐近表达式。", "solution": "所述问题定义明确，有科学依据，并存在唯一的稳定解。我们将按照说明，通过直接积分进行推导。\n\n问题要求计算半径为 $a$ 的圆盘在距离为 $z$ 的轴上点探测器处所张的立体角 $\\Omega$。圆盘位于 $z=0$ 平面，中心在原点 $(0,0,0)$。探测器位于 $(0,0,z)$ 处，其中 $z>0$。推导必须从元立体角 $d\\omega$ 的基本定义开始：\n$$d\\omega = \\frac{dA_n}{r^2}$$\n其中 $dA_n$ 是表面元面积 $dA$ 在垂直于视线方向上的投影，$r$ 是从探测器到 $dA$ 的距离。\n\n我们建立一个柱坐标系 $(\\rho, \\phi, z)$。圆盘上的一个点由坐标 $(\\rho \\cos\\phi, \\rho \\sin\\phi, 0)$ 描述，其中 $0 \\le \\rho \\le a$ 且 $0 \\le \\phi  2\\pi$。圆盘上的元面积为 $dA = \\rho \\, d\\rho \\, d\\phi$。\n\n从位于 $(0,0,z)$ 的探测器到位于 $(\\rho \\cos\\phi, \\rho \\sin\\phi, 0)$ 的元面积 $dA$ 的矢量为：\n$$\\vec{s} = (\\rho \\cos\\phi, \\rho \\sin\\phi, -z)$$\n距离 $r$ 是该矢量的模：\n$$r = |\\vec{s}| = \\sqrt{(\\rho \\cos\\phi)^2 + (\\rho \\sin\\phi)^2 + (-z)^2} = \\sqrt{\\rho^2 + z^2}$$\n投影面积 $dA_n$ 由 $dA_n = dA \\cos\\psi$ 给出，其中 $\\psi$ 是表面元 $dA$ 的法向量与视线矢量 $\\vec{s}$ 之间的夹角。位于 $z=0$ 平面的圆盘的法向量为 $\\vec{n} = \\hat{k} = (0,0,1)$。夹角 $\\psi$ 可通过点积求得：\n$$\\cos\\psi = \\frac{|\\vec{s} \\cdot \\vec{n}|}{|\\vec{s}| |\\vec{n}|} = \\frac{|(\\rho \\cos\\phi, \\rho \\sin\\phi, -z) \\cdot (0,0,1)|}{\\sqrt{\\rho^2 + z^2} \\cdot 1} = \\frac{|-z|}{\\sqrt{\\rho^2 + z^2}} = \\frac{z}{\\sqrt{\\rho^2 + z^2}}$$\n因为 $z0$。\n\n因此，元立体角为：\n$$d\\omega = \\frac{dA_n}{r^2} = \\frac{(dA) \\cos\\psi}{r^2} = \\frac{(\\rho \\, d\\rho \\, d\\phi) \\left(\\frac{z}{\\sqrt{\\rho^2+z^2}}\\right)}{(\\sqrt{\\rho^2+z^2})^2} = \\frac{z \\rho}{(\\rho^2+z^2)^{3/2}} \\, d\\rho \\, d\\phi$$\n\n**1. 精确立体角 $\\Omega_{\\text{exact}}(a,z)$**\n\n为了求得总立体角 $\\Omega_{\\text{exact}}$，我们将 $d\\omega$ 在整个圆盘面积上积分。积分范围是 $\\rho$ 从 $0$ 到 $a$，$\\phi$ 从 $0$ 到 $2\\pi$。\n$$\\Omega_{\\text{exact}} = \\int_{0}^{2\\pi} \\int_{0}^{a} \\frac{z \\rho}{(\\rho^2+z^2)^{3/2}} \\, d\\rho \\, d\\phi$$\n由于被积函数与 $\\phi$ 无关，对 $\\phi$ 的积分得到一个因子 $2\\pi$：\n$$\\Omega_{\\text{exact}} = 2\\pi z \\int_{0}^{a} \\frac{\\rho}{(\\rho^2+z^2)^{3/2}} \\, d\\rho$$\n为了计算剩余的积分，我们使用换元法，令 $u = \\rho^2+z^2$，则 $du = 2\\rho \\, d\\rho$。积分变为：\n$$\\int \\frac{\\rho}{(\\rho^2+z^2)^{3/2}} \\, d\\rho = \\frac{1}{2} \\int u^{-3/2} \\, du = \\frac{1}{2} \\frac{u^{-1/2}}{-1/2} = -u^{-1/2} = -\\frac{1}{\\sqrt{\\rho^2+z^2}}$$\n计算从 $\\rho=0$ 到 $\\rho=a$ 的定积分：\n$$\\int_{0}^{a} \\frac{\\rho}{(\\rho^2+z^2)^{3/2}} \\, d\\rho = \\left[ -\\frac{1}{\\sqrt{\\rho^2+z^2}} \\right]_{0}^{a} = \\left(-\\frac{1}{\\sqrt{a^2+z^2}}\\right) - \\left(-\\frac{1}{\\sqrt{0^2+z^2}}\\right) = \\frac{1}{z} - \\frac{1}{\\sqrt{a^2+z^2}}$$\n将此结果代回到 $\\Omega_{\\text{exact}}$ 的表达式中：\n$$\\Omega_{\\text{exact}}(a,z) = 2\\pi z \\left(\\frac{1}{z} - \\frac{1}{\\sqrt{a^2+z^2}}\\right) = 2\\pi \\left(1 - \\frac{z}{\\sqrt{a^2+z^2}}\\right)$$\n\n**2. 远场近似 $\\Omega_{\\text{ff}}(a,z)$**\n\n在远场极限下，探测器远离圆盘，因此 $z \\gg a$。这意味着对于圆盘上的任何一点，都有 $\\rho \\le a \\ll z$。在此近似下：\n\\begin{itemize}\n    \\item 距离 $r = \\sqrt{\\rho^2+z^2}$ 近似为常数 $z$。\n    \\item 投影因子 $\\cos\\psi = \\frac{z}{\\sqrt{\\rho^2+z^2}}$ 近似为 $\\frac{z}{\\sqrt{0+z^2}} = 1$。\n\\end{itemize}\n将这些近似应用于基本定义 $\\Omega = \\int \\frac{dA \\cos\\psi}{r^2}$：\n$$\\Omega_{\\text{ff}} \\approx \\int_{\\text{disk}} \\frac{dA \\cdot 1}{z^2} = \\frac{1}{z^2} \\int_{\\text{disk}} dA$$\n在圆盘上对 $dA$ 的积分是其总面积 $A = \\pi a^2$。因此，远场近似为：\n$$\\Omega_{\\text{ff}}(a,z) = \\frac{\\pi a^2}{z^2}$$\n\n**3. 相对误差 $\\varepsilon(a/z)$**\n\n相对误差定义为 $\\varepsilon(a/z) = \\frac{\\Omega_{\\text{ff}} - \\Omega_{\\text{exact}}}{\\Omega_{\\text{exact}}}$。我们寻求此表达式对于小参数 $x = a/z \\to 0$ 的首个非零项。\n\n首先，我们将 $\\Omega_{\\text{exact}}$ 用 $x$ 表示：\n$$\\Omega_{\\text{exact}} = 2\\pi \\left(1 - \\frac{z}{\\sqrt{a^2+z^2}}\\right) = 2\\pi \\left(1 - \\frac{1}{\\sqrt{(a/z)^2+1}}\\right) = 2\\pi \\left(1 - (1+x^2)^{-1/2}\\right)$$\n我们使用 $(1+u)^{\\alpha}$ 的二项式级数展开，其中 $u=x^2$ 且 $\\alpha=-1/2$：\n$$(1+x^2)^{-1/2} = 1 - \\frac{1}{2}x^2 + \\frac{(-1/2)(-3/2)}{2!}(x^2)^2 + O((x^2)^3) = 1 - \\frac{1}{2}x^2 + \\frac{3}{8}x^4 + O(x^6)$$\n将此代入 $\\Omega_{\\text{exact}}$ 的表达式中：\n$$\\Omega_{\\text{exact}} = 2\\pi \\left(1 - \\left[1 - \\frac{1}{2}x^2 + \\frac{3}{8}x^4 - \\dots\\right]\\right) = 2\\pi \\left(\\frac{1}{2}x^2 - \\frac{3}{8}x^4 + \\dots\\right) = \\pi x^2 - \\frac{3\\pi}{4}x^4 + O(x^6)$$\n远场表达式为 $\\Omega_{\\text{ff}} = \\pi (a/z)^2 = \\pi x^2$。\n\n现在，我们计算相对误差：\n$$\\varepsilon(x) = \\frac{\\Omega_{\\text{ff}}}{\\Omega_{\\text{exact}}} - 1 = \\frac{\\pi x^2}{\\pi x^2 - \\frac{3\\pi}{4}x^4 + \\dots} - 1 = \\frac{1}{1 - \\frac{3}{4}x^2 + \\dots} - 1$$\n使用几何级数展开 $(1-v)^{-1} = 1 + v + v^2 + \\dots$，其中 $v = \\frac{3}{4}x^2$：\n$$\\varepsilon(x) = \\left(1 + \\frac{3}{4}x^2 + O(x^4)\\right) - 1 = \\frac{3}{4}x^2 + O(x^4)$$\n相对误差的首个非零项是 $\\frac{3}{4}x^2$。将 $x$ 替换为 $a/z$，我们得到渐近表达式：\n$$\\varepsilon(a/z) \\sim \\frac{3}{4}\\left(\\frac{a}{z}\\right)^2 \\quad \\text{as } a/z \\to 0$$\n\n由此，三个所求量均已确定。", "answer": "$$ \\boxed{ \\begin{pmatrix} 2\\pi \\left( 1 - \\frac{z}{\\sqrt{a^2+z^2}} \\right)  \\frac{\\pi a^2}{z^2}  \\frac{3}{4} \\left(\\frac{a}{z}\\right)^2 \\end{pmatrix} } $$", "id": "2517646"}, {"introduction": "尽管理想的几何模型是一个很好的起点，但现实世界中的辐射传输涉及复杂的材料特性。本练习将超越纯粹的几何学，探讨非理想表面发射的后果。您将分析一个方向发射率偏离完美朗伯体模型的表面 [@problem_id:2517648]，计算其总的半球发射功率和其在远处探测器上产生的特定辐照度，从而揭示角度平均的辐射量与特定方向的辐射量之间的关键差异。", "problem": "一个面积为 $A_{s}$ 的不透明、等温、灰体表面片元向真空中发射热辐射。其微观结构导致了与理想朗伯行为相比存在一个微小的、轴对称的、类似镜面反射的角度偏差，这可以通过双向反射分布函数（BRDF）的扰动来建模。根据基尔霍夫热辐射定律 (Kirchhoff’s law of thermal radiation)，对于这个处于平衡状态的等温表面，其双向发射率等于双向吸收率，因此角度发射率可以写为\n$$\\varepsilon(\\theta)=\\varepsilon_{L}\\left[1+\\eta \\cos^{2}\\theta\\right],$$\n其中 $\\varepsilon_{L}\\in(0,1)$ 是朗伯基准发射率，$\\eta$ 是一个无量纲的扰动振幅，满足 $|\\eta|  1$，描述了朝向表面法线方向的适度镜面增强效应，而 $\\theta\\in[0,\\pi/2]$ 是从表面法线测量的发射天顶角（单位为弧度）。\n\n设 $L_{b}(T)$ 表示表面在温度 $T$ 时在所有波长上积分的黑体辐射亮度（一个与方向无关的常数），因此表面的方向发射辐射亮度为 $L_{o}(\\theta)=\\varepsilon(\\theta)\\,L_{b}(T)$。一个常见的工程近似是用朗伯常数 $\\varepsilon_{L}$ 来代替实际的 $\\varepsilon(\\theta)$。\n\n定义该表面片元的半球发射功率，\n$$E=\\int_{\\Omega^{+}} L_{o}(\\theta)\\,\\cos\\theta\\,\\mathrm{d}\\omega,$$\n其中 $\\Omega^{+}$ 是外向半球，$\\mathrm{d}\\omega$ 是立体角元。设 $E_{L}$ 表示在朗伯近似 $\\varepsilon(\\theta)\\equiv\\varepsilon_{L}$ 下得到的值，并设 $\\Delta_{E}=\\left(E-E_{L}\\right)/E_{L}$ 为由非朗伯扰动引起的 $E$ 的相对偏差。\n\n现在，在距离该片元 $R=10.0\\,\\mathrm{m}$ 的表面法线轴上放置一个小型平面探测器，其孔径与源的表观尺寸相比可忽略不计，且其法线对准以直接指向该片元。假设片元面积为 $A_{s}=1.00\\times 10^{-4}\\,\\mathrm{m}^{2}$，且远场、小角度条件适用，因此该片元在探测器处张成的立体角为 $\\Omega_{s}\\approx A_{s}/R^{2}$，且入射光线实际上垂直于探测器。探测器处的辐照度为\n$$G=\\int_{\\Omega_{s}} L_{o}(\\theta)\\,\\cos\\theta_{d}\\,\\mathrm{d}\\omega,$$\n其中 $\\theta_{d}$ 是相对于探测器法线的入射角（单位为弧度）。在相同的远场、轴上条件下，使用辐射亮度不变性和适当的小角度近似，用轴上发射辐射亮度来表示 $G$。设 $G_{L}$ 为在朗伯近似下计算的值，并定义相对偏差 $\\Delta_{G}=\\left(G-G_{L}\\right)/G_{L}$。\n\n对于数值参数 $\\varepsilon_{L}=0.85$，$\\eta=0.20$，$A_{s}=1.00\\times 10^{-4}\\,\\mathrm{m}^{2}$ 和 $R=10.0\\,\\mathrm{m}$，计算单一的无量纲量\n$$\\kappa=\\frac{\\Delta_{G}}{\\Delta_{E}}.$$\n你必须从辐射亮度、立体角和半球积分的基本定义出发。不要假设任何以朗伯行为为前提的结果。将你计算的 $\\kappa$ 的最终答案四舍五入到四位有效数字。将答案表示为一个没有单位的纯数，并取所有角度的单位为弧度。", "solution": "该问题要求计算无量纲量 $\\kappa$，它被定义为两个相对偏差 $\\Delta_{G}$ 和 $\\Delta_{E}$ 的比值。我们将首先计算半球发射功率的相对偏差 $\\Delta_{E}$，然后计算探测器辐照度的相对偏差 $\\Delta_{G}$。\n\n首先，我们确定半球发射功率 $E$。根据定义，它是方向发射辐射亮度 $L_{o}(\\theta)$ 乘以发射角 $\\theta$ 的余弦，并在外向半球 $\\Omega^{+}$ 上积分：\n$$E = \\int_{\\Omega^{+}} L_{o}(\\theta)\\,\\cos\\theta\\,\\mathrm{d}\\omega$$\n方向发射辐射亮度由 $L_{o}(\\theta) = \\varepsilon(\\theta)L_{b}(T)$ 给出，其中方向发射率 $\\varepsilon(\\theta) = \\varepsilon_{L}[1+\\eta \\cos^{2}\\theta]$。项 $L_{b}(T)$ 是黑体辐射亮度，是一个与方向无关的常数。球坐标系中的立体角元为 $\\mathrm{d}\\omega = \\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$，其中 $\\theta$ 是从 $0$ 到 $\\pi/2$ 的天顶角，$\\phi$ 是从 $0$ 到 $2\\pi$ 的方位角。\n\n将这些表达式代入 $E$ 的积分中：\n$$E = \\int_{0}^{2\\pi} \\int_{0}^{\\pi/2} \\left( \\varepsilon_{L}[1+\\eta \\cos^{2}\\theta] L_{b}(T) \\right) \\cos\\theta \\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$$\n被积函数与 $\\phi$ 无关，因此对 $\\phi$ 的积分产生一个因子 $2\\pi$。常数 $\\varepsilon_{L}$ 和 $L_{b}(T)$ 可以被提出来：\n$$E = 2\\pi \\varepsilon_{L} L_{b}(T) \\int_{0}^{\\pi/2} (1+\\eta \\cos^{2}\\theta) \\cos\\theta \\sin\\theta\\,\\mathrm{d}\\theta$$\n为了计算关于 $\\theta$ 的积分，我们进行变量替换。令 $u = \\cos\\theta$，这意味着 $\\mathrm{d}u = -\\sin\\theta\\,\\mathrm{d}\\theta$。积分限从 $\\theta=0$ 变为 $u=1$，从 $\\theta=\\pi/2$ 变为 $u=0$。\n$$E = 2\\pi \\varepsilon_{L} L_{b}(T) \\int_{1}^{0} (1+\\eta u^{2}) u (-\\mathrm{d}u) = 2\\pi \\varepsilon_{L} L_{b}(T) \\int_{0}^{1} (u + \\eta u^{3})\\,\\mathrm{d}u$$\n对 $u$ 进行积分：\n$$E = 2\\pi \\varepsilon_{L} L_{b}(T) \\left[ \\frac{u^{2}}{2} + \\frac{\\eta u^{4}}{4} \\right]_{0}^{1} = 2\\pi \\varepsilon_{L} L_{b}(T) \\left( \\frac{1}{2} + \\frac{\\eta}{4} \\right)$$\n$$E = \\pi \\varepsilon_{L} L_{b}(T) \\left( 1 + \\frac{\\eta}{2} \\right)$$\n在朗伯近似下的半球发射功率 $E_{L}$ 对应于使用 $\\varepsilon(\\theta) \\equiv \\varepsilon_{L}$，这等价于在我们推导出的 $E$ 的表达式中设置扰动振幅 $\\eta=0$。\n$$E_{L} = \\pi \\varepsilon_{L} L_{b}(T) \\left( 1 + \\frac{0}{2} \\right) = \\pi \\varepsilon_{L} L_{b}(T)$$\n现在，我们可以计算相对偏差 $\\Delta_{E}$：\n$$\\Delta_{E} = \\frac{E-E_{L}}{E_{L}} = \\frac{\\pi \\varepsilon_{L} L_{b}(T) (1 + \\eta/2) - \\pi \\varepsilon_{L} L_{b}(T)}{\\pi \\varepsilon_{L} L_{b}(T)} = \\frac{1 + \\eta/2 - 1}{1} = \\frac{\\eta}{2}$$\n\n接下来，我们计算探测器处的辐照度 $G$。探测器位于表面法线轴上，距离源的距离 $R$ 很大，且源面积 $A_{s}$ 很小。这些是远场、小角度条件。辐照度由以下公式给出：\n$$G = \\int_{\\Omega_{s}} L_{o}(\\theta)\\,\\cos\\theta_{d}\\,\\mathrm{d}\\omega$$\n其中 $\\Omega_{s}$ 是源在探测器处张成的小立体角，$\\theta_{d}$ 是在探测器处的入射角。由于是轴上且平行平面的几何结构，一条光线的发射角 $\\theta$ 等于其入射角 $\\theta_{d}$。因此，$\\cos\\theta_d = \\cos\\theta$。\n\n问题指明要使用小角度近似，并用轴上发射辐射亮度来表示 $G$。对于从该小片元到达探测器的所有光线，角度 $\\theta$ 都非常接近于 $0$。这为两个近似提供了理由：\n1. 方向发射辐射亮度 $L_{o}(\\theta)$ 可以在小立体角 $\\Omega_{s}$ 上近似为一个常数，并等于其轴上值 $L_{o}(0)$。\n2. 项 $\\cos\\theta_{d}$ 可以近似为 $\\cos(0) = 1$，正如“入射光线实际上垂直于探测器”这一陈述所暗示的那样。\n\n应用这些近似， $G$ 的积分简化为：\n$$G \\approx \\int_{\\Omega_{s}} L_{o}(0) \\cdot 1 \\cdot \\mathrm{d}\\omega = L_{o}(0) \\int_{\\Omega_{s}} \\mathrm{d}\\omega = L_{o}(0)\\Omega_{s}$$\n轴上辐射亮度 $L_{o}(0)$ 可通过在 $L_{o}(\\theta)$ 的表达式中设置 $\\theta=0$ 来找到：\n$$L_{o}(0) = \\varepsilon(0) L_{b}(T) = \\varepsilon_{L}[1+\\eta \\cos^{2}(0)] L_{b}(T) = \\varepsilon_{L}(1+\\eta) L_{b}(T)$$\n立体角由 $\\Omega_{s} \\approx A_{s}/R^{2}$ 给出。因此，辐照度为：\n$$G \\approx \\varepsilon_{L}(1+\\eta) L_{b}(T) \\frac{A_{s}}{R^{2}}$$\n在朗伯近似下的辐照度 $G_{L}$ 可通过设置 $\\eta=0$ 来找到：\n$$G_{L} \\approx \\varepsilon_{L}(1+0) L_{b}(T) \\frac{A_{s}}{R^{2}} = \\varepsilon_{L} L_{b}(T) \\frac{A_{s}}{R^{2}}$$\n那么，相对偏差 $\\Delta_{G}$ 为：\n$$\\Delta_{G} = \\frac{G-G_{L}}{G_{L}} \\approx \\frac{\\varepsilon_{L}(1+\\eta) L_{b}(T) (A_{s}/R^{2}) - \\varepsilon_{L} L_{b}(T) (A_{s}/R^{2})}{\\varepsilon_{L} L_{b}(T) (A_{s}/R^{2})} = \\frac{1+\\eta-1}{1} = \\eta$$\n结果 $\\Delta_G = \\eta$ 代表了发射率扰动的局部、轴上效应，而 $\\Delta_E = \\eta/2$ 代表其半球平均值。\n\n最后，我们计算所需的量 $\\kappa$，作为 $\\Delta_{G}$ 与 $\\Delta_{E}$ 的比值：\n$$\\kappa = \\frac{\\Delta_{G}}{\\Delta_{E}} = \\frac{\\eta}{\\eta/2} = 2$$\n这个结果是一个常数，与为 $\\varepsilon_{L}$、$\\eta$、$A_{s}$ 和 $R$ 提供的数值无关。问题要求将答案四舍五入到四位有效数字。\n\n$$\\kappa = 2.000$$", "answer": "$$\\boxed{2.000}$$", "id": "2517648"}, {"introduction": "在光学和热传递的许多实际场景中，缺乏能够得到简单解析解的完美对称性。最后一个练习将面对一个更普遍且具挑战性的情况：计算从离轴观察点看圆盘的立体角。这项任务 [@problem_id:2517659] 将引导您从推导控制积分，到分析其计算中出现的数值困难，从而搭建起从理论构建到实用、精确的数值实现之间的桥梁。", "problem": "一个半径为 $R$ 的圆盘位于平面 $z = 0$ 内，其单位法向量指向 $z$ 轴正方向。考虑一个位于柱坐标 $(\\rho, \\varphi_{0}, z)$ 处的观察点，其中 $z  0$，$\\rho$ 是与圆盘轴线的横向偏移量。使用点上一个面元 $dA$ 所张立体角 $d\\Omega$ 的基本定义，即 $d\\Omega = \\dfrac{\\cos \\gamma}{s^{2}} \\, dA$（其中 $s$ 是从面元到观察点的距离，$\\gamma$ 是面元法线与到观察点的视线之间的夹角），执行以下操作：\n\n1) 仅从此定义和装置的几何结构出发，推导圆盘在观察点所张总立体角 $\\Omega(\\rho, z, R)$ 的双重积分表达式。用圆盘上的极坐标 $(r, \\phi)$ 表示你的积分，其中 $r \\in [0, R]$ 且 $\\phi \\in [0, 2\\pi)$，所有角度均明确以弧度为单位。\n\n2) 指出并解释在 $z$ 值很小以及 $\\rho$ 接近 $R$ 时计算该积分所遇到的数值挑战，并提出一种能在广泛参数范围内实现高精度的计算策略。你的讨论应基于对被积函数行为的分析，而不应不加推导地引用最终的闭合形式结果。\n\n3) 将你提出的数值策略实现为一个完整的、可运行的程序，用以计算下面每个测试用例的 $\\Omega(\\rho, z, R)$。你的实现必须是自包含的，并且可以使用数值积分法，如果需要，也可以使用特殊函数，前提是你的分析为其提供了充分的理由。\n\n数值和单位要求：\n- 所有中间角度必须以弧度为单位。\n- 报告每个计算出的立体角，单位为球面度。\n- 将每个报告值四舍五入到 $10$ 位有效数字。\n\n测试套件（$R$、$\\rho$ 和 $z$ 使用米为单位）：\n- 用例 1：$(R, \\rho, z) = (1.0, 0.0, 1.0)$。\n- 用例 2：$(R, \\rho, z) = (1.0, 0.5, 0.75)$。\n- 用例 3：$(R, \\rho, z) = (1.0, 2.0, 0.1)$。\n- 用例 4：$(R, \\rho, z) = (1.0, 0.9, 0.01)$。\n- 用例 5：$(R, \\rho, z) = (0.5, 1.5, 5.0)$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，顺序与测试套件相同（例如 $[result1,result2,result3,result4,result5]$），其中每个 $resultk$ 是一个浮点数，代表四舍五入到 $10$ 位有效数字的立体角（单位为球面度）。", "solution": "该问题要求推导一个圆盘在离轴观察点所张立体角的积分表达式，分析其计算相关的数值挑战，并实现一个稳健的计算策略。\n\n首先，我们建立几何关系。半径为 $R$ 的圆盘位于 $z=0$ 平面，圆心在原点。其法向量为 $\\vec{n} = \\hat{k}$。观察点 $P$ 位于柱坐标 $(\\rho, \\varphi_0, z)$，其中 $z0$。不失一般性，我们对齐坐标系，使观察点位于 $x-z$ 平面内，因此其笛卡尔坐标为 $(\\rho, 0, z)$。\n\n圆盘上的一个微分面元 $dA$ 位于极坐标 $(r, \\phi)$，其中 $r \\in [0, R]$ 且 $\\phi \\in [0, 2\\pi)$。其笛卡尔坐标为 $(r \\cos\\phi, r \\sin\\phi, 0)$。在这些坐标中，面元为 $dA = r \\, dr \\, d\\phi$。\n\n从面元 $dA$ 指向观察点 $P$ 的向量 $\\vec{s}$ 是：\n$$ \\vec{s} = (\\rho - r \\cos\\phi)\\hat{i} + (0 - r \\sin\\phi)\\hat{j} + (z - 0)\\hat{k} = (\\rho - r \\cos\\phi)\\hat{i} - r \\sin\\phi\\hat{j} + z\\hat{k} $$\n距离的平方 $s^2$ 是 $\\vec{s}$ 的模的平方：\n$$ s^2 = |\\vec{s}|^2 = (\\rho - r \\cos\\phi)^2 + (-r \\sin\\phi)^2 + z^2 $$\n$$ s^2 = \\rho^2 - 2\\rho r \\cos\\phi + r^2 \\cos^2\\phi + r^2 \\sin^2\\phi + z^2 = \\rho^2 + r^2 - 2\\rho r \\cos\\phi + z^2 $$\n\n角 $\\gamma$ 是面元法线 $\\vec{n} = \\hat{k}$ 和视线向量 $\\vec{s}$ 之间的夹角。我们使用点积来求其 cosine 值：\n$$ \\cos\\gamma = \\frac{\\vec{s} \\cdot \\vec{n}}{|\\vec{s}||\\vec{n}|} = \\frac{((\\rho - r \\cos\\phi)\\hat{i} - r \\sin\\phi\\hat{j} + z\\hat{k}) \\cdot \\hat{k}}{s \\cdot 1} = \\frac{z}{s} $$\n微分立体角 $d\\Omega$ 的基本定义为 $d\\Omega = \\frac{\\cos\\gamma}{s^2} dA$。代入我们得到的 $\\cos\\gamma$、$s^2$ 和 $dA$ 的表达式：\n$$ d\\Omega = \\left(\\frac{z/s}{s^2}\\right) (r \\, dr \\, d\\phi) = \\frac{zr}{s^3} \\, dr \\, d\\phi $$\n代入 $s^2$ 的表达式：\n$$ d\\Omega = \\frac{zr}{(\\rho^2 + r^2 - 2\\rho r \\cos\\phi + z^2)^{3/2}} \\, dr \\, d\\phi $$\n为求总立体角 $\\Omega$，我们将 $d\\Omega$ 在整个圆盘表面上积分。积分限为 $r \\in [0, R]$ 和 $\\phi \\in [0, 2\\pi)$。这得到双重积分表达式：\n$$ \\Omega(\\rho, z, R) = \\int_{0}^{2\\pi} \\int_{0}^{R} \\frac{zr}{(\\rho^2 + r^2 - 2\\rho r \\cos\\phi + z^2)^{3/2}} \\, dr \\, d\\phi $$\n这完成了问题的第一部分。\n\n对于第二部分，我们分析数值挑战。被积函数，我们称之为 $f(r, \\phi)$，可能会给数值积分程序带来困难。分母 $(\\rho^2 + r^2 - 2\\rho r \\cos\\phi + z^2)^{3/2}$ 是 $(s^2)^{3/2}$。量 $s$ 是从观察点到圆盘上一点的距离。当 $z$ 很小、$\\phi \\approx 0$ 且 $r \\approx \\rho$ 时，这个距离最小。如果观察点的投影 $(\\rho, 0, 0)$ 位于圆盘内部（即 $\\rho  R$），被积函数将在点 $(r, \\phi) = (\\rho, 0)$ 附近出现一个尖峰。当 $z \\to 0$ 时，这个峰变得极其狭窄和高耸，趋近于一个奇点。使用固定步长的标准积分方法可能无法准确捕捉到这个峰的贡献，从而导致显著误差。正如测试用例4所示，当 $z$ 很小且 $\\rho$ 不接近 $0$ 或 $R$ 时，这个挑战最为突出。\n\n一个稳健的计算策略必须考虑到这种行为。\n1.  **轴上情况 ($\\rho=0$):**\n    当观察点位于圆盘轴线上时，$\\rho=0$。由于 $\\cos\\phi$ 项消失，被积函数不再依赖于 $\\phi$，积分大大简化：\n    $$ \\Omega(0, z, R) = \\int_{0}^{2\\pi} \\int_{0}^{R} \\frac{zr}{(r^2 + z^2)^{3/2}} \\, dr \\, d\\phi = 2\\pi z \\int_{0}^{R} r(r^2 + z^2)^{-3/2} \\, dr $$\n    这个积分可以解析求解。使用换元法 $u = r^2 + z^2$, $du = 2r \\, dr$：\n    $$ \\int r(r^2 + z^2)^{-3/2} \\, dr = \\frac{1}{2} \\int u^{-3/2} \\, du = \\frac{1}{2} \\frac{u^{-1/2}}{-1/2} = -(r^2 + z^2)^{-1/2} $$\n    计算定积分：\n    $$ \\Omega(0, z, R) = 2\\pi z \\left[ -(r^2 + z^2)^{-1/2} \\right]_{0}^{R} = 2\\pi z \\left( -\\frac{1}{\\sqrt{R^2+z^2}} - (-\\frac{1}{\\sqrt{0^2+z^2}}) \\right) $$\n    由于 $z  0$，这给出了精确的闭合形式解：\n    $$ \\Omega(0, z, R) = 2\\pi \\left(1 - \\frac{z}{\\sqrt{R^2+z^2}}\\right) $$\n    对于任何 $\\rho$ 在数值上与 $0$ 无法区分的情况，都应使用这个高度精确且高效的公式。\n\n2.  **离轴情况 ($\\rho  0$):**\n    对于一般情况，必须对双重积分进行数值计算。可能存在的尖峰使得使用自适应积分算法成为必要。这类算法，例如 `scipy.integrate.dblquad` 中实现的算法，会在被积函数变化剧烈的区域自动加密积分网格。这使得在不需要对整个定义域使用过密网格的情况下，也能获得准确的结果。\n    为了提高效率，我们可以利用被积函数关于 $\\phi$ 的对称性。由于 $\\cos\\phi = \\cos(2\\pi - \\phi)$，从 $\\pi$ 到 $2\\pi$ 的积分与从 $0$ 到 $\\pi$ 的积分相同。因此，我们可以将 $\\phi$ 的积分区间设为从 $0$ 到 $\\pi$，然后将结果乘以 $2$：\n    $$ \\Omega(\\rho, z, R) = 2 \\int_{0}^{\\pi} \\int_{0}^{R} \\frac{zr}{(\\rho^2 + r^2 - 2\\rho r \\cos\\phi + z^2)^{3/2}} \\, dr \\, d\\phi $$\n\n因此，所提出的计算策略是一种混合方法：对于 $\\rho \\approx 0$ 的情况，应用解析公式。对于 $\\rho  0$ 的情况，对推导出的积分表达式使用自适应数值双重积分程序。该策略在包括已识别的挑战性情况在内的广泛参数范围内都是稳健的。\n\n对于第三部分，该策略使用 Python 实现，其中 `numpy` 库用于数值运算，`scipy.integrate.dblquad` 用于数值积分。我们要求积分器具有高精度，以确保最终结果可以可靠地四舍五入到 $10$ 位有效数字。", "answer": "```python\nimport numpy as np\nfrom scipy import integrate\n\ndef format_to_sig_figs(value, digits):\n    \"\"\"\n    Formats a floating-point number to a specified number of significant digits.\n    \"\"\"\n    if value == 0:\n        return '0.0'\n    # Use the 'g' format specifier which handles significant digits.\n    # The precision for 'g' is the number of significant digits.\n    return f\"{value:.{digits}g}\"\n    \ndef compute_solid_angle(R, rho, z, tol=1e-12):\n    \"\"\"\n    Computes the solid angle subtended by a disk of radius R at an\n    observation point (rho, z).\n\n    Args:\n        R (float): Radius of the disk.\n        rho (float): Lateral offset of the observation point.\n        z (float): Height of the observation point above the disk plane.\n        tol (float): Relative and absolute tolerance for numerical integration.\n\n    Returns:\n        float: The computed solid angle in steradians.\n    \"\"\"\n    if R == 0 or z = 0:\n        return 0.0\n\n    # On-axis case: use the exact analytical formula\n    # A small threshold is used to handle floating point inaccuracies near zero\n    if rho  1e-9:\n        return 2 * np.pi * (1 - z / np.sqrt(R**2 + z**2))\n\n    # Off-axis case: use numerical double integration (adaptive quadrature)\n    # Integrand for the solid angle\n    # d(Omega) = (z*r) / (rho^2 + r^2 - 2*rho*r*cos(phi) + z^2)^(3/2)\n    # We use symmetry and integrate phi from 0 to pi, then multiply by 2.\n    integrand = lambda r, phi: (2 * z * r) / (rho**2 + r**2 - 2 * rho * r * np.cos(phi) + z**2)**1.5\n\n    # dblquad integrates func(y, x) dy dx. Here, y is the inner variable 'r'\n    # and x is the outer variable 'phi'.\n    # Limits for r are [0, R].\n    # Limits for phi are [0, pi].\n    result, error = integrate.dblquad(\n        integrand,\n        0,          # phi_min\n        np.pi,      # phi_max\n        lambda phi: 0, # r_min\n        lambda phi: R, # r_max\n        epsabs=tol,\n        epsrel=tol\n    )\n    \n    return result\n\ndef solve():\n    \"\"\"\n    Runs the test cases and prints the final formatted output.\n    \"\"\"\n    # Test suite: (R, rho, z) in meters\n    test_cases = [\n        (1.0, 0.0, 1.0),    # Case 1: On-axis\n        (1.0, 0.5, 0.75),   # Case 2: Off-axis, standard\n        (1.0, 2.0, 0.1),    # Case 3: Observer outside disk projection\n        (1.0, 0.9, 0.01),   # Case 4: Challenging case, small z, rho near R\n        (0.5, 1.5, 5.0),    # Case 5: Observer far away\n    ]\n\n    results = []\n    num_significant_digits = 10\n\n    for R, rho, z in test_cases:\n        solid_angle = compute_solid_angle(R, rho, z)\n        formatted_result = format_to_sig_figs(solid_angle, num_significant_digits)\n        results.append(formatted_result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2517659"}]}