{"hands_on_practices": [{"introduction": "砂浆法的核心挑战在于如何处理非协调网格之间的接触界面。此过程的第一步，也是最基本的一步，是在从边上精确地定义积分域，这通常需要将从边根据其到主边的投影进行分段。本练习 [@problem_id:2581175] 提供了一个具体的二维几何场景，旨在通过手动计算来帮助您掌握界面分段和为每个分段构建高斯积分准则的关键技能。", "problem": "在采用砂浆法（mortar methods）处理非协调接触的有限元方法背景下，考虑一个平面界面，其中主面是由共享一个公共顶点的两条线性边组成的多段线，而从面是一条单独的直线形线性边，在最近点正交投影的意义上，它与两条主边都有重叠。\n\n设主边为 $\\Gamma_{M,1}$（从 $\\mathbf{A}=(0,0)$ 到 $\\mathbf{B}=(1,0)$）和 $\\Gamma_{M,2}$（从 $\\mathbf{B}=(1,0)$ 到 $\\mathbf{C}=(1,1)$）。设从边为 $\\Gamma_{S}$（从 $\\mathbf{P}_0=(0.4,-0.2)$ 到 $\\mathbf{P}_1=(1.1,0.9)$）。通过从双单位区间 $s\\in[-1,1]$ 到该线段的标准仿射映射来参数化从边，即 $\\mathbf{x}_{S}(s)=\\mathbf{x}_{m}+s\\,\\mathbf{x}_{d}$，其中 $\\mathbf{x}_{m}=(\\mathbf{P}_0+\\mathbf{P}_1)/2$ 且 $\\mathbf{x}_{d}=(\\mathbf{P}_1-\\mathbf{P}_0)/2$。采用到主多段线的最近点正交投影，边的选择通过比较到 $\\Gamma_{M,1}$ 的距离 $d_1(s)=|y_{S}(s)|$ 和到 $\\Gamma_{M,2}$ 的距离 $d_2(s)=|x_{S}(s)-1|$ 来确定，并要求正交垂足落在相应的边内（对于此几何形状，在激活部分上此要求得到满足）。将激活接触界面定义为 $\\Gamma_{S}$ 上其投影落在 $\\Gamma_{M,1}\\cup\\Gamma_{M,2}$ 的部分。\n\n任务：\n- 计算从参数分割点 $s^{\\star}$，在该点处激活主边发生变化，即满足 $d_1(s)=d_2(s)$ 且 $x_{S}(s)\\le 1$ 和 $y_{S}(s)\\ge 0$ 的唯一点。用此来确定与 $\\Gamma_{M,1}$ 配对的从子段 $I_1=[-1,s^{\\star}]$ 和与 $\\Gamma_{M,2}$ 配对的从子段 $I_2=[s^{\\star},1]$。\n- 对于每个子段 $I_j=[a_j,b_j]$，在从参数 $s$ 上构造 $I_j$ 的 $2$ 点 Gauss–Legendre 求积，其节点为 $s_{j}^{\\pm}=\\frac{a_j+b_j}{2}\\pm\\frac{b_j-a_j}{2}\\,\\frac{1}{\\sqrt{3}}$，参数权重为 $w_{j}^{\\pm}=\\frac{b_j-a_j}{2}$。提供相应的物理线积分权重 $\\widehat{w}_{j}^{\\pm}=J_{S}\\,w_{j}^{\\pm}$，其中 $J_{S}=\\|\\mathbf{x}_{d}\\|$ 是 $\\Gamma_{S}$ 上的常数线雅可比。对于每个求积节点 $s_{j}^{\\pm}$，也给出相关的主边局部坐标 $t\\in[-1,1]$：对于 $\\Gamma_{M,1}$，使用 $\\mathbf{x}_{M,1}(t)=\\big(\\frac{1+t}{2},0\\big)$，因此 $t_{1}(s)=2\\,x_{S}(s)-1$；对于 $\\Gamma_{M,2}$，使用 $\\mathbf{x}_{M,2}(t)=\\big(1,\\frac{1+t}{2}\\big)$，因此 $t_{2}(s)=2\\,y_{S}(s)-1$。\n- 使用上述在 $I_1\\cup I_2$ 上的复合求积，计算砂浆线积分\n$$\nI=\\int_{\\Gamma_{S}^{\\text{act}}}\\big(x+2y\\big)\\,\\mathrm{d}\\ell,\n$$\n其中 $(x,y)$ 是 $\\Gamma_{S}$ 上的坐标，$\\mathrm{d}\\ell$ 是线元。将 $I$ 的最终值表示为无单位的精确解析表达式。不要四舍五入。", "solution": "在尝试任何解答之前，需对问题陈述进行验证。\n\n逐字提取给定条件：\n- 主边：$\\Gamma_{M,1}$ 从 $\\mathbf{A}=(0,0)$ 到 $\\mathbf{B}=(1,0)$；$\\Gamma_{M,2}$ 从 $\\mathbf{B}=(1,0)$ 到 $\\mathbf{C}=(1,1)$。\n- 从边：$\\Gamma_{S}$ 从 $\\mathbf{P}_0=(0.4,-0.2)$ 到 $\\mathbf{P}_1=(1.1,0.9)$。\n- 从边参数化：对于 $s\\in[-1,1]$，$\\mathbf{x}_{S}(s)=\\mathbf{x}_{m}+s\\,\\mathbf{x}_{d}$，其中 $\\mathbf{x}_{m}=(\\mathbf{P}_0+\\mathbf{P}_1)/2$ 且 $\\mathbf{x}_{d}=(\\mathbf{P}_1-\\mathbf{P}_0)/2$。\n- 投影规则：到主多段线的最近点正交投影。边的选择通过比较到 $\\Gamma_{M,1}$ 的距离 $d_1(s)=|y_{S}(s)|$ 和到 $\\Gamma_{M,2}$ 的距离 $d_2(s)=|x_{S}(s)-1|$ 来确定。\n- 激活界面条件：正交垂足落在相应的主边内。\n- 任务1：找到分割点 $s^{\\star}$，在该点处 $d_1(s)=d_2(s)$ 且 $x_{S}(s)\\le 1$ 和 $y_{S}(s)\\ge 0$。这定义了子段 $I_1=[-1,s^{\\star}]$ 和 $I_2=[s^{\\star},1]$。\n- 任务2：对于每个子段 $I_j$，构造一个 $2$ 点 Gauss–Legendre 求积，其节点为 $s_{j}^{\\pm}$，参数权重为 $w_{j}^{\\pm}$，物理权重为 $\\widehat{w}_{j}^{\\pm}$，以及相关的主边局部坐标 $t(s)$。\n- 任务3：使用此求积计算积分 $I=\\int_{\\Gamma_{S}^{\\text{act}}}\\big(x+2y\\big)\\,\\mathrm{d}\\ell$。\n\n该问题具有科学依据、是适定的且客观的。这是计算力学中一个涉及在分段区域上进行数值积分的标准练习。数据是完整的、一致的且计算上是可行的。该问题不违反任何基本原理，其结构保证了存在唯一且可验证的解。因此，该问题被认定为有效，并将提供解答。\n\n首先，我们确定从边的参数化。中点 $\\mathbf{x}_m$ 和方向向量 $\\mathbf{x}_d$ 是：\n$$\n\\mathbf{x}_{m} = \\frac{\\mathbf{P}_0+\\mathbf{P}_1}{2} = \\frac{1}{2}\\big((0.4,-0.2) + (1.1,0.9)\\big) = (0.75, 0.35) = \\left(\\frac{3}{4}, \\frac{7}{20}\\right)\n$$\n$$\n\\mathbf{x}_{d} = \\frac{\\mathbf{P}_1-\\mathbf{P}_0}{2} = \\frac{1}{2}\\big((1.1,0.9) - (0.4,-0.2)\\big) = (0.35, 0.55) = \\left(\\frac{7}{20}, \\frac{11}{20}\\right)\n$$\n从边 $\\Gamma_S$ 的参数化为 $\\mathbf{x}_S(s) = (x_S(s), y_S(s))$：\n$$\nx_S(s) = \\frac{3}{4} + \\frac{7}{20}s\n$$\n$$\ny_S(s) = \\frac{7}{20} + \\frac{11}{20}s\n$$\n\n接下来，我们求解从参数分割点 $s^{\\star}$。这是投影从 $\\Gamma_{M,1}$ 切换到 $\\Gamma_{M,2}$ 的点，由 $d_1(s)=d_2(s)$ 在条件 $x_S(s)\\le 1$ 和 $y_S(s)\\ge 0$ 下定义。距离为 $d_1(s)=|y_S(s)|$ 和 $d_2(s)=|x_S(s)-1|$。这些条件意味着我们可以将等式写为 $y_S(s) = 1 - x_S(s)$。\n$$\n\\frac{7}{20} + \\frac{11}{20}s = 1 - \\left(\\frac{3}{4} + \\frac{7}{20}s\\right) = \\frac{1}{4} - \\frac{7}{20}s\n$$\n$$\n\\left(\\frac{11}{20} + \\frac{7}{20}\\right)s = \\frac{1}{4} - \\frac{7}{20} = \\frac{5-7}{20}\n$$\n$$\n\\frac{18}{20}s = -\\frac{2}{20} \\implies \\frac{9}{10}s = -\\frac{1}{10} \\implies s^{\\star} = -\\frac{1}{9}\n$$\n从子段为 $I_1=[-1, -1/9]$ 和 $I_2=[-1/9, 1]$。\n\n现在我们构造复合 $2$ 点 Gauss-Legendre 求积。线雅可比 $J_S$ 是常数：\n$$\nJ_{S} = \\|\\mathbf{x}_{d}\\| = \\sqrt{\\left(\\frac{7}{20}\\right)^2 + \\left(\\frac{11}{20}\\right)^2} = \\sqrt{\\frac{49+121}{400}} = \\frac{\\sqrt{170}}{20}\n$$\n\n对于子段 $I_1 = [-1, -1/9]$：\n- 中点：$\\frac{a_1+b_1}{2} = -\\frac{5}{9}$。半长：$\\frac{b_1-a_1}{2} = \\frac{4}{9}$。\n- 节点：$s_{1}^{\\pm} = -\\frac{5}{9} \\pm \\frac{4}{9\\sqrt{3}}$。\n- 参数权重：$w_{1}^{\\pm} = \\frac{4}{9}$。\n- 物理权重：$\\widehat{w}_{1}^{\\pm} = J_S w_{1}^{\\pm} = \\frac{\\sqrt{170}}{20} \\cdot \\frac{4}{9} = \\frac{\\sqrt{170}}{45}$。\n- 对于 $\\Gamma_{M,1}$ 的主坐标映射：$t_1(s) = 2x_S(s)-1 = 2(\\frac{3}{4}+\\frac{7}{20}s)-1 = \\frac{1}{2}+\\frac{7}{10}s$。\n- 节点处的主坐标：$t_1(s_{1}^{\\pm}) = \\frac{1}{2} + \\frac{7}{10}\\left(-\\frac{5}{9} \\pm \\frac{4}{9\\sqrt{3}}\\right) = \\frac{1}{9} \\pm \\frac{14\\sqrt{3}}{135}$。\n\n对于子段 $I_2 = [-1/9, 1]$：\n- 中点：$\\frac{a_2+b_2}{2} = \\frac{4}{9}$。半长：$\\frac{b_2-a_2}{2} = \\frac{5}{9}$。\n- 节点：$s_{2}^{\\pm} = \\frac{4}{9} \\pm \\frac{5}{9\\sqrt{3}}$。\n- 参数权重：$w_{2}^{\\pm} = \\frac{5}{9}$。\n- 物理权重：$\\widehat{w}_{2}^{\\pm} = J_S w_{2}^{\\pm} = \\frac{\\sqrt{170}}{20} \\cdot \\frac{5}{9} = \\frac{\\sqrt{170}}{36}$。\n- 对于 $\\Gamma_{M,2}$ 的主坐标映射：$t_2(s) = 2y_S(s)-1 = 2(\\frac{7}{20}+\\frac{11}{20}s)-1 = -\\frac{3}{10}+\\frac{11}{10}s$。\n- 节点处的主坐标：$t_2(s_{2}^{\\pm}) = -\\frac{3}{10} + \\frac{11}{10}\\left(\\frac{4}{9} \\pm \\frac{5}{9\\sqrt{3}}\\right) = \\frac{17}{90} \\pm \\frac{11\\sqrt{3}}{54}$。\n\n最后，我们计算积分 $I=\\int_{\\Gamma_{S}^{\\text{act}}}\\big(x+2y\\big)\\,\\mathrm{d}\\ell$。在 $\\Gamma_S$ 上的被积函数为：\n$$\nf(s) = x_S(s)+2y_S(s) = \\left(\\frac{3}{4}+\\frac{7}{20}s\\right) + 2\\left(\\frac{7}{20}+\\frac{11}{20}s\\right) = \\frac{29}{20} + \\frac{29}{20}s = \\frac{29}{20}(1+s)\n$$\n积分由求和近似：$I \\approx \\sum_{k \\in \\{-,+\\}} f(s_{1}^{k}) \\widehat{w}_{1}^{k} + \\sum_{k \\in \\{-,+\\}} f(s_{2}^{k}) \\widehat{w}_{2}^{k}$。\n来自 $I_1$ 的贡献：\n$$\nI_1 = \\widehat{w}_{1}^{\\pm} \\left( f(s_1^-) + f(s_1^+) \\right) = \\frac{\\sqrt{170}}{45} \\left( \\frac{29}{20}(1+s_1^-) + \\frac{29}{20}(1+s_1^+) \\right)\n$$\n$$\nI_1 = \\frac{29\\sqrt{170}}{900} \\left( (1 - \\frac{5}{9} - \\frac{4}{9\\sqrt{3}}) + (1 - \\frac{5}{9} + \\frac{4}{9\\sqrt{3}}) \\right) = \\frac{29\\sqrt{170}}{900} \\left(2 \\cdot \\frac{4}{9}\\right) = \\frac{29\\sqrt{170}}{900} \\cdot \\frac{8}{9} = \\frac{58\\sqrt{170}}{2025}\n$$\n来自 $I_2$ 的贡献：\n$$\nI_2 = \\widehat{w}_{2}^{\\pm} \\left( f(s_2^-) + f(s_2^+) \\right) = \\frac{\\sqrt{170}}{36} \\left( \\frac{29}{20}(1+s_2^-) + \\frac{29}{20}(1+s_2^+) \\right)\n$$\n$$\nI_2 = \\frac{29\\sqrt{170}}{720} \\left( (1 + \\frac{4}{9} - \\frac{5}{9\\sqrt{3}}) + (1 + \\frac{4}{9} + \\frac{5}{9\\sqrt{3}}) \\right) = \\frac{29\\sqrt{170}}{720} \\left(2 \\cdot \\frac{13}{9}\\right) = \\frac{29\\sqrt{170}}{720} \\cdot \\frac{26}{9} = \\frac{377\\sqrt{170}}{3240}\n$$\n总积分：\n$$\nI = I_1 + I_2 = \\frac{58\\sqrt{170}}{2025} + \\frac{377\\sqrt{170}}{3240}\n$$\n$2025=3^4 \\cdot 5^2$ 和 $3240=2^3 \\cdot 3^4 \\cdot 5$ 的最小公倍数是 $16200$。\n$$\nI = \\frac{58 \\cdot 8}{16200}\\sqrt{170} + \\frac{377 \\cdot 5}{16200}\\sqrt{170} = \\frac{464 + 1885}{16200}\\sqrt{170} = \\frac{2349\\sqrt{170}}{16200}\n$$\n化简分数，因为 $2349 = 29 \\cdot 81 = 29 \\cdot 3^4$ 且 $16200 = 200 \\cdot 81 = 200 \\cdot 3^4$：\n$$\nI = \\frac{29 \\cdot 3^4}{200 \\cdot 3^4}\\sqrt{170} = \\frac{29\\sqrt{170}}{200}\n$$\n由于被积函数是关于 $s$ 的线性多项式，2 点高斯求积在每个子区间上都能提供积分的精确值，因此复合求积对于总积分是精确的。", "answer": "$$\n\\boxed{\\frac{29\\sqrt{170}}{200}}\n$$", "id": "2581175"}, {"introduction": "在我们掌握了如何在非协调界面上建立正确的数值积分方案之后，下一步是理解这些积分如何在有限元系统的代数方程中发挥作用。本练习 [@problem_id:2581208] 旨在通过一个简化的罚函数公式，推导接触约束对系统残差向量和切向刚度矩阵的贡献。通过这个推导，您将深入理解弱形式的接触约束是如何转化为非线性求解器所需处理的离散代数项的。", "problem": "考虑二维空间中单个从节点与单个双节点主线元之间的小变形、无摩擦、法向接触相互作用。假设只有位移的法向分量对接触起作用，并将它们收集在有序未知量向量 $\\{u\\} = \\big(u_{s}^{n},\\,u_{A}^{n},\\,u_{B}^{n}\\big)^{\\mathsf{T}}$ 中，其中 $u_{s}^{n}$ 是从节点的法向位移，$u_{A}^{n}$ 和 $u_{B}^{n}$ 是主节点的法向位移。主线元使用标准等参形函数 $N_{A}(\\xi) = \\frac{1-\\xi}{2}$ 和 $N_{B}(\\xi) = \\frac{1+\\xi}{2}$，其参数坐标为 $\\xi \\in [-1,1]$。主元上的（已知）接触点位于 $\\xi=\\xi_{c} \\in [-1,1]$。\n\n使用砂浆罚函数法处理法向接触，罚参数为 $k_{n}0$。假设在从节点处采用单点砂浆积分，其权重为 $w0$，且该点的对偶形函数为单位值，因此从边测试函数在该积分点的值为1。将带符号法向间隙定义为\n$$\ng(u) \\equiv u_{s}^{n} - N_{A}(\\xi_{c})\\,u_{A}^{n} - N_{B}(\\xi_{c})\\,u_{B}^{n} + g_{0},\n$$\n其中 $g_{0}$ 是法向方向上的初始几何间隙（可能非零但已知）。假设在当前迭代步接触是激活的，因此罚函数贡献在 $g(u)$ 的一个邻域内是光滑的。\n\n从罚函数接触贡献的虚功原理出发，推导对应于 $\\{u\\}$ 的全局系统的局部砂浆残差向量贡献 $\\{r_{c}\\}$ 和一致切线矩阵贡献 $[K_{c}]$，并用 $w$、$k_{n}$ 以及在 $\\xi_{c}$ 处求值的主元形函数来表示。然后，利用你推导出的表达式，确定切线矩阵中在法向方向上耦合主节点 A 和 B 的单个标量项，即 $[K_{c}]$ 的 $(A,B)$ 分量，并将其表示为关于 $w$、$k_{n}$ 和 $\\xi_{c}$ 的闭式符号表达式。\n\n你的最终答案必须是该标量项的单个解析表达式。最终方框内的答案不要包含单位。", "solution": "所述问题具有科学依据、是适定的，并包含进行严谨推导所需的所有信息。这是计算接触力学领域的一个标准练习。因此，我将开始进行求解。\n\n推导的起点是来自罚函数接触项的势能贡献，记为 $\\Pi_c$。对于问题中假设的激活接触状态，势能是法向间隙 $g$ 的平方的函数。\n$$ \\Pi_c = \\frac{1}{2} k_{n} \\int_{\\Gamma_c} g^{2} \\, d\\Gamma $$\n此处，$k_{n}  0$ 是罚参数，$\\Gamma_c$ 代表接触界面。问题指定了采用砂浆法，并在从节点处使用单点积分法则，其相关权重为 $w  0$，且对偶形函数为单位值。这种离散化将积分简化为一个代数表达式：\n$$ \\Pi_c \\approx \\frac{1}{2} w k_{n} g^{2} $$\n带符号法向间隙 $g$ 定义为节点法向位移 $\\{u\\} = (u_{s}^{n}, u_{A}^{n}, u_{B}^{n})^{\\mathsf{T}}$ 的函数：\n$$ g(\\{u\\}) \\equiv u_{s}^{n} - N_{A}(\\xi_{c}) u_{A}^{n} - N_{B}(\\xi_{c}) u_{B}^{n} + g_{0} $$\n其中 $N_{A}(\\xi_{c})$ 和 $N_{B}(\\xi_{c})$ 是在接触点 $\\xi_c$ 处求值的主单元形函数，$g_0$ 是已知的初始间隙。该关系可以用矩阵形式表示：\n$$ g = \\{c\\}^{\\mathsf{T}}\\{u\\} + g_{0} $$\n其中常数向量 $\\{c\\}$ 定义为：\n$$ \\{c\\}^{\\mathsf{T}} = \\begin{pmatrix} 1  -N_{A}(\\xi_{c})  -N_{B}(\\xi_{c}) \\end{pmatrix} $$\n\n对残差向量的贡献 $\\{r_c\\}$ 源于虚功原理，这等同于求势能相对于位移向量 $\\{u\\}$ 的负梯度。\n$$ \\{r_c\\} = -\\frac{\\partial\\Pi_c}{\\partial\\{u\\}} = -\\frac{\\partial}{\\partial\\{u\\}} \\left( \\frac{1}{2} w k_{n} g^{2} \\right) $$\n应用链式法则，我们得到：\n$$ \\{r_c\\} = -w k_{n} g \\frac{\\partial g}{\\partial\\{u\\}} $$\n间隙函数 $g$ 相对于 $\\{u\\}$ 的梯度就是常数向量 $\\{c\\}$：\n$$ \\frac{\\partial g}{\\partial\\{u\\}} = \\{c\\} $$\n因此，残差向量的贡献为：\n$$ \\{r_c\\} = -w k_{n} g \\{c\\} = -w k_{n} \\left( \\{c\\}^{\\mathsf{T}}\\{u\\} + g_{0} \\right) \\{c\\} $$\n\n接下来，通过求残差向量贡献 $\\{r_c\\}$ 相对于位移向量转置 $\\{u\\}^{\\mathsf{T}}$ 的负偏导数，来推导一致切线矩阵贡献 $[K_c]$。\n$$ [K_c] = -\\frac{\\partial\\{r_c\\}}{\\partial\\{u\\}^{\\mathsf{T}}} = -\\frac{\\partial}{\\partial\\{u\\}^{\\mathsf{T}}} \\left( -w k_{n} g \\{c\\} \\right) = w k_{n} \\frac{\\partial}{\\partial\\{u\\}^{\\mathsf{T}}} \\left( g \\{c\\} \\right) $$\n使用微分乘法法则：\n$$ [K_c] = w k_{n} \\left( \\frac{\\partial g}{\\partial\\{u\\}^{\\mathsf{T}}} \\{c\\} + g \\frac{\\partial\\{c\\}}{\\partial\\{u\\}^{\\mathsf{T}}} \\right) $$\n标量间隙 $g$ 相对于行向量 $\\{u\\}^{\\mathsf{T}}$ 的导数是行向量 $\\{c\\}^{\\mathsf{T}}$：\n$$ \\frac{\\partial g}{\\partial\\{u\\}^{\\mathsf{T}}} = \\{c\\}^{\\mathsf{T}} $$\n向量 $\\{c\\}$ 由在固定参数坐标 $\\xi_c$ 处求值的形函数组成，因此相对于位移 $\\{u\\}$ 是常数。其导数为零矩阵：\n$$ \\frac{\\partial\\{c\\}}{\\partial\\{u\\}^{\\mathsf{T}}} = [0] $$\n代入这些结果，得到切线矩阵的表达式：\n$$ [K_c] = w k_{n} ( \\{c\\}^{\\mathsf{T}} \\{c\\} + [0] ) = w k_{n} \\{c\\} \\{c\\}^{\\mathsf{T}} $$\n显式地写出此外积：\n$$ [K_c] = w k_{n} \\begin{pmatrix} 1 \\\\ -N_{A}(\\xi_{c}) \\\\ -N_{B}(\\xi_{c}) \\end{pmatrix} \\begin{pmatrix} 1  -N_{A}(\\xi_{c})  -N_{B}(\\xi_{c}) \\end{pmatrix} $$\n$$ [K_c] = w k_{n} \\begin{pmatrix} 1  -N_A(\\xi_c)  -N_B(\\xi_c) \\\\ -N_A(\\xi_c)  N_A(\\xi_c)^2  N_A(\\xi_c)N_B(\\xi_c) \\\\ -N_B(\\xi_c)  N_A(\\xi_c)N_B(\\xi_c)  N_B(\\xi_c)^2 \\end{pmatrix} $$\n这个 $3 \\times 3$ 矩阵的行和列对应于有序自由度 $(u_{s}^{n}, u_{A}^{n}, u_{B}^{n})$。问题要求的是耦合主节点 A 和 B 的单个标量项，即分量 $[K_c]_{AB}$。这对应于上面推导出的矩阵的第二行第三列的元素。\n$$ [K_c]_{AB} = w k_{n} N_{A}(\\xi_{c}) N_{B}(\\xi_{c}) $$\n我们现在代入给定的等参形函数表达式：\n$$ N_{A}(\\xi_c) = \\frac{1-\\xi_c}{2} $$\n$$ N_{B}(\\xi_c) = \\frac{1+\\xi_c}{2} $$\n这就得出了所求分量的最终表达式：\n$$ [K_c]_{AB} = w k_{n} \\left( \\frac{1-\\xi_c}{2} \\right) \\left( \\frac{1+\\xi_c}{2} \\right) = w k_{n} \\frac{1 - \\xi_c^2}{4} $$\n该表达式表示了两个主节点的法向位移之间的耦合刚度，它源于对与单个从节点接触的罚函数约束。", "answer": "$$\n\\boxed{w k_{n} \\frac{1 - \\xi_{c}^{2}}{4}}\n$$", "id": "2581208"}, {"introduction": "理论知识和单个计算步骤最终需要整合成一个可执行的算法，才能在实际的有限元软件中发挥作用。这个综合性练习 [@problem_id:2581187] 描绘了一个一维砂浆法装配过程的完整蓝图，它将几何分段和代数贡献的概念融为一体。通过构思这个从网格处理到最终矩阵装配的完整流程，您将巩固对砂浆法数据流和核心逻辑的理解，为实际编程实现奠定坚实基础。", "problem": "要求您在有限元法 (FEM) 中，为一维非协调接触实现一个最小但完整的砂浆段组装。目标是从两个共享实线上的潜在接触界面的不匹配网格中，通过算法构造砂浆段，并组装从基函数和主基函数之间的界面耦合积分。您的实现必须仅使用基本原理以及一维线性有限元和数值积分的标准定义来演示以下步骤。\n\n已知：\n- 一个一维主网格，其节点坐标在实线上严格递增，为 $\\{x^{m}_0,\\dots,x^{m}_{n_m-1}\\}$；以及一个一维从网格，其节点坐标在实线上也严格递增，为 $\\{x^{s}_0,\\dots,x^{s}_{n_s-1}\\}$。两个网格都由连续节点之间的开区间组成的线性单元构成。\n- 一个积分阶数 $p \\in \\mathbb{N}$，指定在每个砂浆段上使用 $p$ 点 Gauss–Legendre 积分。\n- 一个正公差 $\\varepsilon  0$，用于判断相交长度是否非零。\n- 约定从边定义为砂浆边，主边定义为非砂浆边。\n- 自由度 (DOF) 与网格节点相关联。\n\n实现以下步骤：\n\n1) 接触对搜索：\n- 对于每个从单元区间 $[x^{s}_i,x^{s}_{i+1}]$，找到所有与之相交长度超过 $\\varepsilon$ 的主单元区间 $[x^{m}_j,x^{m}_{j+1}]$。利用已排序的节点坐标，使用线性时间双指针扫描，以确保平均情况下的遍历时间复杂度为 $\\mathcal{O}(n_s + n_m)$。\n\n2) 砂浆段构造：\n- 对于任意重叠的单元对 $(i,j)$，将砂浆段构造为闭区间 $[a,b]$，其中 $a=\\max(x^{s}_i,x^{m}_j)$ 且 $b=\\min(x^{s}_{i+1},x^{m}_{j+1})$。如果 $b-a \\le \\varepsilon$，则丢弃该段。对于每个接受的段，记录：\n  - 从单元节点的索引 $(i,i+1)$ 和主单元节点的索引 $(j,j+1)$，用于局部到全局的映射。\n  - 段的端点 $a$ 和 $b$。\n\n3) 积分点分配：\n- 在每个段 $[a,b]$ 上，在参考区间 $[-1,1]$ 上放置 $p$ 个 Gauss–Legendre 积分点 $\\{\\xi_k\\}_{k=1}^p$ 和权重 $\\{\\omega_k\\}_{k=1}^p$，并通过 $x_k=\\tfrac{a+b}{2}+\\tfrac{b-a}{2}\\xi_k$ 和 $w_k=\\tfrac{b-a}{2}\\omega_k$ 将它们映射到物理点 $\\{x_k\\}_{k=1}^p$ 和物理权重 $\\{w_k\\}_{k=1}^p$。\n\n4) 线性形函数的求值：\n- 对于任意端点为 $[\\alpha,\\beta]$ 的单元和任意物理点 $x \\in [\\alpha,\\beta]$，计算局部坐标 $\\hat{x}=2\\dfrac{x-\\alpha}{\\beta-\\alpha}-1$，并计算两个线性形函数 $N_1(x)=\\dfrac{1-\\hat{x}}{2}$ 和 $N_2(x)=\\dfrac{1+\\hat{x}}{2}$。\n\n5) 砂浆耦合矩阵的组装：\n- 定义耦合矩阵 $C \\in \\mathbb{R}^{n_s \\times n_m}$ 为\n  $$C_{IJ} \\approx \\sum_{\\text{segments}} \\sum_{k=1}^p w_k \\, N^s_I(x_k)\\, N^m_J(x_k),$$\n  其中 $I \\in \\{0,\\dots,n_s-1\\}$ 和 $J \\in \\{0,\\dots,n_m-1\\}$ 分别索引从全局节点和主全局节点。对于一个由从局部节点 $(i,i+1)$ 和主局部节点 $(j,j+1)$ 的重叠单元产生的段，其对 $C_{IJ}$ 的贡献仅在 $(I,J) \\in \\{i,i+1\\} \\times \\{j,j+1\\}$ 时非零。使用局部到全局的节点映射，将每个段的 $2\\times 2$ 贡献散布相加到 $C$ 中。\n\n6) 输出诊断信息以验证算法正确性：\n- 令 $L$ 表示总重叠长度，即所有接受的段的长度 $b-a$ 之和。由于每个网格上线性基的单位分解性质，我们期望\n  $$\\sum_{I=0}^{n_s-1}\\sum_{J=0}^{n_m-1} C_{IJ} \\approx L.$$\n- 对于每个测试案例，计算并报告以下量：\n  - 接受的砂浆段数量 $n_{\\mathrm{seg}}$。\n  - $C$ 中绝对值严格大于阈值 $\\tau$ 的条目数（视为数值非零），记为 $\\mathrm{nnz}$。\n  - 标量 $S=\\sum_{I,J} C_{IJ}$。\n  - Frobenius 范数 $F=\\sqrt{\\sum_{I,J} C_{IJ}^2}$。\n  - 绝对平衡误差 $E=|S-L|$。\n\n您的程序必须实现上述完整流程，并为每个测试案例计算五个诊断值。所有浮点诊断值在最终输出中必须四舍五入到6位小数。\n\n测试套件：\n- 案例 1 (一般不匹配重叠)：\n  - 主节点：$[0.0,\\,0.5,\\,1.0]$。\n  - 从节点：$[0.2,\\,0.4,\\,0.6,\\,0.8,\\,1.0]$。\n  - 积分阶数：$p=2$。\n  - 相交公差：$\\varepsilon = 10^{-12}$。\n  - 非零阈值：$\\tau = 10^{-12}$。\n- 案例 2 (存在间隙且跨越主单元的部分重叠)：\n  - 主节点：$[0.0,\\,0.4,\\,1.0]$。\n  - 从节点：$[-0.2,\\,0.3,\\,0.7]$。\n  - 积分阶数：$p=3$。\n  - 相交公差：$\\varepsilon = 10^{-12}$。\n  - 非零阈值：$\\tau = 10^{-12}$。\n- 案例 3 (仅边缘接触，零测度重叠)：\n  - 主节点：$[0.0,\\,1.0]$。\n  - 从节点：$[1.0,\\,2.0]$。\n  - 积分阶数：$p=2$。\n  - 相交公差：$\\varepsilon = 10^{-12}$。\n  - 非零阈值：$\\tau = 10^{-12}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。每个测试案例的结果本身必须是包含五个条目的列表，顺序为 $[n_{\\mathrm{seg}},\\mathrm{nnz},S,F,E]$。因此，整个输出的格式为\n  $$\\big[[n_{\\mathrm{seg}}^{(1)},\\mathrm{nnz}^{(1)},S^{(1)},F^{(1)},E^{(1)}],\\,[n_{\\mathrm{seg}}^{(2)},\\mathrm{nnz}^{(2)},S^{(2)},F^{(2)},E^{(2)}],\\,[n_{\\mathrm{seg}}^{(3)},\\mathrm{nnz}^{(3)},S^{(3)},F^{(3)},E^{(3)}]\\big].$$\n输出中的所有浮点数条目必须精确到6位小数，所有整数必须打印为整数。", "solution": "问题陈述是有效的。它在有限元法的背景下，使用砂浆法公式为一维非协调接触的耦合矩阵组装指定了一个定义明确的计算过程。所有参数、方程和边界条件都已提供，并且实现步骤在逻辑上是合理的，与数值分析和计算力学的既定原则一致。我们开始进行求解。\n\n目标是实现一个算法，该算法从两个不匹配的一维网格构造砂浆段，并组装相应的耦合积分。该算法通过一系列离散且定义明确的步骤进行。\n\n首先，进行接触对搜索。给定一个从网格，其节点坐标为 $\\{x^{s}_i\\}_{i=0}^{n_s-1}$，以及一个主网格，其节点为 $\\{x^{m}_j\\}_{j=0}^{n_m-1}$，我们必须识别所有重叠的从单元 $[x^s_i, x^s_{i+1}]$ 和主单元 $[x^m_j, x^m_{j+1}]$ 对。由于两个网格的节点坐标都是严格递增的，可以使用双指针扫描算法在线性时间 $\\mathcal{O}(n_s + n_m)$ 内高效地执行此搜索。我们初始化指向第一个从单元和主单元的指针，并推进对应于在较小坐标处结束的单元的指针。\n\n对于每个已识别的重叠单元对，构造一个砂浆段。该段定义为闭区间 $[a, b]$，其中 $a = \\max(x^s_i, x^m_j)$ 且 $b = \\min(x^s_{i+1}, x^m_{j+1})$。只有当段的长度 $b - a$ 超过给定的正公差 $\\varepsilon$ 时，该段才会被考虑用于进一步处理。对于每个有效段，记录父从节点 $(i, i+1)$ 和主节点 $(j, j+1)$ 的索引，用于后续的组装。\n\n接下来，为每个砂浆段 $[a, b]$ 设置数值积分。我们使用一个 $p$ 点 Gauss-Legendre 积分法则，由规范区间 $[-1, 1]$ 上的积分点 $\\{\\xi_k\\}_{k=1}^p$ 和权重 $\\{\\omega_k\\}_{k=1}^p$ 定义。通过仿射变换将这些点映射到物理段 $[a, b]$，以获得物理积分点 $\\{x_k\\}_{k=1}^p$ 和权重 $\\{w_k\\}_{k=1}^p$：\n$$\nx_k = \\frac{a+b}{2} + \\frac{b-a}{2}\\xi_k, \\quad w_k = \\frac{b-a}{2}\\omega_k\n$$\n\n需要在每个物理积分点 $x_k$ 处计算一维线性有限元基函数（或形函数）的值。对于定义在区间 $[\\alpha, \\beta]$ 上的通用单元，任何点 $x \\in [\\alpha, \\beta]$ 首先通过变换 $\\hat{x} = 2\\frac{x-\\alpha}{\\beta-\\alpha} - 1$ 映射到局部坐标 $\\hat{x} \\in [-1, 1]$。与该单元节点关联的两个线性形函数则由以下公式给出：\n$$\nN_1(\\hat{x}) = \\frac{1-\\hat{x}}{2}, \\quad N_2(\\hat{x}) = \\frac{1+\\hat{x}}{2}\n$$\n$N_1$ 对应于在 $\\alpha$ 处的节点（其中 $\\hat{x}=-1$），$N_2$ 对应于在 $\\beta$ 处的节点（其中 $\\hat{x}=1$）。\n\n利用这些组件，组装砂浆耦合矩阵 $C \\in \\mathbb{R}^{n_s \\times n_m}$。其条目 $C_{IJ}$ 表示第 $I$ 个全局从自由度 (DOF) 与第 $J$ 个全局主自由度之间的耦合。该矩阵通过对所有砂浆段的贡献求和来计算。对于每个段，我们使用准备好的积分法则来近似积分从基函数和主基函数的乘积：\n$$\nC_{IJ} \\approx \\sum_{\\text{segments}} \\sum_{k=1}^p w_k \\, N^s_I(x_k)\\, N^m_J(x_k)\n$$\n在实践中，对于源自从单元 $(i, i+1)$ 和主单元 $(j, j+1)$ 的段，贡献仅发生于全局矩阵 $C$ 的一个局部 $2 \\times 2$ 块。局部矩阵贡献计算如下：\n$$\nC^{\\text{local}}_{\\alpha\\beta} = \\sum_{k=1}^p w_k \\, N^s_\\alpha(x_k) \\, N^m_\\beta(x_k)\n$$\n其中 $\\alpha, \\beta \\in \\{1, 2\\}$ 分别索引从单元和主单元的局部节点。然后将这些局部贡献散布到全局矩阵 $C$ 中对应于全局节点索引的位置，即 $C_{i,j}, C_{i, j+1}, C_{i+1, j}, C_{i+1, j+1}$。\n\n最后，为验证实现，计算了几个诊断量。总重叠长度 $L$ 是所有接受的砂浆段长度之和。由于基函数的单位分解性质，对于其各自域内的任何 $x$，有 $\\sum_I N^s_I(x) = 1$ 和 $\\sum_J N^m_J(x) = 1$。这意味着耦合矩阵中所有条目的总和 $S = \\sum_{I,J} C_{IJ}$ 必须近似于总积分长度：\n$$\nS = \\sum_{I,J} \\sum_{\\text{segments}} \\int_{\\text{segment}} N^s_I(x) N^m_J(x) dx = \\sum_{\\text{segments}} \\int_{\\text{segment}} \\left(\\sum_I N^s_I(x)\\right) \\left(\\sum_J N^m_J(x)\\right) dx = \\sum_{\\text{segments}} \\int_{\\text{segment}} 1 \\cdot 1 \\, dx = L\n$$\n绝对平衡误差 $E = |S-L|$ 量化了数值积分的准确性。如果积分阶数 $p$ 足够高，这个误差应该接近机器精度。其他诊断量包括段的数量 $n_{\\mathrm{seg}}$、$C$ 中超过阈值 $\\tau$ 的非零条目数（记为 $\\mathrm{nnz}$）以及矩阵的 Frobenius 范数 $F = \\sqrt{\\sum_{I,J} C_{IJ}^2}$。这些量为所实现的算法提供了全面的验证。", "answer": "```python\nimport numpy as np\n\ndef eval_shape_funs(x, x_elem_start, x_elem_end):\n    \"\"\"\n    Evaluates the 1D linear shape functions for a given element and point.\n    \"\"\"\n    length = x_elem_end - x_elem_start\n    if length  1e-15:  # Effectively zero length, avoid division by zero\n        # This case should not be reached for valid elements\n        return np.array([0.0, 0.0])\n    x_hat = 2.0 * (x - x_elem_start) / length - 1.0\n    N1 = (1.0 - x_hat) / 2.0\n    N2 = (1.0 + x_hat) / 2.0\n    return np.array([N1, N2])\n\ndef compute_mortar_diagnostics(master_nodes, slave_nodes, p, eps, tau):\n    \"\"\"\n    Implements the full mortar method pipeline and computes diagnostics.\n    \"\"\"\n    master_nodes_np = np.array(master_nodes, dtype=float)\n    slave_nodes_np = np.array(slave_nodes, dtype=float)\n    \n    n_m = len(master_nodes_np)\n    n_s = len(slave_nodes_np)\n    \n    C = np.zeros((n_s, n_m))\n    \n    # Get Gauss-Legendre quadrature points and weights\n    xi, omega = np.polynomial.legendre.leggauss(p)\n    \n    # Initialization for diagnostics\n    n_seg = 0\n    total_L = 0.0\n    \n    # Step 1: Contact pair search using a two-pointer sweep\n    i = 0  # slave element index\n    j = 0  # master element index\n    \n    while i  n_s - 1 and j  n_m - 1:\n        xs_i, xs_i1 = slave_nodes_np[i], slave_nodes_np[i+1]\n        xm_j, xm_j1 = master_nodes_np[j], master_nodes_np[j+1]\n        \n        # Step 2: Segment construction\n        a = max(xs_i, xm_j)\n        b = min(xs_i1, xm_j1)\n        \n        length = b - a\n        if length > eps:\n            n_seg += 1\n            total_L += length\n            \n            # Step 3: Quadrature assignment\n            x_k_phys = (a + b) / 2.0 + length / 2.0 * xi\n            w_k_phys = length / 2.0 * omega\n            \n            # Step 5: Assembly of the mortar coupling matrix (local part)\n            C_local = np.zeros((2, 2))\n            for k_idx in range(p):\n                x_phys = x_k_phys[k_idx]\n                w_phys = w_k_phys[k_idx]\n                \n                # Step 4: Evaluation of linear shape functions\n                N_s = eval_shape_funs(x_phys, xs_i, xs_i1)\n                N_m = eval_shape_funs(x_phys, xm_j, xm_j1)\n                \n                C_local += w_phys * np.outer(N_s, N_m)\n                \n            # Scatter-add local matrix to global matrix C\n            C[i, j] += C_local[0, 0]\n            C[i, j+1] += C_local[0, 1]\n            C[i+1, j] += C_local[1, 0]\n            C[i+1, j+1] += C_local[1, 1]\n\n        # Advance pointers for the sweep\n        if xs_i1  xm_j1:\n            i += 1\n        elif xm_j1  xs_i1:\n            j += 1\n        else: # Both elements end at the same coordinate\n            i += 1\n            j += 1\n            \n    # Step 6: Output diagnostics\n    S = np.sum(C)\n    F = np.linalg.norm(C)\n    E = abs(S - total_L)\n    nnz = np.sum(np.abs(C) > tau)\n    \n    return [n_seg, int(nnz), S, F, E]\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        {\n            \"master_nodes\": [0.0, 0.5, 1.0],\n            \"slave_nodes\": [0.2, 0.4, 0.6, 0.8, 1.0],\n            \"p\": 2, \"eps\": 1e-12, \"tau\": 1e-12\n        },\n        {\n            \"master_nodes\": [0.0, 0.4, 1.0],\n            \"slave_nodes\": [-0.2, 0.3, 0.7],\n            \"p\": 3, \"eps\": 1e-12, \"tau\": 1e-12\n        },\n        {\n            \"master_nodes\": [0.0, 1.0],\n            \"slave_nodes\": [1.0, 2.0],\n            \"p\": 2, \"eps\": 1e-12, \"tau\": 1e-12\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        result = compute_mortar_diagnostics(\n            case[\"master_nodes\"],\n            case[\"slave_nodes\"],\n            case[\"p\"],\n            case[\"eps\"],\n            case[\"tau\"]\n        )\n        results.append(result)\n\n    result_str_parts = []\n    for res in results:\n        # Format: [n_seg, nnz, S, F, E]\n        # Floats are formatted to 6 decimal places.\n        part = (\n            f\"[{res[0]},{res[1]},{res[2]:.6f},{res[3]:.6f},{res[4]:.6f}]\"\n        )\n        result_str_parts.append(part)\n    \n    final_output = f\"[{','.join(result_str_parts)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "2581187"}]}