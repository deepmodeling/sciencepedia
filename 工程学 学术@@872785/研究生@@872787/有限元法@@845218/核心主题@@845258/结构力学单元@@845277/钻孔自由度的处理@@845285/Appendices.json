{"hands_on_practices": [{"introduction": "一个有效的数值公式必须能够精确地表示刚体运动而不会产生虚假的内能，这是有限元方法中的一个基本要求。本练习将引导你从第一性原理出发，推导出一个通用的钻孔自由度稳定项必须满足的代数条件，以确保其在刚体旋转下保持能量不变性[@problem_id:2552865]。通过这个推导，你将深刻理解为何诸如 $(\\varphi - \\omega_z)^2$ 这样的惩罚形式在物理上是合理且在数值上是必要的。", "problem": "考虑一个平面线性弹性连续体，由单个等参有限元离散化，其节点位移向量为 $\\mathbf{d}_{u}$（包含所有平面内平动自由度），并有一个独立的标量钻孔转动场 $\\varphi(\\mathbf{x})$，该场由相同的单元形函数 $\\{N_{i}(\\mathbf{x})\\}_{i=1}^{n}$ 插值得到。设绕平面外轴的连续体（材料）转动定义为 $\\omega_{z}(\\mathbf{x}) = \\tfrac{1}{2}\\left(\\frac{\\partial u_{y}}{\\partial x} - \\frac{\\partial u_{x}}{\\partial y}\\right)$，其中 $(u_{x},u_{y})$ 是平面内位移分量。该单元通过以下在单元域 $\\Omega^{e}$ 上为常数的二次能量密度进行稳定化：\n$$\nw_{\\mathrm{stab}}(\\mathbf{x}) \\;=\\; \\tfrac{1}{2}\\,a\\,\\varphi^{2} \\;+\\; \\tfrac{1}{2}\\,b\\,\\varphi\\,\\omega_{z} \\;+\\; \\tfrac{1}{2}\\,c\\,\\omega_{z}^{2} \\;+\\; \\tfrac{1}{2}\\,d\\,\\nabla\\varphi\\cdot\\nabla\\varphi,\n$$\n其中 $a$、$b$、$c$ 和 $d$ 为恒定的稳定化系数（与 $\\mathbf{x}$ 无关）。总稳定化能为 $U_{\\mathrm{stab}}^{e} = \\int_{\\Omega^{e}} w_{\\mathrm{stab}}\\,\\mathrm{d}\\Omega$。假设为自由边界条件（无外部牵引力或力偶），并且弹性膜能在刚体运动下为零。\n\n从虚功原理和 $\\omega_{z}$ 的定义出发，推导常数 $a$、$b$ 和 $c$ 所需满足的代数条件，使得对于形式为 $\\mathbf{u}(\\mathbf{x}) = \\theta\\,\\mathbf{e}_{z}\\times\\mathbf{x}$（其中 $\\theta \\in \\mathbb{R}$ 为常数）的任意均匀刚体转动场，并且钻孔场也设为相同的均匀值 $\\varphi(\\mathbf{x})=\\theta$ 时，单元由 $U_{\\mathrm{stab}}^{e}$ 产生的内节点力和内节点力矩均为零。你可以将 $d$ 视为任意值，并可假设有足够的光滑性来进行标准的分部积分。\n\n请将最终答案表示为比率向量 $(a:b:c)$，归一化使得 $a=1$，并以单行矩阵的形式呈现。无需四舍五入，也无需单位。最终答案必须是单一解析表达式。", "solution": "该问题要求推导稳定化参数 $a$、$b$ 和 $c$ 所需满足的条件，使得单个有限元在承受刚体转动时，不产生内节点力或力矩。此分析的起点是将虚功原理应用于给定的稳定化能 $U_{\\mathrm{stab}}^{e}$。\n\n稳定化能由 $U_{\\mathrm{stab}}^{e} = \\int_{\\Omega^{e}} w_{\\mathrm{stab}}\\,\\mathrm{d}\\Omega$ 给出，其能量密度为：\n$$\nw_{\\mathrm{stab}}(\\mathbf{x}) = \\tfrac{1}{2}\\,a\\,\\varphi^{2} + \\tfrac{1}{2}\\,b\\,\\varphi\\,\\omega_{z} + \\tfrac{1}{2}\\,c\\,\\omega_{z}^{2} + \\tfrac{1}{2}\\,d\\,\\nabla\\varphi\\cdot\\nabla\\varphi\n$$\n内节点力和力矩与节点自由度功共轭，可通过能量的一阶变分 $\\delta U_{\\mathrm{stab}}^{e}$ 求得。\n$$\n\\delta U_{\\mathrm{stab}}^{e} = \\int_{\\Omega^{e}} \\delta w_{\\mathrm{stab}}\\,\\mathrm{d}\\Omega\n$$\n能量密度的变分为：\n$$\n\\delta w_{\\mathrm{stab}} = \\frac{\\partial w_{\\mathrm{stab}}}{\\partial \\varphi} \\delta\\varphi + \\frac{\\partial w_{\\mathrm{stab}}}{\\partial \\omega_z} \\delta\\omega_z + \\frac{\\partial w_{\\mathrm{stab}}}{\\partial(\\nabla\\varphi)} \\cdot \\delta(\\nabla\\varphi)\n$$\n计算 $w_{\\mathrm{stab}}$ 的偏导数：\n$$\n\\frac{\\partial w_{\\mathrm{stab}}}{\\partial \\varphi} = a\\varphi + \\tfrac{1}{2}b\\omega_z\n$$\n$$\n\\frac{\\partial w_{\\mathrm{stab}}}{\\partial \\omega_z} = \\tfrac{1}{2}b\\varphi + c\\omega_z\n$$\n$$\n\\frac{\\partial w_{\\mathrm{stab}}}{\\partial(\\nabla\\varphi)} = d\\nabla\\varphi\n$$\n将这些代入 $\\delta U_{\\mathrm{stab}}^{e}$ 的表达式中：\n$$\n\\delta U_{\\mathrm{stab}}^{e} = \\int_{\\Omega^{e}} \\left[ (a\\varphi + \\tfrac{1}{2}b\\omega_z)\\delta\\varphi + (\\tfrac{1}{2}b\\varphi + c\\omega_z)\\delta\\omega_z + d\\nabla\\varphi \\cdot \\nabla(\\delta\\varphi) \\right] \\mathrm{d}\\Omega\n$$\n场 $\\mathbf{u}=(u_x, u_y)$ 和 $\\varphi$ 由其节点值通过形函数 $N_i(\\mathbf{x})$ 插值得到：\n$$\n\\mathbf{u}(\\mathbf{x}) = \\sum_{i=1}^{n} N_i(\\mathbf{x}) \\mathbf{d}_{u,i} \\quad \\text{和} \\quad \\varphi(\\mathbf{x}) = \\sum_{i=1}^{n} N_i(\\mathbf{x}) d_{\\varphi,i}\n$$\n其中 $\\mathbf{d}_{u,i} = (d_{u_x,i}, d_{u_y,i})^T$ 和 $d_{\\varphi,i}$ 是节点 $i$ 的节点自由度（DOF）。场的变分与虚节点位移相关：\n$$\n\\delta\\varphi = \\sum_{i=1}^{n} N_i \\delta d_{\\varphi,i} \\quad \\text{和} \\quad \\nabla(\\delta\\varphi) = \\sum_{i=1}^{n} \\nabla N_i \\delta d_{\\varphi,i}\n$$\n连续体转动 $\\omega_z = \\tfrac{1}{2}(\\partial_x u_y - \\partial_y u_x)$ 的变分为：\n$$\n\\delta\\omega_z = \\tfrac{1}{2} \\left( \\frac{\\partial(\\delta u_y)}{\\partial x} - \\frac{\\partial(\\delta u_x)}{\\partial y} \\right) = \\tfrac{1}{2} \\sum_{i=1}^{n} \\left( \\frac{\\partial N_i}{\\partial x} \\delta d_{u_y,i} - \\frac{\\partial N_i}{\\partial y} \\delta d_{u_x,i} \\right)\n$$\n将这些代入 $\\delta U_{\\mathrm{stab}}^{e}$ 的表达式中，可以识别出内节点力和力矩。内虚功表示为 $\\delta U_{\\mathrm{stab}}^{e} = \\sum_{i=1}^{n} (\\mathbf{f}_{i,\\text{int}} \\cdot \\delta \\mathbf{d}_{u,i} + m_{i,\\text{int}} \\delta d_{\\varphi,i})$。节点 $i$ 处的节点力和力矩分别是 $\\delta\\mathbf{d}_{u,i}$ 和 $\\delta d_{\\varphi,i}$ 的相应系数：\n$$\nf_{u_x,i,\\text{int}} = \\int_{\\Omega^{e}} - \\tfrac{1}{2} (\\tfrac{1}{2}b\\varphi + c\\omega_z) \\frac{\\partial N_i}{\\partial y} \\mathrm{d}\\Omega\n$$\n$$\nf_{u_y,i,\\text{int}} = \\int_{\\Omega^{e}} \\tfrac{1}{2} (\\tfrac{1}{2}b\\varphi + c\\omega_z) \\frac{\\partial N_i}{\\partial x} \\mathrm{d}\\Omega\n$$\n$$\nm_{\\varphi,i,\\text{int}} = \\int_{\\Omega^{e}} \\left[ (a\\varphi + \\tfrac{1}{2}b\\omega_z) N_i + d\\nabla\\varphi \\cdot \\nabla N_i \\right] \\mathrm{d}\\Omega\n$$\n问题要求在刚体转动条件下计算时，这些内力和力矩为零。指定的刚体转动由 $\\mathbf{u}(\\mathbf{x}) = \\theta\\,\\mathbf{e}_{z}\\times\\mathbf{x}$ 和 $\\varphi(\\mathbf{x})=\\theta$ 给出，其中 $\\theta$ 为常数。\n设 $\\mathbf{x} = (x, y, 0)$。位移场为 $\\mathbf{u}(x,y) = (-\\theta y, \\theta x)$。\n我们计算该运动的相关运动学量：\n1.  钻孔转动是常数：$\\varphi(\\mathbf{x}) = \\theta$。\n2.  钻孔转动的梯度为零：$\\nabla\\varphi = \\mathbf{0}$。\n3.  连续体转动为：\n$$\n\\omega_z = \\tfrac{1}{2}\\left(\\frac{\\partial u_{y}}{\\partial x} - \\frac{\\partial u_{x}}{\\partial y}\\right) = \\tfrac{1}{2}\\left(\\frac{\\partial(\\theta x)}{\\partial x} - \\frac{\\partial(-\\theta y)}{\\partial y}\\right) = \\tfrac{1}{2}(\\theta - (-\\theta)) = \\theta\n$$\n现在，将这些值（$\\varphi=\\theta$，$\\omega_z=\\theta$，$\\nabla\\varphi=\\mathbf{0}$）代入内节点力和力矩的表达式中：\n$$\nf_{u_x,i,\\text{int}} = \\int_{\\Omega^{e}} - \\tfrac{1}{2} (\\tfrac{1}{2}b\\theta + c\\theta) \\frac{\\partial N_i}{\\partial y} \\mathrm{d}\\Omega = -\\tfrac{\\theta}{2}(\\tfrac{b}{2} + c) \\int_{\\Omega^{e}} \\frac{\\partial N_i}{\\partial y} \\mathrm{d}\\Omega\n$$\n$$\nf_{u_y,i,\\text{int}} = \\int_{\\Omega^{e}} \\tfrac{1}{2} (\\tfrac{1}{2}b\\theta + c\\theta) \\frac{\\partial N_i}{\\partial x} \\mathrm{d}\\Omega = \\tfrac{\\theta}{2}(\\tfrac{b}{2} + c) \\int_{\\Omega^{e}} \\frac{\\partial N_i}{\\partial x} \\mathrm{d\\Omega}\n$$\n$$\nm_{\\varphi,i,\\text{int}} = \\int_{\\Omega^{e}} \\left[ (a\\theta + \\tfrac{1}{2}b\\theta) N_i + d(\\mathbf{0}) \\cdot \\nabla N_i \\right] \\mathrm{d}\\Omega = \\theta(a + \\tfrac{b}{2}) \\int_{\\Omega^{e}} N_i \\mathrm{d}\\Omega\n$$\n为了使这些力和力矩对于任意单元（即，对于任意有效的形函数集 $N_i$）和任意非零转动 $\\theta$ 均为零，乘以积分的常数系数必须为零。积分 $\\int \\partial_y N_i d\\Omega$、$\\int \\partial_x N_i d\\Omega$ 和 $\\int N_i d\\Omega$ 通常不为零。\n这导致了关于参数 $a$、$b$ 和 $c$ 的两个独立的代数条件：\n1.  从节点力表达式得到：\n$$\n\\tfrac{b}{2} + c = 0 \\implies b + 2c = 0\n$$\n2.  从节点力矩表达式得到：\n$$\na + \\tfrac{b}{2} = 0 \\implies 2a + b = 0\n$$\n我们现在求解这个线性方程组，以得到比率 $(a:b:c)$。\n从第二个方程，我们得到 $b = -2a$。\n将此代入第一个方程得到：\n$$\n(-2a) + 2c = 0 \\implies 2c = 2a \\implies c = a\n$$\n因此，参数必须满足比率 $(a:b:c) = (a : -2a : a)$。对于任意非零 $a$，这简化为比率 $(1 : -2 : 1)$。\n问题要求最终答案以比率向量 $(a:b:c)$ 的形式表示，并归一化使得 $a=1$。这给出 $a=1$，$b=-2$ 和 $c=1$。\n这个结果意味着稳定化能的二次项部分（依赖于 $a$、$b$ 和 $c$）与 $(\\varphi - \\omega_z)^2$ 成正比：\n$$\n\\tfrac{1}{2}a\\varphi^2 + \\tfrac{1}{2}b\\varphi\\omega_z + \\tfrac{1}{2}c\\omega_z^2 = \\tfrac{a}{2}(\\varphi^2 - 2\\varphi\\omega_z + \\omega_z^2) = \\tfrac{a}{2}(\\varphi - \\omega_z)^2\n$$\n对于刚体转动，$\\varphi = \\omega_z = \\theta$，所以这个能量项恒等于零，这是所得力和力矩为零的充分条件。我们的推导从第一性原理证实了这一点。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  -2  1\n\\end{pmatrix}\n}\n$$", "id": "2552865"}, {"introduction": "在理解了将钻孔转动 $\\theta_{i}$ 与连续介质自转 $\\omega_{z}$ 联系起来的目标之后，我们探索一种能量惩罚之外的替代方法。本练习将展示如何通过多点约束（MPC）直接实现这种运动学联系[@problem_id:2552859]。你将通过平均相邻单元的连续介质自转来推导约束方程，从而获得处理单元运动学和全局约束组装的实践经验。", "problem": "在小应变二维弹性力学中，连续体自旋（位移梯度的反对称部分）绕面外轴的转动由无穷小转动标量 $\\omega_{z} = \\tfrac{1}{2}\\left(\\dfrac{\\partial u_{y}}{\\partial x} - \\dfrac{\\partial u_{x}}{\\partial y}\\right)$ 定义，其中 $u_{x}$ 和 $u_{y}$ 是笛卡尔位移分量。在一个协调有限元离散化中，使用线性三角形单元，位移场近似为 $u_{x}(x,y) = \\sum_{i} N_{i}(x,y)\\,u_{ix}$ 和 $u_{y}(x,y) = \\sum_{i} N_{i}(x,y)\\,u_{iy}$，其中 $N_{i}$ 是单元形函数，$u_{ix}, u_{iy}$ 是节点位移未知数。在每个节点引入一个钻孔自由度（绕面外轴的转动）$\\theta_{i}$，以实现与转动边界条件的耦合并改善条件数。\n\n考虑由两个共享节点 $1$ 的常应变线性三角形单元组成的以下非结构化网格片：\n- 单元 $\\mathcal{T}_{1}$ 具有节点 $\\{1,2,3\\}$，其坐标为 $(x_{1},y_{1}) = (0,0)$，$(x_{2},y_{2}) = (1,0)$，$(x_{3},y_{3}) = (0,1)$。\n- 单元 $\\mathcal{T}_{2}$ 具有节点 $\\{1,4,2\\}$，其坐标为 $(x_{1},y_{1}) = (0,0)$，$(x_{4},y_{4}) = (0,-1)$，$(x_{2},y_{2}) = (1,0)$。\n\n每个节点 $i \\in \\{1,2,3,4\\}$ 都包含平移自由度 $u_{ix}, u_{iy}$ 和一个钻孔转动 $\\theta_{i}$。全局自由度向量的排序如下：\n$$\n\\mathbf{q} = \\big[u_{1x},\\,u_{1y},\\,\\theta_{1},\\,u_{2x},\\,u_{2y},\\,\\theta_{2},\\,u_{3x},\\,u_{3y},\\,\\theta_{3},\\,u_{4x},\\,u_{4y},\\,\\theta_{4}\\big]^{\\mathsf{T}}.\n$$\n\n仅使用基本运动学定义 $\\omega_{z} = \\tfrac{1}{2}\\left(\\dfrac{\\partial u_{y}}{\\partial x} - \\dfrac{\\partial u_{x}}{\\partial y}\\right)$ 以及对于线性三角形单元，形函数梯度在单元上是常数这一事实，构造一个单一的线性多点约束，该约束强制节点 $1$ 处的钻孔转动等于在两个相邻单元 $\\mathcal{T}_{1}$ 和 $\\mathcal{T}_{2}$ 上计算的连续体自旋的算术平均值。以组装后的全局形式表示该约束：\n$$\n\\mathbf{g}^{\\mathsf{T}}\\,\\mathbf{q} = 0,\n$$\n其中 $\\mathbf{g}$ 是在给定的全局自由度排序下的系数行向量。请清楚地展示如何根据节点位移计算每个单元上的连续体自旋，如何形成平均值，然后将所得系数组装成与上述 $\\mathbf{q}$ 排序相对应的全局向量 $\\mathbf{g}$。\n\n请提供精确的系数值（不要四舍五入）。你的最终答案必须是按照指定的自由度顺序写成的单个 $1 \\times 12$ 行矩阵的行向量 $\\mathbf{g}^{\\mathsf{T}}$。", "solution": "目标是推导代表指定多点约束的行向量 $\\mathbf{g}^{\\mathsf{T}}$ 的系数。该约束要求节点 $1$ 处的钻孔转动 $\\theta_{1}$ 是两个相邻单元中连续体自旋 $\\omega_z^{(1)}$ 和 $\\omega_z^{(2)}$ 的算术平均值。这表示为：\n$$\n\\theta_{1} = \\frac{\\omega_z^{(1)} + \\omega_z^{(2)}}{2}\n$$\n为了将其表示为 $\\mathbf{g}^{\\mathsf{T}}\\mathbf{q} = 0$ 形式的齐次线性方程，我们重新整理各项：\n$$\n\\theta_{1} - \\frac{1}{2}\\omega_z^{(1)} - \\frac{1}{2}\\omega_z^{(2)} = 0\n$$\n我们的任务简化为找到用节点位移表示的 $\\omega_z^{(1)}$ 和 $\\omega_z^{(2)}$ 的表达式。对于常应变线性三角形单元，位移场的梯度在整个单元域上是恒定的。对于一个通用位移分量 $u(x,y) = \\sum_{i=1}^{3} N_i(x,y) u_i$，其偏导数由 $\\frac{\\partial u}{\\partial x} = \\sum_{i=1}^{3} \\frac{\\partial N_i}{\\partial x} u_i$ 和 $\\frac{\\partial u}{\\partial y} = \\sum_{i=1}^{3} \\frac{\\partial N_i}{\\partial y} u_i$ 给出。形函数的导数是常数，由 $\\frac{\\partial N_i}{\\partial x} = \\frac{b_i}{2A}$ 和 $\\frac{\\partial N_i}{\\partial y} = \\frac{c_i}{2A}$ 给出，其中 $A$ 是单元面积，$b_i, c_i$ 是取决于节点坐标 $(x_j, y_j)$ 的几何系数，按逆时针顺序 $(i, j, k)$ 排列：$b_i = y_j - y_k$ 和 $c_i = x_k - x_j$。\n\n首先，我们分析具有节点 $\\{1,2,3\\}$ 的单元 $\\mathcal{T}_{1}$，其坐标为 $(x_{1},y_{1}) = (0,0)$，$(x_{2},y_{2}) = (1,0)$，以及 $(x_{3},y_{3}) = (0,1)$。节点排序 $(1,2,3)$ 是逆时针的。单元的面积是 $A_{1} = \\frac{1}{2}|(x_2-x_1)(y_3-y_1) - (x_3-x_1)(y_2-y_1)| = \\frac{1}{2}|(1)(1) - (0)(0)| = \\frac{1}{2}$。\n几何系数为：\n$b_1 = y_2 - y_3 = 0 - 1 = -1$\n$b_2 = y_3 - y_1 = 1 - 0 = 1$\n$b_3 = y_1 - y_2 = 0 - 0 = 0$\n$c_1 = x_3 - x_2 = 0 - 1 = -1$\n$c_2 = x_1 - x_3 = 0 - 0 = 0$\n$c_3 = x_2 - x_1 = 1 - 0 = 1$\n\n位移梯度为：\n$\\frac{\\partial u_x}{\\partial y} = \\sum_{i=1}^{3} \\frac{c_i}{2A_1} u_{ix} = \\frac{1}{1}(-1 \\cdot u_{1x} + 0 \\cdot u_{2x} + 1 \\cdot u_{3x}) = -u_{1x} + u_{3x}$\n$\\frac{\\partial u_y}{\\partial x} = \\sum_{i=1}^{3} \\frac{b_i}{2A_1} u_{iy} = \\frac{1}{1}(-1 \\cdot u_{1y} + 1 \\cdot u_{2y} + 0 \\cdot u_{3y}) = -u_{1y} + u_{2y}$\n单元 $\\mathcal{T}_{1}$ 中的连续体自旋为：\n$\\omega_z^{(1)} = \\frac{1}{2}\\left(\\frac{\\partial u_y}{\\partial x} - \\frac{\\partial u_x}{\\partial y}\\right) = \\frac{1}{2}\\left((-u_{1y} + u_{2y}) - (-u_{1x} + u_{3x})\\right) = \\frac{1}{2}(u_{1x} - u_{1y} + u_{2y} - u_{3x})$。\n\n接下来，我们分析具有节点 $\\{1,4,2\\}$ 的单元 $\\mathcal{T}_{2}$，其坐标为 $(x_{1},y_{1}) = (0,0)$，$(x_{4},y_{4}) = (0,-1)$，以及 $(x_{2},y_{2}) = (1,0)$。节点排序 $(1,4,2)$ 是逆时针的。面积是 $A_{2} = \\frac{1}{2}|(x_4-x_1)(y_2-y_1) - (x_2-x_1)(y_4-y_1)| = \\frac{1}{2}|(0)(0) - (1)(-1)| = \\frac{1}{2}$。\n对于有序集 $(1,4,2)$ 的几何系数为：\n$b_1 = y_4 - y_2 = -1 - 0 = -1$\n$b_4 = y_2 - y_1 = 0 - 0 = 0$\n$b_2 = y_1 - y_4 = 0 - (-1) = 1$\n$c_1 = x_2 - x_4 = 1 - 0 = 1$\n$c_4 = x_1 - x_2 = 0 - 1 = -1$\n$c_2 = x_4 - x_1 = 0 - 0 = 0$\n\n位移梯度为：\n$\\frac{\\partial u_x}{\\partial y} = \\sum_{i \\in \\{1,4,2\\}} \\frac{c_i}{2A_2} u_{ix} = \\frac{1}{1}(1 \\cdot u_{1x} - 1 \\cdot u_{4x} + 0 \\cdot u_{2x}) = u_{1x} - u_{4x}$\n$\\frac{\\partial u_y}{\\partial x} = \\sum_{i \\in \\{1,4,2\\}} \\frac{b_i}{2A_2} u_{iy} = \\frac{1}{1}(-1 \\cdot u_{1y} + 0 \\cdot u_{4y} + 1 \\cdot u_{2y}) = -u_{1y} + u_{2y}$\n单元 $\\mathcal{T}_{2}$ 中的连续体自旋为：\n$\\omega_z^{(2)} = \\frac{1}{2}\\left(\\frac{\\partial u_y}{\\partial x} - \\frac{\\partial u_x}{\\partial y}\\right) = \\frac{1}{2}\\left((-u_{1y} + u_{2y}) - (u_{1x} - u_{4x})\\right) = \\frac{1}{2}(-u_{1x} - u_{1y} + u_{2y} + u_{4x})$。\n\n最后，我们将这些表达式代回约束方程：\n$$\n\\theta_{1} - \\frac{1}{2}\\left[ \\frac{1}{2}(u_{1x} - u_{1y} + u_{2y} - u_{3x}) \\right] - \\frac{1}{2}\\left[ \\frac{1}{2}(-u_{1x} - u_{1y} + u_{2y} + u_{4x}) \\right] = 0\n$$\n$$\n\\theta_{1} - \\frac{1}{4}(u_{1x} - u_{1y} + u_{2y} - u_{3x}) - \\frac{1}{4}(-u_{1x} - u_{1y} + u_{2y} + u_{4x}) = 0\n$$\n我们收集全局向量 $\\mathbf{q}$ 中每个自由度的系数：\n- $u_{1x}$: $-\\frac{1}{4}(1) - \\frac{1}{4}(-1) = -\\frac{1}{4} + \\frac{1}{4} = 0$\n- $u_{1y}$: $-\\frac{1}{4}(-1) - \\frac{1}{4}(-1) = \\frac{1}{4} + \\frac{1}{4} = \\frac{1}{2}$\n- $\\theta_{1}$: $1$\n- $u_{2x}$: $0$\n- $u_{2y}$: $-\\frac{1}{4}(1) - \\frac{1}{4}(1) = -\\frac{1}{2}$\n- $\\theta_{2}$: $0$\n- $u_{3x}$: $-\\frac{1}{4}(-1) = \\frac{1}{4}$\n- $u_{3y}$: $0$\n- $\\theta_{3}$: $0$\n- $u_{4x}$: $-\\frac{1}{4}(1) = -\\frac{1}{4}$\n- $u_{4y}$: $0$\n- $\\theta_{4}$: $0$\n\n完整的约束方程是：\n$$\n(0)u_{1x} + \\left(\\frac{1}{2}\\right)u_{1y} + (1)\\theta_{1} + (0)u_{2x} + \\left(-\\frac{1}{2}\\right)u_{2y} + (0)\\theta_{2} + \\left(\\frac{1}{4}\\right)u_{3x} + (0)u_{3y} + (0)\\theta_{3} + \\left(-\\frac{1}{4}\\right)u_{4x} + (0)u_{4y} + (0)\\theta_{4} = 0\n$$\n因此，行向量 $\\mathbf{g}^{\\mathsf{T}}$ 是根据指定的 $\\mathbf{q}$ 的排序由这些系数组装而成的。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  \\frac{1}{2}  1  0  -\\frac{1}{2}  0  \\frac{1}{4}  0  0  -\\frac{1}{4}  0  0\n\\end{pmatrix}\n}\n$$", "id": "2552859"}, {"introduction": "最后的这个练习将理论付诸于代码实现。你将为一个双线性四边形单元从零开始实现最广泛使用的惩罚稳定方法[@problem_id:2552917]。通过对比一个简单拉伸问题在有无钻孔自由度稳定化处理下的数值解，你将能够直接观察到该技术对结果的实际影响，并获得有限元编程的宝贵实践经验。", "problem": "要求您根据线性弹性和有限元法（FEM）的基本原理，在单位正方形域上实现一个可选钻孔自由度（DOF）稳定化的双线性四边形膜单元。该域为单位正方形，节点坐标为：节点 $1$ 位于 $(0,0)$，节点 $2$ 位于 $(1,0)$，节点 $3$ 位于 $(1,1)$，节点 $4$ 位于 $(0,1)$。该膜在右侧边界（$x=1$）上承受沿 $x$ 轴正方向、大小为 $T_0$ 的均布牵引力，而所有其他边界均无牵引力。该膜在平面应力条件下进行建模，其杨氏模量为 $E$，泊松比为 $\\nu$，厚度为 $t$。在整个计算中使用一致的无量纲单位。\n\n您的任务是计算以下两种模型的节点位移矢量场：\n- 模型 A：一个标准的双线性四边形膜单元，每个节点仅有平面内平移自由度，记为 $u$ 和 $v$。\n- 模型 B：与模型 A 相同的单元，但每个节点增加了钻孔转动自由度 $\\theta$，并通过对钻孔转动和平面内连续体转动之差施加罚函数来进行稳定化。稳定化使用参数 $\\alpha$，并在弱形式中增加了在单元面积上的积分项 $\\alpha (\\theta - \\omega_z)^2$，其中 $\\omega_z$ 是由 $\\omega_z = \\tfrac{1}{2} \\left( \\dfrac{\\partial v}{\\partial x} - \\dfrac{\\partial u}{\\partial y} \\right)$ 定义的平面外连续体转动。\n\n您必须从基本定义出发，推导并实现以下内容：\n- 线性弹性的平面应力本构关系，描述了应力矢量 $\\sigma$ 和应变矢量 $\\varepsilon$ 之间的关系，使用本构矩阵 $D$。其中应变为 $\\varepsilon = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^T$，且 $\\varepsilon_{xx} = \\dfrac{\\partial u}{\\partial x}$，$\\varepsilon_{yy} = \\dfrac{\\partial v}{\\partial y}$，以及 $\\gamma_{xy} = \\dfrac{\\partial u}{\\partial y} + \\dfrac{\\partial v}{\\partial x}$。\n- 四边形单元的等参映射和双线性形函数，使用 $2 \\times 2$ 高斯积分，积分点位于 $\\xi, \\eta \\in \\{ -1/\\sqrt{3}, +1/\\sqrt{3} \\}$，权重等于 $1$。通过对 $B^T D B \\, t \\, \\det(J)$ 进行积分来组装单元刚度矩阵 $K_{uv}$，其中 $B$ 是线性化应变-位移矩阵，$J$ 是映射的雅可比矩阵。\n- 施加在右边界上的一致节点力，通过在边界 $\\xi = 1$ 上进行一维高斯积分计算得出。积分为边界形函数、牵引力 $[T_0, 0]^T$、厚度 $t$ 以及对应于参数化到物理线映射的边界雅可比因子的乘积。\n- 钻孔转动稳定化。引入钻孔自由度场 $\\theta \\approx \\sum_{i=1}^4 N_i \\, \\theta_i$，其中 $N_i$ 是双线性形函数。在每个积分点定义连续体转动映射 $\\omega_z = \\tfrac{1}{2} ( \\partial v / \\partial x - \\partial u / \\partial y )$。在单元弱形式中加入罚函数稳定项 $\\int_\\Omega \\alpha (\\theta - \\omega_z)^2 \\, t \\, \\mathrm{d}\\Omega$。证明这将为单元矩阵贡献对称块：$K_{\\theta \\theta} = \\int \\alpha N^T N \\, t \\, \\mathrm{d}\\Omega$，$K_{u \\theta} = - \\int \\alpha B_\\omega^T N \\, t \\, \\mathrm{d}\\Omega$（其中 $B_\\omega$ 是从平移自由度到 $\\omega_z$ 的 $1 \\times 8$ 映射），以及 $K_{uu}^{\\text{stab}} = \\int \\alpha B_\\omega^T B_\\omega \\, t \\, \\mathrm{d}\\Omega$。因此，模型 B 的完整稳定化单元矩阵为\n$$\nK^{(B)} = \\begin{bmatrix}\nK_{uv} + K_{uu}^{\\text{stab}}  K_{u \\theta} \\\\\nK_{u \\theta}^T  K_{\\theta \\theta}\n\\end{bmatrix}.\n$$\n- 本质边界条件：为消除刚体运动，在节点 $1$ 和 $4$（左边界 $x=0$）上约束 $u=0$，并额外仅在节点 $1$ 上约束 $v=0$。不对 $\\theta$ 施加任何本质边界条件。对模型 A 和模型 B 应用相同的本质边界条件。对于模型 A，全局系统仅包含平移自由度；对于模型 B，它同时包含平移和钻孔自由度。在模型 A 中，外力仅作用于平移自由度；在模型 B 中，钻孔自由度的外部载荷为零。\n\n计算两种模型的解，并通过计算模型 A 和模型 B 之间所有节点上所有 $u$ 和 $v$ 自由度的最大绝对差，来比较平移节点位移矢量。\n\n您的程序必须实现上述内容，并使用以下几组无量纲参数进行测试：\n- 案例 1：$E = 1000$，$\\nu = 0.3$，$t = 1$，$T_0 = 1$，$\\alpha = 0.1$。\n- 案例 2：$E = 1000$，$\\nu = 0.3$，$t = 1$，$T_0 = 1$，$\\alpha = 10$。\n- 案例 3：$E = 1000$，$\\nu = 0.49$，$t = 1$，$T_0 = 1$，$\\alpha = 1$。\n- 案例 4：$E = 1000$，$\\nu = 0.3$，$t = 0.1$，$T_0 = 1$，$\\alpha = 1$。\n\n对于每个案例，输出一个浮点数，该数等于模型 A 和模型 B 之间平移节点位移的最大绝对差。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4]”），每个结果按顺序对应于上述案例。", "solution": "该解决方案从线性弹性和等参有限元理论的基本原理推导得出。\n\n**1. 平面应力本构关系**\n\n对于处于平面应力条件（$\\sigma_{zz} = \\sigma_{xz} = \\sigma_{yz} = 0$）下的线性、各向同性弹性材料，其平面内应力矢量 $\\sigma = [\\sigma_{xx}, \\sigma_{yy}, \\tau_{xy}]^T$ 与应变矢量 $\\varepsilon = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^T$ 之间的关系由 $\\sigma = D \\varepsilon$ 给出。本构矩阵 $D$ 源自胡克定律，其表达式为：\n$$\nD = \\frac{E}{1 - \\nu^2}\n\\begin{bmatrix}\n1  \\nu  0 \\\\\n\\nu  1  0 \\\\\n0  0  \\frac{1 - \\nu}{2}\n\\end{bmatrix}\n$$\n其中 $E$ 是杨氏模量，$\\nu$ 是泊松比。\n\n**2. 等参双线性四边形单元**\n\n几何场和位移场使用同一组形函数从节点值插值得到，这是等参概念的核心。\n\n形函数：对于在由 $\\xi, \\eta \\in [-1, 1]$ 定义的父域中的四节点四边形单元，其双线性形函数 $N_i(\\xi, \\eta)$ 为：\n$$\nN_1 = \\frac{1}{4}(1-\\xi)(1-\\eta), \\quad N_2 = \\frac{1}{4}(1+\\xi)(1-\\eta), \\quad N_3 = \\frac{1}{4}(1+\\xi)(1+\\eta), \\quad N_4 = \\frac{1}{4}(1-\\xi)(1+\\eta)\n$$\n几何映射：物理坐标 $(x, y)$ 通过父域坐标 $(\\xi, \\eta)$ 映射得到：\n$$\nx(\\xi, \\eta) = \\sum_{i=1}^4 N_i(\\xi, \\eta) x_i, \\quad y(\\xi, \\eta) = \\sum_{i=1}^4 N_i(\\xi, \\eta) y_i\n$$\n对于指定的节点为 $1(0,0)$、$2(1,0)$、$3(1,1)$、$4(0,1)$ 的单位正方形，此映射简化为 $x = \\frac{1}{2}(1+\\xi)$ 和 $y = \\frac{1}{2}(1+\\eta)$。\n\n雅可比矩阵：从物理坐标系到父坐标系的导数变换由雅可比矩阵 $J$ 控制：\n$$\nJ = \\begin{bmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta}  \\frac{\\partial y}{\\partial \\eta} \\end{bmatrix} = \\begin{bmatrix} 1/2  0 \\\\ 0  1/2 \\end{bmatrix}\n$$\n雅可比矩阵的行列式为 $\\det(J) = 1/4$。面积微元为 $dA = \\det(J) \\, d\\xi \\, d\\eta$。\n\n应变-位移矩阵 ($B$)：应变分量由位移场 $u(x,y) = \\sum N_i u_i$ 和 $v(x,y) = \\sum N_i v_i$ 的空间导数定义。关系式 $\\varepsilon = B d_{uv}$ 将应变矢量 $\\varepsilon$ 与节点位移矢量 $d_{uv} = [u_1, v_1, u_2, v_2, u_3, v_3, u_4, v_4]^T$ 联系起来。矩阵 $B$ 由形函数的空间导数构成：\n$$\nB = [B_1, B_2, B_3, B_4], \\quad \\text{其中} \\quad B_i = \\begin{bmatrix} \\frac{\\partial N_i}{\\partial x}  0 \\\\ 0  \\frac{\\partial N_i}{\\partial y} \\\\ \\frac{\\partial N_i}{\\partial y}  \\frac{\\partial N_i}{\\partial x} \\end{bmatrix}\n$$\n关于 $x$ 和 $y$ 的导数可使用雅可比矩阵的逆求得：\n$$\n\\begin{pmatrix} \\frac{\\partial N_i}{\\partial x} \\\\ \\frac{\\partial N_i}{\\partial y} \\end{pmatrix} = J^{-1} \\begin{pmatrix} \\frac{\\partial N_i}{\\partial \\xi} \\\\ \\frac{\\partial N_i}{\\partial \\eta} \\end{pmatrix} = \\begin{bmatrix} 2  0 \\\\ 0  2 \\end{bmatrix} \\begin{pmatrix} \\frac{\\partial N_i}{\\partial \\xi} \\\\ \\frac{\\partial N_i}{\\partial \\eta} \\end{pmatrix}\n$$\n\n**3. 单元刚度与力矢量**\n\n标准刚度矩阵 ($K_{uv}$): 平移自由度的单元刚度矩阵通过在单元体积上对应变能进行积分来计算：\n$$\nK_{uv} = \\int_A B^T D B \\, t \\, dA = \\int_{-1}^1 \\int_{-1}^1 B^T(\\xi, \\eta) D B(\\xi, \\eta) \\, t \\det(J) \\, d\\xi \\, d\\eta\n$$\n该积分使用 $2 \\times 2$ 高斯积分进行数值计算。\n\n一致节点力：施加在右边界（节点 2 到节点 3，$\\xi=1$）上的均布牵引力 $\\vec{T} = [T_0, 0]^T$ 生成了一致节点力矢量 $F_{uv}$：\n$$\nF_{uv} = \\int_{\\text{edge 2-3}} N_{\\text{edge}}^T \\vec{T} \\, t \\, dL\n$$\n其中 $N_{\\text{edge}}$ 包含在边界上求值的形函数。在此边界上，$N_1 = N_4 = 0$，$N_2 = \\frac{1}{2}(1-\\eta)$，以及 $N_3 = \\frac{1}{2}(1+\\eta)$。线微元为 $dL = \\sqrt{(\\partial x/\\partial\\eta)^2 + (\\partial y/\\partial\\eta)^2} \\, d\\eta = 1/2 \\, d\\eta$。积分后仅在节点 $2$ 和 $3$ 的 $u$ 位移上产生非零力：$F_{2,u} = F_{3,u} = T_0 t / 2$。总力矢量为 $F_{uv} = [0, 0, T_0 t/2, 0, T_0 t/2, 0, 0, 0]^T$。\n\n**4. 钻孔自由度稳定化（模型 B）**\n\n模型 B 在每个节点引入一个钻孔转动自由度 $\\theta_i$。稳定化是通过在总势能中增加一个罚能量项来实现的，该项惩罚节点钻孔转动场 $\\theta = \\sum N_i \\theta_i$ 与连续体转动 $\\omega_z = \\frac{1}{2}(\\partial v/\\partial x - \\partial u/\\partial y)$ 之间的不匹配。\n\n稳定化能为：\n$$\n\\Pi_{\\text{stab}} = \\frac{1}{2} \\int_A \\alpha (\\theta - \\omega_z)^2 \\, t \\, dA\n$$\n其中 $\\alpha$ 是一个罚参数。我们可以用节点自由度来表示 $\\theta$ 和 $\\omega_z$：\n$$\n\\theta = N d_\\theta, \\quad \\omega_z = B_\\omega d_{uv}\n$$\n此处，$d_\\theta = [\\theta_1, \\theta_2, \\theta_3, \\theta_4]^T$，$N = [N_1, N_2, N_3, N_4]$ 是形函数的行矢量，而 $B_\\omega$ 是一个将平移位移映射到连续体转动的 $1 \\times 8$ 矩阵：\n$$\nB_\\omega = \\frac{1}{2} \\sum_{i=1}^4 \\begin{bmatrix} -\\frac{\\partial N_i}{\\partial y} & \\frac{\\partial N_i}{\\partial x} \\end{bmatrix}_i\n$$\n将这些代入罚能量并对节点自由度取二阶变分，即可得到稳定化刚度矩阵，并将其加入系统中。对于自由度排序为 $[d_{uv}^T, d_\\theta^T]^T$ 的模型 B，其总刚度矩阵 $K^{(B)}$ 为：\n$$\nK^{(B)} = \\begin{bmatrix}\nK_{uv} + K_{uu}^{\\text{stab}}  K_{u \\theta} \\\\\nK_{u \\theta}^T  K_{\\theta \\theta}\n\\end{bmatrix}\n$$\n其中稳定化分量由以下积分给出：\n$$\nK_{uu}^{\\text{stab}} = \\int_A \\alpha B_\\omega^T B_\\omega \\, t \\, dA, \\quad K_{u \\theta} = - \\int_A \\alpha B_\\omega^T N \\, t \\, dA, \\quad K_{\\theta \\theta} = \\int_A \\alpha N^T N \\, t \\, dA\n$$\n这些矩阵同样使用 $2 \\times 2$ 高斯积分进行计算。\n\n**5. 系统求解与边界条件**\n\n模型 A：方程组为 $K_{uv} d_{uv} = F_{uv}$。\n模型 B：方程组为 $K^{(B)} d = F^{(B)}$，其中 $d = [d_{uv}^T, d_\\theta^T]^T$ 且 $F^{(B)} = [F_{uv}^T, 0, 0, 0, 0]^T$。\n\n边界条件 (BCs)：为消除刚体模态，对两种模型应用以下本质边界条件：\n- $u_1 = 0$ (自由度索引 0)\n- $v_1 = 0$ (自由度索引 1)\n- $u_4 = 0$ (自由度索引 6)\n这些条件通过修改全局刚度矩阵和力矢量来施加。对于一个被约束的自由度 $k$ ($d_k=0$)，刚度矩阵的第 $k$ 行和第 $k$ 列被设置为零，对角线元素 $K_{kk}$ 被设置为 $1$，力矢量的第 $k$ 个元素 $F_k$ 被设置为 $0$。\n\n求解得到的线性系统，得出节点位移 $d_{uv}^{(A)}$ 和 $d_{uv}^{(B)}$。最终的比较是这两个平移位移矢量之间的最大绝对差：$\\max(|d_{uv}^{(A)} - d_{uv}^{(B)}|)$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares a standard bilinear quadrilateral membrane element (Model A)\n    with an element enriched with stabilized drilling degrees of freedom (Model B).\n    \"\"\"\n    \n    test_cases = [\n        # (E, nu, t, T0, alpha)\n        (1000.0, 0.3, 1.0, 1.0, 0.1),\n        (1000.0, 0.3, 1.0, 1.0, 10.0),\n        (1000.0, 0.49, 1.0, 1.0, 1.0),\n        (1000.0, 0.3, 0.1, 1.0, 1.0),\n    ]\n\n    results = []\n\n    for E, nu, t, T0, alpha in test_cases:\n        # Nodal coordinates for the unit square element\n        coords = np.array([\n            [0.0, 0.0],  # Node 1\n            [1.0, 0.0],  # Node 2\n            [1.0, 1.0],  # Node 3\n            [0.0, 1.0],  # Node 4\n        ])\n\n        # Gaussian quadrature points and weights for 2x2 rule\n        gauss_points = [-1.0 / np.sqrt(3.0), 1.0 / np.sqrt(3.0)]\n        gauss_weights = [1.0, 1.0]\n\n        # Constitutive matrix for plane stress\n        D = (E / (1.0 - nu**2)) * np.array([\n            [1.0, nu, 0.0],\n            [nu, 1.0, 0.0],\n            [0.0, 0.0, (1.0 - nu) / 2.0]\n        ])\n\n        # Initialize element matrices\n        K_uv = np.zeros((8, 8))\n        K_uu_stab = np.zeros((8, 8))\n        K_utheta = np.zeros((8, 4))\n        K_thetatheta = np.zeros((4, 4))\n\n        # Numerical integration over the element area\n        for i in range(len(gauss_points)):\n            for j in range(len(gauss_points)):\n                xi = gauss_points[i]\n                eta = gauss_points[j]\n                weight = gauss_weights[i] * gauss_weights[j]\n\n                # Shape functions and their derivatives in parent domain\n                N = 0.25 * np.array([\n                    (1 - xi) * (1 - eta),\n                    (1 + xi) * (1 - eta),\n                    (1 + xi) * (1 + eta),\n                    (1 - xi) * (1 + eta)\n                ])\n\n                # Derivatives w.r.t. xi and eta\n                dN_dxi = 0.25 * np.array([\n                    -(1 - eta), (1 - eta), (1 + eta), -(1 + eta)\n                ])\n                dN_deta = 0.25 * np.array([\n                    -(1 - xi), -(1 + xi), (1 + xi), (1 - xi)\n                ])\n\n                # Jacobian matrix, its inverse and determinant\n                # For the unit square, J is constant\n                J = np.array([[0.5, 0.0], [0.0, 0.5]])\n                J_inv = np.array([[2.0, 0.0], [0.0, 2.0]])\n                det_J = 0.25\n                \n                # Shape function derivatives in physical domain\n                dN_dxy = J_inv @ np.vstack((dN_dxi, dN_deta))\n                dN_dx = dN_dxy[0, :]\n                dN_dy = dN_dxy[1, :]\n\n                # Strain-displacement matrix B\n                B = np.zeros((3, 8))\n                for k in range(4):\n                    B[0, 2 * k] = dN_dx[k]\n                    B[1, 2 * k + 1] = dN_dy[k]\n                    B[2, 2 * k] = dN_dy[k]\n                    B[2, 2 * k + 1] = dN_dx[k]\n\n                # Continuum rotation matrix B_omega\n                B_omega = np.zeros((1, 8))\n                for k in range(4):\n                    B_omega[0, 2 * k] = -0.5 * dN_dy[k]\n                    B_omega[0, 2 * k + 1] = 0.5 * dN_dx[k]\n\n                # Assemble stiffness matrices\n                factor = t * det_J * weight\n                K_uv += B.T @ D @ B * factor\n                \n                # Stabilization matrices\n                stab_factor = alpha * factor\n                K_uu_stab += B_omega.T @ B_omega * stab_factor\n                K_utheta -= B_omega.T @ N.reshape(1, 4) * stab_factor\n                K_thetatheta += N.reshape(4, 1) @ N.reshape(1, 4) * stab_factor\n        \n        # --- MODEL A ---\n        K_A = K_uv.copy()\n        F_A = np.zeros(8)\n        # Consistent nodal forces from traction T0 on edge 2-3\n        F_A[2] = T0 * t * 0.5  # u2\n        F_A[4] = T0 * t * 0.5  # u3\n\n        # Apply boundary conditions for Model A\n        # u1=0 (DOF 0), v1=0 (DOF 1), u4=0 (DOF 6)\n        constrained_dofs_A = [0, 1, 6]\n        for dof in constrained_dofs_A:\n            K_A[dof, :] = 0.0\n            K_A[:, dof] = 0.0\n            K_A[dof, dof] = 1.0\n            F_A[dof] = 0.0\n        \n        d_uv_A = np.linalg.solve(K_A, F_A)\n        \n        # --- MODEL B ---\n        K_B = np.zeros((12, 12))\n        K_B[0:8, 0:8] = K_uv + K_uu_stab\n        K_B[0:8, 8:12] = K_utheta\n        K_B[8:12, 0:8] = K_utheta.T\n        K_B[8:12, 8:12] = K_thetatheta\n\n        F_B = np.zeros(12)\n        F_B[2] = T0 * t * 0.5\n        F_B[4] = T0 * t * 0.5\n        \n        # Apply boundary conditions for Model B (same translational DOFs)\n        constrained_dofs_B = [0, 1, 6]\n        for dof in constrained_dofs_B:\n            K_B[dof, :] = 0.0\n            K_B[:, dof] = 0.0\n            K_B[dof, dof] = 1.0\n            F_B[dof] = 0.0\n        \n        d_B = np.linalg.solve(K_B, F_B)\n        d_uv_B = d_B[:8]\n\n        # Calculate the maximum absolute difference\n        max_diff = np.max(np.abs(d_uv_A - d_uv_B))\n        results.append(max_diff)\n        \n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.8e}' for r in results)}]\")\n\nsolve()\n```", "id": "2552917"}]}