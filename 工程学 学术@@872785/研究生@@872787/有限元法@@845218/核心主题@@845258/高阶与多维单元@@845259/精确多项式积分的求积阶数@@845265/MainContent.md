## 引言
在[有限元分析](@entry_id:138109)的广阔领域中，从结构力学到[流体动力学](@entry_id:136788)，其核心在于将复杂的连续物理问题转化为可解的离散[代数方程](@entry_id:272665)组。这一转化的关键步骤，便是计算[单元刚度矩阵](@entry_id:139369)、质量矩阵和[载荷向量](@entry_id:635284)，而这些计算无一例外地归结为在单元域上对特定函数进行积分。尽管看似简单，但如何高效且准确地执行这些积分，是决定整个模拟成败的基石。对于非平凡的几何形状和[高阶单元](@entry_id:750328)，解析积分几乎不可能，[数值求积](@entry_id:136578)（Quadrature）因此成为不可或缺的工具。然而，选择何种[求积法则](@entry_id:753909)、需要多少积分点，并非一个随意的决定。一个不恰当的选择可能导致结果严重偏离真实解，甚至引发数值不稳定性，使得计算结果毫无意义。本文旨在系统性地解决这一核心知识缺口：如何为[有限元分析](@entry_id:138109)选择合适的求积阶数以确保多项式被积函数的精确积分。

为实现这一目标，本文将分为三个紧密相连的章节。在“原理与机制”一章中，我们将深入探讨[数值求积](@entry_id:136578)的理论基础，建立“代数精度”的核心概念，并揭示[高斯求积](@entry_id:146011)等高效法则为何能以最少的计算量达到最高的积分精度。接着，在“应用与交叉学科联系”一章中，我们将理论付诸实践，通过分析不同物理问题（从[线性弹性](@entry_id:166983)到[非线性固体力学](@entry_id:171757)）和单元类型（从仿射到[曲边单元](@entry_id:748117)），展示如何确定所需的积分阶数，并探讨[减缩积分](@entry_id:167949)等高级技巧在解决[体积锁定](@entry_id:172606)等问题中的巧妙应用。最后，“动手实践”部分将提供一系列精心设计的编程练习，引导读者亲手构建和应用求积法则，将理论知识转化为解决实际问题的能力。

现在，让我们从第一章“原理与机制”开始，深入理解数值求积背后的数学原理，为后续的应用和实践打下坚实的基础。

## 原理与机制

在上一章引言中，我们了解了在有限元方法中，[单元刚度矩阵](@entry_id:139369)和质量矩阵等关键量的计算，最终都归结为在单元域上对函数（通常是多项式）进行积分。除了最简单的单元形状和函数，这些积分通常无法通过解析方法精确求解，因此必须依赖数值积分，也称为**求积** (quadrature)。本章旨在深入探讨数值求积的核心原理与机制，重点关注如何选择[求积法则](@entry_id:753909)以确保对多项式被积函数实现精确积分，以及这一选择对[有限元分析](@entry_id:138109)的准确性和稳定性的深远影响。

### [代数精度](@entry_id:143382)：精确积分的度量

[数值求积](@entry_id:136578)的核心目标是以可控的精度近似计算积分。一个通用的 $d$ 维[求积法则](@entry_id:753909)可以表示为在一个域 $\Omega$ 上的带权和形式：
$$
I[f] = \int_{\Omega} f(\boldsymbol{x}) \, d\boldsymbol{x} \approx \sum_{i=1}^{N} w_i f(\boldsymbol{x}_i) = Q[f]
$$
其中 $\boldsymbol{x}_i \in \Omega$ 是**求积点** (quadrature nodes)，$w_i \in \mathbb{R}$ 是对应的**[求积权重](@entry_id:753910)** (quadrature weights)。在有限元方法的背景下，被积函数 $f(\boldsymbol{x})$ 通常是多项式或有理函数。这就引出了一个核心概念：我们能否选择一组有限的求积点和权重，使得上述近似对于某一类重要的函数（即多项式）变为精确的等式？

这个问题的答案是肯定的，并催生了**[代数精度](@entry_id:143382)** (algebraic degree of exactness) 或称**精度阶** (degree of precision) 的概念。一个求积法则的[代数精度](@entry_id:143382)被定义为能够被该法则精确积分的**所有**多项式的最高**总次数** (total degree)。换言之，如果一个求积法则的[代数精度](@entry_id:143382)为 $m$，那么对于次数不超过 $m$ 的任意多项式 $p \in \mathbb{P}_m(\Omega)$，都有 $Q[p] = I[p]$ 成立，并且 $m$ 是满足此性质的最大整数 [@problem_id:2591951]。这里，$\mathbb{P}_m(\Omega)$ 代表在域 $\Omega$ 上所有总次数不超过 $m$ 的 $d$ 维多项式所构成的[线性空间](@entry_id:151108)。

需要强调的是，代数精度的定义是基于多项式的**总次数**，即各项单项式指数之和的最大值。例如，对于二维多项式 $p(x,y)$，其单项式 $x^{\alpha_1}y^{\alpha_2}$ 的总次数为 $\alpha_1+\alpha_2$。这与其他类型的多项式空间，如张量积空间（其次数由每个变量的最高次分别界定），有着本质的区别。我们将在后续章节中详细探讨这一差异。

### 精确性的实现机制：[矩匹配](@entry_id:144382)法

既然[代数精度](@entry_id:143382)的概念已经建立，下一个关键问题是：我们如何系统性地构建或验证一个[求积法则](@entry_id:753909)是否达到了某个特定的精度 $m$？由于积分算子 $I[\cdot]$ 和求积算子 $Q[\cdot]$ 都是线性的，一个重要的结论是：如果一个法则对[多项式空间](@entry_id:144410) $\mathbb{P}_m(\Omega)$ 的一组[基函数](@entry_id:170178)能够精确积分，那么它对该空间内的所有多项式都能精确积分 [@problem_id:2591924]。

这为我们提供了一个具体的实现机制。我们可以选择一组[基函数](@entry_id:170178) $\{\phi_j\}_{j=1}^{M}$，其中 $M = \dim(\mathbb{P}_m(\Omega))$ 是该[多项式空间](@entry_id:144410)的维度，然后要求对每一个[基函数](@entry_id:170178)，求积结果都与精确积分值相等。这构成了一个[方程组](@entry_id:193238)：
$$
\sum_{i=1}^{N} w_i \phi_j(\boldsymbol{x}_i) = \int_{\Omega} \phi_j(\boldsymbol{x}) \, d\boldsymbol{x}, \quad \text{for } j=1, \dots, M
$$
这个[方程组](@entry_id:193238)被称为**[矩匹配](@entry_id:144382)方程** (moment-matching equations)。对于给定的求积点 $\{\boldsymbol{x}_i\}$，这是一个关于未知权重 $\{w_i\}$ 的[线性系统](@entry_id:147850)。

最常用的[基函数](@entry_id:170178)是单项式基。例如：
-   在一维区间 $\Omega = [-1, 1]$ 上，要达到精度 $m$，我们需要对[基函数](@entry_id:170178) $\{1, x, x^2, \dots, x^m\}$ 精确积分，即满足 $m+1$ 个方程：
    $$
    \sum_{i=1}^{N} w_i x_i^k = \int_{-1}^{1} x^k \, dx, \quad \text{for } k=0, 1, \dots, m
    $$
    [@problem_id:2591924]
-   在二维三角域 $T \subset \mathbb{R}^2$ 上，要达到精度 $m$，我们需要对所有满足 $\alpha+\beta \le m$ 的单项式[基函数](@entry_id:170178) $\{x^\alpha y^\beta\}$ 精确积分 [@problem_id:2591924]。

那么，对于一个给定的精度 $m$ 和空间维度 $d$，总共需要满足多少个这样的[矩匹配](@entry_id:144382)条件呢？这个数量等于多项式空间 $\mathbb{P}_m(\mathbb{R}^d)$ 的维度。通过[组合数学](@entry_id:144343)中的“[隔板法](@entry_id:152143)”（stars and bars method），可以证明这个维度为：
$$
\dim(\mathbb{P}_m(\mathbb{R}^d)) = \binom{m+d}{d}
$$
[@problem_id:2591947]。这个公式量化了问题的规模。例如，要在三维空间（$d=3$）中精确积分所有二次多项式（$m=2$），我们需要满足 $\binom{2+3}{3} = \binom{5}{3} = 10$ 个独立的[矩匹配](@entry_id:144382)条件。

### [求积法则](@entry_id:753909)的存在性与最优性

[矩匹配](@entry_id:144382)[方程组](@entry_id:193238)引出了两个核心问题：这样的解（即求积点和权重）总是存在吗？如果存在，我们如何以最少的求积点达到尽可能高的精度？

#### 存在性保证：Tchakaloff 定理

一个深刻的数学结果，即 **Tchakaloff 定理**，为第一个问题提供了肯定的答案。该定理保证：对于任何[紧致域](@entry_id:139725) $K \subset \mathbb{R}^d$ 和一个正的[博雷尔测度](@entry_id:187965)（在我们的情况下，是标准[勒贝格测度](@entry_id:139781) $d\boldsymbol{x}$），要达到代数精度 $m$，必然存在一个[求积法则](@entry_id:753909)，其求积点数量 $N$ 不超过多项式空间的维度 $n = \dim(\mathbb{P}_m(K))$，并且所有求积点都位于域 $K$ 内部，所有权重都为正值 [@problem_id:2591955]。

这个定理具有重大的理论意义。它告诉我们，寻找一个具有有限点、正权重且点不出界的精确求积法则是完全可行的。例如，对于前面提到的在三维空间精确积分二次多项式的任务，Tchakaloff 定理保证存在一个点数 $N \le 10$ 的求积法则能够完成任务 [@problem_id:2591955]。

#### 最优性追求：高斯求积

Tchakaloff 定理给出了点数的[上界](@entry_id:274738)，但我们自然会问：能否用更少的点实现更高的精度？一个 $N$ 点的[求积法则](@entry_id:753909)在一维中有 $2N$ 个自由度（$N$ 个点的位置和 $N$ 个权重）。理论上，这 $2N$ 个自由度最多可以用来满足 $2N$ 个[矩匹配](@entry_id:144382)方程，即实现 $2N-1$ 的代数精度。

**高斯求积** (Gaussian quadrature) 奇迹般地实现了这个理论最优值。通过非常巧妙地选择求积点的位置（它们是一类[正交多项式](@entry_id:146918)的根），高斯求积法则可以用 $n$ 个点达到 $2n-1$ 的[代数精度](@entry_id:143382)。最著名的是一维区间 $[-1,1]$ 上的 **高斯-勒让德 (Gauss-Legendre) 求积**。

这个 $2n-1$ 的精度界限是极为严格的。我们可以构造一个 $2n$ 次的多项式来证明该法则在这一阶失效。考虑[勒让德多项式](@entry_id:141510) $P_n(x)$，其 $n$ 个根恰好是 $n$ 点[高斯-勒让德求积](@entry_id:138201)的节点。让我们构造多项式 $p(x) = [P_n(x)]^2$，其次数为 $2n$。由于在所有求积点上 $p(x_i)=0$，该法则计算的积分值为零。然而，其精确积分 $\int_{-1}^1 [P_n(x)]^2 dx = \frac{2}{2n+1}$ 是一个严格的正数。这个非零的积分值恰恰是求积的误差，它清晰地揭示了高斯求积精度的上限 [@problem_id:2591980]。

在实践中，还有其他类型的高斯求积法则。例如，**高斯-洛巴托 (Gauss-Lobatto) 求积** 将区间的两个端点 $\pm 1$ 强制作为求积点。为了满足这个约束，它牺牲了两个自由度，因此其[代数精度](@entry_id:143382)降为 $2n-3$。这种牺牲换来了一个重要的实际优势：在单元边界上有求积点，这极大地简化了边界条件的处理和跨单元通量的计算。在[谱元法](@entry_id:755171)等[高阶方法](@entry_id:165413)中，使用洛巴托点作为节点，可以使得[质量矩阵](@entry_id:177093)变为对角阵，从而极大地提高了[时间演化](@entry_id:153943)问题（如波动方程）的计算效率 [@problem_id:2591987]。

### [有限元分析](@entry_id:138109)中的求积

现在，我们将这些原理应用于有限元分析的实际计算中。单元矩阵的计算需要在参考单元 $\hat{K}$ 上进行，通过一个从参考坐标 $\boldsymbol{\xi}$ 到物理坐标 $\boldsymbol{x}$ 的**[等参映射](@entry_id:173239)** (isoparametric mapping) $\boldsymbol{x} = F(\boldsymbol{\xi})$。

考虑一个典型的标量[扩散](@entry_id:141445)问题（如[热传导](@entry_id:147831)）的刚度项：
$$
a(u,v) = \int_K \nabla_{\boldsymbol{x}} u \cdot \nabla_{\boldsymbol{x}} v \, d\boldsymbol{x}
$$
通过变量代换，该积分被转换到[参考单元](@entry_id:168425)上。梯度和体积微元的变化由映射的雅可比矩阵 $J(\boldsymbol{\xi}) = \nabla_{\boldsymbol{\xi}} F(\boldsymbol{\xi})$ 决定：
$$
\nabla_{\boldsymbol{x}} u = (J^{-1})^T \nabla_{\boldsymbol{\xi}} \hat{u}, \quad d\boldsymbol{x} = \det(J) \, d\boldsymbol{\xi}
$$
代入后，[刚度矩阵](@entry_id:178659)项的被积函数变为：
$$
I(\boldsymbol{\xi}) = (\nabla_{\boldsymbol{\xi}} \hat{\phi}_j)^T \left( \det J(\boldsymbol{\xi}) \cdot J(\boldsymbol{\xi})^{-1} J(\boldsymbol{\xi})^{-T} \right) \nabla_{\boldsymbol{\xi}} \hat{\phi}_i
$$
[@problem_id:2591923]。被积函数的性质完全取决于映射 $F$ 的性质。

#### [仿射映射](@entry_id:746332)单元

最简单的情况是当单元为直线边（2D）或平面（3D）时，映射 $F$ 是**仿射** (affine) 的。此时，$J$ 是一个常数矩阵。因此，$\det(J)$、 $J^{-1}$ 以及括号中的整个矩阵项都是常数。由于参考[基函数](@entry_id:170178) $\hat{\phi}_i$ 是多项式，它们的梯度也是多项式，所以整个被积函数 $I(\boldsymbol{\xi})$ 是一个多项式 [@problem_id:2591923]。在这种情况下，我们可以计算出该多项式的确切次数，并选择一个具有足够高[代数精度](@entry_id:143382)的[求积法则](@entry_id:753909)来实现精确积分。此外，对于[仿射映射](@entry_id:746332)，求积法则的代数精度是不变的：一个在参考单元上精度为 $m$ 的法则，在物理单元上同样保持精度 $m$ [@problem_id:2591951]。

#### 曲边（非仿射）单元

在更普遍的[曲边单元](@entry_id:748117)情况下，映射 $F$ 是一个高阶多项式（次数 $p \ge 2$）。这时，$J(\boldsymbol{\xi})$ 的元素是 $\boldsymbol{\xi}$ 的多项式，$\det(J)$ 也是多项式。然而，[矩阵的逆](@entry_id:140380) $J^{-1} = \text{adj}(J) / \det(J)$ 的元素是两个多项式的比值，即**[有理函数](@entry_id:154279)**。这导致[刚度矩阵](@entry_id:178659)的被积函数 $I(\boldsymbol{\xi})$ 通常是一个复杂的有理函数，而**不再是多项式** [@problem_id:2591923]。

这是一个至关重要的结论：**对于一般的[曲边单元](@entry_id:748117)，任何基于[多项式精确性](@entry_id:753577)的[求积法则](@entry_id:753909)（如高斯求积）都无法精确积分[刚度矩阵](@entry_id:178659)。** 这会引入所谓的**求积误差** (quadrature error)，它是有限元误差来源之一，有时被称为“变分犯罪”(variational crime)。

然而，质量矩阵的被积函数 $N_i N_j \det(J)$ 由于只涉及多项式 $N_i$ 和 $\det(J)$ 的乘积，因此它**仍然是一个多项式**。我们可以、也应该精确地积分它。例如，对于一个 $P_k$ 三角单元（使用总次数为 $k$ 的多项式[基函数](@entry_id:170178)），$\det(J)$ 的总次数最高为 $2k-2$，而 $N_i N_j$ 的总次数最高为 $2k$。因此，质量矩阵被积函数的总次数最高为 $2k + (2k-2) = 4k-2$。为了精确积分，我们必须选择一个代数精度 $t \ge 4k-2$ 的求积法则 [@problem_id:2591936]。

一个值得注意的特例是，即使映射非仿射，如果 $\det(J)$ 恰好为常数（即所谓的保体积或[保面积映射](@entry_id:268016)），那么[刚度矩阵](@entry_id:178659)的被积函数也将退化为多项式，从而可以被精确积分 [@problem_id:2591923]。

#### 张量积单元的特殊性

对于矩形或[六面体单元](@entry_id:174602)，通常使用张量积构造的[基函数](@entry_id:170178)（$\mathbb{Q}_p$ 空间）和[求积法则](@entry_id:753909)。这类法则的精度特性与总次数精度有所不同。一个由 $n$ 点一维高斯法则[张量积](@entry_id:140694)构成的 $n \times n$ 二维[求积法则](@entry_id:753909)，其精确性保证是针对**逐坐标次数** (coordinate-wise degree) 的。具体来说，它能精确积分所有满足 $\deg_x(p) \le 2n-1$ 和 $\deg_y(p) \le 2n-1$ 的多项式 $p(x,y)$ [@problem_id:2591989]。

这种保证与总次数保证有微妙但重要的区别。例如，一个 $2 \times 2$ 点的[高斯求积法](@entry_id:146011)则（$n=2$），其逐坐标精度为 $2(2)-1=3$。它能精确积分单项式 $x^3y^3$（总次数为 6），因为其 $x$ 次数和 $y$ 次数都为 3，未超过精度界限。但是，它无法精确积分单项式 $x^4$（总次数为 4），因为其 $x$ 次数 4 超过了 3 [@problem_id:2591997]。这个反直觉的例子凸显了[张量积法则](@entry_id:177156)的特性。

在实践中，为 $\mathbb{Q}_p$ 单元选择求积点数有一个简单而重要的准则。对于[常系数](@entry_id:269842)问题，质量矩阵和[刚度矩阵](@entry_id:178659)的被积函数中，每个坐标方向的最高次数均为 $2p$。为了确保精确积分，我们需要满足 $2n-1 \ge 2p$，即 $n \ge p + 1/2$。由于 $n$ 必须是整数，我们必须选择 $n=p+1$。这意味着，要精确积分 $\mathbb{Q}_p$ 单元的矩阵，需要在每个方向上使用至少 $p+1$ 个[高斯点](@entry_id:170251) [@problem_id:2591989]。