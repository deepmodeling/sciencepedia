{"hands_on_practices": [{"introduction": "共中心版图是实现精密模拟电路匹配的关键技术。本练习将通过计算一个简单但广泛应用的 A-B-B-A 线性排列的几何中心，让你亲眼见证如何通过对称地分割和排列器件，确保它们的质心重合。这是在存在工艺偏差的情况下实现良好匹配的几何基础 [@problem_id:1291323]。", "problem": "一位模拟电路设计师正在进行一个关键差分对的布局设计。该差分对由两个匹配的晶体管组成，我们称它们为晶体管1和晶体管2。为了改善对硅片上工艺变化的匹配特性，每个晶体管被分成两个相同的单元器件。晶体管1的单元器件标记为'A'，晶体管2的单元器件标记为'B'。\n\n所有四个单元器件都被建模为边长为 $L$ 的相同正方形。它们沿着x轴以线性阵列的方式彼此相邻放置，其中心位于直线 $y=0$ 上。从左到右的排列方式是 A-B-B-A。最左边的第一个'A'器件占据由 $0 \\le x \\le L$ 和 $-L/2 \\le y \\le L/2$ 定义的区域。\n\n假设每个单元器件的属性是均匀的，为了进行质心计算，其位置可以用其几何中心的一个点来表示。计算两个'A'器件组合的总几何质心坐标 $(x_A, y_A)$，以及两个'B'器件组合的总几何质心坐标 $(x_B, y_B)$。\n\n用 $L$ 表示你的答案。将你的最终答案以一个 $2 \\times 2$ 矩阵的形式呈现，其中第一行包含坐标 $(x_A, y_A)$，第二行包含坐标 $(x_B, y_B)$。", "solution": "问题要求计算两组器件'A'和'B'的几何质心，这些器件以线性的 A-B-B-A 模式排列。每个器件是边长为 $L$ 的正方形。一组相同物体的质心是各单个物体质心坐标的平均值。\n\n首先，我们来确定四个单元器件各自的几何中心坐标。这些器件从 $x=0$ 开始沿x轴连续放置，并以 $y=0$ 为中心。\n\n1.  **第一个'A'器件 (A1)：**\n    该器件占据区域 $0 \\le x \\le L$。其几何中心位于此区间的中点。\n    x坐标是 $x_{A1} = \\frac{0 + L}{2} = \\frac{L}{2}$。\n    y坐标是 $y_{A1} = 0$。\n    所以，A1的中心位于 $(\\frac{L}{2}, 0)$。\n\n2.  **第一个'B'器件 (B1)：**\n    该器件与 A1 相邻，占据区域 $L \\le x \\le 2L$。\n    x坐标是 $x_{B1} = \\frac{L + 2L}{2} = \\frac{3L}{2}$。\n    y坐标是 $y_{B1} = 0$。\n    所以，B1的中心位于 $(\\frac{3L}{2}, 0)$。\n\n3.  **第二个'B'器件 (B2)：**\n    该器件与 B1 相邻，占据区域 $2L \\le x \\le 3L$。\n    x坐标是 $x_{B2} = \\frac{2L + 3L}{2} = \\frac{5L}{2}$。\n    y坐标是 $y_{B2} = 0$。\n    所以，B2的中心位于 $(\\frac{5L}{2}, 0)$。\n\n4.  **第二个'A'器件 (A2)：**\n    该器件与 B2 相邻，占据区域 $3L \\le x \\le 4L$。\n    x坐标是 $x_{A2} = \\frac{3L + 4L}{2} = \\frac{7L}{2}$。\n    y坐标是 $y_{A2} = 0$。\n    所以，A2的中心位于 $(\\frac{7L}{2}, 0)$。\n\n现在，我们可以计算'A'器件组和'B'器件组的总质心。\n\n**'A'器件的质心，$(x_A, y_A)$：**\n'A'器件是 A1 和 A2。它们的组合质心是它们各自中心坐标的平均值。\n$$x_A = \\frac{x_{A1} + x_{A2}}{2} = \\frac{\\frac{L}{2} + \\frac{7L}{2}}{2} = \\frac{\\frac{8L}{2}}{2} = \\frac{4L}{2} = 2L$$\n$$y_A = \\frac{y_{A1} + y_{A2}}{2} = \\frac{0 + 0}{2} = 0$$\n因此，'A'器件的质心是 $(x_A, y_A) = (2L, 0)$。\n\n**'B'器件的质心，$(x_B, y_B)$：**\n'B'器件是 B1 和 B2。它们的组合质心是它们各自中心坐标的平均值。\n$$x_B = \\frac{x_{B1} + x_{B2}}{2} = \\frac{\\frac{3L}{2} + \\frac{5L}{2}}{2} = \\frac{\\frac{8L}{2}}{2} = \\frac{4L}{2} = 2L$$\n$$y_B = \\frac{y_{B1} + y_{B2}}{2} = \\frac{0 + 0}{2} = 0$$\n因此，'B'器件的质心是 $(x_B, y_B) = (2L, 0)$。\n\n两组器件的坐标是相同的，这就是共质心布局的原理。这确保了布局上器件属性的任何线性梯度都能同等地影响两个匹配的晶体管（A和B），从而最小化失配。\n\n最终答案应以一个 $2 \\times 2$ 矩阵的形式呈现。\n第一行是 $(x_A, y_A) = (2L, 0)$。\n第二行是 $(x_B, y_B) = (2L, 0)$。\n\n该矩阵是：\n$$\n\\begin{pmatrix}\n2L  0 \\\\\n2L  0\n\\end{pmatrix}\n$$", "answer": "$$\\boxed{\\begin{pmatrix} 2L  0 \\\\ 2L  0 \\end{pmatrix}}$$", "id": "1291323"}, {"introduction": "在建立了共中心的几何原理之后，我们现在来探讨其在电气性能上的优势。本练习模拟了一个实际场景，其中晶体管的阈值电压在晶圆上呈二次函数梯度变化。通过计算 A-B-B-A 布局下的阈值电压失配，你将从数学上证明该技术为何能完美消除工艺梯度中的线性分量，这也是它在精密模拟电路中被广泛应用的核心原因 [@problem_id:1291333]。", "problem": "在高精度模拟集成电路的设计中，减轻元件之间的失配至关重要。考虑一个由NMOS晶体管M_A和M_B组成的差分对，它们被制造在同一硅片上。为了最小化工艺梯度对其特性的影响，采用了一种称为A-B-B-A结构的一维共质心版图方案。\n\n该版图由四个沿x轴线性排列的晶体管“指”组成。第一个和第四个指是晶体管M_A的部分，而第二个和第三个指是晶体管M_B的部分。四个指中的每一个都具有相同的有源区宽度$W$。任意两个相邻指的边缘之间保持着$S$的均匀间距。\n\n某个特定的制造工艺导致阈值电压$V_{th}$产生空间变化，该变化可以通过位置$x$的二次函数精确建模：\n$$V_{th}(x) = V_0 + k_1x + k_2x^2$$\n其中$V_0$、$k_1$和$k_2$是与工艺相关的常数。\n\n多指晶体管（如M_A或M_B）的有效阈值电压定义为其各个指的有效阈值电压的算术平均值。单个指的有效阈值电压是$V_{th}(x)$在该指的物理宽度上的平均值。\n\n假设版图从第一个指（属于M_A）的左边缘位于$x=0$处开始，计算两个晶体管之间的残余阈值电压失配，定义为$\\Delta V_{th} = V_{th,A} - V_{th,B}$。将最终答案表示为包含$W$、$S$和任何相关工艺常数的符号表达式。", "solution": "设四个指沿x轴放置，相邻指之间的间距为$S$，宽度均为$W$。当第一个指的左边缘位于$x=0$时，各个指的左边缘位置$a$如下：\n- 第1指 (属于 $M_{A}$): $a_{1}=0$, 区间 $[0,W]$。\n- 第2指 (属于 $M_{B}$): $a_{2}=W+S$, 区间 $[W+S,2W+S]$。\n- 第3指 (属于 $M_{B}$): $a_{3}=2W+2S$, 区间 $[2W+2S,3W+2S]$。\n- 第4指 (属于 $M_{A}$): $a_{4}=3W+3S$, 区间 $[3W+3S,4W+3S]$。\n\n对于跨越区间 $x \\in [a,a+W]$ 的单个指，其有效阈值是其宽度上的平均值：\n$$\\bar{V}_{th}(a)=\\frac{1}{W}\\int_{a}^{a+W}\\left(V_{0}+k_{1}x+k_{2}x^{2}\\right)\\,dx.$$\n计算该积分可得，\n$$\\bar{V}_{th}(a)=V_{0}+k_{1}\\left(a+\\frac{W}{2}\\right)+k_{2}\\left(a^{2}+aW+\\frac{W^{2}}{3}\\right).$$\n\n因此，对于这四个指：\n$$\\bar{V}_{th}(a_{1})=V_{0}+\\frac{k_{1}}{2}W+\\frac{k_{2}}{3}W^{2},$$\n$$\\bar{V}_{th}(a_{2})=V_{0}+k_{1}\\left(W+S+\\frac{W}{2}\\right)+k_{2}\\left((W+S)^{2}+W(W+S)+\\frac{W^{2}}{3}\\right),$$\n$$\\bar{V}_{th}(a_{3})=V_{0}+k_{1}\\left(2W+2S+\\frac{W}{2}\\right)+k_{2}\\left((2W+2S)^{2}+W(2W+2S)+\\frac{W^{2}}{3}\\right),$$\n$$\\bar{V}_{th}(a_{4})=V_{0}+k_{1}\\left(3W+3S+\\frac{W}{2}\\right)+k_{2}\\left((3W+3S)^{2}+W(3W+3S)+\\frac{W^{2}}{3}\\right).$$\n\n每个多指器件的有效阈值是其两个指的平均值：\n$$V_{th,A}=\\frac{\\bar{V}_{th}(a_{1})+\\bar{V}_{th}(a_{4})}{2},\\qquad V_{th,B}=\\frac{\\bar{V}_{th}(a_{2})+\\bar{V}_{th}(a_{3})}{2}.$$\n\n整理$V_{th,A}$的各项，\n$$V_{th,A}=V_{0}+k_{1}\\left(\\frac{W}{2}+\\frac{3W+3S+W/2}{2}\\right)+k_{2}\\left(\\frac{\\frac{W^{2}}{3}+9(W+S)^{2}+3W(W+S)+\\frac{W^{2}}{3}}{2}\\right),$$\n化简得\n$$V_{th,A}=V_{0}+2k_{1}W+\\frac{3}{2}k_{1}S+k_{2}\\left(\\frac{1}{3}W^{2}+\\frac{9}{2}(W+S)^{2}+\\frac{3}{2}W(W+S)\\right).$$\n\n同样，对于$V_{th,B}$，\n$$V_{th,B}=V_{0}+k_{1}\\left(\\frac{W+S+W/2+2W+2S+W/2}{2}\\right)+k_{2}\\left(\\frac{(W+S)^{2}+W(W+S)+\\frac{W^{2}}{3}+4(W+S)^{2}+2W(W+S)+\\frac{W^{2}}{3}}{2}\\right),$$\n化简得\n$$V_{th,B}=V_{0}+2k_{1}W+\\frac{3}{2}k_{1}S+k_{2}\\left(\\frac{1}{3}W^{2}+\\frac{5}{2}(W+S)^{2}+\\frac{3}{2}W(W+S)\\right).$$\n\n因此，残余失配为\n$$\\Delta V_{th}=V_{th,A}-V_{th,B}=k_{2}\\left[\\left(\\frac{9}{2}-\\frac{5}{2}\\right)(W+S)^{2}+\\left(\\frac{3}{2}-\\frac{3}{2}\\right)W(W+S)+\\left(\\frac{1}{3}-\\frac{1}{3}\\right)W^{2}\\right]=2k_{2}(W+S)^{2}.$$\n由于采用了共质心ABBA布局，常数项和线性梯度项的贡献相互抵消，只留下一个与二次曲率成正比的残余项。", "answer": "$$\\boxed{2k_{2}\\left(W+S\\right)^{2}}$$", "id": "1291333"}, {"introduction": "尽管共中心版图技术十分强大，但它并非万能。本练习将探讨另一种由物理边缘效应引起的系统性失配，而这种失配是简单的共中心排列无法解决的。通过分析这种效应导致的输入失调电压，你将更深入地理解该技术的局限性，并领会为何在实践中常常需要采用如添加“虚拟”（dummy）器件等额外策略 [@problem_id:1291312]。", "problem": "一位模拟集成电路设计师正在实现一个由晶体管 $M_A$ 和 $M_B$ 组成的敏感NMOS差分对，该差分对用作一个高精度运算放大器的输入级。为了最小化随机失配，该设计师采用了一种共质心版图技术。具体来说，每个晶体管由两个相同的单元片段构成，这四个片段以 A B B A 的形式排列成一个线性阵列。在这种配置中，晶体管 $M_A$ 由两个外部片段并联而成，而晶体管 $M_B$ 由两个内部片段并联而成。阵列的两端没有使用哑元片段。\n\n由于工艺相关的边缘效应（例如机械应力或刻蚀变化），阵列外围片段的电学特性与内部片段存在系统性差异。已知对于这个特定工艺，两个最外层片段（`A` 片段）的电流因子 $\\beta = \\mu_n C_{ox} (W/L)$ 比内部片段（`B` 片段）的大一个分数 $\\epsilon$。也就是说，对于每个外部片段，$\\beta_A = \\beta_{unit}(1+\\epsilon)$，而对于每个内部片段，$\\beta_B = \\beta_{unit}$，其中 $\\beta_{unit}$ 是一个内部单元片段的标称电流因子。假定所有片段的阈值电压 $V_{th}$ 都相同。\n\n该差分对由一个提供恒定电流 $I_{SS}$ 的尾电流源偏置。当施加合适的输入电压以使输出归零时，发现内部晶体管 $M_B$ 工作在 $V_{OV,B}$ 的过驱动电压下。\n\n假设两个晶体管都工作在饱和区，请推导输入参考失调电压 $V_{OS} = V_{GS,A} - V_{GS,B}$ 的精确闭式表达式，用 $V_{OV,B}$ 和 $\\epsilon$ 表示。", "solution": "我们用平方律表达式来对每个处于饱和区的长沟道NMOS片段进行建模\n$$\nI_{D}=\\frac{1}{2}\\,\\beta\\,(V_{GS}-V_{th})^{2}=\\frac{1}{2}\\,\\beta\\,V_{OV}^{2},\n$$\n其中 $V_{OV}=V_{GS}-V_{th}$。每个复合晶体管是两个相同单元片段的并联，因此其有效电流因子是各片段电流因子之和。\n\n根据版图和边缘效应，每个外部片段的 $\\beta_{A,\\text{seg}}=\\beta_{unit}(1+\\epsilon)$，每个内部片段的 $\\beta_{B,\\text{seg}}=\\beta_{unit}$。因此，有效电流因子为\n$$\n\\beta_{A}=\\beta_{A,1}+\\beta_{A,2}=2\\,\\beta_{unit}(1+\\epsilon),\\qquad\n\\beta_{B}=\\beta_{B,1}+\\beta_{B,2}=2\\,\\beta_{unit}.\n$$\n\n在输出归零且负载匹配的条件下，漏极电流相等，所以每一侧承载的电流为 $I_{D,A}=I_{D,B}=I_{SS}/2$。对每个复合器件使用饱和电流公式可得\n$$\nI_{D,A}=\\frac{1}{2}\\,\\beta_{A}\\,V_{OV,A}^{2}=\\beta_{unit}(1+\\epsilon)\\,V_{OV,A}^{2},\\qquad\nI_{D,B}=\\frac{1}{2}\\,\\beta_{B}\\,V_{OV,B}^{2}=\\beta_{unit}\\,V_{OV,B}^{2}.\n$$\n令 $I_{D,A}=I_{D,B}$ 相等，可得\n$$\n\\beta_{unit}(1+\\epsilon)\\,V_{OV,A}^{2}=\\beta_{unit}\\,V_{OV,B}^{2}\n\\;\\;\\Longrightarrow\\;\\;\nV_{OV,A}=\\frac{V_{OV,B}}{\\sqrt{1+\\epsilon}}.\n$$\n\n输入参考失调电压定义为 $V_{OS}=V_{GS,A}-V_{GS,B}=(V_{th}+V_{OV,A})-(V_{th}+V_{OV,B})=V_{OV,A}-V_{OV,B}$。代入上述关系，得到精确的闭式表达式\n$$\nV_{OS}=V_{OV,B}\\left((1+\\epsilon)^{-1/2}-1\\right).\n$$\n对于 $\\epsilon>0$，此表达式为负，这反映了 $\\beta$ 值较高的一侧需要更小的栅极过驱动电压来传导相同的电流。", "answer": "$$\\boxed{V_{OV,B}\\left((1+\\epsilon)^{-1/2}-1\\right)}$$", "id": "1291312"}]}