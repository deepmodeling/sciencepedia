{"hands_on_practices": [{"introduction": "异步信号的核心问题在于其相对于时钟的到达时间不可预测。这种不确定性可能会违反触发器的建立时间 ($t_{su}$) 和保持时间 ($t_h$)，导致其进入亚稳态。本练习将帮助你精确定位可能发生亚稳态的“危险窗口”，将一个抽象的概念转化为一个具体的、可量化的风险。[@problem_id:1910774]", "problem": "一个数字系统使用一个同步8位二进制计数器，其设计为在系统时钟的每个上升沿递增，前提是其计数使能（`CEN`）输入被置为有效（逻辑'1'）。系统时钟的周期为 `T_CLK = 20 ns`。`CEN` 输入不是由外部信号直接驱动的。相反，为了缓解同步问题，一个外部异步信号 `ASYNC_ENABLE` 首先通过一个由系统时钟驱动的D型触发器（DFF）。该DFF的输出作为计数器的 `CEN` 信号。\n\n用于同步的DFF相对于系统时钟的上升沿，其建立时间为 `t_{su} = 2.0 ns`，保持时间为 `t_{h} = 1.0 ns`。对于本问题，DFF的传播延迟可以忽略不计。\n\n最初，`ASYNC_ENABLE` 信号和由此产生的 `CEN` 信号都稳定在逻辑'0'。在某个时刻，`ASYNC_ENABLE` 信号从'0'变为'1'。我们关心的是在此转换开始后的下一个时钟上升沿时计数器的行为。\n\n下面给出了 `ASYNC_ENABLE` 信号从低到高转换的几种可能的时间点，这些时间点都是相对于在 `t=0` 时刻发生的时钟上升沿。对于以下哪种情况，`t=0` 时刻时钟沿之后 `CEN` 信号的状态是不可预测的，可能由于亚稳态导致计数器错过一次递增或进入错误状态？选择所有适用的选项。\n\nA. 转换发生在 `t = -3.0 ns`。\n\nB. 转换发生在 `t = -1.5 ns`。\n\nC. 转换发生在 `t = 0.5 ns`。\n\nD. 转换发生在 `t = 2.0 ns`。", "solution": "D型触发器在 $t=0$ 时刻的时钟上升沿对 $D$ 进行采样。为了正确采样而不产生亚稳态，输入必须满足建立时间和保持时间的约束：\n$$\\text{D 在采样沿周围的 }[-t_{su},\\, t_{h}] \\text{ 区间内保持稳定。}$$\n等效地，如果异步转换时间 $t_{tr}$ 是相对于 $t=0$ 时的上升沿而言的，那么在时间窗口\n$$ -t_{su}  t_{tr}  t_h $$\n内的任何转换都会违反时序要求，并可能因亚稳态而使得时钟沿之后的输出 $Q$（即 $CEN$ 信号）变得不可预测。\n\n给定 $t_{su} = 2.0$ ns 和 $t_{h} = 1.0$ ns，不安全的时间窗口为\n$$ -2.0 \\text{ ns}  t_{tr}  1.0 \\text{ ns} \\quad (\\text{相对于 } t=0) $$\n\n评估每个选项：\n- A: $t_{tr} = -3.0$ ns 不在 $(-2.0, 1.0)$ 区间内，因此满足时序要求；状态是可预测的。\n- B: $t_{tr} = -1.5$ ns 位于 $(-2.0, 1.0)$ 区间内；违反了建立时间要求；状态不可预测。\n- C: $t_{tr} = 0.5$ ns 位于 $(-2.0, 1.0)$ 区间内；违反了保持时间要求；状态不可预测。\n- D: $t_{tr} = 2.0$ ns 不在 $(-2.0, 1.0)$ 区间内；满足时序要求；状态是可预测的。\n\n因此，在 $t=0$ 之后 `CEN` 状态不可预测的场景是 B 和 C。", "answer": "$$\\boxed{BC}$$", "id": "1910774"}, {"introduction": "在理解单个触发器为何会失效后，我们来探究其在系统层面的后果。本练习使用一个经典的异步纹波计数器作为例子，展示了信号之间的时序不匹配如何产生意外的瞬态。这些瞬态会导致下游的组合逻辑（如解码器）产生错误的输出脉冲，即“毛刺”，从而可能引发系统故障。[@problem_id:1910781]", "problem": "考虑一个数字系统，它由一个2位异步纹波计数器和一个2-4高电平有效译码器组成。该计数器由两个下降沿触发的T触发器FF0和FF1构成，它们的T输入端保持高电平，这使得它们在每个有效的时钟触发下翻转其输出。FF0产生最低有效位(LSB)，$Q_0$，FF1产生最高有效位(MSB)，$Q_1$。系统时钟连接到FF0的时钟输入端，而FF0的输出 $Q_0$ 连接到FF1的时钟输入端。每个触发器都具有相同的传播延迟 $t_{pd}$，该延迟是从其时钟输入下降沿到其输出状态改变之间的时间。\n\n计数器输出 $Q_1$ 和 $Q_0$ 分别直接连接到译码器的地址输入 $A_1$ 和 $A_0$。译码器有四个输出：$Y_0, Y_1, Y_2, Y_3$，其中当且仅当二进制输入 $\\langle A_1 A_0 \\rangle$ 对应于整数 $i$ 时，输出 $Y_i$ 为有效（逻辑高电平）。为简单起见，假设译码器本身是理想的，其输出能瞬时响应其输入的任何变化。\n\n计数器初始稳定在状态 $Q_1Q_0 = 01$（表示整数1）。在时间 $t=0$ 时，系统时钟上出现一个下降沿，启动向下一个计数状态 $Q_1Q_0 = 10$（表示整数2）的转换。由于纹波效应和触发器的传播延迟，系统在稳定下来之前会经过一个瞬态的、非预期的状态。\n\n在从稳定状态'1' (01)到最终稳定状态'2' (10)的整个转换序列中，哪条译码器输出线会产生一个虚假的瞬态高脉冲，通常称为毛刺？\n\nA. $Y_0$\n\nB. $Y_3$\n\nC. $Y_0$ 和 $Y_3$\n\nD. 不会产生虚假脉冲。\n\nE. 如果没有 $t_{pd}$ 的数值，则无法确定。", "solution": "问题要求确定在一个2位异步计数器从状态`01`转换到`10`期间，哪条译码器输出线会出现虚假脉冲（毛刺）。要解决这个问题，我们必须分析计数器输出端的状态序列，并密切关注传播延迟。\n\n1.  **初始状态 (对于 $t  0$):**\n    计数器处于稳定状态 $Q_1Q_0 = 01$。这些输出连接到译码器输入，因此 $A_1=0$ 且 $A_0=1$。译码器的功能是激活与二进制输入相对应的输出。对于输入`01`（表示整数1），译码器输出 $Y_1$ 为高电平。所有其他输出（$Y_0, Y_2, Y_3$）均为低电平。\n\n2.  **第一个事件 (在 $t=0$ 时):**\n    系统时钟的一个下降沿到达第一个触发器FF0的时钟输入端。由于它是一个T输入保持高电平的下降沿触发T触发器，它将翻转其输出 $Q_0$。\n\n3.  **第一个传播延迟和瞬态状态：**\n    $Q_0$ 的变化不是瞬时发生的。它在传播延迟 $t_{pd}$ 之后发生。因此，在时间 $t=t_{pd}$ 时，输出 $Q_0$ 从1翻转到0。\n    此时，第二个触发器FF1尚未动作。它的时钟输入是刚刚改变的FF0的输出 $Q_0$。所以，$Q_1$ 仍保持其初始值0。\n    从时间 $t=t_{pd}$ 开始，直到第二个触发器反应之前，计数器输出的状态是 $Q_1Q_0 = 00$。\n    这个`00`状态是一个瞬态的、非预期的中间状态。\n\n4.  **译码器对瞬态状态的响应：**\n    由于译码器是理想的，它会立即响应新的输入 $A_1=0, A_0=0$。此输入对应于整数0。因此，译码器使 $Y_1$ 变为无效，并激活输出 $Y_0$。输出 $Y_0$ 变为高电平。$Y_0$ 的这次激活就是虚假脉冲或毛刺的开始。\n\n5.  **第二个事件 (在 $t=t_{pd}$ 时):**\n    输出 $Q_0$ 从1变为0，在第二个触发器FF1的时钟输入端构成一个下降沿。\n\n6.  **第二个传播延迟和最终状态：**\n    FF1也是一个下降沿触发的T触发器，因此它将在其传播延迟 $t_{pd}$ 后翻转其输出 $Q_1$。这个状态变化发生在其时钟触发后的 $t_{pd}$ 时间，即在时间 $t = t_{pd} + t_{pd} = 2t_{pd}$。\n    在 $t=2t_{pd}$ 时，$Q_1$ 从0翻转到1。输出 $Q_0$ 自 $t=t_{pd}$ 以来一直是0，所以它保持为0。\n    因此，对于所有时间 $t \\ge 2t_{pd}$，计数器输出稳定在新的状态 $Q_1Q_0 = 10$。这是计数器正确的、预期的下一个状态。\n\n7.  **译码器对最终状态的响应：**\n    当输入稳定在 $A_1=1, A_0=0$（表示整数2）时，译码器使瞬态输出 $Y_0$ 变为无效，并激活最终正确的输出 $Y_2$。\n\n8.  **译码器输出行为总结：**\n    - 对于 $t  t_{pd}$，计数器状态为`01`，$Y_1$ 为高电平。\n    - 对于 $t_{pd} \\le t  2t_{pd}$，瞬态计数器状态为`00`。$Y_1$ 变为低电平，$Y_0$ 变为高电平。这就是毛刺。\n    - 对于 $t \\ge 2t_{pd}$，最终计数器状态为`10`。$Y_0$ 变为低电平，$Y_2$ 变为高电平。\n\n在从状态1到状态2的转换期间，译码器输出 $Y_0$ 本不应被激活，但它短暂地变为高电平，持续时间为 $t_{pd}$（从 $t=t_{pd}$ 到 $t=2t_{pd}$）。这在 $Y_0$ 线上构成了一个虚假脉冲。最终答案不依赖于 $t_{pd}$ 的具体数值，只要求其非零即可。", "answer": "$$\\boxed{A}$$", "id": "1910781"}, {"introduction": "既然我们已经了解了异步输入带来的问题，现在让我们来构建一个解决方案。最后的这个练习将从分析转向设计。假设一个异步输入已经被正确同步，本练习要求你为一个常见的应用——测量脉冲宽度——设计控制逻辑。这会巩固你在同步设计中的核心技能，如状态控制和边沿检测，这些都是可靠处理来自异步世界的信号所必需的。[@problem_id:1910750]", "problem": "您的任务是设计一个数字逻辑电路，用于测量单个高电平有效的异步输入脉冲 `PULSE_IN` 的持续时间。该持续时间必须以同步系统时钟 `CLK` 的周期数为单位进行测量。最终的计数值应保持在一个输出寄存器中，直到下一次测量开始。\n\n该电路必须使用以下预定义组件构建：\n- 一个 N 位同步加法计数器。它有一个时钟输入 `CLK`、一个同步高电平有效复位 `RESET` 和一个同步高电平有效计数使能 `COUNT_EN`。如果 `RESET` 被置为有效（高电平），计数器的输出将在 `CLK` 的下一个上升沿被强制置为零。如果 `RESET` 被置为无效（低电平）且 `COUNT_EN` 被置为有效，计数器将在 `CLK` 的下一个上升沿递增。`RESET` 信号的优先级高于 `COUNT_EN`。\n- 一个 N 位并行加载寄存器。它有一个时钟输入 `CLK` 和一个同步高电平有效加载使能 `LOAD`。当 `LOAD` 被置为有效时，该寄存器将在 `CLK` 的下一个上升沿捕获其并行数据输入。\n- D 型触发器（D-FFs）和标准逻辑门（与门、或门、非门）。\n\n为解决此问题，假设异步输入 `PULSE_IN` 已经通过一个两级同步器，生成了一个与 `CLK` 同步的信号 `PULSE_SYNC`。您还可以使用 `PULSE_SYNC_D`，它是 `PULSE_SYNC` 信号延迟一个 `CLK` 周期的结果（即，一个输入为 `PULSE_SYNC` 的 D 型触发器的输出）。\n\n计数器的数据输出连接到并行加载寄存器的数据输入。您的任务是确定控制信号 `RESET`（计数器）、`COUNT_EN`（计数器）和 `LOAD`（寄存器）的正确布尔逻辑表达式，以正确测量脉冲持续时间。\n\n下列哪组逻辑方程正确地实现了所需的功能？\n\nA.\n`COUNT_EN = PULSE_SYNC`\n`RESET = NOT(PULSE_SYNC)`\n`LOAD = PULSE_SYNC_D AND NOT(PULSE_SYNC)`\n\nB.\n`COUNT_EN = PULSE_SYNC`\n`RESET = PULSE_SYNC_D AND NOT(PULSE_SYNC)`\n`LOAD = NOT(PULSE_SYNC)`\n\nC.\n`COUNT_EN = PULSE_SYNC AND NOT(PULSE_SYNC_D)`\n`RESET = NOT(PULSE_SYNC)`\n`LOAD = PULSE_SYNC_D AND NOT(PULSE_SYNC)`\n\nD.\n`COUNT_EN = PULSE_SYNC`\n`RESET = NOT(PULSE_SYNC_D)`\n`LOAD = PULSE_SYNC`\n\nE.\n`COUNT_EN = PULSE_SYNC`\n`RESET = NOT(PULSE_SYNC)`\n`LOAD = NOT(PULSE_SYNC_D) AND PULSE_SYNC`", "solution": "我们希望计数器测量在 $\\text{PULSE\\_SYNC}$ 为高电平期间 $\\text{CLK}$ 的上升沿数量，然后在 $\\text{PULSE\\_SYNC}$ 的下降沿，让并行加载寄存器精确地捕获一次该计数值，并保持该值直到下一次测量开始。设延迟一个周期的信号为 $\\text{PULSE\\_SYNC\\_D}$。\n\n使用同步逻辑定义边沿检测器：\n$$\nE_{r}=\\text{PULSE\\_SYNC}\\land\\lnot\\text{PULSE\\_SYNC\\_D},\\quad\nE_{f}=\\text{PULSE\\_SYNC\\_D}\\land\\lnot\\text{PULSE\\_SYNC}.\n$$\n一个正确的方案必须满足以下条件：\n1) 当 $\\text{PULSE\\_SYNC}=1$ 时，计数器必须在每个周期递增。这要求\n$$\n\\text{COUNT\\_EN}=\\text{PULSE\\_SYNC}.\n$$\n任何与 $\\lnot\\text{PULSE\\_SYNC\\_D}$ 的门控逻辑都只会使计数器在第一个高电平周期计数，从而导致对多周期脉冲的计数偏低。\n\n2) 计数器在开始计数时必须为零。由于同步复位的优先级高于计数使能，最稳健的方法是在低电平期间保持计数器同步清零，然后在 $\\text{PULSE\\_SYNC}$ 变为高电平时立即释放复位，这样计数就能在第一个高电平周期立即开始。这得出\n$$\n\\text{RESET}=\\lnot\\text{PULSE\\_SYNC}.\n$$\n采用这种选择，在上升沿周期（$\\text{PULSE\\_SYNC}=1$, $\\text{PULSE\\_SYNC\\_D}=0$），$\\text{RESET}=0$ 且 $\\text{COUNT\\_EN}=1$，因此计数器在该上升沿上从 $0$ 递增到 $1$，正确地对第一个高电平周期进行了计数。在低电平周期，$\\text{RESET}=1$ 使计数器保持为零，为下一次测量做准备。\n\n3) 寄存器必须在 $\\text{PULSE\\_SYNC}$ 的下降沿精确捕获最终计数值，并且仅在该时刻捕获。同步下降沿的特征是 $(\\text{PULSE\\_SYNC\\_D},\\text{PULSE\\_SYNC})=(1,0)$，因此正确的加载信号是\n$$\n\\text{LOAD}=E_{f}=\\text{PULSE\\_SYNC\\_D}\\land\\lnot\\text{PULSE\\_SYNC}.\n$$\n在该时钟沿，$\\text{COUNT\\_EN}=0$ 且 $\\text{RESET}=1$。因为计数器和寄存器都是边沿触发的，寄存器采样的是计数器在边沿前的输出（即正确的最终计数值），而计数器的同步复位在边沿后生效，将其清零为下一次测量做准备，而不会破坏已加载的值。\n\n逐周期行为验证：\n- 上升沿周期：$(\\text{PULSE\\_SYNC},\\text{PULSE\\_SYNC\\_D})=(1,0)$ 得到 $\\text{COUNT\\_EN}=1$, $\\text{RESET}=0$, $\\text{LOAD}=0$。计数器从 $0$ 递增到 $1$。\n- 内部高电平周期：$(1,1)$ 得到 $\\text{COUNT\\_EN}=1$, $\\text{RESET}=0$, $\\text{LOAD}=0$。计数器继续每周期递增一次。\n- 下降沿周期：$(0,1)$ 得到 $\\text{COUNT\\_EN}=0$, $\\text{RESET}=1$, $\\text{LOAD}=1$。寄存器加载最终计数值；计数器在边沿后复位。\n- 之后的低电平周期：$(0,0)$ 得到 $\\text{COUNT\\_EN}=0$, $\\text{RESET}=1$, $\\text{LOAD}=0$。计数器保持为零；寄存器保持其值。\n\n在这些选项中，只有选项 A 与这些方程式匹配：\n$$\n\\text{COUNT\\_EN}=\\text{PULSE\\_SYNC},\\quad\n\\text{RESET}=\\lnot\\text{PULSE\\_SYNC},\\quad\n\\text{LOAD}=\\text{PULSE\\_SYNC\\_D}\\land\\lnot\\text{PULSE\\_SYNC}.\n$$\n选项 B、D 和 E 的 $\\text{LOAD}$ 时序不正确，而选项 C 除了在第一个高电平周期外都禁用了计数，导致计数偏低。", "answer": "$$\\boxed{A}$$", "id": "1910750"}]}