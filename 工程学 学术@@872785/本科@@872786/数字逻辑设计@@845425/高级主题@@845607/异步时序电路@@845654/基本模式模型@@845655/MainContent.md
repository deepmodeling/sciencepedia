## 引言
[异步时序电路](@entry_id:170735)因其在速度和功耗方面的潜在优势，在现代数字系统中扮演着越来越重要的角色。然而，与依赖全局时钟的[同步电路](@entry_id:172403)不同，[异步电路](@entry_id:169162)的状态由输入信号直接触发，这带来了复杂的时序挑战，使其设计与分析变得异常困难。为了驾驭这种复杂性，工程师和学者们开发了多种理论框架，其中，基本模式（Fundamental-mode）模型是最为基础和核心的一种。它提供了一套系统性的方法，用于理解、分析和设计可靠的异步系统，有效规避了诸多潜在的设计陷阱。

本文旨在深入剖析基本模式模型，解决异步设计中因时序不确定性而导致电路行为不可预测的核心问题。通过学习本文，您将掌握从理论到实践的全方位知识。文章将分为三个章节：
*   在“原理与机制”中，我们将探讨模型的核心假设、流程表分析方法，并详细拆解竞争、险象等关键时序风险及其消除机制。
*   在“应用与跨学科连接”中，我们将通过构建锁存器、仲裁器和通信协议等实例，展示该模型在数字逻辑、计算机体系结构等领域的实际应用。
*   最后，“动手实践”部分将提供具体练习，帮助您巩固所学知识，将理论应用于解决实际问题。

让我们首先深入探索这一模型的基石——其核心原理与机制。

## 原理与机制

与依赖于全局时钟信号来协调状态变化的[同步时序电路](@entry_id:175242)不同，[异步时序电路](@entry_id:170735)不使用全局时钟。其状态变化由输入信号的变化直接触发。这种操作模式带来了独特的优势，例如潜在的更高速度和更低的[功耗](@entry_id:264815)，但同时也引入了复杂的时序挑战。基本模式模型是分析和设计[异步时序电路](@entry_id:170735)最重要和最基础的框架之一。本章将深入探讨基本模式模型的原理、描述工具，以及在这种模式下可能出现的各种时序风险及其规避机制。

### [基本模式](@entry_id:165201)模型的核心假设

基本模式（Fundamental-mode）模型建立在一个核心的、理想化的时序假设之上，该假设极大地简化了[异步电路](@entry_id:169162)的行为分析。这个假设包含两个关键部分：

1.  **单输入变化（Single Input Change, SIC）**: 在任何时刻，只允许一个外部输入信号发生变化。
2.  **稳定要求（Stability Requirement）**: 在下一次输入变化发生之前，电路必须有足够的时间完全达到一个稳定的内部状态。

一个电路的**内部状态**由其存储元件（如[反馈回路](@entry_id:273536)中的延迟）的输出决定，我们通常用[状态变量](@entry_id:138790) $y_1, y_2, \dots, y_k$ 来表示。当外部输入 $x_1, x_2, \dots, x_n$ 和当前内部状态 $(y_1, \dots, y_k)$ 共同作用于电路的组合逻辑部分时，会产生一组**次态（Next State）**输出 $Y_1, Y_2, \dots, Y_k$。当对于给定的输入，次态和现态完全相同时，即 $Y_i = y_i$ 对所有 $i$ 成立，我们称电路处于**稳定状态（Stable State）**。否则，电路处于**[不稳定状态](@entry_id:197287)（Unstable State）**，并将自发地向新的状态转换，直到达到一个稳定状态。

稳定要求直接引出了一个实际的设计约束：两次连续输入变化之间必须存在一个最小时间间隔 $T_{min}$。这个间隔必须大于电路从接收输入变化到内部状态完全稳定所需的最长时间。这个最长[稳定时间](@entry_id:273984)由电路中最长的信号传播路径决定，包括[组合逻辑](@entry_id:265083)的延迟和[反馈回路](@entry_id:273536)的延迟。

例如，考虑一个由基本[逻辑门实现](@entry_id:167620)的[异步电路](@entry_id:169162)，其下一个状态 $Y'$ 由输入 $X_1$, $X_2$ 和当前状态 $Y$ 决定，其[布尔表达式](@entry_id:262805)为 $Y' = (X_1 \land Y) \lor (\overline{X_1} \land X_2)$。假设每个逻辑门（AND, OR, NOT）都有一个相同的传播延迟 $\tau$。为了计算 $T_{min}$，我们需要找到从任何输入变化到 $Y$ 最终稳定所需的最坏情况时间。信号从 $X_1$ 变化到最终影响 $Y'$ 可能通过两条路径：一条是 $X_1 \to \text{AND} \to \text{OR}$，延迟为 $2\tau$；另一条更长的路径是 $X_1 \to \text{NOT} \to \text{AND} \to \text{OR}$，总延迟为 $3\tau$。因此，在 $X_1$ 变化后，$Y$ 的值需要 $3\tau$ 的时间才能保证完全稳定。因此，为了满足[基本模式](@entry_id:165201)假设，输入变化的最小间隔 $T_{min}$ 必须至少为 $3\tau$ [@problem_id:1967895]。

如果基本模式的假设被违反，电路的行为可能会变得不可预测。特别是，当两个或更多输入“同时”变化时，由于物理路径延迟的微小差异，电路实际上会看到一个短暂的、非预期的中间输入状态。这可能导致电路进入一个完全错误的最终稳定状态。假设一个电路的初始稳定状态为 $y_1y_2=00$，对应输入 $x_1x_2=01$。现在，输入意图从 $01$ 变为 $10$。如果由于延迟差异，$x_2$ 先从 $1$ 变为 $0$，$x_1$ 再从 $0$ 变为 $1$，电路实际经历的输入序列是 $01 \to 00 \to 10$。电路首先响应 $01 \to 00$ 的变化并达到一个新的稳定状态（例如 $y_1y_2=01$），然后从这个新状态开始响应 $00 \to 10$ 的变化。这个中间步骤可能将电路引导至一个与直接从 $01$ 变为 $10$ 所预期的状态完全不同的最终稳定状态 [@problem_id:1967929]。这凸显了在设计和应用中严格遵守基本模式假设的重要性。

### 描述电路行为：状态与流程表

为了系统地分析和设计基本模式电路，我们需要一种形式化的工具来描述其行为。**流程表（Flow Table）**正是这样一种工具，它类似于[同步电路](@entry_id:172403)中的[状态转换表](@entry_id:163350)。流程表的行代表电路的内部状态，列代表所有可能的输入组合。表中的每个条目指示了在给定的“现态-输入”组合下的“次态”。

一个典型的例子是分析一个由两个交叉耦合的NOR门构成的电路，即一个基本的[SR锁存器](@entry_id:175834)。设门 $G_1$ 的输入为外部输入 $x_1$ 和来自 $G_2$ 输出的[状态变量](@entry_id:138790) $y_2$；门 $G_2$ 的输入为外部输入 $x_2$ 和来自 $G_1$ 输出的[状态变量](@entry_id:138790) $y_1$。因此，次态方程为 $Y_1 = \overline{x_1 + y_2}$ 和 $Y_2 = \overline{x_2 + y_1}$。为了找到所有的稳定状态，我们可以在每个可能的输入 $(x_1, x_2)$ 下，[求解方程组](@entry_id:152624) $y_1 = \overline{x_1 + y_2}$ 和 $y_2 = \overline{x_2 + y_1}$。例如，当输入为 $(0,0)$ 时，方程变为 $y_1 = \overline{y_2}$ 和 $y_2 = \overline{y_1}$，这给出了两个稳定状态解：$(y_1, y_2) = (1,0)$ 和 $(0,1)$。通过对所有四种输入组合进行分析，我们可以确定该电路总共有五个不同的稳定状态 [@problem_id:1967936]。这个过程展示了如何从底层门级结构推导出高层次的行为模型。

流程表中的条目分为两种：
- **稳定状态**: 次态与现态相同，通常在表中用圆圈或粗体标出。电路会一直保持在该状态，直到输入发生变化。
- **[不稳定状态](@entry_id:197287)**: 次态与现态不同。当输入变化导致电路进入一个[不稳定状态](@entry_id:197287)时，[状态变量](@entry_id:138790)将发生改变，电路会沿着流程表中的路径进行转换，直到达到一个新的稳定状态。

**[原始流程表](@entry_id:168105)（Primitive Flow Table）**是一种特殊的流程表，其每一行只包含一个稳定状态。它直接描述了从一个稳定状态因输入变化而转换到另一个（可能不稳定的）状态的过程。通过跟踪输入序列，我们可以预测电路的[状态和](@entry_id:193625)输出序列。例如，考虑一个具有五个内部状态 (S0-S4) 的电路，初始稳定在 S0 状态，输入为 $00$，输出 $Z=0$。当输入序列为 $01 \to 11 \to 10 \to \dots$ 时，我们可以逐步跟踪：
1.  输入变为 $01$：电路从 S0 转换到 S1，S1 在输入 $01$ 下是稳定的，输出 $Z=0$。
2.  输入变为 $11$：电路从 S1 转换到 S2，S2 在输入 $11$ 下是稳定的，输出 $Z=0$。
3.  输入变为 $10$：电路从 S2 转换到 S3，S3 在输入 $10$ 下是稳定的，输出 $Z=1$。
依此类推，我们可以确定整个输入序列对应的输出序列 [@problem_id:1967909]。

电路的输出也可以在流程表中定义。与同步[有限状态机](@entry_id:174162)类似，[异步电路](@entry_id:169162)的输出可以是**摩尔（Moore）型**或**米利（Mealy）型**。
- **摩尔型输出**仅取决于电路的当前状态。无论输入是什么，只要电路处于某个特定状态，其输出就是固定的。
- **米利型输出**则同时取决于当前[状态和](@entry_id:193625)当前输入。

在分析时，区分这两种输出类型至关重要。例如，如果一个输出 $Z_2$ 在状态 S0 时始终为 0，在状态 S1 或 S2 时始终为 1，那么 $Z_2$ 就是摩尔型输出，因为它只与状态有关。相反，如果另一个输出 $Z_1$ 在状态 S0 时，当输入为 $11$ 时值为 1，而当输入为 $00$ 时值为 0，那么 $Z_1$ 显然是米利型输出，因为它的值在同一状态下随输入变化而变化 [@problem_id:1967928]。

### [异步电路](@entry_id:169162)中的时序风险

尽管基本模式模型提供了一个清晰的框架，但物理实现的非理想性引入了多种时序风险（Hazards），可能导致电路行为偏离预期。

#### 竞争与[振荡](@entry_id:267781)

当一个状态转换需要两个或更多的[状态变量](@entry_id:138790)同时改变时，就会发生**竞争（Race）**。例如，从状态 `00` 转换到 `11`。由于物理电路中不存在绝对的“同时”，这些[状态变量](@entry_id:138790)会以不可预测的顺序先后改变。这个过程会导致电路短暂地进入一个或多个非预期的中间状态。

根据竞争的后果，我们可以将其分为两类：
- **非临界竞争（Non-critical Race）**: 如果无论状态变量以何种顺序变化，电路最终都能到达预期的稳定状态，则该竞争是非临界的。
- **临界竞争（Critical Race）**: 如果不同的变化顺序导致电路到达不同的稳定状态，或者最终到达一个非预期的稳定状态，则该竞争是临界的。临界竞争是严重的设计错误，必须被消除。

考虑一个从稳定状态 $(y_1, y_2)=(0,0)$（输入 $x=0$）开始的转换。当输入 $x$ 变为 $1$ 时，流程表要求状态变为 $(1,1)$ [@problem_id:1967910]。这是一个从 `00` 到 `11` 的转换，两个变量都需要改变，因此存在竞争。
- **路径1**: 如果 $y_1$ 先变，$00 \to 10$。假设在输入 $x=1$ 时，状态 `10` 是一个稳定状态。那么电路将错误地稳定在 `10`。
- **路径2**: 如果 $y_2$ 先变，$00 \to 01$。假设在输入 $x=1$ 时，状态 `01` 也是一个稳定状态。那么电路将错误地稳定在 `01`。
由于最终状态取决于变量变化的顺序，并且都未到达预期的 `11`，这是一个典型的临界竞争。

在[状态分配](@entry_id:172668)（为抽象状态赋予二进制编码）不当时，临界竞争很容易出现。例如，如果状态 $S_b$ (编码 `01`) 在输入变为 $11$ 时需要转换到状态 $S_c$ (编码 `10`)，这同样是一个需要 $y_1$ 和 $y_0$ 同时变化的竞争。如果 $y_0$ 先变，状态会先变为 `00` ($S_a$)，而 $S_a$ 在输入 $11$ 下可能是稳定的，导致电路停留在错误的 $S_a$ 状态，这就是一个临界竞争 [@problem_id:1967914]。

除了竞争，另一种严重的时序问题是**[振荡](@entry_id:267781)（Oscillation）**或**循环（Cycle）**。当一个输入变化导致电路进入一系列[不稳定状态](@entry_id:197287)，并且这个序列形成一个闭环，永远无法达到任何稳定状态时，就会发生[振荡](@entry_id:267781)。例如，从一个稳定状态出发，输入变化后，状态从 `00` 变成 `01`。在新的输入下，`01` 是不稳定的，要求变为 `11`。而 `11` 同样是不稳定的，又要求变回 `01`。于是电路就会在 `01` 和 `11` 之间无限[振荡](@entry_id:267781)，无法稳定下来 [@problem_id:1967899]。

#### 组合逻辑中的险象

[异步电路](@entry_id:169162)的可靠性不仅取决于状态转换的宏观时序，还取决于其内部组合逻辑部分的微观时序特性。[组合逻辑](@entry_id:265083)中存在的**险象（Hazard）**可能会在[反馈回路](@entry_id:273536)中被放大，导致状态错误。

险象是当单个输入变量变化时，本应保持恒定的组合逻辑输出出现短暂的错误毛刺（glitch）的现象。
- **静态险象（Static Hazard）**: 输出本应保持不变（恒为1或0），但却出现了一个短暂的相反脉冲。
  - **静态1险象**: 输出本应保持为1，但短暂地变为0再恢复为1。
  - **静态0险象**: 输出本应保持为0，但短暂地变为1再恢复为0。
- **动态险象（Dynamic Hazard）**: 输出本应只变化一次（从0到1或从1到0），但却变化了多次。

在[异步电路](@entry_id:169162)中，即使是纳秒级的毛刺也可能是致命的。如果这个毛刺出现在次态变量 $Y_i$ 上，[反馈回路](@entry_id:273536)可能会将其“锁存”为一个错误的状态位，从而导致整个电路进入错误的状态。

考虑一个次态函数 $Y = \overline{x_1}y + x_1x_2$。当状态 $y=1$、输入 $x_2=1$ 保持不变，而输入 $x_1$ 从 $0$ 变为 $1$ 时，我们期望 $Y$ 保持为 $1$ (初始时 $Y=1\cdot1+0\cdot1=1$，结束后 $Y=0\cdot1+1\cdot1=1$)。然而，在 $x_1$ 从 $0 \to 1$ 的过渡期间，由于传播延迟的差异，可能存在一个极短的瞬间，乘积项 $\overline{x_1}y$ 因为 $\overline{x_1}$ 变为 $0$ 而先变为 $0$，而乘积项 $x_1x_2$ 尚未因为 $x_1$ 变为 $1$ 而更新为 $1$。这导致两个乘积项同时为 $0$，从而使 $Y$ 产生一个向下的毛刺。这就是一个静态1险象。为了消除它，我们可以使用[卡诺图](@entry_id:264061)分析，找到覆盖了这次转换的两个[最小项](@entry_id:178262)（$\overline{x_1}x_2y$ 和 $x_1x_2y$）之间的“空隙”，并添加一个冗余的**共识项（consensus term）** $x_2y$ 来“桥接”这个空隙。修正后的函数 $Y = \overline{x_1}y + x_1x_2 + x_2y$ 在此转换期间将始终保持为 $1$，从而消除了险象 [@problem_id:1967923]。

由[组合逻辑](@entry_id:265083)险象引发的错误可以是微妙而严重的。一个在理想情况下没有竞争的“安全”状态转换，可能因为一个静态险象而变成一个临界竞争。例如，一个从状态 $(0,1)$ 到 $(0,0)$ 的转换，理想情况下只有 $y_2$ 改变。但如果[次态逻辑](@entry_id:164866) $Y_1$ 存在一个静态0险象，导致 $Y_1$ 在转换期间短暂地跳到 $1$，这个毛刺就可能使[状态变量](@entry_id:138790) $y_1$ 错误地翻转。如果这个错误翻转比 $y_2$ 的正确变化更快，电路状态可能会先变为 $(1,1)$。如果 $(1,1)$ 在当前输入下恰好是一个稳定状态，电路就会被困在这个错误的状态，从而导致一次由险象引发的临界竞争 [@problem_id:1967908]。

#### 本质险象

**本质险象（Essential Hazard）**是一种更深层次的险象，它不依赖于具体的[逻辑实现](@entry_id:173626)或[状态分配](@entry_id:172668)，而是由流程表本身的结构决定的。它描述了一种特定的竞争——输入信号在电路中的传播与状态变化信号在[反馈回路](@entry_id:273536)中的传播之间的竞争。

一个标准的检测方法是：从一个稳定状态开始，如果单个输入变化导致的最终稳定状态，与该输入变量连续变化三次（例如 $x: 0 \to 1 \to 0 \to 1$）导致的最终稳定状态不同，则存在本质险象。

让我们分析一个例子 [@problem_id:1967921]。电路从稳定状态 $(y_1y_2=00, x=0)$ 开始。
- **单次变化**: 输入 $x$ 从 $0 \to 1$。流程表指示转换路径为 $00 \to 01$。状态 $01$ 在 $x=1$ 时是稳定的。最终状态为 `01`。
- **三次变化**: 输入序列为 $x: 0 \to 1 \to 0 \to 1$。
  1.  $x: 0 \to 1$: 状态从 $00 \to 01$ (稳定)。
  2.  $x: 1 \to 0$: 从 $01$ 出发，状态变为 $11$ (稳定)。
  3.  $x: 0 \to 1$: 从 $11$ 出发，状态变为 $10$ (稳定)。
最终状态为 `10`。

由于单次变化和三次变化导致了不同的最终稳定状态 (`01` vs `10`)，该流程表在从 $(00, x=0)$ 开始的 $x$ 变化中存在本质险象。其物理原因是，当输入 $x$ 变化时，如果这个变化信号传播到某些[次态逻辑](@entry_id:164866)门的速度，比状态变化（例如 $y_1$ 变化）通过[反馈回路](@entry_id:273536)再反馈回来的速度还要慢，那么旧的输入值和新的状态值可能会同时存在于组合逻辑中，导致错误的次态输出。解决本质险象通常需要在反馈路径中插入延迟元件，以确保输入变化在整个电路中先生效。

### [状态分配](@entry_id:172668)与无风险设计

消除[异步电路](@entry_id:169162)中的时序风险，特别是临界竞争，是设计的核心挑战。其中，**[状态分配](@entry_id:172668)（State Assignment）**——即为流程表中的抽象状态（S0, S1, ...）分配合适的二进制编码——起着决定性作用。

一个理想的**无竞争状态分配**的目标是：任何在流程表中需要直接转换的两个状态，都被赋予**邻接（adjacent）**的二[进制](@entry_id:634389)编码（即汉明距离为1）。这样，每次状态转换只涉及一个状态变量的变化，从根本上消除了竞争的发生。

然而，对于一个给定的流程表，使用最少数目的[状态变量](@entry_id:138790)（$k = \lceil\log_2 N\rceil$ 个变量用于 $N$ 个状态）来实现无竞争分配并非总是可能的。我们可以通过构建一个**状态邻接图**来判断其可行性。图的节点是状态，如果两个状态间存在转换，则在它们之间连一条边。然后，我们需要判断这个图是否能嵌入到一个 $k$ 维布尔[超立方体](@entry_id:273913)中（其中顶点是二进制编码，边代表邻接关系）。

考虑一个有4个状态的流程表，需要 $k=\lceil\log_2 4\rceil = 2$ 个[状态变量](@entry_id:138790)。分析流程表，我们可能发现状态1必须与状态2、3、4都邻接，而状态3必须与状态1、2、4都邻接。这意味着在邻接图中，节点1和节点3的度（连接的边数）都为3。然而，2个变量所能形成的2维[超立方体](@entry_id:273913)（一个正方形）中，每个[顶点的度](@entry_id:264944)最大为2。因此，不可能将这个邻接图嵌入到2维立方体中。这证明，对于这个流程表，使用2个[状态变量](@entry_id:138790)的任何[状态分配](@entry_id:172668)都无法满足所有的邻接要求，因此必然存在竞争。进一步分析可以表明，这些不可避免的竞争是临界的，会导致错误的稳定状态 [@problem_id:1967902]。

当无法用最少变量实现无竞争分配时，设计者必须采用更高级的技术，例如：
1.  **增加[状态变量](@entry_id:138790)**: 引入冗余的状态变量可以提供更多的邻接关系（例如，3个变量构成一个3维立方体，每个顶点度为3），从而满足更复杂的邻接要求。
2.  **插入中间状态**: 在导致竞争的转换之间手动插入一个或多个不稳定的中间状态，将一个多变量变化的转换分解为一系列单变量变化的转换。

总之，[基本模式](@entry_id:165201)[异步电路](@entry_id:169162)的设计是一个在功能、速度和可靠性之间进行权衡的复杂过程。它要求设计者不仅要理解理想化的行为模型，还必须深刻洞察物理实现中固有的各种时序风险，并掌握系统化的方法来分析和消除这些风险。