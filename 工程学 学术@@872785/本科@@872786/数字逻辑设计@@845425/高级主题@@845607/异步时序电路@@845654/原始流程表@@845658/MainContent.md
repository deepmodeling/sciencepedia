## 引言
与依赖于[时钟信号](@entry_id:174447)进行同步的数字系统不同，[异步时序电路](@entry_id:170735)直接由输入信号的变化驱动，这种无时钟的操作模式带来了独特的复杂性和设计挑战。如何才能系统地描述和预测一个没有全局节拍器的电路的行为？这正是**[原始流程表](@entry_id:168105) (Primitive Flow Table)** 发挥关键作用的地方。作为[异步电路设计](@entry_id:172174)与分析的基石，[原始流程表](@entry_id:168105)提供了一种形式化的语言，用以精确捕捉事件驱动系统的动态特性。

本文旨在全面解析[原始流程表](@entry_id:168105)，填补从理论概念到实际应用之间的知识鸿沟。我们将深入探讨这一核心工具，从其基本构成到高级应用，为读者构建一个坚实的知识框架。在接下来的章节中，你将学习到：

在“**原理与机制**”一章中，我们将剖析[原始流程表](@entry_id:168105)的结构，理解稳定态与非稳定态的核心概念，并揭示导致电路行为不可预测的“[竞争条件](@entry_id:177665)”现象。接着，在“**应用与跨学科连接**”中，我们将展示如何运用流程表来设计从简单的记忆元件到复杂的通信协议控制器等一系列实际电路，让你看到理论如何转化为工程实践。最后，“**动手实践**”部分将通过一系列精心设计的问题，引导你亲手构建流程表，解决具体的设计挑战，从而巩固所学知识。

让我们首先进入第一章，深入探索构成[原始流程表](@entry_id:168105)的基本原理和工作机制。

## 原理与机制

与依赖于全局时钟信号进行同步状态转换的[同步时序电路](@entry_id:175242)不同，[异步时序电路](@entry_id:170735)的行为由其输入信号的变化直接驱动。这种操作模式带来了独特的挑战和设计考量。为了系统地描述和分析[异步电路](@entry_id:169162)的行为，我们使用一种称为**[原始流程表](@entry_id:168105) (Primitive Flow Table)** 的工具。本章将深入探讨[原始流程表](@entry_id:168105)的结构、工作原理及其在分析电路动态行为中的应用。

### [原始流程表](@entry_id:168105)的基本结构

[原始流程表](@entry_id:168105)是描述[异步时序电路](@entry_id:170735)状态转换和输出行为的表格。它将电路的**现态 (present state)**、**输入 (input)** 与其**次态 (next state)** 和**输出 (output)** 关联起来。

表的每一行代表一个电路的内部状态，通常用字母（如 A, B, C, ...）表示。表的每一列对应一个唯一的输入组合（例如，对于两个输入 $x_1$ 和 $x_2$，列可以表示为 $x_1x_2 = 00, 01, 11, 10$）。表中的每个单元格则定义了在给定的现态（行）和输入（列）下的次态和输出。

#### 稳[定态](@entry_id:137260)与非稳定态

在[异步电路](@entry_id:169162)中，一个核心概念是**稳[定态](@entry_id:137260) (stable state)**。当电路处于某个状态，且其输入保持不变时，如果电路的次态与现态相同，那么该状态对于此输入组合就是稳定的。换言之，电路将“停留”在该状态，直到下一次输入变化发生。在流程表中，稳定态通常用圆圈或括号括起来，以示突出。

如果一个单元格中的次态与该行所代表的现态不同，则该状态被称为**非稳[定态](@entry_id:137260) (unstable state)**。当电路进入一个非稳定态时，它会立即开始向该单元格所指定的次态转换，而输入保持不变。

例如，考虑一个具有单个输入 $x$ 和四个内部状态 A、B、C、D 的电路。通过检查流程表的定义，我们可以识别出所有的稳定态。如果对于现态 $y$ 和输入 $x$，其次态 $Y$ 满足 $Y=y$，则该组合 $(y, x)$ 构成一个稳[定态](@entry_id:137260)。我们可以将每个稳定态及其对应的输出 $z$ 表示为一个三元组 $(y, x, z)$。

- 状态 A，输入 $x=0$ 时，次态为 A，输出为 $z=0$。这是一个稳定态：(A, 0, 0)。
- 状态 B，输入 $x=1$ 时，次态为 B，输出为 $z=1$。这是一个稳[定态](@entry_id:137260)：(B, 1, 1)。
- 状态 C，输入 $x=0$ 时，次态为 C，输出为 $z=1$。这是一个稳[定态](@entry_id:137260)：(C, 0, 1)。
- 状态 D，输入 $x=1$ 时，次态为 D，输出为 $z=1$。这是一个稳[定态](@entry_id:137260)：(D, 1, 1)。

其他所有组合，如状态 A 在输入 $x=1$ 时次态为 B，都是非稳[定态](@entry_id:137260)。因此，该电路共有四个稳定态 [@problem_id:1953737]。通过系统地扫描整个表格，我们可以统计出稳[定态](@entry_id:137260)的总数。例如，在一个具有六个[状态和](@entry_id:193625)四种输入组合的电路中，通过逐行检查次态是否等于现态，我们可以累加所有稳定单元格的数量 [@problem_id:1953713]。

### 状态转换与基本模式操作

[异步电路](@entry_id:169162)的设计通常遵循**[基本模式](@entry_id:165201) (fundamental mode)** 操作假设。该模型包含两个关键约束：
1.  **单输入变化**：一次只允许一个输入信号发生改变。
2.  **电路稳定**：在下一次输入变化发生之前，电路必须有足够的时间完成所有内部状态转换并达到一个新的稳定态。

电路的状态转换过程遵循一个清晰的逻辑序列。当输入发生变化时，电路从当前行的一个稳[定态](@entry_id:137260)“水平”移动到新输入对应的列。如果该单元格是一个非稳[定态](@entry_id:137260)，电路将“垂直”地沿着该列进行转换，即内部状态会根据每个非稳[定态](@entry_id:137260)单元格的指示进行改变，直到最终到达一个稳[定态](@entry_id:137260)单元格。

让我们通过一个例子来追踪这个过程。假设一个电路初始处于状态 `a` 和输入 $x_1x_2 = 00$ 的稳[定态](@entry_id:137260)。此时，输入变为 $x_1x_2 = 01$ [@problem_id:1953708]。
1.  **输入变化**：电路从状态 `a`，输入 `00` 的稳定位置，转移到同一行（状态 `a`），但新列（输入 `01`）的位置。
2.  **第一次转换**：流程表指示在（状态 `a`，输入 `01`）处，次态是 `b`，这是一个非稳定态。因此，电路的内部状态从 `a` 变为 `b`。
3.  **第二次转换**：现在电路处于状态 `b`，而输入仍为 `01`。我们查找（状态 `b`，输入 `01`）对应的单元格，表指示次态为 `c`，这仍然是一个非稳[定态](@entry_id:137260)。于是，电路的内部状态从 `b` 变为 `c`。
4.  **达到稳定**：电路现在处于状态 `c`，输入仍为 `01`。查找（状态 `c`，输入 `01`）的单元格，表指示次态为 `c`。这是一个稳[定态](@entry_id:137260)。电路的转换过程结束，并稳定在状态 `c`。

整个转换序列可以描述为 $a \rightarrow b \rightarrow c$。这个过程可能包含多个中间步骤，如从一个初始稳定态 $S_3$（输入为 $10$）开始，当输入变为 $00$ 时，电路可能会经历一系列内部转换，如 $S_3 \rightarrow S_1 \rightarrow S_0$，最终在 $S_0$ 达到稳定 [@problem_id:1953728]。当面对一个输入序列时，电路会从一个稳[定态](@entry_id:137260)转换到下一个稳定态，每一步都遵循上述的转换规则 [@problem_id:1953736]。

### 输出与电路分类

[原始流程表](@entry_id:168105)不仅定义状态转换，还指定了电路的输出。根据输出的生成方式，[异步电路](@entry_id:169162)可以分为**米里 (Mealy)** 型和**摩尔 (Moore)** 型。

-   **摩尔型电路**：输出仅取决于电路的**现态**。在流程表中，这意味着对于任何给定的行（即现态），所有指定输出的值都必须相同。
-   **米里型电路**：输出取决于**现态**和**当前输入**。在流程表中，这意味着在同一行中，至少有两个不同输入列的输出值是不同的。

通过检查流程表中的输出值，我们可以轻松地对电路进行分类。例如，考虑一个流程表，其中状态 A 的所有指定输出都是 `0`。仅看这一行，它符合摩尔模型的特征。然而，如果我们在状态 B 所在的行中发现，当输入为 $x_1x_2=00$ 时输出为 `0`，而当输入为 $x_1x_2=11$ 时输出为 `1`，那么输出显然依赖于输入。只要存在任何一个状态（行）其输出值随输入变化而变化，整个电路就被归类为米里型电路 [@problem_id:1953714]。

### 假设与未指定项

[原始流程表](@entry_id:168105)的设计和分析严格依赖于基本模式操作的假设，特别是**单输入变化假设**。这意味着从任意一个输入组合到另一个输入组合的转换，其**汉明距离 (Hamming distance)** 不能大于1。例如，从输入 $I_1I_0 = 01$ 开始，合法的下一个输入只能是 $00$（$I_0$ 变化）或 $11$（$I_1$ 变化）。

同时改变两个或更多输入的转换（如从 $01$ 变为 $10$）是被禁止的，因为它们的汉明距离为2。由于这种转换在模型中被视为“不可能发生”，因此流程表中对应的单元格（例如，在对应于输入 $01$ 稳定的那一行中，输入 $10$ 所在的列）的行为是无关紧要的。这些条目因此被标记为**[无关项](@entry_id:165299) (don't care)**，通常用破折号（`--`）表示。这并不是因为该转换会产生[振荡](@entry_id:267781)或竞争，而是因为它在理论模型下根本不会发生 [@problem_id:1953709]。

### 异步[电路中的[竞争条](@entry_id:178469)件](@entry_id:177665)

尽管[基本模式](@entry_id:165201)的假设简化了设计，但现实世界中的物理延迟会引发一些复杂问题，即**[竞争条件](@entry_id:177665) (race conditions)**。竞争是指两个或多个信号路径同时发生变化，而由于物理电路中不可避免的延迟差异，这些变化的到达顺序变得不确定。

#### 输入竞争

当违背单输入变化假设，即多个输入信号同时改变时，就会发生**输入竞争 (input race)**。例如，假设电路稳定于状态 `a`，输入为 $x_1x_2 = 00$。如果 $x_1$ 和 $x_2$ 同时变为 $1$，理论上的目标输入是 $11$ [@problem_id:1953721]。然而，由于[信号传播延迟](@entry_id:271898)的微小差异，电路可能会先感知到 $x_1$ 的变化（输入变为 $10$），也可能先感知到 $x_2$ 的变化（输入变为 $01$）。

-   **路径1**：如果先检测到 $x_1$ 变化，输入序列为 $00 \rightarrow 10 \rightarrow 11$。电路可能会先稳定在输入 $10$ 的某个状态（例如 `d`），然后再转换到输入 $11$ 的最终稳[定态](@entry_id:137260)（例如 `e`）。
-   **路径2**：如果先检测到 $x_2$ 变化，输入序列为 $00 \rightarrow 01 \rightarrow 11$。电路可能会先稳定在输入 $01$ 的某个状态（例如 `b`），然后再转换到输入 $11$ 的另一个最终稳[定态](@entry_id:137260)（例如 `c`）。

由于最终的稳定状态取决于哪个输入变化先被电路感知，电路的行为变得不可预测。这种由于多输入同时变化导致最终状态不确定的情况就是输入竞争。

#### [状态变量](@entry_id:138790)竞争

即使输入遵循单输入变化规则，竞争也可能在电路内部发生。这通常发生在状态转换需要多个**[状态变量](@entry_id:138790) (state variables)**（例如，[触发器](@entry_id:174305)的输出 $y_1, y_2, \dots$）同时改变时。例如，如果一个状态转换要求电路从状态 `p`（编码为 $y_1y_2=00$）转换到状态 `q`（编码为 $y_1y_2=11$），则两个[状态变量](@entry_id:138790) $y_1$ 和 $y_2$ 都必须改变。由于门延迟的差异，$y_1$ 和 $y_2$ 的变化顺序是不确定的，从而引发**[状态变量](@entry_id:138790)竞争 (state variable race)**。

状态变量竞争可以分为两类：

1.  **非临界竞争 (Non-Critical Race)**：如果无论[状态变量](@entry_id:138790)以何种顺序变化，电路最终都会到达相同的稳[定态](@entry_id:137260)，那么这种竞争就是非临界的。例如，在某个输入下，状态 `A` 和 `E` 都是非稳[定态](@entry_id:137260)，并且它们的目标次态都是同一个稳[定态](@entry_id:137260) `F`。即使在从 `A` 或 `E` 转换到 `F` 的过程中存在中间状态的竞争，只要所有可能的转换路径都最终汇合到 `F`，电路的行为就是可预测的。这种竞争通常是无害的 [@problem_id:1953725]。

2.  **临界竞争 (Critical Race)**：如果[状态变量](@entry_id:138790)的变化顺序决定了电路将进入哪个不同的稳[定态](@entry_id:137260)，那么这种竞争就是临界的。临界竞争是严重的设计缺陷，必须被消除。

让我们通过一个例子来具体分析临界竞争 [@problem_id:1953690]。假设状态赋值为 $p=00, q=11, r=01, s=10$。电路初始处于状态 `p`（$00$），输入为 $00$。当输入变为 $01$ 时，流程表要求电路从 `p` 转换到 `q`（即从 $00$ 转换到 $11$）。这个转换的[汉明距离](@entry_id:157657)为2，因此存在状态变量竞争。

-   **可能性1**：$y_1$ 先从 $0$ 变为 $1$。中间状态为 $10$（状态 `s`）。现在电路处于状态 `s`，输入为 $01$。查表可知，此时次态为 `q`。电路将继续转换到 `q`（$11$），并最终稳定在 `q`。
-   **可能性2**：$y_2$ 先从 $0$ 变为 $1$。中间状态为 $01$（状态 `r`）。现在电路处于状态 `r`，输入为 $01$。查表可知，这是一个稳定态 `(r)`。电路将停止转换并稳定在 `r`。

由于两个不同的变化顺序导致了两个不同的最终稳[定态](@entry_id:137260)（`q` 或 `r`），这就是一个临界竞争。这种不确定性使得电路行为不可靠，因此在设计阶段必须通过合理的[状态分配](@entry_id:172668)（例如，使用相邻分配使转换的汉明距离为1）或引入新的中间状态来避免。