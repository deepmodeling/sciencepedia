{"hands_on_practices": [{"introduction": "掌握定点数的第一步是学习如何在二进制层面表示和操作它们。本练习将带你完成将正负十进制数转换为特定的有符号Q格式，并执行基本的加法运算。通过这个实践，你将巩固对定点数表示法和二进制补码运算核心机制的理解。[@problem_id:1935892]", "problem": "一个简单的嵌入式系统使用一个专用的数字信号处理器（DSP）来处理传感器数据。该DSP使用有符号8位定点格式表示所有数字，具体为Q4.4格式。在这种约定中，一个数有4位用于整数部分（包括一位符号位），4位用于小数部分。负数使用二进制补码表示。\n\n该系统获取一个原始传感器读数，并向其添加一个预定的校准偏移量。在某个特定实例中，原始传感器读数等效于十进制值$5.75$，校准偏移量等效于十进制值$-2.25$。\n\nDSP对这两个值执行加法运算。最终代表校准后值的Q4.4格式的8位二进制字符串是什么（不含任何空格或小数点）？\n\n从以下选项中选择正确的选项：\nA. `00111000`\n\nB. `00110111`\n\nC. `01111100`\n\nD. `11011100`\n\nE. `11001000`", "solution": "在Q4.4定点表示法和二进制补码中，一个8位存储的整数$N$通过$v = \\frac{N}{2^{4}}$表示实数值$v$，反之$N = v \\cdot 2^{4}$。加法运算在存储的整数上进行，模$2^{8}$运算，并丢弃进位。\n\n计算存储的整数：\n- 对于原始读数$v_{1} = 5.75$，我们有$N_{1} = 5.75 \\cdot 2^{4} = 92$。在8位二进制中，$92$是01011100。\n- 对于偏移量$v_{2} = -2.25$，我们有$N_{2} = -2.25 \\cdot 2^{4} = -36$。$-36$的8位二进制补码由$36 = 00100100$取反加1得到，即11011100。\n\n将存储的整数相加（模$2^{8}$）：\n$$N_{\\text{sum}} = N_{1} + N_{2} = 92 + (-36) = 56.$$\n等效地，二进制加法 01011100 + 11011100 产生的进位被丢弃，得到 00111000。\n\n转换回实数值以进行验证：\n$$v_{\\text{sum}} = \\frac{N_{\\text{sum}}}{2^{4}} = \\frac{56}{16} = 3.5,$$\n该值在Q4.4的范围内。因此，得到的8位Q4.4表示是00111000，对应选项A。", "answer": "$$\\boxed{A}$$", "id": "1935892"}, {"introduction": "在掌握了基础算术之后，本练习将引导你解决一个在实际应用中至关重要的问题：溢出。你将分析一个减法运算，其结果超出了给定Q格式的可表示范围。这个实践对于理解定点数的局限性以及学习如何在硬件中识别溢出条件至关重要。[@problem_id:1935887]", "problem": "一个用于机械臂的嵌入式控制系统使用有符号8位定点数系统来表示关节速度。该格式为Q5.3补码表示法，意味着有5位用于整数部分（包括符号位），3位用于小数部分。\n\n控制器需要计算两个关节之间的相对速度。它有两个存储的速度值：$A$，代表十进制值10，和$B$，代表十进制值-10。系统硬件计算差值 $D = A - B$。\n\n以下哪个陈述正确地描述了处理器内这次特定计算的结果？\n\nA. 不会发生溢出，结果被正确表示为20。\n\nB. 不会发生溢出，因为两个异号数相减永远不会导致溢出。\n\nC. 发生溢出，因为该运算等效于两个正数相加，却产生了一个带有负号位的结果。\n\nD. 发生溢出，因为值-10无法在Q5.3格式中表示。\n\nE. 发生溢出，因为从最高有效位位置的最终进位输出位是0。", "solution": "在一个使用Q5.3格式的8位补码定点系统中，有5个整数位（包括符号位）和3个小数位。量化步长为$2^{-3}$。一个有符号Q$5.3$数的可表示范围是通过将补码范围按$2^{-3}$缩放得到的：\n$$\nx_{\\min}=-2^{5-1}=-2^{4}=-16,\\qquad x_{\\max}=2^{5-1}-2^{-3}=2^{4}-2^{-3}=16-2^{-3}=15.875.\n$$\n因此，$A=10$和$B=-10$都是可以表示的。\n\n定点编码使用$2^{3}$进行缩放，因此存储的整数码为\n$$\nk_{A}=A\\cdot 2^{3}=10\\cdot 2^{3}=80,\\qquad k_{B}=B\\cdot 2^{3}=-10\\cdot 2^{3}=-80.\n$$\n在8位补码中，$k_{A}=80$是$01010000_{2}$，而$k_{B}=-80$是$10110000_{2}$。\n\n硬件计算差值$D=A-B$。在补码算术中，\n$$\nD=A-B=A+(-B).\n$$\n由于$B=-10$，我们有$-B=+10$，所以该运算等效于两个正数相加：\n$$\nD=10+10=20.\n$$\n在编码空间中，这对应于\n$$\nk_{D}=k_{A}-k_{B}=80-(-80)=160.\n$$\n8位补码的有效编码范围是$[-2^{7},\\,2^{7}-1]=[-128,\\,127]$。值$k_{D}=160$超出了这个范围，所以8位加法器将按模$2^{8}$回绕：\n$$\nk_{D}\\equiv 160 \\pmod{256}=160-256=-96.\n$$\n因此，存储的结果码是$10100000_{2}$，其符号位为1（负）。解释为Q5.3值时，此码表示\n$$\nx_{D}=-96\\cdot 2^{-3}=-12,\n$$\n这不是数学上正确的20，并且仅由于回绕才落在可表示范围内；这种差异表明发生了有符号溢出。\n\n加法的标准补码有符号溢出条件是，两个同符号操作数相加产生一个不同符号的结果。在这里，$A$和$-B$都是正数，而结果的符号位是1（负），所以发生了溢出。等价地，溢出可以通过最高有效位的进位输入和进位输出的异或来检测；对于$01010000+01010000$，进入最高有效位的进位是1，而从最高有效位出去的进位是0，所以它们的异或是1，证实了溢出。\n\n评估选项：\n- A是错误的，因为$20$超过了最大值$15.875$，所以确实发生了溢出，并且结果没有被正确表示。\n- B是错误的，因为当 $B0$ 时，$A-B$等效于两个正数相加，这可能会导致溢出。\n- C是正确的：该运算等效于两个正数相加，并产生了一个负的符号位，这是典型的补码溢出条件。\n- D是错误的，因为$-10$在Q5.3格式中是可以表示的。\n- E的陈述是错误的：最终进位输出为0本身并不意味着溢出；正确的标准是使用进入和移出最高有效位的进位的异或。\n\n因此，正确的陈述是C。", "answer": "$$\\boxed{C}$$", "id": "1935887"}, {"introduction": "最后一个练习将理论应用于实践，这是一个在数字信号处理（DSP）中常见的任务。它挑战你在不使用完整乘法器电路的情况下，仅依靠位移和加法来实现常数乘法。本练习引入了规范有符号数位（Canonical Signed Digit, CSD）表示法作为一种优化技术，展示了巧妙的数字表示如何促成更高效的硬件设计。[@problem_id:1935863]", "problem": "在许多数字信号处理 (DSP) 应用中，需要将数据流乘以一个固定常数。为了创建最小化电路面积和功耗的高效硬件，通常会避免使用完整的乘法器电路。相反，这种“常数乘法”仅使用算术移位器（执行乘以或除以2的幂）和加法器/减法器来实现。这种方法的效率取决于使用最少数量的非零数字来表示该常数。\n\n您的任务是设计这样一个专用的算术单元。该单元接受一个8位有符号输入数 $X$，其格式为 Q4.4 定点格式（4个整数位，包括符号位，以及4个小数位）。该单元必须计算 $Y = X \\times 2.3125$。\n\n您的设计必须基于常数 $2.3125$ 的规范有符号数位 (CSD) 表示法。规范有符号数位 (CSD) 表示法是一种每个数位可以是 $1$、$0$ 或 $\\bar{1}$ (表示 -1) 的系统，其关键特性是任意两个连续的数位都不是非零的。这个特性保证了对于任何给定的常数，其非零数位的数量都是最少的。\n\n以下哪种移位和加法/减法操作序列正确地实现了所需的乘法 $Y = X \\times 2.3125$，并且使用了由 CSD 方法得出的最少算术运算（加法或减法）次数？\n\n**符号说明**：\n- $X$ 是输入数。\n- `(X  n)` 表示对 $X$ 进行 $n$ 位的算术左移（等同于乘以 $2^n$）。\n- `(X >> n)` 表示对 $X$ 进行 $n$ 位的算术右移（等同于除以 $2^n$）。\n\nA. $Y = (X \\ll 1) + (X \\gg 2) + (X \\gg 4)$\n\nB. $Y = (X \\ll 1) + (X \\gg 1) - (X \\gg 2) + (X \\gg 4)$\n\nC. $Y = (X \\ll 2) - (X \\gg 2) - (X \\gg 4)$\n\nD. $Y = (X \\ll 1) + (X \\gg 2) + (X \\gg 3) - (X \\gg 4)$\n\nE. $Y = (X \\ll 2) - (X \\gg 1) + (X \\gg 3)$", "solution": "问题要求我们找到仅使用移位器和加法器/减法器来实现乘以常数 $K=2.3125$ 的最高效方法。指定的方法是使用该常数的规范有符号数位 (CSD) 表示法。\n\n**步骤 1：将常数转换为二进制表示。**\n首先，我们将常数 $K = 2.3125$ 转换为其等效的二进制形式。我们可以通过分别转换整数和小数部分来完成。\n整数部分是 $2$，即 $(10)_2$。\n小数部分是 $0.3125$。为了转换它，我们可以将其表示为2的负幂之和。\n$0.3125 = \\frac{3125}{10000} = \\frac{5}{16}$。\n作为一个分母是2的幂的分数，这很容易转换：\n$\\frac{5}{16} = \\frac{4+1}{16} = \\frac{4}{16} + \\frac{1}{16} = 2^{-2} + 2^{-4}$。\n在二进制中，这个小数部分是 $0.0101_2$。\n结合整数和小数部分，$2.3125$ 的二进制表示是 $10.0101_2$。\n\n**步骤 2：将二进制表示转换为 CSD 表示。**\nCSD 表示对于任何数字都是唯一的，并且具有任意两个连续数位都不是非零的特性。数位可以是 $\\{1, 0, \\bar{1}\\}$，其中 $\\bar{1} = -1$。\n将二进制数转换为 CSD 的一个常用算法是将任何形如 `01...1`（有 $k$ 个1）且 $k \\ge 2$ 的连续1序列替换为 `10...0`$\\bar{1}$。\n让我们检查我们的二进制数：$10.0101_2$。\n非零数位位于对应于 $2^1$、$2^{-2}$ 和 $2^{-4}$ 的位置上。在此表示中没有连续的非零数位。例如，没有 `11` 的模式。\n由于二进制表示 $10.0101_2$ 已经满足 CSD 属性（没有两个连续的非零数位），它与其 CSD 表示相同。\n所以，$K_{CSD} = 10.0101_{CSD}$。\n\n**步骤 3：将 CSD 表示转换为移位和加法操作。**\nCSD 表示 $10.0101_{CSD}$ 对应于以下带符号的2的幂之和：\n$K = 1 \\cdot 2^1 + 0 \\cdot 2^0 + 0 \\cdot 2^{-1} + 1 \\cdot 2^{-2} + 0 \\cdot 2^{-3} + 1 \\cdot 2^{-4}$\n$K = 2^1 + 2^{-2} + 2^{-4}$\n要将输入 $X$ 乘以这个常数，我们执行以下操作：\n$Y = X \\times K = X \\times (2^1 + 2^{-2} + 2^{-4})$\n将 $X$ 分配到各项中，得到：\n$Y = (X \\times 2^1) + (X \\times 2^{-2}) + (X \\times 2^{-4})$\n这个表达式可以用算术移位来实现：\n$Y = (X \\ll 1) + (X \\gg 2) + (X \\gg 4)$\n\n**步骤 4：将结果与给定选项匹配。**\n推导出的表达式 $Y = (X \\ll 1) + (X \\gg 2) + (X \\gg 4)$ 与选项 A 完全对应。\n这个实现有三个非零项，需要 $3-1 = 2$ 次加法。这是最少的操作次数，因为 CSD 表示是最小的。\n\n让我们简要检查一下其他选项。一些选项，如 B 和 D，也能计算出正确的值，但它们不是基于最小的 CSD 形式：\n- 选项 B: $Y = (X \\ll 1) + (X \\gg 1) - (X \\gg 2) + (X \\gg 4)$ 表示 $K = 2 + 0.5 - 0.25 + 0.0625 = 2.3125$。此实现需要3次加/减运算。\n- 选项 D: $Y = (X \\ll 1) + (X \\gg 2) + (X \\gg 3) - (X \\gg 4)$ 表示 $K = 2 + 0.25 + 0.125 - 0.0625 = 2.3125$。此实现也需要3次加/减运算。\n这些是有效的但效率较低的有符号数位表示。问题要求的是从 CSD 方法推导出的实现，这种实现保证在加/减运算次数方面是最高效的。选项 C 和 E 导致了不正确的常数值。\n\n因此，选项 A 是正确答案，因为它代表了唯一的、最小的 CSD 实现。", "answer": "$$\\boxed{A}$$", "id": "1935863"}]}