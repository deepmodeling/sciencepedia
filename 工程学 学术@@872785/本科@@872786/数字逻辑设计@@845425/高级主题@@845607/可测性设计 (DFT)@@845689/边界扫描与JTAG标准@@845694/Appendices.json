{"hands_on_practices": [{"introduction": "边界扫描的基础是连接到集成电路（IC）功能引脚的扫描单元所构成的寄存器链。本练习将指导你根据器件上不同类型的引脚（输入、输出、双向等）来计算其边界扫描寄存器（BSR）的总长度，这是配置任何JTAG测试的首要基本参数 [@problem_id:1917086]。通过这个计算，你将理解芯片的物理引脚布局如何直接转化为其内部的可测试性结构。", "problem": "一个工程团队正在为一种专门的信号处理应用设计一款定制集成电路（IC）。为确保该IC在制造后是可测试的，它将集成符合联合测试行动组（JTAG）标准 IEEE 1149.1 的边界扫描逻辑。该IC的引脚排列定义如下：\n\n*   32个专用数字输入引脚。\n*   16个专用数字输出引脚。\n*   8个双向数字I/O引脚。\n*   4个三态数字输出引脚。\n*   4个用于测试访问端口（TAP）的专用引脚：TDI、TDO、TCK 和 TMS。\n*   2个专用电源和接地引脚（VCC、GND）。\n\n边界扫描寄存器（BSR）是通过将边界扫描单元与IC的功能引脚相关联来构建的。此特定实现的规则如下：\n1.  每个专用数字输入引脚与一个边界扫描单元相关联。\n2.  每个专用数字输出引脚与一个边界扫描单元相关联。\n3.  每个双向I/O引脚需要两个单元：一个用于输入/输出值的数据单元和一个用于确定引脚方向（输入或输出）的控制单元。\n4.  每个三态输出引脚需要两个单元：一个用于输出值的数据单元和一个用于启用或禁用输出驱动器（即，将引脚置于高阻态）的控制单元。\n5.  专用于TAP控制器和电源/接地的引脚不属于边界扫描寄存器链的一部分。\n\n根据此规范，边界扫描寄存器的总长度（以位为单位）是多少？\n\nA. 60\n\nB. 64\n\nC. 72\n\nD. 76\n\nE. 78", "solution": "边界扫描寄存器（BSR）的长度等于分配给功能引脚的边界扫描单元的总数，因为每个单元为BSR贡献一位。根据给定的实现规则：\n\n- 每个专用数字输入引脚贡献一个单元：\n$$32 \\times 1 = 32 \\text{ 单元}。$$\n\n- 每个专用数字输出引脚贡献一个单元：\n$$16 \\times 1 = 16 \\text{ 单元}。$$\n\n- 每个双向I/O引脚贡献两个单元（一个数据单元和一个方向控制单元）：\n$$8 \\times 2 = 16 \\text{ 单元}。$$\n\n- 每个三态数字输出引脚贡献两个单元（一个数据单元和一个使能控制单元）：\n$$4 \\times 2 = 8 \\text{ 单元}。$$\n\n- TAP引脚（TDI、TDO、TCK、TMS）和电源/接地引脚（VCC、GND）不包括在内，贡献：\n$$0 \\text{ 单元}。$$\n\n将所有贡献相加，得出BSR的长度（以位为单位）：\n$$32 + 16 + 16 + 8 = 72.$$\n\n因此，正确选项是 C。", "answer": "$$\\boxed{C}$$", "id": "1917086"}, {"introduction": "理解了边界扫描寄存器的结构之后，下一步是学习如何控制它。所有JTAG操作都通过测试访问端口（TAP）控制器这个有限状态机来协调，而测试模式选择（TMS）信号则是导航该状态机的关键 [@problem_id:1917058]。本练习将挑战你找出正确的TMS序列以进入关键的`Shift-DR`状态，这是执行任何JTAG测试或调试程序所必需的核心技能。", "problem": "一位数字设计工程师的任务是调试一块新制造的印刷电路板 (PCB)。该工程师计划使用联合测试行动组 (JTAG) 标准，特别是 IEEE 1149.1 边界扫描测试，来验证组件之间连接的完整性。JTAG 接口由测试接入端口 (TAP) 控制器内部的状态机控制。该控制器的状态转换由测试时钟 (TCK) 每个上升沿上的测试模式选择 (TMS) 信号的值决定。\n\n为了将测试向量加载到边界扫描数据寄存器中，TAP 控制器必须被导航到 `Shift-DR` 状态。与此任务相关的状态转换描述如下：\n\n- TAP 控制器保证在上电后或通过将 TMS 信号保持高电平至少五个 TCK 周期后进入 `Test-Logic-Reset` 状态。\n- 从 `Test-Logic-Reset` 状态，TMS 值为 `0` 时控制器转换到 `Run-Test/Idle` 状态。TMS 值为 `1` 时则保持在 `Test-Logic-Reset` 状态。\n- 从 `Run-Test/Idle` 状态，TMS 值为 `1` 时转换到 `Select-DR-Scan` 状态。TMS 值为 `0` 时则保持在 `Run-Test/Idle` 状态。\n- 从 `Select-DR-Scan` 状态，TMS 值为 `0` 时转换到 `Capture-DR` 状态。TMS 值为 `1` 时转换到 `Select-IR-Scan` 状态（指令寄存器的路径）。\n- 从 `Capture-DR` 状态，TMS 值为 `0` 时转换到 `Shift-DR` 状态。TMS 值为 `1` 时转换到 `Exit1-DR` 状态。\n- 一旦进入 `Shift-DR` 状态，TMS 值为 `0` 将使控制器保持在 `Shift-DR` 状态，从而允许串行数据移位。\n\n假设 TAP 控制器从 `Test-Logic-Reset` 状态开始，以下哪一个在 TCK 的四个连续上升沿上采样的 TMS 值序列，能够正确地将控制器导航到 `Shift-DR` 状态？\n\nA. 0100\n\nB. 1100\n\nC. 0110\n\nD. 0101\n\nE. 0010", "solution": "我们将 TAP 控制器建模为一个确定性有限状态机，其状态更新发生在 TCK 的每个上升沿，并完全由当前状态和采样的 TMS 值决定，如给定的转换规则所指定。控制器从 Test-Logic-Reset 状态开始。要通过数据寄存器路径到达 Shift-DR，最小的转换路径是：\nTest-Logic-Reset --TMS为$0$--> Run-Test/Idle --TMS为$1$--> Select-DR-Scan --TMS为$0$--> Capture-DR --TMS为$0$--> Shift-DR。\n这对应于 TMS 序列 $0,1,0,0$。\n\n我们现在通过使用给定的 TMS 序列模拟 TCK 的四个连续上升沿来验证每个选项：\n\n选项 A: $0,1,0,0$\n- 从 Test-Logic-Reset 开始；TMS 为 $0$ 时，转换到 Run-Test/Idle。\n- 从 Run-Test/Idle；TMS 为 $1$ 时，转换到 Select-DR-Scan。\n- 从 Select-DR-Scan；TMS 为 $0$ 时，转换到 Capture-DR。\n- 从 Capture-DR；TMS 为 $0$ 时，转换到 Shift-DR。\n结果：Shift-DR。这是正确的。\n\n选项 B: $1,1,0,0$\n- 从 Test-Logic-Reset 开始；TMS 为 $1$ 时，保持在 Test-Logic-Reset。\n- 从 Test-Logic-Reset；TMS 为 $1$ 时，保持在 Test-Logic-Reset。\n- 从 Test-Logic-Reset；TMS 为 $0$ 时，转换到 Run-Test/Idle。\n- 从 Run-Test/Idle；TMS 为 $0$ 时，保持在 Run-Test/Idle。\n结果：Run-Test/Idle。不是 Shift-DR。\n\n选项 C: $0,1,1,0$\n- 从 Test-Logic-Reset 开始；TMS 为 $0$ 时，转换到 Run-Test/Idle。\n- 从 Run-Test/Idle；TMS 为 $1$ 时，转换到 Select-DR-Scan。\n- 从 Select-DR-Scan；TMS 为 $1$ 时，转换到 Select-IR-Scan。\n- 从 Select-IR-Scan；TMS 为 $0$ 时，转换到 Capture-IR。\n结果：Capture-IR。不是 Shift-DR。\n\n选项 D: $0,1,0,1$\n- 从 Test-Logic-Reset 开始；TMS 为 $0$ 时，转换到 Run-Test/Idle。\n- 从 Run-Test/Idle；TMS 为 $1$ 时，转换到 Select-DR-Scan。\n- 从 Select-DR-Scan；TMS 为 $0$ 时，转换到 Capture-DR。\n- 从 Capture-DR；TMS 为 $1$ 时，转换到 Exit1-DR。\n结果：Exit1-DR。不是 Shift-DR。\n\n选项 E: $0,0,1,0$\n- 从 Test-Logic-Reset 开始；TMS 为 $0$ 时，转换到 Run-Test/Idle。\n- 从 Run-Test/Idle；TMS 为 $0$ 时，保持在 Run-Test/Idle。\n- 从 Run-Test/Idle；TMS 为 $1$ 时，转换到 Select-DR-Scan。\n- 从 Select-DR-Scan；TMS 为 $0$ 时，转换到 Capture-DR。\n结果：Capture-DR。不是 Shift-DR。\n\n因此，只有选项 A 在从指定的起始状态开始的四个 TCK 边沿内到达 Shift-DR。", "answer": "$$\\boxed{A}$$", "id": "1917058"}, {"introduction": "JTAG的真正威力体现在测试印刷电路板（PCB）上多个IC之间的连接。这个最终练习模拟了一个真实的故障场景：链中的一个器件因其控制引脚失效而偏离了预期的行为 [@problem_id:1917043]。通过分析在这种情况下扫描链的预期输出，你将学习到JTAG不仅能测试连接的完整性，更能作为一种强大的诊断工具，帮助工程师定位和识别复杂的硬件故障。", "problem": "在一个数字系统中，三个复杂的集成电路U1、U2和U3使用联合测试行动组（JTAG）IEEE 1149.1标准连接在一个串行扫描链中。测试控制器的测试数据输出（TDO）连接到U1的测试数据输入（TDI），U1的TDO连接到U2的TDI，U2的TDO连接到U3的TDI，而U3的TDO连接回测试控制器。这些器件的主数据寄存器（特别是边界扫描寄存器）的长度分别为：U1为8位，U2为16位，U3为12位。\n\n一个制造缺陷导致器件U2的测试模式选择（TMS）引脚内部短路到电源，使其永久固定在高电平（固定为1）。\n\n一个自动测试系统在不知晓该故障的情况下，尝试执行数据寄存器扫描。它假设所有器件都功能正常，并从`Run-Test/Idle`状态开始。测试系统在TMS线上施加标准的JTAG测试访问端口（TAP）控制器序列，以将所有器件转换到`Shift-DR`状态。然后，它将TMS保持在低电平，并在测试时钟（TCK）线上施加36个脉冲，以将一个以`1100`为重复单元的36位测试向量移入U1的TDI。\n\n在本分析中，假设对于所有功能正常的器件，`Capture-DR`操作会将全零模式加载到它们各自的数据寄存器中。此外，假设任何因故障而被迫进入旁路模式的器件，其单位旁路寄存器在移位操作之前被初始化为0。\n\n在36个TCK移位周期内，在最终器件（U3）的TDO引脚上观察到的36位序列是什么？从下面的选项中选择正确的序列，其中观察到的第一个比特出现在最左边。\n\nA. `000000000000000000000110011001100110`\n\nB. `000000000000000000000000000000000000`\n\nC. `000000000000000000001100110011001100`\n\nD. `000000000000100000000110011001100110`\n\nE. `110011001100110011001100110011001100`", "solution": "假设所有三个器件都从`Run-Test/Idle`状态开始。测试仪驱动TAP进入`Shift-DR`状态；器件U1和U3（具有正确的TMS）遵循此序列并执行`Capture-DR`，这会将全零加载到它们的边界扫描寄存器中。因为U2的TMS固定在高电平，所以它不会与其他器件一同进入`Shift-DR`状态；题目中指出，因故障而被迫进入旁路模式的器件，其模型是将其单位的BYPASS寄存器贡献给数据路径，并在移位前初始化为0。\n\n因此，在`Shift-DR`操作期间，有效的扫描路径长度是贡献的数据寄存器长度之和：\n$$\nL = 8 \\ (\\text{U1 BSR}) + 1 \\ (\\text{U2 BYPASS}) + 12 \\ (\\text{U3 BSR}) = 21.\n$$\n设$s(k)$是在36个周期的移位过程中，第$k$个TCK时施加在U1的TDI上的比特，设$y(k)$是在第$k$个TCK时在最终的TDO（来自U3）上观察到的比特。根据内容初始化为零的移位寄存器行为，输出是输入延迟$L$个周期，前$L$个输出为零：\n$$\ny(k) = \\begin{cases}\n0, & 1 \\le k \\le L,\\\\\ns(k-L), & L < k \\le 36.\n\\end{cases}\n$$\n测试仪移入一个以`1100`为重复单元的36位测试向量。因此，时间序列$s(k)$从$k=1$开始，其模式为`1100`重复：\n$$\ns(k) = \\begin{cases}\n1, & k \\bmod 4 \\in \\{1,2\\},\\\\\n0, & k \\bmod 4 \\in \\{0,3\\}.\n\\end{cases}\n$$\n当$L=21$时，观察到的序列是$y(1..21)=0$，而对于$k=22..36$，\n$$\ny(k)=s(k-21)=s(1..15)=110011001100110.\n$$\n因此，36位的TDO序列是21个零，后面跟着$110011001100110$，这与选项A匹配：\n$$\n000000000000000000000110011001100110.\n$$", "answer": "$$\\boxed{A}$$", "id": "1917043"}]}