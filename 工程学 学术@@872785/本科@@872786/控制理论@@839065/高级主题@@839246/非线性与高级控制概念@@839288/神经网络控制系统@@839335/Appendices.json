{"hands_on_practices": [{"introduction": "即使是单个神经元也能构成一个有效的非线性控制器。本练习将探讨如何为一个经典的水箱液位控制问题，通过调整神经元的参数（权重和偏置）来满足特定的稳态性能和灵敏度要求。这个实践将神经网络的基本组件与诸如零稳态误差等基本控制目标联系起来 [@problem_id:1595357]。", "problem": "一位工程师正在设计一个简单的神经控制器，用以调节储罐中的液位。在一个横截面积恒定的储罐中，液位 $h(t)$ 的动力学由以下微分方程决定：$A \\frac{dh}{dt} = q_{in}(t) - q_{out}(t)$，其中 $A$ 是面积，$q_{in}(t)$ 是流入速率，$q_{out}(t)$ 是流出速率。已知流出是液位的线性函数：$q_{out}(t) = K_{out}h(t)$，其中 $K_{out}$ 是一个正常数流出系数。\n\n流入 $q_{in}(t)$ 由一个单神经元控制器决定。该控制器以误差信号 $e(t) = h_{ref} - h(t)$ 作为输入，其中 $h_{ref}$ 是期望的恒定参考液位。控制器的输出（用于设定流入速率）由以下包含双曲正切激活函数的方程给出：\n$$q_{in}(t) = \\frac{q_{max}}{2} \\left[ 1 + \\tanh(w \\cdot e(t) + b) \\right]$$\n在此，$q_{max}$ 是水泵可能的最大流入速率，而 $w$ 和 $b$ 分别是神经元的可调权重和偏置。\n\n工程师的目标是选择权重 $w$ 和偏置 $b$，以在稳态工作条件下（当 $t \\to \\infty$ 时）满足两个特定的性能标准：\n1. 稳态液位 $h_{ss}$ 必须精确等于参考液位 $h_{ref}$，以确保零稳态误差。\n2. 在此稳态点，控制器对微小误差的灵敏度，定义为比例增益 $K_P = \\left. \\frac{dq_{in}}{de} \\right|_{e=0}$，必须等于一个指定的正常数 $G$。\n\n确定所需神经网络权重 $w$ 的解析表达式。请用 $h_{ref}$、$K_{out}$、$q_{max}$ 和 $G$ 表示你的答案。", "solution": "储罐动力学为 $A \\frac{dh}{dt} = q_{in}(t) - q_{out}(t)$，其中 $q_{out}(t) = K_{out} h(t)$。在稳态下，$\\frac{dh}{dt} = 0$，因此 $q_{in,ss} = q_{out,ss} = K_{out} h_{ss}$。第一个要求規定 $h_{ss} = h_{ref}$，因此\n$$\nq_{in}(e=0) = K_{out} h_{ref}.\n$$\n控制器为 $q_{in}(t) = \\frac{q_{max}}{2}\\left[1 + \\tanh(w e(t) + b)\\right]$，其中 $e(t) = h_{ref} - h(t)$。在稳态下，$e=0$，所以\n$$\n\\frac{q_{max}}{2}\\left[1 + \\tanh(b)\\right] = K_{out} h_{ref}\n\\quad \\Rightarrow \\quad\n\\tanh(b) = \\frac{2 K_{out} h_{ref}}{q_{max}} - 1.\n$$\n这要求 $0  K_{out} h_{ref}  q_{max}$ 以保持 $|\\tanh(b)|  1$。\n\n比例灵敏度为\n$$\nK_{P} = \\left.\\frac{dq_{in}}{de}\\right|_{e=0} = \\left.\\frac{q_{max}}{2}\\,\\frac{d}{de}\\tanh(w e + b)\\right|_{e=0} = \\frac{q_{max}}{2}\\,w\\,[1 - \\tanh^{2}(b)].\n$$\n施加 $K_{P} = G$ 的条件可得\n$$\n\\frac{q_{max}}{2}\\,w\\,[1 - \\tanh^{2}(b)] = G\n\\quad \\Rightarrow \\quad\nw = \\frac{2G}{q_{max}\\,[1 - \\tanh^{2}(b)]}.\n$$\n使用 $\\tanh(b) = \\frac{2 K_{out} h_{ref}}{q_{max}} - 1$，定义 $x = \\frac{2 K_{out} h_{ref}}{q_{max}}$，这样 $1 - \\tanh^{2}(b) = 1 - (x - 1)^{2} = x(2 - x)$。因此\n$$\n1 - \\tanh^{2}(b) = \\frac{4 K_{out} h_{ref}\\,(q_{max} - K_{out} h_{ref})}{q_{max}^{2}}.\n$$\n代入 $w$ 的表达式中可得\n$$\nw = \\frac{2G}{q_{max}} \\cdot \\frac{q_{max}^{2}}{4 K_{out} h_{ref}\\,(q_{max} - K_{out} h_{ref})}\n= \\frac{G\\,q_{max}}{2 K_{out} h_{ref}\\,(q_{max} - K_{out} h_{ref})}.\n$$\n这同时满足了稳态零误差和指定的比例灵敏度，条件是 $0  K_{out} h_{ref}  q_{max}$ 且 $G > 0$。", "answer": "$$\\boxed{\\frac{G\\,q_{max}}{2\\,K_{out}\\,h_{ref}\\,\\left(q_{max}-K_{out}\\,h_{ref}\\right)}}$$", "id": "1595357"}, {"introduction": "神经网络控制器本质上是非线性的，这使得使用传统的线性工具进行分析变得困难。本练习介绍了一种关键技术：线性化。通过计算在特定工作点的雅可比矩阵，我们可以用一个简单的增益矩阵来近似复杂网络在局部的行为，从而使其更易于理解并集成到经典控制框架中 [@problem_id:1595344]。", "problem": "在现代机器人技术中，神经网络常被用作非线性控制器。考虑一个简单的用于控制机械臂单个关节的前馈神经网络。该网络有两个输入：无量纲位置误差 $e_1$ 和无量纲速度误差 $e_2$。它产生一个单一输出 $u$，表示施加到关节上的校正力矩。\n\n该网络有一个包含两个神经元的隐藏层。隐藏层神经元的激活函数是双曲正切函数 $\\tanh(x)$。输出神经元具有线性激活函数（即其输出等于其输入）。\n\n网络内部的计算定义如下：\n首先，计算隐藏神经元的激活前的值 $z_1$ 和 $z_2$：\n$$z_1 = w_{11}e_1 + w_{12}e_2 + b_1$$\n$$z_2 = w_{21}e_1 + w_{22}e_2 + b_2$$\n\n接下来，求出隐藏神经元的激活值 $a_1$ 和 $a_2$：\n$$a_1 = \\tanh(z_1)$$\n$$a_2 = \\tanh(z_2)$$\n\n最后，计算输出力矩 $u$：\n$$u = v_1 a_1 + v_2 a_2 + b_{\\text{out}}$$\n\n经过训练过程后，网络参数（权重和偏置）已确定如下：\n- 输入到隐藏层的权重：$w_{11} = 1.2$, $w_{12} = -0.8$, $w_{21} = 0.5$, $w_{22} = 1.5$\n- 隐藏层偏置：$b_1 = 0.1$, $b_2 = -0.3$\n- 隐藏层到输出层的权重：$v_1 = 2.0$, $v_2 = -1.0$\n- 输出偏置：$b_{\\text{out}} = 0.4$\n\n为了与经典控制方法进行分析和集成，有必要在这个非线性控制器的一个特定工作点附近进行线性化。确定局部增益矩阵 $K = \\begin{bmatrix} K_1  K_2 \\end{bmatrix}$，该矩阵在工作点 $(e_{1,0}, e_{2,0}) = (0.5, -0.2)$ 附近将控制器的行为近似为 $\\delta u \\approx K_1 \\delta e_1 + K_2 \\delta e_2$。\n\n将你的答案表示为一个 $1 \\times 2$ 的行矩阵。将矩阵元素的数值四舍五入到三位有效数字。", "solution": "我们通过计算非线性映射 $u(e_{1},e_{2})$ 在工作点 $(e_{1,0},e_{2,0})=(0.5,-0.2)$ 处关于 $(e_{1},e_{2})$ 的雅可比矩阵来对其进行线性化。局部增益矩阵是 $K=\\begin{bmatrix}K_{1}  K_{2}\\end{bmatrix}$，其中\n$$\nK_{1}=\\left.\\frac{\\partial u}{\\partial e_{1}}\\right|_{(e_{1,0},e_{2,0})},\\quad\nK_{2}=\\left.\\frac{\\partial u}{\\partial e_{2}}\\right|_{(e_{1,0},e_{2,0})}.\n$$\n已知 $z_{1}=w_{11}e_{1}+w_{12}e_{2}+b_{1}$ 和 $z_{2}=w_{21}e_{1}+w_{22}e_{2}+b_{2}$，且 $a_{i}=\\tanh(z_{i})$ 和 $u=v_{1}a_{1}+v_{2}a_{2}+b_{\\text{out}}$，根据链式法则和 $\\frac{d}{dz}\\tanh(z)=1-\\tanh^{2}(z)$ 可得\n$$\n\\frac{\\partial u}{\\partial e_{1}}=v_{1}\\bigl(1-\\tanh^{2}(z_{1})\\bigr)\\frac{\\partial z_{1}}{\\partial e_{1}}+v_{2}\\bigl(1-\\tanh^{2}(z_{2})\\bigr)\\frac{\\partial z_{2}}{\\partial e_{1}}\n= v_{1}\\bigl(1-\\tanh^{2}(z_{1})\\bigr)w_{11}+v_{2}\\bigl(1-\\tanh^{2}(z_{2})\\bigr)w_{21},\n$$\n$$\n\\frac{\\partial u}{\\partial e_{2}}=v_{1}\\bigl(1-\\tanh^{2}(z_{1})\\bigr)\\frac{\\partial z_{1}}{\\partial e_{2}}+v_{2}\\bigl(1-\\tanh^{2}(z_{2})\\bigr)\\frac{\\partial z_{2}}{\\partial e_{2}}\n= v_{1}\\bigl(1-\\tanh^{2}(z_{1})\\bigr)w_{12}+v_{2}\\bigl(1-\\tanh^{2}(z_{2})\\bigr)w_{22}.\n$$\n在点 $(e_{1,0},e_{2,0})=(0.5,-0.2)$ 处计算 $z_{1}$ 和 $z_{2}$ 的值：\n$$\nz_{1}=1.2\\cdot 0.5+(-0.8)\\cdot(-0.2)+0.1=0.86,\\qquad\nz_{2}=0.5\\cdot 0.5+1.5\\cdot(-0.2)-0.3=-0.35.\n$$\n使用 $\\tanh(x)=\\frac{\\exp(2x)-1}{\\exp(2x)+1}$，我们数值计算得到\n$$\n\\tanh(0.86)\\approx 0.6964\\;\\Rightarrow\\;1-\\tanh^{2}(0.86)\\approx 0.5150,\\qquad\n\\tanh(-0.35)\\approx -0.3364\\;\\Rightarrow\\;1-\\tanh^{2}(-0.35)\\approx 0.8869.\n$$\n代入参数 $v_{1}=2.0$, $v_{2}=-1.0$, $w_{11}=1.2$, $w_{12}=-0.8$, $w_{21}=0.5$, $w_{22}=1.5$：\n$$\nK_{1}=2.0\\cdot 0.5150\\cdot 1.2+(-1.0)\\cdot 0.8869\\cdot 0.5\\approx 1.236-0.4435\\approx 0.7926,\n$$\n$$\nK_{2}=2.0\\cdot 0.5150\\cdot(-0.8)+(-1.0)\\cdot 0.8869\\cdot 1.5\\approx -0.8240-1.3304\\approx -2.1543.\n$$\n将每个值四舍五入到三位有效数字，得到\n$$\nK=\\begin{bmatrix}0.793  -2.15\\end{bmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}0.793  -2.15\\end{pmatrix}}$$", "id": "1595344"}, {"introduction": "除了直接用于控制，神经网络在为复杂系统动态建模方面也表现出色。本练习将展示如何在一个模型预测控制（MPC）框架内使用基于神经网络的模型。我们将利用网络的单步预测来计算最优控制动作，以在跟踪期望设定点和最小化控制成本之间取得平衡 [@problem_id:1595312]。", "problem": "一个涉及连续搅拌釜反应器 (CSTR) 的化学过程在离散时间步 $k$ 下被监测。系统的状态由反应物 A 的浓度来表征，记为 $C_A(k)$，单位为 mol/L。该过程受单一控制输入，即冷却剂的流速影响，记为 $u(k)$，单位为 L/min。\n\n为了调节该反应器，采用了一种简单形式的模型预测控制 (MPC)。该控制器使用一个预训练的神经网络来预测下一个时间步的浓度 $C_A(k+1)$。该神经网络的预测模型由以下仿射函数给出：\n$$C_A(k+1) = \\alpha C_A(k) - \\beta u(k) + \\delta$$\n其中 $\\alpha$、$\\beta$ 和 $\\delta$ 是网络学习到的常数参数。\n\n控制器的目标是将浓度 $C_A$ 驱动至一个参考设定点 $C_{A, \\text{ref}}$。在每个时间步 $k$，控制器计算最优控制输入 $u(k)$，以最小化一个单步前向成本函数 $J$。该成本函数同时惩罚与设定点的预测偏差和控制努力的大小：\n$$J(u(k)) = \\left(C_{A, \\text{ref}} - C_A(k+1)\\right)^2 + \\lambda \\left(u(k)\\right)^2$$\n其中 $\\lambda$ 是一个正权重因子。\n\n在某个特定的时间步 $k$，观测到系统的浓度为 $C_A(k) = 2.10$ mol/L。系统参数如下：\n- 参考设定点, $C_{A, \\text{ref}} = 1.50$ mol/L\n- 模型参数, $\\alpha = 0.950$\n- 模型参数, $\\beta = 0.120$ (mol/L) / (L/min)\n- 模型参数, $\\delta = 0.250$ mol/L\n- 控制权重因子, $\\lambda = 0.0500$ ((mol/L)$^2$) / ((L/min)$^2$)\n\n确定控制器在此时间步应施加的最优冷却剂流速 $u(k)$。以 L/min 为单位表示您的答案，并四舍五入至三位有效数字。", "solution": "我们需要选择控制输入 $u(k)$ 来最小化单步二次成本\n$$J(u(k))=\\left(C_{A,\\text{ref}}-C_{A}(k+1)\\right)^{2}+\\lambda \\left(u(k)\\right)^{2},$$\n使用仿射模型\n$$C_{A}(k+1)=\\alpha C_{A}(k)-\\beta u(k)+\\delta.$$\n为简洁起见，定义 $u \\equiv u(k)$ 并将模型代入成本函数。预测的跟踪误差为\n$$C_{A,\\text{ref}}-C_{A}(k+1)=C_{A,\\text{ref}}-\\left(\\alpha C_{A}(k)-\\beta u+\\delta\\right)=\\left(C_{A,\\text{ref}}-\\alpha C_{A}(k)-\\delta\\right)+\\beta u.$$\n令\n$$r \\equiv C_{A,\\text{ref}}-\\alpha C_{A}(k)-\\delta.$$\n那么成本函数变为\n$$J(u)=(r+\\beta u)^{2}+\\lambda u^{2}.$$\n这是关于 $u$ 的严格凸二次函数，因为当 $\\lambda>0$ 时，$\\beta^{2}+\\lambda>0$。无约束极小值点满足一阶最优性条件 $\\frac{dJ}{du}=0$。求导：\n$$\\frac{dJ}{du}=2(r+\\beta u)\\beta+2\\lambda u=2\\beta r+2\\left(\\beta^{2}+\\lambda\\right)u.$$\n将其设为零并求解 $u$：\n$$2\\beta r+2\\left(\\beta^{2}+\\lambda\\right)u=0 \\implies u^{\\star}=-\\frac{\\beta r}{\\beta^{2}+\\lambda}=-\\frac{\\beta\\left(C_{A,\\text{ref}}-\\alpha C_{A}(k)-\\delta\\right)}{\\beta^{2}+\\lambda}.$$\n二阶导数为 $\\frac{d^{2}J}{du^{2}}=2\\left(\\beta^{2}+\\lambda\\right)>0$，这确认了存在唯一的最小值。\n\n现在代入给定的数值：\n$$\\alpha=0.950,\\quad \\beta=0.120,\\quad \\delta=0.250,\\quad \\lambda=0.0500,\\quad C_{A}(k)=2.10,\\quad C_{A,\\text{ref}}=1.50.$$\n计算\n$$r=C_{A,\\text{ref}}-\\alpha C_{A}(k)-\\delta=1.50-0.950\\cdot 2.10-0.250=1.50-1.995-0.250=-0.745,$$\n和\n$$\\beta^{2}+\\lambda=(0.120)^{2}+0.0500=0.0144+0.0500=0.0644.$$\n因此，\n$$u^{\\star}=-\\frac{\\beta r}{\\beta^{2}+\\lambda}=-\\frac{0.120\\cdot(-0.745)}{0.0644}=\\frac{0.0894}{0.0644}\\approx 1.3882.$$\n四舍五入到三位有效数字，最优冷却剂流速为 $1.39$ L/min。", "answer": "$$\\boxed{1.39}$$", "id": "1595312"}]}