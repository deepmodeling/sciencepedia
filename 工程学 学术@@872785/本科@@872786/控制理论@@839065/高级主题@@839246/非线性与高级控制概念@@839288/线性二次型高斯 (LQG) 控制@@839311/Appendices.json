{"hands_on_practices": [{"introduction": "线性二次调节器（LQR）设计的核心在于通过定义成本函数来权衡系统性能与控制成本。这个练习将带你深入了解 LQR 设计中最直观的部分：权重矩阵的选择。通过为一个不稳定的倒立摆设计控制器，你将亲手探索如何通过调整状态权重矩阵 $Q$ 来影响控制器增益 $K$，从而直观地理解数学上的权重与最终控制行为之间的紧密联系。[@problem_id:1589177]", "problem": "一位控制工程师正在为一个简化的小车倒立摆模型设计控制器。该倒立摆在其竖直向上的不稳定平衡点附近的线性化动力学由状态空间模型 $\\dot{x} = Ax + Bu$ 给出，其中状态向量为 $x = [\\theta, \\dot{\\theta}]^T$，分别代表与垂直方向的夹角和角速度。控制输入 $u$ 是施加在小车上的水平力的一个缩放表示。系统矩阵为：\n$$ A = \\begin{pmatrix} 0  1 \\\\ 1  0 \\end{pmatrix}, \\quad B = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} $$\n该工程师使用线性二次调节器（LQR）方法来设计状态反馈控制器 $u = -Kx = -[k_{\\theta}, k_{\\dot{\\theta}}]x$。目标是找到最优增益矩阵 $K$，以最小化二次代价泛函 $J = \\int_{0}^{\\infty} (x^T Q x + u^T R u) dt$。\n\n工程师考虑了基于两组不同权重矩阵的两种不同设计：\n1.  **设计 1：** 权重矩阵为 $Q_1 = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$ 和 $R_1 = 1$。此设计得到的最优增益矩阵为 $K_1 = [k_{\\theta,1}, k_{\\dot{\\theta},1}]$。\n2.  **设计 2：** 权重矩阵为 $Q_2 = \\begin{pmatrix} 1  0 \\\\ 0  100 \\end{pmatrix}$ 和 $R_2 = 1$。此设计得到的最优增益矩阵为 $K_2 = [k_{\\theta,2}, k_{\\dot{\\theta},2}]$。\n\n计算设计 2 与设计 1 的角速度反馈增益之比，即 $k_{\\dot{\\theta},2} / k_{\\dot{\\theta},1}$。将你的最终答案四舍五入到三位有效数字。", "solution": "我们使用连续时间 LQR 设置。对于系统 $\\dot{x}=Ax+Bu$，其中 $A=\\begin{pmatrix}0  1 \\\\ 1  0\\end{pmatrix}$，$B=\\begin{pmatrix}0 \\\\ 1\\end{pmatrix}$，$Q=\\operatorname{diag}(q_{1},q_{2})$ 且 $R=1$，最优增益为 $K=R^{-1}B^{T}P=B^{T}P$，其中 $P=P^{T}\\succeq 0$ 是以下连续时间代数 Riccati 方程的解\n$$\nA^{T}P+PA-PBR^{-1}B^{T}P+Q=0.\n$$\n设 $P=\\begin{pmatrix}p_{11}  p_{12} \\\\ p_{12}  p_{22}\\end{pmatrix}$。计算每一项：\n- $A^{T}P+PA=\\begin{pmatrix}2p_{12}  p_{11}+p_{22} \\\\ p_{11}+p_{22}  2p_{12}\\end{pmatrix}$，\n- $PBR^{-1}B^{T}P=PB B^{T}P=(PB)(PB)^{T}$，其中 $PB=\\begin{pmatrix}p_{12} \\\\ p_{22}\\end{pmatrix}$，因此\n$$\nPBR^{-1}B^{T}P=\\begin{pmatrix}p_{12}^{2}  p_{12}p_{22} \\\\ p_{12}p_{22}  p_{22}^{2}\\end{pmatrix}.\n$$\nRiccati 方程得到以下按元素表示的方程组\n$$\n\\begin{aligned}\n (1,1):\\quad 2p_{12}+q_{1}-p_{12}^{2}=0, \\\\\n (1,2):\\quad p_{11}+p_{22}-p_{12}p_{22}=0, \\\\\n (2,2):\\quad 2p_{12}+q_{2}-p_{22}^{2}=0.\n\\end{aligned}\n$$\n从 $(1,1)$ 式，解关于 $p_{12}$ 的二次方程：\n$$\np_{12}^{2}-2p_{12}-q_{1}=0 \\;\\;\\Rightarrow\\;\\; p_{12}=1\\pm\\sqrt{1+q_{1}}.\n$$\n对于稳定化的 LQR 解，要求 $P\\succeq 0$，我们需要 $p_{11}=p_{22}(p_{12}-1)\\geq 0$，这选择了 $p_{12}=1+\\sqrt{1+q_{1}}$。然后从 $(2,2)$ 式，\n$$\np_{22}^{2}=2p_{12}+q_{2}=2\\bigl(1+\\sqrt{1+q_{1}}\\bigr)+q_{2},\n$$\n因此，在 $p_{22}\\geq 0$ 的条件下，我们有\n$$\np_{22}=\\sqrt{q_{2}+2+2\\sqrt{1+q_{1}}}.\n$$\n由于 $K=B^{T}P=[p_{12},p_{22}]$，角速度反馈增益为 $k_{\\dot{\\theta}}=p_{22}$。\n\n将此应用于两种设计：\n- 设计 1：$q_{1}=1$，$q_{2}=1$ 给出\n$$\nk_{\\dot{\\theta},1}=p_{22,1}=\\sqrt{1+2+2\\sqrt{2}}=\\sqrt{3+2\\sqrt{2}}=\\sqrt{2}+1.\n$$\n- 设计 2：$q_{1}=1$，$q_{2}=100$ 给出\n$$\nk_{\\dot{\\theta},2}=p_{22,2}=\\sqrt{100+2+2\\sqrt{2}}=\\sqrt{102+2\\sqrt{2}}.\n$$\n因此，比值为\n$$\n\\frac{k_{\\dot{\\theta},2}}{k_{\\dot{\\theta},1}}=\\frac{\\sqrt{102+2\\sqrt{2}}}{\\sqrt{2}+1}=(\\sqrt{2}-1)\\sqrt{102+2\\sqrt{2}}.\n$$\n数值上，这约等于 $4.2409566$，四舍五入到三位有效数字是 $4.24$。", "answer": "$$\\boxed{4.24}$$", "id": "1589177"}, {"introduction": "在现实世界中，我们常常无法直接精确地测量系统的所有状态。卡尔曼滤波器正是为了解决这个问题而设计的，它能从充满噪声的测量数据中提取出对系统状态的最优估计。这个练习将让你聚焦于卡尔曼滤波器本身，通过一个具体的案例，你将计算并比较在不同初始不确定性下，滤波器误差协方差的演变。通过这个过程，你将理解滤波器是如何“学习”并逐渐对其估计建立“信心”的，这是构建完整 LQG 控制器的关键一步。[@problem_id:1589190]", "problem": "考虑一个估计无量纲标量状态 $x_k$ 的问题，该状态表示在离散时间步长 $k$ 下一个缓慢化学过程中的归一化温度。该状态根据以下线性随机差分方程演化：\n$$x_{k+1} = A x_k + w_k$$\n一个传感器提供与状态相关的测量值 $z_k$：\n$$z_k = H x_k + v_k$$\n系统参数给定为 $A=1$ 和 $H=1$。过程噪声 $w_k$ 和测量噪声 $v_k$ 是独立的、零均值的白高斯噪声序列，其方差分别为 $Q=0.1$ 和 $R=0.5$。\n\n在时间 $k=0$ 时，状态的初始估计为 $\\hat{x}_{0|0} = 10$。为了研究初始不确定性对卡尔曼滤波器性能的影响，我们考虑初始估计误差协方差 $P_{0|0}$ 的两种情况：\n- **情况 A**：高初始不确定性，$P_{0|0, A} = 100$。\n- **情况 B**：中等初始不确定性，$P_{0|0, B} = 1$。\n\n在时间步长 $k=1$ 时，从传感器接收到一个测量值，得到 $z_1 = 12$。\n\n你的任务是在处理测量值 $z_1$ 后，计算情况 A 和情况 B 的更新后估计误差协方差 $P_{1|1}$。最终答案应该是一个包含两个元素的行矩阵 $[P_{1|1, A}, P_{1|1, B}]$，其中第一个元素对应情况 A，第二个元素对应情况 B。将你的数值答案四舍五入到三位有效数字。", "solution": "我们使用标量卡尔曼滤波器协方差递归。协方差的时间更新（预测）为\n$$\nP_{k+1|k} = A P_{k|k} A^{\\top} + Q.\n$$\n当 $A=1$ 时，这简化为\n$$\nP_{k+1|k} = P_{k|k} + Q.\n$$\n测量更新使用新息协方差\n$$\nS_{k+1} = H P_{k+1|k} H^{\\top} + R,\n$$\n卡尔曼增益\n$$\nK_{k+1} = P_{k+1|k} H^{\\top} S_{k+1}^{-1},\n$$\n以及后验协方差\n$$\nP_{k+1|k+1} = (I - K_{k+1} H) P_{k+1|k}.\n$$\n对于 $H=1$ 的标量情况，这些变为\n$$\nS_{k+1} = P_{k+1|k} + R,\\quad K_{k+1} = \\frac{P_{k+1|k}}{P_{k+1|k} + R},\\quad P_{k+1|k+1} = \\left(1 - \\frac{P_{k+1|k}}{P_{k+1|k} + R}\\right) P_{k+1|k}.\n$$\n因此，\n$$\nP_{k+1|k+1} = \\frac{R\\,P_{k+1|k}}{P_{k+1|k} + R}.\n$$\n\n应用于 $k=0 \\to 1$，其中 $Q=0.1$ 和 $R=0.5$。\n\n情况 A：$P_{0|0,A} = 100$。\n预测：\n$$\nP_{1|0,A} = 100 + 0.1 = 100.1.\n$$\n更新：\n$$\nP_{1|1,A} = \\frac{0.5 \\times 100.1}{100.1 + 0.5} = \\frac{50.05}{100.6} = \\frac{1001}{2012} \\approx 0.497515 \\;\\Rightarrow\\; 0.498\\ \\text{to three significant figures}.\n$$\n\n情况 B：$P_{0|0,B} = 1$。\n预测：\n$$\nP_{1|0,B} = 1 + 0.1 = 1.1.\n$$\n更新：\n$$\nP_{1|1,B} = \\frac{0.5 \\times 1.1}{1.1 + 0.5} = \\frac{0.55}{1.6} = 0.34375 \\;\\Rightarrow\\; 0.344\\ \\text{to three significant figures}.\n$$\n\n注意，测量值 $z_{1}$ 会影响状态估计，但不会影响协方差；因此它不参与 $P_{1|1}$ 的计算。", "answer": "$$\\boxed{\\begin{pmatrix}0.498  0.344\\end{pmatrix}}$$", "id": "1589190"}, {"introduction": "现在，我们将综合前面学到的知识，来解决一个更具挑战性的经典控制问题：稳定一个本身不稳定且测量过程伴随噪声的系统。这个问题完美地体现了线性二次高斯（LQG）控制器的威力。你将应用控制理论中著名的“分离原理”，即分别独立地设计一个 LQR 控制器和一个卡尔曼滤波器，然后将它们组合起来，构建一个完整的 LQG 控制器。这个练习不仅是对 LQR 和卡尔曼滤波器知识的综合运用，也是对 LQG 控制框架核心思想的一次完整实践。[@problem_id:1589180]", "problem": "一位工程师的任务是稳定一个简单但本质上不稳定的离散时间过程。该过程的状态（在时间步 $k$ 表示为 $x_k$）根据以下线性差分方程演化：\n$$x_{k+1} = 1.2 x_k + u_k + w_k$$\n其中 $u_k$ 是在时间步 $k$ 施加的控制输入。项 $w_k$ 代表过程噪声，建模为均值为零、方差恒为 $Q = 0.5$ 的高斯白噪声序列。\n\n状态 $x_k$ 无法直接测量。取而代之的是，一个传感器提供带噪声的测量值 $y_k$，由下式给出：\n$$y_k = x_k + v_k$$\n其中 $v_k$ 是测量噪声，建模为均值为零、方差恒为 $R = 0.2$ 的高斯白噪声序列。噪声序列 $w_k$ 和 $v_k$ 彼此不相关，也与初始状态 $x_0$ 不相关。\n\n控制目标是设计一个控制器来稳定该系统，同时最小化无限时域二次型成本函数：\n$$J = \\sum_{k=0}^{\\infty} (q x_k^2 + r u_k^2)$$\n其中加权因子为 $q=1$ 和 $r=1$。所得的控制器是一个稳态线性二次高斯（LQG）控制器。该控制器架构使用状态估计器（卡尔曼滤波器）生成状态的估计值 $\\hat{x}_{k|k}$，然后将其用于线性反馈律。\n\n稳态控制器由两个恒定增益完全表征：\n1. 状态反馈增益 $K$，用于控制律 $u_k = -K \\hat{x}_{k|k}$。\n2. 观测器（卡尔曼）增益 $L$，用于状态估计更新方程 $\\hat{x}_{k|k} = \\hat{x}_{k|k-1} + L(y_k - C\\hat{x}_{k|k-1})$，对于此系统 $C=1$。\n\n确定稳态反馈增益 $K$ 和稳态卡尔曼增益 $L$ 的数值。将你的答案四舍五入到四位有效数字。你的最终答案应该是一个行矩阵，包含 $K$ 的值，后跟 $L$ 的值。", "solution": "我们将系统和成本重写为标准标量 LQG 形式。对象是 $x_{k+1} = a x_{k} + b u_{k} + w_{k}$，其中 $a=1.2, b=1$，输出是 $y_{k} = C x_{k} + v_{k}$，其中 $C=1$。噪声方差为 $\\operatorname{Var}(w_{k})=Q=0.5$ 和 $\\operatorname{Var}(v_{k})=R=0.2$。LQR 成本是 $J=\\sum_{k=0}^{\\infty} (q x_{k}^{2} + r u_{k}^{2})$，其中 $q=1$ 和 $r=1$。\n\n根据分离原理，稳态 LQG 控制器可通过独立求解以下两个问题得到：\n- 用于求解状态成本矩阵 $S$ 和反馈增益 $K$ 的离散时间 LQR 代数 Riccati 方程 (DARE)，以及\n- 用于求解先验误差协方差 $P$ 和卡尔曼增益 $L$ 的稳态卡尔曼滤波器 Riccati 方程。\n\nLQR 设计（反馈增益 K）。对于标量系统，DARE 为\n$$\nS = a^{2} S - \\frac{a^{2} S^{2}}{r + b^{2} S} + q.\n$$\n两边同乘以 $(r + b^{2} S)$ 并化简，得到关于 $S$ 的二次方程：\n$$\nS^{2} + S\\big(r(1 - a^{2}) - q\\big) - q r = 0.\n$$\n当 $a=1.2, b=1, q=1, r=1$ 时，\n$$\nS^{2} - 1.44 S - 1 = 0,\n$$\n其正根为\n$$\nS = \\frac{1.44 + \\sqrt{1.44^{2} + 4}}{2} = \\frac{1.44 + \\sqrt{6.0736}}{2} \\approx 1.95223374.\n$$\n稳态 LQR 增益为\n$$\nK = \\frac{b a S}{r + b^{2} S} = \\frac{a S}{r + S}.\n$$\n代入 $a=1.2, r=1, S\\approx 1.95223374$，\n$$\nK \\approx \\frac{1.2 \\times 1.95223374}{1 + 1.95223374} \\approx 0.7935 \\quad \\text{(四位有效数字)}.\n$$\n\n卡尔曼滤波器设计（观测器增益 L）。令 $P$ 表示稳态先验误差协方差 $P_{k|k-1}$。稳态关系式为\n$$\nP = a^{2} P^{+} + Q,\\quad P^{+} = (1 - L) P,\\quad L = \\frac{P}{P + R}.\n$$\n消去 $P^{+}$ 和 $L$ 得到\n$$\nP = a^{2} \\frac{P R}{P + R} + Q.\n$$\n乘以 $(P + R)$ 并重新整理，得到关于 $P$ 的二次方程：\n$$\nP^{2} + P\\big(R(1 - a^{2}) - Q\\big) - Q R = 0.\n$$\n当 $a=1.2, Q=0.5, R=0.2$ 时，\n$$\nP^{2} - 0.588 P - 0.1 = 0,\n$$\n其正根为\n$$\nP = \\frac{0.588 + \\sqrt{0.588^{2} + 0.4}}{2} = \\frac{0.588 + \\sqrt{0.745744}}{2} \\approx 0.725782345.\n$$\n那么稳态卡尔曼增益为\n$$\nL = \\frac{P}{P + R} \\approx \\frac{0.725782345}{0.725782345 + 0.2} \\approx 0.7840 \\quad \\text{(四位有效数字)}.\n$$\n\n因此，稳态 LQG 增益为 $K \\approx 0.7935$ 和 $L \\approx 0.7840$，按要求保留四位有效数字。", "answer": "$$\\boxed{\\begin{pmatrix}0.7935  0.7840\\end{pmatrix}}$$", "id": "1589180"}]}