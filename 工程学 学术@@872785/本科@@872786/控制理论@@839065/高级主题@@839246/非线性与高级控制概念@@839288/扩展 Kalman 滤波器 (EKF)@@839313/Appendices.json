{"hands_on_practices": [{"introduction": "扩展卡尔曼滤波器（EKF）通过在线性化非线性系统来解决状态估计问题。这个过程的第一步，也是最基本的一步，就是计算雅可比矩阵。在本练习中 [@problem_id:1574777]，我们将为一个非线性动力学系统计算状态转移雅可比矩阵，这是EKF预测步骤的基石。", "problem": "在分析非线性动力学系统以应用于状态估计等领域时，一种常用的技术是围绕标称状态轨迹进行线性化。这是推导扩展卡尔曼滤波器 (EKF) 方程的一个基础步骤。\n\n考虑一个离散时间非线性系统，其在时间步 $k$ 的状态由向量 $x_k = \\begin{pmatrix} p_k \\\\ q_k \\end{pmatrix}$ 表示。该系统的状态根据非线性函数 $f(x_k)$ 演化，使得 $x_{k+1} = f(x_k)$，定义如下：\n$$\nx_{k+1} = \\begin{pmatrix} p_{k+1} \\\\ q_{k+1} \\end{pmatrix} = f(p_k, q_k) = \\begin{pmatrix} p_k^{2} - q_k \\\\ p_k + \\sin(q_k) \\end{pmatrix}\n$$\n该系统的局部线性近似由状态转移函数的雅可比矩阵描述，通常表示为 $F_k$。该矩阵由函数 $f$ 相对于状态向量 $x_k$ 各分量的偏导数定义。\n\n确定雅可比矩阵 $F_k = \\frac{\\partial f}{\\partial x} \\bigg|_{x=x_k}$。将您的答案表示为一个矩阵，其元素是 $p_k$ 和 $q_k$ 的函数。假设任何三角函数的参数都以弧度为单位。", "solution": "给定离散时间非线性系统，其状态为 $x_{k} = \\begin{pmatrix} p_{k} \\\\ q_{k} \\end{pmatrix}$，状态转移函数为\n$$\nf(p_{k}, q_{k}) = \\begin{pmatrix} f_{1}(p_{k}, q_{k}) \\\\ f_{2}(p_{k}, q_{k}) \\end{pmatrix} = \\begin{pmatrix} p_{k}^{2} - q_{k} \\\\ p_{k} + \\sin(q_{k}) \\end{pmatrix}.\n$$\n雅可比矩阵 $F_{k} = \\frac{\\partial f}{\\partial x}\\bigg|_{x=x_{k}}$ 汇集了函数 $f$ 各分量相对于状态变量的一阶偏导数。根据定义，其元素为\n$$\n[F_{k}]_{ij} = \\frac{\\partial f_{i}}{\\partial x_{j}} \\bigg|_{(p_{k}, q_{k})},\n$$\n其中 $x_{1} = p_{k}$ 且 $x_{2} = q_{k}$。\n\n计算偏导数：\n- 对于 $f_{1}(p_{k}, q_{k}) = p_{k}^{2} - q_{k}$，使用幂法则和线性性质，\n$$\n\\frac{\\partial f_{1}}{\\partial p_{k}} = 2 p_{k}, \\qquad \\frac{\\partial f_{1}}{\\partial q_{k}} = -1.\n$$\n- 对于 $f_{2}(p_{k}, q_{k}) = p_{k} + \\sin(q_{k})$，使用线性性质以及 $\\frac{d}{dq}\\sin(q) = \\cos(q)$（其中 $q$ 以弧度为单位），\n$$\n\\frac{\\partial f_{2}}{\\partial p_{k}} = 1, \\qquad \\frac{\\partial f_{2}}{\\partial q_{k}} = \\cos(q_{k}).\n$$\n\n将这些偏导数组合成雅可比矩阵，得到\n$$\nF_{k} = \\begin{pmatrix}\n\\frac{\\partial f_{1}}{\\partial p_{k}} & \\frac{\\partial f_{1}}{\\partial q_{k}} \\\\\n\\frac{\\partial f_{2}}{\\partial p_{k}} & \\frac{\\partial f_{2}}{\\partial q_{k}}\n\\end{pmatrix}\n= \\begin{pmatrix}\n2 p_{k} & -1 \\\\\n1 & \\cos(q_{k})\n\\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix} 2 p_{k} & -1 \\\\ 1 & \\cos(q_{k}) \\end{pmatrix}}$$", "id": "1574777"}, {"introduction": "仅仅会计算雅可比矩阵是不够的，理解它如何影响估计结果同样重要。本练习 [@problem_id:1574759] 旨在建立这种直觉，我们将分析一个非线性测量（例如方位角）如何重塑我们对目标位置的不确定性。通过将协方差矩阵的更新过程可视化为一个不确定性椭圆的变化，我们可以更直观地理解EKF的更新步骤。", "problem": "一架自主无人机悬停在一个静止位置，我们将其定义为二维笛卡尔坐标系的原点 $(0,0)$。它的任务是估计地面上一个静止目标的位置。目标的状态由向量 $x = [p_x, p_y]^T$ 表示。\n\n最初，无人机对目标位置的置信度由一个高斯分布描述，其均值为 $\\hat{x}_{k|k-1}$，协方差矩阵为 $P_{k|k-1}$。初始不确定性是各向同性的，意味着协方差矩阵的形式为 $P_{k|k-1} = \\sigma^2 I$，其中 $\\sigma^2$ 是一个正常数，$I$ 是 2x2 单位矩阵。这意味着初始不确定性轮廓是一个圆形。\n\n然后，无人机使用其机载相机对目标的方位角进行一次高精度的测量。测量函数为 $h(x) = \\arctan(p_y/p_x)$，测量噪声被建模为一个零均值高斯噪声，其方差非常小，为 $R_k = \\sigma_\\theta^2$。\n\n使用扩展卡尔曼滤波器 (EKF) 基于这次新测量来更新状态估计及其协方差，得到后验估计 $\\hat{x}_{k|k}$ 和后验协方差 $P_{k|k}$。后验协方差矩阵 $P_{k|k}$ 描述了新的不确定性，在二维平面上可以将其可视化为一个椭圆。视线定义为连接无人机（在原点）与目标估计位置的直线。\n\n下列哪个陈述最准确地描述了这个更新后的不确定性椭圆的方向？\n\nA. 椭圆的长轴（最长轴）垂直于视线。\n\nB. 椭圆仍然是一个圆形，但其半径小于初始不确定性。\n\nC. 椭圆的长轴（最长轴）沿着视线。\n\nD. 椭圆的方向与视线成 45 度角。\n\nE. 由于非线性测量，不确定性区域的形状不再是椭圆。", "solution": "设状态为 $x = [p_{x}, p_{y}]^{T}$，先验协方差为 $P_{k|k-1} = \\sigma^{2} I$。测量值为方位角 $\\theta = h(x) = \\arctan(p_{y}/p_{x})$，其噪声协方差为 $R_{k} = \\sigma_{\\theta}^{2}$。假设线性化点 $\\hat{x}_{k|k-1} = [\\hat{p}_{x}, \\hat{p}_{y}]^{T}$ 满足 $\\hat{p}_{x}^{2} + \\hat{p}_{y}^{2} > 0$，以便雅可比矩阵存在。\n\nEKF 使用在 $\\hat{x}_{k|k-1}$ 处计算的测量雅可比矩阵 $H = \\partial h/\\partial x$。使用 $\\arctan(p_{y}/p_{x})$ 对 $p_{x}$ 和 $p_{y}$ 的导数，\n$$\nH = \\left[ \\frac{\\partial h}{\\partial p_{x}} \\;\\; \\frac{\\partial h}{\\partial p_{y}} \\right]\n= \\left[ -\\frac{\\hat{p}_{y}}{\\hat{p}_{x}^{2} + \\hat{p}_{y}^{2}} \\;\\; \\frac{\\hat{p}_{x}}{\\hat{p}_{x}^{2} + \\hat{p}_{y}^{2}} \\right].\n$$\n定义 $r^{2} = \\hat{p}_{x}^{2} + \\hat{p}_{y}^{2}$。则 $H = \\frac{1}{r^{2}}[-\\hat{p}_{y}, \\hat{p}_{x}]$。\n\n新息协方差为\n$$\nS = H P_{k|k-1} H^{T} + R_{k} = \\sigma^{2} H H^{T} + \\sigma_{\\theta}^{2}.\n$$\n因为 $H H^{T} = \\frac{\\hat{p}_{y}^{2} + \\hat{p}_{x}^{2}}{r^{4}} = \\frac{1}{r^{2}}$，我们得到\n$$\nS = \\frac{\\sigma^{2}}{r^{2}} + \\sigma_{\\theta}^{2}.\n$$\n卡尔曼增益为\n$$\nK = P_{k|k-1} H^{T} S^{-1} = \\sigma^{2} I \\, H^{T} S^{-1} = \\frac{\\sigma^{2}}{S} H^{T}.\n$$\n因此 $K$ 与 $H^{T} = \\frac{1}{r^{2}}[-\\hat{p}_{y}, \\hat{p}_{x}]^{T}$ 成正比，后者与视线方向 $[\\hat{p}_{x}, \\hat{p}_{y}]^{T}$ 正交，因为 $[-\\hat{p}_{y}, \\hat{p}_{x}] \\cdot [\\hat{p}_{x}, \\hat{p}_{y}] = 0$。因此，状态更新主要发生在垂直于视线的方向上。\n\n对于标量测量，后验协方差为\n$$\nP_{k|k} = (I - K H) P_{k|k-1} = P_{k|k-1} - K H P_{k|k-1}.\n$$\n计算秩一顶：\n$$\nK H P_{k|k-1} = \\left(\\frac{\\sigma^{2}}{S} H^{T}\\right) \\left(H \\sigma^{2}\\right) = \\frac{\\sigma^{4}}{S} \\left(H^{T} H\\right).\n$$\n注意\n$$\nH^{T} H = \\frac{1}{r^{4}}\n\\begin{bmatrix}\n\\hat{p}_{y}^{2} & -\\hat{p}_{x}\\hat{p}_{y} \\\\\n-\\hat{p}_{x}\\hat{p}_{y} & \\hat{p}_{x}^{2}\n\\end{bmatrix}.\n$$\n引入与径向（视线）和切向（垂直）方向对齐的标准正交基：\n$$\nu_{r} = \\frac{1}{r} \\begin{bmatrix} \\hat{p}_{x} \\\\ \\hat{p}_{y} \\end{bmatrix}, \\quad\nu_{t} = \\frac{1}{r} \\begin{bmatrix} -\\hat{p}_{y} \\\\ \\hat{p}_{x} \\end{bmatrix}.\n$$\n那么 $H = \\frac{1}{r} u_{t}^{T}$ 且 $H^{T} H = \\frac{1}{r^{2}} u_{t} u_{t}^{T}$。因此，\n$$\nP_{k|k} = \\sigma^{2} I - \\frac{\\sigma^{4}}{S} \\cdot \\frac{1}{r^{2}} \\, u_{t} u_{t}^{T}.\n$$\n这表明后验协方差仅在 $u_{t}$ 方向（垂直于视线）上减小，而在 $u_{r}$ 方向（视线方向）上保持不变。具体来说，沿这些主方向的后验方差为\n$$\n\\lambda_{r}^{+} = u_{r}^{T} P_{k|k} u_{r} = \\sigma^{2},\n\\qquad\n\\lambda_{t}^{+} = u_{t}^{T} P_{k|k} u_{t} = \\sigma^{2} - \\frac{\\sigma^{4}}{S} \\cdot \\frac{1}{r^{2}}.\n$$\n因为 $S = \\frac{\\sigma^{2}}{r^{2}} + \\sigma_{\\theta}^{2} > 0$，我们有 $\\lambda_{t}^{+} < \\sigma^{2}$，当 $\\sigma_{\\theta}^{2} \\to 0$ 时，其极限情况为 $\\lambda_{t}^{+} \\to 0$。因此，最大的后验方差沿着视线方向，最小的后验方差垂直于视线方向。因此，更新后的不确定性椭圆的长轴沿着视线方向。\n\n因此，最准确的陈述是长轴沿着视线方向。", "answer": "$$\\boxed{C}$$", "id": "1574759"}, {"introduction": "一个设计良好的滤波器也无法凭空创造信息，它依赖于测量值中包含的关于系统状态的有效信息。本练习 [@problem_id:1574765] 探讨了可观测性这一关键概念，这是评估测量方案有效性的核心。我们将研究一个情景，其中由于测量函数的特性，EKF在某些特定状态点上对部分状态变得“盲目”，这揭示了状态估计算法的一个重要局限性。", "problem": "一位工程师正在为单摆设计一个状态估计器。该单摆由一个质量为 $m$ 的质点和一个长度为 $L$ 的无质量刚性杆组成，在加速度为 $g$ 的均匀引力场中运动。系统在离散时间步 $k$ 的状态由向量 $x_k = [\\theta_k, \\omega_k]^T$ 描述，其中 $\\theta_k$ 是摆锤与垂直向下的夹角，$\\omega_k$ 是其角速度。\n\n系统动力学由非线性微分方程 $\\ddot{\\theta}(t) = -\\frac{g}{L} \\sin(\\theta(t))$ 的离散时间版本建模。与传统的角度或位置传感器不同，这里使用了一种新型传感器，该传感器测量摆锤相对于其最低点（在 $\\theta = 0$ 处）的势能。在时间步 $k$ 的测量值由标量函数给出：\n$$z_k = h(x_k) = m g L (1 - \\cos(\\theta_k))$$\n将实施一个扩展卡尔曼滤波器（EKF）来估计状态 $x_k$。EKF 中的一个关键步骤是在每个时间步对系统和测量模型进行线性化。系统的局部可观测性，它决定了是否可以从测量中推断出状态，取决于这种线性化。\n\n在以下哪种情况下，通过 EKF 中使用的线性化过程，单摆系统的完整状态 $x_k = [\\theta_k, \\omega_k]^T$ 保证*不是*局部可观测的？\n\nA. 当 $\\omega_k = 0$ 时\n\nB. 当 $\\theta_k = \\frac{\\pi}{2} + n\\pi$ 对于任意整数 $n$ 时\n\nC. 当 $\\omega_k = \\sqrt{g/L}$ 时\n\nD. 当 $\\theta_k = n\\pi$ 对于任意整数 $n$ 时\n\nE. 对于任何 $\\theta_k$ 和 $\\omega_k$，系统总是局部可观测的", "solution": "我们写出连续时间动力学和测量方程，以推导 EKF 的线性化。设状态为 $x = [\\theta,\\ \\omega]^{T}$，其动力学方程为\n$$\n\\dot{\\theta}=\\omega,\\qquad \\dot{\\omega}=-\\frac{g}{L}\\sin\\theta,\n$$\n测量方程为\n$$\nz=h(x)=m g L \\left(1-\\cos\\theta\\right).\n$$\n对于 EKF，我们在工作点 $(\\theta_{k},\\ \\omega_{k})$ 附近进行线性化。动力学方程的雅可比矩阵是\n$$\nA=\\frac{\\partial f}{\\partial x}\\bigg|_{x_{k}}=\\begin{pmatrix}\n0 & 1\\\\\n-\\frac{g}{L}\\cos\\theta_{k} & 0\n\\end{pmatrix},\n$$\n测量方程的雅可比矩阵是\n$$\nC=\\frac{\\partial h}{\\partial x}\\bigg|_{x_{k}}=\\begin{pmatrix}\nm g L \\sin\\theta_{k} & 0\n\\end{pmatrix}.\n$$\n线性化系统的局部可观测性由可观测性矩阵的秩决定。对于一个 2 状态系统，只需检查\n$$\n\\mathcal{O}=\\begin{pmatrix}\nC\\\\\nC A\n\\end{pmatrix}.\n$$\n计算\n$$\nC A=\\begin{pmatrix}\nm g L \\sin\\theta_{k} & 0\n\\end{pmatrix}\n\\begin{pmatrix}\n0 & 1\\\\\n-\\frac{g}{L}\\cos\\theta_{k} & 0\n\\end{pmatrix}\n=\\begin{pmatrix}\n0 & m g L \\sin\\theta_{k}\n\\end{pmatrix}.\n$$\n因此\n$$\n\\mathcal{O}=\\begin{pmatrix}\nm g L \\sin\\theta_{k} & 0\\\\\n0 & m g L \\sin\\theta_{k}\n\\end{pmatrix}.\n$$\n因此，当且仅当 $\\sin\\theta_{k}\\neq 0$ 时，$\\operatorname{rank}(\\mathcal{O})=2$；而当 $\\sin\\theta_{k}=0$ 时，$\\operatorname{rank}(\\mathcal{O})=0$。因此，在 EKF 线性化下，当以下条件满足时，完整状态保证不是局部可观测的\n$$\n\\sin\\theta_{k}=0\\quad\\Longleftrightarrow\\quad \\theta_{k}=n\\pi,\\ \\ n\\in\\mathbb{Z}.\n$$\n这个条件与 $\\omega_{k}$ 无关。评估各个选项：\n- A: $\\omega_{k}=0$ 不影响秩；不是充分条件。\n- B: $\\theta_{k}=\\frac{\\pi}{2}+n\\pi$ 使得 $\\sin\\theta_{k}=\\pm 1$；系统可观测。\n- C: $\\omega_{k}=\\sqrt{g/L}$ 与秩无关。\n- D: $\\theta_{k}=n\\pi$ 使得 $\\sin\\theta_{k}=0$；系统不是局部可观测的。\n- E: 错误，因为 D 是一个反例。\n\n因此，正确选项是 D。", "answer": "$$\\boxed{D}$$", "id": "1574765"}]}