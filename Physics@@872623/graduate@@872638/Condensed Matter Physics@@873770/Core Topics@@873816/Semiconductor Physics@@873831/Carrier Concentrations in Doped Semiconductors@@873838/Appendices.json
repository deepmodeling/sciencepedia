{"hands_on_practices": [{"introduction": "Understanding carrier concentrations begins with the interplay between the density of states and the Fermi-Dirac distribution. While the full integral expression is always correct, the non-degenerate (Maxwell-Boltzmann) approximation offers a much simpler analytical form. This exercise [@problem_id:2974885] provides essential practice in determining when this crucial approximation is justified by calculating the chemical potential, $\\mu$, for a realistically doped silicon sample and comparing its position to the conduction band edge, $E_c$.", "problem": "A crystalline silicon sample is doped n-type with shallow donors such that donor compensation is negligible. Assume a single parabolic conduction band valley characterized by the density-of-states effective mass $m_d^{*} = 1.08\\,m_0$, where $m_0$ is the free-electron mass. The temperature is $T = 350\\,\\mathrm{K}$, and the donor concentration is $N_D = 3.00 \\times 10^{17}\\,\\mathrm{cm}^{-3}$. The free-electron mass is $m_0 = 9.1093837 \\times 10^{-31}\\,\\mathrm{kg}$, the Planck constant is $h = 6.62607015 \\times 10^{-34}\\,\\mathrm{J\\,s}$, the Boltzmann constant is $k_B = 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$, and $1\\,\\mathrm{m}^3 = 10^{6}\\,\\mathrm{cm}^3$.\n\nStarting from the parabolic dispersion relation $E(\\mathbf{k}) = E_c + \\hbar^2 k^2/(2 m_d^{*})$, the three-dimensional density of states, and the Fermi–Dirac distribution for electrons, derive the electron concentration $n$ as a function of the reduced chemical potential $\\eta \\equiv (\\mu - E_c)/(k_B T)$. Then, using a trial $n = N_D$ to represent complete donor ionization, determine the value of the dimensionless ratio $(\\mu - E_c)/(k_B T)$ that is consistent with this $n$ and decide whether the nondegenerate (Maxwell–Boltzmann) approximation is justified.\n\nExpress your final answer as the single dimensionless number $(\\mu - E_c)/(k_B T)$, rounded to four significant figures.", "solution": "The problem requires the derivation of the electron concentration $n$ in terms of the reduced chemical potential $\\eta = (\\mu - E_c)/(k_B T)$ for a parabolic conduction band, and then to calculate the value of $\\eta$ for a given n-type silicon sample, finally assessing the validity of the nondegenerate approximation.\n\nFirst, we derive the electron concentration $n$. The number of electrons per unit volume is given by the integral of the density of states per unit volume, $g(E)$, multiplied by the Fermi-Dirac distribution function, $f_{FD}(E)$, over all available energy states in the conduction band.\n$$n = \\int_{E_c}^{\\infty} g(E) f_{FD}(E) dE$$\nThe energy dispersion relation for a single parabolic band is given as $E(\\mathbf{k}) = E_c + \\frac{\\hbar^2 k^2}{2 m_d^{*}}$, where $E_c$ is the conduction band minimum energy. The number of states (including spin degeneracy) per unit volume up to a wavevector magnitude $k$ is $N(k) = 2 \\times \\frac{4/3 \\pi k^3}{(2\\pi)^3} = \\frac{k^3}{3\\pi^2}$.\nExpressing $k$ in terms of energy $E$, we have $k = \\sqrt{2 m_d^{*} (E - E_c)} / \\hbar$. Substituting this into $N(k)$ gives the number of states per unit volume up to energy $E$:\n$$N(E) = \\frac{1}{3\\pi^2} \\left( \\frac{2 m_d^{*} (E - E_c)}{\\hbar^2} \\right)^{3/2}$$\nThe density of states per unit energy per unit volume, $g(E)$, is the derivative of $N(E)$ with respect to energy:\n$$g(E) = \\frac{dN(E)}{dE} = \\frac{1}{2\\pi^2} \\left( \\frac{2 m_d^{*}}{\\hbar^2} \\right)^{3/2} \\sqrt{E - E_c}$$\nThis is valid for $E \\ge E_c$; $g(E) = 0$ for $E  E_c$.\n\nThe Fermi-Dirac distribution function gives the probability of a state at energy $E$ being occupied by an electron:\n$$f_{FD}(E) = \\frac{1}{1 + \\exp\\left(\\frac{E - \\mu}{k_B T}\\right)}$$\nwhere $\\mu$ is the chemical potential (Fermi level).\n\nThe electron concentration $n$ is then:\n$$n = \\int_{E_c}^{\\infty} \\frac{1}{2\\pi^2} \\left( \\frac{2 m_d^{*}}{\\hbar^2} \\right)^{3/2} \\sqrt{E - E_c} \\frac{1}{1 + \\exp\\left(\\frac{E - \\mu}{k_B T}\\right)} dE$$\nTo simplify this integral, we introduce the dimensionless variables $x = (E - E_c)/(k_B T)$ and $\\eta = (\\mu - E_c)/(k_B T)$. Then $E - E_c = x k_B T$, $dE = k_B T dx$, and $(E-\\mu)/(k_B T) = x - \\eta$.\nSubstituting these into the integral for $n$:\n$$n = \\frac{1}{2\\pi^2} \\left( \\frac{2 m_d^{*}}{\\hbar^2} \\right)^{3/2} \\int_{0}^{\\infty} \\sqrt{x k_B T} \\frac{1}{1 + \\exp(x - \\eta)} (k_B T dx)$$\n$$n = \\frac{1}{2\\pi^2} \\left( \\frac{2 m_d^{*} k_B T}{\\hbar^2} \\right)^{3/2} \\int_{0}^{\\infty} \\frac{x^{1/2}}{1 + \\exp(x - \\eta)} dx$$\nThis expression can be written in the standard form $n = N_c F_{1/2}(\\eta)$, where $N_c$ is the effective density of states in the conduction band and $F_{1/2}(\\eta)$ is the Fermi-Dirac integral of order $1/2$. The effective density of states is defined as:\n$$N_c = 2 \\left( \\frac{m_d^{*} k_B T}{2 \\pi \\hbar^2} \\right)^{3/2}$$\nAnd the Fermi-Dirac integral is:\n$$F_{1/2}(\\eta) = \\frac{2}{\\sqrt{\\pi}} \\int_{0}^{\\infty} \\frac{x^{1/2}}{1 + \\exp(x - \\eta)} dx$$\nThis completes the required derivation.\n\nNext, we calculate the value of $\\eta$. We are given the assumption of complete ionization for the shallow donors, which implies that the electron concentration $n$ is equal to the donor concentration $N_D$.\n$$n = N_D = 3.00 \\times 10^{17}\\,\\mathrm{cm}^{-3} = 3.00 \\times 10^{23}\\,\\mathrm{m}^{-3}$$\nWe must solve the equation $N_D = N_c F_{1/2}(\\eta)$ for $\\eta$. First, we compute the numerical value of $N_c$ using the provided constants, working in SI units.\n$m_d^{*} = 1.08\\,m_0 = 1.08 \\times (9.1093837 \\times 10^{-31}\\,\\mathrm{kg}) = 9.83813 \\times 10^{-31}\\,\\mathrm{kg}$.\n$T = 350\\,\\mathrm{K}$.\n$k_B = 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$.\n$\\hbar = h/(2\\pi) = (6.62607015 \\times 10^{-34}\\,\\mathrm{J\\,s})/(2\\pi) = 1.05457 \\times 10^{-34}\\,\\mathrm{J\\,s}$.\n\n$$N_c = 2 \\left( \\frac{(9.83813 \\times 10^{-31}\\,\\mathrm{kg}) (1.380649 \\times 10^{-23}\\,\\mathrm{J/K}) (350\\,\\mathrm{K})}{2 \\pi (1.05457 \\times 10^{-34}\\,\\mathrm{J\\,s})^2} \\right)^{3/2}$$\n$$N_c = 2 \\left( \\frac{4.75385 \\times 10^{-51}\\,\\mathrm{J^2 s^2 m^{-2}}}{6.98774 \\times 10^{-68}\\,\\mathrm{J^2 s^2}} \\right)^{3/2} = 2 (6.80289 \\times 10^{16}\\,\\mathrm{m}^{-2})^{3/2}$$\n$$N_c = 2 (1.77464 \\times 10^{25}\\,\\mathrm{m}^{-3}) = 3.54928 \\times 10^{25}\\,\\mathrm{m}^{-3}$$\nFrom $N_D = N_c F_{1/2}(\\eta)$, we find the required value of the Fermi-Dirac integral:\n$$F_{1/2}(\\eta) = \\frac{N_D}{N_c} = \\frac{3.00 \\times 10^{23}\\,\\mathrm{m}^{-3}}{3.54928 \\times 10^{25}\\,\\mathrm{m}^{-3}} = 0.00845236$$\nNow we must determine if the nondegenerate (Maxwell-Boltzmann) approximation is justified. This approximation is valid when $\\mu$ is several $k_B T$ below $E_c$, i.e., $\\eta \\ll 0$. In this limit, $f_{FD}(E) \\approx \\exp(-(E-\\mu)/(k_B T))$, and the Fermi-Dirac integral simplifies to $F_{1/2}(\\eta) \\approx \\exp(\\eta)$.\nUsing this approximation, we get an estimate for $\\eta$:\n$$\\eta_{approx} = \\ln(F_{1/2}(\\eta)) \\approx \\ln(0.00845236) \\approx -4.773$$\nSince $\\eta_{approx} \\approx -4.773$, which is significantly less than $0$, the Fermi level is located deep in the band gap, about $4.77 k_B T$ below the conduction band edge. The condition for nondegeneracy is well satisfied, and the Maxwell-Boltzmann approximation is justified. The error incurred by this approximation is small, on the order of $F_{1/2}(\\eta)/(2\\sqrt{2})$, which is less than $0.3\\%$.\n\nTo obtain a more precise value for $\\eta$ that is consistent with the full Fermi-Dirac statistics as required, we can use a series expansion to invert the relation $y = F_{1/2}(\\eta)$, where $y = N_D/N_c$. For small $y$, an accurate expansion is $\\exp(\\eta) \\approx y + \\frac{y^2}{2\\sqrt{2}}$.\nUsing our value $y = 0.00845236$:\n$$\\exp(\\eta) \\approx 0.00845236 + \\frac{(0.00845236)^2}{2\\sqrt{2}} = 0.00845236 + \\frac{7.14424 \\times 10^{-5}}{2.82843}$$\n$$\\exp(\\eta) \\approx 0.00845236 + 0.000025259 = 0.00847762$$\nNow, we take the natural logarithm to find $\\eta$:\n$$\\eta = \\ln(0.00847762) \\approx -4.7703$$\nRounding to four significant figures, the value of the reduced chemical potential is $-4.770$.", "answer": "$$\\boxed{-4.770}$$", "id": "2974885"}, {"introduction": "While analytical approximations are invaluable for gaining physical intuition, modern semiconductor physics often requires precise numerical solutions, especially in cases of heavy doping or low temperatures. This practice [@problem_id:2974780] guides you through building a numerical solver from first principles to find the chemical potential without relying on the non-degenerate approximation. By implementing the full Fermi-Dirac integrals and a root-finding algorithm, you will develop a foundational tool for accurately modeling carrier statistics in both non-degenerate and degenerate semiconductors.", "problem": "You are asked to design and implement a numerical solver that determines the chemical potential $\\mu$ (the equilibrium Fermi level) in a doped semiconductor at a specified temperature, enforcing charge neutrality and using full Fermi-Dirac statistics for electrons and holes. All energies must be treated in electronvolts. The computation must be based only on first-principles definitions of the density of states and the Fermi-Dirac distribution, not on non-degenerate (Boltzmann) approximations.\n\nFundamental basis to use:\n- The conduction-band density of states for a parabolic band with density-of-states effective mass $m_c^*$ is given by\n$$\nD_c(E) = \\frac{1}{2\\pi^2}\\left(\\frac{2 m_c^*}{\\hbar^2}\\right)^{3/2} \\sqrt{E - E_c}\\quad \\text{for } E \\ge E_c,\n$$\nand zero otherwise, where $E_c$ is the conduction band edge. The hole density of states in the valence band with density-of-states effective mass $m_v^*$ is analogous.\n- The Fermi-Dirac distribution is\n$$\nf(E,\\mu,T) = \\frac{1}{1+\\exp\\!\\left(\\frac{E-\\mu}{k_{\\mathrm{B}} T}\\right)},\n$$\nwhere $k_{\\mathrm{B}}$ is the Boltzmann constant and $T$ is the temperature.\n- The electron concentration $n$ and hole concentration $p$ are the integrals over the respective bands:\n$$\nn(\\mu,T) = \\int_{E_c}^{\\infty} D_c(E)\\,f(E,\\mu,T)\\,dE,\\quad\np(\\mu,T) = \\int_{-\\infty}^{E_v} D_v(E)\\,[1-f(E,\\mu,T)]\\,dE,\n$$\nwith $E_v$ the valence band edge.\n- For parabolic bands, these integrals reduce to the so-called Fermi-Dirac integral of order $\\tfrac{1}{2}$. Define the reduced chemical potentials\n$$\n\\eta_c = \\frac{\\mu - E_c}{k_{\\mathrm{B}}T},\\qquad \\eta_v = \\frac{E_v - \\mu}{k_{\\mathrm{B}}T},\n$$\nand the dimensionless Fermi-Dirac integral of order $\\tfrac{1}{2}$ as\n$$\nF_{1/2}(\\eta) = \\frac{2}{\\sqrt{\\pi}} \\int_0^{\\infty} \\frac{\\sqrt{x}}{1+\\exp(x-\\eta)}\\,dx.\n$$\nThen, with the effective density of states\n$$\nN_c(T) = 2\\left(\\frac{2\\pi m_c^* k_{\\mathrm{B}} T}{h^2}\\right)^{3/2},\\qquad\nN_v(T) = 2\\left(\\frac{2\\pi m_v^* k_{\\mathrm{B}} T}{h^2}\\right)^{3/2},\n$$\nthe concentrations can be written as\n$$\nn(\\mu,T) = N_c(T)\\,F_{1/2}(\\eta_c),\\qquad\np(\\mu,T) = N_v(T)\\,F_{1/2}(\\eta_v).\n$$\nHere $h$ is Planck’s constant. When computed in the International System of Units (SI), $N_c(T)$ and $N_v(T)$ are in $\\mathrm{m^{-3}}$; you must convert them to $\\mathrm{cm^{-3}}$ by dividing by $10^6$.\n- Donor ionization is governed by Fermi-Dirac statistics for the localized donor level $E_D = E_c - \\Delta_D$. The concentration of ionized donors, $N_D^+$, is given by:\n$$ N_D^+(\\mu, T) = \\frac{N_D}{1 + g_D \\exp\\left(\\frac{\\mu - E_D}{k_B T}\\right)} $$\nwhere $N_D$ is the total donor concentration and $g_D$ is the **degeneracy factor** for the donor level. This factor accounts for the multiple possible states for a neutral donor (e.g., spin-up or spin-down electron), and a value of $g_D = 2$ is appropriate for shallow donors in many semiconductors.\n- Assume no acceptors are present if $N_A = 0$. Under charge neutrality, one must enforce\n$$\nn(\\mu,T) = p(\\mu,T) + N_D^+(\\mu,T) - N_A^-(\\mu,T),\n$$\nand in this task you will have $N_A = 0$ so that the neutrality simplifies to $n(\\mu,T) = p(\\mu,T) + N_D^+(\\mu,T)$.\n\nYour program must:\n- Implement a numerical evaluation of $F_{1/2}(\\eta)$ using direct quadrature of its defining integral, not using any non-degenerate limit approximation.\n- Compute $N_c(T)$ and $N_v(T)$ from the given effective masses and constants, and convert to $\\mathrm{cm^{-3}}$.\n- Solve for $\\mu$ by finding the root of the charge neutrality equation. Take the valence band edge as $E_v = 0$ so all energies, including the final $\\mu$, are referenced to the valence band edge and expressed in electronvolts.\n\nPhysical and numerical units:\n- Use $\\mathrm{K}$ for temperature, $\\mathrm{eV}$ for energy, and $\\mathrm{cm^{-3}}$ for number densities.\n- Express the final $\\mu$ values in $\\mathrm{eV}$ as floating-point numbers.\n\nTest suite:\nProvide a program that computes $\\mu$ for the following three parameter sets, which explore different regimes. In all cases, set $E_v = 0$ and $E_c = E_g$.\n1. Case A (moderate $n$-type, shallow donors): $T = 200\\,\\mathrm{K}$, $E_g = 1.12\\,\\mathrm{eV}$, $N_D = 10^{16}\\,\\mathrm{cm^{-3}}$, $N_A = 0\\,\\mathrm{cm^{-3}}$, $\\Delta_D = 30\\,\\mathrm{meV} = 0.030\\,\\mathrm{eV}$, $g_D = 2$, $m_c^* = 1.08\\,m_0$, $m_v^* = 0.81\\,m_0$, where $m_0$ is the free-electron mass.\n2. Case B (degenerate $n$-type): $T = 200\\,\\mathrm{K}$, $E_g = 1.12\\,\\mathrm{eV}$, $N_D = 10^{19}\\,\\mathrm{cm^{-3}}$, $N_A = 0\\,\\mathrm{cm^{-3}}$, $\\Delta_D = 15\\,\\mathrm{meV} = 0.015\\,\\mathrm{eV}$, $g_D = 2$, $m_c^* = 1.08\\,m_0$, $m_v^* = 0.81\\,m_0$.\n3. Case C (lightly doped, close to intrinsic): $T = 200\\,\\mathrm{K}$, $E_g = 1.12\\,\\mathrm{eV}$, $N_D = 10^{12}\\,\\mathrm{cm^{-3}}$, $N_A = 0\\,\\mathrm{cm^{-3}}$, $\\Delta_D = 30\\,\\mathrm{meV} = 0.030\\,\\mathrm{eV}$, $g_D = 2$, $m_c^* = 1.08\\,m_0$, $m_v^* = 0.81\\,m_0$.\n\nAlgorithmic requirements:\n- Use a robust bracketing method to find the root $\\mu$ within the interval $[-0.5, E_g+0.5]$ in $\\mathrm{eV}$, refining as needed.\n- For numerical stability in evaluating $N_D^+(\\mu,T)$, implement a strategy that avoids overflow for extreme arguments in the exponential.\n\nFinal output format:\nYour program should produce a single line of output containing the three computed chemical potentials for the above cases, expressed in $\\mathrm{eV}$, as a comma-separated list enclosed in square brackets. For example: $[0.123456,0.654321,0.000001]$. Round each entry to six decimal places.", "solution": "The objective of this problem is to determine the chemical potential $\\mu$ (also known as the Fermi level) in an $n$-type doped semiconductor at a given temperature $T$. The value of $\\mu$ is dictated by the principle of charge neutrality, which states that the total negative charge density must equal the total positive charge density. The solution must be derived from fundamental principles using Fermi-Dirac statistics, without resorting to the non-degenerate (Boltzmann) approximation.\n\nThe charge neutrality condition, assuming no acceptors are present ($N_A=0$), is given by:\n$$\nn(\\mu,T) = p(\\mu,T) + N_D^+(\\mu,T)\n$$\nHere, $n(\\mu,T)$ is the concentration of free electrons in the conduction band, $p(\\mu,T)$ is the concentration of holes in the valence band, and $N_D^+(\\mu,T)$ is the concentration of ionized donor atoms. Each of these concentrations is a function of the chemical potential $\\mu$ and the temperature $T$. Our goal is to find the value of $\\mu$ that satisfies this equation.\n\nTo solve for $\\mu$, we define a residual function $f(\\mu)$ whose root corresponds to the solution of the neutrality equation:\n$$\nf(\\mu) = n(\\mu,T) - p(\\mu,T) - N_D^+(\\mu,T) = 0\n$$\nLet us analyze each term in this equation based on the provided physical model.\n\n**Electron and Hole Concentrations**\n\nThe electron concentration $n$ and hole concentration $p$ are determined by integrating the product of the density of states ($D_c(E)$ for electrons, $D_v(E)$ for holes) and the probability of occupation. For electrons, this is the Fermi-Dirac distribution $f(E, \\mu, T)$, and for holes, it is the probability of a state being empty, $1 - f(E, \\mu, T)$.\n\nAs stated, these integrals can be expressed in a compact form using the Fermi-Dirac integral of order $\\frac{1}{2}$, denoted as $F_{1/2}(\\eta)$:\n$$\nF_{1/2}(\\eta) = \\frac{2}{\\sqrt{\\pi}} \\int_0^{\\infty} \\frac{\\sqrt{x}}{1+\\exp(x-\\eta)}\\,dx\n$$\nThe electron and hole concentrations are then given by:\n$$\nn(\\mu,T) = N_c(T) F_{1/2}(\\eta_c)\n$$\n$$\np(\\mu,T) = N_v(T) F_{1/2}(\\eta_v)\n$$\nwhere $N_c(T)$ and $N_v(T)$ are the effective densities of states in the conduction and valence bands, respectively. They are calculated using:\n$$\nN_c(T) = 2\\left(\\frac{2\\pi m_c^* k_{\\mathrm{B}} T}{h^2}\\right)^{3/2}\n$$\n$$\nN_v(T) = 2\\left(\\frac{2\\pi m_v^* k_{\\mathrm{B}} T}{h^2}\\right)^{3/2}\n$$\nHere, $m_c^*$ and $m_v^*$ are the density-of-states effective masses for the conduction and valence bands, $k_{\\mathrm{B}}$ is the Boltzmann constant, and $h$ is Planck's constant. These formulas yield results in $\\mathrm{m^{-3}}$ when using SI units, which must be converted to $\\mathrm{cm^{-3}}$ by multiplying by $10^{-6}$.\n\nThe arguments to the Fermi-Dirac integral, $\\eta_c$ and $\\eta_v$, are the reduced chemical potentials, which measure the position of $\\mu$ relative to the band edges in units of thermal energy $k_{\\mathrm{B}}T$:\n$$\n\\eta_c = \\frac{\\mu - E_c}{k_{\\mathrm{B}}T} \\qquad \\eta_v = \\frac{E_v - \\mu}{k_{\\mathrm{B}}T}\n$$\nThe problem specifies setting the valence band edge $E_v = 0$, so the conduction band edge is $E_c = E_g$, where $E_g$ is the band gap energy.\n\n**Ionized Donor Concentration**\n\nThe concentration of ionized donors, $N_D^+$, is the total donor concentration $N_D$ multiplied by the probability that a donor state is empty (ionized). This probability is derived from Fermi-Dirac statistics applied to a discrete energy level $E_D$ with a degeneracy factor $g_D$. The donor energy level is located at an energy $\\Delta_D$ below the conduction band edge, i.e., $E_D = E_c - \\Delta_D$. The concentration of ionized donors is given by the standard formula:\n$$\nN_D^+(\\mu, T) = \\frac{N_D}{1 + g_D \\exp\\left(\\frac{\\mu - E_D}{k_B T}\\right)}\n$$\nFor numerical stability, this expression must be handled carefully. Let $y = (\\mu - E_D)/(k_{\\mathrm{B}}T)$. If $y$ is large and positive, $\\exp(y)$ can cause a numerical overflow. In this case, an equivalent form is used:\n$$\nN_D^+(\\mu, T) = N_D \\frac{\\exp(-y)}{\\exp(-y) + g_D}\n$$\nThis form is stable for $y > 0$. For $y \\le 0$, the original expression is numerically safe.\n\n**Numerical Solution Strategy**\n\nThe problem is now reduced to finding the root $\\mu$ of the function $f(\\mu) = n(\\mu,T) - p(\\mu,T) - N_D^+(\\mu,T)$. The components of this function are:\n- $n(\\mu,T)$: A monotonically increasing function of $\\mu$.\n- $-p(\\mu,T)$: Also a monotonically increasing function of $\\mu$ (since $p$ decreases with $\\mu$).\n- $-N_D^+(\\mu,T)$: Also a monotonically increasing function of $\\mu$ (since $N_D^+$ decreases with $\\mu$).\n\nSince $f(\\mu)$ is a sum of strictly monotonically increasing functions, it is itself strictly monotonic. This property guarantees that if a root exists, it is unique. Further, as $\\mu \\to -\\infty$, $f(\\mu) \\to -\\infty$, and as $\\mu \\to +\\infty$, $f(\\mu) \\to +\\infty$. By the Intermediate Value Theorem, a unique root must exist.\n\nThis structure makes the problem well-suited for a bracketing root-finding algorithm, such as the Brent-Dekker method. The algorithm requires an initial interval $[\\mu_a, \\mu_b]$ where $f(\\mu_a)$ and $f(\\mu_b)$ have opposite signs. The specified search interval $[-0.5, E_g+0.5]\\,\\mathrm{eV}$ is sufficiently wide to bracket the root for the given physical parameters.\n\nThe overall computational procedure is as follows:\n1.  Define all necessary physical constants ($m_0, h, k_B, e$) and use them to derive working constants, such as $k_B$ in units of $\\mathrm{eV/K}$.\n2.  For each test case, set the material parameters ($E_g, m_c^*, m_v^*, N_D, \\Delta_D, g_D$) and temperature $T$.\n3.  Implement a function to numerically compute the Fermi-Dirac integral $F_{1/2}(\\eta)$ using quadrature, for instance, `scipy.integrate.quad`.\n4.  Implement functions to calculate $N_c(T)$, $N_v(T)$, $n(\\mu,T)$, $p(\\mu,T)$, and the numerically stable $N_D^+(\\mu,T)$. All energies are in $\\mathrm{eV}$ and concentrations in $\\mathrm{cm^{-3}}$.\n5.  Define the residual function $f(\\mu)$ that represents the charge neutrality condition.\n6.  Use a robust root-finding algorithm, `scipy.optimize.brentq`, to solve $f(\\mu)=0$ for $\\mu$ within the specified bracket.\n7.  Collect the computed values of $\\mu$ for all test cases and format them according to the output specification.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate, optimize\n\ndef solve():\n    \"\"\"\n    Computes the chemical potential (Fermi level) in a doped semiconductor by\n    solving the charge neutrality equation using full Fermi-Dirac statistics.\n    \"\"\"\n\n    # Physical constants\n    M0 = 9.1093837e-31  # Free electron mass, kg\n    H = 6.62607015e-34    # Planck's constant, J*s\n    KB_J_K = 1.380649e-23  # Boltzmann constant, J/K\n    E_CHARGE = 1.602176634e-19 # Elementary charge, C\n    KB_EV_K = KB_J_K / E_CHARGE # Boltzmann constant, eV/K\n\n    def fermi_dirac_integral_half(eta):\n        \"\"\"\n        Computes the Fermi-Dirac integral of order 1/2, F_{1/2}(eta).\n        The integral is defined as (2/sqrt(pi)) * integral from 0 to inf of\n        sqrt(x) / (1 + exp(x - eta)) dx.\n        \"\"\"\n        integrand = lambda x: np.sqrt(x) / (1.0 + np.exp(x - eta))\n        # scipy.integrate.quad returns a tuple (result, error_estimate)\n        result, _ = integrate.quad(integrand, 0, np.inf)\n        return (2.0 / np.sqrt(np.pi)) * result\n\n    def effective_dos(T, m_star_m0):\n        \"\"\"\n        Computes the effective density of states (Nc or Nv) in cm^-3.\n        m_star_m0 is the effective mass as a multiple of the free electron mass m0.\n        \"\"\"\n        m_star = m_star_m0 * M0\n        # Calculate in SI units (m^-3) first\n        dos_si = 2.0 * ((2.0 * np.pi * m_star * KB_J_K * T) / (H**2))**1.5\n        # Convert from m^-3 to cm^-3\n        return dos_si * 1e-6\n\n    def electron_concentration(mu, T, Ec, Nc_T_val):\n        \"\"\"Computes electron concentration n in cm^-3.\"\"\"\n        kT_eV = KB_EV_K * T\n        eta_c = (mu - Ec) / kT_eV\n        return Nc_T_val * fermi_dirac_integral_half(eta_c)\n\n    def hole_concentration(mu, T, Ev, Nv_T_val):\n        \"\"\"Computes hole concentration p in cm^-3.\"\"\"\n        kT_eV = KB_EV_K * T\n        eta_v = (Ev - mu) / kT_eV\n        return Nv_T_val * fermi_dirac_integral_half(eta_v)\n\n    def ionized_donor_concentration(mu, T, ND, ED, gD):\n        \"\"\"\n        Computes ionized donor concentration ND+ in cm^-3 using a correct\n        and numerically stable implementation.\n        The formula is N_D / (1 + gD * exp((mu - ED)/kBT)).\n        \"\"\"\n        kT_eV = KB_EV_K * T\n        y = (mu - ED) / kT_eV\n\n        if y > 35: # Use stable form for large positive y to prevent overflow\n            prob_ionized = np.exp(-y) / (np.exp(-y) + gD)\n        else: # Use standard form for non-large y\n            prob_ionized = 1.0 / (1.0 + gD * np.exp(y))\n            \n        return ND * prob_ionized\n\n    def charge_neutrality_residual(mu, T, Ev, Ec, mc_star, mv_star, ND, Delta_D, gD, Nc_T_val, Nv_T_val):\n        \"\"\"\n        The residual function f(mu) = n - p - ND+ = 0 to be solved for mu.\n        \"\"\"\n        # All energies are in eV\n        ED = Ec - Delta_D\n        n = electron_concentration(mu, T, Ec, Nc_T_val)\n        p = hole_concentration(mu, T, Ev, Nv_T_val)\n        Nd_plus = ionized_donor_concentration(mu, T, ND, ED, gD)\n        \n        return n - p - Nd_plus\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (moderate n-type)\n        {'T': 200.0, 'Eg': 1.12, 'ND': 1e16, 'NA': 0, 'Delta_D': 0.030, 'gD': 2, 'mc_star': 1.08, 'mv_star': 0.81},\n        # Case B (degenerate n-type)\n        {'T': 200.0, 'Eg': 1.12, 'ND': 1e19, 'NA': 0, 'Delta_D': 0.015, 'gD': 2, 'mc_star': 1.08, 'mv_star': 0.81},\n        # Case C (lightly doped)\n        {'T': 200.0, 'Eg': 1.12, 'ND': 1e12, 'NA': 0, 'Delta_D': 0.030, 'gD': 2, 'mc_star': 1.08, 'mv_star': 0.81},\n    ]\n\n    results = []\n    for case in test_cases:\n        # Common settings\n        Ev = 0.0\n        Ec = case['Eg']\n        \n        # Pre-compute temperature-dependent DOS\n        Nc_T_val = effective_dos(case['T'], case['mc_star'])\n        Nv_T_val = effective_dos(case['T'], case['mv_star'])\n\n        # Arguments for the residual function\n        args = (\n            case['T'], Ev, Ec, case['mc_star'], case['mv_star'], case['ND'],\n            case['Delta_D'], case['gD'], Nc_T_val, Nv_T_val\n        )\n\n        # Bracketing interval for the root finder\n        mu_min = -0.5\n        mu_max = Ec + 0.5\n\n        # Find the root mu using Brent's method\n        mu_solution = optimize.brentq(\n            charge_neutrality_residual,\n            a=mu_min,\n            b=mu_max,\n            args=args\n        )\n        \n        results.append(mu_solution)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2974780"}, {"introduction": "Building upon the model for uniform materials, the next critical step is to analyze systems with spatially varying doping, which forms the basis of all semiconductor devices. In such cases, carrier concentrations and the electrostatic potential are coupled and must be solved for self-consistently using the Poisson-Boltzmann equation. This exercise [@problem_id:2974857] challenges you to implement a numerical solver for this system, providing a hands-on introduction to the foundational principles of modern semiconductor device modeling and simulation.", "problem": "Consider a one-dimensional, nondegenerately doped semiconductor at thermal equilibrium and temperature $T$, with spatial coordinate $x \\in [0,L]$ and position-dependent donor density $N_{\\mathrm{D}}(x)$ and acceptor density $N_{\\mathrm{A}}(x)$. Let $q$ be the elementary charge, $k_{\\mathrm{B}}$ the Boltzmann constant, $\\varepsilon$ the static permittivity of the semiconductor, and $n_i$ the intrinsic carrier concentration. Assume complete ionization of dopants, no external bias, and equilibrium (constant Fermi level). The electrostatic potential is $\\phi(x)$ and define the dimensionless potential $\\psi(x) \\equiv \\dfrac{q \\phi(x)}{k_{\\mathrm{B}} T}$. The electron and hole concentrations under the Maxwell–Boltzmann approximation are $n(x) = n_i \\exp(\\psi(x))$ and $p(x) = n_i \\exp(-\\psi(x))$, respectively. The space charge density is $\\rho(x) = q\\left(p(x) - n(x) + N_{\\mathrm{D}}(x) - N_{\\mathrm{A}}(x)\\right)$. The electrostatics is governed by Poisson’s equation $\\dfrac{d^2 \\phi}{dx^2} = -\\dfrac{\\rho}{\\varepsilon}$, equivalently written in terms of $\\psi(x)$ as $\\dfrac{d^2 \\psi}{dx^2} = - \\dfrac{q^2}{\\varepsilon k_{\\mathrm{B}} T}\\left(p(x) - n(x) + N_{\\mathrm{D}}(x) - N_{\\mathrm{A}}(x)\\right)$. At the boundaries $x=0$ and $x=L$, impose thermodynamic consistency with local charge neutrality in the quasi-neutral regions, meaning that the boundary values $\\psi(0)$ and $\\psi(L)$ are chosen to solve $n_i\\left(e^{\\psi} - e^{-\\psi}\\right) = N_{\\mathrm{D}} - N_{\\mathrm{A}}$ at $x=0$ and $x=L$, respectively. This yields $\\psi_{\\mathrm{b}} = \\operatorname{asinh}\\!\\left(\\dfrac{N_{\\mathrm{D}} - N_{\\mathrm{A}}}{2 n_i}\\right)$ at each boundary.\n\nUsing only the above fundamental laws and definitions, do the following:\n\n1) Starting from charge density $\\rho(x)$ and Poisson’s equation, show how to couple the electrostatic potential to the carrier concentrations for a general nonuniform doping profile $N_{\\mathrm{D}}(x)$ and $N_{\\mathrm{A}}(x)$, and explain why the boundary conditions $\\psi(0)$ and $\\psi(L)$ follow from local neutrality at the contacts.\n\n2) Derive a robust numerical scheme to compute the equilibrium $\\psi(x)$ and hence $n(x)$ on a uniform grid with $N$ nodes over $[0,L]$, using a second-order central difference for the second derivative. Outline the Newton–Raphson method for the resulting nonlinear system, including the construction of the residual and Jacobian, and a strategy for step damping to ensure convergence. Your derivation must be explicit and start from the above base equations, avoiding any unproven shortcut formulas.\n\n3) Implement the scheme as a complete, runnable program that solves for $n(x)$ and returns the electron concentration at the domain midpoint $x=L/2$ for each of the following test cases. All physical constants and parameters must be used as specified, and all answers must be in $\\mathrm{cm}^{-3}$.\n\nConstants to use in all cases:\n- $q = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$, $k_{\\mathrm{B}} = 1.380649\\times 10^{-23}\\,\\mathrm{J/K}$, $T = 300\\,\\mathrm{K}$, $n_i = 1.0\\times 10^{10}\\,\\mathrm{cm^{-3}}$, $\\varepsilon_0 = 8.8541878128\\times 10^{-14}\\,\\mathrm{F/cm}$, $\\varepsilon = 11.7\\,\\varepsilon_0$.\n- Use a uniform grid with $N = 601$ nodes for all cases.\n\nTest suite (each case uses a one-dimensional domain of length $L=10^{-4}\\,\\mathrm{cm}$):\n- Case A (abrupt $p$–$n$ junction): $N_{\\mathrm{D}}(x) = 10^{16}\\,\\mathrm{cm^{-3}}$ for $x  L/2$ and $N_{\\mathrm{D}}(x) = 0$ for $x \\ge L/2$. $N_{\\mathrm{A}}(x) = 0$ for $x  L/2$ and $N_{\\mathrm{A}}(x) = 10^{16}\\,\\mathrm{cm^{-3}}$ for $x \\ge L/2$.\n- Case B (uniform $n$-type): $N_{\\mathrm{D}}(x) = 10^{15}\\,\\mathrm{cm^{-3}}$, $N_{\\mathrm{A}}(x) = 0$ for all $x$.\n- Case C (linearly graded junction): $N_{\\mathrm{D}}(x) = N_g \\,\\dfrac{x}{L}$ and $N_{\\mathrm{A}}(x) = N_g \\left(1 - \\dfrac{x}{L}\\right)$ with $N_g = 5\\times 10^{16}\\,\\mathrm{cm^{-3}}$.\n\nNumerical and output requirements:\n- Discretize $\\dfrac{d^2 \\psi}{dx^2}$ by a second-order central difference on the uniform grid. Solve the nonlinear system by Newton–Raphson with an appropriate damping strategy and a stopping criterion based on both the maximum absolute Newton step and the infinity-norm of the residual.\n- Use Dirichlet boundary conditions $\\psi(0)$ and $\\psi(L)$ determined by the local neutrality condition at the boundaries. Initialize the interior $\\psi$ with a smooth profile consistent with the local neutrality approximation.\n- For each case, compute $n(x)$ and report the value at the grid point closest to $x=L/2$, in units of $\\mathrm{cm^{-3}}$, rounded to six significant figures and printed in scientific notation.\n- Your program should produce a single line of output containing the three results as a comma-separated list enclosed in square brackets, for example, `[1.234560e+12,2.345670e+08,3.210000e+15]`.", "solution": "The user has provided a problem in semiconductor physics that requires both a theoretical derivation and a numerical implementation. I will first validate the problem statement and then provide the complete solution.\n\n### Step 1: Extract Givens\n- **Domain**: One-dimensional, $x \\in [0,L]$.\n- **Physical State**: Thermal equilibrium at temperature $T$. Nondegenerately doped. Complete ionization of dopants. No external bias.\n- **Physical Constants**:\n    - Elementary charge: $q$\n    - Boltzmann constant: $k_{\\mathrm{B}}$\n    - Static permittivity: $\\varepsilon$\n    - Intrinsic carrier concentration: $n_i$\n- **Variables and Definitions**:\n    - Donor density: $N_{\\mathrm{D}}(x)$\n    - Acceptor density: $N_{\\mathrm{A}}(x)$\n    - Electrostatic potential: $\\phi(x)$\n    - Dimensionless potential: $\\psi(x) \\equiv \\dfrac{q \\phi(x)}{k_{\\mathrm{B}} T}$\n    - Electron concentration: $n(x) = n_i \\exp(\\psi(x))$ (Maxwell-Boltzmann approximation)\n    - Hole concentration: $p(x) = n_i \\exp(-\\psi(x))$ (Maxwell-Boltzmann approximation)\n    - Space charge density: $\\rho(x) = q\\left(p(x) - n(x) + N_{\\mathrm{D}}(x) - N_{\\mathrm{A}}(x)\\right)$\n- **Governing Equation (Poisson's Equation)**:\n    - $\\dfrac{d^2 \\phi}{dx^2} = -\\dfrac{\\rho}{\\varepsilon}$\n    - Equivalently: $\\dfrac{d^2 \\psi}{dx^2} = - \\dfrac{q^2}{\\varepsilon k_{\\mathrm{B}} T}\\left(p(x) - n(x) + N_{\\mathrm{D}}(x) - N_{\\mathrm{A}}(x)\\right)$\n- **Boundary Conditions**: At $x=0$ and $x=L$, the potential is determined by local charge neutrality, yielding $\\psi_{\\mathrm{b}} = \\operatorname{asinh}\\!\\left(\\dfrac{N_{\\mathrm{D}} - N_{\\mathrm{A}}}{2 n_i}\\right)$.\n- **Numerical Implementation Details**:\n    - Method: Newton-Raphson for the nonlinear system resulting from a second-order central difference discretization.\n    - Grid: Uniform with $N = 601$ nodes over $[0,L]$.\n    - Initial Guess: Smooth profile consistent with local neutrality.\n    - Convergence: Damped steps, stopping criterion on residual and step size.\n- **Constants for Implementation**:\n    - $q = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$\n    - $k_{\\mathrm{B}} = 1.380649\\times 10^{-23}\\,\\mathrm{J/K}$\n    - $T = 300\\,\\mathrm{K}$\n    - $n_i = 1.0\\times 10^{10}\\,\\mathrm{cm^{-3}}$\n    - $\\varepsilon_0 = 8.8541878128\\times 10^{-14}\\,\\mathrm{F/cm}$\n    - $\\varepsilon = 11.7\\,\\varepsilon_0$\n- **Test Cases**: $L=10^{-4}\\,\\mathrm{cm}$, $N=601$.\n    - Case A (abrupt $p-n$): $N_{\\mathrm{D}}(x) = 10^{16}\\,\\mathrm{cm^{-3}}$ for $x  L/2$, $0$ otherwise. $N_{\\mathrm{A}}(x) = 10^{16}\\,\\mathrm{cm^{-3}}$ for $x \\ge L/2$, $0$ otherwise.\n    - Case B (uniform $n$-type): $N_{\\mathrm{D}}(x) = 10^{15}\\,\\mathrm{cm^{-3}}$, $N_{\\mathrm{A}}(x) = 0$.\n    - Case C (linearly graded): $N_{\\mathrm{D}}(x) = N_g \\,(x/L)$, $N_{\\mathrm{A}}(x) = N_g \\,(1 - x/L)$ with $N_g = 5\\times 10^{16}\\,\\mathrm{cm^{-3}}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the validation criteria:\n- **Scientifically Grounded**: The problem is a standard exercise in semiconductor device physics, involving the solution of the 1D nonlinear Poisson-Boltzmann equation. The provided equations (Maxwell-Boltzmann statistics, Poisson's equation), assumptions (complete ionization, thermal equilibrium), and physical constants are all standard and factually correct.\n- **Well-Posed**: It describes a second-order nonlinear ordinary differential equation with two Dirichlet boundary conditions. This constitutes a well-posed boundary value problem. The instructions for the numerical solution are clear and standard.\n- **Objective**: The problem is formulated in precise mathematical language, free from any subjective or biased statements.\n- **Flaw Checklist**: The problem does not exhibit any of the listed flaws. It is scientifically sound, formalizable, complete, and realistic. The task is non-trivial and requires a proper numerical implementation, making it a substantive problem.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed with providing a complete solution.\n\n### Part 1: Theoretical Foundation\n\nThe physics of charge carriers and the electrostatic potential in a semiconductor at thermal equilibrium is described by the coupling between the carrier statistics and Poisson's equation.\n\nThe electron and hole concentrations, $n(x)$ and $p(x)$, are given by the Maxwell-Boltzmann approximation, which relates them to the local electrostatic potential $\\phi(x)$ and the constant Fermi level (characteristic of equilibrium). In terms of the dimensionless potential $\\psi(x) \\equiv \\dfrac{q \\phi(x)}{k_{\\mathrm{B}} T}$, these are:\n$$ n(x) = n_i e^{\\psi(x)} $$\n$$ p(x) = n_i e^{-\\psi(x)} $$\nHere, $n_i$ represents the intrinsic carrier concentration, the value of $n$ and $p$ when $\\psi(x)=0$.\n\nThe net space charge density $\\rho(x)$ at any point is the sum of charges from mobile carriers (electrons and holes) and fixed ionized dopant atoms (donors $N_{\\mathrm{D}}$ and acceptors $N_{\\mathrm{A}}$). Assuming complete ionization, each donor atom contributes a positive charge $+q$ and each acceptor a negative charge $-q$. The total space charge density is therefore:\n$$ \\rho(x) = q\\left(p(x) - n(x) + N_{\\mathrm{D}}(x) - N_{\\mathrm{A}}(x)\\right) $$\n\nThese charge distributions are coupled to the electrostatic potential through Poisson's equation, which states that the divergence of the electric field (or the Laplacian of the potential) is proportional to the local charge density:\n$$ \\frac{d^2 \\phi(x)}{dx^2} = -\\frac{\\rho(x)}{\\varepsilon} $$\nTo express this in terms of the dimensionless potential $\\psi(x)$, we use the relationship $\\phi(x) = \\dfrac{k_{\\mathrm{B}} T}{q} \\psi(x)$. Taking the second derivative with respect to $x$ gives $\\dfrac{d^2 \\phi}{dx^2} = \\dfrac{k_{\\mathrm{B}} T}{q} \\dfrac{d^2 \\psi}{dx^2}$. Substituting this into Poisson's equation:\n$$ \\frac{k_{\\mathrm{B}} T}{q} \\frac{d^2 \\psi(x)}{dx^2} = -\\frac{\\rho(x)}{\\varepsilon} $$\n$$ \\frac{d^2 \\psi(x)}{dx^2} = -\\frac{q \\rho(x)}{\\varepsilon k_{\\mathrm{B}} T} $$\nNow, substituting the expression for $\\rho(x)$:\n$$ \\frac{d^2 \\psi}{dx^2} = - \\frac{q}{\\varepsilon k_{\\mathrm{B}} T} \\left[ q\\left(p(x) - n(x) + N_{\\mathrm{D}}(x) - N_{\\mathrm{A}}(x)\\right) \\right] $$\n$$ \\frac{d^2 \\psi}{dx^2} = - \\frac{q^2}{\\varepsilon k_{\\mathrm{B}} T} \\left( n_i e^{-\\psi(x)} - n_i e^{\\psi(x)} + N_{\\mathrm{D}}(x) - N_{\\mathrm{A}}(x) \\right) $$\nUsing the identity $\\sinh(z) = \\frac{e^z - e^{-z}}{2}$, the term $e^{\\psi} - e^{-\\psi}$ can be written as $2\\sinh(\\psi)$. The equation becomes:\n$$ \\frac{d^2 \\psi}{dx^2} = \\frac{q^2}{\\varepsilon k_{\\mathrm{B}} T} \\left( 2 n_i \\sinh(\\psi(x)) - \\left(N_{\\mathrm{D}}(x) - N_{\\mathrm{A}}(x)\\right) \\right) $$\nThis is the nonlinear Poisson-Boltzmann equation, which explicitly couples the electrostatic potential $\\psi(x)$ to the net doping profile $C(x) = N_{\\mathrm{D}}(x) - N_{\\mathrm{A}}(x)$.\n\nThe boundary conditions are established by assuming that the boundaries at $x=0$ and $x=L$ are connected to contacts that enforce local charge neutrality. In these quasi-neutral regions, the net space charge density $\\rho(x)$ is approximately zero. Setting $\\rho(x) = 0$ in its definition:\n$$ p(x) - n(x) + N_{\\mathrm{D}}(x) - N_{\\mathrm{A}}(x) = 0 $$\n$$ n_i e^{-\\psi} - n_i e^{\\psi} + N_{\\mathrm{D}} - N_{\\mathrm{A}} = 0 $$\n$$ -2 n_i \\sinh(\\psi) + N_{\\mathrm{D}} - N_{\\mathrm{A}} = 0 $$\nSolving for $\\psi$ gives the boundary potential $\\psi_{\\mathrm{b}}$:\n$$ \\psi_{\\mathrm{b}} = \\operatorname{asinh}\\left(\\frac{N_{\\mathrm{D}} - N_{\\mathrm{A}}}{2 n_i}\\right) $$\nThis expression is evaluated at $x=0$ and $x=L$ using the respective doping concentrations to find $\\psi(0)$ and $\\psi(L)$.\n\n### Part 2: Numerical Scheme\n\nTo solve the boundary value problem numerically, we discretize the domain $[0,L]$ into a uniform grid of $N$ nodes, $x_j = j \\cdot h$ for $j=0, 1, \\dots, N-1$, where the grid spacing is $h = L/(N-1)$. Let $\\psi_j$ be the numerical approximation of $\\psi(x_j)$.\n\nThe second derivative $\\dfrac{d^2 \\psi}{dx^2}$ at an interior node $x_j$ (for $j=1, \\dots, N-2$) is approximated using a second-order central difference formula:\n$$ \\left. \\frac{d^2 \\psi}{dx^2} \\right|_{x_j} \\approx \\frac{\\psi_{j+1} - 2\\psi_j + \\psi_{j-1}}{h^2} $$\nSubstituting this into the Poisson-Boltzmann equation, we obtain a system of $N-2$ coupled nonlinear algebraic equations for the $N-2$ unknown interior potentials $\\{\\psi_1, \\psi_2, \\dots, \\psi_{N-2}\\}$:\n$$ \\frac{\\psi_{j+1} - 2\\psi_j + \\psi_{j-1}}{h^2} = \\frac{q^2}{\\varepsilon k_{\\mathrm{B}} T} \\left( 2 n_i \\sinh(\\psi_j) - C_j \\right) \\quad \\text{for } j=1, \\dots, N-2 $$\nwhere $C_j = N_{\\mathrm{D}}(x_j) - N_{\\mathrm{A}}(x_j)$. The values $\\psi_0$ and $\\psi_{N-1}$ are fixed by the Dirichlet boundary conditions.\n\nTo solve this system using the Newton-Raphson method, we first define a residual vector $\\vec{F}$ of size $N-2$, where each component $F_j$ must be driven to zero:\n$$ F_j(\\vec{\\psi}) = \\frac{\\psi_{j+1} - 2\\psi_j + \\psi_{j-1}}{h^2} - \\frac{2 q^2 n_i}{\\varepsilon k_{\\mathrm{B}} T} \\sinh(\\psi_j) + \\frac{q^2 C_j}{\\varepsilon k_{\\mathrm{B}} T} = 0 $$\nNote that for $j=1$, $\\psi_0$ is a known value, and for $j=N-2$, $\\psi_{N-1}$ is known.\n\nThe Newton-Raphson method generates a sequence of approximations $\\vec{\\psi}^{(k)}$ that iteratively converge to the solution. The update step $\\Delta\\vec{\\psi}^{(k)}$ is found by solving the linear system:\n$$ J(\\vec{\\psi}^{(k)}) \\Delta\\vec{\\psi}^{(k)} = -\\vec{F}(\\vec{\\psi}^{(k)}) $$\nwhere $J$ is the Jacobian matrix with elements $J_{ij} = \\frac{\\partial F_i}{\\partial \\psi_j}$ (where indices $i,j$ run from $1$ to $N-2$).\n\nThe function $F_i$ only depends on $\\psi_{i-1}$, $\\psi_i$, and $\\psi_{i+1}$, making the Jacobian matrix tridiagonal. The non-zero elements for row $i$ are:\n- Sub-diagonal ($j=i-1$):\n  $$ \\frac{\\partial F_i}{\\partial \\psi_{i-1}} = \\frac{1}{h^2} $$\n- Main diagonal ($j=i$):\n  $$ \\frac{\\partial F_i}{\\partial \\psi_i} = -\\frac{2}{h^2} - \\frac{2 q^2 n_i}{\\varepsilon k_{\\mathrm{B}} T} \\cosh(\\psi_i) $$\n- Super-diagonal ($j=i+1$):\n  $$ \\frac{\\partial F_i}{\\partial \\psi_{i+1}} = \\frac{1}{h^2} $$\n\nThe Newton iteration proceeds as follows:\n1.  **Initialization**: Set an initial guess $\\vec{\\psi}^{(0)}$. A good choice is the local charge neutrality approximation for all interior nodes: $\\psi_j^{(0)} = \\operatorname{asinh}(C_j / (2 n_i))$.\n2.  **Iteration**: For $k=0, 1, 2, \\dots$\n    a.  Compute the residual vector $\\vec{F}(\\vec{\\psi}^{(k)})$.\n    b.  Compute the tridiagonal Jacobian matrix $J(\\vec{\\psi}^{(k)})$.\n    c.  Solve the linear system $J \\Delta\\vec{\\psi}^{(k)} = -\\vec{F}$ for the update vector $\\Delta\\vec{\\psi}^{(k)}$. This is done efficiently using a tridiagonal solver.\n    d.  **Damping**: To ensure convergence, the update step is damped. A robust strategy is to limit the maximum magnitude of the update. Let $\\delta_{\\text{max}} = \\max_j |\\Delta\\psi_j^{(k)}|$. If $\\delta_{\\text{max}}$ exceeds a threshold (e.g., $1.0$), scale the update vector: $\\Delta\\vec{\\psi}^{(k)} \\leftarrow \\Delta\\vec{\\psi}^{(k)} / \\delta_{\\text{max}}$.\n    e.  Update the solution: $\\vec{\\psi}^{(k+1)} = \\vec{\\psi}^{(k)} + \\Delta\\vec{\\psi}^{(k)}$.\n3.  **Termination**: Stop when both the infinity-norm of the residual and the maximum update step fall below a specified tolerance $\\epsilon$: $\\max_j |F_j|  \\epsilon$ and $\\max_j |\\Delta\\psi_j|  \\epsilon$.\n\nOnce the iteration has converged to the final potential profile $\\psi(x)$, the electron concentration profile $n(x)$ is calculated using $n_j = n_i \\exp(\\psi_j)$.", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Solves the 1D nonlinear Poisson-Boltzmann equation for a semiconductor\n    at thermal equilibrium for three different doping profiles.\n    \"\"\"\n\n    # --- Physical Constants ---\n    # All units are in a consistent system (cm, C, J, K)\n    Q = 1.602176634e-19   # Elementary charge (C)\n    KB = 1.380649e-23      # Boltzmann constant (J/K)\n    T = 300.0              # Temperature (K)\n    N_I = 1.0e10           # Intrinsic carrier concentration (cm^-3)\n    EPSILON_0 = 8.8541878128e-14 # Vacuum permittivity (F/cm)\n    EPSILON_R = 11.7       # Relative permittivity of Silicon\n    EPSILON = EPSILON_R * EPSILON_0 # Permittivity of Silicon (F/cm)\n\n    # --- Numerical Parameters ---\n    L = 1.0e-4             # Device length (cm)\n    N = 601                # Number of grid nodes\n    H = L / (N - 1)        # Grid spacing (cm)\n    MAX_ITER = 100         # Maximum Newton iterations\n    TOL = 1.0e-8           # Convergence tolerance\n\n    # --- Pre-calculated coefficients for the equation ---\n    # d^2(psi)/dx^2 = C1 * (2*N_I*sinh(psi) - C(x))\n    # where C(x) = N_D(x) - N_A(x)\n    C1 = Q**2 / (EPSILON * KB * T)\n    C2 = 2 * N_I * C1\n\n    x_grid = np.linspace(0, L, N)\n    mid_idx = (N - 1) // 2\n\n    # --- Test Case Definitions ---\n    # Each tuple: (N_D function, N_A function)\n    test_cases = [\n        # Case A: Abrupt p-n junction\n        (lambda x: np.where(x  L / 2, 1e16, 0.0),\n         lambda x: np.where(x = L / 2, 1e16, 0.0)),\n\n        # Case B: Uniform n-type\n        (lambda x: np.full_like(x, 1e15),\n         lambda x: np.zeros_like(x)),\n\n        # Case C: Linearly graded junction\n        (lambda x: 5e16 * x / L,\n         lambda x: 5e16 * (1 - x / L))\n    ]\n\n    results = []\n\n    for nd_func, na_func in test_cases:\n        # --- 1. Setup for the current case ---\n        nd_profile = nd_func(x_grid)\n        na_profile = na_func(x_grid)\n        c_profile = nd_profile - na_profile\n\n        # --- 2. Initial Guess and Boundary Conditions ---\n        psi = np.zeros(N)\n        \n        # Boundary conditions from local charge neutrality\n        # Handle potential division by zero if 2*N_I is zero (not an issue here)\n        # Suppress invalid value warning for large arguments to asinh\n        with np.errstate(invalid='ignore'):\n            psi[0] = np.asinh(c_profile[0] / (2 * N_I))\n            psi[-1] = np.asinh(c_profile[-1] / (2 * N_I))\n        \n        # Initial guess for interior points from local charge neutrality\n        # Suppress warning for large arguments to asinh\n        with np.errstate(invalid='ignore'):\n          psi[1:-1] = np.asinh(c_profile[1:-1] / (2 * N_I))\n        \n        # Correct any NaNs that might arise from huge arguments to asinh\n        # by using the sign and a large magnitude value related to log.\n        # This improves robustness for very high doping.\n        mask_pos = (c_profile > 0)  ~np.isfinite(psi)\n        psi[mask_pos] = np.log(c_profile[mask_pos]/N_I)\n        mask_neg = (c_profile  0)  ~np.isfinite(psi)\n        psi[mask_neg] = -np.log(-c_profile[mask_neg]/N_I)\n\n\n        # --- 3. Newton-Raphson Iteration ---\n        for i in range(MAX_ITER):\n            # Interior points: indices 1 to N-2\n            psi_int = psi[1:-1]\n\n            # --- a. Construct Residual Vector F ---\n            F = np.zeros(N - 2)\n            sinh_psi = np.sinh(psi_int)\n            \n            # Discretized second derivative term\n            F += (psi[:-2] - 2 * psi_int + psi[2:]) / H**2\n            \n            # Nonlinear and source terms\n            F -= C2 * sinh_psi\n            F += C1 * c_profile[1:-1]\n\n            # --- b. Check for convergence (residual norm) ---\n            res_norm = np.max(np.abs(F))\n            if i > 0 and res_norm  TOL and step_norm  TOL:\n                break\n\n            # --- c. Construct Jacobian Matrix J (as banded matrix) ---\n            cosh_psi = np.cosh(psi_int)\n            \n            # Main diagonal (band 1)\n            diag = -2.0 / H**2 - C2 * cosh_psi\n            \n            # Off-diagonals are constant\n            off_diag_val = 1.0 / H**2\n            \n            # Scipy's solve_banded expects a (3, M) array for tridiagonal\n            # J_banded[0,1:] is super-diagonal\n            # J_banded[1,:] is main-diagonal\n            # J_banded[2,:-1] is sub-diagonal\n            J_banded = np.zeros((3, N - 2))\n            J_banded[0, 1:] = off_diag_val\n            J_banded[1, :] = diag\n            J_banded[2, :-1] = off_diag_val\n\n            # --- d. Solve J * delta_psi = -F ---\n            # solve_banded uses (lower_diags, upper_diags)\n            delta_psi = solve_banded((1, 1), J_banded, -F)\n\n            # --- e. Damped Update Step ---\n            step_norm = np.max(np.abs(delta_psi))\n            # Limit max voltage change to ~26mV (dimensionless psi change of 1)\n            if step_norm > 1.0:\n                delta_psi *= (1.0 / step_norm)\n                step_norm = 1.0\n\n            # --- f. Update solution ---\n            psi[1:-1] += delta_psi\n        \n        # --- 4. Calculate final electron concentration ---\n        n_profile = N_I * np.exp(psi)\n        \n        # Append the result at the midpoint\n        results.append(n_profile[mid_idx])\n\n    # --- 5. Format and Print Output ---\n    # Format: scientific notation, 6 digits after decimal (e.g., 1.234560e+10)\n    formatted_results = [f\"{r:.6e}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "2974857"}]}