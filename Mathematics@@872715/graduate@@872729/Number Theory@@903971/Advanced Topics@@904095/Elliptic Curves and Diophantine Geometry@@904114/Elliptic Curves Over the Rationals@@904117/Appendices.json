{"hands_on_practices": [{"introduction": "The group structure is what elevates an elliptic curve from a mere cubic equation to a central object in modern number theory. This exercise guides you through the foundational process of translating the geometric chord-and-tangent construction into explicit algebraic formulas for point addition and doubling. By working from first principles using basic polynomial properties, you will develop a concrete understanding of where these fundamental operational rules originate, moving beyond rote memorization to true comprehension. [@problem_id:3013188]", "problem": "Consider the elliptic curve over the field of rational numbers $\\mathbb{Q}$ given in short Weierstrass form by $$E: y^{2} = x^{3} + a x + b,$$ where $a,b \\in \\mathbb{Q}$ and the discriminant $\\Delta = -16\\left(4a^{3}+27b^{2}\\right)$ is nonzero, ensuring nonsingularity. The group law on $E(\\mathbb{Q})$ is defined geometrically by the chord-tangent construction: for two points $P=(x_{1},y_{1})$ and $Q=(x_{2},y_{2})$ on $E$ with $P \\neq Q$, the line through $P$ and $Q$ meets $E$ at a third point $R$, and one defines $P+Q$ to be the reflection of $R$ across the $x$-axis; for $P=Q$, one uses the tangent line at $P$ in place of the secant. \n\nStarting from these definitions and the fundamental properties of polynomial intersections (including Vieta’s formulas for the roots of a cubic polynomial), derive explicit rational expressions for the slope of the chord or tangent, and for the coordinates of the group sum $P+Q$ in terms of $x_{1},y_{1},x_{2},y_{2},a,b$, in the cases $P \\neq Q$ and $P=Q$. Your derivation must begin from the implicit equation of $E$ and use only field operations and polynomial identities; do not assume any pre-established addition or doubling formula.\n\nThen, apply your derived expressions to the specific curve $$E: y^{2} = x^{3} - 7 x + 10,$$ with the rational points $$P=(2,2), \\quad Q=(3,4) \\in E(\\mathbb{Q}).$$ Compute the exact value of the $x$-coordinate of $P+Q$. Provide your final answer as a single exact number. No rounding is required.", "solution": "The problem asks for a derivation of the group addition law for an elliptic curve over the rationals, followed by an application to a specific curve and points.\n\nLet the elliptic curve $E$ over the field of rational numbers $\\mathbb{Q}$ be given by the short Weierstrass equation:\n$$E: y^{2} = x^{3} + a x + b$$\nwhere $a, b \\in \\mathbb{Q}$ and the discriminant $\\Delta = -16(4a^{3}+27b^{2}) \\neq 0$. Let $P=(x_{1}, y_{1})$ and $Q=(x_{2}, y_{2})$ be two points in $E(\\mathbb{Q})$. We wish to derive expressions for the coordinates of the sum $P+Q = (x_{3}, y_{3})$.\n\nThe derivation is divided into two main cases.\n\n**Case 1: Point Addition ($P \\neq Q$)**\n\nLet $P=(x_{1}, y_{1})$ and $Q=(x_{2}, y_{2})$ be distinct points on the curve $E$.\n\nIf $x_{1} = x_{2}$, then since $P \\neq Q$, we must have $y_{1} = -y_{2}$. The points are symmetrical with respect to the $x$-axis. The line passing through $P$ and $Q$ is the vertical line $x=x_{1}$. The intersection of this line with the curve $y^{2} = x^{3} + a x + b$ yields only the points $P$ and $Q$. In projective coordinates, this vertical line intersects the curve at a third point, the point at infinity, which we denote by $\\mathcal{O}$. By definition, the sum $P+Q$ is the reflection of this third point across the $x$-axis. Since $\\mathcal{O}$ is its own reflection, $P+Q = \\mathcal{O}$.\n\nIf $x_{1} \\neq x_{2}$, the line $L$ passing through $P$ and $Q$ is not vertical. Its equation is $y = \\lambda x + \\nu$, where the slope $\\lambda$ is given by:\n$$\\lambda = \\frac{y_{2} - y_{1}}{x_{2} - x_{1}}$$\nSince $P$ and $Q$ are on the line, we have $y_{1} = \\lambda x_{1} + \\nu$ and $y_{2} = \\lambda x_{2} + \\nu$. This implies $\\nu = y_{1} - \\lambda x_{1} = y_{2} - \\lambda x_{2}$.\n\nTo find the intersection points of the line $L$ and the curve $E$, we substitute the expression for $y$ into the curve's equation:\n$$(\\lambda x + \\nu)^{2} = x^{3} + a x + b$$\nExpanding the left side and rearranging gives a cubic equation in $x$:\n$$\\lambda^{2} x^{2} + 2\\lambda\\nu x + \\nu^{2} = x^{3} + a x + b$$\n$$x^{3} - \\lambda^{2} x^{2} + (a - 2\\lambda\\nu) x + (b - \\nu^{2}) = 0$$\nThe roots of this cubic polynomial correspond to the $x$-coordinates of the intersection points of $L$ and $E$. We already know two of these roots: $x_{1}$ and $x_{2}$, the $x$-coordinates of $P$ and $Q$. Let the third intersection point be $R=(x_{R}, y_{R})$, so its $x$-coordinate, $x_{R}$, is the third root of the cubic equation.\n\nAccording to Vieta's formulas, the sum of the roots of a monic cubic polynomial $x^{3}+cx^{2}+dx+e=0$ is $-c$. In our case, the sum of the roots is:\n$$x_{1} + x_{2} + x_{R} = -(-\\lambda^{2}) = \\lambda^{2}$$\nFrom this, we can solve for $x_{R}$:\n$$x_{R} = \\lambda^{2} - x_{1} - x_{2}$$\nThe point $R$ lies on the line $L$, so its $y$-coordinate is $y_{R} = \\lambda x_{R} + \\nu$.\n\nThe sum $P+Q = (x_{3}, y_{3})$ is defined as the reflection of $R$ across the $x$-axis. This means $x_{3} = x_{R}$ and $y_{3} = -y_{R}$.\nTherefore, the coordinates of $P+Q$ are:\n$$x_{3} = \\lambda^{2} - x_{1} - x_{2}$$\n$$y_{3} = -y_{R} = -(\\lambda x_{3} + \\nu) = -(\\lambda x_{3} + y_{1} - \\lambda x_{1}) = \\lambda(x_{1} - x_{3}) - y_{1}$$\n\n**Case 2: Point Doubling ($P = Q$)**\n\nLet $P=(x_{1}, y_{1})$. We want to find the coordinates of $2P = P+P = (x_{3}, y_{3})$.\n\nIf $y_{1} = 0$, the point $P$ is a $2$-torsion point. The tangent line to the curve at $P$ is a vertical line $x=x_{1}$. As in the first case, the third intersection point is the point at infinity $\\mathcal{O}$. Thus, $2P = \\mathcal{O}$.\n\nIf $y_{1} \\neq 0$, the tangent line is not vertical. We find its slope $\\lambda$ by implicit differentiation of the curve equation $y^{2} = x^{3} + a x + b$ with respect to $x$:\n$$2y \\frac{dy}{dx} = 3x^{2} + a$$\n$$\\frac{dy}{dx} = \\frac{3x^{2} + a}{2y}$$\nThe slope of the tangent line at $P(x_{1}, y_{1})$ is:\n$$\\lambda = \\frac{3x_{1}^{2} + a}{2y_{1}}$$\nThe equation of the tangent line is $y = \\lambda x + \\nu$, where $\\nu = y_{1} - \\lambda x_{1}$.\nSubstituting this into the curve equation gives the same cubic as before:\n$$x^{3} - \\lambda^{2} x^{2} + (a - 2\\lambda\\nu) x + (b - \\nu^{2}) = 0$$\nSince the line is tangent to the curve at $P$, the $x$-coordinate $x_{1}$ must be a root of this cubic with multiplicity at least $2$. Let the third intersection point be $R=(x_{R}, y_{R})$. Applying Vieta's formulas for the sum of the roots:\n$$x_{1} + x_{1} + x_{R} = \\lambda^{2}$$\n$$2x_{1} + x_{R} = \\lambda^{2}$$\nSolving for $x_{R}$:\n$$x_{R} = \\lambda^{2} - 2x_{1}$$\nThe point $2P = (x_{3}, y_{3})$ is the reflection of $R$ across the $x$-axis, so $x_{3} = x_{R}$ and $y_{3} = -y_{R}$.\nThe coordinates of $2P$ are:\n$$x_{3} = \\lambda^{2} - 2x_{1}$$\n$$y_{3} = -y_{R} = -(\\lambda x_{3} + \\nu) = \\lambda(x_{1} - x_{3}) - y_{1}$$\nThe derivations of the explicit rational expressions are now complete.\n\n**Application to the specific problem**\n\nWe are given the elliptic curve $E: y^{2} = x^{3} - 7 x + 10$ and two rational points $P=(2,2)$ and $Q=(3,4)$. We must compute the $x$-coordinate of $P+Q$.\n\nThe curve has coefficients $a=-7$ and $b=10$.\nThe points are $P=(x_{1}, y_{1}) = (2,2)$ and $Q=(x_{2}, y_{2}) = (3,4)$.\nSince $P \\neq Q$ and $x_{1} \\neq x_{2}$, we are in the primary subcase of Case $1$.\n\nFirst, we calculate the slope $\\lambda$ of the line passing through $P$ and $Q$:\n$$\\lambda = \\frac{y_{2} - y_{1}}{x_{2} - x_{1}} = \\frac{4 - 2}{3 - 2} = \\frac{2}{1} = 2$$\nNext, we use the derived formula for the $x$-coordinate of the sum $P+Q$, which we denote as $x_{3}$:\n$$x_{3} = \\lambda^{2} - x_{1} - x_{2}$$\nSubstituting the known values:\n$$x_{3} = (2)^{2} - 2 - 3$$\n$$x_{3} = 4 - 2 - 3$$\n$$x_{3} = -1$$\nThe $x$-coordinate of $P+Q$ is $-1$.\n(For verification, the $y$-coordinate would be $y_3 = \\lambda(x_1-x_3) - y_1 = 2(2 - (-1)) - 2 = 2(3) - 2 = 6 - 2 = 4$. So $P+Q = (-1, 4)$. We check if $(-1, 4)$ is on the curve: $4^2 = 16$ and $(-1)^3 - 7(-1) + 10 = -1 + 7 + 10 = 16$. The point is on the curve, confirming the calculation.)\n\nThe requested value is the $x$-coordinate of $P+Q$.", "answer": "$$\\boxed{-1}$$", "id": "3013188"}, {"introduction": "While an elliptic curve over $\\mathbb{Q}$ can be described by infinitely many equations, not all models are created equal from an arithmetic standpoint. The concept of a \"minimal model\" provides a canonical, most efficient representation, and its discriminant is a crucial arithmetic invariant of the curve. This practice involves applying the standard criterion, based on the prime factorization of the discriminant, to determine if a given model is minimal—an essential skill for computing other invariants like the conductor or applying major theorems. [@problem_id:3013124]", "problem": "Let $E$ be the elliptic curve over $\\mathbb{Q}$ given by the short integral Weierstrass equation $y^{2} = x^{3} - 4x + 1$. An admissible integral change of variables is of the form\n$x = u^{2} x' + r$ and $y = u^{3} y' + u^{2} s x' + t$ with $u, r, s, t \\in \\mathbb{Z}$ and $u = \\pm 1$; more generally, a rational scaling with $u = p^{-1}$ for a prime $p$ may be used provided the resulting Weierstrass equation still has integer coefficients.\n\nStarting from the fundamental definitions of the invariants of a Weierstrass equation and their behavior under admissible changes of variables, determine a global minimal integral model for $E$ by analyzing primes dividing the discriminant. Then compute the minimal discriminant of $E$.\n\nExpress your final answer as a single exact integer equal to the minimal discriminant of $E$. No rounding is required, and no units are involved. The reasoning you provide should justify why the model you reach is minimal with respect to admissible integral substitutions.", "solution": "The elliptic curve $E$ over the field of rational numbers $\\mathbb{Q}$ is given by the equation $y^{2} = x^{3} - 4x + 1$. This is an integral Weierstrass model. We need to find a global minimal integral model for $E$ and compute its minimal discriminant.\n\nThe given equation is in the short Weierstrass form $y^{2} = x^{3} + Ax + B$, with integer coefficients $A = -4$ and $B = 1$. The general form of a Weierstrass equation is $y^{2} + a_{1}xy + a_{3}y = x^{3} + a_{2}x^{2} + a_{4}x + a_{6}$. For the given curve, the coefficients are $a_{1} = 0$, $a_{2} = 0$, $a_{3} = 0$, $a_{4} = -4$, and $a_{6} = 1$.\n\nFirst, we compute the standard invariants and the discriminant of this model. For a short Weierstrass equation $y^2 = x^3 + Ax + B$, the discriminant $\\Delta$ is given by the formula:\n$$\n\\Delta = -16(4A^{3} + 27B^{2})\n$$\nSubstituting the given values $A = -4$ and $B = 1$:\n$$\n\\Delta = -16(4(-4)^{3} + 27(1)^{2})\n$$\n$$\n\\Delta = -16(4(-64) + 27)\n$$\n$$\n\\Delta = -16(-256 + 27)\n$$\n$$\n\\Delta = -16(-229)\n$$\n$$\n\\Delta = 3664\n$$\nAn admissible change of variables is of the form $x = u^{2}x' + r, y = u^{3}y' + u^{2}sx' + t$ with $u, r, s, t \\in \\mathbb{Q}$ and $u \\neq 0$. If an elliptic curve has an integral model with discriminant $\\Delta$, any other isomorphic integral model will have a discriminant $\\Delta'$ such that $\\Delta = v^{12}\\Delta'$ for some $v \\in \\mathbb{Q}^\\times$.\n\nA global minimal integral model is an integral model whose discriminant, $\\Delta_{min}$, has the minimum possible absolute value among all integral models in the same $\\mathbb{Q}$-isomorphism class. For a model with discriminant $\\Delta$ to be reducible to a model with a smaller discriminant (in absolute value), there must exist some $v \\in \\mathbb{Q}$ with $|v| > 1$ such that $\\Delta' = v^{-12}\\Delta$ is the discriminant of another integral model. Writing $v = p$ for a prime number $p$, this would mean $\\Delta' = p^{-12}\\Delta$. For $\\Delta'$ to be an integer, it is necessary that $p^{12}$ divides $\\Delta$.\n\nTherefore, a sufficient condition for an integral model to be minimal is that for every prime $p$, the $p$-adic valuation of its discriminant, $v_p(\\Delta)$, is less than $12$. If $v_p(\\Delta)  12$ for all primes $p$, then there is no prime $p$ for which $p^{12}$ divides $\\Delta$. Consequently, no simplification of the model is possible by a change of variables involving scaling by $p$.\n\nLet us apply this criterion to the discriminant we calculated, $\\Delta = 3664$. We first find the prime factorization of $\\Delta$:\n$$\n3664 = 8 \\times 458 = 8 \\times 2 \\times 229 = 16 \\times 229 = 2^{4} \\times 229^{1}\n$$\nTo verify that $229$ is a prime number, we test for divisibility by primes up to $\\sqrt{229} \\approx 15.1$. The primes are $2, 3, 5, 7, 11, 13$.\n- $229$ is not divisible by $2$ or $5$.\n- The sum of digits is $2+2+9=13$, so it is not divisible by $3$.\n- $229 = 7 \\times 32 + 5$.\n- $229 = 11 \\times 20 + 9$.\n- $229 = 13 \\times 17 + 8$.\nThus, $229$ is a prime number.\n\nNow we examine the $p$-adic valuations of $\\Delta = 2^{4} \\times 229^{1}$:\n\\begin{itemize}\n    \\item For the prime $p=2$, the valuation is $v_{2}(\\Delta) = 4$.\n    \\item For the prime $p=229$, the valuation is $v_{229}(\\Delta) = 1$.\n    \\item For any other prime $p$, the valuation is $v_{p}(\\Delta) = 0$.\n\\end{itemize}\nIn every case, we have $v_p(\\Delta)  12$. This demonstrates that there is no prime $p$ such that $p^{12}$ divides $\\Delta$. Therefore, it is not possible to find an isomorphic integral model with a discriminant of smaller absolute value.\n\nThis proves that the given integral model, $y^{2} = x^{3} - 4x + 1$, is a global minimal integral model for the elliptic curve $E$. The minimal discriminant of $E$ is the discriminant of this model.\n\nMinimal Discriminant, $\\Delta_{min} = 3664$.", "answer": "$$\n\\boxed{3664}\n$$", "id": "3013124"}, {"introduction": "Beyond its structure over the rationals, an elliptic curve's properties can be studied statistically by examining its reductions over many finite fields. This advanced computational exercise bridges abstract theory with the experimental nature of modern number theory, tasking you with verifying the celebrated Sato–Tate theorem. You will implement an algorithm to compute the traces of Frobenius and perform a statistical analysis to see how their distribution beautifully converges to the predicted semi-circular law, gaining hands-on experience with the techniques that drive computational algebraic number theory. [@problem_id:3013166]", "problem": "You are asked to write a complete, runnable program that, for several elliptic curves over the rational numbers and explicit ranges of primes, computes the coefficients of Frobenius at good primes and compares their normalized distribution with the Sato–Tate measure.\n\nStart from the following foundations and definitions.\n\n- An elliptic curve over the rational numbers is, after a change of variables for primes greater than or equal to $5$, represented in short Weierstrass form $E_{a,b} \\colon y^2 = x^3 + a x + b$ with integers $a$ and $b$, provided the discriminant $\\Delta = -16\\left(4 a^3 + 27 b^2\\right)$ is nonzero.\n- For a prime $p \\ge 5$ such that $p \\nmid \\Delta$, the reduction of $E_{a,b}$ modulo $p$ is an elliptic curve over the finite field $\\mathbb{F}_p$. Define $\\#E(\\mathbb{F}_p)$ to be the number of $\\mathbb{F}_p$-rational points, including the point at infinity. The trace of Frobenius at $p$ is $a_p = p + 1 - \\#E(\\mathbb{F}_p)$, and the Hasse bound states $\\lvert a_p \\rvert \\le 2 \\sqrt{p}$.\n- Define the Legendre symbol $\\chi_p(r)$ for an odd prime $p$ by $\\chi_p(r) = 1$ if $r$ is a nonzero quadratic residue modulo $p$, $\\chi_p(r) = -1$ if $r$ is a non-residue modulo $p$, and $\\chi_p(0) = 0$. The elementary fact that for each $r \\in \\mathbb{F}_p$, the congruence $y^2 \\equiv r \\pmod p$ has exactly $1 + \\chi_p(r)$ solutions in $\\mathbb{F}_p$ allows you to count $\\#E(\\mathbb{F}_p)$ without enumerating $y$ explicitly.\n- For curves without Complex Multiplication (CM), the Sato–Tate theorem states that the normalized quantities $t_p = a_p / \\left(2 \\sqrt{p}\\right)$ are equidistributed on the interval $\\left[-1,1\\right]$ with respect to the Sato–Tate measure whose probability density is $f_{\\mathrm{ST}}(t) = \\frac{2}{\\pi} \\sqrt{1 - t^2}$ for $t \\in \\left[-1,1\\right]$. The cumulative distribution function (CDF) is the integral $F_{\\mathrm{ST}}(t) = \\int_{-1}^t f_{\\mathrm{ST}}(u) \\, du$. You may use the antiderivative $$\\int \\sqrt{1-u^2} \\, du = \\frac{1}{2}\\left(u \\sqrt{1-u^2} + \\arcsin u\\right)$$ to evaluate $F_{\\mathrm{ST}}(t)$ in closed form.\n\nYour program must do the following for each test case:\n\n1. Given integers $a$ and $b$, a prime upper bound $B \\ge 5$, and a number of bins $m \\ge 1$, consider the elliptic curve $E_{a,b} \\colon y^2 = x^3 + a x + b$.\n2. Generate all primes $p$ with $5 \\le p \\le B$. For each such prime with good reduction ($p \\nmid \\Delta$), compute $a_p = p + 1 - \\#E(\\mathbb{F}_p)$ by counting $\\#E(\\mathbb{F}_p)$ via the Legendre symbol as described above, and form the normalized value $t_p = a_p / \\left(2 \\sqrt{p}\\right)$.\n3. Construct a histogram on $\\left[-1,1\\right]$ with $m$ equal-width bins and tabulate the observed relative frequencies from the multiset $\\{ t_p \\}$.\n4. Compute:\n   - The expected bin masses using $F_{\\mathrm{ST}}$ on each bin, i.e., for bin edges $-1 = b_0  b_1  \\cdots  b_m = 1$, the expected mass in bin $i$ is $F_{\\mathrm{ST}}(b_i) - F_{\\mathrm{ST}}(b_{i-1})$ for $i = 1, \\dots, m$.\n   - The chi-square statistic $$\\chi^2 = \\sum_{i=1}^m \\frac{(\\mathrm{Obs}_i - \\mathrm{Exp}_i)^2}{\\max(\\mathrm{Exp}_i, \\varepsilon)},$$ where $\\mathrm{Obs}_i$ and $\\mathrm{Exp}_i$ are observed and expected bin probabilities and $\\varepsilon$ is a small positive constant to avoid division by zero in degenerate cases.\n   - The one-sample Kolmogorov–Smirnov statistic for $F_{\\mathrm{ST}}$ and the empirical cumulative distribution function $\\widehat{F}_n$, namely $$\\mathrm{KS} = \\sup_t \\lvert \\widehat{F}_n(t) - F_{\\mathrm{ST}}(t) \\rvert$$ computed on the sorted sample $\\{ t_p \\}$ using the standard left and right empirical steps at each observed value.\n   - The maximum absolute deviation between observed and expected bin probabilities $$\\max_i \\lvert \\mathrm{Obs}_i - \\mathrm{Exp}_i \\rvert.$$\n5. For each test case, output a list of four quantities: the number $n$ of good primes used, followed by the three real-valued statistics in the order $\\mathrm{KS}$, $\\chi^2$, and the maximum absolute bin deviation, each represented as a floating-point number.\n\nUse the following fixed test suite.\n\n- Case $1$ (non-CM, typical range): $a = -1$, $b = 1$, $B = 5000$, $m = 25$.\n- Case $2$ (non-CM, small-sample boundary): $a = -1$, $b = 1$, $B = 200$, $m = 10$.\n- Case $3$ (CM diagnostic): $a = 0$, $b = -1$, $B = 5000$, $m = 25$.\n- Case $4$ (non-CM, different coefficients): $a = -2$, $b = 3$, $B = 4000$, $m = 20$.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry corresponds to one test case and is itself a list of the four quantities described in item $5$ in the same order. For example, an output with two cases would look like $\\left[\\left[n_1, s_{1,1}, s_{1,2}, s_{1,3}\\right],\\left[n_2, s_{2,1}, s_{2,2}, s_{2,3}\\right]\\right]$.\n\nNo user input is required; all parameters are specified above. All angles are in radians, and there are no physical units involved. All numerical results must be represented as plain floating-point numbers or integers, as appropriate, with no percentage signs. The program must be self-contained and must not read from or write to any external files.", "solution": "The core of the problem is to compute the normalized traces of Frobenius, $t_p$, for a set of primes $p$ and an elliptic curve $E_{a,b}$, and then to perform a goodness-of-fit analysis against the theoretical Sato–Tate distribution. The procedure can be broken down into the following distinct steps, which will be implemented for each test case specified.\n\nFirst, for each test case defined by parameters $a, b, B, m$, we must identify the elliptic curve $E_{a,b} \\colon y^2 = x^3 + a x + b$. The discriminant $\\Delta = -16(4a^3 + 27b^2)$ is computed to identify primes of bad reduction.\n\nSecond, a list of all prime numbers $p$ such that $5 \\le p \\le B$ is generated. A Sieve of Eratosthenes is an efficient method for this task.\n\nThird, for each generated prime $p$, we check if it is a prime of good reduction by testing if $p$ divides $\\Delta$. If $p \\nmid \\Delta$, we proceed to compute the trace of Frobenius, $a_p$. The problem specifies a method based on the Legendre symbol, $\\chi_p(r)$. The number of points on the curve over the finite field $\\mathbb{F}_p$ is given by\n$$ \\#E(\\mathbb{F}_p) = 1 + \\sum_{x=0}^{p-1} \\left(1 + \\chi_p(x^3 + ax + b)\\right) $$\nwhere the initial $1$ accounts for the point at infinity. This can be rewritten as\n$$ \\#E(\\mathbb{F}_p) = 1 + p + \\sum_{x=0}^{p-1} \\chi_p(x^3 + ax + b) $$\nThe trace of Frobenius is defined as $a_p = p + 1 - \\#E(\\mathbb{F}_p)$. Substituting the expression for $\\#E(\\mathbb{F}_p)$ yields a more direct formula for $a_p$:\n$$ a_p = p + 1 - \\left(1 + p + \\sum_{x=0}^{p-1} \\chi_p(x^3 + ax + b)\\right) = - \\sum_{x=0}^{p-1} \\chi_p(x^3 + ax + b) $$\nThe Legendre symbol $\\chi_p(r)$ for a prime $p$ is computed as $r^{(p-1)/2} \\pmod p$. The result is $1$ if $r$ is a quadratic residue, $-1$ (represented as $p-1$ in modular arithmetic) if $r$ is a non-residue, and $0$ if $r \\equiv 0 \\pmod p$. After computing $a_p$, the normalized trace is calculated as $t_p = a_p / (2\\sqrt{p})$. This value is guaranteed by Hasse's theorem to be in the interval $[-1, 1]$. We collect these $t_p$ values for all good primes $p \\le B$.\n\nFourth, we perform statistical analysis on the collected set of $n$ values of $t_p$.\n1.  **Histogram and Observed Probabilities**: The interval $[-1, 1]$ is divided into $m$ bins of equal width $w = 2/m$. The bin edges are $b_i = -1 + i \\cdot w$ for $i \\in \\{0, 1, \\dots, m\\}$. The observed values $\\{t_p\\}$ are binned, and the count for each bin is divided by the total number of values $n$ to obtain the observed probabilities, $\\mathrm{Obs}_i$.\n2.  **Sato–Tate CDF and Expected Probabilities**: For a non-CM curve, the theoretical distribution of $t_p$ values is the Sato–Tate distribution, with probability density function $f_{\\mathrm{ST}}(t) = \\frac{2}{\\pi}\\sqrt{1-t^2}$ on $[-1, 1]$. The cumulative distribution function (CDF) is $F_{\\mathrm{ST}}(t) = \\int_{-1}^t f_{\\mathrm{ST}}(u) \\, du$. Using the provided antiderivative, this evaluates to:\n    $$ F_{\\mathrm{ST}}(t) = \\frac{1}{\\pi}\\left(t\\sqrt{1-t^2} + \\arcsin{t}\\right) + \\frac{1}{2} $$\n    The expected probability $\\mathrm{Exp}_i$ for the $i$-th bin $[b_{i-1}, b_i]$ is given by $F_{\\mathrm{ST}}(b_i) - F_{\\mathrm{ST}}(b_{i-1})$.\n3.  **Statistical Measures**: We compute three statistics to quantify the goodness-of-fit:\n    -   The chi-square-like statistic, as defined in the problem: $$\\chi^2 = \\sum_{i=1}^m \\frac{(\\mathrm{Obs}_i - \\mathrm{Exp}_i)^2}{\\max(\\mathrm{Exp}_i, \\varepsilon)},$$ where $\\varepsilon$ is a small constant (e.g., $10^{-12}$) to prevent division by zero.\n    -   The maximum absolute deviation between bin probabilities: $$\\max_i |\\mathrm{Obs}_i - \\mathrm{Exp}_i|.$$\n    -   The Kolmogorov–Smirnov (KS) statistic, which measures the maximum difference between the empirical CDF $\\widehat{F}_n(t)$ and the theoretical CDF $F_{\\mathrm{ST}}(t)$. For a sorted sample $t_{(1)} \\le \\dots \\le t_{(n)}$, the statistic is computed as:\n        $$ \\mathrm{KS} = \\max_{i=1,\\dots,n} \\max\\left( \\left| \\frac{i}{n} - F_{\\mathrm{ST}}(t_{(i)}) \\right|, \\left| \\frac{i-1}{n} - F_{\\mathrm{ST}}(t_{(i)}) \\right| \\right) $$\n\nFinally, for each test case, the program will output a list containing four values: the number of good primes $n$, the KS statistic, the $\\chi^2$ statistic, and the maximum absolute bin deviation. The results from all test cases are collected into a single list of lists for the final output. The case $a=0, b=-1$ corresponds to a curve with Complex Multiplication (CM), for which the Sato–Tate theorem does not apply in the form stated. The resulting statistics are expected to show a poor fit, serving as a diagnostic test of both the implementation and the underlying number theory.", "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Main solver function to process all test cases and print the final result.\n    \"\"\"\n    test_cases = [\n        # (a, b, B, m)\n        (-1, 1, 5000, 25),  # Case 1 (non-CM, typical)\n        (-1, 1, 200, 10),   # Case 2 (non-CM, small-sample)\n        (0, -1, 5000, 25),  # Case 3 (CM diagnostic)\n        (-2, 3, 4000, 20),  # Case 4 (non-CM, different coeffs)\n    ]\n\n    results = []\n    for a, b, B, m in test_cases:\n        result = analyze_curve(a, b, B, m)\n        results.append(result)\n\n    # The final print statement must match the required format exactly.\n    # The format is a string representation of a list of lists.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef analyze_curve(a, b, B, m):\n    \"\"\"\n    Performs the full analysis for a single elliptic curve.\n    \"\"\"\n    primes = sieve_of_eratosthenes(B)\n    delta = -16 * (4 * a**3 + 27 * b**2)\n    \n    t_p_values = []\n    \n    for p in primes:\n        if p  5:\n            continue\n        if delta % p == 0:\n            continue\n\n        # Calculate a_p = -sum_{x=0}^{p-1} (x^3 + ax + b | p)\n        a_p_sum = 0\n        for x in range(p):\n            r = (x**3 + a * x + b) % p\n            a_p_sum += legendre_symbol(r, p)\n        \n        a_p = -a_p_sum\n        \n        # Check Hasse bound for safety, although it's a theorem\n        if abs(a_p) > 2 * math.sqrt(p):\n            # This should not happen for a correct implementation\n            continue\n\n        t_p = a_p / (2 * math.sqrt(p))\n        t_p_values.append(t_p)\n\n    n = len(t_p_values)\n    if n == 0:\n        return [0, 0.0, 0.0, 0.0]\n\n    # --- Statistical Analysis ---\n    \n    # 1. Chi-square and Max Deviation\n    obs_counts, bin_edges = np.histogram(t_p_values, bins=m, range=(-1, 1))\n    obs_probs = obs_counts / n\n\n    exp_probs = np.zeros(m)\n    for i in range(m):\n        exp_probs[i] = sato_tate_cdf(bin_edges[i+1]) - sato_tate_cdf(bin_edges[i])\n    \n    # Small constant for chi-square denominator stability\n    epsilon = 1e-12\n    chi2_stat = np.sum(((obs_probs - exp_probs)**2) / np.maximum(exp_probs, epsilon))\n    \n    max_bin_dev = np.max(np.abs(obs_probs - exp_probs))\n\n    # 2. Kolmogorov-Smirnov Statistic\n    t_p_sorted = np.sort(t_p_values)\n    ks_stat = 0.0\n    for i in range(n):\n        t_val = t_p_sorted[i]\n        F_emp_left = i / n\n        F_emp_right = (i + 1) / n\n        F_st_val = sato_tate_cdf(t_val)\n        \n        ks_stat = max(ks_stat, abs(F_emp_right - F_st_val), abs(F_emp_left - F_st_val))\n\n    return [n, ks_stat, chi2_stat, max_bin_dev]\n\ndef sieve_of_eratosthenes(n_limit):\n    \"\"\"\n    Generates primes up to n_limit using the Sieve of Eratosthenes.\n    \"\"\"\n    primes = []\n    sieve = [True] * (n_limit + 1)\n    sieve[0] = sieve[1] = False\n    for p in range(2, int(math.sqrt(n_limit)) + 1):\n        if sieve[p]:\n            for multiple in range(p * p, n_limit + 1, p):\n                sieve[multiple] = False\n    for p in range(2, n_limit + 1):\n        if sieve[p]:\n            primes.append(p)\n    return primes\n\ndef legendre_symbol(a, p):\n    \"\"\"\n    Computes the Legendre symbol (a | p).\n    p must be an odd prime.\n    \"\"\"\n    ls = pow(a, (p - 1) // 2, p)\n    if ls == p - 1:\n        return -1\n    return ls\n\ndef sato_tate_cdf(t):\n    \"\"\"\n    Computes the Cumulative Distribution Function (CDF) of the Sato-Tate measure.\n    F_ST(t) = (1/pi) * (t*sqrt(1-t^2) + arcsin(t)) + 1/2\n    \"\"\"\n    if t = -1.0:\n        return 0.0\n    if t >= 1.0:\n        return 1.0\n    return (1/math.pi) * (t * math.sqrt(1 - t**2) + math.asin(t)) + 0.5\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "3013166"}]}