{"hands_on_practices": [{"introduction": "Fermat's theorem on sums of two squares is a beautiful theoretical result, but how do we actually find the two squares for a given prime? This practice moves from theory to application by guiding you through the implementation of Cornacchia’s algorithm. By coding this algorithm, you will gain a deep, procedural understanding of how the properties of quadratic residues and the Euclidean algorithm combine to constructively solve the equation $p = a^2 + b^2$ for primes $p \\equiv 1 \\pmod 4$ [@problem_id:3089708].", "problem": "Implement a complete program that, for each given prime input $p$, attempts to find nonnegative integers $a$ and $b$ such that $a^2 + b^2 = p$ using Cornacchia’s algorithm. Your implementation must be grounded in first principles of number theory: use the concept of quadratic residues modulo a prime, Euler’s criterion for the Legendre symbol, and the Tonelli–Shanks algorithm to compute a square root modulo a prime. The mathematical foundation you may use includes the following well-tested facts and core definitions:\n- For an odd prime $p$, the Legendre symbol $\\left(\\frac{n}{p}\\right)$ equals $n^{\\frac{p-1}{2}} \\bmod p \\in \\{1,p-1\\}$ by Euler’s criterion, indicating whether $n$ is a quadratic residue modulo $p$.\n- For an odd prime $p$ with $p \\equiv 1 \\pmod{4}$, the integer $-1$ is a quadratic residue modulo $p$.\n- The Tonelli–Shanks algorithm deterministically computes a square root of a quadratic residue modulo an odd prime $p$.\n- Cornacchia’s algorithm, specialized to the case $D = 1$, uses any $r$ with $r^2 \\equiv -1 \\pmod p$ and the Euclidean algorithm to produce a candidate $x$ with $x^2 \\le p$, then checks whether $p - x^2$ is a perfect square.\n\nYour task:\n- Implement Cornacchia’s algorithm for the specific Diophantine equation $a^2 + b^2 = p$ with $p$ a prime.\n- When $p = 2$, return the trivial representation $1^2 + 1^2 = 2$.\n- When $p \\equiv 3 \\pmod{4}$, no nontrivial representation exists, and your program must return no pair.\n- When $p \\equiv 1 \\pmod{4}$, use the Tonelli–Shanks algorithm to compute a square root of $-1 \\bmod p$ and then carry out Cornacchia’s descent to obtain a candidate pair.\n- Your program must verify that the pair $(a,b)$ it outputs satisfies $a^2 + b^2 = p$. If no valid pair is found, output that no representation exists.\n\nInput specification for this challenge:\n- There is no external input. Your program must run on its own over the fixed test suite below.\n\nTest suite:\n- Primes to test: $[2, 5, 13, 29, 37, 97, 101, 109, 149, 3, 7, 11, 999983, 104729]$.\n\nOutput specification:\n- For each $p$ in the test suite, produce either:\n  - A list $[a,b]$ of two nonnegative integers ordered so that $a \\ge b \\ge 0$ satisfying $a^2 + b^2 = p$, or\n  - The empty list $[]$ if no such representation exists.\n- Aggregate the results for all test cases into a single line of output containing the results as a comma-separated list of the per-test-case outputs, enclosed in square brackets. For example, an output could look like $[[a_1,b_1],[],[a_3,b_3],\\dots]$ with no spaces.\n\nYour implementation must be self-contained, use only the standard library (plus the permitted libraries), and must not read from input nor write any additional text beyond the single required output line. All integers and expressions are unitless pure numbers; no physical units or angles are involved. The final output is a list of lists of integers as specified above.", "solution": "The problem of representing a prime number $p$ as a sum of two squares, i.e., finding non-negative integers $a$ and $b$ such that $a^2 + b^2 = p$, is a classical problem in number theory. The conditions for the existence of such a representation are given by Fermat's theorem on sums of two squares, which states that an odd prime $p$ can be expressed as a sum of two squares if and only if $p \\equiv 1 \\pmod{4}$. The prime $2$ is a special case, $2=1^2+1^2$. The problem as stated is well-posed and scientifically sound, providing a clear path to a solution through established algorithms. We will proceed by analyzing the cases for $p$ and applying Cornacchia's algorithm where appropriate.\n\nThe solution is partitioned into three cases based on the prime $p$:\n\n1.  **Case $p=2$**: The prime $p=2$ is the only even prime. The representation is trivially $2 = 1^2 + 1^2$. The pair of integers is $(1, 1)$.\n\n2.  **Case $p \\equiv 3 \\pmod{4}$**: For any integer $x$, its square $x^2$ can only be congruent to $0$ or $1$ modulo $4$.\n    - If $x$ is even, $x=2k$ for some integer $k$. Then $x^2 = (2k)^2 = 4k^2 \\equiv 0 \\pmod{4}$.\n    - If $x$ is odd, $x=2k+1$ for some integer $k$. Then $x^2 = (2k+1)^2 = 4k^2+4k+1 \\equiv 1 \\pmod{4}$.\n    Consequently, a sum of two squares, $a^2+b^2$, can only be congruent to $0+0=0$, $0+1=1$, or $1+1=2$ modulo $4$. A sum of two squares can never be congruent to $3$ modulo $4$. Since the given prime $p$ satisfies $p \\equiv 3 \\pmod{4}$, no integers $a, b$ can exist such that $a^2+b^2=p$.\n\n3.  **Case $p \\equiv 1 \\pmod{4}$**: For primes of this form, Fermat's theorem guarantees that a unique representation as a sum of two non-negative squares exists (up to ordering). The problem requires a constructive approach using Cornacchia's algorithm, which we now detail.\n\n**Cornacchia's Algorithm for $a^2 + b^2 = p$**\n\nThe algorithm is based on a constructive proof of Fermat's theorem. The existence of a solution pair $(a,b)$ for $p=a^2+b^2$ implies $a^2 \\equiv -b^2 \\pmod p$. Assuming $b \\not\\equiv 0 \\pmod p$ (which must be true, otherwise $p$ would be a perfect square, which is impossible for a prime), $b$ has a multiplicative inverse modulo $p$. Thus, we can write $(a \\cdot b^{-1})^2 \\equiv -1 \\pmod p$. This shows that a necessary condition for $p$ to be a sum of two squares is that $-1$ must be a quadratic residue modulo $p$. Cornacchia's algorithm constructively reverses this line of reasoning.\n\n**Step 1: Compute a square root of $-1$ modulo $p$**\n\nFor a prime $p$ such that $p \\equiv 1 \\pmod{4}$, we must first find an integer $r$ satisfying $r^2 \\equiv -1 \\pmod p$. The existence of such a root is guaranteed by Euler's criterion for the Legendre symbol:\n$$ \\left(\\frac{-1}{p}\\right) \\equiv (-1)^{\\frac{p-1}{2}} \\pmod p $$\nSince $p \\equiv 1 \\pmod{4}$, we can write $p=4k+1$ for some integer $k \\ge 1$. Then the exponent is $\\frac{p-1}{2} = \\frac{4k}{2} = 2k$, which is an even integer. Therefore, $\\left(\\frac{-1}{p}\\right) = 1$, confirming that $-1$ is a quadratic residue modulo $p$.\n\nTo compute $r$, we use the **Tonelli-Shanks algorithm**, a general method for finding square roots modulo a prime.\nLet $n \\equiv -1 \\pmod p$. The algorithm proceeds as follows:\n1.  Decompose $p-1$ as $p-1 = 2^S \\cdot Q$, where $Q$ is odd.\n2.  Find a quadratic non-residue $z$ modulo $p$. This can be done by testing integers $z=2, 3, \\dots$ and checking if $\\left(\\frac{z}{p}\\right) = z^{(p-1)/2} \\equiv -1 \\pmod p$. Such a $z$ is guaranteed to exist and is typically small.\n3.  Initialize the variables for the main loop:\n    -   $M \\leftarrow S$\n    -   $c \\leftarrow z^Q \\pmod p$\n    -   $t \\leftarrow n^Q \\pmod p$\n    -   $R \\leftarrow n^{(Q+1)/2} \\pmod p$\n4.  Repeatedly update the variables until $t \\equiv 1 \\pmod p$. In each iteration:\n    -   If $t \\equiv 1 \\pmod p$, the loop terminates and $R$ is a square root of $n$.\n    -   Find the smallest exponent $i \\in \\{1, 2, \\dots, M-1\\}$ such that $t^{2^i} \\equiv 1 \\pmod p$.\n    -   Compute a factor $b \\leftarrow c^{2^{M-i-1}} \\pmod p$.\n    -   Update the variables: $M \\leftarrow i$, $c \\leftarrow b^2 \\pmod p$, $t \\leftarrow t \\cdot c \\pmod p$, and $R \\leftarrow R \\cdot b \\pmod p$.\nLet the computed root be $r_0$. If $r_0  p/2$, we may use $r = p - r_0$ for convenience, though the algorithm works with either root.\n\n**Step 2: Apply the Euclidean Algorithm (Cornacchia's Descent)**\n\nWith a root $r$ of $r^2+1 \\equiv 0 \\pmod p$ in hand, we apply the standard Euclidean algorithm to the pair $(p, r)$.\nWe generate the sequence of remainders $r_0=p, r_1=r, r_2 = r_0 \\pmod{r_1}, \\dots$.\nLet the sequence be defined by $r_{k+1} = r_{k-1} \\pmod{r_k}$. We continue this process until we find the first remainder $r_k$ such that $r_k  \\sqrt{p}$. Let this remainder be $x=r_k$. Thue's Lemma guarantees that such a remainder exists and provides the foundation for why this $x$ is a valid candidate.\n\n**Step 3: Test the Candidate Solution**\n\nLet $x$ be the candidate integer found in Step 2. We compute the value $s = p - x^2$. If $s$ is a perfect square, i.e., $s=y^2$ for some integer $y0$, then we have found the representation $p = x^2+y^2$. We can verify if $s$ is a perfect square by computing its integer square root $y = \\lfloor\\sqrt{s}\\rfloor$ and checking if $y^2 = s$. If it is, the pair of integers is $(x,y)$. The final result is then ordered such that $a \\ge b$, so we set $a = \\max(x,y)$ and $b = \\min(x,y)$. If $s$ is not a perfect square, Cornacchia's algorithm has failed. However, for a prime $p \\equiv 1 \\pmod 4$, theory guarantees it will succeed.\n\nThis completes the full algorithm. The implementation will systematically apply these steps to each prime in the test suite.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport math\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Main function to run the algorithm on the test suite and print the results.\n    \"\"\"\n    test_cases = [2, 5, 13, 29, 37, 97, 101, 109, 149, 3, 7, 11, 999983, 104729]\n\n    results = []\n    for p in test_cases:\n        pair = find_sum_two_squares(p)\n        results.append(pair)\n\n    # Format the final output string as specified.\n    # str(list) adds spaces, so we build the string representation manually.\n    formatted_results = []\n    for res in results:\n        if res:\n            formatted_results.append(f\"[{res[0]},{res[1]}]\")\n        else:\n            formatted_results.append(\"[]\")\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\ndef find_sum_two_squares(p: int) - list[int]:\n    \"\"\"\n    Finds a representation of a prime p as a sum of two squares.\n    \n    Args:\n        p: A prime number.\n    \n    Returns:\n        A list [a, b] with a = b = 0 such that a^2 + b^2 = p,\n        or an empty list if no such representation exists.\n    \"\"\"\n    if p == 2:\n        return [1, 1]\n    \n    if p % 4 == 3:\n        return []\n\n    # Case p % 4 == 1\n    # Step 1: Find a square root of -1 mod p using Tonelli-Shanks\n    r = tonelli_shanks(p - 1, p)\n    \n    # Cornacchia's algorithm\n    # Step 2: Use Euclidean algorithm to find a candidate x\n    # We can choose the smaller root of -1 mod p\n    r = min(r, p - r)\n    \n    p_sqrt = math.isqrt(p)\n    \n    a, b = p, r\n    while b  p_sqrt:\n        a, b = b, a % b\n    \n    x = b\n    \n    # Step 3: Check if p a_candidate^2 is a perfect square\n    s = p - x*x\n    if s  0:\n        y = math.isqrt(s)\n        if y*y == s:\n            result = sorted([x, y], reverse=True)\n            # Verification\n            if result[0]**2 + result[1]**2 == p:\n                return result\n\n    return []\n\ndef tonelli_shanks(n: int, p: int) - int:\n    \"\"\"\n    Tonelli-Shanks algorithm to find a square root of n modulo p.\n    Assumes p is an odd prime and n is a quadratic residue modulo p.\n    \n    Args:\n        n: An integer that is a quadratic residue modulo p.\n        p: An odd prime number.\n        \n    Returns:\n        An integer x such that x^2 % p == n.\n    \"\"\"\n    # Simple case for p % 4 == 3\n    if p % 4 == 3:\n        return pow(n, (p + 1) // 4, p)\n\n    # Decompose p-1 = 2^S * Q\n    Q = p - 1\n    S = 0\n    while Q % 2 == 0:\n        Q //= 2\n        S += 1\n\n    # Find a quadratic non-residue z\n    z = 2\n    while pow(z, (p - 1) // 2, p) == 1:\n        z += 1\n\n    # Initialize\n    M = S\n    c = pow(z, Q, p)\n    t = pow(n, Q, p)\n    R = pow(n, (Q + 1) // 2, p)\n\n    # Main loop\n    while t != 1:\n        if t == 0:\n            return 0\n        \n        i = 0\n        temp_t = t\n        while temp_t != 1:\n            temp_t = (temp_t * temp_t) % p\n            i += 1\n            if i == M: # Should not happen if n is a quadratic residue\n                return -1 \n        \n        power = M - i - 1\n        b = pow(c, 2**power, p)\n        \n        M = i\n        c = (b * b) % p\n        t = (t * c) % p\n        R = (R * b) % p\n        \n    return R\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "3089708"}, {"introduction": "The ability to represent a number as a sum of squares is dictated by its prime factorization. This exercise challenges you to explore the profound consequences of this principle, particularly the role of prime factors congruent to $3$ modulo $4$ [@problem_id:3089714]. By analyzing how the parity of their exponents determines the possibility of a representation as a sum of two squares, you will also see why Lagrange's four-square theorem becomes a necessary and powerful alternative.", "problem": "Let $n\\ge 1$ be an integer. For representations of $n$ as a sum of two squares, use the structure of the ring of Gaussian integers $\\mathbb{Z}[i]$ (complex numbers of the form $a+bi$ with $a,b\\in\\mathbb{Z}$), its unique factorization property, and the norm $N(a+bi)=a^2+b^2$ together with norm multiplicativity $N(\\alpha\\beta)=N(\\alpha)N(\\beta)$. For representations as a sum of four squares, use the fact (Lagrange's Four-Square Theorem) that every positive integer is a sum of four squares.\n\nAnalyze how the parity of exponents of primes $q\\equiv 3\\pmod{4}$ in the prime factorization of $n$ dictates which representations exist and when zero coordinates must appear. Decide which of the following statements are correct (select all that apply):\n\nA. The integer $n$ can be represented as $x^2+y^2$ with $x,y\\in\\mathbb{Z}$ if and only if, in the prime factorization of $n$, every prime $q\\equiv 3\\pmod{4}$ appears with an even exponent.\n\nB. In any representation $n=x^2+y^2$ with $x,y\\in\\mathbb{Z}$, if a prime $q\\equiv 3\\pmod{4}$ divides $n$, then $q$ divides both $x$ and $y$.\n\nC. If some prime $q\\equiv 3\\pmod{4}$ divides $n$ to an odd power, then in every representation $n=u_1^2+u_2^2+u_3^2+u_4^2$ with $u_i\\in\\mathbb{Z}$, at least three of the $u_i$ are nonzero.\n\nD. If every prime factor $q\\equiv 3\\pmod{4}$ appears to an even exponent in $n$ and at least one such prime divides $n$, then any representation $n=u_1^2+u_2^2+u_3^2+u_4^2$ must have a zero coordinate.", "solution": "The problem requires an analysis of integer representations as sums of two and four squares, based on the prime factorization of the integer $n \\ge 1$. We will validate the problem statement and then proceed to evaluate each of the four provided statements (A, B, C, D).\n\n**Problem Validation**\n\n*   **Step 1: Extract Givens**\n    *   $n \\ge 1$ is an integer.\n    *   For sums of two squares, utilize the ring of Gaussian integers $\\mathbb{Z}[i] = \\{a+bi \\mid a,b \\in \\mathbb{Z}\\}$, its unique factorization property, the norm $N(a+bi) = a^2+b^2$, and norm multiplicativity $N(\\alpha\\beta) = N(\\alpha)N(\\beta)$.\n    *   For sums of four squares, Lagrange's Four-Square Theorem is given: every positive integer is a sum of four squares.\n    *   The core of the analysis is the role of the parity of exponents of primes $q \\equiv 3 \\pmod 4$ in the prime factorization of $n$.\n\n*   **Step 2: Validate Using Extracted Givens**\n    *   **Scientifically Grounded:** The problem is based entirely on established theorems in number theory, namely Fermat's theorem on sums of two squares (which is derived from the arithmetic of $\\mathbb{Z}[i]$) and Lagrange's four-square theorem. The properties of $\\mathbb{Z}[i]$ are standard. The problem is mathematically sound.\n    *   **Well-Posed:** The problem asks for the evaluation of four distinct, precise mathematical statements. Each statement has a definite truth value (true or false) that can be determined through logical proof or counterexample.\n    *   **Objective:** The language is formal and unambiguous. The criteria, such as $q \\equiv 3 \\pmod 4$, are mathematically precise.\n    *   **Completeness and Consistency:** The problem provides the necessary theoretical framework ($\\mathbb{Z}[i]$ for two squares, Lagrange's theorem for four squares) to address the statements. There are no contradictions.\n\n*   **Step 3: Verdict and Action**\n    *   The problem statement is valid. We will proceed with a detailed analysis of each statement.\n\n**Analysis of Statements**\n\n**Statement A: The integer $n$ can be represented as $x^2+y^2$ with $x,y\\in\\mathbb{Z}$ if and only if, in the prime factorization of $n$, every prime $q\\equiv 3\\pmod{4}$ appears with an even exponent.**\n\nThis is a statement of Fermat's theorem on sums of two squares. We use the properties of the Gaussian integers $\\mathbb{Z}[i]$ as instructed.\n\nA representation $n=x^2+y^2$ for integers $x,y$ is equivalent to stating that $n$ is the norm of a Gaussian integer $\\alpha = x+iy \\in \\mathbb{Z}[i]$, i.e., $n = N(\\alpha)$.\n\nThe prime factorization of rational primes $p \\in \\mathbb{Z}$ within the unique factorization domain $\\mathbb{Z}[i]$ is as follows:\n1.  If $p=2$, then $2 = (1+i)(1-i) = -i(1+i)^2$. $1+i$ is a prime in $\\mathbb{Z}[i]$ with norm $N(1+i)=2$.\n2.  If $p \\equiv 1 \\pmod 4$, then $p$ can be written as a sum of two squares in $\\mathbb{Z}$, so $p=a^2+b^2 = (a+bi)(a-bi)$. Here, $p$ splits into two distinct (up to associates) prime factors in $\\mathbb{Z}[i]$.\n3.  If $p \\equiv 3 \\pmod 4$, then $p$ cannot be written as a sum of two squares. It remains prime in $\\mathbb{Z}[i]$ (it is an inert prime). $N(p) = p^2$.\n\nLet's prove the \"if and only if\" statement.\n\n($\\Rightarrow$) \"Only if\" part: Assume $n = x^2+y^2 = N(x+iy)$. Let the prime factorization of $n$ in $\\mathbb{Z}$ be $n = 2^k \\prod p_i^{a_i} \\prod q_j^{b_j}$, where $p_i \\equiv 1 \\pmod 4$ and $q_j \\equiv 3 \\pmod 4$.\nLet $q$ be a prime factor of $n$ such that $q \\equiv 3 \\pmod 4$. Since $n = (x+iy)(x-iy)$, $q$ must divide the product $(x+iy)(x-iy)$. As $q$ is prime in $\\mathbb{Z}[i]$, $q$ must divide either $x+iy$ or $x-iy$. If $q$ divides $x+iy = x+iy$, then taking the complex conjugate, $\\bar{q}=q$ must divide $\\overline{x+iy} = x-iy$. Thus, $q$ divides both factors.\nLet $q^e$ be the highest power of $q$ that divides $x+iy$. Then $q^e$ also is the highest power of $q$ that divides $x-iy$. The total power of $q$ in the prime factorization of $n=(x+iy)(x-iy)$ in $\\mathbb{Z}[i]$ is therefore $q^{2e}$. This corresponds to a factor of $q^{2e}$ in the factorization of $n$ in $\\mathbb{Z}$. Thus, the exponent $b_j$ of any prime $q_j \\equiv 3 \\pmod 4$ in the factorization of $n$ must be even.\n\n($\\Leftarrow$) \"If\" part: Assume in the prime factorization of $n$, every prime $q \\equiv 3 \\pmod 4$ has an even exponent, say $2e_j$. So $n = 2^k \\prod p_i^{a_i} \\prod q_j^{2e_j}$.\nWe want to show $n$ is the norm of some Gaussian integer.\n- $N( (1+i)^k ) = (N(1+i))^k = 2^k$.\n- For each $p_i \\equiv 1 \\pmod 4$, $p_i$ is a norm, e.g., $p_i = N(\\pi_i)$ for some prime $\\pi_i \\in \\mathbb{Z}[i]$. Thus $p_i^{a_i} = N(\\pi_i)^{a_i} = N(\\pi_i^{a_i})$.\n- For each $q_j \\equiv 3 \\pmod 4$, $q_j^{2e_j} = (q_j^{e_j})^2 + 0^2 = N(q_j^{e_j})$.\nSince the norm is multiplicative, $n$ is the norm of a product of Gaussian integers:\n$n = N((1+i)^k) \\cdot \\prod N(\\pi_i^{a_i}) \\cdot \\prod N(q_j^{e_j}) = N( (1+i)^k \\prod \\pi_i^{a_i} \\prod q_j^{e_j} )$.\nLetting $\\alpha = (1+i)^k \\prod \\pi_i^{a_i} \\prod q_j^{e_j}$, which is some Gaussian integer $X+iY$, we have $n=N(\\alpha)=X^2+Y^2$.\n\nThe statement is a correct formulation of the theorem.\nVerdict: **Correct**.\n\n**Statement B: In any representation $n=x^2+y^2$ with $x,y\\in\\mathbb{Z}$, if a prime $q\\equiv 3\\pmod{4}$ divides $n$, then $q$ divides both $x$ and $y$.**\n\nLet $q$ be a prime such that $q \\equiv 3 \\pmod 4$. Assume $q$ divides $n=x^2+y^2$. This means $x^2+y^2 \\equiv 0 \\pmod q$, which can be written as $x^2 \\equiv -y^2 \\pmod q$.\nLet's assume, for the sake of contradiction, that $q$ does not divide $y$. Since $q$ is prime, $y$ has a multiplicative inverse modulo $q$, denoted $y^{-1}$. We can multiply the congruence by $(y^{-1})^2$:\n$(xy^{-1})^2 \\equiv -1 \\pmod q$.\nThis implies that $-1$ is a quadratic residue modulo $q$.\nHowever, by the first supplement to the law of quadratic reciprocity, the Legendre symbol $(\\frac{-1}{q})$ is given by $(-1)^{(q-1)/2}$.\nSince $q \\equiv 3 \\pmod 4$, we can write $q=4k+3$ for some integer $k \\ge 0$. Then, the exponent is $(q-1)/2 = (4k+2)/2 = 2k+1$, which is an odd integer.\nTherefore, $(\\frac{-1}{q}) = (-1)^{2k+1} = -1$.\nThis means $-1$ is a quadratic non-residue modulo $q$, which contradicts our finding that $(xy^{-1})^2 \\equiv -1 \\pmod q$.\nThe contradiction arose from the assumption that $q$ does not divide $y$. Thus, our assumption must be false, so $q$ must divide $y$.\nSince $q|y$, we have $y \\equiv 0 \\pmod q$. From $x^2+y^2 \\equiv 0 \\pmod q$, we get $x^2+0^2 \\equiv 0 \\pmod q$, so $x^2 \\equiv 0 \\pmod q$. Since $q$ is prime, this implies $x \\equiv 0 \\pmod q$, meaning $q$ divides $x$.\nThus, if $q|(x^2+y^2)$, then $q|x$ and $q|y$.\n\nVerdict: **Correct**.\n\n**Statement C: If some prime $q\\equiv 3\\pmod{4}$ divides $n$ to an odd power, then in every representation $n=u_1^2+u_2^2+u_3^2+u_4^2$ with $u_i\\in\\mathbb{Z}$, at least three of the $u_i$ are nonzero.**\n\nThe statement \"at least three of the $u_i$ are nonzero\" is equivalent to \"the number of zero coordinates is at most one\". Let's check if it's possible to have two or three zero coordinates.\nBy Lagrange's theorem, a representation $n=u_1^2+u_2^2+u_3^2+u_4^2$ always exists since $n \\ge 1$.\n\nCase 1: Three zero coordinates.\nIf three of the $u_i$ are zero, then $n = u_1^2$ for some integer $u_1$. This means $n$ is a perfect square. If $n$ is a perfect square, then in its prime factorization $n = \\prod p_i^{e_i}$, all exponents $e_i$ must be even. This contradicts the given condition that some prime $q \\equiv 3 \\pmod 4$ divides $n$ to an odd power. Thus, a representation with three zeros is impossible.\n\nCase 2: Two zero coordinates.\nIf two of the $u_i$ are zero, then $n = u_1^2+u_2^2$ for some integers $u_1, u_2$. According to Statement A (Fermat's theorem), an integer can be represented as a sum of two squares if and only if every prime factor $q \\equiv 3 \\pmod 4$ in its prime factorization has an even exponent. This contradicts the given condition that some prime $q \\equiv 3 \\pmod 4$ divides $n$ to an odd power. Thus, a representation with two zeros is impossible.\n\nSince representations with two or three zero coordinates are impossible (and four zeros is impossible because $n \\ge 1$), any representation of $n$ as a sum of four squares must have at most one zero coordinate. This means the number of non-zero coordinates must be at least $4-1=3$.\n\nVerdict: **Correct**.\n\n**Statement D: If every prime factor $q\\equiv 3\\pmod{4}$ appears to an even exponent in $n$ and at least one such prime divides $n$, then any representation $n=u_1^2+u_2^2+u_3^2+u_4^2$ must have a zero coordinate.**\n\nThis statement claims that such an integer $n$ cannot be represented as a sum of four *non-zero* squares. The word \"any\" makes this a very strong claim. We can test this with a counterexample.\n\nLet's find an integer $n$ that satisfies the hypothesis.\nLet's choose the smallest prime $q \\equiv 3 \\pmod 4$, which is $q=3$. The hypothesis requires its exponent to be even and positive, so let's use $3^2=9$. Let's construct $n$ by multiplying by another prime.\nLet $n = 3^2 \\cdot 2 = 18$.\nThe prime factorization is $n=2 \\cdot 3^2$.\nThe set of prime factors $q \\equiv 3 \\pmod 4$ is $\\{3\\}$. The exponent of $3$ is $2$, which is even.\n\"At least one such prime divides $n$\": true, since $3|18$.\nSo, $n=18$ satisfies the hypothesis.\n\nThe statement D claims that *any* representation $18 = u_1^2+u_2^2+u_3^2+u_4^2$ must have a zero coordinate. Let's see if we can find a representation with four non-zero squares.\nPossible squares are $1^2=1$, $2^2=4$, $3^2=9$, $4^2=16$.\nWe can write $18 = 9+4+4+1$.\nThis corresponds to the representation $18 = 3^2+2^2+2^2+1^2$.\nIn this representation, ($u_1, u_2, u_3, u_4$) can be taken as ($3, 2, 2, 1$). All coordinates are non-zero.\nThis representation serves as a direct counterexample to the claim that *any* representation must have a zero coordinate.\n\nLet's try another counterexample. Let $n = 3^2 \\cdot 5 = 45$.\nThe only prime factor $q \\equiv 3 \\pmod 4$ is $3$, with exponent $2$ (even). So the hypothesis is met.\nStatement D claims any representation of $45$ as a sum of four squares must have a zero.\nLet's find a representation: $45 = 36+9 = 6^2+3^2+0^2+0^2$. This one has zeros.\nLet's try to find one without zeros.\n$45 = 16+16+9+4 = 4^2+4^2+3^2+2^2$.\nThis is a representation of $45$ as a sum of four non-zero squares. This also serves as a counterexample.\n\nThe statement is false. While the condition on $n$ guarantees that a representation as a sum of two squares exists (e.g., $n = x^2+y^2+0^2+0^2$), it does not forbid a representation as a sum of four non-zero squares.\n\nVerdict: **Incorrect**.", "answer": "$$\\boxed{ABC}$$", "id": "3089714"}, {"introduction": "Lagrange's theorem guarantees every positive integer is a sum of four squares, a result underpinned by Euler's four-square identity. This identity, which shows that the product of two sums of four squares is itself a sum of four squares, is not just a coincidence; it arises from the multiplicative structure of Hamilton's quaternions [@problem_id:3089687]. This practice allows you to verify this deep connection firsthand by multiplying two quaternions and confirming that the norm of the product equals the product of the norms.", "problem": "Let $a$, $b$, $c$, and $d$ be integers and identify the quadruple $\\left(a,b,c,d\\right)$ with the Hamilton quaternion $q \\coloneqq a + b\\,\\mathbf{i} + c\\,\\mathbf{j} + d\\,\\mathbf{k}$, where $\\mathbf{i}$, $\\mathbf{j}$, and $\\mathbf{k}$ satisfy $\\mathbf{i}^2=\\mathbf{j}^2=\\mathbf{k}^2=-1$ and $\\mathbf{i}\\mathbf{j}=\\mathbf{k}$, $\\mathbf{j}\\mathbf{k}=\\mathbf{i}$, $\\mathbf{k}\\mathbf{i}=\\mathbf{j}$ together with anti-commutativity $\\mathbf{j}\\mathbf{i}=-\\mathbf{k}$, $\\mathbf{k}\\mathbf{j}=-\\mathbf{i}$, $\\mathbf{i}\\mathbf{k}=-\\mathbf{j}$. The squared norm of $q$ is defined by $N(q)\\coloneqq a^2+b^2+c^2+d^2$. The composition of sums of four squares arises from multiplying such quaternions and comparing squared norms.\n\nUsing only these definitions, carry out the following with the small integer quadruples $\\left(1,2,2,3\\right)$ and $\\left(1,1,2,2\\right)$:\n\n- Interpret them as quaternions $q \\coloneqq 1 + 2\\,\\mathbf{i} + 2\\,\\mathbf{j} + 3\\,\\mathbf{k}$ and $r \\coloneqq 1 + 1\\,\\mathbf{i} + 2\\,\\mathbf{j} + 2\\,\\mathbf{k}$.\n- Compute the product $s \\coloneqq q\\,r$ using only the multiplication rules stated above, and then compute $N(s)$ directly from its components.\n- Separately compute $N(q)$ and $N(r)$, form the product $N(q)\\,N(r)$, and verify numerically that it matches your computed $N(s)$ by explicit calculation.\n\nReport the common numerical value of $N(s)$ and $N(q)\\,N(r)$. Your final answer must be a single integer. Do not round.", "solution": "We begin from the definitions of Hamilton quaternions and their multiplication rules, together with the definition of the squared norm $N(a + b\\,\\mathbf{i} + c\\,\\mathbf{j} + d\\,\\mathbf{k}) \\coloneqq a^2 + b^2 + c^2 + d^2$.\n\nFirst, interpret the given quadruples as quaternions:\n- $q \\coloneqq 1 + 2\\,\\mathbf{i} + 2\\,\\mathbf{j} + 3\\,\\mathbf{k}$,\n- $r \\coloneqq 1 + 1\\,\\mathbf{i} + 2\\,\\mathbf{j} + 2\\,\\mathbf{k}$.\n\nCompute the product $s \\coloneqq q\\,r$ by distributivity and the multiplication rules $\\mathbf{i}^2=\\mathbf{j}^2=\\mathbf{k}^2=-1$, $\\mathbf{i}\\mathbf{j}=\\mathbf{k}$, $\\mathbf{j}\\mathbf{k}=\\mathbf{i}$, $\\mathbf{k}\\mathbf{i}=\\mathbf{j}$, and anti-commutativity for reversed order:\n\nExpand $q\\,r$ term by term:\n- From $1 \\cdot r$: $1 + 1\\,\\mathbf{i} + 2\\,\\mathbf{j} + 2\\,\\mathbf{k}$.\n- From $2\\,\\mathbf{i} \\cdot r$: $2\\,\\mathbf{i} + 2\\,\\mathbf{i}^2 + 4\\,\\mathbf{i}\\mathbf{j} + 4\\,\\mathbf{i}\\mathbf{k} = 2\\,\\mathbf{i} - 2 + 4\\,\\mathbf{k} - 4\\,\\mathbf{j}$, using $\\mathbf{i}^2=-1$, $\\mathbf{i}\\mathbf{j}=\\mathbf{k}$, $\\mathbf{i}\\mathbf{k}=-\\mathbf{j}$.\n- From $2\\,\\mathbf{j} \\cdot r$: $2\\,\\mathbf{j} + 2\\,\\mathbf{j}\\mathbf{i} + 4\\,\\mathbf{j}^2 + 4\\,\\mathbf{j}\\mathbf{k} = 2\\,\\mathbf{j} - 2\\,\\mathbf{k} - 4 + 4\\,\\mathbf{i}$, using $\\mathbf{j}\\mathbf{i}=-\\mathbf{k}$, $\\mathbf{j}^2=-1$, $\\mathbf{j}\\mathbf{k}=\\mathbf{i}$.\n- From $3\\,\\mathbf{k} \\cdot r$: $3\\,\\mathbf{k} + 3\\,\\mathbf{k}\\mathbf{i} + 6\\,\\mathbf{k}\\mathbf{j} + 6\\,\\mathbf{k}^2 = 3\\,\\mathbf{k} + 3\\,\\mathbf{j} - 6\\,\\mathbf{i} - 6$, using $\\mathbf{k}\\mathbf{i}=\\mathbf{j}$, $\\mathbf{k}\\mathbf{j}=-\\mathbf{i}$, $\\mathbf{k}^2=-1$.\n\nNow group scalar, $\\mathbf{i}$, $\\mathbf{j}$, and $\\mathbf{k}$ parts:\n\n- Scalar part: $1 + (-2) + (-4) + (-6) = -11$.\n- $\\mathbf{i}$ part: $1 + 2 + 4 + (-6) = 1$.\n- $\\mathbf{j}$ part: $2 + (-4) + 2 + 3 = 3$.\n- $\\mathbf{k}$ part: $2 + 4 + (-2) + 3 = 7$.\n\nThus,\n$$\ns \\coloneqq q\\,r = -11 + 1\\,\\mathbf{i} + 3\\,\\mathbf{j} + 7\\,\\mathbf{k}.\n$$\n\nCompute its squared norm:\n$$\nN(s) = (-11)^2 + 1^2 + 3^2 + 7^2 = 121 + 1 + 9 + 49 = 180.\n$$\n\nNow compute $N(q)$ and $N(r)$ separately:\n- $N(q) = 1^2 + 2^2 + 2^2 + 3^2 = 1 + 4 + 4 + 9 = 18$.\n- $N(r) = 1^2 + 1^2 + 2^2 + 2^2 = 1 + 1 + 4 + 4 = 10$.\n\nTheir product is\n$$\nN(q)\\,N(r) = 18 \\cdot 10 = 180.\n$$\n\nWe have verified numerically, by direct computation from the definitions, that $N(s)$ equals $N(q)\\,N(r)$ for these specific tuples, and the common value is $180$. Hence the requested value is $180$.", "answer": "$$\\boxed{180}$$", "id": "3089687"}]}