{"hands_on_practices": [{"introduction": "True understanding in mathematics comes not from memorizing formulas, but from grasping their origins. This first practice guides you through the process of deriving Legendre's formula from first principles, using a clever counting argument. By applying your derived formula to compute $v_2(100!)$ and $v_5(100!)$, you will not only solidify your understanding but also engage with a classic number theory puzzle related to the trailing zeros of factorials [@problem_id:3086742].", "problem": "Let $p$ be a prime and let $v_{p}(n!)$ denote the exponent of $p$ in the prime factorization of $n!$, that is, the unique integer $e \\geq 0$ such that $p^{e}$ divides $n!$ and $p^{e+1}$ does not divide $n!$. Starting only from the Fundamental Theorem of Arithmetic (unique factorization of integers) and the definition of $v_{p}(n!)$ as $\\sum_{m=1}^{n} v_{p}(m)$, first derive an explicit expression for $v_{p}(n!)$ in terms of a finite sum involving the greatest-integer (floor) function $\\lfloor \\cdot \\rfloor$ by carefully counting how many factors of $p$ are contributed by the integers $1,2,\\dots,n$. Then use your derived expression to compute $v_{2}(100!)$ and $v_{5}(100!)$ explicitly.\n\nReport your final result as the row matrix $\\begin{pmatrix} v_{2}(100!)  v_{5}(100!) \\end{pmatrix}$. No rounding is required.", "solution": "The problem requires the derivation of an explicit formula for the $p$-adic valuation of $n!$, denoted $v_{p}(n!)$, and its subsequent application. The derivation must start from the Fundamental Theorem of Arithmetic and the definition of $v_{p}(n!)$ as the sum of the $p$-adic valuations of integers from $1$ to $n$.\n\nLet $p$ be a prime number and $n$ be a positive integer. The term $n!$ is the product of all positive integers up to $n$:\n$$n! = 1 \\cdot 2 \\cdot 3 \\cdots n = \\prod_{m=1}^{n} m$$\nThe Fundamental Theorem of Arithmetic states that any integer greater than $1$ can be uniquely represented as a product of prime numbers. The $p$-adic valuation of an integer $k$, denoted $v_{p}(k)$, is the exponent of the prime $p$ in the prime factorization of $k$. From the properties of exponents, the valuation of a product is the sum of the valuations of its factors. Therefore, the exponent of $p$ in the prime factorization of $n!$ is given by:\n$$v_{p}(n!) = v_{p}\\left(\\prod_{m=1}^{n} m\\right) = \\sum_{m=1}^{n} v_{p}(m)$$\nThis confirms the starting point provided in the problem statement. The term $v_{p}(m)$ is zero if $p$ does not divide $m$.\n\nTo find an explicit expression, we will recount this sum by considering which integers $m \\in \\{1, 2, \\dots, n\\}$ contribute factors of $p$.\nA factor of $p$ is contributed by each multiple of $p$ in the set $\\{1, 2, \\dots, n\\}$. The multiples of $p$ are $p, 2p, 3p, \\dots, kp$ such that $kp \\le n$. The number of such multiples is given by the largest integer $k$ satisfying $k \\le \\frac{n}{p}$, which is exactly $\\lfloor \\frac{n}{p} \\rfloor$. This accounts for at least one factor of $p$ for each of these numbers.\n\nHowever, some numbers contribute more than one factor of $p$. Specifically, multiples of $p^2$ contribute at least two factors of $p$. The multiples of $p^2$ in $\\{1, 2, \\dots, n\\}$ are $p^2, 2p^2, \\dots, lp^2$ such that $lp^2 \\le n$. The number of such multiples is $\\lfloor \\frac{n}{p^2} \\rfloor$. In the previous step, we already credited each of these numbers with one factor of $p$ (since every multiple of $p^2$ is also a multiple of $p$). Thus, we must count an additional factor of $p$ for each multiple of $p^2$.\n\nThis reasoning extends to higher powers of $p$. For any integer $k \\ge 1$, the multiples of $p^k$ in the set $\\{1, 2, \\dots, n\\}$ are of the form $j p^k \\le n$. The number of such multiples is $\\lfloor \\frac{n}{p^k} \\rfloor$. Each of these numbers contributes at least $k$ factors of $p$ to $n!$. Our counting method sums the number of factors at each level:\n- The count $\\lfloor \\frac{n}{p} \\rfloor$ includes every number divisible by $p$, $p^2$, $p^3$, etc., exactly once.\n- The count $\\lfloor \\frac{n}{p^2} \\rfloor$ includes every number divisible by $p^2$, $p^3$, etc., exactly once.\n- The count $\\lfloor \\frac{n}{p^k} \\rfloor$ includes every number divisible by $p^k$, $p^{k+1}$, etc., exactly once.\n\nAn integer $m$ for which $v_p(m) = E$ is divisible by $p, p^2, \\dots, p^E$ but not by $p^{E+1}$. Therefore, this integer $m$ is counted exactly once in each of the sums for $\\lfloor\\frac{n}{p}\\rfloor, \\lfloor\\frac{n}{p^2}\\rfloor, \\dots, \\lfloor\\frac{n}{p^E}\\rfloor$. The total number of times the integer $m$ is counted in our scheme is $E$, which is precisely its $p$-adic valuation, $v_p(m)$.\nSumming these contributions over all integers $m$ from $1$ to $n$ gives the total exponent $v_p(n!)$.\nThus, the total number of factors of $p$ in $n!$ is the sum of these counts for all powers of $p$:\n$$v_{p}(n!) = \\left\\lfloor \\frac{n}{p} \\right\\rfloor + \\left\\lfloor \\frac{n}{p^2} \\right\\rfloor + \\left\\lfloor \\frac{n}{p^3} \\right\\rfloor + \\dots = \\sum_{k=1}^{\\infty} \\left\\lfloor \\frac{n}{p^k} \\right\\rfloor$$\nThis is known as Legendre's formula. The sum is finite since for $p^k > n$, the term $\\lfloor \\frac{n}{p^k} \\rfloor$ becomes $0$.\n\nNow, we use this formula to compute the required values.\n\nFirst, we calculate $v_{2}(100!)$. Here, $p=2$ and $n=100$.\n$$v_{2}(100!) = \\sum_{k=1}^{\\infty} \\left\\lfloor \\frac{100}{2^k} \\right\\rfloor$$\nThe terms of the sum are:\nFor $k=1$: $\\lfloor \\frac{100}{2} \\rfloor = \\lfloor 50 \\rfloor = 50$\nFor $k=2$: $\\lfloor \\frac{100}{4} \\rfloor = \\lfloor 25 \\rfloor = 25$\nFor $k=3$: $\\lfloor \\frac{100}{8} \\rfloor = \\lfloor 12.5 \\rfloor = 12$\nFor $k=4$: $\\lfloor \\frac{100}{16} \\rfloor = \\lfloor 6.25 \\rfloor = 6$\nFor $k=5$: $\\lfloor \\frac{100}{32} \\rfloor = \\lfloor 3.125 \\rfloor = 3$\nFor $k=6$: $\\lfloor \\frac{100}{64} \\rfloor = \\lfloor 1.5625 \\rfloor = 1$\nFor $k=7$: $\\lfloor \\frac{100}{128} \\rfloor = \\lfloor 0.78125 \\rfloor = 0$. All subsequent terms are also $0$.\nSo, the sum is:\n$$v_{2}(100!) = 50 + 25 + 12 + 6 + 3 + 1 = 97$$\n\nSecond, we calculate $v_{5}(100!)$. Here, $p=5$ and $n=100$.\n$$v_{5}(100!) = \\sum_{k=1}^{\\infty} \\left\\lfloor \\frac{100}{5^k} \\right\\rfloor$$\nThe terms of the sum are:\nFor $k=1$: $\\lfloor \\frac{100}{5} \\rfloor = \\lfloor 20 \\rfloor = 20$\nFor $k=2$: $\\lfloor \\frac{100}{25} \\rfloor = \\lfloor 4 \\rfloor = 4$\nFor $k=3$: $\\lfloor \\frac{100}{125} \\rfloor = \\lfloor 0.8 \\rfloor = 0$. All subsequent terms are also $0$.\nSo, the sum is:\n$$v_{5}(100!) = 20 + 4 = 24$$\n\nThe computed values are $v_{2}(100!) = 97$ and $v_{5}(100!) = 24$. The problem requests the result as a row matrix.", "answer": "$$\n\\boxed{\\begin{pmatrix} 97  24 \\end{pmatrix}}\n$$", "id": "3086742"}, {"introduction": "A powerful mathematical tool often reveals surprising connections between different areas of study. This exercise demonstrates the utility of Legendre's formula beyond simple factorials by applying it to the divisibility of binomial coefficients, $\\binom{n}{k}$. You will discover the elegant relationship known as Kummer's Theorem, which links the $p$-adic valuation of $\\binom{n}{k}$ to the number of 'carries' when adding $k$ and $n-k$ in base $p$, providing a beautiful bridge between number theory and combinatorics [@problem_id:3086784].", "problem": "Let $p$ be a fixed prime. For a positive integer $m$, define the $p$-adic valuation $v_p(m)$ as the largest integer $e$ such that $p^{e}$ divides $m$, and let $s_p(m)$ denote the sum of the base-$p$ digits of $m$. Let $n$ be written in base $p$ as $n=\\sum_{i=0}^{t} n_i p^{i}$ with $n_t \\neq 0$ and each digit $n_i \\in \\{0,1,\\dots,p-1\\}$. Define\n$$N_p(n) \\text{ as the number of integers } k \\text{ with } 0 \\leq k \\leq n \\text{ and } p \\nmid \\binom{n}{k}.$$\nUsing only the definition of $v_p(\\cdot)$, the base-$p$ representation, and the well-tested fact known as Legendreâ€™s formula for factorial valuations, derive a necessary and sufficient condition on the base-$p$ digits of $k$ and $n$ for which $p \\nmid \\binom{n}{k}$, and then obtain a closed-form expression for $N_p(n)$ purely in terms of the base-$p$ digits $n_0,n_1,\\dots,n_t$. Your final answer must be a single analytic expression depending on $n_0,n_1,\\dots,n_t$ and $p$. No rounding is required.", "solution": "Let $p$ be a fixed prime number. For a positive integer $m$, the $p$-adic valuation $v_p(m)$ is the exponent of the highest power of $p$ that divides $m$. We are asked to find the number of integers $k$ such that $0 \\leq k \\leq n$ for which $p$ does not divide the binomial coefficient $\\binom{n}{k}$. This condition is equivalent to $v_p\\left(\\binom{n}{k}\\right) = 0$.\n\nThe binomial coefficient is defined as $\\binom{n}{k} = \\frac{n!}{k!(n-k)!}$ for $0 \\leq k \\leq n$. Using the fundamental property of $p$-adic valuations, $v_p(ab) = v_p(a) + v_p(b)$ and $v_p(a/b) = v_p(a) - v_p(b)$, we can write the valuation of the binomial coefficient as:\n$$v_p\\left(\\binom{n}{k}\\right) = v_p(n!) - v_p(k!) - v_p((n-k)!)$$\nThis holds for $0  k  n$. For $k=0$ or $k=n$, $\\binom{n}{k}=1$, so $v_p\\left(\\binom{n}{k}\\right) = 0$.\n\nThe problem states we must use Legendre's formula, which gives the $p$-adic valuation of a factorial $m!$ as:\n$$v_p(m!) = \\sum_{j=1}^{\\infty} \\left\\lfloor \\frac{m}{p^j} \\right\\rfloor$$\nLet the integer $m$ have the base-$p$ representation $m = \\sum_{i=0}^{t} m_i p^i$, where $m_i \\in \\{0, 1, \\dots, p-1\\}$. The sum of the digits is $s_p(m) = \\sum_{i=0}^{t} m_i$. We can express $v_p(m!)$ in terms of $m$ and $s_p(m)$.\nThe term $\\lfloor m/p^j \\rfloor$ can be written as:\n$$\\left\\lfloor \\frac{m}{p^j} \\right\\rfloor = \\left\\lfloor \\sum_{i=0}^{t} m_i p^{i-j} \\right\\rfloor = \\sum_{i=j}^{t} m_i p^{i-j}$$\nSubstituting this into Legendre's formula:\n$$v_p(m!) = \\sum_{j=1}^{\\infty} \\sum_{i=j}^{t} m_i p^{i-j}$$\nChanging the order of summation:\n$$v_p(m!) = \\sum_{i=1}^{t} \\sum_{j=1}^{i} m_i p^{i-j} = \\sum_{i=1}^{t} m_i \\sum_{j=1}^{i} p^{i-j}$$\nThe inner sum is a geometric series: $\\sum_{l=0}^{i-1} p^l = \\frac{p^i-1}{p-1}$.\n$$v_p(m!) = \\sum_{i=1}^{t} m_i \\left(\\frac{p^i-1}{p-1}\\right) = \\frac{1}{p-1} \\sum_{i=0}^{t} m_i (p^i-1)$$\nNote that we can include the $i=0$ term as $m_0(p^0-1)=0$.\n$$v_p(m!) = \\frac{1}{p-1} \\left( \\sum_{i=0}^{t} m_i p^i - \\sum_{i=0}^{t} m_i \\right) = \\frac{m - s_p(m)}{p-1}$$\nThis is a well-known identity, derived as requested from Legendre's formula.\n\nNow, we substitute this identity into the expression for $v_p\\left(\\binom{n}{k}\\right)$:\n$$v_p\\left(\\binom{n}{k}\\right) = \\frac{n-s_p(n)}{p-1} - \\frac{k-s_p(k)}{p-1} - \\frac{(n-k)-s_p(n-k)}{p-1}$$\n$$v_p\\left(\\binom{n}{k}\\right) = \\frac{(n-k-(n-k)) + s_p(k) + s_p(n-k) - s_p(n)}{p-1}$$\n$$v_p\\left(\\binom{n}{k}\\right) = \\frac{s_p(k) + s_p(n-k) - s_p(n)}{p-1}$$\nThis result is known as Kummer's Theorem. The condition $v_p\\left(\\binom{n}{k}\\right) = 0$ is equivalent to the numerator being zero, since $p-1 > 0$:\n$$s_p(k) + s_p(n-k) = s_p(n)$$\nTo understand what this condition implies for the digits, consider the addition of $k$ and $n-k$ in base $p$. Let $k = \\sum_{i=0}^{t} k_i p^i$ and $n-k = \\sum_{i=0}^{t} m_i p^i$. Their sum is $n = \\sum_{i=0}^{t} n_i p^i$. Let $c_i$ be the carry generated at position $i-1$ during base-$p$ addition, where $c_0 = 0$. The relationship between the digits is given by the standard addition algorithm:\n$$k_i + m_i + c_i = n_i + p c_{i+1}$$\nSumming over all $i \\ge 0$:\n$$\\sum_{i=0}^{t} k_i + \\sum_{i=0}^{t} m_i + \\sum_{i=0}^{t} c_i = \\sum_{i=0}^{t} n_i + p \\sum_{i=0}^{t} c_{i+1}$$\nRecognizing the sums of digits:\n$$s_p(k) + s_p(n-k) + \\sum_{i=1}^{t+1} c_i = s_p(n) + p \\sum_{i=1}^{t+1} c_i$$\nLet $C = \\sum_{i=1}^{t+1} c_i$ be the total number of carries. Then:\n$$s_p(k) + s_p(n-k) - s_p(n) = (p-1)C$$\nComparing this with our expression for $v_p\\left(\\binom{n}{k}\\right)$, we find:\n$$v_p\\left(\\binom{n}{k}\\right) = C$$\nThis means the $p$-adic valuation of $\\binom{n}{k}$ is precisely the number of carries when adding $k$ and $n-k$ in base $p$.\nThe condition $p \\nmid \\binom{n}{k}$, i.e., $v_p\\left(\\binom{n}{k}\\right)=0$, is therefore equivalent to $C=0$. Since carries $c_i$ are non-negative integers, $C=0$ if and only if all carries are zero, i.e., $c_i=0$ for all $i$.\n\nThe condition $c_i = 0$ for all $i$ simplifies the digit-wise addition to $k_i+m_i = n_i$. This corresponds to performing the subtraction $n-k$ without any \"borrows\". Since $m_i$ are the digits of $n-k$, they are non-negative, $m_i \\ge 0$. The relation $k_i+m_i = n_i$ thus implies $k_i \\le n_i$ for all $i$.\nConversely, if $k_i \\le n_i$ for all $i$, then we can compute $n-k = \\sum (n_i - k_i)p^i$. The digits of $n-k$ are $m_i=n_i-k_i$. In this case, $s_p(n-k) = \\sum(n_i-k_i) = s_p(n)-s_p(k)$, so $s_p(k)+s_p(n-k)=s_p(n)$, which implies $v_p\\left(\\binom{n}{k}\\right)=0$.\nThus, the necessary and sufficient condition for $p \\nmid \\binom{n}{k}$ is that for every $i$, the $i$-th base-$p$ digit of $k$, denoted $k_i$, must be less than or equal to the $i$-th base-$p$ digit of $n$, $n_i$.\n\nWe now need to find $N_p(n)$, the number of integers $k$ in the range $0 \\le k \\le n$ that satisfy this digit-wise condition. Let $n = \\sum_{i=0}^{t} n_i p^i$ with $n_t \\neq 0$. An integer $k$ is uniquely determined by its base-$p$ digits $k_i$. We are looking for the number of sequences of digits $(k_t, k_{t-1}, \\dots, k_0)$ such that $0 \\le k_i \\le n_i$ for each $i \\in \\{0, 1, \\dots, t\\}$.\nFor each digit position $i$, the number of possible choices for $k_i$ is $n_i - 0 + 1 = n_i+1$.\nThe choice of each digit $k_i$ is independent of the choices for the other digits. By the fundamental principle of counting (the rule of product), the total number of ways to choose the sequence of digits $(k_t, \\dots, k_0)$ is the product of the number of choices for each digit.\nAny integer $k$ formed this way, $k=\\sum_{i=0}^t k_i p^i$ with $0 \\le k_i \\le n_i$, will automatically satisfy $k \\le n$, since $n-k = \\sum_{i=0}^t (n_i-k_i)p^i \\ge 0$.\nTherefore, the total number of such integers $k$ is:\n$$N_p(n) = (n_0+1)(n_1+1)\\cdots(n_t+1) = \\prod_{i=0}^{t} (n_i+1)$$\nThis is the required closed-form expression for $N_p(n)$ in terms of the base-$p$ digits of $n$.", "answer": "$$\\boxed{\\prod_{i=0}^{t} (n_i+1)}$$", "id": "3086784"}, {"introduction": "In the digital age, a mathematical formula's true power is often realized through its efficient implementation in an algorithm. A naive calculation of $v_p(n!)$ by inspecting every integer up to $n$ would be far too slow for practical purposes. This practice challenges you to transform Legendre's formula into an elegant and highly efficient algorithm with a time complexity of $O(\\log_p n)$, bridging the gap between abstract theory and practical computation [@problem_id:3086732].", "problem": "You are given a prime $p$ and a nonnegative integer $n$. For an integer $m \\ge 1$, define the $p$-adic valuation $v_p(m)$ to be the largest exponent $e$ such that $p^e$ divides $m$. Let $n!$ denote the factorial of $n$. Your task is to design an algorithm that computes $v_p(n!)$ in time $O(\\log_p n)$ starting from first principles of prime factorization and divisibility. Specifically, you must proceed from the foundational facts that: (i) $v_p(mn) = v_p(m) + v_p(n)$ for all integers $m,n \\ge 1$, and (ii) the count of multiples of a fixed integer among $\\{1,2,\\dots,n\\}$ is given by a floor of a quotient. Based on these principles, derive a correct and efficient method that aggregates the contribution of powers of $p$ dividing the factors of $n!$ without iterating over all $n$ terms. Do not start from a pre-stated closed-form expression.\n\nAfter presenting the reasoning and the algorithm, implement it as a program that evaluates $v_p(n!)$ for the following test suite of input pairs $(n,p)$:\n- $(\\,0,\\,2\\,)$,\n- $(\\,1,\\,2\\,)$,\n- $(\\,5,\\,2\\,)$,\n- $(\\,10,\\,3\\,)$,\n- $(\\,25,\\,5\\,)$,\n- $(\\,5,\\,7\\,)$,\n- $(\\,27,\\,3\\,)$,\n- $(\\,100,\\,2\\,)$,\n- $(\\,1000,\\,2\\,)$,\n- $(\\,100,\\,5\\,)$.\n\nYour program must compute the integer $v_p(n!)$ for each pair in the order listed above and aggregate the results into a single line of output containing the results as a comma-separated list enclosed in square brackets. For example, the output format should be a single line in the form of a Python list literal with decimal integers and no spaces, such as $[\\dots]$.\n\nConstraints and requirements:\n- Inputs satisfy $n \\in \\mathbb{Z}_{\\ge 0}$ and $p$ is prime.\n- Design the algorithm with time complexity $O(\\log_p n)$ and argue why this bound holds from your construction.\n- The outputs are integers.\n\nYour deliverables are:\n- A derivation that justifies the algorithm from the base principles stated above and explains why it is correct.\n- An analysis of the time complexity to justify the bound $O(\\log_p n)$.\n- A complete program that computes the outputs for the given test suite and prints them exactly as specified in a single line.", "solution": "The problem is to devise an efficient algorithm for computing the $p$-adic valuation of $n!$, denoted as $v_p(n!)$, for a given prime $p$ and a non-negative integer $n$. The valuation $v_p(m)$ is defined as the exponent of the highest power of $p$ that divides an integer $m$. The derivation must be based on first principles, namely the additive property of the valuation function and a basic counting principle for multiples.\n\nThe factorial of $n$, $n!$, is the product of the first $n$ positive integers:\n$$n! = \\prod_{k=1}^{n} k$$\nFor $n=0$, we have the definition $0! = 1$. The valuation $v_p(1)$ is $0$ for any prime $p$, since $p^0=1$ is the highest power of $p$ dividing $1$. Thus, $v_p(0!) = 0$.\n\nFor $n \\ge 1$, we are given the fundamental property of $p$-adic valuations: $v_p(ab) = v_p(a) + v_p(b)$. By induction, this property extends to a product of multiple integers:\n$$v_p\\left(\\prod_{i=1}^{m} k_i\\right) = \\sum_{i=1}^{m} v_p(k_i)$$\nApplying this to the definition of $n!$, we can express $v_p(n!)$ as a sum:\n$$v_p(n!) = v_p\\left(\\prod_{k=1}^{n} k\\right) = \\sum_{k=1}^{n} v_p(k)$$\nA direct computation of this sum would require iterating through each integer $k$ from $1$ to $n$ and finding its $p$-adic valuation, leading to an algorithm with a time complexity of at least $O(n)$, which is inefficient for large $n$. The task requires a more efficient algorithm, specifically one with complexity $O(\\log_p n)$.\n\nTo achieve this, we must restructure the summation. Instead of summing the valuations $v_p(k)$ for each $k$, we can count the total number of factors of $p$. An integer $k$ contributes to the sum if and only if it is a multiple of $p$. A multiple of $p^j$ contributes at least $j$ to the sum of valuations. This suggests we can group terms by powers of $p$.\n\nLet's formalize this by expressing $v_p(k)$ differently. The valuation $v_p(k)$ is the integer $e$ such that $p^e | k$ and $p^{e+1} \\nmid k$. This is equivalent to saying that $k$ is divisible by $p^1, p^2, \\dots, p^e$, but not by higher powers of $p$. We can write $v_p(k)$ as a sum using the Iverson bracket notation, where $[P]$ is $1$ if the proposition $P$ is true, and $0$ otherwise:\n$$v_p(k) = \\sum_{j=1}^{\\infty} [p^j \\text{ divides } k]$$\nThe sum is finite since for $p^j > k$, the term $[p^j \\text{ divides } k]$ is always $0$.\n\nSubstituting this expression back into our formula for $v_p(n!)$:\n$$v_p(n!) = \\sum_{k=1}^{n} \\left( \\sum_{j=1}^{\\infty} [p^j \\text{ divides } k] \\right)$$\nSince all sums are finite, we can interchange the order of summation:\n$$v_p(n!) = \\sum_{j=1}^{\\infty} \\left( \\sum_{k=1}^{n} [p^j \\text{ divides } k] \\right)$$\nThe inner sum, $\\sum_{k=1}^{n} [p^j \\text{ divides } k]$, represents the number of integers $k$ in the set $\\{1, 2, \\dots, n\\}$ that are divisible by $p^j$. These are the multiples of $p^j$.\nBased on the second given principle, the count of multiples of a fixed integer $m$ in the set $\\{1, 2, \\dots, n\\}$ is given by $\\lfloor n/m \\rfloor$. Setting $m=p^j$, we have:\n$$\\sum_{k=1}^{n} [p^j \\text{ divides } k] = \\left\\lfloor \\frac{n}{p^j} \\right\\rfloor$$\nSubstituting this result back into the main equation gives the final formula:\n$$v_p(n!) = \\sum_{j=1}^{\\infty} \\left\\lfloor \\frac{n}{p^j} \\right\\rfloor$$\nThis is the well-known Legendre's formula. The summation is finite because for any $j$ such that $p^j > n$, the term $\\lfloor n/p^j \\rfloor$ becomes $0$.\n\nThis formula provides a basis for an efficient algorithm. We can compute the sum iteratively. A direct implementation would be:\n$S = 0$\nFor $j=1, 2, 3, \\dots$:\n  $term = \\lfloor n/p^j \\rfloor$\n  If $term = 0$, break.\n  $S = S + term$.\nThis approach requires computing $p^j$ at each step, which can lead to large numbers. A more elegant and efficient computational scheme can be derived from the formula.\nNotice that $\\lfloor \\lfloor x \\rfloor / y \\rfloor = \\lfloor x / y \\rfloor$ for any real $x$ and integer $y \\ge 1$. Let $n_0 = n$. Define a sequence $n_{j+1} = \\lfloor n_j/p \\rfloor$.\nThen $n_1 = \\lfloor n/p \\rfloor$.\n$n_2 = \\lfloor n_1/p \\rfloor = \\lfloor \\lfloor n/p \\rfloor / p \\rfloor = \\lfloor n/p^2 \\rfloor$.\nBy induction, $n_j = \\lfloor n/p^j \\rfloor$.\nThus, the sum becomes:\n$$v_p(n!) = \\sum_{j=1}^{\\infty} n_j = n_1 + n_2 + n_3 + \\dots$$\nThis leads to the following algorithm:\n1. Initialize a variable `total_valuation` to $0$.\n2. Initialize a variable `current_n` with the input value $n$.\n3. Enter a loop that continues as long as `current_n` is greater than $0$.\n4. Inside the loop, divide `current_n` by $p$ and take the floor: `current_n = floor(current_n / p)`.\n5. Add this new value of `current_n` to `total_valuation`.\n6. Once the loop terminates (when `current_n` becomes $0$), `total_valuation` will hold the result $v_p(n!)$.\n\nLet's analyze the time complexity of this algorithm. The loop iterates as long as `current_n > 0`. In each iteration, `current_n` is divided by $p$. The number of times we can divide $n$ by $p$ before it becomes less than $1$ (and thus its floor becomes $0$) is approximately $\\log_p n$. More precisely, the number of iterations is $\\lfloor \\log_p n \\rfloor + 1$. Each iteration involves a division and an addition, which are considered constant-time operations for typical integer sizes. Therefore, the time complexity of the algorithm is $O(\\log_p n)$, which satisfies the problem's requirement.", "answer": "```python\ndef solve():\n    \"\"\"\n    Computes the p-adic valuation of n! for a list of (n, p) pairs\n    and prints the results in the specified format.\n    \"\"\"\n\n    def calculate_vp_factorial(n, p):\n        \"\"\"\n        Calculates the p-adic valuation of n! using Legendre's formula\n        in O(log_p n) time.\n        \n        Args:\n            n: A non-negative integer.\n            p: A prime number.\n\n        Returns:\n            The integer value of v_p(n!).\n        \"\"\"\n        # For n = 0, 0! = 1, so v_p(1) = 0.\n        if n == 0:\n            return 0\n        \n        total_valuation = 0\n        current_n = n\n        \n        # This loop implements the summation from Legendre's formula:\n        # Sum_{k=1 to infinity} floor(n / p^k)\n        # by iteratively calculating floor(n/p), floor(n/p^2), etc.\n        # Let n_k = floor(n / p^k). Then n_{k+1} = floor(n_{k} / p).\n        # We sum up all n_k for k = 1.\n        while current_n > 0:\n            current_n //= p\n            total_valuation += current_n\n            \n        return total_valuation\n\n    # The test suite of input pairs (n, p) as specified in the problem statement.\n    test_cases = [\n        (0, 2),\n        (1, 2),\n        (5, 2),\n        (10, 3),\n        (25, 5),\n        (5, 7),\n        (27, 3),\n        (100, 2),\n        (1000, 2),\n        (100, 5),\n    ]\n\n    results = []\n    for n, p in test_cases:\n        result = calculate_vp_factorial(n, p)\n        results.append(result)\n\n    # The final print statement must produce a single line with the exact format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3086732"}]}