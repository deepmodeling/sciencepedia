{"hands_on_practices": [{"introduction": "The first step in mastering density functional theory is learning how to apply an exchange-correlation (XC) functional to a given electron density. This foundational exercise provides direct practice by having you compute the total exchange-correlation energy within the Local Density Approximation (LDA) for a hypothetical, but analytically solvable, atomic system [@problem_id:2998104]. By working through this calculation, you will build concrete intuition for how the local density at each point in space contributes to the overall energy.", "problem": "Consider a spin-unpolarized spherical atom described within Kohn-Sham Density Functional Theory (DFT). Let the electron density be spherically symmetric and given by the radial form $n(r) = n_{0} \\exp(-\\alpha r)$ for $r \\geq 0$, where $\\alpha  0$ and $n_{0}  0$ are constants. The total electron number is $N$, and the density must be normalized so that $\\int n(\\mathbf{r}) \\, d^{3}r = N$. Work in atomic units, taking the Bohr radius to be unity and expressing energy in Hartree.\n\nUsing the Local Density Approximation (LDA) for exchange and correlation, adopt the following foundational inputs:\n- The exchange contribution is obtained from the three-dimensional uniform electron gas at zero temperature.\n- The correlation energy per particle is taken from the high-density limit of the Perdew–Zunger parameterization, written as $\\varepsilon_{c}(n) = A \\ln r_{s}(n) + B$, where $A$ and $B$ are constants, and $r_{s}(n) = \\left( \\frac{3}{4\\pi n} \\right)^{1/3}$ is the Wigner–Seitz radius.\n\nDerive, from first principles consistent with Kohn-Sham DFT and the above inputs, a closed-form analytic expression for the total exchange-correlation energy $E_{xc}^{\\mathrm{LDA}}[n]$ of this atom in terms of $A$, $B$, $N$, and $\\alpha$, eliminating $n_{0}$ using the normalization constraint. Express the final energy in Hartree. No numerical evaluation or rounding is required; provide a single closed-form expression as your final answer.", "solution": "The problem asks for the total exchange-correlation energy $E_{xc}^{\\mathrm{LDA}}[n]$ for a model spherical atom with a given electron density $n(r)$, using the Local Density Approximation (LDA). The total energy is the sum of the exchange and correlation contributions, $E_{xc}^{\\mathrm{LDA}}[n] = E_{x}^{\\mathrm{LDA}}[n] + E_{c}^{\\mathrm{LDA}}[n]$. The derivation proceeds in four steps: first, we normalize the electron density to find the constant $n_{0}$; second, we calculate the exchange energy $E_{x}^{\\mathrm{LDA}}[n]$; third, we calculate the correlation energy $E_{c}^{\\mathrm{LDA}}[n]$; and finally, we sum these two contributions.\n\n**Step 1: Normalization of the Electron Density**\nThe electron density is given as $n(r) = n_{0} \\exp(-\\alpha r)$ and must be normalized to the total number of electrons, $N$. As the density is spherically symmetric, we integrate in spherical coordinates.\n$$\nN = \\int n(\\mathbf{r}) \\, d^{3}r = \\int_{0}^{2\\pi} d\\phi \\int_{0}^{\\pi} \\sin\\theta \\, d\\theta \\int_{0}^{\\infty} n(r) r^{2} \\, dr\n$$\nThe angular integrals yield $4\\pi$.\n$$\nN = 4\\pi \\int_{0}^{\\infty} n_{0} \\exp(-\\alpha r) r^{2} \\, dr = 4\\pi n_{0} \\int_{0}^{\\infty} r^{2} \\exp(-\\alpha r) \\, dr\n$$\nThe integral is a standard form related to the Gamma function: $\\int_{0}^{\\infty} x^{k} \\exp(-ax) \\, dx = \\frac{k!}{a^{k+1}}$. For our case, $k=2$ and $a=\\alpha$.\n$$\n\\int_{0}^{\\infty} r^{2} \\exp(-\\alpha r) \\, dr = \\frac{2!}{\\alpha^{2+1}} = \\frac{2}{\\alpha^{3}}\n$$\nSubstituting this result back into the normalization equation gives:\n$$\nN = 4\\pi n_{0} \\left( \\frac{2}{\\alpha^{3}} \\right) = \\frac{8\\pi n_{0}}{\\alpha^{3}}\n$$\nWe solve for the constant $n_{0}$ to express it in terms of the given parameters $N$ and $\\alpha$.\n$$\nn_{0} = \\frac{N \\alpha^{3}}{8\\pi}\n$$\nThis expression will be used to eliminate $n_{0}$ from the final result.\n\n**Step 2: Calculation of the Exchange Energy $E_{x}^{\\mathrm{LDA}}$**\nThe exchange energy in the LDA is given by the integral of the exchange energy density, which is modeled on the uniform electron gas (UEG). For a spin-unpolarized system, the exchange energy per particle is $\\varepsilon_{x}(n) = -C_{x} n^{1/3}$, where the constant $C_{x} = \\frac{3}{4} \\left(\\frac{3}{\\pi}\\right)^{1/3}$ in atomic units. The total exchange energy functional is:\n$$\nE_{x}^{\\mathrm{LDA}}[n] = \\int n(\\mathbf{r}) \\varepsilon_{x}(n(\\mathbf{r})) \\, d^{3}r = -C_{x} \\int [n(\\mathbf{r})]^{4/3} \\, d^{3}r\n$$\nAgain, we use spherical coordinates for the integration.\n$$\nE_{x}^{\\mathrm{LDA}}[n] = -C_{x} \\int_{0}^{\\infty} [n(r)]^{4/3} 4\\pi r^{2} \\, dr\n$$\nSubstitute $n(r) = n_{0} \\exp(-\\alpha r)$:\n$$\nE_{x}^{\\mathrm{LDA}}[n] = -4\\pi C_{x} \\int_{0}^{\\infty} [n_{0} \\exp(-\\alpha r)]^{4/3} r^{2} \\, dr = -4\\pi C_{x} n_{0}^{4/3} \\int_{0}^{\\infty} r^{2} \\exp\\left(-\\frac{4\\alpha r}{3}\\right) \\, dr\n$$\nThe integral is of the same form as before, with $k=2$ and $a = \\frac{4\\alpha}{3}$.\n$$\n\\int_{0}^{\\infty} r^{2} \\exp\\left(-\\frac{4\\alpha r}{3}\\right) \\, dr = \\frac{2!}{\\left(\\frac{4\\alpha}{3}\\right)^{3}} = \\frac{2}{\\frac{64\\alpha^{3}}{27}} = \\frac{54}{64\\alpha^{3}} = \\frac{27}{32\\alpha^{3}}\n$$\nThus, the exchange energy is:\n$$\nE_{x}^{\\mathrm{LDA}}[n] = -4\\pi C_{x} n_{0}^{4/3} \\left(\\frac{27}{32\\alpha^{3}}\\right) = -C_{x} \\frac{108\\pi}{32\\alpha^{3}} n_{0}^{4/3} = -C_{x} \\frac{27\\pi}{8\\alpha^{3}} n_{0}^{4/3}\n$$\nNow, we substitute $n_{0} = \\frac{N \\alpha^{3}}{8\\pi}$:\n$$\nn_{0}^{4/3} = \\left(\\frac{N \\alpha^{3}}{8\\pi}\\right)^{4/3} = \\frac{N^{4/3} (\\alpha^{3})^{4/3}}{(8\\pi)^{4/3}} = \\frac{N^{4/3} \\alpha^{4}}{((2)^{3})^{4/3} \\pi^{4/3}} = \\frac{N^{4/3} \\alpha^{4}}{16\\pi^{4/3}}\n$$\nSubstituting this into the expression for $E_{x}^{\\mathrm{LDA}}[n]$:\n$$\nE_{x}^{\\mathrm{LDA}}[n] = -C_{x} \\frac{27\\pi}{8\\alpha^{3}} \\left(\\frac{N^{4/3} \\alpha^{4}}{16\\pi^{4/3}}\\right) = -C_{x} \\frac{27 N^{4/3} \\alpha}{128 \\pi^{1/3}}\n$$\nFinally, we substitute the expression for $C_{x}$:\n$$\nE_{x}^{\\mathrm{LDA}}[n] = -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3} \\frac{27 N^{4/3} \\alpha}{128 \\pi^{1/3}} = -\\frac{3 \\cdot 27 \\cdot 3^{1/3}}{4 \\cdot 128 \\cdot \\pi^{1/3} \\cdot \\pi^{1/3}} N^{4/3} \\alpha = -\\frac{81 \\cdot 3^{1/3}}{512 \\pi^{2/3}} N^{4/3} \\alpha\n$$\n\n**Step 3: Calculation of the Correlation Energy $E_{c}^{\\mathrm{LDA}}$**\nThe problem provides the correlation energy per particle as $\\varepsilon_{c}(n) = A \\ln r_{s}(n) + B$. The total correlation energy is:\n$$\nE_{c}^{\\mathrm{LDA}}[n] = \\int n(\\mathbf{r}) \\varepsilon_{c}(n(\\mathbf{r})) \\, d^{3}r = \\int n(\\mathbf{r}) \\left[ A \\ln r_{s}(n(\\mathbf{r})) + B \\right] \\, d^{3}r\n$$\nThis separates into two terms:\n$$\nE_{c}^{\\mathrm{LDA}}[n] = A \\int n(\\mathbf{r}) \\ln r_{s}(n(\\mathbf{r})) \\, d^{3}r + B \\int n(\\mathbf{r}) \\, d^{3}r = A \\int n(\\mathbf{r}) \\ln r_{s}(n(\\mathbf{r})) \\, d^{3}r + BN\n$$\nWe must evaluate the integral term. First, express $\\ln r_s(n)$ in terms of $n$:\n$$\nr_{s}(n) = \\left( \\frac{3}{4\\pi n} \\right)^{1/3} \\implies \\ln r_{s}(n) = \\frac{1}{3} \\ln\\left(\\frac{3}{4\\pi n}\\right) = \\frac{1}{3} \\left( \\ln\\left(\\frac{3}{4\\pi}\\right) - \\ln(n) \\right)\n$$\nThe integral becomes:\n$$\n\\int n(\\mathbf{r}) \\ln r_{s}(n(\\mathbf{r})) \\, d^{3}r = \\frac{1}{3} \\int n(\\mathbf{r}) \\left( \\ln\\left(\\frac{3}{4\\pi}\\right) - \\ln(n(\\mathbf{r})) \\right) \\, d^{3}r\n$$\n$$\n= \\frac{1}{3} \\ln\\left(\\frac{3}{4\\pi}\\right) \\int n(\\mathbf{r}) \\, d^{3}r - \\frac{1}{3} \\int n(\\mathbf{r}) \\ln(n(\\mathbf{r})) \\, d^{3}r = \\frac{N}{3} \\ln\\left(\\frac{3}{4\\pi}\\right) - \\frac{1}{3} \\int n(\\mathbf{r}) \\ln(n(\\mathbf{r})) \\, d^{3}r\n$$\nLet's compute the remaining integral, $\\int n \\ln n \\, d^3r$:\n$$\n\\int n(r) \\ln(n(r)) 4\\pi r^{2} \\, dr = \\int_{0}^{\\infty} (n_{0} \\exp(-\\alpha r)) \\ln(n_{0} \\exp(-\\alpha r)) 4\\pi r^{2} \\, dr\n$$\nUsing $\\ln(n_{0} \\exp(-\\alpha r)) = \\ln(n_{0}) - \\alpha r$:\n$$\n= 4\\pi \\int_{0}^{\\infty} n_{0} \\exp(-\\alpha r) (\\ln(n_{0}) - \\alpha r) r^{2} \\, dr\n$$\n$$\n= 4\\pi n_{0} \\ln(n_{0}) \\int_{0}^{\\infty} r^{2} \\exp(-\\alpha r) \\, dr - 4\\pi n_{0} \\alpha \\int_{0}^{\\infty} r^{3} \\exp(-\\alpha r) \\, dr\n$$\nWe already know the first integral is $2/\\alpha^{3}$. The second integral is $\\int r^{3} \\exp(-\\alpha r) \\, dr = \\frac{3!}{\\alpha^4} = \\frac{6}{\\alpha^4}$.\n$$\n\\int n \\ln n \\, d^3r = 4\\pi n_{0} \\ln(n_{0}) \\left(\\frac{2}{\\alpha^{3}}\\right) - 4\\pi n_{0} \\alpha \\left(\\frac{6}{\\alpha^{4}}\\right) = \\frac{8\\pi n_{0}}{\\alpha^{3}} \\ln(n_{0}) - \\frac{24\\pi n_{0}}{\\alpha^{3}}\n$$\nUsing the normalization relation $N = \\frac{8\\pi n_{0}}{\\alpha^{3}}$, this simplifies to:\n$$\n\\int n \\ln n \\, d^3r = N \\ln(n_{0}) - 3N\n$$\nNow substitute $n_{0} = \\frac{N \\alpha^{3}}{8\\pi}$:\n$$\n\\int n \\ln n \\, d^3r = N \\ln\\left(\\frac{N \\alpha^{3}}{8\\pi}\\right) - 3N\n$$\nSubstituting this back into the expression for $\\int n \\ln r_{s} \\, d^3r$:\n$$\n\\int n \\ln r_{s} \\, d^3r = \\frac{N}{3} \\ln\\left(\\frac{3}{4\\pi}\\right) - \\frac{1}{3} \\left[ N \\ln\\left(\\frac{N \\alpha^{3}}{8\\pi}\\right) - 3N \\right]\n$$\n$$\n= \\frac{N}{3} \\left[ \\ln\\left(\\frac{3}{4\\pi}\\right) - \\ln\\left(\\frac{N \\alpha^{3}}{8\\pi}\\right) + 3 \\right] = \\frac{N}{3} \\left[ \\ln\\left( \\frac{3}{4\\pi} \\cdot \\frac{8\\pi}{N \\alpha^{3}} \\right) + 3 \\right] = \\frac{N}{3} \\left[ \\ln\\left(\\frac{6}{N\\alpha^{3}}\\right) + 3 \\right]\n$$\nFinally, we assemble the total correlation energy $E_{c}^{\\mathrm{LDA}}$:\n$$\nE_{c}^{\\mathrm{LDA}}[n] = A \\left( \\frac{N}{3} \\left[ \\ln\\left(\\frac{6}{N\\alpha^{3}}\\right) + 3 \\right] \\right) + BN = \\frac{AN}{3} \\ln\\left(\\frac{6}{N\\alpha^{3}}\\right) + AN + BN\n$$\n$$\nE_{c}^{\\mathrm{LDA}}[n] = \\frac{AN}{3} \\ln\\left(\\frac{6}{N\\alpha^{3}}\\right) + (A+B)N\n$$\n\n**Step 4: Total Exchange-Correlation Energy**\nThe total exchange-correlation energy is the sum of the exchange and correlation parts: $E_{xc}^{\\mathrm{LDA}}[n] = E_{x}^{\\mathrm{LDA}}[n] + E_{c}^{\\mathrm{LDA}}[n]$.\n$$\nE_{xc}^{\\mathrm{LDA}}[n] = -\\frac{81 \\cdot 3^{1/3}}{512 \\pi^{2/3}} N^{4/3} \\alpha + \\frac{AN}{3} \\ln\\left(\\frac{6}{N\\alpha^{3}}\\right) + (A+B)N\n$$\nThis is the final closed-form analytic expression for the total exchange-correlation energy in terms of the specified constants.", "answer": "$$\n\\boxed{-\\frac{81 \\cdot 3^{1/3}}{512 \\pi^{2/3}} N^{4/3} \\alpha + \\frac{AN}{3} \\ln\\left(\\frac{6}{N\\alpha^{3}}\\right) + (A+B)N}\n$$", "id": "2998104"}, {"introduction": "After learning to apply an approximate functional, it is crucial to understand its inherent limitations. This practice demonstrates the famous self-interaction error, a key deficiency in many common XC functionals, using the simple one-electron hydrogenic system where the exact behavior is known [@problem_id:2998129]. By explicitly calculating the spurious residual energy that should be zero, you will gain a tangible understanding of this fundamental challenge in DFT.", "problem": "Consider a one-electron hydrogenic Kohn-Sham system with nuclear charge $Z$ and normalized $1s$ orbital density\n\n$$\nn_{Z}(\\mathbf{r}) \\equiv \\frac{Z^{3}}{\\pi a_{0}^{3}} \\exp\\!\\left(-\\frac{2 Z r}{a_{0}}\\right),\n$$\n\nwhere $r = |\\mathbf{r}|$ and $a_{0}$ is the Bohr radius. Work in Hartree atomic units, so that $a_{0}=1$ and energies are in Hartree. In exact Kohn-Sham density functional theory (DFT), the exchange-correlation energy for a one-electron density cancels the classical electrostatic (Hartree) self-interaction and the exact correlation is zero. In contrast, the Local Density Approximation (LDA) and common Generalized Gradient Approximations (GGAs) do not achieve this exact cancellation.\n\nStarting only from foundational definitions and standard DFT building blocks listed below, do the following:\n- Derive the Hartree energy $E_{\\mathrm{H}}[n_{Z}]$ analytically.\n- Using the Local Density Approximation exchange functional for a spin-unpolarized density,\n  \n$$\n  E_{x}^{\\mathrm{LDA}}[n] = - C_{x} \\int d^{3}r\\, n(\\mathbf{r})^{4/3}, \\quad C_{x} \\equiv \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3},\n  $$\n\n  and neglecting correlation (set $E_{c}^{\\mathrm{approx}} \\equiv 0$ consistently with the exact one-electron limit), compute $E_{x}^{\\mathrm{LDA}}[n_{Z}]$.\n- Using the second-order Gradient Expansion Approximation (the small-gradient limit common to many generalized gradient approximations), model the exchange energy density via the enhancement factor\n  \n$$\n  F_{x}(s) = 1 + \\mu s^{2} + \\mathcal{O}(s^{4}),\n  $$\n\n  where $s(\\mathbf{r}) \\equiv \\dfrac{|\\nabla n(\\mathbf{r})|}{2 k_{F}(\\mathbf{r})\\,n(\\mathbf{r})}$ is the reduced density gradient and $k_{F}(\\mathbf{r}) \\equiv \\big(3\\pi^{2}n(\\mathbf{r})\\big)^{1/3}$. Hence,\n  \n$$\n  E_{x}^{\\mathrm{GEA2}}[n] = - C_{x} \\int d^{3}r\\, n(\\mathbf{r})^{4/3}\\Big(1 + \\mu s(\\mathbf{r})^{2}\\Big),\n  $$\n\n  with $\\mu$ a positive constant (left symbolic). Compute $E_{x}^{\\mathrm{GEA2}}[n_{Z}]$ in closed form.\n- For each approximation $\\mathrm{approx} \\in \\{\\mathrm{LDA}, \\mathrm{GEA2}\\}$, define and compute the residual self-interaction error\n  \n$$\n  \\Delta E^{(\\mathrm{approx})}(Z) \\equiv E_{\\mathrm{H}}[n_{Z}] + E_{xc}^{(\\mathrm{approx})}[n_{Z}],\n  $$\n\n  where $E_{xc}^{(\\mathrm{approx})} \\equiv E_{x}^{(\\mathrm{approx})}$ because you set $E_{c}^{\\mathrm{approx}} \\equiv 0$. Show explicitly that $\\Delta E^{(\\mathrm{approx})}(Z) \\neq 0$.\n- Express the final result as a single row matrix containing the two closed-form analytic expressions $\\big[\\Delta E^{(\\mathrm{LDA})}(Z),\\ \\Delta E^{(\\mathrm{GEA2})}(Z;\\mu)\\big]$. Express the result in Hartree units. Do not include any numerical approximation or units in your final boxed answer.", "solution": "The problem asks for the calculation of the residual self-interaction error for a one-electron hydrogenic system of nuclear charge $Z$ using two approximate exchange-correlation functionals: the Local Density Approximation (LDA) and the second-order Gradient Expansion Approximation (GEA2). The correlation energy is set to zero, so $E_{xc}^{\\mathrm{approx}} = E_{x}^{\\mathrm{approx}}$. The derivation proceeds in three main parts. First, we calculate the exact Hartree energy. Second, we calculate the approximate exchange energies for LDA and GEA2. Finally, we combine these to find the self-interaction errors. All calculations are performed in Hartree atomic units ($a_0=1$), so the density is $n_{Z}(r) = (Z^{3}/\\pi) \\exp(-2 Z r)$.\n\n**Part 1: Derivation of the Hartree Energy, $E_{\\mathrm{H}}[n_Z]$**\nThe Hartree energy is the classical electrostatic self-repulsion energy of the charge distribution $n_Z(\\mathbf{r})$.\n$$ E_{\\mathrm{H}}[n_Z] = \\frac{1}{2} \\iint d^3r d^3r' \\frac{n_Z(r) n_Z(r')}{|\\mathbf{r}-\\mathbf{r'}|} $$\nThis is a standard integral for the hydrogenic $1s$ orbital density, which evaluates to $\\frac{5}{16}Z$. For a one-electron system, the exact exchange energy is the negative of the Hartree energy, $E_x^{\\text{exact}}[n_Z] = -E_{\\mathrm{H}}[n_Z] = -\\frac{5}{16}Z$. We will use $E_{\\mathrm{H}}[n_Z] = \\frac{5}{16}Z$ to calculate the error.\n\n**Part 2: Derivation of Approximate Exchange Energies**\n\n**LDA Exchange Energy, $E_{x}^{\\mathrm{LDA}}[n_Z]$**\nThe LDA exchange energy is given by $E_{x}^{\\mathrm{LDA}}[n] = -C_x \\int n(\\mathbf{r})^{4/3} d^3r$. We evaluate the integral for $n_Z(r)$.\n$$ n_Z(r)^{4/3} = \\left( \\frac{Z^3}{\\pi} \\exp(-2Zr) \\right)^{4/3} = \\frac{Z^4}{\\pi^{4/3}} \\exp\\left(-\\frac{8Zr}{3}\\right) $$\nThe integral is:\n$$ \\int n_Z(r)^{4/3} d^3r = \\int_0^\\infty 4\\pi r^2 \\left( \\frac{Z^4}{\\pi^{4/3}} \\exp\\left(-\\frac{8Zr}{3}\\right) \\right) dr = \\frac{4\\pi Z^4}{\\pi^{4/3}} \\int_0^\\infty r^2 \\exp\\left(-\\frac{8Zr}{3}\\right) dr $$\nUsing the standard integral $\\int_0^\\infty x^k \\exp(-ax) dx = k!/a^{k+1}$:\n$$ \\int n_Z(r)^{4/3} d^3r = \\frac{4\\pi Z^4}{\\pi^{4/3}} \\left( \\frac{2!}{(8Z/3)^3} \\right) = \\frac{4 Z^4}{\\pi^{1/3}} \\frac{2 \\cdot 27}{512Z^3} = \\frac{27Z}{64\\pi^{1/3}} $$\nNow, multiplying by the constant $-C_x = -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$:\n$$ E_{x}^{\\mathrm{LDA}}[n_Z] = -C_x \\left( \\frac{27Z}{64\\pi^{1/3}} \\right) = -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3} \\frac{27Z}{64\\pi^{1/3}} = -\\frac{3^{1+1/3+3} Z}{256\\pi^{1/3+1/3}} = -\\frac{3^{13/3}Z}{256\\pi^{2/3}} $$\n\n**GEA2 Exchange Energy, $E_{x}^{\\mathrm{GEA2}}[n_Z]$**\nThe GEA2 functional adds a correction to the LDA energy: $E_{x}^{\\mathrm{GEA2}}[n] = E_{x}^{\\mathrm{LDA}}[n] + \\Delta E_{x}^{\\mathrm{GEA2}}[n]$, where $\\Delta E_{x}^{\\mathrm{GEA2}}[n] = -C_x \\mu \\int n(\\mathbf{r})^{4/3} s(\\mathbf{r})^2 d^3r$.\nFirst, we find the reduced density gradient $s(r)$:\n$$ |\\nabla n_Z(r)| = \\left| \\frac{d}{dr} \\left( \\frac{Z^3}{\\pi} \\exp(-2Zr) \\right) \\right| = 2Z n_Z(r) $$\n$$ k_F(r) = (3\\pi^2 n_Z(r))^{1/3} $$\n$$ s(r) = \\frac{|\\nabla n_Z(r)|}{2 k_F(r) n_Z(r)} = \\frac{2Z n_Z(r)}{2 (3\\pi^2 n_Z(r))^{1/3} n_Z(r)} = \\frac{Z}{(3\\pi^2)^{1/3} n_Z(r)^{1/3}} $$\nThe squared reduced gradient is:\n$$ s(r)^2 = \\frac{Z^2}{(3\\pi^2)^{2/3} n_Z(r)^{2/3}} $$\nThe correction integral is:\n$$ \\int n_Z(r)^{4/3} s(r)^2 d^3r = \\int n_Z(r)^{4/3} \\frac{Z^2}{(3\\pi^2)^{2/3} n_Z(r)^{2/3}} d^3r = \\frac{Z^2}{(3\\pi^2)^{2/3}} \\int n_Z(r)^{2/3} d^3r $$\nWe need the integral of $n_Z(r)^{2/3}$:\n$$ \\int n_Z(r)^{2/3} d^3r = \\int_0^\\infty 4\\pi r^2 \\frac{Z^2}{\\pi^{2/3}} \\exp\\left(-\\frac{4Zr}{3}\\right) dr = \\frac{4\\pi Z^2}{\\pi^{2/3}} \\left(\\frac{2!}{(4Z/3)^3}\\right) = \\frac{27\\pi^{1/3}}{8Z} $$\nThe correction term becomes:\n$$ \\Delta E_{x}^{\\mathrm{GEA2}}[n_Z] = -C_x \\mu \\left( \\frac{Z^2}{(3\\pi^2)^{2/3}} \\right) \\left( \\frac{27\\pi^{1/3}}{8Z} \\right) = -C_x \\mu Z \\frac{27\\pi^{1/3}}{8 \\cdot 3^{2/3}\\pi^{4/3}} = -C_x \\mu Z \\frac{3^{7/3}}{8\\pi} $$\nSubstituting $C_x = \\frac{3^{4/3}}{4\\pi^{1/3}}$:\n$$ \\Delta E_{x}^{\\mathrm{GEA2}}[n_Z] = -\\left(\\frac{3^{4/3}}{4\\pi^{1/3}}\\right) \\mu Z \\frac{3^{7/3}}{8\\pi} = -\\frac{3^{4/3+7/3} \\mu Z}{32\\pi^{1/3+1}} = -\\frac{3^{11/3}\\mu Z}{32\\pi^{4/3}} $$\nSo, the full GEA2 exchange energy is:\n$$ E_{x}^{\\mathrm{GEA2}}[n_Z] = E_{x}^{\\mathrm{LDA}}[n_Z] + \\Delta E_{x}^{\\mathrm{GEA2}}[n_Z] = -\\frac{3^{13/3}Z}{256\\pi^{2/3}} - \\frac{3^{11/3}\\mu Z}{32\\pi^{4/3}} $$\n\n**Part 3: Calculation of Residual Self-Interaction Errors**\nThe residual self-interaction error is $\\Delta E^{(\\mathrm{approx})}(Z) = E_{\\mathrm{H}}[n_Z] + E_{x}^{(\\mathrm{approx})}[n_Z]$.\n\nFor LDA:\n$$ \\Delta E^{(\\mathrm{LDA})}(Z) = \\frac{5}{16}Z - \\frac{3^{13/3}Z}{256\\pi^{2/3}} = Z\\left(\\frac{5}{16} - \\frac{3^{13/3}}{256\\pi^{2/3}}\\right) $$\nThis expression is non-zero.\n\nFor GEA2:\n$$ \\Delta E^{(\\mathrm{GEA2})}(Z) = E_{\\mathrm{H}}[n_Z] + E_{x}^{\\mathrm{GEA2}}[n_Z] = \\frac{5}{16}Z - \\frac{3^{13/3}Z}{256\\pi^{2/3}} - \\frac{3^{11/3}\\mu Z}{32\\pi^{4/3}} $$\n$$ \\Delta E^{(\\mathrm{GEA2})}(Z) = Z\\left(\\frac{5}{16} - \\frac{3^{13/3}}{256\\pi^{2/3}} - \\frac{3^{11/3}\\mu}{32\\pi^{4/3}}\\right) $$\nSince $\\mu > 0$, this expression is also non-zero. The final result is the row matrix containing these two error terms.", "answer": "$$\n\\boxed{\\begin{pmatrix} Z\\left(\\frac{5}{16} - \\frac{3^{13/3}}{256\\pi^{2/3}}\\right)  Z\\left(\\frac{5}{16} - \\frac{3^{13/3}}{256\\pi^{2/3}} - \\frac{3^{11/3}\\mu}{32\\pi^{4/3}}\\right) \\end{pmatrix}}\n$$", "id": "2998129"}, {"introduction": "Bridging the gap between DFT theory and practical computation requires understanding the numerical methods used to achieve self-consistency. This exercise simulates the iterative self-consistent field (SCF) procedure using a simplified but powerful one-dimensional model [@problem_id:2998091]. You will investigate how instabilities like \"charge sloshing\" can derail convergence and how preconditioning techniques, inspired by those in real DFT codes, are essential for finding a stable solution.", "problem": "In Kohn-Sham density functional theory (KS-DFT), the self-consistent field (SCF) procedure seeks a fixed point of the density-mapping functional that relates an input density to the output density obtained by solving the Kohn-Sham equations. A basic abstraction for this procedure is a fixed-point iteration on a scalar order parameter that models a low-wavevector component of the electron density. Consider the following one-dimensional nonlinear map that approximates the Kohn-Sham density response near a fixed point:\n$$\nF(n) \\equiv n_\\star - g\\,(n - n_\\star) + c\\,(n - n_\\star)^3,\n$$\nwhere $n$ is the current iterate (a scalar), $n_\\star$ is the target fixed point, $g \\ge 0$ is an effective linear response gain that captures the enhancement of long-wavelength Hartree response (charge sloshing), and $c \\ge 0$ is a small cubic nonlinearity modeling weak anharmonicity of the free-energy landscape near $n_\\star$. The residual is\n$$\nr(n) \\equiv F(n) - n.\n$$\nA simple mixing update is then\n$$\nn^{(k+1)} = n^{(k)} + \\alpha\\,P\\,r\\!\\left(n^{(k)}\\right),\n$$\nwhere $\\alpha \\in (0,1]$ is a mixing parameter and $P$ is a scalar preconditioner that suppresses the long-wavelength component of the residual. Three preconditioning choices are to be explored:\n- No preconditioning: $P \\equiv 1$.\n- Constant preconditioning: $P \\equiv p_0$, where $p_0 \\in [0,1]$ is a fixed scalar.\n- Kerker-like preconditioning: $P(q) \\equiv \\dfrac{q^2}{q^2 + k_s^2}$, where $q \\ge 0$ is a representative wave number and $k_s  0$ is a screening parameter.\n\nStarting from the fundamental base of fixed-point iteration and linear response stability analysis, you are to:\n- Implement the map $F(n)$ and the SCF iteration defined above, including the three preconditioning choices, as a deterministic program.\n- Use double-precision arithmetic. Declare convergence when the absolute error satisfies $|n^{(k)} - n_\\star|  \\varepsilon$ with tolerance $\\varepsilon = 10^{-8}$, or declare failure if convergence has not occurred within $K_{\\max} = 500$ iterations. If at any point $|n^{(k)} - n_\\star|$ exceeds $10^{12}$ or a non-finite value is encountered, terminate and declare failure for that test case.\n- For each test case, report the number of iterations $k$ required to reach the convergence criterion; if failure occurs, report $-1$.\n\nThe test suite consists of the following seven cases (each case specifies $(n_0, n_\\star, g, c, \\alpha, \\text{preconditioner}, \\text{parameters})$):\n1. Strong charge sloshing without preconditioning (oscillatory divergence expected): $(n_0=\\;2.0,\\; n_\\star=\\;1.0,\\; g=\\;9.0,\\; c=\\;0.1,\\; \\alpha=\\;0.3,\\; P\\equiv 1,\\;\\text{no parameters})$.\n2. Same as case $1$, with constant preconditioning that stabilizes convergence: $(n_0=\\;2.0,\\; n_\\star=\\;1.0,\\; g=\\;9.0,\\; c=\\;0.1,\\; \\alpha=\\;0.3,\\; P\\equiv p_0,\\; p_0=\\;0.25)$.\n3. Same as case $1$, with Kerker-like preconditioning at a small wave number: $(n_0=\\;2.0,\\; n_\\star=\\;1.0,\\; g=\\;9.0,\\; c=\\;0.1,\\; \\alpha=\\;0.3,\\; P(q)=\\dfrac{q^2}{q^2 + k_s^2},\\; q=\\;0.2,\\; k_s=\\;1.0)$.\n4. Weak mixing without preconditioning (stable but slower): $(n_0=\\;2.0,\\; n_\\star=\\;1.0,\\; g=\\;9.0,\\; c=\\;0.1,\\; \\alpha=\\;0.05,\\; P\\equiv 1,\\;\\text{no parameters})$.\n5. Pathological constant preconditioner $p_0=\\;0$ (no updates; failure unless already converged): $(n_0=\\;1.5,\\; n_\\star=\\;1.0,\\; g=\\;9.0,\\; c=\\;0.1,\\; \\alpha=\\;0.3,\\; P\\equiv p_0,\\; p_0=\\;0.0)$.\n6. Extremely strong sloshing without preconditioning (divergence expected): $(n_0=\\;2.0,\\; n_\\star=\\;1.0,\\; g=\\;30.0,\\; c=\\;0.1,\\; \\alpha=\\;0.2,\\; P\\equiv 1,\\;\\text{no parameters})$.\n7. Case $6$ with Kerker-like preconditioning at a very small wave number: $(n_0=\\;2.0,\\; n_\\star=\\;1.0,\\; g=\\;30.0,\\; c=\\;0.1,\\; \\alpha=\\;0.2,\\; P(q)=\\dfrac{q^2}{q^2 + k_s^2},\\; q=\\;0.1,\\; k_s=\\;1.0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list of integers enclosed in square brackets (e.g., \"[12,-1,34]\"). The $i$-th integer in the list must be the number of iterations for the $i$-th test case, or $-1$ if that case fails to converge under the stated criteria. No other output is permitted. All quantities here are dimensionless; no physical units are required.", "solution": "The problem posits a simplified one-dimensional model for the self-consistent field (SCF) iteration central to Kohn-Sham density functional theory (KS-DFT). The objective is to implement a deterministic program to simulate this iterative process under various conditions and analyze its convergence behavior. The model captures essential physics, such as charge-sloshing instabilities and the stabilizing effect of preconditioning.\n\n**Mathematical Formulation of the Iteration**\n\nThe core of the problem is the fixed-point iteration defined by the update rule:\n$$\nn^{(k+1)} = n^{(k)} + \\alpha\\,P\\,r\\!\\left(n^{(k)}\\right)\n$$\nwhere $n^{(k)}$ is the value of the order parameter at iteration $k$, $\\alpha \\in (0,1]$ is a mixing parameter, $P$ is a preconditioner, and $r(n^{(k)})$ is the residual.\n\nThe residual $r(n)$ measures how far the current state $n$ is from being a fixed point of the map $F(n)$. It is defined as:\n$$\nr(n) \\equiv F(n) - n\n$$\n\nThe nonlinear map $F(n)$ models the response of the electron density. It is given as a cubic expansion around the true fixed point $n_\\star$:\n$$\nF(n) \\equiv n_\\star - g\\,(n - n_\\star) + c\\,(n - n_\\star)^3\n$$\nHere, $g \\ge 0$ represents the linear response gain, and $c \\ge 0$ is a nonlinear coefficient.\n\nSubstituting the definitions of $F(n)$ and $r(n)$ into the update rule, we can analyze the dynamics of the error, $\\delta_k \\equiv n^{(k)} - n_\\star$.\nThe residual can be expressed in terms of the error $\\delta_k$:\n$$\nr(n^{(k)}) = \\left( n_\\star - g\\,\\delta_k + c\\,\\delta_k^3 \\right) - (n_\\star + \\delta_k) = -(1+g)\\,\\delta_k + c\\,\\delta_k^3\n$$\nThe update rule for the error $\\delta_k$ is then:\n$$\n\\delta_{k+1} = n^{(k+1)} - n_\\star = \\left( n^{(k)} + \\alpha\\,P\\,r(n^{(k)}) \\right) - n_\\star = (n_\\star + \\delta_k) + \\alpha\\,P\\,r(n^{(k)}) - n_\\star\n$$\n$$\n\\delta_{k+1} = \\delta_k + \\alpha\\,P\\,\\left( -(1+g)\\,\\delta_k + c\\,\\delta_k^3 \\right) = \\delta_k \\left[ 1 - \\alpha\\,P\\,(1+g) \\right] + \\alpha\\,P\\,c\\,\\delta_k^3\n$$\n\n**Linear Stability Analysis**\n\nFor convergence, the error $\\delta_k$ must approach $0$ as $k \\to \\infty$. Near the fixed point, the error $\\delta_k$ is small, and the cubic term $\\alpha\\,P\\,c\\,\\delta_k^3$ can be neglected. The linearized update rule becomes:\n$$\n\\delta_{k+1} \\approx \\delta_k \\left[ 1 - \\alpha\\,P\\,(1+g) \\right]\n$$\nThis is a geometric progression. Convergence is guaranteed if and only if the absolute value of the multiplicative factor is less than $1$:\n$$\n\\left| 1 - \\alpha\\,P\\,(1+g) \\right|  1\n$$\nThis inequality is equivalent to $-1  1 - \\alpha\\,P\\,(1+g)  1$, which simplifies to:\n$$\n0  \\alpha\\,P\\,(1+g)  2\n$$\nSince $\\alpha  0$, $P \\ge 0$, and $g \\ge 0$, the left-hand inequality $0  \\alpha\\,P\\,(1+g)$ is satisfied as long as $P \\ne 0$. The critical condition for stability is therefore:\n$$\n\\alpha\\,P\\,(1+g)  2\n$$\nIf this condition is violated, specifically if $\\alpha\\,P\\,(1+g)  2$, the multiplier $1 - \\alpha\\,P\\,(1+g)$ will be less than $-1$, leading to oscillatory divergence, a behavior characteristic of charge-sloshing instabilities in real DFT calculations.\n\n**Preconditioning Strategies**\n\nThe role of the preconditioner $P$ is to modify the update step to ensure stability. The problem specifies three types:\n1.  **No Preconditioning ($P \\equiv 1$):** The update step is directly proportional to the raw residual. This is unstable if $\\alpha(1+g) \\ge 2$.\n2.  **Constant Preconditioning ($P \\equiv p_0$):** A constant damping factor $p_0 \\in [0,1]$ is applied. By choosing a sufficiently small $p_0$, the stability condition $\\alpha\\,p_0\\,(1+g)  2$ can be met even for large $g$. The pathological case $p_0=0$ freezes the iteration, as the update step is always zero.\n3.  **Kerker-like Preconditioning ($P(q) = \\frac{q^2}{q^2 + k_s^2}$):** This form is physically motivated. In real systems, the problematic instabilities (large $g$) occur at long wavelengths, corresponding to small wavevectors $q$. This preconditioner has the property that $P(q) \\to 0$ as $q \\to 0$, effectively suppressing the unstable modes. For the scalar model, $q$ is a given parameter representing the wavevector of the mode being modeled.\n\n**Algorithm Design and Implementation**\n\nThe solution requires implementing a program that simulates the SCF iteration for the $7$ distinct test cases provided. For each case, the program will:\n1.  Initialize the iteration counter $k=0$ and the order parameter $n^{(0)} = n_0$. All calculations use double-precision floating-point numbers.\n2.  Calculate the value of the preconditioner $P$ based on the specified type and parameters.\n3.  Loop for a maximum of $K_{\\max}=500$ iterations. In each iteration step (from $k=0$ onwards):\n    a. Check for convergence: If $|n^{(k)} - n_\\star|  \\varepsilon = 10^{-8}$, the process has succeeded. The number of iterations taken is $k$, and this value is reported.\n    b. Check for failure: If at any point $|n^{(k)} - n_\\star|$ exceeds $10^{12}$ or $n^{(k)}$ becomes non-finite (e.g., `NaN` or `infinity`), the iteration has failed. A value of $-1$ is reported.\n    c. If not converged and not failed, and the iteration limit is not reached (i.e., $k  K_{\\max}$), calculate the next value $n^{(k+1)}$ using the full nonlinear update rule.\n4.  If the loop completes without meeting the convergence criterion after checking the state $n^{(500)}$, the maximum number of iterations has been exceeded. This also constitutes a failure, and $-1$ is reported.\n\nThis procedure will be applied to each of the seven test cases, and the resulting list of iteration counts (or $-1$ for failures) will be formatted as the final output. The behavior of each test case can be predicted by the linear stability analysis. For example, in case $1$, $\\alpha\\,P\\,(1+g) = 0.3 \\times 1 \\times (1+9) = 3.0  2$, predicting oscillatory divergence. In contrast, case $2$ uses preconditioning to bring this value to $0.3 \\times 0.25 \\times 10 = 0.75  2$, stabilizing the iteration. The program will numerically verify these theoretical predictions.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_scf(n0, n_star, g, c, alpha, p_type, p_params):\n    \"\"\"\n    Performs the self-consistent field (SCF) iteration for a single test case.\n\n    Args:\n        n0 (float): Initial value of the order parameter n.\n        n_star (float): Target fixed point.\n        g (float): Linear response gain.\n        c (float): Cubic nonlinearity coefficient.\n        alpha (float): Mixing parameter.\n        p_type (str): Type of preconditioner ('none', 'const', 'kerker').\n        p_params (tuple): Parameters for the preconditioner.\n\n    Returns:\n        int: The number of iterations to converge, or -1 on failure.\n    \"\"\"\n    K_MAX = 500\n    EPSILON = 1e-8\n    DIVERGENCE_THRESHOLD = 1e12\n\n    # Ensure all inputs are double-precision floats\n    n = float(n0)\n    n_star = float(n_star)\n    g = float(g)\n    c = float(c)\n    alpha = float(alpha)\n\n    # Calculate the preconditioner P\n    if p_type == 'none':\n        P = 1.0\n    elif p_type == 'const':\n        p0 = float(p_params[0])\n        P = p0\n    elif p_type == 'kerker':\n        q, k_s = map(float, p_params)\n        P = (q**2) / (q**2 + k_s**2)\n    else:\n        # Invalid preconditioner type, problem is malformed from user side.\n        # This case should not be reached with the given problem statement.\n        return -1\n\n    # Main iteration loop\n    for k in range(K_MAX + 1):\n        # 3a. Check for convergence\n        error = abs(n - n_star)\n        if error  EPSILON:\n            return k\n\n        # 3b. Check for failure (divergence or non-finite)\n        if error > DIVERGENCE_THRESHOLD or not np.isfinite(n):\n            return -1\n\n        # If k reaches K_MAX, we have completed 500 updates (from k=0 to k=499)\n        # and this is the check for n^(500). If it hasn't converged, we fail.\n        if k == K_MAX:\n            break\n\n        # 3c. Calculate the next iterate n^(k+1)\n        # Residual: r(n) = F(n) - n\n        # F(n) = n_star - g*(n - n_star) + c*(n - n_star)^3\n        delta_n = n - n_star\n        F_n = n_star - g * delta_n + c * (delta_n**3)\n        r_n = F_n - n\n        \n        # Update rule: n^(k+1) = n^(k) + alpha * P * r(n^(k))\n        n = n + alpha * P * r_n\n\n    # 4. If loop finishes, max iterations exceeded without converging\n    return -1\n\ndef solve():\n    \"\"\"\n    Defines and runs the test suite for the SCF iteration problem.\n    \"\"\"\n    # Test cases: (n0, n_star, g, c, alpha, p_type, p_params)\n    test_cases = [\n        # Case 1: Strong sloshing, no preconditioning\n        (2.0, 1.0, 9.0, 0.1, 0.3, 'none', ()),\n        # Case 2: Case 1 with stabilizing constant preconditioning\n        (2.0, 1.0, 9.0, 0.1, 0.3, 'const', (0.25,)),\n        # Case 3: Case 1 with Kerker preconditioning\n        (2.0, 1.0, 9.0, 0.1, 0.3, 'kerker', (0.2, 1.0)),\n        # Case 4: Weak mixing, no preconditioning\n        (2.0, 1.0, 9.0, 0.1, 0.05, 'none', ()),\n        # Case 5: Pathological p0=0 preconditioner\n        (1.5, 1.0, 9.0, 0.1, 0.3, 'const', (0.0,)),\n        # Case 6: Extremely strong sloshing, no preconditioning\n        (2.0, 1.0, 30.0, 0.1, 0.2, 'none', ()),\n        # Case 7: Case 6 with Kerker preconditioning\n        (2.0, 1.0, 30.0, 0.1, 0.2, 'kerker', (0.1, 1.0)),\n    ]\n\n    results = []\n    for case in test_cases:\n        n0, n_star, g, c, alpha, p_type, p_params = case\n        result = run_scf(n0, n_star, g, c, alpha, p_type, p_params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2998091"}]}