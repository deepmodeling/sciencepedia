{"hands_on_practices": [{"introduction": "The Eigenstate Thermalization Hypothesis (ETH) is a precise mathematical statement about the structure of operator matrix elements in the energy eigenbasis. Before applying ETH to physical problems, it is crucial to understand the constraints imposed on its structure by fundamental principles. This first practice invites you to explore how the Hermiticity of physical observables translates into specific properties of the functions and random variables that appear in the ETH ansatz, solidifying your grasp of its internal consistency.", "problem": "Consider a finite, nonintegrable quantum many-body system with Hamiltonian $\\hat{H}$ and energy eigenstates $\\{|n\\rangle\\}$, $\\hat{H}|n\\rangle=E_n|n\\rangle$. Let $\\hat{O}$ be a few-body Hermitian observable, so that its matrix elements in the energy eigenbasis satisfy $O_{mn}=O_{nm}^{*}$, where $O_{mn}\\equiv\\langle m|\\hat{O}|n\\rangle$. Assume the Eigenstate Thermalization Hypothesis (ETH) ansatz holds for $\\hat{O}$, namely\n$$\nO_{mn}=O(\\bar{E})\\,\\delta_{mn}+\\exp\\!\\big(-S(\\bar{E})/2\\big)\\,f_{O}(\\bar{E},\\omega)\\,R_{mn},\n$$\nwith the following standard ETH definitions and assumptions:\n- $\\bar{E}\\equiv (E_m+E_n)/2$ and $\\omega\\equiv E_m-E_n$.\n- $S(E)$ is the microcanonical entropy, a smooth and real function of energy.\n- $O(E)$ is a smooth function giving the microcanonical average of $\\hat{O}$ at energy $E$.\n- $f_{O}(E,\\omega)$ is a smooth function of its arguments.\n- $R_{mn}$ are zero-mean, unit-variance random variables that are independent for $m\\neq n$ and have $R_{mm}=0$ by convention.\n\nImpose the Hermiticity condition $O_{mn}=O_{nm}^{*}$ and derive the constraints implied for the random variables $R_{mn}$ and the function $f_{O}(E,\\omega)$. To encode these constraints as concrete calculational targets, define the three quantities\n$$\n\\Delta_{O}(\\bar{E})\\equiv O(\\bar{E})-O^{*}(\\bar{E}),\\qquad T_{mn}\\equiv R_{mn}-R_{nm}^{*},\\qquad S_{f}(\\bar{E},\\omega)\\equiv f_{O}(\\bar{E},\\omega)-f_{O}^{*}(\\bar{E},-\\omega).\n$$\nUsing only the assumptions stated above and the Hermiticity of $\\hat{O}$, determine the closed-form expressions for $\\Delta_{O}(\\bar{E})$, $T_{mn}$, and $S_{f}(\\bar{E},\\omega)$. Provide your final result as a row vector containing these three expressions in the order shown. No rounding is required. The final expressions are dimensionless.", "solution": "The problem requires the derivation of constraints on the components of the Eigenstate Thermalization Hypothesis (ETH) ansatz for a Hermitian observable $\\hat{O}$, arising from the Hermiticity condition on its matrix elements. The matrix elements of a Hermitian operator must satisfy $O_{mn} = O_{nm}^{*}$, where $O_{mn} \\equiv \\langle m|\\hat{O}|n\\rangle$.\n\nThe ETH ansatz for the matrix elements $O_{mn}$ is given as:\n$$\nO_{mn} = O(\\bar{E})\\,\\delta_{mn}+\\exp\\!\\big(-S(\\bar{E})/2\\big)\\,f_{O}(\\bar{E},\\omega)\\,R_{mn}\n$$\nThe variables are defined as $\\bar{E} = (E_m+E_n)/2$ and $\\omega = E_m-E_n$. The function $S(E)$ is the microcanonical entropy and is real.\n\nTo enforce the Hermiticity condition $O_{mn} = O_{nm}^{*}$, we first need to express $O_{nm}$. This is done by interchanging the indices $m$ and $n$ in the ansatz. The average energy for the pair $(n, m)$ is $\\bar{E}' = (E_n+E_m)/2 = \\bar{E}$. The energy difference is $\\omega' = E_n-E_m = -(E_m-E_n) = -\\omega$.\nThus, the matrix element $O_{nm}$ is given by:\n$$\nO_{nm} = O(\\bar{E})\\,\\delta_{nm}+\\exp\\!\\big(-S(\\bar{E})/2\\big)\\,f_{O}(\\bar{E},-\\omega)\\,R_{nm}\n$$\nNext, we take the complex conjugate of $O_{nm}$. Since $S(\\bar{E})$ is a real function, the term $\\exp(-S(\\bar{E})/2)$ is real. We have:\n$$\nO_{nm}^{*} = \\left(O(\\bar{E})\\,\\delta_{nm}+\\exp\\!\\big(-S(\\bar{E})/2\\big)\\,f_{O}(\\bar{E},-\\omega)\\,R_{nm}\\right)^{*}\n$$\n$$\nO_{nm}^{*} = O^{*}(\\bar{E})\\,\\delta_{mn}+\\exp\\!\\big(-S(\\bar{E})/2\\big)\\,f_{O}^{*}(\\bar{E},-\\omega)\\,R_{nm}^{*}\n$$\nHere, we have used the property that the Kronecker delta is symmetric, $\\delta_{nm} = \\delta_{mn}$.\n\nNow we equate the expressions for $O_{mn}$ and $O_{nm}^{*}$:\n$$\nO(\\bar{E})\\,\\delta_{mn}+\\exp\\!\\big(-S(\\bar{E})/2\\big)\\,f_{O}(\\bar{E},\\omega)\\,R_{mn} = O^{*}(\\bar{E})\\,\\delta_{mn}+\\exp\\!\\big(-S(\\bar{E})/2\\big)\\,f_{O}^{*}(\\bar{E},-\\omega)\\,R_{nm}^{*}\n$$\nThis equation must hold for all pairs of indices $(m, n)$. We analyze the diagonal and off-diagonal cases separately.\n\nCase 1: Diagonal elements ($m=n$)\nFor the diagonal elements, we have $\\delta_{mn} = 1$. The energy difference is $\\omega = E_n - E_n = 0$, and the average energy is $\\bar{E} = E_n$. By convention, the random variables for diagonal elements are $R_{nn}=0$. The equation simplifies to:\n$$\nO(E_n) = O^{*}(E_n)\n$$\nThis implies that the function $O(E)$, which represents the microcanonical average of the observable $\\hat{O}$, must be real-valued for any energy $E$ in its domain.\nThe first quantity to be determined is $\\Delta_{O}(\\bar{E}) \\equiv O(\\bar{E}) - O^{*}(\\bar{E})$. Based on our finding, this is:\n$$\n\\Delta_{O}(\\bar{E}) = 0\n$$\n\nCase 2: Off-diagonal elements ($m \\neq n$)\nFor the off-diagonal elements, $\\delta_{mn} = 0$. The equation becomes:\n$$\n\\exp\\!\\big(-S(\\bar{E})/2\\big)\\,f_{O}(\\bar{E},\\omega)\\,R_{mn} = \\exp\\!\\big(-S(\\bar{E})/2\\big)\\,f_{O}^{*}(\\bar{E},-\\omega)\\,R_{nm}^{*}\n$$\nSince the entropy $S(\\bar{E})$ is finite, the exponential prefactor is non-zero, and we can divide by it to obtain:\n$$\nf_{O}(\\bar{E},\\omega)\\,R_{mn} = f_{O}^{*}(\\bar{E},-\\omega)\\,R_{nm}^{*}\n$$\nThis equation constitutes the constraint imposed by Hermiticity on the off-diagonal part of the ansatz. The ansatz's core physical assumption is the separation of a matrix element into a smooth, deterministic part (here, $f_O$) and a pseudo-random part ($R_{mn}$). For this separation to be structurally consistent and meaningful, any fundamental symmetry, such as Hermiticity, should be reflected in the components of the ansatz. A scenario where a specific property of the random variable $R_{mn}$ depends on the value of the smooth function $f_O$ would imply a fine-tuned conspiracy between the smooth and random parts, undermining the very principle of their separation.\n\nTherefore, the most natural and consistent way to satisfy the relation is for the smooth and random parts to satisfy the Hermiticity constraint independently. This leads to a decoupling of the equation into two separate conditions. While a non-trivial phase factor could be distributed between the two relations, such a phase can be absorbed into the definitions of $f_O$ and $R_{mn}$ without loss of generality. The standard convention, which preserves the given statistical properties of $R_{mn}$, sets this phase to zero. This leads to the following two constraints:\n1. $f_{O}(\\bar{E},\\omega) = f_{O}^{*}(\\bar{E},-\\omega)$\n2. $R_{mn} = R_{nm}^{*}$\n\nWe can now determine the remaining two quantities.\nThe second quantity is $S_{f}(\\bar{E},\\omega) \\equiv f_{O}(\\bar{E},\\omega) - f_{O}^{*}(\\bar{E},-\\omega)$. Using the first constraint derived above, we find:\n$$\nS_{f}(\\bar{E},\\omega) = 0\n$$\nThe third quantity is $T_{mn} \\equiv R_{mn} - R_{nm}^{*}$. Using the second constraint, we find:\n$$\nT_{mn} = 0\n$$\n\nIn summary, the Hermiticity of the operator $\\hat{O}$ constrains the functions and random variables within the ETH ansatz such that $O(E)$ is real, $f_{O}(\\bar{E},\\omega) = f_{O}^{*}(\\bar{E},-\\omega)$, and $R_{mn} = R_{nm}^{*}$. This leads to the conclusion that all three requested quantities are zero.\n\nThe final expressions are:\n$\\Delta_{O}(\\bar{E}) = 0$\n$T_{mn} = 0$\n$S_{f}(\\bar{E},\\omega) = 0$", "answer": "$$\n\\boxed{\\begin{pmatrix} 0 & 0 & 0 \\end{pmatrix}}\n$$", "id": "2984492"}, {"introduction": "With a solid understanding of the ETH ansatz, we can now use its core physical insight: that for a non-integrable system, the long-time expectation value of a local observable can be predicted by a thermal ensemble. This exercise provides a concrete scenario—a quantum quench in a spin chain—where you will apply this principle. By calculating the system's conserved energy and relating it to an effective temperature, you will make a quantitative prediction for thermalization, bridging the gap between the abstract hypothesis and a tangible physical outcome [@problem_id:2984492].", "problem": "Consider a one-dimensional chain of $L$ spin-1/2 degrees of freedom with periodic boundary conditions. The post-quench Hamiltonian is\n$$\nH \\,=\\, J \\sum_{i=0}^{L-1} \\sigma_{i}^{z}\\sigma_{i+1}^{z} \\;+\\; h_{x} \\sum_{i=0}^{L-1} \\sigma_{i}^{x} \\;+\\; h_{z} \\sum_{i=0}^{L-1} \\sigma_{i}^{z},\n$$\nwhere $\\sigma_{i}^{\\alpha}$, with $\\alpha \\in \\{x,y,z\\}$, are the Pauli matrices on site $i$, and $J$, $h_{x}$, $h_{z}$ are real nonzero parameters. Because both longitudinal and transverse fields are present, the model is nonintegrable. Prepare the initial pure state by a local perturbation that flips the spin at site $0$ while all others are polarized along $+z$,\n$$\n|\\psi_{0}\\rangle \\,=\\, |\\downarrow_{0}\\rangle \\bigotimes_{i=1}^{L-1} |\\uparrow_{i}\\rangle,\n$$\nand at time $t=0$ quench to evolution under the Hamiltonian $H$ above. Let the local observable of interest be $O \\equiv \\sigma_{0}^{z}$.\n\nUsing the Eigenstate Thermalization Hypothesis (ETH), argue that at late times the expectation value of $O$ approaches its thermal value in the canonical ensemble at an effective inverse temperature $\\beta_{\\mathrm{eff}}$ fixed by the conserved post-quench energy density of $|\\psi_{0}\\rangle$. Starting from foundational definitions of the canonical ensemble and high-temperature expansions, and without assuming any special integrability properties of $H$, perform the following:\n\n1. Compute the initial energy $E_{0} = \\langle \\psi_{0} | H | \\psi_{0} \\rangle$ exactly in terms of $J$, $h_{x}$, $h_{z}$, and $L$.\n\n2. Using a leading-order high-temperature expansion in the canonical ensemble, determine $\\beta_{\\mathrm{eff}}$ by matching the thermal average of $H$ to $E_{0}$.\n\n3. To the same leading order in $\\beta_{\\mathrm{eff}}$, predict the late-time value $\\langle \\sigma_{0}^{z} \\rangle_{\\mathrm{ETH}}$.\n\nProvide your final result as a single closed-form analytic expression for $\\langle \\sigma_{0}^{z} \\rangle_{\\mathrm{ETH}}$ in terms of $J$, $h_{x}$, $h_{z}$, and $L$. No numerical evaluation or rounding is required, and no physical units need be specified.", "solution": "The Eigenstate Thermalization Hypothesis (ETH) posits that for a generic, non-integrable quantum many-body system, the long-time average of a local observable's expectation value, after a quench, equilibrates to the value predicted by the corresponding thermal ensemble. The specific ensemble and its parameters are determined by the conserved quantities of the system. In this case, the only conserved quantity is the total energy. The initial state $|\\psi_0\\rangle$ is not an eigenstate of the Hamiltonian $H$, so it will evolve in time. It can be expressed as a superposition of the energy eigenstates $|E_n\\rangle$ of $H$, $|\\psi_0\\rangle = \\sum_n c_n |E_n\\rangle$. The time-evolved state is $|\\psi(t)\\rangle = e^{-iHt/\\hbar} |\\psi_0\\rangle = \\sum_n c_n e^{-iE_n t/\\hbar} |E_n\\rangle$. The expectation value of the observable $O=\\sigma_0^z$ is $\\langle O(t) \\rangle = \\sum_{m,n} c_m^* c_n e^{i(E_m-E_n)t/\\hbar} \\langle E_m|O|E_n\\rangle$. The long-time average is dominated by the diagonal terms ($m=n$): $\\overline{\\langle O(t) \\rangle} = \\sum_n |c_n|^2 \\langle E_n|O|E_n\\rangle$.\n\nAccording to ETH, the diagonal matrix elements $\\langle E_n|O|E_n\\rangle$ are a smooth function of energy $E_n$, which is equivalent to the microcanonical average of $O$ at that energy. If the energy distribution $|c_n|^2$ is sharply peaked around the average energy $E_0 = \\langle\\psi_0|H|\\psi_0\\rangle$, the long-time average is well-approximated by the microcanonical average at energy $E_0$. For a large system, this is equivalent to the canonical ensemble average at an effective inverse temperature $\\beta_{\\mathrm{eff}}$, fixed by the condition that the average energy in the canonical ensemble matches $E_0$. We proceed with the three steps outlined in the problem.\n\nStep 1: Compute the initial energy $E_0$.\nThe initial energy is the expectation value of the Hamiltonian $H$ in the initial state $|\\psi_0\\rangle$.\n$$\nE_0 = \\langle \\psi_0 | H | \\psi_0 \\rangle = \\left\\langle \\psi_0 \\left| J \\sum_{i=0}^{L-1} \\sigma_{i}^{z}\\sigma_{i+1}^{z} + h_{x} \\sum_{i=0}^{L-1} \\sigma_{i}^{x} + h_{z} \\sum_{i=0}^{L-1} \\sigma_{i}^{z} \\right| \\psi_0 \\right\\rangle\n$$\nThe state $|\\psi_0\\rangle = |\\downarrow_0\\rangle \\bigotimes_{i=1}^{L-1} |\\uparrow_i\\rangle$ is an eigenstate of every $\\sigma_i^z$ operator: $\\sigma_0^z |\\psi_0\\rangle = -1 |\\psi_0\\rangle$ and $\\sigma_i^z |\\psi_0\\rangle = +1 |\\psi_0\\rangle$ for $i \\in \\{1, \\dots, L-1\\}$. We evaluate the expectation value of each term in $H$.\n\nFor the transverse field term: $\\sigma_i^x$ flips the spin at site $i$. The resulting state is orthogonal to $|\\psi_0\\rangle$. Thus, $\\langle\\psi_0|\\sigma_i^x|\\psi_0\\rangle=0$ for all $i$. The contribution from this term is $0$.\n\nFor the longitudinal field term:\n$$\n\\left\\langle \\psi_0 \\left| h_z \\sum_{i=0}^{L-1} \\sigma_i^z \\right| \\psi_0 \\right\\rangle = h_z \\left( \\langle\\psi_0|\\sigma_0^z|\\psi_0\\rangle + \\sum_{i=1}^{L-1} \\langle\\psi_0|\\sigma_i^z|\\psi_0\\rangle \\right) = h_z(-1 + (L-1)\\times 1) = h_z(L-2)\n$$\n\nFor the interaction term, we use periodic boundary conditions ($\\sigma_L^z \\equiv \\sigma_0^z$):\n$$\n\\left\\langle \\psi_0 \\left| J \\sum_{i=0}^{L-1} \\sigma_i^z \\sigma_{i+1}^z \\right| \\psi_0 \\right\\rangle = J \\left( \\langle\\sigma_0^z\\sigma_1^z\\rangle + \\sum_{i=1}^{L-2} \\langle\\sigma_i^z\\sigma_{i+1}^z\\rangle + \\langle\\sigma_{L-1}^z\\sigma_0^z\\rangle \\right)\n$$\nThe expectation values of the products are:\n$\\langle\\sigma_0^z\\sigma_1^z\\rangle = (-1)(+1) = -1$.\nFor $i \\in \\{1, \\dots, L-2\\}$, $\\langle\\sigma_i^z\\sigma_{i+1}^z\\rangle = (+1)(+1) = 1$. There are $L-2$ such terms.\n$\\langle\\sigma_{L-1}^z\\sigma_0^z\\rangle = (+1)(-1) = -1$.\nThe total expectation value is $J(-1 + (L-2) \\times 1 - 1) = J(L-4)$.\n\nCombining the terms, the initial energy is:\n$$\nE_0 = J(L-4) + h_z(L-2)\n$$\n\nStep 2: Determine $\\beta_{\\mathrm{eff}}$ using a high-temperature expansion.\nThe thermal average of the energy is $\\langle H \\rangle_\\beta = \\frac{\\mathrm{Tr}(H e^{-\\beta H})}{Z(\\beta)}$, where $Z(\\beta) = \\mathrm{Tr}(e^{-\\beta H})$. The high-temperature expansion corresponds to small $\\beta$. We expand the exponential to leading order in $\\beta$: $e^{-\\beta H} \\approx \\mathbb{I} - \\beta H$.\nThe partition function is $Z(\\beta) = \\mathrm{Tr}(\\mathbb{I} - \\beta H) = \\mathrm{Tr}(\\mathbb{I}) - \\beta \\mathrm{Tr}(H)$. The trace is taken over the $2^L$-dimensional Hilbert space. $\\mathrm{Tr}(\\mathbb{I}) = 2^L$. The trace of any single Pauli matrix is zero, so $\\mathrm{Tr}(\\sigma_i^\\alpha)=0$. The Hamiltonian is a sum of terms that are either single Pauli matrices or products of two Pauli matrices on different sites. All these terms are traceless. Thus, $\\mathrm{Tr}(H)=0$.\nTo leading order, $Z(\\beta) \\approx 2^L$.\n\nThe numerator is $\\mathrm{Tr}(H e^{-\\beta H}) \\approx \\mathrm{Tr}(H(\\mathbb{I} - \\beta H)) = \\mathrm{Tr}(H) - \\beta \\mathrm{Tr}(H^2) = -\\beta \\mathrm{Tr}(H^2)$.\nThus, the leading-order thermal average energy is $\\langle H \\rangle_\\beta \\approx -\\beta \\frac{\\mathrm{Tr}(H^2)}{2^L}$.\nWe must compute $\\mathrm{Tr}(H^2)$:\n$$\nH^2 = \\left( J \\sum_{i} \\sigma_{i}^{z}\\sigma_{i+1}^{z} + h_{x} \\sum_{j} \\sigma_{j}^{x} + h_{z} \\sum_{k} \\sigma_{k}^{z} \\right)^2\n$$\nWhen taking the trace, cross-terms involving products of operators with different indices or different Pauli components vanish. For example, $\\mathrm{Tr}(\\sigma_i^\\alpha \\sigma_j^\\gamma) = 2^L \\delta_{ij}\\delta_{\\alpha\\gamma}$. Also, $\\mathrm{Tr}(\\sigma_i^z \\sigma_{i+1}^z \\sigma_j^x)=0$. Therefore, only the square of each term in $H$ contributes to $\\mathrm{Tr}(H^2)$.\n$$\n\\mathrm{Tr}(H^2) = \\mathrm{Tr}\\left[ \\left(J \\sum_{i} \\sigma_{i}^{z}\\sigma_{i+1}^{z}\\right)^2 + \\left(h_{x} \\sum_{j} \\sigma_{j}^{x}\\right)^2 + \\left(h_{z} \\sum_{k} \\sigma_{k}^{z}\\right)^2 \\right]\n$$\n$\\mathrm{Tr}((\\sum_j \\sigma_j^x)^2) = \\sum_{j,j'} \\mathrm{Tr}(\\sigma_j^x \\sigma_{j'}^x) = \\sum_j \\mathrm{Tr}((\\sigma_j^x)^2) = \\sum_j \\mathrm{Tr}(\\mathbb{I}) = L 2^L$.\nSimilarly, $\\mathrm{Tr}((\\sum_k \\sigma_k^z)^2) = L 2^L$.\nFor the interaction term, $\\mathrm{Tr}((\\sum_i \\sigma_i^z\\sigma_{i+1}^z)^2) = \\sum_{i,i'} \\mathrm{Tr}(\\sigma_i^z\\sigma_{i+1}^z\\sigma_{i'}^z\\sigma_{i'+1}^z)$. The trace is non-zero only if $i=i'$. So, $\\sum_i \\mathrm{Tr}((\\sigma_i^z\\sigma_{i+1}^z)^2) = \\sum_i \\mathrm{Tr}(\\mathbb{I}) = L 2^L$.\nCombining these results:\n$$\n\\mathrm{Tr}(H^2) = J^2(L 2^L) + h_x^2(L 2^L) + h_z^2(L 2^L) = L(J^2 + h_x^2 + h_z^2)2^L\n$$\nThe thermal energy is $\\langle H \\rangle_\\beta \\approx -\\beta L(J^2 + h_x^2 + h_z^2)$.\nWe find $\\beta_{\\mathrm{eff}}$ by setting $\\langle H \\rangle_{\\beta_{\\mathrm{eff}}} = E_0$:\n$$\n-\\beta_{\\mathrm{eff}} L(J^2 + h_x^2 + h_z^2) = J(L-4) + h_z(L-2)\n$$\n$$\n\\beta_{\\mathrm{eff}} = - \\frac{J(L-4) + h_z(L-2)}{L(J^2 + h_x^2 + h_z^2)}\n$$\n\nStep 3: Predict the late-time value $\\langle \\sigma_0^z \\rangle_{\\mathrm{ETH}}$.\nAccording to ETH, this value is given by the canonical average $\\langle \\sigma_0^z \\rangle_{\\beta_{\\mathrm{eff}}}$.\n$$\n\\langle \\sigma_0^z \\rangle_\\beta = \\frac{\\mathrm{Tr}(\\sigma_0^z e^{-\\beta H})}{Z(\\beta)} \\approx \\frac{\\mathrm{Tr}(\\sigma_0^z(\\mathbb{I} - \\beta H))}{2^L}\n$$\nThe numerator is $\\mathrm{Tr}(\\sigma_0^z) - \\beta \\mathrm{Tr}(\\sigma_0^z H) = -\\beta \\mathrm{Tr}(\\sigma_0^z H)$ since $\\mathrm{Tr}(\\sigma_0^z)=0$.\nWe compute $\\mathrm{Tr}(\\sigma_0^z H)$:\n$$\n\\mathrm{Tr}(\\sigma_0^z H) = \\mathrm{Tr}\\left(\\sigma_0^z \\left[ J \\sum_{i} \\sigma_{i}^{z}\\sigma_{i+1}^{z} + h_{x} \\sum_{j} \\sigma_{j}^{x} + h_{z} \\sum_{k} \\sigma_{k}^{z} \\right]\\right)\n$$\nThe trace of the $J$ term, $\\sum_i \\mathrm{Tr}(\\sigma_0^z \\sigma_i^z \\sigma_{i+1}^z)$, is zero because the trace of a product of three Pauli matrices on different sites is zero, and terms like $\\mathrm{Tr}(\\sigma_0^z\\sigma_0^z\\sigma_1^z) = \\mathrm{Tr}(\\sigma_1^z)$ are also zero.\nThe trace of the $h_x$ term, $\\sum_j \\mathrm{Tr}(\\sigma_0^z \\sigma_j^x)$, is zero for all $j$ because $\\mathrm{Tr}(\\sigma^\\alpha \\sigma^\\gamma)=0$ if $\\alpha \\neq \\gamma$.\nThe trace of the $h_z$ term is $\\sum_k \\mathrm{Tr}(\\sigma_0^z \\sigma_k^z)$. This is non-zero only for $k=0$.\n$$\n\\mathrm{Tr}(\\sigma_0^z h_z \\sigma_0^z) = h_z \\mathrm{Tr}((\\sigma_0^z)^2) = h_z \\mathrm{Tr}(\\mathbb{I}) = h_z 2^L\n$$\nSo, $\\mathrm{Tr}(\\sigma_0^z H) = h_z 2^L$.\nThe thermal average is $\\langle \\sigma_0^z \\rangle_\\beta \\approx \\frac{-\\beta (h_z 2^L)}{2^L} = -\\beta h_z$.\nSubstituting $\\beta = \\beta_{\\mathrm{eff}}$:\n$$\n\\langle \\sigma_0^z \\rangle_{\\mathrm{ETH}} = - \\beta_{\\mathrm{eff}} h_z = - \\left( - \\frac{J(L-4) + h_z(L-2)}{L(J^2 + h_x^2 + h_z^2)} \\right) h_z\n$$\n$$\n\\langle \\sigma_0^z \\rangle_{\\mathrm{ETH}} = \\frac{h_z (J(L-4) + h_z(L-2))}{L(J^2 + h_x^2 + h_z^2)}\n$$\nThis is the final expression for the predicted late-time expectation value of $\\sigma_0^z$.", "answer": "$$\n\\boxed{\\frac{h_{z} \\left(J(L-4) + h_{z}(L-2)\\right)}{L\\left(J^{2} + h_{x}^{2} + h_{z}^{2}\\right)}}\n$$", "id": "2984527"}, {"introduction": "Analytical predictions, like the one explored in the previous practice [@problem_id:2984527], are powerful, but the ultimate test of a physical hypothesis often lies in direct simulation. This final practice guides you through a numerical experiment to verify the predictions of ETH using exact diagonalization, a cornerstone technique in computational quantum physics. You will construct the Hamiltonian for a non-integrable system, simulate its quantum dynamics, and directly compare the result to the microcanonical prediction, witnessing the remarkable agreement that underpins the validity of ETH.", "problem": "Consider a finite spin-1/2 chain of length $L$ with periodic boundary conditions and Pauli matrices $\\sigma_i^x$, $\\sigma_i^y$, and $\\sigma_i^z$ acting on site $i \\in \\{0,1,\\dots,L-1\\}$. Let the post-quench Hamiltonian be\n$$\nH = \\sum_{i=0}^{L-1} \\left[ J \\left( \\sigma_i^x \\sigma_{i+1}^x + \\sigma_i^y \\sigma_{i+1}^y + \\Delta \\, \\sigma_i^z \\sigma_{i+1}^z \\right) + J_2 \\left( \\sigma_i^x \\sigma_{i+2}^x + \\sigma_i^y \\sigma_{i+2}^y + \\Delta \\, \\sigma_i^z \\sigma_{i+2}^z \\right) \\right] + \\sum_{i=0}^{L-1} h_i \\sigma_i^z + g \\sum_{i=0}^{L-1} \\sigma_i^x,\n$$\nwith periodic boundary conditions understood as $\\sigma_{i+L}^\\alpha \\equiv \\sigma_i^\\alpha$ for any $\\alpha \\in \\{x,y,z\\}$. The on-site field values $h_i$ are independent and identically distributed random variables drawn uniformly from the interval $[-W, W]$ with a prescribed pseudorandom seed for reproducibility. This choice of couplings and fields yields a nonintegrable Hamiltonian for generic parameters.\n\nAn initial product state $|\\psi_0\\rangle$ is specified by a binary string $b$ of length $L$ with characters in $\\{0,1\\}$, where character $b_i$ corresponds to site $i$. The mapping is: $b_i = 0$ represents the local $\\sigma^z$ eigenstate with eigenvalue $+1$ (spin up), and $b_i = 1$ represents the local $\\sigma^z$ eigenstate with eigenvalue $-1$ (spin down). The computational basis index is defined so that the integer label of $|\\psi_0\\rangle$ equals $\\sum_{i=0}^{L-1} b_i 2^i$, i.e., site index $i$ maps to bit position $i$ in little-endian order.\n\nLet the local observable be $A = \\sigma_\\ell^z$ at a specified site $\\ell$. Under unitary time evolution generated by $H$, $|\\psi(t)\\rangle = e^{-i H t} |\\psi_0\\rangle$, and the time-dependent expectation is $\\langle A \\rangle_t \\equiv \\langle \\psi(t) | A | \\psi(t) \\rangle$. The long-time average is defined as\n$$\n\\overline{\\langle A \\rangle} \\equiv \\lim_{T \\to \\infty} \\frac{1}{T} \\int_0^T \\langle \\psi(t) | A | \\psi(t) \\rangle \\, dt.\n$$\nAssuming a nondegenerate spectrum, this equals the diagonal-ensemble value in the eigenbasis of $H$, which can be computed exactly from the spectral decomposition. The microcanonical prediction at the prepared energy density is defined as follows: Let $E_0 \\equiv \\langle \\psi_0 | H | \\psi_0 \\rangle$ be the energy expectation of the initial state with respect to $H$. The microcanonical average of $A$ is the arithmetic mean of the diagonal matrix elements $\\langle E_n | A | E_n \\rangle$ over an energy window centered at $E_0$ that contains a fixed fraction $\\alpha$ of the spectrum, but not fewer than a minimum of $N_{\\min}$ states, selecting the eigenstates closest to $E_0$ by $|E_n - E_0|$.\n\nYour task is to implement an exact-diagonalization algorithm that:\n- Constructs $H$ from the given parameters.\n- Diagonalizes $H$ to obtain eigenvalues $\\{E_n\\}$ and orthonormal eigenvectors $\\{|E_n\\rangle\\}$.\n- Computes the long-time average $\\overline{\\langle A \\rangle}$ via the diagonal ensemble using the overlaps $c_n \\equiv \\langle E_n | \\psi_0 \\rangle$ and the diagonal matrix elements $A_{nn} \\equiv \\langle E_n | A | E_n \\rangle$.\n- Computes the microcanonical average $\\langle A \\rangle_{\\text{micro}}$ as the mean of $A_{nn}$ over the $N_{\\text{win}} = \\max(N_{\\min}, \\lfloor \\alpha \\cdot 2^L \\rfloor)$ eigenstates with energies closest to $E_0$.\n- Verifies the Eigenstate Thermalization Hypothesis (ETH) by checking whether the absolute difference $|\\overline{\\langle A \\rangle} - \\langle A \\rangle_{\\text{micro}}|$ is bounded by a finite-size tolerance $\\epsilon(L) = \\kappa / \\sqrt{2^L}$ for a given constant $\\kappa$.\n\nBase your derivation and algorithm on the following fundamental principles:\n- The time-dependent Schrödinger equation and unitary evolution generated by a time-independent Hamiltonian.\n- The spectral decomposition of $H$ and Parseval’s identity for expansion coefficients in an orthonormal basis.\n- The definition of the microcanonical ensemble as a narrow energy window average for a local observable.\n\nNo shortcut formulas or hints beyond these principles should be used; the correctness must follow from first principles and sound numerical logic. All quantities are dimensionless, and there are no physical units involved. Angles, if any, are in radians, but none are required here.\n\nTest Suite and Answer Specification:\nImplement your program to run on the following parameter sets, each described as a tuple:\n$$\n\\text{Case } k: \\quad (L, J, \\Delta, J_2, g, W, \\text{seed}, \\alpha, N_{\\min}, \\ell, \\kappa, b)\n$$\nwith\n- Case $1$: $(8, 1.0, 1.2, 0.5, 0.7, 0.8, 31415, 0.04, 10, 3, 1.0, \\text{\"10101010\"})$,\n- Case $2$: $(10, 1.0, 1.0, 0.3, 0.9, 1.0, 2023, 0.03, 10, 5, 1.0, \\text{\"1001011001\"})$,\n- Case $3$: $(6, 1.0, 1.1, 0.4, 0.5, 0.5, 7, 0.08, 10, 2, 1.0, \\text{\"000000\"})$.\n\nFor each case, compute the boolean result:\n$$\n\\text{ETH\\_holds} = \\left( \\left| \\overline{\\langle A \\rangle} - \\langle A \\rangle_{\\text{micro}} \\right| \\leq \\frac{\\kappa}{\\sqrt{2^L}} \\right).\n$$\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases, for example $[\\text{result}_1,\\text{result}_2,\\text{result}_3]$, where each $\\text{result}_k$ is the boolean for Case $k$.", "solution": "The problem requires a numerical verification of the Eigenstate Thermalization Hypothesis (ETH) for a specific nonintegrable quantum spin chain model. The verification involves comparing the long-time average of a local observable with its microcanonical expectation value. This necessitates a full exact diagonalization of the system's Hamiltonian. The solution proceeds methodically from first principles.\n\n### 1. Hilbert Space Representation\nThe system is a chain of $L$ spin-$\\tfrac{1}{2}$ particles. The total Hilbert space $\\mathcal{H}$ is the tensor product of the local two-dimensional Hilbert spaces, $\\mathcal{H} = \\bigotimes_{i=0}^{L-1} \\mathcal{H}_i$. The dimension of this space is $D = 2^L$. We use the computational basis, which consists of product states of the local $\\sigma^z$ operators. A basis state is denoted by $|s_0, s_1, \\dots, s_{L-1}\\rangle$, where $s_i \\in \\{+1, -1\\}$ is the eigenvalue of $\\sigma_i^z$.\n\nThe problem specifies a mapping between these spin configurations and integer indices from $0$ to $D-1$. A binary string $b$ of length $L$ defines an initial state, where $b_i=0$ corresponds to spin-up ($s_i=+1$) and $b_i=1$ corresponds to spin-down ($s_i=-1$). The integer index $k$ of a basis state is given by the little-endian conversion $k = \\sum_{i=0}^{L-1} b_i 2^i$, where $b_i$ is the bit for site $i$. The spin value at site $i$ for a state indexed by $k$ is $s_i = 1 - 2b_i = 1 - 2((k \\gg i) & 1)$.\n\n### 2. Hamiltonian Construction\nThe Hamiltonian $H$ is a $D \\times D$ matrix whose elements are given by $H_{mn} = \\langle m | H | n \\rangle$, where $|m\\rangle$ and $|n\\rangle$ are computational basis states. The Hamiltonian is given as:\n$$\nH = \\sum_{i=0}^{L-1} \\left[ J \\left( \\sigma_i^x \\sigma_{i+1}^x + \\sigma_i^y \\sigma_{i+1}^y + \\Delta \\, \\sigma_i^z \\sigma_{i+1}^z \\right) + J_2 \\left( \\sigma_i^x \\sigma_{i+2}^x + \\sigma_i^y \\sigma_{i+2}^y + \\Delta \\, \\sigma_i^z \\sigma_{i+2}^z \\right) \\right] + \\sum_{i=0}^{L-1} h_i \\sigma_i^z + g \\sum_{i=0}^{L-1} \\sigma_i^x\n$$\nWe construct the matrix by calculating its elements, interpreting the summation $\\sum_{i=0}^{L-1}$ literally over each site $i$.\n\n**Diagonal Elements:** The operators $\\sigma_i^z$ and $\\sigma_i^z \\sigma_j^z$ are diagonal in the computational basis. For a basis state $|k\\rangle$, $\\sigma_i^z |k\\rangle = s_i |k\\rangle$. The diagonal element $H_{kk} = \\langle k | H | k \\rangle$ is therefore:\n$$\nH_{kk} = \\sum_{i=0}^{L-1} \\left( h_i s_i + J \\Delta s_i s_{i+1} + J_2 \\Delta s_i s_{i+2} \\right)\n$$\nwhere indices are taken modulo $L$.\n\n**Off-Diagonal Elements:** The off-diagonal elements are generated by terms involving $\\sigma^x$ and $\\sigma^y$.\n-   **Transverse Field ($g \\sum_i \\sigma_i^x$):** The operator $\\sigma_i^x$ flips the spin at site $i$. Acting on a state $|k\\rangle$, it produces $|k \\oplus 2^i\\rangle$, where $\\oplus$ is the bitwise XOR. The matrix element connecting these two states due to the term $g \\sigma_i^x$ is $g$. Summing over all $i$, the total matrix element is $H_{m,k} = \\sum_i g \\langle m | \\sigma_i^x | k \\rangle$. This is non-zero and equal to $g$ if $m$ and $k$ differ by a single spin flip at some site, and zero otherwise.\n-   **XY Interaction ($J(\\sigma_i^x \\sigma_{i+1}^x + \\sigma_i^y \\sigma_{i+1}^y)$):** It holds that $\\sigma_i^x \\sigma_j^x + \\sigma_i^y \\sigma_j^y = 2(\\sigma_i^+ \\sigma_j^- + \\sigma_i^- \\sigma_j^+)$, where $\\sigma^\\pm$ are the spin raising/lowering operators. This operator annihilates states with parallel spins at sites $i, j$ and swaps anti-parallel spins. Specifically, if state $|k\\rangle$ has anti-parallel spins at sites $i$ and $j$, i.e., $b_i \\neq b_j$, this term connects it to state $|m\\rangle = |k \\oplus 2^i \\oplus 2^j\\rangle$ with a matrix element of $2$. Thus, the total contribution to $H_{m,k}$ from the nearest-neighbor XY terms is $2J$ for each pair of adjacent sites $\\{i, i+1\\}$ where $|k\\rangle$ and $|m\\rangle$ have their spins flipped. Similarly, the next-nearest-neighbor terms contribute $2J_2$.\n\nThe algorithm for building $H$ involves iterating through each basis state $|k\\rangle$ and, for each term in the Hamiltonian sum, adding its contribution to the corresponding matrix elements. For a state $k$, and for each site $i=0, \\dots, L-1$:\n1. Add $h_i s_i + J\\Delta s_i s_{i+1} + J_2\\Delta s_i s_{i+2}$ to $H_{kk}$.\n2. Add $g$ to $H_{k \\oplus 2^i, k}$.\n3. If spins at $i, i+1$ differ, add $2J$ to $H_{k \\oplus 2^i \\oplus 2^{i+1}, k}$.\n4. If spins at $i, i+2$ differ, add $2J_2$ to $H_{k \\oplus 2^i \\oplus 2^{i+2}, k}$.\n\n### 3. Diagonalization and Initial State\nOnce the real symmetric Hamiltonian matrix $H$ is constructed, it is diagonalized using standard numerical linear algebra routines (e.g., `numpy.linalg.eigh`). This yields a set of real eigenvalues $\\{E_n\\}$ and a corresponding orthonormal set of eigenvectors $\\{|E_n\\rangle\\}$, where $n=0, \\dots, D-1$. The eigenvectors $|E_n\\rangle$ are expressed as column vectors in the computational basis.\n$$\nH |E_n\\rangle = E_n |E_n\\rangle\n$$\nThe initial state $|\\psi_0\\rangle$ is a computational basis state $|k_0\\rangle$ specified by the binary string $b$. The index $k_0$ is calculated as $k_0 = \\sum_{i=0}^{L-1} \\text{int}(b_i) 2^i$. In the vector representation, $|\\psi_0\\rangle$ is a vector with a $1$ at position $k_0$ and $0$s elsewhere.\n\n### 4. Long-Time Average (Diagonal Ensemble)\nThe time-evolved state is $|\\psi(t)\\rangle = e^{-iHt} |\\psi_0\\rangle$. Expanding $|\\psi_0\\rangle$ in the eigenbasis of $H$, $|\\psi_0\\rangle = \\sum_n c_n |E_n\\rangle$ with coefficients $c_n = \\langle E_n | \\psi_0 \\rangle$, the evolved state is $|\\psi(t)\\rangle = \\sum_n c_n e^{-iE_n t} |E_n\\rangle$. The expectation value of an observable $A$ at time $t$ is:\n$$\n\\langle A \\rangle_t = \\langle \\psi(t) | A | \\psi(t) \\rangle = \\sum_{n,m} c_m^* c_n e^{i(E_m-E_n)t} \\langle E_m | A | E_n \\rangle\n$$\nThe long-time average is $\\overline{\\langle A \\rangle} = \\lim_{T\\to\\infty} \\frac{1}{T}\\int_0^T \\langle A \\rangle_t dt$. The time integral causes terms with $E_m \\neq E_n$ to average to zero. Assuming a nondegenerate spectrum ($E_m \\neq E_n$ for $m \\neq n$), only the diagonal terms ($m=n$) survive:\n$$\n\\overline{\\langle A \\rangle} = \\sum_n |c_n|^2 \\langle E_n | A | E_n \\rangle\n$$\nThis is the diagonal ensemble average. The coefficients are calculated as $c_n = \\langle E_n | k_0 \\rangle$, which is the $k_0$-th component of the eigenvector $|E_n\\rangle$. Let $U$ be the matrix of eigenvectors, where $U_{kn} = \\langle k | E_n \\rangle$. Then $c_n = U_{k_0,n}$.\nThe observable is $A = \\sigma_\\ell^z$, which is diagonal in the computational basis: $A_{kk'} = \\langle k|A|k'\\rangle = s_{k,\\ell} \\delta_{kk'}$, where $s_{k,\\ell}$ is the spin at site $\\ell$ in state $|k\\rangle$. The diagonal matrix elements in the energy eigenbasis are $A_{nn} = \\langle E_n | A | E_n \\rangle = \\sum_k |\\langle E_n | k \\rangle|^2 \\langle k|A|k\\rangle = \\sum_k U_{kn}^2 s_{k,\\ell}$.\n\n### 5. Microcanonical Average\nThe microcanonical average $\\langle A \\rangle_{\\text{micro}}$ is the average of the diagonal matrix elements $A_{nn}$ over a narrow energy window around the energy of the initial state, $E_0 = \\langle \\psi_0 | H | \\psi_0 \\rangle = H_{k_0,k_0}$. The window contains $N_{\\text{win}} = \\max(N_{\\min}, \\lfloor \\alpha \\cdot 2^L \\rfloor)$ eigenstates whose energies $\\{E_n\\}$ are closest to $E_0$.\n$$\n\\langle A \\rangle_{\\text{micro}} = \\frac{1}{N_{\\text{win}}} \\sum_{n \\in \\text{window}} A_{nn}\n$$\n\n### 6. ETH Verification\nThe ETH predicts that for a generic nonintegrable system, the long-time average of a local observable for a single initial state should match the microcanonical prediction at the corresponding energy. The verification is a direct check of whether the absolute difference between these two computed quantities is bounded by a system-size-dependent tolerance:\n$$\n|\\overline{\\langle A \\rangle} - \\langle A \\rangle_{\\text{micro}}| \\leq \\epsilon(L) = \\frac{\\kappa}{\\sqrt{D}}\n$$\nThe algorithm implements these steps to compute the boolean outcome for each test case.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef build_hamiltonian(L, J, Delta, J_2, g, W, seed):\n    \"\"\"\n    Constructs the Hamiltonian matrix based on the problem specification.\n    The summation in the Hamiltonian is interpreted literally over each site index i.\n    \"\"\"\n    dim = 2**L\n    H = np.zeros((dim, dim), dtype=np.float64)\n\n    # Generate random on-site fields h_i\n    rng = np.random.default_rng(seed)\n    h_fields = rng.uniform(-W, W, L)\n\n    # Iterate through each basis state k (column of the matrix) to build H|k>\n    for k in range(dim):\n        # The total value to add to each matrix element is calculated by summing\n        # contributions from each term in the Hamiltonian's sum over i.\n        \n        # Diagonal terms\n        diag_val = 0.0\n        for i in range(L):\n            spin_i = 1.0 - 2.0 * ((k >> i) & 1)\n            # On-site field term\n            diag_val += h_fields[i] * spin_i\n            \n            # Nearest-neighbor ZZ interaction\n            j1 = (i + 1) % L\n            spin_j1 = 1.0 - 2.0 * ((k >> j1) & 1)\n            diag_val += J * Delta * spin_i * spin_j1\n            \n            # Next-nearest-neighbor ZZ interaction\n            j2 = (i + 2) % L\n            spin_j2 = 1.0 - 2.0 * ((k >> j2) & 1)\n            diag_val += J_2 * Delta * spin_i * spin_j2\n        H[k, k] = diag_val\n\n        # Off-diagonal terms\n        for i in range(L):\n            # Transverse field term g * sigma_i^x\n            m_g = k ^ (1 << i)\n            H[m_g, k] += g\n\n            # NN XY term J * (sigma_i^x sigma_{i+1}^x + sigma_i^y sigma_{i+1}^y)\n            j1 = (i + 1) % L\n            b_i = (k >> i) & 1\n            b_j1 = (k >> j1) & 1\n            if b_i != b_j1:\n                # This term connects states differing by two spin flips\n                m_J = k ^ (1 << i) ^ (1 << j1)\n                H[m_J, k] += 2.0 * J\n            \n            # NNN XY term J2 * (sigma_i^x sigma_{i+2}^x + sigma_i^y sigma_{i+2}^y)\n            j2 = (i + 2) % L\n            b_j2 = (k >> j2) & 1\n            if b_i != b_j2:\n                m_J2 = k ^ (1 << i) ^ (1 << j2)\n                H[m_J2, k] += 2.0 * J_2\n                \n    return H\n\ndef solve_case(L, J, Delta, J_2, g, W, seed, alpha, N_min, l, kappa, b):\n    \"\"\"\n    Performs the full exact diagonalization and ETH verification for a single test case.\n    \"\"\"\n    dim = 2**L\n\n    # 1. Construct the Hamiltonian matrix\n    H = build_hamiltonian(L, J, Delta, J_2, g, W, seed)\n\n    # 2. Diagonalize H to find eigenvalues and eigenvectors\n    evals, evecs = np.linalg.eigh(H)\n\n    # 3. Define the initial state |psi_0> from the binary string b\n    # The string char b[i] corresponds to site i, which is bit position i (little-endian)\n    k0 = sum(int(b[i]) * (2**i) for i in range(L))\n\n    # 4. Calculate the energy of the initial state\n    E0 = H[k0, k0]\n\n    # 5. Compute the diagonal matrix elements of the observable A = sigma_l^z\n    # First, get the diagonal of A in the computational basis\n    A_diag_computational = 1.0 - 2.0 * ((np.arange(dim) >> l) & 1)\n    \n    # Then, transform to the energy eigenbasis: A_nn = <E_n|A|E_n>\n    # Note: evecs are real, so abs() is not needed for |<E_n|k>|^2\n    Ann = np.sum(evecs**2 * A_diag_computational[:, np.newaxis], axis=0)\n\n    # 6. Compute the long-time average (diagonal ensemble prediction)\n    # The expansion coefficients are c_n = <E_n|psi_0> = <E_n|k0>\n    cn_sq = evecs[k0, :]**2\n    diag_avg = np.sum(cn_sq * Ann)\n\n    # 7. Compute the microcanonical average\n    N_win = max(N_min, int(alpha * dim))\n    energy_diffs = np.abs(evals - E0)\n    win_indices = np.argsort(energy_diffs)[:N_win]\n    micro_avg = np.mean(Ann[win_indices])\n\n    # 8. Verify the ETH condition\n    tolerance = kappa / np.sqrt(dim)\n    diff = np.abs(diag_avg - micro_avg)\n    eth_holds = diff <= tolerance\n\n    return eth_holds\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (8, 1.0, 1.2, 0.5, 0.7, 0.8, 31415, 0.04, 10, 3, 1.0, \"10101010\"),\n        (10, 1.0, 1.0, 0.3, 0.9, 1.0, 2023, 0.03, 10, 5, 1.0, \"1001011001\"),\n        (6, 1.0, 1.1, 0.4, 0.5, 0.5, 7, 0.08, 10, 2, 1.0, \"000000\"),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, J, Delta, J_2, g, W, seed, alpha, N_min, l, kappa, b = case\n        result = solve_case(L, J, Delta, J_2, g, W, seed, alpha, N_min, l, kappa, b)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2984456"}]}