{
    "hands_on_practices": [
        {
            "introduction": "在设计一项临床试验时，一个核心的实际问题是：“我们需要多少参与者才能可靠地检测出预期的效果？”样本量不足可能导致试验无法得出确切结论，而样本量过大则会浪费资源并带来不必要的伦理问题。本练习  深入探讨了功效分析的统计学基础，要求您推导并应用样本量计算公式。掌握这项技能对于设计稳健且高效的实验研究至关重要。",
            "id": "4980114",
            "problem": "一个临床研究团队计划进行一项个体随机、平行组优效性试验（一种实验性研究），旨在比较一项新干预措施与常规护理在固定随访时间观察到的二元临床终点上的效果。设干预组的真实事件概率为 $p_{1}$，对照组的真实事件概率为 $p_{0}$。主要分析在 I 型错误率 $\\alpha$ 下，采用大样本评分检验，检验原假设 $H_{0}: p_{1} = p_{0}$ 与双侧备择假设 $H_{1}: p_{1} \\neq p_{0}$。研究采用等量分配，每组 $n$ 名患者。该研究的统计功效设定为以 $1 - \\beta$ 的功效检测出预设的差异 $\\Delta = p_{1} - p_{0} > 0$。\n\n从每组独立结果的二项分布模型出发，根据中心极限定理（CLT），样本比例之差近似服从正态分布。以此为基础，推导每组的样本量 $n$ 的计算公式，以确保在I型错误率 $\\alpha$ 下，双侧评分检验检测出差异 $\\Delta$ 的功效至少为 $1 - \\beta$。你的推导必须从中心极限定理所蕴含的分布近似以及适用于评分检验的原假设和备择假设下的方差开始，然后通过代数方法求解 $n$，使其表示为 $p_{0}$、$p_{1}$、$\\alpha$ 和 $\\beta$ 的函数。用 $\\Phi$ 表示标准正态分布（SND）的累积分布函数，用 $\\Phi^{-1}$ 表示其分位数函数。\n\n然后，使用你推导的表达式，计算当 $p_{1} = 0.30$、$p_{0} = 0.20$、$\\alpha = 0.05$（双侧）和功效为 $0.80$ 时所需的每组样本量。报告能够达到目标功效的最小整数总样本量 $N_{\\text{total}} = 2n$。不要使用百分号；所有概率都用小数表示。",
            "solution": "该问题是有效的，因为它具有科学依据、内容自洽，并且在临床试验的统计假设检验的既定框架内提法明确。\n\n我们首先正式定义问题的各个组成部分。设 $X_1$ 和 $X_0$ 分别为干预组和对照组的事件数。在指定模型下，它们是独立的随机变量，服从二项分布：$X_1 \\sim \\text{Binomial}(n, p_1)$ 和 $X_0 \\sim \\text{Binomial}(n, p_0)$。相应的样本比例为 $\\hat{p}_1 = X_1/n$ 和 $\\hat{p}_0 = X_0/n$。原假设和备择假设分别为 $H_0: p_1 = p_0$ 和 $H_1: p_1 \\neq p_0$。\n\n评分检验基于在原假设下评估的检验统计量。在 $H_0$ 下，存在一个共同的事件概率，记为 $p$，该概率通过合并比例进行估计：\n$$\n\\hat{p}_{\\text{pool}} = \\frac{X_1 + X_0}{n + n} = \\frac{\\hat{p}_1 + \\hat{p}_0}{2}\n$$\n在 $H_0$ 为真的假设下，比例差 $\\hat{p}_1 - \\hat{p}_0$ 的方差为 $\\text{Var}(\\hat{p}_1 - \\hat{p}_0 | H_0) = \\frac{p(1-p)}{n} + \\frac{p(1-p)}{n} = \\frac{2p(1-p)}{n}$。评分检验统计量使用基于 $\\hat{p}_{\\text{pool}}$ 的方差估计值来标准化观察到的差异：\n$$\nZ_{\\text{score}} = \\frac{\\hat{p}_1 - \\hat{p}_0}{\\sqrt{\\frac{2\\hat{p}_{\\text{pool}}(1-\\hat{p}_{\\text{pool}})}{n}}}\n$$\n在 $H_0$ 下，$Z_{\\text{score}}$ 近似服从标准正态分布 $N(0,1)$。对于I型错误率为 $\\alpha$ 的双侧检验，如果 $|Z_{\\text{score}}| > \\Phi^{-1}(1 - \\alpha/2)$，我们就拒绝 $H_0$，其中 $\\Phi^{-1}$ 是标准正态分布的分位数函数。\n\n功效是在备择假设 $H_1$ 为真时正确拒绝 $H_0$ 的概率。为了规划样本量，我们考虑真实概率为 $p_1$ 和 $p_0$ 的特定备择假设。我们要求功效至少为 $1-\\beta$。在 $H_1$ 下，$\\hat{p}_{\\text{pool}}$ 的期望值为 $E[\\hat{p}_{\\text{pool}}] = \\frac{p_1+p_0}{2}$。我们用 $\\bar{p} = \\frac{p_1+p_0}{2}$ 表示这个平均概率。对于大的 $n$，$\\hat{p}_{\\text{pool}}$ 将接近 $\\bar{p}$。因此，为了计算功效，我们使用 $\\bar{p}$ 而不是随机变量 $\\hat{p}_{\\text{pool}}$ 来近似评分统计量的分母。\n\n因此，拒绝规则近似为：\n$$\n\\left| \\frac{\\hat{p}_1 - \\hat{p}_0}{\\sqrt{\\frac{2\\bar{p}(1-\\bar{p})}{n}}} \\right| > \\Phi^{-1}(1 - \\alpha/2)\n$$\n我们设计此项研究是为了检测差异 $\\Delta = p_1 - p_0 > 0$。在这种情况下，功效主要由拒绝域的上尾决定。功效约等于：\n$$\n\\text{Power} = P\\left( \\frac{\\hat{p}_1 - \\hat{p}_0}{\\sqrt{\\frac{2\\bar{p}(1-\\bar{p})}{n}}} > \\Phi^{-1}(1 - \\alpha/2) \\;\\middle|\\; H_1 \\right) = 1-\\beta\n$$\n这等价于：\n$$\nP\\left( \\hat{p}_1 - \\hat{p}_0 > \\Phi^{-1}(1 - \\alpha/2) \\sqrt{\\frac{2\\bar{p}(1-\\bar{p})}{n}} \\;\\middle|\\; H_1 \\right) = 1-\\beta\n$$\n为了评估这个概率，我们必须使用其在 $H_1$ 下的真实分布来标准化随机变量 $\\hat{p}_1 - \\hat{p}_0$。根据中心极限定理，$\\hat{p}_1 - \\hat{p}_0$ 近似服从正态分布，其均值为 $E[\\hat{p}_1 - \\hat{p}_0] = p_1 - p_0$，方差为 $\\text{Var}(\\hat{p}_1 - \\hat{p}_0) = \\text{Var}(\\hat{p}_1) + \\text{Var}(\\hat{p}_0) = \\frac{p_1(1-p_1)}{n} + \\frac{p_0(1-p_0)}{n}$。\n\n设 $Z$ 为一个标准正态随机变量。对不等式进行标准化可得：\n$$\nP\\left( \\frac{(\\hat{p}_1 - \\hat{p}_0) - (p_1-p_0)}{\\sqrt{\\frac{p_1(1-p_1) + p_0(1-p_0)}{n}}} > \\frac{\\Phi^{-1}(1 - \\alpha/2)\\sqrt{\\frac{2\\bar{p}(1-\\bar{p})}{n}} - (p_1-p_0)}{\\sqrt{\\frac{p_1(1-p_1) + p_0(1-p_0)}{n}}} \\right) = 1-\\beta\n$$\n左侧是 $P(Z > \\text{某个值})$。为了使这个概率等于 $1-\\beta$，括号内的参数必须等于 $\\Phi^{-1}(\\beta) = -\\Phi^{-1}(1-\\beta)$。\n$$\n\\frac{\\Phi^{-1}(1 - \\alpha/2)\\sqrt{2\\bar{p}(1-\\bar{p})}\\frac{1}{\\sqrt{n}} - (p_1-p_0)}{\\sqrt{p_1(1-p_1) + p_0(1-p_0)}\\frac{1}{\\sqrt{n}}} = -\\Phi^{-1}(1-\\beta)\n$$\n各项乘以 $\\sqrt{n}$ 并重新整理可得：\n$$\n\\Phi^{-1}(1 - \\alpha/2)\\sqrt{2\\bar{p}(1-\\bar{p})} - \\sqrt{n}(p_1-p_0) = -\\Phi^{-1}(1-\\beta)\\sqrt{p_1(1-p_1) + p_0(1-p_0)}\n$$\n现在，我们求解 $\\sqrt{n}$：\n$$\n\\sqrt{n}(p_1-p_0) = \\Phi^{-1}(1 - \\alpha/2)\\sqrt{2\\bar{p}(1-\\bar{p})} + \\Phi^{-1}(1-\\beta)\\sqrt{p_1(1-p_1) + p_0(1-p_0)}\n$$\n$$\n\\sqrt{n} = \\frac{\\Phi^{-1}(1 - \\alpha/2)\\sqrt{2\\bar{p}(1-\\bar{p})} + \\Phi^{-1}(1-\\beta)\\sqrt{p_1(1-p_1) + p_0(1-p_0)}}{p_1-p_0}\n$$\n两边平方，得到每组样本量 $n$ 的最终表达式：\n$$\nn = \\frac{\\left( \\Phi^{-1}(1 - \\alpha/2)\\sqrt{2\\bar{p}(1-\\bar{p})} + \\Phi^{-1}(1-\\beta)\\sqrt{p_1(1-p_1) + p_0(1-p_0)} \\right)^2}{(p_1-p_0)^2}\n$$\n其中 $\\bar{p} = (p_0+p_1)/2$。\n\n我们现在根据给定的参数计算所需的样本量：$p_1 = 0.30$，$p_0 = 0.20$，$\\alpha = 0.05$，功效 $1-\\beta = 0.80$。\n这意味着 $\\beta = 0.20$。效应量为 $\\Delta = p_1 - p_0 = 0.10$。\n所需的标准正态分布分位数为：\n$$\n\\Phi^{-1}(1 - \\alpha/2) = \\Phi^{-1}(1 - 0.05/2) = \\Phi^{-1}(0.975) \\approx 1.95996\n$$\n$$\n\\Phi^{-1}(1-\\beta) = \\Phi^{-1}(1-0.20) = \\Phi^{-1}(0.80) \\approx 0.84162\n$$\n接下来，我们计算方差分量。平均比例 $\\bar{p}$ 为：\n$$\n\\bar{p} = \\frac{0.20 + 0.30}{2} = 0.25\n$$\n对应于评分检验原假设结构的方差项为：\n$$\n2\\bar{p}(1-\\bar{p}) = 2(0.25)(1-0.25) = 2(0.25)(0.75) = 0.375\n$$\n对应于备择假设下真实分布的方差项为：\n$$\np_1(1-p_1) + p_0(1-p_0) = 0.30(0.70) + 0.20(0.80) = 0.21 + 0.16 = 0.37\n$$\n将这些值代入推导出的 $n$ 的公式中：\n$$\nn = \\frac{\\left( 1.95996 \\sqrt{0.375} + 0.84162 \\sqrt{0.37} \\right)^2}{(0.10)^2}\n$$\n$$\nn \\approx \\frac{\\left( 1.95996 \\times 0.61237 + 0.84162 \\times 0.60828 \\right)^2}{0.01}\n$$\n$$\nn \\approx \\frac{\\left( 1.20023 + 0.51194 \\right)^2}{0.01} = \\frac{(1.71217)^2}{0.01} \\approx \\frac{2.93153}{0.01} \\approx 293.153\n$$\n由于样本量必须是整数，我们对该值向上取整，以确保功效至少为 $0.80$。\n$$\nn = \\lceil 293.153 \\rceil = 294\n$$\n这是每组所需的样本量。总样本量为 $N_{\\text{total}} = 2n$。\n$$\nN_{\\text{total}} = 2 \\times 294 = 588\n$$\n因此，达到目标功效的最小总样本量为 $588$。",
            "answer": "$$\\boxed{588}$$"
        },
        {
            "introduction": "当无法进行随机化时，我们依赖于观察性研究，但这类研究极易受到混杂因素的干扰。匹配是一种重要的研究设计策略，旨在通过在病例和对照之间平衡已知的混杂因素来控制其影响。本练习  聚焦于匹配病例对照研究，您将通过推导条件优势比（conditional odds ratio）来揭示其分析原理。您会发现，通过对匹配对进行条件化分析，我们不仅能有效控制混杂，而且只有那些在暴露状态上不一致的“不和谐”匹配对才对效应估计有贡献。",
            "id": "4980052",
            "problem": "一项基于医院的研究采用 $1{:}1$ 匹配病例对照设计，旨在探究二元暴露 $X \\in \\{0,1\\}$（例如，近期是否使用某种特定药物的指标）与一种罕见疾病 $Y \\in \\{0,1\\}$ 之间的关联。匹配根据年龄、性别和医院科室进行，以控制混杂因素，每个匹配层（对）恰好包含一个病例 $(Y=1)$ 和一个对照 $(Y=0)$。假设有 $M$ 个匹配对，索引为 $j=1,\\dots,M$。在每对 $j$ 中，病例和对照的暴露指标分别表示为 $X_{j1}$ 和 $X_{j0}$。\n\n假设一个标准的条件逻辑斯谛回归模型，用于带有特定截距的匹配对，即：\n$$\n\\Pr(Y_{ji}=1 \\mid X_{ji}, \\alpha_j) = \\frac{\\exp(\\alpha_j + \\beta X_{ji})}{1 + \\exp(\\alpha_j + \\beta X_{ji})},\n$$\n对于 $i \\in \\{0,1\\}$，其中 $\\alpha_j$ 捕捉了特定于对的基线风险，$\\beta$ 是暴露 $X$ 对疾病 $Y$ 影响的对数优势比参数。在此设定下，并以观察到的匹配结构（每对中恰好一个病例和一个对照）为条件，一个匹配对的条件似然贡献仅取决于其暴露是否不一致 $(X_{j1} \\neq X_{j0})$ 或一致 $(X_{j1} = X_{j0})$。\n\n一项匹配病例对照研究共纳入 $M=200$ 对。其中，$60$ 对为暴露不一致对，其模式为 $(X_{j1}=1, X_{j0}=0)$；$40$ 对为暴露不一致对，其模式为 $(X_{j1}=0, X_{j0}=1)$。其余配对的暴露情况是一致的。基于上述模型所蕴含的条件似然以及优势和优势比的基本定义，请用暴露不一致对的数量来推导优势比 $\\exp(\\beta)$ 的条件最大似然估计量，然后使用所提供的数据计算其值。请将最终答案表示为一个实数，无需四舍五-入。",
            "solution": "该问题要求在 $1{:}1$ 匹配病例对照研究中，推导优势比 $\\exp(\\beta)$ 的条件最大似然估计量（MLE），并进行后续计算。\n\n分析匹配对数据的关键在于构建一个能够消除特定于层的滋扰参数 $\\alpha_j$ 的条件似然。对于每一对 $j$，我们以“该对中恰好有一个病例和一个对照”以及“观察到该对中两个个体的暴露情况 ($X_{j1}$ 和 $X_{j0}$)”为条件。\n\n在给定一对中一个是病例、一个是-对照，且他们的暴露情况是 $X_{j1}$ 和 $X_{j0}$ 的条件下，暴露为 $X_{j1}$ 的个体是病例的条件概率为：\n$$\n\\Pr(\\text{暴露为 } X_{j1} \\text{ 的个体是病例} \\mid \\text{第 } j \\text{ 对数据}) = \\frac{\\exp(\\alpha_j + \\beta X_{j1})}{\\exp(\\alpha_j + \\beta X_{j1}) + \\exp(\\alpha_j + \\beta X_{j0})}\n$$\n通过提出公因子 $\\exp(\\alpha_j)$，滋扰参数被消除：\n$$\n\\frac{\\exp(\\alpha_j) \\exp(\\beta X_{j1})}{\\exp(\\alpha_j) (\\exp(\\beta X_{j1}) + \\exp(\\beta X_{j0}))} = \\frac{\\exp(\\beta X_{j1})}{\\exp(\\beta X_{j1}) + \\exp(\\beta X_{j0})}\n$$\n这就是第 $j$ 对对条件似然的贡献 $L_j(\\beta)$。\n\n总条件似然 $L(\\beta)$ 是所有 $M$ 对的这些贡献的乘积。我们根据对内暴露的一致性或不一致性来分析这些贡献。\n\n1.  **暴露一致对：** 当病例和对照的暴露状态相同时（$X_{j1} = X_{j0}$），似然贡献为 $L_j(\\beta) = \\frac{1}{2}$。这个常数不包含 $\\beta$，因此暴露一致对对于估计 $\\beta$ 不提供任何信息。\n\n2.  **暴露不一致对：** 当病例和对照的暴露状态不同时，这些配对才对估计有贡献。\n    -   对于病例暴露、对照未暴露（$X_{j1}=1, X_{j0}=0$）的 $n_{10}$ 对，其贡献是 $L_j(\\beta) = \\frac{\\exp(\\beta)}{1 + \\exp(\\beta)}$。\n    -   对于病例未暴露、对照暴露（$X_{j1}=0, X_{j0}=1$）的 $n_{01}$ 对，其贡献是 $L_j(\\beta) = \\frac{1}{1 + \\exp(\\beta)}$。\n\n因此，总条件似然函数仅为来自不一致对的贡献的乘积：\n$$\nL(\\beta) \\propto \\left( \\frac{\\exp(\\beta)}{1 + \\exp(\\beta)} \\right)^{n_{10}} \\left( \\frac{1}{1 + \\exp(\\beta)} \\right)^{n_{01}}\n$$\n对数似然函数为：\n$$\n\\ell(\\beta) = n_{10}\\beta - (n_{10} + n_{01}) \\ln(1 + \\exp(\\beta))\n$$\n将 $\\ell(\\beta)$ 对 $\\beta$ 求导并设为零以求得最大似然估计量 $\\hat{\\beta}$：\n$$\n\\frac{d\\ell}{d\\beta} = n_{10} - (n_{10} + n_{01}) \\frac{\\exp(\\beta)}{1 + \\exp(\\beta)} = 0\n$$\n整理后得到：\n$$\nn_{10} = n_{01} \\exp(\\hat{\\beta})\n$$\n求解 $\\exp(\\hat{\\beta})$，即优势比（OR）的最大似然估计量，我们得到：\n$$\n\\exp(\\hat{\\beta}) = \\frac{n_{10}}{n_{01}}\n$$\n这个结果表明，条件优势比的估计量就是两种不一致对（discordant pairs）数量的比值。\n\n根据问题提供的数据：\n-   病例暴露而对照未暴露的配对数量：$n_{10} = 60$。\n-   病例未暴露而对照暴露的配对数量：$n_{01} = 40$。\n\n代入公式计算优势比的估计值：\n$$\n\\widehat{OR} = \\exp(\\hat{\\beta}) = \\frac{60}{40} = 1.5\n$$\n因此，优势比的条件最大似然估计值为 $1.5$。",
            "answer": "$$\n\\boxed{1.5}\n$$"
        }
    ]
}