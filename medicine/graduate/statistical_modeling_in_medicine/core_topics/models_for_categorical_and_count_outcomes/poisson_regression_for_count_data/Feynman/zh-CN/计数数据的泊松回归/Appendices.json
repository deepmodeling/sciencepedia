{
    "hands_on_practices": [
        {
            "introduction": "应用任何统计模型的第一步是理解其参数如何从数据中估计得出。本练习将为一个基础的泊松回归模型揭开最大似然估计的神秘面纱。通过解决一个常见场景——比较两个具有不同随访时间的组别的率——你将发现估计的率比（rate ratio）可以简化为一个非常直观的结果，从而将抽象的理论与实际计算直接联系起来。",
            "id": "4826677",
            "problem": "您将获得来自两个暴露组患者的独立计数结果及其随访时间。假设在给定暴露和随访时间的条件下，每位患者的计数来自泊松分布，其均值等于一个率乘以随访时间。将患者 $i$ 的预期计数建模为\n$$\nE[Y_i \\mid X_i, T_i] \\;=\\; \\mu_i \\;=\\; T_i \\, \\exp\\big(\\beta_0 + \\beta_1 X_i\\big),\n$$\n其中 $Y_i$ 是观测到的计数，$X_i \\in \\{0,1\\}$ 是暴露指示符（$X_i=0$ 表示未暴露，$X_i=1$ 表示暴露），$T_i > 0$ 是随访时间。这是一个泊松对数线性模型，其偏移量等于自然对数 $\\log(T_i)$。参数 $\\exp(\\beta_1)$ 是比较暴露组与未暴露组的率比。\n\n从独立观测的泊松似然的基本定义和带偏移量的对数线性模型出发，计算以下每个测试用例中率比 $\\exp(\\beta_1)$ 的最大似然估计。您必须严格按照规定使用泊松模型和偏移量。自然对数 $\\log$ 以 $e$ 为底。\n\n测试套件。对于每个用例，数据以三个对齐的列表形式给出：计数 $Y$、暴露指示符 $X$ 和随访时间 $T$（单位为人年）。所有的 $T_i$ 都严格为正；所有的 $Y_i$ 都是非负整数。\n\n- 用例 A：\n  - $Y = [2, 1, 0, 3, 4, 2, 1, 6]$\n  - $X = [0, 0, 0, 0, 1, 1, 1, 1]$\n  - $T = [1.2, 0.8, 1.0, 2.0, 1.0, 1.5, 0.5, 2.0]$\n\n- 用例 B：\n  - $Y = [0, 1, 8, 0, 0, 15]$\n  - $X = [0, 0, 0, 1, 1, 1]$\n  - $T = [0.2, 0.3, 5.0, 0.1, 0.4, 4.0]$\n\n- 用例 C：\n  - $Y = [0, 1, 0, 0, 1, 0, 1, 0]$\n  - $X = [0, 0, 0, 0, 1, 1, 1, 1]$\n  - $T = [5.0, 10.0, 8.0, 7.0, 4.0, 9.0, 6.0, 8.0]$\n\n- 用例 D：\n  - $Y = [40, 60, 70, 50]$\n  - $X = [0, 0, 1, 1]$\n  - $T = [2.0, 3.0, 1.0, 4.0]$\n\n科学和建模假设。假设独立的泊松计数具有指定的均值，并使用标准对数连接函数，偏移量等于 $\\log(T_i)$。解法必须基于在此模型下最大化泊松对数似然。\n\n任务。编写一个完整的、可运行的程序，对于每个用例，使用偏移量 $\\log(T_i)$ 拟合包含截距和单个暴露指示符的泊松回归模型，并返回率比 $\\exp(\\beta_1)$ 的最大似然估计。\n\n要求的最终输出格式。您的程序应生成单行输出，其中包含四个估计的率比，按用例 A、用例 B、用例 C、用例 D 的顺序排列，形式为一个用方括号括起来的逗号分隔列表，每个值都四舍五入到六位小数（例如，[1.234567, 2.345678, 3.456789, 4.567890]）。",
            "solution": "该问题是有效的。这是一个统计推断中的标准、适定的问题，具体来说是泊松对数线性模型的最大似然估计，这是一种广义线性模型（GLM）。该问题有科学依据、是客观的，并为获得唯一解提供了所有必要信息。\n\n目标是为一个泊松回归模型求出率比 $\\exp(\\beta_1)$ 的最大似然估计（MLE）。该模型指定对于患者 $i$，观测计数 $Y_i$ 服从均值为 $\\mu_i$ 的泊松分布，其中均值通过以下方式与协变量相关：\n$$\n\\mu_i = E[Y_i \\mid X_i, T_i] = T_i \\exp(\\beta_0 + \\beta_1 X_i)\n$$\n此处，$Y_i$ 是计数，$X_i \\in \\{0, 1\\}$ 是暴露状态，$T_i > 0$ 是随访时间。对两边取自然对数，揭示了带有偏移项的底层线性模型：\n$$\n\\log(\\mu_i) = \\beta_0 + \\beta_1 X_i + \\log(T_i)\n$$\n其中 $\\log(T_i)$ 是偏移量。\n\nMLE 是通过最大化对数似然函数找到的。对于一组 $N$ 个独立观测 $(y_i, x_i, t_i)$，单个观测的概率质量函数为 $P(Y_i = y_i) = \\mu_i^{y_i} e^{-\\mu_i} / y_i!$。似然函数是这些概率的乘积：\n$$\nL(\\beta_0, \\beta_1) = \\prod_{i=1}^{N} \\frac{\\mu_i^{y_i} e^{-\\mu_i}}{y_i!}\n$$\n对数似然函数 $\\ell(\\beta_0, \\beta_1) = \\log L(\\beta_0, \\beta_1)$ 是：\n$$\n\\ell(\\beta_0, \\beta_1) = \\sum_{i=1}^{N} \\left( y_i \\log(\\mu_i) - \\mu_i - \\log(y_i!) \\right)\n$$\n为了关于参数 $\\beta_0$ 和 $\\beta_1$ 最大化此函数，我们可以忽略 $\\log(y_i!)$ 项，因为它不依赖于这些参数。代入 $\\log(\\mu_i) = \\log(t_i) + \\beta_0 + \\beta_1 x_i$，对数似然函数的相关部分 $\\ell^*$ 变为：\n$$\n\\ell^*(\\beta_0, \\beta_1) = \\sum_{i=1}^{N} \\left[ y_i (\\log(t_i) + \\beta_0 + \\beta_1 x_i) - t_i \\exp(\\beta_0 + \\beta_1 x_i) \\right]\n$$\n为求最大值，我们计算 $\\ell^*$ 关于 $\\beta_0$ 和 $\\beta_1$ 的偏导数并令其为零。这些就是得分方程。\n\n1.  关于 $\\beta_0$ 的导数：\n    $$\n    \\frac{\\partial \\ell^*}{\\partial \\beta_0} = \\sum_{i=1}^{N} \\left( y_i - t_i \\exp(\\beta_0 + \\beta_1 x_i) \\right) = \\sum_{i=1}^{N} (y_i - \\mu_i)\n    $$\n2.  关于 $\\beta_1$ 的导数：\n    $$\n    \\frac{\\partial \\ell^*}{\\partial \\beta_1} = \\sum_{i=1}^{N} \\left( y_i x_i - x_i t_i \\exp(\\beta_0 + \\beta_1 x_i) \\right) = \\sum_{i=1}^{N} x_i(y_i - \\mu_i)\n    $$\n将这些设为零，得到方程组：\n$$\n\\sum_{i=1}^{N} (y_i - \\mu_i) = 0 \\quad \\text{and} \\quad \\sum_{i=1}^{N} x_i(y_i - \\mu_i) = 0\n$$\n第二个方程涉及对 $x_i=1$ 的项求和，因为当 $x_i=0$ 时，这些项为零。这得到：\n$$\n\\sum_{i: x_i=1} (y_i - t_i \\exp(\\beta_0 + \\beta_1 \\cdot 1)) = 0\n$$\n$$\n\\sum_{i: x_i=1} y_i = \\exp(\\beta_0 + \\beta_1) \\sum_{i: x_i=1} t_i\n$$\n令 $Y_1 = \\sum_{i: x_i=1} y_i$ 为暴露组的总计数，$T_1 = \\sum_{i: x_i=1} t_i$ 为暴露组的总人时。那么，暴露组中率的 MLE，即 $\\hat{\\lambda}_1 = \\exp(\\hat{\\beta}_0 + \\hat{\\beta}_1)$，为：\n$$\n\\exp(\\hat{\\beta}_0 + \\hat{\\beta}_1) = \\frac{Y_1}{T_1}\n$$\n现在，我们使用第一个得分方程。令 $Y_0 = \\sum_{i: x_i=0} y_i$ 和 $T_0 = \\sum_{i: x_i=0} t_i$。\n$$\n\\sum_{i=1}^N y_i = \\sum_{i=1}^N \\mu_i = \\sum_{i:x_i=0} t_i \\exp(\\beta_0) + \\sum_{i:x_i=1} t_i \\exp(\\beta_0 + \\beta_1)\n$$\n$$\nY_0 + Y_1 = T_0 \\exp(\\beta_0) + T_1 \\exp(\\beta_0 + \\beta_1)\n$$\n代入第二个得分方程的结果 $T_1 \\exp(\\hat{\\beta}_0 + \\hat{\\beta}_1) = Y_1$，我们得到：\n$$\nY_0 + Y_1 = T_0 \\exp(\\hat{\\beta}_0) + Y_1 \\implies Y_0 = T_0 \\exp(\\hat{\\beta}_0)\n$$\n因此，未暴露组中率的 MLE，即 $\\hat{\\lambda}_0 = \\exp(\\hat{\\beta}_0)$，为：\n$$\n\\exp(\\hat{\\beta}_0) = \\frac{Y_0}{T_0}\n$$\n这种简化为闭式解的情况是一个特例，出现的原因是模型的唯一预测变量是单个二元变量。对海森矩阵的分析证实了这些解对应于一个唯一最大值。\n\n我们关注的量是率比 $RR = \\exp(\\beta_1)$。率比的 MLE 是：\n$$\n\\exp(\\hat{\\beta}_1) = \\frac{\\exp(\\hat{\\beta}_0 + \\hat{\\beta}_1)}{\\exp(\\hat{\\beta}_0)} = \\frac{Y_1/T_1}{Y_0/T_0}\n$$\n这个简洁的结果表明，率比的 MLE 就是两个暴露组经验率的比值。该公式将用于计算每个测试用例的结果。由于所有测试用例都满足 $Y_0 > 0$, $Y_1 > 0$, $T_0 > 0$ 和 $T_1 > 0$（注：部分用例 $Y_1$ 或 $Y_0$ 可能为0，但本题数据避免了此情况），因此 MLE 是有明确定义的且为正。\n\n每个用例的计算过程如下：\n1.  对未暴露组（$X=0$）分别对计数（$Y$）和人时（$T$）求和，得到 $Y_0$ 和 $T_0$。\n2.  对暴露组（$X=1$）分别对计数（$Y$）和人时（$T$）求和，得到 $Y_1$ 和 $T_1$。\n3.  使用推导出的公式 $\\exp(\\hat{\\beta}_1) = (Y_1/T_1) / (Y_0/T_0)$ 计算率比。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum likelihood estimate of the rate ratio for a Poisson\n    log-linear model for several test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A\n        (\n            np.array([2, 1, 0, 3, 4, 2, 1, 6], dtype=np.float64),\n            np.array([0, 0, 0, 0, 1, 1, 1, 1], dtype=np.int64),\n            np.array([1.2, 0.8, 1.0, 2.0, 1.0, 1.5, 0.5, 2.0], dtype=np.float64),\n        ),\n        # Case B\n        (\n            np.array([0, 1, 8, 0, 0, 15], dtype=np.float64),\n            np.array([0, 0, 0, 1, 1, 1], dtype=np.int64),\n            np.array([0.2, 0.3, 5.0, 0.1, 0.4, 4.0], dtype=np.float64),\n        ),\n        # Case C\n        (\n            np.array([0, 1, 0, 0, 1, 0, 1, 0], dtype=np.float64),\n            np.array([0, 0, 0, 0, 1, 1, 1, 1], dtype=np.int64),\n            np.array([5.0, 10.0, 8.0, 7.0, 4.0, 9.0, 6.0, 8.0], dtype=np.float64),\n        ),\n        # Case D\n        (\n            np.array([40, 60, 70, 50], dtype=np.float64),\n            np.array([0, 0, 1, 1], dtype=np.int64),\n            np.array([2.0, 3.0, 1.0, 4.0], dtype=np.float64),\n        ),\n    ]\n\n    results = []\n    for Y, X, T in test_cases:\n        # The MLE of the rate ratio for a simple binary predictor X is\n        # the ratio of the empirical rates in the two groups (X=1 vs X=0).\n        # Rate = Total Counts / Total Person-Time\n\n        # Select data for the unexposed group (X=0)\n        unexposed_mask = (X == 0)\n        Y_0 = np.sum(Y[unexposed_mask])\n        T_0 = np.sum(T[unexposed_mask])\n        \n        # Select data for the exposed group (X=1)\n        exposed_mask = (X == 1)\n        Y_1 = np.sum(Y[exposed_mask])\n        T_1 = np.sum(T[exposed_mask])\n\n        # Calculate the empirical rates for each group\n        # The problem statement ensures T_0 and T_1 are non-zero.\n        # Handle cases where counts might be zero.\n        rate_0 = Y_0 / T_0 if T_0 > 0 else 0\n        rate_1 = Y_1 / T_1 if T_1 > 0 else 0\n        \n        # The MLE for the rate ratio is the ratio of the empirical rates.\n        # Handle division by zero for rate_0.\n        rate_ratio = rate_1 / rate_0 if rate_0 > 0 else float('inf')\n        results.append(rate_ratio)\n\n    # Final print statement in the exact required format.\n    # Each value is rounded to six decimal places.\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个已拟合模型的真正效用在于我们用它来对新的观测进行预测。本练习将带你从解读估计的系数，进入到为特定个体特征预测事件率并构建预测区间的实际任务中。这个练习将阐明模型参数的不确定性与数据本身固有的随机变异性之间的关键区别，这两者对于做出稳健的预测都至关重要。",
            "id": "4978314",
            "problem": "一项心血管医学领域的多中心队列研究记录了在不同人时暴露下的心肌梗死计数。研究人员使用泊松似然和对数连接函数拟合了一个广义线性模型（GLM）来对事件计数进行建模。对于暴露（人时）为 $E_{i}$、协变量为 $\\mathbf{x}_{i}$、计数为 $Y_{i}$ 的个体或分层 $i$，该模型由满足以下条件的强度参数 $\\mu_{i}$ 指定：\n$$\nY_{i} \\sim \\mathrm{Poisson}(\\mu_{i}), \\quad \\ln(\\mu_{i}) \\;=\\; \\ln(E_{i}) \\;+\\; \\mathbf{x}_{i}^{\\top}\\boldsymbol{\\beta},\n$$\n因此，每人年的发生率为 $\\lambda_{i} \\equiv \\mu_{i}/E_{i} = \\exp(\\mathbf{x}_{i}^{\\top}\\boldsymbol{\\beta})$。\n\n在汇总数据上拟合的模型提供了最大似然估计 $\\widehat{\\boldsymbol{\\beta}}$ 及其协方差矩阵 $\\widehat{\\mathrm{Var}}(\\widehat{\\boldsymbol{\\beta}})$。考虑协变量向量 $\\mathbf{x}^{\\star} = (1,\\,\\text{age10},\\,\\text{male},\\,\\text{treat})^{\\top}$，其具有以下特征：年龄 $50$ 岁，因此 $\\text{age10} = 5$；男性，因此 $\\text{male} = 1$；未接受治疗，因此 $\\text{treat} = 0$。拟合的系数和协方差矩阵（按 $(\\beta_{0}, \\beta_{1}, \\beta_{2}, \\beta_{3})$ 对应于 $(\\text{Intercept}, \\text{age10}, \\text{male}, \\text{treat})$ 的顺序）为：\n$$\n\\widehat{\\boldsymbol{\\beta}} \\;=\\; \\begin{pmatrix} -4.6 \\\\ 0.15 \\\\ 0.25 \\\\ -0.30 \\end{pmatrix},\n\\qquad\n\\widehat{\\mathrm{Var}}(\\widehat{\\boldsymbol{\\beta}}) \\;=\\;\n\\begin{bmatrix}\n0.0225  -0.0010  0.0005  0.0002 \\\\\n-0.0010  0.0025  -0.0003  0.0001 \\\\\n0.0005  -0.0003  0.0100  0.0002 \\\\\n0.0002  0.0001  0.0002  0.0100\n\\end{bmatrix}.\n$$\n\n任务：\n1. 使用模型定义和给定的估计值，通过明确识别线性预测变量和偏移量，将拟合模型转换为指定协变量特征下每 1000 人年的预测发生率。证明从每人年的发生率到每 1000 人年的计数的转换是合理的。\n2. 从泊松方差属性 $\\mathrm{Var}(Y_{i}\\mid \\mu_{i})=\\mu_{i}$ 和 $\\widehat{\\boldsymbol{\\beta}}$ 的大样本正态性出发，为在协变量特征 $\\mathbf{x}^{\\star}$ 下具有暴露量 $E^{\\star}$ 的新观测值，推导其在发生率尺度上的 95% 预测区间的近似值。您的推导必须在对数发生率尺度上进行，清楚地显示参数不确定性的贡献和泊松抽样变异性的贡献，并且必须使用 delta 方法来证明归因于新观测值的方差项是合理的。\n3. 取 $E^{\\star} = 1000$ 人年，使得“每 1000 人年的发生率”等于 1000 人年内的计数。计算在指定协变量特征下，观测到的每 1000 人年事件数的 95% 预测区间的上端点。将最终数值答案四舍五入至 4 位有效数字。以“每 1000 人年的计数”表示最终结果。",
            "solution": "用户想要解决一个基于统计模型的问题。\n\n这个问题是泊松回归的一个标准应用，泊松回归是一种广泛用于计数数据的统计建模方法，任务定义明确。它要求计算预测率、推导预测区间和最终的数值计算。所提供的数据（系数、协方差矩阵）是一致且足以解决问题的。该问题在统计理论上有科学依据，提问得当且客观。因此，该问题是有效的。\n\n解答分为三部分，对应于问题陈述中的三个任务。\n\n### 1. 指定协变量特征的预测发生率\n\n问题指定了一个泊松广义线性模型（GLM），用于对具有暴露量 $E_{i}$ 和协变量 $\\mathbf{x}_{i}$ 的事件计数 $Y_{i}$ 进行建模。该模型为：\n$$\nY_{i} \\sim \\mathrm{Poisson}(\\mu_{i})\n$$\n$$\n\\ln(\\mu_{i}) = \\ln(E_{i}) + \\mathbf{x}_{i}^{\\top}\\boldsymbol{\\beta}\n$$\n$\\ln(E_{i})$ 项是**偏移量**，它是一个系数固定为1的已知预测变量。$\\eta_{i} = \\mathbf{x}_{i}^{\\top}\\boldsymbol{\\beta}$ 项是**线性预测变量**。连接均值 $\\mu_{i}$ 与线性预测变量和偏移量的连接函数是对数，即对数连接。\n\n每单位暴露（人年）的事件发生率是 $\\lambda_{i} = \\mu_{i}/E_{i}$。对这个定义取对数并代入模型方程可得：\n$$\n\\ln(\\lambda_{i}) = \\ln(\\mu_{i}) - \\ln(E_{i}) = (\\ln(E_{i}) + \\mathbf{x}_{i}^{\\top}\\boldsymbol{\\beta}) - \\ln(E_{i}) = \\mathbf{x}_{i}^{\\top}\\boldsymbol{\\beta}\n$$\n因此，预测的对数发生率等于线性预测变量，预测的发生率是 $\\widehat{\\lambda}_{i} = \\exp(\\mathbf{x}_{i}^{\\top}\\widehat{\\boldsymbol{\\beta}})$。\n\n指定的协变量特征是针对一名 50 岁、男性且未接受治疗的受试者。这对应于：\n- $\\text{age10} = 50/10 = 5$\n- $\\text{male} = 1$\n- $\\text{treat} = 0$\n协变量向量，包括用于截距的 1，是 $\\mathbf{x}^{\\star} = (1, 5, 1, 0)^{\\top}$。\n\n估计的系数向量是 $\\widehat{\\boldsymbol{\\beta}} = (-4.6, 0.15, 0.25, -0.30)^{\\top}$。\n\n该特征的预测线性预测变量是：\n$$\n\\widehat{\\eta}^{\\star} = {\\mathbf{x}^{\\star}}^{\\top}\\widehat{\\boldsymbol{\\beta}} = \\begin{pmatrix} 1  5  1  0 \\end{pmatrix} \\begin{pmatrix} -4.6 \\\\ 0.15 \\\\ 0.25 \\\\ -0.30 \\end{pmatrix}\n$$\n$$\n\\widehat{\\eta}^{\\star} = (1)(-4.6) + (5)(0.15) + (1)(0.25) + (0)(-0.30) = -4.6 + 0.75 + 0.25 = -3.6\n$$\n这是每人年的预测对数发生率。每人年的预测发生率是：\n$$\n\\widehat{\\lambda}^{\\star} = \\exp(\\widehat{\\eta}^{\\star}) = \\exp(-3.6)\n$$\n问题要求的是每 1000 人年的预测发生率。如果每人年的发生率是 $\\widehat{\\lambda}^{\\star}$ 个事件，那么在 1000 人年的暴露期间，预期的事件数是 $1000 \\times \\widehat{\\lambda}^{\\star}$。因此，每 1000 人年的发生率是每人年发生率的 1000 倍。\n$$\n\\text{每 1000 人年的预测发生率} = 1000 \\widehat{\\lambda}^{\\star} = 1000 \\exp(-3.6) \\approx 27.253\n$$\n\n### 2. 95% 预测区间的推导\n\n新观测值的预测区间必须考虑两种不确定性来源：\n1.  **参数不确定性**：模型参数 $\\boldsymbol{\\beta}$ 估计中的不确定性，由 $\\widehat{\\mathrm{Var}}(\\widehat{\\boldsymbol{\\beta}})$ 捕获。\n2.  **抽样变异性**：新观测值的内在随机性，对于泊松模型，这由泊松分布描述。\n\n如建议的那样，推导在对数发生率尺度上进行。设 $Y^{\\star}$ 是一个具有协变量特征 $\\mathbf{x}^{\\star}$ 和暴露量 $E^{\\star}$ 的新观测值。我们建立模型 $Y^{\\star} \\sim \\mathrm{Poisson}(\\mu^{\\star})$，其中 $\\mu^{\\star} = E^{\\star} \\lambda^{\\star}$ 且 $\\ln(\\lambda^{\\star}) = {\\mathbf{x}^{\\star}}^{\\top}\\boldsymbol{\\beta}$。\n\n我们对对数发生率的点预测是 $\\ln(\\widehat{\\lambda}^{\\star}) = {\\mathbf{x}^{\\star}}^{\\top}\\widehat{\\boldsymbol{\\beta}}$。由于最大似然估计 $\\widehat{\\boldsymbol{\\beta}}$ 的大样本正态性，$\\ln(\\widehat{\\lambda}^{\\star})$ 近似服从正态分布。这个预测的方差，源于参数不确定性，是：\n$$\n\\mathrm{Var}(\\ln(\\widehat{\\lambda}^{\\star})) = \\mathrm{Var}({\\mathbf{x}^{\\star}}^{\\top}\\widehat{\\boldsymbol{\\beta}}) = {\\mathbf{x}^{\\star}}^{\\top} \\mathrm{Var}(\\widehat{\\boldsymbol{\\beta}}) \\mathbf{x}^{\\star}\n$$\n这是**参数不确定性的贡献**。\n\n现在，考虑新观测值 $Y^{\\star}$。我们在对数尺度上分析其变异性。让我们将来自这个单一新观测值的“观测”对数发生率定义为 $\\ln(Y^{\\star}/E^{\\star})$。这里的随机性来自 $Y^{\\star}$。我们需要找到 $\\ln(Y^{\\star})$ 的方差。我们使用 delta 方法，该方法将随机变量 $X$ 的函数 $g(X)$ 的方差近似为 $\\mathrm{Var}(g(X)) \\approx [g'(\\mathrm{E}[X])]^2 \\mathrm{Var}(X)$。\n\n这里，随机变量是 $Y^{\\star}$，$g(Y^{\\star})=\\ln(Y^{\\star})$，$\\mathrm{E}[Y^{\\star}] = \\mu^{\\star}$，并且根据泊松属性，$\\mathrm{Var}(Y^{\\star}) = \\mu^{\\star}$。导数是 $g'(y) = 1/y$。应用 delta 方法：\n$$\n\\mathrm{Var}(\\ln(Y^{\\star})) \\approx \\left(\\frac{1}{\\mathrm{E}[Y^{\\star}]}\\right)^2 \\mathrm{Var}(Y^{\\star}) = \\left(\\frac{1}{\\mu^{\\star}}\\right)^2 \\mu^{\\star} = \\frac{1}{\\mu^{\\star}}\n$$\n由于 $\\ln(Y^{\\star}/E^{\\star}) = \\ln(Y^{\\star}) - \\ln(E^{\\star})$ 且 $\\ln(E^{\\star})$ 是一个常数，所以 $\\mathrm{Var}(\\ln(Y^{\\star}/E^{\\star})) = \\mathrm{Var}(\\ln(Y^{\\star})) \\approx 1/\\mu^{\\star}$。这是**泊松抽样变异性的贡献**，已转换到对数发生率尺度。\n\n在对数发生率尺度上的预测误差是新的（随机的）对数发生率与我们预测的对数发生率之间的差。假设新观测值与用于拟合模型的数据无关，则预测误差的方差是两个方差分量之和：\n$$\n\\sigma^2_{\\text{pred}} = \\mathrm{Var}(\\ln(Y^{\\star}/E^{\\star}) - \\ln(\\widehat{\\lambda}^{\\star})) = \\mathrm{Var}(\\ln(Y^{\\star}/E^{\\star})) + \\mathrm{Var}(\\ln(\\widehat{\\lambda}^{\\star})) \\approx \\frac{1}{\\mu^{\\star}} + {\\mathbf{x}^{\\star}}^{\\top} \\mathrm{Var}(\\widehat{\\boldsymbol{\\beta}}) \\mathbf{x}^{\\star}\n$$\n在实践中，我们必须通过代入未知参数的估计值来估计这个方差：\n$$\n\\widehat{\\sigma}^2_{\\text{pred}} = \\frac{1}{\\widehat{\\mu}^{\\star}} + {\\mathbf{x}^{\\star}}^{\\top} \\widehat{\\mathrm{Var}}(\\widehat{\\boldsymbol{\\beta}}) \\mathbf{x}^{\\star} \\quad \\text{其中} \\quad \\widehat{\\mu}^{\\star} = E^{\\star}\\exp({\\mathbf{x}^{\\star}}^{\\top}\\widehat{\\boldsymbol{\\beta}})\n$$\n新观测值对数发生率的近似 95% 预测区间是通过点估计 $\\pm z_{0.975}$ 乘以预测标准误差来构成的：\n$$\n\\text{PI for } \\ln(Y^{\\star}/E^{\\star}): \\quad {\\mathbf{x}^{\\star}}^{\\top}\\widehat{\\boldsymbol{\\beta}} \\pm z_{0.975} \\sqrt{\\widehat{\\sigma}^2_{\\text{pred}}}\n$$\n为了获得计数 $Y^{\\star}$ 的预测区间，我们将端点取指数以获得发生率 $\\lambda^{\\star} = Y^{\\star}/E^{\\star}$ 的区间，然后乘以暴露量 $E^{\\star}$：\n$$\n\\text{PI for } Y^{\\star}: \\quad E^{\\star} \\exp \\left( {\\mathbf{x}^{\\star}}^{\\top}\\widehat{\\boldsymbol{\\beta}} \\pm z_{0.975} \\sqrt{{\\mathbf{x}^{\\star}}^{\\top} \\widehat{\\mathrm{Var}}(\\widehat{\\boldsymbol{\\beta}}) \\mathbf{x}^{\\star} + \\frac{1}{E^{\\star}\\exp({\\mathbf{x}^{\\star}}^{\\top}\\widehat{\\boldsymbol{\\beta}})}} \\right)\n$$\n\n### 3. 预测区间上端点的计算\n\n我们被要求计算指定特征下，暴露量为 $E^{\\star} = 1000$ 人年的事件数的 95% 预测区间的上端点。我们使用 z 分数 $z_{0.975} \\approx 1.96$。\n\n**步骤 1：计算线性预测变量和预测的平均计数。**\n根据第 1 部分，线性预测变量是 $\\widehat{\\eta}^{\\star} = {\\mathbf{x}^{\\star}}^{\\top}\\widehat{\\boldsymbol{\\beta}} = -3.6$。\n预测的平均计数是 $\\widehat{\\mu}^{\\star} = E^{\\star}\\exp(\\widehat{\\eta}^{\\star}) = 1000\\exp(-3.6)$。\n\n**步骤 2：计算源于参数不确定性的方差。**\n这是二次型 ${\\mathbf{x}^{\\star}}^{\\top} \\widehat{\\mathrm{Var}}(\\widehat{\\boldsymbol{\\beta}}) \\mathbf{x}^{\\star}$，其中 $\\mathbf{x}^{\\star} = (1, 5, 1, 0)^{\\top}$ 且 $V = \\widehat{\\mathrm{Var}}(\\widehat{\\boldsymbol{\\beta}})$。\n$$\n{\\mathbf{x}^{\\star}}^{\\top} V \\mathbf{x}^{\\star} = \\sum_{j=0}^{3}\\sum_{k=0}^{3} x_j x_k V_{jk}\n$$\n由于 $x_3=0$，我们只需要 $V$ 的左上角 $3 \\times 3$ 子矩阵。\n\\begin{align*}\n{\\mathbf{x}^{\\star}}^{\\top} V \\mathbf{x}^{\\star} = (1)^2 V_{00} + (5)^2 V_{11} + (1)^2 V_{22} + 2(1)(5)V_{01} + 2(1)(1)V_{02} + 2(5)(1)V_{12} \\\\\n= (1)(0.0225) + (25)(0.0025) + (1)(0.0100) + (10)(-0.0010) + (2)(0.0005) + (10)(-0.0003) \\\\\n= 0.0225 + 0.0625 + 0.0100 - 0.0100 + 0.0010 - 0.0030 \\\\\n= 0.0850 - 0.0020 = 0.0830\n\\end{align*}\n\n**步骤 3：计算总预测方差。**\n来自抽样变异性的方差分量是 $1/\\widehat{\\mu}^{\\star} = 1/(1000\\exp(-3.6)) = \\exp(3.6)/1000$。\n$$\n\\widehat{\\sigma}^2_{\\text{pred}} = {\\mathbf{x}^{\\star}}^{\\top} \\widehat{\\mathrm{Var}}(\\widehat{\\boldsymbol{\\beta}}) \\mathbf{x}^{\\star} + \\frac{1}{\\widehat{\\mu}^{\\star}} = 0.0830 + \\frac{\\exp(3.6)}{1000}\n$$\n数值上，$\\exp(3.6) \\approx 36.59823$。\n$$\n\\widehat{\\sigma}^2_{\\text{pred}} \\approx 0.0830 + \\frac{36.59823}{1000} = 0.0830 + 0.03659823 = 0.11959823\n$$\n预测的标准误差是 $\\widehat{\\sigma}_{\\text{pred}} = \\sqrt{0.11959823} \\approx 0.3458298$。\n\n**步骤 4：计算预测区间的上端点。**\n计数 $Y^{\\star}$ 的上端点由下式给出：\n$$\nY^{\\star}_{\\text{upper}} = E^{\\star} \\exp(\\widehat{\\eta}^{\\star} + z_{0.975} \\widehat{\\sigma}_{\\text{pred}}) = 1000 \\exp(-3.6 + 1.96 \\times 0.3458298)\n$$\n$$\nY^{\\star}_{\\text{upper}} \\approx 1000 \\exp(-3.6 + 0.6778264) = 1000 \\exp(-2.9221736)\n$$\n$$\nY^{\\star}_{\\text{upper}} \\approx 1000 \\times 0.053818 = 53.818\n$$\n四舍五入到 4 位有效数字，上端点是 53.82。这表示每 1000 人年预测事件数的上限。",
            "answer": "$$\n\\boxed{53.82}\n$$"
        },
        {
            "introduction": "任何模型在未经严格审查前都不应被完全信任。这最后一个练习聚焦于建模流程中的一个关键步骤：拟合优度评估。你将学习如何使用皮尔逊卡方统计量（Pearson chi-square statistic）来检验泊松模型的一个核心假设——即均值与方差相等——并诊断一个常见的问题，即过度离散（overdispersion），此时数据的变异性比模型预测的要大。",
            "id": "4826692",
            "problem": "一项医院质量改进研究监测了在 $n = 130$ 个病房周内成人病房中医院内发生的血流感染数量。对于每个病房周 $i$，计数 $Y_i$ 假定在给定协变量的情况下是条件独立的，并采用泊松工作模型，其动机是经验事实，即对于泊松随机变量，均值等于方差。研究人员拟合了一个具有对数连接函数和暴露（患者-天数）偏移量的泊松广义线性模型（GLM; Generalized Linear Model），模型指定为 $\\log\\{\\mu_i\\} = \\log\\{\\mathrm{exposure}_i\\} + \\beta_0 + \\beta_1 \\,\\mathrm{Intervention}_i + \\cdots$，通过最大似然法估计了 $p = 7$ 个回归系数。软件报告了皮尔逊卡方统计量，定义为皮尔逊残差的平方和，其值为 $X^2 = 165.4$，同时还报告了模型偏差 $D = 171.2$。\n\n从第一性原理出发，思考当泊松均值-方差关系成立时，皮尔逊卡方统计量是如何通过模型隐含的方差对残差进行标准化而产生的，以及在拟合 $p$ 个参数后，$X^2$ 的抽样分布是如何被近似的。然后，相对于本研究中的自由度来解释 $X^2$，并陈述其对评估离散度和回归系数推断的影响。\n\n以下哪个陈述是正确的？选择所有适用项。\n\nA. 在正确的泊松均值-方差设定和正确的均值结构下，$X^2$ 近似服从自由度为 $\\mathrm{df} = n - p$ 的卡方分布；等价地，$E[X^2] \\approx n - p$，因此在大样本中 $X^2/\\mathrm{df} \\approx 1$。当 $n = 130$ 且 $p = 7$ 时，$\\mathrm{df} = 123$ 且 $X^2/\\mathrm{df} \\approx 165.4/123 \\approx 1.34$，这表明存在过度离散；拟泊松分析会将标准误扩大 $\\sqrt{1.34}$ 倍。\n\nB. 皮尔逊卡方统计量精确服从自由度为 $\\mathrm{df} = n$ 的卡方分布，无论估计了多少个参数，因此当 $\\mathrm{df} = n$ 时，$E[X^2/\\mathrm{df}] = 1$。当 $n = 130$ 时，$165.4/130 \\approx 1.27$ 表明没有实质性的过度离散。\n\nC. 皮尔逊卡方统计量是比较拟合模型与饱和模型的似然比，因此它精确服从自由度为 $\\mathrm{df} = n - p$ 的卡方分布。因此，只有偏差 $D$ 应用于评估离散度；$X^2$ 对于离散度没有信息量。\n\nD. 因为泊松计数不是正态分布的，所以 $X^2$ 的抽样分布是未知的；因此，$X^2/\\mathrm{df} > 1$ 的值表示低度离散。在这种情况下，应始终首选零膨胀泊松模型。\n\nE. 如果均值结构设定错误（例如，遗漏了重要的协变量），那么即使没有额外的泊松变异，$X^2/\\mathrm{df} > 1$ 也可能发生；实际的补救措施包括采用负二项均值-方差关系，或保留泊松均值并使用一个尺度参数来调整标准误，而不改变均值结构。",
            "solution": "## 问题验证\n\n### 步骤1：提取已知信息\n问题陈述提供了以下信息：\n-   样本量：$n = 130$ 个病房周。\n-   响应变量：$Y_i$，感染计数，假定遵循泊松工作模型。\n-   模型：一个具有对数连接函数和偏移量的泊松广义线性模型 (GLM)。\n-   模型结构：$\\log\\{\\mu_i\\} = \\log\\{\\mathrm{exposure}_i\\} + \\beta_0 + \\beta_1 \\,\\mathrm{Intervention}_i + \\cdots$\n-   估计的回归系数数量：$p = 7$。\n-   皮尔逊卡方统计量：$X^2 = 165.4$。\n-   皮尔逊卡方统计量的定义：皮尔逊残差的平方和，$\\sum_i (y_i - \\hat{\\mu}_i)^2 / \\hat{\\mu}_i$。\n-   模型偏差：$D = 171.2$。\n\n### 步骤2：使用提取的已知信息进行验证\n根据所需标准对问题进行验证。\n-   **科学性**：该问题描述了一个标准的生物统计学分析，使用泊松GLM处理计数数据，这是医学研究和流行病学中一种基础且广泛使用的技术。皮尔逊卡方、偏差、过度离散、拟泊松模型和负二项模型等概念都是统计理论与实践的既定支柱。该问题不含伪科学，事实准确。\n-   **定义明确**：问题陈述清晰，并提供了所有必要的数值（$n$、$p$、$X^2$、$D$）以执行所要求的解释和评估。可以进行独特且有意义的统计评估。\n-   **客观性**：语言精确、无偏见、客观，描述了一个假设但现实的统计情景。\n-   **完整性与一致性**：问题是自洽的，所提供的数据内部一致。$n$、$p$、$X^2$ 和 $D$ 的值对于一个真实世界的数据集是合理的。\n-   **无其他缺陷**：该问题并非微不足道、不切实际、不当陈述或隐喻性的。它提出了一个关于在GLM背景下解释拟合优度统计量的实质性问题。\n\n### 步骤3：结论与行动\n问题陈述是**有效的**。现在将推导解答。\n\n## 解答推导\n\n此问题要求评估泊松广义线性模型 (GLM) 的拟合优度，重点关注皮尔逊卡方统计量 $X^2$。\n\n### 泊松GLM和拟合优度的第一性原理\n\n1.  **泊松模型：** 如果一个随机变量 $Y$ 的概率质量函数为 $P(Y=y) = (\\mu^y e^{-\\mu}) / y!$（其中 $y = 0, 1, 2, \\dots$），则称其服从均值为 $\\mu$ 的泊松分布。泊松分布的一个关键性质是其方差等于其均值：$\\mathrm{E}[Y] = \\mathrm{Var}(Y) = \\mu$。在泊松GLM中，我们将每个观测值 $i$ 的均值 $\\mu_i$ 建模为协变量的函数。问题指定了一个对数连接函数和一个偏移项：\n    $$ \\log(\\mu_i) = \\log(\\text{exposure}_i) + \\eta_i $$\n    其中 $\\eta_i = \\mathbf{x}_i^T \\boldsymbol{\\beta}$ 是线性预测变量。这等同于将比率 $\\lambda_i = \\mu_i / \\text{exposure}_i$ 建模为 $\\log(\\lambda_i) = \\mathbf{x}_i^T \\boldsymbol{\\beta}$。\n\n2.  **皮尔逊残差和卡方统计量：** 在拟合模型以获得估计值 $\\hat{\\boldsymbol{\\beta}}$ 和拟合均值 $\\hat{\\mu}_i$ 后，我们可以定义残差。观测值 $i$ 的皮尔逊残差通过模型方差假设下的估计标准差对原始残差 ($y_i - \\hat{\\mu}_i$) 进行标准化：\n    $$ r_{P,i} = \\frac{y_i - \\hat{\\mu}_i}{\\sqrt{\\mathrm{Var}(y_i)}} = \\frac{y_i - \\hat{\\mu}_i}{\\sqrt{\\hat{\\mu}_i}} $$\n    皮尔逊卡方统计量 $X^2$ 是这些残差的平方和：\n    $$ X^2 = \\sum_{i=1}^{n} r_{P,i}^2 = \\sum_{i=1}^{n} \\frac{(y_i - \\hat{\\mu}_i)^2}{\\hat{\\mu}_i} $$\n\n3.  **$X^2$的抽样分布和离散度：** 根据大样本渐近理论，如果泊松模型被正确指定（均值结构和均值-方差关系都正确），则统计量 $X^2$ 近似服从卡方分布，其自由度等于观测数 ($n$) 减去估计参数的数量 ($p$)。\n    $$ X^2 \\approx \\chi^2_{n-p} $$\n    一个 $\\chi^2_k$ 随机变量的期望值是 $k$。因此，如果模型是正确的，我们期望 $E[X^2] \\approx n-p$。这引出了离散参数 $\\phi$ 的定义，其估计值为：\n    $$ \\hat{\\phi} = \\frac{X^2}{n-p} $$\n    如果模型成立，$\\hat{\\phi}$ 应接近于 $1$。\n    -   $\\hat{\\phi} > 1$ 表示 **过度离散**，意味着观测到的方差大于均值。\n    -   $\\hat{\\phi} < 1$ 表示 **低度离散**，意味着观测到的方差小于均值。\n\n4.  **应用于研究数据：**\n    -   $n = 130$\n    -   $p = 7$\n    -   $X^2 = 165.4$\n    自由度为 $\\mathrm{df} = n-p = 130 - 7 = 123$。\n    估计的离散度为 $\\hat{\\phi} = \\frac{165.4}{123} \\approx 1.3447$。\n    由于 $\\hat{\\phi} \\approx 1.34$ 远大于 $1$，有证据表明存在过度离散。\n\n5.  **过度离散的影响：** 未考虑的过度离散意味着模型关于 $\\mathrm{Var}(Y_i) = \\mu_i$ 的假设是不正确的；真实的方差更大。虽然 $\\beta_j$ 的最大似然估计量保持一致，但它们的标准误被低估了。这会导致人为地减小p值和过窄的置信区间，从而增加犯第一类错误的风险。\n\n6.  **过度离散的补救措施：**\n    -   **拟泊松模型：** 该方法假设 $\\mathrm{Var}(Y_i) = \\phi \\mu_i$。它使用与泊松模型相同的系数估计值，但通过将估计量的方差-协方差矩阵乘以 $\\hat{\\phi}$ 来进行调整。因此，系数的标准误被扩大了 $\\sqrt{\\hat{\\phi}}$ 倍。\n    -   **负二项模型：** 这是一种完全参数化的方法，用负二项似然取代泊松似然。负二项分布的方差函数为 $\\mathrm{Var}(Y_i) = \\mu_i + \\alpha \\mu_i^2$，它明确地对过度离散进行建模。这通常会得到不同的系数估计值和标准误。\n    -   **模型重新设定：** 过度离散也可能是均值结构设定错误的症状（例如，遗漏了协变量、预测变量的函数形式不正确、未能包含交互作用）。如果可能，最根本的解决方案是改进均值模型。\n\n## 逐项分析\n\n**A. 在正确的泊松均值-方差设定和正确的均值结构下，$X^2$ 近似服从自由度为 $\\mathrm{df} = n - p$ 的卡方分布；等价地，$E[X^2] \\approx n - p$，因此在大样本中 $X^2/\\mathrm{df} \\approx 1$。当 $n = 130$ 且 $p = 7$ 时，$\\mathrm{df} = 123$ 且 $X^2/\\mathrm{df} \\approx 165.4/123 \\approx 1.34$，这表明存在过度离散；拟泊松分析会将标准误扩大 $\\sqrt{1.34}$ 倍。**\n这个陈述完全符合上述第一性原理。它正确地陈述了 $X^2$ 的渐近分布、自由度 $\\mathrm{df} = n-p = 123$ 的计算、离散参数 $\\hat{\\phi} \\approx 1.34$ 的正确计算、将此值解释为指示过度离散的正确解释，以及在拟泊松框架下调整标准误的正确程序（乘以 $\\sqrt{\\hat{\\phi}}$）。\n**结论：正确。**\n\n**B. 皮尔逊卡方统计量精确服从自由度为 $\\mathrm{df} = n$ 的卡方分布，无论估计了多少个参数，因此当 $\\mathrm{df} = n$ 时，$E[X^2/\\mathrm{df}] = 1$。当 $n = 130$ 时，$165.4/130 \\approx 1.27$ 表明没有实质性的过度离散。**\n这个陈述包含多个基本错误。首先，卡方分布是一个*近似*结果，而不是*精确*结果。其次，自由度必须根据估计的参数数量进行调整，因此正确的值是 $\\mathrm{df} = n-p$，而不是 $\\mathrm{df} = n$。不减去 $p$ 是一个关键错误。关于没有实质性过度离散的结论是基于这个不正确的自由度。\n**结论：不正确。**\n\n**C. 皮尔逊卡方统计量是比较拟合模型与饱和模型的似然比，因此它精确服从自由度为 $\\mathrm{df} = n - p$ 的卡方分布。因此，只有偏差 $D$ 应用于评估离散度；$X^2$ 对于离散度没有信息量。**\n这个陈述错误地定义了皮尔逊卡方统计量。定义为与饱和模型进行似然比检验的统计量是**偏差** $D$。偏差公式为 $D = 2 \\sum_i [y_i \\log(y_i/\\hat{\\mu}_i) - (y_i - \\hat{\\mu}_i)]$。皮尔逊统计量 $X^2$ 基于标准化的残差平方。此外，声称 $X^2$ 对离散度没有信息量是错误的；事实上，在拟似然方法中，离散参数 $\\hat{\\phi}$ 的典型估计就是使用 $X^2/(n-p)$。$X^2$ 和 $D$ 都有信息量。而且，分布是近似的，不是精确的。\n**结论：不正确。**\n\n**D. 因为泊松计数不是正态分布的，所以 $X^2$ 的抽样分布是未知的；因此，$X^2/\\mathrm{df} > 1$ 的值表示低度离散。在这种情况下，应始终首选零膨胀泊松模型。**\n这个陈述在几个方面都有缺陷。虽然泊松计数确实不是正态分布的，但 $X^2$ 的渐近抽样分布已经很好地确定为近似卡方分布；它不是“未知的”。对离散参数的解释是颠倒的：$X^2/\\mathrm{df} > 1$ 表示**过度离散**，而不是低度离散。最后，虽然零膨胀是过度离散的一个可能原因，但它不是唯一原因，不应在没有对零计数过多进行进一步诊断检查的情况下“始终”首选零膨胀模型。\n**结论：不正确。**\n\n**E. 如果均值结构设定错误（例如，遗漏了重要的协变量），那么即使没有额外的泊松变异，$X^2/\\mathrm{df} > 1$ 也可能发生；实际的补救措施包括采用负二项均值-方差关系，或保留泊松均值并使用一个尺度参数来调整标准误，而不改变均值结构。**\n这个陈述正确地指出了模型诊断中的一个关键点：模型的系统部分（均值结构）的设定错误会夸大残差并产生明显的过度离散，即使真实的条件分布是泊松分布。该陈述随后列出了两种标准且有效的处理由此产生的过度离散的“实际补救措施”：拟合负二项模型（一种参数化方法）或使用拟泊松模型来缩放标准误（一种半参数化方法）。当观察到 $\\hat{\\phi} > 1$ 时，无论其最终原因是什么，这两种方法都是实践中常用的策略。\n**结论：正确。**",
            "answer": "$$\\boxed{AE}$$"
        }
    ]
}