{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在帮助您掌握解读含时变协变量的Cox模型的基本方法。通过在不同时间点直接计算风险比（hazard ratio），您将具体理解受试者的风险概况如何随其协变量状态动态变化。这是掌握并应用这些强大模型的第一步 。",
            "id": "4991783",
            "problem": "一项临床队列研究从入组时间 $t=0$ 开始追踪患者，直至发生目标事件。考虑一个带有单个时变协变量 $X(t)$ 的 Cox 比例风险 (PH) 模型，该协变量记录了降压药物的暴露情况：$X(t)=0$ 表示在时间 $t$ 未接受药物治疗，而 $X(t)=1$ 表示在时间 $t$ 正在接受药物治疗。假设一名受试者在时间 $t=5$ 开始服药，因此对于$t5$，有 $X(t)=0$，而对于$t \\ge 5$，有 $X(t)=1$。根据一个先前拟合的模型，该协变量的回归参数为 $\\beta=0.7$。考虑另一名从未接受药物治疗的受试者，因此对于所有时间 $t$，有 $X(t)\\equiv 0$。使用风险函数的基本定义和时变协变量的比例风险结构，计算在时间 $t=3$ 和 $t=8$ 时，第一名受试者相对于第二名受试者的风险比。风险比定义为瞬时风险的相对值。风险比是无量纲的；请用精确的解析表达式给出答案，不要进行近似，也不要带单位。",
            "solution": "评估问题陈述的有效性。\n\n### 步骤 1：提取已知条件\n-   模型：Cox 比例风险 (PH) 模型。\n-   协变量：单个时变协变量 $X(t)$。\n-   协变量值：$X(t)=0$ (未服药), $X(t)=1$ (正在服药)。\n-   受试者 1 的协变量函数：对于 $t5$，$X_1(t) = 0$；对于 $t \\ge 5$，$X_1(t) = 1$。\n-   受试者 2 的协变量函数：对于所有 $t$，$X_2(t) = 0$。\n-   回归参数：$\\beta = 0.7$。\n-   任务：计算在时间 $t=3$ 和 $t=8$ 时，受试者 1 相对于受试者 2 的风险比。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据、定义明确且客观。\n1.  **科学合理性**：带有随时间变化的协变量的 Cox 比例风险模型是生存分析中的一个标准和基本工具，生存分析是统计学的一个主要子领域，尤其是在生物统计学和流行病学中。该问题代表了此模型的一个典型应用。$\\beta=0.7$ 的值是假设模型给定的参数，不违反任何科学原理。\n2.  **问题的适定性**：问题给出了完整的说明。它提供了模型的数学形式、两名受试者协变量随时间的精确定义、模型参数 $\\beta$ 的值以及进行评估的具体时间点。这使得问题有一个唯一且有意义的解。\n3.  **客观性**：问题以统计学领域通用的精确、正式的语言陈述，没有歧义或主观解释的余地。\n\n所有其他验证标准也得到满足。该问题不是不完整的、矛盾的、不切实际的、不适定的、琐碎的或无法验证的。\n\n### 步骤 3：结论与行动\n该问题是有效的。将提供完整的解答。\n\n在带有单个时变协变量 $X(t)$ 的 Cox 比例风险模型中，风险函数 $h(t)$ 的基本定义由下式给出：\n$$h(t | X(t)) = h_0(t) \\exp(\\beta X(t))$$\n其中 $h_0(t)$ 是时间 $t$ 的基线风险函数，$\\beta$ 是与协变量 $X(t)$ 增加一个单位相关的对数风险比。\n\n问题要求计算风险比 (HR)，定义为第一名受试者相对于第二名受试者的瞬时风险。设 $h_1(t)$ 为第一名受试者的风险函数，$h_2(t)$ 为第二名受试者的风险函数。在时间 $t$ 的风险比为：\n$$\\text{HR}(t) = \\frac{h_1(t | X_1(t))}{h_2(t | X_2(t))}$$\n\n代入每个受试者的 Cox 模型定义：\n$$h_1(t | X_1(t)) = h_0(t) \\exp(\\beta X_1(t))$$\n$$h_2(t | X_2(t)) = h_0(t) \\exp(\\beta X_2(t))$$\n\n因此，风险比为：\n$$\\text{HR}(t) = \\frac{h_0(t) \\exp(\\beta X_1(t))}{h_0(t) \\exp(\\beta X_2(t))}$$\n\n基线风险函数 $h_0(t)$ 对两名受试者是共同的，因此可以消去，这就是“比例风险”假设的精髓所在。简化后得到：\n$$\\text{HR}(t) = \\frac{\\exp(\\beta X_1(t))}{\\exp(\\beta X_2(t))} = \\exp(\\beta X_1(t) - \\beta X_2(t)) = \\exp(\\beta [X_1(t) - X_2(t)])$$\n\n我们被要求计算在两个特定时间点 $t=3$ 和 $t=8$ 的这个比率。给定的回归参数值为 $\\beta = 0.7$。\n\n**在时间 $t=3$ 的计算：**\n首先，我们评估在 $t=3$ 时每名受试者的协变量。\n-   对于受试者 1，由于 $t=3  5$，该受试者尚未开始服药。因此，$X_1(3) = 0$。\n-   对于受试者 2，该受试者从未服药。因此，对于所有 $t$，$X_2(t) = 0$，这意味着 $X_2(3) = 0$。\n\n现在，我们将这些值代入风险比公式：\n$$\\text{HR}(3) = \\exp(\\beta [X_1(3) - X_2(3)]) = \\exp(0.7 [0 - 0]) = \\exp(0) = 1$$\n在 $t=3$ 时，两名受试者都未暴露于药物，因此他们的瞬时风险相同，风险比为 $1$。\n\n**在时间 $t=8$ 的计算：**\n接下来，我们评估在 $t=8$ 时每名受试者的协变量。\n-   对于受试者 1，由于 $t=8 \\ge 5$，该受试者正在服药。因此，$X_1(8) = 1$。\n-   对于受试者 2，该受试者从未服药。因此，$X_2(8) = 0$。\n\n我们将这些新值代入风险比公式：\n$$\\text{HR}(8) = \\exp(\\beta [X_1(8) - X_2(8)]) = \\exp(0.7 [1 - 0]) = \\exp(0.7 \\times 1) = \\exp(0.7)$$\n在 $t=8$ 时，受试者 1 暴露于药物，而受试者 2 没有。受试者 1 的风险是受试者 2 风险的 $\\exp(0.7)$ 倍。\n\n所需的两个值是在 $t=3$ 和 $t=8$ 时的风险比。它们分别为 $1$ 和 $\\exp(0.7)$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 1  \\exp(0.7) \\end{pmatrix}}$$"
        },
        {
            "introduction": "本练习旨在解决生存分析中最关键的陷阱之一：不朽时间偏倚（immortal time bias）。您将通过一个具体的案例，对比一种看似合理但错误的基线协变量编码方法与正确的时变编码方法。这种动手比较将清晰地揭示，不恰当处理时变暴露会如何导致对治疗效果得出存在根本性缺陷且具误导性的结论 。",
            "id": "4991868",
            "problem": "一项心血管医学领域的队列研究追踪了五名索引为 $i \\in \\{A,B,C,D,E\\}$ 的患者首次发生主要不良心脏事件的时间。每位患者 $i$ 都有一个进入研究（左截断）时间 $a_i$，一个开始治疗的时间 $s_i$（如果他们接受了治疗），以及一个退出时间 $t_i$，在该时间点发生事件或出现删失。我们关注的协变量是在时间点 $t$ 是否正在服用心脏保护药物的二元指示变量，记作 $z_i(t)$，其中如果在时间点 $t$ 正在用药，则 $z_i(t)=1$，否则 $z_i(t)=0$。该研究旨在利用Cox比例风险模型（Cox PH）估计药物与事件风险之间的关联。基线风险未指定，并且不存在事件时间相同的情况。所有个体仅在 $[a_i, t_i]$ 区间内被观察，并假定为非信息性删失。\n\n患者的具体时间数据如下：\n- 患者 $A$：$a_A=0$, $s_A=3$, $t_A=4$（在 $t=4$ 时发生事件）。\n- 患者 $B$：$a_B=0$,从未开始治疗, $t_B=1$（在 $t=1$ 时发生事件）。\n- 患者 $C$：$a_C=2$, 从未开始治疗, $t_C=2.5$（在 $t=2.5$ 时发生事件）。\n- 患者 $D$：$a_D=3.5$, 从未开始治疗, $t_D=5$（在 $t=5$ 时发生事件）。\n- 患者 $E$：$a_E=4.2$, $s_E=4.5$, $t_E=6$（在 $t=6$ 时删失，未发生事件）。\n\n考虑两种协变量的编码策略：\n1. 朴素基线编码：定义一个时不变指示变量 $w_i$，如果患者 $i$ 在随访期间曾开始治疗（$s_i$ 存在），则其值为 $1$，否则为 $0$。对于那些最终开始治疗的患者，这种编码会将治疗开始前的所有时间都错误地归类为“已治疗”。\n2. 修正后的时依协变量编码：使用时依指示变量 $z_i(t)$，仅当 $t \\ge s_i$ 时其值为 $1$，当 $t  s_i$ 时其值为 $0$。\n\n使用带有单个二元协变量的Cox PH模型和精确偏似然法，计算两种编码策略下药物的风险比 $\\exp(\\widehat{\\beta})$。在所有计算中，您的推导应基于根据左截断和事件或删失时间的退出所构建的风险集的基本定义。事件时间点分别为 $t=1$、$t=2.5$、$t=4$ 和 $t=5$，在每个事件时间点，风险集中都恰好有两名患者。对于每种编码，请仔细确定风险集以及在每个事件时间点经历事件的个体，然后推导出偏似然和最大偏似然估计值 $\\widehat{\\beta}$。\n\n仅报告使用修正后的时依协变量编码计算出的风险比估计值 $\\exp(\\widehat{\\beta})$ 作为最终答案。无需四舍五入。无需单位。",
            "solution": "该问题要求使用Cox比例风险模型，在两种不同的协变量编码方案下，计算一种心脏保护药物效应的风险比。本解答将首先验证问题陈述，然后对两种情况进行详细计算。\n\n### 问题验证\n\n首先，我将提取给定信息并验证问题。\n\n**步骤1：提取给定信息**\n-   **研究人群**：五名患者，索引为 $i \\in \\{A, B, C, D, E\\}$。\n-   **时间变量**：对于每位患者 $i$，有进入时间 $a_i$、治疗开始时间 $s_i$（如适用）和退出时间 $t_i$。\n-   **观察窗口**：每位患者 $i$ 在区间 $[a_i, t_i]$ 内被观察。\n-   **协变量**：一个表示是否正在用药的二元指示变量 $z_i(t)$，其中 $z_i(t)=1$ 表示在时间 $t$ 正在用药，$z_i(t)=0$ 表示其他情况。\n-   **模型**：Cox比例风险模型，$h(t | z_i(t)) = h_0(t) \\exp(\\beta z_i(t))$。\n-   **假设**：基线风险未指定，无事件时间节点相同的情况，非信息性删失。\n-   **患者数据**：\n    -   患者 $A$：$a_A=0$, $s_A=3$, $t_A=4$（事件）。\n    -   患者 $B$：$a_B=0$, 无 $s_B$, $t_B=1$（事件）。\n    -   患者 $C$：$a_C=2$, 无 $s_C$, $t_C=2.5$（事件）。\n    -   患者 $D$：$a_D=3.5$, 无 $s_D$, $t_D=5$（事件）。\n    -   患者 $E$：$a_E=4.2$, $s_E=4.5$, $t_E=6$（删失）。\n-   **协变量编码策略**：\n    1.  **朴素基线编码**：如果患者 $i$ 曾开始治疗，则 $w_i=1$，否则 $w_i=0$。\n    2.  **修正后的时依协变量编码**：当 $t \\ge s_i$ 时 $z_i(t)=1$，当 $t  s_i$ 时 $z_i(t)=0$。\n-   **任务**：计算两种策略下的风险比 $\\exp(\\widehat{\\beta})$。仅报告使用修正后编码的估计值作为最终答案。\n-   **约束**：“事件时间点分别为 $t=1$、$t=2.5$、$t=4$ 和 $t=5$，在每个事件时间点，风险集中都恰好有两名患者。”\n\n**步骤2：使用提取的给定信息进行验证**\n该问题在生物统计学和生存分析方面具有科学依据。它是客观且可形式化的。为了验证其是适定且自洽的，我将检查关于风险集的给定约束条件。在时间 $t$ 的风险集，记作 $R(t)$，包含所有在时间 $t$ 仍处于观察中且在此之前尚未经历事件或被删失的个体 $i$。形式上，如果个体 $i$ 的观察区间 $[a_i, t_i]$ 包含 $t$，即 $a_i \\le t \\le t_i$，则该个体在时间 $t$ 处于风险集中。\n\n排序后的事件时间为 $t_{(1)}=1$（患者 $B$）、$t_{(2)}=2.5$（患者 $C$）、$t_{(3)}=4$（患者 $A$）和 $t_{(4)}=5$（患者 $D$）。\n\n-   **在事件时间 $t=1$**：\n    -   患者 $A$：$a_A=0 \\le 1 \\le t_A=4$。在风险集中。\n    -   患者 $B$：$a_B=0 \\le 1 \\le t_B=1$。在风险集中。\n    -   患者 $C$：$a_C=2 \\not\\le 1$。不在风险集中。\n    -   患者 $D$：$a_D=3.5 \\not\\le 1$。不在风险集中。\n    -   患者 $E$：$a_E=4.2 \\not\\le 1$。不在风险集中。\n    -   风险集为 $R(1)=\\{A, B\\}$，大小为 $2$。该断言成立。\n\n-   **在事件时间 $t=2.5$**：\n    -   患者 $A$：$a_A=0 \\le 2.5 \\le t_A=4$。在风险集中。\n    -   患者 $B$：在 $t_B=1  2.5$ 时发生事件。不在风险集中。\n    -   患者 $C$：$a_C=2 \\le 2.5 \\le t_C=2.5$。在风险集中。\n    -   患者 $D$：$a_D=3.5 \\not\\le 2.5$。不在风险集中。\n    -   患者 $E$：$a_E=4.2 \\not\\le 2.5$。不在风险集中。\n    -   风险集为 $R(2.5)=\\{A, C\\}$，大小为 $2$。该断言成立。\n\n-   **在事件时间 $t=4$**：\n    -   患者 $A$：$a_A=0 \\le 4 \\le t_A=4$。在风险集中。\n    -   患者 $B$：在 $t_B=1  4$ 时发生事件。不在风险集中。\n    -   患者 $C$：在 $t_C=2.5  4$ 时发生事件。不在风险集中。\n    -   患者 $D$：$a_D=3.5 \\le 4 \\le t_D=5$。在风险集中。\n    -   患者 $E$：$a_E=4.2 \\not\\le 4$。不在风险集中。\n    -   风险集为 $R(4)=\\{A, D\\}$，大小为 $2$。该断言成立。\n\n-   **在事件时间 $t=5$**：\n    -   患者 $A$：在 $t_A=4  5$ 时发生事件。不在风险集中。\n    -   患者 $B$：在 $t_B=1  5$ 时发生事件。不在风险集中。\n    -   患者 $C$：在 $t_C=2.5  5$ 时发生事件。不在风险集中。\n    -   患者 $D$：$a_D=3.5 \\le 5 \\le t_D=5$。在风险集中。\n    -   患者 $E$：$a_E=4.2 \\le 5 \\le t_E=6$。在风险集中。\n    -   风险集为 $R(5)=\\{D, E\\}$，大小为 $2$。该断言成立。\n\n**步骤3：结论与行动**\n该问题是完全指定、内部一致且科学有效的。我将继续进行解答。\n\n### Cox模型估计\n\nCox模型的风险函数为 $h(t | X_i(t)) = h_0(t) \\exp(\\beta X_i(t))$。对于唯一的事件时间 $t_{(1)}, \\dots, t_{(k)}$，偏似然函数由下式给出：\n$$L(\\beta) = \\prod_{j=1}^{k} \\frac{\\exp(\\beta X_{d(j)}(t_{(j)}))}{\\sum_{l \\in R(t_{(j)})} \\exp(\\beta X_l(t_{(j)}))}$$\n其中 $d(j)$ 是在时间 $t_{(j)}$ 发生事件的患者索引，$R(t_{(j)})$ 是该时间的风险集。估计值 $\\widehat{\\beta}$ 使 $L(\\beta)$ 最大化。\n\n事件时间为 $t=1$（患者 $B$）、$t=2.5$（患者 $C$）、$t=4$（患者 $A$）和 $t=5$（患者 $D$）。风险集为 $R(1)=\\{A,B\\}$、$R(2.5)=\\{A,C\\}$、$R(4)=\\{A,D\\}$ 和 $R(5)=\\{D,E\\}$。\n\n**1. 朴素基线编码 ($w_i$)**\n\n时不变协变量 $w_i$ 的值为 $1$（如果患者曾开始治疗）或 $0$（否则）。\n-   患者 $A$：$s_A$ 存在，所以 $w_A=1$。\n-   患者 $B$：无 $s_B$，所以 $w_B=0$。\n-   患者 $C$：无 $s_C$，所以 $w_C=0$。\n-   患者 $D$：无 $s_D$，所以 $w_D=0$。\n-   患者 $E$：$s_E$ 存在，所以 $w_E=1$。\n\n偏似然是每个事件项的乘积：\n-   $t=1$ 时的事件（患者 $B$ 发生事件, $w_B=0$），风险集 $R(1)=\\{A, B\\}$（$w_A=1, w_B=0$）：\n    $$L_1(\\beta) = \\frac{\\exp(\\beta w_B)}{\\exp(\\beta w_A) + \\exp(\\beta w_B)} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{1}{\\exp(\\beta) + 1}$$\n-   $t=2.5$ 时的事件（患者 $C$ 发生事件, $w_C=0$），风险集 $R(2.5)=\\{A, C\\}$（$w_A=1, w_C=0$）：\n    $$L_2(\\beta) = \\frac{\\exp(\\beta w_C)}{\\exp(\\beta w_A) + \\exp(\\beta w_C)} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{1}{\\exp(\\beta) + 1}$$\n-   $t=4$ 时的事件（患者 $A$ 发生事件, $w_A=1$），风险集 $R(4)=\\{A, D\\}$（$w_A=1, w_D=0$）：\n    $$L_3(\\beta) = \\frac{\\exp(\\beta w_A)}{\\exp(\\beta w_A) + \\exp(\\beta w_D)} = \\frac{\\exp(\\beta \\cdot 1)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{\\exp(\\beta)}{\\exp(\\beta) + 1}$$\n-   $t=5$ 时的事件（患者 $D$ 发生事件, $w_D=0$），风险集 $R(5)=\\{D, E\\}$（$w_D=0, w_E=1$）：\n    $$L_4(\\beta) = \\frac{\\exp(\\beta w_D)}{\\exp(\\beta w_D) + \\exp(\\beta w_E)} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 1)} = \\frac{1}{1 + \\exp(\\beta)}$$\n\n总偏似然为 $L(\\beta) = L_1 \\cdot L_2 \\cdot L_3 \\cdot L_4 = \\frac{1}{(\\exp(\\beta)+1)^2} \\cdot \\frac{\\exp(\\beta)}{\\exp(\\beta)+1} \\cdot \\frac{1}{\\exp(\\beta)+1} = \\frac{\\exp(\\beta)}{(\\exp(\\beta)+1)^4}$。\n对数偏似然为 $l(\\beta) = \\beta - 4 \\ln(\\exp(\\beta)+1)$。\n得分函数为 $U(\\beta) = \\frac{d l}{d \\beta} = 1 - 4 \\frac{\\exp(\\beta)}{\\exp(\\beta)+1}$。\n令 $U(\\widehat{\\beta})=0$ 可得 $1 = 4 \\frac{\\exp(\\widehat{\\beta})}{\\exp(\\widehat{\\beta})+1}$，所以 $\\exp(\\widehat{\\beta})+1 = 4\\exp(\\widehat{\\beta})$，这意味着 $3\\exp(\\widehat{\\beta})=1$。\n因此，朴素的风险比估计值为 $\\exp(\\widehat{\\beta}) = \\frac{1}{3}$。\n\n**2. 修正后的时依协变量编码 ($z_i(t)$)**\n\n协变量 $z_i(t)$ 的值为 $1$（如果 $t \\ge s_i$）或 $0$（否则）。\n-   当 $t \\ge 3$ 时，$z_A(t)=1$，否则为 $0$。\n-   对于所有 $t$，$z_B(t)=0$。\n-   对于所有 $t$，$z_C(t)=0$。\n-   对于所有 $t$，$z_D(t)=0$。\n-   当 $t \\ge 4.5$ 时，$z_E(t)=1$，否则为 $0$。\n\n我们为风险集中的个体在每个事件时间点评估协变量。\n-   $t=1$ 时的事件（患者 $B$ 发生事件），风险集 $R(1)=\\{A, B\\}$：\n    在 $t=1$ 时，$z_A(1)=0$（因为 $1  s_A=3$）且 $z_B(1)=0$。\n    $$L_1(\\beta) = \\frac{\\exp(\\beta z_B(1))}{\\exp(\\beta z_A(1)) + \\exp(\\beta z_B(1))} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 0)} = \\frac{1}{1+1} = \\frac{1}{2}$$\n-   $t=2.5$ 时的事件（患者 $C$ 发生事件），风险集 $R(2.5)=\\{A, C\\}$：\n    在 $t=2.5$ 时，$z_A(2.5)=0$（因为 $2.5  s_A=3$）且 $z_C(2.5)=0$。\n    $$L_2(\\beta) = \\frac{\\exp(\\beta z_C(2.5))}{\\exp(\\beta z_A(2.5)) + \\exp(\\beta z_C(2.5))} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 0)} = \\frac{1}{1+1} = \\frac{1}{2}$$\n-   $t=4$ 时的事件（患者 $A$ 发生事件），风险集 $R(4)=\\{A, D\\}$：\n    在 $t=4$ 时，$z_A(4)=1$（因为 $4 \\ge s_A=3$）且 $z_D(4)=0$。\n    $$L_3(\\beta) = \\frac{\\exp(\\beta z_A(4))}{\\exp(\\beta z_A(4)) + \\exp(\\beta z_D(4))} = \\frac{\\exp(\\beta \\cdot 1)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{\\exp(\\beta)}{\\exp(\\beta) + 1}$$\n-   $t=5$ 时的事件（患者 $D$ 发生事件），风险集 $R(5)=\\{D, E\\}$：\n    在 $t=5$ 时，$z_D(5)=0$ 且 $z_E(5)=1$（因为 $5 \\ge s_E=4.5$）。\n    $$L_4(\\beta) = \\frac{\\exp(\\beta z_D(5))}{\\exp(\\beta z_D(5)) + \\exp(\\beta z_E(5))} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 1)} = \\frac{1}{1 + \\exp(\\beta)}$$\n\n总偏似然为 $L(\\beta) = \\frac{1}{2} \\cdot \\frac{1}{2} \\cdot \\frac{\\exp(\\beta)}{\\exp(\\beta)+1} \\cdot \\frac{1}{\\exp(\\beta)+1} = \\frac{1}{4} \\frac{\\exp(\\beta)}{(\\exp(\\beta)+1)^2}$。\n对数偏似然为 $l(\\beta) = -\\ln(4) + \\beta - 2 \\ln(\\exp(\\beta)+1)$。\n得分函数为 $U(\\beta) = \\frac{d l}{d \\beta} = 1 - 2 \\frac{\\exp(\\beta)}{\\exp(\\beta)+1}$。\n令 $U(\\widehat{\\beta})=0$ 可得 $1 = 2 \\frac{\\exp(\\widehat{\\beta})}{\\exp(\\widehat{\\beta})+1}$，所以 $\\exp(\\widehat{\\beta})+1 = 2\\exp(\\widehat{\\beta})$，这意味着 $\\exp(\\widehat{\\beta})=1$。\n\n使用修正后的时依协变量编码得到的风险比估计值为 $\\exp(\\widehat{\\beta})=1$。这表明药物与心脏事件风险之间没有关联，这与朴素编码因引入“永生时间偏倚”(immortal time bias)而产生的谬误结果形成鲜明对比。\n最终答案是来自修正后分析的风险比。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "真实世界的生存数据常常涉及交错入组（左截断）和随时间变化的协变量等复杂情况。本练习将理论与应用相结合，指导您将数据构建为现代统计软件所需的“开始-停止”（start-stop）或计数过程格式。通过计算偏最大似然函数的一个组成部分，您将确切地理解该数据结构如何使Cox模型能够正确处理这些动态过程 。",
            "id": "4991875",
            "problem": "考虑一个关于术后感染的生存分析，研究对象为一个具有交错入组时间的队列，并且存在一个单一的时变暴露，该暴露在第 $14$ 天因一项医院政策而被激活。两名受试者在 Cox 比例风险 (CPH) 模型下被观察，该模型假定风险函数为 $h_{i}(t) = h_{0}(t)\\,\\exp\\!\\big(\\beta_{X}\\,X_{i}(t) + \\beta_{Z}\\,Z_{i}\\big)$，其中 $h_{0}(t)$ 是一个未指定的基线风险，$X_{i}(t)$ 是一个时变暴露指示变量，$Z_{i}$ 是一个时不变的患者水平协变量。受试者 $1$ 在第 0 天进入观察，其 $Z_{1} = 1$，并在第 20 天发生事件。受试者 $2$ 在第 12 天进入观察，其 $Z_{2} = 0$，并在第 30 天被行政删失。对于所有患者，暴露政策在第 14 天启动，因此对于 $i=1,2$，当 $t  14$ 时 $X_{i}(t) = 0$，当 $t \\ge 14$ 时 $X_{i}(t) = 1$。\n\n任务：\n- 构建适用于左截断和时变协变量的起始-终止区间表示法，确保 $X_{i}(t)$ 中的所有变化点以及事件或删失时间点都得到考虑。\n- 使用一个考虑了左截断的、基于计数过程的风险集定义，确定在事件时间 $t = 20$ 时的风险集构成，并计算在 $t = 20$ 时对应的偏似然贡献的分母。\n\n假设 $\\beta_{X} = \\ln(2)$ 且 $\\beta_{Z} = \\ln(1.5)$。将所求的分母表示为一个实数。无需四舍五入。",
            "solution": "问题陈述具有科学依据、是适定的、客观的，并包含得出唯一解所需的所有信息。这是 Cox 比例风险模型在时变协变量和左截断数据下的一个标准应用，也是生存分析中的一种常见情景。因此，该问题是有效的。\n\n该问题需要一个包含两部分的解答：首先，构建起始-终止数据表示法；其次，计算在特定事件时间点上偏似然项的分母。我们将按顺序完成这些任务。\n\n该模型是 Cox 比例风险 (CPH) 模型，其受试者 $i$ 在时间 $t$ 的风险函数由下式给出：\n$$ h_{i}(t) = h_{0}(t)\\,\\exp\\!\\big(\\beta_{X}\\,X_{i}(t) + \\beta_{Z}\\,Z_{i}\\big) $$\n其中 $h_{0}(t)$ 是基线风险，$X_{i}(t)$ 是一个时变协变量，$Z_{i}$ 是一个时不变协变量。给定的系数为 $\\beta_{X} = \\ln(2)$ 和 $\\beta_{Z} = \\ln(1.5)$。\n\n首先，我们构建起始-终止区间表示法。这种数据格式对于正确拟合带有时间协变量的 CPH 模型是必需的。每个受试者的随访时间被划分为多个区间，在每个区间内所有协变量都保持不变。分割点由受试者的进入和退出时间，以及时变协变量值发生变化的任何时间点决定。\n\n本问题中的关键时间点是：\n-   $t=0$：受试者 1 入组。\n-   $t=12$：受试者 2 入组（这代表左截断）。\n-   $t=14$：医院政策启动，所有受试者的 $X_{i}(t)$ 从 0 变为 1。\n-   $t=20$：受试者 1 发生事件。\n-   $t=30$：受试者 2 被删失。\n\n使用这些时间点，我们可以为每个受试者定义区间。我们将使用 `(start, stop]` 区间表示法。\n\n对于受试者 1（入组 $t=0$，事件 $t=20$，$Z_1=1$）：\n-   第一个区间从入组到协变量变化：`(0, 14]`。在此区间内，$X_1(t)=0$ 且 $Z_1=1$。受试者未发生事件。\n-   第二个区间从协变量变化到事件发生：`(14, 20]`。在此区间内，$X_1(t)=1$ 且 $Z_1=1$。受试者在此区间末尾，即 $t=20$ 时发生事件。\n\n对于受试者 2（入组 $t=12$，删失 $t=30$，$Z_2=0$）：\n-   第一个区间从入组到协变量变化：`(12, 14]`。在此区间内，$X_2(t)=0$ 且 $Z_2=0$。受试者未发生事件。\n-   第二个区间从协变量变化到删失：`(14, 30]`。在此区间内，$X_2(t)=1$ 且 $Z_2=0$。受试者在此区间末尾，即 $t=30$ 时被删失。\n\n此信息总结在以下起始-终止表示法表格中：\n| 受试者 ID | 起始时间 | 终止时间 | 事件状态 | $X_i(t)$ | $Z_i$ |\n|------------|------------|-----------|--------------|----------|-------|\n| $1$        | $0$        | $14$      | $0$          | $0$      | $1$   |\n| $1$        | $14$       | $20$      | $1$          | $1$      | $1$   |\n| $2$        | $12$       | $14$      | $0$          | $0$      | $0$   |\n| $2$        | $14$       | $30$      | $0$          | $1$      | $0$   |\n\n接下来，我们计算事件时间 $t=20$ 时的偏似然贡献的分母。对于受试者 $j$ 在时间 $t_j$ 发生的单个事件，其偏似然由发生事件的受试者的风险与当时所有处于风险中的受试者的风险之和的比率给出。此贡献的分母是：\n$$ D_{t_j} = \\sum_{k \\in \\mathcal{R}(t_j)} h_k(t_j) = \\sum_{k \\in \\mathcal{R}(t_j)} h_0(t_j)\\,\\exp\\!\\big(\\beta_{X}\\,X_{k}(t_j) + \\beta_{Z}\\,Z_{k}\\big) $$\n项 $h_0(t_j)$ 可以被提取出来，并且因为它也出现在分子中，所以它被消掉了。分母中与参数相关的部分是风险评分的总和：\n$$ \\sum_{k \\in \\mathcal{R}(t_j)} \\exp\\!\\big(\\beta_{X}\\,X_{k}(t_j) + \\beta_{Z}\\,Z_{k}\\big) $$\n这就是我们被要求计算的在事件时间 $t=20$ 时的量。\n\n在计数过程表示法中，风险集 $\\mathcal{R}(t)$ 由在时间 $t$ 之前的一瞬间所有处于观察中且尚未发生事件的受试者组成。对于一个入组时间为 $E_i$、事件/删失时间为 $T_i$ 的受试者 $i$，其在时间 $t$ 处于风险集中的条件是 $E_i  t \\le T_i$。这个定义正确地处理了左截断数据。\n\n我们需要确定风险集 $\\mathcal{R}(20)$：\n-   对于受试者 1：入组 $E_1=0$，事件 $T_1=20$。条件是 $0  20 \\le 20$，成立。因此，受试者 1 在 $\\mathcal{R}(20)$ 中。\n-   对于受试者 2：入组 $E_2=12$，删失 $T_2=30$。条件是 $12  20 \\le 30$，成立。因此，受试者 2 在 $\\mathcal{R}(20)$ 中。\n\n在 $t=20$ 时的风险集是 $\\mathcal{R}(20) = \\{1, 2\\}$。\n\n现在我们通过对这两个受试者在 $t=20$ 时的风险评分求和来计算分母：\n$$ D_{20} = \\sum_{k \\in \\{1, 2\\}} \\exp\\!\\big(\\beta_{X}\\,X_{k}(20) + \\beta_{Z}\\,Z_{k}\\big) = \\exp\\!\\big(\\beta_{X}\\,X_{1}(20) + \\beta_{Z}\\,Z_{1}\\big) + \\exp\\!\\big(\\beta_{X}\\,X_{2}(20) + \\beta_{Z}\\,Z_{2}\\big) $$\n我们将已知的协变量和系数值代入。\n在时间 $t=20$ 时，由于 $20 \\ge 14$，两个受试者的时变协变量均为 $X_1(20)=1$ 和 $X_2(20)=1$。\n时不变协变量为 $Z_1=1$ 和 $Z_2=0$。\n系数为 $\\beta_{X} = \\ln(2)$ 和 $\\beta_{Z} = \\ln(1.5)$。\n\n对于受试者 1，其风险评分为：\n$$ \\exp\\!\\big(\\beta_{X}\\,X_{1}(20) + \\beta_{Z}\\,Z_{1}\\big) = \\exp\\!\\big(\\ln(2) \\cdot 1 + \\ln(1.5) \\cdot 1\\big) = \\exp\\!\\big(\\ln(2) + \\ln(1.5)\\big) $$\n使用属性 $\\ln(a) + \\ln(b) = \\ln(ab)$：\n$$ \\exp\\!\\big(\\ln(2 \\times 1.5)\\big) = \\exp\\!\\big(\\ln(3)\\big) = 3 $$\n\n对于受试者 2，其风险评分为：\n$$ \\exp\\!\\big(\\beta_{X}\\,X_{2}(20) + \\beta_{Z}\\,Z_{2}\\big) = \\exp\\!\\big(\\ln(2) \\cdot 1 + \\ln(1.5) \\cdot 0\\big) = \\exp\\!\\big(\\ln(2)\\big) = 2 $$\n\n在 $t=20$ 时的偏似然贡献的分母是这些风险评分的总和：\n$$ D_{20} = 3 + 2 = 5 $$",
            "answer": "$$\\boxed{5}$$"
        }
    ]
}