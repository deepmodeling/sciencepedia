{
    "hands_on_practices": [
        {
            "introduction": "第一个练习将巩固您对倾向性得分分层法的理解。通过首先从基本原理推导估计量，然后将其应用于具体数据集，您将清楚地看到将受试者划分到不同层中如何帮助控制混杂变量。这种实践加强了倾向性得分的理论依据与其在估计治疗效果方面的实际应用之间的联系。",
            "id": "4980878",
            "problem": "考虑一项关于新型抗高血压疗法的观察性研究，其结果是在30天时收缩压的变化，单位为毫米汞柱（mmHg）。令 $A \\in \\{0,1\\}$ 表示治疗分配，$Y(a)$ 表示治疗水平为 $a$ 时的潜在结果，$X$ 表示基线协变量。目标估计量是平均治疗效应 $\\tau = \\mathbb{E}[Y(1) - Y(0)]$。假设以下条件均得到满足：稳定单位治疗价值假设（SUTVA）、一致性、正值性以及给定 $X$ 下的条件可交换性（即 $\\{Y(1), Y(0)\\} \\perp A \\mid X$）。令倾向性得分为 $e(X) = \\mathbb{P}(A = 1 \\mid X)$。假设患者根据估计的倾向性得分被划分为 $K$ 个分层（例如，五分位数），形成一个离散的分层指标 $S \\in \\{1,\\dots,K\\}$。\n\n从上述假设和全期望定律出发，推导出一个 $\\tau$ 的样本估计量，该估计量表示为层内观察结果差异的加权平均值，其中权重与分层大小成正比。然后，使用来自 $K=5$ 个倾向性得分分层的以下数据，计算此估计量的数值。以毫米汞柱（mmHg）表示最终效应量，并将答案四舍五入至四位有效数字。\n\n对于每个分层 $k$，给出该层的总样本量 $n_k$、处理组数量 $n_{1k}$、对照组数量 $n_{0k}$，以及处理组和对照组中的经验平均结果，分别表示为 $\\bar{Y}_{1k}$ 和 $\\bar{Y}_{0k}$：\n- 分层 $k=1$：$n_1 = 120$，$n_{1,1} = 70$，$n_{0,1} = 50$，$\\bar{Y}_{1,1} = 8.2$，$\\bar{Y}_{0,1} = 5.1$。\n- 分层 $k=2$：$n_2 = 160$，$n_{1,2} = 90$，$n_{0,2} = 70$，$\\bar{Y}_{1,2} = 7.5$，$\\bar{Y}_{0,2} = 6.0$。\n- 分层 $k=3$：$n_3 = 200$，$n_{1,3} = 110$，$n_{0,3} = 90$，$\\bar{Y}_{1,3} = 6.3$，$\\bar{Y}_{0,3} = 5.8$。\n- 分层 $k=4$：$n_4 = 180$，$n_{1,4} = 95$，$n_{0,4} = 85$，$\\bar{Y}_{1,4} = 5.1$，$\\bar{Y}_{0,4} = 4.9$。\n- 分层 $k=5$：$n_5 = 140$，$n_{1,5} = 75$，$n_{0,5} = 65$，$\\bar{Y}_{1,5} = 4.0$，$\\bar{Y}_{0,5} = 3.7$。\n\n令 $N = \\sum_{k=1}^{5} n_k$ 表示总样本量。使用与 $n_k$ 成正比的权重，并计算分层估计量的值。您的最终答案必须是一个实数。",
            "solution": "目标估计量是平均治疗效应 $\\tau = \\mathbb{E}[Y(1) - Y(0)]$。在所述假设下，我们从基本原理出发。\n\n根据全期望定律，\n$$\n\\tau \\;=\\; \\mathbb{E}\\!\\left[\\,Y(1) - Y(0)\\,\\right]\n\\;=\\; \\mathbb{E}\\!\\left[\\,\\mathbb{E}\\!\\left[\\,Y(1) - Y(0) \\mid S\\,\\right]\\,\\right]\n\\;=\\; \\sum_{k=1}^{K} \\mathbb{P}(S=k)\\,\\mathbb{E}\\!\\left[\\,Y(1) - Y(0) \\mid S=k\\,\\right].\n$$\n在每个分层 $S=k$ 内，条件可交换性（由倾向性得分分层所引出）意味着 $\\{Y(1),Y(0)\\} \\perp A \\mid S=k$，并且正值性成立（两个治疗组都有代表）。一致性将观察结果 $Y$ 与潜在结果联系起来：如果 $A=a$，那么 $Y = Y(a)$。因此，\n$$\n\\mathbb{E}\\!\\left[\\,Y(1) \\mid S=k\\,\\right]\n\\;=\\; \\mathbb{E}\\!\\left[\\,\\mathbb{E}\\!\\left[\\,Y(1) \\mid A=1, S=k\\,\\right]\\,\\right]\n\\;=\\; \\mathbb{E}\\!\\left[\\,\\mathbb{E}\\!\\left[\\,Y \\mid A=1, S=k\\,\\right]\\,\\right]\n\\;=\\; \\mathbb{E}\\!\\left[\\,Y \\mid A=1, S=k\\,\\right],\n$$\n同样地\n$$\n\\mathbb{E}\\!\\left[\\,Y(0) \\mid S=k\\,\\right]\n\\;=\\; \\mathbb{E}\\!\\left[\\,Y \\mid A=0, S=k\\,\\right].\n$$\n因此，\n$$\n\\mathbb{E}\\!\\left[\\,Y(1) - Y(0) \\mid S=k\\,\\right]\n\\;=\\; \\mathbb{E}\\!\\left[\\,Y \\mid A=1, S=k\\,\\right] - \\mathbb{E}\\!\\left[\\,Y \\mid A=0, S=k\\,\\right].\n$$\n代入回去，\n$$\n\\tau \\;=\\; \\sum_{k=1}^{K} \\mathbb{P}(S=k)\\,\\Big(\\mathbb{E}\\!\\left[\\,Y \\mid A=1, S=k\\,\\right] - \\mathbb{E}\\!\\left[\\,Y \\mid A=0, S=k\\,\\right]\\Big).\n$$\n在有限样本中，我们用经验分层比例 $n_k/N$ 来近似 $\\mathbb{P}(S=k)$，并用分层特定的样本均值来近似条件期望，\n$$\n\\bar{Y}_{1k} \\;=\\; \\frac{1}{n_{1k}} \\sum_{i: A_i=1, S_i=k} Y_i,\n\\qquad\n\\bar{Y}_{0k} \\;=\\; \\frac{1}{n_{0k}} \\sum_{i: A_i=0, S_i=k} Y_i,\n$$\n从而得到权重与分层大小成正比的分层估计量：\n$$\n\\hat{\\tau} \\;=\\; \\sum_{k=1}^{K} \\frac{n_k}{N}\\,\\big(\\bar{Y}_{1k} - \\bar{Y}_{0k}\\big).\n$$\n这些权重与分层大小成正比，且总和为1。这个估计量可以被理解为在 $X$ 的分布上对条件均值差异进行平均的离散近似；当分层变得任意精细时，该近似与逆概率治疗加权（IPTW）相联系，其中 $\\mathbb{E}[Y(1)]$ 和 $\\mathbb{E}[Y(0)]$ 分别通过使用倾向性得分的倒数及其补数对观察结果进行加权来估计。\n\n我们现在使用所提供的数据计算数值。首先，计算总样本量：\n$$\nN \\;=\\; n_1 + n_2 + n_3 + n_4 + n_5 \\;=\\; 120 + 160 + 200 + 180 + 140 \\;=\\; 800.\n$$\n计算分层权重 $w_k = n_k/N$：\n$$\nw_1 = \\frac{120}{800} = 0.15,\\quad\nw_2 = \\frac{160}{800} = 0.20,\\quad\nw_3 = \\frac{200}{800} = 0.25,\\quad\nw_4 = \\frac{180}{800} = 0.225,\\quad\nw_5 = \\frac{140}{800} = 0.175.\n$$\n计算层内差异 $d_k = \\bar{Y}_{1k} - \\bar{Y}_{0k}$：\n$$\nd_1 = 8.2 - 5.1 = 3.1,\\quad\nd_2 = 7.5 - 6.0 = 1.5,\\quad\nd_3 = 6.3 - 5.8 = 0.5,\\quad\nd_4 = 5.1 - 4.9 = 0.2,\\quad\nd_5 = 4.0 - 3.7 = 0.3.\n$$\n构成加权和：\n\n$$\n\\hat{\\tau} \\;=\\; \\sum_{k=1}^{5} w_k d_k\n\\;=\\; 0.15 \\cdot 3.1 \\;+\\; 0.20 \\cdot 1.5 \\;+\\; 0.25 \\cdot 0.5 \\;+\\; 0.225 \\cdot 0.2 \\;+\\; 0.175 \\cdot 0.3.\n$$\n\n计算每个乘积：\n\n$$\n0.15 \\cdot 3.1 = 0.465,\\quad\n0.20 \\cdot 1.5 = 0.300,\\quad\n0.25 \\cdot 0.5 = 0.125,\\quad\n0.225 \\cdot 0.2 = 0.045,\\quad\n0.175 \\cdot 0.3 = 0.0525.\n$$\n\n将它们相加：\n\n$$\n\\hat{\\tau} = 0.465 + 0.300 + 0.125 + 0.045 + 0.0525 = 0.9875.\n$$\n\n因此，收缩压降低的平均治疗效应的分层估计量为 $0.9875$ mmHg。四舍五入到四位有效数字，结果仍为 $0.9875$ mmHg。",
            "answer": "$$\\boxed{0.9875}$$"
        },
        {
            "introduction": "应用倾向性得分方法后，一个关键步骤是检查它是否成功地平衡了治疗组和对照组之间的协变量。标准化均数差（SMD）是用于此诊断检查的关键指标。本练习要求您推导在经逆概率处理加权后的人群中计算SMD的公式，从而加深您对IPTW如何创建伪人群以及如何评估其平衡性的理解。",
            "id": "4980935",
            "problem": "一项观察性队列研究评估了一项二元治疗对临床结局的影响。对于每个个体 $i \\in \\{1,\\dots,n\\}$，令 $A_i \\in \\{0,1\\}$ 表示观察到的治疗分配（$A_i=1$ 为治疗组，$A_i=0$ 为对照组），令 $X_{ij}$ 表示第 $j$ 个基线协变量。假设一个正确设定的倾向性得分模型为每个个体生成一个估计的倾向性得分 $e_i = \\Pr(A_i=1 \\mid X_i)$，其中 $X_i$ 是基线协变量的向量。考虑使用非稳定权重构建伪总体的逆治疗概率加权（IPTW）方法，其中治疗组的权重为 $w_i^{(1)} = A_i / e_i$，对照组的权重为 $w_i^{(0)} = (1-A_i)/(1-e_i)$。\n\n使用以下基本依据：\n- 倾向性得分是条件概率 $e_i = \\Pr(A_i=1 \\mid X_i)$，逆治疗概率加权通过个体接受其实际观察到的治疗的概率的倒数来对个体进行重新加权。\n- 对于任意非负权重 $\\{v_i\\}_{i=1}^n$，标量 $Z_i$ 的加权平均值为 $\\frac{\\sum_{i=1}^n v_i Z_i}{\\sum_{i=1}^n v_i}$，相应的权重内加权方差为 $\\frac{\\sum_{i=1}^n v_i (Z_i - \\bar{Z}_v)^2}{\\sum_{i=1}^n v_i}$，其中 $\\bar{Z}_v = \\frac{\\sum_{i=1}^n v_i Z_i}{\\sum_{i=1}^n v_i}$。\n\n将协变量的标准化均数差定义为治疗组和对照组 $X_{ij}$ 的均值之差，除以合并的组内标准差，该标准差在每个组内使用相同的加权方案计算。使用如上所述的组内逆治疗概率加权方法，推导出一个关于协变量 $X_j$ 的IPTW加权标准化均数差的单一、闭式解析表达式，该表达式仅依赖于 $\\{A_i, X_{ij}, e_i\\}_{i=1}^n$ 和关于索引的有限求和。您的最终答案必须是一个表达式（而不是一个待解的方程），并且不得引入任何未定义的中间符号。将最终答案表示为解析表达式；不需要进行数值评估，也不涉及单位。",
            "solution": "该问题要求推导协变量 $X_j$ 的逆治疗概率加权（IPTW）标准化均数差（SMD）的单一、闭式解析表达式。推导过程必须基于所提供的定义。\n\n协变量 $j$ 的标准化均数差，记为 $SMD_j$，定义为治疗组和对照组之间协变量的加权均值之差，除以合并的加权标准差。用符号表示为：\n$$SMD_j = \\frac{\\bar{X}_{j,A=1,w} - \\bar{X}_{j,A=0,w}}{s_{p,j,w}}$$\n其中 $\\bar{X}_{j,A=1,w}$ 和 $\\bar{X}_{j,A=0,w}$ 分别是治疗组（$A=1$）和对照组（$A=0$）中协变量 $X_j$ 的加权均值，而 $s_{p,j,w}$ 是合并的加权标准差。\n\n我们将依次推导这三个组成部分。\n\n_1. 治疗组的加权均值 ($\\bar{X}_{j,A=1,w}$)_\n\n问题指定了治疗组个体 $i$（其中 $A_i=1$）的非稳定IPTW权重为 $w_i^{(1)} = A_i/e_i = 1/e_i$。加权平均值的一般公式为 $\\bar{Z}_v = \\frac{\\sum_{k=1}^n v_k Z_k}{\\sum_{k=1}^n v_k}$。为了计算治疗组的均值，我们将此公式应用于 $A_k=1$ 的个体子集，并使用其指定的权重。这等同于对从 $k=1$ 到 $n$ 的所有个体求和，并使用项 $A_k/e_k$ 作为权重，该权重仅对治疗组个体非零。\n令 $Z_k = X_{kj}$ 和 $v_k = A_k/e_k$，治疗组的加权均值为：\n$$\\bar{X}_{j,A=1,w} = \\frac{\\sum_{k=1}^{n} \\frac{A_k}{e_k} X_{kj}}{\\sum_{k=1}^{n} \\frac{A_k}{e_k}}$$\n\n_2. 对照组的加权均值 ($\\bar{X}_{j,A=0,w}$)_\n\n同样，对照组个体 $i$（其中 $A_i=0$）的权重为 $w_i^{(0)} = (1-A_i)/(1-e_i) = 1/(1-e_i)$。属于对照组的指示符为 $(1-A_k)$。应用加权均值公式，其中 $Z_k = X_{kj}$ 且 $v_k = (1-A_k)/(1-e_k)$：\n$$\\bar{X}_{j,A=0,w} = \\frac{\\sum_{k=1}^{n} \\frac{1-A_k}{1-e_k} X_{kj}}{\\sum_{k=1}^{n} \\frac{1-A_k}{1-e_k}}$$\n\n_3. 合并的加权标准差 ($s_{p,j,w}$)_\n\n合并的加权标准差是合并的加权方差的平方根，$s_{p,j,w} = \\sqrt{s_{p,j,w}^2}$。合并的加权方差是各组内加权方差的加权平均值。首先，我们必须计算每个组的方差。问题提供了权重内加权方差的公式：$\\sigma_v^2 = \\frac{\\sum_{i=1}^n v_i (Z_i - \\bar{Z}_v)^2}{\\sum_{i=1}^n v_i}$。\n\n对于治疗组，$v_i = A_i/e_i$，$Z_i = X_{ij}$，且 $\\bar{Z}_v = \\bar{X}_{j,A=1,w}$。加权方差为：\n$$s_{j,A=1,w}^2 = \\frac{\\sum_{i=1}^{n} \\frac{A_i}{e_i} (X_{ij} - \\bar{X}_{j,A=1,w})^2}{\\sum_{i=1}^{n} \\frac{A_i}{e_i}}$$\n\n对于对照组，$v_i = (1-A_i)/(1-e_i)$，$Z_i = X_{ij}$，且 $\\bar{Z}_v = \\bar{X}_{j,A=0,w}$。加权方差为：\n$$s_{j,A=0,w}^2 = \\frac{\\sum_{i=1}^{n} \\frac{1-A_i}{1-e_i} (X_{ij} - \\bar{X}_{j,A=0,w})^2}{\\sum_{i=1}^{n} \\frac{1-A_i}{1-e_i}}$$\n\n合并方差的概念可以扩展到加权情况，即合并各组的加权离差平方和，然后除以两组权重的总和。\n令 $N_1^w = \\sum_{i=1}^{n} A_i/e_i$ 为治疗组的权重之和，令 $N_0^w = \\sum_{i=1}^{n} (1-A_i)/(1-e_i)$ 为对照组的权重之和。\n治疗组的加权平方和（WSS）为 $WSS_1 = N_1^w s_{j,A=1,w}^2 = \\sum_{i=1}^{n} \\frac{A_i}{e_i} (X_{ij} - \\bar{X}_{j,A=1,w})^2$。对照组的WSS为 $WSS_0 = N_0^w s_{j,A=0,w}^2 = \\sum_{i=1}^{n} \\frac{1-A_i}{1-e_i} (X_{ij} - \\bar{X}_{j,A=0,w})^2$。合并的加权方差为 $s_{p,j,w}^2 = \\frac{WSS_1 + WSS_0}{N_1^w + N_0^w}$。代入表达式：\n$$s_{p,j,w}^2 = \\frac{\\sum_{i=1}^{n} \\frac{A_i}{e_i} (X_{ij} - \\bar{X}_{j,A=1,w})^2 + \\sum_{i=1}^{n} \\frac{1-A_i}{1-e_i} (X_{ij} - \\bar{X}_{j,A=0,w})^2}{\\sum_{i=1}^{n} \\frac{A_i}{e_i} + \\sum_{i=1}^{n} \\frac{1-A_i}{1-e_i}}$$\n这可以更紧凑地写为：\n$$s_{p,j,w}^2 = \\frac{\\sum_{i=1}^{n} \\left[ \\frac{A_i}{e_i} (X_{ij} - \\bar{X}_{j,A=1,w})^2 + \\frac{1-A_i}{1-e_i} (X_{ij} - \\bar{X}_{j,A=0,w})^2 \\right]}{\\sum_{i=1}^{n} \\left( \\frac{A_i}{e_i} + \\frac{1-A_i}{1-e_i} \\right)}$$\n合并的加权标准差是此表达式的平方根。\n\n_4. 组合最终表达式_\n\n通过将推导出的均值和合并标准差的表达式代入初始公式，即可获得IPTW加权SMD的最终表达式。问题要求提供一个不含中间符号的单一表达式。因此，必须将 $\\bar{X}_{j,A=1,w}$ 和 $\\bar{X}_{j,A=0,w}$ 的表达式代入 $s_{p,j,w}$ 的公式以及 $SMD_j$ 的分子中。为了避免嵌套求和中的歧义，使用了不同的求和索引（$i$ 和 $k$）。\n\n分子是 $\\left(\\frac{\\sum_{k=1}^{n} \\frac{A_k}{e_k} X_{kj}}{\\sum_{k=1}^{n} \\frac{A_k}{e_k}}\\right) - \\left(\\frac{\\sum_{k=1}^{n} \\frac{1-A_k}{1-e_k} X_{kj}}{\\sum_{k=1}^{n} \\frac{1-A_k}{1-e_k}}\\right)$。\n\n分母是 $\\sqrt{s_{p,j,w}^2}$，其中代入了均值的完整表达式：\n$$\\sqrt{\\frac{\\sum_{i=1}^{n} \\left[ \\frac{A_i}{e_i} \\left(X_{ij} - \\frac{\\sum_{k=1}^{n} \\frac{A_k}{e_k} X_{kj}}{\\sum_{k=1}^{n} \\frac{A_k}{e_k}}\\right)^2 + \\frac{1-A_i}{1-e_i} \\left(X_{ij} - \\frac{\\sum_{k=1}^{n} \\frac{1-A_k}{1-e_k} X_{kj}}{\\sum_{k=1}^{n} \\frac{1-A_k}{1-e_k}}\\right)^2 \\right]}{\\sum_{i=1}^{n} \\left( \\frac{A_i}{e_i} + \\frac{1-A_i}{1-e_i} \\right)}}$$\n\n将这些组合起来，便得到最终的、单一的闭式表达式。",
            "answer": "$$\\boxed{\\frac{\\frac{\\sum_{k=1}^{n} \\frac{A_k}{e_k} X_{kj}}{\\sum_{k=1}^{n} \\frac{A_k}{e_k}} - \\frac{\\sum_{k=1}^{n} \\frac{1-A_k}{1-e_k} X_{kj}}{\\sum_{k=1}^{n} \\frac{1-A_k}{1-e_k}}}{\\sqrt{\\frac{\\sum_{i=1}^{n} \\left[ \\frac{A_i}{e_i} \\left(X_{ij} - \\frac{\\sum_{k=1}^{n} \\frac{A_k}{e_k} X_{kj}}{\\sum_{k=1}^{n} \\frac{A_k}{e_k}}\\right)^2 + \\frac{1-A_i}{1-e_i} \\left(X_{ij} - \\frac{\\sum_{k=1}^{n} \\frac{1-A_k}{1-e_k} X_{kj}}{\\sum_{k=1}^{n} \\frac{1-A_k}{1-e_k}}\\right)^2 \\right]}{\\sum_{i=1}^{n} \\left( \\frac{A_i}{e_i} + \\frac{1-A_i}{1-e_i} \\right)}}}}$$"
        },
        {
            "introduction": "任何倾向性得分方法的有效性都取决于一个设定良好的倾向性得分模型。一个常见的误区是，建立这个模型的目标是最大化预测准确性，而不是平衡协变量这个真正的目标。这最后一个练习探讨了多种直接针对协变量平衡的原则性模型选择策略，帮助您为在自己的研究中建立和选择有效的倾向性得分模型打下坚实的基础。",
            "id": "4980943",
            "problem": "在一项关于抗高血压治疗的大型观察性队列研究中，令 $i \\in \\{1,\\dots,n\\}$ 为患者索引，$A_i \\in \\{0,1\\}$ 表示是否接受治疗，$X_i \\in \\mathbb{R}^p$ 表示治疗前的协变量（包括年龄、收缩压和身体质量指数等连续变量，以及性别和医院等分类变量），$Y_i$ 表示治疗开始后测量的临床结局。假设因果估计量是平均治疗效应，并假定满足以下标准的因果可识别性条件：一致性、可交换性（即，对于 $a \\in \\{0,1\\}$，$Y_i(a) \\perp A_i \\mid X_i$）和正性（即，对于 $X_i$ 支持集中的所有 $x$，$0  \\mathbb{P}(A_i=1 \\mid X_i=x)  1$）。定义倾向性得分 $e(X) = \\mathbb{P}(A=1 \\mid X)$，并考虑通过逻辑回归模型来估计 $e(X)$：\n$$\n\\mathrm{logit}(e(X)) = \\beta_0 + \\beta^\\top f(X),\n$$\n其中 $f(X)$ 是原始协变量 $X$ 的一个预先设定的基函数向量（例如，变换、用于连续协变量的限制性三次样条，以及选定的交互项）。计划使用治疗概率倒数加权 (IPTW)（权重为 $w_i = \\dfrac{A_i}{\\hat{e}(X_i)} + \\dfrac{1-A_i}{1 - \\hat{e}(X_i)}$）和按 $\\hat{e}(X)$ 的区间进行倾向性得分分层来进行协变量调整。\n\n从倾向性得分的定义以及在上述可识别性条件下 IPTW 和分层的性质出发，论述应如何选择 $f(X)$ 以实现治疗组和未治疗组之间的协变量平衡，而不仅仅是最大化给定 $X$ 时对 $A$ 的预测拟合度。以下哪些关于 $f(X)$ 的模型构建和选择策略是旨在实现协变量平衡的有原则的方法？\n\n选择所有适用项。\n\nA. 选择 $f(X)$ 以最大化用于分类 $A$ 的受试者工作特征曲线下面积 (AUC)，使用标准的K折交叉验证，基于预测对数似然或错分误差，而不考虑加权后的不平衡性。\n\nB. 指定 $f(X)$ 包含用于连续协变量的限制性三次样条（节点位于经验分位数）和具有临床动机的交互作用，并执行K折交叉验证，其中损失函数是使用 $\\hat{e}(X)$ 进行 IPTW 后，$A=1$ 和 $A=0$ 组之间协变量的平均绝对标准化差异；选择能最小化此关注不平衡性损失的 $f(X)$。\n\nC. 使用协变量平衡倾向性得分 (CBPS) 方法，该方法通过求解估计方程来估计 $\\beta$，这些估计方程通过强制 $A=1$ 和 $A=0$ 组之间加权协变量均值相等的矩条件来增强逻辑斯蒂得分；选择足够丰富的 $f(X)$（例如，样条和交互作用），以使这些平衡约束得以满足。\n\nD. 为 $\\hat{e}(X)$ 构建一个基于灵活学习器库（例如，带样条的惩罚逻辑回归、梯度提升机和广义可加模型）的 Super Learner 集成模型，并执行V折交叉验证，其损失函数定义为将受试者按 $\\hat{e}(X)$ 的十分位数分层后，所有协变量中的最大标准化差异；选择能最小化此基于分层的不平衡性的集成模型及其 $f(X)$ 组件。\n\nE. 通过在关于 $A$ 的逻辑回归中最小化贝叶斯信息准则 (BIC) 来选择 $f(X)$，然后丢弃稳定化 IPTW 权重超过 10 的受试者以改善重叠；接受所选的 $f(X)$，因为即使仅使用预测性标准，截尾也能减少不平衡和极端权重。",
            "solution": "该问题陈述被评估为有效。它呈现了一个使用观察性数据进行因果推断的标准场景，并就倾向性得分模型设定的原则提出了一个定义明确、客观且有科学依据的问题。所使用的概念和术语在统计学和流行病学领域是标准的。\n\n倾向性得分方法（如治疗概率倒数加权 (IPTW) 和分层）的核心原则是在治疗组和未治疗组之间实现协变量平衡。倾向性得分 $e(X) = \\mathbb{P}(A=1 \\mid X)$ 是一个平衡得分，意味着在给定真实 $e(X)$ 的条件下，协变量 $X$ 的分布独立于治疗状态 $A$。即，$X \\perp A \\mid e(X)$。\n\n在实践中，真实的倾向性得分是未知的，必须通过模型进行估计，得到 $\\hat{e}(X)$。$\\hat{e}(X)$ 对于因果推断的效用不取决于它预测治疗 $A$ 的效果有多好，而取决于它在多大程度上平衡了所测量的协变量。一个能极好预测 $A$ 的 $e(X)$ 模型可能导致估计的倾向性得分接近 0 或 1，这在实践中违反了正性假设，导致 IPTW 的极端权重，并产生不稳定和有偏的治疗效应估计。因此，有原则的倾向性得分模型构建策略必须优先考虑实现协变量平衡的目标。这通常被描述为将焦点从“预测”转向“平衡”。\n\n我们现在将根据这一原则评估每个提议的策略。\n\nA. 选择 $f(X)$ 以最大化用于分类 $A$ 的受试者工作特征曲线下面积 (AUC)，使用标准的K折交叉验证，基于预测对数似然或错分误差，而不考虑加权后的不平衡性。\n\n该策略明确地专注于最大化倾向性得分模型对治疗分配 $A$ 的预测性能。像 AUC、对数似然和错分误差等指标是衡量对结果 $A$ 的区分度或校准度的度量。如前所述，用于因果推断的倾向性得分估计的主要目标不是预测治疗，而是平衡协变量。一个在预测治疗方面“过于出色”的模型可能导致重叠性差（实际违反了正性假设）和极端权重，从而导致效应估计的方差增加和潜在的偏倚。这种方法完全忽略了对协变量平衡的直接评估，而这正是一个有用的倾向性得分模型的关键诊断标准。因果推断方法论中的现代共识强烈建议不要使用以预测为导向的指标来选择倾向性得分模型。\n\n结论：**错误**。\n\nB. 指定 $f(X)$ 包含用于连续协变量的限制性三次样条（节点位于经验分位数）和具有临床动机的交互作用，并执行K折交叉验证，其中损失函数是使用 $\\hat{e}(X)$ 进行 IPTW 后，$A=1$ 和 $A=0$ 组之间协变量的平均绝对标准化差异；选择能最小化此关注不平衡性损失的 $f(X)$。\n\n该策略直接将以协变量平衡为目标的原则付诸实施。它首先提出了一个灵活的模型结构（包含样条和交互作用的 $f(X)$），能够捕捉复杂的关系。关键在于，交叉验证过程中使用的模型选择标准是加权后协变量不平衡的直接度量，即平均绝对标准化差异 (ASMD)。单个协变量 $X_j$ 的 ASMD 由 $\\left| \\frac{\\sum_{i:A_i=1} w_i X_{ij}}{\\sum_{i:A_i=1} w_i} - \\frac{\\sum_{i:A_i=0} w_i X_{ij}}{\\sum_{i:A_i=0} w_i} \\right| / \\sqrt{\\frac{s_{j,1}^2 + s_{j,0}^2}{2}}$ 给出，其中 $s_{j,1}^2$ 和 $s_{j,0}^2$ 是治疗组和未治疗组中的未加权样本方差。通过选择最小化这种以平衡为重点的损失函数的模型设定，该程序被明确且直接地优化，以满足有效因果估计所需的属性。这是一种合理且有原则的方法。\n\n结论：**正确**。\n\nC. 使用协变量平衡倾向性得分 (CBPS) 方法，该方法通过求解估计方程来估计 $\\beta$，这些估计方程通过强制 $A=1$ 和 $A=0$ 组之间加权协变量均值相等的矩条件来增强逻辑斯蒂得分；选择足够丰富的 $f(X)$（例如，样条和交互作用），以使这些平衡约束得以满足。\n\n协变量平衡倾向性得分 (CBPS) 是一种专门设计用于弥合倾向性得分模型拟合与协变量平衡之间差距的方法。标准的两步法首先通过最大化治疗分配模型的似然来估计倾向性得分参数 $\\beta$，然后检查平衡性。相比之下，CBPS 通过求解一组估计方程来估计 $\\beta$，这组方程同时包含了逻辑回归模型（与预测相关）的得分函数和一组直接强制协变量平衡的矩条件。对于一组平衡协变量 $g(X)$，这些矩条件通常形式为 $\\sum_{i=1}^n \\left( \\frac{A_i g(X_i)}{\\hat{e}(X_i)} - \\frac{(1-A_i) g(X_i)}{1-\\hat{e}(X_i)} \\right) = 0$。通过将平衡标准直接构建到参数估计步骤中，CBPS 确保了最终的倾向性得分是为平衡而优化的。选择一个足够丰富的基 $f(X)$ 可以使这些约束对广泛的协变量函数都得到满足。这代表了一种高度有原则、一体化的实现协变量平衡的方法。\n\n结论：**正确**。\n\nD. 为 $\\hat{e}(X)$ 构建一个基于灵活学习器库（例如，带样条的惩罚逻辑回归、梯度提升机和广义可加模型）的 Super Learner 集成模型，并执行V折交叉验证，其损失函数定义为将受试者按 $\\hat{e}(X)$ 的十分位数分层后，所有协变量中的最大标准化差异；选择能最小化此基于分层的不平衡性的集成模型及其 $f(X)$ 组件。\n\n该策略是与选项 B 中相同的核心原则的一种复杂应用。它使用 Super Learner，一种集成机器学习方法，从候选算法库中创建一个灵活的倾向性得分估计。这降低了错误指定单个参数模型的风险。其关键特征是用于交叉验证的损失函数的选择，该损失函数决定了集成模型中学习器的最优组合。该损失被定义为协变量不平衡的度量——在本例中，是在由 $\\hat{e}(X)$ 定义的分层内，所有协变量的最大标准化差异。就像选项 B 中的 ASMD 一样，这是一个直接衡量估计的倾向性得分在执行其平衡协变量功能方面表现如何的度量。通过优化集成模型以最小化此不平衡度量，该程序是有原则的，并且专注于正确的目标。\n\n结论：**正确**。\n\nE. 通过在关于 $A$ 的逻辑回归中最小化贝叶斯信息准则 (BIC) 来选择 $f(X)$，然后丢弃稳定化 IPTW 权重超过 10 的受试者以改善重叠；接受所选的 $f(X)$，因为即使仅使用预测性标准，截尾也能减少不平衡和极端权重。\n\n这个策略是有缺陷的。最初对 $f(X)$ 的模型选择是基于最小化 BIC。与 AUC 和 AIC 一样，BIC 是一个为结果 $A$ 选择良好预测模型的标准，它在拟合度和模型复杂性之间进行权衡。它不以协变量平衡为目标。这与选项 A 中的基本错误相同。第二步，修剪权重过大的受试者（例如，稳定化权重 > 10），是一种事后干预措施，用于处理可能不良的倾向性得分模型（即实际的正性违规）带来的后果。虽然修剪有时可以提高估计量的稳定性，但它不能替代从一开始就正确地构建模型。依赖修剪来修复一个基于错误标准选择的模型是一种临时的、无原则的方法。此外，修剪通过将分析限制在原始总体的子集上而改变了估计量，这可能会引入其自身的偏倚。核心的模型构建步骤并非旨在实现平衡。\n\n结论：**错误**。",
            "answer": "$$\\boxed{BCD}$$"
        }
    ]
}