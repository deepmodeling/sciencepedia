{
    "hands_on_practices": [
        {
            "introduction": "边际结构模型 (Marginal Structural Models, MSMs) 的基石是使用逆概率治疗加权 (Inverse Probability of Treatment Weighting, IPTW) 来创建一个消除了时变混杂的“伪人群”。本练习提供了直接的上手实践，让您在一个简单的纵向场景中，根据第一性原理计算该方法的核心组成部分——非稳定权重和稳定权重。掌握这一计算是实施和理解边际结构模型的第一步 。",
            "id": "4971107",
            "problem": "考虑一项医学中的观察性纵向队列研究，其中包含一个二元、时变处理过程 $\\{A_{t}: t=0,1\\}$ 和时变协变量（潜在混杂因素） $\\{L_{t}: t=0,1\\}$。测量的时序为 $L_{0}$，然后是 $A_{0}$，接着是 $L_{1}$，最后是 $A_{1}$。假设一致性、正值性和序贯可交换性等因果识别条件成立，并且数据生成过程遵循指定的时间顺序，因此在给定历史信息的情况下，条件处理分配概率是良好定义的。目标是拟合一个边际结构模型（MSM），并使用逆处理概率加权（IPTW）方法构建权重，以消除 $\\{L_{t}\\}$ 带来的混杂，同时保留边际处理过程。\n\n对于一个观测历史为 $(L_{0}=1, A_{0}=1, L_{1}=1, A_{1}=1)$ 且时间范围为 $T=2$ 的特定个体，假设以下处理分配概率成立：\n- 基线边际处理概率 $P(A_{0}=1)=0.6$，\n- 给定基线协变量的基线条件处理概率 $P(A_{0}=1 \\mid L_{0}=1)=0.8$，\n- 给定既往处理的随访边际处理概率 $P(A_{1}=1 \\mid A_{0}=1)=0.7$，\n- 给定既往处理和当前协变量的随访条件处理概率 $P(A_{1}=1 \\mid A_{0}=1, L_{1}=1)=0.9$。\n\n使用条件概率的核心定义以及IPTW用于MSM的目的，从第一性原理推导该个体的非稳定权重 $w_{u}$ 和稳定权重 $w_{s}$ 的表达式，然后计算它们的精确值。将您的最终答案以单行矩阵的形式表示为最简分数。无需四舍五入；提供精确值。",
            "solution": "首先验证问题，以确保其具有科学依据、是良定的和客观的。\n\n### 步骤1：提取已知条件\n- **研究背景**：一项包含二元、时变处理 $\\{A_{t}: t=0,1\\}$ 和时变协变量 $\\{L_{t}: t=0,1\\}$ 的观察性纵向队列研究。\n- **时间顺序**：$L_{0}$，然后是 $A_{0}$，接着是 $L_{1}$，最后是 $A_{1}$。\n- **因果假设**：假设一致性、正值性和序贯可交换性成立。\n- **目标**：使用逆处理概率加权（IPTW）拟合边际结构模型（MSM）。\n- **特定个体数据**：一个具有观测历史 $(L_{0}=1, A_{0}=1, L_{1}=1, A_{1}=1)$ 的个体。\n- **时间范围**：$T=2$，鉴于给定的变量，对应于离散时间点 $t=0, 1$。\n- **概率**：\n  - $P(A_{0}=1)=0.6$\n  - $P(A_{0}=1 \\mid L_{0}=1)=0.8$\n  - $P(A_{1}=1 \\mid A_{0}=1)=0.7$\n  - $P(A_{1}=1 \\mid A_{0}=1, L_{1}=1)=0.9$\n\n### 步骤2：使用提取的已知条件进行验证\n该问题是IPTW在MSM中的一个标准应用，这是因果推断和生物统计学中的一种成熟方法。所有提供的概念和术语在该领域都是标准的。该问题是自洽的，因为计算指定个体权重所需的所有必要概率都已提供。不存在内部矛盾；所有概率都是介于 $0$ 和 $1$ 之间的有效值。问题结构清晰，要求计算两个特定的、良好定义的量（$w_u$ 和 $w_s$）。该问题不违反任何科学原理，是可形式化的，并且是客观陈述的。\n\n### 步骤3：结论与行动\n问题被认为是有效的。将从第一性原理推导解答。\n\n### 解答的推导\n目标是使用逆处理概率加权（IPTW）方法为特定个体计算非稳定权重（$w_{u}$）和稳定权重（$w_{s}$）。IPTW创建了一个伪总体，在该总体中，时变混杂因素 $L_t$ 不能预测后续的处理 $A_t$，从而消除了随时变的混杂。\n\n令 $\\bar{A}_k = (A_0, A_1, \\dots, A_k)$ 表示到时间点 $k$ 为止的处理历史，$\\bar{L}_k = (L_0, L_1, \\dots, L_k)$ 表示协变量历史。对于一个具有到最终时间点 $K$ 的观测历史的个体，其权重的一般形式由各时间点特定概率的乘积给出。\n\n非稳定权重 $w_{u}$ 定义为在给定既往处理和混杂因素历史的情况下，个体在每个时间点接受到其所观测到的处理的条件概率乘积的倒数。\n$$w_{u} = \\prod_{k=0}^{K} \\frac{1}{P(A_{k}=a_{k} \\mid \\bar{A}_{k-1}=\\bar{a}_{k-1}, \\bar{L}_{k}=\\bar{l}_{k})}$$\n\n稳定权重 $w_{s}$ 对此进行了修改，它在分子上包含一个项，该项是仅给定既往处理历史的条件下，个体接受到其所观测到的处理的条件概率的乘积。这种稳定化处理能减小方差，并通常使得权重的期望值为 $1$。\n$$w_{s} = \\prod_{k=0}^{K} \\frac{P(A_{k}=a_{k} \\mid \\bar{A}_{k-1}=\\bar{a}_{k-1})}{P(A_{k}=a_{k} \\mid \\bar{A}_{k-1}=\\bar{a}_{k-1}, \\bar{L}_{k}=\\bar{l}_{k})}$$\n\n在本问题中，时间范围包含两个时间点 $t=0$ 和 $t=1$，因此我们设 $K=1$。该个体的观测历史为 $(L_{0}=1, A_{0}=1, L_{1}=1, A_{1}=1)$。因此，$a_0=1, l_0=1, a_1=1, l_1=1$。\n\n对于 $k=0$，历史 $\\bar{A}_{-1}$ 是空的。公式变为：\n$$w_{u} = \\frac{1}{P(A_{0}=a_{0} \\mid L_{0}=l_{0}) \\times P(A_{1}=a_{1} \\mid A_{0}=a_{0}, \\bar{L}_{1}=\\bar{l}_{1})}$$\n$$w_{s} = \\frac{P(A_{0}=a_{0}) \\times P(A_{1}=a_{1} \\mid A_{0}=a_{0})}{P(A_{0}=a_{0} \\mid L_{0}=l_{0}) \\times P(A_{1}=a_{1} \\mid A_{0}=a_{0}, \\bar{L}_{1}=\\bar{l}_{1})}$$\n\n问题提供了 $P(A_{1}=1 \\mid A_{0}=1, L_{1}=1)=0.9$。这隐含了一个特定的处理分配模型，其中 $A_1$ 的概率取决于当前的混杂因素 $L_1$ 和既往处理 $A_0$，但不取决于基线混杂因素 $L_0$。即，$P(A_{1}=a_{1} \\mid A_{0}=a_{0}, \\bar{L}_{1}=\\bar{l}_{1}) = P(A_{1}=a_{1} \\mid A_{0}=a_{0}, L_{1}=l_{1})$。这是一种常见且有效的设定。\n\n现在我们可以为该特定个体代入给定的概率。\n\n**非稳定权重（$w_{u}$）的计算**\n\n对于历史为 $(L_{0}=1, A_{0}=1, L_{1}=1, A_{1}=1)$ 的个体，权重的分母是以下两项的乘积：\n1. $P(A_{0}=1 \\mid L_{0}=1) = 0.8$\n2. $P(A_{1}=1 \\mid A_{0}=1, L_{1}=1) = 0.9$\n\n因此，非稳定权重为：\n$$w_{u} = \\frac{1}{P(A_{0}=1 \\mid L_{0}=1) \\times P(A_{1}=1 \\mid A_{0}=1, L_{1}=1)}$$\n$$w_{u} = \\frac{1}{0.8 \\times 0.9} = \\frac{1}{0.72}$$\n将其表示为最简分数：\n$$w_{u} = \\frac{1}{\\frac{72}{100}} = \\frac{100}{72} = \\frac{25 \\times 4}{18 \\times 4} = \\frac{25}{18}$$\n\n**稳定权重（$w_{s}$）的计算**\n\n$w_{s}$ 的分母与用于 $w_{u}$ 的分母相同。分子是以下两项的乘积：\n1. $P(A_{0}=1) = 0.6$\n2. $P(A_{1}=1 \\mid A_{0}=1) = 0.7$\n\n因此，稳定权重为：\n$$w_{s} = \\frac{P(A_{0}=1) \\times P(A_{1}=1 \\mid A_{0}=1)}{P(A_{0}=1 \\mid L_{0}=1) \\times P(A_{1}=1 \\mid A_{0}=1, L_{1}=1)}$$\n$$w_{s} = \\frac{0.6 \\times 0.7}{0.8 \\times 0.9} = \\frac{0.42}{0.72}$$\n将其表示为最简分数：\n$$w_{s} = \\frac{42}{72} = \\frac{7 \\times 6}{12 \\times 6} = \\frac{7}{12}$$\n\n该个体的非稳定权重为 $w_{u} = \\frac{25}{18}$，稳定权重为 $w_{s} = \\frac{7}{12}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{25}{18} & \\frac{7}{12} \\end{pmatrix}}$$"
        },
        {
            "introduction": "在采用像边际结构模型这样复杂的方法之前，理解为何简单、常规的方法（如标准回归调整）会失效至关重要，尤其是在存在受既往治疗影响的时变混杂因素时。本练习通过一个结构方程模型，构建了一个清晰且可量化的对撞偏倚 (collider bias) 场景，这是在朴素地调整此类混杂因素时常见的问题。通过计算确切的偏倚，您将更深刻地理解为何某些因果路径的存在使得边际结构模型的应用成为必需 。",
            "id": "5209133",
            "problem": "一个医学数据科学团队正在使用医院电子记录评估一种时变抗菌药物剂量策略。设入院时的基线剂量表示为 $A_0$，第1天的剂量表示为 $A_1$。设 $L_1$ 为第1天的一个生理生物标志物，它既影响第1天剂量的选择，也影响康复，并且它本身也受基线剂量的影响。设 $U$ 为一个未测量的患者脆弱性因素，它既影响生物标志物也影响康复。结果 $Y$ 是出院时康复的一个连续度量。考虑以下线性结构方程，其误差项为独立的、均值为零、单位方差的高斯误差：\n$$\nL_1 \\;=\\; \\gamma_0\\,A_0 \\;+\\; \\gamma_U\\,U \\;+\\; \\varepsilon_L,\\quad\nA_1 \\;=\\; \\delta_0\\,L_1 \\;+\\; \\varepsilon_A,\\quad\nY \\;=\\; \\beta_0\\,A_0 \\;+\\; \\beta_1\\,A_1 \\;+\\; \\beta_L\\,L_1 \\;+\\; \\beta_U\\,U \\;+\\; \\varepsilon_Y,\n$$\n其中 $A_0 \\sim \\mathcal{N}(0,1)$、$U \\sim \\mathcal{N}(0,1)$、$\\varepsilon_L \\sim \\mathcal{N}(0,1)$、$\\varepsilon_A \\sim \\mathcal{N}(0,1)$ 和 $\\varepsilon_Y \\sim \\mathcal{N}(0,1)$ 相互独立。设参数固定为\n$$\n\\gamma_0 = 1,\\quad \\gamma_U = 1,\\quad \\delta_0 = 1,\\quad \\beta_0 = 0,\\quad \\beta_1 = 1,\\quad \\beta_L = 0,\\quad \\beta_U = 1.\n$$\n因果目标是在标准潜在结果框架（一致性、正值性和序贯可交换性）下，由潜在结果回归 $E\\!\\left[Y^{(a_0,a_1)}\\right] = \\theta_0 + \\theta_{a0}\\,a_0 + \\theta_{a1}\\,a_1$ 定义的边际结构模型 (MSM) 中的基线处理参数，其中 $Y^{(a_0,a_1)}$ 表示如果 $(A_0,A_1)$ 被设置为 $(a_0,a_1)$ 时将观察到的结果。\n\n在这种情况下，临床医生可能会通过使用普通最小二乘法 (OLS) 拟合 $Y$ 对 $(A_0, A_1, L_1)$ 的线性模型来进行普通回归调整，即使 $L_1$ 受到 $A_0$ 和 $U$ 的影响，该模型仍以 $L_1$ 为条件。这种条件化会引起对撞偏倚，因为 $L_1$ 接收来自 $A_0$ 和 $U$ 的箭头。\n\n从结构方程以及潜在结果和联合高斯变量的线性OLS投影的定义出发，计算 $Y$ 对 $(A_0, A_1, L_1)$ 的回归中 $A_0$ 的OLS系数，然后计算该OLS系数相对于MSM参数 $\\theta_{a0}$ 的偏差。请将偏差以单个实数的形式给出。无需四舍五入。",
            "solution": "该场景是一个时变处理问题，其中时变协变量 $L_1$ 受先前处理 $A_0$ 的影响，并影响未来的处理 $A_1$ 和结果 $Y$。其有向无环图 (DAG) 包含箭头 $A_0 \\rightarrow L_1 \\rightarrow A_1 \\rightarrow Y$、$U \\rightarrow L_1$ 和 $U \\rightarrow Y$。以 $L_1$ 为条件会在 $L_1$ 处造成 $A_0$ 和 $U$ 之间的对撞，从而在给定 $L_1$ 的情况下，$A_0$ 和 $U$ 之间产生依赖性；由于 $U$ 也影响 $Y$，这会在 $A_0$ 的回归系数中引入偏差。\n\n因果目标是边际结构模型中的基线MSM参数 $\\theta_{a0}$\n$$\nE\\!\\left[Y^{(a_0,a_1)}\\right] \\;=\\; \\theta_0 + \\theta_{a0}\\,a_0 + \\theta_{a1}\\,a_1.\n$$\n在指定的结构方程和一致性假设下，设置 $(A_0,A_1)=(a_0,a_1)$ 会得到\n$$\nY^{(a_0,a_1)} \\;=\\; \\beta_0\\,a_0 \\;+\\; \\beta_1\\,a_1 \\;+\\; \\beta_L\\,L_1^{(a_0)} \\;+\\; \\beta_U\\,U \\;+\\; \\varepsilon_Y,\n$$\n其中 $L_1^{(a_0)} = \\gamma_0\\,a_0 + \\gamma_U\\,U + \\varepsilon_L$。代入给定的参数 $\\beta_0 = 0$ 和 $\\beta_L = 0$ 可得\n$$\nY^{(a_0,a_1)} \\;=\\; \\beta_1\\,a_1 \\;+\\; \\beta_U\\,U \\;+\\; \\varepsilon_Y \\;=\\; a_1 \\;+\\; U \\;+\\; \\varepsilon_Y,\n$$\n所以\n$$\nE\\!\\left[Y^{(a_0,a_1)}\\right] \\;=\\; a_1,\n$$\n因此，真实的MSM参数为 $\\theta_{a0} = 0$ 和 $\\theta_{a1} = 1$（在均值为零的外生误差下，$\\theta_0 = 0$）。\n\n我们现在计算 $Y$ 对 $(A_0, A_1, L_1)$ 的回归中 $A_0$ 的普通最小二乘 (OLS) 系数。对于联合高斯、均值为零的变量，OLS系数向量等于 $\\Sigma_{X}^{-1}\\Sigma_{XY}$，其中 $X=(A_0, A_1, L_1)$，$\\Sigma_X$ 是 $X$ 的协方差矩阵，$\\Sigma_{XY}$ 是 $X$ 与 $Y$ 的协方差向量。\n\n首先，从参数推导出隐含的线性形式：\n$$\nL_1 \\;=\\; A_0 + U + \\varepsilon_L,\\quad\nA_1 \\;=\\; L_1 + \\varepsilon_A \\;=\\; A_0 + U + \\varepsilon_L + \\varepsilon_A,\\quad\nY \\;=\\; A_1 + U + \\varepsilon_Y \\;=\\; A_0 + 2U + \\varepsilon_L + \\varepsilon_A + \\varepsilon_Y.\n$$\n利用独立性和单位方差，计算方差和协方差：\n- 方差：\n$$\n\\operatorname{Var}(A_0) = 1,\\quad \\operatorname{Var}(U) = 1,\\quad \\operatorname{Var}(\\varepsilon_L) = 1,\\quad \\operatorname{Var}(\\varepsilon_A) = 1,\\quad \\operatorname{Var}(\\varepsilon_Y) = 1.\n$$\n$$\n\\operatorname{Var}(L_1) = \\operatorname{Var}(A_0)+\\operatorname{Var}(U)+\\operatorname{Var}(\\varepsilon_L) = 3,\n$$\n$$\n\\operatorname{Var}(A_1) = \\operatorname{Var}(L_1)+\\operatorname{Var}(\\varepsilon_A) = 4,\n$$\n$$\n\\operatorname{Var}(Y) = \\operatorname{Var}(A_0)+4\\operatorname{Var}(U)+\\operatorname{Var}(\\varepsilon_L)+\\operatorname{Var}(\\varepsilon_A)+\\operatorname{Var}(\\varepsilon_Y) = 8.\n$$\n- 协方差：\n$$\n\\operatorname{Cov}(A_0,L_1) = 1,\\quad \\operatorname{Cov}(A_0,A_1) = 1,\\quad \\operatorname{Cov}(A_0,Y) = 1,\n$$\n$$\n\\operatorname{Cov}(L_1,A_1) = \\operatorname{Var}(L_1) = 3,\\quad \\operatorname{Cov}(L_1,U) = 1,\n$$\n$$\n\\operatorname{Cov}(L_1,Y) = \\operatorname{Cov}(L_1,A_1)+\\operatorname{Cov}(L_1,U) = 3+1 = 4,\n$$\n$$\n\\operatorname{Cov}(A_1,Y) = \\operatorname{Var}(A_1) + \\operatorname{Cov}(A_1,U) = 4 + 1 = 5.\n$$\n构建协方差矩阵 $\\Sigma_X$ 和向量 $\\Sigma_{XY}$：\n$$\n\\Sigma_X \\;=\\;\n\\begin{pmatrix}\n\\operatorname{Var}(A_0) & \\operatorname{Cov}(A_0,A_1) & \\operatorname{Cov}(A_0,L_1) \\\\\n\\operatorname{Cov}(A_0,A_1) & \\operatorname{Var}(A_1) & \\operatorname{Cov}(A_1,L_1) \\\\\n\\operatorname{Cov}(A_0,L_1) & \\operatorname{Cov}(A_1,L_1) & \\operatorname{Var}(L_1)\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n1 & 1 & 1 \\\\\n1 & 4 & 3 \\\\\n1 & 3 & 3\n\\end{pmatrix},\n$$\n$$\n\\Sigma_{XY} \\;=\\;\n\\begin{pmatrix}\n\\operatorname{Cov}(A_0,Y) \\\\\n\\operatorname{Cov}(A_1,Y) \\\\\n\\operatorname{Cov}(L_1,Y)\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n1 \\\\ 5 \\\\ 4\n\\end{pmatrix}.\n$$\n对 $\\Sigma_X$ 求逆。其行列式为\n$$\n\\det(\\Sigma_X) \\;=\\; 1\\cdot(4\\cdot 3 - 3\\cdot 3) - 1\\cdot(1\\cdot 3 - 1\\cdot 3) + 1\\cdot(1\\cdot 3 - 4\\cdot 1) \\;=\\; 3 - 0 - 1 \\;=\\; 2.\n$$\n伴随矩阵（余子式转置）为\n$$\n\\operatorname{Adj}(\\Sigma_X) \\;=\\;\n\\begin{pmatrix}\n3 & 0 & -1 \\\\\n0 & 2 & -2 \\\\\n-1 & -2 & 3\n\\end{pmatrix},\n$$\n所以\n$$\n\\Sigma_X^{-1} \\;=\\; \\frac{1}{2}\n\\begin{pmatrix}\n3 & 0 & -1 \\\\\n0 & 2 & -2 \\\\\n-1 & -2 & 3\n\\end{pmatrix}.\n$$\n$Y$ 对 $(A_0, A_1, L_1)$ 回归的OLS系数向量 $b$ 是\n$$\nb \\;=\\; \\Sigma_X^{-1}\\Sigma_{XY}\n\\;=\\;\n\\frac{1}{2}\n\\begin{pmatrix}\n3 & 0 & -1 \\\\\n0 & 2 & -2 \\\\\n-1 & -2 & 3\n\\end{pmatrix}\n\\begin{pmatrix}\n1 \\\\ 5 \\\\ 4\n\\end{pmatrix}\n\\;=\\;\n\\frac{1}{2}\n\\begin{pmatrix}\n3\\cdot 1 + 0\\cdot 5 - 1\\cdot 4 \\\\\n0\\cdot 1 + 2\\cdot 5 - 2\\cdot 4 \\\\\n-1\\cdot 1 - 2\\cdot 5 + 3\\cdot 4\n\\end{pmatrix}\n\\;=\\;\n\\frac{1}{2}\n\\begin{pmatrix}\n-1 \\\\ 2 \\\\ 1\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n-0.5 \\\\ 1 \\\\ 0.5\n\\end{pmatrix}.\n$$\n因此，$A_0$ 的OLS系数是 $-0.5$。基线处理的真实MSM参数是 $\\theta_{a0} = 0$，所以以 $L_1$ 为条件的普通回归调整的偏差是\n$$\nb_{A_0} - \\theta_{a0} \\;=\\; -0.5 - 0 \\;=\\; -0.5.\n$$\n在这个明确的场景中，偏差的方向是负的，这表明了以受先前处理 $A_0$ 和未测量脆弱性 $U$ 影响的 $L_1$ 为条件所引起的对撞偏倚。",
            "answer": "$$\\boxed{-0.5}$$"
        },
        {
            "introduction": "虽然逆概率治疗加权是调整混杂的强大工具，但它也伴随着代价：可能损失统计精度。引入权重意味着某些个体在分析中的贡献大于其他个体，这可能导致估计量方差的膨胀。本练习介绍了有效样本量 (Effective Sample Size, ESS) 的概念，这是一个量化这种精度损失的关键诊断指标。通过为一组给定的权重计算有效样本量，您将学到一项评估边际结构模型稳定性及最终推断可靠性的实用技能 。",
            "id": "5209085",
            "problem": "考虑一个心血管医学中的观察性队列研究，其中患者在三次门诊随访中接受动态调整的抗高血压治疗。拟合一个边际结构模型（MSM）来估计治疗方案对收缩压的因果效应，该模型使用根据基线和每次随访中测量的时变协变量构建的稳定的治疗逆概率权重。设一个包含 $N=10$ 名患者的样本的稳定权重，该权重是通过将三次随访中每次访视的稳定权重相乘得到的，其值为\n$$\nw_1=0.8,\\quad w_2=0.9,\\quad w_3=1.0,\\quad w_4=1.1,\\quad w_5=1.2,\\quad w_6=0.7,\\quad w_7=1.3,\\quad w_8=1.4,\\quad w_9=0.6,\\quad w_{10}=1.0.\n$$\n假设潜在结局是在MSM估计的通常假设下生成的：一致性、在给定测量协变量下的条件可交换性以及正性。为了评估精度，进一步假设个体间的观测结局 $Y_i$ 是独立同分布的，其方差为 $\\operatorname{Var}(Y_i)=\\sigma^2 < \\infty$，并且加权均值估计量形式为 $\\hat{\\mu}_w=\\left(\\sum_{i=1}^{N} w_i Y_i\\right)/\\left(\\sum_{i=1}^{N} w_i\\right)$。\n\n从独立随机变量线性组合的方差定义和未加权样本均值的方差出发，推导加权估计量的有效样本量 $ESS$ 关于 $\\{w_i\\}_{i=1}^{N}$ 的闭式表达式。然后，使用推导出的表达式，为给定的权重计算 $ESS$ 的数值。将最终数值答案四舍五入到四位有效数字。无需单位。",
            "solution": "该问题要求推导加权均值估计量的有效样本量（$ESS$）的闭式表达式，并随后为一组给定的权重计算其数值。\n\n出发点是样本量为 $N$ 的加权均值估计量 $\\hat{\\mu}_w$ 的定义：\n$$\n\\hat{\\mu}_w = \\frac{\\sum_{i=1}^{N} w_i Y_i}{\\sum_{i=1}^{N} w_i}\n$$\n在此表达式中，权重 $\\{w_i\\}_{i=1}^{N}$ 被视为从协变量数据中导出的固定、非随机的量，而结局 $\\{Y_i\\}_{i=1}^{N}$ 是随机变量。\n\n为了推导 $\\hat{\\mu}_w$ 的方差，我们可以将权重之和定义为一个常数 $W = \\sum_{i=1}^{N} w_i$。然后，该估计量可以写成随机变量 $Y_i$ 的线性组合：\n$$\n\\hat{\\mu}_w = \\frac{1}{W} \\sum_{i=1}^{N} w_i Y_i\n$$\n该估计量的方差可以通过使用性质 $\\operatorname{Var}(cZ) = c^2 \\operatorname{Var}(Z)$（其中 $c$ 是一个常数）来求得：\n$$\n\\operatorname{Var}(\\hat{\\mu}_w) = \\operatorname{Var}\\left(\\frac{1}{W} \\sum_{i=1}^{N} w_i Y_i\\right) = \\frac{1}{W^2} \\operatorname{Var}\\left(\\sum_{i=1}^{N} w_i Y_i\\right)\n$$\n问题陈述结局 $Y_i$ 是独立的。对于独立的随机变量，和的方差等于方差的和。因此，\n$$\n\\operatorname{Var}\\left(\\sum_{i=1}^{N} w_i Y_i\\right) = \\sum_{i=1}^{N} \\operatorname{Var}(w_i Y_i)\n$$\n再次使用性质 $\\operatorname{Var}(aZ) = a^2 \\operatorname{Var}(Z)$，其中每个项的 $w_i$ 是一个常数：\n$$\n\\sum_{i=1}^{N} \\operatorname{Var}(w_i Y_i) = \\sum_{i=1}^{N} w_i^2 \\operatorname{Var}(Y_i)\n$$\n我们已知结局是同分布的，对于所有 $i=1, \\dots, N$ 都有 $\\operatorname{Var}(Y_i) = \\sigma^2$。将此代入方程可得：\n$$\n\\sum_{i=1}^{N} w_i^2 \\operatorname{Var}(Y_i) = \\sum_{i=1}^{N} w_i^2 \\sigma^2 = \\sigma^2 \\sum_{i=1}^{N} w_i^2\n$$\n综合这些结果，我们得到加权均值估计量的方差：\n$$\n\\operatorname{Var}(\\hat{\\mu}_w) = \\frac{1}{W^2} \\left(\\sigma^2 \\sum_{i=1}^{N} w_i^2\\right) = \\frac{\\sigma^2 \\sum_{i=1}^{N} w_i^2}{\\left(\\sum_{i=1}^{N} w_i\\right)^2}\n$$\n下一步是考虑一个大小为 $M$ 的假设样本的未加权样本均值 $\\bar{Y}$ 的方差。未加权均值为 $\\bar{Y}_M = \\frac{1}{M}\\sum_{i=1}^{M} Y_i$。在相同的假设下（$Y_i$ 独立同分布且方差为 $\\sigma^2$），其方差为：\n$$\n\\operatorname{Var}(\\bar{Y}_M) = \\operatorname{Var}\\left(\\frac{1}{M}\\sum_{i=1}^{M} Y_i\\right) = \\frac{1}{M^2} \\sum_{i=1}^{M} \\operatorname{Var}(Y_i) = \\frac{1}{M^2} (M\\sigma^2) = \\frac{\\sigma^2}{M}\n$$\n有效样本量 $ESS$ 被定义为具有与加权样本估计量 $\\hat{\\mu}_w$ 相同方差的未加权样本的大小（$M=ESS$）。因此，我们令 $\\operatorname{Var}(\\bar{Y}_{ESS}) = \\operatorname{Var}(\\hat{\\mu}_w)$:\n$$\n\\frac{\\sigma^2}{ESS} = \\frac{\\sigma^2 \\sum_{i=1}^{N} w_i^2}{\\left(\\sum_{i=1}^{N} w_i\\right)^2}\n$$\n假设 $\\sigma^2 > 0$，我们可以消去两边的 $\\sigma^2$：\n$$\n\\frac{1}{ESS} = \\frac{\\sum_{i=1}^{N} w_i^2}{\\left(\\sum_{i=1}^{N} w_i\\right)^2}\n$$\n求解 $ESS$ 得到所需的闭式表达式：\n$$\nESS = \\frac{\\left(\\sum_{i=1}^{N} w_i\\right)^2}{\\sum_{i=1}^{N} w_i^2}\n$$\n此表达式被称为有效样本量的 Kish 近似法。\n\n现在，我们使用为 $N=10$ 名患者提供的权重计算 $ESS$ 的数值：\n$w_1=0.8, w_2=0.9, w_3=1.0, w_4=1.1, w_5=1.2, w_6=0.7, w_7=1.3, w_8=1.4, w_9=0.6, w_{10}=1.0$。\n\n首先，我们计算权重的和，$\\sum_{i=1}^{10} w_i$：\n$$\n\\sum_{i=1}^{10} w_i = 0.8 + 0.9 + 1.0 + 1.1 + 1.2 + 0.7 + 1.3 + 1.4 + 0.6 + 1.0 = 10.0\n$$\n这个和的平方是：\n$$\n\\left(\\sum_{i=1}^{10} w_i\\right)^2 = (10.0)^2 = 100\n$$\n接下来，我们计算权重平方的和，$\\sum_{i=1}^{10} w_i^2$：\n$$\n\\sum_{i=1}^{10} w_i^2 = (0.8)^2 + (0.9)^2 + (1.0)^2 + (1.1)^2 + (1.2)^2 + (0.7)^2 + (1.3)^2 + (1.4)^2 + (0.6)^2 + (1.0)^2\n$$\n$$\n\\sum_{i=1}^{10} w_i^2 = 0.64 + 0.81 + 1.00 + 1.21 + 1.44 + 0.49 + 1.69 + 1.96 + 0.36 + 1.00 = 10.6\n$$\n最后，我们将这些值代入我们的 $ESS$ 表达式中：\n$$\nESS = \\frac{100}{10.6} \\approx 9.433962264...\n$$\n问题要求将最终答案四舍五入到四位有效数字。前四位有效数字是 $9, 4, 3, 3$。第五位有效数字是 $9$，大于或等于 $5$，所以我们将第四位数字向上舍入。\n$$\nESS \\approx 9.434\n$$",
            "answer": "$$\\boxed{9.434}$$"
        }
    ]
}