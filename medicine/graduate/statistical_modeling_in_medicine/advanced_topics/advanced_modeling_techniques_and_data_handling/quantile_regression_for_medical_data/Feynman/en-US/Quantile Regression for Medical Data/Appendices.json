{
    "hands_on_practices": [
        {
            "introduction": "A primary application of any regression model in medicine is to generate predictions for individual patients. This first exercise provides a direct, hands-on opportunity to work with a fitted quantile regression model. You will apply the model equation to calculate a specific conditional quantile—the 90th percentile of systolic blood pressure—for a patient with given characteristics, translating the abstract model coefficients into a concrete, clinically relevant value. ",
            "id": "4981834",
            "problem": "A cohort study of cardiovascular aging modeled the conditional quantiles of Systolic Blood Pressure (SBP) given age and sex using quantile regression. The foundational definition is that the conditional $\\tau$-quantile function $Q_{Y}(\\tau \\mid X=x)$ satisfies $\\mathbb{P}(Y \\leq Q_{Y}(\\tau \\mid X=x) \\mid X=x) = \\tau$. The quantile regression estimator $\\hat{\\beta}(\\tau)$ is obtained by minimizing the empirical sum of the check (pinball) loss $\\rho_{\\tau}(u) = u\\left(\\tau - \\mathbf{1}\\{u  0\\}\\right)$ over the training sample, where $\\mathbf{1}\\{\\cdot\\}$ denotes the indicator function. In this study, the working model for the conditional $\\tau$-quantile of SBP at $\\tau = 0.9$ uses a polynomial basis in standardized age and interactions with sex:\n$$\nQ_{\\mathrm{SBP}}(0.9 \\mid a, S) = \\beta_{0}(0.9) + \\beta_{S}(0.9)\\,S + \\beta_{1}(0.9)\\,z + \\beta_{2}(0.9)\\,z^2 + \\beta_{3}(0.9)\\,z^3 + \\gamma_{1}(0.9)\\,S z + \\gamma_{2}(0.9)\\,S z^2 + \\gamma_{3}(0.9)\\,S z^3,\n$$\nwhere $a$ is age in years, $S$ is the sex indicator coded $S=1$ for male and $S=0$ for female, and $z$ is standardized age defined by $z = (a - 55)/10$. The fitted coefficient estimates at $\\tau = 0.9$ are:\n$$\n\\hat{\\beta}_{0}(0.9) = 130,\\quad \\hat{\\beta}_{S}(0.9) = 7,\\quad \\hat{\\beta}_{1}(0.9) = 9,\\quad \\hat{\\beta}_{2}(0.9) = 1.2,\\quad \\hat{\\beta}_{3}(0.9) = -0.5,\n$$\n$$\n\\hat{\\gamma}_{1}(0.9) = 2.5,\\quad \\hat{\\gamma}_{2}(0.9) = 0.4,\\quad \\hat{\\gamma}_{3}(0.9) = -0.2.\n$$\nFor a male patient aged $a = 72$ years (thus $S = 1$), compute the predicted $0.9$-quantile of SBP using the provided $\\hat{\\beta}(0.9)$ values. Express your final answer in millimeters of mercury (mmHg) and round to four significant figures.",
            "solution": "The problem statement is evaluated for validity.\n\n### Step 1: Extract Givens\n- **Conditional Quantile Definition**: $\\mathbb{P}(Y \\leq Q_{Y}(\\tau \\mid X=x) \\mid X=x) = \\tau$.\n- **Quantile Regression Estimator Definition**: $\\hat{\\beta}(\\tau)$ minimizes the sum of the check loss function $\\rho_{\\tau}(u) = u\\left(\\tau - \\mathbf{1}\\{u  0\\}\\right)$.\n- **Model for the conditional $\\tau=0.9$ quantile of SBP**:\n$$\nQ_{\\mathrm{SBP}}(0.9 \\mid a, S) = \\beta_{0}(0.9) + \\beta_{S}(0.9)\\,S + \\beta_{1}(0.9)\\,z + \\beta_{2}(0.9)\\,z^2 + \\beta_{3}(0.9)\\,z^3 + \\gamma_{1}(0.9)\\,S z + \\gamma_{2}(0.9)\\,S z^2 + \\gamma_{3}(0.9)\\,S z^3\n$$\n- **Variable Definitions**:\n  - $a$: age in years.\n  - $S$: sex indicator, $S=1$ for male and $S=0$ for female.\n  - $z$: standardized age, $z = (a - 55)/10$.\n- **Fitted Coefficient Estimates at $\\tau=0.9$**:\n  - $\\hat{\\beta}_{0}(0.9) = 130$\n  - $\\hat{\\beta}_{S}(0.9) = 7$\n  - $\\hat{\\beta}_{1}(0.9) = 9$\n  - $\\hat{\\beta}_{2}(0.9) = 1.2$\n  - $\\hat{\\beta}_{3}(0.9) = -0.5$\n  - $\\hat{\\gamma}_{1}(0.9) = 2.5$\n  - $\\hat{\\gamma}_{2}(0.9) = 0.4$\n  - $\\hat{\\gamma}_{3}(0.9) = -0.2$\n- **Task Data**:\n  - Patient is male, so $S=1$.\n  - Patient age is $a = 72$ years.\n- **Required Output Format**:\n  - Compute the predicted $0.9$-quantile of SBP.\n  - Express the answer in mmHg.\n  - Round to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is well-defined and scientifically sound.\n- **Scientifically Grounded**: The problem describes a standard application of quantile regression, a well-established statistical method, to model a physiological variable (Systolic Blood Pressure). The polynomial model with interaction terms is a common practice in biostatistics. The concept and the values presented are realistic.\n- **Well-Posed**: All necessary components are provided: the explicit model equation, the complete set of fitted coefficients, and the specific values of the covariates for the prediction. The task is a direct calculation, which guarantees a unique solution.\n- **Objective**: The problem is stated using precise, formal mathematical and statistical language, free of ambiguity or subjective claims.\n\n### Step 3: Verdict and Action\nThe problem is valid. A solution will be derived.\n\nThe task is to compute the predicted $0.9$-quantile of Systolic Blood Pressure (SBP) for a male patient aged $72$ years. The prediction, denoted as $\\hat{Q}_{\\mathrm{SBP}}(0.9 \\mid a, S)$, is calculated using the provided fitted model and coefficients.\n\nThe model equation for the predicted $\\tau=0.9$ quantile is:\n$$\n\\hat{Q}_{\\mathrm{SBP}}(0.9 \\mid a, S) = \\hat{\\beta}_{0}(0.9) + \\hat{\\beta}_{S}(0.9)\\,S + \\hat{\\beta}_{1}(0.9)\\,z + \\hat{\\beta}_{2}(0.9)\\,z^2 + \\hat{\\beta}_{3}(0.9)\\,z^3 + \\hat{\\gamma}_{1}(0.9)\\,S z + \\hat{\\gamma}_{2}(0.9)\\,S z^2 + \\hat{\\gamma}_{3}(0.9)\\,S z^3\n$$\nThe patient is male, so the sex indicator is $S=1$. The patient's age is $a=72$.\n\nFirst, we calculate the standardized age, $z$:\n$$\nz = \\frac{a - 55}{10} = \\frac{72 - 55}{10} = \\frac{17}{10} = 1.7\n$$\nNext, we calculate the required powers of $z$:\n$$\nz^2 = (1.7)^2 = 2.89\n$$\n$$\nz^3 = (1.7)^3 = 4.913\n$$\nNow, substitute $S=1$ and the values of $z$, $z^2$, and $z^3$ along with the given coefficient estimates into the model equation. For clarity, let's substitute $\\tau=0.9$ and drop the argument from the coefficients notation.\n$$\n\\hat{Q}_{\\mathrm{SBP}} = \\hat{\\beta}_{0} + \\hat{\\beta}_{S}S + \\hat{\\beta}_{1}z + \\hat{\\beta}_{2}z^2 + \\hat{\\beta}_{3}z^3 + \\hat{\\gamma}_{1}Sz + \\hat{\\gamma}_{2}Sz^2 + \\hat{\\gamma}_{3}Sz^3\n$$\nSubstituting values:\n$$\n\\hat{Q}_{\\mathrm{SBP}} = 130 + (7)(1) + (9)(1.7) + (1.2)(2.89) + (-0.5)(4.913) + (2.5)(1)(1.7) + (0.4)(1)(2.89) + (-0.2)(1)(4.913)\n$$\nWe can regroup the terms based on the powers of $z$, since $S=1$:\n$$\n\\hat{Q}_{\\mathrm{SBP}} = (\\hat{\\beta}_{0} + \\hat{\\beta}_{S}) + (\\hat{\\beta}_{1} + \\hat{\\gamma}_{1})z + (\\hat{\\beta}_{2} + \\hat{\\gamma}_{2})z^2 + (\\hat{\\beta}_{3} + \\hat{\\gamma}_{3})z^3\n$$\nCalculate the combined coefficients:\n- Intercept: $\\hat{\\beta}_{0} + \\hat{\\beta}_{S} = 130 + 7 = 137$\n- Coefficient for $z$: $\\hat{\\beta}_{1} + \\hat{\\gamma}_{1} = 9 + 2.5 = 11.5$\n- Coefficient for $z^2$: $\\hat{\\beta}_{2} + \\hat{\\gamma}_{2} = 1.2 + 0.4 = 1.6$\n- Coefficient for $z^3$: $\\hat{\\beta}_{3} + \\hat{\\gamma}_{3} = -0.5 + (-0.2) = -0.7$\n\nNow substitute these combined coefficients and the powers of $z$ into the simplified expression:\n$$\n\\hat{Q}_{\\mathrm{SBP}} = 137 + (11.5)(1.7) + (1.6)(2.89) + (-0.7)(4.913)\n$$\nPerform the multiplications:\n- $(11.5)(1.7) = 19.55$\n- $(1.6)(2.89) = 4.624$\n- $(-0.7)(4.913) = -3.4391$\n\nFinally, sum the terms:\n$$\n\\hat{Q}_{\\mathrm{SBP}} = 137 + 19.55 + 4.624 - 3.4391\n$$\n$$\n\\hat{Q}_{\\mathrm{SBP}} = 156.55 + 4.624 - 3.4391\n$$\n$$\n\\hat{Q}_{\\mathrm{SBP}} = 161.174 - 3.4391\n$$\n$$\n\\hat{Q}_{\\mathrm{SBP}} = 157.7349\n$$\nThe problem requires the answer to be rounded to four significant figures. The number is $157.7349$. The first four significant figures are $1$, $5$, $7$, and $7$. The fifth significant digit is $3$, which is less than $5$, so we round down (truncate).\nThe rounded value is $157.7$.",
            "answer": "$$\\boxed{157.7}$$"
        },
        {
            "introduction": "Moving beyond simple prediction, a powerful use of regression is to compare outcomes between different groups and quantify the uncertainty in those comparisons. This practice builds on the previous exercise by asking you to calculate the difference in a specific quantile between male and female patients and to construct a confidence interval for that difference. This task illustrates how quantile regression allows for a nuanced analysis of how covariates like sex can affect not just the mean, but specific parts of an outcome's conditional distribution. ",
            "id": "4981851",
            "problem": "A hospital study analyzes the conditional upper tail of systolic blood pressure (expressed in millimeters of mercury, mmHg) among adults, modeled as a function of age and sex. Let $Y$ denote systolic blood pressure, $A$ denote age in years, and $M$ denote a binary male indicator ($M=1$ for male, $M=0$ for female). The conditional $\\tau$-quantile function at $\\tau=0.75$ is postulated to be linear in covariates, with\n$$\nQ_{Y \\mid A,M}(0.75 \\mid a,m) = \\beta_0 + \\beta_A\\,a + \\beta_M\\,m + \\beta_{AM}\\,a\\,m.\n$$\nThe regression coefficients at $\\tau=0.75$ are estimated via quantile regression as $\\hat{\\beta}_{0.75} = (\\hat{\\beta}_0,\\hat{\\beta}_A,\\hat{\\beta}_M,\\hat{\\beta}_{AM})^{\\top}$ with\n$$\n\\hat{\\beta}_0 = 94.0,\\quad \\hat{\\beta}_A = 0.70,\\quad \\hat{\\beta}_M = 6.00,\\quad \\hat{\\beta}_{AM} = 0.03.\n$$\nAn estimated asymptotic covariance matrix for $\\hat{\\beta}_{0.75}$ is provided as\n$$\n\\hat{V}_{0.75} =\n\\begin{pmatrix}\n6.25  -0.02  0.30  -0.015 \\\\\n-0.02  0.05  -0.005  0.0001 \\\\\n0.30  -0.005  2.89  -0.002 \\\\\n-0.015  0.0001  -0.002  0.02\n\\end{pmatrix}.\n$$\nUsing these estimates, perform the following for patients aged $60$ years:\n1. Compute the predicted $0.75$-quantile of systolic blood pressure for a $60$-year-old female ($M=0$).\n2. Compute the predicted $0.75$-quantile of systolic blood pressure for a $60$-year-old male ($M=1$).\n3. Compute the estimated difference between the male and female predicted $0.75$-quantiles at age $60$.\n4. Construct a two-sided $95\\%$ confidence interval (CI) for the difference in item $3$ using the asymptotic normal approximation based on $\\hat{V}_{0.75}$.\n\nRound your numerical answers to four significant figures. Express all numerical answers in millimeters of mercury (mmHg). Provide your final numeric results in the order: female predicted quantile at $60$, male predicted quantile at $60$, estimated difference, lower CI endpoint, upper CI endpoint.",
            "solution": "Quantile regression at a fixed quantile level $\\tau$ is defined by the minimizer $\\hat{\\beta}_{\\tau}$ of the empirical objective $\\sum_{i=1}^{n} \\rho_{\\tau}\\!\\left(Y_i - X_i^{\\top}\\beta\\right)$, where the check loss is $\\rho_{\\tau}(u) = u\\left(\\tau - \\mathbf{1}\\{u  0\\}\\right)$, and $X_i$ is the covariate vector. Under standard regularity conditions (independent and identically distributed (i.i.d.) sampling, a strictly positive conditional density of $Y$ at the target quantile, and appropriate moment and design conditions), $\\hat{\\beta}_{\\tau}$ is a consistent estimator and admits an asymptotic normal approximation,\n$$\n\\sqrt{n}\\left(\\hat{\\beta}_{\\tau} - \\beta_{\\tau}\\right) \\overset{d}{\\to} \\mathcal{N}\\!\\left(0, V_{\\tau}\\right),\n$$\nwhere $V_{\\tau}$ can be consistently estimated by a robust sandwich covariance estimator, denoted $\\hat{V}_{\\tau}$. For any fixed covariate vector $x$, the predicted conditional $\\tau$-quantile is $x^{\\top}\\hat{\\beta}_{\\tau}$, and for any linear contrast $l^{\\top}\\beta_{\\tau}$, the asymptotic variance is $l^{\\top}\\hat{V}_{\\tau} l$.\n\nWe are given the linear specification\n$$\nQ_{Y \\mid A,M}(0.75 \\mid a,m) = \\beta_0 + \\beta_A\\,a + \\beta_M\\,m + \\beta_{AM}\\,a\\,m,\n$$\nand estimates at $\\tau=0.75$,\n$$\n\\hat{\\beta}_0 = 94.0,\\quad \\hat{\\beta}_A = 0.70,\\quad \\hat{\\beta}_M = 6.00,\\quad \\hat{\\beta}_{AM} = 0.03,\n$$\nwith covariance matrix\n$$\n\\hat{V}_{0.75} =\n\\begin{pmatrix}\n6.25  -0.02  0.30  -0.015 \\\\\n-0.02  0.05  -0.005  0.0001 \\\\\n0.30  -0.005  2.89  -0.002 \\\\\n-0.015  0.0001  -0.002  0.02\n\\end{pmatrix}.\n$$\n\nStep $1$ (female, $A=60$, $M=0$). The covariate vector for a $60$-year-old female is $x_f = (1, 60, 0, 0)^{\\top}$. The predicted $0.75$-quantile is\n$$\nx_f^{\\top}\\hat{\\beta}_{0.75} = \\hat{\\beta}_0 + \\hat{\\beta}_A \\cdot 60 + \\hat{\\beta}_M \\cdot 0 + \\hat{\\beta}_{AM} \\cdot 60 \\cdot 0 = 94.0 + 0.70 \\cdot 60 = 136.0.\n$$\n\nStep $2$ (male, $A=60$, $M=1$). The covariate vector for a $60$-year-old male is $x_m = (1, 60, 1, 60)^{\\top}$. The predicted $0.75$-quantile is\n$$\nx_m^{\\top}\\hat{\\beta}_{0.75} = \\hat{\\beta}_0 + \\hat{\\beta}_A \\cdot 60 + \\hat{\\beta}_M \\cdot 1 + \\hat{\\beta}_{AM} \\cdot 60 \\cdot 1 = 94.0 + 0.70 \\cdot 60 + 6.00 + 0.03 \\cdot 60 = 143.8.\n$$\n\nStep $3$ (difference, male minus female). The difference in predicted quantiles at $A=60$ is\n$$\n\\widehat{\\Delta} = x_m^{\\top}\\hat{\\beta}_{0.75} - x_f^{\\top}\\hat{\\beta}_{0.75} = \\hat{\\beta}_M + 60\\,\\hat{\\beta}_{AM} = 6.00 + 60 \\cdot 0.03 = 7.80.\n$$\n\nStep $4$ (two-sided $95\\%$ confidence interval for the difference). The difference is a linear contrast with $l = (0, 0, 1, 60)^{\\top}$, so its asymptotic variance is\n$$\n\\operatorname{Var}(\\widehat{\\Delta}) = l^{\\top}\\hat{V}_{0.75}\\,l\n= \\hat{V}_{33} + 60^2 \\hat{V}_{44} + 2 \\cdot 60\\, \\hat{V}_{34}.\n$$\nUsing the entries from $\\hat{V}_{0.75}$,\n$$\n\\operatorname{Var}(\\widehat{\\Delta}) = 2.89 + 60^2 \\cdot 0.02 + 2 \\cdot 60 \\cdot (-0.002)\n= 2.89 + 3600 \\cdot 0.02 - 0.24 = 2.89 + 72 - 0.24 = 74.65.\n$$\nThe standard error is\n$$\n\\operatorname{SE}(\\widehat{\\Delta}) = \\sqrt{74.65} \\approx 8.640.\n$$\nUnder the asymptotic normal approximation, a two-sided $95\\%$ confidence interval is given by\n$$\n\\widehat{\\Delta} \\pm z_{0.975} \\cdot \\operatorname{SE}(\\widehat{\\Delta}),\n$$\nwhere $z_{0.975} \\approx 1.96$. Thus,\n$$\n\\text{CI}_{95\\%} = 7.80 \\pm 1.96 \\cdot 8.640 = 7.80 \\pm 16.9344,\n$$\nwhich yields endpoints\n$$\n\\text{Lower} = 7.80 - 16.9344 = -9.1344,\\qquad \\text{Upper} = 7.80 + 16.9344 = 24.7344.\n$$\n\nRounding all requested quantities to four significant figures and expressing them in millimeters of mercury (mmHg):\n- Female predicted $0.75$-quantile at $60$: $136.0$.\n- Male predicted $0.75$-quantile at $60$: $143.8$.\n- Estimated difference (male minus female): $7.800$.\n- $95\\%$ CI lower endpoint: $-9.134$.\n- $95\\%$ CI upper endpoint: $24.73$.\n\nThese five numerical results, in the specified order, are the final outputs.",
            "answer": "$$\\boxed{\\begin{pmatrix}136.0  143.8  7.800  -9.134  24.73\\end{pmatrix}}$$"
        },
        {
            "introduction": "To truly master quantile regression, it is crucial to understand the engine that drives it: the \"pinball\" loss function. This practice takes you under the hood, challenging you to compute this loss for various scenarios. By manually calculating how the loss function asymmetrically penalizes positive and negative residuals based on the chosen quantile level $\\tau$, you will develop a foundational intuition for how the method successfully targets different parts of the conditional distribution. ",
            "id": "4981835",
            "problem": "You are given fitted residuals from several Quantile Regression (QR) models applied to fasting plasma glucose measurements in adult patients. Quantile Regression (QR) estimates conditional quantiles by minimizing an asymmetric absolute-deviation criterion that penalizes upper-tail and lower-tail errors differently according to a chosen quantile level. Let the residual for patient $i$ be $e_i = y_i - \\hat{y}_i$, where $y_i$ is the observed glucose concentration in $\\mathrm{mg/dL}$ and $\\hat{y}_i$ is the model prediction. Upper-tail errors correspond to residuals with $e_i  0$ (observations exceeding the prediction), and lower-tail errors correspond to $e_i  0$ (observations falling below the prediction).\n\nStarting from the core definition that a conditional $\\tau$-quantile for $\\tau \\in (0,1)$ is obtained by minimizing an asymmetric absolute-deviation risk that differentially weights the contributions of residuals according to their sign, compute for each test case:\n- The total pinball loss in $\\mathrm{mg/dL}$ by aggregating the asymmetric absolute-deviation contributions over all residuals for the specified $\\tau$.\n- The upper-tail loss component in $\\mathrm{mg/dL}$, defined as the portion of the total pinball loss attributable to residuals with $e_i  0$ under the same asymmetric absolute-deviation principle.\n- The fraction of the total pinball loss contributed by upper-tail errors, expressed as a decimal. If the total pinball loss is zero, define this fraction to be $0.0$.\n- A boolean indicating whether upper-tail errors dominate the total pinball loss, defined as the fraction strictly greater than $0.5$.\n\nAll loss quantities must be expressed in $\\mathrm{mg/dL}$, and all fractions must be decimals. For each test case, return a list containing $[\\text{total\\_loss}, \\text{upper\\_tail\\_loss}, \\text{fraction\\_upper\\_tail}, \\text{dominates}]$.\n\nUse the following test suite of quantile levels and residual sets (all residuals are in $\\mathrm{mg/dL}$):\n- Test case $1$: $\\tau = 0.5$, residuals $\\{ -10, 5, -3, 8, 0 \\}$.\n- Test case $2$: $\\tau = 0.9$, residuals $\\{ 2, 15, 40, -5, -1 \\}$.\n- Test case $3$: $\\tau = 0.1$, residuals $\\{ -20, -10, -5, 0, 3 \\}$.\n- Test case $4$: $\\tau = 0.7$, residuals $\\{ 0, 0, 0 \\}$.\n- Test case $5$: $\\tau = 0.8$, residuals $\\{ 5, 10, 0.5 \\}$.\n- Test case $6$: $\\tau = 0.8$, residuals $\\{ -7, -3, -0.5 \\}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each test case result formatted as a list in the order specified above. For example, the output should look like $[ [\\dots], [\\dots], \\dots ]$ with no additional text. Ensure all numeric quantities reflect $\\mathrm{mg/dL}$ for losses and decimals for fractions.",
            "solution": "The problem requires the calculation of several quantities related to the pinball loss function, which is central to quantile regression. The validation process confirms that the problem is scientifically grounded, well-posed, and contains all necessary information for a unique solution.\n\nThe fundamental concept is the pinball loss function, denoted as $\\rho_\\tau(u)$, for a given quantile level $\\tau \\in (0,1)$ and a single residual $u$. The problem describes this as an \"asymmetric absolute-deviation risk\". Mathematically, it is defined as:\n$$\n\\rho_\\tau(u) = \\begin{cases} \\tau u  \\text{if } u \\ge 0 \\\\ (\\tau - 1) u  \\text{if } u  0 \\end{cases}\n$$\nThis function asymmetrically penalizes positive residuals (underpredictions, $u  0$) and negative residuals (overpredictions, $u  0$). The weights are $\\tau$ for positive residuals and $1-\\tau$ for the absolute value of negative residuals, since $(\\tau-1)u = -(1-\\tau)u = (1-\\tau)|u|$ for $u0$.\n\nFor a given set of residuals $\\{e_1, e_2, \\dots, e_n\\}$, we can define the required quantities as follows:\n\n1.  **Total Pinball Loss ($L_{\\text{total}}$)**: This is the aggregate loss over all residuals. It is computed by summing the pinball loss for each individual residual $e_i$.\n    $$\n    L_{\\text{total}} = \\sum_{i=1}^{n} \\rho_\\tau(e_i) = \\sum_{i: e_i \\ge 0} \\tau e_i + \\sum_{i: e_i  0} (\\tau - 1) e_i\n    $$\n    All quantities are in units of $\\mathrm{mg/dL}$, consistent with the residuals.\n\n2.  **Upper-Tail Loss Component ($L_{\\text{upper}}$)**: This is the portion of the total loss contributed solely by positive residuals ($e_i  0$). Based on the definition of $\\rho_\\tau(u)$, this component is:\n    $$\n    L_{\\text{upper}} = \\sum_{i: e_i  0} \\tau e_i\n    $$\n    Residuals where $e_i=0$ contribute $0$ to the total loss and are not included in this sum as per the problem's specification \"residuals with $e_i  0$\".\n\n3.  **Fraction of Upper-Tail Loss ($F_{\\text{upper}}$)**: This is the ratio of the upper-tail loss to the total loss. A special condition is provided for cases where the total loss is zero.\n    $$\n    F_{\\text{upper}} = \\begin{cases} \\frac{L_{\\text{upper}}}{L_{\\text{total}}}  \\text{if } L_{\\text{total}}  0 \\\\ 0.0  \\text{if } L_{\\text{total}} = 0 \\end{cases}\n    $$\n\n4.  **Dominance Boolean ($D_{\\text{upper}}$)**: This is a boolean value indicating if the upper-tail loss constitutes strictly more than half of the total loss.\n    $$\n    D_{\\text{upper}} = (F_{\\text{upper}}  0.5)\n    $$\n\nWe now apply these definitions to each test case.\n\n**Test Case 1:** $\\tau = 0.5$, residuals $\\{ -10, 5, -3, 8, 0 \\}$.\nThe positive residuals are $\\{5, 8\\}$ and negative residuals are $\\{-10, -3\\}$.\n$L_{\\text{upper}} = 0.5 \\times (5 + 8) = 0.5 \\times 13 = 6.5$.\nThe loss from negative residuals is $(0.5 - 1) \\times (-10 - 3) = -0.5 \\times (-13) = 6.5$.\n$L_{\\text{total}} = 6.5 + 6.5 = 13.0$.\n$F_{\\text{upper}} = 6.5 / 13.0 = 0.5$.\n$D_{\\text{upper}} = (0.5  0.5)$ is False.\nResult: $[13.0, 6.5, 0.5, \\text{False}]$\n\n**Test Case 2:** $\\tau = 0.9$, residuals $\\{ 2, 15, 40, -5, -1 \\}$.\nThe positive residuals are $\\{2, 15, 40\\}$ and negative residuals are $\\{-5, -1\\}$.\n$L_{\\text{upper}} = 0.9 \\times (2 + 15 + 40) = 0.9 \\times 57 = 51.3$.\nThe loss from negative residuals is $(0.9 - 1) \\times (-5 - 1) = -0.1 \\times (-6) = 0.6$.\n$L_{\\text{total}} = 51.3 + 0.6 = 51.9$.\n$F_{\\text{upper}} = 51.3 / 51.9 \\approx 0.988439$.\n$D_{\\text{upper}} = (0.988439  0.5)$ is True.\nResult: $[51.9, 51.3, 0.988439..., \\text{True}]$\n\n**Test Case 3:** $\\tau = 0.1$, residuals $\\{ -20, -10, -5, 0, 3 \\}$.\nThe positive residual is $\\{3\\}$ and negative residuals are $\\{-20, -10, -5\\}$.\n$L_{\\text{upper}} = 0.1 \\times 3 = 0.3$.\nThe loss from negative residuals is $(0.1 - 1) \\times (-20 - 10 - 5) = -0.9 \\times (-35) = 31.5$.\n$L_{\\text{total}} = 0.3 + 31.5 = 31.8$.\n$F_{\\text{upper}} = 0.3 / 31.8 \\approx 0.009434$.\n$D_{\\text{upper}} = (0.009434  0.5)$ is False.\nResult: $[31.8, 0.3, 0.009434..., \\text{False}]$\n\n**Test Case 4:** $\\tau = 0.7$, residuals $\\{ 0, 0, 0 \\}$.\nThere are no positive or negative residuals. All residuals are $0$.\n$L_{\\text{upper}} = 0.7 \\times 0 = 0.0$.\nThe loss from negative residuals is $0.0$.\n$L_{\\text{total}} = 0.0$.\nAs per the problem definition, since $L_{\\text{total}} = 0$, $F_{\\text{upper}} = 0.0$.\n$D_{\\text{upper}} = (0.0  0.5)$ is False.\nResult: $[0.0, 0.0, 0.0, \\text{False}]$\n\n**Test Case 5:** $\\tau = 0.8$, residuals $\\{ 5, 10, 0.5 \\}$.\nAll residuals are positive.\n$L_{\\text{upper}} = 0.8 \\times (5 + 10 + 0.5) = 0.8 \\times 15.5 = 12.4$.\nThe loss from negative residuals is $0.0$.\n$L_{\\text{total}} = 12.4 + 0.0 = 12.4$.\n$F_{\\text{upper}} = 12.4 / 12.4 = 1.0$.\n$D_{\\text{upper}} = (1.0  0.5)$ is True.\nResult: $[12.4, 12.4, 1.0, \\text{True}]$\n\n**Test Case 6:** $\\tau = 0.8$, residuals $\\{ -7, -3, -0.5 \\}$.\nAll residuals are negative.\n$L_{\\text{upper}} = 0.8 \\times 0 = 0.0$.\nThe loss from negative residuals is $(0.8 - 1) \\times (-7 - 3 - 0.5) = -0.2 \\times (-10.5) = 2.1$.\n$L_{\\text{total}} = 0.0 + 2.1 = 2.1$.\n$F_{\\text{upper}} = 0.0 / 2.1 = 0.0$.\n$D_{\\text{upper}} = (0.0  0.5)$ is False.\nResult: $[2.1, 0.0, 0.0, \\text{False}]$",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes quantile regression loss metrics for several test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (quantile_level, list_of_residuals).\n    test_cases = [\n        (0.5, [-10, 5, -3, 8, 0]),\n        (0.9, [2, 15, 40, -5, -1]),\n        (0.1, [-20, -10, -5, 0, 3]),\n        (0.7, [0, 0, 0]),\n        (0.8, [5, 10, 0.5]),\n        (0.8, [-7, -3, -0.5]),\n    ]\n\n    results = []\n    for tau, residuals_list in test_cases:\n        # Convert list of residuals to a numpy array for efficient computation.\n        residuals = np.array(residuals_list, dtype=np.float64)\n        \n        # Isolate positive and negative residuals.\n        # Per the problem, upper-tail corresponds to e_i  0.\n        pos_residuals = residuals[residuals  0]\n        neg_residuals = residuals[residuals  0]\n        \n        # 1. Calculate the total pinball loss.\n        # The loss is the sum of two components: one for positive/zero residuals\n        # and one for negative residuals. The pinball loss function rho_tau(u) is\n        # tau * u for u = 0 and (tau - 1) * u for u  0.\n        \n        # Calculate the upper-tail loss component from positive residuals.\n        upper_tail_loss = tau * np.sum(pos_residuals)\n        \n        # Calculate the lower-tail loss component from negative residuals.\n        lower_tail_loss = (tau - 1) * np.sum(neg_residuals)\n        \n        # The total loss is the sum of the two components.\n        total_loss = upper_tail_loss + lower_tail_loss\n        \n        # 2. The upper_tail_loss is already calculated.\n        # It is the portion of the total pinball loss attributable to e_i  0.\n        \n        # 3. Calculate the fraction of total loss from upper-tail errors.\n        # Handle the case where total loss is zero.\n        if total_loss  0:\n            fraction_upper_tail = upper_tail_loss / total_loss\n        else:\n            fraction_upper_tail = 0.0\n            \n        # 4. Determine if upper-tail errors dominate (fraction  0.5).\n        dominates = fraction_upper_tail  0.5\n        \n        # Append the results for the current test case.\n        results.append([\n            total_loss, \n            upper_tail_loss, \n            fraction_upper_tail, \n            dominates\n        ])\n\n    # Final print statement in the exact required format.\n    # The string representation of a list of lists is used.\n    # We replace spaces to generate a more compact, but still valid, format.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}