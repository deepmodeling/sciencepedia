{
    "hands_on_practices": [
        {
            "introduction": "要想真正理解和定制广义加性模型 (Generalized Additive Models, GAMs)，必须掌握它们是如何从基本统计原理构建而来的。本练习将引导你构建惩罚对数似然函数——这是 GAMs 优化的目标函数。通过组装似然函数、连接函数、加性预测变量和惩罚项，你将对 GAMs 的数学核心建立起一个坚实的基础。",
            "id": "4841776",
            "problem": "一项关于医院结局的临床研究旨在为患者 $i$ 的30天死亡率概率建模，其结果为二元变量 $y_i \\in \\{0,1\\}$。设 $a_i$ 表示患者的年龄（单位：年），$z_i$ 表示一个连续的炎症生物标志物浓度（例如，C-反应蛋白），$s_i \\in \\{0,1\\}$ 表示性别指示变量（$s_i=1$ 代表男性，$s_i=0$ 代表女性）。您需要构建一个广义加性模型 (GAM)，该模型对结果使用具有 logistic 连接函数的二项似然，允许年龄和生物标志物的平滑效应以及性别的参数效应。平滑项由立方回归样条基表示，年龄的基维度为用户选择的 $K_a$，生物标志物的基维度为 $K_z$。每个样条的平滑度由对其积分平方二阶导数的惩罚项控制，该惩罚项在系数空间中由半正定惩罚矩阵近似。\n\n从独立观测值的伯努利似然和 logistic 连接函数 $g(p)=\\ln\\!\\left(\\frac{p}{1-p}\\right)$ 的定义出发，并使用以下建模组件：\n- 一个由截距、性别的参数效应以及分别针对年龄和生物标志物的两个平滑项组成的加性预测变量 $\\eta_i$。\n- 用于年龄和生物标志物的立方回归样条基，其设计矩阵为 $B_a \\in \\mathbb{R}^{n \\times K_a}$ 和 $B_z \\in \\mathbb{R}^{n \\times K_z}$，对应的系数向量为 $\\boldsymbol{\\beta}_a \\in \\mathbb{R}^{K_a}$ 和 $\\boldsymbol{\\beta}_z \\in \\mathbb{R}^{K_z}$。\n- 二次惩罚项 $(\\lambda_a/2)\\,\\boldsymbol{\\beta}_a^{\\top} S_a \\boldsymbol{\\beta}_a$ 和 $(\\lambda_z/2)\\,\\boldsymbol{\\beta}_z^{\\top} S_z \\boldsymbol{\\beta}_z$，其中 $S_a \\succeq 0$ 和 $S_z \\succeq 0$ 是由所选基的积分平方二阶导数导出的固定惩罚矩阵，$\\lambda_a>0$ 和 $\\lambda_z>0$ 是平滑参数。\n\n请将完全指定的惩罚对数似然构建为一个单一的闭式解析表达式，该表达式应使用截距 $\\alpha \\in \\mathbb{R}$、性别系数 $\\gamma \\in \\mathbb{R}$、样条系数 $\\boldsymbol{\\beta}_a$ 和 $\\boldsymbol{\\beta}_z$、观测数据 $\\{(y_i,a_i,z_i,s_i)\\}_{i=1}^n$、设计矩阵 $B_a$ 和 $B_z$ 以及平滑参数 $\\lambda_a$ 和 $\\lambda_z$ 来表示。请明确使用指定的 logistic 连接函数、立方回归样条基表示和二阶导数惩罚。您的最终答案必须是一个单一的解析表达式。不需要进行数值计算。",
            "solution": "用户要求构建广义加性模型 (GAM) 的惩罚对数似然。我将首先验证问题陈述，然后在确认其有效性后，推导出所需的表达式。\n\n### 步骤1：提取给定条件\n问题提供了以下组件：\n-   **模型**：针对二元结果的广义加性模型 (GAM)。\n-   **数据**：一组 $n$ 个独立观测值 $\\{(y_i, a_i, z_i, s_i)\\}_{i=1}^n$。\n-   **结果**：$y_i \\in \\{0,1\\}$ 是患者 $i$ 的二元结果。\n-   **预测变量**：$a_i$ 是患者年龄，$z_i$ 是连续生物标志物，$s_i \\in \\{0,1\\}$ 是性别指示变量（$s_i=1$ 代表男性，$s_i=0$ 代表女性）。\n-   **似然**：二项分布（对于单次二元试验即为伯努利分布）。\n-   **连接函数**：Logistic 连接，$g(p_i) = \\ln(p_i / (1-p_i))$，其中 $p_i = P(y_i=1)$。\n-   **加性预测变量**：对于患者 $i$ 的 $\\eta_i$，是截距、性别的参数效应以及年龄和生物标志物的平滑函数的总和。\n-   **模型参数**：截距 $\\alpha \\in \\mathbb{R}$，性别系数 $\\gamma \\in \\mathbb{R}$。\n-   **样条表示**：平滑项由立方回归样条基表示。\n-   **年龄的样条**：基维度 $K_a$，设计矩阵 $B_a \\in \\mathbb{R}^{n \\times K_a}$，系数向量 $\\boldsymbol{\\beta}_a \\in \\mathbb{R}^{K_a}$。\n-   **生物标志物的样条**：基维度 $K_z$，设计矩阵 $B_z \\in \\mathbb{R}^{n \\times K_z}$，系数向量 $\\boldsymbol{\\beta}_z \\in \\mathbb{R}^{K_z}$。\n-   **惩罚项**：样条系数的二次惩罚项由 $(\\lambda_a/2)\\,\\boldsymbol{\\beta}_a^{\\top} S_a \\boldsymbol{\\beta}_a$ 和 $(\\lambda_z/2)\\,\\boldsymbol{\\beta}_z^{\\top} S_z \\boldsymbol{\\beta}_z$ 给出。\n-   **惩罚矩阵**：$S_a$ 和 $S_z$ 是半正定矩阵。\n-   **平滑参数**：$\\lambda_a > 0$ 和 $\\lambda_z > 0$。\n\n### 步骤2：使用提取的给定条件进行验证\n该问题要求给出惩罚对数似然函数的数学公式，这是统计建模中的一个标准目标函数。\n-   **科学依据**：该问题基于统计建模的既定原则。GAM、logistic 回归、样条平滑和惩罚都是统计学及其在医学中应用的成熟标准技术。\n-   **良态问题**：该请求是根据一组明确定义的组件构建一个数学公式。这是一个良态任务，会得出一个单一、明确的结果。\n-   **客观性**：语言精确、技术性强，不含任何主观或非科学内容。\n\n所有组件都定义清晰，没有矛盾。该问题是统计理论中的一个标准练习。\n\n### 步骤3：结论与行动\n问题有效。我现在将开始推导惩罚对数似然表达式。\n\n解决方案由三部分构成：数据的对数似然，平滑函数的惩罚项，以及将这两者结合起来形成最终的惩罚对数似然。\n\n**1. 对数似然函数**\n\n对于二元结果 $y_i \\in \\{0,1\\}$，其基础概率分布是参数为 $p_i = P(y_i=1)$ 的伯努利分布。第 $i$ 个观测值的概率质量函数是：\n$$\nL_i(p_i | y_i) = p_i^{y_i} (1-p_i)^{1-y_i}\n$$\n因此，单个观测值的对数似然为：\n$$\n\\ell_i = \\ln(L_i) = y_i \\ln(p_i) + (1-y_i) \\ln(1-p_i)\n$$\n该模型使用 logistic 连接函数，它将概率 $p_i$ 与线性预测变量 $\\eta_i$ 关联起来：\n$$\n\\eta_i = g(p_i) = \\ln\\left(\\frac{p_i}{1-p_i}\\right)\n$$\n对连接函数求逆，可得 $p_i$ 关于 $\\eta_i$ 的表达式：\n$$\np_i = \\frac{\\exp(\\eta_i)}{1+\\exp(\\eta_i)} = \\frac{1}{1+\\exp(-\\eta_i)}\n$$\n由此，我们也可以表示 $1-p_i$：\n$$\n1-p_i = 1 - \\frac{\\exp(\\eta_i)}{1+\\exp(\\eta_i)} = \\frac{1}{1+\\exp(\\eta_i)}\n$$\n将这些代入单个观测值的对数似然表达式中：\n$$\n\\ell_i = y_i \\ln\\left(\\frac{\\exp(\\eta_i)}{1+\\exp(\\eta_i)}\\right) + (1-y_i) \\ln\\left(\\frac{1}{1+\\exp(\\eta_i)}\\right)\n$$\n$$\n\\ell_i = y_i (\\eta_i - \\ln(1+\\exp(\\eta_i))) - (1-y_i)\\ln(1+\\exp(\\eta_i))\n$$\n$$\n\\ell_i = y_i \\eta_i - y_i \\ln(1+\\exp(\\eta_i)) - \\ln(1+\\exp(\\eta_i)) + y_i \\ln(1+\\exp(\\eta_i))\n$$\n$$\n\\ell_i = y_i \\eta_i - \\ln(1+\\exp(\\eta_i))\n$$\n假设 $n$ 个观测值是独立的，总对数似然是所有观测值的总和：\n$$\n\\ell = \\sum_{i=1}^n \\ell_i = \\sum_{i=1}^n \\left[y_i \\eta_i - \\ln(1+\\exp(\\eta_i))\\right]\n$$\n\n**2. 加性预测变量和惩罚项**\n\n患者 $i$ 的加性预测变量 $\\eta_i$ 被指定为截距、性别的参数效应和两个平滑函数的总和。\n年龄的平滑函数 $f_a(a_i)$ 由一个样条基表示。其对于患者 $i$ 的值是在 $a_i$ 处求值的基函数的线性组合，系数为 $\\boldsymbol{\\beta}_a$。设 $B_{a,ij}$ 是第 $i$ 个观测值年龄的第 $j$ 个基函数的值，$\\beta_{a,j}$ 是对应的系数。该平滑项为：\n$$\nf_a(a_i) = \\sum_{j=1}^{K_a} B_{a,ij} \\beta_{a,j}\n$$\n类似地，生物标志物的平滑函数 $f_z(z_i)$ 为：\n$$\nf_z(z_i) = \\sum_{k=1}^{K_z} B_{z,ik} \\beta_{z,k}\n$$\n患者 $i$ 的完整加性预测变量为：\n$$\n\\eta_i = \\alpha + \\gamma s_i + f_a(a_i) + f_z(z_i) = \\alpha + \\gamma s_i + \\sum_{j=1}^{K_a} B_{a,ij} \\beta_{a,j} + \\sum_{k=1}^{K_z} B_{z,ik} \\beta_{z,k}\n$$\n控制样条函数平滑度的惩罚项给出如下：\n$$\nP = \\frac{\\lambda_a}{2} \\boldsymbol{\\beta}_a^{\\top} S_a \\boldsymbol{\\beta}_a + \\frac{\\lambda_z}{2} \\boldsymbol{\\beta}_z^{\\top} S_z \\boldsymbol{\\beta}_z\n$$\n\n**3. 惩罚对数似然**\n\n最终的惩罚对数似然（我们记为 $\\ell_p$）是通过从总对数似然中减去惩罚项得到的：\n$$\n\\ell_p(\\alpha, \\gamma, \\boldsymbol{\\beta}_a, \\boldsymbol{\\beta}_z) = \\ell - P\n$$\n代入 $\\ell$、$P$ 和 $\\eta_i$ 的表达式，即可得到完整的公式。该函数是需要针对参数 $\\alpha$、$\\gamma$、$\\boldsymbol{\\beta}_a$ 和 $\\boldsymbol{\\beta}_z$ 进行最大化的目标函数。平滑参数 $\\lambda_a$ 和 $\\lambda_z$ 通常通过交叉验证或其他模型选择准则来选择。\n\n完整的表达式为：\n$$\n\\ell_p = \\sum_{i=1}^{n} \\left[ y_i \\left( \\alpha + \\gamma s_i + \\sum_{j=1}^{K_a} B_{a,ij} \\beta_{a,j} + \\sum_{k=1}^{K_z} B_{z,ik} \\beta_{z,k} \\right) - \\ln\\left(1 + \\exp\\left( \\alpha + \\gamma s_i + \\sum_{j=1}^{K_a} B_{a,ij} \\beta_{a,j} + \\sum_{k=1}^{K_z} B_{z,ik} \\beta_{z,k} \\right)\\right) \\right] - \\frac{\\lambda_a}{2} \\boldsymbol{\\beta}_a^{\\top} S_a \\boldsymbol{\\beta}_a - \\frac{\\lambda_z}{2} \\boldsymbol{\\beta}_z^{\\top} S_z \\boldsymbol{\\beta}_z\n$$\n这就是所要求的惩罚对数似然的单一闭式解析表达式。",
            "answer": "$$\n\\boxed{\\sum_{i=1}^{n} \\left[ y_i \\left(\\alpha + \\gamma s_i + \\sum_{j=1}^{K_a} B_{a,ij} \\beta_{a,j} + \\sum_{k=1}^{K_z} B_{z,ik} \\beta_{z,k} \\right) - \\ln\\left(1 + \\exp\\left(\\alpha + \\gamma s_i + \\sum_{j=1}^{K_a} B_{a,ij} \\beta_{a,j} + \\sum_{k=1}^{K_z} B_{z,ik} \\beta_{z,k}\\right)\\right) \\right] - \\frac{\\lambda_a}{2} \\boldsymbol{\\beta}_a^{\\top} S_a \\boldsymbol{\\beta}_a - \\frac{\\lambda_z}{2} \\boldsymbol{\\beta}_z^{\\top} S_z \\boldsymbol{\\beta}_z}\n$$"
        },
        {
            "introduction": "一个拟合好的模型如果缺少对其估计值不确定性的度量，那么它就是不完整的。本练习将探讨如何利用惩罚估计的贝叶斯解释，为 GAM 中的平滑函数构建逐点置信区间。理解这一过程对于正确解读 GAM 软件的视觉输出、并领会模型偏差与方差之间的权衡至关重要。",
            "id": "4964062",
            "problem": "一项医院研究使用广义加性模型 (GAM) 对患者 $i \\in \\{1,\\dots,n\\}$ 的术后急性肾损伤概率进行建模，该模型是年龄和身体质量指数的函数。设 $Y_i \\in \\{0,1\\}$ 表示结果，其条件均值为 $\\mu_i = \\mathbb{E}[Y_i \\mid \\text{age}_i, \\text{BMI}_i]$。我们考虑使用 logit 连接函数 $g(\\mu_i) = \\log\\{\\mu_i/(1-\\mu_i)\\}$ 的二项广义线性模型 (GLM)。加性预测变量为\n$$\n\\eta_i \\equiv g(\\mu_i) = \\alpha + f_1(\\text{age}_i) + f_2(\\text{BMI}_i),\n$$\n其中每个平滑函数 $f_j$ 由样条基展开 $f_j(x) = \\mathbf{b}_j(x)^{\\top} \\boldsymbol{\\beta}_j$ 表示，并带有二次粗糙度惩罚 $\\lambda_j \\boldsymbol{\\beta}_j^{\\top} \\mathbf{S}_j \\boldsymbol{\\beta}_j$。设 $\\boldsymbol{\\beta}$ 表示通过堆叠 $(\\alpha, \\boldsymbol{\\beta}_1^{\\top}, \\boldsymbol{\\beta}_2^{\\top})^{\\top}$ 得到的完整系数向量，并设 $\\mathbf{S}_{\\boldsymbol{\\lambda}} = \\lambda_1 \\operatorname{blkdiag}(\\mathbf{0}, \\mathbf{S}_1, \\mathbf{0}) + \\lambda_2 \\operatorname{blkdiag}(\\mathbf{0}, \\mathbf{0}, \\mathbf{S}_2)$ 为块惩罚矩阵。平滑参数 $\\boldsymbol{\\lambda} = (\\lambda_1,\\lambda_2)$ 通过限制性最大似然法 (REML) 进行估计。假设对于完整基，通常的大样本惩罚迭代重加权最小二乘法 (P-IRLS) 近似成立，其工作权重矩阵为 $\\mathbf{W}$，设计矩阵为 $\\mathbf{X}$。\n\n使用惩罚项的贝叶斯解释，即为样条系数设置一个零均值高斯先验，并对后验分布使用拉普拉斯（二阶）近似，可以得到在给定数据和固定 $\\boldsymbol{\\lambda}$ 的条件下 $\\boldsymbol{\\beta}$ 联合分布的高斯近似。考虑一个新的年龄值 $x_0$，并定义相应的行向量 $\\mathbf{l}(x_0)$，它将 $\\boldsymbol{\\beta}$ 映射到 $f_1(x_0)$，即 $f_1(x_0) = \\mathbf{l}(x_0)^{\\top} \\boldsymbol{\\beta}$。目标是为 $f_1(x_0)$ 构建一个近似的逐点 $95\\%$ 区间，并讨论其频率学派的覆盖属性。\n\n哪个选项最好地描述了如何从第一性原理出发构建这样一个区间，以及预期会得到什么样的覆盖率？\n\nA. 在加性预测变量尺度上，使用从惩罚 Hessian 矩阵的逆得到的 $\\boldsymbol{\\beta}$ 的后验（贝叶斯）协方差来构建区间。具体来说，将近似后验协方差取为 $\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X} + \\mathbf{S}_{\\boldsymbol{\\lambda}}$ 的逆（对于二项分布情况，离散度为 $1$），计算 $\\widehat{\\operatorname{Var}}\\{f_1(x_0)\\} = \\mathbf{l}(x_0)^{\\top}\\widehat{\\operatorname{Cov}}(\\boldsymbol{\\beta})\\,\\mathbf{l}(x_0)$，并形成区间 $\\hat{f}_1(x_0) \\pm z_{0.975}\\,\\widehat{\\operatorname{se}}\\{f_1(x_0)\\}$。如果需要在均值尺度上，则通过德尔塔方法或在近似后验下的模拟来获得区间。这些区间是逐点的，对于大样本 $n$，在内部区域通常接近名义水平，但在边界附近、高曲率区域或有效样本量低的区域可能会覆盖不足，并且它们忽略了平滑参数的不确定性，这可能导致轻微的覆盖不足。\n\nB. 在量化不确定性时忽略惩罚，并使用未惩罚的协方差 $(\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X})^{-1}$ 作为 $\\boldsymbol{\\beta}$ 的协方差。计算 $\\widehat{\\operatorname{Var}}\\{f_1(x_0)\\} = \\mathbf{l}(x_0)^{\\top}(\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X})^{-1}\\mathbf{l}(x_0)$ 并形成通常的 Wald 区间；这会对任何 $n$ 产生精确的 $95\\%$ 覆盖率，因为惩罚只影响估计，不影响变异性。\n\nC. 使用三明治协方差 $(\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X}+\\mathbf{S}_{\\boldsymbol{\\lambda}})^{-1}\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X}(\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X}+\\mathbf{S}_{\\boldsymbol{\\lambda}})^{-1}$作为 $\\boldsymbol{\\beta}$ 的协方差来计算 $\\widehat{\\operatorname{Var}}\\{f_1(x_0)\\}$，然后通过将逆连接函数应用于加性预测变量的端点，在均值尺度上形成一个 Wald 区间。这种构建方法保证是保守的，为整个函数 $f_1$ 提供至少 $95\\%$ 的同时覆盖率。\n\nD. 首先通过取加性预测变量区间 $\\hat{\\eta}(x_0) \\pm z_{0.975}\\,\\widehat{\\operatorname{se}}\\{\\hat{\\eta}(x_0)\\}$，将其端点应用逆连接函数 $g^{-1}$，然后报告转换后的区间，来为均值 $\\mu(x_0)$ 构建一个逐点区间。因为 $g^{-1}$ 是单调的，所以这种转换保留了精确的 $95\\%$ 逐点覆盖率，而不管偏差或平滑参数的不确定性如何。\n\nE. 为了校正平滑偏差，将惩罚贡献直接加到方差上：取 $\\widehat{\\operatorname{Var}}\\{f_1(x_0)\\} = \\mathbf{l}(x_0)^{\\top}\\widehat{\\operatorname{Cov}}(\\boldsymbol{\\beta})\\,\\mathbf{l}(x_0) + \\mathbf{l}(x_0)^{\\top}\\mathbf{S}_{\\boldsymbol{\\lambda}}\\,\\mathbf{l}(x_0)$，这将产生无偏的估计，因此在所有 $x_0$ 处都具有精确的名义 $95\\%$ 覆盖率。",
            "solution": "在进行求解之前，对问题陈述进行了严格验证。\n\n### 步骤 1：提取已知条件\n\n-   **模型**：一项医院研究使用广义加性模型 (GAM) 对术后急性肾损伤的概率进行建模。\n-   **数据**：$n$ 名患者，由 $i \\in \\{1,\\dots,n\\}$ 索引。\n-   **响应变量**：$Y_i \\in \\{0,1\\}$ 是患者 $i$ 的结果。\n-   **模型族**：二项 GLM，使用 logit 连接函数 $g(\\mu_i) = \\log\\{\\mu_i/(1-\\mu_i)\\}$，其中 $\\mu_i = \\mathbb{E}[Y_i \\mid \\text{age}_i, \\text{BMI}_i]$。\n-   **加性预测变量**：$\\eta_i \\equiv g(\\mu_i) = \\alpha + f_1(\\text{age}_i) + f_2(\\text{BMI}_i)$。\n-   **平滑函数**：每个函数 $f_j$ 由样条基展开 $f_j(x) = \\mathbf{b}_j(x)^{\\top} \\boldsymbol{\\beta}_j$ 表示。\n-   **惩罚**：对每个平滑函数施加二次粗糙度惩罚 $\\lambda_j \\boldsymbol{\\beta}_j^{\\top} \\mathbf{S}_j \\boldsymbol{\\beta}_j$。\n-   **系数向量**：完整系数向量为 $\\boldsymbol{\\beta} = (\\alpha, \\boldsymbol{\\beta}_1^{\\top}, \\boldsymbol{\\beta}_2^{\\top})^{\\top}$。\n-   **惩罚矩阵**：块对角总惩罚矩阵为 $\\mathbf{S}_{\\boldsymbol{\\lambda}} = \\lambda_1 \\operatorname{blkdiag}(\\mathbf{0}, \\mathbf{S}_1, \\mathbf{0}) + \\lambda_2 \\operatorname{blkdiag}(\\mathbf{0}, \\mathbf{0}, \\mathbf{S}_2)$。\n-   **估计**：平滑参数 $\\boldsymbol{\\lambda} = (\\lambda_1, \\lambda_2)$ 通过限制性最大似然法 (REML) 估计。模型系数通过惩罚迭代重加权最小二乘法 (P-IRLS) 估计，假设大样本近似成立，工作权重矩阵为 $\\mathbf{W}$，设计矩阵为 $\\mathbf{X}$。\n-   **贝叶斯解释**：惩罚被解释为对样条系数的零均值高斯先验。使用对后验的拉普拉斯（二阶）近似来获得在给定数据和固定 $\\boldsymbol{\\lambda}$ 的情况下 $\\boldsymbol{\\beta}$ 联合分布的高斯近似。\n-   **目标**：为一个新的年龄值 $x_0$ 构建一个近似的逐点 $95\\%$ 区间。\n-   **定义**：$f_1(x_0) = \\mathbf{l}(x_0)^{\\top} \\boldsymbol{\\beta}$，其中 $\\mathbf{l}(x_0)$ 是一个行向量，它选择适当的系数并在 $x_0$ 处评估基函数。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n-   **科学依据**：该问题描述了一种标准且成熟的统计方法（GAM），并将其应用于医学研究（生物统计学）中的一个现实问题。具体组成部分——样条平滑、P-IRLS 估计、用于平滑参数的 REML 以及惩罚的贝叶斯解释——都是现代统计建模中的基本概念，正如 Wood, S. N. (2017) 的《Generalized Additive Models: An Introduction with R》等教科书中所详述的。该问题在科学上是合理的。\n-   **适定性**：该问题是适定的。它要求在一套标准的建模假设下，为一个明确定义的量 $f_1(x_0)$ 构建和解释置信区间。在所提出的理论框架内，存在一个唯一且有意义的解。\n-   **客观性**：该问题以统计学领域常见的精确、客观和技术性语言陈述。它没有歧义和主观论断。\n-   **完整性与一致性**：该问题提供了充分且一致的信息来推导解决方案。符号和定义都是标准的，并且内部一致。\n\n### 步骤 3：结论与行动\n\n问题陈述是**有效的**。这是一个关于 GAM 标准统计实践的清晰、一致且科学合理的问题。可以继续进行求解过程。\n\n### 基于原理的推导\n\n目标是为平滑函数分量 $f_1(x_0)$ 找到一个逐点 $95\\%$ 区间。问题指定使用惩罚似然框架的贝叶斯解释。\n\n在 GAM 中，系数 $\\boldsymbol{\\beta}$ 通过最大化惩罚对数似然来估计：\n$$\n\\mathcal{L}_p(\\boldsymbol{\\beta}) = \\mathcal{L}(\\boldsymbol{\\beta}) - \\frac{1}{2} \\sum_j \\lambda_j \\boldsymbol{\\beta}_j^{\\top} \\mathbf{S}_j \\boldsymbol{\\beta}_j = \\mathcal{L}(\\boldsymbol{\\beta}) - \\frac{1}{2} \\boldsymbol{\\beta}^{\\top} \\mathbf{S}_{\\boldsymbol{\\lambda}} \\boldsymbol{\\beta}\n$$\n其中 $\\mathcal{L}(\\boldsymbol{\\beta})$ 是数据的对数似然。\n\n贝叶斯解释将惩罚项视为 $\\boldsymbol{\\beta}$ 的对数先验分布。具体来说，先验 $\\boldsymbol{\\beta} \\sim N(\\mathbf{0}, \\mathbf{S}_{\\boldsymbol{\\lambda}}^-)$（其中 $\\mathbf{S}_{\\boldsymbol{\\lambda}}^-$ 是一个广义逆）对应于一个对数先验密度 $-\\frac{1}{2} \\boldsymbol{\\beta}^{\\top} \\mathbf{S}_{\\boldsymbol{\\lambda}} \\boldsymbol{\\beta}$（加上常数）。$\\boldsymbol{\\beta}$ 的后验分布则为：\n$$\np(\\boldsymbol{\\beta} | \\mathbf{y}, \\boldsymbol{\\lambda}) \\propto \\exp\\left( \\mathcal{L}(\\boldsymbol{\\beta}) - \\frac{1}{2} \\boldsymbol{\\beta}^{\\top} \\mathbf{S}_{\\boldsymbol{\\lambda}} \\boldsymbol{\\beta} \\right)\n$$\n问题陈述使用了拉普拉斯近似。这涉及用一个以在后验众数 $\\hat{\\boldsymbol{\\beta}}$（即最大化 $\\mathcal{L}_p(\\boldsymbol{\\beta})$ 的 $\\boldsymbol{\\beta}$ 值）为中心多元正态分布来近似后验分布。这个正态近似的协方差矩阵是对数后验的负 Hessian 矩阵在众数 $\\hat{\\boldsymbol{\\beta}}$ 处求值的逆。\n\n负对数后验的 Hessian 矩阵 $\\mathbf{H}$ 为：\n$$\n\\mathbf{H} = -\\frac{\\partial^2}{\\partial \\boldsymbol{\\beta} \\partial \\boldsymbol{\\beta}^{\\top}} \\left( \\mathcal{L}(\\boldsymbol{\\beta}) - \\frac{1}{2} \\boldsymbol{\\beta}^{\\top} \\mathbf{S}_{\\boldsymbol{\\lambda}} \\boldsymbol{\\beta} \\right)\n$$\n对于 GLM，对数似然的负 Hessian 矩阵 $-\\frac{\\partial^2 \\mathcal{L}}{\\partial \\boldsymbol{\\beta} \\partial \\boldsymbol{\\beta}^{\\top}}$ 在 P-IRLS 算法中被近似为在当前估计值处评估的费雪信息矩阵，即 $\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X}$。惩罚项的 Hessian 矩阵就是 $\\mathbf{S}_{\\boldsymbol{\\lambda}}$。因此，总的负 Hessian 矩阵是：\n$$\n\\mathbf{H} \\approx \\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X} + \\mathbf{S}_{\\boldsymbol{\\lambda}}\n$$\n因此，$\\boldsymbol{\\beta}$ 后验分布的拉普拉斯近似（以估计的 $\\boldsymbol{\\lambda}$ 为条件）是：\n$$\n\\boldsymbol{\\beta} | \\mathbf{y}, \\hat{\\boldsymbol{\\lambda}} \\sim N\\left(\\hat{\\boldsymbol{\\beta}}, (\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X} + \\mathbf{S}_{\\boldsymbol{\\lambda}})^{-1}\\right)\n$$\n注意，对于二项分布族，尺度参数固定为 $1$。我们将近似后验协方差矩阵表示为 $\\mathbf{V}_{\\boldsymbol{\\beta}} = (\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X} + \\mathbf{S}_{\\boldsymbol{\\lambda}})^{-1}$。\n\n我们感兴趣的量是 $f_1(x_0) = \\mathbf{l}(x_0)^{\\top} \\boldsymbol{\\beta}$，它是 $\\boldsymbol{\\beta}$ 元素的线性组合。基于 $\\boldsymbol{\\beta}$ 的正态近似， $f_1(x_0)$ 的分布也近似为正态分布：\n$$\nf_1(x_0) | \\mathbf{y}, \\hat{\\boldsymbol{\\lambda}} \\sim N\\left(\\hat{f}_1(x_0), \\operatorname{Var}(\\hat{f}_1(x_0))\\right)\n$$\n其中估计值为 $\\hat{f}_1(x_0) = \\mathbf{l}(x_0)^{\\top}\\hat{\\boldsymbol{\\beta}}$，方差为：\n$$\n\\operatorname{Var}(\\hat{f}_1(x_0)) = \\mathbf{l}(x_0)^{\\top} \\mathbf{V}_{\\boldsymbol{\\beta}} \\mathbf{l}(x_0) = \\mathbf{l}(x_0)^{\\top} (\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X} + \\mathbf{S}_{\\boldsymbol{\\lambda}})^{-1} \\mathbf{l}(x_0)\n$$\n$f_1(x_0)$ 的一个近似 $95\\%$ 逐点区间按正态分布量的常规方式构建：\n$$\n\\hat{f}_1(x_0) \\pm z_{0.975} \\sqrt{\\operatorname{Var}(\\hat{f}_1(x_0))}\n$$\n其中 $z_{0.975}$ 是标准正态分布的 $0.975$ 分位数。\n\n关于该区间的频率学派覆盖属性：\n1.  **偏差**：惩罚项 $\\mathbf{S}_{\\boldsymbol{\\lambda}}$ 给估计 $\\hat{\\boldsymbol{\\beta}}$ 引入了偏差，将其向更平滑的函数空间收缩。该区间以这个有偏估计 $\\hat{f}_1(x_0)$ 为中心。如果真实函数比估计值“摆动”得更剧烈，区间可能无法覆盖真实值，导致覆盖不足。这在高曲率区域或数据边界附近通常更为明显。\n2.  **平滑参数不确定性**：整个推导都以 $\\boldsymbol{\\lambda}$ 固定在其 REML 估计值 $\\hat{\\boldsymbol{\\lambda}}$ 为条件。这忽略了估计 $\\boldsymbol{\\lambda}$ 本身带来的变异性。忽略这个不确定性来源会导致方差 $\\mathbf{V}_{\\boldsymbol{\\beta}}$ 低估 $\\hat{\\boldsymbol{\\beta}}$ 的真实频率学派方差。这也会导致区间过窄，从而导致覆盖不足。\n3.  **总体性能**：尽管存在这些近似，这些区间（通常称为“贝叶斯”置信区间）通常表现出良好的频率学派性能，尤其是在大样本量 $n$ 的情况下。覆盖率通常接近名义水平（$95\\%$），但不能保证。\n\n### 逐项分析选项\n\n**A. 在加性预测变量尺度上，使用从惩罚 Hessian 矩阵的逆得到的 $\\boldsymbol{\\beta}$ 的后验（贝叶斯）协方差来构建区间。具体来说，将近似后验协方差取为 $\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X} + \\mathbf{S}_{\\boldsymbol{\\lambda}}$ 的逆（对于二项分布情况，离散度为 $1$），计算 $\\widehat{\\operatorname{Var}}\\{f_1(x_0)\\} = \\mathbf{l}(x_0)^{\\top}\\widehat{\\operatorname{Cov}}(\\boldsymbol{\\beta})\\,\\mathbf{l}(x_0)$，并形成区间 $\\hat{f}_1(x_0) \\pm z_{0.975}\\,\\widehat{\\operatorname{se}}\\{f_1(x_0)\\}$。如果需要在均值尺度上，则通过德尔塔方法或在近似后验下的模拟来获得区间。这些区间是逐点的，对于大样本 $n$，在内部区域通常接近名义水平，但在边界附近、高曲率区域或有效样本量低的区域可能会覆盖不足，并且它们忽略了平滑参数的不确定性，这可能导致轻微的覆盖不足。**\n该选项正确地指出了协方差矩阵 $\\mathbf{V}_{\\boldsymbol{\\beta}} = (\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X} + \\mathbf{S}_{\\boldsymbol{\\lambda}})^{-1}$ 是在拉普拉斯近似下从贝叶斯后验推导出来的。它正确地指定了为线性组合 $f_1(x_0)$ 构建 Wald 型区间的方法。后续对该区间属性的讨论——它是逐点的，对于大 $n$ 近似名义水平，但由于偏差（在高曲率区域/边界）和被忽略的平滑参数不确定性而容易出现覆盖不足——是对这些区间的已知频率学派属性的精确和完整总结。\n结论：**正确**。\n\n**B. 在量化不确定性时忽略惩罚，并使用未惩罚的协方差 $(\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X})^{-1}$ 作为 $\\boldsymbol{\\beta}$ 的协方差。计算 $\\widehat{\\operatorname{Var}}\\{f_1(x_0)\\} = \\mathbf{l}(x_0)^{\\top}(\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X})^{-1}\\mathbf{l}(x_0)$ 并形成通常的 Wald 区间；这会对任何 $n$ 产生精确的 $95\\%$ 覆盖率，因为惩罚只影响估计，不影响变异性。**\n这个选项根本上是错误的。惩罚项是估计器定义的一个组成部分；它以引入偏差为代价来减小方差。在协方差计算中忽略惩罚项 $\\mathbf{S}_{\\boldsymbol{\\lambda}}$ 将意味着将 GAM 视为一个标准的未惩罚 GLM，其中有大量可能共线的基系数，这将导致方差被严重高估。惩罚不影响变异性的说法是错误的。此外，“对任何 $n$ 产生精确的 $95\\%$ 覆盖率”的断言也是错误的；即使对于未惩罚的 GLM，覆盖率也是渐近的，而不是对于有限 $n$ 精确的。\n结论：**不正确**。\n\n**C. 使用三明治协方差 $(\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X}+\\mathbf{S}_{\\boldsymbol{\\lambda}})^{-1}\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X}(\\mathbf{X}^{\\top}\\mathbf{W}\\mathbf{X}+\\mathbf{S}_{\\boldsymbol{\\lambda}})^{-1}$作为 $\\boldsymbol{\\beta}$ 的协方差来计算 $\\widehat{\\operatorname{Var}}\\{f_1(x_0)\\}$，然后通过将逆连接函数应用于加性预测变量的端点，在均值尺度上形成一个 Wald 区间。这种构建方法保证是保守的，为整个函数 $f_1$ 提供至少 $95\\%$ 的同时覆盖率。**\n所提出的协方差矩阵是文献中已知的一种有效替代方案，有时用于在一定程度上解释偏差以提供更好的频率学派覆盖率。然而，关于其性能的说法是不正确的，并且被极大地夸大了。首先，这种构造提供的是*逐点*区间，而不是整个函数 $f_1$ 的*同时*区间。同时带需要不同且更复杂的计算。其次，完全没有保证该区间会是保守的（覆盖率 $\\ge 95\\%$）。它的性能取决于具体问题，并且仍然可能覆盖不足。“保证”的说法是错误的。\n结论：**不正确**。\n\n**D. 首先通过取加性预测变量区间 $\\hat{\\eta}(x_0) \\pm z_{0.975}\\,\\widehat{\\operatorname{se}}\\{\\hat{\\eta}(x_0)\\}$，将其端点应用逆连接函数 $g^{-1}$，然后报告转换后的区间，来为均值 $\\mu(x_0)$ 构建一个逐点区间。因为 $g^{-1}$ 是单调的，所以这种转换保留了精确的 $95\\%$ 逐点覆盖率，而不管偏差或平滑参数的不确定性如何。**\n这个选项在两方面存在缺陷。首先，它误解了推断目标，即为分量 $f_1(x_0)$ 构建区间，而不是为完整的线性预测变量 $\\eta(x_0)$ 或均值 $\\mu(x_0)$。$\\hat{\\eta}(x_0)$ 的标准误与 $\\hat{f}_1(x_0)$ 的标准误不同。其次，“通过 $g^{-1}$ 反变换‘保留了精确的 $95\\%$ 逐点覆盖率，而不管偏差或平滑参数的不确定性如何’”的说法是毫无意义的。虽然单调变换保留了覆盖概率，但它无法修复原始区间的缺陷。如果 $\\eta(x_0)$ 的区间由于偏差而具有例如 $91\\%$ 的覆盖率，那么变换后的 $\\mu(x_0)$ 区间也将具有 $91\\%$ 的覆盖率，而不是“精确的 $95\\%$ 覆盖率”。\n结论：**不正确**。\n\n**E. 为了校正平滑偏差，将惩罚贡献直接加到方差上：取 $\\widehat{\\operatorname{Var}}\\{f_1(x_0)\\} = \\mathbf{l}(x_0)^{\\top}\\widehat{\\operatorname{Cov}}(\\boldsymbol{\\beta})\\,\\mathbf{l}(x_0) + \\mathbf{l}(x_0)^{\\top}\\mathbf{S}_{\\boldsymbol{\\lambda}}\\,\\mathbf{l}(x_0)$，这将产生无偏的估计，因此在所有 $x_0$ 处都具有精确的名义 $95\\%$ 覆盖率。**\n这个选项提出了一种临时的、没有理论根据的方法。偏差是估计器期望值的系统性误差，而方差衡量其离散程度。不能通过简单地将一个与惩罚矩阵 $\\mathbf{S}_{\\boldsymbol{\\lambda}}$ 相关的项加到方差中来校正偏差。这个过程在统计理论中没有任何依据。因此，关于它能产生无偏估计和“在所有 $x_0$ 处都具有精确的名义 $95\\%$ 覆盖率”的说法是完全错误的。\n结论：**不正确**。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在拟合 GAM 时，一个最关键的实践决策是为每个平滑项选择一个足够的基维度 ($K$)，因为它设定了函数灵活性的上限。本练习介绍了一种基于随机分位数残差的原则性诊断程序，用于检查所选的 $K$ 是否足够。掌握这项技术对于避免欠拟合、确保模型具有足够的灵活性以捕捉数据中的潜在模式至关重要。",
            "id": "4964130",
            "problem": "一家医院研究了在 $i=1,\\dots,n$ 天内，耐甲氧西林金黄色葡萄球菌 (MRSA) 阳性培养物的每日计数 $Y_i$。研究使用广义加性模型 (GAM; Generalized Additive Model)，该模型采用对数连接函数和负二项响应分布以处理过度离散问题。其线性预测器指定为\n$$\n\\eta_i = g\\!\\left(\\mathbb{E}(Y_i \\mid \\mathbf{x}_i)\\right) = \\beta_0 + \\sum_{j=1}^J f_j(x_{ij}) + \\mathbf{z}_i^\\top \\boldsymbol{\\gamma},\n$$\n其中 $g(\\cdot)$ 表示对数连接，$f_j(\\cdot)$ 是连续协变量 $x_{ij}$（如病房占用率和抗生素使用率）的未知平滑函数，而 $\\mathbf{z}_i$ 是额外的分类指示变量（如病房类型）。每个平滑函数都由一个有限基展开表示，\n$$\nf_j(x) = \\sum_{k=1}^{K_j} b_{jk}(x)\\,\\theta_{jk},\n$$\n其中包含基函数 $b_{jk}(\\cdot)$、系数 $\\theta_{jk}$ 和基维度 $K_j$，并受到由平滑参数控制的粗糙度惩罚。\n\n您的任务是提出一种诊断方法，用于检查所选基维度 $K_j$ 是否足够，重点关注残差模式以及应用于随机化分位数残差的形式检验。该诊断方法必须从适用于医学计数数据的广义加性模型的第一性原理出发进行论证，并且应依赖于基础性结果，如概率积分变换和条件分布的性质，而不是特定模型的启发式方法。\n\n下列哪种诊断程序最能满足这些要求，以评估 $K_j$ 的充分性，并说明原因？\n\nA. 对每个平滑函数 $f_j$，计算随机化分位数残差 $r_i = \\Phi^{-1}(U_i)$，其中 $U_i \\sim \\text{Uniform}\\!\\big(F_{Y\\mid \\mathbf{X}}(Y_i^{-}\\mid \\mathbf{x}_i),\\,F_{Y\\mid \\mathbf{X}}(Y_i\\mid \\mathbf{x}_i)\\big)$ 且 $\\Phi(\\cdot)$ 是标准正态累积分布函数。然后，目视检查 $r_i$ 相对于 $x_{ij}$ 的关系是否存在系统性结构，并使用一个特意设置的较大基维度 $K_j^{\\ast} > K_j$ 对 $r_i$ 关于 $x_{ij}$ 拟合一个辅助平滑器。对该辅助拟合使用一个形式化的零平滑检验（例如，近似 F 检验或总结残差结构程度的 k 指数诊断）来检验 $H_0: g_j(x)=0$。如果对任何 $j$ 存在显著的残差结构，则增加 $K_j$ 并重新拟合；否则，认为 $K_j$ 足够。\n\nB. 计算皮尔逊残差 $e_i = (Y_i - \\hat{\\mu}_i)/\\hat{\\sigma}_i$，并使用样本自相关函数和游程检验评估其在观测索引 $i$ 上的自相关性。如果没有序列相关，则宣布所选的 $K_j$ 足够，而不检查残差相对于单个协变量 $x_{ij}$ 的关系，也不执行基于随机化分位数残差的形式检验。\n\nC. 增加平滑参数的值，直到随机化分位数残差 $r_i$ 通过正态性检验（例如，在显著性水平 $\\alpha = 0.05$ 下的 Shapiro–Wilk 检验）；如果残差呈现正态分布，则断定所选的 $K_j$ 足够，因为正态残差意味着正确的平滑度和基维度。\n\nD. 依赖于解释偏差的启发式阈值：如果拟合模型解释了至少 $80\\%$ 的偏差，则所选的 $K_j$ 足够；否则增加 $K_j$，因为更大的基维度通常会增加解释的偏差。\n\nE. 使用留一交叉验证来估计预测误差，并选择 $K_j$ 使其最小化；如果最小值在当前的 $K_j$ 附近达到，则宣布其足够，而不进行基于残差的可视化或涉及随机化分位数残差或 k 指数诊断的形式检验程序。\n\n选择一个选项，该选项为在这种医学 GAM 背景下，使用残差模式和对随机化分位数残差的形式检验来诊断 $K_j$ 充分性提供了方法论上合理、基于第一性原理的论证。",
            "solution": "问题陈述是在医学研究背景下对统计建模诊断的有效应用。我将进行完整的推导和分析。\n\n### GAM基维度的模型诊断原理\n\n核心任务是评估广义加性模型 (GAM) 中每个平滑项 $f_j(x_{ij})$ 的基维度 $K_j$ 是否足够。该模型由下式给出\n$$\n\\eta_i = \\log(\\mathbb{E}(Y_i \\mid \\mathbf{x}_i)) = \\beta_0 + \\sum_{j=1}^J f_j(x_{ij}) + \\mathbf{z}_i^\\top \\boldsymbol{\\gamma}\n$$\n其中 $Y_i$ 服从负二项分布。每个平滑函数 $f_j(x)$ 由基展开式 $f_j(x) = \\sum_{k=1}^{K_j} b_{jk}(x)\\,\\theta_{jk}$ 表示。\n\n基维度 $K_j$ 对估计的平滑函数 $\\hat{f}_j$ 的复杂性（或“弯曲度”）设定了上限。如果选择的 $K_j$ 过小，那么无论如何选择平滑惩罚，该基都可能无法表示响应与协变量 $x_{ij}$ 之间的真实函数关系。这会导致模型设定错误。真实函数 $f_j$ 中无法被有限基捕捉到的部分，将在模型的残差相对于协变量 $x_{ij}$ 的散点图中表现为系统性结构。\n\n因此，一个可靠的 $K_j$ 充分性诊断方法必须基于对此类残差模式的检查。\n\n一个关键的初始步骤是选择合适的残差类型。对于具有离散响应（如负二项分布）的模型，标准残差（如皮尔逊残差或偏差残差）不适合用于视觉模式检测。这是因为，即使在模型设定正确的情况下，它们的分布也非标准，并且会呈现出由 $Y_i$ 的离散性质造成的伪影（例如条纹状图案）。\n\n理论上合理的方法是使用基于概率积分变换 (PIT) 的随机化分位数残差。对于一个具有累积分布函数 (CDF) $F_Y$ 的随机变量 $Y$，PIT 指出，如果 $Y$ 是连续的，则 $F_Y(Y)$ 在 $(0, 1)$ 上均匀分布。对于离散变量，这不再成立。但是，可以定义一个随机变量 $U_i$，它从对应于观测值 $Y_i$ 处概率质量的区间上的均匀分布中抽取：\n$$\nU_i \\sim \\text{Uniform}\\!\\left( \\lim_{y \\to Y_i^-} F_{Y\\mid \\mathbf{X}}(y \\mid \\mathbf{x}_i),\\, F_{Y\\mid \\mathbf{X}}(Y_i \\mid \\mathbf{x}_i) \\right)\n$$\n其中 $F_{Y\\mid \\mathbf{X}}$ 是给定协变量下响应的条件 CDF，使用拟合的模型参数进行评估。如果模型设定正确，这些 $U_i$ 将近似为来自 $\\text{Uniform}(0, 1)$ 分布的独立同分布 (i.i.d.) 样本。\n\n为了更容易进行视觉检查和形式检验，这些均匀残差通常使用逆正态 CDF $\\Phi^{-1}(\\cdot)$ 变换到标准正态尺度：\n$$\nr_i = \\Phi^{-1}(U_i)\n$$\n如果模型正确，这些得到的随机化分位数残差 $r_i$ 应近似为来自标准正态分布 $\\text{Normal}(0, 1)$ 的独立同分布样本。至关重要的是，它们不应表现出对任何协变量的依赖性，即对所有 $j$，$\\mathbb{E}[r_i \\mid x_{ij}] = 0$。\n\n为了检验 $\\mathbb{E}[r_i \\mid x_{ij}] = 0$ 是否成立，我们可以拟合一个残差对协变量的辅助模型：\n$$\nr_i = g_j(x_{ij}) + \\epsilon_i\n$$\n其中 $g_j(\\cdot)$ 是另一个平滑函数。对于原始 $f_j$ 充分性的原假设是 $H_0: g_j(x) = 0$。如果我们拒绝此原假设，我们断定残差中存在作为 $x_{ij}$ 函数的显著结构，这意味着原始模型对此协变量的设定（很可能受限于 $K_j$）是不充分的。\n\n为了给这个检验足够的检验效力，辅助平滑 $g_j$ 的基维度（我们称之为 $K_j^*$）应选择得足够大，以确保其本身不会成为限制因素。标准做法建议使用一个比原始 $K_j$ 稍大的值。辅助平滑 $g_j$ 的显著性可以通过用于零效应的形式统计检验来评估，例如近似 F 检验或 $\\chi^2$ 检验，这些是 GAM 软件中的标准输出。该检验的极小 p 值是 $K_j$ 过小的强有力证据。\n\n### 选项评估\n\n**A. 对每个平滑函数 $f_j$，计算随机化分位数残差 $r_i = \\Phi^{-1}(U_i)$，其中 $U_i \\sim \\text{Uniform}\\!\\big(F_{Y\\mid \\mathbf{X}}(Y_i^{-}\\mid \\mathbf{x}_i),\\,F_{Y\\mid \\mathbf{X}}(Y_i\\mid \\mathbf{x}_i)\\big)$ 且 $\\Phi(\\cdot)$ 是标准正态累积分布函数。然后，目视检查 $r_i$ 相对于 $x_{ij}$ 的关系是否存在系统性结构，并使用一个特意设置的较大基维度 $K_j^{\\ast} > K_j$ 对 $r_i$ 关于 $x_{ij}$ 拟合一个辅助平滑器。对该辅助拟合使用一个形式化的零平滑检验（例如，近似 F 检验或总结残差结构程度的 k 指数诊断）来检验 $H_0: g_j(x)=0$。如果对任何 $j$ 存在显著的残差结构，则增加 $K_j$ 并重新拟合；否则，认为 $K_j$ 足够。**\n\n该选项精确地遵循了上面概述的第一性原理推导。它正确地指出了使用随机化分位数残差是处理离散数据的恰当工具。它正确地确定了诊断目标：残差结构作为协变量的函数，即 $\\mathbb{E}[r_i | x_{ij}] \\neq 0$。它提出了检验这一点的正确方法：拟合一个残差对协变量的辅助 GAM。它正确地指明了为保证检验效力，这个辅助拟合的基应该很大。最后，它提出了正确的形式统计检验（零平滑检验）和正确的操作（如果检验显著则增加 $K_j$）。这代表了针对此诊断任务的、当前最先进且有理论依据的程序。\n\n**结论：正确。**\n\n**B. 计算皮尔逊残差 $e_i = (Y_i - \\hat{\\mu}_i)/\\hat{\\sigma}_i$，并使用样本自相关函数和游程检验评估其在观测索引 $i$ 上的自相关性。如果没有序列相关，则宣布所选的 $K_j$ 足够，而不检查残差相对于单个协变量 $x_{ij}$ 的关系，也不执行基于随机化分位数残差的形式检验。**\n\n该选项在两个主要方面存在缺陷。首先，它使用皮尔逊残差，众所周知，由于其非标准分布，在诊断离散数据模型中的设定错误时存在问题。其次，它只检查了相对于观测索引 $i$ 的自相关性。虽然在数据是时间序列的情况下检查时间依赖性很重要，但这并不能诊断协变量效应 $f_j(x_{ij})$ 的函数形式设定错误。$K_j$ 的不足会在残差对 $x_{ij}$ 的图中产生模式，而不一定是在对 $i$ 的图中。该诊断方法忽略了问题的核心。\n\n**结论：不正确。**\n\n**C. 增加平滑参数的值，直到随机化分位数残差 $r_i$ 通过正态性检验（例如，在显著性水平 $\\alpha = 0.05$ 下的 Shapiro–Wilk 检验）；如果残差呈现正态分布，则断定所选的 $K_j$ 足够，因为正态残差意味着正确的平滑度和基维度。**\n\n该选项从根本上是错误的。首先，虽然随机化分位数残差的边际正态性是模型正确的一个必要条件，但它并非充分条件。一个模型可以产生边际上呈正态分布的残差，但在绘制其与协变量的关系图时仍显示出强烈的条件模式。关键在于检查残差与协变量的独立性，而不仅仅是残差的边际分布。其次，提议的操作是错误的。如果 $K_j$ 过小，基就过于受限。增加平滑参数会使估计的函数*更平滑*（复杂度更低），这会加剧而不是解决基不够灵活的问题。问题出在基维度 $K_j$，而不是平滑惩罚。\n\n**结论：不正确。**\n\n**D. 依赖于解释偏差的启发式阈值：如果拟合模型解释了至少 $80\\%$ 的偏差，则所选的 $K_j$ 足够；否则增加 $K_j$，因为更大的基维度通常会增加解释的偏差。**\n\n该提议依赖于一个粗略的、全局性的启发式方法。$80\\%$ 的阈值是任意的，没有任何统计学原理作为依据。高的解释偏差并不能排除一个或多个平滑项存在显著的局部设定错误。该方法没有提供关于*哪个* $K_j$ 可能不足的具体信息。它未能满足题目要求的基于第一性原理和残差分析的诊断方法。\n\n**结论：不正确。**\n\n**E. 使用留一交叉验证来估计预测误差，并选择 $K_j$ 使其最小化；如果最小值在当前的 $K_j$ 附近达到，则宣布其足够，而不进行基于残差的可视化或涉及随机化分位数残差或 k 指数诊断的形式检验程序。**\n\n该选项描述的是一个*模型选择*的程序，而不是题目所要求的对一个已拟合模型的*诊断性检查*。对于 GAM 而言，标准且计算上最高效的方法是，将 $K_j$ 固定得足够大，然后使用交叉验证或边际似然来选择控制有效自由度的平滑参数。虽然人们*可以*通过交叉验证来选择 $K_j$，但这在计算上非常昂贵，也不是标准的诊断程序。更重要的是，问题明确要求一种“关注残差模式以及应用于随机化分位数残差的形式检验”的诊断方法，而该选项明确排除了这一点。\n\n**结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}