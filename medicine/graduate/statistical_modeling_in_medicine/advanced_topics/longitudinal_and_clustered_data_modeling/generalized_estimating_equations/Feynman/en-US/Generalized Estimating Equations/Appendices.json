{
    "hands_on_practices": [
        {
            "introduction": "While statistical software handles the complex calculations, understanding the mechanics of how Generalized Estimating Equations are solved provides invaluable insight. This practice guides you through one complete update step of the Iteratively Reweighted Least Squares (IRLS) algorithm for a single patient . By constructing the core matrix components by hand, you will see precisely how GEE combines the mean model and the working correlation structure to refine its parameter estimates.",
            "id": "4964764",
            "problem": "A hospital is conducting a longitudinal study of daily medication adherence in patients with chronic disease. For a single patient indexed by $i$, adherence is recorded as a binary response over $3$ consecutive days, yielding the response vector $Y_i = (1, 0, 1)^{\\top}$. The covariates for the patient are an intercept and a time index $t \\in \\{0,1,2\\}$, so the design matrix is\n$$\nX_i = \\begin{pmatrix}\n1 & 0 \\\\\n1 & 1 \\\\\n1 & 2\n\\end{pmatrix}.\n$$\nModel the mean of the binary response using a generalized linear model with the logit link, so that the generalized estimating equations (GEE) with exchangeable working correlation structure are used to estimate the regression parameters. Assume the following modeling framework:\n- The mean response satisfies $g(\\mu_{ij}) = \\eta_{ij}$ with $g(\\cdot)$ the logit link, so $g(\\mu) = \\ln\\!\\left(\\frac{\\mu}{1-\\mu}\\right)$ and $\\eta_{ij} = x_{ij}^{\\top}\\beta$, where $x_{ij}^{\\top}$ is the $j$th row of $X_i$.\n- The variance function for the Bernoulli response is $V(\\mu_{ij}) = \\mu_{ij}(1-\\mu_{ij})$ and the scale parameter is $\\phi = 1$.\n- The working correlation matrix for the $3$ measurements is exchangeable with correlation parameter $\\alpha = 0.2$.\n\nStarting from the definitions of the link function, variance function, and working correlation structure, and using the initial parameter vector $\\beta^{(0)} = (0, 0)^{\\top}$, do the following for this single patient $i$:\n1. Derive and write the matrix forms for the derivative (design) matrix $D_i$, the working covariance matrix $V_i$, and the residual vector $r_i = Y_i - \\mu_i$, where $\\mu_i$ is the mean vector at $\\beta^{(0)}$.\n2. Detail the steps of the Iteratively Reweighted Least Squares (IRLS) algorithm for solving the GEE, and carry out one full IRLS update from $\\beta^{(0)}$ to obtain $\\beta^{(1)}$ for this patient.\n\nReport the updated intercept component $\\beta^{(1)}_0$ as a single exact value. Do not round your answer. Express the final answer as a single number without units.",
            "solution": "We begin from the foundational definitions for generalized linear models and generalized estimating equations. The model specifies the relationship $g(\\mu_{ij}) = \\eta_{ij}$ with $g(\\cdot)$ the logit link $g(\\mu) = \\ln\\!\\left(\\frac{\\mu}{1-\\mu}\\right)$ and $\\eta_{ij} = x_{ij}^{\\top}\\beta$. The inverse link for the logit is the logistic function, so $\\mu_{ij} = \\frac{\\exp(\\eta_{ij})}{1+\\exp(\\eta_{ij})}$. The variance function for the Bernoulli distribution is $V(\\mu_{ij}) = \\mu_{ij}(1-\\mu_{ij})$, and the derivative of the mean with respect to the linear predictor for the logit link is\n$$\n\\frac{d\\mu_{ij}}{d\\eta_{ij}} = \\mu_{ij}(1-\\mu_{ij}).\n$$\nIn the generalized estimating equations (GEE) framework, with exchangeable working correlation matrix $R(\\alpha)$ of dimension $m \\times m$ for $m$ repeated measures, the working covariance for cluster $i$ is\n$$\nV_i = A_i^{1/2} R(\\alpha) A_i^{1/2},\n$$\nwhere $A_i = \\mathrm{diag}\\!\\big(V(\\mu_{i1}), \\dots, V(\\mu_{im})\\big)$ and $\\phi=1$ is absorbed since it equals $1$ here. The derivative (design) matrix is\n$$\nD_i = \\frac{\\partial \\mu_i}{\\partial \\beta^{\\top}} = \\mathrm{diag}\\!\\left(\\frac{d\\mu_{ij}}{d\\eta_{ij}}\\right) X_i = A_i X_i.\n$$\nThe residual vector is $r_i = Y_i - \\mu_i$.\n\nWe now specialize to the given patient. There are $m = 3$ measurements, $Y_i = (1, 0, 1)^{\\top}$, and\n$$\nX_i = \\begin{pmatrix}\n1 & 0 \\\\\n1 & 1 \\\\\n1 & 2\n\\end{pmatrix}.\n$$\nAt the initial parameter vector $\\beta^{(0)} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$, the linear predictor is\n$$\n\\eta_i^{(0)} = X_i \\beta^{(0)} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\nTherefore the mean vector is\n$$\n\\mu_i^{(0)} = \\begin{pmatrix} \\frac{\\exp(0)}{1+\\exp(0)} \\\\ \\frac{\\exp(0)}{1+\\exp(0)} \\\\ \\frac{\\exp(0)}{1+\\exp(0)} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2} \\\\ \\frac{1}{2} \\\\ \\frac{1}{2} \\end{pmatrix}.\n$$\nThe variance function evaluated at these means gives\n$$\nA_i = \\mathrm{diag}\\!\\left(\\mu_{ij}^{(0)}(1-\\mu_{ij}^{(0)})\\right) = \\mathrm{diag}\\!\\left(\\frac{1}{4}, \\frac{1}{4}, \\frac{1}{4}\\right).\n$$\nHence the derivative matrix is\n$$\nD_i = A_i X_i = \\begin{pmatrix}\n\\frac{1}{4} & 0 \\\\\n\\frac{1}{4} & \\frac{1}{4} \\\\\n\\frac{1}{4} & \\frac{1}{2}\n\\end{pmatrix}.\n$$\nThe working correlation matrix $R(\\alpha)$ under exchangeability is the $3 \\times 3$ matrix with ones on the diagonal and $\\alpha$ off-diagonal. With $\\alpha = 0.2$,\n$$\nR(\\alpha) = \\begin{pmatrix}\n1 & 0.2 & 0.2 \\\\\n0.2 & 1 & 0.2 \\\\\n0.2 & 0.2 & 1\n\\end{pmatrix}.\n$$\nUsing $A_i^{1/2} = \\mathrm{diag}\\!\\left(\\frac{1}{2}, \\frac{1}{2}, \\frac{1}{2}\\right)$, the working covariance matrix becomes\n$$\nV_i = A_i^{1/2} R(\\alpha) A_i^{1/2} = \\frac{1}{4} R(\\alpha) = \\frac{1}{4} \\begin{pmatrix}\n1 & 0.2 & 0.2 \\\\\n0.2 & 1 & 0.2 \\\\\n0.2 & 0.2 & 1\n\\end{pmatrix}.\n$$\nThe residual vector at $\\beta^{(0)}$ is\n$$\nr_i = Y_i - \\mu_i^{(0)} = \\begin{pmatrix} 1 - \\frac{1}{2} \\\\ 0 - \\frac{1}{2} \\\\ 1 - \\frac{1}{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2} \\\\ -\\frac{1}{2} \\\\ \\frac{1}{2} \\end{pmatrix}.\n$$\n\nWe now outline and implement the Iteratively Reweighted Least Squares (IRLS) algorithm for GEE. The algorithm proceeds by:\n1. Initializing $\\beta^{(0)}$.\n2. Computing $\\mu_i^{(0)}$, $A_i^{(0)}$, $D_i^{(0)}$, and $V_i^{(0)}$ from the definitions above.\n3. Forming the working normal equations based on the GEE score,\n$$\nU(\\beta) = \\sum_{i} D_i^{\\top} V_i^{-1} (Y_i - \\mu_i),\n$$\nand the working Fisher information,\n$$\n\\mathcal{I}(\\beta) = \\sum_{i} D_i^{\\top} V_i^{-1} D_i.\n$$\n4. Updating via\n$$\n\\beta^{(k+1)} = \\beta^{(k)} + \\left[\\sum_{i} D_i^{\\top} V_i^{-1} D_i \\right]^{-1} \\left[\\sum_{i} D_i^{\\top} V_i^{-1} r_i^{(k)} \\right].\n$$\nFor our single patient, the sums are over a single $i$, so we compute the quantities for $i$ and update accordingly.\n\nFirst, compute $V_i^{-1}$. For an exchangeable $R(\\alpha)$ of size $m=3$, write $R(\\alpha) = (1-\\alpha) I_3 + \\alpha J_3$, where $J_3$ is the $3 \\times 3$ matrix of ones. Its inverse is\n$$\nR(\\alpha)^{-1} = \\frac{1}{1-\\alpha} I_3 - \\frac{\\alpha}{(1-\\alpha)(1-\\alpha + m\\alpha)} J_3.\n$$\nWith $\\alpha = 0.2$, we have $1-\\alpha = 0.8 = \\frac{4}{5}$ and $1-\\alpha + m\\alpha = 0.8 + 3 \\cdot 0.2 = 1.4 = \\frac{7}{5}$. Therefore\n$$\nR(\\alpha)^{-1} = \\frac{5}{4} I_3 - \\frac{5}{28} J_3.\n$$\nSince $V_i = \\frac{1}{4} R(\\alpha)$, it follows that\n$$\nV_i^{-1} = 4 R(\\alpha)^{-1} = 5 I_3 - \\frac{5}{7} J_3.\n$$\nApplying $V_i^{-1}$ to any vector $z \\in \\mathbb{R}^3$ yields $V_i^{-1} z = 5 z - \\frac{5}{7} \\big( \\mathbf{1}^{\\top} z \\big) \\mathbf{1}$, where $\\mathbf{1}$ is the $3$-vector of ones.\n\nCompute $V_i^{-1} r_i$:\n$$\n\\sum_{j=1}^{3} r_{ij} = \\frac{1}{2} - \\frac{1}{2} + \\frac{1}{2} = \\frac{1}{2},\n$$\nso\n$$\nV_i^{-1} r_i = 5 r_i - \\frac{5}{7} \\cdot \\frac{1}{2} \\cdot \\mathbf{1} = \\begin{pmatrix} \\frac{15}{7} \\\\ -\\frac{20}{7} \\\\ \\frac{15}{7} \\end{pmatrix}.\n$$\nNext, compute the score contribution $D_i^{\\top} V_i^{-1} r_i$. Using\n$$\nD_i = \\begin{pmatrix}\n\\frac{1}{4} & 0 \\\\\n\\frac{1}{4} & \\frac{1}{4} \\\\\n\\frac{1}{4} & \\frac{1}{2}\n\\end{pmatrix},\n\\quad\nV_i^{-1} r_i = \\begin{pmatrix} \\frac{15}{7} \\\\ -\\frac{20}{7} \\\\ \\frac{15}{7} \\end{pmatrix},\n$$\nwe obtain\n$$\nD_i^{\\top} V_i^{-1} r_i = \\begin{pmatrix}\n\\frac{1}{4} & \\frac{1}{4} & \\frac{1}{4} \\\\\n0 & \\frac{1}{4} & \\frac{1}{2}\n\\end{pmatrix}\n\\begin{pmatrix} \\frac{15}{7} \\\\ -\\frac{20}{7} \\\\ \\frac{15}{7} \\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{5}{14} \\\\\n\\frac{5}{14}\n\\end{pmatrix}.\n$$\nWe also need the working information matrix $D_i^{\\top} V_i^{-1} D_i$. Compute $V_i^{-1}$ applied to the columns of $D_i$. Denote the first column of $D_i$ by $d_1 = \\begin{pmatrix} \\frac{1}{4} \\\\ \\frac{1}{4} \\\\ \\frac{1}{4} \\end{pmatrix}$ and the second column by $d_2 = \\begin{pmatrix} 0 \\\\ \\frac{1}{4} \\\\ \\frac{1}{2} \\end{pmatrix}$. Their sums are\n$$\n\\mathbf{1}^{\\top} d_1 = \\frac{3}{4}, \\quad \\mathbf{1}^{\\top} d_2 = \\frac{3}{4}.\n$$\nThus\n$$\nV_i^{-1} d_1 = 5 d_1 - \\frac{5}{7} \\cdot \\frac{3}{4} \\mathbf{1} = \\begin{pmatrix} \\frac{5}{7} \\\\ \\frac{5}{7} \\\\ \\frac{5}{7} \\end{pmatrix},\n\\quad\nV_i^{-1} d_2 = 5 d_2 - \\frac{5}{7} \\cdot \\frac{3}{4} \\mathbf{1} = \\begin{pmatrix} -\\frac{15}{28} \\\\ \\frac{5}{7} \\\\ \\frac{55}{28} \\end{pmatrix}.\n$$\nTherefore the $2 \\times 2$ matrix $D_i^{\\top} V_i^{-1} D_i$ has entries\n$$\n(D_i^{\\top} V_i^{-1} D_i)_{11} = d_1^{\\top} (V_i^{-1} d_1) = \\frac{15}{28}, \\quad\n(D_i^{\\top} V_i^{-1} D_i)_{12} = d_1^{\\top} (V_i^{-1} d_2) = \\frac{15}{28},\n$$\n$$\n(D_i^{\\top} V_i^{-1} D_i)_{21} = d_2^{\\top} (V_i^{-1} d_1) = \\frac{15}{28}, \\quad\n(D_i^{\\top} V_i^{-1} D_i)_{22} = d_2^{\\top} (V_i^{-1} d_2) = \\frac{65}{56}.\n$$\nHence\n$$\nD_i^{\\top} V_i^{-1} D_i = \\begin{pmatrix}\n\\frac{15}{28} & \\frac{15}{28} \\\\\n\\frac{15}{28} & \\frac{65}{56}\n\\end{pmatrix}.\n$$\nWe invert this matrix. Its determinant is\n$$\n\\det = \\frac{15}{28} \\cdot \\frac{65}{56} - \\frac{15}{28} \\cdot \\frac{15}{28} = \\frac{525}{1568} = \\frac{75}{224}.\n$$\nTherefore\n$$\n\\left(D_i^{\\top} V_i^{-1} D_i\\right)^{-1} = \\frac{224}{75} \\begin{pmatrix}\n\\frac{65}{56} & -\\frac{15}{28} \\\\\n-\\frac{15}{28} & \\frac{15}{28}\n\\end{pmatrix} = \\begin{pmatrix}\n\\frac{52}{15} & -\\frac{8}{5} \\\\\n-\\frac{8}{5} & \\frac{8}{5}\n\\end{pmatrix}.\n$$\nThe IRLS update for a single cluster is\n$$\n\\beta^{(1)} = \\beta^{(0)} + \\left(D_i^{\\top} V_i^{-1} D_i\\right)^{-1} \\left(D_i^{\\top} V_i^{-1} r_i\\right).\n$$\nSubstituting yields\n$$\n\\left(D_i^{\\top} V_i^{-1} D_i\\right)^{-1} \\left(D_i^{\\top} V_i^{-1} r_i\\right)\n=\n\\begin{pmatrix}\n\\frac{52}{15} & -\\frac{8}{5} \\\\\n-\\frac{8}{5} & \\frac{8}{5}\n\\end{pmatrix}\n\\begin{pmatrix}\n\\frac{5}{14} \\\\ \\frac{5}{14}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{26}{21} - \\frac{4}{7} \\\\\n-\\frac{4}{7} + \\frac{4}{7}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{2}{3} \\\\\n0\n\\end{pmatrix}.\n$$\nConsequently,\n$$\n\\beta^{(1)} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} \\frac{2}{3} \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\frac{2}{3} \\\\ 0 \\end{pmatrix}.\n$$\nThe updated intercept component is therefore\n$$\n\\beta^{(1)}_0 = \\frac{2}{3}.\n$$\nThis completes the derivation of $D_i$, $V_i$, and $r_i$ from first principles, the specification of the Iteratively Reweighted Least Squares (IRLS) steps, and the computation of the first IRLS update for the GEE in this medical longitudinal binary outcome setting.",
            "answer": "$$\\boxed{\\frac{2}{3}}$$"
        },
        {
            "introduction": "A key feature of GEE is its focus on population-averaged effects, providing a marginal interpretation that is often of direct interest in public health and epidemiology. This exercise demonstrates how to translate a regression coefficient from a logistic GEE model into a marginal odds ratio, a fundamental skill for applied analysis . Properly interpreting this parameter is crucial for understanding how an intervention affects the average response in the population, as opposed to its effect on a specific individual's risk.",
            "id": "4964705",
            "problem": "A multi-center longitudinal study of an anti-inflammatory therapy follows $n$ patients over $m$ clinic visits to assess whether a flare occurred at each visit. Let $Y_{ij} \\in \\{0,1\\}$ denote whether patient $i$ had a flare at visit $j$. The treatment assignment is a dichotomous indicator $T_i \\in \\{0,1\\}$ measured at baseline and held constant over time. The marginal mean of $Y_{ij}$ given covariates is modeled with a logistic link using Generalized Estimating Equations (GEE) with an exchangeable working correlation:\n$$\n\\ln\\!\\left(\\frac{\\mathbb{E}[Y_{ij} \\mid \\mathbf{X}_{ij}]}{1-\\mathbb{E}[Y_{ij} \\mid \\mathbf{X}_{ij}]}\\right)\n\\;=\\;\n\\beta_0 \\;+\\; \\beta_T T_i \\;+\\; \\beta_A \\,\\text{Age}_i \\;+\\; \\beta_S \\,\\text{Severity}_i \\;+\\; \\beta_{t2} I\\{j=2\\} \\;+\\; \\beta_{t3} I\\{j=3\\} \\;+\\; \\beta_{t4} I\\{j=4\\},\n$$\nwith no interactions. Here $\\text{Age}_i$ is baseline age in years, $\\text{Severity}_i$ is a standardized baseline severity score, and $I\\{j=k\\}$ are visit indicators. The GEE is fit with a robust sandwich variance, and the following coefficient estimates are obtained:\n$$\n\\hat{\\beta}_0 = -1.62,\\quad \\hat{\\beta}_T = -0.3147107,\\quad \\hat{\\beta}_A = 0.011,\\quad \\hat{\\beta}_S = 0.207,\\quad \\hat{\\beta}_{t2} = 0.10,\\quad \\hat{\\beta}_{t3} = 0.05,\\quad \\hat{\\beta}_{t4} = 0.02.\n$$\nThe working correlation parameter estimate is $\\hat{\\alpha} = 0.22$ under the exchangeable structure.\n\nStarting only from the definitions of the logistic link and the odds for a binary outcome, and treating the GEE mean model as the population-averaged specification for $\\mathbb{E}[Y_{ij}\\mid \\mathbf{X}_{ij}]$, do the following:\n\n1) Derive an expression, in terms of $\\beta_T$, for the population-averaged odds ratio comparing $T_i=1$ to $T_i=0$ while holding the other covariates fixed (no interaction terms are present).\n\n2) Using the reported estimate $\\hat{\\beta}_T$, compute the estimated marginal odds ratio. Round your numerical answer to four significant figures.\n\n3) Briefly state the interpretation of this odds ratio in the population-averaged sense with respect to repeated measures and covariate adjustment. Do not compute any confidence intervals.\n\nYour final reported answer must be only the numerical value from part $2$, rounded to four significant figures and with no units.",
            "solution": "We begin from two foundational definitions:\n\n- For a binary outcome with probability $p$, the odds are $p/(1-p)$.\n\n- Under a logistic link, the log-odds (logit) of the marginal mean is linear in covariates: if $p = \\mathbb{E}[Y_{ij}\\mid \\mathbf{X}_{ij}]$, then $\\ln\\!\\left(\\frac{p}{1-p}\\right) = \\mathbf{X}_{ij}^{\\top}\\boldsymbol{\\beta}$.\n\nPart $1$. Let $\\mathbf{Z}_{ij}$ collect all covariates except the treatment indicator $T_i$. Under the stated GEE mean model with no interactions, for any fixed $\\mathbf{Z}_{ij}$, define\n$$\np_1 \\equiv \\Pr(Y_{ij}=1\\mid T_i=1,\\mathbf{Z}_{ij}),\\qquad\np_0 \\equiv \\Pr(Y_{ij}=1\\mid T_i=0,\\mathbf{Z}_{ij}).\n$$\nBy the logistic mean specification,\n$$\n\\ln\\!\\left(\\frac{p_1}{1-p_1}\\right) = \\beta_0 + \\beta_T\\cdot 1 + \\mathbf{Z}_{ij}^{\\top}\\boldsymbol{\\beta}_Z\n\\quad\\text{and}\\quad\n\\ln\\!\\left(\\frac{p_0}{1-p_0}\\right) = \\beta_0 + \\beta_T\\cdot 0 + \\mathbf{Z}_{ij}^{\\top}\\boldsymbol{\\beta}_Z,\n$$\nwhere $\\boldsymbol{\\beta}_Z$ are the coefficients for the non-treatment covariates. Subtracting these two equalities yields\n$$\n\\ln\\!\\left(\\frac{p_1}{1-p_1}\\right) - \\ln\\!\\left(\\frac{p_0}{1-p_0}\\right) \\;=\\; \\beta_T.\n$$\nExponentiating both sides gives\n$$\n\\frac{\\dfrac{p_1}{1-p_1}}{\\dfrac{p_0}{1-p_0}} \\;=\\; \\exp(\\beta_T).\n$$\nThe left-hand side is precisely the odds ratio comparing $T_i=1$ to $T_i=0$ holding $\\mathbf{Z}_{ij}$ fixed. Therefore, in this marginal (population-averaged) logistic GEE, the population-averaged odds ratio for treatment is\n$$\n\\text{OR}_{\\text{PA}} \\;=\\; \\exp(\\beta_T).\n$$\n\nPart $2$. Using the estimate $\\hat{\\beta}_T = -0.3147107$, the estimated marginal odds ratio is\n$$\n\\widehat{\\text{OR}}_{\\text{PA}} \\;=\\; \\exp(\\hat{\\beta}_T) \\;=\\; \\exp(-0.3147107).\n$$\nCompute this value:\n$$\n\\exp(-0.3147107) \\approx 0.7300000\\ldots\n$$\nRounding to four significant figures gives $0.7300$.\n\nPart $3$. Interpretation. In a Generalized Estimating Equations framework with a logistic link, $\\boldsymbol{\\beta}$ parameterizes the marginal mean $\\mathbb{E}[Y_{ij}\\mid \\mathbf{X}_{ij}]$ for the population, not subject-specific conditional means given latent random effects. With no treatment interactions, $\\exp(\\beta_T)$ is the factor by which the population-averaged odds of a flare at any visit change when comparing the treated population ($T_i=1$) to the untreated population ($T_i=0$), holding the covariates $\\text{Age}_i$, $\\text{Severity}_i$, and visit indicators fixed. Thus $\\widehat{\\text{OR}}_{\\text{PA}}\\approx 0.7300$ indicates that, at the same covariate values and at any visit, the population-averaged odds of a flare under treatment are about $0.73$ times those under no treatment. This is a marginal (population-averaged across the within-subject correlation) effect and is distinct from a subject-specific odds ratio from a random-effects logistic model; it remains conditional on the included covariates due to the non-collapsibility of the odds ratio. The working correlation $\\hat{\\alpha} = 0.22$ influences efficiency but does not alter this mean-structure-based interpretation.",
            "answer": "$$\\boxed{0.7300}$$"
        },
        {
            "introduction": "The presence of within-cluster correlation means that observations are not fully independent, which has profound implications for the precision of our estimates. This exercise asks you to derive the variance inflation factor, or \"design effect,\" from first principles for a cluster-randomized trial . This fundamental derivation reveals exactly how the intracluster correlation $\\rho$ and cluster size $n$ conspire to reduce statistical power and why methods like GEE, which account for this structure, are essential.",
            "id": "4964749",
            "problem": "Consider a cluster-randomized medical study analyzed with Generalized Estimating Equations (GEE) using an identity link for a continuous outcome (e.g., systolic blood pressure), where treatment is assigned at the cluster level. Suppose there are $K$ clusters per arm and each cluster has exactly $n$ individuals (balanced cluster sizes). Let $Y_{kj}$ denote the outcome for individual $j \\in \\{1,\\dots,n\\}$ in cluster $k \\in \\{1,\\dots,K\\}$. Assume a marginal mean model with constant variance $ \\operatorname{Var}(Y_{kj}) = \\sigma^{2}$ and an exchangeable intracluster correlation structure with intracluster correlation coefficient (ICC) $\\rho$, so that for $j \\neq \\ell$ within the same cluster,\n$$\n\\operatorname{Cov}(Y_{kj}, Y_{k\\ell}) = \\rho \\sigma^{2},\n$$\nand outcomes from different clusters are independent.\n\nDefine the marginal treatment effect estimator as the difference in arm means,\n$$\n\\hat{\\Delta} = \\bar{Y}_{\\text{T}} - \\bar{Y}_{\\text{C}},\n$$\nwhere $\\bar{Y}_{\\text{T}}$ and $\\bar{Y}_{\\text{C}}$ are the sample means of all individuals in the treatment and control arms, respectively. Using only foundational properties of variances and covariances (e.g., $ \\operatorname{Var}\\!\\left(\\sum_{i} Z_{i}\\right)=\\sum_{i} \\operatorname{Var}(Z_{i}) + 2 \\sum_{i<j} \\operatorname{Cov}(Z_{i}, Z_{j})$) and the exchangeable covariance structure described above, derive the variance of $\\hat{\\Delta}$ under the presence of intracluster correlation and compare it to the variance that would arise if outcomes were independent within clusters (i.e., $\\rho = 0$). From this comparison, obtain the multiplicative variance inflation factor, known as the design effect for balanced cluster sizes, as a closed-form function of $n$ and $\\rho$.\n\nProvide the final analytic expression for the design effect in terms of $n$ and $\\rho$. Do not provide a numerical approximation; no rounding is required, and no units should be included in the final expression.",
            "solution": "#### Derivation of the Variance of the Treatment Effect Estimator\n\nThe estimator for the treatment effect is given by $\\hat{\\Delta} = \\bar{Y}_{\\text{T}} - \\bar{Y}_{\\text{C}}$. Since individuals in the treatment arm are distinct from individuals in the control arm, and clusters are assigned to one arm or the other, the two sample means $\\bar{Y}_{\\text{T}}$ and $\\bar{Y}_{\\text{C}}$ are independent. Therefore, the variance of their difference is the sum of their variances:\n$$\n\\operatorname{Var}(\\hat{\\Delta}) = \\operatorname{Var}(\\bar{Y}_{\\text{T}} - \\bar{Y}_{\\text{C}}) = \\operatorname{Var}(\\bar{Y}_{\\text{T}}) + \\operatorname{Var}(\\bar{Y}_{\\text{C}})\n$$\nDue to the balanced design ($K$ clusters of size $n$ in each arm) and identical variance-covariance structure, the variance of the mean will be the same for both arms. Thus, $\\operatorname{Var}(\\bar{Y}_{\\text{T}}) = \\operatorname{Var}(\\bar{Y}_{\\text{C}})$. We can focus on deriving the variance for one arm, say the treatment arm, and then multiply the result by $2$.\n\nThe total number of individuals in the treatment arm is $nK$. The sample mean for the treatment arm is the average of all outcomes in that arm:\n$$\n\\bar{Y}_{\\text{T}} = \\frac{1}{nK} \\sum_{k=1}^{K} \\sum_{j=1}^{n} Y_{kj}^{\\text{T}}\n$$\nwhere $Y_{kj}^{\\text{T}}$ denotes the outcome for individual $j$ in cluster $k$ of the treatment arm. For notational simplicity, we will omit the superscript T. The variance of this mean is:\n$$\n\\operatorname{Var}(\\bar{Y}_{\\text{T}}) = \\operatorname{Var}\\left(\\frac{1}{nK} \\sum_{k=1}^{K} \\sum_{j=1}^{n} Y_{kj}\\right) = \\frac{1}{(nK)^2} \\operatorname{Var}\\left(\\sum_{k=1}^{K} \\sum_{j=1}^{n} Y_{kj}\\right)\n$$\nThe problem states that outcomes from different clusters are independent. This implies that the variance of a sum across clusters is the sum of the variances for each cluster's total.\n$$\n\\operatorname{Var}\\left(\\sum_{k=1}^{K} \\sum_{j=1}^{n} Y_{kj}\\right) = \\sum_{k=1}^{K} \\operatorname{Var}\\left(\\sum_{j=1}^{n} Y_{kj}\\right)\n$$\nNow, we must find the variance of the sum of outcomes within a single cluster $k$. Using the general formula for the variance of a sum of random variables:\n$$\n\\operatorname{Var}\\left(\\sum_{j=1}^{n} Y_{kj}\\right) = \\sum_{j=1}^{n} \\operatorname{Var}(Y_{kj}) + \\sum_{j=1}^{n} \\sum_{\\ell \\neq j} \\operatorname{Cov}(Y_{kj}, Y_{k\\ell})\n$$\nWe are given the following from the problem statement:\n1.  The variance of each individual outcome is $\\operatorname{Var}(Y_{kj}) = \\sigma^2$.\n2.  The covariance for any pair of distinct individuals within the same cluster is $\\operatorname{Cov}(Y_{kj}, Y_{k\\ell}) = \\rho \\sigma^2$ for $j \\neq \\ell$.\n\nThere are $n$ variance terms in the first summation. There are $n(n-1)$ ordered pairs of distinct indices $(j, \\ell)$, so there are $n(n-1)$ covariance terms. Substituting the given values:\n$$\n\\sum_{j=1}^{n} \\operatorname{Var}(Y_{kj}) = \\sum_{j=1}^{n} \\sigma^2 = n\\sigma^2\n$$\n$$\n\\sum_{j=1}^{n} \\sum_{\\ell \\neq j} \\operatorname{Cov}(Y_{kj}, Y_{k\\ell}) = n(n-1) \\rho \\sigma^2\n$$\nCombining these, the variance of the sum of outcomes within a single cluster is:\n$$\n\\operatorname{Var}\\left(\\sum_{j=1}^{n} Y_{kj}\\right) = n\\sigma^2 + n(n-1)\\rho\\sigma^2 = n\\sigma^2 \\left(1 + (n-1)\\rho\\right)\n$$\nSince this holds for any cluster $k$, and there are $K$ independent clusters in the arm, the variance of the total sum for the arm is:\n$$\n\\operatorname{Var}\\left(\\sum_{k=1}^{K} \\sum_{j=1}^{n} Y_{kj}\\right) = \\sum_{k=1}^{K} \\left[ n\\sigma^2(1 + (n-1)\\rho) \\right] = Kn\\sigma^2(1 + (n-1)\\rho)\n$$\nWe can now find the variance of the arm mean, $\\operatorname{Var}(\\bar{Y}_{\\text{T}})$:\n$$\n\\operatorname{Var}(\\bar{Y}_{\\text{T}}) = \\frac{1}{(nK)^2} \\left[ Kn\\sigma^2(1 + (n-1)\\rho) \\right] = \\frac{\\sigma^2(1 + (n-1)\\rho)}{nK}\n$$\nFinally, we calculate the variance of the estimator $\\hat{\\Delta}$:\n$$\n\\operatorname{Var}(\\hat{\\Delta}) = \\operatorname{Var}(\\bar{Y}_{\\text{T}}) + \\operatorname{Var}(\\bar{Y}_{\\text{C}}) = 2 \\operatorname{Var}(\\bar{Y}_{\\text{T}}) = \\frac{2\\sigma^2(1 + (n-1)\\rho)}{nK}\n$$\nThis expression is the variance of the treatment effect estimator under the specified intracluster correlation structure.\n\n#### Comparison with Independent Outcomes\n\nThe second step is to find the variance under the counterfactual scenario where all outcomes are independent, even within clusters. This corresponds to setting the intracluster correlation coefficient $\\rho=0$. Let's denote this variance as $\\operatorname{Var}_{\\text{indep}}(\\hat{\\Delta})$.\nSetting $\\rho=0$ in our derived formula:\n$$\n\\operatorname{Var}_{\\text{indep}}(\\hat{\\Delta}) = \\frac{2\\sigma^2(1 + (n-1)(0))}{nK} = \\frac{2\\sigma^2}{nK}\n$$\nThis result is consistent with first principles. If all $nK$ individuals in an arm are independent observations with variance $\\sigma^2$, the variance of their mean is $\\frac{\\sigma^2}{nK}$. The variance of the difference between two such independent means would be $\\frac{\\sigma^2}{nK} + \\frac{\\sigma^2}{nK} = \\frac{2\\sigma^2}{nK}$.\n\n#### Derivation of the Design Effect\n\nThe design effect (DEFF) is defined as the ratio of the variance of an estimator under the actual (clustered) sampling design to the variance that would have been obtained from a simple random sample of the same total size.\n$$\n\\text{DEFF} = \\frac{\\operatorname{Var}(\\hat{\\Delta})}{\\operatorname{Var}_{\\text{indep}}(\\hat{\\Delta})}\n$$\nSubstituting the expressions we derived:\n$$\n\\text{DEFF} = \\frac{\\frac{2\\sigma^2(1 + (n-1)\\rho)}{nK}}{\\frac{2\\sigma^2}{nK}}\n$$\nCanceling the common term $\\frac{2\\sigma^2}{nK}$ from the numerator and denominator yields the design effect:\n$$\n\\text{DEFF} = 1 + (n-1)\\rho\n$$\nThis is the required closed-form expression for the multiplicative variance inflation factor as a function of the cluster size $n$ and the intracluster correlation coefficient $\\rho$.",
            "answer": "$$\\boxed{1 + (n-1)\\rho}$$"
        }
    ]
}