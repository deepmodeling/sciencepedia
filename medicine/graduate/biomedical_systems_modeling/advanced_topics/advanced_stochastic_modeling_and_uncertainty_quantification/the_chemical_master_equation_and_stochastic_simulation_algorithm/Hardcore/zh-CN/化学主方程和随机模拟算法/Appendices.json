{
    "hands_on_practices": [
        {
            "introduction": "掌握如何将化学反应转化为其随机模型的基本构件——反应倾向性（propensity）和化学计量更新向量（stoichiometric update vector）——是进行一切随机模拟的基础技能。本练习将通过考虑分子相遇的基本组合学原理，帮助你从第一性原理出发，建立对这一过程的深刻理解 。通过推导一个基本双分子反应的倾向性函数，你将学会如何将宏观的质量作用定律与微观的、离散的随机事件联系起来。",
            "id": "5278829",
            "problem": "在 T 细胞和抗原呈递细胞之间的免疫突触中，考虑一个充分混合微域内的单一反应通道：T 细胞受体与肽-主要组织相容性复合体配体结合，该过程被建模为受体-配体复合物的可逆形成。我们关注正向结合反应 $R + L \\to RL$。设时间 $t$ 时的离散分子数量为：未结合受体 $R$ 的数量 $x_R(t)$，游离配体 $L$ 的数量 $x_L(t)$，以及结合复合物 $RL$ 的数量 $x_{RL}(t)$。假设微域体积恒定，结合事件是无记忆性的，这与化学主方程（CME）框架一致（首次使用时定义：化学主方程（CME）描述了在充分混合的反应系统中，离散分子数量的概率分布随时间的演化）。在 Gillespie 的随机模拟背景下，每个反应通道都是一个无记忆性跳跃，其在无穷小时间间隔内的发生由其倾向函数决定。\n\n从以下定义出发：在 CME 中，当系统处于状态 $x = (x_R, x_L, x_{RL})$ 时，一个给定的反应通道在无穷小时间间隔 $\\mathrm{d}t$ 内发生的概率为 $a(x)\\,\\mathrm{d}t + o(\\mathrm{d}t)$。仅使用离散状态、充分混合反应动力学的第一性原理，以及在分子尺度上基于质量作用定律对反应对进行计数的方法，推导：\n\n1. 正向结合反应 $R + L \\to RL$ 的倾向函数 $a(x)$，用有效随机速率常数 $c$ 以及数量 $x_R$ 和 $x_L$ 表示。\n2. 该反应的化学计量更新向量 $\\nu$，基于有序物种基 $(R, L, RL)$。\n\n请将最终答案表示为单个行矩阵 $\\left(a(x), \\nu_R, \\nu_L, \\nu_{RL}\\right)$，不带单位。无需进行数值取整。",
            "solution": "本问题要求为正向结合反应 $R + L \\to RL$ 推导两个量：倾向函数 $a(x)$ 和化学计量更新向量 $\\nu$。推导必须基于随机反应动力学的第一性原理。\n\n系统在任意时间 $t$ 的状态由离散分子数量的向量给出：$x(t) = (x_R(t), x_L(t), x_{RL}(t))$，其中 $x_R$、$x_L$ 和 $x_{RL}$ 分别是物种 $R$、$L$ 和 $RL$ 的分子数量。为简化起见，我们将状态表示为 $x$。物种按 $(R, L, RL)$ 的顺序排列。\n\n首先，我们推导倾向函数 $a(x)$。问题将化学主方程（CME）定义为描述在充分混合的反应系统中，离散分子数量的概率分布随时间演化的控制方程。它进一步提供了基本定义，即一个特定的反应通道在无穷小时间间隔 $[t, t+dt)$ 内发生的概率为 $a(x)\\,dt + o(dt)$，其中 $a(x)$ 是倾向函数。\n\n该反应是双分子结合反应：$R + L \\to RL$。\n推导从该反应在充分混合系统中分子层面的物理和概率解释出发。“充分混合”的假设意味着分子在整个体积内均匀分布，每个分子与任何其他分子发生反应的可能性均等。“无记忆性”的假设意味着在下一个无穷小时间间隔内发生反应的概率仅取决于系统的当前状态，而与其历史无关。\n\n设 $c$ 为有效随机速率常数。该常数概括了单个特定的 $R$ 和 $L$ 分子对在单位时间间隔内发生反应的概率。因此，一对特定的反应物（例如第 $i$ 个 $R$ 分子和第 $j$ 个 $L$ 分子）在无穷小时间间隔 $dt$ 内发生反应的概率是 $c \\, dt$。\n\n任务是找出*任意*一对 $R$ 和 $L$ 分子在 $dt$ 内发生反应的总概率。由于系统处于状态 $x$，存在 $x_R$ 个 $R$ 物种的分子和 $x_L$ 个 $L$ 物种的分子。该反应涉及两个不同的物种。可以形成的不同 $(R, L)$ 对的数量是每种物种分子数量的乘积。\n不同反应对的数量 = $x_R \\times x_L$。\n\n由于这些对中每一对在时间间隔 $dt$ 内发生反应的独立概率均为 $c \\, dt$，并且这些事件是相互排斥的（如果一对发生反应，状态就会改变，从而改变了另一对在同一无穷小瞬间发生反应的条件），因此发生一次反应事件的总概率是每一对不同反应对概率的总和。\n概率（在 $dt$ 内发生一次反应） = $\\sum_{i=1}^{x_R} \\sum_{j=1}^{x_L} (\\text{对 } (R_i, L_j) \\text{ 发生反应的概率})$\n概率（在 $dt$ 内发生一次反应） = $(x_R x_L) \\times (c \\, dt)$\n\n通过将此表达式与问题中提供的定义 $a(x)\\,dt$进行比较，我们可以确定倾向函数 $a(x)$：\n$a(x) \\, dt = c \\, x_R \\, x_L \\, dt$\n因此，正向结合反应的倾向函数为：\n$a(x) = c \\, x_R \\, x_L$\n\n接下来，我们推导化学计量更新向量 $\\nu$。向量 $\\nu$ 描述了由于单次反应事件导致的所有物种分子数量的变化。状态向量按 $x = (x_R, x_L, x_{RL})$ 的顺序排列。\n反应为 $R + L \\to RL$。\n每次该反应发生时：\n- 一个 $R$ 分子被消耗。$x_R$ 的变化为 $\\Delta x_R = -1$。\n- 一个 $L$ 分子被消耗。$x_L$ 的变化为 $\\Delta x_L = -1$。\n- 一个 $RL$ 分子被生成。$x_{RL}$ 的变化为 $\\Delta x_{RL} = +1$。\n\n化学计量更新向量 $\\nu$ 是这些变化的向量，对应于有序物种基 $(R, L, RL)$。\n$\\nu = (\\Delta x_R, \\Delta x_L, \\Delta x_{RL})$\n代入数值，我们得到：\n$\\nu = (-1, -1, 1)$\n\n该向量的分量为 $\\nu_R = -1$，$\\nu_L = -1$ 和 $\\nu_{RL} = 1$。\n\n问题要求将最终答案表示为单个行矩阵 $(a(x), \\nu_R, \\nu_L, \\nu_{RL})$。结合我们推导出的结果：\n$a(x) = c \\, x_R \\, x_L$\n$\\nu_R = -1$\n$\\nu_L = -1$\n$\\nu_{RL} = 1$\n\n最终的组合结果是 $(c \\, x_R \\, x_L, -1, -1, 1)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nc x_R x_L  -1  -1  1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "虽然反应倾向性直接驱动着基于事件的模拟算法，但它们也共同定义了控制化学主方程（CME）演化的数学算子。本练习将要求你为一个简单的生灭过程构建系统的生成元矩阵（generator matrix），从而揭示其背后作为连续时间马尔可夫链的数学结构 。这一实践有助于将模拟算法的具体步骤与描述系统概率分布演化的更形式化的数学框架联系起来。",
            "id": "3936057",
            "problem": "考虑一个充分混合的单细胞系统，其中一种分子发生零级合成和一级降解。令拷贝数表示为 $n \\in \\{0,1,\\dots,N\\}$，其中 $N$ 是一个固定的正整数，代表状态空间受资源限制的上限。零级合成（生成）反应使计数增加一，其倾向（propensity）为 $a_{\\text{birth}}(n)=k_{b}$（对于 $n  N$）和 $a_{\\text{birth}}(N)=0$；降解（死亡）反应为 $n \\to n-1$，其倾向为 $a_{\\text{death}}(n)=k_{d}\\,n$（对于 $n  0$）和 $a_{\\text{death}}(0)=0$。设速率常数 $k_b  0$ 和 $k_d  0$。请推导生成元矩阵 $Q=\\{q_{n,m}\\}_{n,m=0}^{N}$，并计算并报告所有行和 $S_{n} = \\sum_{m=0}^{N} q_{n,m}$ 的精确符号值。",
            "solution": "该问题要求推导一个描述具有有限状态空间的生灭过程的连续时间马尔可夫链的生成元矩阵 $Q$，并随后通过计算其行和来验证该矩阵的保守性。\n\n首先，根据所需标准对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n- 系统是一个充分混合的单细胞系统。\n- 状态是分子种类的拷贝数，用 $n$ 表示。\n- 状态空间是有限的：$n \\in \\{0, 1, \\dots, N\\}$，其中 $N$ 是一个固定的正整数。\n- 合成（生成）反应为 $n \\to n+1$。\n- 生成倾向为 $a_{\\text{birth}}(n) = k_{b}$（对于 $n  N$）和 $a_{\\text{birth}}(N) = 0$。\n- 降解（死亡）反应为 $n \\to n-1$。\n- 死亡倾向为 $a_{\\text{death}}(n) = k_{d}\\,n$（对于 $n  0$）和 $a_{\\text{death}}(0) = 0$。\n- 速率常数为 $k_{b}  0$ 和 $k_{d}  0$。\n- 任务1：推导生成元矩阵 $Q = \\{q_{n,m}\\}_{n,m=0}^{N}$。\n- 任务2：定义并计算所有 $n \\in \\{0, 1, \\dots, N\\}$ 的行和 $S_{n} = \\sum_{m=0}^{N} q_{n,m}$。\n- 任务3：报告 $S_{n}$ 的精确符号值。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：** 该模型是一个经典的生灭过程，是随机化学动力学和种群动力学中的一个基本模型。零级合成和一级降解的倾向是标准的表示方法。有限状态空间的上限 $N$ 反映了现实中的物理或生物约束，例如资源限制。该模型在科学上是合理且成熟的。\n- **适定性：** 该问题在数学上是适定的。状态空间、反应和倾向（包括在 $n=0$ 和 $n=N$ 处的边界条件）都得到了完整且一致的规定。基于这些定义推导生成元矩阵并检查其性质的任务具有唯一且有意义的解。\n- **客观性：** 问题以精确、无歧义的数学语言陈述。没有主观因素。\n\n**步骤3：结论与行动**\n该问题被认为是有效的，将制定一个完整的解决方案。\n\n**生成元矩阵 $Q$ 的推导**\n连续时间马尔可夫链的生成元矩阵 $Q = \\{q_{n,m}\\}$ 描述了状态之间的转移速率。在随机模拟算法（SSA）的背景下，反应 $\\mu$ 的倾向函数 $a_{\\mu}(n)$ 是风险率，它直接转化为从状态 $n$ 到由反应 $\\mu$ 产生的状态的转移速率。因此，元素 $q_{n,m}$ 是从状态 $n$ 到状态 $m$ 的转移速率。\n\n对于非对角元素 ($n \\neq m$)，速率由反应倾向决定：\n- 生成反应 $n \\to n+1$ 对应于从状态 $n$ 到状态 $m=n+1$ 的转移。其速率为 $q_{n, n+1} = a_{\\text{birth}}(n)$。\n- 死亡反应 $n \\to n-1$ 对应于从状态 $n$ 到状态 $m=n-1$ 的转移。其速率为 $q_{n, n-1} = a_{\\text{death}}(n)$。\n- 所有其他转移都是不可能的，因此如果 $m \\neq n-1$ 且 $m \\neq n+1$，则 $q_{n,m}=0$。\n\n对角元素 $q_{n,n}$ 定义为从状态 $n$ 出发的所有转移速率之和的负数。这个和是离开状态 $n$ 的总倾向，即 $a_0(n) = a_{\\text{birth}}(n) + a_{\\text{death}}(n)$。因此，\n$$ q_{n,n} = - \\sum_{m \\neq n} q_{n,m} = -(a_{\\text{birth}}(n) + a_{\\text{death}}(n)) $$\n\n我们现在可以通过考虑行索引 $n$ 的三种不同情况来指定 $Q$ 的所有元素：\n\n1.  **边界状态 $n=0$：**\n    - 非对角元素：唯一可能的转移是生成，$0 \\to 1$。因此，$q_{0,1} = a_{\\text{birth}}(0) = k_{b}$。对于 $m \\neq 1$，所有其他非对角元素 $q_{0,m}$ 均为 $0$。\n    - 对角元素：$q_{0,0} = -(a_{\\text{birth}}(0) + a_{\\text{death}}(0)) = -(k_{b} + 0) = -k_{b}$。\n\n2.  **内部状态 $n \\in \\{1, 2, \\dots, N-1\\}$：**\n    - 非对角元素：生成和死亡都是可能的。$q_{n,n+1} = a_{\\text{birth}}(n) = k_{b}$ 且 $q_{n,n-1} = a_{\\text{death}}(n) = k_{d}\\,n$。所有其他非对角元素均为 $0$。\n    - 对角元素：$q_{n,n} = -(a_{\\text{birth}}(n) + a_{\\text{death}}(n)) = -(k_{b} + k_{d}\\,n)$。\n\n3.  **边界状态 $n=N$：**\n    - 非对角元素：唯一可能的转移是死亡，$N \\to N-1$，因为生成已达到上限。因此，$q_{N,N-1} = a_{\\text{death}}(N) = k_{d}\\,N$。对于 $m \\neq N-1$，所有其他非对角元素 $q_{N,m}$ 均为 $0$。\n    - 对角元素：$q_{N,N} = -(a_{\\text{birth}}(N) + a_{\\text{death}}(N)) = -(0 + k_{d}\\,N) = -k_{d}\\,N$。\n\n生成元 $Q$ 是一个由这些元素构成的 $(N+1) \\times (N+1)$ 的三对角矩阵。\n\n**保守性验证：行和 $S_n$ 的计算**\n问题要求通过计算任意状态 $n \\in \\{0, 1, \\dots, N\\}$ 的行和 $S_{n} = \\sum_{m=0}^{N} q_{n,m}$ 来验证生成元是保守的。如果对所有 $n$ 都有 $S_n=0$，则生成元是保守的，这确保了总概率随时间守恒。我们对 $n$ 分析同样的三种情况。\n\n1.  **对于边界状态 $n=0$：**\n    在第 $0$ 行中，唯一的非零元素是 $q_{0,0}$ 和 $q_{0,1}$。行和为：\n    $$ S_{0} = \\sum_{m=0}^{N} q_{0,m} = q_{0,0} + q_{0,1} + \\sum_{m=2}^{N} q_{0,m} $$\n    代入推导出的值：\n    $$ S_{0} = (-k_{b}) + (k_{b}) + 0 = 0 $$\n\n2.  **对于内部状态 $n \\in \\{1, 2, \\dots, N-1\\}$：**\n    在第 $n$ 行中，唯一的非零元素是 $q_{n,n-1}$、$q_{n,n}$ 和 $q_{n,n+1}$。行和为：\n    $$ S_{n} = \\sum_{m=0}^{N} q_{n,m} = q_{n,n-1} + q_{n,n} + q_{n,n+1} $$\n    代入推导出的值：\n    $$ S_{n} = (k_{d}\\,n) + (-(k_{b} + k_{d}\\,n)) + (k_{b}) $$\n    $$ S_{n} = k_{d}\\,n - k_{b} - k_{d}\\,n + k_{b} = 0 $$\n\n3.  **对于边界状态 $n=N$：**\n    在第 $N$ 行中，唯一的非零元素是 $q_{N,N-1}$ 和 $q_{N,N}$。行和为：\n    $$ S_{N} = \\sum_{m=0}^{N} q_{N,m} = q_{N,N-1} + q_{N,N} + \\sum_{m=0}^{N-2} q_{N,m} $$\n    代入推导出的值：\n    $$ S_{N} = (k_{d}\\,N) + (-k_{d}\\,N) + 0 = 0 $$\n\n在涵盖整个状态空间 $n \\in \\{0, 1, \\dots, N\\}$ 的所有三种情况下，第 $n$ 行的元素之和恒为零。这一结果严格证明了所推导的生成元矩阵是保守的。因此，对于任何有效的 $n$，$S_{n}$ 的符号值为 $0$。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "在实际应用中，精确的随机模拟（如Gillespie算法）可能计算成本高昂，因此近似方法至关重要。这项高级练习将探讨一种常见的近似方法——tau-leaping，并要求你通过解析推导和编程计算来量化其引入的误差 。这种分析近似方法的精度与效率之间权衡的能力，是实用建模中的一项关键技能。",
            "id": "3936055",
            "problem": "考虑一个模拟充分混合体积中迁入-死亡过程的单物种线性反应网络，该网络由两个反应定义：$R_1: \\varnothing \\to X$，速率常数为 $k_0$，化学计量变化为 $+1$；以及 $R_2: X \\to \\varnothing$，一级速率为 $k_1 X$，化学计量变化为 $-1$。分子数概率分布的时间演化由化学主方程 (CME) 控制。随机模拟算法 (SSA) 可以生成 CME 的精确样本路径。tau-跳跃方法通过以固定的步长 $ \\tau $ 向前跳跃来近似该过程，并假设在每次跳跃期间反应倾向保持不变，反应发生次数被建模为独立的泊松随机变量。\n\n你的任务是，从第一性原理出发，并且不使用任何现成的 tau-跳跃误差公式，推导出一个在固定步长 $\\tau$ 的 tau-跳跃方法下，时间 $T$ 时方差的闭式表达式，并量化其相对于 CME 下（即 SSA 下）精确方差的误差。仅使用核心定义和定律，即：\n- 线性反应网络的 CME 矩动力学。\n- 全期望定律和全方差定律。\n- tau-跳跃步骤的定义，即用独立的泊松随机变量替换大小为 $\\tau$ 的步长内的反应发生次数，这些泊松随机变量的均值等于在步长开始时评估的倾向函数乘以 $\\tau$。\n\n按以下步骤进行：\n- 从该网络的 CME 出发，推导在 SSA 下，对于一般初始均值 $m(0) = m_0$ 和初始方差 $V(0) = V_0$，时间 $t$ 时的闭式均值 $m(t)$ 和方差 $V(t)$。\n- 对于固定步长 $\\tau$ 的 tau-跳跃方法，写出状态 $X_{n+1}$ 在从 $t_n$ 到 $t_{n+1} = t_n + \\tau$ 的一个步长内的单步条件更新，然后使用全期望定律和全方差定律推导出均值 $m_{n+1}$ 和方差 $V_{n+1}$ 关于 $m_n$ 和 $V_n$ 的递推关系。\n- 求解这些递推关系，以获得在 $T = N \\tau$ 时的 tau-跳跃方差的闭式解。\n\n然后，你必须实现一个程序，对于给定的参数集 $(k_0, k_1, m_0, V_0, T, \\tau)$（其中 $T$ 是 $\\tau$ 的整数倍），计算绝对误差\n$$\nE(\\tau) = \\left|V_{\\text{tau}}(T,\\tau) - V_{\\text{exact}}(T)\\right|.\n$$\n本问题中的所有量都是无量纲的，不需要物理单位。所有计算必须在实数算术下进行。\n\n测试套件：\n你的程序必须为以下每个参数集计算 $E(\\tau)$。在每种情况下，$T$ 都是 $\\tau$ 的精确整数倍；如果 $N = T/\\tau$，则 $N$ 是一个整数。\n\n- 情况 1：$k_0 = 40$, $k_1 = 2$, $m_0 = 0$, $V_0 = 0$, $T = 1.0$, $\\tau = 0.05$。\n- 情况 2：$k_0 = 40$, $k_1 = 2$, $m_0 = 0$, $V_0 = 0$, $T = 0.8$, $\\tau = 0.4$。\n- 情况 3：$k_0 = 20$, $k_1 = 1.0$, $m_0 = 50$, $V_0 = 0$, $T = 2.0$, $\\tau = 0.2$。\n- 情况 4：$k_0 = 50$, $k_1 = 1.0$, $m_0 = 50$, $V_0 = 0$, $T = 2.0$, $\\tau = 0.25$。\n- 情况 5：$k_0 = 5.0$, $k_1 = 0.2$, $m_0 = 10$, $V_0 = 0$, $T = 5.0$, $\\tau = 0.5$。\n\n你的程序应生成单行输出，包含一个用方括号括起来的浮点数逗号分隔列表的结果。第 $i$ 个数字必须是情况 $i$ 的 $E(\\tau)$ 值，顺序与上面相同，并使用浮点数的默认字符串格式。例如，一个有效的输出格式如 $[a_1,a_2,a_3,a_4,a_5]$，其中每个 $a_i$ 是一个浮点数。",
            "solution": "该问题在科学和数学上是合理的、适定的，并且包含了获得唯一解所需的所有信息。推导过程按要求从第一性原理出发。\n\n该反应网络是一个迁入-死亡过程，定义如下：\n$R_1: \\varnothing \\xrightarrow{k_0} X$，倾向函数为 $a_1(x) = k_0$，化学计量变化为 $\\nu_1 = +1$。\n$R_2: X \\xrightarrow{k_1} \\varnothing$，倾向函数为 $a_2(x) = k_1 x$，化学计量变化为 $\\nu_2 = -1$。\n这里，$x$ 是物种 $X$ 的分子数。\n\n**第一部分：从化学主方程 (CME) 推导精确方差**\n\n分子数 $X(t)$ 各阶矩的时间演化可以从 CME 推导出来。\n令 $m(t) = \\mathbb{E}[X(t)]$ 为均值，$V(t) = \\text{Var}(X(t))$ 为方差。\n函数 $f(X(t))$ 期望值时间演化的一般主方程为\n$$ \\frac{d\\mathbb{E}[f(X(t))]}{dt} = \\sum_{j=1}^{2} \\mathbb{E}[(f(X(t) + \\nu_j) - f(X(t))) a_j(X(t))] $$\n\n对于均值，我们设 $f(x) = x$。\n$$ \\frac{dm(t)}{dt} = \\mathbb{E}[(X+1-X)a_1(X)] + \\mathbb{E}[(X-1-X)a_2(X)] = \\mathbb{E}[\\nu_1 a_1(X)] + \\mathbb{E}[\\nu_2 a_2(X)] $$\n$$ \\frac{dm(t)}{dt} = (+1)\\mathbb{E}[k_0] + (-1)\\mathbb{E}[k_1 X(t)] = k_0 - k_1 m(t) $$\n这是一个一阶线性常微分方程 (ODE)。在初始条件 $m(0) = m_0$ 下，解为：\n$$ m(t) = \\frac{k_0}{k_1} + \\left(m_0 - \\frac{k_0}{k_1}\\right)e^{-k_1 t} $$\n\n对于方差 $V(t) = \\mathbb{E}[X(t)^2] - m(t)^2$，我们推导其 ODE。对于线性反应网络，方差动力学由下式给出：\n$$ \\frac{dV(t)}{dt} = \\sum_{j=1}^{2} \\nu_j^2 \\mathbb{E}[a_j(X(t))] + 2 \\cdot \\text{Cov}\\left(X(t), \\sum_{j=1}^{2} \\nu_j a_j(X(t))\\right) $$\n第一项是噪声贡献的总和：\n$$ \\sum_{j=1}^{2} \\nu_j^2 \\mathbb{E}[a_j(X(t))] = (+1)^2 \\mathbb{E}[k_0] + (-1)^2 \\mathbb{E}[k_1 X(t)] = k_0 + k_1 m(t) $$\n第二项包含协方差。随机速率的总和是 $\\sum_j \\nu_j a_j(X) = k_0 - k_1 X$。\n$$ 2 \\cdot \\text{Cov}(X, k_0 - k_1 X) = 2 \\cdot \\text{Cov}(X, -k_1 X) = -2k_1 \\cdot \\text{Cov}(X, X) = -2k_1 \\text{Var}(X) = -2k_1 V(t) $$\n将这些项组合起来，得到方差的 ODE：\n$$ \\frac{dV(t)}{dt} = k_0 + k_1 m(t) - 2k_1 V(t) $$\n代入 $m(t)$ 的解：\n$$ \\frac{dV(t)}{dt} + 2k_1 V(t) = k_0 + k_1 \\left[ \\frac{k_0}{k_1} + \\left(m_0 - \\frac{k_0}{k_1}\\right)e^{-k_1 t} \\right] = 2k_0 + (k_1 m_0 - k_0)e^{-k_1 t} $$\n这是一个关于 $V(t)$ 的一阶线性 ODE。使用积分因子 $e^{2k_1 t}$，我们在初始条件 $V(0)=V_0$ 下求解它：\n$$ \\frac{d}{dt}(V(t)e^{2k_1 t}) = 2k_0 e^{2k_1 t} + (k_1 m_0 - k_0)e^{k_1 t} $$\n从 $0$ 到 $t$ 积分：\n$$ V(t)e^{2k_1 t} - V_0 = \\frac{k_0}{k_1}(e^{2k_1 t}-1) + (m_0 - \\frac{k_0}{k_1})(e^{k_1 t}-1) $$\n解出 $V(t)$：\n$$ V(t) = V_0 e^{-2k_1 t} + \\frac{k_0}{k_1}(1-e^{-2k_1 t}) + (m_0 - \\frac{k_0}{k_1})(e^{-k_1 t}-e^{-2k_1 t}) $$\n重新整理各项：\n$$ V(t) = \\frac{k_0}{k_1} + \\left(m_0 - \\frac{k_0}{k_1}\\right)e^{-k_1 t} + (V_0 - m_0)e^{-2k_1 t} $$\n前两项与 $m(t)$ 相同。因此，时间 $t$ 时的精确方差，记为 $V_{\\text{exact}}(t)$，是：\n$$ V_{\\text{exact}}(t) = m(t) + (V_0 - m_0)e^{-2k_1 t} $$\n在时间 $T$ 时，我们有：\n$$ V_{\\text{exact}}(T) = \\left(\\frac{k_0}{k_1} + \\left(m_0 - \\frac{k_0}{k_1}\\right)e^{-k_1 T}\\right) + (V_0 - m_0)e^{-2k_1 T} $$\n\n**第二部分：tau-跳跃方差**\n\ntau-跳跃方法通过以下方式将时间 $t_n = n\\tau$ 的状态 $X_n$ 更新到时间 $t_{n+1} = t_n + \\tau$ 的状态 $X_{n+1}$：\n$$ X_{n+1} = X_n + K_1 - K_2 $$\n其中 $K_1$ 和 $K_2$ 是在 $[t_n, t_{n+1})$ 区间内反应发生的次数。在以 $X_n$ 为条件时，它们是独立的泊松随机变量：\n$$ K_1 | X_n \\sim \\text{Pois}(a_1(X_n)\\tau) = \\text{Pois}(k_0\\tau) $$\n$$ K_2 | X_n \\sim \\text{Pois}(a_2(X_n)\\tau) = \\text{Pois}(k_1 X_n \\tau) $$\n令 $m_n = \\mathbb{E}[X_n]$ 和 $V_n = \\text{Var}(X_n)$。我们使用全期望定律和全方差定律。\n\n更新的条件均值为：\n$$ \\mathbb{E}[X_{n+1} | X_n] = X_n + \\mathbb{E}[K_1|X_n] - \\mathbb{E}[K_2|X_n] = X_n + k_0\\tau - k_1 X_n \\tau = (1-k_1\\tau)X_n + k_0\\tau $$\n根据全期望定律，$\\mathbb{E}[X_{n+1}] = \\mathbb{E}[\\mathbb{E}[X_{n+1}|X_n]]$：\n$$ m_{n+1} = \\mathbb{E}[(1-k_1\\tau)X_n + k_0\\tau] = (1-k_1\\tau)m_n + k_0\\tau $$\n这是均值的线性递推关系。\n\n更新的条件方差为（使用 $K_1, K_2$ 的条件独立性）：\n$$ \\text{Var}(X_{n+1} | X_n) = \\text{Var}(K_1|X_n) + \\text{Var}(K_2|X_n) = k_0\\tau + k_1 X_n \\tau = (k_0 + k_1 X_n)\\tau $$\n根据全方差定律，$\\text{Var}(X_{n+1}) = \\mathbb{E}[\\text{Var}(X_{n+1}|X_n)] + \\text{Var}(\\mathbb{E}[X_{n+1}|X_n])$：\n$$ V_{n+1} = \\mathbb{E}[(k_0 + k_1 X_n)\\tau] + \\text{Var}((1-k_1\\tau)X_n + k_0\\tau) $$\n$$ V_{n+1} = (k_0 + k_1 m_n)\\tau + (1-k_1\\tau)^2 V_n $$\n这是方差的线性递推关系。\n\n为了找到 $V_n$ 的闭式解，我们首先解出 $m_n$。对于 $m_{n+1} = (1-k_1\\tau)m_n + k_0\\tau$ 且初值为 $m_0$ 的解是：\n$$ m_n = \\frac{k_0}{k_1} + \\left(m_0 - \\frac{k_0}{k_1}\\right)(1-k_1\\tau)^n $$\n现在我们求解 $V_n$。令 $A = (1-k_1\\tau)^2$ 和 $B_n = (k_0 + k_1 m_n)\\tau$。递推关系为 $V_{n+1} = A V_n + B_n$。\n将 $m_n$ 代入 $B_n$：\n$$ B_n = \\left( k_0 + k_1\\left( \\frac{k_0}{k_1} + \\left(m_0-\\frac{k_0}{k_1}\\right)(1-k_1\\tau)^n \\right) \\right)\\tau $$\n$$ B_n = 2k_0\\tau + k_1\\tau\\left(m_0-\\frac{k_0}{k_1}\\right)(1-k_1\\tau)^n $$\n令 $r_m = 1-k_1\\tau$。递推关系为 $V_{n+1} = A V_n + 2k_0\\tau + k_1\\tau(m_0-k_0/k_1)r_m^n$。\n这是一个标准的线性非齐次递推关系。假设 $k_1\\tau \\notin \\{0, 1, 2\\}$，一个特解具有形式 $V_n^{(p)} = P + Q r_m^n$。将其代入方程并匹配系数可得：\n$$ P = \\frac{2k_0\\tau}{1-A} = \\frac{2k_0\\tau}{1-(1-k_1\\tau)^2} = \\frac{2k_0\\tau}{k_1\\tau(2-k_1\\tau)} = \\frac{2k_0}{k_1(2-k_1\\tau)} $$\n$$ Q = \\frac{k_1\\tau(m_0-k_0/k_1)}{r_m-A} = \\frac{k_1\\tau(m_0-k_0/k_1)}{(1-k_1\\tau)-(1-k_1\\tau)^2} = \\frac{k_1\\tau(m_0-k_0/k_1)}{k_1\\tau(1-k_1\\tau)} = \\frac{m_0-k_0/k_1}{1-k_1\\tau} $$\n通解为 $V_n = C A^n + V_n^{(p)} = C A^n + P + Q r_m^n$。\n常数 $C$ 由初始条件 $V_0$ 得到：\n$$ V_0 = C + P + Q \\implies C = V_0 - P - Q $$\n$V_n$ 的闭式解为：\n$$ V_n = P + Q r_m^n + (V_0 - P - Q) A^n $$\n代入 $A=r_m^2 = (1-k_1\\tau)^2$：\n$$ V_n = P + Q (1-k_1\\tau)^n + (V_0 - P - Q) (1-k_1\\tau)^{2n} $$\n时间 $T=N\\tau$ 时的 tau-跳跃方差为 $V_{\\text{tau}}(T,\\tau) = V_N$。\n\n**第三部分：绝对误差**\n在时间 $T$ 时，tau-跳跃方差与精确 CME 方差之间的绝对误差 $E(\\tau)$ 为：\n$$ E(\\tau) = |V_{\\text{tau}}(T, \\tau) - V_{\\text{exact}}(T)| $$\n其中 $V_{\\text{tau}}(T, \\tau)$ 是 $N=T/\\tau$ 时的 $V_N$，而 $V_{\\text{exact}}(T)$ 是在第一部分中推导的公式。将实施这些公式来计算所需的值。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the absolute error between the exact variance and the tau-leaping\n    variance for an immigration-death process.\n    \"\"\"\n\n    test_cases = [\n        {'k0': 40, 'k1': 2, 'm0': 0, 'v0': 0, 'T': 1.0, 'tau': 0.05},\n        {'k0': 40, 'k1': 2, 'm0': 0, 'v0': 0, 'T': 0.8, 'tau': 0.4},\n        {'k0': 20, 'k1': 1.0, 'm0': 50, 'v0': 0, 'T': 2.0, 'tau': 0.2},\n        {'k0': 50, 'k1': 1.0, 'm0': 50, 'v0': 0, 'T': 2.0, 'tau': 0.25},\n        {'k0': 5.0, 'k1': 0.2, 'm0': 10, 'v0': 0, 'T': 5.0, 'tau': 0.5},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        k0 = case['k0']\n        k1 = case['k1']\n        m0 = case['m0']\n        v0 = case['v0']\n        T = case['T']\n        tau = case['tau']\n        \n        # Ensure N is an integer, handling potential floating point inaccuracies\n        N = int(round(T / tau))\n\n        # Part 1: Exact Variance from CME\n        # Check for k1=0 to avoid division by zero\n        if k1 == 0:\n            # Pure immigration process (Poisson process)\n            m_exact_T = m0 + k0 * T\n            V_exact_T = v0 + k0 * T\n        else:\n            # Immigration-death process\n            k0_over_k1 = k0 / k1\n            m_exact_T = k0_over_k1 + (m0 - k0_over_k1) * np.exp(-k1 * T)\n            V_exact_T = m_exact_T + (v0 - m0) * np.exp(-2 * k1 * T)\n\n        # Part 2: Tau-Leaping Variance\n        V_tau_T = 0.0\n        if k1 == 0:\n            # For pure immigration, tau-leaping is exact\n            V_tau_T = v0 + N * k0 * tau\n        else:\n            k1_tau = k1 * tau\n            \n            # General Case: Handles all test cases provided\n            if abs(k1_tau - 1.0) > 1e-12 and abs(k1_tau - 2.0) > 1e-12:\n                P = (2.0 * k0) / (k1 * (2.0 - k1_tau))\n                Q = (m0 - k0 / k1) / (1.0 - k1_tau)\n                rm = 1.0 - k1_tau\n                V_tau_T = P + Q * (rm**N) + (v0 - P - Q) * (rm**(2 * N))\n            \n            # Special Case: k1*tau = 1\n            elif abs(k1_tau - 1.0)  1e-12:\n                if N == 0:\n                    V_tau_T = v0\n                elif N == 1:\n                    V_tau_T = m0 + k0 / k1\n                else:  # N >= 2\n                    V_tau_T = 2.0 * k0 / k1\n            \n            # Special Case: k1*tau = 2\n            elif abs(k1_tau - 2.0)  1e-12:\n                C1 = 2.0 * k0 * tau\n                C2 = k1_tau * (m0 - k0 / k1)\n                sum_term = 0.0\n                if N % 2 != 0:  # N is odd\n                    sum_term = 1.0\n                V_tau_T = v0 + N * C1 + C2 * sum_term\n\n        # Part 3: Absolute Error\n        error = abs(V_tau_T - V_exact_T)\n        results.append(error)\n\n    # Format the final output string\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}