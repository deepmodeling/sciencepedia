{
    "hands_on_practices": [
        {
            "introduction": "对随机事件进行建模的第一步通常是量化其发生率。泊松过程是描述在时间或空间中独立发生的事件的基础模型。本练习将指导您完成从一组观测到的事件时间中推断恒定速率 $\\lambda$ 的核心过程，使用的是统计推断的基石——最大似然估计法 (MLE) 。掌握这项技术对于分析从单分子光漂白到神经元放电等多种生物物理现象至关重要。",
            "id": "3920152",
            "problem": "一项荧光显微镜实验在固定的观察窗口 $[0,T]$ 内追踪活细胞膜上单个荧光团的光漂白事件。假设漂白事件是速率为常数 $\\lambda$（单位时间的事件数）的齐次泊松过程的实现，其合理性在于底层光化学跃迁的无记忆性以及光照条件的平稳性。您观察到精确的有序事件时间 $\\{t_{1},t_{2},\\dots,t_{n}\\}$，其中 $0  t_{1}  t_{2}  \\dots  t_{n} \\leq T$。您还知道在区间 $(t_{n},T]$ 内没有发生额外的漂白事件。\n\n任务：\n1. 写出观察到这些数据的似然函数 $L(\\lambda \\mid \\{t_{i}\\}, T)$。\n2. 推导出 $\\lambda$ 的最大似然估计量 (MLE) $\\hat{\\lambda}$。\n3. 如果速率被参数化为 $\\theta = \\ln\\lambda$，推导出 $\\hat{\\theta}$ 在大样本下的渐近方差，用 $\\lambda$ 和 $T$ 表示。\n\n在你的最终答案中，按顺序 $L(\\lambda \\mid \\{t_{i}\\}, T)$、$\\hat{\\lambda}$ 和 $\\mathrm{Var}(\\hat{\\theta})$ 以单行矩阵的形式呈现。",
            "solution": "首先根据指定标准验证问题。\n\n### 步骤 1：提取已知条件\n-   **过程模型**：速率为常数 $\\lambda$ 的齐次泊松过程。\n-   **观察窗口**：一个固定的时间区间 $[0, T]$。\n-   **观测数据**：一组 $n$ 个有序事件时间 $\\{t_{1}, t_{2}, \\dots, t_{n}\\}$，满足 $0  t_{1}  t_{2}  \\dots  t_{n} \\leq T$。\n-   **附加条件**：在区间 $(t_{n}, T]$ 内没有事件发生。\n-   **目标参数**：速率 $\\lambda$。\n-   **任务**：\n    1.  推导完整的似然函数 $L(\\lambda \\mid \\{t_{i}\\}, T)$。\n    2.  获得最大似然估计量 (MLE) $\\hat{\\lambda}$。\n    3.  定义对数速率参数 $\\theta = \\ln\\lambda$，并利用费雪信息推导其 MLE $\\hat{\\theta}$ 的渐近方差。\n-   **输出格式**：一个包含三个推导出的符号表达式的单行矩阵。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据**：该问题使用齐次泊松过程对光漂白事件进行建模。这是单分子生物物理学和荧光显微镜学中一个标准且科学有效模型，其根植于量子力学和统计物理学的原理。其假设是标准的且已明确说明。该问题是科学上合理的。\n-   **适定性**：该问题要求为一个标准统计模型推导明确定义的统计量（似然、MLE 和渐近方差）。所提供的信息足以得出一个唯一且有意义的解。\n-   **客观性**：语言正式、精确，没有任何主观或模糊的术语。\n-   **完整性与一致性**：问题是自洽的。数据、模型和条件都已完全指定且不矛盾。观察到 $\\{t_1, \\dots, t_n\\}$ 并且在 $(t_n,T]$ 内没有事件发生，等同于在区间 $[0,T]$ 内观察到恰好 $n$ 个事件，其到达时间已指定。\n-   **真实性与可行性**：所描述的实验设置是真实世界单分子实验的典型代表。数据和参数在物理上是一致的。\n-   **结构与其他标准**：该问题结构良好，并非无足轻重，并且需要统计理论的具体应用。它不是同义反复、隐喻性或不可证伪的。\n\n### 步骤 3：结论与行动\n问题有效。将推导解答。\n\n### 解答推导\n\n推导过程按要求分为三部分。\n\n**第一部分：似然函数 $L(\\lambda \\mid \\{t_{i}\\}, T)$ 的推导**\n\n似然函数是在给定参数 $\\lambda$ 的条件下，观察到特定数据的概率密度。数据包括事件时间 $t_1, t_2, \\dots, t_n$ 以及直到时间 $T$ 没有发生更多事件这一信息。我们利用齐次泊松过程的一个基本性质：事件的到达间隔时间是独立同分布(i.i.d.)的指数随机变量，其速率为 $\\lambda$。\n\n设到达间隔时间为 $\\tau_1, \\tau_2, \\dots, \\tau_n$。\n第一个到达间隔时间是 $\\tau_1 = t_1 - 0 = t_1$。\n随后的到达间隔时间是 $\\tau_i = t_i - t_{i-1}$，对于 $i = 2, \\dots, n$。\n每个 $\\tau_i$ 的概率密度函数 (PDF) 是 $f(\\tau_i; \\lambda) = \\lambda \\exp(-\\lambda \\tau_i)$。\n\n观察到这 $n$ 个到达间隔时间的联合概率密度函数是它们各自概率密度函数的乘积，因为它们是独立的：\n$$f(\\tau_1, \\dots, \\tau_n; \\lambda) = \\prod_{i=1}^{n} \\lambda \\exp(-\\lambda \\tau_i) = \\lambda^n \\exp\\left(-\\lambda \\sum_{i=1}^{n} \\tau_i\\right)$$\n到达间隔时间的总和等于最后一个事件的时间 $t_n$：\n$$\\sum_{i=1}^{n} \\tau_i = (t_1 - 0) + (t_2 - t_1) + \\dots + (t_n - t_{n-1}) = t_n$$\n因此，在时间 $t_1, \\dots, t_n$ 观察到这 $n$ 个事件的概率密度是 $\\lambda^n \\exp(-\\lambda t_n)$。\n\n除了这些事件，我们还观察到在区间 $(t_n, T]$ 内没有事件发生。该区间的持续时间是 $T - t_n$。在长度为 $\\Delta t$ 的区间内发生零个事件的概率由泊松概率 $P(k=0) = \\exp(-\\lambda \\Delta t)$ 给出。因此，在 $(t_n, T]$ 内没有事件的概率是 $\\exp(-\\lambda (T - t_n))$。\n\n观测数据的完整似然函数是事件发生的概率密度与最后静默期概率的乘积：\n$$L(\\lambda \\mid \\{t_{i}\\}, T) = \\left( \\lambda^n \\exp(-\\lambda t_n) \\right) \\times \\left( \\exp(-\\lambda (T-t_n)) \\right)$$\n$$L(\\lambda \\mid \\{t_{i}\\}, T) = \\lambda^n \\exp(-\\lambda t_n - \\lambda T + \\lambda t_n)$$\n$$L(\\lambda \\mid \\{t_{i}\\}, T) = \\lambda^n \\exp(-\\lambda T)$$\n值得注意的是，似然函数仅取决于事件数量 $n$ 和总观察时间 $T$。具体的事件时间 $\\{t_i\\}$ 没有出现在最终的似然表达式中，这意味着 $n$ 是 $\\lambda$ 的一个充分统计量。\n\n**第二部分：最大似然估计量 (MLE) $\\hat{\\lambda}$**\n\n为了找到 $\\lambda$ 的 MLE，我们最大化似然函数 $L(\\lambda)$。在计算上，最大化对数似然函数 $\\ell(\\lambda) = \\ln L(\\lambda)$ 更为简单。\n$$\\ell(\\lambda) = \\ln(\\lambda^n \\exp(-\\lambda T)) = n \\ln(\\lambda) - \\lambda T$$\n我们通过求 $\\ell(\\lambda)$ 对 $\\lambda$ 的一阶导数并将其设为零来找到最大值。\n$$\\frac{d\\ell}{d\\lambda} = \\frac{n}{\\lambda} - T$$\n将导数设为零以找到临界点 $\\hat{\\lambda}$：\n$$\\frac{n}{\\hat{\\lambda}} - T = 0 \\implies \\frac{n}{\\hat{\\lambda}} = T \\implies \\hat{\\lambda} = \\frac{n}{T}$$\n为了确认这是一个最大值，我们检查二阶导数：\n$$\\frac{d^2\\ell}{d\\lambda^2} = -\\frac{n}{\\lambda^2}$$\n由于 $n  0$（因为观察到了事件）且 $\\lambda^2  0$，二阶导数总是负的。这证实了 $\\hat{\\lambda} = n/T$ 是唯一的最大似然估计量。\n\n**第三部分：当 $\\theta = \\ln\\lambda$ 时 $\\hat{\\theta}$ 的渐近方差**\n\nMLE 的渐近方差由费雪信息的倒数给出。首先，我们找到费雪信息 $I(\\theta)$。通常最简单的方法是用新参数 $\\theta = \\ln\\lambda$ 来重新表示对数似然，这意味着 $\\lambda = \\exp(\\theta)$。\n\n在固定区间 $[0, T]$ 内的事件数 $n$ 是一个随机变量 $N \\sim \\text{Poisson}(\\lambda T)$ 的实现。\n对数似然函数，作为随机变量 $N$ 和参数 $\\theta$ 的函数，是：\n$$\\ell(\\theta; N) = N \\ln(\\lambda) - \\lambda T = N \\ln(\\exp(\\theta)) - \\exp(\\theta) T = N\\theta - T\\exp(\\theta)$$\n费雪信息 $I(\\theta)$ 定义为对数似然函数关于参数的二阶导数的负期望值：\n$$I(\\theta) = -E\\left[\\frac{d^2\\ell}{d\\theta^2}\\right]$$\n首先，我们计算导数：\n$$\\frac{d\\ell}{d\\theta} = N - T\\exp(\\theta)$$\n$$\\frac{d^2\\ell}{d\\theta^2} = -T\\exp(\\theta)$$\n二阶导数不依赖于随机变量 $N$。因此，求期望是简单的：\n$$E\\left[\\frac{d^2\\ell}{d\\theta^2}\\right] = E[-T\\exp(\\theta)] = -T\\exp(\\theta)$$\n现在，我们可以计算费雪信息：\n$$I(\\theta) = -(-T\\exp(\\theta)) = T\\exp(\\theta)$$\n代回 $\\lambda = \\exp(\\theta)$，我们得到：\n$$I(\\theta) = T\\lambda$$\nMLE $\\hat{\\theta}$ 的渐近方差是费雪信息的倒数：\n$$\\text{Var}(\\hat{\\theta}) \\approx \\frac{1}{I(\\theta)} = \\frac{1}{T\\lambda}$$\n这是理论上的渐近方差，用真实模型参数 $T$ 和 $\\lambda$ 表示。\n\n所要求的三个表达式是：\n1. 似然函数 $L(\\lambda\\mid\\{t_{i}\\},T) = \\lambda^n \\exp(-\\lambda T)$\n2. MLE $\\hat{\\lambda} = \\frac{n}{T}$\n3. $\\hat{\\theta}$ 的渐近方差：$\\frac{1}{\\lambda T}$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\lambda^{n} \\exp(-\\lambda T)  \\frac{n}{T}  \\frac{1}{\\lambda T} \\end{pmatrix} } $$"
        },
        {
            "introduction": "许多生物系统，例如细胞群或病原体种群，其事件（出生或死亡）发生的速率取决于当前种群的大小。本练习将简单泊松过程的参数推断思想扩展到更复杂的线性生灭过程 。您将学习如何根据完全观测到的种群动态轨迹构建似然函数，从而同时估计人均出生率 $\\lambda$ 和死亡率 $\\mu$。这项技能对于量化实验数据中生命系统的增长和衰退动力学至关重要。",
            "id": "3920158",
            "problem": "一个单克隆哺乳动物细胞群在灌流生物反应器中维持，其条件允许在观测窗口期内忽略细胞间的相互作用。该种群的大小被建模为一个线性生死过程，这是一个连续时间马尔可夫链（CTMC），其状态空间为 $\\{0,1,2,\\dots\\}$，生成元由 $q_{n,n+1} = \\lambda n$，$q_{n,n-1} = \\mu n$ 和 $q_{n,n} = -(\\lambda+\\mu)n$ 对 $n \\in \\mathbb{N}$ 指定。其中，$\\lambda  0$ 是单位细胞的有丝分裂出生率，$\\mu  0$ 是单位细胞的死亡率。初始种群大小 $n(0) = n_{0}$ 是已知且严格为正的。\n\n在一个固定的观测区间 $[0,T]$ 内，轨迹被完全观测：每个跳变的时间及其类型（出生或死亡）都被记录下来，并且在每个状态下的分段恒定停留时间是已知的。令 $B$ 表示记录到的总出生事件数，$D$ 表示记录到的总死亡事件数，并定义累积暴露量\n$$\nS \\equiv \\int_{0}^{T} n(t)\\, dt,\n$$\n这是在 $[0,T]$ 上累积的总种群大小-时间。假设没有迁入和数据删失。\n\n仅从CTMC的定义、指数等待时间的无记忆性以及跳变过程路径密度的乘积形式出发，推导完全观测轨迹的似然函数 $L(\\lambda,\\mu \\mid \\text{trajectory})$，作为 $\\lambda$ 和 $\\mu$ 的函数；然后，计算最大似然估计量（MLEs）$\\hat{\\lambda}$ 和 $\\hat{\\mu}$。最后，在累积暴露量 $S \\to \\infty$ 的情况下（等价于在保证 $S \\to \\infty$ 的条件下 $T \\to \\infty$），引用CTMC中MLEs的适当正则性条件，确定 $\\hat{\\lambda}$ 和 $\\hat{\\mu}$ 的主阶渐近方差。\n\n在你的最终答案中，按顺序 $\\hat{\\lambda}$、$\\hat{\\mu}$、$\\mathrm{Var}(\\hat{\\lambda})$（主阶）、$\\mathrm{Var}(\\hat{\\mu})$（主阶）以单行矩阵的形式呈现。无需四舍五入；提供精确的解析表达式。在最终的方框表达式中不要包含单位。",
            "solution": "首先验证问题，以确保其具有科学依据、良定性及客观性。\n\n### 步骤1：提取已知条件\n- **模型**：线性生死过程，一种连续时间马尔可夫链（CTMC）。\n- **状态空间**：$\\{0, 1, 2, \\dots\\}$。\n- **生成元矩阵元素**：$q_{n,n+1} = \\lambda n$，$q_{n,n-1} = \\mu n$ 以及 $q_{n,n} = -(\\lambda+\\mu)n$ 对于 $n \\in \\mathbb{N}$。\n- **参数**：单位细胞出生率 $\\lambda  0$，单位细胞死亡率 $\\mu  0$。\n- **初始条件**：时间 $t=0$ 时的种群大小为 $n(0) = n_0$，其中 $n_0$ 是一个已知的正整数。\n- **观测方案**：在时间区间 $[0, T]$ 内完全观测单个轨迹。这包括所有跳变时间、每次跳变的类型（出生或死亡），以及在所有 $t \\in [0, T]$ 时的种群大小 $n(t)$。\n- **充分统计量**：\n    - $B$：在 $[0, T]$ 内的总出生事件计数。\n    - $D$：在 $[0, T]$ 内的总死亡事件计数。\n    - $S \\equiv \\int_{0}^{T} n(t)\\, dt$：在 $[0, T]$ 内的累积种群暴露量。\n- **假设**：种群无迁入，数据无删失。\n- **目标**：\n    1. 推导似然函数 $L(\\lambda, \\mu \\mid \\text{trajectory})$。\n    2. 计算最大似然估计量（MLEs）$\\hat{\\lambda}$ 和 $\\hat{\\mu}$。\n    3. 在累积暴露量 $S \\to \\infty$ 的极限下，确定 $\\hat{\\lambda}$ 和 $\\hat{\\mu}$ 的主阶渐近方差。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题是随机过程统计推断中的一个标准练习，特别是针对连续时间马尔可夫链。\n- **科学依据**：线性生死过程是数学生物学、群体遗传学和排队论中的一个基础且典型的模型。其数学表述严谨且成熟。所述问题在科学和数学上是合理的。\n- **良定性**：问题定义清晰。提供的数据（$B$、$D$ 和 $S$）是在完全观测条件下此过程参数（$\\lambda$、$\\mu$）的著名充分统计量。目标明确，并能导出一个唯一的、有意义的解。\n- **客观性**：问题使用精确、标准的数学和统计术语陈述。它没有任何模糊性、主观性或非科学性主张。\n\n### 步骤3：结论与行动\n问题是**有效的**。现在开始求解过程。\n\n### 似然函数的推导\n一个一般CTMC $X(t)$ 在区间 $[0, T]$ 上被完全观测的轨迹的似然函数，是由观测到的跳变速率的乘积与跳变之间停留时间概率的乘积给出的。设观测到的跳变时间为 $0  t_1  t_2  \\dots  t_k  T$，其中在区间 $[t_i, t_{i+1})$（$t_0=0$ 且 $t_{k+1}=T$）内的状态为 $n_i$。似然函数为：\n$$\nL = \\left( \\prod_{i=1}^{k} q_{n_{i-1}, n_i} \\right) \\exp\\left( - \\sum_{i=0}^{k} q_{n_i} (t_{i+1} - t_i) \\right)\n$$\n其中 $q_{n,m}$ 是从状态 $n$ 到状态 $m$ 的转移速率，而 $q_n = \\sum_{m \\neq n} q_{n,m}$ 是从状态 $n$ 的总离开速率。\n\n对于给定的线性生死过程，其速率为：\n- 出生：$q_{n, n+1} = \\lambda n$\n- 死亡：$q_{n, n-1} = \\mu n$\n- 总离开速率：$q_n = q_{n, n+1} + q_{n, n-1} = \\lambda n + \\mu n = (\\lambda + \\mu)n$。\n\n似然表达式中的乘积项可以根据跳变类型分解。共有 $B$ 次出生事件和 $D$ 次死亡事件。设在第 $j$ 次出生事件前系统的状态为 $n_{b,j}$，在第 $j$ 次死亡事件前系统的状态为 $n_{d,j}$。跳变速率的乘积为：\n$$\n\\prod_{\\text{jumps}} \\text{rate} = \\left( \\prod_{j=1}^{B} (\\lambda n_{b,j}) \\right) \\left( \\prod_{j=1}^{D} (\\mu n_{d,j}) \\right) = \\lambda^B \\mu^D \\left( \\prod_{j=1}^{B} n_{b,j} \\prod_{j=1}^{D} n_{d,j} \\right)\n$$\n涉及种群大小乘积的项仅取决于观测到的路径，而不取决于参数 $\\lambda$ 和 $\\mu$。为了找到最大似然估计量，该项是一个比例常数。\n\n指数项涉及离开速率乘以停留时间的总和。这个总和可以表示为在观测区间上的积分：\n$$\n\\sum_{i=0}^{k} q_{n_i} (t_{i+1} - t_i) = \\int_{0}^{T} q_{n(t)} dt = \\int_{0}^{T} (\\lambda + \\mu) n(t) dt\n$$\n使用累积暴露量 $S = \\int_{0}^{T} n(t)\\, dt$ 的定义，这变为：\n$$\n(\\lambda + \\mu) \\int_{0}^{T} n(t) dt = (\\lambda + \\mu) S\n$$\n结合这些部分，观测轨迹的似然函数 $L(\\lambda, \\mu)$，作为参数 $\\lambda$ 和 $\\mu$ 的函数，正比于：\n$$\nL(\\lambda, \\mu \\mid \\text{trajectory}) \\propto \\lambda^B \\mu^D \\exp\\left(-(\\lambda + \\mu)S\\right)\n$$\n\n### 最大似然估计量（MLEs）的计算\n为了找到最大似然估计量，我们对 $L(\\lambda, \\mu)$ 关于 $\\lambda$ 和 $\\mu$ 进行最大化。更方便的是最大化对数似然函数 $\\ell(\\lambda, \\mu) = \\ln L(\\lambda, \\mu)$：\n$$\n\\ell(\\lambda, \\mu) = B \\ln \\lambda + D \\ln \\mu - (\\lambda + \\mu)S + C\n$$\n其中 $C$ 是一个不依赖于 $\\lambda$ 或 $\\mu$ 的常数。\n\n我们计算 $\\ell$ 关于 $\\lambda$ 和 $\\mu$ 的偏导数，并令它们为零：\n$$\n\\frac{\\partial \\ell}{\\partial \\lambda} = \\frac{B}{\\lambda} - S = 0\n$$\n$$\n\\frac{\\partial \\ell}{\\partial \\mu} = \\frac{D}{\\mu} - S = 0\n$$\n解这些关于 $\\lambda$ 和 $\\mu$ 的方程，得到最大似然估计量 $\\hat{\\lambda}$ 和 $\\hat{\\mu}$：\n$$\n\\hat{\\lambda} = \\frac{B}{S}\n$$\n$$\n\\hat{\\mu} = \\frac{D}{S}\n$$\n为确认这些是最大值点，我们可以检查二阶偏导数。$\\ell$ 的海森矩阵是：\n$$\nH = \\begin{pmatrix} \\frac{\\partial^2 \\ell}{\\partial \\lambda^2}  \\frac{\\partial^2 \\ell}{\\partial \\lambda \\partial \\mu} \\\\ \\frac{\\partial^2 \\ell}{\\partial \\mu \\partial \\lambda}  \\frac{\\partial^2 \\ell}{\\partial \\mu^2} \\end{pmatrix} = \\begin{pmatrix} -\\frac{B}{\\lambda^2}  0 \\\\ 0  -\\frac{D}{\\mu^2} \\end{pmatrix}\n$$\n因为 $\\lambda  0$，$\\mu  0$，$B \\ge 0$，且 $D \\ge 0$，对角元素是非正的。对于一个至少有一次出生和一次死亡的非平凡轨迹，$B  0$ 和 $D  0$，海森矩阵是负定的，这确认我们找到了一个唯一的最大值。\n\n### 渐近方差的推导\n最大似然估计量的渐近方差-协方差矩阵由费雪信息矩阵 $I(\\theta)$ 的逆给出，其中 $\\theta = (\\lambda, \\mu)$。费雪信息矩阵定义为海森矩阵期望的负值：$I(\\theta) = -E[H(\\theta)]$。\n$$\nI(\\theta) = -E\\left[ \\begin{pmatrix} -\\frac{B}{\\lambda^2}  0 \\\\ 0  -\\frac{D}{\\mu^2} \\end{pmatrix} \\right] = \\begin{pmatrix} \\frac{E[B]}{\\lambda^2}  0 \\\\ 0  \\frac{E[D]}{\\mu^2} \\end{pmatrix}\n$$\n出生数 $B$ 和死亡数 $D$ 是随机变量，我们需要求它们的期望。在时间 $t$ 的瞬时出生率为 $\\lambda n(t)$。在 $[0, T]$ 上的期望出生数是期望速率的积分：\n$$\nE[B] = E\\left[ \\int_0^T dN_B(t) \\right] = \\int_0^T E[\\lambda n(t)] dt = \\lambda E\\left[\\int_0^T n(t) dt\\right] = \\lambda E[S]\n$$\n同样，对于死亡数：\n$$\nE[D] = E\\left[ \\int_0^T dN_D(t) \\right] = \\int_0^T E[\\mu n(t)] dt = \\mu E\\left[\\int_0^T n(t) dt\\right] = \\mu E[S]\n$$\n将这些期望代入费雪信息矩阵：\n$$\nI(\\theta) = \\begin{pmatrix} \\frac{\\lambda E[S]}{\\lambda^2}  0 \\\\ 0  \\frac{\\mu E[S]}{\\mu^2} \\end{pmatrix} = \\begin{pmatrix} \\frac{E[S]}{\\lambda}  0 \\\\ 0  \\frac{E[S]}{\\mu} \\end{pmatrix}\n$$\n估计量 $(\\hat{\\lambda}, \\hat{\\mu})$ 的渐近方差-协方差矩阵是费雪信息矩阵的逆：\n$$\n\\mathrm{Var}(\\hat{\\theta}) \\approx I(\\theta)^{-1} = \\begin{pmatrix} \\frac{\\lambda}{E[S]}  0 \\\\ 0  \\frac{\\mu}{E[S]} \\end{pmatrix}\n$$\n问题指定了渐近极限为观测暴露量 $S \\to \\infty$。在此极限下，观测暴露量 $S$ 成为样本中信息量的自然度量。对于具有较大 $S$ 值的特定轨迹，期望 $E[S]$ 可以很好地由 $S$ 近似。因此，估计量的主阶渐近方差用真实参数和观测暴露量 $S$ 表示。\n$\\hat{\\lambda}$ 的渐近方差为：\n$$\n\\mathrm{Var}(\\hat{\\lambda}) \\approx \\frac{\\lambda}{S}\n$$\n$\\hat{\\mu}$ 的渐近方差为：\n$$\n\\mathrm{Var}(\\hat{\\mu}) \\approx \\frac{\\mu}{S}\n$$\n非对角线项为零，表明估计量 $\\hat{\\lambda}$ 和 $\\hat{\\mu}$ 是渐近不相关的。\n\n最终结果是：\n1. 出生率的MLE：$\\hat{\\lambda} = \\frac{B}{S}$\n2. 死亡率的MLE：$\\hat{\\mu} = \\frac{D}{S}$\n3. $\\hat{\\lambda}$ 的渐近方差：$\\mathrm{Var}(\\hat{\\lambda}) \\approx \\frac{\\lambda}{S}$\n4. $\\hat{\\mu}$ 的渐近方差：$\\mathrm{Var}(\\hat{\\mu}) \\approx \\frac{\\mu}{S}$\n\n这些表达式将按要求以单行矩阵形式呈现。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{B}{S}  \\frac{D}{S}  \\frac{\\lambda}{S}  \\frac{\\mu}{S}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在为数据拟合模型并估计其参数后，一个关键问题是：这个模型本身的结构是否正确？例如，一个具有时变速率的模型是否比恒定速率模型更适合描述神经元活动？本练习介绍了一种强大的模型验证技术——时间重整定理 (time-rescaling theorem) 。通过对观测到的事件时间进行特定变换，我们可以检验其结果是否服从均匀分布，从而判断模型是否拟合良好，这是任何严谨建模工作中都不可或缺的步骤。",
            "id": "3920131",
            "problem": "您的任务是构建一个完整的、可运行的程序，该程序使用时间重标残差和针对均匀分布的单样本柯尔莫哥洛夫-斯米尔诺夫检验，为生物医学点过程数据实现拟合优度诊断。背景是建模为非齐次泊松过程的神经元脉冲序列，尽管其表述是纯数学的。所有事件时间以秒（s）为单位，强度以秒的倒数（$\\mathrm{s}^{-1}$）为单位。\n\n基本原理：\n- 对于一个条件强度函数为 $\\lambda(t \\mid \\mathcal{H}_t)$ 的简单点过程，其中 $\\mathcal{H}_t$ 表示直到时间 $t$ 的历史，当模型为生成过程被正确指定时，其事件间间隔的积分条件强度增量 $$W_k = \\int_{t_{k-1}}^{t_k} \\lambda(u \\mid \\mathcal{H}_u)\\,du$$ 是独立同分布且均值为 $1$ 的指数随机变量。等价地，变换后的残差 $$U_k = 1 - e^{-W_k}$$ 是在 $[0,1]$ 上独立同分布的均匀随机变量。\n- 柯尔莫哥洛夫-斯米尔诺夫（KS）检验，正式名称为柯尔莫哥洛夫-斯米尔诺夫检验（KST），将样本的经验累积分布函数（CDF）与一个指定的连续CDF（此处为 $[0,1]$ 上的均匀CDF）进行比较，并为原假设（即样本是从指定分布中抽取的）得出一个检验统计量 $D$ 和一个 $p$ 值。\n\n模型设定：\n- 考虑在 $[0,\\infty)$ 上的一个非齐次泊松过程，其强度为\n$$\n\\lambda(t;\\theta) = \\beta + A \\exp\\!\\left(-\\frac{(t - \\mu)^2}{2\\sigma^2}\\right), \\quad t \\ge 0,\n$$\n其中 $\\theta = (\\beta, A, \\mu, \\sigma)$，满足 $\\beta \\ge 0$，$A \\ge 0$，$\\sigma  0$，以及 $\\mu \\in \\mathbb{R}$。\n- 对于任意区间 $[a,b]$，此模型下的积分强度为\n$$\n\\int_a^b \\lambda(u;\\theta)\\,du = \\beta(b-a) + A \\sigma \\sqrt{\\frac{\\pi}{2}} \\left[\\operatorname{erf}\\!\\left(\\frac{b - \\mu}{\\sqrt{2}\\,\\sigma}\\right) - \\operatorname{erf}\\!\\left(\\frac{a - \\mu}{\\sqrt{2}\\,\\sigma}\\right)\\right],\n$$\n其中 $\\operatorname{erf}(\\cdot)$ 是高斯误差函数。\n\n诊断设计（您的程序必须实现）：\n1. 使用已知的真实强度 $\\lambda(t;\\theta_{\\text{true}})$ 生成合成事件：\n   - 通过累积强度的反演，确定性地生成 $n$ 个事件时间 $0 = t_0  t_1  \\dots  t_n$，使得积分增量 $W_k = \\int_{t_{k-1}}^{t_k} \\lambda(u;\\theta_{\\text{true}})\\,du$ 满足 $U_k = 1 - e^{-W_k}$，其中 $U_k \\in (0,1)$ 是一个预设的确定性序列，适用于 $k=1,\\dots,n$。使用序列 $U_k = \\frac{k}{n+1}$，使得积分增量为 $W_k = -\\ln(1 - U_k)$，并通过求解\n   $$\n   \\int_{t_{k-1}}^{t_k} \\lambda(u;\\theta_{\\text{true}})\\,du = -\\ln(1 - U_k),\n   $$\n   来确定每个 $t_k$，在 $t_k$ 上使用一个单调求根方法（例如，二分法），将解限制在有限区间 $[t_{k-1}, T_{\\max}]$ 内，其中 $T_{\\max}$ 的选择需足够大，以容纳所需的总积分强度。\n2. 在候选模型 $\\lambda(t;\\theta_{\\text{model}})$ 下的时间重标残差：\n   - 计算\n   $$\n   W_k^{\\text{model}} = \\int_{t_{k-1}}^{t_k} \\lambda(u;\\theta_{\\text{model}})\\,du, \\quad U_k^{\\text{model}} = 1 - e^{-W_k^{\\text{model}}}.\n   $$\n3. 对 $\\{U_k^{\\text{model}}\\}_{k=1}^n$ 应用单样本柯尔莫哥洛夫-斯米尔诺夫检验，与 $[0,1]$ 上的连续均匀分布进行比较，得到检验统计量 $D$ 和 $p$ 值。\n4. 对于每个测试用例，根据规则“如果 $p \\ge \\alpha$，则接受”，输出一个布尔值，指示在水平 $\\alpha$ 下是否接受原假设。\n\n测试套件：\n为以下四个测试用例实施该诊断。在每个案例中，使用 $\\theta_{\\text{true}}$ 生成合成事件时间，然后使用 $\\theta_{\\text{model}}$ 计算残差。时间单位使用秒（s），强度单位使用秒的倒数（$\\mathrm{s}^{-1}$）。设置 $T_{\\max} = 300\\,\\mathrm{s}$。\n\n- 案例1（模型指定正确，中等样本量）：\n  - $\\theta_{\\text{true}} = (\\beta, A, \\mu, \\sigma) = (0.5, 1.0, 10.0, 1.0)$\n  - $\\theta_{\\text{model}} = (0.5, 1.0, 10.0, 1.0)$\n  - $n = 50$\n  - $\\alpha = 0.05$\n- 案例2（振幅指定错误，相同样本量）：\n  - $\\theta_{\\text{true}} = (0.5, 1.0, 10.0, 1.0)$\n  - $\\theta_{\\text{model}} = (0.5, 2.0, 10.0, 1.0)$\n  - $n = 50$\n  - $\\alpha = 0.05$\n- 案例3（振幅指定错误，小样本量）：\n  - $\\theta_{\\text{true}} = (0.5, 1.0, 10.0, 1.0)$\n  - $\\theta_{\\text{model}} = (0.5, 2.0, 10.0, 1.0)$\n  - $n = 5$\n  - $\\alpha = 0.05$\n- 案例4（位置指定错误，较大样本量）：\n  - $\\theta_{\\text{true}} = (0.3, 1.5, 20.0, 2.0)$\n  - $\\theta_{\\text{model}} = (0.3, 1.5, 25.0, 2.0)$\n  - $n = 60$\n  - $\\alpha = 0.05$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含四个案例的接受决策，格式为方括号内的逗号分隔列表，例如，“[True,False,True,False]”。每个条目都是一个布尔值，指示该案例中模型的重标时间残差是否通过了指定显著性水平下的均匀柯尔莫哥洛夫-斯米尔诺夫检验。",
            "solution": "用户提供了一个在生物医学系统建模领域定义明确的计算问题，具体涉及点过程模型的验证。我将首先确认问题陈述的有效性，然后提供一个全面的解决方案和实现。\n\n### 问题验证\n\n**第1步：提取已知条件**\n\n*   **过程模型**：在 $[0, \\infty)$ 上的一个非齐次泊松过程，其强度函数为 $\\lambda(t;\\theta) = \\beta + A \\exp(-\\frac{(t - \\mu)^2}{2\\sigma^2})$，其中 $\\theta = (\\beta, A, \\mu, \\sigma)$。\n*   **积分强度公式**：强度的定积分由公式 $\\int_a^b \\lambda(u;\\theta)\\,du = \\beta(b-a) + A \\sigma \\sqrt{\\frac{\\pi}{2}} \\left[\\operatorname{erf}(\\frac{b - \\mu}{\\sqrt{2}\\,\\sigma}) - \\operatorname{erf}(\\frac{a - \\mu}{\\sqrt{2}\\,\\sigma})\\right]$ 给出。\n*   **时间重标原理**：如果模型正确，积分强度增量 $W_k = \\int_{t_{k-1}}^{t_k} \\lambda(u \\mid \\mathcal{H}_u)\\,du$ 是独立同分布（i.i.d.）且均值为1的指数随机变量。变换后的残差 $U_k = 1 - e^{-W_k}$ 是在 $[0,1]$ 上独立同分布的均匀随机变量。\n*   **合成数据生成**：通过求解 $\\int_{t_{k-1}}^{t_k} \\lambda(u;\\theta_{\\text{true}})\\,du = -\\ln(1 - U_k)$ 来确定性地生成事件时间 $0 = t_0  t_1  \\dots  t_n$，其中 $U_k = \\frac{k}{n+1}$。将使用区间 $[t_{k-1}, T_{\\max}]$ 上的单调求根方法。\n*   **拟合优度检验**：对计算出的残差 $\\{U_k^{\\text{model}}\\}_{k=1}^n = \\{1 - e^{-\\int_{t_{k-1}}^{t_k} \\lambda(u;\\theta_{\\text{model}})\\,du}\\}_{k=1}^n$ 应用单样本柯尔莫哥洛夫-斯米尔诺夫（KS）检验，与标准均匀分布进行比较。\n*   **决策规则**：如果KS检验的 $p$ 值大于或等于显著性水平 $\\alpha$，则接受原假设（即模型与数据拟合）。\n*   **常数和参数**：$T_{\\max} = 300\\,\\mathrm{s}$。指定了四个测试用例，每个用例具有不同的真实参数（$\\theta_{\\text{true}}$）、模型参数（$\\theta_{\\text{model}}$）、样本量（$n$）和显著性水平（$\\alpha=0.05$）。\n\n**第2步：使用提取的已知条件进行验证**\n\n1.  **科学依据**：该问题基于时间重标定理，这是点过程理论的基石。强度函数是瞬时速率变化的标准模型。使用柯尔莫哥洛夫-斯米尔诺夫检验对均匀分布进行拟合优度检验是标准的统计程序。通过反演确定性地生成事件是创建具有特定属性的合成数据的有效技术。该问题在科学上和数学上都是合理的。\n2.  **适定性**：所有必要的函数、参数和步骤都已明确定义。对于给定的参数约束（因为 $\\beta \\geq 0$，$A \\geq 0$，且两者不都为零），强度函数 $\\lambda(t)$ 严格为正，这保证了其积分是严格递增的。这确保了用于生成事件时间的求根问题有唯一解。提供的 $T_{\\max}$ 值足够大，可以包含指定测试用例的所有事件。该问题是自包含且无歧义的。\n3.  **客观性**：该问题使用精确的数学语言和客观、可验证的指令进行陈述。没有主观或基于意见的组成部分。\n\n**第3步：结论和行动**\n\n该问题是 **有效的**。它具有科学依据、适定性且客观。我现在将开始提供解决方案。\n\n### 解决方案\n\n该解决方案涉及实现一个计算诊断，以评估非齐次泊松过程模型的拟合优度。这将通过遵循规定的步骤来完成：在“真实”模型下确定性地生成合成事件数据，在“候选”模型下计算时间重标残差，以及对这些残差的均匀性进行统计检验。\n\n**1. 理论框架：时间重标定理**\n此方法的基础是时间重标定理。对于一个具有事件时间 $t_1, t_2, \\dots, t_n$ 和正确指定的条件强度函数 $\\lambda(t | \\mathcal{H}_t)$ 的点过程，量\n$$\nW_k = \\int_{t_{k-1}}^{t_k} \\lambda(u | \\mathcal{H}_u) \\, du, \\quad k=1, 2, \\dots, n\n$$\n是来自速率为1的指数分布的独立同分布随机变量。这里，$\\mathcal{H}_t$ 表示直到时间 $t$ 的事件历史。对于非齐次泊松过程，强度 $\\lambda(t)$ 与历史无关。\n\n通过应用概率积分变换，我们可以将这些指数变量转换为均匀变量。如果 $W \\sim \\text{Exponential}(1)$，其累积分布函数（CDF）为 $F(w) = 1 - e^{-w}$。变换后的变量 $U=F(W)=1-e^{-W}$ 在 $[0,1]$ 上均匀分布。因此，如果我们的模型 $\\lambda(t;\\theta)$ 是正确的，时间重标残差\n$$\nU_k = 1 - \\exp\\left(-\\int_{t_{k-1}}^{t_k} \\lambda(u;\\theta) \\, du\\right)\n$$\n必须是来自 Uniform$[0,1]$ 分布的独立同分布样本。这构成了我们拟合优度检验的原假设的基础。\n\n**2. 合成事件生成**\n为了测试我们的诊断程序，我们首先需要一组事件时间。我们从一个已知的真实模型 $\\lambda(t; \\theta_{\\text{true}})$ 中确定性地生成这些时间。我们不进行随机模拟，而是通过将残差 $U_k$ 设置为均匀分布的分位数来对其施加确定性结构：\n$$\nU_k = \\frac{k}{n+1}, \\quad k = 1, \\dots, n.\n$$\n如果用正确的模型进行分析，这种选择可以确保残差的“完美”分布。由此，我们得出每个事件间间隔所需的积分强度：\n$$\nW_k = -\\ln(1 - U_k) = -\\ln\\left(1 - \\frac{k}{n+1}\\right) = \\ln\\left(\\frac{n+1}{n+1-k}\\right).\n$$\n然后，通过为每个 $k$ 依次求解积分方程来找到事件时间 $t_k$：\n$$\n\\int_{t_{k-1}}^{t_k} \\lambda(u; \\theta_{\\text{true}}) \\, du = W_k.\n$$\n令 $\\Lambda(a, b; \\theta) = \\int_a^b \\lambda(u; \\theta) \\, du$。我们需要对 $t$ 求解方程 $\\Lambda(t_{k-1}, t, \\theta_{\\text{true}}) - W_k = 0$。由于 $\\lambda(t)  0$，函数 $f(t) = \\Lambda(t_{k-1}, t, \\theta_{\\text{true}})$ 在 $t$ 上是严格递增的。这保证了在搜索区间 $[t_{k-1}, T_{\\max}]$ 内存在一个唯一的根 $t_k  t_{k-1}$，可以使用数值求根算法（如布伦特方法）高效地找到该根。\n\n**3. 残差计算与统计检验**\n一旦生成了事件时间 $\\{t_k\\}_{k=1}^n$，我们就测试一个候选模型 $\\lambda(t; \\theta_{\\text{model}})$。注意 $\\theta_{\\text{model}}$ 可能等于也可能不等于 $\\theta_{\\text{true}}$。我们计算此候选模型下的残差：\n$$\nW_k^{\\text{model}} = \\Lambda(t_{k-1}, t_k; \\theta_{\\text{model}}),\n$$\n$$\nU_k^{\\text{model}} = 1 - \\exp(-W_k^{\\text{model}}).\n$$\n如果 $\\theta_{\\text{model}}$ 是生成事件时间的过程的一个良好表示（即，如果 $\\theta_{\\text{model}} \\approx \\theta_{\\text{true}}$），序列 $\\{U_k^{\\text{model}}\\}$ 应该看起来像是来自 Uniform$[0,1]$ 分布的样本。我们使用单样本柯尔莫哥洛夫-斯米尔诺夫（KS）检验来正式检验这个假设。KS检验计算样本 $\\{U_k^{\\text{model}}\\}$ 的经验CDF与标准均匀分布的理论CDF之间的最大绝对差。这个差值是检验统计量 $D$。该检验得出一个 $p$ 值，它是在原假设下观察到至少与 $D$ 一样极端的统计量的概率。\n\n**4. 决策**\n我们将 $p$ 值与显著性水平 $\\alpha$ 进行比较。如果 $p \\ge \\alpha$，我们没有足够的证据拒绝原假设，我们“接受”该模型（更正式地说，我们未能拒绝它）。如果 $p  \\alpha$，我们拒绝原假设，得出候选模型不适合数据的结论。程序将对四个指定的测试用例中的每一个执行整个过程，并报告决策规则的布尔结果。\n\n*   **案例1（模型指定正确）**：$\\theta_{\\text{model}} = \\theta_{\\text{true}}$。残差 $\\{U_k^{\\text{model}}\\}$ 被生成为完全均匀的分位数。KS检验应该会产生一个大的 $p$ 值，从而导致接受。\n*   **案例2（振幅指定错误）**：$\\theta_{\\text{model}}$ 的振幅 $A$ 大于 $\\theta_{\\text{true}}$。这将导致计算出的 $W_k^{\\text{model}}$ 系统性地大于真实的 $W_k$，从而将 $U_k^{\\text{model}}$ 的值推向1。KS检验应该能检测到这种与均匀性的偏离，产生一个小的 $p$ 值，从而导致拒绝。\n*   **案例3（振幅指定错误，小样本）**：与案例2相同的错误指定，但样本量小得多（$n=5$）。对于小样本，统计检验的功效较低，使得检测偏差更加困难。尽管模型不正确，检验仍有可能未能拒绝原假设。\n*   **案例4（位置指定错误）**：$\\theta_{\\text{model}}$ 的峰值位置 $\\mu$ 与 $\\theta_{\\text{true}}$ 不同。这将导致系统性失配，其中 $W_k^{\\text{model}}$ 在某些区间过小，在另一些区间过大。在有足够样本量（$n=60$）的情况下，预计KS检验将能检测到这一点并拒绝该模型。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import erf\nfrom scipy.optimize import brentq\nfrom scipy.stats import kstest\n\ndef solve():\n    \"\"\"\n    Implements a goodness-of-fit diagnostic for an inhomogeneous Poisson process model\n    using time-rescaled residuals and the Kolmogorov-Smirnov test.\n    \"\"\"\n\n    def integrated_lambda(t_start, t_end, theta):\n        \"\"\"\n        Calculates the integrated intensity over the interval [t_start, t_end].\n\n        The intensity function is lambda(t) = beta + A * exp(-(t - mu)^2 / (2 * sigma^2)).\n        The integral is computed analytically using the error function erf.\n        \"\"\"\n        beta, A, mu, sigma = theta\n        \n        # Linear term from the constant baseline intensity beta\n        integral_beta = beta * (t_end - t_start)\n        \n        # Gaussian term's contribution\n        # Argument for the error function: z = (t - mu) / (sqrt(2) * sigma)\n        z_start = (t_start - mu) / (np.sqrt(2) * sigma)\n        z_end = (t_end - mu) / (np.sqrt(2) * sigma)\n        \n        # Integral of the Gaussian component\n        integral_gauss = A * sigma * np.sqrt(np.pi / 2) * (erf(z_end) - erf(z_start))\n        \n        return integral_beta + integral_gauss\n\n    def generate_events(theta_true, n, t_max):\n        \"\"\"\n        Generates a deterministic sequence of event times by inverting the\n        cumulative intensity function.\n        \"\"\"\n        event_times = np.zeros(n)\n        t_prev = 0.0\n        \n        for k in range(1, n + 1):\n            # Prescribed U_k values are quantiles of the uniform distribution\n            U_k = k / (n + 1)\n            # Corresponding integrated intensity W_k for an exponential(1) variable\n            W_k = -np.log(1 - U_k)\n            \n            # Define the function whose root we need to find.\n            # We are solving integrated_lambda(t_prev, t_k) - W_k = 0 for t_k.\n            def root_func(t_k):\n                return integrated_lambda(t_prev, t_k, theta_true) - W_k\n\n            # Use Brent's method to find the next event time t_k.\n            # The search interval is [t_prev, t_max].\n            # f(t_prev) is -W_k  0. We expect f(t_max) > 0 for a root to be bracketed.\n            try:\n                t_k = brentq(root_func, t_prev, t_max, xtol=1e-12, rtol=1e-12)\n                event_times[k-1] = t_k\n                t_prev = t_k\n            except ValueError:\n                # This would happen if t_max is not large enough, so root_func(t_max) is not positive.\n                # The problem setup ensures t_max is sufficient.\n                raise ValueError(f\"Root not bracketed for event {k}. Increase T_max.\")\n                \n        return event_times\n\n    # Test cases defined in the problem statement.\n    # Format: (theta_true, theta_model, n, alpha)\n    # T_max is common for all cases.\n    T_MAX = 300.0\n    test_cases = [\n        # Case 1: Well-specified, moderate sample size\n        {'theta_true': (0.5, 1.0, 10.0, 1.0), 'theta_model': (0.5, 1.0, 10.0, 1.0), 'n': 50, 'alpha': 0.05},\n        # Case 2: Amplitude misspecified, same sample size\n        {'theta_true': (0.5, 1.0, 10.0, 1.0), 'theta_model': (0.5, 2.0, 10.0, 1.0), 'n': 50, 'alpha': 0.05},\n        # Case 3: Amplitude misspecified, small sample size\n        {'theta_true': (0.5, 1.0, 10.0, 1.0), 'theta_model': (0.5, 2.0, 10.0, 1.0), 'n': 5, 'alpha': 0.05},\n        # Case 4: Location misspecified, larger sample size\n        {'theta_true': (0.3, 1.5, 20.0, 2.0), 'theta_model': (0.3, 1.5, 25.0, 2.0), 'n': 60, 'alpha': 0.05},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        theta_true = case['theta_true']\n        theta_model = case['theta_model']\n        n = case['n']\n        alpha = case['alpha']\n\n        # 1. Generate synthetic event times using the ground-truth model\n        event_times = generate_events(theta_true, n, T_MAX)\n        \n        # 2. Compute time-rescaled residuals under the candidate model\n        U_model = np.zeros(n)\n        t_prev = 0.0\n        for i, t_k in enumerate(event_times):\n            W_k_model = integrated_lambda(t_prev, t_k, theta_model)\n            U_model[i] = 1.0 - np.exp(-W_k_model)\n            t_prev = t_k\n            \n        # 3. Apply a one-sample KS test against the uniform distribution\n        # The null hypothesis is that the sample `U_model` is drawn from a uniform distribution.\n        ks_statistic, p_value = kstest(U_model, 'uniform')\n        \n        # 4. Accept the null hypothesis if p >= alpha\n        decision = (p_value >= alpha)\n        results.append(decision)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, [r.item() for r in results]))}]\")\n\nsolve()\n```"
        }
    ]
}