{
    "hands_on_practices": [
        {
            "introduction": "这个练习为理解基因表达噪声建立了一个基本基准。通过分析最简单的情景——一个始终“开启”的基因——我们可以推导出分子生灭过程中固有的内在随机性。本练习将指导你从化学主方程（Chemical Master Equation）出发，推导mRNA计数的泊松分布，这是一个基础性结论，为所有更复杂的模型提供了参照点。",
            "id": "3932263",
            "problem": "考虑一个单基因，其信使核糖核酸（mRNA）分子以恒定的转录速率 $k_{m}$ 组成性地产生，并以每个分子的一级速率 $\\gamma_{m}$ 独立降解。设 $m(t)$ 表示在时间 $t$ 的随机 mRNA 拷贝数，该过程被建模为非负整数上的连续时间马尔可夫跳跃过程，其生成速率为 $k_{m}$，死亡速率为 $\\gamma_{m} m(t)$。假设系统在这种线性生灭动力学下达到唯一的稳态分布。\n\n从化学主方程（CME）出发，推导 $m$ 的稳态分布，并由此计算 mRNA 拷贝数的稳态均值 $\\mathbb{E}[m]$、方差 $\\mathrm{Var}(m)$ 和法诺因子（定义为 $\\mathrm{Var}(m)/\\mathbb{E}[m]$）。用 $k_{m}$ 和 $\\gamma_{m}$ 的闭式解析表达式表示您的最终答案。按顺序报告这三个量：$\\mathbb{E}[m]$、$\\mathrm{Var}(m)$ 和法诺因子。mRNA 拷贝数是无量纲的；不要包含单位。不需要进行数值近似或四舍五入。",
            "solution": "该问题提出了一个关于 mRNA 分子数 $m$ 的线性生灭过程。我们需要推导其稳态分布，并计算其前两个矩和法诺因子。\n\n首先，我们为在时间 $t$ 具有 $m$ 个分子的概率 $P(m, t)$ 构建化学主方程（CME）。该过程涉及两个反应：\n1.  生产（生成）：$\\emptyset \\xrightarrow{k_m} \\text{mRNA}$，以恒定速率 $k_m$ 发生。\n2.  降解（死亡）：$\\text{mRNA} \\xrightarrow{\\gamma_m} \\emptyset$，以速率 $\\gamma_m m$ 发生。\n\nCME 通过考虑进出状态 $m$ 的概率流来描述 $P(m, t)$ 的变化率。对于一个具有 $m$ 个分子的状态，其中 $m \\ge 1$：\n- 由于生产，从状态 $m-1$ 流入：$k_m P(m-1, t)$。\n- 由于降解，从状态 $m+1$ 流入：$\\gamma_m (m+1) P(m+1, t)$。\n- 由于生产，流出到状态 $m+1$：$k_m P(m, t)$。\n- 由于降解，流出到状态 $m-1$：$\\gamma_m m P(m, t)$。\n\n结合这些项，得到 $m \\ge 1$ 时的 CME：\n$$\n\\frac{dP(m, t)}{dt} = k_m P(m-1, t) + \\gamma_m (m+1) P(m+1, t) - (k_m + \\gamma_m m) P(m, t)\n$$\n对于边界情况 $m=0$，没有降解，而生产只能从分子数为负数的状态发生，这是不可能的。该方程为：\n$$\n\\frac{dP(0, t)}{dt} = \\gamma_m (1) P(1, t) - k_m P(0, t)\n$$\n\n问题陈述系统达到唯一的稳态分布。在稳态下，概率不随时间变化，因此对所有 $m$ 都有 $\\frac{dP(m, t)}{dt} = 0$。设 $P_m$ 表示拥有 $m$ 个分子的稳态概率。方程组变为：\n对于 $m=0$：\n$$\n0 = \\gamma_m P_1 - k_m P_0 \\implies k_m P_0 = \\gamma_m P_1\n$$\n对于 $m \\ge 1$：\n$$\n0 = k_m P_{m-1} + \\gamma_m (m+1) P_{m+1} - (k_m + \\gamma_m m) P_m\n$$\n这组方程被细致平衡条件所满足，即在稳态下，任何两个相邻状态之间的净流量为零。从状态 $m-1$ 到 $m$ 的流量（生产）必须与从状态 $m$ 到 $m-1$ 的流量（降解）相平衡：\n$$\nk_m P_{m-1} = \\gamma_m m P_m \\quad \\text{for } m \\ge 1\n$$\n这可以通过将其代入稳态 CME 来验证。如果 $k_m P_{m-1} = \\gamma_m m P_m$，那么也必须有 $k_m P_m = \\gamma_m (m+1) P_{m+1}$。将这些代入 $m \\ge 1$ 的稳态方程中：\n$$\n0 = (\\gamma_m m P_m) + (k_m P_m) - (k_m + \\gamma_m m) P_m = 0\n$$\n条件成立。因此，递推关系为 $P_m = \\frac{k_m}{\\gamma_m m} P_{m-1}$，对于 $m \\ge 1$。\n\n我们可以通过迭代求解这个递推关系，用 $P_0$ 表示 $P_m$：\n对于 $m=1$：$P_1 = \\frac{k_m}{\\gamma_m} P_0$。\n对于 $m=2$：$P_2 = \\frac{k_m}{2\\gamma_m} P_1 = \\frac{k_m}{2\\gamma_m} \\left( \\frac{k_m}{\\gamma_m} P_0 \\right) = \\frac{1}{2!} \\left( \\frac{k_m}{\\gamma_m} \\right)^2 P_0$。\n对于 $m=3$：$P_3 = \\frac{k_m}{3\\gamma_m} P_2 = \\frac{k_m}{3\\gamma_m} \\left( \\frac{1}{2!} \\left( \\frac{k_m}{\\gamma_m} \\right)^2 P_0 \\right) = \\frac{1}{3!} \\left( \\frac{k_m}{\\gamma_m} \\right)^3 P_0$。\n通过归纳法，通解为：\n$$\nP_m = \\frac{1}{m!} \\left( \\frac{k_m}{\\gamma_m} \\right)^m P_0\n$$\n为了找到 $P_0$，我们使用归一化条件，即所有概率之和必须等于 $1$：\n$$\n\\sum_{m=0}^{\\infty} P_m = 1\n$$\n代入 $P_m$ 的表达式：\n$$\n\\sum_{m=0}^{\\infty} \\frac{1}{m!} \\left( \\frac{k_m}{\\gamma_m} \\right)^m P_0 = P_0 \\sum_{m=0}^{\\infty} \\frac{1}{m!} \\left( \\frac{k_m}{\\gamma_m} \\right)^m = 1\n$$\n该和是指数函数 $\\exp(x) = \\sum_{n=0}^{\\infty} \\frac{x^n}{n!}$ 的泰勒级数展开。令参数 $\\lambda = \\frac{k_m}{\\gamma_m}$。\n$$\nP_0 \\exp(\\lambda) = 1 \\implies P_0 = \\exp(-\\lambda)\n$$\n将 $P_0$ 代回，得到最终的稳态分布：\n$$\nP_m = \\frac{\\lambda^m \\exp(-\\lambda)}{m!} \\quad \\text{where } \\lambda = \\frac{k_m}{\\gamma_m}\n$$\n这是参数为 $\\lambda$ 的泊松分布的概率质量函数。\n\n现在我们从这个分布计算所需的统计特性。对于参数为 $\\lambda$ 的泊松分布，其均值和方差是众所周知的结果：\n$m$ 的均值（期望值）是：\n$$\n\\mathbb{E}[m] = \\lambda = \\frac{k_m}{\\gamma_m}\n$$\n$m$ 的方差是：\n$$\n\\mathrm{Var}(m) = \\mathbb{E}[(m-\\mathbb{E}[m])^2] = \\lambda = \\frac{k_m}{\\gamma_m}\n$$\n法诺因子定义为方差与均值的比率：\n$$\n\\text{Fano factor} = \\frac{\\mathrm{Var}(m)}{\\mathbb{E}[m]} = \\frac{\\lambda}{\\lambda} = 1\n$$\n$1$ 的法诺因子是泊松过程的一个特征。\n\n所要求的三个量是稳态均值 $\\mathbb{E}[m]$、方差 $\\mathrm{Var}(m)$ 和法诺因子，用 $k_m$ 和 $\\gamma_m$ 表示。\n1. $\\mathbb{E}[m] = \\frac{k_m}{\\gamma_m}$\n2. $\\mathrm{Var}(m) = \\frac{k_m}{\\gamma_m}$\n3. 法诺因子 $= 1$",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{k_m}{\\gamma_m}  \\frac{k_m}{\\gamma_m}  1 \\end{pmatrix}}$$"
        },
        {
            "introduction": "真实的基因并非一直处于开启状态；它们的活性受到调控，通常是通过启动子在活性和非活性状态之间的切换来实现的。这个练习探讨了这一额外的调控层——一个“外在”噪声源——如何塑造mRNA分子的分布。你将运用时间尺度分离的方法，在两个不同的极限下分析该系统，揭示启动子切换速度和mRNA寿命之间的相互作用如何能产生远大于简单泊松情形的噪声。",
            "id": "3932233",
            "problem": "考虑一个单基因转录调控的经典双态启动子模型。启动子状态 $s(t) \\in \\{0,1\\}$ 作为一个连续时间马尔可夫链进行切换，其从状态 0 转换到状态 1 的速率为 $k_{\\mathrm{on}}$，从状态 1 转换到状态 0 的速率为 $k_{\\mathrm{off}}$。当启动子处于状态 $i \\in \\{0,1\\}$ 时，信使核糖核酸 (mRNA) 分子以速率 $\\alpha_{i}$ 通过零阶生成过程合成，每个 mRNA 分子以速率 $\\gamma$ 独立降解。令 $n(t) \\in \\mathbb{N}_{0}$ 表示在时间 $t$ 的 mRNA 拷贝数。联合过程 $\\{(s(t),n(t))\\}_{t \\ge 0}$ 是一个由化学主方程 (CME) 控制的连续时间马尔可夫过程，其状态转换由速率为 $\\alpha_{s(t)}$ 的生成事件 $n \\to n+1$、速率为 $\\gamma n$ 的消亡事件 $n \\to n-1$ 以及具有给定速率的启动子切换 $0 \\leftrightarrow 1$ 给出。假设该过程是各态遍历的，并且对于所考虑的所有参数值，都达到唯一的稳态分布。\n\n令 $p \\equiv \\frac{k_{\\mathrm{on}}}{k_{\\mathrm{on}} + k_{\\mathrm{off}}}$ 表示启动子状态 1 的稳态占据率。您将仅使用 CME 和马尔可夫过程中时间尺度分离的第一性原理，在两种不同的时间尺度分离极限下分析稳态 mRNA 数量分布：\n\n1. 快速切换机制：$k_{\\mathrm{on}}, k_{\\mathrm{off}} \\to \\infty$ 而 $p$ 保持不变，$\\alpha_{0}, \\alpha_{1}$ 和 $\\gamma$ 为固定的有限值。\n2. 慢速切换机制：$k_{\\mathrm{on}}, k_{\\mathrm{off}} \\to 0$ 而 $p$ 保持不变，$\\alpha_{0}, \\alpha_{1}$ 和 $\\gamma$ 为固定的有限值，且降解动力学的时间尺度比启动子切换更快。\n\n从联合概率 $P_{i}(n,t)$（其中 $i \\in \\{0,1\\}$）的 CME 出发，通过应用适当的时间尺度分离推理，仔细论证在每种机制下，是哪种有效的简化随机过程控制着稳态 mRNA 的统计特性。从这些简化的描述中，推导出每个极限机制下的稳态 mRNA 数量分布，而无需引用任何预先记忆的公式，然后为每种机制推导出相应的稳态法诺因子 $F \\equiv \\frac{\\mathrm{Var}[n]}{\\mathbb{E}[n]}$ 的闭式解。您的最终答案仅用 $\\alpha_{0}$、$\\alpha_{1}$、$\\gamma$ 和 $p$ 表示。\n\n以单行矩阵 $\\bigl[F_{\\mathrm{fast}} \\; F_{\\mathrm{slow}}\\bigr]$ 的形式提供稳态法诺因子的两个表达式作为最终答案。不需要数值近似或四舍五入。最终答案中不包含单位。",
            "solution": "该问题陈述经核实具有科学合理性、定义明确且客观。它描述了随机化学动力学中的一个经典模型，并提出了一个关于马尔可夫过程中时间尺度分离分析的标准且非平凡的问题。所有必要的参数和条件都已提供，并且没有内部矛盾。因此，我们可以着手求解。\n\n系统的状态由数对 $(s, n)$ 给出，其中 $s \\in \\{0, 1\\}$ 是启动子状态， $n \\in \\mathbb{N}_0$ 是 mRNA 分子的数量。稳态化学主方程 (CME) 描述了在稳态下发现系统处于状态 $(i, n)$ 的概率 $P_i(n)$。平衡方程为：\n$$\n0 = \\alpha_0 P_0(n-1) + \\gamma (n+1) P_0(n+1) + k_{\\mathrm{off}} P_1(n) - (\\alpha_0 + \\gamma n + k_{\\mathrm{on}}) P_0(n)\n$$\n$$\n0 = \\alpha_1 P_1(n-1) + \\gamma (n+1) P_1(n+1) + k_{\\mathrm{on}} P_0(n) - (\\alpha_1 + \\gamma n + k_{\\mathrm{off}}) P_1(n)\n$$\n其中约定当 $n=0$ 时，$P_i(n-1)=0$。我们分析两种指定的极限机制。\n\n**1. 快速切换机制：$k_{\\mathrm{on}}, k_{\\mathrm{off}} \\to \\infty$ 且 $p = \\frac{k_{\\mathrm{on}}}{k_{\\mathrm{on}} + k_{\\mathrm{off}}}$ 保持不变。**\n\n在此极限下，启动子切换的时间尺度（约为 $(k_{\\mathrm{on}} + k_{\\mathrm{off}})^{-1}$）远小于 mRNA 合成和降解的时间尺度（分别约为 $\\alpha_i^{-1}$ 和 $\\gamma^{-1}$）。因此，相对于 mRNA 拷贝数的任何变化，启动子状态几乎瞬时达到平衡。启动子快速地对其稳态分布进行采样，该分布由 $P(s=0) = 1-p$ 和 $P(s=1) = p$ 给出。\n\n从较慢的 mRNA 动力学角度看，有效合成速率是两个速率 $\\alpha_0$ 和 $\\alpha_1$ 的加权平均，权重为启动子处于相应状态的概率。这个有效速率 $\\langle\\alpha\\rangle$ 是一个常数：\n$$\n\\langle\\alpha\\rangle = \\alpha_0 P(s=0) + \\alpha_1 P(s=1) = \\alpha_0 (1-p) + \\alpha_1 p\n$$\n因此，mRNA 数量 $n$ 的系统动力学简化为一个简单的生灭过程，其生成速率为常数 $\\langle\\alpha\\rangle$，消亡速率为状态依赖的 $\\gamma n$。该有效过程的稳态主方程为：\n$$\n0 = \\langle\\alpha\\rangle P(n-1) + \\gamma(n+1)P(n+1) - (\\langle\\alpha\\rangle + \\gamma n)P(n)\n$$\n该方程意味着在稳态下存在细致平衡条件：$\\langle\\alpha\\rangle P(n-1) = \\gamma n P(n)$。通过递推，我们得到：\n$$\nP(n) = \\frac{\\langle\\alpha\\rangle}{\\gamma n} P(n-1) = \\frac{(\\langle\\alpha\\rangle/\\gamma)^n}{n!} P(0)\n$$\n归一化条件 $\\sum_{n=0}^\\infty P(n) = 1$ 要求 $P(0) \\sum_{n=0}^\\infty \\frac{(\\langle\\alpha\\rangle/\\gamma)^n}{n!} = P(0)\\exp(\\langle\\alpha\\rangle/\\gamma) = 1$。因此，稳态分布是泊松分布：\n$$\nP(n) = \\frac{(\\langle\\alpha\\rangle/\\gamma)^n}{n!} \\exp\\left(-\\frac{\\langle\\alpha\\rangle}{\\gamma}\\right)\n$$\n对于参数为 $\\lambda = \\langle\\alpha\\rangle/\\gamma$ 的泊松分布，其均值和方差均等于 $\\lambda$。\n$$\n\\mathbb{E}[n] = \\frac{\\langle\\alpha\\rangle}{\\gamma} = \\frac{\\alpha_0(1-p) + \\alpha_1 p}{\\gamma}\n$$\n$$\n\\mathrm{Var}[n] = \\frac{\\langle\\alpha\\rangle}{\\gamma} = \\frac{\\alpha_0(1-p) + \\alpha_1 p}{\\gamma}\n$$\n因此，在快速切换极限下的法诺因子 $F_{\\mathrm{fast}}$ 为：\n$$\nF_{\\mathrm{fast}} = \\frac{\\mathrm{Var}[n]}{\\mathbb{E}[n]} = 1\n$$\n\n**2. 慢速切换机制：$k_{\\mathrm{on}}, k_{\\mathrm{off}} \\to 0$ 且 $p$ 保持不变，同时 $\\gamma$ 远大于切换速率。**\n\n在此极限下，与 mRNA 分子的寿命 $\\gamma^{-1}$ 相比，启动子切换事件非常罕见。这意味着对于给定的启动子状态（0 或 1），在启动子状态改变之前，mRNA 拷贝数有足够的时间达到其自身的条件稳态分布。因此，总的稳态 mRNA 分布是这两个条件分布的混合。\n\n令 $\\pi_i(n)$ 为在启动子处于状态 $i \\in \\{0, 1\\}$ 条件下的稳态 mRNA 分布。\n- 若 $s=0$，mRNA 动力学是一个生成速率为 $\\alpha_0$、消亡速率为 $\\gamma n$ 的生灭过程。如前所示，其稳态分布 $\\pi_0(n)$ 是均值为 $\\lambda_0 = \\alpha_0/\\gamma$ 的泊松分布。\n- 若 $s=1$，mRNA 动力学是一个生成速率为 $\\alpha_1$、消亡速率为 $\\gamma n$ 的生灭过程。其稳态分布 $\\pi_1(n)$ 是均值为 $\\lambda_1 = \\alpha_1/\\gamma$ 的泊松分布。\n\n总的稳态分布 $P(n)$ 是这两个泊松分布的加权平均，权重是启动子状态的稳态概率 $1-p$ 和 $p$：\n$$\nP(n) = (1-p) \\pi_0(n) + p \\pi_1(n)\n$$\n为了求得法诺因子 $F_{\\mathrm{slow}}$，我们必须计算这个混合分布的均值和方差。令启动子状态 $S$ 为一个随机变量，取值为 $\\{0, 1\\}$，其概率为 $\\{1-p, p\\}$。\n\n均值 $\\mathbb{E}[n]$ 是条件均值的期望：\n$$\n\\mathbb{E}[n] = \\mathbb{E}[\\mathbb{E}[n|S]] = (1-p)\\mathbb{E}[n|S=0] + p\\mathbb{E}[n|S=1] = (1-p) \\lambda_0 + p \\lambda_1\n$$\n$$\n\\mathbb{E}[n] = (1-p)\\frac{\\alpha_0}{\\gamma} + p\\frac{\\alpha_1}{\\gamma} = \\frac{\\alpha_0(1-p)+\\alpha_1 p}{\\gamma}\n$$\n方差 $\\mathrm{Var}[n]$ 由全方差公式给出：\n$$\n\\mathrm{Var}[n] = \\mathbb{E}[\\mathrm{Var}[n|S]] + \\mathrm{Var}[\\mathbb{E}[n|S]]\n$$\n第一项是条件方差的期望。由于条件分布是泊松分布，它们的方差等于其均值：$\\mathrm{Var}[n|S=i] = \\lambda_i$。\n$$\n\\mathbb{E}[\\mathrm{Var}[n|S]] = (1-p)\\mathrm{Var}[n|S=0] + p\\mathrm{Var}[n|S=1] = (1-p)\\lambda_0 + p\\lambda_1 = \\mathbb{E}[n]\n$$\n第二项是条件均值的方差。随机变量 $\\mathbb{E}[n|S]$ 以概率 $1-p$ 取值 $\\lambda_0$，以概率 $p$ 取值 $\\lambda_1$。其方差为：\n$$\n\\mathrm{Var}[\\mathbb{E}[n|S]] = \\mathbb{E}[(\\mathbb{E}[n|S])^2] - (\\mathbb{E}[\\mathbb{E}[n|S]])^2\n$$\n$$\n= \\left( (1-p)\\lambda_0^2 + p\\lambda_1^2 \\right) - \\left( (1-p)\\lambda_0 + p\\lambda_1 \\right)^2\n$$\n$$\n= (1-p)\\lambda_0^2 + p\\lambda_1^2 - \\left( (1-p)^2\\lambda_0^2 + p^2\\lambda_1^2 + 2p(1-p)\\lambda_0\\lambda_1 \\right)\n$$\n$$\n= ( (1-p)-(1-p)^2 )\\lambda_0^2 + (p-p^2)\\lambda_1^2 - 2p(1-p)\\lambda_0\\lambda_1\n$$\n$$\n= p(1-p)\\lambda_0^2 + p(1-p)\\lambda_1^2 - 2p(1-p)\\lambda_0\\lambda_1\n$$\n$$\n= p(1-p)(\\lambda_1 - \\lambda_0)^2 = p(1-p)\\left(\\frac{\\alpha_1}{\\gamma} - \\frac{\\alpha_0}{\\gamma}\\right)^2 = \\frac{p(1-p)(\\alpha_1 - \\alpha_0)^2}{\\gamma^2}\n$$\n合并各项，总方差为：\n$$\n\\mathrm{Var}[n] = \\mathbb{E}[n] + \\frac{p(1-p)(\\alpha_1 - \\alpha_0)^2}{\\gamma^2}\n$$\n慢速切换极限下的法诺因子 $F_{\\mathrm{slow}}$ 为：\n$$\nF_{\\mathrm{slow}} = \\frac{\\mathrm{Var}[n]}{\\mathbb{E}[n]} = \\frac{\\mathbb{E}[n] + \\frac{p(1-p)(\\alpha_1 - \\alpha_0)^2}{\\gamma^2}}{\\mathbb{E}[n]} = 1 + \\frac{p(1-p)(\\alpha_1 - \\alpha_0)^2}{\\gamma^2 \\mathbb{E}[n]}\n$$\n代入 $\\mathbb{E}[n]$ 的表达式：\n$$\nF_{\\mathrm{slow}} = 1 + \\frac{p(1-p)(\\alpha_1 - \\alpha_0)^2}{\\gamma^2 \\left(\\frac{\\alpha_0(1-p)+\\alpha_1 p}{\\gamma}\\right)} = 1 + \\frac{p(1-p)(\\alpha_1 - \\alpha_0)^2}{\\gamma(\\alpha_0(1-p)+\\alpha_1 p)}\n$$\n该表达式包含内在噪声项 $1$（来自泊松生灭过程）和一个由不同生产速率间的慢速切换引起的外在噪声项。\n\n所需的两个表达式为 $F_{\\mathrm{fast}} = 1$ 和 $F_{\\mathrm{slow}} = 1 + \\frac{p(1-p)(\\alpha_1 - \\alpha_0)^2}{\\gamma(\\alpha_0(1-p)+\\alpha_1 p)}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  1 + \\frac{p(1-p)(\\alpha_1 - \\alpha_0)^2}{\\gamma (\\alpha_0(1-p) + \\alpha_1 p)}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "建模的最终目标通常是利用实验数据来解释和量化真实的生物现象。这最后一个练习将参数估计问题构建为隐马尔可夫模型（Hidden Markov Model）的统计推断问题，从而在我们理论模型与观测数据之间架起一座桥梁。你将推导一个期望最大化（Expectation-Maximization, EM）算法，从模拟的转录活动时间序列中推断潜在的启动子切换和转录速率，这项技术被广泛用于分析单细胞实验数据。",
            "id": "3932244",
            "problem": "考虑一个单个基因，其启动子作为一个两状态连续时间马尔可夫链 (CTMC)，在失活状态 $s(t)=0$ 和激活状态 $s(t)=1$ 之间切换。从 $0 \\to 1$ 的转换速率为 $k_{\\text{on}}$，从 $1 \\to 0$ 的转换速率为 $k_{\\text{off}}$。其生成元矩阵为\n$$\n\\mathbf{Q} \\;=\\; \\begin{pmatrix}\n- k_{\\text{on}}  k_{\\text{on}} \\\\\nk_{\\text{off}}  - k_{\\text{off}}\n\\end{pmatrix}.\n$$\n一个实时追踪实验在离散时间点 $\\{t_i\\}_{i=0}^{T}$ 记录了新生转录计数的单细胞轨迹 $\\{y_i\\}_{i=0}^{T}$，采样间隔为恒定的 $\\Delta t = t_{i+1}-t_i$。以启动子状态 $s(t)$ 在每个采样间隔上是分段常数为条件，在 $[t_i, t_{i+1})$ 上累积的起始事件数 $y_i$ 被建模为一个泊松随机变量，其均值为 $(\\alpha\\, s_i + \\beta)\\, \\Delta t$，其中 $s_i \\in \\{0,1\\}$ 表示在时间 $t_i$ 的启动子状态，$\\alpha$ 是启动子激活时的转录起始速率，$\\beta0$ 是一个已知的背景速率，用于捕捉基线测量噪声和非特异性事件。假设初始启动子状态分布等于当前速率导出的平稳分布，并在观测时间之间使用 CTMC 转移核 $\\mathbf{P}(\\Delta t) = \\exp(\\mathbf{Q} \\Delta t)$。\n\n从 CTMC、泊松计数模型以及隐马尔可夫模型中不完整数据似然的概念出发，完成以下任务：\n\n1.  在指定的泊松发射模型下，为在离散时间观测到的 CTMC 编写观测数据似然 $L(k_{\\text{on}}, k_{\\text{off}}, \\alpha \\mid y_0,\\dots,y_T)$，并将其表示为对所有潜在启动子状态路径的求和，该求和可以分解为各个采样间隔上的转移和发射贡献。\n\n2.  推导一个期望最大化 (EM) 算法（Expectation-Maximization (EM)）来推断 $k_{\\text{on}}$、$k_{\\text{off}}$ 和 $\\alpha$。在 E 步中，使用带有 $\\mathbf{P}(\\Delta t)$ 的前向-后向递归，定义潜在状态和观测时间之间的转移所需的后验量。在 M 步中，关于 $k_{\\text{on}}$、$k_{\\text{off}}$ 和 $\\alpha$ 最大化期望完整数据对数似然。\n\n3.  用 E 步的后验概率 $\\gamma_i(s)$ 和 $\\xi_i(a,b)$ 来表示 M 步对 $k_{\\text{on}}$、$k_{\\text{off}}$ 和 $\\alpha$ 更新的显式闭式表达式，其中 $\\gamma_i(s)$ 是 $s_i=s$ 的后验概率，$\\xi_i(a,b)$ 是从 $s_i=a$ 到 $s_{i+1}=b$ 的转移的后验概率。将最终答案表示为解析表达式。无需四舍五入，也无需进行数值计算。\n\n您的最终答案必须是单个解析表达式或包含 $k_{\\text{on}}$、$k_{\\text{off}}$ 和 $\\alpha$ 更新公式的行矩阵。",
            "solution": "用户希望我解决一个基因表达随机建模领域的问题。我将首先验证问题陈述，然后提供分步解答。\n\n### 第1步：提取已知条件\n- **潜在过程**：一个用于启动子状态 $s(t) \\in \\{0, 1\\}$（失活/激活）的两状态连续时间马尔可夫链 (CTMC)。\n- **生成元矩阵**：$\\mathbf{Q} = \\begin{pmatrix} -k_{\\text{on}}  k_{\\text{on}} \\\\ k_{\\text{off}}  -k_{\\text{off}} \\end{pmatrix}$，其中 $k_{\\text{on}}$ 是从状态0转换到1的速率，$k_{\\text{off}}$ 是从状态1转换到0的速率。\n- **观测值**：一个实时追踪实验在离散时间点 $\\{t_i\\}_{i=0}^{T}$ 记录了新生转录计数 $\\{y_i\\}_{i=0}^{T}$。\n- **采样间隔**：观测之间的时间是恒定的，$\\Delta t = t_{i+1} - t_i$。\n- **发射模型**：在区间 $[t_i, t_{i+1})$ 上累积的计数 $y_i$ 是一个泊松随机变量，$y_i \\sim \\text{Pois}((\\alpha s_i + \\beta)\\Delta t)$，其中 $s_i$ 是在时间 $t_i$ 的启动子状态。\n- **模型参数**：$\\alpha$ 是激活启动子的转录起始速率。$\\beta  0$ 是一个已知的背景速率。待推断的参数是 $\\theta = \\{k_{\\text{on}}, k_{\\text{off}}, \\alpha\\}$。\n- **初始条件**：初始启动子状态 $s_0$ 从 CTMC 的平稳分布中抽取。\n- **转移模型**：观测之间的转移概率矩阵是 $\\mathbf{P}(\\Delta t) = \\exp(\\mathbf{Q} \\Delta t)$。\n- **任务**：\n  1. 编写观测数据似然 $L(k_{\\text{on}}, k_{\\text{off}}, \\alpha \\mid y_0, \\dots, y_T)$。\n  2. 推导一个期望最大化 (EM) 算法来推断参数。定义 E 步的后验概率。\n  3. 提供 M 步对 $k_{\\text{on}}$、$k_{\\text{off}}$ 和 $\\alpha$ 更新的显式闭式表达式，用后验概率 $\\gamma_i(s)$ 和 $\\xi_i(a,b)$ 表示。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据**：该问题描述了一个应用于基因表达的隐马尔可夫模型 (HMM)，这是系统生物学中一个标准且成熟的框架。建模选择（两状态启动子、CTMC 动态、泊松发射）在该领域是经典的。\n- **适定性**：该问题是一个标准的 HMM 参数估计任务。它要求推导似然和一个 EM 算法，这些都是定义明确的统计程序。\n- **客观性**：该问题使用精确的数学语言陈述，没有主观或模糊的论断。\n- **完整性**：所有必要的组成部分都已提供：潜在过程模型、观测模型、它们之间的关系、用于推断的参数以及数据结构。\n- **可行性**：所要求的推导在 HMM 文献中是标准的，并且在数学上是可处理的。\n\n### 第3步：结论与行动\n该问题有效。它科学合理、适定且完整。我现在将开始解答。\n\n### 第1部分：观测数据似然\n\n该系统是一个隐马尔可夫模型 (HMM)，其中潜在（未观测）状态是启动子状态 $S = (s_0, s_1, \\dots, s_T)$，其中 $s_i \\in \\{0, 1\\}$，观测值是转录计数 $Y = (y_0, y_1, \\dots, y_T)$。待估计的参数是 $\\theta = (k_{\\text{on}}, k_{\\text{off}}, \\alpha)$。\n\n观测数据似然 $L(\\theta \\mid Y)$ 是给定参数下观测值的概率，通过对所有可能的潜在状态序列进行边缘化得到：\n$$\nL(\\theta \\mid Y) = P(Y \\mid \\theta) = \\sum_{s_0, \\dots, s_T \\in \\{0,1\\}} P(Y, S \\mid \\theta)\n$$\n根据 HMM 的性质，联合概率 $P(Y, S \\mid \\theta)$ 可以分解为来自初始状态、状态转移和发射的贡献：\n$$\nP(Y, S \\mid \\theta) = P(s_0 \\mid \\theta) \\left( \\prod_{i=0}^{T-1} P(s_{i+1} \\mid s_i, \\theta) \\right) \\left( \\prod_{i=0}^{T} P(y_i \\mid s_i, \\theta) \\right)\n$$\n我们来定义每一项：\n1.  **初始状态概率**：$P(s_0 \\mid \\theta) = \\pi_{s_0}$。问题陈述这部分是 CTMC 的平稳分布。平稳分布 $\\pi = (\\pi_0, \\pi_1)$ 满足 $\\pi \\mathbf{Q} = \\mathbf{0}$，可得 $\\pi_0 = \\frac{k_{\\text{off}}}{k_{\\text{on}} + k_{\\text{off}}}$ 和 $\\pi_1 = \\frac{k_{\\text{on}}}{k_{\\text{on}} + k_{\\text{off}}}$。\n\n2.  **转移概率**：$P(s_{i+1}=b \\mid s_i=a, \\theta) = P_{ab}(\\Delta t)$。这些是矩阵 $\\mathbf{P}(\\Delta t) = \\exp(\\mathbf{Q}\\Delta t)$ 的元素。\n\n3.  **发射概率**：$P(y_i \\mid s_i, \\theta) = b_{s_i}(y_i)$。这由泊松分布给出：\n    $$\n    b_s(y_i) = P(y_i \\mid s_i=s) = \\frac{((\\alpha s + \\beta)\\Delta t)^{y_i}}{y_i!} \\exp(-(\\alpha s + \\beta)\\Delta t)\n    $$\n\n代入这些分量，观测数据似然为：\n$$\nL(k_{\\text{on}}, k_{\\text{off}}, \\alpha \\mid Y) = \\sum_{s_0, \\dots, s_T \\in \\{0,1\\}} \\pi_{s_0} \\left( \\prod_{i=0}^{T-1} P_{s_i, s_{i+1}}(\\Delta t) \\right) \\left( \\prod_{i=0}^{T} \\frac{((\\alpha s_i + \\beta)\\Delta t)^{y_i}}{y_i!} \\exp(-(\\alpha s_i + \\beta)\\Delta t) \\right)\n$$\n该表达式对 $2^{T+1}$ 种可能的潜在状态路径求和，将每条路径的贡献分解为每个时间步的初始、转移和发射概率。\n\n### 第2部分：期望最大化 (EM) 算法推导\n\nEM 算法是找到 $\\theta$ 的最大似然估计的迭代过程。每次迭代包括一个期望 (E) 步和一个最大化 (M) 步。设 $\\theta^{(k)}$ 是第 $k$ 次迭代的参数估计值。\n\n**E步：计算Q函数**\n\nE步涉及计算完整数据对数似然 $\\log P(Y, S \\mid \\theta)$ 的期望，该期望是关于给定观测数据和当前参数下潜在状态的后验分布 $P(S \\mid Y, \\theta^{(k)})$ 计算的。这个期望就是 Q 函数：\n$$\nQ(\\theta \\mid \\theta^{(k)}) = E_{S \\mid Y, \\theta^{(k)}}[\\log P(Y, S \\mid \\theta)]\n$$\n完整数据对数似然为：\n$$\n\\log P(Y, S \\mid \\theta) = \\log \\pi_{s_0} + \\sum_{i=0}^{T-1} \\log P_{s_i, s_{i+1}}(\\Delta t) + \\sum_{i=0}^{T} \\log b_{s_i}(y_i)\n$$\n取期望，我们得到：\n$$\nQ(\\theta \\mid \\theta^{(k)}) = \\sum_{s_0, \\dots, s_T} P(S \\mid Y, \\theta^{(k)}) \\left[ \\log \\pi_{s_0} + \\sum_{i=0}^{T-1} \\log P_{s_i, s_{i+1}}(\\Delta t) + \\sum_{i=0}^{T} \\log b_{s_i}(y_i) \\right]\n$$\n根据期望的线性性质，这可以简化。我们需要两种类型的后验概率：\n-   $\\gamma_i(s) = P(s_i=s \\mid Y, \\theta^{(k)})$：在时间 $t_i$ 处于状态 $s$ 的后验概率。\n-   $\\xi_i(a,b) = P(s_i=a, s_{i+1}=b \\mid Y, \\theta^{(k)})$：在 $t_i$ 从状态 $a$ 转移到 $t_{i+1}$ 状态 $b$ 的后验概率。\n\nQ 函数可以用这些后验概率写成：\n$$\nQ(\\theta \\mid \\theta^{(k)}) = \\sum_{s=0,1} \\gamma_0(s) \\log \\pi_s + \\sum_{i=0}^{T-1} \\sum_{a,b \\in \\{0,1\\}} \\xi_i(a,b) \\log P_{ab}(\\Delta t) + \\sum_{i=0}^{T} \\sum_{s=0,1} \\gamma_i(s) \\log b_s(y_i)\n$$\n后验概率 $\\gamma_i(s)$ 和 $\\xi_i(a,b)$ 使用**前向-后向算法**计算。设 $\\theta^{(k)}$ 是当前参数。发射概率 $b_s(y_i)$ 和转移概率 $P_{ab}(\\Delta t)$ 在 $\\theta^{(k)}$ 处求值。\n1.  **前向传递**：计算 $\\phi_i(s) = P(y_0, \\dots, y_i, s_i=s \\mid \\theta^{(k)})$。\n    -   初始化：$\\phi_0(s) = \\pi_s^{(k)} b_s(y_0)$。\n    -   递归 ($i=0, \\dots, T-1$)：$\\phi_{i+1}(s') = \\left( \\sum_{s=0,1} \\phi_i(s) P_{s,s'}^{(k)}(\\Delta t) \\right) b_{s'}(y_{i+1})$。\n\n2.  **后向传递**：计算 $\\psi_i(s) = P(y_{i+1}, \\dots, y_T \\mid s_i=s, \\theta^{(k)})$。\n    -   初始化：$\\psi_T(s) = 1$。\n    -   递归 ($i=T-1, \\dots, 0$)：$\\psi_i(s) = \\sum_{s'=0,1} P_{s,s'}^{(k)}(\\Delta t) b_{s'}(y_{i+1}) \\psi_{i+1}(s')$。\n\n3.  **后验概率**：\n    -   数据的似然是 $L(Y \\mid \\theta^{(k)}) = \\sum_{s=0,1} \\phi_T(s)$。\n    -   $\\gamma_i(s) = \\frac{\\phi_i(s)\\psi_i(s)}{L(Y \\mid \\theta^{(k)})}$。\n    -   $\\xi_i(a,b) = \\frac{\\phi_i(a) P_{a,b}^{(k)}(\\Delta t) b_b(y_{i+1}) \\psi_{i+1}(b)}{L(Y \\mid \\theta^{(k)})}$。\n\n**M步：最大化Q函数**\n\nM步通过最大化 $Q(\\theta \\mid \\theta^{(k)})$ 关于 $\\theta = (k_{\\text{on}}, k_{\\text{off}}, \\alpha)$ 来找到新的参数估计值 $\\theta^{(k+1)}$。Q函数可以分离为转移动态项和发射过程项。\n\n### 第3部分：M步闭式更新表达式\n\n**$\\alpha$的更新**\n\n我们最大化Q函数中依赖于 $\\alpha$ 的部分，即发射项：\n$$\nQ_{em}(\\alpha) = \\sum_{i=0}^{T} \\sum_{s=0,1} \\gamma_i(s) \\log b_s(y_i)\n$$\n$$\nQ_{em}(\\alpha) = \\sum_{i=0}^{T} \\left( \\gamma_i(0) \\left[ y_i\\log(\\beta \\Delta t) - \\beta \\Delta t \\right] + \\gamma_i(1) \\left[ y_i\\log((\\alpha+\\beta)\\Delta t) - (\\alpha+\\beta)\\Delta t \\right] \\right) - \\sum_{i=0}^T\\sum_{s=0,1}\\gamma_i(s)\\log(y_i!)\n$$\n为求最大值，我们对 $\\alpha$ 求导并令结果为零。只有 $s=1$ 的项依赖于 $\\alpha$：\n$$\n\\frac{\\partial Q_{em}}{\\partial \\alpha} = \\sum_{i=0}^{T} \\gamma_i(1) \\left[ \\frac{\\partial}{\\partial \\alpha} \\left( y_i \\log(\\alpha+\\beta) + y_i\\log(\\Delta t) - (\\alpha+\\beta)\\Delta t \\right) \\right] = 0\n$$\n$$\n\\sum_{i=0}^{T} \\gamma_i(1) \\left( \\frac{y_i}{\\alpha+\\beta} - \\Delta t \\right) = 0\n$$\n解出 $\\alpha$：\n$$\n\\frac{1}{\\alpha+\\beta} \\sum_{i=0}^{T} y_i \\gamma_i(1) = \\Delta t \\sum_{i=0}^{T} \\gamma_i(1)\n$$\n$$\n\\alpha+\\beta = \\frac{\\sum_{i=0}^{T} y_i \\gamma_i(1)}{\\Delta t \\sum_{i=0}^{T} \\gamma_i(1)}\n$$\n$\\alpha$ 的 M 步更新为：\n$$\n\\alpha^{(k+1)} = \\frac{\\sum_{i=0}^{T} y_i \\gamma_i(1)}{\\Delta t \\sum_{i=0}^{T} \\gamma_i(1)} - \\beta\n$$\n\n**$k_{\\text{on}}$ 和 $k_{\\text{off}}$的更新**\n\n直接最大化Q函数中与转移相关的部分很复杂，因为 $P_{ab}(\\Delta t)$ 是 $k_{\\text{on}}$ 和 $k_{\\text{off}}$ 的复杂函数。一个标准的方法是首先像在标准 HMM 中那样，找到离散时间转移矩阵 $\\mathbf{P}$ 的 M 步更新，然后确定与这个估计矩阵在区间 $\\Delta t$ 上一致的 CTMC 速率 $(k_{\\text{on}}, k_{\\text{off}})$。\n\n1.  **估计转移矩阵 $\\mathbf{P}$**：一个通用 HMM 转移概率 $P_{ab}$ 的更新是，从 $a$ 到 $b$ 的期望转移次数除以处于状态 $a$（可以发生转移）的期望次数。\n    $$\n    \\hat{P}_{ab} = \\frac{\\sum_{i=0}^{T-1} \\xi_i(a,b)}{\\sum_{i=0}^{T-1} \\gamma_i(a)}\n    $$\n    这给出了更新后的转移矩阵 $\\mathbf{P}^{(k+1)}$ 的非对角线元素 $\\hat{P}_{01}$ 和 $\\hat{P}_{10}$ 的估计值。\n\n2.  **关联 $\\mathbf{P}$ 与 $\\mathbf{Q}$**：一个两状态 CTMC 的转移矩阵的特征值为 $\\lambda_1=1$ 和 $\\lambda_2 = \\exp(-(k_{\\text{on}}+k_{\\text{off}})\\Delta t)$。矩阵的迹为 $\\text{Tr}(\\mathbf{P}) = \\lambda_1 + \\lambda_2 = 1+\\lambda_2$。\n    同时，$\\text{Tr}(\\mathbf{P}) = P_{00}+P_{11} = (1-P_{01}) + (1-P_{10}) = 2 - P_{01} - P_{10}$。\n    令两者相等可得 $\\lambda_2 = 1 - P_{01} - P_{10}$。代入 $\\lambda_2$ 的表达式：\n    $$\n    \\exp(-(k_{\\text{on}}+k_{\\text{off}})\\Delta t) = 1 - P_{01} - P_{10}\n    $$\n    取自然对数并解出速率之和：\n    $$\n    k_{\\text{on}}+k_{\\text{off}} = -\\frac{1}{\\Delta t} \\ln(1 - P_{01} - P_{10})\n    $$\n    此外，$\\mathbf{P}(\\Delta t) = \\mathbf{\\pi} + e^{\\lambda_2 \\Delta t}(\\mathbf{I}-\\mathbf{\\pi})$ 的非对角线元素给出了关系 $\\frac{P_{01}}{P_{10}} = \\frac{\\pi_1}{\\pi_0} = \\frac{k_{\\text{on}}}{k_{\\text{off}}}$。\n\n3.  **解出 $k_{\\text{on}}$ 和 $k_{\\text{off}}$**：我们有一个关于 $k_{\\text{on}}$ 和 $k_{\\text{off}}$ 的二元线性方程组：\n    $$\n    \\begin{cases} k_{\\text{on}} + k_{\\text{off}} = S \\\\ k_{\\text{on}}/k_{\\text{off}} = R \\end{cases}\n    $$\n    其中 $S = -\\frac{1}{\\Delta t} \\ln(1 - \\hat{P}_{01} - \\hat{P}_{10})$ 且 $R = \\hat{P}_{01}/\\hat{P}_{10}$。\n    解此方程组得：\n    $$ k_{\\text{on}} = S \\frac{R}{R+1} = S \\frac{\\hat{P}_{01}/\\hat{P}_{10}}{\\hat{P}_{01}/\\hat{P}_{10}+1} = S \\frac{\\hat{P}_{01}}{\\hat{P}_{01}+\\hat{P}_{10}} $$\n    $$ k_{\\text{off}} = S \\frac{1}{R+1} = S \\frac{\\hat{P}_{10}}{\\hat{P}_{01}+\\hat{P}_{10}} $$\n    将 $S$ 代回，并使用第1步中的 $\\hat{P}_{ab}$，我们得到 M 步更新：\n    $$\n    k_{\\text{on}}^{(k+1)} = \\left( -\\frac{1}{\\Delta t} \\ln\\left(1 - \\frac{\\sum \\xi_i(0,1)}{\\sum \\gamma_i(0)} - \\frac{\\sum \\xi_i(1,0)}{\\sum \\gamma_i(1)}\\right) \\right) \\frac{\\frac{\\sum \\xi_i(0,1)}{\\sum \\gamma_i(0)}}{\\frac{\\sum \\xi_i(0,1)}{\\sum \\gamma_i(0)} + \\frac{\\sum \\xi_i(1,0)}{\\sum \\gamma_i(1)}}\n    $$\n    $$\n    k_{\\text{off}}^{(k+1)} = \\left( -\\frac{1}{\\Delta t} \\ln\\left(1 - \\frac{\\sum \\xi_i(0,1)}{\\sum \\gamma_i(0)} - \\frac{\\sum \\xi_i(1,0)}{\\sum \\gamma_i(1)}\\right) \\right) \\frac{\\frac{\\sum \\xi_i(1,0)}{\\sum \\gamma_i(1)}}{\\frac{\\sum \\xi_i(0,1)}{\\sum \\gamma_i(0)} + \\frac{\\sum \\xi_i(1,0)}{\\sum \\gamma_i(1)}}\n    $$\n    其中所有求和都是从 $i=0$ 到 $T-1$。\n\n为使最终答案简洁，我们定义 $\\hat{P}_{01} = \\frac{\\sum_{i=0}^{T-1} \\xi_i(0,1)}{\\sum_{i=0}^{T-1} \\gamma_i(0)}$ 和 $\\hat{P}_{10} = \\frac{\\sum_{i=0}^{T-1} \\xi_i(1,0)}{\\sum_{i=0}^{T-1} \\gamma_i(1)}$。\n\n最终的更新规则是：\n-   $k_{\\text{on}}^{(k+1)} = \\left( -\\frac{1}{\\Delta t} \\ln(1 - \\hat{P}_{01} - \\hat{P}_{10}) \\right) \\frac{\\hat{P}_{01}}{\\hat{P}_{01}+\\hat{P}_{10}}$\n-   $k_{\\text{off}}^{(k+1)} = \\left( -\\frac{1}{\\Delta t} \\ln(1 - \\hat{P}_{01} - \\hat{P}_{10}) \\right) \\frac{\\hat{P}_{10}}{\\hat{P}_{01}+\\hat{P}_{10}}$\n-   $\\alpha^{(k+1)} = \\frac{\\sum_{i=0}^{T} y_i \\gamma_i(1)}{\\Delta t \\sum_{i=0}^{T} \\gamma_i(1)} - \\beta$\n\n这些是所要求的闭式 M 步更新。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} -\\frac{\\ln(1 - \\hat{P}_{01} - \\hat{P}_{10})}{\\Delta t} \\frac{\\hat{P}_{01}}{\\hat{P}_{01}+\\hat{P}_{10}}  -\\frac{\\ln(1 - \\hat{P}_{01} - \\hat{P}_{10})}{\\Delta t} \\frac{\\hat{P}_{10}}{\\hat{P}_{01}+\\hat{P}_{10}}  \\frac{\\sum_{i=0}^{T} y_i \\gamma_i(1)}{\\Delta t \\sum_{i=0}^{T} \\gamma_i(1)} - \\beta \\end{pmatrix} \\text{，其中 } \\hat{P}_{01} = \\frac{\\sum_{i=0}^{T-1} \\xi_i(0,1)}{\\sum_{i=0}^{T-1} \\gamma_i(0)} \\text{ 且 } \\hat{P}_{10} = \\frac{\\sum_{i=0}^{T-1} \\xi_i(1,0)}{\\sum_{i=0}^{T-1} \\gamma_i(1)} } $$"
        }
    ]
}