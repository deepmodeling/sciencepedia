## 引言
在生物医学研究中，理解免疫系统如何对抗肿瘤、传染病如何在人群中传播等复杂现象，是科学家们面临的核心挑战。这些系统由大量异质性的个体（如细胞或人）组成，它们的局部相互作用和空间动态决定了整体的宏观行为。传统的数学模型，如[常微分方程](@entry_id:147024)，虽然在描述平均趋势方面很有价值，但往往难以捕捉这种个体[异质性](@entry_id:275678)、空间结构和随机性所带来的关键影响，从而在理解疾病的发生机制和评估干预措施方面存在知识鸿沟。

本文旨在系统性地介绍[基于主体的模型](@entry_id:199978)（Agent-Based Model, ABM）——一种强大的计算方法，它通过自下而上的方式模拟这些复杂系统。通过本文的学习，读者将全面掌握 ABM 的理论与实践，了解它如何成为连接计算、数据与生物学洞见的桥梁。

文章将分为三个核心部分。在第一章**“原理与机制”**中，我们将深入探讨 ABM 的基本构成，包括如何定义主体、设置规则，以及模拟增殖、运动和化学[信号传导](@entry_id:139819)等核心[生物过程](@entry_id:164026)。在第二章**“应用与跨学科联系”**中，我们将展示 ABM 如何在流行病学、肿瘤学和免疫学等前沿领域中解决实际问题，并揭示其与统计学、网络科学等学科的交叉融合。最后，在第三章**“动手实践”**中，读者将有机会通过具体练习，将理论知识转化为实际的建模技能。

## 原理与机制

### 定义主体与基于主体的范式

在生物医学系统的建模中，[基于主体的模型](@entry_id:199978)（Agent-Based Model, ABM）代表了一种自下而上的方法，它将系统视为由大量遵循简单规则的自主**主体（agent）**组成的集合。与传统的宏观模型（如[常微分方程组](@entry_id:907499)）不同，ABM 的核心在于模拟个体层面的行为和交互，并观察系统级的**[涌现现象](@entry_id:145138)（emergent phenomena）**。

一个主体，无论它代表一个细胞、一个个体还是一个组织，都是一个拥有内部状态、行为规则和环境感知能力的离散实体。要精确地定义一个生物医学 ABM 中的主体，我们必须详细说明其三个核心组成部分 ：

1.  **状态向量（State Vector）**：每个主体 $i$ 在时间 $t$ 的状态由一个向量 $\mathbf{x}_i(t)$ 描述。这个向量包含了主体的所有相关属性。例如，在模拟组织内[病原体传播](@entry_id:138852)的模型中，一个细胞主体的[状态向量](@entry_id:154607)可能包括：
    *   **空间位置** $\mathbf{r}_i(t) \in \Omega \subset \mathbb{R}^d$：主体在组织域 $\Omega$ 内的坐标。
    *   **分类状态** $s_i(t)$：一个描述其生物学状态的[离散变量](@entry_id:263628)，如 `{易感 (S), 感染 (I), 恢复 (R)}`。
    *   **内部参数** $\boldsymbol{\theta}_i(t) \in \mathbb{R}^p$：编码其他连续或离散属性的向量，如[免疫激活](@entry_id:203456)水平、表型参数、剩余生命周期等。
    主体的**[异质性](@entry_id:275678)（heterogeneity）**是 ABM 的一个关键特征，它体现在不同主体的[状态向量](@entry_id:154607)可以不同。

2.  **规则集（Rule Set）**：一套规定主体如何根据其内部状态、与其他主体的交互以及环境信号来更新其状态的规则。这些规则通常是局部的和随机的。例如：
    *   **移动**：主体的位置可以通过一个随机微分方程（SDE）来更新，如 $d\mathbf{r}_i = \mathbf{v}_i(\cdot) dt + \sqrt{2D_i(\cdot)} d\mathbf{W}_i(t)$，其中 $\mathbf{v}_i$ 是确定性速度（例如，由趋化性引起），而第二项代表随机布朗运动。
    *   **状态转变**：感染或恢复等事件可以被建模为泊松过程。例如，一个易感主体 $i$ 的感染风险（或称**风险率 (hazard rate)**）可能取决于其邻近的感染主体数量：$\lambda_i(t) = \beta \sum_{j \neq i: \|\mathbf{r}_i-\mathbf{r}_j\| \lt R} \mathbf{1}_{\{s_j(t)=I\}}$，其中 $R$ 是一个交互半径。这体现了**局部交互（local interactions）**的原则。

3.  **环境（Environment）**：主体存在和交互的上下文。环境可以是：
    *   **空间**：如一个代表组织的连续域或离散网格，包含边界条件。
    *   **网络**：一个定义主体之间谁可以与谁交互的接触网络 $G(t)$。
    *   **场**：如在空间中变化的[化学吸引](@entry_id:164213)物浓度场 $c(\mathbf{r}, t)$。

ABM 与**平均场（mean-field）**房室 ODE 模型（如经典的 SIR 模型）在根本上有所不同。ODE 模型假设**同质混合（homogeneous mixing）**，即群体中的每个个体与其他任何个体相遇的概率均等。这导致了基于[质量作用定律](@entry_id:916274)的确定性方程，如 $\frac{dI}{dt} = \beta S I - \gamma I$。这种模型描述的是各房室（compartment）中个体数量的平均期望行为，它无法自发地产生由局部交互和有限规模随机性驱动的现象，例如空间聚集、[逾渗](@entry_id:158786)样阈值或[随机灭绝](@entry_id:260849)。从数学上看，ODE 模型可以被视为 ABM 在特定假设（如[可交换性](@entry_id:909050)和[混沌传播](@entry_id:194216)）下，当主体数量 $N \to \infty$ 且忽略相关性时的极限 。因此，ABM 提供了一个更基础、更详细的微观视角，而 ODE 模型是其在特定条件下的宏观近似。

### 模拟基本的生物学过程

定义了主体的概念后，我们便可以利用它来构建各种生物学过程的模型。

#### [克隆扩增](@entry_id:916183)与灭绝：Galton-Watson 分支过程

最简单的 ABM 之一是用于模拟细胞群体（如肿瘤细胞或[淋巴细胞](@entry_id:185166)克隆）增殖的非空间模型。这种过程可以被理想化为一个**Galton-Watson [分支过程](@entry_id:150751)** 。

假设我们从一个祖先细胞开始（第 $0$ 代，$Z_0=1$）。在每一代，群体中的每个细胞独立地产生随机数量的子代，子代数量遵循一个共同的概率分布 $\{p_k\}$，其中 $p_k$ 是一个细胞产生 $k$ 个子代的概率。第 $n+1$ 代的群体大小 $Z_{n+1}$ 是第 $n$ 代所有 $Z_n$ 个细胞产生子代数量的总和：
$$
Z_{n+1} = \sum_{i=1}^{Z_n} X_{n,i}
$$
其中 $X_{n,i}$ 是第 $n$ 代第 $i$ 个细胞产生的子代数量，它们是[独立同分布](@entry_id:169067)的[随机变量](@entry_id:195330)。

该过程的[长期行为](@entry_id:192358)完全由**平均子代数** $\mu = \sum_{k=0}^{\infty} k p_k$ 决定。我们可以区分三种情况：
*   **亚临界（Subcritical）**：当 $\mu \lt 1$ 时，群体大小的[期望值](@entry_id:150961) $\mathbb{E}[Z_n] = \mu^n$ 会指数级衰减至零。群体[几乎必然](@entry_id:262518)会**灭绝（extinction）**。
*   **临界（Critical）**：当 $\mu = 1$ 时，期望群体大小恒为 $\mathbb{E}[Z_n] = 1$。尽管[期望值](@entry_id:150961)不变，但除非每个细胞都恰好产生一个后代（$p_1=1$），否则由于随机波动，群体最终仍会灭绝。
*   **超临界（Supercritical）**：当 $\mu \gt 1$ 时，期望群体大小 $\mathbb{E}[Z_n] = \mu^n$ 会指数级增长。在这种情况下，群体有一定概率存活并无限增长，但即使在这种有利条件下，由于早期随机事件，仍存在一个非零的[灭绝概率](@entry_id:270869) $q \lt 1$。

[灭绝概率](@entry_id:270869) $q$ 是子代分布的[概率生成函数](@entry_id:190573) $g(s) = \sum p_k s^k$ 的最小非负不动点，即方程 $g(q)=q$ 在 $[0,1]$ 区间内的最小解。如果 $\mu \le 1$，$q=1$；如果 $\mu \gt 1$，$q \lt 1$。这个简单的模型捕捉了随机增殖过程中的一个核心概念：即使平均增长率是有利的，小群体的[随机灭绝](@entry_id:260849)风险也始终存在。

#### 空间动态与运动

对于大多数生物医学应用，空间是至关重要的。主体的运动规则决定了它们如何探索环境和相互作用。

##### 基于网格的运动

最简单的空间模型将环境离散化为一个**网格（lattice）**，每个主体占据一个网格位点。主体的移动被限制在相邻的位点之间。邻居的定义至关重要，因为它决定了接触网络的拓扑结构。在二维方格网格上，两种常见的邻域定义是 ：
*   **[冯·诺依曼邻域](@entry_id:1133909)（von Neumann neighborhood）**：包括一个位点上、下、左、右四个正交相邻的位点。每个位点的**度（degree）**为 $k=4$。
*   **[摩尔邻域](@entry_id:1128159)（Moore neighborhood）**：包括[冯·诺依曼邻域](@entry_id:1133909)的四个位点，以及四个对角线相邻的位点，总共有 $k=8$ 个邻居。

邻域的选择直接影响局部接触率。例如，在[传染病模型](@entry_id:900624)中，如果一个感染主体在每个时间步以概率 $c$ 尝试接触其每个邻居，那么每个感染主体的期望接触尝试次数与度 $k$ 成正比，即 $kc$。因此，使用[摩尔邻域](@entry_id:1128159)会比[冯·诺依曼邻域](@entry_id:1133909)导致更高的局部接触率。

更重要的是，邻域定义了底层图的连通性，这深刻影响着大规模涌现现象，如**逾渗（percolation）**。在[传染病模型](@entry_id:900624)中，宏观暴发（即感染传播到整个系统）可以被映射为一个[键逾渗](@entry_id:150701)问题。只有当边的** transmissibility**（在整个感染期间，感染沿某条特定边成功传播的概率）$T$ 超过底层图的**键[逾渗阈值](@entry_id:146310)** $p_c^{\text{bond}}$ 时，才会发生宏观暴发。[摩尔邻域](@entry_id:1128159)图的连通性更高，因此其逾渗阈值低于冯·诺依mann邻域图。这意味着，在其他条件相同的情况下，使用[摩尔邻域](@entry_id:1128159)的模型更容易支持大规模的[疾病传播](@entry_id:170042) 。

##### 离格运动：[过阻尼](@entry_id:167953)动力学

虽然网格模型计算上很高效，但它们引入了人为的结构。**离格模型（off-lattice models）**允许主体在连续空间中移动，这在生物物理上更为真实。对于在[细胞外基质](@entry_id:136546)等粘性环境中移动的细胞，其运动通常处于**[过阻尼](@entry_id:167953)（overdamped）**状态，即惯性可以忽略不计，细胞的速度与其受到的总力成正比。这种运动可以用一个**[随机微分方程 (SDE)](@entry_id:263889)** 来描述 。

一个细胞 $i$ 的位置 $\mathbf{x}_i(t)$ 的变化由以下方程支配：
$$
d\mathbf{x}_i(t) = \mu \mathbf{F}_i^{\text{det}}(t) dt + \sqrt{2D} d\mathbf{W}_i(t)
$$
这个方程包含两部分：
1.  **漂移项（Drift）**：$\mu \mathbf{F}_i^{\text{det}}(t) dt$ 代表由确定性力 $\mathbf{F}_i^{\text{det}}$ 驱动的运动。$\mu$ 是细胞的**迁移率（mobility）**，它将力转换为速度。这些力可以来自趋化性梯度、细胞间的物理作用（如排斥或粘附）等。例如，细胞间的短程排斥力可以建模为 $F(r) = k (r_0 - r)_+$，其中 $r$ 是细胞间距，$r_0$ 是交互范围，$k$ 是刚度系数，而 $(a)_+ = \max(a,0)$。
2.  **扩散项（Diffusion）**：$\sqrt{2D} d\mathbf{W}_i(t)$ 代表由环境（如水分子的热碰撞）引起的热涨落驱动的随机运动。$D$ 是**扩散系数**，$d\mathbf{W}_i(t)$ 是一个标准[维纳过程](@entry_id:137696)的增量，它代表[高斯白噪声](@entry_id:749762)。

为了在计算机上模拟这个[连续时间过程](@entry_id:274437)，我们需要使用[数值积分方法](@entry_id:141406)。**欧拉-丸山（Euler-Maruyama）**方法是一种一阶方案，它将上述 SDE 在一个小的离散时间步长 $\Delta t$ 上近似为：
$$
\mathbf{x}_i(t + \Delta t) = \mathbf{x}_i(t) + \mu \mathbf{F}_i^{\text{det}}(t) \Delta t + \sqrt{2D \Delta t} \mathbf{Z}_i
$$
其中 $\mathbf{Z}_i$ 是一个从[标准正态分布](@entry_id:184509)（均值为 $0$，方差为 $1$）中抽取的随机向量。这个简单的更新规则结合了确定性的力和随机的“踢动”，为模拟连续空间中的细胞运动提供了坚实的基础。

### 模拟主体动力学：仿真引擎

一旦我们定义了模型的数学规则，就需要一个**仿真引擎（simulation engine）**来在计算机上执行这些规则并推进时间。选择正确的**调度策略（scheduling strategy）**对模型的准确性和[计算效率](@entry_id:270255)至关重要。

#### 事件驱动与时间驱动的模拟

对于主体状态变化（如感染、死亡、分裂）被建模为具有特定[风险率](@entry_id:266388)的随机事件的 ABM，主要有两种调度策略 ：

1.  **时间驱动调度（Time-Driven Scheduling）**：
    这种方法以一个固定的时间步长 $\Delta t$ 推进模拟时钟。在每个时间步，算法会遍历所有 $N$ 个主体。对于每个主体，它会根据其当前的风险率 $h_i$ 来计算在 $\Delta t$ 间隔内发生事件的概率（通常近似为 $p_i \approx h_i \Delta t$），然后通过一次随机抽样来决定事件是否发生。
    *   **优点**：实现简单，内存访问模式规则，易于并行化和[向量化](@entry_id:193244)，这在事件非常频繁的密集系统中可能带来性能优势 。
    *   **缺点**：这是一个近似方法，引入了**时间离散化偏差**。为了保持准确性，$\Delta t$ 必须远小于系统中最快事件的[平均等待时间](@entry_id:275427)（即 $1/h_{\max}$）。当系统中同时存在非常快和非常慢的事件时（即“僵硬”系统），这会导致模拟因为需要适应最快的事件而执行大量“空”更新（即检查事件但没有事件发生），从而变得非常低效。其计算成本大致与 $O(N \cdot T / \Delta t)$ 成正比，其中 $T$ 是总模拟时长。

2.  **事件驱动调度（Event-Driven Scheduling）**：
    这种方法将时间视为连续变量，并直接跳到下一个事件发生的时间。最著名的是 **Gillespie 算法**（或称[随机模拟算法](@entry_id:189454)，SSA）。其核心思想是：
    a. 在任意时刻 $t$，计算系统中所有可能事件的总风险率 $\Lambda(t) = \sum_j a_j(t)$，其中 $a_j$ 是第 $j$ 个**事件通道（event channel）**的**倾向（propensity）**或称总[风险率](@entry_id:266388) 。
    b. 从[指数分布](@entry_id:273894)中抽取下一个事件发生的等待时间 $\tau$，其速率参数为 $\Lambda(t)$。
    c. 将模拟时钟推进到 $t + \tau$。
    d. 选择具体发生的事件 $j$，其概率与该事件的倾向成正比，即 $P(j) = a_j(t) / \Lambda(t)$。
    e. 更新系统状态，并重新计算风险率。

    事件倾向的计算是关键。例如，在一个代表组织的[接触网络模型](@entry_id:897299)中，如果单个 $S-I$ 接触的感染率为 $\beta$，单个 $S$ 细胞的死亡率为 $d_S$，那么“感染”事件通道的总倾向为 $a_{\text{inf}} = \beta E_{SI}$（$E_{SI}$ 是 $S-I$ 边的总数），而“S细胞死亡”事件通道的总倾向为 $a_{d,S} = d_S N_S$（$N_S$ 是 $S$ 细胞的总数）。

    *   **优点**：这是一种**统计上精确**的方法，它生成的轨迹与底层的[连续时间马尔可夫链](@entry_id:267837)的真实轨迹具有相同的概率分布，没有离散化偏差。其计算成本与实际发生的事件数量成正比。这在事件稀疏或[速率异质性](@entry_id:149577)很强的系统中极为高效，因为它会跳过主体静默的漫长时间间隔 。
    *   **缺点**：实现更复杂。每次事件后都需要重新计算风险率。高效的实现（如 Next Reaction Method）通常需要使用[优先队列](@entry_id:263183)等数据结构来管理事件时间，这会给每个事件带来 $O(\log N)$ 的开销。

总而言之，当系统中事件稀疏时（即 $\int_0^T \Lambda(t) dt \ll N T / \Delta t$），[事件驱动模拟](@entry_id:1124697)在 CPU 效率上具有压倒性优势。相反，当系统非常密集，几乎每个主体在每个 $\Delta t$ 内都会经历事件时，时间驱动方法由于其更好的[缓存局部性](@entry_id:637831)和可[向量化](@entry_id:193244)性，可能表现更佳 。

### 复杂的相互作用：主体-场耦合

主体不仅可以直接相互作用，还可以通过改变共享环境来间接相互作用。一个典型的例子是细胞通过分泌和感知**细胞因子（cytokine）**等信号分子来进行通信，这一过程被称为**趋化性（chemotaxis）**。

#### [反应-扩散](@entry_id:137628)场

这种模型通常是**混合模型（hybrid models）**，它将代表细胞的离散主体与代表化学物质浓度的连续场耦合起来。[细胞因子](@entry_id:156485) $c(\mathbf{x}, t)$ 的浓度场通常由一个**反应-扩散[偏微分](@entry_id:194612)方程（PDE）**描述 ：
$$
\frac{\partial c}{\partial t} = D \nabla^2 c - \lambda c + S(\mathbf{x},t)
$$
这个方程体现了三个过程：
*   **扩散**：$D \nabla^2 c$ 项，其中 $D$ 是扩散系数，描述了分子因随机热运动而从高浓度区域向低浓度区域扩散的趋势，遵循**菲克定律（Fick's law）**。
*   **反应/衰变**：$-\lambda c$ 项，其中 $\lambda$ 是衰变速率，描述了分子被降解或被其他细胞消耗的过程。
*   **源**：$S(\mathbf{x},t)$ 项，代表[细胞因子](@entry_id:156485)由主体（例如，受刺激的免疫细胞）分泌产生。源项通常是所有主体贡献的总和，每个主体 $a$ 在其位置 $\mathbf{x}_a$ 附近产生一个局部分布（如高斯分布）。

要在计算机上求解这个 PDE，空间和时间都需要离散化。对于时间步进，[显式格式](@entry_id:1124773)（如前向欧拉法）简单但有严格的**稳定性限制**。例如，对于一个二维方格网格，显式格式要求扩散数 $r = \frac{D \Delta t}{\Delta x^2} \le \frac{1}{4}$。如果这个条件不满足，数值解就会发散。当 $D$ 很大或需要较大的 $\Delta t$ 时，通常必须使用**无条件稳定**的[隐式格式](@entry_id:166484)（如[后向欧拉法](@entry_id:139674)或 Crank-Nicolson 法）。

#### 梯度感知与趋化运动

主体通过**感知（sensing）**局部化学场并沿梯度方向运动来响应。
1.  **[梯度估计](@entry_id:164549)**：主体需要估计其所在位置的浓度梯度 $\nabla c$。在网格模型中，这可以通过**中心差分**等有限差分方法来近似。如果主体是离格的，则可能需要对周围网格点的值进行插值。
2.  **运动偏向**：然后，主体利用估计出的梯度来偏置其运动方向。一个鲁棒的方法是使用 **softmax 函数**来分配移动到相邻位点 $k$（方向为 $\mathbf{e}_k$）的概率 $p_k$：
    $$
    p_k = \frac{\exp(\beta \, \mathbf{e}_k \cdot \nabla c)}{\sum_{m} \exp(\beta \, \mathbf{e}_m \cdot \nabla c)}
    $$
    其中 $\beta > 0$ 是趋化敏感性参数。这个公式确保了概率总是正的且总和为一。当一个方向与梯度 $\nabla c$ 对齐时（$\mathbf{e}_k \cdot \nabla c > 0$），其概率会增加，从而使主体倾向于“爬上”浓度梯度。如果将公式中的 $\beta$ 替换为 $-\beta$，则会实现“滚下”梯度的趋化排斥行为 。

#### [时间尺度分离](@entry_id:149780)与模型简化

在许多生物系统中，场动力学（如细胞因子扩散）比主体动力学（如[细胞迁移](@entry_id:140200)）快得多。例如，小分子在组织中的扩散时间尺度可能是秒级，而细胞移动其自身直径的距离可能需要分钟级。这种**[时间尺度分离](@entry_id:149780)**为[模型简化](@entry_id:171175)提供了机会 。

当场动力学远快于主体运动时，我们可以应用**[准稳态近似](@entry_id:192906)（Quasi-Steady-State Approximation, QSSA）**。我们假设在细胞移动的 timescale 上，浓度场能够瞬时达到由当前细胞位置决定的平衡状态。这相当于在[反应-扩散方程](@entry_id:170319)中设置 $\frac{\partial c}{\partial t} \approx 0$，将其从一个抛物线型 PDE 简化为一个椭圆型 PDE：
$$
D \nabla^2 c - \lambda c + S(\mathbf{x},t) = 0
$$
这个方程不再需要时间步进；在每个模拟步骤中，给定当前的主体位置（即源项 $S$），可以直接求解得到该时刻的[稳态浓度](@entry_id:924461)场 $c(\mathbf{x})$。然后，主体根据这个[稳态](@entry_id:139253)场的梯度进行移动。

QSSA 显著降低了计算成本，因为它避免了为快速的场动力学进行精细的时间步进。然而，它的有效性取决于时间尺度的分离程度。当扩散系数 $D$ 很大时，场弛豫得很快，QSSA 是一个很好的近似。当 $D$ 较小，场动力学和细胞运动的时间尺度变得相当时，QSSA 的误差会增大，必须使用完整的瞬态耦合模型才能获得准确的结果 。

### 从模拟到洞见：分析与可重复性

运行 ABM 只是第一步。从模拟输出中提取科学洞见并确保结果的可靠性，需要严谨的分析方法和[实验设计](@entry_id:142447)。

#### 衡量流行病学指标

ABM 的一个强大用途是它们能夠生成详细的事件日志，这些日志类似于流行病学中的理想“完美”数据。我们可以利用这些日志来直接计算关键的流行病学参数 。
*   **生成间隔（Generation Interval）**：定义为一个感染者被感染到其感染下一个继发病例之间的时间差。在 ABM 中，由于我们精确知道“谁感染了谁”以及感染的精确时间，我们可以通过遍历所有传播对并计算其感染时间的差值来直接测量生成间隔的分布。
*   **序列间隔（Serial Interval）**：定义为原发病例出现症状到继发病例出现症状之间的时间差。这是生成间隔在现实世界中的可观测代理。同样，ABM 日志可以提供每个病例的症状出现时间，从而可以直接测量序列间隔。
*   **[基本再生数](@entry_id:893213)（Basic Reproduction Number, $R_0$）**：定义为一个典型的感染个体在完全易感人群中引入时，在其整个感染期内平均产生的继发病例数。要在 ABM 中测量 $R_0$，需要专门设计一个模拟实验：在初始种群完全易感的情况下，引入少数感染者，并计算这些早期感染者在其整个感染周期中产生的总感染数，然后取平均值。
*   **[有效再生数](@entry_id:894730)（Effective Reproduction Number, $R_t$）**：在时间 $t$ 的瞬时再生数，它考虑了人群中当前的易感性水平和干预措施。可以利用**[更新方程](@entry_id:264802)（renewal equation）**，结合从 ABM 中精确测量的发生率时间序列和生成间隔分布来估计 $R_t$。

#### 管理随机性与误差

ABM 的输出是随机的，并且可能受到数值误差的影响。确保结果的**[可重复性](@entry_id:194541)（reproducibility）**和**稳健性（robustness）**至关重要 。
*   **随机性的来源**：ABM 的随机性源于模型本身的随机规则（如随机运动、概率性状态转变）。这是一个需要被量化的真实特征。
*   **误差的来源**：数值误差源于模拟的近似，例如时间驱动调度中的离散化误差，或浮点运算的精度限制。
*   **[可重复性](@entry_id:194541)**：为了使模拟结果可重复，必须控制所有随机性来源。这要求使用一个高质量的[伪随机数生成器](@entry_id:145648)（PRNG），并为每次模拟运行（或每次复制）明确指定和记录**种子（seed）**。对于并发事件，必须有确定性的**平局决胜（tie-breaking）**规则。仅仅因为减少了时间步长 $\Delta t$ 并不能保证[可重复性](@entry_id:194541)；事件执行的顺序同样重要。重用相同的种子进行多次复制是错误的，因为它只会产生完全相同的轨迹，无法探索模型的随机行为。正确的方法是为每次复制使用来自 PRNG 的独立子流。

#### 模拟[实验设计](@entry_id:142447)

由于 ABM 的随机性，单次运行的结果意义不大。我们需要像进行真实的生物学实验一样，设计和分析模拟实验。
*   **复制（Replication）**：为了估计一个场景的平均行为（如平均肿瘤大小），必须进行多次独立的复制，并计算样本均值和置信区间。
*   **[样本量计算](@entry_id:270753)**：在进行大规模研究之前，通常需要根据[试点研究](@entry_id:172791)的结果来计算所需的复制次数。例如，要估计两种情景（如 A: 基线，B: [免疫疗法](@entry_id:150458)）的平均输出之差 $\mu_A - \mu_B$，[置信区间](@entry_id:142297)的半宽度 $h$ 由 $h = z_{1-\alpha/2} \sqrt{\text{Var}(\bar{Y}_A - \bar{Y}_B)}$ 决定。对于独立抽样，所需[样本量](@entry_id:910360) $n$（每个情景）为 $n = \left(\frac{z_{1-\alpha/2}}{h}\right)^2 (\sigma_A^2 + \sigma_B^2)$。我们可以用[试点研究](@entry_id:172791)的样本方差来估计 $\sigma_A^2$ 和 $\sigma_B^2$ 。

*   **[方差缩减技术](@entry_id:141433)（Variance Reduction Techniques）**：为了以更少的复制次数达到所需的统计精度，可以使用一些技巧来减少[估计量的方差](@entry_id:167223)。
    *   **共同随机数（Common Random Numbers, CRN）**：在比较两种或多种系统配置（如有无疗法）时，CRN 是一种极其强大的技术。它通过让每个系统的对应复制使用完全相同的随机数流来实现。这通常会使两个系统的输出 $Y_A$ 和 $Y_B$产生**正相关**。由于 $\text{Var}(Y_A - Y_B) = \sigma_A^2 + \sigma_B^2 - 2\text{Cov}(Y_A, Y_B)$，正协方差会减小差值的方差，从而减少获得特定精度所需的复制次数。例如，使用 CRN 并预期相关性为 $\rho=0.6$ 时，可能只需要 $17$ 次复制就能达到某个目标精度；而如果没有 CRN，则可能需要 $40$ 次复制 。
    *   **[对偶变量](@entry_id:143282)（Antithetic Variates）**：在估计单个系统的均值时，该技术通过将每次由随机数流 $U$驱动的复制与其“对偶”——由 $1-U$ 驱动的复制——配对来实现。如果模型的输出与输入随机数大致呈单调关系，这将导致两次复制的输出产生**负相关**，从而减少其平均值的方差。

通过掌握这些原理和机制，研究者可以构建、模拟和分析复杂的生物医学系统，不仅能够重现已知行为，还能探索导致疾病进展和治疗响应的深层机制，并生成可检验的科学假设。