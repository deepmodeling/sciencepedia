{
    "hands_on_practices": [
        {
            "introduction": "The accuracy of a finite difference simulation is often determined by how well boundary conditions are handled. In many biomedical models, such as the transdermal drug delivery scenario described in this problem, boundaries represent physical interfaces where quantities like flux must be computed accurately. This exercise  provides fundamental practice in using Taylor series expansions to systematically derive a higher-order, one-sided finite difference formula, a crucial skill for implementing accurate boundary conditions in your own custom solvers.",
            "id": "3913384",
            "problem": "A one-dimensional model of transdermal drug delivery into perfused tissue is described by the partial differential equation (PDE) of diffusion with first-order clearance, $u_{t}(x,t) = D\\,u_{xx}(x,t) - k\\,u(x,t)$ for $x \\geq 0$, where $u(x,t)$ is a normalized, dimensionless drug concentration, $D$ is the diffusion coefficient, and $k$ is the clearance rate. At steady state, the spatial profile $u(x)$ solves the ordinary differential equation $D\\,u_{xx}(x) - k\\,u(x) = 0$. The diffusive flux at the tissue interface $x=0$ is coupled to physiology via Fick’s law, $J(0) = -D\\,u_{x}(0)$, so accurate numerical approximation of $u_{x}(0)$ is needed.\n\nConsider a uniform grid with spacing $h>0$ and grid points $x_{0}=0$, $x_{1}=h$, and $x_{2}=2h$. Using only $u(0)$, $u(h)$, and $u(2h)$, derive a one-sided finite difference approximation for $u_{x}(0)$ that is second-order accurate in $h$, starting from the Taylor series expansion of $u(x)$ around $x=0$ and enforcing consistency with the defining properties of the derivative while eliminating lower-order error terms. Explicitly obtain the leading-order truncation error term, defined here as $\\tau(h) = u_{x}(0) - \\mathcal{D}_{h}[u]$, where $\\mathcal{D}_{h}[u]$ denotes your finite difference operator applied to the exact $u$.\n\nThen, for the analytic concentration profile $u(x) = \\exp(-\\lambda x)$, with $\\lambda = 5$ and grid spacing $h = 0.02$, evaluate the leading-order truncation error $\\tau(h)$ as a pure number. Round your final numerical answer to $4$ significant figures.",
            "solution": "The problem asks for the derivation of a one-sided, second-order accurate finite difference formula for the first derivative $u_x(0)$ using the function values at grid points $x_0=0$, $x_1=h$, and $x_2=2h$. It also requires the determination of the leading-order truncation error and its numerical evaluation for a specific function and parameters.\n\nFirst, we derive the finite difference approximation. Let the approximation for $u_x(0)$ be denoted by $\\mathcal{D}_h[u]$. We seek a linear combination of $u(0)$, $u(h)$, and $u(2h)$ of the form:\n$$\n\\mathcal{D}_h[u] = A u(0) + B u(h) + C u(2h)\n$$\nwhere $A$, $B$, and $C$ are constants to be determined.\n\nTo find these constants, we use the Taylor series expansions of $u(x)$ around $x=0$. Assuming $u(x)$ is sufficiently smooth, we have:\n$$\nu(h) = u(0) + h u_x(0) + \\frac{h^2}{2!} u_{xx}(0) + \\frac{h^3}{3!} u_{xxx}(0) + O(h^4)\n$$\n$$\nu(2h) = u(0) + (2h) u_x(0) + \\frac{(2h)^2}{2!} u_{xx}(0) + \\frac{(2h)^3}{3!} u_{xxx}(0) + O(h^4)\n$$\nSubstituting these expansions into the expression for $\\mathcal{D}_h[u]$:\n$$\n\\mathcal{D}_h[u] = A u(0) + B\\left(u(0) + h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\dots\\right) + C\\left(u(0) + 2h u_x(0) + \\frac{4h^2}{2} u_{xx}(0) + \\dots\\right)\n$$\nWe group the terms by the derivatives of $u$ at $x=0$:\n$$\n\\mathcal{D}_h[u] = (A+B+C)u(0) + (Bh + 2Ch)u_x(0) + \\left(B\\frac{h^2}{2} + C\\frac{4h^2}{2}\\right)u_{xx}(0) + \\dots\n$$\nFor $\\mathcal{D}_h[u]$ to be an approximation of $u_x(0)$, the coefficient of $u_x(0)$ must be $1$, and the coefficients of other terms should be $0$. To achieve second-order accuracy, the error must be of order $O(h^2)$, which means the coefficients of $u(0)$ and $u_{xx}(0)$ must be zero. This gives us a system of three linear equations for $A$, $B$, and $C$:\n1.  Coefficient of $u(0)$: $A+B+C = 0$\n2.  Coefficient of $u_x(0)$: $Bh + 2Ch = 1 \\implies B + 2C = \\frac{1}{h}$\n3.  Coefficient of $u_{xx}(0)$: $B\\frac{h^2}{2} + C\\frac{4h^2}{2} = 0 \\implies B + 4C = 0$\n\nFrom equation (3), we find $B = -4C$. Substituting this into equation (2):\n$$\n(-4C) + 2C = \\frac{1}{h} \\implies -2C = \\frac{1}{h} \\implies C = -\\frac{1}{2h}\n$$\nNow we can find $B$:\n$$\nB = -4C = -4\\left(-\\frac{1}{2h}\\right) = \\frac{2}{h}\n$$\nFinally, using equation (1) to find $A$:\n$$\nA = -B - C = -\\left(\\frac{2}{h}\\right) - \\left(-\\frac{1}{2h}\\right) = -\\frac{4}{2h} + \\frac{1}{2h} = -\\frac{3}{2h}\n$$\nSubstituting the coefficients $A$, $B$, and $C$ back into the formula for $\\mathcal{D}_h[u]$, we obtain the finite difference approximation:\n$$\n\\mathcal{D}_h[u] = -\\frac{3}{2h}u(0) + \\frac{2}{h}u(h) - \\frac{1}{2h}u(2h) = \\frac{-3u(0) + 4u(h) - u(2h)}{2h}\n$$\n\nNext, we find the leading-order truncation error, defined as $\\tau(h) = u_x(0) - \\mathcal{D}_h[u]$. We need to expand our Taylor series to the next higher order term, which involves $u_{xxx}(0)$:\n$$\nu(h) = u(0) + h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\frac{h^3}{6} u_{xxx}(0) + O(h^4)\n$$\n$$\nu(2h) = u(0) + 2h u_x(0) + \\frac{4h^2}{2} u_{xx}(0) + \\frac{8h^3}{6} u_{xxx}(0) + O(h^4)\n$$\nSubstituting these into the derived operator $\\mathcal{D}_h[u]$:\n$$\n\\mathcal{D}_h[u] = \\frac{1}{2h} \\left[ -3u(0) + 4\\left(u(0) + h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\frac{h^3}{6} u_{xxx}(0) + \\dots\\right) - \\left(u(0) + 2h u_x(0) + 2h^2 u_{xx}(0) + \\frac{4h^3}{3} u_{xxx}(0) + \\dots\\right) \\right]\n$$\nCollecting the coefficients of the derivative terms:\n- For $u(0)$: $\\frac{1}{2h}(-3+4-1) = 0$\n- For $u_x(0)$: $\\frac{1}{2h}(4h - 2h) = \\frac{2h}{2h} = 1$\n- For $u_{xx}(0)$: $\\frac{1}{2h}\\left(4\\frac{h^2}{2} - 2h^2\\right) = 0$\n- For $u_{xxx}(0)$: $\\frac{1}{2h}\\left(4\\frac{h^3}{6} - \\frac{8h^3}{6}\\right) = \\frac{1}{2h}\\left(-\\frac{4h^3}{6}\\right) = -\\frac{2h^3}{6h} = -\\frac{h^2}{3}$\n\nSo, the expansion of the operator is:\n$$\n\\mathcal{D}_h[u] = u_x(0) - \\frac{h^2}{3}u_{xxx}(0) + O(h^3)\n$$\nThe truncation error is then:\n$$\n\\tau(h) = u_x(0) - \\mathcal{D}_h[u] = u_x(0) - \\left(u_x(0) - \\frac{h^2}{3}u_{xxx}(0) + O(h^3)\\right) = \\frac{h^2}{3}u_{xxx}(0) + O(h^3)\n$$\nThe leading-order truncation error term is $\\frac{h^2}{3}u_{xxx}(0)$. This confirms the approximation is second-order accurate.\n\nFinally, we evaluate this leading-order error term for the given function $u(x) = \\exp(-\\lambda x)$ with parameters $\\lambda = 5$ and $h = 0.02$. We need the third derivative of $u(x)$ evaluated at $x=0$.\n$$\nu(x) = \\exp(-\\lambda x)\n$$\n$$\nu_x(x) = -\\lambda \\exp(-\\lambda x)\n$$\n$$\nu_{xx}(x) = \\lambda^2 \\exp(-\\lambda x)\n$$\n$$\nu_{xxx}(x) = -\\lambda^3 \\exp(-\\lambda x)\n$$\nAt $x=0$, the third derivative is:\n$$\nu_{xxx}(0) = -\\lambda^3 \\exp(0) = -\\lambda^3\n$$\nNow, substitute this into the leading-order error term formula:\n$$\n\\tau(h) \\approx \\frac{h^2}{3}u_{xxx}(0) = -\\frac{h^2 \\lambda^3}{3}\n$$\nPlugging in the numerical values $\\lambda = 5$ and $h = 0.02$:\n$$\n\\tau(0.02) \\approx -\\frac{(0.02)^2 (5)^3}{3} = -\\frac{(4 \\times 10^{-4})(125)}{3} = -\\frac{500 \\times 10^{-4}}{3} = -\\frac{0.05}{3}\n$$\nCalculating the value:\n$$\n-\\frac{0.05}{3} \\approx -0.016666...\n$$\nRounding to $4$ significant figures, we get $-0.01667$.",
            "answer": "$$\\boxed{-0.01667}$$"
        },
        {
            "introduction": "Before a numerical model can be trusted to predict complex biological phenomena, we must first verify that the code correctly solves the mathematical equations it is based on. The Method of Manufactured Solutions (MMS) is a rigorous and indispensable technique for code verification. This practice  guides you through the essential first step of MMS: deriving the specific source term required to make a chosen analytical function an exact solution to the governing PDE, thereby creating a perfect test case with a known ground truth.",
            "id": "3913365",
            "problem": "Consider a one-dimensional tissue slab model for solute diffusion under heterogeneous microstructure, where the governing Partial Differential Equation (PDE) in a non-conservative form is given by $u_{t} = D(x)\\,u_{xx} + s(x,t)$ on the spatial domain $x \\in [0,1]$ and time $t \\geq 0$. Here $u(x,t)$ denotes a dimensionless concentration field, and $D(x)$ is a spatially varying, dimensionless effective diffusivity. You are verifying a Finite Difference Method (FDM) solver using the Method of Manufactured Solutions (MMS) by prescribing an exact solution and deriving the corresponding source term $s(x,t)$ that makes the exact solution satisfy the PDE.\n\nLet the manufactured solution be\n$$u(x,t) = \\exp(\\omega t)\\,\\big(\\sin(2\\pi x) + x^{3} - x^{2}\\big),$$\nand let the spatially varying diffusivity be\n$$D(x) = D_{0}\\,\\exp(\\lambda x),$$\nwhere $D_{0} > 0$, $\\lambda$ and $\\omega$ are fixed real parameters. Impose homogeneous Dirichlet boundary conditions $u(0,t) = 0$ and $u(1,t) = 0$ for all $t \\geq 0$, and initial condition $u(x,0) = \\sin(2\\pi x) + x^{3} - x^{2}$.\n\nDerive the exact analytic expression for the source term $s(x,t)$ that ensures the prescribed $u(x,t)$ satisfies the PDE $u_{t} = D(x)\\,u_{xx} + s(x,t)$ with the given $D(x)$, boundary conditions, and initial condition. Your final answer must be a single closed-form expression for $s(x,t)$ in terms of $x$, $t$, $D_{0}$, $\\lambda$, $\\omega$, and fundamental constants. No numerical evaluation or rounding is required, and no units should be reported with the final expression.",
            "solution": "The governing PDE is given as:\n$$u_{t} = D(x)\\,u_{xx} + s(x,t)$$\nTo find the source term $s(x,t)$ that satisfies this equation for the given $u(x,t)$, we rearrange the PDE to solve for $s(x,t)$:\n$$s(x,t) = u_{t} - D(x)\\,u_{xx}$$\nThe derivation requires calculating the partial derivative of $u(x,t)$ with respect to time ($u_t$) and the second partial derivative with respect to space ($u_{xx}$).\n\nThe manufactured solution is:\n$$u(x,t) = \\exp(\\omega t)\\,\\big(\\sin(2\\pi x) + x^{3} - x^{2}\\big)$$\n\nFirst, we compute the time derivative, $u_t$. The spatial part of the function is treated as a constant.\n$$u_{t} = \\frac{\\partial}{\\partial t} \\left[ \\exp(\\omega t)\\,\\big(\\sin(2\\pi x) + x^{3} - x^{2}\\big) \\right]$$\n$$u_{t} = \\omega \\exp(\\omega t)\\,\\big(\\sin(2\\pi x) + x^{3} - x^{2}\\big)$$\n\nNext, we compute the spatial derivatives. The first partial derivative with respect to $x$ is:\n$$u_{x} = \\frac{\\partial}{\\partial x} \\left[ \\exp(\\omega t)\\,\\big(\\sin(2\\pi x) + x^{3} - x^{2}\\big) \\right]$$\nThe term $\\exp(\\omega t)$ is treated as a constant.\n$$u_{x} = \\exp(\\omega t)\\,\\frac{\\partial}{\\partial x}\\big(\\sin(2\\pi x) + x^{3} - x^{2}\\big)$$\n$$u_{x} = \\exp(\\omega t)\\,\\big(2\\pi \\cos(2\\pi x) + 3x^{2} - 2x\\big)$$\n\nNow, we compute the second partial derivative with respect to $x$, $u_{xx}$:\n$$u_{xx} = \\frac{\\partial}{\\partial x} \\left[ \\exp(\\omega t)\\,\\big(2\\pi \\cos(2\\pi x) + 3x^{2} - 2x\\big) \\right]$$\n$$u_{xx} = \\exp(\\omega t)\\,\\frac{\\partial}{\\partial x}\\big(2\\pi \\cos(2\\pi x) + 3x^{2} - 2x\\big)$$\n$$u_{xx} = \\exp(\\omega t)\\,\\big(2\\pi(-2\\pi\\sin(2\\pi x)) + 6x - 2\\big)$$\n$$u_{xx} = \\exp(\\omega t)\\,\\big(-4\\pi^{2}\\sin(2\\pi x) + 6x - 2\\big)$$\n\nNow we substitute the expressions for $u_t$, $u_{xx}$, and $D(x)$ into the equation for $s(x,t)$. The diffusivity is given as $D(x) = D_{0}\\,\\exp(\\lambda x)$.\n$$s(x,t) = u_{t} - D(x) u_{xx}$$\n$$s(x,t) = \\omega \\exp(\\omega t)\\,\\big(\\sin(2\\pi x) + x^{3} - x^{2}\\big) - \\Big(D_{0}\\,\\exp(\\lambda x)\\Big) \\Big(\\exp(\\omega t)\\,\\big(-4\\pi^{2}\\sin(2\\pi x) + 6x - 2\\big)\\Big)$$\nWe can factor out the common term $\\exp(\\omega t)$:\n$$s(x,t) = \\exp(\\omega t) \\left[ \\omega\\big(\\sin(2\\pi x) + x^{3} - x^{2}\\big) - D_{0}\\,\\exp(\\lambda x)\\big(-4\\pi^{2}\\sin(2\\pi x) + 6x - 2\\big) \\right]$$\nGrouping terms by $\\sin(2\\pi x)$ and the remaining polynomial and exponential terms in $x$:\n$$s(x,t) = \\exp(\\omega t) \\left[ \\big(\\omega + 4\\pi^{2}D_{0}\\exp(\\lambda x)\\big)\\sin(2\\pi x) + \\omega x^{3} - \\omega x^{2} - (6x-2)D_{0}\\exp(\\lambda x) \\right]$$\nThis is the final analytical expression for the source term $s(x,t)$.",
            "answer": "$$\n\\boxed{\\exp(\\omega t) \\left[ \\left(\\omega + 4\\pi^{2}D_{0}\\exp(\\lambda x)\\right)\\sin(2\\pi x) + \\omega x^{3} - \\omega x^{2} - (6x-2)D_{0}\\exp(\\lambda x) \\right]}\n$$"
        },
        {
            "introduction": "Quantifying the error of a numerical solution is the ultimate test of a solver's performance. Different mathematical norms can provide distinct insights into the nature of this error, which have direct physical relevance. This exercise  brings together discretization, implementation, and analysis by asking you to build a Crank-Nicolson solver and evaluate its error using both the discrete $L^2$ norm, which measures overall error in concentration, and a discrete $H^1$-like seminorm, which assesses the accuracy of concentration gradients or fluxes.",
            "id": "3913301",
            "problem": "Consider a one-dimensional, nondimensional diffusion of a solute in a slab representing a homogeneous tissue, modeled on the spatial domain $x \\in (0,1)$ by the partial differential equation (PDE) $u_t = u_{xx}$ with homogeneous Dirichlet boundary conditions $u(0,t) = 0$ and $u(1,t) = 0$ for all $t \\ge 0$. The field $u(x,t)$ denotes nondimensionalized concentration, obtained by scaling concentration by a characteristic concentration $C_0$, length by a characteristic length $L$, and time by $L^2/D_0$ for a reference diffusion coefficient $D_0$. You must solve this initial-boundary value problem numerically using the finite difference method on a uniform spatial grid with $N$ interior points and the Crank–Nicolson time-stepping scheme for a final time $T$. The exact solution for an initial condition composed of sine modes $u(x,0) = \\sum_{k} a_k \\sin(k \\pi x)$ is $u(x,t) = \\sum_{k} a_k \\exp\\left(- (k \\pi)^2 t\\right) \\sin(k \\pi x)$, which you should use as ground truth to quantify the numerical error at time $T$.\n\nStarting from conservation of mass and Fick’s first law, and using consistent Riemann sum approximations on the uniform grid with spacing $\\Delta x = 1/(N+1)$, derive and implement:\n- a discrete $L^2$ norm of the error $e(x) = u_{\\text{num}}(x,T) - u_{\\text{exact}}(x,T)$ over $(0,1)$, and\n- a discrete $H^1$-like seminorm of the error based on the grid approximation to the gradient, using the homogeneous Dirichlet boundary conditions at $x=0$ and $x=1$.\n\nThese discrete quantities must be defined so that they are consistent with the continuous $L^2$ norm $\\|e\\|_{L^2(0,1)} = \\left(\\int_0^1 e(x)^2 \\, dx\\right)^{1/2}$ and the continuous $H^1$ seminorm $|e|_{H^1(0,1)} = \\left(\\int_0^1 (e_x(x))^2 \\, dx\\right)^{1/2}$.\n\nUse the Crank–Nicolson scheme in time with a uniform time step $\\Delta t$ such that $M = T/\\Delta t$ is an integer. Spatial discretization must use second-order centered differences on the interior points, enforcing $u=0$ at the boundaries. Initialize the numerical solution by sampling the prescribed initial condition at the interior grid points.\n\nYou must implement a single program that, for each test case, computes the discrete $L^2$ error and the discrete $H^1$-like seminorm error at time $T$ and returns these two errors as real numbers without physical units (nondimensional). Angles, if any, must be interpreted in radians. The final output must aggregate all test cases into one line.\n\nTest suite to implement:\n- Case $1$ (baseline, single mode): $N = 64$, $T = 0.05$, $\\Delta t = 0.0005$, initial condition $u(x,0) = 1.0 \\cdot \\sin(1 \\cdot \\pi x)$.\n- Case $2$ (multi-modal): $N = 64$, $T = 0.02$, $\\Delta t = 0.00025$, initial condition $u(x,0) = 0.7 \\cdot \\sin(1 \\cdot \\pi x) + 0.3 \\cdot \\sin(2 \\cdot \\pi x)$.\n- Case $3$ (coarse grid, higher mode): $N = 8$, $T = 0.005$, $\\Delta t = 0.0005$, initial condition $u(x,0) = 1.0 \\cdot \\sin(3 \\cdot \\pi x)$.\n- Case $4$ (long time decay): $N = 64$, $T = 0.5$, $\\Delta t = 0.001$, initial condition $u(x,0) = 1.0 \\cdot \\sin(4 \\cdot \\pi x)$.\n- Case $5$ (near-Nyquist content): $N = 32$, $T = 0.005$, $\\Delta t = 0.0001$, initial condition $u(x,0) = 1.0 \\cdot \\sin(10 \\cdot \\pi x)$.\n\nFor each case, compute the two scalar outputs: the discrete $L^2$ error and the discrete $H^1$-like seminorm error at time $T$, both as nonnegative real numbers.\n\nFinal output format requirement:\n- Your program should produce a single line of output containing the list of case results, each case represented as a two-element list $[E_{L2},E_{H1}]$. The entire output must be a single list of these pairs, with no spaces, numbers formatted in lower-case scientific notation with exactly eight digits after the decimal point. For example, an output with two cases should look like $[[1.23456789e-04,2.34567891e-03],[\\dots,\\dots],\\dots]$ where the ellipses indicate additional cases. The program must print exactly this single line.\n\nNote: Because the model is nondimensionalized, you must not report any physical units in the output. All computations should be deterministic with the given parameters.",
            "solution": "### Numerical Scheme: Crank-Nicolson Method\nThe task is to solve the nondimensionalized diffusion equation\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial^2 u}{\\partial x^2}\n$$\non the spatial domain $x \\in (0,1)$ for time $t \\ge 0$. The boundary conditions are of the homogeneous Dirichlet type, $u(0,t) = 0$ and $u(1,t) = 0$. The initial condition is given as a sum of sine modes, $u(x,0) = \\sum_{k} a_k \\sin(k \\pi x)$. We will use the Crank-Nicolson finite difference method and then derive and compute discrete error norms.\n\nWe first discretize the domain. The spatial domain $(0,1)$ is discretized into $N+1$ equal subintervals of width $\\Delta x = 1/(N+1)$. This defines a grid with $N$ interior points $x_i = i \\Delta x$ for $i=1, 2, \\dots, N$. The boundary points are $x_0 = 0$ and $x_{N+1} = 1$. The time domain is discretized with a uniform step $\\Delta t$, such that $t_j = j \\Delta t$. Let $u_i^j \\approx u(x_i, t_j)$ be the numerical approximation of the solution at grid point $(x_i, t_j)$.\n\nThe spatial second derivative $u_{xx}$ at grid point $x_i$ is approximated using a second-order centered difference:\n$$\n\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{x_i, t_j} \\approx \\frac{u_{i-1}^j - 2u_i^j + u_{i+1}^j}{(\\Delta x)^2}\n$$\n\nThe Crank-Nicolson scheme discretizes the time derivative using a forward difference and approximates the spatial derivative as the average of its values at time $t_j$ and $t_{j+1}$:\n$$\n\\frac{u_i^{j+1} - u_i^j}{\\Delta t} = \\frac{1}{2} \\left( \\frac{u_{i-1}^{j+1} - 2u_i^{j+1} + u_{i+1}^{j+1}}{(\\Delta x)^2} + \\frac{u_{i-1}^{j} - 2u_i^j + u_{i+1}^j}{(\\Delta x)^2} \\right)\n$$\nLet's define the parameter $r = \\frac{\\Delta t}{2(\\Delta x)^2}$. We can rearrange the equation to separate the unknown terms at step $j+1$ (left-hand side) from the known terms at step $j$ (right-hand side):\n$$\n-r u_{i-1}^{j+1} + (1+2r) u_i^{j+1} - r u_{i+1}^{j+1} = r u_{i-1}^{j} + (1-2r) u_i^j + r u_{i+1}^j\n$$\nThis equation is valid for the $N$ interior points, $i=1, \\dots, N$. The boundary conditions imply $u_0^j = 0$ and $u_{N+1}^j=0$ for all $j$.\n\nLet $\\mathbf{u}^j = [u_1^j, u_2^j, \\dots, u_N^j]^T$ be the vector of solution values at the interior points at time $t_j$. The system of equations can be written in matrix form as:\n$$\n\\mathbf{A} \\mathbf{u}^{j+1} = \\mathbf{B} \\mathbf{u}^j\n$$\nwhere $\\mathbf{A}$ and $\\mathbf{B}$ are $N \\times N$ tridiagonal matrices:\n$$\n\\mathbf{A} = \\begin{pmatrix}\n1+2r & -r & 0 & \\dots \\\\\n-r & 1+2r & -r & \\dots \\\\\n0 & \\ddots & \\ddots & \\ddots \\\\\n\\dots & 0 & -r & 1+2r\n\\end{pmatrix}\n\\quad , \\quad\n\\mathbf{B} = \\begin{pmatrix}\n1-2r & r & 0 & \\dots \\\\\nr & 1-2r & r & \\dots \\\\\n0 & \\ddots & \\ddots & \\ddots \\\\\n\\dots & 0 & r & 1-2r\n\\end{pmatrix}\n$$\nTo advance the solution from time $t_j$ to $t_{j+1}$, we solve the linear system $\\mathbf{A} \\mathbf{u}^{j+1} = \\mathbf{b}^j$, where $\\mathbf{b}^j = \\mathbf{B} \\mathbf{u}^j$. Since $\\mathbf{A}$ is symmetric, positive-definite, and tridiagonal, this system can be solved very efficiently.\n\n### Derivation of Discrete Error Norms\n\nThe error at the final time $T$ is $e(x) = u_{\\text{num}}(x,T) - u_{\\text{exact}}(x,T)$. Let $e_i = e(x_i)$ be the error at the interior grid points, $i=1, \\dots, N$. The boundary conditions ensure that the error is zero at the boundaries, so $e_0 = e(x_0) = 0$ and $e_{N+1} = e(x_{N+1}) = 0$.\n\n**Discrete $L^2$ Norm**\n\nThe continuous $L^2$ norm is defined by the integral $\\|e\\|_{L^2(0,1)} = \\left(\\int_0^1 e(x)^2 \\, dx\\right)^{1/2}$. We approximate this integral using a Riemann sum over the interior grid points. Each grid point $x_i$ can be seen as representing a cell of width $\\Delta x$. The integral is approximated as:\n$$\n\\int_0^1 e(x)^2 \\, dx \\approx \\sum_{i=1}^{N} e(x_i)^2 \\Delta x = \\Delta x \\sum_{i=1}^{N} e_i^2\n$$\nThis leads to the definition of the discrete $L^2$ norm of the error:\n$$\nE_{L2} = \\|e\\|_{\\text{discrete } L^2} = \\left(\\Delta x \\sum_{i=1}^{N} e_i^2\\right)^{1/2}\n$$\nIn terms of the error vector $\\mathbf{e} = [e_1, \\dots, e_N]^T$, this is $\\sqrt{\\Delta x} \\|\\mathbf{e}\\|_2$, where $\\|\\cdot\\|_2$ is the standard Euclidean vector norm.\n\n**Discrete $H^1$-like Seminorm**\n\nThe continuous $H^1$ seminorm involves the spatial derivative: $|e|_{H^1(0,1)} = \\left(\\int_0^1 (e_x(x))^2 \\, dx\\right)^{1/2}$, where $e_x = \\partial e / \\partial x$. This integral is related to the energy of the diffusive flux, which via Fick's law is proportional to the concentration gradient. We first approximate the derivative $e_x$. A consistent choice is a first-order finite difference centered between grid points. At the midpoint $x_{i+1/2} = (x_i+x_{i+1})/2$, the derivative is approximated as:\n$$\ne_x(x_{i+1/2}) \\approx \\frac{e_{i+1} - e_i}{\\Delta x}\n$$\nWe have $N+1$ such midpoints, for $i = 0, \\dots, N$. We then approximate the integral of $(e_x)^2$ using a midpoint rule quadrature, summing over the $N+1$ intervals:\n$$\n\\int_0^1 (e_x(x))^2 \\, dx \\approx \\sum_{i=0}^{N} \\left( e_x(x_{i+1/2}) \\right)^2 \\Delta x \\approx \\sum_{i=0}^{N} \\left( \\frac{e_{i+1} - e_i}{\\Delta x} \\right)^2 \\Delta x = \\frac{1}{\\Delta x} \\sum_{i=0}^{N} (e_{i+1} - e_i)^2\n$$\nGiven the boundary conditions, $e_0 = e_{N+1} = 0$. The resulting discrete $H^1$-like seminorm of the error is:\n$$\nE_{H1} = |e|_{\\text{discrete } H^1} = \\left(\\frac{1}{\\Delta x} \\sum_{i=0}^{N} (e_{i+1} - e_i)^2\\right)^{1/2}\n$$\n\n### Implementation\nThe numerical solution is found by first setting the initial state vector $\\mathbf{u}^0$ by sampling the given initial condition $u(x,0)$ at the interior grid points. Then, for each time step up to the final time $T$, the tridiagonal system $\\mathbf{A} \\mathbf{u}^{j+1} = \\mathbf{B} \\mathbf{u}^j$ is solved for $\\mathbf{u}^{j+1}$. The final numerical solution vector is $u_{\\text{num}}(x_i, T)$. The exact solution is also evaluated at the same grid points and time. The error vector is computed, and the two discrete norms $E_{L2}$ and $E_{H1}$ are calculated using the derived formulas.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Solves the 1D diffusion equation using the Crank-Nicolson method for several\n    test cases and computes L2 and H1-seminorm errors.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1: (N, T, dt, initial_condition_modes)\n        (64, 0.05, 0.0005, [(1.0, 1)]),\n        # Case 2\n        (64, 0.02, 0.00025, [(0.7, 1), (0.3, 2)]),\n        # Case 3\n        (8, 0.005, 0.0005, [(1.0, 3)]),\n        # Case 4\n        (64, 0.5, 0.001, [(1.0, 4)]),\n        # Case 5\n        (32, 0.005, 0.0001, [(1.0, 10)])\n    ]\n    \n    results = []\n\n    for N, T, dt, ic_modes in test_cases:\n        \n        # 1. Grid and parameter setup\n        dx = 1.0 / (N + 1)\n        x_interior = np.linspace(dx, 1.0 - dx, N)\n        M = int(round(T / dt))\n\n        # 2. Define initial and exact solution functions\n        def u_initial(x, modes):\n            res = np.zeros_like(x, dtype=float)\n            for a, k in modes:\n                res += a * np.sin(k * np.pi * x)\n            return res\n\n        def u_exact(x, t, modes):\n            res = np.zeros_like(x, dtype=float)\n            for a, k in modes:\n                res += a * np.exp(-(k * np.pi)**2 * t) * np.sin(k * np.pi * x)\n            return res\n\n        # 3. Crank-Nicolson solver setup\n        r = dt / (2.0 * dx**2)\n        \n        # Matrix A (LHS) in banded format for scipy.linalg.solve_banded\n        # (1, 1) indicates 1 lower and 1 upper diagonal\n        ab_A = np.zeros((3, N))\n        ab_A[0, 1:] = -r       # Upper diagonal\n        ab_A[1, :] = 1.0 + 2.0 * r # Main diagonal\n        ab_A[2, :-1] = -r      # Lower diagonal\n\n        # Initialize solution vector\n        u_current = u_initial(x_interior, ic_modes)\n        \n        # 4. Time stepping loop\n        for _ in range(M):\n            # Construct RHS vector b = B @ u_current\n            # B is tridiagonal with (r, 1-2r, r)\n            b = np.zeros(N)\n            # Interior points of the vector\n            if N > 2:\n                b[1:-1] = r * u_current[:-2] + (1.0 - 2.0 * r) * u_current[1:-1] + r * u_current[2:]\n            # Endpoints of the vector (handles N=1 and N=2 cases correctly)\n            if N >= 1:\n                b[0] = (1.0 - 2.0 * r) * u_current[0]\n                if N > 1:\n                    b[0] += r * u_current[1]\n            if N >= 2:\n                b[-1] = r * u_current[-2] + (1.0 - 2.0 * r) * u_current[-1]\n            \n            # Solve the tridiagonal system A * u_next = b\n            u_next = solve_banded((1, 1), ab_A, b)\n            u_current = u_next\n        \n        u_final_numeric = u_current\n        \n        # 5. Error calculation\n        u_final_exact = u_exact(x_interior, T, ic_modes)\n        error_vec = u_final_numeric - u_final_exact\n        \n        # 6. Compute discrete norms\n        # L2 norm\n        l2_error = np.sqrt(dx * np.sum(error_vec**2))\n        \n        # H1-like seminorm\n        # Need to include boundary points (error is 0 there)\n        error_vec_full = np.concatenate(([0.0], error_vec, [0.0]))\n        error_diffs = np.diff(error_vec_full)\n        h1_seminorm_error = np.sqrt(np.sum(error_diffs**2) / dx)\n        \n        results.append([l2_error, h1_seminorm_error])\n\n    # 7. Final print statement in the exact required format\n    output_str = \",\".join([f\"[{l2:.8e},{h1:.8e}]\" for l2, h1 in results])\n    print(f\"[{output_str}]\")\n\nsolve()\n```"
        }
    ]
}