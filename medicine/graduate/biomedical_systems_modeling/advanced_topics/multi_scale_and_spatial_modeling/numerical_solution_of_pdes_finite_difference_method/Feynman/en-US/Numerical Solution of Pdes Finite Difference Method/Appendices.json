{
    "hands_on_practices": [
        {
            "introduction": "The accuracy of a numerical solution is often limited by how well we handle the boundaries of our domain. In many biomedical models, physical laws like diffusive flux are specified at an interface, requiring a precise approximation of the derivative at that edge. This practice  will guide you through the foundational technique of using Taylor series expansions to derive a high-order, one-sided finite difference formula, a crucial tool for ensuring your simulation accurately reflects the physics at its boundaries.",
            "id": "3913384",
            "problem": "A one-dimensional model of transdermal drug delivery into perfused tissue is described by the partial differential equation (PDE) of diffusion with first-order clearance, $u_{t}(x,t) = D\\,u_{xx}(x,t) - k\\,u(x,t)$ for $x \\geq 0$, where $u(x,t)$ is a normalized, dimensionless drug concentration, $D$ is the diffusion coefficient, and $k$ is the clearance rate. At steady state, the spatial profile $u(x)$ solves the ordinary differential equation $D\\,u_{xx}(x) - k\\,u(x) = 0$. The diffusive flux at the tissue interface $x=0$ is coupled to physiology via Fick’s law, $J(0) = -D\\,u_{x}(0)$, so accurate numerical approximation of $u_{x}(0)$ is needed.\n\nConsider a uniform grid with spacing $h>0$ and grid points $x_{0}=0$, $x_{1}=h$, and $x_{2}=2h$. Using only $u(0)$, $u(h)$, and $u(2h)$, derive a one-sided finite difference approximation for $u_{x}(0)$ that is second-order accurate in $h$, starting from the Taylor series expansion of $u(x)$ around $x=0$ and enforcing consistency with the defining properties of the derivative while eliminating lower-order error terms. Explicitly obtain the leading-order truncation error term, defined here as $\\tau(h) = u_{x}(0) - \\mathcal{D}_{h}[u]$, where $\\mathcal{D}_{h}[u]$ denotes your finite difference operator applied to the exact $u$.\n\nThen, for the analytic concentration profile $u(x) = \\exp(-\\lambda x)$, with $\\lambda = 5$ and grid spacing $h = 0.02$, evaluate the leading-order truncation error $\\tau(h)$ as a pure number. Round your final numerical answer to $4$ significant figures.",
            "solution": "The problem asks for the derivation of a one-sided, second-order accurate finite difference formula for the first derivative $u_x(0)$ using the function values at grid points $x_0=0$, $x_1=h$, and $x_2=2h$. It also requires the determination of the leading-order truncation error and its numerical evaluation for a specific function and parameters.\n\nFirst, we derive the finite difference approximation. Let the approximation for $u_x(0)$ be denoted by $\\mathcal{D}_h[u]$. We seek a linear combination of $u(0)$, $u(h)$, and $u(2h)$ of the form:\n$$\n\\mathcal{D}_h[u] = A u(0) + B u(h) + C u(2h)\n$$\nwhere $A$, $B$, and $C$ are constants to be determined.\n\nTo find these constants, we use the Taylor series expansions of $u(x)$ around $x=0$. Assuming $u(x)$ is sufficiently smooth, we have:\n$$\nu(h) = u(0) + h u_x(0) + \\frac{h^2}{2!} u_{xx}(0) + \\frac{h^3}{3!} u_{xxx}(0) + O(h^4)\n$$\n$$\nu(2h) = u(0) + (2h) u_x(0) + \\frac{(2h)^2}{2!} u_{xx}(0) + \\frac{(2h)^3}{3!} u_{xxx}(0) + O(h^4)\n$$\nSubstituting these expansions into the expression for $\\mathcal{D}_h[u]$:\n$$\n\\mathcal{D}_h[u] = A u(0) + B\\left(u(0) + h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\dots\\right) + C\\left(u(0) + 2h u_x(0) + \\frac{4h^2}{2} u_{xx}(0) + \\dots\\right)\n$$\nWe group the terms by the derivatives of $u$ at $x=0$:\n$$\n\\mathcal{D}_h[u] = (A+B+C)u(0) + (Bh + 2Ch)u_x(0) + \\left(B\\frac{h^2}{2} + C\\frac{4h^2}{2}\\right)u_{xx}(0) + \\dots\n$$\nFor $\\mathcal{D}_h[u]$ to be an approximation of $u_x(0)$, the coefficient of $u_x(0)$ must be $1$, and the coefficients of other terms should be $0$. To achieve second-order accuracy, the error must be of order $O(h^2)$, which means the coefficients of $u(0)$ and $u_{xx}(0)$ must be zero. This gives us a system of three linear equations for $A$, $B$, and $C$:\n1.  Coefficient of $u(0)$: $A+B+C = 0$\n2.  Coefficient of $u_x(0)$: $Bh + 2Ch = 1 \\implies B + 2C = \\frac{1}{h}$\n3.  Coefficient of $u_{xx}(0)$: $B\\frac{h^2}{2} + C\\frac{4h^2}{2} = 0 \\implies B + 4C = 0$\n\nFrom equation (3), we find $B = -4C$. Substituting this into equation (2):\n$$\n(-4C) + 2C = \\frac{1}{h} \\implies -2C = \\frac{1}{h} \\implies C = -\\frac{1}{2h}\n$$\nNow we can find $B$:\n$$\nB = -4C = -4\\left(-\\frac{1}{2h}\\right) = \\frac{2}{h}\n$$\nFinally, using equation (1) to find $A$:\n$$\nA = -B - C = -\\left(\\frac{2}{h}\\right) - \\left(-\\frac{1}{2h}\\right) = -\\frac{4}{2h} + \\frac{1}{2h} = -\\frac{3}{2h}\n$$\nSubstituting the coefficients $A$, $B$, and $C$ back into the formula for $\\mathcal{D}_h[u]$, we obtain the finite difference approximation:\n$$\n\\mathcal{D}_h[u] = -\\frac{3}{2h}u(0) + \\frac{2}{h}u(h) - \\frac{1}{2h}u(2h) = \\frac{-3u(0) + 4u(h) - u(2h)}{2h}\n$$\n\nNext, we find the leading-order truncation error, defined as $\\tau(h) = u_x(0) - \\mathcal{D}_h[u]$. We need to expand our Taylor series to the next higher order term, which involves $u_{xxx}(0)$:\n$$\nu(h) = u(0) + h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\frac{h^3}{6} u_{xxx}(0) + O(h^4)\n$$\n$$\nu(2h) = u(0) + 2h u_x(0) + \\frac{4h^2}{2} u_{xx}(0) + \\frac{8h^3}{6} u_{xxx}(0) + O(h^4)\n$$\nSubstituting these into the derived operator $\\mathcal{D}_h[u]$:\n$$\n\\mathcal{D}_h[u] = \\frac{1}{2h} \\left[ -3u(0) + 4\\left(u(0) + h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\frac{h^3}{6} u_{xxx}(0) + \\dots\\right) - \\left(u(0) + 2h u_x(0) + 2h^2 u_{xx}(0) + \\frac{4h^3}{3} u_{xxx}(0) + \\dots\\right) \\right]\n$$\nCollecting the coefficients of the derivative terms:\n- For $u(0)$: $\\frac{1}{2h}(-3+4-1) = 0$\n- For $u_x(0)$: $\\frac{1}{2h}(4h - 2h) = \\frac{2h}{2h} = 1$\n- For $u_{xx}(0)$: $\\frac{1}{2h}\\left(4\\frac{h^2}{2} - 2h^2\\right) = 0$\n- For $u_{xxx}(0)$: $\\frac{1}{2h}\\left(4\\frac{h^3}{6} - \\frac{8h^3}{6}\\right) = \\frac{1}{2h}\\left(-\\frac{4h^3}{6}\\right) = -\\frac{2h^3}{6h} = -\\frac{h^2}{3}$\n\nSo, the expansion of the operator is:\n$$\n\\mathcal{D}_h[u] = u_x(0) - \\frac{h^2}{3}u_{xxx}(0) + O(h^3)\n$$\nThe truncation error is then:\n$$\n\\tau(h) = u_x(0) - \\mathcal{D}_h[u] = u_x(0) - \\left(u_x(0) - \\frac{h^2}{3}u_{xxx}(0) + O(h^3)\\right) = \\frac{h^2}{3}u_{xxx}(0) + O(h^3)\n$$\nThe leading-order truncation error term is $\\frac{h^2}{3}u_{xxx}(0)$. This confirms the approximation is second-order accurate.\n\nFinally, we evaluate this leading-order error term for the given function $u(x) = \\exp(-\\lambda x)$ with parameters $\\lambda = 5$ and $h = 0.02$. We need the third derivative of $u(x)$ evaluated at $x=0$.\n$$\nu(x) = \\exp(-\\lambda x)\n$$\n$$\nu_x(x) = -\\lambda \\exp(-\\lambda x)\n$$\n$$\nu_{xx}(x) = \\lambda^2 \\exp(-\\lambda x)\n$$\n$$\nu_{xxx}(x) = -\\lambda^3 \\exp(-\\lambda x)\n$$\nAt $x=0$, the third derivative is:\n$$\nu_{xxx}(0) = -\\lambda^3 \\exp(0) = -\\lambda^3\n$$\nNow, substitute this into the leading-order error term formula:\n$$\n\\tau(h) \\approx \\frac{h^2}{3}u_{xxx}(0) = -\\frac{h^2 \\lambda^3}{3}\n$$\nPlugging in the numerical values $\\lambda = 5$ and $h = 0.02$:\n$$\n\\tau(0.02) \\approx -\\frac{(0.02)^2 (5)^3}{3} = -\\frac{(4 \\times 10^{-4})(125)}{3} = -\\frac{500 \\times 10^{-4}}{3} = -\\frac{0.05}{3}\n$$\nCalculating the value:\n$$\n-\\frac{0.05}{3} \\approx -0.016666...\n$$\nRounding to $4$ significant figures, we get $-0.01667$.",
            "answer": "$$\\boxed{-0.01667}$$"
        },
        {
            "introduction": "Real biological tissues are rarely uniform; their properties often vary in space. This exercise  bridges the gap from simple derivative formulas to constructing a complete system of equations for a more realistic, multi-dimensional problem with heterogeneous properties. You will learn how to build a robust, conservative numerical scheme for 2D diffusion using an implicit time-stepping method, which is a powerful approach for ensuring stability in complex simulations.",
            "id": "3913347",
            "problem": "Consider modeling passive transport of a soluble drug in a thin, homogeneous tissue sheet in two spatial dimensions. Let $u(x,y,t)$ denote the drug concentration and $D(x,y)$ denote a spatially varying effective diffusivity that captures microstructural heterogeneity of the tissue. Under the assumptions of conservation of mass and Fickian diffusion, the concentration evolves according to the Partial Differential Equation (PDE)\n$$\nu_{t} = \\nabla \\cdot \\big(D \\nabla u\\big)\n$$\non the rectangular domain $\\Omega = (0,L_{x}) \\times (0,L_{y})$, with homogeneous Dirichlet boundary conditions $u=0$ on $\\partial\\Omega$ and a given initial condition $u(x,y,0)=u_{0}(x,y)$. You are to derive a conservative, fully implicit spatiotemporal discretization suitable for numerical simulation in biomedical systems modeling.\n\nLet the domain be partitioned into a uniform Cartesian grid with $N_{x}$ nodes in the $x$-direction and $N_{y}$ nodes in the $y$-direction, with spacings $h_{x} = L_{x}/(N_{x}-1)$ and $h_{y} = L_{y}/(N_{y}-1)$. Denote nodal unknowns by $u_{i,j}^{n} \\approx u(x_{i},y_{j},t^{n})$ with $x_{i} = (i-1)h_{x}$, $y_{j} = (j-1)h_{y}$, and $t^{n} = n\\Delta t$ for a fixed time step $\\Delta t>0$. To approximate fluxes across cell faces while honoring heterogeneity in $D(x,y)$, use a face-centered diffusion coefficient obtained by the harmonic average of adjacent nodal values, e.g.,\n$$\nD_{i+\\frac{1}{2},j} = \\left(\\frac{1}{2}\\left(\\frac{1}{D_{i,j}}+\\frac{1}{D_{i+1,j}}\\right)\\right)^{-1} = \\frac{2D_{i,j}D_{i+1,j}}{D_{i,j}+D_{i+1,j}},\n$$\nwith similar definitions for $D_{i-\\frac{1}{2},j}$, $D_{i,j+\\frac{1}{2}}$, and $D_{i,j-\\frac{1}{2}}$.\n\nStarting from the conservation law and Fick’s law, and using the Finite Difference Method (FDM) in a conservative flux form, perform the following:\n\n- Derive the fully implicit backward Euler update for interior nodes $(i,j)$, $i\\in\\{2,\\dots,N_{x}-1\\}$, $j\\in\\{2,\\dots,N_{y}-1\\}$, expressing the discrete divergence in terms of face-centered fluxes and central differences of $u^{n+1}$.\n- Assemble the resulting linear system $\\mathbf{A}\\mathbf{u}^{n+1}=\\mathbf{b}$ under homogeneous Dirichlet boundary conditions, carefully identifying the stencil and coefficients coupling $(i,j)$ to its nearest neighbors $(i\\pm 1,j)$ and $(i,j\\pm 1)$.\n- Describe the structure of $\\mathbf{A}$ under lexicographic ordering of unknowns (e.g., row-by-row), including its symmetry and sparsity pattern, in terms of the five-point stencil induced by the conservative flux discretization.\n\nFinally, provide the exact analytic expression for the diagonal entry of the coefficient matrix corresponding to a generic interior node $(i,j)$ in the fully implicit scheme, expressed in terms of $\\Delta t$, $h_{x}$, $h_{y}$, and the face-centered diffusion coefficients $D_{i\\pm\\frac{1}{2},j}$, $D_{i,j\\pm\\frac{1}{2}}$. Your final answer must be this single closed-form expression. No numerical evaluation is required, and no units should be included in the final boxed expression.",
            "solution": "The physical starting point is conservation of mass and Fick’s law for diffusion. Conservation of mass in a control volume implies that the rate of change of the concentration $u$ equals the net inflow of flux, so\n$$\nu_{t} = \\nabla \\cdot \\big(D \\nabla u\\big),\n$$\nwhere $D(x,y)$ is the effective diffusivity. This equation is consistent with Fick’s law, which states that diffusive flux is proportional to the gradient of concentration, $\\mathbf{J} = -D \\nabla u$, and conservation gives $u_{t} = -\\nabla \\cdot \\mathbf{J} = \\nabla\\cdot(D\\nabla u)$.\n\nWe discretize $\\Omega$ on a uniform Cartesian grid and derive a conservative discrete divergence using face-centered fluxes. Define the nodal values $u_{i,j}^{n}$, the spacings $h_{x}$, $h_{y}$, and a time step $\\Delta t$. At an interior node $(i,j)$, consider a rectangular control volume centered at $(x_{i},y_{j})$ with face locations at $x_{i\\pm\\frac{1}{2}} = x_{i}\\pm\\frac{h_{x}}{2}$ and $y_{j\\pm\\frac{1}{2}} = y_{j}\\pm\\frac{h_{y}}{2}$. The continuous divergence can be approximated by net flux across the faces divided by the control volume dimensions. The discrete flux in the $x$-direction at the right face is\n$$\nJ_{x}\\big|_{i+\\frac{1}{2},j} = -D_{i+\\frac{1}{2},j}\\,\\frac{u_{i+1,j}-u_{i,j}}{h_{x}},\n$$\nand at the left face\n$$\nJ_{x}\\big|_{i-\\frac{1}{2},j} = -D_{i-\\frac{1}{2},j}\\,\\frac{u_{i,j}-u_{i-1,j}}{h_{x}}.\n$$\nSimilarly, in the $y$-direction, the flux at the top face is\n$$\nJ_{y}\\big|_{i,j+\\frac{1}{2}} = -D_{i,j+\\frac{1}{2}}\\,\\frac{u_{i,j+1}-u_{i,j}}{h_{y}},\n$$\nand at the bottom face\n$$\nJ_{y}\\big|_{i,j-\\frac{1}{2}} = -D_{i,j-\\frac{1}{2}}\\,\\frac{u_{i,j}-u_{i,j-1}}{h_{y}}.\n$$\nThese expressions employ face-centered diffusion coefficients $D_{i\\pm\\frac{1}{2},j}$ and $D_{i,j\\pm\\frac{1}{2}}$. To model heterogeneous tissues with discontinuous or sharply varying $D$, a conservative choice that preserves flux continuity is the harmonic average between adjacent nodal diffusivities, e.g.,\n$$\nD_{i+\\frac{1}{2},j} = \\left(\\frac{1}{2}\\left(\\frac{1}{D_{i,j}}+\\frac{1}{D_{i+1,j}}\\right)\\right)^{-1} = \\frac{2D_{i,j}D_{i+1,j}}{D_{i,j}+D_{i+1,j}},\n$$\nwith analogous definitions for $D_{i-\\frac{1}{2},j}$, $D_{i,j+\\frac{1}{2}}$, and $D_{i,j-\\frac{1}{2}}$.\n\nBy the finite-volume viewpoint, the discrete divergence at $(i,j)$ is the net outward flux divided by the cell dimensions. Using the above fluxes, the discrete spatial operator $\\mathcal{L}[u]_{i,j}$ is\n$$\n\\mathcal{L}[u]_{i,j} = \\frac{J_{x}\\big|_{i+\\frac{1}{2},j}-J_{x}\\big|_{i-\\frac{1}{2},j}}{h_{x}} + \\frac{J_{y}\\big|_{i,j+\\frac{1}{2}}-J_{y}\\big|_{i,j-\\frac{1}{2}}}{h_{y}}.\n$$\nSubstituting the flux definitions yields\n\\begin{align*}\n\\mathcal{L}[u]_{i,j}\n&= \\frac{1}{h_{x}}\\left( -D_{i+\\frac{1}{2},j}\\,\\frac{u_{i+1,j}-u_{i,j}}{h_{x}} + D_{i-\\frac{1}{2},j}\\,\\frac{u_{i,j}-u_{i-1,j}}{h_{x}} \\right) \\\\\n&\\quad + \\frac{1}{h_{y}}\\left( -D_{i,j+\\frac{1}{2}}\\,\\frac{u_{i,j+1}-u_{i,j}}{h_{y}} + D_{i,j-\\frac{1}{2}}\\,\\frac{u_{i,j}-u_{i,j-1}}{h_{y}} \\right) \\\\\n&= -\\frac{D_{i+\\frac{1}{2},j}}{h_{x}^{2}} u_{i+1,j} + \\left(\\frac{D_{i+\\frac{1}{2},j}+D_{i-\\frac{1}{2},j}}{h_{x}^{2}}\\right) u_{i,j} - \\frac{D_{i-\\frac{1}{2},j}}{h_{x}^{2}} u_{i-1,j} \\\\\n&\\quad -\\frac{D_{i,j+\\frac{1}{2}}}{h_{y}^{2}} u_{i,j+1} + \\left(\\frac{D_{i,j+\\frac{1}{2}}+D_{i,j-\\frac{1}{2}}}{h_{y}^{2}}\\right) u_{i,j} - \\frac{D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} u_{i,j-1}.\n\\end{align*}\nWe now adopt the fully implicit backward Euler time discretization:\n$$\n\\frac{u_{i,j}^{n+1}-u_{i,j}^{n}}{\\Delta t} = \\mathcal{L}[u^{n+1}]_{i,j}.\n$$\nMultiplying by $\\Delta t$ and moving all terms involving $u^{n+1}$ to the left-hand side, we obtain the linear system at each interior node $(i,j)$:\n\\begin{align*}\n&\\left( 1 + \\Delta t \\left[ \\frac{D_{i+\\frac{1}{2},j}+D_{i-\\frac{1}{2},j}}{h_{x}^{2}} + \\frac{D_{i,j+\\frac{1}{2}}+D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} \\right] \\right) u_{i,j}^{n+1} \\\\\n&\\quad - \\Delta t \\left( \\frac{D_{i+\\frac{1}{2},j}}{h_{x}^{2}} \\right) u_{i+1,j}^{n+1}\n- \\Delta t \\left( \\frac{D_{i-\\frac{1}{2},j}}{h_{x}^{2}} \\right) u_{i-1,j}^{n+1}\n- \\Delta t \\left( \\frac{D_{i,j+\\frac{1}{2}}}{h_{y}^{2}} \\right) u_{i,j+1}^{n+1}\n- \\Delta t \\left( \\frac{D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} \\right) u_{i,j-1}^{n+1}\n= u_{i,j}^{n}.\n\\end{align*}\nUnder homogeneous Dirichlet boundary conditions $u=0$ on $\\partial\\Omega$, the boundary nodes are known and do not appear as unknowns in the system; contributions involving neighbors outside the interior index set vanish or are incorporated into the right-hand side if needed (for nonzero boundary data).\n\nCollecting unknowns $\\{u_{i,j}^{n+1}\\}$ in a lexicographic order, e.g., $(i,j)$ mapped to a single index $p = (j-1)N_{x} + i$, the matrix $\\mathbf{A}$ has a five-point stencil: each interior node couples to itself and its four nearest neighbors $(i\\pm 1,j)$ and $(i,j\\pm 1)$. The diagonal entry at $(i,j)$ is\n$$\na_{i,j} = 1 + \\Delta t \\left( \\frac{D_{i+\\frac{1}{2},j}+D_{i-\\frac{1}{2},j}}{h_{x}^{2}} + \\frac{D_{i,j+\\frac{1}{2}}+D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} \\right),\n$$\nand the off-diagonal entries to neighbors are\n\\begin{align*}\na_{i,j;i+1,j} &= - \\Delta t \\left( \\frac{D_{i+\\frac{1}{2},j}}{h_{x}^{2}} \\right), \\\\\na_{i,j;i-1,j} &= - \\Delta t \\left( \\frac{D_{i-\\frac{1}{2},j}}{h_{x}^{2}} \\right), \\\\\na_{i,j;i,j+1} &= - \\Delta t \\left( \\frac{D_{i,j+\\frac{1}{2}}}{h_{y}^{2}} \\right), \\\\\na_{i,j;i,j-1} &= - \\Delta t \\left( \\frac{D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} \\right).\n\\end{align*}\nSymmetry arises because the flux contribution across a shared face appears with the same magnitude in the two neighboring equations when $D_{i+\\frac{1}{2},j}$ equals $D_{i+1/2,j}$ computed by the same harmonic averaging rule; thus $\\mathbf{A}$ is symmetric. With homogeneous Dirichlet boundaries, $\\mathbf{A}$ is also strictly diagonally dominant and, due to the underlying diffusion operator, Symmetric Positive Definite (SPD).\n\nTherefore, the requested diagonal entry for a generic interior node $(i,j)$ in the fully implicit scheme is the analytic expression\n$$\n1 + \\Delta t \\left( \\frac{D_{i+\\frac{1}{2},j}+D_{i-\\frac{1}{2},j}}{h_{x}^{2}} + \\frac{D_{i,j+\\frac{1}{2}}+D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} \\right).\n$$",
            "answer": "$$\\boxed{1 + \\Delta t \\left( \\frac{D_{i+\\frac{1}{2},j}+D_{i-\\frac{1}{2},j}}{h_{x}^{2}} + \\frac{D_{i,j+\\frac{1}{2}}+D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} \\right)}$$"
        },
        {
            "introduction": "A numerical model is incomplete without a rigorous verification of its accuracy. In this practical exercise , you will implement a complete Crank-Nicolson solver and learn how to quantify its error using discrete norms that approximate continuous mathematical norms. This practice connects the abstract theory of convergence with the concrete task of writing reliable scientific code, showing how norms like the discrete $L^2$ and $H^1$ relate to physical quantities like the total amount of a substance and its diffusive flux, respectively.",
            "id": "3913301",
            "problem": "Consider a one-dimensional, nondimensional diffusion of a solute in a slab representing a homogeneous tissue, modeled on the spatial domain $x \\in (0,1)$ by the partial differential equation (PDE) $u_t = u_{xx}$ with homogeneous Dirichlet boundary conditions $u(0,t) = 0$ and $u(1,t) = 0$ for all $t \\ge 0$. The field $u(x,t)$ denotes nondimensionalized concentration, obtained by scaling concentration by a characteristic concentration $C_0$, length by a characteristic length $L$, and time by $L^2/D_0$ for a reference diffusion coefficient $D_0$. You must solve this initial-boundary value problem numerically using the finite difference method on a uniform spatial grid with $N$ interior points and the Crank-Nicolson time-stepping scheme for a final time $T$. The exact solution for an initial condition composed of sine modes $u(x,0) = \\sum_{k} a_k \\sin(k \\pi x)$ is $u(x,t) = \\sum_{k} a_k \\exp\\left(- (k \\pi)^2 t\\right) \\sin(k \\pi x)$, which you should use as ground truth to quantify the numerical error at time $T$.\n\nStarting from conservation of mass and Fick’s first law, and using consistent Riemann sum approximations on the uniform grid with spacing $\\Delta x = 1/(N+1)$, derive and implement:\n- a discrete $L^2$ norm of the error $e(x) = u_{\\text{num}}(x,T) - u_{\\text{exact}}(x,T)$ over $(0,1)$, and\n- a discrete $H^1$-like seminorm of the error based on the grid approximation to the gradient, using the homogeneous Dirichlet boundary conditions at $x=0$ and $x=1$.\n\nThese discrete quantities must be defined so that they are consistent with the continuous $L^2$ norm $\\|e\\|_{L^2(0,1)} = \\left(\\int_0^1 e(x)^2 \\, dx\\right)^{1/2}$ and the continuous $H^1$ seminorm $|e|_{H^1(0,1)} = \\left(\\int_0^1 (e_x(x))^2 \\, dx\\right)^{1/2}$.\n\nUse the Crank-Nicolson scheme in time with a uniform time step $\\Delta t$ such that $M = T/\\Delta t$ is an integer. Spatial discretization must use second-order centered differences on the interior points, enforcing $u=0$ at the boundaries. Initialize the numerical solution by sampling the prescribed initial condition at the interior grid points.\n\nYou must implement a single program that, for each test case, computes the discrete $L^2$ error and the discrete $H^1$-like seminorm error at time $T$ and returns these two errors as real numbers without physical units (nondimensional). Angles, if any, must be interpreted in radians. The final output must aggregate all test cases into one line.\n\nTest suite to implement:\n- Case $1$ (baseline, single mode): $N = 64$, $T = 0.05$, $\\Delta t = 0.0005$, initial condition $u(x,0) = 1.0 \\cdot \\sin(1 \\cdot \\pi x)$.\n- Case $2$ (multi-modal): $N = 64$, $T = 0.02$, $\\Delta t = 0.00025$, initial condition $u(x,0) = 0.7 \\cdot \\sin(1 \\cdot \\pi x) + 0.3 \\cdot \\sin(2 \\cdot \\pi x)$.\n- Case $3$ (coarse grid, higher mode): $N = 8$, $T = 0.005$, $\\Delta t = 0.0005$, initial condition $u(x,0) = 1.0 \\cdot \\sin(3 \\cdot \\pi x)$.\n- Case $4$ (long time decay): $N = 64$, $T = 0.5$, $\\Delta t = 0.001$, initial condition $u(x,0) = 1.0 \\cdot \\sin(4 \\cdot \\pi x)$.\n- Case $5$ (near-Nyquist content): $N = 32$, $T = 0.005$, $\\Delta t = 0.0001$, initial condition $u(x,0) = 1.0 \\cdot \\sin(10 \\cdot \\pi x)$.\n\nFor each case, compute the two scalar outputs: the discrete $L^2$ error and the discrete $H^1$-like seminorm error at time $T$, both as nonnegative real numbers.\n\nFinal output format requirement:\n- Your program should produce a single line of output containing the list of case results, each case represented as a two-element list $[E_{L2},E_{H1}]$. The entire output must be a single list of these pairs, with no spaces, numbers formatted in lower-case scientific notation with exactly eight digits after the decimal point. For example, an output with two cases should look like $[[1.23456789e-04,2.34567891e-03],[\\dots,\\dots],\\dots]$ where the ellipses indicate additional cases. The program must print exactly this single line.\n\nNote: Because the model is nondimensionalized, you must not report any physical units in the output. All computations should be deterministic with the given parameters.",
            "solution": "The problem presented is a well-posed initial-boundary value problem for the one-dimensional diffusion (heat) equation. It is grounded in fundamental principles of transport phenomena, mathematically consistent, and all parameters required for a numerical solution are provided. The problem is therefore deemed valid and a solution will be provided.\n\nThe task is to solve the nondimensionalized diffusion equation\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial^2 u}{\\partial x^2}\n$$\non the spatial domain $x \\in (0,1)$ for time $t \\ge 0$. The boundary conditions are of the homogeneous Dirichlet type, $u(0,t) = 0$ and $u(1,t) = 0$. The initial condition is given as a sum of sine modes, $u(x,0) = \\sum_{k} a_k \\sin(k \\pi x)$. We will use the Crank-Nicolson finite difference method and then derive and compute discrete error norms.\n\n### Numerical Scheme: Crank-Nicolson Method\n\nWe first discretize the domain. The spatial domain $(0,1)$ is discretized into $N+1$ equal subintervals of width $\\Delta x = 1/(N+1)$. This defines a grid with $N$ interior points $x_i = i \\Delta x$ for $i=1, 2, \\dots, N$. The boundary points are $x_0 = 0$ and $x_{N+1} = 1$. The time domain is discretized with a uniform step $\\Delta t$, such that $t_j = j \\Delta t$. Let $u_i^j \\approx u(x_i, t_j)$ be the numerical approximation of the solution at grid point $(x_i, t_j)$.\n\nThe spatial second derivative $u_{xx}$ at grid point $x_i$ is approximated using a second-order centered difference:\n$$\n\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{x_i, t_j} \\approx \\frac{u_{i-1}^j - 2u_i^j + u_{i+1}^j}{(\\Delta x)^2}\n$$\n\nThe Crank-Nicolson scheme discretizes the time derivative using a forward difference and approximates the spatial derivative as the average of its values at time $t_j$ and $t_{j+1}$:\n$$\n\\frac{u_i^{j+1} - u_i^j}{\\Delta t} = \\frac{1}{2} \\left( \\frac{u_{i-1}^{j+1} - 2u_i^{j+1} + u_{i+1}^{j+1}}{(\\Delta x)^2} + \\frac{u_{i-1}^{j} - 2u_i^j + u_{i+1}^j}{(\\Delta x)^2} \\right)\n$$\nLet's define the parameter $r = \\frac{\\Delta t}{2(\\Delta x)^2}$. We can rearrange the equation to separate the unknown terms at step $j+1$ (left-hand side) from the known terms at step $j$ (right-hand side):\n$$\n-r u_{i-1}^{j+1} + (1+2r) u_i^{j+1} - r u_{i+1}^{j+1} = r u_{i-1}^{j} + (1-2r) u_i^j + r u_{i+1}^j\n$$\nThis equation is valid for the $N$ interior points, $i=1, \\dots, N$. The boundary conditions imply $u_0^j = 0$ and $u_{N+1}^j=0$ for all $j$.\n\nLet $\\mathbf{u}^j = [u_1^j, u_2^j, \\dots, u_N^j]^T$ be the vector of solution values at the interior points at time $t_j$. The system of equations can be written in matrix form as:\n$$\n\\mathbf{A} \\mathbf{u}^{j+1} = \\mathbf{B} \\mathbf{u}^j\n$$\nwhere $\\mathbf{A}$ and $\\mathbf{B}$ are $N \\times N$ tridiagonal matrices:\n$$\n\\mathbf{A} = \\begin{pmatrix}\n1+2r & -r & 0 & \\dots \\\\\n-r & 1+2r & -r & \\dots \\\\\n0 & \\ddots & \\ddots & \\ddots \\\\\n\\dots & 0 & -r & 1+2r\n\\end{pmatrix}\n\\quad , \\quad\n\\mathbf{B} = \\begin{pmatrix}\n1-2r & r & 0 & \\dots \\\\\nr & 1-2r & r & \\dots \\\\\n0 & \\ddots & \\ddots & \\ddots \\\\\n\\dots & 0 & r & 1-2r\n\\end{pmatrix}\n$$\nTo advance the solution from time $t_j$ to $t_{j+1}$, we solve the linear system $\\mathbf{A} \\mathbf{u}^{j+1} = \\mathbf{b}^j$, where $\\mathbf{b}^j = \\mathbf{B} \\mathbf{u}^j$. Since $\\mathbf{A}$ is symmetric, positive-definite, and tridiagonal, this system can be solved very efficiently.\n\n### Derivation of Discrete Error Norms\n\nThe error at the final time $T$ is $e(x) = u_{\\text{num}}(x,T) - u_{\\text{exact}}(x,T)$. Let $e_i = e(x_i)$ be the error at the interior grid points, $i=1, \\dots, N$. The boundary conditions ensure that the error is zero at the boundaries, so $e_0 = e(x_0) = 0$ and $e_{N+1} = e(x_{N+1}) = 0$.\n\n**Discrete $L^2$ Norm**\n\nThe continuous $L^2$ norm is defined by the integral $\\|e\\|_{L^2(0,1)} = \\left(\\int_0^1 e(x)^2 \\, dx\\right)^{1/2}$. We approximate this integral using a Riemann sum over the interior grid points. Each grid point $x_i$ can be seen as representing a cell of width $\\Delta x$. The integral is approximated as:\n$$\n\\int_0^1 e(x)^2 \\, dx \\approx \\sum_{i=1}^{N} e(x_i)^2 \\Delta x = \\Delta x \\sum_{i=1}^{N} e_i^2\n$$\nThis leads to the definition of the discrete $L^2$ norm of the error:\n$$\nE_{L2} = \\|e\\|_{\\text{discrete } L^2} = \\left(\\Delta x \\sum_{i=1}^{N} e_i^2\\right)^{1/2}\n$$\nIn terms of the error vector $\\mathbf{e} = [e_1, \\dots, e_N]^T$, this is $\\sqrt{\\Delta x} \\|\\mathbf{e}\\|_2$, where $\\|\\cdot\\|_2$ is the standard Euclidean vector norm.\n\n**Discrete $H^1$-like Seminorm**\n\nThe continuous $H^1$ seminorm involves the spatial derivative: $|e|_{H^1(0,1)} = \\left(\\int_0^1 (e_x(x))^2 \\, dx\\right)^{1/2}$, where $e_x = \\partial e / \\partial x$. This integral is related to the energy of the diffusive flux, which via Fick's law is proportional to the concentration gradient. We first approximate the derivative $e_x$. A consistent choice is a first-order finite difference centered between grid points. At the midpoint $x_{i+1/2} = (x_i+x_{i+1})/2$, the derivative is approximated as:\n$$\ne_x(x_{i+1/2}) \\approx \\frac{e_{i+1} - e_i}{\\Delta x}\n$$\nWe have $N+1$ such midpoints, for $i = 0, \\dots, N$. We then approximate the integral of $(e_x)^2$ using a midpoint rule quadrature, summing over the $N+1$ intervals:\n$$\n\\int_0^1 (e_x(x))^2 \\, dx \\approx \\sum_{i=0}^{N} \\left( e_x(x_{i+1/2}) \\right)^2 \\Delta x \\approx \\sum_{i=0}^{N} \\left( \\frac{e_{i+1} - e_i}{\\Delta x} \\right)^2 \\Delta x = \\frac{1}{\\Delta x} \\sum_{i=0}^{N} (e_{i+1} - e_i)^2\n$$\nGiven the boundary conditions, $e_0 = e_{N+1} = 0$. The resulting discrete $H^1$-like seminorm of the error is:\n$$\nE_{H1} = |e|_{\\text{discrete } H^1} = \\left(\\frac{1}{\\Delta x} \\sum_{i=0}^{N} (e_{i+1} - e_i)^2\\right)^{1/2}\n$$\n\n### Implementation\nThe numerical solution is found by first setting the initial state vector $\\mathbf{u}^0$ by sampling the given initial condition $u(x,0)$ at the interior grid points. Then, for each time step up to the final time $T$, the tridiagonal system $\\mathbf{A} \\mathbf{u}^{j+1} = \\mathbf{B} \\mathbf{u}^j$ is solved for $\\mathbf{u}^{j+1}$. The final numerical solution vector is $u_{\\text{num}}(x_i, T)$. The exact solution is also evaluated at the same grid points and time. The error vector is computed, and the two discrete norms $E_{L2}$ and $E_{H1}$ are calculated using the derived formulas.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Solves the 1D diffusion equation using the Crank-Nicolson method for several\n    test cases and computes L2 and H1-seminorm errors.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1: (N, T, dt, initial_condition_modes)\n        (64, 0.05, 0.0005, [(1.0, 1)]),\n        # Case 2\n        (64, 0.02, 0.00025, [(0.7, 1), (0.3, 2)]),\n        # Case 3\n        (8, 0.005, 0.0005, [(1.0, 3)]),\n        # Case 4\n        (64, 0.5, 0.001, [(1.0, 4)]),\n        # Case 5\n        (32, 0.005, 0.0001, [(1.0, 10)])\n    ]\n    \n    results = []\n\n    for N, T, dt, ic_modes in test_cases:\n        \n        # 1. Grid and parameter setup\n        dx = 1.0 / (N + 1)\n        x_interior = np.linspace(dx, 1.0 - dx, N)\n        M = int(round(T / dt))\n\n        # 2. Define initial and exact solution functions\n        def u_initial(x, modes):\n            res = np.zeros_like(x, dtype=float)\n            for a, k in modes:\n                res += a * np.sin(k * np.pi * x)\n            return res\n\n        def u_exact(x, t, modes):\n            res = np.zeros_like(x, dtype=float)\n            for a, k in modes:\n                res += a * np.exp(-(k * np.pi)**2 * t) * np.sin(k * np.pi * x)\n            return res\n\n        # 3. Crank-Nicolson solver setup\n        r = dt / (2.0 * dx**2)\n        \n        # Matrix A (LHS) in banded format for scipy.linalg.solve_banded\n        # (1, 1) indicates 1 lower and 1 upper diagonal\n        ab_A = np.zeros((3, N))\n        ab_A[0, 1:] = -r       # Upper diagonal\n        ab_A[1, :] = 1.0 + 2.0 * r # Main diagonal\n        ab_A[2, :-1] = -r      # Lower diagonal\n\n        # Initialize solution vector\n        u_current = u_initial(x_interior, ic_modes)\n        \n        # 4. Time stepping loop\n        for _ in range(M):\n            # Construct RHS vector b = B @ u_current\n            # B is tridiagonal with (r, 1-2r, r)\n            b = np.zeros(N)\n            # Interior points of the vector\n            if N > 2:\n                b[1:-1] = r * u_current[:-2] + (1.0 - 2.0 * r) * u_current[1:-1] + r * u_current[2:]\n            # Endpoints of the vector (handles N=1 and N=2 cases correctly)\n            if N >= 1:\n                b[0] = (1.0 - 2.0 * r) * u_current[0]\n                if N > 1:\n                    b[0] += r * u_current[1]\n            if N >= 2:\n                b[-1] = r * u_current[-2] + (1.0 - 2.0 * r) * u_current[-1]\n            \n            # Solve the tridiagonal system A * u_next = b\n            u_next = solve_banded((1, 1), ab_A, b)\n            u_current = u_next\n        \n        u_final_numeric = u_current\n        \n        # 5. Error calculation\n        u_final_exact = u_exact(x_interior, T, ic_modes)\n        error_vec = u_final_numeric - u_final_exact\n        \n        # 6. Compute discrete norms\n        # L2 norm\n        l2_error = np.sqrt(dx * np.sum(error_vec**2))\n        \n        # H1-like seminorm\n        # Need to include boundary points (error is 0 there)\n        error_vec_full = np.concatenate(([0.0], error_vec, [0.0]))\n        error_diffs = np.diff(error_vec_full)\n        h1_seminorm_error = np.sqrt(np.sum(error_diffs**2) / dx)\n        \n        results.append([l2_error, h1_seminorm_error])\n\n    # 7. Final print statement in the exact required format\n    output_str = \",\".join([f\"[{l2:.8e},{h1:.8e}]\" for l2, h1 in results])\n    print(f\"[{output_str}]\")\n\nsolve()\n```"
        }
    ]
}