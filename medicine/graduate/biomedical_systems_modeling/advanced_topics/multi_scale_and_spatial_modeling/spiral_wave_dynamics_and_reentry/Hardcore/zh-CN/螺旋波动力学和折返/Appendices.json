{
    "hands_on_practices": [
        {
            "introduction": "本练习探讨了折返现象产生的基本条件。我们将使用一维环形模型，这是理解折返回路最简单的概念框架。通过这个实践，你将把心肌组织的内在电生理特性，例如动作电位时程（$APD$）和传导速度（$CV$），与维持循环波所需的最小物理尺寸联系起来。这项练习旨在帮助你建立从细胞级电生理到组织级心律失常之间可量化的联系，这是理解持续性心动过速等现象的关键一步 。",
            "id": "3929628",
            "problem": "考虑一个代表简化折返路径的心脏组织一维同质环模型。设周期长度定义为动作电位时程 (APD) 和舒张间期 (DI) 之和，并假设波前以依赖于局部 DI 的传导速度 (CV) 穿过环。单个循环波的周期长度自洽性要求，波前遍历环路所需的时间等于周期长度。假设有以下由实验得出的恢复函数：\n- 动作电位时程 (APD)：$APD(DI) = APD_{\\min} + \\Delta APD \\left(1 - \\exp\\left(-\\frac{DI}{\\tau_{A}}\\right)\\right)$,\n- 传导速度 (CV)：$CV(DI) = CV_{\\min} + \\Delta CV \\left(1 - \\exp\\left(-\\frac{DI}{\\tau_{C}}\\right)\\right)$,\n参数为 $APD_{\\min} = 0.160\\,\\text{s}$，$\\Delta APD = 0.040\\,\\text{s}$，$\\tau_{A} = 0.050\\,\\text{s}$，$CV_{\\min} = 0.30\\,\\text{m/s}$，$\\Delta CV = 0.30\\,\\text{m/s}$，以及 $\\tau_{C} = 0.040\\,\\text{s}$。假设没有复极化后不应期，因此有效不应期等于 APD，并要求 $DI \\geq 0$ 以维持持续传播。\n\n仅使用以上定义和环上单波折返的自洽性，推导出能够维持持续折返的最小路径长度 $L_{\\min}$。然后计算其在给定参数下的数值。最后，在可比较的实验装置中观察到的最小环路长度为 $L_{\\text{exp}} = 5.2\\,\\text{cm}$；使用你推导出的 $L_{\\min}$ 来评估其与该实验观察结果的一致性。\n\n以厘米表示最终的最小路径长度，并将你的答案四舍五入到四位有效数字。如果出现角度，请以弧度表示。",
            "solution": "### 问题验证\n\n#### 步骤 1：提取已知条件\n问题提供了以下数据、定义和条件：\n- **周期长度 (CL) 定义**：$CL = APD + DI$，其中 $APD$ 是动作电位时程，$DI$ 是舒张间期。\n- **自洽性条件**：对于长度为 $L$ 的环上的单个波，遍历环路所需的时间 $L/CV$ 等于周期长度。因此，$CL = L/CV$，其中 $CV$ 是传导速度。\n- **动作电位时程恢复函数**：$APD(DI) = APD_{\\min} + \\Delta APD \\left(1 - \\exp\\left(-\\frac{DI}{\\tau_{A}}\\right)\\right)$。\n- **传导速度恢复函数**：$CV(DI) = CV_{\\min} + \\Delta CV \\left(1 - \\exp\\left(-\\frac{DI}{\\tau_{C}}\\right)\\right)$。\n- **参数值**：\n  - $APD_{\\min} = 0.160\\,\\text{s}$\n  - $\\Delta APD = 0.040\\,\\text{s}$\n  - $\\tau_{A} = 0.050\\,\\text{s}$\n  - $CV_{\\min} = 0.30\\,\\text{m/s}$\n  - $\\Delta CV = 0.30\\,\\text{m/s}$\n  - $\\tau_{C} = 0.040\\,\\text{s}$\n- **持续传播的条件**：$DI \\geq 0$。\n- **实验观察结果**：$L_{\\text{exp}} = 5.2\\,\\text{cm}$。\n\n#### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题在心脏电生理学和生物医学系统建模领域有充分的科学依据。使用 $APD$ 和 $CV$ 的恢复曲线，以及环上自洽折返周期的概念，是分析室性心动过速等心律失常的标准方法。该模型是一个简化模型，但基于已建立的生物物理学原理。\n- **适定性**：该问题是适定的。它要求在一个指定的定义域 ($DI \\geq 0$) 上求一个数学上定义的函数 ($L(DI)$) 的最小值。该函数及其参数都得到了明确定义，从而可以得到一个唯一、稳定且有意义的解。\n- **客观性**：该问题以精确、客观的语言陈述。它使用形式化的数学表达式，并为所有参数提供了具体的数值，没有主观解释的余地。\n\n未发现与清单项目（科学或事实不准确、非形式化或不相关、不完整或矛盾的设置、不切实际或不可行、不适定或结构不良、伪深刻、或超出科学可验证性范围）相对应的缺陷。\n\n#### 步骤 3：结论和行动\n问题有效。将提供一个完整的、有理有据的解答。\n\n### 解答\n问题要求找到在一维心脏组织环上维持持续折返所需的最小路径长度 $L_{\\min}$。该分析基于循环波前的自洽性。\n\n首先，我们建立基本关系。折返的周期长度 ($CL$) 是动作电位时程 ($APD$) 和舒张间期 ($DI$) 的和：\n$$ CL = APD + DI $$\n对于一个在长度为 $L$ 的环上循环的稳定单波，其传播一周所需的时间必须等于周期长度。传播时间由长度除以传导速度 ($CV$) 给出。因此，自洽性条件为：\n$$ CL = \\frac{L}{CV} $$\n将 $CL$ 的两个表达式相等，我们得到路径长度 $L$ 与组织状态（由舒张间期 $DI$ 表征）之间的关系：\n$$ \\frac{L}{CV} = APD + DI $$\n$APD$ 和 $CV$ 本身依赖于前一个 $DI$。这种关系由给定的恢复函数描述。我们可以将路径长度 $L$ 表示为 $DI$ 的函数：\n$$ L(DI) = CV(DI) \\times (APD(DI) + DI) $$\n为了找到允许持续折返的最小路径长度 $L_{\\min}$，我们必须在 $DI$ 的允许范围（即 $DI \\geq 0$）内找到函数 $L(DI)$ 的最小值。\n\n让我们将给定的恢复函数代入 $L(DI)$ 的表达式中：\n$$ L(DI) = \\left[ CV_{\\min} + \\Delta CV \\left(1 - \\exp\\left(-\\frac{DI}{\\tau_{C}}\\right)\\right) \\right] \\times \\left[ APD_{\\min} + \\Delta APD \\left(1 - \\exp\\left(-\\frac{DI}{\\tau_{A}}\\right)\\right) + DI \\right] $$\n为了找到 $L(DI)$ 在 $DI \\geq 0$ 上的最小值，我们分析它关于 $DI$ 的导数，记为 $L'(DI) = \\frac{dL}{d(DI)}$。为清晰起见，我们定义两个函数：\n$$ f(DI) = CV(DI) = CV_{\\min} + \\Delta CV \\left(1 - \\exp\\left(-\\frac{DI}{\\tau_{C}}\\right)\\right) $$\n$$ g(DI) = APD(DI) + DI = APD_{\\min} + \\Delta APD \\left(1 - \\exp\\left(-\\frac{DI}{\\tau_{A}}\\right)\\right) + DI $$\n那么，$L(DI) = f(DI) \\times g(DI)$。根据乘法求导法则，我们有：\n$$ L'(DI) = f'(DI) g(DI) + f(DI) g'(DI) $$\n让我们计算导数 $f'(DI)$ 和 $g'(DI)$：\n$$ f'(DI) = \\frac{d}{d(DI)} \\left[ CV_{\\min} + \\Delta CV \\left(1 - \\exp\\left(-\\frac{DI}{\\tau_{C}}\\right)\\right) \\right] = \\frac{\\Delta CV}{\\tau_{C}} \\exp\\left(-\\frac{DI}{\\tau_{C}}\\right) $$\n$$ g'(DI) = \\frac{d}{d(DI)} \\left[ APD_{\\min} + \\Delta APD \\left(1 - \\exp\\left(-\\frac{DI}{\\tau_{A}}\\right)\\right) + DI \\right] = \\frac{\\Delta APD}{\\tau_{A}} \\exp\\left(-\\frac{DI}{\\tau_{A}}\\right) + 1 $$\n现在我们检验 $DI \\geq 0$ 时 $L'(DI)$ 表达式中每一项的符号。所有给定的参数（$CV_{\\min}$、$\\Delta CV$、$\\tau_{C}$、$APD_{\\min}$、$\\Delta APD$、$\\tau_{A}$）都是正常数。\n- 对于 $DI \\geq 0$，项 $\\exp\\left(-\\frac{DI}{\\tau_{C}}\\right)$ 总是正的。因此，$f'(DI) > 0$。\n- 对于 $DI \\geq 0$，项 $\\exp\\left(-\\frac{DI}{\\tau_{A}}\\right)$ 总是正的。因此，$g'(DI) > 0$。\n- 函数 $f(DI) = CV(DI)$ 代表传导速度，对于传播而言必须为正。给定 $CV_{\\min} = 0.30\\,\\text{m/s}$ 和 $\\Delta CV = 0.30\\,\\text{m/s}$，有 $CV(DI) \\geq CV_{\\min} > 0$。因此，$f(DI) > 0$。\n- 函数 $g(DI) = APD(DI) + DI$。给定 $APD_{\\min} = 0.160\\,\\text{s}$ 和 $\\Delta APD = 0.040\\,\\text{s}$，有 $APD(DI) \\geq APD_{\\min} > 0$。对于 $DI \\geq 0$，可得 $g(DI) = APD(DI) + DI > 0$。\n\n由于当 $DI \\geq 0$ 时，$f(DI)$、$g(DI)$、$f'(DI)$ 和 $g'(DI)$ 都是严格为正的，它们的乘积和总和也必须是严格为正的：\n$$ L'(DI) = \\underbrace{f'(DI)}_{>0} \\underbrace{g(DI)}_{>0} + \\underbrace{f(DI)}_{>0} \\underbrace{g'(DI)}_{>0} > 0 $$\n一个严格为正的导数意味着函数 $L(DI)$ 在所有 $DI \\geq 0$ 上是单调递增的。对于一个在区间 $[0, \\infty)$ 上定义的单调递增函数，其最小值必然出现在区间的下边界处，即 $DI = 0$。\n\n因此，最小路径长度 $L_{\\min}$ 可通过计算 $L(DI)$ 在 $DI = 0$ 处的值得到：\n$$ L_{\\min} = L(0) = CV(0) \\times (APD(0) + 0) = CV(0) \\times APD(0) $$\n我们使用它们的定义来计算 $APD(0)$ 和 $CV(0)$：\n$$ APD(0) = APD_{\\min} + \\Delta APD \\left(1 - \\exp(0)\\right) = APD_{\\min} + \\Delta APD (1 - 1) = APD_{\\min} $$\n$$ CV(0) = CV_{\\min} + \\Delta CV \\left(1 - \\exp(0)\\right) = CV_{\\min} + \\Delta CV (1 - 1) = CV_{\\min} $$\n将这些结果代回 $L_{\\min}$ 的表达式，得到一个简单的结果：\n$$ L_{\\min} = CV_{\\min} \\times APD_{\\min} $$\n现在我们代入给定参数的数值：\n$$ L_{\\min} = (0.30\\,\\text{m/s}) \\times (0.160\\,\\text{s}) = 0.048\\,\\text{m} $$\n问题要求结果以厘米表示，并四舍五入到四位有效数字。\n$$ L_{\\min} = 0.048\\,\\text{m} \\times \\frac{100\\,\\text{cm}}{1\\,\\text{m}} = 4.8\\,\\text{cm} $$\n四舍五入到四位有效数字得到 $4.800\\,\\text{cm}$。\n\n最后，我们评估此结果与实验观察值 $L_{\\text{exp}} = 5.2\\,\\text{cm}$ 的一致性。要使持续折返成为可能，实际路径长度必须大于或等于理论最小路径长度。\n条件是 $L \\geq L_{\\min}$。\n在本例中，我们有 $L_{\\text{exp}} = 5.2\\,\\text{cm}$，并且我们计算出 $L_{\\min} = 4.800\\,\\text{cm}$。由于 $5.2 > 4.800$，条件 $L_{\\text{exp}} \\geq L_{\\min}$ 得到满足。这意味着观察到 $5.2\\,\\text{cm}$ 的折返环路与理论模型是一致的，因为这样的环路足够长以支持持续折返。最小路径长度本身就是计算出的那个值。",
            "answer": "$$\\boxed{4.800}$$"
        },
        {
            "introduction": "在理解了一维环路中的折返之后，我们现在将模型扩展到更符合实际的二维螺旋波。螺旋波是折返在二维介质中的表现形式，其中心存在一个不被兴奋的核心。本练习利用程函-曲率关系来模拟波前曲率如何限制传播，并最终决定核心的大小以及螺旋波的旋转周期。这项实践为你搭建了一座关键的桥梁，将微观的波前动力学与宏观的转子特性联系起来 。",
            "id": "3929698",
            "problem": "考虑一个在模拟心脏组织的均匀、各向同性的二维可兴奋介质中刚性旋转的螺旋波。假设界面的传播遵循程函-曲率关系，该关系指出激活波前的局部法向速度 $v_{n}$ 与其曲率 $\\kappa$ 呈线性关系，即 $v_{n} = v_{0} - D\\,\\kappa$，其中 $v_{0}$ 是在没有曲率时的平面波速，而 $D$ 是一个正的曲率敏感性系数，其量纲为长度的平方除以时间。螺旋波有一个半径为 $r_{c}$ 的圆形核心，该核心被定义为波前因其法向速度停滞而无法再向内推进的边界。螺旋波图案围绕此核心刚性旋转，使得在核心边界上观察到的相沿着圆形路径以局部相速度 $v$ 切向推进。\n\n仅使用这些假设和基本几何事实，完成以下任务：\n1) 从程函-曲率关系和半径为 $r_{c}$、曲率为 $\\kappa = 1/r_{c}$ 的圆形边界的定义出发，推导在停滞边界处（$v_{n} = 0$）$r_{c}$ 的表达式。\n2) 利用核心边界处的刚性旋转运动学，推导转子周期 $T$ 关于 $r_{c}$ 和核心边界上局部切向相速度 $v$ 的近似表达式。\n3) 使用您推导的表达式，在给定 $v_{0} = 0.30$ m/s，$D = 1.5 \\times 10^{-3}$ m$^{2}$/s 和 $v = 0.35$ m/s 的情况下计算 $T$。以秒为单位表示您的最终答案，并将结果四舍五入到三位有效数字。",
            "solution": "该问题要求对可兴奋介质中刚性旋转的螺旋波进行三部分的推导和计算。我们将系统地处理每个部分，确保遵循所提供的物理模型和假设。\n\n第 $1$ 部分：核心半径 $r_c$ 的推导。\n激活波前的传播由给定的程函-曲率关系控制：\n$$v_{n} = v_{0} - D\\,\\kappa$$\n其中 $v_{n}$ 是波前的局部法向速度，$v_{0}$ 是在没有曲率时的平面波速，$D$ 是正的曲率敏感性系数，而 $\\kappa$ 是波前的局部曲率。\n\n问题将螺旋波的核心定义为半径为 $r_{c}$ 的圆形边界。在这个特定的边界上，有两个关键条件成立：\n$1$. 波前据说会停滞。这在物理上意味着其向内的法向速度变为零，因此我们有 $v_{n} = 0$。\n$2$. 对于半径为 $r_{c}$ 的圆形边界，其曲率在几何上定义为半径的倒数，即 $\\kappa = 1/r_{c}$。对于在传播方向上是凸的波前（即，试图向圆形内部传播的波），曲率取正值。\n\n将这两个条件 $v_{n} = 0$ 和 $\\kappa = 1/r_{c}$ 代入程函-曲率关系，得到：\n$$0 = v_{0} - D \\left(\\frac{1}{r_{c}}\\right)$$\n为了找到 $r_{c}$ 的表达式，我们重新整理这个方程：\n$$D \\left(\\frac{1}{r_{c}}\\right) = v_{0}$$\n求解 $r_{c}$ 得到：\n$$r_{c} = \\frac{D}{v_{0}}$$\n该表达式给出了螺旋波的不可兴奋核心的半径，它是介质内在属性 $D$ 和 $v_{0}$ 的函数。\n\n第 $2$ 部分：转子周期 $T$ 的推导。\n问题假定螺旋波进行刚性旋转。这是一个关键假设，它意味着波形中的每一点都围绕一个固定中心（核心的中心）以相同的恒定角速度旋转，我们将其表示为 $\\omega$。\n\n旋转周期 $T$ 定义为完成一次完整旋转（$2\\pi$ 弧度）所需的时间。它通过基本关系与角速度 $\\omega$ 相关联：\n$$T = \\frac{2\\pi}{\\omega}$$\n问题指出，在核心边界，即半径为 $r_{c}$ 的圆形路径上，相以局部速度 $v$ 切向推进。在刚性旋转模型中，这个切向速度 $v$ 通过标准的圆周运动运动学公式与角速度 $\\omega$ 和半径 $r_{c}$ 相关联：\n$$v = \\omega r_{c}$$\n我们可以从这个关系中表达出角速度 $\\omega$：\n$$\\omega = \\frac{v}{r_{c}}$$\n现在，我们将这个 $\\omega$ 的表达式代入周期 $T$ 的方程中：\n$$T = \\frac{2\\pi}{(v/r_{c})}$$\n$$T = \\frac{2\\pi r_{c}}{v}$$\n这就是所要求的转子周期 $T$ 关于核心半径 $r_{c}$ 和切向相速度 $v$ 的近似表达式。该表达式的“近似”性质源于模型的理想化，例如完美的刚体旋转和完美的圆形核心，这些都是对更复杂的现实世界动力学的简化。\n\n第 $3$ 部分：$T$ 的数值计算。\n为了计算周期 $T$ 的数值，我们首先通过将第 $1$ 部分中 $r_{c}$ 的表达式代入第 $2$ 部分中 $T$ 的表达式，来构建一个用给定的基本参数表示 $T$ 的单一表达式：\n$$T = \\frac{2\\pi}{v} \\left( r_{c} \\right) = \\frac{2\\pi}{v} \\left( \\frac{D}{v_{0}} \\right) = \\frac{2\\pi D}{v_{0}v}$$\n问题提供了以下数值：\n- 平面波速，$v_{0} = 0.30 \\text{ m/s}$。\n- 曲率敏感性系数，$D = 1.5 \\times 10^{-3} \\text{ m}^{2}/\\text{s}$。\n- 切向相速度，$v = 0.35 \\text{ m/s}$。\n\n我们将这些值代入我们推导的 $T$ 的表达式中。量纲一致性为 $[\\text{m}^{2}/\\text{s}] / ([\\text{m/s}] \\cdot [\\text{m/s}]) = [\\text{s}]$，这与周期的量纲预期相符。\n$$T = \\frac{2\\pi (1.5 \\times 10^{-3})}{(0.30)(0.35)} \\text{ s}$$\n我们进行计算：\n$$T = \\frac{3\\pi \\times 10^{-3}}{0.105} \\text{ s}$$\n为简化计算，我们可以将 $0.105$ 写成 $105 \\times 10^{-3}$：\n$$T = \\frac{3\\pi \\times 10^{-3}}{105 \\times 10^{-3}} \\text{ s} = \\frac{3\\pi}{105} \\text{ s}$$\n$$T = \\frac{\\pi}{35} \\text{ s}$$\n现在，我们计算数值：\n$$T \\approx \\frac{3.14159265...}{35} \\text{ s} \\approx 0.08975979... \\text{ s}$$\n问题要求将最终答案四舍五入到三位有效数字。前三位有效数字是 $8$、$9$ 和 $7$。$7$ 后面的数字是 $5$，这要求对最后一位有效数字进行向上取整。\n$$T \\approx 0.0898 \\text{ s}$$\n这是基于所提供的模型和参数计算出的螺旋波转子的周期。",
            "answer": "$$\\boxed{0.0898}$$"
        },
        {
            "introduction": "在建立了螺旋波存在的条件和结构模型之后，最后一步是学习如何在数据中识别和分类它们。本练习引入了相位和拓扑荷（手性）的概念，这是一种稳健地定位转子核心并确定其旋转方向（顺时针或逆时针）的方法。这项计算实践将指导你开发一个算法，从二维相图中计算拓扑荷，这是分析模拟结果和心脏标测实验数据的一项基本技能 。",
            "id": "3929624",
            "problem": "给定代表可兴奋心肌组织中螺旋波活动的离散二维相位场。相位变量被定义为单位圆上的一个角度，以弧度为单位，并限制在区间 $(-\\pi,\\pi]$ 内。转子核心是一个相位奇点，相位围绕该奇点非平凡地缠绕。转子的手性指的是围绕核心的相位旋转方向，其拓扑荷对于逆时针旋转为 $+1$，对于顺时针旋转为 $-1$。从单位圆上的相位映射和围绕闭合回路的缠绕数定义的第一性原理出发，通过评估围绕核心的微小闭合路径上的相位旋转符号，推导出一个计算给定核心处转子手性的算法。实现此算法以分配相应的拓扑荷 $+1$ 或 $-1$。\n\n基本原理：将网格点 $(i,j)$ 处的相位建模为函数 $\\phi(i,j)$，它表示介质的相位状态（模 $2\\pi$）。相位奇点的特征是沿任何包围它的足够小的闭合回路都存在非平凡的缠绕。拓扑荷等于从闭合回路到单位圆的映射的缠绕数。利用沿回路的相位变化环流与缠绕数之间的这种关系来推导你的计算，确保所有角度运算都以弧度为单位，并正确处理相位的周期性。\n\n程序必须构建下面的测试相位场，并评估每个指定闭合回路的手性。在所有情况下，角度均使用弧度，并确保最终的荷为整数 $+1$ 或 $-1$。\n\n测试套件：\n- 情况1（理想情况）：网格大小 $N=129$，核心位于 $(x_c,y_c)=(64,64)$，各向异性尺度 $(a_x,a_y)=(1.0,1.0)$，手性符号 $s=+1$，回路半径 $r=10$，采样点数 $M=128$，噪声振幅 $\\sigma=0.0$。\n- 情况2（相反手性）：$N=129$，$(x_c,y_c)=(64,64)$，$(a_x,a_y)=(1.0,1.0)$，$s=-1$，$r=10$，$M=128$，$\\sigma=0.0$。\n- 情况3（各向异性与噪声，正手性）：$N=129$，$(x_c,y_c)=(64,64)$，$(a_x,a_y)=(1.5,0.8)$，$s=+1$，$r=20$，$M=128$，$\\sigma=0.05$。\n- 情况4（各向异性与噪声，负手性）：$N=129$，$(x_c,y_c)=(80,48)$，$(a_x,a_y)=(0.7,1.3)$，$s=-1$，$r=12$，$M=128$，$\\sigma=0.03$。\n\n相位构建规则：对于索引为 $i,j \\in \\{0,1,\\dots,N-1\\}$ 的网格，定义以核心 $(x_c,y_c)$ 为中心的坐标，并通过以下公式定义一个各向异性相位场\n$$\n\\phi(i,j) = \\operatorname{wrap}_{(-\\pi,\\pi]} \\left( s \\cdot \\operatorname{atan2}\\left(\\frac{i-y_c}{a_y}, \\frac{j-x_c}{a_x}\\right) + \\eta(i,j) \\right)\n$$\n其中 $\\eta(i,j)$ 是标准差为 $\\sigma$ 的零均值随机噪声，$\\operatorname{wrap}_{(-\\pi,\\pi]}(\\cdot)$ 表示将角度包裹到主值区间 $(-\\pi,\\pi]$。\n\n回路采样规则：通过 $M$ 个采样点参数化一个离散逆时针回路\n$$\n\\theta_k = \\frac{2\\pi k}{M}, \\quad k=0,1,\\dots,M-1\n$$\n并映射到网格索引\n$$\nx_k = x_c + r\\cos\\theta_k, \\quad y_k = y_c + r\\sin\\theta_k\n$$\n然后四舍五入到整数网格索引 $j_k=\\operatorname{round}(x_k)$ 和 $i_k=\\operatorname{round}(y_k)$，并裁剪到有效索引范围内。\n\n你的任务：\n- 从第一性原理出发，推导为什么沿回路对适当解缠后的相位差求和会得到缠绕数的估计值，以及为什么其符号等于转子的手性。\n- 实现一个程序，构建四个相位场，构造回路，计算每个回路上的总解缠相位旋转，并输出这四种情况下的手性分配，结果为整数 $+1$ 或 $-1$。\n\n角度单位：所有角度必须使用弧度。\n\n最终输出格式：你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4]”），其中每个结果是对应情况的整数 $+1$ 或 $-1$。",
            "solution": "该问题要求推导一种算法，用于计算二维离散相位场中转子的手性（拓扑荷）。推导必须从第一性原理开始。\n\n二维介质中的相位场是一个函数 $\\phi(i, j)$，它为网格上的每个点 $(i, j)$ 分配一个相位角。相位是一个周期性变量，代表单位圆 $S^1$ 上的一个点。它被限制在一个长度为 $2\\pi$ 的区间内，此处指定为 $(-\\pi, \\pi]$。转子核心是一个相位奇点，即相位未定义的点，相位值围绕该点表现出非平凡的缠绕。\n\n拓扑荷（用 $W$ 表示）是量化这种缠绕的整数。它被定义为从包围奇点的闭合回路 $\\gamma$ 到单位圆 $S^1$ 的映射的缠绕数。对于连续场和回路，缠绕数由沿回路的相位梯度围线积分给出：\n$$\nW = \\frac{1}{2\\pi} \\oint_\\gamma d\\phi\n$$\n这个积分测量了沿回路 $\\gamma$ 逆时针（CCW）方向遍历一次时相位角的总变化，并用 $2\\pi$ 进行归一化。为了使积分良定义，我们必须考虑“解缠”相位 $\\tilde{\\phi}$，它是一个连续实值函数，满足 $\\phi = \\tilde{\\phi} \\pmod{2\\pi}$。积分的计算结果为：\n$$\nW = \\frac{1}{2\\pi} \\left[ \\tilde{\\phi}(\\text{end}) - \\tilde{\\phi}(\\text{start}) \\right]\n$$\n对于闭合回路，空间域中的起点和终点是相同的。然而，解缠相位 $\\tilde{\\phi}$ 可以改变 $2\\pi$ 的整数倍。这个整数就是缠绕数 $W$。因此，沿回路的解缠相位的总变化是 $\\Delta\\tilde{\\Phi}_{\\text{total}} = 2\\pi W$。\n\n在我们的离散问题中，相位场 $\\phi(i, j)$ 是在网格上给出的，回路 $\\gamma$ 是由 $M$ 个离散点 $\\{P_0, P_1, \\dots, P_{M-1}\\}$ 组成的序列，按逆时针路径排列。相应的相位值为 $\\{\\phi_0, \\phi_1, \\dots, \\phi_{M-1}\\}$。我们可以通过对回路上相邻点之间的相位增量变化求和来近似连续积分：\n$$\n\\Delta\\tilde{\\Phi}_{\\text{total}} \\approx \\sum_{k=0}^{M-1} (\\tilde{\\phi}_{k+1} - \\tilde{\\phi}_k)\n$$\n其中我们设置 $P_M = P_0$ 并因此 $\\phi_M = \\phi_0$ 以确保回路闭合。\n\n主要困难在于我们只能访问包裹后的相位值 $\\phi_k \\in (-\\pi, \\pi]$。朴素差值 $\\Delta\\phi_k = \\phi_{k+1} - \\phi_k$ 位于区间 $(-2\\pi, 2\\pi]$ 内，并不一定代表真实的、最小的相位变化。例如，如果相位从 $\\phi_k = 0.9\\pi$ 变为 $\\phi_{k+1} = -0.9\\pi$，系统很可能在 $\\pm\\pi$ 的支割线上经历了一个 $0.2\\pi$ 的小幅正向旋转。然而，朴素差值却是 $-1.8\\pi$。\n\n为了找到正确的解缠相位差 $\\Delta\\tilde{\\phi}_k = \\tilde{\\phi}_{k+1} - \\tilde{\\phi}_k$，我们必须确定单位圆上对应于最短角路径的变化。这个最短路径差必须位于区间 $[-\\pi, \\pi)$ 内。一个朴素差值 $\\Delta\\phi_k > \\pi$ 意味着测量的是较长的顺时针路径，因此较短的逆时针路径是 $\\Delta\\phi_k - 2\\pi$。类似地，如果 $\\Delta\\phi_k  -\\pi$，则较短的路径是 $\\Delta\\phi_k + 2\\pi$。这种校正可以使用模运算系统地实现。解缠差 $\\Delta\\tilde{\\phi}_k$ 是朴素差 $\\Delta\\phi_k$ 的主值：\n$$\n\\Delta\\tilde{\\phi}_k = \\text{wrap}_{[-\\pi, \\pi)}(\\Delta\\phi_k) \\equiv ((\\Delta\\phi_k + \\pi) \\pmod{2\\pi}) - \\pi\n$$\n该公式将任何角度差映射到区间 $[-\\pi, \\pi)$ 内，正确地表示了两个相位角之间的最短旋转。\n\n通过对整个回路上的这些正确解缠的相位差求和，我们得到了解缠相位总变化的精确估计：\n$$\n\\Delta\\tilde{\\Phi}_{\\text{total}} = \\sum_{k=0}^{M-1} \\Delta\\tilde{\\phi}_k = \\sum_{k=0}^{M-1} \\text{wrap}_{[-\\pi, \\pi)}(\\phi_{k+1} - \\phi_k)\n$$\n$\\Delta\\tilde{\\Phi}_{\\text{total}}$ 的符号直接给出了转子的手性。正和（约 $+2\\pi$）表示当回路以逆时针方向遍历时，相位发生净逆时针旋转，对应于拓扑荷 $W=+1$。负和（约 $-2\\pi$）表示净顺时针旋转，对应于拓扑荷 $W=-1$。\n\n然后通过对这个总相位累积进行归一化来计算拓扑荷 $W$：\n$$\nW = \\frac{\\Delta\\tilde{\\Phi}_{\\text{total}}}{2\\pi}\n$$\n由于回路包围的是一个具有整数荷的奇点，计算出的 $W$ 值将非常接近一个整数。最终的荷通过将 $W$ 四舍五入到最近的整数得到，对于 $\\pm 1$ 的荷，这可以由总相位累积的符号稳健地确定。\n\n最终的算法如下：\n1. 对于给定的参数集，在 $N \\times N$ 网格上构建离散相位场 $\\phi(i, j)$。\n2. 生成形成闭合回路的 $M$ 个网格点序列 $\\{P_k = (i_k, j_k)\\}_{k=0}^{M-1}$。\n3. 沿此回路提取相位值 $\\{\\phi_k = \\phi(i_k, j_k)\\}$。\n4. 对于 $k=0, \\dots, M-1$（其中 $\\phi_M = \\phi_0$），计算朴素相位差序列 $\\Delta\\phi_k = \\phi_{k+1} - \\phi_k$。\n5. 对于每个 $\\Delta\\phi_k$，计算包裹后的差值 $\\Delta\\tilde{\\phi}_k$ 以找到最短角距离。\n6. 对这些包裹后的差值求和，得到总解缠相位变化 $\\Delta\\tilde{\\Phi}_{\\text{total}}$。\n7. 通过 $W = \\text{round}(\\Delta\\tilde{\\Phi}_{\\text{total}} / (2\\pi))$ 将荷计算为整数。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the chirality of spiral wave rotors based on the provided problem statement.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: (happy path) N=129, (xc,yc)=(64,64), (ax,ay)=(1.0,1.0), s=+1, r=10, M=128, sigma=0.0\n        {'N': 129, 'xc': 64, 'yc': 64, 'ax': 1.0, 'ay': 1.0, 's': 1, 'r': 10, 'M': 128, 'sigma': 0.0},\n        # Case 2: (opposite chirality) N=129, (xc,yc)=(64,64), (ax,ay)=(1.0,1.0), s=-1, r=10, M=128, sigma=0.0\n        {'N': 129, 'xc': 64, 'yc': 64, 'ax': 1.0, 'ay': 1.0, 's': -1, 'r': 10, 'M': 128, 'sigma': 0.0},\n        # Case 3: (anisotropy and noise, positive chirality) N=129, (xc,yc)=(64,64), (ax,ay)=(1.5,0.8), s=+1, r=20, M=128, sigma=0.05\n        {'N': 129, 'xc': 64, 'yc': 64, 'ax': 1.5, 'ay': 0.8, 's': 1, 'r': 20, 'M': 128, 'sigma': 0.05},\n        # Case 4: (anisotropy and noise, negative chirality) N=129, (xc,yc)=(80,48), (ax,ay)=(0.7,1.3), s=-1, r=12, M=128, sigma=0.03\n        {'N': 129, 'xc': 80, 'yc': 48, 'ax': 0.7, 'ay': 1.3, 's': -1, 'r': 12, 'M': 128, 'sigma': 0.03},\n    ]\n\n    results = []\n    # Use a fixed seed for reproducibility, as the problem involves random noise.\n    rng = np.random.default_rng(seed=42)\n\n    for case in test_cases:\n        N = case['N']\n        xc, yc = case['xc'], case['yc']\n        ax, ay = case['ax'], case['ay']\n        s = case['s']\n        r = case['r']\n        M = case['M']\n        sigma = case['sigma']\n\n        # 1. Construct the phase field\n        # Create grid indices. Note: np.meshgrid 'ij' indexing matches matrix (row, col) convention.\n        # i corresponds to y-axis, j to x-axis.\n        i_coords, j_coords = np.meshgrid(np.arange(N), np.arange(N), indexing='ij')\n\n        # Calculate phase based on the formula, ensuring arguments to atan2 are (y, x)\n        y_prime = (i_coords - yc) / ay\n        x_prime = (j_coords - xc) / ax\n        \n        # atan2 returns values in (-pi, pi], which matches the problem spec.\n        phase_ideal = s * np.arctan2(y_prime, x_prime)\n\n        # Add noise\n        noise = rng.normal(0, sigma, size=(N, N))\n        phase_noisy = phase_ideal + noise\n\n        # Wrap the phase to the interval (-pi, pi] as specified.\n        # ((x + pi) % (2*pi)) - pi maps to [-pi, pi).\n        # This is equivalent for difference calculations.\n        phase_field = (phase_noisy + np.pi) % (2 * np.pi) - np.pi\n\n        # 2. Construct the loop and sample points\n        # Parameterize the loop with M samples (counter-clockwise)\n        theta_k = np.linspace(0, 2 * np.pi, M, endpoint=False)\n        \n        # Map loop to grid coordinates\n        x_k_float = xc + r * np.cos(theta_k)\n        y_k_float = yc + r * np.sin(theta_k)\n\n        # Round to nearest integer grid indices\n        j_k = np.round(x_k_float).astype(int)\n        i_k = np.round(y_k_float).astype(int)\n\n        # Clip indices to be within the valid grid range [0, N-1]\n        j_k = np.clip(j_k, 0, N - 1)\n        i_k = np.clip(i_k, 0, N - 1)\n\n        # 3. Extract phase values along the loop\n        phi_loop = phase_field[i_k, j_k]\n        \n        # 4. Compute and sum unwrapped phase differences\n        # Close the loop by appending the first phase value to the end\n        phi_loop_closed = np.append(phi_loop, phi_loop[0])\n        \n        # Calculate naive differences\n        diffs = np.diff(phi_loop_closed)\n        \n        # Wrap differences to the interval [-pi, pi) to find the shortest path\n        wrapped_diffs = (diffs + np.pi) % (2 * np.pi) - np.pi\n        \n        # Sum the wrapped differences to get the total unwrapped phase change\n        total_phase_change = np.sum(wrapped_diffs)\n        \n        # 5. Calculate topological charge\n        # Normalize by 2*pi and round to the nearest integer\n        winding_number = total_phase_change / (2 * np.pi)\n        topological_charge = int(np.round(winding_number))\n        \n        results.append(topological_charge)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}