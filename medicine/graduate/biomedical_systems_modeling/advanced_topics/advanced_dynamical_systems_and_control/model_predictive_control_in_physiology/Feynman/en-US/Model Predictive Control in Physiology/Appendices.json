{
    "hands_on_practices": [
        {
            "introduction": "Model Predictive Control operates in a digital, discrete-time world, yet the physiological systems we aim to control are continuous in nature. This first practice tackles the crucial first step in any physiological control design: creating a reliable discrete-time model from a continuous-time representation based on physical principles like mass balance. By deriving and comparing two different discretization methods, you will gain insight into how this seemingly technical choice critically impacts the stability and accuracy of your controller's predictions, a fundamental consideration for any MPC implementation .",
            "id": "3902953",
            "problem": "A two-compartment pharmacokinetic model describes drug amounts in a central compartment and a peripheral compartment, denoted by $x_{1}(t)$ and $x_{2}(t)$, respectively. Drug leaves the central compartment by elimination with first-order rate constant $k_{10} \\gt 0$, exchanges from central to peripheral with first-order rate constant $k_{12} \\gt 0$, and returns from peripheral to central with first-order rate constant $k_{21} \\gt 0$. An intravenous infusion input $u(t)$ (drug amount per unit time) enters the central compartment. Assume well-mixed compartments and linear first-order kinetics.\n\nStarting from mass balance (conservation of mass) and the definition of first-order flows, perform the following:\n\na) Derive the continuous-time linear time-invariant state-space model $\\dot{x}(t) = A_{c} x(t) + B_{c} u(t)$ with $x(t) = \\begin{pmatrix} x_{1}(t) \\\\ x_{2}(t) \\end{pmatrix}$. Identify $A_{c}$ and $B_{c}$ explicitly in terms of $k_{10}$, $k_{12}$, and $k_{21}$.\n\nb) Using the definition of the forward Euler method as a first-order approximation to the derivative, derive the forward Euler discretization under a constant sampling period $h \\gt 0$ with a zero-order hold on the input $u(t)$ over each sampling interval. That is, derive matrices $A_{d}^{\\mathrm{E}}(h)$ and $B_{d}^{\\mathrm{E}}(h)$ such that $x_{k+1} = A_{d}^{\\mathrm{E}}(h) x_{k} + B_{d}^{\\mathrm{E}}(h) u_{k}$.\n\nc) Starting from the exact solution of linear time-invariant systems and the definition of the matrix exponential, derive the exact zero-order-hold discretization $x_{k+1} = A_{d}^{\\mathrm{X}}(h) x_{k} + B_{d}^{\\mathrm{X}}(h) u_{k}$ with\n$A_{d}^{\\mathrm{X}}(h) = \\exp(A_{c} h)$ and $B_{d}^{\\mathrm{X}}(h)$ given as an integral involving $\\exp(A_{c} \\tau)$ and $B_{c}$. Express $B_{d}^{\\mathrm{X}}(h)$ in closed form in terms of $A_{c}$, $B_{c}$, and $h$.\n\nd) For model predictive control (MPC) design, closed-loop prediction models should be Schur stable to avoid numerical and conceptual difficulties. Using eigenvalue-based reasoning, derive the necessary and sufficient stability condition on $h$ for the forward Euler discretization obtained in part b), given that $k_{10}$, $k_{12}$, and $k_{21}$ are strictly positive. Then, simplify this condition to a single closed-form expression for the maximum admissible sampling period $h_{\\max}$ as a function of $k_{10}$, $k_{12}$, and $k_{21}$ that guarantees Schur stability of the forward Euler discretization for the open-loop pharmacokinetic dynamics.\n\ne) Briefly compare the stability and prediction accuracy trade-offs between the forward Euler and exact discretizations for MPC design in this setting, highlighting how the choice of $h$ interacts with these trade-offs.\n\nProvide, as your final answer, only the closed-form symbolic expression for $h_{\\max}$ from part d). Do not substitute numerical values, and no units are required for the final expression.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in pharmacokinetic modeling, well-posed with sufficient information, and objective in its formulation. The tasks are standard derivations in linear systems theory and control.\n\na) Derivation of the continuous-time state-space model.\n\nThe state variables are $x_{1}(t)$, the drug amount in the central compartment, and $x_{2}(t)$, the drug amount in the peripheral compartment. We apply the principle of mass balance to each compartment.\n\nFor the central compartment, the rate of change of the drug amount, $\\dot{x}_{1}(t)$, is the sum of all influx rates minus the sum of all efflux rates.\nInflux rates are the intravenous infusion $u(t)$ and the return from the peripheral compartment, $k_{21}x_{2}(t)$.\nEfflux rates are the elimination from the body, $k_{10}x_{1}(t)$, and the transfer to the peripheral compartment, $k_{12}x_{1}(t)$.\nThe mass balance equation for the central compartment is therefore:\n$$\n\\frac{dx_{1}(t)}{dt} = \\dot{x}_{1}(t) = u(t) + k_{21}x_{2}(t) - k_{10}x_{1}(t) - k_{12}x_{1}(t)\n$$\nRearranging terms, we get:\n$$\n\\dot{x}_{1}(t) = -(k_{10} + k_{12})x_{1}(t) + k_{21}x_{2}(t) + u(t)\n$$\n\nFor the peripheral compartment, the rate of change $\\dot{x}_{2}(t)$ is similarly determined.\nThe only influx is from the central compartment, with a rate of $k_{12}x_{1}(t)$.\nThe only efflux is the return to the central compartment, with a rate of $k_{21}x_{2}(t)$.\nThe mass balance equation for the peripheral compartment is:\n$$\n\\frac{dx_{2}(t)}{dt} = \\dot{x}_{2}(t) = k_{12}x_{1}(t) - k_{21}x_{2}(t)\n$$\n\nWe can write these two coupled first-order linear differential equations in the state-space form $\\dot{x}(t) = A_{c} x(t) + B_{c} u(t)$ where $x(t) = \\begin{pmatrix} x_{1}(t) \\\\ x_{2}(t) \\end{pmatrix}$:\n$$\n\\begin{pmatrix} \\dot{x}_{1}(t) \\\\ \\dot{x}_{2}(t) \\end{pmatrix} = \\begin{pmatrix} -(k_{10} + k_{12}) & k_{21} \\\\ k_{12} & -k_{21} \\end{pmatrix} \\begin{pmatrix} x_{1}(t) \\\\ x_{2}(t) \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} u(t)\n$$\nBy comparing this to the general form, we identify the matrices $A_{c}$ and $B_{c}$ as:\n$$\nA_{c} = \\begin{pmatrix} -(k_{10} + k_{12}) & k_{21} \\\\ k_{12} & -k_{21} \\end{pmatrix}, \\quad B_{c} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}\n$$\n\nb) Derivation of the forward Euler discretization.\n\nThe forward Euler method approximates the derivative $\\dot{x}(t)$ at time $t_{k} = k h$ as $\\dot{x}(t_{k}) \\approx \\frac{x(t_{k+1}) - x(t_{k})}{h}$, where $h$ is the sampling period. Let $x_{k} \\equiv x(t_{k})$. Under a zero-order hold, the input $u(t)$ is assumed to be constant over the interval $[t_{k}, t_{k+1})$, i.e., $u(t) = u_{k}$.\nSubstituting the approximation into the continuous-time model at $t=t_k$:\n$$\n\\frac{x_{k+1} - x_{k}}{h} = A_{c} x_{k} + B_{c} u_{k}\n$$\nMultiplying by $h$ and rearranging to solve for $x_{k+1}$:\n$$\nx_{k+1} - x_{k} = h A_{c} x_{k} + h B_{c} u_{k}\n$$\n$$\nx_{k+1} = x_{k} + h A_{c} x_{k} + h B_{c} u_{k} = (I + h A_{c}) x_{k} + (h B_{c}) u_{k}\n$$\nThis is in the form $x_{k+1} = A_{d}^{\\mathrm{E}}(h) x_{k} + B_{d}^{\\mathrm{E}}(h) u_{k}$. The matrices are:\n$$\nA_{d}^{\\mathrm{E}}(h) = I + h A_{c} = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} + h \\begin{pmatrix} -(k_{10} + k_{12}) & k_{21} \\\\ k_{12} & -k_{21} \\end{pmatrix} = \\begin{pmatrix} 1 - h(k_{10} + k_{12}) & h k_{21} \\\\ h k_{12} & 1 - h k_{21} \\end{pmatrix}\n$$\n$$\nB_{d}^{\\mathrm{E}}(h) = h B_{c} = h \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} h \\\\ 0 \\end{pmatrix}\n$$\n\nc) Derivation of the exact zero-order-hold discretization.\n\nThe exact solution of the linear time-invariant system $\\dot{x}(t) = A_c x(t) + B_c u(t)$ from time $t_k$ to $t_{k+1} = t_k+h$, with a constant input $u(t)=u_k$ for $t \\in [t_k, t_{k+1})$, is given by the variation of constants formula:\n$$\nx(t_{k+1}) = \\exp(A_{c} h) x(t_{k}) + \\left( \\int_{t_{k}}^{t_{k+1}} \\exp(A_{c}(t_{k+1}-\\tau)) B_{c} d\\tau \\right) u_{k}\n$$\nUsing the notation $x_k = x(t_k)$, we can identify $A_{d}^{\\mathrm{X}}(h) = \\exp(A_c h)$. The input matrix $B_{d}^{\\mathrm{X}}(h)$ is the integral term:\n$$\nB_{d}^{\\mathrm{X}}(h) = \\left( \\int_{0}^{h} \\exp(A_{c}s) ds \\right) B_{c}\n$$\nwhere we have made the substitution $s = t_{k+1}-\\tau$. To evaluate this integral in closed form, we can use the property that $\\frac{d}{ds} (A_c^{-1}\\exp(A_c s)) = \\exp(A_c s)$, provided that $A_c$ is invertible. Let's check the determinant of $A_c$:\n$$\n\\det(A_{c}) = (-(k_{10} + k_{12}))(-k_{21}) - (k_{21})(k_{12}) = k_{10}k_{21} + k_{12}k_{21} - k_{12}k_{21} = k_{10}k_{21}\n$$\nSince $k_{10} > 0$ and $k_{21} > 0$ are given, $\\det(A_{c}) > 0$, so $A_c$ is invertible. We can now evaluate the integral:\n$$\n\\int_{0}^{h} \\exp(A_{c}s) ds = \\left[ A_{c}^{-1} \\exp(A_{c}s) \\right]_{0}^{h} = A_{c}^{-1} (\\exp(A_{c}h) - \\exp(A_{c} \\cdot 0)) = A_{c}^{-1}(\\exp(A_{c}h) - I)\n$$\nSubstituting this back, we get the closed form for $B_{d}^{\\mathrm{X}}(h)$:\n$$\nB_{d}^{\\mathrm{X}}(h) = A_{c}^{-1}(\\exp(A_{c}h) - I) B_{c}\n$$\n\nd) Stability condition for the forward Euler discretization.\n\nA discrete-time linear system is Schur stable if and only if all eigenvalues of its state matrix have a magnitude less than $1$. For the forward Euler discretization, the state matrix is $A_{d}^{\\mathrm{E}}(h) = I + h A_{c}$.\nIf $\\lambda_i(A_c)$ is an eigenvalue of $A_c$, then the corresponding eigenvalue of $A_{d}^{\\mathrm{E}}(h)$ is $\\lambda_i(A_{d}^{\\mathrm{E}}) = 1 + h \\lambda_i(A_c)$. The stability condition is $|\\lambda_i(A_{d}^{\\mathrm{E}})| < 1$ for all $i$.\n$$|1 + h \\lambda_i(A_c)| < 1$$\nFirst, let's find the eigenvalues of $A_c$. The characteristic equation is $\\det(A_c - \\lambda I) = 0$:\n$$\n\\lambda^2 - \\mathrm{tr}(A_c)\\lambda + \\det(A_c) = 0\n$$\n$$\n\\lambda^2 - (-(k_{10} + k_{12}) - k_{21})\\lambda + (k_{10}k_{21}) = 0\n$$\n$$\n\\lambda^2 + (k_{10} + k_{12} + k_{21})\\lambda + k_{10}k_{21} = 0\n$$\nThe product of the roots is $\\lambda_1\\lambda_2 = k_{10}k_{21} > 0$, and the sum is $\\lambda_1+\\lambda_2 = -(k_{10}+k_{12}+k_{21}) < 0$. Since the product is positive and sum is negative, both eigenvalues $\\lambda_1, \\lambda_2$ must be real and negative.\nLet $\\lambda_c$ be a real, negative eigenvalue of $A_c$. The stability condition becomes:\n$$\n|1 + h \\lambda_c| < 1 \\implies -1 < 1 + h \\lambda_c < 1\n$$\nThe right inequality, $1 + h \\lambda_c < 1 \\implies h \\lambda_c < 0$, is always true since $h>0$ and $\\lambda_c < 0$.\nThe left inequality, $-1 < 1 + h \\lambda_c \\implies -2 < h \\lambda_c \\implies h > \\frac{-2}{\\lambda_c}$. Since $\\lambda_c$ is negative, this is equivalent to $h < \\frac{2}{-\\lambda_c} = \\frac{2}{|\\lambda_c|}$.\nThis condition must hold for both eigenvalues. Therefore, $h$ must be smaller than the minimum of these bounds:\n$$\nh < \\min\\left(\\frac{2}{|\\lambda_1|}, \\frac{2}{|\\lambda_2|}\\right) = \\frac{2}{\\max(|\\lambda_1|, |\\lambda_2|)}\n$$\nThe maximum admissible sampling period is $h_{\\max} = \\frac{2}{\\max_{i}|\\lambda_i(A_c)|}$. The eigenvalues are the roots of the characteristic polynomial:\n$$\n\\lambda = \\frac{-(k_{10} + k_{12} + k_{21}) \\pm \\sqrt{(k_{10} + k_{12} + k_{21})^2 - 4k_{10}k_{21}}}{2}\n$$\nThe eigenvalue with the largest magnitude is the one with the negative sign before the square root in the numerator, as both terms in the numerator are negative.\n$$\n\\max_{i}|\\lambda_i(A_c)| = \\left| \\frac{-(k_{10} + k_{12} + k_{21}) - \\sqrt{(k_{10} + k_{12} + k_{21})^2 - 4k_{10}k_{21}}}{2} \\right|\n$$\n$$\n\\max_{i}|\\lambda_i(A_c)| = \\frac{(k_{10} + k_{12} + k_{21}) + \\sqrt{(k_{10} + k_{12} + k_{21})^2 - 4k_{10}k_{21}}}{2}\n$$\nThus, the maximum admissible sampling period is:\n$$\nh_{\\max} = \\frac{4}{(k_{10} + k_{12} + k_{21}) + \\sqrt{(k_{10} + k_{12} + k_{21})^2 - 4k_{10}k_{21}}}\n$$\n\ne) Comparison of discretization methods for MPC.\n\nFor model predictive control (MPC), a prediction model is used to forecast the system's future evolution. The choice of discretization method profoundly impacts the controller's performance and feasibility.\n\nForward Euler (FE) Discretization:\n- **Stability**: The FE-discretized model is only conditionally stable. The sampling period $h$ must be strictly less than $h_{\\max}$ derived in part d). This imposes a hard constraint on the controller design. If system parameters ($k_{ij}$) change, $h_{\\max}$ may decrease, and a previously stable controller could become unstable.\n- **Accuracy**: FE is a first-order approximation. Its prediction accuracy is poor, especially over the long prediction horizons typical in MPC, unless $h$ is chosen to be very small. This model mismatch can lead to suboptimal or even unstable closed-loop behavior.\n- **Trade-off**: The primary advantage is simplicity. However, the need for a small $h$ for both stability and accuracy leads to a large number of steps in the prediction horizon, increasing the computational burden of the MPC optimization problem.\n\nExact Zero-Order-Hold (ZOH) Discretization:\n- **Stability**: The exact ZOH discretization of a stable continuous-time system is always stable for any sampling period $h > 0$. This is because the mapping $\\lambda_d = \\exp(\\lambda_c h)$ maps the stable left-half plane of continuous eigenvalues to the stable interior of the unit circle for discrete eigenvalues. This removes the stability constraint on the choice of $h$.\n- **Accuracy**: As the name implies, it is \"exact\" for systems with piecewise-constant inputs. It provides a highly accurate prediction of the system's state at sampling instants, minimizing model mismatch due to discretization. This accuracy is crucial for the performance of MPC.\n- **Trade-off**: The calculation of the matrix exponential can be more computationally intensive than the simple algebra of FE. However, this is a one-time, offline computation for a given $h$. The key benefit is that $h$ can be chosen based on control objectives (e.g., response speed, disturbance rejection) rather than numerical stability. This often allows for a larger $h$ than with FE, which reduces the dimension of the MPC optimization problem and thus the real-time computational load.\n\nIn summary, for MPC design in this pharmacokinetic application, the exact ZOH discretization is vastly superior. It guarantees model stability and high prediction accuracy, granting the designer the freedom to select a sampling period $h$ that optimally balances control performance and computational cost, without being constrained by the numerical stability issues inherent to the forward Euler method.",
            "answer": "$$\n\\boxed{\\frac{4}{(k_{10} + k_{12} + k_{21}) + \\sqrt{(k_{10} + k_{12} + k_{21})^{2} - 4 k_{10} k_{21}}}}\n$$"
        },
        {
            "introduction": "One of the primary strengths of MPC is its ability to explicitly handle constraints, ensuring that a controller's actions respect clinical safety limits and operational boundaries. This exercise moves from modeling to controller specification, guiding you through the process of translating clinical requirements—such as maintaining adequate depth of anesthesia while preventing dangerous drops in blood pressure—into a set of precise mathematical inequalities. You will also confront the reality of model uncertainty by learning how to \"robustify\" these constraints, a vital technique for building controllers that are safe and effective in practice .",
            "id": "3902931",
            "problem": "A clinician is configuring Model Predictive Control (MPC) for propofol infusion during general anesthesia. The controller will operate with a sampling period of $T_s = 1$ minute and must satisfy clinical safety and efficacy constraints. The pharmacokinetic-pharmacodynamic model used for prediction is the following discrete-time linear effect-site model and output relationships:\n- Effect-site dynamics: $c_e(k+1) = a\\,c_e(k) + b\\,u(k)$ with $a = 0.8$ and $b = 0.1$, where $c_e(k)$ is an effect-site proxy and $u(k)$ is the propofol infusion rate in $\\mathrm{mg\\,min^{-1}}$.\n- Bispectral Index Score (BIS) output: $y_B(k) = 90 - \\alpha_B\\,c_e(k)$ with nominal sensitivity $\\alpha_B = 10$ (BIS units per effect-site unit).\n- Mean Arterial Pressure (MAP) output: $y_M(k) = y_{M,\\mathrm{base}} - \\alpha_M\\,c_e(k)$ with $y_{M,\\mathrm{base}} = 85$ $\\mathrm{mmHg}$ and $\\alpha_M = 3$ $\\mathrm{mmHg}$ per effect-site unit.\n\nThe controller must enforce:\n- Infusion limits: $0 \\le u(k) \\le 10$ $\\mathrm{mg\\,min^{-1}}$ from pump capability and safe dosing range for adults.\n- BIS target range: $40 \\le y_B(k) \\le 60$ to maintain appropriate hypnotic depth during general anesthesia in adults.\n- Maximum allowed blood pressure drop: $y_M(k) \\ge 65$ $\\mathrm{mmHg}$, equivalent to limiting the drop from baseline by at most $20$ $\\mathrm{mmHg}$, to avoid hypotension-related risks.\n\nTo ensure robust satisfaction of BIS constraints under bounded uncertainties, use the following uncertainty model:\n- Measurement noise on BIS is bounded by $|\\eta_B(k)| \\le \\bar{\\eta}_B$ with $\\bar{\\eta}_B = 1$ (BIS unit).\n- Unmodeled additive BIS disturbance is bounded by $|\\delta_B(k)| \\le \\bar{\\delta}_B$ with $\\bar{\\delta}_B = 1$ (BIS unit).\n- Sensitivity parameter uncertainty is bounded as $\\alpha_B \\in [(1-\\bar{\\rho}_B)\\alpha_B,(1+\\bar{\\rho}_B)\\alpha_B]$ with $\\bar{\\rho}_B = 0.05$.\n\nConstruct a constraint set for MPC that encodes the infusion limits, BIS target range, and MAP drop constraint using the nominal model outputs $y_B(k)$ and $y_M(k)$, and apply symmetric robust tightening to the BIS constraints by subtracting a tightening parameter $\\tau_B$ from the upper bound and adding $\\tau_B$ to the lower bound. Justify each bound using physiological considerations and the given model. Then, compute the minimal symmetric tightening parameter $\\tau_B$ that guarantees the BIS constraints hold for all uncertainties satisfying the bounds given above, assuming worst-case $c_e(k)$ consistent with the model and infusion limits over constant inputs. Round your answer to four significant figures. Express the final answer in BIS units.",
            "solution": "The user has provided a problem statement regarding the configuration of a Model Predictive Controller (MPC) for propofol infusion. The first step is to validate the problem statement.\n\n### Step 1: Extract Givens\n-   **System Model and Parameters**:\n    -   Discrete-time state-space model: $c_e(k+1) = a\\,c_e(k) + b\\,u(k)$\n    -   State update parameter: $a = 0.8$\n    -   Input gain: $b = 0.1$\n    -   Sampling period: $T_s = 1$ minute\n    -   State variable: $c_e(k)$, effect-site proxy\n    -   Input variable: $u(k)$, propofol infusion rate in $\\mathrm{mg\\,min^{-1}}$\n    -   BIS output model: $y_B(k) = 90 - \\alpha_B\\,c_e(k)$\n    -   Nominal BIS sensitivity: $\\alpha_B = 10$\n    -   MAP output model: $y_M(k) = y_{M,\\mathrm{base}} - \\alpha_M\\,c_e(k)$\n    -   Baseline MAP: $y_{M,\\mathrm{base}} = 85$ $\\mathrm{mmHg}$\n    -   MAP sensitivity: $\\alpha_M = 3$ $\\mathrm{mmHg}$ per effect-site unit\n\n-   **Constraints**:\n    -   Input constraint: $0 \\le u(k) \\le 10$ $\\mathrm{mg\\,min^{-1}}$\n    -   BIS target range: $40 \\le y_B(k) \\le 60$\n    -   MAP safety constraint: $y_M(k) \\ge 65$ $\\mathrm{mmHg}$\n\n-   **Uncertainty Model**:\n    -   BIS measurement noise bound: $|\\eta_B(k)| \\le \\bar{\\eta}_B$ with $\\bar{\\eta}_B = 1$\n    -   Additive BIS disturbance bound: $|\\delta_B(k)| \\le \\bar{\\delta}_B$ with $\\bar{\\delta}_B = 1$\n    -   BIS sensitivity uncertainty: $\\alpha_B \\in [(1-\\bar{\\rho}_B)\\alpha_B,(1+\\bar{\\rho}_B)\\alpha_B]$ with $\\bar{\\rho}_B = 0.05$\n\n-   **Task**:\n    1.  Construct the MPC constraint set.\n    2.  Apply symmetric robust tightening to the BIS constraints: $40 + \\tau_B \\le \\text{nominal } y_B(k) \\le 60 - \\tau_B$.\n    3.  Compute the minimal symmetric tightening parameter $\\tau_B$ that guarantees the actual BIS constraints hold under all specified uncertainties.\n    4.  Assume worst-case $c_e(k)$ consistent with model and input limits.\n    5.  Round the final answer to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in established principles of pharmacokinetic-pharmacodynamic modeling and robust control theory as applied to clinical anesthesia. The model is a standard simplified representation, and the parameters and constraints ($e.g.$, BIS target of $40$ to $60$, MAP floor of $65$ mmHg, propofol infusion rates) are physiologically and clinically realistic. The problem is well-posed, objective, and self-contained, providing all necessary information to compute the requested tightening parameter. It does not violate any fundamental principles and is free of ambiguity or contradiction.\n\n### Verdict and Action\nThe problem is valid. A complete, reasoned solution will be provided.\n\n### Solution Derivation\nThe primary task is to compute the robust constraint tightening parameter $\\tau_B$. This requires defining the MPC constraint set, formalizing the effect of uncertainty, and calculating the worst-case deviation between the nominal model prediction and the actual system output.\n\nFirst, we construct the constraint set for the MPC based on the nominal model. The controller will enforce these constraints over a prediction horizon. For any time step $k$ in the horizon:\n\n1.  **Infusion limit**: $0 \\le u(k) \\le 10$. This is a direct constraint on the manipulated variable.\n\n2.  **MAP constraint**: $y_M(k) \\ge 65$. This is an output constraint that can be translated into a state constraint using the nominal MAP model:\n    $$y_{M,\\mathrm{base}} - \\alpha_M\\,c_e(k) \\ge 65$$\n    $$85 - 3\\,c_e(k) \\ge 65$$\n    $$20 \\ge 3\\,c_e(k) \\implies c_e(k) \\le \\frac{20}{3}$$\n\n3.  **Robust BIS constraint**: The clinical goal is for the true BIS level to be within the range $[40, 60]$. To ensure this despite uncertainties, the MPC will enforce a tightened constraint on the nominal BIS output, $y_B(k)$:\n    $$40 + \\tau_B \\le y_B(k) \\le 60 - \\tau_B$$\n    This is translated into state constraints:\n    $$40 + \\tau_B \\le 90 - \\alpha_B\\,c_e(k) \\le 60 - \\tau_B$$\n    This gives a lower and an upper bound on the state $c_e(k)$:\n    -   $90 - \\alpha_B\\,c_e(k) \\ge 40 + \\tau_B \\implies 50 - \\tau_B \\ge \\alpha_B\\,c_e(k) \\implies c_e(k) \\le \\frac{50 - \\tau_B}{10}$\n    -   $90 - \\alpha_B\\,c_e(k) \\le 60 - \\tau_B \\implies 30 + \\tau_B \\le \\alpha_B\\,c_e(k) \\implies c_e(k) \\ge \\frac{30 + \\tau_B}{10}$\n\nThe parameter $\\tau_B$ must be large enough to accommodate the worst-case deviation between the actual, measured BIS value and the nominal model's prediction. Let the actual measured BIS be $\\hat{y}_B(k)$. This value includes parameter uncertainty, unmodeled disturbances, and measurement noise. Let the true (uncertain) sensitivity be $\\tilde{\\alpha}_B$.\n$$\\hat{y}_B(k) = (90 - \\tilde{\\alpha}_B\\,c_e(k)) + \\delta_B(k) + \\eta_B(k)$$\nThe nominal BIS prediction is $y_B(k) = 90 - \\alpha_B\\,c_e(k)$.\n\nThe total error, $E(k)$, between the measured and nominal values is:\n$$E(k) = \\hat{y}_B(k) - y_B(k) = \\left( (90 - \\tilde{\\alpha}_B\\,c_e(k)) + \\delta_B(k) + \\eta_B(k) \\right) - (90 - \\alpha_B\\,c_e(k))$$\n$$E(k) = (\\alpha_B - \\tilde{\\alpha}_B)\\,c_e(k) + \\delta_B(k) + \\eta_B(k)$$\n\nFor the robust constraints to be effective, the tightening $\\tau_B$ must be at least as large as the maximum possible magnitude of this error, $|E(k)|$. Using the triangle inequality, we can bound the error:\n$$|E(k)| \\le |(\\alpha_B - \\tilde{\\alpha}_B)\\,c_e(k)| + |\\delta_B(k)| + |\\eta_B(k)|$$\n\nThe minimal tightening $\\tau_B$ is the maximum value of this upper bound:\n$$\\tau_B = \\max |E(k)| = \\max |(\\alpha_B - \\tilde{\\alpha}_B)\\,c_e(k)| + \\max |\\delta_B(k)| + \\max |\\eta_B(k)|$$\n\nWe can evaluate each term using the given uncertainty bounds:\n1.  $\\max |\\delta_B(k)| = \\bar{\\delta}_B = 1$\n2.  $\\max |\\eta_B(k)| = \\bar{\\eta}_B = 1$\n3.  $\\max |(\\alpha_B - \\tilde{\\alpha}_B)\\,c_e(k)| = \\max|\\alpha_B - \\tilde{\\alpha}_B| \\times \\max c_e(k)$. Note that $c_e(k)$, representing a concentration, is non-negative.\n\nThe uncertainty in sensitivity is given by $\\tilde{\\alpha}_B \\in [\\alpha_B(1-\\bar{\\rho}_B), \\alpha_B(1+\\bar{\\rho}_B)]$.\nThis means the maximum deviation $|\\alpha_B - \\tilde{\\alpha}_B|$ is $\\bar{\\rho}_B \\alpha_B$.\n$$\\max |\\alpha_B - \\tilde{\\alpha}_B| = \\bar{\\rho}_B \\alpha_B = 0.05 \\times 10 = 0.5$$\n\nNext, we must determine the worst-case value of $c_e(k)$, denoted $\\max c_e(k)$. The state dynamics are given by $c_e(k+1) = 0.8\\,c_e(k) + 0.1\\,u(k)$. This is a stable first-order linear system since the pole $a=0.8$ has a magnitude less than $1$. The input is bounded, $u(k) \\in [0, 10]$. For such a system, assuming it starts from a physically realistic initial condition like $c_e(0)=0$, the state $c_e(k)$ will be bounded by the maximum possible steady-state value.\n\nThe steady-state concentration $c_{e,ss}$ for a constant input $u$ is found by setting $c_e(k+1) = c_e(k) = c_{e,ss}$:\n$$c_{e,ss} = a\\,c_{e,ss} + b\\,u \\implies c_{e,ss} = \\frac{b}{1-a} u$$\nThe maximum steady-state value occurs at the maximum constant input, $u_{max} = 10$:\n$$\\max c_e(k) = \\frac{b}{1-a} u_{max} = \\frac{0.1}{1-0.8} \\times 10 = \\frac{0.1}{0.2} \\times 10 = 0.5 \\times 10 = 5$$\nThis value is consistent with the nominal operational constraints, as the target BIS range $40 \\le y_B(k) \\le 60$ corresponds to a nominal state range $3 \\le c_e(k) \\le 5$. Thus, the maximum concentration that needs to be considered for the worst-case error calculation is $\\max c_e(k) = 5$.\n\nNow, we can assemble the components to calculate $\\tau_B$:\n$$\\tau_B = (\\bar{\\rho}_B \\alpha_B) \\times (\\max c_e(k)) + \\bar{\\delta}_B + \\bar{\\eta}_B$$\nSubstituting the numerical values:\n$$\\tau_B = (0.5) \\times (5) + 1 + 1$$\n$$\\tau_B = 2.5 + 1 + 1 = 4.5$$\n\nThe problem asks for the answer to be rounded to four significant figures. The calculated value is $4.5$, which can be written as $4.500$.\nThe minimal symmetric tightening parameter is $\\tau_B = 4.500$ BIS units. This ensures that if the controller maintains the nominal BIS prediction $y_B(k)$ within the tightened range $[44.5, 55.5]$, the actual measured BIS $\\hat{y}_B(k)$ will remain within the desired clinical range of $[40, 60]$ despite the worst-case combination of parameter uncertainty, disturbances, and measurement noise.",
            "answer": "$$\\boxed{4.500}$$"
        },
        {
            "introduction": "While MPC optimizes system behavior over a finite future horizon, a truly robust controller must guarantee stability and safety indefinitely. This practice introduces the advanced concept of a terminal set, a cornerstone of provably stable MPC. By computing a robust positively invariant (RPI) set for a ventilator control scenario, you will learn how to define a \"safe region\" for the system state that, once entered, is guaranteed to be maintained for all future time, ensuring long-term satisfaction of all safety constraints .",
            "id": "3902962",
            "problem": "Consider a linearized discrete-time model of arterial oxygen saturation dynamics around a chosen reference saturation level, derived from mass balance of oxygen in the lungs and blood and linearization of the nonlinear hemoglobin-oxygen dissociation relationship. Let the deviation of arterial oxygen saturation from its reference be denoted by $x_k$, the deviation of ventilator support (e.g., fractional inspired oxygen or tidal volume surrogate) from its nominal value be $u_k$, and let exogenous perturbations in metabolic demand and ventilation-perfusion mismatch be aggregated into an additive disturbance $w_k$. The linearized deviation model is\n$$\nx_{k+1} = a\\,x_k + b\\,u_k + w_k,\n$$\nwhere $a \\in \\mathbb{R}$ and $b \\in \\mathbb{R}$ are known scalars obtained from local linearization and discretization of the underlying physiology, $u_k$ is constrained to lie in a compact interval $[u_{\\min}, u_{\\max}]$, and the disturbance $w_k$ is bounded in a compact interval $[w_{\\min}, w_{\\max}]$. The safety requirement on oxygen saturation in physical units is that the actual saturation $S_k$ must remain in a given closed interval $[S_{\\min}, S_{\\max}]$ expressed as a decimal fraction (not a percentage). With a chosen reference saturation $S_{\\mathrm{ref}}$, the safety interval for the deviation state is $[x_{\\min}, x_{\\max}]$ where $x_{\\min} = S_{\\min} - S_{\\mathrm{ref}}$ and $x_{\\max} = S_{\\max} - S_{\\mathrm{ref}}$.\n\nDefine the terminal set as a set $\\mathcal{X}_\\mathrm{T} \\subset \\mathbb{R}$ such that, under a fixed linear state-feedback law $u_k = K\\,x_k$ with known gain $K \\in \\mathbb{R}$, the closed-loop state satisfies $x_k \\in \\mathcal{X}_\\mathrm{T} \\subseteq [x_{\\min}, x_{\\max}]$ for all future times $k$ and all disturbances $w_k \\in [w_{\\min}, w_{\\max}]$, while also respecting the input constraints $K\\,x_k \\in [u_{\\min}, u_{\\max}]$ for all $x_k \\in \\mathcal{X}_\\mathrm{T}$. Your task is to construct such a terminal set using invariant set methods based on first principles of discrete-time dynamical systems and bounded disturbances.\n\nStarting only from foundational definitions (discrete-time state update, bounded disturbances, and the definition of robust positive invariance), design an algorithm that, for the scalar system described above:\n- Determines whether a bounded robust positively invariant set exists under the local feedback $u_k = K\\,x_k$.\n- If it exists, computes the smallest symmetric robust positively invariant interval for the closed-loop dynamics and verifies whether it is contained within the safety interval and yields inputs within constraints. If both containments hold, declare this interval to be the terminal set; otherwise, declare that no terminal set exists under the given $K$ and constraints (represent this by the empty set).\n\nImplement this algorithm in a complete, runnable program that processes the following test suite. For each test case, compute the terminal set in deviation units (saturation fraction deviation) and report it as either an interval $[x_\\mathrm{L}, x_\\mathrm{U}]$ with endpoints in decimal fraction units, or as the empty list if no such terminal set exists. The required output is a single line containing the results for all test cases, aggregated as a comma-separated list enclosed in square brackets, where each element is either a two-element list $[x_\\mathrm{L}, x_\\mathrm{U}]$ or an empty list.\n\nUse the following test suite with parameters given as $(a,b,K,S_{\\mathrm{ref}},S_{\\min},S_{\\max},u_{\\min},u_{\\max},w_{\\min},w_{\\max})$:\n- Test $1$: $(0.9,\\,0.2,\\,-0.5,\\,0.94,\\,0.90,\\,0.98,\\,-0.2,\\,0.2,\\,-0.008,\\,0.008)$\n- Test $2$: $(0.9,\\,0.2,\\,-0.5,\\,0.94,\\,0.90,\\,0.98,\\,-0.2,\\,0.2,\\,-0.015,\\,0.015)$\n- Test $3$: $(0.9,\\,0.2,\\,-1.2,\\,0.94,\\,0.90,\\,0.98,\\,-0.05,\\,0.05,\\,-0.008,\\,0.008)$\n- Test $4$: $(1.05,\\,0.1,\\,-0.3,\\,0.94,\\,0.90,\\,0.98,\\,-0.2,\\,0.2,\\,-0.008,\\,0.008)$\n- Test $5$: $(0.8,\\,0.3,\\,-0.5,\\,0.95,\\,0.90,\\,0.99,\\,-0.04,\\,0.04,\\,-0.005,\\,0.012)$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case’s result must be either a two-element list $[x_\\mathrm{L}, x_\\mathrm{U}]$ in saturation deviation units (decimal fraction), or an empty list if no terminal set exists under the specified conditions. For example, a valid output format is something like $\\texttt{[[xL1,xU1],[],[xL3,xU3],...]}$ with decimal fractions for all numeric entries.",
            "solution": "The problem requires the design of an algorithm to compute a terminal set for a scalar, discrete-time linear system subject to bounded disturbances and constraints on both the state and the control input. The terminal set, $\\mathcal{X}_\\mathrm{T}$, must be a robust positively invariant (RPI) set that satisfies all specified constraints.\n\nThe system dynamics are given by the linear difference equation:\n$$\nx_{k+1} = a\\,x_k + b\\,u_k + w_k\n$$\nwhere $x_k \\in \\mathbb{R}$ is the state deviation, $u_k \\in [u_{\\min}, u_{\\max}]$ is the control input deviation, and $w_k \\in [w_{\\min}, w_{\\max}]$ is a bounded disturbance. A linear state-feedback control law $u_k = K\\,x_k$ is applied.\n\nFirst, we establish the closed-loop dynamics by substituting the control law into the system equation:\n$$\nx_{k+1} = a\\,x_k + b(K\\,x_k) + w_k = (a + bK)x_k + w_k\n$$\nLet us define the closed-loop system matrix as $A_{cl} = a + bK$. The system becomes:\n$$\nx_{k+1} = A_{cl}\\,x_k + w_k\n$$\n\nThe problem mandates finding the smallest symmetric robust positively invariant (RPI) interval and verifying if it qualifies as a terminal set. A set $\\mathcal{X}$ is RPI if, for any state $x_k \\in \\mathcal{X}$ and for any possible disturbance $w_k \\in [w_{\\min}, w_{\\max}]$, the subsequent state $x_{k+1}$ is guaranteed to remain in $\\mathcal{X}$. Formally, $A_{cl}\\mathcal{X} \\oplus \\mathcal{W} \\subseteq \\mathcal{X}$, where $\\mathcal{W} = [w_{\\min}, w_{\\max}]$ and $\\oplus$ denotes the Minkowski sum.\n\nLet us seek a symmetric RPI interval of the form $\\mathcal{X} = [-\\alpha, \\alpha]$ for some $\\alpha \\ge 0$.\nThe set of possible next states, starting from $x_k \\in [-\\alpha, \\alpha]$, is the interval:\n$$\nA_{cl}\\,[-\\alpha, \\alpha] \\oplus [w_{\\min}, w_{\\max}]\n$$\nThe first term evaluates to $A_{cl}\\,[-\\alpha, \\alpha] = [-|A_{cl}|\\alpha, |A_{cl}|\\alpha]$. The Minkowski sum is then:\n$$\n[-|A_{cl}|\\alpha + w_{\\min}, |A_{cl}|\\alpha + w_{\\max}]\n$$\nFor this interval to be a subset of $[-\\alpha, \\alpha]$, two conditions must hold:\n1. $-\\alpha \\le -|A_{cl}|\\alpha + w_{\\min} \\implies \\alpha - |A_{cl}|\\alpha \\ge -w_{\\min} \\implies \\alpha(1 - |A_{cl}|) \\ge -w_{\\min}$\n2. $|A_{cl}|\\alpha + w_{\\max} \\le \\alpha \\implies \\alpha - |A_{cl}|\\alpha \\ge w_{\\max} \\implies \\alpha(1 - |A_{cl}|) \\ge w_{\\max}$\n\nTo satisfy both inequalities simultaneously, $\\alpha$ must satisfy the more restrictive one:\n$$\n\\alpha(1 - |A_{cl}|) \\ge \\max(-w_{\\min}, w_{\\max})\n$$\nA bounded solution for $\\alpha \\ge 0$ can only exist if the term $(1 - |A_{cl}|)$ is strictly positive. This leads to the fundamental condition for the existence of a bounded RPI set for a system with persistent disturbances: the closed-loop system must be stable in the sense of Schur, i.e., $|A_{cl}| < 1$. If $|A_{cl}| \\ge 1$, the state will eventually be driven out of any bounded interval by the disturbance, so no bounded RPI set exists.\n\nIf $|A_{cl}| < 1$, we can divide by the positive quantity $(1 - |A_{cl}|)$ to find the condition on $\\alpha$:\n$$\n\\alpha \\ge \\frac{\\max(-w_{\\min}, w_{\\max})}{1 - |A_{cl}|}\n$$\nThe problem asks for the *smallest* such symmetric RPI set. This corresponds to the smallest valid $\\alpha$, which we denote $\\alpha_{\\min}$:\n$$\n\\alpha_{\\min} = \\frac{\\max(-w_{\\min}, w_{\\max})}{1 - |a+bK|}\n$$\nThe smallest symmetric RPI interval is therefore $\\mathcal{X}_{\\mathrm{RPI}} = [-\\alpha_{\\min}, \\alpha_{\\min}]$.\n\nThis interval $\\mathcal{X}_{\\mathrm{RPI}}$ is a candidate for the terminal set $\\mathcal{X}_\\mathrm{T}$. To be a valid terminal set, it must satisfy two additional constraints:\n\n1.  **State Constraint Satisfaction**: The set must be contained within the safety interval for the state deviation, $[x_{\\min}, x_{\\max}]$, where $x_{\\min} = S_{\\min} - S_{\\mathrm{ref}}$ and $x_{\\max} = S_{\\max} - S_{\\mathrm{ref}}$.\n    $$\n    \\mathcal{X}_{\\mathrm{RPI}} \\subseteq [x_{\\min}, x_{\\max}] \\iff -\\alpha_{\\min} \\ge x_{\\min} \\text{ and } \\alpha_{\\min} \\le x_{\\max}\n    $$\n\n2.  **Input Constraint Satisfaction**: For any state $x \\in \\mathcal{X}_{\\mathrm{RPI}}$, the corresponding control input $u = Kx$ must lie within its allowed range, $[u_{\\min}, u_{\\max}]$. The set of inputs generated from $\\mathcal{X}_{\\mathrm{RPI}}$ is $K \\cdot [-\\alpha_{\\min}, \\alpha_{\\min}] = [-|K|\\alpha_{\\min}, |K|\\alpha_{\\min}]$.\n    $$\n    [-|K|\\alpha_{\\min}, |K|\\alpha_{\\min}] \\subseteq [u_{\\min}, u_{\\max}] \\iff -|K|\\alpha_{\\min} \\ge u_{\\min} \\text{ and } |K|\\alpha_{\\min} \\le u_{\\max}\n    $$\n\nIf $\\mathcal{X}_{\\mathrm{RPI}}$ satisfies both conditions, it is a valid terminal set, $\\mathcal{X}_{\\mathrm{T}} = \\mathcal{X}_{\\mathrm{RPI}}$. Otherwise, no terminal set matching the problem's criteria exists for the given parameters, and the result is the empty set.\n\nThe complete algorithm is as follows:\n1.  Calculate the closed-loop parameter $A_{cl} = a + bK$.\n2.  Check for stability: If $|A_{cl}| \\ge 1$, declare that no suitable terminal set exists.\n3.  If the system is stable, calculate the size of the smallest symmetric RPI set candidate: $\\alpha_{\\min} = \\frac{\\max(-w_{\\min}, w_{\\max})}{1 - |A_{cl}|}$.\n4.  Calculate the state deviation limits: $x_{\\min} = S_{\\min} - S_{\\mathrm{ref}}$ and $x_{\\max} = S_{\\max} - S_{\\mathrm{ref}}$.\n5.  Verify state constraint: Check if $\\alpha_{\\min} \\le x_{\\max}$ and $-\\alpha_{\\min} \\ge x_{\\min}$. If not, no suitable terminal set exists.\n6.  Verify input constraint: Check if $|K|\\alpha_{\\min} \\le u_{\\max}$ and $-|K|\\alpha_{\\min} \\ge u_{\\min}$. If not, no suitable terminal set exists.\n7.  If all checks pass, the terminal set is $[-\\alpha_{\\min}, \\alpha_{\\min}]$. Otherwise, it is the empty set.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the terminal set for a scalar linear system based on invariant set theory.\n    \"\"\"\n    # Test suite with parameters (a, b, K, S_ref, S_min, S_max, u_min, u_max, w_min, w_max)\n    test_cases = [\n        (0.9, 0.2, -0.5, 0.94, 0.90, 0.98, -0.2, 0.2, -0.008, 0.008),\n        (0.9, 0.2, -0.5, 0.94, 0.90, 0.98, -0.2, 0.2, -0.015, 0.015),\n        (0.9, 0.2, -1.2, 0.94, 0.90, 0.98, -0.05, 0.05, -0.008, 0.008),\n        (1.05, 0.1, -0.3, 0.94, 0.90, 0.98, -0.2, 0.2, -0.008, 0.008),\n        (0.8, 0.3, -0.5, 0.95, 0.90, 0.99, -0.04, 0.04, -0.005, 0.012),\n    ]\n\n    results = []\n    for params in test_cases:\n        a, b, K, S_ref, S_min, S_max, u_min, u_max, w_min, w_max = params\n\n        # 1. Calculate closed-loop parameter\n        A_cl = a + b * K\n\n        # 2. Check for stability for existence of a bounded RPI set\n        if abs(A_cl) >= 1:\n            results.append([])\n            continue\n\n        # 3. Calculate size of the smallest symmetric RPI set candidate\n        # The derivation alpha(1-|A_cl|) >= max(-w_min, w_max) is used.\n        w_bound = max(-w_min, w_max)\n        alpha_min = w_bound / (1 - abs(A_cl))\n\n        # 4. Calculate state deviation limits\n        x_min = S_min - S_ref\n        x_max = S_max - S_ref\n        \n        # 5. Verify state constraints\n        if not (-alpha_min >= x_min and alpha_min <= x_max):\n            results.append([])\n            continue\n\n        # 6. Verify input constraints\n        # The set of inputs is [-|K|*alpha_min, |K|*alpha_min]\n        input_magnitude = abs(K) * alpha_min\n        if not (-input_magnitude >= u_min and input_magnitude <= u_max):\n            results.append([])\n            continue\n            \n        # 7. If all checks pass, the terminal set is valid\n        terminal_set = [-alpha_min, alpha_min]\n        results.append(terminal_set)\n\n    # Final print statement in the exact required format.\n    # The default str() representation of a list is \"[item1, item2, ...]\"\n    # which matches the desired format for both success and failure cases.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}