{
    "hands_on_practices": [
        {
            "introduction": "设计像模型预测控制（MPC）这样的生理学控制器，第一步是将抽象的临床目标转化为具体的数学语言。本练习  聚焦于这一关键的转化过程。你将把麻醉的临床需求——例如目标镇静水平和血压安全极限——形式化为一组精确的不等式约束。你还将通过计算一个“鲁棒紧缩”参数来应对模型不确定性的挑战，以确保即使在模型不完美的情况下也能保障安全。",
            "id": "3902931",
            "problem": "一位临床医生正在为全身麻醉期间的丙泊酚输注配置模型预测控制（MPC）。该控制器将以 $T_s = 1$ 分钟的采样周期运行，并且必须满足临床安全性和有效性约束。用于预测的药代动力学-药效动力学模型是以下的离散时间线性效应室模型和输出关系：\n- 效应室动力学：$c_e(k+1) = a\\,c_e(k) + b\\,u(k)$，其中 $a = 0.8$，$b = 0.1$，$c_e(k)$ 是效应室浓度的代理变量，$u(k)$ 是丙泊酚输注速率，单位为 $\\mathrm{mg\\,min^{-1}}$。\n- 脑电双频指数（BIS）输出：$y_B(k) = 90 - \\alpha_B\\,c_e(k)$，标称灵敏度为 $\\alpha_B = 10$（BIS单位/效应室单位）。\n- 平均动脉压（MAP）输出：$y_M(k) = y_{M,\\mathrm{base}} - \\alpha_M\\,c_e(k)$，其中基线平均动脉压 $y_{M,\\mathrm{base}} = 85$ $\\mathrm{mmHg}$，灵敏度为 $\\alpha_M = 3$ $\\mathrm{mmHg}$/效应室单位。\n\n控制器必须强制执行：\n- 输注限制：$0 \\le u(k) \\le 10$ $\\mathrm{mg\\,min^{-1}}$，此限制源于输液泵的能力和成人的安全剂量范围。\n- BIS 目标范围：$40 \\le y_B(k) \\le 60$，以在成人全身麻醉期间维持适当的催眠深度。\n- 最大允许血压下降：$y_M(k) \\ge 65$ $\\mathrm{mmHg}$，相当于将血压从基线下降的幅度限制在最多 $20$ $\\mathrm{mmHg}$，以避免低血压相关风险。\n\n为确保在有界不确定性下对 BIS 约束的鲁棒满足，使用以下不确定性模型：\n- BIS 的测量噪声有界，为 $|\\eta_B(k)| \\le \\bar{\\eta}_B$，其中 $\\bar{\\eta}_B = 1$（BIS 单位）。\n- 未建模的加性 BIS 扰动有界，为 $|\\delta_B(k)| \\le \\bar{\\delta}_B$，其中 $\\bar{\\delta}_B = 1$（BIS 单位）。\n- 灵敏度参数不确定性有界，为 $\\alpha_B \\in [(1-\\bar{\\rho}_B)\\alpha_B,(1+\\bar{\\rho}_B)\\alpha_B]$，其中 $\\bar{\\rho}_B = 0.05$。\n\n为 MPC 构建一个约束集，该约束集使用标称模型输出 $y_B(k)$ 和 $y_M(k)$ 来编码输注限制、BIS 目标范围和 MAP 下降约束，并通过从上界减去紧缩参数 $\\tau_B$ 并向下界添加 $\\tau_B$ 的方式，对 BIS 约束应用对称鲁棒紧缩。使用生理学考虑和给定模型来论证每个边界。然后，计算最小对称紧缩参数 $\\tau_B$，该参数保证在所有满足上述边界的不确定性下，BIS 约束都成立，假设在恒定输入下，$c_e(k)$ 取与模型和输注限制一致的最坏情况值。将您的答案四舍五入到四位有效数字。以 BIS 单位表示最终答案。",
            "solution": "用户提供了一个关于为丙泊酚输注配置模型预测控制器（MPC）的问题陈述。第一步是验证问题陈述。\n\n### 步骤 1：提取已知条件\n-   **系统模型和参数**：\n    -   离散时间状态空间模型：$c_e(k+1) = a\\,c_e(k) + b\\,u(k)$\n    -   状态更新参数：$a = 0.8$\n    -   输入增益：$b = 0.1$\n    -   采样周期：$T_s = 1$ 分钟\n    -   状态变量：$c_e(k)$，效应室代理变量\n    -   输入变量：$u(k)$，丙泊酚输注速率，单位为 $\\mathrm{mg\\,min^{-1}}$\n    -   BIS 输出模型：$y_B(k) = 90 - \\alpha_B\\,c_e(k)$\n    -   标称 BIS 灵敏度：$\\alpha_B = 10$\n    -   MAP 输出模型：$y_M(k) = y_{M,\\mathrm{base}} - \\alpha_M\\,c_e(k)$\n    -   基线 MAP：$y_{M,\\mathrm{base}} = 85$ $\\mathrm{mmHg}$\n    -   MAP 灵敏度：$\\alpha_M = 3$ $\\mathrm{mmHg}$/效应室单位\n\n-   **约束**：\n    -   输入约束：$0 \\le u(k) \\le 10$ $\\mathrm{mg\\,min^{-1}}$\n    -   BIS 目标范围：$40 \\le y_B(k) \\le 60$\n    -   MAP 安全约束：$y_M(k) \\ge 65$ $\\mathrm{mmHg}$\n\n-   **不确定性模型**：\n    -   BIS 测量噪声界：$|\\eta_B(k)| \\le \\bar{\\eta}_B$，其中 $\\bar{\\eta}_B = 1$\n    -   加性 BIS 扰动界：$|\\delta_B(k)| \\le \\bar{\\delta}_B$，其中 $\\bar{\\delta}_B = 1$\n    -   BIS 灵敏度不确定性：$\\alpha_B \\in [(1-\\bar{\\rho}_B)\\alpha_B,(1+\\bar{\\rho}_B)\\alpha_B]$，其中 $\\bar{\\rho}_B = 0.05$\n\n-   **任务**：\n    1.  构建 MPC 约束集。\n    2.  对 BIS 约束应用对称鲁棒紧缩：$40 + \\tau_B \\le \\text{标称 } y_B(k) \\le 60 - \\tau_B$。\n    3.  计算最小对称紧缩参数 $\\tau_B$，以保证在所有指定的不确定性下，实际的 BIS 约束都成立。\n    4.  假设 $c_e(k)$ 的最坏情况与模型和输入限制一致。\n    5.  将最终答案四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在科学上基于成熟的药代动力学-药效动力学建模和鲁棒控制理论在临床麻醉中的应用原则。该模型是一个标准的简化表示，其参数和约束（例如，BIS 目标范围 40 到 60，MAP 下限 65 mmHg，丙泊酚输注速率）在生理和临床上都是现实的。该问题提法得当、客观且自洽，提供了计算所需紧缩参数的所有必要信息。它没有违反任何基本原则，也没有模糊或矛盾之处。\n\n### 结论和行动\n该问题有效。将提供一个完整的、有理有据的解决方案。\n\n### 求解推导\n主要任务是计算鲁棒约束紧缩参数 $\\tau_B$。这需要定义 MPC 约束集，形式化不确定性的影响，并计算标称模型预测与实际系统输出之间的最坏情况偏差。\n\n首先，我们基于标称模型构建 MPC 的约束集。控制器将在一个预测时域内强制执行这些约束。对于时域中的任何时间步 $k$：\n\n1.  **输注限制**：$0 \\le u(k) \\le 10$。这是对操纵变量的直接约束。\n\n2.  **MAP 约束**：$y_M(k) \\ge 65$。这是一个输出约束，可以使用标称 MAP 模型将其转换为状态约束：\n    $$y_{M,\\mathrm{base}} - \\alpha_M\\,c_e(k) \\ge 65$$\n    $$85 - 3\\,c_e(k) \\ge 65$$\n    $$20 \\ge 3\\,c_e(k) \\implies c_e(k) \\le \\frac{20}{3}$$\n\n3.  **鲁棒 BIS 约束**：临床目标是使真实的 BIS 水平保持在 $[40, 60]$ 范围内。为确保在存在不确定性的情况下实现这一目标，MPC 将对标称 BIS 输出 $y_B(k)$ 强制执行一个紧缩的约束：\n    $$40 + \\tau_B \\le y_B(k) \\le 60 - \\tau_B$$\n    这被转换为状态约束：\n    $$40 + \\tau_B \\le 90 - \\alpha_B\\,c_e(k) \\le 60 - \\tau_B$$\n    这给出了状态 $c_e(k)$ 的一个下界和一个上界：\n    -   $90 - \\alpha_B\\,c_e(k) \\ge 40 + \\tau_B \\implies 50 - \\tau_B \\ge \\alpha_B\\,c_e(k) \\implies c_e(k) \\le \\frac{50 - \\tau_B}{10}$\n    -   $90 - \\alpha_B\\,c_e(k) \\le 60 - \\tau_B \\implies 30 + \\tau_B \\le \\alpha_B\\,c_e(k) \\implies c_e(k) \\ge \\frac{30 + \\tau_B}{10}$\n\n参数 $\\tau_B$ 必须足够大，以容纳实际测量的 BIS 值与标称模型预测之间的最坏情况偏差。设实际测量的 BIS 为 $\\hat{y}_B(k)$。该值包括参数不确定性、未建模的扰动和测量噪声。设真实（不确定的）灵敏度为 $\\tilde{\\alpha}_B$。\n$$\\hat{y}_B(k) = (90 - \\tilde{\\alpha}_B\\,c_e(k)) + \\delta_B(k) + \\eta_B(k)$$\n标称 BIS 预测为 $y_B(k) = 90 - \\alpha_B\\,c_e(k)$。\n\n测量值与标称值之间的总误差 $E(k)$ 为：\n$$E(k) = \\hat{y}_B(k) - y_B(k) = \\left( (90 - \\tilde{\\alpha}_B\\,c_e(k)) + \\delta_B(k) + \\eta_B(k) \\right) - (90 - \\alpha_B\\,c_e(k))$$\n$$E(k) = (\\alpha_B - \\tilde{\\alpha}_B)\\,c_e(k) + \\delta_B(k) + \\eta_B(k)$$\n\n为了使鲁棒约束有效，紧缩量 $\\tau_B$ 必须至少与该误差的最大可能幅值 $|E(k)|$ 一样大。使用三角不等式，我们可以对误差进行限定：\n$$|E(k)| \\le |(\\alpha_B - \\tilde{\\alpha}_B)\\,c_e(k)| + |\\delta_B(k)| + |\\eta_B(k)|$$\n\n最小紧缩量 $\\tau_B$ 是此上界的最大值：\n$$\\tau_B = \\max |E(k)| = \\max |(\\alpha_B - \\tilde{\\alpha}_B)\\,c_e(k)| + \\max |\\delta_B(k)| + \\max |\\eta_B(k)|$$\n\n我们可以使用给定的不确定性界限来评估每一项：\n1.  $\\max |\\delta_B(k)| = \\bar{\\delta}_B = 1$\n2.  $\\max |\\eta_B(k)| = \\bar{\\eta}_B = 1$\n3.  $\\max |(\\alpha_B - \\tilde{\\alpha}_B)\\,c_e(k)| = \\max|\\alpha_B - \\tilde{\\alpha}_B| \\times \\max c_e(k)$。注意，$c_e(k)$ 代表浓度，是非负的。\n\n灵敏度的不确定性由 $\\tilde{\\alpha}_B \\in [\\alpha_B(1-\\bar{\\rho}_B), \\alpha_B(1+\\bar{\\rho}_B)]$ 给出。\n这意味着最大偏差 $|\\alpha_B - \\tilde{\\alpha}_B|$ 是 $\\bar{\\rho}_B \\alpha_B$。\n$$\\max |\\alpha_B - \\tilde{\\alpha}_B| = \\bar{\\rho}_B \\alpha_B = 0.05 \\times 10 = 0.5$$\n\n接下来，我们必须确定 $c_e(k)$ 的最坏情况值，记为 $\\max c_e(k)$。状态动力学由 $c_e(k+1) = 0.8\\,c_e(k) + 0.1\\,u(k)$ 给出。这是一个稳定的一阶线性系统，因为极点 $a=0.8$ 的幅值小于 1。输入是有界的，$u(k) \\in [0, 10]$。对于这样的系统，假设它从一个物理上现实的初始条件（如 $c_e(0)=0$）开始，状态 $c_e(k)$ 将受限于可能的最大稳态值。\n\n对于恒定输入 $u$，稳态浓度 $c_{e,ss}$ 可以通过设置 $c_e(k+1) = c_e(k) = c_{e,ss}$ 来找到：\n$$c_{e,ss} = a\\,c_{e,ss} + b\\,u \\implies c_{e,ss} = \\frac{b}{1-a} u$$\n最大稳态值出现在最大恒定输入 $u_{max} = 10$ 时：\n$$\\max c_e(k) = \\frac{b}{1-a} u_{max} = \\frac{0.1}{1-0.8} \\times 10 = \\frac{0.1}{0.2} \\times 10 = 0.5 \\times 10 = 5$$\n这个值与标称操作约束是一致的，因为目标 BIS 范围 $40 \\le y_B(k) \\le 60$ 对应于标称状态范围 $3 \\le c_e(k) \\le 5$。因此，在最坏情况误差计算中需要考虑的最大浓度是 $\\max c_e(k) = 5$。\n\n现在，我们可以组合这些分量来计算 $\\tau_B$：\n$$\\tau_B = (\\bar{\\rho}_B \\alpha_B) \\times (\\max c_e(k)) + \\bar{\\delta}_B + \\bar{\\eta}_B$$\n代入数值：\n$$\\tau_B = (0.5) \\times (5) + 1 + 1$$\n$$\\tau_B = 2.5 + 1 + 1 = 4.5$$\n\n问题要求将答案四舍五入到四位有效数字。计算出的值为 $4.5$，可以写成 $4.500$。\n最小对称紧缩参数为 $\\tau_B = 4.500$ BIS 单位。这确保了如果控制器将标称 BIS 预测 $y_B(k)$ 维持在紧缩范围 $[44.5, 55.5]$ 内，那么尽管存在参数不确定性、扰动和测量噪声的最坏情况组合，实际测量的 BIS $\\hat{y}_B(k)$ 仍将保持在所期望的临床范围 $[40, 60]$ 内。",
            "answer": "$$\\boxed{4.500}$$"
        },
        {
            "introduction": "模型预测控制的核心是使用离散时间模型来预测患者未来的生理状态。但这个模型从何而来？我们又该如何信任它？本练习  深入探讨了这一基本问题。你将从一个连续时间的药代动力学模型出发，推导出其离散时间形式。通过比较一种简单的数值近似（前向欧拉法）和一种精确方法，你将揭示在计算成本、预测精度和数值稳定性之间的根本权衡，这些是构建可靠控制器时的关键考量。",
            "id": "3902953",
            "problem": "一个双室药代动力学模型描述了中央室和周边室中的药物量，分别用 $x_{1}(t)$ 和 $x_{2}(t)$ 表示。药物以一级速率常数 $k_{10} > 0$ 从中央室消除，以一级速率常数 $k_{12} > 0$ 从中央室交换到周边室，并以一级速率常数 $k_{21} > 0$ 从周边室返回到中央室。一个静脉输注输入 $u(t)$（单位时间内的药物量）进入中央室。假设各室混合均匀且为线性一级动力学。\n\n从质量平衡（质量守恒）和一级流的定义出发，执行以下任务：\n\na) 推导连续时间线性时不变状态空间模型 $\\dot{x}(t) = A_{c} x(t) + B_{c} u(t)$，其中 $x(t) = \\begin{pmatrix} x_{1}(t) \\\\ x_{2}(t) \\end{pmatrix}$。用 $k_{10}$、$k_{12}$ 和 $k_{21}$ 明确地表示 $A_{c}$ 和 $B_{c}$。\n\nb) 使用前向欧拉法作为导数的一阶近似的定义，在恒定采样周期 $h > 0$ 下，对每个采样区间内的输入 $u(t)$ 使用零阶保持器，推导前向欧拉离散化。即，推导矩阵 $A_{d}^{\\mathrm{E}}(h)$ 和 $B_{d}^{\\mathrm{E}}(h)$，使得 $x_{k+1} = A_{d}^{\\mathrm{E}}(h) x_{k} + B_{d}^{\\mathrm{E}}(h) u_{k}$。\n\nc) 从线性时不变系统的精确解和矩阵指数的定义出发，推导精确零阶保持器离散化 $x_{k+1} = A_{d}^{\\mathrm{X}}(h) x_{k} + B_{d}^{\\mathrm{X}}(h) u_{k}$，其中 $A_{d}^{\\mathrm{X}}(h) = \\exp(A_{c} h)$，$B_{d}^{\\mathrm{X}}(h)$ 由一个包含 $\\exp(A_{c} \\tau)$ 和 $B_{c}$ 的积分给出。用 $A_{c}$、$B_{c}$ 和 $h$ 的闭式形式表示 $B_{d}^{\\mathrm{X}}(h)$。\n\nd) 对于模型预测控制 (MPC) 设计，闭环预测模型应为舒尔稳定，以避免数值和概念上的困难。在已知 $k_{10}$、$k_{12}$ 和 $k_{21}$ 严格为正的情况下，使用基于特征值的推理，推导 b) 中获得的前向欧拉离散化关于 $h$ 的稳定性的充要条件。然后，将此条件简化为最大允许采样周期 $h_{\\max}$ 的单一闭式表达式，该表达式是 $k_{10}$、$k_{12}$ 和 $k_{21}$ 的函数，并保证开环药代动力学动态的前向欧拉离散化是舒尔稳定的。\n\ne) 在此背景下，简要比较用于 MPC 设计的前向欧拉离散化和精确离散化在稳定性和预测精度方面的权衡，并强调 $h$ 的选择如何与这些权衡相互作用。\n\n作为您的最终答案，仅提供 d) 部分中 $h_{\\max}$ 的闭式符号表达式。不要代入数值，最终表达式不需要单位。",
            "solution": "问题陈述已经过验证，并被认为是有效的。它在药代动力学建模方面有科学依据，提法恰当且信息充分，表述客观。这些任务是线性系统理论与控制中的标准推导。\n\na) 连续时间状态空间模型的推导。\n\n状态变量是中央室中的药物量 $x_{1}(t)$ 和周边室中的药物量 $x_{2}(t)$。我们对每个室应用质量平衡原理。\n\n对于中央室，药物量的变化率 $\\dot{x}_{1}(t)$ 等于所有流入速率之和减去所有流出速率之和。\n流入速率为静脉输注 $u(t)$ 和从周边室返回的量 $k_{21}x_{2}(t)$。\n流出速率为从体内消除的量 $k_{10}x_{1}(t)$ 和转移到周边室的量 $k_{12}x_{1}(t)$。\n因此，中央室的质量平衡方程为：\n$$\n\\frac{dx_{1}(t)}{dt} = \\dot{x}_{1}(t) = u(t) + k_{21}x_{2}(t) - k_{10}x_{1}(t) - k_{12}x_{1}(t)\n$$\n整理各项，我们得到：\n$$\n\\dot{x}_{1}(t) = -(k_{10} + k_{12})x_{1}(t) + k_{21}x_{2}(t) + u(t)\n$$\n\n对于周边室，变化率 $\\dot{x}_{2}(t)$ 的确定方式类似。\n唯一的流入来自中央室，速率为 $k_{12}x_{1}(t)$。\n唯一的流出是返回中央室，速率为 $k_{21}x_{2}(t)$。\n周边室的质量平衡方程为：\n$$\n\\frac{dx_{2}(t)}{dt} = \\dot{x}_{2}(t) = k_{12}x_{1}(t) - k_{21}x_{2}(t)\n$$\n\n我们可以将这两个耦合的一阶线性微分方程写成状态空间形式 $\\dot{x}(t) = A_{c} x(t) + B_{c} u(t)$，其中 $x(t) = \\begin{pmatrix} x_{1}(t) \\\\ x_{2}(t) \\end{pmatrix}$：\n$$\n\\begin{pmatrix} \\dot{x}_{1}(t) \\\\ \\dot{x}_{2}(t) \\end{pmatrix} = \\begin{pmatrix} -(k_{10} + k_{12}) & k_{21} \\\\ k_{12} & -k_{21} \\end{pmatrix} \\begin{pmatrix} x_{1}(t) \\\\ x_{2}(t) \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} u(t)\n$$\n通过与通用形式进行比较，我们确定矩阵 $A_{c}$ 和 $B_{c}$ 为：\n$$\nA_{c} = \\begin{pmatrix} -(k_{10} + k_{12}) & k_{21} \\\\ k_{12} & -k_{21} \\end{pmatrix}, \\quad B_{c} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}\n$$\n\nb) 前向欧拉离散化的推导。\n\n前向欧拉法将时间 $t_{k} = k h$ 处的导数 $\\dot{x}(t)$ 近似为 $\\dot{x}(t_{k}) \\approx \\frac{x(t_{k+1}) - x(t_{k})}{h}$，其中 $h$ 是采样周期。令 $x_{k} \\equiv x(t_{k})$。在零阶保持器下，输入 $u(t)$ 在区间 $[t_{k}, t_{k+1})$ 上被假定为常数，即 $u(t) = u_{k}$。\n将该近似代入 $t=t_k$ 时的连续时间模型：\n$$\n\\frac{x_{k+1} - x_{k}}{h} = A_{c} x_{k} + B_{c} u_{k}\n$$\n两边乘以 $h$ 并整理以求解 $x_{k+1}$：\n$$\nx_{k+1} - x_{k} = h A_{c} x_{k} + h B_{c} u_{k}\n$$\n$$\nx_{k+1} = x_{k} + h A_{c} x_{k} + h B_{c} u_{k} = (I + h A_{c}) x_{k} + (h B_{c}) u_{k}\n$$\n这是 $x_{k+1} = A_{d}^{\\mathrm{E}}(h) x_{k} + B_{d}^{\\mathrm{E}}(h) u_{k}$ 的形式。矩阵为：\n$$\nA_{d}^{\\mathrm{E}}(h) = I + h A_{c} = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} + h \\begin{pmatrix} -(k_{10} + k_{12}) & k_{21} \\\\ k_{12} & -k_{21} \\end{pmatrix} = \\begin{pmatrix} 1 - h(k_{10} + k_{12}) & h k_{21} \\\\ h k_{12} & 1 - h k_{21} \\end{pmatrix}\n$$\n$$\nB_{d}^{\\mathrm{E}}(h) = h B_{c} = h \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} h \\\\ 0 \\end{pmatrix}\n$$\n\nc) 精确零阶保持器离散化的推导。\n\n线性时不变系统 $\\dot{x}(t) = A_c x(t) + B_c u(t)$ 从时间 $t_k$ 到 $t_{k+1} = t_k+h$ 的精确解，在输入 $u(t)=u_k$（对于 $t \\in [t_k, t_{k+1})$）为常数的情况下，由常数变易法公式给出：\n$$\nx(t_{k+1}) = \\exp(A_{c} h) x(t_{k}) + \\left( \\int_{t_{k}}^{t_{k+1}} \\exp(A_{c}(t_{k+1}-\\tau)) B_{c} d\\tau \\right) u_{k}\n$$\n使用记号 $x_k = x(t_k)$，我们可以确定 $A_{d}^{\\mathrm{X}}(h) = \\exp(A_c h)$。输入矩阵 $B_{d}^{\\mathrm{X}}(h)$ 是积分项：\n$$\nB_{d}^{\\mathrm{X}}(h) = \\left( \\int_{0}^{h} \\exp(A_{c}s) ds \\right) B_{c}\n$$\n其中我们进行了替换 $s = t_{k+1}-\\tau$。为了以闭式形式计算此积分，我们可以使用性质 $\\frac{d}{ds} (A_c^{-1}\\exp(A_c s)) = \\exp(A_c s)$，前提是 $A_c$ 是可逆的。我们来检查 $A_c$ 的行列式：\n$$\n\\det(A_{c}) = (-(k_{10} + k_{12}))(-k_{21}) - (k_{21})(k_{12}) = k_{10}k_{21} + k_{12}k_{21} - k_{12}k_{21} = k_{10}k_{21}\n$$\n由于给定 $k_{10} > 0$ 和 $k_{21} > 0$，所以 $\\det(A_{c}) > 0$，因此 $A_c$ 是可逆的。我们现在可以计算该积分：\n$$\n\\int_{0}^{h} \\exp(A_{c}s) ds = \\left[ A_{c}^{-1} \\exp(A_{c}s) \\right]_{0}^{h} = A_{c}^{-1} (\\exp(A_{c}h) - \\exp(A_{c} \\cdot 0)) = A_{c}^{-1}(\\exp(A_{c}h) - I)\n$$\n将此结果代回，我们得到 $B_{d}^{\\mathrm{X}}(h)$ 的闭式形式：\n$$\nB_{d}^{\\mathrm{X}}(h) = A_{c}^{-1}(\\exp(A_{c}h) - I) B_{c}\n$$\n\nd) 前向欧拉离散化的稳定性条件。\n\n一个离散时间线性系统是舒尔稳定的，当且仅当其状态矩阵的所有特征值的模都小于1。对于前向欧拉离散化，状态矩阵是 $A_{d}^{\\mathrm{E}}(h) = I + h A_{c}$。\n如果 $\\lambda_i(A_c)$ 是 $A_c$ 的一个特征值，那么 $A_{d}^{\\mathrm{E}}(h)$ 的对应特征值是 $\\lambda_i(A_{d}^{\\mathrm{E}}) = 1 + h \\lambda_i(A_c)$。稳定性条件是对于所有 $i$ 都有 $|\\lambda_i(A_{d}^{\\mathrm{E}})| < 1$。\n$$|1 + h \\lambda_i(A_c)| < 1$$\n首先，我们求 $A_c$ 的特征值。特征方程为 $\\det(A_c - \\lambda I) = 0$：\n$$\n\\lambda^2 - \\mathrm{tr}(A_c)\\lambda + \\det(A_c) = 0\n$$\n$$\n\\lambda^2 - (-(k_{10} + k_{12}) - k_{21})\\lambda + (k_{10}k_{21}) = 0\n$$\n$$\n\\lambda^2 + (k_{10} + k_{12} + k_{21})\\lambda + k_{10}k_{21} = 0\n$$\n根的积为 $\\lambda_1\\lambda_2 = k_{10}k_{21} > 0$，根的和为 $\\lambda_1+\\lambda_2 = -(k_{10}+k_{12}+k_{21}) < 0$。由于积为正且和为负，两个特征值 $\\lambda_1, \\lambda_2$ 必定都是负实数。\n设 $\\lambda_c$ 是 $A_c$ 的一个负实数特征值。稳定性条件变为：\n$$\n|1 + h \\lambda_c| < 1 \\implies -1 < 1 + h \\lambda_c < 1\n$$\n右侧不等式 $1 + h \\lambda_c < 1 \\implies h \\lambda_c < 0$ 总是成立，因为 $h>0$ 且 $\\lambda_c < 0$。\n左侧不等式 $-1 < 1 + h \\lambda_c \\implies -2 < h \\lambda_c \\implies h > \\frac{-2}{\\lambda_c}$。由于 $\\lambda_c$ 是负数，这等价于 $h < \\frac{2}{-\\lambda_c} = \\frac{2}{|\\lambda_c|}$。\n这个条件必须对两个特征值都成立。因此，$h$ 必须小于这些界的最小值：\n$$\nh < \\min\\left(\\frac{2}{|\\lambda_1|}, \\frac{2}{|\\lambda_2|}\\right) = \\frac{2}{\\max(|\\lambda_1|, |\\lambda_2|)}\n$$\n最大允许采样周期为 $h_{\\max} = \\frac{2}{\\max_{i}|\\lambda_i(A_c)|}$。特征值是特征多项式的根：\n$$\n\\lambda = \\frac{-(k_{10} + k_{12} + k_{21}) \\pm \\sqrt{(k_{10} + k_{12} + k_{21})^2 - 4k_{10}k_{21}}}{2}\n$$\n模最大的特征值是分子中平方根前带有负号的那个，因为分子中的两项都是负数。\n$$\n\\max_{i}|\\lambda_i(A_c)| = \\left| \\frac{-(k_{10} + k_{12} + k_{21}) - \\sqrt{(k_{10} + k_{12} + k_{21})^2 - 4k_{10}k_{21}}}{2} \\right|\n$$\n$$\n\\max_{i}|\\lambda_i(A_c)| = \\frac{(k_{10} + k_{12} + k_{21}) + \\sqrt{(k_{10} + k_{12} + k_{21})^2 - 4k_{10}k_{21}}}{2}\n$$\n因此，最大允许采样周期为：\n$$\nh_{\\max} = \\frac{4}{(k_{10} + k_{12} + k_{21}) + \\sqrt{(k_{10} + k_{12} + k_{21})^2 - 4k_{10}k_{21}}}\n$$\n\ne) 用于 MPC 的离散化方法的比较。\n\n对于模型预测控制 (MPC)，预测模型用于预测系统的未来演变。离散化方法的选择深刻地影响着控制器的性能和可行性。\n\n前向欧拉 (FE) 离散化：\n- **稳定性**：FE 离散化的模型只是条件稳定的。采样周期 $h$ 必须严格小于 d) 部分推导出的 $h_{\\max}$。这对控制器设计施加了硬约束。如果系统参数 ($k_{ij}$) 发生变化，$h_{\\max}$ 可能会减小，一个先前稳定的控制器可能会变得不稳定。\n- **精度**：FE 是一阶近似。其预测精度较差，特别是在 MPC 中典型的长预测时域上，除非选择非常小的 $h$。这种模型失配可能导致次优甚至不稳定的闭环行为。\n- **权衡**：主要优点是简单。然而，为了保证稳定性和精度，需要一个很小的 $h$，这会导致预测时域中的步数增多，从而增加了 MPC 优化问题的计算负担。\n\n精确零阶保持器 (ZOH) 离散化：\n- **稳定性**：一个稳定的连续时间系统的精确 ZOH 离散化对于任何采样周期 $h > 0$ 都是稳定的。这是因为映射 $\\lambda_d = \\exp(\\lambda_c h)$ 将连续特征值的稳定左半平面映射到离散特征值的单位圆内部稳定区域。这消除了对 $h$ 选择的稳定性约束。\n- **精度**：顾名思义，对于具有分段常数输入的系统，它是“精确”的。它在采样时刻提供了系统状态的高度精确预测，最大限度地减少了由离散化引起的模型失配。这种精度对 MPC 的性能至关重要。\n- **权衡**：矩阵指数的计算可能比 FE 的简单代数计算更为密集。然而，对于给定的 $h$，这是一次性的离线计算。关键的好处是，可以根据控制目标（例如，响应速度、扰动抑制）而不是数值稳定性来选择 $h$。这通常允许比 FE 使用更大的 $h$，从而降低了 MPC 优化问题的维度，进而减少了实时计算负荷。\n\n总之，在这种药代动力学应用的 MPC 设计中，精确 ZOH 离散化要优越得多。它保证了模型稳定性和高预测精度，使设计者可以自由地选择一个采样周期 $h$，以优化地平衡控制性能和计算成本，而不受前向欧拉法固有的数值稳定性问题的约束。",
            "answer": "$$\n\\boxed{\\frac{4}{(k_{10} + k_{12} + k_{21}) + \\sqrt{(k_{10} + k_{12} + k_{21})^{2} - 4 k_{10} k_{21}}}}\n$$"
        },
        {
            "introduction": "虽然 MPC 在一个有限的未来时间范围内进行优化，但一个关键挑战是确保系统在预测范围之外的长期运行中始终保持安全。这个高级练习  介绍了终端集的概念，这是一个保证长期稳定性和约束满足的强大工具。你将为一个呼吸机控制场景开发并实现一个算法，用以计算一个鲁棒不变集。该集合就像一个“安全港”，一旦系统状态进入该区域，控制器就能无限期地将其维持在安全范围内。",
            "id": "3902962",
            "problem": "考虑一个围绕选定参考饱和度水平的动脉血氧饱和度动态的线性化离散时间模型，该模型源自肺部和血液中的氧气质量平衡以及非线性血红蛋白-氧解离关系的线性化。令动脉血氧饱和度与其参考值的偏差表示为 $x_k$，呼吸机支持（例如，吸入氧分数或潮气量替代指标）与其标称值的偏差表示为 $u_k$，并将代谢需求和通气-灌注失配中的外源性扰动聚合成一个加性扰动 $w_k$。该线性化偏差模型为\n$$\nx_{k+1} = a\\,x_k + b\\,u_k + w_k,\n$$\n其中 $a \\in \\mathbb{R}$ 和 $b \\in \\mathbb{R}$ 是通过对基础生理学进行局部线性化和离散化得到的已知标量，$u_k$ 被约束在一个紧凑区间 $[u_{\\min}, u_{\\max}]$ 内，扰动 $w_k$ 在一个紧凑区间 $[w_{\\min}, w_{\\max}]$ 内有界。物理单位下对血氧饱和度的安全要求是，实际饱和度 $S_k$ 必须保持在给定的闭区间 $[S_{\\min}, S_{\\max}]$ 内，表示为小数（而非百分比）。对于一个选定的参考饱和度 $S_{\\mathrm{ref}}$，偏差状态的安全区间为 $[x_{\\min}, x_{\\max}]$，其中 $x_{\\min} = S_{\\min} - S_{\\mathrm{ref}}$ 且 $x_{\\max} = S_{\\max} - S_{\\mathrm{ref}}$。\n\n将终端集定义为一个集合 $\\mathcal{X}_\\mathrm{T} \\subset \\mathbb{R}$，使得在一个固定的线性状态反馈律 $u_k = K\\,x_k$（其中增益 $K \\in \\mathbb{R}$ 已知）下，对于所有未来的时间 $k$ 和所有扰动 $w_k \\in [w_{\\min}, w_{\\max}]$，闭环状态满足 $x_k \\in \\mathcal{X}_\\mathrm{T} \\subseteq [x_{\\min}, x_{\\max}]$，同时对于所有 $x_k \\in \\mathcal{X}_\\mathrm{T}$，也满足输入约束 $K\\,x_k \\in [u_{\\min}, u_{\\max}]$。你的任务是，仅基于离散时间动力学系统和有界扰动的基本原理，使用不变集方法构造这样一个终端集。\n\n仅从基本定义（离散时间状态更新、有界扰动和鲁棒正不变性的定义）出发，为上述标量系统设计一个算法，该算法：\n- 判断在局部反馈 $u_k = K\\,x_k$ 下是否存在一个有界的鲁棒正不变集。\n- 如果存在，则计算闭环动力学的最小对称鲁棒正不变区间，并验证该区间是否包含在安全区间内，且产生的输入是否在约束范围内。如果两个包含关系都成立，则将此区间声明为终端集；否则，声明在给定的 $K$ 和约束条件下不存在终端集（用空集表示）。\n\n在完整的、可运行的程序中实现此算法，以处理以下测试套件。对于每个测试用例，计算偏差单位（饱和度小数偏差）下的终端集，并将其报告为区间 $[x_\\mathrm{L}, x_\\mathrm{U}]$（其端点为小数值），或者如果不存在这样的终端集，则报告为空列表。要求的输出是包含所有测试用例结果的单行，聚合为一个用方括号括起来的逗号分隔列表，其中每个元素要么是一个双元素列表 $[x_\\mathrm{L}, x_\\mathrm{U}]$，要么是一个空列表。\n\n使用以下测试套件，其参数以 $(a,b,K,S_{\\mathrm{ref}},S_{\\min},S_{\\max},u_{\\min},u_{\\max},w_{\\min},w_{\\max})$ 的形式给出：\n- 测试 $1$：$(0.9,\\,0.2,\\,-0.5,\\,0.94,\\,0.90,\\,0.98,\\,-0.2,\\,0.2,\\,-0.008,\\,0.008)$\n- 测试 $2$：$(0.9,\\,0.2,\\,-0.5,\\,0.94,\\,0.90,\\,0.98,\\,-0.2,\\,0.2,\\,-0.015,\\,0.015)$\n- 测试 $3$：$(0.9,\\,0.2,\\,-1.2,\\,0.94,\\,0.90,\\,0.98,\\,-0.05,\\,0.05,\\,-0.008,\\,0.008)$\n- 测试 $4$：$(1.05,\\,0.1,\\,-0.3,\\,0.94,\\,0.90,\\,0.98,\\,-0.2,\\,0.2,\\,-0.008,\\,0.008)$\n- 测试 $5$：$(0.8,\\,0.3,\\,-0.5,\\,0.95,\\,0.90,\\,0.99,\\,-0.04,\\,0.04,\\,-0.005,\\,0.012)$\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果必须是饱和度偏差单位（小数）下的双元素列表 $[x_\\mathrm{L}, x_\\mathrm{U}]$，或者如果指定条件下不存在终端集，则为空列表。例如，一个有效的输出格式类似于 $\\texttt{[[xL1,xU1],[],[xL3,xU3],...]}$，其中所有数值条目均为小数。",
            "solution": "该问题要求设计一个算法，为一个受有界扰动以及状态和控制输入双重约束的标量离散时间线性系统计算终端集。终端集 $\\mathcal{X}_\\mathrm{T}$ 必须是一个满足所有指定约束的鲁棒正不变（RPI）集。\n\n系统动力学由以下线性差分方程给出：\n$$\nx_{k+1} = a\\,x_k + b\\,u_k + w_k\n$$\n其中 $x_k \\in \\mathbb{R}$ 是状态偏差，$u_k \\in [u_{\\min}, u_{\\max}]$ 是控制输入偏差，$w_k \\in [w_{\\min}, w_{\\max}]$ 是有界扰动。应用了线性状态反馈控制律 $u_k = K\\,x_k$。\n\n首先，我们通过将控制律代入系统方程来建立闭环动力学：\n$$\nx_{k+1} = a\\,x_k + b(K\\,x_k) + w_k = (a + bK)x_k + w_k\n$$\n我们定义闭环系统矩阵为 $A_{cl} = a + bK$。系统变为：\n$$\nx_{k+1} = A_{cl}\\,x_k + w_k\n$$\n\n问题要求找到最小的对称鲁棒正不变（RPI）区间，并验证其是否可作为终端集。一个集合 $\\mathcal{X}$ 是 RPI 的，如果对于任何状态 $x_k \\in \\mathcal{X}$ 和任何可能的扰动 $w_k \\in [w_{\\min}, w_{\\max}]$，后续状态 $x_{k+1}$ 都保证保持在 $\\mathcal{X}$ 内。形式上，$A_{cl}\\mathcal{X} \\oplus \\mathcal{W} \\subseteq \\mathcal{X}$，其中 $\\mathcal{W} = [w_{\\min}, w_{\\max}]$，$\\oplus$ 表示闵可夫斯基和（Minkowski sum）。\n\n我们寻求一个形式为 $\\mathcal{X} = [-\\alpha, \\alpha]$（对于某个 $\\alpha \\ge 0$）的对称 RPI 区间。\n从 $x_k \\in [-\\alpha, \\alpha]$ 出发，所有可能的下一状态构成的集合是以下区间：\n$$\nA_{cl}\\,[-\\alpha, \\alpha] \\oplus [w_{\\min}, w_{\\max}]\n$$\n第一项计算为 $A_{cl}\\,[-\\alpha, \\alpha] = [-|A_{cl}|\\alpha, |A_{cl}|\\alpha]$。那么闵可夫斯基和为：\n$$\n[-|A_{cl}|\\alpha + w_{\\min}, |A_{cl}|\\alpha + w_{\\max}]\n$$\n为使此区间成为 $[-\\alpha, \\alpha]$ 的子集，必须满足两个条件：\n1. $-\\alpha \\le -|A_{cl}|\\alpha + w_{\\min} \\implies \\alpha - |A_{cl}|\\alpha \\ge -w_{\\min} \\implies \\alpha(1 - |A_{cl}|) \\ge -w_{\\min}$\n2. $|A_{cl}|\\alpha + w_{\\max} \\le \\alpha \\implies \\alpha - |A_{cl}|\\alpha \\ge w_{\\max} \\implies \\alpha(1 - |A_{cl}|) \\ge w_{\\max}$\n\n为了同时满足这两个不等式，$\\alpha$ 必须满足更严格的那个：\n$$\n\\alpha(1 - |A_{cl}|) \\ge \\max(-w_{\\min}, w_{\\max})\n$$\n仅当 $(1 - |A_{cl}|)$ 为严格正数时，才存在 $\\alpha \\ge 0$ 的有界解。这引出了对于一个带有持续扰动的系统存在有界 RPI 集的基本条件：闭环系统必须是 Schur 意义下的稳定，即 $|A_{cl}| < 1$。如果 $|A_{cl}| \\ge 1$，状态最终会被扰动驱离任何有界区间，因此不存在有界的 RPI 集。\n\n如果 $|A_{cl}| < 1$，我们可以除以正量 $(1 - |A_{cl}|)$ 来找到对 $\\alpha$ 的条件：\n$$\n\\alpha \\ge \\frac{\\max(-w_{\\min}, w_{\\max})}{1 - |A_{cl}|}\n$$\n问题要求的是*最小*的此类对称 RPI 集。这对应于最小的有效 $\\alpha$，我们将其表示为 $\\alpha_{\\min}$：\n$$\n\\alpha_{\\min} = \\frac{\\max(-w_{\\min}, w_{\\max})}{1 - |a+bK|}\n$$\n因此，最小的对称 RPI 区间为 $\\mathcal{X}_{\\mathrm{RPI}} = [-\\alpha_{\\min}, \\alpha_{\\min}]$。\n\n这个区间 $\\mathcal{X}_{\\mathrm{RPI}}$ 是终端集 $\\mathcal{X}_\\mathrm{T}$ 的一个候选。要成为一个有效的终端集，它必须满足两个额外的约束：\n\n1.  **状态约束满足**：该集合必须包含在状态偏差的安全区间 $[x_{\\min}, x_{\\max}]$ 内，其中 $x_{\\min} = S_{\\min} - S_{\\mathrm{ref}}$ 且 $x_{\\max} = S_{\\max} - S_{\\mathrm{ref}}$。\n    $$\n    \\mathcal{X}_{\\mathrm{RPI}} \\subseteq [x_{\\min}, x_{\\max}] \\iff -\\alpha_{\\min} \\ge x_{\\min} \\text{ and } \\alpha_{\\min} \\le x_{\\max}\n    $$\n\n2.  **输入约束满足**：对于任何状态 $x \\in \\mathcal{X}_{\\mathrm{RPI}}$，相应的控制输入 $u = Kx$ 必须在其允许范围 $[u_{\\min}, u_{\\max}]$ 内。从 $\\mathcal{X}_{\\mathrm{RPI}}$ 生成的输入集合是 $K \\cdot [-\\alpha_{\\min}, \\alpha_{\\min}] = [-|K|\\alpha_{\\min}, |K|\\alpha_{\\min}]$。\n    $$\n    [-|K|\\alpha_{\\min}, |K|\\alpha_{\\min}] \\subseteq [u_{\\min}, u_{\\max}] \\iff -|K|\\alpha_{\\min} \\ge u_{\\min} \\text{ and } |K|\\alpha_{\\min} \\le u_{\\max}\n    $$\n\n如果 $\\mathcal{X}_{\\mathrm{RPI}}$ 满足这两个条件，它就是一个有效的终端集 $\\mathcal{X}_{\\mathrm{T}} = \\mathcal{X}_{\\mathrm{RPI}}$。否则，对于给定的参数，不存在满足问题标准的终端集，结果为空集。\n\n完整的算法如下：\n1.  计算闭环参数 $A_{cl} = a + bK$。\n2.  检查稳定性：如果 $|A_{cl}| \\ge 1$，则声明不存在合适的终端集。\n3.  如果系统稳定，计算最小对称 RPI 集候选的大小：$\\alpha_{\\min} = \\frac{\\max(-w_{\\min}, w_{\\max})}{1 - |A_{cl}|}$。\n4.  计算状态偏差限制：$x_{\\min} = S_{\\min} - S_{\\mathrm{ref}}$ 和 $x_{\\max} = S_{\\max} - S_{\\mathrm{ref}}$。\n5.  验证状态约束：检查是否 $\\alpha_{\\min} \\le x_{\\max}$ 且 $-\\alpha_{\\min} \\ge x_{\\min}$。如果不满足，则不存在合适的终端集。\n6.  验证输入约束：检查是否 $|K|\\alpha_{\\min} \\le u_{\\max}$ 且 $-|K|\\alpha_{\\min} \\ge u_{\\min}$。如果不满足，则不存在合适的终端集。\n7.  如果所有检查都通过，则终端集为 $[-\\alpha_{\\min}, \\alpha_{\\min}]$。否则，它为空集。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the terminal set for a scalar linear system based on invariant set theory.\n    \"\"\"\n    # Test suite with parameters (a, b, K, S_ref, S_min, S_max, u_min, u_max, w_min, w_max)\n    test_cases = [\n        (0.9, 0.2, -0.5, 0.94, 0.90, 0.98, -0.2, 0.2, -0.008, 0.008),\n        (0.9, 0.2, -0.5, 0.94, 0.90, 0.98, -0.2, 0.2, -0.015, 0.015),\n        (0.9, 0.2, -1.2, 0.94, 0.90, 0.98, -0.05, 0.05, -0.008, 0.008),\n        (1.05, 0.1, -0.3, 0.94, 0.90, 0.98, -0.2, 0.2, -0.008, 0.008),\n        (0.8, 0.3, -0.5, 0.95, 0.90, 0.99, -0.04, 0.04, -0.005, 0.012),\n    ]\n\n    results = []\n    for params in test_cases:\n        a, b, K, S_ref, S_min, S_max, u_min, u_max, w_min, w_max = params\n\n        # 1. Calculate closed-loop parameter\n        A_cl = a + b * K\n\n        # 2. Check for stability for existence of a bounded RPI set\n        if abs(A_cl) >= 1:\n            results.append([])\n            continue\n\n        # 3. Calculate size of the smallest symmetric RPI set candidate\n        # The derivation alpha(1-|A_cl|) >= max(-w_min, w_max) is used.\n        w_bound = max(-w_min, w_max)\n        alpha_min = w_bound / (1 - abs(A_cl))\n\n        # 4. Calculate state deviation limits\n        x_min = S_min - S_ref\n        x_max = S_max - S_ref\n        \n        # 5. Verify state constraints\n        if not (-alpha_min >= x_min and alpha_min <= x_max):\n            results.append([])\n            continue\n\n        # 6. Verify input constraints\n        # The set of inputs is [-|K|*alpha_min, |K|*alpha_min]\n        input_magnitude = abs(K) * alpha_min\n        if not (-input_magnitude >= u_min and input_magnitude <= u_max):\n            results.append([])\n            continue\n            \n        # 7. If all checks pass, the terminal set is valid\n        terminal_set = [-alpha_min, alpha_min]\n        results.append(terminal_set)\n\n    # Final print statement in the exact required format.\n    # The default str() representation of a list is \"[item1, item2, ...]\"\n    # which matches the desired format for both success and failure cases.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}