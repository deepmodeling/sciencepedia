{
    "hands_on_practices": [
        {
            "introduction": "鲁棒性的一个基本方面是系统在内部参数发生微小、连续波动时维持稳定输出的能力。该实践将指导您使用线性化方法来量化这种对参数噪声的鲁棒性。您将通过推导和应用一个核心公式，学习如何通过系统的雅可比矩阵将参数的方差与输出的方差联系起来，从而为鲁棒性提供一个具体的量化指标。",
            "id": "3909340",
            "problem": "考虑一个从参数向量 $p \\in \\mathbb{R}^{3}$ 到输出向量 $y \\in \\mathbb{R}^{2}$ 的可微映射，记为 $y = f(p)$，它代表了一个双读出生物医学信号模块的归一化稳态输出。设 $p^{\\star}$ 是通过校准实验获得的标称参数工作点，并设小的参数波动被建模为零均值多元正态分布 (MVN) $p = p^{\\star} + \\delta p$，其协方差矩阵为 $\\Sigma_{p} \\in \\mathbb{R}^{3 \\times 3}$。假设映射 $f$ 在 $p^{\\star}$ 的邻域内足够平滑，使得一阶泰勒线性化有效，并将 $p^{\\star}$ 处的雅可比矩阵记为 $J = \\left.\\frac{\\partial f}{\\partial p}\\right|_{p^{\\star}} \\in \\mathbb{R}^{2 \\times 3}$。\n\n从第一性原理（泰勒线性化和协方差的定义）出发，推导输出协方差矩阵 $\\Sigma_{y}$ 关于 $J$ 和 $\\Sigma_{p}$ 的表达式。然后，对于特定情况\n$$\nJ = \\begin{pmatrix}\n0.5  -0.3  0.0 \\\\\n0.1  0.2  0.4\n\\end{pmatrix},\n\\qquad\n\\Sigma_{p} = \\begin{pmatrix}\n0.04  0.012  0.0 \\\\\n0.012  0.09  -0.006 \\\\\n0.0  -0.006  0.01\n\\end{pmatrix},\n$$\n计算输出协方差矩阵 $\\Sigma_{y}$，并使用它通过标量度量 $R = \\operatorname{tr}(\\Sigma_{y})$ 来量化对参数噪声的鲁棒性，该度量是在线性化模型下输出偏差的期望平方大小。\n\n报告 $R$ 的数值，四舍五入到四位有效数字。由于输出是归一化的，将 $R$ 视为无量纲量，不要附加单位。你的最终答案必须是一个实数。",
            "solution": "问题陈述经评估是有效的。它在科学上基于非线性系统的灵敏度分析和误差传播原理。该问题是适定的，为得到唯一解提供了所有必要的数据和定义。给定的数值是一致且合理的，因为所提供的协方差矩阵 $\\Sigma_p$ 是对称正定的。该问题是客观且无歧义的。\n\n求解过程分为两部分。首先，我们在线性近似下推导输出协方差矩阵 $\\Sigma_y$ 的通用表达式。其次，我们将此公式应用于提供的特定矩阵，以计算鲁棒性度量 $R$。\n\n### 第一部分：输出协方差矩阵的推导\n\n给定一个可微映射 $y = f(p)$，其中 $p \\in \\mathbb{R}^{3}$ 是参数向量，$y \\in \\mathbb{R}^{2}$ 是输出向量。参数根据 $p = p^{\\star} + \\delta p$ 在一个标称工作点 $p^{\\star}$ 周围波动。波动 $\\delta p$ 被建模为具有协方差矩阵 $\\Sigma_{p}$ 的零均值多元正态分布。因此，我们有以下统计特性：\n$$E[\\delta p] = 0$$\n$$\\text{Cov}(\\delta p) = E[(\\delta p - E[\\delta p])(\\delta p - E[\\delta p])^{T}] = E[\\delta p (\\delta p)^{T}] = \\Sigma_{p}$$\n\n输出 $y$ 将在其标称值 $y^{\\star} = f(p^{\\star})$ 周围波动。我们可以使用 $f(p)$ 在 $p^{\\star}$ 周围的一阶泰勒级数展开来近似输出波动 $\\delta y = y - y^{\\star}$：\n$$y = f(p) = f(p^{\\star} + \\delta p) \\approx f(p^{\\star}) + \\left.\\frac{\\partial f}{\\partial p}\\right|_{p^{\\star}} \\delta p$$\n设 $J = \\left.\\frac{\\partial f}{\\partial p}\\right|_{p^{\\star}}$ 为在标称点处求值的映射的雅可比矩阵。近似变为：\n$$y \\approx y^{\\star} + J \\delta p$$\n这意味着输出与标称值的偏差与参数偏差近似成线性关系：\n$$\\delta y = y - y^{\\star} \\approx J \\delta p$$\n我们现在推导输出向量 $y$ 的协方差矩阵，记为 $\\Sigma_{y} = \\text{Cov}(y)$。$y$ 的期望值为：\n$$E[y] \\approx E[y^{\\star} + J \\delta p] = y^{\\star} + J E[\\delta p] = y^{\\star} + J \\cdot 0 = y^{\\star}$$\n利用这一点，协方差矩阵 $\\Sigma_{y}$ 可以计算如下：\n$$\\Sigma_{y} = E[(y - E[y])(y - E[y])^{T}]$$\n代入 $E[y]$ 的近似值和偏差 $y - E[y] \\approx J \\delta p$：\n$$\\Sigma_{y} \\approx E[(J \\delta p)(J \\delta p)^{T}]$$\n使用转置性质 $(AB)^{T} = B^{T}A^{T}$，我们有：\n$$\\Sigma_{y} \\approx E[J (\\delta p) (\\delta p)^{T} J^{T}]$$\n由于雅可比矩阵 $J$ 是一个常数矩阵（在不动点 $p^{\\star}$ 处求值），它可以从期望中提出：\n$$\\Sigma_{y} \\approx J E[\\delta p (\\delta p)^{T}] J^{T}$$\n我们识别出期望内的项即为参数的协方差矩阵，$\\Sigma_{p} = E[\\delta p (\\delta p)^{T}]$。\n因此，在此线性近似下，输出协方差矩阵的表达式为：\n$$\\Sigma_{y} = J \\Sigma_{p} J^{T}$$\n\n### 第二部分：鲁棒性度量 $R$ 的计算\n\n我们给出了雅可比矩阵和参数协方差的具体矩阵：\n$$J = \\begin{pmatrix} 0.5  -0.3  0.0 \\\\ 0.1  0.2  0.4 \\end{pmatrix}, \\qquad \\Sigma_{p} = \\begin{pmatrix} 0.04  0.012  0.0 \\\\ 0.012  0.09  -0.006 \\\\ 0.0  -0.006  0.01 \\end{pmatrix}$$\n$J$ 的转置矩阵为：\n$$J^{T} = \\begin{pmatrix} 0.5  0.1 \\\\ -0.3  0.2 \\\\ 0.0  0.4 \\end{pmatrix}$$\n首先，我们计算矩阵乘积 $J \\Sigma_{p}$：\n$$J \\Sigma_{p} = \\begin{pmatrix} 0.5  -0.3  0.0 \\\\ 0.1  0.2  0.4 \\end{pmatrix} \\begin{pmatrix} 0.04  0.012  0.0 \\\\ 0.012  0.09  -0.006 \\\\ 0.0  -0.006  0.01 \\end{pmatrix}$$\n$$J \\Sigma_{p} = \\begin{pmatrix} (0.5)(0.04) + (-0.3)(0.012) + (0.0)(0.0)  (0.5)(0.012) + (-0.3)(0.09) + (0.0)(-0.006)  (0.5)(0.0) + (-0.3)(-0.006) + (0.0)(0.01) \\\\ (0.1)(0.04) + (0.2)(0.012) + (0.4)(0.0)  (0.1)(0.012) + (0.2)(0.09) + (0.4)(-0.006)  (0.1)(0.0) + (0.2)(-0.006) + (0.4)(0.01) \\end{pmatrix}$$\n$$J \\Sigma_{p} = \\begin{pmatrix} 0.02 - 0.0036  0.006 - 0.027  0.0018 \\\\ 0.004 + 0.0024  0.0012 + 0.018 - 0.0024  -0.0012 + 0.004 \\end{pmatrix}$$\n$$J \\Sigma_{p} = \\begin{pmatrix} 0.0164  -0.021  0.0018 \\\\ 0.0064  0.0168  0.0028 \\end{pmatrix}$$\n接下来，我们计算 $\\Sigma_{y} = (J \\Sigma_{p}) J^{T}$：\n$$\\Sigma_{y} = \\begin{pmatrix} 0.0164  -0.021  0.0018 \\\\ 0.0064  0.0168  0.0028 \\end{pmatrix} \\begin{pmatrix} 0.5  0.1 \\\\ -0.3  0.2 \\\\ 0.0  0.4 \\end{pmatrix}$$\n$$\\Sigma_{y} = \\begin{pmatrix} (0.0164)(0.5) + (-0.021)(-0.3) + (0.0018)(0.0)  (0.0164)(0.1) + (-0.021)(0.2) + (0.0018)(0.4) \\\\ (0.0064)(0.5) + (0.0168)(-0.3) + (0.0028)(0.0)  (0.0064)(0.1) + (0.0168)(0.2) + (0.0028)(0.4) \\end{pmatrix}$$\n$$\\Sigma_{y} = \\begin{pmatrix} 0.0082 + 0.0063  0.00164 - 0.0042 + 0.00072 \\\\ 0.0032 - 0.00504  0.00064 + 0.00336 + 0.00112 \\end{pmatrix}$$\n$$\\Sigma_{y} = \\begin{pmatrix} 0.0145  -0.00184 \\\\ -0.00184  0.00512 \\end{pmatrix}$$\n鲁棒性度量 $R$ 定义为输出协方差矩阵的迹，$R = \\operatorname{tr}(\\Sigma_{y})$。迹是对角元素之和。\n$$R = 0.0145 + 0.00512 = 0.01962$$\n问题要求答案四舍五入到四位有效数字。数字 $0.01962$ 有四位有效数字（$1$、$9$、$6$、$2$）。下一位是隐含的零。因此，无需四舍五入。\n鲁棒性度量的值为 $0.01962$。该度量代表了输出偏差平方大小的期望值，$E[||\\delta y||^2]$，并作为总输出方差的度量。较小的 $R$ 值意味着对参数噪声具有更强的鲁棒性。",
            "answer": "$$\\boxed{0.01962}$$"
        },
        {
            "introduction": "除了参数扰动，网络的全局拓扑结构本身也是其鲁棒性的关键决定因素。本练习引入代数连通度（$\\lambda_{2}$）这一精密的鲁棒性度量，并挑战一个普遍的直觉，即平均度等简单指标足以评估网络的韧性。您将分析一个假想情景，其中节点移除和补偿性重连在保持平均度不变的情况下，反而因产生结构瓶颈而降低了网络的鲁棒性。",
            "id": "3909401",
            "problem": "在一个简化的细胞信号网络模型中，考虑一个无向、无权的相互作用网络，其鲁棒性通过代数连通度来评估，代数连通度定义为图拉普拉斯矩阵的第二小特征值 $\\lambda_{2}$。您将分析在保持平均度 $\\langle k \\rangle$ 不变的情况下，移除单个节点并进行补偿性重连如何仍然会降低 $\\lambda_{2}$，从而削弱鲁棒性。仅使用图拉普拉斯矩阵 $L = D - A$ 和代数连通度 $\\lambda_{2}$（作为 $L$ 的第二小特征值）的核心定义，以及简单正则图的公认谱特性。\n\n从以下初始图 $G_{0}$ 开始，它代表一个由6个蛋白质组成的循环相互作用基序，其节点集为 $\\{1,2,3,4,5,6\\}$，边集为 $\\{(1,2),(2,3),(3,4),(4,5),(5,6),(6,1)\\}$（一个6-循环图）。该图有 $|V| = 6$ 个节点， $|E| = 6$ 条边，平均度为 $\\langle k \\rangle = 2|E|/|V| = 2$。\n\n现在考虑对节点6进行靶向移除（例如，蛋白质敲除），这将删除边 $(5,6)$ 和 $(6,1)$，留下一个由节点 $\\{1,2,3,4,5\\}$ 和边 $\\{(1,2),(2,3),(3,4),(4,5)\\}$ 组成的路径。为了在剩余的5个节点上保持原始平均度 $\\langle k \\rangle = 2$，在节点2和4之间精确添加一个补偿性相互作用，从而得到一个在节点 $\\{1,2,3,4,5\\}$ 上，边集为 $\\{(1,2),(2,3),(3,4),(4,5),(2,4)\\}$ 的重连图 $H$。验证 $|E(H)| = 5$，因此在移除和重连后 $\\langle k \\rangle$ 保持为2。\n\n使用上述定义，不依赖任何未经证实的捷径，完成以下任务：\n- 从第一性原理出发或引用关于循环图的公认特征值事实，计算 $\\lambda_{2}(G_{0})$，并根据路径冗余度和鲁棒性解释其含义。\n- 显式构造重连图 $H$ 的拉普拉斯矩阵 $L_{H}$，并推导其谱以确定 $\\lambda_{2}(H)$，解释新拓扑结构如何在保持 $\\langle k \\rangle$ 不变的情况下造成瓶颈，从而降低代数连通度。\n- 判断在这种移除并重连的操作下，由 $\\lambda_{2}$ 代表的鲁棒性是否降低，并从独立备用路径（网络简并性）的可用性角度，从机理上证明您的结论。\n\n最终结果需提供 $\\lambda_{2}(H)$ 的封闭形式精确值。不需要数值近似，也不需要单位。最终答案必须是单一的精确表达式。",
            "solution": "问题要求分析在节点移除和补偿性重连操作下，由代数连通度 $\\lambda_{2}$ 衡量的网络鲁棒性。该过程将按要求分三部分进行验证和求解：分析初始图 $G_{0}$，分析重连图 $H$，以及进行总结性比较。\n\n首先，确认问题陈述的有效性。所有给定条件都定义清晰，概念在代数图论及其在系统生物学中的应用方面有科学依据，问题是适定的，具有唯一的可计算解。在保持平均度的同时可能改变鲁棒性的前提是网络科学中的一个关键概念。整个设定是自洽、一致的，并且需要非平凡的数学推理。因此，该问题是有效的。\n\n初始图 $G_{0}$ 是一个6-循环图，记为 $C_{6}$。它是一个包含 $|V|=6$ 个节点和 $|E|=6$ 条边的无向无权图。它是一个2-正则图，意味着每个节点的度 $k=2$。平均度为 $\\langle k \\rangle = \\frac{2|E|}{|V|} = \\frac{2 \\times 6}{6} = 2$。\n\n循环图 $C_{n}$ 的拉普拉斯矩阵的特征值由公认的公式给出：\n$$ \\lambda_{j} = 2 - 2\\cos\\left(\\frac{2\\pi j}{n}\\right), \\quad \\text{for } j = 0, 1, \\dots, n-1 $$\n对于 $G_{0} = C_{6}$，我们有 $n=6$。其特征值为：\n$\\lambda_{0} = 2 - 2\\cos(0) = 0$。\n$\\lambda_{1} = 2 - 2\\cos\\left(\\frac{2\\pi}{6}\\right) = 2 - 2\\cos\\left(\\frac{\\pi}{3}\\right) = 2 - 2\\left(\\frac{1}{2}\\right) = 1$。\n$\\lambda_{5} = 2 - 2\\cos\\left(\\frac{10\\pi}{6}\\right) = 2 - 2\\cos\\left(\\frac{5\\pi}{3}\\right) = 2 - 2\\left(\\frac{1}{2}\\right) = 1$。\n除了 $\\lambda_0$ 和（如果 $n$ 是偶数） $\\lambda_{n/2}$ 之外，特征值是双重简并的。第二小特征值是最小的非零特征值。因此，初始图的代数连通度为 $\\lambda_{2}(G_{0}) = 1$。\n$\\lambda_{2}(G_{0}) = 1$ 这个值反映了一个鲁棒的连接结构。在循环图中，任意两个节点之间都存在两条节点不相交的路径，这代表了高度的路径冗余或网络简并性。这种结构特性确保了任何单个节点或边的失效都不会使网络断开。\n\n接下来，我们分析重连图 $H$。从 $G_{0}$ 中移除节点6，删除边 $(5,6)$ 和 $(6,1)$。这留下了一个在节点 $\\{1,2,3,4,5\\}$ 上的路径图 $P_{5}$。添加一条新边 $(2,4)$ 以构成图 $H$。\n$H$ 的节点集为 $V(H) = \\{1,2,3,4,5\\}$，所以 $|V(H)| = 5$。\n$H$ 的边集为 $E(H) = \\{(1,2), (2,3), (3,4), (4,5), (2,4)\\}$，所以 $|E(H)| = 5$。\n$H$ 的平均度为 $\\langle k_{H} \\rangle = \\frac{2|E(H)|}{|V(H)|} = \\frac{2 \\times 5}{5} = 2$，按照规定保持不变。\n\n为了找到 $\\lambda_{2}(H)$，我们构造它的拉普拉斯矩阵 $L_{H} = D_{H} - A_{H}$。\n$H$ 中顶点的度分别为 $d(1)=1$, $d(2)=3$, $d(3)=2$, $d(4)=3$, $d(5)=1$。\n度矩阵 $D_{H}$ 和邻接矩阵 $A_{H}$ 分别为：\n$$ D_{H} = \\begin{pmatrix} 1  0  0  0  0 \\\\ 0  3  0  0  0 \\\\ 0  0  2  0  0 \\\\ 0  0  0  3  0 \\\\ 0  0  0  0  1 \\end{pmatrix}, \\quad A_{H} = \\begin{pmatrix} 0  1  0  0  0 \\\\ 1  0  1  1  0 \\\\ 0  1  0  1  0 \\\\ 0  1  1  0  1 \\\\ 0  0  0  1  0 \\end{pmatrix} $$\n拉普拉斯矩阵 $L_{H}$ 为：\n$$ L_{H} = D_{H} - A_{H} = \\begin{pmatrix} 1  -1  0  0  0 \\\\ -1  3  -1  -1  0 \\\\ 0  -1  2  -1  0 \\\\ 0  -1  -1  3  -1 \\\\ 0  0  0  -1  1 \\end{pmatrix} $$\n为了求 $L_{H}$ 的特征值，我们可以利用图的对称性。该图关于一个自同构是对称的，该自同构交换节点 $1 \\leftrightarrow 5$ 和 $2 \\leftrightarrow 4$，同时固定节点3。$L_{H}$ 的特征空间可以分解为对称子空间和反对称子空间。\n\n对于对称子空间，特征向量 $\\mathbf{v}$ 满足 $v_{1}=v_{5}$ 和 $v_{2}=v_{4}$。特征值问题简化为关于分量 $(v_1, v_2, v_3)$ 的一个 $3 \\times 3$ 系统，得到特征方程 $-\\lambda(\\lambda^2 - 5\\lambda + 5) = 0$。这产生了三个对称特征值：$\\lambda = 0$，以及 $\\lambda^2 - 5\\lambda + 5 = 0$ 的根，即 $\\lambda = \\frac{5 \\pm \\sqrt{25 - 20}}{2} = \\frac{5 \\pm \\sqrt{5}}{2}$。\n\n对于反对称子空间，特征向量 $\\mathbf{v}$ 满足 $v_{1}=-v_{5}$，$v_{2}=-v_{4}$，且 $v_{3}=0$。特征值问题简化为关于分量 $(v_1, v_2)$ 的一个 $2 \\times 2$ 系统，得到特征方程 $\\lambda^2 - 5\\lambda + 3 = 0$。这产生了两个反对称特征值：$\\lambda = \\frac{5 \\pm \\sqrt{25 - 12}}{2} = \\frac{5 \\pm \\sqrt{13}}{2}$。\n\n$L_{H}$ 的完整特征值集合（谱）是：\n$$ \\left\\{ 0, \\frac{5 - \\sqrt{5}}{2}, \\frac{5 + \\sqrt{5}}{2}, \\frac{5 - \\sqrt{13}}{2}, \\frac{5 + \\sqrt{13}}{2} \\right\\} $$\n我们必须确定第二小的特征值 $\\lambda_{2}(H)$。最小的是 $\\lambda_{1}=0$。其他的必须进行比较。\n我们知道 $3  \\sqrt{13}  4$ 且 $2  \\sqrt{5}  3$。\n$\\sqrt{13} > \\sqrt{5}$，所以 $-\\sqrt{13}  -\\sqrt{5}$，因此 $5 - \\sqrt{13}  5 - \\sqrt{5}$。\n这意味着 $\\frac{5 - \\sqrt{13}}{2}  \\frac{5 - \\sqrt{5}}{2}$。\n数值上，$\\sqrt{13} \\approx 3.606$ 且 $\\sqrt{5} \\approx 2.236$。\n$\\lambda \\approx \\frac{5 - 3.606}{2} \\approx 0.697$。\n$\\lambda \\approx \\frac{5 - 2.236}{2} \\approx 1.382$。\n排序后的特征值为 $0  \\frac{5 - \\sqrt{13}}{2}  \\frac{5 - \\sqrt{5}}{2}  \\dots$。\n因此，重连图 $H$ 的代数连通度为 $\\lambda_{2}(H) = \\frac{5 - \\sqrt{13}}{2}$。\n\n最后，我们比较 $G_{0}$ 和 $H$ 的鲁棒性。我们得到 $\\lambda_{2}(G_{0}) = 1$ 和 $\\lambda_{2}(H) = \\frac{5 - \\sqrt{13}}{2}$。\n为了检查鲁棒性是否降低，我们将 $\\lambda_{2}(H)$ 与 $1$ 进行比较：\n$$ \\frac{5 - \\sqrt{13}}{2}  1 \\iff 5 - \\sqrt{13}  2 \\iff 3  \\sqrt{13} \\iff 9  13 $$\n该不等式成立，所以 $\\lambda_{2}(H)  \\lambda_{2}(G_{0})$。尽管保持了平均度，但由代数连通度代表的鲁棒性降低了。\n\n机理上的解释在于网络拓扑的改变和简并性的丧失。初始图 $G_{0}$（一个循环图）的点连通度为2，意味着必须移除至少两个节点才能使其断开。它在任意两个节点之间提供了两条完全独立（节点不相交）的路径。这代表了简并性，即备用路径提供了功能冗余。移除节点6破坏了这种循环冗余。重连操作，即添加边 $(2,4)$，创建了一个局部三角形 $(2,3,4)$，但使得节点1和5成为连接到这个中心核心的度为1的“叶子”。现在 $H$ 的点连通度为1，因为移除节点2会使节点1断开，移除节点4会使节点5断开。图 $H$ 存在一个结构性瓶颈。尽管路径仍然存在，但它们不再是独立的；例如，所有从节点1到节点5的路径都必须经过由节点 $\\{2,4\\}$ 导出的子图。失去一条经过节点6的完全独立的路径，并没有被新的局部捷径所补偿，这导致了一个更脆弱的网络结构，这一点被 $\\lambda_{2}$ 值的降低定量地捕捉到了。\n\n要求的最终答案是 $\\lambda_{2}(H)$ 的精确值。",
            "answer": "$$\\boxed{\\frac{5 - \\sqrt{13}}{2}}$$"
        },
        {
            "introduction": "在鲁棒性的概念之上，简并性（degeneracy）描述了系统通过结构不同的组件或路径实现相同功能的能力。本练习将使用通量平衡分析（FBA）和词典序优化（lexicographic optimization）这一高等技术，来系统性地发掘代谢网络中的替代途径。通过完成此练习，您将学会如何利用计算方法识别并量化生物网络中隐藏的灵活性。",
            "id": "3909353",
            "problem": "考虑一个处于稳态的代谢网络的通量平衡分析（FBA）公式，其中通量向量表示为 $\\mathbf{v} \\in \\mathbb{R}^n$，化学计量矩阵表示为 $\\mathbf{S} \\in \\mathbb{R}^{m \\times n}$。稳态施加了约束 $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$。通量的边界由下界 $\\mathbf{l} \\in \\mathbb{R}^n$ 和上界 $\\mathbf{u} \\in \\mathbb{R}^n$ 给出，形成分量形式的箱式约束 $\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$。生物学目标由一个系数向量 $\\mathbf{c} \\in \\mathbb{R}^n$ 编码，标准的FBA目标是在满足约束条件的情况下最大化 $\\mathbf{c}^\\top \\mathbf{v}$。当多个不同的通量分布达到相同的最大生物量目标值时，替代最优解表明代谢功能存在简并性。为了从结构上探查简并性，可以使用字典序优化：首先最大化 $\\mathbf{c}^\\top \\mathbf{v}$ 以获得最大值 $z^\\star$，然后施加等式约束 $\\mathbf{c}^\\top \\mathbf{v} = z^\\star$，接着根据一个优先级顺序依次最小化 $\\mathbf{v}$ 的分量。当存在替代最优解时，此过程会选择出不同的路径集。\n\n实现一个程序，对下方的每个测试网络执行以下步骤：\n- 求解原始线性规划问题以在约束 $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$ 和 $\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$ 下最大化 $\\mathbf{c}^\\top \\mathbf{v}$，从而得到最优值 $z^\\star$ 和一个最优通量向量 $\\mathbf{v}^\\star$。\n- 对每个给定的字典序优先级序列（每个序列是反应索引的有序列表），执行顺序最小化，如下所示：从由 $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$、$\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$ 和 $\\mathbf{c}^\\top \\mathbf{v} = z^\\star$ 定义的可行集开始，最小化 $v_{i_1}$；然后施加等式 $v_{i_1} = v_{i_1}^{\\min}$ 并最小化 $v_{i_2}$；依此进行，直到序列中的所有索引都按顺序被最小化，每次都添加等式约束，将先前最小化的分量固定为其已达到的最小值。将该序列得到的最终通量向量表示为 $\\mathbf{v}^{\\mathrm{lex}}$。\n- 对于一个给定的序列，将其路径集定义为指定路径索引列表中，其在 $\\mathbf{v}^{\\mathrm{lex}}$ 中的通量超过阈值 $\\epsilon$ 的索引集合，其中 $\\epsilon$ 必须设置为 $\\epsilon = 10^{-9}$。\n- 对每个测试网络，收集所有给定优先级序列得到的路径集，去除重复项，并报告不同路径集的数量。全程使用从零开始的反应索引（即，第一个反应的索引为 $0$，第二个为 $1$，以此类推）。\n\n你必须以纯数学的方式使用线性规划来实现上述过程。所有计算都是无量纲的；不需要物理单位。不涉及角度。不需要百分比。\n\n测试套件：\n- 测试用例 $1$（两个平行转化）：\n  - 反应：$v_0$（吸收），$v_1$ 和 $v_2$（两个平行转化），$v_3$（生物量流出）。\n  - 代谢物：$m_1$、$m_2$。\n  - 化学计量矩阵 $\\mathbf{S} \\in \\mathbb{R}^{2 \\times 4}$：\n    $$\n    \\mathbf{S} = \\begin{bmatrix}\n    1  -1  -1  0 \\\\\n    0  1  1  -1\n    \\end{bmatrix}\n    $$\n  - 边界：$\\mathbf{l} = [0, 0, 0, 0]$，$\\mathbf{u} = [6, 100, 100, 100]$。\n  - 目标系数：$\\mathbf{c} = [0, 0, 0, 1]$。\n  - 字典序优先级序列：$[1, 2]$ 和 $[2, 1]$。\n  - 路径集支持集中要考虑的路径索引：$[1, 2]$。\n- 测试用例 $2$（三个平行转化）：\n  - 反应：$v_0$（吸收），$v_1$、$v_2$、$v_3$（三个平行转化），$v_4$（生物量流出）。\n  - 代谢物：$m_1$、$m_2$。\n  - 化学计量矩阵 $\\mathbf{S} \\in \\mathbb{R}^{2 \\times 5}$：\n    $$\n    \\mathbf{S} = \\begin{bmatrix}\n    1  -1  -1  -1  0 \\\\\n    0  1  1  1  -1\n    \\end{bmatrix}\n    $$\n  - 边界：$\\mathbf{l} = [0, 0, 0, 0, 0]$，$\\mathbf{u} = [9, 100, 100, 100, 100]$。\n  - 目标系数：$\\mathbf{c} = [0, 0, 0, 0, 1]$。\n  - 字典序优先级序列：$[1, 2, 3]$、$[2, 3, 1]$、$[3, 1, 2]$。\n  - 路径集支持集中要考虑的路径索引：$[1, 2, 3]$。\n- 测试用例 $3$（容量受限的分支）：\n  - 反应：$v_0$（吸收），$v_1$ 和 $v_2$（两个容量不对称的平行转化），$v_3$（生物量流出）。\n  - 代谢物：$m_1$、$m_2$。\n  - 化学计量矩阵 $\\mathbf{S} \\in \\mathbb{R}^{2 \\times 4}$：\n    $$\n    \\mathbf{S} = \\begin{bmatrix}\n    1  -1  -1  0 \\\\\n    0  1  1  -1\n    \\end{bmatrix}\n    $$\n  - 边界：$\\mathbf{l} = [0, 0, 0, 0]$，$\\mathbf{u} = [8, 5, 8, 100]$。\n  - 目标系数：$\\mathbf{c} = [0, 0, 0, 1]$。\n  - 字典序优先级序列：$[1, 2]$、$[2, 1]$。\n  - 路径集支持集中要考虑的路径索引：$[1, 2]$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含测试用例 $1$、测试用例 $2$ 和测试用例 $3$ 的不同路径集数量，形式为方括号内以逗号分隔的列表，例如 $[r_1,r_2,r_3]$，其中每个 $r_i$ 是一个整数。在确定一个通量分量是否在路径集中被视为活跃时，阈值必须设置为 $\\epsilon = 10^{-9}$。",
            "solution": "该问题是有效的。它在科学上基于通量平衡分析（FBA）和线性规划的既定原则，这些原则通常用于系统生物学中研究代谢网络。该问题是适定的，提供了所有必要的数据和清晰、无歧义的算法描述，可为每个测试用例导出唯一的解决方案。所有术语都得到了正式定义，并且在代谢建模的背景下，其前提在事实上是可靠的。\n\n该问题要求实现一个字典序优化过程，以探索代谢网络的简并解空间。在此背景下，简并性指的是存在多个不同的通量分布（$\\mathbf{v}$），它们能产生相同的最大生物学目标值（$z^\\star$）。字典序优化提供了一种系统性的方法，可以根据一个带优先级的目标列表，从这个替代最优解空间中选择一个唯一的通量分布。通过改变优先级顺序，我们可以发现网络可以使用的不同“策略”或路径，这些策略或路径表现为不同的活性反应集合。\n\n对每个测试用例，该解决方案通过四个主要步骤实现：\n\n**1. 针对生物学目标的原始线性规划（LP）**\n\n首先，我们求解标准的 FBA 问题，这是一个线性规划问题，旨在找到通过生物学目标函数（如生物量生产）的最大可能通量。该目标由向量 $\\mathbf{c} \\in \\mathbb{R}^n$ 表示。问题公式化为：\n\n$$\n\\begin{align*}\n\\text{maximize} \\quad  z = \\mathbf{c}^\\top \\mathbf{v} \\\\\n\\text{subject to} \\quad  \\mathbf{S}\\mathbf{v} = \\mathbf{0} \\\\\n \\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}\n\\end{align*}\n$$\n\n这里，$\\mathbf{v} \\in \\mathbb{R}^n$ 是反应通量向量，$\\mathbf{S} \\in \\mathbb{R}^{m \\times n}$ 是化学计量矩阵，$\\mathbf{l} \\in \\mathbb{R}^n$ 和 $\\mathbf{u} \\in \\mathbb{R}^n$ 分别是通量的下界和上界。约束 $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$ 强制执行稳态假设，即每个内部代谢物的产生和消耗是平衡的。\n\n这个最大化问题使用一个标准的 LP 求解器来解决。我们将最优目标值表示为 $z^\\star$。\n\n**2. 顺序字典序最小化**\n\n在确定 $z^\\star$ 之后，我们探索达到此最大值的通量向量空间。这通过向原问题添加一个新约束 $\\mathbf{c}^\\top \\mathbf{v} = z^\\star$ 来实现。此约束将可行解限制在与最大目标相对应的解多胞体的面上。\n\n对于每个给定的反应索引的字典序优先级序列，例如 $(i_1, i_2, \\dots, i_k)$，我们执行一系列顺序 LP。过程如下：\n\n对于 $j = 1, 2, \\dots, k$：\n- 我们求解一个 LP 以最小化优先级序列中第 $j$ 个反应的通量 $v_{i_j}$。此 LP 的可行集包括原始的稳态和边界约束、最优性约束 $\\mathbf{c}^\\top \\mathbf{v} = z^\\star$，以及来自序列中先前步骤的附加约束。具体来说，对于所有在前的索引 $p  j$，我们添加等式约束 $v_{i_p} = v_{i_p}^{\\min}$，其中 $v_{i_p}^{\\min}$ 是在步骤 $p$ 中找到的最小值。\n\n第 $j$ 步的公式为：\n\n$$\n\\begin{align*}\n\\text{minimize} \\quad  v_{i_j} \\\\\n\\text{subject to} \\quad  \\mathbf{S}\\mathbf{v} = \\mathbf{0} \\\\\n \\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u} \\\\\n \\mathbf{c}^\\top \\mathbf{v} = z^\\star \\\\\n v_{i_p} = v_{i_p}^{\\min} \\quad \\text{for } p = 1, \\dots, j-1\n\\end{align*}\n$$\n\n设此 LP 的最优值为 $v_{i_j}^{\\min}$。然后用这个值来固定通量 $v_{i_j}$，用于序列中所有后续的最小化。在遍历优先级序列中的所有索引后，得到的通量向量 $\\mathbf{v}^{\\mathrm{lex}}$ 就被唯一确定了。\n\n**3. 路径集识别**\n\n对于从一个优先级序列获得的每个最终向量 $\\mathbf{v}^{\\mathrm{lex}}$，我们识别其对应的“路径集”。问题将其定义为从一个指定的 `route_indices` 列表中选出的活性反应集合。如果该列表中一个反应 $j$ 的通量 $v_j^{\\mathrm{lex}}$ 超过一个小的正阈值 $\\epsilon$，则认为该反应是活性的。问题指定 $\\epsilon = 10^{-9}$。\n\n形式上，对于一个给定的 $\\mathbf{v}^{\\mathrm{lex}}$ 和一个 `route_indices` 集合 $I_{\\text{route}}$，得到的路径集 $R$ 是：\n$$\nR = \\{ j \\in I_{\\text{route}} \\mid v_j^{\\mathrm{lex}} > \\epsilon \\}\n$$\n\n**4. 计数不同路径集**\n\n对测试用例中提供的每个优先级序列重复整个过程（步骤 $2$ 和 $3$）。收集所有序列生成的路径集。该测试用例的最终结果是找到的唯一路径集的总数。这个数量化了通过改变最小化优先级可以选择的不同代谢操作模式的数量，从而提供了对网络结构简并性的洞察。\n\n该实现使用了 `scipy.optimize.linprog` 函数。初始的最大化通过最小化 $-\\mathbf{c}^\\top \\mathbf{v}$ 来执行。对于字典序部分，将最优性约束 $\\mathbf{c}^\\top \\mathbf{v} = z^\\star$ 添加到等式约束集中。变量 $v_{i_j} = v_{i_j}^{\\min}$ 的顺序固定是通过对序列中每个变量逐步收紧 `linprog` 函数的 `bounds` 参数来有效实现的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of FBA problems with lexicographic optimization\n    to count distinct metabolic route sets.\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"S\": np.array([[1.0, -1.0, -1.0, 0.0], [0.0, 1.0, 1.0, -1.0]]),\n            \"l\": np.array([0.0, 0.0, 0.0, 0.0]),\n            \"u\": np.array([6.0, 100.0, 100.0, 100.0]),\n            \"c\": np.array([0.0, 0.0, 0.0, 1.0]),\n            \"sequences\": [[1, 2], [2, 1]],\n            \"route_indices\": [1, 2],\n        },\n        {\n            \"S\": np.array([[1.0, -1.0, -1.0, -1.0, 0.0], [0.0, 1.0, 1.0, 1.0, -1.0]]),\n            \"l\": np.array([0.0, 0.0, 0.0, 0.0, 0.0]),\n            \"u\": np.array([9.0, 100.0, 100.0, 100.0, 100.0]),\n            \"c\": np.array([0.0, 0.0, 0.0, 0.0, 1.0]),\n            \"sequences\": [[1, 2, 3], [2, 3, 1], [3, 1, 2]],\n            \"route_indices\": [1, 2, 3],\n        },\n        {\n            \"S\": np.array([[1.0, -1.0, -1.0, 0.0], [0.0, 1.0, 1.0, -1.0]]),\n            \"l\": np.array([0.0, 0.0, 0.0, 0.0]),\n            \"u\": np.array([8.0, 5.0, 8.0, 100.0]),\n            \"c\": np.array([0.0, 0.0, 0.0, 1.0]),\n            \"sequences\": [[1, 2], [2, 1]],\n            \"route_indices\": [1, 2],\n        },\n    ]\n\n    epsilon = 1e-9\n    results = []\n\n    for case in test_cases:\n        S, l, u, c = case[\"S\"], case[\"l\"], case[\"u\"], case[\"c\"]\n        sequences = case[\"sequences\"]\n        route_indices = case[\"route_indices\"]\n        num_vars = S.shape[1]\n\n        # Step 1: Solve the primal FBA problem to find the optimal objective value z_star.\n        # We maximize c'v by minimizing -c'v.\n        initial_bounds = list(zip(l, u))\n        res_primal = linprog(\n            -c,\n            A_eq=S,\n            b_eq=np.zeros(S.shape[0]),\n            bounds=initial_bounds,\n            method='highs',\n        )\n\n        if not res_primal.success:\n            # According to the problem specification, all test cases are well-posed.\n            # This block is for robustness but should not be reached.\n            raise RuntimeError(\"Primal FBA optimization failed.\")\n        \n        # The optimal objective value z_star is the negative of the minimized value.\n        z_star = -res_primal.fun\n\n        # Step 2: Perform lexicographic optimization for each priority sequence.\n        distinct_route_sets = set()\n\n        # Add the objective constraint c'v = z_star to the equality constraints.\n        A_lex = np.vstack([S, c])\n        b_lex = np.hstack([np.zeros(S.shape[0]), z_star])\n\n        for seq in sequences:\n            # For each sequence, start with the original bounds.\n            current_bounds = list(zip(l, u))\n            v_lex = None\n\n            # Sequentially minimize fluxes according to the priority sequence.\n            for reaction_idx in seq:\n                # Define objective: minimize v[reaction_idx]\n                c_lex = np.zeros(num_vars)\n                c_lex[reaction_idx] = 1\n\n                # Solve the LP with the current set of fixed fluxes.\n                res_lex = linprog(\n                    c_lex,\n                    A_eq=A_lex,\n                    b_eq=b_lex,\n                    bounds=current_bounds,\n                    method='highs',\n                )\n\n                if not res_lex.success:\n                    raise RuntimeError(f\"Lexicographic minimization failed for index {reaction_idx}.\")\n                \n                # Get the minimum value for the current reaction flux.\n                v_min = res_lex.fun\n                \n                # Update the bounds for this reaction to 'fix' it to its minimized value\n                # for all subsequent optimization steps in this sequence.\n                # A small tolerance is subtracted/added to handle potential solver precision issues,\n                # ensuring the new bound is strictly a point.\n                current_bounds[reaction_idx] = (v_min, v_min)\n                \n                # The solution vector from the last LP call in the sequence is the final one.\n                v_lex = res_lex.x\n\n            if v_lex is None:\n                # This would only occur if a sequence is empty.\n                continue\n\n            # Step 3: Determine the route set for the final flux vector v_lex.\n            # A route set consists of indices from route_indices whose flux > epsilon.\n            # A frozenset is used as it is hashable and can be added to a set.\n            current_route_set = frozenset(\n                idx for idx in route_indices if v_lex[idx] > epsilon\n            )\n            distinct_route_sets.add(current_route_set)\n        \n        # Step 4: The result for this test case is the count of distinct route sets found.\n        results.append(len(distinct_route_sets))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}