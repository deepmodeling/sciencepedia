{
    "hands_on_practices": [
        {
            "introduction": "The first step in any systems-level analysis is to create a mathematical representation of the biological system. This exercise guides you through the fundamental process of translating a list of biochemical reactions into their corresponding stoichiometric matrix, $S$. By correctly applying the sign conventions for reactants and products, you will construct the matrix that governs the mass balance of the entire network, and then use the rank-nullity theorem to determine the number of independent steady-state flux distributions the network can support, providing a first glimpse into its operational flexibility .",
            "id": "3901613",
            "problem": "You are given a cytosolic subnetwork involving glycolytic and fermentative steps with explicit stoichiometric coefficients. The stoichiometric matrix $S$ maps reaction fluxes to metabolite accumulation rates according to the mass balance definition $\\frac{d\\boldsymbol{x}}{dt} = S \\boldsymbol{v}$, where $\\boldsymbol{x}$ is the vector of metabolite concentrations and $\\boldsymbol{v}$ is the vector of reaction fluxes. In a homogeneous, closed compartment with no exchange fluxes, steady state implies $\\frac{d\\boldsymbol{x}}{dt} = \\boldsymbol{0}$.\n\nUse the following metabolite ordering for the rows of $S$:\n- $\\mathrm{PEP}$ (phosphoenolpyruvate),\n- $\\mathrm{Pyruvate}$,\n- $\\mathrm{Lactate}$,\n- $\\mathrm{NAD}^{+}$ (oxidized nicotinamide adenine dinucleotide),\n- $\\mathrm{NADH}$ (reduced nicotinamide adenine dinucleotide),\n- $\\mathrm{ATP}$ (adenosine triphosphate),\n- $\\mathrm{ADP}$ (adenosine diphosphate),\n- $\\mathrm{Pi}$ (inorganic phosphate),\n- $\\mathrm{H}^{+}$ (hydrogen ion).\n\nThe reaction columns (in order $R_{1}$ through $R_{5}$) are defined by the following chemically plausible reactions, with stoichiometric coefficients as indicated. Use the sign convention that reactants carry negative stoichiometric entries and products carry positive stoichiometric entries.\n- $R_{1}$: $\\mathrm{PEP} + \\mathrm{ADP} \\to \\mathrm{Pyruvate} + \\mathrm{ATP}$.\n- $R_{2}$: $\\mathrm{Pyruvate} + \\mathrm{NADH} + \\mathrm{H}^{+} \\to \\mathrm{Lactate} + \\mathrm{NAD}^{+}$.\n- $R_{3}$: $\\mathrm{ATP} \\to \\mathrm{ADP} + \\mathrm{Pi} + \\mathrm{H}^{+}$ (water is abundant and not tracked).\n- $R_{4}$: $\\mathrm{ADP} + \\mathrm{Pi} + \\mathrm{H}^{+} \\to \\mathrm{ATP}$.\n- $R_{5}$: $\\mathrm{Lactate} + \\mathrm{NAD}^{+} \\to \\mathrm{Pyruvate} + \\mathrm{NADH} + \\mathrm{H}^{+}$.\n\nTasks:\n1. Assemble the stoichiometric matrix $S$ by listing the metabolite ordering as above for the rows and filling each column $R_{j}$ with the corresponding signed stoichiometric coefficients based on the reaction definitions.\n2. For each column, verify the sign convention by explicitly checking that all reactants have negative entries and all products have positive entries.\n3. Using the mass balance definition and steady-state assumption for a closed system, determine the number of independent degrees of freedom in the reaction flux vector consistent with this network. Report this number as a single integer. No rounding is necessary, and no units are required in the final answer.",
            "solution": "The problem requires the determination of the number of independent degrees of freedom in a metabolic network at steady state. This quantity is equivalent to the dimension of the null space of the stoichiometric matrix $S$. The analysis proceeds in two main steps: first, the construction of the matrix $S$ from the provided reaction definitions, and second, the calculation of the dimension of its null space.\n\nThe system is described by the mass balance equation $\\frac{d\\boldsymbol{x}}{dt} = S \\boldsymbol{v}$, where $\\boldsymbol{x}$ is the vector of metabolite concentrations and $\\boldsymbol{v}$ is the vector of reaction fluxes. At steady state, the concentrations of metabolites are constant, so $\\frac{d\\boldsymbol{x}}{dt} = \\boldsymbol{0}$. This leads to the system of linear equations $S \\boldsymbol{v} = \\boldsymbol{0}$. The number of independent degrees of freedom in the flux vector $\\boldsymbol{v}$ is the number of linearly independent vectors $\\boldsymbol{v}$ that satisfy this equation, which is precisely the dimension of the null space of $S$, denoted as $\\text{dim}(\\text{Null}(S))$.\n\n**Step 1: Assembling the Stoichiometric Matrix $S$**\n\nThe matrix $S$ has dimensions $m \\times n$, where $m=9$ is the number of metabolites and $n=5$ is the number of reactions. The rows correspond to the metabolites in the specified order: $\\mathrm{PEP}$, $\\mathrm{Pyruvate}$, $\\mathrm{Lactate}$, $\\mathrm{NAD}^{+}$, $\\mathrm{NADH}$, $\\mathrm{ATP}$, $\\mathrm{ADP}$, $\\mathrm{Pi}$, $\\mathrm{H}^{+}$. The columns correspond to the reactions $R_1$ through $R_5$. The entries of the matrix are the stoichiometric coefficients, with reactants assigned negative signs and products assigned positive signs.\n\nReaction $R_1$: $\\mathrm{PEP} + \\mathrm{ADP} \\to \\mathrm{Pyruvate} + \\mathrm{ATP}$\nThe column vector for $R_1$ is constructed by assigning a coefficient of $-1$ to the reactants ($\\mathrm{PEP}$, $\\mathrm{ADP}$) and $+1$ to the products ($\\mathrm{Pyruvate}$, $\\mathrm{ATP}$). All other metabolite coefficients are $0$.\n$$ \\boldsymbol{s}_1 = \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 1 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\n\nReaction $R_2$: $\\mathrm{Pyruvate} + \\mathrm{NADH} + \\mathrm{H}^{+} \\to \\mathrm{Lactate} + \\mathrm{NAD}^{+}$\nThe reactants ($\\mathrm{Pyruvate}$, $\\mathrm{NADH}$, $\\mathrm{H}^{+}$) receive a coefficient of $-1$, and the products ($\\mathrm{Lactate}$, $\\mathrm{NAD}^{+}$) receive a coefficient of $+1$.\n$$ \\boldsymbol{s}_2 = \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\\\ 1 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ -1 \\end{pmatrix} $$\n\nReaction $R_3$: $\\mathrm{ATP} \\to \\mathrm{ADP} + \\mathrm{Pi} + \\mathrm{H}^{+}$\nThe reactant ($\\mathrm{ATP}$) gets a coefficient of $-1$, and the products ($\\mathrm{ADP}$, $\\mathrm{Pi}$, $\\mathrm{H}^{+}$) get a coefficient of $+1$.\n$$ \\boldsymbol{s}_3 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ -1 \\\\ 1 \\\\ 1 \\\\ 1 \\end{pmatrix} $$\n\nReaction $R_4$: $\\mathrm{ADP} + \\mathrm{Pi} + \\mathrm{H}^{+} \\to \\mathrm{ATP}$\nThis is the reverse reaction of $R_3$. The reactants ($\\mathrm{ADP}$, $\\mathrm{Pi}$, $\\mathrm{H}^{+}$) get a coefficient of $-1$, and the product ($\\mathrm{ATP}$) gets a coefficient of $+1$.\n$$ \\boldsymbols}_4 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 1 \\\\ -1 \\\\ -1 \\\\ -1 \\end{pmatrix} $$\n\nReaction $R_5$: $\\mathrm{Lactate} + \\mathrm{NAD}^{+} \\to \\mathrm{Pyruvate} + \\mathrm{NADH} + \\mathrm{H}^{+}$\nThe reactants ($\\mathrm{Lactate}$, $\\mathrm{NAD}^{+}$) get a coefficient of $-1$, and the products ($\\mathrm{Pyruvate}$, $\\mathrm{NADH}$, $\\mathrm{H}^{+}$) get a coefficient of $+1$.\n$$ \\boldsymbol{s}_5 = \\begin{pmatrix} 0 \\\\ 1 \\\\ -1 \\\\ -1 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix} $$\n\nCombining these column vectors, the complete stoichiometric matrix $S$ is:\n$$ S = \\begin{pmatrix} -1  0  0  0  0 \\\\ 1  -1  0  0  1 \\\\ 0  1  0  0  -1 \\\\ 0  1  0  0  -1 \\\\ 0  -1  0  0  1 \\\\ 1  0  -1  1  0 \\\\ -1  0  1  -1  0 \\\\ 0  0  1  -1  0 \\\\ 0  -1  1  -1  1 \\end{pmatrix} $$\nThe sign convention has been verified for each column during its construction.\n\n**Step 2: Determining the Degrees of Freedom**\n\nThe number of degrees of freedom is $\\text{dim}(\\text{Null}(S))$. According to the rank-nullity theorem, for a matrix $S$ with $n$ columns, we have:\n$$ \\text{dim}(\\text{Null}(S)) + \\text{rank}(S) = n $$\nHere, $n=5$ (the number of reactions). Therefore, the number of degrees of freedom is $5 - \\text{rank}(S)$. We must determine the rank of $S$, which is the number of linearly independent columns.\n\nLet's inspect the columns of $S$ for linear dependencies.\nComparing columns $\\boldsymbol{s}_3$ and $\\boldsymbol{s}_4$:\n$$ \\boldsymbol{s}_3 + \\boldsymbol{s}_4 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ -1 \\\\ 1 \\\\ 1 \\\\ 1 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 1 \\\\ -1 \\\\ -1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\nThus, $\\boldsymbol{s}_3 + \\boldsymbol{s}_4 = \\boldsymbol{0}$, which means they are linearly dependent. Reaction $R_4$ is the exact reverse of $R_3$.\n\nComparing columns $\\boldsymbol{s}_2$ and $\\boldsymbol{s}_5$:\n$$ \\boldsymbol{s}_2 + \\boldsymbol{s}_5 = \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\\\ 1 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ -1 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 1 \\\\ -1 \\\\ -1 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\nThus, $\\boldsymbol{s}_2 + \\boldsymbol{s}_5 = \\boldsymbol{0}$, indicating another linear dependency. Reaction $R_5$ is stoichiometrically the reverse of $R_2$.\n\nDue to these two dependencies, the set of five column vectors $\\{\\boldsymbol{s}_1, \\boldsymbol{s}_2, \\boldsymbol{s}_3, \\boldsymbol{s}_4, \\boldsymbol{s}_5\\}$ spans the same space as the set $\\{\\boldsymbol{s}_1, \\boldsymbol{s}_2, \\boldsymbol{s}_3\\}$. The rank of $S$ is the number of linearly independent vectors in this smaller set. To check for their independence, we solve the equation $c_1 \\boldsymbol{s}_1 + c_2 \\boldsymbol{s}_2 + c_3 \\boldsymbol{s}_3 = \\boldsymbol{0}$ for scalars $c_1, c_2, c_3$.\n\nWriting this out in matrix form:\n$$ \\begin{pmatrix} -1  0  0 \\\\ 1  -1  0 \\\\ 0  1  0 \\\\ 0  1  0 \\\\ 0  -1  0 \\\\ 1  0  -1 \\\\ -1  0  1 \\\\ 0  0  1 \\\\ 0  -1  1 \\end{pmatrix} \\begin{pmatrix} c_1 \\\\ c_2 \\\\ c_3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\nFrom the first row (corresponding to $\\mathrm{PEP}$), we get $-1 \\cdot c_1 + 0 \\cdot c_2 + 0 \\cdot c_3 = 0$, which implies $c_1 = 0$.\nSubstituting $c_1 = 0$ into the system, the second row (for $\\mathrm{Pyruvate}$) gives $0 - 1 \\cdot c_2 + 0 \\cdot c_3 = 0$, which implies $c_2 = 0$.\nSubstituting $c_1=0$ and $c_2=0$ into the system, the eighth row (for $\\mathrm{Pi}$) gives $0 \\cdot c_1 + 0 \\cdot c_2 + 1 \\cdot c_3 = 0$, which implies $c_3 = 0$.\n\nSince the only solution is $c_1 = c_2 = c_3 = 0$, the vectors $\\boldsymbol{s}_1, \\boldsymbol{s}_2, \\boldsymbol{s}_3$ are linearly independent. Therefore, the rank of the matrix $S$ is $3$.\n$$ \\text{rank}(S) = 3 $$\n\nNow, using the rank-nullity theorem, we can find the dimension of the null space:\n$$ \\text{dim}(\\text{Null}(S)) = n - \\text{rank}(S) = 5 - 3 = 2 $$\nThe number of independent degrees of freedom in the reaction flux vector is $2$. This corresponds to two independent pathways, or cycles, that can carry a net flux at steady state. In this case, they correspond to the reversible reaction pairs $(R_2, R_5)$ and $(R_3, R_4)$.",
            "answer": "$$\n\\boxed{2}\n$$"
        },
        {
            "introduction": "The steady-state condition $S v = 0$ defines the space of all possible flux distributions that a metabolic network can maintain. This practice challenges you to find a non-trivial solution within this space, subject to thermodynamic constraints of irreversibility. Solving for such a flux vector reveals a tangible metabolic pathway, and this exercise introduces the concept of an Elementary Flux Mode (EFM)—a minimal, non-decomposable pathway that represents a fundamental functional state of the cell .",
            "id": "3901625",
            "problem": "Consider a minimal internal metabolic network consisting solely of three intracellular metabolites $X_1$, $X_2$, and $X_3$, connected by three irreversible reactions $R_1$, $R_2$, and $R_3$ with the following stoichiometries:\n- $R_1$: $3 X_1 \\rightarrow 2 X_2$,\n- $R_2$: $X_2 \\rightarrow 3 X_3$,\n- $R_3$: $2 X_3 \\rightarrow X_1$.\n\nAssume a steady-state intracellular balance with no exchange to the environment (all fluxes are internal), and irreversibility in the forward directions of the reactions. The stoichiometric matrix $S \\in \\mathbb{R}^{3 \\times 3}$ is ordered by rows $(X_1, X_2, X_3)$ and columns $(R_1, R_2, R_3)$, with entries defined by the standard sign convention (negative for consumption, positive for production):\n$$\nS \\;=\\;\n\\begin{pmatrix}\n-3  0  1 \\\\\n2  -1  0 \\\\\n0  3  -2\n\\end{pmatrix}.\n$$\nLet the flux vector be $v = (v_1, v_2, v_3)^{\\top}$, where each $v_i$ represents the reaction rate of $R_i$ in millimoles per gram dry weight per hour (mmol per grams dry weight per hour, mmol/(gDW\\cdot h)). At steady state, intracellular mass conservation imposes the balance $S v = 0$, and irreversibility imposes $v_i \\geq 0$ for $i \\in \\{1,2,3\\}$.\n\nStarting from the principle of intracellular mass conservation at steady state and the definition of the stoichiometric matrix, compute a nontrivial flux vector $v$ that satisfies $S v = 0$ and $v_i \\geq 0$. Report the primitive positive integer flux vector, defined as the forward-irreversible nullspace vector scaled to the smallest positive integers. Express your final fluxes in mmol/(gDW\\cdot h). No rounding is required for this problem. Finally, interpret the resulting internal pathway in terms of conserved steady-state metabolite balances and the qualitative structure of the internal route realized by this flux pattern, referencing the concept of an Elementary Flux Mode (EFM) on first use.",
            "solution": "The problem requires finding a non-trivial, non-negative flux vector $v = (v_1, v_2, v_3)^\\top$ that represents a steady state for the given metabolic network. A steady state is defined by the mass balance equation $S v = 0$. The irreversibility of the reactions imposes the additional constraint that all flux values must be non-negative, i.e., $v_i \\ge 0$ for all $i$.\n\n**Step 1: Set up the system of linear equations**\n\nThe matrix equation $S v = 0$ is given by:\n$$\n\\begin{pmatrix}\n-3  0  1 \\\\\n2  -1  0 \\\\\n0  3  -2\n\\end{pmatrix}\n\\begin{pmatrix}\nv_1 \\\\\nv_2 \\\\\nv_3\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\\n0 \\\\\n0\n\\end{pmatrix}\n$$\nThis expands into a system of three linear equations:\n1.  $-3v_1 + v_3 = 0$\n2.  $2v_1 - v_2 = 0$\n3.  $3v_2 - 2v_3 = 0$\n\n**Step 2: Solve the system of equations**\n\nFrom equation (1), we can express $v_3$ in terms of $v_1$:\n$$ v_3 = 3v_1 $$\nFrom equation (2), we can express $v_2$ in terms of $v_1$:\n$$ v_2 = 2v_1 $$\nWe can substitute these expressions into equation (3) to verify consistency:\n$$ 3(2v_1) - 2(3v_1) = 6v_1 - 6v_1 = 0 $$\nThe equations are consistent. The entire solution space can be described in terms of a single free parameter, $v_1$. The flux vector is:\n$$ v = \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix} = \\begin{pmatrix} v_1 \\\\ 2v_1 \\\\ 3v_1 \\end{pmatrix} = v_1 \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} $$\n\n**Step 3: Apply constraints and find the primitive integer vector**\n\nThe irreversibility constraint requires $v_i \\ge 0$. This means $v_1 \\ge 0$, $2v_1 \\ge 0$, and $3v_1 \\ge 0$, all of which are satisfied if $v_1 \\ge 0$. To obtain a non-trivial solution ($v \\neq 0$), we need $v_1  0$.\nThe problem asks for the primitive positive integer flux vector, which is the solution scaled to the smallest possible positive integers. By setting the free parameter $v_1 = 1$, we obtain the vector:\n$$ v = \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} \\text{ mmol/(gDW}\\cdot\\text{h)} $$\n\n**Interpretation: An Elementary Flux Mode (EFM)**\n\nThe resulting flux vector $v = (1, 2, 3)^\\top$ describes a functional pathway where reactions $R_1$, $R_2$, and $R_3$ operate at a fixed ratio of $1:2:3$. This pathway is an example of an **Elementary Flux Mode (EFM)**, which is a minimal, non-decomposable set of reactions that can operate at steady state. It's 'minimal' because removing any of its constituent reactions (i.e., setting any $v_i$ to zero) would force all other fluxes in the mode to be zero to maintain the steady state.\n\nQualitatively, this EFM represents a closed internal cycle: $X_1$ is converted to $X_2$, which is converted to $X_3$, which is then converted back to $X_1$. For every mole of $X_1$ that enters the cycle, one mole is regenerated, with no net consumption or production of any metabolite. The explicit mass balance for each metabolite is:\n- **$X_1$**: Rate of change = $-3v_1 + 1v_3 = -3(1) + 3 = 0$.\n- **$X_2$**: Rate of change = $2v_1 - 1v_2 = 2(1) - 2 = 0$.\n- **$X_3$**: Rate of change = $3v_2 - 2v_3 = 3(2) - 2(3) = 0$.\nThis confirms that the flux distribution maintains a perfect balance for all metabolites, as required for a steady state.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While the null space of $S$ describes the flow of matter, the left null space reveals what is conserved. This computational practice focuses on identifying these conserved moieties—such as the total pool of adenylates like ATP, ADP, and AMP—by finding a basis for the vector space satisfying $S^T y = 0$. Each basis vector $y$ corresponds to a conservation law. You will implement an algorithm using exact rational arithmetic to compute these laws from first principles, a powerful technique for model simplification, validation, and understanding systemic invariants .",
            "id": "3901582",
            "problem": "Consider a closed biochemical reaction network modeled by a stoichiometric matrix $S \\in \\mathbb{Z}^{m \\times n}$ whose entries count the net molecular change of each metabolite per reaction event. Let $x(t) \\in \\mathbb{R}^{m}$ denote metabolite amounts and $v(t) \\in \\mathbb{R}^{n}$ denote reaction rates. The dynamic model is given by the fundamental mass-balance relation $d x / d t = S v$. A conserved moiety pool is an invariant linear combination of metabolite amounts characterized by a coefficient vector $y \\in \\mathbb{R}^{m}$ such that the scalar quantity $y^{T} x(t)$ is constant for all admissible $v(t)$ under the network dynamics. From first principles, the definition of invariance requires $d / d t (y^{T} x) = y^{T} S v = 0$ for all $v$, which holds if and only if $S^{T} y = 0$. Therefore, moiety conservation laws are exactly the vectors in the kernel of $S^{T}$, denoted $\\ker(S^{T})$.\n\nYour task is to design and implement a program that, given several integer stoichiometric matrices $S$, computes a canonical basis for the vector space $\\ker(S^{T})$, interprets each basis vector’s components as moiety pool composition coefficients, and returns these as minimal integer coefficient lists for each test case. The computation must proceed from the fundamental linear-algebraic definition of the kernel by exact rational row-reduction (Gauss–Jordan elimination) on $S^{T}$, not by numerical approximation, so that integer-normalized pool compositions can be uniquely identified.\n\nRequirements:\n\n1. For each given $S$, construct $A = S^{T}$ and solve $A y = 0$ over the rationals by computing the Reduced Row Echelon Form (RREF) of $A$. Parametrize the solution by assigning unit values to each free variable and solving for the pivot variables, thereby obtaining a basis $\\{ y^{(1)}, \\dots, y^{(k)} \\}$ of $\\ker(S^{T})$ with rational entries.\n\n2. For each rational basis vector $y^{(i)}$, produce an integer-normalized composition vector by:\n   - Multiplying by the least common multiple of denominators to obtain integer entries.\n   - Dividing by the greatest common divisor of the absolute integer entries to obtain a minimal integer vector.\n   - Flipping the sign, if necessary, so that the first nonzero entry is positive, to fix a canonical orientation.\n   - Order the basis vectors lexicographically to provide a deterministic canonical basis representation for output.\n\n3. Interpret each integer vector’s components as moiety pool composition coefficients in metabolite order; that is, the $j$-th component gives the integer coefficient for metabolite $j$ in that pool. When $\\ker(S^{T})$ is the zero subspace, output an empty list.\n\n4. Test Suite. Use the following three scientifically realistic stoichiometric matrices representing closed subsystems:\n   - Happy path (adenylate conservation among Adenosine Triphosphate, Adenosine Diphosphate, Adenosine Monophosphate):\n     $$\n     S_{1} = \\begin{bmatrix}\n     -1  0  0 \\\\\n     1  -1  1 \\\\\n     0  1  -1\n     \\end{bmatrix}.\n     $$\n     This network interconverts adenylates without net loss of the adenylate moiety; the expected conserved pool has equal weights across the three metabolites.\n   - Boundary case (no conservation in the subsystem):\n     $$\n     S_{2} = \\begin{bmatrix}\n     -1  0 \\\\\n     1  -1\n     \\end{bmatrix}.\n     $$\n     This subsystem has full row rank and no nontrivial left-kernel, implying no nontrivial moiety conservation among the listed metabolites.\n   - Edge case (dead-end metabolite and a total pool conservation):\n     $$\n     S_{3} = \\begin{bmatrix}\n     -1 \\\\\n     1 \\\\\n     0\n     \\end{bmatrix}.\n     $$\n     Here, metabolite $3$ does not participate in any reaction, and the total amount of metabolites $1$ and $2$ is conserved under the single interconversion reaction.\n\n5. Final Output Format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each result is itself a list of integer vectors representing a canonical basis of $\\ker(S^{T})$ for the corresponding test case, in metabolite order. For example, the output should have the form\n   $$\n   [\\text{basis}_{S_{1}},\\text{basis}_{S_{2}},\\text{basis}_{S_{3}}],\n   $$\n   where each $\\text{basis}_{S_{i}}$ is a list of lists of integers. No physical units are involved, and angles are not applicable.\n\nThe program must be self-contained, require no input, and must strictly adhere to the specified final output format.",
            "solution": "The problem requires the computation of a canonical integer basis for the left null space of given stoichiometric matrices $S$. This space, denoted $\\ker(S^T)$, corresponds to the set of conserved moiety pools in a biochemical reaction network. A vector $y \\in \\mathbb{R}^m$ represents a conserved moiety if the total quantity $y^T x(t)$ is constant over time, where $x(t) \\in \\mathbb{R}^m$ is the vector of metabolite concentrations. This invariance condition, $\\frac{d}{dt}(y^T x) = 0$, translates to the linear-algebraic condition $y^T S = 0$, or equivalently, $S^T y = 0$. Our task is to find all linearly independent vectors $y$ that satisfy this condition and represent them in a canonical integer form.\n\nThe solution proceeds through a sequence of discrete, formal steps: (1) solving the system of homogeneous linear equations $S^T y = 0$ using exact rational arithmetic, (2) extracting a basis for the solution space (the kernel), and (3) normalizing this basis to a canonical integer representation.\n\n**1. Theoretical Foundation: Solving $A y = 0$**\n\nFor each given stoichiometric matrix $S \\in \\mathbb{Z}^{m \\times n}$, we define the matrix $A = S^T \\in \\mathbb{Z}^{n \\times m}$. The problem is now to find the null space (kernel) of $A$, i.e., all vectors $y \\in \\mathbb{R}^m$ such that $A y = 0$. The standard and definitive method for this, which avoids numerical instabilities and provides exact solutions, is Gauss-Jordan elimination. By transforming $A$ into its Reduced Row Echelon Form (RREF), we obtain an equivalent, but simpler, system of linear equations from which the basis of the null space can be directly read.\n\nThe problem's insistence on exact rational arithmetic is crucial. Floating-point arithmetic would introduce approximation errors, making it impossible to uniquely recover the minimal integer coefficients that define a moiety pool. Therefore, all calculations must be performed over the field of rational numbers, $\\mathbb{Q}$.\n\n**2. Algorithmic Design**\n\nThe overall algorithm is as follows:\n\n**Step A: Computation of the Reduced Row Echelon Form (RREF)**\nGiven the matrix $A = S^T$, we compute its RREF using Gauss-Jordan elimination. The matrix elements are treated as rational numbers to ensure precision. The algorithm proceeds by iterating through columns, identifying a pivot element in each, and using row operations to create a leading $1$ in the pivot position and $0$s elsewhere in the pivot's column.\n1.  Initialize the pivot row index, $p_{row}$, to $0$. Iterate through each column $j$ from $0$ to $m-1$.\n2.  Find a non-zero entry in column $j$ at or below row $p_{row}$. If one exists at row $i$, swap rows $i$ and $p_{row}$.\n3.  If no such non-zero entry exists, column $j$ is a free column; continue to the next column.\n4.  Normalize the new pivot row (row $p_{row}$) by dividing it by the value of the pivot element, making the pivot a $1$.\n5.  Eliminate all other non-zero entries in column $j$ by subtracting suitable multiples of the pivot row from other rows.\n6.  Increment $p_{row}$. If $p_{row}$ reaches the total number of rows, the algorithm terminates.\n\n**Step B: Extraction of the Kernel Basis**\nThe RREF of $A$ allows for the parameterization of the solution space.\n1.  Identify the pivot columns (those containing a leading $1$ for some row) and the free columns (all other columns). The dimension of $\\ker(A)$ is equal to the number of free columns.\n2.  If there are no free columns, the kernel is the trivial subspace $\\{0\\}$, and its basis is the empty set.\n3.  For each free column $j$, construct a basis vector $y^{(j)}$. Initialize it as a zero vector of size $m$. Set its $j$-th component to $1$. The components of $y^{(j)}$ corresponding to other free columns are set to $0$.\n4.  The values for the pivot variable components are determined by the entries in the RREF matrix. For each pivot row $i$ with a pivot in column $p_i$, the $p_i$-th component of the basis vector $y^{(j)}$ is given by the negative of the entry in the RREF at position $(i, j)$.\n\nThis process generates a set of linearly independent vectors that span $\\ker(A)$.\n\n**Step C: Canonical Integer Normalization**\nEach rational basis vector must be converted to a unique, canonical integer representation. For each rational vector $y^{(i)}$:\n1.  **Clear Denominators**: Find the least common multiple (LCM) of the denominators of all its components. Multiply the entire vector by this LCM to obtain a vector with integer entries.\n2.  **Find Minimal Integers**: Compute the greatest common divisor (GCD) of the absolute values of all non-zero integer components. Divide the vector by this GCD.\n3.  **Fix Orientation**: Check the first non-zero element of the resulting vector. If it is negative, multiply the entire vector by $-1$. This ensures a canonical sign.\n\n**Step D: Final Basis Assembly**\nThe resulting list of normalized integer basis vectors is then sorted lexicographically. This ensures that the final output is deterministic and canonical for any given input matrix $S$.\n\n**3. Application to Test Cases**\n\nLet's apply this procedure to the provided matrices.\n\n**Case 1: $S_1$**\n$S_1 = \\begin{bmatrix} -1  0  0 \\\\ 1  -1  1 \\\\ 0  1  -1 \\end{bmatrix}$. We form $A = S_1^T = \\begin{bmatrix} -1  1  0 \\\\ 0  -1  1 \\\\ 0  1  -1 \\end{bmatrix}$.\nThe RREF of $A$ is $\\begin{bmatrix} 1  0  -1 \\\\ 0  1  -1 \\\\ 0  0  0 \\end{bmatrix}$.\nThe system of equations is $y_1 - y_3 = 0$ and $y_2 - y_3 = 0$.\nThe pivot variables are $y_1$ and $y_2$; the free variable is $y_3$.\nSetting the free variable $y_3 = 1$ yields $y_1 = 1$ and $y_2 = 1$.\nThe single basis vector is $y^{(1)} = (1, 1, 1)^T$. This vector is already in minimal, positive integer form. The canonical basis is $\\{[1, 1, 1]\\}$. This corresponds to the conservation of the total adenylate pool: $[ATP] + [ADP] + [AMP] = \\text{constant}$.\n\n**Case 2: $S_2$**\n$S_2 = \\begin{bmatrix} -1  0 \\\\ 1  -1 \\end{bmatrix}$. We form $A = S_2^T = \\begin{bmatrix} -1  1 \\\\ 0  -1 \\end{bmatrix}$.\nThe RREF of $A$ is the identity matrix $I_2 = \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix}$.\nThe system of equations is $y_1 = 0$ and $y_2 = 0$.\nThere are no free variables. The only solution is the trivial solution $y = (0, 0)^T$.\nThe kernel is $\\{0\\}$, so its basis is the empty set.\n\n**Case 3: $S_3$**\n$S_3 = \\begin{bmatrix} -1 \\\\ 1 \\\\ 0 \\end{bmatrix}$. We form $A = S_3^T = \\begin{bmatrix} -1  1  0 \\end{bmatrix}$.\nThe RREF of $A$ is $\\begin{bmatrix} 1  -1  0 \\end{bmatrix}$.\nThe system of equations is $y_1 - y_2 = 0$.\nThe pivot variable is $y_1$; the free variables are $y_2$ and $y_3$. The kernel dimension is $2$.\n1.  Let $y_2=1, y_3=0$. Then $y_1 = y_2 = 1$. The basis vector is $y^{(1)} = (1, 1, 0)^T$.\n2.  Let $y_2=0, y_3=1$. Then $y_1 = y_2 = 0$. The basis vector is $y^{(2)} = (0, 0, 1)^T$.\nBoth vectors, $[1, 1, 0]$ and $[0, 0, 1]$, are already in canonical integer form.\nSorting them lexicographically, $[0, 0, 1]$ precedes $[1, 1, 0]$.\nThe canonical basis is $\\{[0, 0, 1], [1, 1, 0]\\}$. These correspond to the conservation of metabolite $M_3$ (which is not part of any reaction) and the conservation of the total pool of $M_1$ and $M_2$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom fractions import Fraction\nfrom math import gcd\nfrom functools import reduce\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the computation of canonical bases\n    for the left null spaces of the test case stoichiometric matrices.\n    \"\"\"\n\n    # Test cases defined in the problem statement.\n    test_cases = [\n        np.array([[-1, 0, 0], [1, -1, 1], [0, 1, -1]]),\n        np.array([[-1, 0], [1, -1]]),\n        np.array([[-1], [1], [0]])\n    ]\n\n    results = []\n    for s_matrix in test_cases:\n        basis = compute_canonical_basis(s_matrix)\n        results.append(basis)\n\n    # The final print statement must match the specified output format exactly.\n    # The standard string representation of Python lists includes spaces,\n    # which is consistent with the behavior of the template f-string.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_canonical_basis(s_matrix):\n    \"\"\"\n    Computes the canonical integer basis for the left null space (ker(S.T))\n    of a given stoichiometric matrix S.\n\n    Args:\n        s_matrix (np.ndarray): The integer stoichiometric matrix.\n\n    Returns:\n        list: A list of lists of integers representing the canonical basis.\n              An empty list if the kernel is trivial.\n    \"\"\"\n    if s_matrix.size == 0:\n        return []\n    \n    # 1. Construct A = S.T and convert to rational numbers.\n    a_matrix = s_matrix.T\n    rows, cols = a_matrix.shape\n    a_frac = np.array([[Fraction(x) for x in row] for row in a_matrix], dtype=object)\n\n    # 2. Compute the Reduced Row Echelon Form (RREF).\n    rref_matrix = rref(a_frac)\n\n    # 3. Extract a rational basis from the RREF.\n    rational_basis = extract_basis_from_rref(rref_matrix)\n\n    if not rational_basis:\n        return []\n\n    # 4. Normalize each basis vector to its canonical integer form.\n    integer_basis = [normalize_vector(vec) for vec in rational_basis]\n\n    # 5. Sort the basis vectors lexicographically for a canonical representation.\n    integer_basis.sort()\n\n    return integer_basis\n\ndef rref(matrix):\n    \"\"\"\n    Computes the Reduced Row Echelon Form of a matrix with rational entries.\n\n    Args:\n        matrix (np.ndarray): A 2D numpy array of Fraction objects.\n\n    Returns:\n        np.ndarray: The RREF of the input matrix.\n    \"\"\"\n    mat = matrix.copy()\n    rows, cols = mat.shape\n    pivot_row = 0\n    for j in range(cols): # Iterate through columns\n        if pivot_row = rows:\n            break\n        \n        # Find a row with a non-zero entry in the current column\n        i = pivot_row\n        while mat[i, j] == 0:\n            i += 1\n            if i == rows:\n                i = -1 # Sentinel for all-zero column below pivot\n                break\n        \n        if i != -1:\n            # Swap the found row with the pivot row\n            mat[[i, pivot_row]] = mat[[pivot_row, i]]\n            \n            # Normalize the pivot row\n            pivot_val = mat[pivot_row, j]\n            if pivot_val != 1:\n                mat[pivot_row, :] /= pivot_val\n            \n            # Eliminate other entries in the pivot column\n            for i_other in range(rows):\n                if i_other != pivot_row:\n                    factor = mat[i_other, j]\n                    mat[i_other, :] -= factor * mat[pivot_row, :]\n            \n            pivot_row += 1\n            \n    return mat\n\ndef extract_basis_from_rref(rref_matrix):\n    \"\"\"\n    Extracts a basis for the null space from a matrix in RREF.\n\n    Args:\n        rref_matrix (np.ndarray): A matrix in RREF with Fraction entries.\n\n    Returns:\n        list: A list of rational basis vectors (each a list of Fractions).\n    \"\"\"\n    rows, cols = rref_matrix.shape\n    pivot_cols = []\n    # Identify pivot columns\n    for r in range(rows):\n        for c in range(cols):\n            if rref_matrix[r, c] == 1:\n                pivot_cols.append(c)\n                break # Move to the next row\n\n    all_cols = set(range(cols))\n    free_cols = sorted(list(all_cols - set(pivot_cols)))\n\n    if not free_cols:\n        return []\n\n    basis = []\n    for free_col in free_cols:\n        vec = [Fraction(0)] * cols\n        vec[free_col] = Fraction(1)\n        \n        # Solve for pivot variables\n        for r, piv_col in enumerate(pivot_cols):\n             vec[piv_col] = -rref_matrix[r, free_col]\n\n        basis.append(vec)\n        \n    return basis\n\ndef normalize_vector(vec):\n    \"\"\"\n    Normalizes a rational vector to its canonical integer form.\n    - Clears denominators.\n    - Divides by GCD of absolute values.\n    - Ensures the first non-zero element is positive.\n\n    Args:\n        vec (list): A list of Fraction objects representing a vector.\n\n    Returns:\n        list: The canonical integer vector as a list of ints.\n    \"\"\"\n    # Helper for LCM of two numbers\n    def lcm(a, b):\n        if a == 0 or b == 0: return 0\n        return abs(a * b) // gcd(a, b) if a != 0 and b != 0 else 0\n\n    # 1. Clear denominators\n    denominators = [f.denominator for f in vec]\n    common_multiple = reduce(lcm, [d for d in denominators if d != 0], 1)\n    \n    int_vec = [int(f * common_multiple) for f in vec]\n    \n    # 2. Find minimal integers by dividing by GCD\n    abs_vals = [abs(x) for x in int_vec if x != 0]\n    if not abs_vals:\n        return [0] * len(vec)\n    \n    common_divisor = reduce(gcd, abs_vals)\n    minimal_vec = [x // common_divisor for x in int_vec]\n    \n    # 3. Fix orientation\n    first_nonzero_idx = next((i for i, x in enumerate(minimal_vec) if x != 0), -1)\n    if first_nonzero_idx != -1 and minimal_vec[first_nonzero_idx]  0:\n        minimal_vec = [-x for x in minimal_vec]\n        \n    return minimal_vec\n\n# Execute the solution process.\nsolve()\n```"
        }
    ]
}