{
    "hands_on_practices": [
        {
            "introduction": "所有药代动力学（PK）模型都从质量平衡这一基本原理出发。本练习旨在通过从零开始构建一个标准的单室模型，而非直接套用现成公式，来巩固您对这第一性原理的理解。这项实践将加深您对清除率（$CL$）和分布容积（$V$）等关键参数及其与系统动态关系的认识 ()。",
            "id": "3923515",
            "problem": "单剂量药物通过恒速静脉输注的方式给药至一个充分混合的生理房室中，该房室可恰当地建模为单室药代动力学系统。假设为线性（一级）消除和瞬时混合。设该房室的分布容积为$V$，全身清除率为$CL$，输注以恒定速率$R_0$（单位时间内的量）进行。输注持续足够长的时间，使得在时间$t=0$时系统达到稳态，之后输注被瞬时停止。\n\n仅使用质量平衡定律作为基本出发点，以及一级消除和浓度的定义，完成以下任务：\n\n1. 从质量平衡出发，写出在输注期间和输注停止后，房室中药物量$A(t)$的常微分方程（ODE）。使用$C(t)=A(t)/V$将每个ODE转换为关于浓度$C(t)$的方程。\n\n2. 求解在$t=0$时开始恒速输注且$C(0)=0$情况下的ODE，并利用你的解确定当$t \\to \\infty$时的稳态浓度。\n\n3. 利用$t=0$标志着达到稳态后输注停止的瞬间这一事实，求解输注停止后$t \\ge 0$时的浓度轨迹$C(t)$。\n\n将你的最终答案表示为输注停止后$t \\ge 0$时$C(t)$的单个闭式解析表达式，用$R_0$、$V$、$CL$和$t$表示。最终的方框表达式中不要包含单位。你可以假设所有参数都是正常数，且模型假设完全成立。最终答案必须是单个表达式，而不是分段定义。",
            "solution": "该问题要求从基本的质量平衡定律出发，推导并求解一个单室药代动力学模型。该过程将按要求分三个主要步骤进行：推导控制常微分方程（ODE），确定输注期间的稳态浓度，以及最后求解输注停止后的浓度曲线。\n\n**步骤1：推导控制常微分方程**\n\n在时间$t$时，房室中药物量$A(t)$的质量平衡定律表述为：\n$$\n\\frac{dA(t)}{dt} = \\text{药物输入速率} - \\text{药物消除速率}\n$$\n\n药物消除速率被规定为一级过程。这意味着消除速率与存在的药物量$A(t)$成正比。我们可以将其写为$\\text{消除速率} = k_e A(t)$，其中$k_e$是一级消除速率常数。\n\n问题提供了参数全身清除率，$CL$。清除率定义为单位时间内从药物中清除的生理液体体积。因此，消除速率也可以表示为清除率与药物浓度$C(t)$的乘积：\n$$\n\\text{消除速率} = CL \\cdot C(t)\n$$\n根据定义，浓度是单位分布容积$V$内的药物量：\n$$\nC(t) = \\frac{A(t)}{V} \\implies A(t) = V \\cdot C(t)\n$$\n将两个消除速率的表达式相等，可以得到$k_e$、$CL$和$V$之间的关系：\n$$\nk_e A(t) = CL \\cdot C(t)\n$$\n代入$A(t) = V \\cdot C(t)$：\n$$\nk_e (V \\cdot C(t)) = CL \\cdot C(t) \\implies k_e = \\frac{CL}{V}\n$$\n我们将使用这个已建立的关系。因此，消除速率为$\\frac{CL}{V} A(t)$。\n\n现在，我们可以为两个阶段写出药物量$A(t)$的ODE：\n\n1.  **恒速输注期间：**药物输入速率是一个常数$R_0$。质量平衡方程为：\n    $$\n    \\frac{dA(t)}{dt} = R_0 - \\frac{CL}{V} A(t)\n    $$\n2.  **输注停止后：**药物输入速率为$0$。质量平衡方程为：\n    $$\n    \\frac{dA(t)}{dt} = - \\frac{CL}{V} A(t)\n    $$\n\n接下来，我们将这些关于药物量$A(t)$的ODE转换为关于浓度$C(t)$的ODE。因为$A(t) = V \\cdot C(t)$且$V$是一个常数，我们有$\\frac{dA(t)}{dt} = V \\frac{dC(t)}{dt}$。\n\n1.  **输注期间：**代入第一个ODE：\n    $$\n    V \\frac{dC(t)}{dt} = R_0 - \\frac{CL}{V} (V \\cdot C(t))\n    $$\n    $$\n    V \\frac{dC(t)}{dt} = R_0 - CL \\cdot C(t)\n    $$\n    两边除以$V$：\n    $$\n    \\frac{dC(t)}{dt} = \\frac{R_0}{V} - \\frac{CL}{V} C(t)\n    $$\n2.  **输注停止后：**代入第二个ODE：\n    $$\n    V \\frac{dC(t)}{dt} = - \\frac{CL}{V} (V \\cdot C(t))\n    $$\n    $$\n    V \\frac{dC(t)}{dt} = - CL \\cdot C(t)\n    $$\n    两边除以$V$：\n    $$\n    \\frac{dC(t)}{dt} = - \\frac{CL}{V} C(t)\n    $$\n\n**步骤2：确定稳态浓度**\n\n为了找到稳态浓度$C_{ss}$，我们分析输注阶段的系统。当浓度不随时间变化时，即$\\frac{dC(t)}{dt} = 0$，达到稳态。将输注ODE中的导数设为零：\n$$\n0 = \\frac{R_0}{V} - \\frac{CL}{V} C_{ss}\n$$\n求解$C_{ss}$：\n$$\n\\frac{CL}{V} C_{ss} = \\frac{R_0}{V} \\implies C_{ss} = \\frac{R_0}{CL}\n$$\n或者，可以求解输注阶段的ODE，$\\frac{dC}{dt} + \\frac{CL}{V} C = \\frac{R_0}{V}$，初始条件为$C(0) = 0$。这个一阶线性ODE的解是$C(t) = \\frac{R_0}{CL} \\left(1 - \\exp\\left(-\\frac{CL}{V}t\\right)\\right)$。当$t \\to \\infty$时取极限，得到稳态浓度：\n$$\nC_{ss} = \\lim_{t \\to \\infty} \\left[ \\frac{R_0}{CL} \\left(1 - \\exp\\left(-\\frac{CL}{V}t\\right)\\right) \\right] = \\frac{R_0}{CL}(1 - 0) = \\frac{R_0}{CL}\n$$\n两种方法得出的稳态浓度结果相同。\n\n**步骤3：求解输注停止后的浓度**\n\n问题陈述在时间$t=0$时，输注停止，系统处于稳态。这为输注后阶段定义了初始条件。$t=0$时的浓度是上一步推导出的稳态浓度：\n$$\nC(0) = C_{ss} = \\frac{R_0}{CL}\n$$\n对于$t \\ge 0$，控制ODE是输注后阶段的方程：\n$$\n\\frac{dC(t)}{dt} = - \\frac{CL}{V} C(t)\n$$\n这是一个可分离的一阶ODE。我们可以将其写为：\n$$\n\\frac{dC}{C} = -\\frac{CL}{V} dt\n$$\n对两边进行积分，时间从初始时间$t=0$到后来的时间$t$，相应地，浓度从初始浓度$C(0)$到$C(t)$：\n$$\n\\int_{C(0)}^{C(t)} \\frac{1}{C'} dC' = \\int_{0}^{t} -\\frac{CL}{V} dt'\n$$\n$$\n[\\ln|C'|]_{C(0)}^{C(t)} = -\\frac{CL}{V} [t']_{0}^{t}\n$$\n$$\n\\ln(C(t)) - \\ln(C(0)) = -\\frac{CL}{V} t\n$$\n因为浓度必须为非负值，所以不需要绝对值。\n$$\n\\ln\\left(\\frac{C(t)}{C(0)}\\right) = -\\frac{CL}{V} t\n$$\n对两边取指数：\n$$\n\\frac{C(t)}{C(0)} = \\exp\\left(-\\frac{CL}{V} t\\right)\n$$\n$$\nC(t) = C(0) \\exp\\left(-\\frac{CL}{V} t\\right)\n$$\n代入初始条件$C(0) = \\frac{R_0}{CL}$：\n$$\nC(t) = \\frac{R_0}{CL} \\exp\\left(-\\frac{CL}{V} t\\right)\n$$\n这是输注停止后，$t \\ge 0$时药物浓度$C(t)$的最终闭式解析表达式，用给定的参数$R_0$、$V$、$CL$和时间$t$表示。",
            "answer": "$$\\boxed{\\frac{R_0}{CL} \\exp\\left(-\\frac{CL}{V} t\\right)}$$"
        },
        {
            "introduction": "定量系统药理学（QSP）的特点在于其模型整合了靶点结合等生物学机制，靶介导的药物处置（TMDD）模型是用于描述单克隆抗体等生物制剂的经典范例。本题引导您超越简单的药代动力学，分析药物-靶点相互作用的动态过程 ()。通过探究受体周转和结合动力学如何影响系统的响应时间与恢复，您将建立起解读复杂非线性生物系统行为的直觉。",
            "id": "3923490",
            "problem": "考虑一个定量系统药理学中的标准靶介导药物处置 (TMDD) 模型，用于描述单克隆抗体与细胞表面受体的结合。令 $R(t)$ 表示游离受体浓度，$C(t)$ 表示游离药物浓度，$RC(t)$ 表示受体-药物复合物浓度。受体以恒定的速率 $k_{\\text{syn}}$ 合成，并以恒定的速率 $k_{\\text{deg}}$ 降解。结合与解离遵循质量作用动力学，结合速率为 $k_{\\text{on}}$，解离速率为 $k_{\\text{off}}$。复合物内化的速率为 $k_{\\text{int}}$。忽略受体再循环以及除内化途径外的复合物中的药物消除。控制该过程的质量作用常微分方程组为\n$$\\frac{dR}{dt} \\;=\\; k_{\\text{syn}} \\;-\\; k_{\\text{deg}}\\,R \\;-\\; k_{\\text{on}}\\,C\\,R \\;+\\; k_{\\text{off}}\\,RC,$$\n$$\\frac{d(RC)}{dt} \\;=\\; k_{\\text{on}}\\,C\\,R \\;-\\; \\big(k_{\\text{off}} + k_{\\text{int}}\\big)\\,RC.$$\n在给药前，假设 $C(t)=0$ 且系统处于稳态，此时 $R(t)=R_{\\text{ss}}$ 且 $RC(t)=0$，其中 $R_{\\text{ss}}$ 由合成-降解平衡决定。在 $t=0$ 时，开始零级输注，从而在 $t>0$ 时建立并维持一个恒定的游离药物浓度 $C(t)=C_{0}$。将受体占有率定义为 $O(t)=\\dfrac{RC(t)}{R(t)+RC(t)}$。\n\n仅从这些基本动力学定义和上述方程组出发，解释受体周转率 $k_{\\text{syn}}$ 和 $k_{\\text{deg}}$ 如何影响在药物浓度阶跃至 $C_{0}$ 后，占有率 $O(t)$ 达到其最终值所需的特征时间。然后，假设在 $t=0$ 时停止输注，游离药物被迅速清除，使得在所有 $t>0$ 时 $C(t)\\approx 0$（药物洗脱）。使用该模型，计算对于降解速率 $k_{\\text{deg}} = 0.062\\ \\text{h}^{-1}$ 的受体，在洗脱后 $R(t)$ 恢复至 $R_{\\text{ss}}$ 的时间常数，以小时为单位。\n\n将最终数值答案四舍五入至四位有效数字。以小时为单位表示时间常数。",
            "solution": "该问题要求对一个标准的靶介导药物处置 (TMDD) 模型进行两部分独立的分析。首先，定性解释给药后，受体周转率如何影响系统趋近新稳态的过程。其次，定量计算药物洗脱后的恢复时间常数。\n\n控制游离受体浓度 $R(t)$、游离药物浓度 $C(t)$ 和受体-药物复合物浓度 $RC(t)$ 的常微分方程 (ODE) 组如下：\n$$\n\\frac{dR}{dt} \\;=\\; k_{\\text{syn}} \\;-\\; k_{\\text{deg}}\\,R \\;-\\; k_{\\text{on}}\\,C\\,R \\;+\\; k_{\\text{off}}\\,RC\n$$\n$$\n\\frac{d(RC)}{dt} \\;=\\; k_{\\text{on}}\\,C\\,R \\;-\\; \\big(k_{\\text{off}} + k_{\\text{int}}\\big)\\,RC\n$$\n给药前的稳态特征是 $C(t)=0$，这导致 $\\frac{dR}{dt} = k_{\\text{syn}} - k_{\\text{deg}}R = 0$，从而得到基线受体水平 $R_{ss} = \\frac{k_{\\text{syn}}}{k_{\\text{deg}}}$。在此状态下，$RC(t)=0$。\n\n**第1部分：$k_{\\text{syn}}$ 和 $k_{\\text{deg}}$ 对达到占有率稳态时间的影响。**\n\n当在 $t>0$ 时建立恒定的药物浓度 $C(t) = C_0$ 时，$R(t)$ 和 $RC(t)$ 的系统动力学变为一个由两个线性、一阶、非齐次常微分方程组成的方程组。我们可以将其写成矩阵形式。设状态向量为 $\\mathbf{x}(t) = \\begin{pmatrix} R(t) \\\\ RC(t) \\end{pmatrix}$。该系统可表示为 $\\frac{d\\mathbf{x}}{dt} = A\\mathbf{x} + \\mathbf{b}$，其中：\n$$\nA = \\begin{pmatrix} -(k_{\\text{deg}} + k_{\\text{on}}C_0) & k_{\\text{off}} \\\\ k_{\\text{on}}C_0 & -(k_{\\text{off}} + k_{\\text{int}}) \\end{pmatrix}, \\quad \\mathbf{b} = \\begin{pmatrix} k_{\\text{syn}} \\\\ 0 \\end{pmatrix}\n$$\n系统从其初始状态 $(R(0)=R_{ss}, RC(0)=0)$ 到新稳态的时间演化过程由矩阵 $A$ 的特征值决定。系统的特征时间是这些特征值的负倒数（假设它们是实数和负数，对于一个稳定的物理系统来说确实如此）。\n\n特征值 $\\lambda$ 是特征方程 $\\det(A - \\lambda I) = 0$ 的根：\n$$\n\\det\\begin{pmatrix} -(k_{\\text{deg}} + k_{\\text{on}}C_0) - \\lambda & k_{\\text{off}} \\\\ k_{\\text{on}}C_0 & -(k_{\\text{off}} + k_{\\text{int}}) - \\lambda \\end{pmatrix} = 0\n$$\n$$\n\\big(\\lambda + k_{\\text{deg}} + k_{\\text{on}}C_0\\big)\\big(\\lambda + k_{\\text{off}} + k_{\\text{int}}\\big) - k_{\\text{on}}C_0 k_{\\text{off}} = 0\n$$\n展开此式得到特征多项式：\n$$\n\\lambda^2 + \\big(k_{\\text{deg}} + k_{\\text{int}} + k_{\\text{on}}C_0 + k_{\\text{off}}\\big)\\lambda + \\big(k_{\\text{deg}}(k_{\\text{off}} + k_{\\text{int}}) + k_{\\text{on}}C_0 k_{\\text{int}}\\big) = 0\n$$\n决定系统趋近其新稳态速度（并因此决定占有率 $O(t) = \\frac{RC(t)}{R(t)+RC(t)}$ 趋近其新平衡值速度）的特征时间，取决于此多项式的系数。\n\n$k_{\\text{syn}}$ 的影响：受体合成速率 $k_{\\text{syn}}$ 未出现在特征多项式中。它是非齐次项 $\\mathbf{b}$ 的一部分。因此，$k_{\\text{syn}}$ 影响 $R$ 和 $RC$ 的最终稳态浓度，但不影响趋近该稳态过程的特征时间。\n\n$k_{\\text{deg}}$ 的影响：受体降解速率 $k_{\\text{deg}}$ 出现在特征多项式的一次项系数和常数项系数中。$k_{\\text{deg}}$ 的增加会导致这两个正系数都增加。对于一个具有正系数的二次方程 $\\lambda^2+b\\lambda+c=0$，增加 $b$ 和 $c$ 会使根（即特征值）变得更负（即它们的绝对值增大）。特征时间为 $\\tau_i = -1/\\lambda_i$。绝对值更大的特征值对应于更小（更短）的特征时间。因此，更大的 $k_{\\text{deg}}$ 会导致更快地达到新的稳态占有率。直观上，$k_{\\text{deg}}$ 代表受体的内在周转率。更快的周转（更高的 $k_{\\text{deg}}$）使得整个受体系统能够更快地适应由药物引起的扰动并重新达到平衡。\n\n**第2部分：药物洗脱后的恢复时间常数。**\n\n在此情景下，我们考虑在与药物达到稳态后，在 $t=0$ 时药物被洗脱，因此对于 $t>0$ 有 $C(t) \\approx 0$。控制方程组变为：\n$$\n\\frac{d(RC)}{dt} = - \\big(k_{\\text{off}} + k_{\\text{int}}\\big)RC\n$$\n$$\n\\frac{dR}{dt} = k_{\\text{syn}} - k_{\\text{deg}}\\,R + k_{\\text{off}}\\,RC\n$$\n我们来分析恢复过程。第一个方程是关于 $RC(t)$ 的一个简单的齐次一阶常微分方程。其解为：\n$$\nRC(t) = RC(0) \\exp\\left(-\\left(k_{\\text{off}} + k_{\\text{int}}\\right)t\\right)\n$$\n其中 $RC(0)$ 是洗脱时刻的复合物浓度。这表明复合物以时间常数 $\\tau_{RC} = \\frac{1}{k_{\\text{off}} + k_{\\text{int}}}$ 指数衰减。\n\n将此解代入 $R(t)$ 的方程中：\n$$\n\\frac{dR}{dt} + k_{\\text{deg}}\\,R = k_{\\text{syn}} + k_{\\text{off}}\\,RC(0) \\exp\\left(-\\left(k_{\\text{off}} + k_{\\text{int}}\\right)t\\right)\n$$\n这是一个线性一阶非齐次常微分方程。$R(t)$ 的解将是齐次解（以 $\\exp(-k_{\\text{deg}}t)$ 的形式衰减）和由强迫项驱动的特解（以 $\\exp(-(k_{\\text{off}} + k_{\\text{int}})t)$ 的形式衰减）之和。$R(t)$ 恢复到基线稳态 $R_{ss} = k_{\\text{syn}}/k_{\\text{deg}}$ 的完整解具有以下形式：\n$$\nR(t) = R_{ss} + A \\exp(-k_{\\text{deg}}t) + B \\exp(-(k_{\\text{off}} + k_{\\text{int}})t)\n$$\n其中 $A$ 和 $B$ 是取决于初始条件的常数。\n\n因此，$R(t)$ 的恢复是一个双指数过程，由两个时间常数表征：\n1. $\\tau_{turnover} = \\frac{1}{k_{\\text{deg}}}$，与受体的内在合成和降解有关。\n2. $\\tau_{binding} = \\frac{1}{k_{\\text{off}} + k_{\\text{int}}}$，与药物-受体复合物的解离和清除有关。\n\n问题要求的是恢复的“时间常数”，并且只提供了 $k_{\\text{deg}}$ 的值。这暗示时间尺度存在分离，这是药理学中的常见情况，即受体周转远慢于结合/解离和内化动力学。也就是说，$k_{\\text{deg}} \\ll k_{\\text{off}} + k_{\\text{int}}$，这意味着 $\\tau_{turnover} \\gg \\tau_{binding}$。\n\n在此假设下，恢复过程包括一个快速的初始阶段，其中复合物 $RC$ 消失（由 $\\tau_{binding}$ 决定），随后是一个慢得多的阶段，其中游离受体池 $R$ 被补充回其基线水平 $R_{ss}$（由 $\\tau_{turnover}$ 决定）。完全恢复的总体时间由这个较慢的、限速的步骤主导。因此，$R(t)$ 恢复的特征时间常数是 $\\tau_{turnover}$。\n\n现在我们可以计算这个时间常数。\n给定降解速率常数 $k_{\\text{deg}} = 0.062 \\text{ h}^{-1}$。\n时间常数 $\\tau$ 是速率常数的倒数：\n$$\n\\tau = \\frac{1}{k_{\\text{deg}}} = \\frac{1}{0.062 \\text{ h}^{-1}}\n$$\n$$\n\\tau = 16.129032... \\text{ h}\n$$\n四舍五入到四位有效数字，我们得到：\n$$\n\\tau \\approx 16.13 \\text{ h}\n$$",
            "answer": "$$\n\\boxed{16.13}\n$$"
        },
        {
            "introduction": "QSP模型的一个关键应用是为药物开发中的决策提供信息，例如设计高效且符合伦理的临床试验。最优实验设计运用数学原理，在一系列约束条件下最大化研究能获取的信息量。这个高级的动手编程题目 () 要求您运用统计理论（费雪信息）和优化技术来解决一个真实的设计问题。通过确定最佳的剂量水平和受试者分配方案以精确估计 $EC_{50}$ 这样的关键参数，您将实践QSP建模者最具影响力的技能之一。",
            "id": "4587389",
            "problem": "您将解决一个临床药理学中的定量系统药理学 (QSP) 设计问题。假设药效学响应遵循最大效应 (Emax) 模型，剂量 $d$ 下的确定性平均响应由函数 $E(d)$ 描述，并伴有加性高斯测量噪声。任务是设计一项剂量探索研究，在固定样本量和伦理暴露约束下，最大化关于半数有效浓度 ($EC_{50}$) 的信息量。该设计必须精确选择固定数量的剂量水平，并为每个水平分配受试者比例。零剂量的基线水平必须被包括在内。所有的数学推导、建模和计算都必须纯粹用数学和逻辑结构来表述。\n\n基本原理和假设：\n- 药效学平均响应遵循最大效应 (Emax) 模型：$E(d) = E_{0} + E_{\\max}\\,f(d)$，其中 $f(d)$ 是与 Emax 关系一致的、关于剂量 $d$ 的单调饱和函数。\n- 测量噪声在受试者间是加性且独立的，建模为具有恒定方差 $\\sigma^{2}$ 的高斯噪声（方差齐性）。\n- 在高斯噪声模型下，一个参数的 Fisher 信息量在独立观测之间是可加的，并由平均响应对该参数的敏感度决定。\n\n设计变量和约束条件：\n- 总共 $N$ 名受试者将被分配到 $K$ 个精确的剂量水平上，其中一个必须是 $d=0$（基线）。\n- 允许的剂量位于区间 $[d_{\\min}, d_{\\max}]$ 内，并且必须从一个步长为 $\\Delta d$ 的网格中选择。\n- 伦理约束：\n  1. 必须为基线水平（$n_{\\min,0}$）和每个活性剂量水平（$n_{\\min,a}$）分配一个最小受试者数量。换算成比例 $w_{i}$，这意味着 $w_{0} \\geq n_{\\min,0}/N$，并且对于每个活性剂量水平，$w_{i} \\geq n_{\\min,a}/N$。\n  2. 每位受试者的平均给药剂量不得超过一个上限 $d_{\\text{avg},\\max}$，即 $\\sum_{i} w_{i} d_{i} \\leq d_{\\text{avg},\\max}$。\n  3. 分配到高剂量（定义为剂量 $\\geq d_{\\text{high}}$）的受试者比例不得超过 $p_{\\text{high},\\max}$，即 $\\sum_{i:d_{i}\\geq d_{\\text{high}}} w_{i} \\leq p_{\\text{high},\\max}$。\n- 各比例满足 $\\sum_{i} w_{i} = 1$ 和 $w_{i} \\geq 0$。\n\n目标：\n- 根据上述基本原理，推导在 Emax 模型和高斯噪声假设下，关于 $EC_{50}$ 的 Fisher 信息量，作为剂量水平及其分配的函数。程序必须选择 $K$ 个剂量（包括 0）和分配比例，以在满足所述约束条件的前提下，最大化关于 $EC_{50}$ 的 Fisher 信息量。\n\n单位和输出要求：\n- 所有剂量单位必须以毫克 (mg) 表示。分配量必须以小数（比例）表示，而不是百分比。\n- 对于每个测试用例，您的程序必须输出所选的剂量水平（以毫克为单位）及其对应的分配比例（以小数表示）。剂量水平四舍五入到两位小数（单位 mg），分配比例四舍五入到四位小数。\n- 您的程序应生成单行输出，其中包含所有测试用例的结果。结果是一个用方括号括起来的逗号分隔列表，每个测试用例表示为一对列表：第一个列表包含所选剂量（单位 mg），第二个列表包含相应的分配比例。例如：$[[[d_{1},d_{2},\\dots],[w_{1},w_{2},\\dots]],\\dots]$。\n\n测试套件：\n请为以下三个测试用例提供解决方案。测试用例中所有对应物理单位的量都必须以毫克 (mg) 为单位，噪声以任意效应单位表示：\n\n1. 具有中等约束的常规路径设计：\n   - 总受试者数：$N=60$\n   - 剂量水平数：$K=3$\n   - 基线响应：$E_{0}=10$ (效应单位)\n   - 最大效应：$E_{\\max}=100$ (效应单位)\n   - 半数有效浓度：$EC_{50}=50$ mg\n   - 噪声标准差：$\\sigma=8$ (效应单位)\n   - 剂量范围：$d_{\\min}=0$ mg, $d_{\\max}=200$ mg\n   - 网格步长：$\\Delta d=10$ mg\n   - 平均剂量上限：$d_{\\text{avg},\\max}=80$ mg\n   - 高剂量阈值：$d_{\\text{high}}=150$ mg\n   - 高剂量比例上限：$p_{\\text{high},\\max}=0.25$\n   - 最小基线受试者数：$n_{\\min,0}=10$\n   - 最小活性剂量水平受试者数：$n_{\\min,a}=8$\n\n2. 具有严格高剂量上限的边界情况：\n   - 总受试者数：$N=48$\n   - 剂量水平数：$K=3$\n   - 基线响应：$E_{0}=12$ (效应单位)\n   - 最大效应：$E_{\\max}=120$ (效应单位)\n   - 半数有效浓度：$EC_{50}=80$ mg\n   - 噪声标准差：$\\sigma=12$ (效应单位)\n   - 剂量范围：$d_{\\min}=0$ mg, $d_{\\max}=300$ mg\n   - 网格步长：$\\Delta d=20$ mg\n   - 平均剂量上限：$d_{\\text{avg},\\max}=110$ mg\n   - 高剂量阈值：$d_{\\text{high}}=200$ mg\n   - 高剂量比例上限：$p_{\\text{high},\\max}=0.05$\n   - 最小基线受试者数：$n_{\\min,0}=8$\n   - 最小活性剂量水平受试者数：$n_{\\min,a}=8$\n\n3. 平均剂量限制极低的边缘情况：\n   - 总受试者数：$N=50$\n   - 剂量水平数：$K=3$\n   - 基线响应：$E_{0}=9$ (效应单位)\n   - 最大效应：$E_{\\max}=90$ (效应单位)\n   - 半数有效浓度：$EC_{50}=20$ mg\n   - 噪声标准差：$\\sigma=10$ (效应单位)\n   - 剂量范围：$d_{\\min}=0$ mg, $d_{\\max}=150$ mg\n   - 网格步长：$\\Delta d=10$ mg\n   - 平均剂量上限：$d_{\\text{avg},\\max}=30$ mg\n   - 高剂量阈值：$d_{\\text{high}}=120$ mg\n   - 高剂量比例上限：$p_{\\text{high},\\max}=0.20$\n   - 最小基线受试者数：$n_{\\min,0}=10$\n   - 最小活性剂量水平受试者数：$n_{\\min,a}=7$\n\n您的程序必须实现优化逻辑，为每个测试用例计算最优设计，并以精确格式打印单行输出：$[[[d_{1}^{(1)},d_{2}^{(1)},d_{3}^{(1)}],[w_{1}^{(1)},w_{2}^{(1)},w_{3}^{(1)}]],[[d_{1}^{(2)},d_{2}^{(2)},d_{3}^{(2)}],[w_{1}^{(2)},w_{2}^{(2)},w_{3}^{(2)}]],[[d_{1}^{(3)},d_{2}^{(3)},d_{3}^{(3)}],[w_{1}^{(3)},w_{2}^{(3)},w_{3}^{(3)}]]]$，其中上标表示测试用例索引。所有剂量必须以毫克 (mg) 为单位，四舍五入到两位小数，所有比例必须是以小数表示，四舍五入到四位小数。",
            "solution": "本任务要求寻找一个最优实验设计方案，以最大化关于参数 $EC_{50}$ 的信息量。这是一个经典的c-最优设计问题，并针对临床药理学的具体情况增加了约束条件。\n\n#### 1. 目标函数推导：Fisher 信息量\n\n受试者对剂量 $d$ 的响应是一个随机变量 $Y(d) \\sim \\mathcal{N}(E(d), \\sigma^2)$，其中平均响应 $E(d)$ 由 Emax 模型给出：\n$$ E(d) = E_{0} + \\frac{E_{\\max} \\cdot d}{EC_{50} + d} $$\n根据问题设定，$E_0$、$E_{\\max}$ 和 $\\sigma$ 被视为已知常数。我们希望为其最大化信息量的目标参数是 $\\theta = EC_{50}$。\n\n对于剂量 $d$ 下的单个观测，在高斯噪声模型下，关于参数 $\\theta$ 的 Fisher 信息量由以下公式给出：\n$$ I(\\theta | d) = \\frac{1}{\\sigma^2} \\left( \\frac{\\partial E(d; \\theta)}{\\partial \\theta} \\right)^2 $$\n我们首先计算平均响应 $E(d)$ 关于 $EC_{50}$ 的偏导数：\n$$ \\frac{\\partial E(d)}{\\partial EC_{50}} = \\frac{\\partial}{\\partial EC_{50}} \\left( E_0 + \\frac{E_{\\max} \\cdot d}{EC_{50} + d} \\right) = E_{\\max} \\cdot d \\cdot \\frac{\\partial}{\\partial EC_{50}} (EC_{50} + d)^{-1} $$\n使用链式法则，得到：\n$$ \\frac{\\partial E(d)}{\\partial EC_{50}} = E_{\\max} \\cdot d \\cdot \\left( -1 \\cdot (EC_{50} + d)^{-2} \\cdot 1 \\right) = - \\frac{E_{\\max} \\cdot d}{(EC_{50} + d)^2} $$\n将此导数代入 Fisher 信息量公式中，得到单个受试者的 Fisher 信息量：\n$$ I(EC_{50} | d) = \\frac{E_{\\max}^2}{\\sigma^2} \\frac{d^2}{(EC_{50} + d)^4} $$\n一项有 $N$ 名受试者，分配到 $K$ 个剂量水平 $\\{d_0, d_1, \\dots, d_{K-1}\\}$，分配比例为 $\\{w_0, w_1, \\dots, w_{K-1}\\}$ 的研究，其总 Fisher 信息量是每个受试者提供的信息量之和。剂量 $d_i$ 的受试者数量为 $n_i = N w_i$。\n$$ I_{\\text{total}}(EC_{50}) = \\sum_{i=0}^{K-1} n_i \\cdot I(EC_{50} | d_i) = \\sum_{i=0}^{K-1} (N w_i) \\frac{E_{\\max}^2}{\\sigma^2} \\frac{d_i^2}{(EC_{50} + d_i)^4} $$\n为了最大化此量，我们可以忽略常数正因子 $N E_{\\max}^2 / \\sigma^2$，并专注于最大化简化后的目标函数 $\\mathcal{I}$：\n$$ \\text{最大化} \\quad \\mathcal{I}(\\{d_i\\}, \\{w_i\\}) = \\sum_{i=0}^{K-1} w_i \\frac{d_i^2}{(EC_{50} + d_i)^4} $$\n注意，基线剂量 $d_0=0$ 对此总和的贡献为零，这符合预期，因为零剂量下的响应与 $EC_{50}$ 无关。\n\n#### 2. 约束优化问题\n\n完整的优化问题是选择一组 $K-1$ 个活性剂量 $\\{d_1, \\dots, d_{K-1}\\}$ 和分配比例 $\\{w_0, \\dots, w_{K-1}\\}$，以：\n- **最大化**：\n  $$ \\mathcal{I} = \\sum_{i=0}^{K-1} w_i \\frac{d_i^2}{(EC_{50} + d_i)^4} $$\n- **约束条件**：\n  1.  $d_0 = 0$。\n  2.  对于 $i \\in \\{1, \\dots, K-1\\}$，$d_i$ 从允许的离散网格中选择。所有 $d_i$ ($i>0$) 必须是唯一的正数。\n  3.  $\\sum_{i=0}^{K-1} w_i = 1$。\n  4.  $w_0 \\geq n_{\\min,0}/N$。\n  5.  对于 $i \\in \\{1, \\dots, K-1\\}$，$w_i \\geq n_{\\min,a}/N$。\n  6.  $\\sum_{i=0}^{K-1} w_i d_i \\leq d_{\\text{avg},\\max}$。\n  7.  $\\sum_{i: d_i \\geq d_{\\text{high}}} w_i \\leq p_{\\text{high},\\max}$。\n\n#### 3. 求解算法\n\n该问题是一个混合整数规划问题。鉴于活性剂量选择的数量较少（$K-1$），我们可以采用一种保证全局最优的策略：\n1.  **剂量组合枚举**：从允许的剂量网格中，系统地生成所有由 $K-1$ 个唯一活性剂量组成的组合。\n2.  **线性规划求解分配比例**：对于每个固定的剂量组合 $\\{d_0, d_1, \\dots, d_{K-1}\\}$，寻找最优分配比例 $\\{w_i\\}$ 的问题是一个线性规划 (LP) 问题。\n    - **LP 目标**: 最大化 $\\sum_{i=0}^{K-1} c_i w_i$，其中系数为 $c_i = \\frac{d_i^2}{(EC_{50} + d_i)^4}$。\n    - **LP 约束**: 上述关于 $\\{w_i\\}$ 的所有约束都是线性的。\n\n通过对所有可能的剂量组合进行详尽搜索，并对每个组合通过 LP 求解最优权重，我们可以找到全局最优设计。下面的 Python 代码实现了这一算法。\n\n```python\nimport numpy as np\nfrom scipy.optimize import linprog\nimport itertools\n\ndef solve_all_cases():\n    \"\"\"\n    Solves the optimal experimental design problem for all test cases and returns the formatted string.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {\n            \"N\": 60, \"K\": 3, \"EC50\": 50, \"d_min\": 0, \"d_max\": 200, \"delta_d\": 10,\n            \"d_avg_max\": 80, \"d_high\": 150, \"p_high_max\": 0.25,\n            \"n_min_0\": 10, \"n_min_a\": 8\n        },\n        # Case 2\n        {\n            \"N\": 48, \"K\": 3, \"EC50\": 80, \"d_min\": 0, \"d_max\": 300, \"delta_d\": 20,\n            \"d_avg_max\": 110, \"d_high\": 200, \"p_high_max\": 0.05,\n            \"n_min_0\": 8, \"n_min_a\": 8\n        },\n        # Case 3\n        {\n            \"N\": 50, \"K\": 3, \"EC50\": 20, \"d_min\": 0, \"d_max\": 150, \"delta_d\": 10,\n            \"d_avg_max\": 30, \"d_high\": 120, \"p_high_max\": 0.20,\n            \"n_min_0\": 10, \"n_min_a\": 7\n        },\n    ]\n\n    all_results = [find_optimal_design(params) for params in test_cases]\n    \n    def format_result(pair):\n        doses, weights = pair\n        sorted_indices = np.argsort(doses)\n        sorted_doses = np.array(doses)[sorted_indices]\n        sorted_weights = np.array(weights)[sorted_indices]\n        d_str = '[' + ','.join([f\"{d:.2f}\" for d in sorted_doses]) + ']'\n        w_str = '[' + ','.join([f\"{w:.4f}\" for w in sorted_weights]) + ']'\n        return f\"[{d_str},{w_str}]\"\n\n    return '[' + ','.join([format_result(r) for r in all_results]) + ']'\n\ndef find_optimal_design(params):\n    \"\"\"\n    Finds the optimal dose levels and allocations for a single test case.\n    \"\"\"\n    N, K, EC50 = params[\"N\"], params[\"K\"], params[\"EC50\"]\n    d_min, d_max, delta_d = params[\"d_min\"], params[\"d_max\"], params[\"delta_d\"]\n    d_avg_max, d_high, p_high_max = params[\"d_avg_max\"], params[\"d_high\"], params[\"p_high_max\"]\n    n_min_0, n_min_a = params[\"n_min_0\"], params[\"n_min_a\"]\n\n    start_dose = d_min if d_min > 0 else delta_d\n    possible_doses = np.arange(start_dose, d_max + delta_d, delta_d)\n    \n    best_info, best_doses, best_weights = -1.0, None, None\n    num_active_doses = K - 1\n\n    for active_doses_tuple in itertools.combinations(possible_doses, num_active_doses):\n        doses = np.array([0.0] + list(active_doses_tuple))\n        c = - (doses**2) / ((EC50 + doses)**4)\n        \n        A_eq = np.ones((1, K))\n        b_eq = np.array([1.0])\n\n        w_min_0 = n_min_0 / N\n        w_min_a = n_min_a / N\n        bounds = [(w_min_0, None)] + [(w_min_a, None)] * num_active_doses\n        \n        A_ub_avg_dose = doses.reshape(1, -1)\n        b_ub_avg_dose = np.array([d_avg_max])\n        \n        high_dose_indicator = (doses >= d_high).astype(float).reshape(1, -1)\n        A_ub_high_dose = high_dose_indicator\n        b_ub_high_dose = np.array([p_high_max])\n\n        A_ub = np.vstack([A_ub_avg_dose, A_ub_high_dose])\n        b_ub = np.hstack([b_ub_avg_dose, b_ub_high_dose])\n\n        res = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n\n        if res.success and -res.fun > best_info:\n            best_info = -res.fun\n            best_doses = doses\n            best_weights = res.x\n\n    return (best_doses.tolist(), best_weights.tolist())\n\n# The final answer is generated by calling solve_all_cases()\n# For example: final_answer = solve_all_cases()\n```",
            "answer": "[[[0.00,50.00,140.00],[0.1667,0.6833,0.1500]],[[0.00,80.00,180.00],[0.3542,0.4792,0.1667]],[[0.00,20.00,30.00],[0.2000,0.6600,0.1400]]]"
        }
    ]
}