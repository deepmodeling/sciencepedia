{
    "hands_on_practices": [
        {
            "introduction": "一个精确的患者特异性心脏数字孪生始于一个逼真的解剖学基础，其中，心肌纤维的复杂排列尤为关键，因为它决定了电信号的传导和心肌的机械收缩。这项实践将指导你使用一种基本的心脏建模技术——基于规则的方法，来构建心肌纤维结构。你还将学习如何根据模拟的影像数据（如弥散张量成像DTI）来验证你构建的模型的有效性 。",
            "id": "3917295",
            "problem": "您的任务是为一个简化的二维左心室壁透壁薄片构建一个基于规则的心肌纤维结构，使用基于拉普拉斯的透壁坐标，并与弥散张量成像（DTI）的排列一致性进行定量检验。该区域是一个矩形，其宽度 $W$（单位 $\\mathrm{mm}$）沿周向 $x \\in [0,W]$，厚度 $H$（单位 $\\mathrm{mm}$）沿透壁方向 $y \\in [0,H]$。角度必须以弧度表示。\n\n基本原理：\n- 标量场 $u(x,y)$ 的拉普拉斯方程由 $\\nabla^2 u = 0$ 给出，并在适当的边界条件下定义了调和坐标。\n- 透壁坐标通过求解 $\\nabla^2 u = 0$ 来定义，其狄利克雷边界条件为心内膜处 $u(x,0)=0$ 和心外膜处 $u(x,H)=1$，以及在 $x=0$ 和 $x=W$ 处的零通量（诺伊曼）边界条件 $\\partial u/\\partial x = 0$。在具有指定边界条件的矩形几何中，解是线性调和场 $u(x,y)=y/H$。\n- 纤维螺旋角场 $\\phi(x,y)$ 由一个跨壁的基于规则的插值规定，其心内膜螺旋角为 $\\phi_{\\mathrm{endo}}$，心外膜螺旋角为 $\\phi_{\\mathrm{epi}}$，并通过一个小的变化量 $\\gamma$ 进行周向调制：\n$$\n\\phi(x,y) = \\phi_{\\mathrm{endo}} (1 - u(x,y)) + \\phi_{\\mathrm{epi}} \\, u(x,y) + \\gamma \\, \\sin\\!\\left( \\frac{2\\pi x}{W} \\right) \\, u(x,y)\\, \\big(1-u(x,y)\\big).\n$$\n单位纤维方向则为 $f(x,y) = \\left[\\cos\\big(\\phi(x,y)\\big), \\sin\\big(\\phi(x,y)\\big)\\right]$。\n\n- 弥散张量成像（DTI）提供一个弥散张量 $D(x,y)$，其主特征向量 $e_1(x,y)$ 应与 $f(x,y)$ 对齐。我们构建一个合成弥散张量，该张量与给定的各向异性比 $\\kappa$ 和测量的主方向偏差 $\\delta$ 一致，方法如下：\n$$\n\\phi_{\\mathrm{DTI}}(x,y) = \\phi(x,y) + \\delta, \\quad \nR\\big(\\phi_{\\mathrm{DTI}}\\big) = \n\\begin{bmatrix}\n\\cos\\big(\\phi_{\\mathrm{DTI}}\\big) -\\sin\\big(\\phi_{\\mathrm{DTI}}\\big)\\\\\n\\sin\\big(\\phi_{\\mathrm{DTI}}\\big) \\cos\\big(\\phi_{\\mathrm{DTI}}\\big)\n\\end{bmatrix},\n$$\n$$\n\\Lambda = \\mathrm{diag}(\\lambda_1,\\lambda_2),\\quad \\lambda_1 = \\kappa,\\quad \\lambda_2 = 1,\n$$\n$$\nD(x,y) = R\\big(\\phi_{\\mathrm{DTI}}(x,y)\\big)\\, \\Lambda \\, R\\big(\\phi_{\\mathrm{DTI}}(x,y)\\big)^\\top.\n$$\n我们将逐点的排列失配角定义为\n$$\n\\theta(x,y) = \\arccos\\!\\left( \\big| f(x,y) \\cdot e_1(x,y) \\big| \\right),\n$$\n其中 $e_1(x,y)$ 是 $D(x,y)$ 与最大特征值相关联的主特征向量（通过绝对值考虑对齐，不区分符号）。DTI一致性的验收标准是，区域上的平均失配角 $\\overline{\\theta}$ 满足 $\\overline{\\theta} \\le \\tau$，且各向异性比满足 $\\kappa \\ge \\kappa_{\\min}$。\n\n您的程序必须：\n1. 将矩形离散化为一个 $N_x \\times N_y$ 点的均匀网格。\n2. 构建基于拉普拉斯的透壁坐标 $u(x,y)=y/H$。\n3. 计算基于规则的纤维角场 $\\phi(x,y)$ 和纤维方向 $f(x,y)$。\n4. 构建合成弥散张量场 $D(x,y)$，计算 $e_1(x,y)$，并评估平均失配角 $\\overline{\\theta}$。\n5. 对每个测试用例确定一个布尔结果：如果 $\\overline{\\theta} \\le \\tau$ 和 $\\kappa \\ge \\kappa_{\\min}$ 都成立，则为 true，否则为 false。\n\n角度单位要求：所有角度必须为弧度。长度必须为 $\\mathrm{mm}$。最终输出为无单位的布尔值。\n\n测试套件：\n为以下参数集提供结果，以元组 $(N_x,N_y,W,H,\\phi_{\\mathrm{endo}},\\phi_{\\mathrm{epi}},\\gamma,\\delta,\\tau,\\kappa,\\kappa_{\\min})$ 的形式给出：\n- 情况A（理想情况）：$(41,41,30,10,\\pi/3,-\\pi/3,0.2,0.05,0.08,4.0,3.0)$\n- 情况B（各向异性不满足）：$(41,41,30,10,\\pi/3,-\\pi/3,0.2,0.05,0.08,2.0,3.0)$\n- 情况C（排列不满足）：$(41,41,30,10,\\pi/3,-\\pi/3,0.2,0.35,0.20,4.0,3.0)$\n- 情况D（恒定角度边缘情况）：$(41,41,30,10,0.0,0.0,0.0,0.15,0.20,5.0,3.0)$\n\n最终输出格式规范：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表，按给定顺序排列，例如，“[true,false,true,false]”。使用小写的“true”或“false”表示布尔值。",
            "solution": "该问题是有效的，因为它科学地基于连续介质力学和生物医学建模的原理，问题定义清晰，所有术语和程序都有客观明确的定义。我们将继续提供完整的解决方案。\n\n任务是实现一个计算流程，为简化的心脏组织薄片生成基于规则的心肌纤维结构，并根据一个综合生成的弥散张量成像（DTI）数据集检查其一致性。最终输出是一个布尔决策，判断模型参数是否满足一组给定的排列和各向异性标准。\n\n解决方案按顺序进行，从区域离散化到最终的布尔检查。\n\n1. **区域离散化和透壁坐标**\n计算区域是一个由 $x \\in [0, W]$ 和 $y \\in [0, H]$ 定义的矩形。我们将其离散化为一个 $N_x \\times N_y$ 点的均匀网格。网格点 $(i,j)$ 的坐标表示为 $(x_i, y_j)$，其中 $x_i$ 和 $y_j$ 在各自的区间内均匀采样。\n透壁坐标 $u(x,y)$ 对于定义随心肌壁厚度变化的属性至关重要。它被定义为拉普拉斯方程 $\\nabla^2 u = 0$ 的解，边界条件为 $u(x,0) = 0$（心内膜）和 $u(x,H) = 1$（心外膜），以及侧边界上的零通量诺伊曼条件。对于指定的矩形几何，解是透壁维度 $y$ 的一个简单线性函数：\n$$\nu(x,y) = \\frac{y}{H}\n$$\n在我们的离散网格上，这变成一个矩阵 $u_{ij} = y_j / H$。\n\n2. **基于规则的心肌纤维场**\n心肌纤维的取向由一个螺旋角场 $\\phi(x,y)$ 描述。一个常见的基于规则的模型将此角度定义为心内膜角 $\\phi_{\\mathrm{endo}}$ 和心外膜角 $\\phi_{\\mathrm{epi}}$ 之间的插值，使用透壁坐标 $u$ 作为插值参数。该模型还包括一个在周向上的小的正弦变化，由参数 $\\gamma$ 控制：\n$$\n\\phi(x,y) = \\phi_{\\mathrm{endo}} (1 - u(x,y)) + \\phi_{\\mathrm{epi}} \\, u(x,y) + \\gamma \\, \\sin\\!\\left( \\frac{2\\pi x}{W} \\right) \\, u(x,y)\\, \\big(1-u(x,y)\\big)\n$$\n此公式在我们的离散网格上的每个点进行评估，以获得角度场 $\\phi_{ij}$。然后，纤维方向由单位向量场 $f(x,y)$ 表示：\n$$\nf(x,y) = \\begin{bmatrix} \\cos\\big(\\phi(x,y)\\big) \\\\ \\sin\\big(\\phi(x,y)\\big) \\end{bmatrix}\n$$\n\n3. **合成弥散张量和主特征向量**\n为了验证纤维模型，我们构建了一个合成DTI张量场 $D(x,y)$，它被设计为与基于规则的纤维一致，但带有一个已知的系统偏差。合成张量的主方向被设置为基于规则的纤维角加上一个恒定的偏差角 $\\delta$：\n$$\n\\phi_{\\mathrm{DTI}}(x,y) = \\phi(x,y) + \\delta\n$$\n弥散张量 $D$ 由其特征系统定义。特征值由 $\\Lambda = \\mathrm{diag}(\\lambda_1, \\lambda_2)$ 给出，其中 $\\lambda_1 = \\kappa$ 是表示沿纤维方向弥散率的主特征值，$\\lambda_2 = 1$ 是横跨纤维方向的特征值。参数 $\\kappa$ 是各向异性比。特征向量被编码在旋转矩阵 $R(\\phi_{\\mathrm{DTI}})$ 中：\n$$\nR(\\phi_{\\mathrm{DTI}}) = \n\\begin{bmatrix}\n\\cos(\\phi_{\\mathrm{DTI}})  -\\sin(\\phi_{\\mathrm{DTI}}) \\\\\n\\sin(\\phi_{\\mathrm{DTI}})  \\cos(\\phi_{\\mathrm{DTI}})\n\\end{bmatrix}\n$$\n然后通过谱分解公式构建张量：\n$$\nD(x,y) = R\\big(\\phi_{\\mathrm{DTI}}(x,y)\\big)\\, \\Lambda \\, R\\big(\\phi_{\\mathrm{DTI}}(x,y)\\big)^\\top\n$$\n根据 $D$ 的构造方式，其特征向量是旋转矩阵 $R(\\phi_{\\mathrm{DTI}})$ 的列。主特征向量 $e_1(x,y)$ 对应于最大特征值 $\\lambda_1 = \\kappa$。对于所有测试用例，$\\kappa > 1$，所以 $\\lambda_1$ 确实是最大的。因此，主特征向量 $e_1$ 是 $R(\\phi_{\\mathrm{DTI}})$ 的第一列：\n$$\ne_1(x,y) = \\begin{bmatrix} \\cos\\big(\\phi_{\\mathrm{DTI}}(x,y)\\big) \\\\ \\sin\\big(\\phi_{\\mathrm{DTI}}(x,y)\\big) \\end{bmatrix} = \\begin{bmatrix} \\cos\\big(\\phi(x,y) + \\delta\\big) \\\\ \\sin\\big(\\phi(x,y) + \\delta\\big) \\end{bmatrix}\n$$\n这个解析结果允许直接计算 $e_1(x,y)$，而无需对场中的每个张量进行数值求解特征系统。\n\n4. **排列失配量化**\n基于规则的纤维场 $f$ 和合成DTI数据（由其主特征向量 $e_1$ 表示）之间的一致性通过排列失配角 $\\theta(x,y)$ 进行量化。这被定义为两个向量场之间的夹角：\n$$\n\\theta(x,y) = \\arccos(| f(x,y) \\cdot e_1(x,y) |)\n$$\n点积 $f \\cdot e_1$ 可以计算如下：\n$$\nf \\cdot e_1 = \\cos(\\phi) \\cos(\\phi + \\delta) + \\sin(\\phi) \\sin(\\phi + \\delta)\n$$\n使用三角恒等式 $\\cos(A-B) = \\cos(A)\\cos(B) + \\sin(A)\\sin(B)$，这可以简化为：\n$$\nf \\cdot e_1 = \\cos\\big((\\phi+\\delta) - \\phi\\big) = \\cos(\\delta)\n$$\n值得注意的是，点积在整个区域上是一个常数值，与 $x$ 和 $y$ 无关。因此，逐点的失配角也是恒定的：\n$$\n\\theta(x,y) = \\arccos(|\\cos(\\delta)|)\n$$\n对于测试套件中提供的小的正值 $\\delta$（$0.05$、$0.35$、$0.15$ 弧度），$\\cos(\\delta)$ 是正的，所以 $|\\cos(\\delta)| = \\cos(\\delta)$。此外，由于这些 $\\delta$ 值在 $[0, \\pi]$ 范围内，$\\arccos(\\cos(\\delta)) = \\delta$。\n因此，$\\theta(x,y) = \\delta$ 处处成立。区域上的平均失配角 $\\overline{\\theta}$ 只是这个常数值的平均值，即 $\\delta$ 本身。\n\n5. **验收标准**\n如果满足以下两个条件，则认为模型是一致的：\n1. 平均排列失配不超过阈值 $\\tau$：$\\overline{\\theta} \\le \\tau$。根据我们的分析，这等价于 $\\delta \\le \\tau$。\n2. 各向异性比满足最低要求 $\\kappa_{\\min}$：$\\kappa \\ge \\kappa_{\\min}$。\n\n对于每个测试用例，我们评估这两个条件。如果两个条件都满足，则最终结果为 `true`，否则为 `false`。实现将遵循指定的完整计算过程，这将通过数值方式确认解析结果 $\\overline{\\theta} \\approx \\delta$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the myocardial fiber architecture validation problem for a suite of test cases.\n    \"\"\"\n    \n    test_cases = [\n        # (Nx, Ny, W, H, phi_endo, phi_epi, gamma, delta, tau, kappa, k_min)\n        (41, 41, 30, 10, np.pi/3, -np.pi/3, 0.2, 0.05, 0.08, 4.0, 3.0),  # Case A\n        (41, 41, 30, 10, np.pi/3, -np.pi/3, 0.2, 0.05, 0.08, 2.0, 3.0),  # Case B\n        (41, 41, 30, 10, np.pi/3, -np.pi/3, 0.2, 0.35, 0.20, 4.0, 3.0),  # Case C\n        (41, 41, 30, 10, 0.0, 0.0, 0.0, 0.15, 0.20, 5.0, 3.0),            # Case D\n    ]\n\n    results = []\n    for params in test_cases:\n        result = check_consistency(params)\n        results.append(str(result).lower())\n\n    print(f\"[{','.join(results)}]\")\n\ndef check_consistency(params):\n    \"\"\"\n    Performs the validation for a single set of parameters.\n\n    Args:\n        params (tuple): A tuple containing all model and test parameters:\n                        (Nx, Ny, W, H, phi_endo, phi_epi, gamma, delta, tau, kappa, k_min).\n\n    Returns:\n        bool: True if both acceptance criteria are met, False otherwise.\n    \"\"\"\n    Nx, Ny, W, H, phi_endo, phi_epi, gamma, delta, tau, kappa, k_min = params\n\n    # 1. Discretize the rectangle into a uniform grid.\n    x_coords = np.linspace(0, W, Nx)\n    y_coords = np.linspace(0, H, Ny)\n    xx, yy = np.meshgrid(x_coords, y_coords)\n\n    # 2. Construct the Laplace-based transmural coordinate u(x,y) = y/H.\n    u = yy / H\n\n    # 3. Compute the rule-based fiber angle field phi(x,y) and fiber direction f(x,y).\n    phi = (phi_endo * (1 - u) + \n           phi_epi * u + \n           gamma * np.sin(2 * np.pi * xx / W) * u * (1 - u))\n    \n    f_x = np.cos(phi)\n    f_y = np.sin(phi)\n\n    # 4. Build the synthetic diffusion tensor field D(x,y) and compute its principal eigenvector e1(x,y).\n    # The DTI principal direction is biased by delta.\n    phi_dti = phi + delta\n\n    # The principal eigenvector e1 corresponds to the largest eigenvalue kappa.\n    # By construction, D = R(phi_dti) * diag(kappa, 1) * R(phi_dti)^T.\n    # Thus, e1 is the first column of the rotation matrix R(phi_dti).\n    e1_x = np.cos(phi_dti)\n    e1_y = np.sin(phi_dti)\n    \n    # Compute the pointwise alignment mismatch angle theta(x,y).\n    # The dot product is |f . e1|. Use np.clip for numerical stability with arccos.\n    dot_product = np.abs(f_x * e1_x + f_y * e1_y)\n    theta = np.arccos(np.clip(dot_product, -1.0, 1.0))\n    \n    # Evaluate the mean mismatch angle over the domain.\n    mean_theta = np.mean(theta)\n    \n    # 5. Determine the boolean result based on the acceptance criteria.\n    # Criterion 1: Mean mismatch angle must be less than or equal to the threshold tau.\n    alignment_ok = mean_theta = tau\n    \n    # Criterion 2: Anisotropy ratio must be greater than or equal to the minimum kappa_min.\n    anisotropy_ok = kappa >= k_min\n    \n    return alignment_ok and anisotropy_ok\n\nsolve()\n```"
        },
        {
            "introduction": "在建立了心脏的解剖结构之后，下一步是在细胞层面模拟其功能。这项实践将带你深入探索心脏的电活动，通过实现一个基于离子通道动力学基本原理的单细胞模型。通过模拟动作电位并测试其对关键离子电流（如$I_{Kr}$和$I_{CaL}$）的敏感性，你将深入理解细胞层面的特性如何影响整体的心脏节律 。",
            "id": "3917274",
            "problem": "您的任务是实现一个最小化的、具有生物物理一致性的单细胞膜模型，用于特定患者的心脏数字孪生，以计算复极化90%时的动作电位时程 (APD90)，并检验其对快速延迟整流钾电流 (IKr) 和L型钙电流 (ICaL) 电导变化的敏感性。该模型需基于电流平衡和门控动力学的第一性原理，所有物理量均以一致的单位表示。您必须以毫秒 (ms) 为单位生成数值输出，并四舍五入到一位小数，并将所有测试用例的结果汇总到一个打印在单行的列表中。\n\n基础原理：\n- 膜电压动力学由集总电容膜的电流平衡方程决定，\n$$C_m \\frac{dV}{dt} = -\\left(I_{CaL} + I_{Kr} + I_\\text{leak}\\right) + I_\\text{stim}(t),$$\n其中 $V$ 是以毫伏 (mV) 为单位的膜电压，$t$ 是以毫秒 (ms) 为单位的时间，$C_m$ 是以微法每平方厘米 ($\\mu\\text{F}/\\text{cm}^2$) 为单位的膜电容，$I_{CaL}$ 是以微安每平方厘米 ($\\mu\\text{A}/\\text{cm}^2$) 为单位的L型钙电流，$I_{Kr}$ 是以 $\\mu\\text{A}/\\text{cm}^2$ 为单位的快速延迟整流钾电流，$I_\\text{leak}$ 是以 $\\mu\\text{A}/\\text{cm}^2$ 为单位的线性漏电流，$I_\\text{stim}(t)$ 是以 $\\mu\\text{A}/\\text{cm}^2$ 为单位的外部施加的刺激电流。\n\n- 电流遵循带有反转电位的欧姆定律，\n$$I_{CaL} = G_{CaL}\\,d\\,h\\,\\left(V - E_{Ca}\\right), \\quad I_{Kr} = G_{Kr}\\,x_r\\,\\left(V - E_K\\right), \\quad I_\\text{leak} = G_\\text{leak}\\,\\left(V - E_\\text{leak}\\right),$$\n其中 $G_{CaL}$、$G_{Kr}$ 和 $G_\\text{leak}$ 是以毫西门子每平方厘米 ($\\text{mS}/\\text{cm}^2$) 为单位的电导，$E_{Ca}$ 和 $E_K$ 是以 mV 为单位的反转电位，$E_\\text{leak}$ 是以 mV 为单位的漏电流反转电位，$d$、$h$ 和 $x_r$ 是在无量纲区间 $[0,1]$ 内的门控变量。\n\n- 门控变量根据一级动力学向其稳态值演化，其时间常数为：\n$$\\frac{dd}{dt} = \\frac{d_\\infty(V) - d}{\\tau_d(V)}, \\quad \\frac{dh}{dt} = \\frac{h_\\infty(V) - h}{\\tau_h(V)}, \\quad \\frac{dx_r}{dt} = \\frac{x_{r,\\infty}(V) - x_r}{\\tau_{xr}(V)}.$$\n\n- 稳态（无限时间）门控值和时间常数由经过充分检验的S型函数定义：\n$$d_\\infty(V) = \\frac{1}{1 + \\exp\\left(-\\frac{V - V_{d,1/2}}{k_d}\\right)}, \\quad h_\\infty(V) = \\frac{1}{1 + \\exp\\left(\\frac{V - V_{h,1/2}}{k_h}\\right)}, \\quad x_{r,\\infty}(V) = \\frac{1}{1 + \\exp\\left(-\\frac{V - V_{xr,1/2}}{k_{xr}}\\right)},$$\n$$\\tau_d(V) = \\tau_{d,0} + \\frac{\\tau_{d,1}}{1 + \\exp\\left(-\\frac{V - V_{td}}{k_{td}}\\right)}, \\quad \\tau_h(V) = \\tau_{h,0}, \\quad \\tau_{xr}(V) = \\tau_{xr,0}.$$\n\n- 使用以下对于心室心肌具有生理学合理性的固定参数：\n$C_m = 1.0 \\, \\mu\\text{F}/\\text{cm}^2$, $E_{Ca} = 60 \\, \\text{mV}$, $E_K = -90 \\, \\text{mV}$, $E_\\text{leak} = -60 \\, \\text{mV}$, $G_\\text{leak} = 0.02 \\, \\text{mS}/\\text{cm}^2$.\n门控参数：\n$V_{d,1/2} = -10 \\, \\text{mV}$, $k_d = 6 \\, \\text{mV}$, $\\tau_{d,0} = 2 \\, \\text{ms}$, $\\tau_{d,1} = 10 \\, \\text{ms}$, $V_{td} = -10 \\, \\text{mV}$, $k_{td} = 5 \\, \\text{mV}$,\n$V_{h,1/2} = -30 \\, \\text{mV}$, $k_h = 6 \\, \\text{mV}$, $\\tau_{h,0} = 40 \\, \\text{ms}$,\n$V_{xr,1/2} = -20 \\, \\text{mV}$, $k_{xr} = 7 \\, \\text{mV}$, $\\tau_{xr,0} = 100 \\, \\text{ms}$.\n\n- 用于启动单个动作电位的外部刺激电流：\n$$I_\\text{stim}(t) = \\begin{cases}\nI_0  \\text{if } t \\in [t_\\text{start}, t_\\text{end}],\\\\\n0  \\text{otherwise},\n\\end{cases}$$\n其中 $I_0 = 2.5 \\, \\mu\\text{A}/\\text{cm}^2$，$t_\\text{start} = 1.0 \\, \\text{ms}$，$t_\\text{end} = 3.0 \\, \\text{ms}$。初始条件为 $V(0) = -80 \\, \\text{mV}$ 且 $d(0) = d_\\infty(-80 \\, \\text{mV})$，$h(0) = h_\\infty(-80 \\, \\text{mV})$，$x_r(0) = x_{r,\\infty}(-80 \\, \\text{mV})$。\n\nAPD90的定义：\n- 令 $V_\\text{rest}$ 为静息电位，估计为 $V(t)$ 在 $t \\in [0, 0.8] \\, \\text{ms}$ 区间内的平均值。\n- 令 $V_\\text{peak}$ 为 $V(t)$ 在整个仿真窗口内的最大值。\n- 定义动作电位幅度 $A = V_\\text{peak} - V_\\text{rest}$。\n- 如果 $A  20 \\, \\text{mV}$，则认为没有触发动作电位，定义 $\\text{APD90} = 0.0 \\, \\text{ms}$。\n- 否则，定义 $V_{50} = V_\\text{rest} + 0.5 A$ 和 $V_{90} = V_\\text{rest} + 0.1 A$。\n- 令 $t_\\text{up}$ 为上升支期间 $V(t)$ 从下向上穿过 $V_{50}$ 的第一个时间点，令 $t_{90}$ 为 $V_\\text{peak}$ 之后 $V(t)$ 从上向下穿过 $V_{90}$ 的第一个时间点。那么\n$$\\text{APD90} = t_{90} - t_\\text{up}.$$\n使用相邻时间采样点之间的线性插值来估计穿越时间。\n\n数值规格：\n- 使用数值稳定的常微分方程求解器，在 $t \\in [0, 400] \\, \\text{ms}$ 区间内进行仿真，并采用足够精细的时间分辨率以解析穿越点。所有内部计算和输出都必须以毫秒 (ms) 和毫伏 (mV) 为单位。\n- 最终的APD90值以ms为单位表示，每个值四舍五入到一位小数。\n\n测试套件：\n在五种电导配置下评估模型以评估其敏感性：\n1. 基线：$(G_{Kr}, G_{CaL}) = (0.12, 0.10)$，单位为 $\\text{mS}/\\text{cm}^2$。\n2. 降低快速延迟整流钾电导：$(G_{Kr}, G_{CaL}) = (0.06, 0.10)$。\n3. 增加L型钙电导：$(G_{Kr}, G_{CaL}) = (0.12, 0.13)$。\n4. 增加快速延迟整流钾电导：$(G_{Kr}, G_{CaL}) = (0.20, 0.10)$。\n5. 降低L型钙电导：$(G_{Kr}, G_{CaL}) = (0.12, 0.07)$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含五个测试用例的APD90结果，格式为方括号内以逗号分隔的列表（例如，“[result1,result2,result3,result4,result5]”），其中每个结果是以ms为单位、四舍五入到一位小数的浮点数。",
            "solution": "所提出的问题是计算心脏电生理学领域中一个有效且适定的初值问题。它在科学上基于用于模拟离子通道动力学的 Hodgkin-Huxley 范式，并且是自洽的，提供了所有必要的方程、参数、初始条件和分析程序。单位在内部是一致的，任务是客观且计算上可行的。因此，我们可以进行完整求解。\n\n这个问题的核心是模拟心肌细胞膜电压 $V(t)$ 的时间演化，该过程由跨细胞膜的电荷守恒原理决定。该原理表示为一个一阶常微分方程 (ODE)：\n$$C_m \\frac{dV}{dt} = -I_\\text{total} + I_\\text{stim}(t)$$\n此处，$C_m$ 是单位面积的膜电容，电压变化率 $dV/dt$ 与流过膜的净电流成正比。总离子电流 $I_\\text{total}$ 是不同离子通道和泵贡献的总和。在这个简化模型中，我们考虑三种主要电流：L型钙电流 ($I_{CaL}$)、快速延迟整流钾电流 ($I_{Kr}$) 和一个被动漏电流 ($I_\\text{leak}$)。\n$$I_\\text{total} = I_{CaL} + I_{Kr} + I_\\text{leak}$$\n外部刺激电流 $I_\\text{stim}(t)$ 是一个短暂的外部施加电流，旨在使细胞脱离其静息状态并触发一个动作电位。\n\n每种离子电流都使用欧姆关系进行建模，其中电流是电导 ($G$) 和驱动力 ($V - E_{ion}$) 的乘积：\n$$I_{ion} = G_{ion} \\cdot (\\text{gating variables}) \\cdot (V - E_{ion})$$\n驱动力是膜电压 $V$ 与特定离子的能斯特 (Nernst) 平衡电位 $E_{ion}$ 之间的差值。电压门控通道的电导不是恒定的；它取决于通道蛋白的构象状态，由无量纲门控变量表示，我们在此记为 $d$、$h$ 和 $x_r$。\n\n具体电流为：\n1.  $I_{CaL} = G_{CaL}\\,d\\,h\\,(V - E_{Ca})$：这种钙电流负责心脏动作电位的特征性平台期。它由一个激活门 $d$ 和一个失活门 $h$ 控制。\n2.  $I_{Kr} = G_{Kr}\\,x_r\\,(V - E_K)$：这种钾电流是膜复极化的主要驱动力，使电压返回其静息水平。它由一个激活门 $x_r$ 控制。\n3.  $I_\\text{leak} = G_\\text{leak}\\,(V - E_\\text{leak})$：这是一个不依赖于时间门控的线性背景电流，有助于稳定静息膜电位。\n\n门控变量本身的动力学由一阶常微分方程描述，代表了在允许（开放）和不允许（关闭/失活）状态之间的转换：\n$$\\frac{dy}{dt} = \\frac{y_\\infty(V) - y}{\\tau_y(V)}$$\n其中 $y$ 代表一个通用门控变量（$d$、$h$ 或 $x_r$）。变量 $y$ 以一个特征性的、依赖于电压（或恒定）的时间常数 $\\tau_y(V)$，向一个依赖于电压的稳态值 $y_\\infty(V)$ 弛豫。稳态激活/失活函数 ($d_\\infty, h_\\infty, x_{r,\\infty}$) 通常是S型的，反映了通道响应电压变化而开放和关闭的协同性质。\n\n此公式化导致一个关于状态向量 $\\mathbf{y}(t) = [V(t), d(t), h(t), x_r(t)]^T$ 的四个耦合一阶非线性常微分方程组：\n$$\n\\begin{cases}\n\\frac{dV}{dt} = \\frac{1}{C_m} \\left[ - (G_{CaL}\\,d\\,h\\,(V - E_{Ca}) + G_{Kr}\\,x_r\\,(V - E_K) + G_\\text{leak}\\,(V - E_\\text{leak})) + I_\\text{stim}(t) \\right] \\\\\n\\frac{dd}{dt} = \\frac{d_\\infty(V) - d}{\\tau_d(V)} \\\\\n\\frac{dh}{dt} = \\frac{h_\\infty(V) - h}{\\tau_h(V)} \\\\\n\\frac{dx_r}{dt} = \\frac{x_{r,\\infty}(V) - x_r}{\\tau_{xr}(V)}\n\\end{cases}\n$$\n给定 $t=0$ 时的初始条件，该系统必须进行数值求解。我们将采用一个先进的自适应ODE求解器，例如 `scipy.integrate.solve_ivp` 中可用的 `Radau` 方法，该方法非常适合处理电生理学中常见的潜在刚性系统。求解器将被配置为生成密集输出，从而可以在任何时间点精确评估解。\n\n在从 $t=0$ 到 $t=400$ ms的仿真之后，我们将分析得到的电压轨迹 $V(t)$ 以计算复极化90%时的动作电位时程 (APD90)。该指标量化了动作电位的持续时间。计算过程按规定进行：\n1.  从初始刺激前阶段确定静息电位 $V_\\text{rest}$。\n2.  找到峰值电压 $V_\\text{peak}$。\n3.  计算动作电位幅度 $A = V_\\text{peak} - V_\\text{rest}$。如果 $A  20$ mV，则没有动作电位被触发，APD90为 $0.0$。\n4.  确定去极化时间 $t_\\text{up}$，即上升支电压穿过 $V_\\text{rest} + 0.5A$ 的时刻。\n5.  确定复极化时间 $t_{90}$，即下降支（峰值后）电压穿过 $V_\\text{rest} + 0.1A$ 的时刻。\n6.  然后，APD90 计算为 $t_{90} - t_\\text{up}$。\n将使用线性插值来寻找数值解离散时间步之间的精确穿越时间。\n\n对五个指定的电导对 $(G_{Kr}, G_{CaL})$ 中的每一个都执行这整个过程——仿真和分析——以系统地评估模型对这两个关键参数的敏感性。然后将结果按要求进行汇总和格式化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the cardiac cell model problem: simulates action potentials for\n    different conductance values and calculates APD90.\n    \"\"\"\n    # Fixed parameters as defined in the problem\n    params = {\n        'C_m': 1.0,      # uF/cm^2\n        'E_Ca': 60.0,    # mV\n        'E_K': -90.0,    # mV\n        'E_leak': -60.0, # mV\n        'G_leak': 0.02,  # mS/cm^2\n        # Gating parameters\n        'V_d_half': -10.0, 'k_d': 6.0,\n        'tau_d0': 2.0, 'tau_d1': 10.0, 'V_td': -10.0, 'k_td': 5.0,\n        'V_h_half': -30.0, 'k_h': 6.0, 'tau_h0': 40.0,\n        'V_xr_half': -20.0, 'k_xr': 7.0, 'tau_xr0': 100.0,\n        # Stimulus parameters\n        'I0': 2.5,       # uA/cm^2\n        't_start': 1.0,  # ms\n        't_end': 3.0,    # ms\n    }\n\n    test_cases = [\n        (0.12, 0.10), # Baseline\n        (0.06, 0.10), # Reduced IKr\n        (0.12, 0.13), # Increased ICaL\n        (0.20, 0.10), # Increased IKr\n        (0.12, 0.07), # Reduced ICaL\n    ]\n\n    results = []\n    \n    for G_Kr, G_CaL in test_cases:\n        \n        # Define steady-state and time constant functions\n        def d_inf(V): return 1.0 / (1.0 + np.exp(-(V - params['V_d_half']) / params['k_d']))\n        def h_inf(V): return 1.0 / (1.0 + np.exp((V - params['V_h_half']) / params['k_h']))\n        def xr_inf(V): return 1.0 / (1.0 + np.exp(-(V - params['V_xr_half']) / params['k_xr']))\n        \n        def tau_d(V): return params['tau_d0'] + params['tau_d1'] / (1.0 + np.exp(-(V - params['V_td']) / params['k_td']))\n        def tau_h(V): return params['tau_h0']\n        def tau_xr(V): return params['tau_xr0']\n        \n        # Define the ODE system\n        def model(t, y):\n            V, d, h, xr = y\n            \n            # Stimulus current\n            I_stim = params['I0'] if params['t_start'] = t = params['t_end'] else 0.0\n            \n            # Ionic currents\n            I_CaL = G_CaL * d * h * (V - params['E_Ca'])\n            I_Kr = G_Kr * xr * (V - params['E_K'])\n            I_leak = params['G_leak'] * (V - params['E_leak'])\n            \n            # Derivatives\n            dV_dt = (-I_CaL - I_Kr - I_leak + I_stim) / params['C_m']\n            dd_dt = (d_inf(V) - d) / tau_d(V)\n            dh_dt = (h_inf(V) - h) / tau_h(V)\n            dxr_dt = (xr_inf(V) - xr) / tau_xr(V)\n            \n            return [dV_dt, dd_dt, dh_dt, dxr_dt]\n\n        # Initial conditions\n        V0 = -80.0\n        y0 = [V0, d_inf(V0), h_inf(V0), xr_inf(V0)]\n        \n        # Simulation time span\n        t_span = [0, 400]\n        \n        # Solve the ODE system\n        sol = solve_ivp(\n            model, \n            t_span, \n            y0, \n            method='Radau', \n            dense_output=True, \n            atol=1e-8, \n            rtol=1e-8\n        )\n        \n        # Evaluate solution on a fine time grid\n        t_eval = np.linspace(t_span[0], t_span[1], 4001) # 0.1 ms resolution\n        V_eval = sol.sol(t_eval)[0]\n        \n        # Calculate APD90\n        # 1. V_rest\n        rest_mask = t_eval = 0.8\n        V_rest = np.mean(V_eval[rest_mask])\n        \n        # 2. V_peak\n        peak_idx = np.argmax(V_eval)\n        V_peak = V_eval[peak_idx]\n        t_peak = t_eval[peak_idx]\n        \n        # 3. Amplitude and check for AP\n        A = V_peak - V_rest\n        if A  20.0:\n            results.append(0.0)\n            continue\n            \n        # 4. Thresholds\n        V_50 = V_rest + 0.5 * A\n        V_90 = V_rest + 0.1 * A\n        \n        # Helper for linear interpolation\n        def find_crossing(t_data, V_data, threshold, direction):\n            for i in range(1, len(V_data)):\n                v1, v2 = V_data[i-1], V_data[i]\n                t1, t2 = t_data[i-1], t_data[i]\n                if direction == 'up' and v1  threshold = v2:\n                    return t1 + (t2 - t1) * (threshold - v1) / (v2 - v1)\n                if direction == 'down' and v1 > threshold >= v2:\n                    return t1 + (t2 - t1) * (threshold - v1) / (v2 - v1)\n            return None # Should not happen if AP is valid\n            \n        # 5. Find t_up\n        upstroke_mask = t_eval = t_peak\n        t_up = find_crossing(t_eval[upstroke_mask], V_eval[upstroke_mask], V_50, 'up')\n        \n        # 6. Find t_90\n        downstroke_mask = t_eval >= t_peak\n        t_90 = find_crossing(t_eval[downstroke_mask], V_eval[downstroke_mask], V_90, 'down')\n\n        if t_up is None or t_90 is None:\n            apd90 = 0.0 # Could happen in edge cases\n        else:\n            apd90 = t_90 - t_up\n        \n        results.append(round(apd90, 1))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后的这项实践将连接微观与宏观尺度，探索组织层面的力如何转化为器官层面的功能。你将应用力学的一个基石——杨-拉普拉斯方程，从心壁应力（数字孪生的一个关键输出）计算心室压力。这项练习不仅展示了简化模型的强大之处，也要求你对其基本假设进行批判性评估 。",
            "id": "3917320",
            "problem": "使用磁共振成像 (MRI) 和计算机断层扫描 (CT) 获取解剖结构，并构建一个有限元 (FE) 机电模型来预测应力，从而构建了一个患者特异性的左心室 (LV) 心脏数字孪生。在收缩期峰值，心室中部短轴切面上的心内膜表面近似为球面，其主曲率半径均等于 $R$，且环向柯西应力的穿壁梯度不大。有限元模型报告了壁中层的环向柯西应力为 $\\sigma_{\\theta}$，影像得出的室壁厚度为 $h$。将左心室壁局部处理为一个薄膜，其面内各向同性张力 $T$ 与壁中层环向柯西应力的关系为 $T \\approx \\sigma_{\\theta} h$。从薄曲面膜的静态力学平衡和基于曲率的力平衡出发，推导球形情况下内部压力 $P$ 关于张力 $T$ 和主曲率的表达式，然后使用以下患者特异性数值计算 $P$：$R = 25 \\, \\mathrm{mm}$，$h = 10 \\, \\mathrm{mm}$，以及 $\\sigma_{\\theta} = 20 \\, \\mathrm{kPa}$。以千帕 (kPa) 为单位表示最终压力，并将您的答案四舍五入至四位有效数字。简要说明建模假设的合理性，并在您的推导和推理中，指出与心脏力学的厚壁模型相比，薄壁近似的关键局限性。最终答案中不提供定性评论；最终答案必须是单一的计算值。",
            "solution": "首先对问题进行验证，以确保其科学上合理、适定且客观。\n\n**步骤1：提取已知条件**\n- **系统：** 一个患者特异性的左心室 (LV) 心脏数字孪生。\n- **几何形状：** 在收缩期峰值，心内膜表面被建模为球形。\n- **主曲率半径：** 两者均等于 $R$。\n- **室壁厚度：** $h$。\n- **壁中层环向柯西应力：** $\\sigma_{\\theta}$。\n- **近似：** 左心室壁被视为薄膜。\n- **面内各向同性张力：** $T \\approx \\sigma_{\\theta} h$。\n- **控制原理：** 薄曲面膜的静态力学平衡和基于曲率的力平衡。\n- **患者特异性数值：**\n  - $R = 25\\ \\mathrm{mm}$\n  - $h = 10\\ \\mathrm{mm}$\n  - $\\sigma_{\\theta} = 20\\ \\mathrm{kPa}$\n- **目标：**\n  1. 推导内部压力 $P$ 关于张力 $T$ 和主曲率的表达式。\n  2. 使用给定数值计算 $P$。\n- **输出格式：** 以千帕 (kPa) 为单位表示最终压力，四舍五入至四位有效数字。\n- **额外要求：** 说明建模假设的合理性，并指出薄壁近似的局限性。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于杨-拉普拉斯方程，这是力学中的一个基本原理，用于描述曲面界面或膜两侧的压力差。将其应用于左心室的简化模型是生物力学中一种标准且成熟的方法。所涉及的变量及其关系具有物理意义。\n- **适定性：** 该问题提供了所有必要的参数（$R$、$h$、$\\sigma_{\\theta}$）、一个本构关系（$T \\approx \\sigma_{\\theta} h$）以及一个明确的物理定律来应用。这会导出一个唯一的解。\n- **客观性：** 问题以精确、客观的语言陈述，没有主观性论断。\n- **潜在缺陷分析：** 问题指示使用薄壁近似。所提供的数据给出的厚度与半径之比为 $h/R = 10\\ \\mathrm{mm} / 25\\ \\mathrm{mm} = 0.4$。这个值显著大于薄壁有效性的典型阈值（例如 $h/R  0.1$）。然而，问题明确要求指出这种近似的局限性。这是一种标准的教学方法：将一个简化模型应用于其严格意义上不适用的范围，以突出其局限性。因此，这并未使问题无效，反而使对模型的批判成为任务的核心部分。\n\n**步骤3：结论与行动**\n该问题被判定为**有效**。将提供完整解答。\n\n在压差作用下处于静态平衡的薄曲面膜的物理学由杨-拉普拉斯方程描述。该方程建立了由内部压力 $P$ 产生的向外力与膜张力 $T$ 沿曲面作用产生的向内拉力之间的平衡。对于具有两个主曲率 $\\kappa_1$ 和 $\\kappa_2$ 的一般曲面，方程为：\n$$\nP = T (\\kappa_1 + \\kappa_2)\n$$\n这假设张力 $T$ 是各向同性的，意味着它在膜表面内的所有方向上都相同，这与问题的设定一致。\n\n问题陈述左心室的心内膜表面被建模为半径为 $R$ 的球体。对于球体，其表面在所有方向上的弯曲是均匀的。两个主曲率是相同的，等于球体半径的倒数：\n$$\n\\kappa_1 = \\kappa_2 = \\frac{1}{R}\n$$\n将这些曲率代入通用的杨-拉普拉斯方程，得到球形膜的特定形式：\n$$\nP = T \\left(\\frac{1}{R} + \\frac{1}{R}\\right) = \\frac{2T}{R}\n$$\n这就是所要求的压力 $P$ 关于张力 $T$ 和主曲率（通过 $R$ 隐式表示）的表达式。\n\n问题提供了一个将二维膜张力 $T$ 与三维壁应力关联起来的近似关系。张力 $T$（单位长度的力）通过壁中层环向柯西应力 $\\sigma_{\\theta}$（单位面积的力）乘以室壁厚度 $h$ 来近似：\n$$\nT \\approx \\sigma_{\\theta} h\n$$\n这个近似是厚壁连续介质力学与理想化薄膜简化力学之间的联系。\n\n将这个 $T$ 的表达式代入球形拉普拉斯方程，得到以给定模型参数表示的压力 $P$ 的最终公式：\n$$\nP \\approx \\frac{2(\\sigma_{\\theta} h)}{R}\n$$\n现在我们可以使用患者特异性数值进行数值计算：\n- $R = 25\\ \\mathrm{mm}$\n- $h = 10\\ \\mathrm{mm}$\n- $\\sigma_{\\theta} = 20\\ \\mathrm{kPa}$\n\n长度单位（$h$ 和 $R$ 的 $\\mathrm{mm}$）将相互抵消，使得压力 $P$ 的单位与应力 $\\sigma_{\\theta}$ 的单位相同，即千帕（$\\mathrm{kPa}$）。\n$$\nP = \\frac{2 \\times (20\\ \\mathrm{kPa}) \\times (10\\ \\mathrm{mm})}{25\\ \\mathrm{mm}} = \\frac{400}{25}\\ \\mathrm{kPa} = 16\\ \\mathrm{kPa}\n$$\n问题要求答案四舍五入至四位有效数字。计算值恰好为 $16$，可以写成 $16.00$。\n\n这个问题的一个关键方面是薄壁近似的合理性论证和批判。\n\n**建模假设的合理性：**\n将左心室简化为薄球壳是一个一阶模型，它在压力、几何形状和壁应力之间提供了一个直接的代数联系。它的计算成本低，并提供了对心脏功能的基本见解，例如，在心动周期中，压力的产生如何与室壁增厚和半径变化相关。假设穿壁应力梯度“不大”，为使用单一的壁中层应力值 $\\sigma_{\\theta}$ 代表整个室壁厚度提供了理由，这是近似 $T \\approx \\sigma_{\\theta} h$ 的前提条件。\n\n**薄壁近似的局限性：**\n实际上，心脏壁是一个厚结构。薄壁模型的主要局限性，尤其是在本例中，源于对其基本几何假设的违背。\n1.  **厚度与半径之比：** 薄壁假设在室壁厚度远小于曲率半径时（$h \\ll R$）有效。一个常见的工程经验法则是 $h/R  0.1$。在这个问题中，$h/R = 10/25 = 0.4$，这个值很大。这表明薄壁模型正被应用于其精度范围之外，其预测应谨慎看待。\n2.  **穿壁应力梯度：** 承压的厚壁结构会经历显著的应力梯度。对于厚壁球体，环向应力 $\\sigma_{\\theta}$ 在内表面（心内膜）处最大，在外表面（心外膜）处最小。薄壁模型通过使用单一的应力值，完全忽略了这种变化。这是一个主要局限性，因为心内膜处的峰值应力通常是心脏病理生理学（例如，心内膜下缺血）中的一个关键因素。\n3.  **径向应力：** 厚壁理论正确地模拟了径向应力 $\\sigma_r$，该应力从心内膜处的 $-P$ 变化到心外膜处的接近零。薄壁假设等同于假定径向应力与环向应力相比可以忽略不计（$\\sigma_r \\ll \\sigma_{\\theta}$），这在整个室壁厚度上是不成立的。\n4.  **几何简化：** 该模型使用单一半径 $R$。在厚壁中，曲率半径从心内膜到心外膜是变化的。厚壁模型通过对厚度进行积分来考虑这一点。\n\n总而言之，虽然薄壁模型提供了一个简单而有用的概念框架，但对左心室进行更准确的分析将需要一个厚壁模型（例如，基于厚壁球体的拉梅方程），该模型能恰当地考虑大的 $h/R$ 比率以及由此产生的穿壁应力分布。",
            "answer": "$$\n\\boxed{16.00}\n$$"
        }
    ]
}