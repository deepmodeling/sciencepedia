{
    "hands_on_practices": [
        {
            "introduction": "我们从生物医学建模中最基本的模型之一——希尔方程（Hill equation）开始。这个练习将指导你推导药效对于激动剂浓度的归一化灵敏度 。通过分析其在极低和极高浓度下的极限行为，你将深入理解剂量-反应曲线中的关键概念，如饱和效应和协同性。",
            "id": "3912165",
            "problem": "在生物医学系统建模中，对于一个受体介导的药效学模型，其效应作为激动剂浓度的函数通常由一个希尔型输入输出映射表示。考虑由下式定义的效应函数 $y(p)$\n$$\ny(p) \\;=\\; \\frac{E_{\\max}\\,p^{n}}{EC_{50}^{n} + p^{n}},\n$$\n其中 $p$ 是激动剂浓度，$E_{\\max}$ 是最大可及效应，$EC_{50}$ 是半最大效应浓度 (EC50)，$n$ 是反映结合协同性的希尔系数。\n\n从归一化（对数）灵敏度系数 $S_{y}^{p}$ 相对于 $p$ 的基本定义出发，\n$$\nS_{y}^{p} \\;=\\; \\frac{\\partial \\ln y}{\\partial \\ln p},\n$$\n为给定的 $y(p)$ 推导一个用 $p$、$EC_{50}$ 和 $n$ 表示的 $S_{y}^{p}$ 的闭式表达式。然后，确定当 $p \\to 0$ 和 $p \\to \\infty$ 时 $S_{y}^{p}$ 的极限，并解释这些极限在低浓度和高浓度范围内效应如何响应浓度的无穷小相对变化。\n\n将你的最终答案以一个行矩阵的形式给出，依次包含：$S_{y}^{p}(p)$ 的表达式、极限 $\\lim_{p \\to 0} S_{y}^{p}(p)$ 和极限 $\\lim_{p \\to \\infty} S_{y}^{p}(p)$。最终答案无需数值取整，也无需单位。",
            "solution": "用户提供了一个问题，要求推导希尔型药效学模型的归一化灵敏度系数，并分析其极限行为。\n\n### 第 1 步：问题验证\n\n首先，我必须验证问题陈述。\n\n**逐字提取的已知条件：**\n- 效应函数：$y(p) \\;=\\; \\frac{E_{\\max}\\,p^{n}}{EC_{50}^{n} + p^{n}}$\n- $p$：激动剂浓度\n- $E_{\\max}$：最大可及效应\n- $EC_{50}$：半最大效应浓度 (EC50)\n- $n$：希尔系数\n- 归一化（对数）灵敏度系数的定义：$S_{y}^{p} \\;=\\; \\frac{\\partial \\ln y}{\\partial \\ln p}$\n\n**对照标准进行验证：**\n1.  **科学性或事实合理性**：该问题在科学上是合理的。希尔方程是定量药理学和生物化学的基石，用于模拟剂量-效应关系和协同结合。归一化（或对数）灵敏度系数的定义是灵敏度分析中的一个标准和基本概念，广泛应用于系统生物学和工程学。\n2.  **可形式化性与相关性**：该问题本质上是数学问题，需要运用微积分来推导表达式和计算极限。它与*生物医学系统建模*领域中的*归一化灵敏度系数*这一主题直接相关。\n3.  **完整性与一致性**：该问题是自洽的。它提供了函数 $y(p)$ 和灵敏度系数 $S_{y}^{p}$ 的定义，这些是推导所需的全部信息。没有矛盾之处。\n4.  **现实性与可行性**：模型和参数在该领域是标准的，不代表任何物理上不可能或不切实际的条件。\n5.  **适定性与结构性**：该问题是适定的。函数在 $p > 0$ 时可微，可以推导出唯一、稳定且有意义的灵敏度表达式。极限的定义也很明确。\n6.  **非平凡性**：该问题要求正确应用微积分，并理解生物物理背景下的灵敏度和极限行为概念。它不是一个平凡或同义反复的问题。\n7.  **可验证性**：推导和极限计算在数学上是可验证的。\n\n**结论：**\n该问题有效。它是定量生物学或生物工程课程中的一个标准练习。我将继续进行解答。\n\n### 第 2 步：推导与分析\n\n目标是推导效应 $y$ 相对于激动剂浓度 $p$ 的归一化灵敏度系数 $S_{y}^{p}$ 的表达式，并分析其在极低和极高浓度下的行为。\n\n归一化灵敏度系数定义为：\n$$\nS_{y}^{p} \\;=\\; \\frac{\\partial \\ln y}{\\partial \\ln p}\n$$\n该表达式可使用微分的链式法则重写。令 $u = \\ln p$，则 $p = \\exp(u)$ 且 $\\frac{dp}{du} = \\exp(u) = p$。于是，\n$$\nS_{y}^{p} = \\frac{\\partial (\\ln y)}{\\partial u} = \\frac{\\partial (\\ln y)}{\\partial p} \\frac{dp}{du} = p \\frac{\\partial (\\ln y)}{\\partial p}\n$$\n我们首先对效应函数 $y(p)$ 取自然对数：\n$$\ny(p) = \\frac{E_{\\max}\\,p^{n}}{EC_{50}^{n} + p^{n}}\n$$\n$$\n\\ln y(p) = \\ln \\left( \\frac{E_{\\max}\\,p^{n}}{EC_{50}^{n} + p^{n}} \\right)\n$$\n利用对数的性质，我们可以展开此表达式：\n$$\n\\ln y(p) = \\ln(E_{\\max}) + \\ln(p^{n}) - \\ln(EC_{50}^{n} + p^{n})\n$$\n$$\n\\ln y(p) = \\ln(E_{\\max}) + n \\ln(p) - \\ln(EC_{50}^{n} + p^{n})\n$$\n现在，我们对 $\\ln y(p)$ 关于 $p$ 求导：\n$$\n\\frac{\\partial}{\\partial p} \\big( \\ln y(p) \\big) = \\frac{\\partial}{\\partial p} \\left( \\ln(E_{\\max}) + n \\ln(p) - \\ln(EC_{50}^{n} + p^{n}) \\right)\n$$\n常数项 $\\ln(E_{\\max})$ 的导数为 $0$。$n\\ln(p)$ 的导数为 $\\frac{n}{p}$。对于最后一项，我们使用链式法则：\n$$\n\\frac{\\partial}{\\partial p} \\big( \\ln y(p) \\big) = 0 + \\frac{n}{p} - \\frac{1}{EC_{50}^{n} + p^{n}} \\cdot \\frac{\\partial}{\\partial p} (EC_{50}^{n} + p^{n})\n$$\n$$\n\\frac{\\partial}{\\partial p} \\big( \\ln y(p) \\big) = \\frac{n}{p} - \\frac{n p^{n-1}}{EC_{50}^{n} + p^{n}}\n$$\n现在我们可以通过将此结果乘以 $p$ 来计算 $S_{y}^{p}$：\n$$\nS_{y}^{p} = p \\left( \\frac{n}{p} - \\frac{n p^{n-1}}{EC_{50}^{n} + p^{n}} \\right)\n$$\n将 $p$ 分配到括号内得到：\n$$\nS_{y}^{p} = n - \\frac{n p \\cdot p^{n-1}}{EC_{50}^{n} + p^{n}} = n - \\frac{n p^{n}}{EC_{50}^{n} + p^{n}}\n$$\n为简化此表达式，我们将各项通分：\n$$\nS_{y}^{p} = \\frac{n(EC_{50}^{n} + p^{n}) - n p^{n}}{EC_{50}^{n} + p^{n}} = \\frac{n EC_{50}^{n} + n p^{n} - n p^{n}}{EC_{50}^{n} + p^{n}}\n$$\n这简化为归一化灵敏度的最终闭式表达式：\n$$\nS_{y}^{p}(p) = \\frac{n EC_{50}^{n}}{EC_{50}^{n} + p^{n}}\n$$\n\n接下来，我们确定当 $p \\to 0$ 和 $p \\to \\infty$ 时 $S_{y}^{p}$ 的极限。\n\n**当 $p \\to 0$ 时的极限（低浓度范围）：**\n$$\n\\lim_{p \\to 0} S_{y}^{p}(p) = \\lim_{p \\to 0} \\frac{n EC_{50}^{n}}{EC_{50}^{n} + p^{n}}\n$$\n当 $p \\to 0$ 时，$p^{n}$ 项也趋于 $0$（假设 $n > 0$，这是希尔模型的物理要求）。\n$$\n\\lim_{p \\to 0} S_{y}^{p}(p) = \\frac{n EC_{50}^{n}}{EC_{50}^{n} + 0} = \\frac{n EC_{50}^{n}}{EC_{50}^{n}} = n\n$$\n**解释：** 归一化灵敏度 $S_{y}^{p}$ 量化了在给定的浓度 $p$ 的分数变化下，效应 $y$ 的分数变化，即 $\\frac{dy}{y} \\approx S_{y}^{p} \\frac{dp}{p}$。值为 $n$ 意味着在极低浓度下，激动剂浓度增加 $1\\%$ 会导致效应增加 $n\\%$。这对应于剂量-效应曲线的初始陡峭部分，此时效应对浓度的变化高度敏感。对于 $p \\ll EC_{50}$，$y(p) \\approx (E_{\\max}/EC_{50}^n) p^n$，这是一个幂律关系，其对数灵敏度为 $n$ 是其特征。\n\n**当 $p \\to \\infty$ 时的极限（高浓度范围）：**\n$$\n\\lim_{p \\to \\infty} S_{y}^{p}(p) = \\lim_{p \\to \\infty} \\frac{n EC_{50}^{n}}{EC_{50}^{n} + p^{n}}\n$$\n当 $p \\to \\infty$ 时，分母中的 $p^{n}$ 项占主导地位。为了正式计算极限，我们可以将分子和分母同除以 $p^{n}$：\n$$\n\\lim_{p \\to \\infty} S_{y}^{p}(p) = \\lim_{p \\to \\infty} \\frac{\\frac{n EC_{50}^{n}}{p^{n}}}{\\frac{EC_{50}^{n}}{p^{n}} + 1}\n$$\n当 $p \\to \\infty$ 时，$\\frac{EC_{50}^{n}}{p^{n}}$ 项趋于 $0$。\n$$\n\\lim_{p \\to \\infty} S_{y}^{p}(p) = \\frac{0}{0 + 1} = 0\n$$\n**解释：** 灵敏度为 $0$ 意味着在极高浓度下，激动剂浓度的变化对效应的影响可以忽略不计。这是饱和状态，此时效应 $y$ 接近其最大值 $E_{\\max}$。由于受体已完全被占据，系统对 $p$ 的进一步增加不敏感。这对应于剂量-效应曲线的平坦高台区。\n\n所需的三个结果是 $S_{y}^{p}(p)$ 的表达式、其在 $p \\to 0$ 时的极限，以及其在 $p \\to \\infty$ 时的极限。\n1.  $S_{y}^{p}(p) = \\frac{n EC_{50}^{n}}{EC_{50}^{n} + p^{n}}$\n2.  $\\lim_{p \\to 0} S_{y}^{p}(p) = n$\n3.  $\\lim_{p \\to \\infty} S_{y}^{p}(p) = 0$\n这些将按要求以行矩阵的形式呈现。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{n EC_{50}^{n}}{EC_{50}^{n} + p^{n}} & n & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在掌握了基本函数的灵敏度分析之后，我们将注意力转向处于稳态的动态系统。这个练习模拟了一个经典的酶促反应系统，你需要计算稳态底物浓度对模型关键参数（如 $V_{\\max}$ 和 $K_M$）的灵敏度 。这项技能对于识别系统中起决定性作用的参数至关重要，从而为实验设计和模型简化提供理论依据。",
            "id": "3912179",
            "problem": "考虑一个充分混合的单室生化系统，该系统模拟了在生物医学背景下（例如，肝细胞中的一种代谢前体）底物发生的酶促转化过程。设底物浓度表示为 $S(t)$，并假设该室以恒定速率 $I$（单位为浓度/单位时间）接收底物流入。底物根据经典的米氏（Michaelis–Menten）速率定律进行酶促转化，该定律由最大速率 $V_{\\max}$ 和米氏常数 $K_{M}$ 表征。$S(t)$ 的动态变化由一个常微分方程（ODE）所控制，该方程表达了恒定流入和酶促消耗之间的质量平衡。假设参数满足 $V_{\\max} > I$，从而存在一个正的、有限的稳态。\n\n从质量平衡和酶促速率定律的标准形式出发，推导出稳态底物浓度 $S^{\\ast}$，然后仅根据第一性原理和核心定义，求出 $S^{\\ast}$ 相对于 $V_{\\max}$ 和 $K_{M}$ 的归一化灵敏度系数。你的推导过程必须在每一步都有数学依据，并且不得依赖于任何预先给出的灵敏度公式。以闭式解析表达式的形式给出最终的灵敏度系数。无需进行数值计算或四舍五入。最终答案必须包含 $S^{\\ast}$ 相对于 $V_{\\max}$ 和 $K_{M}$ 的归一化灵敏度所对应的两个解析表达式，并排列成一个单行矩阵。",
            "solution": "该问题要求在一个单室生化系统中推导稳态底物浓度 $S^{\\ast}$，并随后推导 $S^{\\ast}$ 相对于参数 $V_{\\max}$ 和 $K_{M}$ 的归一化灵敏度系数。\n\n该系统由底物浓度 $S(t)$ 的动态变化所描述。$S(t)$ 的变化速率由质量平衡原理控制，该原理指出，累积速率等于流入速率减去流出（或消耗）速率。\n\n流入速率为给定的常数 $I$。\n消耗速率遵循米氏速率定律，其表达式为 $v(S) = \\frac{V_{\\max} S}{K_{M} + S}$。\n\n因此，底物浓度 $S(t)$ 的常微分方程（ODE）为：\n$$\n\\frac{dS}{dt} = I - \\frac{V_{\\max} S(t)}{K_{M} + S(t)}\n$$\n\n为了求出记为 $S^{\\ast}$ 的稳态浓度，我们将浓度的变化速率设为零，即 $\\frac{dS}{dt} = 0$。在稳态下，系统处于平衡状态，流入速率与消耗速率完全相等。\n$$\n0 = I - \\frac{V_{\\max} S^{\\ast}}{K_{M} + S^{\\ast}}\n$$\n重新整理此方程以求解 $S^{\\ast}$：\n$$\nI = \\frac{V_{\\max} S^{\\ast}}{K_{M} + S^{\\ast}}\n$$\n两边同乘以 $(K_{M} + S^{\\ast})$ 得：\n$$\nI (K_{M} + S^{\\ast}) = V_{\\max} S^{\\ast}\n$$\n展开左侧：\n$$\nI K_{M} + I S^{\\ast} = V_{\\max} S^{\\ast}\n$$\n为分离出 $S^{\\ast}$，我们将包含 $S^{\\ast}$ 的项移到等式的一边：\n$$\nI K_{M} = V_{\\max} S^{\\ast} - I S^{\\ast}\n$$\n提出公因子 $S^{\\ast}$：\n$$\nI K_{M} = S^{\\ast} (V_{\\max} - I)\n$$\n问题陈述中给出了条件 $V_{\\max} > I$，这确保了 $(V_{\\max} - I)$ 项是一个正的非零常数。因此我们可以除以该项，得到稳态浓度 $S^{\\ast}$ 的表达式：\n$$\nS^{\\ast} = \\frac{I K_{M}}{V_{\\max} - I}\n$$\n这就是稳态底物浓度的闭式解析表达式。\n\n接下来，我们推导归一化灵敏度系数。变量 $y$ 相对于参数 $p$ 的归一化灵敏度系数（记为 $C_{p}^{y}$）定义为 $y$ 的相对变化量与 $p$ 的相对变化量之比。在数学上，这表示为：\n$$\nC_{p}^{y} = \\frac{\\partial y / y}{\\partial p / p} = \\frac{p}{y} \\frac{\\partial y}{\\partial p}\n$$\n一个等价的定义是 $C_{p}^{y} = \\frac{\\partial (\\ln y)}{\\partial (\\ln p)}$。我们将使用第一个定义。\n\n首先，我们计算 $S^{\\ast}$ 相对于 $V_{\\max}$ 的归一化灵敏度，即 $C_{V_{\\max}}^{S^{\\ast}}$。\n$$\nC_{V_{\\max}}^{S^{\\ast}} = \\frac{V_{\\max}}{S^{\\ast}} \\frac{\\partial S^{\\ast}}{\\partial V_{\\max}}\n$$\n我们需要计算 $S^{\\ast}$ 对 $V_{\\max}$ 的偏导数。将 $S^{\\ast}$ 视为 $V_{\\max}$ 的函数：$S^{\\ast}(V_{\\max}) = I K_{M} (V_{\\max} - I)^{-1}$。\n使用链式法则求导：\n$$\n\\frac{\\partial S^{\\ast}}{\\partial V_{\\max}} = I K_{M} \\cdot (-1) (V_{\\max} - I)^{-2} \\cdot \\frac{\\partial}{\\partial V_{\\max}}(V_{\\max} - I)\n$$\n$$\n\\frac{\\partial S^{\\ast}}{\\partial V_{\\max}} = -I K_{M} (V_{\\max} - I)^{-2} \\cdot (1) = -\\frac{I K_{M}}{(V_{\\max} - I)^2}\n$$\n现在，将这个导数和 $S^{\\ast}$ 的表达式代入灵敏度公式中：\n$$\nC_{V_{\\max}}^{S^{\\ast}} = \\frac{V_{\\max}}{\\frac{I K_{M}}{V_{\\max} - I}} \\left( -\\frac{I K_{M}}{(V_{\\max} - I)^2} \\right)\n$$\n$$\nC_{V_{\\max}}^{S^{\\ast}} = \\frac{V_{\\max} (V_{\\max} - I)}{I K_{M}} \\left( -\\frac{I K_{M}}{(V_{\\max} - I)^2} \\right)\n$$\n$I K_{M}$ 项和 $(V_{\\max} - I)$ 的一个因子可以消去：\n$$\nC_{V_{\\max}}^{S^{\\ast}} = - \\frac{V_{\\max}}{V_{\\max} - I}\n$$\n\n其次，我们计算 $S^{\\ast}$ 相对于 $K_{M}$ 的归一化灵敏度，即 $C_{K_{M}}^{S^{\\ast}}$。\n$$\nC_{K_{M}}^{S^{\\ast}} = \\frac{K_{M}}{S^{\\ast}} \\frac{\\partial S^{\\ast}}{\\partial K_{M}}\n$$\n我们计算 $S^{\\ast}$ 对 $K_{M}$ 的偏导数。从表达式 $S^{\\ast} = \\frac{I K_{M}}{V_{\\max} - I}$ 中，我们可以看出 $S^{\\ast}$ 与 $K_{M}$ 成正比。项 $\\frac{I}{V_{\\max} - I}$ 是一个相对于 $K_{M}$ 的常数。\n$$\n\\frac{\\partial S^{\\ast}}{\\partial K_{M}} = \\frac{\\partial}{\\partial K_{M}} \\left( \\frac{I}{V_{\\max} - I} K_{M} \\right) = \\frac{I}{V_{\\max} - I}\n$$\n将这个导数和 $S^{\\ast}$ 的表达式代入灵敏度公式中：\n$$\nC_{K_{M}}^{S^{\\ast}} = \\frac{K_{M}}{\\frac{I K_{M}}{V_{\\max} - I}} \\left( \\frac{I}{V_{\\max} - I} \\right)\n$$\n$$\nC_{K_{M}}^{S^{\\ast}} = \\frac{K_{M} (V_{\\max} - I)}{I K_{M}} \\left( \\frac{I}{V_{\\max} - I} \\right)\n$$\n所有项都消去了，剩下：\n$$\nC_{K_{M}}^{S^{\\ast}} = 1\n$$\n推导出的归一化灵敏度系数为 $C_{V_{\\max}}^{S^{\\ast}} = -\\frac{V_{\\max}}{V_{\\max} - I}$ 和 $C_{K_{M}}^{S^{\\ast}} = 1$。最终答案应将它们表示为一个单行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\frac{V_{\\max}}{V_{\\max} - I} & 1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "最后，我们将挑战一个更复杂的、多变量的生物调控网络模型。这个实践将介绍一种强大且通用的计算方法，该方法利用雅可比矩阵和线性代数来系统地计算任意常微分方程（ODE）系统的稳态灵敏度 。掌握这种基于算法的分析方法，并学会处理如病态（ill-conditioning）等关键数值问题，将为你分析大规模生物系统模型和应对真实世界的研究挑战做好准备。",
            "id": "3912151",
            "problem": "考虑一个确定性的、粗粒度的生化调控模型，该模型被写成一个关于三个状态变量 $x = (x_1, x_2, x_3)$ 的常微分方程组（ODEs），这些变量分别代表信使核糖核酸（$x_1$）、蛋白质浓度（$x_2$）和活化蛋白（$x_3$）。该系统依赖于七个正参数 $p = (p_0, p_1, p_2, p_3, p_4, p_5, p_6)$，并由以下公式给出：\n$$\n\\frac{dx_1}{dt} = p_0 - p_1 x_1,\n\\quad\n\\frac{dx_2}{dt} = p_2 x_1 - p_3 x_2,\n\\quad\n\\frac{dx_3}{dt} = \\frac{p_4 x_2}{p_5 + x_2} - p_6 x_3.\n$$\n假设对于每个参数向量 $p$ 都存在一个稳态 $x^{*}(p)$，其定义为 $f(x^{*},p) = 0$，其中 $f(x,p)$ 表示常微分方程的右侧。定义稳态下的三个关注输出 $y = (y_1,y_2,y_3)$ 为：\n$$\ny_1 = x_2^{*},\n\\quad\ny_2 = x_3^{*},\n\\quad\ny_3 = \\frac{p_4 x_2^{*}}{p_5 + x_2^{*}},\n$$\n其中 $x^{*} = (x_1^{*}, x_2^{*}, x_3^{*})$ 是稳态值。输出 $y_i$ 相对于参数 $p_k$ 在稳态下的归一化灵敏度系数定义为：\n$$\nS_{i,k} = \\frac{p_k}{y_i} \\frac{\\partial y_i}{\\partial p_k},\n$$\n这是一个无量纲量。您的任务是计算稳态归一化灵敏度系数的全矩阵 $S \\in \\mathbb{R}^{3 \\times 7}$，该矩阵表示输出 $y$ 对参数 $p$ 的灵敏度。您需要使用一种源于第一性原理的方法：从稳态定义 $f(x^{*},p)=0$ 开始，将 $x^{*}$ 视为 $p$ 的隐函数，并使用在 $x^{*}$ 处求值的适当雅可比矩阵来建立并求解一个线性系统，以获得稳态下的状态灵敏度。然后，使用链式法则将状态灵敏度映射到输出灵敏度，并应用上述归一化方法。\n\n必须明确处理数值条件问题。具体来说，当 $f$ 关于 $x$ 的雅可比矩阵在 $x^{*}$ 处求值（记为 $J_x(x^{*},p)$）是病态的（在 $2$-范数意义下条件数很大）时，您必须避免不稳定的求解。在这种情况下，使用一种基于奇异值分解（SVD）和按矩阵范数缩放的小的吉洪诺夫正则化（Tikhonov regularization）的数值稳定方法来求解产生状态灵敏度的线性系统。当 $J_x(x^{*},p)$ 是良态的，可以直接使用线性求解器。\n\n对于此模型，为确保科学真实性和可复现性，您必须在计算雅可比矩阵之前解析地计算稳态。稳态值由每个方程中产生和降解的代数平衡确定，得出：\n$$\nx_1^{*} = \\frac{p_0}{p_1}, \n\\quad\nx_2^{*} = \\frac{p_2}{p_3} x_1^{*},\n\\quad\nx_3^{*} = \\frac{p_4}{p_6} \\frac{x_2^{*}}{p_5 + x_2^{*}},\n$$\n对于每个具有正条目的参数向量 $p$。\n\n您的程序必须为测试套件中的每个参数向量 $p$ 实现以下步骤：\n- 使用上述代数表达式计算 $x^{*}(p)$。\n- 计算雅可比矩阵 $J_x(x^{*},p)$ 和 $J_p(x^{*},p)$，其中 $J_x$ 是 $f$ 关于 $x$ 的偏导数矩阵，$J_p$ 是 $f$ 关于 $p$ 的偏导数矩阵。\n- 对于每个参数 $p_k$，根据 $J_x(x^{*},p)$ 的条件数要求，使用数值稳定的方法求解稳态灵敏度分析所隐含的线性系统，以获得 $\\frac{\\partial x^{*}}{\\partial p_k}$。\n- 通过链式法则，在稳态下使用 $y$ 关于 $x$ 和 $p$ 的雅可比矩阵计算 $\\frac{\\partial y}{\\partial p_k}$。\n- 使用上述归一化公式计算 $S_{i,k}$。\n\n最终输出 $S_{i,k}$ 是没有物理单位的纯数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应于测试套件中的一个参数向量，并且本身是一个列表的列表，表示按输出行排列的 $3 \\times 7$ 归一化灵敏度矩阵。例如，一个正确形状的输出对于每个参数集应如下所示：\n$$\n[[\\text{row}_1], [\\text{row}_2], [\\text{row}_3]]\n$$\n整个输出行应为：\n$$\n[[\\dots],[\\dots],[\\dots]].\n$$\n\n测试套件（三组参数）：\n- 情况 A（一般良态）：$p = (10.0, 2.0, 5.0, 1.0, 3.0, 1.0, 0.5)$。\n- 情况 B（因缓慢降解导致的病态）：$p = (10.0, 10^{-6}, 5.0, 10^{-6}, 3.0, 1.0, 0.5)$。\n- 情况 C（小活化常数和快速失活）：$p = (10.0, 2.0, 5.0, 1.0, 3.0, 10^{-3}, 100.0)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，格式如下：\n$$\n[[S^{(A)}], [S^{(B)}], [S^{(C)}]]\n$$\n其中每个 $[S^{(\\cdot)}]$ 表示为一个包含三行的列表，每行包含七个浮点数。",
            "solution": "已对用户提供的问题进行分析，并确定其有效。该问题具有科学依据，是适定且客观的。问题描述了一个标准的生化模型，并要求计算归一化灵敏度系数，这是系统生物学和控制理论中一个明确定义的任务。指令完整、一致，并要求一个涉及隐函数微分和线性代数的正式数学过程，同时给出了处理数值条件问题的具体说明。所有需要的数据和定义均已提供。\n\n该问题要求计算一个 $3 \\times 7$ 的归一化灵敏度矩阵 $S \\in \\mathbb{R}^{3 \\times 7}$，用于表示三个输出 $y_i$ 相对于七个参数 $p_k$ 的灵敏度。在稳态 $x^*$ 下，灵敏度定义为：\n$$\nS_{i,k} = \\frac{p_k}{y_i} \\frac{\\partial y_i}{\\partial p_k}\n$$\n该方法的核心依赖于应用于稳态条件 $f(x^*(p), p) = 0$ 的隐函数定理。\n\n**步骤 1：稳态分析**\n常微分方程（ODEs）系统由以下公式给出：\n$$\nf(x, p) = \\begin{pmatrix} f_1 \\\\ f_2 \\\\ f_3 \\end{pmatrix} = \\begin{pmatrix} p_0 - p_1 x_1 \\\\ p_2 x_1 - p_3 x_2 \\\\ \\frac{p_4 x_2}{p_5 + x_2} - p_6 x_3 \\end{pmatrix}\n$$\n在稳态下，$f(x^*, p) = 0$。问题提供了稳态向量 $x^* = (x_1^*, x_2^*, x_3^*)$ 的解析解：\n$$\nx_1^{*} = \\frac{p_0}{p_1}, \\quad x_2^{*} = \\frac{p_2}{p_3} x_1^{*} = \\frac{p_0 p_2}{p_1 p_3}, \\quad x_3^{*} = \\frac{1}{p_6} \\frac{p_4 x_2^{*}}{p_5 + x_2^{*}}\n$$\n这些表达式用于为每个给定的参数向量 $p$ 计算具体的稳态点。\n\n**步骤 2：状态灵敏度的推导**\n我们将稳态解 $x^*$ 视为参数 $p$ 的隐函数。对稳态条件 $f(x^*(p), p) = 0$ 关于参数 $p_k$ 取全导数，得到：\n$$\n\\frac{d}{dp_k} f(x^*(p), p) = \\frac{\\partial f}{\\partial x} \\frac{\\partial x^*}{\\partial p_k} + \\frac{\\partial f}{\\partial p_k} = 0\n$$\n其中 $\\frac{\\partial f}{\\partial x}$ 是 $f$ 关于 $x$ 的雅可比矩阵，记为 $J_x$，而 $\\frac{\\partial x^*}{\\partial p_k}$ 是状态对 $p_k$ 的灵敏度向量。整理此方程得到一个关于状态灵敏度的线性系统：\n$$\nJ_x(x^*, p) \\frac{\\partial x^*}{\\partial p_k} = - \\frac{\\partial f}{\\partial p_k}\n$$\n这个系统必须对每个参数 $p_k$（其中 $k=0, 1, \\dots, 6$）求解。\n\n首先，我们计算雅可比矩阵 $J_x = \\frac{\\partial f}{\\partial x}$ 并在稳态 $x^*$ 处求值：\n$$\nJ_x(x^*, p) = \\begin{pmatrix}\n-p_1 & 0 & 0 \\\\\np_2 & -p_3 & 0 \\\\\n0 & \\frac{p_4 p_5}{(p_5 + x_2^*)^2} & -p_6\n\\end{pmatrix}\n$$\n这是一个下三角矩阵，简化了线性系统的求解。\n\n接下来，我们计算每个 $k$ 对应的向量 $\\frac{\\partial f}{\\partial p_k}$：\n$$\n\\frac{\\partial f}{\\partial p_0} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad\n\\frac{\\partial f}{\\partial p_1} = \\begin{pmatrix} -x_1^* \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad\n\\frac{\\partial f}{\\partial p_2} = \\begin{pmatrix} 0 \\\\ x_1^* \\\\ 0 \\end{pmatrix}, \\quad\n\\frac{\\partial f}{\\partial p_3} = \\begin{pmatrix} 0 \\\\ -x_2^* \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\frac{\\partial f}{\\partial p_4} = \\begin{pmatrix} 0 \\\\ 0 \\\\ \\frac{x_2^*}{p_5 + x_2^*} \\end{pmatrix}, \\quad\n\\frac{\\partial f}{\\partial p_5} = \\begin{pmatrix} 0 \\\\ 0 \\\\ -\\frac{p_4 x_2^*}{(p_5 + x_2^*)^2} \\end{pmatrix}, \\quad\n\\frac{\\partial f}{\\partial p_6} = \\begin{pmatrix} 0 \\\\ 0 \\\\ -x_3^* \\end{pmatrix}\n$$\n\n**步骤 3：求解状态灵敏度的线性系统**\n对于每个 $k \\in \\{0, \\dots, 6\\}$，我们求解系统 $J_x z_k = b_k$，其中 $z_k = \\frac{\\partial x^*}{\\partial p_k}$ 且 $b_k = -\\frac{\\partial f}{\\partial p_k}$。问题要求根据 $J_x$ 的条件数采用数值稳定的方法。\n条件数（在 $2$-范数下）计算为 $\\text{cond}(J_x) = \\|J_x\\|_2 \\|J_x^{-1}\\|_2$。如果 $\\text{cond}(J_x)$ 很大，表示病态，则需要正则化解法。我们使用吉洪诺夫正则化（Tikhonov regularization），即求解 $(J_x^T J_x + \\alpha I) z_k = J_x^T b_k$。一种数值稳健的计算方法是通过奇异值分解（SVD）。设 $J_x = U \\Sigma V^T$。正则化解为：\n$$\nz_k = V (\\Sigma^2 + \\alpha I)^{-1} \\Sigma^T U^T b_k = \\sum_{j=1}^{3} \\frac{\\sigma_j}{\\sigma_j^2 + \\alpha} (u_j^T b_k) v_j\n$$\n其中 $\\sigma_j$ 是奇异值，$u_j, v_j$ 分别是 $U$ 和 $V$ 的列向量。正则化参数 $\\alpha$ 选择为一个按矩阵范数缩放的小值，例如 $\\alpha = \\epsilon \\sigma_1$，其中 $\\epsilon$ 是一个小数，如 $10^{-8}$。如果 $J_x$ 是良态的，标准的线性求解器就足够了。\n\n**步骤 4：计算输出灵敏度**\n输出 $y$ 是状态 $x^*$ 和参数 $p$ 的函数：$y = g(x^*, p)$。\n$$\ny_1 = x_2^*, \\quad y_2 = x_3^*, \\quad y_3 = \\frac{p_4 x_2^*}{p_5 + x_2^*}\n$$\n使用链式法则，输出向量 $y$ 对参数 $p_k$ 的灵敏度为：\n$$\n\\frac{\\partial y}{\\partial p_k} = \\frac{\\partial g}{\\partial x} \\frac{\\partial x^*}{\\partial p_k} + \\frac{\\partial g}{\\partial p_k}\n$$\n我们计算 $g$ 关于 $x$ 的雅可比矩阵 $J_{g,x}$ 和 $g$ 关于 $p$ 的偏导数 $J_{g,p}$。\n$$\nJ_{g,x} = \\frac{\\partial g}{\\partial x} = \\begin{pmatrix}\n0 & 1 & 0 \\\\\n0 & 0 & 1 \\\\\n0 & \\frac{p_4 p_5}{(p_5 + x_2^*)^2} & 0\n\\end{pmatrix}\n$$\n偏导数 $\\frac{\\partial g}{\\partial p_k}$ 仅在 $y_3$ 对 $p_4$ 和 $p_5$ 求导时非零：\n$$\n\\frac{\\partial g}{\\partial p_4} = \\begin{pmatrix} 0 \\\\ 0 \\\\ \\frac{x_2^*}{p_5 + x_2^*} \\end{pmatrix}, \\quad\n\\frac{\\partial g}{\\partial p_5} = \\begin{pmatrix} 0 \\\\ 0 \\\\ -\\frac{p_4 x_2^*}{(p_5 + x_2^*)^2} \\end{pmatrix}\n$$\n对于所有其他 $k$，$\\frac{\\partial g}{\\partial p_k}$ 是一个零向量。未归一化的输出灵敏度矩阵 $\\frac{\\partial y}{\\partial p}$ 计算为 $J_{g,x} \\left(\\frac{\\partial x^*}{\\partial p}\\right) + J_{g,p}$，其中 $\\frac{\\partial x^*}{\\partial p}$ 是 $3 \\times 7$ 的状态灵敏度矩阵。\n\n**步骤 5：归一化**\n最后，逐元素计算归一化灵敏度矩阵 $S$。对于每个输出 $y_i$ 和参数 $p_k$：\n$$\nS_{i,k} = \\frac{p_k}{y_i^*} \\left(\\frac{\\partial y}{\\partial p}\\right)_{i,k}\n$$\n其中 $y_i^*$ 是稳态输出值：\n$$\ny_1^* = x_2^*, \\quad y_2^* = x_3^*, \\quad y_3^* = \\frac{p_4 x_2^*}{p_5 + x_2^*} = p_6 x_3^*\n$$\n由于所有参数 $p_j$ 均为正，稳态值 $x_i^*$ 和 $y_i^*$ 也为正，防止了除以零。对于每个测试用例，计算得到的 $3 \\times 7$ 矩阵 $S$。",
            "answer": "```python\nimport numpy as np\nfrom typing import List, Tuple\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the sensitivity analysis for the given test cases.\n    \"\"\"\n\n    def compute_sensitivity_matrix(p: np.ndarray) -> np.ndarray:\n        \"\"\"\n        Computes the 3x7 normalized sensitivity matrix S for a given parameter vector p.\n        \n        Args:\n            p: A 1D numpy array of 7 parameters (p0, ..., p6).\n\n        Returns:\n            A 2D numpy array (3x7) representing the matrix S.\n        \"\"\"\n        p0, p1, p2, p3, p4, p5, p6 = p\n\n        # Step 1: Compute steady state x_star\n        if p1 == 0 or p3 == 0:\n            # Avoid division by zero, though problem statement guarantees positive params\n            raise ValueError(\"Parameters p1 and p3 must be non-zero.\")\n        \n        x1_star = p0 / p1\n        x2_star = (p2 / p3) * x1_star\n        \n        if p6 == 0 or (p5 + x2_star) == 0:\n            raise ValueError(\"Parameters p6 and (p5 + x2_star) must be non-zero.\")\n        \n        x3_star = (p4 / p6) * x2_star / (p5 + x2_star)\n        x_star = np.array([x1_star, x2_star, x3_star])\n\n        # Step 2: Assemble Jacobian J_x(x_star, p)\n        Jx_f = np.zeros((3, 3))\n        Jx_f[0, 0] = -p1\n        Jx_f[1, 0] = p2\n        Jx_f[1, 1] = -p3\n        Jx_f[2, 1] = (p4 * p5) / ((p5 + x2_star)**2)\n        Jx_f[2, 2] = -p6\n\n        # Step 3: Solve for state sensitivities dx*/dp_k\n        dx_dp = np.zeros((3, 7))\n        \n        # Calculate condition number to decide on solver\n        cond_Jx = np.linalg.cond(Jx_f)\n        ILL_CONDITIONED_THRESHOLD = 1e12\n\n        for k in range(7):\n            # Form the right-hand side vector b_k = -df/dp_k\n            b_k = np.zeros(3)\n            if k == 0:  # p0\n                b_k[0] = -1.0\n            elif k == 1:  # p1\n                b_k[0] = x1_star\n            elif k == 2:  # p2\n                b_k[1] = -x1_star\n            elif k == 3:  # p3\n                b_k[1] = x2_star\n            elif k == 4:  # p4\n                b_k[2] = -x2_star / (p5 + x2_star)\n            elif k == 5:  # p5\n                b_k[2] = p4 * x2_star / ((p5 + x2_star)**2)\n            elif k == 6:  # p6\n                b_k[2] = x3_star\n            \n            # Solve the linear system\n            if cond_Jx > ILL_CONDITIONED_THRESHOLD:\n                # Use SVD with Tikhonov regularization for ill-conditioned system\n                U, s, Vh = np.linalg.svd(Jx_f)\n                # Regularization parameter alpha, scaled by the largest singular value\n                alpha = 1e-8 * s[0]\n                s_reg = s / (s**2 + alpha)\n                # Reconstruct z_k = V * diag(s_reg) * U.T * b_k\n                z_k = Vh.T @ (np.diag(s_reg) @ (U.T @ b_k))\n            else:\n                # Use standard direct solver for well-conditioned system\n                z_k = np.linalg.solve(Jx_f, b_k)\n            \n            dx_dp[:, k] = z_k\n\n        # Step 4: Compute output sensitivities dy/dp\n        # y = g(x*, p), dy/dp = (dg/dx)*(dx*/dp) + (dg/dp)\n        \n        # Jacobian dg/dx evaluated at x_star\n        Jg_x = np.zeros((3, 3))\n        Jg_x[0, 1] = 1.0\n        Jg_x[1, 2] = 1.0\n        Jg_x[2, 1] = (p4 * p5) / ((p5 + x2_star)**2)\n        \n        # Partial derivatives dg/dp\n        Jg_p = np.zeros((3, 7))\n        Jg_p[2, 4] = x2_star / (p5 + x2_star)\n        Jg_p[2, 5] = -p4 * x2_star / ((p5 + x2_star)**2)\n\n        # Matrix of un-normalized output sensitivities\n        dy_dp = Jg_x @ dx_dp + Jg_p\n        \n        # Step 5: Normalization\n        # Compute steady-state outputs y_star\n        y1_star = x2_star\n        y2_star = x3_star\n        y3_star = p4 * x2_star / (p5 + x2_star)\n        y_star = np.array([y1_star, y2_star, y3_star])\n\n        S = np.zeros((3, 7))\n        for i in range(3):\n            if y_star[i] == 0:\n                # This should not happen for positive parameters\n                S[i, :] = 0.0\n            else:\n                for k in range(7):\n                    S[i, k] = (p[k] / y_star[i]) * dy_dp[i, k]\n                    \n        return S\n\n    # Test suite from the problem statement\n    test_cases: List[Tuple[float, ...]] = [\n        # Case A: Well-conditioned\n        (10.0, 2.0, 5.0, 1.0, 3.0, 1.0, 0.5),\n        # Case B: Ill-conditioned\n        (10.0, 1e-6, 5.0, 1e-6, 3.0, 1.0, 0.5),\n        # Case C: Potentially stiff/extreme values\n        (10.0, 2.0, 5.0, 1.0, 3.0, 1e-3, 100.0)\n    ]\n\n    results = []\n    for case_params in test_cases:\n        p_vec = np.array(case_params)\n        S_matrix = compute_sensitivity_matrix(p_vec)\n        results.append(S_matrix.tolist())\n\n    # Format the final output exactly as required\n    # Creates a string representation of a list of lists of lists.\n    # Ex: '[[[...],[...]], [[...],[...]]]'\n    formatted_results = str(results).replace(\"], [\", \"],\\n [\") # for readability, not required\n    formatted_results = str(results)\n\n    print(formatted_results)\n\nsolve()\n```"
        }
    ]
}