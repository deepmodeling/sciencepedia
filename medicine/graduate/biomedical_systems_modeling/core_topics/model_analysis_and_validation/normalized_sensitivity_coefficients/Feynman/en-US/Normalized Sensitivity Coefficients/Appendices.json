{
    "hands_on_practices": [
        {
            "introduction": "Understanding how a biological system's output responds to changes in an input is a cornerstone of systems modeling. This practice invites you to derive the normalized sensitivity coefficient for the classic Hill equation, a model central to pharmacology and biochemistry. By performing this analytical derivation  and examining the sensitivity at extreme concentrations, you will gain a concrete intuition for how a system can shift from being highly responsive to completely saturated.",
            "id": "3912165",
            "problem": "In a receptor-mediated pharmacodynamic model in biomedical systems modeling, the effect as a function of agonist concentration is often represented by a Hill-type input-output map. Consider the effect function $y(p)$ defined by\n$$\ny(p) \\;=\\; \\frac{E_{\\max}\\,p^{n}}{EC_{50}^{n} + p^{n}},\n$$\nwhere $p$ is the agonist concentration, $E_{\\max}$ is the maximal achievable effect, $EC_{50}$ is the half-maximal effective concentration (EC50), and $n$ is the Hill coefficient that reflects cooperativity of binding.\n\nStarting from the fundamental definition of the normalized (logarithmic) sensitivity coefficient $S^{p}_{y}$ with respect to $p$,\n$$\nS^{p}_{y} \\;=\\; \\frac{\\partial \\ln y}{\\partial \\ln p},\n$$\nderive a closed-form expression for $S^{p}_{y}$ in terms of $p$, $EC_{50}$, and $n$ for the given $y(p)$. Then determine the limits of $S^{p}_{y}$ as $p \\to 0$ and as $p \\to \\infty$, and interpret these limits in terms of how the effect responds to infinitesimal relative changes in concentration in the low-concentration and high-concentration regimes.\n\nProvide your final answer as a row matrix containing, in order: the expression for $S^{p}_{y}(p)$, the limit $\\lim_{p \\to 0} S^{p}_{y}(p)$, and the limit $\\lim_{p \\to \\infty} S^{p}_{y}(p)$. No numerical rounding is required, and no units are needed in the final answer.",
            "solution": "The user has provided a problem that requires the derivation of a normalized sensitivity coefficient for a Hill-type pharmacodynamic model and the analysis of its limiting behavior.\n\n### Step 1: Problem Validation\n\nFirst, I must validate the problem statement.\n\n**Givens Extracted Verbatim:**\n- Effect function: $y(p) \\;=\\; \\frac{E_{\\max}\\,p^{n}}{EC_{50}^{n} + p^{n}}$\n- $p$: agonist concentration\n- $E_{\\max}$: maximal achievable effect\n- $EC_{50}$: half-maximal effective concentration (EC50)\n- $n$: Hill coefficient\n- Definition of normalized (logarithmic) sensitivity coefficient: $S^{p}_{y} \\;=\\; \\frac{\\partial \\ln y}{\\partial \\ln p}$\n\n**Validation against Criteria:**\n1.  **Scientific or Factual Soundness**: The problem is scientifically sound. The Hill equation is a cornerstone of quantitative pharmacology and biochemistry, used to model dose-response relationships and cooperative binding. The definition of the normalized (or logarithmic) sensitivity coefficient is a standard and fundamental concept in sensitivity analysis, widely used in systems biology and engineering.\n2.  **Formalizability and Relevance**: The problem is mathematical in nature, requiring calculus to derive an expression and evaluate limits. It is directly relevant to the topic of *normalized sensitivity coefficients* within the field of *biomedical systems modeling*.\n3.  **Completeness and Consistency**: The problem is self-contained. It provides the function $y(p)$ and the definition of the sensitivity coefficient $S^{p}_{y}$, which are all that is needed for the derivation. There are no contradictions.\n4.  **Realism and Feasibility**: The model and parameters are standard in the field and do not represent any physically impossible or implausible conditions.\n5.  **Well-Posed and Structured**: The problem is well-posed. The function is differentiable for $p > 0$, and a unique, stable, and meaningful expression for the sensitivity can be derived. The limits are well-defined.\n6.  **Non-triviality**: The problem requires a correct application of calculus and an understanding of the concepts of sensitivity and limiting behavior in a biophysical context. It is not trivial or tautological.\n7.  **Verifiability**: The derivation and limit calculations are mathematically verifiable.\n\n**Verdict:**\nThe problem is valid. It is a standard exercise in a quantitative biology or bioengineering curriculum. I will proceed with the solution.\n\n### Step 2: Derivation and Analysis\n\nThe objective is to derive an expression for the normalized sensitivity coefficient $S^{p}_{y}$ of the effect $y$ with respect to the agonist concentration $p$, and to analyze its behavior at very low and very high concentrations.\n\nThe normalized sensitivity coefficient is defined as:\n$$\nS^{p}_{y} \\;=\\; \\frac{\\partial \\ln y}{\\partial \\ln p}\n$$\nThis expression can be rewritten using the chain rule of differentiation. Let $u = \\ln p$, so $p = \\exp(u)$ and $\\frac{dp}{du} = \\exp(u) = p$. Then,\n$$\nS^{p}_{y} = \\frac{\\partial (\\ln y)}{\\partial u} = \\frac{\\partial (\\ln y)}{\\partial p} \\frac{dp}{du} = p \\frac{\\partial (\\ln y)}{\\partial p}\n$$\nWe start by taking the natural logarithm of the effect function $y(p)$:\n$$\ny(p) = \\frac{E_{\\max}\\,p^{n}}{EC_{50}^{n} + p^{n}}\n$$\n$$\n\\ln y(p) = \\ln \\left( \\frac{E_{\\max}\\,p^{n}}{EC_{50}^{n} + p^{n}} \\right)\n$$\nUsing the properties of logarithms, we can expand this expression:\n$$\n\\ln y(p) = \\ln(E_{\\max}) + \\ln(p^{n}) - \\ln(EC_{50}^{n} + p^{n})\n$$\n$$\n\\ln y(p) = \\ln(E_{\\max}) + n \\ln(p) - \\ln(EC_{50}^{n} + p^{n})\n$$\nNow, we differentiate $\\ln y(p)$ with respect to $p$:\n$$\n\\frac{\\partial}{\\partial p} \\big( \\ln y(p) \\big) = \\frac{\\partial}{\\partial p} \\left( \\ln(E_{\\max}) + n \\ln(p) - \\ln(EC_{50}^{n} + p^{n}) \\right)\n$$\nThe derivative of the constant term $\\ln(E_{\\max})$ is $0$. The derivative of $n\\ln(p)$ is $\\frac{n}{p}$. For the last term, we use the chain rule:\n$$\n\\frac{\\partial}{\\partial p} \\big( \\ln y(p) \\big) = 0 + \\frac{n}{p} - \\frac{1}{EC_{50}^{n} + p^{n}} \\cdot \\frac{\\partial}{\\partial p} (EC_{50}^{n} + p^{n})\n$$\n$$\n\\frac{\\partial}{\\partial p} \\big( \\ln y(p) \\big) = \\frac{n}{p} - \\frac{n p^{n-1}}{EC_{50}^{n} + p^{n}}\n$$\nNow we can compute $S^{p}_{y}$ by multiplying this result by $p$:\n$$\nS^{p}_{y} = p \\left( \\frac{n}{p} - \\frac{n p^{n-1}}{EC_{50}^{n} + p^{n}} \\right)\n$$\nDistributing the $p$ inside the parentheses gives:\n$$\nS^{p}_{y} = n - \\frac{n p \\cdot p^{n-1}}{EC_{50}^{n} + p^{n}} = n - \\frac{n p^{n}}{EC_{50}^{n} + p^{n}}\n$$\nTo simplify this expression, we combine the terms over a common denominator:\n$$\nS^{p}_{y} = \\frac{n(EC_{50}^{n} + p^{n}) - n p^{n}}{EC_{50}^{n} + p^{n}} = \\frac{n EC_{50}^{n} + n p^{n} - n p^{n}}{EC_{50}^{n} + p^{n}}\n$$\nThis simplifies to the final closed-form expression for the normalized sensitivity:\n$$\nS^{p}_{y}(p) = \\frac{n EC_{50}^{n}}{EC_{50}^{n} + p^{n}}\n$$\n\nNext, we determine the limits of $S^{p}_{y}$ as $p \\to 0$ and as $p \\to \\infty$.\n\n**Limit as $p \\to 0$ (Low-Concentration Regime):**\n$$\n\\lim_{p \\to 0} S^{p}_{y}(p) = \\lim_{p \\to 0} \\frac{n EC_{50}^{n}}{EC_{50}^{n} + p^{n}}\n$$\nAs $p \\to 0$, the term $p^{n}$ also goes to $0$ (assuming $n > 0$, which is physically required for the Hill model).\n$$\n\\lim_{p \\to 0} S^{p}_{y}(p) = \\frac{n EC_{50}^{n}}{EC_{50}^{n} + 0} = \\frac{n EC_{50}^{n}}{EC_{50}^{n}} = n\n$$\n**Interpretation:** The normalized sensitivity $S^{p}_{y}$ quantifies the fractional change in effect $y$ for a given fractional change in concentration $p$, i.e., $\\frac{dy}{y} \\approx S^{p}_{y} \\frac{dp}{p}$. A value of $n$ means that at very low concentrations, a $1\\%$ increase in agonist concentration leads to an $n\\%$ increase in the effect. This corresponds to the initial steep portion of the dose-response curve, where the effect is highly responsive to changes in concentration. For $p \\ll EC_{50}$, $y(p) \\approx (E_{\\max}/EC_{50}^n) p^n$, a power-law relationship, for which a logarithmic sensitivity of $n$ is characteristic.\n\n**Limit as $p \\to \\infty$ (High-Concentration Regime):**\n$$\n\\lim_{p \\to \\infty} S^{p}_{y}(p) = \\lim_{p \\to \\infty} \\frac{n EC_{50}^{n}}{EC_{50}^{n} + p^{n}}\n$$\nAs $p \\to \\infty$, the $p^{n}$ term in the denominator dominates. To evaluate the limit formally, we can divide the numerator and the denominator by $p^{n}$:\n$$\n\\lim_{p \\to \\infty} S^{p}_{y}(p) = \\lim_{p \\to \\infty} \\frac{\\frac{n EC_{50}^{n}}{p^{n}}}{\\frac{EC_{50}^{n}}{p^{n}} + 1}\n$$\nAs $p \\to \\infty$, the term $\\frac{EC_{50}^{n}}{p^{n}}$ goes to $0$.\n$$\n\\lim_{p \\to \\infty} S^{p}_{y}(p) = \\frac{0}{0 + 1} = 0\n$$\n**Interpretation:** A sensitivity of $0$ means that at very high concentrations, changes in agonist concentration have a negligible effect on the response. This is the saturation regime, where the effect $y$ approaches its maximum value $E_{\\max}$. The system is insensitive to further increases in $p$ because the receptors are fully occupied. This corresponds to the flat plateau of the dose-response curve.\n\nThe three required results are the expression for $S^{p}_{y}(p)$, its limit as $p \\to 0$, and its limit as $p \\to \\infty$.\n1.  $S^{p}_{y}(p) = \\frac{n EC_{50}^{n}}{EC_{50}^{n} + p^{n}}$\n2.  $\\lim_{p \\to 0} S^{p}_{y}(p) = n$\n3.  $\\lim_{p \\to \\infty} S^{p}_{y}(p) = 0$\nThese will be presented in a row matrix as requested.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{n EC_{50}^{n}}{EC_{50}^{n} + p^{n}} & n & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Often in biomedical modeling, we are interested not just in an instantaneous measurement, but in a cumulative effect over time, such as a drug's total exposure quantified by the Area Under the Curve (AUC). This exercise  challenges you to extend the concept of sensitivity to such integrated outputs, requiring you to apply the Leibniz integral rule. The practice bridges the gap between purely analytical solutions and the powerful numerical methods, like sensitivity equations, that are essential for analyzing complex models without closed-form solutions.",
            "id": "3912162",
            "problem": "A biomedical system outputs a measurable signal $y(t;p)$ that depends on time $t$ and on a real, strictly positive model parameter $p$. The area under the curve (AUC) over a finite observation horizon is defined as $\\text{AUC} = \\int_{0}^{T} y(t;p)\\, dt$, where $T>0$ is independent of $p$. The normalized sensitivity coefficient of a scalar output $f(p)$ with respect to $p$ is defined as $S^{p}_{f} := \\frac{p}{f(p)} \\frac{\\partial f}{\\partial p}(p)$.\n\n1. Starting from these definitions and fundamental calculus facts about differentiating parameter-dependent integrals, derive a closed-form analytic expression for the normalized sensitivity coefficient $S^{p}_{\\text{AUC}}$ in terms of an integral of the parametric sensitivity $\\frac{\\partial y}{\\partial p}(t;p)$.\n\n2. Consider a scientifically realistic one-compartment intravenous bolus pharmacokinetic model, where the concentration $y(t;p)$ obeys the mass balance ordinary differential equation (ODE)\n$$\n\\frac{dy}{dt}(t;p) = -k(p)\\, y(t;p), \\quad y(0;p) = y_{0},\n$$\nwith a strictly positive baseline elimination rate constant $k_{0}$ and a strictly positive, dimensionless scaling parameter $p$ such that $k(p) = k_{0}\\, p$. For this model, evaluate the expression you derived in part 1 at the parameter values $y_{0} = 5$ mg/L, $k_{0} = 0.25$ h$^{-1}$, $T = 12$ h, and $p = 1.4$. Express your final answer as a dimensionless number and round your result to four significant figures.\n\n3. Briefly outline a scientifically sound strategy for numerically evaluating $S^{p}_{\\text{AUC}}$ when $y(t;p)$ is obtained by solving a nonlinear ODE without a closed-form solution, paying particular attention to how $\\frac{\\partial y}{\\partial p}(t;p)$ and the time integral can be computed with controlled error.",
            "solution": "This problem is divided into three parts. We will address each part sequentially after validating the problem statement. The problem defines a signal $y(t;p)$, its Area Under the Curve $\\text{AUC} = \\int_{0}^{T} y(t;p)\\, dt$, and the normalized sensitivity coefficient $S^{p}_{f} := \\frac{p}{f(p)} \\frac{\\partial f}{\\partial p}(p)$. The problem is scientifically sound, well-posed, and all provided definitions and values are consistent and standard in the field of biomedical systems modeling and pharmacokinetics. We may therefore proceed with the solution.\n\n1. Derivation of the expression for $S^{p}_{\\text{AUC}}$\n\nThe normalized sensitivity coefficient of the AUC with respect to the parameter $p$ is given by the definition:\n$$\nS^{p}_{\\text{AUC}} = \\frac{p}{\\text{AUC}(p)} \\frac{\\partial \\text{AUC}}{\\partial p}(p)\n$$\nThe AUC is defined as a parameter-dependent integral:\n$$\n\\text{AUC}(p) = \\int_{0}^{T} y(t;p)\\, dt\n$$\nTo find $\\frac{\\partial \\text{AUC}}{\\partial p}$, we must differentiate this integral with respect to $p$. Since the limits of integration, $0$ and $T$, are independent of $p$, we can apply the Leibniz integral rule (differentiation under the integral sign). This rule states that if $y(t;p)$ and its partial derivative $\\frac{\\partial y}{\\partial p}$ are continuous, then:\n$$\n\\frac{\\partial}{\\partial p} \\int_{a}^{b} y(t;p)\\, dt = \\int_{a}^{b} \\frac{\\partial y}{\\partial p}(t;p)\\, dt\n$$\nIn our case, $a=0$ and $b=T$. Applying this rule gives:\n$$\n\\frac{\\partial \\text{AUC}}{\\partial p} = \\frac{\\partial}{\\partial p} \\int_{0}^{T} y(t;p)\\, dt = \\int_{0}^{T} \\frac{\\partial y}{\\partial p}(t;p)\\, dt\n$$\nSubstituting the expressions for $\\text{AUC}(p)$ and $\\frac{\\partial \\text{AUC}}{\\partial p}$ back into the definition of $S^{p}_{\\text{AUC}}$, we obtain the desired closed-form expression:\n$$\nS^{p}_{\\text{AUC}} = \\frac{p}{\\int_{0}^{T} y(t;p)\\, dt} \\int_{0}^{T} \\frac{\\partial y}{\\partial p}(t;p)\\, dt\n$$\nThis expression relates the normalized sensitivity of the integral quantity (AUC) to the integrals of the state variable $y(t;p)$ and its parametric sensitivity $\\frac{\\partial y}{\\partial p}(t;p)$.\n\n2. Evaluation for a one-compartment pharmacokinetic model\n\nWe are given the one-compartment model described by the ordinary differential equation (ODE):\n$$\n\\frac{dy}{dt}(t;p) = -k(p)\\, y(t;p), \\quad y(0;p) = y_{0}\n$$\nwhere $k(p) = k_{0}p$. This is a first-order linear homogeneous ODE. Its solution is:\n$$\ny(t;p) = y_{0} \\exp(-k(p)t) = y_{0} \\exp(-k_{0}pt)\n$$\nFirst, we find the parametric sensitivity $\\frac{\\partial y}{\\partial p}(t;p)$ by differentiating the solution with respect to $p$:\n$$\n\\frac{\\partial y}{\\partial p}(t;p) = \\frac{\\partial}{\\partial p} \\left( y_{0} \\exp(-k_{0}pt) \\right) = y_{0} \\exp(-k_{0}pt) \\cdot (-k_{0}t) = -y_{0}k_{0}t\\exp(-k_{0}pt)\n$$\nNext, we evaluate the two integrals required for $S^{p}_{\\text{AUC}}$. The first integral is the AUC:\n$$\n\\int_{0}^{T} y(t;p)\\, dt = \\int_{0}^{T} y_{0}\\exp(-k_{0}pt)\\, dt = y_{0} \\left[ -\\frac{1}{k_{0}p} \\exp(-k_{0}pt) \\right]_{0}^{T} = \\frac{y_{0}}{k_{0}p} (1 - \\exp(-k_{0}pT))\n$$\nThe second integral is of the parametric sensitivity:\n$$\n\\int_{0}^{T} \\frac{\\partial y}{\\partial p}(t;p)\\, dt = \\int_{0}^{T} -y_{0}k_{0}t\\exp(-k_{0}pt)\\, dt = -y_{0}k_{0} \\int_{0}^{T} t\\exp(-k_{0}pt)\\, dt\n$$\nThis integral can be solved using integration by parts, $\\int u\\, dv = uv - \\int v\\, du$. Let $u=t$ and $dv = \\exp(-k_{0}pt)\\, dt$. Then $du=dt$ and $v = -\\frac{1}{k_{0}p}\\exp(-k_{0}pt)$.\n\\begin{align*}\n\\int_{0}^{T} t\\exp(-k_{0}pt)\\, dt &= \\left[ t \\left(-\\frac{1}{k_{0}p}\\exp(-k_{0}pt)\\right) \\right]_{0}^{T} - \\int_{0}^{T} \\left(-\\frac{1}{k_{0}p}\\exp(-k_{0}pt)\\right) dt \\\\\n&= -\\frac{T}{k_{0}p}\\exp(-k_{0}pT) + \\frac{1}{k_{0}p} \\int_{0}^{T} \\exp(-k_{0}pt)\\, dt \\\\\n&= -\\frac{T}{k_{0}p}\\exp(-k_{0}pT) + \\frac{1}{k_{0}p} \\left[ -\\frac{1}{k_{0}p}\\exp(-k_{0}pt) \\right]_{0}^{T} \\\\\n&= -\\frac{T}{k_{0}p}\\exp(-k_{0}pT) - \\frac{1}{(k_{0}p)^2} (\\exp(-k_{0}pT) - 1) \\\\\n&= \\frac{1 - \\exp(-k_{0}pT)}{(k_{0}p)^2} - \\frac{T}{k_{0}p}\\exp(-k_{0}pT)\n\\end{align*}\nTherefore, the second integral is:\n$$\n\\int_{0}^{T} \\frac{\\partial y}{\\partial p}(t;p)\\, dt = -y_{0}k_{0} \\left( \\frac{1 - \\exp(-k_{0}pT)}{(k_{0}p)^2} - \\frac{T}{k_{0}p}\\exp(-k_{0}pT) \\right) = -\\frac{y_{0}}{k_{0}p^2}(1 - \\exp(-k_{0}pT)) + \\frac{y_{0}T}{p}\\exp(-k_{0}pT)\n$$\nNow, we assemble the expression for $S^{p}_{\\text{AUC}}$:\n$$\nS^{p}_{\\text{AUC}} = \\frac{p}{\\frac{y_{0}}{k_{0}p} (1 - \\exp(-k_{0}pT))} \\left( -\\frac{y_{0}}{k_{0}p^2}(1 - \\exp(-k_{0}pT)) + \\frac{y_{0}T}{p}\\exp(-k_{0}pT) \\right)\n$$\nSimplifying by distributing the denominator term:\n$$\nS^{p}_{\\text{AUC}} = \\frac{k_{0}p^2}{y_{0}(1 - \\exp(-k_{0}pT))} \\left( -\\frac{y_{0}}{k_{0}p^2}(1 - \\exp(-k_{0}pT)) \\right) + \\frac{k_{0}p^2}{y_{0}(1 - \\exp(-k_{0}pT))} \\left( \\frac{y_{0}T}{p}\\exp(-k_{0}pT) \\right)\n$$\n$$\nS^{p}_{\\text{AUC}} = -1 + \\frac{k_{0}pT \\exp(-k_{0}pT)}{1 - \\exp(-k_{0}pT)}\n$$\nWe now substitute the given numerical values: $k_{0} = 0.25$ h$^{-1}$, $p = 1.4$, and $T = 12$ h. The initial condition $y_{0} = 5$ mg/L cancels out and is not needed for the final expression of the normalized sensitivity, reflecting a scale-invariance property.\nFirst, calculate the dimensionless argument $x = k_{0}pT$:\n$$\nx = (0.25) \\cdot (1.4) \\cdot (12) = 4.2\n$$\nNow, substitute $x=4.2$ into the simplified expression for $S^{p}_{\\text{AUC}}$:\n$$\nS^{p}_{\\text{AUC}} = -1 + \\frac{4.2 \\exp(-4.2)}{1 - \\exp(-4.2)}\n$$\nUsing a calculator, $\\exp(-4.2) \\approx 0.0149955765$.\n$$\nS^{p}_{\\text{AUC}} \\approx -1 + \\frac{4.2 \\cdot 0.0149955765}{1 - 0.0149955765} = -1 + \\frac{0.0629814213}{0.9850044235} \\approx -1 + 0.063940245\n$$\n$$\nS^{p}_{\\text{AUC}} \\approx -0.936059755\n$$\nRounding to four significant figures, the result is $-0.9361$.\n\n3. Numerical strategy for nonlinear ODEs\n\nWhen $y(t;p)$ is obtained by numerically solving a nonlinear ODE system $\\frac{dy}{dt} = g(t, y, p)$ for which no closed-form solution exists, the evaluation of $S^{p}_{\\text{AUC}}$ requires a purely numerical approach. A scientifically sound and robust strategy involves the method of sensitivity equations integrated simultaneously with the original system.\n\nFirst, to compute the parametric sensitivity $z(t;p) = \\frac{\\partial y}{\\partial p}(t;p)$ with controlled error, one derives the sensitivity ODE by differentiating the original ODE with respect to $p$:\n$$\n\\frac{dz}{dt} = \\frac{d}{dt}\\left(\\frac{\\partial y}{\\partial p}\\right) = \\frac{\\partial}{\\partial p}\\left(\\frac{dy}{dt}\\right) = \\frac{\\partial}{\\partial p}g(t, y, p)\n$$\nBy the chain rule, this becomes:\n$$\n\\frac{dz}{dt} = \\frac{\\partial g}{\\partial y}(t,y,p) \\cdot z + \\frac{\\partial g}{\\partial p}(t,y,p)\n$$\nThe initial condition is $z(0) = \\frac{\\partial y(0;p)}{\\partial p}$. The partial derivatives $\\frac{\\partial g}{\\partial y}$ (the system Jacobian) and $\\frac{\\partial g}{\\partial p}$ must be supplied.\n\nSecond, to compute the time integrals $\\int_{0}^{T} y(t;p)\\, dt$ and $\\int_{0}^{T} z(t;p)\\, dt$ with controlled error, we augment the state vector further. Define two new state variables, $I_y(t) = \\int_0^t y(\\tau;p) d\\tau$ and $I_z(t) = \\int_0^t z(\\tau;p) d\\tau$. Their dynamics are simply:\n$$\n\\frac{dI_y}{dt} = y(t;p) \\quad \\text{and} \\quad \\frac{dI_z}{dt} = z(t;p)\n$$\nwith initial conditions $I_y(0)=0$ and $I_z(0)=0$.\n\nThe complete, augmented ODE system to be solved is:\n$$\n\\begin{cases}\n\\frac{dy}{dt} = g(t, y, p) \\\\\n\\frac{dz}{dt} = \\frac{\\partial g}{\\partial y} z + \\frac{\\partial g}{\\partial p} \\\\\n\\frac{dI_y}{dt} = y \\\\\n\\frac{dI_z}{dt} = z\n\\end{cases}\n$$\nThis larger system is then solved numerically from $t=0$ to $t=T$ using a single call to a high-quality, adaptive step-size ODE solver (e.g., a Runge-Kutta or backward differentiation formula method). By setting a desired error tolerance for the solver, the error in all computed states, including the final values of the integrals\n$I_y(T)$ and $I_z(T)$, is controlled simultaneously.\n\nFinally, the normalized sensitivity is computed from the results of the integration at $t=T$:\n$$\nS^{p}_{\\text{AUC}} = \\frac{p \\cdot I_z(T)}{I_y(T)}\n$$\nThis integrated approach is highly efficient and accurate as it leverages the error control mechanism of the ODE solver for a unified computation of both the state/sensitivity trajectories and their integrals.",
            "answer": "$$\\boxed{-0.9361}$$"
        },
        {
            "introduction": "Real-world biological systems are typically complex networks whose steady-state behavior is of critical interest. This computational practice  guides you through the process of performing a steady-state sensitivity analysis for a multi-component ODE model. You will learn to formulate the problem as a linear system involving Jacobian matrices and, importantly, to address the practical challenge of numerical instability using robust methods like Tikhonov regularization, a vital skill for any serious modeler.",
            "id": "3912151",
            "problem": "Consider a deterministic, coarse-grained biochemical regulation model written as a system of ordinary differential equations (ODEs) for three state variables, $x = (x_1, x_2, x_3)$, which represent messenger ribonucleic acid ($x_1$), protein concentration ($x_2$), and activated protein ($x_3$). The system depends on seven positive parameters $p = (p_0, p_1, p_2, p_3, p_4, p_5, p_6)$ and is given by\n$$\n\\frac{dx_1}{dt} = p_0 - p_1 x_1,\n\\quad\n\\frac{dx_2}{dt} = p_2 x_1 - p_3 x_2,\n\\quad\n\\frac{dx_3}{dt} = \\frac{p_4 x_2}{p_5 + x_2} - p_6 x_3.\n$$\nAssume a steady state $x^{*}(p)$ exists for each parameter vector $p$, defined by $f(x^{*},p) = 0$ where $f(x,p)$ denotes the right-hand side of the ODE. Define three outputs of interest $y = (y_1,y_2,y_3)$ at steady state by\n$$\ny_1 = x_2^{*},\n\\quad\ny_2 = x_3^{*},\n\\quad\ny_3 = \\frac{p_4 x_2^{*}}{p_5 + x_2^{*}},\n$$\nwhere $x^{*} = (x_1^{*}, x_2^{*}, x_3^{*})$ are the steady-state values. The normalized sensitivity coefficient of an output $y_i$ with respect to a parameter $p_k$ at steady state is defined by\n$$\nS_{i,k} = \\frac{p_k}{y_i} \\frac{\\partial y_i}{\\partial p_k},\n$$\nwhich is dimensionless. Your task is to compute the full matrix of steady-state normalized sensitivity coefficients $S \\in \\mathbb{R}^{3 \\times 7}$ for the outputs $y$ with respect to the parameters $p$, using a method that arises from first principles: begin from the definition of steady state $f(x^{*},p)=0$, treat $x^{*}$ as an implicit function of $p$, and use appropriate Jacobian matrices evaluated at $x^{*}$ to set up and solve a linear system for the steady-state state sensitivities. Then use the chain rule to map state sensitivities to output sensitivities and apply the normalization above.\n\nNumerical conditioning must be explicitly addressed. Specifically, when the Jacobian of $f$ with respect to $x$ evaluated at $x^{*}$, denoted $J_x(x^{*},p)$, is ill-conditioned (in the $2$-norm sense with a large condition number), you must avoid unstable solves. In such cases, use a numerically stabilizing approach based on Singular Value Decomposition (SVD) and a small Tikhonov regularization scaled to the matrix norm to solve the linear system that yields the state sensitivities. When $J_x(x^{*},p)$ is well-conditioned, a direct linear solver is acceptable.\n\nFor this model, to ensure scientific realism and reproducibility, you must compute the steady state analytically before evaluating Jacobians. The steady state values are determined by algebraic balance of production and degradation in each equation, yielding\n$$\nx_1^{*} = \\frac{p_0}{p_1}, \n\\quad\nx_2^{*} = \\frac{p_2}{p_3} x_1^{*},\n\\quad\nx_3^{*} = \\frac{p_4}{p_6} \\frac{x_2^{*}}{p_5 + x_2^{*}},\n$$\nfor every parameter vector $p$ with positive entries.\n\nYour program must implement the following steps for each parameter vector $p$ in the test suite:\n- Compute $x^{*}(p)$ using the algebraic expressions above.\n- Evaluate the Jacobian matrices $J_x(x^{*},p)$ and $J_p(x^{*},p)$, where $J_x$ is the matrix of partial derivatives of $f$ with respect to $x$, and $J_p$ is the matrix of partial derivatives of $f$ with respect to $p$.\n- For each parameter $p_k$, solve the linear system implied by the sensitivity analysis at steady state to obtain $\\frac{\\partial x^{*}}{\\partial p_k}$, using a numerically stable method as required by the conditioning of $J_x(x^{*},p)$.\n- Compute $\\frac{\\partial y}{\\partial p_k}$ via the chain rule at steady state using the Jacobian of $y$ with respect to $x$ and with respect to $p$.\n- Compute $S_{i,k}$ using the normalization above.\n\nThe final outputs $S_{i,k}$ are pure numbers without physical units. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one parameter vector from the test suite and is itself a list-of-lists representing the $3 \\times 7$ matrix of normalized sensitivities arranged by output rows. For example, an output of the correct shape should look like\n$$\n[[\\text{row}_1], [\\text{row}_2], [\\text{row}_3]]\n$$\nfor each parameter set, and the entire line should be\n$$\n[[\\dots],[\\dots],[\\dots]].\n$$\n\nTest suite (three parameter sets):\n- Case A (general well-conditioned): $p = (10.0, 2.0, 5.0, 1.0, 3.0, 1.0, 0.5)$.\n- Case B (ill-conditioning with slow degradation): $p = (10.0, 10^{-6}, 5.0, 10^{-6}, 3.0, 1.0, 0.5)$.\n- Case C (small activation constant and fast deactivation): $p = (10.0, 2.0, 5.0, 1.0, 3.0, 10^{-3}, 100.0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the form\n$$\n[\\,[S^{(A)}],\\,[S^{(B)}],\\,[S^{(C)}]\\,],\n$$\nwhere each $[S^{(\\cdot)}]$ is represented as a list of three rows, each row containing seven floating-point numbers.",
            "solution": "The user-provided problem has been analyzed and is determined to be valid. It is scientifically grounded, well-posed, and objective. The problem describes a standard biochemical model and requests the calculation of normalized sensitivity coefficients, a well-defined task in systems biology and control theory. The instructions are complete, consistent, and require a formal mathematical procedure involving implicit differentiation and linear algebra, with specific instructions for handling numerical conditioning. All required data and definitions are provided.\n\nThe problem requires the computation of the normalized sensitivity matrix $S \\in \\mathbb{R}^{3 \\times 7}$ for a system of three outputs $y_i$ with respect to seven parameters $p_k$. The sensitivity is defined at steady state $x^*$ as:\n$$\nS_{i,k} = \\frac{p_k}{y_i} \\frac{\\partial y_i}{\\partial p_k}\n$$\nThe core of the method relies on the implicit function theorem applied to the steady-state condition $f(x^*(p), p) = 0$.\n\n**Step 1: Steady-State Analysis**\nThe system of ordinary differential equations (ODEs) is given by:\n$$\nf(x, p) = \\begin{pmatrix} f_1 \\\\ f_2 \\\\ f_3 \\end{pmatrix} = \\begin{pmatrix} p_0 - p_1 x_1 \\\\ p_2 x_1 - p_3 x_2 \\\\ \\frac{p_4 x_2}{p_5 + x_2} - p_6 x_3 \\end{pmatrix}\n$$\nAt steady state, $f(x^*, p) = 0$. The problem provides the analytical solution for the steady-state vector $x^* = (x_1^*, x_2^*, x_3^*)$:\n$$\nx_1^{*} = \\frac{p_0}{p_1}, \\quad x_2^{*} = \\frac{p_2}{p_3} x_1^{*} = \\frac{p_0 p_2}{p_1 p_3}, \\quad x_3^{*} = \\frac{1}{p_6} \\frac{p_4 x_2^{*}}{p_5 + x_2^{*}}\n$$\nThese expressions are used to compute the specific steady-state point for each given parameter vector $p$.\n\n**Step 2: Derivation of State Sensitivities**\nWe treat the steady-state solution $x^*$ as an implicit function of the parameters $p$. Taking the total derivative of the steady-state condition $f(x^*(p), p) = 0$ with respect to a parameter $p_k$ yields:\n$$\n\\frac{d}{dp_k} f(x^*(p), p) = \\frac{\\partial f}{\\partial x} \\frac{\\partial x^*}{\\partial p_k} + \\frac{\\partial f}{\\partial p_k} = 0\n$$\nwhere $\\frac{\\partial f}{\\partial x}$ is the Jacobian matrix of $f$ with respect to $x$, denoted $J_x$, and $\\frac{\\partial x^*}{\\partial p_k}$ is the vector of state sensitivities with respect to $p_k$. Rearranging this equation gives a linear system for the state sensitivities:\n$$\nJ_x(x^*, p) \\frac{\\partial x^*}{\\partial p_k} = - \\frac{\\partial f}{\\partial p_k}\n$$\nThis system must be solved for each parameter $p_k$, where $k=0, 1, \\dots, 6$.\n\nFirst, we compute the Jacobian matrix $J_x = \\frac{\\partial f}{\\partial x}$ and evaluate it at the steady state $x^*$:\n$$\nJ_x(x^*, p) = \\begin{pmatrix}\n-p_1 & 0 & 0 \\\\\np_2 & -p_3 & 0 \\\\\n0 & \\frac{p_4 p_5}{(p_5 + x_2^*)^2} & -p_6\n\\end{pmatrix}\n$$\nThis is a lower triangular matrix, which simplifies the solution of the linear system.\n\nNext, we compute the vectors $\\frac{\\partial f}{\\partial p_k}$ for each $k$:\n$$\n\\frac{\\partial f}{\\partial p_0} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad\n\\frac{\\partial f}{\\partial p_1} = \\begin{pmatrix} -x_1^* \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad\n\\frac{\\partial f}{\\partial p_2} = \\begin{pmatrix} 0 \\\\ x_1^* \\\\ 0 \\end{pmatrix}, \\quad\n\\frac{\\partial f}{\\partial p_3} = \\begin{pmatrix} 0 \\\\ -x_2^* \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\frac{\\partial f}{\\partial p_4} = \\begin{pmatrix} 0 \\\\ 0 \\\\ \\frac{x_2^*}{p_5 + x_2^*} \\end{pmatrix}, \\quad\n\\frac{\\partial f}{\\partial p_5} = \\begin{pmatrix} 0 \\\\ 0 \\\\ -\\frac{p_4 x_2^*}{(p_5 + x_2^*)^2} \\end{pmatrix}, \\quad\n\\frac{\\partial f}{\\partial p_6} = \\begin{pmatrix} 0 \\\\ 0 \\\\ -x_3^* \\end{pmatrix}\n$$\n\n**Step 3: Solving the Linear System for State Sensitivities**\nFor each $k \\in \\{0, \\dots, 6\\}$, we solve the system $J_x z_k = b_k$, where $z_k = \\frac{\\partial x^*}{\\partial p_k}$ and $b_k = -\\frac{\\partial f}{\\partial p_k}$. The problem requires a numerically stable approach based on the condition number of $J_x$.\nThe condition number (in the $2$-norm) is calculated as $\\text{cond}(J_x) = \\|J_x\\|_2 \\|J_x^{-1}\\|_2$. If $\\text{cond}(J_x)$ is large, indicating ill-conditioning, a regularized solution is required. We use Tikhonov regularization, which solves $(J_x^T J_x + \\alpha I) z_k = J_x^T b_k$. A numerically robust way to compute this is via Singular Value Decomposition (SVD). Let $J_x = U \\Sigma V^T$. The regularized solution is:\n$$\nz_k = V (\\Sigma^2 + \\alpha I)^{-1} \\Sigma^T U^T b_k = \\sum_{j=1}^{3} \\frac{\\sigma_j}{\\sigma_j^2 + \\alpha} (u_j^T b_k) v_j\n$$\nwhere $\\sigma_j$ are the singular values, and $u_j, v_j$ are the columns of $U$ and $V$. The regularization parameter $\\alpha$ is chosen as a small value scaled by the matrix norm, e.g., $\\alpha = \\epsilon \\sigma_1$ with a small $\\epsilon$, like $10^{-8}$. If $J_x$ is well-conditioned, a standard linear solver is sufficient.\n\n**Step 4: Calculation of Output Sensitivities**\nThe outputs $y$ are functions of the state $x^*$ and parameters $p$: $y = g(x^*, p)$.\n$$\ny_1 = x_2^*, \\quad y_2 = x_3^*, \\quad y_3 = \\frac{p_4 x_2^*}{p_5 + x_2^*}\n$$\nUsing the chain rule, the sensitivity of the output vector $y$ to a parameter $p_k$ is:\n$$\n\\frac{\\partial y}{\\partial p_k} = \\frac{\\partial g}{\\partial x} \\frac{\\partial x^*}{\\partial p_k} + \\frac{\\partial g}{\\partial p_k}\n$$\nWe compute the Jacobian of $g$ with respect to $x$, $J_{g,x}$, and the partial derivatives of $g$ with respect to $p$, $J_{g,p}$.\n$$\nJ_{g,x} = \\frac{\\partial g}{\\partial x} = \\begin{pmatrix}\n0 & 1 & 0 \\\\\n0 & 0 & 1 \\\\\n0 & \\frac{p_4 p_5}{(p_5 + x_2^*)^2} & 0\n\\end{pmatrix}\n$$\nThe partial derivatives $\\frac{\\partial g}{\\partial p_k}$ are non-zero only for $y_3$ with respect to $p_4$ and $p_5$:\n$$\n\\frac{\\partial g}{\\partial p_4} = \\begin{pmatrix} 0 \\\\ 0 \\\\ \\frac{x_2^*}{p_5 + x_2^*} \\end{pmatrix}, \\quad\n\\frac{\\partial g}{\\partial p_5} = \\begin{pmatrix} 0 \\\\ 0 \\\\ -\\frac{p_4 x_2^*}{(p_5 + x_2^*)^2} \\end{pmatrix}\n$$\nFor all other $k$, $\\frac{\\partial g}{\\partial p_k}$ is a zero vector. The matrix of unnormalized output sensitivities, $\\frac{\\partial y}{\\partial p}$, is computed as $J_{g,x} \\left(\\frac{\\partial x^*}{\\partial p}\\right) + J_{g,p}$, where $\\frac{\\partial x^*}{\\partial p}$ is the $3 \\times 7$ matrix of state sensitivities.\n\n**Step 5: Normalization**\nFinally, the normalized sensitivity matrix $S$ is computed element-wise. For each output $y_i$ and parameter $p_k$:\n$$\nS_{i,k} = \\frac{p_k}{y_i^*} \\left(\\frac{\\partial y}{\\partial p}\\right)_{i,k}\n$$\nwhere $y_i^*$ are the steady-state output values:\n$$\ny_1^* = x_2^*, \\quad y_2^* = x_3^*, \\quad y_3^* = \\frac{p_4 x_2^*}{p_5 + x_2^*} = p_6 x_3^*\n$$\nSince all parameters $p_j$ are positive, the steady-state values $x_i^*$ and $y_i^*$ are also positive, preventing division by zero. The resulting $3 \\times 7$ matrix $S$ is computed for each test case.",
            "answer": "```python\nimport numpy as np\nfrom typing import List, Tuple\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the sensitivity analysis for the given test cases.\n    \"\"\"\n\n    def compute_sensitivity_matrix(p: np.ndarray) -> np.ndarray:\n        \"\"\"\n        Computes the 3x7 normalized sensitivity matrix S for a given parameter vector p.\n        \n        Args:\n            p: A 1D numpy array of 7 parameters (p0, ..., p6).\n\n        Returns:\n            A 2D numpy array (3x7) representing the matrix S.\n        \"\"\"\n        p0, p1, p2, p3, p4, p5, p6 = p\n\n        # Step 1: Compute steady state x_star\n        if p1 == 0 or p3 == 0:\n            # Avoid division by zero, though problem statement guarantees positive params\n            raise ValueError(\"Parameters p1 and p3 must be non-zero.\")\n        \n        x1_star = p0 / p1\n        x2_star = (p2 / p3) * x1_star\n        \n        if p6 == 0 or (p5 + x2_star) == 0:\n            raise ValueError(\"Parameters p6 and (p5 + x2_star) must be non-zero.\")\n        \n        x3_star = (p4 / p6) * x2_star / (p5 + x2_star)\n        x_star = np.array([x1_star, x2_star, x3_star])\n\n        # Step 2: Assemble Jacobian J_x(x_star, p)\n        Jx_f = np.zeros((3, 3))\n        Jx_f[0, 0] = -p1\n        Jx_f[1, 0] = p2\n        Jx_f[1, 1] = -p3\n        Jx_f[2, 1] = (p4 * p5) / ((p5 + x2_star)**2)\n        Jx_f[2, 2] = -p6\n\n        # Step 3: Solve for state sensitivities dx*/dp_k\n        dx_dp = np.zeros((3, 7))\n        \n        # Calculate condition number to decide on solver\n        cond_Jx = np.linalg.cond(Jx_f)\n        ILL_CONDITIONED_THRESHOLD = 1e12\n\n        for k in range(7):\n            # Form the right-hand side vector b_k = -df/dp_k\n            b_k = np.zeros(3)\n            if k == 0:  # p0\n                b_k[0] = -1.0\n            elif k == 1:  # p1\n                b_k[0] = x1_star\n            elif k == 2:  # p2\n                b_k[1] = -x1_star\n            elif k == 3:  # p3\n                b_k[1] = x2_star\n            elif k == 4:  # p4\n                b_k[2] = -x2_star / (p5 + x2_star)\n            elif k == 5:  # p5\n                b_k[2] = p4 * x2_star / ((p5 + x2_star)**2)\n            elif k == 6:  # p6\n                b_k[2] = x3_star\n            \n            # Solve the linear system\n            if cond_Jx > ILL_CONDITIONED_THRESHOLD:\n                # Use SVD with Tikhonov regularization for ill-conditioned system\n                U, s, Vh = np.linalg.svd(Jx_f)\n                # Regularization parameter alpha, scaled by the largest singular value\n                alpha = 1e-8 * s[0]\n                s_reg = s / (s**2 + alpha)\n                # Reconstruct z_k = V * diag(s_reg) * U.T * b_k\n                z_k = Vh.T @ (np.diag(s_reg) @ (U.T @ b_k))\n            else:\n                # Use standard direct solver for well-conditioned system\n                z_k = np.linalg.solve(Jx_f, b_k)\n            \n            dx_dp[:, k] = z_k\n\n        # Step 4: Compute output sensitivities dy/dp\n        # y = g(x*, p), dy/dp = (dg/dx)*(dx*/dp) + (dg/dp)\n        \n        # Jacobian dg/dx evaluated at x_star\n        Jg_x = np.zeros((3, 3))\n        Jg_x[0, 1] = 1.0\n        Jg_x[1, 2] = 1.0\n        Jg_x[2, 1] = (p4 * p5) / ((p5 + x2_star)**2)\n        \n        # Partial derivatives dg/dp\n        Jg_p = np.zeros((3, 7))\n        Jg_p[2, 4] = x2_star / (p5 + x2_star)\n        Jg_p[2, 5] = -p4 * x2_star / ((p5 + x2_star)**2)\n\n        # Matrix of un-normalized output sensitivities\n        dy_dp = Jg_x @ dx_dp + Jg_p\n        \n        # Step 5: Normalization\n        # Compute steady-state outputs y_star\n        y1_star = x2_star\n        y2_star = x3_star\n        y3_star = p4 * x2_star / (p5 + x2_star)\n        y_star = np.array([y1_star, y2_star, y3_star])\n\n        S = np.zeros((3, 7))\n        for i in range(3):\n            if y_star[i] == 0:\n                # This should not happen for positive parameters\n                S[i, :] = 0.0\n            else:\n                for k in range(7):\n                    S[i, k] = (p[k] / y_star[i]) * dy_dp[i, k]\n                    \n        return S\n\n    # Test suite from the problem statement\n    test_cases: List[Tuple[float, ...]] = [\n        # Case A: Well-conditioned\n        (10.0, 2.0, 5.0, 1.0, 3.0, 1.0, 0.5),\n        # Case B: Ill-conditioned\n        (10.0, 1e-6, 5.0, 1e-6, 3.0, 1.0, 0.5),\n        # Case C: Potentially stiff/extreme values\n        (10.0, 2.0, 5.0, 1.0, 3.0, 1e-3, 100.0)\n    ]\n\n    results = []\n    for case_params in test_cases:\n        p_vec = np.array(case_params)\n        S_matrix = compute_sensitivity_matrix(p_vec)\n        results.append(S_matrix.tolist())\n\n    # Format the final output exactly as required\n    # Creates a string representation of a list of lists of lists.\n    # Ex: '[[[...],[...]], [[...],[...]]]'\n    formatted_results = str(results).replace(\"], [\", \"],\\n [\") # for readability, not required\n    formatted_results = str(results)\n\n    print(formatted_results)\n\nsolve()\n```"
        }
    ]
}