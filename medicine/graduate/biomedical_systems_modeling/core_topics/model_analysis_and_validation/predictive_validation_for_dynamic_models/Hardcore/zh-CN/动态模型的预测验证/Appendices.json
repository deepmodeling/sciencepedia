{
    "hands_on_practices": [
        {
            "introduction": "在构建动态预测模型时，一个最基本也最容易被忽视的错误是“数据泄漏”，即在模型训练或评估中无意中使用了未来的信息。这种错误会产生具有误导性的、过于乐观的性能评估，从而导致模型在实际部署中表现不佳。本练习通过一个简化的动态生物标志物模型，从第一性原理出发，推导并量化这种泄漏所引入的偏差，从而加深你对遵守严格时间顺序的验证协议（如滚动原点验证）重要性的理解。",
            "id": "3921440",
            "problem": "考虑一个动态生物医学系统，其中一个潜在的生物标志物过程在离散时间中演化。令 $X_t$ 表示时间点 $t$ 的生物标志物，令 $Y_{t+1}$ 为下一个时间点的相关临床结局。该生物标志物遵循一个一阶自回归过程，\n$$\nX_{t+1} = \\phi X_t + \\eta_{t+1},\n$$\n其中 $\\eta_{t+1}$ 是一个均值为零、方差为 $\\sigma_{\\eta}^{2}$ 的新息，并且独立于 $X_t$。临床结局根据以下公式生成：\n$$\nY_{t+1} = \\beta X_{t+1} + \\epsilon_{t+1},\n$$\n其中 $\\epsilon_{t+1}$ 是均值为零、方差为 $\\sigma_{\\epsilon}^{2}$ 的噪声，且独立于 $X_t$ 和 $\\eta_{t+1}$。在预测时间点 $t$，模型可用的真实信息集为 $\\mathcal{I}_t = \\{X_t\\}$。\n\n假设一名从业者错误地使用了通过未来协变量（一种数据泄露）工程化的特征，具体来说就是使用了未来的生物标志物 $X_{t+1}$ 本身，来评估在均方误差下的预测性能。也就是说，他们使用信息集 $\\mathcal{I}_{t+1}^{\\mathrm{leak}} = \\{X_{t+1}\\}$ 来评估模型，而该信息集在实际部署的时间点 $t$ 是不可用的。假设模型在平方损失下是最优构建的，即它们能够达到给定可用特征下结局的条件期望。\n\n仅使用平方损失下的条件期望和方差的基本定义，以及所述的独立性关系，推导因此次泄露导致的估计均方误差偏差的闭式解析表达式，该偏差定义为：\n$$\n\\mathrm{Bias} = \\mathbb{E}\\!\\left[\\mathrm{MSE}_{\\mathrm{leak}}\\right] - \\mathbb{E}\\!\\left[\\mathrm{MSE}_{\\mathrm{deploy}}\\right],\n$$\n其中 $\\mathrm{MSE}_{\\mathrm{leak}}$ 是使用 $\\mathcal{I}_{t+1}^{\\mathrm{leak}} = \\{X_{t+1}\\}$ 进行评估时的均方误差，而 $\\mathrm{MSE}_{\\mathrm{deploy}}$ 是在时间点 $t$ 仅使用 $\\mathcal{I}_t = \\{X_t\\}$ 进行预测时的均方误差。最终答案需用包含 $\\beta$ 和 $\\sigma_{\\eta}^{2}$ 的符号表达式表示。无需四舍五入，也无需物理单位。\n\n最后，请提出一种科学合理的预测验证设计，以在动态生物医学建模中避免此类泄露，确保训练、特征工程和评估都尊重按时间索引的数据可用性。",
            "solution": "该问题要求推导当未来信息泄露到动态生物医学模型的特征集中时，均方误差估计中产生的偏差。该偏差定义为存在泄露时的期望均方误差（MSE）与正常部署场景下期望均方误差之间的差值。我们将首先推导两种期望MSE的表达式，然后计算它们的差值。最后，将描述一种恰当的验证方案。\n\n该系统由两个方程定义：\n生物标志物过程：$X_{t+1} = \\phi X_t + \\eta_{t+1}$，其中 $\\mathbb{E}[\\eta_{t+1}] = 0$ 且 $\\mathrm{Var}(\\eta_{t+1}) = \\sigma_{\\eta}^{2}$。\n结局过程：$Y_{t+1} = \\beta X_{t+1} + \\epsilon_{t+1}$，其中 $\\mathbb{E}[\\epsilon_{t+1}] = 0$ 且 $\\mathrm{Var}(\\epsilon_{t+1}) = \\sigma_{\\epsilon}^{2}$。\n随机变量 $\\eta_{t+1}$ 和 $\\epsilon_{t+1}$ 相互独立，并且也独立于 $X_t$。\n\n问题陈述，模型在平方损失下是最优的，这意味着预测值是给定可用信息下结局的条件期望。\n\n首先，我们计算数据泄露情况下的期望MSE，即 $\\mathbb{E}[\\mathrm{MSE}_{\\mathrm{leak}}]$。\n在这种情况下，从业者错误地使用了信息集 $\\mathcal{I}_{t+1}^{\\mathrm{leak}} = \\{X_{t+1}\\}$。最优预测器为 $\\hat{Y}_{t+1}^{\\mathrm{leak}} = \\mathbb{E}[Y_{t+1} | X_{t+1}]$。\n我们代入 $Y_{t+1}$ 的定义：\n$$\n\\hat{Y}_{t+1}^{\\mathrm{leak}} = \\mathbb{E}[\\beta X_{t+1} + \\epsilon_{t+1} | X_{t+1}]\n$$\n根据条件期望的线性性质：\n$$\n\\hat{Y}_{t+1}^{\\mathrm{leak}} = \\mathbb{E}[\\beta X_{t+1} | X_{t+1}] + \\mathbb{E}[\\epsilon_{t+1} | X_{t+1}]\n$$\n由于 $X_{t+1}$ 在条件集中是给定的，$\\mathbb{E}[\\beta X_{t+1} | X_{t+1}] = \\beta X_{t+1}$。\n噪声项 $\\epsilon_{t+1}$ 独立于 $X_t$ 和 $\\eta_{t+1}$，因此也独立于 $X_{t+1} = \\phi X_t + \\eta_{t+1}$。因此，以 $X_{t+1}$ 为条件不改变 $\\epsilon_{t+1}$ 的期望：\n$$\n\\mathbb{E}[\\epsilon_{t+1} | X_{t+1}] = \\mathbb{E}[\\epsilon_{t+1}] = 0\n$$\n所以，带有泄露信息的预测器是 $\\hat{Y}_{t+1}^{\\mathrm{leak}} = \\beta X_{t+1}$。\n\n在这种情况下，均方误差为 $\\mathrm{MSE}_{\\mathrm{leak}} = (Y_{t+1} - \\hat{Y}_{t+1}^{\\mathrm{leak}})^2$。其期望为：\n$$\n\\mathbb{E}[\\mathrm{MSE}_{\\mathrm{leak}}] = \\mathbb{E}\\left[\\left( (\\beta X_{t+1} + \\epsilon_{t+1}) - \\beta X_{t+1} \\right)^2\\right] = \\mathbb{E}[\\epsilon_{t+1}^2]\n$$\n由于 $\\epsilon_{t+1}$ 的均值为0，其平方的期望等于其方差：\n$$\n\\mathbb{E}[\\mathrm{MSE}_{\\mathrm{leak}}] = \\mathrm{Var}(\\epsilon_{t+1}) = \\sigma_{\\epsilon}^{2}\n$$\n这个结果很直观：如果未来的生物标志物 $X_{t+1}$ 已知，唯一的预测误差来源是不可约的噪声 $\\epsilon_{t+1}$。\n\n接下来，我们计算正常部署场景下的期望MSE，即 $\\mathbb{E}[\\mathrm{MSE}_{\\mathrm{deploy}}]$。\n在时间点 $t$ 的部署中，可用信息被正确指定为 $\\mathcal{I}_t = \\{X_t\\}$。最优预测器是 $\\hat{Y}_{t+1}^{\\mathrm{deploy}} = \\mathbb{E}[Y_{t+1} | X_t]$。\n我们代入 $Y_{t+1}$ 和 $X_{t+1}$ 的表达式：\n$$\n\\hat{Y}_{t+1}^{\\mathrm{deploy}} = \\mathbb{E}[\\beta X_{t+1} + \\epsilon_{t+1} | X_t] = \\mathbb{E}[\\beta(\\phi X_t + \\eta_{t+1}) + \\epsilon_{t+1} | X_t]\n$$\n使用期望的线性性质并分配条件：\n$$\n\\hat{Y}_{t+1}^{\\mathrm{deploy}} = \\mathbb{E}[\\beta \\phi X_t | X_t] + \\mathbb{E}[\\beta \\eta_{t+1} | X_t] + \\mathbb{E}[\\epsilon_{t+1} | X_t]\n$$\n由于 $X_t$ 在条件集中是给定的，$\\mathbb{E}[\\beta \\phi X_t | X_t] = \\beta \\phi X_t$。\n新息 $\\eta_{t+1}$ 独立于 $X_t$，所以 $\\mathbb{E}[\\beta \\eta_{t+1} | X_t] = \\beta \\mathbb{E}[\\eta_{t+1}] = \\beta \\cdot 0 = 0$。\n噪声 $\\epsilon_{t+1}$ 也独立于 $X_t$，所以 $\\mathbb{E}[\\epsilon_{t+1} | X_t] = \\mathbb{E}[\\epsilon_{t+1}] = 0$。\n因此，正确的预测器是 $\\hat{Y}_{t+1}^{\\mathrm{deploy}} = \\beta \\phi X_t$。\n\n部署的均方误差为 $\\mathrm{MSE}_{\\mathrm{deploy}} = (Y_{t+1} - \\hat{Y}_{t+1}^{\\mathrm{deploy}})^2$。其期望为：\n$$\n\\mathbb{E}[\\mathrm{MSE}_{\\mathrm{deploy}}] = \\mathbb{E}\\left[\\left( Y_{t+1} - \\beta \\phi X_t \\right)^2\\right]\n$$\n代入 $Y_{t+1} = \\beta(\\phi X_t + \\eta_{t+1}) + \\epsilon_{t+1}$：\n$$\n\\mathbb{E}[\\mathrm{MSE}_{\\mathrm{deploy}}] = \\mathbb{E}\\left[\\left( \\beta(\\phi X_t + \\eta_{t+1}) + \\epsilon_{t+1} - \\beta \\phi X_t \\right)^2\\right]\n$$\n$$\n\\mathbb{E}[\\mathrm{MSE}_{\\mathrm{deploy}}] = \\mathbb{E}\\left[\\left( \\beta \\eta_{t+1} + \\epsilon_{t+1} \\right)^2\\right]\n$$\n展开平方项：\n$$\n\\mathbb{E}[\\mathrm{MSE}_{\\mathrm{deploy}}] = \\mathbb{E}[\\beta^2 \\eta_{t+1}^2 + 2\\beta \\eta_{t+1}\\epsilon_{t+1} + \\epsilon_{t+1}^2]\n$$\n根据期望的线性性质：\n$$\n\\mathbb{E}[\\mathrm{MSE}_{\\mathrm{deploy}}] = \\beta^2 \\mathbb{E}[\\eta_{t+1}^2] + 2\\beta \\mathbb{E}[\\eta_{t+1}\\epsilon_{t+1}] + \\mathbb{E}[\\epsilon_{t+1}^2]\n$$\n我们知道 $\\mathbb{E}[\\eta_{t+1}^2] = \\mathrm{Var}(\\eta_{t+1}) = \\sigma_{\\eta}^2$ 且 $\\mathbb{E}[\\epsilon_{t+1}^2] = \\mathrm{Var}(\\epsilon_{t+1}) = \\sigma_{\\epsilon}^2$，因为两者均值为零。由于 $\\eta_{t+1}$ 和 $\\epsilon_{t+1}$ 相互独立，它们乘积的期望等于它们期望的乘积：$\\mathbb{E}[\\eta_{t+1}\\epsilon_{t+1}] = \\mathbb{E}[\\eta_{t+1}]\\mathbb{E}[\\epsilon_{t+1}] = 0 \\cdot 0 = 0$。\n代入这些值，我们得到：\n$$\n\\mathbb{E}[\\mathrm{MSE}_{\\mathrm{deploy}}] = \\beta^2 \\sigma_{\\eta}^2 + 0 + \\sigma_{\\epsilon}^2 = \\beta^2 \\sigma_{\\eta}^2 + \\sigma_{\\epsilon}^2\n$$\n部署误差包含两个部分：不可约误差 $\\sigma_{\\epsilon}^2$ 以及来自未来生物标志物演化不确定性的误差 $\\beta^2 \\sigma_{\\eta}^2$。\n\n最后，我们计算由泄露引起的估计MSE中的偏差。\n$$\n\\mathrm{Bias} = \\mathbb{E}[\\mathrm{MSE}_{\\mathrm{leak}}] - \\mathbb{E}[\\mathrm{MSE}_{\\mathrm{deploy}}]\n$$\n代入推导出的表达式：\n$$\n\\mathrm{Bias} = \\sigma_{\\epsilon}^{2} - \\left(\\beta^2 \\sigma_{\\eta}^2 + \\sigma_{\\epsilon}^2\\right) = -\\beta^2 \\sigma_{\\eta}^2\n$$\n偏差为负，表明带有泄露的MSE估计是过于乐观的，低估了真实的预测误差。该偏差的大小与生物标志物效应大小的平方 $\\beta^2$ 以及生物标志物新息过程的方差 $\\sigma_{\\eta}^2$ 成正比。\n\n为防止此类泄露，用于动态模型的科学合理的预测验证设计必须严格遵守数据的时间因果关系。一种标准且稳健的方法是**滚动原点验证**（rolling-origin validation，也称为时间序列交叉验证或前向验证）。这个过程模拟了真实世界中的场景，即随着新数据的出现，模型会定期重新训练。\n\n步骤如下：\n$1$. 数据集按时间从 $t=1$ 到 $T$ 顺序排列。\n$2$. 定义一个从时间 $t=1$ 到 $t=T_0$ 的初始训练集，其中 $T_0  T$。\n$3$. 仅使用区间 $[1, T_0]$ 内的数据来训练模型，包括所有特征工程步骤。至关重要的是，任何用于预测时间点 $t+1$ 结局的特征都必须从时间点 $t$ 或之前可用的信息中导出。\n$4$. 使用训练好的模型预测下一个时间点的结局 $Y_{T_0+1}$。计算并存储预测误差，例如 $(Y_{T_0+1} - \\hat{Y}_{T_0+1})^2$。\n$5$. 将时间窗口前进一步。将 $T_0+1$ 的新数据点并入训练集，此时训练集的时间范围为 $[1, T_0+1]$（扩展窗口）或 $[2, T_0+1]$（固定大小的滑动窗口）。\n$6$. 在更新后的训练集上重新训练模型，并对 $Y_{T_0+2}$ 进行预测。记录误差。\n$7$. 重复这个滚动原点、重新训练和预测下一点的过程，直到对整个期望的评估期（例如，直到时间 $T$）都做出了预测。\n$8$. 然后通过对每一步存储的预测误差求平均，来计算整体模型性能指标，例如均方误差。\n\n这种方法确保在每个评估点，模型都只接触到过去可用的信息，从而防止任何形式的未来数据污染，并提供对模型真实部署性能的现实、无偏的估计。",
            "answer": "$$\n\\boxed{- \\beta^{2} \\sigma_{\\eta}^{2}}\n$$"
        },
        {
            "introduction": "一个动态模型的真正考验在于其在未来多个时间步长的预测能力。随着预测时间范围的扩大，由于系统固有的随机性（过程噪声），预测的不确定性通常会增加。本练习将引导你推导一个线性动态系统在$k$步预测中不确定性是如何累积的，揭示模型的内在结构（特别是其特征值）如何决定预测方差的增长，这是评估模型长期稳定性和可靠性的核心。",
            "id": "3921461",
            "problem": "一位生物医学系统建模师正在验证一个均衡点附近的离散时间线性化生物标志物动力学模型的预测性能。状态向量 $x_t \\in \\mathbb{R}^n$ 遵循如下随机差分方程演化：\n$$\nx_{t+1} = A x_t + w_t,\n$$\n其中 $A \\in \\mathbb{R}^{n \\times n}$ 是实对称且严格稳定的矩阵，其谱半径小于 $1$。过程噪声 $w_t$ 是零均值、独立同分布的高斯噪声，其协方差为 $Q = \\sigma_w^2 I_n$，其中 $\\sigma_w^2 \\in \\mathbb{R}_{0}$，$I_n$ 是 $n \\times n$ 的单位矩阵。初始状态 $x_0$ 是精确已知的。一个标量可测生物标志物由 $y_t = c^{\\top} x_t$ 定义，其中 $c \\in \\mathbb{R}^n$ 是一个已知的向量。\n\n在一个 $k$ 步开环预测中，均值预测为 $ \\mathbb{E}[y_k \\mid x_0] = c^{\\top} A^k x_0$，预测不确定性源于过程噪声在动力学系统中的累积。请仅使用线性高斯系统的协方差传播的基本定义以及对称矩阵的性质，从第一性原理推导 $k$ 步预测方差\n$$\n\\operatorname{Var}\\!\\left(y_k - \\mathbb{E}[y_k \\mid x_0]\\right)\n$$\n的闭式解析表达式，该表达式应为 $A$ 的特征值的显式函数。设 $A = U \\Lambda U^{\\top}$ 表示其特征分解，其中 $U$ 是标准正交矩阵，$\\Lambda = \\operatorname{diag}(\\lambda_1, \\ldots, \\lambda_n)$，且对于所有 $j \\in \\{1,\\ldots,n\\}$ 都有 $|\\lambda_j|  1$。请用 $\\{\\lambda_j\\}_{j=1}^n$、通过 $U$ 表示的特征向量、$c$ 相对于 $U$ 的分量、标量 $\\sigma_w^2$ 以及预测步长 $k \\in \\mathbb{N}$ 来表示最终答案。请以生物标志物浓度的平方单位表示该方差。请以单个闭式表达式提供最终答案；不要代入任何数值。",
            "solution": "本问题旨在推导由离散时间线性随机系统 $x_{t+1} = A x_t + w_t$ 生成的标量生物标志物 $y_t = c^{\\top} x_t$ 的 $k$ 步预测方差。\n\n预测误差是生物标志物在时刻 $k$ 的真实值 $y_k$ 与其在给定初始状态 $x_0$ 下的条件期望 $\\mathbb{E}[y_k \\mid x_0]$ 之间的差。我们需要计算 $\\operatorname{Var}\\!\\left(y_k - \\mathbb{E}[y_k \\mid x_0]\\right)$。\n\n首先，我们用初始状态 $x_0$ 和过程噪声项序列 $w_0, w_1, \\dots, w_{k-1}$ 来表示状态 $x_k$。通过展开递推关系，我们得到：\n$$\nx_k = A^k x_0 + \\sum_{i=0}^{k-1} A^{k-1-i} w_i\n$$\n生物标志物的值为 $y_k = c^{\\top} x_k$。条件期望 $\\mathbb{E}[y_k \\mid x_0]$ 由下式给出：\n$$\n\\mathbb{E}[y_k \\mid x_0] = \\mathbb{E}[c^{\\top} x_k \\mid x_0] = c^{\\top} \\mathbb{E}[x_k \\mid x_0]\n$$\n为了求得 $\\mathbb{E}[x_k \\mid x_0]$，我们对 $x_k$ 的表达式取期望。由于 $x_0$ 是已知的，可被视为常数，且噪声项 $w_i$ 是零均值的（$\\mathbb{E}[w_i]=0$），我们有：\n$$\n\\mathbb{E}[x_k \\mid x_0] = \\mathbb{E}\\left[A^k x_0 + \\sum_{i=0}^{k-1} A^{k-1-i} w_i \\mid x_0\\right] = A^k x_0 + \\sum_{i=0}^{k-1} A^{k-1-i} \\mathbb{E}[w_i] = A^k x_0\n$$\n因此，生物标志物的均值预测为 $\\mathbb{E}[y_k \\mid x_0] = c^{\\top} A^k x_0$。\n\n预测误差（我们记为 $e_k$）是：\n$$\ne_k = y_k - \\mathbb{E}[y_k \\mid x_0] = c^{\\top} x_k - c^{\\top} A^k x_0 = c^{\\top} (x_k - A^k x_0)\n$$\n我们将状态预测误差定义为 $\\tilde{x}_k = x_k - \\mathbb{E}[x_k \\mid x_0] = x_k - A^k x_0$。从 $x_k$ 的表达式可知，这个误差纯粹是累积过程噪声的函数：\n$$\n\\tilde{x}_k = \\left(A^k x_0 + \\sum_{i=0}^{k-1} A^{k-1-i} w_i\\right) - A^k x_0 = \\sum_{i=0}^{k-1} A^{k-1-i} w_i\n$$\n那么，生物标志物预测误差为 $e_k = c^{\\top} \\tilde{x}_k$。\n该误差的期望为 $\\mathbb{E}[e_k] = c^{\\top} \\mathbb{E}[\\tilde{x}_k] = c^{\\top} \\left(\\sum_{i=0}^{k-1} A^{k-1-i} \\mathbb{E}[w_i]\\right) = 0$。\n由于 $e_k$ 是一个零均值标量随机变量，其方差为 $\\operatorname{Var}(e_k) = \\mathbb{E}[e_k^2]$。利用随机向量线性变换的方差性质 $\\operatorname{Var}(L z) = L \\operatorname{Cov}(z) L^{\\top}$，我们有：\n$$\n\\operatorname{Var}(e_k) = \\operatorname{Var}(c^{\\top} \\tilde{x}_k) = c^{\\top} \\operatorname{Cov}(\\tilde{x}_k) c\n$$\n$\\operatorname{Cov}(\\tilde{x}_k)$ 项是状态预测误差的协方差矩阵，我们将其记为 $P_k$。由于 $\\tilde{x}_k$ 是零均值的，所以 $P_k = \\mathbb{E}[\\tilde{x}_k \\tilde{x}_k^{\\top}]$。\n$$\nP_k = \\mathbb{E}\\left[ \\left(\\sum_{i=0}^{k-1} A^{k-1-i} w_i\\right) \\left(\\sum_{j=0}^{k-1} A^{k-1-j} w_j\\right)^{\\top} \\right] = \\sum_{i=0}^{k-1} \\sum_{j=0}^{k-1} A^{k-1-i} \\mathbb{E}[w_i w_j^{\\top}] (A^{\\top})^{k-1-j}\n$$\n噪声 $w_t$ 是独立同分布的，因此 $\\mathbb{E}[w_i w_j^{\\top}] = Q \\delta_{ij}$，其中 $\\delta_{ij}$ 是克罗内克δ函数，$Q = \\sigma_w^2 I_n$。当 $i=j$ 时，双重求和简化为单重求和：\n$$\nP_k = \\sum_{i=0}^{k-1} A^{k-1-i} Q (A^{\\top})^{k-1-i}\n$$\n矩阵 $A$ 已知是对称的，因此 $A^{\\top} = A$。代入此式以及 $Q = \\sigma_w^2 I_n$：\n$$\nP_k = \\sum_{i=0}^{k-1} A^{k-1-i} (\\sigma_w^2 I_n) A^{k-1-i} = \\sigma_w^2 \\sum_{i=0}^{k-1} A^{2(k-1-i)}\n$$\n通过将求和指数改为 $m = k-1-i$，其中 $m$ 从 $k-1$ 递减到 $0$，我们得到：\n$$\nP_k = \\sigma_w^2 \\sum_{m=0}^{k-1} A^{2m}\n$$\n现在我们利用特征分解 $A = U \\Lambda U^{\\top}$。由于 $U$ 是标准正交的（$U^{\\top}U = I_n$），$A$ 的幂由 $A^p = U \\Lambda^p U^{\\top}$ 给出。因此，$A^{2m} = U \\Lambda^{2m} U^{\\top}$。\n$$\nP_k = \\sigma_w^2 \\sum_{m=0}^{k-1} U \\Lambda^{2m} U^{\\top} = \\sigma_w^2 U \\left( \\sum_{m=0}^{k-1} \\Lambda^{2m} \\right) U^{\\top}\n$$\n矩阵 $\\Lambda = \\operatorname{diag}(\\lambda_1, \\dots, \\lambda_n)$，所以 $\\Lambda^{2m} = \\operatorname{diag}(\\lambda_1^{2m}, \\dots, \\lambda_n^{2m})$。求和项是一个对角矩阵：\n$$\n\\sum_{m=0}^{k-1} \\Lambda^{2m} = \\operatorname{diag}\\left( \\sum_{m=0}^{k-1} \\lambda_1^{2m}, \\dots, \\sum_{m=0}^{k-1} \\lambda_n^{2m} \\right)\n$$\n对角线上的每个和都是一个有限几何级数。由于 $|\\lambda_j|  1$，这意味着 $\\lambda_j^2 \\neq 1$。该和为：\n$$\n\\sum_{m=0}^{k-1} (\\lambda_j^2)^m = \\frac{1 - (\\lambda_j^2)^k}{1 - \\lambda_j^2} = \\frac{1 - \\lambda_j^{2k}}{1 - \\lambda_j^2}\n$$\n因此，协方差矩阵 $P_k$ 为 $P_k = \\sigma_w^2 U \\Gamma_k U^{\\top}$，其中 $\\Gamma_k$ 是一个对角矩阵，其元素为 $(\\Gamma_k)_{jj} = \\frac{1 - \\lambda_j^{2k}}{1 - \\lambda_j^2}$。\n\n最后，预测方差为：\n$$\n\\operatorname{Var}(e_k) = c^{\\top} P_k c = c^{\\top} (\\sigma_w^2 U \\Gamma_k U^{\\top}) c = \\sigma_w^2 (c^{\\top} U) \\Gamma_k (U^{\\top} c)\n$$\n令 $\\tilde{c} = U^{\\top} c$。向量 $\\tilde{c}$ 包含 $c$ 在 $A$ 的特征向量基（即 $U$ 的列向量）下的分量。我们将此向量的第 $j$ 个分量记为 $\\tilde{c}_j = (U^{\\top} c)_j = u_j^\\top c$，其中 $u_j$ 是 $U$ 的第 $j$ 列。该表达式变为一个二次型：\n$$\n\\operatorname{Var}(e_k) = \\sigma_w^2 \\tilde{c}^{\\top} \\Gamma_k \\tilde{c} = \\sigma_w^2 \\sum_{j=1}^n \\tilde{c}_j^2 (\\Gamma_k)_{jj}\n$$\n代入 $\\Gamma_k$ 的对角元素，我们得到最终的闭式解析表达式：\n$$\n\\operatorname{Var}\\!\\left(y_k - \\mathbb{E}[y_k \\mid x_0]\\right) = \\sigma_w^2 \\sum_{j=1}^n \\tilde{c}_j^2 \\frac{1 - \\lambda_j^{2k}}{1 - \\lambda_j^2}\n$$\n这个表达式给出了方差，它是噪声水平 $\\sigma_w^2$、特征值 $\\{\\lambda_j\\}$、预测步长 $k$ 以及测量向量 $c$ 在 $A$ 的特征基下的分量 $\\{\\tilde{c}_j\\}$ 的函数。\n分量 $\\tilde{c}_j$ 由向量 $U^\\top c$ 的元素显式给出。我们可以将 $\\tilde{c}_j^2$ 写为 $((U^\\top c)_j)^2$。",
            "answer": "$$ \\boxed{ \\sigma_w^2 \\sum_{j=1}^{n} \\left( (U^{\\top}c)_j \\right)^2 \\frac{1 - \\lambda_j^{2k}}{1 - \\lambda_j^2} } $$"
        },
        {
            "introduction": "对动态模型进行验证，不仅仅是看其点预测的准确性，更关键的是评估其对不确定性的量化能力，即其预测分布的质量。严格正确评分规则（Strictly Proper Scoring Rules）为此提供了理论上健全的工具。本练习将通过一个高斯预测的具体案例，让你动手推导和计算两种最重要的评分——对数评分（Logarithmic Score）和连续分级概率评分（CRPS），并理解它们如何分别侧重于评估预测的校准性（calibration）和锐度（sharpness）。",
            "id": "3921410",
            "problem": "考虑一个用于2型糖尿病患者葡萄糖-胰岛素调节的经过验证的状态空间模型，其中时间点 $t+1$ 的毛细血管血糖测量值 $y_{t+1}$ 的单步预测分布，是由给定过去数据 $\\mathcal{D}_t$ 在时间点 $t$ 的滤波分布得到的边缘预测 $p(y_{t+1}\\mid \\mathcal{D}_t)$。假设该模型产生一个高斯预测 $y_{t+1}\\sim \\mathcal{N}(\\mu_{t+1\\mid t},\\sigma_{t+1\\mid t}^2)$，其中 $\\mu_{t+1\\mid t}=105$ 且 $\\sigma_{t+1\\mid t}=15$（单位均为毫克/分升, $\\mathrm{mg/dL}$）。实际观测值为 $y_{t+1}=130$ $\\mathrm{mg/dL}$。\n\n基于使用严格正确评分规则进行预测验证的基本原理，将对数分数定义为在观测值处评估的预测密度的自然对数，并将连续分级概率分数（CRPS）定义为预测累积分布函数与观测值的经验累积分布函数之间平方差的积分。从这些核心定义和高斯分布的性质出发，推导对数分数和CRPS对于高斯预测分布的闭式表达式（用 $\\mu_{t+1\\mid t}$、$\\sigma_{t+1\\mid t}$ 和 $y_{t+1}$ 表示），然后用上面给定的值对它们进行数值计算。\n\n科学地解释每个分数惩罚预测性能的哪些方面，以及它们在评估动态生物医学模型的校准性和锐度方面如何互为补充。\n\n以自然信息单位（“奈特”）报告对数分数的数值，以 $\\mathrm{mg/dL}$ 报告CRPS的数值，并将两者都四舍五入到四位有效数字。将您的最终数值答案以单行矩阵的形式给出，其中第一个条目等于对数分数，第二个条目等于CRPS。",
            "solution": "目标是针对给定的高斯预测预报和实现的观测值，推导并评估两个严格正确评分规则：对数分数（$S_{log}$）和连续分级概率分数（$S_{CRPS}$）。我们还将提供对这些分数的科学解释。\n\n血糖水平 $y_{t+1}$ 的预测分布是高斯分布，$y_{t+1} \\sim \\mathcal{N}(\\mu, \\sigma^2)$，其均值为 $\\mu = \\mu_{t+1|t} = 105$，标准差为 $\\sigma = \\sigma_{t+1|t} = 15$。观测值为 $y = y_{t+1} = 130$。\n\n首先，我们处理对数分数。对数分数的定义是在实际观测值 $y$ 处评估的预测概率密度函数（PDF）$p(y|\\mu, \\sigma^2)$ 的自然对数。高斯分布的PDF为：\n$$p(y|\\mu, \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y-\\mu)^2}{2\\sigma^2}\\right)$$\n因此，对数分数 $S_{log}$ 为：\n$$S_{log} = \\ln(p(y|\\mu, \\sigma^2)) = \\ln\\left(\\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y-\\mu)^2}{2\\sigma^2}\\right)\\right)$$\n使用对数的性质，我们可以分离各项以获得闭式表达式：\n$$S_{log} = \\ln\\left((2\\pi\\sigma^2)^{-1/2}\\right) - \\frac{(y-\\mu)^2}{2\\sigma^2} = -\\frac{1}{2}\\ln(2\\pi\\sigma^2) - \\frac{(y-\\mu)^2}{2\\sigma^2}$$\n这可以进一步写成：\n$$S_{log} = -\\ln(\\sigma) - \\frac{1}{2}\\ln(2\\pi) - \\frac{1}{2}\\left(\\frac{y-\\mu}{\\sigma}\\right)^2$$\n现在，我们代入给定的数值：$\\mu=105$，$\\sigma=15$，和 $y=130$。\n$$S_{log} = -\\ln(15) - \\frac{1}{2}\\ln(2\\pi) - \\frac{1}{2}\\left(\\frac{130 - 105}{15}\\right)^2$$\n$$S_{log} = -\\ln(15) - \\frac{1}{2}\\ln(2\\pi) - \\frac{1}{2}\\left(\\frac{25}{15}\\right)^2 = -\\ln(15) - \\frac{1}{2}\\ln(2\\pi) - \\frac{1}{2}\\left(\\frac{5}{3}\\right)^2$$\n$$S_{log} \\approx -2.70805 - \\frac{1}{2}(1.83788) - \\frac{1}{2}(2.77778) \\approx -2.70805 - 0.91894 - 1.38889 \\approx -5.01588$$\n四舍五入到四位有效数字，对数分数为 $-5.016$ 奈特。\n\n接下来，我们处理连续分级概率分数（$S_{CRPS}$）。CRPS被定义为预测累积分布函数（CDF）$F(z)$与观测值的经验CDF之间的积分平方差，后者是一个以 $y$ 为中心的亥维赛德函数 $H(z-y)$：\n$$S_{CRPS} = \\int_{-\\infty}^{\\infty} (F(z) - H(z-y))^2 dz$$\n一种替代的、并且对于此推导更方便的表示是 $S_{CRPS} = E_F[|X-y|] - \\frac{1}{2} E_F[|X-X'|]$，其中 $X$ 和 $X'$ 是从预测分布 $F$ 中抽取的独立随机变量。对于我们的高斯情况，$X, X' \\sim \\mathcal{N}(\\mu, \\sigma^2)$。\n\n让我们推导每一项。第二项 $\\frac{1}{2} E_F[|X-X'|]$ 仅取决于预测分布的离散程度。两个独立高斯变量的差 $X-X'$ 服从均值为 $\\mu-\\mu=0$、方差为 $\\sigma^2+\\sigma^2=2\\sigma^2$ 的高斯分布。设 $D = X-X' \\sim \\mathcal{N}(0, 2\\sigma^2)$。我们需要计算 $E[|D|]$，这是一个折叠正态分布的均值。\n$$E[|D|] = \\int_{-\\infty}^{\\infty} |d| \\frac{1}{\\sqrt{2\\pi(2\\sigma^2)}} \\exp\\left(-\\frac{d^2}{2(2\\sigma^2)}\\right) dd = 2 \\int_{0}^{\\infty} d \\frac{1}{2\\sigma\\sqrt{\\pi}} \\exp\\left(-\\frac{d^2}{4\\sigma^2}\\right) dd = \\frac{2\\sigma}{\\sqrt{\\pi}}$$\n因此，第二项是 $\\frac{1}{2}E[|D|] = \\frac{\\sigma}{\\sqrt{\\pi}}$。\n\n第一项 $E_F[|X-y|]$ 取决于预测和观测值。设 $z_{std} = (X-\\mu)/\\sigma$ 是一个标准正态变量，$z_{std} \\sim \\mathcal{N}(0, 1)$。那么 $X = \\sigma z_{std} + \\mu$。期望变为：\n$$E_F[|X-y|] = E[|\\sigma z_{std} + \\mu - y|] = \\sigma E[|z_{std} - \\frac{y-\\mu}{\\sigma}|]$$\n设标准化观测值为 $z = \\frac{y-\\mu}{\\sigma}$。我们需要计算 $E[|z_{std}-z|]$。\n$$E[|z_{std}-z|] = \\int_{-\\infty}^{\\infty} |x-z|\\phi(x)dx = \\int_{-\\infty}^{z} (z-x)\\phi(x)dx + \\int_{z}^{\\infty} (x-z)\\phi(x)dx$$\n其中 $\\phi(x)$ 是标准正态PDF。利用 $\\int x\\phi(x)dx = -\\phi(x)$ 和 $\\int \\phi(x)dx = \\Phi(x)$ 这两个事实，其中 $\\Phi(x)$ 是标准正态CDF，我们得到：\n$$E[|z_{std}-z|] = z\\Phi(z) + \\phi(z) - z(1-\\Phi(z)) + \\phi(z) = z(2\\Phi(z)-1) + 2\\phi(z)$$\n将此代回，得到 $E_F[|X-y|] = \\sigma \\left( z(2\\Phi(z)-1) + 2\\phi(z) \\right)$。\n\n结合这两项，高斯预测的CRPS的闭式表达式为：\n$$S_{CRPS} = \\sigma \\left[ z(2\\Phi(z) - 1) + 2\\phi(z) - \\frac{1}{\\sqrt{\\pi}} \\right]$$\n其中 $z = \\frac{y-\\mu}{\\sigma}$。我们现在代入数值：\n$$z = \\frac{130 - 105}{15} = \\frac{25}{15} = \\frac{5}{3}$$\n我们需要标准正态PDF $\\phi(z)$ 和CDF $\\Phi(z)$ 在 $z=5/3 \\approx 1.6667$ 处的值。\n$\\phi(5/3) = \\frac{1}{\\sqrt{2\\pi}}\\exp\\left(-\\frac{1}{2}(\\frac{5}{3})^2\\right) \\approx 0.099471$\n$\\Phi(5/3) \\approx 0.952210$\n将这些值代入CRPS公式：\n$$S_{CRPS} = 15 \\left[ \\frac{5}{3}(2(0.952210) - 1) + 2(0.099471) - \\frac{1}{\\sqrt{\\pi}} \\right]$$\n$$S_{CRPS} \\approx 15 \\left[ 1.6667(0.90442) + 0.198942 - \\frac{1}{1.77245} \\right]$$\n$$S_{CRPS} \\approx 15 [1.50737 + 0.19894 - 0.56419] \\approx 15 [1.14212] \\approx 17.1318$$\n四舍五入到四位有效数字，CRPS为 $17.13$ $\\mathrm{mg/dL}$。\n\n最后，对这些分数进行科学解释。\n对数分数 $S_{log} = \\ln(p(y))$，根据模型为单个实现的观测结果分配的密度来评估预测模型。它严厉惩罚那些认为观测结果极不可能（即分配了低概率密度）的预测。预测分布极端尾部的一个观测值就可能导致一个大的负分，可能会主导许多预测的平均分数。这使其成为一个极好的**校准性**诊断工具，因为一个校准良好的模型不应该被结果系统性地“惊吓”到。该分数由一个惩罚不准确性（$y$与$\\mu$的距离）的项和一个惩罚锐度不足（大的$\\sigma$）的项组成，但其对尾部性能的极端敏感性使其成为识别校准不良的敏锐工具。\n\n连续分级概率分数 $S_{CRPS} = \\int (F(z) - H(z-y))^2 dz$，将整个预测分布与观测值进行评估。它推广了平均绝对误差；如果预测是一个确定性的点估计 $\\mu$（即 $F(z)$ 是在 $\\mu$ 处的一个阶跃函数），CRPS就简化为 $|y-\\mu|$。与对数分数相比，CRPS对单个不太可能的事件不那么敏感，并提供了更稳健的整体性能度量。其分解为 $E|X-y| - \\frac{1}{2} E|X-X'|$ 表明，它奖励**校准性**和**准确性**（通过最小化预测与从预测分布中抽取的样本之间的期望距离），同时也奖励**锐度**（第二项是对分布离散程度的惩罚；较小的离散程度导致较小的惩罚）。一个重要的实际优势是，CRPS的单位与测量值本身的单位相同（本例中为 $\\mathrm{mg/dL}$），使其可以直接解释为广义的误差大小。\n\n在生物医学建模中，使用这两种分数是互补的。CRPS提供了对整体预测性能的稳健、可解释的总结，平衡了预测既要以结果为中心（准确）又要集中（锐利）的需求。对数分数则作为一个更严格的概率校准检验，标记出那些未能在所有可能结果的全部范围内分配适当概率的模型，这对于不确定性下的风险评估和决策至关重要。\n\n计算出的分数，四舍五入到四位有效数字，为：\n对数分数：$-5.016$ 奈特。\nCRPS：$17.13$ $\\mathrm{mg/dL}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} -5.016  17.13 \\end{pmatrix}}$$"
        }
    ]
}