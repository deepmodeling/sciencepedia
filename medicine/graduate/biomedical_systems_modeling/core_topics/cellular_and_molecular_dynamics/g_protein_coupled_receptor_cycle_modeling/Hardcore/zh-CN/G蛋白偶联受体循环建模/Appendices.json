{
    "hands_on_practices": [
        {
            "introduction": "我们从一个基础但至关重要的场景开始：两种激动剂（一种完全激动剂和一种部分激动剂）竞争结合同一个受体靶点。这个练习旨在通过质量作用定律推导出复合信号输出的表达式，从而为理解多配体系统中的受体反应奠定数学基础。掌握这一基本模型是分析更复杂的药理学相互作用（例如多药联用或内源性与外源性配体的竞争）的第一步。\n\n通过这个练习，你将学会如何将单个配体的结合与功效模型扩展到竞争性场景，理解最终的细胞反应是如何整合来自不同配体信号的 。",
            "id": "3887903",
            "problem": "考虑一个在充分混合隔室中的单一位点占用的G蛋白偶联受体（GPCR）循环，其总受体库 $R_T$ 是固定的。两种配体竞争同一个正构结合位点：一种是浓度为 $L_1$ 的完全激动剂，另一种是浓度为 $L_2$ 的部分激动剂。这两种配体各自的平衡解离常数分别为 $K_{D1}$ 和 $K_{D2}$，由质量作用定律定义，因此在稳态时，受体-配体复合物满足 $K_{D1} = \\frac{[R][L_1]}{[RL_1]}$ 和 $K_{D2} = \\frac{[R][L_2]}{[RL_2]}$，其中 $[R]$ 是游离受体的浓度，$[RL_1]$ 是与 $L_1$ 结合的受体浓度，$[RL_2]$ 是与 $L_2$ 结合的受体浓度。假设没有受体二聚化、没有变构调节、也没有协同性。受体与两种同时存在的配体处于平衡状态，且结合是相互排斥的。\n\n设完全激动剂的信号转导效能为 $\\varepsilon_1$，部分激动剂的信号转导效能为 $\\varepsilon_2$，其中 $\\varepsilon_1$ 和 $\\varepsilon_2$ 是介于0和1之间的无量纲常数，量化了配体结合的受体处于具有信号转导能力的活性构象的概率。假设游离受体的组成性活性可忽略不计。进一步假设下游G蛋白的激活是快速的，且与稳态下处于活性构象的受体比例成正比，因此标准化信号输出 $E(L_1,L_2)$ 等于处于活性状态的受体比例。\n\n从质量作用定律和受体守恒定律出发，推导复合稳态标准化信号输出 $E(L_1,L_2)$ 的闭合形式表达式，使其成为 $L_1$、$L_2$、$K_{D1}$、$K_{D2}$、$\\varepsilon_1$ 和 $\\varepsilon_2$ 的显式函数。将最终答案表示为单一解析表达式。无需进行数值计算，最终表达式中不应包含单位。",
            "solution": "该问题要求推导一个具有两种竞争性配体的GPCR系统的标准化信号输出的闭合形式表达式。推导过程必须基于平衡时的质量作用动力学原理和总受体浓度守恒定律。\n\n首先，我们根据问题陈述建立控制该系统在稳态下的基本方程。\n\n总受体浓度 $R_T$ 是恒定的，等于游离受体浓度 $[R]$、与完全激动剂结合的受体浓度 $[RL_1]$ 以及与部分激动剂结合的受体浓度 $[RL_2]$ 之和。这就是受体守恒定律：\n$$R_T = [R] + [RL_1] + [RL_2]$$\n\n配体与受体之间的相互作用由质量作用定律描述，通过它们各自的平衡解离常数 $K_{D1}$ 和 $K_{D2}$ 定义：\n对于完全激动剂 $L_1$：\n$$K_{D1} = \\frac{[R] L_1}{[RL_1]}$$\n对于部分激动剂 $L_2$：\n$$K_{D2} = \\frac{[R] L_2}{[RL_2]}$$\n此处，$L_1$ 和 $L_2$ 代表各自配体的浓度。\n\n从这些质量作用方程中，我们可以用游离受体浓度 $[R]$ 来表示配体结合的受体复合物的浓度：\n$$[RL_1] = \\frac{[R] L_1}{K_{D1}}$$\n$$[RL_2] = \\frac{[R] L_2}{K_{D2}}$$\n\n接下来，我们将这些表达式代入受体守恒方程：\n$$R_T = [R] + \\frac{[R] L_1}{K_{D1}} + \\frac{[R] L_2}{K_{D2}}$$\n提出游离受体浓度 $[R]$ 的公因子，得到：\n$$R_T = [R] \\left( 1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}} \\right)$$\n\n标准化信号输出 $E(L_1, L_2)$ 定义为总受体库中处于活性的、具有信号转导能力的构象的受体所占的比例。对活性受体库的贡献来自于与 $L_1$ 结合的受体和与 $L_2$ 结合的受体。信号转导效能参数 $\\varepsilon_1$ 和 $\\varepsilon_2$ 分别代表与 $L_1$ 或 $L_2$ 结合的受体处于活性状态的概率。问题陈述中说明，游离受体的组成性活性可以忽略。\n因此，活性受体的总浓度 $[R_{active}]$ 为：\n$$[R_{active}] = \\varepsilon_1 [RL_1] + \\varepsilon_2 [RL_2]$$\n\n标准化信号输出 $E$ 是该量除以总受体浓度 $R_T$：\n$$E(L_1, L_2) = \\frac{[R_{active}]}{R_T} = \\frac{\\varepsilon_1 [RL_1] + \\varepsilon_2 [RL_2]}{R_T} = \\varepsilon_1 \\frac{[RL_1]}{R_T} + \\varepsilon_2 \\frac{[RL_2]}{R_T}$$\n$\\frac{[RL_1]}{R_T}$ 和 $\\frac{[RL_2]}{R_T}$ 两项表示每种配体在总受体库中的占据比例。我们可以推导出这些比例的表达式。\n\n使用以 $[R]$ 表示的 $[RL_1]$ 和 $R_T$ 的表达式：\n$$\\frac{[RL_1]}{R_T} = \\frac{\\frac{[R] L_1}{K_{D1}}}{[R] \\left( 1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}} \\right)} = \\frac{\\frac{L_1}{K_{D1}}}{1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}}}$$\n同样，对于第二种配体：\n$$\\frac{[RL_2]}{R_T} = \\frac{\\frac{[R] L_2}{K_{D2}}}{[R] \\left( 1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}} \\right)} = \\frac{\\frac{L_2}{K_{D2}}}{1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}}}$$\n\n最后，我们将这些占据比例的表达式代回标准化信号输出 $E(L_1, L_2)$ 的方程中：\n$$E(L_1, L_2) = \\varepsilon_1 \\left( \\frac{\\frac{L_1}{K_{D1}}}{1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}}} \\right) + \\varepsilon_2 \\left( \\frac{\\frac{L_2}{K_{D2}}}{1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}}} \\right)$$\n将各项合并到公分母上，得到复合稳态标准化信号输出的最终闭合形式表达式：\n$$E(L_1, L_2) = \\frac{\\varepsilon_1 \\frac{L_1}{K_{D1}} + \\varepsilon_2 \\frac{L_2}{K_{D2}}}{1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}}}$$\n该表达式给出了总响应，是两种竞争性配体的浓度及其各自结合和效能参数的函数。",
            "answer": "$$\\boxed{\\frac{\\varepsilon_1 \\frac{L_1}{K_{D1}} + \\varepsilon_2 \\frac{L_2}{K_{D2}}}{1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}}}}$$"
        },
        {
            "introduction": "在了解了激动剂之间的竞争后，我们转向一个经典的药理学问题：激动剂与竞争性拮抗剂的相互作用。拮抗剂在药物发现中至关重要，而准确量化其效力是核心任务。本练习将引导你推导并模拟竞争性拮抗剂如何平行移动激动剂的剂量反应曲线（即改变 $EC50$ 但不影响 $E_{\\max}$），并最终构建Schild图来估算拮抗剂的平衡解离常数 $K_B$。\n\n这项实践将理论推导与计算机模拟相结合，让你亲身体验如何通过Schild分析这一强大的定量工具来表征拮抗剂的亲和力，这是受体药理学中的一项基本技能 。",
            "id": "3887970",
            "problem": "考虑一个G蛋白偶联受体（GPCR）系统的最小机制模型，其中单个受体位点可与一种可逆激动剂和一种可逆竞争性拮抗剂结合。受体在游离状态、激动剂结合的活性状态和拮抗剂结合的非活性状态之间循环。假设与下游信号传导相比，结合平衡能快速达到，并且拮抗剂的效能为零，则观察到的效应与被激动剂占据的受体分数成正比。其基本原理是可逆结合的质量作用定律以及平衡解离常数和剂量-效应关系的定义。\n\n您需要分析和模拟可逆竞争性拮抗剂如何在不改变最大效应（Emax）的情况下，改变激动剂的半数有效浓度（EC50），然后通过Schild分析推导并估算拮抗剂的平衡解离常数。\n\n任务：\n1. 从两种配体竞争同一受体位点的质量作用平衡出发，给定激动剂浓度 $[A]$、拮抗剂浓度 $[B]$、激动剂平衡解离常数 $K_A$（单位：摩尔，$\\mathrm{M}$）、拮抗剂平衡解离常数 $K_B$（单位：摩尔，$\\mathrm{M}$）、总受体浓度 $R_T$，并假设拮抗剂效能为零而激动剂效能为1，推导：\n   - 由激动剂占据的受体分数，用 $[A]$、$[B]$、$K_A$ 和 $K_B$ 表示。\n   - 在纯竞争条件下，当 $[A]\\to\\infty$ 时，最大效应 $E_{\\max}$ 不受拮抗剂影响。\n   - 存在拮抗剂时的表观半数有效浓度 $\\mathrm{EC50}([B])$，以及剂量比 $\\mathrm{DR}([B]) = \\mathrm{EC50}([B])/\\mathrm{EC50}(0)$。\n   - 对于竞争性拮抗剂，连接 $\\log_{10}(\\mathrm{DR}([B]) - 1)$ 和 $\\log_{10}([B])$ 的Schild关系式，以及根据Schild图的截距表示的 $K_B$ 表达式。\n\n2. 实现一个平衡状态下的模拟，对于几个固定的拮抗剂浓度 $[B]$，计算效应 $E([A],[B])$ 作为 $[A]$ 的函数，使用从质量作用定律推导出的占据分数，并设效应与激动剂占据率成正比。对于每个拮抗剂浓度 $[B]$，以数值方式计算 $\\mathrm{EC50}([B])$，即效应达到该 $[B]$ 浓度下最大值一半时的激动剂浓度 $[A]$。在对数激动剂浓度网格上使用单调插值来估算 $\\mathrm{EC50}([B])$。\n\n3. 为进行Schild分析，计算非零拮抗剂浓度下的剂量比值 $\\mathrm{DR}([B])$，并对 $y = \\log_{10}(\\mathrm{DR}([B]) - 1)$ 与 $x = \\log_{10}([B])$ 进行线性回归。估算斜率和截距。根据回归线 $y = m x + c$ 的截距 $c$，以摩尔为单位估算 $K_B$，即 $K_B^{\\mathrm{est}} = 10^{-c}$。\n\n4. 以数值方式验证两个性质：\n   - 竞争机制检验：Schild斜率 $m$ 应约等于 $1$。报告一个布尔值，表示是否满足 $|m - 1| \\leq \\delta$，其中容差 $\\delta = 0.05$。\n   - 最大效应不变性：对于每个拮抗剂浓度 $[B]$，在激动剂网格上的最大效应应与无拮抗剂时的最大效应在相对容差 $\\epsilon = 10^{-3}$ 内一致。报告一个布尔值，表示在每个测试案例中，该条件是否对所有测试的 $[B]$ 都成立。\n\n所有浓度和解离常数必须以摩尔单位（$\\mathrm{M}$）处理。效应可以用任意单位报告。不涉及角度。不要使用百分号；所有比率均为无单位的小数。\n\n测试套件：\n对以下参数集模拟剂量-效应关系和Schild分析。对于每种情况，在指定范围内使用对数间隔的激动剂浓度网格。在所有情况下，设置 $E_{\\max} = 1.0$（任意单位）。\n\n- 情况1（理想路径）：\n  - $K_A = 5\\times 10^{-8}\\ \\mathrm{M}$，$K_B = 2\\times 10^{-8}\\ \\mathrm{M}$。\n  - 拮抗剂浓度：$[B] \\in \\{1\\times 10^{-9},\\ 5\\times 10^{-9},\\ 2\\times 10^{-8},\\ 1\\times 10^{-7}\\}\\ \\mathrm{M}$。\n  - 激动剂网格：$[A] \\in [1\\times 10^{-10},\\ 1\\times 10^{-4}]\\ \\mathrm{M}$，共 $501$ 个点。\n\n- 情况2（弱拮抗剂边界）：\n  - $K_A = 1\\times 10^{-7}\\ \\mathrm{M}$，$K_B = 1\\times 10^{-5}\\ \\mathrm{M}$。\n  - 拮抗剂浓度：$[B] \\in \\{1\\times 10^{-7},\\ 5\\times 10^{-7},\\ 1\\times 10^{-6},\\ 5\\times 10^{-6}\\}\\ \\mathrm{M}$。\n  - 激动剂网格：$[A] \\in [1\\times 10^{-10},\\ 1\\times 10^{-2}]\\ \\mathrm{M}$，共 $501$ 个点。\n\n- 情况3（强拮抗剂覆盖）：\n  - $K_A = 1\\times 10^{-9}\\ \\mathrm{M}$，$K_B = 1\\times 10^{-9}\\ \\mathrm{M}$。\n  - 拮抗剂浓度：$[B] \\in \\{1\\times 10^{-10},\\ 3\\times 10^{-10},\\ 1\\times 10^{-9},\\ 3\\times 10^{-9},\\ 1\\times 10^{-8}\\}\\ \\mathrm{M}$。\n  - 激动剂网格：$[A] \\in [1\\times 10^{-12},\\ 1\\times 10^{-3}]\\ \\mathrm{M}$，共 $601$ 个点。\n\n最终输出规范：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个元素对应一个测试案例，并且本身是一个包含三个元素的列表：\n- 估算的拮抗剂平衡解离常数 $K_B^{\\mathrm{est}}$，单位为 $\\mathrm{M}$（浮点数）。\n- 一个布尔值，表示Schild斜率是否在 $1$ 的容差 $\\delta$ 范围内。\n- 一个布尔值，表示在测试的 $[B]$ 范围内，$E_{\\max}$ 是否在容差 $\\epsilon$ 内保持不变。\n\n例如，输出格式必须类似于 $[[v_1,b_1,c_1],[v_2,b_2,c_2],[v_3,b_3,c_3]]$，其中 $v_i$ 是单位为 $\\mathrm{M}$ 的浮点数，$b_i$ 和 $c_i$ 是布尔值。您的程序不得打印任何其他文本。",
            "solution": "问题陈述经评估有效。其科学依据建立在受体药理学的既定原则之上，特别是应用于竞争性配体结合的质量作用定律。该问题设定良好，提供了推导所需关系和执行数值模拟所必需的所有定义、常数和初始条件。语言客观，任务明确，可导向唯一且可验证的解决方案。\n\n### 1. 理论推导\n\n#### 1.1. 激动剂占据分数\n\n我们对受体 $R$ 与激动剂 $A$ 和竞争性拮抗剂 $B$ 在平衡状态下的相互作用进行建模。反应如下：\n$$ R + A \\rightleftharpoons RA $$\n$$ R + B \\rightleftharpoons RB $$\n其中 $RA$ 是激动剂-受体复合物，$RB$ 是拮抗剂-受体复合物。\n\n平衡解离常数 $K_A$ 和 $K_B$ 由质量作用定律定义：\n$$ K_A = \\frac{[R][A]}{[RA]} $$\n$$ K_B = \\frac{[R][B]}{[RB]} $$\n此处，$[R]$、$[A]$、$[RA]$、$[B]$ 和 $[RB]$ 分别代表游离受体、激动剂、激动剂-受体复合物、拮抗剂和拮抗剂-受体复合物的摩尔浓度。\n\n总受体浓度 $R_T$ 是所有可能状态下受体浓度之和：\n$$ R_T = [R] + [RA] + [RB] $$\n由激动剂占据的受体分数 $\\theta_A$ 定义为：\n$$ \\theta_A = \\frac{[RA]}{R_T} $$\n为了用 $[A]$、$[B]$、$K_A$ 和 $K_B$ 表示 $\\theta_A$，我们首先用 $[RA]$ 来表示 $[R]$ 和 $[RB]$：\n根据 $K_A$ 的定义，我们有 $[R] = \\frac{K_A [RA]}{[A]}$。\n根据 $K_B$ 的定义，我们有 $[RB] = \\frac{[R][B]}{K_B}$。代入 $[R]$ 的表达式可得：\n$$ [RB] = \\frac{K_A [RA] [B]}{[A] K_B} $$\n现在，将 $[R]$ 和 $[RB]$ 的表达式代入 $R_T$ 的方程中：\n$$ R_T = \\frac{K_A [RA]}{[A]} + [RA] + \\frac{K_A [RA] [B]}{[A] K_B} $$\n提取公因子 $[RA]$：\n$$ R_T = [RA] \\left( \\frac{K_A}{[A]} + 1 + \\frac{K_A [B]}{[A] K_B} \\right) $$\n$$ R_T = [RA] \\left( \\frac{K_A + [A] + \\frac{K_A [B]}{K_B}}{[A]} \\right) $$\n$$ R_T = [RA] \\left( \\frac{[A] + K_A \\left(1 + \\frac{[B]}{K_B}\\right)}{[A]} \\right) $$\n那么激动剂占据分数 $\\theta_A = [RA]/R_T$ 为：\n$$ \\theta_A = \\frac{[A]}{[A] + K_A \\left(1 + \\frac{[B]}{K_B}\\right)} $$\n这就是所求的由激动剂占据的受体分数的表达式。\n\n#### 1.2. 最大效应（$E_{\\max}$）的不变性\n\n药理效应 $E$ 与激动剂占据分数 $\\theta_A$ 成正比。设 $E_{\\max,\\text{sys}}$ 为系统的绝对最大效应，对应于 $\\theta_A = 1$。则 $E = E_{\\max,\\text{sys}} \\cdot \\theta_A$。对于给定的拮抗剂浓度 $[B]$，最大效应可以通过计算当激动剂浓度 $[A]$ 趋于无穷大时 $E$ 的极限来求得。这对应于饱和剂量的激动剂。\n\n$$ E_{\\max}([B]) = \\lim_{[A]\\to\\infty} E = E_{\\max,\\text{sys}} \\cdot \\lim_{[A]\\to\\infty} \\theta_A $$\n$$ \\lim_{[A]\\to\\infty} \\theta_A = \\lim_{[A]\\to\\infty} \\frac{[A]}{[A] + K_A \\left(1 + \\frac{[B]}{K_B}\\right)} $$\n为了计算该极限，我们将分子和分母同除以 $[A]$：\n$$ \\lim_{[A]\\to\\infty} \\frac{1}{1 + \\frac{K_A}{[A]} \\left(1 + \\frac{[B]}{K_B}\\right)} = \\frac{1}{1 + 0} = 1 $$\n因此，对于任何有限的拮抗剂浓度 $[B]$，最大激动剂占据率趋近于 $1$。最大效应为：\n$$ E_{\\max}([B]) = E_{\\max,\\text{sys}} \\cdot 1 = E_{\\max,\\text{sys}} $$\n这表明对于纯竞争性拮抗剂，最大效应与其浓度无关。\n\n#### 1.3. 表观半数有效浓度（$\\mathrm{EC50}$）和剂量比（DR）\n\n半数有效浓度 $\\mathrm{EC50}$ 是指效应达到最大值 $50\\%$ 时的激动剂浓度。这发生在 $\\theta_A = 1/2$ 时。在拮抗剂存在的情况下，表观 $\\mathrm{EC50}$（记为 $\\mathrm{EC50}([B])$）是满足此条件的 $[A]$ 的值。\n$$ \\frac{1}{2} = \\frac{[A]}{[A] + K_A \\left(1 + \\frac{[B]}{K_B}\\right)} $$\n设 $[A] = \\mathrm{EC50}([B])$：\n$$ \\mathrm{EC50}([B]) + K_A \\left(1 + \\frac{[B]}{K_B}\\right) = 2 \\cdot \\mathrm{EC50}([B]) $$\n$$ \\mathrm{EC50}([B]) = K_A \\left(1 + \\frac{[B]}{K_B}\\right) $$\n在没有拮抗剂（$[B]=0$）的情况下，$\\mathrm{EC50}$ 为：\n$$ \\mathrm{EC50}(0) = K_A \\left(1 + \\frac{0}{K_B}\\right) = K_A $$\n剂量比 $\\mathrm{DR}([B])$ 是指存在拮抗剂时的表观 $\\mathrm{EC50}$ 与不存在拮抗剂时的 $\\mathrm{EC50}$ 之比：\n$$ \\mathrm{DR}([B]) = \\frac{\\mathrm{EC50}([B])}{\\mathrm{EC50}(0)} = \\frac{K_A \\left(1 + \\frac{[B]}{K_B}\\right)}{K_A} = 1 + \\frac{[B]}{K_B} $$\n\n#### 1.4. Schild关系式\n\nSchild关系式将剂量比和拮抗剂浓度之间的关系线性化。从剂量比的表达式开始：\n$$ \\mathrm{DR}([B]) - 1 = \\frac{[B]}{K_B} $$\n对两边取以10为底的对数，得到Schild方程：\n$$ \\log_{10}(\\mathrm{DR}([B]) - 1) = \\log_{10}\\left(\\frac{[B]}{K_B}\\right) $$\n$$ \\log_{10}(\\mathrm{DR}([B]) - 1) = \\log_{10}([B]) - \\log_{10}(K_B) $$\n该方程是线性形式 $y = mx + c$，其中：\n- $y = \\log_{10}(\\mathrm{DR}([B]) - 1)$\n- $x = \\log_{10}([B])$\n- 斜率为 $m=1$。\n- y轴截距为 $c = -\\log_{10}(K_B)$。\n\n纯竞争性拮抗作用的一个关键特征是Schild图的斜率为1。根据截距 $c$，可以估算拮抗剂的解离常数 $K_B$：\n$$ c = -\\log_{10}(K_B) \\implies \\log_{10}(K_B) = -c \\implies K_B = 10^{-c} $$\n值 $-\\log_{10}(K_B)$ 也称为 $\\mathrm{pA}_2$ 值。\n\n### 2. 数值实现策略\n\n上述理论框架被转化为一个数值模拟。\n\n- **剂量-效应模拟**：对于每个测试案例，我们定义一个对数间隔的激动剂浓度 $[A]$ 网格。假设最大效应 $E_{\\max}$ 为 $1.0$，因此效应 $E$ 在数值上等于激动剂占据分数 $\\theta_A$。对于 $[B]=0$ 的对照组以及每个指定的非零拮抗剂浓度 $[B]$，我们使用推导出的公式 $E([A],[B]) = \\frac{[A]}{[A] + K_A(1 + [B]/K_B)}$ 计算在整个 $[A]$ 网格上的效应曲线。\n\n- **EC50估算**：对于每条效应曲线，网格上的最大效应 $E_{\\max}^{\\text{num}}$ 取为最高激动剂浓度下的效应。半数最大效应为 $E_{\\max}^{\\text{num}}/2$。然后，我们通过在效应曲线的点之间进行线性插值来找到相应的激动剂浓度 $\\mathrm{EC50}$。由于激动剂浓度是对数标度，我们在 $E$ 对 $\\log_{10}([A])$ 的关系上进行插值，以找到半数最大效应值处的 $\\log_{10}(\\mathrm{EC50})$，然后计算 $\\mathrm{EC50} = 10^{\\log_{10}(\\mathrm{EC50})}$。对 $[B]=0$ 的情况进行此操作以获得 $\\mathrm{EC50}(0)$，并对每个非零的 $[B]$ 进行此操作以获得 $\\mathrm{EC50}([B])$。\n\n- **Schild分析**：使用计算出的 $\\mathrm{EC50}$ 值，为每个拮抗剂浓度计算剂量比 $\\mathrm{DR}([B]) = \\mathrm{EC50}([B])/\\mathrm{EC50}(0)$。然后，我们构建用于Schild图回归的变量：$y = \\log_{10}(\\mathrm{DR}([B]) - 1)$ 和 $x = \\log_{10}([B])$。执行线性最小二乘回归以拟合模型 $y = mx + c$，从而得到斜率 $m$ 和截距 $c$。拮抗剂解离常数估算为 $K_B^{\\mathrm{est}} = 10^{-c}$。\n\n- **验证检查**：\n  1. **竞争机制检验**：竞争性拮抗剂的Schild图的理论斜率为 $1$。我们通过检查估算斜率 $m$ 与 $1$ 之间的绝对差值是否在容差 $\\delta=0.05$ 范围内来进行数值验证：$|m - 1| \\le 0.05$。\n  2. **最大效应不变性**：我们验证拮抗剂不会抑制最大效应。对于每个非零拮抗剂浓度 $[B]$，将网格上观察到的最大效应 $E_{\\max}^{\\text{num}}([B])$ 与对照组中的最大效应 $E_{\\max}^{\\text{num}}(0)$ 进行比较。如果对于所有测试的 $[B]$ 值，相对差异都在容差 $\\epsilon=10^{-3}$ 范围内，则检查通过：$\\frac{|E_{\\max}^{\\text{num}}([B]) - E_{\\max}^{\\text{num}}(0)|}{E_{\\max}^{\\text{num}}(0)} \\le 10^{-3}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the GPCR simulation and Schild analysis for all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path\n        (5e-8, 2e-8, [1e-9, 5e-9, 2e-8, 1e-7], (1e-10, 1e-4, 501)),\n        # Case 2: weak antagonist boundary\n        (1e-7, 1e-5, [1e-7, 5e-7, 1e-6, 5e-6], (1e-10, 1e-2, 501)),\n        # Case 3: strong antagonist coverage\n        (1e-9, 1e-9, [1e-10, 3e-10, 1e-9, 3e-9, 1e-8], (1e-12, 1e-3, 601)),\n    ]\n    \n    delta = 0.05\n    epsilon = 1e-3\n\n    results = []\n    for case in test_cases:\n        KA, KB, B_concs, A_grid_spec = case\n        result = analyze_case(KA, KB, B_concs, A_grid_spec, delta, epsilon)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The format [val1,bool1a,bool1b],[val2,bool2a,bool2b]... is achieved by stringifying the inner list\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef analyze_case(KA, KB, B_concs, A_grid_spec, delta, epsilon):\n    \"\"\"\n    Performs the full analysis for a single set of parameters.\n    \n    Args:\n        KA (float): Agonist equilibrium dissociation constant.\n        KB (float): Antagonist equilibrium dissociation constant.\n        B_concs (list of float): List of antagonist concentrations to test.\n        A_grid_spec (tuple): (min, max, num_points) for the agonist concentration grid.\n        delta (float): Tolerance for Schild slope verification.\n        epsilon (float): Relative tolerance for maximal effect invariance check.\n\n    Returns:\n        list: [KB_est, is_competitive, is_emax_invariant]\n    \"\"\"\n    A_grid_min, A_grid_max, A_grid_points = A_grid_spec\n    A_concs_grid = np.logspace(np.log10(A_grid_min), np.log10(A_grid_max), A_grid_points)\n    log_A_concs_grid = np.log10(A_concs_grid)\n\n    def calculate_effect(A, B, KA_val, KB_val):\n        \"\"\"Calculates effect based on agonist occupancy, with E_max=1.0.\"\"\"\n        # Using the derived occupancy formula: theta_A = [A] / ([A] + KA * (1 + [B]/KB))\n        # The effect E is proportional to theta_A, and with E_max=1, E = theta_A.\n        return A / (A + KA_val * (1.0 + B / KB_val))\n\n    # --- Control Case ([B] = 0) ---\n    E_0 = calculate_effect(A_concs_grid, 0.0, KA, KB)\n    # Maximal effect on the grid is the effect at the highest agonist concentration\n    E_max_0 = E_0[-1]\n    half_max_0 = E_max_0 / 2.0\n    # Interpolate on log scale to find log(EC50)\n    log_EC50_0 = np.interp(half_max_0, E_0, log_A_concs_grid)\n    EC50_0 = 10**log_EC50_0\n\n    # --- Antagonist Cases ([B] > 0) ---\n    EC50_B_list = []\n    E_max_B_list = []\n    \n    for B in B_concs:\n        E_B = calculate_effect(A_concs_grid, B, KA, KB)\n        E_max_B = E_B[-1]\n        E_max_B_list.append(E_max_B)\n        \n        half_max_B = E_max_B / 2.0\n        log_EC50_B = np.interp(half_max_B, E_B, log_A_concs_grid)\n        EC50_B_list.append(10**log_EC50_B)\n    \n    # --- Schild Analysis ---\n    DR = np.array(EC50_B_list) / EC50_0\n    \n    # Check for DR > 1. In this ideal model, DR = 1 + [B]/KB > 1, so log(DR-1) is safe.\n    # A small positive value is added to DR - 1 for numerical stability in case DR is extremely close to 1.\n    y = np.log10(DR - 1.0 + np.finfo(float).eps)\n    x = np.log10(np.array(B_concs))\n    \n    # Perform linear regression y = mx + c using numpy.linalg.lstsq\n    A_matrix = np.vstack([x, np.ones(len(x))]).T\n    m, c = np.linalg.lstsq(A_matrix, y, rcond=None)[0]\n    \n    # Estimate KB from the intercept c = -log10(KB)\n    KB_est = 10**(-c)\n\n    # --- Verification Checks ---\n    # 1. Competitive mechanism check: Schild slope should be ~1\n    is_competitive = abs(m - 1.0) = delta\n    \n    # 2. Maximal effect invariance check\n    max_effect_inv_check_results = []\n    for E_max_B in E_max_B_list:\n        relative_diff = abs(E_max_B - E_max_0) / E_max_0\n        max_effect_inv_check_results.append(relative_diff = epsilon)\n    is_emax_invariant = all(max_effect_inv_check_results)\n\n    return [KB_est, is_competitive, is_emax_invariant]\n\nsolve()\n```"
        },
        {
            "introduction": "最后，我们将模型的复杂性提升到一个新的层次，探索变构调节。与直接竞争正构位点的拮抗剂不同，变构调节剂通过结合到受体的不同位点来改变激动剂的效应。本练习旨在揭示变构调节中一个微妙而关键的现象：“探针依赖性”，即同一个变构调节剂对不同激动剂（“探针”）的效能影响可能完全不同。\n\n通过推导和模拟激动剂效能的变化，你将深刻理解变构药物作用的复杂性，并认识到在评估变构调节剂时谨慎选择激动剂探针的重要性。这项练习对于理解现代药物设计中日益重要的变构靶向策略至关重要 。",
            "id": "3887908",
            "problem": "考虑一个G蛋白偶联受体（GPCR）的受体-配体系统，其中一个正构激动剂和一个别构调节剂可以同时结合，且在平衡状态下遵循质量作用定律。受体存在四种构象结合状态：游离受体 $R$、与激动剂结合的受体 $AR$、与调节剂结合的受体 $RM$，以及同时与激动剂和调节剂结合的受体 $ARM$。两种不同的正构激动剂 $A_1$ 和 $A_2$ 竞争同一个正构位点，而单个别构调节剂 $M$ 结合到一个独立的位点。设 $A_1$ 和 $A_2$ 的微观解离常数分别为 $K_{A_1}$ 和 $K_{A_2}$，$M$ 的微观解离常数为 $K_M$。协同相互作用由对 $(A_i, M)$ 的结合协同性参数 $\\alpha_i$ 捕获，其定义为：在存在已结合的 $M$ 的情况下，受体对 $A_i$ 的亲和力按 $\\alpha_i$ 缩放，同样地，在存在已结合的 $A_i$ 的情况下，对 $M$ 的亲和力也与热力学循环约束一致。当调节剂共结合时，激动剂结合受体状态的效能（刺激生成）会通过一个效能缩放因子 $\\beta_i$ 进行调节，该调节是相对于没有调节剂时激动剂结合受体的效能而言的。假设从活性受体占有率到测量响应的转导是单调且时不变的，并在平衡状态下处理该系统。在没有激动剂的情况下，基础活性可忽略不计。\n\n仅使用质量作用定律、受体守恒和别构三元复合物的平衡热力学作为基础，推导在固定调节剂浓度 $[M]$ 下，每种激动剂 $A_i$ 的受体状态的稳态分数占有率，然后推导出在该固定 $[M]$ 下，当 $[A_i]\\to\\infty$ 时，能产生所观察到的最大响应一半的激动剂浓度 $[A_i]$。将在这些条件下产生半数最大响应的激动剂浓度 $[A_i]$ 定义为激动剂 $A_i$ 在调节剂浓度为 $[M]$ 时的效价 $EC50_i([M])$。对于每种激动剂 $A_i$，计算无量纲效价位移比\n$$\nS_i([M]) \\equiv \\frac{EC50_i([M])}{EC50_i(0)}.\n$$\n目标是证明探针依赖性：在别构模型下，同一个调节剂对两种激动剂的效价有不同的改变。您的程序必须实现推导出的表达式，并为指定的测试套件计算 $S_1([M])$ 和 $S_2([M])$。\n\n需明确使用的假设：\n- 平衡结合受质量作用定律支配。\n- 调节剂 $M$ 不与正构位点结合，激动剂 $A_1$ 和 $A_2$ 不与别构位点结合。\n- 结合协同性参数 $\\alpha_i$ 是常数，并反映 $A_i$ 和 $M$ 之间的成对相互作用。\n- 效能缩放参数 $\\beta_i$ 仅在激动剂和调节剂共结合时影响响应；转导是单调的，并依赖于活性占有率。\n- 响应在平衡状态下测量；所有浓度单位为摩尔（$\\mathrm{M}$）。最终报告的值是无量纲比值 $S_i([M])$，因此没有单位。\n\n测试套件（每个案例中，两种激动剂使用相同的调节剂）：\n- 案例 1（理想情况；与 $A_1$ 呈正协同性，与 $A_2$ 呈负协同性）：\n  - $K_{A_1} = 3.0\\times 10^{-8}\\ \\mathrm{M}$, $K_{A_2} = 3.0\\times 10^{-7}\\ \\mathrm{M}$, $K_M = 1.0\\times 10^{-6}\\ \\mathrm{M}$, $[M] = 1.0\\times 10^{-6}\\ \\mathrm{M}$,\n  - $\\alpha_1 = 5.0$, $\\alpha_2 = 0.5$, $\\beta_1 = 1.0$, $\\beta_2 = 1.0$.\n- 案例 2（边界情况；调节剂对两种激动剂均为结合中性）：\n  - $K_{A_1} = 1.0\\times 10^{-8}\\ \\mathrm{M}$, $K_{A_2} = 5.0\\times 10^{-8}\\ \\mathrm{M}$, $K_M = 1.0\\times 10^{-6}\\ \\mathrm{M}$, $[M] = 1.0\\times 10^{-6}\\ \\mathrm{M}$,\n  - $\\alpha_1 = 1.0$, $\\alpha_2 = 1.0$, $\\beta_1 = 2.0$, $\\beta_2 = 0.5$.\n- 案例 3（边缘情况；调节剂相对于其亲和力达到饱和）：\n  - $K_{A_1} = 5.0\\times 10^{-8}\\ \\mathrm{M}$, $K_{A_2} = 2.0\\times 10^{-7}\\ \\mathrm{M}$, $K_M = 1.0\\times 10^{-7}\\ \\mathrm{M}$, $[M] = 1.0\\times 10^{-5}\\ \\mathrm{M}$,\n  - $\\alpha_1 = 10.0$, $\\alpha_2 = 0.1$, $\\beta_1 = 1.0$, $\\beta_2 = 1.0$.\n- 案例 4（边缘情况；调节剂相对于其亲和力非常低）：\n  - $K_{A_1} = 2.0\\times 10^{-8}\\ \\mathrm{M}$, $K_{A_2} = 8.0\\times 10^{-8}\\ \\mathrm{M}$, $K_M = 1.0\\times 10^{-6}\\ \\mathrm{M}$, $[M] = 1.0\\times 10^{-9}\\ \\mathrm{M}$,\n  - $\\alpha_1 = 3.0$, $\\alpha_2 = 0.3$, $\\beta_1 = 1.0$, $\\beta_2 = 1.0$.\n\n您的程序应按 1 到 4 的顺序为每个案例计算元组 $(S_1([M]), S_2([M]))$，并生成单行输出，其中包含一个逗号分隔的八个结果列表，列表用方括号括起，顺序为 $[S_1^{(1)}, S_2^{(1)}, S_1^{(2)}, S_2^{(2)}, S_1^{(3)}, S_2^{(3)}, S_1^{(4)}, S_2^{(4)}]$。每个值应四舍五入到六位小数。输出为无量纲值。",
            "solution": "问题陈述已经过严格审查，并被确定为有效。它在科学上基于药理学受体理论的既定原则，特别是别构三元复合物模型。问题设定良好、客观，并提供了一套完整且一致的定义和参数，从而可以得出一个唯一且有意义的解。效价位移比的推导是定量系统药理学中的一个标准的、非平凡的练习。\n\n解决方案首先从第一性原理出发，推导效价位移比 $S_i([M])$ 的通用表达式。该比率量化了别构调节剂 $M$ 如何改变正构激动剂 $A_i$ 的效价（$EC50$）。\n\n让我们考虑单个激动剂 $A_i$ 和调节剂 $M$ 与受体 $R$ 的结合平衡。该系统涉及四种状态：$R$（游离受体）、$A_iR$（激动剂结合）、$RM$（调节剂结合）和 $A_iRM$（三元复合物）。根据平衡状态下的质量作用定律，我们有以下由微观解离常数定义的关系：\n\n1. 激动剂与游离受体的结合：$R + A_i \\rightleftharpoons A_iR$\n$$K_{A_i} = \\frac{[R][A_i]}{[A_iR]}$$\n2. 调节剂与游离受体的结合：$R + M \\rightleftharpoons RM$\n$$K_M = \\frac{[R][M]}{[RM]}$$\n3. 激动剂与调节剂结合受体的结合：$RM + A_i \\rightleftharpoons A_iRM$\n$$K'_{A_i} = \\frac{[RM][A_i]}{[A_iRM]}$$\n4. 调节剂与激动剂结合受体的结合：$A_iR + M \\rightleftharpoons A_iRM$\n$$K'_{M} = \\frac{[A_iR][M]}{[A_iRM]}$$\n\n热力学细致平衡原理要求任何闭合环路的平衡常数之积为1。对于环路 $R \\to A_iR \\to A_iRM \\to RM \\to R$，这意味着 $K_{A_i} K'_{M} = K_M K'_{A_i}$。\n\n协同性参数 $\\alpha_i$ 定义为调节剂 $M$ 缩放激动剂 $A_i$ 亲和力的因子。亲和力是解离常数的倒数。$A_i$ 对 $RM$ 的亲和力是 $1/K'_{A_i}$，对 $R$ 的亲和力是 $1/K_{A_i}$。因此：\n$$\\frac{1}{K'_{A_i}} = \\frac{\\alpha_i}{K_{A_i}} \\implies K'_{A_i} = \\frac{K_{A_i}}{\\alpha_i}$$\n热力学循环约束确保了这种关系对于 $M$ 的结合是对称的：$K'_{M} = K_M/\\alpha_i$。\n\n我们可以用游离受体浓度 $[R]$ 来表示每种受体状态的浓度：\n$$[A_iR] = \\frac{[R][A_i]}{K_{A_i}}$$\n$$[RM] = \\frac{[R][M]}{K_M}$$\n$$[A_iRM] = \\frac{[RM][A_i]}{K'_{A_i}} = \\frac{([R][M]/K_M)[A_i]}{K_{A_i}/\\alpha_i} = \\frac{\\alpha_i [R][A_i][M]}{K_{A_i}K_M}$$\n\n总受体浓度 $[R]_T$ 是守恒的：\n$$[R]_T = [R] + [A_iR] + [RM] + [A_iRM]$$\n$$[R]_T = [R] \\left( 1 + \\frac{[A_i]}{K_{A_i}} + \\frac{[M]}{K_M} + \\frac{\\alpha_i[A_i][M]}{K_{A_i}K_M} \\right)$$\n对分母 $D$ 进行因式分解，得到：\n$$D = \\left( 1 + \\frac{[M]}{K_M} \\right) + \\frac{[A_i]}{K_{A_i}} \\left( 1 + \\frac{\\alpha_i [M]}{K_M} \\right)$$\n所以，$[R] = [R]_T / D$。\n\n响应（或刺激，$Stim$）被假定为活性、激动剂结合受体状态浓度的函数。在没有基础活性的情况下，活性状态是 $A_iR$ 和 $A_iRM$。设激动剂 $A_i$ 的内在效能为 $\\tau_i$。在三元复合物 $A_iRM$ 中的效能按 $\\beta_i$ 缩放。\n$$Stim_i = \\tau_i [A_iR] + \\tau_i \\beta_i [A_iRM]$$\n$$Stim_i = \\tau_i \\left( \\frac{[R][A_i]}{K_{A_i}} \\right) + \\tau_i \\beta_i \\left( \\frac{\\alpha_i [R][A_i][M]}{K_{A_i}K_M} \\right) = \\frac{\\tau_i [R][A_i]}{K_{A_i}} \\left( 1 + \\frac{\\beta_i \\alpha_i [M]}{K_M} \\right)$$\n代入 $[R] = [R]_T / D$：\n$$Stim_i([A_i]) = \\frac{\\frac{\\tau_i [R]_T [A_i]}{K_{A_i}} \\left( 1 + \\frac{\\beta_i \\alpha_i [M]}{K_M} \\right)}{ \\left( 1 + \\frac{[M]}{K_M} \\right) + \\frac{[A_i]}{K_{A_i}} \\left( 1 + \\frac{\\alpha_i [M]}{K_M} \\right)}$$\n该方程描述了刺激与激动剂浓度 $[A_i]$ 之间的双曲线关系。为了找到 $EC50$，我们将其整理为标准形式 $Y = \\frac{Y_{max} \\cdot X}{EC50 + X}$。我们将分子和分母同除以分母中 $[A_i]$ 的系数，即 $\\frac{1}{K_{A_i}}\\left(1 + \\frac{\\alpha_i[M]}{K_M}\\right)$：\n$$Stim_i([A_i]) = \\frac{ \\tau_i [R]_T \\frac{1 + \\frac{\\beta_i \\alpha_i [M]}{K_M}}{1 + \\frac{\\alpha_i [M]}{K_M}} [A_i] }{ K_{A_i} \\frac{1 + \\frac{[M]}{K_M}}{1 + \\frac{\\alpha_i [M]}{K_M}} + [A_i] }$$\n由此形式，我们确定在固定调节剂浓度 $[M]$ 下的半数最大效应浓度 $EC50_i([M])$：\n$$EC50_i([M]) = K_{A_i} \\frac{1 + \\frac{[M]}{K_M}}{1 + \\frac{\\alpha_i [M]}{K_M}}$$\n注意，效能缩放参数 $\\beta_i$ 影响最大响应，但不影响 $EC50$。\n\n问题要求计算效价位移比 $S_i([M]) \\equiv EC50_i([M]) / EC50_i(0)$。首先，我们在上述表达式中令 $[M]=0$ 来求得 $EC50_i(0)$：\n$$EC50_i(0) = K_{A_i} \\frac{1 + 0}{1 + 0} = K_{A_i}$$\n这证实了在没有调节剂的情况下，$EC50$ 等于激动剂的解离常数，这与该模型的预期相符。\n\n现在，我们计算该比率：\n$$S_i([M]) = \\frac{EC50_i([M])}{EC50_i(0)} = \\frac{K_{A_i} \\frac{1 + \\frac{[M]}{K_M}}{1 + \\frac{\\alpha_i [M]}{K_M}}}{K_{A_i}}$$\n$$S_i([M]) = \\frac{1 + \\frac{[M]}{K_M}}{1 + \\frac{\\alpha_i [M]}{K_M}}$$\n这个最终表达式与激动剂自身的结合特性（$K_{A_i}$）和效能参数（$\\beta_i$）无关，仅取决于调节剂的特性（$K_M, [M]$）及其与激动剂-受体复合物的相互作用（$\\alpha_i$）。这就是需要实现的公式。\n\n对于每个测试案例，我们使用提供的 $\\alpha_1$, $\\alpha_2$, $K_M$ 和 $[M]$ 值来计算 $S_1([M])$ 和 $S_2([M])$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the potency shift ratio for two agonists in the presence of an allosteric modulator\n    based on the allosteric ternary complex model.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (happy path; PAM for A1, NAM for A2)\n        {'K_A1': 3.0e-8, 'K_A2': 3.0e-7, 'K_M': 1.0e-6, 'M_conc': 1.0e-6, \n         'alpha1': 5.0, 'alpha2': 0.5, 'beta1': 1.0, 'beta2': 1.0},\n        \n        # Case 2 (boundary; binding-neutral for both agonists)\n        {'K_A1': 1.0e-8, 'K_A2': 5.0e-8, 'K_M': 1.0e-6, 'M_conc': 1.0e-6, \n         'alpha1': 1.0, 'alpha2': 1.0, 'beta1': 2.0, 'beta2': 0.5},\n        \n        # Case 3 (edge; saturating modulator)\n        {'K_A1': 5.0e-8, 'K_A2': 2.0e-7, 'K_M': 1.0e-7, 'M_conc': 1.0e-5, \n         'alpha1': 10.0, 'alpha2': 0.1, 'beta1': 1.0, 'beta2': 1.0},\n\n        # Case 4 (edge; very low modulator)\n        {'K_A1': 2.0e-8, 'K_A2': 8.0e-8, 'K_M': 1.0e-6, 'M_conc': 1.0e-9, \n         'alpha1': 3.0, 'alpha2': 0.3, 'beta1': 1.0, 'beta2': 1.0},\n    ]\n\n    def calculate_potency_shift(alpha, K_M, M_conc):\n        \"\"\"\n        Calculates the potency shift ratio S_i([M]) for an agonist A_i.\n\n        The formula is derived from the allosteric ternary complex model:\n        S_i([M]) = (1 + [M]/K_M) / (1 + alpha_i * [M]/K_M)\n\n        Args:\n            alpha (float): The binding cooperativity parameter for the agonist-modulator pair.\n            K_M (float): The dissociation constant of the modulator.\n            M_conc (float): The concentration of the modulator.\n\n        Returns:\n            float: The dimensionless potency shift ratio.\n        \"\"\"\n        # A dimensionless concentration of the modulator is a useful intermediate.\n        m_normalized = M_conc / K_M\n        \n        numerator = 1.0 + m_normalized\n        denominator = 1.0 + alpha * m_normalized\n        \n        # Avoid division by zero, although not expected with valid parameters (alpha >= 0).\n        if denominator == 0:\n            return np.inf\n\n        return numerator / denominator\n\n    results = []\n    for case in test_cases:\n        # For each case, calculate the shift for agonist 1 and agonist 2\n        S1 = calculate_potency_shift(case['alpha1'], case['K_M'], case['M_conc'])\n        S2 = calculate_potency_shift(case['alpha2'], case['K_M'], case['M_conc'])\n        \n        results.append(S1)\n        results.append(S2)\n\n    # Format the final output as a single comma-separated list of values\n    # rounded to six decimal places, enclosed in square brackets.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}