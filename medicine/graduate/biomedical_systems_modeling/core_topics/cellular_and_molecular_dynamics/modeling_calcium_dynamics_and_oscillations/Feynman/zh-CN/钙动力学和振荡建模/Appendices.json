{
    "hands_on_practices": [
        {
            "introduction": "理论模型在捕捉生物过程的复杂性方面非常出色，但其非线性特性往往使解析解变得遥不可及。此练习介绍了一种强大的技术：通过构建一个分段线性的“漫画”模型来简化一个复杂的系统，如此处所示的Li-Rinzel钙振荡模型。这种方法保留了原始模型关键的零斜线几何形状，使我们能够解析计算振荡周期，从而深刻理解快慢变量相互作用如何驱动松弛振荡的核心机制 。",
            "id": "3904781",
            "problem": "考虑一个关于 1,4,5-三磷酸肌醇 (IP3) 介导的细胞内钙振荡的简化 Li–Rinzel 模型，该模型被表述为一个关于胞质钙浓度和失活门的二维慢-快系统，\n$$\n\\frac{dc}{dt} \\;=\\; F(c,h), \\qquad \\frac{dh}{dt} \\;=\\; \\epsilon\\,\\Phi(c,h),\n$$\n其中 $c$ 是无量纲化的胞质钙浓度，$h$ 是可用的（非失活的）IP3 受体亚基的比例，并且 $0 < \\epsilon \\ll 1$ 表示时间尺度的分离。钙零斜线是集合 $\\{(c,h):F(c,h)=0\\}$，$h$-零斜线是集合 $\\{(c,h):\\Phi(c,h)=0\\}$。在表现出弛豫振荡的经典 Li–Rinzel 区域中，$c$-零斜线呈类三次曲线形式（在 $(c,h)$-平面上为 N 形曲线），有两个折叠点，而 $h$-零斜线关于 $c$ 单调递增。你将构建一个保留这种零斜线几何形状的分段线性简化模型，并用它从慢-快动力学的基本原理出发计算振荡周期。\n\n假设 $c$-零斜线 $\\{F(c,h)=0\\}$ 的分段线性近似如下，该近似保留了位于 $h=h_{-}$ 和 $h=h_{+}$ （其中 $h_{-} < h_{+}$）的两个折叠点。",
            "solution": "问题要求计算 Li–Rinzel 模型的分段线性简化模型中弛豫振荡的周期 $T$。该系统由以下慢-快动力学描述：\n$$\n\\frac{dc}{dt} = F(c,h) \\qquad (1)\n$$\n$$\n\\frac{dh}{dt} = \\epsilon\\,\\Phi(c,h) \\qquad (2)\n$$\n其中 $c$ 是快变量，$h$ 是慢变量，时间尺度分离参数为 $0  \\epsilon \\ll 1$。\n\n振荡是在 $(c,h)$-平面上的一个极限环。根据慢-快动力系统的原理，这种弛豫振荡的周期主要由沿 $c$-零斜线 $\\{ (c,h) : F(c,h)=0 \\}$ 的稳定分支移动所花费的时间决定。假设稳定分支之间的跳跃是瞬时的，对总周期没有贡献。\n\n该循环包括两个慢速阶段：\n1.  沿着左稳定分支 $\\mathcal{L}$ 的慢速移动，在此期间 $h$ 从 $h_{-}$ 增加到 $h_{+}$。此阶段所需时间为 $T_L$。\n2.  沿着右稳定分支 $\\mathcal{R}$ 的慢速移动，在此期间 $h$ 从 $h_{+}$ 减小到 $h_{-}$。此阶段所需时间为 $T_R$。\n\n总振荡周期是这两个慢速阶段持续时间的总和：\n$$\nT = T_L + T_R\n$$\n\n我们现在将通过沿每个分支对慢变量 $h$ 的方程进行积分来计算 $T_L$ 和 $T_R$。\n\n**计算左分支上的渡越时间 ($T_L$):**\n\n在左稳定分支 $\\mathcal{L}$ 上，$h$ 的动力学由 $\\frac{dh}{dt} = \\epsilon \\Phi(c,h)$ 给出。问题为此分支上的 $\\Phi$ 提供了一个简化形式：\n$$\n\\frac{dh}{dt} = \\epsilon (H_L - K_L h)\n$$\n其中 $h$ 从 $h(0) = h_{-}$ 演化到 $h(T_L) = h_{+}$。这是一个一阶线性常微分方程，可以通过分离变量法求解：\n$$\n\\frac{dh}{H_L - K_L h} = \\epsilon \\, dt\n$$\n我们在此阶段的持续时间内对两边进行积分。左边对 $h$ 从 $h_{-}$ 到 $h_{+}$ 积分，右边对 $t$ 从 $0$ 到 $T_L$ 积分：\n$$\n\\int_{h_{-}}^{h_{+}} \\frac{dh}{H_L - K_L h} = \\int_{0}^{T_L} \\epsilon \\, dt\n$$\n右侧的积分很简单：\n$$\n\\int_{0}^{T_L} \\epsilon \\, dt = \\epsilon T_L\n$$\n左侧的积分是：\n$$\n\\int \\frac{dh}{H_L - K_L h} = -\\frac{1}{K_L} \\ln|H_L - K_L h|\n$$\n计算定积分，并注意到对于 $h \\in [h_{-}, h_{+}]=[0.2, 0.8]$，参数 $H_L - K_L h = 0.95 - h$ 是正的，我们有：\n$$\n\\left[ -\\frac{1}{K_L} \\ln(H_L - K_L h) \\right]_{h_{-}}^{h_{+}} = -\\frac{1}{K_L} \\left( \\ln(H_L - K_L h_{+}) - \\ln(H_L - K_L h_{-}) \\right) = \\frac{1}{K_L} \\ln\\left(\\frac{H_L - K_L h_{-}}{H_L - K_L h_{+}}\\right)\n$$\n令两边的结果相等，得到：\n$$\n\\epsilon T_L = \\frac{1}{K_L} \\ln\\left(\\frac{H_L - K_L h_{-}}{H_L - K_L h_{+}}\\right)\n$$\n解出 $T_L$：\n$$\nT_L = \\frac{1}{\\epsilon K_L} \\ln\\left(\\frac{H_L - K_L h_{-}}{H_L - K_L h_{+}}\\right) \\qquad (3)\n$$\n\n**计算右分支上的渡越时间 ($T_R$):**\n\n类似地，在右稳定分支 $\\mathcal{R}$ 上，$h$ 的动力学由下式给出：\n$$\n\\frac{dh}{dt} = \\epsilon (H_R - K_R h)\n$$\n在这里，$h$ 从 $h(0) = h_{+}$ 演化到 $h(T_R) = h_{-}$。我们再次分离变量并积分：\n$$\n\\int_{h_{+}}^{h_{-}} \\frac{dh}{H_R - K_R h} = \\int_{0}^{T_R} \\epsilon \\, dt = \\epsilon T_R\n$$\n对于左边的积分，我们注意到对于 $h \\in [h_{-}, h_{+}]=[0.2, 0.8]$，参数 $H_R - K_R h = 0.05 - h$ 是负的。因此，$|H_R - K_R h| = -(H_R - K_R h) = K_R h - H_R$。\n$$\n\\int_{h_{+}}^{h_{-}} \\frac{dh}{H_R - K_R h} = \\left[ -\\frac{1}{K_R} \\ln(K_R h - H_R) \\right]_{h_{+}}^{h_{-}}\n$$\n$$\n= -\\frac{1}{K_R} \\left( \\ln(K_R h_{-} - H_R) - \\ln(K_R h_{+} - H_R) \\right) = \\frac{1}{K_R} \\ln\\left(\\frac{K_R h_{+} - H_R}{K_R h_{-} - H_R}\\right)\n$$\n将此结果与 $\\epsilon T_R$ 相等，得到：\n$$\nT_R = \\frac{1}{\\epsilon K_R} \\ln\\left(\\frac{K_R h_{+} - H_R}{K_R h_{-} - H_R}\\right) \\qquad (4)\n$$\n\n**计算总周期 ($T$):**\n\n总周期为 $T = T_L + T_R$。代入表达式 (3) 和 (4)：\n$$\nT = \\frac{1}{\\epsilon K_L} \\ln\\left(\\frac{H_L - K_L h_{-}}{H_L - K_L h_{+}}\\right) + \\frac{1}{\\epsilon K_R} \\ln\\left(\\frac{K_R h_{+} - H_R}{K_R h_{-} - H_R}\\right)\n$$\n给定的参数值为：\n$\\epsilon = 0.05$ s$^{-1}$，$h_{-} = 0.2$，$h_{+} = 0.8$，$H_L = 0.95$，$K_L = 1$，$H_R = 0.05$，$K_R = 1$。\n\n将这些值代入 $T_L$ 的表达式中：\n$$\nT_L = \\frac{1}{0.05 \\times 1} \\ln\\left(\\frac{0.95 - 1 \\times 0.2}{0.95 - 1 \\times 0.8}\\right) = 20 \\ln\\left(\\frac{0.75}{0.15}\\right) = 20 \\ln(5)\n$$\n将这些值代入 $T_R$ 的表达式中：\n$$\nT_R = \\frac{1}{0.05 \\times 1} \\ln\\left(\\frac{1 \\times 0.8 - 0.05}{1 \\times 0.2 - 0.05}\\right) = 20 \\ln\\left(\\frac{0.75}{0.15}\\right) = 20 \\ln(5)\n$$\n总周期为：\n$$\nT = T_L + T_R = 20 \\ln(5) + 20 \\ln(5) = 40 \\ln(5)\n$$\n现在，我们对此表达式进行数值计算。5 的自然对数约等于 $\\ln(5) \\approx 1.6094379$。\n$$\nT = 40 \\times 1.6094379 \\ldots \\approx 64.377516 \\text{ s}\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\nT \\approx 64.38 \\text{ s}\n$$\n这就是在给定的分段线性模型中振荡的周期。",
            "answer": "$$\n\\boxed{64.38}\n$$"
        },
        {
            "introduction": "钙信号通常在空间和时间上演化，形成复杂的波和梯度，这需要使用反应-扩散方程进行建模。然而，对这些偏微分方程进行数值求解带来了独特的挑战，尤其是确保模拟的稳定性。本练习将引导您完成对一个缓冲扩散系统的显式数值格式进行稳定性分析的过程，最终推导出时间步长的上限，该上限与最快的反应速率和空间网格间距直接相关 。",
            "id": "3904753",
            "problem": "考虑由单一位点固定缓冲剂缓冲的胞浆钙。设 $c(\\mathbf{x},t)$ 表示游离钙浓度，$b(\\mathbf{x},t)$ 表示结合缓冲剂的浓度。游离缓冲剂为 $f(\\mathbf{x},t) = B_T - b(\\mathbf{x},t)$，其中 $B_T$ 是空间均匀的总缓冲剂浓度。钙以扩散系数 $D_c$ 扩散，而缓冲剂是固定的。结合遵循质量作用动力学，正向速率常数为 $k_{\\mathrm{on}}$，逆向速率常数为 $k_{\\mathrm{off}}$。控制偏微分方程 (PDE) 为\n$$\n\\frac{\\partial c}{\\partial t} = D_c \\nabla^2 c - k_{\\mathrm{on}}\\,c\\,f + k_{\\mathrm{off}}\\,b,\\qquad\n\\frac{\\partial b}{\\partial t} = k_{\\mathrm{on}}\\,c\\,f - k_{\\mathrm{off}}\\,b,\n$$\n其中 $f = B_T - b$。假设存在一个空间均匀的稳态 $(c^\\ast,b^\\ast)$，且 $f^\\ast = B_T - b^\\ast$。\n\n在间距为 $\\Delta x_1,\\dots,\\Delta x_d$ 的 $d$ 维笛卡尔网格上使用二阶中心差分拉普拉斯算子对空间进行离散化，并使用步长为 $\\Delta t$ 的前向欧拉 (FE) 方法对时间进行离散化。您可以假设区域是周期性的或足够大，以至于对内部点进行线性稳定性的傅里叶模式分析是合理的。\n\n从基本建模原理（菲克扩散定律和质量作用动力学）出发，并围绕 $(c^\\ast,b^\\ast)$ 对反应项进行线性化，将“最快反应速率” $k_{\\mathrm{fast}}$ 定义为在 $(c^\\ast,b^\\ast)$ 处求值的局部 $2\\times 2$ 反应雅可比矩阵最负特征值的绝对值，并用 $k_{\\mathrm{on}}$、$k_{\\mathrm{off}}$、$c^\\ast$ 和 $f^\\ast$ 显式计算 $k_{\\mathrm{fast}}$。\n\n然后，通过分析空间傅里叶模式的线性化前向欧拉更新，并仅使用离散拉普拉斯算子谱的性质，推导出保证所有空间模式线性稳定的显式格式的充分稳定性约束。将允许的最大时间步长 $\\Delta t_{\\max}$ 表示为以 $k_{\\mathrm{fast}}$、$D_c$、$d$ 和网格间距 $\\Delta x_1,\\dots,\\Delta x_d$ 表示的单个闭式解析表达式。提供 $\\Delta t_{\\max}$ 的最终表达式（最终表达式中无需单位）。无需进行数值计算。",
            "solution": "该问题的解决分为两个主要部分：首先，我们计算最快的反应速率 $k_{\\mathrm{fast}}$；其次，我们推导数值格式的稳定性约束以找到 $\\Delta t_{\\max}$。\n\n**第一部分：计算 $k_{\\mathrm{fast}}$**\n\n系统的反应部分由以下常微分方程组描述：\n$$\n\\frac{dc}{dt} = -k_{\\mathrm{on}}\\,c\\,(B_T - b) + k_{\\mathrm{off}}\\,b = R_c(c,b)\n$$\n$$\n\\frac{db}{dt} = k_{\\mathrm{on}}\\,c\\,(B_T - b) - k_{\\mathrm{off}}\\,b = R_b(c,b)\n$$\n我们通过计算其在稳态 $(c^\\ast, b^\\ast)$ 处的雅可比矩阵 $J_R$ 来线性化该反应系统。\n$$\nJ_R = \\begin{pmatrix} \\frac{\\partial R_c}{\\partial c}  \\frac{\\partial R_c}{\\partial b} \\\\ \\frac{\\partial R_b}{\\partial c}  \\frac{\\partial R_b}{\\partial b} \\end{pmatrix} = \\begin{pmatrix} -k_{\\mathrm{on}}f  k_{\\mathrm{on}}c + k_{\\mathrm{off}} \\\\ k_{\\mathrm{on}}f  -(k_{\\mathrm{on}}c + k_{\\mathrm{off}}) \\end{pmatrix}\n$$\n在稳态 $(c^\\ast, b^\\ast)$ 处（其中 $f=f^\\ast = B_T - b^\\ast$）对其进行求值：\n$$\nJ_R^\\ast = \\begin{pmatrix} -k_{\\mathrm{on}}f^\\ast  k_{\\mathrm{on}}c^\\ast + k_{\\mathrm{off}} \\\\ k_{\\mathrm{on}}f^\\ast  -(k_{\\mathrm{on}}c^\\ast + k_{\\mathrm{off}}) \\end{pmatrix}\n$$\n为了找到 $J_R^\\ast$ 的特征值 $\\lambda$，我们求解特征方程 $\\det(J_R^\\ast - \\lambda I) = 0$：\n$$\n(-k_{\\mathrm{on}}f^\\ast - \\lambda)(- (k_{\\mathrm{on}}c^\\ast + k_{\\mathrm{off}}) - \\lambda) - (k_{\\mathrm{on}}f^\\ast)(k_{\\mathrm{on}}c^\\ast + k_{\\mathrm{off}}) = 0\n$$\n展开后可得：\n$$\n\\lambda^2 + \\lambda(k_{\\mathrm{on}}f^\\ast + k_{\\mathrm{on}}c^\\ast + k_{\\mathrm{off}}) = 0\n$$\n$$\n\\lambda \\left( \\lambda + (k_{\\mathrm{on}}(c^\\ast + f^\\ast) + k_{\\mathrm{off}}) \\right) = 0\n$$\n特征值为 $\\lambda_1 = 0$ 和 $\\lambda_2 = -(k_{\\mathrm{on}}(c^\\ast + f^\\ast) + k_{\\mathrm{off}})$。零特征值反映了总物质守恒。根据定义，$k_{\\mathrm{fast}}$ 是最负特征值的绝对值，因此：\n$$\nk_{\\mathrm{fast}} = |\\lambda_2| = k_{\\mathrm{on}}(c^\\ast + f^\\ast) + k_{\\mathrm{off}}\n$$\n\n**第二部分：推导稳定性约束 $\\Delta t_{\\max}$**\n\n我们对应用于线性化系统的显式欧拉格式进行冯·诺依曼稳定性分析。线性化的偏微分方程系统为：\n$$\n\\frac{\\partial}{\\partial t} \\begin{pmatrix} \\delta c \\\\ \\delta b \\end{pmatrix} = \\begin{pmatrix} D_c \\nabla^2  0 \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} \\delta c \\\\ \\delta b \\end{pmatrix} + J_R^\\ast \\begin{pmatrix} \\delta c \\\\ \\delta b \\end{pmatrix}\n$$\n对于一个傅里叶模式 $e^{i\\mathbf{k} \\cdot \\mathbf{x}}$，离散拉普拉斯算子 $\\nabla_h^2$ 的作用相当于乘以其特征值 $\\Lambda_\\mathbf{k} = -\\sum_{j=1}^{d} \\frac{4}{(\\Delta x_j)^2} \\sin^2\\left(\\frac{k_j \\Delta x_j}{2}\\right)$。半离散化系统的矩阵为：\n$$\nM_{\\mathbf{k},h} = \\begin{pmatrix} D_c \\Lambda_\\mathbf{k}  0 \\\\ 0  0 \\end{pmatrix} + J_R^\\ast = \\begin{pmatrix} D_c \\Lambda_\\mathbf{k} - k_{\\mathrm{on}}f^\\ast  k_{\\mathrm{on}}c^\\ast + k_{\\mathrm{off}} \\\\ k_{\\mathrm{on}}f^\\ast  -(k_{\\mathrm{on}}c^\\ast + k_{\\mathrm{off}}) \\end{pmatrix}\n$$\n显式欧拉法的稳定性要求，对于 $M_{\\mathbf{k},h}$ 的所有特征值 $\\mu$，都必须满足 $|1 + \\Delta t \\mu| \\le 1$。一个充分的稳定性条件可以通过界定谱半径来获得：$\\Delta t \\cdot \\max_{\\mathbf{k}} \\rho(-M_{\\mathbf{k},h}) \\le 2$。我们可以使用无穷范数（最大绝对行和）来界定谱半径 $\\rho(A) \\le \\|A\\|_\\infty$。\n\n$M_{\\mathbf{k},h}$ 的绝对行和为：\n第一行：$S_1 = |D_c \\Lambda_\\mathbf{k} - k_{\\mathrm{on}}f^\\ast| + |k_{\\mathrm{on}}c^\\ast + k_{\\mathrm{off}}| = -D_c \\Lambda_\\mathbf{k} + k_{\\mathrm{on}}f^\\ast + k_{\\mathrm{on}}c^\\ast + k_{\\mathrm{off}} = -D_c \\Lambda_\\mathbf{k} + k_{\\mathrm{fast}}$（因为 $\\Lambda_\\mathbf{k} \\le 0$）。\n第二行：$S_2 = |k_{\\mathrm{on}}f^\\ast| + |-(k_{\\mathrm{on}}c^\\ast + k_{\\mathrm{off}})| = k_{\\mathrm{on}}f^\\ast + k_{\\mathrm{on}}c^\\ast + k_{\\mathrm{off}} = k_{\\mathrm{fast}}$。\n\n因此，$\\|M_{\\mathbf{k},h}\\|_\\infty = \\max(S_1, S_2) = -D_c \\Lambda_\\mathbf{k} + k_{\\mathrm{fast}}$。\n为了得到一个对所有模式都有效的条件，我们必须使该界限在所有 $\\mathbf{k}$ 上最大化：\n$$\n\\max_{\\mathbf{k}} \\rho(-M_{\\mathbf{k},h}) \\le \\max_{\\mathbf{k}} (-D_c \\Lambda_\\mathbf{k} + k_{\\mathrm{fast}}) = D_c (\\max_{\\mathbf{k}}(-\\Lambda_\\mathbf{k})) + k_{\\mathrm{fast}}\n$$\n$-\\Lambda_\\mathbf{k}$ 的最大值在最高频模式下达到，此时 $\\sin^2(\\cdot)=1$：\n$$\n\\max_{\\mathbf{k}}(-\\Lambda_\\mathbf{k}) = \\sum_{j=1}^{d} \\frac{4}{(\\Delta x_j)^2} = 4 \\sum_{j=1}^{d} \\frac{1}{(\\Delta x_j)^2}\n$$\n将此代入，我们得到谱半径的上界：\n$$\n\\max_{\\mathbf{k}} \\rho(-M_{\\mathbf{k},h}) \\le 4 D_c \\sum_{j=1}^{d} \\frac{1}{(\\Delta x_j)^2} + k_{\\mathrm{fast}}\n$$\n充分的稳定性条件为：\n$$\n\\Delta t \\left( k_{\\mathrm{fast}} + 4 D_c \\sum_{j=1}^{d} \\frac{1}{(\\Delta x_j)^2} \\right) \\le 2\n$$\n由此，允许的最大时间步长 $\\Delta t_{\\max}$ 为：\n$$\n\\Delta t_{\\max} = \\frac{2}{k_{\\mathrm{fast}} + 4 D_c \\sum_{j=1}^{d} \\frac{1}{(\\Delta x_j)^2}}\n$$\n这个表达式结合了来自反应（由 $k_{\\mathrm{fast}}$ 决定）和扩散（由 $D_c$ 和网格间距 $\\Delta x_j$ 决定）的最快时间尺度的贡献，是显式方法在反应-扩散系统中的典型稳定性约束。",
            "answer": "$$\\boxed{\\frac{2}{k_{\\mathrm{fast}} + 4 D_c \\sum_{j=1}^{d} \\frac{1}{(\\Delta x_j)^2}}}$$"
        },
        {
            "introduction": "许多生物模型，特别是涉及离子通道门控或酶促开关的模型，其动力学在特定阈值处会发生急剧变化，从而形成分段光滑系统。准确模拟这些系统需要精确的事件检测技术，以在不产生显著数值误差的情况下处理这些不连续性。这项实践任务是设计和分析一个用于钙浓度阈值穿越的事件检测算法，比较朴素方法和基于插值的精确方法，从而揭示在模拟这些关键生物事件时提高数值精度的实用策略 。",
            "id": "3904743",
            "problem": "要求您设计并分析一种用于分段平滑胞质钙浓度动力学模型中阈值穿越的事件检测方法。考虑一个单室胞质钙浓度 $c(t)$，其受质量守恒和通量平衡控制，其中通量被假定为集总且充分混合的。胞质接收恒定的流入，并通过有效的线性外排失去钙，而一个阈值触发的释放项仅在胞质钙超过阈值时从内部储存中添加钙。该模型定义为\n$$\n\\frac{dc}{dt} = J_{\\mathrm{in}} - k_{\\mathrm{eff}}\\,c + H\\!\\left(c - c_{\\mathrm{th}}\\right)\\,v_{\\mathrm{rel}}\\left(c_s - c\\right),\n$$\n其中，$J_{\\mathrm{in}}$ 是恒定流入（单位：微摩尔/秒），$k_{\\mathrm{eff}}$ 是有效的一级外排速率常数（单位：/秒），$H$ 是亥维赛阶跃函数，$c_{\\mathrm{th}}$ 是阈值浓度（单位：微摩尔），$v_{\\mathrm{rel}}$ 是通道打开时的比例释放速率（单位：/秒），$c_s$ 是储存钙浓度（单位：微摩尔），在所关注的短时间尺度上被视为常数。我们感兴趣的阈值事件是第一个时间 $t^\\star$，使得 $c(t^\\star) = c_{\\mathrm{th}}$ 并且是向上穿越，即对于 $t  t^\\star$ 有 $c(t)  c_{\\mathrm{th}}$，而在 $t^\\star$ 时有 $c(t) \\ge c_{\\mathrm{th}}$。\n\n在达到阈值之前，释放项是不活动的，动力学由线性时不变常微分方程控制\n$$\n\\frac{dc}{dt} = J_{\\mathrm{in}} - k_{\\mathrm{eff}}\\,c,\n$$\n其解为\n$$\nc(t) = c_{\\infty} + \\left(c_0 - c_{\\infty}\\right)e^{-k_{\\mathrm{eff}} t},\\quad c_{\\infty} = \\frac{J_{\\mathrm{in}}}{k_{\\mathrm{eff}}},\n$$\n其中 $c_0$ 是 $t=0$ 时的初始胞质浓度。如果从下方发生向上穿越，则精确的阈值穿越时间 $t^\\star$ 满足\n$$\nc_{\\mathrm{th}} = c_{\\infty} + \\left(c_0 - c_{\\infty}\\right)e^{-k_{\\mathrm{eff}} t^\\star},\n$$\n因此可以通过给定容许参数求解 $t^\\star$ 来确定。\n\n您的任务是：\n1. 使用步长 $h$ 为事件前动力学（即当 $c(t)  c_{\\mathrm{th}}$ 时）实现一个固定步长的显式欧拉积分器，并计算第一个使得 $c_{n+1} \\ge c_{\\mathrm{th}}$ 的离散采样时间 $t_{n+1}$。这是一种在步长内没有任何优化的朴素事件检测方法。\n2. 实现一种步内事件检测方法，通过在最后一个低于阈值的样本和第一个等于或高于阈值的样本之间进行线性插值，来优化步内的穿越时间。具体来说，如果 $c_n  c_{\\mathrm{th}} \\le c_{n+1}$，则用 $\\alpha = \\dfrac{c_{\\mathrm{th}} - c_n}{c_{n+1} - c_n}$ 来近似穿越时间 $t_{\\mathrm{lin}} = t_n + \\alpha h$。\n3. 使用事件前的解析解推导并实现精确的阈值穿越时间 $t^\\star$。如果 $c_0 \\ge c_{\\mathrm{th}}$，定义 $t^\\star = 0$。如果 $c_{\\infty} \\le c_{\\mathrm{th}}$ 且 $c_0  c_{\\mathrm{th}}$，则定义在有限时间内不发生穿越。\n4. 对每个测试用例，计算三个指标：朴素时间的绝对误差 $|t_{n+1} - t^\\star|$（单位：秒，四舍五入到六位小数），优化时间的绝对误差 $|t_{\\mathrm{lin}} - t^\\star|$（单位：秒，四舍五入到六位小数），以及朴素过冲幅度 $c_{n+1} - c_{\\mathrm{th}}$（单位：微摩尔，四舍五入到六位小数）。如果在模拟范围内没有发生穿越，或者由于 $c_{\\infty} \\le c_{\\mathrm{th}}$ 导致 $t^\\star$ 未定义，则所有三个指标均输出 $0.0$。如果 $c_0 \\ge c_{\\mathrm{th}}$，则所有三个指标均输出 $0.0$。\n\n基本和物理建模假设：\n- 通量平衡适用于一个充分混合的胞质室，得到 $\\dfrac{dc}{dt}$ 等于流入和流出项的总和。\n- 事件前动力学由一个稳定的线性时不变系统控制，其精确解已给出。\n- 阈值触发的释放仅在穿越后激活，不影响事件前的轨迹。\n\n测试套件：\n使用以下五组参数，每组参数都用与微摩尔（浓度）和秒（时间）一致的物理单位表示。\n- 案例 1 (一般向上穿越)：$J_{\\mathrm{in}} = 0.06$ 微摩尔/秒, $k_{\\mathrm{eff}} = 0.02$ /秒, $c_{\\mathrm{th}} = 0.4$ 微摩尔, $c_0 = 0.05$ 微摩尔, $h = 0.2$ 秒, $t_{\\mathrm{end}} = 100$ 秒, $v_{\\mathrm{rel}} = 0.5$ /秒, $c_s = 400$ 微摩尔。\n- 案例 2 (接近阈值的初始条件)：$J_{\\mathrm{in}} = 0.06$ 微摩尔/秒, $k_{\\mathrm{eff}} = 0.02$ /秒, $c_{\\mathrm{th}} = 0.4$ 微摩尔, $c_0 = 0.399$ 微摩尔, $h = 0.5$ 秒, $t_{\\mathrm{end}} = 100$ 秒, $v_{\\mathrm{rel}} = 0.5$ /秒, $c_s = 400$ 微摩尔。\n- 案例 3 (无穿越，从下方渐近于阈值)：$J_{\\mathrm{in}} = 0.008$ 微摩尔/秒, $k_{\\mathrm{eff}} = 0.02$ /秒, $c_{\\mathrm{th}} = 0.4$ 微摩尔, $c_0 = 0.05$ 微摩尔, $h = 0.2$ 秒, $t_{\\mathrm{end}} = 100$ 秒, $v_{\\mathrm{rel}} = 0.5$ /秒, $c_s = 400$ 微摩尔。\n- 案例 4 (初始位于阈值)：$J_{\\mathrm{in}} = 0.06$ 微摩尔/秒, $k_{\\mathrm{eff}} = 0.02$ /秒, $c_{\\mathrm{th}} = 0.4$ 微摩尔, $c_0 = 0.4$ 微摩尔, $h = 0.1$ 秒, $t_{\\mathrm{end}} = 100$ 秒, $v_{\\mathrm{rel}} = 0.5$ /秒, $c_s = 400$ 微摩尔。\n- 案例 5 (粗步长穿越)：$J_{\\mathrm{in}} = 0.8$ 微摩尔/秒, $k_{\\mathrm{eff}} = 0.01$ /秒, $c_{\\mathrm{th}} = 0.5$ 微摩尔, $c_0 = 0.05$ 微摩尔, $h = 1.0$ 秒, $t_{\\mathrm{end}} = 50$ 秒, $v_{\\mathrm{rel}} = 0.5$ /秒, $c_s = 400$ 微摩尔。\n\n输出规范：\n- 单位：时间误差以秒为单位报告，过冲幅度以微摩尔为单位报告。将每个报告值四舍五入到六位小数。\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须恰好包含十五个数字，按案例顺序分组：$[|t_{n+1} - t^\\star|_{\\mathrm{案例\\ 1}}, |t_{\\mathrm{lin}} - t^\\star|_{\\mathrm{案例\\ 1}}, \\mathrm{过冲}_{\\mathrm{案例\\ 1}}, |t_{n+1} - t^\\star|_{\\mathrm{案例\\ 2}}, |t_{\\mathrm{lin}} - t^\\star|_{\\mathrm{案例\\ 2}}, \\mathrm{过冲}_{\\mathrm{案例\\ 2}}, \\ldots, |t_{n+1} - t^\\star|_{\\mathrm{案例\\ 5}}, |t_{\\mathrm{lin}} - t^\\star|_{\\mathrm{案例\\ 5}}, \\mathrm{过冲}_{\\mathrm{案例\\ 5}}]$。",
            "solution": "我们从一个充分混合的胞质室中的通量平衡开始。令 $c(t)$ 表示以微摩尔为单位的胞质游离钙浓度，并考虑流入、流出和阈值触发的释放。守恒定律规定\n$$\n\\frac{dc}{dt} = J_{\\mathrm{in}} - k_{\\mathrm{eff}}\\,c + H\\!\\left(c - c_{\\mathrm{th}}\\right)\\,v_{\\mathrm{rel}}\\left(c_s - c\\right),\n$$\n其中 $J_{\\mathrm{in}}$ 和 $k_{\\mathrm{eff}}$ 是代表净恒定流入和线性外排的常数参数。亥维赛阶跃函数 $H(\\cdot)$ 编码了当达到阈值 $c_{\\mathrm{th}}$ 时通道的开放，从而引入了一个分段光滑的向量场。\n\n我们感兴趣的事件是首次向上穿越 $c_{\\mathrm{th}}$。在事件发生前，通道释放是不活动的，动力学简化为线性时不变常微分方程\n$$\n\\frac{dc}{dt} = J_{\\mathrm{in}} - k_{\\mathrm{eff}}\\,c.\n$$\n其精确解为\n$$\nc(t) = c_{\\infty} + \\left(c_0 - c_{\\infty}\\right)e^{-k_{\\mathrm{eff}} t},\\quad c_{\\infty} = \\frac{J_{\\mathrm{in}}}{k_{\\mathrm{eff}}},\n$$\n其中 $c_0$ 是 $t=0$ 时的初始浓度。阈值穿越时间 $t^\\star$ 定义为满足 $c(t^\\star) = c_{\\mathrm{th}}$ 的向上穿越。将精确解设为等于 $c_{\\mathrm{th}}$ 可得\n$$\nc_{\\mathrm{th}} = c_{\\infty} + \\left(c_0 - c_{\\infty}\\right)e^{-k_{\\mathrm{eff}} t^\\star}.\n$$\n求解 $t^\\star$ 可得\n$$\nt^\\star = -\\frac{1}{k_{\\mathrm{eff}}}\\ln\\!\\left(\\frac{c_{\\mathrm{th}} - c_{\\infty}}{c_0 - c_{\\infty}}\\right).\n$$\n对于从下方开始的向上穿越，我们需要 $c_0  c_{\\mathrm{th}}  c_{\\infty}$，这确保了对数函数的参数在 $(0, 1)$ 区间内，从而使 $t^\\star$ 为正。如果 $c_0 \\ge c_{\\mathrm{th}}$，那么根据定义，穿越时间为 $t^\\star = 0$。如果 $c_{\\infty} \\le c_{\\mathrm{th}}$ 且 $c_0  c_{\\mathrm{th}}$，那么 $c(t)$ 单调递增至 $c_{\\infty}$，但永远不会在有限时间内达到 $c_{\\mathrm{th}}$；我们声明不发生穿越。\n\n为了分析事件附近的时间离散化误差，我们研究了事件前动力学上的固定步长显式欧拉方法。对于步长 $h$，定义\n$$\nc_{n+1} = c_n + h\\left(J_{\\mathrm{in}} - k_{\\mathrm{eff}} c_n\\right),\\quad t_{n+1} = t_n + h,\n$$\n其中 $c_0$ 是给定的。朴素事件检测在第一个使得 $c_{n+1} \\ge c_{\\mathrm{th}}$ 的离散时间 $t_{n+1}$ 处声明穿越。这会产生时间延迟误差，因为实际穿越通常发生在 $t_n$ 和 $t_{n+1}$ 之间。\n\n一种经过优化的步内事件检测通过在步内执行线性插值来改进这一点。如果 $c_n  c_{\\mathrm{th}} \\le c_{n+1}$，定义\n$$\n\\alpha = \\frac{c_{\\mathrm{th}} - c_n}{c_{n+1} - c_n},\\quad t_{\\mathrm{lin}} = t_n + \\alpha h.\n$$\n这是一种使用离散解序列上的线性插值的标准零点穿越近似。虽然事件前动力学是精确的指数形式，但线性插值提供了一种易于处理的步内优化方法，通常能以适度的计算成本显著减少时间检测误差。\n\n我们为每个测试用例比较三个量：\n- 朴素时间的绝对误差 $|t_{n+1} - t^\\star|$，单位为秒。\n- 优化时间的绝对误差 $|t_{\\mathrm{lin}} - t^\\star|$，单位为秒。\n- 朴素过冲幅度 $c_{n+1} - c_{\\mathrm{th}}$，单位为微摩尔，它量化了欧拉方法在步内超出阈值的量。\n\n计算算法：\n1. 给定参数 $(J_{\\mathrm{in}}, k_{\\mathrm{eff}}, c_{\\mathrm{th}}, c_0, h, t_{\\mathrm{end}})$，计算 $c_{\\infty} = J_{\\mathrm{in}}/k_{\\mathrm{eff}}$。\n2. 按如下方式确定 $t^\\star$：\n   - 如果 $c_0 \\ge c_{\\mathrm{th}}$，设置 $t^\\star = 0$。\n   - 否则，如果 $c_{\\infty} \\le c_{\\mathrm{th}}$，设置 $t^\\star$ 未定义并声明无穿越；为指标输出零。\n   - 否则计算 $t^\\star = -\\dfrac{1}{k_{\\mathrm{eff}}}\\ln\\!\\left(\\dfrac{c_{\\mathrm{th}} - c_{\\infty}}{c_0 - c_{\\infty}}\\right)$。\n3. 对事件前动力学执行固定步长欧拉迭代，直到检测到穿越或达到 $t_{\\mathrm{end}}$：\n   - 初始化 $t=0$, $c=c_0$。\n   - 如果 $c \\ge c_{\\mathrm{th}}$，立即为指标返回零（与 $t^\\star = 0$ 一致）。\n   - 否则，迭代 $c_{\\mathrm{new}} = c + h(J_{\\mathrm{in}} - k_{\\mathrm{eff}} c)$，$t_{\\mathrm{new}} = t + h$。如果 $c  c_{\\mathrm{th}} \\le c_{\\mathrm{new}}$，记录朴素事件时间 $t_{n+1} = t_{\\mathrm{new}}$，过冲 $c_{\\mathrm{new}} - c_{\\mathrm{th}}$，以及优化事件时间 $t_{\\mathrm{lin}} = t + \\alpha h$，其中 $\\alpha = \\dfrac{c_{\\mathrm{th}} - c}{c_{\\mathrm{new}} - c}$。\n4. 计算误差 $|t_{n+1} - t^\\star|$ 和 $|t_{\\mathrm{lin}} - t^\\star|$。如果在模拟时间内未找到穿越，则输出零。\n\n科学真实性：\n- 参数在微摩尔浓度和每秒速率的物理合理范围内。\n- 阈值触发项在穿越前不活动，不影响事件前动力学，确保精确的 $t^\\star$ 公式适用。\n- 事件处理在步内使用线性插值，这是一种经过充分检验的数值实践。\n\n程序实现了上述算法，评估了五个指定的测试用例，将每个报告的指标四舍五入到六位小数，并按指定顺序打印一个包含十五个逗号分隔数字的方括号列表，对应于各项指标。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef exact_cross_time(c0, Jin, keff, cth):\n    \"\"\"\n    Compute the exact upward threshold crossing time for the pre-event dynamics:\n        dc/dt = Jin - keff * c\n    Returns:\n        t_star (float) if crossing occurs,\n        0.0 if c0 >= cth (event at t=0),\n        None if no crossing occurs in finite time (c_infty = cth and c0  cth).\n    \"\"\"\n    if c0 >= cth:\n        return 0.0\n    # Avoid division by zero if keff is zero\n    if keff == 0:\n        if Jin > 0 and c0  cth:\n            return (cth - c0) / Jin\n        else:\n            return None\n            \n    c_inf = Jin / keff\n    if c_inf = cth: # Asymptote is at or below threshold, will never cross from below\n        return None\n        \n    num = cth - c_inf\n    den = c0 - c_inf\n    \n    # For an upward crossing from c0  cth towards c_inf > cth,\n    # num and den are both negative, so ratio is positive and less than 1.\n    ratio = num / den\n    if ratio = 0 or ratio >= 1:\n        # This case implies no crossing from below in positive time.\n        return None\n        \n    return -(1.0 / keff) * np.log(ratio)\n\ndef simulate_naive_and_linear(c0, Jin, keff, cth, h, t_end):\n    \"\"\"\n    Simulate pre-event dynamics using fixed-step explicit Euler until crossing.\n    Returns:\n        t_naive: naive event time (first sample at/above threshold), or None if not found.\n        t_linear: in-step linear interpolation event time, or None if not found.\n        overshoot: c_{n+1} - cth (>=0 when crossing), or 0.0 if not found.\n    Edge cases:\n        If c0 >= cth, return (0.0, 0.0, 0.0).\n    \"\"\"\n    t = 0.0\n    c = float(c0)\n    if c >= cth:\n        return 0.0, 0.0, 0.0\n\n    n_steps = int(np.ceil(t_end / h))\n    for _ in range(n_steps):\n        # Pre-event Euler step (release term is inactive before crossing)\n        c_new = c + h * (Jin - keff * c)\n        t_new = t + h\n\n        if c  cth = c_new:\n            # Crossing occurred within this step\n            t_naive = t_new\n            # Linear interpolation fraction within the step\n            delta = c_new - c\n            if delta == 0.0:\n                alpha = 0.0\n            else:\n                alpha = (cth - c) / delta\n                # Clamp alpha to [0,1] for numerical safety\n                alpha = max(0.0, min(1.0, alpha))\n            t_linear = t + alpha * h\n            overshoot = c_new - cth\n            return t_naive, t_linear, overshoot\n\n        # Advance\n        t, c = t_new, c_new\n\n    # No crossing detected within t_end\n    return None, None, 0.0\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (J_in, k_eff, c_th, c0, h, t_end, v_rel, c_s)\n    test_cases = [\n        (0.06, 0.02, 0.4, 0.05, 0.2, 100.0, 0.5, 400.0),  # Case 1\n        (0.06, 0.02, 0.4, 0.399, 0.5, 100.0, 0.5, 400.0), # Case 2\n        (0.008, 0.02, 0.4, 0.05, 0.2, 100.0, 0.5, 400.0), # Case 3\n        (0.06, 0.02, 0.4, 0.4, 0.1, 100.0, 0.5, 400.0),   # Case 4\n        (0.8, 0.01, 0.5, 0.05, 1.0, 50.0, 0.5, 400.0),    # Case 5\n    ]\n\n    results = []\n    for case in test_cases:\n        Jin, keff, cth, c0, h, t_end, v_rel, c_s = case\n\n        # Exact crossing time from analytical pre-threshold solution\n        t_star = exact_cross_time(c0, Jin, keff, cth)\n\n        # Naive and linear event detection on discrete Euler stepping\n        t_naive, t_linear, overshoot = simulate_naive_and_linear(c0, Jin, keff, cth, h, t_end)\n\n        # Compute errors based on rules\n        if t_star is None:\n            # No crossing in finite time: output zeros\n            naive_err = 0.0\n            linear_err = 0.0\n            overshoot_val = 0.0\n        else:\n            # If crossing exists (including t_star == 0)\n            if t_naive is None:\n                # No crossing detected within t_end despite t_star defined; treat as zeros\n                naive_err = 0.0\n                linear_err = 0.0\n                overshoot_val = 0.0\n            else:\n                naive_err = abs(t_naive - t_star)\n                linear_err = abs(t_linear - t_star) if t_linear is not None else abs(t_naive - t_star)\n                overshoot_val = max(0.0, overshoot)\n\n        # Round to six decimal places\n        naive_err = round(naive_err, 6)\n        linear_err = round(linear_err, 6)\n        overshoot_val = round(overshoot_val, 6)\n\n        results.extend([naive_err, linear_err, overshoot_val])\n\n    # Format output: single line, bracketed, comma-separated, no spaces.\n    # Ensure six decimal places formatting for consistency.\n    formatted = \"[\" + \",\".join(f\"{x:.6f}\" for x in results) + \"]\"\n    print(formatted)\n\nsolve()\n```"
        }
    ]
}