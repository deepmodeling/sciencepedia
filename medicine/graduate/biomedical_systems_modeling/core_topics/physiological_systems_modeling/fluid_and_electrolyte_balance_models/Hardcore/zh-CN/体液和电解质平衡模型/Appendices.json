{
    "hands_on_practices": [
        {
            "introduction": "电中性是生理流体中的一个基本约束。这项练习  应用此原理来推导和计算阴离子间隙（Anion Gap），这是一个用于诊断代谢性酸中毒的重要临床参数。本练习通过使用假设的临床数据，将抽象的原理与实际计算联系起来，并引入了“未测量”组分的概念，这在建模中至关重要。",
            "id": "3886767",
            "problem": "一份血浆样本在生理温度和 pH 值为 $7.40$ 的条件下进行分析。实验室报告了以下血浆浓度，单位为毫当量/升 (mEq/L)：钠 $[\\text{Na}^+] = 139.85$，钾 $[\\text{K}^+] = 4.27$，氯化物 $[\\text{Cl}^-] = 101.33$，以及碳酸氢盐 $[\\text{HCO}_3^-] = 23.14$。假设所有报告的物质均为血浆中测得的主要强离子，碳酸氢盐是在此 pH 值下反映二氧化碳-碳酸氢盐缓冲系统的主要测得弱阴离子，且其他阳离子（如钙和镁）和其他阴离子（如磷酸盐、硫酸盐和蛋白质）的贡献存在，但在此次检测中未被测量。\n\n从血浆中所有离子电荷总和为零的宏观电中性原理出发，根据第一性原理，推导出一个以报告的已测离子表示的未测阴离子总浓度的解析表达式，此后定义为阴离子间隙 (Anion Gap, AG)。然后，根据所提供的数据计算该 AG 的数值。最后，验证将此 AG 纳入模型化的电荷平衡中可以恢复电中性。\n\n将计算出的 AG 四舍五入至四位有效数字，并以 mEq/L 为单位表示您的最终答案。最终答案必须是一个实数值。",
            "solution": "基本原理是血浆的宏观电中性：所有离子电荷浓度的总和等于零。设 $z_i$ 表示离子种类 $i$ 的化合价（带符号的整数电荷），并设 $[i]$ 表示其摩尔浓度。电中性原理表述为\n$$\n\\sum_{i} z_i [i] = 0.\n$$\n我们将离子分为两组：已测物质（$\\text{Na}^+$, $\\text{K}^+$, $\\text{Cl}^-$, $\\text{HCO}_3^-$）和未测物质（所有其他阳离子和阴离子）。在报告的生理 pH 值下，$\\text{Na}^+$ 和 $\\text{K}^+$ 是一价阳离子，而 $\\text{Cl}^-$ 和 $\\text{HCO}_3^-$ 是一价阴离子。我们将以当量表示的未测阴离子总浓度定义为 $[\\text{U}^-]$，将以当量表示的未测阳离子总浓度定义为 $[\\text{U}^+]$。电中性条件可以写为\n$$\n(+1)[\\text{Na}^+] + (+1)[\\text{K}^+] + (\\text{未测阳离子的电荷总和}) = (-1)[\\text{Cl}^-] + (-1)[\\text{HCO}_3^-] + (\\text{未测阴离子的电荷总和})。\n$$\n根据定义，\n$$\n[\\text{U}^+] = \\sum_{\\text{未测阳离子 } j} z_j [j], \\quad [\\text{U}^-] = \\sum_{\\text{未测阴离子 } k} |z_k| [k],\n$$\n其中使用绝对值是为了使 $[\\text{U}^-]$ 成为一个表示总负电荷浓度的正量。重写电荷平衡式，\n$$\n[\\text{Na}^+] + [\\text{K}^+] + [\\text{U}^+] = [\\text{Cl}^-] + [\\text{HCO}_3^-] + [\\text{U}^-].\n$$\n求解 $[\\text{U}^-]$ 得\n$$\n[\\text{U}^-] = \\big([\\text{Na}^+] + [\\text{K}^+]\\big) - \\big([\\text{Cl}^-] + [\\text{HCO}_3^-]\\big) + [\\text{U}^+].\n$$\n在临床化学中，阴离子间隙 (AG) 在操作上被定义为根据测得的强离子估算的未测阴离子总浓度，同时忽略常规检测中未测阳离子的贡献。这种做法是合理的，因为在大多数生理状态下，未测阳离子（如以当量计的 $\\text{Ca}^{2+}$ 和 $\\text{Mg}^{2+}$）的浓度相对于占主导地位的一价阳离子来说很小。在此标准近似下，测得的平衡中 $[\\text{U}^+] \\approx 0$，表达式简化为\n$$\n\\text{AG} = [\\text{U}^-] \\approx \\big([\\text{Na}^+] + [\\text{K}^+]\\big) - \\big([\\text{Cl}^-] + [\\text{HCO}_3^-]\\big).\n$$\n我们现在计算其数值。使用给定的数据，\n$$\n[\\text{Na}^+] + [\\text{K}^+] = 139.85 + 4.27 = 144.12 \\ \\text{mEq/L},\n$$\n$$\n[\\text{Cl}^-] + [\\text{HCO}_3^-] = 101.33 + 23.14 = 124.47 \\ \\text{mEq/L}.\n$$\n因此，\n$$\n\\text{AG} \\approx 144.12 - 124.47 = 19.65 \\ \\text{mEq/L}.\n$$\n四舍五入至四位有效数字，AG 为 $19.65$ mEq/L。\n\n为了在此模型化平衡中数值验证电中性，我们将计算出的 $\\text{AG}$ 作为集总的未测阴离子包括在内。来自已测阳离子的总正电荷浓度为\n$$\n[\\text{Na}^+] + [\\text{K}^+] = 144.12 \\ \\text{mEq/L}.\n$$\n来自已测阴离子加上未测阴离子的总负电荷浓度为\n$$\n[\\text{Cl}^-] + [\\text{HCO}_3^-] + \\text{AG} = 124.47 + 19.65 = 144.12 \\ \\text{mEq/L}.\n$$\n模型化的电荷平衡被精确满足：\n$$\n144.12 - 144.12 = 0,\n$$\n这与宏观电中性原理一致。\n\n因此，根据给定数据计算出的阴离子间隙，四舍五入至四位有效数字并以毫当量/升表示，为 $19.65$。",
            "answer": "$$\\boxed{19.65}$$"
        },
        {
            "introduction": "真实的生理系统是动态的，而不仅仅是静态平衡。这项练习  从静态平衡转向一个动态双室模型，该模型代表了血浆和组织间液之间的液体交换。它要求我们思考建模中的一个关键问题：模型的参数是否可以从可测量的输出中唯一确定，这个概念被称为结构可辨识性（structural identifiability）。",
            "id": "3886696",
            "problem": "患者的细胞外液由一个双室模型表示，该模型由血管内血浆水和组织间液水组成。设 $x_{p}(t)$ 表示血浆水容量，$x_{i}(t)$ 表示组织间液水容量。穿过毛细血管壁的水通量是由渗透压差驱动的，该压差源于一种固定摩尔量为 $n_{A}$ 的血管内不通透大分子（白蛋白）局限于血浆中。假设在生理温度 $T$ 下表现为理想渗透行为，因此渗透压遵循 van’t Hoff 方程。设 $R$ 为普适气体常数，$L_{p}$ 为水力传导系数。血浆与组织间质之间的渗透压差为 $\\pi_{p}(t)-\\pi_{i}(t)=R\\,T\\,n_{A}/x_{p}(t)$。从组织间质到血浆的跨毛细血管水通量为 $J_{w}(t)=L_{p}\\,\\big(\\pi_{p}(t)-\\pi_{i}(t)\\big)$，且血浆接受已知的静脉输注 $u(t)$（单位为体积/时间）。房室动力学方程为\n$$\n\\frac{d x_{p}}{d t}=J_{w}(t)+u(t),\\qquad \\frac{d x_{i}}{d t}=-J_{w}(t).\n$$\n细胞外总钠量是守恒的，并在整个细胞外空间迅速达到平衡，因此细胞外钠浓度为 $c_{\\mathrm{Na}}(t)=n_{\\mathrm{Na}}/\\big(x_{p}(t)+x_{i}(t)\\big)$，其中 $n_{\\mathrm{Na}}$ 是未知的细胞外总钠量。可测输出是血清钠浓度 $y_{1}(t)=c_{\\mathrm{Na}}(t)$ 和血细胞比容 $y_{2}(t)=H(t)$，其中血细胞比容定义为 $H(t)=V_{\\mathrm{RBC}}/\\big(x_{p}(t)+V_{\\mathrm{RBC}}\\big)$，$V_{\\mathrm{RBC}}$ 是已知且恒定的红细胞 (RBC) 容量。假设所有信号在需要时都是无噪声且可微的。\n\n任务：\n- 在动态模型的背景下，定义结构可辨识性和实际可辨识性。\n- 仅使用质量平衡和渗透流的基本原理，证明 $x_{p}(t)$ 可以从 $H(t)$ 和 $V_{\\mathrm{RBC}}$ 代数可观测，并用 $H(t)$ 推导出 $x_{p}(t)$。\n- 设 $\\theta=L_{p}\\,R\\,T\\,n_{A}$ 表示集总渗透传输参数。推导出 $\\theta$ 关于 $H(t)$、其时间导数 $dH/dt$、$u(t)$ 和 $V_{\\mathrm{RBC}}$ 的闭式解析表达式。\n- 在上述假设下，且初始组织间液容量未知的情况下，简要分析 $n_{\\mathrm{Na}}$ 是否能从已知的 $u(t)$、 $y_{1}(t)$ 和 $y_{2}(t)$ 结构可辨识，并从第一性原理出发证明你的结论。\n\n答案规格：\n- 将最终答案以 $\\theta$ 关于 $H(t)$、$dH/dt$、$u(t)$ 和 $V_{\\mathrm{RBC}}$ 的单个闭式解析表达式的形式提供。\n- 最终方框内的答案不应包含单位。在推导过程中，你可以将 $V_{\\mathrm{RBC}}$ 视为升，$u(t)$ 视为升/分钟，$H(t)$ 视为无单位量，$dH/dt$ 视为/分钟。",
            "solution": "问题陈述经评估具有科学依据、适定且客观。它提出了一个简化的但标准的液体平衡房室模型，该模型基于已确立的生理学原理（渗透流、质量平衡）和数学形式体系（常微分方程）。在应用于生物医学建模的系统与控制理论背景下，这些任务是具体且可形式化的。所有必要的数据和关系都已提供。未检测到矛盾或歧义。因此，该问题是有效的，有必要提供完整解答。\n\n解答过程通过依次处理每个任务来进行。\n\n首先，我们定义结构可辨识性和实际可辨识性的概念。\n结构可辨识性是模型结构、其输入和输出的一种理想化的理论属性。如果模型中的一个参数 $\\theta$ 的值可以从在无限时间范围内的完美（无噪声）、连续的输入和输出测量中唯一确定，那么该参数是结构上全局可辨识的。如果参数的不同值可以产生完全相同的输入-输出行为，则该参数是结构上不可辨识的。它是任何有意义的参数估计的先决条件。\n相比之下，实际可辨识性关注的是从真实世界数据中估计参数值的可行性，这些数据持续时间有限且受噪声污染。一个参数可能结构上可辨识，但如果其值对测量噪声高度敏感，或者需要不切实际的大型或丰富数据集才能以可接受的精度估计它，那么它在实际上是不可辨识的。实际可辨识性通常使用灵敏度分析或费雪信息矩阵等工具来评估，以量化参数估计的置信度。\n\n第二，我们证明血浆水容量 $x_{p}(t)$ 可以从血细胞比容 $H(t)$ 和红细胞容量 $V_{\\mathrm{RBC}}$ 代数可观测。在此背景下，可观测性意味着状态变量可以从输出测量中确定。血细胞比容的测量方程 $y_{2}(t)$ 如下：\n$$\nH(t) = \\frac{V_{\\mathrm{RBC}}}{x_{p}(t)+V_{\\mathrm{RBC}}}\n$$\n鉴于 $H(t)$ 是一个测量输出，$V_{\\mathrm{RBC}}$ 是一个已知常数，我们可以通过代数方法解此方程，求得状态变量 $x_{p}(t)$。\n$$\nH(t) \\left(x_{p}(t)+V_{\\mathrm{RBC}}\\right) = V_{\\mathrm{RBC}}\n$$\n$$\nH(t)x_{p}(t) + H(t)V_{\\mathrm{RBC}} = V_{\\mathrm{RBC}}\n$$\n$$\nH(t)x_{p}(t) = V_{\\mathrm{RBC}} - H(t)V_{\\mathrm{RBC}} = V_{\\mathrm{RBC}}\\left(1-H(t)\\right)\n$$\n$$\nx_{p}(t) = V_{\\mathrm{RBC}}\\frac{1-H(t)}{H(t)}\n$$\n由于 $x_{p}(t)$ 可以表示为测量值 $H(t)$ 和已知参数 $V_{\\mathrm{RBC}}$ 的直接代数函数，因此它是代数可观测的。\n\n第三，我们推导集总渗透传输参数 $\\theta = L_{p}\\,R\\,T\\,n_{A}$ 的闭式解析表达式。推导从血浆水容量的状态方程开始：\n$$\n\\frac{d x_{p}}{d t}=J_{w}(t)+u(t)\n$$\n跨毛细血管水通量 $J_{w}(t)$ 由 $J_{w}(t) = L_{p}\\,\\left(\\pi_{p}(t)-\\pi_{i}(t)\\right)$ 给出，渗透压差为 $\\pi_{p}(t)-\\pi_{i}(t)=R\\,T\\,n_{A}/x_{p}(t)$。将这些代入动力学方程，得到：\n$$\n\\frac{d x_{p}}{d t} = L_{p} \\frac{R\\,T\\,n_{A}}{x_{p}(t)} + u(t)\n$$\n使用集总参数 $\\theta=L_{p}\\,R\\,T\\,n_{A}$ 的定义，方程简化为：\n$$\n\\frac{d x_{p}}{d t} = \\frac{\\theta}{x_{p}(t)} + u(t)\n$$\n为了用测量值 $H(t)$ 及其导数表示 $\\theta$，我们必须将 $x_{p}(t)$ 及其时间导数的表达式代入此方程。我们已经求得 $x_{p}(t) = V_{\\mathrm{RBC}}\\frac{1-H(t)}{H(t)}$。现在我们使用商法则计算其关于时间 $t$ 的导数：\n$$\n\\frac{d x_{p}}{d t} = \\frac{d}{dt} \\left( V_{\\mathrm{RBC}}\\frac{1-H(t)}{H(t)} \\right) = V_{\\mathrm{RBC}} \\frac{\\left(-\\frac{dH}{dt}\\right)H(t) - (1-H(t))\\left(\\frac{dH}{dt}\\right)}{H(t)^2}\n$$\n$$\n\\frac{d x_{p}}{d t} = V_{\\mathrm{RBC}} \\frac{-H(t)\\frac{dH}{dt} - \\frac{dH}{dt} + H(t)\\frac{dH}{dt}}{H(t)^2} = V_{\\mathrm{RBC}} \\frac{-\\frac{dH}{dt}}{H(t)^2} = -\\frac{V_{\\mathrm{RBC}}}{H(t)^2}\\frac{dH}{dt}\n$$\n现在，我们重新整理动力学方程以求解 $\\theta$：\n$$\n\\frac{\\theta}{x_{p}(t)} = \\frac{d x_{p}}{d t} - u(t) \\implies \\theta = x_{p}(t) \\left( \\frac{d x_{p}}{d t} - u(t) \\right)\n$$\n最后，我们将 $x_{p}(t)$ 和 $\\frac{d x_{p}}{d t}$ 的表达式用 $H(t)$ 表示并代入：\n$$\n\\theta = \\left( V_{\\mathrm{RBC}}\\frac{1-H(t)}{H(t)} \\right) \\left( -\\frac{V_{\\mathrm{RBC}}}{H(t)^2}\\frac{dH}{dt} - u(t) \\right)\n$$\n展开此表达式，得到 $\\theta$ 的期望结果：\n$$\n\\theta = -V_{\\mathrm{RBC}}^2 \\frac{1-H(t)}{H(t)^3}\\frac{dH}{dt} - V_{\\mathrm{RBC}}\\frac{1-H(t)}{H(t)}u(t)\n$$\n这个表达式也可以写成因式分解的形式。\n\n第四，我们分析细胞外总钠量 $n_{\\mathrm{Na}}$ 的结构可辨识性。\n结构可辨识性要求我们能够从可用的输入和输出中唯一确定 $n_{\\mathrm{Na}}$，前提是模型完美且数据无噪声。此分析的关键动力学和测量如下：\n1.  细胞外总水容量 $V_{ECW}(t) = x_{p}(t) + x_{i}(t)$。其动力学通过将状态方程求和得到：\n    $$\n    \\frac{d V_{ECW}}{d t} = \\frac{d x_{p}}{d t} + \\frac{d x_{i}}{d t} = (J_{w}(t)+u(t)) + (-J_{w}(t)) = u(t)\n    $$\n2.  对这个简单的微分方程积分，得到总容量随时间的变化：\n    $$\n    V_{ECW}(t) = V_{ECW}(0) + \\int_{0}^{t} u(\\tau)d\\tau\n    $$\n    其中 $V_{ECW}(0) = x_{p}(0) + x_{i}(0)$ 是初始细胞外总容量。问题陈述 $x_{i}(0)$ 未知，这使得 $V_{ECW}(0)$ 成为一个未知常数。\n3.  血清钠测量值 $y_{1}(t)$ 定义为：\n    $$\n    y_{1}(t) = c_{\\mathrm{Na}}(t) = \\frac{n_{\\mathrm{Na}}}{x_{p}(t)+x_{i}(t)} = \\frac{n_{\\mathrm{Na}}}{V_{ECW}(t)}\n    $$\n    此处，$n_{\\mathrm{Na}}$ 是我们希望辨识的未知参数。\n\n从测量方程，我们可以写出 $n_{\\mathrm{Na}} = y_{1}(t) V_{ECW}(t)$。代入 $V_{ECW}(t)$ 的表达式：\n$$\nn_{\\mathrm{Na}} = y_{1}(t) \\left( V_{ECW}(0) + \\int_{0}^{t} u(\\tau)d\\tau \\right)\n$$\n这个方程包含两个未知数：参数 $n_{\\mathrm{Na}}$ 和初始条件 $V_{ECW}(0)$。然而，这个关系必须对所有 $t \\geq 0$ 成立。我们可以在两个不同的时间点 $t_1$ 和 $t_2$ 评估此方程：\n$$\nn_{\\mathrm{Na}} = y_{1}(t_1) \\left( V_{ECW}(0) + \\int_{0}^{t_1} u(\\tau)d\\tau \\right) \\quad (\\text{方程 1})\n$$\n$$\nn_{\\mathrm{Na}} = y_{1}(t_2) \\left( V_{ECW}(0) + \\int_{0}^{t_2} u(\\tau)d\\tau \\right) \\quad (\\text{方程 2})\n$$\n我们可以从方程1解出 $V_{ECW}(0)$：$V_{ECW}(0) = \\frac{n_{\\mathrm{Na}}}{y_{1}(t_1)} - \\int_{0}^{t_1} u(\\tau)d\\tau$。将此代入方程2：\n$$\nn_{\\mathrm{Na}} = y_{1}(t_2) \\left( \\left(\\frac{n_{\\mathrm{Na}}}{y_{1}(t_1)} - \\int_{0}^{t_1} u(\\tau)d\\tau\\right) + \\int_{0}^{t_2} u(\\tau)d\\tau \\right)\n$$\n$$\nn_{\\mathrm{Na}} = \\frac{y_{1}(t_2)}{y_{1}(t_1)}n_{\\mathrm{Na}} + y_{1}(t_2) \\left( \\int_{t_1}^{t_2} u(\\tau)d\\tau \\right)\n$$\n$$\nn_{\\mathrm{Na}} \\left(1 - \\frac{y_{1}(t_2)}{y_{1}(t_1)}\\right) = y_{1}(t_2) \\int_{t_1}^{t_2} u(\\tau)d\\tau\n$$\n$$\nn_{\\mathrm{Na}} \\left(\\frac{y_{1}(t_1) - y_{1}(t_2)}{y_{1}(t_1)}\\right) = y_{1}(t_2) \\int_{t_1}^{t_2} u(\\tau)d\\tau\n$$\n$$\nn_{\\mathrm{Na}} = \\frac{y_{1}(t_1) y_{1}(t_2)}{y_{1}(t_1) - y_{1}(t_2)} \\int_{t_1}^{t_2} u(\\tau)d\\tau\n$$\n这为 $n_{\\mathrm{Na}}$ 提供了一个唯一解，前提是输入 $u(t)$ 足够“激励”（即不恒等于零）以引起输出 $y_{1}(t)$ 的变化（即 $y_1(t_1) \\neq y_1(t_2)$）。输出 $y_{2}(t)$ 被隐式使用，因为知道它能确保模型被完全指定，但辨识 $n_{\\mathrm{Na}}$ 的核心论点依赖于细胞外总体积的动力学和钠浓度测量。因此，$n_{\\mathrm{Na}}$ 是结构可辨识的。\n\n要求的最终答案是 $\\theta$ 的表达式。\n$$\n\\theta = -V_{\\mathrm{RBC}}^2 \\frac{1-H(t)}{H(t)^3}\\frac{dH}{dt} - V_{\\mathrm{RBC}}\\frac{1-H(t)}{H(t)}u(t)\n$$\n为简洁起见，可以将其因式分解：\n$$\n\\theta = -V_{\\mathrm{RBC}} \\frac{1-H(t)}{H(t)} \\left( \\frac{V_{\\mathrm{RBC}}}{H(t)^2}\\frac{dH}{dt} + u(t) \\right)\n$$\n这就是所要求的表达式。",
            "answer": "$$\n\\boxed{-V_{\\mathrm{RBC}} \\frac{1-H(t)}{H(t)} \\left( \\frac{V_{\\mathrm{RBC}}}{H(t)^2}\\frac{dH}{dt} + u(t) \\right)}\n$$"
        },
        {
            "introduction": "某些生理功能依赖于空间梯度的建立和维持。这项高级练习  探讨了肾脏亨利氏襻（Loop of Henle）的经典模型，这是一个通过逆流系统产生浓度梯度的典型例子。此练习要求推导控制微分方程，并实现一个数值算法来求解由此产生的边界值问题，展示了计算方法在分析复杂的、具有空间组织的生物系统中的核心作用。",
            "id": "3886732",
            "problem": "考虑一个简化的、代表哺乳动物肾脏中亨利氏袢 (Loop of Henle, LOH) 的一维稳态平行管模型。该模型包含降支 (DL) 和升支 (AL)，它们沿着无量纲轴向坐标 $x \\in [0,1]$ 平行延伸（其中 $x=0$ 表示皮质端，$x=1$ 表示髓袢乳头端）。在每个轴向位置，这些管与周围的间质进行水和溶质的交换。将流体模拟为单一溶质电解质（例如氯化钠），所有变量均进行无量纲化处理，使得皮质参考浓度为 $c_{\\mathrm{ref}}=1$，降支皮质端的入口体积流率为 $q_{\\mathrm{in}}=1$。假设升支不透水，降支不透溶质。令 $p_{\\mathrm{w}}$ 表示降支的无量纲水渗透性，$p_{\\mathrm{s}}$ 表示升支的无量纲溶质渗透性，$k$ 表示代表向脉管系统进行灌注清除的无量纲间质溶质清除参数。\n\n仅从基本守恒定律和膜输运的本构关系出发，推导一个满足以下条件的一维稳态模型：\n\n- 每个管中水和溶质的质量守恒。\n- 跨膜通量与驱动力成正比的线性本构关系。\n- 在每个 $x$ 处，间质中溶质的局部径向平衡。\n\n使用以下基本依据：\n\n- 物种守恒：对于任何管段，对流通量的轴向导数等于净跨膜通量，例如，溶质为 $\\dfrac{d}{dx} \\left(q(x)\\,c(x)\\right) = -j_{\\mathrm{s}}(x)$，水为 $\\dfrac{d}{dx} q(x) = -j_{\\mathrm{w}}(x)$。\n- 线性通量定律：降支的水通量为 $j_{\\mathrm{w}}(x) = p_{\\mathrm{w}}\\left(c_{\\mathrm{is}}(x)-c_{\\mathrm{dl}}(x)\\right)$，升支的溶质通量为 $j_{\\mathrm{s}}(x) = p_{\\mathrm{s}}\\left(c_{\\mathrm{al}}(x)-c_{\\mathrm{is}}(x)\\right)$，其中 $c_{\\mathrm{is}}(x)$ 是间质浓度，$c_{\\mathrm{dl}}(x)$ 是降支浓度，$c_{\\mathrm{al}}(x)$ 是升支浓度。\n- 局部间质溶质平衡：在每个 $x$ 处，$k\\left(c_{\\mathrm{is}}(x)-c_{\\mathrm{ref}}\\right) = p_{\\mathrm{s}}\\left(c_{\\mathrm{al}}(x)-c_{\\mathrm{is}}(x)\\right)$。\n\n通过边界条件施加逆流耦合：流体在 $x=0$ 处进入降支，此时 $q_{\\mathrm{dl}}(0)=q_{\\mathrm{in}}$ 且 $c_{\\mathrm{dl}}(0)=c_{\\mathrm{ref}}$；在 $x=1$ 处离开降支进入升支，此时 $q_{\\mathrm{al}} = q_{\\mathrm{dl}}(1)$ 且 $c_{\\mathrm{al}}(1)=c_{\\mathrm{dl}}(1)$。由于升支不透水，其流速 $q_{\\mathrm{al}}$ 沿 $x$ 保持恒定。\n\n任务：\n\n1. 根据所述基本依据，推导控制 $q_{\\mathrm{dl}}(x)$、$c_{\\mathrm{dl}}(x)$ 和 $c_{\\mathrm{al}}(x)$ 的耦合常微分方程 (ODE)，以及 $c_{\\mathrm{is}}(x)$ 的代数关系。解释逆流耦合和闭合环路的边界条件。\n2. 为给定的 $(p_{\\mathrm{w}}, p_{\\mathrm{s}}, k, q_{\\mathrm{in}}, c_{\\mathrm{ref}})$ 设计一个鲁棒的数值算法，以求解 $x$ 上的稳态 BVP（边界值问题），并计算由比率 $\\Gamma = \\dfrac{c_{\\mathrm{is}}(1)}{c_{\\mathrm{is}}(0)}$ 量化的间质梯度形成。\n3. 在单个完整的程序中实现该算法，对于下面测试套件中的每组参数，计算 $\\Gamma$ 值至六位小数，并将所有结果汇总为指定的输出格式。\n\n所有变量和参数均为无量纲；因此，不需要物理单位。不涉及角度。数值答案以小数形式表示。\n\n测试套件参数集 $(p_{\\mathrm{w}}, p_{\\mathrm{s}}, k, q_{\\mathrm{in}}, c_{\\mathrm{ref}})$：\n\n- 情况 A（一般逆流倍增器）：$(2.0,\\,2.0,\\,0.2,\\,1.0,\\,1.0)$。\n- 情况 B（降支无水渗透性）：$(0.0,\\,2.0,\\,0.2,\\,1.0,\\,1.0)$。\n- 情况 C（升支无溶质渗透性）：$(2.0,\\,0.0,\\,0.2,\\,1.0,\\,1.0)$。\n- 情况 D（强间质清除）：$(2.0,\\,2.0,\\,10.0,\\,1.0,\\,1.0)$。\n\n最终输出格式：\n\n您的程序应生成单行输出，其中包含四个 $\\Gamma$ 值的结果，以逗号分隔，每个值四舍五入到六位小数，并用方括号括起来（例如，\"[1.234567,0.999999,1.000000,1.050000]\"）。",
            "solution": "该问题要求推导和数值求解亨利氏袢的一维稳态逆流交换模型。该问题具有科学依据，是适定的，并且所有必要的参数和本构关系都已提供。我们开始进行求解。\n\n### 1. 控制方程的推导\n\n该模型包含一个降支 (DL) 和一个升支 (AL)，它们沿着无量纲坐标 $x \\in [0, 1]$ 分布。我们的任务是推导溶质浓度 $c_{\\mathrm{dl}}(x)$ 和 $c_{\\mathrm{al}}(x)$ 以及降支中体积流率 $q_{\\mathrm{dl}}(x)$ 的常微分方程 (ODE)。\n\n#### 1.1. 间质溶质浓度 $c_{\\mathrm{is}}(x)$\n\n间质溶质浓度 $c_{\\mathrm{is}}(x)$ 由来自升支的溶质增加和清除至脉管系统的溶质减少之间的局部平衡决定。所提供的代数关系为：\n$$k\\left(c_{\\mathrm{is}}(x)-c_{\\mathrm{ref}}\\right) = p_{\\mathrm{s}}\\left(c_{\\mathrm{al}}(x)-c_{\\mathrm{is}}(x)\\right)$$\n其中 $k$ 是间质清除参数，$p_{\\mathrm{s}}$ 是升支的溶质渗透性，$c_{\\mathrm{al}}(x)$ 是升支的溶质浓度，$c_{\\mathrm{ref}}=1$ 是皮质的参考浓度。求解 $c_{\\mathrm{is}}(x)$：\n$k c_{\\mathrm{is}}(x) + p_{\\mathrm{s}} c_{\\mathrm{is}}(x) = p_{\\mathrm{s}} c_{\\mathrm{al}}(x) + k c_{\\mathrm{ref}}$\n$$(k + p_{\\mathrm{s}}) c_{\\mathrm{is}}(x) = p_{\\mathrm{s}} c_{\\mathrm{al}}(x) + k c_{\\mathrm{ref}}$$\n$$c_{\\mathrm{is}}(x) = \\frac{p_{\\mathrm{s}} c_{\\mathrm{al}}(x) + k c_{\\mathrm{ref}}}{k + p_{\\mathrm{s}}}$$\n此方程以代数方式将任意位置 $x$ 处的间质浓度与同一位置的升支浓度联系起来。\n\n#### 1.2. 降支 (DL) 模型\n\n降支被假设为不透溶质。小管中溶质守恒的一般定律是 $\\frac{d}{dx}(q(x)c(x)) = -j_{\\mathrm{s}}(x)$，其中 $j_{\\mathrm{s}}(x)$ 是跨膜溶质通量。对于降支， $j_{\\mathrm{s,dl}}(x) = 0$。因此，溶质流率是恒定的：\n$$\\frac{d}{dx}\\left(q_{\\mathrm{dl}}(x) c_{\\mathrm{dl}}(x)\\right) = 0$$\n对此积分可得 $q_{\\mathrm{dl}}(x) c_{\\mathrm{dl}}(x) = \\text{常数}$。我们在入口 $x=0$ 处计算此常数，此处 $q_{\\mathrm{dl}}(0) = q_{\\mathrm{in}}=1$ 且 $c_{\\mathrm{dl}}(0) = c_{\\mathrm{ref}}=1$。\n$$q_{\\mathrm{dl}}(x) c_{\\mathrm{dl}}(x) = q_{\\mathrm{in}} c_{\\mathrm{ref}}$$\n这提供了降支中流速和浓度之间的代数关系。\n\n降支中的水守恒由 $\\frac{d}{dx}q_{\\mathrm{dl}}(x) = -j_{\\mathrm{w}}(x)$ 给出，水通量定律为 $j_{\\mathrm{w}}(x) = p_{\\mathrm{w}}(c_{\\mathrm{is}}(x)-c_{\\mathrm{dl}}(x))$。因此：\n$$\\frac{d q_{\\mathrm{dl}}}{dx} = -p_{\\mathrm{w}}(c_{\\mathrm{is}}(x)-c_{\\mathrm{dl}}(x))$$\n为获得 $c_{\\mathrm{dl}}(x)$ 的常微分方程，我们将溶质流方程 $q_{\\mathrm{dl}} c_{\\mathrm{dl}} = q_{\\mathrm{in}} c_{\\mathrm{ref}}$ 对 $x$ 求导：\n$$\\frac{d q_{\\mathrm{dl}}}{dx} c_{\\mathrm{dl}} + q_{\\mathrm{dl}} \\frac{d c_{\\mathrm{dl}}}{dx} = 0 \\implies \\frac{d c_{\\mathrm{dl}}}{dx} = -\\frac{c_{\\mathrm{dl}}}{q_{\\mathrm{dl}}} \\frac{d q_{\\mathrm{dl}}}{dx}$$\n代入 $\\frac{d q_{\\mathrm{dl}}}{dx}$ 的表达式：\n$$\\frac{d c_{\\mathrm{dl}}}{dx} = -\\frac{c_{\\mathrm{dl}}}{q_{\\mathrm{dl}}} \\left[-p_{\\mathrm{w}}(c_{\\mathrm{is}}(x)-c_{\\mathrm{dl}}(x))\\right] = \\frac{p_{\\mathrm{w}} c_{\\mathrm{dl}}}{q_{\\mathrm{dl}}} (c_{\\mathrm{is}}(x)-c_{\\mathrm{dl}}(x))$$\n最后，代入 $q_{\\mathrm{dl}}(x) = \\frac{q_{\\mathrm{in}} c_{\\mathrm{ref}}}{c_{\\mathrm{dl}}(x)}$，我们得到第一个常微分方程：\n$$\\frac{d c_{\\mathrm{dl}}}{dx} = \\frac{p_{\\mathrm{w}} c_{\\mathrm{dl}}(x)^2}{q_{\\mathrm{in}} c_{\\mathrm{ref}}} \\left(c_{\\mathrm{is}}(x)-c_{\\mathrm{dl}}(x)\\right)$$\n\n#### 1.3. 升支 (AL) 模型\n\n升支不透水，意味着 $j_{\\mathrm{w,al}}(x) = 0$。水守恒方程 $\\frac{d}{dx}q_{\\mathrm{al}}(x) = -j_{\\mathrm{w,al}}(x)$ 意味着 $\\frac{d}{dx}q_{\\mathrm{al}}(x)=0$。因此，升支中的体积流率 $q_{\\mathrm{al}}$ 沿其长度是恒定的。这个恒定流速，我们称之为 $Q_{\\mathrm{al}}$，由在髓袢转折处（$x=1$）离开降支的流速决定：\n$$Q_{\\mathrm{al}} = q_{\\mathrm{dl}}(1)$$\n使用降支的溶质流方程，$Q_{\\mathrm{al}} = \\frac{q_{\\mathrm{in}} c_{\\mathrm{ref}}}{c_{\\mathrm{dl}}(1)}$。\n\n升支中的溶质守恒为 $\\frac{d}{dx}(q_{\\mathrm{al}} c_{\\mathrm{al}}(x)) = -j_{\\mathrm{s}}(x)$。由于 $q_{\\mathrm{al}}=Q_{\\mathrm{al}}$ 是恒定的：\n$$Q_{\\mathrm{al}} \\frac{d c_{\\mathrm{al}}}{dx} = -j_{\\mathrm{s}}(x)$$\n使用溶质通量定律 $j_{\\mathrm{s}}(x) = p_{\\mathrm{s}}(c_{\\mathrm{al}}(x)-c_{\\mathrm{is}}(x))$，我们得到：\n$$\\frac{d c_{\\mathrm{al}}}{dx} = -\\frac{p_{\\mathrm{s}}}{Q_{\\mathrm{al}}} (c_{\\mathrm{al}}(x) - c_{\\mathrm{is}}(x))$$\n我们可以通过代入 $c_{\\mathrm{is}}(x)$ 的表达式来简化此式：\n$$c_{\\mathrm{al}}(x) - c_{\\mathrm{is}}(x) = c_{\\mathrm{al}}(x) - \\frac{p_{\\mathrm{s}} c_{\\mathrm{al}}(x) + k c_{\\mathrm{ref}}}{k + p_{\\mathrm{s}}} = \\frac{(k+p_{\\mathrm{s}})c_{\\mathrm{al}}(x) - p_{\\mathrm{s}}c_{\\mathrm{al}}(x) - k c_{\\mathrm{ref}}}{k+p_{\\mathrm{s}}} = \\frac{k(c_{\\mathrm{al}}(x)-c_{\\mathrm{ref}})}{k+p_{\\mathrm{s}}}$$\n将此代回常微分方程，得到第二个控制方程：\n$$\\frac{d c_{\\mathrm{al}}}{dx} = -\\frac{p_{\\mathrm{s}} k}{Q_{\\mathrm{al}}(k+p_{\\mathrm{s}})} (c_{\\mathrm{al}}(x)-c_{\\mathrm{ref}})$$\n\n#### 1.4. 系统总结与边界条件\n\n完整的模型是一个关于状态向量 $[c_{\\mathrm{dl}}(x), c_{\\mathrm{al}}(x)]^T$ 的耦合常微分方程组：\n$$\n\\begin{cases}\n\\dfrac{d c_{\\mathrm{dl}}}{dx} = \\dfrac{p_{\\mathrm{w}} c_{\\mathrm{dl}}^2}{q_{\\mathrm{in}} c_{\\mathrm{ref}}} \\left( \\dfrac{p_{\\mathrm{s}} c_{\\mathrm{al}} + k c_{\\mathrm{ref}}}{k + p_{\\mathrm{s}}} - c_{\\mathrm{dl}} \\right) \\\\\n\\dfrac{d c_{\\mathrm{al}}}{dx} = -\\dfrac{p_{\\mathrm{s}} k}{Q_{\\mathrm{al}}(k+p_{\\mathrm{s}})} (c_{\\mathrm{al}}-c_{\\mathrm{ref}}), \\quad \\text{其中 } Q_{\\mathrm{al}} = \\dfrac{q_{\\mathrm{in}} c_{\\mathrm{ref}}}{c_{\\mathrm{dl}}(1)}\n\\end{cases}\n$$\n该系统由两个建立逆流耦合的边界条件闭合：\n1.  降支皮质端的入口条件：$c_{\\mathrm{dl}}(0) = c_{\\mathrm{ref}}$。\n2.  髓袢乳头端的转折条件：$c_{\\mathrm{al}}(1) = c_{\\mathrm{dl}}(1)$。\n\n这是一个两点边值问题 (BVP)，因为边界条件在两个不同的点（$x=0$ 和 $x=1$）指定，并且 $c_{\\mathrm{al}}$ 的常微分方程依赖于 $c_{\\mathrm{dl}}$ 在 $x=1$ 处的值。\n\n### 2. 数值算法设计\n\n由于 BVP 结构，直接的前向积分（作为初值问题）是不可行的。我们将实施打靶法来解决这个问题。\n\n其核心思想是在一个边界上猜测一个变量的值，从而使系统可以被视为一个初值问题 (IVP)，然后迭代这个猜测值，直到满足另一个边界的条件。\n\n1.  **打靶参数**：我们选择髓袢尖端的浓度 $C_{\\mathrm{tip}} \\equiv c_{\\mathrm{dl}}(1)$ 作为我们的打靶参数。将使用求根算法来确定 $C_{\\mathrm{tip}}$ 的正确值。\n\n2.  **残差函数**：我们定义一个残差函数 $R(C_{\\mathrm{tip}})$，对于正确的解，该函数应为零。对于给定的 $C_{\\mathrm{tip}}$ 猜测值：\n    a. 髓袢转折处的边界条件现在是固定的：$c_{\\mathrm{al}}(1) = C_{\\mathrm{tip}}$。\n    b. 升支中的恒定流速被确定：$Q_{\\mathrm{al}} = (q_{\\mathrm{in}} c_{\\mathrm{ref}}) / C_{\\mathrm{tip}}$。\n    c. 在已知 $Q_{\\mathrm{al}}$ 和 $c_{\\mathrm{al}}$ 在 $x=1$ 处的边界条件的情况下，$c_{\\mathrm{al}}(x)$ 的常微分方程可以通过从 $x=1$ 到 $x=0$ 的反向积分作为初值问题求解。这将得到整个域上的 $c_{\\mathrm{al}}(x)$ 分布曲线。我们使用 `scipy.integrate.solve_ivp` 并设置 `t_span=[1, 0]`。\n    d. 现在已知 $c_{\\mathrm{al}}(x)$，那么 $c_{\\mathrm{dl}}(x)$ 的常微分方程就变成了一个标准的初值问题，其初始条件为 $c_{\\mathrm{dl}}(0) = c_{\\mathrm{ref}}$。我们通过从 $x=0$ 到 $x=1$ 的前向积分来求解它。这将得到一个计算出的 $c_{\\mathrm{dl}}(1)$ 值。\n    e. 残差是计算出的 $c_{\\mathrm{dl}}(1)$ 值与初始猜测值 $C_{\\mathrm{tip}}$ 之间的差值：\n       $$R(C_{\\mathrm{tip}}) = c_{\\mathrm{dl, computed}}(1) - C_{\\mathrm{tip}}$$\n\n3.  **求根**：我们使用 `scipy.optimize.root_scalar` 来找到使 $R(C_{\\mathrm{tip}}) = 0$ 的 $C_{\\mathrm{tip}}$ 值。这个根是髓袢尖端的真实浓度。\n\n4.  **结果计算**：一旦找到正确的 $C_{\\mathrm{tip}}$，我们就可以计算最终所需量 $\\Gamma = \\frac{c_{\\mathrm{is}}(1)}{c_{\\mathrm{is}}(0)}$。\n    a. 使用找到的根 $C_{\\mathrm{tip}}$ 重新求解 $c_{\\mathrm{al}}(x)$ 的反向初值问题，以获得正确的 $c_{\\mathrm{al}}(x)$ 分布曲线，特别是 $c_{\\mathrm{al}}(0)$ 的值。\n    b. 我们有 $c_{\\mathrm{al}}(1) = C_{\\mathrm{tip}}$。\n    c. 计算边界处的间质浓度：\n       $$c_{\\mathrm{is}}(1) = \\frac{p_{\\mathrm{s}} c_{\\mathrm{al}}(1) + k c_{\\mathrm{ref}}}{k + p_{\\mathrm{s}}}$$\n       $$c_{\\mathrm{is}}(0) = \\frac{p_{\\mathrm{s}} c_{\\mathrm{al}}(0) + k c_{\\mathrm{ref}}}{k + p_{\\mathrm{s}}}$$\n    d. 计算比率 $\\Gamma = \\frac{c_{\\mathrm{is}}(1)}{c_{\\mathrm{is}}(0)}$。\n\n该算法是鲁棒的，并且非常适合所推导的 BVP 的结构。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Solves the Loop of Henle model for the given test cases and prints the results.\n    \"\"\"\n\n    # Test cases: (p_w, p_s, k, q_in, c_ref)\n    test_cases = [\n        (2.0, 2.0, 0.2, 1.0, 1.0),  # Case A\n        (0.0, 2.0, 0.2, 1.0, 1.0),  # Case B\n        (2.0, 0.0, 0.2, 1.0, 1.0),  # Case C\n        (2.0, 2.0, 10.0, 1.0, 1.0), # Case D\n    ]\n\n    results = []\n    for params in test_cases:\n        gamma = solve_bvp_for_gamma(params)\n        results.append(f\"{gamma:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\n\ndef solve_bvp_for_gamma(params):\n    \"\"\"\n    Solves the boundary value problem for a given set of parameters.\n\n    This function implements a shooting method to find the steady-state solution\n    and then calculates the interstitial concentration gradient Gamma.\n    \"\"\"\n    p_w, p_s, k, q_in, c_ref = params\n\n    # Handle trivial cases where no concentration gradient can form.\n    if p_w == 0.0 or p_s == 0.0:\n        return 1.0\n\n    # The shooting method aims to find the correct C_tip = c_dl(1) = c_al(1).\n    # We define a residual function R(C_tip) = c_dl_computed(1) - C_tip.\n    # The solver will find C_tip such that R(C_tip) = 0.\n    def residual(C_tip):\n        # A physically meaningful concentration must be positive.\n        if C_tip == 0:\n            return 1e9 # Return a large error for invalid guesses.\n\n        # 1. Determine AL flow rate based on the guessed tip concentration.\n        # Q_al is constant along the ascending limb.\n        Q_al = (q_in * c_ref) / C_tip\n\n        # 2. Solve for the c_al(x) profile backwards from x=1 to x=0.\n        # This is an IVP with c_al(1) = C_tip.\n        def ode_al(x, c_al):\n            # dc_al/dx = - (p_s * k) / (Q_al * (k + p_s)) * (c_al - c_ref)\n            return - (p_s * k) / (Q_al * (k + p_s)) * (c_al - c_ref)\n\n        sol_al = solve_ivp(\n            ode_al,\n            t_span=[1, 0],\n            y0=[C_tip],\n            dense_output=True\n        )\n        c_al_func = sol_al.sol\n\n        # 3. Solve for the c_dl(x) profile forwards from x=0 to x=1.\n        # This is an IVP with c_dl(0) = c_ref. The ODE depends on c_al(x).\n        def ode_dl(x, c_dl):\n            # Interpolate c_al at the current position x\n            c_al_x = c_al_func(x)[0]\n            # Calculate interstitial concentration c_is at x\n            c_is_x = (p_s * c_al_x + k * c_ref) / (k + p_s)\n            # dc_dl/dx = (p_w * c_dl^2 / (q_in * c_ref)) * (c_is - c_dl)\n            return (p_w * c_dl**2 / (q_in * c_ref)) * (c_is_x - c_dl)\n\n        sol_dl = solve_ivp(\n            ode_dl,\n            t_span=[0, 1],\n            y0=[c_ref]\n        )\n        c_dl_computed_at_1 = sol_dl.y[0, -1]\n        \n        # 4. The residual is the difference between the computed c_dl(1)\n        # and the initial guess C_tip.\n        return c_dl_computed_at_1 - C_tip\n\n    # Find the root of the residual function to get the correct C_tip.\n    # The bracket [c_ref, c_ref * 20] provides a reasonable search range.\n    sol_root = root_scalar(residual, bracket=[c_ref, c_ref * 20], method='brentq')\n    C_tip_sol = sol_root.root\n\n    # With the correct C_tip, calculate Gamma = c_is(1) / c_is(0).\n    # This requires c_al(1) and c_al(0) for the correct solution.\n    \n    # c_al(1) is simply the solved C_tip.\n    c_al_1 = C_tip_sol\n    \n    # Re-solve for the c_al profile to get c_al(0).\n    Q_al = (q_in * c_ref) / C_tip_sol\n    def ode_al_final(x, c_al):\n        return - (p_s * k) / (Q_al * (k + p_s)) * (c_al - c_ref)\n    \n    sol_al_final = solve_ivp(\n        ode_al_final,\n        t_span=[1, 0],\n        y0=[C_tip_sol]\n    )\n    c_al_0 = sol_al_final.y[0, -1]\n    \n    # Calculate interstitial concentrations at x=0 and x=1.\n    c_is_1 = (p_s * c_al_1 + k * c_ref) / (k + p_s)\n    c_is_0 = (p_s * c_al_0 + k * c_ref) / (k + p_s)\n\n    # Return the concentration ratio Gamma.\n    if c_is_0 == 0:\n        return np.inf # Avoid division by zero, though not expected here.\n        \n    return c_is_1 / c_is_0\n\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}