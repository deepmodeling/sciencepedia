{
    "hands_on_practices": [
        {
            "introduction": "The single-compartment linear model, representing the lung as a simple resistor-capacitor ($RC$) circuit, is the cornerstone of respiratory mechanics. This first exercise applies this fundamental model to the process of passive expiration. By deriving and solving the governing differential equation, you will calculate how much air remains trapped in the lungs at the end of an incomplete breath and determine the resulting \"intrinsic\" pressure, a clinically vital parameter known as PEEPi .",
            "id": "3925450",
            "problem": "A single-compartment lung model is used to represent passive expiration with constant linear airway resistance and lung compliance. Let $V(t)$ denote the alveolar volume above elastic equilibrium (functional residual capacity) at time $t$ during expiration. Airway resistance $R$ is defined by the resistive pressure drop relation $\\Delta p_{\\mathrm{R}} = R\\,\\dot{V}$, where $\\dot{V} = dV/dt$ is the volumetric flow (positive for inflow to the lung). Lung compliance $C$ is defined by $V = C\\,p_{\\mathrm{el}}$, where $p_{\\mathrm{el}}$ is the elastic recoil pressure and lung elastance $E$ is $E = 1/C$. Assume zero applied external positive end-expiratory pressure at the airway opening, no respiratory muscle pressure during expiration, open glottis, and negligible inertance.\n\nStarting from these definitions and basic pressure balance, derive the governing initial-value problem for $V(t)$, and solve it to determine both the end-expiratory volume above elastic equilibrium $V(T_e)$ and the intrinsic positive end-expiratory pressure (PEEPi) at the end of expiration, defined here as the alveolar elastic recoil pressure at $t = T_e$. Use the following parameter values: $R = 15\\ \\mathrm{cmH_2O\\cdot s/L}$, $C = 0.08\\ \\mathrm{L/cmH_2O}$, tidal volume delivered above elastic equilibrium $V_T = 0.6\\ \\mathrm{L}$ (so $V(0) = V_T$ at the start of passive expiration), and expiratory time $T_e = 1\\ \\mathrm{s}$.\n\nRound your numerical results to four significant figures. Express the end-expiratory volume in liters and the PEEPi in centimeters of water. Report your final answer as a two-entry row matrix $\\big(V(T_e),\\ \\mathrm{PEEPi}\\big)$.",
            "solution": "The problem is first validated against the required criteria.\n\n**Step 1: Extract Givens**\n- Model: Single-compartment lung model for passive expiration.\n- Variables: $V(t)$ is the alveolar volume above elastic equilibrium, $\\dot{V} = dV/dt$ is the volumetric flow (positive for inflow).\n- Definitions: Airway resistance $R$ is from $\\Delta p_{\\mathrm{R}} = R\\,\\dot{V}$. Lung compliance $C$ is from $V = C\\,p_{\\mathrm{el}}$, where $p_{\\mathrm{el}}$ is the elastic recoil pressure. Lung elastance is $E = 1/C$.\n- Assumptions: Zero applied external positive end-expiratory pressure ($p_{\\text{ao}} = 0$), no respiratory muscle pressure ($p_{\\text{mus}} = 0$), open glottis, and negligible inertance.\n- Initial Condition: $V(0) = V_T = 0.6\\ \\mathrm{L}$.\n- Parameters: $R = 15\\ \\mathrm{cmH_2O\\cdot s/L}$, $C = 0.08\\ \\mathrm{L/cmH_2O}$, expiratory time $T_e = 1\\ \\mathrm{s}$.\n- Required Outputs: End-expiratory volume $V(T_e)$ and intrinsic PEEP (PEEPi), where PEEPi is defined as $p_{\\mathrm{el}}(T_e)$.\n- Rounding: Results to be rounded to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, well-posed, and objective. It describes a standard first-order linear model of respiratory mechanics, a fundamental concept in biomedical engineering and physiology. All definitions, parameters, and conditions are explicitly stated, consistent, and physiologically plausible. The problem is self-contained and free of any of the invalidating flaws listed in the instructions.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A solution will be derived.\n\n**Derivation of the Governing Equation**\nThe process of passive expiration is driven by the elastic recoil pressure of the lungs, $p_{\\mathrm{el}}$. This pressure drives air out of the lungs, and its energy is dissipated by the resistive properties of the airways. According to the stated assumptions, there are no other pressures acting in the system (i.e., muscle pressure $p_{\\text{mus}} = 0$ and pressure at the airway opening $p_{\\text{ao}} = 0$).\n\nA pressure balance equation for the respiratory system can be written as:\n$$p_{\\mathrm{el}} + p_{\\mathrm{R}} = 0$$\nwhere $p_{\\mathrm{R}}$ is the pressure drop due to resistance. The elastic recoil pressure is given by the definition of compliance, $V = C\\,p_{\\mathrm{el}}$, which can be rearranged to:\n$$p_{\\mathrm{el}} = \\frac{V}{C}$$\nThe resistive pressure drop opposes airflow. During expiration, the lung volume $V(t)$ decreases, so the rate of change of volume, $\\dot{V} = dV/dt$, is negative. The flow of air is outward. The pressure drop due to resistance is proportional to the outward flow rate. The outward flow rate is $-\\dot{V}$. Therefore, the pressure drop across the resistance is $R(-\\dot{V})$. The provided relation $\\Delta p_{\\mathrm{R}} = R\\dot{V}$ can be interpreted in this context as $p_R = R\\dot{V}$, representing the pressure loss relative to the alveolar pressure.\n\nSubstituting the expressions for $p_{\\mathrm{el}}$ and $p_{\\mathrm{R}}$ into the pressure balance equation:\n$$\\frac{V}{C} + R\\,\\frac{dV}{dt} = 0$$\nThis is a first-order linear homogeneous ordinary differential equation (ODE). It can be rearranged into a standard form:\n$$\\frac{dV}{dt} = -\\frac{1}{RC}V$$\n\n**Solution of the Initial-Value Problem**\nThe product $RC$ is the time constant of the respiratory system, denoted by $\\tau$.\n$$\\tau = RC$$\nThe ODE is therefore $\\frac{dV}{dt} = -\\frac{1}{\\tau}V$. The general solution to this equation is:\n$$V(t) = A \\exp\\left(-\\frac{t}{\\tau}\\right)$$\nwhere $A$ is a constant of integration. We determine $A$ using the initial condition provided in the problem: at the start of expiration ($t=0$), the volume above elastic equilibrium is the tidal volume, $V(0) = V_T$.\n$$V(0) = V_T = A \\exp\\left(-\\frac{0}{\\tau}\\right) = A \\cdot 1 = A$$\nThus, the specific solution for the volume $V(t)$ during passive expiration is:\n$$V(t) = V_T \\exp\\left(-\\frac{t}{RC}\\right)$$\n\n**Numerical Calculations**\nFirst, we calculate the time constant $\\tau$ using the given parameter values:\n$$R = 15\\ \\mathrm{cmH_2O\\cdot s/L}$$\n$$C = 0.08\\ \\mathrm{L/cmH_2O}$$\n$$\\tau = RC = (15\\ \\mathrm{cmH_2O\\cdot s/L}) \\times (0.08\\ \\mathrm{L/cmH_2O}) = 1.2\\ \\mathrm{s}$$\nThe initial volume is $V_T = 0.6\\ \\mathrm{L}$. The expiratory time is $T_e = 1\\ \\mathrm{s}$.\n\nThe end-expiratory volume, $V(T_e)$, is the volume remaining at $t = T_e = 1\\ \\mathrm{s}$:\n$$V(T_e) = V(1) = V_T \\exp\\left(-\\frac{T_e}{\\tau}\\right) = 0.6 \\exp\\left(-\\frac{1}{1.2}\\right)$$\n$$V(T_e) = 0.6 \\exp\\left(-\\frac{5}{6}\\right) \\approx 0.6 \\times 0.4345982 \\approx 0.2607589\\ \\mathrm{L}$$\nRounding to four significant figures, the end-expiratory volume is:\n$$V(T_e) \\approx 0.2608\\ \\mathrm{L}$$\n\nNext, we calculate the intrinsic positive end-expiratory pressure (PEEPi). The problem defines this as the alveolar elastic recoil pressure at the end of expiration, $p_{\\mathrm{el}}(T_e)$.\n$$\\mathrm{PEEPi} = p_{\\mathrm{el}}(T_e) = \\frac{V(T_e)}{C}$$\nUsing the unrounded value of $V(T_e)$ for better accuracy:\n$$\\mathrm{PEEPi} = \\frac{0.2607589\\ \\mathrm{L}}{0.08\\ \\mathrm{L/cmH_2O}} \\approx 3.2594865\\ \\mathrm{cmH_2O}$$\nRounding to four significant figures, the PEEPi is:\n$$\\mathrm{PEEPi} \\approx 3.259\\ \\mathrm{cmH_2O}$$\n\nThe final answer is the pair of values $(V(T_e), \\mathrm{PEEPi})$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.2608  3.259\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Building upon the single-compartment model, we now turn our attention from passive expiration to the energetics of active inspiration. This practice explores how the choice of ventilation strategy—specifically, the shape of the inspiratory flow waveform—impacts the mechanical work required to inflate the lungs. By comparing constant-flow inflation with pressure-controlled, decelerating-flow inflation, you will gain a deeper understanding of how resistance and compliance partition the total work of breathing and why this matters in clinical practice .",
            "id": "3925418",
            "problem": "A single-compartment lung model consists of a linear airway resistance and a linear elastic compartment in series. The airway pressure relative to the end-expiratory baseline is the sum of a resistive component and an elastic component. The resistive pressure drop is proportional to flow, and the elastic recoil pressure is proportional to volume. Assume the following:\n\n- The resistive element has resistance $R$ (in $\\mathrm{cm\\ H_2O\\,s\\,L^{-1}}$), the elastic element has compliance $C$ (in $\\mathrm{L\\,cm^{-1}\\,H_2O}$), and the elastance is $E = 1/C$.\n- Tidal inflation starts from zero volume and ends at volume $V_T$ after inspiratory time $T_I$.\n- The power delivered to each element is the product of its pressure and the instantaneous flow, and the mechanical work is the time integral of power.\n\nTwo inspiratory patterns deliver the same $V_T$ over the same $T_I$:\n\n- Case A (constant-flow inflation): $ \\dot{V}(t) = V_T/T_I $ for $0 \\le t \\le T_I$.\n- Case B (pressure-controlled inflation with decelerating flow): a constant driving pressure is applied at the airway, producing a first-order resistance–compliance (RC) response with time constant $\\tau = R C$ and solution $V(t) = V_{\\infty}\\left(1 - \\exp(-t/\\tau)\\right)$ for $0 \\le t \\le T_I$. The driving pressure is chosen so that $V(T_I) = V_T$.\n\nDefine the resistive work $W_{\\mathrm{res}}$ as the time integral of the resistive power and the elastic work $W_{\\mathrm{el}}$ as the stored elastic energy at end-inspiration. The resistive work fraction is\n$$\nf_{\\mathrm{res}} = \\frac{W_{\\mathrm{res}}}{W_{\\mathrm{res}} + W_{\\mathrm{el}}}.\n$$\n\nStarting only from the linear pressure–flow relationship for the resistor, the linear pressure–volume relationship for the elastic compartment, and the definitions of power and work, derive $f_{\\mathrm{res}}$ for each case as a simplified function of the nondimensional inspiratory duration $x = T_I/\\tau$. Express your final answer as a pair $\\big(f_{\\mathrm{res}}^{\\mathrm{const}}(x),\\ f_{\\mathrm{res}}^{\\mathrm{decel}}(x)\\big)$ of closed-form symbolic expressions in terms of $x$. No numerical evaluation or rounding is required, and no units should be included in the final answer.",
            "solution": "The problem is well-posed, scientifically grounded, and contains all necessary information for a unique solution. We begin by deriving the expressions for the resistive and elastic work based on the provided first principles.\n\nThe resistive pressure is given by $P_{\\mathrm{res}}(t) = R \\dot{V}(t)$ and the elastic pressure is $P_{\\mathrm{el}}(t) = \\frac{1}{C} V(t)$. The power delivered to an element is the product of pressure and flow, and work is the time integral of power. The total inspiratory time is $T_I$.\n\nThe resistive work, $W_{\\mathrm{res}}$, is the work dissipated by the resistor over the duration of inspiration. It is calculated as:\n$$\nW_{\\mathrm{res}} = \\int_0^{T_I} P_{\\mathrm{res}}(t) \\dot{V}(t) \\, dt = \\int_0^{T_I} (R \\dot{V}(t)) \\dot{V}(t) \\, dt = R \\int_0^{T_I} [\\dot{V}(t)]^2 \\, dt\n$$\nThis expression depends on the specific flow profile $\\dot{V}(t)$.\n\nThe elastic work, $W_{\\mathrm{el}}$, is the potential energy stored in the elastic element at the end of inspiration, when the volume is $V_T$. This work is done against the elastic recoil pressure.\n$$\nW_{\\mathrm{el}} = \\int_0^{T_I} P_{\\mathrm{el}}(t) \\dot{V}(t) \\, dt = \\int_0^{T_I} \\frac{V(t)}{C} \\dot{V}(t) \\, dt\n$$\nWe can change the variable of integration from time $t$ to volume $V$. Since $dV = \\dot{V}(t) \\, dt$, and the volume changes from $V(0)=0$ to $V(T_I)=V_T$, the integral becomes:\n$$\nW_{\\mathrm{el}} = \\int_0^{V_T} \\frac{V}{C} \\, dV = \\frac{1}{C} \\left[ \\frac{V^2}{2} \\right]_0^{V_T} = \\frac{V_T^2}{2C}\n$$\nThis important result shows that the elastic work stored at end-inspiration depends only on the final tidal volume $V_T$ and the compliance $C$, and is independent of the specific inflation pattern.\n\nNow, we calculate the resistive work fraction $f_{\\mathrm{res}} = \\frac{W_{\\mathrm{res}}}{W_{\\mathrm{res}} + W_{\\mathrm{el}}}$ for the two specified cases.\n\n**Case A: Constant-Flow Inflation**\n\nFor this case, the flow is constant over the inspiratory time $T_I$:\n$$\n\\dot{V}(t) = \\frac{V_T}{T_I}, \\quad 0 \\le t \\le T_I\n$$\nWe calculate the resistive work, $W_{\\mathrm{res}}^{\\mathrm{const}}$:\n$$\nW_{\\mathrm{res}}^{\\mathrm{const}} = R \\int_0^{T_I} \\left(\\frac{V_T}{T_I}\\right)^2 \\, dt = R \\frac{V_T^2}{T_I^2} \\int_0^{T_I} dt = R \\frac{V_T^2}{T_I^2} T_I = \\frac{R V_T^2}{T_I}\n$$\nThe elastic work is $W_{\\mathrm{el}} = \\frac{V_T^2}{2C}$. The resistive work fraction for constant-flow inflation, $f_{\\mathrm{res}}^{\\mathrm{const}}$, is:\n$$\nf_{\\mathrm{res}}^{\\mathrm{const}} = \\frac{W_{\\mathrm{res}}^{\\mathrm{const}}}{W_{\\mathrm{res}}^{\\mathrm{const}} + W_{\\mathrm{el}}} = \\frac{\\frac{R V_T^2}{T_I}}{\\frac{R V_T^2}{T_I} + \\frac{V_T^2}{2C}}\n$$\nWe can cancel the $V_T^2$ term from the numerator and denominator:\n$$\nf_{\\mathrm{res}}^{\\mathrm{const}} = \\frac{\\frac{R}{T_I}}{\\frac{R}{T_I} + \\frac{1}{2C}} = \\frac{R/T_I}{\\frac{2RC + T_I}{2CT_I}} = \\frac{R}{T_I} \\frac{2CT_I}{2RC + T_I} = \\frac{2RC}{2RC + T_I}\n$$\nWe are asked to express this in terms of the nondimensional time $x = T_I/\\tau$, where $\\tau = RC$. Substituting $T_I = x\\tau = xRC$:\n$$\nf_{\\mathrm{res}}^{\\mathrm{const}}(x) = \\frac{2RC}{2RC + xRC} = \\frac{2RC}{RC(2+x)} = \\frac{2}{2+x}\n$$\n\n**Case B: Pressure-Controlled Inflation with Decelerating Flow**\n\nThe volume follows a first-order response: $V(t) = V_{\\infty}(1 - \\exp(-t/\\tau))$. The condition $V(T_I) = V_T$ implies:\n$$\nV_T = V_{\\infty}(1 - \\exp(-T_I/\\tau)) \\implies V_{\\infty} = \\frac{V_T}{1 - \\exp(-T_I/\\tau)}\n$$\nThe instantaneous flow $\\dot{V}(t)$ is the time derivative of $V(t)$:\n$$\n\\dot{V}(t) = \\frac{d}{dt} \\left[ V_{\\infty}(1 - \\exp(-t/\\tau)) \\right] = \\frac{V_{\\infty}}{\\tau} \\exp(-t/\\tau)\n$$\nNow, we calculate the resistive work, $W_{\\mathrm{res}}^{\\mathrm{decel}}$:\n$$\nW_{\\mathrm{res}}^{\\mathrm{decel}} = R \\int_0^{T_I} [\\dot{V}(t)]^2 \\, dt = R \\int_0^{T_I} \\left(\\frac{V_{\\infty}}{\\tau} \\exp(-t/\\tau)\\right)^2 \\, dt = R \\frac{V_{\\infty}^2}{\\tau^2} \\int_0^{T_I} \\exp(-2t/\\tau) \\, dt\n$$\nThe integral evaluates to:\n$$\n\\int_0^{T_I} \\exp(-2t/\\tau) \\, dt = \\left[ \\frac{\\exp(-2t/\\tau)}{-2/\\tau} \\right]_0^{T_I} = -\\frac{\\tau}{2} (\\exp(-2T_I/\\tau) - 1) = \\frac{\\tau}{2} (1 - \\exp(-2T_I/\\tau))\n$$\nSubstituting this back into the expression for $W_{\\mathrm{res}}^{\\mathrm{decel}}$:\n$$\nW_{\\mathrm{res}}^{\\mathrm{decel}} = R \\frac{V_{\\infty}^2}{\\tau^2} \\frac{\\tau}{2} (1 - \\exp(-2T_I/\\tau)) = \\frac{R V_{\\infty}^2}{2\\tau} (1 - \\exp(-2T_I/\\tau))\n$$\nUsing $\\tau = RC$, we have $R/\\tau = 1/C$.\n$$\nW_{\\mathrm{res}}^{\\mathrm{decel}} = \\frac{V_{\\infty}^2}{2C} (1 - \\exp(-2T_I/\\tau))\n$$\nNow, we substitute the expression for $V_{\\infty}$:\n$$\nW_{\\mathrm{res}}^{\\mathrm{decel}} = \\frac{1}{2C} \\left( \\frac{V_T}{1 - \\exp(-T_I/\\tau)} \\right)^2 (1 - \\exp(-2T_I/\\tau))\n$$\nUsing the identity $1 - a^2 = (1-a)(1+a)$, we can write $1 - \\exp(-2T_I/\\tau) = (1 - \\exp(-T_I/\\tau))(1 + \\exp(-T_I/\\tau))$. This simplifies the expression for work:\n$$\nW_{\\mathrm{res}}^{\\mathrm{decel}} = \\frac{V_T^2}{2C} \\frac{(1 - \\exp(-T_I/\\tau))(1 + \\exp(-T_I/\\tau))}{(1 - \\exp(-T_I/\\tau))^2} = \\frac{V_T^2}{2C} \\frac{1 + \\exp(-T_I/\\tau)}{1 - \\exp(-T_I/\\tau)}\n$$\nThe elastic work is again $W_{\\mathrm{el}} = \\frac{V_T^2}{2C}$. The resistive work fraction for decelerating-flow inflation, $f_{\\mathrm{res}}^{\\mathrm{decel}}$, is:\n$$\nf_{\\mathrm{res}}^{\\mathrm{decel}} = \\frac{W_{\\mathrm{res}}^{\\mathrm{decel}}}{W_{\\mathrm{res}}^{\\mathrm{decel}} + W_{\\mathrm{el}}} = \\frac{\\frac{V_T^2}{2C} \\frac{1 + \\exp(-T_I/\\tau)}{1 - \\exp(-T_I/\\tau)}}{\\frac{V_T^2}{2C} \\frac{1 + \\exp(-T_I/\\tau)}{1 - \\exp(-T_I/\\tau)} + \\frac{V_T^2}{2C}}\n$$\nWe cancel the common factor of $\\frac{V_T^2}{2C}$:\n$$\nf_{\\mathrm{res}}^{\\mathrm{decel}} = \\frac{\\frac{1 + \\exp(-T_I/\\tau)}{1 - \\exp(-T_I/\\tau)}}{ \\frac{1 + \\exp(-T_I/\\tau)}{1 - \\exp(-T_I/\\tau)} + 1}\n$$\nMultiplying the numerator and denominator by $1 - \\exp(-T_I/\\tau)$:\n$$\nf_{\\mathrm{res}}^{\\mathrm{decel}} = \\frac{1 + \\exp(-T_I/\\tau)}{(1 + \\exp(-T_I/\\tau)) + (1 - \\exp(-T_I/\\tau))} = \\frac{1 + \\exp(-T_I/\\tau)}{2}\n$$\nFinally, we express this in terms of $x = T_I/\\tau$:\n$$\nf_{\\mathrm{res}}^{\\mathrm{decel}}(x) = \\frac{1 + \\exp(-x)}{2}\n$$\nThe pair of expressions for the resistive work fraction is $(f_{\\mathrm{res}}^{\\mathrm{const}}(x), f_{\\mathrm{res}}^{\\mathrm{decel}}(x))$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{2}{2+x}  \\frac{1+\\exp(-x)}{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Our final practice bridges the gap between theoretical models and experimental data, a crucial step in biomedical engineering. Here, you will tackle the \"inverse problem\": estimating the parameters of a respiratory model from real-world measurements. Using data from the Forced Oscillation Technique (FOT), which probes the lung with small pressure waves at different frequencies, you will implement a least-squares fitting procedure to determine the patient-specific values for resistance ($R$), compliance ($C$), and inertance ($I$) .",
            "id": "3925434",
            "problem": "A respiratory system may be modeled as a series combination of an airway resistance, an air-column inertance, and a combined lung-chest-wall compliance. The complex respiratory system impedance is defined as the sum of the impedances of series elements, and the standard impedances of the individual elements are given by $Z_R = R$ for the resistive element, $Z_I = j \\omega I$ for the inertive element, and $Z_C = \\dfrac{1}{j \\omega C}$ for the compliant element, where $j$ denotes the engineering imaginary unit, $\\omega$ is the angular frequency in $\\mathrm{rad/s}$, $R$ has units $\\mathrm{Pa\\cdot s/L}$, $I$ has units $\\mathrm{Pa\\cdot s^2/L}$, and $C$ has units $\\mathrm{L/Pa}$. Measurements of the magnitude $\\lvert Z_{rs}(\\omega) \\rvert$ and phase $\\phi(\\omega)$ of the respiratory system impedance are made at a set of angular frequencies. The goal is to estimate the parameters $R$, $I$, and $C$ by formulating an overdetermined system and solving it using least squares, relying only on the fundamental impedance definitions and the rule for series combinations.\n\nStarting from first principles and the above definitions, derive the linear system that relates the measured real and imaginary parts of the impedance to the parameters $R$, $I$, and $C$. Then, implement a numerical solver that:\n- Converts the provided magnitude and phase data into the measured complex impedance $Z_{m}(\\omega)$ by using $\\Re\\{Z_{m}(\\omega)\\} = \\lvert Z_{rs}(\\omega) \\rvert \\cos(\\phi(\\omega))$ and $\\Im\\{Z_{m}(\\omega)\\} = \\lvert Z_{rs}(\\omega) \\rvert \\sin(\\phi(\\omega))$, where the angle $\\phi(\\omega)$ is in radians.\n- Constructs an overdetermined linear system across frequencies for the real part to estimate $R$, and for the imaginary part to estimate $I$ and $C$ (through an intermediate elastance $E = \\dfrac{1}{C}$), and solves these systems using least squares.\n\nYour program must process the following test suite of measurement sets, each specified by angular frequencies $\\omega$ in $\\mathrm{rad/s}$, magnitudes $\\lvert Z_{rs}(\\omega) \\rvert$ in $\\mathrm{Pa\\cdot s/L}$, and phases $\\phi(\\omega)$ in $\\mathrm{radians}$:\n\n- Test Case 1:\n    - $\\omega = \\{5, 10, 20\\}\\ \\mathrm{rad/s}$\n    - $\\lvert Z_{rs} \\rvert = \\{270.529, 211.242, 196.381\\}\\ \\mathrm{Pa\\cdot s/L}$\n    - $\\phi = \\{-0.759, -0.3805, -0.05\\}\\ \\mathrm{radians}$\n\n- Test Case 2:\n    - $\\omega = \\{5, 10, 20\\}\\ \\mathrm{rad/s}$\n    - $\\lvert Z_{rs} \\rvert = \\{100.281, 100.000, 100.281\\}\\ \\mathrm{Pa\\cdot s/L}$\n    - $\\phi = \\{-0.07485985, 0.0, 0.07485985\\}\\ \\mathrm{radians}$\n\n- Test Case 3:\n    - $\\omega = \\{5, 10, 20\\}\\ \\mathrm{rad/s}$\n    - $\\lvert Z_{rs} \\rvert = \\{94.33981132, 94.33981132, 192.479\\}\\ \\mathrm{Pa\\cdot s/L}$\n    - $\\phi = \\{-0.558599, 0.558599, 1.144169\\}\\ \\mathrm{radians}$\n\n- Test Case 4:\n    - $\\omega = \\{5, 10, 20\\}\\ \\mathrm{rad/s}$\n    - $\\lvert Z_{rs} \\rvert = \\{60.298735, 61.224, 69.963\\}\\ \\mathrm{Pa\\cdot s/L}$\n    - $\\phi = \\{-0.099668652, 0.19739556, 0.5404195\\}\\ \\mathrm{radians}$\n\nIn all cases, the angle unit is radians, and the magnitudes are in $\\mathrm{Pa\\cdot s/L}$. Your algorithm must compute parameter estimates with the output expressed in the units $\\mathrm{Pa\\cdot s/L}$ for $R$, $\\mathrm{Pa\\cdot s^2/L}$ for $I$, and $\\mathrm{L/Pa}$ for $C$. The final output must be a single line containing a comma-separated list of lists, one per test case, each inner list holding three floating-point numbers $[R, I, C]$ in that order. Round each estimated parameter to six decimal places. For example, the output format should be like $[[R_1,I_1,C_1],[R_2,I_2,C_2],\\dots]$ with each $R_k$, $I_k$, and $C_k$ given as decimal floats.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[[r_1,i_1,c_1],[r_2,i_2,c_2],[r_3,i_3,c_3]]$).",
            "solution": "The problem statement is scientifically sound, well-posed, and provides all necessary information to derive a unique solution. It describes a standard method in biomedical engineering for characterizing respiratory mechanics using the forced oscillation technique. The model, data, and requested parameter estimation procedure are all consistent with established principles. We may therefore proceed with a formal derivation and solution.\n\nThe fundamental model for the respiratory system's complex impedance, $Z_{rs}(\\omega)$, as a function of angular frequency $\\omega$, is given by the series combination of a resistor ($R$), an inductor (representing inertance, $I$), and a capacitor (representing compliance, $C$). The total impedance is the sum of the individual element impedances:\n\n$$ Z_{rs}(\\omega) = Z_R + Z_I + Z_C $$\n\nThe specific impedances for these elements are given as $Z_R = R$, $Z_I = j \\omega I$, and $Z_C = \\frac{1}{j \\omega C}$, where $j$ is the imaginary unit satisfying $j^2 = -1$. Substituting these into the sum yields the model equation:\n\n$$ Z_{rs}(\\omega) = R + j \\omega I + \\frac{1}{j \\omega C} $$\n\nUsing the identity $\\frac{1}{j} = -j$, we can rewrite the equation to clearly separate its real and imaginary components:\n\n$$ Z_{rs}(\\omega) = R + j\\left(\\omega I - \\frac{1}{\\omega C}\\right) $$\n\nFrom this equation, we can identify the theoretical real and imaginary parts of the impedance:\n\n$$ \\Re\\{Z_{rs}(\\omega)\\} = R $$\n$$ \\Im\\{Z_{rs}(\\omega)\\} = \\omega I - \\frac{1}{\\omega C} $$\n\nThe problem specifies that measurements of the impedance magnitude, $|\\hat{Z}_{rs}(\\omega_k)|$, and phase, $\\hat{\\phi}(\\omega_k)$, are available at a set of $N$ discrete frequencies, $\\omega_k$ for $k=1, 2, \\dots, N$. These measurements are used to compute the real and imaginary parts of the measured impedance, which we denote as $\\hat{Z}_{m}(\\omega_k)$:\n\n$$ \\Re\\{\\hat{Z}_{m}(\\omega_k)\\} = |\\hat{Z}_{rs}(\\omega_k)| \\cos(\\hat{\\phi}(\\omega_k)) $$\n$$ \\Im\\{\\hat{Z}_{m}(\\omega_k)\\} = |\\hat{Z}_{rs}(\\omega_k)| \\sin(\\hat{\\phi}(\\omega_k)) $$\n\nThe estimation of the three parameters ($R$, $I$, $C$) is structured as two independent linear least-squares problems, one for the real part and one for the imaginary part.\n\n**1. Estimation of Resistance ($R$)**\n\nThe model for the real part of the impedance is simply a constant, $R$, independent of frequency. We thus have a set of $N$ equations based on our measurements:\n\n$$ \\Re\\{\\hat{Z}_{m}(\\omega_k)\\} \\approx R \\quad \\text{for } k=1, \\dots, N $$\n\nThis constitutes an overdetermined system for the single unknown parameter $R$. The goal is to find the value of $R$ that minimizes the sum of squared errors between the model and the measurements. In matrix form, this is $\\mathbf{A}x = \\mathbf{b}$, where $\\mathbf{A}$ is a column vector of ones, $x = [R]$, and $\\mathbf{b}$ is the vector of measured real parts. The standard least-squares solution for this specific system simplifies to the arithmetic mean of the measurements:\n\n$$ \\hat{R} = \\frac{1}{N} \\sum_{k=1}^{N} \\Re\\{\\hat{Z}_{m}(\\omega_k)\\} $$\n\n**2. Estimation of Inertance ($I$) and Compliance ($C$)**\n\nThe model for the imaginary part is $\\Im\\{Z_{rs}(\\omega)\\} = \\omega I - \\frac{1}{\\omega C}$. This expression is not linear in the parameter $C$. To linearize the problem, we introduce the parameter elastance, $E$, defined as the reciprocal of compliance: $E = \\frac{1}{C}$. The model for the imaginary part becomes linear in the parameters $I$ and $E$:\n\n$$ \\Im\\{Z_{rs}(\\omega)\\} = \\omega I - \\frac{E}{\\omega} $$\n\nFor each measurement frequency $\\omega_k$, we have an equation:\n\n$$ \\Im\\{\\hat{Z}_{m}(\\omega_k)\\} \\approx \\omega_k I - \\frac{1}{\\omega_k} E $$\n\nThis forms an overdetermined system of $N$ linear equations for the two unknowns, $I$ and $E$. We can express this in the standard matrix form $\\mathbf{A}\\mathbf{x} = \\mathbf{b}$:\n\n$$\n\\begin{pmatrix}\n\\omega_1  -1/\\omega_1 \\\\\n\\omega_2  -1/\\omega_2 \\\\\n\\vdots  \\vdots \\\\\n\\omega_N  -1/\\omega_N\n\\end{pmatrix}\n\\begin{pmatrix} I \\\\ E \\end{pmatrix}\n=\n\\begin{pmatrix}\n\\Im\\{\\hat{Z}_{m}(\\omega_1)\\} \\\\\n\\Im\\{\\hat{Z}_{m}(\\omega_2)\\} \\\\\n\\vdots \\\\\n\\Im\\{\\hat{Z}_{m}(\\omega_N)\\}\n\\end{pmatrix}\n$$\n\nHere, the design matrix $\\mathbf{A}$ contains terms dependent on $\\omega_k$, the vector of unknowns is $\\mathbf{x} = [I, E]^T$, and the observation vector $\\mathbf{b}$ contains the measured imaginary impedance values. The least-squares solution, $\\hat{\\mathbf{x}} = [\\hat{I}, \\hat{E}]^T$, is the one that minimizes the Euclidean norm of the residual error, $||\\mathbf{A}\\mathbf{x} - \\mathbf{b}||_2$. This solution is typically found using robust numerical methods, such as those provided by the `numpy.linalg.lstsq` function, which can be expressed mathematically as:\n\n$$ \\hat{\\mathbf{x}} = (\\mathbf{A}^T\\mathbf{A})^{-1}\\mathbf{A}^T\\mathbf{b} $$\n\nOnce the estimate for elastance, $\\hat{E}$, is obtained, the estimate for compliance, $\\hat{C}$, is calculated from its definition:\n\n$$ \\hat{C} = \\frac{1}{\\hat{E}} $$\n\nThis procedure will be applied to each test case to determine the estimates for $R$, $I$, and $C$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Estimates respiratory parameters R, I, and C from impedance measurements\n    using a decoupled least-squares approach.\n    \"\"\"\n    test_cases = [\n        {\n            \"w\": np.array([5, 10, 20]),\n            \"Z_mag\": np.array([270.529, 211.242, 196.381]),\n            \"phi\": np.array([-0.759, -0.3805, -0.05]),\n        },\n        {\n            \"w\": np.array([5, 10, 20]),\n            \"Z_mag\": np.array([100.281, 100.000, 100.281]),\n            \"phi\": np.array([-0.07485985, 0.0, 0.07485985]),\n        },\n        {\n            \"w\": np.array([5, 10, 20]),\n            \"Z_mag\": np.array([94.33981132, 94.33981132, 192.479]),\n            \"phi\": np.array([-0.558599, 0.558599, 1.144169]),\n        },\n        {\n            \"w\": np.array([5, 10, 20]),\n            \"Z_mag\": np.array([60.298735, 61.224, 69.963]),\n            \"phi\": np.array([-0.099668652, 0.19739556, 0.5404195]),\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        w = case[\"w\"]\n        Z_mag = case[\"Z_mag\"]\n        phi = case[\"phi\"]\n\n        # Step 1: Convert magnitude and phase to complex impedance, then to real and imaginary parts.\n        # Z_m = Z_mag * (cos(phi) + j*sin(phi)) = Z_mag * exp(j*phi)\n        Z_measured_complex = Z_mag * np.exp(1j * phi)\n        Z_real = Z_measured_complex.real\n        Z_imag = Z_measured_complex.imag\n\n        # Step 2: Estimate R from the real part of the impedance.\n        # The model is R_{measured} = R. The least-squares estimate is the mean.\n        R_est = np.mean(Z_real)\n\n        # Step 3: Estimate I and C (via E=1/C) from the imaginary part.\n        # The model is Z_imag = w*I - (1/w)*E. This is a linear system Ax = b.\n        # A has two columns: [w, -1/w]\n        # x is the vector of unknowns: [I, E]\n        # b is the vector of measurements: Z_imag\n        \n        # Construct the design matrix A\n        A = np.vstack([w, -1.0 / w]).T\n        \n        # The observation vector b is the imaginary part of the impedance.\n        b = Z_imag\n        \n        # Solve the overdetermined linear system Ax = b for x = [I, E] using least squares.\n        # lstsq returns the solution, residuals, rank, and singular values. We only need the solution.\n        x_est, _, _, _ = np.linalg.lstsq(A, b, rcond=None)\n        \n        I_est = x_est[0]\n        E_est = x_est[1]\n        \n        # Calculate C from E\n        C_est = 1.0 / E_est\n        \n        # Store results for this case.\n        all_results.append([R_est, I_est, C_est])\n\n    # Format the final output string as specified in the problem statement.\n    # Each sub-list is formatted to produce \"[r,i,c]\" with no internal spaces.\n    # Numbers are rounded to 6 decimal places.\n    formatted_results = []\n    for res_list in all_results:\n        inner_str = f\"[{','.join(f'{x:.6f}' for x in res_list)}]\"\n        formatted_results.append(inner_str)\n    \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}