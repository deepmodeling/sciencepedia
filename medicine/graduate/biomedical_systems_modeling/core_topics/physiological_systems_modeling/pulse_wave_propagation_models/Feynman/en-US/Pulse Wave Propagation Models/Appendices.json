{
    "hands_on_practices": [
        {
            "introduction": "The speed at which a pressure pulse travels through an artery, known as the Pulse Wave Velocity (PWV), is a fundamental parameter in cardiovascular hemodynamics. This practice guides you through a foundational derivation of the Moens-Korteweg equation, starting from the first principles of mass and momentum conservation. By linking the material properties of the arterial wall, such as its Young's modulus $E$, to the wave speed $c$, you will gain a deep, physical understanding of why stiffer arteries lead to faster pulse waves, a key diagnostic marker for cardiovascular health .",
            "id": "3922840",
            "problem": "An idealized straight arterial segment of reference radius $R$ and wall thickness $h$ carries blood of mass density $\\rho$. Assume the blood is incompressible and that viscous losses can be neglected for the purpose of determining wave speed. The arterial wall is thin, isotropic, and linearly elastic with incremental Young’s modulus $E$, and the pulse consists of small, axisymmetric perturbations about the reference state. Under these assumptions, start from one-dimensional conservation of mass and linear momentum for flow in a deformable tube, together with linear elasticity and the circumferential force balance for a thin-walled cylinder, to derive the local speed $c$ of small-amplitude pressure waves in terms of $E$, $h$, $R$, and $\\rho$. Then, using $E=0.6\\,\\text{MPa}$, $h=1.2\\,\\text{mm}$, $R=4\\,\\text{mm}$, and $\\rho=1050\\,\\text{kg/m}^3$, evaluate the baseline pulse wave velocity (PWV) and determine the new PWV after a $20\\%$ increase in $E$ due to aging. Explain the scaling of $c$ with $E$ implied by your derivation. Express your final numerical answer as the new PWV in meters per second and round to four significant figures.",
            "solution": "The problem will be validated before a solution is attempted.\n\n### Step 1: Extract Givens\n-   Arterial segment is an idealized straight tube.\n-   Reference radius: $R$\n-   Wall thickness: $h$\n-   Blood mass density: $\\rho$\n-   Blood is incompressible.\n-   Viscous losses can be neglected.\n-   Arterial wall is thin, isotropic, and linearly elastic.\n-   Incremental Young’s modulus of the wall: $E$\n-   Pulse consists of small, axisymmetric perturbations about the reference state.\n-   The derivation must start from one-dimensional conservation of mass and linear momentum for flow in a deformable tube, together with linear elasticity and circumferential force balance for a thin-walled cylinder.\n-   The goal is to derive the local speed $c$ of small-amplitude pressure waves.\n-   Numerical values for evaluation:\n    -   $E = 0.6\\,\\text{MPa}$\n    -   $h = 1.2\\,\\text{mm}$\n    -   $R = 4\\,\\text{mm}$\n    -   $\\rho = 1050\\,\\text{kg/m}^3$\n-   A secondary task is to calculate the new pulse wave velocity (PWV) after a $20\\%$ increase in $E$.\n-   The final numerical answer must be the new PWV in meters per second, rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is a standard textbook exercise in biomechanics and fluid dynamics, specifically modeling pulse wave propagation in arteries.\n-   **Scientifically Grounded (Critical)**: The problem is based on fundamental principles of fluid mechanics (conservation of mass and momentum) and solid mechanics (linear elasticity, thin-walled cylinder theory). The assumptions (inviscid, incompressible flow, small perturbations, linear elasticity) are standard simplifications for deriving the Moens-Korteweg equation, which is a cornerstone of this field.\n-   **Well-Posed**: The problem provides all necessary parameters and a clear objective, leading to a unique solution for the wave speed $c$. The provided numerical values are physically realistic for a large artery.\n-   **Objective (Critical)**: The language is precise and technical, free of subjectivity or ambiguity.\n\nThe problem does not violate any of the invalidity criteria. It is a well-defined, scientifically sound problem.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A full solution will be provided.\n\n### Derivation of Pulse Wave Velocity (PWV)\n\nThe derivation is based on the one-dimensional equations for conservation of mass and momentum in a deformable tube, coupled with an equation describing the tube's elastic properties (a \"tube law\").\n\nLet $A(x, t)$ be the cross-sectional area of the artery, $u(x, t)$ be the axial fluid velocity, and $P(x, t)$ be the pressure, all functions of axial position $x$ and time $t$. The fluid density $\\rho$ is constant.\n\n1.  **Conservation of Mass (Continuity Equation)**\n    For an inviscid, incompressible fluid in a tube of changing area, the 1D continuity equation is:\n    $$ \\frac{\\partial A}{\\partial t} + \\frac{\\partial (Au)}{\\partial x} = 0 $$\n    Expanding the second term:\n    $$ \\frac{\\partial A}{\\partial t} + A \\frac{\\partial u}{\\partial x} + u \\frac{\\partial A}{\\partial x} = 0 $$\n\n2.  **Conservation of Momentum (Euler's Equation)**\n    For an inviscid fluid, the 1D momentum equation is:\n    $$ \\rho \\left( \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} \\right) = - \\frac{\\partial P}{\\partial x} $$\n\n3.  **Linearization for Small Perturbations**\n    The problem specifies small perturbations around a reference state of zero flow ($u_0 = 0$) and constant reference radius $R$ and area $A_0 = \\pi R^2$. We define the perturbations as:\n    $A(x, t) = A_0 + a'(x, t)$\n    $u(x, t) = u'(x, t)$\n    $P(x, t) = P_0 + p'(x, t)$\n    Substituting these into the governing equations and dropping terms of second order in the small\n    perturbations (e.g., $u' \\frac{\\partial a'}{\\partial x}$, $(u')^2$) yields the linearized equations:\n\n    Linearized Continuity:\n    $$ \\frac{\\partial a'}{\\partial t} + A_0 \\frac{\\partial u'}{\\partial x} = 0 $$\n\n    Linearized Momentum:\n    $$ \\rho \\frac{\\partial u'}{\\partial t} = - \\frac{\\partial p'}{\\partial x} $$\n\n4.  **Tube Law (Elastic Properties)**\n    We need a relationship between the change in pressure $p'$ and the change in area $a'$. We model the artery as a thin-walled elastic cylinder. The hoop stress $\\sigma_\\theta$ is given by the circumferential force balance:\n    $$ \\sigma_\\theta = \\frac{P r}{h} $$\n    where $P$ is the transmural pressure and $r$ is the instantaneous radius. The circumferential strain $\\epsilon_\\theta$ relative to the reference radius $R$ is:\n    $$ \\epsilon_\\theta = \\frac{r - R}{R} $$\n    The wall is linearly elastic, so stress is proportional to strain via Young's modulus $E$:\n    $$ \\sigma_\\theta = E \\epsilon_\\theta $$\n    Combining these gives:\n    $$ \\frac{P r}{h} = E \\frac{r - R}{R} $$\n    To linearize this relation, we consider small changes $r = R + r'$ and $P = P_0 + p'$, where $p'$ causes $r'$.\n    $$ \\frac{(P_0 + p')(R + r')}{h} = E \\frac{r'}{R} $$\n    Assuming the pressure-induced stress is much larger than the pre-stress effect (a standard simplification, equivalent to $P_0 \\ll Eh/R$) and dropping second-order terms ($p'r'$), we get:\n    $$ \\frac{p' R}{h} \\approx E \\frac{r'}{R} \\implies p' \\approx \\frac{Eh}{R^2} r' $$\n    Now, we relate the radius change $r'$ to the area change $a'$.\n    $A = \\pi r^2 \\implies dA = 2 \\pi r dr$. For small perturbations, $a' \\approx 2 \\pi R r'$. Thus, $r' \\approx \\frac{a'}{2 \\pi R}$.\n    Substituting $r'$ into the pressure relation:\n    $$ p' \\approx \\frac{Eh}{R^2} \\left( \\frac{a'}{2 \\pi R} \\right) = \\frac{Eh}{2 \\pi R^3} a' $$\n    This provides the linear tube law relating pressure and area perturbations, which can be expressed in terms of derivatives as:\n    $$ \\frac{dp'}{da'} = \\frac{Eh}{2 \\pi R^3} \\quad \\text{or} \\quad \\frac{da'}{dp'} = \\frac{2 \\pi R^3}{Eh} $$\n\n5.  **Derivation of the Wave Equation**\n    We now have a system of three equations:\n    (i) $\\frac{\\partial a'}{\\partial t} = -A_0 \\frac{\\partial u'}{\\partial x}$\n    (ii) $\\frac{\\partial p'}{\\partial x} = -\\rho \\frac{\\partial u'}{\\partial t}$\n    (iii) $a' = \\left(\\frac{2 \\pi R^3}{Eh}\\right) p'$\n\n    From (iii), we can write $\\frac{\\partial a'}{\\partial t} = \\frac{2 \\pi R^3}{Eh} \\frac{\\partial p'}{\\partial t}$. Substitute this into (i), along with $A_0 = \\pi R^2$:\n    $$ \\frac{2 \\pi R^3}{Eh} \\frac{\\partial p'}{\\partial t} = -(\\pi R^2) \\frac{\\partial u'}{\\partial x} \\implies \\frac{2 R}{Eh} \\frac{\\partial p'}{\\partial t} = - \\frac{\\partial u'}{\\partial x} $$\n    Now, differentiate this equation with respect to $t$ and the linearized momentum equation (ii) with respect to $x$:\n    $$ \\frac{2 R}{Eh} \\frac{\\partial^2 p'}{\\partial t^2} = - \\frac{\\partial^2 u'}{\\partial x \\partial t} $$\n    $$ \\frac{\\partial^2 p'}{\\partial x^2} = - \\rho \\frac{\\partial^2 u'}{\\partial t \\partial x} $$\n    Assuming the functions are sufficiently smooth, the order of differentiation can be interchanged ($\\frac{\\partial^2 u'}{\\partial x \\partial t} = \\frac{\\partial^2 u'}{\\partial t \\partial x}$). We can equate the expressions for the mixed partial derivative:\n    $$ \\frac{2 R}{Eh} \\frac{\\partial^2 p'}{\\partial t^2} = \\frac{1}{\\rho} \\frac{\\partial^2 p'}{\\partial x^2} $$\n    Rearranging this into the standard form of the one-dimensional wave equation, $\\frac{\\partial^2 p'}{\\partial t^2} = c^2 \\frac{\\partial^2 p'}{\\partial x^2}$, we get:\n    $$ \\frac{\\partial^2 p'}{\\partial t^2} = \\left(\\frac{Eh}{2 \\rho R}\\right) \\frac{\\partial^2 p'}{\\partial x^2} $$\n    By comparison, the square of the wave propagation speed $c$ is:\n    $$ c^2 = \\frac{Eh}{2 \\rho R} $$\n    Thus, the pulse wave velocity is given by the Moens-Korteweg equation:\n    $$ c = \\sqrt{\\frac{Eh}{2 \\rho R}} $$\n\n### Scaling of PWV with Young's Modulus\nThe derived formula shows that the pulse wave velocity $c$ is proportional to the square root of the Young's modulus $E$:\n$$ c \\propto \\sqrt{E} $$\nThis relationship implies that as the arterial wall becomes stiffer (i.e., $E$ increases), the pulse wave travels faster. This is consistent with clinical observations where arterial stiffening due to aging or disease leads to an increased PWV.\n\n### Numerical Calculation\nThe given baseline values are:\n$E_{base} = 0.6\\,\\text{MPa} = 0.6 \\times 10^6\\,\\text{Pa}$\n$h = 1.2\\,\\text{mm} = 1.2 \\times 10^{-3}\\,\\text{m}$\n$R = 4\\,\\text{mm} = 4 \\times 10^{-3}\\,\\text{m}$\n$\\rho = 1050\\,\\text{kg/m}^3$\n\nArterial aging causes a $20\\%$ increase in $E$. The new Young's modulus, $E_{new}$, is:\n$E_{new} = E_{base} \\times (1 + 0.20) = 1.20 \\times E_{base}$\n$E_{new} = 1.20 \\times (0.6 \\times 10^6\\,\\text{Pa}) = 0.72 \\times 10^6\\,\\text{Pa}$\n\nWe now calculate the new pulse wave velocity, $c_{new}$, using the derived formula:\n$$ c_{new} = \\sqrt{\\frac{E_{new} h}{2 \\rho R}} $$\nSubstituting the numerical values:\n$$ c_{new} = \\sqrt{\\frac{(0.72 \\times 10^6\\,\\text{Pa}) \\times (1.2 \\times 10^{-3}\\,\\text{m})}{2 \\times (1050\\,\\text{kg/m}^3) \\times (4 \\times 10^{-3}\\,\\text{m})}} $$\n$$ c_{new} = \\sqrt{\\frac{0.864 \\times 10^3}{8.4}} = \\sqrt{\\frac{864}{8.4}} $$\n$$ c_{new} = \\sqrt{102.85714...} \\approx 10.141849\\,\\text{m/s} $$\nRounding to four significant figures, the new pulse wave velocity is $10.14\\,\\text{m/s}$.",
            "answer": "$$ \\boxed{10.14} $$"
        },
        {
            "introduction": "The arterial system is not a single tube but a complex, branching network. This practice extends the single-vessel model to a multi-generational arterial tree, introducing powerful concepts from transmission line theory like characteristic impedance $Z_c$ and reflection coefficients $\\Gamma$ . By simulating wave propagation through bifurcations and terminal loads, you will learn how impedance mismatches create wave reflections that shape the pressure and flow waveforms throughout the cardiovascular system.",
            "id": "3922852",
            "problem": "Consider a three-generation arterial tree modeled using the one-dimensional (1D) linearized pulse wave propagation framework. The root segment bifurcates into two daughter segments, and each daughter bifurcates into two terminal segments, resulting in four terminal branches. Assume blood is an incompressible Newtonian fluid with density $\\rho$ and that each arterial segment is straight, axisymmetric, and thin-walled. For each segment $i$, let the radius be $R_i$, the length be $L_i$, the Young's modulus be $E_i$, and the wall thickness be $h_i = \\alpha R_i$, where $\\alpha$ is a given wall thickness-to-radius ratio shared within a test case. The Moens-Korteweg formula gives the wave speed $c_i = \\sqrt{E_i h_i/(2\\rho R_i)}$, and the characteristic impedance is $Z_{c,i} = \\rho c_i/A_i$ with $A_i = \\pi R_i^2$. Assume lossless propagation, so the wavenumber is $k_i = \\omega/c_i$ with angular frequency $\\omega = 2\\pi f$, where $f$ is the driving frequency.\n\nAt each distal end, define the local load impedance $Z_{\\text{load}}$ as follows:\n- For terminal segments, $Z_{\\text{load}}$ equals the given terminal resistance $R_{\\text{term}}$.\n- For bifurcation junctions, $Z_{\\text{load}}$ equals the parallel combination of the input impedances of the downstream daughter segments.\n\nLet the inlet be driven by a harmonic pressure source with complex amplitude $P_{\\text{in}}$ at frequency $f$ (assume zero phase, i.e., $P_{\\text{in}}$ is real and positive). Use conservation of mass (flow continuity) and continuity of pressure at each junction. Use the forward/backward wave decomposition for each segment, where the pressure and flow at position $x$ are the sums and differences of forward and backward waves, respectively, and enforce the termination condition at each distal end through its load impedance.\n\nTasks:\n1. Compute the complex input impedance at the proximal end of each segment by working from terminals upstream to the root using the standard lossless transmission-line relationships and parallel combinations at junctions.\n2. Compute the inlet flow amplitude $Q_{\\text{in}}$ at the root in $\\text{m}^3/\\text{s}$, and the flow amplitudes entering each terminal load in $\\text{m}^3/\\text{s}$, all expressed as magnitudes (absolute values).\n3. For each distal site (seven sites total: three bifurcation junctions and four terminals), compute the local reflection coefficient magnitude defined by $\\Gamma = (Z_{\\text{load}} - Z_c)/(Z_{\\text{load}} + Z_c)$, where $Z_c$ is the characteristic impedance of the upstream segment. Identify the indices of sites where $|\\Gamma| \\ge \\tau$, with threshold $\\tau$ specified per test suite below. The site indices are defined as:\n   - Site $0$: distal end of the root segment (first bifurcation),\n   - Site $1$: distal end of the left daughter segment (second bifurcation on left),\n   - Site $2$: distal end of the right daughter segment (second bifurcation on right),\n   - Sites $3,4$: distal ends of the two terminal segments on the left subtree,\n   - Sites $5,6$: distal ends of the two terminal segments on the right subtree.\n4. Express all flow magnitudes in $\\text{m}^3/\\text{s}$, all pressures in pascals, and all angles in radians. Report flow amplitudes as magnitudes only (no phases). Round all floating-point outputs to six decimal places.\n\nYour program must implement the above and produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, where each test case result is itself a list formatted as:\n[$Q_{\\text{in}}$, $Q_3$, $Q_4$, $Q_5$, $Q_6$, $\\max|\\Gamma|$, [indices of major reflection sites]],\nwith flow magnitudes in $\\text{m}^3/\\text{s}$ and $\\max|\\Gamma|$ dimensionless. The final output format must therefore be of the form:\n[[case1_result],[case2_result],[case3_result]]\nwith no spaces anywhere in the string and floats rounded to six decimal places.\n\nTest Suite:\nUse the following scientifically plausible parameter sets, covering a typical case, a near-matched boundary case, and a strongly asymmetric case.\n\nCase 1 (symmetric tree, moderate mismatch):\n- $\\rho = 1060\\,\\text{kg}/\\text{m}^3$, $E_i = 6.0\\times 10^5\\,\\text{Pa}$ for all segments, $\\alpha = 0.10$, $f = 2.0\\,\\text{Hz}$, $P_{\\text{in}} = 5000\\,\\text{Pa}$.\n- Radii (meters): $[R_0,R_1,R_2,R_3,R_4,R_5,R_6] = [0.005, 0.004, 0.004, 0.003, 0.003, 0.003, 0.003]$.\n- Lengths (meters): $[L_0,L_1,L_2,L_3,L_4,L_5,L_6] = [0.20, 0.15, 0.15, 0.10, 0.10, 0.10, 0.10]$.\n- Terminal resistances (Pa·s/m$^3$): $[1.0\\times 10^8, 1.0\\times 10^8, 1.0\\times 10^8, 1.0\\times 10^8]$.\n- Threshold: $\\tau = 0.25$.\n\nCase 2 (near impedance matching at terminals):\n- $\\rho = 1060\\,\\text{kg}/\\text{m}^3$, $E_i = 5.0\\times 10^5\\,\\text{Pa}$ for all segments, $\\alpha = 0.09$, $f = 1.0\\,\\text{Hz}$, $P_{\\text{in}} = 4000\\,\\text{Pa}$.\n- Radii (meters): $[R_0,R_1,R_2,R_3,R_4,R_5,R_6] = [0.006, 0.0045, 0.0045, 0.0035, 0.0035, 0.0035, 0.0035]$.\n- Lengths (meters): $[L_0,L_1,L_2,L_3,L_4,L_5,L_6] = [0.25, 0.18, 0.18, 0.12, 0.12, 0.12, 0.12]$.\n- Terminal resistances (Pa·s/m$^3$): $[7.0\\times 10^7, 7.0\\times 10^7, 7.0\\times 10^7, 7.0\\times 10^7]$.\n- Threshold: $\\tau = 0.25$.\n\nCase 3 (strongly asymmetric tree, larger mismatch):\n- $\\rho = 1060\\,\\text{kg}/\\text{m}^3$, $E_i = 6.5\\times 10^5\\,\\text{Pa}$ for all segments, $\\alpha = 0.12$, $f = 4.0\\,\\text{Hz}$, $P_{\\text{in}} = 6000\\,\\text{Pa}$.\n- Radii (meters): $[R_0,R_1,R_2,R_3,R_4,R_5,R_6] = [0.005, 0.003, 0.005, 0.002, 0.0025, 0.005, 0.005]$.\n- Lengths (meters): $[L_0,L_1,L_2,L_3,L_4,L_5,L_6] = [0.18, 0.16, 0.16, 0.10, 0.10, 0.12, 0.12]$.\n- Terminal resistances (Pa·s/m$^3$): $[8.0\\times 10^7, 9.0\\times 10^7, 6.0\\times 10^7, 6.0\\times 10^7]$.\n- Threshold: $\\tau = 0.25$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets with no spaces, exactly in the form:\n[[Qin_case1,Q3_case1,Q4_case1,Q5_case1,Q6_case1,maxGamma_case1,[indices_case1]],[Qin_case2,Q3_case2,Q4_case2,Q5_case2,Q6_case2,maxGamma_case2,[indices_case2]],[Qin_case3,Q3_case3,Q4_case3,Q5_case3,Q6_case3,maxGamma_case3,[indices_case3]]]\nAll floating-point values must be rounded to six decimal places.",
            "solution": "The modeling foundation is the one-dimensional (1D) linearized equations for pulse wave propagation in compliant vessels, obtained from conservation of mass and conservation of momentum for incompressible flow in deformable tubes. In the frequency domain under small perturbations around a steady state, these yield wave equations supporting forward and backward traveling waves of pressure and flow. The wave speed and characteristic impedance depend on wall mechanics and geometry.\n\nFundamental base:\n- Conservation of mass implies that cross-sectional area changes and axial flow variations are related, and conservation of momentum provides the relation between pressure gradients and acceleration of the fluid.\n- For thin-walled, axisymmetric tubes, the Moens-Korteweg wave speed is $c_i = \\sqrt{\\dfrac{E_i h_i}{2\\rho R_i}}$, where $E_i$ is Young's modulus, $h_i$ is wall thickness, $\\rho$ is fluid density, and $R_i$ is radius. This formula is a well-tested relationship for pulse wave velocity in arteries under the thin-wall approximation.\n- The characteristic impedance is $Z_{c,i} = \\dfrac{\\rho c_i}{A_i}$, where $A_i = \\pi R_i^2$ is the cross-sectional area. This impedance relates pressure and flow for a single traveling wave in a uniform tube.\n- In the frequency domain with angular frequency $\\omega = 2\\pi f$, the wavenumber is $k_i = \\omega/c_i$. Assuming negligible viscous damping at the scale of interest and small amplitude waves (lossless approximation), the propagation of forward and backward waves over a length $L_i$ is described by multiplicative phase factors $\\exp(\\pm j k_i L_i)$.\n\nTransmission line relations:\n- For a uniform segment $i$ with characteristic impedance $Z_{c,i}$ and wavenumber $k_i$, let $P_i(x)$ and $Q_i(x)$ be the complex pressure and flow phasors. The general solution can be written as $P_i(x) = P_i^+ e^{-j k_i x} + P_i^- e^{j k_i x}$ and $Q_i(x) = \\dfrac{1}{Z_{c,i}}\\left(P_i^+ e^{-j k_i x} - P_i^- e^{j k_i x}\\right)$, where $P_i^+$ and $P_i^-$ are the forward and backward pressure wave amplitudes at the proximal end ($x=0$).\n- At the distal end ($x=L_i$), the load impedance $Z_{\\text{load}}$ imposes $P_i(L_i) = Z_{\\text{load}}\\,Q_i(L_i)$. This termination condition relates $P_i^-$ at $x=L_i$ to $P_i^+$ at $x=L_i$ through the local reflection coefficient $\\Gamma = \\dfrac{Z_{\\text{load}} - Z_{c,i}}{Z_{\\text{load}} + Z_{c,i}}$. The backward wave at the proximal end satisfies $P_i^- (0) = \\Gamma e^{-2 j k_i L_i} P_i^+ (0)$, which we denote using the round-trip factor $R = \\Gamma e^{-2 j k_i L_i}$.\n- The input impedance at the proximal end, defined as $Z_{\\text{in},i} = P_i(0)/Q_i(0)$, follows $Z_{\\text{in},i} = Z_{c,i}\\dfrac{1 + R}{1 - R}$ by combining the forward/backward decomposition with the termination condition. This recursion allows computation of input impedances from distal to proximal ends.\n\nJunction conditions:\n- At a bifurcation, pressure is continuous across branches and flows sum: if the node pressure is $P_{\\text{node}}$ and the daughter input impedances are $Z_{\\text{in},a}$ and $Z_{\\text{in},b}$, then the equivalent load seen by the parent is the parallel combination $Z_{\\text{load}} = \\left(\\dfrac{1}{Z_{\\text{in},a}} + \\dfrac{1}{Z_{\\text{in},b}}\\right)^{-1}$. The parent segment uses this $Z_{\\text{load}}$ to form its reflection coefficient and input impedance, as above. The flows entering the daughters are $Q_a = P_{\\text{node}}/Z_{\\text{in},a}$ and $Q_b = P_{\\text{node}}/Z_{\\text{in},b}$, consistent with flow continuity and linearity.\n\nAlgorithmic steps:\n1. For each test case, compute $h_i = \\alpha R_i$, areas $A_i$, wave speeds $c_i = \\sqrt{\\dfrac{E_i h_i}{2\\rho R_i}}$, characteristic impedances $Z_{c,i} = \\dfrac{\\rho c_i}{A_i}$, and wavenumbers $k_i = \\omega/c_i$ for all seven segments $i=0,\\ldots,6$.\n2. Compute input impedances recursively starting from the four terminal segments ($i=3,4,5,6$). For each terminal, the load impedance is the given resistance $R_{\\text{term}}$, and the reflection coefficient is $\\Gamma_i = \\dfrac{R_{\\text{term}} - Z_{c,i}}{R_{\\text{term}} + Z_{c,i}}$. The round-trip factor is $R_i = \\Gamma_i e^{-2 j k_i L_i}$, and the input impedance is $Z_{\\text{in},i} = Z_{c,i}\\dfrac{1 + R_i}{1 - R_i}$.\n3. At the second-generation bifurcations (sites $1$ and $2$), form the parallel load $Z_{\\text{load}}$ from the two daughter input impedances and compute the corresponding reflection coefficients and input impedances for segments $i=1$ and $i=2$ using the same formula.\n4. At the first-generation bifurcation (site $0$), form the parallel load from $Z_{\\text{in},1}$ and $Z_{\\text{in},2}$ and compute the reflection coefficient and input impedance for the root segment $i=0$.\n5. With the root input impedance $Z_{\\text{in},0}$, compute the inlet flow $Q_{\\text{in}} = P_{\\text{in}}/Z_{\\text{in},0}$. Decompose the root proximal pressure and flow into forward and backward waves: $P_0^+ = \\dfrac{P_{\\text{in}} + Z_{c,0} Q_{\\text{in}}}{2}$ and $P_0^- = \\dfrac{P_{\\text{in}} - Z_{c,0} Q_{\\text{in}}}{2}$. Propagate to the distal end: $P_{\\text{node},0} = P_0^+ e^{-j k_0 L_0} + P_0^- e^{j k_0 L_0}$.\n6. Use $P_{\\text{node},0}$ to determine proximal flows into the left and right daughters: $Q_1(0) = \\dfrac{P_{\\text{node},0}}{Z_{\\text{in},1}}$ and $Q_2(0) = \\dfrac{P_{\\text{node},0}}{Z_{\\text{in},2}}$. For each daughter segment, similarly decompose the proximal state into forward and backward waves and propagate to obtain its distal node pressure $P_{\\text{node},1}$ and $P_{\\text{node},2}$.\n7. At each terminal segment, apply the same decomposition with proximal state $P_{\\text{node}}$ and $Q(0) = \\dfrac{P_{\\text{node}}}{Z_{\\text{in}}}$ to compute distal pressure $P(L)$, and then the terminal load flow $Q_{\\text{term}} = \\dfrac{P(L)}{R_{\\text{term}}}$, which equals the segment distal flow by continuity at the termination.\n8. Compute the local reflection coefficient magnitude $|\\Gamma|$ at each distal site (three junctions and four terminals) using $\\Gamma = \\dfrac{Z_{\\text{load}} - Z_c}{Z_{\\text{load}} + Z_c}$ with $Z_{\\text{load}}$ defined per site; collect all seven magnitudes and determine the maximum value and which site indices satisfy $|\\Gamma| \\ge \\tau$.\n9. Report the magnitudes $|Q_{\\text{in}}|$ and $|Q_{\\text{term}}|$ for terminals $3$ through $6$ in $\\text{m}^3/\\text{s}$, together with $\\max|\\Gamma|$ and the list of sites where $|\\Gamma| \\ge \\tau$. Round all floating-point values to six decimal places and format the output as a single bracketed list with no spaces.\n\nScientific realism and plausibility:\n- The chosen radii, lengths, and material properties are within physiological ranges for medium-sized arteries.\n- The Moens-Korteweg wave speed and characteristic impedance are widely accepted for small-amplitude waves in thin-walled tubes.\n- The frequency range $1$ to $4\\,\\text{Hz}$ corresponds to heart rates and harmonics.\n- Resistive terminal loads represent microcirculatory impedances at the distal end.\n\nThis design ensures the algorithm adheres to first principles (conservation laws, wave decomposition, wall mechanics) and produces quantifiable outputs for a diverse test suite, covering symmetric, near-matched, and asymmetric networks. The final program computes the requested quantities, identifies major reflection sites using the specified threshold, and prints the results in the required single-line format with six-decimal-place rounding.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef parallel_impedance(z1, z2):\n    return 1.0 / (1.0 / z1 + 1.0 / z2)\n\ndef segment_input_impedance(Zc, k, L, Zload):\n    # Reflection coefficient at distal end (local mismatch)\n    Gamma = (Zload - Zc) / (Zload + Zc)\n    Rfactor = Gamma * np.exp(-2j * k * L)\n    Zin = Zc * (1.0 + Rfactor) / (1.0 - Rfactor)\n    return Zin, Gamma\n\ndef propagate_distal_pressure(P_prox, Q_prox, Zc, k, L):\n    # Decompose into forward/backward waves at proximal end\n    Pf = (P_prox + Zc * Q_prox) / 2.0\n    Pb = (P_prox - Zc * Q_prox) / 2.0\n    # Propagate to distal end\n    P_dist = Pf * np.exp(-1j * k * L) + Pb * np.exp(1j * k * L)\n    Q_dist = (Pf * np.exp(-1j * k * L) - Pb * np.exp(1j * k * L)) / Zc\n    return P_dist, Q_dist\n\ndef compute_case(params):\n    rho = params[\"rho\"]\n    E = params[\"E\"]\n    alpha = params[\"alpha\"]\n    f = params[\"f\"]\n    Pin = params[\"Pin\"]\n    R = np.array(params[\"radii\"], dtype=float)  # length 7\n    L = np.array(params[\"lengths\"], dtype=float)  # length 7\n    Rterm = np.array(params[\"Rterm\"], dtype=float)  # length 4\n    tau = params[\"tau\"]\n\n    omega = 2.0 * np.pi * f\n    h = alpha * R\n    A = np.pi * R**2\n    c = np.sqrt(E * h / (2.0 * rho * R))\n    Zc = rho * c / A\n    k = omega / c\n\n    # Indices: 0 root; 1 left daughter; 2 right daughter; 3,4 left terminals; 5,6 right terminals\n    Zin = np.zeros(7, dtype=complex)\n    Gamma_sites = np.zeros(7, dtype=complex)\n\n    # Terminals 3,4,5,6\n    for idx, t in enumerate([3, 4, 5, 6]):\n        Zload = Rterm[idx]\n        Zin[t], Gamma_sites[t] = segment_input_impedance(Zc[t], k[t], L[t], Zload)\n\n    # Second-generation bifurcations for segments 1 and 2\n    # Segment 1 loads: terminals 3 and 4 in parallel\n    Zload_1 = parallel_impedance(Zin[3], Zin[4])\n    Zin[1], Gamma_sites[1] = segment_input_impedance(Zc[1], k[1], L[1], Zload_1)\n\n    # Segment 2 loads: terminals 5 and 6 in parallel\n    Zload_2 = parallel_impedance(Zin[5], Zin[6])\n    Zin[2], Gamma_sites[2] = segment_input_impedance(Zc[2], k[2], L[2], Zload_2)\n\n    # First-generation bifurcation for root segment 0\n    Zload_0 = parallel_impedance(Zin[1], Zin[2])\n    Zin[0], Gamma_sites[0] = segment_input_impedance(Zc[0], k[0], L[0], Zload_0)\n\n    # Inlet flow\n    Qin = Pin / Zin[0]\n\n    # Root distal node pressure\n    Pnode0, Qdist0 = propagate_distal_pressure(Pin, Qin, Zc[0], k[0], L[0])\n\n    # Flows into daughters at proximal ends\n    Q1_prox = Pnode0 / Zin[1]\n    Q2_prox = Pnode0 / Zin[2]\n\n    # Left daughter distal node pressure\n    Pnode1, Qdist1 = propagate_distal_pressure(Pnode0, Q1_prox, Zc[1], k[1], L[1])\n    # Right daughter distal node pressure\n    Pnode2, Qdist2 = propagate_distal_pressure(Pnode0, Q2_prox, Zc[2], k[2], L[2])\n\n    # Left terminals proximal flows\n    Q3_prox = Pnode1 / Zin[3]\n    Q4_prox = Pnode1 / Zin[4]\n    # Right terminals proximal flows\n    Q5_prox = Pnode2 / Zin[5]\n    Q6_prox = Pnode2 / Zin[6]\n\n    # Propagate through terminal segments to distal load pressures\n    P3_dist, Q3_dist = propagate_distal_pressure(Pnode1, Q3_prox, Zc[3], k[3], L[3])\n    P4_dist, Q4_dist = propagate_distal_pressure(Pnode1, Q4_prox, Zc[4], k[4], L[4])\n    P5_dist, Q5_dist = propagate_distal_pressure(Pnode2, Q5_prox, Zc[5], k[5], L[5])\n    P6_dist, Q6_dist = propagate_distal_pressure(Pnode2, Q6_prox, Zc[6], k[6], L[6])\n\n    # Terminal load flows (should equal segment distal flows)\n    Q3_term = P3_dist / Rterm[0]\n    Q4_term = P4_dist / Rterm[1]\n    Q5_term = P5_dist / Rterm[2]\n    Q6_term = P6_dist / Rterm[3]\n\n    # Magnitudes\n    Qin_mag = float(np.abs(Qin))\n    Q3_mag = float(np.abs(Q3_term))\n    Q4_mag = float(np.abs(Q4_term))\n    Q5_mag = float(np.abs(Q5_term))\n    Q6_mag = float(np.abs(Q6_term))\n\n    # Reflection magnitudes at sites 0..6\n    Gamma_mags = [float(np.abs(Gamma_sites[i])) for i in range(7)]\n    max_reflection = max(Gamma_mags)\n    major_sites = [i for i, g in enumerate(Gamma_mags) if g >= tau]\n\n    return [Qin_mag, Q3_mag, Q4_mag, Q5_mag, Q6_mag, max_reflection, major_sites]\n\ndef format_number(x):\n    # Ensure six decimal places\n    return f\"{x:.6f}\"\n\ndef format_nested(obj):\n    # Format nested list with no spaces, floats to six decimals\n    if isinstance(obj, list):\n        return \"[\" + \",\".join(format_nested(x) for x in obj) + \"]\"\n    elif isinstance(obj, (float, np.floating)):\n        return format_number(float(obj))\n    elif isinstance(obj, (int, np.integer)):\n        return str(int(obj))\n    else:\n        # Should not occur; fallback to float formatting if possible\n        try:\n            return format_number(float(obj))\n        except Exception:\n            return str(obj)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"rho\": 1060.0,\n            \"E\": 6.0e5,\n            \"alpha\": 0.10,\n            \"f\": 2.0,\n            \"Pin\": 5000.0,\n            \"radii\": [0.005, 0.004, 0.004, 0.003, 0.003, 0.003, 0.003],\n            \"lengths\": [0.20, 0.15, 0.15, 0.10, 0.10, 0.10, 0.10],\n            \"Rterm\": [1.0e8, 1.0e8, 1.0e8, 1.0e8],\n            \"tau\": 0.25,\n        },\n        {\n            \"rho\": 1060.0,\n            \"E\": 5.0e5,\n            \"alpha\": 0.09,\n            \"f\": 1.0,\n            \"Pin\": 4000.0,\n            \"radii\": [0.006, 0.0045, 0.0045, 0.0035, 0.0035, 0.0035, 0.0035],\n            \"lengths\": [0.25, 0.18, 0.18, 0.12, 0.12, 0.12, 0.12],\n            \"Rterm\": [7.0e7, 7.0e7, 7.0e7, 7.0e7],\n            \"tau\": 0.25,\n        },\n        {\n            \"rho\": 1060.0,\n            \"E\": 6.5e5,\n            \"alpha\": 0.12,\n            \"f\": 4.0,\n            \"Pin\": 6000.0,\n            \"radii\": [0.005, 0.003, 0.005, 0.002, 0.0025, 0.005, 0.005],\n            \"lengths\": [0.18, 0.16, 0.16, 0.10, 0.10, 0.12, 0.12],\n            \"Rterm\": [8.0e7, 9.0e7, 6.0e7, 6.0e7],\n            \"tau\": 0.25,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        res = compute_case(case)\n        # Round float entries to six decimals for output consistency\n        rounded = []\n        for item in res:\n            if isinstance(item, list):\n                # list of integers (major sites)\n                rounded.append(item)\n            else:\n                rounded.append(float(f\"{item:.6f}\"))\n        results.append(rounded)\n\n    # Final print statement in the exact required format: no spaces.\n    print(format_nested(results))\n\nsolve()\n```"
        },
        {
            "introduction": "While linearized models are insightful, they cannot capture all phenomena, such as wave steepening that occurs as a pulse propagates. This advanced practice introduces the method of characteristics, a powerful technique to solve the full nonlinear equations of blood flow in the time domain . You will derive the Riemann invariants, which are quantities that remain constant along characteristic curves, and implement a numerical scheme to see these principles in action, providing a deeper insight into the mathematical structure of hyperbolic systems and the numerical stability constraints (CFL condition) that govern them.",
            "id": "3922798",
            "problem": "Consider the frictionless one-dimensional blood flow equations in a uniform elastic vessel segment, formulated in terms of the vessel cross-sectional area $A(x,t)$ and volumetric flow rate $Q(x,t)$. Let the cross-sectional average axial velocity be $u(x,t) = Q(x,t)/A(x,t)$. The governing equations (mass conservation and momentum balance) are\n$$\n\\frac{\\partial A}{\\partial t} + \\frac{\\partial Q}{\\partial x} = 0,\n\\qquad\n\\frac{\\partial Q}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\frac{Q^2}{A}\\right) + \\frac{A}{\\rho}\\frac{\\partial p(A)}{\\partial x} = 0,\n$$\nwhere $\\rho$ is the blood density and $p(A)$ is the internal pressure determined by the vessel wall mechanics. Assume a standard pressure–area (tube) law\n$$\np(A) = p_{\\text{ext}} + \\frac{\\beta}{A_0}\\left(\\sqrt{A} - \\sqrt{A_0}\\right),\n$$\nwhere $p_{\\text{ext}}$ is the external pressure (constant), $A_0$ is the reference area at zero transmural pressure, and $\\beta$ is the wall stiffness parameter. Under this law and frictionless conditions, the hyperbolic system admits characteristic speeds $u \\pm c(A)$, where the local wave speed $c(A)$ satisfies\n$$\nc^2(A) = \\frac{A}{\\rho}\\frac{dp}{dA} = \\frac{\\beta}{2\\rho A_0}\\sqrt{A}.\n$$\nThe associated Riemann invariants for this system take the general form $w_{\\pm} = u \\pm \\int \\frac{c(A)}{A}\\, dA$. For the given tube law, this integral simplifies to $w_{\\pm} = u \\pm 4 c(A)$.\n\nTask 1 (derivation): Starting from the fundamental laws above, derive the characteristic form and the specific Riemann invariants $w_{\\pm} = u \\pm 4 c(A)$ for the stated pressure–area law. Then, derive the Courant–Friedrichs–Lewy (CFL) condition for stability of an explicit method-of-characteristics update over one time step $\\Delta t$ on a uniform grid of spacing $\\Delta x$, showing that the stability constraint is\n$$\n\\max_x\\left(|u(x,t)| + c(A(x,t))\\right)\\,\\frac{\\Delta t}{\\Delta x} \\le 1.\n$$\n\nTask 2 (implementation): Implement a single-step explicit method-of-characteristics update for $(A,Q)$ over one time step $\\Delta t$ on a uniform spatial grid, using the invariants $w_{\\pm}$ treated as constant along their respective characteristic curves with local speeds $u \\pm c$. For each grid point $x_i$ at time $t$, trace back along the right- and left-going characteristics to the foot positions $x_i - (u_i + c_i)\\Delta t$ and $x_i - (u_i - c_i)\\Delta t$, linearly interpolate the initial $w_{+}$ and $w_{-}$ to these foot positions, reconstruct $u$ and $c$ via\n$$\nu^{n+1}_i = \\frac{w_{+,i}^{\\text{foot}} + w_{-,i}^{\\text{foot}}}{2}, \\qquad\nc^{n+1}_i = \\frac{w_{+,i}^{\\text{foot}} - w_{-,i}^{\\text{foot}}}{8},\n$$\nthen recover $A^{n+1}_i$ from $c^{n+1}_i$ using $c(A) = \\alpha A^{1/4}$ with $\\alpha = \\sqrt{\\beta/(2\\rho A_0)}$, and finally compute $Q^{n+1}_i = A^{n+1}_i u^{n+1}_i$.\n\nPhysical parameters and initial condition:\n- Blood density $\\rho = 1060$ kg/m$^3$.\n- Reference radius $r_0 = 1.0\\times 10^{-3}$ m, so $A_0 = \\pi r_0^2$ m$^2$.\n- Choose $\\beta$ so that the nominal wave speed at $A=A_0$ is $c_0 = 5.0$ m/s, i.e.,\n$$\n\\beta = \\frac{2 \\rho A_0 c_0^2}{\\sqrt{A_0}}.\n$$\n- Segment length $L = 0.2$ m, uniform grid with $N = 201$ points (so $\\Delta x = L/(N-1)$).\n- External pressure $p_{\\text{ext}} = 0$ Pa (gauge).\n- Initial area perturbation around $A_0$:\n$$\nA(x,0) = A_0\\left(1 + \\varepsilon \\exp\\left(-\\frac{(x - L/2)^2}{2\\sigma^2}\\right)\\right),\n$$\nwith $\\varepsilon = 0.05$ (dimensionless) and $\\sigma = 0.02$ m.\n- Initial velocity $u(x,0) = 0$ m/s and thus $Q(x,0) = A(x,0)\\,u(x,0) = 0$ m$^3$/s.\n\nTest suite and outputs:\n- Let $\\lambda_{\\max} = \\max_x \\left(|u(x,0)| + c(A(x,0))\\right)$ at $t=0$.\n- Define three time steps to probe stability:\n  1. $\\Delta t_1 = 0.8\\,\\Delta x/\\lambda_{\\max}$ (stable case).\n  2. $\\Delta t_2 = 1.0\\,\\Delta x/\\lambda_{\\max}$ (boundary case).\n  3. $\\Delta t_3 = 1.2\\,\\Delta x/\\lambda_{\\max}$ (nominally unstable).\n- For each $\\Delta t_k$, perform one method-of-characteristics update from $t=0$ to $t=\\Delta t_k$ and compute:\n  - The CFL margin $m_k = 1 - \\lambda_{\\max}\\Delta t_k/\\Delta x$ (dimensionless).\n  - The maximum absolute area change $\\max_i |A^{n+1}_i - A^{n}_i|$ in m$^2$.\n  - The maximum absolute flow change $\\max_i |Q^{n+1}_i - Q^{n}_i|$ in m$^3$/s.\n\nAngle units are not involved. All physical quantities must be computed and reported in International System of Units (SI): meters (m), seconds (s), kilograms (kg), pascals (Pa). Your program should produce a single line of output containing the $9$ numerical results aggregated in the order\n$$\n[m_1,\\ \\Delta A_{\\max,1},\\ \\Delta Q_{\\max,1},\\ m_2,\\ \\Delta A_{\\max,2},\\ \\Delta Q_{\\max,2},\\ m_3,\\ \\Delta A_{\\max,3},\\ \\Delta Q_{\\max,3}],\n$$\nprinted as a comma-separated list enclosed in square brackets with no additional text.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of fluid dynamics and continuum mechanics, mathematically self-consistent, and provides all necessary information to perform the requested derivations and computations.\n\n### Part 1: Derivation\n\nWe are tasked with three derivations: the characteristic form of the governing equations, the specific Riemann invariants for the given pressure-area law, and the Courant-Friedrichs-Lewy (CFL) stability condition.\n\n**Derivation of the Characteristic Form**\n\nThe governing equations for one-dimensional blood flow are given in terms of cross-sectional area $A(x,t)$ and volumetric flow rate $Q(x,t)$:\n$$\n\\frac{\\partial A}{\\partial t} + \\frac{\\partial Q}{\\partial x} = 0\n$$\n$$\n\\frac{\\partial Q}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\frac{Q^2}{A}\\right) + \\frac{A}{\\rho}\\frac{\\partial p(A)}{\\partial x} = 0\n$$\nWe switch to primitive variables $(A, u)$, where $u = Q/A$ is the average velocity. Using the product rule, $\\frac{\\partial Q}{\\partial x} = \\frac{\\partial(uA)}{\\partial x} = u\\frac{\\partial A}{\\partial x} + A\\frac{\\partial u}{\\partial x}$. The mass conservation equation becomes:\n$$\n\\frac{\\partial A}{\\partial t} + u\\frac{\\partial A}{\\partial x} + A\\frac{\\partial u}{\\partial x} = 0 \\quad (1)\n$$\nFor the momentum equation, we first use the definition of wave speed $c(A)$, where $c^2(A) = \\frac{A}{\\rho}\\frac{dp}{dA}$. Using the chain rule, the pressure term becomes $\\frac{A}{\\rho}\\frac{\\partial p}{\\partial x} = \\frac{A}{\\rho}\\frac{dp}{dA}\\frac{\\partial A}{\\partial x} = c^2\\frac{\\partial A}{\\partial x}$. The momentum equation can be rewritten using $Q=uA$ and $Q^2/A = u^2A$:\n$$\n\\frac{\\partial(uA)}{\\partial t} + \\frac{\\partial(u^2A)}{\\partial x} + c^2\\frac{\\partial A}{\\partial x} = 0\n$$\nExpanding the derivatives using the product rule:\n$$\nA\\frac{\\partial u}{\\partial t} + u\\frac{\\partial A}{\\partial t} + u^2\\frac{\\partial A}{\\partial x} + 2uA\\frac{\\partial u}{\\partial x} + c^2\\frac{\\partial A}{\\partial x} = 0\n$$\nWe can substitute $\\frac{\\partial A}{\\partial t}$ from equation (1):\n$$\nA\\frac{\\partial u}{\\partial t} + u\\left(-u\\frac{\\partial A}{\\partial x} - A\\frac{\\partial u}{\\partial x}\\right) + u^2\\frac{\\partial A}{\\partial x} + 2uA\\frac{\\partial u}{\\partial x} + c^2\\frac{\\partial A}{\\partial x} = 0\n$$\nSimplifying the terms:\n$$\nA\\frac{\\partial u}{\\partial t} - u^2\\frac{\\partial A}{\\partial x} - uA\\frac{\\partial u}{\\partial x} + u^2\\frac{\\partial A}{\\partial x} + 2uA\\frac{\\partial u}{\\partial x} + c^2\\frac{\\partial A}{\\partial x} = 0\n$$\n$$\nA\\frac{\\partial u}{\\partial t} + uA\\frac{\\partial u}{\\partial x} + c^2\\frac{\\partial A}{\\partial x} = 0\n$$\nDividing by $A$ (since $A0$):\n$$\n\\frac{\\partial u}{\\partial t} + u\\frac{\\partial u}{\\partial x} + \\frac{c^2}{A}\\frac{\\partial A}{\\partial x} = 0 \\quad (2)\n$$\nEquations (1) and (2) form a quasi-linear system. We can write this system in matrix form $\\mathbf{v}_t + \\mathbf{M} \\mathbf{v}_x = \\mathbf{0}$ with $\\mathbf{v} = [A, u]^T$:\n$$\n\\frac{\\partial}{\\partial t}\\begin{pmatrix} A \\\\ u \\end{pmatrix} + \\begin{pmatrix} u  A \\\\ c^2/A  u \\end{pmatrix} \\frac{\\partial}{\\partial x}\\begin{pmatrix} A \\\\ u \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\nThe eigenvalues $\\lambda$ of the matrix $\\mathbf{M}$ are the characteristic speeds. They are found by solving $\\det(\\mathbf{M} - \\lambda\\mathbf{I}) = 0$:\n$$\n\\det\\begin{pmatrix} u-\\lambda  A \\\\ c^2/A  u-\\lambda \\end{pmatrix} = (u-\\lambda)^2 - A\\frac{c^2}{A} = (u-\\lambda)^2 - c^2 = 0\n$$\nThis gives $u - \\lambda = \\pm c$, so the characteristic speeds are $\\lambda_{\\pm} = u \\pm c(A)$.\n\n**Derivation of the Riemann Invariants**\n\nTo find the Riemann invariants, we find the left eigenvectors $\\mathbf{l}_{\\pm}$ of $\\mathbf{M}$ corresponding to $\\lambda_{\\pm}$. An eigenvector $\\mathbf{l} = [l_1, l_2]$ satisfies $\\mathbf{l}^T\\mathbf{M} = \\lambda\\mathbf{l}^T$.\n$$\n\\begin{pmatrix} l_1  l_2 \\end{pmatrix} \\begin{pmatrix} u  A \\\\ c^2/A  u \\end{pmatrix} = \\lambda \\begin{pmatrix} l_1  l_2 \\end{pmatrix}\n$$\nThis yields two equations:\n$l_1 u + l_2 c^2/A = \\lambda l_1$ and $l_1 A + l_2 u = \\lambda l_2$. From the first, $l_2 c^2/A = (\\lambda-u)l_1$. For $\\lambda_{\\pm} = u \\pm c$, this becomes $l_2 c^2/A = \\pm c l_1$, which simplifies to $l_2 = \\pm\\frac{A}{c}l_1$.\nWe can choose $l_1 = \\pm c/A$, yielding $l_2 = 1$. The left eigenvectors are $\\mathbf{l}_{\\pm} = [\\pm c/A, 1]$.\nMultiplying the matrix equation $\\mathbf{v}_t + \\mathbf{M} \\mathbf{v}_x = \\mathbf{0}$ from the left by $\\mathbf{l}_{\\pm}^T$ gives:\n$$\n\\mathbf{l}_{\\pm}^T (\\mathbf{v}_t + \\lambda_{\\pm} \\mathbf{v}_x) = \\mathbf{0} \\implies \\pm\\frac{c}{A}\\left(\\frac{\\partial A}{\\partial t} + \\lambda_{\\pm}\\frac{\\partial A}{\\partial x}\\right) + 1 \\cdot \\left(\\frac{\\partial u}{\\partial t} + \\lambda_{\\pm}\\frac{\\partial u}{\\partial x}\\right) = 0\n$$\nThe expressions in parentheses are the total derivatives along the characteristics $dx/dt = \\lambda_{\\pm}$. So, along these paths:\n$$\n\\frac{du}{dt_{\\pm}} \\pm \\frac{c(A)}{A}\\frac{dA}{dt_{\\pm}} = 0 \\quad \\text{along } \\quad \\frac{dx}{dt} = u \\pm c\n$$\nThis can be written as $du \\pm \\frac{c(A)}{A}dA=0$. The Riemann invariants $w_{\\pm}$ are quantities that are constant along these characteristics. They are found by integrating this expression:\n$$\nw_{\\pm} = u \\pm \\int \\frac{c(A)}{A} dA\n$$\nFor the given tube law, $p(A) = p_{\\text{ext}} + \\frac{\\beta}{A_0}(\\sqrt{A} - \\sqrt{A_0})$, we have $\\frac{dp}{dA} = \\frac{\\beta}{2A_0\\sqrt{A}}$.\nThe wave speed squared is $c^2(A) = \\frac{A}{\\rho}\\frac{dp}{dA} = \\frac{\\beta\\sqrt{A}}{2\\rho A_0}$. Thus, $c(A) = \\sqrt{\\frac{\\beta}{2\\rho A_0}} A^{1/4}$. Let's define the constant $\\alpha = \\sqrt{\\frac{\\beta}{2\\rho A_0}}$, so $c(A) = \\alpha A^{1/4}$.\nThe integral for the Riemann invariants becomes:\n$$\n\\int \\frac{c(A)}{A} dA = \\int \\frac{\\alpha A^{1/4}}{A} dA = \\alpha \\int A^{-3/4} dA = \\alpha \\frac{A^{1/4}}{1/4} + \\text{const} = 4\\alpha A^{1/4} + \\text{const} = 4c(A) + \\text{const}\n$$\nIgnoring the constant of integration, the Riemann invariants are:\n$$\nw_{\\pm} = u \\pm 4c(A)\n$$\n\n**Derivation of the CFL Condition**\n\nThe Courant-Friedrichs-Lewy (CFL) condition is a necessary condition for the stability of explicit numerical methods for solving hyperbolic partial differential equations. It states that the numerical domain of dependence of a grid point must contain the physical (or analytical) domain of dependence.\n\nFor the system at hand, information propagates along characteristic curves with speeds $\\lambda_{\\pm} = u \\pm c$. Consider a point $(x_i, t_{n+1})$ on a discrete grid with spacing $\\Delta x$ and $\\Delta t$. The solution at this point depends on the initial data at time $t_n$ within the interval defined by the \"feet\" of the characteristics passing through $(x_i, t_{n+1})$. These feet are located at $x_{i, \\text{foot}}^{\\pm} = x_i - \\lambda_{\\pm}\\Delta t = x_i - (u \\pm c)\\Delta t$. The physical domain of dependence at time $t_n$ for the point $(x_i, t_{n+1})$ is the interval on the real line bounded by these two feet.\n\nAn explicit numerical method, such as the one described, calculates the solution at $(x_i, t_{n+1})$ using data from a finite set of neighboring grid points at time $t_n$, for instance, $\\{x_{i-1}, x_i, x_{i+1}\\}$. The numerical domain of dependence is the interval covered by these points, which is $[x_i - \\Delta x, x_i + \\Delta x]$.\n\nFor stability, the physical domain of dependence must be a subset of the numerical domain of dependence. This means that the fastest-moving characteristic must not travel further than one grid cell spacing $\\Delta x$ in one time step $\\Delta t$. The maximum speed of propagation at any point $x$ is given by $\\max(|\\lambda_+|, |\\lambda_-|) = \\max(|u+c|, |u-c|)$. Since the wave speed $c$ is non-negative, this maximum is $|u|+c$.\n\nTherefore, the distance traveled by the fastest signal in the whole domain during $\\Delta t$ must be less than or equal to $\\Delta x$:\n$$\n\\left( \\max_x(|u(x,t)| + c(A(x,t))) \\right) \\Delta t \\le \\Delta x\n$$\nRearranging this gives the dimensionless CFL condition:\n$$\n\\frac{\\Delta t}{\\Delta x} \\max_x\\left(|u(x,t)| + c(A(x,t))\\right) \\le 1\n$$\nThe expression $\\mathcal{C} = \\lambda_{\\max} \\frac{\\Delta t}{\\Delta x}$, where $\\lambda_{\\max} = \\max_x(|u|+c)$, is the Courant number. The stability requires $\\mathcal{C} \\le 1$.\n\n### Part 2: Numerical Implementation\n\nThe provided task is to implement a single-step method-of-characteristics update. The plan is as follows:\n1.  Define physical and numerical parameters: $\\rho, r_0, c_0, L, N, \\varepsilon, \\sigma$.\n2.  Calculate derived constants: $A_0 = \\pi r_0^2$, $\\beta = \\frac{2 \\rho A_0 c_0^2}{\\sqrt{A_0}}$, $\\alpha = \\sqrt{\\frac{\\beta}{2\\rho A_0}}$, and $\\Delta x = L/(N-1)$.\n3.  Set up the initial condition at $t=0$ ($n=0$) on a uniform grid $x_i$: compute $A^n(x_i)$ and $u^n(x_i)=0$.\n4.  From the initial state, compute the fields for wave speed $c^n(x_i)$ and Riemann invariants $w_{\\pm}^n(x_i)$.\n5.  Determine the maximum characteristic speed $\\lambda_{\\max} = \\max_i(|u_i^n| + c_i^n)$.\n6.  For each of the three prescribed time steps $\\Delta t_k$ (for $k=1,2,3$):\n    a. Iterate over each grid point $x_i$ to compute the state at $t=\\Delta t_k$.\n    b. At each $x_i$, determine the foot positions of the characteristics: $x_{\\text{foot},\\pm} = x_i - (u_i^n \\pm c_i^n)\\Delta t_k$.\n    c. Linearly interpolate the initial invariant fields $w_{\\pm}^n$ to these foot positions to get $w_{\\pm,i}^{\\text{foot}}$.\n    d. Reconstruct the new velocity $u_i^{n+1}$ and wave speed $c_i^{n+1}$ from the interpolated invariants using the provided formulas: $u^{n+1}_i = (w_{+,i}^{\\text{foot}} + w_{-,i}^{\\text{foot}})/2$ and $c^{n+1}_i = (w_{+,i}^{\\text{foot}} - w_{-,i}^{\\text{foot}})/8$.\n    e. Recover the new area $A_i^{n+1}$ from the new wave speed using the relation $A=(c/\\alpha)^4$.\n    f. Calculate the new flow rate $Q_i^{n+1} = A_i^{n+1} u_i^{n+1}$.\n    g. After computing the full fields at the new time step, calculate the requested analysis quantities: the CFL margin $m_k = 1 - \\lambda_{\\max}\\Delta t_k/\\Delta x$, the maximum absolute area change $\\max_i |A_i^{n+1} - A_i^n|$, and the maximum absolute flow change $\\max_i |Q_i^{n+1} - Q_i^n|$.\n7.  Aggregate the nine results and print them in the specified format. The boundary values for interpolation will be handled using constant extrapolation, a default behavior in NumPy's interpolation function.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries outside the Python standard library are permitted.\n\ndef solve():\n    \"\"\"\n    Solves the pulse wave propagation problem using a single-step\n    method of characteristics.\n    \"\"\"\n    # Physical parameters and initial condition setup\n    rho = 1060.0  # kg/m^3\n    r0 = 1.0e-3  # m\n    c0 = 5.0  # m/s\n    L = 0.2  # m\n    N = 201  # number of grid points\n    epsilon = 0.05  # dimensionless amplitude\n    sigma = 0.02  # m\n\n    # Derived constants and grid\n    A0 = np.pi * r0**2\n    beta = (2 * rho * A0 * c0**2) / np.sqrt(A0)\n    alpha = np.sqrt(beta / (2 * rho * A0))\n    x = np.linspace(0, L, N)\n    dx = L / (N - 1)\n\n    # Initial conditions at t=0 (n=0)\n    A_n = A0 * (1 + epsilon * np.exp(-((x - L / 2)**2) / (2 * sigma**2)))\n    u_n = np.zeros(N)\n    Q_n = A_n * u_n\n\n    # Initial state variables for the method\n    c_n = alpha * A_n**(1/4)\n    w_plus_n = u_n + 4 * c_n\n    w_minus_n = u_n - 4 * c_n\n\n    # Maximum characteristic speed for CFL condition\n    lambda_max = np.max(np.abs(u_n) + c_n)\n\n    # Test suite: define CFL numbers and corresponding time steps\n    cfl_numbers = [0.8, 1.0, 1.2]\n    time_steps = [cfl * dx / lambda_max for cfl in cfl_numbers]\n    \n    results = []\n\n    for dt in time_steps:\n        # Initialize arrays for the new state at t = dt (n+1)\n        A_np1 = np.empty_like(A_n)\n        u_np1 = np.empty_like(u_n)\n        Q_np1 = np.empty_like(Q_n)\n\n        # Main loop over grid points\n        for i in range(N):\n            # 1. Trace back characteristics to find foot positions\n            x_foot_plus = x[i] - (u_n[i] + c_n[i]) * dt\n            x_foot_minus = x[i] - (u_n[i] - c_n[i]) * dt\n\n            # 2. Linearly interpolate invariants to the foot positions\n            # np.interp handles boundaries by constant extrapolation by default\n            w_plus_foot = np.interp(x_foot_plus, x, w_plus_n)\n            w_minus_foot = np.interp(x_foot_minus, x, w_minus_n)\n\n            # 3. Reconstruct u and c at the new time step\n            u_np1[i] = (w_plus_foot + w_minus_foot) / 2\n            c_np1_i = (w_plus_foot - w_minus_foot) / 8\n\n            # 4. Recover A and Q from the new u and c\n            # Handle potential for c to be negative from numerical error\n            # Although physically c  0, the reconstruction formula doesn't guarantee it.\n            if c_np1_i  0:\n                c_np1_i = 0  # A becomes 0, physically reasonable cap\n            \n            A_np1[i] = (c_np1_i / alpha)**4\n            Q_np1[i] = A_np1[i] * u_np1[i]\n\n        # Calculate analysis metrics for this time step\n        m_k = 1 - lambda_max * dt / dx\n        delta_A_max = np.max(np.abs(A_np1 - A_n))\n        delta_Q_max = np.max(np.abs(Q_np1 - Q_n))\n\n        results.extend([m_k, delta_A_max, delta_Q_max])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{val:.8e}' for val in results)}]\")\n\nsolve()\n```"
        }
    ]
}