{
    "hands_on_practices": [
        {
            "introduction": "脉搏波传播速度（PWV）是评估动脉僵硬度的关键指标。这个练习将引导你从流体动力学和线性弹性力学的基本原理出发，推导出著名的莫恩斯-科特韦格（Moens-Korteweg）方程。通过这个推导和随后的计算，你将亲身体会动脉的物理特性（如杨氏模量 $E$）如何直接决定脉搏波的传播速度，这为你理解心血管健康状况的生物力学基础奠定了基石 。",
            "id": "3922840",
            "problem": "一个理想化的直动脉段，参考半径为 $R$，壁厚为 $h$，其中流淌着质量密度为 $\\rho$ 的血液。假设血液不可压缩，并且在确定波速时可以忽略粘性损失。动脉壁是薄的、各向同性的、线弹性体，其增量杨氏模量为 $E$，脉搏波由围绕参考状态的微小轴对称扰动组成。在这些假设下，从可变形管中流动的一维质量守恒和线性动量守恒出发，结合线弹性理论和薄壁圆柱体的周向力平衡，推导小振幅压力波的局部速度 $c$（用 $E$、$h$、$R$ 和 $\\rho$ 表示）。然后，使用 $E=0.6\\,\\text{MPa}$、$h=1.2\\,\\text{mm}$、$R=4\\,\\text{mm}$ 和 $\\rho=1050\\,\\text{kg/m}^3$，评估基线脉搏波速度（PWV），并确定由于老化导致 $E$ 增加 $20\\%$ 后的新 PWV。解释您推导中隐含的 $c$ 与 $E$ 的标度关系。以米/秒为单位，将最终数值答案表示为新的 PWV，并四舍五入到四位有效数字。",
            "solution": "在尝试求解之前，将对问题进行验证。\n\n### 第1步：提取已知条件\n-   动脉段是理想化的直管。\n-   参考半径: $R$\n-   壁厚: $h$\n-   血液质量密度: $\\rho$\n-   血液不可压缩。\n-   粘性损失可以忽略。\n-   动脉壁是薄的、各向同性的、线弹性的。\n-   管壁的增量杨氏模量: $E$\n-   脉搏波由围绕参考状态的微小轴对称扰动组成。\n-   推导必须从可变形管中流动的一维质量守恒和线性动量守恒出发，结合线弹性理论和薄壁圆柱体的周向力平衡。\n-   目标是推导小振幅压力波的局部速度 $c$。\n-   用于评估的数值：\n    -   $E = 0.6\\,\\text{MPa}$\n    -   $h = 1.2\\,\\text{mm}$\n    -   $R = 4\\,\\text{mm}$\n    -   $\\rho = 1050\\,\\text{kg/m}^3$\n-   第二个任务是计算 $E$ 增加 $20\\%$ 后的新脉搏波速度（PWV）。\n-   最终数值答案必须是以米/秒为单位的新 PWV，并四舍五入到四位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n这个问题是生物力学和流体动力学中的一个标准教科书练习，具体涉及动脉中脉搏波传播的建模。\n-   **科学基础（关键）**：该问题基于流体力学的基本原理（质量和动量守恒）和固体力学的基本原理（线弹性、薄壁圆柱理论）。这些假设（无粘性、不可压缩流、小扰动、线弹性）是推导 Moens-Korteweg 方程的标准简化，该方程是该领域的基石。\n-   **适定性**：该问题提供了所有必要的参数和明确的目标，从而可以得到波速 $c$ 的唯一解。所提供的数值对于大动脉来说是物理上现实的。\n-   **客观性（关键）**：语言精确、专业，没有主观性或歧义。\n\n该问题不违反任何无效性标准。这是一个定义明确、科学合理的问题。\n\n### 第3步：结论与行动\n该问题是**有效**的。将提供完整的解答。\n\n### 脉搏波速度（PWV）的推导\n\n推导基于可变形管中的一维质量守恒和动量守恒方程，并结合描述管弹性特性的方程（“管定律”）。\n\n设 $A(x, t)$ 为动脉的横截面积，$u(x, t)$ 为轴向流体速度，$P(x, t)$ 为压力，它们都是轴向位置 $x$ 和时间 $t$ 的函数。流体密度 $\\rho$ 是恒定的。\n\n1.  **质量守恒（连续性方程）**\n    对于面积变化的管中的无粘性、不可压缩流体，一维连续性方程为：\n    $$ \\frac{\\partial A}{\\partial t} + \\frac{\\partial (Au)}{\\partial x} = 0 $$\n    展开第二项：\n    $$ \\frac{\\partial A}{\\partial t} + A \\frac{\\partial u}{\\partial x} + u \\frac{\\partial A}{\\partial x} = 0 $$\n\n2.  **动量守恒（欧拉方程）**\n    对于无粘性流体，一维动量方程为：\n    $$ \\rho \\left( \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} \\right) = - \\frac{\\partial P}{\\partial x} $$\n\n3.  **小扰动线性化**\n    问题指定了围绕零流量（$u_0 = 0$）以及恒定参考半径 $R$ 和面积 $A_0 = \\pi R^2$ 的参考状态的微小扰动。我们将扰动定义为：\n    $A(x, t) = A_0 + a'(x, t)$\n    $u(x, t) = u'(x, t)$\n    $P(x, t) = P_0 + p'(x, t)$\n    将这些代入控制方程，并舍去小扰动的二阶项（例如 $u' \\frac{\\partial a'}{\\partial x}$、$(u')^2$），得到线性化方程：\n\n    线性化连续性方程：\n    $$ \\frac{\\partial a'}{\\partial t} + A_0 \\frac{\\partial u'}{\\partial x} = 0 $$\n\n    线性化动量方程：\n    $$ \\rho \\frac{\\partial u'}{\\partial t} = - \\frac{\\partial p'}{\\partial x} $$\n\n4.  **管定律（弹性特性）**\n    我们需要压力变化 $p'$ 和面积变化 $a'$ 之间的关系。我们将动脉建模为薄壁弹性圆柱体。环向应力 $\\sigma_\\theta$ 由周向力平衡给出：\n    $$ \\sigma_\\theta = \\frac{P r}{h} $$\n    其中 $P$ 是跨壁压，$r$ 是瞬时半径。相对于参考半径 $R$ 的周向应变 $\\epsilon_\\theta$ 是：\n    $$ \\epsilon_\\theta = \\frac{r - R}{R} $$\n    管壁是线弹性的，因此应力通过杨氏模量 $E$ 与应变成正比：\n    $$ \\sigma_\\theta = E \\epsilon_\\theta $$\n    结合这些得到：\n    $$ \\frac{P r}{h} = E \\frac{r - R}{R} $$\n    为了线性化此关系，我们考虑微小变化 $r = R + r'$ 和 $P = P_0 + p'$，其中 $p'$ 引起 $r'$。\n    $$ \\frac{(P_0 + p')(R + r')}{h} = E \\frac{r'}{R} $$\n    假设压力引起的应力远大于预应力效应（一个标准的简化，相当于 $P_0 \\ll Eh/R$），并舍去二阶项 ($p'r'$)，我们得到：\n    $$ \\frac{p' R}{h} \\approx E \\frac{r'}{R} \\implies p' \\approx \\frac{Eh}{R^2} r' $$\n    现在，我们将半径变化 $r'$ 与面积变化 $a'$ 联系起来。\n    $A = \\pi r^2 \\implies dA = 2 \\pi r dr$。对于小扰动，$a' \\approx 2 \\pi R r'$。因此，$r' \\approx \\frac{a'}{2 \\pi R}$。\n    将 $r'$ 代入压力关系式：\n    $$ p' \\approx \\frac{Eh}{R^2} \\left( \\frac{a'}{2 \\pi R} \\right) = \\frac{Eh}{2 \\pi R^3} a' $$\n    这提供了关联压力和面积扰动的线性管定律，可以用导数的形式表示为：\n    $$ \\frac{dp'}{da'} = \\frac{Eh}{2 \\pi R^3} \\quad \\text{or} \\quad \\frac{da'}{dp'} = \\frac{2 \\pi R^3}{Eh} $$\n\n5.  **波动方程的推导**\n    我们现在有三个方程组成的系统：\n    (i) $\\frac{\\partial a'}{\\partial t} = -A_0 \\frac{\\partial u'}{\\partial x}$\n    (ii) $\\frac{\\partial p'}{\\partial x} = -\\rho \\frac{\\partial u'}{\\partial t}$\n    (iii) $a' = \\left(\\frac{2 \\pi R^3}{Eh}\\right) p'$\n\n    从(iii)式，我们可以写出 $\\frac{\\partial a'}{\\partial t} = \\frac{2 \\pi R^3}{Eh} \\frac{\\partial p'}{\\partial t}$。将此式与 $A_0 = \\pi R^2$ 一起代入(i)式：\n    $$ \\frac{2 \\pi R^3}{Eh} \\frac{\\partial p'}{\\partial t} = -(\\pi R^2) \\frac{\\partial u'}{\\partial x} \\implies \\frac{2 R}{Eh} \\frac{\\partial p'}{\\partial t} = - \\frac{\\partial u'}{\\partial x} $$\n    现在，将此方程对 $t$ 求导，并将线性化动量方程(ii)对 $x$ 求导：\n    $$ \\frac{2 R}{Eh} \\frac{\\partial^2 p'}{\\partial t^2} = - \\frac{\\partial^2 u'}{\\partial x \\partial t} $$\n    $$ \\frac{\\partial^2 p'}{\\partial x^2} = - \\rho \\frac{\\partial^2 u'}{\\partial t \\partial x} $$\n    假设函数足够光滑，可以交换微分顺序（$\\frac{\\partial^2 u'}{\\partial x \\partial t} = \\frac{\\partial^2 u'}{\\partial t \\partial x}$）。我们可以将混合偏导数的表达式相等：\n    $$ \\frac{2 R}{Eh} \\frac{\\partial^2 p'}{\\partial t^2} = \\frac{1}{\\rho} \\frac{\\partial^2 p'}{\\partial x^2} $$\n    将其重新排列成一维波动方程的标准形式 $\\frac{\\partial^2 p'}{\\partial t^2} = c^2 \\frac{\\partial^2 p'}{\\partial x^2}$，我们得到：\n    $$ \\frac{\\partial^2 p'}{\\partial t^2} = \\left(\\frac{Eh}{2 \\rho R}\\right) \\frac{\\partial^2 p'}{\\partial x^2} $$\n    通过比较，波传播速度 $c$ 的平方是：\n    $$ c^2 = \\frac{Eh}{2 \\rho R} $$\n    因此，脉搏波速度由 Moens-Korteweg 方程给出：\n    $$ c = \\sqrt{\\frac{Eh}{2 \\rho R}} $$\n\n### PWV与杨氏模量的标度关系\n推导出的公式表明，脉搏波速度 $c$ 与杨氏模量 $E$ 的平方根成正比：\n$$ c \\propto \\sqrt{E} $$\n这种关系意味着，随着动脉壁变得更硬（即 $E$ 增加），脉搏波传播得更快。这与临床观察结果一致，即由于老化或疾病引起的动脉硬化会导致 PWV 增加。\n\n### 数值计算\n给定的基线值为：\n$E_{base} = 0.6\\,\\text{MPa} = 0.6 \\times 10^6\\,\\text{Pa}$\n$h = 1.2\\,\\text{mm} = 1.2 \\times 10^{-3}\\,\\text{m}$\n$R = 4\\,\\text{mm} = 4 \\times 10^{-3}\\,\\text{m}$\n$\\rho = 1050\\,\\text{kg/m}^3$\n\n动脉老化导致 $E$ 增加 $20\\%$。新的杨氏模量 $E_{new}$ 为：\n$E_{new} = E_{base} \\times (1 + 0.20) = 1.20 \\times E_{base}$\n$E_{new} = 1.20 \\times (0.6 \\times 10^6\\,\\text{Pa}) = 0.72 \\times 10^6\\,\\text{Pa}$\n\n我们现在使用推导出的公式计算新的脉搏波速度 $c_{new}$：\n$$ c_{new} = \\sqrt{\\frac{E_{new} h}{2 \\rho R}} $$\n代入数值：\n$$ c_{new} = \\sqrt{\\frac{(0.72 \\times 10^6\\,\\text{Pa}) \\times (1.2 \\times 10^{-3}\\,\\text{m})}{2 \\times (1050\\,\\text{kg/m}^3) \\times (4 \\times 10^{-3}\\,\\text{m})}} $$\n$$ c_{new} = \\sqrt{\\frac{0.864 \\times 10^3}{8400}} = \\sqrt{\\frac{864}{8400}} $$\n$$ c_{new} = \\sqrt{102.85714...} \\approx 10.141849\\,\\text{m/s} $$\n四舍五入到四位有效数字，新的脉搏波速度为 $10.14\\,\\text{m/s}$。",
            "answer": "$$ \\boxed{10.14} $$"
        },
        {
            "introduction": "真实的动脉系统是一个复杂的分支网络，而不是单一的管道。当脉搏波在分叉处传播时，会因阻抗不匹配而发生反射，这深刻影响着整个心血管系统的压力和血流分布。本练习将指导你应用类似于电路中传输线理论的方法，对一个简化的三代动脉树网络进行建模，通过计算网络中各处的输入阻抗和反射系数，你将能定量分析波在分叉点的行为 。",
            "id": "3922852",
            "problem": "考虑一个使用一维 (1D) 线性化脉搏波传播框架建模的三代动脉树。根部段分叉成两个子段，每个子段再分叉成两个末端段，最终形成四个末端分支。假设血液是密度为 $\\rho$ 的不可压缩牛顿流体，并且每个动脉段都是直的、轴对称的、壁薄的。对于每个段 $i$，设其半径为 $R_i$，长度为 $L_i$，杨氏模量为 $E_i$，壁厚为 $h_i = \\alpha R_i$，其中 $\\alpha$ 是一个给定的壁厚与半径之比，在一个测试案例中所有段共享此值。Moens-Korteweg 公式给出了波速 $c_i = \\sqrt{E_i h_i/(2\\rho R_i)}$，特征阻抗为 $Z_{c,i} = \\rho c_i/A_i$，其中 $A_i = \\pi R_i^2$。假设无损传播，因此波数为 $k_i = \\omega/c_i$，角频率 $\\omega = 2\\pi f$，其中 $f$ 是驱动频率。\n\n在每个远端，将局部负载阻抗 $Z_{\\text{load}}$ 定义如下：\n- 对于末端段，$Z_{\\text{load}}$ 等于给定的末端阻力 $R_{\\text{term}}$。\n- 对于分叉连接处，$Z_{\\text{load}}$ 等于下游子段输入阻抗的并联组合。\n\n设入口由一个频率为 $f$ 的谐波压力源驱动，其复振幅为 $P_{\\text{in}}$（假设零相位，即 $P_{\\text{in}}$ 为实数且为正）。在每个连接处使用质量守恒（流量连续性）和压力连续性。对每个段使用前向/后向波分解，其中位置 $x$ 处的压力和流量分别是前向波和后向波的和与差，并通过其负载阻抗在每个远端施加终止条件。\n\n任务：\n1. 从末端向上游追溯到根部，使用标准的无损传输线关系和连接处的并联组合，计算每个段近端的复输入阻抗。\n2. 计算根部的入口流量振幅 $Q_{\\text{in}}$（单位为 $\\text{m}^3/\\text{s}$），以及进入每个末端负载的流量振幅（单位为 $\\text{m}^3/\\text{s}$），所有结果均表示为模（绝对值）。\n3. 对于每个远端位置（共七个位置：三个分叉连接处和四个末端），计算由 $\\Gamma = (Z_{\\text{load}} - Z_c)/(Z_{\\text{load}} + Z_c)$ 定义的局部反射系数的模，其中 $Z_c$ 是上游段的特征阻抗。找出 $|\\Gamma| \\ge \\tau$ 的位置的索引，阈值 $\\tau$ 在下面的每个测试套件中指定。位置索引定义如下：\n   - 位置 $0$：根部段的远端（第一个分叉处），\n   - 位置 $1$：左子段的远端（左侧的第二个分叉处），\n   - 位置 $2$：右子段的远端（右侧的第二个分叉处），\n   - 位置 $3,4$：左子树上两个末端段的远端，\n   - 位置 $5,6$：右子树上两个末端段的远端。\n4. 所有流量模值以 $\\text{m}^3/\\text{s}$ 为单位，所有压力以帕斯卡为单位，所有角度以弧度为单位。仅报告流量振幅的模（无相位）。将所有浮点输出四舍五入到六位小数。\n\n您的程序必须实现上述内容，并生成一行输出，其中包含所有测试案例的结果。结果是一个用方括号括起来的逗号分隔列表，每个测试案例的结果本身是一个格式如下的列表：\n[$Q_{\\text{in}}$, $Q_3$, $Q_4$, $Q_5$, $Q_6$, $\\max|\\Gamma|$, [主要反射位置的索引]],\n其中流量模值以 $\\text{m}^3/\\text{s}$ 为单位，$\\max|\\Gamma|$ 为无量纲。因此，最终输出格式必须为：\n[[case1_result],[case2_result],[case3_result]]\n字符串中任何地方都没有空格，浮点数四舍五入到六位小数。\n\n测试套件：\n使用以下科学上合理的参数集，涵盖一个典型案例、一个近匹配边界案例和一个强非对称案例。\n\n案例 1（对称树，中度失配）：\n- $\\rho = 1060\\,\\text{kg}/\\text{m}^3$，$E_i = 6.0\\times 10^5\\,\\text{Pa}$ 对所有段，$\\alpha = 0.10$，$f = 2.0\\,\\text{Hz}$，$P_{\\text{in}} = 5000\\,\\text{Pa}$。\n- 半径 (米)：$[R_0,R_1,R_2,R_3,R_4,R_5,R_6] = [0.005, 0.004, 0.004, 0.003, 0.003, 0.003, 0.003]$。\n- 长度 (米)：$[L_0,L_1,L_2,L_3,L_4,L_5,L_6] = [0.20, 0.15, 0.15, 0.10, 0.10, 0.10, 0.10]$。\n- 末端阻力 (Pa·s/m$^3$)：$[1.0\\times 10^8, 1.0\\times 10^8, 1.0\\times 10^8, 1.0\\times 10^8]$。\n- 阈值：$\\tau = 0.25$。\n\n案例 2（末端近阻抗匹配）：\n- $\\rho = 1060\\,\\text{kg}/\\text{m}^3$，$E_i = 5.0\\times 10^5\\,\\text{Pa}$ 对所有段，$\\alpha = 0.09$，$f = 1.0\\,\\text{Hz}$，$P_{\\text{in}} = 4000\\,\\text{Pa}$。\n- 半径 (米)：$[R_0,R_1,R_2,R_3,R_4,R_5,R_6] = [0.006, 0.0045, 0.0045, 0.0035, 0.0035, 0.0035, 0.0035]$。\n- 长度 (米)：$[L_0,L_1,L_2,L_3,L_4,L_5,L_6] = [0.25, 0.18, 0.18, 0.12, 0.12, 0.12, 0.12]$。\n- 末端阻力 (Pa·s/m$^3$)：$[7.0\\times 10^7, 7.0\\times 10^7, 7.0\\times 10^7, 7.0\\times 10^7]$。\n- 阈值：$\\tau = 0.25$。\n\n案例 3（强非对称树，较大失配）：\n- $\\rho = 1060\\,\\text{kg}/\\text{m}^3$，$E_i = 6.5\\times 10^5\\,\\text{Pa}$ 对所有段，$\\alpha = 0.12$，$f = 4.0\\,\\text{Hz}$，$P_{\\text{in}} = 6000\\,\\text{Pa}$。\n- 半径 (米)：$[R_0,R_1,R_2,R_3,R_4,R_5,R_6] = [0.005, 0.003, 0.005, 0.002, 0.0025, 0.005, 0.005]$。\n- 长度 (米)：$[L_0,L_1,L_2,L_3,L_4,L_5,L_6] = [0.18, 0.16, 0.16, 0.10, 0.10, 0.12, 0.12]$。\n- 末端阻力 (Pa·s/m$^3$)：$[8.0\\times 10^7, 9.0\\times 10^7, 6.0\\times 10^7, 6.0\\times 10^7]$。\n- 阈值：$\\tau = 0.25$。\n\n您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表，无空格，格式与以下完全相同：\n[[Qin_case1,Q3_case1,Q4_case1,Q5_case1,Q6_case1,maxGamma_case1,[indices_case1]],[Qin_case2,Q3_case2,Q4_case2,Q5_case2,Q6_case2,maxGamma_case2,[indices_case2]],[Qin_case3,Q3_case3,Q4_case3,Q5_case3,Q6_case3,maxGamma_case3,[indices_case3]]]\n所有浮点值必须四舍五入到六位小数。",
            "solution": "建模基础是顺应性血管中脉搏波传播的一维 (1D) 线性化方程，这些方程由可变形管中不可压缩流动的质量守恒和动量守恒导出。在频域中，当围绕稳态进行小扰动时，这些方程会产生支持压力和流量前向和后向行波的波动方程。波速和特征阻抗取决于管壁力学和几何形状。\n\n基本原理：\n- 质量守恒意味着横截面积的变化与轴向流量的变化相关，而动量守恒则提供了压力梯度与流体加速度之间的关系。\n- 对于薄壁、轴对称的管道，Moens-Korteweg 波速为 $c_i = \\sqrt{\\dfrac{E_i h_i}{2\\rho R_i}}$，其中 $E_i$ 是杨氏模量，$h_i$ 是壁厚，$\\rho$ 是流体密度，$R_i$ 是半径。在薄壁近似下，该公式是动脉中脉搏波速度的一个经过充分验证的关系式。\n- 特征阻抗为 $Z_{c,i} = \\dfrac{\\rho c_i}{A_i}$，其中 $A_i = \\pi R_i^2$ 是横截面积。该阻抗关联了均匀管道中单个行波的压力和流量。\n- 在频域中，角频率为 $\\omega = 2\\pi f$，波数为 $k_i = \\omega/c_i$。假设在所关注的尺度上粘性阻尼可忽略不计且波幅较小（无损近似），则前向波和后向波在长度 $L_i$ 上的传播由乘法相位因子 $\\exp(\\pm j k_i L_i)$ 描述。\n\n传输线关系：\n- 对于一个特征阻抗为 $Z_{c,i}$、波数为 $k_i$ 的均匀段 $i$，设 $P_i(x)$ 和 $Q_i(x)$ 为复压力和流量相量。其通解可以写为 $P_i(x) = P_i^+ e^{-j k_i x} + P_i^- e^{j k_i x}$ 和 $Q_i(x) = \\dfrac{1}{Z_{c,i}}\\left(P_i^+ e^{-j k_i x} - P_i^- e^{j k_i x}\\right)$，其中 $P_i^+$ 和 $P_i^-$ 是近端（$x=0$）的前向和后向压力波振幅。\n- 在远端（$x=L_i$），负载阻抗 $Z_{\\text{load}}$ 施加了条件 $P_i(L_i) = Z_{\\text{load}}\\,Q_i(L_i)$。这个终止条件通过局部反射系数 $\\Gamma = \\dfrac{Z_{\\text{load}} - Z_{c,i}}{Z_{\\text{load}} + Z_{c,i}}$ 将 $x=L_i$ 处的 $P_i^-$ 与 $x=L_i$ 处的 $P_i^+$ 联系起来。近端的后向波满足 $P_i^- (0) = \\Gamma e^{-2 j k_i L_i} P_i^+ (0)$，我们用往返因子 $R = \\Gamma e^{-2 j k_i L_i}$ 来表示。\n- 近端的输入阻抗定义为 $Z_{\\text{in},i} = P_i(0)/Q_i(0)$，通过将前向/后向分解与终止条件相结合，它遵循 $Z_{\\text{in},i} = Z_{c,i}\\dfrac{1 + R}{1 - R}$。这种递归关系允许我们从远端到近端计算输入阻抗。\n\n连接处条件：\n- 在分叉处，各分支的压力连续且流量相加：如果节点压力为 $P_{\\text{node}}$，子段的输入阻抗为 $Z_{\\text{in},a}$ 和 $Z_{\\text{in},b}$，那么父段看到的等效负载是并联组合 $Z_{\\text{load}} = \\left(\\dfrac{1}{Z_{\\text{in},a}} + \\dfrac{1}{Z_{\\text{in},b}}\\right)^{-1}$。父段使用这个 $Z_{\\text{load}}$ 来形成其反射系数和输入阻抗，如上所述。进入子段的流量为 $Q_a = P_{\\text{node}}/Z_{\\text{in},a}$ 和 $Q_b = P_{\\text{node}}/Z_{\\text{in},b}$，这与流量连续性和线性一致。\n\n算法步骤：\n1. 对于每个测试案例，计算所有七个段（$i=0,\\ldots,6$）的壁厚 $h_i = \\alpha R_i$、面积 $A_i$、波速 $c_i = \\sqrt{\\dfrac{E_i h_i}{2\\rho R_i}}$、特征阻抗 $Z_{c,i} = \\dfrac{\\rho c_i}{A_i}$ 和波数 $k_i = \\omega/c_i$。\n2. 从四个末端段（$i=3,4,5,6$）开始，递归计算输入阻抗。对于每个末端，负载阻抗是给定的阻力 $R_{\\text{term}}$，反射系数是 $\\Gamma_i = \\dfrac{R_{\\text{term}} - Z_{c,i}}{R_{\\text{term}} + Z_{c,i}}$。往返因子是 $R_i = \\Gamma_i e^{-2 j k_i L_i}$，输入阻抗是 $Z_{\\text{in},i} = Z_{c,i}\\dfrac{1 + R_i}{1 - R_i}$。\n3. 在第二代分叉处（位置 $1$ 和 $2$），由两个子段的输入阻抗形成并联负载 $Z_{\\text{load}}$，并使用相同的公式计算段 $i=1$ 和 $i=2$ 相应的反射系数和输入阻抗。\n4. 在第一代分叉处（位置 $0$），由 $Z_{\\text{in},1}$ 和 $Z_{\\text{in},2}$ 形成并联负载，并计算根段 $i=0$ 的反射系数和输入阻抗。\n5. 利用根输入阻抗 $Z_{\\text{in},0}$，计算入口流量 $Q_{\\text{in}} = P_{\\text{in}}/Z_{\\text{in},0}$。将根部近端的压力和流量分解为前向波和后向波：$P_0^+ = \\dfrac{P_{\\text{in}} + Z_{c,0} Q_{\\text{in}}}{2}$ 和 $P_0^- = \\dfrac{P_{\\text{in}} - Z_{c,0} Q_{\\text{in}}}{2}$。传播到远端：$P_{\\text{node},0} = P_0^+ e^{-j k_0 L_0} + P_0^- e^{j k_0 L_0}$。\n6. 使用 $P_{\\text{node},0}$ 来确定进入左右子段的近端流量：$Q_1(0) = \\dfrac{P_{\\text{node},0}}{Z_{\\text{in},1}}$ 和 $Q_2(0) = \\dfrac{P_{\\text{node},0}}{Z_{\\text{in},2}}$。对于每个子段，类似地将近端状态分解为前向波和后向波，并传播以获得其远端节点压力 $P_{\\text{node},1}$ 和 $P_{\\text{node},2}$。\n7. 在每个末端段，应用相同的分解，使用近端状态 $P_{\\text{node}}$ 和 $Q(0) = \\dfrac{P_{\\text{node}}}{Z_{\\text{in}}}$ 来计算远端压力 $P(L)$，然后计算末端负载流量 $Q_{\\text{term}} = \\dfrac{P(L)}{R_{\\text{term}}}$，根据终止处的连续性，该流量等于该段的远端流量。\n8. 在每个远端位置（三个连接处和四个末端），使用 $\\Gamma = \\dfrac{Z_{\\text{load}} - Z_c}{Z_{\\text{load}} + Z_c}$（其中 $Z_{\\text{load}}$ 按位置定义）计算局部反射系数的模 $|\\Gamma|$；收集所有七个模值，确定最大值以及哪些位置索引满足 $|\\Gamma| \\ge \\tau$。\n9. 报告入口流量模 $|Q_{\\text{in}}|$ 和末端 $3$ 到 $6$ 的末端流量模 $|Q_{\\text{term}}|$（单位为 $\\text{m}^3/\\text{s}$），以及 $\\max|\\Gamma|$ 和 $|\\Gamma| \\ge \\tau$ 的位置索引列表。将所有浮点值四舍五入到六位小数，并将输出格式化为单个无空格的方括号列表。\n\n科学真实性和合理性：\n- 所选的半径、长度和材料特性在中等大小的动脉的生理范围内。\n- Moens-Korteweg 波速和特征阻抗被广泛接受用于描述薄壁管中的小振幅波。\n- 频率范围 $1$ 到 $4\\,\\text{Hz}$ 对应于心率及其谐波。\n- 电阻性末端负载代表远端的微循环阻抗。\n\n该设计确保算法遵循第一性原理（守恒定律、波分解、壁力学），并为涵盖对称、近匹配和非对称网络的各种测试套件生成可量化的输出。最终程序计算所要求的量，使用指定的阈值识别主要反射位置，并以要求的单行、六位小数四舍五入的格式打印结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef parallel_impedance(z1, z2):\n    return 1.0 / (1.0 / z1 + 1.0 / z2)\n\ndef segment_input_impedance(Zc, k, L, Zload):\n    # Reflection coefficient at distal end (local mismatch)\n    Gamma = (Zload - Zc) / (Zload + Zc)\n    Rfactor = Gamma * np.exp(-2j * k * L)\n    Zin = Zc * (1.0 + Rfactor) / (1.0 - Rfactor)\n    return Zin, Gamma\n\ndef propagate_distal_pressure(P_prox, Q_prox, Zc, k, L):\n    # Decompose into forward/backward waves at proximal end\n    Pf = (P_prox + Zc * Q_prox) / 2.0\n    Pb = (P_prox - Zc * Q_prox) / 2.0\n    # Propagate to distal end\n    P_dist = Pf * np.exp(-1j * k * L) + Pb * np.exp(1j * k * L)\n    Q_dist = (Pf * np.exp(-1j * k * L) - Pb * np.exp(1j * k * L)) / Zc\n    return P_dist, Q_dist\n\ndef compute_case(params):\n    rho = params[\"rho\"]\n    E = params[\"E\"]\n    alpha = params[\"alpha\"]\n    f = params[\"f\"]\n    Pin = params[\"Pin\"]\n    R = np.array(params[\"radii\"], dtype=float)  # length 7\n    L = np.array(params[\"lengths\"], dtype=float)  # length 7\n    Rterm = np.array(params[\"Rterm\"], dtype=float)  # length 4\n    tau = params[\"tau\"]\n\n    omega = 2.0 * np.pi * f\n    h = alpha * R\n    A = np.pi * R**2\n    c = np.sqrt(E * h / (2.0 * rho * R))\n    Zc = rho * c / A\n    k = omega / c\n\n    # Indices: 0 root; 1 left daughter; 2 right daughter; 3,4 left terminals; 5,6 right terminals\n    Zin = np.zeros(7, dtype=complex)\n    Gamma_sites = np.zeros(7, dtype=complex)\n\n    # Terminals 3,4,5,6\n    for idx, t in enumerate([3, 4, 5, 6]):\n        Zload = Rterm[idx]\n        Zin[t], Gamma_sites[t] = segment_input_impedance(Zc[t], k[t], L[t], Zload)\n\n    # Second-generation bifurcations for segments 1 and 2\n    # Segment 1 loads: terminals 3 and 4 in parallel\n    Zload_1 = parallel_impedance(Zin[3], Zin[4])\n    Zin[1], Gamma_sites[1] = segment_input_impedance(Zc[1], k[1], L[1], Zload_1)\n\n    # Segment 2 loads: terminals 5 and 6 in parallel\n    Zload_2 = parallel_impedance(Zin[5], Zin[6])\n    Zin[2], Gamma_sites[2] = segment_input_impedance(Zc[2], k[2], L[2], Zload_2)\n\n    # First-generation bifurcation for root segment 0\n    Zload_0 = parallel_impedance(Zin[1], Zin[2])\n    Zin[0], Gamma_sites[0] = segment_input_impedance(Zc[0], k[0], L[0], Zload_0)\n\n    # Inlet flow\n    Qin = Pin / Zin[0]\n\n    # Root distal node pressure\n    Pnode0, Qdist0 = propagate_distal_pressure(Pin, Qin, Zc[0], k[0], L[0])\n\n    # Flows into daughters at proximal ends\n    Q1_prox = Pnode0 / Zin[1]\n    Q2_prox = Pnode0 / Zin[2]\n\n    # Left daughter distal node pressure\n    Pnode1, Qdist1 = propagate_distal_pressure(Pnode0, Q1_prox, Zc[1], k[1], L[1])\n    # Right daughter distal node pressure\n    Pnode2, Qdist2 = propagate_distal_pressure(Pnode0, Q2_prox, Zc[2], k[2], L[2])\n\n    # Left terminals proximal flows\n    Q3_prox = Pnode1 / Zin[3]\n    Q4_prox = Pnode1 / Zin[4]\n    # Right terminals proximal flows\n    Q5_prox = Pnode2 / Zin[5]\n    Q6_prox = Pnode2 / Zin[6]\n\n    # Propagate through terminal segments to distal load pressures\n    P3_dist, Q3_dist = propagate_distal_pressure(Pnode1, Q3_prox, Zc[3], k[3], L[3])\n    P4_dist, Q4_dist = propagate_distal_pressure(Pnode1, Q4_prox, Zc[4], k[4], L[4])\n    P5_dist, Q5_dist = propagate_distal_pressure(Pnode2, Q5_prox, Zc[5], k[5], L[5])\n    P6_dist, Q6_dist = propagate_distal_pressure(Pnode2, Q6_prox, Zc[6], k[6], L[6])\n\n    # Terminal load flows (should equal segment distal flows)\n    Q3_term = P3_dist / Rterm[0]\n    Q4_term = P4_dist / Rterm[1]\n    Q5_term = P5_dist / Rterm[2]\n    Q6_term = P6_dist / Rterm[3]\n\n    # Magnitudes\n    Qin_mag = float(np.abs(Qin))\n    Q3_mag = float(np.abs(Q3_term))\n    Q4_mag = float(np.abs(Q4_term))\n    Q5_mag = float(np.abs(Q5_term))\n    Q6_mag = float(np.abs(Q6_term))\n\n    # Reflection magnitudes at sites 0..6\n    Gamma_mags = [float(np.abs(Gamma_sites[i])) for i in range(7)]\n    max_reflection = max(Gamma_mags)\n    major_sites = [i for i, g in enumerate(Gamma_mags) if g >= tau]\n\n    return [Qin_mag, Q3_mag, Q4_mag, Q5_mag, Q6_mag, max_reflection, major_sites]\n\ndef format_number(x):\n    # Ensure six decimal places\n    return f\"{x:.6f}\"\n\ndef format_nested(obj):\n    # Format nested list with no spaces, floats to six decimals\n    if isinstance(obj, list):\n        return \"[\" + \",\".join(format_nested(x) for x in obj) + \"]\"\n    elif isinstance(obj, (float, np.floating)):\n        return format_number(float(obj))\n    elif isinstance(obj, (int, np.integer)):\n        return str(int(obj))\n    else:\n        # Should not occur; fallback to float formatting if possible\n        try:\n            return format_number(float(obj))\n        except Exception:\n            return str(obj)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"rho\": 1060.0,\n            \"E\": 6.0e5,\n            \"alpha\": 0.10,\n            \"f\": 2.0,\n            \"Pin\": 5000.0,\n            \"radii\": [0.005, 0.004, 0.004, 0.003, 0.003, 0.003, 0.003],\n            \"lengths\": [0.20, 0.15, 0.15, 0.10, 0.10, 0.10, 0.10],\n            \"Rterm\": [1.0e8, 1.0e8, 1.0e8, 1.0e8],\n            \"tau\": 0.25,\n        },\n        {\n            \"rho\": 1060.0,\n            \"E\": 5.0e5,\n            \"alpha\": 0.09,\n            \"f\": 1.0,\n            \"Pin\": 4000.0,\n            \"radii\": [0.006, 0.0045, 0.0045, 0.0035, 0.0035, 0.0035, 0.0035],\n            \"lengths\": [0.25, 0.18, 0.18, 0.12, 0.12, 0.12, 0.12],\n            \"Rterm\": [7.0e7, 7.0e7, 7.0e7, 7.0e7],\n            \"tau\": 0.25,\n        },\n        {\n            \"rho\": 1060.0,\n            \"E\": 6.5e5,\n            \"alpha\": 0.12,\n            \"f\": 4.0,\n            \"Pin\": 6000.0,\n            \"radii\": [0.005, 0.003, 0.005, 0.002, 0.0025, 0.005, 0.005],\n            \"lengths\": [0.18, 0.16, 0.16, 0.10, 0.10, 0.12, 0.12],\n            \"Rterm\": [8.0e7, 9.0e7, 6.0e7, 6.0e7],\n            \"tau\": 0.25,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        res = compute_case(case)\n        # Round float entries to six decimals for output consistency\n        rounded = []\n        for item in res:\n            if isinstance(item, list):\n                # list of integers (major sites)\n                rounded.append(item)\n            else:\n                rounded.append(float(f\"{item:.6f}\"))\n        results.append(rounded)\n\n    # Final print statement in the exact required format: no spaces.\n    print(format_nested(results))\n\nsolve()\n```"
        },
        {
            "introduction": "为了更精确地捕捉脉搏波传播中的非线性效应和瞬态动力学，我们需要超越线性化频域模型，转而使用更强大的时域数值方法。本练习将向你介绍求解双曲型偏微分方程的经典工具——特征线法。你不仅需要推导控制方程的特征形式和相应的黎曼不变量（Riemann invariants），还将亲手实现一个数值求解方案，并探索其稳定性所必须满足的库朗-弗里德里希斯-路维（CFL）条件 。",
            "id": "3922798",
            "problem": "考虑一个均匀弹性血管段中的无摩擦一维血流方程，该方程用血管横截面积 $A(x,t)$ 和体积流率 $Q(x,t)$ 来表示。令横截面平均轴向速度为 $u(x,t) = Q(x,t)/A(x,t)$。控制方程（质量守恒和动量平衡）为\n$$\n\\frac{\\partial A}{\\partial t} + \\frac{\\partial Q}{\\partial x} = 0,\n\\qquad\n\\frac{\\partial Q}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\frac{Q^2}{A}\\right) + \\frac{A}{\\rho}\\frac{\\partial p(A)}{\\partial x} = 0,\n$$\n其中 $\\rho$ 是血液密度，$p(A)$ 是由血管壁力学决定的内压。假设一个标准的压力-面积（管）定律\n$$\np(A) = p_{\\text{ext}} + \\frac{\\beta}{A_0}\\left(\\sqrt{A} - \\sqrt{A_0}\\right),\n$$\n其中 $p_{\\text{ext}}$ 是外部压力（恒定），$A_0$ 是零跨壁压时的参考面积，$\\beta$ 是管壁刚度参数。在此定律和无摩擦条件下，该双曲系统具有特征速度 $u \\pm c(A)$，其中局部波速 $c(A)$ 满足\n$$\nc^2(A) = \\frac{A}{\\rho}\\frac{dp}{dA} = \\frac{\\beta}{2\\rho A_0}\\sqrt{A}.\n$$\n该系统的相关黎曼不变量具有一般形式 $w_{\\pm} = u \\pm \\int \\frac{c(A)}{A}\\, dA$。对于给定的管定律，该积分简化为 $w_{\\pm} = u \\pm 4 c(A)$。\n\n任务1（推导）：从上述基本定律出发，推导所述压力-面积定律的特征形式和特定的黎曼不变量 $w_{\\pm} = u \\pm 4 c(A)$。然后，推导在间距为 $\\Delta x$ 的均匀网格上，一个时间步长 $\\Delta t$ 内的显式特征线法更新的 Courant–Friedrichs–Lewy (CFL) 稳定性条件，并证明其稳定性约束为\n$$\n\\max_x\\left(|u(x,t)| + c(A(x,t))\\right)\\,\\frac{\\Delta t}{\\Delta x} \\le 1.\n$$\n\n任务2（实现）：在均匀空间网格上，实现一个时间步长 $\\Delta t$ 内对 $(A,Q)$ 的单步显式特征线法更新，使用不变量 $w_{\\pm}$，并将其沿各自具有局部速度 $u \\pm c$ 的特征曲线视为常数。对于时间 $t$ 的每个网格点 $x_i$，沿右行和左行特征线回溯到足点位置 $x_i - (u_i + c_i)\\Delta t$ 和 $x_i - (u_i - c_i)\\Delta t$，将初始的 $w_{+}$ 和 $w_{-}$ 线性插值到这些足点位置，并通过以下方式重构 $u$ 和 $c$\n$$\nu^{n+1}_i = \\frac{w_{+,i}^{\\text{foot}} + w_{-,i}^{\\text{foot}}}{2}, \\qquad\nc^{n+1}_i = \\frac{w_{+,i}^{\\text{foot}} - w_{-,i}^{\\text{foot}}}{8},\n$$\n然后使用 $c(A) = \\alpha A^{1/4}$（其中 $\\alpha = \\sqrt{\\beta/(2\\rho A_0)}$）从 $c^{n+1}_i$ 恢复 $A^{n+1}_i$，最后计算 $Q^{n+1}_i = A^{n+1}_i u^{n+1}_i$。\n\n物理参数和初始条件：\n- 血液密度 $\\rho = 1060$ kg/m$^3$。\n- 参考半径 $r_0 = 1.0\\times 10^{-3}$ m，因此 $A_0 = \\pi r_0^2$ m$^2$。\n- 选择 $\\beta$ 使得在 $A=A_0$ 时的名义波速为 $c_0 = 5.0$ m/s，即，\n$$\n\\beta = \\frac{2 \\rho A_0 c_0^2}{\\sqrt{A_0}}.\n$$\n- 段长 $L = 0.2$ m，均匀网格有 $N = 201$ 个点（因此 $\\Delta x = L/(N-1)$）。\n- 外部压力 $p_{\\text{ext}} = 0$ Pa（表压）。\n- 围绕 $A_0$ 的初始面积扰动：\n$$\nA(x,0) = A_0\\left(1 + \\varepsilon \\exp\\left(-\\frac{(x - L/2)^2}{2\\sigma^2}\\right)\\right),\n$$\n其中 $\\varepsilon = 0.05$（无量纲）且 $\\sigma = 0.02$ m。\n- 初始速度 $u(x,0) = 0$ m/s，因此 $Q(x,0) = A(x,0)\\,u(x,0) = 0$ m$^3$/s。\n\n测试套件和输出：\n- 令 $\\lambda_{\\max} = \\max_x \\left(|u(x,0)| + c(A(x,0))\\right)$ 在 $t=0$ 时。\n- 定义三个时间步长来探测稳定性：\n  1. $\\Delta t_1 = 0.8\\,\\Delta x/\\lambda_{\\max}$（稳定情况）。\n  2. $\\Delta t_2 = 1.0\\,\\Delta x/\\lambda_{\\max}$（边界情况）。\n  3. $\\Delta t_3 = 1.2\\,\\Delta x/\\lambda_{\\max}$（名义上不稳定）。\n- 对于每个 $\\Delta t_k$，执行一次从 $t=0$ 到 $t=\\Delta t_k$ 的特征线法更新，并计算：\n  - CFL 裕度 $m_k = 1 - \\lambda_{\\max}\\Delta t_k/\\Delta x$（无量纲）。\n  - 最大绝对面积变化 $\\max_i |A^{n+1}_i - A^{n}_i|$，单位为 m$^2$。\n  - 最大绝对流量变化 $\\max_i |Q^{n+1}_i - Q^{n}_i|$，单位为 m$^3$/s。\n\n不涉及角度单位。所有物理量必须以国际单位制 (SI) 计算和报告：米 (m)、秒 (s)、千克 (kg)、帕斯卡 (Pa)。你的程序应产生单行输出，其中包含按顺序聚合的 $9$ 个数值结果\n$$\n[m_1,\\Delta A_{\\max,1},\\Delta Q_{\\max,1},m_2,\\Delta A_{\\max,2},\\Delta Q_{\\max,2},m_3,\\Delta A_{\\max,3},\\Delta Q_{\\max,3}],\n$$\n以逗号分隔的列表形式打印，并用方括号括起来，不含任何附加文本。",
            "solution": "该问题是有效的，因为它在科学上基于流体动力学和连续介质力学的原理，在数学上是自洽的，并提供了执行所要求的推导和计算所需的所有必要信息。\n\n### 第1部分：推导\n\n我们需要完成三项推导：控制方程的特征形式、给定压力-面积定律的特定黎曼不变量，以及 Courant-Friedrichs-Lewy (CFL) 稳定性条件。\n\n**特征形式的推导**\n\n一维血流的控制方程以横截面积 $A(x,t)$ 和体积流率 $Q(x,t)$ 表示：\n$$\n\\frac{\\partial A}{\\partial t} + \\frac{\\partial Q}{\\partial x} = 0\n$$\n$$\n\\frac{\\partial Q}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\frac{Q^2}{A}\\right) + \\frac{A}{\\rho}\\frac{\\partial p(A)}{\\partial x} = 0\n$$\n我们切换到原始变量 $(A, u)$，其中 $u = Q/A$ 是平均速度。使用乘法法则，$\\frac{\\partial Q}{\\partial x} = \\frac{\\partial(uA)}{\\partial x} = u\\frac{\\partial A}{\\partial x} + A\\frac{\\partial u}{\\partial x}$。质量守恒方程变为：\n$$\n\\frac{\\partial A}{\\partial t} + u\\frac{\\partial A}{\\partial x} + A\\frac{\\partial u}{\\partial x} = 0 \\quad (1)\n$$\n对于动量方程，我们首先使用波速 $c(A)$ 的定义，其中 $c^2(A) = \\frac{A}{\\rho}\\frac{dp}{dA}$。使用链式法则，压力项变为 $\\frac{A}{\\rho}\\frac{\\partial p}{\\partial x} = \\frac{A}{\\rho}\\frac{dp}{dA}\\frac{\\partial A}{\\partial x} = c^2\\frac{\\partial A}{\\partial x}$。动量方程可以使用 $Q=uA$ 和 $Q^2/A = u^2A$ 重写为：\n$$\n\\frac{\\partial(uA)}{\\partial t} + \\frac{\\partial(u^2A)}{\\partial x} + c^2\\frac{\\partial A}{\\partial x} = 0\n$$\n使用乘法法则展开导数：\n$$\nA\\frac{\\partial u}{\\partial t} + u\\frac{\\partial A}{\\partial t} + u^2\\frac{\\partial A}{\\partial x} + 2uA\\frac{\\partial u}{\\partial x} + c^2\\frac{\\partial A}{\\partial x} = 0\n$$\n我们可以从方程(1)中代入 $\\frac{\\partial A}{\\partial t}$：\n$$\nA\\frac{\\partial u}{\\partial t} + u\\left(-u\\frac{\\partial A}{\\partial x} - A\\frac{\\partial u}{\\partial x}\\right) + u^2\\frac{\\partial A}{\\partial x} + 2uA\\frac{\\partial u}{\\partial x} + c^2\\frac{\\partial A}{\\partial x} = 0\n$$\n简化各项：\n$$\nA\\frac{\\partial u}{\\partial t} - u^2\\frac{\\partial A}{\\partial x} - uA\\frac{\\partial u}{\\partial x} + u^2\\frac{\\partial A}{\\partial x} + 2uA\\frac{\\partial u}{\\partial x} + c^2\\frac{\\partial A}{\\partial x} = 0\n$$\n$$\nA\\frac{\\partial u}{\\partial t} + uA\\frac{\\partial u}{\\partial x} + c^2\\frac{\\partial A}{\\partial x} = 0\n$$\n除以 $A$（因为 $A0$）：\n$$\n\\frac{\\partial u}{\\partial t} + u\\frac{\\partial u}{\\partial x} + \\frac{c^2}{A}\\frac{\\partial A}{\\partial x} = 0 \\quad (2)\n$$\n方程(1)和(2)构成一个拟线性系统。我们可以将该系统写成矩阵形式 $\\mathbf{v}_t + \\mathbf{M} \\mathbf{v}_x = \\mathbf{0}$，其中 $\\mathbf{v} = [A, u]^T$：\n$$\n\\frac{\\partial}{\\partial t}\\begin{pmatrix} A \\\\ u \\end{pmatrix} + \\begin{pmatrix} u  A \\\\ c^2/A  u \\end{pmatrix} \\frac{\\partial}{\\partial x}\\begin{pmatrix} A \\\\ u \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n矩阵 $\\mathbf{M}$ 的特征值 $\\lambda$ 是特征速度。它们通过求解 $\\det(\\mathbf{M} - \\lambda\\mathbf{I}) = 0$ 得到：\n$$\n\\det\\begin{pmatrix} u-\\lambda  A \\\\ c^2/A  u-\\lambda \\end{pmatrix} = (u-\\lambda)^2 - A\\frac{c^2}{A} = (u-\\lambda)^2 - c^2 = 0\n$$\n这得到 $u - \\lambda = \\pm c$，因此特征速度为 $\\lambda_{\\pm} = u \\pm c(A)$。\n\n**黎曼不变量的推导**\n\n为了找到黎曼不变量，我们求出与 $\\lambda_{\\pm}$ 对应的矩阵 $\\mathbf{M}$ 的左特征向量 $\\mathbf{l}_{\\pm}$。一个特征向量 $\\mathbf{l} = [l_1, l_2]$ 满足 $\\mathbf{l}^T\\mathbf{M} = \\lambda\\mathbf{l}^T$。\n$$\n\\begin{pmatrix} l_1  l_2 \\end{pmatrix} \\begin{pmatrix} u  A \\\\ c^2/A  u \\end{pmatrix} = \\lambda \\begin{pmatrix} l_1  l_2 \\end{pmatrix}\n$$\n这会产生两个方程：\n$l_1 u + l_2 c^2/A = \\lambda l_1$ 和 $l_1 A + l_2 u = \\lambda l_2$。从第一个方程，我们得到 $l_2 c^2/A = (\\lambda-u)l_1$。对于 $\\lambda_{\\pm} = u \\pm c$，这变为 $l_2 c^2/A = \\pm c l_1$，简化为 $l_2 = \\pm\\frac{A}{c}l_1$。\n我们可以选择 $l_1 = \\pm c/A$，从而得到 $l_2 = 1$。左特征向量是 $\\mathbf{l}_{\\pm} = [\\pm c/A, 1]$。\n用 $\\mathbf{l}_{\\pm}^T$ 从左边乘以矩阵方程 $\\mathbf{v}_t + \\mathbf{M} \\mathbf{v}_x = \\mathbf{0}$，得到：\n$$\n\\mathbf{l}_{\\pm}^T (\\mathbf{v}_t + \\lambda_{\\pm} \\mathbf{v}_x) = \\mathbf{0} \\implies \\pm\\frac{c}{A}\\left(\\frac{\\partial A}{\\partial t} + \\lambda_{\\pm}\\frac{\\partial A}{\\partial x}\\right) + 1 \\cdot \\left(\\frac{\\partial u}{\\partial t} + \\lambda_{\\pm}\\frac{\\partial u}{\\partial x}\\right) = 0\n$$\n括号中的表达式是沿特征线 $dx/dt = \\lambda_{\\pm}$ 的全导数。因此，沿着这些路径：\n$$\n\\frac{du}{dt_{\\pm}} \\pm \\frac{c(A)}{A}\\frac{dA}{dt_{\\pm}} = 0 \\quad \\text{沿 } \\quad \\frac{dx}{dt} = u \\pm c\n$$\n这可以写成 $du \\pm \\frac{c(A)}{A}dA=0$。黎曼不变量 $w_{\\pm}$ 是沿这些特征线为常数的量。它们通过对此表达式积分得到：\n$$\nw_{\\pm} = u \\pm \\int \\frac{c(A)}{A} dA\n$$\n对于给定的管定律，$p(A) = p_{\\text{ext}} + \\frac{\\beta}{A_0}(\\sqrt{A} - \\sqrt{A_0})$，我们有 $\\frac{dp}{dA} = \\frac{\\beta}{2A_0\\sqrt{A}}$。\n波速的平方是 $c^2(A) = \\frac{A}{\\rho}\\frac{dp}{dA} = \\frac{\\beta\\sqrt{A}}{2\\rho A_0}$。因此，$c(A) = \\sqrt{\\frac{\\beta}{2\\rho A_0}} A^{1/4}$。让我们定义常数 $\\alpha = \\sqrt{\\frac{\\beta}{2\\rho A_0}}$，所以 $c(A) = \\alpha A^{1/4}$。\n黎曼不变量的积分变为：\n$$\n\\int \\frac{c(A)}{A} dA = \\int \\frac{\\alpha A^{1/4}}{A} dA = \\alpha \\int A^{-3/4} dA = \\alpha \\frac{A^{1/4}}{1/4} + \\text{const} = 4\\alpha A^{1/4} + \\text{const} = 4c(A) + \\text{const}\n$$\n忽略积分常数，黎曼不变量是：\n$$\nw_{\\pm} = u \\pm 4c(A)\n$$\n\n**CFL条件的推导**\n\nCourant-Friedrichs-Lewy (CFL) 条件是求解双曲偏微分方程的显式数值方法保持稳定性的一个必要条件。它指出，一个网格点的数值依赖域必须包含其物理（或解析）依赖域。\n\n对于当前系统，信息以速度 $\\lambda_{\\pm} = u \\pm c$ 沿特征曲线传播。考虑一个离散网格上的点 $(x_i, t_{n+1})$，其间距为 $\\Delta x$ 和 $\\Delta t$。该点的解取决于时间 $t_n$ 时，由穿过 $(x_i, t_{n+1})$ 的特征线的“足点”所定义区间内的初始数据。这些足点位于 $x_{i, \\text{foot}}^{\\pm} = x_i - \\lambda_{\\pm}\\Delta t = x_i - (u \\pm c)\\Delta t$。点 $(x_i, t_{n+1})$ 在时间 $t_n$ 的物理依赖域是由这两个足点界定的实线上的区间。\n\n一种显式数值方法，如所描述的方法，使用时间 $t_n$ 时有限的一组相邻网格点（例如 $\\{x_{i-1}, x_i, x_{i+1}\\}$）的数据来计算 $(x_i, t_{n+1})$ 处的解。其数值依赖域是这些点所覆盖的区间，即 $[x_i - \\Delta x, x_i + \\Delta x]$。\n\n为保证稳定性，物理依赖域必须是数值依赖域的子集。这意味着移动最快的特征线在一个时间步长 $\\Delta t$ 内的移动距离不能超过一个网格单元间距 $\\Delta x$。在任意点 $x$ 的最大传播速度由 $\\max(|\\lambda_+|, |\\lambda_-|) = \\max(|u+c|, |u-c|)$ 给出。由于波速 $c$ 是非负的，这个最大值是 $|u|+c$。\n\n因此，在整个区域内，最快信号在 $\\Delta t$ 期间传播的距离必须小于或等于 $\\Delta x$：\n$$\n\\left( \\max_x(|u(x,t)| + c(A(x,t))) \\right) \\Delta t \\le \\Delta x\n$$\n重新整理后得到无量纲CFL条件：\n$$\n\\frac{\\Delta t}{\\Delta x} \\max_x\\left(|u(x,t)| + c(A(x,t))\\right) \\le 1\n$$\n表达式 $\\mathcal{C} = \\lambda_{\\max} \\frac{\\Delta t}{\\Delta x}$ 是库朗数，其中 $\\lambda_{\\max} = \\max_x(|u|+c)$。稳定性要求 $\\mathcal{C} \\le 1$。\n\n### 第2部分：数值实现\n\n所给的任务是实现一个单步特征线法更新。计划如下：\n1.  定义物理和数值参数：$\\rho, r_0, c_0, L, N, \\varepsilon, \\sigma$。\n2.  计算派生常数：$A_0 = \\pi r_0^2$，$\\beta = \\frac{2 \\rho A_0 c_0^2}{\\sqrt{A_0}}$，$\\alpha = \\sqrt{\\frac{\\beta}{2\\rho A_0}}$，以及 $\\Delta x = L/(N-1)$。\n3.  在均匀网格 $x_i$ 上设置 $t=0$ ($n=0$) 时的初始条件：计算 $A^n(x_i)$ 和 $u^n(x_i)=0$。\n4.  从初始状态计算波速场 $c^n(x_i)$ 和黎曼不变量场 $w_{\\pm}^n(x_i)$。\n5.  确定最大特征速度 $\\lambda_{\\max} = \\max_i(|u_i^n| + c_i^n)$。\n6.  对于三个指定的时间步长 $\\Delta t_k$ 中的每一个（$k=1,2,3$）：\n    a. 遍历每个网格点 $x_i$ 以计算 $t=\\Delta t_k$ 时的状态。\n    b. 在每个 $x_i$ 处，确定特征线的足点位置：$x_{\\text{foot},\\pm} = x_i - (u_i^n \\pm c_i^n)\\Delta t_k$。\n    c. 将初始不变量场 $w_{\\pm}^n$ 线性插值到这些足点位置，得到 $w_{\\pm,i}^{\\text{foot}}$。\n    d. 使用提供的公式从插值得到的不变量重构新的速度 $u_i^{n+1}$ 和波速 $c_i^{n+1}$：$u^{n+1}_i = (w_{+,i}^{\\text{foot}} + w_{-,i}^{\\text{foot}})/2$ 和 $c^{n+1}_i = (w_{+,i}^{\\text{foot}} - w_{-,i}^{\\text{foot}})/8$。\n    e. 使用关系式 $A=(c/\\alpha)^4$ 从新的波速恢复新的面积 $A_i^{n+1}$。\n    f. 计算新的流率 $Q_i^{n+1} = A_i^{n+1} u_i^{n+1}$。\n    g. 在计算出新时间步长的完整场之后，计算所要求的分析量：CFL 裕度 $m_k = 1 - \\lambda_{\\max}\\Delta t_k/\\Delta x$，最大绝对面积变化 $\\max_i |A_i^{n+1} - A_i^n|$，以及最大绝对流量变化 $\\max_i |Q_i^{n+1} - Q_i^n|$。\n7.  聚合这九个结果并以指定格式打印。插值的边界值将使用常数外插法处理，这是 NumPy 插值函数的默认行为。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries outside the Python standard library are permitted.\n\ndef solve():\n    \"\"\"\n    Solves the pulse wave propagation problem using a single-step\n    method of characteristics.\n    \"\"\"\n    # Physical parameters and initial condition setup\n    rho = 1060.0  # kg/m^3\n    r0 = 1.0e-3  # m\n    c0 = 5.0  # m/s\n    L = 0.2  # m\n    N = 201  # number of grid points\n    epsilon = 0.05  # dimensionless amplitude\n    sigma = 0.02  # m\n\n    # Derived constants and grid\n    A0 = np.pi * r0**2\n    beta = (2 * rho * A0 * c0**2) / np.sqrt(A0)\n    alpha = np.sqrt(beta / (2 * rho * A0))\n    x = np.linspace(0, L, N)\n    dx = L / (N - 1)\n\n    # Initial conditions at t=0 (n=0)\n    A_n = A0 * (1 + epsilon * np.exp(-((x - L / 2)**2) / (2 * sigma**2)))\n    u_n = np.zeros(N)\n    Q_n = A_n * u_n\n\n    # Initial state variables for the method\n    c_n = alpha * A_n**(1/4)\n    w_plus_n = u_n + 4 * c_n\n    w_minus_n = u_n - 4 * c_n\n\n    # Maximum characteristic speed for CFL condition\n    lambda_max = np.max(np.abs(u_n) + c_n)\n\n    # Test suite: define CFL numbers and corresponding time steps\n    cfl_numbers = [0.8, 1.0, 1.2]\n    time_steps = [cfl * dx / lambda_max for cfl in cfl_numbers]\n    \n    results = []\n\n    for dt in time_steps:\n        # Initialize arrays for the new state at t = dt (n+1)\n        A_np1 = np.empty_like(A_n)\n        u_np1 = np.empty_like(u_n)\n        Q_np1 = np.empty_like(Q_n)\n\n        # Main loop over grid points\n        for i in range(N):\n            # 1. Trace back characteristics to find foot positions\n            x_foot_plus = x[i] - (u_n[i] + c_n[i]) * dt\n            x_foot_minus = x[i] - (u_n[i] - c_n[i]) * dt\n\n            # 2. Linearly interpolate invariants to the foot positions\n            # np.interp handles boundaries by constant extrapolation by default\n            w_plus_foot = np.interp(x_foot_plus, x, w_plus_n)\n            w_minus_foot = np.interp(x_foot_minus, x, w_minus_n)\n\n            # 3. Reconstruct u and c at the new time step\n            u_np1[i] = (w_plus_foot + w_minus_foot) / 2\n            c_np1_i = (w_plus_foot - w_minus_foot) / 8\n\n            # 4. Recover A and Q from the new u and c\n            # Handle potential for c to be negative from numerical error\n            # Although physically c > 0, the reconstruction formula doesn't guarantee it.\n            if c_np1_i  0:\n                c_np1_i = 0  # A becomes 0, physically reasonable cap\n            \n            A_np1[i] = (c_np1_i / alpha)**4\n            Q_np1[i] = A_np1[i] * u_np1[i]\n\n        # Calculate analysis metrics for this time step\n        m_k = 1 - lambda_max * dt / dx\n        delta_A_max = np.max(np.abs(A_np1 - A_n))\n        delta_Q_max = np.max(np.abs(Q_np1 - Q_n))\n\n        results.extend([m_k, delta_A_max, delta_Q_max])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{val:.8e}' for val in results)}]\")\n\nsolve()\n```"
        }
    ]
}