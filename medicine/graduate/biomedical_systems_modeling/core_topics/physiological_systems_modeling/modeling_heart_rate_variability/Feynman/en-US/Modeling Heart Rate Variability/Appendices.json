{
    "hands_on_practices": [
        {
            "introduction": "The fidelity of any Heart Rate Variability (HRV) analysis is fundamentally determined by the quality of the initial R-peak detection from the electrocardiogram (ECG). This first exercise tackles the critical, practical decision of selecting an appropriate ECG sampling rate. By working through this problem, you will develop a quantitative understanding of how the sampling frequency, $f_s$, creates a trade-off between preventing signal distortion and minimizing timing errors in the resulting beat-to-beat interval series .",
            "id": "3906338",
            "problem": "An Electrocardiogram (ECG) is sampled at frequency $f_{s}$ to detect $R$-peaks and construct a sequence of beat-to-beat intervals ($RR$ intervals). High-Frequency (HF) heart rate variability (HRV) refers to fluctuations in the $RR$ series within the nominal band $0.15$–$0.40$ Hz associated with respiratory sinus arrhythmia. In HF spectral analysis, the $RR$ series is typically resampled to a uniform time grid, and aliasing must be avoided in the band of interest. The discrete sampling of ECG introduces timing quantization in detected $R$-peak times, which propagates as jitter to the $RR$ intervals.\n\nStarting from the Nyquist–Shannon sampling theorem and the definition of uniform quantization error, justify the choice of ECG sampling rate $f_{s}$ required to both (i) prevent aliasing when the $RR$ series is later uniformly resampled for HF-band analysis, and (ii) minimize timing jitter due to ECG sampling resolution. Assume the following modeling assumptions:\n- The HF band of interest is $0.15$–$0.40$ Hz.\n- Resampling of the $RR$ series for spectral analysis will use a strictly band-limited low-pass interpolation filter prior to uniform resampling.\n- Each detected $R$-peak time is quantized to the nearest ECG sample time, and the per-peak quantization error is uniformly distributed over the interval $\\left[-\\frac{T_{s}}{2}, \\frac{T_{s}}{2}\\right]$, where $T_{s} = \\frac{1}{f_{s}}$ is the ECG sampling period.\n- Quantization errors of successive $R$-peaks are independent.\n\nThen, derive from first principles an analytic expression for the root-mean-square (RMS) timing error in a single $RR$ interval due solely to ECG sampling quantization, and compute its value at $f_{s} = 250$ Hz. Express the final error in seconds and round your answer to four significant figures.",
            "solution": "The problem consists of two parts. First, to justify the choice of ECG sampling rate, $f_{s}$, based on aliasing and timing jitter considerations. Second, to derive an expression for the root-mean-square (RMS) timing error in an $RR$ interval and compute its value for a given $f_s$.\n\nPart 1: Justification for the choice of ECG sampling rate $f_s$.\n\nThe choice of a sufficiently high ECG sampling rate $f_s$ is critical for two primary reasons that align with the problem's requirements.\n\n(i) Prevention of Aliasing: The problem requires preventing aliasing in the High-Frequency (HF) band of interest, defined as $0.15$–$0.40$ Hz. According to the Nyquist-Shannon sampling theorem, to avoid aliasing when sampling a signal, the sampling frequency must be strictly greater than twice the maximum frequency component in the signal ($f_{\\text{sample}} > 2f_{\\text{max}}$). The signal being analyzed for HRV is the sequence of $RR$ intervals. This sequence is typically resampled onto a uniform time grid at a frequency $f_{\\text{resample}}$. To analyze spectral content up to $f_{\\text{max,HRV}} = 0.40$ Hz without aliasing, this resampling frequency must satisfy $f_{\\text{resample}} > 2 \\times 0.40 \\text{ Hz} = 0.8$ Hz.\n\nWhile the ECG sampling rate $f_s$ does not directly set $f_{\\text{resample}}$, it is a crucial prerequisite for the validity of the entire analysis. The $RR$ intervals are derived from the locations of $R$-peaks in the ECG signal. The ECG waveform itself, particularly the QRS complex which contains the $R$-peak, has significant frequency components extending to $100$ Hz and beyond. To accurately represent the morphology of the QRS complex and thus precisely locate the $R$-peak, the ECG signal must be sampled at a rate $f_s$ high enough to prevent aliasing of the ECG signal itself. If $f_s$ is too low, the QRS complex will be distorted, leading to systematic errors in $R$-peak detection that are far more severe than simple quantization jitter. Therefore, a high $f_s$ (typically $\\geq 250$ Hz) is necessary to ensure the integrity of the raw data from which the $RR$ series is constructed. This prevents corruption of the $RR$ interval data before the HRV-specific resampling and spectral analysis are even performed.\n\n(ii) Minimization of Timing Jitter: The discrete nature of ECG sampling introduces a quantization error in the time domain. The true time of an $R$-peak can occur at any point, but it is detected and recorded at the time of the nearest sample. This creates a timing error, or jitter. The problem states this error is uniformly distributed in the interval $\\left[-\\frac{T_{s}}{2}, \\frac{T_{s}}{2}\\right]$, where $T_s = 1/f_s$ is the ECG sampling period. The magnitude of this timing error is directly proportional to the sampling period $T_s$. To minimize this error, one must minimize $T_s$. Since $T_s = 1/f_s$, minimizing $T_s$ is equivalent to maximizing the sampling frequency $f_s$. A higher sampling rate $f_s$ provides a finer time grid, reducing the maximum possible quantization error and, consequently, the overall variance of the timing jitter in the detected $R$-peak locations. This jitter propagates into the calculated $RR$ intervals, appearing as broadband noise in the HRV spectrum. Reducing this noise floor by choosing a high $f_s$ is essential for accurately quantifying the physiological low-amplitude signals in the HF band.\n\nIn summary, a high $f_s$ is chosen to ensure the underlying ECG signal is accurately captured for reliable $R$-peak detection and to directly minimize the time quantization error that manifests as noise in the derived $RR$ interval series.\n\nPart 2: Derivation and computation of RMS timing error.\n\nLet the true, continuous-time locations of two successive $R$-peaks be $t_{i}$ and $t_{i+1}$. The true $RR$ interval is $RR_{\\text{true}} = t_{i+1} - t_{i}$.\nThe corresponding measured times, quantized to the nearest sample, are $\\hat{t}_i$ and $\\hat{t}_{i+1}$. The measured $RR$ interval is $\\widehat{RR} = \\hat{t}_{i+1} - \\hat{t}_i$.\nThe quantization error for a single peak is a random variable $e_k = \\hat{t}_k - t_k$. The problem states that $e_k$ is uniformly distributed over the interval $[-\\frac{T_s}{2}, \\frac{T_s}{2}]$, where $T_s = 1/f_s$.\n\nThe error in a single $RR$ interval, $E_{RR}$, is the difference between the measured and true intervals:\n$$E_{RR} = \\widehat{RR} - RR_{\\text{true}} = (\\hat{t}_{i+1} - \\hat{t}_i) - (t_{i+1} - t_i) = (\\hat{t}_{i+1} - t_{i+1}) - (\\hat{t}_i - t_i) = e_{i+1} - e_i$$\nWe need to find the root-mean-square (RMS) value of $E_{RR}$, which is defined as $\\sqrt{\\mathrm{E}[E_{RR}^2]}$, where $\\mathrm{E}[\\cdot]$ is the expectation operator.\n\nFirst, let's find the mean and variance of the single-peak quantization error, $e_k$. For a random variable $X$ uniformly distributed on $[a, b]$, the mean is $\\mathrm{E}[X] = \\frac{a+b}{2}$ and the variance is $\\mathrm{Var}(X) = \\frac{(b-a)^2}{12}$.\nFor $e_k$, we have $a = -T_s/2$ and $b = T_s/2$.\nThe mean of the error is:\n$$\\mathrm{E}[e_k] = \\frac{-\\frac{T_s}{2} + \\frac{T_s}{2}}{2} = 0$$\nThe variance of the error is:\n$$\\mathrm{Var}(e_k) = \\frac{(\\frac{T_s}{2} - (-\\frac{T_s}{2}))^2}{12} = \\frac{T_s^2}{12}$$\n\nNow, we analyze the $RR$ interval error, $E_{RR} = e_{i+1} - e_i$.\nThe mean of the $RR$ interval error is:\n$$\\mathrm{E}[E_{RR}] = \\mathrm{E}[e_{i+1} - e_i] = \\mathrm{E}[e_{i+1}] - \\mathrm{E}[e_i] = 0 - 0 = 0$$\nThe variance of the $RR$ interval error is $\\mathrm{Var}(E_{RR})$. The problem states that the quantization errors of successive $R$-peaks are independent. For independent random variables, the variance of their difference is the sum of their variances:\n$$\\mathrm{Var}(E_{RR}) = \\mathrm{Var}(e_{i+1} - e_i) = \\mathrm{Var}(e_{i+1}) + \\mathrm{Var}(e_i)$$\nSince $e_i$ and $e_{i+1}$ are identically distributed, they have the same variance:\n$$\\mathrm{Var}(E_{RR}) = \\frac{T_s^2}{12} + \\frac{T_s^2}{12} = \\frac{2T_s^2}{12} = \\frac{T_s^2}{6}$$\nThe RMS value is $\\sqrt{\\mathrm{E}[E_{RR}^2]}$. For a random variable $X$ with mean $\\mu_X$, we have $\\mathrm{Var}(X) = \\mathrm{E}[X^2] - (\\mathrm{E}[X])^2$.\nSince $\\mathrm{E}[E_{RR}] = 0$, the variance is equal to the mean square value: $\\mathrm{Var}(E_{RR}) = \\mathrm{E}[E_{RR}^2]$.\nTherefore, the RMS error is the square root of the variance:\n$$\\text{RMS}(E_{RR}) = \\sqrt{\\mathrm{Var}(E_{RR})} = \\sqrt{\\frac{T_s^2}{6}} = \\frac{T_s}{\\sqrt{6}}$$\nThis is the required analytic expression for the RMS timing error in a single $RR$ interval. Substituting $T_s = 1/f_s$, the expression is $\\frac{1}{f_s\\sqrt{6}}$.\n\nNow, we compute this value for an ECG sampling rate of $f_s = 250$ Hz.\nThe sampling period is $T_s = \\frac{1}{f_s} = \\frac{1}{250} \\text{ s} = 0.004$ s.\nSubstituting this value into the RMS error expression:\n$$\\text{RMS}(E_{RR}) = \\frac{0.004}{\\sqrt{6}} \\text{ s}$$\nNumerically, this is:\n$$\\text{RMS}(E_{RR}) \\approx \\frac{0.004}{2.44948974...} \\text{ s} \\approx 0.00163299... \\text{ s}$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\\text{RMS}(E_{RR}) \\approx 0.001633 \\text{ s}$$\nIn scientific notation, this is $1.633 \\times 10^{-3}$ s.",
            "answer": "$$\\boxed{1.633 \\times 10^{-3}}$$"
        },
        {
            "introduction": "Once a high-quality beat-to-beat interval series is obtained, a primary goal is often to analyze its power spectral density (PSD) to quantify oscillations in different frequency bands. This practice moves from data acquisition to the design of the analysis itself, addressing a crucial question: how much data is needed to obtain a reliable estimate? You will derive the relationship between recording duration and the statistical precision of a power estimate, using the advanced and robust Thomson multitaper method as a framework .",
            "id": "3906284",
            "problem": "A uniformly resampled tachogram $x(t)$ (instantaneous heart period time series) from a healthy adult at rest is modeled as a zero-mean, wide-sense stationary Gaussian process with power spectral density (PSD). The High-Frequency (HF) band for heart rate variability (HRV) is defined as $[0.15, 0.40]~\\mathrm{Hz}$. You will estimate the HF band power by integrating a nonparametric PSD estimate obtained from the Thomson multitaper method (MTM) with time-halfbandwidth product $NW$ and $K$ Slepian tapers.\n\nAssume the following scientifically realistic conditions:\n- The tachogram has a dominant respiratory sinus arrhythmia component that makes the PSD within the HF band approximately flat after MTM smoothing at scale $W$, and there is additive white measurement noise whose level is at least $20~\\mathrm{dB}$ below the HF plateau. You may treat the combined PSD within the HF band as approximately constant at scale $W$.\n- The Thomson multitaper spectral estimates at frequencies separated by at least the half-bandwidth $W$ are approximately independent and identically distributed after appropriate normalization.\n- The HF band width is $B = 0.40 - 0.15 = 0.25~\\mathrm{Hz}$.\n- You will use $NW = 3$ and $K = 2NW - 1 = 5$ tapers.\n\nUsing only foundational properties of PSD estimators and their sampling variability, derive from first principles an expression for the coefficient of variation (relative standard deviation) of the HF band power estimate as a function of the segment length $T$ and the MTM parameters. Then, compute the minimum segment length $T_{\\min}$ that guarantees a relative standard deviation no larger than $\\varepsilon = 0.10$ for the HF power estimate under the assumptions above. Round your answer to three significant figures. Express the segment length in seconds.",
            "solution": "The true power in the High-Frequency (HF) band, $P_{HF}$, is the integral of the true Power Spectral Density (PSD), $S(f)$, over the band's frequency range, $[f_L, f_H]$, where $f_L = 0.15~\\mathrm{Hz}$ and $f_H = 0.40~\\mathrm{Hz}$.\n$$ P_{HF} = \\int_{f_L}^{f_H} S(f) df $$\nThe bandwidth is $B = f_H - f_L = 0.25~\\mathrm{Hz}$. Based on the assumption that the PSD is approximately constant within this band, we can write $S(f) \\approx S_{HF}$ for $f \\in [f_L, f_H]$. Thus, the true power is:\n$$ P_{HF} \\approx S_{HF} \\int_{f_L}^{f_H} df = S_{HF} \\cdot B $$\nThe estimate of the HF power, $\\hat{P}_{HF}$, is obtained by integrating the estimated PSD, $\\hat{S}(f)$:\n$$ \\hat{P}_{HF} = \\int_{f_L}^{f_H} \\hat{S}(f) df $$\nThe Thomson multitaper method (MTM) is used to obtain $\\hat{S}(f)$. A key property of MTM is its spectral resolution, which is related to the half-bandwidth $W$. The parameter $W$ is determined by the time-halfbandwidth product $NW$ and the segment length $T$:\n$$ W = \\frac{NW}{T} $$\nThe problem states that MTM spectral estimates at frequencies separated by at least $W$ are approximately independent. We can therefore discretize the integral for $\\hat{P}_{HF}$ by summing the estimates from approximately independent frequency bins of width $W$. The number of such independent bins, $M$, within the total bandwidth $B$ is:\n$$ M = \\frac{B}{W} = \\frac{B T}{NW} $$\nThe integrated power estimate can be approximated by a sum:\n$$ \\hat{P}_{HF} \\approx W \\sum_{i=1}^{M} \\hat{S}(f_i) $$\nwhere $f_i$ are representative frequencies for each of the $M$ bins.\n\nFor a WSS Gaussian process, a fundamental result of MTM spectral estimation is that for a locally flat spectrum $S(f)$, the normalized spectral estimate using $K$ tapers follows a chi-squared distribution with $2K$ degrees of freedom:\n$$ \\frac{2K \\hat{S}(f)}{S(f)} \\sim \\chi^2_{2K} $$\nFrom the properties of the $\\chi^2_{\\nu}$ distribution, where the mean is $\\nu$ and the variance is $2\\nu$, we can find the mean and variance of our estimator $\\hat{S}(f)$.\nThe mean is:\n$$ E\\left[\\frac{2K \\hat{S}(f)}{S(f)}\\right] = 2K \\implies \\frac{2K}{S(f)}E[\\hat{S}(f)] = 2K \\implies E[\\hat{S}(f)] = S(f) $$\nThe MTM estimator is unbiased. In our case, $E[\\hat{S}(f_i)] = S_{HF}$ for all $i$.\nThe variance is:\n$$ \\text{Var}\\left(\\frac{2K \\hat{S}(f)}{S(f)}\\right) = 2(2K) = 4K \\implies \\left(\\frac{2K}{S(f)}\\right)^2 \\text{Var}(\\hat{S}(f)) = 4K $$\n$$ \\text{Var}(\\hat{S}(f)) = \\frac{4K S(f)^2}{(2K)^2} = \\frac{S(f)^2}{K} $$\nFor our case, $\\text{Var}(\\hat{S}(f_i)) = S_{HF}^2/K$.\n\nNow, we find the mean and variance of the integrated power estimate $\\hat{P}_{HF}$.\n$$ E[\\hat{P}_{HF}] = E\\left[W \\sum_{i=1}^{M} \\hat{S}(f_i)\\right] = W \\sum_{i=1}^{M} E[\\hat{S}(f_i)] = W \\sum_{i=1}^{M} S_{HF} = W M S_{HF} $$\nSubstituting $M = B/W$, we get:\n$$ E[\\hat{P}_{HF}] = W \\left(\\frac{B}{W}\\right) S_{HF} = B S_{HF} = P_{HF} $$\nThe integrated power estimate is also unbiased.\n\nFor the variance, we use the assumption that the estimates $\\hat{S}(f_i)$ are independent:\n$$ \\text{Var}(\\hat{P}_{HF}) = \\text{Var}\\left(W \\sum_{i=1}^{M} \\hat{S}(f_i)\\right) = W^2 \\sum_{i=1}^{M} \\text{Var}(\\hat{S}(f_i)) $$\nThe individual variances are identical, so:\n$$ \\text{Var}(\\hat{P}_{HF}) = W^2 M \\cdot \\text{Var}(\\hat{S}(f_i)) = W^2 M \\frac{S_{HF}^2}{K} $$\nSubstituting $M = B/W$:\n$$ \\text{Var}(\\hat{P}_{HF}) = W^2 \\left(\\frac{B}{W}\\right) \\frac{S_{HF}^2}{K} = \\frac{W B S_{HF}^2}{K} $$\n\nThe coefficient of variation (CV), or relative standard deviation, is the ratio of the standard deviation to the mean:\n$$ \\text{CV}(\\hat{P}_{HF}) = \\frac{\\sqrt{\\text{Var}(\\hat{P}_{HF})}}{E[\\hat{P}_{HF}]} = \\frac{\\sqrt{\\frac{W B S_{HF}^2}{K}}}{B S_{HF}} = \\frac{S_{HF} \\sqrt{\\frac{W B}{K}}}{B S_{HF}} = \\frac{1}{B} \\sqrt{\\frac{W B}{K}} = \\sqrt{\\frac{W}{KB}} $$\nTo express this in terms of the segment length $T$, we substitute $W = NW/T$:\n$$ \\text{CV}(\\hat{P}_{HF}) = \\sqrt{\\frac{NW/T}{KB}} = \\sqrt{\\frac{NW}{KBT}} $$\nThis is the desired expression for the relative standard deviation as a function of $T$ and MTM parameters.\n\nWe are tasked to find the minimum segment length $T_{\\min}$ that guarantees a relative standard deviation no larger than $\\varepsilon = 0.10$. We set up the inequality:\n$$ \\sqrt{\\frac{NW}{KBT}} \\le \\varepsilon $$\nSquaring both sides and solving for $T$:\n$$ \\frac{NW}{KBT} \\le \\varepsilon^2 \\implies T \\ge \\frac{NW}{KB\\varepsilon^2} $$\nThe minimum segment length is therefore:\n$$ T_{\\min} = \\frac{NW}{KB\\varepsilon^2} $$\nNow, we substitute the given numerical values:\n- $NW = 3$\n- $K = 5$\n- $B = 0.25~\\mathrm{s}^{-1}$\n- $\\varepsilon = 0.10$\n\n$$ T_{\\min} = \\frac{3}{5 \\times 0.25 \\times (0.10)^2} = \\frac{3}{5 \\times 0.25 \\times 0.01} $$\n$$ T_{\\min} = \\frac{3}{1.25 \\times 0.01} = \\frac{3}{0.0125} $$\nTo compute the final value:\n$$ T_{\\min} = \\frac{3}{\\frac{1}{80}} = 3 \\times 80 = 240 $$\nThe units are seconds, as $B$ is in $\\mathrm{Hz} = \\mathrm{s}^{-1}$ and all other quantities in the fraction are dimensionless. The minimum segment length is $240~\\mathrm{s}$. The problem asks to round to three significant figures, and $240$ is already presented as such in this context.",
            "answer": "$$\\boxed{240}$$"
        },
        {
            "introduction": "Beyond analyzing the heart's rhythm in isolation, we can gain deeper physiological insight by examining its coupling with other bodily systems, most notably respiration. This final practice applies spectral analysis techniques to a bivariate problem, quantifying the strength of respiratory sinus arrhythmia (RSA). You will first derive the mathematical definition of coherence from first principles and then implement a computational analysis to measure this coupling in simulated data, providing a direct link between theory and practical application .",
            "id": "3906314",
            "problem": "You are tasked with formalizing and computing a frequency-domain coupling measure between a respiratory signal and an interbeat-interval series relevant to heart rate variability analysis in biomedical systems modeling. The goal is to define a dimensionless measure of linear association across frequency, denoted $C_{xy}(f)$, between a respiratory signal $x(t)$ and an interbeat-interval (respiratory sinus arrhythmia related) signal $y(t)$, and then to compute and interpret this measure in the high-frequency band associated with Respiratory Sinus Arrhythmia (RSA). Begin from first principles using the definitions of cross-correlation and the Fourier transform, and the notion of spectral density derived from those definitions. You must not assume any shortcut formulas. Your derivation must be anchored in the following base definitions:\n- The cross-correlation $R_{xy}(\\tau)$ is defined as the expected value of the time-shifted product, $R_{xy}(\\tau) = \\mathbb{E}[x(t)\\,y(t+\\tau)]$.\n- The power spectral density is defined from the Fourier transform of the autocorrelation, and the cross-spectral density is defined from the Fourier transform of the cross-correlation.\n- The Fourier transform uses angles in radians, and frequency is in hertz, so the argument is $2\\pi f t$.\n\nAfter completing the derivation to a normalized frequency-domain association measure $C_{xy}(f)$ that is bounded between $0$ and $1$, implement a program to compute it using discrete-time estimators grounded in the same principles. Specifically:\n- The program must compute the magnitude-squared coherence $C_{xy}(f)$ using estimators consistent with the above derivation and with windowed, averaged periodograms (Welch’s method) for the auto- and cross-spectral densities.\n- Interpret the strength of respiratory sinus arrhythmia by averaging $C_{xy}(f)$ over the high-frequency band $[0.15,\\,0.40]$ in hertz; the resulting average is a real number between $0$ and $1$, where larger values indicate stronger RSA coupling.\n\nSignals and units:\n- Treat $x(t)$ as a uniformly sampled respiration time series and $y(t)$ as a uniformly sampled interbeat-interval time series (tachogram). Time is in seconds, frequency is in hertz, angles in the sinusoidal arguments are in radians, and $C_{xy}(f)$ is dimensionless.\n- Use a sampling frequency $f_s$ (in hertz) and duration $T$ (in seconds) to construct $N = \\lfloor f_s T \\rfloor$ samples with sampling interval $\\Delta t = 1/f_s$.\n- The respiratory signal is modeled as $x(t) = A_r \\sin(2\\pi f_r t) + \\eta_x(t)$.\n- The interbeat-interval signal is modeled as $y(t) = RR_0 + k \\sin(2\\pi f_r t + \\phi) + \\eta_y(t)$, where $RR_0$ is a baseline interval in seconds, $k$ is a coupling strength (seconds), and $\\phi$ is a phase offset in radians. Let $\\phi = 0$.\n- The noise terms $\\eta_x(t)$ and $\\eta_y(t)$ are independent zero-mean Gaussian white noises with standard deviations $\\sigma_x$ and $\\sigma_y$, respectively.\n\nAlgorithmic requirements:\n- Use windowed, overlapped segment averaging (Welch’s method) with a Hann window for spectral estimation.\n- Ensure frequency resolution sufficient to resolve the high-frequency band $[0.15,\\,0.40]$ hertz; angles are in radians.\n- Compute $C_{xy}(f)$ consistent with your derivation, and then compute the average of $C_{xy}(f)$ over the high-frequency band.\n\nTest suite:\nUse the following parameter sets to construct signals and compute the averaged high-frequency coherence. For each case, set $f_s = 4$ (hertz), and use independent random seeds as specified for reproducibility.\n1. Happy path RSA case: $T = 300$, $A_r = 1.0$, $f_r = 0.25$, $RR_0 = 0.80$, $k = 0.12$, $\\sigma_x = 0.05$, $\\sigma_y = 0.02$, seed $= 42$.\n2. No coupling case: $T = 300$, $A_r = 1.0$, $f_r = 0.25$, $RR_0 = 0.80$, $k = 0.00$, $\\sigma_x = 0.05$, $\\sigma_y = 0.02$, seed $= 43$.\n3. Boundary high-frequency RSA case: $T = 300$, $A_r = 1.0$, $f_r = 0.40$, $RR_0 = 0.80$, $k = 0.12$, $\\sigma_x = 0.05$, $\\sigma_y = 0.02$, seed $= 44$.\n4. Low-frequency respiration coupling case: $T = 300$, $A_r = 1.0$, $f_r = 0.10$, $RR_0 = 0.80$, $k = 0.12$, $\\sigma_x = 0.05$, $\\sigma_y = 0.02$, seed $= 45$.\n\nOutput specification:\n- For each test case, compute the average of $C_{xy}(f)$ over the band $[0.15,\\,0.40]$ hertz and return it as a float.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each value rounded to three decimal places, for example, $[r_1,r_2,r_3,r_4]$ where each $r_i$ is the averaged high-frequency coherence for the $i$-th test case.",
            "solution": "### Derivation of the Magnitude-Squared Coherence\n\nWe begin from the first principles as stipulated for two jointly wide-sense stationary random processes, $x(t)$ and $y(t)$.\n\nThe cross-correlation function between $x(t)$ and $y(t)$ is defined as:\n$$ R_{xy}(\\tau) = \\mathbb{E}[x(t) y(t+\\tau)] $$\nwhere $\\mathbb{E}[\\cdot]$ denotes the expectation operator and $\\tau$ is the time lag. The autocorrelation functions are special cases:\n$$ R_{xx}(\\tau) = \\mathbb{E}[x(t) x(t+\\tau)] $$\n$$ R_{yy}(\\tau) = \\mathbb{E}[y(t) y(t+\\tau)] $$\n\nThe Wiener-Khinchin theorem relates the correlation functions to the spectral density functions via the Fourier transform. The cross-spectral density, $S_{xy}(f)$, is the Fourier transform of the cross-correlation function:\n$$ S_{xy}(f) = \\mathcal{F}\\{R_{xy}(\\tau)\\} = \\int_{-\\infty}^{\\infty} R_{xy}(\\tau) e^{-i 2\\pi f \\tau} d\\tau $$\nSimilarly, the power spectral densities (PSDs), $S_{xx}(f)$ and $S_{yy}(f)$, are the Fourier transforms of their respective autocorrelation functions:\n$$ S_{xx}(f) = \\mathcal{F}\\{R_{xx}(\\tau)\\} = \\int_{-\\infty}^{\\infty} R_{xx}(\\tau) e^{-i 2\\pi f \\tau} d\\tau $$\n$$ S_{yy}(f) = \\mathcal{F}\\{R_{yy}(\\tau)\\} = \\int_{-\\infty}^{\\infty} R_{yy}(\\tau) e^{-i 2\\pi f \\tau} d\\tau $$\n\nThe PSDs $S_{xx}(f)$ and $S_{yy}(f)$ are real-valued and non-negative, representing the distribution of power of the signals over frequency. The cross-spectral density $S_{xy}(f)$ is, in general, a complex function. Its magnitude indicates the extent to which $x(t)$ and $y(t)$ are correlated at frequency $f$, and its phase indicates the phase lag between the signals at that frequency.\n\nTo obtain a dimensionless measure of linear association, we normalize the cross-spectral density. This leads to the definition of the complex coherence function, $\\gamma_{xy}(f)$:\n$$ \\gamma_{xy}(f) = \\frac{S_{xy}(f)}{\\sqrt{S_{xx}(f) S_{yy}(f)}} $$\n\nThe most commonly used measure is the magnitude-squared coherence (MSC), denoted here as $C_{xy}(f)$, which is a real-valued function:\n$$ C_{xy}(f) = |\\gamma_{xy}(f)|^2 = \\frac{|S_{xy}(f)|^2}{S_{xx}(f) S_{yy}(f)} $$\n\nTo prove that $C_{xy}(f)$ is bounded between $0$ and $1$, we rely on a property equivalent to the Cauchy-Schwarz inequality. Consider an arbitrary complex constant $\\alpha$. The power spectral density of the combined process $x(t) - \\alpha y(t)$ must be non-negative for all frequencies $f$:\n$$ S_{x-\\alpha y, x-\\alpha y}(f) \\ge 0 $$\nExpanding this expression using the linearity of the expectation and Fourier transform operators, we have:\n$$ S_{x-\\alpha y, x-\\alpha y}(f) = S_{xx}(f) - \\alpha S_{yx}(f) - \\alpha^* S_{xy}(f) + |\\alpha|^2 S_{yy}(f) \\ge 0 $$\nNote that $S_{yx}(f) = S_{xy}^*(f)$. Therefore, the expression becomes:\n$$ S_{xx}(f) - \\alpha S_{xy}^*(f) - \\alpha^* S_{xy}(f) + |\\alpha|^2 S_{yy}(f) \\ge 0 $$\nThis inequality must hold for any choice of complex $\\alpha$. We choose a specific $\\alpha$ to maximize the information gained. Let $\\alpha = \\frac{S_{xy}(f)}{S_{yy}(f)}$. Substituting this into the inequality (assuming $S_{yy}(f) > 0$):\n$$ S_{xx}(f) - \\frac{S_{xy}(f)}{S_{yy}(f)} S_{xy}^*(f) - \\frac{S_{xy}^*(f)}{S_{yy}(f)} S_{xy}(f) + \\frac{|S_{xy}(f)|^2}{S_{yy}(f)^2} S_{yy}(f) \\ge 0 $$\n$$ S_{xx}(f) - \\frac{|S_{xy}(f)|^2}{S_{yy}(f)} - \\frac{|S_{xy}(f)|^2}{S_{yy}(f)} + \\frac{|S_{xy}(f)|^2}{S_{yy}(f)} \\ge 0 $$\n$$ S_{xx}(f) - \\frac{|S_{xy}(f)|^2}{S_{yy}(f)} \\ge 0 $$\nRearranging the terms, we get:\n$$ S_{xx}(f) S_{yy}(f) \\ge |S_{xy}(f)|^2 $$\nSince PSDs are non-negative, we can divide by the product $S_{xx}(f)S_{yy}(f)$ (assuming it is non-zero) without changing the inequality's direction:\n$$ 1 \\ge \\frac{|S_{xy}(f)|^2}{S_{xx}(f) S_{yy}(f)} $$\nThe left side of the definition of $C_{xy}(f)$ is a squared magnitude divided by non-negative values, so it must be non-negative. Combining these results, we confirm the bounds:\n$$ 0 \\le C_{xy}(f) \\le 1 $$\nThis completes the derivation. $C_{xy}(f)$ provides a normalized measure of the linear coupling between two signals at each frequency $f$. A value of $1$ indicates perfect linear correlation, while a value of $0$ indicates no linear correlation at that frequency.\n\n### Computational Implementation\n\nThe program will implement the computation of $C_{xy}(f)$ and its average over the HF band for the given test cases.\n\n1.  **Signal Generation**: For each test case, discrete-time signals $x[n]$ and $y[n]$ are generated according to the specified models. A time vector is created from $t=0$ to $T$ with a step of $\\Delta t=1/f_s$. Noise is generated using a reproducible random number generator seeded for each case. The DC term $RR_0$ in $y(t)$ is handled by the spectral estimation function.\n\n2.  **Spectral Estimation (Welch's Method)**: The `scipy.signal.coherence` function is used. This function internally estimates the PSDs ($S_{xx}, S_{yy}$) and the cross-spectral density ($S_{xy}$) by:\n    a. Dividing the signals into overlapping segments.\n    b. Applying a window function (Hann window, as specified) to each segment to reduce spectral leakage.\n    c. Computing the squared-magnitude FFT for PSDs and the conjugate product for the CSD for each segment.\n    d. Averaging these spectral estimates across all segments. This averaging reduces the variance of the final estimate.\n    The function then computes $C_{xy}(f)$ according to the derived formula. A segment length (`nperseg`) of $256$ is chosen to provide a frequency resolution of $f_s/\\text{nperseg} = 4/256 \\approx 0.0156$ Hz, which is adequate for the specified band. An overlap of $50\\%$ (`noverlap=128`) is used, which is a common choice.\n\n3.  **Band Averaging**: The output of the coherence function is a vector of coherence values and a corresponding vector of frequencies. The program identifies the indices corresponding to frequencies within the HF band $[0.15, 0.40]$ Hz. The mean of the coherence values at these indices is then calculated, yielding a single scalar value that quantifies the strength of RSA.\n\n4.  **Iteration and Output**: The process is repeated for all four test cases. The resulting average coherence values are collected and formatted into the required string output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import signal\n\ndef solve():\n    \"\"\"\n    Solves the problem of computing high-frequency coherence for four test cases.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1: Happy path RSA\n        {'T': 300, 'Ar': 1.0, 'fr': 0.25, 'RR0': 0.80, 'k': 0.12, 'sigma_x': 0.05, 'sigma_y': 0.02, 'seed': 42, 'fs': 4.0},\n        # Case 2: No coupling\n        {'T': 300, 'Ar': 1.0, 'fr': 0.25, 'RR0': 0.80, 'k': 0.00, 'sigma_x': 0.05, 'sigma_y': 0.02, 'seed': 43, 'fs': 4.0},\n        # Case 3: Boundary high-frequency RSA\n        {'T': 300, 'Ar': 1.0, 'fr': 0.40, 'RR0': 0.80, 'k': 0.12, 'sigma_x': 0.05, 'sigma_y': 0.02, 'seed': 44, 'fs': 4.0},\n        # Case 4: Low-frequency respiration coupling\n        {'T': 300, 'Ar': 1.0, 'fr': 0.10, 'RR0': 0.80, 'k': 0.12, 'sigma_x': 0.05, 'sigma_y': 0.02, 'seed': 45, 'fs': 4.0},\n    ]\n\n    results = []\n\n    def compute_hf_coherence(params):\n        \"\"\"\n        Generates signals and computes the average high-frequency coherence.\n        \"\"\"\n        # Unpack parameters\n        T = params['T']\n        Ar = params['Ar']\n        fr = params['fr']\n        RR0 = params['RR0']\n        k = params['k']\n        sigma_x = params['sigma_x']\n        sigma_y = params['sigma_y']\n        seed = params['seed']\n        fs = params['fs']\n\n        # Set up a random number generator for reproducibility\n        rng = np.random.default_rng(seed)\n\n        # Generate time vector\n        N = int(fs * T)\n        t = np.arange(N) / fs\n\n        # Generate noise signals\n        eta_x = rng.normal(0, sigma_x, N)\n        eta_y = rng.normal(0, sigma_y, N)\n\n        # Generate respiration and interbeat-interval signals\n        # x(t) = A_r * sin(2*pi*f_r*t) + eta_x(t)\n        x = Ar * np.sin(2 * np.pi * fr * t) + eta_x\n        # y(t) = RR_0 + k * sin(2*pi*f_r*t) + eta_y(t), phase phi=0\n        y = RR0 + k * np.sin(2 * np.pi * fr * t) + eta_y\n\n        # Define spectral estimation parameters for Welch's method\n        # nperseg determines frequency resolution. res = fs/nperseg = 4/256 = 0.015625 Hz\n        nperseg = 256\n        noverlap = nperseg // 2 # 50% overlap\n\n        # Compute magnitude-squared coherence using Welch's method\n        # The detrend='constant' argument (default) correctly handles the RR0 mean offset in y(t).\n        frequencies, Cxy = signal.coherence(x, \n                                             y, \n                                             fs=fs, \n                                             window='hann', \n                                             nperseg=nperseg, \n                                             noverlap=noverlap)\n\n        # Define high-frequency band for RSA\n        hf_band_low = 0.15\n        hf_band_high = 0.40\n\n        # Find indices of frequencies within the high-frequency band\n        hf_indices = np.where((frequencies >= hf_band_low) & (frequencies <= hf_band_high))\n        \n        # Extract coherence values in the HF band\n        hf_coherence = Cxy[hf_indices]\n        \n        # Compute the average coherence over the band\n        if len(hf_coherence) == 0:\n            return 0.0 # Should not happen with chosen parameters\n        \n        avg_hf_coherence = np.mean(hf_coherence)\n\n        return avg_hf_coherence\n\n    for case in test_cases:\n        result = compute_hf_coherence(case)\n        results.append(result)\n\n    # Format the final output string as specified, rounding to 3 decimal places\n    formatted_results = [f\"{r:.3f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}