{
    "hands_on_practices": [
        {
            "introduction": "Bergman最小模型是代谢建模领域的里程碑，它捕捉了葡萄糖和胰岛素之间至关重要的相互作用。掌握围绕空腹稳态对该模型进行线性的方法是一项基本技能。这项练习  提供了从第一原理推导状态空间矩阵 $A$、$B$、$C$ 和 $D$ 的直接实践，将一个复杂的非线性系统转化为一个易于处理的线性形式，以便进行局部稳定性和响应分析。",
            "id": "3897499",
            "problem": "考虑用于葡萄糖-胰岛素调节的经典Bergman最小模型，该模型被表述为一个质量平衡、非线性、连续时间的状态模型，用于描述血浆葡萄糖、远程胰岛素作用和血浆胰岛素。令 $G(t)$ 表示血浆葡萄糖浓度，单位为 $\\mathrm{mg}\\,\\mathrm{dL}^{-1}$；$X(t)$ 表示远程胰岛素作用，单位为 $\\mathrm{min}^{-1}$；$I(t)$ 表示血浆胰岛素浓度，单位为 $\\mu\\mathrm{U}\\,\\mathrm{mL}^{-1}$。令 $u_I(t)$ 表示外源胰岛素输注率，单位为 $\\mu\\mathrm{U}\\,\\mathrm{min}^{-1}$；令 $r(t)$ 表示血浆中外源葡萄糖的出现率，单位为 $\\mathrm{mg}\\,\\mathrm{dL}^{-1}\\,\\mathrm{min}^{-1}$。该模型为\n$$\n\\begin{aligned}\n\\frac{dG}{dt} = -\\big(p_1 + X\\big)\\,G + p_1\\,G_b + r(t), \\\\\n\\frac{dX}{dt} = -p_2\\,X + p_3\\big(I - I_b\\big), \\\\\n\\frac{dI}{dt} = -n\\big(I - I_b\\big) + s\\big(G - G_b\\big) + \\frac{1}{V_i}\\,u_I(t),\n\\end{aligned}\n$$\n其中 $G_b$ 和 $I_b$ 分别表示基础空腹葡萄糖和胰岛素水平，$p_1$、$p_2$、$p_3$、$n$、$s$ 和 $V_i$ 是正常数生理参数。假设在 $u_I(t)\\equiv 0$ 和 $r(t)\\equiv 0$ 的条件下，空腹稳态满足 $G(t)\\equiv G_b$，$X(t)\\equiv 0$，$I(t)\\equiv I_b$。定义状态向量 $z(t) = \\begin{pmatrix}G(t) & X(t) & I(t)\\end{pmatrix}^{\\mathsf{T}}$，输入向量 $u(t) = \\begin{pmatrix}u_I(t) & r(t)\\end{pmatrix}^{\\mathsf{T}}$，以及测量输出为葡萄糖偏差 $y(t) = G(t) - G_b$。\n\n使用第一性原理和关于空腹稳态 $z_0 = \\begin{pmatrix}G_b & 0 & I_b\\end{pmatrix}^{\\mathsf{T}}$（其中 $u_0=\\begin{pmatrix}0 & 0\\end{pmatrix}^{\\mathsf{T}}$）的一阶Taylor展开，推导线性时不变状态空间模型\n$$\n\\delta\\dot{z}(t) = A\\,\\delta z(t) + B\\,\\delta u(t), \\qquad y(t) = C\\,\\delta z(t) + D\\,\\delta u(t),\n$$\n通过计算定义矩阵 $A$、$B$、$C$ 和 $D$ 的雅可比矩阵，将它们用 $G_b$、$p_1$、$p_2$、$p_3$、$n$、$s$ 和 $V_i$ 明确表示。\n\n然后，代入以下生理上合理的参数值：\n$$\np_1 = 0.02~\\mathrm{min}^{-1},\\quad p_2 = 0.03~\\mathrm{min}^{-1},\\quad p_3 = 1.2\\times 10^{-4}~\\mathrm{min}^{-2}\\,(\\mu\\mathrm{U}\\,\\mathrm{mL}^{-1})^{-1},\n$$\n$\nn = 0.10~\\mathrm{min}^{-1},\\quad s = 5.0\\times 10^{-3}~\\mu\\mathrm{U}\\,\\mathrm{mL}^{-1}\\,\\mathrm{min}^{-1}\\,(\\mathrm{mg}\\,\\mathrm{dL}^{-1})^{-1},\\quad V_i = 1.2\\times 10^{4}~\\mathrm{mL},\\quad G_b = 90~\\mathrm{mg}\\,\\mathrm{dL}^{-1}.\n$\n\n最后，对于得到的线性化模型，计算从胰岛素输注输入 $u_I$ 到输出 $y$ 的稳态（零频率）增益，该增益定义为标量\n$$\nK \\equiv -\\,C\\,A^{-1}\\,b_{u_I},\n$$\n其中 $b_{u_I}$ 表示 $B$ 中对应于 $u_I$ 的列。以 $\\big(\\mathrm{mg}\\,\\mathrm{dL}^{-1}\\big)\\big/(\\mu\\mathrm{U}\\,\\mathrm{min}^{-1})$ 为单位表示 $K$ 的最终数值。无需四舍五入。",
            "solution": "用户希望分析用于葡萄糖-胰岛素调节的Bergman最小模型。\n\n### 第1步：提取已知条件\n- **状态变量**：$G(t)$ (血浆葡萄糖浓度, $\\mathrm{mg}\\,\\mathrm{dL}^{-1}$)，$X(t)$ (远程胰岛素作用, $\\mathrm{min}^{-1}$)，$I(t)$ (血浆胰岛素浓度, $\\mu\\mathrm{U}\\,\\mathrm{mL}^{-1}$)。\n- **输入变量**：$u_I(t)$ (外源胰岛素输注率, $\\mu\\mathrm{U}\\,\\mathrm{min}^{-1}$)，$r(t)$ (外源葡萄糖出现率, $\\mathrm{mg}\\,\\mathrm{dL}^{-1}\\,\\mathrm{min}^{-1}$)。\n- **非线性状态空间模型**：\n$$\n\\begin{aligned}\n\\frac{dG}{dt} = -\\big(p_1 + X\\big)\\,G + p_1\\,G_b + r(t) \\\\\n\\frac{dX}{dt} = -p_2\\,X + p_3\\big(I - I_b\\big) \\\\\n\\frac{dI}{dt} = -n\\big(I - I_b\\big) + s\\big(G - G_b\\big) + \\frac{1}{V_i}\\,u_I(t)\n\\end{aligned}\n$$\n- **参数**：$p_1, p_2, p_3, n, s, V_i$ 是正常数。$G_b, I_b$ 是基础水平。\n- **空腹稳态（平衡点）**：对于输入 $u_0 = \\begin{pmatrix}0 & 0\\end{pmatrix}^{\\mathsf{T}}$，稳态点为 $z_0 = \\begin{pmatrix}G_b & 0 & I_b\\end{pmatrix}^{\\mathsf{T}}$。\n- **向量定义**：$z(t) = \\begin{pmatrix}G(t) & X(t) & I(t)\\end{pmatrix}^{\\mathsf{T}}$，$u(t) = \\begin{pmatrix}u_I(t) & r(t)\\end{pmatrix}^{\\mathsf{T}}$。\n- **输出定义**：$y(t) = G(t) - G_b$。\n- **任务1**：通过计算矩阵 $A$, $B$, $C$, $D$ 推导线性化状态空间模型 $\\delta\\dot{z}(t) = A\\,\\delta z(t) + B\\,\\delta u(t)$ 和 $y(t) = C\\,\\delta z(t) + D\\,\\delta u(t)$。\n- **任务2**：代入给定的参数值：\n$p_1 = 0.02~\\mathrm{min}^{-1}$, $p_2 = 0.03~\\mathrm{min}^{-1}$, $p_3 = 1.2\\times 10^{-4}~\\mathrm{min}^{-2}\\,(\\mu\\mathrm{U}\\,\\mathrm{mL}^{-1})^{-1}$,\n$n = 0.10~\\mathrm{min}^{-1}$, $s = 5.0\\times 10^{-3}~\\mu\\mathrm{U}\\,\\mathrm{mL}^{-1}\\,\\mathrm{min}^{-1}\\,(\\mathrm{mg}\\,\\mathrm{dL}^{-1})^{-1}$, $V_i = 1.2\\times 10^{4}~\\mathrm{mL}$, $G_b = 90~\\mathrm{mg}\\,\\mathrm{dL}^{-1}$。\n- **任务3**：计算稳态增益 $K \\equiv -\\,C\\,A^{-1}\\,b_{u_I}$，其中 $b_{u_I}$ 是 $B$ 中对应于 $u_I$ 的列。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据**：Bergman最小模型是生物医学工程中用于葡萄糖-胰岛素动力学的经典且得到科学验证的模型。该问题具有科学合理性。\n- **适定性**：这些任务涉及非线性系统线性化和传递函数增益计算的标准程序，这些都是定义明确的数学运算。存在唯一解。\n- **客观性**：该问题以精确的数学语言表述，没有主观或模糊的术语。\n- **一致性检查**：我们必须验证所指定的空腹稳态是一个有效的平衡点。\n令 $\\dot{G}=0$，$\\dot{X}=0$，$\\dot{I}=0$ 且 $r=0$，$u_I=0$。\n对于状态 $z_0 = (G_b, 0, I_b)^{\\mathsf{T}}$：\n$\\dot{G} = -(p_1 + 0)G_b + p_1 G_b + 0 = -p_1 G_b + p_1 G_b = 0$。\n$\\dot{X} = -p_2(0) + p_3(I_b - I_b) = 0$。\n$\\dot{I} = -n(I_b - I_b) + s(G_b - G_b) + \\frac{1}{V_i}(0) = 0$。\n该点是一个有效的平衡点。所有信息都是自洽且一致的。\n\n### 第3步：结论与行动\n问题有效。将提供完整解法。\n\n### 解法推导\n\n线性化状态空间模型是通过计算系统动力学和输出方程在平衡点 $(z_0, u_0)$ 处的雅可比矩阵得到的。\n令系统动力学为 $\\dot{z} = f(z, u)$，输出为 $y = h(z, u)$。\n状态向量为 $z = \\begin{pmatrix} G \\\\ X \\\\ I \\end{pmatrix}$，输入向量为 $u = \\begin{pmatrix} u_I \\\\ r \\end{pmatrix}$。\n向量函数 $f$ 为：\n$$\nf(z, u) = \\begin{pmatrix}\nf_1(G,X,I,u_I,r) \\\\\nf_2(G,X,I,u_I,r) \\\\\nf_3(G,X,I,u_I,r)\n\\end{pmatrix}\n= \\begin{pmatrix}\n-(p_1 + X)G + p_1 G_b + r \\\\\n-p_2 X + p_3(I - I_b) \\\\\n-n(I - I_b) + s(G - G_b) + \\frac{1}{V_i} u_I\n\\end{pmatrix}\n$$\n输出函数 $h$ 为：\n$$\nh(z, u) = G - G_b\n$$\n线性化系统的矩阵由下式给出：\n$A = \\frac{\\partial f}{\\partial z}\\bigg|_{z_0, u_0}$，$B = \\frac{\\partial f}{\\partial u}\\bigg|_{z_0, u_0}$，$C = \\frac{\\partial h}{\\partial z}\\bigg|_{z_0, u_0}$，$D = \\frac{\\partial h}{\\partial u}\\bigg|_{z_0, u_0}$。\n\n计算点为 $z_0 = (G_b, 0, I_b)^{\\mathsf{T}}$ 和 $u_0 = (0, 0)^{\\mathsf{T}}$。\n\n**1. 计算状态矩阵 $A$：**\n$A = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial G} & \\frac{\\partial f_1}{\\partial X} & \\frac{\\partial f_1}{\\partial I} \\\\ \\frac{\\partial f_2}{\\partial G} & \\frac{\\partial f_2}{\\partial X} & \\frac{\\partial f_2}{\\partial I} \\\\ \\frac{\\partial f_3}{\\partial G} & \\frac{\\partial f_3}{\\partial X} & \\frac{\\partial f_3}{\\partial I} \\end{pmatrix}_{z_0, u_0}$\n偏导数为：\n$\\frac{\\partial f_1}{\\partial G} = -(p_1 + X) \\implies -p_1$\n$\\frac{\\partial f_1}{\\partial X} = -G \\implies -G_b$\n$\\frac{\\partial f_1}{\\partial I} = 0$\n$\\frac{\\partial f_2}{\\partial G} = 0$\n$\\frac{\\partial f_2}{\\partial X} = -p_2$\n$\\frac{\\partial f_2}{\\partial I} = p_3$\n$\\frac{\\partial f_3}{\\partial G} = s$\n$\\frac{\\partial f_3}{\\partial X} = 0$\n$\\frac{\\partial f_3}{\\partial I} = -n$\n\n因此，状态矩阵 $A$ 为：\n$$\nA = \\begin{pmatrix} -p_1 & -G_b & 0 \\\\ 0 & -p_2 & p_3 \\\\ s & 0 & -n \\end{pmatrix}\n$$\n\n**2. 计算输入矩阵 $B$：**\n$B = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial u_I} & \\frac{\\partial f_1}{\\partial r} \\\\ \\frac{\\partial f_2}{\\partial u_I} & \\frac{\\partial f_2}{\\partial r} \\\\ \\frac{\\partial f_3}{\\partial u_I} & \\frac{\\partial f_3}{\\partial r} \\end{pmatrix}_{z_0, u_0}$\n偏导数为：\n$\\frac{\\partial f_1}{\\partial u_I} = 0$, $\\frac{\\partial f_1}{\\partial r} = 1$\n$\\frac{\\partial f_2}{\\partial u_I} = 0$, $\\frac{\\partial f_2}{\\partial r} = 0$\n$\\frac{\\partial f_3}{\\partial u_I} = \\frac{1}{V_i}$, $\\frac{\\partial f_3}{\\partial r} = 0$\n\n因此，输入矩阵 $B$ 为：\n$$\nB = \\begin{pmatrix} 0 & 1 \\\\ 0 & 0 \\\\ \\frac{1}{V_i} & 0 \\end{pmatrix}\n$$\n\n**3. 计算输出矩阵 $C$：**\n输出为 $y = G - G_b$。用偏差变量 $\\delta G = G - G_b$，$\\delta X = X - 0$，$\\delta I = I - I_b$（其中 $\\delta z = (\\delta G, \\delta X, \\delta I)^{\\mathsf{T}}$）表示，我们有 $y = \\delta G$。\n所以，$y = \\begin{pmatrix} 1 & 0 & 0 \\end{pmatrix} \\begin{pmatrix} \\delta G \\\\ \\delta X \\\\ \\delta I \\end{pmatrix}$。\n这对应于 $C = \\frac{\\partial h}{\\partial z} = \\begin{pmatrix} \\frac{\\partial h}{\\partial G} & \\frac{\\partial h}{\\partial X} & \\frac{\\partial h}{\\partial I} \\end{pmatrix}_{z_0, u_0} = \\begin{pmatrix} 1 & 0 & 0 \\end{pmatrix}$。\n$$\nC = \\begin{pmatrix} 1 & 0 & 0 \\end{pmatrix}\n$$\n\n**4. 计算前馈矩阵 $D$：**\n$D = \\frac{\\partial h}{\\partial u} = \\begin{pmatrix} \\frac{\\partial h}{\\partial u_I} & \\frac{\\partial h}{\\partial r} \\end{pmatrix}_{z_0, u_0} = \\begin{pmatrix} 0 & 0 \\end{pmatrix}$。\n$$\nD = \\begin{pmatrix} 0 & 0 \\end{pmatrix}\n$$\n至此完成了线性化模型的推导。\n\n**5. 计算稳态增益 $K$：**\n问题将增益定义为 $K \\equiv -C A^{-1} b_{u_I}$。这是从输入 $u_I$ 到输出 $y$ 的传递函数的直流增益。令此增益为 $G_0 = y_{ss} / \\delta u_{I,ss}$。在稳态下（$\\delta\\dot{z} = 0$），线性化系统给出：\n$0 = A \\delta z_{ss} + B \\delta u_{ss}$。\n我们只考虑胰岛素输入，所以 $\\delta u_{ss} = (\\delta u_I, 0)^{\\mathsf{T}}$。$B$ 对应的列是 $b_{u_I} = (0, 0, 1/V_i)^{\\mathsf{T}}$。\n$A \\delta z_{ss} = -b_{u_I} \\delta u_I$。\n用分量形式写出，其中 $\\delta z_{ss} = (\\delta G, \\delta X, \\delta I)^{\\mathsf{T}}$：\n1) $-p_1 \\delta G - G_b \\delta X = 0$\n2) $-p_2 \\delta X + p_3 \\delta I = 0$\n3) $s \\delta G - n \\delta I = -\\frac{1}{V_i} \\delta u_I$\n\n从(1)式，我们有 $\\delta X = -\\frac{p_1}{G_b} \\delta G$。\n从(2)式，我们有 $\\delta I = \\frac{p_2}{p_3} \\delta X$。代入 $\\delta X$ 的表达式：\n$\\delta I = \\frac{p_2}{p_3} \\left(-\\frac{p_1}{G_b} \\delta G\\right) = -\\frac{p_1 p_2}{p_3 G_b} \\delta G$。\n\n现在，将 $\\delta I$ 的这个表达式代入(3)式：\n$s \\delta G - n \\left(-\\frac{p_1 p_2}{p_3 G_b} \\delta G\\right) = -\\frac{1}{V_i} \\delta u_I$\n$\\left(s + \\frac{n p_1 p_2}{p_3 G_b}\\right) \\delta G = -\\frac{1}{V_i} \\delta u_I$\n输出是 $y = \\delta G$。增益 $K$ 是比率 $y/\\delta u_I = \\delta G/\\delta u_I$。\n$K = \\frac{\\delta G}{\\delta u_I} = -\\frac{1}{V_i \\left(s + \\frac{n p_1 p_2}{p_3 G_b}\\right)}$\n化简表达式：\n$K = -\\frac{1}{V_i \\left(\\frac{s p_3 G_b + n p_1 p_2}{p_3 G_b}\\right)} = - \\frac{p_3 G_b}{V_i (p_1 p_2 n + s p_3 G_b)}$\n\n**6. 代入数值：**\n$p_1 = 0.02$\n$p_2 = 0.03$\n$p_3 = 1.2 \\times 10^{-4}$\n$n = 0.1$\n$s = 5.0 \\times 10^{-3}$\n$V_i = 1.2 \\times 10^{4}$\n$G_b = 90$\n\n计算 $K$ 公式中的各项：\n- 分子：$p_3 G_b = (1.2 \\times 10^{-4}) \\times 90 = 10.8 \\times 10^{-3} = 0.0108$。\n- 分母项 $p_1 p_2 n$：$(0.02) \\times (0.03) \\times (0.1) = (2 \\times 10^{-2}) \\times (3 \\times 10^{-2}) \\times (1 \\times 10^{-1}) = 6 \\times 10^{-5} = 0.00006$。\n- 分母项 $s p_3 G_b$：$(5.0 \\times 10^{-3}) \\times (0.0108) = 0.000054 = 5.4 \\times 10^{-5}$。\n- 分母括号内的和：$p_1 p_2 n + s p_3 G_b = 6 \\times 10^{-5} + 5.4 \\times 10^{-5} = 11.4 \\times 10^{-5} = 0.000114$。\n- 整个分母：$V_i (p_1 p_2 n + s p_3 G_b) = (1.2 \\times 10^{4}) \\times (11.4 \\times 10^{-5}) = 1.2 \\times 1.14 = 1.368$。\n\n最后，计算 $K$：\n$K = - \\frac{0.0108}{1.368}$\n为表示为精确分数：\n$K = - \\frac{108 \\times 10^{-4}}{1368 \\times 10^{-3}} = - \\frac{108}{13680} = - \\frac{54}{6840} = - \\frac{27}{3420} = - \\frac{9}{1140} = - \\frac{3}{380}$。\n增益 $K$ 的数值为 $-\\frac{3}{380}$。",
            "answer": "$$\n\\boxed{-\\frac{3}{380}}\n$$"
        },
        {
            "introduction": "线性化不仅仅是一种简化，它更是一种强大的分析工具，能够揭示系统在不同条件下的行为变化。本练习探讨了生物医学设备中一个常见的现实挑战：执行器饱和。通过在一个输液泵饱和的工作点对系统进行线性化，你将揭示一个关键且不直观的后果：局部可控性的完全丧失。这项练习  展示了线性化这一形式化过程如何为理解受控系统的操作极限提供严谨的见解。",
            "id": "3897427",
            "problem": "一种生物医学输液泵输送血管活性药物以调节患者的血流动力学。该患者-设备动态系统可以通过一个非线性双状态模型进行理想化，该模型捕捉了血浆药物浓度和具有受体饱和的下游效应室，而执行器（泵）则受到硬饱和的限制。设状态向量为 $x = \\begin{pmatrix} x_1 \\\\ x_2 \\end{pmatrix}$，其中 $x_1$ 是血浆药物浓度与目标值之间的偏差，$x_2$ 是效应部位变量的偏差。指令输注为 $u_{\\mathrm{cmd}}$，实际输注为 $u_{\\mathrm{act}} = \\mathrm{sat}(u_{\\mathrm{cmd}})$，其硬饱和非线性定义为\n$$\n\\mathrm{sat}(u) = \\begin{cases}\nu, & |u| < u_{\\max},\\\\\nu_{\\max} \\, \\mathrm{sign}(u), & |u| \\ge u_{\\max}.\n\\end{cases}\n$$\n非线性患者动态为\n$$\n\\dot{x}_1 = -k_e x_1 - k_i \\tanh(x_2) + g \\, u_{\\mathrm{act}} + w, \\qquad\n\\dot{x}_2 = k_p x_1 - k_d x_2, \\qquad\ny = x_1,\n$$\n其中 $k_e, k_i, k_p, k_d, g > 0$ 是常数，$w$ 是一个恒定的内源性生产项。考虑工作点\n$$\nx^{\\star} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, \\quad u_{\\mathrm{cmd}}^{\\star} = u_0, \\quad u_{\\mathrm{act}}^{\\star} = u_{\\max}, \\quad w^{\\star} = - g \\, u_{\\max},\n$$\n其中 $u_0 > u_{\\max}$，因此执行器在该工作点处于严格饱和状态。使用以下参数值（单位一致）：$k_e = 0.05$，$k_i = 0.80$，$k_p = 0.30$，$k_d = 0.10$，$g = 0.50$，$u_{\\max} = 10$。\n\n仅从围绕稳态的雅可比矩阵线性化、链式法则以及线性时不变状态空间模型的能控性和能观性的标准定义出发，执行以下操作：\n\n- 推导线性化的状态空间模型，该模型将指令输入 $\\delta u_{\\mathrm{cmd}}$ 的小扰动映射到饱和工作点附近的状态 $\\delta x$ 和输出 $\\delta y$ 的小扰动。\n- 确定线性化状态矩阵 $A_{\\mathrm{lin}}$、输入矩阵 $B_{\\mathrm{lin}}$ 和输出矩阵 $C$。\n- 基于饱和工作点的线性化模型，确定矩阵对 $(A_{\\mathrm{lin}}, B_{\\mathrm{lin}})$ 的能控性矩阵的秩。\n- 在相同的线性化框架内，简要论证矩阵对 $(A_{\\mathrm{lin}}, C)$ 的能观性是否因该工作点的执行器饱和而改变。\n\n将饱和工作点处能控性矩阵的秩作为一个整数报告为最终答案。无需四舍五入，最终答案中不应包含任何单位。",
            "solution": "对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n-   状态向量：$x = \\begin{pmatrix} x_1 \\\\ x_2 \\end{pmatrix}$\n-   状态方程：\n    $$\n    \\dot{x}_1 = -k_e x_1 - k_i \\tanh(x_2) + g \\, u_{\\mathrm{act}} + w \\\\\n    \\dot{x}_2 = k_p x_1 - k_d x_2\n    $$\n-   输出方程：$y = x_1$\n-   实际输入：$u_{\\mathrm{act}} = \\mathrm{sat}(u_{\\mathrm{cmd}})$\n-   饱和函数：\n    $$\n    \\mathrm{sat}(u) = \\begin{cases}\n    u, & |u| < u_{\\max},\\\\\n    u_{\\max} \\, \\mathrm{sign}(u), & |u| \\ge u_{\\max}.\n    \\end{cases}\n    $$\n-   常数：$k_e > 0$，$k_i > 0$，$k_p > 0$，$k_d > 0$，$g > 0$\n-   内源性生产：$w$（常数）\n-   工作点：$x^{\\star} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$，$u_{\\mathrm{cmd}}^{\\star} = u_0$ 且 $u_0 > u_{\\max}$，$u_{\\mathrm{act}}^{\\star} = u_{\\max}$，$w^{\\star} = - g \\, u_{\\max}$\n-   参数值：$k_e = 0.05$，$k_i = 0.80$，$k_p = 0.30$，$k_d = 0.10$，$g = 0.50$，$u_{\\max} = 10$。\n\n### 步骤2：使用提取的已知条件进行验证\n-   **科学依据**：该模型代表一个简化的药代动力学/药效动力学（PK/PD）系统，这是生物医学系统建模中的一种标准方法。使用 $\\tanh(x_2)$ 模拟受体饱和，使用 $\\mathrm{sat}(u_{\\mathrm{cmd}})$ 模拟物理执行器的限制，这两者都是常见且有效的构造。\n-   **适定性**：问题定义清晰。它指定了非线性系统、工作点，并基于控制理论的标准定义，给出了一组精确的任务（线性化、能控性和能观性分析）。\n-   **客观性**：问题以精确的数学语言陈述，没有主观性。\n-   **完整性和一致性**：提供了所有必要的方程、参数和条件。我们必须首先验证给定的工作点确实是一个稳态。\n    当 $x = x^{\\star} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$，$u_{\\mathrm{act}} = u_{\\mathrm{act}}^{\\star} = u_{\\max}$，以及 $w = w^{\\star} = -g u_{\\max}$ 时：\n    $$\n    \\dot{x}_1^{\\star} = -k_e (0) - k_i \\tanh(0) + g (u_{\\max}) + (-g u_{\\max}) = 0 - 0 + g u_{\\max} - g u_{\\max} = 0\n    $$\n    $$\n    \\dot{x}_2^{\\star} = k_p (0) - k_d (0) = 0 - 0 = 0\n    $$\n    由于 $\\dot{x}^{\\star} = 0$，所提供的工作点是该系统的一个有效稳态（平衡点）。问题是一致的。\n\n### 步骤3：结论与行动\n该问题具有科学合理性、自洽性、一致性和适定性。这是控制系统工程应用于生物医学建模领域的一个有效问题。开始求解。\n\n系统动态由向量函数 $f(x, u_{\\mathrm{cmd}}, w)$ 和输出函数 $h(x)$ 描述：\n$$\n\\dot{x} = f(x, u_{\\mathrm{cmd}}, w) = \\begin{pmatrix} -k_e x_1 - k_i \\tanh(x_2) + g \\, \\mathrm{sat}(u_{\\mathrm{cmd}}) + w \\\\ k_p x_1 - k_d x_2 \\end{pmatrix}\n$$\n$$\ny = h(x) = x_1\n$$\n我们在工作点 $(x^{\\star}, u_{\\mathrm{cmd}}^{\\star})$ 附近对系统进行线性化，其中 $x^{\\star} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 且 $u_{\\mathrm{cmd}}^{\\star} = u_0 > u_{\\max}$。线性化模型由下式给出：\n$$\n\\delta\\dot{x} = A_{\\mathrm{lin}} \\delta x + B_{\\mathrm{lin}} \\delta u_{\\mathrm{cmd}} \\\\\n\\delta y = C \\delta x + D \\delta u_{\\mathrm{cmd}}\n$$\n其中 $\\delta x = x - x^{\\star}$，$\\delta u_{\\mathrm{cmd}} = u_{\\mathrm{cmd}} - u_{\\mathrm{cmd}}^{\\star}$，以及 $\\delta y = y - y^{\\star}$。这些矩阵是在工作点计算的雅可比矩阵：\n$$\nA_{\\mathrm{lin}} = \\frac{\\partial f}{\\partial x}\\bigg|_{x^{\\star}, u_{\\mathrm{cmd}}^{\\star}}, \\quad B_{\\mathrm{lin}} = \\frac{\\partial f}{\\partial u_{\\mathrm{cmd}}}\\bigg|_{x^{\\star}, u_{\\mathrm{cmd}}^{\\star}}, \\quad C = \\frac{\\partial h}{\\partial x}\\bigg|_{x^{\\star}}, \\quad D = \\frac{\\partial h}{\\partial u_{\\mathrm{cmd}}}\\bigg|_{x^{\\star}}\n$$\n\n首先，我们计算状态矩阵 $A_{\\mathrm{lin}}$：\n$$\nA_{\\mathrm{lin}} = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial x_1} & \\frac{\\partial f_1}{\\partial x_2} \\\\ \\frac{\\partial f_2}{\\partial x_1} & \\frac{\\partial f_2}{\\partial x_2} \\end{pmatrix}\\bigg|_{x^{\\star}}\n$$\n偏导数是：\n$\\frac{\\partial f_1}{\\partial x_1} = -k_e$\n$\\frac{\\partial f_1}{\\partial x_2} = -k_i \\frac{d}{dx_2}(\\tanh(x_2)) = -k_i \\mathrm{sech}^2(x_2)$。在 $x_2^{\\star} = 0$ 处求值，得到 $-k_i \\mathrm{sech}^2(0) = -k_i(1) = -k_i$。\n$\\frac{\\partial f_2}{\\partial x_1} = k_p$\n$\\frac{\\partial f_2}{\\partial x_2} = -k_d$\n因此，线性化状态矩阵为：\n$$\nA_{\\mathrm{lin}} = \\begin{pmatrix} -k_e & -k_i \\\\ k_p & -k_d \\end{pmatrix} = \\begin{pmatrix} -0.05 & -0.80 \\\\ 0.30 & -0.10 \\end{pmatrix}\n$$\n\n接下来，我们计算输入矩阵 $B_{\\mathrm{lin}}$。这需要计算动态方程对指令输入 $u_{\\mathrm{cmd}}$ 的导数。\n$$\nB_{\\mathrm{lin}} = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial u_{\\mathrm{cmd}}} \\\\ \\frac{\\partial f_2}{\\partial u_{\\mathrm{cmd}}} \\end{pmatrix}\\bigg|_{u_{\\mathrm{cmd}}^{\\star}}\n$$\n偏导数是：\n$\\frac{\\partial f_1}{\\partial u_{\\mathrm{cmd}}} = \\frac{\\partial}{\\partial u_{\\mathrm{cmd}}} (g \\, \\mathrm{sat}(u_{\\mathrm{cmd}})) = g \\frac{d}{du_{\\mathrm{cmd}}} \\mathrm{sat}(u_{\\mathrm{cmd}})$\n$\\frac{\\partial f_2}{\\partial u_{\\mathrm{cmd}}} = 0$\n饱和函数的导数是分段的：\n$$\n\\frac{d}{du} \\mathrm{sat}(u) = \\begin{cases}\n1, & |u| < u_{\\max} \\\\\n0, & |u| > u_{\\max}\n\\end{cases}\n$$\n（导数在 $|u| = u_{\\max}$ 处未定义）。\n在指定的工作点，$u_{\\mathrm{cmd}}^{\\star} = u_0 > u_{\\max}$。这属于执行器饱和且饱和函数导数为 $0$ 的区域。\n因此，$\\frac{d}{du_{\\mathrm{cmd}}} \\mathrm{sat}(u_{\\mathrm{cmd}})\\big|_{u_{\\mathrm{cmd}}^{\\star}} = 0$。\n将此代入 $B_{\\mathrm{lin}}$ 的表达式中：\n$$\nB_{\\mathrm{lin}} = \\begin{pmatrix} g \\cdot 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n这个结果在物理上是直观的：当执行器完全饱和时，指令信号的微小变化不会对实际输送的输入产生任何改变，因此系统局部上对指令输入不敏感。\n\n接下来，我们计算输出矩阵 $C$：\n$$\nC = \\begin{pmatrix} \\frac{\\partial h}{\\partial x_1} & \\frac{\\partial h}{\\partial x_2} \\end{pmatrix}\\bigg|_{x^{\\star}} = \\begin{pmatrix} \\frac{\\partial (x_1)}{\\partial x_1} & \\frac{\\partial (x_1)}{\\partial x_2} \\end{pmatrix} = \\begin{pmatrix} 1 & 0 \\end{pmatrix}\n$$\n前馈矩阵 $D$ 为 $D = \\frac{\\partial h}{\\partial u_{\\mathrm{cmd}}} = 0$。\n\n现在，我们确定矩阵对 $(A_{\\mathrm{lin}}, B_{\\mathrm{lin}})$ 的能控性矩阵的秩。对于一个二阶系统，能控性矩阵为 $\\mathcal{C} = \\begin{pmatrix} B_{\\mathrm{lin}} & A_{\\mathrm{lin}}B_{\\mathrmlin} \\end{pmatrix}$。\n我们有 $B_{\\mathrm{lin}} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。\n乘积 $A_{\\mathrm{lin}}B_{\\mathrm{lin}}$ 为：\n$$\nA_{\\mathrm{lin}}B_{\\mathrm{lin}} = \\begin{pmatrix} -k_e & -k_i \\\\ k_p & -k_d \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n因此，能控性矩阵是零矩阵：\n$$\n\\mathcal{C} = \\begin{pmatrix} 0 & 0 \\\\ 0 & 0 \\end{pmatrix}\n$$\n零矩阵的秩为 $0$。\n$$\n\\mathrm{rank}(\\mathcal{C}) = 0\n$$\n由于秩（$0$）小于状态空间的维数（$n=2$），因此线性化系统在这个饱和工作点是不可控的。\n\n最后，我们简要论证矩阵对 $(A_{\\mathrm{lin}}, C)$ 的能观性是否因执行器饱和而改变。能观性由能观性矩阵 $\\mathcal{O} = \\begin{pmatrix} C \\\\ CA_{\\mathrm{lin}} \\end{pmatrix}$ 的秩决定。所涉及的矩阵是 $A_{\\mathrm{lin}}$ 和 $C$。\n$$\nA_{\\mathrm{lin}} = \\begin{pmatrix} -k_e & -k_i \\\\ k_p & -k_d \\end{pmatrix}, \\quad C = \\begin{pmatrix} 1 & 0 \\end{pmatrix}\n$$\n这两个矩阵都不依赖于 $u_{\\mathrm{cmd}}$ 的值或其饱和状态。雅可比矩阵 $\\frac{\\partial f}{\\partial x}$ 在 $x^{\\star} = 0$ 处求值，在该状态下，其分量是常数或求值为常数的 $x$ 的函数。类似地，$\\frac{\\partial h}{\\partial x}$ 也是常数。\n如果我们在相同的状态工作点 $x^{\\star}=0$ 附近进行线性化，但使用一个非饱和的指令输入 $u_{\\mathrm{cmd}}^{\\star}$（假设 $w^{\\star}$ 也相应改变以维持平衡），得到的矩阵 $A_{\\mathrm{lin}}$ 和 $C$ 将是相同的。因此，在该特定工作点，能观性矩阵 $\\mathcal{O}$ 及其秩不会因为执行器饱和而改变。为完整起见，能观性矩阵为：\n$$\n\\mathcal{O} = \\begin{pmatrix} C \\\\ CA_{\\mathrm{lin}} \\end{pmatrix} = \\begin{pmatrix} 1 & 0 \\\\ -k_e & -k_i \\end{pmatrix}\n$$\n其行列式为 $\\det(\\mathcal{O}) = (1)(-k_i) - (0)(-k_e) = -k_i$。由于 $k_i = 0.80 > 0$，行列式非零，因此 $\\mathrm{rank}(\\mathcal{O}) = 2$。该系统是能观的，且对于此工作点，该性质不受饱和的影响。\n\n问题要求的是饱和工作点处能控性矩阵的秩。这个秩是 $0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "从理论模型到实际应用的征程，通常涉及从连续时间域到数字控制器和仿真的离散时间域的转换。这项练习  将引导你完成使用零阶保持 (Zero-Order Hold, ZOH) 方法对连续时间线性化模型进行离散化的基本过程。通过实施并将离散模型与其连续对应模型进行验证，你将在支撑现代基于模型的控制和分析的计算工作流程中获得实践经验。",
            "id": "3897445",
            "problem": "考虑一个用于生物医学系统建模的、生理学上合理的血浆葡萄糖和胰岛素动态非线性模型。令 $G(t)$ 表示血浆葡萄糖浓度，单位为 $\\mathrm{mg/dL}$，令 $I(t)$ 表示血浆胰岛素浓度，单位为 $\\mathrm{mU/L}$。令 $G_b$ 和 $I_b$ 表示其基础值。假设以下由质量平衡和肝糖生成的饱和动力学推导出的房室速率方程：\n$$\\frac{dG}{dt} = -k_1 \\left(G(t) - G_b\\right) + P - H\\!\\left(I(t)\\right) + D(t),$$\n$$\\frac{dI}{dt} = -k_3 \\left(I(t) - I_b\\right) + u(t),$$\n其中 $k_1$ 和 $k_3$ 是单位为 $\\mathrm{min^{-1}}$ 的正常数速率常数，$D(t)$ 是单位为 $\\mathrm{mg/dL\\cdot min^{-1}}$ 的外源葡萄糖出现速率（例如，由进餐引起），$u(t)$ 是单位为 $\\mathrm{mU/L\\cdot min^{-1}}$ 的外源胰岛素输入，而 $H(I)$ 是一个描述胰岛素抑制的肝糖生成的饱和函数，由下式给出：\n$$H(I) = k_4 \\frac{I}{1 + \\alpha I},$$\n$k_4$ 的单位为 $\\mathrm{mg/dL\\cdot min^{-1}}$，$\\alpha$ 的单位为 $\\mathrm{L/mU}$。常数生成项 $P$ 的设定使得当 $D(t) = 0$ 和 $u(t) = 0$ 时，系统处于基础平衡状态，即 $P = H(I_b)$。\n\n任务：从上述非线性方程出发，在基础平衡点 $(G_b, I_b)$ 附近对系统进行线性化，以获得以下形式的连续时间线性时不变状态空间模型：\n$$\\frac{dx}{dt} = A x + B v,$$\n其中 $x = \\begin{bmatrix} x_1 \\\\ x_2 \\end{bmatrix} = \\begin{bmatrix} G - G_b \\\\ I - I_b \\end{bmatrix}$，而 $v = \\begin{bmatrix} D \\\\ u \\end{bmatrix}$ 是输入向量。然后，使用采样周期 $T$ 对该线性化模型进行零阶保持器 (ZOH) 离散化，以获得离散时间模型：\n$$x_{k+1} = A_d x_k + B_d v_k.$$\n\n科学基础和要求：\n- 速率方程使用房室质量平衡的第一性原理，肝糖生成使用标准饱和动力学。\n- 通过计算平衡点 $(G_b, I_b)$ 处的雅可比矩阵进行线性化，确保所有偏导数都在该平衡点求值。\n- 基于输入在每个长度为 $T$ 的采样区间内保持恒定的定义，实现零阶保持器离散化。\n\n通过阶跃响应进行验证：\n- 通过模拟离散时间线性化模型的阶跃响应，并将在相同恒定输入下采样得到的连续时间线性化响应与之比较，来验证离散近似的有效性。对连续时间线性化模型使用高精度数值积分器。\n- 对每个测试，计算离散轨迹与采样后的连续轨迹之间葡萄糖状态 $x_1$ 的最大绝对偏差。将此偏差以 $\\mathrm{mg/dL}$ 为单位，表示为一个浮点数。\n\n参数和单位：\n- 使用 $G_b = 100\\,\\mathrm{mg/dL}$ 和 $I_b = 10\\,\\mathrm{mU/L}$。\n- 除非在测试案例中另有说明，否则使用基线参数 $k_1 = 0.01\\,\\mathrm{min^{-1}}$、$k_3 = 0.1\\,\\mathrm{min^{-1}}$、$k_4 = 1.0\\,\\mathrm{mg/dL\\cdot min^{-1}}$ 和 $\\alpha = 0.05\\,\\mathrm{L/mU}$。\n- 所有时间单位必须是 $\\mathrm{min}$；所有葡萄糖值单位必须是 $\\mathrm{mg/dL}$；所有胰岛素值单位必须是 $\\mathrm{mU/L}$；所有输入速率单位必须是上文定义的各自速率单位。\n\n测试套件：\n实现您的程序以运行以下五个测试案例，每个案例的初始条件均为 $x(0) = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}$，并从 $t = 0$ 开始施加一个恒定阶跃输入：\n1. 案例 1 (正常路径)：胰岛素阶跃，$u_0 = 2.0\\,\\mathrm{mU/L\\cdot min^{-1}}$，$D_0 = 0.0\\,\\mathrm{mg/dL\\cdot min^{-1}}$，采样周期 $T = 5.0\\,\\mathrm{min}$，时间范围 $N = 60$ 个采样点。\n2. 案例 2 (小采样周期)：胰岛素阶跃，$u_0 = 2.0\\,\\mathrm{mU/L\\cdot min^{-1}}$，$D_0 = 0.0\\,\\mathrm{mg/dL\\cdot min^{-1}}$，采样周期 $T = 1.0\\,\\mathrm{min}$，时间范围 $N = 300$ 个采样点。\n3. 案例 3 (大采样周期)：胰岛素阶跃，$u_0 = 2.0\\,\\mathrm{mU/L\\cdot min^{-1}}$，$D_0 = 0.0\\,\\mathrm{mg/dL\\cdot min^{-1}}$，采样周期 $T = 15.0\\,\\mathrm{min}$，时间范围 $N = 20$ 个采样点。\n4. 案例 4 (胰岛素效用降低)：胰岛素阶跃，$u_0 = 2.0\\,\\mathrm{mU/L\\cdot min^{-1}}$，$D_0 = 0.0\\,\\mathrm{mg/dL\\cdot min^{-1}}$，采样周期 $T = 5.0\\,\\mathrm{min}$，时间范围 $N = 60$ 个采样点，并将 $\\alpha$ 修改为 $\\alpha = 0.20\\,\\mathrm{L/mU}$。\n5. 案例 5 (葡萄糖扰动阶跃)：葡萄糖扰动阶跃，$D_0 = 5.0\\,\\mathrm{mg/dL\\cdot min^{-1}}$，$u_0 = 0.0\\,\\mathrm{mU/L\\cdot min^{-1}}$，采样周期 $T = 5.0\\,\\mathrm{min}$，时间范围 $N = 60$ 个采样点。\n\n最终输出规范：\n- 对每个测试案例，计算在整个仿真时间范围内，离散时间轨迹与采样后的连续时间轨迹之间 $x_1$ 的最大绝对偏差，以 $\\mathrm{mg/dL}$ 为单位，表示为一个浮点数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$\\left[ r_1, r_2, r_3, r_4, r_5 \\right]$），其中每个 $r_i$ 都是一个以 $\\mathrm{mg/dL}$ 为单位的浮点数）。",
            "solution": "该任务是线性化给定的葡萄糖-胰岛素动态非线性模型，离散化得到的线性模型，然后通过将其阶跃响应与原始连续时间线性模型的阶跃响应进行比较来验证离散模型。比较过程涉及计算两种仿真方法之间的最大偏差。\n\n状态变量定义为与基础平衡点 $(G_b, I_b)$ 的偏差：\n$$x = \\begin{bmatrix} x_1(t) \\\\ x_2(t) \\end{bmatrix} = \\begin{bmatrix} G(t) - G_b \\\\ I(t) - I_b \\end{bmatrix}$$\n输入是外源葡萄糖出现速率 $D(t)$ 和胰岛素施用速率 $u(t)$：\n$$v = \\begin{bmatrix} D(t) \\\\ u(t) \\end{bmatrix}$$\n\n**1. 连续时间模型的线性化**\n\n给定的非线性动态方程为：\n$$\\frac{dG}{dt} = -k_1 \\left(G(t) - G_b\\right) + P - H\\!\\left(I(t)\\right) + D(t)$$\n$$\\frac{dI}{dt} = -k_3 \\left(I(t) - I_b\\right) + u(t)$$\n$P = H(I_b)$ 以确保在基础值处达到平衡。我们用偏差变量 $x_1$ 和 $x_2$ 来表示这些方程。注意 $\\dot{x}_1 = \\dot{G}$ 和 $\\dot{x}_2 = \\dot{I}$。同时，$I(t) = x_2(t) + I_b$。\n$$\\dot{x}_1(t) = -k_1 x_1(t) + H(I_b) - H(x_2(t) + I_b) + D(t)$$\n$$\\dot{x}_2(t) = -k_3 x_2(t) + u(t)$$\n该系统具有 $\\dot{x} = f(x, v)$ 的形式。为了在平衡点 $x = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}$ 附近对系统进行线性化，我们计算雅可比矩阵 $A = \\frac{\\partial f}{\\partial x}$ 和 $B = \\frac{\\partial f}{\\partial v}$，并在平衡点 $(x,v) = (0,0)$ 处求值。\n\n$f(x,v)$ 的分量为：\n$$f_1(x_1, x_2, D, u) = -k_1 x_1 + H(I_b) - H(x_2 + I_b) + D$$\n$$f_2(x_1, x_2, D, u) = -k_3 x_2 + u$$\n\n雅可比矩阵 $A$ 是：\n$$A = \\begin{bmatrix} \\frac{\\partial f_1}{\\partial x_1} & \\frac{\\partial f_1}{\\partial x_2} \\\\ \\frac{\\partial f_2}{\\partial x_1} & \\frac{\\partial f_2}{\\partial x_2} \\end{bmatrix}_{x=0} = \\begin{bmatrix} -k_1 & -\\frac{dH}{dI}\\big|_{I=I_b} \\\\ 0 & -k_3 \\end{bmatrix}$$\n肝糖生成函数 $H(I) = k_4 \\frac{I}{1 + \\alpha I}$ 的导数使用商法则求得：\n$$H'(I) = \\frac{d H}{d I} = k_4 \\frac{(1)(1 + \\alpha I) - I(\\alpha)}{(1 + \\alpha I)^2} = \\frac{k_4}{(1 + \\alpha I)^2}$$\n在基础胰岛素水平 $I_b$ 处求值，我们得到：\n$$H'(I_b) = \\frac{k_4}{(1 + \\alpha I_b)^2}$$\n我们将这个常数表示为 $k_5 = H'(I_b)$。因此，状态矩阵 $A$ 为：\n$$A = \\begin{bmatrix} -k_1 & -k_5 \\\\ 0 & -k_3 \\end{bmatrix}$$\n输入矩阵 $B$ 是：\n$$B = \\begin{bmatrix} \\frac{\\partial f_1}{\\partial D} & \\frac{\\partial f_1}{\\partial u} \\\\ \\frac{\\partial f_2}{\\partial D} & \\frac{\\partial f_2}{\\partial u} \\end{bmatrix}_{v=0} = \\begin{bmatrix} 1 & 0 \\\\ 0 & 1 \\end{bmatrix} = I_{2 \\times 2}$$\n因此，连续时间线性时不变 (LTI) 状态空间模型为：\n$$\\frac{dx}{dt} = \\begin{bmatrix} -k_1 & -k_5 \\\\ 0 & -k_3 \\end{bmatrix} x + \\begin{bmatrix} 1 & 0 \\\\ 0 & 1 \\end{bmatrix} v$$\n\n**2. 使用零阶保持器 (ZOH) 进行离散化**\n\n我们将连续时间模型 $\\dot{x} = Ax + Bv$ 转换为采样周期为 $T$ 的离散时间模型 $x_{k+1} = A_d x_k + B_d v_k$。零阶保持器方法假设输入向量 $v(t)$ 在每个区间 $[kT, (k+1)T)$ 内保持为常数 $v_k$。离散时间矩阵由下式给出：\n$$A_d = e^{AT}$$\n$$B_d = \\left( \\int_0^T e^{A\\tau} d\\tau \\right) B$$\n对于一个稳定且可逆的矩阵 $A$，该积分可以表示为 $B_d = A^{-1}(A_d - I)B$。\n一个能够同时计算 $A_d$ 和 $B_d$ 的数值稳健方法是计算一个增广矩阵的矩阵指数：\n$$M = \\begin{bmatrix} A & B \\\\ 0 & 0 \\end{bmatrix}$$\n其中 $A$、$B$ 和零矩阵的块大小是相容的。对于我们的 $2 \\times 2$ 系统，$M$ 是一个 $4 \\times 4$ 矩阵。$MT$ 的指数为：\n$$e^{MT} = \\begin{bmatrix} e^{AT} & (\\int_0^T e^{A\\tau} d\\tau)B \\\\ 0 & I \\end{bmatrix} = \\begin{bmatrix} A_d & B_d \\\\ 0 & I \\end{bmatrix}$$\n该方法避免了矩阵求逆可能带来的数值问题，并被用于实现。\n\n**3. 仿真与验证**\n\n问题要求使用两种方法模拟线性化系统的阶跃响应并比较结果。输入是一个恒定阶跃 $v(t) = v_k = v_0$，适用于所有 $t \\ge 0$。\n\n方法 1：离散时间仿真\n离散模型从 $x_0 = 0$ 开始迭代仿真：\n$$x_{k+1} = A_d x_k + B_d v_0$$\n这将生成轨迹 $(x_0, x_1, x_2, \\ldots, x_N)$。\n\n方法 2：连续时间仿真\n连续时间线性常微分方程 $\\dot{x} = Ax + Bv_0$ 使用高精度积分器（如 `scipy.integrate.solve_ivp`）进行数值求解。解在采样时刻 $t_k = kT$ (其中 $k \\in \\{0, 1, \\ldots, N\\}$) 处进行评估。\n\n比较：\n对于分段常数输入（阶跃输入即是如此），零阶保持器离散化是精确的。这意味着离散时间系统的状态 $x_k$ 精确等于在时间 $t_k$ 采样的连续时间系统的状态，即 $x_k = x(t_k)$。因此，两种方法之间计算出的任何偏差都是由常微分方程求解器引入的数值误差的度量。\n最终的验证指标是在仿真时间范围内，葡萄糖状态 $x_1$ 的最大绝对偏差：\n$$\\text{Deviation} = \\max_{k \\in \\{0, \\dots, N\\}} |x_{1, \\text{discrete}}(k) - x_{1, \\text{continuous}}(kT)|$$\n我们预期这个值会非常小，量级与为数值积分器设置的容差相当。\n该实现将循环遍历五个测试案例，为每组参数计算此偏差。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import expm\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n\n    # Base parameters and basal values\n    G_b = 100.0   # mg/dL\n    I_b = 10.0    # mU/L\n    k1_base = 0.01  # min^-1\n    k3_base = 0.1   # min^-1\n    k4_base = 1.0   # mg/dL·min^-1\n    alpha_base = 0.05 # L/mU\n\n    # Test suite definition\n    # (u0, D0, T, N, alpha)\n    test_cases = [\n        (2.0, 0.0, 5.0, 60, alpha_base),\n        (2.0, 0.0, 1.0, 300, alpha_base),\n        (2.0, 0.0, 15.0, 20, alpha_base),\n        (2.0, 0.0, 5.0, 60, 0.20),\n        (0.0, 5.0, 5.0, 60, alpha_base),\n    ]\n\n    results = []\n    for case in test_cases:\n        deviation = simulate_and_compare(k1_base, k3_base, k4_base, alpha, I_b, u0, D0, T, N)\n        results.append(deviation)\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef simulate_and_compare(k1, k3, k4, alpha, I_b, u0, D0, T, N):\n    \"\"\"\n    Performs linearization, discretization, simulation, and comparison for a single case.\n    \n    Returns:\n        float: Maximum absolute deviation in the glucose state (x1).\n    \"\"\"\n\n    # 1. Linearization: Construct continuous-time matrices A and B\n    k5 = k4 / (1 + alpha * I_b)**2\n    A_c = np.array([[-k1, -k5],\n                    [0,  -k3]])\n    B_c = np.array([[1.0, 0.0],\n                    [0.0, 1.0]])\n\n    # 2. Discretization: Compute discrete-time matrices Ad and Bd using the matrix exponential method\n    n, m = A_c.shape[0], B_c.shape[1]\n    M = np.zeros((n + m, n + m))\n    M[:n, :n] = A_c\n    M[:n, n:] = B_c\n    \n    eMT = expm(M * T)\n    \n    A_d = eMT[:n, :n]\n    B_d = eMT[:n, n:]\n\n    # 3. Simulate discrete-time system\n    x0 = np.array([0.0, 0.0])\n    v0 = np.array([D0, u0])\n    \n    x_discrete_traj = np.zeros((N + 1, n))\n    x_discrete_traj[0, :] = x0\n    x_k = x0.copy()\n\n    for k in range(N):\n        x_k = A_d @ x_k + B_d @ v0\n        x_discrete_traj[k + 1, :] = x_k\n\n    x1_discrete = x_discrete_traj[:, 0]\n\n    # 4. Simulate continuous-time system\n    t_span = [0, N * T]\n    t_eval = np.linspace(t_span[0], t_span[1], N + 1)\n    \n    def linear_ode(t, x, A, B, v):\n        return A @ x + B @ v\n\n    # Use high-accuracy tolerances for the ODE solver\n    rtol = 1e-12\n    atol = 1e-12\n\n    sol = solve_ivp(\n        fun=lambda t, x: linear_ode(t, x, A_c, B_c, v0),\n        t_span=t_span,\n        y0=x0,\n        method='DOP853', # A high-order method\n        t_eval=t_eval,\n        rtol=rtol,\n        atol=atol\n    )\n    \n    x_continuous_traj = sol.y.T\n    x1_continuous = x_continuous_traj[:, 0]\n\n    # 5. Compute max absolute deviation\n    max_abs_dev = np.max(np.abs(x1_discrete - x1_continuous))\n    \n    return max_abs_dev\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}