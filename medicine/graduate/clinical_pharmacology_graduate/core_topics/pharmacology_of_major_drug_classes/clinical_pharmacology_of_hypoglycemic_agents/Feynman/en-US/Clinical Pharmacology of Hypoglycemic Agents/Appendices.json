{
    "hands_on_practices": [
        {
            "introduction": "Effective insulin therapy requires precise dose adjustments to manage glycemic variability. A core skill for any clinician is the ability to calculate a \"correction bolus\" to safely lower elevated blood glucose levels. This practice focuses on applying a widely used clinical heuristic, the \"Rule of 1800,\" to estimate a patient's unique Insulin Sensitivity Factor (ISF) and determine the appropriate dose of rapid-acting insulin needed to correct pre-meal hyperglycemia . Mastering this calculation is a fundamental step toward personalizing insulin regimens and preventing post-meal glucose excursions.",
            "id": "4535818",
            "problem": "An adult with insulin-treated diabetes on a stable basal–bolus regimen using rapid-acting insulin analogs presents for premeal dosing. The measured capillary plasma glucose is $250$ milligrams per deciliter (mg/dL), and the individualized preprandial target is $110$ mg/dL. The prior $24$-hour Total Daily Dose (TDD) of insulin was $60$ units. Assume no active residual rapid-acting insulin, no concurrent carbohydrate intake at the time of correction, and a locally linear glucose–insulin pharmacodynamic relationship over the relevant range. Using the well-tested clinical observation known as the $1800$ rule for rapid-acting insulin to estimate the insulin sensitivity factor, determine the correction bolus that would reduce glucose from $250$ mg/dL to $110$ mg/dL. Round your answer to three significant figures and express the final dose in units.",
            "solution": "The problem is valid as it is scientifically grounded in clinical pharmacology, well-posed, and objective. All necessary data and assumptions are provided to determine a unique, meaningful solution using established clinical heuristics.\n\nThe objective is to calculate the correction bolus of rapid-acting insulin required to lower a patient's blood glucose from a measured value to a target value. We are given the following information:\n- Measured capillary plasma glucose, $G_{current} = 250 \\text{ mg/dL}$.\n- Individualized preprandial target glucose, $G_{target} = 110 \\text{ mg/dL}$.\n- The patient's total daily dose of insulin, TDD $= 60 \\text{ units}$.\n- The method for estimating insulin sensitivity is the \"$1800$ rule\".\n\nThe calculation proceeds in three steps:\n1.  Determine the required glucose reduction (glucose deficit).\n2.  Estimate the patient's insulin sensitivity factor (ISF).\n3.  Calculate the insulin dose needed for the correction.\n\n**Step 1: Calculate the Glucose Deficit**\nThe glucose deficit, denoted as $\\Delta G$, is the difference between the current glucose level and the target glucose level.\n$$\n\\Delta G = G_{current} - G_{target}\n$$\nSubstituting the given values:\n$$\n\\Delta G = 250 \\text{ mg/dL} - 110 \\text{ mg/dL} = 140 \\text{ mg/dL}\n$$\nThis is the total amount of glucose reduction needed.\n\n**Step 2: Estimate the Insulin Sensitivity Factor (ISF)**\nThe ISF quantifies how much a patient's blood glucose level will drop, in mg/dL, for every $1$ unit of rapid-acting insulin administered. The problem specifies using the \"$1800$ rule\", which is an empirical formula used for patients on rapid-acting insulin analogs. The rule states:\n$$\n\\text{ISF (in } \\frac{\\text{mg/dL}}{\\text{unit}} \\text{)} = \\frac{1800}{\\text{TDD (in units)}}\n$$\nUsing the patient's TDD of $60$ units:\n$$\n\\text{ISF} = \\frac{1800}{60} \\frac{\\text{mg/dL}}{\\text{unit}} = 30 \\frac{\\text{mg/dL}}{\\text{unit}}\n$$\nThis means that for this patient, $1$ unit of rapid-acting insulin is expected to lower blood glucose by approximately $30 \\text{ mg/dL}$.\n\n**Step 3: Calculate the Correction Bolus Dose**\nThe correction bolus, $D_{correction}$, is calculated by dividing the total glucose deficit ($\\Delta G$) by the insulin sensitivity factor (ISF). This determines how many units of insulin are needed to achieve the desired glucose reduction.\n$$\nD_{correction} = \\frac{\\Delta G}{\\text{ISF}}\n$$\nSubstituting the values calculated in the previous steps:\n$$\nD_{correction} = \\frac{140 \\text{ mg/dL}}{30 \\frac{\\text{mg/dL}}{\\text{unit}}} = \\frac{14}{3} \\text{ units}\n$$\nPerforming the division gives:\n$$\nD_{correction} \\approx 4.666... \\text{ units}\n$$\nThe problem requires rounding the final answer to three significant figures.\n$$\nD_{correction} \\approx 4.67 \\text{ units}\n$$\nThe assumptions of no active residual insulin and no concurrent carbohydrate intake are critical, as they ensure that the calculated dose addresses only the existing hyperglycemia without confounding effects. The assumption of a locally linear pharmacodynamic relationship validates the use of a single ISF value across the glucose range from $250 \\text{ mg/dL}$ to $110 \\text{ mg/dL}$.",
            "answer": "$$\\boxed{4.67}$$"
        },
        {
            "introduction": "Beyond routine calculations, an expert clinical pharmacologist must be adept at dissecting complex adverse drug events to prevent their recurrence. This case study challenges you to perform a root-cause analysis of a severe hypoglycemic event in a patient on a complex multi-drug regimen . You will need to integrate your knowledge of the pharmacokinetics and pharmacodynamics of different hypoglycemic agent classes—insulins, sulfonylureas, and biguanides—with patient-specific factors like organ function and lifestyle to identify the causal chain and devise a robust prevention plan. This exercise hones the critical thinking skills necessary for managing high-risk polypharmacy and ensuring patient safety.",
            "id": "4535820",
            "problem": "A $62$-year-old man with Type $2$ Diabetes Mellitus (T2DM) on basal-bolus insulin therapy presents after a severe hypoglycemic event at work. His regimen includes insulin glargine $24$ units at $22{:}00$, insulin lispro $8$ units before meals (insulin-to-carbohydrate ratio $1{:}10$), metformin $1000\\,\\mathrm{mg}$ twice daily, and glyburide (glibenclamide) $5\\,\\mathrm{mg}$ each morning. His estimated glomerular filtration rate (eGFR) is $45\\,\\mathrm{mL/min/1.73\\,m^2}$. On the day of the event, he administered his usual pre-lunch insulin lispro bolus of $8$ units at $12{:}00$ in anticipation of eating at $12{:}10$, but an unscheduled meeting delayed the meal until approximately $13{:}00$. At $12{:}40$ he experienced tremor, diaphoresis, and confusion; fingerstick glucose was $49\\,\\mathrm{mg/dL}$. He ingested $15\\,\\mathrm{g}$ oral glucose and recovered gradually. He reports that such delays are common due to work demands and that he took his glyburide at $07{:}00$.\n\nUsing core definitions and well-tested pharmacologic facts about insulin, biguanides, and sulfonylureas, evaluate the dominant causal chain for this hypoglycemic event and identify the most effective prevention strategy that addresses the mechanism without sacrificing overall glycemic control. Which option best integrates a root-cause analysis with an appropriate prevention tactic?\n\n- A. The mismatch between rapid-acting insulin lispro pharmacodynamics and delayed carbohydrate arrival led to a net fall in plasma glucose, further amplified by glyburide-induced glucose-independent insulin secretion with prolonged effect due to reduced renal clearance, and by metformin’s suppression of hepatic glucose production. Prevention: discontinue glyburide, avoid pre-bolus when meal timing is uncertain, consider split or postprandial bolus dosing, enable Continuous Glucose Monitoring (CGM) alerts or pump predictive low-glucose suspend, and carry mini-dose glucagon for emergencies.\n- B. Metformin primarily triggered hypoglycemia by increasing insulin secretion; prevention is to stop metformin and increase basal insulin by $25\\%$ to stabilize fasting glucose, while maintaining a $20$–$30$ minute pre-bolus with lispro for consistency.\n- C. The event reflects inadequate carbohydrate counting rather than pharmacokinetics; prevention is to always pre-bolus by $30$ minutes with an ultra-rapid analog to ensure stronger peak action, and keep glyburide for daytime coverage.\n- D. Stress-induced catecholamine surge was the main cause; prevention is to add a non-selective beta-blocker so symptoms are blunted, permitting longer meal delays without discomfort.\n- E. Since sulfonylureas seldom cause hypoglycemia, the episode is due to a peak in insulin glargine; prevention is to switch basal insulin to neutral protamine Hagedorn (NPH) for a smoother profile and maintain pre-bolus timing.",
            "solution": "The problem statement is evaluated to be valid as it presents a scientifically grounded, well-posed, and objective clinical scenario within pharmacology that can be analyzed using established principles.\n\n**Principle-Based Derivation of Causal Chain and Prevention Strategy**\n\nThe patient, a $62$-year-old male with Type $2$ Diabetes Mellitus (T2DM) and Stage $3$b Chronic Kidney Disease (CKD), as indicated by an estimated glomerular filtration rate (eGFR) of $45\\,\\mathrm{mL/min/1.73\\,m^2}$, experienced a severe hypoglycemic event. A systematic analysis of the contributing factors based on pharmacokinetic (PK) and pharmacodynamic (PD) principles is required.\n\n**1. Root Cause Analysis:**\n\n*   **Primary Trigger: Insulin-Carbohydrate Mismatch.** The patient administered $8$ units of insulin lispro, a rapid-acting insulin analog, at $12{:}00$. Insulin lispro has a rapid onset of action (approximately $15$ minutes), peaks at approximately $1$ to $2$ hours, and has a duration of action of $3$ to $5$ hours. The hypoglycemic symptoms and a measured blood glucose of $49\\,\\mathrm{mg/dL}$ occurred at $12{:}40$, which is $40$ minutes after the injection. This timing falls squarely within the onset and ramp-up phase of lispro's action. The meal, intended for $12{:}10$, was delayed until $13{:}00$. Therefore, the primary cause of the event is the pharmacodynamic effect of insulin lispro causing rapid glucose uptake from the blood in the absence of exogenous carbohydrate absorption from a meal.\n\n*   **Major Amplifying Factor: Sulfonylurea (Glyburide).** The patient takes glyburide ($5\\,\\mathrm{mg}$) in the morning. Glyburide is a second-generation sulfonylurea that acts as an insulin secretagogue. Its mechanism is to stimulate insulin release from pancreatic $\\beta$-cells by closing ATP-sensitive potassium channels ($K_{ATP}$ channels), irrespective of the ambient glucose concentration. This glucose-independent insulin secretion creates a higher baseline level of circulating endogenous insulin, which synergizes with the exogenous insulin lispro, markedly increasing the risk of hypoglycemia.\n    Furthermore, glyburide poses a particularly high risk in this patient due to his impaired renal function (eGFR of $45\\,\\mathrm{mL/min/1.73\\,m^2}$). Glyburide is metabolized in the liver to active metabolites that are cleared by the kidneys. Reduced renal clearance leads to the accumulation of these active metabolites, prolonging the half-life and intensifying the hypoglycemic effect of the drug. The use of glyburide in patients with an $eGFR  60\\,\\mathrm{mL/min/1.73\\,m^2}$, and especially in the elderly, is strongly discouraged due to the high risk of severe and prolonged hypoglycemia.\n\n*   **Secondary Contributing Factor: Biguanide (Metformin).** The patient is on metformin $1000\\,\\mathrm{mg}$ twice daily. Metformin's primary antihyperglycemic effect is the suppression of hepatic glucose production (gluconeogenesis). While metformin does not stimulate insulin secretion and rarely causes hypoglycemia as monotherapy, its action is relevant during a hypoglycemic episode. The body's primary counter-regulatory response to falling blood glucose is to increase hepatic glucose output. By inhibiting this process, metformin blunts the body's ability to defend against and recover from hypoglycemia, thereby increasing the severity and duration of the event initiated by insulin and glyburide. The patient's eGFR of $45$ is also a level at which continuation of metformin therapy requires careful risk/benefit assessment due to an increased risk of lactic acidosis.\n\n*   **Basal Insulin (Insulin Glargine).** The basal insulin, glargine $24$ units, provides a continuous, low-level background of insulin. While it contributes to the total daily insulinization and overall potential for hypoglycemia, it is a long-acting, relatively peakless analog. It is not the acute trigger for a hypoglycemic event occurring at midday, which is clearly timed with the pre-meal bolus.\n\n**2. Optimal Prevention Strategy:**\n\nAn effective prevention strategy must address the identified root causes.\n\n*   **Discontinue High-Risk Medication:** The most critical intervention is the discontinuation of glyburide. The combination of a sulfonylurea and insulin is irrational in modern practice due to the substantial, synergistic risk of hypoglycemia. This is especially true for glyburide in a patient with CKD. Removing this agent is the single most effective measure to reduce the patient's baseline risk of severe hypoglycemia.\n\n*   **Modify Bolus Insulin Strategy:** The patient's unpredictable work schedule makes pre-bolusing with rapid-acting insulin inherently risky. The strategy must be adapted to mitigate the risk of an insulin-carbohydrate timing mismatch. Effective modifications include:\n    *   Administering the bolus immediately before the first bite of the meal (zero-minute pre-bolus).\n    *   Administering the bolus after the meal (postprandial bolus). This may result in a transient post-meal glucose spike but is significantly safer for preventing pre-meal hypoglycemia.\n    *   Using a split bolus (part of the dose before, part during/after) for long meals.\n\n*   **Leverage Technology for Safety:** Continuous Glucose Monitoring (CGM) is an invaluable tool. It provides real-time glucose readings, trend arrows, and programmable alarms for low or rapidly falling glucose levels. This allows the patient to take pre-emptive action (e.g., consume carbohydrates) before symptomatic hypoglycemia develops. Insulin pumps with predictive low-glucose suspend algorithms offer an even higher level of automated protection.\n\n*   **Enhance Emergency Treatment:** While the patient correctly used $15\\,\\mathrm{g}$ of oral glucose, having access to glucagon is crucial for more severe events. Mini-dose or nasal glucagon provides a stable, easy-to-use rescue therapy for hypoglycemia that can be administered even if the patient is confused or unable to swallow safely.\n\n**Option-by-Option Analysis**\n\n*   **A. The mismatch between rapid-acting insulin lispro pharmacodynamics and delayed carbohydrate arrival led to a net fall in plasma glucose, further amplified by glyburide-induced glucose-independent insulin secretion with prolonged effect due to reduced renal clearance, and by metformin’s suppression of hepatic glucose production. Prevention: discontinue glyburide, avoid pre-bolus when meal timing is uncertain, consider split or postprandial bolus dosing, enable Continuous Glucose Monitoring (CGM) alerts or pump predictive low-glucose suspend, and carry mini-dose glucagon for emergencies.**\n    *   **Analysis:** This option provides a complete and accurate root-cause analysis, correctly identifying the primary trigger (lispro-meal mismatch) and the two key amplifying factors (glyburide amplified by renal impairment, and metformin). The proposed prevention strategy is comprehensive,evidence-based, and directly addresses each identified risk factor with the most appropriate and modern clinical tools and tactics (discontinuing glyburide, adjusting bolus timing, using CGM, and improving emergency readiness).\n    *   **Verdict:** **Correct**.\n\n*   **B. Metformin primarily triggered hypoglycemia by increasing insulin secretion; prevention is to stop metformin and increase basal insulin by $25\\%$ to stabilize fasting glucose, while maintaining a $20$–$30$ minute pre-bolus with lispro for consistency.**\n    *   **Analysis:** This option is incorrect on multiple grounds. Metformin does not increase insulin secretion; it inhibits hepatic glucose production. It was not the primary trigger. The prevention strategy is dangerous: increasing basal insulin would increase overall hypoglycemia risk, and maintaining a long pre-bolus is contraindicated given the patient's unpredictable meal times.\n    *   **Verdict:** **Incorrect**.\n\n*   **C. The event reflects inadequate carbohydrate counting rather than pharmacokinetics; prevention is to always pre-bolus by $30$ minutes with an ultra-rapid analog to ensure stronger peak action, and keep glyburide for daytime coverage.**\n    *   **Analysis:** This misinterprets the primary problem, which was a timing mismatch (PK/PD), not a dosing error (carb counting). The prevention strategy would exacerbate the problem: a longer pre-bolus and a faster insulin would increase the risk and severity of pre-meal hypoglycemia. Keeping glyburide is a major clinical error.\n    *   **Verdict:** **Incorrect**.\n\n*   **D. Stress-induced catecholamine surge was the main cause; prevention is to add a non-selective beta-blocker so symptoms are blunted, permitting longer meal delays without discomfort.**\n    *   **Analysis:** This reverses cause and effect. The catecholamine surge is a symptomatic *response to* hypoglycemia, not its cause. The prevention strategy is extremely dangerous. Using a non-selective beta-blocker would mask the warning symptoms of hypoglycemia, leading to hypoglycemia unawareness and increasing the risk of a severe neuroglycopenic event (e.g., coma, seizure).\n    *   **Verdict:** **Incorrect**.\n\n*   **E. Since sulfonylureas seldom cause hypoglycemia, the episode is due to a peak in insulin glargine; prevention is to switch basal insulin to neutral protamine Hagedorn (NPH) for a smoother profile and maintain pre-bolus timing.**\n    *   **Analysis:** This option contains two fundamental pharmacological errors. First, sulfonylureas (especially glyburide) are a notorious cause of severe hypoglycemia. Second, insulin glargine is designed to be peakless, whereas NPH has a pronounced peak and is generally associated with a higher risk of hypoglycemia than glargine. The proposed switch would likely worsen glycemic variability and risk.\n    *   **Verdict:** **Incorrect**.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "The frontier of clinical pharmacology is moving toward personalized, data-driven therapeutics that can be automated through intelligent algorithms. This advanced practice takes you from manual dose calculation to the design of a sophisticated Bayesian titration model for basal insulin . You will develop an algorithm that learns a patient's insulin sensitivity from glucose monitoring data and recommends a dose that balances achieving a target glucose level with a strict, model-enforced safety constraint on hypoglycemia risk. This hands-on coding problem exemplifies the role of the modern quantitative pharmacologist in building the next generation of safe and effective personalized medicine systems.",
            "id": "4535869",
            "problem": "You are tasked with designing and implementing a Bayesian basal insulin titration algorithm that integrates Self-Monitoring of Blood Glucose (SMBG) or Continuous Glucose Monitoring (CGM) observations to update the posterior distribution of a single pharmacodynamic parameter and to recommend a next-day basal insulin dose. The recommendation must satisfy a hard safety constraint: the model-implied probability of hypoglycemia (defined by a glucose threshold) for the next fasting period must be strictly less than a specified bound expressed as a decimal.\n\nUse the following context-appropriate fundamental base grounded in clinical pharmacology and statistical modeling.\n\n- Insulin lowers fasting plasma glucose by suppressing hepatic glucose production and increasing peripheral uptake. For a short horizon in a patient with a stable regimen, a linear pharmacodynamic approximation is acceptable: the fasting glucose response is approximately proportional to the basal insulin dose.\n- SMBG and CGM measurements reflect latent glycemia with Gaussian sensor and physiological variability.\n- Bayesian updating with a Gaussian prior and a linear-Gaussian likelihood yields a Gaussian posterior distribution for the slope parameter.\n\nModel the data-generating process as follows. Let $S$ be the insulin sensitivity parameter measured as the decrease in fasting glucose (in $\\text{mg}/\\text{dL}$) per unit of basal insulin (in $\\text{U}$). Assume a normal prior $S \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)$. Let the physiological baseline fasting glucose with zero insulin be $G_{\\text{phys}}$ in $\\text{mg}/\\text{dL}$. For each observation indexed by $i$, with basal dose $D_i$ in $\\text{U}/\\text{day}$ and measured fasting glucose $G_i$ in $\\text{mg}/\\text{dL}$, assume the measurement model\n$$\nG_i \\;=\\; G_{\\text{phys}} \\;-\\; S\\, D_i \\;+\\; \\epsilon_i,\n$$\nwhere $\\epsilon_i \\sim \\mathcal{N}(0,\\sigma_\\epsilon^2)$ is independent measurement and physiological noise with variance $\\sigma_\\epsilon^2$ in $(\\text{mg}/\\text{dL})^2$.\n\nUnder this model, after observing a set of pairs $\\{(D_i,G_i)\\}$, the posterior distribution for $S$ is Gaussian with mean and variance that you must derive from first principles. For a candidate next basal dose $D$ in $\\text{U}/\\text{day}$, the predictive fasting glucose for the next day is\n$$\nG_{\\text{next}} \\;=\\; G_{\\text{phys}} \\;-\\; S \\, D \\;+\\; \\epsilon,\n$$\nwith $\\epsilon \\sim \\mathcal{N}(0,\\sigma_\\epsilon^2)$ and $S$ distributed according to the posterior. Therefore, $G_{\\text{next}}$ is a Gaussian random variable whose mean and variance you must derive from the posterior of $S$ and the noise model.\n\nSafety constraint: For a hypoglycemia threshold $T_{\\text{hypo}}$ in $\\text{mg}/\\text{dL}$ and a maximal tolerated hypoglycemia probability $p_{\\max}$ expressed as a decimal, you must ensure\n$$\n\\mathbb{P}\\!\\left(G_{\\text{next}}  T_{\\text{hypo}}\\right) \\;\\; p_{\\max}.\n$$\n\nDose objective: The primary titration goal is to set the mean of $G_{\\text{next}}$ as close as possible to a specified target fasting glucose $G_{\\text{target}}$ in $\\text{mg}/\\text{dL}$ while satisfying the safety constraint. A principled recommendation is to choose the dose that would match the mean to $G_{\\text{target}}$ if it satisfies the constraint; otherwise, cap the dose at the largest value that keeps the hypoglycemia probability strictly below $p_{\\max}$. Doses must be nonnegative.\n\nYour program must implement the Bayesian update and compute the recommended basal dose $D^\\star$ in $\\text{U}/\\text{day}$ for each test case, using the following test suite. Each test case is a tuple of parameters $(\\mu_0, \\sigma_0, \\sigma_\\epsilon, G_{\\text{phys}}, G_{\\text{target}}, T_{\\text{hypo}}, p_{\\max}, \\text{data})$, where $\\text{data}$ is a list of $(D_i,G_i)$ pairs.\n\nTest Suite:\n- Case A (general case with informative data):\n  - $\\mu_0 = 1.0$, $\\sigma_0 = 0.3$, $\\sigma_\\epsilon = 10.0$, $G_{\\text{phys}} = 200.0$, $G_{\\text{target}} = 110.0$, $T_{\\text{hypo}} = 70.0$, $p_{\\max} = 0.05$, $\\text{data} = [(10.0,190.0),(20.0,175.0),(30.0,160.0)]$.\n- Case B (higher sensitivity; check boundary safety):\n  - $\\mu_0 = 1.5$, $\\sigma_0 = 0.2$, $\\sigma_\\epsilon = 8.0$, $G_{\\text{phys}} = 180.0$, $G_{\\text{target}} = 100.0$, $T_{\\text{hypo}} = 70.0$, $p_{\\max} = 0.05$, $\\text{data} = [(8.0,160.0),(10.0,145.0),(12.0,130.0)]$.\n- Case C (high CGM/physiological noise; safety cap active):\n  - $\\mu_0 = 1.2$, $\\sigma_0 = 0.5$, $\\sigma_\\epsilon = 25.0$, $G_{\\text{phys}} = 220.0$, $G_{\\text{target}} = 120.0$, $T_{\\text{hypo}} = 70.0$, $p_{\\max} = 0.05$, $\\text{data} = [(20.0,205.0),(25.0,200.0),(30.0,190.0)]$.\n- Case D (no data; prior-only update):\n  - $\\mu_0 = 1.0$, $\\sigma_0 = 0.4$, $\\sigma_\\epsilon = 12.0$, $G_{\\text{phys}} = 210.0$, $G_{\\text{target}} = 130.0$, $T_{\\text{hypo}} = 70.0$, $p_{\\max} = 0.05$, $\\text{data} = []$.\n\nRequirements:\n- Derive the posterior mean and variance of $S$ under the linear-Gaussian model using only the specified fundamental base and definitions.\n- Derive the predictive distribution of $G_{\\text{next}}$ as a Gaussian, and express its mean and variance in terms of the posterior of $S$, the dose $D$, and $\\sigma_\\epsilon$.\n- Implement a numerical method to find the largest dose $D$ that satisfies the safety constraint when the mean-targeting dose would violate it. Demonstrate correctness by monotonicity arguments and by robust bracketing.\n- Express the recommended dose $D^\\star$ in $\\text{U}/\\text{day}$ as a float rounded to one decimal place for each test case.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with no additional text. For example, $[d_1,d_2,d_3,d_4]$, where each $d_k$ is the recommended dose for case $k$ in $\\text{U}/\\text{day}$ rounded to one decimal place.",
            "solution": "The problem requires the design of a Bayesian algorithm for basal insulin dose titration. The solution involves three primary steps: (1) deriving the posterior distribution of the patient's insulin sensitivity parameter, $S$, based on observed glucose and dose data; (2) deriving the predictive distribution for the next day's fasting glucose given a candidate dose; and (3) determining the optimal dose, $D^\\star$, that aims for a target glucose level while strictly adhering to a safety constraint on hypoglycemia risk.\n\n**1. Posterior Distribution of Insulin Sensitivity ($S$)**\n\nThe model is defined by a prior distribution for the insulin sensitivity parameter $S$ and a likelihood function derived from measurement data.\n\nThe prior distribution for $S$ is given as a Gaussian:\n$$\nS \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)\n$$\nThe probability density function (PDF) is $p(S) \\propto \\exp\\left(-\\frac{(S - \\mu_0)^2}{2\\sigma_0^2}\\right)$.\n\nThe measurement model for $n$ observations $\\{(D_i, G_i)\\}_{i=1}^n$ is:\n$$\nG_i = G_{\\text{phys}} - S D_i + \\epsilon_i, \\quad \\text{where} \\quad \\epsilon_i \\sim \\mathcal{N}(0, \\sigma_\\epsilon^2)\n$$\nHere, $G_{\\text{phys}}$ is the physiological baseline fasting glucose, $D_i$ is the insulin dose, $G_i$ is the measured glucose, and $\\epsilon_i$ represents measurement and physiological noise. We can rearrange this to express the data in a form suitable for linear regression. Let $y_i = G_{\\text{phys}} - G_i$. The model becomes:\n$$\ny_i = S D_i - \\epsilon_i\n$$\nThe likelihood of observing $y_i$ given $S$ and $D_i$ is $p(y_i|S, D_i) \\sim \\mathcal{N}(S D_i, \\sigma_\\epsilon^2)$, since the distribution of $-\\epsilon_i$ is the same as $\\epsilon_i$. The total likelihood for the dataset $\\mathcal{D} = \\{(D_i, y_i)\\}_{i=1}^n$ is the product of individual likelihoods, assuming independence:\n$$\np(\\mathcal{D}|S) = \\prod_{i=1}^n p(y_i|S, D_i) \\propto \\exp\\left(-\\sum_{i=1}^n \\frac{(y_i - S D_i)^2}{2\\sigma_\\epsilon^2}\\right)\n$$\nAccording to Bayes' theorem, the posterior distribution of $S$ is proportional to the product of the likelihood and the prior:\n$$\np(S|\\mathcal{D}) \\propto p(\\mathcal{D}|S) p(S)\n$$\nThe argument of the exponent in the posterior PDF is the sum of the exponents from the likelihood and the prior:\n$$\n\\ln p(S|\\mathcal{D}) = -\\frac{1}{2\\sigma_\\epsilon^2}\\sum_{i=1}^n (y_i - S D_i)^2 - \\frac{1}{2\\sigma_0^2}(S-\\mu_0)^2 + \\text{const}\n$$\nExpanding the squared terms and collecting terms in $S^2$ and $S$:\n$$\n\\text{exponent} = -\\frac{1}{2} \\left[ \\left(\\frac{\\sum D_i^2}{\\sigma_\\epsilon^2} + \\frac{1}{\\sigma_0^2}\\right)S^2 - 2\\left(\\frac{\\sum y_i D_i}{\\sigma_\\epsilon^2} + \\frac{\\mu_0}{\\sigma_0^2}\\right)S \\right] + \\text{const}\n$$\nThis is a quadratic form in $S$, which indicates that the posterior distribution is also Gaussian, $S|\\mathcal{D} \\sim \\mathcal{N}(\\mu_n, \\sigma_n^2)$. By completing the square or matching coefficients with the standard Gaussian exponent form $-\\frac{(S-\\mu_n)^2}{2\\sigma_n^2} = -\\frac{1}{2\\sigma_n^2}(S^2 - 2\\mu_n S + \\mu_n^2)$, we identify the posterior variance $\\sigma_n^2$ and mean $\\mu_n$.\n\nThe inverse of the posterior variance (precision) is:\n$$\n\\frac{1}{\\sigma_n^2} = \\frac{1}{\\sigma_0^2} + \\frac{\\sum_{i=1}^n D_i^2}{\\sigma_\\epsilon^2} \\implies \\sigma_n^2 = \\left(\\frac{1}{\\sigma_0^2} + \\frac{\\sum_{i=1}^n D_i^2}{\\sigma_\\epsilon^2}\\right)^{-1}\n$$\nThe posterior mean is:\n$$\n\\mu_n = \\sigma_n^2 \\left(\\frac{\\mu_0}{\\sigma_0^2} + \\frac{\\sum_{i=1}^n y_i D_i}{\\sigma_\\epsilon^2}\\right) = \\sigma_n^2 \\left(\\frac{\\mu_0}{\\sigma_0^2} + \\frac{\\sum_{i=1}^n (G_{\\text{phys}} - G_i)D_i}{\\sigma_\\epsilon^2}\\right)\n$$\nIn the case of no data ($n=0$), the sums are zero, and we recover the prior: $\\sigma_n^2 = \\sigma_0^2$ and $\\mu_n = \\mu_0$.\n\n**2. Predictive Distribution of Future Glucose ($G_{\\text{next}}$)**\n\nFor a prospective dose $D$, the next fasting glucose is modeled as:\n$$\nG_{\\text{next}} = G_{\\text{phys}} - S D + \\epsilon\n$$\nwhere $S \\sim \\mathcal{N}(\\mu_n, \\sigma_n^2)$ is drawn from the posterior distribution and $\\epsilon \\sim \\mathcal{N}(0, \\sigma_\\epsilon^2)$ is a new noise term. Since $G_{\\text{next}}$ is a linear combination of a constant and two independent Gaussian random variables ($S$ and $\\epsilon$), it is also a Gaussian random variable.\n\nThe mean of the predictive distribution is found using the law of total expectation:\n$$\n\\mu_{G_{\\text{next}}} = \\mathbb{E}[G_{\\text{next}}] = \\mathbb{E}[G_{\\text{phys}} - S D + \\epsilon] = G_{\\text{phys}} - \\mathbb{E}[S]D + \\mathbb{E}[\\epsilon] = G_{\\text{phys}} - \\mu_n D\n$$\nThe variance is found using the law of total variance, $\\text{Var}(X) = \\mathbb{E}[\\text{Var}(X|Y)] + \\text{Var}(\\mathbb{E}[X|Y])$:\n$$\n\\sigma_{G_{\\text{next}}}^2 = \\text{Var}(G_{\\text{next}}) = \\text{Var}(G_{\\text{phys}} - S D + \\epsilon) = \\text{Var}(-SD) + \\text{Var}(\\epsilon)\n$$\nBecause $S$ and $\\epsilon$ are independent.\n$$\n\\sigma_{G_{\\text{next}}}^2 = (-D)^2 \\text{Var}(S) + \\sigma_\\epsilon^2 = D^2 \\sigma_n^2 + \\sigma_\\epsilon^2\n$$\nThus, the predictive distribution is:\n$$\nG_{\\text{next}} \\sim \\mathcal{N}(G_{\\text{phys}} - \\mu_n D, D^2 \\sigma_n^2 + \\sigma_\\epsilon^2)\n$$\n\n**3. Dose Recommendation Strategy**\n\nThe optimal dose $D^\\star$ is determined by a two-step process involving an ideal dose calculation and a safety check.\n\nFirst, we find the ideal dose, $D_{\\text{ideal}}$, that sets the expected future glucose to the target value, $G_{\\text{target}}$:\n$$\n\\mathbb{E}[G_{\\text{next}}] = G_{\\text{target}} \\implies G_{\\text{phys}} - \\mu_n D_{\\text{ideal}} = G_{\\text{target}}\n$$\nSolving for $D_{\\text{ideal}}$, and ensuring non-negativity:\n$$\nD_{\\text{ideal}} = \\max\\left(0, \\frac{G_{\\text{phys}} - G_{\\text{target}}}{\\mu_n}\\right)\n$$\nThis assumes $\\mu_n  0$, which is physiologically expected. If $\\mu_n \\le 0$, the logical dose is $0$.\n\nSecond, we check $D_{\\text{ideal}}$ against the safety constraint:\n$$\n\\mathbb{P}(G_{\\text{next}}  T_{\\text{hypo}})  p_{\\max}\n$$\nLet $\\Phi(\\cdot)$ be the cumulative distribution function (CDF) of the standard normal distribution $\\mathcal{N}(0, 1)$. The probability of hypoglycemia for a dose $D$ is:\n$$\nP(D) = \\mathbb{P}(G_{\\text{next}}  T_{\\text{hypo}}) = \\Phi\\left(\\frac{T_{\\text{hypo}} - \\mu_{G_{\\text{next}}}}{\\sigma_{G_{\\text{next}}}}\\right) = \\Phi\\left(\\frac{T_{\\text{hypo}} - (G_{\\text{phys}} - \\mu_n D)}{\\sqrt{D^2 \\sigma_n^2 + \\sigma_\\epsilon^2}}\\right)\n$$\nThe final recommended dose $D^\\star$ is determined as follows:\n- If $P(D_{\\text{ideal}})  p_{\\max}$, then $D_{\\text{ideal}}$ is safe and we set $D^\\star = D_{\\text{ideal}}$.\n- If $P(D_{\\text{ideal}}) \\ge p_{\\max}$, then $D_{\\text{ideal}}$ is too aggressive. We must cap the dose at the maximum value that satisfies the safety constraint. This dose, $D_{\\text{safe}}$, is the solution to the equation $P(D) = p_{\\max}$. Let $z_{p_{\\max}} = \\Phi^{-1}(p_{\\max})$ be the standard normal quantile for probability $p_{\\max}$. The equation becomes:\n$$\n\\frac{T_{\\text{hypo}} - (G_{\\text{phys}} - \\mu_n D)}{\\sqrt{D^2 \\sigma_n^2 + \\sigma_\\epsilon^2}} = z_{p_{\\max}}\n$$\nThe hypoglycemia probability $P(D)$ is a monotonically increasing function of $D$ (for $\\mu_n  0$). This guarantees a unique solution for $D_{\\text{safe}}$ in the interval $[0, D_{\\text{ideal}}]$, which can be found efficiently using a numerical root-finding algorithm like the bisection method or Brent's method. In this case, we set $D^\\star = D_{\\text{safe}}$. The recommended dose must be non-negative. If even a dose of $0$ violates the safety constraint, a non-negative dose satisfying the strict inequality does not exist. However, for the given problem parameters, a dose of $0$ is always safe, so a valid $D^\\star \\ge 0$ can be found.",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Main function to solve the Bayesian insulin titration problem for all test cases.\n    \"\"\"\n    # Test cases as defined in the problem statement.\n    test_cases = [\n        # Case A\n        (1.0, 0.3, 10.0, 200.0, 110.0, 70.0, 0.05, \n         np.array([(10.0, 190.0), (20.0, 175.0), (30.0, 160.0)])),\n        # Case B\n        (1.5, 0.2, 8.0, 180.0, 100.0, 70.0, 0.05, \n         np.array([(8.0, 160.0), (10.0, 145.0), (12.0, 130.0)])),\n        # Case C\n        (1.2, 0.5, 25.0, 220.0, 120.0, 70.0, 0.05, \n         np.array([(20.0, 205.0), (25.0, 200.0), (30.0, 190.0)])),\n        # Case D\n        (1.0, 0.4, 12.0, 210.0, 130.0, 70.0, 0.05, \n         np.array([]))\n    ]\n\n    results = []\n    for case in test_cases:\n        recommended_dose = calculate_dose(*case)\n        # Format the result to one decimal place as a string\n        results.append(f\"{recommended_dose:.1f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_dose(mu_0, sigma_0, sigma_eps, G_phys, G_target, T_hypo, p_max, data):\n    \"\"\"\n    Calculates the recommended basal insulin dose for a single case.\n    \"\"\"\n    # Step 1: Calculate posterior distribution of sensitivity S\n    var_0 = sigma_0**2\n    var_eps = sigma_eps**2\n\n    if data.size == 0:\n        mu_n = mu_0\n        var_n = var_0\n    else:\n        D_i = data[:, 0]\n        G_i = data[:, 1]\n        \n        sum_D_sq = np.sum(D_i**2)\n        y_i = G_phys - G_i\n        sum_yD = np.sum(y_i * D_i)\n        \n        # Posterior variance (from precision)\n        precision_n = (1 / var_0) + (sum_D_sq / var_eps)\n        var_n = 1 / precision_n\n        \n        # Posterior mean\n        mu_n = var_n * ((mu_0 / var_0) + (sum_yD / var_eps))\n\n    # Step 2: Calculate the ideal dose\n    if mu_n = 0:\n        D_ideal = 0.0\n    else:\n        D_ideal = max(0.0, (G_phys - G_target) / mu_n)\n\n    # Step 3: Check safety constraint and find optimal dose\n    z_p_max = norm.ppf(p_max)\n\n    def get_hypo_prob(D):\n        \"\"\"Calculates P(G_next  T_hypo) for a given dose D.\"\"\"\n        if D  0: return 0.0\n        \n        mean_G_next = G_phys - mu_n * D\n        var_G_next = D**2 * var_n + var_eps\n        std_G_next = np.sqrt(var_G_next)\n        \n        z_score = (T_hypo - mean_G_next) / std_G_next\n        return norm.cdf(z_score)\n\n    # Check if dose D=0 is safe. This should generally be true.\n    # If not, no non-negative dose can be recommended under the strict inequality.\n    # We recommend 0 as the only possible non-negative dose.\n    if get_hypo_prob(0.0) = p_max:\n        return 0.0\n\n    # Check if the ideal dose is safe\n    if get_hypo_prob(D_ideal)  p_max:\n        D_star = D_ideal\n    else:\n        # D_ideal is unsafe. Find the maximum safe dose by root-finding.\n        # We need to find D such that get_hypo_prob(D) - p_max = 0.\n        # The root is bracketed by [0, D_ideal] because P(D) is monotonic.\n        \n        def root_func(D):\n            return get_hypo_prob(D) - p_max\n            \n        try:\n            # brentq is a robust and efficient root-finding algorithm.\n            D_safe = brentq(root_func, 0, D_ideal)\n            D_star = D_safe\n        except ValueError:\n            # This case (no root in the interval) should not happen\n            # if P(0)  p_max and P(D_ideal) = p_max.\n            # As a fallback, return the safe boundary of 0.\n            D_star = 0.0\n\n    return D_star\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}