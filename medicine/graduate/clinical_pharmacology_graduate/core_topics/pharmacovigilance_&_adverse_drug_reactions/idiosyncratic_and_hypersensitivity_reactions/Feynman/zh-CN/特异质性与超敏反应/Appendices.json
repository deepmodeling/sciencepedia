{
    "hands_on_practices": [
        {
            "introduction": "许多特异质性药物反应的根源在于药物生物活化后形成的活性代谢物。本练习通过建立一个动力学模型，来量化毒性通路（蛋白质加合物形成）与解毒通路之间的竞争关系。通过这个实践，您将亲手计算并理解谷胱甘肽（GSH）水平以及N-乙酰半胱氨酸（NAC）等干预措施如何从数量上改变毒性风险，这对于理解和预防药物诱导的损伤至关重要 。",
            "id": "4559376",
            "problem": "一种小分子母体药物在细胞内处于稳态浓度 $[D]$，它经过生物活化生成活性代谢物 $[M]$。该活性代谢物可以被谷胱甘肽（GSH）结合解毒，或通过与亲核残基（有效蛋白亲核物库为 $[P]$）反应形成共价蛋白加合物，或通过其他一级途径被清除。N-乙酰半胱氨酸（NAC）作为一种硫醇供体被联合施用，它既能增加细胞内GSH库，又能提供一个平行的清除途径。假设细胞内条件充分混合，且所有步骤均遵循质量作用动力学。基本依据是标准质量作用定律和在持续母体药物暴露下对 $[M]$ 的稳态假设。\n\n在基线条件下（无NAC），活性代谢物由母体药物以一级速率常数 $k_{f}$ 生成，生成通量为 $k_{f}[D]$。竞争性消耗途径包括：与GSH的结合反应（二级速率常数为 $k_{g}$），蛋白加合反应（二级速率常数为 $k_{p}$），以及其他清除途径（一级速率常数为 $k_{c}$）。联合施用NAC后，同时发生两个变化：GSH库相对于基线增加了1.2倍，并增加了一条平行的二级NAC清除途径，其速率常数为 $k_{n}$，NAC浓度为 $[N]$。\n\n设基线值为：\n$[D] = 10 \\text{ μM}$，\n$[G] = 5 \\text{ mM}$，\n$[P] = 1 \\text{ mM}$，\n$k_{f} = 0.02 \\text{ s}^{-1}$，\n$k_{g} = 200 \\text{ M}^{-1} \\text{s}^{-1}$，\n$k_{p} = 20 \\text{ M}^{-1} \\text{s}^{-1}$，\n$k_{c} = 0.1 \\text{ s}^{-1}$。\n\n使用N-乙酰半胱氨酸（NAC）时，取：\n$[G]_{\\text{NAC}} = 1.2 \\times [G]$，\n$k_{n} = 50 \\text{ M}^{-1} \\text{s}^{-1}$，\n$[N] = 1 \\text{ mM}$。\n\n假设稳态下的蛋白加合物形成分数定义为，在 $[M]$ 的稳态条件下，活性代谢物处置通量中通过蛋白加合途径的比例。定义风险调节因子 $\\phi$ 为有NAC时的稳态蛋白加合物分数与无NAC时的该分数之比。使用上述参数计算 $\\phi$。将最终结果表示为无量纲的小数，并四舍五入至四位有效数字。最终答案中不包含任何单位符号。",
            "solution": "问题要求计算风险调节因子 $\\phi$，其定义为联合施用N-乙酰半胱氨酸（NAC）时的稳态蛋白加合物形成分数与基线（无NAC）时相同分数之比。该系统涉及由母体药物 $[D]$ 生成的活性代谢物 $[M]$，其随后通过几个竞争性途径被消除。分析基于质量作用动力学和对 $[M]$ 的稳态近似。\n\n首先，我们建立活性代谢物 $[M]$ 的动力学模型。其浓度变化率等于生成速率减去所有消除途径的速率之和。\n\n在基线情况下（无NAC），$[M]$ 的微分方程为：\n$$\n\\frac{d[M]}{dt} = \\text{生成速率} - \\text{消除速率}\n$$\n$$\n\\frac{d[M]}{dt} = k_f[D] - (k_g[M][G] + k_p[M][P] + k_c[M])\n$$\n其中 $k_f$ 是一级生成速率常数，而 $k_g$、$k_p$ 和 $k_c$ 分别是通过谷胱甘肽（GSH）结合、蛋白加合和其他清除途径消除的速率常数。母体药物、GSH和蛋白亲核物的浓度分别为 $[D]$、$[G]$ 和 $[P]$。\n\n在稳态假设下，$\\frac{d[M]}{dt} = 0$。这意味着生成速率等于总消除速率：\n$$\nk_f[D] = k_g[M]_{ss}[G] + k_p[M]_{ss}[P] + k_c[M]_{ss}\n$$\n这里，$[M]_{ss}$ 表示活性代谢物的稳态浓度。\n\n蛋白加合物形成分数 $f_{p, \\text{baseline}}$ 是通过蛋白加合途径的通量除以总消除通量。\n$$\nf_{p, \\text{baseline}} = \\frac{\\text{通量}_{\\text{蛋白}}}{\\text{通量}_{\\text{总}}} = \\frac{k_p[M]_{ss}[P]}{k_g[M]_{ss}[G] + k_p[M]_{ss}[P] + k_c[M]_{ss}}\n$$\n分子和分母中的所有项都含有 $[M]_{ss}$，因此可以消去。这将分数的表达式简化为伪一级速率常数的比值：\n$$\nf_{p, \\text{baseline}} = \\frac{k_p[P]}{k_g[G] + k_p[P] + k_c}\n$$\n\n接下来，我们考虑联合施用NAC的情况。发生两个变化：GSH浓度增加到 $[G]_{\\text{NAC}} = 1.2[G]$，并引入了一个涉及浓度为 $[N]$、速率常数为 $k_n$ 的NAC的新消除途径。速率方程变为：\n$$\n\\frac{d[M]}{dt} = k_f[D] - (k_g[M][G]_{\\text{NAC}} + k_p[M][P] + k_c[M] + k_n[M][N])\n$$\n含有NAC时的蛋白加合物形成分数 $f_{p, \\text{NAC}}$ 的计算方法类似：\n$$\nf_{p, \\text{NAC}} = \\frac{k_p[M]_{ss, \\text{NAC}}[P]}{k_g[M]_{ss, \\text{NAC}}[G]_{\\text{NAC}} + k_p[M]_{ss, \\text{NAC}}[P] + k_c[M]_{ss, \\text{NAC}} + k_n[M]_{ss, \\text{NAC}}[N]}\n$$\n同样，稳态代谢物浓度 $[M]_{ss, \\text{NAC}}$ 被消去。代入 $[G]_{\\text{NAC}} = 1.2[G]$，我们得到：\n$$\nf_{p, \\text{NAC}} = \\frac{k_p[P]}{1.2k_g[G] + k_p[P] + k_c + k_n[N]}\n$$\n\n风险调节因子 $\\phi$ 是比值 $\\frac{f_{p, \\text{NAC}}}{f_{p, \\text{baseline}}}$。\n$$\n\\phi = \\frac{\\frac{k_p[P]}{1.2k_g[G] + k_p[P] + k_c + k_n[N]}}{\\frac{k_p[P]}{k_g[G] + k_p[P] + k_c}}\n$$\n$k_p[P]$ 项被消去，得到 $\\phi$ 的最终符号表达式：\n$$\n\\phi = \\frac{k_g[G] + k_p[P] + k_c}{1.2k_g[G] + k_p[P] + k_c + k_n[N]}\n$$\n\n现在，我们代入给定的数值。确保所有单位一致至关重要。我们将所有浓度转换为摩尔浓度（$M$）。\n给定的基线值：\n$[G] = 5 \\text{ mM} = 5 \\times 10^{-3} M$\n$[P] = 1 \\text{ mM} = 1 \\times 10^{-3} M$\n$k_g = 200 \\text{ M}^{-1}\\text{s}^{-1}$\n$k_p = 20 \\text{ M}^{-1}\\text{s}^{-1}$\n$k_c = 0.1 \\text{ s}^{-1}$\n\n给定的NAC值：\n$[N] = 1 \\text{ mM} = 1 \\times 10^{-3} M$\n$k_n = 50 \\text{ M}^{-1}\\text{s}^{-1}$\n\n让我们计算 $\\phi$ 表达式中每一项的值。这些项代表伪一级速率常数，单位为 $\\text{s}^{-1}$。\n- 分子项 $k_g[G] = (200 \\text{ M}^{-1}\\text{s}^{-1}) \\times (5 \\times 10^{-3} \\text{ M}) = 1.0 \\text{ s}^{-1}$。\n- 分子项 $k_p[P] = (20 \\text{ M}^{-1}\\text{s}^{-1}) \\times (1 \\times 10^{-3} \\text{ M}) = 0.02 \\text{ s}^{-1}$。\n- 分子项 $k_c = 0.1 \\text{ s}^{-1}$。\n\n$\\phi$ 的分子（基线总伪一级消除速率）是：\n$$\nk_{\\text{elim, baseline}} = k_g[G] + k_p[P] + k_c = 1.0 + 0.02 + 0.1 = 1.12 \\text{ s}^{-1}\n$$\n\n对于 $\\phi$ 的分母，我们有附加项 $k_n[N]$ 和GSH的修正项。\n- 分母项 $1.2k_g[G] = 1.2 \\times (1.0 \\text{ s}^{-1}) = 1.2 \\text{ s}^{-1}$。\n- 分母项 $k_n[N] = (50 \\text{ M}^{-1}\\text{s}^{-1}) \\times (1 \\times 10^{-3} \\text{ M}) = 0.05 \\text{ s}^{-1}$。\n\n$\\phi$ 的分母（NAC总伪一级消除速率）是：\n$$\nk_{\\text{elim, NAC}} = 1.2k_g[G] + k_p[P] + k_c + k_n[N] = 1.2 + 0.02 + 0.1 + 0.05 = 1.37 \\text{ s}^{-1}\n$$\n\n最后，我们计算 $\\phi$：\n$$\n\\phi = \\frac{k_{\\text{elim, baseline}}}{k_{\\text{elim, NAC}}} = \\frac{1.12}{1.37} \\approx 0.8175182...\n$$\n将结果四舍五入至四位有效数字，得到 $0.8175$。",
            "answer": "$$\\boxed{0.8175}$$"
        },
        {
            "introduction": "在理解了反应的生物化学机制后，下一个关键步骤是预测个体风险。本练习将探讨如何解读用于预测超敏反应的药物基因组学检测结果。您将通过应用贝叶斯定理来计算阳性预测值（PPV），并由此深入理解为何即使一个技术上非常精确的检测，在患病率较低的人群中其预测能力也可能受限，这是个体化医疗中一个极其重要的概念 。",
            "id": "4559365",
            "problem": "一项药物基因组学筛查检测可检测出一种与人类白细胞抗原（HLA）相关的遗传标记，该标记预示着对特定药物存在特异质超敏反应的易感性。设$H$表示患者确实具有HLA相关的超敏易感性的事件，设$T^{+}$表示筛查检测结果为阳性的事件。假设以下为已知，且与标准临床检验特征一致：灵敏度为$P(T^{+}\\,|\\,H)$，特异度为$P(T^{-}\\,|\\,H^{c})$，患病率为$P(H)$。仅从条件概率的公理化定义$P(A\\,|\\,B)=\\frac{P(A\\cap B)}{P(B)}$和全概率定律出发，推导更新后的概率$P(H\\,|\\,T^{+})$的表达式，该表达式以$P(T^{+}\\,|\\,H)$、$P(H)$、$P(T^{+}\\,|\\,H^{c})$和$P(H^{c})$表示。将$P(H\\,|\\,T^{+})$解释为该检测在此临床背景下的阳性预测值（PPV），然后计算在患病率$P(H)=0.02$、灵敏度$P(T^{+}\\,|\\,H)=0.95$和特异度$P(T^{-}\\,|\\,H^{c})=0.99$的人群中的PPV。将PPV表示为小数，并将您的答案四舍五入到四位有效数字。",
            "solution": "该问题要求推导诊断检验的阳性预测值（PPV）的表达式，然后根据给定的具体检验特征计算其值。该问题的提法明确，并以应用于临床诊断学的概率论原理为科学基础。\n\n首先，我们将推导$P(H\\,|\\,T^{+})$的表达式，即在检测结果为阳性（$T^{+}$）的条件下，患者具有超敏易感性（$H$）的概率。这个量被定义为PPV。推导将从条件概率的公理化定义开始。\n\n根据条件概率的定义，我们有：\n$$ P(H\\,|\\,T^{+}) = \\frac{P(H \\cap T^{+})}{P(T^{+})} $$\n分子 $P(H \\cap T^{+})$ 可以使用 $P(T^{+}\\,|\\,H)$ 的条件概率定义来表示：\n$$ P(T^{+}\\,|\\,H) = \\frac{P(T^{+} \\cap H)}{P(H)} $$\n整理这个方程得到：\n$$ P(H \\cap T^{+}) = P(T^{+}\\,|\\,H) P(H) $$\n该项表示真阳性结果的联合概率。\n\n接下来，我们处理分母 $P(T^{+})$。我们使用全概率定律。患者的样本空间可以被划分为两个互斥且穷尽的事件：具有易感性的人（$H$）和不具有易感性的人（$H^{c}$）。因此，事件 $T^{+}$ 可以写成两个不相交事件的并集：$(T^{+} \\cap H)$ 和 $(T^{+} \\cap H^{c})$。\n$$ P(T^{+}) = P(T^{+} \\cap H) + P(T^{+} \\cap H^{c}) $$\n我们已经表示了第一项 $P(T^{+} \\cap H)$。第二项 $P(T^{+} \\cap H^{c})$ 可以类似地使用 $P(T^{+}\\,|\\,H^{c})$ 的条件概率定义来表示：\n$$ P(T^{+}\\,|\\,H^{c}) = \\frac{P(T^{+} \\cap H^{c})}{P(H^{c})} $$\n整理得到：\n$$ P(T^{+} \\cap H^{c}) = P(T^{+}\\,|\\,H^{c}) P(H^{c}) $$\n该项表示假阳性结果的联合概率。\n\n将这些表达式代入 $P(T^{+})$ 的方程中：\n$$ P(T^{+}) = P(T^{+}\\,|\\,H) P(H) + P(T^{+}\\,|\\,H^{c}) P(H^{c}) $$\n现在，我们将分子和分母的表达式代回到 $P(H\\,|\\,T^{+})$ 的原始方程中：\n$$ P(H\\,|\\,T^{+}) = \\frac{P(T^{+}\\,|\\,H) P(H)}{P(T^{+}\\,|\\,H) P(H) + P(T^{+}\\,|\\,H^{c}) P(H^{c})} $$\n这就是所求的表达式，在此背景下通常称为贝叶斯定理。\n\n问题给出了特异度 $P(T^{-}\\,|\\,H^{c})$ 的值，但推导出的公式需要 $P(T^{+}\\,|\\,H^{c})$。由于对于给定的子群体，检验结果要么是阳性（$T^{+}$）要么是阴性（$T^{-}$），因此这些事件是互补的。因此，对于不具有易感性的子群体（$H^{c}$），我们有：\n$$ P(T^{+}\\,|\\,H^{c}) + P(T^{-}\\,|\\,H^{c}) = 1 $$\n因此，假阳性率 $P(T^{+}\\,|\\,H^{c})$ 可以用特异度表示：\n$$ P(T^{+}\\,|\\,H^{c}) = 1 - P(T^{-}\\,|\\,H^{c}) $$\n将此代入我们推导的公式，就可以用标准的临床检验特征来表示PPV：灵敏度（$P(T^{+}\\,|\\,H)$）、特异度（$P(T^{-}\\,|\\,H^{c})$）和患病率（$P(H)$）。项 $P(H^c)$ 就是 $1-P(H)$。\n\n在临床流行病学中，将 $P(H\\,|\\,T^{+})$ 解释为阳性预测值（PPV）是标准做法。它回答了关键的临床问题：“如果我的病人检测结果为阳性，他们实际患有该病的概率是多少？”\n\n现在，我们用给定的值计算PPV：\n患病率：$P(H) = 0.02$\n灵敏度：$P(T^{+}\\,|\\,H) = 0.95$\n特异度：$P(T^{-}\\,|\\,H^{c}) = 0.99$\n\n根据这些值，我们推导出其他必要的量：\n不具有易感性的概率：$P(H^{c}) = 1 - P(H) = 1 - 0.02 = 0.98$\n假阳性率：$P(T^{+}\\,|\\,H^{c}) = 1 - P(T^{-}\\,|\\,H^{c}) = 1 - 0.99 = 0.01$\n\n我们将这些值代入推导出的PPV公式中：\n$$ \\text{PPV} = P(H\\,|\\,T^{+}) = \\frac{P(T^{+}\\,|\\,H) P(H)}{P(T^{+}\\,|\\,H) P(H) + P(T^{+}\\,|\\,H^{c}) P(H^{c})} $$\n$$ \\text{PPV} = \\frac{(0.95)(0.02)}{(0.95)(0.02) + (0.01)(0.98)} $$\n首先，我们计算分子和分母中的两项：\n分子：$0.95 \\times 0.02 = 0.019$\n分母第1项（真阳性）：$0.95 \\times 0.02 = 0.019$\n分母第2项（假阳性）：$0.01 \\times 0.98 = 0.0098$\n\n将分母中的各项相加：\n$P(T^{+}) = 0.019 + 0.0098 = 0.0288$\n\n现在，我们计算最终的比率：\n$$ \\text{PPV} = \\frac{0.019}{0.0288} $$\n$$ \\text{PPV} \\approx 0.6597222... $$\n问题要求将答案四舍五入到四位有效数字。前四位有效数字是$6$、$5$、$9$和$7$。第五位有效数字是$2$，小于$5$，所以我们向下舍入（即，我们不改变第四位数字）。\n$$ \\text{PPV} \\approx 0.6597 $$\n这个结果表明，对于来自该人群且检测结果呈阳性的患者，他们实际具有超敏易感性的机会约为$66\\%$，尽管该检测具有很高的灵敏度和特异度。这说明了患病率对诊断检测预测值的强大影响。",
            "answer": "$$\\boxed{0.6597}$$"
        },
        {
            "introduction": "在临床研究和药物警戒实践中，我们常需要根据已有数据对观察到的不良事件进行分类。这个高级练习要求您运用统计建模方法，来区分剂量非依赖性的B型反应（特异质性）与剂量依赖性的A型反应。通过构建和比较两个基于指数分布的竞争模型并计算似然比，您将掌握一种基于临床数据对科学假说进行量化比较的强大方法 。",
            "id": "4559362",
            "problem": "给定您多个独立的数据集，其中包含单一药物的不良事件发生时间及相应的单次剂量暴露。科学目标是检验不良事件的发生时间是否与剂量无关（与 B 型特异质或超敏反应一致），而非剂量依赖性（与 A 型（增强的药理作用）反应一致）。请为发生时间分布构建两个参数模型之间的基于似然的比较，并为每个数据集计算支持剂量无关假设的似然比。您的程序必须从基本定义开始实现以下内容，不使用任何外部输入。\n\n基本基础：\n- 假设每个个体内部的不良事件发生遵循一个齐次泊松过程，因此事件的等待时间服从指数分布。风险率定义为 $h(t) = \\lambda$，其中风险率随时间恒定意味着等待时间为指数分布，其率为 $\\lambda$。\n- 模型 $\\mathcal{M}_B$（B 型，剂量无关）：个体 $i$ 的不良事件发生时间 $t_i$ 服从指数分布，其率 $\\lambda$ 不依赖于剂量，即对所有 $i$ 都有 $\\lambda_i = \\lambda$。\n- 模型 $\\mathcal{M}_A$（A 型，剂量依赖）：个体 $i$ 的不良事件发生时间 $t_i$ 服从指数分布，其个体率 $\\lambda_i$ 通过对数线性关系 $\\lambda_i = \\exp(\\alpha + \\beta d_i)$ 依赖于剂量 $d_i$，其中 $\\alpha$ 和 $\\beta$ 是实值参数。\n\n定义与假设：\n- 对于 $n$ 个独立的个体（索引为 $i \\in \\{1,\\dots,n\\}$），观测到的发生时间为 $\\{t_i\\}$（每个 $t_i > 0$），剂量为 $\\{d_i\\}$（每个 $d_i \\ge 0$），在个体率为 $\\lambda_i$ 的指数模型下的联合似然为 $L = \\prod_{i=1}^{n} \\lambda_i \\exp(-\\lambda_i t_i)$。\n- 在 $\\mathcal{M}_B$ 下的最大似然估计（Maximum Likelihood Estimation (MLE)）通过对 $\\lambda$ 进行优化得到，而在 $\\mathcal{M}_A$ 下则通过对 $\\alpha$ 和 $\\beta$ 进行优化得到。\n- 支持 $\\mathcal{M}_B$ 的似然比定义为 $\\mathrm{LR} = \\dfrac{L(\\hat{\\lambda}\\,|\\,\\mathcal{M}_B)}{L(\\hat{\\alpha},\\hat{\\beta}\\,|\\,\\mathcal{M}_A)}$，等价于 $\\mathrm{LR} = \\exp\\!\\left(\\ell_B(\\hat{\\lambda}) - \\ell_A(\\hat{\\alpha},\\hat{\\beta})\\right)$，其中 $\\ell$ 表示对数似然。\n\n推导目标（将由您的程序实现）：\n1. 在 $\\mathcal{M}_B$ 下，推导最大似然估计 $\\hat{\\lambda}$ 和最大化对数似然 $\\ell_B(\\hat{\\lambda})$，将其表示为 $n$ 和 $\\sum_{i=1}^{n} t_i$ 的函数。\n2. 在 $\\mathcal{M}_A$ 下，通过 $\\alpha$ 的得分方程将其消去，从而推导出关于 $\\beta$ 的剖面对数似然，并使用数值稳定的方法计算最大化对数似然 $\\ell_A(\\hat{\\alpha},\\hat{\\beta})$。具体来说，定义 $S(\\beta) = \\sum_{i=1}^{n} t_i \\exp(\\beta d_i)$ 并证明最优的 $\\hat{\\alpha}$ 满足 $\\exp(\\hat{\\alpha}) = \\dfrac{n}{S(\\beta)}$。利用此关系将剖面对数似然表示为 $\\beta$ 的函数，并在一个合理的有界区间内对其进行数值最大化。\n3. 对于所有 $i$ 的 $d_i$ 都为常数的退化剂量集，解释 $\\mathcal{M}_A$ 如何退化为 $\\mathcal{M}_B$ 且 $\\beta$ 不可识别，并确保您的程序在这种情况下返回 $\\mathrm{LR} = 1$。\n\n单位与输出：\n- 发生时间 $t_i$ 必须以小时（$\\mathrm{h}$）为单位处理。剂量 $d_i$ 必须以毫克（$\\mathrm{mg}$）为单位处理。似然比是无量纲的。将最终结果表示为十进制数。\n- 您的程序必须产生单行输出，其中包含所有数据集的似然比，形式为一个用方括号括起来的逗号分隔列表，每个值四舍五入到六位小数，例如：[0.842105, 0.000004, 1.000000, 0.003955]。\n\n测试套件（每个案例都是一个 $(t_i,d_i)$ 对的列表）：\n- 案例 1（剂量无关模式，中等变异性）：$[(12,50),(18,100),(22,150),(19,200),(24,250),(21,300)]$，其中 $t_i$ 单位为 $\\mathrm{h}$，$d_i$ 单位为 $\\mathrm{mg}$。\n- 案例 2（剂量依赖模式，时间随剂量增加而减少）：$[(28,50),(25,100),(20,150),(10,200),(6,250),(3,300)]$，其中 $t_i$ 单位为 $\\mathrm{h}$，$d_i$ 单位为 $\\mathrm{mg}$。\n- 案例 3（边界情况，恒定剂量）：$[(15,200),(20,200),(18,200),(17,200)]$，其中 $t_i$ 单位为 $\\mathrm{h}$，$d_i$ 单位为 $\\mathrm{mg}$。\n- 案例 4（混合零剂量和非零剂量，合理的变异性）：$[(22,0),(20,0),(18,100),(9,200),(19,0),(4,300)]$，其中 $t_i$ 单位为 $\\mathrm{h}$，$d_i$ 单位为 $\\mathrm{mg}$。\n\n算法要求：\n- 使用指数等待时间模型实现 $\\mathcal{M}_B$ 和 $\\mathcal{M}_A$ 下的精确似然函数。在优化关于 $\\beta$ 的剖面对数似然时，通过 log-sum-exp 变换对 $\\log S(\\beta)$ 进行数值稳定的计算。\n- 对于 $\\beta$ 的优化，在一个以零为中心的对称有界区间上进行一维搜索，该区间需足够宽以捕捉实际的剂量效应（例如，单位为 1/毫克的 $[-0.2,0.2]$），并根据防止数值溢出和保持科学现实性来证明选择的合理性。\n- 为每种情况返回支持 $\\mathcal{M}_B$ 的似然比（浮点数）。将所有结果聚合到一个指定的列表中。\n\n您的程序应生成单行输出，其中包含结果，形式为一个用方括号括起来的逗号分隔列表（例如 [r_1,r_2,r_3,r_4]），其中每个 $r_k$ 是案例 $k$ 的似然比，四舍五入到六位小数。",
            "solution": "该问题要求对两种关于单次剂量药物暴露后不良事件发生时间的竞争模型进行统计比较。第一个模型 $\\mathcal{M}_B$ 假定发生时间与剂量无关，这是 B 型（特异质/超敏）反应的特征。第二个模型 $\\mathcal{M}_A$ 假设存在剂量依赖关系，这与 A 型（增强的药理作用）反应一致。比较将通过计算似然比 $\\mathrm{LR}$ 来进行，该值量化了支持剂量无关模型 $\\mathcal{M}_B$ 优于剂量依赖模型 $\\mathcal{M}_A$ 的证据。两个模型的基础都是事件发生服从指数分布的假设，该假设源于齐次泊松过程。\n\n对于一个包含 $n$ 个个体的数据集，其观测到的发生时间为 $\\{t_i\\}_{i=1}^n$，相应剂量为 $\\{d_i\\}_{i=1}^n$，其联合似然由 $L = \\prod_{i=1}^{n} p(t_i | \\lambda_i)$ 给出，其中 $p(t | \\lambda) = \\lambda \\exp(-\\lambda t)$ 是率参数为 $\\lambda$ 的指数分布的概率密度函数。相应的对数似然为 $\\ell = \\sum_{i=1}^{n} (\\log \\lambda_i - \\lambda_i t_i)$。\n\n我们将首先推导每个模型的最大化对数似然，然后讨论模型 $\\mathcal{M}_A$ 的数值程序，处理恒定剂量的特殊情况，最后计算似然比。\n\n**模型 $\\mathcal{M}_B$：剂量无关反应**\n在此模型下，风险率对所有个体都是恒定的，无论施用何种剂量。因此，对所有 $i \\in \\{1, \\dots, n\\}$，$\\lambda_i = \\lambda$。$\\mathcal{M}_B$ 的对数似然函数为：\n$$ \\ell_B(\\lambda) = \\sum_{i=1}^{n} (\\log \\lambda - \\lambda t_i) = n \\log \\lambda - \\lambda \\sum_{i=1}^{n} t_i $$\n为了找到 $\\lambda$ 的最大似然估计（MLE），我们对 $\\ell_B(\\lambda)$ 关于 $\\lambda$ 求导，并令结果为零：\n$$ \\frac{\\partial \\ell_B}{\\partial \\lambda} = \\frac{n}{\\lambda} - \\sum_{i=1}^{n} t_i = 0 $$\n求解 $\\lambda$ 得到最大似然估计 $\\hat{\\lambda}$：\n$$ \\hat{\\lambda} = \\frac{n}{\\sum_{i=1}^{n} t_i} $$\n这是发生时间样本均值的倒数，是指数分布的一个标准结果。\n\n最大化对数似然 $\\ell_B(\\hat{\\lambda})$ 通过将 $\\hat{\\lambda}$ 代入对数似然函数得到：\n$$ \\ell_B(\\hat{\\lambda}) = n \\log\\left(\\frac{n}{\\sum_{i=1}^{n} t_i}\\right) - \\left(\\frac{n}{\\sum_{i=1}^{n} t_i}\\right) \\sum_{i=1}^{n} t_i = n (\\log n - \\log(\\sum_{i=1}^{n} t_i)) - n $$\n\n**模型 $\\mathcal{M}_A$：剂量依赖反应**\n该模型通过对率参数的对数线性关系引入剂量依赖性：$\\lambda_i = \\exp(\\alpha + \\beta d_i)$。待估计的参数是 $\\alpha$ 和 $\\beta$。$\\mathcal{M}_A$ 的对数似然函数为：\n$$ \\ell_A(\\alpha, \\beta) = \\sum_{i=1}^{n} \\left[ \\log(\\exp(\\alpha + \\beta d_i)) - t_i \\exp(\\alpha + \\beta d_i) \\right] $$\n$$ \\ell_A(\\alpha, \\beta) = \\sum_{i=1}^{n} (\\alpha + \\beta d_i) - \\sum_{i=1}^{n} t_i \\exp(\\alpha + \\beta d_i) $$\n$$ \\ell_A(\\alpha, \\beta) = n\\alpha + \\beta \\sum_{i=1}^{n} d_i - \\exp(\\alpha) \\sum_{i=1}^{n} t_i \\exp(\\beta d_i) $$\n为了找到最大似然估计 $(\\hat{\\alpha}, \\hat{\\beta})$，我们必须联合最大化此函数。直接的解析最大化是难以处理的，因此我们采用剖面似然方法。对于一个固定的 $\\beta$ 值，我们首先关于 $\\alpha$ 最大化 $\\ell_A$。关于 $\\alpha$ 的偏导数为：\n$$ \\frac{\\partial \\ell_A}{\\partial \\alpha} = n - \\exp(\\alpha) \\sum_{i=1}^{n} t_i \\exp(\\beta d_i) $$\n将其设为零，我们解出 $\\exp(\\hat{\\alpha})$：\n$$ \\exp(\\hat{\\alpha}) = \\frac{n}{\\sum_{i=1}^{n} t_i \\exp(\\beta d_i)} = \\frac{n}{S(\\beta)} $$\n其中我们定义 $S(\\beta) = \\sum_{i=1}^{n} t_i \\exp(\\beta d_i)$。这给出了最大似然估计 $\\hat{\\alpha}$ 作为 $\\beta$ 的函数：$\\hat{\\alpha}(\\beta) = \\log n - \\log(S(\\beta))$。\n\n将 $\\hat{\\alpha}(\\beta)$ 代入 $\\ell_A(\\alpha, \\beta)$ 得到关于 $\\beta$ 的剖面对数似然，记为 $\\ell_{A,p}(\\beta)$：\n$$ \\ell_{A,p}(\\beta) = n \\hat{\\alpha}(\\beta) + \\beta \\sum_{i=1}^{n} d_i - \\exp(\\hat{\\alpha}(\\beta)) S(\\beta) $$\n使用 $\\exp(\\hat{\\alpha})$ 的表达式，最后一项简化为：$\\exp(\\hat{\\alpha}(\\beta)) S(\\beta) = \\frac{n}{S(\\beta)} S(\\beta) = n$。\n$$ \\ell_{A,p}(\\beta) = n(\\log n - \\log(S(\\beta))) + \\beta \\sum_{i=1}^{n} d_i - n $$\n\n**数值最大化与似然比计算**\n最大似然估计 $\\hat{\\beta}$ 是通过数值最大化 $\\ell_{A,p}(\\beta)$ 找到的。这等价于最小化其负值。$-\\ell_{A,p}(\\beta)$ 中依赖于 $\\beta$ 的部分是 $n \\log(S(\\beta)) - \\beta \\sum_{i=1}^{n} d_i$。我们将对这个目标函数在一个有界区间内对 $\\beta$ 进行数值最小化。\n\n项 $S(\\beta) = \\sum_{i=1}^{n} t_i \\exp(\\beta d_i)$ 在 $\\beta d_i$ 值较大时可能导致数值溢出。为确保稳定性，我们使用 log-sum-exp 技巧计算其对数 $\\log(S(\\beta))$：\n$$ \\log S(\\beta) = \\log\\left(\\sum_{i=1}^{n} \\exp(\\log t_i + \\beta d_i)\\right) = x_{\\max} + \\log\\left(\\sum_{i=1}^{n} \\exp(x_i - x_{\\max})\\right) $$\n其中 $x_i = \\log t_i + \\beta d_i$ 且 $x_{\\max} = \\max_i(x_i)$。\n\n对 $\\hat{\\beta}$ 的搜索在一个对称区间 $[-0.2, 0.2]$（单位为 $\\mathrm{mg}^{-1}$）上进行。这一选择通过考虑科学背景来证明其合理性。一个 $\\beta = 0.2$ 的值意味着对于 $d_i=50\\,\\mathrm{mg}$ 的剂量，风险率乘以一个因子 $\\exp(0.2 \\times 50) = \\exp(10) \\approx 22026$。这代表了一个非常大的效应，远超通常观测到的范围。因此，区间 $[-0.2, 0.2]$ 足够宽，可以捕捉任何科学上合理的剂量-效应关系，同时防止极端参数值引起的数值不稳定性。\n\n设 $\\hat{\\beta}$ 是最小化目标函数的值，最小值为 $C_{\\min} = n \\log(S(\\hat{\\beta})) - \\hat{\\beta} \\sum d_i$。那么模型 $\\mathcal{M}_A$ 的最大化对数似然为：\n$$ \\ell_A(\\hat{\\alpha}, \\hat{\\beta}) = n \\log n - n - C_{\\min} $$\n最后，支持 $\\mathcal{M}_B$ 优于 $\\mathcal{M}_A$ 的似然比计算如下：\n$$ \\mathrm{LR} = \\exp(\\ell_B(\\hat{\\lambda}) - \\ell_A(\\hat{\\alpha}, \\hat{\\beta})) $$\n\n**特殊情况：恒定剂量**\n如果所有个体的剂量都是恒定的，即对所有 $i$，$d_i = d_{const}$，则模型 $\\mathcal{M}_A$ 中的率参数变为 $\\lambda_i = \\exp(\\alpha + \\beta d_{const})$。这个率对所有个体都是相同的。该模型在结构上等价于模型 $\\mathcal{M}_B$，其中单个率参数为 $\\lambda' = \\exp(\\alpha + \\beta d_{const})$。参数 $\\alpha$ 和 $\\beta$ 不可单独识别；任何满足 $\\alpha + \\beta d_{const} = \\log \\lambda'$ 的配对 $(\\alpha, \\beta)$ 都将产生相同的似然。$\\mathcal{M}_A$ 的最大似然将在与 $\\mathcal{M}_B$ 相同的值处达到，即 $L_A(\\hat{\\alpha}, \\hat{\\beta}) = L_B(\\hat{\\lambda})$。因此，似然比 $\\mathrm{LR}$ 必须恰好为 $1$。在计算上，通过检查剂量的标准差是否有效为零来识别此情况。\n\n所实现的算法将对每个数据集遵循以下步骤：\n1. 检查恒定剂量的情况。如果 `std(doses)` 接近零，则返回 $\\mathrm{LR}=1.0$。\n2. 计算剂量无关模型 $\\mathcal{M}_B$ 的最大化对数似然 $\\ell_B(\\hat{\\lambda})$。\n3. 使用有界一维优化器，数值求解最大似然估计 $\\hat{\\beta}$，该估计最大化了剖面对数似然 $\\ell_{A,p}(\\beta)$。\n4. 计算剂量依赖模型 $\\mathcal{M}_A$ 的最大化对数似然 $\\ell_A(\\hat{\\alpha}, \\hat{\\beta})$。\n5. 计算并返回似然比 $\\mathrm{LR} = \\exp(\\ell_B(\\hat{\\lambda}) - \\ell_A(\\hat{\\alpha}, \\hat{\\beta}))$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef calculate_lr(times: list[float], doses: list[float]) -> float:\n    \"\"\"\n    Calculates the likelihood ratio comparing a dose-independent model (M_B)\n    to a dose-dependent model (M_A) for adverse event onset times.\n\n    Args:\n        times: A list of observed onset times (t_i > 0).\n        doses: A list of corresponding doses (d_i >= 0).\n\n    Returns:\n        The likelihood ratio LR = L(M_B) / L(M_A).\n    \"\"\"\n    t_arr = np.array(times, dtype=np.float64)\n    d_arr = np.array(doses, dtype=np.float64)\n    n = len(t_arr)\n\n    # 1. Handle the degenerate case of constant dose\n    if np.std(d_arr)  1e-9:\n        return 1.0\n\n    # 2. Calculate the maximized log-likelihood for Model M_B (dose-independent)\n    # l_B = n*log(n) - n*log(sum(t_i)) - n\n    sum_t = np.sum(t_arr)\n    log_like_B = n * np.log(n) - n * np.log(sum_t) - n\n\n    # 3. Calculate the maximized log-likelihood for Model M_A (dose-dependent)\n    # This involves numerically optimizing the profile log-likelihood for beta.\n    \n    # The objective function to minimize is n*log(S(beta)) - beta*sum(d_i),\n    # where S(beta) = sum(t_i * exp(beta * d_i)).\n    def objective_A(beta: float, t_arr: np.ndarray, d_arr: np.ndarray) - float:\n        \"\"\"\n        Objective function for finding the MLE of beta in Model M_A.\n        Minimizing this is equivalent to maximizing the profile log-likelihood.\n        \"\"\"\n        n_pts = len(t_arr)\n        sum_d = np.sum(d_arr)\n        \n        # Numerically stable calculation of log(S(beta)) using log-sum-exp trick\n        # log(S(beta)) = log(sum(exp(log(t_i) + beta*d_i)))\n        log_t = np.log(t_arr)\n        terms = log_t + beta * d_arr\n        \n        max_term = np.max(terms)\n        log_S_beta = max_term + np.log(np.sum(np.exp(terms - max_term)))\n        \n        return n_pts * log_S_beta - beta * sum_d\n\n    # Perform bounded optimization to find beta_hat\n    opt_result = minimize_scalar(\n        objective_A,\n        args=(t_arr, d_arr),\n        bounds=(-0.2, 0.2),\n        method='bounded'\n    )\n    \n    min_obj_A_val = opt_result.fun\n    \n    # The maximized log-likelihood for M_A is:\n    # l_A = n*log(n) - n - min_val_of_objective\n    log_like_A = n * np.log(n) - n - min_obj_A_val\n\n    # 4. Compute the final Likelihood Ratio\n    # LR = exp(log_like_B - log_like_A)\n    lr = np.exp(log_like_B - log_like_A)\n    \n    return lr\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis on the provided test suite.\n    \"\"\"\n    # Test suite (each case is a list of (t_i, d_i) pairs)\n    test_cases = [\n        # Case 1: dose-independent pattern\n        [(12, 50), (18, 100), (22, 150), (19, 200), (24, 250), (21, 300)],\n        # Case 2: dose-dependent pattern\n        [(28, 50), (25, 100), (20, 150), (10, 200), (6, 250), (3, 300)],\n        # Case 3: edge case, constant dose\n        [(15, 200), (20, 200), (18, 200), (17, 200)],\n        # Case 4: mixed zero and nonzero doses\n        [(22, 0), (20, 0), (18, 100), (9, 200), (19, 0), (4, 300)]\n    ]\n\n    results = []\n    for case in test_cases:\n        times = [p[0] for p in case]\n        doses = [p[1] for p in case]\n        \n        lr_value = calculate_lr(times, doses)\n        results.append(f\"{lr_value:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\n# Execute the solver\nsolve()\n\n```"
        }
    ]
}