{
    "hands_on_practices": [
        {
            "introduction": "理解药物在体内的动态变化是设计合理给药方案的基石。本练习将引导您从基本原理出发，推导消除半衰期（$t_{1/2}$）、达到稳态的时间以及蓄积指数（$R_{ac}$）等关键药代动力学参数。掌握这些概念对于预测达到治疗效果所需的时间以及重复给药后药物的蓄积程度至关重要。",
            "id": "4575193",
            "problem": "一名患者被处方了一种口服酪氨酸激酶抑制剂（TKI；tyrosine kinase inhibitor），每日一次（QD；once daily）给药，其药代动力学可通过线性一室模型很好地描述，该模型具有一级消除和相对于消除可忽略的吸收时间。您应使用的基本药代动力学基础包括：(i) 单一充分混合隔室中的质量平衡，其中浓度变化率与浓度成正比；(ii) 清除率的定义，即消除速率与浓度相关的比例常数；以及 (iii) 分布容积的定义，即体内药量与浓度相关的比例常数。根据这些原理，推导以分布容积和清除率表示的消除半衰期的表达式，然后对于分布容积 $V_{d}=200$ L 且清除率 $CL=10$ L/h 的TKI计算其值。接着，使用相同的基础，确定在重复给药下达到渐近稳态 $95\\%$ 所需的时间，操作上定义为达到稳态的分数（仅由消除速率常数决定）等于 $0.95$ 的时间 $t$。最后，推导给药间隔 $\\tau=24$ h 的每日一次给药的累积指数，该指数定义为在线性动力学下，稳态浓度曲线与单次给药浓度曲线在相同给药后时间的比值，并根据给定参数进行数值计算。将所有数值答案四舍五入至四位有效数字。时间量以小时表示，累积指数报告为无量纲量。按以下顺序提供您的三个数值结果：半衰期、达到 $95\\%$ 稳态的时间、累积指数。",
            "solution": "问题陈述经评估具有科学依据、提法恰当且客观。它基于药代动力学的基本和标准原理。所有必要的参数和定义均已提供，没有内部矛盾或不切实际的假设。该问题可以求解。\n\n解答按要求分为三个部分：消除半衰期 ($t_{1/2}$) 的推导与计算、达到 $95\\%$ 稳态的时间 ($t_{95\\%SS}$) 的计算，以及累积指数 ($R_{ac}$) 的计算。\n\n**第1部分：消除半衰期 ($t_{1/2}$)**\n\n推导从所提供的基本原理开始。\n(i) 单一充分混合隔室中药物的质量平衡表明，体内药物量 $A(t)$ 的变化率等于药物进入速率减去药物排出速率。对于吸收后阶段，进入速率为零，排出速率即为消除速率。\n(ii) 消除速率由清除率 $CL$ 与血浆浓度 $C(t)$ 的乘积给出。\n结合这些，体内药物量的微分方程为：\n$$\n\\frac{dA(t)}{dt} = - \\text{Rate of Elimination} = -CL \\cdot C(t)\n$$\n(iii) 分布容积 $V_d$ 将体内药物量与其浓度联系起来：\n$$\nA(t) = V_d \\cdot C(t)\n$$\n对此关系式关于时间 $t$ 求导，得到：\n$$\n\\frac{dA(t)}{dt} = V_d \\frac{dC(t)}{dt}\n$$\n将此代入质量平衡方程，我们得到一个关于浓度的微分方程：\n$$\nV_d \\frac{dC(t)}{dt} = -CL \\cdot C(t)\n$$\n重新整理此方程表明，浓度变化率与浓度成正比，正如原理 (i) 所述：\n$$\n\\frac{dC(t)}{dt} = -\\left(\\frac{CL}{V_d}\\right) C(t)\n$$\n该方程描述了一级消除。比例常数是一级消除速率常数 $k_e$：\n$$\nk_e = \\frac{CL}{V_d}\n$$\n微分方程为 $\\frac{dC(t)}{dt} = -k_e C(t)$。这是一个可分离的微分方程。设 $C(0) = C_0$ 为时间 $t=0$ 时的初始浓度。\n$$\n\\int_{C_0}^{C(t)} \\frac{dC}{C} = \\int_{0}^{t} -k_e dt\n$$\n$$\n\\ln(C(t)) - \\ln(C_0) = -k_e t\n$$\n$$\n\\ln\\left(\\frac{C(t)}{C_0}\\right) = -k_e t\n$$\n$$\nC(t) = C_0 \\exp(-k_e t)\n$$\n消除半衰期 $t_{1/2}$ 是浓度降至其初始值一半所需的时间，即 $C(t_{1/2}) = \\frac{1}{2}C_0$。\n$$\n\\frac{1}{2}C_0 = C_0 \\exp(-k_e t_{1/2})\n$$\n$$\n\\frac{1}{2} = \\exp(-k_e t_{1/2})\n$$\n两边取自然对数：\n$$\n\\ln\\left(\\frac{1}{2}\\right) = -k_e t_{1/2}\n$$\n$$\n-\\ln(2) = -k_e t_{1/2}\n$$\n$$\nt_{1/2} = \\frac{\\ln(2)}{k_e}\n$$\n将以 $V_d$ 和 $CL$ 表示的 $k_e$ 的表达式代入：\n$$\nt_{1/2} = \\frac{\\ln(2)}{CL / V_d} = \\frac{V_d \\ln(2)}{CL}\n$$\n现在，我们使用给定值 $V_d = 200$ L 和 $CL = 10$ L/h 来计算该表达式。\n$$\nt_{1/2} = \\frac{200~\\text{L} \\cdot \\ln(2)}{10~\\text{L/h}} = 20 \\ln(2)~\\text{h} \\approx 13.8629~\\text{h}\n$$\n四舍五入至四位有效数字，$t_{1/2} = 13.86$ h。\n\n**第2部分：达到 $95\\%$ 稳态的时间 ($t_{95\\%SS}$)**\n\n在多剂量给药方案中，达到稳态是一个由消除速率常数 $k_e$ 控制的渐近过程。问题将时间 $t$ 时达到稳态的分数定义为 $1 - \\exp(-k_e t)$。我们被要求找出该分数等于 $0.95$ 的时间 $t_{95\\%SS}$。\n$$\n1 - \\exp(-k_e t_{95\\%SS}) = 0.95\n$$\n求解 $t_{95\\%SS}$：\n$$\n\\exp(-k_e t_{95\\%SS}) = 1 - 0.95 = 0.05\n$$\n两边取自然对数：\n$$\n-k_e t_{95\\%SS} = \\ln(0.05)\n$$\n$$\nt_{95\\%SS} = \\frac{-\\ln(0.05)}{k_e} = \\frac{\\ln\\left(\\frac{1}{0.05}\\right)}{k_e} = \\frac{\\ln(20)}{k_e}\n$$\n首先，我们计算 $k_e$：\n$$\nk_e = \\frac{CL}{V_d} = \\frac{10~\\text{L/h}}{200~\\text{L}} = 0.05~\\text{h}^{-1}\n$$\n现在我们可以计算 $t_{95\\%SS}$：\n$$\nt_{95\\%SS} = \\frac{\\ln(20)}{0.05~\\text{h}^{-1}} \\approx \\frac{2.995732}{0.05}~\\text{h} \\approx 59.9146~\\text{h}\n$$\n四舍五入至四位有效数字，$t_{95\\%SS} = 59.91$ h。这大约相当于 $4.32$ 个半衰期，这是达到临床稳态的一个常用经验时间。\n\n**第3部分：累积指数 ($R_{ac}$)**\n\n累积指数 $R_{ac}$ 定义为稳态浓度曲线与单次给药浓度曲线的比值。对于线性系统，在给药间隔 ($0 \\le t  \\tau$) 内的所有时间 $t$，该比值是恒定的。\n$$\nR_{ac} = \\frac{C_{SS}(t)}{C_1(t)}\n$$\n假设剂量 $D$ 以静脉推注（吸收时间可忽略）方式给药，单次给药后的浓度为：\n$$\nC_1(t) = C_0 \\exp(-k_e t) = \\frac{D}{V_d} \\exp(-k_e t)\n$$\n在每隔时间 $\\tau$ 重复给药达到稳态时，最近一次给药后时间 $t$ 的浓度是来自无穷系列先前剂量的药物残留量之和：\n$$\nC_{SS}(t) = \\frac{D}{V_d} \\exp(-k_e t) + \\frac{D}{V_d} \\exp(-k_e (t+\\tau)) + \\frac{D}{V_d} \\exp(-k_e (t+2\\tau)) + \\dots\n$$\n提出公因式：\n$$\nC_{SS}(t) = \\frac{D}{V_d} \\exp(-k_e t) \\left[ 1 + \\exp(-k_e \\tau) + \\exp(-2k_e \\tau) + \\dots \\right]\n$$\n括号中的项是一个无穷几何级数 $\\sum_{n=0}^{\\infty} r^n$，公比为 $r = \\exp(-k_e \\tau)$。由于 $k_e > 0$ 且 $\\tau > 0$，公比 $r$ 介于 $0$ 和 $1$ 之间，级数收敛于 $\\frac{1}{1-r}$。\n$$\n\\sum_{n=0}^{\\infty} (\\exp(-k_e \\tau))^n = \\frac{1}{1 - \\exp(-k_e \\tau)}\n$$\n因此，稳态浓度曲线为：\n$$\nC_{SS}(t) = \\left( \\frac{D}{V_d} \\exp(-k_e t) \\right) \\left( \\frac{1}{1 - \\exp(-k_e \\tau)} \\right)\n$$\n现在我们可以计算 $R_{ac}$：\n$$\nR_{ac} = \\frac{C_{SS}(t)}{C_1(t)} = \\frac{\\left( \\frac{D}{V_d} \\exp(-k_e t) \\right) \\left( \\frac{1}{1 - \\exp(-k_e \\tau)} \\right)}{\\frac{D}{V_d} \\exp(-k_e t)} = \\frac{1}{1 - \\exp(-k_e \\tau)}\n$$\n这证实了对于线性系统，累积指数与剂量 $D$、分布容积 $V_d$ 和给药后时间 $t$ 无关。它仅取决于消除速率常数 $k_e$ 和给药间隔 $\\tau$。\n我们现在用 $k_e = 0.05~\\text{h}^{-1}$ 和 $\\tau = 24$ h 对其进行数值计算。\n乘积 $k_e \\tau$ 为：\n$$\nk_e \\tau = (0.05~\\text{h}^{-1})(24~\\text{h}) = 1.2\n$$\n那么累积指数为：\n$$\nR_{ac} = \\frac{1}{1 - \\exp(-1.2)} \\approx \\frac{1}{1 - 0.3011942} = \\frac{1}{0.6988058} \\approx 1.430999\n$$\n四舍五入至四位有效数字，$R_{ac} = 1.431$。这是一个无量纲量。\n\n所要求的三个数值结果按顺序为：\n1.  半衰期：$13.86$ h\n2.  达到 $95\\%$ 稳态的时间：$59.91$ h\n3.  累积指数：$1.431$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 13.86  59.91  1.431 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在掌握了药物的全身时间进程后，我们必须考虑影响其进入体内的因素，这对于口服药物是关键一步。本练习深入探讨了许多靶向治疗药物的pH依赖性溶解度问题，这是临床上重要的药物相互作用的常见原因。通过模拟药物溶解度如何随胃内pH值变化，您将获得预测和管理与胃酸抑制剂相互作用的实用见解。",
            "id": "4575259",
            "problem": "一位临床药理学家正在评估一种新型酪氨酸激酶抑制剂 (TKI)，它是一种单质子弱碱，其酸解离常数为 $pK_a = 5.5$，固有溶解度为 $S_0 = 0.05$ mg/mL。固有溶解度 $S_0$ 是指在没有电离的情况下，中性碱的饱和浓度。假设溶液行为理想（活度系数接近于1），无复杂沉淀或盐限制溶解度，并且在临床相关的 $\\mathrm{pH}$ 范围内仅形成单质子化物种。空腹状态下的胃内 $\\mathrm{pH}$ 值为 $2$，但联合使用质子泵抑制剂 (PPI) 可将胃内 $\\mathrm{pH}$ 值提高到 $5$。\n\n从单质子弱碱的酸碱平衡和 $pK_a$ 的定义出发，并利用电离部分对弱碱表观溶解度有加和贡献的概念，推导出总溶解度 $S_{\\text{total}}$ 与 $\\mathrm{pH}$ 之间的关系式（用 $S_0$、$pK_a$ 和 $\\mathrm{pH}$ 表示）。然后用该关系式计算在 $\\mathrm{pH} = 2$ 和 $\\mathrm{pH} = 5$ 时的总溶解度（单位：mg/mL）。最后，以小数形式报告联合使用 PPI 后溶解度的倍数变化作为答案，该值定义为比率 $S_{\\text{total}}(\\mathrm{pH}=5)/S_{\\text{total}}(\\mathrm{pH}=2)$，无单位。将最终比率四舍五入至三位有效数字。",
            "solution": "根据验证标准评估用户提供的问题。\n\n### 第1步：提取已知条件\n- 药物是单质子弱碱。\n- 共轭酸的酸解离常数：$pK_a = 5.5$。\n- 中性碱的固有溶解度：$S_0 = 0.05$ mg/mL。\n- 假设：理想溶液行为，活度系数接近于1，无复杂沉淀或盐限制溶解度，仅形成单质子化物种。\n- 空腹胃内 pH：$\\mathrm{pH}_{\\text{fasting}} = 2$。\n- 使用质子泵抑制剂 (PPI) 后的胃内 pH：$\\mathrm{pH}_{\\text{PPI}} = 5$。\n- 任务1：推导总溶解度 $S_{\\text{total}}$ 与 $\\mathrm{pH}$ 之间的关系式（用 $S_0$、$pK_a$ 和 $\\mathrm{pH}$ 表示）。\n- 任务2：计算 $\\mathrm{pH} = 2$ 时的 $S_{\\text{total}}$。\n- 任务3：计算 $\\mathrm{pH} = 5$ 时的 $S_{\\text{total}}$。\n- 任务4：计算倍数变化比率 $S_{\\text{total}}(\\mathrm{pH}=5) / S_{\\text{total}}(\\mathrm{pH}=2)$。\n- 报告要求：最终比率以小数形式表示，并四舍五入至三位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，描述了可电离化合物的 pH 依赖性溶解度这一公认原理。这是药剂学和药理学中的一个基本概念。所提供的值（$pK_a$、$S_0$、$\\mathrm{pH}$ 水平）对于涉及口服药物的临床情景是符合实际的。问题陈述清晰，提供了所有必要的数据和明确的假设，从而可以得出一个唯一的、稳定的解。术语精确客观。该问题不违反任何无效性标准。\n\n### 第3步：结论与行动\n该问题被判定为 **有效**。将提供一个合理的解答。\n\n### 解答推导与计算\n\n该问题要求推导单质子弱碱的总溶解度 ($S_{\\text{total}}$) 作为 $\\mathrm{pH}$ 的函数。设弱碱用符号 $B$ 表示，其质子化（共轭酸）形式用 $BH^+$ 表示。\n\n相关的化学平衡是共轭酸的解离，其 $pK_a$ 已知：\n$$BH^+ \\rightleftharpoons B + H^+$$\n\n酸解离常数 $K_a$ 由该平衡的质量作用表达式定义：\n$$K_a = \\frac{[B][H^+]}{[BH^+]}$$\n其中方括号表示摩尔浓度。问题假设为理想行为，因此活度由浓度代替。\n\n总溶解度 $S_{\\text{total}}$ 是在给定 $\\mathrm{pH}$ 下，药物在溶液中能溶解的最大总浓度。它是饱和时所有溶解物种的浓度之和：\n$$S_{\\text{total}} = [B]_{\\text{sat}} + [BH^+]_{\\text{sat}}$$\n\n可电离化合物溶解度的一个关键原理是，饱和溶液中中性、未电离物种的浓度是恒定的，等于其固有溶解度 $S_0$，与 $\\mathrm{pH}$ 无关。因此，在饱和状态下：\n$$[B]_{\\text{sat}} = S_0$$\n\n现在，我们可以用 $S_0$ 来表示质子化物种的浓度 $[BH^+]_{\\text{sat}}$。重新整理 $K_a$ 表达式并代入 $[B]_{\\text{sat}} = S_0$：\n$$[BH^+]_{\\text{sat}} = \\frac{[B]_{\\text{sat}}[H^+]}{K_a} = \\frac{S_0[H^+]}{K_a}$$\n\n将 $[B]_{\\text{sat}}$ 和 $[BH^+]_{\\text{sat}}$ 的表达式代回 $S_{\\text{total}}$ 的方程中：\n$$S_{\\text{total}} = S_0 + \\frac{S_0[H^+]}{K_a}$$\n\n提出因子 $S_0$ 可得到总溶解度、固有溶解度和氢离子浓度之间的关系：\n$$S_{\\text{total}} = S_0 \\left(1 + \\frac{[H^+]}{K_a}\\right)$$\n\n为了用 $\\mathrm{pH}$ 和 $pK_a$ 来表示这个关系，我们使用定义 $\\mathrm{pH} = -\\log_{10}([H^+])$ 和 $pK_a = -\\log_{10}(K_a)$。这意味着 $[H^+] = 10^{-\\mathrm{pH}}$ 和 $K_a = 10^{-pK_a}$。该比率变为：\n$$\\frac{[H^+]}{K_a} = \\frac{10^{-\\mathrm{pH}}}{10^{-pK_a}} = 10^{(pK_a - \\mathrm{pH})}$$\n\n将此代入溶解度方程，得到最终的推导关系式：\n$$S_{\\text{total}} = S_0 (1 + 10^{(pK_a - \\mathrm{pH})})$$\n\n这是适用于弱碱溶解度的 Henderson-Hasselbalch 方程。\n\n接下来，我们使用这个推导出的公式和给定的参数 $S_0 = 0.05$ mg/mL 和 $pK_a = 5.5$，计算在指定 $\\mathrm{pH}$ 值下的溶解度。\n\n**在 $\\mathrm{pH} = 2$ 时的溶解度（空腹胃内条件）：**\n$$S_{\\text{total}}(\\mathrm{pH}=2) = S_0 (1 + 10^{(5.5 - 2)}) = 0.05 \\times (1 + 10^{3.5})$$\n\n**在 $\\mathrm{pH} = 5$ 时的溶解度（联合使用 PPI）：**\n$$S_{\\text{total}}(\\mathrm{pH}=5) = S_0 (1 + 10^{(5.5 - 5)}) = 0.05 \\times (1 + 10^{0.5})$$\n\n问题要求计算溶解度的倍数变化，定义为比率 $S_{\\text{total}}(\\mathrm{pH}=5) / S_{\\text{total}}(\\mathrm{pH}=2)$。\n$$\\text{Fold-change} = \\frac{S_{\\text{total}}(\\mathrm{pH}=5)}{S_{\\text{total}}(\\mathrm{pH}=2)} = \\frac{0.05 \\times (1 + 10^{0.5})}{0.05 \\times (1 + 10^{3.5})}$$\n\n$S_0$ 项被消去，表达式简化为：\n$$\\text{Fold-change} = \\frac{1 + 10^{0.5}}{1 + 10^{3.5}}$$\n\n现在，我们对这个表达式进行数值计算：\n$10^{0.5} = \\sqrt{10} \\approx 3.16227766$\n$10^{3.5} = 10^3 \\times 10^{0.5} \\approx 1000 \\times 3.16227766 = 3162.27766$\n\n$$\\text{Fold-change} = \\frac{1 + 3.16227766}{1 + 3162.27766} = \\frac{4.16227766}{3163.27766} \\approx 0.001315816$$\n\n将最终结果四舍五入至三位有效数字，我们得到 $0.00132$。胃内 $\\mathrm{pH}$ 升高导致溶解度显著下降，这是由胃酸抑制剂介导的药物-药物相互作用的典型例子，也是临床药理学中的一个关键考虑因素。",
            "answer": "$$\\boxed{0.00132}$$"
        },
        {
            "introduction": "临床药理学的最终目标是将药物暴露与其临床效果（包括疗效和毒性）联系起来。这项高级练习要求您从零开始建立一个定量的暴露-反应模型，将药物浓度与毒性发生的概率联系起来。通过将统计建模应用于临床数据，您将在现代药物开发和个性化医疗领域建立一项核心能力。",
            "id": "4575252",
            "problem": "给定患者在稳态时的谷浓度水平（通常表示为最低浓度 $C_{\\min}$），该浓度是针对一种酪氨酸激酶抑制剂 (TKI) 的，同时还给定了每位患者是否根据不良事件通用术语标准 (CTCAE) 经历了 $2$ 级及以上的毒性。假设毒性由暴露引起，其对数几率随浓度增加而单调递增。请通过逻辑斯谛回归，使用基于第一性原理的最大似然估计，将 $2$ 级及以上毒性的概率建模为 $C_{\\min}$ 的函数。\n\n从临床药理学和生物统计学的以下基础出发：\n\n- 药代动力学-药效动力学暴露-反应原理：对于许多抑制剂，较高的暴露会以单调方式增加毒性风险。\n- 毒性的二元结果模型：每位患者 $i$ 有一个二元结果 $y_i \\in \\{0,1\\}$，其中 $y_i = 1$ 表示经历了 $2$ 级及以上的毒性，$y_i = 0$ 表示其他情况，该结果被建模为一个参数为 $p_i$ 的独立伯努利随机变量。\n- 伯努利似然：其概率质量函数为 $f(y_i \\mid p_i) = p_i^{y_i} (1 - p_i)^{1 - y_i}$。\n- Logit 链接：对数几率与暴露呈线性关系，$\\operatorname{logit}(p_i) = \\ln\\left(\\frac{p_i}{1 - p_i}\\right) = \\beta_0 + \\beta_1 x_i$，其中 $x_i$ 是患者 $i$ 的 $C_{\\min}$，$\\beta_0$ 是截距，$\\beta_1$ 是描述对数几率随单位浓度变化的斜率参数。\n\n您必须使用牛顿-拉弗森法（迭代重加权最小二乘法）推导并实现 $\\beta_0$ 和 $\\beta_1$ 的最大似然估计量，且不调用任何预构建的分类例程。使用自然对数。然后，为指定的测试浓度计算预测概率 $p(x) = \\frac{1}{1 + e^{-(\\beta_0 + \\beta_1 x)}}$。\n\n训练数据（所有 $C_{\\min}$ 值的单位均为 $\\mathrm{ng/mL}$）：\n- 浓度 $x$ (单位 $\\mathrm{ng/mL}$): $[8, 15, 22, 29, 36, 44, 52, 60, 68, 76, 84, 92, 105, 120, 135, 150, 170, 190, 210, 230]$。\n- 毒性指标 $y$: $[0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1]$。\n\n数学和算法要求：\n- 定义对数似然 $\\ell(\\beta_0, \\beta_1) = \\sum_{i=1}^{n} \\left( y_i (\\beta_0 + \\beta_1 x_i) - \\ln\\left(1 + e^{\\beta_0 + \\beta_1 x_i}\\right) \\right)$。\n- 推导梯度 $\\nabla \\ell(\\boldsymbol{\\beta}) = \\mathbf{X}^\\top (\\mathbf{y} - \\mathbf{p})$，其中 $\\mathbf{X}$ 是一个 $n \\times 2$ 的设计矩阵，第一列全为 1，第二列为 $x_i$，$\\mathbf{y}$ 是结果向量，$\\mathbf{p}$ 的元素为 $p_i = \\frac{1}{1 + e^{-(\\beta_0 + \\beta_1 x_i)}}$。\n- 推导 Hessian 矩阵 $\\mathbf{H}(\\boldsymbol{\\beta}) = -\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X}$，其中 $\\mathbf{W}$ 是对角矩阵，其对角元素为 $p_i (1 - p_i)$。\n- 通过求解 $\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X} \\, \\Delta \\boldsymbol{\\beta} = \\mathbf{X}^\\top (\\mathbf{y} - \\mathbf{p})$ 来实现牛顿步，并更新 $\\boldsymbol{\\beta} \\leftarrow \\boldsymbol{\\beta} + \\Delta \\boldsymbol{\\beta}$ 直至收敛。\n\n科学真实性约束：\n- 将 $C_{\\min}$ 视为稳态谷浓度，单位为 $\\mathrm{ng/mL}$。\n- 概率必须以 $[0,1]$ 范围内的十进制数报告（不使用百分号）。\n\n测试集：\n- 计算 $x$ (单位 $\\mathrm{ng/mL}$) 在以下值时的预测概率：$[0, 25, 75, 120, 180, 300]$。\n\n答案规格：\n- 您的程序必须使用上述方法将 $\\beta_0$ 和 $\\beta_1$ 拟合到训练数据，然后为六个测试浓度计算 $p(x)$。\n- 将最终结果表示为六个保留四位小数的十进制数，格式为单行、用方括号括起来的逗号分隔列表。\n- 最终输出格式必须严格如下：例如，$[0.1234,0.5678,0.9012,0.3456,0.7890,0.2345]$。\n\n不允许外部输入。程序必须完全自包含，并根据内嵌的训练集和测试集产生指定的输出。",
            "solution": "我们的目标是建立一个逻辑斯谛回归模型，将酪氨酸激酶抑制剂的谷浓度 $C_{\\min}$ 与发生 $2$ 级及以上毒性的概率关联起来，该模型使用基于基本定义的最大似然估计法。我们首先形式化二元结果模型和似然函数。\n\n每位患者 $i$ 提供一个暴露量 $x_i$（单位为 $\\mathrm{ng/mL}$）和一个二元毒性指标 $y_i \\in \\{0,1\\}$。伯努利模型假定 $y_i \\sim \\operatorname{Bernoulli}(p_i)$，其中 $p_i$ 是在暴露量为 $x_i$ 时的毒性概率。似然函数为 $L(\\boldsymbol{\\beta}) = \\prod_{i=1}^{n} p_i^{y_i} (1 - p_i)^{1 - y_i}$，其中 $p_i$ 通过 logit 链接进行建模，\n$$\n\\operatorname{logit}(p_i) = \\ln\\left(\\frac{p_i}{1-p_i}\\right) = \\beta_0 + \\beta_1 x_i,\n$$\n因此\n$$\np_i = \\frac{1}{1 + e^{-(\\beta_0 + \\beta_1 x_i)}}.\n$$\n该链接源于一个假设，即毒性的对数几率随暴露量线性增加。这是一个临床上合理的简化，与靶向抑制剂药理学中的单调暴露-反应关系相符。\n\n对数似然函数为\n$$\n\\ell(\\boldsymbol{\\beta}) = \\sum_{i=1}^{n} \\left[ y_i (\\beta_0 + \\beta_1 x_i) - \\ln\\left(1 + e^{\\beta_0 + \\beta_1 x_i}\\right) \\right],\n$$\n其中 $\\boldsymbol{\\beta} = (\\beta_0, \\beta_1)^\\top$。为了最大化 $\\ell(\\boldsymbol{\\beta})$，我们计算用于牛顿-拉弗森更新的梯度和 Hessian 矩阵。设 $\\mathbf{X}$ 为 $n \\times 2$ 的设计矩阵，其第一列为 $\\mathbf{1}$，第二列为暴露量 $(x_i)$，设 $\\mathbf{y}$ 为观测结果向量，$\\mathbf{p}$ 为元素是如上定义的 $p_i$ 的向量。梯度是\n$$\n\\nabla \\ell(\\boldsymbol{\\beta}) = \\mathbf{X}^\\top (\\mathbf{y} - \\mathbf{p}),\n$$\nHessian 矩阵是\n$$\n\\mathbf{H}(\\boldsymbol{\\beta}) = -\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X}, \\quad \\text{其中} \\quad \\mathbf{W} = \\operatorname{diag}\\left(p_i (1 - p_i)\\right).\n$$\n牛顿步求解\n$$\n\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X} \\, \\Delta \\boldsymbol{\\beta} = \\mathbf{X}^\\top (\\mathbf{y} - \\mathbf{p}),\n$$\n并更新\n$$\n\\boldsymbol{\\beta} \\leftarrow \\boldsymbol{\\beta} + \\Delta \\boldsymbol{\\beta}.\n$$\n这等价于迭代重加权最小二乘法 (IRLS)，其中权重为 $p_i (1 - p_i)$，工作响应值（working responses）反映了当前的残差 $(y_i - p_i)$。\n\n算法设计：\n- 初始化 $\\boldsymbol{\\beta}^{(0)} = (0, 0)^\\top$。\n- 对迭代 $t = 0, 1, \\dots$：\n  1. 对所有 $i$ 计算 $p_i^{(t)} = \\frac{1}{1 + e^{-(\\beta_0^{(t)} + \\beta_1^{(t)} x_i)}}$。\n  2. 构建 $\\mathbf{W}^{(t)} = \\operatorname{diag}\\left(p_i^{(t)} (1 - p_i^{(t)})\\right)$。\n  3. 计算右侧项 $\\mathbf{X}^\\top (\\mathbf{y} - \\mathbf{p}^{(t)})$。\n  4. 求解 $(\\mathbf{X}^\\top \\mathbf{W}^{(t)} \\mathbf{X}) \\, \\Delta \\boldsymbol{\\beta}^{(t)} = \\mathbf{X}^\\top (\\mathbf{y} - \\mathbf{p}^{(t)})$ 以得到 $\\Delta \\boldsymbol{\\beta}^{(t)}$。\n  5. 更新 $\\boldsymbol{\\beta}^{(t+1)} = \\boldsymbol{\\beta}^{(t)} + \\Delta \\boldsymbol{\\beta}^{(t)}$。\n  6. 当 $\\|\\Delta \\boldsymbol{\\beta}^{(t)}\\|_2$ 低于一个很小的容差（例如 $10^{-10}$）或达到最大迭代次数时停止。\n- 为了在 $\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X}$ 接近奇异（例如，准分离 quasi-separation）的罕见情况下保持数值稳定性，可以向系统中添加一个非常小的岭项 (ridge term) $\\lambda \\mathbf{I}$，其中 $\\lambda$ 是一个微小的正常数（例如 $\\lambda = 10^{-8}$）。这不会实质性地改变最大似然估计，但能确保方程组可解。\n\n一旦找到 $\\widehat{\\boldsymbol{\\beta}} = (\\widehat{\\beta}_0, \\widehat{\\beta}_1)^\\top$，就可以按如下方式计算任何新浓度 $x$ 的预测概率\n$$\n\\widehat{p}(x) = \\frac{1}{1 + e^{-(\\widehat{\\beta}_0 + \\widehat{\\beta}_1 x)}}.\n$$\n将此公式应用于指定的测试集浓度 $[0, 25, 75, 120, 180, 300]$（单位 $\\mathrm{ng/mL}$）。输出是无量纲的概率，必须表示为四位小数。\n\n该方法将药理学上的暴露-反应原理（较高的 $C_{\\min}$ 通常会增加毒性风险）与一个仅使用基本定义和优化方法的严谨统计模型联系起来，确保了斜率 $\\widehat{\\beta}_1$ 的可解释性，它量化了 $C_{\\min}$ 每增加一个 $\\mathrm{ng/mL}$ 单位，$2$ 级及以上毒性的对数几率会如何变化。该算法在一个自包含的 Python 程序中实现，该程序在内嵌的训练数据上拟合模型，并以确切的所需格式打印出所要求的六个概率值。",
            "answer": "```python\nimport numpy as np\n\ndef irls_logistic_regression(X, y, max_iter=1000, tol=1e-10, ridge=1e-8):\n    \"\"\"\n    Fit logistic regression via Iteratively Reweighted Least Squares (Newton-Raphson).\n\n    Parameters:\n        X: Design matrix of shape (n_samples, n_features), with intercept column included.\n        y: Binary response vector of shape (n_samples,).\n        max_iter: Maximum number of iterations.\n        tol: Convergence tolerance on parameter update norm.\n        ridge: Small diagonal ridge added to X^T W X for numerical stability.\n\n    Returns:\n        beta: Estimated parameter vector of shape (n_features,).\n    \"\"\"\n    n_features = X.shape[1]\n    beta = np.zeros(n_features)\n\n    for _ in range(max_iter):\n        z = X @ beta\n        # Sigmoid probabilities\n        p = 1.0 / (1.0 + np.exp(-z))\n\n        # Weights: p * (1 - p)\n        w = p * (1.0 - p)\n\n        # Guard against zero weights by adding a tiny floor\n        w = np.maximum(w, 1e-12)\n\n        # Compute gradient: X^T (y - p)\n        grad = X.T @ (y - p)\n\n        # Hessian (negative of second derivative of log-likelihood): X^T W X\n        # Build W as diagonal efficiently via multiplying columns\n        WX = X * w[:, None]\n        H = X.T @ WX\n\n        # Add small ridge for numerical stability\n        H += ridge * np.eye(n_features)\n\n        # Solve H * delta = grad for Newton step\n        try:\n            delta = np.linalg.solve(H, grad)\n        except np.linalg.LinAlgError:\n            # Fallback to least-squares solution if singular\n            delta, *_ = np.linalg.lstsq(H, grad, rcond=None)\n\n        beta_new = beta + delta\n\n        # Check convergence\n        if np.linalg.norm(delta)  tol:\n            beta = beta_new\n            break\n\n        beta = beta_new\n\n    return beta\n\ndef predict_prob(beta, x):\n    \"\"\"Predict probability for a scalar or array x given beta = [beta0, beta1].\"\"\"\n    x = np.asarray(x, dtype=float)\n    z = beta[0] + beta[1] * x\n    return 1.0 / (1.0 + np.exp(-z))\n\ndef solve():\n    # Training data: Cmin (ng/mL) and toxicity indicator (grade = 2 as 1, else 0)\n    x_train = np.array([8, 15, 22, 29, 36, 44, 52, 60, 68, 76, 84, 92, 105, 120, 135, 150, 170, 190, 210, 230], dtype=float)\n    y_train = np.array([0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1], dtype=float)\n\n    # Design matrix with intercept\n    X = np.column_stack([np.ones_like(x_train), x_train])\n\n    # Fit logistic regression via IRLS\n    beta_hat = irls_logistic_regression(X, y_train, max_iter=1000, tol=1e-10, ridge=1e-8)\n\n    # Test suite concentrations (ng/mL)\n    test_cases = [0.0, 25.0, 75.0, 120.0, 180.0, 300.0]\n\n    # Predict probabilities\n    probs = predict_prob(beta_hat, np.array(test_cases))\n\n    # Round to 4 decimal places and format\n    results_str = [f\"{p:.4f}\" for p in probs]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        }
    ]
}