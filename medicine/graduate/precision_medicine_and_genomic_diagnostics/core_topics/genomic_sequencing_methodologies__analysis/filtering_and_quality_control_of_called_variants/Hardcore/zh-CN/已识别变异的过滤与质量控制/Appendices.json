{
    "hands_on_practices": [
        {
            "introduction": "在变异检出中，过滤策略的调整总是在灵敏度（不漏掉真变异）和精确度（不错报假变异）之间进行权衡。这个练习  提供了一个量化这种权衡的实践场景。通过计算不同质量阈值下的灵敏度、精确度和 $F_1$ 分数，你将学会如何根据特定要求（例如临床应用中对灵敏度的最低要求）来选择最优的过滤参数，这是优化任何诊断流程的核心技能。",
            "id": "4340112",
            "problem": "在一项针对精准医疗和基因组诊断的基准研究中，您需要评估应用于体细胞单核苷酸变异（SNV）调用集的变异筛选阈值，并与来自 Genome in a Bottle (GIAB) 的一个精心策划的基准（ground-truth）panel进行比较。一个基于Phred标度的变异质量得分 $q$ 的校准筛选器在五个候选阈值 $q \\in \\{10, 20, 30, 40, 50\\}$ 上应用。对于每个阈值，与基准的比较得出了真阳性（TP）、假阳性（FP）和假阴性（FN）的计数。基准集合包含 $10{,}000$ 个真实变异，因此在每个阈值下都有 $\\text{TP} + \\text{FN} = 10{,}000$。测得的计数如下：在 $q=10$ 时，$\\text{TP}=9{,}800$，$\\text{FP}=1{,}300$，$\\text{FN}=200$；在 $q=20$ 时，$\\text{TP}=9{,}700$，$\\text{FP}=900$，$\\text{FN}=300$；在 $q=30$ 时，$\\text{TP}=9{,}500$，$\\text{FP}=600$，$\\text{FN}=500$；在 $q=40$ 时，$\\text{TP}=9{,}300$，$\\text{FP}=400$，$\\text{FN}=700$；在 $q=50$ 时，$\\text{TP}=9{,}000$，$\\text{FP}=280$，$\\text{FN}=1{,}000$。\n\n仅使用基本定义，为每个阈值得出灵敏度（也称为召回率），精确率（也称为阳性预测值(PPV)），以及 $F_1$ 分数，其中 $F_1$ 分数定义为精确率和灵敏度的调和平均数。然后，在满足最低灵敏度要求 $S_{\\min}=0.95$（即灵敏度至少为 $0.95$）的条件下，从满足灵敏度要求的阈值中选择使 $F_1$ 分数最大化的单个阈值 $q$。\n\n仅报告所选阈值 $q$，以纯数字形式表示，不带单位，且不要对最终答案进行四舍五入。所有中间计算都应基于第一性原理进行证明，不得调用简化公式。",
            "solution": "经评估，该问题是有效的，因为它科学地基于诊断测试评估的原则，问题设定良好，具有完整且一致的数据和约束条件，并寻求一个确定的、客观的答案。因此，我们可以进行正式求解。\n\n问题要求基于性能指标来评估五个变异筛选阈值 $q \\in \\{10, 20, 30, 40, 50\\}$，这些指标由真阳性（$\\text{TP}$）、假阳性（$\\text{FP}$）和假阴性（$\\text{FN}$）的计数导出。基准集合中真实变异的总数是恒定的，$N = \\text{TP} + \\text{FN} = 10{,}000$。\n\n首先，我们定义所需的性能指标。\n灵敏度（$S$），也称为召回率，是被筛选器正确识别的真实变异的比例。其定义为：\n$$S = \\frac{\\text{TP}}{\\text{TP} + \\text{FN}}$$\n精确率（$P$），也称为阳性预测值（PPV），是检出的变异中真实变异的比例。其定义为：\n$$P = \\frac{\\text{TP}}{\\text{TP} + \\text{FP}}$$\n$F_1$ 分数是灵敏度和精确率的调和平均数，由下式给出：\n$$F_1 = 2 \\cdot \\frac{P \\cdot S}{P + S}$$\n为计算方便，我们可以直接用 $\\text{TP}$、$\\text{FP}$ 和 $\\text{FN}$ 来表示 $F_1$ 分数。将 $P$ 和 $S$ 的定义代入 $F_1$ 公式，得到：\n$$F_1 = 2 \\cdot \\frac{\\left(\\frac{\\text{TP}}{\\text{TP} + \\text{FP}}\\right) \\left(\\frac{\\text{TP}}{\\text{TP} + \\text{FN}}\\right)}{\\frac{\\text{TP}}{\\text{TP} + \\text{FP}} + \\frac{\\text{TP}}{\\text{TP} + \\text{FN}}} = \\frac{2 \\cdot \\text{TP}}{\\left(\\text{TP} + \\text{FP}\\right) + \\left(\\text{TP} + \\text{FN}\\right)} = \\frac{2 \\cdot \\text{TP}}{2 \\cdot \\text{TP} + \\text{FP} + \\text{FN}}$$\n现在我们来计算每个候选阈值 $q$ 的灵敏度和 $F_1$ 分数。\n\n对于 $q=10$：\n给定计数为 $\\text{TP}_{10} = 9{,}800$，$\\text{FP}_{10} = 1{,}300$，和 $\\text{FN}_{10} = 200$。\n灵敏度为 $S_{10} = \\frac{9{,}800}{9{,}800 + 200} = \\frac{9{,}800}{10{,}000} = 0.98$。\n$F_1$ 分数为 $F_{1,10} = \\frac{2 \\cdot 9{,}800}{2 \\cdot 9{,}800 + 1{,}300 + 200} = \\frac{19{,}600}{19{,}600 + 1{,}500} = \\frac{19{,}600}{21{,}100} = \\frac{196}{211}$。\n\n对于 $q=20$：\n给定计数为 $\\text{TP}_{20} = 9{,}700$，$\\text{FP}_{20} = 900$，和 $\\text{FN}_{20} = 300$。\n灵敏度为 $S_{20} = \\frac{9{,}700}{9{,}700 + 300} = \\frac{9{,}700}{10{,}000} = 0.97$。\n$F_1$ 分数为 $F_{1,20} = \\frac{2 \\cdot 9{,}700}{2 \\cdot 9{,}700 + 900 + 300} = \\frac{19{,}400}{19{,}400 + 1{,}200} = \\frac{19{,}400}{20{,}600} = \\frac{194}{206} = \\frac{97}{103}$。\n\n对于 $q=30$：\n给定计数为 $\\text{TP}_{30} = 9{,}500$，$\\text{FP}_{30} = 600$，和 $\\text{FN}_{30} = 500$。\n灵敏度为 $S_{30} = \\frac{9{,}500}{9{,}500 + 500} = \\frac{9{,}500}{10{,}000} = 0.95$。\n$F_1$ 分数为 $F_{1,30} = \\frac{2 \\cdot 9{,}500}{2 \\cdot 9{,}500 + 600 + 500} = \\frac{19{,}000}{19{,}000 + 1{,}100} = \\frac{19{,}000}{20{,}100} = \\frac{190}{201}$。\n\n对于 $q=40$：\n给定计数为 $\\text{TP}_{40} = 9{,}300$，$\\text{FP}_{40} = 400$，和 $\\text{FN}_{40} = 700$。\n灵敏度为 $S_{40} = \\frac{9{,}300}{9{,}300 + 700} = \\frac{9{,}300}{10{,}000} = 0.93$。\n$F_1$ 分数为 $F_{1,40} = \\frac{2 \\cdot 9{,}300}{2 \\cdot 9{,}300 + 400 + 700} = \\frac{18{,}600}{18{,}600 + 1{,}100} = \\frac{18{,}600}{19{,}700} = \\frac{186}{197}$。\n\n对于 $q=50$：\n给定计数为 $\\text{TP}_{50} = 9{,}000$，$\\text{FP}_{50} = 280$，和 $\\text{FN}_{50} = 1{,}000$。\n灵敏度为 $S_{50} = \\frac{9{,}000}{9{,}000 + 1{,}000} = \\frac{9{,}000}{10{,}000} = 0.90$。\n$F_1$ 分数为 $F_{1,50} = \\frac{2 \\cdot 9{,}000}{2 \\cdot 9{,}000 + 280 + 1{,}000} = \\frac{18{,}000}{18{,}000 + 1{,}280} = \\frac{18{,}000}{19{,}280} = \\frac{450}{482} = \\frac{225}{241}$。\n\n接下来，我们应用选择标准。第一个标准是最低灵敏度要求 $S_{\\min} = 0.95$。我们根据此约束评估每个阈值：\n- $S_{10} = 0.98 \\ge 0.95$：阈值 $q=10$ 被保留。\n- $S_{20} = 0.97 \\ge 0.95$：阈值 $q=20$ 被保留。\n- $S_{30} = 0.95 \\ge 0.95$：阈值 $q=30$ 被保留。\n- $S_{40} = 0.93  0.95$：阈值 $q=40$ 被拒绝。\n- $S_{50} = 0.90  0.95$：阈值 $q=50$ 被拒绝。\n\n因此，候选阈值集合减少为 $\\{10, 20, 30\\}$。第二个标准是从该集合中选择使 $F_1$ 分数最大化的阈值。我们必须比较 $F_{1,10}$、$F_{1,20}$ 和 $F_{1,30}$。\n需要比较的值是：\n$F_{1,10} = \\frac{196}{211}$\n$F_{1,20} = \\frac{97}{103}$\n$F_{1,30} = \\frac{190}{201}$\n\n我们通过交叉相乘来比较 $F_{1,10}$ 和 $F_{1,20}$：\n$196 \\times 103 = 20{,}188$\n$97 \\times 211 = 20{,}467$\n因为 $20{,}467 > 20{,}188$，所以我们有 $\\frac{97}{103} > \\frac{196}{211}$，即 $F_{1,20} > F_{1,10}$。\n\n接下来，我们将较大的值 $F_{1,20}$ 与 $F_{1,30}$ 进行比较：\n$97 \\times 201 = 19{,}497$\n$190 \\times 103 = 19{,}570$\n因为 $19{,}570 > 19{,}497$，所以我们有 $\\frac{190}{201} > \\frac{97}{103}$，即 $F_{1,30} > F_{1,20}$。\n\n符合条件的阈值的 $F_1$ 分数排序为 $F_{1,30} > F_{1,20} > F_{1,10}$。在阈值 $q=30$ 处达到最大 $F_1$ 分数。\n因此，根据指定标准，最优阈值为 $30$。",
            "answer": "$$\\boxed{30}$$"
        },
        {
            "introduction": "链偏好性（Strand bias）是高通量测序中常见的技术性假象来源，它指一个等位基因的测序读段（reads）不成比例地来自正向链或反向链。Fisher 链偏好性（$FS$）分数是衡量这种偏好性的标准指标。本练习  将引导你深入了解 $FS$ 分数背后的统计学原理，从构建 $2 \\times 2$ 列联表，到执行 Fisher 精确检验并进行 Phred 转换，从而揭示这个重要的质量控制值是如何产生的。",
            "id": "4340072",
            "problem": "使用短读长测序在一个位点上进行单核苷酸变异检出，并观察到参考等位基因和变异等位基因的链特异性计数。为评估链偏好性，Fisher链（FS）注释被定义为在一个具有固定边缘总和的 $2 \\times 2$ 列联表中，通过Fisher精确检验计算等位基因与链之间独立性的Phred标度概率。从独立性原假设下Fisher精确检验的定义（具有条件边缘总和及相关的超几何抽样框架）出发，为以下观测计数表推导出精确的双侧$p$值：\n- 参考等位基因正向读段：$12$\n- 参考等位基因反向读段：$8$\n- 变异等位基因正向读段：$2$\n- 变异等位基因反向读段：$6$\n然后，应用测序质量评分中使用的标准Phred标度转换，从推导出的$p$值中获得Fisher链（$FS$）值。报告最终的$FS$值，四舍五入到四位有效数字。无需单位。",
            "solution": "该问题要求根据测序实验中给定的一组等位基因计数，计算Fisher链（$FS$）得分。这包括对一个 $2 \\times 2$ 列联表执行Fisher精确检验以获得双侧$p$值，然后进行Phred标度转换。\n\n首先，我们将所提供的数据整理成一个 $2 \\times 2$ 列联表。该表表示正向（Fwd）和反向（Rev）链上参考（Ref）和变异（Alt）等位基因的计数。设单元格计数用 $a, b, c, d$ 表示：\n- $a$: 参考等位基因，正向读段 = $12$\n- $b$: 变异等位基因，正向读段 = $2$\n- $c$: 参考等位基因，反向读段 = $8$\n- $d$: 变异等位基因，反向读段 = $6$\n\n列联表如下：\n$$\n\\begin{array}{c|cc|c}\n              \\text{参考}  \\text{变异}  \\text{总计} \\\\\n\\hline\n\\text{正向链}  a=12       b=2        R_1 = 14 \\\\\n\\text{反向链}  c=8        d=6        R_2 = 14 \\\\\n\\hline\n\\text{总计}    C_1=20     C_2=8      N=28\n\\end{array}\n$$\n行总计为 $R_1 = a+b = 12+2=14$ 和 $R_2 = c+d = 8+6=14$。列总计为 $C_1 = a+c = 12+8=20$ 和 $C_2 = b+d = 2+6=8$。总和为 $N=a+b+c+d=28$。\n\nFisher精确检验评估行变量（链）和列变量（等位基因类型）之间独立性的原假设。在此假设下，给定固定的边缘总和（$R_1, R_2, C_1, C_2$），观察到特定列联表配置的概率由超几何概率质量函数给出。如果我们将一个单元格计数（例如 $b$）视为随机变量，观察到 $b=k$ 的列联表的概率为：\n$$ P(b=k) = \\frac{\\binom{C_2}{k} \\binom{N-C_2}{R_1-k}}{\\binom{N}{R_1}} $$\n此处，$R_1=14$，$C_2=8$，且 $N=28$。$k$ 的可能值受边缘总和的约束：$k$ 必须满足 $k \\ge 0$，$k \\le C_2=8$，$k \\le R_1=14$ 和 $R_1-k \\le N-C_2=20$（这意味着 $k \\ge 14-20=-6$）。因此，$k$ 的取值范围是从 $\\max(0, -6)=0$ 到 $\\min(8, 14)=8$。\n\n我们必须计算每种可能列联表的概率，其中 $k$ 的范围从 $0$ 到 $8$：\n常数分母为 $\\binom{N}{R_1} = \\binom{28}{14} = \\frac{28!}{14!14!} = 40,116,600$。\n在正向链上有 $k$ 个变异等位基因的列联表的概率为 $P(k) = \\frac{\\binom{8}{k} \\binom{20}{14-k}}{40,116,600}$。设分子为 $Num(k) = \\binom{8}{k} \\binom{20}{14-k}$。\n\n每个可能的 $k$ 值的分子为：\n- $k=0: Num(0) = \\binom{8}{0} \\binom{20}{14} = 1 \\times 38,760 = 38,760$\n- $k=1: Num(1) = \\binom{8}{1} \\binom{20}{13} = 8 \\times 77,520 = 620,160$\n- $k=2: Num(2) = \\binom{8}{2} \\binom{20}{12} = 28 \\times 125,970 = 3,527,160$\n- $k=3: Num(3) = \\binom{8}{3} \\binom{20}{11} = 56 \\times 167,960 = 9,405,760$\n- $k=4: Num(4) = \\binom{8}{4} \\binom{20}{10} = 70 \\times 184,756 = 12,932,920$\n- $k=5: Num(5) = \\binom{8}{5} \\binom{20}{9} = 56 \\times 167,960 = 9,405,760$\n- $k=6: Num(6) = \\binom{8}{6} \\binom{20}{8} = 28 \\times 125,970 = 3,527,160$\n- $k=7: Num(7) = \\binom{8}{7} \\binom{20}{7} = 8 \\times 77,520 = 620,160$\n- $k=8: Num(8) = \\binom{8}{8} \\binom{20}{6} = 1 \\times 38,760 = 38,760$\n\n观测到的列联表对应于 $k=2$，其分子为 $Num(2)=3,527,160$。双侧$p$值是所有与观测表同样极端或更极端的列联表的概率之和。“更极端”定义为概率小于或等于观测表的概率。这意味着我们对所有满足 $P(k) \\le P(2)$（等价于 $Num(k) \\le Num(2)$）的 $k$ 值求概率和。\n\n通过比较分子，我们确定满足此条件的 $k$ 值：\n- $Num(0) = 38,760 \\le 3,527,160$\n- $Num(1) = 620,160 \\le 3,527,160$\n- $Num(2) = 3,527,160 \\le 3,527,160$\n- $Num(3) = 9,405,760 > 3,527,160$\n- $Num(4) = 12,932,920 > 3,527,160$\n- $Num(5) = 9,405,760 > 3,527,160$\n- $Num(6) = 3,527,160 \\le 3,527,160$\n- $Num(7) = 620,160 \\le 3,527,160$\n- $Num(8) = 38,760 \\le 3,527,160$\n用于计算p值的 $k$ 值集合是 $\\{0, 1, 2, 6, 7, 8\\}$。\n\n双侧$p$值是这些概率的总和：\n$$ p\\text{-value} = \\sum_{k \\in \\{0, 1, 2, 6, 7, 8\\}} P(k) = \\frac{\\sum_{k \\in \\{0, 1, 2, 6, 7, 8\\}} Num(k)}{\\binom{28}{14}} $$\n分子的总和是：\n$$ \\sum Num(k) = 38,760 + 620,160 + 3,527,160 + 3,527,160 + 620,160 + 38,760 = 8,372,160 $$\n因此，$p$值为：\n$$ p\\text{-value} = \\frac{8,372,160}{40,116,600} $$\n该分数可简化为 $\\frac{24}{115}$。其数值约为 $0.20869565...$。\n\nFisher链（$FS$）得分是Phred标度的$p$值，由转换公式 $Q = -10 \\log_{10}(P)$ 定义。\n$$ FS = -10 \\log_{10}(p\\text{-value}) = -10 \\log_{10}\\left(\\frac{24}{115}\\right) $$\n计算该值：\n$$ FS = -10 \\log_{10}(0.20869565...) \\approx -10 \\times (-0.680487...) \\approx 6.80487... $$\n问题要求将最终答案四舍五入到四位有效数字。\n$6.80487...$ 的前四位有效数字是 $6$、$8$、$0$ 和 $4$。第五位有效数字是 $8$，即 $\\ge 5$，因此我们将第四位有效数字向上取整。\n$$ FS \\approx 6.805 $$",
            "answer": "$$\\boxed{6.805}$$"
        },
        {
            "introduction": "在罕见孟德尔病的遗传学研究中，利用人群等位基因频率数据库（如 gnomAD）是一个极其强大的过滤工具。其基本原理是，在普通人群中过于常见的变异不太可能是导致一种罕见病的原因。本练习  将带你走过设定最大可信等位基因频率阈值 ($p_{\\max}$) 的定量推理过程，该过程综合考虑了疾病患病率、外显率和遗传异质性等关键因素，这是临床变异解读中的一个关键步骤。",
            "id": "4340090",
            "problem": "一个临床遗传学团队正在评估在基因组聚合数据库（gnomAD; Genome Aggregation Database）中观察到的一个单核苷酸变异。所研究的疾病为常染色体显性遗传病，人群患病率为 $P = 1 \\times 10^{-4}$，该变异在杂合子中具有不完全外显性，外显率为 $f = 0.8$。该疾病在多个基因上具有遗传异质性；携带此变异的基因估计占所有病例的比例为 $g = 0.2$。在该基因内部，预计没有任何一个致病性变异占该基因所致病例的比例超过 $a = 0.05$。假设满足 Hardy–Weinberg 平衡，且等位基因频率 $p$ 足够小，以至于与杂合子频率相比，纯合子频率可以忽略不计。\n\n来自 gnomAD 的特定祖源等位基因频率如下：\n- 非洲/非裔美国人：$3.3 \\times 10^{-6}$\n- 拉丁美洲/混合美洲人：$2.8 \\times 10^{-6}$\n- 非芬兰欧洲人：$1.1 \\times 10^{-6}$\n- 东亚人：$8.2 \\times 10^{-7}$\n- 南亚人：$9.5 \\times 10^{-7}$\n\ngnomAD 的总体等位基因频率为 $1.9 \\times 10^{-6}$，但为了进行临床筛选，您必须考虑最高的特定祖源频率，而不是总体频率。\n\n从基本定义出发，使用 Hardy–Weinberg 基因型频率和外显率推导出一个不等式，以确保由单个变异贡献的预期患病率在给定 $g$ 和 $a$ 的情况下，不超过其所允许的最大疾病患病率份额。从这个不等式中，得出在这些假设下，单个常染色体显性变异的最大可信等位基因频率阈值 $p_{\\max}$。\n\n然后，计算最大的特定祖源观测等位基因频率与 $p_{\\max}$ 的比值 $R$。将您计算出的 $R$ 的最终数值答案四舍五入到四位有效数字。以无单位的纯数形式表达您的最终答案。",
            "solution": "基本出发点是 Hardy–Weinberg 平衡，适用于一个双等位基因座，其中变异等位基因的频率为 $p$，参考等位基因的频率为 $q = 1 - p$。基因型频率分别为 $p^{2}$（变异纯合子）、$2pq$（杂合子）和 $q^{2}$（参考纯合子）。对于一个罕见变异，$p \\ll 1$，因此 $q \\approx 1$ 且 $2pq \\approx 2p$，而 $p^{2}$ 相对于 $2p$ 可以忽略不计。\n\n对于一种常染色体显性遗传病，杂合子的外显率为 $f$（且当 $p$ 很小时，纯合子极为罕见），由这单个变异导致的受影响人群的预期比例为\n$$\n\\text{变异贡献的患病率} \\approx f \\left(2p(1-p) + p^{2}\\right).\n$$\n当 $p$ 很小时，$2p(1-p) + p^{2} = 2p - p^{2} \\approx 2p$，所以\n$$\n\\text{变异贡献的患病率} \\approx 2 f p.\n$$\n\n总疾病患病率为 $P$。遗传异质性意味着包含此变异的基因占病例的比例为 $g$。在该基因内部，最大等位基因贡献 $a$ 表明，没有任何一个变异占归因于该基因的病例的比例超过 $a$。因此，该基因中任何一个变异所允许的最大患病率为\n$$\n\\text{允许的变异患病率} = a \\cdot g \\cdot P.\n$$\n\n为确保在这些假设下，该变异不会因为过于常见而不能作为显性遗传病的合理解释，我们要求\n$$\nf \\left(2p(1-p) + p^{2}\\right) \\leq a g P.\n$$\n使用小 $p$ 近似，这简化为\n$$\n2 f p \\leq a g P.\n$$\n对 $p$ 求解，得到最大可信等位基因频率阈值：\n$$\np_{\\max} = \\frac{a g P}{2 f}.\n$$\n\n代入给定值 $a = 0.05$、$g = 0.2$、$P = 1 \\times 10^{-4}$ 和 $f = 0.8$：\n$$\na g P = 0.05 \\times 0.2 \\times 1 \\times 10^{-4} = 1 \\times 10^{-6},\n$$\n和\n$$\n2 f = 1.6.\n$$\n因此，\n$$\np_{\\max} = \\frac{1 \\times 10^{-6}}{1.6} = 6.25 \\times 10^{-7}.\n$$\n\n我们必须使用最高的特定祖源频率，将其与 $p_{\\max}$ 进行比较。从提供的值中，最大的特定祖源等位基因频率是非洲/非裔美国人的 $3.3 \\times 10^{-6}$。定义比率\n$$\nR = \\frac{\\max\\{\\text{特定祖源AF}\\}}{p_{\\max}} = \\frac{3.3 \\times 10^{-6}}{6.25 \\times 10^{-7}}.\n$$\n计算 $R$：\n$$\nR = \\frac{3.3}{0.625} = 5.28.\n$$\n\n将 $R$ 四舍五入到四位有效数字：\n$$\nR \\approx 5.280.\n$$\n\n关于近似有效性的说明：当 $p_{\\max} \\approx 6.25 \\times 10^{-7}$ 时，平方项 $p^{2} \\approx 3.90625 \\times 10^{-13}$ 相对于 $2p \\approx 1.25 \\times 10^{-6}$ 可以忽略不计，这证明了使用小 $p$ 近似的合理性。",
            "answer": "$$\\boxed{5.280}$$"
        }
    ]
}