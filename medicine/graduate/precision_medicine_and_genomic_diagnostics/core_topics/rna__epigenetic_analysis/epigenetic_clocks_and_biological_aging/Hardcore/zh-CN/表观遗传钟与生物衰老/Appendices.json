{
    "hands_on_practices": [
        {
            "introduction": "表观遗传时钟的核心应用之一是量化个体的“生物学年龄”相较于其“年代学年龄”是加速还是减速。这个差异通常被称为表观遗传年龄加速（Epigenetic Age Acceleration, EAA）。本练习将通过一个小型队列研究的假设数据，带你实践计算平均EAA的基本方法，并解读其结果的生物学意义。",
            "id": "4337070",
            "problem": "一项基于医院的精准医学队列研究使用经过验证的全组织表观遗传时钟，量化了正在接受炎症筛查的老年人血液中的DNA甲基化（DNAm），以估算其生物（表观遗传）年龄。对于每位参与者 $i$，设其实足年龄为 $A_i$，预测的表观遗传年龄为 $\\hat{A}_i$。队列水平的表观遗传年龄加速（EAA）定义为所有 $n$ 名参与者中，预测的表观遗传年龄与实足年龄之间个体差异的算术平均值。假设所有样本在同一批次中处理，并针对已知的技术协变量进行了预先调整，因此简单的平均计算是合适的。\n\n给出 $n=10$ 名参与者的数据：\n- $i=1$：$(A_1,\\hat{A}_1)=(45.2, 47.6)$\n- $i=2$：$(A_2,\\hat{A}_2)=(52.8, 51.9)$\n- $i=3$：$(A_3,\\hat{A}_3)=(60.3, 59.0)$\n- $i=4$：$(A_4,\\hat{A}_4)=(39.7, 41.1)$\n- $i=5$：$(A_5,\\hat{A}_5)=(71.5, 74.3)$\n- $i=6$：$(A_6,\\hat{A}_6)=(64.1, 63.2)$\n- $i=7$：$(A_7,\\hat{A}_7)=(55.0, 54.8)$\n- $i=8$：$(A_8,\\hat{A}_8)=(48.6, 50.0)$\n- $i=9$：$(A_9,\\hat{A}_9)=(58.2, 57.6)$\n- $i=10$：$(A_{10},\\hat{A}_{10})=(66.9, 69.5)$\n\n计算队列的平均表观遗传年龄加速值，并以年的单位将其报告为单个实数。将您的答案四舍五入到四位有效数字。然后，在您的解答中，根据该值的正负和大小，解释该队列平均而言是表现出加速衰老还是减速衰老，并在生物衰老评估的背景下评论其大小。",
            "solution": "首先根据所需标准对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n- 该研究涉及 $n=10$ 名参与者。\n- 对于每位参与者 $i$，其实足年龄为 $A_i$，预测的表观遗传年龄为 $\\hat{A}_i$。\n- 队列水平的表观遗传年龄加速（EAA）定义为预测的表观遗传年龄与实足年龄之间个体差异的算术平均值，即 $\\frac{1}{n}\\sum_{i=1}^{n}(\\hat{A}_i - A_i)$。\n- $n=10$ 名参与者的数据如下：\n  - $i=1$：$(A_1, \\hat{A}_1) = (45.2, 47.6)$\n  - $i=2$：$(A_2, \\hat{A}_2) = (52.8, 51.9)$\n  - $i=3$：$(A_3, \\hat{A}_3) = (60.3, 59.0)$\n  - $i=4$：$(A_4, \\hat{A}_4) = (39.7, 41.1)$\n  - $i=5$：$(A_5, \\hat{A}_5) = (71.5, 74.3)$\n  - $i=6$：$(A_6, \\hat{A}_6) = (64.1, 63.2)$\n  - $i=7$：$(A_7, \\hat{A}_7) = (55.0, 54.8)$\n  - $i=8$：$(A_8, \\hat{A}_8) = (48.6, 50.0)$\n  - $i=9$：$(A_9, \\hat{A}_9) = (58.2, 57.6)$\n  - $i=10$：$(A_{10}, \\hat{A}_{10}) = (66.9, 69.5)$\n- 最终结果应四舍五入到四位有效数字。\n- 需要对结果进行解释。\n\n### 步骤 2：使用提取的已知条件进行验证\n对问题的有效性进行评估。\n- **科学依据**：所呈现的概念——实足年龄、表观遗传年龄、DNA甲基化（DNAm）、表观遗传时钟和表观遗传年龄加速（EAA）——在老年科学和精准医学领域是核心且已成熟的概念。将EAA定义为表观遗传年龄与实足年龄之差是标准做法。该问题在科学上是合理的。\n- **适定性**：该问题为待计算的量（队列平均EAA）提供了清晰、无歧义的定义。所有必要的数据点（$A_i$、$\\hat{A}_i$ 和 $n$）都已提供。存在唯一的数值解。\n- **客观性**：该问题使用精确、客观的语言陈述。不包含主观或基于意见的元素。\n\n### 步骤 3：结论与行动\n该问题是 **有效的**。它具有科学依据、适定性强且客观。可以构建一个解决方案。\n\n### 解答推导\n主要任务是计算队列的平均表观遗传年龄加速，我们将其表示为 $\\text{EAA}_{\\text{cohort}}$。根据问题中的定义，这是所有 $n$ 名参与者中，预测的表观遗传年龄 $\\hat{A}_i$ 与实足年龄 $A_i$ 之间个体差异的算术平均值。\n\n队列平均EAA的公式为：\n$$ \\text{EAA}_{\\text{cohort}} = \\frac{1}{n} \\sum_{i=1}^{n} (\\hat{A}_i - A_i) $$\n鉴于参与者人数为 $n=10$，公式变为：\n$$ \\text{EAA}_{\\text{cohort}} = \\frac{1}{10} \\sum_{i=1}^{10} (\\hat{A}_i - A_i) $$\n首先，我们为每位参与者 $i$ 计算个体年龄差异 $\\Delta_i = \\hat{A}_i - A_i$：\n- 对于 $i=1$：$\\Delta_1 = 47.6 - 45.2 = 2.4$ 年\n- 对于 $i=2$：$\\Delta_2 = 51.9 - 52.8 = -0.9$ 年\n- 对于 $i=3$：$\\Delta_3 = 59.0 - 60.3 = -1.3$ 年\n- 对于 $i=4$：$\\Delta_4 = 41.1 - 39.7 = 1.4$ 年\n- 对于 $i=5$：$\\Delta_5 = 74.3 - 71.5 = 2.8$ 年\n- 对于 $i=6$：$\\Delta_6 = 63.2 - 64.1 = -0.9$ 年\n- 对于 $i=7$：$\\Delta_7 = 54.8 - 55.0 = -0.2$ 年\n- 对于 $i=8$：$\\Delta_8 = 50.0 - 48.6 = 1.4$ 年\n- 对于 $i=9$：$\\Delta_9 = 57.6 - 58.2 = -0.6$ 年\n- 对于 $i=10$：$\\Delta_{10} = 69.5 - 66.9 = 2.6$ 年\n\n接下来，我们将这些个体差异相加：\n$$ \\sum_{i=1}^{10} \\Delta_i = 2.4 + (-0.9) + (-1.3) + 1.4 + 2.8 + (-0.9) + (-0.2) + 1.4 + (-0.6) + 2.6 $$\n$$ \\sum_{i=1}^{10} \\Delta_i = (2.4 + 1.4 + 2.8 + 1.4 + 2.6) - (0.9 + 1.3 + 0.9 + 0.2 + 0.6) $$\n$$ \\sum_{i=1}^{10} \\Delta_i = 10.6 - 3.9 = 6.7 \\text{ 年} $$\n最后，我们通过将总和除以 $n=10$ 来计算平均值：\n$$ \\text{EAA}_{\\text{cohort}} = \\frac{6.7}{10} = 0.67 \\text{ 年} $$\n问题要求答案四舍五入到四位有效数字。数字 $0.67$ 有两位有效数字。为了用四位有效数字表示，我们添加后缀零：$0.6700$。\n\n### 解释\n计算出的队列平均表观遗传年龄加速为 $+0.6700$ 年。\n- **正负号**：该值的符号为正。正的EAA表示，平均而言，队列中参与者的表观遗传年龄大于其实足年龄。这表明该队列整体上表现出 **生物衰老加速**。\n- **大小**：加速的大小为 $0.6700$ 年。在生物衰老评估的背景下，这是一个相对温和的值。虽然结果表明了衰老加速的趋势，但小于一年的偏差通常被认为是小的效应。临床上与发病率和死亡率的显著关联通常在EAA值为几年（例如，3到5年或更多，取决于具体的表观遗传时钟和结果）时观察到。因此，该队列在其生物衰老过程中表现出轻微但不极端的平均加速。",
            "answer": "$$\\boxed{0.6700}$$"
        },
        {
            "introduction": "一个表观遗传时钟的优劣取决于其预测的准确性。在评估预测模型时，平均绝对误差（Mean Absolute Error, MAE）和均方根误差（Root Mean Squared Error, RMSE）是两个最常用的指标。本练习旨在让你熟悉这两种误差度量的计算，并深入理解它们在惩罚离群预测值方面的不同特性，这对于严谨地评估时钟性能至关重要。",
            "id": "4337063",
            "problem": "在一项精准医疗研究中，使用一个包含 $n$ 个体的配对预测表观遗传年龄和观测实际年龄的留出验证集，对一个基于脱氧核糖核酸（DNA）甲基化的表观遗传时钟进行评估。对于每个个体 $i \\in \\{1,\\dots,n\\}$，设其观测的实际年龄为 $A_i$（单位：年），预测的表观遗传年龄为 $\\hat{A}_i$（单位：年）。该研究旨在通过使用两种基于绝对偏差损失和平方偏差损失的标准回归误差泛函来量化预测准确性。仅使用它们的标准定义；不要对残差作任何特殊的分布形式假设。\n\n给定 $n=8$ 组配对观测值（单位：年）：\n- 个体 1：$A_1 = 38.0$，$\\hat{A}_1 = 40.5$。\n- 个体 2：$A_2 = 45.0$，$\\hat{A}_2 = 44.2$。\n- 个体 3：$A_3 = 52.0$，$\\hat{A}_3 = 56.7$。\n- 个体 4：$A_4 = 60.0$，$\\hat{A}_4 = 59.0$。\n- 个体 5：$A_5 = 67.0$，$\\hat{A}_5 = 68.1$。\n- 个体 6：$A_6 = 73.0$，$\\hat{A}_6 = 69.5$。\n- 个体 7：$A_7 = 80.0$，$\\hat{A}_7 = 70.0$。\n- 个体 8：$A_8 = 55.0$，$\\hat{A}_8 = 57.3$。\n\n任务：\n- 使用应用于这 $n$ 组配对观测值的均方根误差（RMSE）和平均绝对误差（MAE）的标准定义，计算这两个指标的值，单位为年。\n- 然后计算比率 $r = \\text{RMSE}/\\text{MAE}$。\n- 从误差敏感性的角度，简要解释 RMSE 和 MAE 的相对大小对于此数据集上该表观遗传时钟的残差意味着什么。\n\n仅报告比率 $r$ 作为最终答案，四舍五入到四位有效数字，以纯数字形式表示（无单位）。最终答案中不要包含任何其他量。",
            "solution": "该问题经验证具有科学依据、问题良定且客观。它是在生物医学研究背景下进行统计模型评估的一项标准任务。所提供的数据是完整和一致的，并且所要求的计算使用标准的、无歧义的定义。\n\n目标是针对给定的一组 $n=8$ 的实际年龄（$A_i$）和预测的表观遗传年龄（$\\hat{A}_i$）的配对观测值，计算平均绝对误差（MAE）和均方根误差（RMSE），并随后计算和解释它们的比率。\n\n设第 $i$ 个个体的预测误差（或残差）用 $e_i$ 表示。残差定义为观测值与预测值之差：\n$$e_i = A_i - \\hat{A}_i$$\n\n平均绝对误差（MAE）是误差绝对值的平均值：\n$$\\text{MAE} = \\frac{1}{n} \\sum_{i=1}^{n} |e_i|$$\n\n均方根误差（RMSE）是误差平方的平均值的平方根：\n$$\\text{RMSE} = \\sqrt{\\frac{1}{n} \\sum_{i=1}^{n} e_i^2}$$\n\n给定的 $n=8$ 个个体的数据如下：\n- 个体 1：$A_1 = 38.0$，$\\hat{A}_1 = 40.5$\n- 个体 2：$A_2 = 45.0$，$\\hat{A}_2 = 44.2$\n- 个体 3：$A_3 = 52.0$，$\\hat{A}_3 = 56.7$\n- 个体 4：$A_4 = 60.0$，$\\hat{A}_4 = 59.0$\n- 个体 5：$A_5 = 67.0$，$\\hat{A}_5 = 68.1$\n- 个体 6：$A_6 = 73.0$，$\\hat{A}_6 = 69.5$\n- 个体 7：$A_7 = 80.0$，$\\hat{A}_7 = 70.0$\n- 个体 8：$A_8 = 55.0$，$\\hat{A}_8 = 57.3$\n\n首先，我们计算残差 $e_i$：\n- $e_1 = 38.0 - 40.5 = -2.5$\n- $e_2 = 45.0 - 44.2 = 0.8$\n- $e_3 = 52.0 - 56.7 = -4.7$\n- $e_4 = 60.0 - 59.0 = 1.0$\n- $e_5 = 67.0 - 68.1 = -1.1$\n- $e_6 = 73.0 - 69.5 = 3.5$\n- $e_7 = 80.0 - 70.0 = 10.0$\n- $e_8 = 55.0 - 57.3 = -2.3$\n\n接下来，我们计算 MAE。我们需要残差的绝对值之和：\n$$ \\sum_{i=1}^{8} |e_i| = |-2.5| + |0.8| + |-4.7| + |1.0| + |-1.1| + |3.5| + |10.0| + |-2.3| $$\n$$ \\sum_{i=1}^{8} |e_i| = 2.5 + 0.8 + 4.7 + 1.0 + 1.1 + 3.5 + 10.0 + 2.3 = 25.9 $$\n因此，MAE 为：\n$$ \\text{MAE} = \\frac{25.9}{8} = 3.2375 \\text{ 年} $$\n\n现在，我们计算 RMSE。我们需要残差的平方和：\n$$ \\sum_{i=1}^{8} e_i^2 = (-2.5)^2 + (0.8)^2 + (-4.7)^2 + (1.0)^2 + (-1.1)^2 + (3.5)^2 + (10.0)^2 + (-2.3)^2 $$\n$$ \\sum_{i=1}^{8} e_i^2 = 6.25 + 0.64 + 22.09 + 1.0 + 1.21 + 12.25 + 100.0 + 5.29 = 148.73 $$\n均方误差（MSE）为 $\\frac{148.73}{8} = 18.59125 \\text{ 年}^2$。\nRMSE 是 MSE 的平方根：\n$$ \\text{RMSE} = \\sqrt{18.59125} \\approx 4.311757 \\text{ 年} $$\n\n最后，我们计算比率 $r = \\frac{\\text{RMSE}}{\\text{MAE}}$：\n$$ r = \\frac{\\sqrt{18.59125}}{3.2375} \\approx \\frac{4.311757}{3.2375} \\approx 1.331818 $$\n四舍五入到四位有效数字，我们得到 $r \\approx 1.332$。\n\n有必要对这个结果进行简要解释。RMSE 指标在求平均之前对误差进行平方，这会给较大的误差不成比例的更大权重。相比之下，MAE 指标根据每个误差的绝对大小对其进行线性加权。因此，RMSE 总是大于或等于 MAE。比率 $r = \\frac{\\text{RMSE}}{\\text{MAE}}$ 是误差大小变异性的一个度量；$r=1$ 的值意味着所有误差的大小都相等。一个远大于 1 的 $r$ 值表明存在离群值或误差分布存在显著的变异。在此数据集中，个体 7 的误差（$e_7=10.0$ 年）远大于其他误差。这个单一的大误差对误差平方和有显著贡献，从而相对于 MAE 夸大了 RMSE，并导致比率 $r \\approx 1.332$ 显著大于 1。这表明，虽然在这个小样本中，该表观遗传时钟对大多数个体来说是相当准确的，但其性能因零星的、大的预测误差而下降。",
            "answer": "$$\\boxed{1.332}$$"
        },
        {
            "introduction": "为了使表观遗传年龄加速成为一个独立于年龄本身的有效生物标志物，标准的做法是将其定义为表观遗传年龄对年代学年龄（以及其他协变量，如性别）进行回归分析后得到的残差。这种方法可以确保我们量化的是独立于年龄增长本身的衰老速率变化。本练习将指导你通过编程实践构建这种更稳健的年龄加速指标，验证其与协变量的正交性，并探索其与外部健康风险指标的关联。",
            "id": "4336995",
            "problem": "您的任务是在精准医疗和基因组诊断的背景下，形式化并计算源自GrimAge表观遗传时钟（GrimAge）的表观遗传年龄加速。请从第一性原理出发，将表观遗传年龄加速定义并构建为GrimAge对历法年龄回归的残差，并扩展该模型以包含性别作为协变量，然后论证该指标如何捕获与历法年龄和性别线性无关的风险。\n\n基本原理：\n- 像GrimAge这样的表观遗传时钟将脱氧核糖核酸甲基化（DNA甲基化，DNAm）总结为生物学年龄的标量估计值。GrimAge是基于血浆蛋白和吸烟包年数的甲基化替代指标构建的，并在流行病学队列中得到了广泛验证。\n- 普通最小二乘（OLS）回归将一个响应变量投影到预测变量的列空间上。给定响应向量 $y \\in \\mathbb{R}^n$ 和设计矩阵 $X \\in \\mathbb{R}^{n \\times p}$（包含一个截距列），OLS的拟合值为 $\\hat{y} = X \\hat{\\beta}$，其中 $\\hat{\\beta} = \\arg\\min_{\\beta} \\|y - X \\beta\\|_2^2$。OLS解可以使用Moore–Penrose伪逆 $X^{+}$ 写为 $\\hat{\\beta} = X^{+} y$，从而得到 $\\hat{y} = X X^{+} y$。残差向量为 $r = y - \\hat{y} = (I - X X^{+}) y$，并满足正交性 $X^\\top r = 0$，这意味着残差与 $X$ 中的任何预测变量都不相关。\n- GrimAge的年龄加速，记为 $AgeAccelGrim$，定义为将GrimAge $y$ 对历法年龄（以及可选的性别）进行回归所得到的残差 $r$，它量化了在给定这些协变量的情况下，GrimAge与预期值的偏差。\n\n您的程序必须：\n1. 对于每个测试用例，使用以下设计矩阵构建两个OLS模型：\n   - 模型A（仅年龄）：$X_A = [\\mathbf{1}, age]$，其中 $\\mathbf{1}$ 是代表截距的全1向量，$age$ 是以年为单位的历法年龄向量。\n   - 模型B（年龄和性别）：$X_B = [\\mathbf{1}, age, sex]$，其中 $sex$ 编码为二进制值，女性为 $0$，男性为 $1$。\n2. 对于每个模型，计算残差 $r = y - X X^{+} y$，这些残差即为 $AgeAccelGrim$ 值，以年为单位表示。\n3. 通过计算残差向量与 $X$ 中每个协变量列的内积来验证正交性条件，并为每个内积返回一个布尔值，指示其绝对值是否低于 $10^{-10}$ 的数值容差（这证实了在OLS下与协变量零相关的线性无关性）。\n4. 对于每个测试用例，给定一个外部提供的死亡风险指数向量 $m$，计算模型B的残差 $r$ 与 $m$ 之间的皮尔逊相关系数。如果 $r$ 的样本标准差为零，则按惯例将相关性定义为 $0.0$。返回保留三位小数的相关系数。\n5. 以嵌套列表的形式，输出两个模型以年为单位的残差向量（保留三位小数）、正交性检查的布尔值以及每个测试用例的相关性值。\n\n科学真实性要求：\n- 将 $AgeAccelGrim$ 解释为以年为单位的偏差，并确保所有残差输出都以年为单位，保留三位小数。\n- 正交性必须通过内积进行数值证明，而不是假设成立。\n- 死亡风险指数 $m$ 被设计为与 $AgeAccelGrim$ 信号相关，但与历法年龄或性别没有系统性依赖关系，从而测试独立于这些协变量的风险捕获能力。\n\n测试套件：\n- 每个测试用例提供以年为单位的历法年龄、编码为 $0$（女性）或 $1$（男性）的性别、以年为单位的GrimAge以及一个死亡风险指数（无单位）的数组。所有数组的长度都相同。\n\n测试用例1（一般情况，混合性别，含噪声的GrimAge）：\n- $age = [45, 50, 55, 60, 65, 70, 75, 80]$\n- $sex = [0, 1, 0, 1, 0, 1, 0, 1]$\n- $y$ (GrimAge，单位：年) $= [51.05, 59.8, 62.15, 70.9, 72.35, 80.7, 83.25, 91.6]$\n- $m$ (死亡风险指数，无单位) $= [9.16, 10.56, 9.58, 10.98, 9.37, 10.49, 9.65, 10.77]$\n\n测试用例2（边界情况，性别列全为零）：\n- $age = [40, 44, 48, 52, 56, 60]$\n- $sex = [0, 0, 0, 0, 0, 0]$\n- $y$ (GrimAge，单位：年) $= [44.0, 49.0, 54.0, 59.0, 64.0, 66.5]$\n- $m$ (死亡风险指数，无单位) $= [3.4, 4.2, 5.0, 5.8, 6.6, 5.4]$\n\n测试用例3（边缘情况，性别与截距共线性的完美线性拟合）：\n- $age = [30, 40, 50, 60]$\n- $sex = [1, 1, 1, 1]$\n- $y$ (GrimAge，单位：年) $= [43, 55, 67, 79]$\n- $m$ (死亡风险指数，无单位) $= [8.0, 8.0, 8.0, 8.0]$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表。\n- 每个测试用例的结果必须是一个嵌套列表，格式如下：\n  $[$ 模型A的残差（浮点数列表，单位：年，保留三位小数），模型B的残差（浮点数列表，单位：年，保留三位小数），模型A与$age$的正交性布尔值（单个布尔值），模型B与$age$和$sex$的正交性布尔值（含两个布尔值的列表），模型B残差与$m$之间的皮尔逊相关系数（浮点数，保留三位小数）$]$。\n- 顶层输出是一个包含三个测试用例结果的列表。\n\n所需的顶层格式示例（仅结构）：$[[\\ldots],[\\ldots],[\\ldots]]$。\n\n角度单位不适用。所有残差必须以年为单位表示。不使用百分比；任何分数量都必须表示为小数。",
            "solution": "该问题要求从GrimAge表观遗传时钟中形式化并计算表观遗传年龄加速，特别是 $AgeAccelGrim$。该指标被定义为通过普通最小二乘（OLS）回归将GrimAge值对历法年龄以及（可选地）性别进行回归而获得的残差集合。任务涉及构建两个回归模型，计算残差，验证其与预测变量的正交性，并评估其与一个独立的死亡风险指数的相关性。\n\n### 年龄加速的数学公式\n\n设 $n$ 个个体的观测GrimAge值由向量 $y \\in \\mathbb{R}^n$ 表示。设相应的预测变量（历法年龄、性别等）被组装成设计矩阵 $X \\in \\mathbb{R}^{n \\times p}$ 的列，该矩阵还包括一个由1组成的前导列 $\\mathbf{1}$，用于对截距进行建模。一般线性模型表示为：\n$$ y = X\\beta + \\epsilon $$\n其中 $\\beta \\in \\mathbb{R}^p$ 是未知系数向量，$\\epsilon \\in \\mathbb{R}^n$ 代表误差项。\n\nOLS回归找到一个估计值 $\\hat{\\beta}$，该估计值最小化了平方差之和 $\\|y - X\\beta\\|_2^2$。拟合值向量 $\\hat{y} = X\\hat{\\beta}$ 是 $y$ 在 $X$ 的列空间上的正交投影。计算此投影的一种稳健方法，特别是在预测变量之间存在共线性的情况下，是使用设计矩阵 $X$ 的Moore-Penrose伪逆 $X^{+}$。\n\n到 $X$ 的列空间上的投影矩阵由 $P = X X^{+}$ 给出。然后，拟合值计算如下：\n$$ \\hat{y} = P y = X X^{+} y $$\n表观遗传年龄加速 $AgeAccelGrim$ 被定义为残差向量 $r$，它是 $y$ 中与 $X$ 的列空间正交的分量。它通过从观测值中减去拟合值来计算：\n$$ r = y - \\hat{y} = (I - P)y = (I - X X^{+})y $$\n其中 $I$ 是 $n \\times n$ 的单位矩阵。向量 $r$ 的每个元素 $r_i$ 表示个体GrimAge与其在模型中基于历法年龄和其他协变量的预期值之间的偏差，以年为单位。\n\n### 模型规格\n\n需要构建两个具体的模型：\n\n1.  **模型A（仅年龄）：** 该模型将GrimAge对历法年龄进行回归。设计矩阵 $X_A \\in \\mathbb{R}^{n \\times 2}$ 是：\n    $$ X_A = [\\mathbf{1}, age] $$\n    其中 $age$ 是历法年龄向量。相应的年龄加速为 $r_A = (I - X_A X_A^{+})y$。\n\n2.  **模型B（年龄和性别）：** 该模型将性别作为额外的协变量。设计矩阵 $X_B \\in \\mathbb{R}^{n \\times 3}$ 是：\n    $$ X_B = [\\mathbf{1}, age, sex] $$\n    其中 $sex$ 是一个二元向量（例如，女性为 $0$，男性为 $1$）。相应的年龄加速为 $r_B = (I - X_B X_B^{+})y$。使用 $X_B^{+}$ 可以正确处理 $sex$ 列可能为常数，从而导致与截距列 $\\mathbf{1}$ 发生共线性的情况。\n\n### 正交性\n\nOLS的一个基本性质是残差向量 $r$ 与设计矩阵 $X$ 中的每个列向量 $x_j$ 正交。这表示为 $X^\\top r = 0$。对于任何列 $x_j$，其与残差向量的内积为零：\n$$ x_j^\\top r = 0 $$\n该性质证实了由预测变量解释的方差已从残差中完全移除。对于本问题，我们通过检查内积的绝对值是否小于一个小的容差 $\\tau = 10^{-10}$ 来进行数值验证。具体来说，我们必须检查：\n- 对于模型A：$|age^\\top r_A|  \\tau$。\n- 对于模型B：$|age^\\top r_B|  \\tau$ 且 $|sex^\\top r_B|  \\tau$。\n\n### 与外部变量的相关性\n\n为了评估年龄加速指标是否捕获了其构成预测变量（年龄和性别）中尚未包含的健康相关信息，我们计算其与外部死亡风险指数 $m$ 的皮尔逊相关系数。对于来自模型B的残差向量 $r_B$ 和风险指数向量 $m$，相关性 $\\rho_{r_B, m}$ 为：\n$$ \\rho_{r_B, m} = \\frac{\\sum_{i=1}^n (r_{B,i} - \\bar{r}_B)(m_i - \\bar{m})}{\\sqrt{\\sum_{i=1}^n (r_{B,i} - \\bar{r}_B)^2} \\sqrt{\\sum_{i=1}^n (m_i - \\bar{m})^2}} $$\n其中 $\\bar{r}_B$ 和 $\\bar{m}$ 分别是各自向量的样本均值。如果 $r_B$ 或 $m$ 的样本标准差为零，则分母为零。根据问题中指定的惯例，在这种情况下，相关性定义为 $0.0$。\n\n### 计算过程摘要\n\n对于每个测试用例，执行以下步骤：\n1.  根据给定的 $age$ 和 $sex$ 向量构建设计矩阵 $X_A$ 和 $X_B$，并在前面添加一列全1作为截距。\n2.  为每个设计矩阵计算Moore-Penrose伪逆 $X_A^{+}$ 和 $X_B^{+}$。\n3.  使用公式 $r = y - X(X^{+} y)$ 计算残差向量 $r_A$ 和 $r_B$。\n4.  通过计算所需的内积并将其绝对值与 $10^{-10}$ 的容差进行比较，来验证正交性条件。\n5.  计算 $r_B$ 与提供的死亡率向量 $m$ 之间的皮尔逊相关系数，并按规定处理样本标准差为零的情况。\n6.  将残差和相关系数四舍五入到三位小数，并将结果组合成指定的嵌套列表格式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and generate the final output.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"age\": np.array([45, 50, 55, 60, 65, 70, 75, 80]),\n            \"sex\": np.array([0, 1, 0, 1, 0, 1, 0, 1]),\n            \"y\": np.array([51.05, 59.8, 62.15, 70.9, 72.35, 80.7, 83.25, 91.6]),\n            \"m\": np.array([9.16, 10.56, 9.58, 10.98, 9.37, 10.49, 9.65, 10.77])\n        },\n        {\n            \"age\": np.array([40, 44, 48, 52, 56, 60]),\n            \"sex\": np.array([0, 0, 0, 0, 0, 0]),\n            \"y\": np.array([44.0, 49.0, 54.0, 59.0, 64.0, 66.5]),\n            \"m\": np.array([3.4, 4.2, 5.0, 5.8, 6.6, 5.4])\n        },\n        {\n            \"age\": np.array([30, 40, 50, 60]),\n            \"sex\": np.array([1, 1, 1, 1]),\n            \"y\": np.array([43, 55, 67, 79]),\n            \"m\": np.array([8.0, 8.0, 8.0, 8.0])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = compute_age_acceleration_metrics(\n            case[\"age\"], case[\"sex\"], case[\"y\"], case[\"m\"]\n        )\n        results.append(result)\n\n    # Convert the final list of lists to the required string format.\n    # The default str() for a list adds spaces, so we build the string manually.\n    final_output_str = \"[\" + \",\".join(map(str, results)) + \"]\"\n    final_output_str = final_output_str.replace(\" \", \"\") # Ensure no spaces\n    print(final_output_str)\n\n\ndef compute_age_acceleration_metrics(age, sex, y, m):\n    \"\"\"\n    Computes AgeAccelGrim residuals and related metrics for a single case.\n    \n    Args:\n        age (np.array): Vector of chronological ages.\n        sex (np.array): Vector of sex encodings (0/1).\n        y (np.array): Vector of GrimAge values.\n        m (np.array): Vector of mortality risk index values.\n        \n    Returns:\n        list: A nested list containing the required outputs for one test case.\n    \"\"\"\n    n = len(age)\n    intercept = np.ones(n)\n    tolerance = 1e-10\n\n    # --- Model A (age-only) ---\n    # Construct design matrix X_A = [1, age]\n    X_A = np.vstack([intercept, age]).T\n    \n    # Compute residuals r_A = y - X_A * X_A^+ * y\n    X_A_pinv = np.linalg.pinv(X_A)\n    y_hat_A = X_A @ X_A_pinv @ y\n    r_A = y - y_hat_A\n    \n    # Verify orthogonality: dot product of age vector and residual vector\n    ortho_A_check = abs(np.dot(age, r_A))  tolerance\n    \n    # --- Model B (age and sex) ---\n    # Construct design matrix X_B = [1, age, sex]\n    X_B = np.vstack([intercept, age, sex]).T\n    \n    # Compute residuals r_B = y - X_B * X_B^+ * y\n    X_B_pinv = np.linalg.pinv(X_B)\n    y_hat_B = X_B @ X_B_pinv @ y\n    r_B = y - y_hat_B\n    \n    # Verify orthogonality: dot products of age/sex vectors with residual vector\n    ortho_B_check_age = abs(np.dot(age, r_B))  tolerance\n    ortho_B_check_sex = abs(np.dot(sex, r_B))  tolerance\n    ortho_B_checks = [ortho_B_check_age, ortho_B_check_sex]\n\n    # --- Correlation with mortality risk index ---\n    # Handle the case where standard deviation is zero\n    if np.std(r_B) == 0 or np.std(m) == 0:\n        correlation = 0.0\n    else:\n        # np.corrcoef returns a 2x2 matrix, we need the off-diagonal element\n        corr_matrix = np.corrcoef(r_B, m)\n        correlation = corr_matrix[0, 1]\n    \n    # Check for NaN just in case of floating point issues leading to non-zero std\n    if np.isnan(correlation):\n        correlation = 0.0\n\n    # --- Format output ---\n    residuals_A_rounded = np.round(r_A, 3).tolist()\n    residuals_B_rounded = np.round(r_B, 3).tolist()\n    correlation_rounded = round(correlation, 3)\n\n    return [\n        residuals_A_rounded,\n        residuals_B_rounded,\n        ortho_A_check,\n        ortho_B_checks,\n        correlation_rounded\n    ]\n\n# Execute the main function\nsolve()\n```"
        }
    ]
}