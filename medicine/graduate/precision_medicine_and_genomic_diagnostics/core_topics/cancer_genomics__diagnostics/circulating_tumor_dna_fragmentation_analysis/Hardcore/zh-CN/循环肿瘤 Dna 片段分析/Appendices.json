{
    "hands_on_practices": [
        {
            "introduction": "任何循环肿瘤DNA（ctDNA）片段组学分析的起点，都是将原始的测序数据精确地转化为可供分析的片段信息表。这个实践将指导你设计一个完整的生物信息学流程，从原始FASTQ文件开始，通过处理唯一分子标识符（UMI）、高质量比对和正确的片段坐标计算，最终生成一个可靠的片段表。掌握这个基础流程对于确保后续所有下游分析的准确性至关重要。",
            "id": "4322504",
            "problem": "一个血浆游离脱氧核糖核酸（DNA）文库已通过双末端测序（paired-end reads）进行测序，以支持循环肿瘤DNA的片段化分析。该文库在Read 1的 $5'$ 端整合了长度为 $K$ 个核苷酸的唯一分子标识符（UMIs）。每对读长为 $L$ 个碱基。比对软件以二进制比对/图谱（BAM）格式输出序列比对/图谱（SAM）记录，包括CIGAR字符串和比对质量（MAPQ）。假设片段末端反映了核酸酶的切割位点，并且必须在每条链的 $5'$ 端进行注释。目标是设计一个计算流程，将原始FASTQ文件转换为一个片段表。该表的行代表物理DNA分子，其最少的列包括：染色体、片段起始坐标 $s$、片段结束坐标 $e$、片段长度 $\\ell$、一致性UMI $u$，以及一个从参考基因组序列中派生的、具有链意识的末端上下文注释。\n\n推导的基本依据：\n- 双末端测序为每个原始DNA片段提供两个读段。对于一个典型的插入片段，其正确的方向意味着一个配对读段（mate）比对到正向链，另一个比对到反向链，并且片段长度 $\\ell$ 等于 $e - s + 1$，其中 $s$ 和 $e$ 分别是从比对位置计算出的、位于正向链和反向链上 $5'$ 端的基因组坐标。\n- 比对质量 $Q$ 与错误比对的概率 $p_{\\text{err}} = 10^{-Q/10}$ 相关；越高的 $Q$ 意味着用于末端坐标估计的错配概率越低。\n- UMI去重旨在合并源自同一原始分子的测序或聚合酶链式反应（PCR）重复。UMI碰撞的风险随着原始分子数量 $M$ 相对于UMI空间大小 $U$ 的增加而增加，其中对于随机的 $K$-mer UMI， $U = 4^{K}$。\n\n给定一项研究，其中 $L = 150$，$K = 12$，估计有 $M = 10^{6}$ 个原始分子，请评估以下从FASTQ到片段表的候选流程。选择所有通过第一性原理推理，能够为循环肿瘤DNA片段化分析，产出无偏倚、链方向正确的片段末端坐标和经过适当去重后分子计数的流程。\n\nA. 从Read 1的前 $K$ 个碱基中提取UMI序列，将其移至读段头部信息中，并在比对前从读段中硬性剪切掉这 $K$ 个碱基；对两个配对读段进行接头剪切和质量剪切；使用高保真、支持空位的比对软件比对至人类参考基因组；仅保留 $Q \\ge 30$ 且插入片段大小一致的正确配对比对。对于每一对比对，将正向链配对读段的 $5'$ 坐标（比对起始位置）计算为 $s$，将反向链配对读段的 $5'$ 坐标（比对结束位置，需考虑CIGAR中的比对匹配长度）计算为 $e$，然后设置 $\\ell = e - s + 1$。通过将具有相同一致性UMI $u$ 和相同 $\\{s,e\\}$（为应对局部比对可能引起的微小变动，允许 $\\delta \\le 1$ 个碱基的容差）的记录进行分组来合并重复，为每组创建一条单独的一致性记录行。通过从参考基因组的 $s$ 和 $e$ 位置检索三核苷酸上下文来注释两端，对反向链末端使用反向互补的上下文。\n\nB. 不剪切UMI；带着序列中存在的UMI进行读段比对；保留 $Q \\ge 20$ 的比对；使用每个配对读段的 $3'$ 坐标来定义片段末端；仅通过UMI进行去重，忽略基因组位置，因为当 $M = 10^{6}$ 时，对于 $K = 12$ 的UMI，碰撞是微不足道的；使用测序得到的读段碱基而非参考基因组来注释末端模体（motif）。\n\nC. 在比对前将配对读段合并为单一序列；比对合并后的读段；将总比对长度计算为片段长度 $\\ell$；使用最外侧的软剪切位置来定义末端坐标，以捕获潜在的微同源性；通过要求相同的UMI和在 $\\pm 5$ 个碱基容差范围内相等的 $\\ell$ 来合并重复；使用包含软剪切部分的已比对读段序列来注释末端上下文。\n\nD. 提取并剪切UMI；进行接头和质量剪切；比对至人类参考基因组；保留 $20 \\le Q  30$ 的正确配对比对；使用 $5'$ 坐标计算 $s$ 和 $e$（如A中所述）；通过要求相同的UMI以及在 $\\delta = 10$ 个碱基容差范围内的 $\\{s,e\\}$ 来合并重复，以容纳比对的不确定性；使用参考序列注释末端上下文。\n\n答案选项：\nA, B, C, D",
            "solution": "问题陈述是有效的。它在科学上植根于基因组学和生物信息学的原理，特别涉及用于循环肿瘤DNA分析等应用的游离DNA分析。该问题提法得当，提供了明确的目标和所有必需的参数及定义。所用术语和提供的数值对于现代测序实验而言是标准且切合实际的。\n\n目标是确定一个能够正确处理带有唯一分子标识符（UMIs）的双末端测序数据的计算流程，以生成用于片段化分析的准确片段表。一个准确的分析需要：\n1.  正确处理UMI以防止比对假象。\n2.  高置信度的比对以确定精确的基因组坐标。\n3.  对片段末端（$s$，$e$）和长度（$\\ell$）进行生物学上正确的定义和计算。\n4.  稳健的去重（UMI合并），同时考虑到PCR重复和随机的UMI碰撞。\n5.  注释片段末端序列上下文的正确方法学。\n\n我们获得了具体参数：读长 $L=150$，UMI长度 $K=12$，以及估计的 $M=10^6$ 个原始分子。\n\n首先，我们评估UMI碰撞风险。UMI空间的大小为 $U = 4^K = 4^{12} = 16,777,216 \\approx 1.68 \\times 10^7$。对于 $M=10^6$ 个不同的分子，根据生日问题近似法，预期的碰撞次数（即不同分子偶然被分配到相同UMI的对数）为 $E[\\text{collisions}] \\approx \\frac{M^2}{2U} = \\frac{(10^6)^2}{2 \\times 4^{12}} = \\frac{10^{12}}{2 \\times 16,777,216} \\approx 29,802$。这是一个相当大的碰撞数量，表明仅基于UMI序列进行去重是不充分的，并将导致对不同分子的严重计数不足。正确的去重还必须利用片段的基因组坐标。\n\n现在我们评估每个提议的流程。\n\n### 选项A评估\n\n1.  **UMI处理**：“从Read 1的前 $K$ 个碱基中提取UMI序列，将其移至读段头部信息中，并在比对前从读段中硬性剪切掉这 $K$ 个碱基”。这是一个正确的程序。它分离了非生物学来源的UMI序列，防止其干扰生物插入序列与参考基因组的比对。\n2.  **剪切与比对**：“对两个配对读段进行接头剪切和质量剪切；使用高保真、支持空位的比对软件比对至人类参考基因组；仅保留 $Q \\ge 30$ 的正确配对比对”。这是一个稳健的方案。接头和质量剪切是标准的预处理步骤。使用高保真的支持空位的比对软件对于精确比对至关重要。筛选具有高比对质量（$Q \\ge 30$，对应最大错配概率为 $p_{\\text{err}} = 10^{-30/10} = 0.001$）的正确配对读段对于确保片段末端坐标的精确性至关重要。\n3.  **片段坐标计算**：“将正向链配对读段的 $5'$ 坐标（比对起始位置）计算为 $s$，将反向链配对读段的 $5'$ 坐标（比对结束位置，需考虑CIGAR中的比对匹配长度）计算为 $e$，然后设置 $\\ell = e - s + 1$”。这正确定位了片段的边界，即原始DNA分子两条链的 $5'$ 端。正向链的 $5'$ 端对应于正向读段的比对起始位置。反向链的 $5'$ 端对应于反向互补读段序列的 $3'$ 端，其计算方法为反向读段的比对起始位置加上其在参考序列上的比对长度。确定两个末端坐标后，通常将它们排序，使得 $s$ 为起始，$e$ 为结束。长度计算 $\\ell = e - s + 1$ 对于基于1的包含性坐标是正确的。\n4.  **UMI去重**：“通过将具有相同一致性UMI $u$ 和相同 $\\{s,e\\}$（允许 $\\delta \\le 1$ 个碱基的容差）的记录进行分组来合并重复”。这是正确的去重方法。它要求UMI和基因组坐标都匹配，从而区分真正的PCR重复和随机的UMI碰撞。一个 $\\delta \\le 1$ 碱基的小容差是合适的，可以解释例如插入缺失周围的微小比对模糊性，而不会错误地合并邻近但不同的片段。\n5.  **末端上下文注释**：“通过从参考基因组的 $s$ 和 $e$ 位置检索三核苷酸上下文来注释两端，对反向链末端使用反向互补的上下文”。这是科学上合理的方法。核酸酶切割位点偏好性的分析应基于不变的参考基因组序列，而不是可能包含测序错误或胚系/体细胞变异的读段序列。通过对反向链末端取反向互补序列来正确处理上下文的链特异性也至关重要。\n\n**对A的结论**：该流程在方法论上是健全的，每一步都采用了最佳实践，以确保无偏倚且准确的片段分析。**正确**。\n\n### 选项B评估\n\n1.  **UMI处理**：“不剪切UMI；带着UMI进行读段比对”。这是一个主要缺陷。它将导致读段 $5'$ 端的错配，从而引起软剪切（soft-clipping）等比对假象或降低比对质量。\n2.  **比对与筛选**：“保留 $Q \\ge 20$ 的比对”。对于需要精确末端坐标的应用，$Q=20$ ($p_{\\text{err}}=0.01$) 的比对质量阈值不够严格。\n3.  **片段坐标计算**：“使用每个配对读段的 $3'$ 坐标来定义片段末端”。这在生物学上是错误的。产生片段的核酸酶切割位点位于链的 $5'$ 端。\n4.  **UMI去重**：“仅通过UMI进行去重...因为当 $M=10^6$ 时，对于 $K=12$ 的UMI，碰撞是微不足道的”。如上所述，这个前提是错误的。预期的碰撞数量达数万，不可忽略。仅靠UMI进行去重会严重低估文库的复杂性。\n5.  **末端上下文注释**：“使用测序得到的读段碱基而非参考基因组来注释末端模体”。这是不正确的，因为它将切割基序的分析与测序错误和变异混淆起来。\n\n**对B的结论**：该流程在其设计的每个关键方面都存在缺陷。**错误**。\n\n### 选项C评估\n\n1.  **配对读段处理**：“在比对前将配对读段合并为单一序列”。这从根本上改变了数据结构，使其与目标不兼容。合并读段将原始片段的两个不同末端压缩成一个单一序列，使得识别两个独立的核酸酶切割位点成为不可能，而这正是片段化分析的主要目标。\n2.  **片段坐标计算**：“将总比对长度计算为片段长度 $\\ell$；使用最外侧的软剪切位置来定义末端坐标”。这是错误的合并步骤的直接后果，并且是错误的。片段长度是外侧 $5'$ 端之间的基因组距离，而不是合并序列的长度。软剪切位置不是片段末端的可靠标记。\n3.  **UMI去重**：“通过要求相同的UMI和在 $\\pm 5$ 个碱基容差范围内相等的 $\\ell$ 来合并重复”。这是不充分的。它没有使用基因组坐标 $\\{s,e\\}$，这意味着位于不同位置但恰好具有相同长度和UMI的两个不同片段将被错误地合并。\n4.  **末端上下文注释**：“使用包含软剪切部分的已比对读段序列来注释末端上下文”。使用读段数据而非参考数据是错误的，而使用软剪切的碱基更是错上加错，因为根据定义，这些碱基并未比对到参考序列上。\n\n**对C的结论**：该流程合并配对读段的初始步骤使其从根本上不适合既定目标。**错误**。\n\n### 选项D评估\n\n1.  **UMI处理**：“提取并剪切UMI；进行接头和质量剪切”。此步骤正确。\n2.  **比对与筛选**：“保留 $20 \\le Q  30$ 的正确配对比对”。这个筛选标准不合逻辑。它专门选择中等比对质量的读段，却丢弃了最高质量的读段（$Q \\ge 30$）。对于依赖坐标精度的分析，必须使用可用的最高置信度的比对，而不是排除它们。\n3.  **UMI去重**：“通过要求相同的UMI以及在 $\\delta = 10$ 个碱基容差范围内的 $\\{s,e\\}$ 来合并重复”。虽然同时使用UMI和坐标的原则是正确的，但 $\\delta=10$ 个碱基的容差过大。如此大的窗口将导致染色体上物理位置相近的不同分子被错误地合并，从而通过人为地移除短片段和降低文库复杂性估计来引入偏倚。\n4.  **末端上下文注释**：“使用参考序列注释末端上下文”。此步骤正确。\n\n**对D的结论**：尽管有一些正确的组成部分，但由于不合逻辑的MAPQ过滤器和过于宽松的去重容差，该流程存在严重缺陷，这两者都会引入显著的偏倚。**错误**。\n\n根据分析，只有流程A代表了一种完整、稳健且科学有效的方法，可以实现研究目标。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在生成片段数据之后，一个核心应用便是比较不同群体（如癌症患者与健康对照组）之间的片段组学特征，以发掘潜在的生物标志物。本练习提供了一个具体的场景，要求你应用Kolmogorov-Smirnov（KS）检验来量化比较两个队列中短片段与长片段比例的分布差异。通过这个计算实践，你将掌握一种在片段组学研究中用以比较样本分布的强大非参数统计方法。",
            "id": "4322550",
            "problem": "在基因组诊断学的循环肿瘤脱氧核糖核酸 (ctDNA) 片段化分析中，一个常用的概括性特征是短片段与长片段的比率，该比率对每个血浆样本定义为在固定的碱基对窗口内测得的短片段计数与长片段计数之比。假设对两个队列进行了分析：队列 A（非恶性对照组）和队列 B（确诊实体瘤患者）。对于每个个体，使用相同的分析流程从其游离脱氧核糖核酸 (cfDNA) 片段大小直方图中计算出短片段与长片段的比率。给定以下比率测量值：\n- 队列 A，样本量 $n=10$：$0.58, 0.62, 0.66, 0.69, 0.73, 0.77, 0.81, 0.86, 0.92, 0.98$。\n- 队列 B，样本量 $m=12$：$0.70, 0.74, 0.79, 0.83, 0.88, 0.93, 1.00, 1.05, 1.10, 1.15, 1.22, 1.30$。\n\n使用非参数分布比较的基本原理，特别是经验累积分布函数 (ECDF) 的定义和双样本 Kolmogorov–Smirnov (KS) 检验，完成以下任务：\n- 根据样本构建经验累积分布函数 $F_{A}(x)$ 和 $F_{B}(x)$。\n- 计算双样本 Kolmogorov–Smirnov 统计量 $D=\\sup_{x}\\left|F_{A}(x)-F_{B}(x)\\right|$。\n- 使用双样本 Kolmogorov 分布的渐近形式，在显著性水平 $\\alpha=0.05$ 下，评估是否有证据表明两个队列的短片段与长片段比率的分布存在差异。用文字陈述你的结论。\n- 将 Kolmogorov–Smirnov 统计量 $D$ 视为效应量。报告该效应量。\n\n你最终报告的值必须是效应量 $D$。将你的最终答案四舍五入到四位有效数字。不需要单位。",
            "solution": "首先对问题进行验证，以确保其具有科学依据、定义明确且客观。\n\n**步骤 1：提取已知信息**\n- **主题**：循环肿瘤 DNA (ctDNA) 片段化分析。\n- **度量**：短片段与长片段的比率。\n- **队列 A（对照组）**：样本量 $n=10$。数据：$0.58, 0.62, 0.66, 0.69, 0.73, 0.77, 0.81, 0.86, 0.92, 0.98$。\n- **队列 B（患者组）**：样本量 $m=12$。数据：$0.70, 0.74, 0.79, 0.83, 0.88, 0.93, 1.00, 1.05, 1.10, 1.15, 1.22, 1.30$。\n- **任务**：\n    1. 构建经验累积分布函数 (ECDF) $F_{A}(x)$ 和 $F_{B}(x)$。\n    2. 计算双样本 Kolmogorov–Smirnov (KS) 统计量 $D=\\sup_{x}\\left|F_{A}(x)-F_{B}(x)\\right|$。\n    3. 使用渐近 KS 分布，在显著性水平 $\\alpha=0.05$ 下评估是否存在统计学上的显著差异。\n    4. 将 KS 统计量 $D$作为效应量报告，并四舍五入到四位有效数字。\n\n**步骤 2：使用提取的已知信息进行验证**\n- **科学依据**：该问题在基因组诊断学和生物统计学领域有充分的科学依据。使用 ctDNA 片段比率和 Kolmogorov-Smirnov 检验是标准做法。\n- **适定性**：该问题提供了所有必要的数据，并定义了一个具有唯一解的明确计算任务。\n- **客观性**：问题陈述是客观的，没有任何主观看法。\n- **缺陷检查**：该问题不违反任何无效性标准。它在科学上是合理的、可形式化的、完整的且结构良好。\n\n**步骤 3：结论与行动**\n- **结论**：该问题有效。\n- **行动**：继续进行求解。\n\n**解答**\n\n该问题要求使用双样本 Kolmogorov-Smirnov (KS) 检验来比较来自两个队列 A 和 B 的短片段与长片段比率的分布。\n\n**1. 经验累积分布函数 (ECDF)**\n\n设队列 A 的有序样本为 $x_{A,1}, x_{A,2}, \\dots, x_{A,n}$，其中 $n=10$；队列 B 的有序样本为 $x_{B,1}, x_{B,2}, \\dots, x_{B,m}$，其中 $m=12$。\n\n样本的 ECDF 定义为小于或等于给定值 $x$ 的样本点所占的比例。\n对于队列 A，其 ECDF $F_A(x)$ 由下式给出：\n$$F_A(x) = \\frac{1}{n} \\sum_{i=1}^{n} I(x_{A,i} \\le x) = \\frac{1}{10} \\times (\\text{队列 A 中小于等于 } x \\text{ 的观测值数量})$$\n其中 $I(\\cdot)$ 是指示函数。函数 $F_A(x)$ 是一个阶梯函数，它从 $0$ 开始，在队列 A 的每个数据点处增加一个步长 $1/n = 1/10 = 0.1$，并最终达到值 $1$。\n\n对于队列 B，其 ECDF $F_B(x)$ 由下式给出：\n$$F_B(x) = \\frac{1}{m} \\sum_{j=1}^{m} I(x_{B,j} \\le x) = \\frac{1}{12} \\times (\\text{队列 B 中小于等于 } x \\text{ 的观测值数量})$$\n函数 $F_B(x)$ 是一个阶梯函数，它从 $0$ 开始，在队列 B 的每个数据点处增加一个步长 $1/m = 1/12$，并最终达到值 $1$。\n\n**2. 双样本 KS 统计量 $D$ 的计算**\n\n双样本 KS 统计量 $D$ 是两个 ECDF 在所有可能的 $x$ 值上的最大绝对差：\n$$D = \\sup_{x} |F_A(x) - F_B(x)|$$\n两个阶梯函数之间差值的上确界必然出现在任一队列的某个观测数据点上。为了找到这个最大差值，我们将所有 $n+m=22$ 个唯一数据点合并成一个排序列表，并评估在每个数据点紧邻之前和在该点处 $|F_A(x) - F_B(x)|$ 的差值。\n\n设合并并排序后的观测值列表为 $z_1, z_2, \\dots, z_{22}$。我们计算所有 $k \\in \\{1, \\dots, 22\\}$ 的 $|F_A(z_k) - F_B(z_k)|$ 和 $|F_A(z_k^-) - F_B(z_k^-)|$，其中 $z_k^-$ 表示一个恰好小于 $z_k$ 的值。对于 $k1$，后者等价于 $|F_A(z_{k-1}) - F_B(z_{k-1})|$。\n\n计算过程是通过遍历合并排序后的数据列表来进行的：\n$0.58, 0.62, 0.66, 0.69, 0.70, 0.73, 0.74, 0.77, 0.79, 0.81, 0.83, 0.86, 0.88, 0.92, 0.93, 0.98, 1.00, 1.05, 1.10, 1.15, 1.22, 1.30$。\n\n通过系统地计算在这些数据点定义的区间边界处的 $|F_A(x) - F_B(x)|$ 的值，可以找到最大差值。\n- 当 $x  0.58$ 时，$F_A(x)=0$ 且 $F_B(x)=0$，所以差值为 $0$。\n- 当 $x=0.69$ 时，$F_A(0.69) = 4/10 = 0.4$ 且 $F_B(0.69)=0$，得出差值为 $|0.4-0.0|=0.4$。\n- 在 $x=0.70$ 之前，$F_A(0.70^-) = 4/10 = 0.4$ 且 $F_B(0.70^-)=0$，所以差值仍为 $0.4$。\n- 当 $x=0.73$ 时，$F_A(0.73) = 5/10=0.5$ 且 $F_B(0.73) = 1/12 \\approx 0.0833$，得出差值为 $|0.5 - 1/12| = 5/12 \\approx 0.4167$。\n- 在 $x=0.98$（队列A的最后一个观测值）之前，在 $x = 0.93$ 处评估差值。此处，$F_A(0.93)=9/10=0.9$ 且 $F_B(0.93)=6/12=0.5$，差值为 $|0.9-0.5|=0.4$。\n- 当 $x=0.98$ 时，$F_A(0.98) = 10/10 = 1.0$ 且 $F_B(0.98)=6/12=0.5$。差值为 $|1.0 - 0.5| = 0.5$。\n- 在 $x=1.00$ 之前，ECDF 的值为 $F_A(1.00^-) = F_A(0.98) = 1.0$ 且 $F_B(1.00^-) = F_B(0.98) = 0.5$。差值为 $|1.0-0.5|=0.5$。\n- 当 $x=1.00$ 时，$F_A(1.00)=1.0$ 且 $F_B(1.00) = 7/12 \\approx 0.5833$。差值为 $|1.0 - 7/12| = 5/12 \\approx 0.4167$。\n\n在评估了所有数据点的差值后，发现最大差值为 $0.5$。\n$$D = 0.5$$\n\n**3. 在 $\\alpha=0.05$ 下的假设检验**\n\n我们检验以下假设：\n- 原假设, $H_0$：两个样本来自同一潜在的连续分布。\n- 备择假设, $H_1$：两个样本来自不同的分布。\n\n该问题指定使用 KS 统计量分布的渐近形式。将检验统计量与临界值 $D_{crit}$进行比较，该临界值取决于显著性水平 $\\alpha$ 以及样本量 $n$ 和 $m$。如果我们观测到的统计量 $D$ 大于 $D_{crit}$，则拒绝 $H_0$。\n临界值由以下公式给出：\n$$D_{crit} = c(\\alpha) \\sqrt{\\frac{n+m}{nm}}$$\n其中 $c(\\alpha)$ 是一个从极限 Kolmogorov 分布导出的常数。对于显著性水平 $\\alpha=0.05$，标准值为 $c(0.05) \\approx 1.3581$。\n\n使用给定的样本量 $n=10$ 和 $m=12$：\n$$D_{crit} \\approx 1.3581 \\sqrt{\\frac{10+12}{10 \\times 12}} = 1.3581 \\sqrt{\\frac{22}{120}} = 1.3581 \\sqrt{0.18333...}$$\n$$D_{crit} \\approx 1.3581 \\times 0.42817 = 0.5816$$\n我们将计算出的统计量 $D=0.5$ 与该临界值进行比较：\n$$D = 0.5   D_{crit} \\approx 0.5816$$\n由于观测到的 KS 统计量小于临界值，我们在 $\\alpha=0.05$ 的显著性水平下未能拒绝原假设。\n\n**结论**：根据 Kolmogorov-Smirnov 检验，在 $5\\%$ 的显著性水平上，没有充分的统计证据表明非恶性对照组队列和实体瘤患者队列的短片段与长片段比率的分布存在差异。\n\n**4. 效应量**\n\n问题要求将 Kolmogorov-Smirnov 统计量 $D$ 视为效应量。计算出的效应量为 $D=0.5$。四舍五入到四位有效数字得到 $0.5000$。",
            "answer": "$$\n\\boxed{0.5000}\n$$"
        },
        {
            "introduction": "ctDNA片段组学的一个前沿应用是利用其在启动子区域留下的“足迹”来推断cfDNA的组织来源，这对于癌症的早期发现和溯源具有重大意义。在这个高级实践中，你将通过编写代码，实现一个基于加权、正则化非负最小二乘法的组织溯源算法。这不仅能让你深入理解信号去卷积的数学模型，还能让你亲身体验如何将复杂的生物学问题转化为一个可计算的优化问题并加以解决。",
            "id": "4322534",
            "problem": "您将处理一个组织起源推断问题的形式化表述，该问题基于精准医疗和基因组诊断学领域中的循环肿瘤脱氧核糖核酸 (ctDNA) 片段化分析。在血浆中，游离脱氧核糖核酸 (cfDNA) 的片段化模式反映了核小体的占据情况，而 cfDNA 中的启动子足迹与组织特异性的转录活性相关。在一个 cfDNA 来源的混合模型下，来自样本的启动子足迹向量可以被建模为跨启动子的组织特异性核小体占据图谱的非负线性组合。\n\n从以下基本要素出发：\n- 观测基础：启动子周围的 cfDNA 片段末端密度受到核小体占据情况和转录活性的调控。\n- 线性混合建模：一个 cfDNA 样本是来自不同组织贡献的混合物。\n- 组织组分的非负性以及混合物的组分性质。\n\n形式上，假设有 $K$ 种组织和 $P$ 个启动子。定义：\n- $X \\in \\mathbb{R}^{P \\times K}$ 为组织特异性的、由表达衍生的核小体图谱矩阵，其中第 $k$ 列编码了组织 $k$ 在 $P$ 个启动子上的预期启动子足迹。\n- $f \\in \\mathbb{R}^{P}$ 为从样本中观测到的 cfDNA 启动子足迹向量（每个启动子的片段末端密度，假设为非负）。\n- $w \\in \\mathbb{R}_{\\ge 0}^{P}$ 为针对每个启动子的非负可靠性权重（例如，方差倒数权重、核小体可比对性权重或启动子置信度权重）。\n- $b \\in \\mathbb{R}_{\\ge 0}^{K}$ 为未知的非负组织混合系数，代表组织起源的组分。\n- $\\lambda \\in \\mathbb{R}_{\\ge 0}$ 为一个正则化参数，用于在共线性情况下稳定估计。\n\n假设一个线性观测模型 $f \\approx X b + \\varepsilon$ 并采用加权、正则化的非负最小二乘法原理：通过最小化目标函数来推断 $b$\n$$\nJ(b) \\;=\\; \\left\\| W \\left(f - X b \\right) \\right\\|_2^2 \\;+\\; \\lambda \\left\\| b \\right\\|_2^2\n$$\n约束条件为 $b \\ge 0$，其中 $W = \\mathrm{diag}(w) \\in \\mathbb{R}^{P \\times P}$ 是权重对角矩阵。在获得最小化子 $\\hat{b}$ 后，通过以下方式将其归一化以获得组分分数 $\\tilde{b}$\n$$\n\\tilde{b}_k \\;=\\; \n\\begin{cases}\n\\frac{\\hat{b}_k}{\\sum_{j=1}^{K} \\hat{b}_j},  \\text{if } \\sum_{j=1}^{K} \\hat{b}_j  0, \\\\\n0,  \\text{otherwise},\n\\end{cases}\n$$\n对于 $k \\in \\{1,\\dots,K\\}$。\n\n实现一个算法，该算法：\n1. 用 $w$ 缩放 $X$ 和 $f$ 的行（即，构成 $X' = W X$ 和 $f' = W f$）。\n2. 通过使用 $\\sqrt{\\lambda} I_K$ 增广系统来引入吉洪诺夫正则化，其中 $I_K \\in \\mathbb{R}^{K \\times K}$ 是单位矩阵，从而得到一个增广最小二乘问题：\n$$\n\\min_{b \\ge 0} \\left\\| \\begin{bmatrix} X' \\\\ \\sqrt{\\lambda} I_K \\end{bmatrix} b - \\begin{bmatrix} f' \\\\ 0_K \\end{bmatrix} \\right\\|_2^2,\n$$\n其中 $0_K \\in \\mathbb{R}^{K}$ 是零向量。\n3. 解决非负最小二乘问题以获得 $\\hat{b}$。\n4. 将 $\\hat{b}$ 归一化为 $\\tilde{b}$，如上所定义。\n\n请设计一个程序，对以下每个测试用例执行此算法。为保证可复现性，所有数值矩阵和向量均被精确指定。\n\n测试用例 1（一般情况，有信息量的权重，适度正则化）：\n- $P = 5$, $K = 3$。\n- 数据：\n$$\nX \\;=\\; \n\\begin{bmatrix}\n0.8  0.1  0.2 \\\\\n1.0  0.2  0.3 \\\\\n0.2  0.9  0.1 \\\\\n0.0  0.7  0.9 \\\\\n0.6  0.3  0.4\n\\end{bmatrix}, \\quad\nf \\;=\\;\n\\begin{bmatrix}\n0.55 \\\\ 0.68 \\\\ 0.40 \\\\ 0.31 \\\\ 0.47\n\\end{bmatrix}, \\quad\nw \\;=\\;\n\\begin{bmatrix}\n1.0 \\\\ 0.8 \\\\ 1.2 \\\\ 1.0 \\\\ 0.9\n\\end{bmatrix}, \\quad\n\\lambda \\;=\\; 0.05.\n$$\n\n测试用例 2（两种组织间高度共线性，统一权重，更强正则化）：\n- $P = 5$, $K = 3$。\n- 数据：\n$$\nX \\;=\\;\n\\begin{bmatrix}\n0.4  0.39  0.10 \\\\\n0.6  0.59  0.20 \\\\\n0.8  0.79  0.30 \\\\\n0.5  0.49  0.40 \\\\\n0.7  0.69  0.50\n\\end{bmatrix}, \\quad\nf \\;=\\;\n\\begin{bmatrix}\n0.400 \\\\ 0.592 \\\\ 0.799 \\\\ 0.495 \\\\ 0.693\n\\end{bmatrix}, \\quad\nw \\;=\\;\n\\begin{bmatrix}\n1.0 \\\\ 1.0 \\\\ 1.0 \\\\ 1.0 \\\\ 1.0\n\\end{bmatrix}, \\quad\n\\lambda \\;=\\; 0.10.\n$$\n\n测试用例 3（零信号的边界情况，异构权重，最小正则化）：\n- $P = 4$, $K = 2$。\n- 数据：\n$$\nX \\;=\\;\n\\begin{bmatrix}\n0.2  0.8 \\\\\n0.3  0.7 \\\\\n0.5  0.5 \\\\\n0.9  0.1\n\\end{bmatrix}, \\quad\nf \\;=\\;\n\\begin{bmatrix}\n0.0 \\\\ 0.0 \\\\ 0.0 \\\\ 0.0\n\\end{bmatrix}, \\quad\nw \\;=\\;\n\\begin{bmatrix}\n1.0 \\\\ 0.5 \\\\ 0.8 \\\\ 0.6\n\\end{bmatrix}, \\quad\n\\lambda \\;=\\; 0.01.\n$$\n\n您的程序必须实现上述算法，并为每个测试用例生成归一化的组织组分向量 $\\tilde{b}$。要求的最终输出格式为包含列表的列表的单行，其中每个内部列表是一个测试用例的结果，每个浮点数必须四舍五入到 $6$ 位小数。例如，输出格式形如：\n$$\n\\left[ \\left[ \\tilde{b}^{(1)}_1, \\dots, \\tilde{b}^{(1)}_{K_1} \\right], \\left[ \\tilde{b}^{(2)}_1, \\dots, \\tilde{b}^{(2)}_{K_2} \\right], \\left[ \\tilde{b}^{(3)}_1, \\dots, \\tilde{b}^{(3)}_{K_3} \\right] \\right],\n$$\n以单行打印，使用十进制表示法。不涉及任何物理单位或角度；所有输出均为无量纲的小数。",
            "solution": "该问题要求实现一种算法，从循环肿瘤 DNA (ctDNA) 片段化模式中推断组织起源的混合组分。该问题被构建为一个带吉洪诺夫正则化的非负最小二乘 (NNLS) 优化问题。验证和求解过程将按以下步骤进行。\n\n### 问题验证\n\n#### 步骤 1：提取已知条件\n\n该问题由一个数学模型和求解该模型的算法定义，并应用于三个特定的测试用例。\n\n**模型和目标函数：**\n- 设 $K$ 为组织数量，$P$ 为启动子数量。\n- $X \\in \\mathbb{R}^{P \\times K}$：组织特异性启动子足迹矩阵。\n- $f \\in \\mathbb{R}^{P}$：从样本中观测到的 cfDNA 启动子足迹向量。\n- $w \\in \\mathbb{R}_{\\ge 0}^{P}$：针对每个启动子的非负可靠性权重。\n- $b \\in \\mathbb{R}_{\\ge 0}^{K}$：未知的非负组织混合系数。\n- $\\lambda \\in \\mathbb{R}_{\\ge 0}$：正则化参数。\n系数 $b$ 将通过最小化以下目标函数来推断：\n$$\nJ(b) \\;=\\; \\left\\| W \\left(f - X b \\right) \\right\\|_2^2 \\;+\\; \\lambda \\left\\| b \\right\\|_2^2\n$$\n约束条件为 $b \\ge 0$，其中 $W = \\mathrm{diag}(w)$。\n\n**解的归一化：**\n找到最小化子 $\\hat{b}$ 后，将其归一化为组分分数 $\\tilde{b}$：\n$$\n\\tilde{b}_k \\;=\\; \n\\begin{cases}\n\\frac{\\hat{b}_k}{\\sum_{j=1}^{K} \\hat{b}_j},  \\text{if } \\sum_{j=1}^{K} \\hat{b}_j  0, \\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\n\n**算法：**\n1.  缩放数据矩阵：$X' = W X$ 和 $f' = W f$。\n2.  构建一个增广最小二乘问题：\n    $$\n    \\min_{b \\ge 0} \\left\\| \\begin{bmatrix} X' \\\\ \\sqrt{\\lambda} I_K \\end{bmatrix} b - \\begin{bmatrix} f' \\\\ 0_K \\end{bmatrix} \\right\\|_2^2\n    $$\n    其中 $I_K$ 是 $K \\times K$ 的单位矩阵，$0_K$ 是 $K \\times 1$ 的零向量。\n3.  对所得的非负最小二乘问题求解 $\\hat{b}$。\n4.  归一化 $\\hat{b}$ 以获得 $\\tilde{b}$。\n\n**测试用例：**\n\n- **测试用例 1：** $P = 5, K = 3, \\lambda = 0.05$。\n  $$\n  X = \\begin{bmatrix} 0.8  0.1  0.2 \\\\ 1.0  0.2  0.3 \\\\ 0.2  0.9  0.1 \\\\ 0.0  0.7  0.9 \\\\ 0.6  0.3  0.4 \\end{bmatrix}, \\ f = \\begin{bmatrix} 0.55 \\\\ 0.68 \\\\ 0.40 \\\\ 0.31 \\\\ 0.47 \\end{bmatrix}, \\ w = \\begin{bmatrix} 1.0 \\\\ 0.8 \\\\ 1.2 \\\\ 1.0 \\\\ 0.9 \\end{bmatrix}\n  $$\n- **测试用例 2：** $P = 5, K = 3, \\lambda = 0.10$。\n  $$\n  X = \\begin{bmatrix} 0.4  0.39  0.10 \\\\ 0.6  0.59  0.20 \\\\ 0.8  0.79  0.30 \\\\ 0.5  0.49  0.40 \\\\ 0.7  0.69  0.50 \\end{bmatrix}, \\ f = \\begin{bmatrix} 0.400 \\\\ 0.592 \\\\ 0.799 \\\\ 0.495 \\\\ 0.693 \\end{bmatrix}, \\ w = \\begin{bmatrix} 1.0 \\\\ 1.0 \\\\ 1.0 \\\\ 1.0 \\\\ 1.0 \\end{bmatrix}\n  $$\n- **测试用例 3：** $P = 4, K = 2, \\lambda = 0.01$。\n  $$\n  X = \\begin{bmatrix} 0.2  0.8 \\\\ 0.3  0.7 \\\\ 0.5  0.5 \\\\ 0.9  0.1 \\end{bmatrix}, \\ f = \\begin{bmatrix} 0.0 \\\\ 0.0 \\\\ 0.0 \\\\ 0.0 \\end{bmatrix}, \\ w = \\begin{bmatrix} 1.0 \\\\ 0.5 \\\\ 0.8 \\\\ 0.6 \\end{bmatrix}\n  $$\n\n#### 步骤 2：使用提取的已知条件进行验证\n\n- **科学基础**：该问题明确地属于计算生物学和精准医疗领域。对于像组织起源推断这样的反卷积问题，线性混合模型是一个标准且合适的选择。其潜在的生物学前提——即启动子周围的 cfDNA 片段化模式具有组织特异性——是基于已有的研究。使用加权最小二乘法来考虑测量可靠性，以及使用吉洪诺夫正则化来处理共线性，是数值分析和统计建模中的经典方法。非负性约束是物理上的必然要求。该问题在科学上是合理的。\n- **良态性**：目标函数 $J(b)$ 是两个平方范数之和，当 $\\lambda  0$ 时，它是一个严格凸函数。约束集 $b \\ge 0$ 是一个凸集。在凸集上最小化一个严格凸函数是一个良态问题，保证了唯一最小值的存在。所提供的算法正确地将目标函数转换为标准的非负最小二乘格式，对此存在高效且稳定的求解器。\n- **明确性**：问题陈述是形式化和数学化的，所有变量、常数和数据都被精确且无歧义地定义。\n- **缺陷检查表**：该问题没有任何缺陷。它不是科学上不合理、无法形式化、不完整、矛盾、不切实际、病态或琐碎的。所有数据和维度都是一致的。\n\n#### 步骤 3：结论与行动\n\n该问题是有效的。将遵循指定的算法来开发一个解决方案。\n\n### 解的推导与算法设计\n\n核心任务是解决以下约束优化问题：\n$$\n\\min_{b \\ge 0} J(b) \\quad \\text{where} \\quad J(b) = \\left\\| W(f - Xb) \\right\\|_2^2 + \\lambda \\left\\| b \\right\\|_2^2\n$$\n\n我们将遵循指定的算法步骤来求解这个关于未知系数向量 $b$ 的问题。\n\n**步骤 1：加权变换**\n目标函数的首项是加权残差平方和。设 $w$ 是权重向量。矩阵 $W = \\mathrm{diag}(w)$ 是一个对角线上为权重的对角矩阵。用 $w$ 中相应的权重缩放 $f$ 和 $X$ 的行可以简化这一项。我们定义：\n- $f' = Wf$\n- $X' = WX$\n在计算上，如果 $f$ 是一个列向量而 $X$ 是一个矩阵，这等同于将每一行与相应的权重进行逐元素相乘。具体来说，对于第 $i$ 行，$f'_i = w_i f_i$，并且 $X'$ 的第 $i$ 行是 $X$ 的第 $i$ 行乘以 $w_i$。\n使用这些新变量，目标函数的首项变为：\n$$\n\\left\\| W(f - Xb) \\right\\|_2^2 = \\left\\| Wf - WXb \\right\\|_2^2 = \\left\\| f' - X'b \\right\\|_2^2\n$$\n这现在是一个标准的、非加权的最小二乘项。\n\n**步骤 2：正则化与系统增广**\n目标函数现在是 $J(b) = \\| f' - X'b \\|_2^2 + \\lambda \\| b \\|_2^2$。第二项，即吉洪诺夫正则化惩罚项，也可以表示为欧几里得范数的平方：\n$$\n\\lambda \\|b\\|_2^2 = \\left(\\sqrt{\\lambda}\\right)^2 \\sum_{k=1}^K b_k^2 = \\sum_{k=1}^K \\left(\\sqrt{\\lambda} b_k\\right)^2 = \\left\\| \\sqrt{\\lambda} b \\right\\|_2^2 = \\left\\| \\sqrt{\\lambda}I_K b \\right\\|_2^2\n$$\n其中 $I_K$ 是 $K \\times K$ 的单位矩阵。我们可以将其写为 $\\| 0_K - \\sqrt{\\lambda}I_K b \\|_2^2$，其中 $0_K$ 是一个长度为 $K$ 的零向量。\n整个目标函数现在可以表示为两个平方范数之和：\n$$\nJ(b) = \\| f' - X'b \\|_2^2 + \\| 0_K - \\sqrt{\\lambda}I_K b \\|_2^2\n$$\n欧几里得范数的一个关键性质是，两个向量的平方范数之和等于它们拼接后向量的平方范数。因此，我们可以构建一个增广线性系统。设：\n$$\nA_{\\text{aug}} = \\begin{bmatrix} X' \\\\ \\sqrt{\\lambda} I_K \\end{bmatrix} \\in \\mathbb{R}^{(P+K) \\times K} \\quad \\text{and} \\quad y_{\\text{aug}} = \\begin{bmatrix} f' \\\\ 0_K \\end{bmatrix} \\in \\mathbb{R}^{(P+K)}\n$$\n目标函数随后等价于这个增广系统残差的平方范数：\n$$\nJ(b) = \\left\\| y_{\\text{aug}} - A_{\\text{aug}} b \\right\\|_2^2\n$$\n原始问题已被转换为一个标准的非负最小二乘问题：$\\min_{b \\ge 0} \\| y_{\\text{aug}} - A_{\\text{aug}} b \\|_2^2$。\n\n**步骤 3：求解非负最小二乘 (NNLS) 问题**\n这种标准形式可以使用已有的数值算法高效求解，例如由 Lawson 和 Hanson 开发的活动集方法。`scipy.optimize.nnls` 函数提供了该算法的一个实现。它以矩阵 $A_{\\text{aug}}$ 和向量 $y_{\\text{aug}}$ 为输入，并返回在 $\\hat{b} \\ge 0$ 约束下使范数最小化的解向量 $\\hat{b}$。\n\n**步骤 4：归一化**\n向量 $\\hat{b}$ 包含最优地求解正则化系统的非负系数。这些系数代表每种组织的相对贡献。为了将它们解释为整体的组成部分，必须将它们归一化以使总和为 1。我们计算总和 $S = \\sum_{j=1}^{K} \\hat{b}_j$。\n- 如果 $S  0$，归一化组分为 $\\tilde{b}_k = \\hat{b}_k / S$，对于每个 $k=1, \\dots, K$。\n- 如果 $S = 0$，这种情况只在 $\\hat{b}$ 是零向量时发生，它意味着没有检测到任何组织贡献（例如，零信号或与所有组织图谱正交的信号）。在这种情况下，所有组分贡献都设为零，即对于所有的 $k$，$\\tilde{b}_k = 0$。\n\n这样就完成了算法。实现将系统地将这四个步骤应用于每个提供的测试用例。对于测试用例 3，其中 $f$ 是零向量，我们期望 $J(b)=\\|WXb\\|_2^2 + \\lambda\\|b\\|_2^2$ 的最小化子是 $b=0$，因为 $\\lambda  0$ 且矩阵 $WX$ 具有非负项。因此，我们预期 $\\hat{b}=0$，从而 $\\tilde{b}=0$。",
            "answer": "[[0.612804,0.198276,0.188921],[0.492590,0.487857,0.019554],[0.000000,0.000000]]"
        }
    ]
}