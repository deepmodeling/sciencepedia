{
    "hands_on_practices": [
        {
            "introduction": "在等位基因特异性信息的基础上，本练习介绍了一种区分不同基因组状态的关键统计方法。你将利用贝叶斯框架，根据肿瘤样本中的等位基因读数计数，比较两种相互竞争的假说——杂合性保留与拷贝数中性的杂合性缺失（LOH）。这项练习展示了概率模型如何让我们能够量化支持特定分子事件（如有丝分裂重组）的证据强度。",
            "id": "4322015",
            "problem": "通过高深度靶向测序分析来自患者的肿瘤样本，该分析针对一个胚系杂合性单核苷酸多态性（SNP）位点，其等位基因表示为 $A$ 和 $B$。肿瘤纯度（定义为样本中有核细胞中癌细胞的比例）为 $p = 0.70$。考虑癌细胞中该位点的两种竞争模型：\n\n- 模型 $\\mathcal{M}_0$（无杂合性缺失）：癌细胞为二体，在该位点上是杂合的 $A/B$ 型。在非癌细胞（比例为 $1-p$）中，基因型也是 $A/B$。\n\n- 模型 $\\mathcal{M}_1$（通过有丝分裂重组导致的拷贝数中性杂合性缺失）：由于有丝分裂重组产生了单亲二体，癌细胞为二体，但在该位点上是纯合的；它们是 $A/A$ 或 $B/B$ 的先验概率相等。非癌细胞（比例为 $1-p$）是 $A/B$。\n\n假设测序读数是独立同分布的伯努利试验，其成功概率等于细胞混合物中 $B$ 等位基因的真实潜在比例，并且除了二项抽样外，没有等位基因作图偏倚或过度离散。在该 SNP 位点，总共获得了 $N = 100$ 个读数，其中 $k = 20$ 个报告为 $B$ 等位基因。\n\n使用相等的模型先验概率来计算支持模型 $\\mathcal{M}_1$ 相对于 $\\mathcal{M}_0$ 的贝叶斯因子 $K$ 的以 10 为底的对数，其中 $K$ 定义为在模型 $\\mathcal{M}_1$ 和 $\\mathcal{M}_0$ 下观测数据的边际似然比。将您的答案四舍五入到四位有效数字。以无单位的纯数形式表示您的答案。",
            "solution": "该问题要求计算贝叶斯因子 $K$ 的以 10 为底的对数，该因子用于比较肿瘤在特定位点上遗传状态的两种模型。贝叶斯因子是在每个模型下观测数据的边际似然之比。\n\n首先，我们建立似然计算的框架。数据 $D$ 包括在总共 $N=100$ 个测序读数中观测到 $k=20$ 个 $B$ 等位基因读数。问题陈述测序读数是独立同分布的伯努利试验。这意味着，在给定测序 DNA 池中 $B$ 等位基因的真实比例 $\\theta$ 的条件下，$B$ 等位基因读数的数量 $k$ 服从二项分布。在 $N$ 次试验中观测到 $k$ 次成功的概率质量函数 (PMF) 由下式给出：\n$$P(k|\\theta, N) = \\binom{N}{k} \\theta^k (1-\\theta)^{N-k}$$\n\n$B$ 等位基因的期望比例 $\\theta$ 取决于所考虑的模型。样本中的总 DNA 是来自癌细胞（比例为 $p$）和非癌细胞（比例为 $1-p$）的 DNA 的混合物。总的等位基因比例 $\\theta$ 是这两个细胞群体中比例的加权平均值。所有非癌细胞都是胚系杂合 $A/B$ 型，因此该群体中 $B$ 等位基因的比例为 $0.5$。\n\n让我们分别分析每个模型。\n\n**模型 $\\mathcal{M}_0$：无杂合性缺失**\n在此模型下，癌细胞保留其杂合的 $A/B$ 基因型。\n- 癌细胞中 $B$ 等位基因的比例：$0.5$。\n- 非癌细胞中 $B$ 等位基因的比例：$0.5$。\n\n$B$ 等位基因的总比例 $\\theta_0$ 为：\n$$\\theta_0 = p \\times (0.5) + (1-p) \\times (0.5) = 0.5p + 0.5 - 0.5p = 0.5$$\n模型 $\\mathcal{M}_0$ 下数据的似然是在 $\\theta_0 = 0.5$ 的条件下观测到 $k$ 个 $B$ 等位基因读数的概率：\n$$P(D|\\mathcal{M}_0) = P(k=20 | \\theta_0=0.5, N=100) = \\binom{100}{20} (0.5)^{20} (1-0.5)^{100-20} = \\binom{100}{20} (0.5)^{100}$$\n\n**模型 $\\mathcal{M}_1$：拷贝数中性杂合性缺失**\n该模型是两个子模型的混合，我们将其表示为 $\\mathcal{M}_{1,A/A}$（癌细胞为纯合 $A/A$）和 $\\mathcal{M}_{1,B/B}$（癌细胞为纯合 $B/B$）。问题陈述它们具有相等的先验概率，即 $P(\\mathcal{M}_{1,A/A}|\\mathcal{M}_1) = P(\\mathcal{M}_{1,B/B}|\\mathcal{M}_1) = 0.5$。\n\n$\\mathcal{M}_1$ 的边际似然使用全概率定律计算：\n$$P(D|\\mathcal{M}_1) = P(D|\\mathcal{M}_{1,A/A})P(\\mathcal{M}_{1,A/A}|\\mathcal{M}_1) + P(D|\\mathcal{M}_{1,B/B})P(\\mathcal{M}_{1,B/B}|\\mathcal{M}_1)$$\n$$P(D|\\mathcal{M}_1) = 0.5 \\times P(D|\\mathcal{M}_{1,A/A}) + 0.5 \\times P(D|\\mathcal{M}_{1,B/B})$$\n\n我们需要计算每个子模型的似然。\n- **子模型 $\\mathcal{M}_{1,A/A}$**：癌细胞为 $A/A$。\n  - 癌细胞中 $B$ 等位基因的比例：$0$。\n  - 非癌细胞中 $B$ 等位基因的比例：$0.5$。\n  - $B$ 等位基因的总比例 $\\theta_{1,A/A}$ 为：\n    $$\\theta_{1,A/A} = p \\times (0) + (1-p) \\times (0.5) = 0.5(1-p)$$\n  - 此子模型的似然为：\n    $$P(D|\\mathcal{M}_{1,A/A}) = \\binom{N}{k} (\\theta_{1,A/A})^k (1-\\theta_{1,A/A})^{N-k}$$\n\n- **子模型 $\\mathcal{M}_{1,B/B}$**：癌细胞为 $B/B$。\n  - 癌细胞中 $B$ 等位基因的比例：$1$。\n  - 非癌细胞中 $B$ 等位基因的比例：$0.5$。\n  - $B$ 等位基因的总比例 $\\theta_{1,B/B}$ 为：\n    $$\\theta_{1,B/B} = p \\times (1) + (1-p) \\times (0.5) = p + 0.5 - 0.5p = 0.5(1+p)$$\n  - 此子模型的似然为：\n    $$P(D|\\mathcal{M}_{1,B/B}) = \\binom{N}{k} (\\theta_{1,B/B})^k (1-\\theta_{1,B/B})^{N-k}$$\n\n将这些结合起来，$\\mathcal{M}_1$ 的边际似然为：\n$$P(D|\\mathcal{M}_1) = 0.5 \\binom{N}{k} \\left[ (\\theta_{1,A/A})^k (1-\\theta_{1,A/A})^{N-k} + (\\theta_{1,B/B})^k (1-\\theta_{1,B/B})^{N-k} \\right]$$\n\n现在我们可以计算支持模型 $\\mathcal{M}_1$ 相对于 $\\mathcal{M}_0$ 的贝叶斯因子 $K$：\n$$K = \\frac{P(D|\\mathcal{M}_1)}{P(D|\\mathcal{M}_0)} = \\frac{0.5 \\binom{N}{k} \\left[ (\\theta_{1,A/A})^k (1-\\theta_{1,A/A})^{N-k} + (\\theta_{1,B/B})^k (1-\\theta_{1,B/B})^{N-k} \\right]}{\\binom{N}{k} (0.5)^N}$$\n组合项 $\\binom{N}{k}$ 被消去：\n$$K = \\frac{0.5 \\left[ (\\theta_{1,A/A})^k (1-\\theta_{1,A/A})^{N-k} + (\\theta_{1,B/B})^k (1-\\theta_{1,B/B})^{N-k} \\right]}{(0.5)^N} = 2^{N-1} \\left[ (\\theta_{1,A/A})^k (1-\\theta_{1,A/A})^{N-k} + (\\theta_{1,B/B})^k (1-\\theta_{1,B/B})^{N-k} \\right]$$\n\n我们代入给定的数值：$p = 0.70$，$N=100$ 和 $k=20$。\n首先，计算模型 $\\mathcal{M}_1$ 的等位基因比例：\n$$\\theta_{1,A/A} = 0.5(1-0.70) = 0.5(0.30) = 0.15$$\n$$1 - \\theta_{1,A/A} = 1 - 0.15 = 0.85$$\n$$\\theta_{1,B/B} = 0.5(1+0.70) = 0.5(1.70) = 0.85$$\n$$1 - \\theta_{1,B/B} = 1 - 0.85 = 0.15$$\n将这些代入 $K$ 的表达式中：\n$$K = 2^{100-1} \\left[ (0.15)^{20} (0.85)^{100-20} + (0.85)^{20} (0.15)^{100-20} \\right]$$\n$$K = 2^{99} \\left[ (0.15)^{20} (0.85)^{80} + (0.85)^{20} (0.15)^{80} \\right]$$\n\n最后一步是计算 $K$ 的以 10 为底的对数：\n$$\\log_{10}(K) = \\log_{10}\\left(2^{99} \\left[ (0.15)^{20} (0.85)^{80} + (0.85)^{20} (0.15)^{80} \\right]\\right)$$\n使用对数的性质：\n$$\\log_{10}(K) = 99 \\log_{10}(2) + \\log_{10}\\left( (0.15)^{20} (0.85)^{80} + (0.85)^{20} (0.15)^{80} \\right)$$\n让我们分别评估和式中的两项。设 $T_1 = (0.15)^{20} (0.85)^{80}$ 和 $T_2 = (0.85)^{20} (0.15)^{80}$。\n$$\\log_{10}(T_1) = 20 \\log_{10}(0.15) + 80 \\log_{10}(0.85)$$\n$$\\log_{10}(T_2) = 20 \\log_{10}(0.85) + 80 \\log_{10}(0.15)$$\n使用标准值 $\\log_{10}(0.15) \\approx -0.8239$ 和 $\\log_{10}(0.85) \\approx -0.07058$：\n$$\\log_{10}(T_1) \\approx 20(-0.8239) + 80(-0.07058) = -16.478 - 5.6464 = -22.1244$$\n$$\\log_{10}(T_2) \\approx 20(-0.07058) + 80(-0.8239) = -1.4116 - 65.912 = -67.3236$$\n由于 $\\log_{10}(T_2)$ 比 $\\log_{10}(T_1)$ 负得多，$T_2$ 比 $T_1$ 小很多个数量级。因此，和 $T_1 + T_2 \\approx T_1$。我们可以将其形式化：\n$$T_1 + T_2 = T_1 \\left(1 + \\frac{T_2}{T_1}\\right)$$\n$$\\log_{10}(T_1 + T_2) = \\log_{10}(T_1) + \\log_{10}\\left(1 + \\frac{T_2}{T_1}\\right)$$\n比率 $\\frac{T_2}{T_1} = \\frac{10^{-67.3236}}{10^{-22.1244}} = 10^{-45.1992}$ 是一个极度接近于零的数。项 $\\log_{10}(1 + 10^{-45.1992})$ 是无穷小的，可以安全地忽略。\n因此，$\\log_{10}(T_1+T_2) \\approx \\log_{10}(T_1)$。\n\n现在，我们计算 $\\log_{10}(K)$：\n$$\\log_{10}(K) \\approx 99 \\log_{10}(2) + \\log_{10}(T_1)$$\n$$\\log_{10}(K) \\approx 99 \\log_{10}(2) + 20 \\log_{10}(0.15) + 80 \\log_{10}(0.85)$$\n使用更高精度的值：\n$\\log_{10}(2) \\approx 0.3010300$\n$\\log_{10}(0.15) \\approx -0.8239087$\n$\\log_{10}(0.85) \\approx -0.0705811$\n$$\\log_{10}(K) \\approx 99(0.3010300) + 20(-0.8239087) + 80(-0.0705811)$$\n$$\\log_{10}(K) \\approx 29.80197 - 16.478174 - 5.646488$$\n$$\\log_{10}(K) \\approx 7.677308$$\n将结果四舍五入到四位有效数字，得到 $7.677$。",
            "answer": "$$\\boxed{7.677}$$"
        },
        {
            "introduction": "本练习从拷贝数和等位基因状态转向基因组演化的大尺度结构逻辑。你将实现断点图（breakpoint graph），这是一种强大的组合工具，用于建模和测量经历复杂重排的两个基因组之间的距离。通过计算最小的双断裂-连接（DCJ）事件数，你将深入了解癌症中染色体重排的演化历史和复杂性。",
            "id": "4321983",
            "problem": "考虑两个癌症基因组，它们由有向基因片段组成的环状染色体集合表示。每个基因片段由一个整数标签 $g \\in \\{1,2,\\dots,n\\}$ 表示，其方向由一个符号表示：正方向 $+g$ 意味着当按染色体顺序读取时，该片段从其尾末端 $g_t$ 延伸至其头末端 $g_h$；而负方向 $-g$ 意味着当按染色体顺序读取时，该片段从其头末端 $g_h$ 延伸至其尾末端 $g_t$。环状染色体是带符号整数的循环列表，其中连续片段之间的邻接关系在末尾回绕到开头。\n\n断点图（Breakpoint Graph）的构建如下。构建一个顶点集，包含任一基因组中存在的所有基因 $g$ 的所有基因末端 $\\{g_t,g_h\\}$。对于每个基因组，在末端之间添加带颜色的邻接边。对于环状染色体中的两个连续带符号片段 $x$ 和 $y$，邻接边定义为连接 $x$ 的右末端和 $y$ 的左末端的无序对，其中左末端和右末端定义如下：\n- 如果 $x=+g$，则 $\\text{left}(x)=g_t$ 且 $\\text{right}(x)=g_h$。\n- 如果 $x=-g$，则 $\\text{left}(x)=g_h$ 且 $\\text{right}(x)=g_t$。\n$y$ 的情况也类似。对于环状染色体，还需添加连接最后一个片段的右末端与第一个片段的左末端的邻接关系。将来自第一个基因组的邻接边着为黑色，来自第二个基因组的邻接边着为灰色。由此得到的基于末端的双色图即为断点图。在此图中，如果两个基因组包含相同的基因标签集，则每个顶点的度都恰好为 $2$（一条黑色入射边和一条灰色入射边）。\n\n在双断裂-再连接（double-cut-and-join, DCJ）模型下，这是一个为包括倒位、易位和其他双断裂事件在内的基因组重排所建立的、经过充分检验的抽象模型。将一个环状基因组转换为另一个所需的最少双断裂操作次数，可以从断点图的基本性质推导出。具体来说，对于基因内容相同的环状基因组，最少操作次数是断点图中由黑灰边交替形成的环的数量的函数。\n\n你的任务是实现一个程序，为每个提供的测试用例，构建癌症基因组对的断点图，并计算将第一个基因组转换为第二个基因组所需的最少双断裂操作次数。假设每个测试用例中的两个基因组都具有相同的基因内容，并且完全由环状染色体组成。\n\n定义和要求：\n- 令 $n$ 表示给定测试用例的基因组对中存在的不同基因标签（绝对值）的总数。\n- 使用上述规则构建断点图。\n- 通过交替遍历黑边和灰边，将图分解为不相交的环。\n- 令 $c$ 表示该测试用例中断点图的环数。\n- 使用环数和基因总数计算所需的最少双断裂操作次数，结果为整数。\n\n测试套件：\n对于每个测试用例，两个基因组以环状染色体列表的形式给出，其中每个染色体本身是带符号整数的列表。四个测试用例如下：\n\n1. 基因组A：一个环状染色体 $[1,-2,3,4]$；基因组B：一个环状染色体 $[-2,1,4,3]$。\n2. 基因组A：一个环状染色体 $[1,2,3,4,5]$；基因组B：一个环状染色体 $[1,2,3,4,5]$。\n3. 基因组A：一个环状染色体 $[1,2,3,4,5,6]$；基因组B：一个环状染色体 $[4,-5,6,-1,2,-3]$。\n4. 基因组A：一个环状染色体 $[1,-2,-3,4,-5,6]$；基因组B：一个环状染色体 $[-1,2,-3,-4,5,-6]$。\n\n答案规范：\n- 对于每个测试用例，输出一个等于所需最少双断裂操作次数的整数。\n- 将所有测试用例的结果汇总到一行，以逗号分隔的列表形式包含在方括号中，例如 $[a,b,c,d]$，其中 $a$、$b$、$c$ 和 $d$ 是整数。\n\n不涉及物理单位、角度单位或百分比。程序必须以指定格式精确输出一行。",
            "solution": "该问题要求计算将一个癌症基因组转换为另一个癌症基因组所需的最小双断裂-再连接（DCJ）操作次数。两个基因组都由基因内容相同的环状染色体组成。这个距离可以使用一种名为断点图的结构来计算。\n\n首先，我们为基因组的组成部分建立一个形式化表示。一个标签为 $g$ 的基因有两个末端：一个尾端 $g_t$ 和一个头端 $g_h$。我们可以将这些末端映射到一对唯一的整数。对于基因标签 $g \\in \\{1, 2, \\dots, n\\}$，我们定义如下映射：\n$$\ng_t \\mapsto 2g - 1\n$$\n$$\ng_h \\mapsto 2g\n$$\n我们图中的所有顶点的集合将是整数集合 $\\{1, 2, \\dots, 2n\\}$。基因片段的方向决定了其末端的顺序。片段 $+g$ 从 $g_t$ 延伸至 $g_h$，而片段 $-g$ 从 $g_h$ 延伸至 $g_t$。我们可以如下定义一个带符号基因片段 $x$ 的左末端和右末端：\n- 如果 $x = +g$，则 $\\text{left}(x) = g_t \\mapsto 2g-1$ 且 $\\text{right}(x) = g_h \\mapsto 2g$。\n- 如果 $x = -g$，则 $\\text{left}(x) = g_h \\mapsto 2g$ 且 $\\text{right}(x) = g_t \\mapsto 2g-1$。\n\n断点图构建在这 $2n$ 个顶点的集合上。对于每个基因组，我们添加邻接边。在环状染色体中，对于任意两个连续的基因片段 $x$ 和 $y$，会在 $x$ 的右末端和 $y$ 的左末端之间形成一个邻接关系。这也适用于最后一个和第一个片段，从而形成一个环。来自第一个基因组（基因组A）的邻接关系被着为黑色，来自第二个基因组（基因组B）的邻接关系被着为灰色。\n\n由于两个基因组都包含相同的 $n$ 个基因，每个末端顶点都将恰好有一条黑色边和一条灰色边与之关联。因此，整个断点图可以分解为一组不相交的环，其中边的颜色交替出现（黑、灰、黑、灰……）。\n\n对于两个完全由基因内容相同的环状染色体组成的基因组 A 和 B，其 DCJ 距离（表示为 $d_{DCJ}(A, B)$）由以下公式给出：\n$$\nd_{DCJ}(A, B) = n - c\n$$\n其中 $n$ 是基因的数量，$c$ 是断点图中交替的黑-灰环的数量。\n\n我们的任务是为每个测试用例计算 $c$。一种计算这些环的稳健方法是定义顶点集上的一个置换。设 $\\text{adj}_A(v)$ 是通过黑边连接到 $v$ 的顶点，$\\text{adj}_B(v)$ 是通过灰边连接到 $v$ 的顶点。在一个交替环中，从一个顶点 $v$ 出发的一“步”首先沿着一条黑边到达 $\\text{adj}_A(v)$，然后沿着一条灰边到达 $\\text{adj}_B(\\text{adj}_A(v))$。我们可以通过遍历图并跟踪已访问的顶点来找到所有环并计数。\n\n算法流程如下：\n1.  对于每对基因组，确定唯一基因的总数 $n$。\n2.  根据给定的染色体结构，构建邻接映射 $\\text{adj}_A$ 和 $\\text{adj}_B$。这涉及遍历每个染色体，识别连续的基因片段，并根据规则在它们对应的末端顶点之间添加边。\n3.  通过交替遍历黑边和灰边来计算环数 $c$。这是一个标准图遍历算法：遍历从 $1$ 到 $2n$ 的所有顶点。如果一个顶点尚未被访问，就从它开始遍历，沿着交替的黑灰边路径（例如，$v \\to \\text{adj}_A(v) \\to \\text{adj}_B(\\text{adj}_A(v)) \\to \\ldots$）直到返回起点，并将发现的环中所有顶点标记为已访问。每发现一个新环，就增加一个环计数器。\n4.  使用公式 $d = n - c$ 计算最终距离。\n\n该过程将应用于所提供的四个测试用例中的每一个。",
            "answer": "[2,0,3,4]"
        }
    ]
}