{
    "hands_on_practices": [
        {
            "introduction": "To begin, we establish the foundational decision rules of cost-effectiveness analysis. This first exercise provides a clear, simplified scenario where the incremental costs and health effects of a new precision medicine intervention are already determined. By calculating the Incremental Cost-Effectiveness Ratio (ICER) and Net Monetary Benefit (NMB), you will practice applying the core quantitative tools used to assess whether an intervention offers good value for money relative to a payer's willingness-to-pay threshold .",
            "id": "4328834",
            "problem": "A regional health system is evaluating a targeted therapy pathway guided by a somatic tumor sequencing panel in advanced non-small cell lung cancer. The intervention uses a next-generation sequencing assay to identify actionable driver mutations and directs patients to appropriate tyrosine kinase inhibitors; the comparator is empiric chemotherapy without genomic stratification. A decision-analytic model estimates the incremental outcomes of the genomics-guided pathway versus the comparator to be an incremental cost of $\\Delta C = 15000$ and an incremental effectiveness of $\\Delta E = 0.2$ quality-adjusted life years (QALYs), where a Quality-Adjusted Life Year (QALY) is the standard health outcome measure in cost-effectiveness analysis capturing both survival and quality of life on a $[0,1]$ utility scale. The payer’s willingness-to-pay threshold is $k = 100000$ per QALY, representing the marginal monetary value per unit of health.\n\nUsing the foundational decision-theoretic framework for cost-effectiveness analysis in precision medicine, where the Incremental Cost-Effectiveness Ratio (ICER) quantifies the additional cost per additional unit of health gained and the Net Monetary Benefit (NMB) represents the monetized net gain in health at threshold $k$, compute the $ICER$ and the $NMB$, and determine the adoption decision under the threshold rule.\n\nExpress the $ICER$ in United States dollars per Quality-Adjusted Life Year (USD/QALY), the $NMB$ in United States dollars (USD), and encode the decision as a binary variable $d$ with $d=1$ if the genomics-guided pathway should be adopted and $d=0$ otherwise. Provide exact values; no rounding is required.",
            "solution": "The fundamental base for cost-effectiveness decision-making is the willingness-to-pay threshold framework. In this framework:\n\n- The Incremental Cost-Effectiveness Ratio (ICER) is defined conceptually as the additional cost per additional unit of health gained when moving from the comparator to the intervention. Formally, for strictly positive incremental effectiveness, this is represented by\n$$\nICER = \\frac{\\Delta C}{\\Delta E}.\n$$\nThis follows directly from the notion of cost per unit of effectiveness, where the numerator is the incremental cost and the denominator is the incremental effectiveness.\n\n- The Net Monetary Benefit (NMB) is derived from monetizing health gains at the threshold $k$ and subtracting incremental costs. It embodies the decision-theoretic principle of maximizing expected net benefit, given linear trade-offs between money and health valued at $k$. The standard expression is\n$$\nNMB = k \\,\\Delta E - \\Delta C.\n$$\nThis arises from valuing the health gain $\\Delta E$ at $k$ monetary units per QALY and then deducting the incremental cost $\\Delta C$ to obtain the net benefit in monetary units.\n\nThe decision rule is to adopt the intervention if it increases expected net benefit at threshold $k$, i.e., if $NMB \\ge 0$. Under strictly positive $\\Delta E$, this is equivalent to $ICER \\le k$, since\n$$\nNMB \\ge 0 \\quad \\Longleftrightarrow \\quad k \\,\\Delta E - \\Delta C \\ge 0 \\quad \\Longleftrightarrow \\quad \\frac{\\Delta C}{\\Delta E} \\le k \\quad \\Longleftrightarrow \\quad ICER \\le k,\n$$\nprovided $\\Delta E  0$.\n\nWe now substitute the given values:\n- $\\Delta C = 15000$,\n- $\\Delta E = 0.2$,\n- $k = 100000$.\n\nCompute the ICER:\n$$\nICER = \\frac{15000}{0.2} = 75000.\n$$\n\nCompute the NMB:\n$$\nNMB = 100000 \\times 0.2 - 15000 = 20000 - 15000 = 5000.\n$$\n\nApply the decision rule. Since $NMB = 5000 \\ge 0$, the intervention should be adopted at threshold $k$. Equivalently, $ICER = 75000 \\le 100000$ confirms adoption. Encode the decision as $d=1$.\n\nThus, the outputs are $ICER = 75000$ (USD/QALY), $NMB = 5000$ (USD), and $d=1$.",
            "answer": "$$\\boxed{\\begin{pmatrix}75000  5000  1\\end{pmatrix}}$$"
        },
        {
            "introduction": "Building on the basic framework, this next practice introduces a more realistic layer of complexity: imperfect diagnostic testing. Here, you will not be given the final incremental costs and effects; instead, you must calculate them from fundamental parameters including biomarker prevalence, test sensitivity ($Se$), and specificity ($Sp$). This problem  challenges you to model a classic precision medicine dilemma—comparing a biomarker-guided strategy to a 'treat-all' approach—and quantify how diagnostic accuracy directly impacts the overall expected net benefit.",
            "id": "4328800",
            "problem": "A health system is evaluating a biomarker-guided strategy for a precision oncology therapy. Let the true biomarker status be denoted by a binary variable $B \\in \\{0,1\\}$, with $B=1$ indicating biomarker-positive. The prevalence is $p=\\Pr(B=1)=0.3$. The biomarker assay is applied to all patients under the guided strategy, with sensitivity $Se=0.9$ and specificity $Sp=0.95$. Under the guided strategy, only those who test positive are treated. Under the treat-all strategy, all patients are treated without testing.\n\nTreatment produces a change in quality-adjusted life years (QALYs) that depends on true biomarker status: if $B=1$, the incremental effectiveness is $\\Delta e^{+}=0.4$ QALYs; if $B=0$, the incremental effectiveness is $\\Delta e^{-}=-0.05$ QALYs. Assume that patients who are not treated have $0$ incremental QALYs by definition of the comparator. The drug cost per treated patient is $\\Delta c^{drug}=20000$ (in a fixed monetary unit), and the assay test cost per patient tested is $C_{test}=500$. The willingness-to-pay threshold is $k=100000$ per QALY, expressed in the same monetary unit as costs.\n\nUsing the definition of expected Net Monetary Benefit (NMB), where for any strategy the expected NMB equals $k$ times the expected incremental QALYs minus the expected incremental costs, derive from first principles the expected incremental NMB of the biomarker-guided strategy minus the treat-all strategy. Clearly account for the joint roles of prevalence, sensitivity, and specificity in determining treatment assignment and expected outcomes under each strategy. Express your final answer as a single real number in the same monetary unit as the costs, but do not append units. If no rounding is necessary, report the exact value.",
            "solution": "The objective is to calculate the expected incremental Net Monetary Benefit (NMB) of the biomarker-guided strategy relative to the treat-all strategy. This quantity is denoted as $\\Delta NMB = E[NMB_{guided}] - E[NMB_{all}]$.\n\nThe problem provides the definition of the expected NMB for a given strategy as:\n$$E[NMB] = k \\cdot E[\\Delta e] - E[\\Delta c]$$\nwhere $k$ is the willingness-to-pay threshold, $E[\\Delta e]$ is the expected incremental effectiveness (in QALYs), and $E[\\Delta c]$ is the expected incremental cost.\n\nLet's analyze each strategy separately from first principles.\n\n**1. Treat-All Strategy**\n\nUnder the treat-all strategy, every patient receives the treatment, regardless of their biomarker status. No testing is performed.\n\nThe expected incremental effectiveness, $E[\\Delta e]_{all}$, is the weighted average of the outcomes for biomarker-positive and biomarker-negative patients. The prevalence of biomarker-positive ($B=1$) patients is $p$, and the prevalence of biomarker-negative ($B=0$) patients is $1-p$.\n$$E[\\Delta e]_{all} = \\Pr(B=1) \\cdot \\Delta e^{+} + \\Pr(B=0) \\cdot \\Delta e^{-} = p \\cdot \\Delta e^{+} + (1-p) \\cdot \\Delta e^{-}$$\nThe expected incremental cost, $E[\\Delta c]_{all}$, is simply the drug cost, as every patient is treated.\n$$E[\\Delta c]_{all} = \\Delta c^{drug}$$\nTherefore, the expected NMB for the treat-all strategy is:\n$$E[NMB]_{all} = k \\cdot (p \\cdot \\Delta e^{+} + (1-p) \\cdot \\Delta e^{-}) - \\Delta c^{drug}$$\n\n**2. Biomarker-Guided Strategy**\n\nUnder the biomarker-guided strategy, all patients are tested. Only those who test positive receive the treatment. To calculate the expected outcomes, we must consider the joint probabilities of true biomarker status and test results. Let $T \\in \\{+,-\\}$ be the test result.\n\nThe relevant probabilities are:\n-   Probability of a True Positive (TP): Test is positive, and the patient is biomarker-positive.\n    $\\Pr(T=+, B=1) = \\Pr(T=+|B=1) \\cdot \\Pr(B=1) = Se \\cdot p$\n-   Probability of a False Positive (FP): Test is positive, but the patient is biomarker-negative.\n    $\\Pr(T=+, B=0) = \\Pr(T=+|B=0) \\cdot \\Pr(B=0) = (1-Sp) \\cdot (1-p)$\n-   Probability of a False Negative (FN): Test is negative, but the patient is biomarker-positive.\n    $\\Pr(T=-, B=1) = \\Pr(T=-|B=1) \\cdot \\Pr(B=1) = (1-Se) \\cdot p$\n-   Probability of a True Negative (TN): Test is negative, and the patient is biomarker-negative.\n    $\\Pr(T=-, B=0) = \\Pr(T=-|B=0) \\cdot \\Pr(B=0) = Sp \\cdot (1-p)$\n\nThe expected incremental effectiveness, $E[\\Delta e]_{guided}$, is calculated based on the outcomes for the treated population, which consists of TP and FP patients. Patients who test negative (FN and TN) are not treated and have an incremental effectiveness of $0$.\n$$E[\\Delta e]_{guided} = \\Pr(T=+, B=1) \\cdot \\Delta e^{+} + \\Pr(T=+, B=0) \\cdot \\Delta e^{-} + \\Pr(T=-) \\cdot 0$$\n$$E[\\Delta e]_{guided} = (Se \\cdot p) \\cdot \\Delta e^{+} + ((1-Sp) \\cdot (1-p)) \\cdot \\Delta e^{-}$$\nThe expected incremental cost, $E[\\Delta c]_{guided}$, includes the cost of the assay for every patient and the cost of the drug for patients who test positive. The probability of testing positive is $\\Pr(T=+) = \\Pr(T=+, B=1) + \\Pr(T=+, B=0) = Se \\cdot p + (1-Sp) \\cdot (1-p)$.\n$$E[\\Delta c]_{guided} = C_{test} + \\Pr(T=+) \\cdot \\Delta c^{drug}$$\n$$E[\\Delta c]_{guided} = C_{test} + (Se \\cdot p + (1-Sp) \\cdot (1-p)) \\cdot \\Delta c^{drug}$$\nTherefore, the expected NMB for the biomarker-guided strategy is:\n$$E[NMB]_{guided} = k \\cdot E[\\Delta e]_{guided} - E[\\Delta c]_{guided}$$\n$$E[NMB]_{guided} = k \\cdot ((Se \\cdot p) \\cdot \\Delta e^{+} + ((1-Sp) \\cdot (1-p)) \\cdot \\Delta e^{-}) - (C_{test} + (Se \\cdot p + (1-Sp) \\cdot (1-p)) \\cdot \\Delta c^{drug})$$\n\n**3. Incremental Net Monetary Benefit ($\\Delta NMB$)**\n\nWe now compute the difference $\\Delta NMB = E[NMB]_{guided} - E[NMB]_{all}$.\n\n$$\n\\begin{aligned}\n\\Delta NMB =  \\left[ k \\cdot ((Se \\cdot p) \\Delta e^{+} + (1-Sp)(1-p) \\Delta e^{-}) - (C_{test} + (Se \\cdot p + (1-Sp)(1-p))\\Delta c^{drug}) \\right] \\\\\n - \\left[ k \\cdot (p \\Delta e^{+} + (1-p) \\Delta e^{-}) - \\Delta c^{drug} \\right]\n\\end{aligned}\n$$\nGrouping terms by effectiveness ($k$) and cost:\n$$\n\\begin{aligned}\n\\Delta NMB =  k \\cdot [ (Se \\cdot p) \\Delta e^{+} + (1-Sp)(1-p) \\Delta e^{-} - p \\Delta e^{+} - (1-p) \\Delta e^{-} ] \\\\\n - [ C_{test} + (Se \\cdot p + (1-Sp)(1-p))\\Delta c^{drug} - \\Delta c^{drug} ]\n\\end{aligned}\n$$\nSimplifying the terms in the brackets:\n$$\n\\begin{aligned}\n\\Delta NMB =  k \\cdot [ p \\Delta e^{+}(Se-1) + (1-p) \\Delta e^{-}(1-Sp-1) ] \\\\\n - [ C_{test} + \\Delta c^{drug}(Se \\cdot p + (1-p) - Sp(1-p) - 1) ]\n\\end{aligned}\n$$\n$$\n\\begin{aligned}\n\\Delta NMB =  k \\cdot [ -p(1-Se)\\Delta e^{+} - (1-p)Sp\\Delta e^{-} ] \\\\\n - [ C_{test} + \\Delta c^{drug}(p(Se-1) - Sp(1-p)) ]\n\\end{aligned}\n$$\n$$\n\\begin{aligned}\n\\Delta NMB =  k \\cdot [ -p(1-Se)\\Delta e^{+} - (1-p)Sp\\Delta e^{-} ] \\\\\n - C_{test} - \\Delta c^{drug}[ -p(1-Se) - Sp(1-p) ]\n\\end{aligned}\n$$\n$$\n\\begin{aligned}\n\\Delta NMB =  -p(1-Se)k\\Delta e^{+} - (1-p)Sp k\\Delta e^{-} - C_{test} + p(1-Se)\\Delta c^{drug} + (1-p)Sp\\Delta c^{drug}\n\\end{aligned}\n$$\nFinally, collecting common factors yields:\n$$\\Delta NMB = (1-p)Sp(\\Delta c^{drug} - k\\Delta e^{-}) - p(1-Se)(k\\Delta e^{+} - \\Delta c^{drug}) - C_{test}$$\n\n**4. Numerical Calculation**\n\nWe substitute the given values into the derived expressions.\nGiven:\n$p=0.3$, $Se=0.9$, $Sp=0.95$, $\\Delta e^{+}=0.4$, $\\Delta e^{-}=-0.05$, $\\Delta c^{drug}=20000$, $C_{test}=500$, $k=100000$.\n\nFirst, let's calculate the NMB for each strategy individually.\n$E[NMB]_{all} = 100000 \\cdot (0.3 \\cdot 0.4 + (1-0.3) \\cdot (-0.05)) - 20000$\n$E[NMB]_{all} = 100000 \\cdot (0.12 - 0.7 \\cdot 0.05) - 20000$\n$E[NMB]_{all} = 100000 \\cdot (0.12 - 0.035) - 20000$\n$E[NMB]_{all} = 100000 \\cdot 0.085 - 20000 = 8500 - 20000 = -11500$\n\nFor the guided strategy:\n$E[\\Delta e]_{guided} = (0.9 \\cdot 0.3) \\cdot 0.4 + ((1-0.95) \\cdot (1-0.3)) \\cdot (-0.05)$\n$E[\\Delta e]_{guided} = (0.27) \\cdot 0.4 + (0.05 \\cdot 0.7) \\cdot (-0.05)$\n$E[\\Delta e]_{guided} = 0.108 + (0.035) \\cdot (-0.05) = 0.108 - 0.00175 = 0.10625$\n\n$E[\\Delta c]_{guided} = 500 + (0.9 \\cdot 0.3 + (1-0.95) \\cdot (1-0.3)) \\cdot 20000$\n$E[\\Delta c]_{guided} = 500 + (0.27 + 0.035) \\cdot 20000$\n$E[\\Delta c]_{guided} = 500 + 0.305 \\cdot 20000 = 500 + 6100 = 6600$\n\n$E[NMB]_{guided} = 100000 \\cdot 0.10625 - 6600$\n$E[NMB]_{guided} = 10625 - 6600 = 4025$\n\nFinally, the incremental NMB is:\n$\\Delta NMB = E[NMB]_{guided} - E[NMB]_{all} = 4025 - (-11500) = 4025 + 11500 = 15525$.\n\nThis result indicates that, under the specified conditions and willingness-to-pay threshold, the biomarker-guided strategy provides an additional expected net monetary benefit of $15525$ units per patient compared to the treat-all strategy.",
            "answer": "$$\n\\boxed{15525}\n$$"
        },
        {
            "introduction": "Our final exercise moves from static analysis to dynamic simulation, reflecting the long-term nature of many health outcomes. Using a Markov model, you will project the costs and quality-adjusted life years (QALYs) for a cohort of patients as they transition between health states over a multi-year horizon. This advanced practice  provides hands-on experience with cohort simulation, the application of discounting to future costs and benefits, and the integration of these complex dynamics into a final Net Monetary Benefit calculation.",
            "id": "4328850",
            "problem": "A cohort of patients eligible for a precision oncology intervention is modeled using a discrete-time, time-homogeneous $3$-state Markov chain with states $\\{\\text{Progression-free}, \\text{Progressed}, \\text{Death}\\}$. Two treatment arms are considered: targeted therapy guided by genomic diagnostics and standard care. The goal is to compute expected discounted Quality-Adjusted Life Years (QALYs) over a finite horizon and the incremental Net Monetary Benefit (NMB) at a specified willingness-to-pay threshold. All computations should be carried out in monthly cycles over $5$ years, i.e., $60$ months.\n\nFundamental base:\n- A time-homogeneous Markov chain with a transition matrix $M$ evolves state occupancy via $p_{t} = p_{t-1} M$, where $p_{t}$ is the row vector of state probabilities at cycle $t$, and $p_0$ is the initial distribution.\n- Discounting applies multiplicatively to outcomes accruing at time $t$, using an annual discount rate for costs and an annual discount rate for QALYs. The monthly discount factor at cycle $t$ for a quantity discounted at annual rate $r$ is $\\left(1+r\\right)^{-t/12}$.\n- Expected QALYs in one cycle are computed as the state-probability-weighted utility multiplied by the cycle length in years.\n- Net Monetary Benefit (NMB) at willingness-to-pay threshold $k$ is $k$ times QALYs minus costs.\n\nAssumptions and definitions to be used:\n- Initial cohort starts entirely in the progression-free state: $p_0 = [1, 0, 0]$.\n- State utilities are constant within a case and equal across arms unless otherwise specified. Utilities are applied to state occupancy in each monthly cycle and converted to QALYs using the cycle length in years ($1/12$ years).\n- Costs are accrued monthly per state; a one-time genomic diagnostic cost may be applied at $t=0$ to the targeted therapy arm.\n- The death state is absorbing.\n- Quality-Adjusted Life Year (QALY) and Net Monetary Benefit (NMB) are defined at their first appearance. Net Monetary Benefit (NMB) uses a willingness-to-pay per QALY $k$ expressed in United States dollars (USD).\n- All probabilities must be treated as decimals, not percentages. All monetary values are in USD. QALYs must be expressed in years.\n\nYour program must implement the cohort simulation without half-cycle correction and compute, for each test case:\n- The expected discounted QALYs over $60$ months for targeted therapy ($Q_T$).\n- The expected discounted QALYs over $60$ months for standard care ($Q_S$).\n- The incremental Net Monetary Benefit at $k = \\$100{,}000$ per QALY: $\\Delta NMB = \\left(k \\cdot Q_T - C_T\\right) - \\left(k \\cdot Q_S - C_S\\right)$, where $C_T$ and $C_S$ are expected discounted costs for targeted and standard arms, respectively.\n\nDiscounting:\n- Apply QALY discounting using annual rate $r_Q$ and cost discounting using annual rate $r_C$. For cycle $t \\in \\{1,\\dots,60\\}$, use QALY discount factor $\\left(1+r_Q\\right)^{-t/12}$ and cost discount factor $\\left(1+r_C\\right)^{-t/12}$. A one-time cost at $t=0$ is undiscounted.\n\nCycle-level accrual (per arm):\n- Let $u$ be the utility vector of length $3$ aligned to the state order $\\{\\text{Progression-free}, \\text{Progressed}, \\text{Death}\\}$.\n- Let $c$ be the monthly cost vector of length $3$ aligned similarly.\n- Starting from $p_0$, for each month $t$:\n  1. Update $p_t = p_{t-1} M$.\n  2. Accrue discounted QALYs: $\\text{QALY}_t = \\left(p_t \\cdot u\\right) \\cdot \\left(\\frac{1}{12}\\right) \\cdot \\left(1+r_Q\\right)^{-t/12}$.\n  3. Accrue discounted costs: $\\text{Cost}_t = \\left(p_t \\cdot c\\right) \\cdot \\left(1+r_C\\right)^{-t/12}$.\n- Sum over $t=1$ to $t=60$ to obtain $Q$ and $C$ for each arm, adding any one-time cost at $t=0$ (undiscounted).\n\nTest suite:\nProvide the following $4$ test cases. For each case, the state order is $\\{\\text{Progression-free}, \\text{Progressed}, \\text{Death}\\}$ and the matrices are row-stochastic with the death state absorbing.\n\n- Case $1$ (baseline targeted therapy benefit and conventional discounting):\n  - Targeted therapy monthly transition matrix:\n    $$M_T = \\begin{bmatrix}\n    0.966  0.030  0.004 \\\\\n    0.000  0.980  0.020 \\\\\n    0.000  0.000  1.000\n    \\end{bmatrix}$$\n  - Standard care monthly transition matrix:\n    $$M_S = \\begin{bmatrix}\n    0.945  0.050  0.005 \\\\\n    0.000  0.970  0.030 \\\\\n    0.000  0.000  1.000\n    \\end{bmatrix}$$\n  - Utilities: $u = [0.85, 0.65, 0.00]$.\n  - Monthly costs (USD): targeted $c_T = [7000, 4000, 0]$, standard $c_S = [4000, 3000, 0]$.\n  - One-time targeted genomic diagnostic cost at $t=0$ (USD): $2000$.\n  - Discount rates: $r_Q = 0.015$, $r_C = 0.030$.\n  - Willingness-to-pay threshold: $k = 100000$.\n\n- Case $2$ (arms with identical transitions; targeted has higher costs; conventional discounting):\n  - Targeted therapy monthly transition matrix:\n    $$M_T = \\begin{bmatrix}\n    0.945  0.050  0.005 \\\\\n    0.000  0.970  0.030 \\\\\n    0.000  0.000  1.000\n    \\end{bmatrix}$$\n  - Standard care monthly transition matrix (identical to targeted):\n    $$M_S = \\begin{bmatrix}\n    0.945  0.050  0.005 \\\\\n    0.000  0.970  0.030 \\\\\n    0.000  0.000  1.000\n    \\end{bmatrix}$$\n  - Utilities: $u = [0.85, 0.65, 0.00]$.\n  - Monthly costs (USD): targeted $c_T = [7000, 4000, 0]$, standard $c_S = [4000, 3000, 0]$.\n  - One-time targeted genomic diagnostic cost at $t=0$ (USD): $2000$.\n  - Discount rates: $r_Q = 0.015$, $r_C = 0.030$.\n  - Willingness-to-pay threshold: $k = 100000$.\n\n- Case $3$ (baseline transitions; zero discounting for both QALYs and costs):\n  - Targeted therapy monthly transition matrix:\n    $$M_T = \\begin{bmatrix}\n    0.966  0.030  0.004 \\\\\n    0.000  0.980  0.020 \\\\\n    0.000  0.000  1.000\n    \\end{bmatrix}$$\n  - Standard care monthly transition matrix:\n    $$M_S = \\begin{bmatrix}\n    0.945  0.050  0.005 \\\\\n    0.000  0.970  0.030 \\\\\n    0.000  0.000  1.000\n    \\end{bmatrix}$$\n  - Utilities: $u = [0.85, 0.65, 0.00]$.\n  - Monthly costs (USD): targeted $c_T = [7000, 4000, 0]$, standard $c_S = [4000, 3000, 0]$.\n  - One-time targeted genomic diagnostic cost at $t=0$ (USD): $2000$.\n  - Discount rates: $r_Q = 0.000$, $r_C = 0.000$.\n  - Willingness-to-pay threshold: $k = 100000$.\n\n- Case $4$ (higher mortality; targeted modestly better than standard):\n  - Targeted therapy monthly transition matrix:\n    $$M_T = \\begin{bmatrix}\n    0.950  0.040  0.010 \\\\\n    0.000  0.920  0.080 \\\\\n    0.000  0.000  1.000\n    \\end{bmatrix}$$\n  - Standard care monthly transition matrix:\n    $$M_S = \\begin{bmatrix}\n    0.925  0.060  0.015 \\\\\n    0.000  0.880  0.120 \\\\\n    0.000  0.000  1.000\n    \\end{bmatrix}$$\n  - Utilities: $u = [0.85, 0.65, 0.00]$.\n  - Monthly costs (USD): targeted $c_T = [7000, 4000, 0]$, standard $c_S = [4000, 3000, 0]$.\n  - One-time targeted genomic diagnostic cost at $t=0$ (USD): $2000$.\n  - Discount rates: $r_Q = 0.015$, $r_C = 0.030$.\n  - Willingness-to-pay threshold: $k = 100000$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets.\n- For each test case, output a list of three floating-point values $[Q_T, Q_S, \\Delta NMB]$, each rounded to $6$ decimal places, and aggregate all four test cases into a single top-level list with no spaces. For example: $[[q_{T,1},q_{S,1},\\Delta nmb_1],[q_{T,2},q_{S,2},\\Delta nmb_2],[q_{T,3},q_{S,3},\\Delta nmb_3],[q_{T,4},q_{S,4},\\Delta nmb_4]]$.",
            "solution": "The problem requires the implementation of a cohort-based state-transition model to evaluate the cost-effectiveness of a targeted therapy versus standard care over a finite time horizon. The model simulates a cohort of patients as they transition between three health states: $\\{\\text{Progression-free}, \\text{Progressed}, \\text{Death}\\}$. The simulation proceeds in discrete monthly cycles for a total of $H=60$ months ($5$ years).\n\nThe core of the model is the time-homogeneous Markov chain. The distribution of the cohort across the states at month $t$ is given by a state probability row vector $p_t = [p_{t, \\text{PF}}, p_{t, \\text{P}}, p_{t, \\text{D}}]$. The model evolves according to the equation $p_t = p_{t-1} M$, where $M$ is the monthly state transition probability matrix. The initial state of the cohort is entirely progression-free, so $p_0 = [1, 0, 0]$.\n\nFor each treatment arm (Targeted Therapy $T$, Standard Care $S$), we compute the total expected discounted Quality-Adjusted Life Years (QALYs) and total expected discounted costs.\n\n**1. Expected Discounted Quality-Adjusted Life Years (QALYs)**\n\nThe total expected discounted QALYs, denoted as $Q$, are the sum of QALYs accrued in each cycle, discounted to their present value.\nLet $u = [u_{\\text{PF}}, u_{\\text{P}}, u_{\\text{D}}]$ be the vector of utilities associated with each state. The expected utility for the cohort in cycle $t$ is the dot product of the state probability vector and the utility vector:\n$$E[u_t] = p_t \\cdot u^T = \\sum_{i \\in \\{\\text{PF, P, D}\\}} p_{t,i} \\cdot u_i$$\nThis expected utility is converted to QALYs for the cycle by multiplying by the cycle length, which is $\\frac{1}{12}$ of a year. These QALYs are then discounted using the annual QALY discount rate $r_Q$. The discount factor for cycle $t$ is $(1+r_Q)^{-t/12}$.\nThe discounted QALYs for cycle $t$ are:\n$$\\text{QALY}_t = (p_t \\cdot u^T) \\cdot \\frac{1}{12} \\cdot (1+r_Q)^{-t/12}$$\nThe total expected discounted QALYs over the horizon $H=60$ months is the sum over all cycles:\n$$Q = \\sum_{t=1}^{H} \\text{QALY}_t$$\n\n**2. Expected Discounted Costs**\n\nSimilarly, total expected discounted costs, $C$, are calculated. Let $c = [c_{\\text{PF}}, c_{\\text{P}}, c_{\\text{D}}]$ be the vector of monthly costs associated with each state. The expected cost in cycle $t$ is:\n$$E[c_t] = p_t \\cdot c^T = \\sum_{i \\in \\{\\text{PF, P, D}\\}} p_{t,i} \\cdot c_i$$\nThese costs are discounted using the annual cost discount rate $r_C$. The discount factor for cycle $t$ is $(1+r_C)^{-t/12}$. The discounted cost for cycle $t$ is:\n$$\\text{Cost}_t = (p_t \\cdot c^T) \\cdot (1+r_C)^{-t/12}$$\nThe total expected discounted cost is the sum of the discounted cycle costs plus any one-time costs at $t=0$, which are undiscounted. For the targeted therapy arm, there is a one-time genomic diagnostic cost, $C_{\\text{onetime}}$.\n$$C = C_{\\text{onetime}} + \\sum_{t=1}^{H} \\text{Cost}_t$$\nFor the standard care arm, $C_{\\text{onetime}} = 0$.\n\n**3. Incremental Net Monetary Benefit (NMB)**\n\nThe cost-effectiveness of the targeted therapy relative to standard care is assessed using the Incremental Net Monetary Benefit ($\\Delta\\text{NMB}$). The NMB for a given treatment is defined as the monetized value of its health benefits minus its costs. Given a willingness-to-pay threshold $k$ per QALY, the NMB is:\n$$\\text{NMB} = k \\cdot Q - C$$\nThe $\\Delta\\text{NMB}$ compares the NMB of the targeted therapy ($T$) to that of standard care ($S$):\n$$\\Delta\\text{NMB} = \\text{NMB}_T - \\text{NMB}_S = (k \\cdot Q_T - C_T) - (k \\cdot Q_S - C_S)$$\nA positive $\\Delta\\text{NMB}$ indicates that the additional benefits of the targeted therapy are worth its additional costs, making it the preferred strategy at the given willingness-to-pay threshold.\n\nThe algorithmic procedure is as follows:\nFor each treatment arm (Targeted and Standard):\n1.  Initialize total discounted QALYs to $0$ and total discounted costs to the value of any one-time costs at $t=0$.\n2.  Initialize the state probability vector $p_{\\text{current}} = p_0 = [1, 0, 0]$.\n3.  Loop for $t$ from $1$ to $60$:\n    a.  Update the state probability vector: $p_{\\text{current}} \\leftarrow p_{\\text{current}} M$.\n    b.  Calculate the expected utility for the cycle and accumulate the discounted QALYs to the total.\n    c.  Calculate the expected cost for the cycle and accumulate the discounted cost to the total.\n4.  After the loop, the final totals represent $Q_T, C_T$ or $Q_S, C_S$.\n5.  Use these values to calculate $\\Delta\\text{NMB}$ with the specified $k = 100000$.\nThis process is repeated for each of the four test cases provided.\n\n```python\nimport numpy as np\n\ndef run_simulation(M, u, c, r_q, r_c, c_onetime, n_cycles=60):\n    \"\"\"\n    Runs a discrete-time Markov model simulation for a single treatment arm.\n\n    Args:\n        M (np.ndarray): The 3x3 monthly transition probability matrix.\n        u (np.ndarray): The 1x3 vector of state utilities.\n        c (np.ndarray): The 1x3 vector of monthly state costs.\n        r_q (float): The annual discount rate for QALYs.\n        r_c (float): The annual discount rate for costs.\n        c_onetime (float): A one-time cost at t=0.\n        n_cycles (int): The number of monthly cycles in the simulation horizon.\n\n    Returns:\n        tuple: A tuple containing total discounted QALYs and total discounted costs.\n    \"\"\"\n    # Initial state probability vector: starts in Progression-free\n    p_current = np.array([1.0, 0.0, 0.0])\n\n    # Initialize accumulators\n    total_discounted_qaly = 0.0\n    # One-time cost at t=0 is undiscounted\n    total_discounted_cost = c_onetime\n\n    # Monthly cycle length in years\n    cycle_length_years = 1.0 / 12.0\n\n    # Simulate over the time horizon\n    for t in range(1, n_cycles + 1):\n        # Update state probabilities: p_t = p_{t-1} * M\n        p_current = p_current @ M\n\n        # Calculate expected utility and cost for the current cycle\n        expected_utility = p_current.dot(u)\n        expected_cost = p_current.dot(c)\n\n        # Calculate discount factors for the current cycle t\n        qaly_discount_factor = (1.0 + r_q)**(-t / 12.0)\n        cost_discount_factor = (1.0 + r_c)**(-t / 12.0)\n        \n        # Accrue discounted QALYs\n        cycle_qaly = expected_utility * cycle_length_years\n        total_discounted_qaly += cycle_qaly * qaly_discount_factor\n\n        # Accrue discounted costs\n        total_discounted_cost += expected_cost * cost_discount_factor\n\n    return total_discounted_qaly, total_discounted_cost\n```",
            "answer": "$$\\boxed{\\text{[[3.197904,2.830635,2522.607416],[2.830635,2.830635,-92015.689025],[3.303960,2.915003,28628.703277],[2.302525,1.875630,-27715.394140]]}}$$"
        }
    ]
}