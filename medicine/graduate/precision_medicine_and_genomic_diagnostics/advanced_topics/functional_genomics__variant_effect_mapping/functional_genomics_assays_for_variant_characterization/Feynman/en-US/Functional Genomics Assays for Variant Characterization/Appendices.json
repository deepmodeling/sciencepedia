{
    "hands_on_practices": [
        {
            "introduction": "Understanding how a genetic variant impacts function often begins with modeling its effect on fundamental molecular interactions. This exercise focuses on the critical relationship between a transcription factor and its DNA binding site, a key control point for gene expression. By applying a simple equilibrium binding model, you will derive how a variant-induced change in the dissociation constant ($K_d$) translates into a predictable change in transcriptional output, providing a quantitative framework for interpreting non-coding variants. ",
            "id": "4342291",
            "problem": "A single transcription factor binding site in an enhancer is probed using a Massively Parallel Reporter Assay (MPRA), where a reporter construct drives transcription at a rate that is proportional to the probability that the site is occupied by a transcription factor. Assume a simple one-site binding equilibrium between a transcription factor and the DNA site, with no cooperativity and negligible basal transcription, so that the reporter transcription rate is given by $r = k_{\\max} P_{\\text{bound}}$, where $k_{\\max}$ is a site-specific maximal transcription rate constant and $P_{\\text{bound}}$ is the equilibrium probability that the site is occupied. The dissociation constant is defined by the law of mass action as $K_d = \\frac{[\\mathrm{TF}][S]}{[C]}$, where $[\\mathrm{TF}]$ is the free transcription factor concentration, $[S]$ is the free site concentration, and $[C]$ is the concentration of the transcription factorâ€“site complex.\n\nConsider a reference allele with dissociation constant $K_d^{\\text{ref}} = 10\\,\\mathrm{nM}$ and a variant allele with $K_d^{\\text{var}} = 50\\,\\mathrm{nM}$. The experiment is conducted under limiting transcription factor concentration $[\\mathrm{TF}] = 0.1\\,\\mathrm{nM}$, with $[\\mathrm{TF}] \\ll K_d^{\\text{ref}}$ and $[\\mathrm{TF}] \\ll K_d^{\\text{var}}$, and the free transcription factor is not appreciably depleted by binding to the single site.\n\nStarting from the definition of $K_d$ and the equilibrium for one-site binding, derive the functional form of $P_{\\text{bound}}$ and then, using the limiting concentration assumption, derive the leading-order expression for the fold-change in reporter transcription rate between the variant and reference alleles, $\\frac{r^{\\text{var}}}{r^{\\text{ref}}}$. Compute the natural logarithm of this fold-change, $L = \\ln\\!\\left(\\frac{r^{\\text{var}}}{r^{\\text{ref}}}\\right)$, as a single real number. Round your answer to four significant figures. Express your final answer without units.",
            "solution": "The user wants me to solve a problem about the functional genomics of transcription factor binding.\n\n**1. Problem Validation**\n\nFirst, I will validate the problem statement.\n\n**Step 1: Extract Givens**\n-   The reporter transcription rate is given by the equation $r = k_{\\max} P_{\\text{bound}}$.\n-   $k_{\\max}$ is a site-specific maximal transcription rate constant.\n-   $P_{\\text{bound}}$ is the equilibrium probability that a site is occupied by a transcription factor.\n-   The equilibrium is for a single site with no cooperativity and negligible basal transcription.\n-   The dissociation constant is defined as $K_d = \\frac{[\\mathrm{TF}][S]}{[C]}$, where $[\\mathrm{TF}]$ is the free transcription factor concentration, $[S]$ is the free site concentration, and $[C]$ is the concentration of the transcription factor-site complex.\n-   Reference allele dissociation constant: $K_d^{\\text{ref}} = 10\\,\\mathrm{nM}$.\n-   Variant allele dissociation constant: $K_d^{\\text{var}} = 50\\,\\mathrm{nM}$.\n-   Experimental transcription factor concentration: $[\\mathrm{TF}] = 0.1\\,\\mathrm{nM}$.\n-   Limiting concentration assumption: $[\\mathrm{TF}] \\ll K_d^{\\text{ref}}$ and $[\\mathrm{TF}] \\ll K_d^{\\text{var}}$.\n-   Assumption: The free transcription factor concentration is not appreciably depleted by binding.\n-   The task is to first derive the functional form of $P_{\\text{bound}}$, then derive the leading-order expression for the fold-change in reporter transcription rate, $\\frac{r^{\\text{var}}}{r^{\\text{ref}}}$, and finally compute $L = \\ln\\!\\left(\\frac{r^{\\text{var}}}{r^{\\text{ref}}}\\right)$ to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, employing the standard Langmuir-Hill model for single-site biomolecular binding, a cornerstone of biochemistry. The context of Massively Parallel Reporter Assays (MPRAs) for variant effect characterization is a valid and current topic in functional genomics. The provided values ($K_d$ in the nanomolar range, $[\\mathrm{TF}]$ being sub-nanomolar) are physically realistic for transcription factor-DNA interactions. The problem is well-posed, providing all necessary information, definitions, and constraints to arrive at a unique solution. The language is objective and precise. The problem does not violate any of the specified invalidity criteria.\n\n**Step 3: Verdict and Action**\nThe problem is valid. I will proceed with the solution.\n\n**2. Solution Derivation**\n\nThe solution proceeds in three parts as requested: deriving the expression for $P_{\\text{bound}}$, deriving the leading-order approximation for the fold-change in transcription rate, and computing the final numerical value.\n\n**Part 1: Derivation of the equilibrium binding probability, $P_{\\text{bound}}$**\n\nThe probability that the binding site is occupied, $P_{\\text{bound}}$, is the fraction of the total sites that are in the complex form. Let $[S]_{\\text{total}}$ be the total concentration of binding sites. By conservation of mass for the sites:\n$$[S]_{\\text{total}} = [S] + [C]$$\nwhere $[S]$ is the concentration of free (unoccupied) sites and $[C]$ is the concentration of the transcription factor-DNA complex (occupied sites).\n\n$P_{\\text{bound}}$ is then defined as:\n$$P_{\\text{bound}} = \\frac{[C]}{[S]_{\\text{total}}} = \\frac{[C]}{[S] + [C]}$$\nThe dissociation constant $K_d$ is given by the law of mass action for the dissociation reaction $C \\rightleftharpoons \\mathrm{TF} + S$:\n$$K_d = \\frac{[\\mathrm{TF}][S]}{[C]}$$\nWe can rearrange this expression to solve for the concentration of free sites, $[S]$:\n$$[S] = \\frac{K_d [C]}{[\\mathrm{TF}]}$$\nNow, substitute this expression for $[S]$ into the equation for $P_{\\text{bound}}$:\n$$P_{\\text{bound}} = \\frac{[C]}{\\frac{K_d [C]}{[\\mathrm{TF}]} + [C]}$$\nThe term $[C]$ is present in the numerator and in both terms of the denominator, so it can be cancelled:\n$$P_{\\text{bound}} = \\frac{1}{\\frac{K_d}{[\\mathrm{TF}]} + 1}$$\nMultiplying the numerator and denominator by $[\\mathrm{TF}]$ yields the standard form of the single-site binding isotherm (or Hill-Langmuir equation):\n$$P_{\\text{bound}} = \\frac{[\\mathrm{TF}]}{[\\mathrm{TF}] + K_d}$$\nThe problem states that the free transcription factor is not appreciably depleted by binding, which validates treating $[\\mathrm{TF}]$ as a constant parameter equal to the supplied concentration.\n\n**Part 2: Derivation of the leading-order expression for the fold-change $\\frac{r^{\\text{var}}}{r^{\\text{ref}}}$**\n\nThe transcription rate $r$ is proportional to $P_{\\text{bound}}$, with a proportionality constant $k_{\\max}$:\n$$r = k_{\\max} P_{\\text{bound}} = k_{\\max} \\frac{[\\mathrm{TF}]}{[\\mathrm{TF}] + K_d}$$\nWe are comparing a reference allele and a variant allele of the same binding site. It is a standard assumption in such problems that the mutation affects the binding affinity (and thus $K_d$) but not the maximal transcriptional output once the factor is bound. Therefore, we assume $k_{\\max}$ is the same for both alleles: $k_{\\max}^{\\text{ref}} = k_{\\max}^{\\text{var}} = k_{\\max}$.\n\nThe transcription rates for the variant and reference alleles are:\n$$r^{\\text{var}} = k_{\\max} \\frac{[\\mathrm{TF}]}{[\\mathrm{TF}] + K_d^{\\text{var}}}$$\n$$r^{\\text{ref}} = k_{\\max} \\frac{[\\mathrm{TF}]}{[\\mathrm{TF}] + K_d^{\\text{ref}}}$$\nThe fold-change is the ratio of these two rates:\n$$\\frac{r^{\\text{var}}}{r^{\\text{ref}}} = \\frac{k_{\\max} \\frac{[\\mathrm{TF}]}{[\\mathrm{TF}] + K_d^{\\text{var}}}}{k_{\\max} \\frac{[\\mathrm{TF}]}{[\\mathrm{TF}] + K_d^{\\text{ref}}}}$$\nCanceling the common terms $k_{\\max}$ and $[\\mathrm{TF}]$ gives the exact expression for the fold-change:\n$$\\frac{r^{\\text{var}}}{r^{\\text{ref}}} = \\frac{[\\mathrm{TF}] + K_d^{\\text{ref}}}{[\\mathrm{TF}] + K_d^{\\text{var}}}$$\nThe problem asks for the *leading-order expression* under the limiting concentration assumption $[\\mathrm{TF}] \\ll K_d$ for both alleles. In this limit, the binding probability simplifies. For a generic $K_d$:\n$$P_{\\text{bound}} = \\frac{[\\mathrm{TF}]}{K_d + [\\mathrm{TF}]} = \\frac{[\\mathrm{TF}]}{K_d \\left(1 + \\frac{[\\mathrm{TF}]}{K_d}\\right)} = \\frac{[\\mathrm{TF}]}{K_d} \\left(1 + \\frac{[\\mathrm{TF}]}{K_d}\\right)^{-1}$$\nUsing the first-order Taylor expansion $(1+x)^{-1} \\approx 1 - x$ for small $x$, where $x = \\frac{[\\mathrm{TF}]}{K_d} \\ll 1$:\n$$P_{\\text{bound}} \\approx \\frac{[\\mathrm{TF}]}{K_d} \\left(1 - \\frac{[\\mathrm{TF}]}{K_d}\\right) = \\frac{[\\mathrm{TF}]}{K_d} - \\left(\\frac{[\\mathrm{TF}]}{K_d}\\right)^2 + \\dots$$\nThe leading-order term is the first one, which corresponds to the linear regime of the binding curve:\n$$P_{\\text{bound}} \\approx \\frac{[\\mathrm{TF}]}{K_d}$$\nApplying this approximation to the transcription rates:\n$$r^{\\text{var}} \\approx k_{\\max} \\frac{[\\mathrm{TF}]}{K_d^{\\text{var}}}$$\n$$r^{\\text{ref}} \\approx k_{\\max} \\frac{[\\mathrm{TF}]}{K_d^{\\text{ref}}}$$\nThe leading-order expression for the fold-change is the ratio of these approximate rates:\n$$\\frac{r^{\\text{var}}}{r^{\\text{ref}}} \\approx \\frac{k_{\\max} \\frac{[\\mathrm{TF}]}{K_d^{\\text{var}}}}{k_{\\max} \\frac{[\\mathrm{TF}]}{K_d^{\\text{ref}}}} = \\frac{K_d^{\\text{ref}}}{K_d^{\\text{var}}}$$\n\n**Part 3: Computation of $L = \\ln\\!\\left(\\frac{r^{\\text{var}}}{r^{\\text{ref}}}\\right)$**\n\nUsing the derived leading-order expression and the given values:\n$$K_d^{\\text{ref}} = 10\\,\\mathrm{nM}$$\n$$K_d^{\\text{var}} = 50\\,\\mathrm{nM}$$\nThe fold-change is approximately:\n$$\\frac{r^{\\text{var}}}{r^{\\text{ref}}} \\approx \\frac{10\\,\\mathrm{nM}}{50\\,\\mathrm{nM}} = \\frac{1}{5} = 0.2$$\nThe problem requires computing the natural logarithm of this fold-change, which we denote as $L$:\n$$L = \\ln\\!\\left(\\frac{r^{\\text{var}}}{r^{\\text{ref}}}\\right) \\approx \\ln(0.2)$$\n$$L = \\ln\\left(\\frac{1}{5}\\right) = -\\ln(5)$$\nNow, we compute the numerical value:\n$$L \\approx -1.609437912\\dots$$\nRounding the result to four significant figures gives:\n$$L \\approx -1.609$$",
            "answer": "$$\\boxed{-1.609}$$"
        },
        {
            "introduction": "Moving from theoretical models to experimental data, this practice tackles the analysis of RNA-sequencing (RNA-seq) results to characterize a variant's impact on alternative splicing. You will work with junction-spanning read counts, the primary evidence for splicing events, to derive the maximum likelihood estimator for Percent Spliced In ($\\Psi$), a cornerstone metric in splicing analysis. This exercise will sharpen your statistical skills by grounding them in a core functional genomics application, including the critical step of estimating the uncertainty of your measurement. ",
            "id": "4342287",
            "problem": "In a functional genomics assay using ribonucleic acid sequencing (RNA-seq) to characterize the impact of a genomic variant on a cassette exon, the percent spliced in (PSI) is the fraction of messenger ribonucleic acid molecules that include the exon among all molecules carrying either the inclusion or exclusion junction. Formally, for a binary splicing event with two mutually exclusive junction outcomes, inclusion and exclusion, PSI is defined with respect to the true junction usage probabilities. Assume the following context-appropriate fundamental base: the Central Dogma of molecular biology, the notion that RNA-seq read counts provide noisy samples of underlying transcript abundances, and a binomial sampling model where each junction-spanning read is an independent identically distributed draw from the isoform usage distribution.\n\nYou observe $N_{\\text{inc}}$ inclusion-junction reads and $N_{\\text{exc}}$ exclusion-junction reads for this exon in a single sample. Under the assumptions above:\n- Precisely define PSI, denoted $\\,\\Psi\\,$, as a parameter of the underlying junction usage distribution.\n- Starting from the binomial likelihood, derive the maximum likelihood estimator for $\\,\\Psi\\,$ based on the observed counts $\\,N_{\\text{inc}}\\,$ and $\\,N_{\\text{exc}}\\,$.\n- Derive the sampling variance of the estimator under the binomial model and provide a consistent plug-in estimator that depends only on $\\,N_{\\text{inc}}\\,$ and $\\,N_{\\text{exc}}\\,$.\n- Using the observed counts $\\,N_{\\text{inc}} = 87\\,$ and $\\,N_{\\text{exc}} = 213\\,$, compute the plug-in estimate of the sampling variance. Round your answer to four significant figures. Express your final answer as a dimensionless decimal in standard scientific notation $a \\times 10^{b}$ with $1 \\leq |a| < 10$.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the standard statistical modeling of ribonucleic acid sequencing (RNA-seq) data, well-posed with sufficient information for a unique solution, and expressed in objective, formal language. We may therefore proceed with the solution.\n\nThe problem asks for several derivations related to the percent spliced in ($\\text{PSI}$ or $\\Psi$) from RNA-seq data, culminating in a numerical calculation. We will address each part in sequence.\n\nFirst, we must precisely define the parameter $\\Psi$. The problem states that for a binary splicing event, each junction-spanning read is an independent, identically distributed draw. This corresponds to a sequence of Bernoulli trials. Let $X_i$ be a random variable representing the outcome of the $i$-th read, where $i = 1, \\dots, N$. We can define the outcome $X_i=1$ if the read is from an inclusion junction and $X_i=0$ if it is from an exclusion junction. The parameter $\\Psi$ is the probability of success for each trial, i.e., the probability that a randomly selected junction-spanning read supports the exon inclusion isoform.\n$$\nP(X_i = 1) = \\Psi\n$$\n$$\nP(X_i = 0) = 1 - \\Psi\n$$\nThus, $\\Psi$ is the parameter of the underlying Bernoulli distribution that governs the splicing outcome for any single observed molecule.\n\nSecond, we derive the maximum likelihood estimator ($\\text{MLE}$) for $\\Psi$. We observe $N_{\\text{inc}}$ inclusion reads and $N_{\\text{exc}}$ exclusion reads. The total number of observed junction-spanning reads is $N = N_{\\text{inc}} + N_{\\text{exc}}$. The number of inclusion reads, $N_{\\text{inc}}$, can be modeled as a random variable following a binomial distribution with $N$ trials and success probability $\\Psi$. The probability mass function is:\n$$\nP(N_{\\text{inc}} | N, \\Psi) = \\binom{N}{N_{\\text{inc}}} \\Psi^{N_{\\text{inc}}} (1-\\Psi)^{N-N_{\\text{inc}}}\n$$\nGiven the observed data ($N_{\\text{inc}}$ and $N_{\\text{exc}}$), the likelihood function $L(\\Psi)$ is the probability of observing this data, viewed as a function of the parameter $\\Psi$:\n$$\nL(\\Psi | N_{\\text{inc}}, N_{\\text{exc}}) = \\binom{N_{\\text{inc}}+N_{\\text{exc}}}{N_{\\text{inc}}} \\Psi^{N_{\\text{inc}}} (1-\\Psi)^{N_{\\text{exc}}}\n$$\nTo find the $\\text{MLE}$, it is computationally simpler to maximize the log-likelihood function, $\\ell(\\Psi) = \\ln(L(\\Psi))$:\n$$\n\\ell(\\Psi) = \\ln\\left(\\binom{N_{\\text{inc}}+N_{\\text{exc}}}{N_{\\text{inc}}}\\right) + N_{\\text{inc}}\\ln(\\Psi) + N_{\\text{exc}}\\ln(1-\\Psi)\n$$\nWe find the maximum by taking the derivative with respect to $\\Psi$ and setting it to zero.\n$$\n\\frac{d\\ell}{d\\Psi} = \\frac{N_{\\text{inc}}}{\\Psi} - \\frac{N_{\\text{exc}}}{1-\\Psi}\n$$\nSetting the derivative to $0$:\n$$\n\\frac{N_{\\text{inc}}}{\\hat{\\Psi}} - \\frac{N_{\\text{exc}}}{1-\\hat{\\Psi}} = 0 \\implies \\frac{N_{\\text{inc}}}{\\hat{\\Psi}} = \\frac{N_{\\text{exc}}}{1-\\hat{\\Psi}}\n$$\n$$\nN_{\\text{inc}}(1-\\hat{\\Psi}) = N_{\\text{exc}}\\hat{\\Psi}\n$$\n$$\nN_{\\text{inc}} - N_{\\text{inc}}\\hat{\\Psi} = N_{\\text{exc}}\\hat{\\Psi}\n$$\n$$\nN_{\\text{inc}} = (N_{\\text{inc}} + N_{\\text{exc}})\\hat{\\Psi}\n$$\nSolving for $\\hat{\\Psi}$, the maximum likelihood estimator for $\\Psi$, we obtain:\n$$\n\\hat{\\Psi} = \\frac{N_{\\text{inc}}}{N_{\\text{inc}} + N_{\\text{exc}}}\n$$\n\nThird, we derive the sampling variance of the estimator $\\hat{\\Psi}$. The estimator $\\hat{\\Psi}$ is a function of the random variable $N_{\\text{inc}}$ and the total count $N = N_{\\text{inc}} + N_{\\text{exc}}$, which is treated as the fixed number of trials.\n$$\n\\hat{\\Psi} = \\frac{N_{\\text{inc}}}{N}\n$$\nThe variance of the estimator is:\n$$\n\\text{Var}(\\hat{\\Psi}) = \\text{Var}\\left(\\frac{N_{\\text{inc}}}{N}\\right) = \\frac{1}{N^2}\\text{Var}(N_{\\text{inc}})\n$$\nSince $N_{\\text{inc}}$ follows a binomial distribution $\\text{Bin}(N, \\Psi)$, its variance is $\\text{Var}(N_{\\text{inc}}) = N\\Psi(1-\\Psi)$. Substituting this into the equation for $\\text{Var}(\\hat{\\Psi})$:\n$$\n\\text{Var}(\\hat{\\Psi}) = \\frac{1}{N^2} \\left[N\\Psi(1-\\Psi)\\right] = \\frac{\\Psi(1-\\Psi)}{N}\n$$\nSubstituting $N = N_{\\text{inc}} + N_{\\text{exc}}$, the sampling variance of the estimator is:\n$$\n\\text{Var}(\\hat{\\Psi}) = \\frac{\\Psi(1-\\Psi)}{N_{\\text{inc}} + N_{\\text{exc}}}\n$$\nThis expression depends on the true, unknown parameter $\\Psi$. A consistent plug-in estimator for this variance, denoted $\\widehat{\\text{Var}}(\\hat{\\Psi})$, is obtained by replacing the unknown parameter $\\Psi$ with its consistent estimator $\\hat{\\Psi}$:\n$$\n\\widehat{\\text{Var}}(\\hat{\\Psi}) = \\frac{\\hat{\\Psi}(1-\\hat{\\Psi})}{N} = \\frac{\\hat{\\Psi}(1-\\hat{\\Psi})}{N_{\\text{inc}} + N_{\\text{exc}}}\n$$\nWe can express this solely in terms of the observed counts by substituting the expression for $\\hat{\\Psi}$:\n$$\n\\hat{\\Psi} = \\frac{N_{\\text{inc}}}{N_{\\text{inc}} + N_{\\text{exc}}} \\quad \\text{and} \\quad 1-\\hat{\\Psi} = \\frac{N_{\\text{exc}}}{N_{\\text{inc}} + N_{\\text{exc}}}\n$$\n$$\n\\widehat{\\text{Var}}(\\hat{\\Psi}) = \\frac{\\left(\\frac{N_{\\text{inc}}}{N_{\\text{inc}} + N_{\\text{exc}}}\\right)\\left(\\frac{N_{\\text{exc}}}{N_{\\text{inc}} + N_{\\text{exc}}}\\right)}{N_{\\text{inc}} + N_{\\text{exc}}} = \\frac{N_{\\text{inc}}N_{\\text{exc}}}{(N_{\\text{inc}} + N_{\\text{exc}})^3}\n$$\nThis is the required consistent plug-in estimator for the sampling variance.\n\nFourth, we compute the numerical value of this plug-in estimate using the observed counts $N_{\\text{inc}} = 87$ and $N_{\\text{exc}} = 213$.\nThe total number of reads is $N = N_{\\text{inc}} + N_{\\text{exc}} = 87 + 213 = 300$.\nThe estimated PSI is $\\hat{\\Psi} = \\frac{87}{300} = 0.29$.\nThe plug-in estimate of the variance is:\n$$\n\\widehat{\\text{Var}}(\\hat{\\Psi}) = \\frac{\\hat{\\Psi}(1-\\hat{\\Psi})}{N} = \\frac{(0.29)(1 - 0.29)}{300} = \\frac{(0.29)(0.71)}{300}\n$$\n$$\n\\widehat{\\text{Var}}(\\hat{\\Psi}) = \\frac{0.2059}{300} \\approx 0.000686333...\n$$\nAlternatively, using the other form of the estimator:\n$$\n\\widehat{\\text{Var}}(\\hat{\\Psi}) = \\frac{(87)(213)}{(87+213)^3} = \\frac{18531}{300^3} = \\frac{18531}{27000000} \\approx 0.000686333...\n$$\nThe problem requires the answer to be rounded to four significant figures and expressed in standard scientific notation.\nThe value is $0.000686333...$. The first four significant figures are $6$, $8$, $6$, and $3$. Rounding gives $0.0006863$.\nIn standard scientific notation $a \\times 10^b$ with $1 \\leq |a| < 10$, this is $6.863 \\times 10^{-4}$.",
            "answer": "$$\\boxed{6.863 \\times 10^{-4}}$$"
        },
        {
            "introduction": "Modern functional genomics relies on high-throughput screens to systematically probe gene function on a massive scale. This advanced practice guides you through the analysis of a pooled CRISPR screen, a revolutionary tool for linking genes to cellular phenotypes. You will implement a complete bioinformatics workflow, starting from raw gRNA read counts and proceeding through normalization, variance modeling, and fitting a generalized linear model (GLM) to robustly infer gene-level effects from the data. ",
            "id": "4342320",
            "problem": "You are provided with count data from Clustered Regularly Interspaced Short Palindromic Repeats (CRISPR) pooled screens, where each guide RNA (gRNA) targets a gene and has read counts measured at two time points. The goal is to compute library-size normalized log fold changes and then fit a Generalized Linear Model (GLM) to infer gene-level effects from multiple gRNAs targeting the same gene.\n\nFundamental base:\n- In pooled CRISPR screens, sequencing read counts for each gRNA at a given time point are well-approximated by a Poisson sampling process with mean proportional to the true abundance and the library size. If $c_i(t)$ denotes the observed count for gRNA $i$ at time $t$, and $L_t$ denotes the total library size at time $t$, then the normalized abundance for gRNA $i$ at time $t$ is $n_i(t) = \\dfrac{c_i(t) + s}{L_t}$, where $s > 0$ is a small pseudocount to stabilize ratios and avoid division by zero.\n- The log fold change for gRNA $i$ between time $t_0$ and time $t_1$ is defined as\n$$\n\\ell_i = \\log_2\\left(\\frac{n_i(t_1)}{n_i(t_0)}\\right) = \\log_2\\left(\\frac{c_i(t_1)+s}{c_i(t_0)+s}\\right) + \\log_2\\left(\\frac{L_{t_0}}{L_{t_1}}\\right).\n$$\n- Under the Poisson model and independence of $c_i(t_0)$ and $c_i(t_1)$, the delta method yields an approximate variance for the base-$2$ log fold change:\n$$\n\\operatorname{Var}(\\ell_i) \\approx \\frac{1}{(\\ln 2)^2} \\left(\\frac{1}{c_i(t_1)+s} + \\frac{1}{c_i(t_0)+s}\\right).\n$$\n- To infer gene-level effects, model the gRNA-level log fold changes with a Gaussian GLM (Normal distribution with identity link) and heteroscedastic errors, using weighted least squares:\n$$\n\\ell_i = \\alpha + \\sum_{g \\in \\mathcal{G}\\setminus\\{g_{\\text{base}}\\}} \\beta_g \\cdot \\mathbf{1}\\{g_i = g\\} + \\varepsilon_i,\n$$\nwhere $g_i$ is the gene targeted by gRNA $i$, $\\alpha$ is an intercept, $g_{\\text{base}}$ is a chosen baseline gene (for example, non-targeting control), $\\beta_g$ are gene-level effects relative to the baseline, and $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma_i^2)$ with $\\sigma_i^2 \\approx \\operatorname{Var}(\\ell_i)$. Weighted least squares yields\n$$\n\\hat{\\boldsymbol{\\theta}} = \\left(\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X}\\right)^{-1} \\mathbf{X}^\\top \\mathbf{W} \\mathbf{y},\n$$\nwhere $\\mathbf{y}$ is the vector of $\\ell_i$, $\\mathbf{X}$ is the design matrix with a column of ones (intercept) and one-hot indicators for each gene excluding the baseline, and $\\mathbf{W}$ is diagonal with entries $w_i = 1/\\sigma_i^2$.\n\nTask:\nWrite a Python program to:\n1. For each provided test case, compute the library-size normalized base-$2$ log fold changes $\\ell_i$ for all gRNAs using the formula above.\n2. Compute the weights $w_i = 1/\\operatorname{Var}(\\ell_i)$ using the variance approximation above.\n3. Construct the design matrix $\\mathbf{X}$ with an intercept and one-hot columns for each gene excluding the given baseline gene.\n4. Fit the weighted least squares model to estimate gene-level effects $\\beta_g$ relative to the baseline.\n5. For each test case, output the estimated gene effects in a list ordered lexicographically by gene label excluding the baseline gene. Round each estimated effect to six decimal places.\n\nAssumptions:\n- All counts $c_i(t)$ are nonnegative integers.\n- The pseudocount $s$ is strictly positive and provided.\n- The library sizes $L_{t_0}$ and $L_{t_1}$ are known positive constants for each test case.\n\nAngle units are not applicable. No physical units are used in the answer. All outputs must be floating-point numbers rounded to six decimal places.\n\nTest suite:\n- Case $1$ (general case, multiple guides per gene, balanced library sizes):\n    - Counts at $t_0$: $[1000, 1200, 900, 1100, 800, 850]$\n    - Counts at $t_1$: $[980, 1180, 600, 700, 1200, 1300]$\n    - Gene labels: $[\\text{NTC}, \\text{NTC}, \\text{G1}, \\text{G1}, \\text{G2}, \\text{G2}]$\n    - Baseline gene: $\\text{NTC}$\n    - Library sizes: $(L_{t_0}, L_{t_1}) = (1000000, 1000000)$\n    - Pseudocount: $s = 1$\n- Case $2$ (edge case with zero counts and unequal library sizes):\n    - Counts at $t_0$: $[500, 600, 400, 450]$\n    - Counts at $t_1$: $[520, 590, 0, 10]$\n    - Gene labels: $[\\text{NTC}, \\text{NTC}, \\text{G3}, \\text{G3}]$\n    - Baseline gene: $\\text{NTC}$\n    - Library sizes: $(L_{t_0}, L_{t_1}) = (1000000, 800000)$\n    - Pseudocount: $s = 1$\n- Case $3$ (boundary case with only one guide for a gene):\n    - Counts at $t_0$: $[2000, 2100, 1500]$\n    - Counts at $t_1$: $[1990, 2050, 1600]$\n    - Gene labels: $[\\text{NTC}, \\text{NTC}, \\text{G4}]$\n    - Baseline gene: $\\text{NTC}$\n    - Library sizes: $(L_{t_0}, L_{t_1}) = (2000000, 2000000)$\n    - Pseudocount: $s = 1$\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets, where each inner list corresponds to one test case and contains the estimated gene effects (excluding the baseline) ordered lexicographically by gene label and rounded to six decimals. For example, the printed output must look like\n$$\n[[x_1,x_2],[y_1],[z_1]]\n$$\nwhere $x_i$, $y_i$, and $z_i$ are floats with six decimal places.",
            "solution": "The problem requires the estimation of gene-level effects from CRISPR pooled screen count data using a Generalized Linear Model (GLM). The provided framework is a standard and statistically sound approach for analyzing such data. The solution proceeds by implementing the specified analysis workflow, which involves data normalization, variance estimation, and fitting a weighted least squares (WLS) model.\n\nThe core of the problem lies in solving the matrix equation for WLS estimation:\n$$\n\\hat{\\boldsymbol{\\theta}} = \\left(\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X}\\right)^{-1} \\mathbf{X}^\\top \\mathbf{W} \\mathbf{y}\n$$\nwhere $\\hat{\\boldsymbol{\\theta}}$ is the vector of estimated coefficients (intercept and gene effects), $\\mathbf{X}$ is the design matrix, $\\mathbf{W}$ is the diagonal weight matrix, and $\\mathbf{y}$ is the vector of observed log-fold changes.\n\nThe procedure for each test case is as follows:\n\n1.  **Computation of Log-Fold Changes (LFCs)**: The response vector, denoted as $\\mathbf{y}$, consists of the library-size normalized log-base-$2$ fold changes, $\\ell_i$, for each gRNA $i$. Given the raw counts at time $t_0$ and $t_1$, $c_i(t_0)$ and $c_i(t_1)$, the total library sizes $L_{t_0}$ and $L_{t_1}$, and a pseudocount $s > 0$, the LFC for gRNA $i$ is calculated as:\n    $$\n    \\ell_i = \\log_2\\left(\\frac{c_i(t_1)+s}{c_i(t_0)+s}\\right) + \\log_2\\left(\\frac{L_{t_0}}{L_{t_1}}\\right)\n    $$\n    This vector of $\\ell_i$ values forms the response vector $\\mathbf{y}$ in the WLS model.\n\n2.  **Computation of Weights**: The precision of each LFC measurement, $\\ell_i$, depends on the raw read counts. The delta method provides an approximate variance for $\\ell_i$:\n    $$\n    \\sigma_i^2 = \\operatorname{Var}(\\ell_i) \\approx \\frac{1}{(\\ln 2)^2} \\left(\\frac{1}{c_i(t_1)+s} + \\frac{1}{c_i(t_0)+s}\\right)\n    $$\n    In weighted least squares, each observation is weighted by the inverse of its variance to give more influence to more precise measurements. The weight $w_i$ for observation $i$ is thus $w_i = 1/\\sigma_i^2$. These weights form the diagonal elements of the weight matrix $\\mathbf{W}$, where all off-diagonal elements are zero.\n    $$\n    w_i = \\frac{(\\ln 2)^2}{\\frac{1}{c_i(t_1)+s} + \\frac{1}{c_i(t_0)+s}}\n    $$\n\n3.  **Construction of the Design Matrix**: The design matrix $\\mathbf{X}$ encodes the relationship between the gRNAs and the gene effects being estimated. The model is:\n    $$\n    \\ell_i = \\alpha + \\sum_{g \\in \\mathcal{G}\\setminus\\{g_{\\text{base}}\\}} \\beta_g \\cdot \\mathbf{1}\\{g_i = g\\} + \\varepsilon_i\n    $$\n    Here, $\\alpha$ is the intercept, which represents the effect of the baseline gene ($g_{\\text{base}}$), and $\\beta_g$ is the differential effect of gene $g$ relative to this baseline. To construct $\\mathbf{X}$, we first identify the unique set of non-baseline genes, which we order lexicographically. The first column of $\\mathbf{X}$ is a column of ones, corresponding to the intercept $\\alpha$. Subsequent columns are indicator variables (one-hot encoding) for each non-baseline gene. For a given gene $g$, its corresponding column will have a $1$ in row $i$ if gRNA $i$ targets gene $g$, and a $0$ otherwise. This formulation prevents perfect multicollinearity (the \"dummy variable trap\") and makes the model parameters identifiable.\n\n4.  **Solving the WLS System**: With $\\mathbf{y}$, $\\mathbf{W}$, and $\\mathbf{X}$ constructed, the coefficient vector $\\hat{\\boldsymbol{\\theta}} = [\\hat{\\alpha}, \\hat{\\beta}_{g_1}, \\hat{\\beta}_{g_2}, \\dots]^\\top$ is found by solving the \"normal equations\" for WLS. Instead of explicitly computing the matrix inverse $(\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X})^{-1}$, which can be numerically unstable, we solve the equivalent and more stable linear system:\n    $$\n    \\left(\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X}\\right) \\hat{\\boldsymbol{\\theta}} = \\mathbf{X}^\\top \\mathbf{W} \\mathbf{y}\n    $$\n    This is a standard linear algebra problem. The solution vector $\\hat{\\boldsymbol{\\theta}}$ contains the estimated intercept $\\hat{\\alpha}$ as its first element, followed by the estimated gene effects $\\hat{\\beta}_g$ in the same lexicographical order used to construct $\\mathbf{X}$.\n\n5.  **Output Generation**: The final step is to extract the gene effects $\\hat{\\beta}_g$ from the vector $\\hat{\\boldsymbol{\\theta}}$ (i.e., all elements except the first), round them to the specified six decimal places, and format them according to the output requirements for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"c0\": [1000, 1200, 900, 1100, 800, 850],\n            \"c1\": [980, 1180, 600, 700, 1200, 1300],\n            \"gene_labels\": [\"NTC\", \"NTC\", \"G1\", \"G1\", \"G2\", \"G2\"],\n            \"baseline_gene\": \"NTC\",\n            \"library_sizes\": (1000000, 1000000),\n            \"s\": 1\n        },\n        {\n            \"c0\": [500, 600, 400, 450],\n            \"c1\": [520, 590, 0, 10],\n            \"gene_labels\": [\"NTC\", \"NTC\", \"G3\", \"G3\"],\n            \"baseline_gene\": \"NTC\",\n            \"library_sizes\": (1000000, 800000),\n            \"s\": 1\n        },\n        {\n            \"c0\": [2000, 2100, 1500],\n            \"c1\": [1990, 2050, 1600],\n            \"gene_labels\": [\"NTC\", \"NTC\", \"G4\"],\n            \"baseline_gene\": \"NTC\",\n            \"library_sizes\": (2000000, 2000000),\n            \"s\": 1\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        betas = _estimate_gene_effects(**case)\n        all_results.append(betas)\n\n    # Format the final output string as specified.\n    case_strings = []\n    for result_list in all_results:\n        num_strings = [f\"{b:.6f}\" for b in result_list]\n        case_strings.append(f'[{\",\".join(num_strings)}]')\n    \n    final_output = f\"[{','.join(case_strings)}]\"\n    print(final_output)\n\ndef _estimate_gene_effects(c0, c1, gene_labels, baseline_gene, library_sizes, s):\n    \"\"\"\n    Performs CRISPR screen analysis for a single case.\n    Computes log-fold changes, weights, and fits a WLS model to get gene effects.\n    \"\"\"\n    # Ensure inputs are numpy arrays for vectorized operations\n    c0 = np.array(c0, dtype=float)\n    c1 = np.array(c1, dtype=float)\n    gene_labels = np.array(gene_labels)\n    L0, L1 = library_sizes\n\n    # 1. Compute log fold changes (the response vector y)\n    # l_i = log2((c1_i+s)/(c0_i+s)) + log2(L0/L1)\n    log2_lib_ratio = np.log2(L0 / L1)\n    y = np.log2(c1 + s) - np.log2(c0 + s) + log2_lib_ratio\n\n    # 2. Compute weights for WLS (the weight matrix W)\n    # Var(l_i) approx (1/ln(2)^2) * (1/(c1+s) + 1/(c0+s))\n    # w_i = 1 / Var(l_i)\n    ln2_squared = np.log(2)**2\n    # Add a small epsilon to denominator to prevent division by zero if c0+s or c1+s is somehow zero\n    var_lfc = (1 / ln2_squared) * (1 / (c1 + s + 1e-9) + 1 / (c0 + s + 1e-9))\n    weights = 1 / var_lfc\n    W = np.diag(weights)\n\n    # 3. Construct the design matrix X\n    # Get unique non-baseline genes, sorted lexicographically\n    unique_genes = np.unique(gene_labels)\n    target_genes = sorted([g for g in unique_genes if g != baseline_gene])\n\n    # First column is the intercept\n    intercept_col = np.ones(len(gene_labels))\n    X_cols = [intercept_col]\n\n    # Add a one-hot encoded column for each target gene\n    for gene in target_genes:\n        gene_col = (gene_labels == gene).astype(int)\n        X_cols.append(gene_col)\n\n    X = np.stack(X_cols, axis=1)\n\n    # 4. Solve the WLS system for coefficients theta\n    # (X.T @ W @ X) @ theta = X.T @ W @ y\n    # Use np.linalg.solve for numerical stability\n    XT_W = X.T @ W\n    XT_W_X = XT_W @ X\n    XT_W_y = XT_W @ y\n\n    theta = np.linalg.solve(XT_W_X, XT_W_y)\n\n    # 5. Extract gene effects (betas)\n    # The estimated coefficients in theta are [alpha, beta_g1, beta_g2, ...]\n    # The gene effects are all coefficients after the first (intercept).\n    betas = theta[1:]\n\n    return betas\n\nsolve()\n```"
        }
    ]
}