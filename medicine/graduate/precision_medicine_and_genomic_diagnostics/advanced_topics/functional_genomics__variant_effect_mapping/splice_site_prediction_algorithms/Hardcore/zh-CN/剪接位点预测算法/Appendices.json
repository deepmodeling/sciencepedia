{
    "hands_on_practices": [
        {
            "introduction": "这项实践聚焦于序列基序评分的基本原理。我们将从一个位置特异性概率模型出发，推导出一个对数似然比评分函数，并利用它来进行一次计算机模拟的定点突变实验。本练习将帮助您理解剪接位点预测算法如何量化基序内单个核苷酸的功能重要性。",
            "id": "4385861",
            "problem": "您的任务是设计并实现一个完整的模拟与分析流程，该流程基于分子遗传学和概率建模的第一性原理，旨在量化$5'$剪接供体基序对单核苷酸变化的位置特异性功能敏感性。计算目标是从一组给定的序列中，识别出基序中的特定位置。在这些位置上，单核苷酸变异 (SNV) 会在一个对数似然比分数上引起最大的预期扰动，而该分数是根据一个具有独立列和固定基因组背景的位置特异性多项式模型定义的。\n\n请从以下基础概念出发：分子生物学的中心法则（脱氧核糖核酸到核糖核酸到蛋白质）、外显子-内含子连接处周围存在保守的剪接位点基序，以及在具有独立位置和固定背景核苷酸分布的多项式模型下，基于对数似然比的广泛应用的序列基序评分范式。您可以使用这些概念来构建评分函数以及由单核苷酸替换引起的分数变化的完全指定定义。请勿假设任何其他专业化结果。\n\n您的程序必须实现以下内容，并遵循科学现实性和内部一致性：\n- 将$5'$供体基序建模为一个长度为$L$、各列独立的位置特异性多项式模型。使用$L=9$和字母表$\\{A,C,G,T\\}$。\n- 对于任何长度为$L$的序列$x$，定义一个对数似然比分数$S(x)$，该分数通过将位置特异性概率与固定背景进行比较，来累加所有位置的贡献。您必须根据上述模型假设推导出该分数，不得引入任何未经证明的简化公式。\n- 对于位置$i$上的一个单核苷酸变异，该变异将参考碱基$b$变为一个备选碱基$a \\neq b$，定义分数变化$\\Delta S = S(x^{(i \\rightarrow a)}) - S(x)$，其中$x^{(i \\rightarrow a)}$是位置$i$的碱基被$a$替换后的序列。请从第一性原理推导如何在此模型中计算$\\Delta S$。\n- 对于给定参考序列$x$中的每个位置$i \\in \\{0,1,\\ldots,L-1\\}$，枚举所有三种可能的备选核苷酸，以生成该位置的$\\Delta S$值。使用这些值来定义每个位置的敏感性度量$E_i$，即在三种备选碱基的均匀分布下，位置$i$的预期绝对分数变化，也就是该位置上三个$\\Delta S$绝对值的平均值。\n- 令$\\tau$为集合$\\{E_0,\\ldots,E_{L-1}\\}$的经验$q$-分位数，其中$q=0.75$。如果$E_i \\ge \\tau$，则位置$i$被标记为“高敏感性”。\n- 您的实现必须对所有对数似然比的计算使用自然对数，并且必须假设所有提供的概率均为严格正数，以确保数值的良定性。\n\n在所有计算中使用以下固定参数：\n- 长度$L=9$，位置索引为$0$到$8$。\n- 背景核苷酸分布$q$由$q(A)=0.3$, $q(C)=0.2$, $q(G)=0.2$, $q(T)=0.3$给出。\n- 对于每个位置$i \\in \\{0,\\ldots,8\\}$和碱基$b \\in \\{A,C,G,T\\}$的位置特异性基序概率$P_i(b)$：\n    - 位置 0：$P_0(A)=0.4$, $P_0(C)=0.4$, $P_0(G)=0.1$, $P_0(T)=0.1$。\n    - 位置 1：$P_1(A)=0.8$, $P_1(C)=0.0666666667$, $P_1(G)=0.0666666667$, $P_1(T)=0.0666666667$。\n    - 位置 2：$P_2(A)=0.0666666667$, $P_2(C)=0.0666666667$, $P_2(G)=0.8$, $P_2(T)=0.0666666667$。\n    - 位置 3：$P_3(A)=0.0166666667$, $P_3(C)=0.0166666667$, $P_3(G)=0.95$, $P_3(T)=0.0166666667$。\n    - 位置 4：$P_4(A)=0.0166666667$, $P_4(C)=0.0166666667$, $P_4(G)=0.0166666667$, $P_4(T)=0.95$。\n    - 位置 5：$P_5(A)=0.45$, $P_5(C)=0.05$, $P_5(G)=0.45$, $P_5(T)=0.05$。\n    - 位置 6：$P_6(A)=0.6$, $P_6(C)=0.1$, $P_6(G)=0.2$, $P_6(T)=0.1$。\n    - 位置 7：$P_7(A)=0.2$, $P_7(C)=0.1$, $P_7(G)=0.6$, $P_7(T)=0.1$。\n    - 位置 8：$P_8(A)=0.1$, $P_8(C)=0.1$, $P_8(G)=0.2$, $P_8(T)=0.6$。\n\n测试用例。您的程序必须使用上述$P_i(b)$和$q$计算以下每个参考序列（每个序列长度为9，由$\\{A,C,G,T\\}$构成）的高敏感性位置集合：\n- 情况 1：$x^{(1)} = \\text{\"CAGGTAAGT\"}$。\n- 情况 2：$x^{(2)} = \\text{\"CAGGTCAGT\"}$。\n- 情况 3：$x^{(3)} = \\text{\"TTAGGTCGT\"}$。\n\n对于每种情况，输出标记为高敏感性的、以0为起始索引的位置列表。\n\n最终输出格式。您的程序应生成单行输出，该输出包含一个用方括号括起来的逗号分隔列表，不含空格，其中每个元素本身是针对一个测试用例的整数位置列表，按测试用例的顺序排列。每个用例的列表，其元素应按严格递增顺序排列。例如，一个有效的形式是一个不含空格的列表的列表。输出必须按顺序将三种情况的结果汇总到一个方括号括起来的列表中。不涉及单位，也不使用角度。所有返回的值都是指定的整数。",
            "solution": "经评估，问题陈述是有效的。它以分子遗传学和概率建模的既定原则为科学基础，内部一致且良定，为获得唯一解提供了所有必要信息。\n\n任务是识别脱氧核糖核酸 (DNA) 序列中，相对于一个剪接位点评分模型，对单核苷酸变异 (SNV) 高度敏感的位置。该分析基于从一个位置特异性多项式模型推导出的对数似然比分数。\n\n我们首先从第一性原理出发，形式化地推导所需的数学量。\n\n**1. 对数似然比分数 $S(x)$**\n\n问题指定了一个基于基序模型 ($H_M$) 和背景模型 ($H_B$) 之间对数似然比的评分范式。设$x = x_0x_1...x_{L-1}$为一个长度为$L=9$的DNA序列，其字母表为$\\mathcal{A} = \\{A, C, G, T\\}$。\n\n在基序模型下，由于假设各列独立，观测到序列$x$的概率由位置特异性概率的乘积给出：\n$$P(x | H_M) = \\prod_{i=0}^{L-1} P_i(x_i)$$\n其中$P_i(b)$是在位置$i$观测到碱基$b \\in \\mathcal{A}$的给定概率。\n\n在背景模型下，观测到序列$x$的概率由固定的背景概率的乘积给出：\n$$P(x | H_B) = \\prod_{i=0}^{L-1} q(x_i)$$\n其中$q(b)$是碱基$b$的给定背景概率。\n\n似然比 ($LR$) 是这两个概率的比值：\n$$LR(x) = \\frac{P(x | H_M)}{P(x | H_B)} = \\frac{\\prod_{i=0}^{L-1} P_i(x_i)}{\\prod_{i=0}^{L-1} q(x_i)} = \\prod_{i=0}^{L-1} \\frac{P_i(x_i)}{q(x_i)}$$\n\n对数似然比分数$S(x)$被定义为似然比的自然对数。利用属性$\\ln(ab) = \\ln(a) + \\ln(b)$，乘积变为求和：\n$$S(x) = \\ln(LR(x)) = \\ln\\left(\\prod_{i=0}^{L-1} \\frac{P_i(x_i)}{q(x_i)}\\right) = \\sum_{i=0}^{L-1} \\ln\\left(\\frac{P_i(x_i)}{q(x_i)}\\right)$$\n这将总分分解为位置分数的总和，$S_i(b) = \\ln(P_i(b)/q(b))$，因此$S(x) = \\sum_{i=0}^{L-1} S_i(x_i)$。\n\n**2. 由单核苷酸变异 (SNV) 引起的分数变化 $\\Delta S$**\n\n考虑一个参考序列$x$和一个变异序列$x^{(i \\rightarrow a)}$，后者与$x$完全相同，除了在位置$i$处，原始碱基$b = x_i$被一个备选碱基$a \\neq b$替换。\n\n参考序列的分数为$S(x) = \\sum_{j=0}^{L-1} S_j(x_j)$。\n变异序列的分数为$S(x^{(i \\rightarrow a)}) = \\sum_{j=0}^{L-1} S_j(x^{(i \\rightarrow a)}_j)$。\n\n由于对于所有$j \\neq i$，$x_j = x^{(i \\rightarrow a)}_j$，所以除了位置$i$之外，求和中的所有项都是相同的。分数变化$\\Delta S$定义为变异分数与参考分数之差：\n$$\\Delta S = S(x^{(i \\rightarrow a)}) - S(x)$$\n$$\\Delta S = \\left(S_i(a) + \\sum_{j \\neq i} S_j(x_j)\\right) - \\left(S_i(b) + \\sum_{j \\neq i} S_j(x_j)\\right)$$\n求和项相互抵消，得到一个仅依赖于突变位置$i$分数的简单表达式：\n$$\\Delta S = S_i(a) - S_i(b) = \\ln\\left(\\frac{P_i(a)}{q(a)}\\right) - \\ln\\left(\\frac{P_i(b)}{q(b)}\\right)$$\n\n**3. 位置特异性敏感性度量 $E_i$**\n\n对于给定参考序列$x$中的每个位置$i \\in \\{0, 1, \\ldots, L-1\\}$，敏感性$E_i$被定义为在三种可能的备选碱基上呈均匀概率分布的假设下的预期绝对分数变化。设$b = x_i$为位置$i$的参考碱基。\n$$E_i = \\mathbb{E}[|\\Delta S|] = \\frac{1}{3} \\sum_{a \\in \\mathcal{A}, a \\neq b} |\\Delta S_{i, a}|$$\n其中$\\Delta S_{i, a}$是当位置$i$的碱基$b$变为碱基$a$时的分数变化。代入$\\Delta S$的表达式：\n$$E_i = \\frac{1}{3} \\sum_{a \\in \\mathcal{A}, a \\neq b} \\left| \\ln\\left(\\frac{P_i(a)}{q(a)}\\right) - \\ln\\left(\\frac{P_i(b)}{q(b)}\\right) \\right|$$\n该度量量化了在位置$i$的随机SNV对剪接位点分数造成的扰动的平均幅度。\n\n**4. 高敏感性位置的识别**\n\n为了识别哪些位置最敏感，我们首先为给定的参考序列计算敏感性分数集合$\\{E_0, E_1, \\ldots, E_{L-1}\\}$。然后将该集合的经验$q$-分位数（其中$q=0.75$）确定为阈值$\\tau$。对于一个包含$n=9$个值的集合，0.75-分位数对应于$E_i$值排序列表（使用0-基索引）中索引为$(n-1)q = (9-1)(0.75) = 6$的值。\n\n如果一个位置$i$的敏感性分数$E_i$达到或超过这个阈值，即$E_i \\ge \\tau$，则该位置被分类为“高敏感性”。\n\n**计算步骤**\n\n每个测试用例的总体算法如下：\n1.  对于给定的长度为$L=9$的参考序列$x$。\n2.  对于从0到8的每个位置$i$：\n    a. 识别参考碱基$b = x_i$。\n    b. 计算将$b$突变为三种备选碱基$a$中的每一种时的三个$\\Delta S$值。\n    c. 通过计算三个$\\Delta S$值绝对值的算术平均值来计算$E_i$。\n3.  收集九个敏感性分数$\\{E_0, E_1, \\ldots, E_8\\}$。\n4.  对这些分数进行排序以找到阈值$\\tau$，即排序后列表中的第7个值（索引为6）。\n5.  识别所有满足$E_i \\ge \\tau$的位置$i$。\n6.  返回这些位置的列表，按升序排序。\n\n此过程将使用指定的模型参数应用于提供的三个参考序列中的每一个。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the splice site sensitivity problem by implementing the derived model.\n    \"\"\"\n    # Define problem parameters\n    L = 9\n    ALPHABET = ['A', 'C', 'G', 'T']\n    BASE_TO_IDX = {base: i for i, base in enumerate(ALPHABET)}\n\n    # Background probabilities q(b)\n    q_dist = np.array([0.3, 0.2, 0.2, 0.3])\n\n    # Position-specific probabilities P_i(b)\n    p_matrix = np.array([\n        # A, C, G, T\n        [0.4, 0.4, 0.1, 0.1],                       # Pos 0\n        [0.8, 1/15, 1/15, 1/15],                     # Pos 1\n        [1/15, 1/15, 0.8, 1/15],                     # Pos 2\n        [1/60, 1/60, 0.95, 1/60],                    # Pos 3\n        [1/60, 1/60, 1/60, 0.95],                    # Pos 4\n        [0.45, 0.05, 0.45, 0.05],                    # Pos 5\n        [0.6, 0.1, 0.2, 0.1],                        # Pos 6\n        [0.2, 0.1, 0.6, 0.1],                        # Pos 7\n        [0.1, 0.1, 0.2, 0.6]                         # Pos 8\n    ])\n\n    test_cases = [\n        \"CAGGTAAGT\",\n        \"CAGGTCAGT\",\n        \"TTAGGTCGT\",\n    ]\n\n    # Pre-compute the log-likelihood ratio matrix S_i(b) = ln(P_i(b)/q(b))\n    # Using broadcasting for element-wise division.\n    log_ratio_matrix = np.log(p_matrix / q_dist)\n\n    def calculate_high_sensitivity_positions(ref_seq, l, alphabet, base_to_idx, log_ratios):\n        \"\"\"\n        Calculates high-sensitivity positions for a single reference sequence.\n        \"\"\"\n        e_scores = np.zeros(l)\n\n        for i in range(l):\n            ref_base = ref_seq[i]\n            ref_base_idx = base_to_idx[ref_base]\n            ref_score = log_ratios[i, ref_base_idx]\n            \n            abs_delta_s_sum = 0.0\n            num_alternates = 0\n\n            for alt_base in alphabet:\n                if alt_base != ref_base:\n                    alt_base_idx = base_to_idx[alt_base]\n                    alt_score = log_ratios[i, alt_base_idx]\n                    delta_s = alt_score - ref_score\n                    abs_delta_s_sum += abs(delta_s)\n                    num_alternates += 1\n            \n            e_scores[i] = abs_delta_s_sum / num_alternates\n\n        # Calculate the threshold tau (0.75-quantile)\n        tau = np.quantile(e_scores, 0.75, method='linear')\n        \n        # Find positions where E_i >= tau\n        # Use a small tolerance for floating point comparisons to be robust\n        high_sensitivity_indices = np.where(e_scores >= tau - 1e-9)[0]\n        \n        return sorted(list(high_sensitivity_indices))\n\n    # Process each test case\n    all_results = []\n    for seq in test_cases:\n        result = calculate_high_sensitivity_positions(seq, L, ALPHABET, BASE_TO_IDX, log_ratio_matrix)\n        all_results.append(result)\n\n    # Format the final output string as specified: [[pos1,pos2],[pos3],...]\n    result_strings = []\n    for res_list in all_results:\n        inner_str = \",\".join(map(str, res_list))\n        result_strings.append(f\"[{inner_str}]\")\n    \n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "当模型生成预测后，我们必须在现实场景中评估其性能。本练习将演示如何利用灵敏度、特异性以及真实剪接破坏性变异的患病率，来计算关键的临床效用指标——阳性预测值（$PPV$）和阴性预测值（$NPV$）。您将探索改变预测阈值如何影响这些数值，从而揭示在部署诊断工具时所面临的关键权衡。",
            "id": "4385835",
            "problem": "在一个用于罕见病的临床基因组诊断流程中，使用机器学习剪接位点预测器来分流位于外显子-内含子连接处 $\\pm 10$ 个核苷酸内的候选单核苷酸变异 (SNV)。该预测器输出一个经过校准的概率，表示某个变异会破坏剪接。该流程应用一个阈值 $\\tau$，如果一个变异的预测概率至少为 $\\tau$，则将其分类为“预测的剪接破坏型”。在针对功能性剪接分析的验证中，根据经验测量了两个阈值下的操作特性如下：在 $\\tau_{1} = 0.4$ 时，灵敏度为 $0.90$，特异性为 $0.85$；在 $\\tau_{2} = 0.7$ 时，灵敏度为 $0.75$，特异性为 $0.95$。设在该流程中评估的候选 SNV 中，真正破坏剪接的变异的患病率 $\\pi$ 为 $\\pi = 0.08$。假设这些操作特性可以推广到临床队列，并且患病率在不同阈值下保持稳定。\n\n仅使用条件概率的基本定义以及灵敏度和特异性的定义，推导出阳性预测值 (PPV) 和阴性预测值 (NPV) 关于灵敏度、特异性和患病率的表达式，并计算在阈值 $\\tau_{1}$ 和 $\\tau_{2}$ 下的 PPV 和 NPV。将有序四元组 $\\left(\\mathrm{PPV}_{\\tau_{1}}, \\mathrm{PPV}_{\\tau_{2}}, \\mathrm{NPV}_{\\tau_{1}}, \\mathrm{NPV}_{\\tau_{2}}\\right)$ 报告为四舍五入到四位有效数字的小数值。在最终报告的值中不要使用百分号。",
            "solution": "所述问题具有科学依据，提法得当且客观。唯一解所需的所有数据均已提供，该场景是诊断测试理论在生物信息学中的标准应用。给定值与灵敏度和特异性之间的典型权衡关系一致。因此，该问题是有效的。\n\n我们首先根据问题陈述定义相关事件和概率。\n设 $D$ 为单核苷酸变异 (SNV) 真正破坏剪接的事件。\n设 $D^c$ 为 SNV 不破坏剪接的事件。\n设 $T^+$ 为预测器将 SNV 分类为“预测的剪接破坏型”（阳性测试结果）的事件。\n设 $T^-$ 为预测器未将 SNV 分类为“预测的剪接破坏型”（阴性测试结果）的事件。\n\n根据问题陈述，我们已知：\n真正破坏剪接的变异的患病率，$\\pi = P(D) = 0.08$。\n因此，一个变异不破坏剪接的概率为 $P(D^c) = 1 - P(D) = 1 - 0.08 = 0.92$。\n\n预测器的操作特性在两个不同的阈值 $\\tau_1$ 和 $\\tau_2$ 下给出。\n灵敏度是真阳性率：$Sens = P(T^+ | D)$。\n特异性是真阴性率：$Spec = P(T^- | D^c)$。\n\n在阈值 $\\tau_1 = 0.4$ 时：\n灵敏度 $Sens_1 = P(T^+ | D)_{\\tau_1} = 0.90$。\n特异性 $Spec_1 = P(T^- | D^c)_{\\tau_1} = 0.85$。\n\n在阈值 $\\tau_2 = 0.7$ 时：\n灵敏度 $Sens_2 = P(T^+ | D)_{\\tau_2} = 0.75$。\n特异性 $Spec_2 = P(T^- | D^c)_{\\tau_2} = 0.95$。\n\n问题要求推导阳性预测值 (PPV) 和阴性预测值 (NPV) 的表达式，并计算它们在两个阈值下的值。\n\n首先，我们推导 PPV 的通用表达式。PPV 是指在一个变异被预测为破坏剪接的情况下，它确实破坏剪接的概率：\n$PPV = P(D | T^+)$。\n使用条件概率的定义（贝叶斯定理）：\n$$PPV = \\frac{P(T^+ | D) P(D)}{P(T^+)}$$\n分母 $P(T^+)$ 是阳性预测的总概率。它可以使用全概率定律找到：\n$P(T^+) = P(T^+ | D)P(D) + P(T^+ | D^c)P(D^c)$。\n我们将 $P(T^+ | D)$ 识别为灵敏度 ($Sens$)。项 $P(T^+ | D^c)$ 是假阳性率，等于 $1 - P(T^- | D^c) = 1 - Spec$。\n将这些代入 $P(T^+)$ 的表达式中：\n$P(T^+) = (Sens)(\\pi) + (1 - Spec)(1 - \\pi)$。\n将此代回 PPV 的表达式中，我们得到所需的公式：\n$$PPV = \\frac{(Sens)(\\pi)}{(Sens)(\\pi) + (1 - Spec)(1 - \\pi)}$$\n\n其次，我们推导 NPV 的通用表达式。NPV 是指在一个变异被预测为不破坏剪接的情况下，它确实不破坏剪接的概率：\n$NPV = P(D^c | T^-)$。\n再次使用贝叶斯定理：\n$$NPV = \\frac{P(T^- | D^c) P(D^c)}{P(T^-)}$$\n分母 $P(T^-)$ 是阴性预测的总概率。使用全概率定律：\n$P(T^-) = P(T^- | D)P(D) + P(T^- | D^c)P(D^c)$。\n我们将 $P(T^-|D^c)$ 识别为特异性 ($Spec$)。项 $P(T^- | D)$ 是假阴性率，等于 $1 - P(T^+ | D) = 1 - Sens$。\n将这些代入 $P(T^-)$ 的表达式中：\n$P(T^-) = (1 - Sens)(\\pi) + (Spec)(1 - \\pi)$。\n将此代回 NPV 的表达式中，我们得到所需的公式：\n$$NPV = \\frac{(Spec)(1 - \\pi)}{(Spec)(1 - \\pi) + (1 - Sens)(\\pi)}$$\n\n现在，我们计算每个阈值下的 PPV 和 NPV 的数值。\n\n在阈值 $\\tau_1 = 0.4$ 时：\n$Sens_1 = 0.90$, $Spec_1 = 0.85$, $\\pi = 0.08$。\n$$PPV_{\\tau_1} = \\frac{(0.90)(0.08)}{(0.90)(0.08) + (1 - 0.85)(1 - 0.08)} = \\frac{0.072}{0.072 + (0.15)(0.92)} = \\frac{0.072}{0.072 + 0.138} = \\frac{0.072}{0.21} \\approx 0.342857$$\n$$NPV_{\\tau_1} = \\frac{(0.85)(1 - 0.08)}{(0.85)(1 - 0.08) + (1 - 0.90)(0.08)} = \\frac{(0.85)(0.92)}{(0.85)(0.92) + (0.10)(0.08)} = \\frac{0.782}{0.782 + 0.008} = \\frac{0.782}{0.79} \\approx 0.989873$$\n\n在阈值 $\\tau_2 = 0.7$ 时：\n$Sens_2 = 0.75$, $Spec_2 = 0.95$, $\\pi = 0.08$。\n$$PPV_{\\tau_2} = \\frac{(0.75)(0.08)}{(0.75)(0.08) + (1 - 0.95)(1 - 0.08)} = \\frac{0.06}{0.06 + (0.05)(0.92)} = \\frac{0.06}{0.06 + 0.046} = \\frac{0.06}{0.106} \\approx 0.566037$$\n$$NPV_{\\tau_2} = \\frac{(0.95)(1 - 0.08)}{(0.95)(1 - 0.08) + (1 - 0.75)(0.08)} = \\frac{(0.95)(0.92)}{(0.95)(0.92) + (0.25)(0.08)} = \\frac{0.874}{0.874 + 0.02} = \\frac{0.874}{0.894} \\approx 0.977628$$\n\n问题要求有序四元组 $\\left(\\mathrm{PPV}_{\\tau_{1}}, \\mathrm{PPV}_{\\tau_{2}}, \\mathrm{NPV}_{\\tau_{1}}, \\mathrm{NPV}_{\\tau_{2}}\\right)$ 的值四舍五入到四位有效数字。\n$PPV_{\\tau_1} \\approx 0.3429$\n$PPV_{\\tau_2} \\approx 0.5660$\n$NPV_{\\tau_1} \\approx 0.9899$\n$NPV_{\\tau_2} \\approx 0.9776$\n\n最终的有序四元组是 $(0.3429, 0.5660, 0.9899, 0.9776)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.3429  0.5660  0.9899  0.9776\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "全基因组范围内的剪接位点扫描是一个典型的极端类别不平衡案例，其中真实的剪接位点非常罕见。本练习将深入探讨为何在这种情况下，标准的评估指标如受试者工作特征（$ROC$）曲线下面积可能会产生误导。通过推导和计算精确率，您将理解为何精确率-召回率（$PR$）曲线能为基因组学应用中的模型比较提供更具信息量的评估。",
            "id": "4385852",
            "problem": "在一个用于变异解读的全基因组临床分析流程中，一个剪接位点预测器对全基因组范围内的候选供体位点进行排序。假设在所有候选位点中，真实供体位点的普遍率为 $\\pi$，且 $\\pi = 10^{-4}$，这反映了极端的类别不平衡。两个模型 $M_1$ 和 $M_2$ 输出连续评分，通过设定阈值来判定阳性样本。在一个临床上考虑的操作阈值 $\\tau_1$ 下，$M_1$ 达到了 $\\mathrm{TPR} = 0.95$ 和 $\\mathrm{FPR} = 10^{-3}$。在另一个临床上考虑的阈值 $\\tau_2$ 下，$M_2$ 达到了 $\\mathrm{TPR} = 0.85$ 和 $\\mathrm{FPR} = 10^{-5}$。当在留出数据上进行评估时，两个模型都具有接近 $0.99$ 的相似的高受试者工作特征曲线下面积（$ROC$ 曲线下面积（$AUC$））。仅使用基本原理——即真阳性率（$\\mathrm{TPR}$）、假阳性率（$\\mathrm{FPR}$）、精确率（阳性预测值；$\\mathrm{PPV}$）、召回率（灵敏度）的定义，以及条件概率的贝叶斯定理——推导类别不平衡（即小的 $\\pi$）如何决定作为 $\\mathrm{TPR}$、$\\mathrm{FPR}$ 和 $\\pi$ 函数的精确率。然后，使用你的推导计算在 $(\\mathrm{TPR}=0.95,\\ \\mathrm{FPR}=10^{-3},\\ \\pi=10^{-4})$ 和 $(\\mathrm{TPR}=0.85,\\ \\mathrm{FPR}=10^{-5},\\ \\pi=10^{-4})$ 时的预期精确率。最后，根据你的推导和计算，找出所有关于为何在极端不平衡条件下，使用精确率-召回率曲线下面积（Precision–Recall ($PR$) $AUC$，记作 $PR\\text{-}AUC$）比 $ROC\\text{-}AUC$ 更适合比较剪接位点预测器的正确陈述。\n\n选择所有适用的选项。\n\nA. 当 $\\pi = 10^{-4}$ 时，在 $(\\mathrm{TPR}=0.95,\\ \\mathrm{FPR}=10^{-3})$ 时的预期精确率约为 $0.087$，而在 $(\\mathrm{TPR}=0.85,\\ \\mathrm{FPR}=10^{-5})$ 时约为 $0.895$；因此，在极端不平衡的情况下，降低 $\\mathrm{FPR}$ 对精确率有主导性影响。\n\nB. $ROC\\text{-}AUC$ 对 $\\pi$ 不变，并且即使一个模型在绝对数量上产生多得多的假阳性，也可能对两个模型给出相似的评价；$PR\\text{-}AUC$ 的随机基线等于 $\\pi$，因此当 $\\pi \\ll 1$ 时，能更好地将性能置于上下文中进行评估。\n\nC. 当 $\\pi$ 极小时，精确率可以很好地近似为 $\\mathrm{TPR}/\\mathrm{FPR}$，因此不依赖于 $\\pi$。\n\nD. 一个无信息分类器的基线 $PR\\text{-}AUC$ 等于 $1/2$，就像 $ROC\\text{-}AUC$ 一样，所以对于不平衡数据，$PR\\text{-}AUC$ 没有任何优势。\n\nE. 在全基因组剪接位点扫描中，临床上有用的阈值通常要求 $\\mathrm{FPR}$ 在 $[0, 10^{-5}]$ 范围内；如果一个模型将性能增益集中在这个超低 $\\mathrm{FPR}$ 区间，那么即使两个模型具有相似的 $ROC\\text{-}AUC$，它们的 $PR\\text{-}AUC$ 也可能显著不同，这使得 $PR\\text{-}AUC$ 在模型选择上更具区分度。",
            "solution": "问题陈述经评估有效。它在科学上基于机器学习模型评估和生物统计学的原理，特别是在基因组诊断的背景下。问题提法得当，为所需的推导和计算提供了所有必要的数据（$\\pi$、$\\mathrm{TPR}$、$\\mathrm{FPR}$）。所用语言客观而精确。因此，将推导出一个完整的解答。\n\n问题的核心是将精确率，即阳性预测值（$\\mathrm{PPV}$），与真阳性率（$\\mathrm{TPR}$）、假阳性率（$\\mathrm{FPR}$）以及类别普遍率（$\\pi$）联系起来。\n\n设 $D$ 为候选位点是真实供体位点的事件（阳性类别），设 $N$ 为其不是真实供体位点的事件（阴性类别）。设 $+$ 表示模型的阳性预测。我们已知以下定义和值：\n-   普遍率：$\\pi = P(D) = 10^{-4}$。因此，$P(N) = 1 - \\pi = 1 - 10^{-4} = 0.9999$。\n-   真阳性率（召回率，灵敏度）：$\\mathrm{TPR} = P(+|D)$。\n-   假阳性率：$\\mathrm{FPR} = P(+|N)$。\n-   精确率（阳性预测值）：$\\mathrm{PPV} = P(D|+)$。\n\n使用条件概率的贝叶斯定理，我们可以将精确率表示为：\n$$ \\mathrm{PPV} = P(D|+) = \\frac{P(+|D) P(D)}{P(+)} $$\n分母 $P(+)$ 是阳性预测的总概率，可以使用全概率公式求得：\n$$ P(+) = P(+|D)P(D) + P(+|N)P(N) $$\n代入标准术语和给定变量：\n$$ P(+) = (\\mathrm{TPR})(\\pi) + (\\mathrm{FPR})(1-\\pi) $$\n将此代回 $\\mathrm{PPV}$ 的表达式，我们推导出主导关系：\n$$ \\mathrm{PPV} = \\frac{(\\mathrm{TPR})(\\pi)}{(\\mathrm{TPR})(\\pi) + (\\mathrm{FPR})(1-\\pi)} $$\n这个公式展示了精确率如何由 $\\mathrm{TPR}$、$\\mathrm{FPR}$ 和普遍率 $\\pi$ 决定。\n\n接下来，我们计算两个模型在各自操作阈值下的预期精确率。\n\n对于模型 $M_1$，在阈值 $\\tau_1$ 下：\n$\\mathrm{TPR}_1 = 0.95$，$\\mathrm{FPR}_1 = 10^{-3}$，且 $\\pi = 10^{-4}$。\n$$ \\mathrm{PPV}_1 = \\frac{(0.95)(10^{-4})}{(0.95)(10^{-4}) + (10^{-3})(1 - 10^{-4})} $$\n$$ \\mathrm{PPV}_1 = \\frac{9.5 \\times 10^{-5}}{9.5 \\times 10^{-5} + (10^{-3})(0.9999)} $$\n$$ \\mathrm{PPV}_1 = \\frac{9.5 \\times 10^{-5}}{9.5 \\times 10^{-5} + 9.999 \\times 10^{-4}} = \\frac{9.5 \\times 10^{-5}}{0.95 \\times 10^{-4} + 9.999 \\times 10^{-4}} = \\frac{0.95}{0.95 + 9.999} = \\frac{0.95}{10.949} \\approx 0.08676... $$\n因此，$M_1$ 的精确率约为 $0.087$。\n\n对于模型 $M_2$，在阈值 $\\tau_2$ 下：\n$\\mathrm{TPR}_2 = 0.85$，$\\mathrm{FPR}_2 = 10^{-5}$，且 $\\pi = 10^{-4}$。\n$$ \\mathrm{PPV}_2 = \\frac{(0.85)(10^{-4})}{(0.85)(10^{-4}) + (10^{-5})(1 - 10^{-4})} $$\n$$ \\mathrm{PPV}_2 = \\frac{8.5 \\times 10^{-5}}{8.5 \\times 10^{-5} + (10^{-5})(0.9999)} $$\n$$ \\mathrm{PPV}_2 = \\frac{8.5 \\times 10^{-5}}{8.5 \\times 10^{-5} + 0.9999 \\times 10^{-5}} = \\frac{8.5}{8.5 + 0.9999} = \\frac{8.5}{9.4999} \\approx 0.8947... $$\n因此，$M_2$ 的精确率约为 $0.895$。\n\n现在，我们评估每个陈述。\n\nA. 当 $\\pi = 10^{-4}$ 时，在 $(\\mathrm{TPR}=0.95,\\ \\mathrm{FPR}=10^{-3})$ 时的预期精确率约为 $0.087$，而在 $(\\mathrm{TPR}=0.85,\\ \\mathrm{FPR}=10^{-5})$ 时约为 $0.895$；因此，在极端不平衡的情况下，降低 $\\mathrm{FPR}$ 对精确率有主导性影响。\n我们的计算证实了 $M_1$ 的精确率约为 $0.087$，$M_2$ 的精确率约为 $0.895$。与 $M_1$ 相比，$M_2$ 实现了远超其上的精确率（超过10倍）。尽管 $\\mathrm{TPR}$ 有适度下降（从 $0.95$ 降至 $0.85$），但这一显著提升得以实现，是因为其 $\\mathrm{FPR}$ 低了100倍（从 $10^{-3}$ 降至 $10^{-5}$）。这表明，在 $\\pi$ 非常小的极端不平衡情况下，精确率公式分母中的 $\\mathrm{FPR}$ 项 $(\\mathrm{FPR})(1-\\pi)$ 可能会主导 $(\\mathrm{TPR})(\\pi)$ 项。为实现高精确率，$\\mathrm{FPR}$ 必须降低到与 $\\mathrm{TPR} \\cdot \\pi$ 相当或更小的水平。因此，计算结果有力地支持了降低 $\\mathrm{FPR}$ 具有主导性影响的结论。\n结论：**正确**。\n\nB. $ROC\\text{-}AUC$ 对 $\\pi$ 不变，并且即使一个模型在绝对数量上产生多得多的假阳性，也可能对两个模型给出相似的评价；$PR\\text{-}AUC$ 的随机基线等于 $\\pi$，因此当 $\\pi \\ll 1$ 时，能更好地将性能置于上下文中进行评估。\n$ROC$ 曲线绘制的是 $\\mathrm{TPR} = P(+|D)$ 相对于 $\\mathrm{FPR} = P(+|N)$ 的图像。这两个量都不依赖于类别普遍率 $\\pi = P(D)$。因此，$ROC$ 曲线及其面积（$ROC\\text{-}AUC$）对类别不平衡不敏感。问题陈述中提到两个模型都有接近 $0.99$ 的高 $ROC\\text{-}AUC$，评价相似。假阳性与真阳性的绝对数量之比为 $\\frac{N_{FP}}{N_{TP}} = \\frac{P(+|N)P(N)}{P(+|D)P(D)} = \\frac{\\mathrm{FPR}}{\\mathrm{TPR}}\\frac{1-\\pi}{\\pi}$。给定 $\\pi=10^{-4}$，该比率约为 $\\approx \\frac{\\mathrm{FPR}}{\\mathrm{TPR}} \\times 10^4$。对于 $M_1$，这个值约为 $\\approx \\frac{10^{-3}}{0.95} \\times 10^4 \\approx 10.5$。对于 $M_2$，这个值约为 $\\approx \\frac{10^{-5}}{0.85} \\times 10^4 \\approx 0.12$。所以 $M_1$ 每个真阳性产生的假阳性要多得多。一个随机分类器的恒定预期精确率等于普遍率 $\\pi$。其对应的精确率-召回率曲线是一条在精确率 $=\\pi$ 处的水平线，因此基线 $PR\\text{-}AUC$ 为 $\\pi$。当 $\\pi=10^{-4}$ 时，基线极低。$PR\\text{-}AUC$ 相对于这个低基线来衡量性能，使其对精确率的差异更加敏感，而精确率正是不平衡问题中的关键挑战。该陈述的各部分均正确。\n结论：**正确**。\n\nC. 当 $\\pi$ 极小时，精确率可以很好地近似为 $\\mathrm{TPR}/\\mathrm{FPR}$，因此不依赖于 $\\pi$。\n推导出的公式是 $\\mathrm{PPV} = \\frac{(\\mathrm{TPR})(\\pi)}{(\\mathrm{TPR})(\\pi) + (\\mathrm{FPR})(1-\\pi)}$。当 $\\pi \\ll 1$ 时，这可以近似为 $\\mathrm{PPV} \\approx \\frac{\\mathrm{TPR} \\cdot \\pi}{\\mathrm{TPR} \\cdot \\pi + \\mathrm{FPR}}$。要将其进一步近似为 $\\mathrm{TPR}/\\mathrm{FPR}$，将需要 $\\pi \\cdot (\\mathrm{TPR} \\cdot \\pi + \\mathrm{FPR}) \\approx (\\mathrm{TPR})^2$，这是无稽之谈。一个更常见的近似，在假阳性远多于真阳性时有效（即 $\\mathrm{FPR} \\gg \\mathrm{TPR} \\cdot \\pi$，如 $M_1$ 的情况），是 $\\mathrm{PPV} \\approx \\frac{\\mathrm{TPR} \\cdot \\pi}{\\mathrm{FPR}} = \\pi \\left(\\frac{\\mathrm{TPR}}{\\mathrm{FPR}}\\right)$。这个近似明确表明精确率与 $\\pi$ 成正比。小的普遍率 $\\pi$ 直接抑制了精确率，这与精确率不依赖于 $\\pi$ 的说法相矛盾。使用我们计算的值，对于 $M_1$，$\\mathrm{TPR}/\\mathrm{FPR} = 950$ 而 $\\mathrm{PPV}_1 \\approx 0.087$。这两个值并不近似相等。该陈述根本上是错误的。\n结论：**错误**。\n\nD. 一个无信息分类器的基线 $PR\\text{-}AUC$ 等于 $1/2$，就像 $ROC\\text{-}AUC$ 一样，所以对于不平衡数据，$PR\\text{-}AUC$ 没有任何优势。\n对于一个无信息分类器（随机执行），其基线 $ROC\\text{-}AUC$ 确实是 $1/2$，对应于对角线 $\\mathrm{TPR}=\\mathrm{FPR}$ 下的面积。然而，如选项B的分析所确立的，精确率-召回率曲线的基线是阳性类别的普遍率 $\\pi$。一个无信息分类器在所有召回率水平上实现的平均精确率为 $\\pi$，产生的 $PR\\text{-}AUC}$ 为 $\\pi$。关于基线 $PR\\text{-}AUC$ 是 $1/2$ 的说法是错误的。其基线为 $\\pi$ 这一事实，恰恰是为什么 $PR\\text{-}AUC$ 对于不平衡数据具有优势的原因，因为它正确地将性能置于阳性类别先验概率低的背景下。\n结论：**错误**。\n\nE. 在全基因组剪接位点扫描中，临床上有用的阈值通常要求 $\\mathrm{FPR}$ 在 $[0, 10^{-5}]$ 范围内；如果一个模型将性能增益集中在这个超低 $\\mathrm{FPR}$ 区间，那么即使两个模型具有相似的 $ROC\\text{-}AUC$，它们的 $PR\\text{-}AUC$ 也可能显著不同，这使得 $PR\\text{-}AUC$ 在模型选择上更具区分度。\n这个前提是合理的：在具有数十亿个位点的全基因组扫描中，只有非常低的 $\\mathrm{FPR}$ 才能被容忍，以避免大量的假阳性。正如我们对 $M_1$ 和 $M_2$ 的计算所示，在超低 $\\mathrm{FPR}$ 区间的性能对精确率（$\\mathrm{PPV}$）有巨大影响。$PR$ 曲线直接绘制了 $\\mathrm{PPV}$ 相对于召回率（$\\mathrm{TPR}$）的图像。像 $M_2$ 这样一个在远小于 $M_1$ 的 $\\mathrm{FPR}$ 下实现有用 $\\mathrm{TPR}$ 的模型，将具有显著更高的 $PR$ 曲线。$ROC\\text{-}AUC$ 在 $\\mathrm{FPR}$ 的整个 $[0, 1]$ 范围内进行积分，高 $\\mathrm{FPR}$ 区域（例如 $\\mathrm{FPR} > 0.01$）的性能可能对面积有显著贡献，从而掩盖了在临床相关的低 $\\mathrm{FPR}$ 端的关键差异。由于 $PR$ 曲线对这个关键的低 $\\mathrm{FPR}$、高精确率区域的性能敏感，因此得到的 $PR\\text{-}AUC$ 在比较像 $M_1$ 和 $M_2$ 这样的模型时，将是一个更具区分度的指标，即使它们的 $ROC\\text{-}AUC$ 几乎相同。\n结论：**正确**。",
            "answer": "$$\\boxed{ABE}$$"
        }
    ]
}