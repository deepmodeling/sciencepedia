{
    "hands_on_practices": [
        {
            "introduction": "在微生物组研究中，一项核心任务是识别与临床结果（如对免疫疗法的反应）相关的特定微生物。然而，一个简单的关联可能具有误导性，因为它可能受到混杂因素（例如，近期抗生素的使用）的影响，这些因素同时影响微生物组和临床结果。本练习将指导您完成一个关键的生物统计学实践：使用逻辑回归模型计算调整后的比值比，从而在评估微生物与疾病关联时，科学地控制潜在的混杂变量。",
            "id": "4359570",
            "problem": "提供给你的是代表对免疫检查点抑制剂疗法的客观缓解以及基线时肠道微生物 Akkermansia muciniphila 的存在情况和近期抗生素暴露情况的二元队列数据。你的任务是使用一个包含截距项并对抗生素暴露进行校正的逻辑斯谛回归模型，计算 Akkermansia 存在与客观缓解之间的校正关联。最终目标是报告 Akkermansia 存在的校正比值比、其瓦尔德 $95\\%$ 置信区间界限以及双边瓦尔德 $p$-值，并针对每个定义的测试队列进行报告。\n\n从以下基本原则开始：\n- 分子生物学的中心法则定义了信息流，但并不直接决定临床反应；相反，我们使用基于经过充分检验的临床观察的统计模型：缓解者和非缓解者可以被建模为独立的伯努利结果。\n- 对于个体 $i$，令 $Y_i \\in \\{0,1\\}$ 表示客观缓解指标（如果缓解则 $Y_i=1$，否则 $Y_i=0$），$A_i \\in \\{0,1\\}$ 表示 Akkermansia 存在情况（如果存在则 $A_i=1$，否则 $A_i=0$），$B_i \\in \\{0,1\\}$ 表示抗生素暴露情况（如果暴露则 $B_i=1$，否则 $B_i=0$）。\n- 假设在给定协变量的情况下结果条件独立，并通过一个带有 logit 连接函数的广义线性模型 (GLM) 对缓解的条件概率进行建模：伯努利概率 $p_i$ 满足经典的 logit 连接，并通过最大似然进行推断。\n- 抗生素暴露被视为一个混杂因素。你必须通过将其与截距和 Akkermansia 存在指标一起作为协变量纳入模型来进行校正。\n\n需要实现的模型规格：\n- 逻辑斯谛回归模型为 $ \\mathrm{logit}(p_i) = \\beta_0 + \\beta_1 A_i + \\beta_2 B_i $，其中 $ \\mathrm{logit}(p) = \\log\\left(\\frac{p}{1-p}\\right) $。\n- Akkermansia 存在的校正比值比为 $ \\exp(\\beta_1) $。\n- 使用带有弱岭稳定化（对 $ \\beta_1 $ 和 $ \\beta_2 $ 进行惩罚，但不惩罚 $ \\beta_0 $）的最大似然估计，以确保在边缘情况下的数值稳定性。岭强度应为 $ \\lambda = 10^{-6} $。\n\n需要报告的推断结果：\n- 报告校正比值比 $ \\exp(\\beta_1) $。\n- 报告瓦尔德 $95\\%$ 置信区间界限，计算公式为 $ \\exp\\left(\\beta_1 \\pm 1.96 \\cdot \\mathrm{SE}(\\beta_1)\\right) $，其中 $ \\mathrm{SE}(\\beta_1) $ 是从观测到的费雪信息的逆矩阵导出的标准误（允许按规定进行弱岭稳定化）。\n- 报告用于检验 $ H_0: \\beta_1 = 0 $ 的双边瓦尔德 p 值，该值使用标准正态近似，根据检验统计量 $ z = \\beta_1 / \\mathrm{SE}(\\beta_1) $ 计算得出。\n\n数据格式与构建：\n- 对于每个测试用例，给你分组水平的计数，形式为元组 $(A,B, r, n)$，表示 Akkermansia 指标 $A \\in \\{0,1\\}$，抗生素指标 $B \\in \\{0,1\\}$，缓解者数量 $r$，以及非缓解者数量 $n$。根据这些数据，通过创建 $r$ 个 $Y=1$ 的实例和 $n$ 个 $Y=0$ 的实例来构建个体水平数据，每个实例都具有相应的 $A$ 和 $B$ 值。\n\n测试套件：\n- 案例 1（均衡关联，中度混杂）：\n  - $(A,B,r,n)$ 组：\n    - $(1,0,6,4)$\n    - $(1,1,2,3)$\n    - $(0,0,3,5)$\n    - $(0,1,2,5)$\n- 案例 2（近分离，强信号）：\n  - $(A,B,r,n)$ 组：\n    - $(1,0,7,1)$\n    - $(1,1,3,1)$\n    - $(0,0,1,7)$\n    - $(0,1,0,4)$\n- 案例 3（抗生素协变量恒为零）：\n  - $(A,B,r,n)$ 组：\n    - $(1,0,3,3)$\n    - $(0,0,1,5)$\n- 案例 4（高度混杂，相关协变量）：\n  - $(A,B,r,n)$ 组：\n    - $(1,0,7,5)$\n    - $(1,1,1,1)$\n    - $(0,0,2,4)$\n    - $(0,1,2,8)$\n\n你的程序必须：\n- 对指定的逻辑斯谛回归实现最大似然拟合，并对 $ \\beta_1 $ 和 $ \\beta_2 $（但不包括 $ \\beta_0 $）施加弱岭稳定化 $ \\lambda = 10^{-6} $。\n- 为测试套件中的每个案例计算并返回列表 $[\\exp(\\beta_1), \\mathrm{CI}_{\\mathrm{lower}}, \\mathrm{CI}_{\\mathrm{upper}}, p\\text{-value}]$，其中置信区间是瓦尔德 95% 区间，p 值是基于正态近似的双边 p 值。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个以方括号括起来的逗号分隔列表形式的结果，每个项目本身就是一个格式为 $[\\text{OR},\\text{CI}_{\\text{lower}},\\text{CI}_{\\text{upper}},\\text{p-value}]$ 的列表，其中每个浮点数四舍五入到 $6$ 位小数。例如，包含两个项目的行应如下所示：$[[1.234000,0.789000,1.932000,0.045000],[\\dots]]$。",
            "solution": "用户提供了一个定义明确的生物统计学问题，该问题具有科学依据且计算上是可行的。该问题被验证为合理、完整且适定。任务是计算微生物存在与临床结果之间关联的校正比值比、其置信区间以及 p 值，同时对一个混杂因素进行校正。\n\n该解决方案通过开发一个逻辑斯谛回归模型并使用惩罚最大似然方法对其进行拟合来实现。分析步骤详述如下。\n\n### 1. 模型设定\n\n二元临床反应 $Y_i \\in \\{0, 1\\}$ 与协变量之间的关系通过一个使用伯努利响应分布和 logit 连接函数的广义线性模型 (GLM) 进行建模。对于每个个体 $i$，反应概率 $p_i = P(Y_i=1)$ 与预测变量的线性组合相关联：\n$$ \\mathrm{logit}(p_i) = \\log\\left(\\frac{p_i}{1-p_i}\\right) = \\beta_0 + \\beta_1 A_i + \\beta_2 B_i $$\n此处，$A_i \\in \\{0,1\\}$ 是 *Akkermansia* 存在情况的指示变量，$B_i \\in \\{0,1\\}$ 是抗生素暴露的指示变量，而 $\\boldsymbol{\\beta} = (\\beta_0, \\beta_1, \\beta_2)^T$ 是回归系数向量。主要关注的系数是 $\\beta_1$，因为其指数 $\\exp(\\beta_1)$ 代表了在校正抗生素暴露后，*Akkermansia* 存在的比值比。\n\n### 2. 通过惩罚最大似然进行估计\n\n模型参数 $\\boldsymbol{\\beta}$ 通过最大化一个惩罚对数似然函数来估计。数据以分组格式提供，包含 $k$ 个独特的分层，每个分层由协变量 $(A_j, B_j)$ 的不同组合定义。对于每个分层 $j \\in \\{1,...,k\\}$，我们给出了缓解者数量 $r_j$ 和受试者总数 $N_j$。此分组数据的对数似然函数为：\n$$ \\ell(\\boldsymbol{\\beta}) = \\sum_{j=1}^{k} \\left[ r_j \\log(p_j) + (N_j - r_j) \\log(1-p_j) \\right] $$\n其中 $p_j = \\sigma(\\eta_j)$ 是为分层 $j$ 建模的缓解概率，$\\eta_j = \\beta_0 + \\beta_1 A_j + \\beta_2 B_j$ 是线性预测器，$\\sigma(z)=(1+e^{-z})^{-1}$ 是逻辑斯谛 sigmoid 函数。\n\n为了确保数值稳定性，特别是在数据分离（最大似然估计可能无法收敛到有限值）的情况下，应用了弱岭 (L2) 惩罚。问题规定对 $\\beta_1$ 和 $\\beta_2$ 施加强度为 $\\lambda = 10^{-6}$ 的惩罚。惩罚对数似然函数为：\n$$ \\ell_{\\text{pen}}(\\boldsymbol{\\beta}) = \\ell(\\boldsymbol{\\beta}) - \\frac{\\lambda}{2}(\\beta_1^2 + \\beta_2^2) $$\n这可以写成矩阵形式 $\\ell_{\\text{pen}}(\\boldsymbol{\\beta}) = \\ell(\\boldsymbol{\\beta}) - \\frac{1}{2}\\boldsymbol{\\beta}^T P \\boldsymbol{\\beta}$，其中 $P$ 是一个对角惩罚矩阵，对角线元素为 $(0, \\lambda, \\lambda)$。\n\n### 3. 数值优化：牛顿-拉弗森方法\n\n使 $\\ell_{\\text{pen}}(\\boldsymbol{\\beta})$ 最大化的向量 $\\hat{\\boldsymbol{\\beta}}$ 是使用牛顿-拉弗森迭代算法找到的。该方法需要惩罚对数似然的梯度（得分向量）和海森矩阵。\n\n$\\ell_{\\text{pen}}(\\boldsymbol{\\beta})$ 的梯度是：\n$$ \\nabla \\ell_{\\text{pen}}(\\boldsymbol{\\beta}) = \\frac{\\partial \\ell_{\\text{pen}}}{\\partial \\boldsymbol{\\beta}} = X^T(R - N \\odot P_{\\text{vec}}) - P\\boldsymbol{\\beta} $$\n其中 $X$ 是独特分层的 $k \\times 3$ 设计矩阵，$R$ 是缓解者计数 ($r_j$) 的 $k \\times 1$ 向量，$N$ 是总计数 ($N_j$) 的 $k \\times 1$ 向量，$P_{\\text{vec}}$ 是概率 ($p_j$) 的 $k \\times 1$ 向量，$\\odot$ 表示逐元素乘法。\n\n$\\ell_{\\text{pen}}(\\boldsymbol{\\beta})$ 的海森矩阵是：\n$$ H_{\\text{pen}}(\\boldsymbol{\\beta}) = \\frac{\\partial^2 \\ell_{\\text{pen}}}{\\partial \\boldsymbol{\\beta} \\partial \\boldsymbol{\\beta}^T} = -X^T W X - P $$\n其中 $W$ 是一个 $k \\times k$ 的对角矩阵，其权重为 $W_{jj} = N_j p_j (1-p_j)$。\n\n在每次迭代 $t$ 时的牛顿-拉弗森更新是：\n$$ \\boldsymbol{\\beta}_{t+1} = \\boldsymbol{\\beta}_t - [H_{\\text{pen}}(\\boldsymbol{\\beta}_t)]^{-1} \\nabla \\ell_{\\text{pen}}(\\boldsymbol{\\beta}_t) $$\n这等同于一个迭代重加权最小二乘法 (IRLS) 更新。迭代过程从一个初始猜测（通常为 $\\boldsymbol{\\beta}_0 = \\mathbf{0}$）开始，并持续进行，直到连续迭代之间 $\\boldsymbol{\\beta}$ 的变化量低于预定义的容差。\n\n### 4. 统计推断\n\n当算法收敛到最终估计值 $\\hat{\\boldsymbol{\\beta}}$ 后，我们对 $\\beta_1$ 进行统计推断。估计量的渐近协方差矩阵由惩罚观测费雪信息矩阵的逆矩阵给出，该矩阵是在最终估计值处计算的海森矩阵的负数：\n$$ \\widehat{\\mathrm{Cov}}(\\hat{\\boldsymbol{\\beta}}) = [-H_{\\text{pen}}(\\hat{\\boldsymbol{\\beta}})]^{-1} = (X^T W X + P)^{-1} $$\n其中 $W$ 使用最终 $\\hat{\\boldsymbol{\\beta}}$ 的概率计算。\n\n$\\hat{\\beta}_1$ 的标准误是该协方差矩阵第二个对角元素的平方根：\n$$ \\mathrm{SE}(\\hat{\\beta}_1) = \\sqrt{[\\widehat{\\mathrm{Cov}}(\\hat{\\boldsymbol{\\beta}})]_{1,1}} $$\n\n从 $\\hat{\\beta}_1$ 及其标准误，我们计算所需的量：\n1.  **校正比值比 (OR):** $\\mathrm{OR} = \\exp(\\hat{\\beta}_1)$\n2.  **OR 的 95% 瓦尔德置信区间 (CI):** $\\exp(\\hat{\\beta}_1 \\pm 1.96 \\cdot \\mathrm{SE}(\\hat{\\beta}_1))$\n3.  **双边瓦尔德 p 值:** 这检验了原假设 $H_0: \\beta_1 = 0$。检验统计量 $z = \\hat{\\beta}_1 / \\mathrm{SE}(\\hat{\\beta}_1)$ 与标准正态分布 $Z \\sim N(0,1)$ 进行比较。p 值计算为 $2 \\cdot P(Z \\ge |z|)$。\n\n将此完整过程应用于问题陈述中提供的每个测试案例，以生成最终结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import expit\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    It defines the test cases, iterates through them, computes the required statistics,\n    and prints the formatted results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (balanced association, moderate confounding)\n        [\n            (1, 0, 6, 4),\n            (1, 1, 2, 3),\n            (0, 0, 3, 5),\n            (0, 1, 2, 5)\n        ],\n        # Case 2 (near separation, strong signal)\n        [\n            (1, 0, 7, 1),\n            (1, 1, 3, 1),\n            (0, 0, 1, 7),\n            (0, 1, 0, 4)\n        ],\n        # Case 3 (antibiotic covariate constant zero)\n        [\n            (1, 0, 3, 3),\n            (0, 0, 1, 5)\n        ],\n        # Case 4 (high confounding, correlated covariates)\n        [\n            (1, 0, 7, 5),\n            (1, 1, 1, 1),\n            (0, 0, 2, 4),\n            (0, 1, 2, 8)\n        ]\n    ]\n\n    results = []\n    for case_data in test_cases:\n        analysis_result = analyze_cohort(grouped_data=case_data, lambda_ridge=1e-6)\n        results.append(analysis_result)\n\n    # Format the final output string as specified\n    output_parts = []\n    for res_list in results:\n        formatted_nums = [f\"{num:.6f}\" for num in res_list]\n        output_parts.append(f\"[{','.join(formatted_nums)}]\")\n    \n    final_output = f\"[{','.join(output_parts)}]\"\n    print(final_output)\n\ndef analyze_cohort(grouped_data, lambda_ridge, tol=1e-9, max_iter=100):\n    \"\"\"\n    Fits a penalized logistic regression model to grouped cohort data.\n\n    Args:\n        grouped_data (list of tuples): Each tuple is (A, B, r, n) representing\n                                       Akkermansia status, antibiotic status,\n                                       number of responders, and number of non-responders.\n        lambda_ridge (float): The strength of the L2 penalty.\n        tol (float): The convergence tolerance for the optimization.\n        max_iter (int): The maximum number of iterations for the solver.\n\n    Returns:\n        list: A list containing [odds_ratio, ci_lower, ci_upper, p_value].\n    \"\"\"\n    # 1. Construct data matrices from grouped counts\n    X_list, R_list, N_list = [], [], []\n    for A, B, r, n in grouped_data:\n        X_list.append([1, A, B])  # Design matrix row: [intercept, Akk, Abx]\n        R_list.append(r)          # Responders count\n        N_list.append(r + n)      # Total count\n    \n    X_unique = np.array(X_list, dtype=float)\n    R_counts = np.array(R_list, dtype=float)\n    N_counts = np.array(N_list, dtype=float)\n\n    # 2. Initialize parameters for the Newton-Raphson algorithm\n    num_params = X_unique.shape[1]\n    beta = np.zeros(num_params)\n    \n    # 3. Define the penalty matrix (no penalty on the intercept)\n    P = np.diag([0] + [lambda_ridge] * (num_params - 1))\n\n    # 4. Run the Newton-Raphson (IRLS) optimization loop\n    for _ in range(max_iter):\n        # Calculate linear predictor and probabilities\n        eta = X_unique @ beta\n        p = expit(eta)\n        \n        # Calculate weights for the Hessian (and Fisher information)\n        # Add a small epsilon to prevent weights from being exactly zero\n        w = N_counts * p * (1 - p) + np.finfo(float).eps\n        W = np.diag(w)\n        \n        # Calculate the gradient (score vector) of the penalized log-likelihood\n        score = X_unique.T @ (R_counts - N_counts * p) - P @ beta\n        \n        # Calculate the penalized observed Fisher information matrix (-Hessian)\n        fisher_info = X_unique.T @ W @ X_unique + P\n        \n        # Solve for the update step and update beta\n        try:\n            delta_beta = np.linalg.solve(fisher_info, score)\n        except np.linalg.LinAlgError:\n            # Fallback to pseudo-inverse if matrix is singular (unlikely with ridge)\n            delta_beta = np.linalg.pinv(fisher_info) @ score\n        \n        beta += delta_beta\n        \n        # Check for convergence\n        if np.linalg.norm(delta_beta)  tol:\n            break\n            \n    # 5. Compute final statistics after convergence\n    # (Re)calculate final Fisher information matrix at the converged beta estimate\n    eta = X_unique @ beta\n    p = expit(eta)\n    w = N_counts * p * (1 - p) + np.finfo(float).eps\n    W = np.diag(w)\n    final_fisher_info = X_unique.T @ W @ X_unique + P\n    \n    # Covariance matrix is the inverse of the Fisher information matrix\n    try:\n        cov_beta = np.linalg.inv(final_fisher_info)\n    except np.linalg.LinAlgError:\n        cov_beta = np.linalg.pinv(final_fisher_info)\n    \n    # Extract results for beta_1 (Akkermansia effect)\n    beta_1 = beta[1]\n    se_beta_1 = np.sqrt(max(0, cov_beta[1, 1]))\n    \n    # Adjusted Odds Ratio\n    odds_ratio = np.exp(beta_1)\n    \n    # Wald 95% Confidence Interval for the Odds Ratio\n    z_critical = 1.96\n    ci_lower = np.exp(beta_1 - z_critical * se_beta_1)\n    ci_upper = np.exp(beta_1 + z_critical * se_beta_1)\n    \n    # Two-sided Wald p-value for H0: beta_1 = 0\n    wald_z = beta_1 / se_beta_1 if se_beta_1 > 0 else 0\n    p_value = 2 * norm.sf(np.abs(wald_z)) # sf is survival function (1 - cdf)\n    \n    return [odds_ratio, ci_lower, ci_upper, p_value]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "在确定了微生物与临床结果之间的关联之后，下一个科学问题自然是探究其背后的作用机制——这种关联是如何产生的？因果中介分析是一个强大的框架，用于分解基线特征（如某种微生物的存在）对结果的总体影响，区分其直接效应与通过治疗期间的中间变量（如某个免疫标志物）产生的间接效应。本练习将引导您严格遵循事件的时间顺序，从第一性原理出发，推导并计算这些因果效应，从而更深入地理解复杂的生物学通路。",
            "id": "4359687",
            "problem": "给定一个时间有序的因果系统，其动因是癌症免疫治疗反应的微生物组调节因子。考虑一个基线暴露 $E$（例如，基线微生物组特征）、一个基线混杂因素 $C$（例如，基因组或临床协变量）、一个治疗期间中介变量 $M$（例如，治疗初期的免疫读数）和一个治疗后结局 $Y$（例如，临床反应评分）。时间顺序是基线 $E$ 和 $C$，然后是治疗期间的 $M$，最后是治疗后的 $Y$。假设如下：\n\n- 结构方程（线性、可加，且在结局模型中包含暴露与中介变量的交互作用）：\n  - 中介变量：$M = \\alpha_{0} + \\alpha_{1} E + \\alpha_{2} C + \\varepsilon_{M}$，\n  - 结局：$Y = \\beta_{0} + \\beta_{1} E + \\beta_{2} M + \\beta_{3} (E \\cdot M) + \\beta_{4} C + \\varepsilon_{Y}$。\n- 误差项均值为零，与 $(E, C)$ 相互独立，且彼此独立，满足 $\\varepsilon_{M} \\sim \\mathcal{N}(0,\\sigma_{M}^{2})$ 和 $\\varepsilon_{Y} \\sim \\mathcal{N}(0,\\sigma_{Y}^{2})$。\n- 混杂因素的分布为 $C \\sim \\mathcal{N}(\\mu_{C}, \\sigma_{C}^{2})$。\n- 暴露 $E$ 是二元的，并且在时间上先于 $M$，而 $M$ 又先于 $Y$。\n- 在给定 $C$ 和时间顺序的情况下，序贯可忽略性成立，即在 $C$ 之外，暴露-中介、暴露-结局或中介-结局关系中没有未测量的混杂因素，这与从基线到治疗期间再到治疗后的因果序列一致。\n\n使用潜在结果框架，对于任何固定的 $c$，将在暴露 $e$ 下的潜在中介变量定义为 $M(e,c)$，将在暴露 $e$ 和中介变量 $m$ 下的潜在结果定义为 $Y(e,m,c)$。使用这些定义，定义以下尊重时间顺序的因果估计量：\n\n- 暴露固定为 $0$ 时的平均因果中介效应 (ACME)：$\\text{ACME}_{0} = \\mathbb{E} \\left[ Y(0, M(1)) - Y(0, M(0)) \\right]$。\n- 暴露固定为 $1$ 时的平均因果中介效应 (ACME)：$\\text{ACME}_{1} = \\mathbb{E} \\left[ Y(1, M(1)) - Y(1, M(0)) \\right]$。\n- 中介变量固定为其在 $E=0$ 下的值时的平均直接效应 (ADE)：$\\text{ADE}_{0} = \\mathbb{E} \\left[ Y(1, M(0)) - Y(0, M(0)) \\right]$。\n- 中介变量固定为其在 $E=1$ 下的值时的平均直接效应 (ADE)：$\\text{ADE}_{1} = \\mathbb{E} \\left[ Y(1, M(1)) - Y(0, M(1)) \\right]$。\n\n你的任务是，根据上述假设从基本原理出发，实现一个程序，为下面测试套件中的每种参数配置计算 $\\text{ACME}_{0}$、$\\text{ACME}_{1}$、$\\text{ADE}_{0}$ 和 $\\text{ADE}_{1}$。计算过程必须通过从指定的时间顺序和模型中逻辑推导这些平均值来进行，不得违反该顺序，也不得引入任何未从所述假设中推导出的结果的捷径。\n\n本问题不涉及物理单位或角度。所有输出必须是四舍五入到六位小数的实数。\n\n测试套件（每个测试用例提供 $(\\alpha_{0}, \\alpha_{1}, \\alpha_{2}, \\sigma_{M}; \\beta_{0}, \\beta_{1}, \\beta_{2}, \\beta_{3}, \\beta_{4}, \\sigma_{Y}; \\mu_{C}, \\sigma_{C})$）：\n\n- 案例 $1$（具有非零交互作用的一般情况）：$(\\alpha_{0}=0.2, \\alpha_{1}=0.8, \\alpha_{2}=0.5, \\sigma_{M}=0.6; \\beta_{0}=-0.1, \\beta_{1}=0.5, \\beta_{2}=1.2, \\beta_{3}=-0.4, \\beta_{4}=0.3, \\sigma_{Y}=1.0; \\mu_{C}=0.0, \\sigma_{C}=1.0)$。\n- 案例 $2$（中介变量对结局无影响的边界情况）：$(\\alpha_{0}=0.2, \\alpha_{1}=0.9, \\alpha_{2}=-0.4, \\sigma_{M}=0.5; \\beta_{0}=0.0, \\beta_{1}=1.0, \\beta_{2}=0.0, \\beta_{3}=0.0, \\beta_{4}=-0.2, \\sigma_{Y}=1.2; \\mu_{C}=1.5, \\sigma_{C}=0.7)$。\n- 案例 $3$（暴露对中介变量无影响的边界情况）：$(\\alpha_{0}=0.0, \\alpha_{1}=0.0, \\alpha_{2}=0.7, \\sigma_{M}=0.9; \\beta_{0}=0.1, \\beta_{1}=0.3, \\beta_{2}=1.1, \\beta_{3}=0.5, \\beta_{4}=0.0, \\sigma_{Y}=0.8; \\mu_{C}=-0.5, \\sigma_{C}=1.3)$。\n- 案例 $4$（交互作用主导且混杂因素均值有偏移的场景）：$(\\alpha_{0}=-0.3, \\alpha_{1}=0.4, \\alpha_{2}=1.2, \\sigma_{M}=0.4; \\beta_{0}=0.0, \\beta_{1}=-0.2, \\beta_{2}=0.6, \\beta_{3}=0.8, \\beta_{4}=0.1, \\sigma_{Y}=0.9; \\mu_{C}=2.0, \\sigma_{C}=0.5)$。\n\n最终输出格式：\n\n- 对于每个测试用例，输出一个包含四个值的列表 $[\\text{ACME}_{0}, \\text{ACME}_{1}, \\text{ADE}_{0}, \\text{ADE}_{1}]$，每个值都四舍五入到六位小数。\n- 你的程序应生成单行输出，其中包含一个由方括号括起来的列表，该列表由每个案例的结果列表以逗号分隔组成。例如，包含两个案例的输出将类似于 $[[a_{11},a_{12},a_{13},a_{14}],[a_{21},a_{22},a_{23},a_{24}]]$，其中每个 $a_{ij}$ 是一个四舍五入到六位的小数。",
            "solution": "用户的要求是审慎验证一个关于因果中介分析的问题陈述，并在其有效的情况下，提供一个合理的解决方案和最终的 Python 实现。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n\n问题提供了以下信息：\n- 一个具有时间顺序的因果系统：基线暴露 $E$ 和混杂因素 $C$，然后是治疗期间中介变量 $M$，最后是治疗后结局 $Y$。\n- 结构方程：\n  - 中介变量：$M = \\alpha_{0} + \\alpha_{1} E + \\alpha_{2} C + \\varepsilon_{M}$\n  - 结局：$Y = \\beta_{0} + \\beta_{1} E + \\beta_{2} M + \\beta_{3} (E \\cdot M) + \\beta_{4} C + \\varepsilon_{Y}$\n- 误差项分布：$\\varepsilon_{M} \\sim \\mathcal{N}(0,\\sigma_{M}^{2})$ 和 $\\varepsilon_{Y} \\sim \\mathcal{N}(0,\\sigma_{Y}^{2})$。它们均值为零，与 $(E, C)$ 相互独立且彼此独立。\n- 混杂因素分布：$C \\sim \\mathcal{N}(\\mu_{C}, \\sigma_{C}^{2})$。\n- 暴露变量：$E$ 是二元的。\n- 因果假设：在给定 $C$ 和时间顺序的情况下，序贯可忽略性成立。这意味着没有未测量的混杂因素。\n- 因果估计量的定义：\n  - 暴露为 $0$ 时的平均因果中介效应 (ACME)：$\\text{ACME}_{0} = \\mathbb{E} \\left[ Y(0, M(1)) - Y(0, M(0)) \\right]$\n  - 暴露为 $1$ 时的平均因果中介效应 (ACME)：$\\text{ACME}_{1} = \\mathbb{E} \\left[ Y(1, M(1)) - Y(1, M(0)) \\right]$\n  - 中介变量来自 $E=0$ 时的平均直接效应 (ADE)：$\\text{ADE}_{0} = \\mathbb{E} \\left[ Y(1, M(0)) - Y(0, M(0)) \\right]$\n  - 中介变量来自 $E=1$ 时的平均直接效应 (ADE)：$\\text{ADE}_{1} = \\mathbb{E} \\left[ Y(1, M(1)) - Y(0, M(1)) \\right]$\n- 测试用例：提供了四组参数 $(\\alpha_{0}, \\alpha_{1}, \\alpha_{2}, \\sigma_{M}; \\beta_{0}, \\beta_{1}, \\beta_{2}, \\beta_{3}, \\beta_{4}, \\sigma_{Y}; \\mu_{C}, \\sigma_{C})$。\n\n**第 2 步：使用提取的已知条件进行验证**\n\n- **科学上合理**：该问题基于成熟的因果中介分析框架，特别是使用线性结构方程模型。这是统计学、计量经济学和流行病学中的一种标准且严谨的方法，并经常应用于所述的生物医学背景中。其假设（例如，序贯可忽略性）和定义在该领域是标准的。\n- **定义明确**：该问题定义清晰。结构方程、分布以及估计量的定义都已提供，这使得对目标量可以得到唯一的解析解。所有测试用例的参数都已指定。\n- **客观性**：该问题以精确的数学和统计语言陈述，没有歧义或主观论断。\n\n该问题没有任何无效性缺陷。它在科学上是合理的，可形式化的，完整的，并且结构良好。\n\n**第 3 步：结论与行动**\n\n该问题是**有效的**。将推导并实现一个解决方案。\n\n### 因果估计量的推导\n\n目标是根据模型参数推导出 $\\text{ACME}_{0}$、$\\text{ACME}_{1}$、$\\text{ADE}_{0}$ 和 $\\text{ADE}_{1}$ 的表达式。推导过程依赖于潜在结果框架，其中潜在结果由结构方程在序贯可忽略性假设下确定。\n\n对于暴露水平 $E=e$，潜在中介变量 $M(e)$ 通过将 $e$ 代入中介变量方程得到：\n$$M(e) = \\alpha_{0} + \\alpha_{1} e + \\alpha_{2} C + \\varepsilon_{M}$$\n对于暴露水平 $E=e$ 和中介水平 $M=m$，潜在结果 $Y(e, m)$ 通过将 $e$ 和 $m$ 代入结局方程得到：\n$$Y(e, m) = \\beta_{0} + \\beta_{1} e + \\beta_{2} m + \\beta_{3} (e \\cdot m) + \\beta_{4} C + \\varepsilon_{Y}$$\n\n我们现在通过对随机变量 $C$、$\\varepsilon_M$ 和 $\\varepsilon_Y$ 的分布求期望来推导每个估计量。我们使用性质 $\\mathbb{E}[C] = \\mu_{C}$、$\\mathbb{E}[\\varepsilon_{M}] = 0$ 和 $\\mathbb{E}[\\varepsilon_{Y}] = 0$。\n\n**1. 暴露为 $0$ 时的平均因果中介效应 ($\\text{ACME}_0$)**\n\n根据定义，$\\text{ACME}_{0} = \\mathbb{E} \\left[ Y(0, M(1)) - Y(0, M(0)) \\right]$。\n首先，我们来表达期望内的各项。对于 $e=0$，对于一个一般的中介值 $m$，其结局方程为：\n$Y(0, m) = \\beta_{0} + \\beta_{1}(0) + \\beta_{2} m + \\beta_{3}(0 \\cdot m) + \\beta_{4} C + \\varepsilon_{Y} = \\beta_{0} + \\beta_{2} m + \\beta_{4} C + \\varepsilon_{Y}$。\n代入 $m=M(1)$ 和 $m=M(0)$：\n$$Y(0, M(1)) = \\beta_{0} + \\beta_{2} M(1) + \\beta_{4} C + \\varepsilon_{Y}$$\n$$Y(0, M(0)) = \\beta_{0} + \\beta_{2} M(0) + \\beta_{4} C + \\varepsilon_{Y}$$\n差值为：\n$$Y(0, M(1)) - Y(0, M(0)) = \\beta_{2} (M(1) - M(0))$$\n潜在中介变量之间的差值为：\n$$M(1) - M(0) = (\\alpha_{0} + \\alpha_{1}(1) + \\alpha_{2} C + \\varepsilon_{M}) - (\\alpha_{0} + \\alpha_{1}(0) + \\alpha_{2} C + \\varepsilon_{M}) = \\alpha_{1}$$\n这个差值是一个常数。因此：\n$$Y(0, M(1)) - Y(0, M(0)) = \\beta_{2} \\alpha_{1}$$\n对一个常数求期望得到该常数本身：\n$$\\text{ACME}_{0} = \\mathbb{E}[\\alpha_{1} \\beta_{2}] = \\alpha_{1} \\beta_{2}$$\n\n**2. 暴露为 $1$ 时的平均因果中介效应 ($\\text{ACME}_1$)**\n\n根据定义，$\\text{ACME}_{1} = \\mathbb{E} \\left[ Y(1, M(1)) - Y(1, M(0)) \\right]$。\n对于 $e=1$，对于一个一般的中介值 $m$，其结局方程为：\n$Y(1, m) = \\beta_{0} + \\beta_{1}(1) + \\beta_{2} m + \\beta_{3}(1 \\cdot m) + \\beta_{4} C + \\varepsilon_{Y} = \\beta_{0} + \\beta_{1} + (\\beta_{2} + \\beta_{3})m + \\beta_{4} C + \\varepsilon_{Y}$。\n代入 $m=M(1)$ 和 $m=M(0)$：\n$$Y(1, M(1)) = \\beta_{0} + \\beta_{1} + (\\beta_{2} + \\beta_{3})M(1) + \\beta_{4} C + \\varepsilon_{Y}$$\n$$Y(1, M(0)) = \\beta_{0} + \\beta_{1} + (\\beta_{2} + \\beta_{3})M(0) + \\beta_{4} C + \\varepsilon_{Y}$$\n差值为：\n$$Y(1, M(1)) - Y(1, M(0)) = (\\beta_{2} + \\beta_{3})(M(1) - M(0))$$\n由于 $M(1) - M(0) = \\alpha_{1}$，差值为常数 $(\\beta_{2} + \\beta_{3})\\alpha_{1}$。\n求期望：\n$$\\text{ACME}_{1} = \\mathbb{E}[\\alpha_{1} (\\beta_{2} + \\beta_{3})] = \\alpha_{1} (\\beta_{2} + \\beta_{3})$$\n\n**3. 中介变量来自 $E=0$ 时的平均直接效应 ($\\text{ADE}_0$)**\n\n根据定义，$\\text{ADE}_{0} = \\mathbb{E} \\left[ Y(1, M(0)) - Y(0, M(0)) \\right]$。\n我们有两个潜在结果的表达式：\n$$Y(1, M(0)) = \\beta_{0} + \\beta_{1} + (\\beta_{2} + \\beta_{3})M(0) + \\beta_{4} C + \\varepsilon_{Y}$$\n$$Y(0, M(0)) = \\beta_{0} + \\beta_{2} M(0) + \\beta_{4} C + \\varepsilon_{Y}$$\n差值为：\n$$Y(1, M(0)) - Y(0, M(0)) = \\beta_{1} + \\beta_{3} M(0)$$\n这个差值是一个随机变量，因为它依赖于 $M(0)$。我们必须对其求期望：\n$$\\text{ADE}_{0} = \\mathbb{E}[\\beta_{1} + \\beta_{3} M(0)] = \\beta_{1} + \\beta_{3} \\mathbb{E}[M(0)]$$\n我们计算潜在中介变量 $M(0)$ 的期望：\n$$\\mathbb{E}[M(0)] = \\mathbb{E}[\\alpha_{0} + \\alpha_{1}(0) + \\alpha_{2} C + \\varepsilon_{M}] = \\alpha_{0} + \\alpha_{2} \\mathbb{E}[C] + \\mathbb{E}[\\varepsilon_{M}] = \\alpha_{0} + \\alpha_{2} \\mu_{C}$$\n将此结果代回 $\\text{ADE}_{0}$ 的表达式中：\n$$\\text{ADE}_{0} = \\beta_{1} + \\beta_{3} (\\alpha_{0} + \\alpha_{2} \\mu_{C})$$\n\n**4. 中介变量来自 $E=1$ 时的平均直接效应 ($\\text{ADE}_1$)**\n\n根据定义，$\\text{ADE}_{1} = \\mathbb{E} \\left[ Y(1, M(1)) - Y(0, M(1)) \\right]$。\n潜在结果为：\n$$Y(1, M(1)) = \\beta_{0} + \\beta_{1} + (\\beta_{2} + \\beta_{3})M(1) + \\beta_{4} C + \\varepsilon_{Y}$$\n$$Y(0, M(1)) = \\beta_{0} + \\beta_{2} M(1) + \\beta_{4} C + \\varepsilon_{Y}$$\n差值为：\n$$Y(1, M(1)) - Y(0, M(1)) = \\beta_{1} + \\beta_{3} M(1)$$\n求期望：\n$$\\text{ADE}_{1} = \\mathbb{E}[\\beta_{1} + \\beta_{3} M(1)] = \\beta_{1} + \\beta_{3} \\mathbb{E}[M(1)]$$\n我们计算潜在中介变量 $M(1)$ 的期望：\n$$\\mathbb{E}[M(1)] = \\mathbb{E}[\\alpha_{0} + \\alpha_{1}(1) + \\alpha_{2} C + \\varepsilon_{M}] = \\alpha_{0} + \\alpha_{1} + \\alpha_{2} \\mathbb{E}[C] + \\mathbb{E}[\\varepsilon_{M}] = \\alpha_{0} + \\alpha_{1} + \\alpha_{2} \\mu_{C}$$\n将此结果代回 $\\text{ADE}_{1}$ 的表达式中：\n$$\\text{ADE}_{1} = \\beta_{1} + \\beta_{3} (\\alpha_{0} + \\alpha_{1} + \\alpha_{2} \\mu_{C})$$\n\n### 公式总结\n\n- $\\text{ACME}_{0} = \\alpha_{1} \\beta_{2}$\n- $\\text{ACME}_{1} = \\alpha_{1} (\\beta_{2} + \\beta_{3})$\n- $\\text{ADE}_{0} = \\beta_{1} + \\beta_{3} (\\alpha_{0} + \\alpha_{2} \\mu_{C})$\n- $\\text{ADE}_{1} = \\beta_{1} + \\beta_{3} (\\alpha_{0} + \\alpha_{1} + \\alpha_{2} \\mu_{C})$\n\n请注意，方差参数 $\\sigma_{M}^{2}$、$\\sigma_{Y}^{2}$ 和 $\\sigma_{C}^{2}$ 未出现在这些平均效应的最终表达式中。这是计算期望时的线性模型的一个特点。这些参数对于计算估计量的方差或置信区间是必需的。实现将把这些推导出的公式应用于所提供的测试用例。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes causal mediation effects for a linear system based on derived formulas.\n    \"\"\"\n    # Test suite: (alpha0, alpha1, alpha2, sigma_M; beta0, beta1, beta2, beta3, beta4, sigma_Y; mu_C, sigma_C)\n    test_cases = [\n        # Case 1 (general case with nonzero interaction)\n        (0.2, 0.8, 0.5, 0.6, -0.1, 0.5, 1.2, -0.4, 0.3, 1.0, 0.0, 1.0),\n        # Case 2 (boundary case with no mediator effect on outcome)\n        (0.2, 0.9, -0.4, 0.5, 0.0, 1.0, 0.0, 0.0, -0.2, 1.2, 1.5, 0.7),\n        # Case 3 (boundary case with no exposure effect on mediator)\n        (0.0, 0.0, 0.7, 0.9, 0.1, 0.3, 1.1, 0.5, 0.0, 0.8, -0.5, 1.3),\n        # Case 4 (interaction-dominant scenario with shifted confounder mean)\n        (-0.3, 0.4, 1.2, 0.4, 0.0, -0.2, 0.6, 0.8, 0.1, 0.9, 2.0, 0.5),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Unpack parameters, ignoring variance parameters which are not needed for point estimates.\n        alpha0, alpha1, alpha2, _, _, beta1, beta2, beta3, _, _, mu_C, _ = case\n\n        # Calculate ACME_0: Average Causal Mediation Effect under exposure 0\n        # Formula: alpha1 * beta2\n        acme0 = alpha1 * beta2\n\n        # Calculate ACME_1: Average Causal Mediation Effect under exposure 1\n        # Formula: alpha1 * (beta2 + beta3)\n        acme1 = alpha1 * (beta2 + beta3)\n\n        # Calculate ADE_0: Average Direct Effect under mediator from E=0\n        # Formula: beta1 + beta3 * (alpha0 + alpha2 * mu_C)\n        ade0 = beta1 + beta3 * (alpha0 + alpha2 * mu_C)\n\n        # Calculate ADE_1: Average Direct Effect under mediator from E=1\n        # Formula: beta1 + beta3 * (alpha0 + alpha1 + alpha2 * mu_C)\n        ade1 = beta1 + beta3 * (alpha0 + alpha1 + alpha2 * mu_C)\n\n        # Append the list of four results for the current case\n        all_results.append([acme0, acme1, ade0, ade1])\n\n    # Format the output string to match the required format: [[d.dddddd,...],[...]]\n    # Each number is formatted to six decimal places.\n    outer_list_str = []\n    for res_list in all_results:\n        inner_list_str = \"[\" + \",\".join([f\"{val:.6f}\" for val in res_list]) + \"]\"\n        outer_list_str.append(inner_list_str)\n    \n    final_output_str = \"[\" + \",\".join(outer_list_str) + \"]\"\n    \n    # Print the final formatted string.\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "从数据分析转向实验设计，是转化医学研究中的一个关键环节。在投入大量时间和资源进行临床前研究（例如，使用来自应答者或无应答者患者的粪菌移植 (FMT) 小鼠实验）之前，必须确保研究设计具有足够的统计功效（power）来检测预期的效应。本练习将带您完成一个典型的样本量计算过程，将统计功效、显著性水平和效应大小等核心概念与实际的研究场景联系起来，确保您的实验设计是稳健和高效的。",
            "id": "4359715",
            "problem": "研究人员正在研究响应者微生物群的定植是否能调节免疫检查点抑制剂 (Immune Checkpoint Inhibitor, ICI) 的抗肿瘤功效。接受免疫疗法的小鼠被随机分配，用来自人类响应者或非响应者的微生物群进行定植。对于每只索引为 $i$ 的小鼠，从第 $t=0$ 天到第 $t=T$ 天（$T=28$），定期测量其纵向肿瘤体积 $V_{i}(t)$。为了获得一个尊重小鼠内时间相关性并避免伪重复的单一小鼠水平的肿瘤控制测量指标，研究人员将通过按基线标准化的肿瘤体积曲线下面积来总结每条轨迹，$A_{i}=\\int_{0}^{T} \\frac{V_{i}(t)}{V_{i}(0)}\\,dt$。设 $R$ 组表示用响应者微生物群定植的小鼠，$N$ 组表示用非响应者微生物群定植的小鼠。假设每组中小鼠水平的汇总值 $A_{i}$ 是独立的，并且近似服从高斯分布，具有共同的标准差 $\\sigma$，并设 $\\mu_{R}$ 和 $\\mu_{N}$ 为相应的组均值。研究人员希望设计一个统计检验来检测肿瘤控制的差异（形式化为各组间 $A_{i}$ 均值的差异），并为研究提供足够的统计功效，以便在双侧显著性水平 $\\alpha=0.05$ 和目标功效 $1-\\beta=0.80$ 的条件下，使用相等的各组样本量，检测到标准化的效应大小 $d=0.8$。\n\n从假设检验和标准化效应大小的核心定义出发，推导在正态近似下，基于 $A_{i}$ 汇总值进行双样本均值比较所需的最小相等各组样本量 $n$。你可以假设标准化效应大小为 $d=\\frac{|\\mu_{R}-\\mu_{N}|}{\\sigma}$。对双侧检验使用标准正态分位数。对于任何所需的标准正态分位数数值近似，请在进行计算前将每个分位数四舍五入到四位有效数字。在计算出连续的 $n$ 值后，将最终所需的各组样本量向上取整到下一个完整的小鼠数量。\n\n提供最终答案，即达到指定的 $\\alpha$ 和功效所需的最小整数 $n$（每组的小鼠数量），不带单位。",
            "solution": "问题要求在给定的显著性水平 $\\alpha$、功效 $1-\\beta$ 和标准化效应大小 $d$ 的条件下，推导双样本均值检验所需的最小各组样本量 $n$。该分析将基于对汇总测量值 $A_i$ 的样本均值进行的正态近似。\n\n设 $\\mu_R$ 和 $\\mu_N$ 分别为响应者 ($R$) 组和非响应者 ($N$) 组的汇总统计量 $A_i = \\int_{0}^{T} \\frac{V_{i}(t)}{V_{i}(0)}\\,dt$ 的真实均值。共同的标准差为 $\\sigma$。我们要检验这些均值是否存在差异。\n\n双侧检验的原假设和备择假设是：\n$$ H_0: \\mu_R = \\mu_N \\quad \\text{或} \\quad \\mu_R - \\mu_N = 0 $$\n$$ H_A: \\mu_R \\neq \\mu_N \\quad \\text{或} \\quad \\mu_R - \\mu_N \\neq 0 $$\n\n设 $n_R = n_N = n$ 为每组的相等样本量。设 $\\bar{A}_R$ 和 $\\bar{A}_N$ 为样本均值。总体均值差异的估计量为 $\\bar{A}_R - \\bar{A}_N$。由于假设单个测量值 $A_i$ 是独立且服从正态分布的，因此均值差异 $\\bar{A}_R - \\bar{A}_N$ 的抽样分布也服从正态分布。\n\n该抽样分布的均值为 $E[\\bar{A}_R - \\bar{A}_N] = \\mu_R - \\mu_N$。\n方差为 $\\text{Var}(\\bar{A}_R - \\bar{A}_N) = \\text{Var}(\\bar{A}_R) + \\text{Var}(\\bar{A}_N) = \\frac{\\sigma^2}{n_R} + \\frac{\\sigma^2}{n_N} = \\frac{\\sigma^2}{n} + \\frac{\\sigma^2}{n} = \\frac{2\\sigma^2}{n}$。\n差异的标准误为 $SE = \\sqrt{\\frac{2\\sigma^2}{n}} = \\sigma\\sqrt{\\frac{2}{n}}$。\n\n在原假设 $H_0$ 下，均值差异为 $0$。检验统计量为：\n$$ Z = \\frac{(\\bar{A}_R - \\bar{A}_N) - 0}{SE} = \\frac{\\bar{A}_R - \\bar{A}_N}{\\sigma\\sqrt{\\frac{2}{n}}} $$\n在 $H_0$ 下，$Z$ 服从标准正态分布，$Z \\sim N(0, 1)$。\n\n对于显著性水平为 $\\alpha$ 的双侧检验，如果观测到的检验统计量 $|Z|$ 大于临界值 $z_{1-\\alpha/2}$，我们拒绝 $H_0$。值 $z_{q}$ 表示标准正态分布的第 $q$ 个分位数。\n给定 $\\alpha=0.05$，我们有 $\\alpha/2 = 0.025$，临界值为 $z_{1-0.025} = z_{0.975}$。根据题目要求，我们使用四舍五入到四位有效数字的近似值：\n$$ z_{0.975} \\approx 1.960 $$\n因此，拒绝域定义为 $|\\bar{A}_R - \\bar{A}_N| / (\\sigma\\sqrt{2/n})  1.960$。\n\n功效是在 $H_A$ 为真时正确拒绝 $H_0$ 的概率。设 $1-\\beta$ 为期望的功效。我们在一个特定的备择假设下评估功效，其中真实差异为 $|\\mu_R - \\mu_N| = \\delta$。标准化效应大小由 $d = \\frac{|\\mu_R - \\mu_N|}{\\sigma} = \\frac{\\delta}{\\sigma}$ 给出。\n根据题目，$d = 0.8$ 且 $1-\\beta = 0.80$，这意味着 $\\beta=0.20$。\n\n在这个备择假设下，统计量 $\\bar{A}_R - \\bar{A}_N$ 服从正态分布，其均值为 $\\delta$，标准误为 $\\sigma\\sqrt{2/n}$。\n功效是指在真实差异为 $\\delta$ 的情况下，我们的检验统计量落入拒绝域的概率。\n$$ 1 - \\beta = P\\left( |Z|  z_{1-\\alpha/2} \\mid |\\mu_R - \\mu_N| = \\delta \\right) $$\n不失一般性，假设 $\\mu_R - \\mu_N = \\delta  0$。功效主要由拒绝域的上尾贡献，因为检验统计量落入下尾的概率可以忽略不计。\n$$ 1 - \\beta \\approx P\\left( \\frac{\\bar{A}_R - \\bar{A}_N}{\\sigma\\sqrt{\\frac{2}{n}}}  z_{1-\\alpha/2} \\bigg| \\mu_R - \\mu_N = \\delta \\right) $$\n为了评估这个概率，我们在备择假设下对随机变量 $\\bar{A}_R - \\bar{A}_N$ 进行标准化，即减去其真实均值 $\\delta$ 并除以其标准误：\n$$ Z' = \\frac{(\\bar{A}_R - \\bar{A}_N) - \\delta}{\\sigma\\sqrt{\\frac{2}{n}}} \\sim N(0, 1) $$\n我们用 $Z'$ 来重写功效定义中的不等式：\n$$ \\bar{A}_R - \\bar{A}_N  z_{1-\\alpha/2} \\cdot \\sigma\\sqrt{\\frac{2}{n}} $$\n$$ (\\bar{A}_R - \\bar{A}_N) - \\delta  z_{1-\\alpha/2} \\cdot \\sigma\\sqrt{\\frac{2}{n}} - \\delta $$\n$$ \\frac{(\\bar{A}_R - \\bar{A}_N) - \\delta}{\\sigma\\sqrt{\\frac{2}{n}}}  z_{1-\\alpha/2} - \\frac{\\delta}{\\sigma\\sqrt{\\frac{2}{n}}} $$\n$$ Z'  z_{1-\\alpha/2} - \\frac{d}{\\sqrt{\\frac{2}{n}}} $$\n此事件的概率即为功效 $1-\\beta$。根据分位数的定义，$P(Z'  z_{\\beta}) = 1-\\beta$。根据正态分布的对称性，$z_{\\beta} = -z_{1-\\beta}$。因此，$P(Z'  -z_{1-\\beta}) = 1-\\beta$。\n这意味着：\n$$ -z_{1-\\beta} = z_{1-\\alpha/2} - \\frac{d}{\\sqrt{\\frac{2}{n}}} $$\n重新整理以求解 $n$，我们得到样本量的一般公式：\n$$ \\frac{d}{\\sqrt{\\frac{2}{n}}} = z_{1-\\alpha/2} + z_{1-\\beta} $$\n$$ \\sqrt{n} = \\frac{\\sqrt{2}(z_{1-\\alpha/2} + z_{1-\\beta})}{d} $$\n$$ n = \\frac{2(z_{1-\\alpha/2} + z_{1-\\beta})^2}{d^2} $$\n现在我们代入给定的值。功效为 $1-\\beta = 0.80$，所以我们需要分位数 $z_{1-\\beta} = z_{0.80}$。四舍五入到四位有效数字，该值为：\n$$ z_{0.80} \\approx 0.8416 $$\n我们有以下值：\n$d = 0.8$\n$z_{1-\\alpha/2} = z_{0.975} \\approx 1.960$\n$z_{1-\\beta} = z_{0.80} \\approx 0.8416$\n\n将这些值代入 $n$ 的公式：\n$$ n = \\frac{2(1.960 + 0.8416)^2}{(0.8)^2} $$\n$$ n = \\frac{2(2.8016)^2}{0.64} $$\n$$ n = \\frac{2 \\times 7.84896256}{0.64} $$\n$$ n = \\frac{15.69792512}{0.64} $$\n$$ n \\approx 24.528008 $$\n题目要求将最终所需的各组样本量向上取整到下一个完整的小鼠数量。样本量为 $24$ 会导致功效略低于目标功效，因此我们必须向上取整以确保满足功效要求。\n$$ n = 25 $$\n因此，每组最少需要 $25$ 只小鼠。",
            "answer": "$$\\boxed{25}$$"
        }
    ]
}