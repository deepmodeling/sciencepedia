{
    "hands_on_practices": [
        {
            "introduction": "在任何测序技术中，评估数据的可靠性都是至关重要的第一步。本练习将引导您探索长读长测序数据质量的核心度量——Phred质量分数（Q-score），并将其与每个碱基的错误概率直接关联起来。通过这个实践，您将学会如何将抽象的质量分数转化为对特定转录本上预期错误数量的具体计算，从而为解读和评估测序数据的准确性打下坚实的定量基础 。",
            "id": "4356052",
            "problem": "在一项使用牛津纳米孔技术（Oxford Nanopore Technologies, ONT）进行长读长天然核糖核酸（RNA）测序的精准肿瘤学分析中，一个实验室正在评估是否升级其碱基识别（basecalling）模型。对于一个长度为 $L=10000$ 个核苷酸的代表性全长信使RNA（mRNA）靶标，当前流程产生的平均单碱基质量分数（Q-score）为 $Q_{A}=10$。一个提议的模型升级预计将平均单碱基质量分数提高到 $Q_{B}=15$。假设单碱基错误在读长内的各个位置上是独立的，并且单碱基错误概率在整个读长上是均匀的。\n\n从连接质量分数与单碱基错误概率的标准定义以及序列中独立错误的基本概率模型出发，计算当从流程 A 转换到流程 B 时，每条读长中错配碱基数量的预期绝对减少量。将您的最终答案表示为每条读长的预期错配数，并四舍五入到四位有效数字。",
            "solution": "问题要求计算在升级测序流程后，每条读长中错配碱基数量的预期绝对减少量。为了解决这个问题，我们必须首先将给定的质量分数（$Q$-scores）与单碱基错误概率联系起来。\n\nPhred质量分数 $Q$ 是通过以下对数关系根据不正确碱基判读的概率 $P_e$ 定义的：\n$$\nQ = -10 \\log_{10}(P_e)\n$$\n这个方程可以重新整理，以求解作为Q分数 $Q$ 函数的单碱基错误概率 $P_e$：\n$$\n-\\frac{Q}{10} = \\log_{10}(P_e)\n$$\n$$\nP_e = 10^{-Q/10}\n$$\n我们有两个不同的流程，A（当前）和 B（提议），其平均单碱基Q分数分别为 $Q_A = 10$ 和 $Q_B = 15$。我们可以为每个流程计算单碱基错误概率。\n\n对于流程 A：\n$$\nP_{e,A} = 10^{-Q_A/10} = 10^{-10/10} = 10^{-1} = 0.1\n$$\n这意味着对于当前流程，在任何给定碱基上发生错误的概率是十分之一。\n\n对于流程 B：\n$$\nP_{e,B} = 10^{-Q_B/10} = 10^{-15/10} = 10^{-1.5}\n$$\n这是提议的升级后流程的单碱基错误概率。\n\n问题陈述了mRNA靶标的长度为 $L = 10000$ 个核苷酸，并且单碱基错误是独立且均匀分布的。一条读长中的错误数可以建模为伯努利试验的总和，每个核苷酸位置对应一次试验。在长度为 $L$ 的读长中，预期错配碱基数（错误数） $E$ 是长度与单碱基错误概率 $P_e$ 的乘积：\n$$\nE = L \\times P_e\n$$\n使用这个公式，我们可以计算两个流程的预期错误数。\n\n流程 A 的预期错误数：\n$$\nE_A = L \\times P_{e,A} = 10000 \\times 0.1 = 1000\n$$\n所以，平均而言，一条由流程 A 生成的长度为 $10000$ 个核苷酸的读长预计包含 $1000$ 个错误。\n\n流程 B 的预期错误数：\n$$\nE_B = L \\times P_{e,B} = 10000 \\times 10^{-1.5}\n$$\n我们可以简化这个表达式：\n$$\nE_B = 10^4 \\times 10^{-1.5} = 10^{4 - 1.5} = 10^{2.5} = 10^2 \\times 10^{0.5} = 100 \\sqrt{10}\n$$\n数值上，$\\sqrt{10} \\approx 3.16227766$。因此：\n$$\nE_B \\approx 100 \\times 3.16227766 = 316.227766\n$$\n\n问题要求计算每条读长中错配碱基数量的预期绝对减少量，即流程 A 和流程 B 的预期错误数之差。\n$$\n\\Delta E = E_A - E_B\n$$\n代入计算出的值：\n$$\n\\Delta E = 1000 - 100 \\sqrt{10}\n$$\n现在，我们计算数值：\n$$\n\\Delta E \\approx 1000 - 316.227766 = 683.772234\n$$\n问题要求将最终答案四舍五入到四位有效数字。前四位有效数字是 $6$、$8$、$3$ 和 $7$。第五位数字是 $7$，所以我们将第四位数字向上取整。\n$$\n\\Delta E \\approx 683.8\n$$\n因此，将碱基识别模型从流程 A 升级到流程 B，预计每条长度为 $10000$ 的读长中的错配碱基数将减少约 $683.8$ 个。",
            "answer": "$$\n\\boxed{683.8}\n$$"
        },
        {
            "introduction": "掌握了如何评估数据质量后，我们将探讨长读长测序的一个核心优势：解析复杂的转录本异构体。与短读长测序相比，长读长能够跨越多个外显子-外显子连接点，从而直接确定RNA分子的完整结构。本练习通过一个简化的数学模型，让您亲手计算并量化从短读长技术转换到长读长技术时，异构体鉴定模糊性的降低程度，从而深刻理解读长在转录组学研究中的决定性作用 。",
            "id": "4356011",
            "problem": "在用于精准医疗和基因组诊断的长读长天然核糖核酸（RNA）测序中，解析转录本异构体通常需要单个读长（read）跨越所有区分性的外显子-外显子连接。考虑一个简单的外显子-连接模型，其中在一个局部转录区域内，正好有$3$个区分性连接用于分隔不同的异构体。假设相邻区分性连接之间的距离是独立同分布的指数随机变量，其均值为 $\\mu = 300$ 碱基对（bp），这反映了连接密度沿转录本大致是平稳的。在此模型下，覆盖所有$3$个连接所需的总跨度$D$（即从三个连接中最$5'$端到最$3'$端的距离）是$2$个独立指数变量之和，因此服从形状参数为$2$、速率为 $\\lambda = 1/\\mu$ 的伽马分布。\n\n假设一个固定长度为$L$的读长相对于该区分性区域具有一个平移不变的均匀偏移量，因此，在$D=d \\leq L$的条件下，该读长跨越所有连接的概率等于能够完全包含宽度为$d$的区间的所有可能偏移量所占的比例，即 $(L-d)/L$，否则为$0$。令 $p_{\\mathrm{span}}(L)$ 表示此概率在$D$的分布上的期望。定义每个读长的异构体模糊度为 $A(L) = 1 - p_{\\mathrm{span}}(L)$。\n\n在上述假设下，并忽略转录本边界效应，计算当平均读长从 $L_{1} = 150$ bp（短读长模式）增加到 $L_{2} = 2000$ bp（长读长模式）时，异构体模糊度的期望减少量。将该减少量报告为单个实数\n$$\\Delta A \\equiv A(L_{1}) - A(L_{2}) = p_{\\mathrm{span}}(L_{2}) - p_{\\mathrm{span}}(L_{1}).$$\n使用 $\\mu = 300$ bp，并将 $L_{1}$ 和 $L_{2}$ 视为精确的固定长度。将你的最终答案四舍五入到四位有效数字，并表示为一个无量纲的小数。",
            "solution": "用户需要计算当读长从 $L_1 = 150$ bp 增加到 $L_2 = 2000$ bp 时，异构体模糊度的减少量 $\\Delta A$。\n\n首先，我们根据提供的信息将问题形式化。模糊度的减少量定义为：\n$$ \\Delta A = A(L_1) - A(L_2) $$\n其中 $A(L) = 1 - p_{\\mathrm{span}}(L)$ 是长度为$L$的读长的异构体模糊度。代入此定义，我们得到：\n$$ \\Delta A = (1 - p_{\\mathrm{span}}(L_1)) - (1 - p_{\\mathrm{span}}(L_2)) = p_{\\mathrm{span}}(L_2) - p_{\\mathrm{span}}(L_1) $$\n我们的主要任务是推导出 $p_{\\mathrm{span}}(L)$ 的表达式，即长度为$L$的读长跨越所有$3$个区分性连接的概率。\n\n覆盖所有$3$个连接所需的总跨度$D$是它们之间$2$个距离的总和。这些距离是独立同分布的指数随机变量，均值为 $\\mu = 300$ bp。$k$个速率为$\\lambda$的独立同分布指数随机变量之和服从形状参数为$k$、速率参数为$\\lambda$的伽马分布。这里，$k=2$ 且速率$\\lambda$是均值$\\mu$的倒数：\n$$ \\lambda = \\frac{1}{\\mu} = \\frac{1}{300} \\, \\text{bp}^{-1} $$\n对于 $d \\ge 0$，总跨度$D$的概率密度函数（PDF）由伽马分布的PDF给出：\n$$ f_D(d) = \\frac{\\lambda^k d^{k-1} \\exp(-\\lambda d)}{\\Gamma(k)} $$\n当 $k=2$ 且 $\\Gamma(2) = 1! = 1$ 时，PDF简化为：\n$$ f_D(d) = \\lambda^2 d \\exp(-\\lambda d) $$\n\n问题陈述，对于给定的跨度$D=d$，如果$d \\le L$，一个长度为$L$的读长完全包含该跨度的概率是 $(L-d)/L$；如果$d > L$，则概率为$0$。\n总的跨越概率 $p_{\\mathrm{span}}(L)$ 是此条件概率在$D$的分布上的期望：\n$$ p_{\\mathrm{span}}(L) = \\mathbb{E}[P(\\text{span} | D)] = \\int_{0}^{\\infty} P(\\text{span} | D=d) f_D(d) \\, \\mathrm{d}d $$\n考虑到条件概率，积分的上限是$L$：\n$$ p_{\\mathrm{span}}(L) = \\int_{0}^{L} \\frac{L-d}{L} f_D(d) \\, \\mathrm{d}d $$\n代入PDF $f_D(d)$：\n$$ p_{\\mathrm{span}}(L) = \\int_{0}^{L} \\left(1 - \\frac{d}{L}\\right) (\\lambda^2 d \\exp(-\\lambda d)) \\, \\mathrm{d}d $$\n我们可以将其分为两部分：\n$$ p_{\\mathrm{span}}(L) = \\lambda^2 \\int_{0}^{L} d \\exp(-\\lambda d) \\, \\mathrm{d}d - \\frac{\\lambda^2}{L} \\int_{0}^{L} d^2 \\exp(-\\lambda d) \\, \\mathrm{d}d $$\n这些积分可以用分部积分法求解。一个更直接的方法是将它们与伽马分布的累积分布函数（CDF）和部分期望联系起来。\n让我们定义 $p_{\\mathrm{span}}(L) = \\int_0^L f_D(d) \\, \\mathrm{d}d - \\frac{1}{L}\\int_0^L d f_D(d) \\, \\mathrm{d}d$。\n第一项是 Gamma($k=2, \\lambda$) 分布的累积分布函数（CDF），$F_D(L) = P(D \\le L)$。对于整数$k$，CDF为 $F_D(L; k, \\lambda) = 1 - \\exp(-\\lambda L) \\sum_{j=0}^{k-1} \\frac{(\\lambda L)^j}{j!}$。\n对于 $k=2$：\n$$ F_D(L) = 1 - \\exp(-\\lambda L) \\left( \\frac{(\\lambda L)^0}{0!} + \\frac{(\\lambda L)^1}{1!} \\right) = 1 - \\exp(-\\lambda L)(1 + \\lambda L) $$\n第二项涉及积分 $\\int_0^L d^2 \\exp(-\\lambda d) \\, \\mathrm{d}d$。使用分部积分法 $\\int u \\, \\mathrm{d}v = uv - \\int v \\, \\mathrm{d}u$：\n令 $u = d^n$ 且 $\\mathrm{d}v = \\exp(-\\lambda d)\\mathrm{d}d$。一般的不定积分是：\n$$ \\int d^n \\exp(-\\lambda d) \\, \\mathrm{d}d = -\\frac{\\exp(-\\lambda d)}{\\lambda^{n+1}} \\sum_{i=0}^{n} \\frac{n!}{(n-i)!} (\\lambda d)^{n-i} $$\n对于 $n=1$：$\\int d \\exp(-\\lambda d) \\, \\mathrm{d}d = -\\frac{\\exp(-\\lambda d)}{\\lambda^2}(\\lambda d + 1)$。\n对于 $n=2$：$\\int d^2 \\exp(-\\lambda d) \\, \\mathrm{d}d = -\\frac{\\exp(-\\lambda d)}{\\lambda^3}(\\lambda^2 d^2 + 2\\lambda d + 2)$。\n\n计算从$0$到$L$的定积分：\n$$ \\int_{0}^{L} d \\exp(-\\lambda d) \\, \\mathrm{d}d = \\left[ -\\frac{\\exp(-\\lambda d)}{\\lambda^2}(\\lambda d + 1) \\right]_{0}^{L} = \\frac{1}{\\lambda^2} - \\frac{\\exp(-\\lambda L)}{\\lambda^2}(\\lambda L + 1) $$\n$$ \\int_{0}^{L} d^2 \\exp(-\\lambda d) \\, \\mathrm{d}d = \\left[ -\\frac{\\exp(-\\lambda d)}{\\lambda^3}(\\lambda^2 d^2 + 2\\lambda d + 2) \\right]_{0}^{L} = \\frac{2}{\\lambda^3} - \\frac{\\exp(-\\lambda L)}{\\lambda^3}(\\lambda^2 L^2 + 2\\lambda L + 2) $$\n将这些结果代回到 $p_{\\mathrm{span}}(L)$ 的表达式中：\n$$ p_{\\mathrm{span}}(L) = \\lambda^2 \\left( \\frac{1}{\\lambda^2} - \\frac{\\exp(-\\lambda L)}{\\lambda^2}(\\lambda L + 1) \\right) - \\frac{\\lambda^2}{L} \\left( \\frac{2}{\\lambda^3} - \\frac{\\exp(-\\lambda L)}{\\lambda^3}(\\lambda^2 L^2 + 2\\lambda L + 2) \\right) $$\n$$ p_{\\mathrm{span}}(L) = \\left( 1 - \\exp(-\\lambda L)(\\lambda L + 1) \\right) - \\frac{2}{\\lambda L} \\left( 1 - \\exp(-\\lambda L)\\left(\\frac{\\lambda^2 L^2}{2} + \\lambda L + 1\\right) \\right) $$\n这可以简化为一个更优美的形式。让我们从展开的积分中重新组合各项：\n$$ p_{\\mathrm{span}}(L) = 1 - (\\lambda L+1)\\exp(-\\lambda L) - \\frac{2}{\\lambda L} + \\frac{\\exp(-\\lambda L)}{\\lambda L}(\\lambda^2 L^2 + 2\\lambda L + 2) $$\n$$ p_{\\mathrm{span}}(L) = 1 - (\\lambda L+1)\\exp(-\\lambda L) - \\frac{2}{\\lambda L} + \\exp(-\\lambda L)(\\lambda L + 2 + \\frac{2}{\\lambda L}) $$\n$$ p_{\\mathrm{span}}(L) = 1 - \\frac{2}{\\lambda L} - \\lambda L \\exp(-\\lambda L) - \\exp(-\\lambda L) + \\lambda L \\exp(-\\lambda L) + 2 \\exp(-\\lambda L) + \\frac{2}{\\lambda L} \\exp(-\\lambda L) $$\n$$ p_{\\mathrm{span}}(L) = 1 - \\frac{2}{\\lambda L}(1 - \\exp(-\\lambda L)) + \\exp(-\\lambda L) $$\n\n现在我们可以计算 $L_1=150$ bp 和 $L_2=2000$ bp 时的 $p_{\\mathrm{span}}(L)$。\n参数 $\\lambda = 1/300$ bp$^{-1}$。\n\n对于 $L_1 = 150$ bp：\n无量纲积为 $\\lambda L_1 = \\frac{1}{300} \\times 150 = 0.5$。\n$$ p_{\\mathrm{span}}(L_1) = 1 - \\frac{2}{0.5}(1 - \\exp(-0.5)) + \\exp(-0.5) $$\n$$ p_{\\mathrm{span}}(L_1) = 1 - 4(1 - \\exp(-0.5)) + \\exp(-0.5) = 1 - 4 + 4\\exp(-0.5) + \\exp(-0.5) $$\n$$ p_{\\mathrm{span}}(L_1) = 5\\exp(-0.5) - 3 $$\n\n对于 $L_2 = 2000$ bp：\n无量纲积为 $\\lambda L_2 = \\frac{1}{300} \\times 2000 = \\frac{20}{3}$。\n$$ p_{\\mathrm{span}}(L_2) = 1 - \\frac{2}{20/3}(1 - \\exp(-20/3)) + \\exp(-20/3) $$\n$$ p_{\\mathrm{span}}(L_2) = 1 - \\frac{6}{20}(1 - \\exp(-20/3)) + \\exp(-20/3) = 1 - 0.3 + 0.3\\exp(-20/3) + \\exp(-20/3) $$\n$$ p_{\\mathrm{span}}(L_2) = 0.7 + 1.3\\exp(-20/3) $$\n\n所求的量是 $\\Delta A = p_{\\mathrm{span}}(L_2) - p_{\\mathrm{span}}(L_1)$。\n$$ \\Delta A = (0.7 + 1.3\\exp(-20/3)) - (5\\exp(-0.5) - 3) $$\n$$ \\Delta A = 3.7 + 1.3\\exp(-20/3) - 5\\exp(-0.5) $$\n\n现在我们代入指数函数的数值：\n$\\exp(-0.5) \\approx 0.6065306597$\n$\\exp(-20/3) \\approx 0.0012712499$\n\n$$ p_{\\mathrm{span}}(L_1) \\approx 5 \\times 0.6065306597 - 3 = 3.0326532985 - 3 = 0.0326532985 $$\n$$ p_{\\mathrm{span}}(L_2) \\approx 0.7 + 1.3 \\times 0.0012712499 = 0.7 + 0.0016526249 = 0.7016526249 $$\n\n$$ \\Delta A \\approx 0.7016526249 - 0.0326532985 = 0.6689993264 $$\n\n将结果四舍五入到四位有效数字，我们得到 $0.6690$。",
            "answer": "$$\\boxed{0.6690}$$"
        },
        {
            "introduction": "最后，我们将深入探讨天然RNA测序最独特的功能——直接检测RNA修饰，这在表观转录组学中具有革命性意义。由于原始电信号的解读具有内在的随机性，对修饰水平的估计本质上是一个概率推断问题。这项高级练习将指导您运用前沿的贝叶斯统计框架，结合共轭先验（conjugate prior）理论，从测序仪给出的概率性证据中估算RNA修饰的化学计量（stoichiometry），并量化其不确定性。这个练习将帮助您从简单的计数方法过渡到严谨的统计建模，为进行尖端的表观转录组学数据分析做好准备 。",
            "id": "4355991",
            "problem": "考虑一个通过长读长天然核糖核酸（RNA）测序分析的单转录组位点，其中每条比对到该位点的读数都会产生一个碱基修饰的估计概率。假设有 $n$ 条读数。对于读数 $i$，令 $p_i \\in [0,1]$ 表示该读数上碱基被修饰的概率。引入潜在伯努利变量 $Z_i \\in \\{0,1\\}$，指示读数 $i$ 是否真正被修饰。修饰化学计量定义为这些伯努利指标的均值，即 $\\theta = \\frac{1}{n} \\sum_{i=1}^{n} Z_i$。任务是根据先验信念，为 $\\theta$ 构建一个有原则的估计量和一个贝叶斯可信区间。\n\n基本原理：\n- 根据定义，对于伯努利随机变量 $Z_i$，其期望为 $\\mathbb{E}[Z_i] = \\Pr(Z_i = 1)$。\n- 在一个贝叶斯模型中，单位点化学计量参数 $\\theta \\in (0,1)$ 具有形状参数为 $\\alpha > 0$ 和 $\\beta > 0$ 的Beta先验分布 $\\text{Beta}(\\alpha,\\beta)$，并且数据是伯努利结果，那么Beta分布族是伯努利似然的共轭先验。\n- 每条读数的概率 $p_i$ 是从一个经过验证的长读长天然核糖核酸（RNA）测序修饰调用器获得的 $\\Pr(Z_i = 1 \\mid \\text{read data})$ 的良好校准估计。\n\n您的程序必须对每个测试用例，从第一性原理出发完成以下操作：\n1. 使用期望的线性性质，将化学计量的点估计构建为伯努利指标均值的期望，并用 $\\{p_i\\}_{i=1}^n$ 表示。\n2. 使用贝叶斯方法，对未知的化学计量参数施加 $\\text{Beta}(\\alpha,\\beta)$ 先验，并利用伯努利数据的共轭性概念，推导化学计量的后验分布。该分布应使用可用的 $\\{p_i\\}_{i=1}^n$ 来整合 $\\{Z_i\\}_{i=1}^n$ 中的不确定性，而不是将它们阈值化为二元调用。然后，计算化学计量的水平为 $0.95$ 的中心可信区间，该区间分别由后验分布在概率 $\\frac{1-0.95}{2}$ 和 $1-\\frac{1-0.95}{2}$ 处的下分位数和上分位数定义。\n3. 对于每个测试用例，报告三个实数：点估计、可信区间的下界和上界。所有概率都必须表示为小数，而不是百分号。\n\n科学真实性约束：\n- 您必须将读数视为在给定化学计量和读数级别信号的条件下条件独立的，并使用每条读数的概率 $\\{p_i\\}$ 作为关于 $\\{Z_i\\}$ 的概率性证据，而不是将它们阈值化为硬调用。不要假设所有 $p_i$ 都相同。\n- 先验分布 $\\text{Beta}(\\alpha,\\beta)$ 必须是正常的，即 $\\alpha > 0$ 且 $\\beta > 0$。\n\n测试套件和要求的输出：\n您的程序应计算并汇总以下一组测试用例的结果。对于每个用例，程序应输出点估计、0.95可信区间的下界和上界，四舍五入到 $6$ 位小数。\n\n- 测试用例 1: $\\{p_i\\} = [0.92, 0.87, 0.76, 0.61, 0.55, 0.33, 0.20, 0.10]$，$\\alpha = 1.0$，$\\beta = 1.0$。\n- 测试用例 2: $\\{p_i\\} = [0.02, 0.03, 0.01, 0.04, 0.00]$，$\\alpha = 0.5$，$\\beta = 0.5$。\n- 测试用例 3: $\\{p_i\\} = [1.0, 0.99, 1.0, 0.98, 1.0, 0.97]$，$\\alpha = 1.0$，$\\beta = 9.0$。\n- 测试用例 4: $\\{p_i\\}$ 是一个包含 $100$ 个概率的列表，由 $50$ 个等于 $0.3$ 的条目和 $50$ 个等于 $0.7$ 的条目组成，其中 $\\alpha = 20.0$，$\\beta = 20.0$。\n- 测试用例 5: $\\{p_i\\} = [0.0, 1.0]$，$\\alpha = 0.1$，$\\beta = 0.1$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。对于每个测试用例，按顺序输出三个值：点估计、下界、上界。按测试用例的顺序连接这些三元组，使最终输出成为一个扁平列表，例如 $[x_1,y_1,z_1,x_2,y_2,z_2,\\dots]$。所有值都必须四舍五入到 $6$ 位小数。不应打印任何其他文本。",
            "solution": "该问题要求基于长读长天然RNA测序仪的概率性输出，为RNA修饰化学计量构建一个点估计量和一个贝叶斯可信区间。\n\n### 问题验证\n该问题在科学上和数学上都是适定的。它描述了生物信息学中一个真实的情景，其中证据是概率性的而非确定性的。其表述涉及标准的统计概念：潜变量、期望和使用共轭先验的贝叶斯推断。符号 $\\theta$ 在指代样本统计量和模型参数时的双重使用存在轻微的模糊性。然而，问题文本为计算每个所需量提供了具体说明，从而解决了这种模糊性。任务1指定对化学计量的样本定义使用期望的线性性质，而任务2则指定对一个具有给定先验的“未知化学计量参数”进行贝叶斯处理。这些明确的指令使得一个连贯且有原则的解决方案成为可能。因此，该问题被认为是有效的。\n\n### 基于原理的解决方案推导\n\n令 $n$ 为覆盖特定转录组位点的测序读数数量。对于每条读数 $i \\in \\{1, \\dots, n\\}$，令 $Z_i$ 为一个潜伯努利随机变量，其中 $Z_i=1$ 表示碱基真正被修饰，否则 $Z_i=0$。测序仪提供概率 $p_i$，这些概率是 $\\Pr(Z_i=1 | \\text{read data}_i)$ 的良好校准估计。因此，我们对潜变量 $Z_i$ 的信念被封装在一个参数为 $p_i$ 的伯努利分布中，即 $\\Pr(Z_i=1) = p_i$。\n\n#### 1. 化学计量的点估计\n\n问题将化学计量定义为潜修饰指标的样本均值：\n$$\n\\theta_{sample} = \\frac{1}{n} \\sum_{i=1}^{n} Z_i\n$$\n我们被要求使用期望的线性性质为此量构建一个点估计。$\\theta_{sample}$ 的期望是：\n$$\n\\mathbb{E}[\\theta_{sample}] = \\mathbb{E}\\left[\\frac{1}{n} \\sum_{i=1}^{n} Z_i\\right]\n$$\n根据期望的线性性质，这变为：\n$$\n\\mathbb{E}[\\theta_{sample}] = \\frac{1}{n} \\sum_{i=1}^{n} \\mathbb{E}[Z_i]\n$$\n伯努利随机变量 $Z_i$ 的期望是成功的概率，即 $\\Pr(Z_i=1)$。根据给定信息，对此概率的最佳估计是 $p_i$。因此，$\\mathbb{E}[Z_i] = p_i$。\n将此代入方程，我们得到点估计量，记为 $\\hat{\\theta}$：\n$$\n\\hat{\\theta} = \\frac{1}{n} \\sum_{i=1}^{n} p_i\n$$\n该估计量是每条读数修饰概率的算术平均值。\n\n#### 2. 化学计量参数的贝叶斯可信区间\n\n对于可信区间，我们为潜在的、未观测到的全位点化学计量参数采用贝叶斯框架，我们将其记为 $\\theta_{param} \\in (0,1)$。此参数代表该位点的真实修饰率。我们假设，在给定 $\\theta_{param}$ 的条件下，真实的修饰状态 $Z_i$ 是独立同分布的伯努利试验：$Z_i | \\theta_{param} \\sim \\text{Bernoulli}(\\theta_{param})$。\n\n关于此参数的先验信念被给定为一个Beta分布：\n$$\n\\theta_{param} \\sim \\text{Beta}(\\alpha, \\beta)\n$$\n先验的概率密度函数（PDF）为 $P(\\theta_{param}) \\propto \\theta_{param}^{\\alpha-1}(1-\\theta_{param})^{\\beta-1}$。\n\n在给定参数 $\\theta_{param}$ 的情况下，观测到一组特定二元结果 $\\mathbf{Z} = (Z_1, \\dots, Z_n)$ 的似然是：\n$$\nP(\\mathbf{Z} | \\theta_{param}) = \\prod_{i=1}^{n} P(Z_i | \\theta_{param}) = \\prod_{i=1}^{n} \\theta_{param}^{Z_i} (1-\\theta_{param})^{1-Z_i} = \\theta_{param}^{\\sum Z_i} (1-\\theta_{param})^{n-\\sum Z_i}\n$$\n由于Beta先验和伯努利似然的共轭性，给定结果 $\\mathbf{Z}$ 后 $\\theta_{param}$ 的后验分布也是一个Beta分布：\n$$\n\\theta_{param} | \\mathbf{Z} \\sim \\text{Beta}\\left(\\alpha + \\sum_{i=1}^{n} Z_i, \\beta + n - \\sum_{i=1}^{n} Z_i\\right)\n$$\n然而，潜变量 $Z_i$ 并未被直接观测到。我们拥有的是概率 $p_i$。问题要求我们“整合 $\\{Z_i\\}$ 中的不确定性”。一个有原则且计算上易于处理的方法是使用充分统计量的*期望*值来更新先验。充分统计量是修饰的读数数量 $S = \\sum_{i=1}^n Z_i$ 和未修饰的读数数量 $F = \\sum_{i=1}^n (1-Z_i)$。\n\n在证据 $\\{p_i\\}$ 的条件下，它们的期望是：\n$$\n\\mathbb{E}[S | \\{p_i\\}] = \\sum_{i=1}^{n} \\mathbb{E}[Z_i | p_i] = \\sum_{i=1}^{n} p_i\n$$\n$$\n\\mathbb{E}[F | \\{p_i\\}] = \\sum_{i=1}^{n} \\mathbb{E}[1-Z_i | p_i] = \\sum_{i=1}^{n} (1-p_i) = n - \\sum_{i=1}^{n} p_i\n$$\n使用这种期望计数或“软”计数可以得到 $\\theta_{param}$ 的一个近似后验分布。我们用这些期望计数来更新Beta先验的超参数：\n$$\n\\alpha_{post} = \\alpha + \\mathbb{E}[S | \\{p_i\\}] = \\alpha + \\sum_{i=1}^{n} p_i\n$$\n$$\n\\beta_{post} = \\beta + \\mathbb{E}[F | \\{p_i\\}] = \\beta + n - \\sum_{i=1}^{n} p_i\n$$\n由此产生的化学计量参数的后验分布是：\n$$\n\\theta_{param} | \\{p_i\\} \\sim \\text{Beta}(\\alpha_{post}, \\beta_{post})\n$$\n在置信水平为 $1-\\gamma$（这里是 $0.95$）的中心可信区间由该后验分布的 $\\gamma/2$ 和 $1-\\gamma/2$ 分位数定义。对于一个 $0.95$ 的可信区间，我们需要 $0.025$ 和 $0.975$ 分位数。令 $F_{\\text{Beta}}^{-1}(\\cdot; a, b)$ 为形状参数为 $a$ 和 $b$ 的Beta分布的百分点函数（累积分布函数的逆函数）。区间的下界 ($L$) 和上界 ($U$) 是：\n$$\nL = F_{\\text{Beta}}^{-1}(0.025; \\alpha_{post}, \\beta_{post})\n$$\n$$\nU = F_{\\text{Beta}}^{-1}(0.975; \\alpha_{post}, \\beta_{post})\n$$\n这些值将对每个测试用例使用数值库进行计算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import beta as beta_dist\n\ndef solve():\n    \"\"\"\n    Solves the RNA modification stoichiometry problem for a suite of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"p_i\": [0.92, 0.87, 0.76, 0.61, 0.55, 0.33, 0.20, 0.10],\n            \"alpha\": 1.0,\n            \"beta\": 1.0\n        },\n        {\n            \"p_i\": [0.02, 0.03, 0.01, 0.04, 0.00],\n            \"alpha\": 0.5,\n            \"beta\": 0.5\n        },\n        {\n            \"p_i\": [1.0, 0.99, 1.0, 0.98, 1.0, 0.97],\n            \"alpha\": 1.0,\n            \"beta\": 9.0\n        },\n        {\n            \"p_i\": [0.3] * 50 + [0.7] * 50,\n            \"alpha\": 20.0,\n            \"beta\": 20.0\n        },\n        {\n            \"p_i\": [0.0, 1.0],\n            \"alpha\": 0.1,\n            \"beta\": 0.1\n        }\n    ]\n\n    results = []\n    \n    #\n    # The confidence level for the credible interval is 0.95.\n    # The quantiles are (1 - 0.95) / 2 and 1 - (1 - 0.95) / 2.\n    #\n    credible_interval_level = 0.95\n    lower_quantile = (1.0 - credible_interval_level) / 2.0\n    upper_quantile = 1.0 - lower_quantile\n\n    for case in test_cases:\n        p_i = np.array(case[\"p_i\"])\n        alpha_prior = case[\"alpha\"]\n        beta_prior = case[\"beta\"]\n\n        n = len(p_i)\n        sum_p_i = np.sum(p_i)\n\n        # 1. Calculate the point estimate of stoichiometry.\n        # This is the arithmetic mean of the per-read probabilities.\n        # It is the expectation of the sample stoichiometry theta = (1/n) * sum(Z_i).\n        point_estimate = sum_p_i / n if n > 0 else 0.0\n\n        # 2. Derive the posterior distribution and compute the credible interval.\n        # The posterior is approximated by a Beta distribution where the prior\n        # parameters are updated with the expected counts of modified (sum_p_i)\n        # and unmodified (n - sum_p_i) reads.\n        alpha_post = alpha_prior + sum_p_i\n        beta_post = beta_prior + (n - sum_p_i)\n\n        # 3. Compute the lower and upper bounds of the 95% central credible interval.\n        # This is done by finding the 0.025 and 0.975 quantiles of the posterior Beta distribution.\n        lower_bound = beta_dist.ppf(lower_quantile, alpha_post, beta_post)\n        upper_bound = beta_dist.ppf(upper_quantile, alpha_post, beta_post)\n\n        # Append the formatted results\n        results.extend([\n            round(point_estimate, 6),\n            round(lower_bound, 6),\n            round(upper_bound, 6)\n        ])\n\n    # Final print statement in the exact required format.\n    # e.g., [x1,y1,z1,x2,y2,z2,...]\n    formatted_results = [f\"{val:.6f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}