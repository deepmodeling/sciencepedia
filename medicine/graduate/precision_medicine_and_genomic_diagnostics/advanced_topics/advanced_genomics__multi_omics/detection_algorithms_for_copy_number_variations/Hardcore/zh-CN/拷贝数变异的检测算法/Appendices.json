{
    "hands_on_practices": [
        {
            "introduction": "拷贝数变异（CNV）检测的核心在于区分真实的拷贝数变化与测序数据固有的技术和生物学噪声。本实践将引导你应用负二项分布模型，这是分析过度离散的下一代测序（NGS）读数计数的标准方法。通过为单个外显子的覆盖深度数据推导统计显著性阈值，你将掌握从原始信号中做出可靠拷贝数变异判断的基本技能。",
            "id": "4331520",
            "problem": "使用覆盖深度方法，对一个靶向下一代测序（NGS）基因面板进行外显子级别分辨率的拷贝数变异（CNV）分析。经过标准的规格化因子和鸟嘌呤-胞嘧啶（GC）含量校正后，单个基因的四个外显子的校正后患者计数和合并参考的期望计数如下：\n- 外显子 $1$：患者计数 $S_{1} = 985$，参考期望 $\\mu_{1} = 1000$。\n- 外显子 $2$：患者计数 $S_{2} = 1260$，参考期望 $\\mu_{2} = 1200$。\n- 外显子 $3$：患者计数 $S_{3} = 390$，参考期望 $\\mu_{3} = 800$。\n- 外显子 $4$：患者计数 $S_{4} = 1520$，参考期望 $\\mu_{4} = 1500$。\n\n假设以下基础模型和条件：\n- 对于一个校正后的二倍体外显子，患者的校正后计数 $S_{i}$ 可以很好地用均值为 $\\mu_{i}$、方差为 $\\operatorname{Var}(S_{i}) = \\mu_{i} + \\phi \\mu_{i}^{2}$ 的负二项（NB）分布来建模，其中 $\\phi$ 是由生物学和技术变异性引起的过度离散参数。\n- 合并参考的期望 $\\mu_{i}$ 是从一个大规模对照队列中估计得出的，因此其不确定性与样本的计数方差相比可以忽略不计。\n- 外显子水平的对数比率定义为 $x_{i} = \\log_{2}\\!\\left(\\frac{S_{i}}{\\mu_{i}}\\right)$。\n- 为进行检测，使用单侧 I 型错误率 $\\alpha = 1.0 \\times 10^{-3}$ 来判定杂合性缺失（仅考虑下尾部）。\n- 校正后的过度离散参数为 $\\phi = 0.03$。\n\n任务：\n1) 计算当 $i \\in \\{1,2,3,4\\}$ 时，外显子水平的对数比率 $x_{i}$。\n2) 从给定的负二项方差模型出发，在二倍体状态下对 $x_{i}$ 使用适当的一阶方差传播，推导出单侧下决策阈值 $T_{3}$（以 $\\log_{2}$ 拷贝数比率单位表示），使得 $\\mathbb{P}(x_{3}  T_{3} \\mid \\text{diploid}) = \\alpha$。\n3) 基于此阈值和计算出的 $x_{3}$，判断外显子 $3$ 是否应被判定为杂合性缺失。\n\n为便于评分，请仅报告 $T_{3}$ 的数值（以 $\\log_{2}$ 拷贝数比率单位表示）。将您的答案四舍五入至四位有效数字。最终阈值以 $\\log_{2}$ 拷贝数比率单位表示（无单位）。",
            "solution": "用户提供了一个问题，在尝试解答之前需要进行验证。\n\n### 步骤 1：提取给定信息\n-   外显子1的校正后患者计数：$S_{1} = 985$\n-   外显子1的参考期望计数：$\\mu_{1} = 1000$\n-   外显子2的校正后患者计数：$S_{2} = 1260$\n-   外显子2的参考期望计数：$\\mu_{2} = 1200$\n-   外显子3的校正后患者计数：$S_{3} = 390$\n-   外显子3的参考期望计数：$\\mu_{3} = 800$\n-   外显子4的校正后患者计数：$S_{4} = 1520$\n-   外显子4的参考期望计数：$\\mu_{4} = 1500$\n-   患者计数 $S_{i}$ 的分布模型：负二项（NB）分布，均值为 $\\mu_{i}$。\n-   $S_{i}$ 的方差模型：$\\operatorname{Var}(S_{i}) = \\mu_{i} + \\phi \\mu_{i}^{2}$。\n-   过度离散参数：$\\phi = 0.03$。\n-   外显子水平对数比率的定义：$x_{i} = \\log_{2}\\!\\left(\\frac{S_{i}}{\\mu_{i}}\\right)$。\n-   杂合性缺失判定的单侧 I 型错误率：$\\alpha = 1.0 \\times 10^{-3}$。\n-   条件：参考期望计数 $\\mu_{i}$ 的不确定性可以忽略。\n\n### 步骤 2：使用提取的信息进行验证\n对问题的有效性进行评估：\n-   **科学依据**：该问题在基因组诊断学领域有充分的科学依据。使用负二项分布来建模过度离散的测序读数计数是生物信息学中一种标准且被广泛接受的做法。方差结构 $\\operatorname{Var}(S) = \\mu + \\phi \\mu^2$ 是一种常见的参数化方法。对数比率的定义及其在 CNV 检测中的应用是该领域的基础。\n-   **适定性**：该问题是适定的。它提供了推导所需阈值 ($T_3$) 的所有必要参数（$\\mu_3$, $\\phi$, $\\alpha$）和统计量 ($x_3$) 的清晰定义。任务具有顺序逻辑性，可以确定一个唯一、稳定且有意义的解。在此背景下，使用方差传播（delta 方法）是一种合适且标准的技术。\n-   **客观性**：该问题以客观、精确和定量的术语陈述。没有主观或基于意见的陈述。\n\n该问题没有说明中列出的任何缺陷（例如，科学上不合理、不完整、矛盾、模糊）。在靶向测序的背景下，所有数值都是合理的。\n\n### 步骤 3：结论和行动\n问题被判定为**有效**。将提供解答。\n\n问题要求计算外显子 $3$ 的单侧下决策阈值 $T_{3}$ 的数值。这需要在原假设（二倍体状态）下计算对数比率统计量 $x_{3}$ 的方差，然后找到与指定的 I 型错误率 $\\alpha$ 对应的临界值。\n\n首先，我们将关注的统计量，即外显子 $3$ 的对数比率，定义为随机变量 $S_{3}$ 的函数：\n$$x_{3} = f(S_{3}) = \\log_{2}\\!\\left(\\frac{S_{3}}{\\mu_{3}}\\right)$$\n为便于求导，我们可以使用自然对数来表示：\n$$x_{3} = \\frac{\\ln(S_{3}/\\mu_{3})}{\\ln(2)} = \\frac{1}{\\ln(2)} (\\ln(S_{3}) - \\ln(\\mu_{3}))$$\n问题指定使用一阶方差传播，通常称为 delta 方法。对于随机变量 $Y$ 的函数 $f(Y)$，其方差近似为：\n$$\\operatorname{Var}(f(Y)) \\approx [f'(\\mathbb{E}[Y])]^{2} \\operatorname{Var}(Y)$$\n在本例中，随机变量是 $S_{3}$，其在原假设下的期望是 $\\mathbb{E}[S_{3}] = \\mu_{3}$，函数是 $f(S_3) = x_3$。我们需要求 $f(S_{3})$ 相对于 $S_{3}$ 的导数：\n$$\\frac{df}{dS_{3}} = \\frac{d}{dS_{3}}\\left[ \\frac{1}{\\ln(2)} (\\ln(S_{3}) - \\ln(\\mu_{3})) \\right] = \\frac{1}{\\ln(2)} \\cdot \\frac{1}{S_{3}}$$\n我们在期望值 $\\mathbb{E}[S_{3}] = \\mu_{3}$ 处计算该导数：\n$$f'(\\mu_{3}) = \\frac{1}{\\mu_{3} \\ln(2)}$$\n现在我们应用方差传播公式：\n$$\\operatorname{Var}(x_{3}) \\approx \\left(\\frac{1}{\\mu_{3} \\ln(2)}\\right)^{2} \\operatorname{Var}(S_{3})$$\n问题陈述了 $S_{3}$ 的方差为 $\\operatorname{Var}(S_{3}) = \\mu_{3} + \\phi \\mu_{3}^{2}$。将此代入 $\\operatorname{Var}(x_{3})$ 的表达式中：\n$$\\operatorname{Var}(x_{3}) \\approx \\frac{1}{\\mu_{3}^{2} (\\ln(2))^{2}} (\\mu_{3} + \\phi \\mu_{3}^{2}) = \\frac{\\mu_{3}}{\\mu_{3}^{2} (\\ln(2))^{2}} + \\frac{\\phi \\mu_{3}^{2}}{\\mu_{3}^{2} (\\ln(2))^{2}}$$\n化简此表达式得到对数比率的方差：\n$$\\operatorname{Var}(x_{3}) \\approx \\frac{1}{\\mu_{3} (\\ln(2))^{2}} + \\frac{\\phi}{(\\ln(2))^{2}} = \\frac{1}{(\\ln(2))^{2}} \\left( \\frac{1}{\\mu_{3}} + \\phi \\right)$$\n对于大计数值，对数比率 $x_3$ 的分布可以用正态分布来近似。在二倍体状态的原假设下，期望比率 $S_3/\\mu_3$ 为 $1$，因此期望对数比率为 $\\mathbb{E}[x_{3}] \\approx \\log_{2}(\\mathbb{E}[S_3]/\\mu_3) = \\log_{2}(1) = 0$。\n因此，在原假设下，$x_{3} \\sim \\mathcal{N}(0, \\operatorname{Var}(x_{3}))$。\n\n我们需要找到阈值 $T_{3}$，使得观察到小于 $T_{3}$ 的对数比率的概率等于指定的 I 型错误率 $\\alpha$：\n$$\\mathbb{P}(x_{3}  T_{3} \\mid \\text{diploid}) = \\alpha$$\n为了找到 $T_{3}$，我们将变量 $x_{3}$ 标准化为一个标准正态变量 $Z \\sim \\mathcal{N}(0,1)$：\n$$Z = \\frac{x_{3} - \\mathbb{E}[x_{3}]}{\\sqrt{\\operatorname{Var}(x_{3})}} = \\frac{x_{3}}{\\sigma_{x_3}}$$\n其中 $\\sigma_{x_3} = \\sqrt{\\operatorname{Var}(x_{3})}$。\n条件变为：\n$$\\mathbb{P}\\left(Z  \\frac{T_{3}}{\\sigma_{x_3}}\\right) = \\alpha$$\n这意味着 $\\frac{T_{3}}{\\sigma_{x_3}}$ 是标准正态分布的 $\\alpha$-分位数，记为 $z_{\\alpha}$。\n$$T_{3} = z_{\\alpha} \\sigma_{x_3}$$\n给定值为 $\\mu_{3} = 800$，$\\phi = 0.03$ 和 $\\alpha = 1.0 \\times 10^{-3} = 0.001$。\n标准差 $\\sigma_{x_3}$ 为：\n$$\\sigma_{x_3} = \\sqrt{\\frac{1}{(\\ln(2))^{2}} \\left( \\frac{1}{\\mu_{3}} + \\phi \\right)} = \\frac{1}{\\ln(2)} \\sqrt{\\frac{1}{800} + 0.03}$$\n$$\\sigma_{x_3} = \\frac{1}{\\ln(2)} \\sqrt{0.00125 + 0.03} = \\frac{\\sqrt{0.03125}}{\\ln(2)}$$\n当 $\\alpha = 0.001$ 时，标准正态分布的 $\\alpha$-分位数是 $z_{0.001} \\approx -3.09023$。\n现在我们可以计算 $T_{3}$ 的数值：\n$$T_{3} = z_{0.001} \\cdot \\sigma_{x_3} \\approx -3.09023 \\times \\frac{\\sqrt{0.03125}}{\\ln(2)}$$\n$$T_{3} \\approx -3.09023 \\times \\frac{0.1767767}{0.693147} \\approx -3.09023 \\times 0.255031$$\n$$T_{3} \\approx -0.788114$$\n将结果四舍五入到四位有效数字，我们得到 $T_{3} = -0.7881$。\n\n虽然最终答案不需要，但作为背景信息，外显子 3 的观测对数比率为 $x_{3} = \\log_{2}(390/800) = \\log_{2}(0.4875) \\approx -1.0365$。由于 $x_3  T_3$ (即 $-1.0365  -0.7881$)，外显子 3 会被可信地判定为杂合性缺失。然而，问题只要求 $T_3$ 的值。",
            "answer": "$$\\boxed{-0.7881}$$"
        },
        {
            "introduction": "在肿瘤基因组学中，仅靠读数深度获得的相对拷贝数往往信息不足。本实践模拟了一个更复杂的真实场景，要求你整合读数深度和B等位基因频率（BAF）这两种正交数据类型。通过构建一个混合模型来解析肿瘤与正常细胞混合样本的信号，你将学习如何推断绝对拷贝数、肿瘤纯度和样本倍性，这是精准肿瘤诊断中的一项核心高级技能。",
            "id": "4331590",
            "problem": "一个肿瘤样本与其匹配的正常样本一同进行测序，在一个 150 兆碱基 (Mb) 的目标区域内识别出三个不相交的基因组片段，并获得了可靠的读取深度和单核苷酸多态性等位基因测量值。假设以下基本原则：读取深度与 DNA 的总质量成正比，而 DNA 总质量又与总拷贝数成正比；观察到的次要等位基因分数来自于肿瘤和正常细胞在杂合位点的贡献混合。正常细胞是二倍体，总拷贝数为 $2$。设肿瘤纯度为样本中肿瘤细胞的比例 $\\pi$。设全局文库缩放因子为 $k$，它用于解释样本水平效应对标准化的肿瘤与正常样本深度比率的影响。对于片段 $i$，设 $L_i$ 为其长度， $D_i$ 为其经过偏差校正后的标准化深度比率（肿瘤与正常样本之比），$F_i$ 为观察到的次要等位基因分数（通过选择 B 等位基因频率 (BAF) 聚类中的次要聚类计算得出）。三个片段的测量值如下：\n- 片段 1：$L_1 = 80$ Mb, $D_1 = 1.215$, $F_1 = 0.370$。\n- 片段 2：$L_2 = 40$ Mb, $D_2 = 0.900$, $F_2 = 0.150$。\n- 片段 3：$L_3 = 30$ Mb, $D_3 = 1.530$, $F_3 = 0.500$。\n假设片段 2 表现出杂合性丢失，片段 3 是等位基因平衡的，而片段 1 是不平衡的，但其次要等位基因不为零。仅使用基于肿瘤和正常细胞对读取深度和次要等位基因分数的贡献混合的第一性原理进行论证，推断每个片段中肿瘤的绝对整数拷贝数状态，估计肿瘤纯度 $\\pi$ 和全局缩放因子 $k$，然后计算 panel 倍性，其定义为在 150 Mb 区域内按长度加权的肿瘤平均拷贝数：\n$$P \\equiv \\frac{L_1 \\, t_1 + L_2 \\, t_2 + L_3 \\, t_3}{L_1 + L_2 + L_3},$$\n其中 $t_i$ 是片段 $i$ 的肿瘤绝对总拷贝数。将最终的 $P$ 值四舍五入到四位有效数字，并将其表示为一个无单位的量。",
            "solution": "我们从两个基本的混合关系出发。首先，读取深度与 DNA 质量成正比，对于肿瘤和正常细胞的混合物，这与每个群体贡献的总拷贝数成正比。如果 $t_i$ 表示片段 $i$ 中肿瘤的总拷贝数，而正常细胞的总拷贝数为 $2$，那么片段 $i$ 中预期的标准化肿瘤与正常样本深度比率可以写为\n$$D_i = k \\cdot \\frac{\\pi \\, t_i + (1 - \\pi)\\cdot 2}{2},$$\n其中 $k$ 是一个全局文库缩放因子。这个表达式的产生是因为分子反映了肿瘤和正常细胞拷贝数的混合，而分母 $2$ 反映了对二倍体正常细胞的标准化。\n\n其次，杂合位点中的次要等位基因分数来自于等位基因特异性拷贝数的混合。设肿瘤的等位基因特异性拷贝数为 $(a_i, b_i)$，其中 $a_i \\geq b_i$ 且 $a_i + b_i = t_i$。在一个杂合位点，正常细胞的贡献是 $(1,1)$。片段 $i$ 中预期的次要等位基因分数为\n$$F_i = \\frac{\\pi \\, b_i + (1 - \\pi) \\cdot 1}{\\pi \\, t_i + (1 - \\pi) \\cdot 2}.$$\n我们使用这些关系来推断 $t_i$、$\\pi$ 和 $k$。\n\n我们已知一些定性约束：片段 2 表现出杂合性丢失 (LOH)，片段 3 是等位基因平衡的，而片段 1 是不平衡但保留了非零的次要等位基因。LOH 意味着 $b_2 = 0$ 且 $t_2 \\geq 1$。因为在许多肿瘤中，片段 2 表现为拷贝数中性的 LOH，且其深度比率 $D_2$ 接近于 1，所以总拷贝数为整数 $t_2 = 2$ 与这种生物学现象和测量值是一致的。我们将在下面验证其一致性。\n\n对于 $t_2 = 2$ 且存在 LOH ($b_2 = 0$) 的片段 2，深度方程变为\n$$D_2 = k \\cdot \\frac{\\pi \\cdot 2 + (1 - \\pi) \\cdot 2}{2} = k \\cdot \\frac{2}{2} = k.$$\n因此，\n$$k = D_2 = 0.900.$$\n在 LOH 条件下，$t_2 = 2$ 且 $b_2 = 0$ 时，片段 2 的次要等位基因分数为\n$$F_2 = \\frac{\\pi \\cdot 0 + (1 - \\pi) \\cdot 1}{\\pi \\cdot 2 + (1 - \\pi) \\cdot 2} = \\frac{1 - \\pi}{2}.$$\n已知 $F_2 = 0.150$，我们求解\n$$\\frac{1 - \\pi}{2} = 0.150 \\quad \\Rightarrow \\quad 1 - \\pi = 0.300 \\quad \\Rightarrow \\quad \\pi = 0.700.$$\n\n接下来考虑片段 3，它是等位基因平衡的：这意味着 $a_3 = b_3$，因此 $t_3$ 是偶数，且 $b_3 = t_3/2$。在最小的偶数整数中，$t_3 = 2$ 会产生平衡，但其深度将等于二倍体；观察到的 $D_3 = 1.530$ 超过了 $D_2 = 0.900$，因此 $t_3$ 必须大于 2。最简单的高拷贝平衡状态是 $t_3 = 4$，其中 $(a_3, b_3) = (2,2)$。我们验证其与深度和次要等位基因分数的一致性。\n使用 $t_3=4$ 的深度方程，\n$$D_3 = k \\cdot \\frac{\\pi \\cdot 4 + (1 - \\pi) \\cdot 2}{2} = k \\cdot \\frac{4\\pi + 2 - 2\\pi}{2} = k \\cdot (\\pi + 1).$$\n代入 $k = 0.900$ 和 $D_3 = 1.530$，\n$$\\pi + 1 = \\frac{D_3}{k} = \\frac{1.530}{0.900} = 1.700 \\quad \\Rightarrow \\quad \\pi = 0.700,$$\n这与从片段 2 获得的纯度相匹配。\n\n对于 $(a_3, b_3) = (2,2)$ 的片段 3，其次要等位基因分数为\n$$F_3 = \\frac{\\pi \\cdot 2 + (1 - \\pi) \\cdot 1}{\\pi \\cdot 4 + (1 - \\pi) \\cdot 2} = \\frac{2\\pi + 1 - \\pi}{4\\pi + 2 - 2\\pi} = \\frac{\\pi + 1}{2\\pi + 2}.$$\n当 $\\pi = 0.700$ 时，\n$$F_3 = \\frac{0.700 + 1}{2 \\cdot 0.700 + 2} = \\frac{1.700}{3.400} = 0.500,$$\n与测量的 $F_3 = 0.500$ 一致。因此，片段 3 的 $t_3 = 4$。\n\n现在考虑片段 1，它是不平衡的但保留了次要等位基因。考虑到 $F_1 = 0.370$，一个简约的整数状态是 $t_1 = 3$，其中 $(a_1, b_1) = (2,1)$。我们使用次要等位基因分数和深度比率来验证这一点。对于 $(2,1)$，其次要等位基因分数为\n$$F_1 = \\frac{\\pi \\cdot 1 + (1 - \\pi) \\cdot 1}{\\pi \\cdot 3 + (1 - \\pi) \\cdot 2} = \\frac{\\pi + 1 - \\pi}{3\\pi + 2 - 2\\pi} = \\frac{1}{\\pi + 2}.$$\n当 $\\pi = 0.700$ 时，\n$$F_1 = \\frac{1}{0.700 + 2} = \\frac{1}{2.700} \\approx 0.37037,$$\n这与测量的 $F_1 = 0.370$ 相匹配。对于 $t_1=3$，深度比率为\n$$D_1 = k \\cdot \\frac{\\pi \\cdot 3 + (1 - \\pi) \\cdot 2}{2} = k \\cdot \\frac{3\\pi + 2 - 2\\pi}{2} = k \\cdot \\frac{\\pi + 2}{2}.$$\n当 $k = 0.900$ 和 $\\pi = 0.700$ 时，\n$$D_1 = 0.900 \\cdot \\frac{0.700 + 2}{2} = 0.900 \\cdot \\frac{2.700}{2} = 0.900 \\cdot 1.350 = 1.215,$$\n这与测量的 $D_1 = 1.215$ 相匹配。因此，片段 1 的 $t_1 = 3$。\n\n我们已经推断出绝对拷贝数和参数：\n- $t_1 = 3$, $t_2 = 2$, $t_3 = 4$,\n- $\\pi = 0.700$, $k = 0.900$.\n\n最后，计算 panel 倍性 $P$ 作为长度加权平均值：\n$$P = \\frac{L_1 \\, t_1 + L_2 \\, t_2 + L_3 \\, t_3}{L_1 + L_2 + L_3} = \\frac{80 \\cdot 3 + 40 \\cdot 2 + 30 \\cdot 4}{80 + 40 + 30} = \\frac{240 + 80 + 120}{150} = \\frac{440}{150} \\approx 2.933\\overline{3}.$$\n四舍五入到四位有效数字并表示为无单位量，panel 倍性为 $2.933$。",
            "answer": "$$\\boxed{2.933}$$"
        },
        {
            "introduction": "CNV检测算法的最终目标是准确地划分出基因组上发生拷贝数变化的连续区域。本实践将让你亲手实现一个基于动态规划的分割算法，这正是许多经典CNV检测工具（如CBS算法）的核心思想。你将通过最小化一个结合了数据拟合度与模型复杂度的成本函数来找到最优分割点，并学习如何通过系统性地评估参数来选择最佳的算法工作点，从而将理论知识转化为可执行的生物信息学分析流程。",
            "id": "4331596",
            "problem": "给定多个一维基因组覆盖度剖面，每个剖面都建模为一个被加性噪声破坏的分段常数信号，代表了连续基因组区间的以2为底的对数拷贝数比率测量值。其基础由以下经过充分检验的模型和定义构成：对于区间索引 $i \\in \\{1,\\dots,n\\}$，观测值为 $x_i = \\mu_{k(i)} + \\varepsilon_i$，其中 $\\mu_{k(i)}$ 是区间 $i$ 所属的未知片段 $k(i)$ 的真实均值水平，而 $\\varepsilon_i$ 是独立的零均值噪声项。拷贝数变异 (CNV) 事件对应于真实均值偏离中性水平 $0$ 的连续区间。\n\n分割问题被描述为最小化一个加性成本，该成本平衡了数据保真度和模型复杂度。对于一个分割成 $K$ 个连续片段（其索引集为 $I_1,\\dots,I_K$，片段均值为 $\\mu_1,\\dots,\\mu_K$）的情况，定义目标函数为\n$$\nJ = \\sum_{k=1}^{K}\\sum_{i \\in I_k} (x_i - \\mu_k)^2 + \\lambda \\cdot K,\n$$\n其中 $\\lambda  0$ 是一个惩罚参数，用于控制拟合优度与片段数量之间的权衡。能使片段内平方误差最小化的片段均值是该片段的样本均值。\n\n对于固定的 $\\lambda$，可以通过动态规划找到全局最优分割。在评估时，任何推断出的片段，如果其均值绝对值满足 $\\lvert \\mu_k \\rvert \\ge \\tau$，就被称为一个变异片段调用，其中 $\\tau$ 是一个在以2为底的对数尺度上的固定振幅阈值。为了避免人为分裂，符号相同且直接相邻的变异片段将被合并为单个变异调用。\n\n为了计算检测性能，我们为每个剖面提供了一组真实 CNV 区间。一个真实区间 $G$ 被视为已检测到，如果存在一个预测的变异区间 $P$，使得由下式给出的交并比 (IoU)\n$$\n\\mathrm{IoU}(G,P) = \\frac{\\lvert G \\cap P \\rvert}{\\lvert G \\cup P \\rvert}\n$$\n满足 $\\mathrm{IoU}(G,P) \\ge \\theta$，其中 $\\theta$ 是一个固定的阈值。令 $TP$ 为被检测到的真实区间数量，$FP$ 为在 IoU $\\ge \\theta$ 的条件下与任何真实区间都不匹配的预测变异区间数量。\n\n您必须遍历一组给定的惩罚值 $\\{\\lambda_1,\\dots,\\lambda_m\\}$，为每个 $\\lambda_j$ 计算 $(TP,FP)$，并通过最大化效用函数来选择一个工作点\n$$\nU(\\lambda) = TP(\\lambda) - c \\cdot FP(\\lambda),\n$$\n其中 $c  0$ 是一个固定的成本比率。如果 $U(\\lambda)$ 出现平局，选择最大的 $\\lambda$。\n\n您的程序必须完全按照定义实现此分割和评估过程，并将其应用于以下测试套件。区间中的索引是基于 1 且包含端点。每个数据集的以2为底的对数拷贝数比率测量值 $x_i$ 和相应的真实 CNV 区间如下：\n\n- 所有数据集的通用常量：\n  - 惩罚扫描值: $\\{\\lambda\\} = \\{\\, 0.1,\\, 0.5,\\, 1.0,\\, 2.0,\\, 5.0,\\, 10.0 \\,\\}$.\n  - 变异调用阈值: $\\tau = 0.2$.\n  - 交并比阈值: $\\theta = 0.3$.\n  - 效用成本比率: $c = 1.0$.\n\n- 数据集 $1$：\n  - $x = [\\, 0.02,\\,-0.03,\\,0.01,\\,-0.05,\\,0.00,\\,-0.55,\\,-0.62,\\,-0.59,\\,-0.60,\\,-0.57,\\,0.03,\\,-0.02,\\,0.04,\\,-0.01,\\,0.00,\\,0.02,\\,-0.03,\\,0.05,\\,-0.02,\\,0.01 \\,]$.\n  - 真实区间: $[\\, (6,10) \\,]$.\n\n- 数据集 $2$：\n  - $x = [\\, 0.01,\\,-0.02,\\,0.02,\\,-0.03,\\,0.00,\\,0.03,\\,-0.01,\\,0.35,\\,0.42,\\,0.39,\\,0.41,\\,0.38,\\,0.00,\\,-0.01,\\,0.02,\\,-0.02,\\,0.01,\\,-0.95,\\,-1.02,\\,-0.98,\\,-1.01,\\,-0.97,\\,0.02,\\,-0.01,\\,0.03,\\,-0.02,\\,0.01,\\,0.00,\\,0.02,\\,-0.03 \\,]$.\n  - 真实区间: $[\\, (8,12),\\,(18,22) \\,]$.\n\n- 数据集 $3$：\n  - $x = [\\, 0.01,\\,-0.02,\\,0.00,\\,0.03,\\,-0.01,\\,0.02,\\,-0.03,\\,0.01,\\,-0.02,\\,0.02,\\,-0.01,\\,0.00,\\,0.03,\\,-0.02,\\,0.01 \\,]$.\n  - 真实区间: $[\\, \\,]$ (无 CNV).\n\n- 数据集 $4$：\n  - $x = [\\, 0.52,\\,0.48,\\,0.50,\\,0.00,\\,-0.02,\\,0.03,\\,-0.01,\\,0.02,\\,-0.03,\\,0.01,\\,-0.02,\\,0.00,\\,-0.58,\\,-0.61,\\,-0.57,\\,-0.60 \\,]$.\n  - 真实区间: $[\\, (1,3),\\,(13,16) \\,]$.\n\n您的任务：\n\n- 对于每个数据集和扫描中的每个 $\\lambda$，计算使上述定义的 $J$ 最小化的全局最优分割。\n- 根据分割结果，使用阈值 $\\tau$ 对片段均值的绝对值进行判断，调用变异区间，并合并符号相同的相邻变异调用。\n- 对于每个 $\\lambda$，使用 IoU 阈值 $\\theta$ 与给定的真实情况计算 $(TP,FP)$。\n- 对于每个数据集，通过最大化 $U(\\lambda) = TP(\\lambda) - c \\cdot FP(\\lambda)$ 来选择工作点，若出现平局则选择最大的 $\\lambda$。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含 4 个数据集的结果，格式为方括号括起来的逗号分隔列表。对于每个数据集，输出所选的 $\\lambda$ 以及相应的 $TP$ 和 $FP$，作为一个包含三个数字的列表。因此，最终输出必须是形如\n  $[\\, [\\lambda^\\star_1, TP_1, FP_1],\\; [\\lambda^\\star_2, TP_2, FP_2],\\; [\\lambda^\\star_3, TP_3, FP_3],\\; [\\lambda^\\star_4, TP_4, FP_4] \\,]$\n  的单行，其中 $\\lambda^\\star_d$ 是为数据集 $d$ 选择的惩罚值。不涉及单位，数字必须以标准十进制形式打印。",
            "solution": "该问题要求实现一个完整的流程，用于检测基因组数据中的拷贝数变异 (CNV)。这包括对代表以2为底的对数拷贝数比率的噪声信号进行分割，根据真实情况评估分割结果，并选择最优的模型配置。该过程基于统计信号处理和生物信息学中公认的原理。\n\n### 1. 模型与目标函数\n\n每个基因组剖面的输入数据是一个一维测量序列 $x_1, x_2, \\dots, x_n$，其中每个 $x_i$ 代表基因组区间 $i$ 的观测拷贝数与参考拷贝数之比的对数值。其底层的真实信号被假定为分段常数。一个观测值 $x_i$ 被建模为 $x_i = \\mu_{k(i)} + \\varepsilon_i$，其中 $\\mu_{k(i)}$ 是区间 $i$ 所属片段的真实均值，而 $\\varepsilon_i$ 是一个独立的零均值噪声项。\n\n分割任务是将序列 $x_1, \\dots, x_n$ 划分为 $K$ 个连续的片段 $I_1, \\dots, I_K$。这个划分是通过最小化一个带惩罚的成本函数 $J$ 来找到的，该函数平衡了数据保真度与模型复杂度：\n$$\nJ = \\sum_{k=1}^{K}\\sum_{i \\in I_k} (x_i - \\mu_k)^2 + \\lambda \\cdot K\n$$\n第一项 $\\sum_{k=1}^{K}\\sum_{i \\in I_k} (x_i - \\mu_k)^2$ 是观测数据与片段均值之间的总平方误差和。仅最小化这一项会导致过拟合，即每个数据点都自成一个片段。第二项 $\\lambda \\cdot K$ 是一个与片段数量 $K$ 成正比的惩罚项。参数 $\\lambda  0$ 控制着权衡：较大的 $\\lambda$ 倾向于产生片段较少的解，导致更粗糙的分割；而较小的 $\\lambda$ 允许更多的片段，从而更紧密地拟合数据。对于任何给定的片段，使平方误差最小化的均值 $\\mu_k$ 是该片段内数据点的样本均值。\n\n### 2. 通过动态规划实现最优分割\n\n对于一个固定的惩罚值 $\\lambda$，能全局最小化目标函数 $J$ 的分割可以通过动态规划高效地找到。设 $J^*(i)$ 为分割数据前缀 $x_1, \\dots, x_i$ 的最小成本。我们可以建立一个递推关系来计算这个值。前 $i$ 个点的最优分割可以通过找到前 $j-1$ 个点的最优分割，然后加上从 $j$ 到 $i$ 的最后一个片段来实现，其中 $1 \\le j \\le i$。\n\n递推关系为：\n$$\nJ^*(i) = \\min_{1 \\le j \\le i} \\left\\{ J^*(j-1) + C(j,i) + \\lambda \\right\\}\n$$\n基本情况为 $J^*(0) = 0$。项 $C(j,i)$ 代表覆盖从索引 $j$ 到 $i$ 的数据点的单个片段的最小平方误差和：\n$$\nC(j,i) = \\sum_{k=j}^{i} (x_k - \\bar{x}_{j..i})^2, \\quad \\text{其中 } \\bar{x}_{j..i} = \\frac{1}{i-j+1} \\sum_{k=j}^{i} x_k\n$$\n直接计算此递推关系涉及一个 $O(n^2)$ 的循环结构，而计算成本 $C(j,i)$ 需要 $O(n)$ 时间，导致总体复杂度为 $O(n^3)$。然而，我们可以对此进行优化。项 $C(j,i)$ 可以重写为 $\\sum_{k=j}^{i} x_k^2 - \\frac{1}{i-j+1}(\\sum_{k=j}^{i} x_k)^2$。通过预计算 $x_k$ 和 $x_k^2$ 的前缀和，任何区间 $[j,i]$ 上的和都可以在 $O(1)$ 时间内求得。这将计算 $J^*(n)$ 的复杂度降至 $O(n^2)$。\n\n为了重建实际的片段边界，我们在每一步 $i$ 存储一个指向产生最小成本的起始索引 $j$ 的指针。计算完 $J^*(n)$ 后，我们可以使用这些指针从 $i=n$ 回溯到 $i=0$，以恢复最优的片段边界。\n\n### 3. 后处理与性能评估\n\n对于给定的 $\\lambda$ 找到最优分割后，我们执行几个后处理和评估步骤。\n\n**变异区间调用**：如果一个片段 $k$ 的均值 $\\mu_k$ 的绝对值超过了指定的阈值 $\\tau$，即 $|\\mu_k| \\ge \\tau$，则该片段被分类为“变异调用”。这一步将代表真实 CNV 增加或减少的片段与代表中性状态（拷贝数为2）的片段区分开来。\n\n**合并**：为了校正算法将单个生物学事件分割为多个相邻片段的人为分裂现象，均值符号相同的相邻变异片段被合并成一个单一的、连续的预测区间。\n\n**性能指标**：将预测的变异区间集合 $\\{P\\}$ 与提供的一组真实区间 $\\{G\\}$ 进行比较。\n- 预测区间 $P$ 和真实区间 $G$ 之间的重叠度使用交并比 (IoU) 来量化：\n  $$\n  \\mathrm{IoU}(G,P) = \\frac{\\lvert G \\cap P \\rvert}{\\lvert G \\cup P \\rvert}\n  $$\n- 如果存在至少一个预测区间 $P$ 使得 $\\mathrm{IoU}(G,P) \\ge \\theta$（其中 $\\theta$ 是最小 IoU 阈值），则一个真实区间 $G$ 被认为是已检测到的。这样检测到的真实区间的总数即为真正例 ($TP$) 的数量。\n- 如果一个预测区间 $P$ 与任何真实区间都不匹配，即对于所有真实集合中的 $G$，都有 $\\mathrm{IoU}(G,P)  \\theta$，则该预测区间被视为一个假正例 ($FP$)。\n\n### 4. 模型选择\n\n对一系列惩罚值 $\\{\\lambda_1, \\dots, \\lambda_m\\}$ 重复整个过程。对于每个 $\\lambda_j$，我们计算出相应的配对 $(TP(\\lambda_j), FP(\\lambda_j))$。为了选择最佳工作点，我们最大化效用函数：\n$$\nU(\\lambda) = TP(\\lambda) - c \\cdot FP(\\lambda)\n$$\n其中 $c$ 是一个常数，指定了一个假正例相对于一个真正例的成本。如果多个 $\\lambda$ 值产生相同的最大效用，则选择最大的 $\\lambda$，遵循简约原则（倾向于更简单的模型）。每个数据集的最终结果是所选定的三元组 $[\\lambda^\\star, TP(\\lambda^\\star), FP(\\lambda^\\star)]$。",
            "answer": "```\n[[2.0, 1, 0], [2.0, 2, 0], [10.0, 0, 0], [0.5, 2, 0]]\n```"
        }
    ]
}