{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握隐私保护联邦学习，必须从其核心的隐私保障机制——差分隐私随机梯度下降（DP-SGD）的数学原理入手。本练习将引导你从第一性原理出发，推导该机制的隐私属性。通过亲手推导在替换一个样本的邻接关系下，梯度求和操作的$L_2$-敏感度，并将其与高斯机制的隐私属性相结合，你将深刻理解为何梯度裁剪是控制敏感度的关键，以及如何由此获得严格的$(\\epsilon, \\delta)$-差分隐私保证。",
            "id": "4339341",
            "problem": "一个由 $K$ 家医院组成的联盟训练一个联邦二元分类器，用于从全基因组特征中检测临床可干预的变异。每家医院 $i$ 拥有一个包含 $m$ 个标记样本的固定大小本地数据集，并通过差分隐私随机梯度下降 (DP-SGD) 计算本地梯度贡献，参与单轮通信。医院在欧几里得 ($\\ell_{2}$) 范数 $C$ 处应用逐样本梯度裁剪，并在裁剪后的梯度总和中添加每坐标标准差为 $\\sigma C$ 的独立高斯噪声，然后将结果发送给聚合器，聚合器再将其除以 $m$ 得到平均更新。假设相邻关系为有界（替换一个）邻接关系：如果两个数据集大小均为 $m$ 且仅相差一个样本，则它们是相邻的。聚合器被认为是诚实但好奇的，且医院之间不存在共谋。\n\n从 $(\\epsilon,\\delta)$-差分隐私 (DP) 的形式化定义、向量值函数在 $\\ell_{2}$ 范数下的全局敏感度定义，以及高斯机制的一个经过充分检验的充分条件——即对于 $\\epsilon \\in (0,1)$，只要每坐标标准差为 $s$ 的高斯噪声满足 $s \\ge \\frac{\\sqrt{2 \\ln(1.25/\\delta)} \\,\\Delta}{\\epsilon}$（其中 $\\Delta$ 为 $\\ell_{2}$-敏感度），即可实现 $(\\epsilon,\\delta)$-DP——出发，推导单个医院的 DP-SGD 机制，并从数学上证明为何在范数 $C$ 处进行逐样本裁剪可以限制敏感度。\n\n具体要求：\n- 在给定的邻接关系下，推导逐样本裁剪梯度之和的 $\\ell_{2}$-敏感度 $\\Delta_{\\mathrm{sum}}$。\n- 使用高斯机制的充分条件，以 $\\sigma$ 和 $\\delta$ 为变量，得出来自单个医院的单轮发布的 $\\epsilon$ 的上界。\n- 论证为什么将带噪总和除以 $m$ 以获得平均值不会改变隐私参数。\n\n你的最终答案必须是推导出的 $\\epsilon$ 上界的单一解析表达式，该表达式是关于 $\\sigma$ 和 $\\delta$ 的函数。无需进行数值代入或四舍五入。使用 $\\ln(\\cdot)$ 表示自然对数，精确表达最终结果。",
            "solution": "该问题陈述是一个有效且良定义的科学问题，其基础是差分隐私和联邦学习的既定原则。我们将进行形式化推导。\n\n问题的核心在于分析在单个医院实施的机制的隐私属性。该机制是差分隐私随机梯度下降 (DP-SGD) 的一个步骤，可以描述为一个函数 $\\mathcal{M}$，它接收一个大小为 $m$ 的本地数据集 $D$，并发布一个带噪的梯度总和。我们的任务是，在给定失败概率 $\\delta$ 的情况下，为该机制推导隐私参数 $\\epsilon$，并证明所涉及步骤的合理性。\n\n首先，我们回顾 $(\\epsilon, \\delta)$-差分隐私 (DP) 的形式化定义。一个随机化机制 $\\mathcal{M}$ 是 $(\\epsilon, \\delta)$-差分隐私的，如果对于所有相邻数据集对 $D$ 和 $D'$，以及对于 $\\mathcal{M}$ 输出空间的所有子集 $S$，以下不等式成立：\n$$\n\\Pr[\\mathcal{M}(D) \\in S] \\le \\exp(\\epsilon) \\Pr[\\mathcal{M}(D') \\in S] + \\delta\n$$\n问题将相邻关系指定为有界（替换一个）邻接关系：两个大小为 $m$ 的数据集 $D$ 和 $D'$ 是相邻的，如果 $D'$ 可以通过替换 $D$ 中的一条数据记录而得到。\n\n机制的隐私性是通过添加与所计算函数的敏感度成比例的噪声来保证的。向量值函数 $f$ 的 $\\ell_2$-敏感度定义为在任何一对相邻数据集上评估时，函数输出范数的最大变化：\n$$\n\\Delta_2(f) = \\sup_{D, D'} \\|f(D) - f(D')\\|_2\n$$\n其中上确界取自所有相邻数据集 $D, D'$。\n\n在添加噪声之前，医院计算的函数是逐样本裁剪梯度之和。设本地数据集为 $D = \\{x_1, x_2, \\ldots, x_m\\}$，并设 $g(x_i, \\theta)$ 为样本 $x_i$ 的损失函数关于模型参数 $\\theta$ 的梯度。为简单起见，我们将其表示为 $g_i$。医院首先将每个梯度裁剪到最大 $\\ell_2$ 范数 $C$：\n$$\n\\bar{g}_i = \\frac{g_i}{\\max\\left(1, \\frac{\\|g_i\\|_2}{C}\\right)}\n$$\n此操作确保对所有 $i$ 都有 $\\|\\bar{g}_i\\|_2 \\le C$。我们必须确定其敏感度的函数是这些裁剪后梯度的总和：\n$$\nS(D) = \\sum_{i=1}^{m} \\bar{g}_i\n$$\n为了推导 $S(D)$ 的 $\\ell_2$-敏感度（我们将其表示为 $\\Delta_{\\mathrm{sum}}$），我们考虑两个相邻的数据集 $D = \\{x_1, \\ldots, x_j, \\ldots, x_m\\}$ 和 $D' = \\{x_1, \\ldots, x'_j, \\ldots, x_m\\}$，它们仅在第 $j$ 条记录上不同。函数输出的差异是：\n$$\nS(D) - S(D') = \\left(\\sum_{i=1}^{m} \\bar{g}(x_i)\\right) - \\left(\\left(\\sum_{i=1, i \\ne j}^{m} \\bar{g}(x_i)\\right) + \\bar{g}(x'_j)\\right) = \\bar{g}(x_j) - \\bar{g}(x'_j)\n$$\n我们取这个差值的 $\\ell_2$ 范数，并应用三角不等式：\n$$\n\\|S(D) - S(D')\\|_2 = \\|\\bar{g}(x_j) - \\bar{g}(x'_j)\\|_2 \\le \\|\\bar{g}(x_j)\\|_2 + \\|\\bar{g}(x'_j)\\|_2\n$$\n根据裁剪操作的定义，任何裁剪后梯度的范数都以 $C$ 为界。因此，$\\|\\bar{g}(x_j)\\|_2 \\le C$ 且 $\\|\\bar{g}(x'_j)\\|_2 \\le C$。代入这些界限，我们得到：\n$$\n\\|S(D) - S(D')\\|_2 \\le C + C = 2C\n$$\n这个不等式对任何一对相邻数据集都成立。敏感度 $\\Delta_{\\mathrm{sum}}$ 是这个量的上确界，即 $2C$。\n$$\n\\Delta_{\\mathrm{sum}} = \\sup_{D, D'} \\|S(D) - S(D')\\|_2 = 2C\n$$\n这个推导从数学上证明了逐样本裁剪为何至关重要：它限制了任何单个数据点的贡献，从而使总和的敏感度变为有限值，并且独立于数据本身。如果没有裁剪，梯度的范数可能会任意大，导致无界的敏感度，从而无法提供隐私保证。\n\n医院的机制 $\\mathcal{M}(D)$ 涉及在发布前向此总和添加高斯噪声。发布的量为 $\\tilde{S}(D) = S(D) + Z$，其中 $Z$ 是一个随机噪声向量。问题陈述指出，噪声取自一个独立的、每坐标标准差为 $s = \\sigma C$ 的高斯分布。这对应于一个噪声向量 $Z \\sim \\mathcal{N}(0, s^2 I) = \\mathcal{N}(0, (\\sigma C)^2 I)$，其中 $I$ 是单位矩阵。\n\n对于 $\\epsilon \\in (0,1)$，我们得到了高斯机制实现 $(\\epsilon, \\delta)$-DP 的一个充分条件：噪声的每坐标标准差 $s$ 必须满足\n$$\ns \\ge \\frac{\\sqrt{2 \\ln(1.25/\\delta)} \\,\\Delta}{\\epsilon}\n$$\n其中 $\\Delta$ 是函数的 $\\ell_2$-敏感度。在我们的例子中，函数是 $S(D)$，其敏感度为 $\\Delta = \\Delta_{\\mathrm{sum}} = 2C$，噪声参数为 $s = \\sigma C$。将这些代入不等式：\n$$\n\\sigma C \\ge \\frac{\\sqrt{2 \\ln(1.25/\\delta)} \\,(2C)}{\\epsilon}\n$$\n问题要求 $\\epsilon$ 的一个上界。这个术语有点不寻常；通常，人们会计算给定机制所能达到的最紧（最小）的 $\\epsilon$。这可以通过将充分条件视为等式来找到，该等式定义了隐私保证的边界。我们重新整理表达式以求解 $\\epsilon$。假设 $C > 0$ 且 $\\sigma > 0$：\n$$\n\\epsilon \\sigma C \\ge 2C \\sqrt{2 \\ln(1.25/\\delta)}\n$$\n$$\n\\epsilon \\ge \\frac{2C \\sqrt{2 \\ln(1.25/\\delta)}}{\\sigma C}\n$$\n$$\n\\epsilon \\ge \\frac{2 \\sqrt{2 \\ln(1.25/\\delta)}}{\\sigma}\n$$\n右侧的表达式代表了医院发布所产生的隐私损失 $\\epsilon$。为了数学上的严谨性，我们将 1.25 表示为分数 $\\frac{5}{4}$。因此，该机制满足 $(\\epsilon, \\delta)$-DP 的最紧的 $\\epsilon$ 值为：\n$$\n\\epsilon = \\frac{2 \\sqrt{2 \\ln\\left(\\frac{5}{4\\delta}\\right)}}{\\sigma}\n$$\n这就是所要求的值。条件 $\\epsilon \\in (0,1)$ 意味着要使此结果有效，必须满足 $\\frac{2 \\sqrt{2 \\ln(5/(4\\delta))}}{\\sigma}  1$。\n\n最后，我们讨论为什么聚合器将接收到的带噪总和除以数据集大小 $m$ 不会改变隐私参数 $(\\epsilon, \\delta)$。医院发布的量是 $\\tilde{S}(D)$。聚合器计算一个新的量 $\\frac{1}{m}\\tilde{S}(D)$。这个计算是在隐私机制 $\\mathcal{M}(D) = \\tilde{S}(D)$ 的输出上执行的一种数据处理。差分隐私的一个基本性质是其对后处理的免疫性。\n后处理定理指出，如果一个机制 $\\mathcal{M}$ 是 $(\\epsilon, \\delta)$-差分隐私的，那么对于任何任意（随机或确定性）函数 $f$，复合机制 $f(\\mathcal{M})$ 也是 $(\\epsilon, \\delta)$-差分隐私的。在本例中，函数是 $f(z) = z/m$。由于聚合器是诚实但好奇的，并且无法访问原始数据 $D$，所以这个除法纯粹是对已经私有化的输出进行的一个后处理步骤。因此，最终的平均梯度更新与医院发布的带噪总和具有完全相同的隐私保证 $(\\epsilon, \\delta)$。隐私损失已经产生，不会因为对输出的后续计算而放大或减小。",
            "answer": "$$\n\\boxed{\\frac{2\\sqrt{2\\ln\\left(\\frac{1.25}{\\delta}\\right)}}{\\sigma}}\n$$"
        },
        {
            "introduction": "在理论推导之后，下一步是将其应用于具体的计算场景。本练习将理论付诸实践，要求你为一个联邦学习网络中的特定客户端计算其$L_2$-敏感度。这个计算过程能让你直观地看到，在联邦平均算法中，一个客户端的敏感度如何由其数据量权重和梯度裁剪范数$C$共同决定，而这直接关系到为保护该客户端隐私所需添加的噪声量。",
            "id": "4339375",
            "problem": "一个由四家基因组学实验室组成的联合体通过联邦学习（FL）合作，在精准医疗和基因组诊断的背景下，训练一个用于罕见变异致病性的分类器。每个机构训练一个本地模型，并生成一个本地参数更新向量 $u_k \\in \\mathbb{R}^{3}$，其中 $k \\in \\{1,2,3,4\\}$ 是机构的索引。为实现保护隐私的数据共享，该系统采用安全聚合，并在全局聚合中使用数据集大小加权。设 $n_k$ 表示机构 $k$ 使用的基因组数量， $n = \\sum_{k=1}^{4} n_k$ 为所有机构的基因组总数。全局模型更新是通过计算客户端更新的数据集大小加权平均值得到的，使用的权重为 $\\alpha_k = \\frac{n_k}{n}$。\n\n该联合体从差分隐私（DP）的角度，在由 $L_2$ 范数诱导的平方欧几里得几何下，追踪聚合规则对单个异常更新的敏感度。对于客户端级别的邻近性（即替换某个客户端的整个更新，而其他客户端保持不变），在聚合之前，本地更新会经过范数裁剪，以确保对于一个固定的裁剪半径 $C  0$，有 $\\|u_k\\|_{2} \\leq C$。\n\n使用以下来自一个真实的联邦学习训练轮次的数据：\n- 客户端数据集大小：$n_1 = 1200$， $n_2 = 2200$， $n_3 = 1800$， $n_4 = 800$，因此 $n = 6000$。\n- 本地更新：$u_1 = (0.6, -0.2, 0.1)$， $u_2 = (-0.5, 0.3, 0.0)$， $u_3 = (0.2, 0.1, -0.4)$， $u_4 = (0.0, -0.1, 0.2)$。\n- 裁剪半径：$C = 3$。\n\n任务：\n1. 计算全局更新 $u = \\sum_{k=1}^{4} \\alpha_k u_k$。\n2. 对于客户端级别的邻近性和 $L_2$ 范数裁剪，推导聚合规则在将客户端2的裁剪后更新替换为另一个同样满足范数约束 $\\|u_2\\|_{2} \\leq C$ 的裁剪后更新时，其最坏情况下的 $L_2$ 敏感度。\n\n仅将客户端2的最坏情况下的 $L_2$ 敏感度作为您的最终数值答案。无需四舍五入，最终报告的值不带单位。",
            "solution": "该问题被评估为有效。它科学地基于联邦学习（FL）和差分隐私（DP）的原则，问题定义明确，具有唯一且有意义的解和目标，并包含解决此问题所需的所有信息。\n\n问题要求完成两个任务，但最终答案只需要第二个任务的结果。为了提供一个完整的解答，我们将依次处理这两个任务。\n\n首先，我们整理给定的数据。\n合作机构的数量为 $4$。\n每个机构 $k \\in \\{1, 2, 3, 4\\}$ 的数据集大小为：\n$n_1 = 1200$\n$n_2 = 2200$\n$n_3 = 1800$\n$n_4 = 800$\n\n基因组总数为 $n = \\sum_{k=1}^{4} n_k = 1200 + 2200 + 1800 + 800 = 6000$。\n\n聚合的权重为 $\\alpha_k = \\frac{n_k}{n}$。\n$\\alpha_1 = \\frac{1200}{6000} = \\frac{12}{60} = \\frac{1}{5}$\n$\\alpha_2 = \\frac{2200}{6000} = \\frac{22}{60} = \\frac{11}{30}$\n$\\alpha_3 = \\frac{1800}{6000} = \\frac{18}{60} = \\frac{3}{10}$\n$\\alpha_4 = \\frac{800}{6000} = \\frac{8}{60} = \\frac{2}{15}$\n快速检查可以确认 $\\sum_{k=1}^{4} \\alpha_k = \\frac{1}{5} + \\frac{11}{30} + \\frac{3}{10} + \\frac{2}{15} = \\frac{6}{30} + \\frac{11}{30} + \\frac{9}{30} + \\frac{4}{30} = \\frac{30}{30} = 1$。\n\n本地更新向量如下：\n$u_1 = (0.6, -0.2, 0.1)$\n$u_2 = (-0.5, 0.3, 0.0)$\n$u_3 = (0.2, 0.1, -0.4)$\n$u_4 = (0.0, -0.1, 0.2)$\n\n更新向量会以半径 $C = 3$ 进行范数裁剪，这意味着用于聚合的每个更新 $u_k$ 都必须满足 $\\|u_k\\|_2 \\le 3$。我们来验证给定的更新是否满足此条件。\n$\\|u_1\\|_2 = \\sqrt{0.6^2 + (-0.2)^2 + 0.1^2} = \\sqrt{0.36 + 0.04 + 0.01} = \\sqrt{0.41}  3$。\n$\\|u_2\\|_2 = \\sqrt{(-0.5)^2 + 0.3^2 + 0.0^2} = \\sqrt{0.25 + 0.09 + 0.0} = \\sqrt{0.34}  3$。\n$\\|u_3\\|_2 = \\sqrt{0.2^2 + 0.1^2 + (-0.4)^2} = \\sqrt{0.04 + 0.01 + 0.16} = \\sqrt{0.21}  3$。\n$\\|u_4\\|_2 = \\sqrt{0.0^2 + (-0.1)^2 + 0.2^2} = \\sqrt{0.01 + 0.04} = \\sqrt{0.05}  3$。\n由于所有本地更新的 $L_2$ 范数都小于裁剪半径 $C=3$，因此不对这些特定的向量进行裁剪。\n\n任务1：计算全局更新 $u = \\sum_{k=1}^{4} \\alpha_k u_k$。\n$u = \\alpha_1 u_1 + \\alpha_2 u_2 + \\alpha_3 u_3 + \\alpha_4 u_4$\n$u = \\frac{1}{5} u_1 + \\frac{11}{30} u_2 + \\frac{3}{10} u_3 + \\frac{2}{15} u_4$\n为了简化计算，我们使用公分母 $30$：\n$u = \\frac{1}{30} (6 u_1 + 11 u_2 + 9 u_3 + 4 u_4)$\n$6 u_1 = 6(0.6, -0.2, 0.1) = (3.6, -1.2, 0.6)$\n$11 u_2 = 11(-0.5, 0.3, 0.0) = (-5.5, 3.3, 0.0)$\n$9 u_3 = 9(0.2, 0.1, -0.4) = (1.8, 0.9, -3.6)$\n$4 u_4 = 4(0.0, -0.1, 0.2) = (0.0, -0.4, 0.8)$\n这些向量的和为：\n$x$分量：$3.6 - 5.5 + 1.8 + 0.0 = -0.1$\n$y$分量：$-1.2 + 3.3 + 0.9 - 0.4 = 2.6$\n$z$分量：$0.6 + 0.0 - 3.6 + 0.8 = -2.2$\n所以，和向量为 $(-0.1, 2.6, -2.2)$。\n全局更新为 $u = \\frac{1}{30}(-0.1, 2.6, -2.2) = (-\\frac{0.1}{30}, \\frac{2.6}{30}, -\\frac{2.2}{30}) = (-\\frac{1}{300}, \\frac{26}{300}, -\\frac{22}{300}) = (-\\frac{1}{300}, \\frac{13}{150}, -\\frac{11}{150})$。\n\n任务2：推导聚合规则关于替换客户端2的更新的最坏情况下的 $L_2$ 敏感度。\n聚合函数为 $f(u_1, u_2, u_3, u_4) = \\sum_{k=1}^{4} \\alpha_k u_k$。\n$L_2$ 敏感度是根据客户端级别的邻近性定义的。对于客户端2，这意味着我们考虑两组输入，这两组输入除了来自客户端2的更新不同外，其他完全相同。设这两组更新元组为 $U = (u_1, u_2, u_3, u_4)$ 和 $U' = (u_1, u_2', u_3, u_4)$。只要更新向量 $u_2$ 和 $u_2'$ 满足范数裁剪约束，即 $\\|u_2\\|_2 \\leq C$ 和 $\\|u_2'\\|_2 \\leq C$，它们就可以是 $\\mathbb{R}^3$ 中的任意向量。\n\n客户端2的 $L_2$ 敏感度，记为 $\\Delta_2 f_2$，是在所有此类邻近输入集上，输出 $f$ 的 $L_2$ 范数的最大可能变化量：\n$$ \\Delta_2 f_2 = \\max_{U, U' \\text{ adjacent on client 2}} \\| f(U) - f(U') \\|_2 $$\n我们来计算差值 $f(U) - f(U')$：\n$$ f(U) - f(U') = \\left(\\sum_{k=1}^4 \\alpha_k u_k\\right) - \\left(\\alpha_1 u_1 + \\alpha_2 u_2' + \\alpha_3 u_3 + \\alpha_4 u_4\\right) $$\n$$ f(U) - f(U') = \\alpha_2 u_2 - \\alpha_2 u_2' = \\alpha_2(u_2 - u_2') $$\n现在，我们取这个差值的 $L_2$ 范数：\n$$ \\|f(U) - f(U')\\|_2 = \\|\\alpha_2(u_2 - u_2')\\|_2 = |\\alpha_2| \\|u_2 - u_2'\\|_2 $$\n由于 $\\alpha_2 = \\frac{n_2}{n}$ 是非负的，所以 $|\\alpha_2| = \\alpha_2$。\n$$ \\|f(U) - f(U')\\|_2 = \\alpha_2 \\|u_2 - u_2'\\|_2 $$\n为了找到敏感度，我们必须在所有有效的 $u_2$ 和 $u_2'$ 选择上最大化这个量：\n$$ \\Delta_2 f_2 = \\max_{\\substack{\\|u_2\\|_2 \\leq C \\\\ \\|u_2'\\|_2 \\leq C}} \\alpha_2 \\|u_2 - u_2'\\|_2 = \\alpha_2 \\left( \\max_{\\substack{\\|u_2\\|_2 \\leq C \\\\ \\|u_2'\\|_2 \\leq C}} \\|u_2 - u_2'\\|_2 \\right) $$\n项 $\\max \\|u_2 - u_2'\\|_2$ 表示在以原点为中心、半径为 $C$ 的球内任意两点之间的最大欧几里得距离。这个最大距离是球的直径，即 $2C$。当 $u_2$ 和 $u_2'$ 位于球的表面且方向相反时，可以达到这个最大值，例如，$u_2 = v$ 和 $u_2' = -v$ 其中 $\\|v\\|_2 = C$。在这种情况下，$\\|u_2 - u_2'\\|_2 = \\|v - (-v)\\|_2 = \\|2v\\|_2 = 2\\|v\\|_2 = 2C$。\n\n因此，关于客户端2的最坏情况下的 $L_2$ 敏感度是：\n$$ \\Delta_2 f_2 = \\alpha_2 (2C) $$\n关键要注意的是，这个敏感度不依赖于问题中提供的实际更新向量，而只取决于客户端在聚合中的权重和裁剪界限。\n\n现在我们代入给定的数值：\n$\\alpha_2 = \\frac{11}{30}$\n$C = 3$\n\n$$ \\Delta_2 f_2 = \\frac{11}{30} \\times (2 \\times 3) = \\frac{11}{30} \\times 6 = \\frac{66}{30} = \\frac{11}{5} $$\n客户端2的最坏情况下的 $L_2$ 敏感度是 $\\frac{11}{5}$。",
            "answer": "$$\n\\boxed{\\frac{11}{5}}\n$$"
        },
        {
            "introduction": "隐私保护技术并非没有代价，其实施会带来实际的系统开销。本练习将视角从算法层面的差分隐私转向协议层面的安全聚合（Secure Aggregation），并聚焦于其对系统性能的影响。通过分析通信复杂度和轮次时长，你将学会如何评估隐私保护联邦学习系统在真实网络环境下的可扩展性和可行性，这对于设计能够处理大规模基因组数据的实用系统至关重要。",
            "id": "4339316",
            "problem": "在一个用于精准医疗和基因组诊断的跨孤岛联邦学习 (FL) 设置中，假设有 $K$ 家医院参与安全聚合 (SA) 以保护患者级别的梯度。考虑 SA 是通过使用椭圆曲线迪菲-赫尔曼 (Elliptic-Curve Diffie–Hellman, ECDH) 建立的成对掩码种子来实现的。设全局模型有效载荷的大小为 $S_{m} = 200 \\times 10^{6}$ 字节，掩码上传使用一种密文扩展因子为 $\\alpha = 2.2$ 的加密方案，因此每家医院的掩码更新大小为 $S_{u} = \\alpha S_{m}$ 字节。在 SA 设置阶段，每家医院都与所有其他医院执行成对的 ECDH 密钥交换，向每个对等方发送一条大小为 $s_{k} = 64 \\times 10^{3}$ 字节的消息。假设医院链路是对称的，带宽为 $B_{h} = 200 \\times 10^{6}$ 比特/秒，中央服务器的链路也是对称的，带宽为 $B_{s} = 10 \\times 10^{9}$ 比特/秒。所有链路都是全双工的，在每个阶段，传输都并行进行，且该阶段在其瓶颈链路完成传输时结束。\n\n从第一性原理出发——具体来说，通过容量为 $B$ 比特/秒的链路传输 $x$ 比特数据的通信时间为 $t = x/B$——推导 (i) 系统范围内的每轮通信复杂度（以比特为单位），(ii) 在此设置中 SA 的逻辑通信阶段数量（轮次复杂度），以及 (iii) 总轮次持续时间 $T_{\\text{round}}(K)$，其为广播阶段、SA 握手阶段以及掩码上传和聚合阶段的持续时间之和，其中每个阶段的持续时间取其竞争瓶颈中的最大值。然后，在时间预算为 $T_{\\text{budget}} = 180$ 秒的情况下，确定使得 $T_{\\text{round}}(K) \\leq T_{\\text{budget}}$ 成立的最大整数 $K$。\n\n将最终答案表示为一个不带单位的整数。如果需要四舍五入，则保留三位有效数字。仅在与计算相关时使用弧度或度；角度在此处不相关。",
            "solution": "该问题被验证为具有科学依据、良定、客观且自洽的。所有必要信息均已提供，可基于通信网络分析的基本原理推导出解决方案。\n\n求解过程首先推导通信复杂度和轮次持续时间关于医院数量 $K$ 的表达式。然后，利用这些表达式求解满足给定时间预算的最大 $K$ 值。所有数据大小必须从字节转换为比特，使用 1 字节 = 8 比特的转换因子。\n\n提供的参数如下：\n- 参与医院数量: $K$\n- 全局模型有效载荷大小: $S_{m} = 200 \\times 10^{6}$ 字节\n- 密文扩展因子: $\\alpha = 2.2$\n- 成对密钥交换消息大小: $s_{k} = 64 \\times 10^{3}$ 字节\n- 医院链路带宽: $B_{h} = 200 \\times 10^{6}$ 比特/秒\n- 服务器链路带宽: $B_{s} = 10 \\times 10^{9}$ 比特/秒\n- 时间预算: $T_{\\text{budget}} = 180$ 秒\n\n首先，我们将所有数据大小转换为比特：\n- 模型大小（比特）: $S_{m}^{\\text{bits}} = S_{m} \\times 8 = (200 \\times 10^{6}) \\times 8 = 1.6 \\times 10^{9}$ 比特。\n- 掩码更新大小（比特）: $S_{u}^{\\text{bits}} = \\alpha S_{m} \\times 8 = 2.2 \\times (1.6 \\times 10^{9}) = 3.52 \\times 10^{9}$ 比特。\n- 密钥消息大小（比特）: $s_{k}^{\\text{bits}} = s_{k} \\times 8 = (64 \\times 10^{3}) \\times 8 = 5.12 \\times 10^{5}$ 比特。\n\n(i) 系统范围内的每轮通信复杂度（以比特为单位），$C_{\\text{total}}(K)$。\n总通信量是所有三个阶段传输的比特数之和：\n1.  广播阶段：服务器向 $K$ 家医院中的每一家发送大小为 $S_{m}^{\\text{bits}}$ 的模型。发送的总比特数为 $K \\times S_{m}^{\\text{bits}}$。\n2.  SA 握手阶段：$K$ 家医院中的每一家都与另外 $K-1$ 家医院进行成对密钥交换。单条消息的大小为 $s_{k}^{\\text{bits}}$。消息总数为 $K(K-1)$。发送的总比特数为 $K(K-1) \\times s_{k}^{\\text{bits}}$。\n3.  掩码上传阶段：$K$ 家医院中的每一家都向服务器发送大小为 $S_{u}^{\\text{bits}}$ 的掩码更新。发送的总比特数为 $K \\times S_{u}^{\\text{bits}}$。\n\n总通信复杂度是这些贡献的总和：\n$$C_{\\text{total}}(K) = K \\cdot S_{m}^{\\text{bits}} + K(K-1) \\cdot s_{k}^{\\text{bits}} + K \\cdot S_{u}^{\\text{bits}}$$\n$$C_{\\text{total}}(K) = K (S_{m}^{\\text{bits}} + (K-1)s_{k}^{\\text{bits}} + \\alpha S_{m}^{\\text{bits}})$$\n$$C_{\\text{total}}(K) = K [(1+\\alpha)S_{m}^{\\text{bits}} + (K-1)s_{k}^{\\text{bits}}]$$\n\n(ii) 逻辑通信阶段的数量。\n问题陈述描述了三个不同通信阶段的序列：\n1.  服务器向所有医院广播全局模型。\n2.  医院执行成对的安全聚合 (SA) 握手。\n3.  医院将其掩码更新上传到服务器进行聚合。\n因此，每轮有 $3$ 个逻辑通信阶段。\n\n(iii) 总轮次持续时间 $T_{\\text{round}}(K)$。\n总持续时间是三个阶段的持续时间之和，$T_{\\text{round}}(K) = T_{1}(K) + T_{2}(K) + T_{3}(K)$。每个阶段的持续时间由其通信瓶颈决定。\n\n-   **阶段 1：广播持续时间, $T_{1}(K)$**\n    服务器向 $K$ 家医院发送 $S_{m}^{\\text{bits}}$。服务器的上行链路必须处理总共 $K \\times S_{m}^{\\text{bits}}$ 的流量。这需要时间 $t_{\\text{server}} = \\frac{K \\cdot S_{m}^{\\text{bits}}}{B_{s}}$。每家医院的下行链路必须接收 $S_{m}^{\\text{bits}}$ 的流量，这需要时间 $t_{\\text{hospital}} = \\frac{S_{m}^{\\text{bits}}}{B_{h}}$。该阶段在所有传输完成后结束，因此其持续时间是这些时间中的最大值。\n    $$T_{1}(K) = \\max\\left(\\frac{K \\cdot S_{m}^{\\text{bits}}}{B_{s}}, \\frac{S_{m}^{\\text{bits}}}{B_{h}}\\right)$$\n\n-   **阶段 2：SA 握手持续时间, $T_{2}(K)$**\n    此阶段仅涉及医院之间的点对点通信。每家医院发送 $K-1$ 条大小为 $s_{k}^{\\text{bits}}$ 的消息。由于链路是全双工的，我们考虑出向流量的瓶颈。单个医院发送的总数据量为 $(K-1)s_{k}^{\\text{bits}}$。所需时间由医院的链路容量 $B_{h}$ 决定。由于所有医院都并行执行此操作，因此持续时间为：\n    $$T_{2}(K) = \\frac{(K-1) \\cdot s_{k}^{\\text{bits}}}{B_{h}}$$\n\n-   **阶段 3：掩码上传持续时间, $T_{3}(K)$**\n    $K$ 家医院各自向服务器上传 $S_{u}^{\\text{bits}}$。每家医院的上行链路需要时间 $t_{\\text{hospital}} = \\frac{S_{u}^{\\text{bits}}}{B_{h}}$。服务器的下行链路必须接收总共 $K \\cdot S_{u}^{\\text{bits}}$ 的流量，这需要时间 $t_{\\text{server}} = \\frac{K \\cdot S_{u}^{\\text{bits}}}{B_{s}}$。该阶段的持续时间是这些时间中的最大值。\n    $$T_{3}(K) = \\max\\left(\\frac{S_{u}^{\\text{bits}}}{B_{h}}, \\frac{K \\cdot S_{u}^{\\text{bits}}}{B_{s}}\\right) = \\max\\left(\\frac{\\alpha S_{m}^{\\text{bits}}}{B_{h}}, \\frac{K \\alpha S_{m}^{\\text{bits}}}{B_{s}}\\right)$$\n\n总轮次持续时间为：\n$$T_{\\text{round}}(K) = \\max\\left(\\frac{K S_{m}^{\\text{bits}}}{B_{s}}, \\frac{S_{m}^{\\text{bits}}}{B_{h}}\\right) + \\frac{(K-1) s_{k}^{\\text{bits}}}{B_{h}} + \\max\\left(\\frac{\\alpha S_{m}^{\\text{bits}}}{B_{h}}, \\frac{K \\alpha S_{m}^{\\text{bits}}}{B_{s}}\\right)$$\n\n(iv) 在给定时间预算下的最大整数 $K$。\n我们需要找到满足 $T_{\\text{round}}(K) \\leq T_{\\text{budget}}$ 的最大整数 $K$，其中 $T_{\\text{budget}} = 180$ 秒。我们将数值代入 $T_{\\text{round}}(K)$ 的表达式中。\n\n-   对于 $T_{1}(K)$:\n    -   $\\frac{K S_{m}^{\\text{bits}}}{B_{s}} = \\frac{K \\times (1.6 \\times 10^{9})}{10 \\times 10^{9}} = 0.16 K$ 秒。\n    -   $\\frac{S_{m}^{\\text{bits}}}{B_{h}} = \\frac{1.6 \\times 10^{9}}{200 \\times 10^{6}} = 8$ 秒。\n    -   $T_{1}(K) = \\max(0.16 K, 8)$。交叉点发生在 $0.16K = 8$ 时，即 $K = 50$。\n\n-   对于 $T_{2}(K)$:\n    -   $T_{2}(K) = \\frac{(K-1) \\times (5.12 \\times 10^{5})}{200 \\times 10^{6}} = \\frac{5.12 \\times 10^{5}}{2 \\times 10^{8}}(K-1) = 0.00256(K-1)$ 秒。\n\n-   对于 $T_{3}(K)$:\n    -   $\\frac{\\alpha S_{m}^{\\text{bits}}}{B_{h}} = \\frac{3.52 \\times 10^{9}}{200 \\times 10^{6}} = 17.6$ 秒。\n    -   $\\frac{K \\alpha S_{m}^{\\text{bits}}}{B_{s}} = \\frac{K \\times (3.52 \\times 10^{9})}{10 \\times 10^{9}} = 0.352 K$ 秒。\n    -   $T_{3}(K) = \\max(17.6, 0.352 K)$。交叉点发生在 $0.352K = 17.6$ 时，即 $K = 50$。\n\n总持续时间 $T_{\\text{round}}(K)$ 有两种情况，取决于 $K \\leq 50$ 还是 $K  50$。\n\n情况 1: $K \\leq 50$。\n$$T_{\\text{round}}(K) = 8 + 0.00256(K-1) + 17.6 = 25.6 + 0.00256K - 0.00256 = 25.59744 + 0.00256K$$\n当 $K=50$ 时，$T_{\\text{round}}(50) = 25.59744 + 0.00256 \\times 50 = 25.72544$ 秒。这远低于 $180$ 秒的预算，因此最大 $K$ 值必须大于 $50$。\n\n情况 2: $K  50$。\n在这种情况下，两个 $\\max$ 函数都由 $K$ 的线性项决定。\n$$T_{\\text{round}}(K) = 0.16K + 0.00256(K-1) + 0.352K$$\n$$T_{\\text{round}}(K) = 0.16K + 0.00256K - 0.00256 + 0.352K$$\n$$T_{\\text{round}}(K) = (0.16 + 0.00256 + 0.352)K - 0.00256$$\n$$T_{\\text{round}}(K) = 0.51456K - 0.00256$$\n\n现在，我们求解不等式 $T_{\\text{round}}(K) \\leq 180$：\n$$0.51456K - 0.00256 \\leq 180$$\n$$0.51456K \\leq 180.00256$$\n$$K \\leq \\frac{180.00256}{0.51456}$$\n$$K \\leq 349.82...$$\n\n由于 $K$ 必须是整数，因此 $K$ 的最大值为 $349$。这个值与我们 $K  50$ 的假设是一致的。\n为了确认，我们可以检查 $K=349$ 时的时间：\n$T_{\\text{round}}(349) = 0.51456(349) - 0.00256 = 179.58144 - 0.00256 = 179.57888$ 秒，满足 $\\leq 180$ 秒。\n对于 $K=350$：\n$T_{\\text{round}}(350) = 0.51456(350) - 0.00256 = 180.096 - 0.00256 = 180.09344$ 秒，超过了 $180$ 秒。\n\n因此，最大整数医院数量为 $349$。",
            "answer": "$$\n\\boxed{349}\n$$"
        }
    ]
}