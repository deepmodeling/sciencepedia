{
    "hands_on_practices": [
        {
            "introduction": "在精准医学临床试验中，准确地将患者分配到与其生物标志物状态相匹配的治疗组是试验成功的基石。尤其是在伞式试验（umbrella trial）中，一个核心的诊断测试被用来将具有特定组织学癌症类型的患者分配到不同的靶向治疗臂。此练习  将指导您应用贝叶斯定理，以评估一个假设的诊断分析的性能，计算其阳性预测值（PPV）和阴性预测值（NPV），并量化因诊断错误而导致的患者错配风险。这个实践能帮助您深入理解生物标志物患病率如何影响测试的临床效用，以及这对试验设计和解读的实际意义。",
            "id": "4326317",
            "problem": "精准肿瘤学中的一项伞式临床试验使用中心化基因组诊断，将单一组织学癌症类型的患者分配到由生物标志物指导的治疗组中。生物标志物 $B$ 识别一种可靶向的变异。新筛查人群的生物标志物患病率为 $p = 0.05$。该检测的灵敏度（真阳性率）为 $0.92$，特异性（真阴性率）为 $0.99$。令 $n = 200$ 表示为分配治疗组而连续筛查的患者数量。\n\n仅使用灵敏度、特异性和贝叶斯定理的定义，并假设患者之间的结果是独立的伯努利试验，推导该检测对 $B$ 的阳性预测值 (PPV) 和阴性预测值 (NPV) 的表达式（用 $p$、灵敏度和特异性表示），然后根据给定的参数值进行计算。将“错误分配的患者”定义为：尽管实际不携带 $B$ 但被分配到生物标志物阳性组的筛查患者（假阳性），或尽管实际携带 $B$ 但被拒绝分配到生物标志物阳性组的筛查患者（假阴性）。在独立性假设下，计算 $n = 200$ 的队列中错误分配患者的期望数量。\n\n将所有数值答案四舍五入到四位有效数字。将 PPV 和 NPV 表示为无单位的小数。将错误分配的期望数量以患者人数表示。",
            "solution": "该问题是有效的，因为它在科学上基于标准的生物统计学原理，问题陈述清晰且信息充分，可得出唯一解，并且陈述客观。\n\n首先，我们定义相关事件，并将给定参数转化为概率符号。\n令 $D^+$ 表示患者确实携带生物标志物 $B$ 的事件。\n令 $D^-$ 表示患者确实不携带生物标志物 $B$ 的事件。\n令 $T^+$ 表示检测结果为阳性的事件。\n令 $T^-$ 表示检测结果为阴性的事件。\n\n根据问题陈述，我们已知：\n生物标志物的患病率，$p = P(D^+) = 0.05$。\n患者不携带生物标志物的概率是 $P(D^-) = 1 - P(D^+) = 1 - p = 1 - 0.05 = 0.95$。\n检测的灵敏度，$\\text{sens} = P(T^+ | D^+) = 0.92$。这是真阳性率。\n检测的特异性，$\\text{spec} = P(T^- | D^-) = 0.99$。这是真阴性率。\n筛查的患者总数为 $n = 200$。\n\n根据这些定义，我们可以推导出错误检测结果的比率：\n假阳性率 (FPR) 是 $P(T^+ | D^-) = 1 - P(T^- | D^-) = 1 - \\text{spec} = 1 - 0.99 = 0.01$。\n假阴性率 (FNR) 是 $P(T^- | D^+) = 1 - P(T^+ | D^+) = 1 - \\text{sens} = 1 - 0.92 = 0.08$。\n\n### PPV 和 NPV 的推导\n阳性预测值 (PPV) 是指检测结果为阳性的患者确实携带该生物标志物的概率，即 $P(D^+ | T^+)$。根据贝叶斯定理：\n$$ \\text{PPV} = P(D^+ | T^+) = \\frac{P(T^+ | D^+) P(D^+)}{P(T^+)} $$\n分母 $P(T^+)$ 是检测结果为阳性的总概率，可以使用全概率公式计算：\n$$ P(T^+) = P(T^+ | D^+) P(D^+) + P(T^+ | D^-) P(D^-) $$\n代入符号定义：\n$$ P(T^+) = (\\text{sens}) \\cdot p + (1 - \\text{spec}) \\cdot (1 - p) $$\n因此，PPV 的表达式为：\n$$ \\text{PPV} = \\frac{(\\text{sens}) \\cdot p}{(\\text{sens}) \\cdot p + (1 - \\text{spec}) \\cdot (1 - p)} $$\n\n阴性预测值 (NPV) 是指检测结果为阴性的患者确实不携带该生物标志物的概率，即 $P(D^- | T^-)$。根据贝叶斯定理：\n$$ \\text{NPV} = P(D^- | T^-) = \\frac{P(T^- | D^-) P(D^-)}{P(T^-)} $$\n分母 $P(T^-)$ 是检测结果为阴性的总概率：\n$$ P(T^-) = P(T^- | D^-) P(D^-) + P(T^- | D^+) P(D^+) $$\n代入符号定义：\n$$ P(T^-) = (\\text{spec}) \\cdot (1 - p) + (1 - \\text{sens}) \\cdot p $$\n因此，NPV 的表达式为：\n$$ \\text{NPV} = \\frac{(\\text{spec}) \\cdot (1 - p)}{(\\text{spec}) \\cdot (1 - p) + (1 - \\text{sens}) \\cdot p} $$\n\n### PPV 和 NPV 的计算\n现在我们将给定的数值代入推导出的表达式中。\n对于 PPV：\n$$ \\text{PPV} = \\frac{0.92 \\cdot 0.05}{0.92 \\cdot 0.05 + (1 - 0.99) \\cdot (1 - 0.05)} = \\frac{0.046}{0.046 + 0.01 \\cdot 0.95} = \\frac{0.046}{0.046 + 0.0095} = \\frac{0.046}{0.0555} \\approx 0.8288288... $$\n四舍五入到四位有效数字，$\\text{PPV} = 0.8288$。\n\n对于 NPV：\n$$ \\text{NPV} = \\frac{0.99 \\cdot (1 - 0.05)}{0.99 \\cdot (1 - 0.05) + (1 - 0.92) \\cdot 0.05} = \\frac{0.99 \\cdot 0.95}{0.99 \\cdot 0.95 + 0.08 \\cdot 0.05} = \\frac{0.9405}{0.9405 + 0.004} = \\frac{0.9405}{0.9445} \\approx 0.9957649... $$\n四舍五入到四位有效数字，$\\text{NPV} = 0.9958$。\n\n### 错误分配患者的期望数量\n错误分配的患者被定义为假阳性 (FP) 或假阴性 (FN)。从筛查人群中随机选择一名患者被错误分配的概率 $P(\\text{misassigned})$，是这两个互斥事件的概率之和。\n\n假阳性的概率是不携带生物标志物且检测结果为阳性的联合概率，即 $P(D^- \\cap T^+)$。\n$$ P(\\text{FP}) = P(T^+ | D^-) P(D^-) = (1 - \\text{spec})(1 - p) $$\n假阴性的概率是携带生物标志物且检测结果为阴性的联合概率，即 $P(D^+ \\cap T^-)$。\n$$ P(\\text{FN}) = P(T^- | D^+) P(D^+) = (1 - \\text{sens}) p $$\n\n单个患者被错误分配的总概率是：\n$$ P(\\text{misassigned}) = P(\\text{FP}) + P(\\text{FN}) = (1 - \\text{spec})(1 - p) + (1 - \\text{sens}) p $$\n令 $M$ 为一个包含 $n$ 名患者的队列中错误分配患者数量的随机变量。由于假设每位患者的筛查结果是独立的伯努利试验，因此错误分配患者的期望数量 $E[M]$ 等于患者总数 $n$ 乘以单个患者被错误分配的概率。\n$$ E[M] = n \\cdot P(\\text{misassigned}) = n \\cdot \\left[ (1 - \\text{spec})(1 - p) + (1 - \\text{sens}) p \\right] $$\n\n代入给定的数值：\n$$ E[M] = 200 \\cdot \\left[ (1 - 0.99)(1 - 0.05) + (1 - 0.92)(0.05) \\right] $$\n$$ E[M] = 200 \\cdot \\left[ (0.01)(0.95) + (0.08)(0.05) \\right] $$\n$$ E[M] = 200 \\cdot \\left[ 0.0095 + 0.0040 \\right] $$\n$$ E[M] = 200 \\cdot 0.0135 = 2.7 $$\n四舍五入到四位有效数字，错误分配患者的期望数量为 $2.700$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.8288  0.9958  2.700 \\end{pmatrix}}$$"
        },
        {
            "introduction": "篮子试验（basket trial）通过在多个共享相同分子靶点的不同疾病队列中评估同一靶向疗法，极大地提高了研究效率，但也引入了统计学上的挑战。同时检验多个假设（即每个队列中的疗效）会增加犯第一类错误的概率，即错误地宣称无效疗法有效。为了确保研究结论的科学严谨性，必须控制全族错误率（Family-Wise Error Rate, FWER）。此练习  将带您实践两种经典的多重比较校正方法——Bonferroni 校正和 Holm 程序，计算校正后的 $p$ 值。通过这个过程，您将学会在多队列研究中做出稳健的统计推断，并理解在发现信号与控制假阳性之间的权衡。",
            "id": "4326251",
            "problem": "一项精准肿瘤学篮子试验评估了一种靶向疗法在$K=6$个共享预测性基因组生物标志物的组织学定义队列中的效果。每个队列针对一个共同的零假设，对一个二元临床终点进行单侧假设检验，产生的原始$p$值为$\\{0.002,\\,0.017,\\,0.04,\\,0.06,\\,0.21,\\,0.33\\}$。在篮子试验、伞式试验和平台试验等多队列设计中，控制全族错误率（FWER）对于确保科学有效性至关重要。从FWER的定义和并集界（Bonferroni不等式）出发，并基于序贯拒绝程序背后的一般降步原则，推导用于$K$个假设的Bonferroni程序和Holm程序的校正$p$值。\n\n然后，将这些推导应用于六个队列以计算：\n1. 每个队列的Bonferroni校正$p$值。\n2. 每个队列的Holm校正$p$值（排序后的结果必须映射回原始的队列索引，此处队列索引遵循给定$p$值的升序）。\n\n通过将校正$p$值与显著性水平$\\alpha=0.05$进行比较来解释决策。将每个决策数值化编码为1（“拒绝该队列的零假设”）和0（“不拒绝”）。将所有校正$p$值四舍五入至四位有效数字。以单行矩阵的形式报告最终答案，按以下顺序串联：\n- 队列$1$到$6$的Bonferroni校正$p$值，\n- 队列$1$到$6$的Holm校正$p$值，\n- Bonferroni决策（按队列顺序），\n- Holm决策（按队列顺序）。",
            "solution": "该问题是有效的，因为它在科学上基于成熟的临床试验统计理论，是适定的（提供了所有必要信息），并且陈述客观。\n\n设有$K$个零假设，$H_1, H_2, \\dots, H_K$，以及它们对应的原始$p$值，$p_1, p_2, \\dots, p_K$。多重检验程序的目标是控制全族错误率（FWER），即在一族$K$个检验中犯至少一次I类错误（错误地拒绝一个为真的零假设）的概率。如果一个程序满足$FWER \\le \\alpha$，则称该程序在水平$\\alpha$上控制了FWER。\n\n令$I_0$为对应于真零假设的索引集合。那么，\n$$FWER = P\\left(\\bigcup_{i \\in I_0} \\{\\text{reject } H_i\\}\\right)$$\n\n**Bonferroni程序的推导**\nBonferroni程序基于布尔不等式或并集界，该不等式指出对于任意事件集合$A_1, \\dots, A_K$：\n$$P\\left(\\bigcup_{i=1}^K A_i\\right) \\le \\sum_{i=1}^K P(A_i)$$\n将此应用于FWER的定义：\n$$FWER = P\\left(\\bigcup_{i \\in I_0} \\{\\text{reject } H_i\\}\\right) \\le \\sum_{i \\in I_0} P(\\text{reject } H_i)$$\n简单的Bonferroni方法在原始$p$值$p_i$小于或等于$\\alpha/K$时拒绝假设$H_i$。在真零假设$H_i$下，$p$值$p_i$服从均匀分布Uniform($0,1$)，因此$P(p_i \\le c) = c$。所以，$P(\\text{reject } H_i) = P(p_i \\le \\alpha/K) = \\alpha/K$。\n将此代入不等式中：\n$$FWER \\le \\sum_{i \\in I_0} \\frac{\\alpha}{K} = |I_0| \\frac{\\alpha}{K} \\le K \\frac{\\alpha}{K} = \\alpha$$\n这证明了该程序在水平$\\alpha$上控制了FWER。\n\nBonferroni校正$p$值，$\\tilde{p}_i^{\\text{Bonf}}$，是指假设$H_i$将被拒绝的最小总体显著性水平$\\alpha$。当$p_i \\le \\alpha/K$时发生拒绝，这等价于$K p_i \\le \\alpha$。因此，校正$p$值定义为：\n$$\\tilde{p}_i^{\\text{Bonf}} = \\min(K p_i, 1)$$\n该值上限为$1$，因为概率不能超过$1$。\n\n**Holm程序的推导**\nHolm程序是一种序贯降步方法，它比Bonferroni程序一致更优。它遵循以下步骤：\n1. 将原始$p$值从小到大排序：$p_{(1)} \\le p_{(2)} \\le \\dots \\le p_{(K)}$。令相应的假设为$H_{(1)}, H_{(2)}, \\dots, H_{(K)}$。\n2. 对于$j = 1, 2, \\dots, K$，将第$j$个有序$p$值$p_{(j)}$与序贯调整的显著性水平$\\alpha / (K - j + 1)$进行比较。\n3. 如果$p_{(1)} \\le \\alpha/K$，则拒绝$H_{(1)}$并进行到步骤$j=2$。否则，不拒绝所有假设并停止。\n4. 一般地，如果$H_{(1)}, \\dots, H_{(j-1)}$已被拒绝，则将$p_{(j)}$与$\\alpha/(K - j + 1)$进行比较。如果$p_{(j)} \\le \\alpha/(K - j + 1)$，则拒绝$H_{(j)}$并继续。否则，不拒绝$H_{(j)}$以及所有剩余的假设$H_{(j+1)}, \\dots, H_{(K)}$，并停止。\n\n第$j$个有序假设$H_{(j)}$的Holm校正$p$值$\\tilde{p}_{(j)}^{\\text{Holm}}$是从这个序贯过程中推导出来的。为了拒绝$H_{(j)}$，我们必须已经拒绝了所有在它之前的假设$H_{(i)}$（对于$i  j$）。这要求对于所有$i = 1, \\dots, j$，都有$p_{(i)} \\le \\alpha/(K - i + 1)$。这等价于要求对于所有$i = 1, \\dots, j$，都有$\\alpha \\ge (K - i + 1)p_{(i)}$。因此，为拒绝$H_{(j)}$而满足此条件的最小$\\alpha$值，是这些所需值的最大值。为确保校正$p$值是单调不减的，我们将第$j$个有序假设的校正$p$值定义为：\n$$\\tilde{p}_{(j)}^{\\text{Holm}} = \\min\\left(1, \\max_{i=1, \\dots, j} \\{(K-i+1)p_{(i)}\\}\\right)$$\n这可以递归计算：\n$\\tilde{p}_{(1)}^{\\text{Holm}} = \\min(1, K p_{(1)})$\n$\\tilde{p}_{(j)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(j-1)}^{\\text{Holm}}, (K-j+1)p_{(j)}))$ for $j > 1$。\n\n**应用于给定数据**\n队列（假设）的数量为$K=6$。原始$p$值已按升序提供：\n$p_{(1)} = 0.002$\n$p_{(2)} = 0.017$\n$p_{(3)} = 0.04$\n$p_{(4)} = 0.06$\n$p_{(5)} = 0.21$\n$p_{(6)} = 0.33$\n\n显著性水平为$\\alpha = 0.05$。\n\n**1. Bonferroni校正$p$值与决策**\n我们使用公式$\\tilde{p}_j^{\\text{Bonf}} = \\min(6 p_j, 1)$。\n$\\tilde{p}_1^{\\text{Bonf}} = \\min(6 \\times 0.002, 1) = \\min(0.012, 1) = 0.01200$\n$\\tilde{p}_2^{\\text{Bonf}} = \\min(6 \\times 0.017, 1) = \\min(0.102, 1) = 0.1020$\n$\\tilde{p}_3^{\\text{Bonf}} = \\min(6 \\times 0.04, 1) = \\min(0.24, 1) = 0.2400$\n$\\tilde{p}_4^{\\text{Bonf}} = \\min(6 \\times 0.06, 1) = \\min(0.36, 1) = 0.3600$\n$\\tilde{p}_5^{\\text{Bonf}} = \\min(6 \\times 0.21, 1) = \\min(1.26, 1) = 1.000$\n$\\tilde{p}_6^{\\text{Bonf}} = \\min(6 \\times 0.33, 1) = \\min(1.98, 1) = 1.000$\n\n决策：如果$\\tilde{p}_j^{\\text{Bonf}} \\le 0.05$，则拒绝$H_j$。\n- 队列 1: $0.01200 \\le 0.05 \\implies$ 拒绝 (1)\n- 队列 2: $0.1020 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 3: $0.2400 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 4: $0.3600 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 5: $1.000 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 6: $1.000 > 0.05 \\implies$ 不拒绝 (0)\n\n**2. Holm校正$p$值与决策**\n我们使用递归公式$\\tilde{p}_{(j)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(j-1)}^{\\text{Holm}}, (K-j+1)p_{(j)}))$。\n- 对于$j=1$: $\\tilde{p}_{(1)}^{\\text{Holm}} = \\min(1, (6-1+1)p_{(1)}) = \\min(1, 6 \\times 0.002) = 0.01200$。\n- 对于$j=2$: $\\tilde{p}_{(2)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(1)}^{\\text{Holm}}, (6-2+1)p_{(2)})) = \\min(1, \\max(0.012, 5 \\times 0.017)) = \\min(1, \\max(0.012, 0.085)) = 0.08500$。\n- 对于$j=3$: $\\tilde{p}_{(3)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(2)}^{\\text{Holm}}, (6-3+1)p_{(3)})) = \\min(1, \\max(0.085, 4 \\times 0.04)) = \\min(1, \\max(0.085, 0.16)) = 0.1600$。\n- 对于$j=4$: $\\tilde{p}_{(4)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(3)}^{\\text{Holm}}, (6-4+1)p_{(4)})) = \\min(1, \\max(0.16, 3 \\times 0.06)) = \\min(1, \\max(0.16, 0.18)) = 0.1800$。\n- 对于$j=5$: $\\tilde{p}_{(5)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(4)}^{\\text{Holm}}, (6-5+1)p_{(5)})) = \\min(1, \\max(0.18, 2 \\times 0.21)) = \\min(1, \\max(0.18, 0.42)) = 0.4200$。\n- 对于$j=6$: $\\tilde{p}_{(6)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(5)}^{\\text{Holm}}, (6-6+1)p_{(6)})) = \\min(1, \\max(0.42, 1 \\times 0.33)) = \\min(1, 0.42) = 0.4200$。\n\nHolm校正$p$值集合（四舍五入至四位有效数字）为：$\\{0.01200, 0.08500, 0.1600, 0.1800, 0.4200, 0.4200\\}$。\n\n决策：如果$\\tilde{p}_j^{\\text{Holm}} \\le 0.05$，则拒绝$H_j$。\n- 队列 1: $0.01200 \\le 0.05 \\implies$ 拒绝 (1)\n- 队列 2: $0.08500 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 3: $0.1600 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 4: $0.1800 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 5: $0.4200 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 6: $0.4200 > 0.05 \\implies$ 不拒绝 (0)\n\n在这种情况下，两种方法得出相同的结论：只有第一个队列的零假设被拒绝。\n\n最终答案构成：\n- Bonferroni校正$p$值：$0.01200, 0.1020, 0.2400, 0.3600, 1.000, 1.000$\n- Holm校正$p$值：$0.01200, 0.08500, 0.1600, 0.1800, 0.4200, 0.4200$\n- Bonferroni决策：$1, 0, 0, 0, 0, 0$\n- Holm决策：$1, 0, 0, 0, 0, 0$\n这些将被合并成一个单行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.01200  0.1020  0.2400  0.3600  1.000  1.000  0.01200  0.08500  0.1600  0.1800  0.4200  0.4200  1  0  0  0  0  0  1  0  0  0  0  0\n\\end{pmatrix}\n}\n$$"
        }
    ]
}