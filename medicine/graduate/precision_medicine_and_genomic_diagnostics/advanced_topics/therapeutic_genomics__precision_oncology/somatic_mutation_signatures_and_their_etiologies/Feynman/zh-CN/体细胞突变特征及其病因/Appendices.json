{
    "hands_on_practices": [
        {
            "introduction": "在分析突变印记之前，我们必须考虑到DNA的组成部分并非均等出现。本练习将指导您构建一个“机会向量”，这是通过参考基因组中每个三核苷酸背景的频率来标准化突变计数的关键步骤。正确执行此标准化对于准确识别印记的活性至关重要。",
            "id": "4383920",
            "problem": "您将置于一个简化情境中，以构建用于体细胞突变印迹分析的单碱基替换96分类 (SBS96) 机会向量。SBS96 表示法汇总了六种替换类别及其侧翼三核苷酸上下文中可能突变位点的计数。作为起点的核心科学事实是：双链脱氧核糖核酸 (DNA) 由互补碱基对组成，其中腺嘌呤 (A) 与胸腺嘧啶 (T) 配对，胞嘧啶 (C) 与鸟嘌呤 (G) 配对；体细胞突变发生在核苷酸上，且与链的方向无关；决定 SBS96 通道的三核苷酸上下文由突变碱基周围紧邻的 $5'$ 和 $3'$ 侧翼碱基定义；SBS96 方案通过对以腺嘌呤 (A) 和鸟嘌呤 (G) 为中心的上下文进行反向互补，将中心碱基标准化为嘧啶 (C 或 T)。SBS96 机会向量量化了参考基因组中每个通道的可用位点数量，其中排除了如重复区域或低可映射性位点等被屏蔽的区域。\n\n定义与核心设置：\n- 设参考基因组表示为一个 contig 字符串列表，由字符 $\\{A, C, G, T, N\\}$ 组成，其中 $N$ 表示一个模糊碱基，不计入任何机会计数。\n- 在一个长度为 $L$ 的 contig 上，位置 $i$ 处的三核苷酸窗口定义为 $(b_{i-1}, b_i, b_{i+1})$，其中索引 $i$ 满足 $1 \\le i \\le L-2$。\n- 嘧啶标准化使用反向互补映射。设 $\\operatorname{comp}(A)=T$, $\\operatorname{comp}(T)=A$, $\\operatorname{comp}(C)=G$, $\\operatorname{comp}(G)=C$。三核苷酸 $(x, y, z)$ 的反向互补是 $(\\operatorname{comp}(z), \\operatorname{comp}(y), \\operatorname{comp}(x))$。如果中心碱基 $y$ 是嘌呤（$A$ 或 $G$），则标准化的上下文是其反向互补三核苷酸，从而使中心碱基变为嘧啶（$C$ 或 $T$）。\n- SBS96 通道按六个替换类别组织，顺序为 $C \\to A$、$C \\to G$、$C \\to T$、$T \\to A$、$T \\to C$、$T \\to G$。每个替换类别再根据由 $\\{A, C, G, T\\}$ 中选取的 $5'$ 和 $3'$ 碱基定义的三核苷酸上下文细分为 $16$ 种。这些上下文按 $5'$ 碱基（顺序 A, C, G, T）然后按 $3'$ 碱基（顺序 A, C, G, T）的字典序排列。对于以 C 为中心的上下文，仅适用前三种替换类别；对于以 T 为中心的上下文，仅适用后三种替换类别。\n- 一个位点计入机会计数的条件是，当且仅当三核苷酸中的所有三个碱基都不是模糊的（$\\neq N$），并且该三核苷酸窗口中的三个位置均未被屏蔽。\n\n屏蔽规则：\n- 重复区域屏蔽以每个 contig 的半开索引区间 $[a,b)$ 的形式提供；任何此类区间内的任何碱基位置都被屏蔽。\n- 低可映射性屏蔽以每个 contig 的显式碱基索引集合的形式提供；任何列出的位置都被屏蔽。\n- 有效屏蔽是两者的并集：如果一个碱基出现在重复区域屏蔽或低可映射性屏蔽中，则它被屏蔽。\n- 如果一个三核苷酸的三个位置中有任何一个被屏蔽，则该三核苷酸不计入机会计数。\n\n所需计算：\n- 对于每个测试用例，按如下方式计算 SBS96 机会向量：\n  1. 遍历所有 contig 和从 $1$ 到 $L-2$ 的位置 $i$。\n  2. 形成三核苷酸 $(b_{i-1}, b_i, b_{i+1})$。如果任何一个碱基是 $N$，则跳过。\n  3. 如果 $b_i \\in \\{A, G\\}$，则将该三核苷酸替换为其反向互补序列；否则直接使用。此步骤后，中心碱基保证为 $C$ 或 $T$。\n  4. 如果位置 $(i-1)$、$i$、$(i+1)$ 中有任何一个在其 contig 的有效屏蔽中被屏蔽，则跳过此三核苷酸。\n  5. 使用 $5'$ 和 $3'$ 碱基的字典序索引，将此标准化的三核苷酸上下文计入相应的以 C 为中心或以 T 为中心的 16 种上下文集合中。\n  6. 构建 SBS96 向量：将每个以 C 为中心的上下文计数在三个 $C \\to \\{A, G, T\\}$ 类别中（按顺序）重复，并将每个以 T 为中心的上下文计数在三个 $T \\to \\{A, C, G\\}$ 类别中（按顺序）重复。\n  7. 对向量进行归一化，使所有 $96$ 个条目的总和等于 $1$。如果没有可用的机会（总和为零），则返回一个长度为 $96$ 的零向量。\n- 将所有归一化输出表示为区间 $[0, 1]$ 内的小数浮点数，并四舍五入到六位小数。\n\n测试套件：\n使用以下固定的参考 contig 和屏蔽。Contig 索引是基于 0 的；区间和集合中的碱基索引是基于 0 的；半开区间 $[a,b)$ 包括 $a$ 但不包括 $b$。\n\n- 参考 contig：\n  - Contig $0$: \"ACGTTCCGATTTACGCGTACCTTAGGCTATAGCGTATCGATCGTTACGAACG\" (长度 $52$)\n  - Contig $1$: \"TTACGNNNCGATCGTTTACGCCCTTAGCGTATCGATCGTTACGCGTAT\" (长度 $48$)\n\n- 测试用例 1 (基线，无屏蔽):\n  - 重复区间：两个 contig 均为空 $\\{\\}$\n  - 低可映射性位置：两个 contig 均为空 $\\{\\}$\n\n- 测试用例 2 (仅重复区域屏蔽):\n  - 重复区间：\n    - Contig $0$: $[10,20)$, $[35,40)$\n    - Contig $1$: $[5,12)$, $[30,36)$\n  - 低可映射性位置：无\n\n- 测试用例 3 (仅低可映射性屏蔽):\n  - 重复区间：无\n  - 低可映射性位置：\n    - Contig $0$: $\\{2,3,4,25,26,27\\}$\n    - Contig $1$: $\\{0,1,20,21,35\\}$\n\n- 测试用例 4 (组合屏蔽：测试用例 2 和 3 的并集):\n  - 重复区间同测试用例 2\n  - 低可映射性位置同测试用例 3\n\n- 测试用例 5 (完全屏蔽的基因组):\n  - 重复区间：\n    - Contig $0$: $[0,52)$\n    - Contig $1$: $[0,48)$\n  - 低可映射性位置：无\n\n输出规范：\n- 对于每个测试用例，按所述方法计算归一化的 SBS96 机会向量。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个元素对应一个测试用例，并且必须是该用例的 $96$ 个浮点数列表。例如，输出应类似于 \"[[v1_0,...,v1_95],[v2_0,...,v2_95],...]\"，其中 $vk_j$ 是四舍五入到六位小数的归一化小数浮点数。",
            "solution": "该问题要求在各种屏蔽条件下，为一个给定的微型基因组计算单碱基替换96分类 (SBS96) 机会向量。解决方案的设计通过系统地实现指定的生物学和计算规则，确保了科学上的正确性并遵循了定义的数据结构。\n\n方法论步骤如下：\n\n1.  **建模基因组与屏蔽**：参考基因组表示为字符串列表，每个 contig 一个。以重复区间和离散的低可映射性位置形式提供的屏蔽信息，必须整合到一个高效的数据结构中以便快速查找。对于每个 contig，创建一个名为 `effective_mask` 的布尔型 NumPy 数组。如果位置 $j$ 位于任何重复区间 $[a,b)$ 内或在低可映射性集合中明确列出，则该数组中此位置被标记为 `True`。这种预先计算统一屏蔽的方法可以实现对给定碱基位置是否被屏蔽的常数时间检查，这对于处理长序列时的性能至关重要。\n\n2.  **三核苷酸上下文枚举**：计算的核心在于遍历基因组中每一个可能的三核苷酸位点。遵循问题定义，我们遍历每个长度为 $L$ 的 contig，考虑每个 3 碱基窗口 $(b_{i-1}, b_i, b_{i+1})$，其中中心碱基索引 $i$ 的范围从 $1$ 到 $L-2$。这对应于一个大小为 3 的滑窗在序列上移动。\n\n3.  **应用排除标准**：在将一个三核苷酸视为有效的突变机会之前，根据问题规范，它必须通过两个基本的过滤步骤：\n    *   **模糊性检查**：如果三核苷酸的三个组成碱基中任何一个是模糊字符 $N$，则丢弃该三核苷酸。这确保了只有明确定义的序列才对机会计数有贡献。\n    *   **屏蔽检查**：如果三核苷酸的三个染色体位置 $(i-1, i, i+1)$ 中的任何一个在 `effective_mask` 中被标记为 `True`，则丢弃该三核苷酸。这正确地模拟了生物学和技术上的现实，即在被屏蔽的区域中突变检出是不可靠的，因此这些区域不提供有效的观察突变的“机会”。\n\n4.  **嘧啶标准化原则**：SBS96 框架将所有突变上下文标准化为以嘧啶（$C$ 或 $T$）为中心。这个惯例植根于双链 DNA 的互补性以及许多突变过程的链非依赖性原则。实现严格遵循此规则：\n    *   如果一个有效的三核苷酸的中心碱基已经是嘧啶（$C$ 或 $T$），则该三核苷酸按原样使用。\n    *   如果中心碱基是嘌呤（$A$ 或 $G$），则计算其反向互补序列。对于一个三核苷酸 $(x, y, z)$，其反向互补定义为 $(\\operatorname{comp}(z), \\operatorname{comp}(y), \\operatorname{comp}(x))$，其中 $\\operatorname{comp}$ 是碱基互补函数。此转换正确地将，例如，一个以 A 为中心的上下文映射到其在对义链上等效的以 T 为中心的上下文，确保所有机会都在一个一致的以嘧啶为中心的方案下被计数。\n\n5.  **计数与聚合**：然后对有效、标准化的三核苷酸集合进行分类和计数。分别维护两个独立的 16 元素数组，`c_counts` 和 `t_counts`，用于以 C 为中心和以 T 为中心的上下文。每个数组的 16 个通道对应于 $5'$ 和 $3'$ 侧翼碱基的 $4 \\times 4$ 种可能组合。使用从碱基 $(A, C, G, T)$ 到整数索引 $(0, 1, 2, 3)$ 的映射来为每个标准化的三核苷酸计算唯一的上下文索引：$idx = \\text{5'\\_base\\_idx} \\times 4 + \\text{3'\\_base\\_idx}$。该计算方案确保了计数是根据指定的侧翼碱基字典序进行聚合的。\n\n6.  **构建 SBS96 向量**：最终的 96 元素向量由两个 16 元素的计数数组构建而成。SBS96 格式包含六个替换类别，顺序为 $C \\to A$、$C \\to G$、$C \\to T$、$T \\to A$、$T \\to C$、$T \\to G$。特定三核苷酸上下文（例如，$A[C]G$）的机会计数被假定为与中心 C 突变为哪种碱基无关。因此，`c_counts` 数组在三个 C 替换类别中各重复一次。类似地，`t_counts` 数组在三个 T 替换类别中各重复一次。最终向量由 `c_counts` 重复三次，然后是 `t_counts` 重复三次拼接而成。\n\n7.  **归一化与格式化**：原始计数向量代表机会的绝对数量。为了使其在不同大小的基因组或区域间具有可比性，它被归一化为概率分布。这是通过将 96 个元素中的每一个都除以所有计数的总和来实现的。处理了一个特殊情况，即总和为零时（如在完全屏蔽的基因组中发生）；在这种情况下，按规定返回一个包含 96 个零的向量。最后，归一化向量的每个元素都被四舍五入到六位小数，并且所有测试用例的结果都按照问题陈述所要求的精确字符串表示进行格式化，即一个由浮点数列表组成的列表。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and prints the SBS96 opportunity vectors for a suite of test cases.\n    The entire logic is self-contained within this function.\n    \"\"\"\n\n    # Define constants and test cases as per the problem statement.\n    CONTIGS = [\n        \"ACGTTCCGATTTACGCGTACCTTAGGCTATAGCGTATCGATCGTTACGAACG\",  # L=52\n        \"TTACGNNNCGATCGTTTACGCCCTTAGCGTATCGATCGTTACGCGTAT\",      # L=48\n    ]\n\n    BASE_MAP = {'A': 0, 'C': 1, 'G': 2, 'T': 3}\n    COMPLEMENT_MAP = {'A': 'T', 'T': 'A', 'C': 'G', 'G': 'C'}\n    \n    test_cases = [\n        # TC1: No mask (baseline)\n        ({}, {}),\n        # TC2: Repetitive mask only\n        ({0: [[10, 20], [35, 40]], 1: [[5, 12], [30, 36]]}, {}),\n        # TC3: Low-mappability mask only\n        ({}, {0: {2, 3, 4, 25, 26, 27}, 1: {0, 1, 20, 21, 35}}),\n        # TC4: Combined masking (union of TC2 and TC3)\n        ({0: [[10, 20], [35, 40]], 1: [[5, 12], [30, 36]]}, \n         {0: {2, 3, 4, 25, 26, 27}, 1: {0, 1, 20, 21, 35}}),\n        # TC5: Fully masked genome\n        ({0: [[0, 52]], 1: [[0, 48]]}, {}),\n    ]\n\n    def calculate_sbs96_opportunities(rep_masks, lm_masks):\n        \"\"\"\n        Computes the normalized SBS96 opportunity vector for a given set of masks.\n        \"\"\"\n        c_counts = np.zeros(16, dtype=np.int64)\n        t_counts = np.zeros(16, dtype=np.int64)\n\n        # Pre-process masks into a single boolean array per contig.\n        effective_masks = []\n        for c_idx, seq in enumerate(CONTIGS):\n            mask = np.zeros(len(seq), dtype=bool)\n            # Apply repetitive masks (half-open intervals [a, b))\n            if c_idx in rep_masks:\n                for start, end in rep_masks[c_idx]:\n                    mask[start:end] = True\n            # Apply low-mappability masks (sets of indices)\n            if c_idx in lm_masks:\n                for pos in lm_masks[c_idx]:\n                    mask[pos] = True\n            effective_masks.append(mask)\n\n        # Iterate over all possible trinucleotides and count opportunities.\n        for c_idx, seq in enumerate(CONTIGS):\n            L = len(seq)\n            mask = effective_masks[c_idx]\n            # Loop for the central base position 'i' from 1 to L-2 (0-based indexing).\n            for i in range(1, L - 1):\n                # A trinucleotide is excluded if any of its 3 positions is masked.\n                if mask[i - 1] or mask[i] or mask[i + 1]:\n                    continue\n                \n                b_prev, b_mid, b_next = seq[i - 1], seq[i], seq[i + 1]\n                \n                # Exclude trinucleotides with ambiguous bases ('N').\n                if 'N' in (b_prev, b_mid, b_next):\n                    continue\n\n                # Standardize context to be pyrimidine-centered (C or T).\n                if b_mid in ('A', 'G'):  # Purine-centered\n                    std_prev = COMPLEMENT_MAP[b_next]\n                    std_mid = COMPLEMENT_MAP[b_mid]\n                    std_next = COMPLEMENT_MAP[b_prev]\n                else:  # Pyrimidine-centered\n                    std_prev, std_mid, std_next = b_prev, b_mid, b_next\n\n                # Calculate the 16-channel context index based on flanking bases.\n                # Order: 5' base (A,C,G,T), then 3' base (A,C,G,T).\n                context_idx = BASE_MAP[std_prev] * 4 + BASE_MAP[std_next]\n                \n                # Increment the count for the appropriate standardized context.\n                if std_mid == 'C':\n                    c_counts[context_idx] += 1\n                else:  # std_mid == 'T'\n                    t_counts[context_idx] += 1\n                    \n        # Construct the 96-element opportunity vector.\n        # Order: 3 classes for C (C>A,C>G,C>T) + 3 classes for T (T>A,T>C,T>G).\n        sbs96_counts = np.concatenate([c_counts] * 3 + [t_counts] * 3)\n        \n        # Normalize the vector to sum to 1.\n        total_sum = sbs96_counts.sum()\n        if total_sum == 0:\n            return [0.0] * 96\n            \n        normalized_vector = sbs96_counts / total_sum\n        \n        # Round to 6 decimal places and convert to a list of floats.\n        return np.round(normalized_vector, 6).tolist()\n\n    results = []\n    for rep_masks, lm_masks in test_cases:\n        result = calculate_sbs96_opportunities(rep_masks, lm_masks)\n        results.append(result)\n\n    # Format the output as a string representing a list of lists of floats,\n    # with no spaces, as specified by the output format example.\n    inner_parts = [f\"[{','.join(map(str, res_list))}]\" for res_list in results]\n    final_output_str = f\"[{','.join(inner_parts)}]\"\n\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "突变印记分析的核心任务是将肿瘤的突变目录归因于一组已知的病因学印记。虽然像余弦相似度这样的简单度量可以初步评估可能存在的印记，但它们不足以进行准确的解卷积。本练习演示了其计算过程，并强调了为何需要更复杂的混合模型方法才能得出稳健的科学结论。",
            "id": "4384034",
            "problem": "在体细胞突变特征分析中，一个肿瘤的单核苷酸变异目录可以表示为一个在固定通道（例如，三核苷酸替换背景）上的向量。一个特征是源于特定病因的、在相同通道上的一个特征性分布，通常以概率形式报告。考虑一个科学上合理的六通道抽象模型，其中样本目录由计数向量 $x \\in \\mathbb{R}^{6}$ 给出，每个候选特征由概率向量 $s_i \\in \\mathbb{R}^{6}$ 给出，所有向量都对齐到相同的通道顺序。具体来说，令\n$$x = (40,\\,10,\\,5,\\,20,\\,15,\\,10),$$\n$$s_1 = (0.50,\\,0.10,\\,0.05,\\,0.20,\\,0.10,\\,0.05),$$\n$$s_2 = (0.30,\\,0.05,\\,0.15,\\,0.10,\\,0.25,\\,0.15),$$\n$$s_3 = (0.10,\\,0.25,\\,0.30,\\,0.10,\\,0.15,\\,0.10)。$$\n以通道空间的欧几里得几何为基本依据——其中非零向量的方向编码了其相对通道构成——计算目录 $x$ 与每个特征 $s_i$ 之间的余弦相似度。然后，从精准基因组学中混合归因的基本原理出发，论证当多个特征可能同时活跃时，仅靠与单个特征的余弦相似度为什么不足以进行病因归因。仅报告 $\\{s_1, s_2, s_3\\}$ 中最大的余弦相似度值作为你的最终答案。最终答案以小数形式表示，并四舍五入到四位有效数字。最终报告值无需单位。",
            "solution": "该问题要求计算一个给定的突变目录向量与三个突变特征向量之间的余弦相似度，并随后论证为何该度量不足以进行明确的病因归因。该问题有科学依据，是良定的，并包含了得出有效解决方案所需的所有信息。\n\n在欧几里得空间中，两个非零向量 $A$ 和 $B$ 之间的余弦相似度定义为它们之间夹角 $\\theta$ 的余弦。它使用点积和向量范数计算：\n$$ \\cos(\\theta) = \\frac{A \\cdot B}{\\|A\\| \\|B\\|} $$\n该度量衡量两个向量在方向上的相似性，而不考虑它们的大小。在突变特征的背景下，它比较了不同通道上突变的相对比例。\n\n给定的向量是：\n样本突变目录计数向量：\n$$ x = (40, 10, 5, 20, 15, 10) $$\n三个候选特征概率向量：\n$$ s_1 = (0.50, 0.10, 0.05, 0.20, 0.10, 0.05) $$\n$$ s_2 = (0.30, 0.05, 0.15, 0.10, 0.25, 0.15) $$\n$$ s_3 = (0.10, 0.25, 0.30, 0.10, 0.15, 0.10) $$\n\n首先，我们计算每个向量的欧几里得范数（大小）。\n目录向量 $x$ 的范数：\n$$ \\|x\\| = \\sqrt{40^2 + 10^2 + 5^2 + 20^2 + 15^2 + 10^2} = \\sqrt{1600 + 100 + 25 + 400 + 225 + 100} = \\sqrt{2450} $$\n\n特征向量 $s_1$、$s_2$ 和 $s_3$ 的范数：\n$$ \\|s_1\\| = \\sqrt{0.50^2 + 0.10^2 + 0.05^2 + 0.20^2 + 0.10^2 + 0.05^2} = \\sqrt{0.25 + 0.01 + 0.0025 + 0.04 + 0.01 + 0.0025} = \\sqrt{0.315} $$\n$$ \\|s_2\\| = \\sqrt{0.30^2 + 0.05^2 + 0.15^2 + 0.10^2 + 0.25^2 + 0.15^2} = \\sqrt{0.09 + 0.0025 + 0.0225 + 0.01 + 0.0625 + 0.0225} = \\sqrt{0.21} $$\n$$ \\|s_3\\| = \\sqrt{0.10^2 + 0.25^2 + 0.30^2 + 0.10^2 + 0.15^2 + 0.10^2} = \\sqrt{0.01 + 0.0625 + 0.09 + 0.01 + 0.0225 + 0.01} = \\sqrt{0.205} $$\n\n接下来，我们计算 $x$ 与每个特征向量 $s_i$ 的点积。\n$$ x \\cdot s_1 = (40)(0.50) + (10)(0.10) + (5)(0.05) + (20)(0.20) + (15)(0.10) + (10)(0.05) = 20 + 1 + 0.25 + 4 + 1.5 + 0.5 = 27.25 $$\n$$ x \\cdot s_2 = (40)(0.30) + (10)(0.05) + (5)(0.15) + (20)(0.10) + (15)(0.25) + (10)(0.15) = 12 + 0.5 + 0.75 + 2 + 3.75 + 1.5 = 20.5 $$\n$$ x \\cdot s_3 = (40)(0.10) + (10)(0.25) + (5)(0.30) + (20)(0.10) + (15)(0.15) + (10)(0.10) = 4 + 2.5 + 1.5 + 2 + 2.25 + 1 = 13.25 $$\n\n现在，我们可以计算每个特征的余弦相似度。设 $\\text{sim}(A, B)$ 表示余弦相似度。\n$$ \\text{sim}(x, s_1) = \\frac{x \\cdot s_1}{\\|x\\| \\|s_1\\|} = \\frac{27.25}{\\sqrt{2450} \\sqrt{0.315}} = \\frac{27.25}{\\sqrt{771.75}} \\approx 0.980906 $$\n$$ \\text{sim}(x, s_2) = \\frac{x \\cdot s_2}{\\|x\\| \\|s_2\\|} = \\frac{20.5}{\\sqrt{2450} \\sqrt{0.21}} = \\frac{20.5}{\\sqrt{514.5}} \\approx 0.903778 $$\n$$ \\text{sim}(x, s_3) = \\frac{x \\cdot s_3}{\\|x\\| \\|s_3\\|} = \\frac{13.25}{\\sqrt{2450} \\sqrt{0.205}} = \\frac{13.25}{\\sqrt{502.25}} \\approx 0.591229 $$\n\n比较这三个值，最大的余弦相似度是与特征 $s_1$ 的相似度：$0.980906...$。\n\n任务的第二部分是从基本原理出发，论证为何与单个特征的余弦相似度不足以进行病因归因。\n体细胞突变特征分析的基本原理是，在肿瘤中观察到的突变目录（由向量 $x$ 表示）是多个突变过程（病因）随时间累积作用的结果。每个过程都由一个特征向量 $s_i$ 来表征。因此，观察到的目录 $x$ 不应与单个特征完全相同，而应是所有活跃特征的线性组合。这可以表示为：\n$$ x \\approx \\sum_{i=1}^{k} a_i s_i = S a $$\n其中 $k$ 是活跃特征的数量，$s_i$ 是特征向量，$a_i \\ge 0$ 是“暴露量”或“活性”，代表每个特征贡献的突变数量，$S$ 是以特征向量 $s_i$ 为列的矩阵，$a$ 是暴露量向量。\n\n病因归因的目标是解决这个混合问题，即对复合信号 $x$ 进行解卷积，并确定暴露量向量 $a$。这本质上是一个系统级问题，需要同时考虑所有候选特征。\n\n余弦相似度 $\\text{sim}(x, s_j)$ 只衡量观察到的目录 $x$ 与*单个*特征向量 $s_j$ 之间的对齐程度。一个高值表示 $x$ 中突变的相对比例与 $s_j$ 中的相似。然而，由于以下几个原因，这不足以进行归因：\n1.  **忽略混合效应**：一个向量 $x$ 可以是两个或更多特征向量的线性组合，例如 $x = a_1 s_1 + a_2 s_2$，但它与另一个向量 $s_3$ 的余弦相似度，或与其某个分量（比如 $s_1$）的余弦相似度，可能比与另一个分量更高。在高维通道空间中，向量 $x$ 可能位于特征集合 $\\{s_i\\}$ 的锥包内。与基向量 $\\{s_i\\}$ 的简单成对角距离并不能揭示 $x$ 在该基下的坐标（即暴露量 $a_i$）。例如，两个特征的向量和可能指向一个与第三个不相关的特征非常接近的方向，从而导致一个虚假的高相似度得分。\n2.  **缺乏排他性**：与 $s_1$ 的高相似度并不意味着其他特征没有贡献。我们的计算显示 $\\text{sim}(x, s_1) \\approx 0.9809$，这是一个非常高的值。然而，归一化的目录 $x_{\\text{norm}} = x / \\sum x_j = (0.4, 0.1, 0.05, 0.2, 0.15, 0.1)$ 与 $s_1 = (0.5, 0.1, 0.05, 0.2, 0.1, 0.05)$ 并不相同。这些差异可能可以用其他特征（如 $s_2$ 和/或 $s_3$）的贡献来解释。\n3.  **正确的方法论**：严谨的归因方法是找到非负暴露量向量 $a$，使得重构误差（通常是欧几里得距离的平方）最小化：\n    $$ \\min_{a \\ge 0} \\| x - S a \\|^2_2 $$\n    这是一个非负最小二乘（NNLS）问题。解决这个优化问题可以提供每个候选特征的估计贡献，从而得出一个完整的病因学画像。该方法考虑了所有特征在重构观察目录时的相互作用，而这是成对余弦相似度完全忽略的一个关键方面。\n\n总之，虽然余弦相似度对于初步评估可能存在哪些特征是一个有用的启发式方法，但它不能替代解决完整混合问题的正式解卷积。仅仅依靠最高的余弦相似度进行归因是一种科学上不合理的过度简化，可能导致关于肿瘤中活跃的突变过程的错误结论。\n\n计算出的最大余弦相似度值约为 $0.980906$。四舍五入到四位有效数字得到 $0.9809$。",
            "answer": "$$\\boxed{0.9809}$$"
        },
        {
            "introduction": "基因组诊断中的一个主要挑战是确保观察到的突变信号具有生物学起源，而不是组织保存或文库制备过程中的技术性假象。本案例研究提供了一个比较福尔马林固定石蜡包埋（FFPE）组织和新鲜冷冻组织数据的真实场景。通过分析技术性假象的迹象，您将学习到避免将实验噪音误读为有意义的生物学印记（如SBS1）所需的关键质量控制原则。",
            "id": "4383943",
            "problem": "一个来自尿路上皮癌的肿瘤样本在下一代测序（NGS）平台上通过全基因组测序（WGS）进行分析。一个文库由未经酶修复的福尔马林固定石蜡包埋（FFPE）组织制备，第二个文库由匹配的新鲜冰冻组织制备。计算流程识别单核苷酸变异，并根据侧翼三核苷酸背景，在标准的 $96$ 通道表示法中注释单碱基替换（SBS）的背景。一个突变印迹重拟合工具将暴露度分配给已知的参考印迹。对于一个肿瘤中的 FFPE 文库（将此文库表示为 $L_{\\mathrm{FFPE}}$），获得了以下观察结果：\n\n- $ \\mathrm{C\\to T} $ 替换的总数为 $ n_{\\mathrm{C\\to T}} = 320 $，其中 $ n_{\\mathrm{CpG}} = 210 $ 发生在 CpG 二核苷酸处。\n- 在 $ n_{\\mathrm{CpG}} = 210 $ 个检出中，$ n_{\\mathrm{end}} = 155 $ 个发生在距离片段任一末端（以测序读段坐标测量）的前 $ k = 10 $ 个碱基内；定义末端富集比为 $ r_{\\mathrm{end}} = n_{\\mathrm{end}}/n_{\\mathrm{CpG}} $。\n- 对于 $ n_{\\mathrm{CpG}} = 210 $ 个检出的读段方向计数显示，正向为 $ n_{F} = 170 $，反向为 $ n_{R} = 40 $；定义方向偏倚为 $ b = n_{F}/(n_{F}+n_{R}) $。\n- 重拟合工具将 $ e_{1} = 0.58 $ 的暴露度分配给与年龄相关的 SBS1 印迹，并将 $ e_{\\mathrm{resid}} = 0.22 $ 分配给无法解释的残余计数。\n- 患者的实际年龄为 $ a = 72 $ 岁，在一个包含 $ m = 50 $ 例尿路上皮癌的队列中，SBS1 暴露度与年龄之间的皮尔逊相关系数为 $ \\rho = 0.05 $（无统计学意义，$ p > 0.05 $）。\n\n对于来自同一肿瘤的匹配新鲜冰冻文库 $ L_{\\mathrm{FF}} $，相同的指标如下：\n\n- $ n_{\\mathrm{C\\to T}} = 290 $，$ n_{\\mathrm{CpG}} = 198 $，$ n_{\\mathrm{end}} = 24 $，因此 $ r_{\\mathrm{end}} = 24/198 $。\n- 方向计数 $ n_{F} = 100 $，$ n_{R} = 98 $，因此 $ b = 100/(100+98) $。\n- SBS1 暴露度 $ e_{1} = 0.31 $，残余 $ e_{\\mathrm{resid}} = 0.06 $。\n\n假设以下经过充分检验的事实和核心定义：\n\n- 突变印迹是 $96$ 个三核苷酸替换通道上的概率分布；环境病因（例如，吸烟、紫外线辐射、马兜铃酸）产生的信号预计不依赖于文库技术参数（如读段方向或与片段末端的距离），并且在生物污染得到控制的情况下，对于来自同一肿瘤的不同制备方法应具有可重复性。\n- 福尔马林固定石蜡包埋（FFPE）组织中的胞嘧啶脱氨会产生 $ \\mathrm{C\\to T} $ 假象，这些假象在片段末端富集，并且由于末端修复和连接步骤，通常表现出读段方向偏倚；在扩增前使用尿嘧啶-DNA糖基化酶（UDG）进行酶促尿嘧啶切除可减少此类假象。\n- 技术性假象过程通常会留下一个残余的印迹组分，该组分很难用生物学参考来解释，并且可能与批次或文库制备相关，而不是与年龄或暴露史等生物学协变量相关。\n\n根据这些观察和定义，构建对 $ L_{\\mathrm{FFPE}} $ 最合理的解释，并确定可以避免将技术假象误读为环境印迹的可靠步骤。哪个选项最能同时概括可能的误解和适当的缓解措施？\n\nA. 从过量的 $ \\mathrm{C\\to T} $ 检出推断为紫外线暴露（SBS7）；通过将肿瘤纯度和测序深度增加到至少 $ \\times 120 $ 来避免错误。\n\nB. 识别出 FFPE 诱导的胞嘧啶脱氨假象被误读为与年龄相关的 SBS1；通过在扩增前加入尿嘧啶-DNA糖基化酶（UDG）处理，过滤片段末端和具有方向偏倚的 $ \\mathrm{C\\to T} $ 检出，使用基于独特分子标识符（UMI）的双链一致性序列来消除错误，并使用匹配的新鲜冰冻对照和自助法置信度来重拟合印迹以确保暴露度的稳定性，从而避免错误。\n\nC. 从 CpG 处升高的 $ \\mathrm{C\\to T} $ 检出推断为吸烟（SBS4）；通过在队列中增加吸烟者并过滤高 $ \\mathrm{GC} $ 含量区域来避免错误。\n\nD. 从片段末端附近的明显富集推断为马兜铃酸暴露（SBS22）；通过排除 CpG 岛并将三核苷酸频率重新平衡至全基因组平均水平来避免错误。",
            "solution": "用户希望我扮演一位严谨的STEM教授，分析所提供的关于尿路上皮癌样本中体细胞突变印迹的问题。\n\n### 问题验证\n\n首先，我将根据指定协议验证问题陈述。\n\n#### 第1步：提取已知条件\n\n问题陈述中提供了以下数据和定义：\n\n**基本信息：**\n- 肿瘤类型：尿路上皮癌\n- 测序方法：全基因组测序（WGS）\n- 分析：在 $96$ 通道格式中进行单碱基替换（SBS）检出\n\n**文库 $L_{\\mathrm{FFPE}}$（福尔马林固定石蜡包埋，无酶修复）：**\n- $ \\mathrm{C\\to T} $ 替换总数：$ n_{\\mathrm{C\\to T}} = 320 $\n- CpG二核苷酸处的 $ \\mathrm{C\\to T} $ 替换：$ n_{\\mathrm{CpG}} = 210 $\n- 在片段末端前 $ k = 10 $ 个碱基内 CpG 处的 $ \\mathrm{C\\to T} $：$ n_{\\mathrm{end}} = 155 $\n- 末端富集比：$ r_{\\mathrm{end}} = n_{\\mathrm{end}}/n_{\\mathrm{CpG}} = 155/210 $\n- CpG 检出的读段方向计数：$ n_{F} = 170 $（正向），$ n_{R} = 40 $（反向）\n- 方向偏倚：$ b = n_{F}/(n_{F}+n_{R}) = 170/(170+40) $\n- 分配的 SBS1 暴露度：$ e_{1} = 0.58 $\n- 无法解释的残余暴露度：$ e_{\\mathrm{resid}} = 0.22 $\n\n**患者和队列数据：**\n- 患者实际年龄：$ a = 72 $ 岁\n- 队列大小：$ m = 50 $ 例尿路上皮癌\n- 队列中 SBS1 暴露度与年龄之间的皮尔逊相关系数：$ \\rho = 0.05 $（$ p > 0.05 $）\n\n**文库 $L_{\\mathrm{FF}}$（匹配的新鲜冰冻）：**\n- $ \\mathrm{C\\to T} $ 替换总数：$ n_{\\mathrm{C\\to T}} = 290 $\n- CpG二核苷酸处的 $ \\mathrm{C\\to T} $ 替换：$ n_{\\mathrm{CpG}} = 198 $\n- 片段末端内 CpG 处的 $ \\mathrm{C\\to T} $：$ n_{\\mathrm{end}} = 24 $\n- 末端富集比：$ r_{\\mathrm{end}} = 24/198 $\n- CpG 检出的读段方向计数：$ n_{F} = 100 $（正向），$ n_{R} = 98 $（反向）\n- 方向偏倚：$ b = 100/(100+98) $\n- 分配的 SBS1 暴露度：$ e_{1} = 0.31 $\n- 无法解释的残余暴露度：$ e_{\\mathrm{resid}} = 0.06 $\n\n**定义和假设：**\n- 环境突变印迹应独立于技术参数（读段方向、片段末端），并且在不同制备方法中应具有可重复性。\n- FFPE诱导的假象特征是胞嘧啶脱氨（$ \\mathrm{C\\to T} $）、在片段末端附近富集以及可能的读段方向偏倚。尿嘧啶-DNA糖基化酶（UDG）处理可以减少这些假象。\n- 技术假象可能导致印迹重拟合中出现较高的残余组分。\n\n#### 第2步：使用提取的已知条件进行验证\n\n- **科学依据充分：** 该问题牢固地植根于癌症基因组学、生物信息学和病理学的既定原则。突变印迹（如SBS1）的概念、FFPE固定对DNA的化学影响（胞嘧啶脱氨）、NGS文库制备假象（末端富集、方向偏倚）以及缓解策略（UDG处理、基于UMI的一致性序列）等，都是科学文献中标准且有充分记录的内容。\n- **定义明确：** 这是一个定义明确的问题。它提出了一个来自同一生物来源的测试案例（FFPE）和对照案例（新鲜冰冻）之间的比较分析场景。这种设计有助于分离和识别假象。问题要求给出最合理的解释和适当的缓解措施，这是一个可以根据所提供数据解决的诊断问题。\n- **客观性：** 问题陈述是客观的，提供了定量数据和既定的科学定义。没有主观或基于意见的主张。\n- **缺陷检查：** 该问题没有违反任何指定的无效标准。它科学上合理、可形式化、完整、现实且结构良好。提供的数值数据与此类实验的预期一致。例如，FFPE样本中高的末端富集和方向偏倚是固定假象的标志，而它们在新鲜冰冻样本中的近乎缺失证实了其技术来源。\n\n#### 第3步：结论和行动\n问题陈述是**有效的**。我将继续推导解决方案。\n\n### 解决方案推导\n\n这个问题的核心是解释使用不同方法（福尔马林固定石蜡包埋，$L_{\\mathrm{FFPE}}$，和新鲜冰冻，$L_{\\mathrm{FF}}$）从同一肿瘤制备的两个文库在突变印迹分析中的差异。新鲜冰冻样本作为一个高质量的基准，用于评估易产生假象的 FFPE 样本。\n\n**1. $L_{\\mathrm{FFPE}}$ 中 FFPE 假象的分析：**\n- **末端富集：** CpG $ \\mathrm{C\\to T} $ 检出的末端富集比为 $ r_{\\mathrm{end}} = 155/210 \\approx 0.738 $。这是一个极高的比率，表明大约 $74\\%$ 的突变位于片段末端的 $10$ 个碱基内。这是文库制备过程中 DNA 损伤的典型特征，正如问题前提中所述。生物性突变预计会沿着基因组随机分布，而不是聚集在片段末端。\n- **方向偏倚：** 方向偏倚为 $ b = 170/(170+40) = 170/210 \\approx 0.81 $。这表明存在强烈的偏倚，有 $81\\%$ 的 CpG $ \\mathrm{C\\to T} $ 变异在正向读段上发现。生物性突变不应显示链偏好性，其偏倚应接近 $0.5$。如此强的偏倚是明确的技术假象，通常与片段化过程中产生的单链悬挂末端以及随后作用于受损碱基的末端修复过程有关。\n- **印迹特征：** 主要的突变类型是 $ \\mathrm{C\\to T} $，尤其是在 CpG 位点。这个模式是与年龄相关的印迹 SBS1 的特征。然而，它也是胞嘧啶脱氨产生的模式，这是一种已知的 FFPE 固定假象，其中胞嘧啶脱氨为尿嘧啶，然后在 PCR 扩增过程中被读取为胸腺嘧啶。\n\n**2. 与匹配的新鲜冰冻文库 $L_{\\mathrm{FF}}$ 的比较：**\n- **末端富集：** 在 $L_{\\mathrm{FF}}$ 中，该比率为 $ r_{\\mathrm{end}} = 24/198 \\approx 0.121 $。这个值远低于 $L_{\\mathrm{FFPE}}$ 中的值，更接近于随机分布的预期。\n- **方向偏倚：** 在 $L_{\\mathrm{FF}}$ 中，偏倚为 $ b = 100/(100+98) = 100/198 \\approx 0.505 $。这几乎是完全平衡的（约 $50\\%$），符合真实生物学过程的预期。\n- **印迹暴露度：** SBS1 暴露度从 $L_{\\mathrm{FFPE}}$ 中的 $e_{1} = 0.58$ 下降到 $L_{\\mathrm{FF}}$ 中更适中的 $e_{1} = 0.31$。类似地，无法解释的残余组分从高值 $e_{\\mathrm{resid}} = 0.22$ 下降到低值 $e_{\\mathrm{resid}} = 0.06 $。\n\n**3. 综合与解释：**\n两个文库之间的鲜明对比指向一个结论：$L_{\\mathrm{FFPE}}$ 文库被技术假象严重污染。这些假象表现为在片段末端富集并显示出强烈读段方向偏倚的 $ \\mathrm{C\\to T} $ 突变。由于这些假象突变在化学上模仿了生物性衰老印迹 SBS1 的 CpG 位点 $ \\mathrm{C\\to T} $ 模式，印迹重拟合算法错误地夸大了 $L_{\\mathrm{FFPE}}$ 样本中的 SBS1 暴露度。真实的生物性 SBS1 暴露度更接近于在高质量 $L_{\\mathrm{FF}}$ 样本中观察到的 $e_{1} = 0.31$。$L_{\\mathrm{FFPE}}$ 中的高残余值进一步支持了这一点，因为假象的特征谱与任何已知的生物印迹都不是完美匹配。队列中 SBS1 与年龄之间缺乏相关性（$\\rho=0.05$）也可能暗示 FFPE 假象正在混淆该队列中许多样本的分析。\n\n最合理的解释是将 FFPE 诱导的脱氨假象误读为生物性的 SBS1 信号。适当的缓解措施应包括通过生物化学方法防止这些假象或通过生物信息学方法去除它们。\n\n### 逐项分析选项\n\n**A. 从过量的 $ \\mathrm{C\\to T} $ 检出推断为紫外线暴露（SBS7）；通过将肿瘤纯度和测序深度增加到至少 $ \\times 120 $ 来避免错误。**\n- **解释：** 这是不正确的。SBS7 主要与紫外线相关，对于像尿路上皮癌这样的内部癌症来说，这是一个不合情理的病因。此外，SBS7 的特征模式是在二嘧啶位点发生 $ \\mathrm{C\\to T} $ 突变（$Y\\underline{C} \\to Y\\underline{T}$），这与观察到的以 CpG 为中心的模式不同。证据强烈指向技术假象，而不是一个不同的生物学病因。\n- **缓解措施：** 增加测序深度和肿瘤纯度是常规的质量改进措施，但不能解决胞嘧啶脱氨这一特定的化学假象。更高的深度只会为错误的、由假象导致的变异检出提供更多的统计支持。\n- **结论：** 错误。\n\n**B. 识别出 FFPE 诱导的胞嘧啶脱氨假象被误读为与年龄相关的 SBS1；通过在扩增前加入尿嘧啶-DNA糖基化酶（UDG）处理，过滤片段末端和具有方向偏倚的 $ \\mathrm{C\\to T} $ 检出，使用基于独特分子标识符（UMI）的双链一致性序列来消除错误，并使用匹配的新鲜冰冻对照和自助法置信度来重拟合印迹以确保暴露度的稳定性，从而避免错误。**\n- **解释：** 这与上面的推导完全相符。它正确地指出了 FFPE 诱导的胞嘧啶脱氨、其与 SBS1 特征谱的相似性，以及由此导致的印迹重拟合工具的错误归因。\n- **缓解措施：** 这个选项提出了一套全面且先进的缓解技术。UDG 处理是标准的生化修复方法。基于末端富集和方向偏倚进行过滤是标准的生物信息学修复方法。基于 UMI 的双链一致性序列是一种先进且高效的错误抑制方法。使用匹配的对照和统计验证（自助法）是可靠的分析实践。\n- **结论：** 正确。\n\n**C. 从 CpG 处升高的 $ \\mathrm{C\\to T} $ 检出推断为吸烟（SBS4）；通过在队列中增加吸烟者并过滤高 $ \\mathrm{GC} $ 含量区域来避免错误。**\n- **解释：** 这是不正确的。烟草吸烟的印迹 SBS4 是以 $ \\mathrm{C\\to A} $ 颠换为主，而不是数据中升高的 $ \\mathrm{C\\to T} $ 转换。将 $ \\mathrm{C\\to T} $ 信号归因于 SBS4 是一个根本性错误。\n- **缓解措施：** 在队列中增加吸烟者是一种流行病学研究设计选择，而不是针对单个样本中假象的技术修复方法。过滤高 $ \\mathrm{GC} $ 含量区域是一种粗糙的方法，它没有专门针对假象的已知特征，并有移除有效数据的风险。\n- **结论：** 错误。\n\n**D. 从片段末端附近的明显富集推断为马兜铃酸暴露（SBS22）；通过排除 CpG 岛并将三核苷酸频率重新平衡至全基因组平均水平来避免错误。**\n- **解释：** 这是不正确的。马兜铃酸的印迹 SBS22 的特点是大量的 $ \\mathrm{A\\to T} $ 颠换，而不是 $ \\mathrm{C\\to T} $ 转换。“片段末端附近的富集”是一种技术假象，而不是 SBS22 的生物学特征。\n- **缓解措施：** 排除 CpG 岛是一种过于激进的过滤方法，它会连同假象一起移除真实的 SBS1 信号。重新平衡频率是一种归一化方法，无法纠正根本上错误的变异检出。\n- **结论：** 错误。",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}