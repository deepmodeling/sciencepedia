{
    "hands_on_practices": [
        {
            "introduction": "在分析突变计数之前，我们必须首先考虑基因组中不同三核苷酸上下文出现的频率差异。本练习将指导您从零开始构建“机会向量”（opportunity vector），它是在进行突变特征分析时一个至关重要的归一化因子。通过这项实践，您将深入理解单碱基替换96种分类（SBS96）框架的精确定义以及处理基因组中重复或低可比对性等屏蔽区域的重要性，为所有后续的定量分析奠定坚实基础。",
            "id": "4383920",
            "problem": "您将获得一个用于构建单碱基替换九十六分类（SBS96）机会向量的简化设置，该向量用于体细胞突变特征分析。SBS96表示法聚合了六个替换类别及其侧翼三核苷酸上下文中的可能突变位点的计数。其核心科学事实如下：双链脱氧核糖核酸（DNA）由互补碱基对组成，其中腺嘌呤（A）与胸腺嘧啶（T）配对，胞嘧啶（C）与鸟嘌呤（G）配对；体细胞突变在核苷酸上发生，且与链的方向无关；决定SBS96通道的三核苷酸上下文由突变碱基紧邻的$5'$和$3'$碱基定义；SBS96方案通过对以腺嘌呤（A）和鸟嘌呤（G）为中心的上下文进行反向互补，将中心碱基标准化为嘧啶（C或T）。SBS96机会向量量化了参考基因组中每个通道的可用位点数量，排除了如重复区域或低可图谱性位点等屏蔽区域。\n\n定义与核心设置：\n- 设参考基因组表示为一个contig（序列片段）字符串列表，由字符$\\{A, C, G, T, N\\}$组成，其中$N$表示一个不明确碱基，不计入任何机会计数。\n- 在长度为$L$的contig上，位置$i$处的三核苷酸窗口定义为$(b_{i-1}, b_i, b_{i+1})$，其中索引$i$满足$1 \\le i \\le L-2$。\n- 嘧啶标准化使用反向互补映射。设$\\operatorname{comp}(A)=T$, $\\operatorname{comp}(T)=A$, $\\operatorname{comp}(C)=G$, $\\operatorname{comp}(G)=C$。三核苷酸$(x, y, z)$的反向互补是$(\\operatorname{comp}(z), \\operatorname{comp}(y), \\operatorname{comp}(x))$。如果中心碱基$y$是嘌呤（$A$或$G$），则标准化的上下文是其反向互补三核苷酸，使得中心碱基变为嘧啶（$C$或$T$）。\n- SBS96通道按六个替换类别组织，顺序为$C \\to A$, $C \\to G$, $C \\to T$, $T \\to A$, $T \\to C$, $T \\to G$。每个替换类别再根据$5'$和$3'$碱基（从$\\{A, C, G, T\\}$中选取）定义的$16$个三核苷酸上下文进行细分，按$5'$碱基（顺序$A, C, G, T$）然后$3'$碱基（顺序$A, C, G, T$）的字典序排列。对于以$C$为中心的上下文，仅适用前三个替换类别；对于以$T$为中心的上下文，仅适用后三个替换类别。\n- 一个位点对机会计数有贡献，当且仅当三核苷酸中的所有三个碱基都不是不明确的（$\\neq N$），并且三核苷酸窗口中的三个位置均未被屏蔽。\n\n屏蔽规则：\n- 重复区域屏蔽以每个contig的半开索引区间$[a,b)$的形式提供；任何此类区间内的任何碱基位置都被屏蔽。\n- 低可图谱性屏蔽以每个contig的明确碱基索引集合的形式提供；任何列出的位置都被屏蔽。\n- 有效屏蔽是二者的并集：如果一个碱基出现在重复区域或低可图谱性屏蔽中，则该碱基被屏蔽。\n- 如果一个三核苷酸的三个位置中有任何一个被屏蔽，则该三核苷酸不计入机会计数。\n\n计算要求：\n- 对每个测试用例，按如下方式计算SBS96机会向量：\n  1. 遍历所有contig和从$1$到$L-2$的位置$i$。\n  2. 形成三核苷酸$(b_{i-1}, b_i, b_{i+1})$。如果任何碱基是$N$，则跳过。\n  3. 如果$b_i \\in \\{A, G\\}$，则将该三核苷酸替换为其反向互补；否则直接使用。此步骤后，中心碱基保证为$C$或$T$。\n  4. 如果位置$(i-1)$、$i$、$(i+1)$中任何一个在其contig的有效屏蔽中被屏蔽，则跳过此三核苷酸。\n  5. 使用$5'$和$3'$碱基的字典序索引，将此标准化的三核苷酸上下文计数到相应的以$C$为中心或以$T$为中心的$16$个上下文集合中。\n  6. 通过将每个以$C$为中心的上下文计数重复三次（按顺序对应于$C \\to \\{A, G, T\\}$类别），并将每个以$T$为中心的上下文计数重复三次（按顺序对应于$T \\to \\{A, C, G\\}$类别），来构建SBS96向量。\n  7. 将向量归一化，使得所有$96$个条目的总和等于$1$。如果没有可用的机会（总和为零），则返回一个长度为$96$的全零向量。\n- 将所有归一化输出表示为区间$[0, 1]$内四舍五入到六位小数的十进制浮点数。\n\n测试套件：\n使用以下固定的参考contig和屏蔽。Contig索引是$0$基的；区间和集合中的碱基索引是$0$基的；半开区间$[a,b)$包括$a$但不包括$b$。\n\n- 参考contig：\n  - Contig $0$: \"ACGTTCCGATTTACGCGTACCTTAGGCTATAGCGTATCGATCGTTACGAACG\" (长度 $52$)\n  - Contig $1$: \"TTACGNNNCGATCGTTTACGCCCTTAGCGTATCGATCGTTACGCGTAT\" (长度 $48$)\n\n- 测试用例 $1$ (基准，无屏蔽):\n  - 重复区间: 两个contig均为$\\{\\}$\n  - 低可图谱性位置: 两个contig均为$\\{\\}$\n\n- 测试用例 $2$ (仅重复区域屏蔽):\n  - 重复区间:\n    - Contig $0$: $[10,20)$, $[35,40)$\n    - Contig $1$: $[5,12)$, $[30,36)$\n  - 低可图谱性位置: 无\n\n- 测试用例 $3$ (仅低可图谱性屏蔽):\n  - 重复区间: 无\n  - 低可图谱性位置:\n    - Contig $0$: $\\{2,3,4,25,26,27\\}$\n    - Contig $1$: $\\{0,1,20,21,35\\}$\n\n- 测试用例 $4$ (组合屏蔽: 测试用例$2$和$3$的并集):\n  - 重复区间如测试用例$2$所示\n  - 低可图谱性位置如测试用例$3$所示\n\n- 测试用例 $5$ (完全屏蔽的基因组):\n  - 重复区间:\n    - Contig $0$: $[0,52)$\n    - Contig $1$: $[0,48)$\n  - 低可图谱性位置: 无\n\n输出规范：\n- 对每个测试用例，计算所述的归一化SBS96机会向量。\n- 您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表。每个元素对应一个测试用例，并且必须是该用例的$96$个浮点数列表。例如，输出应类似于 \"[[v1_0,...,v1_95],[v2_0,...,v2_95],...]\"，其中$vk_j$是四舍五入到六位小数的归一化十进制浮点数。",
            "solution": "该问题要求在多种屏蔽条件下，为一个给定的微型基因组计算单碱基替换九十六分类（SBS96）机会向量。该解决方案通过系统地实现指定的生物学和计算规则来设计，确保科学正确性并遵循所定义的数据结构。\n\n该方法的步骤如下：\n\n1.  **建模基因组与屏蔽**：参考基因组表示为字符串列表，每个字符串对应一个contig。屏蔽信息以重复区间和离散的低可图谱性位置的形式提供，必须整合到一个高效的数据结构中以便快速查找。对于每个contig，我们创建一个单一的布尔NumPy数组，即`effective_mask`（有效屏蔽）。如果位置$j$位于任何重复区间$[a,b)$内或在低可图谱性集合中明确列出，则该数组中此位置被标记为`True`。预先计算一个统一的屏蔽，可以在处理大型序列时以常数时间检查给定碱基位置是否被屏蔽，这对性能至关重要。\n\n2.  **三核苷酸上下文枚举**：计算的核心在于遍历基因组中每一个可能的三核苷酸位点。根据问题定义，我们遍历每个长度为$L$的contig，考虑每个3碱基窗口$(b_{i-1}, b_i, b_{i+1})$，其中中心碱基索引$i$的范围是从$1$到$L-2$。这对应于一个大小为3的滑动窗口在序列上移动。\n\n3.  **应用排除标准**：在将一个三核苷酸视为有效的突变机会之前，它必须通过问题规范中两个基本的筛选步骤：\n    *   **不明确性检查**：如果三核苷酸的三个组成碱基中任何一个是模糊字符$N$，则该三核苷酸被丢弃。这确保只有明确定义的序列才对机会计数有贡献。\n    *   **屏蔽检查**：如果三核苷酸的三个染色体位置$(i-1, i, i+1)$中有任何一个在`effective_mask`中被标记为`True`，则该三核苷酸被丢弃。这正确地模拟了生物学和技术上的现实，即在屏蔽区域中的突变调用是不可靠的，因此这些区域不提供有效的“机会”来观察突变。\n\n4.  **嘧啶标准化原则**：SBS96框架将所有突变上下文标准化为以嘧啶（$C$或$T$）为中心。这一惯例植根于双链DNA的互补性以及许多突变过程的链无关性原则。实现严格遵循此规则：\n    *   如果一个有效三核苷酸的中心碱基已经是嘧啶（$C$或$T$），则该三核苷酸按原样使用。\n    *   如果中心碱基是嘌呤（$A$或$G$），则计算其反向互补。对于三核苷酸$(x, y, z)$，反向互补定义为$(\\operatorname{comp}(z), \\operatorname{comp}(y), \\operatorname{comp}(x))$，其中$\\operatorname{comp}$是碱基互补函数。此转换正确地将例如一个以$A$为中心的上下文映射到其在另一条链上等效的以$T$为中心的上下文，确保所有机会都在一个一致的以嘧啶为中心的方案下进行计数。\n\n5.  **计数与聚合**：然后对有效且标准化的三核苷酸集合进行分类和计数。我们为以$C$为中心和以$T$为中心的上下文分别维护两个16元素的数组，`c_counts`和`t_counts`。每种的16个通道对应于$5'$和$3'$侧翼碱基的$4 \\times 4$种可能组合。我们使用一个从碱基$(A, C, G, T)$到整数索引$(0, 1, 2, 3)$的映射来为每个标准化的三核苷酸计算一个唯一的上下文索引：$idx = \\text{5'\\_base\\_idx} \\times 4 + \\text{3'\\_base\\_idx}$。该计算方案确保计数按照指定的侧翼碱基字典序进行聚合。\n\n6.  **构建SBS96向量**：最终的96元素向量由两个16元素的计数数组构建而成。SBS96格式包含六个替换类别，顺序为$C \\to A$、$C \\to G$、$C \\to T$、$T \\to A$、$T \\to C$、$T \\to G$。我们假设特定三核苷酸上下文（例如，$A[C]G$）的机会计数与中心$C$突变为哪个碱基无关。因此，`c_counts`数组会为三个$C$-替换类别中的每一个重复使用。同样，`t_counts`数组也会为三个$T$-替换类别中的每一个重复使用。最终向量通过将`c_counts`连接三次，然后将`t_counts`连接三次来形成。\n\n7.  **归一化与格式化**：原始计数向量代表机会的绝对数量。为了使其在不同大小的基因组或区域之间具有可比性，它被归一化为一个概率分布。这是通过将96个元素中的每一个除以所有计数的总和来实现的。我们处理了一个特殊情况，即总和为零（例如在完全屏蔽的基因组中发生）；在这种情况下，按规定返回一个包含96个零的向量。最后，归一化向量的每个元素都四舍五入到六位小数，并且所有测试用例的结果都格式化为问题陈述所要求的精确字符串表示，即一个浮点数列表的列表。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and prints the SBS96 opportunity vectors for a suite of test cases.\n    The entire logic is self-contained within this function.\n    \"\"\"\n\n    # Define constants and test cases as per the problem statement.\n    CONTIGS = [\n        \"ACGTTCCGATTTACGCGTACCTTAGGCTATAGCGTATCGATCGTTACGAACG\",  # L=52\n        \"TTACGNNNCGATCGTTTACGCCCTTAGCGTATCGATCGTTACGCGTAT\",      # L=48\n    ]\n\n    BASE_MAP = {'A': 0, 'C': 1, 'G': 2, 'T': 3}\n    COMPLEMENT_MAP = {'A': 'T', 'T': 'A', 'C': 'G', 'G': 'C'}\n    \n    test_cases = [\n        # TC1: No mask (baseline)\n        ({}, {}),\n        # TC2: Repetitive mask only\n        ({0: [[10, 20], [35, 40]], 1: [[5, 12], [30, 36]]}, {}),\n        # TC3: Low-mappability mask only\n        ({}, {0: {2, 3, 4, 25, 26, 27}, 1: {0, 1, 20, 21, 35}}),\n        # TC4: Combined masking (union of TC2 and TC3)\n        ({0: [[10, 20], [35, 40]], 1: [[5, 12], [30, 36]]}, \n         {0: {2, 3, 4, 25, 26, 27}, 1: {0, 1, 20, 21, 35}}),\n        # TC5: Fully masked genome\n        ({0: [[0, 52]], 1: [[0, 48]]}, {}),\n    ]\n\n    def calculate_sbs96_opportunities(rep_masks, lm_masks):\n        \"\"\"\n        Computes the normalized SBS96 opportunity vector for a given set of masks.\n        \"\"\"\n        c_counts = np.zeros(16, dtype=np.int64)\n        t_counts = np.zeros(16, dtype=np.int64)\n\n        # Pre-process masks into a single boolean array per contig.\n        effective_masks = []\n        for c_idx, seq in enumerate(CONTIGS):\n            mask = np.zeros(len(seq), dtype=bool)\n            # Apply repetitive masks (half-open intervals [a, b))\n            if c_idx in rep_masks:\n                for start, end in rep_masks[c_idx]:\n                    mask[start:end] = True\n            # Apply low-mappability masks (sets of indices)\n            if c_idx in lm_masks:\n                for pos in lm_masks[c_idx]:\n                    mask[pos] = True\n            effective_masks.append(mask)\n\n        # Iterate over all possible trinucleotides and count opportunities.\n        for c_idx, seq in enumerate(CONTIGS):\n            L = len(seq)\n            mask = effective_masks[c_idx]\n            # Loop for the central base position 'i' from 1 to L-2 (0-based indexing).\n            for i in range(1, L - 1):\n                # A trinucleotide is excluded if any of its 3 positions is masked.\n                if mask[i - 1] or mask[i] or mask[i + 1]:\n                    continue\n                \n                b_prev, b_mid, b_next = seq[i - 1], seq[i], seq[i + 1]\n                \n                # Exclude trinucleotides with ambiguous bases ('N').\n                if 'N' in (b_prev, b_mid, b_next):\n                    continue\n\n                # Standardize context to be pyrimidine-centered (C or T).\n                if b_mid in ('A', 'G'):  # Purine-centered\n                    std_prev = COMPLEMENT_MAP[b_next]\n                    std_mid = COMPLEMENT_MAP[b_mid]\n                    std_next = COMPLEMENT_MAP[b_prev]\n                else:  # Pyrimidine-centered\n                    std_prev, std_mid, std_next = b_prev, b_mid, b_next\n\n                # Calculate the 16-channel context index based on flanking bases.\n                # Order: 5' base (A,C,G,T), then 3' base (A,C,G,T).\n                context_idx = BASE_MAP[std_prev] * 4 + BASE_MAP[std_next]\n                \n                # Increment the count for the appropriate standardized context.\n                if std_mid == 'C':\n                    c_counts[context_idx] += 1\n                else:  # std_mid == 'T'\n                    t_counts[context_idx] += 1\n                    \n        # Construct the 96-element opportunity vector.\n        # Order: 3 classes for C (C>A,C>G,C>T) + 3 classes for T (T>A,T>C,T>G).\n        sbs96_counts = np.concatenate([c_counts] * 3 + [t_counts] * 3)\n        \n        # Normalize the vector to sum to 1.\n        total_sum = sbs96_counts.sum()\n        if total_sum == 0:\n            return [0.0] * 96\n            \n        normalized_vector = sbs96_counts / total_sum\n        \n        # Round to 6 decimal places and convert to a list of floats.\n        return np.round(normalized_vector, 6).tolist()\n\n    results = []\n    for rep_masks, lm_masks in test_cases:\n        result = calculate_sbs96_opportunities(rep_masks, lm_masks)\n        results.append(result)\n\n    # Format the output as a string representing a list of lists of floats,\n    # with no spaces, as specified by the output format example.\n    inner_parts = [f\"[{','.join(map(str, res_list))}]\" for res_list in results]\n    final_output_str = f\"[{','.join(inner_parts)}]\"\n\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "当突变目录被正确地归一化后，一个常见的首要步骤是将其与已知突变特征的数据库进行比较，以初步评估哪些致病源可能在起作用。本练习使用余弦相似度这一简单的几何度量来量化一个肿瘤突变谱与几个候选特征之间的相似性。更重要的是，它要求您从第一性原理出发，批判性地思考并论证为何这种简单的成对比较不足以进行准确的病因归因，从而深刻揭示肿瘤基因组作为多种突变过程共同作用下形成的“混合物”的本质。",
            "id": "4384034",
            "problem": "在体细胞突变特征分析中，一个肿瘤的单核苷酸变异目录可以表示为一个在固定通道（例如，三核苷酸替换背景）上的向量。一个特征是由特定病因引起的在相同通道上的特征分布，通常以概率形式报告。考虑一个科学上合理的六通道抽象模型，其中样本目录由计数向量 $x \\in \\mathbb{R}^{6}$ 给出，每个候选特征由概率向量 $s_i \\in \\mathbb{R}^{6}$ 给出，所有向量都对齐到相同的通道顺序。具体来说，设\n$$x = (40,\\,10,\\,5,\\,20,\\,15,\\,10),$$\n$$s_1 = (0.50,\\,0.10,\\,0.05,\\,0.20,\\,0.10,\\,0.05),$$\n$$s_2 = (0.30,\\,0.05,\\,0.15,\\,0.10,\\,0.25,\\,0.15),$$\n$$s_3 = (0.10,\\,0.25,\\,0.30,\\,0.10,\\,0.15,\\,0.10)。$$\n以通道空间的欧几里得几何为基本基础——其中非零向量的方向编码其相对通道构成——计算目录 $x$ 与每个特征 $s_i$ 之间的余弦相似度。然后，从精准基因组学中混合归因的基本原理出发，论证当多个特征可能同时活跃时，仅靠与单个特征的余弦相似度不足以进行病因归因。仅报告 $\\{s_1, s_2, s_3\\}$ 中最大的余弦相似度值作为你的最终答案。最终答案以小数形式表示，并四舍五入到四位有效数字。最终报告值不需要单位。",
            "solution": "该问题要求计算给定突变目录向量与三个突变特征向量之间的余弦相似度，并随后论证为什么该度量不足以进行确定的病因归因。该问题有科学依据，是良定的，并包含了得出有效解所需的所有信息。\n\n在欧几里得空间中，两个非零向量 $A$ 和 $B$ 之间的余弦相似度定义为它们之间夹角 $\\theta$ 的余弦。它使用点积和向量范数计算：\n$$ \\cos(\\theta) = \\frac{A \\cdot B}{\\|A\\| \\|B\\|} $$\n该度量衡量两个向量在方向上的相似性，而与其大小无关。在突变特征的背景下，它比较了不同通道中突变的相对比例。\n\n给定的向量是：\n样本突变目录计数向量：\n$$ x = (40, 10, 5, 20, 15, 10) $$\n三个候选特征概率向量：\n$$ s_1 = (0.50, 0.10, 0.05, 0.20, 0.10, 0.05) $$\n$$ s_2 = (0.30, 0.05, 0.15, 0.10, 0.25, 0.15) $$\n$$ s_3 = (0.10, 0.25, 0.30, 0.10, 0.15, 0.10) $$\n\n首先，我们计算每个向量的欧几里得范数（大小）。\n目录向量 $x$ 的范数：\n$$ \\|x\\| = \\sqrt{40^2 + 10^2 + 5^2 + 20^2 + 15^2 + 10^2} = \\sqrt{1600 + 100 + 25 + 400 + 225 + 100} = \\sqrt{2450} $$\n\n特征向量 $s_1$、$s_2$ 和 $s_3$ 的范数：\n$$ \\|s_1\\| = \\sqrt{0.50^2 + 0.10^2 + 0.05^2 + 0.20^2 + 0.10^2 + 0.05^2} = \\sqrt{0.25 + 0.01 + 0.0025 + 0.04 + 0.01 + 0.0025} = \\sqrt{0.315} $$\n$$ \\|s_2\\| = \\sqrt{0.30^2 + 0.05^2 + 0.15^2 + 0.10^2 + 0.25^2 + 0.15^2} = \\sqrt{0.09 + 0.0025 + 0.0225 + 0.01 + 0.0625 + 0.0225} = \\sqrt{0.21} $$\n$$ \\|s_3\\| = \\sqrt{0.10^2 + 0.25^2 + 0.30^2 + 0.10^2 + 0.15^2 + 0.10^2} = \\sqrt{0.01 + 0.0625 + 0.09 + 0.01 + 0.0225 + 0.01} = \\sqrt{0.205} $$\n\n接下来，我们计算 $x$ 与每个特征向量 $s_i$ 的点积。\n$$ x \\cdot s_1 = (40)(0.50) + (10)(0.10) + (5)(0.05) + (20)(0.20) + (15)(0.10) + (10)(0.05) = 20 + 1 + 0.25 + 4 + 1.5 + 0.5 = 27.25 $$\n$$ x \\cdot s_2 = (40)(0.30) + (10)(0.05) + (5)(0.15) + (20)(0.10) + (15)(0.25) + (10)(0.15) = 12 + 0.5 + 0.75 + 2 + 3.75 + 1.5 = 20.5 $$\n$$ x \\cdot s_3 = (40)(0.10) + (10)(0.25) + (5)(0.30) + (20)(0.10) + (15)(0.15) + (10)(0.10) = 4 + 2.5 + 1.5 + 2 + 2.25 + 1 = 13.25 $$\n\n现在，我们可以计算每个特征的余弦相似度。设 $\\text{sim}(A, B)$ 表示余弦相似度。\n$$ \\text{sim}(x, s_1) = \\frac{x \\cdot s_1}{\\|x\\| \\|s_1\\|} = \\frac{27.25}{\\sqrt{2450} \\sqrt{0.315}} = \\frac{27.25}{\\sqrt{771.75}} \\approx 0.980906 $$\n$$ \\text{sim}(x, s_2) = \\frac{x \\cdot s_2}{\\|x\\| \\|s_2\\|} = \\frac{20.5}{\\sqrt{2450} \\sqrt{0.21}} = \\frac{20.5}{\\sqrt{514.5}} \\approx 0.903778 $$\n$$ \\text{sim}(x, s_3) = \\frac{x \\cdot s_3}{\\|x\\| \\|s_3\\|} = \\frac{13.25}{\\sqrt{2450} \\sqrt{0.205}} = \\frac{13.25}{\\sqrt{502.25}} \\approx 0.591229 $$\n\n比较这三个值，最大的余弦相似度是与特征 $s_1$ 的相似度：$0.980906...$。\n\n任务的第二部分是从基本原理出发，论证为什么与单个特征的余弦相似度不足以进行病因归因。\n体细胞突变特征分析的基本原理是，在肿瘤中观察到的突变目录（由向量 $x$ 表示）是多个突变过程（病因）随时间累积作用的结果。每个过程都由一个特征向量 $s_i$ 来表征。因此，观察到的目录 $x$ 不应与单个特征完全相同，而应是所有活跃特征的线性组合。这可以表示为：\n$$ x \\approx \\sum_{i=1}^{k} a_i s_i = S a $$\n其中 $k$ 是活跃特征的数量，$s_i$ 是特征向量，$a_i \\ge 0$ 是“暴露量”或“活性”，代表每个特征贡献的突变数量，$S$ 是以特征向量 $s_i$ 为列的矩阵，$a$ 是暴露量向量。\n\n病因归因的目标是解决这个混合问题，即对复合信号 $x$ 进行解卷积以确定暴露量向量 $a$。这本质上是一个系统级问题，需要同时考虑所有候选特征。\n\n余弦相似度 $\\text{sim}(x, s_j)$ 仅衡量观察到的目录 $x$ 与*单个*特征向量 $s_j$ 之间的对齐度。高值表示 $x$ 中突变的相对比例与 $s_j$ 中的相似。然而，由于以下几个原因，这不足以进行归因：\n1.  **忽略混合效应**：一个向量 $x$ 可以是两个或多个特征向量的线性组合，例如 $x = a_1 s_1 + a_2 s_2$，但它与另一个向量 $s_3$ 或其某个分量（比如 $s_1$）的余弦相似度可能比与另一个分量更高。在高维通道空间中，向量 $x$ 可能位于特征集 $\\{s_i\\}$ 的锥包内。与基向量 $\\{s_i\\}$ 的简单两两角距离并不能揭示 $x$ 在该基下的坐标（即暴露量 $a_i$）。例如，两个特征的向量和可能指向一个与第三个不相关特征非常接近的方向，从而导致一个虚假的高相似度分数。\n2.  **缺乏排他性**：与 $s_1$ 的高度相似性并不意味着其他特征没有贡献。我们的计算显示 $\\text{sim}(x, s_1) \\approx 0.9809$，这是一个非常高的值。然而，归一化的目录 $x_{\\text{norm}} = x / \\sum x_j = (0.4, 0.1, 0.05, 0.2, 0.15, 0.1)$ 与 $s_1 = (0.5, 0.1, 0.05, 0.2, 0.1, 0.05)$ 并不相同。这些差异可能可以用其他特征（如 $s_2$ 和/或 $s_3$）的贡献来解释。\n3.  **正确的方法论**：严谨的归因方法是找到一个非负暴露量向量 $a$，以最小化重构误差，通常是欧几里得距离的平方：\n    $$ \\min_{a \\ge 0} \\| x - S a \\|^2_2 $$\n    这是一个非负最小二乘（NNLS）问题。解决这个优化问题可以提供每个候选特征的估计贡献，从而得出一个完整的病因画像。这种方法考虑了所有特征在重构观察目录时的相互作用，而这是两两之间的余弦相似度完全忽略的一个关键方面。\n\n总之，虽然余弦相似度是一种有用的启发式方法，可用于初步评估可能存在哪些特征，但它不能替代解决整个混合问题的正式解卷积。仅仅依靠最高的余弦相似度进行归因是一种不科学的过度简化，可能导致对肿瘤中活跃的突变过程得出错误结论。\n\n计算出的最大余弦相似度值约为 $0.980906$。四舍五入到四位有效数字得到 $0.9809$。",
            "answer": "$$\\boxed{0.9809}$$"
        },
        {
            "introduction": "基于前一个练习中所揭示的简单度量的局限性，本练习将引导您应对一个真实的、前沿的研究挑战：在突变数量极少的样本中，如何可靠地区分两个形态上高度相似的“扁平”特征（SBS5和SBS40）。这个以研究设计为导向的任务，挑战您像一位计算生物学家那样思考，将关于年龄相关性和跨组织稳定性等生物学先验知识，整合到一个健壮的正则化统计框架中，以实现稳健且具有生物学意义的特征归因。",
            "id": "4384019",
            "problem": "一个肿瘤基因组可以通过一个计数向量 $y \\in \\mathbb{N}^{96}$ 来概括，该向量涵盖了 $96$ 种三核苷酸单碱基替换背景。一个突变印记是一个概率向量 $s \\in \\mathbb{R}^{96}$，其中 $s_i \\ge 0$ 且 $\\sum_{i=1}^{96} s_i = 1$，表示一个突变过程在 $96$ 种背景下的相对倾向性。在混合形式中，一个突变目录由对一组印记 $\\{s_k\\}$ 的潜在非负暴露值 $x_k \\ge 0$ 生成，使得期望计数满足 $E[y] \\approx \\sum_k x_k s_k$。经过充分检验的事实包括：(i) 癌症体细胞突变目录（Catalogue Of Somatic Mutations In Cancer, COSMIC）中的单碱基替换印记 SBS1 和 SBS5 在各种组织中被广泛观察到，其中 SBS1 归因于甲基化 CpG 位点的自发脱氨，而 SBS5 是一个未知的、普遍存在的、具有弱转录链偏向性的年龄相关过程；(ii) SBS40 是一个病因未知的平坦、普遍存在的印记，在数据有限的情况下很难与 SBS5 区分；(iii) 突变印记的“平坦度”可以通过香农熵 $H(s) = -\\sum_{i=1}^{96} s_i \\log s_i$ 或方差 $\\mathrm{Var}(s) = \\frac{1}{96}\\sum_{i=1}^{96} \\left(s_i - \\frac{1}{96}\\right)^2$ 来量化，其中较小的 $\\mathrm{Var}(s)$ 和较大的 $H(s)$ 表示更高的均匀性；(iv) 跨组织的稳定性可以通过暴露值 $x_k$ 在不同组织队列中的离散度来描述，例如通过跨组织计算的变异系数 $\\mathrm{CV}_k = \\frac{\\sigma(x_k)}{\\mu(x_k)}$。\n\n考虑一项包含 $T$ 个组织队列的研究，索引为 $t \\in \\{1,\\dots,T\\}$，每个队列都有小的全基因组目录，其大小 $N^{(i)} = \\sum_{j=1}^{96} y^{(i)}_j$ 对于大多数样本 $i$ 满足 $N^{(i)} \\le 200$。候选印记集包括 SBS5（向量为 $s_5$）和 SBS40（向量为 $s_{40}$）。根据经验， $s_5$ 和 $s_{40}$ 都近乎平坦且具有高熵，但 $H(s_{40})$ 通常略高于 $H(s_5)$，且 $\\mathrm{Var}(s_{40})$ 略低于 SBS5 的相应值。SBS5 的暴露值倾向于与年龄相关，并且比 SBS40 更具跨组织稳定性，而 SBS40 则表现出更大的组织间变异性。SBS5 的转录链偏向性微弱但一致；SBS40 显示出极小或不一致的链偏向性。\n\n您的任务是设计一种有原则的方法，在这些小型目录中使用正则化拟合来归因 SBS5 与 SBS40。设 $S$ 是以候选印记向量为列的设计矩阵，并考虑使用正则化的非负最小二乘法。您可以融入基于上述事实的生物学先验（例如，年龄趋势和跨组织稳定性）。\n\n哪个提案最好地指定了科学合理、具有区分性的标准和正则化归因框架，以便在小型目录中区分 SBS5 和 SBS40，同时考虑到它们在平坦度和跨组织稳定性方面的差异？\n\nA. 通过带有最小绝对收缩和选择算子（LASSO）$L_1$ 惩罚的非负最小二乘法对每个样本的暴露值 $\\hat{x}$ 进行拟合，并通过最小化 $\\sum_i \\lVert y^{(i)} - S \\hat{x}^{(i)} \\rVert_2^2 + \\lambda \\sum_i \\lVert \\hat{x}^{(i)} \\rVert_1 + \\gamma \\sum_{t=1}^T \\mathrm{Var}\\!\\left(\\{\\hat{x}_5^{(i)}: i \\in t\\}\\right)$ 为 SBS5 添加跨队列稳定性惩罚。仅当在 bootstrap 重采样中，某个组织中 SBS5 的暴露值的变异系数低于阈值且与年龄呈正相关（Spearman $\\rho > 0$），并且印记级别的 Kullback–Leibler 散度 $D_{\\mathrm{KL}}(s_5 \\,\\Vert\\, u)$（与均匀分布 $u$ 相比）大于或等于 $D_{\\mathrm{KL}}(s_{40} \\,\\Vert\\, u)$，同时 SBS5 的转录链偏向性通过了弱显著性二项检验时，才宣布该组织中存在 SBS5。当施加了 SBS5 稳定性先验后，归因结果仍然存在，并且显示出更高的跨组织离散度（$\\mathrm{CV}_{40} > \\mathrm{CV}_5$）以及可忽略的链偏向性时，则归因为 SBS40。\n\nB. 在小型目录中优先选择 SBS40，因为它比 SBS5 更与年龄相关且更具跨组织稳定性。使用非正则化的非负最小二乘法，并选择重建误差较低的印记，因为两者都很平坦，正则化是不必要的。\n\nC. 通过 CpG 背景下胞嘧啶到胸腺嘧啶替换的比例以及微卫星不稳定性状态来区分 SBS5 和 SBS40；通过惩罚暴露值向量 $\\hat{x}$ 在 96 种背景下的偏差来强制实现平坦度，因为当印记平坦时，暴露值应该是均匀的。\n\nD. 使用组 LASSO 将所有组织中的 SBS5 和 SBS40 暴露值同等地向零收缩，而不融入年龄或稳定性先验。当 $H(s_5) > H(s_{40})$ 时选择 SBS5，因为根据定义，更平坦的印记必须是 SBS5；否则选择 SBS40。在小型目录中不需要进行 bootstrap 或链偏向性检查。",
            "solution": "### 第一步：提取已知信息\n\n1.  **计数向量**：一个肿瘤基因组的单碱基替换谱是一个计数向量 $y \\in \\mathbb{N}^{96}$，涵盖 $96$ 种三核苷酸背景。\n2.  **突变印记**：一个概率向量 $s \\in \\mathbb{R}^{96}$，满足 $s_i \\ge 0$ 和 $\\sum_{i=1}^{96} s_i = 1$。\n3.  **混合模型**：期望计数为 $E[y] \\approx \\sum_k x_k s_k$，其中 $x_k \\ge 0$ 是对一组印记 $\\{s_k\\}$ 的非负暴露值。\n4.  **经过充分检验的事实**：\n    *   (i) SBS1 和 SBS5 很常见。SBS1 与甲基化 CpG 位点的自发脱氨有关。SBS5 是一个与年龄相关的普遍过程，具有弱转录链偏向性；其病因未知。\n    *   (ii) SBS40 是一个平坦、普遍存在的印记，病因未知，在数据有限的情况下难以与 SBS5 区分。\n    *   (iii) 印记的“平坦度”通过香农熵 $H(s) = -\\sum_{i=1}^{96} s_i \\log s_i$（值越高越平坦）或方差 $\\mathrm{Var}(s) = \\frac{1}{96}\\sum_{i=1}^{96} \\left(s_i - \\frac{1}{96}\\right)^2$（值越低越平坦）来量化。\n    *   (iv) 一个印记 $s_k$ 的跨组织稳定性由其暴露值 $x_k$ 的离散度描述，例如通过跨组织队列计算的变异系数 $\\mathrm{CV}_k = \\frac{\\sigma(x_k)}{\\mu(x_k)}$。\n5.  **研究特定信息**：\n    *   研究涉及 $T$ 个组织队列，索引为 $t \\in \\{1,\\dots,T\\}$。\n    *   突变目录很小，对于大多数样本 $i$，总突变计数 $N^{(i)} = \\sum_{j=1}^{96} y^{(i)}_j \\le 200$。\n    *   候选印记是 SBS5 ($s_5$) 和 SBS40 ($s_{40}$)。\n6.  **SBS5 和 SBS40 的经验特性**：\n    *   两者都近乎平坦，具有高熵。\n    *   $H(s_{40})$ 通常略高于 $H(s_5)$。\n    *   $\\mathrm{Var}(s_{40})$ 通常略低于 $\\mathrm{Var}(s_5)$。\n    *   SBS5 的暴露值与年龄相关。\n    *   SBS5 的暴露值比 SBS40 的暴露值更具跨组织稳定性。\n    *   SBS40 的暴露值表现出更大的组织间变异性。\n    *   SBS5 具有微弱但一致的转录链偏向性。\n    *   SBS40 显示出极小或不一致的链偏向性。\n7.  **任务**：设计一种有原则的、基于正则化拟合的方法，利用所提供的事实作为先验，来归因小型目录中的 SBS5 与 SBS40。基本方法是基于设计矩阵 $S$（其列为印记）和暴露值向量 $x$ 的非负最小二乘法。\n\n### 第二步：使用提取的已知信息进行验证\n\n问题陈述基于计算癌症基因组学和突变印记分析这一成熟的科学领域。\n-   **科学基础**：所有概念，包括突变印记、$96$ 种背景、混合模型（通常用非负矩阵分解或 NNLS 求解）、香农熵、方差以及特定 COSMIC 印记（SBS1、SBS5、SBS40）的特性，都符合该领域的当前文献，是标准的且事实正确。在低突变计数样本中区分像 SBS5 和 SBS40 这样相似的印记的挑战是一个真实、重要且被积极研究的问题。\n-   **问题适定性**：问题是适定（well-posed）的。它要求根据一组明确定义的科学事实和约束（低突变计数、印记相似性）来评估几种提议的方法。目标是找到“最佳”提案，这是一个基于科学和统计原则的标准比较评估任务。\n-   **客观性**：问题使用来自统计学和基因组学的精确、客观的术语来陈述。所提供的“事实”是作为该领域的经验发现呈现的，这是构建新分析方法的正确基础。\n-   **一致性和完整性**：所提供的信息内部一致，并且足以评估各个选项。例如，SBS40 稍微“更平坦”的陈述与更高的熵和更低的方差这两个定义是一致的。任务的难度源于印记的相似性和样本信息量低（$N \\le 200$），这证明了正则化和使用先验的必要性。\n\n### 第三步：判断与行动\n\n问题陈述是**有效的**。它科学合理、适定、客观，并为有原则的分析提供了清晰的基础。我现在将进行求解。\n\n### 求解推导\n\n核心任务是从稀疏的计数数据（$y^{(i)}$ 其中 $\\sum y_j^{(i)} \\le 200$）中区分两个非常相似（“平坦”）的突变印记，$s_5$ 和 $s_{40}$。印记向量的相似性意味着设计矩阵 $S$ 中对应于 $s_5$ 和 $s_{40}$ 的列高度相关。这导致了一个病态（ill-conditioned）的优化问题，其中似然函数 $\\mathcal{L}(x | y, S)$ 很平坦，使得暴露值 $x_5$ 和 $x_{40}$ 不可辨识。数据 $y$ 的微小变化可能导致估计暴露值的剧烈波动，贡献值常常在 $x_5$ 和 $x_{40}$ 之间任意交换。\n\n对抗这种病态问题的标准方法是**正则化**，它在目标函数中引入一个惩罚项，以偏好那些基于先验知识“更合理”的解。问题陈述提供了几个 SBS5 和 SBS40 之间的关键区别特征，可以作为先验来构建：\n\n1.  **年龄关联性**：SBS5 的暴露值与年龄相关。\n2.  **跨组织稳定性**：SBS5 的暴露值在不同组织间比 SBS40 更稳定（变异性更小）。\n3.  **转录链偏向性 (TSB)**：SBS5 有微弱但一致的 TSB；SBS40 则没有。\n\n一个有原则的方法必须利用这些差异。一个通用的正则化非负最小二乘框架旨在最小化：\n$$ \\arg\\min_{x \\ge 0} \\lVert y - Sx \\rVert_2^2 + \\lambda_1 P_1(x) + \\lambda_2 P_2(x) + \\dots $$\n其中 $\\lVert y - Sx \\rVert_2^2$ 是重建误差项，而 $P_j(x)$ 是编码先验的惩罚函数。\n\n一个好的框架应该：\n1.  使用一个通用的稀疏性诱导正则化器，如 $L_1$ 范数（LASSO），以反映生物学假设，即任何给定肿瘤中只有少数突变过程是活跃的。这有助于防止相关印记之间的暴露值“渗漏”。\n2.  引入一个特定的惩罚，鼓励解与已知的 SBS5 和 SBS40 的属性保持一致。对于跨多个样本的联合拟合，最有力的先验是 SBS5 的跨组织稳定性。这可以通过惩罚每个组织队列 $t$ 内 SBS5 暴露值 $\\{x_5^{(i)}\\}$ 的高方差来实现。\n3.  使用其他已知属性（年龄相关性、TSB）作为事后验证标准，以确认归因结果。鉴于计数较低，在单个样本上评估这些属性是不可能的；它们必须在队列级别上进行评估。\n4.  采用自助法（bootstrapping）等重采样技术来估计暴露值归因的不确定性和稳定性。这对于低信息量数据至关重要。\n\n### 逐项分析\n\n**A. 通过带有最小绝对收缩和选择算子（LASSO）$L_1$ 惩罚的非负最小二乘法对每个样本的暴露值 $\\hat{x}$ 进行拟合，并通过最小化 $\\sum_i \\lVert y^{(i)} - S \\hat{x}^{(i)} \\rVert_2^2 + \\lambda \\sum_i \\lVert \\hat{x}^{(i)} \\rVert_1 + \\gamma \\sum_{t=1}^T \\mathrm{Var}\\!\\left(\\{\\hat{x}_5^{(i)}: i \\in t\\}\\right)$ 为 SBS5 添加跨队列稳定性惩罚。仅当在 bootstrap 重采样中，某个组织中 SBS5 的暴露值的变异系数低于阈值且与年龄呈正相关（Spearman $\\rho > 0$），并且印记级别的 Kullback–Leibler 散度 $D_{\\mathrm{KL}}(s_5 \\,\\Vert\\, u)$（与均匀分布 $u$ 相比）大于或等于 $D_{\\mathrm{KL}}(s_{40} \\,\\Vert\\, u)$，同时 SBS5 的转录链偏向性通过了弱显著性二项检验时，才宣布该组织中存在 SBS5。当施加了 SBS5 稳定性先验后，归因结果仍然存在，并且显示出更高的跨组织离散度（$\\mathrm{CV}_{40} > \\mathrm{CV}_5$）以及可忽略的链偏向性时，则归因为 SBS40。**\n\n-   **框架**：目标函数是有原则的。它结合了标准的重建项、用于稀疏性的 $L_1$ 惩罚，以及一个新颖的、理论驱动的惩罚项 $\\gamma \\sum_{t=1}^T \\mathrm{Var}\\!\\left(\\{\\hat{x}_5^{(i)}: i \\in t\\}\\right)$，该惩罚项直接编码了关于 SBS5 稳定性的先验生物学知识。\n-   **验证**：它提出了一套全面的事后验证检查，使用了所有可用的先验信息：用于稳定性的 bootstrap、检查 SBS5 的年龄相关性、对 SBS5 进行 TSB 测试，以及验证相对的跨组织离散度（$\\mathrm{CV}_{40} > \\mathrm{CV}_5$）。\n-   **平坦度检查**：条件 $D_{\\mathrm{KL}}(s_5 \\,\\Vert\\, u) \\ge D_{\\mathrm{KL}}(s_{40} \\,\\Vert\\, u)$ 等价于 $H(s_5) \\le H(s_{40})$（因为 $H(s) = \\log(96) - D_{\\mathrm{KL}}(s\\|u)$），这与提供的事实——SBS40 通常比 SBS5 更平坦（具有更高的熵）——是一致的。这是一个合理的健全性检查。\n-   **结论**：这个提案在统计上是成熟的，在科学上是合理的，并且在一个连贯的框架中使用了问题陈述中提供的所有区分性信息。\n-   **判断**：**正确**。\n\n**B. 在小型目录中优先选择 SBS40，因为它比 SBS5 更与年龄相关且更具跨组织稳定性。使用非正则化的非负最小二乘法，并选择重建误差较低的印记，因为两者都很平坦，正则化是不必要的。**\n\n-   **事实依据**：其前提“SBS40 比 SBS5 更与年龄相关且更具跨组织稳定性”直接与问题陈述中给出的事实相矛盾，陈述的事实恰恰相反。\n-   **方法论**：提议使用“非正则化的非负最小二乘法”在统计上是幼稚的。对于高度相关的预测变量（如 $s_5$ 和 $s_{40}$）和含噪声的数据，非正则化方法非常不稳定，会产生不可靠的暴露值估计。正则化是必不可少的，而非不必要。仅仅依赖“较低的重建误差”不足以区分两个几乎同样能很好地解释数据的印记。\n-   **判断**：**不正确**。\n\n**C. 通过 CpG 背景下胞嘧啶到胸腺嘧啶替换的比例以及微卫星不稳定性状态来区分 SBS5 和 SBS40；通过惩罚暴露值向量 $\\hat{x}$ 在 96 种背景下的偏差来强制实现平坦度，因为当印记平坦时，暴露值应该是均匀的。**\n\n-   **生物学标准**：问题陈述指出 SBS1 与 CpG 脱氨有关，并未提供此作为 SBS5 和 SBS40 之间的关键区分因素。微卫星不稳定性（MSI）与另一组不同的印记相关，也未被提及与 SBS5 或 SBS40 有关。这引入了不相关的信息。\n-   **概念性错误**：陈述“通过惩罚暴露值向量 $\\hat{x}$ 在 96 种背景下的偏差来强制实现平坦度”表明了一个根本性的误解。印记（$s_k$）是关于 $96$ 种背景的向量；它们可以是平坦的。暴露值（$\\hat{x}$）是关于 $K$ 个印记的向量。一个暴露值向量不可能“在 96 种背景下平坦”，因为它没有与替换类型相关的 $96$ 个分量。以这种方式混淆印记的属性和其暴露值向量的属性是一个概念性错误。\n-   **判断**：**不正确**。\n\n**D. 使用组 LASSO 将所有组织中的 SBS5 和 SBS40 暴露值同等地向零收缩，而不融入年龄或稳定性先验。当 $H(s_5) > H(s_{40})$ 时选择 SBS5，因为根据定义，更平坦的印记必须是 SBS5；否则选择 SBS40。在小型目录中不需要进行 bootstrap 或链偏向性检查。**\n\n-   **方法论**：使用组 LASSO `同等地`、`不融入年龄或稳定性先验`地收缩 SBS5 和 SBS40，这恰恰是错误的方法。它没有利用非对称的信息，而这正是区分它们的关键。问题要求一种基于已知先验对它们进行*不同*处理的方法。\n-   **事实依据**：决策规则“当 $H(s_5) > H(s_{40})$ 时选择 SBS5”基于 SBS5 更平坦的前提。这直接与问题陈述相矛盾，陈述中明确指出通常是 $H(s_{40})$ 略高于 $H(s_5)$。这个规则会系统地错误分类这些印记。\n-   **统计实践**：声称“不需要进行 bootstrap 或链偏向性检查”是糟糕的建议。不确定性量化（通过 bootstrap）和使用正交证据（如链偏向性）在处理稀疏、噪声数据和病态问题时尤其关键。\n-   **判断**：**不正确**。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}