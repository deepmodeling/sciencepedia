## 引言
多基因风险评分（Polygenic Risk Scores, PRS）已成为连接基础基因组学发现与个体化健康评估的关键工具。通过整合数以万计的微小遗传效应，PRS能够量化个体对心血管疾病、糖尿病、癌症等多种复杂性状的遗传易感性，为[精准医疗](@entry_id:152668)的实现提供了前所未有的机遇。然而，从海量的[全基因组](@entry_id:195052)关联研究（GWAS）数据到生成一个具有临床意义的评分，其过程充满了复杂的统计原理、计算挑战和潜在的解读陷阱。此外，PRS的广泛应用也带来了深刻的伦理和社会考量，这些都是研究者和临床医生必须面对的现实问题。

本文旨在系统性地剖析多基因风险评分的完整生命周期，为读者构建一个坚实的理论与实践知识框架。我们将首先在“原理与机制”一章中，深入探讨PRS的数学定义、权重来源、变异选择策略以及保证[数据质量](@entry_id:185007)的关键步骤，并阐述其性能评估方法与理论局限性。接下来，在“应用与跨学科连接”一章，我们将视野拓展至临床医学、公共卫生和药物研发等领域，展示PRS如何改进风险预测模型、指导预防策略，并探讨其带来的伦理、法律和社会挑战。最后，通过“动手实践”部分介绍的一系列核心练习，读者将有机会将理论知识应用于实际操作，巩固对PRS构建与解释的理解。通过这三个层层递进的章节，本文将引导您全面掌握这一前沿技术。

## 原理与机制

本章旨在深入阐述多基因风险评分（Polygenic Risk Scores, PRS）的核心原理与关键机制。我们将从其数学定义出发，系统性地探讨如何构建、应用和评估PRS，并揭示其理论基础与固有限制。本章假定读者已对基因组学和统计学的基本概念有所了解，内容将以前一章的“引言”为基础展开。

### 多基因风险评分的基本定义

从概念上讲，一个人的多基因风险评分是其遗传易感性的量化估计，通过汇总多个遗传变异的影响计算得出。其最常见的数学形式是一个加权和，表示为：

$$
S_i = \sum_{j=1}^{M} w_j x_{ij}
$$

在这个基础模型中，每个组成部分都有其精确的含义：
-   $S_i$ 是个体 $i$ 的多基因风险评分。
-   $j$ 是遗传变异的索引，通常是单核苷酸多态性（Single Nucleotide Polymorphism, SNP），总数为 $M$。
-   $x_{ij}$ 是个体 $i$ 在变异位点 $j$ 的基因型。最常见的编码方式是**加性编码（additive coding）**，即计算某个特定“效应等位基因”的拷贝数。对于二倍体生物，该值通常为 $0$、$1$ 或 $2$。在处理来自[基因型填充](@entry_id:163993)（genotype imputation）的数据时，$x_{ij}$ 也可以是一个在 $[0, 2]$ 区间内的连续值，称为**等位基因剂量（allele dosage）**，代表效应等位基因拷贝数的[期望值](@entry_id:150961) 。
-   $w_j$ 是分配给变异位点 $j$ 的**权重（weight）**。这个权重反映了该变异对所研究性状或疾病风险的[边际效应](@entry_id:634982)大小和方向。这些权重通常来源于大规模的[全基因组](@entry_id:195052)关联研究（Genome-Wide Association Studies, GWAS）。

这个看似简单的[线性模型](@entry_id:178302)构成了PRS的核心，但其准确构建和合理解读依赖于对每个组成部分的深入理解，尤其是权重的来源和单位。

### 从全基因组关联研究（GWAS）推导权重

PRS的权重并非随意设定，而是直接源于GWAS提供的效应量估计。GWAS通过逐一检验数百万个SNP与特定性状的关联，为每个SNP提供效应量估计（$\hat{\beta}$）、标准误（SE）和关联显著性（$p$-value）等汇总统计数据 。权重的具体单位和解释取决于[GWAS分析](@entry_id:264205)的性状类型和所使用的[统计模型](@entry_id:755400)。

#### 连续性状与[线性回归](@entry_id:142318)

当[GWAS分析](@entry_id:264205)的是一个连续性状（如身高、血压）时，通常使用**线性回归模型**。模型形式为 $E[Y | X] = \alpha + \sum_{j=1}^{M} \beta_j X_j$，其中 $Y$ 是性状值，$X_j$ 是SNP $j$ 的基因型编码。

在这种情况下，[回归系数](@entry_id:634860) $\beta_j$ 表示每增加一个效应等位基因，性状值的期望变化量。因此，PRS的权重 $w_j$ 通常直接设为GWAS估计的效应量 $\hat{\beta}_j$。其单位是“性状单位/每效应等位基因拷贝”。例如，如果性状是身高（单位：厘米），则 $w_j$ 的单位是“厘米/等位基因” 。

有时，为了方便比较不同研究的结果，GWAS可能会对一个经过**z-score标准化**（均值为0，方差为1）的性状进行分析。此时，得到的权重 $w_j$ 的单位是“性状标准差单位/等位基因”。要将其转换回自然单位，需要将该权重乘以原始GWAS研究群体中性状的标准差（$\sigma_Y$）。

#### 二元性状与逻辑回归

当[GWAS分析](@entry_id:264205)的是一个二元性状，尤其是疾病状态（如病例vs.对照）时，标准方法是**逻辑[回归模型](@entry_id:163386)**。该模型对疾病发生概率 $P(D=1)$ 的对数优势（log-odds）进行建模：

$$
\operatorname{logit}\{P(D=1 \mid X)\} = \log\left(\frac{P(D=1 \mid X)}{1-P(D=1 \mid X)}\right) = \alpha + \sum_{j=1}^{M} \beta_j X_j
$$

这里的系数 $\beta_j$ 代表每增加一个效应等位基因，疾病风险对数优势的变化量。因此，PRS权重 $w_j$ 的单位是“对数优势/等位基因”。GWAS报告通常提供的是**优势比（Odds Ratio, OR）**，它与[回归系数](@entry_id:634860)的关系是 $\mathrm{OR}_j = \exp(\beta_j)$。为了构建一个在对数优势尺度上具有可加性的PRS，必须使用对数转换后的OR作为权重，即 $w_j = \log(\mathrm{OR}_j)$。这样构建的PRS总分 $S_i$ 就代表了个体相对于基线的总遗传对数优势  。

一个关键的统计学特性是，在**病例-对照研究（case-control study）**中，即使病例和对照的抽样比例与人群中的实际患病率不符，逻辑回归估计出的斜[率参数](@entry_id:265473)（$\beta_j$，即log-odds ratios）仍然是无偏的。只有截距项（$\alpha$）会受到抽样比例的影响。这意味着从病例-对照GWAS中获得的权重 $w_j = \log(\mathrm{OR}_j)$ 是可移植的，可以用于在其他人群中构建PRS。然而，将这样的PRS分数转换成绝对风险（即概率）时，则需要根据目标人群的基线患病率对模型的截距进行校准  。

### 从百万变异到实用评分：SNP选择策略

GWAS通常会提供数百万个SNP的汇总统计数据。直接将所有SNP纳入PRS是不可行的，原因有二：首先，绝大多数SNP与性状无关，它们的效应量估计主要是噪音；其次，由于**[连锁不平衡](@entry_id:146203)（Linkage Disequilibrium, LD）**，邻近的SNP在遗传上高度相关，它们的效应量估计不是独立的。简单地将它们的[边际效应](@entry_id:634982)（marginal effects）相加会重复计算同一遗传信号，导致PRS的预测性能下降。因此，必须采用策略来选择一部分信息量最大且相对独立的SNP。

#### 聚集与阈值化（Clumping and Thresholding, C+T）

**聚集与阈值化（C+T）**是构建PRS最常用的一种[启发式方法](@entry_id:637904)。它通过两个关键步骤来筛选SNP ：

1.  **阈值化（Thresholding）**：设定一个GWAS关联显著性的 $p$-value 阈值，记为 $p_T$。只有 $p$-value 小于或等于 $p_T$ 的SNP才被视为候选SNP。这个步骤旨在过滤掉大量与性状无关的SNP。

2.  **聚集（Clumping）**：这是一个处理LD问题的迭代过程。
    *   首先，将所有候选SNP按其 $p$-value 从小到大排序。
    *   选择最显著的SNP（$p$-value最小）作为“索引SNP”（index SNP），并将其保留在最终的SNP集合中。
    *   然后，检查位于该索引SNP一定物理距离窗口（例如，500kb，记为 $W$）内的所有其他SNP。如果某个SNP与索引SNP的LD（通常用相关系数的平方 $r^2$ 度量）超过一个设定的阈值（例如，$r^2_T=0.1$），则该SNP被“聚集”到索引SNP下并从候选列表中移除。
    *   重复上述过程，从剩余的候选SNP中选择下一个最显著的SNP作为新的索引SNP，直到候选列表为空。

通过这个过程，C+T方法为每个LD区域选择一个最具代表性的SNP，从而得到一组近似独立的SNP用于计算PRS。这些被选中SNP的权重 $w_j$ 就是它们在原始GWAS中的效应量估计 $\hat{\beta}_j$（或 $\log(\mathrm{OR}_j)$）。$p_T$、$r^2_T$ 和 $W$ 是需要优化的超参数。

值得注意的是，C+T是一种简单有效但较为粗糙的方法。更先进的**LD调整方法**（如LDpred、PRS-CS）则试图通过一个外部LD参考面板来对所有SNP的[边际效应](@entry_id:634982)量进行数学调整，以估算出它们的联合效应（joint effects），而不是简单地丢弃相关SNP。这些方法通常能获得更好的预测性能，但计算也更为复杂 。

### 实践中的关键步骤：[数据一致性](@entry_id:748190)与混杂控制

在将理论模型付诸实践时，有两个步骤对于保证PRS的有效性和准确性至关重要：等位基因统一和群体分层校正。

#### 等位基因统一（Allele Harmonization）

构建PRS时，我们需要将来自GWAS汇总统计的效应等位基因及其效应量，与目标队列个体基因型数据中的等位基因进行匹配。这个过程称为**等位基因统一**。如果匹配错误，可能会导致效应方向反转，严重影响PRS的准确性。一个稳健的统一算法流程如下 ：

1.  **检查坐标和等位基因**：首先确保GWAS和目标队列使用相同的基因组版本和坐标。
2.  **直接匹配**：对于一个给定的SNP，比较GWAS报告的等位基因对（如 {A, G}）和目标数据中的等位基因对。如果完全相同，则可以直接将GWAS的效应等位基因映射到目标数据中。
3.  **链翻转匹配（Strand Flip）**：如果等位基因对不直接匹配，检查它们是否互为沃森-克里克互补对（A-T, G-C）。例如，如果GWAS报告为 {A, G}，而目标数据为 {T, C}，这表明它们来自不同的DNA链。此时，需要将GWAS的效应等位基因进行互补转换（如效应等位基因为A，则在目标数据中应对应T），然后再进行计数。效应量 $\beta$ 的符号保持不变。
4.  **处理回文SNP（Palindromic SNPs）**：A/T和G/C这类SNP是回文的，因为它们的等位基因互为互补。这造成了链方向的模糊性：我们无法仅通过等位基因本身来判断GWAS中的A是对应目标数据中的A（同链）还是T（[反链](@entry_id:272997)）。一个常见的解决策略是利用等位基因频率。只有当该SNP的次要等位基因频率（Minor Allele Frequency, MAF）远低于0.5（例如， 0.4），并且在GWAS和目标队列中的MAF非常接近时，才尝试通过匹配次要等位基因来确定方向。否则，为避免错误，最安全的做法是直接丢弃该SNP。
5.  **丢弃不匹配项**：如果一个SNP不满足以上任何一种匹配情况，则应将其从分析中剔除。

#### 控制[群体分层](@entry_id:175542)（Population Stratification）

**[群体分层](@entry_id:175542)**是指样本由具有不同祖源背景的亚群组成，这些亚群在[等位基因频率](@entry_id:146872)上存在系统性差异。由于祖源也可能与影响性状的非遗传因素（如环境、生活方式）相关，因此它可能成为一个**[混杂变量](@entry_id:199777)（confounder）**，导致基因型与性状之间的虚假关联。

在PRS分析中，如果不加以校正，群体分层可能导致PRS与结果之间出现[假阳性](@entry_id:635878)关联。标准的校正方法是使用**[主成分分析](@entry_id:145395)（Principal Component Analysis, PCA）**。通过对[全基因组](@entry_id:195052)SNP数据进行PCA，可以得到一系列主成分（PCs），其中前几个PCs通常能够有效地捕捉样本间的祖源差异。将这些PCs作为协变量纳入关联分析模型中，可以在很大程度上校正由群体分层引起的混杂 。

从因果推断的角度看，祖源（A）是PRS（R）和表型（Y）的[共同原因](@entry_id:266381)，形成一个混杂路径 $R \leftarrow A \rightarrow Y$。PCs可以作为祖源A的一个良好代理（proxy），在[回归模型](@entry_id:163386)中对PCs进行校正，相当于阻断了这条“后门路径”，从而得到对PRS直接效应更准确的估计。从线性代数的角度看，这相当于将PRS和表型都投影到PCs所张成的空间的**[正交补](@entry_id:149922)空间**中，再评估它们之间的残差关联，从而移除了祖源结构的影响 。

### PRS性能的解读与评估

构建PRS后，必须对其性能进行严格的评估，以了解其预测能力和临床应用的潜力。

#### 关联强度的量化

一个常用的衡量PRS与疾病关联强度的指标是**“每标准差PRS的[对数优势比](@entry_id:141427)” (log-odds per standard deviation of PRS)**。这个指标通过在目标队列中拟合一个逻辑[回归模型](@entry_id:163386)来估计，模型以疾病状态为因变量，以**标准化后（均值为0，标准差为1）的PRS**为[自变量](@entry_id:267118)，同时校正年龄、性别、PCs等协变量。

标准化PRS的回归系数 $\hat{\beta}_Z$ 直接代表了PRS每增加一个标准差，疾病风险的对数优势增加的量。相应的**每标准差优势比（OR per SD）**为 $\exp(\hat{\beta}_Z)$。其95%[置信区间](@entry_id:138194)可以通过 exponentiating $\hat{\beta}_Z$ 的[置信区间](@entry_id:138194)得到，即 $\exp(\hat{\beta}_Z \pm 1.96 \times \text{SE}(\hat{\beta}_Z))$ 。

如果使用的是原始（未标准化的）PRS（记为$R$，其标准差为$\sigma_R$），其回归系数为$\hat{\beta}_R$，那么这两个系数之间的关系是 $\hat{\beta}_Z = \hat{\beta}_R \times \sigma_R$。这提供了一种在不同研究之间比较PRS效应大小的标准化方法 。

#### 预测准确性与校准度

除了关联强度，评估PRS作为预测模型的性能还涉及两个方面：

1.  **区分度（Discrimination）**：指模型区分高风险和低风险个体的能力。常用指标是**受试者工作特征曲线下面积（Area Under the Receiver Operating Characteristic Curve, [AUROC](@entry_id:636693)）**。[AUROC](@entry_id:636693)为1表示完美区分，0.5表示无区分能力（随机猜测）。

2.  **校准度（Calibration）**：指模型的预测风险与实际观测风险的一致性。一个校准良好的模型，如果它预测某群体的平均风险为10%，那么该群体中实际发生疾病的比例也应该接近10%。对于逻辑回归模型，校准度可以通[过拟合](@entry_id:139093)一个**[校准模型](@entry_id:180554)**来评估：

    $$
    \operatorname{logit}(\Pr(Y_i=1)) = \alpha + \beta \cdot s_i
    $$

    其中 $s_i$ 是个体 $i$ 的原始PRS（即对数优势）。$\alpha$ 称为**校准截距**，$\beta$ 称为**校准斜率**。理想情况下，一个完美校准的模型应有 $\alpha=0$ 和 $\beta=1$ 。
    -   **截距 $\alpha$** 反映了系统性的绝对风险预测偏差。$\alpha > 0$ 表示模型系统性地**低估**了风险，而 $\alpha  0$ 表示模型系统性地**高估**了风险。
    -   **斜率 $\beta$** 反映了预测风险的离散程度。$\beta  1$ 意味着模型的预测过于极端（高风险预测过高，低风险预测过低），通常是**[过拟合](@entry_id:139093)（overfitting）**的标志，也称为预测的**[过度离散](@entry_id:263748)（overdispersion）**。$\beta > 1$ 则表示模型的预测过于保守，即**离散不足（underdispersion）** 。

#### 避免乐观偏差：[嵌套交叉验证](@entry_id:176273)

许多PRS构建方法（如C+T）包含需要优化的超参数（如$p_T$）。如果在同一数据集上选择超参数并评估最终性能，会导致**数据泄露（data leakage）**和**过拟合**，从而得到一个过于乐观的性能估计。

为了获得对[模型泛化](@entry_id:174365)性能的[无偏估计](@entry_id:756289)，必须采用**[嵌套交叉验证](@entry_id:176273)（nested cross-validation）**方案 。
-   **外层循环**：将整个数据集分成 $K$ 个折（folds）。每次循环，取一折作为外层[测试集](@entry_id:637546)，其余 $K-1$ 折作为外层[训练集](@entry_id:636396)。外层循环的目的是评估最终模型的性能。
-   **内层循环**：在每个外层[训练集](@entry_id:636396)内部，再进行一次交叉验证（例如，$J$ 折）。内层循环的唯一目的是在不接触外层[测试集](@entry_id:637546)的情况下，为该外层训练集选择最优的超参数组合。
-   **评估**：对于每个外层循环，使用内层循环选出的最优超参数，在完整的外层训练集上重新训练整个PRS构建流程（包括所有[数据依赖](@entry_id:748197)的步骤，如PC计算、[校准模型](@entry_id:180554)拟合等）。然后，将得到的最终模型应用于完全独立的外层[测试集](@entry_id:637546)上，计算性能指标（如[AUROC](@entry_id:636693)、校准斜率）。
-   **最终性能**：将 $K$ 次外层循环得到的性能指标进行平均，该平均值即为对整个建模策略（包括超参数选择过程）泛化性能的[无偏估计](@entry_id:756289)。

### 理论基础与局限性

#### 遗传度：PRS性能的理论上限

一个性状的**遗传度（heritability）**是指其[表型方差](@entry_id:274482)中可归因于遗传因素的比例。理解不同类型的遗传度有助于我们认识PRS的理论潜力。
-   **狭义SNP遗传度（Narrow-sense SNP heritability, $h^2_{\mathrm{SNP}}$）**：特指由GWAS中常见SNP的**加性效应**所能解释的[表型方差](@entry_id:274482)比例。这是基于常见SNP构建的PRS所能达到的理论性能上限 。
-   **狭义遗传度（$h^2$）**：指由**所有**遗传变异（包括常见、稀有、[结构变异](@entry_id:173359)等）的加性效应解释的[方差比](@entry_id:162608)例，通常通过家族研究估计。
-   **广义遗传度（$H^2$）**：指由**所有**遗传因素（包括加性效应、显性效应和[上位性](@entry_id:136574)效应）解释的[方差比](@entry_id:162608)例。

一般而言，存在这样的关系：$h^2_{\mathrm{SNP}} \le h^2 \le H^2$。$h^2_{\mathrm{SNP}}$ 可以通过GWAS汇总统计数据和LD参考面板（如使用LD Score Regression等方法）进行估计，但这需要一系列假设，包括性状的遗传结构符合特定模型、LD参考面板与GWAS人群匹配、以及不存在与LD结构相关的混杂等 。

#### 跨祖源应用的挑战：PRS的可移植性

PRS的一个主要局限是其**可移植性（portability）**较差。在一个祖源人群（主要是欧洲人群）中开发的PRS，在应用于其他祖源人群时，其预测性能通常会显著下降。

这种现象的根本原因在于不同人群之间**[等位基因频率](@entry_id:146872)**和**连锁不平衡（LD）模式**的差异。PRS的权重是基于训练人群的LD结构估算出的[边际效应](@entry_id:634982)。当这些权重被应用于一个LD结构不同的新人群时，它们就不再能准确地反映SNP的真实效应 。

我们可以通过一个简单的模型来量化这一效应。假设一个因果SNP $C$ 的真实效应为 $\beta_C$，但我们使用一个与之连锁的标签SNP $T$ 来构建PRS。在训练人群A中，估计的权重为 $\hat{\beta}_T^A \approx \beta_C \frac{D_A}{p_T^A(1-p_T^A)}$，其中 $D_A$ 是LD系数，$p_T^A$ 是[等位基因频率](@entry_id:146872)。当将这个权重应用于测试人群B时，真实遗传效应（$\beta_C X_C$）与PRS（$\hat{\beta}_T^A X_T$）之间的校准斜率 $s_B$ 可以表示为：

$$
s_B = \frac{D_B p_T^A(1-p_T^A)}{D_A p_T^B(1-p_T^B)}
$$

从这个公式可以看出，只有当两个人群的LD ($D$) 和等位基因频率 ($p_T$) 相同时，校准斜率 $s_B$ 才等于1。任何差异都会导致 $s_B \neq 1$，即模型失校准，从而降低PRS的预测性能 。这为解决PRS的跨祖源公平性问题提出了重大的科学挑战。