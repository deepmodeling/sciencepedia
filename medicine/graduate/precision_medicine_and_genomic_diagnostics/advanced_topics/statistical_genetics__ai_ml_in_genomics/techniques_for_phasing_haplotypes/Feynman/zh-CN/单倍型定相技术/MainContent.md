## 引言
想象一下，我们的基因组是由分别来自父母的两部巨著构成的。现代测序技术使我们能够识别出书中的所有“单词”（[等位基因](@entry_id:906209)），但一个更深层次的挑战在于，当两个变异出现在同一页上时，我们如何知道它们是源自同一本书，还是分属于两本书？仅仅知道基因型是不够的，我们必须重建每一本书的原始篇章。这个过程——将[杂合的](@entry_id:276964)基因型分解为构成它们的亲本[等位基因](@entry_id:906209)序列——就是**[单倍型定相](@entry_id:906999)（haplotype phasing）**，它是从基因序列到生物学功能的关键一步。

为何区分这些序列如此重要？因为[等位基因](@entry_id:906209)的[排列](@entry_id:136432)方式直接决定了其临床意义。例如，一个基因上的两个有害变异如果位于同一条[染色体](@entry_id:276543)上（顺式），个体通常是健康的携带者；但如果它们分别位于两条不同的[染色体](@entry_id:276543)上（反式），则可能导致严重的[遗传病](@entry_id:261959)。这种差异凸显了定相在精准诊断和治疗决策中的核心地位。本文旨在系统性地阐述[单倍型定相](@entry_id:906999)的技术和应用，帮助读者构建一个完整的知识框架。

在接下来的内容中，我们将分三部分深入探讨这个主题。**“原理与机制”**一章将详细解释单倍型的基本概念，并系统介绍基于家系、测序读长和群体的三大类定相方法及其背后的统计与计算原理。随后，**“应用与[交叉](@entry_id:147634)学科联系”**一章将展示定相技术如何在[临床遗传学](@entry_id:260917)、[癌症基因组学](@entry_id:143632)和群体遗传学等领域发挥变革性作用。最后，**“动手实践”**部分将提供具体的计算练习，让您亲身体验定相分析的核心步骤。现在，让我们首先进入[单倍型定相](@entry_id:906999)的底层世界，探索其基本原理与实现机制。

## 原理与机制

想象一下，我们每个人的基因组都像是两本几乎一模一样的巨著，一本来自母亲，一本来自父亲。现代测序技术让我们能够以惊人的速度“阅读”这两本书，识别出其中的文字——也就是我们的基因型。然而，一个更深层次的挑战随之而来：当我们在这两本书的同一页上发现两个不同的“单词”（[等位基因](@entry_id:906209)）时，我们如何知道哪个单词属于母亲那本书，哪个属于父亲那本书？仅仅知道存在差异是不够的。我们需要重建每一本书的完整、原始的篇章。这个过程，就是**[单倍型定相](@entry_id:906999)（haplotype phasing）**。

### 生命的两本“书”：单倍型与二倍型

在遗传学中，我们从父母任何一方继承的单个[染色体](@entry_id:276543)上的一系列[等位基因](@entry_id:906209)，被称为**单倍型（haplotype）**。它就像是生命之书的一个完整副本。由于我们是二倍体生物，我们的每个细胞（除了生殖细胞）都包含两套[染色体](@entry_id:276543)，因此我们拥有两本这样的书。这两本“书”的组合，即一对同源[染色体](@entry_id:276543)，被称为**二倍型（diplotype）**。

对于基因组中我们是[杂合子](@entry_id:276964)（heterozygous）的位点，比如在一个位置上，母亲的书上写着“A”，父亲的书上写着“G”，那么这两本“书”在该位置上的内容是互补的。如果我们用 $0$ 代表参考[等位基因](@entry_id:906209)，用 $1$ 代表变异[等位基因](@entry_id:906209)，那么在所有杂合位点上，一个单倍型是 $h_1$，另一个必然是它的“反义”版本 $h_2$。这意味着在任何一个杂合位点 $p$ 上，它们的值都满足 $h_1(p) + h_2(p) = 1$。

从根本上说，一个人的二倍型状态不是一个有序的组合 $(h_1, h_2)$，而是一个无序的集合 $\{h_1, h_2\}$。毕竟，将母亲的[染色体](@entry_id:276543)称为“第一本”还是“第二本”纯粹是人为的标签；这两种标签互换后，其生物学现实是完全相同的 。定相的本质，就是要从混杂的基因测序数据中，准确地重建出这两个既独立又互补的单倍型 $h_1$ 和 $h_2$。

### 为何要定相？一个关于“两个坏零件”的故事

你可能会问，既然我们已经知道了在某个基因上存在哪些变异，为什么还要费心去确定它们各自在哪条[染色体](@entry_id:276543)上呢？这不仅仅是学术上的好奇，它直接关系到临床诊断和治疗。

想象一个基因是制造某个关键机器零件的蓝图。现在，一个人的[基因检测](@entry_id:266161)发现，这份蓝图上有两个不同的错误指令，$v_1$ 和 $v_2$，每个错误都可能导致零件失灵。这时，定相就成了决定性的诊断工具 。

- **顺式构型（Cis configuration）**：如果两个错误指令 $v_1$ 和 $v_2$ 都出现在同一本蓝图上（例如，都来自父亲的[染色体](@entry_id:276543)），那么来自母亲的那本蓝图仍然是完好无损的。身体依然可以根据这本好的蓝图制造出功能正常的零件。在这种情况下，这个人通常是健康的携带者，不会表现出疾病。

- **反式构型（Trans configuration）**：如果一个错误指令 $v_1$ 在父亲的蓝图上，而另一个 $v_2$ 在母亲的蓝图上，情况就完全不同了。现在，没有一本蓝图是完美的。任何一本都无法单独制造出正常的零件。这种状态，我们称之为**复合杂合（compound heterozygosity）**，它会导致[常染色体隐性遗传病](@entry_id:918343)的发生。

这个例子清晰地表明：仅仅知道基因型（存在 $v_1$ 和 $v_2$）是不足以判断病因的。我们必须知道它们的**相位（phase）**。定相是连接基因型和表型（临床症状）的关键桥梁。

### 定相的方法：拼凑生命之书的线索

那么，我们如何才能揭示这些[等位基因](@entry_id:906209)的真实[排列](@entry_id:136432)呢？科学家们像侦探一样，利用各种线索来拼凑出完整的单倍型。

#### 线索一：追溯家族谱系（基于家系的定相）

最直观的方法是观察遗传规律。如果我们能获得父母的基因组信息，就能像解一个简单的逻辑谜题一样解决定相问题。这就是**基于家系（pedigree-based）的定相**。根据[孟德尔遗传定律](@entry_id:912696)，孩子的一半基因来自母亲，一半来自父亲。

例如，在一个三口之家中，如果孩子在两个位点上都是[杂合子](@entry_id:276964)（基因型为 $A/a$ 和 $B/b$），而我们知道母亲的单倍型是 $AB/ab$，父亲是 $Ab/aB$。如果孩子从母亲那里遗传了 $AB$ 这条单倍型，那么为了构成 $A/a, B/b$ 的基因型，他必须从父亲那里遗传 $aB$ 单倍型。这样，孩子的单倍型就被确定为 $AB/aB$。当然，减数分裂过程中的**重组（recombination）**会使情况变得复杂，但其规律性本身也为我们提供了推断的依据 。这种方法非常准确，但它的局限性也很明显：在临床实践中，我们往往无法获得父母的样本。

#### 线索二：阅读DNA碎片（基于测序读长的定相）

当没有家系信息时，我们必须直接从患者的DNA中寻找线索。现代测序技术，尤其是二代测序（NGS），会将基因组切成数以亿计的短DNA片段，我们称之为**测序读长（reads）**。

想象一下，那两本生命之书被放进了碎纸机。我们得到的是一堆纸条（reads）。如果某一张纸条足够长，恰好包含了两个我们关心的杂合位点，那么我们就得到了直接的物理证据：这两个位点的[等位基因](@entry_id:906209)共同存在于同一条[染色体](@entry_id:276543)上 。

然而，这里的挑战在于“足够长”。标准的[短读长测序](@entry_id:916166)（如[Illumina](@entry_id:201471)）产生的读长通常只有150-300个碱基对。如果两个杂合位点之间的距离超过了这个长度，短读长就无法将它们连接起来 。这导致了一个普遍现象：我们只能构建出一些**定相区块（phase blocks）**——在这些区块内部，所有位点的相位关系都是明确的；但区块与区块之间，相位关系是断开的，就像是基因组上一个个孤立的“定相岛屿”。

幸运的是，**[长读长测序](@entry_id:268696)技术**（如[PacBio](@entry_id:264261)和Oxford Nanopore）的出现，提供了能跨越数千甚至数万碱基对的读长，极大地扩展了这些区块的长度，甚至能实现单个基因乃至整条[染色体](@entry_id:276543)的端到端定相。

在处理这些物理读长时，算法通常遵循两种核心思想：

1.  **“投票”系统（[基于似然的推断](@entry_id:922306)）**：测序过程并非完美，每个碱基的识别都存在一定的错误率，这个错误率可以通过**Phred[质量分数](@entry_id:161575)（Phred quality score, $Q$）**来量化。一个读长显示 $A$ 和 $B$ 在一起，可能只是测序错误。我们该如何做出判断？我们不会只相信一张“选票”。相反，我们会收集所有跨越这两个位点的读长，并建立一个统计模型。对于“顺式”和“反式”这两种假设，我们可以计算出在各自假设下，观测到当前这些（可能带有错误的）读长数据的总**[似然](@entry_id:167119)（likelihood）**。[似然](@entry_id:167119)值更高的一方，就是更可信的相位 。

2.  **“拼图”游戏（最小错误校正）**：另一种思路是将定相看作一个[优化问题](@entry_id:266749)。我们尝试构建一个候选的单倍型 $H$，然后检查所有的测序读长，看它们与这个候选单倍型 $H$ 及其互补版本 $H^c$ 的匹配程度。对于每一个读长，我们计算需要修改多少个碱基才能让它与 $H$ 或 $H^c$ [完美匹配](@entry_id:273916)，并取其最小值。所有读长的这个最小修改数之和，就是该候选单倍型 $H$ 的总“冲突”或“错误”分数。我们的目标，就是找到那个能使总错误分数最小的“最优”单倍型 $H$。这个分数被称为**最小错误校正（Minimum Error Correction, MEC）**分数 。

#### 线索三：群众的智慧（基于群体的定相）

如果家系数据不可用，测序读长又太短，我们还有第三条路：利用“群众的智慧”。这里的“群众”，指的是成千上万个已经被定相的参考基因组，它们构成了**参考面板（reference panel）**。

这种方法的基础是一种被称为**连锁不平衡（Linkage Disequilibrium, LD）**的群体遗传学现象 。可以把它想象成语言中的词语搭配习惯。在英语中，字母'q'后面几乎总是跟着'u'。如果你看到一个'q'，并且知道下一个字母要么是'u'要么是'x'，你会毫不犹豫地猜'u'。同样，在人类进化过程中，由于重组事件并非完全随机，某些相近的[等位基因](@entry_id:906209)倾向于“捆绑”在一起，像“搭便车”一样代代相传。

这种非随机的[关联强度](@entry_id:924074)可以用**LD系数 $D$** 来衡量。它的定义是观测到的 $AB$ 单倍型频率 $f_{AB}$ 与在独立假设下期望的频率 $p_A p_B$ 之差：
$$ D = f_{AB} - p_A p_B $$
一个等价且更直观的表达是 $D = f_{AB}f_{ab} - f_{Ab}f_{aB}$ 。如果 $D > 0$，意味着在人群中，$AB$ 和 $ab$ 这两个“耦合”单倍型比 $Ab$ 和 $aB$ 这两个“排斥”单倍型更常见。因此，当一个新样本的基因型是 $A/a, B/b$ 时，我们可以做出一个有根据的猜测：他的单倍型更有可能是 $AB/ab$。

基于参考面板的定相算法，就像一个高明的画家，它利用面板中成千上万个已知的单倍型片段作为“颜料”，来“描绘”出新样本最有可能的单倍型组合。参考面板越大、越多样化，包含的单倍型模式就越丰富，定相的准确性就越高。这背后有严谨的数学原理：随着面板大小 $n$ 的增加，目标单倍型 $h_1$（频率为 $p$）和 $h_2$（频率为 $q$）同时出现在面板中的概率会迅速接近 $1$，从而保证了高精度的定相 。

### 我们的重建有多好？衡量定相的准确性

在费尽心力重建出单倍型后，我们如何评价其质量？我们需要一把精确的“尺子”。

最核心的评估指标是**转换错误（switch error）**。想象一下你在同时抄写两本书的内容，分别录入到两个文档里。一个转换错误就相当于，你抄写文档A时，突然错误地切换到B书抄了一段，然后又切换回A书。局部来看，你抄写的内容都对，但长距离的从属关系却搞错了。在定相中，这意味着在两个相邻的杂合位点之间，它们的相对相位被搞反了 。**[转换错误率](@entry_id:894937)（Switch Error Rate, SER）**就是在一个定相区块内，发生这种转换的次数除以总的连接机会（即区块内位点数减一）。

另一个相关的指标是**汉明错误（Hamming error）**或错配错误，它更简单粗暴：直接计算预测的单倍型中有多少个位点与真实的单倍型不匹配。在计算时，我们需要考虑到整个定相区块的标签可能是整体翻转的（例如，预测的母源单倍型其实对应的是真实的父源单倍型）。因此，我们会先将预测区块进行最佳“翻转”对齐，使其与真实单倍型的差异最小化，然后再计算错配位点的数量。这种方法巧妙地将区块间的“末端转换”问题与区块内的真实错误分离开来 。

总之，[单倍型定相](@entry_id:906999)是一个从临床需求出发，综合运用遗传学、分子生物学、统计学和计算机科学的多学科交叉领域。它让我们不仅能“读”懂基因，更能“理解”基因的组合方式，从而在[精准医疗](@entry_id:265726)时代做出更深刻的洞察和更准确的决策。