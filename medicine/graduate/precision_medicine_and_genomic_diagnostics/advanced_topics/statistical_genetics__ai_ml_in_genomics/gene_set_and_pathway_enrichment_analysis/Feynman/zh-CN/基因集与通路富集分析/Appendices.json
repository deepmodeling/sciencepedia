{
    "hands_on_practices": [
        {
            "introduction": "通路分析中最基本的问题是：在一组我们感兴趣的基因（例如，差异表达基因）中，落入某个特定通路的基因数量是否显著高于随机预期的数量？这种方法被称为“过表达分析”（Over-Representation Analysis, ORA）。该练习将指导您使用Fisher精确检验，从头开始计算通路富集的$p$值，这是理解所有通路分析软件背后核心逻辑的基石。通过这个实践，您将掌握评估单个基因集富集显著性的基本统计原理。",
            "id": "4343610",
            "problem": "一项精准肿瘤学研究使用靶向核糖核酸测序（RNA-seq）技术，对一个包含 $N$ 个基因的特选基因板进行检测，以识别可能涉及可操作通路的差异表达基因。考虑该基因板中一个包含 $K$ 个成员的单一通路基因集。在指定的假发现率控制下，实验流程共检出 $M$ 个差异表达基因，其中 $x$ 个基因属于该通路基因集。构建一个 $2 \\times 2$ 列联表，行表示差异表达的判定（是/否），列表示是否为通路成员（是/否）。费舍尔精确检验（FET）通过以固定边缘总和为条件，并根据超几何模型量化无放回抽样，来评估通路中差异表达的富集情况。\n\n在一个特定的肿瘤样本中，使用一个包含 $N = 30$ 个基因的基因板进行分析，一个特选通路包含其中 $K = 9$ 个基因。实验流程检出 $M = 8$ 个差异表达基因，其中 $x = 5$ 个是该通路的成员。得到的 $2 \\times 2$ 表如下：\n- 差异表达“是”且通路成员“是”：$5$\n- 差异表达“是”且通路成员“否”：$3$\n- 差异表达“否”且通路成员“是”：$4$\n- 差异表达“否”且通路成员“否”：$18$\n\n从无放回抽样的基本原理和费舍尔精确检验所依据的条件化方法出发，计算富集的精确单侧 $p$ 值。该 $p$ 值定义为：在给定固定边缘总和的情况下，在 $M$ 个差异表达基因中观察到 $X \\geq x$ 个通路成员的概率。请展示从第一性原理出发的完整推导过程和详细的计算步骤。将最终的 $p$ 值四舍五入至四位有效数字。无需单位。",
            "solution": "问题陈述具有科学依据、提法明确、客观且内部一致。它描述了费舍尔精确检验在基因集富集分析中的一个标准应用，这是生物信息学和精准医学中的一项基本技术。所有必要的数据都已提供，且没有矛盾之处。因此，该问题是有效的，可以推导出解决方案。\n\n问题的核心是使用费舍尔精确检验计算富集的单侧 $p$ 值。该检验适用于分析行列总和（边缘）被视为固定的列联表。其基础概率模型是超几何分布，该分布描述了从有限总体中进行无放回抽样时，抽到一定数量“成功”的概率。\n\n在此背景下，总体是基因板上的 $N$ 个基因。“成功”是指属于特选通路的 $K$ 个基因。我们抽取一个大小为 $M$ 的样本，代表被判定为差异表达的基因。我们想要求出在该样本中观察到 $k$ 个通路基因的概率。\n\n观察到恰好 $k$ 次成功的超几何分布的概率质量函数由下式给出：\n$$\nP(X=k) = \\frac{\\binom{K}{k} \\binom{N-K}{M-k}}{\\binom{N}{M}}\n$$\n其中：\n- $N$ 是总体中的基因总数（基因板大小）。\n- $K$ 是总体中具有目标特性（通路成员）的基因总数。\n- $M$ 是样本中抽取的基因数量（差异表达基因）。\n- $k$ 是样本中具有目标特性的基因数量。\n\n根据问题陈述，我们已知：\n- $N = 30$\n- $K = 9$\n- $M = 8$\n- 在差异表达基因中观察到的通路成员数量为 $x = 5$。\n\n富集的单侧 $p$ 值是指在富集方向上，观察到与观测结果一样极端或更极端结果的概率。这意味着我们必须计算在给定固定边缘总和的情况下，在差异表达基因集中观察到 $x$ 个或更多通路基因的概率。用数学形式表示，即为 $P(X \\ge x)$，其中 $X$ 是代表 $M$ 个差异表达基因中通路基因数量的随机变量。\n\n对于我们的特定值， $p$ 值为：\n$$\np = P(X \\ge 5) = \\sum_{k=5}^{\\min(K,M)} P(X=k)\n$$\n由于 $K=9$ 且 $M=8$，样本中通路基因的最大可能数量为 $\\min(9, 8) = 8$。因此，该和为：\n$$\np = P(X=5) + P(X=6) + P(X=7) + P(X=8)\n$$\n我们使用超几何公式计算每一项：\n$$\nP(X=k) = \\frac{\\binom{9}{k} \\binom{30-9}{8-k}}{\\binom{30}{8}} = \\frac{\\binom{9}{k} \\binom{21}{8-k}}{\\binom{30}{8}}\n$$\n\n首先，我们计算分母，即从 $N=30$ 个基因的基因板中选择 $M=8$ 个基因的总方式数：\n$$\n\\binom{N}{M} = \\binom{30}{8} = \\frac{30!}{8!(30-8)!} = \\frac{30!}{8!22!} = \\frac{30 \\times 29 \\times 28 \\times 27 \\times 26 \\times 25 \\times 24 \\times 23}{8 \\times 7 \\times 6 \\times 5 \\times 4 \\times 3 \\times 2 \\times 1} = 5,852,925\n$$\n这是 $8$ 个差异表达基因所有可能的组合总数。\n\n接下来，我们计算和中每一项的分子：\n1. 对于 $k=5$（观测结果）：\n从 $9$ 个通路基因中选择 $5$ 个，并从 $21$ 个非通路基因中选择 $3$ 个的方式数为：\n$$\n\\binom{9}{5}\\binom{21}{8-5} = \\binom{9}{5}\\binom{21}{3} = \\left(\\frac{9 \\times 8 \\times 7 \\times 6}{4 \\times 3 \\times 2 \\times 1}\\right) \\times \\left(\\frac{21 \\times 20 \\times 19}{3 \\times 2 \\times 1}\\right) = 126 \\times 1330 = 167,580\n$$\n\n2. 对于 $k=6$：\n从 $9$ 个通路基因中选择 $6$ 个，并从 $21$ 个非通路基因中选择 $2$ 个的方式数为：\n$$\n\\binom{9}{6}\\binom{21}{8-6} = \\binom{9}{3}\\binom{21}{2} = \\left(\\frac{9 \\times 8 \\times 7}{3 \\times 2 \\times 1}\\right) \\times \\left(\\frac{21 \\times 20}{2 \\times 1}\\right) = 84 \\times 210 = 17,640\n$$\n\n3. 对于 $k=7$：\n从 $9$ 个通路基因中选择 $7$ 个，并从 $21$ 个非通路基因中选择 $1$ 个的方式数为：\n$$\n\\binom{9}{7}\\binom{21}{8-7} = \\binom{9}{2}\\binom{21}{1} = \\left(\\frac{9 \\times 8}{2 \\times 1}\\right) \\times \\left(21\\right) = 36 \\times 21 = 756\n$$\n\n4. 对于 $k=8$：\n从 $9$ 个通路基因中选择 $8$ 个，并从 $21$ 个非通路基因中选择 $0$ 个的方式数为：\n$$\n\\binom{9}{8}\\binom{21}{8-8} = \\binom{9}{1}\\binom{21}{0} = \\left(9\\right) \\times \\left(1\\right) = 9\n$$\n\n现在，我们将这些计数相加，然后除以总组合数，得到 $p$ 值：\n$$\np = \\frac{167,580 + 17,640 + 756 + 9}{5,852,925} = \\frac{185,985}{5,852,925}\n$$\n执行最后的除法：\n$$\np \\approx 0.031776507...\n$$\n问题要求将结果四舍五入到四位有效数字。第五位有效数字是 $7$，所以我们将第四位有效数字向上取整。\n$$\np \\approx 0.03178\n$$",
            "answer": "$$\n\\boxed{0.03178}\n$$"
        },
        {
            "introduction": "在真实的基因组学研究中，我们通常会同时检测数千个基因集，而不是仅仅一个。这便引出了“多重检验”问题：当进行大量统计检验时，即使所有假设都为假，也很有可能仅凭运气得到一些显著的$p$值。为了解决这个问题，我们必须对原始$p$值进行校正以控制假阳性发现率（False Discovery Rate, FDR）。这个练习将带您实践Benjamini-Hochberg程序，这是将一系列原始$p$值转换为一组可靠的显著性结论的关键步骤，也是解读高通量数据分析结果的必备技能。",
            "id": "4343651",
            "problem": "一个分子肿瘤委员会正在根据对一组经新一代测序分析的患者队列进行的基因集富集分析所产生的通路水平信号，对靶向治疗进行优先级排序。一项竞争性富集测试为 $m$ 个不同的通路生成了原始 $p$ 值。该研究计划使用 Benjamini–Hochberg 升阶程序，在 $\\alpha = 0.05$ 的水平上控制假发现率 (False Discovery Rate, FDR)，并遵循其在高通量基因组学中有效性所需的常规假设（例如，各通路间的检验统计量独立或正相关）。\n\n给定以下通路列表及其原始 $p$ 值（通路名称仅为提供生物医学背景；对于多重检验程序，只有 $p$ 值是重要的）：\n\n- 同源重组 (Homologous recombination): $0.019$\n- 错配修复 (Mismatch repair): $0.0025$\n- 磷脂酰肌醇3-激酶–Akt (PI3K–Akt) 信号通路 (Phosphoinositide $3$-kinase–Akt (PI3K–Akt) signaling): $0.041$\n- 丝裂原活化蛋白激酶 (MAPK) 信号通路 (Mitogen-activated protein kinase (MAPK) signaling): $0.052$\n- 细胞周期 (Cell cycle): $0.011$\n- 肿瘤蛋白 $53$ ($p53$) 信号通路 (Tumor protein $53$ ($p53$) signaling): $0.0009$\n- 血管内皮生长因子 (VEGF) 信号通路 (Vascular endothelial growth factor (VEGF) signaling): $0.034$\n- Janus激酶-信号转导与转录激活子 (JAK–STAT) 信号通路 (Janus kinase–signal transducer and activator of transcription (JAK–STAT) signaling): $0.028$\n- 转化生长因子β (TGF-$\\beta$) 信号通路 (Transforming growth factor beta (TGF-$\\beta$) signaling): $0.071$\n- Wnt信号通路 (Wnt signaling): $0.12$\n- Notch信号通路 (Notch signaling): $0.006$\n- Hedgehog信号通路 (Hedgehog signaling): $0.0041$\n\n任务：\n1. 计算所有 $m$ 个通路的 Benjamini–Hochberg 校正 $p$ 值。\n2. 根据这些校正 $p$ 值，确定在 FDR 水平 $\\alpha = 0.05$ 下哪些通路是显著的。\n\n最终答案仅提供显著通路的数量。不包含任何单位。除给定 $p$ 值所隐含的精度外，不需要进行四舍五入。",
            "solution": "所述问题是有效的。它提出了一个清晰、独立且有科学依据的任务，该任务在生物信息学和统计基因组学领域至关重要。该问题提供了一份来自基因集富集分析的原始 $p$ 值列表，并要求应用标准的 Benjamini–Hochberg (BH) 程序来控制假发现率 (FDR)。这是一个定义明确的问题，有唯一的、正确的解，该解源于一个成熟的统计算法。所有必要的数据（$p$ 值集合）和参数（FDR 水平 $\\alpha$）均已提供。\n\n目标是使用 BH 程序，在 $\\alpha = 0.05$ 的 FDR 水平下，经过多重比较校正后，确定 $m$ 个被检验的通路中哪些是统计显著的。通路的数量，即假设检验的数量，为 $m=12$。\n\nBenjamini–Hochberg 程序包括以下步骤：\n\n1.  **对 $p$ 值排序**：设原始 $p$ 值为 $p_1, p_2, \\ldots, p_m$。将这些值按升序排序，记为 $p_{(1)} \\le p_{(2)} \\le \\ldots \\le p_{(m)}$。排序后的第 $i$ 个 $p$ 值 $p_{(i)}$ 的秩为 $i$。\n\n给定的原始 $p$ 值为：$0.019$、$0.0025$、$0.041$、$0.052$、$0.011$、$0.0009$、$0.034$、$0.028$、$0.071$、$0.12$、$0.006$ 和 $0.0041$。\n\n对这 $m=12$ 个值进行排序得到：\n- $p_{(1)} = 0.0009$ (肿瘤蛋白 $53$ ($p53$) 信号通路)\n- $p_{(2)} = 0.0025$ (错配修复)\n- $p_{(3)} = 0.0041$ (Hedgehog信号通路)\n- $p_{(4)} = 0.006$ (Notch信号通路)\n- $p_{(5)} = 0.011$ (细胞周期)\n- $p_{(6)} = 0.019$ (同源重组)\n- $p_{(7)} = 0.028$ (Janus激酶-信号转导与转录激活子 (JAK–STAT) 信号通路)\n- $p_{(8)} = 0.034$ (血管内皮生长因子 (VEGF) 信号通路)\n- $p_{(9)} = 0.041$ (磷脂酰肌醇3-激酶–Akt (PI3K–Akt) 信号通路)\n- $p_{(10)} = 0.052$ (丝裂原活化蛋白激酶 (MAPK) 信号通路)\n- $p_{(11)} = 0.071$ (转化生长因子β (TGF-$\\beta$) 信号通路)\n- $p_{(12)} = 0.12$ (Wnt信号通路)\n\n2.  **计算校正 $p$ 值**：对于第 $i$ 个排序后的原始 $p$ 值，其 BH 校正 $p$ 值（记为 $p_{adj}$）的计算要确保校正 $p$ 值列表是单调不减的。对于每个原始 $p$ 值 $p_{(i)}$，我们首先计算一个值 $q_{(i)} = \\frac{m \\cdot p_{(i)}}{i}$。然后通过强制单调性来找到校正 $p$ 值 $p_{adj,(i)}$。从最大的原始 $p$ 值开始：\n$$p_{adj,(m)} = q_{(m)} = p_{(m)}$$\n对于 $i = m-1, m-2, \\dots, 1$：\n$$p_{adj,(i)} = \\min(p_{adj,(i+1)}, q_{(i)}) = \\min\\left(p_{adj,(i+1)}, \\frac{m \\cdot p_{(i)}}{i}\\right)$$\n这等同于更紧凑的公式 $p_{adj,(i)} = \\min_{j=i}^{m} \\left(\\frac{m \\cdot p_{(j)}}{j}\\right)$。\n\n我们来计算 $i=1, \\dots, 12$ 的值：\n- 对于 $i=1$: $q_{(1)} = \\frac{12 \\times 0.0009}{1} = 0.0108$\n- 对于 $i=2$: $q_{(2)} = \\frac{12 \\times 0.0025}{2} = 0.015$\n- 对于 $i=3$: $q_{(3)} = \\frac{12 \\times 0.0041}{3} = 0.0164$\n- 对于 $i=4$: $q_{(4)} = \\frac{12 \\times 0.006}{4} = 0.018$\n- 对于 $i=5$: $q_{(5)} = \\frac{12 \\times 0.011}{5} = 0.0264$\n- 对于 $i=6$: $q_{(6)} = \\frac{12 \\times 0.019}{6} = 0.038$\n- 对于 $i=7$: $q_{(7)} = \\frac{12 \\times 0.028}{7} \\approx 0.048$\n- 对于 $i=8$: $q_{(8)} = \\frac{12 \\times 0.034}{8} = 0.051$\n- 对于 $i=9$: $q_{(9)} = \\frac{12 \\times 0.041}{9} \\approx 0.05467$\n- 对于 $i=10$: $q_{(10)} = \\frac{12 \\times 0.052}{10} = 0.0624$\n- 对于 $i=11$: $q_{(11)} = \\frac{12 \\times 0.071}{11} \\approx 0.07745$\n- 对于 $i=12$: $q_{(12)} = \\frac{12 \\times 0.12}{12} = 0.12$\n\n现在我们从 $i=12$ 开始反向施加单调性条件：\n- $p_{adj,(12)} = q_{(12)} = 0.12$\n- $p_{adj,(11)} = \\min(p_{adj,(12)}, q_{(11)}) = \\min(0.12, 0.07745\\ldots) = 0.07745\\ldots$\n- $p_{adj,(10)} = \\min(p_{adj,(11)}, q_{(10)}) = \\min(0.07745\\ldots, 0.0624) = 0.0624$\n- $p_{adj,(9)} = \\min(p_{adj,(10)}, q_{(9)}) = \\min(0.0624, 0.05467\\ldots) = 0.05467\\ldots$\n- $p_{adj,(8)} = \\min(p_{adj,(9)}, q_{(8)}) = \\min(0.05467\\ldots, 0.051) = 0.051$\n- $p_{adj,(7)} = \\min(p_{adj,(8)}, q_{(7)}) = \\min(0.051, 0.048) = 0.048$\n- $p_{adj,(6)} = \\min(p_{adj,(7)}, q_{(6)}) = \\min(0.048, 0.038) = 0.038$\n- $p_{adj,(5)} = \\min(p_{adj,(6)}, q_{(5)}) = \\min(0.038, 0.0264) = 0.0264$\n- $p_{adj,(4)} = \\min(p_{adj,(5)}, q_{(4)}) = \\min(0.0264, 0.018) = 0.018$\n- $p_{adj,(3)} = \\min(p_{adj,(4)}, q_{(3)}) = \\min(0.018, 0.0164) = 0.0164$\n- $p_{adj,(2)} = \\min(p_{adj,(3)}, q_{(2)}) = \\min(0.0164, 0.015) = 0.015$\n- $p_{adj,(1)} = \\min(p_{adj,(2)}, q_{(1)}) = \\min(0.015, 0.0108) = 0.0108$\n\n每个通路的校正 $p$ 值为：\n- p53信号通路 ($p=0.0009$): $p_{adj} = 0.0108$\n- 错配修复 ($p=0.0025$): $p_{adj} = 0.015$\n- Hedgehog信号通路 ($p=0.0041$): $p_{adj} = 0.0164$\n- Notch信号通路 ($p=0.006$): $p_{adj} = 0.018$\n- 细胞周期 ($p=0.011$): $p_{adj} = 0.0264$\n- 同源重组 ($p=0.019$): $p_{adj} = 0.038$\n- JAK–STAT信号通路 ($p=0.028$): $p_{adj} = 0.048$\n- VEGF信号通路 ($p=0.034$): $p_{adj} = 0.051$\n- PI3K–Akt信号通路 ($p=0.041$): $p_{adj} \\approx 0.0547$\n- MAPK信号通路 ($p=0.052$): $p_{adj} = 0.0624$\n- TGF-$\\beta$信号通路 ($p=0.071$): $p_{adj} \\approx 0.0775$\n- Wnt信号通路 ($p=0.12$): $p_{adj} = 0.12$\n\n3.  **确定显著通路**：如果一个通路的校正 $p$ 值小于或等于指定的 FDR 水平 $\\alpha$，则该通路被认为是显著的。这里，$\\alpha=0.05$。\n\n我们将每个通路的校正 $p$ 值与 $0.05$ 进行比较：\n- p53信号通路: $0.0108 \\le 0.05$ (显著)\n- 错配修复: $0.015 \\le 0.05$ (显著)\n- Hedgehog信号通路: $0.0164 \\le 0.05$ (显著)\n- Notch信号通路: $0.018 \\le 0.05$ (显著)\n- 细胞周期: $0.0264 \\le 0.05$ (显著)\n- 同源重组: $0.038 \\le 0.05$ (显著)\n- JAK–STAT信号通路: $0.048 \\le 0.05$ (显著)\n- VEGF信号通路: $0.051 > 0.05$ (不显著)\n- PI3K–Akt信号通路: $0.0547 > 0.05$ (不显著)\n- MAPK信号通路: $0.0624 > 0.05$ (不显著)\n- TGF-$\\beta$信号通路: $0.0775 > 0.05$ (不显著)\n- Wnt信号通路: $0.12 > 0.05$ (不显著)\n\n通过计算满足显著性标准的通路数量，我们发现有 $7$ 个显著通路。",
            "answer": "$$\\boxed{7}$$"
        },
        {
            "introduction": "过表达分析（如中所示）的一个主要局限性是它依赖于一个任意的阈值来定义“命中基因列表”，这不仅忽略了大量有价值的表达信息，还可能引入偏见。为了克服这一缺陷，基因集富集分析（Gene Set Enrichment Analysis, GSEA）应运而生。GSEA不依赖于硬性阈值，而是通过评估一个基因集内的所有基因是否倾向于分布在整个基因排序列表的顶端或底端来进行判断。这个练习将引导您手动计算GSEA的核心指标——富集分数（Enrichment Score），从而让您深入理解这种强大的无阈值方法的内在机制，并体会其相对于简单ORA方法的优越性。",
            "id": "4343666",
            "problem": "一项精准肿瘤学研究旨在使用基因集富集分析（GSEA）来评估一个患者队列中的通路活性特征。该研究根据表型关联分数生成了一个基因排序列表，并通过GSEA的移动总和统计量来评估一个通路基因集。为了说明富集分数的计算，请考虑以下包含$N=10$个基因的小型、合成的排序列表。基因 $g_1, g_2, \\dots, g_{10}$ 从1（顶部）到10（底部）排序，并附有相关的权重（与表型的带符号相关性，已按降序排列）：\n\n- 排名 $1$: 基因 $g_1$，权重 $0.80$\n- 排名 $2$: 基因 $g_2$，权重 $0.75$\n- 排名 $3$: 基因 $g_3$，权重 $0.60$\n- 排名 $4$: 基因 $g_4$，权重 $0.40$\n- 排名 $5$: 基因 $g_5$，权重 $0.35$\n- 排名 $6$: 基因 $g_6$，权重 $0.20$\n- 排名 $7$: 基因 $g_7$，权重 $0.15$\n- 排名 $8$: 基因 $g_8$，权重 $0.10$\n- 排名 $9$: 基因 $g_9$，权重 $0.05$\n- 排名 $10$: 基因 $g_{10}$，权重 $0.02$\n\n设通路基因集为 $S=\\{g_1, g_3, g_7, g_9\\}$。\n\n请使用指数 $p=1$ 的基因集富集分析（GSEA）经典加权移动总和定义，计算此排序列表中基因集 $S$ 的富集分数（ES）。同时，请确定出现与零最大偏差时的排名位置，以得出该ES。将最终的ES四舍五入至四位有效数字。无需单位。",
            "solution": "**问题验证**\n\n**步骤1：提取已知条件**\n- 基因总数，$N=10$。\n- 基因 $g_1, g_2, \\dots, g_{10}$ 从排名1到10排序。\n- 每个基因 $g_j$ 的权重 $r_j$（带符号的相关性）为：\n  - $r_1=0.80$\n  - $r_2=0.75$\n  - $r_3=0.60$\n  - $r_4=0.40$\n  - $r_5=0.35$\n  - $r_6=0.20$\n  - $r_7=0.15$\n  - $r_8=0.10$\n  - $r_9=0.05$\n  - $r_{10}=0.02$\n- 通路基因集为 $S=\\{g_1, g_3, g_7, g_9\\}$。\n- 方法为经典的加权移动总和GSEA。\n- 权重的指数为 $p=1$。\n- 富集分数（ES）是移动总和统计量与零的最大偏差值。\n- 最终ES必须四舍五入至四位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题经过了严格的验证过程。\n1.  **科学或事实上的不合理性**：该问题描述了基因集富集分析（GSEA）的标准应用，尽管是简化版。GSEA是生物信息学和基因组学中一种被广泛接受的基础方法。排序基因列表、基于相关性的权重、基因集和移动总和统计量等概念都是GSEA方法论的核心。没有违反科学原理之处。\n2.  **无法形式化或不相关**：该问题是一个定义明确的计算任务，可以用数学方式形式化。它与基因集和通路富集分析的主题直接相关。\n3.  **设置不完整或矛盾**：所有必要的数据和参数均已提供：基因总数（$N$）、基因集中的具体基因（$S$）、每个基因的排名和权重，以及加权的指数（$p=1$）。信息是自洽且完整的。\n4.  **不切实际或不可行**：基因相关性权重的值是合成的，但处于此类数据的合理范围（$[-1, 1]$）内。问题规模（$N=10$）虽小，仅为示例，但并未引入任何科学上的不可行性。\n5.  **不适定或结构不良**：该问题是适定的。GSEA移动总和的计算是确定性的，其与零的最大偏差是一个唯一值。指令清晰明确。\n6.  **伪深刻、琐碎或同义反复**：虽然是对真实世界分析的简化，但该问题并不琐碎。它要求正确、逐步地应用GSEA移动总和算法，这考验了对该方法机理的理解。它不是同义反复。\n7.  **超出科学可验证性范围**：计算结果在数学上是可验证的。\n\n**步骤3：结论与行动**\n该问题是**有效的**。它是一个适定的、有科学依据的问题，可以利用所提供的信息解决。我将继续进行解答。\n\n**解题过程**\n\n该问题要求使用加权基因集富集分析（GSEA）方法，计算给定基因集 $S$ 的富集分数（ES）。ES是通过沿着一个排序的基因列表移动计算出的移动总和统计量与零的最大偏差。\n\n关键参数如下：\n- 排序列表中的基因总数，$N=10$。\n- 目标基因集，$S=\\{g_1, g_3, g_7, g_9\\}$。\n- 基因集 $S$ 中的基因数量，记为 $N_H = |S| = 4$。\n- 不在基因集 $S$ 中的基因数量，记为 $N_M = N - N_H = 10 - 4 = 6$。\n- 每个基因 $g_j$ 的权重是其相关性 $r_j$。问题指定权重指数 $p=1$。由于所有给定的相关性均为正，因此 $|r_j|^p$ 项简化为 $r_j$。\n\nGSEA移动总和 $ES_{sum}(i)$ 对排名为 $i=1, \\dots, N$ 的每个基因进行迭代计算。计算使用两种不同的更新步骤，取决于排名为 $i$ 的基因 $g_i$ 是否在基因集 $S$ 中（“命中”）或不在（“未命中”）。\n\n对于一次“命中”（即 $g_i \\in S$），移动总和会按与该基因权重成比例的值增加。增量由以下公式给出：\n$$\n\\text{增量} = \\frac{|r_i|^p}{N_R}\n$$\n其中 $N_R$ 是一个归一化因子，等于基因集 $S$ 中所有基因的加权相关性之和：\n$$\nN_R = \\sum_{g_j \\in S} |r_j|^p\n$$\n给定 $p=1$ 且所有 $r_j > 0$，我们有：\n$$\nN_R = \\sum_{g_j \\in S} r_j = r_1 + r_3 + r_7 + r_9 = 0.80 + 0.60 + 0.15 + 0.05 = 1.60\n$$\n\n对于一次“未命中”（即 $g_i \\notin S$），移动总和会减去一个常数值：\n$$\n\\text{减量} = \\frac{1}{N_M} = \\frac{1}{6}\n$$\n\n我们现在从 $ES_{sum}(0) = 0$ 开始，为每个排名 $i$ 计算移动总和 $ES_{sum}(i)$。\n\n1.  **排名 $i=1$**：基因 $g_1 \\in S$。这是一次命中。\n    $ES_{sum}(1) = ES_{sum}(0) + \\frac{r_1}{N_R} = 0 + \\frac{0.80}{1.60} = \\frac{1}{2}$。\n\n2.  **排名 $i=2$**：基因 $g_2 \\notin S$。这是一次未命中。\n    $ES_{sum}(2) = ES_{sum}(1) - \\frac{1}{N_M} = \\frac{1}{2} - \\frac{1}{6} = \\frac{3}{6} - \\frac{1}{6} = \\frac{2}{6} = \\frac{1}{3}$。\n\n3.  **排名 $i=3$**：基因 $g_3 \\in S$。这是一次命中。\n    $ES_{sum}(3) = ES_{sum}(2) + \\frac{r_3}{N_R} = \\frac{1}{3} + \\frac{0.60}{1.60} = \\frac{1}{3} + \\frac{3}{8} = \\frac{8}{24} + \\frac{9}{24} = \\frac{17}{24}$。\n\n4.  **排名 $i=4$**：基因 $g_4 \\notin S$。这是一次未命中。\n    $ES_{sum}(4) = ES_{sum}(3) - \\frac{1}{N_M} = \\frac{17}{24} - \\frac{1}{6} = \\frac{17}{24} - \\frac{4}{24} = \\frac{13}{24}$。\n\n5.  **排名 $i=5$**：基因 $g_5 \\notin S$。这是一次未命中。\n    $ES_{sum}(5) = ES_{sum}(4) - \\frac{1}{N_M} = \\frac{13}{24} - \\frac{1}{6} = \\frac{13}{24} - \\frac{4}{24} = \\frac{9}{24} = \\frac{3}{8}$。\n\n6.  **排名 $i=6$**：基因 $g_6 \\notin S$。这是一次未命中。\n    $ES_{sum}(6) = ES_{sum}(5) - \\frac{1}{N_M} = \\frac{3}{8} - \\frac{1}{6} = \\frac{9}{24} - \\frac{4}{24} = \\frac{5}{24}$。\n\n7.  **排名 $i=7$**：基因 $g_7 \\in S$。这是一次命中。\n    $ES_{sum}(7) = ES_{sum}(6) + \\frac{r_7}{N_R} = \\frac{5}{24} + \\frac{0.15}{1.60} = \\frac{5}{24} + \\frac{3}{32} = \\frac{20}{96} + \\frac{9}{96} = \\frac{29}{96}$。\n\n8.  **排名 $i=8$**：基因 $g_8 \\notin S$。这是一次未命中。\n    $ES_{sum}(8) = ES_{sum}(7) - \\frac{1}{N_M} = \\frac{29}{96} - \\frac{1}{6} = \\frac{29}{96} - \\frac{16}{96} = \\frac{13}{96}$。\n\n9.  **排名 $i=9$**：基因 $g_9 \\in S$。这是一次命中。\n    $ES_{sum}(9) = ES_{sum}(8) + \\frac{r_9}{N_R} = \\frac{13}{96} + \\frac{0.05}{1.60} = \\frac{13}{96} + \\frac{1}{32} = \\frac{13}{96} + \\frac{3}{96} = \\frac{16}{96} = \\frac{1}{6}$。\n\n10. **排名 $i=10$**：基因 $g_{10} \\notin S$。这是一次未命中。\n    $ES_{sum}(10) = ES_{sum}(9) - \\frac{1}{N_M} = \\frac{1}{6} - \\frac{1}{6} = 0$。注意，最终值正确地为 $0$。\n\n富集分数（ES）是移动总和与零的最大绝对偏差。我们必须找到 $\\max_{1 \\le i \\le N} |ES_{sum}(i)|$。\n移动总和值的序列如下：\n$ES_{sum}(1) = \\frac{1}{2} = 0.5$\n$ES_{sum}(2) = \\frac{1}{3} \\approx 0.3333$\n$ES_{sum}(3) = \\frac{17}{24} \\approx 0.7083$\n$ES_{sum}(4) = \\frac{13}{24} \\approx 0.5417$\n$ES_{sum}(5) = \\frac{3}{8} = 0.375$\n$ES_{sum}(6) = \\frac{5}{24} \\approx 0.2083$\n$ES_{sum}(7) = \\frac{29}{96} \\approx 0.3021$\n$ES_{sum}(8) = \\frac{13}{96} \\approx 0.1354$\n$ES_{sum}(9) = \\frac{1}{6} \\approx 0.1667$\n$ES_{sum}(10) = 0$\n\n所有计算出的移动总和值都是非负的，因此最大绝对偏差就是序列中的最大值。通过观察，最大值为 $ES_{sum}(3) = \\frac{17}{24}$。这个最大偏差出现在排名 $3$ 的位置。\n\n富集分数为 $ES = \\frac{17}{24}$。\n为了提供最终答案，我们将此分数转换为小数，并四舍五入至四位有效数字。\n$ES = \\frac{17}{24} \\approx 0.708333...$\n四舍五入至四位有效数字得到 $0.7083$。",
            "answer": "$$\n\\boxed{0.7083}\n$$"
        }
    ]
}