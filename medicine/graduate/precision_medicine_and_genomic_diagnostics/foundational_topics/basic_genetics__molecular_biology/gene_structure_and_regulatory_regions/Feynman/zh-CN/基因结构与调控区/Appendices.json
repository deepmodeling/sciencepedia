{
    "hands_on_practices": [
        {
            "introduction": "识别基因调控区域的第一步通常是定位其中包含的短序列基序。本练习将引导您使用位置权重矩阵（PWM），这是一种在生物信息学中广泛应用的工具，用于量化一个序列（如此处的TATA盒）与特定基序的匹配程度。通过计算对数优势比分数并评估假阳性率，您将学习到评估基序搜索算法性能的统计学基础。",
            "id": "4344059",
            "problem": "在一个用于精准医疗中启动子注释的基因组诊断工作流程中，一个实验室采用一种基于基序的检测器来识别基因调控区域中的候选TATA盒。该检测器使用一个从经过整理筛选的启动子集中派生出的位置权重矩阵（PWM），并通过一个基序模型和一个背景模型之间的竞争来评估一个对数优势证据评分。该基序模型假定在一个$L$个碱基的基序窗口内位置是独立的。背景模型是一个独立同分布的核苷酸模型，其碱基频率与局部的鸟嘌呤-胞嘧啶（GC）含量相匹配。\n\n考虑一个长度为 $L = 8$ 的典型类TATA基序，其共有序列为 $\\sigma = (T, A, T, A, A, A, T, A)$。在位置 $i \\in \\{1,\\dots,8\\}$ 的PWM概率定义为\n$$\nP_i(b) =\n\\begin{cases}\n\\frac{9}{10},  \\text{若 } b = \\sigma_i, \\\\\n\\frac{1}{30},  \\text{若 } b \\neq \\sigma_i,\n\\end{cases}\n$$\n其中 $b \\in \\{A,C,G,T\\}$。GC匹配的背景模型具有以下碱基概率\n$$\nq(A) = \\frac{1}{5}, \\quad q(T) = \\frac{1}{5}, \\quad q(C) = \\frac{3}{10}, \\quad q(G) = \\frac{3}{10},\n$$\n并假定在各个位置上是独立的。正在评估的一个候选启动子窗口是精确的共有序列 $s = \\sigma$。\n\n使用基序模型和背景模型下的似然第一性原理，并假定位置独立性，使用自然对数推导 $s$ 的对数优势证据并计算其数值。然后，在一个等于此计算出的对数优势评分的决策阈值下，确定在GC匹配的背景模型下的预期假阳性率，该假阳性率定义为一个随机8-mer获得大于或等于该阈值的分数的背景概率。将假阳性率表示为小数。将您的最终数值答案四舍五入到四位有效数字。",
            "solution": "该检测器比较了观测窗口 $s$ 的两个生成模型：一个由位置权重矩阵（PWM）定义的基序模型和一个由GC匹配的碱基频率定义的背景模型。在各位置独立的假设下，$s$ 在基序模型下的似然为\n$$\nP_{\\text{motif}}(s) = \\prod_{i=1}^{L} P_i(s_i),\n$$\n在背景模型下的似然为\n$$\nP_{\\text{bg}}(s) = \\prod_{i=1}^{L} q(s_i).\n$$\n一个标准的证据度量是由以下公式定义的对数似然比（对数优势）：\n$$\nS(s) = \\ln\\left(\\frac{P_{\\text{motif}}(s)}{P_{\\text{bg}}(s)}\\right) = \\sum_{i=1}^{L} \\ln\\left(\\frac{P_i(s_i)}{q(s_i)}\\right).\n$$\n对于给定的共有序列 $s = \\sigma$ 和PWM的定义，每个位置 $i$ 都使用共有序列的字母，因此 $P_i(s_i) = \\frac{9}{10}$。共有序列的字母都在 $\\{A,T\\}$ 中，GC匹配的背景模型指定 $q(A) = \\frac{1}{5}$ 和 $q(T) = \\frac{1}{5}$。因此，对于每个位置 $i$，\n$$\n\\frac{P_i(s_i)}{q(s_i)} = \\frac{\\frac{9}{10}}{\\frac{1}{5}} = \\frac{9}{2},\n$$\n对数优势评分变为\n$$\nS(s) = \\sum_{i=1}^{8} \\ln\\left(\\frac{9}{2}\\right) = 8 \\ln\\left(\\frac{9}{2}\\right).\n$$\n使用自然对数进行数值计算，\n$$\n\\ln\\left(\\frac{9}{2}\\right) = \\ln(4.5) \\approx 1.504077397,\n$$\n所以\n$$\nS(s) \\approx 8 \\times 1.504077397 \\approx 12.03261918.\n$$\n四舍五入到四位有效数字，$S(s) \\approx 12.03$。\n\n接下来，我们计算在等于 $S(s)$ 的决策阈值下，背景模型中的预期假阳性率。根据PWM的构造，每个位置上共有序列字母的概率为 $\\frac{9}{10}$，而任何非共有序列字母的概率为 $\\frac{1}{30}$。共有序列字母在每个位置上的对数优势贡献是\n$$\n\\ln\\left(\\frac{\\frac{9}{10}}{\\frac{1}{5}}\\right) = \\ln\\left(\\frac{9}{2}\\right),\n$$\n而对于非共有序列字母 $b \\neq \\sigma_i$，其贡献或者是\n$$\n\\ln\\left(\\frac{\\frac{1}{30}}{\\frac{1}{5}}\\right) = \\ln\\left(\\frac{1}{6}\\right)  0, \\quad \\text{若 } b \\in \\{A,T\\} \\text{ 且 } b \\neq \\sigma_i,\n$$\n或者是\n$$\n\\ln\\left(\\frac{\\frac{1}{30}}{\\frac{3}{10}}\\right) = \\ln\\left(\\frac{1}{9}\\right)  0, \\quad \\text{若 } b \\in \\{C,G\\}.\n$$\n因此，在任何位置上与共有序列字母的任何偏离都会严格地减少该位置相对于 $\\ln\\left(\\frac{9}{2}\\right)$ 的贡献。因此，共有序列的总对数优势 $S(s)$ 是可达到的最高分数，而要获得大于或等于 $S(s)$ 的分数的唯一方法是在所有位置上都与共有序列匹配。因此，在阈值 $S(s)$ 下的预期假阳性率等于背景模型生成精确共有序列 $s$ 的概率：\n$$\n\\text{FPR} = P_{\\text{bg}}(s) = \\prod_{i=1}^{8} q(s_i).\n$$\n因为对于所有 $i$，$s_i \\in \\{A,T\\}$，且 $q(A) = q(T) = \\frac{1}{5}$，我们有\n$$\n\\text{FPR} = \\left(\\frac{1}{5}\\right)^{8} = \\frac{1}{390625}.\n$$\n转换为小数，\n$$\n\\frac{1}{390625} = 2.560 \\times 10^{-6},\n$$\n保留四位有效数字后，结果仍为 $2.560 \\times 10^{-6}$。\n\n汇总四舍五入后的结果：\n- 对数优势证据 $S(s)$ 四舍五入到四位有效数字：$12.03$。\n- 预期假阳性率四舍五入到四位有效数字：$2.560 \\times 10^{-6}$。",
            "answer": "$$\\boxed{\\begin{pmatrix}12.03  2.560 \\times 10^{-6}\\end{pmatrix}}$$"
        },
        {
            "introduction": "除了序列基序，调控元件（如增强子）的活性还通过特定的表观遗传标记来体现。本练习将向您展示如何整合多种表观基因组数据（H3K27ac、H3K4me1和ATAC-seq信号），在一个贝叶斯框架下推断某个基因组区域是否为活性增强子。这项实践模拟了精准医疗中利用染色质状态模型来注释功能性非编码区和解读变异功能的关键任务。",
            "id": "4344116",
            "problem": "精准医学中的一个核心任务是推断基因组区域的调控状态，以优先处理影响基因表达的变异。考虑一个二元状态模型，其中一个基因座要么是活性增强子（$E$），要么是非增强子（$N$）。增强子活性在机制上与特征性的染色质特征相关联：组蛋白H3赖氨酸27乙酰化（H3K27ac）、组蛋白H3赖氨酸4单甲基化（H3K4me1），以及通过转座酶可及性染色质测序（Assay for Transposase-Accessible Chromatin using sequencing, ATAC-seq）测量的开放染色质。假设在给定状态的条件下，这三种标准化信号强度是独立的，并且服从具有反映生物富集模式的状态特异性参数的高斯密度分布。\n\n设先验概率为 $P(E)=0.05$ 和 $P(N)=0.95$。对于一个正在评估的特定远端调控区域，观察到的标准化信号（全基因组 $z$-分数）分别为：H3K27ac 为 $x_{27}=1.7$，H3K4me1 为 $x_{4}=1.2$，ATAC-seq 为 $x_{A}=2.1$。生成模型指定，对于每个标记 $i \\in \\{27,4,A\\}$ 和状态 $S \\in \\{E,N\\}$，$x_{i}\\,|\\,S \\sim \\mathcal{N}(\\mu_{S,i},\\sigma_{S,i}^{2})$，其参数如下：\n- H3K27ac: $\\mu_{E,27}=2.0$, $\\sigma_{E,27}=0.7$; $\\mu_{N,27}=0.0$, $\\sigma_{N,27}=1.0$。\n- H3K4me1: $\\mu_{E,4}=1.5$, $\\sigma_{E,4}=0.8$; $\\mu_{N,4}=0.2$, $\\sigma_{N,4}=1.0$。\n- ATAC-seq: $\\mu_{E,A}=1.8$, $\\sigma_{E,A}=0.9$; $\\mu_{N,A}=0.0$, $\\sigma_{N,A}=1.0$。\n\n使用这些假设并从第一性原理出发，计算后验概率 $P(E\\,|\\,x_{27},x_{4},x_{A})$。将最终的后验概率表示为小数，并四舍五入到四位有效数字。",
            "solution": "目标是计算在给定一组观测到的染色质特征信号的情况下，一个基因座是活性增强子（用状态 $E$ 表示）的后验概率。设观测向量为 $\\mathbf{x} = (x_{27}, x_{4}, x_{A})$，其中 $x_{27}=1.7$，$x_{4}=1.2$，$x_{A}=2.1$。我们需要计算 $P(S=E | \\mathbf{x})$。\n\n这是一个贝叶斯推断问题。我们可以使用贝叶斯定理来计算所需的后验概率。该基因座的两个可能状态是增强子（$E$）和非增强子（$N$）。对于状态 $E$ 的贝叶斯定理是：\n$$ P(E | \\mathbf{x}) = \\frac{P(\\mathbf{x} | E) P(E)}{P(\\mathbf{x})} $$\n分母 $P(\\mathbf{x})$ 是证据的边缘概率，可以通过对所有可能状态求和，使用全概率公式展开：\n$$ P(\\mathbf{x}) = P(\\mathbf{x} | E) P(E) + P(\\mathbf{x} | N) P(N) $$\n将此代入后验概率的表达式，我们得到：\n$$ P(E | \\mathbf{x}) = \\frac{P(\\mathbf{x} | E) P(E)}{P(\\mathbf{x} | E) P(E) + P(\\mathbf{x} | N) P(N)} $$\n问题陈述先验概率为 $P(E)=0.05$ 和 $P(N)=0.95$。\n\n项 $P(\\mathbf{x} | S)$ 是在给定状态 $S \\in \\{E, N\\}$ 的情况下观测到数据 $\\mathbf{x}$ 的似然。问题指明，在给定状态的条件下，三个信号强度是独立的。这个关键假设使我们能够将似然分解为：\n$$ P(\\mathbf{x} | S) = P(x_{27} | S) \\cdot P(x_{4} | S) \\cdot P(x_{A} | S) = \\prod_{i \\in \\{27, 4, A\\}} P(x_i | S) $$\n每个单独的似然项 $P(x_i | S)$ 由高斯分布的概率密度函数（PDF）$\\mathcal{N}(x_i | \\mu_{S,i}, \\sigma_{S,i}^2)$ 给出，定义为：\n$$ \\mathcal{N}(x_i | \\mu_{S,i}, \\sigma_{S,i}^2) = \\frac{1}{\\sigma_{S,i}\\sqrt{2\\pi}} \\exp\\left(-\\frac{(x_i - \\mu_{S,i})^2}{2\\sigma_{S,i}^2}\\right) $$\n为了避免因乘以小概率而导致的数值下溢并简化计算，使用对数概率是有利的。让我们将每个状态 $S$ 的未归一化对数后验定义为 $\\ln(J_S)$，其中 $J_S = P(\\mathbf{x} | S) P(S)$。\n$$ \\ln(J_S) = \\ln(P(S)) + \\ln(P(\\mathbf{x} | S)) = \\ln(P(S)) + \\sum_{i \\in \\{27, 4, A\\}} \\ln(P(x_i | S)) $$\n代入高斯 PDF，对数联合概率的表达式变为：\n$$ \\ln(J_S) = \\ln(P(S)) + \\sum_{i} \\left[ -\\ln(\\sigma_{S,i}) - \\frac{1}{2}\\ln(2\\pi) - \\frac{(x_i - \\mu_{S,i})^2}{2\\sigma_{S,i}^2} \\right] $$\n$$ \\ln(J_S) = \\ln(P(S)) - \\sum_{i} \\ln(\\sigma_{S,i}) - \\frac{3}{2}\\ln(2\\pi) - \\frac{1}{2} \\sum_{i} \\left(\\frac{x_i - \\mu_{S,i}}{\\sigma_{S,i}}\\right)^2 $$\n我们现在将为增强子（$S=E$）和非增强子（$S=N$）两种状态计算这个值。\n\n对于增强子状态 $E$：\n给定的参数是 $P(E)=0.05$，且对于 $i \\in \\{27, 4, A\\}$，有 $(\\mu_{E,27}, \\sigma_{E,27}) = (2.0, 0.7)$，$(\\mu_{E,4}, \\sigma_{E,4}) = (1.5, 0.8)$，以及 $(\\mu_{E,A}, \\sigma_{E,A}) = (1.8, 0.9)$。\n$$ \\ln(P(E)) = \\ln(0.05) $$\n$$ \\sum_{i} \\ln(\\sigma_{E,i}) = \\ln(0.7) + \\ln(0.8) + \\ln(0.9) = \\ln(0.7 \\cdot 0.8 \\cdot 0.9) = \\ln(0.504) $$\n标准化的差异平方和是：\n$$ \\sum_{i} \\left(\\frac{x_i - \\mu_{E,i}}{\\sigma_{E,i}}\\right)^2 = \\left(\\frac{1.7 - 2.0}{0.7}\\right)^2 + \\left(\\frac{1.2 - 1.5}{0.8}\\right)^2 + \\left(\\frac{2.1 - 1.8}{0.9}\\right)^2 $$\n$$ = \\left(\\frac{-0.3}{0.7}\\right)^2 + \\left(\\frac{-0.3}{0.8}\\right)^2 + \\left(\\frac{0.3}{0.9}\\right)^2 = \\left(-\\frac{3}{7}\\right)^2 + \\left(-\\frac{3}{8}\\right)^2 + \\left(\\frac{1}{3}\\right)^2 $$\n$$ = \\frac{9}{49} + \\frac{9}{64} + \\frac{1}{9} \\approx 0.183673 + 0.140625 + 0.111111 = 0.435409 $$\n所以，状态 $E$ 的对数联合概率是：\n$$ \\ln(J_E) = \\ln(0.05) - \\ln(0.504) - \\frac{3}{2}\\ln(2\\pi) - \\frac{0.435409}{2} $$\n$$ \\ln(J_E) \\approx -2.99573 - (-0.68517) - \\frac{3}{2}\\ln(2\\pi) - 0.217705 = -2.52826 - \\frac{3}{2}\\ln(2\\pi) $$\n\n对于非增强子状态 $N$：\n给定的参数是 $P(N)=0.95$，且对于 $i \\in \\{27, 4, A\\}$，有 $(\\mu_{N,27}, \\sigma_{N,27}) = (0.0, 1.0)$，$(\\mu_{N,4}, \\sigma_{N,4}) = (0.2, 1.0)$，以及 $(\\mu_{N,A}, \\sigma_{N,A}) = (0.0, 1.0)$。\n$$ \\ln(P(N)) = \\ln(0.95) $$\n$$ \\sum_{i} \\ln(\\sigma_{N,i}) = \\ln(1.0) + \\ln(1.0) + \\ln(1.0) = 0 $$\n标准化的差异平方和是：\n$$ \\sum_{i} \\left(\\frac{x_i - \\mu_{N,i}}{\\sigma_{N,i}}\\right)^2 = \\left(\\frac{1.7 - 0.0}{1.0}\\right)^2 + \\left(\\frac{1.2 - 0.2}{1.0}\\right)^2 + \\left(\\frac{2.1 - 0.0}{1.0}\\right)^2 $$\n$$ = (1.7)^2 + (1.0)^2 + (2.1)^2 = 2.89 + 1.00 + 4.41 = 8.3 $$\n所以，状态 $N$ 的对数联合概率是：\n$$ \\ln(J_N) = \\ln(0.95) - 0 - \\frac{3}{2}\\ln(2\\pi) - \\frac{8.3}{2} $$\n$$ \\ln(J_N) \\approx -0.05129 - \\frac{3}{2}\\ln(2\\pi) - 4.15 = -4.20129 - \\frac{3}{2}\\ln(2\\pi) $$\n\n后验概率 $P(E|\\mathbf{x})$ 可以方便地表示为：\n$$ P(E|\\mathbf{x}) = \\frac{J_E}{J_E + J_N} = \\frac{1}{1 + J_N/J_E} $$\n我们可以通过它们的对数差来计算比率 $J_N/J_E$：\n$$ \\ln\\left(\\frac{J_N}{J_E}\\right) = \\ln(J_N) - \\ln(J_E) $$\n$$ \\ln\\left(\\frac{J_N}{J_E}\\right) = \\left(-4.20129 - \\frac{3}{2}\\ln(2\\pi)\\right) - \\left(-2.52826 - \\frac{3}{2}\\ln(2\\pi)\\right) $$\n项 $\\frac{3}{2}\\ln(2\\pi)$ 被消去，这极大地简化了计算：\n$$ \\ln\\left(\\frac{J_N}{J_E}\\right) = -4.20129 - (-2.52826) = -1.67303 $$\n现在，我们通过取指数来找到这个比率：\n$$ \\frac{J_N}{J_E} = \\exp(-1.67303) \\approx 0.187679 $$\n最后，我们将这个比率代回到后验概率的表达式中：\n$$ P(E|\\mathbf{x}) = \\frac{1}{1 + 0.187679} = \\frac{1}{1.187679} \\approx 0.841968 $$\n问题要求答案四舍五入到四位有效数字。\n$$ P(E|\\mathbf{x}) \\approx 0.8420 $$",
            "answer": "$$\\boxed{0.8420}$$"
        },
        {
            "introduction": "基因调控的最终目标是控制基因表达的输出水平，而启动子区的DNA甲基化是其中一种关键的抑制机制。本练习要求您从生物物理学的第一性原理出发，推导出一个描述启动子甲基化水平与基因表达之间关系的S型函数模型。随后，您将利用非线性回归方法，将该模型与模拟的实验数据进行拟合，从而估计出模型的关键参数，这是定量生物学中连接理论模型与实验数据的核心技能。",
            "id": "4344071",
            "problem": "一名研究人员正在研究在基因调控的背景下，通过全基因组亚硫酸氢盐测序（WGBS, Whole-Genome Bisulfite Sequencing）测量的启动子胞嘧啶-磷酸-鸟嘌呤（CpG）甲基化与通过 RNA 测序（RNA-seq, RNA sequencing）测量的信使 RNA 丰度之间的关系。启动子是调控区域，控制着转录机制对转录的起始。启动子甲基化分数定义为在一个启动子中被甲基化的 CpG 位点的比例 $m \\in [0,1]$。基因表达由一个非负标量 $y$ 表示（无量纲，例如，像每百万转录本这样的标准化丰度）。本问题中所有量均为无量纲；无需报告物理单位。\n\n从与基因调控和热力学相关的基本原理出发，推导出一个从启动子甲基化分数 $m$ 到期望表达 $y$ 的 S 型映射，该映射具有四个可解释的参数：一个基础表达水平（非负）、一个振幅（非负）、一个斜率（正）和一个限制在区间 $[0,1]$ 内的拐点。然后，构建一个非线性回归方法，该方法通过最小化受与参数解释一致的生物学动机约束的误差平方和目标函数，从配对观测值 $\\{(m_i, y_i)\\}_{i=1}^n$ 中估计这些参数。\n\n您的程序必须实现以下步骤：\n1. 根据上述说明从第一性原理构建 S 型函数，明确命名四个参数并强制执行基础水平非负、振幅非负、斜率大于零以及拐点在 $[0,1]$ 内的约束。\n2. 对于下面的每个测试用例，给定观测对 $\\{(m_i, y_i)\\}$，通过使用带边界参数的非线性回归程序，最小化观测值 $y_i$ 与在 $m_i$ 处求值的函数之间的残差平方和，来估计这四个参数。\n3. 对于每个测试用例，将估计的参数向量以列表 $[\\text{基础}, \\text{振幅}, \\text{斜率}, \\text{拐点}]$ 的形式输出，每个值四舍五入到三位小数。\n\n使用的基础理论：\n- 分子生物学的中心法则指出，脱氧核糖核酸（DNA）被转录为核糖核酸（RNA），然后翻译成蛋白质，其中启动子可及性调节转录起始概率。\n- 在一个两态启动子可及性模型中（可及与不可及），可及性的概率可以使用类玻尔兹曼加权法推导得出，其中状态的自由能因甲基化而发生改变。这导致了占有率对 $m$ 的 S 型依赖关系，进而调节了期望的表达水平。\n- 非线性最小二乘估计通过最小化观测结果与模型预测之间的残差平方和来进行。\n\n测试套件和数据：\n对于每个测试用例，程序必须从明确提供的数组中估计参数。每个测试用例包含两个列表：$M$（甲基化分数）和 $Y$（观测到的基因表达，无量纲）。请完全按照给定的数组使用。\n\n测试用例 1（一般情况，中等斜率，适度噪声）：\n- $M_1 = [0.0, 0.15, 0.3, 0.45, 0.5, 0.6, 0.8, 1.0]$\n- $Y_1 = [9.9464, 9.8465, 9.1431, 7.0109, 6.0, 4.0927, 2.2843, 2.0536]$\n\n测试用例 2（大斜率，显著转变，适度噪声）：\n- $M_2 = [0.0, 0.1, 0.2, 0.25, 0.3, 0.35, 0.5, 0.7]$\n- $Y_2 = [10.0450, 9.9802, 9.3328, 8.0002, 5.4846, 2.9639, 1.0103, 0.9850]$\n\n测试用例 3（近乎平坦的响应，小振幅）：\n- $M_3 = [0.0, 0.2, 0.4, 0.6, 0.8, 1.0]$\n- $Y_3 = [3.32285, 3.31111, 3.29392, 3.26902, 3.23686, 3.20065]$\n\n测试用例 4（小样本量，边界覆盖）：\n- $M_4 = [0.0, 0.3, 0.5, 1.0]$\n- $Y_4 = [7.2648, 5.6250, 3.3350, 1.4991]$\n\n目标函数规范：\n- 令四个参数表示为 $\\theta = (\\alpha, \\gamma, \\beta, \\mu)$，分别对应于基础水平 $\\alpha \\ge 0$、振幅 $\\gamma \\ge 0$、斜率 $\\beta  0$ 和拐点 $\\mu \\in [0,1]$。\n- 将 S 型函数 $f(m; \\theta)$ 定义为从第一性原理推导出的函数。\n- 目标是最小化 $$\\mathrm{SSE}(\\theta) = \\sum_{i=1}^{n} \\left(y_i - f(m_i; \\theta)\\right)^2,$$ 并受限于上述指定的参数边界。\n\n算法要求：\n- 对每个测试用例独立使用有界非线性最小二乘法来估计 $\\theta$。\n- 根据数据选择合理的初始猜测值（例如，使用 $Y$ 的最小值-最大值，以及对斜率和拐点使用典型的中等范围值）。\n- 确保所提供测试套件的数值稳定性和收敛性。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，该列表封装在方括号中，其中每个元素是按给定顺序为相应测试用例的四个四舍五入参数估计值的列表，例如，“[[a1,g1,b1,mu1],[a2,g2,b2,mu2],[a3,g3,b3,mu3],[a4,g4,b4,mu4]]”。每个数值必须四舍五入到三位小数，并以小数形式表示（无百分号）。",
            "solution": "用户请求解决一个涉及基因调控生物物理模型的非线性回归问题。该过程包括两个主要阶段：首先，从基本原理推导模型；其次，使用所提供的数据实施参数估计程序。\n\n### 第 1 步：从第一性原理推导 S 型模型\n\n该问题要求将基因表达 $y$ 建模为启动子甲基化分数 $m \\in [0,1]$ 的函数。该模型应从一个使用类玻尔兹曼加权的两态启动子可及性模型推导得出。\n\n1.  **两态启动子模型**：我们假设启动子可以存在于以下两种状态之一：\n    *   “ON”态 ($S_{ON}$)，即转录允许（可及）状态。\n    *   “OFF”态 ($S_{OFF}$)，即转录抑制（不可及）状态。\n    令这些状态的自由能分别为 $E_{ON}$ 和 $E_{OFF}$。\n\n2.  **甲基化对状态能量的影响**：CpG 甲基化通常与转录抑制相关。这意味着甲基化分数 $m$ 的增加会相对于 ON 态更稳定 OFF 态。这可以通过一个随 $m$ 增加的能量差 $\\Delta E = E_{ON} - E_{OFF}$ 来建模。一个简单而有效的模型是线性关系：\n    $$ \\Delta E(m) = k(m - \\mu) $$\n    这里，$k$ 是一个正常数，表示能隙对甲基化的敏感度，而 $\\mu$ 是两种状态具有相等能量（$\\Delta E = 0$）时的甲基化分数，此时它们出现的概率相等。这个参数 $\\mu$ 将成为我们 S 型曲线的拐点。\n\n3.  **玻尔兹曼分布与状态概率**：根据统计力学，系统处于 ON 态的概率 $P_{ON}$ 由玻尔兹曼因子给出：\n    $$ P_{ON} = \\frac{e^{-E_{ON}/k_B T}}{e^{-E_{ON}/k_B T} + e^{-E_{OFF}/k_B T}} $$\n    其中 $k_B$ 是玻尔兹曼常数，$T$ 是绝对温度。将分子和分母同除以 $e^{-E_{ON}/k_B T}$，我们得到：\n    $$ P_{ON} = \\frac{1}{1 + e^{(E_{ON} - E_{OFF})/k_B T}} = \\frac{1}{1 + e^{\\Delta E / k_B T}} $$\n    代入我们的 $\\Delta E(m)$ 线性模型：\n    $$ P_{ON}(m) = \\frac{1}{1 + e^{k(m - \\mu) / k_B T}} $$\n    我们可以将这些常数组合成一个单一的斜率参数 $\\beta = k / (k_B T)$。由于 $k  0$，$k_B  0$ 且 $T  0$，参数 $\\beta$ 必须为正。这给出了启动子处于转录活跃状态的概率：\n    $$ P_{ON}(m) = \\frac{1}{1 + e^{\\beta(m - \\mu)}} $$\n    这是一个 S 型函数，其值从 $1$（当 $m \\ll \\mu$ 时）递减到 $0$（当 $m \\gg \\mu$ 时），正确地捕捉到高甲基化会抑制“ON”态概率的现象。\n\n4.  **将状态概率与基因表达关联**：期望的基因表达水平 $y$ 是处于 ON 态概率的线性函数。存在一个最小或“基础”表达水平 $y_{min}$，对应于 OFF 态；以及一个最大水平 $y_{max}$，对应于 ON 态。\n    $$ y(m) = y_{min} \\cdot P_{OFF}(m) + y_{max} \\cdot P_{ON}(m) $$\n    由于 $P_{OFF}(m) = 1 - P_{ON}(m)$，我们可以写成：\n    $$ y(m) = y_{min} \\cdot (1 - P_{ON}(m)) + y_{max} \\cdot P_{ON}(m) = y_{min} + (y_{max} - y_{min}) \\cdot P_{ON}(m) $$\n\n5.  **最终的四参数模型**：我们将此方程映射到四个指定的参数上：\n    *   **基础水平 ($\\alpha$)**：这是最小表达水平，所以 $\\alpha = y_{min}$。它必须是非负的：$\\alpha \\ge 0$。\n    *   **振幅 ($\\gamma$)**：这是表达的动态范围，所以 $\\gamma = y_{max} - y_{min}$。它也必须是非负的：$\\gamma \\ge 0$。\n    *   **斜率 ($\\beta$)**：这是之前推导的斜率参数。它必须是正的：$\\beta  0$。\n    *   **拐点 ($\\mu$)**：这是半最大抑制时的甲基化水平，从能量模型中推导得出。它被限制在甲基化分数的有效范围内：$\\mu \\in [0, 1]$。\n\n    将这些代入 $y(m)$ 的表达式，得到最终的模型函数 $f(m; \\theta)$，其中 $\\theta = (\\alpha, \\gamma, \\beta, \\mu)$：\n    $$ f(m; \\alpha, \\gamma, \\beta, \\mu) = \\alpha + \\frac{\\gamma}{1 + e^{\\beta(m - \\mu)}} $$\n\n### 第 2 步：非线性回归公式\n\n目标是找到最能拟合观测数据对 $\\{(m_i, y_i)\\}_{i=1}^n$ 的参数向量 $\\theta = (\\alpha, \\gamma, \\beta, \\mu)$。这通过最小化残差平方和（SSE）目标函数来实现：\n$$ \\mathrm{SSE}(\\theta) = \\sum_{i=1}^{n} \\left( y_i - f(m_i; \\theta) \\right)^2 $$\n此最小化过程必须在上述推导出的参数边界条件下进行：\n*   $\\alpha \\in [0, \\infty)$\n*   $\\gamma \\in [0, \\infty)$\n*   $\\beta \\in (0, \\infty)$（为保证数值稳定性，实现为 $[10^{-9}, \\infty)$）\n*   $\\mu \\in [0, 1]$\n\n这构成了一个有界非线性最小二乘问题。我们将使用为此目的设计的 `scipy.optimize.least_squares` 函数。\n\n### 第 3 步：算法实现\n\n该实现对每个测试用例执行以下操作：\n1.  **数据准备**：将甲基化 $M$ 和表达 $Y$ 的输入列表转换为 `numpy` 数组。\n2.  **初始猜测**：为指导优化算法，从数据中生成一个合理的初始猜测值 $\\theta_0 = (\\alpha_0, \\gamma_0, \\beta_0, \\mu_0)$：\n    *   $\\alpha_0$ 设为观测到的最小表达值 `min(Y)`。\n    *   $\\gamma_0$ 设为观测到的表达范围 `max(Y) - min(Y)`。\n    *   $\\mu_0$ 设为与最接近表达范围中点 `min(Y) + range(Y)/2` 的表达水平 $y_i$ 相对应的甲基化值 $m_i$。\n    *   $\\beta_0$ 设为一个常数值 $10.0$，这是此类问题的典型起始点。\n3.  **优化**：使用残差函数、初始猜测值、数据和指定的参数边界调用 `scipy.optimize.least_squares` 函数。\n4.  **结果格式化**：从结果对象中检索优化后的参数向量。每个参数四舍五入到三位小数。收集所有测试用例的结果，并按照问题陈述的规定格式化为单个字符串。包含了一个特殊检查，用于将潜在的负零值（例如 `-0.0`）格式化为 `0.000`，以遵循 $\\alpha$ 和 $\\gamma$ 的非负约束。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef solve():\n    \"\"\"\n    Derives and applies a 4-parameter logistic model to fit gene expression data\n    as a function of promoter methylation.\n    \"\"\"\n\n    # Define the 4-parameter logistic (sigmoidal) model function\n    # This function is derived from a two-state biophysical model of transcription.\n    # y(m) = alpha + gamma / (1 + exp(beta * (m - mu)))\n    # Parameters:\n    # alpha: basal level (lower asymptote)\n    # gamma: amplitude (dynamic range, y_max - y_min)\n    # beta: slope parameter\n    # mu: inflection point (midpoint of the transition)\n    def sigmoidal_model(m, alpha, gamma, beta, mu):\n        return alpha + gamma / (1.0 + np.exp(beta * (m - mu)))\n\n    # Define the residuals function required by scipy.optimize.least_squares\n    # It returns a vector of errors: y_observed - y_predicted\n    def residuals(params, m, y):\n        alpha, gamma, beta, mu = params\n        y_predicted = sigmoidal_model(m, alpha, gamma, beta, mu)\n        return y - y_predicted\n\n    # Define the test cases provided in the problem statement\n    test_cases = [\n        # Test case 1\n        (\n            [0.0, 0.15, 0.3, 0.45, 0.5, 0.6, 0.8, 1.0],\n            [9.9464, 9.8465, 9.1431, 7.0109, 6.0, 4.0927, 2.2843, 2.0536]\n        ),\n        # Test case 2\n        (\n            [0.0, 0.1, 0.2, 0.25, 0.3, 0.35, 0.5, 0.7],\n            [10.0450, 9.9802, 9.3328, 8.0002, 5.4846, 2.9639, 1.0103, 0.9850]\n        ),\n        # Test case 3\n        (\n            [0.0, 0.2, 0.4, 0.6, 0.8, 1.0],\n            [3.32285, 3.31111, 3.29392, 3.26902, 3.23686, 3.20065]\n        ),\n        # Test case 4\n        (\n            [0.0, 0.3, 0.5, 1.0],\n            [7.2648, 5.6250, 3.3350, 1.4991]\n        )\n    ]\n\n    all_results = []\n    \n    # Process each test case independently\n    for M_list, Y_list in test_cases:\n        M = np.array(M_list)\n        Y = np.array(Y_list)\n\n        # Generate data-driven initial guesses for the parameters\n        alpha_0 = np.min(Y)\n        gamma_0 = np.max(Y) - np.min(Y)\n        beta_0 = 10.0  # A common initial guess for the slope\n        \n        # A robust initial guess for mu is the m-value where y is closest to the curve's midpoint\n        y_midpoint = alpha_0 + gamma_0 / 2.0\n        mid_index = np.argmin(np.abs(Y - y_midpoint))\n        mu_0 = M[mid_index]\n        \n        initial_guess = [alpha_0, gamma_0, beta_0, mu_0]\n\n        # Define parameter bounds based on biological/mathematical constraints\n        # alpha = 0, gamma = 0, beta  0, 0 = mu = 1\n        lower_bounds = [0.0, 0.0, 1e-9, 0.0]\n        upper_bounds = [np.inf, np.inf, np.inf, 1.0]\n        \n        # Perform bounded nonlinear least squares optimization\n        result = least_squares(\n            residuals,\n            x0=initial_guess,\n            args=(M, Y),\n            bounds=(lower_bounds, upper_bounds)\n        )\n        \n        # Store the optimized parameters\n        all_results.append(result.x)\n\n    # Format the final output string exactly as specified\n    formatted_results = []\n    for params in all_results:\n        # Format each parameter to 3 decimal places\n        param_strs = [f\"{p:.3f}\" for p in params]\n        # Join into a list-like string, e.g., \"[1.000,2.000,...]\"\n        # A check for -0.0 is needed as rounding small negative numbers can produce it\n        inner_list_str = \"[\" + \",\".join(param_strs).replace(\"-0.000\", \"0.000\") + \"]\"\n        formatted_results.append(inner_list_str)\n    \n    # Join the results for all test cases into the final string\n    final_output_str = \"[\" + \",\".join(formatted_results) + \"]\"\n    \n    # Print the single-line result\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}