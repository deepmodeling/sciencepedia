{
    "hands_on_practices": [
        {
            "introduction": "在我们分析或利用单倍型结构之前，我们必须能够从基因型数据中准确地推断出它。本练习聚焦于质量控制的一个关键方面：量化单倍型定相算法的准确性。通过推导和计算转换错误率及其置信区间，您将亲身体验用于验证基因组数据的统计模型，这是精准医学中的一项基本技能。",
            "id": "4355742",
            "problem": "在等位基因间存在非随机关联的区域（即连锁不平衡区），统计定相的一个常见性能指标是定相单倍型的转换错误率。考虑一项精准医疗和基因组诊断研究，该研究使用亲子三人组为子代中跨越连锁不平衡区块的部分连续杂合单核苷酸多态性位点建立基准定相。假设只要亲本基因型使得遗传传递明确无误，孟德尔遗传就能在某个位点上为子代提供正确的单倍型方向，并且无信息区间被排除在外。\n\n您在所有子代中观察到，所分析的连锁不平衡区块内有 $13{,}640$ 个连续杂合位点对。其中，$1{,}100$ 个连续位点对因对于基于遗传传递的基准而言无信息而被排除，剩下 $12{,}540$ 个有信息的转换机会。将算法定相的单倍型与源自三人组的基准进行比较，您统计到有 $173$ 个实例中，两个连续杂合位点之间的定相方向与基准不一致。\n\n仅使用基本定义和经过充分检验的统计学原理：\n- 在此情景下，精确定义定相单倍型的转换错误率。\n- 从一个具有未知错误概率 $p$ 的独立转换结果的伯努利模型出发，使用 $12{,}540$ 次机会和 $173$ 个观测到的错误，推导转换错误率的最大似然估计量 $\\hat{p}$。\n- 通过对二项比例的大样本得分检验（威尔逊得分区间）进行逆运算，使用标准正态分位数 $z_{1-\\alpha/2}$，以符号形式推导 $p$ 的双侧 $(1-\\alpha)$ 置信区间。不假设任何连续性校正。\n- 最后，使用 $\\alpha = 0.05$、$z_{0.975} = 1.96$ 以及给定的计数，对您的表达式进行数值计算，并以小数形式报告最大似然估计值以及双侧 $95\\%$ 置信区间的两个端点。\n\n将报告的每个量四舍五入到四位有效数字。以单行矩阵 $\\left(\\hat{p}, L, U\\right)$ 的形式提供您的最终数值答案，其中 $\\hat{p}$ 是点估计值，$L$ 是下限，$U$ 是上限。所有量均以纯数字表示，不带单位或百分号。",
            "solution": "该问题被认为是有效的，因为它在统计遗传学方面有科学依据，问题阐述清晰，有足够的数据和明确的目标，并且没有矛盾或含糊之处。\n\n### 1. 转换错误率的定义\n\n转换错误率是单倍型定相算法的一种性能指标。它被定义为在两个连续的杂合位点之间，推断的定相关系（即哪个等位基因位于哪个亲本染色体上）是错误的概率，记为 $p$。在本问题的背景下，转换错误的一次“机会”是指任何一对连续的杂合位点，其真实定相可以从亲子三人组数据中确定。转换错误率是观察到错误的这类机会所占的比例。它可以通过数据进行估计，即观测到的转换错误数 $k$ 除以有信息机会的总数 $n$。\n\n### 2. 转换错误率的最大似然估计量（MLE）\n\n问题指定了对 $n$ 个有信息机会中的每一次结果使用伯努利模型。设 $X_i$ 为第 $i$ 次机会的指示随机变量，其中 $i \\in \\{1, 2, \\dots, n\\}$。我们定义，如果发生转换错误，则 $X_i=1$（概率为 $p$）；如果定相正确，则 $X_i=0$（概率为 $1-p$）。假设错误是独立事件，观测到的错误总数 $k = \\sum_{i=1}^{n} X_i$ 服从二项分布，即 $K \\sim \\text{Binomial}(n, p)$。\n\n在 $n$ 次试验中观测到 $k$ 次错误的概率质量函数为：\n$$ P(K=k | n, p) = \\binom{n}{k} p^k (1-p)^{n-k} $$\n这个函数，当被视为关于观测数据 $(n, k)$ 的参数 $p$ 的函数时，就是似然函数 $L(p)$：\n$$ L(p; k, n) = \\binom{n}{k} p^k (1-p)^{n-k} $$\n为了找到最大似然估计量（MLE）$\\hat{p}$，我们需要最大化 $L(p)$。由于对数是单调函数，计算上更简单的方法是最大化似然函数的自然对数，即对数似然 $\\ln L(p)$。\n$$ \\ln L(p) = \\ln\\left(\\binom{n}{k}\\right) + k \\ln(p) + (n-k) \\ln(1-p) $$\n我们通过对 $p$ 求导并令其等于零来找到最大值：\n$$ \\frac{d}{dp} \\ln L(p) = \\frac{k}{p} - \\frac{n-k}{1-p} = 0 $$\n解出 $p$：\n$$ \\frac{k}{p} = \\frac{n-k}{1-p} $$\n$$ k(1-p) = p(n-k) $$\n$$ k - kp = np - kp $$\n$$ k = np $$\n因此，$p$ 的最大似然估计量是：\n$$ \\hat{p} = \\frac{k}{n} $$\n二阶导数 $\\frac{d^2}{dp^2} \\ln L(p) = -\\frac{k}{p^2} - \\frac{n-k}{(1-p)^2}$ 对于 $p \\in (0,1)$ 是负的，这证实了该值对应于一个最大值。\n\n### 3. Wilson 得分置信区间的推导\n\n$p$ 的一个双侧 $(1-\\alpha)$ 置信区间可以通过对大样本得分检验进行逆运算来推导。对于原假设 $H_0: p=p_0$，检验统计量由下式给出：\n$$ Z = \\frac{\\hat{p} - p_0}{\\sqrt{p_0(1-p_0)/n}} $$\n其中 $\\hat{p} = k/n$。置信区间是在显著性水平 $\\alpha$ 下我们不会拒绝 $H_0$ 的所有 $p_0$ 值的集合。这对应于不等式 $|Z| \\le z_{1-\\alpha/2}$，其中 $z_{1-\\alpha/2}$ 是标准正态分布的上 $(1-\\alpha/2)$ 分位数。为简单起见，我们将 $p_0$ 记为 $p$，将 $z_{1-\\alpha/2}$ 记为 $z$。\n$$ \\left| \\frac{\\hat{p} - p}{\\sqrt{p(1-p)/n}} \\right| \\le z $$\n两边平方可得：\n$$ (\\hat{p} - p)^2 \\le z^2 \\frac{p(1-p)}{n} $$\n乘以 $n$ 并展开各项，得到关于 $p$ 的二次不等式：\n$$ n(\\hat{p}^2 - 2\\hat{p}p + p^2) \\le z^2(p - p^2) $$\n$$ n\\hat{p}^2 - 2n\\hat{p}p + np^2 \\le z^2p - z^2p^2 $$\n将各项重新排列成标准形式 $Ap^2 + Bp + C \\le 0$：\n$$ (n+z^2)p^2 - (2n\\hat{p} + z^2)p + n\\hat{p}^2 \\le 0 $$\n相应二次方程 $(n+z^2)p^2 - (2n\\hat{p} + z^2)p + n\\hat{p}^2 = 0$ 的根提供了置信区间的端点。使用二次公式 $p = \\frac{-B \\pm \\sqrt{B^2-4AC}}{2A}$，其中 $A=n+z^2$，$B=-(2n\\hat{p}+z^2)$，$C=n\\hat{p}^2$：\n$$ p = \\frac{(2n\\hat{p} + z^2) \\pm \\sqrt{(-(2n\\hat{p} + z^2))^2 - 4(n+z^2)(n\\hat{p}^2)}}{2(n+z^2)} $$\n化简判别式（平方根下的项）：\n$$ (2n\\hat{p} + z^2)^2 - 4n(n+z^2)\\hat{p}^2 = 4n^2\\hat{p}^2 + 4n\\hat{p}z^2 + z^4 - 4n^2\\hat{p}^2 - 4nz^2\\hat{p}^2 \\\\ = 4n\\hat{p}z^2 - 4nz^2\\hat{p}^2 + z^4 = z^2(4n\\hat{p}(1-\\hat{p}) + z^2) $$\n将此代回求根公式，Wilson 得分区间 $(L, U)$ 的端点为：\n$$ (L, U) = \\frac{2n\\hat{p} + z^2 \\mp z\\sqrt{4n\\hat{p}(1-\\hat{p}) + z^2}}{2(n+z^2)} $$\n其中 $z=z_{1-\\alpha/2}$。\n\n### 4. 数值计算\n\n给定值为：\n- 有信息转换机会总数：$n = 12{,}540$。\n- 观测到的转换错误数：$k = 173$。\n- 显著性水平：$\\alpha = 0.05$。\n- 标准正态分位数：$z = z_{1-0.05/2} = z_{0.975} = 1.96$。\n\n首先，我们计算 MLE 点估计值 $\\hat{p}$：\n$$ \\hat{p} = \\frac{k}{n} = \\frac{173}{12{,}540} \\approx 0.01379585... $$\n四舍五入到四位有效数字，$\\hat{p} = 0.01380$。\n\n接下来，我们计算 Wilson 得分区间。我们使用推导出的公式。首先，计算必要的组成部分：\n- $z^2 = (1.96)^2 = 3.8416$。\n- $n\\hat{p} = k = 173$。\n- $2n\\hat{p} = 2k = 346$。\n- $n+z^2 = 12{,}540 + 3.8416 = 12{,}543.8416$。\n- $2(n+z^2) = 2 \\times 12{,}543.8416 = 25{,}087.6832$。\n\n现在，计算平方根下的项：\n$$ 4n\\hat{p}(1-\\hat{p}) + z^2 = 4k\\left(1 - \\frac{k}{n}\\right) + z^2 = 4(173)\\left(1 - \\frac{173}{12{,}540}\\right) + 3.8416 $$\n$$ = 692(0.9862041...) + 3.8416 \\approx 682.45327 + 3.8416 = 686.29487 $$\n平方根为 $\\sqrt{686.29487} \\approx 26.19723$。\n需要加减的项是 $z\\sqrt{...} \\approx 1.96 \\times 26.19723 \\approx 51.34657$。\n\n区间端点为：\n$$ (L, U) = \\frac{2k + z^2 \\mp z\\sqrt{4k(1-k/n) + z^2}}{2(n+z^2)} $$\n$$ (L, U) = \\frac{346 + 3.8416 \\mp 51.34657}{25{,}087.6832} = \\frac{349.8416 \\mp 51.34657}{25{,}087.6832} $$\n下限 $L$ 是：\n$$ L = \\frac{349.8416 - 51.34657}{25{,}087.6832} = \\frac{298.49503}{25{,}087.6832} \\approx 0.0118980... $$\n上限 $U$ 是：\n$$ U = \\frac{349.8416 + 51.34657}{25{,}087.6832} = \\frac{401.18817}{25{,}087.6832} \\approx 0.0159913... $$\n将结果四舍五入到四位有效数字：\n- $\\hat{p} = 0.01380$\n- $L = 0.01190$\n- $U = 0.01599$\n\n最终的数值结果是点估计值 $\\hat{p}$、置信下限 $L$ 和置信上限 $U$。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0.01380  0.01190  0.01599 \\end{pmatrix} } $$"
        },
        {
            "introduction": "连锁不平衡在基因组中造成了冗余，我们可以利用这一特性来设计性价比高的遗传学研究。本实践深入探讨了标签SNP（tag SNP）选择的经典问题，这是全基因组关联研究（GWAS）设计的基石。您将开发一种贪心算法，该算法在最大化基因组覆盖率与最小化基因分型成本和冗余之间取得平衡，从而将计算机科学的原理应用于解决基因组诊断中的核心问题。",
            "id": "4355690",
            "problem": "考虑一个包含 $n$ 个单核苷酸多态性（SNP）的基因组区域。输入为：一个成对连锁不平衡矩阵，其 $(i,j)$ 项是 SNP $i$ 和 SNP $j$ 之间的平方相关系数 $r^2_{ij}$；以及每个 SNP 的次要等位基因频率向量。目标是选择一组标签 SNP (tag SNP)，使其在指定的覆盖定义下共同覆盖该区域，同时最小化标签的数量。您的任务是，从第一性原理出发，推导一个基于核心定义的精确、确定性算法，用于选择一个最小的标签 SNP 集合，以达到指定的覆盖目标，同时明确阐述在等位基因频率和标签间冗余性方面的权衡。\n\n从以下核心定义和事实作为您的基本依据开始：\n- 双等位基因标记 $A$ 和 $B$ 之间的连锁不平衡由协方差 $D = p_{AB} - p_A p_B$ 和平方相关系数 $r^2 = \\dfrac{D^2}{p_A (1 - p_A) p_B (1 - p_B)}$ 来表征，其中 $p_A$ 和 $p_B$ 是两个位点的等位基因频率，$p_{AB}$ 是参考等位基因的单倍型频率。对于本问题，$r^2$作为输入提供，无需重新计算。\n- 在加性模型下，一个 SNP 关联的可检测性与该 SNP 的基因型方差成正比，即 $2 p (1 - p)$，其中 $p$ 是次要等位基因频率。在您的覆盖目标中，请使用此值作为每个 SNP 的等位基因频率权重。\n- 集合覆盖问题是一个著名的组合优化问题。您可以利用集合覆盖和确定性贪心选择的概念来构建算法方法，但必须形式化您的目标选择、停止准则和决胜规则，以确保输出是唯一且可测试的。\n\n定义如下：\n- 对于一个固定的覆盖阈值 $\\tau \\in [0,1]$，如果 $r^2_{t j} \\ge \\tau$，则称标签 SNP $t$ 覆盖了 SNP $j$。\n- 令 $w_j = 2 p_j (1 - p_j)$ 为 SNP $j$ 的权重，其中 $p_j$ 是其相应的次要等位基因频率。\n- 一个选定的标签集合 $T \\subseteq \\{0,1,\\dots,n-1\\}$ 的加权覆盖分数为\n$$\nC(T) \\;=\\; \\frac{\\sum_{j \\in \\mathcal{U}(T)} w_j}{\\sum_{j=0}^{n-1} w_j},\n$$\n其中 $\\mathcal{U}(T)$ 是在规则 $r^2_{t j} \\ge \\tau$ 下被 $T$ 中至少一个标签所覆盖的 SNP 集合。\n- 标签间的冗余性通过冗余阈值 $\\tau_{\\mathrm{red}} \\in [0,1]$ 来操作化，即如果两个标签 $t$ 和 $t'$ 满足 $r^2_{t t'} \\ge \\tau_{\\mathrm{red}}$，则认为它们是冗余的。\n\n您推导的算法必须：\n1. 在达到上述定义的加权覆盖分数 $C(T)$ 至少为目标值 $\\alpha \\in [0,1]$ 的前提下，最小化标签的数量。\n2. 是确定性的多项式时间算法。为确保确定性、可测试的行为，请采用以下您从第一性原理证明的贪心策略：在每次迭代中，从所有能对当前未覆盖 SNP 的加权覆盖产生严格正边际收益的候选标签 $t \\notin T$ 中，选择使冗余惩罚分数 $S(t \\mid T)$ 最大化的 $t$，该分数由下式给出：\n$$\nS(t \\mid T) \\;=\\; \\sum_{\\substack{j \\notin \\mathcal{U}(T) \\\\ r^2_{t j} \\ge \\tau}} w_j \\;-\\; \\lambda \\cdot \\left|\\{ t' \\in T \\,:\\, r^2_{t t'} \\ge \\tau_{\\mathrm{red}} \\}\\right|,\n$$\n其中 $\\lambda \\ge 0$ 是一个惩罚系数，用于控制获取新覆盖与避免冗余标签之间的权衡。通过选择最小的索引 $t$ 来解决平局问题。\n3. 当 $C(T) \\ge \\alpha$ 或没有候选标签能提供严格正的边际收益时停止。返回集合 $T$。\n\n对于下面的每个测试用例，计算并返回：\n- 按升序排列的所选标签索引列表。\n- 实现的加权覆盖分数 $C(T)$，表示为小数点后保留六位的小数（不带百分号）。\n- $T$ 中冗余标签对的整数计数，定义为满足 $r^2_{t t'} \\ge \\tau_{\\mathrm{red}}$ 的无序对 $\\{t,t'\\} \\subseteq T$ 的数量。\n\n将您的算法实现为一个完整的、可运行的程序，该程序不接受任何输入，并使用下面硬编码的测试套件。您的程序应生成单行输出，其中包含所有测试用例的结果，格式为一个由逗号分隔的列表，并用方括号括起来。对于每个测试用例，结果必须是 `[selected_indices_list,coverage_decimal,redundant_pair_count]` 形式的列表。因此，最终输出应为这样一个列表的列表，打印在单行上，不含空格。\n\n测试套件（所有索引都从零开始，所有矩阵都是对称的，对角线上为 1）：\n- 测试用例 1（块结构，完全覆盖）：\n  - $n = 5$\n  - 次要等位基因频率：$[0.2,\\,0.2,\\,0.35,\\,0.35,\\,0.1]$\n  - $r^2$ 矩阵：\n    $$\n    \\begin{bmatrix}\n    1.00  0.92  0.10  0.15  0.05 \\\\\n    0.92  1.00  0.12  0.08  0.04 \\\\\n    0.10  0.12  1.00  0.88  0.06 \\\\\n    0.15  0.08  0.88  1.00  0.05 \\\\\n    0.05  0.04  0.06  0.05  1.00\n    \\end{bmatrix}\n    $$\n  - 参数：$\\tau = 0.8$, $\\tau_{\\mathrm{red}} = 0.9$, $\\alpha = 1.0$, $\\lambda = 0.5$.\n- 测试用例 2（相同区域，部分覆盖目标，无冗余惩罚）：\n  - $n = 5$\n  - 次要等位基因频率：$[0.2,\\,0.2,\\,0.35,\\,0.35,\\,0.1]$\n  - 与测试用例 1 相同的 $r^2$ 矩阵。\n  - 参数：$\\tau = 0.8$, $\\tau_{\\mathrm{red}} = 0.9$, $\\alpha = 0.6$, $\\lambda = 0.0$.\n- 测试用例 3（所有 SNP 高度相关）：\n  - $n = 4$\n  - 次要等位基因频率：$[0.2,\\,0.3,\\,0.4,\\,0.1]$\n  - $r^2$ 矩阵的非对角线元素为 $0.95$，对角线元素为 $1.0$：\n    $$\n    \\begin{bmatrix}\n    1.00  0.95  0.95  0.95 \\\\\n    0.95  1.00  0.95  0.95 \\\\\n    0.95  0.95  1.00  0.95 \\\\\n    0.95  0.95  0.95  1.00\n    \\end{bmatrix}\n    $$\n  - 参数：$\\tau = 0.8$, $\\tau_{\\mathrm{red}} = 0.9$, $\\alpha = 1.0$, $\\lambda = 0.5$.\n- 测试用例 4（除自身外无连锁不平衡）：\n  - $n = 3$\n  - 次要等位基因频率：$[0.2,\\,0.35,\\,0.5]$\n  - $r^2$ 矩阵：\n    $$\n    \\begin{bmatrix}\n    1.00  0.00  0.00 \\\\\n    0.00  1.00  0.00 \\\\\n    0.00  0.00  1.00\n    \\end{bmatrix}\n    $$\n  - 参数：$\\tau = 0.8$, $\\tau_{\\mathrm{red}} = 0.9$, $\\alpha = 1.0$, $\\lambda = 0.5$.\n- 测试用例 5（冗余簇加单个体）：\n  - $n = 4$\n  - 次要等位基因频率：$[0.2,\\,0.2,\\,0.2,\\,0.2]$\n  - $r^2$ 矩阵：\n    $$\n    \\begin{bmatrix}\n    1.00  0.95  0.85  0.10 \\\\\n    0.95  1.00  0.85  0.10 \\\\\n    0.85  0.85  1.00  0.10 \\\\\n    0.10  0.10  0.10  1.00\n    \\end{bmatrix}\n    $$\n  - 参数：$\\tau = 0.8$, $\\tau_{\\mathrm{red}} = 0.9$, $\\alpha = 1.0$, $\\lambda = 2.0$.\n\n您的程序应生成单行输出，其中包含一个由逗号分隔的列表形式的结果，并用方括号括起来（例如 `[[...],[...],...]`），行内任何地方都没有空格。",
            "solution": "目标是构建一个有原则的、确定性的算法，用于选择一组最小的标签单核苷酸多态性（SNP），以在连锁不平衡下实现对一个区域的目标覆盖。该推导过程基于与连锁不平衡、等位基因频率和集合覆盖相关的核心定义。\n\n首先，平方相关系数 $r^2$ 编码了一个 SNP 对另一个 SNP 的预测能力。一个自然的覆盖模型是，如果对于选定的阈值 $\\tau \\in [0,1]$ 有 $r^2_{tj} \\ge \\tau$，则称标签 SNP $t$ 可以作为 SNP $j$ 的代理。为了将覆盖与关联研究中的统计功效联系起来，我们根据加性模型下的基因型方差 $w_j = 2 p_j (1 - p_j)$ 对每个 SNP 进行加权，其中 $p_j$ 是次要等位基因频率。这一选择的动机是，在加性模型下，基因型计量的方差与 $2p(1-p)$ 成正比，这在给定固定效应大小的情况下会影响可检测的信号强度。\n\n优化目标是在确保加权覆盖分数\n$$\nC(T) = \\frac{\\sum_{j \\in \\mathcal{U}(T)} w_j}{\\sum_{j=0}^{n-1} w_j}\n$$\n至少达到目标 $\\alpha \\in [0,1]$ 的同时最小化标签数量，其中 $\\mathcal{U}(T)$ 表示通过规则 $r^2_{tj} \\ge \\tau$ 被 $T$ 中任何标签覆盖的 SNP。这是一个加权集合覆盖问题：每个候选标签 $t$ 定义了它所覆盖的 SNP 集合 $S_t = \\{ j : r^2_{t j} \\ge \\tau \\}$；选择标签就是选择集合，以覆盖总权重至少为总权重比例 $\\alpha$ 的 SNP 全集。加权集合覆盖是组合问题，通常对于大的 $n$ 来说，找到最优解是计算上不可行的（它是 $\\mathcal{NP}$-难问题）。一种经过充分检验的方法是贪心近似算法，它迭代地选择具有最大边际增益的集合。\n\n为了解决标签间的冗余问题——即两个标签本身处于高度连锁不平衡中——我们引入了冗余惩罚。引入一个冗余阈值 $\\tau_{\\mathrm{red}}$ 和一个惩罚系数 $\\lambda \\ge 0$。在给定当前选择 $T$ 的情况下评估候选标签 $t$ 时，定义分数为\n$$\nS(t \\mid T) = \\underbrace{\\sum_{\\substack{j \\notin \\mathcal{U}(T) \\\\ r^2_{t j} \\ge \\tau}} w_j}_{\\text{边际覆盖收益}} \\;-\\; \\underbrace{\\lambda \\cdot \\left|\\{ t' \\in T : r^2_{t t'} \\ge \\tau_{\\mathrm{red}} \\}\\right|}_{\\text{冗余惩罚}}.\n$$\n边际覆盖收益是如果添加 $t$ 后未覆盖 SNP 的增量加权覆盖。如果 $t$ 与已选标签高度连锁，冗余惩罚会降低分数，这反映了在成本和分析复用性很重要的精准医疗环境中，收益递减和基因分型效率低下的问题。这种通过 $\\lambda$ 调谐的覆盖与冗余之间的权衡，反映了现实世界中标签 SNP 设计的情景，即需要在统计功效和分析冗余之间取得平衡。\n\n因此，我们推导出以下确定性贪心算法：\n1. 初始化所选标签集 $T = \\varnothing$ 和已覆盖集 $\\mathcal{U}(T) = \\varnothing$。\n2. 当 $C(T)  \\alpha$ 时循环：\n   - 对于每个候选标签 $t \\notin T$，计算边际收益\n     $$\n     B(t \\mid T) = \\sum_{\\substack{j \\notin \\mathcal{U}(T) \\\\ r^2_{t j} \\ge \\tau}} w_j.\n     $$\n   - 将注意力限制在 $B(t \\mid T)  0$ 的候选标签上；如果不存在这样的候选标签，则中断循环（覆盖无法进一步提高）。\n   - 对于每个这样的 $t$，计算冗余计数\n     $$\n     R(t \\mid T) = \\left|\\{ t' \\in T : r^2_{t t'} \\ge \\tau_{\\mathrm{red}} \\}\\right|,\n     $$\n     以及分数 $S(t \\mid T) = B(t \\mid T) - \\lambda R(t \\mid T)$。\n   - 选择使 $S(t \\mid T)$ 最大化的 $t$，通过选择最小的索引 $t$ 来解决平局。\n   - 更新 $T \\leftarrow T \\cup \\{t\\}$ 和 $\\mathcal{U}(T) \\leftarrow \\mathcal{U}(T) \\cup \\{ j : r^2_{t j} \\ge \\tau \\}$。\n3. 返回 $T$ 中标签索引的排序列表、实现的小数点后六位的 $C(T)$，以及所选标签中的冗余对计数，即 $\\left|\\{ \\{t,t'\\} \\subseteq T : r^2_{t t'} \\ge \\tau_{\\mathrm{red}},\\, t  t' \\}\\right|$。\n\n该算法由于明确的决胜规则而是多项式时间和确定性的。它基于：\n- 通过 $r^2$ 定义的覆盖，\n- 反映基因型方差的、基于等位基因频率的权重 $2p(1-p)$，\n- 最大化边际加权覆盖的集合覆盖启发式方法，\n- 捕捉覆盖与分析冗余之间权衡的显式冗余控制。\n\n我们现在通过遵循该算法来计算每个测试用例的预期输出。\n\n对于测试用例 1：\n- 权重为 $w = [0.32, 0.32, 0.455, 0.455, 0.18]$，总权重 $W = 1.73$。\n- 覆盖阈值 $\\tau = 0.8$ 产生的覆盖集为 $S_0 = \\{0,1\\}$, $S_1 = \\{1,0\\}$, $S_2 = \\{2,3\\}$, $S_3 = \\{3,2\\}$, $S_4 = \\{4\\}$。\n- 迭代 1：边际收益为 $B(0)=0.64$, $B(1)=0.64$, $B(2)=0.91$, $B(3)=0.91$, $B(4)=0.18$。当 $\\lambda = 0.5$ 且 $T=\\varnothing$ 时，分数等于收益。在两个最佳选择中，决胜规则选择最小的索引 $t=2$。现在已覆盖权重为 $0.91$。\n- 迭代 2：未覆盖的 SNP 为 $\\{0,1,4\\}$。边际收益为 $B(0)=0.64$, $B(1)=0.64$, $B(4)=0.18$，冗余惩罚为零（与标签 2 的 $r^2$ 没有 $\\ge 0.9$ 的）。选择 $t=0$。已覆盖权重变为 $1.55$。\n- 迭代 3：未覆盖的 SNP 为 $\\{4\\}$。选择 $t=4$；已覆盖权重变为 $1.73$。\n- 覆盖分数 $C(T) = 1.73/1.73 = 1.0$；排序后的标签为 $[0,2,4]$；冗余对计数为 $0$，因为所有标签间的 $r^2$ 都低于 $\\tau_{\\mathrm{red}}$。\n\n对于测试用例 2：\n- 相同的 $w$ 和 $S_t$ 集合；$\\alpha = 0.6$，$\\lambda = 0.0$。\n- 迭代 1：选择 $t=2$（收益 $0.91$），覆盖分数为 $0.91/1.73 \\approx 0.525145$，不够。\n- 迭代 2：次优选择是 $t=0$（收益 $0.64$），达到已覆盖权重 $1.55$。\n- 覆盖分数 $C(T) = 1.55/1.73 = 155/173 \\approx 0.895954$；排序后的标签为 $[0,2]$；冗余计数为 $0$。\n\n对于测试用例 3：\n- 权重 $w = [0.32, 0.42, 0.48, 0.18]$，总权重 $W = 1.4$。任何单个标签都可覆盖所有 SNP，因为所有非对角线 $r^2 = 0.95 \\ge 0.8$。\n- 迭代 1：所有候选标签的收益均为 $1.4$；选择最小的索引 $t=0$。\n- 覆盖分数 $C(T) = 1.0$；排序后的标签为 $[0]$；冗余计数为 $0$。\n\n对于测试用例 4：\n- 权重 $w = [0.32, 0.455, 0.5]$，$W = 1.275$；由于非对角线 $r^2$ 为零，只存在自我覆盖。\n- 贪心算法选择 $t=2$，然后是 $t=1$，然后是 $t=0$ 以实现完全覆盖。\n- 覆盖分数 $C(T) = 1.0$；排序后的标签为 $[0,1,2]$；冗余计数为 $0$。\n\n对于测试用例 5：\n- 所有权重相等，$w = [0.32, 0.32, 0.32, 0.32]$，$W = 1.28$。前三个 SNP 形成一个冗余簇（它们之间的 $r^2 \\ge 0.85$），第四个几乎是独立的（$r^2 = 0.10$）。\n- 迭代 1：标签 0、1、2 中任何一个的最佳收益都是 $0.96$；选择 $t=0$（最小索引）。\n- 迭代 2：只有 SNP $3$ 仍未被覆盖；选择 $t=3$。\n- 覆盖分数 $C(T) = 1.0$；排序后的标签为 $[0,3]$；冗余计数为 $0$，因为 $r^2_{0,3} = 0.10  \\tau_{\\mathrm{red}}$。\n\n所需的程序实现了上述算法，运行测试套件，并打印出单行结果列表，不含空格，其中覆盖分数四舍五入到六位小数，冗余对计数计算为满足 $r^2 \\ge \\tau_{\\mathrm{red}}$ 的标签对数量。",
            "answer": "```\n[[[0,2,4],1.0,0],[[0,2],0.895954,0],[[0],1.0,0],[[0,1,2],1.0,0],[[0,3],1.0,0]]\n```"
        },
        {
            "introduction": "我们今天观察到的单倍型结构是由历史重组事件塑造的镶嵌体。本练习探讨如何通过识别解释数据所需的最小重组次数，从一组定相的单倍型中解读这段历史。通过实施基于四配子测试的算法，您将学习如何使用相容性原则对产生遗传多样性的基本进化过程进行推断。",
            "id": "4355722",
            "problem": "给定一个二进制单倍型矩阵，该矩阵表示在无穷位点模型下，跨二等位单核苷酸多态性 (SNP) 位点的定相单倍型。该矩阵有 $n$ 行（单倍型）和 $m$ 列（位点），矩阵中的条目为 $\\{0,1\\}$，分别表示祖先等位基因和衍生等位基因。完美系统发育模型断言，在无穷位点假设下，当且仅当每对位点都是两两兼容时，观测到的单倍型才能由一棵没有重组的树来解释。一个用于检验两两兼容性的基本且广泛使用的方法是四配子检验：如果在一对位点 $(i,j)$ 上，观测到的所有单倍型中的有序等位基因对集合包含了全部四种组合 $\\{(0,0),(0,1),(1,0),(1,1)\\}$，则这对位点与完美系统发育不兼容。\n\n在简约完美系统发育框架中，当存在不兼容性时，通过在相邻位点之间放置重组断点来对基因组进行分段，以确保每个区段都允许构建完美系统发育（即，在每个区段内，根据四配子检验，每对位点都是两两兼容的）。重组断点只能放置在 $m-1$ 个连续位点之间的间隙之一，这些间隙由整数 $0,1,\\dots,m-2$ 索引，其中间隙 $k$ 位于位点 $k$ 和位点 $k+1$ 之间。\n\n从以下基础出发：\n- 在无穷位点模型下，两个位点上存在全部四种有序等位基因对意味着，若无重组或复发突变，没有任何单一的树可以解释这两个位点。\n- 在简约完美系统发育框架中，不允许复发突变，而重组被建模为将序列划分为多个区段的断点，每个区段都必须能由一个完美系统发育解释（因此，区段内的所有位点对都必须通过四配子检验）。\n\n推导、论证并实现一个算法，该算法计算将单倍型矩阵分割成允许完美系统发育的区块所需的最小重组断点数。您的推导必须将问题归约为一个在位点索引直线上的良构组合优化问题，并且必须得出一个正确且可证明为最优的算法。\n\n算法的输入是一个 $n \\times m$ 的二进制矩阵 $H$，输出是一个非负整数：所需的最小重组断点数。对于每一对不兼容位点 $(i,j)$（其中 $0 \\le i  j \\le m-1$），请注意，任何有效的分段都必须在间隙区间 $\\{i,i+1,\\dots,j-1\\}$ 内放置至少一个断点，否则这些位点将保留在同一区段内，从而违反完美系统发育条件。您的算法应利用这一结构来计算最小断点数。\n\n您的程序必须实现所推导的算法，并在以下单倍型矩阵测试套件上进行评估。所有矩阵都以行为单倍型、列为位点的方式指定；条目在 $\\{0,1\\}$ 中：\n\n- 测试用例 1 (完美系统发育，预期零重组): \n  $$H^{(1)} = \\begin{bmatrix}\n  0  0  0 \\\\\n  0  1  0 \\\\\n  1  1  0 \\\\\n  1  1  1\n  \\end{bmatrix}.$$\n\n- 测试用例 2 (相邻不兼容性要求在每个相邻间隙处设置一个断点):\n  $$H^{(2)} = \\begin{bmatrix}\n  0  0  0  0 \\\\\n  0  1  0  1 \\\\\n  1  0  1  0 \\\\\n  1  1  1  1\n  \\end{bmatrix}.$$\n\n- 测试用例 3 (区块间的单个边界；许多不兼容性都跨越同一个边界):\n  $$H^{(3)} = \\begin{bmatrix}\n  0  0  0  0  0 \\\\\n  0  0  0  1  1 \\\\\n  1  1  1  0  0 \\\\\n  1  1  1  1  1\n  \\end{bmatrix}.$$\n\n- 测试用例 4 (两个不相交的不兼容范围；需要至少两个断点):\n  $$H^{(4)} = \\begin{bmatrix}\n  0  0  0  0  0  0 \\\\\n  0  0  1  0  0  1 \\\\\n  1  0  0  1  0  0 \\\\\n  1  0  1  0  0  1 \\\\\n  0  0  0  1  0  1\n  \\end{bmatrix}.$$\n\n- 测试用例 5 (两位点四配子对；一个断点即可):\n  $$H^{(5)} = \\begin{bmatrix}\n  0  0 \\\\\n  0  1 \\\\\n  1  0 \\\\\n  1  1\n  \\end{bmatrix}.$$\n\n输出规范：您的程序应生成单行输出，其中包含每个测试用例的最小重组断点数，按顺序排列，形式为用方括号括起来的逗号分隔列表，例如 $\\texttt{[r_1,r_2,r_3,r_4,r_5]}$，其中每个 $r_k$ 是一个整数。\n\n不涉及物理单位或角度单位。所有整数都应不带任何附加符号。程序必须是自包含的，并且不得从标准输入或任何外部文件读取输入。算法必须根据所述原则推导并忠实实现。",
            "solution": "用户提供的问题已经过分析，并被认定为有效。该问题在群体遗传学方面有科学依据，是一个良构的组合优化问题，并且所有术语和条件都得到了清晰客观的定义。\n\n### 问题验证\n\n#### 步骤 1：提取已知条件\n\n- **输入**: 一个大小为 $n \\times m$ 的二进制单倍型矩阵 $H$，其中 $n$ 是单倍型数量，$m$ 是二等位 SNP 位点数量。条目为 $\\{0, 1\\}$，表示祖先等位基因和衍生等位基因。\n- **模型**: 假设为无穷位点模型，其中每个突变都发生在新位点上，没有逆向或平行突变。\n- **完美系统发育**: 一组单倍型能由一个完美系统发育（一棵没有重组的树）解释，当且仅当每对位点都是两两兼容的。\n- **两两兼容性检验（四配子检验）**: 如果在两个位点 $(i, j)$ 上观测到的有序等位基因对集合包含所有四种组合：$\\{(0,0), (0,1), (1,0), (1,1)\\}$，则这对位点不兼容。\n- **重组模型**: 重组被建模为在相邻位点间的间隙处放置断点。共有 $m-1$ 个可能的间隙，索引为 $0, 1, \\dots, m-2$。间隙 $k$ 处的断点位于位点 $k$ 和位点 $k+1$ 之间。\n- **分段目标**: 将位点序列分割成多个区块，每个区块都必须允许构建完美系统发育。这意味着在每个区块内，所有位点对都必须是两两兼容的。\n- **约束**: 对于任何不兼容的位点对 $(i, j)$（其中 $i  j$），任何有效的分段都必须在间隙区间 $\\{i, i+1, \\dots, j-1\\}$ 内放置至少一个断点。\n- **目标**: 计算实现有效分段所需的最小重组断点数。\n- **输出**: 一个代表此最小数量的非负整数。\n- **测试用例**: 提供了五个特定的单倍型矩阵 $H^{(1)}, \\dots, H^{(5)}$ 用于评估。\n- **输出格式**: 单行 `[r_1,r_2,r_3,r_4,r_5]`，其中 $r_k$ 是测试用例 $k$ 的结果。\n\n#### 步骤 2：使用提取的已知条件进行验证\n\n- **科学依据**: 该问题基于计算生物学和群体遗传学中基本且广泛使用的概念，包括无穷位点模型、完美系统发育和四配子检验 (Hudson and Kaplan, 1985)。这些是分析单倍型数据和推断重组的标准理论工具。该问题在科学上是合理的。\n- **良构性**: 该问题要求在明确的约束条件下求断点数的最小值。这是一个定义明确的组合优化问题，保证存在唯一的最小整数值（该值至少为 $0$，至多为 $m-1$）。\n- **客观性**: 问题陈述使用了正式、精确且无歧义的术语。所有定义和条件都是数学化的，没有主观解释的余地。\n- **完整性和一致性**: 问题是自包含的。输入、不兼容性规则、分段机制和优化目标都已明确提供且相互一致。\n- **现实性**: 单倍型矩阵和最小化重组问题是基因组分析中现实世界问题的简化但忠实的表示。\n\n#### 步骤 3：结论与行动\n\n该问题有效。将提供完整的推导和解决方案。\n\n### 推导与求解\n\n问题是将位点集合 $\\{0, 1, \\dots, m-1\\}$ 划分为最少数量的连续区块，使得每个区块内的所有位点对都是兼容的。在间隙 $k$ 处放置一个断点会在位点 $k$ 和位点 $k+1$ 之间创建一个边界。\n\n**形式化为组合问题**\n\n设 $H$ 为给定的 $n \\times m$ 单倍型矩阵。两个位点 $i$ 和 $j$（$i  j$）之间不兼容的条件是，四种配子——$(0,0), (0,1), (1,0), (1,1)$——都出现在由第 $i$ 列和第 $j$ 列构成的子矩阵的行中。如果一对位点 $(i, j)$ 不兼容，它们就不能共存于同一个有效区块中。这意味着任何有效的分段都必须在间隙 $k$ 处放置至少一个断点，使得 $i \\le k  j$。\n\n这个要求可以被构建成一个**击中集** (Hitting Set) 问题的实例。设点的集合为间隙 $P = \\{0, 1, \\dots, m-2\\}$。对于每个不兼容的位点对 $(i, j)$（其中 $i  j$），我们定义一个约束区间 $C_{ij} = [i, j-1]$。我们的目标是找到一个最小尺寸的点子集 $B \\subseteq P$（断点集合），使得对于每个约束区间 $C_{ij}$，交集 $B \\cap C_{ij}$ 都不为空。这是直线上区间的击中集问题，已知可通过贪心算法在多项式时间内求解。\n\n**最优贪心算法**\n\n区间击中集问题的标准贪心策略如下：找到结束点最早的区间，在该结束点放置一个点，移除所有被该点击中的区间，然后重复此过程，直到所有区间都被击中。对于我们的问题，一个等价且更直接的方法是对位点进行单次从左到右的扫描。\n\n算法通过尝试从染色体的起始位置（或上一个断点之后的位点）开始构建尽可能大的有效区块来进行。\n\n1.  初始化断点数 $R$ 为 $0$。初始化当前区块的起始位置 `block_start` 为位点 $0$。\n2.  从 $1$ 到 $m-1$ 遍历位点 $j$。\n3.  对于每个位点 $j$，检查其与当前区块内所有在它之前的位点 $i$（其中 `block_start` $\\le i  j$）的兼容性。\n4.  兼容性通过对矩阵 $H$ 的第 $i$ 列和第 $j$ 列进行四配子检验来测试。\n5.  如果发现不兼容的位点对 $(i, j)$，则无法将位点 $j$ 包含在从 `block_start` 开始的当前区块中。因此，当前区块必须在位点 $j-1$ 处结束。为实现这一点，我们必须在间隙 $j-1$ 处放置一个断点。\n6.  发现这样的不兼容性后，我们将断点计数 $R$ 加一，并在位点 $j$ 处开始一个新的区块。我们将 `block_start` 更新为 $j$。然后我们可以停止检查位点 $j$ 与现已终止的区块中更早位点的兼容性，并继续处理下一个位点 $j+1$。\n7.  如果位点 $j$ 与范围 [`block_start`, $j-1$] 内的所有位点 $i$ 都兼容，则区块扩展以包含位点 $j$，算法继续检查位点 $j+1$。\n\n这个过程一直持续到所有位点直至 $m-1$ 都被处理完毕。$R$ 的最终值就是所需的最小断点数。\n\n**最优性证明**\n\n设贪心算法为 $G$。假设 $G$ 在间隙 $g_1  g_2  \\dots  g_{R_G}$ 处放置了 $R_G$ 个断点。设 $O$ 是一个最优解，它在间隙 $p_1  p_2  \\dots  p_{R_O}$ 处放置了 $R_O$ 个断点。我们必须证明 $R_G = R_O$。\n\n第一个贪心断点 $g_1$ 放置在间隙 $j_1-1$ 处，其中 $j_1$ 是大于 $0$ 的最小位点索引，且存在一个不兼容对 $(i_1, j_1)$ 满足 $0 \\le i_1  j_1$。任何有效解都必须切断区间 $[i_1, j_1]$，这需要在间隙区间 $[i_1, j_1-1]$ 内放置一个断点。因此，任何最优解的第一个断点 $p_1$ 都必须满足 $p_1 \\le j_1-1 = g_1$。\n\n现在，进行归纳假设，对于前 $k$ 个断点，有 $p_k \\le g_k$。让我们考虑第 $(k+1)$ 个贪心断点 $g_{k+1}$。它被放置在间隙 $j_{k+1}-1$ 处，其中 $j_{k+1}$ 是大于 $g_k+1$ 的最小位点索引，且存在一个不兼容对 $(i_{k+1}, j_{k+1})$ 满足 $g_k+1 \\le i_{k+1}  j_{k+1}$。任何有效解都必须在间隙区间 $[i_{k+1}, j_{k+1}-1]$ 内放置一个断点。由于在 $p_k$ 之后开始的区块必须是有效的，且 $p_k \\le g_k  i_{k+1}$，解 $O$ 必须有一个断点 $p_l$ 来击中这个区间。在 $p_k$ 之后的第一个这样的断点是 $p_{k+1}$。因此，$p_{k+1}$ 必须在范围 $[i_{k+1}, j_{k+1}-1]$ 内，这意味着 $p_{k+1} \\le j_{k+1}-1 = g_{k+1}$。通过归纳法，对于所有 $k=1, \\dots, R_O$，都有 $p_k \\le g_k$。\n\n如果 $R_O  R_G$，考虑在间隙 $p_{R_O}$ 之后开始的区块。由于 $p_{R_O} \\le g_{R_O}$，这个区块在 $g_{R_O}$ 之后开始的区块之前或同时开始。贪心算法放置其第 $(R_O+1)$ 个断点 $g_{R_O+1}$，是因为它找到了一个不兼容对 $(i, j)$，满足 $g_{R_O}+1 \\le i  j$。由于 $p_{R_O} \\le g_{R_O}$，位点 $i$ 和 $j$ 都落入最优解的最后一个区块 $[p_{R_O}+1, m-1]$ 中。这与 $O$ 是一个有效解的假设相矛盾。因此，$R_O$ 不能小于 $R_G$。又因为 $O$ 是最优解，所以 $R_O \\le R_G$。唯一可能性是 $R_O = R_G$。\n\n因此，贪心算法被证明是最优的。",
            "answer": "```\n[0,3,1,2,1]\n```"
        }
    ]
}