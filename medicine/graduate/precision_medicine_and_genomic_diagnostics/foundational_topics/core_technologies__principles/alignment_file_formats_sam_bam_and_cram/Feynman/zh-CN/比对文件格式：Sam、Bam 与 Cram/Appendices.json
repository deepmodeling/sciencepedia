{
    "hands_on_practices": [
        {
            "introduction": "在基因组学数据分析中，`QUAL` 字段是质量控制的基石，它为每个碱基的测序准确性提供了量化评估。变异检测等下游分析工具在很大程度上依赖这些经过Phred标度编码的质量分数来区分真实的遗传变异与测序过程中的随机错误。本练习  将指导你进行一项基本而关键的技能实践：将 `QUAL` 字段中的ASCII字符解码为其所代表的碱基识别错误概率，这对于精确解读比对文件中的证据至关重要。",
            "id": "4314709",
            "problem": "一个用于精准肿瘤学中靶向测序的临床基因组学流程将读段比对结果存储为序列比对/图谱（SAM）文本格式，其下游归档则采用二进制比对/图谱（BAM）和压缩参考导向比对图谱（CRAM）格式。为校准变异检出的置信度，一位生物信息学家检查了一个跨越临床相关单核苷酸变异的读段的 SAM QUAL 字段，并找到了以该变异位点为中心的连续三个碱基的质量字符串“F?@”。在 SAM 规范中，碱基质量字符使用 Phred+33 进行编码，即从字符的美国信息交换标准代码（ASCII）码中减去 $33$ 即可得到数值化的 Phred 质量分数 $Q$。字符“F”、“?”和“@”的 ASCII 码分别为 $70$、$63$ 和 $64$。Phred 质量分数 $Q$ 由碱基检出错误概率 $p$ 通过 $Q=-10\\log_{10}(p)$ 从第一性原理定义，其中 $\\log_{10}(\\cdot)$ 表示以 10 为底的对数。仅从这些定义出发，将 QUAL 字符串“F?@”转换为相应的 Phred 分数，并计算这三个碱基各自的碱基检出错误概率 $p$。请按照 QUAL 字符串中字符的顺序，以保留六位有效数字的小数形式提供这三个概率。请勿使用百分号表示结果；概率必须是无单位的纯小数。",
            "solution": "该问题要求将 SAM 文件中的碱基质量字符串转换为相应的碱基检出错误概率。此过程涉及从所提供定义中派生出的两个连续转换步骤：首先，从 ASCII 字符转换为数值化的 Phred 质量分数（表示为 $Q$）；其次，从 Phred 分数转换为错误概率（表示为 $p$）。\n\n问题陈述了以下定义：\n1. 从 ASCII 字符到 Phred 分数 $Q$ 的转换使用 Phred+33 编码方案，其关系定义为：\n$$Q = A - 33$$\n其中 $A$ 代表字符的数值 ASCII 码。\n\n2. Phred 质量分数 $Q$ 根据第一性原理，通过碱基检出错误概率 $p$ 由以下方程定义：\n$$Q = -10\\log_{10}(p)$$\n\n为确定给定质量字符的概率 $p$，我们必须首先将 $p$ 表示为 $Q$ 的函数。我们可以通过代数运算重新排列第二个方程。两边同除以 $-10$ 得：\n$$-\\frac{Q}{10} = \\log_{10}(p)$$\n根据以 10 为底的对数的定义，如果 $y = \\log_{10}(x)$，则 $x = 10^y$。将此应用于我们的方程，得到 $p$ 的表达式：\n$$p = 10^{-\\frac{Q}{10}}$$\n现在我们可以将第一个方程代入此结果，以获得一个直接关联 ASCII 码 $A$ 与概率 $p$ 的单一公式：\n$$p = 10^{-\\frac{(A - 33)}{10}}$$\n\n问题提供了 QUAL 字符串“F?@”，其对应的 ASCII 码为 $A_F = 70$，$A_? = 63$，$A_@ = 64$。我们现在将按顺序对每个字符应用推导出的公式。\n\n对于第一个字符 'F'：\n给定的 ASCII 码是 $A_F = 70$。\n首先，我们计算 Phred 质量分数 $Q_F$：\n$$Q_F = 70 - 33 = 37$$\n接下来，我们计算相应的碱基检出错误概率 $p_F$：\n$$p_F = 10^{-\\frac{37}{10}} = 10^{-3.7}$$\n根据要求，将数值四舍五入到六位有效数字，得到：\n$$p_F \\approx 1.99526 \\times 10^{-4} = 0.000199526$$\n\n对于第二个字符 '?'：\n给定的 ASCII 码是 $A_? = 63$。\nPhred 质量分数 $Q_?$ 是：\n$$Q_? = 63 - 33 = 30$$\n相应的碱基检出错误概率 $p_?$ 是：\n$$p_? = 10^{-\\frac{30}{10}} = 10^{-3}$$\n其数值恰好是 $0.001$。为遵循六位有效数字的要求，我们将其表示为：\n$$p_? = 0.00100000$$\n\n对于第三个字符 '@'：\n给定的 ASCII 码是 $A_@ = 64$。\nPhred 质量分数 $Q_@$ 是：\n$$Q_@ = 64 - 33 = 31$$\n相应的碱基检出错误概率 $p_@$ 是：\n$$p_@ = 10^{-\\frac{31}{10}} = 10^{-3.1}$$\n将数值四舍五入到六位有效数字，得到：\n$$p_@ \\approx 7.94328 \\times 10^{-4} = 0.000794328$$\n\n所要求的三个概率，按照 QUAL 字符串“F?@”中字符的顺序，分别为 $0.000199526$、$0.00100000$ 和 $0.000794328$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.000199526  0.00100000  0.000794328 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在评估了单个碱基的质量之后，理解测序读段（read）是如何以及在哪里比对到参考基因组上则更为关键。本练习  聚焦于比对记录中的两个核心元素：`POS`（位置）字段和 `CIGAR` 字符串。通过解决这个问题，你将学会如何将这种紧凑的表示法转换成精确的基因组坐标，并理解软剪切（soft-clipping）等特征是如何表示的，这对于准确计算覆盖度和识别结构变异等任务是必不可少的。",
            "id": "4314820",
            "problem": "在用于精准肿瘤学的临床全基因组测序流程中，读段比对结果存储在序列比对/图谱 (Sequence Alignment/Map, SAM)、二进制比对/图谱 (Binary Alignment/Map, BAM) 和压缩参考导向比对图谱 (Compressed Reference-oriented Alignment Map, CRAM) 文件中，这些文件都使用位置坐标和 CIGAR 字符串来编码每个读段与参考序列的比对情况。根据规范，SAM/BAM/CRAM 坐标系是 $1$-基准且包含端点的，CIGAR 字符串由操作-长度对组成，其中操作表示读段如何与参考序列比对。基本操作及其是否消耗参考序列坐标有明确定义：$M$、$D$、$N$、_=_ 和 $X$ 消耗参考序列位置；$I$、$S$、$H$ 和 $P$ 不消耗参考序列位置。软剪切 ($S$) 表示存在于读段中但未比对到参考序列上，却保留在记录中的片段；匹配或错配 ($M$) 表示比对到参考序列上，并同时消耗查询序列和参考序列长度的位置。考虑一个来自 CRAM 文件的比对记录，在转换为 SAM 表示后，其 $POS=100$，CIGAR 字符串为 $\\text{8S92M}$。仅使用上述基本定义，确定该读段已比对碱基所覆盖的精确参考序列闭区间以及软剪切碱基的数量。将最终答案表示为一个行矩阵，按顺序包含区间左端点、区间右端点和软剪切计数。无需四舍五入，也无需使用单位。",
            "solution": "该问题要求根据给定的序列比对/图谱 (SAM) 记录确定两个量：读段的比对部分所覆盖的参考基因组区间，以及软剪切碱基的数量。\n\n1.  **软剪切碱基的数量：**\n    给定的 CIGAR 字符串为 $\\text{8S92M}$。CIGAR 字符串是一系列长度-操作对。操作 $S$ 表示“软剪切”，指存在于测序读段中但未比对到参考基因组上的碱基。CIGAR 字符串的第一部分是 $\\text{8S}$，它明确指出在读段的开头有 $8$ 个软剪切碱基。第二部分 $\\text{92M}$ 不涉及软剪切。因此，该比对记录的软剪切碱基总数为 $8$。\n\n2.  **参考基因组区间：**\n    参考区间由读段中比对到参考基因组的部分定义。该区间由 `POS` 字段和消耗参考序列的 CIGAR 操作共同确定。\n\n    a.  **左端点（起始位置）：**\n        SAM 记录中的 `POS` 字段给出了比对在参考序列上的 $1$-基准、包含端点的起始位置。问题说明 $POS = 100$。这是比对的最左侧坐标。因此，参考序列闭区间的左端点是 $100$。\n\n    b.  **右端点（结束位置）：**\n        右端点是通过确定比对在参考基因组上的总长度，并将其加到起始位置来计算的。参考序列上的长度是所有消耗参考碱基的 CIGAR 操作的长度之和。给定的 CIGAR 字符串是 $\\text{8S92M}$。\n        - 操作 $\\text{8S}$（$8$ 个软剪切碱基）不消耗参考序列位置。它对参考序列长度的贡献为 $0$。\n        - 操作 $\\text{92M}$（$92$ 个匹配/错配）消耗参考序列位置。它对参考序列长度的贡献为 $92$。\n\n        比对在参考序列上的总长度 $L_{ref}$ 是所有消耗参考序列的操作的长度之和。\n        $$L_{ref} = 0 (\\text{来自 8S}) + 92 (\\text{来自 92M}) = 92$$\n        坐标系是 $1$-基准且包含端点的。如果一个比对从位置 $P_{start}$ 开始，长度为 $L_{ref}$，那么它覆盖的区间是 $[P_{start}, P_{start} + L_{ref} - 1]$。\n        使用给定值：\n        - $P_{start} = POS = 100$\n        - $L_{ref} = 92$\n        右端点 $P_{end}$ 计算如下：\n        $$P_{end} = P_{start} + L_{ref} - 1 = 100 + 92 - 1 = 191$$\n        因此，已比对碱基所覆盖的参考序列闭区间为 $[100, 191]$。\n\n3.  **最终组合：**\n    问题要求将最终答案表示为一个行矩阵，按顺序包含区间左端点、区间右端点和软剪切计数。\n    - 左端点：$100$\n    - 右端点：$191$\n    - 软剪切计数：$8$\n\n最终得到的行矩阵是 $\\begin{pmatrix} 100  191  8 \\end{pmatrix}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 100  191  8 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在精准医疗的实践中，任何基因组学的结论都不是基于单一条测序读段，而是源于多条读段汇集而成的共同证据。这项高级练习  模拟了变异分析中的核心步骤：解读在特定基因组位点形成的读段“堆叠”（pileup）。通过综合运用从多条读段中提取的 `POS`、`CIGAR` 及 `MD` 标签信息，你将计算两个在变异检测中至关重要的指标——覆盖深度和等位基因频率，从而真正地将原始比对数据转化为具有临床意义的基因组洞见。",
            "id": "4314720",
            "problem": "在精准医疗和基因组诊断中，一项核心任务是从序列比对/图 (SAM)、二进制比对/图 (BAM) 或压缩参考导向比对图 (CRAM) 格式的比对文件中量化碱基水平的覆盖度和等位基因支持。在这些格式中，CIGAR 字符串编码了每条读段（read）如何与参考序列进行比对，其中操作 $M$ 消耗一个参考序列碱基和一个读段碱基（匹配或错配），操作 $I$ 消耗读段碱基但不消耗参考序列碱基，而操作 $D$ 消耗参考序列碱基但不消耗读段碱基。MD 标签指定了相对于参考序列的错配和删除的位置：数字表示连续匹配的长度，字母表示错配位置的参考序列碱基，而一个脱字符号（^）后跟字母表示被删除的参考序列碱基。就某个位点的覆盖深度和等位基因频率而言，一条读段对该参考位置的碱基水平覆盖深度有贡献，当且仅当其 CIGAR 在该位置消耗了参考序列和读段两者（即在该位点是一个 $M$ 操作），而不是一个删除（$D$）。插入（$I$）不消耗参考序列，因此不代表该位点上的一个碱基。\n\n考虑三条比对到染色体 $1$ 的读段，它们都与位点 chr$1$:$101$ 重叠。假设 chr$1$:$101$ 处的参考序列碱基是 $A$。这三个比对是：\n\n- 读段 $R_{1}$：参考序列名称 chr$1$，最左端比对位置 POS $=97$，CIGAR $=5$M，MD 标签 $=4$A$0$。在 chr$1$:$101$ 处观测到的读段碱基（来自 SEQ 字段）是 $G$。\n- 读段 $R_{2}$：参考序列名称 chr$1$，最左端比对位置 POS $=99$，CIGAR $=2$M$1$I$2$M，MD 标签 $=2$A$1$。在 chr$1$:$101$ 处观测到的读段碱基是 $G$。\n- 读段 $R_{3}$：参考序列名称 chr$1$，最左端比对位置 POS $=98$，CIGAR $=3$M$1$D$1$M，MD 标签 $=3$^A$1$。\n\n假设所有三条读段都通过了比对质量和碱基质量过滤，没有软剪切或硬剪切，并且重复标记不适用。将 chr$1$:$101$ 处的碱基水平覆盖深度 $D$ 定义为在该位置贡献了一个比对上的读段碱基的读段数量（即，排除任何在该位置有删除的读段）。将相对于参考碱基 $A$ 的 chr$1$:$101$ 处的变异等位基因频率 $\\mathrm{AF}$ 定义为比率\n$$\n\\mathrm{AF}=\\frac{\\text{在 chr }1:101 \\text{ 处带有非参考碱基的读段数}}{\\text{在 chr }1:101 \\text{ 处贡献了碱基的读段数}}。\n$$\n使用上述 CIGAR 和 MD 语义来确定，对于每条读段，它是否在 chr$1$:$101$ 处贡献了一个碱基，如果是，该碱基是等于参考等位基因还是变异等位基因。提供 $D$ 和 $\\mathrm{AF}$ 的精确值，不进行四舍五入。以 $D, \\mathrm{AF}$ 的顺序将你的最终答案报告为两个实数。",
            "solution": "问题要求计算基因组位点 chr$1$:$101$ 的碱基水平覆盖深度 ($D$) 和变异等位基因频率 ($\\mathrm{AF}$)。该位置的参考碱基是 $A$。为了解决这个问题，我们必须分析三条读段（$R_1$, $R_2$, $R_3$）中每一条相对于该位点的比对情况。关键是正确解释每条读段的 CIGAR 字符串，以确定它覆盖了哪些参考序列位置以及使用了哪种操作类型（`M`、`I` 或 `D`）。\n\n根据问题陈述，一条读段对一个位点的覆盖深度有贡献，当且仅当其 CIGAR 字符串在该参考位置上有一个 `M` 操作（匹配/错配）。在该位点有 `D` 操作（删除）的读段对覆盖深度没有贡献。有 `I` 操作（插入）的读段不消耗参考基因组，因此其影响在于读段本身以及随后的 CIGAR 操作，但插入操作本身并不与所讨论的位点比对。\n\n让我们逐一分析每条读段。参考序列是基于 $1$ 的索引。\n\n**读段 $R_1$ 分析：**\n- 最左端比对位置 (POS)：$97$。\n- CIGAR 字符串：$5$M。\n- 这个 CIGAR 字符串表示读段的前 $5$ 个碱基与从位置 $97$ 开始的参考序列的前 $5$ 个碱基比对。因此，比对覆盖了参考序列位置 $97, 98, 99, 100, 101$。\n- 在参考序列位置 $101$ 的具体操作是 `M`。根据所给定义，这条读段对 chr$1$:$101$ 的覆盖深度有贡献。\n- 问题陈述中指出，在 chr$1$:$101$ 处观测到的读段碱基是 $G$。参考碱基是 $A$。由于 $G \\neq A$，这条读段支持一个变异等位基因。MD 标签 $4$A$0$ 证实了这一点：$4$ 个匹配，随后是一个错配，其中参考碱基是 `A`（在位置 $97+4 = 101$），这与情况一致。\n\n**读段 $R_2$ 分析：**\n- 最左端比对位置 (POS)：$99$。\n- CIGAR 字符串：$2$M$1$I$2$M。\n- 我们沿着参考序列追踪比对过程：\n  - `2M` 操作将读段的前 $2$ 个碱基与参考序列位置 $99$ 和 $100$ 比对。\n  - `1I` 操作表示读段中有 $1$ 个碱基的插入。此操作消耗读段中的一个碱基，但不会在参考序列上前进。参考序列位置仍停留在位置 $100$ 的末端。\n  - 随后的 `2M` 操作将接下来的 $2$ 个读段碱基与参考序列位置 $101$ 和 $102$ 比对。\n- 在参考序列位置 $101$ 的具体操作是 `M`。因此，这条读段对 chr$1$:$101$ 的覆盖深度有贡献。\n- 问题陈述中指出，在 chr$1$:$101$ 处观测到的读段碱基是 $G$。由于参考碱基是 $A$，这条读段也支持一个变异等位基因。MD 标签 $2$A$1$ 与此一致：$2$ 个匹配（位置 $99, 100$），随后是一个错配，其中参考碱基是 `A`（在位置 $101$），然后是 $1$ 个匹配（位置 $102$）。\n\n**读段 $R_3$ 分析：**\n- 最左端比对位置 (POS)：$98$。\n- CIGAR 字符串：$3$M$1$D$1$M。\n- 我们沿着参考序列追踪比对过程：\n  - `3M` 操作将读段的前 $3$ 个碱基与参考序列位置 $98, 99, 100$ 比对。\n  - `1D` 操作表示从参考序列中删除 $1$ 个碱基。此操作消耗了位置 $101$ 处的参考碱基，但不消耗读段中的碱基。\n  - 随后的 `1M` 操作将下一个读段碱基与参考序列位置 $102$ 比对。\n- 在参考序列位置 $101$ 的具体操作是 `D`。根据问题的定义，在某个位点有删除的读段对碱基水平的覆盖深度没有贡献。\n- 因此，读段 $R_3$ 对 chr$1$:$101$ 的覆盖深度没有贡献。MD 标签 $3$^A$1$ 与此一致：$3$ 个匹配，随后是参考碱基 `A` 的删除（在位置 $98+3=101$），然后是 $1$ 个匹配。\n\n**覆盖深度 ($D$) 计算：**\n覆盖深度 $D$ 是在 chr$1$:$101$ 处贡献了碱基的读段数量。\n- $R_1$ 有贡献。\n- $R_2$ 有贡献。\n- $R_3$ 没有贡献。\n所以，有贡献的读段总数为 $2$。\n$$ D = 2 $$\n\n**变异等位基因频率 ($\\mathrm{AF}$) 计算：**\n$\\mathrm{AF}$ 的公式为：\n$$ \\mathrm{AF}=\\frac{\\text{在 chr }1:101 \\text{ 处带有非参考碱基的读段数}}{\\text{在 chr }1:101 \\text{ 处贡献了碱基的读段数}} $$\n- 分母是覆盖深度 $D$，我们已计算出其值为 $2$。\n- 分子是在有贡献的读段集合（读段 $R_1$ 和 $R_2$）中具有非参考碱基的读段数量。\n  - 读段 $R_1$ 在此位置的碱基是 $G$。$G \\neq A$ (参考碱基)。这是一个非参考碱基。\n  - 读段 $R_2$ 在此位置的碱基是 $G$。$G \\neq A$ (参考碱基)。这也是一个非参考碱基。\n- 带有非参考碱基的读段数量为 $2$。\n因此，变异等位基因频率为：\n$$ \\mathrm{AF} = \\frac{2}{2} = 1 $$\n\n最终值为 $D=2$ 和 $\\mathrm{AF}=1$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 2  1 \\end{pmatrix}}$$"
        }
    ]
}