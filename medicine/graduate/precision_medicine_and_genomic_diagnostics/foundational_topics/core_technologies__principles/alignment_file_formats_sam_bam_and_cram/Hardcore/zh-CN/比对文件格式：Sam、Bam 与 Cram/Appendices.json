{
    "hands_on_practices": [
        {
            "introduction": "在精确医学中，识别出的变异是否可靠，直接取决于测序数据的质量。SAM/BAM 文件中的 QUAL 字段以字符形式紧凑地编码了每个碱基的质量分数。本练习  将指导你如何将这些字符解码为定量的碱基检出错误概率，这是进行变异识别和数据质量控制的一项基本技能。",
            "id": "4314709",
            "problem": "一个用于精准肿瘤学中靶向测序的临床基因组学流程，将读段比对结果以序列比对/图 (SAM) 文本格式存储，后续以二进制比对/图 (BAM) 和压缩参考导向比对图 (CRAM) 格式进行归档。为了校准变异检出的置信度，一位生物信息学家检查了一个跨越临床相关单核苷酸变异的读段的 SAM QUAL 字段，并找到了以该变异位点为中心的三个连续碱基的三字符质量字符串“F?@”。在 SAM 规范中，碱基质量字符使用 Phred-plus-33（“Phred+33”）进行编码，即从字符的美国信息交换标准代码 (ASCII) 码中减去 $33$ 来获得数值化的 Phred 质量分数 $Q$。字符“F”、“?”和“@”的 ASCII 码分别为 $70$、$63$ 和 $64$。Phred 质量分数 $Q$ 由碱基检出错误概率 $p$ 通过公式 $Q=-10\\log_{10}(p)$ 从第一性原理定义，其中 $\\log_{10}(\\cdot)$ 表示以 10 为底的对数。仅从这些定义出发，将 QUAL 字符串“F?@”转换为相应的 Phred 分数，并计算这三个碱基各自的碱基检出错误概率 $p$。请按 QUAL 字符串中字符的相同顺序，以保留六位有效数字的十进制数形式提供这三个概率。不要使用百分号表示结果；概率必须是无单位的纯十进制数。",
            "solution": "该问题要求将 SAM 文件中的碱基质量字符串转换为相应的碱基检出错误概率。此过程涉及根据所提供的定义进行的两个连续转换：首先，从 ASCII 字符转换为数值化的 Phred 质量分数（表示为 $Q$）；其次，从 Phred 分数转换为错误概率（表示为 $p$）。\n\n问题陈述了以下定义：\n1. 从 ASCII 字符到 Phred 分数 $Q$ 的转换使用 Phred$+33$ 编码方案，该方案由以下关系定义：\n$$Q = A - 33$$\n其中 $A$ 代表字符的数值 ASCII 码。\n\n2. Phred 质量分数 $Q$ 根据碱基检出错误概率 $p$ 从第一性原理通过以下方程定义：\n$$Q = -10\\log_{10}(p)$$\n\n要确定给定质量字符的概率 $p$，我们必须首先将 $p$ 表示为 $Q$ 的函数。我们可以通过代数运算重新排列第二个方程。两边同除以 $-10$ 得：\n$$-\\frac{Q}{10} = \\log_{10}(p)$$\n根据以 10 为底的对数的定义，如果 $y = \\log_{10}(x)$，那么 $x = 10^y$。将此应用于我们的方程，得到 $p$ 的表达式：\n$$p = 10^{-\\frac{Q}{10}}$$\n现在我们可以将第一个方程代入此结果，以获得一个直接关联 ASCII 码 $A$ 与概率 $p$ 的单一公式：\n$$p = 10^{-\\frac{(A - 33)}{10}}$$\n\n问题提供了 QUAL 字符串“F?@”，其对应的 ASCII 码为 $A_F = 70$、$A_? = 63$ 和 $A_@ = 64$。我们现在将按顺序对每个字符应用推导出的公式。\n\n对于第一个字符 'F'：\n给定的 ASCII 码为 $A_F = 70$。\n首先，我们计算 Phred 质量分数 $Q_F$：\n$$Q_F = 70 - 33 = 37$$\n接下来，我们计算相应的碱基检出错误概率 $p_F$：\n$$p_F = 10^{-\\frac{37}{10}} = 10^{-3.7}$$\n根据要求，数值四舍五入到六位有效数字为：\n$$p_F \\approx 1.99526 \\times 10^{-4} = 0.000199526$$\n\n对于第二个字符 '?'：\n给定的 ASCII 码为 $A_? = 63$。\nPhred 质量分数 $Q_?$ 为：\n$$Q_? = 63 - 33 = 30$$\n相应的碱基检出错误概率 $p_?$ 为：\n$$p_? = 10^{-\\frac{30}{10}} = 10^{-3}$$\n其数值恰好为 $0.001$。为遵循保留六位有效数字的要求，我们将其表示为：\n$$p_? = 0.00100000$$\n\n对于第三个字符 '@'：\n给定的 ASCII 码为 $A_@ = 64$。\nPhred 质量分数 $Q_@$ 为：\n$$Q_@ = 64 - 33 = 31$$\n相应的碱基检出错误概率 $p_@$ 为：\n$$p_@ = 10^{-\\frac{31}{10}} = 10^{-3.1}$$\n数值四舍五入到六位有效数字为：\n$$p_@ \\approx 7.94328 \\times 10^{-4} = 0.000794328$$\n\n按 QUAL 字符串“F?@”中字符的相同顺序，所要求的三个概率为 $0.000199526$、$0.00100000$ 和 $0.000794328$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.000199526  0.00100000  0.000794328 \\end{pmatrix}}$$"
        },
        {
            "introduction": "除了序列本身，读取片段（read）在参考基因组上的比对位置和结构也至关重要。本练习  专注于解读 CIGAR 字符串和 POS 字段，这两个是 SAM/BAM 格式中的核心元素。通过这项实践，你将学会如何精确地确定一个读取片段所覆盖的基因组区间，这是计算覆盖深度和识别结构变异等下游分析的关键一步。",
            "id": "4314820",
            "problem": "在一个用于精准肿瘤学的临床全基因组测序流程中，测序片段（read）的比对结果存储在序列比对/图谱（SAM）、二进制比对/图谱（BAM）和压缩参考导向比对图谱（CRAM）文件中。这些文件都使用位置坐标和CIGAR（简明个性化缺口比对报告）字符串来编码每个测序片段与参考序列的比对情况。根据规范，SAM/BAM/CRAM的坐标系统是基于$1$的且包含端点，CIGAR字符串由“操作-长度”对组成，其中操作符表示测序片段如何与参考序列比对。基本操作及其是否消耗参考序列坐标有明确定义：$M$、$D$、$N$、_=_ 和 $X$ 消耗参考序列位置；$I$、$S$、$H$ 和 $P$ 不消耗参考序列位置。软剪切（$S$）表示存在于测序片段中但未比对到参考序列上，却仍保留在记录中的片段；匹配或错配（$M$）表示比对到参考序列上的位置，并同时消耗查询序列（query）和参考序列的长度。考虑一个来自CRAM文件的比对记录，在转换为SAM表示格式后，其$POS=100$，CIGAR字符串为$\\text{8S92M}$。仅使用上述基本定义，确定该测序片段的比对碱基所覆盖的精确闭合参考区间以及软剪切碱基的数量。将最终答案表示为一个行矩阵，按顺序包含区间的左端点、右端点和软剪切计数。无需四舍五入，也无需使用单位。",
            "solution": "该问题要求根据给定的序列比对/图谱（SAM）记录确定两个量：测序片段比对部分所覆盖的参考基因组区间，以及软剪切碱基的数量。\n\n1.  **软剪切碱基的数量：**\n    给定的CIGAR字符串为$\\text{8S92M}$。CIGAR字符串是一系列长度-操作对。操作$S$表示‘软剪切’，指存在于测序片段中但未比对到参考基因组上的碱基。CIGAR字符串的第一部分是$\\text{8S}$，明确说明在测序片段的开头有$8$个软剪切碱基。第二部分$\\text{92M}$不涉及软剪切。因此，该比对记录的软剪切碱基总数为$8$。\n\n2.  **参考基因组区间：**\n    参考区间由测序片段中比对到参考基因组的部分定义。该区间由`POS`字段和消耗参考序列的CIGAR操作确定。\n\n    a.  **左端点（起始位置）：**\n        SAM记录中的`POS`字段给出了比对在参考序列上基于$1$的、包含端点的起始位置。问题说明$POS = 100$。这是比对的最左侧坐标。因此，闭合参考区间的左端点是$100$。\n\n    b.  **右端点（结束位置）：**\n        右端点是通过确定比对在参考基因组上的总长度，并将其加到起始位置上计算得出的。参考序列上的长度是所有消耗参考碱基的CIGAR操作的长度之和。给定的CIGAR字符串是$\\text{8S92M}$。\n        - 操作$\\text{8S}$（$8$个软剪切碱基）不消耗参考序列位置。其对参考序列长度的贡献为$0$。\n        - 操作$\\text{92M}$（$92$个匹配/错配）消耗参考序列位置。其对参考序列长度的贡献为$92$。\n\n        比对在参考序列上的总长度 $L_{ref}$ 是所有消耗参考序列的操作的长度之和。\n        $$L_{ref} = 0 (\\text{from 8S}) + 92 (\\text{from 92M}) = 92$$\n        坐标系统是基于$1$的且包含端点。如果一个比对从位置$P_{start}$开始，长度为$L_{ref}$，那么它覆盖的区间是$[P_{start}, P_{start} + L_{ref} - 1]$。\n        使用给定值：\n        - $P_{start} = POS = 100$\n        - $L_{ref} = 92$\n        右端点$P_{end}$的计算如下：\n        $$P_{end} = P_{start} + L_{ref} - 1 = 100 + 92 - 1 = 191$$\n        因此，比对碱基所覆盖的闭合参考区间是$[100, 191]$。\n\n3.  **最终组合：**\n    问题要求将最终答案表示为一个行矩阵，按顺序包含区间的左端点、右端点和软剪切计数。\n    - 左端点：$100$\n    - 右端点：$191$\n    - 软剪切计数：$8$\n\n最终得到的行矩阵为$\\begin{pmatrix} 100  191  8 \\end{pmatrix}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 100  191  8 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在临床基因组学分析中，我们通常需要整合来自多条读取片段的信息来得出可靠的结论。本练习  模拟了一个真实的生物信息学场景，它要求你综合利用来自多个重叠读取片段的比对信息，包括 CIGAR 字符串和 MD 标签。通过这项综合实践，你将计算变异位点的覆盖深度和等位基因频率，这是进行可靠变异检出的两个核心指标。",
            "id": "4314720",
            "problem": "精准医疗和基因组诊断中的一个核心任务是，从序列比对/图谱 (SAM)、二进制比对/图谱 (BAM) 或压缩参考导向比对图谱 (CRAM) 格式的比对文件中，量化碱基水平的覆盖度和等位基因支持度。在这些格式中，紧凑特异性缺口比对报告 (Compact Idiosyncratic Gapped Alignment Report, CIGAR) 字符串编码了每个读段如何与参考序列进行比对，其中操作 $M$ 消耗一个参考序列碱基和一个读段碱基（匹配或错配），操作 $I$ 消耗读段碱基但不消耗参考序列碱基，而操作 $D$ 消耗参考序列碱基但不消耗读段碱基。MD 标签指定了相对于参考序列的错配和删除的位置：数字表示连续匹配的长度，字母表示错配位置上的参考序列碱基，而插入符号后跟字母表示被删除的参考序列碱基。为了计算某个位点的深度和等位基因频率，一个读段当且仅当其在该位置的 CIGAR 操作同时消耗参考序列和读段（即在该位点是一个 $M$ 操作），而不是删除（$D$），才对该参考位置的碱基水平深度有贡献。插入（$I$）不消耗参考序列，因此不代表该位点上的一个碱基。\n\n考虑三个比对到染色体 $1$ 的读段，每个都与位点 chr$1$:$101$ 重叠。假设 chr$1$:$101$ 处的参考碱基是 $A$。这三个比对如下：\n\n- 读段 $R_{1}$：参考序列名称 chr$1$，最左比对位置 POS $=97$，CIGAR $=5$M，MD 标签 $=4$A$0$。在 chr$1$:$101$ 处观察到的读段碱基（来自 SEQ 字段）是 $G$。\n- 读段 $R_{2}$：参考序列名称 chr$1$，最左比对位置 POS $=99$，CIGAR $=2$M$1$I$2$M，MD 标签 $=2$A$1$。在 chr$1$:$101$ 处观察到的读段碱基是 $G$。\n- 读段 $R_{3}$：参考序列名称 chr$1$，最左比对位置 POS $=98$，CIGAR $=3$M$1$D$1$M，MD 标签 $=3$^A$1$。\n\n假设所有三个读段都通过了比对质量和碱基质量过滤，没有软剪切或硬剪切，且重复标记不适用。将在 chr$1$:$101$ 处的碱基水平深度 $D$ 定义为在该位置贡献了一个比对读段碱基的读段数量（即，排除任何在该位置有删除的读段）。将在 chr$1$:$101$ 处相对于参考碱基 $A$ 的替代等位基因频率 $\\mathrm{AF}$ 定义为以下比率：\n$$\n\\mathrm{AF}=\\frac{\\text{在 chr }1:101 \\text{ 处含有非参考碱基的读段数量}}{\\text{在 chr }1:101 \\text{ 处贡献了碱基的读段数量}}。\n$$\n使用上述 CIGAR 和 MD 的语义，确定每个读段是否在 chr$1$:$101$ 处贡献了一个碱基，如果是，该碱基是等于参考碱基还是一个替代等位基因。提供 $D$ 和 $\\mathrm{AF}$ 的精确值，无需四舍五入。以 $D, \\mathrm{AF}$ 的顺序将你的最终答案报告为两个实数。",
            "solution": "该问题要求计算基因组位点 chr$1$:$101$ 处的碱基水平深度 ($D$) 和替代等位基因频率 ($\\mathrm{AF}$)。该位置的参考碱基为 $A$。为解决此问题，我们必须分析三个读段（$R_1$、$R_2$、$R_3$）中每一个相对于该位点的比对情况。关键是正确解释每个读段的 CIGAR 字符串，以确定它覆盖了哪些参考位置以及使用了哪种操作类型（`M`、`I` 或 `D`）。\n\n根据问题陈述，一个读段当且仅当其 CIGAR 字符串中有一个跨越该参考位置的 `M` 操作（匹配/错配）时，才对该位点的深度有贡献。在位点处有 `D` 操作（删除）的读段对深度没有贡献。有 `I` 操作（插入）的读段不消耗参考基因组，因此其影响在于读段本身以及随后的 CIGAR 操作，但该插入并不与所讨论的位点对齐。\n\n让我们逐个分析每个读段。参考序列是基于 $1$ 的。\n\n**读段 $R_1$ 分析：**\n- 最左比对位置 (POS)：$97$。\n- CIGAR 字符串：$5$M。\n- 这个 CIGAR 字符串表示读段的前 $5$ 个碱基与从位置 $97$ 开始的参考序列的前 $5$ 个碱基对齐。因此，比对覆盖了参考位置 $97, 98, 99, 100, 101$。\n- 在参考位置 $101$ 处的具体操作是 `M`。根据所提供的定义，该读段对 chr$1$:$101$ 的深度有贡献。\n- 问题陈述中提到，在 chr$1$:$101$ 处观察到的读段碱基是 $G$。参考碱基是 $A$。由于 $G \\neq A$，该读段支持一个替代等位基因。MD 标签 $4$A$0$ 证实了这一点：$4$ 个匹配，随后是一个错配，其中参考碱基是 `A`（在位置 $97+4 = 101$），这与观察一致。\n\n**读段 $R_2$ 分析：**\n- 最左比对位置 (POS)：$99$。\n- CIGAR 字符串：$2$M$1$I$2$M。\n- 我们沿着参考序列追踪比对：\n  - `2M` 操作将读段的前 $2$ 个碱基与参考位置 $99$ 和 $100$ 对齐。\n  - `1I` 操作表示在读段中有 $1$ 个碱基的插入。此操作消耗读段的一个碱基，但不会在参考序列上前进。参考位置保持在位置 $100$ 的末端。\n  - 随后的 `2M` 操作将接下来的 $2$ 个读段碱基与参考位置 $101$ 和 $102$ 对齐。\n- 在参考位置 $101$ 处的具体操作是 `M`。因此，该读段对 chr$1$:$101$ 的深度有贡献。\n- 问题陈述中提到，在 chr$1$:$101$ 处观察到的读段碱基是 $G$。由于参考碱基是 $A$，该读段也支持一个替代等位基因。MD 标签 $2$A$1$ 与此一致：$2$ 个匹配（位置 $99, 100$），随后是一个错配，其中参考碱基是 `A`（在位置 $101$），再接着是 $1$ 个匹配（位置 $102$）。\n\n**读段 $R_3$ 分析：**\n- 最左比对位置 (POS)：$98$。\n- CIGAR 字符串：$3$M$1$D$1$M。\n- 我们沿着参考序列追踪比对：\n  - `3M` 操作将读段的前 $3$ 个碱基与参考位置 $98, 99, 100$ 对齐。\n  - `1D` 操作表示从参考序列中删除了 $1$ 个碱基。此操作消耗了位置 $101$ 处的参考碱基，但不消耗读段中的碱基。\n  - `1M` 操作将下一个读段碱基与参考位置 $102$ 对齐。\n- 在参考位置 $101$ 处的具体操作是 `D`。根据问题的定义，在某位点有删除的读段对碱基水平深度没有贡献。\n- 因此，读段 $R_3$ 对 chr$1$:$101$ 的深度没有贡献。MD 标签 $3$^A$1$ 与此一致：$3$ 个匹配，随后是参考碱基 `A` 的删除（在位置 $98+3=101$），再接着是 $1$ 个匹配。\n\n**深度 ($D$) 的计算：**\n深度 $D$ 是在 chr$1$:$101$ 处贡献了碱基的读段数量。\n- $R_1$ 有贡献。\n- $R_2$ 有贡献。\n- $R_3$ 没有贡献。\n所以，有贡献的读段总数为 $2$。\n$$ D = 2 $$\n\n**替代等位基因频率 ($\\mathrm{AF}$) 的计算：**\n$\\mathrm{AF}$ 的计算公式如下：\n$$\n\\mathrm{AF}=\\frac{\\text{在 chr }1:101 \\text{ 处含有非参考碱基的读段数量}}{\\text{在 chr }1:101 \\text{ 处贡献了碱基的读段数量}}\n$$\n- 分母是深度 $D$，我们计算出其值为 $2$。\n- 分子是有贡献的读段集合（读段 $R_1$ 和 $R_2$）中含有非参考碱基的读段数量。\n  - 读段 $R_1$ 在此位置的碱基是 $G$。$G \\neq A$ (参考)。这是一个非参考碱基。\n  - 读段 $R_2$ 在此位置的碱基是 $G$。$G \\neq A$ (参考)。这也是一个非参考碱基。\n- 含有非参考碱基的读段数量为 $2$。\n因此，替代等位基因频率为：\n$$ \\mathrm{AF} = \\frac{2}{2} = 1 $$\n\n最终值为 $D=2$ 和 $\\mathrm{AF}=1$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 2  1 \\end{pmatrix}}$$"
        }
    ]
}