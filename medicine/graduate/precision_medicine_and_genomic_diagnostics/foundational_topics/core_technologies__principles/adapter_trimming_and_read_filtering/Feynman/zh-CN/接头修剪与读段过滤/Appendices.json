{
    "hands_on_practices": [
        {
            "introduction": "在接头序列剪切中，首要的挑战是在随机序列中准确地检测出真正的接头。这个过程需要在灵敏度与特异性之间做出权衡。本练习  将指导你通过量化分析，确定一个最佳的最小重叠长度 $m$，既能有效识别因测序错误而不完美的接头序列，又能避免因偶然的序列相似性而导致的假阳性剪切。",
            "id": "4313948",
            "problem": "一个用于精准肿瘤学的临床下一代测序 (NGS) 流程使用接头修剪 (adapter trimming) 来在变异检测 (variant calling) 之前从患者来源的读段 (reads) 中去除合成接头的污染。当一个读段的某个窗口与接头的前缀之间存在长度至少为 $m$ 的完全连续匹配时，修剪工具会宣告存在接头；一旦检测到，该读段将从该匹配的起始位置被修剪。最小重叠长度 $m$ 是宣告存在接头所需的最短连续完全匹配。在本问题中，你将形式化这个概念，并在基因组背景和测序错误的概率模型下选择 $m$ 以平衡假阳性控制和灵敏度。\n\n假设如下：\n- 读段长度为 $R = 151$ 个核苷酸，工具扫描读段中所有长度为 $m$ 的可能窗口，因此每个读段的窗口数为 $n_{w} = R - m + 1$。\n- 人类基因组背景被建模为独立同分布 (i.i.d.) 的碱基，其频率为 $f_{A} = 0.3$，$f_{C} = 0.2$，$f_{G} = 0.2$，以及 $f_{T} = 0.3$。\n- 接头前缀是固定的，以序列 $\\mathrm{AGATCGGAAGAGC}$ 开始；其组成为 $p_{A} = \\frac{5}{13}$，$p_{C} = \\frac{2}{13}$，$p_{G} = \\frac{5}{13}$，以及 $p_{T} = \\frac{1}{13}$。假设接头前缀每个位置的碱基组成是平稳的，因此与接头碱基完全匹配的单位碱基概率在所有位置上是恒定的，等于 $q = f_{A} p_{A} + f_{C} p_{C} + f_{G} p_{G} + f_{T} p_{T}$。\n- 测序错误在碱基之间是独立的，单位碱基错误概率为 $\\varepsilon = 0.005$；检测需要长度为 $m$ 的完全匹配，因此一个长度为 $m$ 的真实接头重叠被检测到的概率为 $(1 - \\varepsilon)^{m}$。\n\n施加了两个设计约束：\n1. 假阳性控制：在 $N = 10^{6}$ 个已知不含接头的读段中，由于与接头的随机完全匹配而被错误修剪的读段的期望数不得超过 $F_{\\max} = 0.1$。\n2. 灵敏度：对于确实包含长度至少为 $m$ 的接头重叠的读段，检测概率必须至少为 $S_{\\min} = 0.9$。\n\n从上述模型假设出发，并且不使用任何预先推导的快捷公式，推导量化预期假阳性和灵敏度作为 $m$ 的函数所需的表达式，并确定同时满足这两个约束的最小整数 $m$。将你的最终答案表示为单个整数 $m$。由于 $m$ 是一个没有单位的整数，因此不需要舍入说明。",
            "solution": "该问题要求找到最小重叠长度 $m$ 的最小整数值，该值在一个 NGS 接头修剪场景中同时满足两个约束：一个关于灵敏度，另一个关于假阳性率。我们将根据所提供的概率模型对每个约束进行形式化，推导控制 $m$ 的不等式，并求解满足两个约束的 $m$ 的最小整数值。\n\n给定的参数是：\n- 读段长度: $R = 151$\n- 不含接头的读段数: $N = 10^6$\n- 最大预期假阳性读段数: $F_{\\max} = 0.1$\n- 最小灵敏度: $S_{\\min} = 0.9$\n- 单位碱基测序错误率: $\\varepsilon = 0.005$\n- 基因组碱基频率: $f_{A} = 0.3$, $f_{C} = 0.2$, $f_{G} = 0.2$, $f_{T} = 0.3$\n- 接头前缀碱基频率: $p_{A} = \\frac{5}{13}$, $p_{C} = \\frac{2}{13}$, $p_{G} = \\frac{5}{13}$, $p_{T} = \\frac{1}{13}$\n\n首先，我们分析关于灵敏度的约束。\n约束2：灵敏度\n灵敏度是检测到长度至少为 $m$ 的真实接头重叠的概率。问题陈述检测需要长度为 $m$ 的完全匹配。如果存在一个长度为 $m$ 的真实重叠，只有在该 $m$ 个碱基的区域内没有测序错误时才会被检测到。单个碱基没有错误的概率是 $1 - \\varepsilon$。由于错误在碱基之间是独立的，因此在长度为 $m$ 的序列中没有错误的概率是 $(1 - \\varepsilon)^m$。\n因此，灵敏度 $S(m)$ 由下式给出：\n$$S(m) = (1 - \\varepsilon)^m$$\n约束要求这个概率至少为 $S_{\\min} = 0.9$。\n$$(1 - \\varepsilon)^m \\ge S_{\\min}$$\n代入值 $\\varepsilon = 0.005$ 和 $S_{\\min} = 0.9$：\n$$(1 - 0.005)^m \\ge 0.9$$\n$$(0.995)^m \\ge 0.9$$\n为了求解 $m$，我们对两边取自然对数。由于 $\\ln(0.995)$ 是负数，因此在除以它时必须反转不等号。\n$$m \\ln(0.995) \\ge \\ln(0.9)$$\n$$m \\le \\frac{\\ln(0.9)}{\\ln(0.995)}$$\n使用数值，$\\ln(0.9) \\approx -0.10536$ 并且 $\\ln(0.995) \\approx -0.0050125$。\n$$m \\le \\frac{-0.10536}{-0.0050125} \\approx 21.019$$\n由于 $m$ 必须是整数，灵敏度约束对 $m$ 施加了一个上限：\n$$m \\le 21$$\n\n接下来，我们分析关于假阳性的约束。\n约束1：假阳性控制\n当一个不含接头的读段因为与接头前缀发生偶然匹配而被修剪时，就会出现假阳性。这需要一个来自基因组的长度为 $m$ 的随机序列与一个来自接头前缀的长度为 $m$ 的序列完全匹配。\n\n首先，我们计算单个随机基因组碱基与接头前缀单个碱基匹配的概率 $q$。问题陈述将接头前缀建模为具有由 $\\{p_A, p_C, p_G, p_T\\}$ 给出的平稳碱基组成，并将基因组背景建模为具有频率 $\\{f_A, f_C, f_G, f_T\\}$ 的独立同分布。在任何给定位置上匹配的概率是匹配每种碱基类型的概率之和：\n$$q = P(\\text{基因组碱基} = \\text{接头碱基})$$\n$$q = P(\\text{匹配}|\\text{接头碱基是A})P(\\text{接头碱基是A}) + \\dots + P(\\text{匹配}|\\text{接头碱基是T})P(\\text{接头碱基是T})$$\n$$q = f_A p_A + f_C p_C + f_G p_G + f_T p_T$$\n代入给定的频率：\n$$q = (0.3)\\left(\\frac{5}{13}\\right) + (0.2)\\left(\\frac{2}{13}\\right) + (0.2)\\left(\\frac{5}{13}\\right) + (0.3)\\left(\\frac{1}{13}\\right)$$\n$$q = \\frac{1}{13} (1.5 + 0.4 + 1.0 + 0.3) = \\frac{3.2}{13}$$\n由于基因组碱基是独立同分布的，一个随机的 $m$ 碱基窗口与接头前缀匹配的概率是 $q^m$。\n\n如果 $n_w = R - m + 1$ 个可能窗口中至少有一个与接头前缀匹配，则一个读段被错误地修剪。设 $A_j$ 为窗口 $j$ 中发生匹配的事件，其中 $j=1, \\dots, n_w$。一个读段被错误修剪的概率是 $P(\\cup_{j=1}^{n_w} A_j)$。\n在 $N$ 个不含接头的读段中，被错误修剪的读段的期望数 $E_{FP}$ 是 $N \\cdot P(\\cup_{j=1}^{n_w} A_j)$。约束是 $E_{FP} \\le F_{\\max}$。\n$$N \\cdot P\\left(\\bigcup_{j=1}^{n_w} A_j\\right) \\le F_{\\max}$$\n由于窗口重叠，事件 $A_j$ 不是独立的。然而，我们可以使用布尔不等式（并集上限）来建立一个充分条件：$P(\\cup_{j=1}^{n_w} A_j) \\le \\sum_{j=1}^{n_w} P(A_j)$。\n在任何单个窗口中发生匹配的概率是 $P(A_j) = q^m$。\n总和是 $\\sum_{j=1}^{n_w} P(A_j) = n_w q^m = (R-m+1)q^m$。\n因此，满足该约束的一个充分条件是：\n$$N (R-m+1) q^m \\le F_{\\max}$$\n代入给定值：$N=10^6$，$R=151$，$F_{\\max}=0.1$，以及 $q = 3.2/13$：\n$$10^6 (151 - m + 1) \\left(\\frac{3.2}{13}\\right)^m \\le 0.1$$\n$$10^6 (152 - m) \\left(\\frac{3.2}{13}\\right)^m \\le 0.1$$\n$$(152 - m) \\left(\\frac{3.2}{13}\\right)^m \\le 10^{-7}$$\n我们需要找到满足这个不等式的最小整数 $m$。对于我们感兴趣的值，不等式左侧（我们称之为 $f(m)$）是 $m$ 的一个快速递减函数。我们可以通过测试整数值来找到最小的 $m$。\n让我们为几个整数 $m$ 计算 $f(m)$ 的值：\n对于 $m=15$：\n$$f(15) = (152 - 15) \\left(\\frac{3.2}{13}\\right)^{15} = 137 \\left(\\frac{3.2}{13}\\right)^{15} \\approx 137 \\times 1.0116 \\times 10^{-9} \\approx 1.386 \\times 10^{-7}$$\n由于 $1.386 \\times 10^{-7} > 10^{-7}$，$m=15$ 不满足约束。\n\n对于 $m=16$：\n$$f(16) = (152 - 16) \\left(\\frac{3.2}{13}\\right)^{16} = 136 \\left(\\frac{3.2}{13}\\right)^{16} \\approx 136 \\times 2.490 \\times 10^{-10} \\approx 3.386 \\times 10^{-8}$$\n由于 $3.386 \\times 10^{-8} \\le 10^{-7}$，$m=16$ 满足约束。\n因此，假阳性约束对 $m$ 施加了一个下限：\n$$m \\ge 16$$\n\n最后，我们结合两个约束来找到最小整数 $m$。\n灵敏度约束要求 $m \\le 21$。\n假阳性控制约束要求 $m \\ge 16$。\n要同时满足两个约束，$m$ 必须在整数范围 $[16, 21]$ 内。$m$ 的有效整数值集合是 $\\{16, 17, 18, 19, 20, 21\\}$。\n问题要求满足两个约束的最小整数 $m$。这对应于有效集合中的最小值。\n因此，$m$ 的最小整数值为 $16$。",
            "answer": "$$\n\\boxed{16}\n$$"
        },
        {
            "introduction": "除了测序接头，NGS数据中还可能包含其他类型的非目标序列，例如PCR扩增过程中产生的引物二聚体。本练习  聚焦于扩增子测序中一个常见的质控步骤。你将学习如何设计一个综合性的过滤规则，它结合了序列匹配（用于识别引物）和读长阈值（因为二聚体通常很短），以高效地从数据集中剔除这些会干扰下游分析的噪音读段。",
            "id": "4313892",
            "problem": "在一项用于肿瘤学中微小残留病检测的、基于扩增子的二代测序 (NGS) 分析中，聚合酶链式反应 (PCR) 的引物二聚体如果在变异检出前不被移除，会增加假性变异信号。考虑一个肿瘤基因panel，其中每个扩增子都由一个已知的长度为 $p_f$ 个核苷酸的正向引物和一个已知的长度为 $p_r$ 个核苷酸的反向引物生成，且 $p_f = p_r = 22$。测序在Illumina平台上进行，采用双末端测序，每个读段（read）的长度为 $R = 150$ 个核苷酸 ($2 \\times 150$)。在标准的接头切除后，您希望通过识别几乎没有或完全没有中间插入片段的全长引物对，来检测并移除PCR引物二聚体读段。假设以下有经验性支持的事实和定义作为基本依据：\n\n- 当正向引物和反向引物相互退火（或与短的互补人造片段退火）并被极小限度地延伸时，会产生引物二聚体片段，其片段长度约等于 $L_{\\mathrm{frag}} = p_f + i + p_r$，其中 $i$ 是引物之间的中间插入片段长度，在真正的引物二聚体中通常接近 $0$。\n- 在此panel中，根据分析设计，合法的扩增子插入片段长度（不包括引物）在 $[120, 250]$ 个核苷酸的范围内。\n- 每碱基的测序错误率为 $\\epsilon = 5 \\times 10^{-3}$，并且为了估计随机匹配概率，可以认为不同位置的碱基检出是近似独立的。\n- 对于读段末端一个长度为 $p$ 的随机序列，当 $p$ 很大时，在碱基频率相等的情况下，其与一个预先指定的 $p$-mer 精确匹配的概率可以忽略不计。允许少量错配可以容纳测序错误，同时仍保持非常低的随机匹配概率。\n\n您的任务是指定一个检测规则，该规则 (i) 要求识别出正确定位于读段两端且方向向内的正向和反向引物，(ii) 对中间插入片段 $i$ 设定一个长度阈值，以将读段分类为引物二聚体，并且 (iii) 在 $N = 10^{7}$ 个读段对的数据集水平上，产生的假阳性率低于 $10^{-6}$。请选择一个能够最正确、最保守地实现这些要求的选项，该选项需基于基本原理和陈述的事实，包括适当的错配容忍度和分类的长度阈值。\n\nA. 要求两个读段末端都包含长度为 $22$ 的全长正向和反向引物序列，方向正确向内，每个引物比对时最多允许 $m = 2$ 个错配，以容纳 $\\epsilon = 5 \\times 10^{-3}$ 的错误率。如果中间插入片段长度满足 $i \\le 8$，则将该读段分类为引物二聚体，这在合并成功时等同于 $L_{\\mathrm{merge}} \\le p_f + p_r + 8 = 52$ 个核苷酸。\n\nB. 在读段末端使用来自正向和反向引物的 $12$ 核苷酸种子序列，每个种子序列允许最多 $m = 3$ 个错配。如果中间插入片段长度满足 $i \\le 20$ 个核苷酸，则分类为引物二聚体，这在合并成功时等同于 $L_{\\mathrm{merge}} \\le 64$ 个核苷酸。\n\nC. 仅要求在单个读段末端存在一个全长引物，最多允许 $m = 2$ 个错配。如果通过双末端比对估计的片段长度满足 $L_{\\mathrm{frag}} \\le 100$ 个核苷酸，则分类为引物二聚体。\n\nD. 要求在读段末端与全长正向和反向引物精确匹配 ($m = 0$)。如果中间插入片段长度满足 $i \\le 2$ 个核苷酸，则分类为引物二聚体，这在合并成功时等同于 $L_{\\mathrm{merge}} \\le p_f + p_r + 2 = 46$ 个核苷酸。",
            "solution": "### 步骤 1：提取已知条件\n\n-   分析：基于扩增子的二代测序 (NGS)，用于微小残留病检测。\n-   正向引物长度：$p_f = 22$ 个核苷酸。\n-   反向引物长度：$p_r = 22$ 个核苷酸。\n-   测序技术：Illumina，双末端测序读段。\n-   读段长度：每个读段对中的读段长度为 $R = 150$ 个核苷酸 ($2 \\times 150$)。\n-   引物二聚体片段长度：$L_{\\mathrm{frag}} = p_f + i + p_r$，其中 $i$ 是中间插入片段长度，对于引物二聚体，$i \\approx 0$。\n-   合法扩增子插入片段长度范围：$i \\in [120, 250]$ 个核苷酸。\n-   每碱基测序错误率：$\\epsilon = 5 \\times 10^{-3}$。\n-   数据集中的读段对数量：$N = 10^7$。\n-   要求的数据集水平假阳性率：$ 10^{-6}$。\n-   合并后读段长度（对于完全重叠的读段）：$L_{\\mathrm{merge}}$。\n-   检测规则要求：\n    1.  识别位于读段末端、方向向内的正向和反向引物。\n    2.  为分类设定一个插入片段长度阈值 $i$。\n    3.  达到指定的假阳性率。\n\n### 步骤 2：使用已知条件进行验证\n\n问题陈述在科学上是合理且严谨的。所描述的场景是临床NGS数据分析中一个标准且关键的质量控制步骤。提供的参数，如引物长度（$22$ nt）、读段长度（$150$ nt）和测序错误率（$\\epsilon=0.005$），对于现代Illumina测序是符合实际的。核心任务是区分PCR引物二聚体人造产物（$i \\approx 0$）和合法扩增子（$i \\in [120, 250]$）。这两个长度类别之间的巨大差异使得问题是可解的。检测规则的要求清晰且客观。问题是自包含的，提供了所有必要的数据来定量评估各个选项。没有违反任何科学原理。\n\n### 步骤 3：结论和行动\n\n问题陈述是**有效的**。将继续进行求解过程。\n\n### 基于原理的推导\n\n主要目标是设计一个过滤器，以移除源自引物二聚体人造产物的读段对，同时保留来自合法扩增子的读段对。\n\n一个引物二聚体片段由正向和反向引物组成，可能由一个非常短的非特异性插入片段隔开。其总长度为 $L_{\\mathrm{frag}} = p_f + p_r + i = 22 + 22 + i = 44 + i$，其中 $i$ 通常接近 $0$。由于 $L_{\\mathrm{frag}}$ 远小于读段长度 $R=150$，双末端读段将完全重叠。经过接头切除和合并后，得到的一致性序列的长度将为 $L_{\\mathrm{merge}} \\approx L_{\\mathrm{frag}} = 44 + i$。\n\n一个合法的扩增子片段的长度为 $L_{\\mathrm{frag}} = 44 + i$，其中 $i \\in [120, 250]$。因此，最短的合法片段是 $44 + 120 = 164$ 个核苷酸。\n\n引物二聚体和合法扩增子之间的根本区别在于插入片段的长度 $i$。一个过滤器如果估计的插入片段长度低于某个阈值 $i \\le i_{\\mathrm{thresh}}$，就会将该读段对分类为引物二聚体。\n\n检测规则还必须通过匹配读段末端的已知引物序列来确认片段的身份。由于测序错误，我们必须允许一定数量的错配 ($m$)。长度为 $p$ 的引物序列中的错误数量可以用二项分布 $B(p, \\epsilon)$ 来建模。对于长度为 $p=22$ 且错误率为 $\\epsilon = 5 \\times 10^{-3}$ 的引物，预期的错误数量为 $E[k] = p \\epsilon = 22 \\times 0.005 = 0.11$。\n\n我们来计算在一个长度为 $22$ 个碱基的引物序列中观察到 $k$ 个错误的概率：\n-   $P(k=0) = (1-\\epsilon)^{22} = (0.995)^{22} \\approx 0.8954$\n-   $P(k=1) = \\binom{22}{1} \\epsilon^1 (1-\\epsilon)^{21} = 22 \\times 0.005 \\times (0.995)^{21} \\approx 0.0989$\n-   $P(k=2) = \\binom{22}{2} \\epsilon^2 (1-\\epsilon)^{20} = 231 \\times (0.005)^2 \\times (0.995)^{20} \\approx 0.0052$\n\n累积概率为：\n-   $P(k \\le 0) \\approx 0.8954$ (一个精确匹配的规则会漏掉约 $10.5\\%$ 的真实引物)。\n-   $P(k \\le 1) \\approx 0.8954 + 0.0989 = 0.9943$\n-   $P(k \\le 2) \\approx 0.9943 + 0.0052 = 0.9995$\n\n允许最多 $m=2$ 个错配可以捕获超过 $99.9\\%$ 的正确测序的引物，提供了极好的灵敏度。一个引物二聚体涉及两个引物，因此用此规则检测到两者的概率是 $(P(k \\le 2))^2 \\approx (0.9995)^2 \\approx 0.999$，这意味着该规则对于检测真实的引物二聚体人造产物具有非常高的灵敏度。\n\n当一个非引物二聚体的读段被错误标记时，就会发生假阳性（FP）。这里分析的最可能的FP来源是恰好匹配引物标准的脱靶读段（随机序列）。数据集的FP率 $N_{FP}/N$ 必须小于 $10^{-6}$，这意味着一个随机读段对成为FP的概率 $P(\\text{FP})$ 必须小于 $10^{-6}$。一个FP需要同时匹配正向和反向引物。一个随机 $p$-mer 与一个特定的 $p$-mer 在最多 $m$ 个错配下匹配的概率是 $P_{\\text{match}}(p, m) = \\sum_{k=0}^{m} \\binom{p}{k} (1/4)^{p-k} (3/4)^k$。对于一个读段对的概率是 $(P_{\\text{match}}(p, m))^2$。\n\n一个“保守”的规则是具有非常低的FP率的规则，而一个“正确”的规则还必须具有高灵敏度来移除人造产物。\n\n### 逐项分析\n\n**A. 要求两个读段末端都包含长度为 $22$ 的全长正向和反向引物序列，方向正确向内，每个引物比对时最多允许 $m = 2$ 个错配，以容纳 $\\epsilon = 5 \\times 10^{-3}$ 的错误率。如果中间插入片段长度满足 $i \\le 8$，则将该读段分类为引物二聚体，这在合并成功时等同于 $L_{\\mathrm{merge}} \\le p_f + p_r + 8 = 52$ 个核苷酸。**\n\n该选项使用完整的引物长度 ($p=22$) 并允许 $m=2$ 个错配。如上计算，这提供了极好的灵敏度（每个引物 >$99.9\\%$）。特异性由随机匹配概率决定。对于一个引物：\n$P_{\\text{match}}(22, 2) = \\sum_{k=0}^{2} \\binom{22}{k} (1/4)^{22-k} (3/4)^k \\approx 4.9 \\times 10^{-11}$。\n一个读段对成为FP，必须匹配两个引物：$P(\\text{FP}) = (P_{\\text{match}}(22, 2))^2 \\approx (4.9 \\times 10^{-11})^2 \\approx 2.4 \\times 10^{-21}$。这个值远远小于要求的 $10^{-6}$。\n长度阈值 $i \\le 8$ (或 $L_{\\mathrm{merge}} \\le 52$) 非常保守，因为它远离从 $i=120$ 开始的合法插入范围。此规则在统计上是合理的，具有高灵敏度、极高的特异性，并且是保守的。\n**结论：正确**\n\n**B. 在读段末端使用来自正向和反向引物的 $12$ 核苷酸种子序列，每个种子序列允许最多 $m = 3$ 个错配。如果中间插入片段长度满足 $i \\le 20$ 个核苷酸，则分类为引物二聚体，这在合并成功时等同于 $L_{\\mathrm{merge}} \\le 64$ 个核苷酸。**\n\n此选项使用一个短的 $12$ nt 种子序列。对于一个 $12$-mer 来说，$m=3$ 的错配容忍度非常宽松（$25\\%$ 的错配率）。在 $12$ nt 中预期的错误数是 $12 \\times 0.005 = 0.06$。允许 $m=1$ 个错配会捕获 $P(k \\le 1) = (0.995)^{12} + 12(0.005)(0.995)^{11} \\approx 0.998$ 的真实种子。允许 $m=3$ 个错配是过度的，并且不必要地损害了特异性。\n让我们计算该规则的随机匹配概率：\n$P_{\\text{match}}(12, 3) = \\sum_{k=0}^{3} \\binom{12}{k} (1/4)^{12-k} (3/4)^k \\approx 3.9 \\times 10^{-4}$。\n一个读段对的FP概率是 $P(\\text{FP}) = (P_{\\text{match}}(12, 3))^2 \\approx (3.9 \\times 10^{-4})^2 \\approx 1.5 \\times 10^{-7}$。\n虽然 $1.5 \\times 10^{-7}  10^{-6}$，但这个FP率比选项A高出 $10^{13}$ 倍以上。参数选择没有得到错误模型的良好支持，并且该规则的保守性显著低于A。$i\\le20$ 的长度阈值也较为不保守，尽管仍然可以接受。\n**结论：不正确** (该选项可行，但与A相比，其正确性和保守性都较差)。\n\n**C. 仅要求在单个读段末端存在一个全长引物，最多允许 $m = 2$ 个错配。如果通过双末端比对估计的片段长度满足 $L_{\\mathrm{frag}} \\le 100$ 个核苷酸，则分类为引物二聚体。**\n\n这个选项有根本性的缺陷。引物二聚体是由*两个*引物形成的人造产物。一个只要求一个引物的规则对于这类人造产物不具有特异性。它会标记任何碰巧以其中一个引物序列开头的短读段。此外，长度阈值 $L_{\\mathrm{frag}} \\le 100$ nt 对应于 $i \\le 100-44 = 56$ nt 的插入片段。这是一个非常宽松的阈值，增加了过滤掉具有大缺失的合法读段的风险。\n**结论：不正确**\n\n**D. 要求在读段末端与全长正向和反向引物精确匹配 ($m = 0$)。如果中间插入片段长度满足 $i \\le 2$ 个核苷酸，则分类为引物二聚体，这在合并成功时等同于 $L_{\\mathrm{merge}} \\le p_f + p_r + 2 = 46$ 个核苷酸。**\n\n这个选项要求精确匹配 ($m=0$)。如计算所示，单个引物被测序而没有任何错误的概率是 $P(k=0) \\approx 0.895$。一个二聚体中的*两个*引物都被完美测序的概率是 $(0.895)^2 \\approx 0.801$。这意味着该规则将无法检测到大约 $20\\%$ 的真实引物二聚体人造产物，导致高假阴性率。虽然此规则具有最高的特异性（最低的FP率），但它不是“正确的”，因为它在移除引物二聚体这项既定任务上是无效的。主要目标是清理数据，而留下 $20\\%$ 的目标人造产物是糟糕的性能。\n**结论：不正确**\n\n### 结论\n\n选项A提出了最科学严谨、平衡且保守的方法。它使用完整的引物序列以获得最大的特异性，允许统计上合理的错配数以确保高灵敏度，要求两个引物都符合二聚体的定义，并应用了一个安全、保守的长度阈值。它稳健地满足了所有既定要求。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "数据过滤策略并非一成不变，必须根据具体的实验设计和生物学问题进行定制。本练习  提出了三种真实的临床肿瘤学测序方案，挑战你为每一种方案设计最优且具有针对性的最小读长过滤策略。这要求你综合运用关于读段比对唯一性、文库副产物类型以及不同方案中生物信号特征的知识，做出明智的决策。",
            "id": "4313865",
            "problem": "一种用于精准肿瘤学的靶向下一代测序工作流程在比对前使用接头修剪和读段过滤。修剪后，每个读段的长度 $L$ 可变；一个最小长度过滤器会丢弃长度 $L  L_{\\min}$ 的读段。假设以下基本事实和定义成立：\n\n- 在一个大小为 $G$ 的大型真核生物基因组中（例如，人类基因组 $G \\approx 3\\times 10^{9}\\,\\mathrm{bp}$），一个随机 $L$-mer 的精确匹配预期数量大致与 $G/4^{L}$ 成比例，但真实基因组富含重复序列和低复杂度序列，这增加了小 $L$ 值的多重比对（multi-mapping）情况。\n- 在双末端测序（paired-end sequencing）中，从一个插入片段大小为 $I$ 的 DNA 片段生成两个读段，而正常配对（proper pairs）的读段满足围绕 $I$ 的方向和距离约束；与单末端比对（single-end mapping）相比，一致的配对（concordant pairing）降低了伪比对（spurious alignment）的概率。\n- 在杂交捕获（hybrid capture）中，生物素化的探针（“诱饵”）富集目标区域，但比对仍然是针对全基因组执行的；比对后，靶向读段（on-target reads）是指其比对结果与目标区间重叠的读段。\n- 在扩增子（amplicon）工作流程中，引物二聚体（primer-dimer）副产物会产生主要由引物序列组成的短片段，这些片段对于变异检出没有信息价值，并且可能导致伪比对。\n- 独特分子标识符（Unique Molecular Identifiers, UMIs）能够实现一致性序列检出（consensus calling），从而抑制随机测序错误，但无法挽救系统性的比对错误（mis-mapping）。\n\n您必须基于这些原则进行推理，在保留靶向短片段与错误比对和副产物保留风险之间进行权衡，为三种现实的肿瘤学方案制定策略：\n\n- 方案 $\\mathrm{P1}$（组织杂交捕获）：目标区域大小 $1.5\\,\\mathrm{Mb}$，诱饵长度 $120\\,\\mathrm{nt}$，双末端测序 $2\\times 150\\,\\mathrm{bp}$，插入片段大小中位数 $I \\approx 220\\,\\mathrm{bp}$ 且具有中等变异性，靶向重复读段比例 $\\approx 20\\%$, 并且在比对前整合并修剪了 $12\\,\\mathrm{nt}$ 的 UMIs。\n- 方案 $\\mathrm{P2}$（扩增子，血浆）：$\\approx 300$ 个扩增子，平均长度 $160\\,\\mathrm{bp}$，每个引物长度 $\\approx 25\\,\\mathrm{nt}$，双末端测序 $2\\times 150\\,\\mathrm{bp}$，在 $40$–$60\\,\\mathrm{bp}$ 处有频繁的引物二聚体峰，无 UMIs。\n- 方案 $\\mathrm{P3}$（游离 DNA 杂交捕获）：目标区域大小 $500\\,\\mathrm{kb}$，诱饵长度 $80\\,\\mathrm{nt}$，双末端测序 $2\\times 100\\,\\mathrm{bp}$，游离 DNA 片段长度众数为 $167\\,\\mathrm{bp}$ 且有大量 $90$–$150\\,\\mathrm{bp}$ 的片段，$10\\,\\mathrm{nt}$ UMIs，用于稀有变异检测的超深度测序。\n\n考虑到过于激进的 $L_{\\min}$ 会加剧 $\\mathrm{P3}$ 中的等位基因偏倚和覆盖度缺失，而过于宽松的 $L_{\\min}$ 则会增加 $\\mathrm{P1}$ 和 $\\mathrm{P2}$ 中由错误比对或副产物读段引起的假阳性。请从以下选项中选择一个最佳策略，用于对接头修剪后（应用于每个配对读段）进行方案特异性的最小长度过滤，包括任何配对层面的“挽救”规则，以在控制副产物和错误比对风险的同时，最大程度地保留有信息价值的靶向短片段。\n\nA. 一刀切策略：对所有 $\\mathrm{P1}$–$\\mathrm{P3}$ 方案设置 $L_{\\min} = 50\\,\\mathrm{bp}$；无例外地丢弃任何短于 $50\\,\\mathrm{bp}$ 的配对读段；不使用任何配对层面的挽救。\n\nB. 方案特异性策略，并在合理情况下进行双末端挽救：\n- $\\mathrm{P1}$：设置 $L_{\\min} = 40\\,\\mathrm{bp}$；如果两个配对读段都作为正常配对比对，并且它们的比对结果都落在靶向区域，则接受短至 $30\\,\\mathrm{bp}$ 的读段（即，仅当有正常的靶向配对支持时，才挽救 $30 \\le L  40\\,\\mathrm{bp}$ 的读段）；否则丢弃。\n- $\\mathrm{P2}$：设置 $L_{\\min} = 60\\,\\mathrm{bp}$；不挽救低于 $60\\,\\mathrm{bp}$ 的读段，以抑制引物二聚体和仅含引物的读段。\n- $\\mathrm{P3}$：设置 $L_{\\min} = 30\\,\\mathrm{bp}$；要求所有保留的读段都必须是正常配对且在靶向区域有重叠；允许在比对后进行基于 UMI 的一致性序列合并。\n\nC. 在所有方案中激进地保留短读段：为 $\\mathrm{P1}$ 和 $\\mathrm{P3}$ 设置 $L_{\\min} = 20\\,\\mathrm{bp}$，为 $\\mathrm{P2}$ 设置 $L_{\\min} = 30\\,\\mathrm{bp}$；接受任何比对到靶向区域的读段，无论其配对或方向如何；假定 UMIs（如果存在）可以缓解任何错误率的增加。\n\nD. 诱饵长度启发式策略：对于捕获方案，将 $L_{\\min}$ 设置为诱饵长度的一半，对于扩增子方案设置一个下限：\n- $\\mathrm{P1}$：$L_{\\min} = 60\\,\\mathrm{bp}$（$120\\,\\mathrm{nt}$ 诱饵长度的一半）。\n- $\\mathrm{P2}$：$L_{\\min} = 40\\,\\mathrm{bp}$（设置得更短以避免丢失扩增子覆盖度）。\n- $\\mathrm{P3}$：$L_{\\min} = 40\\,\\mathrm{bp}$（$80\\,\\mathrm{nt}$ 诱饵长度的一半）。\n忽略配对层面的挽救和靶向配对约束。\n\n基于第一性原理和现实的实验约束，哪个选项最适合用于设置最小长度过滤器，既能尊重靶向捕获设计，又能保留有信息价值的靶向短片段？",
            "solution": "任务是为三种不同的肿瘤学下一代测序（NGS）方案，在接头修剪后确定最合适的最小读段长度过滤器（$L_{\\min}$）设置策略。该策略必须源于一组基本原则和方案特有的细节，旨在最大化保留有信息价值的数据，同时控制副产物和错误比对的风险。\n\n### 问题验证\n\n首先，我将验证问题陈述。\n\n**步骤1：提取已知信息**\n-   **基本原则：**\n    -   基因组大小 $G \\approx 3\\times 10^{9}\\,\\mathrm{bp}$。\n    -   一个随机 $L$-mer 的精确匹配预期数量 $\\sim G/4^{L}$。真实基因组富含重复序列，增加了小 $L$ 值的多重比对情况。\n    -   双末端测序和正常配对可减少伪比对。\n    -   杂交捕获比对至全基因组；靶向读段与诱饵定义的目标区间重叠。\n    -   扩增子工作流程可能产生短的引物二聚体副产物。\n    -   独特分子标识符（UMIs）可以纠正随机测序错误，但不能纠正系统性错误比对。\n-   **方案 P1（组织杂交捕获）：**\n    -   目标区域：$1.5\\,\\mathrm{Mb}$，双末端测序 $2\\times 150\\,\\mathrm{bp}$，UMIs ($12\\,\\mathrm{nt}$)，诱饵长度 $120\\,\\mathrm{nt}$，插入片段大小中位数 $I \\approx 220\\,\\mathrm{bp}$。\n-   **方案 P2（扩增子，血浆）：**\n    -   目标区域：$\\approx 300$ 个扩增子（平均长度 $160\\,\\mathrm{bp}$），双末端测序 $2\\times 150\\,\\mathrm{bp}$，无 UMIs，引物长度 $\\approx 25\\,\\mathrm{nt}$，在 $40$–$60\\,\\mathrm{bp}$ 处有频繁的引物二聚体副产物。\n-   **方案 P3（游离 DNA 杂交捕获）：**\n    -   目标区域：$500\\,\\mathrm{kb}$，双末端测序 $2\\times 100\\,\\mathrm{bp}$，UMIs ($10\\,\\mathrm{nt}$)，诱饵长度 $80\\,\\mathrm{nt}$，cfDNA 片段长度众数为 $167\\,\\mathrm{bp}$ 且有大量 $90$–$150\\,\\mathrm{bp}$ 的片段。\n-   **一般考虑：**\n    -   高的 $L_{\\min}$ 对 P3 不利（等位基因偏倚，覆盖度缺失）。\n    -   低的 $L_{\\min}$ 对 P1 和 P2 不利（由错误比对/副产物导致的假阳性）。\n    -   过滤器应用于每个配对读段，可能存在针对配对的“挽救”规则。\n\n**步骤2：使用提取的已知信息进行验证**\n问题陈述具有科学依据。对 NGS 技术（双末端测序、杂交捕获、扩增子、UMIs）、其典型副产物（引物二聚体、错误比对）的描述，以及三个方案的参数，在临床基因组学领域都是标准且符合实际的。问题的核心是在灵敏度（保留短但有信息价值的读段）和特异性（拒绝副产物和伪比对读段）之间的权衡，这是生物信息学流程设计中的一个核心挑战。这个问题提得很好，提供了足够的信息来推理不同过滤策略的相对优劣。它是客观、完整，且不包含科学或逻辑上的矛盾。语言精确，使用了标准术语。这个问题并非无足轻重，需要对实验设计和数据分析之间的相互作用有细致的理解。\n\n**步骤3：结论与行动**\n问题有效。我将继续推导解决方案并评估各个选项。\n\n### 推导与选项分析\n\n最佳策略必须根据每个方案的具体特点量身定制。\n\n**方案 P1 分析（组织杂交捕获）：**\n-   这是一个标准的杂交捕获实验。如果 DNA 片段短于 $150\\,\\mathrm{bp}$，读段长度就会比原始读段长度（$150\\,\\mathrm{bp}$）短。\n-   主要的担忧是短读段的比对模糊性。对于较小的 $L$，$L$-mer 的唯一性较低。例如，当 $L=30$ 时，随机匹配的预期数量很低（$G/4^L \\approx 0.0026$），但基因组中的重复结构可能导致一个 $30$-mer 比对到多个位置。\n-   关键的缓解因素是双末端信息。如果一个短读段的配对读段能够可靠地比对，那么这个短读段的基因组来源就受到了强有力的约束。这就是“挽救”短配对读段背后的原理。\n-   另一层证据是靶向区域要求。一个正常配对、位于靶向区域的读段对极不可能是伪比对。\n-   因此，一个明智的策略是设置一个中等的最小长度（例如 $L_{\\min}=40\\,\\mathrm{bp}$）来过滤掉最有问题的读段，但如果它们是高可信度配对（正常配对且在靶向区域）的一部分，则挽救更短的读段（例如，短至 $L \\approx 30\\,\\mathrm{bp}$）。这可以在不过度牺牲特异性的情况下最大化灵敏度。\n\n**方案 P2 分析（扩增子，血浆）：**\n-   其决定性特征是存在短的（$40$–$60\\,\\mathrm{bp}$）引物二聚体副产物。这些是非生物来源的，必须被移除以避免假阳性变异检出。\n-   读段长度过滤器是消除这些副产物的直接而有效的方法。将 $L_{\\min}$ 设置为略高于此范围，例如 $L_{\\min}=60\\,\\mathrm{bp}$，将非常有效。\n-   由于 $40$–$60\\,\\mathrm{bp}$ 范围内的读段来源绝大多数是副产物，因此没有理由使用“挽救”机制。挽救这些读段会适得其反，重新引入我们希望过滤掉的副产物。真正的信号来自长度约 $160\\,\\mathrm{bp}$ 的扩增子，它们将产生接近全长（$\\approx 150\\,\\mathrm{bp}$）的读段。\n-   因此，对于此方案，采用一个严格、较高的 $L_{\\min}$ 且不进行挽救是最合适的策略。\n\n**方案 P3 分析（cfDNA 杂交捕获）：**\n-   其决定性特征是短的 DNA 片段是目标生物信号。cfDNA 片段组学数据显示，有大量片段短于 $167\\,\\mathrm{bp}$ 的主峰。\n-   问题明确警告说，激进的（高的）$L_{\\min}$ 会导致“等位基因偏倚和覆盖度缺失”。这意味着我们必须使用一个宽松的（低的）$L_{\\min}$ 来保留这些短的、有信息价值的片段。\n-   低的 $L_{\\min}$（例如 $30\\,\\mathrm{bp}$）增加了错误比对的风险。为了应对这一点，我们必须利用所有其他可用的证据。与 P1 一样，这是一个双末端、基于捕获的实验。\n-   确保特异性的最稳健方法是要求*所有*保留的读段，特别是短读段，都必须是正常比对配对的一部分，并且其比对结果与目标区域重叠。这种过滤器组合非常强大。\n-   UMIs 存在且对于校正 PCR/测序错误以及从深度测序数据中获得准确的等位基因频率至关重要，但它们无法修复比对错误。必须依赖于基于比对的质量指标。\n\n**推导出的最佳策略总结：**\n-   **P1：**中等的 $L_{\\min}$（例如 $40\\,\\mathrm{bp}$），并为靶向区域的更短读段（例如 $30\\,\\mathrm{bp}$）提供基于配对的挽救。\n-   **P2：**高的、严格的 $L_{\\min}$（例如 $60\\,\\mathrm{bp}$），不进行挽救以消除引物二聚体。\n-   **P3：**低的 $L_{\\min}$（例如 $30\\,\\mathrm{bp}$），并对所有读段附加严格的正常配对和靶向状态要求。\n\n现在可以将这个推导出的策略框架与提供的选项进行比较。\n\n---\n\n**A. 一刀切策略：对所有 $\\mathrm{P1}$–$\\mathrm{P3}$ 方案设置 $L_{\\min} = 50\\,\\mathrm{bp}$；无例外地丢弃任何短于 $50\\,\\mathrm{bp}$ 的配对读段；不使用任何配对层面的挽救。**\n这个策略不合适。单一的 $L_{\\min}$ 未能考虑到不同方案的需求。对于 P2 来说，它过于宽松，因为 $50\\,\\mathrm{bp}$ 的 $L_{\\min}$ 会保留许多引物二聚体副产物（$40$–$60\\,\\mathrm{bp}$）。对于 P3 来说，它过于严格，会丢弃短于 $50\\,\\mathrm{bp}$ 的有信息价值的 cfDNA 片段。缺乏挽救机制是一个普遍的弱点，未能利用双末端信息。\n**结论：不正确。**\n\n**B. 方案特异性策略，并在合理情况下进行双末端挽救：**\n-   **P1：**设置 $L_{\\min} = 40\\,\\mathrm{bp}$，并为正常的、靶向的配对挽救短至 $30\\,\\mathrm{bp}$ 的读段。这与推导出的最佳策略完美匹配，平衡了灵敏度和特异性。\n-   **P2：**设置 $L_{\\min} = 60\\,\\mathrm{bp}$，不进行挽救。这是正确的激进过滤策略，用以消除已知的 $40$–$60\\,\\mathrm{bp}$ 引物二聚体副产物。\n-   **P3：**设置 $L_{\\min} = 30\\,\\mathrm{bp}$，并要求所有读段都必须是正常配对且位于靶向区域。这正确地优先考虑了对短 cfDNA 片段的灵敏度，同时使用严格的基于比对的标准来控制错误比对。\n这个选项的策略是一个细致入微、理由充分且针对特定方案的方法，与从第一性原理推导出的结论完全一致。\n**结论：正确。**\n\n**C. 在所有方案中激进地保留短读段：为 $\\mathrm{P1}$ 和 $\\mathrm{P3}$ 设置 $L_{\\min} = 20\\,\\mathrm{bp}$，为 $\\mathrm{P2}$ 设置 $L_{\\min} = 30\\,\\mathrm{bp}$；接受任何比对到靶向区域的读段，无论其配对或方向如何；假定 UMIs（如果存在）可以缓解任何错误率的增加。**\n这个策略是鲁莽的。在人类基因组中，$20\\,\\mathrm{bp}$ 的 $L_{\\min}$ 太低，无法进行明确的比对，会招致大量的假阳性。对于 P2 来说，$30\\,\\mathrm{bp}$ 的 $L_{\\min}$ 会保留所有引物二聚体副产物。放弃双末端读段的方向和距离约束是一个严重的错误，它消除了对抗伪比对最强大的过滤器之一。关于 UMIs 能缓解比对错误的说法，与问题陈述中的一个前提明确矛盾。\n**结论：不正确。**\n\n**D. 诱饵长度启发式策略：对于捕获方案，将 $L_{\\min}$ 设置为诱饵长度的一半，对于扩增子方案设置一个下限：**\n-   **P1：**$L_{\\min} = 60\\,\\mathrm{bp}$（$120\\,\\mathrm{nt}$ 的一半）。这过于激进且缺乏挽救机制。\n-   **P2：**$L_{\\min} = 40\\,\\mathrm{bp}$。这是一个灾难性的选择，因为它确保了 $40$–$60\\,\\mathrm{bp}$ 的引物二聚体副产物被保留下来。\n-   **P3：**$L_{\\min} = 40\\,\\mathrm{bp}$（$80\\,\\mathrm{nt}$ 的一半）。对于 cfDNA 来说，这可能过于激进。\n将 $L_{\\min}$ 与诱饵长度联系起来的核心启发式方法是武断的，没有基于合理的原则。诱饵长度与捕获效率有关，而 $L_{\\min}$ 与比对特异性有关。此外，该策略忽略了双末端挽救，而这是一个关键工具。\n**结论：不正确。**\n\n分析表明，选项 B 是唯一一个反映了对每种特定基因组应用所涉权衡有深刻和正确理解的选项。",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}