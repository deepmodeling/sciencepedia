{
    "hands_on_practices": [
        {
            "introduction": "在将测序读段（read）比对到参考基因组之前，我们首先需要一个能够描述测序过程中可能出现的错误的数学模型。本练习将引导你从第一性原理出发，使用基本的概率论工具来构建这样一个模型。通过这个实践，你将学会如何推导出一个读段中预期出现的错配（mismatch）和插入/缺失（indel）总数，这是理解和设计比对算法的一个核心概念，其中涉及到替换错误率 $\\epsilon$ 和插入缺失错误率 $\\delta$。",
            "id": "4375145",
            "problem": "在精准医疗诊断流程中，一条来自下一代测序（NGS）的标称长度为 $L$ 个碱基的短读序列被比对到参考基因组上。假设一个测序错误的机制性生成模型，在该模型中，对于每个真实模板位置 $i \\in \\{1,\\dots,L\\}$，两个独立的错误通道可能导致观测到的比对差异：\n- 一个碱基识别替换错误通道，在位置 $i$ 处以概率 $\\epsilon$ 产生一个错误的核苷酸，从而在比对时造成一个错配。\n- 一个单核苷酸插入或缺失（indel）通道，在位置 $i$ 的局部邻域内以概率 $\\delta$ 产生恰好一个插入或缺失事件，比对器将每个此类事件计为一个比对差异。\n\n假设 $\\epsilon$ 和 $\\delta$ 与位置无关，并且在该模型下多核苷酸 indel 可以忽略不计。同时假设比对过程将每个错配计为一个差异，每个单核苷酸 indel（插入或缺失）也计为一个差异，并且为了计算期望，替换和 indel 对总数的贡献是可加的。忽略生物多态性（即将参考基因组视为真实模板）以及读长序列末端的边界复杂性。\n\n仅从伯努利试验、指示随机变量和期望的线性性质的定义出发，推导出一个关于 $L$、$\\epsilon$ 和 $\\delta$ 的闭式表达式，用于表示在整条读长序列上观测到的比对差异总数的期望值。你的最终答案必须是单一的解析表达式。无需进行四舍五入，最终表达式也不带单位。",
            "solution": "目标是推导长度为 $L$ 的短读序列的比对差异总数期望值的表达式。设此总数由随机变量 $D$ 表示。问题假定差异产生于两个不同的错误通道：碱基替换和单核苷酸 indel。\n\n设 $D_{sub}$ 表示由替换产生的差异总数，设 $D_{indel}$ 表示由 indel 产生的差异总数。总数是来自这两个来源的计数的总和：\n$$D = D_{sub} + D_{indel}$$\n期望的一个基本性质是其线性性质。该性质允许将差异的总期望数计算为每个来源的期望值之和：\n$$E[D] = E[D_{sub} + D_{indel}] = E[D_{sub}] + E[D_{indel}]$$\n推导过程将通过使用指定的指示随机变量方法，单独计算右侧的每个期望值来进行。\n\n首先，确定替换差异的期望数 $E[D_{sub}]$。对于读长序列中的 $L$ 个核苷酸位置中的每一个，都可能发生替换错误。为每个位置 $i \\in \\{1, \\dots, L\\}$ 定义一个指示随机变量 $S_i$：\n$$\nS_i =\n\\begin{cases}\n1  \\text{如果在位置 } i \\text{ 发生替换错误} \\\\\n0  \\text{否则}\n\\end{cases}\n$$\n在任何给定位置发生替换错误是一个伯努利试验。问题陈述此类错误的概率为 $\\epsilon$。因此，$S_i$ 的概率质量函数为 $P(S_i = 1) = \\epsilon$ 和 $P(S_i = 0) = 1 - \\epsilon$。\n\n指示随机变量的期望值等于它所指示事件的概率。因此，对于每个位置 $i$：\n$$E[S_i] = 1 \\cdot P(S_i = 1) + 0 \\cdot P(S_i = 0) = P(S_i = 1) = \\epsilon$$\n替换差异的总数 $D_{sub}$ 是这些指示变量在所有 $L$ 个位置上的总和，因为每次替换都对总数贡献一个差异：\n$$D_{sub} = \\sum_{i=1}^{L} S_i$$\n使用期望的线性性质，替换差异的期望数是各个期望值之和：\n$$E[D_{sub}] = E\\left[\\sum_{i=1}^{L} S_i\\right] = \\sum_{i=1}^{L} E[S_i]$$\n鉴于错误概率 $\\epsilon$ 与位置无关，$E[S_i]$ 对所有 $i$ 都是常数。因此：\n$$E[D_{sub}] = \\sum_{i=1}^{L} \\epsilon = L\\epsilon$$\n\n其次，对 indel 事件的贡献进行类似的计算。模型指定了与 $L$ 个模板位置中的每一个相关联的 indel 通道。为每个位置 $i \\in \\{1, \\dots, L\\}$ 定义第二组指示随机变量 $I_i$：\n$$\nI_i =\n\\begin{cases}\n1  \\text{如果在位置 } i \\text{ 的邻域内产生 indel 事件} \\\\\n0  \\text{否则}\n\\end{cases}\n$$\nindel 事件的产生也是一个伯努利试验，其成功概率据称为 $\\delta$。$I_i$ 的概率质量函数为 $P(I_i = 1) = \\delta$ 和 $P(I_i = 0) = 1 - \\delta$。\n\n这个指示随机变量的期望值为：\n$$E[I_i] = 1 \\cdot P(I_i = 1) + 0 \\cdot P(I_i = 0) = P(I_i = 1) = \\delta$$\nindel 差异的总数 $D_{indel}$ 是这些指示变量的总和，因为每个 indel 事件贡献一个差异：\n$$D_{indel} = \\sum_{i=1}^{L} I_i$$\n再次应用期望的线性性质：\n$$E[D_{indel}] = E\\left[\\sum_{i=1}^{L} I_i\\right] = \\sum_{i=1}^{L} E[I_i]$$\n由于 indel 概率 $\\delta$ 也与位置无关，$E[I_i]$ 对所有 $i$ 都是常数：\n$$E[D_{indel}] = \\sum_{i=1}^{L} \\delta = L\\delta$$\n\n最后，比对差异的总期望数 $E[D]$ 是来自两个错误通道的期望之和：\n$$E[D] = E[D_{sub}] + E[D_{indel}] = L\\epsilon + L\\delta$$\n该表达式可以因式分解得到最终的闭式解：\n$$E[D] = L(\\epsilon + \\delta)$$\n这个结果是严格地从指定的概率论第一性原理推导出来的。",
            "answer": "$$\\boxed{L(\\epsilon + \\delta)}$$"
        },
        {
            "introduction": "将理论模型应用于实际数据分析时，我们必须面对数据表示的复杂性，尤其是基因组坐标系统。即使拥有完美的比对算法，对坐标的误解也可能导致严重的分析错误。本练习将带你深入探讨基因组信息学中至关重要却又常常令人困惑的0基准和1基准坐标系统，并分析在处理BED、VCF等标准文件格式时，一个简单的“差一错误”如何导致错误的生物学结论。",
            "id": "4375062",
            "problem": "在基因组信息学中，区间坐标使用两种广泛采用的系统来表示，这两种系统都基于序列索引的标准定义。在一个基于$0$的、前闭后开（半开）系统中，区间 $[s,e)$ 表示偏移量为 $s, s+1, \\dots, e-1$ 的元素；在一个基于$1$的、双端闭合（闭合）系统中，区间 $[S,E]$ 表示位置为 $S, S+1, \\dots, E$ 的元素。对于描述相同元素序列的区间，这两种系统之间数学上一致的相互转换要求 $S = s + 1$ 和 $E = e$。在人类基因组分析中，Browser Extensible Data (BED) 格式使用基于 $0$ 的半开坐标，Variant Call Format (VCF) 格式对单核苷酸变异使用基于 $1$ 的闭合单点位点，Sequence Alignment/Map (SAM) 和 Binary Alignment/Map (BAM) 格式使用基于 $1$ 的闭合最左端位置和 Concise Idiosyncratic Gapped Alignment Report (CIGAR) 字符串来编码比对跨度，而 General Feature Format/Gene Transfer Format (GFF/GTF) 格式使用基于 $1$ 的闭合区间。Human Genome Variation Society (HGVS) 命名法将转录本相对坐标表示为沿互补 DNA (cDNA) 的基于 $1$ 的闭合索引。\n\n考虑一个位于 $7$ 号染色体正链上的外显子，其跨越基于 $0$ 的半开区间 $[55049999, 55050003)$，这对应于基于 $1$ 的闭合区间 $[55050000, 55050003]$，因此包含 $4$ 个碱基。在 VCF 文件中报告了一个单核苷酸变异，位于 $7$ 号染色体位置 $55050003$（即该外显子的最后一个碱基），其参考等位基因为 $\\text{C}$，备选等位基因为 $\\text{T}$。\n\n一个下游流程尝试通过将每个位于基于 $1$ 的位置 $p$ 的 VCF 单核苷酸变异转换为基于 $0$ 的半开区间，来执行变异与 BED 外显子之间的区间重叠查询，但错误地将其映射为 $[p, p+1)$，而不是数学上正确的 $[p-1, p)$。同样的错误映射也在内部用于分配转录本相关的 HGVS cDNA 位置。另外，另一个团队在没有进行任何坐标转换的情况下，将 BED 外显子区间导出为 GFF 格式。\n\n仅根据上述核心定义和所描述的场景，以下哪些陈述是正确的？选择所有适用的选项。\n\nA. 在错误的映射 $[p, p+1)$下，位于 $7$ 号染色体位置 $55050003$ 的单核苷酸变异将被重叠查询分类为内含子（即位于外显子之外），尽管它实际上位于外显子内部。\n\nB. 在错误的映射 $[p, p+1)$下，位于长度至少为 $2$ 个碱基的正链外显子第一个碱基上的单核苷酸变异，仍将被重叠查询分类为外显子。\n\nC. 如果使用同样的错误映射 $[p, p+1)$ 来计算 Human Genome Variation Society (HGVS) cDNA 索引，那么对于外显子内（非转录本起始位置）的单核苷酸变异，报告的 cDNA 坐标将相对于真实坐标向上偏移 $+1$。\n\nD. 在从 Sequence Alignment/Map (SAM) 或 Binary Alignment/Map (BAM) 比对中计算每碱基覆盖度时，将基于 $1$ 的闭合最左端位置视为基于 $0$ 的半开起始位置，将导致每个基因组位置的每碱基深度全局增加 $1$。\n\nE. 对于正链外显子，未能通过设置 $S = s+1$ 和 $E = e$ 将 Browser Extensible Data (BED) 区间 $[s,e)$ 转换为 General Feature Format (GFF) 区间 $[S,E]$，将导致报告的 $5'$ 外显子边界向下游偏移 $+1$ 个碱基，而 $3'$ 边界保持不变。\n\nF. 对于 Variant Call Format (VCF) 中位于基因组位置 $p$ 且参考等位基因长度 $L > 1$ 的缺失，用于测试重叠的数学上正确的基于 $0$ 的半开区间是 $[p-1, p-1+L)$；在错误的映射 $[p, p+L)$ 下，缺失窗口向右偏移了 $+1$ 个碱基，这会改变重复序列背景下的标准化和左对齐。",
            "solution": "该问题要求对几个关于基因组坐标系及其错误转换后果的陈述进行批判性分析。我将首先验证问题陈述，然后对每个选项进行详细评估。\n\n### 问题验证\n\n**步骤 1：提取已知信息**\n\n*   **基于$0$的前闭后开（半开）系统：** 区间 $[s,e)$ 表示偏移量为 $s, s+1, \\dots, e-1$ 的元素。长度为 $e-s$。Browser Extensible Data (BED) 格式使用此系统。\n*   **基于$1$的双端闭合（闭合）系统：** 区间 $[S,E]$ 表示位置为 $S, S+1, \\dots, E$ 的元素。长度为 $E-S+1$。Variant Call Format (VCF)、Sequence Alignment/Map (SAM/BAM)、General Feature Format (GFF/GTF) 和 Human Genome Variation Society (HGVS) 命名法使用此系统。\n*   **正确的相互转换：** 为了表示相同的碱基序列，一个基于 $0$ 的区间 $[s,e)$ 转换为一个基于 $1$ 的区间 $[S,E]$ 时，$S = s + 1$ 且 $E = e$。反之，一个基于 $1$ 的区间 $[S,E]$ 转换为一个基于 $0$ 的区间 $[s,e)$ 时，$s = S - 1$ 且 $e = E$。\n*   **场景数据：**\n    *   一个位于 $7$ 号染色体正链上的外显子，由基于 $0$ 的半开区间 $[55049999, 55050003)$ 和等效的基于 $1$ 的闭合区间 $[55050000, 55050003]$ 给出。长度为 $4$ 个碱基。\n    *   一个单核苷酸变异 (SNV) 在 VCF 中报告，位于 $7$ 号染色体，位置 $p = 55050003$。这是指定外显子的最后一个碱基。\n*   **错误的映射：**\n    1.  一个位于基于 $1$ 位置 $p$ 的 VCF SNV 被错误地转换为基于 $0$ 的区间 $[p, p+1)$。对于单个位置 $p$（即一个基于 $1$ 的区间 $[p,p]$），正确的映射应为 $[p-1, p)$。\n    2.  同样的错误 $[p, p+1)$ 也被用于分配 HGVS cDNA 坐标。\n    3.  BED 区间 $[s,e)$ 在没有进行坐标转换的情况下被导出为 GFF 格式的 $[s,e]$。\n\n**步骤 2：使用提取的已知信息进行验证**\n\n问题陈述在科学上是合理的、表述清晰且客观的。它准确地描述了生物信息学中使用的标准坐标系和文件格式。在错误映射中出现的“差一错误”(off-by-one error) 是基因组数据处理中常见且现实的陷阱。所提供的数据内部一致：基于 $0$ 的区间 $[55049999, 55050003)$ 覆盖了基于 $0$ 的索引 $55049999, 55050000, 55050001, 55050002$，共 $4$ 个碱基。对应的基于 $1$ 的位置是 $55050000, 55050001, 55050002, 55050003$，即区间 $[55050000, 55050003]$。位于位置 $55050003$ 的 SNV 确实是此外显子的最后一个碱基。所有前提都清晰、可形式化，并且没有矛盾或含糊之处。\n\n**步骤 3：结论与行动**\n\n问题是有效的。我现在将通过分析每个陈述来继续解答。\n\n### 逐项分析\n\n**A. 在错误的映射 $[p, p+1)$下，位于 $7$ 号染色体位置 $55050003$ 的单核苷酸变异将被重叠查询分类为内含子（即位于外显子之外），尽管它实际上位于外显子内部。**\n\n*   **外显子区间：** 外显子以 BED 格式给出，该格式是基于 $0$ 的半开区间。区间为 $I_{exon} = [55049999, 55050003)$。该区间包含所有满足 $55049999 \\leq x  55050003$ 的基因组索引 $x$。\n*   **SNV 位置：** SNV 位于基于 $1$ 的位置 $p = 55050003$。\n*   **事实核查：** 这个单核苷酸位置的正确基于 $0$ 的区间是 $[p-1, p) = [55050003-1, 55050003) = [55050002, 55050003)$。索引 $55050002$ 满足 $55049999 \\leq 55050002  55050003$，所以该变异确实位于外显子内。\n*   **错误映射：** 该变异被错误地映射到基于 $0$ 的区间 $I_{SNV, mistaken} = [p, p+1) = [55050003, 55050004)$。\n*   **重叠查询：** 我们测试 $I_{exon}$ 和 $I_{SNV, mistaken}$ 是否重叠。如果它们的交集非空，则存在重叠。区间 $I_{exon}$ 包含直到但不包括 $55050003$ 的索引。区间 $I_{SNV, mistaken}$ 包含从 $55050003$ 开始的索引。它们是相邻的，但没有任何共同的索引。它们的交集是空集。\n*   **结论：** 因为没有重叠，流程会把该变异分类为外显子之外。如果与外显子相邻的区域是内含子，它将被分类为内含子。因此，该陈述是正确的。\n\n**判定：正确**\n\n**B. 在错误的映射 $[p, p+1)$下，位于长度至少为 $2$ 个碱基的正链外显子第一个碱基上的单核苷酸变异，仍将被重叠查询分类为外显子。**\n\n*   **外显子区间：** 设该外显子由基于 $0$ 的区间 $[s, e)$ 描述，其长度 $L = e-s \\geq 2$。\n*   **SNV 位置：** 外显子的第一个碱基位于基于 $0$ 的索引 $s$。其对应的基于 $1$ 的位置是 $p = s+1$。\n*   **错误映射：** 位于 $p = s+1$ 的 SNV 被错误地映射到基于 $0$ 的区间 $I_{SNV, mistaken} = [p, p+1) = [s+1, s+2)$。这个区间代表索引为 $s+1$ 的碱基。\n*   **重叠查询：** 我们测试 $I_{exon} = [s, e)$ 是否与 $I_{SNV, mistaken} = [s+1, s+2)$ 重叠。外显子区间包含索引 $s, s+1, \\dots, e-1$。由于长度 $L=e-s \\geq 2$，我们知道 $e \\geq s+2$。这保证了索引 $s+1$ 位于外显子区间 $[s,e)$ 内。代表错误 SNV 位置的区间 $[s+1, s+2)$ 是 $[s,e)$ 的一个子区间（因为 $s  s+1$ 且 $s+2 \\leq e$）。因此，交集非空（交集为 $[s+1, s+2)$），将会检测到重叠。\n*   **结论：** 该变异将被正确地分类为外显子。该陈述是正确的。\n\n**判定：正确**\n\n**C. 如果使用同样的错误映射 $[p, p+1)$ 来计算 Human Genome Variation Society (HGVS) cDNA 索引，那么对于外显子内（非转录本起始位置）的单核苷酸变异，报告的 cDNA 坐标将相对于真实坐标向上偏移 `+1`。**\n\n*   **HGVS cDNA 位置：** `c.` 坐标是剪接后转录本序列中一个基于 $1$ 的索引。它的计算方法是将前面所有外显子的长度相加，再加上变异在其所在外显子内的基于 $1$ 的偏移量。\n*   **正确计算：** 对于一个位于基于 $1$ 的基因组位置 $p$ 的变异，正确的基于 $0$ 的索引是 $p-1$。如果该位置落入一个起始于基于 $0$ 索引 $s_{exon}$ 的外显子中，则其在外显子内的基于 $0$ 的偏移量是 $(p-1) - s_{exon}$。基于 $1$ 的偏移量是 $((p-1) - s_{exon}) + 1$。\n*   **错误计算：** 错误的映射使用区间 $[p, p+1)$，实际上是将基于 $1$ 的位置 $p$ 当作了基于 $0$ 的索引。错误地计算出的外显子内基于 $0$ 的偏移量将是 $p - s_{exon}$。错误的基于 $1$ 的偏移量是 $(p - s_{exon}) + 1$。\n*   **比较：**\n    *   真实坐标贡献：$\\dots + ((p-1) - s_{exon} + 1)$\n    *   错误坐标贡献：$\\dots + (p - s_{exon} + 1)$\n    差值为 $(p - s_{exon} + 1) - ((p-1) - s_{exon} + 1) = p - (p-1) = 1$。\n*   **结论：** 错误的计算引入了 $+1$ 的误差。报告的 cDNA 坐标将相对于真实坐标向上偏移 $+1$。该陈述是正确的。\n\n**判定：正确**\n\n**D. 在从 Sequence Alignment/Map (SAM) 或 Binary Alignment/Map (BAM) 比对中计算每碱基覆盖度时，将基于 $1$ 的闭合最左端位置视为基于 $0$ 的半开起始位置，将导致每个基因组位置的每碱基深度全局增加 $1$。**\n\n*   **SAM/BAM 比对：** 一个起始于基于 $1$ 位置 `POS`、读长为 $L$ 的比对，正确覆盖的区域是基于 $1$ 的区间 $[POS, POS+L-1]$。这对应于基于 $0$ 的区间 $[POS-1, POS+L-1)$。\n*   **错误假设：** 位置 `POS` 被视为一个基于 $0$ 的起始点。这意味着该比对覆盖了基于 $0$ 的区间 $[POS, POS+L)$。\n*   **分析：** 比较正确的区间 $[POS-1, POS+L-1)$ 和错误的区间 $[POS, POS+L)$，我们看到错误的区间向右（下游）移动了一个碱基。对于每一条 read，其覆盖度贡献被移动了。位置为 $POS-1$ 的碱基失去了一个计数，而位置为 $POS+L-1$ 的碱基获得了一个计数。在整个基因组上积分的总覆盖度保持不变。这是一种覆盖度的重新分布，而不是统一增加。在特定位置 $x$ 的覆盖度可能会增加、减少或保持不变，这取决于起始于 $x$ 和 $x+1$ 的 read 数量。\n*   **结论：** 关于每碱基深度全局增加 $1$ 的陈述是不正确的。\n\n**判定：不正确**\n\n**E. 对于正链外显子，未能通过设置 $S = s+1$ 和 $E = e$ 将 Browser Extensible Data (BED) 区间 $[s,e)$ 转换为 General Feature Format (GFF) 区间 $[S,E]$，将导致报告的 $5'$ 外显子边界向下游偏移 `+1` 个碱基，而 $3'$ 边界保持不变。**\n\n*   **正确转换：** 一个 BED（基于 $0$）区间 $[s,e)$ 应被转换为一个 GFF（基于 $1$）区间 $[S,E]$，其中 $S = s+1$ 且 $E = e$。\n*   **错误转换：** BED 区间 $[s,e)$ 被直接写成 GFF 区间 $[s,e]$。\n*   **边界分析（正链）：**\n    *   **5' 边界：** 真实的 5' 边界位于区间的起始处。在基于 $1$ 的坐标中，这是位置 $S = s+1$。错误的 GFF 报告的 5' 边界是位置 $s$。差值为 $s - (s+1) = -1$。从 $s+1$ 到 $s$ 的移动是向上游（朝向更小的坐标）移动，而不是向下游移动。\n    *   **3' 边界：** 真实的 3' 边界位于区间的末端。在基于 $1$ 的坐标中，这是位置 $E=e$。错误的 GFF 报告的 3' 边界是位置 $e$。此边界未变。\n*   **结论：** 尽管 3' 边界确实未变，但 5' 边界向上游移动了 $1$，而不是向下游移动 $1$。因此，该陈述是不正确的。\n\n**判定：不正确**\n\n**F. 对于 Variant Call Format (VCF) 中位于基因组位置 $p$ 且参考等位基因长度 $L > 1$ 的缺失，用于测试重叠的数学上正确的基于 $0$ 的半开区间是 $[p-1, p-1+L)$；在错误的映射 $[p, p+L)$ 下，缺失窗口向右偏移了 `+1` 个碱基，这会改变重复序列背景下的标准化和左对齐。**\n\n*   **VCF 缺失跨度：** 一个位于基于 $1$ 的位置 $p$、参考等位基因长度为 $L$ 的变异，会影响与该等位基因对应的基因组区域。该区域是基于 $1$ 的闭合区间 $[p, p+L-1]$。\n*   **正确的基于 0 的区间：** 使用转换规则（$s = S-1, e = E$），基于 $1$ 的区间 $[S,E] = [p, p+L-1]$ 转换为基于 $0$ 的半开区间 $[s,e) = [p-1, p+L-1)$。陈述给出的区间是 $[p-1, p-1+L)$，这在代数上与 $[p-1, p+L-1)$ 完全相同。陈述的第一部分是正确的。\n*   **错误映射：** 问题为缺失提出了一个类比的错误映射 $[p, p+L)$。\n*   **偏移分析：** 比较正确区间的起点 $p-1$ 和错误区间的起点 $p$，我们看到一个 $+1$ 的偏移，即 $p - (p-1) = +1$。比较终点，$(p+L-1)$ 和 $(p+L)$，我们看到错误区间的开区间终点也偏移了 $+1$。因此，整个窗口向右（下游）移动了 $1$ 个碱基。陈述的第二部分是正确的。\n*   **后果分析：** 变异标准化（包括左对齐）是确保插入缺失（indel），尤其是在重复序列中的，具有规范、无歧义表示的关键过程。此过程依赖于变异的精确基因组坐标。一个即使只将变异的表观位置移动一个碱基的错误坐标系，也会破坏标准化算法，可能导致冗余的变异检出或数据集之间的错误比较。所述的后果是准确且重要的。\n*   **结论：** 陈述的所有部分都是正确的。\n\n**判定：正确**",
            "answer": "$$\\boxed{ABCF}$$"
        },
        {
            "introduction": "在获得一个比对结果后，一个至关重要的问题是：“这个比对的置信度有多高？”。本练习将作为前面概念的综合应用，指导你推导基因组学中最重要的指标之一——作图质量（Mapping Quality, MAPQ）。你将学习如何结合比对的似然度（基于错误模型）与关于基因组结构的先验知识（如重复序列的存在），最终生成一个强大而可靠的指标来量化比对的可信度，为后续的变异检测等分析奠定坚实基础。",
            "id": "4375061",
            "problem": "考虑一个用于精准医疗的临床全基因组流程中的单端DNA测序读长。任务是通过对碱基水平的测序错误进行建模，并比较由种子-延伸比对器产生的两种竞争性比对，来量化其在参考基因组上定位的置信度。下游指标是在Phred标度上定义的比对质量（MAPQ）。\n\n一个长度为 $L = 100$ 个核苷酸的读长在每个碱基上都具有统一的Phred质量分数（Q-score）$Q = 30$。得分最高的比对假设 $\\mathcal{A}_{1}$ 将该读长与参考基因组比对，有 $k_{1} = 2$ 个错配（仅替换），而得分次高的比对假设 $\\mathcal{A}_{2}$ 将该读长与参考基因组比对，有 $k_{2} = 3$ 个错配（仅替换）。两种比对中均不存在插入和缺失。假设采用标准的独立碱基错误模型：如果在给定位置 $i$ 的比对假设是正确的，那么观测到的碱基与参考碱基匹配的概率是 $(1 - e)$，而与三个错配碱基中的任意一个匹配的概率是 $e/3$，其中 $e = 10^{-Q/10}$。假设所有碱基错误在不同位置之间是相互独立的。\n\n假设两种比对假设 $\\mathcal{A}_{1}$ 和 $\\mathcal{A}_{2}$ 的先验概率相等。为了反映基因组的重复性和索引启发式算法引入的实际不确定性，使用以下现实的先验概率和启发式上限：\n- 设读长来源于重复位点（因此多个不同的基因组位点可以产生相似的优良比对）的先验概率为 $\\pi_{r} = 10^{-3}$，来源于唯一位点的概率为 $\\pi_{u} = 1 - \\pi_{r}$。如果读长是重复的，假设错误放置的后验概率有一个保守的下界 $\\eta = \\frac{1}{2}$（即至少有另一个位点的可能性相当）。\n- 从混合后验错误概率计算出Phred标度的MAPQ后，应用一个索引不确定性上限，即取原始MAPQ和 $C_{\\text{index}} = 30$ 中的较小值。\n\n从独立的每碱基错误模型和基本概率定义出发，推导 $\\mathcal{A}_{1}$ 和 $\\mathcal{A}_{2}$ 之间的似然比，$\\mathcal{A}_{1}$ 不正确的后验概率，将其转换为MAPQ，然后应用索引上限。将最终的MAPQ表示为一个无量纲的实数。将最终答案四舍五入到三位有效数字。",
            "solution": "用户希望我解决“prompt”中描述的问题。\n\n**问题验证**\n\n**步骤1：提取已知条件**\n- 测序读长长度：$L = 100$\n- 统一Phred质量分数：$Q = 30$\n- 最佳比对假设 $\\mathcal{A}_{1}$：$k_{1} = 2$ 个错配（仅替换）\n- 次佳比对假设 $\\mathcal{A}_{2}$：$k_{2} = 3$ 个错配（仅替换）\n- 不存在插入和缺失。\n- 每碱基错误概率：$e = 10^{-Q/10}$\n- 对于位置 $i$ 的正确比对：\n    - 观测碱基与参考匹配的概率：$(1 - e)$\n    - 观测碱基为三个错配碱基中任意一个的概率：$e/3$\n- 碱基错误在各位点间独立。\n- 比对假设的先验概率：$P(\\mathcal{A}_{1}) = P(\\mathcal{A}_{2})$\n- 重复位点的先验概率：$\\pi_{r} = 10^{-3}$\n- 唯一位点的先验概率：$\\pi_{u} = 1 - \\pi_{r}$\n- 如果位点是重复的，错误放置的后验概率至少为 $\\eta = \\frac{1}{2}$。\n- 索引不确定性上限：$C_{\\text{index}} = 30$\n- 最终答案需四舍五入至三位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学性：** 该问题牢固地植根于生物信息学和基因组诊断的原理。它使用了标准的、成熟的模型：用于测序错误的Phred标度、独立的每碱基错误模型、用于比较比对假设的贝叶斯推断以及比对质量（MAPQ）的定义。包含重复区域的先验概率和启发式上限反映了生产级比对软件所处理的现实复杂性。该问题在科学上和事实上都是合理的。\n- **适定性：** 所有必要的变量、常数和模型都已明确给出。目标清晰地陈述为：经过一系列指定步骤后计算最终的MAPQ。该问题是自洽的，并允许推导出唯一、稳定的解。\n- **客观性：** 该问题使用精确、定量和无偏见的语言陈述。定义中没有主观因素或模糊之处。\n\n**步骤3：结论与行动**\n该问题是有效的，因为它在科学上是合理的、适定的和客观的。我将继续进行求解。\n\n**求解推导**\n\n主要目标是计算比对质量（MAPQ），即最佳比对 $\\mathcal{A}_{1}$ 不正确的Phred标度后验概率。计算涉及几个步骤，从碱基水平的错误模型开始，并结合来自比对模糊性和基因组重复性的不确定性。\n\n**1. 每碱基错误概率**\nPhred质量分数 $Q$ 通过定义 $e = 10^{-Q/10}$ 与碱基检出错误概率 $e$ 相关联。\n给定 $Q = 30$，在任何给定碱基上的错误概率为：\n$$e = 10^{-30/10} = 10^{-3} = 0.001$$\n\n**2. 比对假设的似然**\n令 $D$ 表示观测到的测序读长数据。我们需要计算在给定比对假设 $\\mathcal{A}_{i}$ 的条件下观测到 $D$ 的似然，记为 $P(D | \\mathcal{A}_{i})$。一个比对假设 $\\mathcal{A}_i$ 将长度为 $L$ 的读长放置在特定的基因组位点上，有 $k_i$ 个错配和 $L-k_i$ 个匹配。\n\n根据所提供的错误模型：\n- 在比对指示为匹配的位置，观测到匹配碱基的概率为 $(1-e)$。\n- 在比对指示为错配的位置，观测到一个特定的错误碱基。这种特定替换的概率给定为 $e/3$。\n\n由于碱基错误是独立的，整个比对的似然是每个位置概率的乘积。对于一个有 $k_i$ 个错配的比对 $\\mathcal{A}_i$：\n$$P(D | \\mathcal{A}_i) = (1-e)^{L-k_i} \\left(\\frac{e}{3}\\right)^{k_i}$$\n\n对于两种竞争性假设：\n- 对于 $\\mathcal{A}_1$，$L=100$ 且 $k_1=2$：\n$$P(D | \\mathcal{A}_1) = (1-e)^{100-2} \\left(\\frac{e}{3}\\right)^{2} = (1-e)^{98} \\left(\\frac{e}{3}\\right)^{2}$$\n- 对于 $\\mathcal{A}_2$，$L=100$ 且 $k_2=3$：\n$$P(D | \\mathcal{A}_2) = (1-e)^{100-3} \\left(\\frac{e}{3}\\right)^{3} = (1-e)^{97} \\left(\\frac{e}{3}\\right)^{3}$$\n\n**3. 似然比**\n我们计算次佳比对假设与最佳比对假设的似然比：\n$$\\frac{P(D | \\mathcal{A}_2)}{P(D | \\mathcal{A}_1)} = \\frac{(1-e)^{97} (e/3)^{3}}{(1-e)^{98} (e/3)^{2}} = \\frac{e/3}{1-e}$$\n\n**4. 错误后验概率（比对模糊性）**\n为了找到最佳比对 $\\mathcal{A}_1$ 不正确的概率，我们首先考虑一个简化的情形，即唯一的备选方案由 $\\mathcal{A}_2$ 捕获。设这个条件错误概率为 $P_{\\text{err, align}}$。使用贝叶斯定理和给定的相等先验概率（$P(\\mathcal{A}_1) = P(\\mathcal{A}_2)$），$\\mathcal{A}_1$ 正确的后验概率为：\n$$P(\\mathcal{A}_1 | D) = \\frac{P(D | \\mathcal{A}_1) P(\\mathcal{A}_1)}{P(D | \\mathcal{A}_1) P(\\mathcal{A}_1) + P(D | \\mathcal{A}_2) P(\\mathcal{A}_2)} = \\frac{P(D | \\mathcal{A}_1)}{P(D | \\mathcal{A}_1) + P(D | \\mathcal{A}_2)}$$\n分子和分母同除以 $P(D | \\mathcal{A}_1)$：\n$$P(\\mathcal{A}_1 | D) = \\frac{1}{1 + \\frac{P(D | \\mathcal{A}_2)}{P(D | \\mathcal{A}_1)}}$$\n$\\mathcal{A}_1$ 不正确的概率（即在这个双假设世界中 $\\mathcal{A}_2$ 是正确的）是 $P_{\\text{err, align}} = 1 - P(\\mathcal{A}_1 | D)$：\n$$P_{\\text{err, align}} = 1 - \\frac{1}{1 + \\frac{P(D | \\mathcal{A}_2)}{P(D | \\mathcal{A}_1)}} = \\frac{\\frac{P(D | \\mathcal{A}_2)}{P(D | \\mathcal{A}_1)}}{1 + \\frac{P(D | \\mathcal{A}_2)}{P(D | \\mathcal{A}_1)}}$$\n代入似然比：\n$$P_{\\text{err, align}} = \\frac{\\frac{e/3}{1-e}}{1 + \\frac{e/3}{1-e}} = \\frac{e/3}{1-e+e/3} = \\frac{e/3}{1 - 2e/3}$$\n\n**5. 总后验错误概率**\n最终的错误概率必须考虑关于基因组结构（唯一位点 vs. 重复位点）的先验知识。我们使用全概率定律。设 $E$ 为比对 $\\mathcal{A}_1$ 不正确的事件。设 $U$ 为读长源于唯一位点的事件， $R$ 为其源于重复位点的事件。\n$$P(E) = P(E|U)P(U) + P(E|R)P(R)$$\n- $P(U) = \\pi_u = 1 - \\pi_r$ 是唯一位点的先验概率。\n- $P(R) = \\pi_r = 10^{-3}$ 是重复位点的先验概率。\n- $P(E|U) = P_{\\text{err, align}}$ 是如果位点是唯一的，错误发生的概率，此处的错误纯粹由与另一位点的偶然相似性引起。\n- $P(E|R) = \\eta = \\frac{1}{2}$ 是如果位点是重复的，给定的保守错误概率。\n\n总后验错误概率 $P_{\\text{err, total}}$ 为：\n$$P_{\\text{err, total}} = P_{\\text{err, align}} \\cdot \\pi_u + \\eta \\cdot \\pi_r$$\n\n**6. 数值计算**\n我们代入给定的值：\n- $e = 10^{-3} = 0.001$\n- $\\pi_r = 10^{-3} = 0.001$\n- $\\pi_u = 1 - 0.001 = 0.999$\n- $\\eta = 0.5$\n\n首先，计算 $P_{\\text{err, align}}$：\n$$P_{\\text{err, align}} = \\frac{0.001/3}{1 - 2(0.001)/3} = \\frac{0.001/3}{1 - 0.002/3} = \\frac{0.001/3}{(3-0.002)/3} = \\frac{0.001}{2.998}$$\n现在，计算 $P_{\\text{err, total}}$：\n$$P_{\\text{err, total}} = \\left(\\frac{0.001}{2.998}\\right) \\cdot (0.999) + (0.5) \\cdot (0.001)$$\n$$P_{\\text{err, total}} = \\frac{0.000999}{2.998} + 0.0005 \\approx 0.000333222 + 0.0005 = 0.000833222$$\n\n**7. MAPQ计算与上限处理**\n原始MAPQ使用Phred标度公式计算：\n$$\\text{MAPQ}_{\\text{raw}} = -10 \\log_{10}(P_{\\text{err, total}})$$\n$$\\text{MAPQ}_{\\text{raw}} = -10 \\log_{10}(0.000833222) \\approx -10(-3.0792) \\approx 30.792$$\n问题指定了一个索引不确定性上限 $C_{\\text{index}} = 30$。最终的MAPQ是原始计算值和上限值中的较小者。\n$$\\text{MAPQ}_{\\text{final}} = \\min(\\text{MAPQ}_{\\text{raw}}, C_{\\text{index}})$$\n$$\\text{MAPQ}_{\\text{final}} = \\min(30.792, 30) = 30$$\n\n**8. 最终答案格式化**\n问题要求答案是一个四舍五入到三位有效数字的实数。计算出的值恰好是 $30$。为了用三位有效数字表示，我们写作 $30.0$。",
            "answer": "$$\\boxed{30.0}$$"
        }
    ]
}