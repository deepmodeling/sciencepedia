{
    "hands_on_practices": [
        {
            "introduction": "在临床实践中，我们不断根据新出现的信息更新我们对患者病情的判断。这个过程可以通过贝叶斯定理进行数学化描述，它是循证医学的基石。本练习将通过一个典型场景——在CT扫描中发现腹腔游离气体——来实践如何利用似然比（likelihood ratio）将一个初始的临床怀疑（术前概率）转化为一个更为精确的诊断结论（术后概率）。",
            "id": "5134425",
            "problem": "一名患者因左下腹痛和白细胞增多就诊，临床怀疑患有结肠憩室炎。在影像学检查之前，通过多学科风险分层（结合临床严重程度、血流动力学和实验室标志物）估计，需要手术治疗的穿孔的检验前概率为 $0.15$（以小数表示）。随后进行了计算机断层扫描（CT），结果显示腹腔内存在游离气体。对于“需要手术的穿孔”这一假设，该CT发现的诊断性能的特点是其阳性似然比（$LR_{+}$）为 $LR_{+} = 8$。\n\n从贝叶斯定理的基本定义、概率与优势比之间的关系出发，并利用以条件概率定义的阳性似然比，推导在观察到CT游离气体后“需要手术的穿孔”的检验后概率的解析表达式。然后，利用给定的 $LR_{+}$ 和检验前概率 $0.15$ 计算该表达式的值。\n\n将最终概率表示为小数，并将答案四舍五入到 $4$ 位有效数字。不要使用百分号。",
            "solution": "该问题是有效的，因为它在科学上基于概率论和医学诊断学，问题提出得当，有足够的信息得出唯一解，并且陈述客观。\n\n设 $H$ 表示患者“需要手术的穿孔”这一假设，设 $E$ 表示证据，即“在CT上观察到腹腔内游离气体”。\n\n已知条件如下：\n- 假设的检验前概率 $P(H)$ 为 $0.15$。\n- 与证据 $E$ 相关的、支持假设 $H$ 的阳性似然比 $LR_{+}$ 为 $8$。\n\n目标是推导检验后概率 $P(H|E)$ 的解析表达式，然后计算其数值。推导将按照要求从基本定义开始。\n\n概率 $p$ 和优势比 $O$ 之间的关系由下式给出：\n$$ O = \\frac{p}{1-p} $$\n反之，概率可以用优势比表示：\n$$ p = \\frac{O}{1+O} $$\n\n检验前优势比 $O_{pre}$ 是在观察到证据 $E$ 之前，假设 $H$ 为真的优势比。\n$$ O_{pre} = \\frac{P(H)}{P(\\neg H)} = \\frac{P(H)}{1-P(H)} $$\n其中 $P(\\neg H)$ 是假设 $H$ 为假的概率。\n\n检验后优势比 $O_{post}$ 是在观察到证据 $E$ 之后，假设 $H$ 为真的优势比。\n$$ O_{post} = \\frac{P(H|E)}{P(\\neg H|E)} $$\n\n根据贝叶斯定理，$H$ 和 $\\neg H$ 的检验后概率为：\n$$ P(H|E) = \\frac{P(E|H) P(H)}{P(E)} $$\n$$ P(\\neg H|E) = \\frac{P(E|\\neg H) P(\\neg H)}{P(E)} $$\n通过计算这两个表达式的比值，我们可以表示出检验后优势比：\n$$ O_{post} = \\frac{P(H|E)}{P(\\neg H|E)} = \\frac{P(E|H) P(H) / P(E)}{P(E|\\neg H) P(\\neg H) / P(E)} = \\left(\\frac{P(E|H)}{P(E|\\neg H)}\\right) \\left(\\frac{P(H)}{P(\\neg H)}\\right) $$\n该乘积中的第一项是阳性似然比 $LR_{+}$ 的定义。第二项是检验前优势比 $O_{pre}$。\n$$ LR_{+} = \\frac{P(E|H)}{P(E|\\neg H)} $$\n因此，我们得到了基本关系式：\n$$ O_{post} = LR_{+} \\times O_{pre} $$\n\n为了求出检验后概率 $P(H|E)$，我们首先用检验前概率 $p_{pre} = P(H)$ 和给定的 $LR_{+}$ 来表示检验后优势比。\n$$ O_{post} = LR_{+} \\times \\frac{p_{pre}}{1-p_{pre}} $$\n接下来，我们将检验后优势比转换回概率，记为 $p_{post} = P(H|E)$。\n$$ p_{post} = \\frac{O_{post}}{1+O_{post}} $$\n代入 $O_{post}$ 的表达式，我们得到所要求的检验后概率的解析表达式：\n$$ p_{post} = \\frac{LR_{+} \\times \\frac{p_{pre}}{1-p_{pre}}}{1 + LR_{+} \\times \\frac{p_{pre}}{1-p_{pre}}} $$\n这是在给定阳性发现及其相关似然比的情况下，更新概率的通用公式。\n\n现在，我们用给定的值 $p_{pre} = 0.15$ 和 $LR_{+} = 8$ 来计算这个表达式。\n\n首先，我们计算检验前优势比：\n$$ O_{pre} = \\frac{0.15}{1 - 0.15} = \\frac{0.15}{0.85} = \\frac{15}{85} = \\frac{3}{17} $$\n\n接下来，我们使用似然比计算检验后优势比：\n$$ O_{post} = LR_{+} \\times O_{pre} = 8 \\times \\frac{3}{17} = \\frac{24}{17} $$\n\n最后，我们将检验后优势比转换回概率：\n$$ p_{post} = P(H|E) = \\frac{O_{post}}{1+O_{post}} = \\frac{\\frac{24}{17}}{1 + \\frac{24}{17}} = \\frac{\\frac{24}{17}}{\\frac{17}{17} + \\frac{24}{17}} = \\frac{\\frac{24}{17}}{\\frac{41}{17}} = \\frac{24}{41} $$\n\n为了得到最终的数值答案，我们计算这个分数的值，并将其四舍五入到 $4$ 位有效数字。\n$$ \\frac{24}{41} \\approx 0.58536585... $$\n四舍五入到 $4$ 位有效数字得到 $0.5854$。\n在CT上观察到游离气体后，“需要手术的穿孔”的检验后概率约为 $0.5854$。",
            "answer": "$$\\boxed{0.5854}$$"
        },
        {
            "introduction": "临床决策往往需要整合多个变量。本练习将指导您从原始的放射学数据（如结肠壁厚度和脂肪间隙炎性改变）出发，构建一个逻辑回归模型来预测手术指征。此实践的核心不仅在于模型构建，更在于如何根据假阳性（$C_{\\mathrm{FP}}$）和假阴性（$C_{\\mathrm{FN}}$）的相对成本来校准决策阈值，这是将统计模型转化为实际临床策略的关键一步。",
            "id": "5134411",
            "problem": "构建一个二元决策模型，利用源自计算机断层扫描 (CT) 的放射学特征，为憩室病推荐手术治疗或非手术治疗。该模型应整合结肠周脂肪条索范围和结肠壁厚度，以预测患者是否满足手术指征，然后根据期望效用的第一性原理校准决策阈值。\n\n将模型建立在以下普遍接受的原则之上：\n- 二元结果可以建模为伯努利随机变量，其参数 $p$ 代表阳性事件的概率。\n- 逻辑回归是一种经过充分检验的方法，通过逻辑函数将线性预测器映射到概率，将任何实值输入 $z$ 转换为 $p = \\dfrac{1}{1 + e^{-z}}$。\n- 在不确定性下的二元选择决策分析建议选择能最小化期望损失的行动。设假阳性成本为 $C_{\\mathrm{FP}}$，假阴性成本为 $C_{\\mathrm{FN}}$。当模型输出 $p$ 是一个校准后的概率时，最小化期望损失的阈值为 $p_{\\mathrm{t}} = \\dfrac{C_{\\mathrm{FP}}}{C_{\\mathrm{FP}} + C_{\\mathrm{FN}}}$，如果 $p \\ge p_{\\mathrm{t}}$，则决策为阳性。\n\n您必须：\n- 训练一个包含截距项和两个特征的逻辑回归模型：$x_1$ 等于脂肪条索范围（毫米），$x_2$ 等于结肠壁厚度（毫米）。$x_1$ 和 $x_2$ 的单位均为 $\\mathrm{mm}$。\n- 通过在训练数据上最大化伯努利对数似然来估计参数（您可以添加 $\\ell_2$ 正则化以提高数值稳定性），并在拟合前使用训练集统计数据对特征进行标准化。\n- 对于每个测试用例，计算预测概率 $\\hat{p}$，根据给定的 $C_{\\mathrm{FP}}$ 和 $C_{\\mathrm{FN}}$ 计算阈值 $p_{\\mathrm{t}}$，并使用规则 $\\hat{p} \\ge p_{\\mathrm{t}}$ 意味着手术来输出一个关于手术的布尔值建议。在相等的情况下，将其视为阳性决策（手术）。\n\n所有输入均在下方提供。训练数据集是一个三元组 $(x_1, x_2, y)$ 列表，其中 $x_1$ 和 $x_2$ 的单位是 $\\mathrm{mm}$，$y \\in \\{0,1\\}$ 表示金标准裁定是否指示需要手术。请使用此训练集：\n- $(4, 4, 0)$\n- $(6, 4, 0)$\n- $(8, 5, 0)$\n- $(10, 5, 0)$\n- $(12, 6, 0)$\n- $(14, 6, 0)$\n- $(18, 7, 1)$\n- $(20, 8, 1)$\n- $(22, 8, 1)$\n- $(24, 9, 1)$\n- $(28, 10, 1)$\n- $(32, 12, 1)$\n- $(36, 13, 1)$\n- $(40, 14, 1)$\n\n定义以下患者情景的测试套件。每个测试用例是一个四元组 $(x_1, x_2, C_{\\mathrm{FP}}, C_{\\mathrm{FN}})$；$x_1$ 和 $x_2$ 的单位是 $\\mathrm{mm}$，$C_{\\mathrm{FP}}$ 和 $C_{\\mathrm{FN}}$ 是表示相对成本的非负实数：\n- 测试 $1$：$(28, 10, 1, 1)$\n- 测试 $2$：$(16, 7, 1, 4)$\n- 测试 $3$：$(14, 6, 4, 1)$\n- 测试 $4$：$(36, 13, 4, 1)$\n- 测试 $5$：$(2, 4, 1, 1)$\n\n您的程序必须：\n- 仅在训练数据上训练模型，使用从训练数据计算得出的特征标准化方法。\n- 对于每个测试用例，计算 $\\hat{p}$，计算 $p_{\\mathrm{t}} = \\dfrac{C_{\\mathrm{FP}}}{C_{\\mathrm{FP}} + C_{\\mathrm{FN}}}$，并使用规则 $\\hat{p} \\ge p_{\\mathrm{t}}$ 输出一个关于手术的布尔值建议。\n- 生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如，`[True,False,True]`）。该列表必须按顺序包含测试 1 到测试 5 的布尔决策。\n\n所有涉及测量的量都必须使用上述以 $\\mathrm{mm}$ 为单位的单位。不涉及角度或其他物理单位。最终输出为布尔值；无需额外格式化。",
            "solution": "该问题是有效的。它在科学上基于统计建模（逻辑回归）和决策理论（期望效用/损失最小化）的既定原则。问题提法明确，提供了所有必要的数据（训练集、测试用例）、一个明确的目标（最大化对数似然）和一个毫不含糊的决策规则。术语精确，设置内部一致且客观。因此，我们可以着手解决。\n\n目标是为憩室病手术推荐构建并应用一个二元决策模型。这将分四个阶段完成：\n1.  **模型构建**：基于提供的放射学特征定义一个逻辑回归模型。\n2.  **特征标准化**：使用从训练数据中得出的统计数据来标准化输入特征，以改善模型训练和性能。\n3.  **参数估计**：通过找到在训练数据上最大化正则化对数似然的参数来训练模型。这是一个数值优化任务。\n4.  **决策制定**：将训练好的模型应用于新案例，使用源自期望损失最小化原则的决策阈值。\n\n**1. 模型构建**\n\n该问题需要一个二元决策（手术 vs. 非手术治疗）。对于患者 $i$，其结果表示为 $y_i$，是一个伯努利随机变量，其中 $y_i=1$ 表示有手术指征，$y_i=0$ 表示无手术指征。阳性结果的概率被建模为两个特征的函数：$x_1$（结肠周脂肪条索范围，单位 $\\mathrm{mm}$）和 $x_2$（结肠壁厚度，单位 $\\mathrm{mm}$）。\n\n我们使用逻辑回归将特征映射到这个概率。该模型使用逻辑（sigmoid）函数 $\\sigma(z)$ 来预测手术概率 $p = P(Y=1|\\mathbf{x})$：\n$$p = \\sigma(z) = \\frac{1}{1 + e^{-z}}$$\nsigmoid 函数的输入 $z$ 是输入特征和截距项的线性组合：\n$$z = w_0 + w_1 x_{1,std} + w_2 x_{2,std}$$\n此处，$\\mathbf{w} = (w_0, w_1, w_2)^T$ 是我们需要估计的模型参数（权重）向量，$x_{j,std}$ 是标准化后的特征。\n\n**2. 特征标准化**\n\n在模型训练之前，特征被标准化为均值为 0，标准差为 1。这种变换对于训练模型所使用的优化算法的稳定性和效率至关重要。标准化参数（每个特征 $j$ 的均值 $\\mu_j$ 和标准差 $\\sigma_j$）*仅*根据训练数据计算。对于任何给定的特征值 $x_j$，其标准化值为：\n$$x_{j,std} = \\frac{x_j - \\mu_j}{\\sigma_j}$$\n特征的训练数据为：\n$X_1 = \\{4, 6, 8, 10, 12, 14, 18, 20, 22, 24, 28, 32, 36, 40\\}$\n$X_2 = \\{4, 4, 5, 5, 6, 6, 7, 8, 8, 9, 10, 12, 13, 14\\}$\n\n均值为：\n$\\mu_1 = \\frac{1}{14}\\sum_{i=1}^{14} x_{1,i} = \\frac{274}{14} \\approx 19.571$\n$\\mu_2 = \\frac{1}{14}\\sum_{i=1}^{14} x_{2,i} = \\frac{121}{14} \\approx 8.643$\n\n标准差（分母使用 $N$）为：\n$\\sigma_1 = \\sqrt{\\frac{1}{14}\\sum_{i=1}^{14} (x_{1,i} - \\mu_1)^2} \\approx 11.240$\n$\\sigma_2 = \\sqrt{\\frac{1}{14}\\sum_{i=1}^{14} (x_{2,i} - \\mu_2)^2} \\approx 3.230$\n这些 $\\mu_1, \\sigma_1, \\mu_2, \\sigma_2$ 的值将用于标准化训练数据和后续的测试数据。\n\n**3. 参数估计（模型训练）**\n\n最优参数 $\\mathbf{w}$ 是通过最大化观测到训练数据结果的似然来找到的。对于一组 $N$ 个独立观测值 $\\{(x_{i,1}, x_{i,2}, y_i)\\}_{i=1}^N$，逻辑回归的对数似然函数为：\n$$L(\\mathbf{w}) = \\sum_{i=1}^{N} \\left[ y_i \\log(p_i) + (1-y_i) \\log(1-p_i) \\right]$$\n其中 $p_i = \\sigma(w_0 + w_1 x_{i,1,std} + w_2 x_{i,2,std})$。\n\n为防止过拟合并确保数值稳定性，会添加一个正则化项。问题指定了 $\\ell_2$ 正则化，它惩罚较大的权重值。目标于是变为最小化负对数似然加上正则化惩罚项。我们将不对截距项 $w_0$ 进行正则化，这是标准做法。\n$$J(\\mathbf{w}) = -\\frac{1}{N}L(\\mathbf{w}) + \\frac{\\alpha}{2}(w_1^2 + w_2^2)$$\n这个优化问题是凸的，可以使用数值方法高效求解。我们将使用一个基于梯度的优化器（例如 BFGS）来找到最小化 $J(\\mathbf{w})$ 的权重 $\\mathbf{w}$。成本函数关于权重的梯度是：\n$$\\nabla_{\\mathbf{w}} J = \\frac{1}{N} \\mathbf{X}_{aug}^T (\\mathbf{p} - \\mathbf{y}) + \\alpha \\mathbf{w'}$$\n其中 $\\mathbf{X}_{aug}$ 是为截距项增广了一个全为1的列的标准化特征设计矩阵，$\\mathbf{p}$ 是预测概率向量，$\\mathbf{y}$ 是真实标签向量，$\\mathbf{w'} = (0, w_1, w_2)^T$ 是用于惩罚的权重向量。\n\n**4. 通过期望损失最小化进行决策**\n\n对于每个测试用例，训练好的模型会生成一个预测概率 $\\hat{p}$，表示手术的适用性。然后必须做出决策。这个决策由决策理论指导，具体来说是通过最小化期望损失。\n\n设 $C_{\\mathrm{FP}}$ 为假阳性（在不应手术时推荐手术）的成本，$C_{\\mathrm{FN}}$ 为假阴性（在应手术时未推荐手术）的成本。\n对于一个具有特征 $\\mathbf{x}$ 的给定患者，模型预测 $\\hat{p} = P(Y=1|\\mathbf{x})$。因此，$P(Y=0|\\mathbf{x}) = 1-\\hat{p}$。\n\n推荐手术的期望损失是：\n$E[\\text{Loss(Surgery)}] = C_{\\mathrm{FP}} \\cdot P(Y=0|\\mathbf{x}) = C_{\\mathrm{FP}}(1-\\hat{p})$\n不推荐手术的期望损失是：\n$E[\\text{Loss(No Surgery)}] = C_{\\mathrm{FN}} \\cdot P(Y=1|\\mathbf{x}) = C_{\\mathrm{FN}}\\hat{p}$\n\n一个最优决策规则是选择期望损失最小的行动。我们推荐手术，如果：\n$E[\\text{Loss(Surgery)}] \\le E[\\text{Loss(No Surgery)}]$\n$C_{\\mathrm{FP}}(1-\\hat{p}) \\le C_{\\mathrm{FN}}\\hat{p}$\n$C_{\\mathrm{FP}} \\le \\hat{p}(C_{\\mathrm{FP}} + C_{\\mathrm{FN}})$\n$$\\hat{p} \\ge \\frac{C_{\\mathrm{FP}}}{C_{\\mathrm{FP}} + C_{\\mathrm{FN}}}$$\n\n这得出了决策阈值 $p_t = \\frac{C_{\\mathrm{FP}}}{C_{\\mathrm{FP}} + C_{\\mathrm{FN}}}$。如果模型的预测概率 $\\hat{p}$ 大于或等于此阈值，则推荐手术。\n\n对于每个测试用例 $(x_1, x_2, C_{\\mathrm{FP}}, C_{\\mathrm{FN}})$，我们将：\n1.  使用训练集中的均值和标准差对特征 $(x_1, x_2)$ 进行标准化。\n2.  使用训练好的逻辑回归模型计算预测概率 $\\hat{p}$。\n3.  根据给定的成本 $C_{\\mathrm{FP}}$ 和 $C_{\\mathrm{FN}}$ 计算决策阈值 $p_t$。\n4.  如果 $\\hat{p} \\ge p_t$，则返回 `True`（手术），否则返回 `False`。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Constructs a logistic regression model for surgical decision-making in\n    diverticular disease, trains it on provided data, and applies it to test cases\n    using a decision threshold derived from expected loss minimization.\n    \"\"\"\n    # Training data: (x1, x2, y)\n    # x1: pericolic fat stranding (mm)\n    # x2: colonic wall thickness (mm)\n    # y: 1 if surgery indicated, 0 otherwise\n    training_data = np.array([\n        [4, 4, 0],\n        [6, 4, 0],\n        [8, 5, 0],\n        [10, 5, 0],\n        [12, 6, 0],\n        [14, 6, 0],\n        [18, 7, 1],\n        [20, 8, 1],\n        [22, 8, 1],\n        [24, 9, 1],\n        [28, 10, 1],\n        [32, 12, 1],\n        [36, 13, 1],\n        [40, 14, 1]\n    ], dtype=float)\n\n    # Test cases: (x1, x2, C_FP, C_FN)\n    # C_FP: cost of false positive\n    # C_FN: cost of false negative\n    test_cases = [\n        (28, 10, 1, 1),\n        (16, 7, 1, 4),\n        (14, 6, 4, 1),\n        (36, 13, 4, 1),\n        (2, 4, 1, 1)\n    ]\n\n    # Step 1: Prepare data and compute standardization parameters\n    X_train = training_data[:, :2]\n    y_train = training_data[:, 2]\n    \n    means = np.mean(X_train, axis=0)\n    stds = np.std(X_train, axis=0)\n    \n    # Standardize features\n    X_train_std = (X_train - means) / stds\n    \n    # Add intercept column (a column of ones)\n    X_train_aug = np.hstack([np.ones((X_train.shape[0], 1)), X_train_std])\n    \n    # Step 2: Define the logistic regression model and cost function\n    def sigmoid(z):\n        return 1 / (1 + np.exp(-z))\n\n    def cost_function(w, X, y, alpha):\n        # N = number of samples\n        N = len(y)\n        z = X @ w\n        p = sigmoid(z)\n        # To avoid log(0) errors\n        p = np.clip(p, 1e-10, 1 - 1e-10)\n        \n        # Negative log-likelihood\n        log_likelihood = -np.sum(y * np.log(p) + (1 - y) * np.log(1 - p))\n        \n        # L2 regularization (excluding intercept w[0])\n        l2_penalty = (alpha / 2) * np.sum(w[1:]**2)\n        \n        return log_likelihood + l2_penalty\n\n    def gradient(w, X, y, alpha):\n        N = len(y)\n        z = X @ w\n        p = sigmoid(z)\n        \n        # Gradient of the negative log-likelihood\n        grad_log_likelihood = X.T @ (p - y)\n        \n        # Gradient of the L2 penalty\n        # Create a copy of w, set intercept to 0 for regularization grad\n        w_reg = w.copy()\n        w_reg[0] = 0\n        grad_penalty = alpha * w_reg\n        \n        return grad_log_likelihood + grad_penalty\n\n    # Step 3: Train the model by minimizing the cost function\n    initial_weights = np.zeros(X_train_aug.shape[1])\n    # Regularization strength alpha. A small non-zero value for stability.\n    alpha = 0.1 \n    \n    # Using 'BFGS' which is a standard quasi-Newton method\n    result = minimize(\n        cost_function,\n        initial_weights,\n        args=(X_train_aug, y_train, alpha),\n        method='BFGS',\n        jac=gradient\n    )\n    \n    optimal_weights = result.x\n\n    # Step 4: Process test cases\n    recommendations = []\n    for x1, x2, c_fp, c_fn in test_cases:\n        # Standardize the test features using training set statistics\n        x_test = np.array([x1, x2])\n        x_test_std = (x_test - means) / stds\n        \n        # Add intercept term\n        x_test_aug = np.concatenate(([1], x_test_std))\n        \n        # Compute predicted probability\n        z_pred = x_test_aug @ optimal_weights\n        p_hat = sigmoid(z_pred)\n        \n        # Compute decision threshold\n        if c_fp + c_fn == 0:\n            # Undefined case, but handle defensively.\n            # A rational agent might default to the less risky action.\n            # If both costs are 0, any decision is fine. We take False.\n            p_t = np.inf \n        else:\n            p_t = c_fp / (c_fp + c_fn)\n            \n        # Make the decision\n        decision = p_hat >= p_t\n        recommendations.append(decision)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, recommendations))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "当一个有效的预测模型已经建立，我们如何将其应用于临床？本练习展示了预测模型的双重效用：首先，用于理解群体层面的结果，即计算整个队列的非手术治疗预期成功率；其次，用于实现个体化医疗，即根据特定患者的风险因素（脓肿大小和合并症）确定一个精确的手术干预阈值。通过这个练习，您将学会如何利用一个给定的概率模型，从群体分析深入到个体决策。",
            "id": "5134455",
            "problem": "一个外科团队采用初始非手术治疗（静脉注射抗生素，联合或不联合经皮引流）来管理患有Hinchey Ib–II级憩室脓肿的成年患者，而早期手术干预则保留给那些失败风险高的患者。假设以下基于经验的模型，该模型与乘性风险聚合一致：对于一个脓肿最大直径为$s$（单位为$\\mathrm{cm}$）、整数合并症数量为$c$（代表加权合并症条件的数量，近似于Charlson合并症指数结构）的患者，其非手术治疗的成功概率为\n$$\nP_{\\mathrm{succ}}(s,c)=\\exp\\!\\left(-\\lambda_{s}\\,s-\\lambda_{c}\\,c\\right),\n$$\n其中$\\lambda_{s}>0$和$\\lambda_{c}>0$分别捕捉了脓肿大小和合并症负担对非手术治疗成功率的边际负面影响。在一个当代队列中，假设脓肿大小$S$与合并症数量$C$相互独立，其中$S\\sim \\mathrm{Exponential}(k_{s})$（率参数为$k_{s}$，单位为$\\mathrm{cm}^{-1}$），而$C\\sim \\mathrm{Poisson}(\\mu_{c})$（均值为$\\mu_{c}$）。为了进行决策，将预测失败概率定义为$P_{\\mathrm{fail}}(s,c)=1-P_{\\mathrm{succ}}(s,c)$。该医疗服务部门采纳了一项政策，即当预测的失败概率超过一个预定义的决策阈值$T$时，便进行早期手术干预。该阈值$T$的选择旨在反映基于当前证据的可接受风险。\n\n使用参数值$k_{s}=0.25$，$\\mu_{c}=2$，$\\lambda_{s}=0.09$，$\\lambda_{c}=0.27$和$T=0.70$：\n- 计算队列水平的预期非手术成功概率$\\mathbb{E}[P_{\\mathrm{succ}}(S,C)]$。\n- 对于合并症数量固定为$c^{\\star}=3$的患者，确定最小的脓肿直径阈值$s^{\\star}$（单位为$\\mathrm{cm}$），使得$P_{\\mathrm{fail}}(s,c^{\\star})\\geq T$。\n\n将您的最终答案表示为一个行向量，其中包含按顺序排列的两个量$\\big(\\mathbb{E}[P_{\\mathrm{succ}}(S,C)],\\,s^{\\star}\\big)$。将两个条目均四舍五入至$4$位有效数字。在您的计算过程中，请用$\\mathrm{cm}$表示大小阈值$s^{\\star}$，但在最终的方框答案中不要包含单位。",
            "solution": "用户提供了一个在临床背景下的应用概率和统计建模领域的适定问题。所有必要的参数和分布都已定义，问题具有科学依据且内部一致。因此，它被认为是一个有效的问题。解决方案需要计算两个量：一个队列的期望值和一个特定案例的决策阈值。\n\n第一个任务是计算队列水平的预期非手术成功概率$\\mathbb{E}[P_{\\mathrm{succ}}(S,C)]$。对于给定的脓肿大小$s$和合并症数量$c$，成功概率为$P_{\\mathrm{succ}}(s,c)=\\exp(-\\lambda_{s} s - \\lambda_{c} c)$。这可以分解为$P_{\\mathrm{succ}}(s,c) = \\exp(-\\lambda_{s} s) \\exp(-\\lambda_{c} c)$。\n脓肿大小的随机变量$S$和合并症数量的随机变量$C$被假定为独立的。因此，它们乘积函数的期望等于它们各自期望的乘积：\n$$\n\\mathbb{E}[P_{\\mathrm{succ}}(S,C)] = \\mathbb{E}[\\exp(-\\lambda_{s} S) \\exp(-\\lambda_{c} C)] = \\mathbb{E}[\\exp(-\\lambda_{s} S)] \\, \\mathbb{E}[\\exp(-\\lambda_{c} C)]\n$$\n我们分别计算每个期望项。\n\n第一项$\\mathbb{E}[\\exp(-\\lambda_{s} S)]$涉及随机变量$S \\sim \\mathrm{Exponential}(k_{s})$。这个期望是指数分布的矩母函数（MGF）的一个应用。随机变量$X$的MGF是$M_X(t) = \\mathbb{E}[\\exp(tX)]$。对于$S \\sim \\mathrm{Exponential}(k_{s})$，其MGF为$M_S(t) = \\frac{k_{s}}{k_{s}-t}$，定义域为$t < k_{s}$。我们需要在$t = -\\lambda_s$处求值。由于$\\lambda_s > 0$且$k_s > 0$，条件$-\\lambda_s < k_s$是满足的。\n$$\n\\mathbb{E}[\\exp(-\\lambda_{s} S)] = M_S(-\\lambda_{s}) = \\frac{k_{s}}{k_{s}-(-\\lambda_{s})} = \\frac{k_{s}}{k_{s}+\\lambda_{s}}\n$$\n\n第二项$\\mathbb{E}[\\exp(-\\lambda_{c} C)]$涉及随机变量$C \\sim \\mathrm{Poisson}(\\mu_{c})$。这可以使用泊松分布的MGF来计算，其MGF为$M_C(t) = \\exp(\\mu_c(\\exp(t)-1))$。我们在$t = -\\lambda_c$处求值。\n$$\n\\mathbb{E}[\\exp(-\\lambda_{c} C)] = M_C(-\\lambda_{c}) = \\exp(\\mu_c(\\exp(-\\lambda_c)-1))\n$$\n\n结合这两个结果，总的预期成功概率是：\n$$\n\\mathbb{E}[P_{\\mathrm{succ}}(S,C)] = \\left(\\frac{k_{s}}{k_{s}+\\lambda_{s}}\\right) \\exp\\left(\\mu_c(\\exp(-\\lambda_c)-1)\\right)\n$$\n代入给定的参数值$k_{s}=0.25$，$\\mu_{c}=2$，$\\lambda_{s}=0.09$和$\\lambda_{c}=0.27$：\n$$\n\\mathbb{E}[P_{\\mathrm{succ}}(S,C)] = \\left(\\frac{0.25}{0.25+0.09}\\right) \\exp\\left(2(\\exp(-0.27)-1)\\right) = \\frac{0.25}{0.34} \\exp\\left(2(\\exp(-0.27)-1)\\right)\n$$\n对此表达式进行数值计算：\n$$\n\\mathbb{E}[P_{\\mathrm{succ}}(S,C)] \\approx (0.735294\\dots) \\exp(2(0.763379\\dots - 1)) = (0.735294\\dots) \\exp(-0.473241\\dots) \\approx 0.4580816\\dots\n$$\n四舍五入到$4$位有效数字，我们得到$\\mathbb{E}[P_{\\mathrm{succ}}(S,C)] \\approx 0.4581$。\n\n第二个任务是找到最小的脓肿直径阈值$s^{\\star}$，使得对于固定的合并症数量$c^{\\star}=3$和决策阈值$T=0.70$，有$P_{\\mathrm{fail}}(s, c^{\\star}) \\geq T$。\n失败概率为$P_{\\mathrm{fail}}(s,c)=1-P_{\\mathrm{succ}}(s,c)=1-\\exp(-\\lambda_{s}s-\\lambda_{c}c)$。条件是：\n$$\n1-\\exp(-\\lambda_{s}s - \\lambda_{c}c^{\\star}) \\geq T\n$$\n函数$P_{\\mathrm{fail}}(s, c^{\\star})$关于$s$是单调递增的，因为其导数$\\frac{\\partial P_{\\mathrm{fail}}}{\\partial s} = \\lambda_s \\exp(-\\lambda_s s - \\lambda_c c^{\\star})$是严格为正的（因为$\\lambda_s > 0$）。因此，满足该不等式的最小值$s^{\\star}$就是满足等式$P_{\\mathrm{fail}}(s^{\\star}, c^{\\star}) = T$的值。我们求解$s^{\\star}$：\n$$\n1-\\exp(-\\lambda_{s}s^{\\star} - \\lambda_{c}c^{\\star}) = T\n$$\n$$\n\\exp(-\\lambda_{s}s^{\\star} - \\lambda_{c}c^{\\star}) = 1 - T\n$$\n对两边取自然对数（由于$T=0.70 < 1$，这是有效的）：\n$$\n-\\lambda_{s}s^{\\star} - \\lambda_{c}c^{\\star} = \\ln(1-T)\n$$\n求解$s^{\\star}$：\n$$\n\\lambda_{s}s^{\\star} = -\\lambda_{c}c^{\\star} - \\ln(1-T)\n$$\n$$\ns^{\\star} = \\frac{-\\lambda_{c}c^{\\star} - \\ln(1-T)}{\\lambda_{s}}\n$$\n代入给定值$c^{\\star}=3$，$T=0.70$，$\\lambda_s=0.09$和$\\lambda_c=0.27$：\n$$\ns^{\\star} = \\frac{-(0.27)(3) - \\ln(1-0.70)}{0.09} = \\frac{-0.81 - \\ln(0.3)}{0.09}\n$$\n对此表达式进行数值计算：\n$$\ns^{\\star} \\approx \\frac{-0.81 - (-1.2039728\\dots)}{0.09} = \\frac{0.3939728\\dots}{0.09} \\approx 4.3774756\\dots\n$$\n$s^{\\star}$的单位是$\\mathrm{cm}$。四舍五入到$4$位有效数字，我们得到$s^{\\star} \\approx 4.377$。\n\n最终答案要求将$\\mathbb{E}[P_{\\mathrm{succ}}(S,C)]$和$s^{\\star}$这两个量作为一个行向量，并四舍五入到$4$位有效数字。\n该向量为$(0.4581, 4.377)$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.4581  4.377 \\end{pmatrix}}$$"
        }
    ]
}