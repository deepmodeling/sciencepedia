{
    "hands_on_practices": [
        {
            "introduction": "临床诊断的核心在于根据新的证据不断更新我们对疾病可能性的判断。本练习将通过一个涉及口腔和生殖器溃疡的复杂病例，引导您应用贝叶斯定理来量化鉴别诊断过程。 您将学习如何整合多项独立的检测结果，以精确计算出在获得所有证据后，单纯疱疹病毒（HSV）感染作为病因的后验概率。",
            "id": "4445989",
            "problem": "一名患者因同时出现口腔和生殖器溃疡，就诊于一家三级皮肤性病科诊所。初步鉴别诊断限定于四种互斥且穷尽的病因：单纯疱疹病毒（HSV）感染、白塞病、一期梅毒和复杂性口疮。在该诊所，患有此特定综合征（同时性口腔和生殖器溃疡）的患者中，检验前概率如下：HSV感染 $P(H)=0.35$，白塞病 $P(B)=0.30$，一期梅毒 $P(S)=0.10$，复杂性口疮 $P(A)=0.25$。进行了独立的诊断评估，得到以下结果和特征，并假定在真实基础诊断给定的情况下，这些评估是条件独立的：\n\n1. 对生殖器溃疡进行的HSV聚合酶链式反应（PCR）：结果为阳性。对于HSV感染，其灵敏度为 $0.97$。对于非HSV病因，其特异度为 $0.995$。\n2. 梅毒螺旋体颗粒凝集试验（TPPA）：结果为阴性。对于一期梅毒，其灵敏度为 $0.85$。对于非梅毒病因，其特异度为 $0.99$。\n3. 针刺反应试验：结果为阳性。对于白塞病，其灵敏度为 $0.60$。对于非白塞病病因，其特异度为 $0.95$。\n4. 人类白细胞抗原（HLA）B51：结果为阳性。对于白塞病，HLA-B51阳性的概率为 $0.60$。对于非白塞病病因，HLA-B51阳性的概率为 $0.15$。\n\n假设在此模型中，所列的四种病因是唯一可能的原因，并且在以真实病因为条件时，四项检测结果是独立的。仅使用条件概率的定义、全概率定律和贝叶斯定理，计算在给定所有观测结果的情况下，HSV感染是导致溃疡的病因的后验概率。将您的答案表示为十进制概率，并四舍五入至四位有效数字。",
            "solution": "首先验证问题，确保其科学上合理、内容独立完整且提法明确。\n\n### 步骤1：提取已知条件\n设四种互斥且穷尽的病因由以下事件表示：\n- $H$：单纯疱疹病毒（HSV）感染\n- $B$：白塞病\n- $S$：一期梅毒\n- $A$：复杂性口疮\n\n先验概率（检验前概率）如下：\n- $P(H) = 0.35$\n- $P(B) = 0.30$\n- $P(S) = 0.10$\n- $P(A) = 0.25$\n这些概率的总和为 $0.35 + 0.30 + 0.10 + 0.25 = 1.00$，证实了它们是穷尽的。\n\n观测到的证据包括四项检测结果。设 $E$ 为代表所有结果的复合事件：\n- $E_1$：HSV的PCR检测为阳性（$PCR^+$）\n- $E_2$：TPPA检测为阴性（$TPPA^-$）\n- $E_3$：针刺反应试验为阳性（$PT^+$）\n- $E_4$：HLA-B51检测为阳性（$HLA^+$）\n因此，$E = \\{E_1, E_2, E_3, E_4\\}$。\n\n给定各项检测的条件概率如下：\n1.  **HSV的PCR检测**：结果 $PCR^+$。\n    - 对HSV的灵敏度：$P(PCR^+ | H) = 0.97$。\n    - 对非HSV的特异度：$P(PCR^- | \\text{not } H) = 0.995$。这意味着假阳性率为 $P(PCR^+ | \\text{not } H) = 1 - 0.995 = 0.005$。此处，“非 $H$”（not $H$）对应于诊断集合 $\\{B, S, A\\}$。\n2.  **TPPA检测**：结果 $TPPA^-$。\n    - 对梅毒的灵敏度：$P(TPPA^+ | S) = 0.85$。这意味着假阴性率为 $P(TPPA^- | S) = 1 - 0.85 = 0.15$。\n    - 对非梅毒的特异度：$P(TPPA^- | \\text{not } S) = 0.99$。此处，“非 $S$”（not $S$）对应于 $\\{H, B, A\\}$。\n3.  **针刺反应试验**：结果 $PT^+$。\n    - 对白塞病的灵敏度：$P(PT^+ | B) = 0.60$。\n    - 对非白塞病的特异度：$P(PT^- | \\text{not } B) = 0.95$。这意味着假阳性率为 $P(PT^+ | \\text{not } B) = 1 - 0.95 = 0.05$。此处，“非 $B$”（not $B$）对应于 $\\{H, S, A\\}$。\n4.  **HLA-B51**：结果 $HLA^+$。\n    - 对于白塞病：$P(HLA^+ | B) = 0.60$。\n    - 对于非白塞病：$P(HLA^+ | \\text{not } B) = 0.15$。此处，“非 $B$”（not $B$）对应于 $\\{H, S, A\\}$。\n\n问题假设在给定真实基础诊断的情况下，四项检测结果是条件独立的。\n\n目标是计算给定证据 $E$ 的情况下，HSV感染的后验概率 $P(H|E)$，并四舍五入至四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题是贝叶斯推断在医学背景下的标准应用。所给条件是完整的，定义了所有必要的先验概率和条件概率（灵敏度和特异度）。病因是互斥且穷尽的，确保了概率模型的一致性。诸如检测的条件独立性等假设都已明确说明。没有科学或逻辑上的矛盾，没有歧义，问题提法明确。因此，该问题被认定为**有效**。\n\n### 步骤3：求解\nHSV感染的后验概率 $P(H|E)$ 可以使用贝叶斯定理计算：\n$$ P(H | E) = \\frac{P(E | H) P(H)}{P(E)} $$\n分母中的项 $P(E)$ 是观测到证据 $E$ 的总概率，可以通过使用全概率定律对所有可能的病因求和来计算：\n$$ P(E) = P(E | H)P(H) + P(E | B)P(B) + P(E | S)P(S) + P(E | A)P(A) $$\n由于四项检测的条件独立性，对于任何给定的诊断 $D \\in \\{H, B, S, A\\}$，证据 $E$ 的似然是每个检测结果的单个条件概率的乘积：\n$$ P(E | D) = P(PCR^+ | D) \\times P(TPPA^- | D) \\times P(PT^+ | D) \\times P(HLA^+ | D) $$\n我们必须首先为四种可能的诊断分别计算这些似然。\n\n**1. HSV（$H$）的似然：**\n- $P(PCR^+ | H) = 0.97$（灵敏度）\n- $P(TPPA^- | H) = P(TPPA^- | \\text{not } S) = 0.99$（对非梅毒的特异度）\n- $P(PT^+ | H) = P(PT^+ | \\text{not } B) = 1 - 0.95 = 0.05$（假阳性率）\n- $P(HLA^+ | H) = P(HLA^+ | \\text{not } B) = 0.15$（非白塞病中的阳性率）\n$P(E | H) = 0.97 \\times 0.99 \\times 0.05 \\times 0.15 = 0.00720225$\n\n**2. 白塞病（$B$）的似然：**\n- $P(PCR^+ | B) = P(PCR^+ | \\text{not } H) = 1 - 0.995 = 0.005$（假阳性率）\n- $P(TPPA^- | B) = P(TPPA^- | \\text{not } S) = 0.99$（对非梅毒的特异度）\n- $P(PT^+ | B) = 0.60$（灵敏度）\n- $P(HLA^+ | B) = 0.60$（白塞病中的阳性率）\n$P(E | B) = 0.005 \\times 0.99 \\times 0.60 \\times 0.60 = 0.001782$\n\n**3. 梅毒（$S$）的似然：**\n- $P(PCR^+ | S) = P(PCR^+ | \\text{not } H) = 0.005$（假阳性率）\n- $P(TPPA^- | S) = 1 - 0.85 = 0.15$（假阴性率）\n- $P(PT^+ | S) = P(PT^+ | \\text{not } B) = 0.05$（假阳性率）\n- $P(HLA^+ | S) = P(HLA^+ | \\text{not } B) = 0.15$（非白塞病中的阳性率）\n$P(E | S) = 0.005 \\times 0.15 \\times 0.05 \\times 0.15 = 0.000005625$\n\n**4. 复杂性口疮（$A$）的似然：**\n- $P(PCR^+ | A) = P(PCR^+ | \\text{not } H) = 0.005$（假阳性率）\n- $P(TPPA^- | A) = P(TPPA^- | \\text{not } S) = 0.99$（对非梅毒的特异度）\n- $P(PT^+ | A) = P(PT^+ | \\text{not } B) = 0.05$（假阳性率）\n- $P(HLA^+ | A) = P(HLA^+ | \\text{not } B) = 0.15$（非白塞病中的阳性率）\n$P(E | A) = 0.005 \\times 0.99 \\times 0.05 \\times 0.15 = 0.000037125$\n\n现在，我们计算贝叶斯定理的分子，即联合概率 $P(E, H)$：\n$P(E | H)P(H) = 0.00720225 \\times 0.35 = 0.0025207875$\n\n接下来，我们通过将每个似然乘以其先验概率并求和，来计算证据的总概率 $P(E)$：\n$P(E) = P(E|H)P(H) + P(E|B)P(B) + P(E|S)P(S) + P(E|A)P(A)$\n$P(E) = (0.00720225 \\times 0.35) + (0.001782 \\times 0.30) + (0.000005625 \\times 0.10) + (0.000037125 \\times 0.25)$\n$P(E) = 0.0025207875 + 0.0005346 + 0.0000005625 + 0.00000928125$\n$P(E) = 0.00306523125$\n\n最后，我们计算后验概率 $P(H|E)$：\n$$ P(H | E) = \\frac{P(E | H) P(H)}{P(E)} = \\frac{0.0025207875}{0.00306523125} \\approx 0.8223845 $$\n问题要求答案四舍五入至四位有效数字。\n$P(H | E) \\approx 0.8224$",
            "answer": "$$\\boxed{0.8224}$$"
        },
        {
            "introduction": "在掌握了如何权衡单一诊断的证据之后，本练习将挑战您构建一个简化的临床预测模型。您将把关于生殖器疱疹的临床知识（如原发与复发、HSV-$1$与HSV-$2$的区别）形式化为一个朴素贝叶斯分类器。 这项实践旨在深化您对疾病不同表现形式的理解，并展示如何利用概率模型整合多个临床特征，以辅助诊断、分型和预测病程。",
            "id": "4445995",
            "problem": "您需要基于已有的皮肤病学和性病学事实，使用一个最小生成概率模型，为生殖器单纯疱疹感染发作实现一个有原则的分类器和估计器。该模型必须基于以下基本事实构建：影响生殖器区域的单纯疱疹病毒（HSV）主要有两种类型，即 HSV-1型和 HSV-2型；与复发性发作相比，原发性首次生殖器疱疹通常更为严重，病损更多且呈双侧分布，更频繁地出现全身症状（发烧、不适）和腹股沟淋巴结肿大。而复发性发作病程更短、症状更轻，常有前驱症状（刺痛、烧灼感），且更常由压力、性摩擦或月经等诱因引发。HSV-2型在生殖器区域的复发频率高于 HSV-1型。您必须将这些定性陈述形式化为一个具有独立特征的朴素贝叶斯模型，并用它来对每次发作推断：(i) 其类型是原发性的还是复发性的，(ii) 导致该生殖器疾病模式的最可能病毒类型（HSV-1型或 HSV-2型），以及 (iii) 未经治疗的发作预期持续时间（以天为单位）。\n\n为一次发作定义以下变量：$n$ 为病损数量（一个非负整数），$b$ 为双侧累及指标（若是双侧则为 $1$，否则为 $0$），$s$ 为全身症状指标（若有则为 $1$，否则为 $0$），$p$ 为前驱症状指标（若有则为 $1$，否则为 $0$），$d$ 为排尿困难指标（若有则为 $1$，否则为 $0$），$\\ell$ 为腹股沟淋巴结肿大指标（若有则为 $1$，否则为 $0$），$c$ 为发病前一周内识别出的诱因数量（一个非负整数），$r$ 为去年复发次数（一个非负整数），以及 $o$ 为口唇疱疹史指标（若有则为 $1$，否则为 $0$）。\n\nA部分（发作类型）：为两个类别 $C \\in \\{\\text{primary}, \\text{recurrent}\\}$ 建模。使用以下先验概率：$\\mathbb{P}(C=\\text{primary}) = 0.25$ 和 $\\mathbb{P}(C=\\text{recurrent}) = 0.75$。假设在给定 $C$ 的情况下特征条件独立，并按如下方式指定似然：对于病损数量 $n$，使用速率为 $\\lambda_{n|\\text{primary}} = 12$ 和 $\\lambda_{n|\\text{recurrent}} = 3$ 的泊松分布；对于诱因数量 $c$，使用速率为 $\\lambda_{c|\\text{primary}} = 0.5$ 和 $\\lambda_{c|\\text{recurrent}} = 1.5$ 的泊松分布；对于双侧累及 $b$，使用成功概率为 $p_{b|\\text{primary}} = 0.6$ 和 $p_{b|\\text{recurrent}} = 0.25$ 的伯努利分布；对于全身症状 $s$，使用 $p_{s|\\text{primary}} = 0.65$ 和 $p_{s|\\text{recurrent}} = 0.1$ 的伯努利分布；对于前驱症状 $p$，使用 $p_{p|\\text{primary}} = 0.25$ 和 $p_{p|\\text{recurrent}} = 0.65$ 的伯努利分布；对于排尿困难 $d$，使用 $p_{d|\\text{primary}} = 0.5$ 和 $p_{d|\\text{recurrent}} = 0.25$ 的伯努利分布；对于腹股沟淋巴结肿大 $\\ell$，使用 $p_{\\ell|\\text{primary}} = 0.6$ 和 $p_{\\ell|\\text{recurrent}} = 0.25$ 的伯努利分布。对于一个速率为 $\\lambda$ 的泊松随机变量 $X$，其概率质量函数为 $\\mathbb{P}(X=k)=e^{-\\lambda}\\lambda^{k}/k!$（对于整数 $k\\ge 0$）。对于一个成功概率为 $p$ 的伯努利随机变量 $Y$，其概率质量函数为 $\\mathbb{P}(Y=y)=p^{y}(1-p)^{1-y}$（对于 $y\\in\\{0,1\\}$）。使用贝叶斯定理 $\\mathbb{P}(C\\mid \\text{features}) \\propto \\mathbb{P}(C)\\prod_{i}\\mathbb{P}(\\text{feature}_{i}\\mid C)$，计算后验概率 $\\mathbb{P}(C=\\text{primary}\\mid n,b,s,p,d,\\ell,c)$，如果该后验概率至少为 $0.5$，则将发作分类为原发性，否则分类为复发性。为确保数值稳定性，您应在对数域中进行计算，并仅在评估归一化后验概率时进行指数运算。\n\nB部分（病毒类型）：为代表 HSV-1型和 HSV-2型的两个类别 $T \\in \\{\\text{HSV1}, \\text{HSV2}\\}$ 建模。使用先验概率 $\\mathbb{P}(T=\\text{HSV2})=0.7$ 和 $\\mathbb{P}(T=\\text{HSV1})=0.3$。以复发次数 $r$ 和口唇疱疹史 $o$ 为条件，假设在给定 $T$ 的情况下两者独立。对于 $r$，使用速率为 $\\lambda_{r|\\text{HSV2}}=4$ 和 $\\lambda_{r|\\text{HSV1}}=1$ 的泊松似然。对于 $o$，使用成功概率为 $p_{o|\\text{HSV2}}=0.2$ 和 $p_{o|\\text{HSV1}}=0.5$ 的伯努利似然。计算后验概率 $\\mathbb{P}(T\\mid r,o)$，如果 $\\mathbb{P}(T=\\text{HSV2}\\mid r,o) \\ge 0.5$，则分类为 HSV-2型，否则分类为 HSV-1型。\n\nC部分（预期未治疗持续时间）：设未经治疗的发作持续时间模型为：如果发作是原发性的，则 $D=\\mu_{\\text{primary}}$；如果是复发性的，则 $D=\\mu_{\\text{recurrent}}$，其中 $\\mu_{\\text{primary}}=14$ 天，$\\mu_{\\text{recurrent}}=7$ 天。报告后验预测期望 $\\mathbb{E}[D\\mid \\text{features}]=\\mathbb{P}(C=\\text{primary}\\mid \\text{features})\\cdot 14 + \\mathbb{P}(C=\\text{recurrent}\\mid \\text{features})\\cdot 7$。以天为单位表示预期持续时间，四舍五入到两位小数。\n\n输入和测试套件：没有外部输入。您的程序必须硬编码并评估以下发作测试套件，每个发作用一个元组 $(n,b,s,p,d,\\ell,c,r,o)$ 编码，其中变量的顺序如上所定义：\n- 案例1：$(18,1,1,0,1,1,0,0,0)$\n- 案例2：$(3,0,0,1,0,0,2,5,0)$\n- 案例3：$(2,0,0,1,0,0,1,1,1)$\n- 案例4：$(8,1,0,1,0,1,1,2,0)$\n- 案例5：$(1,0,0,0,0,0,0,0,0)$\n\n对于每个案例，您的程序必须计算并返回一个子列表 $[C,T,D]$，其中 $C$ 是整数形式的发作类别标签（原发性为 $1$，复发性为 $0$），$T$ 是整数形式的 HSV 类型标签（HSV-2型为 $2$，HSV-1型为 $1$），$D$ 是预期未治疗持续时间，以浮点数形式表示，单位为天，四舍五入到两位小数。最终输出格式：您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表，其中不含空格，每个元素是对应案例的子列表。例如，输出应类似于 $[[C_{1},T_{1},D_{1}],[C_{2},T_{2},D_{2}],\\dots]$，整行中不含任何空格。",
            "solution": "该问题是有效的，因为它基于皮肤病学和性病学中已有的临床知识，提出了一个有科学依据、定义明确且客观的任务。它提供了一套完整且一致的参数和定义来构建概率分类器和估计器。该问题是应用贝叶斯推断的一个正式练习，而贝叶斯推断是计算科学中的一种标准且稳健的方法。\n\n该解决方案设计为一个三部贝叶斯模型。第一部分对发作类型（$C$）进行分类，第二部分对病毒类型（$T$）进行分类，第三部分估计预期的发作持续时间（$D$）。对于每个给定的测试案例，这三个部分按顺序处理。解决方案的核心是应用贝叶斯定理，该定理指出，在给定证据（特征）的情况下，一个假设（一个类别）的后验概率正比于该假设的先验概率与给定该假设下证据的似然的乘积。“朴素”贝叶斯假设规定，所有特征在给定类别的情况下是条件独立的，这将似然计算简化为各个特征似然的乘积。\n\nA部分：发作类型分类\n目标是根据一组特征 $\\boldsymbol{x}_{\\text{A}} = (n, b, s, p, d, \\ell, c)$ 来确定一次发作是原发性的 ($C=\\text{primary}$) 还是复发性的 ($C=\\text{recurrent}$)。根据贝叶斯定理，类别 $C$ 的后验概率由下式给出：\n$$\n\\mathbb{P}(C \\mid \\boldsymbol{x}_{\\text{A}}) \\propto \\mathbb{P}(C) \\mathbb{P}(\\boldsymbol{x}_{\\text{A}} \\mid C)\n$$\n在朴素贝叶斯的条件独立性假设下，这变为：\n$$\n\\mathbb{P}(C \\mid \\boldsymbol{x}_{\\text{A}}) \\propto \\mathbb{P}(C) \\mathbb{P}(n \\mid C) \\mathbb{P}(b \\mid C) \\mathbb{P}(s \\mid C) \\mathbb{P}(p \\mid C) \\mathbb{P}(d \\mid C) \\mathbb{P}(\\ell \\mid C) \\mathbb{P}(c \\mid C)\n$$\n直接计算这个概率乘积可能导致数值下溢。为确保稳定性，计算在对数域中进行。类别 $C$ 的未归一化对数后验概率为：\n$$\n\\log \\tilde{\\mathbb{P}}(C \\mid \\boldsymbol{x}_{\\text{A}}) = \\log \\mathbb{P}(C) + \\sum_{i \\in \\{n,b,s,p,d,\\ell,c\\}} \\log \\mathbb{P}(x_i \\mid C)\n$$\n一个速率为 $\\lambda$ 的泊松分布特征 $k$ 的对数似然是 $\\log \\mathbb{P}(k \\mid \\lambda) = -\\lambda + k \\log \\lambda - \\log(k!)$。$\\log(k!)$ 项可以使用对数伽马函数 $\\text{gammaln}(k+1)$ 高效计算。一个成功概率为 $p$ 的伯努利分布特征 $y$ 的对数似然是 $\\log \\mathbb{P}(y \\mid p) = y \\log p + (1-y) \\log (1-p)$。\n\n令 $L_{\\text{primary}} = \\log \\tilde{\\mathbb{P}}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}})$ 和 $L_{\\text{recurrent}} = \\log \\tilde{\\mathbb{P}}(C=\\text{recurrent} \\mid \\boldsymbol{x}_{\\text{A}})$。原发类别的后验概率通过对这些对数分数进行归一化得到。使用 log-sum-exp 技巧来保持数值精度，我们计算 $M = \\max(L_{\\text{primary}}, L_{\\text{recurrent}})$，然后：\n$$\n\\mathbb{P}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}}) = \\frac{\\exp(L_{\\text{primary}} - M)}{\\exp(L_{\\text{primary}} - M) + \\exp(L_{\\text{recurrent}} - M)}\n$$\n如果此后验概率大于或等于 $0.5$，则该发作被分类为原发性（标签 $C=1$）；否则，被分类为复发性（标签 $C=0$）。\n\nB部分：病毒类型分类\n该部分根据特征 $\\boldsymbol{x}_{\\text{B}} = (r, o)$ 将病毒分类为 HSV-1型 ($T=\\text{HSV1}$) 或 HSV-2型 ($T=\\text{HSV2}$)。其方法与A部分类似。我们计算每种病毒类型的未归一化对数后验：\n$$\n\\log \\tilde{\\mathbb{P}}(T \\mid \\boldsymbol{x}_{\\text{B}}) = \\log \\mathbb{P}(T) + \\log \\mathbb{P}(r \\mid T) + \\log \\mathbb{P}(o \\mid T)\n$$\n分类规则是选择后验概率较高的类别。这等同于比较未归一化的对数后验。如果 $\\log \\tilde{\\mathbb{P}}(T=\\text{HSV2} \\mid \\boldsymbol{x}_{\\text{B}}) \\ge \\log \\tilde{\\mathbb{P}}(T=\\text{HSV1} \\mid \\boldsymbol{x}_{\\text{B}})$，则病毒被分类为 HSV-2型（标签 $T=2$），否则被分类为 HSV-1型（标签 $T=1$）。与C部分不同，此分类决策不需要显式归一化。\n\nC部分：预期未治疗持续时间\n预期未治疗持续时间 $\\mathbb{E}[D \\mid \\boldsymbol{x}_{\\text{A}}]$ 是后验预测期望。它是原发性和复发性发作持续时间的加权平均值，权重是A部分中计算的后验概率：\n$$\n\\mathbb{E}[D \\mid \\boldsymbol{x}_{\\text{A}}] = \\mathbb{E}[D \\mid C=\\text{primary}] \\cdot \\mathbb{P}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}}) + \\mathbb{E}[D \\mid C=\\text{recurrent}] \\cdot \\mathbb{P}(C=\\text{recurrent} \\mid \\boldsymbol{x}_{\\text{A}})\n$$\n使用给定值 $\\mu_{\\text{primary}}=14$ 天和 $\\mu_{\\text{recurrent}}=7$ 天，并注意到 $\\mathbb{P}(C=\\text{recurrent} \\mid \\boldsymbol{x}_{\\text{A}}) = 1 - \\mathbb{P}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}})$，公式简化为：\n$$\n\\mathbb{E}[D \\mid \\boldsymbol{x}_{\\text{A}}] = 14 \\cdot \\mathbb{P}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}}) + 7 \\cdot (1 - \\mathbb{P}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}})) = 7 \\cdot \\mathbb{P}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}}) + 7\n$$\n最终结果按要求四舍五入到两位小数。该算法为每个测试案例实现这三个部分，并将输出格式化为单行的列表之列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import gammaln\n\ndef solve():\n    \"\"\"\n    Implements a naive Bayes classifier and estimator for herpes simplex infection episodes.\n    \"\"\"\n\n    # Part A: Parameters for Episode Type Classification (primary vs. recurrent)\n    params_A = {\n        'priors': {'primary': 0.25, 'recurrent': 0.75},\n        'likelihoods': {\n            'n': {'type': 'poisson', 'primary': 12, 'recurrent': 3},\n            'c': {'type': 'poisson', 'primary': 0.5, 'recurrent': 1.5},\n            'b': {'type': 'bernoulli', 'primary': 0.6, 'recurrent': 0.25},\n            's': {'type': 'bernoulli', 'primary': 0.65, 'recurrent': 0.1},\n            'p': {'type': 'bernoulli', 'primary': 0.25, 'recurrent': 0.65},\n            'd': {'type': 'bernoulli', 'primary': 0.5, 'recurrent': 0.25},\n            'l': {'type': 'bernoulli', 'primary': 0.6, 'recurrent': 0.25},\n        }\n    }\n\n    # Part B: Parameters for Virus Type Classification (HSV-1 vs. HSV-2)\n    params_B = {\n        'priors': {'hsv1': 0.3, 'hsv2': 0.7},\n        'likelihoods': {\n            'r': {'type': 'poisson', 'hsv1': 1, 'hsv2': 4},\n            'o': {'type': 'bernoulli', 'hsv1': 0.5, 'hsv2': 0.2},\n        }\n    }\n\n    # Part C: Parameters for Expected Duration Estimation\n    params_C = {'primary': 14, 'recurrent': 7}\n\n    test_cases = [\n        (18, 1, 1, 0, 1, 1, 0, 0, 0),  # Case 1\n        (3, 0, 0, 1, 0, 0, 2, 5, 0),   # Case 2\n        (2, 0, 0, 1, 0, 0, 1, 1, 1),   # Case 3\n        (8, 1, 0, 1, 0, 1, 1, 2, 0),   # Case 4\n        (1, 0, 0, 0, 0, 0, 0, 0, 0),   # Case 5\n    ]\n\n    results = []\n\n    for case in test_cases:\n        n, b, s, p, d, l, c, r, o = case\n        features_A = {'n': n, 'b': b, 's': s, 'p': p, 'd': d, 'l': l, 'c': c}\n        features_B = {'r': r, 'o': o}\n\n        # --- Part A: Episode Type Classification ---\n        log_post_primary = np.log(params_A['priors']['primary'])\n        log_post_recurrent = np.log(params_A['priors']['recurrent'])\n\n        for feat, value in features_A.items():\n            spec = params_A['likelihoods'][feat]\n            if spec['type'] == 'poisson':\n                # log P(k|lam) = -lam + k*log(lam) - gammaln(k+1)\n                lam_p, lam_r = spec['primary'], spec['recurrent']\n                log_post_primary += -lam_p + value * np.log(lam_p) - gammaln(value + 1)\n                log_post_recurrent += -lam_r + value * np.log(lam_r) - gammaln(value + 1)\n            elif spec['type'] == 'bernoulli':\n                # log P(y|p) = y*log(p) + (1-y)*log(1-p)\n                prob_p, prob_r = spec['primary'], spec['recurrent']\n                log_post_primary += value * np.log(prob_p) + (1 - value) * np.log(1 - prob_p)\n                log_post_recurrent += value * np.log(prob_r) + (1 - value) * np.log(1 - prob_r)\n\n        # Normalize posteriors for Part A using log-sum-exp trick for numerical stability\n        max_log = max(log_post_primary, log_post_recurrent)\n        post_primary_unnorm = np.exp(log_post_primary - max_log)\n        post_recurrent_unnorm = np.exp(log_post_recurrent - max_log)\n        prob_primary = post_primary_unnorm / (post_primary_unnorm + post_recurrent_unnorm)\n\n        # Classification C: 1 for primary-like, 0 for recurrent-like\n        C_label = 1 if prob_primary >= 0.5 else 0\n\n        # --- Part B: Virus Type Classification ---\n        log_post_hsv1 = np.log(params_B['priors']['hsv1'])\n        log_post_hsv2 = np.log(params_B['priors']['hsv2'])\n\n        for feat, value in features_B.items():\n            spec = params_B['likelihoods'][feat]\n            if spec['type'] == 'poisson':\n                lam_1, lam_2 = spec['hsv1'], spec['hsv2']\n                log_post_hsv1 += -lam_1 + value * np.log(lam_1) - gammaln(value + 1)\n                log_post_hsv2 += -lam_2 + value * np.log(lam_2) - gammaln(value + 1)\n            elif spec['type'] == 'bernoulli':\n                p_1, p_2 = spec['hsv1'], spec['hsv2']\n                log_post_hsv1 += value * np.log(p_1) + (1 - value) * np.log(1 - p_1)\n                log_post_hsv2 += value * np.log(p_2) + (1 - value) * np.log(1- p_2)\n        \n        # Classification T: 2 for HSV-2, 1 for HSV-1\n        T_label = 2 if log_post_hsv2 >= log_post_hsv1 else 1\n\n        # --- Part C: Expected Untreated Duration ---\n        expected_duration = (prob_primary * params_C['primary'] + \n                             (1 - prob_primary) * params_C['recurrent'])\n        D_val = round(expected_duration, 2)\n        \n        results.append([C_label, T_label, D_val])\n\n    # Format the final output string as specified\n    sub_results_str = []\n    for C_label, T_label, D_val in results:\n        sub_results_str.append(f\"[{C_label},{T_label},{D_val:.2f}]\")\n    final_output = f\"[{','.join(sub_results_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "最后的这项实践从定量模型转向临床综合决策的艺术。本练习呈现了一个复杂的儿科病例，其中由单纯疱疹病毒（HSV）引起的病毒性感染（疱疹性瘭疽）被误认为是常见的细菌性感染。 您必须综合患者的病史、体格检查特征以及对初步（不正确）治疗的反应，来辨别病毒性病因，并选择唯一正确的处理方案，从而避免不当的干预。",
            "id": "5109366",
            "problem": "一名儿童在轻微创伤后出现手指甲褶周围的急性炎症。您必须应用一个基于脓性、水疱形成、宿主免疫反应特征以及对初始干预预期反应的定义算法，来区分病毒性疱疹感染和细菌性甲沟炎，并选择最合适的下一步措施。一名既往健康的$9$岁男孩因右拇指近端甲褶周围疼痛肿胀$3$天被带到诊所就诊。他没有已知的免疫缺陷，也未服用任何慢性药物。他的母亲报告说，$10$天前他曾出现疼痛性口腔溃疡并伴有低热，被诊断为龈口炎，他有吮吸右拇指的习惯。$24$小时前在一家紧急护理中心，他的拇指接受了切开引流（Incision and Drainage, I&D），并开始口服头孢氨苄，剂量为$50\\,\\mathrm{mg/kg/天}$，每日两次分服。此后，疼痛加剧，肿胀加重。他今天无发热，体温为$37.4^\\circ\\mathrm{C}$。体格检查显示近端甲褶紧张性红斑和肿胀，伴有极度压痛，可触及的波动感极轻，甲旁红斑基底上可见数个成簇的透明水疱（$2$–$3$ mm）。指腹轻度肿胀，但腔室压痛不明显。无近端条纹，毛细血管再充盈迅速。据报告，先前引流液的革兰氏染色未见微生物；约$24$小时后培养仍无结果。未进行Tzanck涂片或核酸扩增检测。根据一个整合病史、皮损形态和对初始治疗反应的算法来鉴别小儿单纯疱疹病毒（HSV）感染性指头炎和细菌性甲沟炎，以下哪项是下一步最合适的措施？\n\nA. 诊断为疱疹性指头炎；停止进一步的切开引流，立即开始口服阿昔洛韦，使用封闭敷料和接触预防措施，并保留抗生素用于细菌重复感染的迹象。\n\nB. 诊断为耐甲氧西林金黄色葡萄球菌（MRSA）引起的细菌性甲沟炎；重复进行切开引流并开始使用克林霉素。\n\nC. 诊断为脓性指头炎（闭合腔隙指腹感染）；对指腹腔进行紧急手术引流，并开始使用阿莫西林克拉维酸钾以覆盖来自吮吸拇指的口腔菌群。\n\nD. 诊断为手指蜂窝织炎；增加头孢氨苄剂量并加热敷；不建议使用抗病毒药物。\n\nE. 无需干预，进行观察；疱疹性指头炎是自限性的，不需要药物或预防措施。",
            "solution": "用户提供了一个临床案例，并要求根据诊断流程确定最合适的下一步管理措施。\n\n### 步骤1：提取已知信息\n\n-   **患者情况**：一名既往健康的$9$岁男孩。\n-   **主诉**：右拇指近端甲褶周围疼痛肿胀$3$天。\n-   **既往病史**：\n    -   无已知免疫缺陷。\n    -   未服用任何慢性药物。\n    -   $10$天前：曾有疼痛性口腔溃疡伴低热，诊断为龈口炎。\n    -   **个人史**：有吮吸右拇指的习惯。\n-   **近期干预（$24$小时前）**：\n    -   对拇指进行了切开引流（I&D），操作中引流出少量清澈液体。\n    -   液体培养结果尚待。\n    -   开始口服头孢氨苄，剂量为$50\\,\\mathrm{mg/kg/天}$，每日两次分服。\n-   **干预后临床病程**：疼痛加剧，肿胀加重。\n-   **当前体格检查**：\n    -   **生命体征**：无发热，体温$37.4^\\circ\\mathrm{C}$。\n    -   **右拇指**：近端甲褶紧张性红斑和肿胀，伴有极度压痛。可触及的波动感极轻。甲旁红斑基底上可见数个成簇的透明水疱，每个大小为$2$–$3$ mm。\n    -   **指腹腔隙**：轻度肿胀，但腔室压痛不明显。\n    -   无近端扩散迹象（例如，无近端条纹/淋巴管炎）。\n    -   **灌注**：毛细血管再充盈迅速。\n-   **实验室/诊断数据**：\n    -   I&D引流液的革兰氏染色未见微生物。\n    -   培养结果：约$24$小时后仍未有结果。\n    -   未进行Tzanck涂片或核酸扩增检测（NAAT）。\n\n### 步骤2：使用提取的已知信息进行验证\n\n-   **科学依据**：该问题基于儿科传染病学、皮肤病学和微创外科的既定原则。疱疹性指头炎和细菌性甲沟炎之间的鉴别诊断，所描述的临床特征（龈口炎、水疱、对I&D的反应）均具有高度的临床相关性。\n-   **问题定义明确**：该问题定义明确。它提供了详细且内部一致的临床病史和体格检查，从而可以逻辑地推导出最可能的诊断和随后的最合适的管理步骤。存在一个独特且有意义的解决方案。\n-   **客观性**：对患者病情的描述是客观的，使用了精确的临床术语（例如，“紧张性红斑”、“成簇的透明水疱”、“可触及的波动感极轻”）。它不含主观或偏见的语言。\n\n该问题没有表现出说明中列出的任何缺陷（例如，科学上不合理、不完整、矛盾、模糊）。所提供的数据对于严谨的临床推理过程是充分且一致的。\n\n### 步骤3：结论和行动\n\n问题陈述是**有效的**。现在将继续进行求解过程。\n\n### 基于原则的推导\n\n核心任务是区分手指甲褶急性感染的主要鉴别诊断，并确定正确的管理方案。主要的可能性是病毒感染（疱疹性指头炎）和细菌感染（甲沟炎）。\n\n1.  **疱疹性指头炎临床证据分析**：\n    -   **病史**：“疼痛性口腔溃疡”和“龈口炎”的近期病史是单纯疱疹病毒（HSV，通常是HSV-1）原发性口咽感染的典型表现。\n    -   **传播机制**：患者吮吸拇指的习惯为病毒从口腔自体接种到手指提供了直接途径，导致疱疹性指头炎。\n    -   **皮损形态**：“红斑基底上数个成簇的透明水疱（$2$–$3$ mm）”的体征是疱疹病毒感染的特征性皮肤表现。这是指向HSV的最具特异性的单一发现。\n    -   **对干预的反应**：在I&D中引流出“少量清澈液体”，而不是细菌性脓肿所预期的脓性物质（脓液）。此外，尽管进行了I&D并使用了抗生素，病情仍在恶化，这表明最初的诊断和治疗可能是错误的。\n    -   **实验室数据**：革兰氏染色显示“未见微生物”，这与病毒性病因一致。\n\n2.  **反对细菌性甲沟炎/脓性指头炎的临床证据分析**：\n    -   **细菌性甲沟炎**：典型的细菌性甲沟炎是一种以脓液积聚为特征的脓肿，引流时应为脓性或混浊液体，而非“少量清澈液体”。它应形成可触及的波动感积液，而此处描述为“极轻”。水疱的存在不是细菌性甲沟炎的特征。虽然头孢氨苄可能无法覆盖像MRSA这样的耐药菌，但其他发现的组合（水疱、清澈液体、革兰氏染色阴性）使得原发性细菌感染的可能性极低。\n    -   **脓性指头炎**：脓性指头炎是指数字指腹的深层腔隙感染。检查明确指出“腔室压痛不明显”，且炎症集中在“近端甲褶”。这一证据强烈反驳了脓性指头炎的诊断。\n\n3.  **综合与诊断**：证据压倒性地支持疱疹性指头炎的诊断。原发性口腔HSV感染史、自体接种机制、特征性水疱性皮损、I&D发现以及对初始治疗的反应共同指向了这一诊断。\n\n4.  **适当的管理**：\n    -   诊断为疱疹性指头炎。\n    -   **外科干预**：禁止进一步的I&D。对疱疹性指头炎进行切开引流是禁忌的，因为它可能导致病毒播散并延迟愈合。\n    -   **抗生素**：抗生素对病毒感染无效，除非有明确的继发性细菌感染（重复感染）的证据，而目前没有。\n    -   **抗病毒治疗**：鉴于症状显著且不断恶化（疼痛、肿胀），应进行特异性抗病毒治疗，以缩短病程和减轻疾病严重程度。在这种情况下，口服阿昔洛韦是治疗疱疹性指头炎的标准方法。\n    -   **感染控制**：水疱液具有高度传染性。应对皮损处使用封闭敷料，并遵守接触预防措施，以防止传播给他人，并防止儿童将病毒自体接种到其他部位，如眼睛（角膜结膜炎）。\n\n### 逐项分析选项\n\n**A. 诊断为疱疹性指头炎；停止进一步的切开引流，立即开始口服阿昔洛韦，使用封闭敷料和接触预防措施，并保留抗生素用于细菌重复感染的迹象。**\n该选项根据临床证据正确地将诊断确定为疱疹性指头炎。它提出的管理计划完全符合此病的标准治疗：避免禁忌的手术，启动适当的抗病毒药物，实施必要的感染控制措施，并明智地使用抗生素。\n**结论：正确**\n\n**B. 诊断为耐甲氧西林金黄色葡萄球菌（MRSA）引起的细菌性甲沟炎；重复进行切开引流并开始使用克林霉素。**\n该选项误解了临床发现。细菌性甲沟炎的诊断是不正确的，这已由水疱的存在、引流出的清澈液体和革兰氏染色阴性所证实。因此，重复进行I&D是禁忌的。\n**结论：不正确**\n\n**C. 诊断为脓性指头炎（闭合腔隙指腹感染）；对指腹腔进行紧急手术引流，并开始使用阿莫西林克拉维酸钾以覆盖来自吮吸拇指的口腔菌群。**\n这一诊断被体格检查中“腔室压痛不明显”的发现明确驳斥。感染部位是甲褶，而不是指腹。因此，对指腹进行手术引流是不恰当的。使用阿莫西林克拉维酸钾治疗不当地针对了细菌性病因。\n**结论：不正确**\n\n**D. 诊断为手指蜂窝织炎；增加头孢氨苄剂量并加热敷；不建议使用抗病毒药物。**\n这个诊断过于笼统，忽略了具有诊断意义的成簇水疱这一特异性发现。管理计划存在缺陷；增加无效抗生素的剂量是徒劳的，而“不建议使用抗病毒药物”的明确说法与正确方法恰恰相反。\n**结论：不正确**\n\n**E. 无需干预，进行观察；疱疹性指头炎是自限性的，不需要药物或预防措施。**\n此选项包含一个危险且不正确的陈述。虽然疱疹性指头炎可以是自限性的，但这名患者的感染正在恶化，需要积极使用抗病毒药物治疗以缓解症状。更重要的是，“不需要……预防措施”的断言是错误的。水疱液具有传染性，必须采取接触预防措施以防止传播。\n**结论：不正确**",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}