{
    "hands_on_practices": [
        {
            "introduction": "The fundamental goal of CSD analysis is to transform measured potentials into the underlying current sources and sinks. This practice brings the theory to life by applying the standard one-dimensional CSD formula to a realistic set of LFP measurements . By using a finite difference approximation for the second spatial derivative, you will perform the core calculation that bridges the abstract physical law to a concrete numerical estimate of neural activity.",
            "id": "4152477",
            "problem": "A laminar cortical probe records Local Field Potential (LFP) in a homogeneous, isotropic, ohmic medium with scalar conductivity. Consider three vertically aligned contacts at depths $z-h$, $z$, and $z+h$, with inter-contact spacing $h$. At a fixed time point near the peak of an evoked response, the measured extracellular potentials are $V(z-h) = 180$ μV, $V(z) = 210$ μV, and $V(z+h) = 170$ μV. The probe spacing is $h = 150$ μm, and the tissue conductivity is $\\sigma = 0.24$ S/m.\n\nStarting from the linear conduction law for ohmic media and local conservation of charge, derive an expression that relates the volumetric Current Source Density (CSD) to spatial variations of the extracellular potential. Assuming the spatial variation is predominantly along the depth axis, use a suitable three-point centered approximation to estimate the second spatial derivative at the central contact. Compute the magnitude of the CSD at depth $z$ using the provided measurements and parameters.\n\nRound your final magnitude to three significant figures. Express your final answer in A/m^3. Also, verify the unit consistency leading to A/m^3 for the CSD.",
            "solution": "The problem is well-posed and scientifically grounded. All required data are provided, and the task is to compute the Current Source Density (CSD), denoted $I_{CSD}$, from Local Field Potential (LFP) measurements using fundamental principles and a specified numerical approximation.\n\nFirst, we derive the relationship between the volumetric current source density and the extracellular potential, $V$. The current density vector, $\\vec{J}$, in a homogeneous, isotropic, ohmic medium is given by the linear conduction law (Ohm's law):\n$$\n\\vec{J} = \\sigma \\vec{E}\n$$\nwhere $\\sigma$ is the scalar electrical conductivity of the medium and $\\vec{E}$ is the electric field. The electric field is related to the scalar potential $V$ by:\n$$\n\\vec{E} = -\\nabla V\n$$\nSubstituting this into the expression for $\\vec{J}$ gives:\n$$\n\\vec{J} = -\\sigma \\nabla V\n$$\nThe principle of local conservation of charge is expressed by the continuity equation, which relates the divergence of the current density to the rate of change of charge density, $\\rho$:\n$$\n\\nabla \\cdot \\vec{J} = -\\frac{\\partial \\rho}{\\partial t}\n$$\nThe term $-\\frac{\\partial \\rho}{\\partial t}$ represents the net current flowing out of a differential volume per unit volume, which is by definition the volumetric current source density, $I_{CSD}$. Therefore:\n$$\nI_{CSD} = \\nabla \\cdot \\vec{J}\n$$\nSubstituting our expression for $\\vec{J}$ into this equation, we obtain:\n$$\nI_{CSD} = \\nabla \\cdot (-\\sigma \\nabla V)\n$$\nSince the problem states the medium is homogeneous, the conductivity $\\sigma$ is constant in space and can be pulled out of the divergence operator:\n$$\nI_{CSD} = -\\sigma (\\nabla \\cdot \\nabla V) = -\\sigma \\nabla^2 V\n$$\nThis is Poisson's equation, which relates the CSD to the Laplacian of the extracellular potential.\n\nThe problem states that the spatial variation of the potential is predominantly along the vertical depth axis, which we denote as the $z$-axis. Under this one-dimensional assumption, the Laplacian operator $\\nabla^2 V = \\frac{\\partial^2 V}{\\partial x^2} + \\frac{\\partial^2 V}{\\partial y^2} + \\frac{\\partial^2 V}{\\partial z^2}$ simplifies to:\n$$\n\\nabla^2 V \\approx \\frac{\\partial^2 V}{\\partial z^2}\n$$\nThus, the one-dimensional approximation for the CSD at a depth $z$ is:\n$$\nI_{CSD}(z) \\approx -\\sigma \\frac{\\partial^2 V}{\\partial z^2}\n$$\nTo estimate the second spatial derivative $\\frac{\\partial^2 V}{\\partial z^2}$ from discrete measurements at three points, we use the specified three-point centered finite difference approximation. For a function $V(z)$ sampled at points $z-h$, $z$, and $z+h$, the second derivative at $z$ is approximated by:\n$$\n\\frac{\\partial^2 V}{\\partial z^2} \\bigg|_z \\approx \\frac{V(z+h) - 2V(z) + V(z-h)}{h^2}\n$$\nSubstituting this approximation into our CSD equation gives the computational formula:\n$$\nI_{CSD}(z) \\approx -\\sigma \\left( \\frac{V(z-h) - 2V(z) + V(z+h)}{h^2} \\right)\n$$\nWe are given the following values, which must be converted to base SI units for consistency:\n- $V(z-h) = 180$ μV = $180 \\times 10^{-6}$ V\n- $V(z) = 210$ μV = $210 \\times 10^{-6}$ V\n- $V(z+h) = 170$ μV = $170 \\times 10^{-6}$ V\n- $h = 150$ μm = $150 \\times 10^{-6}$ m\n- $\\sigma = 0.24$ S/m\n\nFirst, we compute the term inside the parentheses:\n$$\nV(z-h) - 2V(z) + V(z+h) = (180 - 2 \\times 210 + 170) \\times 10^{-6} \\, \\text{V}\n$$\n$$\n= (180 - 420 + 170) \\times 10^{-6} \\, \\text{V} = (350 - 420) \\times 10^{-6} \\, \\text{V} = -70 \\times 10^{-6} \\, \\text{V}\n$$\nNext, we compute the denominator $h^2$:\n$$\nh^2 = (150 \\times 10^{-6} \\, \\text{m})^2 = 22500 \\times 10^{-12} \\, \\text{m}^2 = 2.25 \\times 10^{-8} \\, \\text{m}^2\n$$\nNow, we can compute the approximation for the second derivative:\n$$\n\\frac{\\partial^2 V}{\\partial z^2} \\approx \\frac{-70 \\times 10^{-6} \\, \\text{V}}{2.25 \\times 10^{-8} \\, \\text{m}^2} = -\\frac{70}{2.25} \\times 10^2 \\, \\text{V/m}^2 \\approx -3111.11 \\, \\text{V/m}^2\n$$\nFinally, we calculate the CSD at depth $z$:\n$$\nI_{CSD}(z) \\approx -(0.24 \\, \\text{S/m}) \\times (-3111.11 \\, \\text{V/m}^2) \\approx 746.66... \\, \\text{S} \\cdot \\text{V} / \\text{m}^3\n$$\nThe problem requests verification of the unit consistency. The unit of conductivity $\\sigma$ is Siemens per meter (S/m). The unit of the second spatial derivative of potential is Volts per meter squared (V/m^2). Their product gives a unit of S⋅V/m^3. The Siemens (S) is the unit of electrical conductance, equivalent to inverse Ohms (1/Ω) or Amperes per Volt (A/V). Therefore:\n$$\n\\frac{\\text{S} \\cdot \\text{V}}{\\text{m}^3} = \\frac{(\\text{A/V}) \\cdot \\text{V}}{\\text{m}^3} = \\frac{\\text{A}}{\\text{m}^3}\n$$\nThe calculated unit of Amperes per cubic meter (A/m^3) is the correct unit for volumetric current density, confirming the consistency of our calculation.\n\nThe problem asks for the magnitude of the CSD, rounded to three significant figures.\n$$\n|I_{CSD}(z)| \\approx |746.66... \\, \\text{A/m}^3| \\approx 747 \\, \\text{A/m}^3\n$$\nThe positive sign indicates a net current source (current flowing out of the local volume), while a negative sign would indicate a current sink (current flowing into the local volume).",
            "answer": "$$\n\\boxed{747}\n$$"
        },
        {
            "introduction": "Having calculated a CSD profile, a crucial question emerges: what is the true spatial resolution of our result? This exercise delves into the fundamental limits imposed by the discrete sampling of the LFP by your electrode array . By applying principles from sampling theory, you will determine the maximum spatial frequency of sinks and sources that can be resolved, and gain a conceptual understanding of spatial aliasing.",
            "id": "4152511",
            "problem": "A linear silicon probe samples one-dimensional brain tissue along the depth axis with evenly spaced contacts. The objective is to compute the current source density (CSD) from the local field potential (LFP) recorded along the depth coordinate $z$. Assume the standard quasi-static volume conductor regime with an ohmic, homogeneous, and isotropic medium of constant conductivity $\\sigma$, and no capacitive displacement currents. The LFP is the scalar electric potential $\\phi(z)$, and the CSD $I_{m}(z)$ is defined by the divergence of the current density through the tissue. Under these conditions, the relationship between $\\phi(z)$ and $I_{m}(z)$ follows from fundamental electrodynamics.\n\nThe probe samples $\\phi(z)$ at positions $z_{n} = n \\Delta z$ for integer $n$, where $\\Delta z  0$ is the fixed inter-contact spacing. The CSD is subsequently estimated using a discrete spatial second derivative of the sampled LFP.\n\nDefine the “spatial frequency of sinks/sources” as the angular spatial wavenumber $k$ (in radians per meter) that parameterizes sinusoidal components of the CSD pattern along $z$. Starting from the governing physical law that links $I_{m}(z)$ and $\\phi(z)$, and from first principles of sampling theory applied along space, derive the maximum resolvable angular spatial frequency $k_{\\max}$ for the sinks/sources pattern that can be uniquely resolved by CSD computed from discretely sampled LFP with spacing $\\Delta z$. In your reasoning, incorporate how spatial sampling replicates spectra and explain conceptually when aliasing occurs in CSD estimation.\n\nProvide your final answer as a closed-form analytic expression for $k_{\\max}$ in radians per meter, expressed only in terms of $\\Delta z$. No numerical evaluation is required.",
            "solution": "The problem statement is scientifically grounded, well-posed, objective, and self-contained. It describes a standard problem in computational neuroscience rooted in the principles of electrodynamics and signal processing theory. All provided information is consistent and sufficient to derive a unique solution. Therefore, the problem is valid and I will proceed with a full derivation.\n\nThe objective is to determine the maximum resolvable angular spatial frequency, $k_{\\max}$, of a current source density (CSD) pattern, $I_m(z)$, which is estimated from discretely sampled local field potential (LFP) data, $\\phi(z)$. The derivation will proceed in three stages: first, establishing the physical relationship between $I_m(z)$ and $\\phi(z)$; second, analyzing this relationship in the spatial frequency domain; and third, applying the principles of sampling theory to find the resolution limit.\n\n**1. The Physical Relationship between CSD and LFP**\n\nThe problem states that the medium is ohmic, homogeneous, and isotropic with a constant conductivity $\\sigma$. Under these conditions, the electric current density vector, $\\vec{J}$, is related to the electric field, $\\vec{E}$, by Ohm's law:\n$$ \\vec{J} = \\sigma \\vec{E} $$\nIn the quasi-static approximation, the electric field is the negative gradient of the scalar electric potential, $\\phi$:\n$$ \\vec{E} = -\\nabla \\phi $$\nSubstituting this into Ohm's law gives the relationship between current density and potential:\n$$ \\vec{J} = -\\sigma \\nabla \\phi $$\nThe CSD, $I_m$, is defined as the divergence of the current density. This represents the net current per unit volume flowing out of (or into) a given point in space.\n$$ I_m = \\nabla \\cdot \\vec{J} $$\nSubstituting the expression for $\\vec{J}$:\n$$ I_m = \\nabla \\cdot (-\\sigma \\nabla \\phi) $$\nSince the conductivity $\\sigma$ is assumed to be constant (a homogeneous medium), it can be factored out of the divergence operator:\n$$ I_m = -\\sigma \\nabla \\cdot (\\nabla \\phi) $$\nThe divergence of the gradient is the Laplacian operator, $\\nabla^2$. Thus, the relationship is given by Poisson's equation:\n$$ I_m = -\\sigma \\nabla^2 \\phi $$\nThe problem specifies a one-dimensional case where the potential and CSD vary only along the depth axis, $z$. In this case, the Laplacian operator simplifies to the second partial derivative with respect to $z$:\n$$ I_m(z) = -\\sigma \\frac{d^2\\phi(z)}{dz^2} $$\nThis equation is the fundamental physical law linking the continuous CSD, $I_m(z)$, to the continuous LFP, $\\phi(z)$, under the given assumptions. It confirms the problem's premise that the CSD is related to the second spatial derivative of the LFP.\n\n**2. Analysis in the Spatial Frequency Domain**\n\nTo understand the resolution, we analyze the relationship in the spatial frequency domain using the Fourier transform. Let $k$ be the angular spatial frequency (wavenumber) in units of radians per meter. Let $\\hat{I}_m(k)$ and $\\hat{\\phi}(k)$ be the one-dimensional Fourier transforms of $I_m(z)$ and $\\phi(z)$, respectively.\n$$ \\hat{I}_m(k) = \\mathcal{F}\\{I_m(z)\\} \\quad \\text{and} \\quad \\hat{\\phi}(k) = \\mathcal{F}\\{\\phi(z)\\} $$\nThe Fourier transform of an $n$-th derivative is given by the property $\\mathcal{F}\\{\\frac{d^n f(z)}{dz^n}\\} = (ik)^n \\hat{f}(k)$. Applying this to our governing equation for the second derivative ($n=2$):\n$$ \\hat{I}_m(k) = \\mathcal{F}\\left\\{-\\sigma \\frac{d^2\\phi(z)}{dz^2}\\right\\} = -\\sigma (ik)^2 \\hat{\\phi}(k) $$\nExpanding the term $(ik)^2$:\n$$ \\hat{I}_m(k) = -\\sigma (i^2 k^2) \\hat{\\phi}(k) = -\\sigma (-1 \\cdot k^2) \\hat{\\phi}(k) $$\nThis yields the relationship in the spatial frequency domain:\n$$ \\hat{I}_m(k) = \\sigma k^2 \\hat{\\phi}(k) $$\nThis equation shows that the spectrum of the CSD is the spectrum of the LFP multiplied by a factor of $\\sigma k^2$. This means that higher spatial frequencies in the LFP are amplified in the CSD, making the CSD estimation a form of high-pass spatial filtering.\n\n**3. Sampling Theory and the Resolution Limit**\n\nThe LFP, $\\phi(z)$, is not observed continuously but is sampled at discrete points $z_n = n \\Delta z$, where $\\Delta z$ is the inter-contact spacing. This sampling process imposes a fundamental limit on the information that can be recovered from the data.\n\nAccording to the Nyquist-Shannon sampling theorem, a continuous signal can be uniquely reconstructed from its samples if and only if it is band-limited, and the sampling rate is at least twice the highest frequency present in the signal.\n\nIn our spatial context:\n- The sampling interval is $\\Delta z$.\n- The spatial sampling rate (or sampling frequency) is $f_s = \\frac{1}{\\Delta z}$ (in cycles per meter).\n- The corresponding angular spatial sampling frequency is $k_s = 2\\pi f_s = \\frac{2\\pi}{\\Delta z}$ (in radians per meter).\n\nThe Nyquist frequency is half the sampling rate, which represents the highest frequency that can be uniquely resolved.\n- The Nyquist frequency in cycles per meter is $f_{\\text{Nyquist}} = \\frac{f_s}{2} = \\frac{1}{2\\Delta z}$.\n- The angular Nyquist frequency in radians per meter is $k_{\\text{Nyquist}} = \\frac{k_s}{2} = \\frac{1}{2} \\left(\\frac{2\\pi}{\\Delta z}\\right) = \\frac{\\pi}{\\Delta z}$.\n\nAny frequency component in the original continuous signal $\\phi(z)$ (and thus in $I_m(z)$) with an angular frequency $|k|  k_{\\text{Nyquist}}$ will be aliased. Aliasing means that upon sampling, this high-frequency component becomes indistinguishable from a lower-frequency component within the range $[-k_{\\text{Nyquist}}, k_{\\text{Nyquist}}]$. For example, a sink/source pattern with a true frequency of $k_{\\text{Nyquist}} + \\delta k$ will appear to have a frequency of $k_{\\text{Nyquist}} - \\delta k$ in the sampled data. This distortion makes it impossible to uniquely determine the true CSD pattern for any components above the Nyquist frequency.\n\nThe CSD is calculated *from* the sampled LFP data. Therefore, the information available to construct the CSD is fundamentally limited by the sampling of the LFP. The highest spatial frequency we can possibly resolve for the CSD pattern is the highest spatial frequency we can resolve from the sampled LFP data. This limit is precisely the angular Nyquist frequency.\n\nTherefore, the maximum resolvable angular spatial frequency for the sinks/sources pattern, $k_{\\max}$, is equal to the angular Nyquist frequency determined by the sampling interval $\\Delta z$.\n\n$$ k_{\\max} = k_{\\text{Nyquist}} = \\frac{\\pi}{\\Delta z} $$\nThis result can be interpreted physically: to resolve a sinusoidal pattern of sinks and sources, we need at least two sample points per spatial wavelength, $\\lambda$. The minimum resolvable wavelength is therefore $\\lambda_{\\min} = 2 \\Delta z$. The maximum resolvable angular wavenumber is related to this wavelength by $k_{\\max} = \\frac{2\\pi}{\\lambda_{\\min}}$, which gives $k_{\\max} = \\frac{2\\pi}{2\\Delta z} = \\frac{\\pi}{\\Delta z}$.",
            "answer": "$$\\boxed{\\frac{\\pi}{\\Delta z}}$$"
        },
        {
            "introduction": "To deepen our understanding of the biophysics, we can reverse the process and simulate the potential field that a known current distribution would generate. This 'forward problem' is a powerful tool for building intuition and validating analysis methods . In this computational exercise, you will implement a Green's function solution to Poisson's equation to calculate the LFP arising from predefined CSD profiles, effectively simulating the physics from first principles.",
            "id": "4152612",
            "problem": "You are given a homogeneous, isotropic, one-dimensional slab representing the cortical depth for Local Field Potential (LFP) modeling. Under the quasi-static approximation of electrodynamics in a conductive medium, the scalar electric potential $\\phi(z)$ within the slab satisfies the one-dimensional volume conductor equation with homogeneous conductivity. The vertical coordinate $z$ spans the interval $[0,H]$, where $H$ is the slab thickness. The governing relationship between the potential $\\phi(z)$ and the current source density $CSD(z)$ (in $\\mathrm{A/m^3}$) is obtained by reducing the conservation of charge equation to one dimension. The slab has Dirichlet boundary conditions at both ends. Your task is to compute the expected potential $\\phi(z)$ given prescribed $CSD(z)$ profiles using the appropriate Green’s function and boundary conditions.\n\nFundamental basis to start from:\n- The quasi-static volume conductor equation in a homogeneous medium with conductivity $\\sigma$ is $\\nabla \\cdot (\\sigma \\nabla \\phi) = -s(\\mathbf{r})$, where $s(\\mathbf{r})$ is the current source density.\n- In one dimension with spatial dependence only along $z$, this reduces to the second-order ordinary differential equation $\\sigma \\,\\frac{d^2 \\phi}{dz^2} = -CSD(z)$ on $z \\in [0,H]$.\n- Apply Dirichlet boundary conditions $\\phi(0) = 0$ and $\\phi(H) = 0$.\n\nYou must derive the appropriate Green’s function for the operator $\\frac{d^2}{dz^2}$ under these boundary conditions and formulate the potential $\\phi(z)$ as an integral against the prescribed $CSD(z)$ profile. Then, implement a numerical algorithm to evaluate $\\phi(z)$ for the following test suite of parameterized cases.\n\nPhysical units and reporting:\n- Conductivity $\\sigma$ must be in $\\mathrm{S/m}$.\n- Slab thickness $H$ must be in $\\mathrm{m}$.\n- Current source density $CSD(z)$ must be in $\\mathrm{A/m^3}$.\n- Report potential values $\\phi$ in $\\mathrm{V}$.\n- Angles are not involved.\n- Express any fractions or ratios as decimals in the output.\n\nUse a uniform grid of $N$ sample points along $z$ with $z_i = i \\,\\Delta z$ for $i \\in \\{0,1,\\dots,N-1\\}$, $\\Delta z = H/(N-1)$, and choose $N$ such that $z = H/4$, $z = H/2$, and $z = 3H/4$ are exactly on the grid. For numeric integration, use a well-posed Riemann sum or the trapezoidal rule that is consistent with the continuous integral implied by the Green’s function representation. The slab parameters are the same for all cases: $H = 1\\times 10^{-3}$ m, $\\sigma = 0.3$ S/m, $N = 201$.\n\nTest suite of $CSD(z)$ profiles:\n1. Constant source density:\n   - $CSD(z) = J_0$ with $J_0 = 1000$ A/m^3.\n2. Symmetric Gaussian source-sink pair (zero-mean dipole-like):\n   - $CSD(z) = A \\left[\\exp\\!\\left(-\\frac{(z - z_0)^2}{2 w^2}\\right) - \\exp\\!\\left(-\\frac{(z - z_1)^2}{2 w^2}\\right)\\right]$,\n   - Parameters: $A = 1000$ A/m^3, $z_0 = 0.4H$, $z_1 = 0.6H$, $w = 0.05H$.\n3. Asymmetric, narrow Gaussian pair (edge-case with different amplitudes and widths):\n   - $CSD(z) = A_1 \\exp\\!\\left(-\\frac{(z - z_0)^2}{2 w_1^2}\\right) - A_2 \\exp\\!\\left(-\\frac{(z - z_1)^2}{2 w_2^2}\\right)$,\n   - Parameters: $A_1 = 2000$ A/m^3, $A_2 = 1500$ A/m^3, $z_0 = 0.25H$, $z_1 = 0.75H$, $w_1 = 0.01H$, $w_2 = 0.015H$.\n4. No sources:\n   - $CSD(z) = 0$ for all $z$.\n\nFor each case, compute the potential $\\phi(z)$ over the grid using the derived Green’s function and numerical integration. Extract and report the values of $\\phi(z)$ at $z = H/4$, $z = H/2$, and $z = 3H/4$ in volts. Your program should produce a single line of output containing a list of the three-element results for each case, aggregated as a comma-separated list enclosed in square brackets. For example, the format must be $[[\\phi_{1,H/4},\\phi_{1,H/2},\\phi_{1,3H/4}], [\\phi_{2,H/4},\\phi_{2,H/2},\\phi_{2,3H/4}], [\\phi_{3,H/4},\\phi_{3,H/2},\\phi_{3,3H/4}], [\\phi_{4,H/4},\\phi_{4,H/2},\\phi_{4,3H/4}]]$, but without any additional spaces, and using numeric decimals for the entries.",
            "solution": "The problem is valid. It is scientifically grounded in the principles of quasi-static electrodynamics, mathematically well-posed as a one-dimensional boundary value problem, and provides a complete and consistent set of parameters and conditions for its solution.\n\nThe problem asks for the electric potential $\\phi(z)$ generated by a given current source density $CSD(z)$ in a one-dimensional conductive slab of thickness $H$. The governing physics is described by the one-dimensional Poisson equation, which is a reduction of the volume conductor equation under the specified approximations.\n\nThe governing differential equation is:\n$$ \\sigma \\frac{d^2 \\phi}{dz^2} = -CSD(z) \\quad \\text{for } z \\in [0, H] $$\nwhere $\\sigma$ is the electrical conductivity. The equation can be rewritten in the standard form of a Poisson equation:\n$$ \\frac{d^2 \\phi}{dz^2} = -\\frac{CSD(z)}{\\sigma} $$\nThe problem is subject to homogeneous Dirichlet boundary conditions:\n$$ \\phi(0) = 0 \\quad \\text{and} \\quad \\phi(H) = 0 $$\nThis is a linear, second-order ordinary differential equation with specified boundary conditions, which can be solved efficiently using a Green's function approach.\n\nFirst, we must derive the Green's function $G(z, z')$ corresponding to the operator $L = \\frac{d^2}{dz^2}$ and the given boundary conditions. The Green's function is the solution to the equation:\n$$ \\frac{d^2 G(z, z')}{dz^2} = \\delta(z - z') $$\nsubject to $G(0, z') = 0$ and $G(H, z') = 0$. Here, $\\delta(z-z')$ is the Dirac delta function, representing a point source at $z=z'$.\n\nTo construct $G(z, z')$, we solve the homogeneous equation $\\frac{d^2G}{dz^2} = 0$ in two separate domains, $z  z'$ and $z  z'$, and then apply matching conditions at $z=z'$.\n\nFor $z \\in [0, z')$, the general solution is $G_1(z, z') = A_1 z + B_1$. The boundary condition $G(0, z')=0$ implies $B_1=0$, so $G_1(z, z') = A_1 z$.\n\nFor $z \\in (z', H]$, the general solution is $G_2(z, z') = A_2 z + B_2$. The boundary condition $G(H, z')=0$ implies $A_2 H + B_2 = 0$, so $B_2 = -A_2 H$. This gives $G_2(z, z') = A_2(z - H)$.\n\nAt the point $z=z'$, two conditions must be met:\n1.  Continuity of the Green's function: $G_1(z', z') = G_2(z', z')$.\n    $$ A_1 z' = A_2(z' - H) $$\n2.  A jump discontinuity in the first derivative, obtained by integrating the defining equation across $z=z'$:\n    $$ \\int_{z'-\\epsilon}^{z'+\\epsilon} \\frac{d^2 G}{dz^2} dz = \\int_{z'-\\epsilon}^{z'+\\epsilon} \\delta(z-z') dz = 1 $$\n    $$ \\frac{dG_2}{dz}\\bigg|_{z=z'} - \\frac{dG_1}{dz}\\bigg|_{z=z'} = 1 \\implies A_2 - A_1 = 1 $$\n\nWe now have a system of two linear equations for the coefficients $A_1$ and $A_2$:\n$$ A_1 z' = (A_1 + 1)(z' - H) \\implies A_1 z' = A_1 z' - A_1 H + z' - H \\implies A_1 H = z' - H \\implies A_1 = \\frac{z' - H}{H} $$\n$$ A_2 = A_1 + 1 = \\frac{z' - H}{H} + 1 = \\frac{z'}{H} $$\nSubstituting these coefficients back into the expressions for $G_1$ and $G_2$, we obtain the complete Green's function:\n$$ G(z, z') = \\begin{cases} \\frac{z(z' - H)}{H}  \\text{for } 0 \\le z \\le z' \\\\ \\frac{z'(z - H)}{H}  \\text{for } z'  z \\le H \\end{cases} $$\nThis function is symmetric, $G(z, z') = G(z', z)$, as expected for a self-adjoint operator.\n\nThe solution $\\phi(z)$ to the original non-homogeneous equation can now be expressed as an integral of the source term weighted by the Green's function:\n$$ \\phi(z) = \\int_0^H G(z, z') \\left( -\\frac{CSD(z')}{\\sigma} \\right) dz' $$\n$$ \\phi(z) = -\\frac{1}{\\sigma} \\int_0^H G(z, z') CSD(z') dz' $$\n\nTo compute the potential numerically, we discretize the spatial domain $z \\in [0, H]$ into a uniform grid of $N$ points, $z_i = i \\Delta z$ for $i \\in \\{0, 1, \\dots, N-1\\}$, where $\\Delta z = H/(N-1)$. The integral is then approximated by a numerical quadrature rule. The trapezoidal rule is an appropriate and specified choice for this task. For a given potential evaluation point $z$, the integral is computed as:\n$$ \\int_0^H F(z') dz' \\approx \\sum_{j=0}^{N-2} \\frac{F(z'_j) + F(z'_{j+1})}{2} \\Delta z $$\nwhere $z'_j$ represents the points on the integration grid and $F(z') = G(z, z') CSD(z')$.\n\nThe algorithm proceeds as follows for each test case:\n1.  Define the parameters $H = 1 \\times 10^{-3}~\\mathrm{m}$, $\\sigma = 0.3~\\mathrm{S/m}$, and $N = 201$.\n2.  Establish the discrete spatial grid $z_j = j \\cdot H/(N-1)$ for $j=0, \\dots, N-1$.\n3.  For the specific test case, compute the values of $CSD(z_j)$ at each grid point.\n4.  Identify the grid points corresponding to the query locations $z=H/4$, $z=H/2$, and $z=3H/4$. The problem setup guarantees these are exact grid points.\n5.  For each query point $z_q$:\n    a. Construct the integrand vector $F_j = G(z_q, z_j) \\cdot CSD(z_j)$. The Green's function $G(z_q, z_j)$ is computed using the derived piecewise formula.\n    b. Compute the integral of $F_j$ over the grid $z_j$ using the trapezoidal rule.\n    c. Calculate the potential $\\phi(z_q)$ by multiplying the integral result by $-1/\\sigma$.\n6.  Collect the three potential values for the case and format them as required. This process is repeated for all four specified $CSD(z)$ profiles.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the electric potential phi(z) for various CSD profiles in a 1D slab.\n\n    The solution is based on the Green's function method for the 1D Poisson equation\n    with Dirichlet boundary conditions. The potential is calculated via numerical\n    integration using the trapezoidal rule.\n    \"\"\"\n\n    # 1. Define constants and grid\n    H = 1.0e-3  # Slab thickness in meters\n    sigma = 0.3  # Conductivity in S/m\n    N = 201  # Number of grid points\n\n    z_grid = np.linspace(0, H, N)\n    # Probe indices are guaranteed to be integers by problem specification\n    probe_indices = [int((N - 1) / 4), int((N - 1) / 2), int(3 * (N - 1) / 4)]\n\n    # 2. Define the Green's function for the operator d^2/dz^2 on [0, H]\n    # with Dirichlet boundary conditions phi(0)=0, phi(H)=0.\n    def green_function(z, z_prime_vec, H_val):\n        \"\"\"\n        Calculates the Green's function G(z, z').\n\n        Args:\n            z (float): The evaluation point for the potential.\n            z_prime_vec (np.ndarray): The grid of source points.\n            H_val (float): The thickness of the slab.\n\n        Returns:\n            np.ndarray: The values of the Green's function G(z, z') for the given z\n                        and each z' in z_prime_vec.\n        \"\"\"\n        return np.where(z = z_prime_vec,\n                        z * (z_prime_vec - H_val) / H_val,\n                        z_prime_vec * (z - H_val) / H_val)\n\n    # 3. Define CSD profiles for the four test cases\n    csd_profiles = []\n\n    # Case 1: Constant source density\n    J0 = 1000.0  # A/m^3\n    csd1 = np.full_like(z_grid, J0)\n    csd_profiles.append(csd1)\n\n    # Case 2: Symmetric Gaussian source-sink pair\n    A = 1000.0  # A/m^3\n    z0_2 = 0.4 * H\n    z1_2 = 0.6 * H\n    w_2 = 0.05 * H\n    csd2 = A * (np.exp(-(z_grid - z0_2)**2 / (2 * w_2**2)) -\n                np.exp(-(z_grid - z1_2)**2 / (2 * w_2**2)))\n    csd_profiles.append(csd2)\n\n    # Case 3: Asymmetric, narrow Gaussian pair\n    A1 = 2000.0  # A/m^3\n    A2 = 1500.0  # A/m^3\n    z0_3 = 0.25 * H\n    z1_3 = 0.75 * H\n    w1_3 = 0.01 * H\n    w2_3 = 0.015 * H\n    csd3 = (A1 * np.exp(-(z_grid - z0_3)**2 / (2 * w1_3**2)) -\n            A2 * np.exp(-(z_grid - z1_3)**2 / (2 * w2_3**2)))\n    csd_profiles.append(csd3)\n\n    # Case 4: No sources\n    csd4 = np.zeros_like(z_grid)\n    csd_profiles.append(csd4)\n\n    # 4. Main calculation loop\n    all_results = []\n    for csd_values in csd_profiles:\n        case_results = []\n        for idx in probe_indices:\n            z_probe = z_grid[idx]\n\n            # The integrand is the product of the Green's function and the CSD\n            integrand = green_function(z_probe, z_grid, H) * csd_values\n\n            # Perform numerical integration using the trapezoidal rule\n            integral_val = np.trapz(integrand, x=z_grid)\n\n            # Calculate potential phi = -1/sigma * integral(G * CSD)\n            phi = -1.0 / sigma * integral_val\n            case_results.append(phi)\n\n        all_results.append(case_results)\n\n    # 5. Format and print the output exactly as specified\n    inner_formatted = [f\"[{','.join(map(str, r))}]\" for r in all_results]\n    final_output_str = f\"[{','.join(inner_formatted)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}