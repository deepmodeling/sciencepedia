{
    "hands_on_practices": [
        {
            "introduction": "The macroscopic signals we measure with EEG are not a perfect reflection of the underlying synaptic activity. The very membrane of the neuron acts as a filter, shaping the frequency content of the signal before it even leaves the cell. This practice  guides you through a fundamental biophysical calculation, modeling the dendrite as a passive RC circuit to demonstrate how it attenuates high-frequency inputs, a key principle explaining the characteristic frequency spectrum of brain signals.",
            "id": "4142652",
            "problem": "A population of aligned cortical pyramidal neurons generates the macroscopic current dipole moment vector $\\mathbf{p}(t)$ that underlies Electroencephalography (EEG) signals. Assume each neuron’s distal apical dendrite can be approximated as a passive lumped membrane with resistance $R_{m}$ and capacitance $C_{m}$, driven by a sinusoidal synaptic current density $i_{s}(t) = i_{0} \\cos(2 \\pi f t)$ applied near the distal dendrite. The soma serves as a reference, so the output variable of interest is the distal–soma membrane potential difference $V(t)$ along the dendritic axis, which linearly contributes to $\\mathbf{p}(t)$ through geometry and axial coupling. The extracellular medium and head tissues are well-described by the quasi-static approximation of Maxwell’s equations at EEG frequencies, so the scalp potential is proportional to $\\mathbf{p}(t)$ with a frequency-independent proportionality constant over the band considered.\n\nStarting from the linear membrane current balance and the definition of the membrane time constant $\\tau_{m} = R_{m} C_{m}$, derive the frequency dependence of the amplitude of $\\mathbf{p}(t)$ for sinusoidal drive $i_{s}(t)$, showing how passive dendritic filtering produces frequency-dependent attenuation. Then, using the quasi-static volume conduction assumption, predict the relative decrease in scalp EEG gain at $f_{2} = 100$ Hz compared to $f_{1} = 10$ Hz for a membrane time constant $\\tau_{m} = 20$ ms, assuming the same drive amplitude $i_{0}$ at both frequencies and identical neuronal alignment and head geometry.\n\nExpress your final result as the unitless ratio of scalp EEG gain at $f_{2} = 100$ Hz to that at $f_{1} = 10$ Hz, and round your answer to four significant figures.",
            "solution": "The problem asks for a derivation of the frequency-dependent attenuation of the neuronal dipole moment and a subsequent calculation of the relative EEG gain at two different frequencies, based on a simplified biophysical model.\n\nFirst, we validate the problem statement.\n**Step 1: Extract Givens**\n- System: A population of aligned cortical pyramidal neurons.\n- Macroscopic source: Current dipole moment vector $\\mathbf{p}(t)$.\n- Neuronal model: Each neuron's distal apical dendrite is a passive lumped membrane.\n- Lumped parameters: Resistance $R_{m}$, Capacitance $C_{m}$.\n- Input: Sinusoidal synaptic current density $i_{s}(t) = i_{0} \\cos(2 \\pi f t)$.\n- Output variable: Distal–soma membrane potential difference $V(t)$.\n- Source-output relation: $V(t)$ linearly contributes to $\\mathbf{p}(t)$.\n- Volume conductor model: Quasi-static approximation of Maxwell’s equations.\n- Scalp potential relation: Proportional to $\\mathbf{p}(t)$ with a frequency-independent proportionality constant.\n- Definition: Membrane time constant $\\tau_{m} = R_{m} C_{m}$.\n- Task 1: Derive the frequency dependence of the amplitude of $\\mathbf{p}(t)$.\n- Task 2: Predict the relative decrease in scalp EEG gain at $f_{2} = 100$ Hz compared to $f_{1} = 10$ Hz.\n- Parameter values: $\\tau_{m} = 20$ ms, $f_{1} = 10$ Hz, $f_{2} = 100$ Hz.\n- Assumption: Same drive amplitude $i_{0}$ at both frequencies.\n- Final output format: Unitless ratio of scalp EEG gain at $f_{2}$ to that at $f_{1}$, rounded to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, employing standard models from computational neuroscience: the lumped RC circuit for a passive membrane patch and the quasi-static approximation for volume conduction in EEG. It is well-posed, providing all necessary information and assumptions to arrive at a unique solution. The language is objective and precise. The problem is valid.\n\n**Step 3: Verdict and Action**\nThe problem is valid. We proceed with the solution.\n\nThe current balance for a lumped passive membrane models the neuron as a parallel RC circuit. The total injected synaptic current, $I_{s}(t)$, is distributed between the resistive path (leak currents) and the capacitive path (charging/discharging the membrane). The governing differential equation is:\n$$I_{s}(t) = \\frac{V(t)}{R_{m}} + C_{m} \\frac{dV(t)}{dt}$$\nwhere $V(t)$ is the membrane potential difference. The injected current $I_{s}(t)$ is proportional to the given synaptic current density $i_{s}(t)$, so we can write $I_{s}(t) = I_{0}\\cos(\\omega t)$, where $\\omega = 2\\pi f$ is the angular frequency and the amplitude $I_{0}$ is proportional to $i_{0}$.\n\nUsing the definition of the membrane time constant, $\\tau_{m} = R_{m}C_{m}$, we can multiply the equation by $R_{m}$:\n$$R_{m}I_{s}(t) = V(t) + R_{m}C_{m}\\frac{dV(t)}{dt}$$\n$$\\tau_{m} \\frac{dV(t)}{dt} + V(t) = R_{m}I_{s}(t)$$\nTo find the steady-state sinusoidal response, we use complex phasors. Let $I_{s}(t) = \\text{Re}\\{\\tilde{I}_{s}(t)\\}$ with $\\tilde{I}_{s}(t) = I_{0}\\exp(j\\omega t)$, and assume a solution of the form $V(t) = \\text{Re}\\{\\tilde{V}(t)\\}$ with $\\tilde{V}(t) = \\tilde{V}_{\\text{amp}}\\exp(j\\omega t)$, where $\\tilde{V}_{\\text{amp}}$ is the complex amplitude. Substituting into the ODE:\n$$\\tau_{m} \\frac{d}{dt}(\\tilde{V}_{\\text{amp}}\\exp(j\\omega t)) + \\tilde{V}_{\\text{amp}}\\exp(j\\omega t) = R_{m}I_{0}\\exp(j\\omega t)$$\n$$\\tau_{m}(j\\omega)\\tilde{V}_{\\text{amp}}\\exp(j\\omega t) + \\tilde{V}_{\\text{amp}}\\exp(j\\omega t) = R_{m}I_{0}\\exp(j\\omega t)$$\nDividing by $\\exp(j\\omega t)$:\n$$(1 + j\\omega\\tau_{m})\\tilde{V}_{\\text{amp}} = R_{m}I_{0}$$\nThe complex amplitude of the voltage is:\n$$\\tilde{V}_{\\text{amp}}(f) = \\frac{R_{m}I_{0}}{1 + j(2\\pi f)\\tau_{m}}$$\nThe real-valued amplitude of the voltage, $V_{\\text{amp}}(f)$, is the magnitude of this complex number:\n$$V_{\\text{amp}}(f) = |\\tilde{V}_{\\text{amp}}(f)| = \\left|\\frac{R_{m}I_{0}}{1 + j(2\\pi f)\\tau_{m}}\\right| = \\frac{R_{m}I_{0}}{|1 + j(2\\pi f)\\tau_{m}|} = \\frac{R_{m}I_{0}}{\\sqrt{1^{2} + (2\\pi f \\tau_{m})^{2}}}$$\nThe problem states that the dipole moment amplitude, $p_{\\text{amp}}(f)$, is linearly proportional to $V_{\\text{amp}}(f)$. Thus, the frequency dependence of $p_{\\text{amp}}(f)$ is:\n$$p_{\\text{amp}}(f) \\propto \\frac{1}{\\sqrt{1 + (2\\pi f \\tau_{m})^{2}}}$$\nThis result shows that the passive dendritic membrane acts as a low-pass filter, attenuating higher frequencies.\n\nNext, we address the scalp EEG gain. The quasi-static assumption implies the amplitude of the scalp potential, $V_{\\text{scalp, amp}}(f)$, is proportional to $p_{\\text{amp}}(f)$ via a frequency-independent constant. Therefore, we have a chain of proportionalities:\n$$V_{\\text{scalp, amp}}(f) \\propto p_{\\text{amp}}(f) \\propto V_{\\text{amp}}(f)$$\nThe EEG gain is defined as the ratio of an output amplitude to an input amplitude. We are asked for the relative decrease in gain, which is a ratio of gains. Let's define the gain $G(f)$ as being proportional to the scalp potential amplitude for a given synaptic drive amplitude $i_{0}$. Since $I_{0} \\propto i_{0}$, and all other proportionality constants are frequency-independent:\n$$G(f) \\propto \\frac{V_{\\text{scalp, amp}}(f)}{i_{0}} \\propto \\frac{V_{\\text{amp}}(f)}{i_{0}} \\propto \\frac{R_{m}I_{0}}{i_{0}\\sqrt{1 + (2\\pi f \\tau_{m})^{2}}} \\propto \\frac{1}{\\sqrt{1 + (2\\pi f \\tau_{m})^{2}}}$$\nWe need to find the ratio of the gain at $f_{2}=100$ Hz to the gain at $f_{1}=10$ Hz.\n$$\\text{Ratio} = \\frac{G(f_{2})}{G(f_{1})} = \\frac{C/\\sqrt{1 + (2\\pi f_{2} \\tau_{m})^{2}}}{C/\\sqrt{1 + (2\\pi f_{1} \\tau_{m})^{2}}} = \\sqrt{\\frac{1 + (2\\pi f_{1} \\tau_{m})^{2}}{1 + (2\\pi f_{2} \\tau_{m})^{2}}}$$\nWe are given the values:\n$f_{1} = 10\\text{ Hz}$\n$f_{2} = 100\\text{ Hz}$\n$\\tau_{m} = 20\\text{ ms} = 20 \\times 10^{-3}\\text{ s} = 0.02\\text{ s}$\n\nFirst, we calculate the dimensionless products $2\\pi f \\tau_{m}$:\nFor $f_{1}$: $2\\pi f_{1} \\tau_{m} = 2\\pi(10)(0.02) = 0.4\\pi$\nFor $f_{2}$: $2\\pi f_{2} \\tau_{m} = 2\\pi(100)(0.02) = 4\\pi$\n\nNow, we substitute these values into the ratio expression:\n$$\\text{Ratio} = \\sqrt{\\frac{1 + (0.4\\pi)^{2}}{1 + (4\\pi)^{2}}} = \\sqrt{\\frac{1 + 0.16\\pi^{2}}{1 + 16\\pi^{2}}}$$\nUsing a calculator for the numerical value:\n$$ \\text{Ratio} = \\sqrt{\\frac{1 + 0.16(9.8696...)}{1 + 16(9.8696...)}} = \\sqrt{\\frac{1 + 1.5791...}{1 + 157.9136...}} = \\sqrt{\\frac{2.5791...}{158.9136...}} $$\n$$ \\text{Ratio} \\approx \\sqrt{0.0162295} \\approx 0.127395... $$\nRounding to four significant figures, the result is $0.1274$.",
            "answer": "$$\\boxed{0.1274}$$"
        },
        {
            "introduction": "Once a signal is generated by a population of neurons, it must travel through the brain, skull, and scalp to be detected by EEG or MEG sensors. The physical properties of these tissues profoundly and differently affect electric potentials and magnetic fields. This exercise  provides a hands-on comparison of the two modalities by having you calculate the signal-to-noise ratio for both EEG and MEG from a typical cortical source, revealing their complementary strengths and weaknesses.",
            "id": "4142677",
            "problem": "An elementary cortical source is modeled as a point current dipole of moment $p = 50\\,\\mathrm{nA\\cdot m}$ embedded in a spherically symmetric, ohmic head. The head radius is $R = 0.09\\,\\mathrm{m}$. For Electroencephalography (EEG), consider a radially oriented dipole located at cortical depth $d = 0.015\\,\\mathrm{m}$ below the scalp, measured at the scalp directly above the source. For Magnetoencephalography (MEG), consider a tangentially oriented dipole (perpendicular to the local radial) at the same location, measured by a magnetometer positioned a standoff distance $s = 0.020\\,\\mathrm{m}$ above the scalp along the local radial. Assume brain tissue conductivity $\\sigma = 0.33\\,\\mathrm{S/m}$ and magnetic permeability of free space $\\mu_{0} = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$. To capture realistic head physics, model skull-induced attenuation of EEG potentials by a multiplicative factor $\\alpha = 0.20$, and the reduction of external magnetic field relative to the free-space current-dipole expression by a geometry factor $\\gamma = 0.15$ for the MEG configuration described.\n\nInstrument noise is specified as follows: EEG electrode root-mean-square (RMS) noise $v_{n} = 1\\,\\mathrm{\\mu V}$ in the analysis bandwidth, and MEG magnetometer noise spectral density $b_{n0} = 3\\,\\mathrm{fT}/\\sqrt{\\mathrm{Hz}}$, analyzed over bandwidth $\\Delta f = 40\\,\\mathrm{Hz}$, so that MEG RMS noise equals $b_{n0}\\sqrt{\\Delta f}$. Using only quasi-static Maxwell equations, Ohm’s law in conductors, and the definitions of signal-to-noise ratio (SNR), derive leading-order expressions for the EEG scalp potential and the MEG magnetic field at the specified sensors for the stated source orientations, and compute the modality-specific SNRs:\n- $\\,\\mathrm{SNR}_{\\mathrm{EEG}} = \\dfrac{\\text{EEG signal amplitude}}{v_{n}}$,\n- $\\,\\mathrm{SNR}_{\\mathrm{MEG}} = \\dfrac{\\text{MEG signal amplitude}}{b_{n0}\\sqrt{\\Delta f}}$.\n\nRound the final numerical SNRs to three significant figures and report them as a two-entry row matrix in the order $\\left(\\mathrm{SNR}_{\\mathrm{EEG}},\\,\\mathrm{SNR}_{\\mathrm{MEG}}\\right)$. The SNRs are dimensionless. Then, based on your derivation, argue which modality yields higher detectability for the specified source.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded, well-posed, and objective. All necessary parameters for the calculation are provided, and the scenario is a standard, albeit simplified, model used in the biophysics of neuroimaging.\n\nThe objective is to compute the signal-to-noise ratio (SNR) for an Electroencephalography (EEG) measurement of a radial cortical source and a Magnetoencephalography (MEG) measurement of a tangential cortical source, and to compare their detectability.\n\n**1. EEG Signal and SNR Calculation**\n\nThe biophysical origin of the EEG signal is the volume currents generated by synchronous neural activity, which can be modeled as a current dipole $\\vec{p}$. For a current dipole in an infinite, homogeneous, conductive medium with conductivity $\\sigma$, the electric potential $V$ at a position vector $\\vec{r}$ relative to the dipole is given by:\n$$\nV(\\vec{r}) = \\frac{1}{4\\pi\\sigma} \\frac{\\vec{p} \\cdot \\vec{r}}{|\\vec{r}|^3}\n$$\nThe problem specifies a radially oriented dipole. The EEG electrode is placed on the scalp directly above the source. This means the dipole moment vector $\\vec{p}$ and the position vector $\\vec{r}$ from the source to the electrode are collinear. The magnitude of $\\vec{r}$ is the cortical depth $d$. Thus, the dot product becomes $\\vec{p} \\cdot \\vec{r} = |\\vec{p}| |\\vec{r}| \\cos(0) = p d$. The leading-order expression for the potential in an infinite medium is:\n$$\nV_{\\infty} = \\frac{1}{4\\pi\\sigma} \\frac{p d}{d^3} = \\frac{p}{4\\pi\\sigma d^2}\n$$\nThe problem states that skull-induced attenuation and other geometric effects are modeled by a multiplicative factor $\\alpha$. The EEG signal amplitude at the scalp, $V_{\\mathrm{EEG}}$, is therefore:\n$$\nV_{\\mathrm{EEG}} = \\alpha V_{\\infty} = \\frac{\\alpha p}{4\\pi\\sigma d^2}\n$$\nThe signal-to-noise ratio for EEG, $\\mathrm{SNR}_{\\mathrm{EEG}}$, is defined as the ratio of this signal amplitude to the RMS noise voltage $v_{n}$:\n$$\n\\mathrm{SNR}_{\\mathrm{EEG}} = \\frac{V_{\\mathrm{EEG}}}{v_{n}} = \\frac{\\alpha p}{4\\pi\\sigma d^2 v_{n}}\n$$\nSubstituting the given values:\n- $p = 50\\,\\mathrm{nA\\cdot m} = 50 \\times 10^{-9}\\,\\mathrm{A\\cdot m}$\n- $\\alpha = 0.20$\n- $\\sigma = 0.33\\,\\mathrm{S/m}$\n- $d = 0.015\\,\\mathrm{m}$\n- $v_{n} = 1\\,\\mathrm{\\mu V} = 1 \\times 10^{-6}\\,\\mathrm{V}$\n\n$$\n\\mathrm{SNR}_{\\mathrm{EEG}} = \\frac{0.20 \\times (50 \\times 10^{-9}\\,\\mathrm{A\\cdot m})}{4\\pi (0.33\\,\\mathrm{S/m}) (0.015\\,\\mathrm{m})^2 (1 \\times 10^{-6}\\,\\mathrm{V})}\n$$\n$$\n\\mathrm{SNR}_{\\mathrm{EEG}} = \\frac{10 \\times 10^{-9}}{4\\pi (0.33) (2.25 \\times 10^{-4}) (1 \\times 10^{-6})} = \\frac{10^{-8}}{9.3283 \\times 10^{-10}} \\approx 10.720\n$$\nRounding to three significant figures, $\\mathrm{SNR}_{\\mathrm{EEG}} \\approx 10.7$.\n\n**2. MEG Signal and SNR Calculation**\n\nThe biophysical origin of the MEG signal is the magnetic field produced by the primary intracellular currents in neurons. According to the quasi-static formulation of the Biot-Savart law, the magnetic field $\\vec{B}$ from a current dipole $\\vec{p}$ at a position $\\vec{r}$ is:\n$$\n\\vec{B}(\\vec{r}) = \\frac{\\mu_0}{4\\pi} \\frac{\\vec{p} \\times \\vec{r}}{|\\vec{r}|^3}\n$$\nwhere $\\mu_0$ is the magnetic permeability of free space. For MEG, a tangentially oriented dipole is considered, as a radial dipole in a spherically symmetric conductor produces no external magnetic field. Let the dipole be at the origin with moment $\\vec{p}$ along the $x$-axis, $\\vec{p} = p\\hat{x}$. The sensor is located along the local radial (the $z$-axis) at a distance of $d+s$ (depth plus standoff), so $\\vec{r} = (d+s)\\hat{z}$. The cross product is $\\vec{p} \\times \\vec{r} = (p\\hat{x}) \\times ((d+s)\\hat{z}) = -p(d+s)\\hat{y}$. The magnitude of the magnetic field vector, $B_{\\infty}$, is:\n$$\nB_{\\infty} = |\\vec{B}| = \\frac{\\mu_0}{4\\pi} \\frac{|\\vec{p} \\times \\vec{r}|}{|\\vec{r}|^3} = \\frac{\\mu_0}{4\\pi} \\frac{p(d+s)}{(d+s)^3} = \\frac{\\mu_0 p}{4\\pi (d+s)^2}\n$$\nThe problem models the effect of head geometry and volume currents with a reduction factor $\\gamma$. The MEG signal amplitude is:\n$$\nB_{\\mathrm{MEG}} = \\gamma B_{\\infty} = \\frac{\\gamma \\mu_0 p}{4\\pi (d+s)^2}\n$$\nThe MEG RMS noise, $b_n$, is given by the noise spectral density $b_{n0}$ over an analysis bandwidth $\\Delta f$:\n$$\nb_n = b_{n0} \\sqrt{\\Delta f}\n$$\nThe signal-to-noise ratio for MEG, $\\mathrm{SNR}_{\\mathrm{MEG}}$, is:\n$$\n\\mathrm{SNR}_{\\mathrm{MEG}} = \\frac{B_{\\mathrm{MEG}}}{b_n} = \\frac{\\gamma \\mu_0 p}{4\\pi (d+s)^2 b_{n0} \\sqrt{\\Delta f}}\n$$\nSubstituting the given values:\n- $\\gamma = 0.15$\n- $\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$\n- $p = 50 \\times 10^{-9}\\,\\mathrm{A\\cdot m}$\n- $d = 0.015\\,\\mathrm{m}$\n- $s = 0.020\\,\\mathrm{m}$\n- $b_{n0} = 3\\,\\mathrm{fT}/\\sqrt{\\mathrm{Hz}} = 3 \\times 10^{-15}\\,\\mathrm{T}/\\sqrt{\\mathrm{Hz}}$\n- $\\Delta f = 40\\,\\mathrm{Hz}$\n\n$$\n\\mathrm{SNR}_{\\mathrm{MEG}} = \\frac{0.15 \\times (4\\pi \\times 10^{-7}\\,\\mathrm{H/m}) (50 \\times 10^{-9}\\,\\mathrm{A\\cdot m})}{4\\pi (0.015\\,\\mathrm{m} + 0.020\\,\\mathrm{m})^2 (3 \\times 10^{-15}\\,\\mathrm{T}/\\sqrt{\\mathrm{Hz}}) \\sqrt{40\\,\\mathrm{Hz}}}\n$$\nThe $4\\pi$ terms cancel:\n$$\n\\mathrm{SNR}_{\\mathrm{MEG}} = \\frac{0.15 \\times (10^{-7}) (50 \\times 10^{-9})}{(0.035)^2 (3 \\times 10^{-15}) \\sqrt{40}} = \\frac{7.5 \\times 10^{-16}}{(1.225 \\times 10^{-3}) (3 \\times 10^{-15}) (6.3245...)}\n$$\n$$\n\\mathrm{SNR}_{\\mathrm{MEG}} = \\frac{7.5 \\times 10^{-16}}{2.3216 \\times 10^{-17}} \\approx 32.305\n$$\nRounding to three significant figures, $\\mathrm{SNR}_{\\mathrm{MEG}} \\approx 32.3$.\n\n**3. Comparison and Conclusion**\n\nThe calculated signal-to-noise ratios are $\\mathrm{SNR}_{\\mathrm{EEG}} \\approx 10.7$ and $\\mathrm{SNR}_{\\mathrm{MEG}} \\approx 32.3$.\nFor the specified source configurations, MEG yields a significantly higher SNR than EEG ($\\mathrm{SNR}_{\\mathrm{MEG}} > \\mathrm{SNR}_{\\mathrm{EEG}}$). This indicates that for a shallow ($d=0.015\\,\\mathrm{m}$), tangential cortical source, MEG provides superior detectability compared to EEG for a radial source at the same location, given the specified instrumentation noise levels.\n\nThe physical reasons for this outcome are embedded in the derived expressions:\n1.  **Conductivity Dependence**: The EEG signal is inversely proportional to the conductivity $\\sigma$ of the head tissues. More critically, the low-conductivity skull severely attenuates and smears the electric potential, an effect captured here by the small attenuation factor $\\alpha = 0.20$. In contrast, the magnetic field measured by MEG is largely unaffected by the skull's resistivity because biological tissues have magnetic permeability nearly identical to that of free space.\n2.  **Source Orientation**: The problem correctly assesses each modality's strength: EEG is sensitive to both radial and tangential sources but is most clearly interpreted for radial sources, which are modeled here. MEG is primarily sensitive to tangential sources, as radial sources in a spherical head produce no external magnetic field.\n3.  **Distance Dependence**: The MEG signal falls off as $1/(d+s)^2$, which includes the instrumental standoff distance $s$. The EEG signal (in this model) falls off as $1/d^2$. For this shallow source, the disadvantage of the added standoff distance for MEG is more than compensated for by the advantage of not being attenuated by the skull.\n\nTherefore, under these specific, realistic conditions, MEG demonstrates higher detectability.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 10.7 & 32.3 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The intricate folding of the cerebral cortex into gyri and sulci is not just a biological feature; it has critical implications for neuroimaging, particularly for MEG. Because MEG is primarily sensitive to tangential currents, the opposing orientation of neuron populations on opposite walls of a sulcus can lead to signal cancellation. In this coding practice , you will implement a computational model to quantify this cancellation effect, providing direct insight into why the geometry of a source is a crucial factor in its MEG visibility.",
            "id": "4142688",
            "problem": "A program must evaluate magnetic field cancellation in a simplified model of paired tangential current dipoles situated on opposite walls of a cortical sulcus, using a spherical head model and the quasi-static limit of electromagnetism. The goal is to quantify how paired dipoles with opposite tangential orientations reduce the externally measured magnetic field of Magnetoencephalography (MEG). The computational model must adhere to the following physical assumptions and definitions:\n\n- Quasi-static Maxwell equations apply, so displacement currents are negligible relative to conduction currents. The magnetic field $\\mathbf{B}(\\mathbf{r})$ obeys $\\nabla \\times \\mathbf{B} = \\mu_{0}\\mathbf{J}$ and $\\nabla \\cdot \\mathbf{B} = 0$, where $\\mathbf{J}$ is the current density and $\\mu_{0}$ is the vacuum permeability.\n- The primary current source is modeled as an ideal current dipole with dipole moment $\\mathbf{p}$ (in ampere-meter) at position $\\mathbf{r}_{0}$ (in meter), represented as a current density $\\mathbf{J}_{p}(\\mathbf{r}) = \\mathbf{p}\\,\\delta(\\mathbf{r} - \\mathbf{r}_{0})$.\n- The head is modeled as a spherically symmetric conductor of radius $R_{\\text{head}} = 0.09$ meter. Outside the head, the magnetic field is identical to that produced by the primary currents in a homogeneous infinite medium, due to spherical symmetry and the quasi-static regime. Hence, the external magnetic field due to a current dipole reduces to the Biot–Savart expression for a point current dipole in free space.\n\nUsing these assumptions, the magnetic field at position $\\mathbf{r}$ due to a single current dipole $\\mathbf{p}$ at $\\mathbf{r}_{0}$ is given by evaluating the Biot–Savart integral for $\\mathbf{J}_{p}$, yielding\n$$\n\\mathbf{B}(\\mathbf{r}) \\;=\\; \\frac{\\mu_{0}}{4\\pi}\\,\\frac{\\mathbf{p}\\times(\\mathbf{r}-\\mathbf{r}_{0})}{\\lVert \\mathbf{r}-\\mathbf{r}_{0}\\rVert^{3}}\\quad\\text{for}\\quad \\mathbf{r}\\neq \\mathbf{r}_{0},\n$$\nwith $\\mu_{0} = 4\\pi\\times 10^{-7}$ tesla-meter per ampere.\n\nDefine a fixed array of MEG sensors as points on a circular ring at a spherical radius $r_{\\text{sens}} = 0.10$ meter, at a constant polar angle $\\theta_{\\text{sens}} = 0.60$ radian from the positive $z$-axis, with azimuthal angles $\\phi_{k} = \\frac{2\\pi k}{N}$ for $k\\in\\{0,1,\\dots,N-1\\}$ and $N=16$. The sensor Cartesian coordinates are\n$$\n\\mathbf{r}_{k} \\;=\\; r_{\\text{sens}}\\begin{bmatrix}\n\\cos\\phi_{k}\\,\\sin\\theta_{\\text{sens}} \\\\\n\\sin\\phi_{k}\\,\\sin\\theta_{\\text{sens}} \\\\\n\\cos\\theta_{\\text{sens}}\n\\end{bmatrix}.\n$$\n\nModel a cortical sulcus as two nearby source locations on opposite walls, symmetrically arranged about the $y$-$z$ plane and at equal depth $z=z_{0}$ inside the head. Let the inter-wall separation be $d$ along the $x$-axis, so the dipole positions are\n$$\n\\mathbf{r}_{1} \\;=\\; \\begin{bmatrix} d/2 \\\\ 0 \\\\ z_{0}\\end{bmatrix},\\quad\n\\mathbf{r}_{2} \\;=\\; \\begin{bmatrix} -d/2 \\\\ 0 \\\\ z_{0}\\end{bmatrix}.\n$$\nAssume tangential orientation along the $y$-axis with opposite directions on opposing walls, so the dipole moments are\n$$\n\\mathbf{p}_{1} \\;=\\; \\begin{bmatrix} 0 \\\\ p_{0} \\\\ 0 \\end{bmatrix},\\quad\n\\mathbf{p}_{2} \\;=\\; \\begin{bmatrix} 0 \\\\ -s\\,p_{0} \\\\ 0 \\end{bmatrix},\n$$\nwhere $p_{0}$ is the nominal dipole magnitude in ampere-meter and $s$ is a nonnegative scalar describing inter-wall amplitude asymmetry. Use $p_{0} = 1.0\\times 10^{-7}$ ampere-meter.\n\nFor each sensor $\\mathbf{r}_{k}$, the total field from a given configuration of dipoles is the vector sum of the individual fields. For each test case, define the single-dipole baseline as the field produced by only $\\mathbf{p}_{1}$ at $\\mathbf{r}_{1}$, and define the paired configuration as the field produced by both $\\mathbf{p}_{1}$ at $\\mathbf{r}_{1}$ and $\\mathbf{p}_{2}$ at $\\mathbf{r}_{2}$.\n\nFor each test case, compute the following two scalar metrics:\n- A cancellation ratio $C$, defined as the ratio of the maximum norm of the paired field to the maximum norm of the single-dipole baseline field across the sensor ring:\n$$\nC \\;=\\; \\frac{\\max_{k}\\lVert \\mathbf{B}_{\\text{pair}}(\\mathbf{r}_{k})\\rVert}{\\max_{k}\\lVert \\mathbf{B}_{\\text{single}}(\\mathbf{r}_{k})\\rVert}.\n$$\n- A direction deviation angle $\\alpha$ in radians, defined at the sensor index $k^{\\star}$ that maximizes the single-dipole field norm:\n$$\nk^{\\star} \\;=\\; \\arg\\max_{k}\\lVert \\mathbf{B}_{\\text{single}}(\\mathbf{r}_{k})\\rVert,\\qquad\n\\alpha \\;=\\; \\arccos\\!\\left(\\frac{\\mathbf{B}_{\\text{single}}(\\mathbf{r}_{k^{\\star}})\\cdot \\mathbf{B}_{\\text{pair}}(\\mathbf{r}_{k^{\\star}})}{\\lVert \\mathbf{B}_{\\text{single}}(\\mathbf{r}_{k^{\\star}})\\rVert\\,\\lVert \\mathbf{B}_{\\text{pair}}(\\mathbf{r}_{k^{\\star}})\\rVert}\\right),\n$$\nwith the convention that if $\\lVert \\mathbf{B}_{\\text{pair}}(\\mathbf{r}_{k^{\\star}})\\rVert = 0$ then set $\\alpha = 0$.\n\nAll magnetic field vectors are in tesla, distances in meter, dipole moments in ampere-meter, and angles in radians. The final numeric outputs for $C$ and $\\alpha$ must be provided as floating-point values rounded to six decimal places.\n\nTest suite. Use the following four parameter sets, each specified as $(d,s,z_{0})$ in meter, unitless, and meter, respectively:\n- Case $1$: $(d,s,z_{0}) = (0.010,\\,1.0,\\,0.060)$\n- Case $2$: $(d,s,z_{0}) = (0.010,\\,0.8,\\,0.060)$\n- Case $3$: $(d,s,z_{0}) = (0.000,\\,1.0,\\,0.060)$\n- Case $4$: $(d,s,z_{0}) = (0.020,\\,1.0,\\,0.030)$\n\nRequired program behavior:\n- Implement the above physical model to compute the magnetic field at the $N=16$ sensors for each test case.\n- For each case, compute the cancellation ratio $C$ and the direction deviation angle $\\alpha$ as defined.\n- Your program should produce a single line of output containing the results as a comma-separated list of lists, each inner list being $[C,\\alpha]$ in the order of the specified cases, with each float rounded to six decimal places. For example: \"[[c1,a1],[c2,a2],[c3,a3],[c4,a4]]\".",
            "solution": "We begin from the quasi-static limit of electromagnetism, where displacement currents are negligible compared to conduction currents. The magnetic field $\\mathbf{B}(\\mathbf{r})$ and current density $\\mathbf{J}(\\mathbf{r})$ obey the fundamental relations $\\nabla \\times \\mathbf{B} = \\mu_{0}\\mathbf{J}$ and $\\nabla \\cdot \\mathbf{B} = 0$. The Biot–Savart law then provides the magnetic field produced at location $\\mathbf{r}$ by a steady current density $\\mathbf{J}(\\mathbf{r}')$:\n$$\n\\mathbf{B}(\\mathbf{r}) \\;=\\; \\frac{\\mu_{0}}{4\\pi}\\int_{\\mathbb{R}^{3}}\\frac{\\mathbf{J}(\\mathbf{r}')\\times(\\mathbf{r}-\\mathbf{r}')}{\\lVert \\mathbf{r}-\\mathbf{r}'\\rVert^{3}}\\,d^{3}\\mathbf{r}'.\n$$\nA primary current dipole at $\\mathbf{r}_{0}$ with dipole moment $\\mathbf{p}$ is modeled as $\\mathbf{J}_{p}(\\mathbf{r}') = \\mathbf{p}\\,\\delta(\\mathbf{r}'-\\mathbf{r}_{0})$. Substituting into the Biot–Savart integral yields\n$$\n\\mathbf{B}_{p}(\\mathbf{r}) \\;=\\; \\frac{\\mu_{0}}{4\\pi}\\,\\frac{\\mathbf{p}\\times(\\mathbf{r}-\\mathbf{r}_{0})}{\\lVert \\mathbf{r}-\\mathbf{r}_{0}\\rVert^{3}},\\quad \\mathbf{r}\\neq \\mathbf{r}_{0}.\n$$\nIn realistic heads, secondary (volume) currents also exist, but for a spherically symmetric conductor in the quasi-static regime, the external magnetic field depends only on the primary currents. This follows from symmetry arguments and the result that the magnetic field outside the sphere is unaffected by isotropic conductivity, so the external field equals the field that would be produced by the primary currents in a homogeneous infinite medium. Therefore, outside the head, we can compute the magnetic field using the above dipole expression.\n\nWe now define the geometry and algorithm to evaluate sulcal cancellation:\n\n1. Head model and constants:\n   - Spherical head radius $R_{\\text{head}} = 0.09$ meter.\n   - Vacuum permeability $\\mu_{0} = 4\\pi\\times 10^{-7}$ tesla-meter per ampere.\n   - Nominal dipole magnitude $p_{0} = 1.0\\times 10^{-7}$ ampere-meter.\n\n2. Sensor configuration:\n   - Number of sensors $N = 16$.\n   - Sensor spherical radius $r_{\\text{sens}} = 0.10$ meter.\n   - Polar angle $\\theta_{\\text{sens}} = 0.60$ radian.\n   - Azimuths $\\phi_{k} = \\frac{2\\pi k}{N}$ for $k\\in\\{0,\\dots,N-1\\}$.\n   - Sensor Cartesian coordinates\n     $$\n     \\mathbf{r}_{k} \\;=\\; r_{\\text{sens}}\\begin{bmatrix}\\cos\\phi_{k}\\,\\sin\\theta_{\\text{sens}}\\\\ \\sin\\phi_{k}\\,\\sin\\theta_{\\text{sens}}\\\\ \\cos\\theta_{\\text{sens}}\\end{bmatrix}.\n     $$\n\n3. Dipole configurations for each test case:\n   - Two dipoles at positions $\\mathbf{r}_{1} = \\begin{bmatrix} d/2 \\\\ 0 \\\\ z_{0}\\end{bmatrix}$ and $\\mathbf{r}_{2} = \\begin{bmatrix} -d/2 \\\\ 0 \\\\ z_{0}\\end{bmatrix}$.\n   - Tangential moments along $y$ with opposite directions: $\\mathbf{p}_{1} = \\begin{bmatrix} 0 \\\\ p_{0} \\\\ 0 \\end{bmatrix}$ and $\\mathbf{p}_{2} = \\begin{bmatrix} 0 \\\\ -s\\,p_{0} \\\\ 0 \\end{bmatrix}$.\n   - The four test cases are $(d,s,z_{0})\\in\\{(0.010,1.0,0.060),(0.010,0.8,0.060),(0.000,1.0,0.060),(0.020,1.0,0.030)\\}$, all in meter for $d,z_{0}$ and unitless for $s$.\n\n4. Field computation:\n   - For each sensor $\\mathbf{r}_{k}$ and dipole $(\\mathbf{p},\\mathbf{r}_{0})$, compute\n     $$\n     \\mathbf{B}(\\mathbf{r}_{k};\\mathbf{p},\\mathbf{r}_{0}) \\;=\\; \\frac{\\mu_{0}}{4\\pi}\\,\\frac{\\mathbf{p}\\times(\\mathbf{r}_{k}-\\mathbf{r}_{0})}{\\lVert \\mathbf{r}_{k}-\\mathbf{r}_{0}\\rVert^{3}}.\n     $$\n   - Define the single-dipole baseline field as $\\mathbf{B}_{\\text{single}}(\\mathbf{r}_{k}) = \\mathbf{B}(\\mathbf{r}_{k};\\mathbf{p}_{1},\\mathbf{r}_{1})$.\n   - Define the paired field as $\\mathbf{B}_{\\text{pair}}(\\mathbf{r}_{k}) = \\mathbf{B}(\\mathbf{r}_{k};\\mathbf{p}_{1},\\mathbf{r}_{1}) + \\mathbf{B}(\\mathbf{r}_{k};\\mathbf{p}_{2},\\mathbf{r}_{2})$.\n\n5. Metrics:\n   - Compute norms $b_{\\text{single},k} = \\lVert \\mathbf{B}_{\\text{single}}(\\mathbf{r}_{k})\\rVert$ and $b_{\\text{pair},k} = \\lVert \\mathbf{B}_{\\text{pair}}(\\mathbf{r}_{k})\\rVert$.\n   - Let $b_{\\text{single},\\max} = \\max_{k} b_{\\text{single},k}$ and $b_{\\text{pair},\\max} = \\max_{k} b_{\\text{pair},k}$, then\n     $$\n     C \\;=\\; \\frac{b_{\\text{pair},\\max}}{b_{\\text{single},\\max}}.\n     $$\n   - Let $k^{\\star} = \\arg\\max_{k} b_{\\text{single},k}$. Define the angle\n     $$\n     \\alpha \\;=\\; \\begin{cases}\n     \\arccos\\!\\left(\\dfrac{\\mathbf{B}_{\\text{single}}(\\mathbf{r}_{k^{\\star}})\\cdot \\mathbf{B}_{\\text{pair}}(\\mathbf{r}_{k^{\\star}})}{\\lVert \\mathbf{B}_{\\text{single}}(\\mathbf{r}_{k^{\\star}})\\rVert\\,\\lVert \\mathbf{B}_{\\text{pair}}(\\mathbf{r}_{k^{\\star}})\\rVert}\\right), & \\text{if } \\lVert \\mathbf{B}_{\\text{pair}}(\\mathbf{r}_{k^{\\star}})\\rVert > 0, \\\\[10pt]\n     0, & \\text{otherwise.}\n     \\end{cases}\n     $$\n\n6. Numerical considerations:\n   - Avoid division by zero by checking $\\lVert \\mathbf{r}-\\mathbf{r}_{0}\\rVert > 0$.\n   - Clip the cosine argument to the interval $[-1,1]$ before $\\arccos$ to maintain numerical stability.\n\n7. Output:\n   - For each test case, produce the pair $[C,\\alpha]$ with both values rounded to six decimal places.\n   - Aggregate all results into a single Python-style list of lists in the order of the test cases and print as a single line.\n\nThis procedure operationalizes the biophysical origin of MEG signals via primary current dipoles, captures sulcal cancellation by superposition of oppositely oriented tangential sources on opposing walls, and provides quantitative measures of amplitude reduction and direction deviation at the sensor with maximal single-dipole response. The specific geometry ensures scientific realism: sources are inside the head sphere, sensors are outside, and dipole magnitudes are in a plausible range for neuronal current dipoles. The edge cases, including zero separation $(d=0)$, probe perfect cancellation behavior, while asymmetry $(s=0.8)$ and increased separation or depth vary the degree of cancellation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef dipole_field_at_r(r, r0, p, mu0=4e-7*np.pi):\n    \"\"\"\n    Magnetic field at point r due to a current dipole p at r0 in free space:\n    B(r) = mu0/(4*pi) * p x (r - r0) / |r - r0|^3\n    \"\"\"\n    R = r - r0\n    R_norm = np.linalg.norm(R)\n    if R_norm == 0.0:\n        return np.zeros(3)\n    return (mu0 / (4.0 * np.pi)) * np.cross(p, R) / (R_norm**3)\n\ndef generate_sensors(N=16, r_sens=0.10, theta=0.60):\n    \"\"\"\n    Generate N sensors on a ring at radius r_sens and polar angle theta.\n    \"\"\"\n    sensors = []\n    for k in range(N):\n        phi = 2.0 * np.pi * k / N\n        x = r_sens * np.cos(phi) * np.sin(theta)\n        y = r_sens * np.sin(phi) * np.sin(theta)\n        z = r_sens * np.cos(theta)\n        sensors.append(np.array([x, y, z], dtype=float))\n    return np.array(sensors)\n\ndef case_metrics(d, s, z0, sensors, p0=1.0e-7):\n    \"\"\"\n    Compute cancellation ratio C and direction deviation angle alpha (radians)\n    for a given case (d, s, z0).\n    \"\"\"\n    # Dipole locations and moments\n    r1 = np.array([d/2.0, 0.0, z0], dtype=float)\n    r2 = np.array([-d/2.0, 0.0, z0], dtype=float)\n    p1 = np.array([0.0, p0, 0.0], dtype=float)\n    p2 = np.array([0.0, -s * p0, 0.0], dtype=float)\n\n    # Compute fields at sensors\n    B_single = np.array([dipole_field_at_r(r, r1, p1) for r in sensors])\n    B_pair = np.array([dipole_field_at_r(r, r1, p1) + dipole_field_at_r(r, r2, p2) for r in sensors])\n\n    # Norms\n    norms_single = np.linalg.norm(B_single, axis=1)\n    norms_pair = np.linalg.norm(B_pair, axis=1)\n\n    # Max norms and indices\n    idx_max_single = int(np.argmax(norms_single))\n    max_single = norms_single[idx_max_single]\n    max_pair = float(np.max(norms_pair))\n\n    # Cancellation ratio C\n    C = 0.0\n    if max_single > 0.0:\n        C = max_pair / max_single\n    else:\n        C = 0.0  # Convention if single baseline is zero (should not occur with tangential p1)\n\n    # Direction deviation angle alpha at idx_max_single\n    b_single_vec = B_single[idx_max_single]\n    b_pair_vec = B_pair[idx_max_single]\n    norm_single_vec = np.linalg.norm(b_single_vec)\n    norm_pair_vec = np.linalg.norm(b_pair_vec)\n    if norm_pair_vec == 0.0 or norm_single_vec == 0.0:\n        alpha = 0.0\n    else:\n        cosang = float(np.dot(b_single_vec, b_pair_vec) / (norm_single_vec * norm_pair_vec))\n        # Numerical robustness\n        cosang = max(-1.0, min(1.0, cosang))\n        alpha = float(np.arccos(cosang))\n\n    # Round to six decimals\n    C = round(C, 6)\n    alpha = round(alpha, 6)\n    return [C, alpha]\n\ndef solve():\n    # Constants\n    N = 16\n    r_sens = 0.10  # meters\n    theta = 0.60   # radians\n\n    # Sensors\n    sensors = generate_sensors(N=N, r_sens=r_sens, theta=theta)\n\n    # Test cases: (d, s, z0)\n    test_cases = [\n        (0.010, 1.0, 0.060),  # Case 1: symmetric opposite tangential, shallow\n        (0.010, 0.8, 0.060),  # Case 2: asymmetric magnitude\n        (0.000, 1.0, 0.060),  # Case 3: coincident anti-parallel (perfect cancellation)\n        (0.020, 1.0, 0.030),  # Case 4: increased separation, deeper\n    ]\n\n    results = []\n    for d, s, z0 in test_cases:\n        res = case_metrics(d, s, z0, sensors)\n        results.append(res)\n\n    # Final print statement in the exact required format.\n    # Ensure standard Python list-of-lists formatting.\n    print(str(results))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}