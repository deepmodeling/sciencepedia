{
    "hands_on_practices": [
        {
            "introduction": "分析神经元发放序列的第一步通常是将其离散的发放事件转换为连续的发放率函数。核平滑是一种功能强大的非参数方法，可以从原始发放时间中估计潜在的发放率，从而揭示其动态变化。本练习  将指导您完成这一过程，并解决一个在有限时间窗口内进行估计时经常出现的实际挑战：边界效应。",
            "id": "4162916",
            "problem": "给定在有界观测区间上的合成脉冲序列，要求您使用带宽为 $\\sigma$ 的高斯核计算核平滑放电率估计，并评估在 $t=0$ 和 $t=T$ 附近的边界（边缘）效应。此外，您将构建一个简单的脉冲历史适应轨迹，并通过将边缘校正后的放电率与适应轨迹进行拟合来估计线性适应增益。所有涉及时间的量必须以秒为单位表示。数值输出必须四舍五入到六位小数。\n\n使用的基本原理：\n- 脉冲序列是点过程的一个实现，具有瞬时强度（放电率）函数，定义为在时间 $t$ 每单位时间的预期事件数。经验放电率可以通过在时间轴上使用归一化核对脉冲序列（在脉冲时刻的脉冲总和）进行平滑来估计。\n- 高斯核是一个归一化的对称函数，具有单个带宽参数 $\\sigma$（标准差），它定义了平滑的时间尺度。\n- 边界效应的产生是因为平滑核延伸到了观测窗口 $\\left[0,T\\right]$ 之外，导致在 $t=0$ 和 $t=T$ 附近的有效核质量减少。一种有原则的边界校正方法是将朴素平滑估计值除以截断到观测窗口内的核的积分。\n- 脉冲历史适应可以通过一个因果轨迹来描述，该轨迹以时间常数 $\\tau_a$ 指数衰减，并在每次脉冲时增加，可以表示为自每次脉冲以来经过时间的指数之和。\n\n要实现的任务：\n1. 对于每个测试用例，在区间 $\\left[0,T\\right]$（含两端）上构建一个间距为 $\\Delta t = 0.001$ 秒的均匀时间网格。\n2. 通过将脉冲序列与带宽为 $\\sigma$ 的归一化高斯核进行卷积，计算朴素核平滑放电率估计 $\\,\\widehat{r}_{\\text{naive}}(t)\\,$。\n3. 通过将 $\\,\\widehat{r}_{\\text{naive}}(t)\\,$ 除以在每个时间点 $t$ 处截断到 $\\left[0,T\\right]$ 上的高斯核积分，计算边界校正后的估计值 $\\,\\widehat{r}_{\\text{bc}}(t)\\,$。如果分母在数值上可以忽略不计，则在这些点上保持朴素估计不变。\n4. 使用以下方法量化边缘效应：\n   - 定义 $t_s = \\min\\{\\sigma,\\,0.05\\,T\\}$ 和 $t_e = \\max\\{T-\\sigma,\\,0.95\\,T\\}$。计算比率 $E_{\\text{start}} = \\widehat{r}_{\\text{naive}}(t_s)/\\widehat{r}_{\\text{bc}}(t_s)$ 和 $E_{\\text{end}} = \\widehat{r}_{\\text{naive}}(t_e)/\\widehat{r}_{\\text{bc}}(t_e)$。这些比率反映了边界处的相对衰减，以无单位浮点数表示。\n   - 计算朴素估计和边界校正估计在 $\\left[0,T\\right]$ 上的积分质量误差，定义为 $M_{\\text{naive}} = \\int_0^T \\widehat{r}_{\\text{naive}}(t)\\,dt - N$ 和 $M_{\\text{bc}} = \\int_0^T \\widehat{r}_{\\text{bc}}(t)\\,dt - N$，其中 $N$ 是脉冲数（无单位）。在网格上使用黎曼和来近似积分。\n5. 构建一个适应轨迹 $a(t)$，作为脉冲历史的因果指数和，即 $a(t) = \\sum_i \\exp\\left(-(t-t_i)/\\tau_a\\right)$（对于 $t \\ge t_i$）否则为 $0$，其中 $t_i$ 是脉冲时间。通过在网格上使用最小二乘法拟合线性模型 $\\widehat{r}_{\\text{bc}}(t) \\approx r_0 - g\\,a(t)$，以估计基线 $r_0$（单位：脉冲/秒）和适应增益 $g$（单位：脉冲/秒）。将拟合得到的 $g$ 和 $r_0$ 报告为浮点数。\n6. 将所有报告的浮点数四舍五入到六位小数。\n\n测试套件：\n- 用例 $1$（理想情况，中等带宽，存在适应性）：\n  - $T = 10.0$ 秒，$\\sigma = 0.1$ 秒，$\\tau_a = 0.5$ 秒。\n  - 脉冲时间（秒）：$\\{0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.60, 0.65, 0.70, 0.75, 0.80, 0.85, 0.90, 0.95, 1.20, 1.45, 1.70, 1.95, 2.20, 2.45, 2.70, 2.95, 3.20, 3.45, 3.70, 3.95, 4.20, 4.45, 4.70, 4.95, 6.00, 6.60, 7.20, 7.80, 8.40, 9.00\\}$。\n- 用例 $2$（边界主导，相对于窗口带宽较大，适应性弱）：\n  - $T = 1.0$ 秒，$\\sigma = 0.2$ 秒，$\\tau_a = 0.1$ 秒。\n  - 脉冲时间（秒）：$\\{0.10, 0.30, 0.50, 0.70, 0.90\\}$。\n- 用例 $3$（边缘脉冲，小带宽）：\n  - $T = 5.0$ 秒，$\\sigma = 0.05$ 秒，$\\tau_a = 0.2$ 秒。\n  - 脉冲时间（秒）：$\\{0.01, 0.02, 2.50, 3.00, 4.98, 4.99\\}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果应是一个包含六个浮点数的列表，顺序为 $[E_{\\text{start}}, E_{\\text{end}}, M_{\\text{naive}}, M_{\\text{bc}}, g, r_0]$，并且总输出应是这些按用例排列的列表的列表，例如 $\\left[[x_1,x_2,x_3,x_4,x_5,x_6],[y_1,\\dots,y_6],[z_1,\\dots,z_6]\\right]$。",
            "solution": "用户提供了一个计算神经科学领域中定义明确的问题，涉及对合成脉冲序列数据的分析。该问题在科学上是有效的、自洽的，并且在算法上是明确的。我将按照所需任务，逐步进行求解。\n\n总体方法是首先从神经元的脉冲时间估计其瞬时放电率。这是通过核平滑（一种非参数密度估计技术）实现的。脉冲序列，即一个时间点序列，与一个高斯核进行卷积。然而，这个过程会引入称为边界效应的伪影，即在观测区间的开始和结束附近，放电率被人为地低估。我们应用一种标准校正来减轻这种偏差。随后，使用校正后的放电率来建模脉冲频率适应，这是一种常见的现象，即放电率因持续输入而降低。这通过将放电率与一个依赖于脉冲历史的适应轨迹之间的线性关系进行拟合来建模。\n\n以下是与问题陈述中概述的任务相对应的实现细节分解。\n\n**1. 时间网格生成**\n对于每个测试用例，我们首先在观测区间 $[0, T]$ 上建立一个离散的时间网格。构建一个具有 $\\Delta t = 0.001$ 秒精细时间分辨率的均匀网格。这个网格，记为 $\\{t_k\\}$，作为计算所有时间相关函数（放电率、适应轨迹）的点集。\n网格中的点数为 $N_t = \\lfloor T/\\Delta t \\rfloor + 1$。\n\n**2. 朴素放电率估计**\n从概念上讲，脉冲序列是狄拉克δ函数的总和，$\\rho(t) = \\sum_{i=1}^{N} \\delta(t-t_i)$，其中 $\\{t_i\\}$ 是 $N$ 个脉冲时间。平滑放电率是此信号与归一化高斯核 $K_\\sigma(t) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{t^2}{2\\sigma^2}\\right)$ 的卷积。该卷积的计算结果为一个总和：\n$$ \\widehat{r}_{\\text{naive}}(t) = (\\rho * K_\\sigma)(t) = \\sum_{i=1}^{N} K_\\sigma(t - t_i) $$\n这个“朴素”估计是在我们的时间网格上的每个点 $t_k$ 计算的。\n\n**3. 边界校正**\n朴素估计在边界 $t=0$ 和 $t=T$ 附近存在偏差，因为核的一部分质量落在了观测区间 $[0, T]$ 之外。为了校正这一点，我们将朴素估计除以位于区间*内部*的核的总质量。这个校正因子 $C(t)$ 是以 $t$ 为中心、在定义域 $[0, T]$ 上的核的积分：\n$$ C(t) = \\int_{0}^{T} K_\\sigma(t - \\tau) d\\tau $$\n通过变量替换 $u = (\\tau-t)/\\sigma$，这个积分可以用标准正态累积分布函数 (CDF) $\\Phi(z) = \\int_{-\\infty}^{z} \\frac{1}{\\sqrt{2\\pi}}e^{-x^2/2}dx$ 来表示：\n$$ C(t) = \\Phi\\left(\\frac{T-t}{\\sigma}\\right) - \\Phi\\left(\\frac{-t}{\\sigma}\\right) $$\n然后，边界校正后的放电率估计为：\n$$ \\widehat{r}_{\\text{bc}}(t) = \\frac{\\widehat{r}_{\\text{naive}}(t)}{C(t)} $$\n为了数值稳定性，如果 $C(t)$ 接近于零，我们不应用校正。\n\n**4. 量化边缘效应和质量误差**\n为了评估边界效应的影响，我们计算两组度量。\n首先，我们在边界附近的特定点探测估计值：$t_s = \\min\\{\\sigma, 0.05\\,T\\}$ 和 $t_e = \\max\\{T-\\sigma, 0.95\\,T\\}$。计算比率 $E_{\\text{start}} = \\widehat{r}_{\\text{naive}}(t_s)/\\widehat{r}_{\\text{bc}}(t_s)$ 和 $E_{\\text{end}} = \\widehat{r}_{\\text{naive}}(t_e)/\\widehat{r}_{\\text{bc}}(t_e)$。根据定义，这些比率就是校正因子 $C(t)$ 在 $t_s$ 和 $t_e$ 处的值，它们量化了在这些位置上核质量的分数损失。\n其次，我们计算朴素估计和校正估计的积分质量误差。真实瞬时放电率在整个区间上的总积分必须等于总脉冲数 $N$。质量误差定义为：\n$$ M_{\\text{naive}} = \\int_0^T \\widehat{r}_{\\text{naive}}(t)\\,dt - N $$\n$$ M_{\\text{bc}} = \\int_0^T \\widehat{r}_{\\text{bc}}(t)\\,dt - N $$\n这些积分使用时间网格上的黎曼和来近似：$\\int f(t)dt \\approx \\sum_k f(t_k)\\Delta t$。\n\n**5. 适应性建模**\n脉冲频率适应通过构建一个因果脉冲历史轨迹 $a(t)$ 来建模。该轨迹整合了最近的脉冲活动历史，每个脉冲贡献一个指数衰减项：\n$$ a(t) = \\sum_{i \\text{ s.t. } t_i \\le t} \\exp\\left(-\\frac{t-t_i}{\\tau_a}\\right) $$\n其中 $\\tau_a$ 是适应时间常数。该轨迹在时间网格的所有 $t_k$ 点上计算。\n然后我们拟合一个线性模型，该模型假定边界校正后的放电率 $\\widehat{r}_{\\text{bc}}(t)$ 是此适应轨迹的线性函数：\n$$ \\widehat{r}_{\\text{bc}}(t) \\approx r_0 - g \\cdot a(t) $$\n参数 $r_0$（基线放电率）和 $g$（适应增益）使用普通最小二乘回归进行估计。这涉及求解线性系统 $Y = X\\beta$ 以得到 $\\beta = [r_0, g]^T$，其中 $Y$ 是 $\\widehat{r}_{\\text{bc}}(t_k)$ 值的向量，而 $X$ 是一个两列的设计矩阵，其列分别是一个全为1的向量和 $-a(t_k)$ 值的向量。\n\n**6. 最终输出**\n对于每个测试用例，计算所需的六个浮点值——$E_{\\text{start}}$、$E_{\\text{end}}$、$M_{\\text{naive}}$、$M_{\\text{bc}}$、$g$ 和 $r_0$——然后四舍五入到六位小数，作为最终输出。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Main solver function that processes all test cases as specified.\n    \"\"\"\n    test_cases = [\n        {\n            \"T\": 10.0, \"sigma\": 0.1, \"tau_a\": 0.5,\n            \"spikes\": {0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.60, 0.65, 0.70, 0.75, 0.80, 0.85, 0.90, 0.95, 1.20, 1.45, 1.70, 1.95, 2.20, 2.45, 2.70, 2.95, 3.20, 3.45, 3.70, 3.95, 4.20, 4.45, 4.70, 4.95, 6.00, 6.60, 7.20, 7.80, 8.40, 9.00}\n        },\n        {\n            \"T\": 1.0, \"sigma\": 0.2, \"tau_a\": 0.1,\n            \"spikes\": {0.10, 0.30, 0.50, 0.70, 0.90}\n        },\n        {\n            \"T\": 5.0, \"sigma\": 0.05, \"tau_a\": 0.2,\n            \"spikes\": {0.01, 0.02, 2.50, 3.00, 4.98, 4.99}\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        T, sigma, tau_a, spike_times = case[\"T\"], case[\"sigma\"], case[\"tau_a\"], case[\"spikes\"]\n        \n        # Convert spike times to a sorted numpy array\n        spike_times = np.array(sorted(list(spike_times)))\n        n_spikes = len(spike_times)\n        \n        # Task 1: Build a uniform time grid\n        dt = 0.001\n        t_grid = np.arange(0.0, T + dt, dt)\n\n        # Reshape for broadcasting\n        t_grid_col = t_grid[:, np.newaxis]\n        spike_times_row = spike_times[np.newaxis, :]\n\n        # Calculate time differences for kernel and adaptation trace\n        time_diffs = t_grid_col - spike_times_row\n\n        # Task 2: Compute the naive kernel-smoothed rate estimate\n        kernel_norm_factor = 1.0 / (sigma * np.sqrt(2.0 * np.pi))\n        kernel_vals = kernel_norm_factor * np.exp(-0.5 * (time_diffs / sigma)**2)\n        r_naive = np.sum(kernel_vals, axis=1)\n\n        # Task 3: Compute a boundary-corrected estimate\n        C_t = norm.cdf((T - t_grid) / sigma) - norm.cdf(-t_grid / sigma)\n        \n        # Create a boolean mask for safe division\n        safe_div_mask = C_t  1e-9\n        r_bc = np.copy(r_naive)\n        r_bc[safe_div_mask] = r_naive[safe_div_mask] / C_t[safe_div_mask]\n\n        # Task 4: Quantify edge effects and integrated mass error\n        t_s = min(sigma, 0.05 * T)\n        t_e = max(T - sigma, 0.95 * T)\n\n        # Find indices of grid points closest to t_s and t_e\n        idx_s = np.argmin(np.abs(t_grid - t_s))\n        idx_e = np.argmin(np.abs(t_grid - t_e))\n\n        E_start = r_naive[idx_s] / r_bc[idx_s] if r_bc[idx_s] != 0 else 1.0\n        E_end = r_naive[idx_e] / r_bc[idx_e] if r_bc[idx_e] != 0 else 1.0\n\n        M_naive = np.sum(r_naive) * dt - n_spikes\n        M_bc = np.sum(r_bc) * dt - n_spikes\n\n        # Task 5: Construct an adaptation trace and fit the linear model\n        causal_time_diffs = np.copy(time_diffs)\n        causal_time_diffs[causal_time_diffs  0] = np.inf\n        a_t = np.sum(np.exp(-causal_time_diffs / tau_a), axis=1)\n        \n        # Fit r_bc(t) approx r0 - g * a(t)\n        # Y = X * beta, where Y=r_bc, X=[1, -a_t], beta=[r0, g]\n        X = np.stack([np.ones_like(a_t), -a_t], axis=1)\n        Y = r_bc\n        \n        coeffs, _, _, _ = np.linalg.lstsq(X, Y, rcond=None)\n        r0, g = coeffs[0], coeffs[1]\n\n        # Task 6: Round all reported floats to six decimal places\n        result_list = [E_start, E_end, M_naive, M_bc, g, r0]\n        rounded_list = [np.round(v, 6) for v in result_list]\n        \n        all_results.append(f'[{\",\".join(map(str, rounded_list))}]')\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然核平滑为了解发放率动态提供了直观的描述，但一个更强大的方法是建立一个能够预测发放率如何依赖于外部刺激和自身发放历史的参数模型。广义线性模型（GLM）为此提供了一个标准框架，而本练习  将推导拟合这些模型所需的关键数学构件——得分向量和 Fisher 信息矩阵，它们是最大似然估计算法的基础。",
            "id": "4162875",
            "problem": "考虑一个单神经元脉冲序列，它在区间 $[0, T]$ 上被建模为一个简单的计数过程，其脉冲时间为 $\\{t_i\\}_{i=1}^{n}$，对应的计数过程为 $N(t)$。该神经元由一个已知的标量刺激 $x(t)$ 驱动，并通过其自身的过去脉冲表现出依赖于历史的适应性。假设一个对数线性点过程广义线性模型（GLM），其条件强度由下式给出\n$$\n\\lambda(t \\mid \\mathcal{H}_t, x) = \\exp\\big(\\eta(t)\\big), \\quad \\text{其中} \\quad \\eta(t) = b + \\int_{0}^{\\infty} k(\\tau)\\, x(t - \\tau)\\, d\\tau + \\int_{0}^{\\infty} h(\\tau)\\, dN(t - \\tau),\n$$\n其中 $b \\in \\mathbb{R}$ 是一个偏置项，$k(\\tau)$ 是一个刺激滤波器，$h(\\tau)$ 是一个脉冲后（历史）滤波器，$\\mathcal{H}_t$ 表示直到时间 $t$ 的脉冲历史。为了获得有限维参数化，将滤波器在固定基中展开：\n$$\nk(\\tau) = \\sum_{j=1}^{p} \\alpha_j\\, \\phi_j(\\tau), \\quad h(\\tau) = \\sum_{\\ell=1}^{q} \\beta_{\\ell}\\, \\psi_{\\ell}(\\tau),\n$$\n其中 $\\{\\phi_j\\}_{j=1}^{p}$ 和 $\\{\\psi_{\\ell}\\}_{\\ell=1}^{q}$ 是已知基函数，$\\alpha \\in \\mathbb{R}^{p}$ 和 $\\beta \\in \\mathbb{R}^{q}$ 是未知系数。定义相应的随时间变化的协变量\n$$\nx_j(t) = \\int_{0}^{\\infty} \\phi_j(\\tau)\\, x(t - \\tau)\\, d\\tau, \\quad y_{\\ell}(t) = \\int_{0}^{\\infty} \\psi_{\\ell}(\\tau)\\, dN(t - \\tau),\n$$\n并将它们收集到设计向量中\n$$\nz(t) = \\begin{pmatrix} z_0(t) \\\\ z_x(t) \\\\ z_y(t) \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ x_1(t) \\\\ \\vdots \\\\ x_p(t) \\\\ y_1(t) \\\\ \\vdots \\\\ y_q(t) \\end{pmatrix} \\in \\mathbb{R}^{1+p+q}, \\quad \\text{使得} \\quad \\eta(t) = \\theta^{\\top} z(t),\n$$\n参数向量为 $\\theta = \\begin{pmatrix} b  \\alpha_1  \\cdots  \\alpha_p  \\beta_1  \\cdots  \\beta_q \\end{pmatrix}^{\\top} \\in \\mathbb{R}^{1+p+q}$。假设在标准正则性条件下，积分号下求导有效且似然函数是良定义的。\n\n从基本的连续时间点过程似然（即，使用条件强度作为风险率，在无穷小区间上进行乘积）及其对于简单点过程的相关对数似然出发，\n$$\n\\ell(\\theta) = \\sum_{i=1}^{n} \\ln \\lambda(t_i \\mid \\theta) \\;-\\; \\int_{0}^{T} \\lambda(t \\mid \\theta)\\, dt,\n$$\n推导该模型的得分向量 $s(\\theta) = \\nabla_{\\theta} \\ell(\\theta)$ 和费雪信息矩阵 $\\mathcal{I}(\\theta)$，并用设计向量 $z(t)$ 和强度 $\\lambda(t \\mid \\theta)$ 来表示。您的最终表达式必须是包含观测协变量 $\\{x_j(t)\\}_{j=1}^{p}$、$\\{y_{\\ell}(t)\\}_{\\ell=1}^{q}$ 和条件强度 $\\lambda(t \\mid \\theta)$ 的闭式解析表达式，且在 $[0, T]$ 上有效。不需要数值近似。\n\n答案格式要求：\n- 将最终答案以单个闭式解析表达式（可能为复合形式）的形式提供，不带单位。\n- 不需要四舍五入。\n- 如果提供多个对象，请使用 $\\mathrm{pmatrix}$ 环境将它们一起表示为单行矩阵。",
            "solution": "该问题在计算神经科学和统计建模领域提出了一个有效且适定的问题。它在科学上植根于点过程理论和广义线性模型（GLM），为推导标准统计量提供了一个完整且一致的框架。所有术语都得到了形式化定义，任务是进行一次数学推导，该推导是客观且可验证的。\n\n出发点是在区间 $[0, T]$ 上观测到的点过程的对数似然函数，由下式给出：\n$$\n\\ell(\\theta) = \\sum_{i=1}^{n} \\ln \\lambda(t_i \\mid \\theta) - \\int_{0}^{T} \\lambda(t \\mid \\theta)\\, dt\n$$\n其中 $\\{t_i\\}_{i=1}^{n}$ 是观测到的脉冲时间。该模型将条件强度 $\\lambda(t \\mid \\theta)$ 指定为一组协变量和参数的对数线性函数：\n$$\n\\lambda(t \\mid \\theta) = \\exp(\\eta(t)) = \\exp\\big(\\theta^{\\top} z(t)\\big)\n$$\n此处，$\\theta \\in \\mathbb{R}^{1+p+q}$ 是参数向量，$z(t) \\in \\mathbb{R}^{1+p+q}$ 是随时间变化的设计向量。将此代入对数似然表达式，我们得到：\n$$\n\\ln \\lambda(t \\mid \\theta) = \\theta^{\\top} z(t)\n$$\n因此，对数似然可以写成：\n$$\n\\ell(\\theta) = \\sum_{i=1}^{n} \\theta^{\\top} z(t_i) - \\int_{0}^{T} \\exp\\big(\\theta^{\\top} z(t)\\big)\\, dt\n$$\n\n首先，我们推导得分向量 $s(\\theta)$，即对数似然函数关于参数向量 $\\theta$ 的梯度。\n$$\ns(\\theta) = \\nabla_{\\theta} \\ell(\\theta) = \\nabla_{\\theta} \\left( \\sum_{i=1}^{n} \\theta^{\\top} z(t_i) - \\int_{0}^{T} \\exp\\big(\\theta^{\\top} z(t)\\big)\\, dt \\right)\n$$\n我们逐项进行微分。对于第一项（求和项）：\n$$\n\\nabla_{\\theta} \\left( \\sum_{i=1}^{n} \\theta^{\\top} z(t_i) \\right) = \\sum_{i=1}^{n} \\nabla_{\\theta} (\\theta^{\\top} z(t_i)) = \\sum_{i=1}^{n} z(t_i)\n$$\n对于第二项（积分项），我们利用题目假设的正则性条件，这些条件允许在积分号下进行微分（莱布尼茨积分法则）：\n$$\n\\nabla_{\\theta} \\left( \\int_{0}^{T} \\exp\\big(\\theta^{\\top} z(t)\\big)\\, dt \\right) = \\int_{0}^{T} \\nabla_{\\theta} \\left( \\exp\\big(\\theta^{\\top} z(t)\\big) \\right) \\, dt\n$$\n积分内的梯度使用链式法则计算：\n$$\n\\nabla_{\\theta} \\left( \\exp\\big(\\theta^{\\top} z(t)\\big) \\right) = \\exp\\big(\\theta^{\\top} z(t)\\big) \\cdot \\nabla_{\\theta}\\big(\\theta^{\\top} z(t)\\big) = \\exp\\big(\\theta^{\\top} z(t)\\big) \\cdot z(t)\n$$\n回顾 $\\lambda(t \\mid \\theta) = \\exp\\big(\\theta^{\\top} z(t)\\big)$，我们有：\n$$\n\\nabla_{\\theta} \\left( \\int_{0}^{T} \\lambda(t \\mid \\theta)\\, dt \\right) = \\int_{0}^{T} \\lambda(t \\mid \\theta) z(t) \\, dt\n$$\n结合这两个部分，得分向量为：\n$$\ns(\\theta) = \\sum_{i=1}^{n} z(t_i) - \\int_{0}^{T} \\lambda(t \\mid \\theta) z(t) \\, dt\n$$\n\n接下来，我们推导费雪信息矩阵 $\\mathcal{I}(\\theta)$。对于具有典则连接函数的广义线性模型，费雪信息矩阵等于对数似然的海森矩阵的负值（即观测费雪信息）。对数连接是泊松分布的典则连接函数，并且该模型可以看作一个非齐次泊松过程，该性质对此模型成立。因此，我们首先计算海森矩阵 $H(\\theta) = \\nabla_{\\theta}^2 \\ell(\\theta) = \\nabla_{\\theta} s(\\theta)^{\\top}$。更方便的是计算列向量 $s(\\theta)$ 的雅可比矩阵，从而得到 $H(\\theta)$。\n$$\nH(\\theta) = \\nabla_{\\theta} \\left( \\sum_{i=1}^{n} z(t_i) - \\int_{0}^{T} \\lambda(t \\mid \\theta) z(t) \\, dt \\right)^{\\top}\n$$\n第一项 $\\sum_{i=1}^{n} z(t_i)$ 是对观测数据的求和，不依赖于参数 $\\theta$，因此它关于 $\\theta$ 的导数是零矩阵。\n$$\n\\nabla_{\\theta} \\left( \\sum_{i=1}^{n} z(t_i) \\right) = 0\n$$\n对于第二项，我们再次在积分号下进行微分：\n$$\n\\nabla_{\\theta} \\left( \\int_{0}^{T} \\lambda(t \\mid \\theta) z(t)^{\\top} \\, dt \\right) = \\int_{0}^{T} \\nabla_{\\theta} \\left( \\lambda(t \\mid \\theta) z(t)^{\\top} \\right) \\, dt\n$$\n我们需要计算向量场 $\\lambda(t \\mid \\theta) z(t) = \\exp\\big(\\theta^{\\top} z(t)\\big) z(t)$ 关于 $\\theta$ 的雅可比矩阵。所得矩阵的元素 $(j,k)$ 由第 $j$ 个分量对 $\\theta_k$ 的偏导数给出：\n$$\n\\frac{\\partial}{\\partial \\theta_k} \\left( \\exp\\big(\\theta^{\\top} z(t)\\big) z_j(t) \\right) = z_j(t) \\cdot \\frac{\\partial}{\\partial \\theta_k} \\exp\\big(\\theta^{\\top} z(t)\\big) = z_j(t) \\cdot \\exp\\big(\\theta^{\\top} z(t)\\big) \\cdot z_k(t)\n$$\n这可以写成外积的矩阵形式：\n$$\n\\nabla_{\\theta} \\left( \\lambda(t \\mid \\theta) z(t)^{\\top} \\right) = \\exp\\big(\\theta^{\\top} z(t)\\big) z(t) z(t)^{\\top} = \\lambda(t \\mid \\theta) z(t) z(t)^{\\top}\n$$\n因此，海森矩阵为：\n$$\nH(\\theta) = 0 - \\int_{0}^{T} \\lambda(t \\mid \\theta) z(t) z(t)^{\\top} \\, dt = - \\int_{0}^{T} \\lambda(t \\mid \\theta) z(t) z(t)^{\\top} \\, dt\n$$\n费雪信息矩阵 $\\mathcal{I}(\\theta)$ 是期望海森矩阵的负值。对于此类模型，观测信息 $-H(\\theta)$ 是费雪信息矩阵的一个有效且常用的表达式，特别是在最大似然估计的背景下。\n$$\n\\mathcal{I}(\\theta) = -H(\\theta) = \\int_{0}^{T} \\lambda(t \\mid \\theta) z(t) z(t)^{\\top} \\, dt\n$$\n该表达式是一个 $(1+p+q) \\times (1+p+q)$ 矩阵，并且它是半正定的，这与费雪信息矩阵的性质相符，因为 $\\lambda(t \\mid \\theta) \\ge 0$。\n\n推导出的得分向量和费雪信息矩阵的表达式为：\n得分向量：$s(\\theta) = \\sum_{i=1}^{n} z(t_i) - \\int_{0}^{T} \\lambda(t \\mid \\theta) z(t) \\, dt$\n费雪信息矩阵：$\\mathcal{I}(\\theta) = \\int_{0}^{T} \\lambda(t \\mid \\theta) z(t) z(t)^{\\top} \\, dt$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\sum_{i=1}^{n} z(t_i) - \\int_{0}^{T} \\lambda(t \\mid \\theta) z(t) \\, dt  \\int_{0}^{T} \\lambda(t \\mid \\theta) z(t) z(t)^{\\top} \\, dt \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "建立模型只是工作的一半；我们还必须严格评估其准确性，以确保它能真实地捕捉神经元的发放模式。时间重标度定理为点过程模型（如GLM）的拟合优度检验提供了一种优雅而深刻的方法。本练习  探讨了该检验的理论基础，并阐明了如何利用它来判断我们的模型是否充分地解释了观测到的发放数据。",
            "id": "4162921",
            "problem": "一个神经元产生一个脉冲序列，该序列被建模为一个简单点过程，其事件时间为 $\\{t_{k}\\}_{k=1}^{n}$，条件强度（风险）函数为 $\\lambda(t \\mid H_{t})$，其中 $H_{t}$ 表示直到时间 $t$ 的脉冲序列历史。设 $\\hat{\\lambda}(t \\mid H_{t})$ 是条件强度的一个拟合模型。对于连续的脉冲时间 $t_{k-1}  t_{k}$，定义重标度的脉冲间间隔 (ISI) 变换\n$$\nA_{k} \\equiv \\int_{t_{k-1}}^{t_{k}} \\hat{\\lambda}(s \\mid H_{s}) \\, ds,\n$$\n以及概率积分变换\n$$\nU_{k} \\equiv 1 - \\exp(-A_{k}).\n$$\n假设拟合模型是正确的，即 $\\hat{\\lambda}(t \\mid H_{t}) = \\lambda(t \\mid H_{t})$ 关于时间几乎处处成立。\n\n从点过程的条件强度函数和到下一个事件的等待时间的生存函数的基本定义出发，推导在正确模型下 $U_{k}$ 的分布。然后，定性地解释系统的脉冲后适应（例如，紧随 $t_{k-1}$ 之后 $\\lambda(t \\mid H_{t})$ 的瞬时降低，而这种降低未在 $\\hat{\\lambda}$ 中体现）将如何表现为 $\\{U_{k}\\}$ 的一维分布及其序列依赖结构中的偏差。\n\n最后，对于一个固定的 $p  0$，计算在正确模型下期望值 $\\mathbb{E}[U_{k}^{p}]$ 的闭式表达式。无需四舍五入。将你的最终答案表示为无单位的单一解析表达式。",
            "solution": "首先验证问题，以确保其具有科学依据、问题明确且客观。\n\n### 第 1 步：提取已知条件\n- 脉冲序列事件时间：$\\{t_{k}\\}_{k=1}^{n}$\n- 真实条件强度函数：$\\lambda(t \\mid H_{t})$\n- 拟合条件强度函数：$\\hat{\\lambda}(t \\mid H_{t})$\n- 重标度的脉冲间间隔 (ISI) 变换：$A_{k} \\equiv \\int_{t_{k-1}}^{t_{k}} \\hat{\\lambda}(s \\mid H_{s}) \\, ds$\n- 概率积分变换：$U_{k} \\equiv 1 - \\exp(-A_{k})$\n- 正确模型假设：$\\hat{\\lambda}(t \\mid H_{t}) = \\lambda(t \\mid H_{t})$ 几乎处处成立。\n- 期望值的参数：$p  0$\n\n### 第 2 步：使用提取的已知条件进行验证\n问题定义明确且科学合理。它基于点过程的时间重标度定理，这是神经脉冲序列统计分析的基石。所有术语在计算神经科学和点过程理论中都是标准术语。该问题要求完成三个不同但相关的任务：在特定假设下的推导，对偏离该假设情况的定性分析，以及基于初始推导的计算。问题的设定是自洽的且逻辑一致。\n\n### 第 3 步：结论与行动\n问题有效。将提供完整解答。\n\n### 第 1 部分：在正确模型下 $U_{k}$ 的分布\n\n我们从条件强度函数 $\\lambda(t \\mid H_{t})$ 的定义开始。对于一个微小的时间区间 $dt$，在给定直到时间 $t$ 的脉冲历史 $H_{t}$ 的条件下，在 $[t, t+dt)$ 区间内发生一个脉冲的概率是 $\\lambda(t \\mid H_{t}) dt$。\n\n在 $t_{k-1}$ 发生一个脉冲后，到下一个脉冲 $t_k$ 的等待时间是一个随机变量。我们可以通过首先考虑其生存函数 $S(\\tau \\mid t_{k-1}) = P(t_{k}  t_{k-1} + \\tau \\mid H_{t_{k-1}})$ 来找到其分布。这是在区间 $(t_{k-1}, t_{k-1}+\\tau]$ 内没有脉冲的概率。通过将此区间划分为持续时间为 $ds$ 的无穷小子区间，在 $(t_{k-1}, t_{k-1}+\\tau]$ 内没有脉冲的概率是每个子区间内没有脉冲的概率的乘积，在极限情况下变为：\n$$\nP(t_{k}  t) = \\exp \\left( -\\int_{t_{k-1}}^{t} \\lambda(s \\mid H_{s}) \\, ds \\right)\n$$\n对于任何 $t  t_{k-1}$。右边的表达式是等待时间的生存函数。因此，下一个脉冲时间 $t_k$ 的累积分布函数 (CDF) 是：\n$$\nF_{t_{k}}(t) \\equiv P(t_{k} \\leq t \\mid H_{t_{k-1}}) = 1 - P(t_{k}  t \\mid H_{t_{k-1}}) = 1 - \\exp \\left( -\\int_{t_{k-1}}^{t} \\lambda(s \\mid H_{s}) \\, ds \\right).\n$$\n题目假设拟合模型是正确的，因此 $\\hat{\\lambda}(t \\mid H_{t}) = \\lambda(t \\mid H_{t})$。重标度的 ISI 因此是 $A_{k} = \\int_{t_{k-1}}^{t_{k}} \\lambda(s \\mid H_{s}) \\, ds$。我们希望找到 $A_k$ 的分布。\n\n设 $a$ 为一个非负实数。$A_k$ 的 CDF 是 $F_{A_{k}}(a) = P(A_{k} \\leq a)$。\n事件 $A_{k} \\leq a$ 等价于事件 $\\int_{t_{k-1}}^{t_{k}} \\lambda(s \\mid H_{s}) \\, ds \\leq a$。\n让我们定义一个单调时间变换 $\\tau(t) = \\int_{t_{k-1}}^{t} \\lambda(s \\mid H_{s}) \\, ds$。设 $t_{a}$ 是满足 $\\tau(t_{a}) = a$ 的时间。那么条件 $A_{k} \\leq a$ 等价于 $t_{k} \\leq t_{a}$。因此，我们可以将 $A_k$ 的 CDF 写为：\n$$\nF_{A_{k}}(a) = P(A_{k} \\leq a) = P(t_{k} \\leq t_{a} \\mid H_{t_{k-1}}).\n$$\n使用我们之前推导的 $t_k$ 的 CDF，在 $t=t_{a}$ 处求值：\n$$\nP(t_{k} \\leq t_{a} \\mid H_{t_{k-1}}) = 1 - \\exp \\left( -\\int_{t_{k-1}}^{t_{a}} \\lambda(s \\mid H_{s}) \\, ds \\right).\n$$\n根据我们对 $t_a$ 的定义，指数中的积分恰好是 $a$。因此，\n$$\nF_{A_{k}}(a) = 1 - \\exp(-a).\n$$\n这是速率参数为 1 的标准指数分布的 CDF。所以，$A_{k} \\sim \\text{Exp}(1)$。\n\n现在我们考虑 $U_{k} = 1 - \\exp(-A_{k})$ 的分布。这个变换恰好是速率为 1 的指数随机变量的 CDF，在随机变量 $A_k$ 本身处求值。根据概率积分变换定理，如果 $X$ 是一个具有 CDF $F_X$ 的连续随机变量，那么随机变量 $Y = F_{X}(X)$ 在区间 $[0, 1]$ 上均匀分布。\n在我们的例子中，$A_k$ 是连续随机变量，其 CDF 是 $F_{A_{k}}(a) = 1 - \\exp(-a)$。变量 $U_k$ 被构造为 $U_{k} = F_{A_{k}}(A_{k})$。因此，$U_k$ 服从 $[0, 1]$ 上的均匀分布。\n时间重标度定理的一个更深层的结果是，如果模型是正确的，重标度区间 $\\{A_{k}\\}$ 是独立同分布 (i.i.d.) 的，服从 $\\text{Exp}(1)$ 分布。因此，变换后的变量 $\\{U_{k}\\}$ 是来自均匀分布 $U(0, 1)$ 的独立同分布随机变量。\n\n### 第 2 部分：未建模的适应的定性效应\n\n现在，假设真实的条件强度 $\\lambda(t \\mid H_{t})$ 表现出脉冲后适应（例如，不应期），这意味着在 $t_{k-1}$ 的一个脉冲之后的某个时间段内，放电的概率会瞬时降低。假设我们的模型 $\\hat{\\lambda}(t \\mid H_{t})$ 未能捕捉到这一点，例如通过保持恒定或低估了这种降低的强度或持续时间。\n\n在这种情况下，紧随 $t_{k-1}$ 的一个脉冲之后，真实速率 $\\lambda(s \\mid H_s)$ 将系统性地小于模型速率 $\\hat{\\lambda}(s \\mid H_s)$。因为神经元放电的可能性比模型预测的要小，所以 $t_k$ 时刻的脉冲倾向于比模型预期的更晚发生。这意味着观测到的脉冲间间隔 $\\{t_k - t_{k-1}\\}$ 平均会更长。\n\n重标度的 ISI 计算为 $A_{k} = \\int_{t_{k-1}}^{t_{k}} \\hat{\\lambda}(s \\mid H_{s}) \\, ds$。在这个积分中，被积函数 $\\hat{\\lambda}$ 是对真实速率 $\\lambda$ 的高估，并且由于未建模的不应期，积分区间 $[t_{k-1}, t_k]$ 很可能会更长。这两种效应都导致积分值 $A_k$ 系统性地大于标准指数分布的预期值。因此，$\\{A_k\\}$ 的分布的均值将大于 1。\n\n$\\{A_k\\}$ 的这种偏差对 $\\{U_k\\}$ 的分布有直接影响。由于 $U_k = 1 - \\exp(-A_k)$ 是 $A_k$ 的单调递增函数，系统性偏大的 $A_k$ 值将产生系统性偏大的 $U_k$ 值。\n- **$\\{U_k\\}$ 的一维分布**：$\\{U_k\\}$ 的分布将不再是 $[0, 1]$ 上的均匀分布。它将偏向 1。$U_k$ 值的直方图将显示值在 1 附近堆积，而在 0 附近减少。与均匀分布的分位数-分位数 (Q-Q) 图将显示一条位于单位对角线下方的曲线。\n\n- **$\\{U_k\\}$ 的序列依赖性**：时间重标度定理仅在模型 $\\hat{\\lambda}(t | H_t)$ 捕捉了过程的所有历史依赖性时才保证 $\\{U_k\\}$ 的独立性。未建模的适应恰恰是模型遗漏的一种历史依赖形式。适应的程度（以及模型误差 $\\hat{\\lambda} - \\lambda$ 的大小）本身可能取决于过去的脉冲历史，例如前一个 ISI 的长度 $t_{k-1} - t_{k-2}$。例如，一个短的前置 ISI 可能会引起更强的适应，使得当前区间的误差 $\\hat{\\lambda} - \\lambda$ 更大，这反过来又会影响 $A_k$。这在连续的重标度区间 $A_{k-1}$ 和 $A_k$ 之间产生了统计依赖性。因此，$\\{U_k\\}$ 将不再是独立的。这种依赖性在 $U_k$ 对 $U_{k-1}$ 的散点图中会表现为结构，该图将偏离单位正方形上的均匀散点。例如，如果由于适应机制，短的 ISI（导致小的 $A_{k-1}$）通常后跟长的 ISI（导致大的 $A_k$），则可能观察到负序列相关性。\n\n### 第 3 部分：$\\mathbb{E}[U_{k}^{p}]$ 的计算\n\n题目要求我们在正确模型的假设下，为一个固定的 $p  0$ 计算期望值 $\\mathbb{E}[U_{k}^{p}]$。\n在第 1 部分中，我们已经确定，在正确模型下，$U_k$ 服从区间 $[0, 1]$ 上的均匀分布。设 $u$ 是随机变量 $U_k$ 的一个实现。$U_k$ 的概率密度函数 (PDF) 是：\n$$\nf_{U}(u) = \n\\begin{cases} \n1  \\text{若 } 0 \\leq u \\leq 1 \\\\\n0  \\text{其他}\n\\end{cases}\n$$\n随机变量 $U_k$ 的函数 $g(U_k)$ 的期望值由 $\\mathbb{E}[g(U_k)] = \\int_{-\\infty}^{\\infty} g(u) f_{U}(u) \\, du$ 给出。在我们的例子中，$g(u) = u^p$。所以，我们需要计算：\n$$\n\\mathbb{E}[U_{k}^{p}] = \\int_{0}^{1} u^{p} \\cdot 1 \\, du\n$$\n这是一个标准积分。由于 $p  0$，我们有 $p+1  1$。$u^p$ 的反导数是 $\\frac{u^{p+1}}{p+1}$。\n$$\n\\mathbb{E}[U_{k}^{p}] = \\left[ \\frac{u^{p+1}}{p+1} \\right]_{0}^{1}\n$$\n在积分上下限处求值：\n$$\n\\mathbb{E}[U_{k}^{p}] = \\frac{1^{p+1}}{p+1} - \\frac{0^{p+1}}{p+1}\n$$\n由于 $p+1  1$，$0^{p+1} = 0$。且 $1^{p+1} = 1$。\n$$\n\\mathbb{E}[U_{k}^{p}] = \\frac{1}{p+1} - 0 = \\frac{1}{p+1}\n$$\n这就是期望的闭式表达式。",
            "answer": "$$\\boxed{\\frac{1}{p+1}}$$"
        }
    ]
}