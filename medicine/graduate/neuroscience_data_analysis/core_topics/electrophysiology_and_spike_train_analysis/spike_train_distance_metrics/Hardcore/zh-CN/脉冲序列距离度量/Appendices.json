{
    "hands_on_practices": [
        {
            "introduction": "要想真正掌握 Victor-Purpura 距离，我们必须深入了解其计算核心。该度量将脉冲序列之间的差异概念化为最小“编辑成本”，这是一个可通过动态规划优雅解决的问题。本练习将指导您从基本原理推导其核心递推关系并加以应用，从而巩固您对 VP 距离如何量化脉冲发放时间差异的理解。",
            "id": "4194680",
            "problem": "给定两个以毫秒为单位观测的单神经元脉冲序列 $S_1$ 和 $S_2$，表示为有序的事件时间 $S_1 = (0, 10, 20)~\\mathrm{ms}$ 和 $S_2 = (5, 12, 22)~\\mathrm{ms}$。考虑 Victor–Purpura (VP) 脉冲序列距离，它定义为将一个脉冲序列转换为另一个脉冲序列的一系列允许编辑操作的最小总成本。其中，插入一个脉冲的成本为 $1$，删除一个脉冲的成本为 $1$，将单个脉冲连续时间平移 $\\Delta t$ 的成本为 $q\\,|\\Delta t|$。这里 $q = 0.1~\\mathrm{ms}^{-1}$。\n\n从这些核心定义以及动态规划通过利用最优子结构和重叠子问题来解决最优序列对齐问题的公认原理出发，完成以下任务：\n\n1. 为两个有限脉冲序列 $S_1 = (t_1,\\dots,t_m)$ 和 $S_2 = (u_1,\\dots,u_n)$ 之间的 Victor–Purpura 距离 $d_{\\mathrm{VP}}(S_1, S_2)$ 推导一个动态规划递推关系，该关系需与上述操作集和成本一致。您的推导必须从 $d_{\\mathrm{VP}}$ 作为最小成本转换的定义开始，并通过最优子结构来证明该递推关系，而不能假设任何已有的闭式对齐公式。\n2. 使用您的递推关系计算特定序列 $S_1 = (0, 10, 20)~\\mathrm{ms}$ 和 $S_2 = (5, 12, 22)~\\mathrm{ms}$ 在 $q = 0.1~\\mathrm{ms}^{-1}$ 时的 $d_{\\mathrm{VP}}(S_1, S_2)$，并展示所有支持最终值的中间量。\n\n将最终答案表示为一个不带单位的实数。无需四舍五入。",
            "solution": "该问题陈述清晰，具有科学依据，并提供了推导所需递推关系和计算指定距离的所有必要信息。我们按两部分进行解答。\n\n### 第一部分：动态规划递推关系的推导\n\n两个脉冲序列 $S_1 = (t_1, \\dots, t_m)$ 和 $S_2 = (u_1, \\dots, u_n)$ 之间的 Victor-Purpura (VP) 距离 $d_{\\mathrm{VP}}(S_1, S_2)$ 是使用一组允许的操作将 $S_1$ 转换为 $S_2$ 的最小总成本。该问题具有最优子结构，因此适合采用动态规划方法求解。\n\n让我们定义一个子问题。设 $S_{1,i} = (t_1, \\dots, t_i)$ 是 $S_1$ 的包含前 $i$ 个脉冲的前缀，而 $S_{2,j} = (u_1, \\dots, u_j)$ 是 $S_2$ 的包含前 $j$ 个脉冲的前缀。我们定义 $D(i, j)$ 为这些前缀之间的 VP 距离：$D(i, j) = d_{\\mathrm{VP}}(S_{1,i}, S_{2,j})$。我们的目标是计算 $D(m, n)$。\n\n该解构建在一个大小为 $(m+1) \\times (n+1)$ 的成本矩阵 $D$ 之上，其中索引 $i$ 的范围是从 $0$ 到 $m$，$j$ 的范围是从 $0$ 到 $n$。\n\n**基本情况：**\n将一个空脉冲序列转换为另一个的成本取决于所需插入或删除的数量。\n1. 两个空脉冲序列之间的距离为零：\n$$D(0, 0) = 0$$\n2. 要将一个有 $i$ 个脉冲的脉冲序列 $S_{1,i}$ 转换为空序列，我们必须删除所有 $i$ 个脉冲。每次删除的成本为 $1$。因此，总成本为 $i$：\n$$D(i, 0) = i \\quad \\text{for } i  0$$\n3. 要将一个空脉冲序列转换为一个有 $j$ 个脉冲的脉冲序列 $S_{2,j}$，我们必须插入所有 $j$ 个脉冲。每次插入的成本为 $1$。因此，总成本为 $j$：\n$$D(0, j) = j \\quad \\text{for } j  0$$\n\n**递推关系：**\n对于 $i  0$ 和 $j  0$ 的一般情况 $D(i, j)$，我们考虑将 $S_{1,i}$ 转换为 $S_{2,j}$。最优子结构原理指出，计算 $D(i, j)$ 的最优（最小成本）路径必须建立在更小子问题的最优解之上。转换序列中的最后一步操作必然涉及最后的脉冲 $t_i$ 和 $u_j$。最后一步有三种可能性：\n\n1.  **删除：** 从 $S_{1,i}$ 中删除脉冲 $t_i$。此操作的成本为 $1$。剩下的问题是将前缀 $S_{1, i-1}$ 转换为 $S_{2,j}$。根据定义，这个子问题的最小成本是 $D(i-1, j)$。因此，通过这条路径的总成本是 $D(i-1, j) + 1$。\n\n2.  **插入：** 插入脉冲 $u_j$。这意味着我们已经将 $S_{1,i}$ 最优地转换为 $S_{2, j-1}$，然后执行最后的插入 $u_j$ 的操作。插入的成本为 $1$。前一个子问题的成本是 $D(i, j-1)$。因此，通过这条路径的总成本是 $D(i, j-1) + 1$。\n\n3.  **平移（或匹配）：** 脉冲 $t_i$ 被认为与脉冲 $u_j$ 对应。这被建模为将 $t_i$ 平移到 $u_j$ 的时间。此操作的成本是 $q|t_i - u_j|$。剩下的问题是将前缀 $S_{1, i-1}$ 转换为 $S_{2, j-1}$，其最小成本为 $D(i-1, j-1)$。因此，通过这条路径的总成本是 $D(i-1, j-1) + q|t_i - u_j|$。\n\nVP 距离 $D(i, j)$ 是这三个互斥的最后操作的成本中的最小值。这就得出了递推关系：\n$$D(i, j) = \\min\\left( D(i-1, j) + 1, \\quad D(i, j-1) + 1, \\quad D(i-1, j-1) + q|t_i - u_j| \\right)$$\n这个递推关系连同基本情况，允许系统地计算整个成本矩阵 $D$，最终答案为 $D(m, n)$。\n\n### 第二部分：针对特定脉冲序列的计算\n\n给定：\n- 脉冲序列 $S_1 = (t_1, t_2, t_3) = (0, 10, 20)~\\mathrm{ms}$。因此，$m = 3$。\n- 脉冲序列 $S_2 = (u_1, u_2, u_3) = (5, 12, 22)~\\mathrm{ms}$。因此，$n = 3$。\n- 成本参数 $q = 0.1~\\mathrm{ms}^{-1}$。\n\n我们将计算 $i, j \\in \\{0, 1, 2, 3\\}$ 的 $4 \\times 4$ 矩阵 $D(i, j)$。\n\n**初始化（基本情况）：**\n$D(0, 0) = 0$。\n$D(i, 0) = i$：\n$D(1, 0) = 1$\n$D(2, 0) = 2$\n$D(3, 0) = 3$\n\n$D(0, j) = j$：\n$D(0, 1) = 1$\n$D(0, 2) = 2$\n$D(0, 3) = 3$\n\n初始矩阵为：\n$$\nD = \\begin{pmatrix}\n0  1  2  3 \\\\\n1  ?  ?  ? \\\\\n2  ?  ?  ? \\\\\n3  ?  ?  ?\n\\end{pmatrix}\n$$\n\n**填充矩阵：**\n我们逐行计算剩余的元素。\n\n- **$D(1, 1)$：** 使用 $t_1=0, u_1=5$：\n$$ D(1, 1) = \\min(D(0, 1)+1, D(1, 0)+1, D(0, 0) + q|t_1-u_1|) $$\n$$ D(1, 1) = \\min(1+1, 1+1, 0 + 0.1|0-5|) = \\min(2, 2, 0.5) = 0.5 $$\n\n- **$D(1, 2)$：** 使用 $t_1=0, u_2=12$：\n$$ D(1, 2) = \\min(D(0, 2)+1, D(1, 1)+1, D(0, 1) + q|t_1-u_2|) $$\n$$ D(1, 2) = \\min(2+1, 0.5+1, 1 + 0.1|0-12|) = \\min(3, 1.5, 1+1.2) = \\min(3, 1.5, 2.2) = 1.5 $$\n\n- **$D(1, 3)$：** 使用 $t_1=0, u_3=22$：\n$$ D(1, 3) = \\min(D(0, 3)+1, D(1, 2)+1, D(0, 2) + q|t_1-u_3|) $$\n$$ D(1, 3) = \\min(3+1, 1.5+1, 2 + 0.1|0-22|) = \\min(4, 2.5, 2+2.2) = \\min(4, 2.5, 4.2) = 2.5 $$\n\n- **$D(2, 1)$：** 使用 $t_2=10, u_1=5$：\n$$ D(2, 1) = \\min(D(1, 1)+1, D(2, 0)+1, D(1, 0) + q|t_2-u_1|) $$\n$$ D(2, 1) = \\min(0.5+1, 2+1, 1 + 0.1|10-5|) = \\min(1.5, 3, 1+0.5) = \\min(1.5, 3, 1.5) = 1.5 $$\n\n- **$D(2, 2)$：** 使用 $t_2=10, u_2=12$：\n$$ D(2, 2) = \\min(D(1, 2)+1, D(2, 1)+1, D(1, 1) + q|t_2-u_2|) $$\n$$ D(2, 2) = \\min(1.5+1, 1.5+1, 0.5 + 0.1|10-12|) = \\min(2.5, 2.5, 0.5+0.2) = \\min(2.5, 2.5, 0.7) = 0.7 $$\n\n- **$D(2, 3)$：** 使用 $t_2=10, u_3=22$：\n$$ D(2, 3) = \\min(D(1, 3)+1, D(2, 2)+1, D(1, 2) + q|t_2-u_3|) $$\n$$ D(2, 3) = \\min(2.5+1, 0.7+1, 1.5 + 0.1|10-22|) = \\min(3.5, 1.7, 1.5+1.2) = \\min(3.5, 1.7, 2.7) = 1.7 $$\n\n- **$D(3, 1)$：** 使用 $t_3=20, u_1=5$：\n$$ D(3, 1) = \\min(D(2, 1)+1, D(3, 0)+1, D(2, 0) + q|t_3-u_1|) $$\n$$ D(3, 1) = \\min(1.5+1, 3+1, 2 + 0.1|20-5|) = \\min(2.5, 4, 2+1.5) = \\min(2.5, 4, 3.5) = 2.5 $$\n\n- **$D(3, 2)$：** 使用 $t_3=20, u_2=12$：\n$$ D(3, 2) = \\min(D(2, 2)+1, D(3, 1)+1, D(2, 1) + q|t_3-u_2|) $$\n$$ D(3, 2) = \\min(0.7+1, 2.5+1, 1.5 + 0.1|20-12|) = \\min(1.7, 3.5, 1.5+0.8) = \\min(1.7, 3.5, 2.3) = 1.7 $$\n\n- **$D(3, 3)$：** 使用 $t_3=20, u_3=22$：\n$$ D(3, 3) = \\min(D(2, 3)+1, D(3, 2)+1, D(2, 2) + q|t_3-u_3|) $$\n$$ D(3, 3) = \\min(1.7+1, 1.7+1, 0.7 + 0.1|20-22|) = \\min(2.7, 2.7, 0.7+0.2) = \\min(2.7, 2.7, 0.9) = 0.9 $$\n\n最终填充的成本矩阵为：\n$$\nD = \\begin{pmatrix}\n0    1    2    3   \\\\\n1    0.5  1.5  2.5 \\\\\n2    1.5  0.7  1.7 \\\\\n3    2.5  1.7  0.9\n\\end{pmatrix}\n$$\n$S_1$ 和 $S_2$ 之间的 Victor-Purpura 距离是矩阵右下角的值 $D(3, 3)$。\n$$ d_{\\mathrm{VP}}(S_1, S_2) = D(3, 3) = 0.9 $$",
            "answer": "$$\n\\boxed{0.9}\n$$"
        },
        {
            "introduction": "与基于编辑的 Victor-Purpura 度量不同，van Rossum 距离将脉冲序列视为连续信号。它通过计算与指数核函数卷积后的脉冲序列之差的积分平方来衡量其差异性。本练习要求您推导该距离的精确解析公式，揭示其如何巧妙地简化为对所有脉冲对之间相互作用的求和。",
            "id": "4194684",
            "problem": "考虑两个脉冲序列，表示为狄拉克δ分布的和：$s_{1}(t)=\\sum_{i=1}^{N_{1}}\\delta(t-t_{i})$ 和 $s_{2}(t)=\\sum_{j=1}^{N_{2}}\\delta(t-u_{j})$，其中 $\\delta(\\cdot)$ 表示狄拉克δ分布，$\\{t_{i}\\}$ 和 $\\{u_{j}\\}$ 是脉冲时间。令指数衰减核为 $h(t)=\\exp(-t/\\tau)H(t)$，其中 $H(t)$ 是亥维赛阶跃函数，$\\tau0$ 是时间常数。定义滤波后的信号为 $x_{1}(t)=(h*s_{1})(t)$ 和 $x_{2}(t)=(h*s_{2})(t)$，其中 $*$ 表示卷积。van Rossum (vR) 距离由 $L^{2}$ 范数的平方定义：\n$$\nd_{\\mathrm{vR}}^{2}=\\frac{1}{\\tau}\\int_{-\\infty}^{\\infty}\\left[x_{1}(t)-x_{2}(t)\\right]^{2}\\,\\mathrm{d}t\n$$\n从这些定义出发，并且不使用任何捷径公式，推导出一个关于脉冲时间 $\\{t_{i}\\}$、$\\{u_{j}\\}$ 和逐对指数重叠的 $d_{\\mathrm{vR}}^{2}$ 的闭式表达式。然后，对于脉冲序列 $S_{1}=\\{0,10\\}$ ms 和 $S_{2}=\\{5,12\\}$ ms，以及 $\\tau=5$ ms，计算 $d_{\\mathrm{vR}}^{2}$ 的值。将最终数值表示为无量纲数，并四舍五入到四位有效数字。",
            "solution": "问题要求推导 van Rossum 距离 $d_{\\mathrm{vR}}^{2}$ 的闭式表达式，并随后对两个特定的脉冲序列进行求值。\n\n### 步骤1：问题验证\n问题陈述给出了以下已知条件：\n- 脉冲序列1：$s_{1}(t)=\\sum_{i=1}^{N_{1}}\\delta(t-t_{i})$。\n- 脉冲序列2：$s_{2}(t)=\\sum_{j=1}^{N_{2}}\\delta(t-u_{j})$。\n- 指数核：$h(t)=\\exp(-t/\\tau)H(t)$，其中 $\\tau0$。$H(t)$ 是亥维赛阶跃函数。\n- 滤波后信号：$x_{1}(t)=(h*s_{1})(t)$ 和 $x_{2}(t)=(h*s_{2})(t)$，其中 $*$ 是卷积。\n- van Rossum 距离平方的定义：$d_{\\mathrm{vR}}^{2}=\\frac{1}{\\tau}\\int_{-\\infty}^{\\infty}\\left[x_{1}(t)-x_{2}(t)\\right]^{2}\\,\\mathrm{d}t$。\n- 用于求值的特定脉冲序列：$S_{1}=\\{0,10\\}$ ms 和 $S_{2}=\\{5,12\\}$ ms。\n- 特定时间常数：$\\tau=5$ ms。\n\n该问题具有科学依据，提法明确，且客观。它基于计算神经科学和数学的标准定义。所有必要信息都已提供，没有矛盾之处。问题是有效的。\n\n### 步骤2：闭式表达式的推导\n\nvan Rossum 距离的平方由下式给出：\n$$\nd_{\\mathrm{vR}}^{2}=\\frac{1}{\\tau}\\int_{-\\infty}^{\\infty}\\left[x_{1}(t)-x_{2}(t)\\right]^{2}\\,\\mathrm{d}t\n$$\n将被积函数中的平方展开，得到：\n$$\nd_{\\mathrm{vR}}^{2} = \\frac{1}{\\tau}\\left(\\int_{-\\infty}^{\\infty} x_1(t)^2 \\,\\mathrm{d}t - 2\\int_{-\\infty}^{\\infty} x_1(t)x_2(t) \\,\\mathrm{d}t + \\int_{-\\infty}^{\\infty} x_2(t)^2 \\,\\mathrm{d}t\\right)\n$$\n首先，我们明确地写出滤波后的信号 $x_1(t)$ 和 $x_2(t)$。核函数 $h(t)$ 与脉冲序列 $s(t) = \\sum_k \\delta(t-t_k)$ 的卷积是：\n$$\n(h*s)(t) = \\int_{-\\infty}^{\\infty} h(t-t') \\sum_k \\delta(t'-t_k) \\,\\mathrm{d}t' = \\sum_k h(t-t_k)\n$$\n使用给定的核函数 $h(t)=\\exp(-t/\\tau)H(t)$，滤波后的信号为：\n$$\nx_{1}(t) = \\sum_{i=1}^{N_1} \\exp\\left(-\\frac{t-t_i}{\\tau}\\right) H(t-t_i)\n$$\n$$\nx_{2}(t) = \\sum_{j=1}^{N_2} \\exp\\left(-\\frac{t-u_j}{\\tau}\\right) H(t-u_j)\n$$\n现在，我们来计算这些积分。我们从交叉项积分 $\\int_{-\\infty}^{\\infty} x_1(t)x_2(t) \\,\\mathrm{d}t$ 开始。\n\\begin{align*}\n\\int_{-\\infty}^{\\infty} x_1(t)x_2(t) \\,\\mathrm{d}t = \\int_{-\\infty}^{\\infty} \\left(\\sum_{i=1}^{N_1} h(t-t_i)\\right) \\left(\\sum_{j=1}^{N_2} h(t-u_j)\\right) \\,\\mathrm{d}t \\\\\n= \\sum_{i=1}^{N_1} \\sum_{j=1}^{N_2} \\int_{-\\infty}^{\\infty} h(t-t_i) h(t-u_j) \\,\\mathrm{d}t\n\\end{align*}\n让我们对一对脉冲 $(t_i, u_j)$ 计算内部积分：\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{t-t_i}{\\tau}\\right)H(t-t_i) \\exp\\left(-\\frac{t-u_j}{\\tau}\\right)H(t-u_j) \\,\\mathrm{d}t\n$$\n亥维赛函数的乘积 $H(t-t_i)H(t-u_j)$ 仅在 $t \\ge t_i$ 和 $t \\ge u_j$ 时非零，即 $t \\ge \\max(t_i, u_j)$。令 $t_{\\max} = \\max(t_i, u_j)$。积分变为：\n\\begin{align*}\n\\int_{t_{\\max}}^{\\infty} \\exp\\left(-\\frac{t-t_i}{\\tau} - \\frac{t-u_j}{\\tau}\\right) \\,\\mathrm{d}t = \\exp\\left(\\frac{t_i+u_j}{\\tau}\\right) \\int_{t_{\\max}}^{\\infty} \\exp\\left(-\\frac{2t}{\\tau}\\right) \\,\\mathrm{d}t \\\\\n= \\exp\\left(\\frac{t_i+u_j}{\\tau}\\right) \\left[-\\frac{\\tau}{2}\\exp\\left(-\\frac{2t}{\\tau}\\right)\\right]_{t_{\\max}}^{\\infty} \\\\\n= \\exp\\left(\\frac{t_i+u_j}{\\tau}\\right) \\left(0 - \\left(-\\frac{\\tau}{2}\\exp\\left(-\\frac{2t_{\\max}}{\\tau}\\right)\\right)\\right) \\\\\n= \\frac{\\tau}{2}\\exp\\left(\\frac{t_i+u_j-2t_{\\max}}{\\tau}\\right)\n\\end{align*}\n如果 $t_i \\ge u_j$，那么 $t_{\\max} = t_i$，指数为 $(t_i+u_j-2t_i)/\\tau = (u_j-t_i)/\\tau = -|t_i-u_j|/\\tau$。\n如果 $u_j  t_i$，那么 $t_{\\max} = u_j$，指数为 $(t_i+u_j-2u_j)/\\tau = (t_i-u_j)/\\tau = -|t_i-u_j|/\\tau$。\n两种情况下，结果都是 $\\frac{\\tau}{2}\\exp\\left(-\\frac{|t_i-u_j|}{\\tau}\\right)$。\n因此，交叉项积分为：\n$$\n\\int_{-\\infty}^{\\infty} x_1(t)x_2(t) \\,\\mathrm{d}t = \\sum_{i=1}^{N_1} \\sum_{j=1}^{N_2} \\frac{\\tau}{2}\\exp\\left(-\\frac{|t_i-u_j|}{\\tau}\\right)\n$$\n通过将 $s_2$ 替换为 $s_1$（即 $u_j \\to t_k$, $N_2 \\to N_1$），我们得到自身项积分 $\\int x_1(t)^2 \\,\\mathrm{d}t$：\n$$\n\\int_{-\\infty}^{\\infty} x_1(t)^2 \\,\\mathrm{d}t = \\sum_{i=1}^{N_1} \\sum_{k=1}^{N_1} \\frac{\\tau}{2}\\exp\\left(-\\frac{|t_i-t_k|}{\\tau}\\right)\n$$\n类似地，对于 $x_2(t)$：\n$$\n\\int_{-\\infty}^{\\infty} x_2(t)^2 \\,\\mathrm{d}t = \\sum_{j=1}^{N_2} \\sum_{l=1}^{N_2} \\frac{\\tau}{2}\\exp\\left(-\\frac{|u_j-u_l|}{\\tau}\\right)\n$$\n将这些代回 $d_{\\mathrm{vR}}^{2}$ 的表达式中：\n\\begin{align*}\nd_{\\mathrm{vR}}^{2} = \\frac{1}{\\tau} \\left[ \\sum_{i,k} \\frac{\\tau}{2}\\exp\\left(-\\frac{|t_i-t_k|}{\\tau}\\right) - 2\\sum_{i,j} \\frac{\\tau}{2}\\exp\\left(-\\frac{|t_i-u_j|}{\\tau}\\right) + \\sum_{j,l} \\frac{\\tau}{2}\\exp\\left(-\\frac{|u_j-u_l|}{\\tau}\\right) \\right] \\\\\n= \\frac{1}{2} \\left[ \\sum_{i=1}^{N_1}\\sum_{k=1}^{N_1} \\exp\\left(-\\frac{|t_i-t_k|}{\\tau}\\right) - 2\\sum_{i=1}^{N_1}\\sum_{j=1}^{N_2} \\exp\\left(-\\frac{|t_i-u_j|}{\\tau}\\right) + \\sum_{j=1}^{N_2}\\sum_{l=1}^{N_2} \\exp\\left(-\\frac{|u_j-u_l|}{\\tau}\\right) \\right]\n\\end{align*}\n这就是所求的闭式表达式。\n\n### 步骤3：数值计算\n\n给定 $S_{1}=\\{t_1, t_2\\}=\\{0, 10\\}$ ms，$S_{2}=\\{u_1, u_2\\}=\\{5, 12\\}$ ms，以及 $\\tau=5$ ms。像 $|t_i-u_j|/\\tau$ 这样的比率是无量纲的。\n\n让我们计算 $d_{\\mathrm{vR}}^{2}$ 表达式中的三项：\n1.  第一项（$S_1$ 内部的相互作用）：\n\\begin{align*}\n\\sum_{i=1}^{2}\\sum_{k=1}^{2} \\exp\\left(-\\frac{|t_i-t_k|}{\\tau}\\right) = \\exp\\left(-\\frac{|0-0|}{5}\\right) + \\exp\\left(-\\frac{|0-10|}{5}\\right) + \\exp\\left(-\\frac{|10-0|}{5}\\right) + \\exp\\left(-\\frac{|10-10|}{5}\\right) \\\\\n= \\exp(0) + \\exp(-2) + \\exp(-2) + \\exp(0) = 2 + 2\\exp(-2)\n\\end{align*}\n2.  第二项（$S_1$ 和 $S_2$ 之间的交叉相互作用）：\n\\begin{align*}\n-2\\sum_{i=1}^{2}\\sum_{j=1}^{2} \\exp\\left(-\\frac{|t_i-u_j|}{\\tau}\\right) = -2 \\left[ \\exp\\left(-\\frac{|0-5|}{5}\\right) + \\exp\\left(-\\frac{|0-12|}{5}\\right) + \\exp\\left(-\\frac{|10-5|}{5}\\right) + \\exp\\left(-\\frac{|10-12|}{5}\\right) \\right] \\\\\n= -2 \\left[ \\exp(-1) + \\exp(-2.4) + \\exp(-1) + \\exp(-0.4) \\right] \\\\\n= -4\\exp(-1) - 2\\exp(-2.4) - 2\\exp(-0.4)\n\\end{align*}\n3.  第三项（$S_2$ 内部的相互作用）：\n\\begin{align*}\n\\sum_{j=1}^{2}\\sum_{l=1}^{2} \\exp\\left(-\\frac{|u_j-u_l|}{\\tau}\\right) = \\exp\\left(-\\frac{|5-5|}{5}\\right) + \\exp\\left(-\\frac{|5-12|}{5}\\right) + \\exp\\left(-\\frac{|12-5|}{5}\\right) + \\exp\\left(-\\frac{|12-12|}{5}\\right) \\\\\n= \\exp(0) + \\exp(-1.4) + \\exp(-1.4) + \\exp(0) = 2 + 2\\exp(-1.4)\n\\end{align*}\n将这些项组合到 $d_{\\mathrm{vR}}^{2}$ 的表达式中：\n\\begin{align*}\nd_{\\mathrm{vR}}^{2} = \\frac{1}{2} \\left[ (2 + 2\\exp(-2)) + (-4\\exp(-1) - 2\\exp(-2.4) - 2\\exp(-0.4)) + (2 + 2\\exp(-1.4)) \\right] \\\\\n= (1 + \\exp(-2)) - (2\\exp(-1) + \\exp(-2.4) + \\exp(-0.4)) + (1 + \\exp(-1.4)) \\\\\n= 2 + \\exp(-2) + \\exp(-1.4) - 2\\exp(-1) - \\exp(-2.4) - \\exp(-0.4)\n\\end{align*}\n现在，我们代入指数函数的数值：\n$\\exp(-1) \\approx 0.367879$\n$\\exp(-2) \\approx 0.135335$\n$\\exp(-0.4) \\approx 0.670320$\n$\\exp(-1.4) \\approx 0.246597$\n$\\exp(-2.4) \\approx 0.090718$\n\n\\begin{align*}\nd_{\\mathrm{vR}}^{2} \\approx 2 + 0.135335 + 0.246597 - 2(0.367879) - 0.090718 - 0.670320 \\\\\n\\approx 2.381932 - 0.735758 - 0.090718 - 0.670320 \\\\\n\\approx 2.381932 - 1.496796 \\\\\n\\approx 0.885136\n\\end{align*}\n四舍五入到四位有效数字，我们得到 $0.8851$。",
            "answer": "$$\\boxed{0.8851}$$"
        },
        {
            "introduction": "在理解了 Victor-Purpura 和 van Rossum 两种度量的计算原理之后，我们可以开始探索它们的实际应用意义。不同的度量方法各有其独特的敏感性，对神经编码的分析可能得出不同的结论。这个编程练习将挑战您构建一个场景，在该场景中两种度量对脉冲序列的相似性排序产生分歧，从而揭示为具体科学问题选择合适工具和参数的关键性。",
            "id": "4194658",
            "problem": "您将获得以秒为单位的事件时间有序列表表示的有限脉冲序列。考虑一个固定的参考脉冲序列和三个候选脉冲序列。您的任务是为每个候选序列计算其与参考序列之间的两种距离：Victor–Purpura 距离和 van Rossum 距离。然后，在每个指定的参数体系下，根据每种度量标准，按与参考序列的距离从小到大对三个候选序列进行排序，并报告排序结果。您必须根据每个度量标准的核心定义来实现，不得使用任何未经证实的快捷方式。\n\n定义与要求：\n- 脉冲序列是一个有限的、以秒为单位的有序时间序列，记作 $T=\\{t_1,\\dots,t_n\\}$，其中 $t_i \\in \\mathbb{R}$ 且 $t_1 \\le t_2 \\le \\cdots \\le t_n$。\n- Victor–Purpura 距离 $d_{\\mathrm{VP}}$：此距离是通过一系列基本操作将一个脉冲序列转换为另一个脉冲序列的最小总成本。这些操作包括：删除一个脉冲（成本为 $1$）、插入一个脉冲（成本为 $1$）、以及将一个脉冲在时间上移动 $\\Delta t$（成本为 $q|\\Delta t|$），其中 $q0$ 是一个可调参数，单位为 $\\mathrm{s}^{-1}$。单次脉冲移动的成本绝不能超过删除并重新插入该脉冲的总成本。所有时间都必须以秒为单位处理。\n- van Rossum 距离 $d_{\\mathrm{vR}}$：此距离是两个滤波后脉冲序列之差的欧几里得范数，其中滤波器是衰减时间常数为 $\\tau0$（单位为秒）的因果指数核。该核仅在正时间延迟下非零，并呈指数衰减。在计算欧几里得范数之前，两个脉冲序列都与此核进行卷积。所有时间都必须以秒为单位处理。对于有限脉冲序列，计算必须在数学上是精确的。\n\n排序与平局处理：\n- 对于每种度量标准和每个参数体系，计算从参考序列到三个候选序列的距离。按距离从小到大对三个候选序列进行排序。如果两个距离在数值容差 $\\varepsilon=10^{-12}$ 内相等，则按候选标签索引（定义如下）的升序来打破平局。\n\n脉冲序列（时间单位：秒）：\n- 参考序列 $R = [0.10, 0.30, 0.50, 0.70]$。\n- 候选序列 $A = [0.10, 0.30, 0.50, 0.72]$。\n- 候选序列 $B = [0.10, 0.33, 0.50, 0.70]$。\n- 候选序列 $C = [0.10, 0.30, 0.50]$。\n\n标签索引：\n- 使用整数标签 $0,1,2$ 分别表示候选序列 $A,B,C$。\n\n测试套件（参数体系）：\n- 情况 $1$：$q=200$ (单位 $\\mathrm{s}^{-1}$), $\\tau=0.05$ (单位 $\\mathrm{s}$)。\n- 情况 $2$：$q=0$ (单位 $\\mathrm{s}^{-1}$), $\\tau=0.005$ (单位 $\\mathrm{s}$)。\n- 情况 $3$：$q=5$ (单位 $\\mathrm{s}^{-1}$), $\\tau=0.20$ (单位 $\\mathrm{s}$)。\n\n输出规格：\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。该列表必须按顺序包含：情况 1 的 Victor–Purpura 排序、情况 1 的 van Rossum 排序、情况 2 的 Victor–Purpura 排序、情况 2 的 van Rossum 排序、情况 3 的 Victor–Purpura 排序和情况 3 的 van Rossum 排序。每个排序本身必须是三个候选标签 $[0,1,2]$ 的列表，按从最相似（距离最小）到最不相似（距离最大）的顺序排序。例如，一个有效的输出结构是 $[[0,2,1],[0,1,2],[\\dots],[\\dots],[\\dots],[\\dots]]$，不含空格。",
            "solution": "该问题要求计算和比较三个候选脉冲序列相对于一个参考序列的两种不同脉冲序列距离度量：Victor–Purpura 距离（$d_{\\mathrm{VP}}$）和 van Rossum 距离（$d_{\\mathrm{vR}}$）。分析在三种不同的参数体系下进行。先验验证证实该问题具有科学依据、是适定的、客观的，并包含获得唯一解所需的所有必要信息。\n\n设参考脉冲序列为 $R = \\{r_1, \\dots, r_{n_R}\\}$，候选脉冲序列为 $X = \\{x_1, \\dots, x_{n_X}\\}$。\n\n**Victor–Purpura 距离（$d_{\\mathrm{VP}}$）**\n\nVictor–Purpura 距离是一种基于将一个脉冲序列转换为另一个所需最小成本的度量。基本操作及其相关成本如下：\n1.  **插入**一个脉冲：成本为 $1$。\n2.  **删除**一个脉冲：成本为 $1$。\n3.  将一个脉冲从时间 $t_a$ **移动**到 $t_b$：成本为 $q|t_a - t_b|$，其中 $q$ 是一个单位为 $\\mathrm{s}^{-1}$ 的参数。\n\n这个最小成本可以通过动态规划算法高效计算，类似于计算字符串的 Levenshtein 距离。设 $T_1 = \\{t_1, \\dots, t_m\\}$ 和 $T_2 = \\{t'_1, \\dots, t'_n\\}$ 是两个脉冲序列。我们构建一个大小为 $(m+1) \\times (n+1)$ 的矩阵 $D$，其中 $D(i, j)$ 存储将 $T_1$ 的前 $i$ 个脉冲转换为 $T_2$ 的前 $j$ 个脉冲的最小成本。\n\n矩阵初始化如下：\n-   $D(0, 0) = 0$：将空序列转换为空序列的成本为 $0$。\n-   $D(i, 0) = i$ (对于 $i  0$)：将 $T_1$ 的前 $i$ 个脉冲转换为空序列的成本是 $i$ 次删除的成本。\n-   $D(0, j) = j$ (对于 $j  0$)：将空序列转换为 $T_2$ 的前 $j$ 个脉冲的成本是 $j$ 次插入的成本。\n\n然后，对于 $i0$ 和 $j0$，使用以下递推关系填充矩阵：\n$$\nD(i, j) = \\min \\left( D(i-1, j) + 1, \\quad D(i, j-1) + 1, \\quad D(i-1, j-1) + q|t_i - t'_j| \\right)\n$$\n这里，这三项分别对应于：\n1.  $D(i-1, j) + 1$：从 $T_1$ 中删除脉冲 $t_i$。\n2.  $D(i, j-1) + 1$：在转换后的序列中插入脉冲 $t'_j$。\n3.  $D(i-1, j-1) + q|t_i - t'_j|$：移动脉冲 $t_i$ 以匹配脉冲 $t'_j$。\n\n最终距离 $d_{\\mathrm{VP}}(T_1, T_2)$ 由元素 $D(m, n)$ 给出。问题中关于脉冲移动的成本不得超过删除和重新插入的成本（成本为 $2$）的约束，在递推式中通过 `min` 操作自然地得到了处理。如果 $q|t_i - t'_j|  2$，算法将选择对应于一次删除和一次插入的路径，而不是成本高昂的移动操作。\n\n对于 $q = 0$ 的特殊情况，移动脉冲的成本为 $0$。递推式变为 $D(i, j) = \\min(D(i-1, j) + 1, D(i, j-1) + 1, D(i-1, j-1))$。这相当于寻找替换成本为零的编辑距离，可简化为脉冲数量之差，即 $d_{\\mathrm{VP}}(T_1, T_2; q=0) = |m-n|$。\n\n**van Rossum 距离（$d_{\\mathrm{vR}}$）**\n\nvan Rossum 距离定义为两个脉冲序列与一个平滑核进行卷积后，两者之间的欧几里得距离。问题指定了一个因果指数核，$h(t) = \\exp(-t/\\tau)$ 对于 $t \\ge 0$ 且对于 $t  0$ 时 $h(t) = 0$。参数 $\\tau$ 是衰减的时间常数。\n\n对于一个脉冲序列 $T = \\{t_1, \\dots, t_n\\}$，滤波后的信号由下式给出：\n$$\nf_T(t) = \\sum_{i=1}^{n} h(t - t_i)\n$$\n两个脉冲序列 $T_1$ 和 $T_2$ 之间的 van Rossum 距离的平方是它们滤波后信号之差的 $L_2$ 范数的平方：\n$$\nd_{\\mathrm{vR}}(T_1, T_2)^2 = \\int_{-\\infty}^{\\infty} [f_{T_1}(t) - f_{T_2}(t)]^2 dt\n$$\n展开此积分可得：\n$$\nd_{\\mathrm{vR}}^2 = \\int_{-\\infty}^{\\infty} f_{T_1}(t)^2 dt + \\int_{-\\infty}^{\\infty} f_{T_2}(t)^2 dt - 2 \\int_{-\\infty}^{\\infty} f_{T_1}(t) f_{T_2}(t) dt\n$$\n这可以用内积表示为 $d_{\\mathrm{vR}}^2 = \\langle f_{T_1}, f_{T_1} \\rangle + \\langle f_{T_2}, f_{T_2} \\rangle - 2 \\langle f_{T_1}, f_{T_2} \\rangle$。问题要求进行精确的数学计算，这可以通过推导内积项 $\\langle f_a, f_b \\rangle$ 的解析形式来实现。\n\n设 $T_a=\\{t_1, \\dots, t_m\\}$ 和 $T_b=\\{t'_1, \\dots, t'_n\\}$。内积为：\n$$\n\\langle f_a, f_b \\rangle = \\int_{-\\infty}^{\\infty} \\left( \\sum_{i=1}^m h(t-t_i) \\right) \\left( \\sum_{j=1}^n h(t-t'_j) \\right) dt = \\sum_{i=1}^m \\sum_{j=1}^n \\int_{-\\infty}^{\\infty} h(t-t_i)h(t-t'_j) dt\n$$\n两个移位核乘积的积分可以解析求解：\n$$\n\\int_{-\\infty}^{\\infty} h(t-t_i)h(t-t'_j) dt = \\int_{\\max(t_i, t'_j)}^{\\infty} \\exp(-(t-t_i)/\\tau) \\exp(-(t-t'_j)/\\tau) dt = \\frac{\\tau}{2} \\exp(-|t_i-t'_j|/\\tau)\n$$\n将其代回，我们得到内积的闭合形式表达式：\n$$\n\\langle f_a, f_b \\rangle = \\frac{\\tau}{2} \\sum_{i=1}^m \\sum_{j=1}^n \\exp(-|t_i-t'_j|/\\tau)\n$$\n然后应用此公式计算三个内积项：$\\langle f_{T_1}, f_{T_1} \\rangle$、$\\langle f_{T_2}, f_{T_2} \\rangle$ 和 $\\langle f_{T_1}, f_{T_2} \\rangle$，从而计算出 van Rossum 距离的平方。最终距离是该结果的平方根。\n\n**排序流程**\n\n对于三种参数情况中的每一种，都计算参考序列 $R$ 到每个候选序列（$A$、$B$、$C$）的两种度量距离。然后，通过其标签 $0, 1, 2$ 识别的候选序列按距离递增的顺序进行排序。在两个距离在数值容差 $\\varepsilon=10^{-12}$ 内相等的情况下，通过按标签索引升序排序来打破平局。此流程为每种参数情况产生两个排序后的标签列表。",
            "answer": "```python\nimport numpy as np\nimport math\nfrom functools import cmp_to_key\n\ndef victor_purpura_dist(t1: np.ndarray, t2: np.ndarray, q: float) - float:\n    \"\"\"\n    Calculates the Victor-Purpura distance between two spike trains.\n\n    This function implements the dynamic programming algorithm described by\n    Victor  Purpura (1996, 1997).\n\n    Args:\n        t1: NumPy array of spike times for the first train.\n        t2: NumPy array of spike times for the second train.\n        q: Cost parameter for shifting a spike (in 1/seconds).\n\n    Returns:\n        The Victor-Purpura distance.\n    \"\"\"\n    n1 = len(t1)\n    n2 = len(t2)\n    \n    if q == 0.0:\n        return float(abs(n1 - n2))\n\n    # Initialize DP matrix D\n    d = np.zeros((n1 + 1, n2 + 1))\n\n    # Cost of deletions\n    for i in range(1, n1 + 1):\n        d[i, 0] = i\n    \n    # Cost of insertions\n    for j in range(1, n2 + 1):\n        d[0, j] = j\n\n    # Fill the rest of the matrix\n    for i in range(1, n1 + 1):\n        for j in range(1, n2 + 1):\n            cost_shift = q * abs(t1[i - 1] - t2[j - 1])\n            d[i, j] = min(d[i - 1, j] + 1,          # Deletion\n                          d[i, j - 1] + 1,          # Insertion\n                          d[i - 1, j - 1] + cost_shift)  # Shift/Match\n\n    return d[n1, n2]\n\ndef van_rossum_dist(t1: np.ndarray, t2: np.ndarray, tau: float) - float:\n    \"\"\"\n    Calculates the van Rossum distance between two spike trains.\n\n    This function uses the exact analytical formula derived from the\n    L2-norm of the difference of signals convolved with a causal\n    exponential kernel h(t) = exp(-t/tau) for t = 0.\n\n    Args:\n        t1: NumPy array of spike times for the first train.\n        t2: NumPy array of spike times for the second train.\n        tau: Time constant of the exponential kernel (in seconds).\n\n    Returns:\n        The van Rossum distance.\n    \"\"\"\n    if tau = 0:\n        raise ValueError(\"Time constant tau must be positive.\")\n\n    def inner_product(ta: np.ndarray, tb: np.ndarray) - float:\n        if len(ta) == 0 or len(tb) == 0:\n            return 0.0\n        # Create a matrix of all pairwise time differences\n        diff_matrix = np.abs(ta[:, np.newaxis] - tb[np.newaxis, :])\n        # Apply the kernel and sum\n        k_sum = np.sum(np.exp(-diff_matrix / tau))\n        return (tau / 2.0) * k_sum\n\n    k11 = inner_product(t1, t1)\n    k22 = inner_product(t2, t2)\n    k12 = inner_product(t1, t2)\n    \n    squared_dist = k11 + k22 - 2 * k12\n    \n    # The squared distance should be non-negative, but floating point errors\n    # can make it slightly negative.\n    return math.sqrt(max(0, squared_dist))\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem: calculate distances, rank candidates,\n    and format the output.\n    \"\"\"\n    # Define spike trains (times in seconds)\n    spike_trains = {\n        \"R\": np.array([0.10, 0.30, 0.50, 0.70]), # Reference\n        \"A\": np.array([0.10, 0.30, 0.50, 0.72]), # Candidate 0\n        \"B\": np.array([0.10, 0.33, 0.50, 0.70]), # Candidate 1\n        \"C\": np.array([0.10, 0.30, 0.50])       # Candidate 2\n    }\n    candidate_keys = [\"A\", \"B\", \"C\"]\n    \n    # Define test suite (parameter regimes)\n    test_cases = [\n        {\"q\": 200.0, \"tau\": 0.05},  # Case 1\n        {\"q\": 0.0,   \"tau\": 0.005}, # Case 2\n        {\"q\": 5.0,   \"tau\": 0.20}   # Case 3\n    ]\n\n    # Tolerance for tie-breaking\n    TOLERANCE = 1e-12\n\n    # Custom comparison function for sorting with tolerance\n    def compare_items(item1, item2):\n        d1, label1 = item1\n        d2, label2 = item2\n        if abs(d1 - d2)  TOLERANCE:\n            return label1 - label2  # Break tie by label index\n        return 1 if d1  d2 else -1\n\n    all_rankings = []\n    \n    ref_train = spike_trains[\"R\"]\n\n    for case in test_cases:\n        q_param, tau_param = case[\"q\"], case[\"tau\"]\n\n        # Calculate distances for the current case\n        distances_vp = []\n        distances_vr = []\n        for i, key in enumerate(candidate_keys):\n            candidate_train = spike_trains[key]\n            \n            dist_vp = victor_purpura_dist(ref_train, candidate_train, q_param)\n            distances_vp.append((dist_vp, i))\n\n            dist_vr = van_rossum_dist(ref_train, candidate_train, tau_param)\n            distances_vr.append((dist_vr, i))\n            \n        # Sort based on distance, with tie-breaking\n        sorted_vp = sorted(distances_vp, key=cmp_to_key(compare_items))\n        sorted_vr = sorted(distances_vr, key=cmp_to_key(compare_items))\n\n        # Extract ranked labels\n        ranking_vp = [label for dist, label in sorted_vp]\n        ranking_vr = [label for dist, label in sorted_vr]\n\n        all_rankings.append(ranking_vp)\n        all_rankings.append(ranking_vr)\n\n    # Format the final output string as specified\n    formatted_rankings = [repr(r).replace(\" \", \"\") for r in all_rankings]\n    print(f\"[{','.join(formatted_rankings)}]\")\n\nsolve()\n```"
        }
    ]
}