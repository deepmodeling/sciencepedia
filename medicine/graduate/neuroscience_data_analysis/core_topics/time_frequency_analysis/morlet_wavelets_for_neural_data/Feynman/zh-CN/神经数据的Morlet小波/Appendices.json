{
    "hands_on_practices": [
        {
            "introduction": "要有效地使用Morlet小波，我们必须理解其数学上的“尺度”参数如何与神经科学中具有物理意义的“频率”相关联。这项练习将引导您从第一性原理出发，推导出这一基本关系，并向您介绍影响锥（Cone of Influence, COI）的概念。掌握这项实践有助于您为有限长度的信号分析设定可靠的边界，避免对边缘伪影的错误解读。",
            "id": "4178689",
            "problem": "一个以 $f_s = 2000$ Hz 采样的局部场电位（LFP）时间序列，使用一个复Morlet母小波进行分析。该母小波在时域中定义为 $\\psi(t) = \\pi^{-1/4} \\exp(i \\omega_0 t) \\exp(-t^2/2)$，其中 $\\omega_0$ 是无量纲中心角频率。考虑通过母小波的伸缩和平移构建的连续小波变换（CWT），其尺度化小波为 $\\psi_s(t) = s^{-1/2} \\psi(t/s)$，其中尺度 $s>0$。仅使用傅里葉变换在伸缩下的基本性质以及Morlet小波的高斯包络，从第一性原理推导出Morlet小波的连续尺度 $s$ 与傅里葉频率 $f$ 之间的映射关系。然后，将此映射转换为适用于以 $f_s = 2000$ Hz 采样的数据的离散尺度表达式（以采样点为单位），并针对 $\\omega_0 = 6$ 的情况，给出频率 $f$ 在 $4$–$100$ Hz 区间内的该表达式。\n\n接下来，将影响锥（COI）定义为从Morlet小波中心测量的其幅度包络的e折时间，并推导出影响锥宽度作为频率 $f$ 的函数。使用 $\\omega_0 = 6$，计算在 $f = 10$ Hz 和 $f = 80$ Hz 处的影响锥宽度。将这些宽度以秒为单位表示，并将每个数值四舍五入到四位有效数字。\n\n您的最终答案必须包括：\n- 对于 $\\omega_0 = 6$ 和 $f_s = 2000$ Hz，离散尺度（以采样点为单位）作为频率 $f$ 函数的闭式表达式。\n- 在 $f = 10$ Hz 和 $f = 80$ Hz 处的影响锥宽度（以秒为单位），每个值均四舍五入到四位有效数字。",
            "solution": "该问题陈述是信号处理领域一个有效且定义明确的练习，具体涉及小波分析在时间序列数据中的应用，这是神经科学中的一项常见任务。所有给定的参数和定义都是标准的、科学上合理的且内部一致的。\n\n该问题可分为两个主要部分：首先，推导小波尺度与频率之间的关系；其次，推导并计算影响锥（COI）。\n\n第一部分：尺度到频率的映射\n\n复Morlet母小波在时域中表示为：\n$$\n\\psi(t) = \\pi^{-1/4} \\exp(i \\omega_0 t) \\exp\\left(-\\frac{t^2}{2}\\right)\n$$\n其中 $\\omega_0$ 是无量纲中心角频率。我们的目标是找到尺度参数 $s$ 与傅里葉频率 $f$ 之间的关系。这可以通过在傅里葉域中找到尺度化小波的峰值频率来实现。\n\n首先，我们确定母小波的傅里葉变换，$\\hat{\\psi}(\\omega) = \\int_{-\\infty}^{\\infty} \\psi(t) \\exp(-i\\omega t) dt$。该小波由两部分组成：一个复正弦波 $\\exp(i \\omega_0 t)$ 和一个高斯包络 $g(t) = \\pi^{-1/4} \\exp(-t^2/2)$。\n\n我们使用傅里叶变换的两个基本性质：\n1. 高斯函数 $\\exp(-at^2)$ 的变换是 $\\sqrt{\\pi/a} \\exp(-\\omega^2/(4a))$。对于我们的包络，常数 $\\pi^{-1/4}$ 是一个归一化因子，高斯部分是 $\\exp(-t^2/2)$，其中 $a=1/2$。因此，$\\exp(-t^2/2)$ 的傅里叶变换是 $\\sqrt{2\\pi} \\exp(-\\omega^2/2)$。\n2. 频率平移特性指出，$f(t)\\exp(i\\omega_0 t)$ 的傅里叶变换是 $\\hat{f}(\\omega - \\omega_0)$。\n\n结合这些，Morlet母小波 $\\psi(t)$ 的傅里葉变换为：\n$$\n\\hat{\\psi}(\\omega) = \\pi^{-1/4} \\sqrt{2\\pi} \\exp\\left(-\\frac{(\\omega - \\omega_0)^2}{2}\\right) = (2\\pi)^{1/4} \\exp\\left(-\\frac{(\\omega - \\omega_0)^2}{2}\\right)\n$$\n该函数幅度的峰值出现在指数的参数最大化时，即在 $\\omega = \\omega_0$ 处。这证实了 $\\omega_0$ 是母小波的中心角频率。\n\n接下来，我们考虑尺度化小波 $\\psi_s(t) = s^{-1/2} \\psi(t/s)$。我们使用傅里叶变换的尺度伸缩特性，该特性指出 $h(t/s)$ 的变换是 $|s|\\hat{h}(s\\omega)$。对于我们的尺度化小波，其傅里叶变换 $\\hat{\\psi}_s(\\omega)$ 为：\n$$\n\\hat{\\psi}_s(\\omega) = s^{-1/2} \\cdot s \\cdot \\hat{\\psi}(s\\omega) = s^{1/2} \\hat{\\psi}(s\\omega)\n$$\n代入 $\\hat{\\psi}(\\omega)$ 的表达式：\n$$\n\\hat{\\psi}_s(\\omega) = s^{1/2} (2\\pi)^{1/4} \\exp\\left(-\\frac{(s\\omega - \\omega_0)^2}{2}\\right)\n$$\n该尺度化小波的峰值角频率 $\\omega_{peak}$ 是通过最大化其幅度找到的，这发生在项 $(s\\omega - \\omega_0)^2$ 为零时。这给出：\n$$\ns\\omega_{peak} - \\omega_0 = 0 \\implies \\omega_{peak} = \\frac{\\omega_0}{s}\n$$\n角频率 $\\omega$（单位：弧度/秒）与傅里叶频率 $f$（单位：赫兹）之间的关系是 $\\omega = 2\\pi f$。因此，与尺度 $s$ 对应的中心频率 $f$ 是：\n$$\n2\\pi f = \\frac{\\omega_0}{s} \\implies s = \\frac{\\omega_0}{2\\pi f}\n$$\n这就是连续尺度 $s$（以时间为单位）与傅里叶频率 $f$ 之间的一般映射关系。\n\n问题要求将此映射转换为以采样点为单位的离散尺度表达式。时间尺度 $s$（以秒为单位）通过除以采样周期 $\\Delta T = 1/f_s$（或等效地，乘以采样频率 $f_s$）转换为离散尺度 $s_{samples}$（以采样点为单位）：\n$$\ns_{samples}(f) = s \\cdot f_s = \\left(\\frac{\\omega_0}{2\\pi f}\\right) f_s\n$$\n给定参数 $f_s = 2000$ Hz 和 $\\omega_0 = 6$，我们可以为 $4$–$100$ Hz 区间内的频率 $f$ 指定此表达式：\n$$\ns_{samples}(f) = \\frac{6 \\cdot 2000}{2\\pi f} = \\frac{12000}{2\\pi f} = \\frac{6000}{\\pi f}\n$$\n这是第一个要求的表达式。\n\n第二部分：影响锥（COI）\n\n影响锥被定义为从Morlet小波中心测量的其幅度包络的e折时间。尺度化小波为 $\\psi_s(t) = s^{-1/2} \\psi(t/s)$。其幅度包络 $A_s(t)$ 是其幅度：\n$$\nA_s(t) = |\\psi_s(t)| = \\left|s^{-1/2} \\pi^{-1/4} \\exp\\left(i \\omega_0 \\frac{t}{s}\\right) \\exp\\left(-\\frac{(t/s)^2}{2}\\right)\\right| = s^{-1/2} \\pi^{-1/4} \\exp\\left(-\\frac{t^2}{2s^2}\\right)\n$$\n包络中心在 $t=0$ 处，此时其峰值为 $A_s(0) = s^{-1/2} \\pi^{-1/4}$。e折时间，我们将其表示为影响锥宽度 $W_{COI}$，是幅度下降到其峰值的 $1/e$ 时的时间 $t = W_{COI}$：\n$$\nA_s(W_{COI}) = \\frac{1}{e} A_s(0)\n$$\n代入幅度的表达式：\n$$\ns^{-1/2} \\pi^{-1/4} \\exp\\left(-\\frac{W_{COI}^2}{2s^2}\\right) = \\frac{1}{e} \\left(s^{-1/2} \\pi^{-1/4}\\right) = \\exp(-1) \\left(s^{-1/2} \\pi^{-1/4}\\right)\n$$\n令指数函数的参数相等：\n$$\n-\\frac{W_{COI}^2}{2s^2} = -1 \\implies W_{COI}^2 = 2s^2 \\implies W_{COI} = \\sqrt{2} s\n$$\n因此，影响锥宽度是尺度参数 $s$ 的 $\\sqrt{2}$ 倍。为了将其表示为频率 $f$ 的函数，我们代入尺度-频率关系 $s = \\frac{\\omega_0}{2\\pi f}$：\n$$\nW_{COI}(f) = \\sqrt{2} \\left(\\frac{\\omega_0}{2\\pi f}\\right) = \\frac{\\omega_0}{\\sqrt{2} \\pi f}\n$$\n现在我们用给定参数来评估这个表达式。当 $\\omega_0 = 6$ 时：\n$$\nW_{COI}(f) = \\frac{6}{\\sqrt{2} \\pi f}\n$$\n对于 $f = 10$ Hz：\n$$\nW_{COI}(10) = \\frac{6}{\\sqrt{2} \\pi (10)} = \\frac{0.6}{\\sqrt{2} \\pi} \\approx 0.135048... \\text{ s}\n$$\n四舍五入到四位有效数字，影响锥宽度为 $0.1350$ 秒。\n\n对于 $f = 80$ Hz：\n$$\nW_{COI}(80) = \\frac{6}{\\sqrt{2} \\pi (80)} = \\frac{0.075}{\\sqrt{2} \\pi} \\approx 0.016881... \\text{ s}\n$$\n四舍五入到四位有效数字，影响锥宽度为 $0.01688$ 秒。\n这些值代表了从分析窗口中心到影响锥边缘的时间（以秒为单位）。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{6000}{\\pi f} & 0.1350 & 0.01688 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在掌握了Morlet小波的基础知识后，一个关键的实践决策是根据您的数据特征设置最佳的小波参数。这项练习通过为不同的神经频段选择合适的周期数（$n_c$），让您深入探索所有小波分析中固有的时间-频率权衡关系。这项实践将培养您在时间精度（用于捕捉快速事件）和频率分辨率（用于区分不同振荡）之间取得平衡的直觉，这是设计稳健时频分析的核心技能。",
            "id": "4178639",
            "problem": "一位分析师正在使用复数莫莱小波对脑电图（EEG）进行时频分解，以分析事件相关谱扰动。数据采样率为 $f_s=512$ Hz。典型的频段为delta（$1$–$4$ Hz）、theta（$4$–$7$ Hz）、alpha（$8$–$12$ Hz）、beta（$13$–$30$ Hz）和gamma（$30$–$80$ Hz）。为具体起见，假设代表性的中心频率为 $f_{\\delta}=2$ Hz、$f_{\\theta}=6$ Hz、$f_{\\alpha}=10$ Hz、$f_{\\beta}=20$ Hz 和 $f_{\\gamma}=60$ Hz。莫莱小波是一种高斯锥削的复正弦波，其参数由中心频率和周期数 $n_c$ 决定。根据时频分析的基本原理，增加 $n_c$ 会提高频率分辨率但降低时间分辨率，反之亦然。\n\n请选择一个选项，该选项为delta、theta、alpha、beta和gamma频段指定了周期数 $n_c$，以便在时间精度（用于解析较高频率下的瞬态）和频率分辨率（用于避免过度的频谱泄漏，尤其是在较高频段）之间达到最佳平衡，同时与 $f_s=512$ Hz 的采样约束兼容。\n\nA. Delta $n_c=4$，Theta $n_c=5$，Alpha $n_c=6$，Beta $n_c=8$，Gamma $n_c=12$\n\nB. Delta $n_c=6$，Theta $n_c=6$，Alpha $n_c=6$，Beta $n_c=6$，Gamma $n_c=6$\n\nC. Delta $n_c=8$，Theta $n_c=10$，Alpha $n_c=12$，Beta $n_c=14$，Gamma $n_c=16$\n\nD. Delta $n_c=8$，Theta $n_c=6$，Alpha $n_c=5$，Beta $n_c=4$，Gamma $n_c=3$",
            "solution": "### 步骤 1：提取已知条件\n- **方法**：使用复数莫莱小波对脑电图（EEG）数据进行时频分解。\n- **应用**：分析事件相关谱扰动。\n- **采样频率**：$f_s = 512$ Hz。\n- **典型频段与代表性中心频率 ($f_c$)**：\n    - Delta（$1$–$4$ Hz）：$f_{\\delta} = 2$ Hz\n    - Theta（$4$–$7$ Hz）：$f_{\\theta} = 6$ Hz\n    - Alpha（$8$–$12$ Hz）：$f_{\\alpha} = 10$ Hz\n    - Beta（$13$–$30$ Hz）：$f_{\\beta} = 20$ Hz\n    - Gamma（$30$–$80$ Hz）：$f_{\\gamma} = 60$ Hz\n- **小波参数**：中心频率 ($f_c$) 和周期数 ($n_c$)。\n- **时频权衡**：增加 $n_c$ 会提高频率分辨率，但会降低时间分辨率。\n- **目标**：为五个频段选择一组 $n_c$，“在时间精度（用于解析较高频率下的瞬态）和频率分辨率（用于避免过度的频谱泄漏，尤其是在较高频段）之间达到最佳平衡”。\n\n### 步骤 2：使用提取的已知条件进行验证\n评估问题陈述的有效性。\n- **科学依据**：该问题基于小波分析应用于脑电图数据的标准原理，这是计算神经科学中一种成熟的方法。参数、术语（例如，事件相关谱扰动、莫莱小波）以及基本的时频权衡都是科学上正确的。\n- **适定性**：该问题要求在时间分辨率和频率分辨率之间取得“最佳平衡”。虽然“最佳”可能是主观的，但在神经科学信号处理的背景下，这指的是一组代表在相互冲突的目标之间的标准、实用折衷的参数。问题陈述本身定义了这些相互冲突的目标：为快速的高频事件实现良好的时间分辨率，以及为分离频段和减少泄漏实现良好的频率分辨率。由于这一权衡存在既定的惯例，使得该问题在其领域内是适定的。\n- **客观性**：问题以精确、客观的语言陈述。“最佳平衡”一词是关于最优权衡的技术要求，而非主观意见。\n- **完整性和一致性**：该问题提供了所有必要信息（$f_s$、中心频率、明确的权衡关系），以便根据小波分析的原理评估各个选项。奈奎斯特频率 $f_s/2 = 256$ Hz 远高于我们感兴趣的最高频率（$f_{\\gamma}=60$ Hz），因此采样率是足够的。\n\n### 步骤 3：结论与行动\n问题陈述是有效的。它提出了一个关于小波分析中参数选择的标准而微妙的问题，需要理解分析神经数据所涉及的实际权衡。可以继续求解过程。\n\n### 参数选择原则的推导\n复数莫莱小波是由高斯包络调制的复正弦波。关键的权衡关系由 Heisenberg-Gabor 不确定性原理决定。小波在时域的标准差 $\\sigma_t$ 和在频域的标准差 $\\sigma_f$ 成反比关系。对于中心频率 $f_c$ 和选定的周期数 $n_c$，它们由以下公式给出：\n$$ \\sigma_t = \\frac{n_c}{2 \\pi f_c} $$\n$$ \\sigma_f = \\frac{f_c}{n_c} $$\n这里，$\\sigma_t$ 代表时间分辨率（越小越好），$\\sigma_f$ 代表频率分辨率（越小越好）。乘积 $\\sigma_t \\sigma_f = 1/(4\\pi^2)$ 是一个常数，这正式描述了这种权衡关系。\n\n问题要求一种平衡，特别强调解析高频下的瞬态（需要小的 $\\sigma_t$）和避免频谱泄漏（需要小的 $\\sigma_f$）。我们必须评估在不同频率下选择 $n_c$ 的不同策略如何影响这种平衡。\n\n1.  **低频（例如 Delta, $f_c=2$ Hz）**：神经活动较慢，因此高时间分辨率不那么关键。然而，频带很窄，所以良好的频率分辨率（小的 $\\sigma_f$）对于区分例如 $2$ Hz 的活动和 $3$ Hz 的活动至关重要。为了实现一个小的 $\\sigma_f = f_c/n_c$，需要一个相对较大的 $n_c$。\n\n2.  **高频（例如 Gamma, $f_c=60$ Hz）**：神经活动可能是瞬态的（短暂的爆发），因此良好的时间分辨率（小的 $\\sigma_t$）至关重要。为了实现一个小的 $\\sigma_t = n_c/(2 \\pi f_c)$，需要一个小的 $n_c$。然而，一个非常小的 $n_c$ 会导致一个非常大的 $\\sigma_f$，从而导致差的频率分辨率和显著的频谱泄漏。\n\n在神经科学中，平衡这些需求的一个常用策略是让 $n_c$ 随频率增加而增加。这种方法可以防止绝对频率分辨率 $\\sigma_f$ 在高频时变得过大，同时仍然允许时间分辨率 $\\sigma_t$ 随着频率的增加而改善（即变小），因为 $\\sigma_t$ 与 $f_c$ 成反比。\n\n对于事件相关分析，另一个关键考虑是小波的总持续时间。过长的小波会对其持续时间内的神经活动进行平均，从而模糊事件的时间细节。小波的有效持续时间可以估计为 $\\sigma_t$ 的倍数，例如 $6\\sigma_t$，它包含了小波超过 $99\\%$ 的能量。\n$$ \\text{小波持续时间} \\approx 6\\sigma_t = \\frac{3 n_c}{\\pi f_c} $$\n\n我们现在基于这个框架评估每个选项。\n\n### 逐项分析选项\n\n**A. Delta $n_c=4$，Theta $n_c=5$，Alpha $n_c=6$，Beta $n_c=8$，Gamma $n_c=12$**\n该选项遵循周期数 $n_c$ 随频率增加的策略。让我们检查一下在两个极端情况下的权衡。\n- 对于 Delta ($f_c=2$ Hz, $n_c=4$)：\n    - 频率分辨率：$\\sigma_f = 2/4 = 0.5$ Hz。这对于解析delta频段来说是合适的。\n    - 小波持续时间：$\\approx \\frac{3 \\times 4}{\\pi \\times 2} \\approx 1.91$ s。这个时间很长，限制了低频事件的时间精度，但这是为了实现频率分辨率所必需的折衷，并且通常被认为是一个实用的选择。\n- 对于 Gamma ($f_c=60$ Hz, $n_c=12$)：\n    - 频率分辨率：$\\sigma_f = 60/12 = 5$ Hz。这个分辨率足以将gamma与高beta区分开，尽管并不理想。\n    - 时间分辨率：$\\sigma_t = 12/(2 \\pi \\times 60) \\approx 0.032$ s。这对应着良好的时间精度，适合解析瞬态的gamma频段活动。\n该选项代表了一种成熟且实用的折衷方案，为事件相关分析平衡了整个频谱上的相互竞争的需求。\n\n**B. Delta $n_c=6$，Theta $n_c=6$，Alpha $n_c=6$，Beta $n_c=6$，Gamma $n_c=6$**\n该选项使用恒定的周期数。这是“纯粹的”小波变换方法，其中小波形状只是简单地缩放。\n- 对于 Delta ($f_c=2$ Hz, $n_c=6$)：$\\sigma_f = 2/6 \\approx 0.33$ Hz。极好的频率分辨率。\n- 对于 Gamma ($f_c=60$ Hz, $n_c=6$)：$\\sigma_f = 60/6 = 10$ Hz。这个频率分辨率非常差。它会导致显著的频谱涂抹，使得很难将真实的gamma活动与beta频段或线路噪声的溢出区分开。这不满足避免过度频谱泄漏的要求。\n\n**C. Delta $n_c=8$，Theta $n_c=10$，Alpha $n_c=12$，Beta $n_c=14$，Gamma $n_c=16$**\n该选项也让 $n_c$ 随频率增加，但使用的值比选项 A 一致地更大。这优先考虑了频率分辨率，而不是时间分辨率。\n- 对于 Delta ($f_c=2$ Hz, $n_c=8$)：\n    - 频率分辨率：$\\sigma_f = 2/8 = 0.25$ Hz。这是极好的。\n    - 小波持续时间：$\\approx \\frac{3 \\times 8}{\\pi \\times 2} \\approx 3.82$ s。一个接近 $4$ 秒的小波对于*事件相关*分析通常被认为太长，因为它会完全掩盖除了最慢的神经事件之外所有事件的时间信息。\n- 对于 Gamma ($f_c=60$ Hz, $n_c=16$)：$\\sigma_t = 16/(2 \\pi \\times 60) \\approx 0.042$ s。这个时间分辨率不错，但比选项 A 差。\n在低频下过多的时间涂抹使得该选项与 A 相比，对于事件相关研究的平衡性较差。\n\n**D. Delta $n_c=8$，Theta $n_c=6$，Alpha $n_c=5$，Beta $n_c=4$，Gamma $n_c=3$**\n该选项让 $n_c$ 随频率降低。这种策略以牺牲频率分辨率为代价，积极地优先考虑高频下的时间分辨率。\n- 对于 Delta ($f_c=2$ Hz, $n_c=8$)：这提供了极好的频率分辨率（$\\sigma_f=0.25$ Hz），但代价是小波非常长（$\\approx 3.82$ s），如选项 C 中所述。\n- 对于 Gamma ($f_c=60$ Hz, $n_c=3$)：\n    - 频率分辨率：$\\sigma_f = 60/3 = 20$ Hz。这个分辨率极差，对于大多数分析是不可接受的。小波的谱宽会大到跨越整个beta和gamma范围，使得对 $60$ Hz 处功率的任何解释都毫无意义。\n    - 时间分辨率：$\\sigma_t = 3/(2 \\pi \\times 60) \\approx 0.008$ s。虽然时间精度非常出色，但频率精度的灾难性损失使其无法使用。\n\n### 分析结论\n- **选项 B** 不正确，因为在高频下频率分辨率差。\n- **选项 D** 不正确，因为在高频下频率分辨率极差。\n- **选项 C** 不正确，因为对于事件相关分析，低频的小波持续时间长得不切实际。\n- **选项 A** 提供了最合适和最实用的平衡。它采用了随频率增加 $n_c$ 的标准策略，以在较高频段保持可用的频率分辨率，同时将较低频率下的小波持续时间保持在事件相关研究的可管理范围内。它在整个频谱上实现了时间和频率分辨率之间的良好折衷。\n\n因此，选项 A 指定了能够最好地平衡所述要求的周期数。\n\n**每个选项的结论：**\n- A：**正确**。为事件相关脑电图分析提供了标准的、实用的平衡。\n- B：**不正确**。恒定的 $n_c$ 会导致高频下频率分辨率差。\n- C：**不正确**。过分优先考虑频率分辨率，导致在低频下用于事件相关分析的小波过长而不切实际。\n- D：**不正确**。过分优先考虑时间分辨率，导致在高频下频率分辨率不可用。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "理论上的影响锥（COI）对数据分析和统计推断有着直接而实际的影响。这个编码练习要求您实现一个程序，来屏蔽掉落在COI内的数据点。通过量化这种屏蔽对统计检验数量的影响，您将具体地理解分析边界如何影响统计功效及结果解释，尤其是在多重比较校正方面。",
            "id": "4178692",
            "problem": "考虑一个在时频（TF）框架下使用复莫莱（complex Morlet）小波分析的离散时间神经信号。设采样频率为 $F_{s}$ 赫兹（样本/秒），信号有 $N$ 个样本，样本中心时间为 $t_{n} = n / F_{s}$，其中 $n \\in \\{0,1,\\ldots,N-1\\}$。在每个分析频率 $f$（单位为赫兹）下，复莫莱小波定义为一个复指数乘以一个高斯包络，其时间标准差为 $\\sigma_{t}(f)$，其中周期数 $c$ 与 $\\sigma_{t}(f)$ 的关系为 $2 \\pi f \\, \\sigma_{t}(f) = c$，即 $\\sigma_{t}(f) = c / (2 \\pi f)$。此处，影响锥（cone of influence, COI）使用小波高斯振幅包络的 $e$ 折时间（$e$-folding time）来定义，因此在频率 $f$ 处的 COI 半宽为 $W(f) = \\sqrt{2}\\,\\sigma_{t}(f) = \\sqrt{2}\\,c /(2 \\pi f)$。对于结束时间为 $T_{\\text{end}} = (N-1)/F_{s}$ 秒的有限长度信号，时间点 $t_{n}$ 到最近信号边缘的距离为 $d_{n} = \\min\\{t_{n},\\, T_{\\text{end}} - t_{n}\\}$。当且仅当 $d_{n} \\ge W(f)$ 时，位于频率 $f$ 和时间索引 $n$ 处的一个时频（TF）像素点才被声明为对统计推断有效；否则，它位于 COI 内部，应被屏蔽（masked）。\n\n您的任务是，从基本原理出发，实现一个程序，该程序能够：\n- 通过在每个指定的频率 $f$ 和时间索引 $n$ 处应用不等式 $d_{n} \\ge W(f)$，计算时频像素上的 COI 屏蔽。\n- 统计有效时频像素的数量 $m$（在 COI 之外）以及屏蔽前的时频像素总数 $m_{0} = K \\cdot N$，其中 $K$ 是频率的数量。\n- 使用 Bonferroni 式模型量化 COI 屏蔽对多重比较校正的影响：对于族系误差率 $\\alpha$（以小数表示），未屏蔽时的单次检验阈值为 $\\alpha_{\\text{no-mask}} = \\alpha / m_{0}$，屏蔽后的阈值为 $\\alpha_{\\text{mask}} = \\alpha / m$。报告被移除的检验比例 $p = 1 - m/m_{0}$，以及膨胀因子 $r = \\alpha_{\\text{mask}} / \\alpha_{\\text{no-mask}} = m_{0}/m$。如果 $m = 0$，按惯例定义 $r = 0$。\n- 所有时间量必须以秒为单位处理，所有频率以赫兹为单位，周期数为无量纲量。\n\n使用以下包含 5 个测试用例的测试套件。在每个测试用例中，使用给定的参数 $(N, F_{s}, \\{f_{k}\\}_{k=1}^{K}, \\{c_{k}\\}_{k=1}^{K}, \\alpha)$，其中周期数可以是一个标量（应用于所有频率），也可以是与频率对齐的列表：\n- 测试用例 1：$N = 1000$，$F_{s} = 1000$ Hz，频率 $\\{4, 8, 12, 30, 50\\}$ Hz，所有频率的周期数 $c = 7$，$\\alpha = 0.05$。\n- 测试用例 2：$N = 2000$，$F_{s} = 500$ Hz，频率 $\\{1, 2, 3\\}$ Hz，所有频率的周期数 $c = 10$，$\\alpha = 0.05$。\n- 测试用例 3：$N = 256$，$F_{s} = 512$ Hz，频率 $\\{60, 80, 100, 120, 140, 160, 180, 200\\}$ Hz，所有频率的周期数 $c = 5$，$\\alpha = 0.05$。\n- 测试用例 4：$N = 100$，$F_{s} = 100$ Hz，频率 $\\{1\\}$ Hz，周期数 $c = 7$，$\\alpha = 0.05$。\n- 测试用例 5：$N = 1000$，$F_{s} = 1000$ Hz，频率 $\\{10, 20, 40\\}$ Hz，周期数 $\\{3, 6, 9\\}$ 与频率列表对齐，$\\alpha = 0.05$。\n\n对于每个测试用例，您的程序必须输出一个列表 $[m_{0}, m, p, r]$，其中 $m_{0}$ 和 $m$ 是整数，$p$ 和 $r$ 四舍五入到 6 位小数。您的程序应生成单行输出，其中包含所有 5 个测试用例的结果，形式为这些单个用例列表的逗号分隔列表，并用方括号括起来（例如，$[[m_{0}^{(1)}, m^{(1)}, p^{(1)}, r^{(1)}], \\ldots, [m_{0}^{(5)}, m^{(5)}, p^{(5)}, r^{(5)}]]$）。",
            "solution": "该问题要求实现一个程序，以量化在使用复莫莱小波进行时频（TF）分析时影响锥（COI）的影响。这种分析是神经科学研究神经振荡的基础，其中有限长度的信号不可避免地会引入边缘伪影。COI 描绘了时频平面中频谱估计受这些伪影污染的区域，因此应从统计分析中排除。我们将首先形式化给定的定义，然后推导出一个高效的算法来计算所需的指标。\n\n在给定的分析频率 $f$ 下，复莫莱小波是复正弦波和高斯窗的乘积。该小波的时间展宽由其高斯包络的标准差 $\\sigma_{t}(f)$ 来表征。此展宽通常由周期数 $c$ 控制，这是一个平衡时间分辨率和频谱分辨率的无量纲参数。问题中给出的关系是 $2 \\pi f \\sigma_{t}(f) = c$，可整理为 $\\sigma_{t}(f) = c / (2 \\pi f)$。更高的频率或更多的周期会导致时间上更窄的小波。\n\nCOI 是基于小波振幅包络的 $e$ 折时间定义的。$e$ 折时间是高斯振幅衰减到其峰值的 $1/e$ 所需的时间。这发生在距离小波中心 $\\pm\\sqrt{2}\\sigma_{t}$ 的位置。因此，COI 半宽（表示从小波中心到其影响变得可忽略不计的时间距离）由 $W(f) = \\sqrt{2}\\,\\sigma_{t}(f)$ 给出。代入 $\\sigma_{t}(f)$ 的表达式，我们得到以秒为单位的 COI 半宽：\n$$\nW(f) = \\frac{\\sqrt{2}\\,c}{2 \\pi f}\n$$\n\n一个离散时间信号包含 $N$ 个样本，采样时间为 $t_{n} = n / F_{s}$，其中整数索引 $n \\in \\{0, 1, \\ldots, N-1\\}$，$F_{s}$ 是以赫兹为单位的采样频率。信号从 $t_{0}=0$ 开始，到 $T_{\\text{end}} = (N-1)/F_{s}$ 结束。对于任何给定的时间点 $t_{n}$，其与信号边界的接近程度由到最近边缘的距离 $d_n$ 来衡量：\n$$\nd_{n} = \\min\\{t_{n}, T_{\\text{end}} - t_{n}\\}\n$$\n当且仅当一个时间点与两端边缘的距离都足够远时，位于时间索引 $n$ 和频率 $f$ 的时频像素点才被认为是有效的分析对象（即在 COI 之外）。条件是到最近边缘的距离必须至少等于该频率下的 COI 半宽：\n$$\nd_{n} \\ge W(f)\n$$\n这个单一不等式等价于一对同时成立的条件：\n1. $t_{n} \\ge W(f)$\n2. $T_{\\text{end}} - t_{n} \\ge W(f)$\n\n为了实现算法，我们将关于时间 $t_n$ 的这些条件转换为关于样本索引 $n$ 的条件。\n1. $n / F_{s} \\ge W(f) \\implies n \\ge F_{s} \\cdot W(f)$\n2. $(N-1)/F_{s} - n/F_{s} \\ge W(f) \\implies (N-1) - n \\ge F_{s} \\cdot W(f) \\implies n \\le (N-1) - F_{s} \\cdot W(f)$\n\n让我们定义一个以样本索引表示的边界值，$n_{\\text{bound}}(f) = F_{s} \\cdot W(f)$。对于给定的频率 $f$，有效的样本索引 $n$ 必须满足 $n_{\\text{bound}}(f) \\le n \\le (N-1) - n_{\\text{bound}}(f)$。由于 $n$ 必须是整数，有效索引的范围是从 $n_{\\text{start}} = \\lceil n_{\\text{bound}}(f) \\rceil$ 到 $n_{\\text{end}} = \\lfloor (N-1) - n_{\\text{bound}}(f) \\rfloor$。\n\n对于给定的频率 $f_k$ 及其对应的周期数 $c_k$，有效时间点的数量是此范围内的整数个数。这可以计算为：\n$$\n\\text{count}_{k} = \\max(0, n_{\\text{end}} - n_{\\text{start}} + 1)\n$$\n$\\max(0, \\ldots)$ 确保了如果 COI 过大导致 $n_{\\text{end}}  n_{\\text{start}}$，计数能被正确地报告为 0。\n\n有效的时频像素总数 $m$ 是对所有 $K$ 个分析频率的这些计数求和：\n$$\nm = \\sum_{k=1}^{K} \\text{count}_{k}\n$$\n在进行任何屏蔽之前的时频像素总数就是频率数 $K$ 和时间样本数 $N$ 的乘积：\n$$\nm_{0} = K \\cdot N\n$$\n最后，我们计算影响指标。由于 COI 屏蔽而被移除的检验比例是：\n$$\np = 1 - \\frac{m}{m_{0}}\n$$\n对于 Bonferroni 式多重比较校正的膨胀因子，它代表了单次检验显著性阈值变得多么严格，是总检验数与有效检验数的比率：\n$$\nr = \\frac{\\alpha_{\\text{mask}}}{\\alpha_{\\text{no-mask}}} = \\frac{\\alpha / m}{\\alpha / m_{0}} = \\frac{m_{0}}{m}\n$$\n根据问题规范，如果 $m=0$，则没有有效检验，我们按惯例定义 $r=0$。以下程序为每个提供的测试用例实现了这一逻辑。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    It processes each test case, calculates the COI metrics, formats the results,\n    and prints them in the specified format.\n    \"\"\"\n\n    test_cases = [\n        {'N': 1000, 'Fs': 1000, 'freqs': [4, 8, 12, 30, 50], 'cycles': 7, 'alpha': 0.05},\n        {'N': 2000, 'Fs': 500, 'freqs': [1, 2, 3], 'cycles': 10, 'alpha': 0.05},\n        {'N': 256, 'Fs': 512, 'freqs': [60, 80, 100, 120, 140, 160, 180, 200], 'cycles': 5, 'alpha': 0.05},\n        {'N': 100, 'Fs': 100, 'freqs': [1], 'cycles': 7, 'alpha': 0.05},\n        {'N': 1000, 'Fs': 1000, 'freqs': [10, 20, 40], 'cycles': [3, 6, 9], 'alpha': 0.05},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_coi_metrics(\n            case['N'], case['Fs'], case['freqs'], case['cycles']\n        )\n        results.append(result)\n\n    # Format the final output string exactly as specified.\n    # Each sublist is formatted, then joined by commas, then enclosed in brackets.\n    output_strings = []\n    for res in results:\n        # m0, m are integers. p, r must be formatted to 6 decimal places.\n        m0, m, p, r = res\n        output_strings.append(f\"[{m0},{m},{p:.6f},{r:.6f}]\")\n    \n    final_output = f\"[{','.join(output_strings)}]\"\n    print(final_output)\n\ndef calculate_coi_metrics(N, Fs, freqs, cycles):\n    \"\"\"\n    Calculates COI-related metrics for a single analysis configuration.\n\n    Args:\n        N (int): Number of time samples.\n        Fs (int or float): Sampling frequency in Hz.\n        freqs (list of float): List of analysis frequencies in Hz.\n        cycles (int, float, or list): Number of wavelet cycles. Can be a scalar\n                                      applied to all frequencies or a list aligned\n                                      with freqs.\n\n    Returns:\n        list: A list containing [m0, m, p, r], where:\n              m0 (int): Total number of TF pixels.\n              m (int): Number of valid TF pixels (outside COI).\n              p (float): Fraction of pixels removed by masking.\n              r (float): Inflation factor for multiple comparison correction.\n    \"\"\"\n    K = len(freqs)\n    m0 = K * N\n    \n    # Ensure 'cycles' is a list of the same length as 'freqs'\n    if isinstance(cycles, (int, float)):\n        cycles_list = [cycles] * K\n    else:\n        cycles_list = cycles\n\n    m = 0\n    for i in range(K):\n        f = freqs[i]\n        c = cycles_list[i]\n\n        # Calculate COI half-width W(f) in seconds\n        # W(f) = sqrt(2) * sigma_t(f) = sqrt(2) * c / (2 * pi * f)\n        W_f = (np.sqrt(2) * c) / (2 * np.pi * f)\n\n        # Convert temporal width to number of sample indices\n        # The valid region is n_start = n = n_end\n        n_bound = Fs * W_f\n        \n        # Lower bound index (inclusive)\n        n_start = np.ceil(n_bound)\n        \n        # Upper bound index (inclusive)\n        n_end = np.floor(N - 1 - n_bound)\n\n        # Count number of valid integer indices in the range [n_start, n_end]\n        if n_end >= n_start:\n            count_k = n_end - n_start + 1\n            m += count_k\n\n    m = int(m)\n\n    # Calculate derived metrics\n    if m0 > 0:\n        p = 1 - m / m0\n    else: # Should not happen with valid inputs but good for robustness\n        p = 0.0\n\n    if m > 0:\n        r = m0 / m\n    else:\n        # As per problem definition, if m = 0, r is 0 by convention.\n        r = 0.0\n\n    return [m0, m, p, r]\n\nsolve()\n```"
        }
    ]
}