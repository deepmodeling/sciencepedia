{
    "hands_on_practices": [
        {
            "introduction": "This practice takes you back to the fundamentals of wavelet analysis. Before interpreting a time-frequency plot, it is essential to understand how it's constructed. This exercise guides you through deriving the crucial mapping between a wavelet's \"scale\" and its corresponding \"frequency\" from first principles, and then uses this relationship to define the cone of influence (COI), which delineates the boundaries of valid interpretation in your analysis .",
            "id": "4178689",
            "problem": "A local field potential (LFP) time series sampled at $f_s = 2000$ Hz is analyzed with a complex Morlet mother wavelet, defined in the time domain by $\\psi(t) = \\pi^{-1/4} \\exp(i \\omega_0 t) \\exp(-t^2/2)$, where $\\omega_0$ is the dimensionless central angular frequency. Consider the continuous wavelet transform (CWT) constructed by dilations and translations of the mother wavelet, with scaled wavelets $\\psi_s(t) = s^{-1/2} \\psi(t/s)$ for scale $s>0$. Using only fundamental properties of Fourier transforms under dilation and the Gaussian envelope of the Morlet wavelet, derive from first principles the mapping between the continuous scale $s$ and the Fourier frequency $f$ for the Morlet wavelet. Then, convert this mapping into a discrete-scale expression (in samples) appropriate for data sampled at $f_s = 2000$ Hz, and specify this expression for frequencies $f$ in the interval $4$–$100$ Hz with $\\omega_0 = 6$.\n\nNext, define the cone of influence (COI) as the e-folding time of the Morlet wavelet’s amplitude envelope, measured from the wavelet center, and derive the COI width as a function of frequency $f$. Using $\\omega_0 = 6$, evaluate the COI width at $f = 10$ Hz and $f = 80$ Hz. Express these widths in seconds and round each numerical value to four significant figures.\n\nYour final answer must include:\n- The closed-form expression for the discrete scale in samples as a function of frequency $f$ for $\\omega_0 = 6$ and $f_s = 2000$ Hz.\n- The COI widths at $f = 10$ Hz and $f = 80$ Hz in seconds, each rounded to four significant figures.",
            "solution": "The problem statement is a valid and well-posed exercise in signal processing, specifically in the application of wavelet analysis to time-series data, a common task in neuroscience. All provided parameters and definitions are standard, scientifically sound, and internally consistent.\n\nThe problem can be divided into two main parts: first, deriving the relationship between wavelet scale and frequency, and second, deriving and calculating the cone of influence (COI).\n\nPart 1: Scale-to-Frequency Mapping\n\nThe complex Morlet mother wavelet is given in the time domain as:\n$$\n\\psi(t) = \\pi^{-1/4} \\exp(i \\omega_0 t) \\exp\\left(-\\frac{t^2}{2}\\right)\n$$\nwhere $\\omega_0$ is the dimensionless central angular frequency. We aim to find the relationship between the scale parameter $s$ and the Fourier frequency $f$. This is achieved by finding the peak frequency of the scaled wavelet in the Fourier domain.\n\nFirst, we determine the Fourier transform of the mother wavelet, $\\hat{\\psi}(\\omega) = \\int_{-\\infty}^{\\infty} \\psi(t) \\exp(-i\\omega t) dt$. The wavelet consists of two parts: a complex sinusoid $\\exp(i \\omega_0 t)$ and a Gaussian envelope $g(t) = \\pi^{-1/4} \\exp(-t^2/2)$.\n\nWe use two fundamental properties of the Fourier transform:\n1.  The transform of a Gaussian function $\\exp(-at^2)$ is $\\sqrt{\\pi/a} \\exp(-\\omega^2/(4a))$. For our envelope, the constant $\\pi^{-1/4}$ is a normalization factor, and the Gaussian part is $\\exp(-t^2/2)$, where $a=1/2$. The Fourier transform of $\\exp(-t^2/2)$ is thus $\\sqrt{2\\pi} \\exp(-\\omega^2/2)$.\n2.  The frequency-shifting property states that the Fourier transform of $f(t)\\exp(i\\omega_0 t)$ is $\\hat{f}(\\omega - \\omega_0)$.\n\nCombining these, the Fourier transform of the Morlet mother wavelet $\\psi(t)$ is:\n$$\n\\hat{\\psi}(\\omega) = \\pi^{-1/4} \\sqrt{2\\pi} \\exp\\left(-\\frac{(\\omega - \\omega_0)^2}{2}\\right) = (2\\pi)^{1/4} \\exp\\left(-\\frac{(\\omega - \\omega_0)^2}{2}\\right)\n$$\nThe peak of this function's magnitude occurs where the argument of the exponential is maximized, which is at $\\omega = \\omega_0$. This confirms that $\\omega_0$ is the central angular frequency of the mother wavelet.\n\nNext, we consider the scaled wavelet, $\\psi_s(t) = s^{-1/2} \\psi(t/s)$. We use the dilation property of the Fourier transform, which states that the transform of $h(t/s)$ is $|s|\\hat{h}(s\\omega)$. For our scaled wavelet, its Fourier transform $\\hat{\\psi}_s(\\omega)$ is:\n$$\n\\hat{\\psi}_s(\\omega) = s^{-1/2} \\cdot s \\cdot \\hat{\\psi}(s\\omega) = s^{1/2} \\hat{\\psi}(s\\omega)\n$$\nSubstituting the expression for $\\hat{\\psi}(\\omega)$:\n$$\n\\hat{\\psi}_s(\\omega) = s^{1/2} (2\\pi)^{1/4} \\exp\\left(-\\frac{(s\\omega - \\omega_0)^2}{2}\\right)\n$$\nThe peak angular frequency of this scaled wavelet, $\\omega_{peak}$, is found by maximizing its magnitude, which occurs when the term $(s\\omega - \\omega_0)^2$ is zero. This gives:\n$$\ns\\omega_{peak} - \\omega_0 = 0 \\implies \\omega_{peak} = \\frac{\\omega_0}{s}\n$$\nThe relationship between angular frequency $\\omega$ (in radians per second) and Fourier frequency $f$ (in Hertz) is $\\omega = 2\\pi f$. Therefore, the center frequency $f$ corresponding to a scale $s$ is:\n$$\n2\\pi f = \\frac{\\omega_0}{s} \\implies s = \\frac{\\omega_0}{2\\pi f}\n$$\nThis is the general mapping between the continuous scale $s$ (in units of time) and the Fourier frequency $f$.\n\nThe problem requires this mapping to be converted into a discrete-scale expression in samples. The time scale $s$ (in seconds) is converted to a discrete scale $s_{samples}$ (in samples) by dividing by the sampling period $\\Delta T = 1/f_s$, or equivalently, multiplying by the sampling frequency $f_s$:\n$$\ns_{samples}(f) = s \\cdot f_s = \\left(\\frac{\\omega_0}{2\\pi f}\\right) f_s\n$$\nGiven the parameters $f_s = 2000$ Hz and $\\omega_0 = 6$, we can specify this expression for frequencies $f$ in the interval $4$–$100$ Hz:\n$$\ns_{samples}(f) = \\frac{6 \\cdot 2000}{2\\pi f} = \\frac{12000}{2\\pi f} = \\frac{6000}{\\pi f}\n$$\nThis is the first required expression.\n\nPart 2: Cone of Influence (COI)\n\nThe COI is defined as the e-folding time of the Morlet wavelet’s amplitude envelope, measured from the wavelet center. The scaled wavelet is $\\psi_s(t) = s^{-1/2} \\psi(t/s)$. Its amplitude envelope, $A_s(t)$, is its magnitude:\n$$\nA_s(t) = |\\psi_s(t)| = \\left|s^{-1/2} \\pi^{-1/4} \\exp\\left(i \\omega_0 \\frac{t}{s}\\right) \\exp\\left(-\\frac{(t/s)^2}{2}\\right)\\right| = s^{-1/2} \\pi^{-1/4} \\exp\\left(-\\frac{t^2}{2s^2}\\right)\n$$\nThe envelope is centered at $t=0$, where it has its peak value $A_s(0) = s^{-1/2} \\pi^{-1/4}$. The e-folding time, which we denote as the COI width $W_{COI}$, is the time $t = W_{COI}$ at which the amplitude drops to $1/e$ of its peak value:\n$$\nA_s(W_{COI}) = \\frac{1}{e} A_s(0)\n$$\nSubstituting the expressions for the amplitude:\n$$\ns^{-1/2} \\pi^{-1/4} \\exp\\left(-\\frac{W_{COI}^2}{2s^2}\\right) = \\frac{1}{e} \\left(s^{-1/2} \\pi^{-1/4}\\right) = \\exp(-1) \\left(s^{-1/2} \\pi^{-1/4}\\right)\n$$\nEquating the arguments of the exponential functions:\n$$\n-\\frac{W_{COI}^2}{2s^2} = -1 \\implies W_{COI}^2 = 2s^2 \\implies W_{COI} = \\sqrt{2} s\n$$\nThe COI width is thus $\\sqrt{2}$ times the scale parameter $s$. To express this as a function of frequency $f$, we substitute the scale-frequency relationship $s = \\frac{\\omega_0}{2\\pi f}$:\n$$\nW_{COI}(f) = \\sqrt{2} \\left(\\frac{\\omega_0}{2\\pi f}\\right) = \\frac{\\omega_0}{\\sqrt{2} \\pi f}\n$$\nNow we evaluate this for the given parameters. With $\\omega_0 = 6$:\n$$\nW_{COI}(f) = \\frac{6}{\\sqrt{2} \\pi f}\n$$\nFor $f = 10$ Hz:\n$$\nW_{COI}(10) = \\frac{6}{\\sqrt{2} \\pi (10)} = \\frac{0.6}{\\sqrt{2} \\pi} \\approx 0.135048... \\text{ s}\n$$\nRounding to four significant figures, the COI width is $0.1350$ s.\n\nFor $f = 80$ Hz:\n$$\nW_{COI}(80) = \\frac{6}{\\sqrt{2} \\pi (80)} = \\frac{0.075}{\\sqrt{2} \\pi} \\approx 0.016881... \\text{ s}\n$$\nRounding to four significant figures, the COI width is $0.01688$ s.\nThese values represent the time in seconds from the center of the analysis window to the edge of the COI.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{6000}{\\pi f} & 0.1350 & 0.01688 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Moving from pure theory to the art of practical data analysis, this exercise tackles a critical decision: how to choose the shape of your wavelet. The number of cycles, $n_c$, in a Morlet wavelet directly controls the trade-off between temporal and spectral resolution. Through this problem, you will explore how to select an optimal set of $n_c$ values for different canonical neural frequency bands, a choice that has profound implications for your ability to resolve neural dynamics .",
            "id": "4178639",
            "problem": "An analyst is preparing a time–frequency decomposition of Electroencephalography (EEG) using complex Morlet wavelets for event-related spectral perturbations. The data are sampled at $f_s=512$ Hz. The canonical bands are delta ($1$–$4$ Hz), theta ($4$–$7$ Hz), alpha ($8$–$12$ Hz), beta ($13$–$30$ Hz), and gamma ($30$–$80$ Hz). For concreteness, assume representative center frequencies $f_{\\delta}=2$ Hz, $f_{\\theta}=6$ Hz, $f_{\\alpha}=10$ Hz, $f_{\\beta}=20$ Hz, and $f_{\\gamma}=60$ Hz. A Morlet wavelet is a Gaussian-tapered complex sinusoid parameterized by its center frequency and its number of cycles $n_c$. From foundational time–frequency analysis considerations, increasing $n_c$ improves frequency resolution but worsens temporal resolution, and vice versa.\n\nSelect the option that specifies the number of cycles $n_c$ for the delta, theta, alpha, beta, and gamma bands that best balances temporal precision (to resolve transients at higher frequencies) against frequency resolution (to avoid excessive spectral leakage, particularly in higher bands), while remaining compatible with the sampling constraints at $f_s=512$ Hz.\n\nA. Delta $n_c=4$, Theta $n_c=5$, Alpha $n_c=6$, Beta $n_c=8$, Gamma $n_c=12$\n\nB. Delta $n_c=6$, Theta $n_c=6$, Alpha $n_c=6$, Beta $n_c=6$, Gamma $n_c=6$\n\nC. Delta $n_c=8$, Theta $n_c=10$, Alpha $n_c=12$, Beta $n_c=14$, Gamma $n_c=16$\n\nD. Delta $n_c=8$, Theta $n_c=6$, Alpha $n_c=5$, Beta $n_c=4$, Gamma $n_c=3$",
            "solution": "### Step 1: Extract Givens\n- **Method**: Time-frequency decomposition of Electroencephalography (EEG) data using complex Morlet wavelets.\n- **Application**: Analysis of event-related spectral perturbations.\n- **Sampling Frequency**: $f_s = 512$ Hz.\n- **Canonical Bands & Representative Center Frequencies ($f_c$)**:\n    - Delta ($1$–$4$ Hz): $f_{\\delta} = 2$ Hz\n    - Theta ($4$–$7$ Hz): $f_{\\theta} = 6$ Hz\n    - Alpha ($8$–$12$ Hz): $f_{\\alpha} = 10$ Hz\n    - Beta ($13$–$30$ Hz): $f_{\\beta} = 20$ Hz\n    - Gamma ($30$–$80$ Hz): $f_{\\gamma} = 60$ Hz\n- **Wavelet Parameters**: Center frequency ($f_c$) and number of cycles ($n_c$).\n- **Time-Frequency Trade-off**: Increasing $n_c$ improves frequency resolution and worsens temporal resolution.\n- **Objective**: Select the set of $n_c$ for the five bands that \"best balances temporal precision (to resolve transients at higher frequencies) against frequency resolution (to avoid excessive spectral leakage, particularly in higher bands)\".\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is assessed for validity.\n- **Scientifically Grounded**: The problem is based on standard principles of wavelet analysis as applied to EEG data, a well-established methodology in computational neuroscience. The parameters, terminology (e.g., event-related spectral perturbations, Morlet wavelet), and the fundamental time-frequency trade-off are all scientifically correct.\n- **Well-Posed**: The problem asks for the \"best balance\" between temporal and frequency resolution. While \"best\" can be subjective, in the context of signal processing for neuroscience, this refers to a set of parameters that represents a standard, practical compromise between conflicting objectives. The problem statement itself defines these conflicting objectives: achieving good temporal resolution for fast, high-frequency events, and good frequency resolution to separate frequency bands and reduce leakage. The existence of established conventions for this trade-off makes the problem well-posed in its domain.\n- **Objective**: The problem is stated in precise, objective language. The term \"best balance\" is a technical request for an optimal trade-off, not a subjective opinion.\n- **Completeness and Consistency**: The problem provides all necessary information ($f_s$, center frequencies, the explicit trade-off) to evaluate the options based on the principles of wavelet analysis. The Nyquist frequency, $f_s/2 = 256$ Hz, is well above the highest frequency of interest ($f_{\\gamma}=60$ Hz), so the sampling rate is adequate.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. It poses a standard, albeit nuanced, question about parameter selection in wavelet analysis, requiring an understanding of the practical trade-offs involved in analyzing neural data. The solution process can proceed.\n\n### Derivation of Principles for Parameter Selection\nA complex Morlet wavelet is a complex sinusoid modulated by a Gaussian envelope. The key trade-off is governed by the Heisenberg-Gabor uncertainty principle. The standard deviation of the wavelet in the time domain, $\\sigma_t$, and in the frequency domain, $\\sigma_f$, are inversely related. For a center frequency $f_c$ and a chosen number of cycles $n_c$, these are given by:\n$$ \\sigma_t = \\frac{n_c}{2 \\pi f_c} $$\n$$ \\sigma_f = \\frac{f_c}{n_c} $$\nHere, $\\sigma_t$ represents temporal resolution (smaller is better), and $\\sigma_f$ represents frequency resolution (smaller is better). The product $\\sigma_t \\sigma_f = 1/(4\\pi^2)$ is constant, which formalizes the trade-off.\n\nThe problem requires a balance, with specific emphasis on resolving transients at high frequencies (requiring small $\\sigma_t$) and avoiding spectral leakage (requiring small $\\sigma_f$). We must evaluate how different strategies for choosing $n_c$ across frequencies affect this balance.\n\n1.  **Low Frequencies (e.g., Delta, $f_c=2$ Hz)**: Neural activity is slow, so high temporal resolution is less critical. However, frequency bands are narrow, so good frequency resolution (small $\\sigma_f$) is paramount to distinguish, for example, $2$ Hz activity from $3$ Hz activity. To achieve a small $\\sigma_f = f_c/n_c$, one needs a relatively large $n_c$.\n\n2.  **High Frequencies (e.g., Gamma, $f_c=60$ Hz)**: Neural activity can be transient (short-lived bursts), so good temporal resolution (small $\\sigma_t$) is critical. To achieve a small $\\sigma_t = n_c/(2 \\pi f_c)$, one needs a small $n_c$. However, a very small $n_c$ would lead to a very large $\\sigma_f$, causing poor frequency resolution and significant spectral leakage.\n\nA common strategy in neuroscience to balance these needs is to have $n_c$ increase with frequency. This approach prevents the absolute frequency resolution $\\sigma_f$ from becoming excessively large at high frequencies, while still allowing the temporal resolution $\\sigma_t$ to improve (i.e., get smaller) as frequency increases, because $\\sigma_t$ is inversely proportional to $f_c$.\n\nAnother crucial consideration for event-related analysis is the total temporal duration of the wavelet. A wavelet that is too long will average neural activity over that duration, smearing the temporal details of an event. The effective duration of the wavelet can be estimated as a multiple of $\\sigma_t$, for instance $6\\sigma_t$, which contains over $99\\%$ of the wavelet's energy.\n$$ \\text{Wavelet Duration} \\approx 6\\sigma_t = \\frac{3 n_c}{\\pi f_c} $$\n\nWe now evaluate each option based on this framework.\n\n### Option-by-Option Analysis\n\n**A. Delta $n_c=4$, Theta $n_c=5$, Alpha $n_c=6$, Beta $n_c=8$, Gamma $n_c=12$**\nThis option follows the strategy of increasing the number of cycles $n_c$ with frequency. Let's examine the trade-offs at the extremes.\n- For Delta ($f_c=2$ Hz, $n_c=4$):\n    - Frequency resolution: $\\sigma_f = 2/4 = 0.5$ Hz. This is decent for resolving the delta band.\n    - Wavelet duration: $\\approx \\frac{3 \\times 4}{\\pi \\times 2} \\approx 1.91$ s. This is long, limiting temporal precision for low-frequency events, but it is a necessary compromise for achieving the frequency resolution and is often considered a practical choice.\n- For Gamma ($f_c=60$ Hz, $n_c=12$):\n    - Frequency resolution: $\\sigma_f = 60/12 = 5$ Hz. This resolution is adequate to separate gamma from high beta, though not ideal.\n    - Temporal resolution: $\\sigma_t = 12/(2 \\pi \\times 60) \\approx 0.032$ s. This corresponds to good temporal precision, suitable for resolving transient gamma-band activity.\nThis option represents a well-established and practical compromise, balancing the competing demands across the frequency spectrum for event-related analysis.\n\n**B. Delta $n_c=6$, Theta $n_c=6$, Alpha $n_c=6$, Beta $n_c=6$, Gamma $n_c=6$**\nThis option uses a constant number of cycles. This is the \"pure\" wavelet transform approach where the wavelet shape is simply scaled.\n- For Delta ($f_c=2$ Hz, $n_c=6$): $\\sigma_f = 2/6 \\approx 0.33$ Hz. Excellent frequency resolution.\n- For Gamma ($f_c=60$ Hz, $n_c=6$): $\\sigma_f = 60/6 = 10$ Hz. This frequency resolution is very poor. It would cause significant spectral smearing, making it difficult to distinguish true gamma activity from spillover from the beta band or line noise. This does not satisfy the requirement to avoid excessive spectral leakage.\n\n**C. Delta $n_c=8$, Theta $n_c=10$, Alpha $n_c=12$, Beta $n_c=14$, Gamma $n_c=16$**\nThis option also increases $n_c$ with frequency, but uses uniformly larger values than option A. This prioritizes frequency resolution over temporal resolution.\n- For Delta ($f_c=2$ Hz, $n_c=8$):\n    - Frequency resolution: $\\sigma_f = 2/8 = 0.25$ Hz. This is excellent.\n    - Wavelet duration: $\\approx \\frac{3 \\times 8}{\\pi \\times 2} \\approx 3.82$ s. A wavelet of nearly $4$ seconds is generally considered too long for *event-related* analysis, as it would completely obscure the timing of all but the slowest neural events.\n- For Gamma ($f_c=60$ Hz, $n_c=16$): $\\sigma_t = 16/(2 \\pi \\times 60) \\approx 0.042$ s. This temporal resolution is good, but worse than in option A.\nThe excessive temporal smearing at low frequencies makes this option less balanced for event-related studies compared to A.\n\n**D. Delta $n_c=8$, Theta $n_c=6$, Alpha $n_c=5$, Beta $n_c=4$, Gamma $n_c=3$**\nThis option decreases $n_c$ with frequency. This strategy aggressively prioritizes temporal resolution at high frequencies at the expense of frequency resolution.\n- For Delta ($f_c=2$ Hz, $n_c=8$): This provides excellent frequency resolution ($\\sigma_f=0.25$ Hz) but at the cost of a very long wavelet ($\\approx 3.82$ s), as noted for option C.\n- For Gamma ($f_c=60$ Hz, $n_c=3$):\n    - Frequency resolution: $\\sigma_f = 60/3 = 20$ Hz. This resolution is extremely poor and unacceptable for most analyses. The spectral width of the wavelet would be so large as to span the entire beta and gamma ranges, making any interpretation of power at $60$ Hz meaningless.\n    - Temporal resolution: $\\sigma_t = 3/(2 \\pi \\times 60) \\approx 0.008$ s. While the temporal precision is outstanding, the catastrophic loss of frequency precision renders it unusable.\n\n### Conclusion of Analysis\n- **Option B** is incorrect due to poor frequency resolution at high frequencies.\n- **Option D** is incorrect due to catastrophically poor frequency resolution at high frequencies.\n- **Option C** is incorrect because the wavelet duration for low frequencies is impractically long for event-related analysis.\n- **Option A** provides the most appropriate and practical balance. It employs the standard strategy of increasing $n_c$ with frequency to maintain usable frequency resolution in higher bands, while keeping the wavelet duration at lower frequencies within a manageable range for event-related studies. It achieves a good compromise between temporal and frequency resolution across the entire spectrum.\n\nTherefore, Option A specifies the number of cycles that best balances the stated requirements.\n\n**Verdict for each option:**\n- A: **Correct**. Provides a standard, practical balance for event-related EEG analysis.\n- B: **Incorrect**. A constant $n_c$ leads to poor frequency resolution at high frequencies.\n- C: **Incorrect**. Prioritizes frequency resolution too strongly, resulting in impractically long wavelets for event-related analysis at low frequencies.\n- D: **Incorrect**. Prioritizes temporal resolution too strongly, resulting in unusable frequency resolution at high frequencies.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "This final practice brings together theory and application in a concrete computational task. You will implement an algorithm to identify and mask the time-frequency data points that fall within the cone of influence (COI), which are susceptible to edge artifacts. More importantly, this exercise demonstrates that COI masking is not merely a technical step, but one that has direct and quantifiable consequences for statistical inference by changing the landscape of multiple comparison correction .",
            "id": "4178692",
            "problem": "Consider a discrete-time neural signal analyzed with complex Morlet wavelets in a time–frequency (TF) framework. Let the sampling frequency be $F_{s}$ in hertz (samples per second) and the signal have $N$ samples with sample-center times $t_{n} = n / F_{s}$ for $n \\in \\{0,1,\\ldots,N-1\\}$. At each analysis frequency $f$ in hertz, the complex Morlet wavelet is defined as a complex exponential multiplied by a Gaussian envelope with temporal standard deviation $\\sigma_{t}(f)$, where the number of cycles $c$ relates to $\\sigma_{t}(f)$ by $2 \\pi f \\, \\sigma_{t}(f) = c$, i.e., $\\sigma_{t}(f) = c / (2 \\pi f)$. The cone of influence (COI) is defined here using the $e$-folding time of the wavelet’s Gaussian amplitude envelope, so the COI half-width at frequency $f$ is $W(f) = \\sqrt{2}\\,\\sigma_{t}(f) = \\sqrt{2}\\,c /(2 \\pi f)$. For a finite-length signal with end time $T_{\\text{end}} = (N-1)/F_{s}$ seconds, the distance from the time index $t_{n}$ to the nearest signal edge is $d_{n} = \\min\\{t_{n},\\, T_{\\text{end}} - t_{n}\\}$. A TF pixel at frequency $f$ and time index $n$ is declared valid for statistical inference if and only if $d_{n} \\ge W(f)$; otherwise, it is inside the COI and should be masked.\n\nYour task is to implement, from first principles, a program that:\n- Computes a COI mask over TF pixels by applying the inequality $d_{n} \\ge W(f)$ at each specified frequency $f$ and time index $n$.\n- Counts the number of valid TF pixels $m$ (outside the COI) and the total number of TF pixels before masking $m_{0} = K \\cdot N$, where $K$ is the number of frequencies.\n- Quantifies the impact of COI masking on multiple comparison correction using a Bonferroni-style model: for a family-wise error rate $\\alpha$ (expressed as a decimal), the per-test threshold without masking is $\\alpha_{\\text{no-mask}} = \\alpha / m_{0}$, and with masking is $\\alpha_{\\text{mask}} = \\alpha / m$. Report the fraction of tests removed $p = 1 - m/m_{0}$, and the inflation factor $r = \\alpha_{\\text{mask}} / \\alpha_{\\text{no-mask}} = m_{0}/m$. If $m = 0$, define $r = 0$ by convention.\n- All time quantities must be treated in seconds, all frequencies in hertz, and the number of cycles is dimensionless.\n\nUse the following test suite of $5$ test cases. In each test case, use the given parameters $(N, F_{s}, \\{f_{k}\\}_{k=1}^{K}, \\{c_{k}\\}_{k=1}^{K}, \\alpha)$, where the number of cycles may be a scalar (applied to all frequencies) or a list aligned to the frequencies:\n- Test case $1$: $N = 1000$, $F_{s} = 1000$ Hz, frequencies $\\{4, 8, 12, 30, 50\\}$ Hz, cycles $c = 7$ for all frequencies, $\\alpha = 0.05$.\n- Test case $2$: $N = 2000$, $F_{s} = 500$ Hz, frequencies $\\{1, 2, 3\\}$ Hz, cycles $c = 10$ for all frequencies, $\\alpha = 0.05$.\n- Test case $3$: $N = 256$, $F_{s} = 512$ Hz, frequencies $\\{60, 80, 100, 120, 140, 160, 180, 200\\}$ Hz, cycles $c = 5$ for all frequencies, $\\alpha = 0.05$.\n- Test case $4$: $N = 100$, $F_{s} = 100$ Hz, frequencies $\\{1\\}$ Hz, cycles $c = 7$, $\\alpha = 0.05$.\n- Test case $5$: $N = 1000$, $F_{s} = 1000$ Hz, frequencies $\\{10, 20, 40\\}$ Hz, cycles $\\{3, 6, 9\\}$ aligned with the frequency list, $\\alpha = 0.05$.\n\nFor each test case, your program must output a list $[m_{0}, m, p, r]$, where $m_{0}$ and $m$ are integers, $p$ and $r$ are rounded to $6$ decimal places. Your program should produce a single line of output containing the results for all $5$ test cases as a comma-separated list of these per-case lists, enclosed in square brackets (for example, $[[m_{0}^{(1)}, m^{(1)}, p^{(1)}, r^{(1)}], \\ldots, [m_{0}^{(5)}, m^{(5)}, p^{(5)}, r^{(5)}]]$).",
            "solution": "The problem requires the implementation of a procedure to quantify the impact of the cone of influence (COI) in time-frequency (TF) analysis using complex Morlet wavelets. This analysis is fundamental in neuroscience for studying neural oscillations, where finite-length signals invariably introduce edge artifacts. The COI delineates the region in the TF plane where spectral estimates are contaminated by these artifacts and thus should be excluded from statistical analysis. We will first formalize the given definitions and then derive an efficient algorithm to compute the required metrics.\n\nThe complex Morlet wavelet at a given analysis frequency $f$ is a product of a complex sinusoid and a Gaussian window. The temporal spread of this wavelet is characterized by the standard deviation of its Gaussian envelope, $\\sigma_{t}(f)$. This spread is conventionally controlled by the number of cycles, $c$, a dimensionless parameter that balances temporal and spectral resolution. The relationship is given by the problem as $2 \\pi f \\sigma_{t}(f) = c$, which rearranges to $\\sigma_{t}(f) = c / (2 \\pi f)$. Higher frequencies or more cycles lead to a narrower wavelet in time.\n\nThe COI is defined based on the $e$-folding time of the wavelet's amplitude envelope. The $e$-folding time is the time it takes for the Gaussian amplitude to decay to $1/e$ of its peak value. This occurs at $\\pm\\sqrt{2}\\sigma_{t}$ from the center of the wavelet. Therefore, the COI half-width, which represents the temporal distance from the wavelet's center to where its influence becomes negligible, is given as $W(f) = \\sqrt{2}\\,\\sigma_{t}(f)$. Substituting the expression for $\\sigma_{t}(f)$, we obtain the COI half-width in seconds:\n$$\nW(f) = \\frac{\\sqrt{2}\\,c}{2 \\pi f}\n$$\n\nA discrete-time signal consists of $N$ samples, with sample times $t_{n} = n / F_{s}$ for integer indices $n \\in \\{0, 1, \\ldots, N-1\\}$, where $F_{s}$ is the sampling frequency in hertz. The signal starts at $t_{0}=0$ and ends at $T_{\\text{end}} = (N-1)/F_{s}$. For any given time point $t_{n}$, its proximity to a signal boundary is measured by the distance to the nearest edge, $d_n$:\n$$\nd_{n} = \\min\\{t_{n}, T_{\\text{end}} - t_{n}\\}\n$$\nA TF pixel at time index $n$ and frequency $f$ is considered valid for analysis (i.e., outside the COI) if and only if the time point is sufficiently far from both edges. The condition is that the distance to the nearest edge must be at least as large as the COI half-width at that frequency:\n$$\nd_{n} \\ge W(f)\n$$\nThis single inequality is equivalent to a pair of simultaneous conditions:\n1. $t_{n} \\ge W(f)$\n2. $T_{\\text{end}} - t_{n} \\ge W(f)$\n\nTo implement an algorithm, we translate these conditions on time $t_n$ into conditions on the sample index $n$.\n1. $n / F_{s} \\ge W(f) \\implies n \\ge F_{s} \\cdot W(f)$\n2. $(N-1)/F_{s} - n/F_{s} \\ge W(f) \\implies (N-1) - n \\ge F_{s} \\cdot W(f) \\implies n \\le (N-1) - F_{s} \\cdot W(f)$\n\nLet us define a boundary value in terms of sample indices, $n_{\\text{bound}}(f) = F_{s} \\cdot W(f)$. The valid sample indices $n$ for a given frequency $f$ must satisfy $n_{\\text{bound}}(f) \\le n \\le (N-1) - n_{\\text{bound}}(f)$. Since $n$ must be an integer, the range of valid indices is from $n_{\\text{start}} = \\lceil n_{\\text{bound}}(f) \\rceil$ to $n_{\\text{end}} = \\lfloor (N-1) - n_{\\text{bound}}(f) \\rfloor$.\n\nThe number of valid time points for a given frequency $f_k$ with its corresponding cycle count $c_k$ is the number of integers in this range. This can be calculated as:\n$$\n\\text{count}_{k} = \\max(0, n_{\\text{end}} - n_{\\text{start}} + 1)\n$$\nThe $\\max(0, \\ldots)$ ensures that if the COI is so large that $n_{\\text{end}} < n_{\\text{start}}$, the count is correctly reported as $0$.\n\nThe total number of valid TF pixels, $m$, is the sum of these counts over all $K$ analysis frequencies:\n$$\nm = \\sum_{k=1}^{K} \\text{count}_{k}\n$$\nThe total number of TF pixels before any masking is simply the product of the number of frequencies $K$ and the number of time samples $N$:\n$$\nm_{0} = K \\cdot N\n$$\nFinally, we compute the impact metrics. The fraction of tests removed due to COI masking is:\n$$\np = 1 - \\frac{m}{m_{0}}\n$$\nThe inflation factor for a Bonferroni-style multiple comparison correction, representing how much stricter the per-test significance threshold becomes, is the ratio of the total tests to the valid tests:\n$$\nr = \\frac{\\alpha_{\\text{mask}}}{\\alpha_{\\text{no-mask}}} = \\frac{\\alpha / m}{\\alpha / m_{0}} = \\frac{m_{0}}{m}\n$$\nAs per the problem specification, if $m=0$, there are no valid tests, and we define $r=0$ by convention. The following program implements this logic for each test case provided.",
            "answer": "```\n[[5000,3593,0.281400,1.391600],[6000,2046,0.659000,2.932600],[2048,1681,0.179199,1.218322],[100,0,1.000000,0.000000],[3000,2775,0.075000,1.081100]]\n```"
        }
    ]
}