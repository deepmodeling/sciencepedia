{
    "hands_on_practices": [
        {
            "introduction": "为了有效地使用Morlet小波，首先必须掌握其基本属性。本练习将引导您从第一性原理出发，推导小波尺度与其对应频率之间的关系。通过理解这一核心映射以及影响锥（cone of influence, COI）的概念，您将为准确解释时频分析结果奠定坚实的理论基础 。",
            "id": "4178689",
            "problem": "一个以 $f_s = 2000$ Hz 采样的局部场电位 (LFP) 时间序列，使用复 Morlet 母小波进行分析。该母小波在时域中定义为 $\\psi(t) = \\pi^{-1/4} \\exp(i \\omega_0 t) \\exp(-t^2/2)$，其中 $\\omega_0$ 是无量纲中心角频率。考虑通过母小波的伸缩和平移构建的连续小波变换 (CWT)，其中缩放后的小波为 $\\psi_s(t) = s^{-1/2} \\psi(t/s)$，尺度 $s>0$。仅利用傅里叶变换在伸缩下的基本性质以及 Morlet 小波的高斯包络，从第一性原理推导 Morlet 小波的连续尺度 $s$ 和傅里叶频率 $f$ 之间的映射关系。然后，将此映射转换为适用于以 $f_s = 2000$ Hz 采样数据的离散尺度表达式（以采样点为单位），并给出当 $\\omega_0 = 6$ 时，频率 $f$ 在 $4$–$100$ Hz 区间内的该表达式。\n\n接下来，将影响锥 (COI) 定义为 Morlet 小波幅度包络的 e-折时间（从其中心测量），并推导出 COI 宽度作为频率 $f$ 的函数。使用 $\\omega_0 = 6$，计算在 $f = 10$ Hz 和 $f = 80$ Hz 时的 COI 宽度。以秒为单位表示这些宽度，并将每个数值四舍五入到四位有效数字。\n\n您的最终答案必须包括：\n- 当 $\\omega_0 = 6$ 和 $f_s = 2000$ Hz 时，以采样点为单位的离散尺度作为频率 $f$ 的函数的闭式表达式。\n- 在 $f = 10$ Hz 和 $f = 80$ Hz 时的 COI 宽度（以秒为单位），每个值均四舍五入到四位有效数字。",
            "solution": "该问题陈述是信号处理领域一个有效且适定的练习，具体涉及小波分析在时间序列数据中的应用，这是神经科学中的一项常见任务。所有给定的参数和定义都是标准的、科学上合理的且内部一致的。\n\n该问题可分为两个主要部分：首先，推导小波尺度与频率之间的关系；其次，推导和计算影响锥 (COI)。\n\n第一部分：尺度到频率的映射\n\n复 Morlet 母小波在时域中表示为：\n$$\n\\psi(t) = \\pi^{-1/4} \\exp(i \\omega_0 t) \\exp\\left(-\\frac{t^2}{2}\\right)\n$$\n其中 $\\omega_0$ 是无量纲中心角频率。我们的目标是找到尺度参数 $s$ 和傅里叶频率 $f$ 之间的关系。这可以通过在傅里叶域中找到尺度化小波的峰值频率来实现。\n\n首先，我们确定母小波的傅里叶变换，$\\hat{\\psi}(\\omega) = \\int_{-\\infty}^{\\infty} \\psi(t) \\exp(-i\\omega t) dt$。该小波由两部分组成：一个复正弦波 $\\exp(i \\omega_0 t)$ 和一个高斯包络 $g(t) = \\pi^{-1/4} \\exp(-t^2/2)$。\n\n我们使用傅里叶变换的两个基本性质：\n1.  高斯函数 $\\exp(-at^2)$ 的变换是 $\\sqrt{\\pi/a} \\exp(-\\omega^2/(4a))$。对于我们的包络，常数 $\\pi^{-1/4}$ 是一个归一化因子，高斯部分是 $\\exp(-t^2/2)$，其中 $a=1/2$。因此 $\\exp(-t^2/2)$ 的傅里叶变换是 $\\sqrt{2\\pi} \\exp(-\\omega^2/2)$。\n2.  频移性质指出，$f(t)\\exp(i\\omega_0 t)$ 的傅里叶变换是 $\\hat{f}(\\omega - \\omega_0)$。\n\n结合这两点，Morlet 母小波 $\\psi(t)$ 的傅里叶变换为：\n$$\n\\hat{\\psi}(\\omega) = \\pi^{-1/4} \\sqrt{2\\pi} \\exp\\left(-\\frac{(\\omega - \\omega_0)^2}{2}\\right) = (2\\pi)^{1/4} \\exp\\left(-\\frac{(\\omega - \\omega_0)^2}{2}\\right)\n$$\n该函数幅度的峰值出现在指数参数最大化的位置，即 $\\omega = \\omega_0$。这证实了 $\\omega_0$ 是母小波的中心角频率。\n\n接下来，我们考虑尺度化的小波 $\\psi_s(t) = s^{-1/2} \\psi(t/s)$。我们使用傅里叶变换的伸缩性质，该性质指出 $h(t/s)$ 的变换是 $|s|\\hat{h}(s\\omega)$。对于我们的尺度化小波，其傅里叶变换 $\\hat{\\psi}_s(\\omega)$ 是：\n$$\n\\hat{\\psi}_s(\\omega) = s^{-1/2} \\cdot s \\cdot \\hat{\\psi}(s\\omega) = s^{1/2} \\hat{\\psi}(s\\omega)\n$$\n代入 $\\hat{\\psi}(\\omega)$ 的表达式：\n$$\n\\hat{\\psi}_s(\\omega) = s^{1/2} (2\\pi)^{1/4} \\exp\\left(-\\frac{(s\\omega - \\omega_0)^2}{2}\\right)\n$$\n这个尺度化小波的峰值角频率 $\\omega_{peak}$ 可通过最大化其幅度找到，这发生在项 $(s\\omega - \\omega_0)^2$ 为零时。这得出：\n$$\ns\\omega_{peak} - \\omega_0 = 0 \\implies \\omega_{peak} = \\frac{\\omega_0}{s}\n$$\n角频率 $\\omega$（单位为弧度/秒）和傅里叶频率 $f$（单位为赫兹）之间的关系是 $\\omega = 2\\pi f$。因此，对应于尺度 $s$ 的中心频率 $f$ 是：\n$$\n2\\pi f = \\frac{\\omega_0}{s} \\implies s = \\frac{\\omega_0}{2\\pi f}\n$$\n这就是连续尺度 $s$（时间单位）和傅里叶频率 $f$ 之间的一般映射关系。\n\n问题要求将此映射转换为以采样点为单位的离散尺度表达式。时间尺度 $s$（以秒为单位）通过除以采样周期 $\\Delta T = 1/f_s$（或等效地，乘以采样频率 $f_s$）转换为离散尺度 $s_{samples}$（以采样点为单位）：\n$$\ns_{samples}(f) = s \\cdot f_s = \\left(\\frac{\\omega_0}{2\\pi f}\\right) f_s\n$$\n给定参数 $f_s = 2000$ Hz 和 $\\omega_0 = 6$，我们可以为 $4$–$100$ Hz 区间内的频率 $f$ 指定此表达式：\n$$\ns_{samples}(f) = \\frac{6 \\cdot 2000}{2\\pi f} = \\frac{12000}{2\\pi f} = \\frac{6000}{\\pi f}\n$$\n这是第一个要求的表达式。\n\n第二部分：影响锥 (COI)\n\nCOI 定义为 Morlet 小波幅度包络的 e-折时间，从其中心测量。尺度化的小波是 $\\psi_s(t) = s^{-1/2} \\psi(t/s)$。其幅度包络 $A_s(t)$ 是它的幅值：\n$$\nA_s(t) = |\\psi_s(t)| = \\left|s^{-1/2} \\pi^{-1/4} \\exp\\left(i \\omega_0 \\frac{t}{s}\\right) \\exp\\left(-\\frac{(t/s)^2}{2}\\right)\\right| = s^{-1/2} \\pi^{-1/4} \\exp\\left(-\\frac{t^2}{2s^2}\\right)\n$$\n包络在 $t=0$ 处居中，此处具有峰值 $A_s(0) = s^{-1/2} \\pi^{-1/4}$。e-折时间，我们记作 COI 宽度 $W_{COI}$，是幅度下降到其峰值 $1/e$ 时的时间 $t = W_{COI}$：\n$$\nA_s(W_{COI}) = \\frac{1}{e} A_s(0)\n$$\n代入幅度的表达式：\n$$\ns^{-1/2} \\pi^{-1/4} \\exp\\left(-\\frac{W_{COI}^2}{2s^2}\\right) = \\frac{1}{e} \\left(s^{-1/2} \\pi^{-1/4}\\right) = \\exp(-1) \\left(s^{-1/2} \\pi^{-1/4}\\right)\n$$\n令指数函数的参数相等：\n$$\n-\\frac{W_{COI}^2}{2s^2} = -1 \\implies W_{COI}^2 = 2s^2 \\implies W_{COI} = \\sqrt{2} s\n$$\n因此，COI 宽度是尺度参数 $s$ 的 $\\sqrt{2}$ 倍。为了将其表示为频率 $f$ 的函数，我们代入尺度-频率关系 $s = \\frac{\\omega_0}{2\\pi f}$：\n$$\nW_{COI}(f) = \\sqrt{2} \\left(\\frac{\\omega_0}{2\\pi f}\\right) = \\frac{\\omega_0}{\\sqrt{2} \\pi f}\n$$\n现在我们用给定的参数计算此值。当 $\\omega_0 = 6$ 时：\n$$\nW_{COI}(f) = \\frac{6}{\\sqrt{2} \\pi f}\n$$\n对于 $f = 10$ Hz：\n$$\nW_{COI}(10) = \\frac{6}{\\sqrt{2} \\pi (10)} = \\frac{0.6}{\\sqrt{2} \\pi} \\approx 0.135048... \\text{ s}\n$$\n四舍五入到四位有效数字，COI 宽度为 $0.1350$ s。\n\n对于 $f = 80$ Hz：\n$$\nW_{COI}(80) = \\frac{6}{\\sqrt{2} \\pi (80)} = \\frac{0.075}{\\sqrt{2} \\pi} \\approx 0.016881... \\text{ s}\n$$\n四舍五入到四位有效数字，COI 宽度为 $0.01688$ s。\n这些值表示从分析窗口中心到 COI 边缘的时间（以秒为单位）。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{6000}{\\pi f} & 0.1350 & 0.01688 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "像影响锥（COI）这样的理论概念，在数据分析中会产生具体的后果，尤其是在统计推断方面。这个动手编程练习要求您实现一个COI掩码，以排除信号边缘的不可靠数据点。通过量化此掩码对多重比较校正的影响，您将对如何在时频分析中保持统计严谨性获得切实的理解 。",
            "id": "4178692",
            "problem": "考虑一个在时频（TF）框架下使用复莫莱小波分析的离散时间神经信号。设采样频率为 $F_{s}$ 赫兹（样本/秒），信号有 $N$ 个样本，样本中心时间为 $t_{n} = n / F_{s}$，其中 $n \\in \\{0,1,\\ldots,N-1\\}$。在每个分析频率 $f$（赫兹）下，复莫莱小波定义为一个复指数与一个高斯包络的乘积，该高斯包络的时间标准差为 $\\sigma_{t}(f)$，其中周期数 $c$ 通过 $2 \\pi f \\, \\sigma_{t}(f) = c$ 与 $\\sigma_{t}(f)$ 相关，即 $\\sigma_{t}(f) = c / (2 \\pi f)$。此处，影响锥（COI）使用小波高斯振幅包络的 $e$ 折时间来定义，因此在频率 $f$ 处的COI半宽为 $W(f) = \\sqrt{2}\\,\\sigma_{t}(f) = \\sqrt{2}\\,c /(2 \\pi f)$。对于一个结束时间为 $T_{\\text{end}} = (N-1)/F_{s}$ 秒的有限长度信号，时间点 $t_{n}$ 到最近信号边缘的距离为 $d_{n} = \\min\\{t_{n},\\, T_{\\text{end}} - t_{n}\\}$。当且仅当 $d_{n} \\ge W(f)$ 时，位于频率 $f$ 和时间索引 $n$ 处的时频像素点才被声明为对统计推断有效；否则，它位于COI内部，应被掩膜。\n\n您的任务是，从第一性原理出发，实现一个程序，该程序能够：\n- 通过在每个指定的频率 $f$ 和时间索引 $n$ 处应用不等式 $d_{n} \\ge W(f)$，计算时频像素点上的COI掩膜。\n- 统计有效（COI之外）的时频像素点数量 $m$ 以及掩膜前的总时频像素点数量 $m_{0} = K \\cdot N$，其中 $K$ 是频率的数量。\n- 使用Bonferroni风格模型量化COI掩膜对多重比较校正的影响：对于族系错误率 $\\alpha$（以小数表示），无掩膜时的单次检验阈值为 $\\alpha_{\\text{no-mask}} = \\alpha / m_{0}$，有掩膜时为 $\\alpha_{\\text{mask}} = \\alpha / m$。报告被移除的检验比例 $p = 1 - m/m_{0}$，以及膨胀因子 $r = \\alpha_{\\text{mask}} / \\alpha_{\\text{no-mask}} = m_{0}/m$。如果 $m = 0$，按照惯例定义 $r = 0$。\n- 所有时间量必须以秒为单位处理，所有频率以赫兹为单位，周期数为无量纲。\n\n使用以下包含5个测试用例的测试套件。在每个测试用例中，使用给定的参数 $(N, F_{s}, \\{f_{k}\\}_{k=1}^{K}, \\{c_{k}\\}_{k=1}^{K}, \\alpha)$，其中周期数可以是一个标量（应用于所有频率）或一个与频率列表对齐的列表：\n- 测试用例1：$N = 1000$，$F_{s} = 1000$ Hz，频率 $\\{4, 8, 12, 30, 50\\}$ Hz，所有频率的周期数 $c = 7$，$\\alpha = 0.05$。\n- 测试用例2：$N = 2000$，$F_{s} = 500$ Hz，频率 $\\{1, 2, 3\\}$ Hz，所有频率的周期数 $c = 10$，$\\alpha = 0.05$。\n- 测试用例3：$N = 256$，$F_{s} = 512$ Hz，频率 $\\{60, 80, 100, 120, 140, 160, 180, 200\\}$ Hz，所有频率的周期数 $c = 5$，$\\alpha = 0.05$。\n- 测试用例4：$N = 100$，$F_{s} = 100$ Hz，频率 $\\{1\\}$ Hz，周期数 $c = 7$，$\\alpha = 0.05$。\n- 测试用例5：$N = 1000$，$F_{s} = 1000$ Hz，频率 $\\{10, 20, 40\\}$ Hz，周期数 $\\{3, 6, 9\\}$ 与频率列表对齐，$\\alpha = 0.05$。\n\n对于每个测试用例，您的程序必须输出一个列表 $[m_{0}, m, p, r]$，其中 $m_{0}$ 和 $m$ 是整数，$p$ 和 $r$ 四舍五入到6位小数。您的程序应生成单行输出，其中包含所有5个测试用例的结果，形式为这些单个用例列表的逗号分隔列表，并用方括号括起来（例如， $[[m_{0}^{(1)}, m^{(1)}, p^{(1)}, r^{(1)}], \\ldots, [m_{0}^{(5)}, m^{(5)}, p^{(5)}, r^{(5)}]]$）。",
            "solution": "该问题要求实现一个程序，以量化在使用复莫莱小波进行时频（TF）分析中影响锥（COI）的影响。这种分析在神经科学中对于研究神经振荡至关重要，其中有限长度的信号不可避免地会引入边缘伪影。COI划定了TF平面中谱估计受到这些伪影污染的区域，因此应从统计分析中排除。我们将首先形式化给定的定义，然后推导出一个高效的算法来计算所需的度量。\n\n在给定的分析频率 $f$ 下，复莫莱小波是复指数和高斯包络的乘积。该小波的时间扩展由其高斯包络的标准差 $\\sigma_{t}(f)$ 来表征。这种扩展通常由周期数 $c$ 控制，这是一个平衡时间分辨率和频谱分辨率的无量纲参数。问题中给出的关系是 $2 \\pi f \\sigma_{t}(f) = c$，可整理为 $\\sigma_{t}(f) = c / (2 \\pi f)$。更高的频率或更多的周期会导致时间上更窄的小波。\n\nCOI是基于小波振幅包络的 $e$ 折时间来定义的。$e$ 折时间是高斯振幅衰减到其峰值的 $1/e$ 所需的时间。这种情况发生在距离小波中心 $\\pm\\sqrt{2}\\sigma_{t}$ 的位置。因此，表示从小波中心到其影响变得可忽略不计的时间距离的COI半宽由 $W(f) = \\sqrt{2}\\,\\sigma_{t}(f)$ 给出。代入 $\\sigma_{t}(f)$ 的表达式，我们得到以秒为单位的COI半宽：\n$$\nW(f) = \\frac{\\sqrt{2}\\,c}{2 \\pi f}\n$$\n\n一个离散时间信号由 $N$ 个样本组成，样本时间为 $t_{n} = n / F_{s}$，其中整数索引 $n \\in \\{0, 1, \\ldots, N-1\\}$，$F_{s}$ 是以赫兹为单位的采样频率。信号从 $t_{0}=0$ 开始，到 $T_{\\text{end}} = (N-1)/F_{s}$ 结束。对于任何给定的时间点 $t_{n}$，其到信号边界的接近程度由到最近边缘的距离 $d_n$ 衡量：\n$$\nd_{n} = \\min\\{t_{n}, T_{\\text{end}} - t_{n}\\}\n$$\n一个在时间索引 $n$ 和频率 $f$ 上的时频像素点被认为是有效的（即在COI之外），当且仅当该时间点距离两个边缘都足够远。条件是到最近边缘的距离必须至少等于该频率下的COI半宽：\n$$\nd_{n} \\ge W(f)\n$$\n这个单一不等式等价于一对同时成立的条件：\n1. $t_{n} \\ge W(f)$\n2. $T_{\\text{end}} - t_{n} \\ge W(f)$\n\n为了实现一个算法，我们将这些关于时间 $t_n$ 的条件转换成关于样本索引 $n$ 的条件。\n1. $n / F_{s} \\ge W(f) \\implies n \\ge F_{s} \\cdot W(f)$\n2. $(N-1)/F_{s} - n/F_{s} \\ge W(f) \\implies (N-1) - n \\ge F_{s} \\cdot W(f) \\implies n \\le (N-1) - F_{s} \\cdot W(f)$\n\n我们以来样点索引定义一个边界值 $n_{\\text{bound}}(f) = F_{s} \\cdot W(f)$。对于给定的频率 $f$，有效的样本索引 $n$ 必须满足 $n_{\\text{bound}}(f) \\le n \\le (N-1) - n_{\\text{bound}}(f)$。由于 $n$ 必须是整数，有效索引的范围是从 $n_{\\text{start}} = \\lceil n_{\\text{bound}}(f) \\rceil$ 到 $n_{\\text{end}} = \\lfloor (N-1) - n_{\\text{bound}}(f) \\rfloor$。\n\n对于给定的频率 $f_k$ 及其对应的周期数 $c_k$，有效时间点的数量是此范围内的整数个数。这可以计算为：\n$$\n\\text{count}_{k} = \\max(0, n_{\\text{end}} - n_{\\text{start}} + 1)\n$$\n$\\max(0, \\ldots)$ 确保了如果COI过大以至于 $n_{\\text{end}} < n_{\\text{start}}$，计数能被正确地报告为0。\n\n有效的时频像素点总数 $m$ 是所有 $K$ 个分析频率上这些计数的总和：\n$$\nm = \\sum_{k=1}^{K} \\text{count}_{k}\n$$\n在进行任何掩膜之前的时频像素点总数，就是频率数 $K$ 与时间样本数 $N$ 的乘积：\n$$\nm_{0} = K \\cdot N\n$$\n最后，我们计算影响度量。因COI掩膜而被移除的检验比例是：\n$$\np = 1 - \\frac{m}{m_{0}}\n$$\n对于Bonferroni风格的多重比较校正，其膨胀因子代表了单次检验的显著性阈值变得多么严格，它是总检验数与有效检验数的比值：\n$$\nr = \\frac{\\alpha_{\\text{mask}}}{\\alpha_{\\text{no-mask}}} = \\frac{\\alpha / m}{\\alpha / m_{0}} = \\frac{m_{0}}{m}\n$$\n根据问题规范，如果 $m=0$，则没有有效检验，我们按惯例定义 $r=0$。以下程序为每个提供的测试用例实现了这一逻辑。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    It processes each test case, calculates the COI metrics, formats the results,\n    and prints them in the specified format.\n    \"\"\"\n\n    test_cases = [\n        {'N': 1000, 'Fs': 1000, 'freqs': [4, 8, 12, 30, 50], 'cycles': 7, 'alpha': 0.05},\n        {'N': 2000, 'Fs': 500, 'freqs': [1, 2, 3], 'cycles': 10, 'alpha': 0.05},\n        {'N': 256, 'Fs': 512, 'freqs': [60, 80, 100, 120, 140, 160, 180, 200], 'cycles': 5, 'alpha': 0.05},\n        {'N': 100, 'Fs': 100, 'freqs': [1], 'cycles': 7, 'alpha': 0.05},\n        {'N': 1000, 'Fs': 1000, 'freqs': [10, 20, 40], 'cycles': [3, 6, 9], 'alpha': 0.05},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_coi_metrics(\n            case['N'], case['Fs'], case['freqs'], case['cycles']\n        )\n        results.append(result)\n\n    # Format the final output string exactly as specified.\n    # Each sublist is formatted, then joined by commas, then enclosed in brackets.\n    output_strings = []\n    for res in results:\n        # m0, m are integers. p, r must be formatted to 6 decimal places.\n        m0, m, p, r = res\n        output_strings.append(f\"[{m0},{m},{p:.6f},{r:.6f}]\")\n    \n    final_output = f\"[{','.join(output_strings)}]\"\n    print(final_output)\n\ndef calculate_coi_metrics(N, Fs, freqs, cycles):\n    \"\"\"\n    Calculates COI-related metrics for a single analysis configuration.\n\n    Args:\n        N (int): Number of time samples.\n        Fs (int or float): Sampling frequency in Hz.\n        freqs (list of float): List of analysis frequencies in Hz.\n        cycles (int, float, or list): Number of wavelet cycles. Can be a scalar\n                                      applied to all frequencies or a list aligned\n                                      with freqs.\n\n    Returns:\n        list: A list containing [m0, m, p, r], where:\n              m0 (int): Total number of TF pixels.\n              m (int): Number of valid TF pixels (outside COI).\n              p (float): Fraction of pixels removed by masking.\n              r (float): Inflation factor for multiple comparison correction.\n    \"\"\"\n    K = len(freqs)\n    m0 = K * N\n    \n    # Ensure 'cycles' is a list of the same length as 'freqs'\n    if isinstance(cycles, (int, float)):\n        cycles_list = [cycles] * K\n    else:\n        cycles_list = cycles\n\n    m = 0\n    for i in range(K):\n        f = freqs[i]\n        c = cycles_list[i]\n\n        # Calculate COI half-width W(f) in seconds\n        # W(f) = sqrt(2) * sigma_t(f) = sqrt(2) * c / (2 * pi * f)\n        W_f = (np.sqrt(2) * c) / (2 * np.pi * f)\n\n        # Convert temporal width to number of sample indices\n        # The valid region is n_start = n = n_end\n        n_bound = Fs * W_f\n        \n        # Lower bound index (inclusive)\n        n_start = np.ceil(n_bound)\n        \n        # Upper bound index (inclusive)\n        n_end = np.floor(N - 1 - n_bound)\n\n        # Count number of valid integer indices in the range [n_start, n_end]\n        if n_end >= n_start:\n            count_k = n_end - n_start + 1\n            m += count_k\n\n    m = int(m)\n\n    # Calculate derived metrics\n    if m0 > 0:\n        p = 1 - m / m0\n    else: # Should not happen with valid inputs but good for robustness\n        p = 0.0\n\n    if m > 0:\n        r = m0 / m\n    else:\n        # As per problem definition, if m = 0, r is 0 by convention.\n        r = 0.0\n\n    return [m0, m, p, r]\n\nsolve()\n```"
        }
    ]
}