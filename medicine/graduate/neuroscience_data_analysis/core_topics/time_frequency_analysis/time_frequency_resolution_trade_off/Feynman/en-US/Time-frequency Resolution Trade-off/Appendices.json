{
    "hands_on_practices": [
        {
            "introduction": "The Short-Time Fourier Transform (STFT) is a foundational tool for exploring how the frequency content of a signal changes over time. However, its power is governed by the time-frequency trade-off: the choice of analysis window duration, $L$, directly determines the achievable spectral resolution. This practice will guide you through the essential calculations that connect analysis parameters to the practical ability to distinguish between closely spaced frequency components, a cornerstone of interpreting any spectrogram .",
            "id": "4200751",
            "problem": "You are analyzing a stationary segment of electroencephalogram (EEG) data using the Short-Time Fourier Transform (STFT). The signal is sampled at $F_s = 500\\ \\mathrm{Hz}$ and you will use an analysis window of duration $L = 1\\ \\mathrm{s}$. The STFT employs the Hann (also called Hanning) window with $50\\%$ overlap between consecutive windows. Consider a $10\\ \\mathrm{s}$ recording.\n\nStarting from fundamental definitions of discrete-time Fourier analysis and windowing, and using well-tested properties of window mainlobe widths, do the following:\n\n- Derive the discrete Fourier transform (DFT) frequency-bin spacing $\\Delta f$ as a function of $F_s$ and $L$.\n- Compute the number of STFT segments that fit into the $10\\ \\mathrm{s}$ recording with the specified overlap rule, assuming windows are placed contiguously from the start of the recording and the last window must lie fully within the recording.\n- Based on the known mainlobe width of the Hann window in bins, rigorously reason about the ability to resolve two narrowband peaks at $9\\ \\mathrm{Hz}$ and $10\\ \\mathrm{Hz}$ under these analysis parameters. Frame your reasoning in terms of the Rayleigh resolution implied by the window’s mainlobe and the time-frequency resolution trade-off, explicitly connecting the window duration $L$ to both temporal and spectral resolution.\n\nProvide the numerical value of $\\Delta f$ in $\\mathrm{Hz}$ and the segment count as an integer. No rounding is required. Express your final numerical answers without units inside the final answer box.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective. It poses a standard signal processing task involving the Short-Time Fourier Transform (STFT) with realistic parameters for neuroscience data analysis. All necessary information is provided, and the questions have unique, derivable answers.\n\nThe problem requires a three-part analysis of an STFT application to EEG data. We will address each part in sequence, starting from fundamental principles. The given parameters are the sampling frequency $F_s = 500\\ \\mathrm{Hz}$, the window duration $L = 1\\ \\mathrm{s}$, a total recording duration of $T_{rec} = 10\\ \\mathrm{s}$, a Hann window, and $50\\%$ overlap.\n\nFirst, we derive the frequency-bin spacing of the Discrete Fourier Transform (DFT) used within each STFT segment. The analysis window has a duration of $L$. Given a sampling frequency $F_s$, the number of discrete samples $N$ within this window is given by:\n$$N = L \\times F_s$$\nFor the given values, $N = 1\\ \\mathrm{s} \\times 500\\ \\mathrm{Hz} = 500$ samples.\nThe DFT of a sequence of $N$ samples produces a spectrum represented by $N$ complex coefficients, which correspond to $N$ equally spaced frequency bins. The frequency range spanned by the DFT of a real-valued signal extends from $0$ Hz up to the sampling frequency $F_s$. Therefore, the spacing $\\Delta f$ between adjacent frequency bins is:\n$$\\Delta f = \\frac{F_s}{N}$$\nSubstituting the expression for $N$, we find a general relationship between bin spacing and window duration:\n$$\\Delta f = \\frac{F_s}{L \\times F_s} = \\frac{1}{L}$$\nFor the specified window duration of $L = 1\\ \\mathrm{s}$, the frequency-bin spacing is:\n$$\\Delta f = \\frac{1}{1\\ \\mathrm{s}} = 1\\ \\mathrm{Hz}$$\n\nSecond, we compute the number of STFT segments that can be extracted from the $10\\ \\mathrm{s}$ recording. The window duration is $L = 1\\ \\mathrm{s}$ and the overlap is $50\\%$. The hop size, or step size $H$, which is the time difference between the start of consecutive windows, is the non-overlapping portion of the window:\n$$H = L \\times (1 - 0.50) = 0.5 \\times L = 0.5 \\times 1\\ \\mathrm{s} = 0.5\\ \\mathrm{s}$$\nLet $K$ be the number of segments. The first window starts at time $t_0 = 0$ and covers the interval $[0, L]$. The start time of the $k$-th segment (using $1$-based indexing) is $t_{k-1} = (k-1)H$. The time interval covered by the $k$-th segment is $[(k-1)H, (k-1)H + L]$. The problem states that the last window must lie fully within the recording duration $T_{rec} = 10\\ \\mathrm{s}$. Therefore, for the last segment, which is the $K$-th segment, its end time must be less than or equal to $T_{rec}$:\n$$(K-1)H + L \\le T_{rec}$$\nSubstituting the values $H = 0.5\\ \\mathrm{s}$, $L = 1\\ \\mathrm{s}$, and $T_{rec} = 10\\ \\mathrm{s}$:\n$$(K-1) \\times 0.5 + 1 \\le 10$$\n$$(K-1) \\times 0.5 \\le 9$$\n$$K-1 \\le \\frac{9}{0.5}$$\n$$K-1 \\le 18$$\n$$K \\le 19$$\nSince the number of segments $K$ must be an integer, the maximum number of segments is $19$.\n\nThird, we assess the ability to resolve two narrowband frequency components at $f_1 = 9\\ \\mathrm{Hz}$ and $f_2 = 10\\ \\mathrm{Hz}$. The frequency separation between these components is $\\Delta f_{peaks} = |f_2 - f_1| = 1\\ \\mathrm{Hz}$. The ability to resolve two closely spaced frequencies is determined not by the DFT bin spacing $\\Delta f$, but by the spectral resolution of the analysis window. The spectral resolution is fundamentally limited by the mainlobe width of the window function's Fourier transform. This is a direct consequence of the time-frequency uncertainty principle: a shorter time window leads to a wider spectral window, implying poorer frequency resolution.\n\nFor a Hann window of duration $L$, its Fourier transform exhibits a mainlobe. The Rayleigh criterion for resolution states that two frequency components are just resolvable if the maximum of one component's spectral peak coincides with the first minimum (zero) of the other's. The location of the first zero in the spectrum of a Hann-windowed sinusoid, relative to the sinusoid's true frequency, is at a distance of $\\frac{2}{L}$. Therefore, the minimum resolvable frequency separation, $\\delta f_{res}$, for a Hann window is given by:\n$$\\delta f_{res} = \\frac{2}{L}$$\nWith the given window duration $L = 1\\ \\mathrm{s}$, the spectral resolution is:\n$$\\delta f_{res} = \\frac{2}{1\\ \\mathrm{s}} = 2\\ \\mathrm{Hz}$$\nTo resolve the two peaks, their separation $\\Delta f_{peaks}$ must be greater than or at least equal to the spectral resolution $\\delta f_{res}$. In this case:\n$$\\Delta f_{peaks} = 1\\ \\mathrm{Hz} < \\delta f_{res} = 2\\ \\mathrm{Hz}$$\nSince the frequency separation of the signals ($1\\ \\mathrm{Hz}$) is less than the spectral resolution achievable with the chosen window ($2\\ \\mathrm{Hz}$), the two components at $9\\ \\mathrm{Hz}$ and $10\\ \\mathrm{Hz}$ cannot be distinguished as two separate peaks. Instead, their windowed spectra will overlap substantially and merge into a single, broader peak centered somewhere between $9\\ \\mathrm{Hz}$ and $10\\ \\mathrm{Hz}$.\n\nThis illustrates the time-frequency resolution trade-off. The chosen temporal resolution is dictated by the window length, $\\Delta t \\approx L = 1\\ \\mathrm{s}$. This choice, in turn, constrains the best possible spectral resolution to $\\delta f_{res} \\approx \\frac{2}{L} = 2\\ \\mathrm{Hz}$. To resolve the $1\\ \\mathrm{Hz}$ separation, one would need to increase the window duration $L$ to at least $2\\ \\mathrm{s}$ (since $L = 2/\\delta f_{res} = 2/1 = 2$), which would necessarily degrade the temporal resolution to $\\Delta t \\approx 2\\ \\mathrm{s}$.\n\nThe numerical answers required are the frequency-bin spacing $\\Delta f = 1\\ \\mathrm{Hz}$ and the segment count $K = 19$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & 19\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "In spectral analysis, it is common to zero-pad a signal before performing a Fast Fourier Transform (FFT), which visually produces a smoother-looking spectrum. This can create the illusion of improved resolution. This exercise directly confronts this misconception by forcing a clear distinction between the DFT's frequency-bin spacing, which is refined by padding, and the true spectral resolution, which is irrevocably set by the original data window's duration . Mastering this concept is critical for correctly interpreting spectral estimates and understanding the fundamental limits of your analysis.",
            "id": "4200800",
            "problem": "A systems neuroscience lab analyzes a local field potential (LFP) segment of duration $T=2\\ \\mathrm{s}$ to estimate oscillatory content near the alpha and beta bands. They first compute a Fast Fourier Transform (FFT) of the $2\\ \\mathrm{s}$ segment using a rectangular analysis window of the same length, and then repeat the FFT after zero-padding the segment to an $8\\ \\mathrm{s}$ record while keeping the same sampling rate and the same rectangular taper on the original data samples. The lab lead emphasizes the time-frequency resolution trade-off and asks the team to reason from first principles about the effect of zero-padding on discrete frequency sampling and on the width of the spectral mainlobe.\n\nUsing only the definition of the Discrete Fourier Transform (DFT) as a projection onto complex exponentials over the FFT duration and the Fourier transform relationship between a time-limited window and its spectral envelope, determine the frequency-bin spacing before and after zero-padding, and explain whether, and why, zero-padding changes the width of the spectral mainlobe in hertz.\n\nSelect the option that correctly states both the numerical bin spacings and the correct conceptual explanation.\n\nA. Before padding: $\\Delta f = 0.5\\ \\mathrm{Hz}$; after padding: $\\Delta f = 0.125\\ \\mathrm{Hz}$. Zero-padding only increases the sampling density of the same continuous spectrum; the spectral mainlobe is set by the $2\\ \\mathrm{s}$ rectangular window and remains approximately $2/T \\approx 1\\ \\mathrm{Hz}$ wide (zero-to-zero), unchanged by padding.\n\nB. Before padding: $\\Delta f = 0.5\\ \\mathrm{Hz}$; after padding: $\\Delta f = 0.125\\ \\mathrm{Hz}$. Zero-padding reduces the spectral mainlobe width in proportion to the bin spacing, narrowing it by a factor of $4$.\n\nC. Before padding: $\\Delta f = 2\\ \\mathrm{Hz}$; after padding: $\\Delta f = 0.5\\ \\mathrm{Hz}$. Zero-padding does not change the spectral mainlobe because it does not change the data content, only the number of FFT points.\n\nD. Before padding: $\\Delta f = 0.5\\ \\mathrm{Hz}$; after padding: $\\Delta f = 0.125\\ \\mathrm{Hz}$. Zero-padding widens the spectral mainlobe due to reduced spectral leakage when zero values are appended.\n\nE. Before padding: $\\Delta f = 0.5\\ \\mathrm{Hz}$; after padding: $\\Delta f = 0.5\\ \\mathrm{Hz}$. Zero-padding does not change the spectral mainlobe because the analysis window’s duration and type are unchanged, but the bin spacing is also unchanged because the data duration is what sets it.",
            "solution": "The problem statement is a valid exercise in digital signal processing, specifically concerning the effects of zero-padding on the Discrete Fourier Transform (DFT) of a time-limited signal. The scenario is scientifically grounded, well-posed, and objective. There are no contradictions or missing pieces of essential information.\n\nTo solve this problem, we must distinguish between two key concepts: the frequency-bin spacing of a DFT and the spectral resolution.\n\n1.  **Frequency-Bin Spacing ($\\Delta f$)**: The DFT (often implemented via the Fast Fourier Transform, FFT) operates on a discrete data record of total duration $T_{record}$. If the record consists of $N$ samples taken at a sampling frequency $f_s$, then $T_{record} = N/f_s$. The DFT produces $N$ frequency components spanning from $0\\ \\mathrm{Hz}$ up to (but not including) $f_s$. The spacing between adjacent frequency bins is given by:\n    $$ \\Delta f = \\frac{f_s}{N} = \\frac{1}{T_{record}} $$\n    This means the frequency-bin spacing is solely determined by the total duration of the record fed into the FFT algorithm.\n\n2.  **Spectral Resolution and Mainlobe Width**: The spectral resolution refers to the ability to distinguish between two closely spaced frequency components in the original continuous signal. This is fundamentally limited by the duration of the actual, non-zero data acquisition, as dictated by the Heisenberg-Gabor uncertainty principle or, more practically, by the properties of the window function. The recorded signal is effectively the true, underlying signal multiplied by a window function, $w(t)$. In this problem, the window is a rectangular window of duration $T = 2\\ \\mathrm{s}$. In the frequency domain, this product corresponds to the convolution of the true signal's spectrum with the window's spectrum, $W(f)$. This convolution \"smears\" the true spectrum. The shape of $W(f)$ determines the nature of this smearing. For a rectangular window of duration $T$, the Fourier transform is a sinc function, $|W(f)| \\propto |\\mathrm{sinc}(\\pi f T)|$. The mainlobe of this function lies between its first zeros, which occur at $f = \\pm 1/T$. Therefore, the total width of the mainlobe, measured from zero-crossing to zero-crossing, is $2/T$. This width dictates the spectral resolution.\n\nLet's apply these principles to the two cases described in the problem.\n\n**Case 1: Before Zero-Padding**\nThe LFP segment has a duration of $T = 2\\ \\mathrm{s}$. The FFT is computed on this segment directly.\n- The total record duration for the FFT is $T_{record,1} = 2\\ \\mathrm{s}$.\n- The frequency-bin spacing is:\n  $$ \\Delta f_1 = \\frac{1}{T_{record,1}} = \\frac{1}{2\\ \\mathrm{s}} = 0.5\\ \\mathrm{Hz} $$\n- The spectral resolution is determined by the window duration, which is $T = 2\\ \\mathrm{s}$. The width of the spectral mainlobe is:\n  $$ W_{ML} = \\frac{2}{T} = \\frac{2}{2\\ \\mathrm{s}} = 1\\ \\mathrm{Hz} $$\n\n**Case 2: After Zero-Padding**\nThe $2\\ \\mathrm{s}$ LFP segment is padded with zeros to create a new record of duration $8\\ \\mathrm{s}$.\n- The total record duration for the FFT is now $T_{record,2} = 8\\ \\mathrm{s}$.\n- The frequency-bin spacing is:\n  $$ \\Delta f_2 = \\frac{1}{T_{record,2}} = \\frac{1}{8\\ \\mathrm{s}} = 0.125\\ \\mathrm{Hz} $$\n- **Crucially**, the spectral resolution is still determined by the duration of the original, non-zero data, which is $T = 2\\ \\mathrm{s}$. The zero-padding operation does not add new information about the signal's frequency content; it only changes the length of the vector being transformed. The underlying continuous spectrum being sampled by the DFT is still that of the $2\\ \\mathrm{s}$ data segment. Therefore, the mainlobe width remains unchanged:\n  $$ W_{ML} = \\frac{2}{T} = \\frac{2}{2\\ \\mathrm{s}} = 1\\ \\mathrm{Hz} $$\nBy decreasing the bin spacing from $0.5\\ \\mathrm{Hz}$ to $0.125\\ \\mathrm{Hz}$, the zero-padding provides a more densely sampled, or higher-definition, view of the *same* spectral shape determined by the $2\\ \\mathrm{s}$ window. This is equivalent to frequency-domain interpolation. It does not improve the ability to resolve two nearby frequencies, which remains limited by the $1\\ \\mathrm{Hz}$ mainlobe width.\n\nNow we evaluate the given options:\n\n**A. Before padding: $\\Delta f = 0.5\\ \\mathrm{Hz}$; after padding: $\\Delta f = 0.125\\ \\mathrm{Hz}$. Zero-padding only increases the sampling density of the same continuous spectrum; the spectral mainlobe is set by the $2\\ \\mathrm{s}$ rectangular window and remains approximately $2/T \\approx 1\\ \\mathrm{Hz}$ wide (zero-to-zero), unchanged by padding.**\n- The calculated bin spacings, $\\Delta f = 0.5\\ \\mathrm{Hz}$ before and $\\Delta f = 0.125\\ \\mathrm{Hz}$ after, are both correct.\n- The conceptual explanation is entirely correct. It correctly states that padding increases the sampling density (equivalent to interpolation) of the continuous spectrum. It correctly identifies that the mainlobe width is set by the $2\\ \\mathrm{s}$ window and correctly calculates its approximate width as $2/T = 1\\ \\mathrm{Hz}$. It correctly concludes the mainlobe width is unchanged by padding.\n- **Verdict: Correct.**\n\n**B. Before padding: $\\Delta f = 0.5\\ \\mathrm{Hz}$; after padding: $\\Delta f = 0.125\\ \\mathrm{Hz}$. Zero-padding reduces the spectral mainlobe width in proportion to the bin spacing, narrowing it by a factor of $4$.**\n- The calculated bin spacings are correct.\n- The conceptual explanation is incorrect. It conflates frequency-bin spacing with spectral resolution (mainlobe width). Zero-padding does not reduce the mainlobe width.\n- **Verdict: Incorrect.**\n\n**C. Before padding: $\\Delta f = 2\\ \\mathrm{Hz}$; after padding: $\\Delta f = 0.5\\ \\mathrm{Hz}$. Zero-padding does not change the spectral mainlobe because it does not change the data content, only the number of FFT points.**\n- The calculated bin spacings are incorrect. The 'before' spacing is $0.5\\ \\mathrm{Hz}$, not $2\\ \\mathrm{Hz}$. The 'after' spacing is $0.125\\ \\mathrm{Hz}$, not $0.5\\ \\mathrm{Hz}$.\n- While the reasoning about the mainlobe is partially correct, the incorrect numerical values render the option invalid.\n- **Verdict: Incorrect.**\n\n**D. Before padding: $\\Delta f = 0.5\\ \\mathrm{Hz}$; after padding: $\\Delta f = 0.125\\ \\mathrm{Hz}$. Zero-padding widens the spectral mainlobe due to reduced spectral leakage when zero values are appended.**\n- The calculated bin spacings are correct.\n- The conceptual explanation is incorrect. Zero-padding does not widen the spectral mainlobe, nor does it reduce spectral leakage. The leakage pattern is fixed by the window function.\n- **Verdict: Incorrect.**\n\n**E. Before padding: $\\Delta f = 0.5\\ \\mathrm{Hz}$; after padding: $\\Delta f = 0.5\\ \\mathrm{Hz}$. Zero-padding does not change the spectral mainlobe because the analysis window’s duration and type are unchanged, but the bin spacing is also unchanged because the data duration is what sets it.**\n- The 'after' bin spacing is incorrect. It should be $0.125\\ \\mathrm{Hz}$. The reasoning that bin spacing is set by data duration rather than record duration is also incorrect.\n- **Verdict: Incorrect.**\n\nOnly option A provides both the correct numerical values and the correct conceptual explanation based on first principles of Fourier analysis.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "While the STFT uses a fixed window, yielding uniform time-frequency tiling, wavelet analysis offers an adaptive alternative that is particularly powerful for neuroscientific signals. The complex Morlet wavelet, for example, maintains a constant relative bandwidth, providing high temporal resolution at high frequencies and high spectral resolution at low frequencies. This advanced practice moves beyond simply applying a tool to the art of designing one, challenging you to select optimal wavelet parameters based on principled constraints to balance the detection of both rapid high-gamma events and slower theta bursts .",
            "id": "4200814",
            "problem": "You are tasked with designing and implementing a complete program that performs a principled wavelet-based analysis to detect oscillatory events in Local Field Potential (LFP). The detection targets are theta bursts in the range $4$ to $8$ Hz and high-gamma events in the range $70$ to $150$ Hz. Your design must explicitly balance the time-frequency resolution trade-off by choosing the number of wavelet cycles per center frequency, grounded in first principles.\n\nUse the complex Morlet wavelet defined as a sinusoid of center frequency multiplied by a Gaussian in time. Let the wavelet be\n$$\n\\psi(t; f_0, \\sigma_t) = \\exp(2\\pi i f_0 t)\\,\\exp\\!\\left(-\\frac{t^2}{2\\sigma_t^2}\\right),\n$$\nwhere $f_0$ is the center frequency and $\\sigma_t$ is the temporal standard deviation. The Continuous Wavelet Transform is the convolution of the signal with $\\psi(t; f_0, \\sigma_t)$ evaluated at appropriate discrete times. Define the number of cycles $n$ at frequency $f_0$ by the relation\n$$\n\\sigma_t = \\frac{n}{2\\pi f_0}.\n$$\nRely on the properties of the Fourier transform of a Gaussian and the time-frequency uncertainty of Gaussian windows: if $\\sigma_t$ is the temporal standard deviation, then the frequency-domain standard deviation $\\sigma_f$ satisfies\n$$\n\\sigma_f = \\frac{1}{2\\pi \\sigma_t},\n$$\nand the full-width at half-maximum (FWHM) in time and frequency for a Gaussian are\n$$\n\\mathrm{FWHM}_t = 2\\sqrt{2\\ln 2}\\,\\sigma_t,\\quad\n\\mathrm{FWHM}_f = 2\\sqrt{2\\ln 2}\\,\\sigma_f.\n$$\nThese relations are the foundational base you must use to derive all constraints on the wavelet design.\n\nYour program must:\n- Construct a discrete complex Morlet wavelet at a given sampling frequency $f_s$ with a chosen number of cycles $n$ at center frequency $f_0$.\n- Convolve the wavelet with a synthetic LFP time series containing one theta burst and one high-gamma event per test case, each with specified center frequency $f_0$, duration, and amplitude. Add zero-mean Gaussian noise with a specified standard deviation. Time is in seconds and frequencies are in hertz, with sampling frequency specified in hertz.\n- Use an amplitude-threshold detector on the absolute value of the complex wavelet response. Estimate the baseline mean and standard deviation from the first $1$ second of the recording, which contains no events. Declare an event detected if the maximum amplitude within the event’s ground-truth window exceeds baseline mean plus $k$ times baseline standard deviation, with $k=3$.\n- Choose the number of cycles $n$ for theta and high-gamma separately by balancing time and frequency resolution via inequalities derived from the above base. Impose the following design constraints:\n  - Temporal resolution constraint: require $\\mathrm{FWHM}_t$ to be less than or equal to a fraction $r_t$ of the event duration $T$, i.e., $\\mathrm{FWHM}_t \\le r_t\\,T$, with $r_t=0.8$.\n  - Spectral resolution constraint: require $\\mathrm{FWHM}_f$ to be less than or equal to a fraction $r_f$ of the band width $B$ (theta band width $B_\\theta = 8-4 = 4$ Hz; high-gamma band width $B_\\gamma = 150-70 = 80$ Hz), i.e., $\\mathrm{FWHM}_f \\le r_f\\,B$, with $r_f=0.5$.\n- Derive from the base the corresponding bounds on $n$ in terms of $f_0$, $T$, and $B$. If the constraints yield a feasible interval for $n$, select the arithmetic mean of the bounds. If the interval is infeasible, prioritize detectability by choosing the upper bound (which favors temporal resolution) and report the corresponding FWHM values.\n\nSignal construction requirements:\n- Use a total duration of $5$ seconds for each test case.\n- Place the theta burst starting at $t=1.5$ seconds and ending at $t=1.5+T_\\theta$ seconds.\n- Place the high-gamma event starting at $t=3.0$ seconds and ending at $t=3.0+T_\\gamma$ seconds.\n- Build each event as a pure sinusoid of its center frequency within its window, multiplied by its amplitude.\n- Add independent zero-mean Gaussian noise with the specified standard deviation to the entire signal.\n\nUnits:\n- Express time quantities in seconds and frequency quantities in hertz. Your program must compute and output $\\mathrm{FWHM}_t$ in seconds and $\\mathrm{FWHM}_f$ in hertz.\n- The detection outputs must be integers $0$ or $1$.\n\nTest suite:\nProvide computations for all of the following parameter sets. Each tuple is $[f_\\theta, T_\\theta, A_\\theta, f_\\gamma, T_\\gamma, A_\\gamma, \\sigma_n, f_s]$, with $f_\\theta$ the theta center frequency in hertz, $T_\\theta$ the theta duration in seconds, $A_\\theta$ the theta amplitude (arbitrary units), $f_\\gamma$ the gamma center frequency in hertz, $T_\\gamma$ the gamma duration in seconds, $A_\\gamma$ the gamma amplitude (arbitrary units), $\\sigma_n$ the noise standard deviation, and $f_s$ the sampling frequency in hertz:\n- Case $1$: $[6.0, 1.0, 2.0, 100.0, 0.08, 1.5, 0.4, 1000.0]$.\n- Case $2$: $[5.0, 0.6, 1.5, 120.0, 0.02, 1.0, 0.6, 1000.0]$.\n- Case $3$: $[7.0, 0.3, 1.0, 90.0, 0.06, 1.2, 0.7, 1000.0]$.\n\nFinal output format:\nFor each case, output a list with eight entries in the following order:\n$[n_\\theta, n_\\gamma, \\mathrm{FWHM}_{t,\\theta}\\,(\\mathrm{s}), \\mathrm{FWHM}_{f,\\theta}\\,(\\mathrm{Hz}), d_\\theta, \\mathrm{FWHM}_{t,\\gamma}\\,(\\mathrm{s}), \\mathrm{FWHM}_{f,\\gamma}\\,(\\mathrm{Hz}), d_\\gamma]$,\nwhere $d_\\theta$ and $d_\\gamma$ are integers indicating detection ($1$) or non-detection ($0$) for theta and high-gamma respectively.\n\nYour program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, with each test case’s list enclosed in square brackets and no spaces. For example: $[[\\dots],[\\dots],[\\dots]]$.",
            "solution": "The user-provided problem statement is subjected to validation before proceeding to a solution.\n\n### Step 1: Problem Validation\n\nThe problem asks for the design and implementation of a wavelet-based analysis program to detect oscillatory events in synthetic Local Field Potential (LFP) data. The core of the task is to balance the time-frequency resolution trade-off by selecting the number of cycles, $n$, for a complex Morlet wavelet based on principled constraints.\n\nThe givens are:\n- The definition of the complex Morlet wavelet: $\\psi(t; f_0, \\sigma_t) = \\exp(2\\pi i f_0 t)\\,\\exp\\!\\left(-\\frac{t^2}{2\\sigma_t^2}\\right)$.\n- The relationship between the number of cycles $n$, center frequency $f_0$, and temporal standard deviation $\\sigma_t$: $\\sigma_t = \\frac{n}{2\\pi f_0}$.\n- The time-frequency uncertainty relation for a Gaussian window: $\\sigma_f = \\frac{1}{2\\pi \\sigma_t}$.\n- The Full-Width at Half-Maximum (FWHM) expressions: $\\mathrm{FWHM}_t = 2\\sqrt{2\\ln 2}\\,\\sigma_t$ and $\\mathrm{FWHM}_f = 2\\sqrt{2\\ln 2}\\,\\sigma_f$.\n- Design constraints for choosing $n$: $\\mathrm{FWHM}_t \\le r_t\\,T$ and $\\mathrm{FWHM}_f \\le r_f\\,B$, with specified values for $r_t, r_f, T,$ and $B$.\n- A rule for selecting $n$: use the arithmetic mean of the bounds if a feasible range exists, otherwise use a contingency rule.\n- Specific parameters for signal generation, detection, and three test cases.\n\nThe problem is scientifically grounded in standard signal processing theory, well-posed, and objective. It is formalizable, complete, and verifiable. However, a minor but significant logical inconsistency exists within the instructions for choosing $n$ in the case of conflicting constraints. The problem states: \"If the interval is infeasible, prioritize detectability by choosing the upper bound (which favors temporal resolution)\". This statement contains a scientific inaccuracy. The number of cycles $n$ is directly proportional to the temporal standard deviation $\\sigma_t$ (i.e., the wavelet's duration) and inversely proportional to the spectral standard deviation $\\sigma_f$. Therefore, a larger $n$ results in a temporally wider wavelet, which yields *poorer* temporal resolution but *better* spectral resolution. The justification \"(which favors temporal resolution)\" incorrectly describes the consequence of choosing a larger $n$.\n\nThis is a flaw. However, it does not invalidate the entire problem structure, which is otherwise sound. The intent appears to be to prioritize the detection of transient events, for which temporal resolution is critical. Good temporal resolution requires a small $n$. The temporal constraint provides an upper bound on $n$, $n \\le n_{max}$. Satisfying this constraint ensures the wavelet is not too long to resolve the event. Therefore, the instruction to \"choose the upper bound\" is interpreted as choosing $n_{max}$, which satisfies the temporal constraint at its limit. This choice prioritizes temporal resolution at the expense of violating the spectral one. This is a logical interpretation of the goal to \"prioritize detectability\" of potentially short events.\n\n**Verdict:** The problem is deemed **valid**, under the corrective interpretation that in an infeasible scenario ($n_{min} > n_{max}$), the value $n=n_{max}$ is chosen. This satisfies the temporal resolution constraint, which is critical for detection, despite the flawed reasoning provided in the problem statement.\n\n### Step 2: Principled Solution Design\n\nThe solution is developed based on the foundational principles of time-frequency analysis and the specific requirements of the problem.\n\n#### Derivation of Constraints on the Number of Cycles, $n$\n\nThe core of the design is the principled selection of the number of wavelet cycles, $n$. This parameter controls the trade-off between temporal and spectral resolution. We derive the bounds on $n$ from the given constraints.\n\nLet $C_{FWHM} = 2\\sqrt{2\\ln 2}$.\nThe FWHM in time and frequency can be expressed in terms of $n$ and $f_0$:\n$$ \\mathrm{FWHM}_t = C_{FWHM} \\sigma_t = C_{FWHM} \\frac{n}{2\\pi f_0} $$\n$$ \\mathrm{FWHM}_f = C_{FWHM} \\sigma_f = C_{FWHM} \\frac{1}{2\\pi \\sigma_t} = C_{FWHM} \\frac{2\\pi f_0}{2\\pi n} = C_{FWHM} \\frac{f_0}{n} $$\n\n1.  **Temporal Resolution Constraint:** The analysis requires the temporal width of the wavelet to be smaller than the duration of the event to be detected.\n    $$ \\mathrm{FWHM}_t \\le r_t\\,T $$\n    Substituting the expression for $\\mathrm{FWHM}_t$:\n    $$ C_{FWHM} \\frac{n}{2\\pi f_0} \\le r_t\\,T \\implies n \\le \\frac{2\\pi r_t T f_0}{C_{FWHM}} $$\n    This defines the upper bound for $n$: $n_{max} = \\frac{2\\pi r_t T f_0}{2\\sqrt{2\\ln 2}} = \\frac{\\pi r_t T f_0}{\\sqrt{2\\ln 2}}$. A value of $n$ exceeding $n_{max}$ would result in a wavelet too smeared in time to resolve the event of duration $T$.\n\n2.  **Spectral Resolution Constraint:** The analysis requires the spectral width of the wavelet to be narrow enough to distinguish the target frequency band.\n    $$ \\mathrm{FWHM}_f \\le r_f\\,B $$\n    Substituting the expression for $\\mathrm{FWHM}_f$:\n    $$ C_{FWHM} \\frac{f_0}{n} \\le r_f\\,B \\implies n \\ge \\frac{C_{FWHM} f_0}{r_f B} $$\n    This defines the lower bound for $n$: $n_{min} = \\frac{2\\sqrt{2\\ln 2} f_0}{r_f B}$. A value of $n$ below $n_{min}$ would result in a wavelet with a frequency response too broad to isolate the band of interest, $B$.\n\n3.  **Selection Rule for $n$:**\n    - If $n_{min} \\le n_{max}$, a feasible range for $n$ exists. The problem specifies choosing the arithmetic mean: $n = \\frac{n_{min} + n_{max}}{2}$.\n    - If $n_{min} > n_{max}$, the constraints are mutually exclusive. Following our validated interpretation, we prioritize temporal resolution by satisfying its constraint. We choose $n = n_{max}$. This ensures the wavelet is temporally sharp enough, accepting that it will be spectrally broader than desired.\n\n#### Algorithmic Implementation\n\nThe overall process is implemented in a Python program that iterates through the provided test cases.\n\n1.  **Signal Generation:** For each test case, a synthetic $5$-second LFP signal is generated at the specified sampling frequency $f_s$. The signal is the sum of a theta burst, a high-gamma burst, and Gaussian noise.\n    - A time vector $t$ is created from $0$ to $5$ seconds with a step of $1/f_s$.\n    - The signal is initialized with zero-mean Gaussian noise of standard deviation $\\sigma_n$.\n    - The theta burst, a sinusoid of frequency $f_\\theta$ and amplitude $A_\\theta$, is added to the signal in the time interval $[1.5, 1.5+T_\\theta]$.\n    - The high-gamma event, a sinusoid of frequency $f_\\gamma$ and amplitude $A_\\gamma$, is added in the interval $[3.0, 3.0+T_\\gamma]$.\n\n2.  **Wavelet Analysis Loop:** The analysis is performed separately for the theta and high-gamma bands for each signal.\n    - **Parameter Calculation:** For each band (theta/gamma), the corresponding parameters ($f_0, T, B$) are used to calculate $n_{min}$ and $n_{max}$. The value of $n$ is then selected according to the rule above. Subsequently, $\\mathrm{FWHM}_t$ and $\\mathrm{FWHM}_f$ are calculated using the chosen $n$.\n    - **Wavelet Construction:** A discrete complex Morlet wavelet is constructed. The temporal standard deviation $\\sigma_t = n/(2\\pi f_0)$ is calculated. The wavelet kernel is defined over a time window of sufficient length to capture its decay, for instance $\\pm 4\\sigma_t$, centered at $t=0$. The discrete wavelet is computed using the formula $\\psi(t_k) = \\exp(2\\pi i f_0 t_k)\\,\\exp(-t_k^2 / (2\\sigma_t^2))$ for each discrete time point $t_k$ in the kernel window.\n    - **Convolution:** The synthetic LFP signal is convolved with the complex Morlet wavelet. This is efficiently performed using the Fast Fourier Transform (FFT) method, as available in `scipy.signal.convolve`. The `mode='same'` argument ensures the output has the same length as the input signal.\n    - **Amplitude Demodulation:** The instantaneous amplitude of the filtered signal is obtained by taking the absolute value of the complex-valued convolution result.\n\n3.  **Event Detection:** An amplitude thresholding method is applied to detect events.\n    - **Baseline Estimation:** The first second of the amplitude signal, which is known to contain only noise, is used to estimate the baseline activity. The mean $\\mu_{base}$ and standard deviation $\\sigma_{base}$ of this baseline period are computed.\n    - **Thresholding:** The detection threshold is set to $Th = \\mu_{base} + k\\,\\sigma_{base}$, with $k=3$.\n    - **Decision:** The ground-truth time windows for the theta and high-gamma events are identified. An event is marked as detected (output $1$) if the maximum amplitude within its corresponding window exceeds the threshold $Th$. Otherwise, it is marked as not detected (output $0$).\n\n4.  **Output Formatting:** For each test case, the eight required values ($n_\\theta, n_\\gamma, \\mathrm{FWHM}_{t,\\theta}, \\mathrm{FWHM}_{f,\\theta}, d_\\theta, \\mathrm{FWHM}_{t,\\gamma}, \\mathrm{FWHM}_{f,\\gamma}, d_\\gamma$) are aggregated into a list. The results for all test cases are then formatted into a single string representing a list of lists, with no extraneous spaces, as per the specification.\n\nThis principled and systematic approach ensures that the analysis correctly balances the time-frequency trade-off according to the problem's constraints and provides a robust method for event detection.",
            "answer": "```python\nimport numpy as np\nimport scipy.signal\n\ndef solve():\n    \"\"\"\n    Main function to run wavelet analysis on all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # [f_theta, T_theta, A_theta, f_gamma, T_gamma, A_gamma, sigma_n, f_s]\n        [6.0, 1.0, 2.0, 100.0, 0.08, 1.5, 0.4, 1000.0],\n        [5.0, 0.6, 1.5, 120.0, 0.02, 1.0, 0.6, 1000.0],\n        [7.0, 0.3, 1.0, 90.0, 0.06, 1.2, 0.7, 1000.0],\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        f_theta, T_theta, A_theta, f_gamma, T_gamma, A_gamma, sigma_n, f_s = case\n        \n        # --- Signal Generation ---\n        total_duration = 5.0\n        t = np.arange(0, total_duration, 1.0 / f_s)\n        n_points = len(t)\n        \n        # Additive Gaussian noise\n        rng = np.random.default_rng(seed=42) # for reproducibility\n        signal = rng.normal(loc=0.0, scale=sigma_n, size=n_points)\n\n        # Add Theta burst\n        theta_start_t = 1.5\n        theta_start_idx = int(theta_start_t * f_s)\n        theta_end_idx = int((theta_start_t + T_theta) * f_s)\n        theta_t = t[theta_start_idx:theta_end_idx]\n        signal[theta_start_idx:theta_end_idx] += A_theta * np.sin(2 * np.pi * f_theta * theta_t)\n\n        # Add High-Gamma event\n        gamma_start_t = 3.0\n        gamma_start_idx = int(gamma_start_t * f_s)\n        gamma_end_idx = int((gamma_start_t + T_gamma) * f_s)\n        gamma_t = t[gamma_start_idx:gamma_end_idx]\n        signal[gamma_start_idx:gamma_end_idx] += A_gamma * np.sin(2 * np.pi * f_gamma * gamma_t)\n\n        # --- Analysis ---\n        B_theta = 4.0  # 8 - 4 Hz\n        B_gamma = 80.0 # 150 - 70 Hz\n\n        # Analyze Theta band\n        n_theta, fwhm_t_theta, fwhm_f_theta, d_theta = analyze_band(\n            signal, f_s, f_theta, T_theta, theta_start_idx, theta_end_idx, B_theta\n        )\n        \n        # Analyze Gamma band\n        n_gamma, fwhm_t_gamma, fwhm_f_gamma, d_gamma = analyze_band(\n            signal, f_s, f_gamma, T_gamma, gamma_start_idx, gamma_end_idx, B_gamma\n        )\n\n        case_result = [\n            n_theta, n_gamma, fwhm_t_theta, fwhm_f_theta, d_theta,\n            fwhm_t_gamma, fwhm_f_gamma, d_gamma\n        ]\n        all_results.append(case_result)\n\n    # Format the final output string to be a list of lists with no spaces.\n    results_str = [str(r).replace(\" \", \"\") for r in all_results]\n    print(f\"[{','.join(results_str)}]\")\n\n\ndef analyze_band(signal, f_s, f0, T, event_start_idx, event_end_idx, B):\n    \"\"\"\n    Performs wavelet analysis for a single frequency band.\n    \n    Returns:\n        tuple: (n, fwhm_t, fwhm_f, detection_flag)\n    \"\"\"\n    r_t = 0.8\n    r_f = 0.5\n    fwhm_const = 2 * np.sqrt(2 * np.log(2))\n\n    # --- Calculate n ---\n    # Temporal constraint gives n_max\n    n_max = (np.pi * r_t * T * f0) / np.sqrt(2 * np.log(2))\n    \n    # Spectral constraint gives n_min\n    n_min = (fwhm_const * f0) / (r_f * B)\n    \n    if n_min > n_max:\n        # Infeasible interval: prioritize temporal resolution by choosing n_max\n        n = n_max\n    else:\n        # Feasible interval: choose the arithmetic mean\n        n = (n_min + n_max) / 2.0\n\n    # --- Calculate FWHM values ---\n    sigma_t = n / (2 * np.pi * f0)\n    sigma_f = f0 / n\n    fwhm_t = fwhm_const * sigma_t\n    fwhm_f = fwhm_const * sigma_f\n\n    # --- Create Wavelet ---\n    # Kernel length chosen to be +/- 4 standard deviations\n    wavelet_half_len_s = 4 * sigma_t\n    wavelet_half_len_pts = int(np.ceil(wavelet_half_len_s * f_s))\n    wavelet_t = np.arange(-wavelet_half_len_pts, wavelet_half_len_pts + 1) / f_s\n    \n    gaussian_win = np.exp(-(wavelet_t**2) / (2 * sigma_t**2))\n    sinusoid = np.exp(1j * 2 * np.pi * f0 * wavelet_t)\n    wavelet = sinusoid * gaussian_win\n\n    # --- Convolution ---\n    # Use FFT-based convolution for efficiency\n    conv_result = scipy.signal.convolve(signal, wavelet, mode='same', method='fft')\n    analytic_amplitude = np.abs(conv_result)\n    \n    # --- Event Detection ---\n    # Baseline from first 1 second\n    baseline_pts = int(1.0 * f_s)\n    baseline_activity = analytic_amplitude[:baseline_pts]\n    baseline_mean = np.mean(baseline_activity)\n    baseline_std = np.std(baseline_activity)\n    \n    k = 3.0\n    threshold = baseline_mean + k * baseline_std\n    \n    # Check if max amplitude in event window exceeds threshold\n    max_event_amplitude = np.max(analytic_amplitude[event_start_idx:event_end_idx])\n    \n    detection_flag = 1 if max_event_amplitude > threshold else 0\n    \n    return n, fwhm_t, fwhm_f, detection_flag\n    \n\nif __name__ == '__main__':\n    solve()\n\n```"
        }
    ]
}