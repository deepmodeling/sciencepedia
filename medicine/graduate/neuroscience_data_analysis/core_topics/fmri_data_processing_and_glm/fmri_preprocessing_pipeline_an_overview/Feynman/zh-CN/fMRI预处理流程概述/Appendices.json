{
    "hands_on_practices": [
        {
            "introduction": "功能磁共振成像（fMRI）全脑扫描并非瞬时完成，不同脑片（slice）的采集时间存在微小差异。这项练习将指导你根据扫描仪的采集序列参数，精确计算每个脑片的采集时间，这是进行切片时间校正（slice timing correction）的关键一步，对于事件相关（event-related）设计尤为重要。",
            "id": "4163858",
            "problem": "一位研究人员正在将医学数字成像和通信 (DICOM) 格式的功能性磁共振成像 (fMRI) 数据转换为神经影像信息技术倡议 (NIfTI) 格式。数据是使用回波平面成像 (EPI) 采集的，采用交错升序的切片采集方式，单带（无同步多层采集），并且在整个重复时间内每个切片的采集间隔是恒定的。扫描仪日志显示了以下的采集模式：在每个容积内，首先按升序采集偶数索引的切片，然后按升序采集奇数索引的切片。考虑生成的 NIfTI 容积，其切片编号从 $0$（最下层）到 $N-1$（最上层）进行索引。假设血氧水平依赖 (BOLD) 信号在每个重复时间内采样一次，但带有与切片相关的偏移量，并且总的切片采集时间跨越了整个重复时间。\n\n已知：\n- 重复时间 $T_R = 1.6$ 秒。\n- 切片数量 $N = 16$。\n- 交错升序顺序：在每个容积内为 $\\{0, 2, 4, \\dots, 14, 1, 3, 5, \\dots, 15\\}$。\n\n任务：\n1. 计算长度为 $N$ 的 NIfTI SliceTiming 向量（单位：秒），该向量按切片索引从 $0$ 到 $N-1$ 排序，其中第 $i$ 个条目是切片 $i$ 相对于容积开始的采集时间偏移量（单位：秒）。\n2. 从离散时间采样的定义和傅里叶变换的时移特性出发，简要解释切片时间校正算法如何使用此向量将每个切片的时间序列重采样到一个共同的参考时间。",
            "solution": "该问题是有效的，因为它具有科学依据、问题设定良好、客观，并包含充分、一致的信息以推导出唯一解。所述场景是功能性磁共振成像 (fMRI) 数据预处理中的一个标准程序。\n\n总体任务是首先计算给定 fMRI 采集方案的切片采集时间，然后解释切片时间校正的理论基础。\n\n**第1部分：计算 SliceTiming 向量**\n\n问题指明，在一个重复时间 $T_R = 1.6$ 秒内采集 $N=16$ 个切片。采集过程跨越整个重复时间，且每个切片的采集间隔恒定。这意味着在采集序列中任何两个连续采集的切片之间的时间间隔是恒定的。这个时间间隔 $\\Delta t$ 可以计算如下：\n$$\n\\Delta t = \\frac{T_R}{N} = \\frac{1.6 \\, \\text{s}}{16} = 0.1 \\, \\text{s}\n$$\n采集顺序被指定为交错升序，即先采集所有偶数索引的切片，然后采集所有奇数索引的切片。切片索引范围为 $0$ 到 $N-1 = 15$。因此，按时间排序的明确采集序列为：\n$$\n\\{0, 2, 4, 6, 8, 10, 12, 14, 1, 3, 5, 7, 9, 11, 13, 15\\}\n$$\n给定切片的采集时间由其在此序列中的位置决定。设序列中的时间位置用 $p$ 表示，其中 $p$ 的范围从 $0$ 到 $N-1 = 15$。在时间位置 $p$ 采集的切片的采集时间偏移量为 $p \\times \\Delta t$。\n\n我们需要找到每个切片的采集时间，并按切片索引 $i$ 从 $0$ 到 $15$ 排序。设 $t_i$ 为索引为 $i$ 的切片的采集时间。\n\n对于偶数索引的切片，$i = 2k$，其中 $k \\in \\{0, 1, \\dots, 7\\}$：\n索引为 $i=2k$ 的切片是第 $(k+1)$ 个被采集的切片。其时间位置为 $p=k$。\n因此，其采集时间为：\n$$\nt_{2k} = k \\times \\Delta t = k \\times 0.1 \\, \\text{s}\n$$\n\n对于奇数索引的切片，$i = 2k+1$，其中 $k \\in \\{0, 1, \\dots, 7\\}$：\n这些切片在所有 $N/2=8$ 个偶数切片采集完毕后进行采集。序列中的第一个奇数切片是索引 $1$（对应于 $k=0$），其时间位置为 $p=8$。索引为 $i=2k+1$ 的奇数切片是第 $(k+1)$ 个被采集的奇数切片。其在整个序列中的时间位置为 $p = (N/2) + k = 8 + k$。\n因此，其采集时间为：\n$$\nt_{2k+1} = (8+k) \\times \\Delta t = (8+k) \\times 0.1 \\, \\text{s}\n$$\n\n使用这些公式，我们可以计算出每个切片索引 $i \\in \\{0, 1, \\dots, 15\\}$ 的时间：\n$t_0 = 0 \\times 0.1 = 0.0$ s\n$t_1 = (8+0) \\times 0.1 = 0.8$ s\n$t_2 = 1 \\times 0.1 = 0.1$ s\n$t_3 = (8+1) \\times 0.1 = 0.9$ s\n$t_4 = 2 \\times 0.1 = 0.2$ s\n$t_5 = (8+2) \\times 0.1 = 1.0$ s\n$t_6 = 3 \\times 0.1 = 0.3$ s\n$t_7 = (8+3) \\times 0.1 = 1.1$ s\n$t_8 = 4 \\times 0.1 = 0.4$ s\n$t_9 = (8+4) \\times 0.1 = 1.2$ s\n$t_{10} = 5 \\times 0.1 = 0.5$ s\n$t_{11} = (8+5) \\times 0.1 = 1.3$ s\n$t_{12} = 6 \\times 0.1 = 0.6$ s\n$t_{13} = (8+6) \\times 0.1 = 1.4$ s\n$t_{14} = 7 \\times 0.1 = 0.7$ s\n$t_{15} = (8+7) \\times 0.1 = 1.5$ s\n\nNIfTI SliceTiming 向量是这些采集时间的列表，按切片索引从 $0$ 到 $15$ 排序。\n\n**第2部分：切片时间校正的原理**\n\n上面计算出的 SliceTiming 向量提供了每个切片 $i$ 相对于容积采集开始的时间偏移量 $t_i$。切片时间校正 (STC) 算法使用此信息将每个切片的时间序列重采样到一个共同的参考时间，从而减轻后续分析（例如，事件相关分析）中因假设一个容积内的所有数据都是同时采集而产生的伪影。\n\nSTC 的基本原理植根于离散时间采样和傅里叶变换的时移特性。对于任何给定的体素，BOLD 信号是时间的连续函数 $s(t)$。对于切片 $i$ 中的一个体素，该信号在对应于每次容积采集的离散时间点进行采样，但带有一个偏移量 $t_i$。因此，切片 $i$ 中一个体素在 $M$ 个容积内采样的时间序列为 $x_i[k] = s(k T_R + t_i)$，其中 $k=0, 1, \\dots, M-1$。\n\nSTC 的目标是估算所有切片在同一共同参考时间采集的信号值。设此参考时间为相对于容积开始的一个偏移量 $t_{\\text{ref}}$（例如，对于第一个切片，$t_{\\text{ref}}=0$；或者对于采集窗口的中间点，$t_{\\text{ref}}=T_R/2$）。我们希望找到值 $x_i^{\\text{corr}}[k] = s(k T_R + t_{\\text{ref}})$。这等效于将原始连续信号 $s(t)$ 平移一个时间量 $\\Delta t_i = t_{\\text{ref}} - t_i$。\n\n连续傅里叶变换的时移特性指出，如果信号 $f(t)$ 的傅里叶变换为 $F(\\omega)$，则时移后的信号 $f(t - \\tau)$ 的傅里叶变换为 $F(\\omega) \\exp(-j\\omega\\tau)$。此特性提供了一种执行非整数时间平移的直接方法，这对于 STC 来说通常是必需的，因为所需的平移量 $\\Delta t_i$ 不一定是采样间隔 $T_R$ 的整数倍。\n\nSTC 算法按以下步骤进行：\n1. 对于每个体素的时间序列 $x_i[k]$，计算其离散傅里叶变换 (DFT)，得到频域表示 $X_i[m]$，其中 $m$ 是频率指数。\n2. 对每个频率分量 $m$ 应用一个相位移。为了将信号在时间上平移 $\\Delta t_i = t_{\\text{ref}} - t_i$，将复数值 $X_i[m]$ 乘以一个相位因子 $\\exp(-j \\omega_m \\Delta t_i)$，其中 $\\omega_m = \\frac{2\\pi m}{M T_R}$ 是对应于索引 $m$ 的角频率。校正后的频域信号为 $X_i^{\\text{corr}}[m] = X_i[m] \\exp\\left(-j \\frac{2\\pi m}{M T_R} \\Delta t_i\\right)$。\n3. 计算 $X_i^{\\text{corr}}[m]$ 的离散傅里叶逆变换 (IDFT)，以获得校正后的时域信号 $x_i^{\\text{corr}}[k]$。这个新的时间序列代表了重采样到共同参考时间 $t_{\\text{ref}}$ 的 BOLD 信号。\n\n这种基于傅里叶的插值在理论上等同于在时域中与 sinc 函数进行卷积，这是对带限信号进行重采样的理想方法。因此，SliceTiming 向量是指定每个切片所需平移量 $\\Delta t_i$ 的关键输入。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.0  0.8  0.1  0.9  0.2  1.0  0.3  1.1  0.4  1.2  0.5  1.3  0.6  1.4  0.7  1.5 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在处理了时间伪影后，我们转向由磁场不均匀性引起的空间扭曲问题。此练习深入探讨了回波平面成像（EPI）序列中磁敏感伪影的物理原理，并将其与脑影像数据结构（BIDS）标准中的关键参数联系起来。你将学习如何计算总读出时间（$T_{\\mathrm{ro}}$），并利用它来量化由场偏置引起的体素空间位移，这是磁敏感畸变校正的核心环节。",
            "id": "4163811",
            "problem": "一位研究人员正在使用脑成像数据结构 (Brain Imaging Data Structure, BIDS) 准备一个功能性磁共振成像 (functional Magnetic Resonance Imaging, fMRI) 数据集，用于磁敏感性伪影校正。该序列是二维回波平面成像 (Echo Planar Imaging, EPI)，单个运行的 DICOM (Digital Imaging and Communications in Medicine) 头文件包含以下字段：\n\n- InPlanePhaseEncodingDirection = \"COL\"\n- 供应商特定的布尔字段，指示沿相位编码轴的 blip 极性（负）\n- ImageOrientationPatient 方向余弦：对于轴向采集，行为 $(1, 0, 0)$，列为 $(0, 1, 0)$，层为 $(0, 0, 1)$\n- EffectiveEchoSpacing $t_{\\mathrm{esp}} = 5.8 \\times 10^{-4}$ s\n- ReconMatrixPE $N_{\\mathrm{PE}} = 96$\n- 沿相位编码方向的体素大小 $\\Delta y = 2.0$ mm\n\n假设已使用标准的右-前-上 (Right-Anterior-Superior, RAS) 约定转换为神经影像信息学技术倡议 (Neuroimaging Informatics Technology Initiative, NIfTI) 格式，其中体素索引轴 $(i, j, k)$ 分别对应于左-右、后-前和下-上方向。研究人员还有一个独立估计的离共振图，提供了由静磁场不均匀性引起的局部频率偏移 $\\Delta f$（单位为赫兹）。\n\n从 EPI k 空间采样和磁共振离共振物理学的第一性原理出发，并仅使用上述信息：\n\n1. 以 EffectiveEchoSpacing $t_{\\mathrm{esp}}$ 和相位编码采样数 $N_{\\mathrm{PE}}$ 为变量，推导 BIDS 字段 TotalReadoutTime $T_{\\mathrm{ro}}$ 的表达式。\n2. 使用傅里叶位移定理和信号模型中离共振频率 $\\Delta f$ 作为恒定附加角频率的定义，推导 $\\Delta f$、$T_{\\mathrm{ro}}$ 与沿相位编码方向的位移（以体素为单位，然后以毫米为单位）之间的关系。\n3. 使用提供的 DICOM 字段和方向，定性地论证 BIDS PhaseEncodingDirection 值的合理性（无需报告该值；只需用它来确定发生位移的轴），并解释为什么 $T_{\\mathrm{ro}}$ 和 PhaseEncodingDirection 对于从 $\\Delta f$ 估计磁敏感性引起的位移大小是必要且充分的。\n4. 对于一个 $\\Delta f = 120$ Hz 的体素，使用推导出的表达式和提供的参数，计算沿相位编码方向的位移大小（以毫米为单位）。将最终数值答案四舍五入到四位有效数字。以毫米表示最终位移。",
            "solution": "问题陈述具有科学依据，表述清晰，并包含足够且一致的信息来推导所需的关系并计算最终的数值答案。所有提供的参数对于 fMRI 中的回波平面成像 (EPI) 序列都是物理上现实的。因此，该问题是有效的，可以制定解决方案。\n\n解决方案的结构旨在按顺序解决问题的四个部分。\n\n## 1. TotalReadoutTime ($T_{\\mathrm{ro}}$) 的推导\n\n`TotalReadoutTime`（记作 $T_{\\mathrm{ro}}$）是 BIDS 标准中描述磁敏感性失真的一个关键参数。它被定义为在 EPI 回波链中，从采集第一个回波中心到最后一个回波中心所经过的时间。\n\n`EffectiveEchoSpacing`（记作 $t_{\\mathrm{esp}}$）表示在相位编码方向上两个连续回波中心之间的时间。对于 2D EPI 序列，这是 k 空间中采样连续行之间的时间。\n\n`ReconMatrixPE`（记作 $N_{\\mathrm{PE}}$）给出了相位编码的总步数，这对应于为在该维度上形成图像而采集的 k 空间行数。\n\n如果有 $N_{\\mathrm{PE}}$ 个回波（或 k 空间行），它们之间就有 $N_{\\mathrm{PE}} - 1$ 个间隔。由于每个间隔的持续时间为 $t_{\\mathrm{esp}}$，因此从第一个回波到最后一个回波的总时间是间隔数与每个间隔持续时间的乘积。\n\n因此，`TotalReadoutTime` 的表达式为：\n$$T_{\\mathrm{ro}} = (N_{\\mathrm{PE}} - 1) \\times t_{\\mathrm{esp}}$$\n\n## 2. 位移关系的推导\n\nEPI 中的磁敏感性引起的失真是由局部磁场不均匀性引起的，通过离共振频率 $\\Delta f$ 来量化。这种离共振会在测量的磁共振信号中引起一个随时间变化的相位误差。在存在离共振 $\\Delta f$ 的情况下，位于位置 $\\vec{r}$、自旋密度为 $\\rho(\\vec{r})$ 的自旋所产生的信号 $S$ 会被一个相位项 $\\exp(-i 2\\pi \\Delta f t)$ 调制：\n$$S(t) \\propto \\rho(\\vec{r}) \\exp(-i \\phi_{\\text{spatial}}(t)) \\exp(-i 2\\pi \\Delta f t)$$\n其中 $\\phi_{\\text{spatial}}(t)$ 是由成像梯度赋予的相位。\n\n在 EPI 中，k 空间是逐行遍历的。设相位编码方向为 $y$ 轴。采集某条 k 空间行的时间 $t$ 与其沿相位编码轴的位置 $k_y$ 成线性比例关系。因此，由 $\\Delta f$ 引起的相位误差表现为沿 k 空间中 $k_y$ 方向添加的一个线性相位斜坡。\n\n根据傅里叶位移定理，频域（k 空间）中的线性相移对应于图像域中的空间位移。具体来说，如果函数 $f(y)$ 的傅里叶变换是 $F(k_y)$，那么函数 $f(y-y_0)$ 的傅里叶变换是 $F(k_y) \\exp(-i k_y y_0)$。\n\n离共振项 $\\exp(-i 2\\pi \\Delta f t)$ 可以在此背景下解释。时间 $t$ 与 $k_y$ 相关联。在相位编码方向的整个采集过程中（总时间为 $T_{\\mathrm{ro}}$），k 空间被采样。我们可以定义相位编码方向上的“每像素带宽”，即 $BW_{\\mathrm{PE}}$。这是对应于一个体素宽度的频率范围。$BW_{\\mathrm{PE}}$ 是执行相位编码的总时间的倒数，即 `TotalReadoutTime`：\n$$BW_{\\mathrm{PE}} = \\frac{1}{T_{\\mathrm{ro}}} = \\frac{1}{(N_{\\mathrm{PE}} - 1) t_{\\mathrm{esp}}}$$\n离共振频率 $\\Delta f$ 被重建算法误解为一个位移。这个位移的大小，以体素为单位（$\\delta_{\\mathrm{vxl}}$），是离共振频率与该方向上每像素带宽的比值：\n$$\\delta_{\\mathrm{vxl}} = \\frac{\\Delta f}{BW_{\\mathrm{PE}}}$$\n代入 $BW_{\\mathrm{PE}}$ 的表达式，我们得到以体素为单位的位移：\n$$\\delta_{\\mathrm{vxl}} = \\Delta f \\cdot T_{\\mathrm{ro}} = \\Delta f \\cdot (N_{\\mathrm{PE}} - 1) t_{\\mathrm{esp}}$$\n要将这个位移从体素单位转换为物理单位（如毫米），我们乘以沿相位编码方向的体素大小 $\\Delta y$：\n$$\\delta_{\\mathrm{mm}} = \\delta_{\\mathrm{vxl}} \\cdot \\Delta y = \\Delta f \\cdot T_{\\mathrm{ro}} \\cdot \\Delta y$$\n这就是离共振频率 $\\Delta f$、总读出时间 $T_{\\mathrm{ro}}$ 与最终产生的空间位移（以毫米为单位）之间的基本关系。\n\n## 3. BIDS 字段 `PhaseEncodingDirection` 和 `TotalReadoutTime` 的合理性论证\n\n问题陈述指出 DICOM 字段 `InPlanePhaseEncodingDirection` 是 `\"COL\"`。对于 2D 采集，这意味着相位编码是沿着图像矩阵的列方向进行的。对于轴向采集，`ImageOrientationPatient` 的方向余弦给出为行 $(1, 0, 0)$ 和列 $(0, 1, 0)$。在标准的 NIfTI RAS (右-前-上) 坐标系中，图像矩阵轴 $(i, j, k)$ 通常分别对应于左-右 (L-R)、后-前 (P-A) 和下-上 (I-S) 的解剖方向。矩阵的列对应于第二个维度，即 $j$ 轴。因此，相位编码是沿着 NIfTI 的 $j$ 轴进行的，该轴与患者的后-前 (P-A) 轴对齐。这证明了 BIDS 的 `PhaseEncodingDirection` 应为 `j` 或 `j-` 是合理的（符号取决于 blip 极性，题目中给出为负，意味着方向是 `j-`，尽管问题并不要求报告此值）。\n\n对于估计位移大小而言，`PhaseEncodingDirection` 和 `TotalReadoutTime` 的必要性和充分性解释如下：\n\n- **`PhaseEncodingDirection` 的必要性**：磁敏感性引起的 EPI 失真这一物理现象导致像素位移*仅*沿着相位编码方向发生。这是因为由 $\\Delta f$ 引起的相位误差是在对相位编码方向上不同 k 空间行进行采样的相对较长的时间内累积的。读出方向的采样速度要快得多，因此随时间变化的相位误差可以忽略不计。因此，要对此失真进行建模或校正，必须知道位移发生的轴。`PhaseEncodingDirection` 提供了这一关键信息。\n\n- **`TotalReadoutTime` 的必要性**：如第 2 部分所推导，位移的大小（以体素为单位）与 $T_{\\mathrm{ro}}$ 成正比。此参数量化了离共振相位误差累积的总时间窗口，这些误差随后在图像重建过程中通过傅里叶变换被混叠成空间错位。如果没有 $T_{\\mathrm{ro}}$，从给定的离共振频率 $\\Delta f$ 到空间位移大小的映射将无法确定。\n\n- **充分性**：为了*估计位移大小*，这两个参数是充分的。给定一个为每个体素提供 $\\Delta f$ 的离共振图，`PhaseEncodingDirection` 确定了位移的轴（例如，P-A 轴），而 `TotalReadoutTime` 允许使用公式 $\\delta_{\\mathrm{vxl}} = \\Delta f \\cdot T_{\\mathrm{ro}}$ 计算沿该轴的位移大小。这就提供了一个完整的体素位移图，这是进行失真校正的基础。\n\n## 4. 位移大小的计算\n\n我们被要求计算具有特定离共振频率的体素的位移大小（以毫米为单位）。\n\n给定的参数是：\n- 离共振频率，$\\Delta f = 120$ Hz\n- 有效回波间距， $t_{\\mathrm{esp}} = 5.8 \\times 10^{-4}$ s\n- 相位编码步数， $N_{\\mathrm{PE}} = 96$\n- 沿相位编码方向的体素大小，$\\Delta y = 2.0$ mm\n\n首先，我们计算 `TotalReadoutTime`，$T_{\\mathrm{ro}}$：\n$$T_{\\mathrm{ro}} = (N_{\\mathrm{PE}} - 1) t_{\\mathrm{esp}} = (96 - 1) \\times (5.8 \\times 10^{-4} \\text{ s}) = 95 \\times 5.8 \\times 10^{-4} \\text{ s} = 0.0551 \\text{ s}$$\n接下来，我们使用推导的关系来计算以毫米为单位的位移大小，$\\delta_{\\mathrm{mm}}$：\n$$\\delta_{\\mathrm{mm}} = \\Delta f \\cdot T_{\\mathrm{ro}} \\cdot \\Delta y$$\n代入数值：\n$$\\delta_{\\mathrm{mm}} = (120 \\text{ Hz}) \\cdot (0.0551 \\text{ s}) \\cdot (2.0 \\text{ mm})$$\nHz（即 $s^{-1}$）与 $s$ 的乘积产生一个无量纲量，表示以体素为单位的位移：\n$$\\delta_{\\mathrm{vxl}} = 120 \\times 0.0551 = 6.612$$\n那么，以毫米为单位的位移是：\n$$\\delta_{\\mathrm{mm}} = 6.612 \\times 2.0 \\text{ mm} = 13.224 \\text{ mm}$$\n问题要求将最终答案四舍五入到四位有效数字。\n$$\\delta_{\\mathrm{mm}} \\approx 13.22 \\text{ mm}$$\n这表示一个超过 $1.3$ 厘米的显著空间失真，这对于具有高磁敏感性梯度和较大离共振的区域来说是一个现实的数值。",
            "answer": "$$ \\boxed{13.22} $$"
        },
        {
            "introduction": "最后，我们来处理fMRI数据中常见的非生理噪声，例如会污染血氧水平依赖（BOLD）信号的低频扫描仪漂移。本练习将演示如何利用离散余弦变换（DCT）基函数构建高通滤波器，这是一种在通用线性模型（GLM）框架内移除此类漂移的标准技术。你将学习如何将DCT基函数的数学属性与其时间周期相关联，并确定在统计分析中应包含哪些基函数作为干扰回归量。",
            "id": "4163890",
            "problem": "一次功能性磁共振成像 (fMRI) 扫描包含 $N=750$ 个脑体层，采样重复时间 $TR=0.8$ 秒，因此总采集时长为 $T=N \\cdot TR$。为了在广义线性模型 (GLM) 的预处理过程中去除低频漂移，通过引入一组时间周期大于或等于指定截止值 $128$ 秒的正交归一余弦基函数，构建了一个基于离散余弦变换 (DCT) 的高通滤波器。\n\n从第一性原理出发，使用II型离散余弦变换 (DCT-II) 在 $n \\in \\{0,1,\\dots,N-1\\}$ 上的基本定义以及离散时间下的正交归一性要求，推导整数模式索引 $k \\geq 0$ 的归一化滤波器系数（基列向量）$b_{k}[n]$。将整数索引 $k$ 与 $b_{k}[n]$ 在时长为 $T$ 的观测窗口内的隐含时间周期 $P_{k}$ 联系起来，并确定满足 $P_{K} \\geq 128$ 秒的最大整数 $K$。解释将 $\\{b_{k}[n]\\}_{k=0}^{K}$ 作为干扰回归量如何在 GLM 预处理流程中实现高通滤波，并阐明其投影解释。\n\n将最终答案表示为 $K$ 的整数值。无需四舍五入。在最终答案框中不提供单位。",
            "solution": "该问题要求使用离散余弦变换 (DCT) 推导用于 fMRI 分析的高通滤波回归量，根据指定的周期截止值确定此类回归量的数量，并解释在广义线性模型 (GLM) 框架下的滤波机制。\n\n首先，我们验证问题陈述的有效性。\n\n### 步骤 1：提取已知条件\n- 脑体层数（时间点数）：$N=750$。\n- 重复时间：$TR=0.8$ 秒。\n- 总采集时长：$T = N \\cdot TR$。\n- 滤波方法：使用一组 DCT 基函数进行高通滤波。\n- 周期截止值：所包含的基函数的时间周期必须大于或等于 $128$ 秒。\n- DCT 类型：II型离散余弦变换 (DCT-II)。\n- 时间索引：$n \\in \\{0, 1, \\dots, N-1\\}$。\n- 基函数表示法：$b_k[n]$，其中整数模式索引 $k \\geq 0$。\n- 要求输出：归一化的 $b_k[n]$ 的推导，索引 $k$ 与周期 $P_k$ 之间的关系，干扰集 $\\{b_k[n]\\}_{k=0}^{K}$ 的最大整数 $K$，以及滤波机制的解释。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，描述了 fMRI 预处理中的一种标准且广泛使用的技术（即在 GLM 中通过干扰回归实现高通滤波，正如在 SPM 等软件中所实现的那样）。所有术语都是信号处理和神经科学领域的标准术语。该问题是适定的，提供了计算 $K$ 的唯一整数解所需的所有参数（$N$、$TR$、截止周期）。语言客观且精确。该问题有效。\n\n### 步骤 3：推导与求解\n\n**1. 正交归一的 DCT-II 基函数**\n\n长度为 $N$ 的序列 $x[n]$ 的 II 型离散余弦变换由其基函数定义。未归一化的基函数，即 DCT-II 矩阵的列向量，由下式给出：\n$$c_k[n] = \\cos\\left[\\frac{\\pi k}{N}\\left(n + \\frac{1}{2}\\right)\\right]$$\n其中离散时间索引为 $n \\in \\{0, 1, \\dots, N-1\\}$，频率索引为 $k \\in \\{0, 1, \\dots, N-1\\}$。\n\n为了用作正交归一回归量，这些基函数必须被归一化，使其内积满足 $\\sum_{n=0}^{N-1} b_k[n] b_j[n] = \\delta_{kj}$，其中 $\\delta_{kj}$ 是克罗内克 δ。这需要将每个向量 $c_k$ 除以其欧几里得范数 $\\|c_k\\| = \\sqrt{\\sum_{n=0}^{N-1} (c_k[n])^2}$ 来进行归一化。\n\n对于 $k=0$ 的情况：\n$$c_0[n] = \\cos(0) = 1$$\n范数的平方为：\n$$\\|c_0\\|^2 = \\sum_{n=0}^{N-1} 1^2 = N$$\n归一化常数为 $1/\\sqrt{N}$。\n\n对于 $k \\in \\{1, 2, \\dots, N-1\\}$ 的情况：\n范数的平方为：\n$$\\|c_k\\|^2 = \\sum_{n=0}^{N-1} \\cos^2\\left[\\frac{\\pi k}{N}\\left(n + \\frac{1}{2}\\right)\\right]$$\n使用恒等式 $\\cos^2(\\theta) = \\frac{1}{2}(1 + \\cos(2\\theta))$：\n$$\\|c_k\\|^2 = \\sum_{n=0}^{N-1} \\frac{1}{2}\\left(1 + \\cos\\left[\\frac{2\\pi k}{N}\\left(n + \\frac{1}{2}\\right)\\right]\\right) = \\frac{N}{2} + \\frac{1}{2}\\sum_{n=0}^{N-1}\\cos\\left(\\frac{2\\pi k n}{N} + \\frac{\\pi k}{N}\\right)$$\n求和项是一个复指数等比级数的实部，对于 $1 \\le k  N$，其和为零。因此：\n$$\\|c_k\\|^2 = \\frac{N}{2}$$\n归一化常数为 $\\sqrt{2/N}$。\n\n因此，正交归一的 DCT-II 基函数 $b_k[n]$ 为：\n$$\nb_k[n] = \\begin{cases}\n\\sqrt{\\frac{1}{N}}  \\text{for } k=0 \\\\\n\\sqrt{\\frac{2}{N}} \\cos\\left[\\frac{\\pi k}{N}\\left(n + \\frac{1}{2}\\right)\\right]  \\text{for } k \\in \\{1, 2, \\dots, N-1\\}\n\\end{cases}\n$$\n\n**2. 索引 $k$ 与时间周期 $P_k$ 之间的关系**\n\n对于 $k0$，$b_k[n]$ 是一个采样余弦波。其“数字”角频率为 $\\Omega_k = \\frac{\\pi k}{N}$ 弧度/样本。样本之间的物理时间是重复时间 $TR$。连续时间角频率 $\\omega_k$ 与数字频率的关系为 $\\omega_k = \\Omega_k / TR$。\n$$\\omega_k = \\frac{\\pi k}{N \\cdot TR}$$\n时间周期 $P_k$ 与角频率的关系为 $P_k = 2\\pi / \\omega_k$。\n$$P_k = \\frac{2\\pi}{\\left(\\frac{\\pi k}{N \\cdot TR}\\right)} = \\frac{2 N \\cdot TR}{k}$$\nfMRI 扫描的总时长为 $T = N \\cdot TR$。将此代入 $P_k$ 的表达式中：\n$$P_k = \\frac{2T}{k}$$\n该公式表明，索引为 $k$ 的基函数在总采集时间 $T$ 内完成 $k/2$ 个周期。对于 $k=1$，周期为 $P_1 = 2T$，对应于在该区间内的半个余弦周期。对于 $k=0$，基函数是一个常数（直流分量），其周期形式上是无限的，$P_0 = \\infty$。\n\n**3. 确定最大整数 $K$**\n\n我们已知的参数为：\n$N=750$\n$TR=0.8$ 秒\n\n首先，我们计算总采集时长 $T$：\n$$T = N \\cdot TR = 750 \\cdot 0.8 \\text{ s} = 600 \\text{ s}$$\n$k$ 次基函数的周期为：\n$$P_k = \\frac{2T}{k} = \\frac{2 \\cdot 600 \\text{ s}}{k} = \\frac{1200}{k} \\text{ s}$$\n高通滤波器是通过包含所有周期大于或等于截止值 $128$ 秒的基函数 $\\{b_k[n]\\}$ 来构建的。我们需要找到最大的整数索引 $K$，使得干扰回归量的集合为 $\\{b_k[n]\\}_{k=0}^{K}$。这意味着我们必须找到满足条件 $P_k \\geq 128$ 秒的最大整数 $k$（我们称之为 $K$）。\n\n对于 $k=0$，$P_0 = \\infty$，满足 $\\infty \\geq 128$ 秒。所以，$k=0$ 的回归量被包含在内。\n对于 $k  0$，我们有不等式：\n$$\\frac{1200}{k} \\geq 128$$\n由于 $k$ 是正整数，我们可以在不等式两边同乘以 $k$ 而不改变不等号的方向：\n$$1200 \\geq 128k$$\n$$k \\leq \\frac{1200}{128}$$\n我们来简化这个分数：\n$$\\frac{1200}{128} = \\frac{300}{32} = \\frac{75}{8} = 9.375$$\n条件是 $k \\leq 9.375$。由于 $k$ 必须是整数，因此 $k$ 可能的正整数值为 $1, 2, 3, 4, 5, 6, 7, 8, 9$。\n满足该标准的最大整数索引是 $k=9$。\n因此，要包含的回归量对应的索引为 $k = 0, 1, \\dots, 9$。问题要求的是集合 $\\{b_k[n]\\}_{k=0}^{K}$ 中的最大整数 $K$，即 $K=9$。\n\n**4. GLM 中的滤波机制**\n\n在 fMRI 分析中，广义线性模型 (GLM) 将单个体素的时间序列数据 $Y$ 建模为预测变量的线性组合加上误差：\n$$Y = X\\beta + \\epsilon$$\n此处，$Y$ 是 fMRI 数据的 $N \\times 1$ 向量，$X$ 是 $N \\times P$ 的设计矩阵（包含 $P$ 个回归量），$\\beta$ 是待估参数的 $P \\times 1$ 向量，$\\epsilon$ 是残差的 $N \\times 1$ 向量。\n\n为了实现高通滤波，设计矩阵 $X$ 通过加入低频 DCT 基函数作为干扰回归量来进行扩充。设计矩阵的形式如下：\n$$X = [X_{\\text{interest}} \\quad X_{\\text{nuisance}}]$$\n其中 $X_{\\text{interest}}$ 包含用于建模实验任务预期 BOLD 响应的回归量，而 $X_{\\text{nuisance}}$ 包含低频漂移分量：\n$$X_{\\text{nuisance}} = [b_0 \\quad b_1 \\quad \\dots \\quad b_K]$$\n其中 $b_k$ 是代表基函数 $b_k[n]$ 的列向量。在我们的例子中，$K=9$。\n\n参数 $\\beta$ 通常使用普通最小二乘法 (OLS) 进行估计，得到 $\\hat{\\beta} = (X^TX)^{-1}X^TY$。关键的见解在于，这个估计过程有效地将数据 $Y$ 中的方差“划分”给 $X$ 中的不同回归量。通过在模型中包含列向量 $\\{b_k\\}_{k=0}^K$，fMRI 信号中任何与这些低频余弦函数系统性协变的方差都会被归因于它们。\n\n投影解释如下：OLS 拟合值 $\\hat{Y} = X\\hat{\\beta}$ 是数据向量 $Y$ 在由设计矩阵 $X$ 的列向量所张成的向量空间（子空间）上的正交投影。这个子空间，我们称之为 $\\mathcal{C}(X)$，是由感兴趣回归量张成的子空间 $\\mathcal{C}(X_{\\text{interest}})$ 和由干扰回归量张成的子空间 $\\mathcal{C}(X_{\\text{nuisance}})$ 的和。\n当我们检验与 $X_{\\text{interest}}$ 相关参数的假设时，GLM 过程在考虑了所有其他回归量（包括干扰回归量）所解释的方差之后，有效地分离出这些感兴趣回归量的独特贡献。这等价于首先将数据 $Y$ 和感兴趣的回归量 $X_{\\text{interest}}$ 投影到与干扰回归量所张成的空间正交的子空间上，然后再执行回归。这种正交化过程从数据中移除了任何可以被 DCT 基组建模的低频信号分量，从而实现了高通滤波。随后的统计分析便在已“清除”了这些低频漂移的信号上进行。",
            "answer": "$$\\boxed{9}$$"
        }
    ]
}