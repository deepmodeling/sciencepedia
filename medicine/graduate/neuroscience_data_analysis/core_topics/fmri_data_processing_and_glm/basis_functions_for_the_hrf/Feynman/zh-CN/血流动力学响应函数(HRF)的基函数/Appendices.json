{
    "hands_on_practices": [
        {
            "introduction": "有限脉冲响应（Finite Impulse Response, FIR）模型是一种对血流动力学响应（HRF）的形状做最少假设的高度灵活的建模方法。本练习旨在通过从第一性原理出发，将离散的实验事件转化为通用线性模型（GLM）中的回归量，来巩固您对GLM构建核心机制的理解。通过亲手构建设计矩阵，您将深刻体会功能性磁共振成像（fMRI）数据分析中模型与实验时间序列之间的基本联系 。",
            "id": "4140272",
            "problem": "考虑一个单次运行的事件相关功能性磁共振成像 (fMRI) 实验，其中血氧水平依赖 (BOLD) 信号被建模为一个线性时不变系统。BOLD 信号是神经事件时间序列与血流动力学响应函数 (HRF) 的卷积，测量时间点以固定的重复时间 (TR) 进行采样。假设 HRF 采用有限脉冲响应 (FIR) 基表示，其中 HRF 表示为不重叠的指示函数的线性组合，每个指示函数跨越一个 TR 宽度的延迟区间。\n\n从线性时不变卷积模型和通用线性模型 (GLM) 表示出发。将 FIR 基函数定义为移位到每个事件起始点并在扫描时间点上采样的指示函数。根据这些原理，推导 FIR 设计矩阵元素 $X_{n,k}$ 的精确数学表达式，其中 $n$ 是扫描的索引，$k$ 是 FIR 延迟的索引。\n\n使用以下规格来实例化您的推导，然后计算一个特定的元素：\n- 采样间隔 (TR) 为 $\\Delta = 0.8$ 秒。\n- 扫描 $n$ 发生在时间 $t_{n} = n \\Delta$，其中 $n \\in \\{0,1,2,\\dots\\}$。\n- FIR 基由延迟区间组成，索引为 $k \\in \\{0,1,\\dots,L-1\\}$，每个区间由一个指示函数 $b_{k}(\\tau)$ 定义，如果 $\\tau \\in [k\\Delta,(k+1)\\Delta)$，则该函数等于 $1$，否则为 $0$。\n- 单个条件下的事件起始时间（以秒为单位）为 $t^{(e)} \\in \\{10.0,\\,10.4,\\,13.2\\}$。\n- 设计矩阵元素 $X_{n,k}$ 定义为在所有事件上，以刺激周围时间 $t_{n} - t^{(e)}$ 评估的指示函数的总和。\n\n使用这些定义，推导 $X_{n,k}$ 作为 $\\{t^{(e)}\\}$、$\\Delta$、$n$ 和 $k$ 的函数的一般表达式。然后，对于特定的扫描索引 $n = 15$ 和延迟索引 $k = 2$，计算 $X_{n,k}$ 的值。将您的最终答案表示为单个无量纲数。无需四舍五入。",
            "solution": "该问题要求推导有限脉冲响应 (FIR) 设计矩阵元素 $X_{n,k}$ 的一般表达式，并在给定一组实验参数的情况下计算其具体值。该问题是适定的，并且在使用通用线性模型 (GLM) 进行 fMRI 数据分析的标准原理上具有科学依据。\n\n首先，我们建立理论框架。BOLD 信号 $y(t)$ 被建模为线性时不变 (LTI) 系统的输出，其中神经事件时间序列 $s(t)$ 与血流动力学响应函数 (HRF) $h(\\tau)$ 进行卷积。数学上，这表示为：\n$$y(t) = (s * h)(t) = \\int_{-\\infty}^{\\infty} s(\\tau) h(t - \\tau) d\\tau$$\n对于事件相关设计，单个条件的神经事件时间序列 $s(t)$ 表示为在每个事件的起始时间 $t^{(e)}$ 处的狄拉克δ函数 $\\delta(t)$ 的总和：\n$$s(t) = \\sum_{e} \\delta(t - t^{(e)})$$\nHRF $h(\\tau)$ 使用一组基函数进行建模。在本例中，使用 FIR 基集，其中 HRF 是不重叠的指示函数 $b_k(\\tau)$ 的线性组合：\n$$h(\\tau) = \\sum_{k=0}^{L-1} \\beta_k b_k(\\tau)$$\n在这里，$\\beta_k$ 是待估计的未知权重或参数，$L$ 是 FIR 延迟的数量。\n\n将 $s(t)$ 和 $h(\\tau)$ 的表达式代入卷积积分，得到时间 $t$ 的预测信号：\n$$y(t) = \\int_{-\\infty}^{\\infty} \\left( \\sum_{e} \\delta(\\tau - t^{(e)}) \\right) \\left( \\sum_{k=0}^{L-1} \\beta_k b_k(t - \\tau) \\right) d\\tau$$\n根据积分的线性性质，我们可以交换求和与积分的顺序：\n$$y(t) = \\sum_{k=0}^{L-1} \\beta_k \\sum_{e} \\int_{-\\infty}^{\\infty} \\delta(\\tau - t^{(e)}) b_k(t - \\tau) d\\tau$$\n应用狄拉克δ函数的筛选性质，即 $\\int f(\\tau)\\delta(\\tau-a)d\\tau = f(a)$，我们得到：\n$$y(t) = \\sum_{k=0}^{L-1} \\beta_k \\sum_{e} b_k(t - t^{(e)})$$\nfMRI 信号在离散时间点 $t_n = n\\Delta$ 进行采样，其中 $n$ 是扫描索引，$\\Delta$ 是重复时间 (TR)。扫描 $n$ 的预测信号为：\n$$y(t_n) = \\sum_{k=0}^{L-1} \\beta_k \\left( \\sum_{e} b_k(t_n - t^{(e)}) \\right)$$\nGLM 将每次扫描的测量信号 $y_n$ 表示为预测变量（回归量）的线性组合加上一个误差项：\n$$y_n = \\sum_{k=0}^{L-1} X_{n,k} \\beta_k + \\epsilon_n$$\n通过将此规范 GLM 方程与我们推导的 $y(t_n)$ 表达式进行比较，我们可以将设计矩阵元素 $X_{n,k}$ 确定为乘以其相应参数 $\\beta_k$ 的项。这证实了问题陈述中提供的定义：\n$$X_{n,k} = \\sum_{e} b_k(t_n - t^{(e)})$$\n问题将 FIR 基函数 $b_k(\\tau)$ 定义为一个指示函数：\n$$b_k(\\tau) = \\begin{cases} 1  \\text{if } k\\Delta \\le \\tau  (k+1)\\Delta \\\\ 0  \\text{otherwise} \\end{cases}$$\n为使 $X_{n,k}$ 求和中的一项为 $1$，基函数的自变量，即刺激周围时间 $\\tau = t_n - t^{(e)}$，必须落在区间 $[k\\Delta, (k+1)\\Delta)$ 内。因此，只有当以下条件成立时，$b_k(t_n - t^{(e)})$ 才非零：\n$$k\\Delta \\le t_n - t^{(e)}  (k+1)\\Delta$$\n代入 $t_n = n\\Delta$，我们得到关于事件起始时间 $t^{(e)}$ 的条件：\n$$k\\Delta \\le n\\Delta - t^{(e)}  (k+1)\\Delta$$\n这个复合不等式可以重新排列以分离出 $t^{(e)}$：\n$$(n-k-1)\\Delta  t^{(e)} \\le (n-k)\\Delta$$\n这是一个事件必须满足的条件的通用表达式。$X_{n,k}$ 的值是其起始时间 $t^{(e)}$ 落入这个特定时间窗口的事件总数，该窗口由扫描索引 $n$、延迟索引 $k$ 和 TR $\\Delta$ 决定。我们可以使用 Iverson 括号表示法来写出 $X_{n,k}$ 的通用表达式，其中如果命题 $P$ 为真，则 $[P]$ 为 $1$，否则为 $0$：\n$$X_{n,k} = \\sum_{t^{(e)}} \\left[ k\\Delta \\le n\\Delta - t^{(e)}  (k+1)\\Delta \\right]$$\n\n现在，我们计算当 $n=15$ 和 $k=2$ 时 $X_{n,k}$ 的具体值。\n给定的参数是：\n- 采样间隔 (TR)：$\\Delta = 0.8$ 秒。\n- 扫描索引：$n = 15$。\n- FIR 延迟索引：$k = 2$。\n- 事件起始时间：$t^{(e)} \\in \\{10.0, 10.4, 13.2\\}$ 秒。\n\n首先，我们计算扫描 $n=15$ 的时间：\n$$t_{15} = n \\Delta = 15 \\times 0.8 = 12.0 \\text{ s}$$\n接下来，我们确定基函数 $b_2(\\tau)$ 非零的时间区间。当 $k=2$ 且 $\\Delta=0.8$ 秒时，该区间为：\n$$[k\\Delta, (k+1)\\Delta) = [2 \\times 0.8, (2+1) \\times 0.8) = [1.6, 2.4) \\text{ s}$$\n$X_{15,2}$ 的值是在所有事件上 $b_2(t_{15} - t^{(e)})$ 的总和。我们对每个事件起始时间 $t^{(e)}$ 计算该值：\n1. 对于发生在 $t^{(e_1)} = 10.0$ 秒的事件：\n   刺激周围时间为 $\\tau_1 = t_{15} - t^{(e_1)} = 12.0 - 10.0 = 2.0$ 秒。\n   我们检查 $\\tau_1$ 是否在区间 $[1.6, 2.4)$ 内。由于 $1.6 \\le 2.0  2.4$ 为真，因此 $b_2(2.0) = 1$。\n\n2. 对于发生在 $t^{(e_2)} = 10.4$ 秒的事件：\n   刺激周围时间为 $\\tau_2 = t_{15} - t^{(e_2)} = 12.0 - 10.4 = 1.6$ 秒。\n   我们检查 $\\tau_2$ 是否在区间 $[1.6, 2.4)$ 内。由于 $1.6 \\le 1.6  2.4$ 为真，因此 $b_2(1.6) = 1$。\n\n3. 对于发生在 $t^{(e_3)} = 13.2$ 秒的事件：\n   刺激周围时间为 $\\tau_3 = t_{15} - t^{(e_3)} = 12.0 - 13.2 = -1.2$ 秒。\n   我们检查 $\\tau_3$ 是否在区间 $[1.6, 2.4)$ 内。由于 $1.6 \\le -1.2  2.4$ 为假，因此 $b_2(-1.2) = 0$。\n\n最后，我们将这些值相加，得到设计矩阵的元素：\n$$X_{15,2} = \\sum_{e} b_2(t_{15} - t^{(e)}) = 1 + 1 + 0 = 2$$\n设计矩阵元素 $X_{15,2}$ 的值为 $2$。这个无量纲数表明，有两个事件发生的时间点，使得它们对与第二个 FIR 延迟相对应的时间区间内，扫描 $15$ 的预测 BOLD 信号有贡献。",
            "answer": "$$\n\\boxed{2}\n$$"
        },
        {
            "introduction": "虽然标准的血流动力学响应函数（HRF）模型十分高效，但其固定的形状和时延限制了它对真实神经活动响应多样性的捕捉能力。当模型与实际的响应时序存在微小偏差时，如何保证估计的准确性？本练习提供了一个定量的证明，展示了在模型中加入时间导数基函数作为一种强大的校正工具，能够有效减小因时序不匹配而导致的振幅估计偏差 。",
            "id": "4140259",
            "problem": "您正在分析功能性磁共振成像 (fMRI) 中的单次试验血氧水平依赖 (BOLD) 响应，该响应被建模为一个具有可微的血流动力学响应函数 (HRF) 的线性时不变系统。设 HRF 是一个平滑函数 $h(t)$，其一阶导数 $h^{\\prime}(t)$ 连续，并假设通用线性模型 (GLM) 成立，在时间 $t=0$ 时有一个单一事件，产生振幅为 $\\beta$ 的响应。采集使用重复时间 (TR) $\\Delta$，在时间 $t_{n} = n \\Delta$（其中 $n = 0, 1, \\dots, N-1$）处产生采样观测值，$N$ 的选择要足以完全覆盖 HRF 的有效支撑集。由于毫秒级的刺激时间精度和粗略的 TR，假设存在一个小的起始时间未对准 $\\varepsilon$，$0  \\varepsilon  \\Delta/2$，因此无噪声的采样数据为\n$$\ny_{n} = \\beta \\, h(t_{n} - \\varepsilon) \\quad \\text{for} \\quad n=0,1,\\dots,N-1.\n$$\n\n定义在 TR 网格上采样的典范 HRF 基向量为 $x_{n} = h(t_{n})$，时间导数基向量为 $d_{n} = h^{\\prime}(t_{n})$。考虑两种 GLM 设计：\n\n1. 单回归量设计，仅使用典范基向量 $x$，其最小二乘振幅估计为\n$$\n\\hat{\\beta}_{x} = \\frac{\\langle x, y \\rangle}{\\langle x, x \\rangle},\n$$\n其中离散内积为 $\\langle u, v \\rangle = \\sum_{n=0}^{N-1} u_{n} v_{n}$。\n\n2. 双回归量设计，同时使用典范基向量和时间导数基向量，其设计矩阵为 $X = [\\,x \\ \\ d\\,]$，最小二乘系数向量为 $\\hat{\\theta} = (\\hat{\\beta}_{0}, \\hat{\\beta}_{1})^{\\top}$，满足\n$$\n\\hat{\\theta} = \\arg\\min_{\\theta} \\|\\, y - X \\theta \\,\\|_{2}^{2}.\n$$\n\n仅使用以下基础知识：\n- BOLD 信号的线性时不变建模，即刺激与 HRF 的卷积及其在 TR 网格上的采样，\n- 通用线性模型 (GLM) 和最小二乘估计，\n- 针对微小时间未对准的一阶泰勒展开 $h(t - \\varepsilon) \\approx h(t) - \\varepsilon h^{\\prime}(t)$，\n\n推导在 (i) 仅使用典范基和 (ii) 同时使用典范基和时间导数基两种情况下，关于 $\\varepsilon$ 的一阶分数振幅偏差。具体而言，定义分数振幅偏差为\n$$\n\\delta_{1} = \\frac{\\hat{\\beta}_{x} - \\beta}{\\beta}\n\\quad \\text{and} \\quad\n\\delta_{2} = \\frac{\\hat{\\beta}_{0} - \\beta}{\\beta},\n$$\n并将 $\\delta_{1}$ 和 $\\delta_{2}$ 表示为关于 $\\varepsilon$、$\\langle x, x \\rangle$、$\\langle x, d \\rangle$ 和 $\\langle d, d \\rangle$ 的闭式符号表达式，忽略所有高于 $\\varepsilon$ 一阶的项。您可以假设 $x$ 和 $d$ 在采样窗口内是线性无关的。以包含 $\\delta_{1}$ 和 $\\delta_{2}$ 的行矩阵形式返回最终答案。最终表达式中不需要数值四舍五入，也不需要物理单位。",
            "solution": "所述问题具有科学依据，提法恰当，并包含唯一解所需的所有信息。其前提基于 fMRI 数据分析的标准方法，特别是通用线性模型 (GLM) 和使用基函数来解释信号变异性。因此，该问题是有效的，我们开始推导。\n\n问题的核心在于分析微小的时间未对准 $\\varepsilon$ 对 BOLD 响应振幅 $\\beta$ 估计的影响。无噪声的采样数据由下式给出\n$$\ny_{n} = \\beta \\, h(t_{n} - \\varepsilon)\n$$\n其中 $t_n = n\\Delta$。问题指定对 $h(t - \\varepsilon)$ 在 $t$ 附近使用一阶泰勒展开：\n$$\nh(t - \\varepsilon) \\approx h(t) - \\varepsilon h^{\\prime}(t)\n$$\n将此式代入 $y_n$ 的表达式，并使用基向量 $x_n = h(t_n)$ 和 $d_n = h^{\\prime}(t_n)$ 的定义，我们得到数据向量 $y$ 的一阶近似：\n$$\ny_{n} \\approx \\beta (x_n - \\varepsilon d_n)\n$$\n用向量表示法，可以写成：\n$$\ny \\approx \\beta (x - \\varepsilon d)\n$$\n这个近似在 $\\varepsilon$ 的一阶项上是准确的。我们将使用这个 $y$ 的表达式来推导估计量及其偏差。\n\n**第 (i) 部分：单回归量设计**\n\n在此设计中，仅使用典范 HRF 基向量 $x$ 作为回归量。振幅的最小二乘估计由下式给出：\n$$\n\\hat{\\beta}_{x} = \\frac{\\langle x, y \\rangle}{\\langle x, x \\rangle}\n$$\n其中 $\\langle u, v \\rangle = \\sum_{n=0}^{N-1} u_{n} v_{n}$ 是离散内积。我们代入 $y$ 的一阶近似：\n$$\n\\hat{\\beta}_{x} \\approx \\frac{\\langle x, \\beta (x - \\varepsilon d) \\rangle}{\\langle x, x \\rangle}\n$$\n利用内积的线性性质，我们可以展开分子：\n$$\n\\langle x, \\beta (x - \\varepsilon d) \\rangle = \\beta \\langle x, x - \\varepsilon d \\rangle = \\beta (\\langle x, x \\rangle - \\varepsilon \\langle x, d \\rangle)\n$$\n将此代回 $\\hat{\\beta}_{x}$ 的表达式：\n$$\n\\hat{\\beta}_{x} \\approx \\frac{\\beta (\\langle x, x \\rangle - \\varepsilon \\langle x, d \\rangle)}{\\langle x, x \\rangle} = \\beta \\left( \\frac{\\langle x, x \\rangle}{\\langle x, x \\rangle} - \\varepsilon \\frac{\\langle x, d \\rangle}{\\langle x, x \\rangle} \\right) = \\beta \\left( 1 - \\varepsilon \\frac{\\langle x, d \\rangle}{\\langle x, x \\rangle} \\right)\n$$\n分数振幅偏差 $\\delta_1$ 定义为 $\\delta_{1} = \\frac{\\hat{\\beta}_{x} - \\beta}{\\beta}$。使用我们关于 $\\hat{\\beta}_{x}$ 的结果：\n$$\n\\delta_{1} \\approx \\frac{\\beta \\left( 1 - \\varepsilon \\frac{\\langle x, d \\rangle}{\\langle x, x \\rangle} \\right) - \\beta}{\\beta} = \\frac{\\beta - \\beta \\varepsilon \\frac{\\langle x, d \\rangle}{\\langle x, x \\rangle} - \\beta}{\\beta} = \\frac{-\\beta \\varepsilon \\frac{\\langle x, d \\rangle}{\\langle x, x \\rangle}}{\\beta}\n$$\n这可以简化为一阶分数偏差：\n$$\n\\delta_{1} = -\\varepsilon \\frac{\\langle x, d \\rangle}{\\langle x, x \\rangle}\n$$\n\n**第 (ii) 部分：双回归量设计**\n\n在此设计中，典范基向量 $x$ 及其时间导数 $d$ 都被使用。设计矩阵为 $X = [\\,x \\ \\ d\\,]$，系数向量为 $\\theta = (\\beta_0, \\beta_1)^{\\top}$。最小二乘估计 $\\hat{\\theta}$ 由正规方程给出：\n$$\n\\hat{\\theta} = (X^{\\top}X)^{-1} X^{\\top}y\n$$\n首先，我们构造矩阵 $X^{\\top}X$：\n$$\nX^{\\top}X = \\begin{pmatrix} x^{\\top} \\\\ d^{\\top} \\end{pmatrix} [\\,x \\ \\ d\\,] = \\begin{pmatrix} x^{\\top}x  x^{\\top}d \\\\ d^{\\top}x  d^{\\top}d \\end{pmatrix} = \\begin{pmatrix} \\langle x, x \\rangle  \\langle x, d \\rangle \\\\ \\langle x, d \\rangle  \\langle d, d \\rangle \\end{pmatrix}\n$$\n这个 $2 \\times 2$ 矩阵的逆是：\n$$\n(X^{\\top}X)^{-1} = \\frac{1}{\\langle x, x \\rangle \\langle d, d \\rangle - \\langle x, d \\rangle^{2}} \\begin{pmatrix} \\langle d, d \\rangle  -\\langle x, d \\rangle \\\\ -\\langle x, d \\rangle  \\langle x, x \\rangle \\end{pmatrix}\n$$\n分母中的行列式不为零，因为假设 $x$ 和 $d$ 是线性无关的。\n\n接下来，我们使用近似 $y \\approx \\beta(x - \\varepsilon d)$ 来计算向量 $X^{\\top}y$：\n$$\nX^{\\top}y = \\begin{pmatrix} \\langle x, y \\rangle \\\\ \\langle d, y \\rangle \\end{pmatrix} \\approx \\begin{pmatrix} \\langle x, \\beta(x - \\varepsilon d) \\rangle \\\\ \\langle d, \\beta(x - \\varepsilon d) \\rangle \\end{pmatrix} = \\beta \\begin{pmatrix} \\langle x, x \\rangle - \\varepsilon \\langle x, d \\rangle \\\\ \\langle x, d \\rangle - \\varepsilon \\langle d, d \\rangle \\end{pmatrix}\n$$\n现在我们通过将 $(X^{\\top}X)^{-1}$ 和 $X^{\\top}y$ 相乘来计算 $\\hat{\\theta} = (\\hat{\\beta}_{0}, \\hat{\\beta}_{1})^{\\top}$。我们感兴趣的是 $\\hat{\\theta}$ 的第一个分量 $\\hat{\\beta}_0$：\n$$\n\\hat{\\beta}_{0} \\approx \\frac{\\beta}{\\langle x, x \\rangle \\langle d, d \\rangle - \\langle x, d \\rangle^{2}} \\left[ \\langle d, d \\rangle (\\langle x, x \\rangle - \\varepsilon \\langle x, d \\rangle) - \\langle x, d \\rangle (\\langle x, d \\rangle - \\varepsilon \\langle d, d \\rangle) \\right]\n$$\n让我们展开方括号中的项：\n$$\n\\left[ \\langle d, d \\rangle\\langle x, x \\rangle - \\varepsilon \\langle d, d \\rangle\\langle x, d \\rangle - \\langle x, d \\rangle^{2} + \\varepsilon \\langle x, d \\rangle\\langle d, d \\rangle \\right]\n$$\n包含 $\\varepsilon$ 的两项是 $-\\varepsilon \\langle d, d \\rangle\\langle x, d \\rangle$ 和 $+\\varepsilon \\langle x, d \\rangle\\langle d, d \\rangle$。它们相互抵消。方括号中的表达式简化为：\n$$\n\\langle x, x \\rangle \\langle d, d \\rangle - \\langle x, d \\rangle^{2}\n$$\n这正是 $X^{\\top}X$ 的行列式。将此代回 $\\hat{\\beta}_0$ 的表达式中：\n$$\n\\hat{\\beta}_{0} \\approx \\frac{\\beta \\left( \\langle x, x \\rangle \\langle d, d \\rangle - \\langle x, d \\rangle^{2} \\right)}{\\langle x, x \\rangle \\langle d, d \\rangle - \\langle x, d \\rangle^{2}} = \\beta\n$$\n这个结果表明，在 $\\varepsilon$ 的一阶近似下，$\\hat{\\beta}_0$ 是 $\\beta$ 的无偏估计量。分数振幅偏差 $\\delta_2$ 定义为 $\\delta_{2} = \\frac{\\hat{\\beta}_{0} - \\beta}{\\beta}$。\n$$\n\\delta_{2} \\approx \\frac{\\beta - \\beta}{\\beta} = 0\n$$\n$\\hat{\\beta}_0$ 中的任何残余偏差都必须是 $\\varepsilon^2$ 阶或更高阶的，根据问题陈述，这被忽略了。因此，对于 $\\varepsilon$ 的一阶项，分数偏差为零。\n\n总之，对于单回归量模型，分数偏差为 $\\delta_{1} = -\\varepsilon \\frac{\\langle x, d \\rangle}{\\langle x, x \\rangle}$。对于双回归量模型，分数偏差为 $\\delta_{2} = 0$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\varepsilon \\frac{\\langle x, d \\rangle}{\\langle x, x \\rangle}  0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在模型中加入导数基函数虽然能提高拟合的灵活性，但一个函数与其导数之间固有的相关性，会使模型参数的解释变得复杂。为了解决这一问题，一个常见的进阶技术是“正交化”。本练习将引导您探索这一技术，并从数学上证明它如何解耦相关的回归量，从而使我们能对标准HRF的振幅做出更直接、更明确的解释 。",
            "id": "4140212",
            "problem": "考虑一个用于功能性磁共振成像中单体素血氧水平依赖时间序列的离散时间通用线性模型 (GLM)，其中血液动力学响应函数 (HRF) 由一个规范基函数及其两个导数建模。设原始设计矩阵为 $X = [\\mathbf{h}\\ \\ \\mathbf{d}\\ \\ \\mathbf{q}] \\in \\mathbb{R}^{n \\times 3}$，其中 $\\mathbf{h} \\in \\mathbb{R}^{n}$ 是规范 HRF 回归量，$\\mathbf{d} \\in \\mathbb{R}^{n}$ 是时间导数回归量，$\\mathbf{q} \\in \\mathbb{R}^{n}$ 是离散导数回归量，所有这些都在相同的 $n$ 个时间点上进行评估。假设 $X$ 是满列秩的。\n\n通过将每个导数投影到 $\\mathbf{h}$ 的正交补上，定义残差化（对规范基函数正交化）的导数回归量：\n$$\n\\mathbf{d}_{\\perp} \\equiv \\mathbf{d} - \\mathbf{h}\\,\\frac{\\mathbf{h}^{\\top}\\mathbf{d}}{\\mathbf{h}^{\\top}\\mathbf{h}}, \n\\qquad\n\\mathbf{q}_{\\perp} \\equiv \\mathbf{q} - \\mathbf{h}\\,\\frac{\\mathbf{h}^{\\top}\\mathbf{q}}{\\mathbf{h}^{\\top}\\mathbf{h}}.\n$$\n令残差化设计为 $\\widetilde{X} = [\\mathbf{h}\\ \\ \\mathbf{d}_{\\perp}\\ \\ \\mathbf{q}_{\\perp}]$，并考虑使用普通最小二乘法，用 $X$ 或 $\\widetilde{X}$ 来拟合相同的 GLM 响应 $\\mathbf{y} \\in \\mathbb{R}^{n}$。\n\n仅从最小二乘法、正交投影和欧几里得空间中内积的定义属性出发，完成以下任务：\n\n1. 通过正规方程和投影几何，解释在残差化模型中，乘以 $\\mathbf{h}$ 的系数（例如，来自 $\\mathbf{y} = \\widetilde{X}\\,\\boldsymbol{\\gamma} + \\boldsymbol{\\varepsilon}$ 的 $\\gamma_{0}$）如何在微小的时间和离散偏差下，获得作为规范 HRF 孤立振幅的解释。你的解释必须仅依赖于上述定义所蕴含的正交关系，以及对微小时间或宽度扰动的一阶泰勒线性化。\n\n2. 推导将系数从残差化参数化映射回原始参数化的精确逆变换。也就是说，确定唯一的 $3\\times 3$ 矩阵 $T$，使得对于任意 $\\boldsymbol{\\gamma} \\in \\mathbb{R}^{3}$，都存在一个 $\\boldsymbol{\\beta} \\in \\mathbb{R}^{3}$，满足 $X\\,\\boldsymbol{\\beta} = \\widetilde{X}\\,\\boldsymbol{\\gamma}$ 且 $\\boldsymbol{\\beta} = T\\,\\boldsymbol{\\gamma}$。用闭合形式表示你的最终结果，仅使用内积 $s_{00} \\equiv \\mathbf{h}^{\\top}\\mathbf{h}$、$s_{01} \\equiv \\mathbf{h}^{\\top}\\mathbf{d}$ 和 $s_{02} \\equiv \\mathbf{h}^{\\top}\\mathbf{q}$。\n\n你的最终答案必须是 $3\\times 3$ 矩阵 $T$ 的单一、闭合形式的解析表达式。",
            "solution": "所述问题具有科学依据，提法恰当，并包含获得唯一解所需的所有信息。它描述了功能性神经影像数据分析中的一个标准程序，即在通用线性模型 (GLM) 中使用血液动力学响应函数 (HRF) 的基组，以及对基回归量进行正交化以提高回归系数的可解释性。该推导依赖于线性代数、最小二乘估计和微积分的基本原理。因此，我们可以着手求解。\n\n问题分为两部分。第一部分要求解释在具有正交化导数的模型中规范 HRF 回归量的系数的解释。第二部分要求推导原始模型和残差化模型系数之间的变换矩阵。\n\n**第1部分：系数 $\\gamma_0$ 的解释**\n\n使用残差化设计矩阵 $\\widetilde{X} = [\\mathbf{h}\\ \\ \\mathbf{d}_{\\perp}\\ \\ \\mathbf{q}_{\\perp}]$ 的模型由下式给出：\n$$ \\mathbf{y} = \\widetilde{X}\\boldsymbol{\\gamma} + \\boldsymbol{\\varepsilon} = \\gamma_{0}\\mathbf{h} + \\gamma_{1}\\mathbf{d}_{\\perp} + \\gamma_{2}\\mathbf{q}_{\\perp} + \\boldsymbol{\\varepsilon} $$\n普通最小二乘 (OLS) 估计 $\\hat{\\boldsymbol{\\gamma}}$ 通过求解正规方程得到：\n$$ (\\widetilde{X}^{\\top}\\widetilde{X})\\hat{\\boldsymbol{\\gamma}} = \\widetilde{X}^{\\top}\\mathbf{y} $$\n解释 $\\hat{\\gamma}_{0}$ 的关键在于格拉姆矩阵 $\\widetilde{X}^{\\top}\\widetilde{X}$ 的结构。回归量 $\\mathbf{d}_{\\perp}$ 和 $\\mathbf{q}_{\\perp}$ 是通过将 $\\mathbf{d}$ 和 $\\mathbf{q}$ 投影到由 $\\mathbf{h}$ 张成的子空间的正交补上构建的。根据定义，这使得它们与 $\\mathbf{h}$ 正交。我们可以使用 $\\mathbb{R}^{n}$ 中内积的定义 $\\mathbf{u}^{\\top}\\mathbf{v}$ 来验证这一点：\n$$ \\mathbf{h}^{\\top}\\mathbf{d}_{\\perp} = \\mathbf{h}^{\\top}\\left(\\mathbf{d} - \\mathbf{h}\\,\\frac{\\mathbf{h}^{\\top}\\mathbf{d}}{\\mathbf{h}^{\\top}\\mathbf{h}}\\right) = \\mathbf{h}^{\\top}\\mathbf{d} - (\\mathbf{h}^{\\top}\\mathbf{h})\\frac{\\mathbf{h}^{\\top}\\mathbf{d}}{\\mathbf{h}^{\\top}\\mathbf{h}} = \\mathbf{h}^{\\top}\\mathbf{d} - \\mathbf{h}^{\\top}\\mathbf{d} = 0 $$\n同样地，$\\mathbf{h}^{\\top}\\mathbf{q}_{\\perp} = 0$。这种正交性简化了格拉姆矩阵：\n$$ \\widetilde{X}^{\\top}\\widetilde{X} = \\begin{pmatrix} \\mathbf{h}^{\\top}\\mathbf{h}  \\mathbf{h}^{\\top}\\mathbf{d}_{\\perp}  \\mathbf{h}^{\\top}\\mathbf{q}_{\\perp} \\\\ \\mathbf{d}_{\\perp}^{\\top}\\mathbf{h}  \\mathbf{d}_{\\perp}^{\\top}\\mathbf{d}_{\\perp}  \\mathbf{d}_{\\perp}^{\\top}\\mathbf{q}_{\\perp} \\\\ \\mathbf{q}_{\\perp}^{\\top}\\mathbf{h}  \\mathbf{q}_{\\perp}^{\\top}\\mathbf{d}_{\\perp}  \\mathbf{q}_{\\perp}^{\\top}\\mathbf{q}_{\\perp} \\end{pmatrix} = \\begin{pmatrix} \\mathbf{h}^{\\top}\\mathbf{h}  0  0 \\\\ 0  \\mathbf{d}_{\\perp}^{\\top}\\mathbf{d}_{\\perp}  \\mathbf{d}_{\\perp}^{\\top}\\mathbf{q}_{\\perp} \\\\ 0  \\mathbf{q}_{\\perp}^{\\top}\\mathbf{d}_{\\perp}  \\mathbf{q}_{\\perp}^{\\top}\\mathbf{q}_{\\perp} \\end{pmatrix} $$\n因此，正规方程变为：\n$$ \\begin{pmatrix} \\mathbf{h}^{\\top}\\mathbf{h}  0  0 \\\\ 0  \\mathbf{d}_{\\perp}^{\\top}\\mathbf{d}_{\\perp}  \\mathbf{d}_{\\perp}^{\\top}\\mathbf{q}_{\\perp} \\\\ 0  \\mathbf{q}_{\\perp}^{\\top}\\mathbf{d}_{\\perp}  \\mathbf{q}_{\\perp}^{\\top}\\mathbf{q}_{\\perp} \\end{pmatrix} \\begin{pmatrix} \\hat{\\gamma}_{0} \\\\ \\hat{\\gamma}_{1} \\\\ \\hat{\\gamma}_{2} \\end{pmatrix} = \\begin{pmatrix} \\mathbf{h}^{\\top}\\mathbf{y} \\\\ \\mathbf{d}_{\\perp}^{\\top}\\mathbf{y} \\\\ \\mathbf{q}_{\\perp}^{\\top}\\mathbf{y} \\end{pmatrix} $$\n该矩阵的块对角结构将 $\\hat{\\gamma}_{0}$ 的方程与 $\\hat{\\gamma}_{1}$ 和 $\\hat{\\gamma}_{2}$ 的方程解耦：\n$$ (\\mathbf{h}^{\\top}\\mathbf{h})\\hat{\\gamma}_{0} = \\mathbf{h}^{\\top}\\mathbf{y} \\implies \\hat{\\gamma}_{0} = \\frac{\\mathbf{h}^{\\top}\\mathbf{y}}{\\mathbf{h}^{\\top}\\mathbf{h}} $$\n这与仅对 $\\mathbf{h}$ 进行 $\\mathbf{y}$ 的简单回归所获得的系数公式相同。在几何上，$\\hat{\\gamma}_{0}\\mathbf{h}$ 是数据向量 $\\mathbf{y}$ 在由 $\\mathbf{h}$ 张成的一维子空间上的正交投影。由于其他回归量 $\\mathbf{d}_{\\perp}$ 和 $\\mathbf{q}_{\\perp}$ 与 $\\mathbf{h}$ 正交，它们不会对这个投影产生贡献或混淆。\n\n解释性的洞见来自于与泰勒级数线性化的联系。规范 HRF，比如 $f(t)$，由回归量 $\\mathbf{h}$ 建模。神经响应中的一个微小延迟 $\\delta_t$ 会导致形式为 $f(t-\\delta_t)$ 的 HRF。在 $\\delta_t=0$ 附近的一阶泰勒展开给出：\n$$ f(t-\\delta_t) \\approx f(t) - \\delta_t f'(t) $$\n时间导数回归量 $\\mathbf{d}$ 被构造成与 $f'(t)$ 成比例。因此，$\\mathbf{h}$ 和 $\\mathbf{d}$ 的线性组合可以近似一个时间平移的规范 HRF。类似地，离散导数 $\\mathbf{q}$ 与 $f$ 对其宽度参数的偏导数有关，从而允许基组对宽度略有不同的 HRF 进行建模。\n在具有设计矩阵 $X$ 的原始模型中，回归量 $\\mathbf{h}$、$\\mathbf{d}$ 和 $\\mathbf{q}$ 通常是相关的。这意味着对 $\\mathbf{h}$ 振幅的 OLS 估计（即 $\\beta_0$）会受到也可以由时间平移或离散变化解释的方差的混淆。它不代表一个“纯粹”的振幅。\n通过将导数相对于规范形状进行正交化，残差化模型分离了这些效应。系数 $\\hat{\\gamma}_{0}$ 量化了投影到精确规范 HRF 形状上的响应大小。系数 $\\hat{\\gamma}_{1}$ 和 $\\hat{\\gamma}_{2}$ 分别量化了来自与规范形式正交的时间和离散变化的额外贡献。因此，$\\gamma_0$ 获得了作为规范 HRF 孤立振幅的解释，不受响应延迟或持续时间微小偏差的污染。\n\n**第2部分：变换矩阵 $T$ 的推导**\n\n我们寻求一个 $3 \\times 3$ 矩阵 $T$，使得对于任何 $\\boldsymbol{\\gamma} \\in \\mathbb{R}^{3}$，拟合响应的相等性 $X\\boldsymbol{\\beta} = \\widetilde{X}\\boldsymbol{\\gamma}$ 意味着线性关系 $\\boldsymbol{\\beta} = T\\boldsymbol{\\gamma}$。\n拟合响应的相等性可以写成：\n$$ \\beta_0 \\mathbf{h} + \\beta_1 \\mathbf{d} + \\beta_2 \\mathbf{q} = \\gamma_0 \\mathbf{h} + \\gamma_1 \\mathbf{d}_{\\perp} + \\gamma_2 \\mathbf{q}_{\\perp} $$\n我们将残差化回归量 $\\mathbf{d}_{\\perp}$ 和 $\\mathbf{q}_{\\perp}$ 的定义代入右侧。使用所提供的符号 $s_{00} = \\mathbf{h}^{\\top}\\mathbf{h}$、$s_{01} = \\mathbf{h}^{\\top}\\mathbf{d}$ 和 $s_{02} = \\mathbf{h}^{\\top}\\mathbf{q}$：\n$$ \\mathbf{d}_{\\perp} = \\mathbf{d} - \\mathbf{h}\\,\\frac{s_{01}}{s_{00}} $$\n$$ \\mathbf{q}_{\\perp} = \\mathbf{q} - \\mathbf{h}\\,\\frac{s_{02}}{s_{00}} $$\n将这些代入向量等式的右侧：\n$$ \\text{RHS} = \\gamma_0 \\mathbf{h} + \\gamma_1 \\left(\\mathbf{d} - \\mathbf{h}\\,\\frac{s_{01}}{s_{00}}\\right) + \\gamma_2 \\left(\\mathbf{q} - \\mathbf{h}\\,\\frac{s_{02}}{s_{00}}\\right) $$\n我们现在收集乘以基向量 $\\mathbf{h}$、$\\mathbf{d}$ 和 $\\mathbf{q}$ 的项：\n$$ \\text{RHS} = \\left(\\gamma_0 - \\gamma_1 \\frac{s_{01}}{s_{00}} - \\gamma_2 \\frac{s_{02}}{s_{00}}\\right)\\mathbf{h} + (\\gamma_1)\\mathbf{d} + (\\gamma_2)\\mathbf{q} $$\n左侧是 $\\text{LHS} = \\beta_0 \\mathbf{h} + \\beta_1 \\mathbf{d} + \\beta_2 \\mathbf{q}$。\n通过令左右两侧相等，我们在由 $X$ 的列给出的基中得到了同一向量的两种表示。由于假设 $X$ 是满列秩的，其列 $\\{\\mathbf{h}, \\mathbf{d}, \\mathbf{q}\\}$ 是线性无关的。因此，基向量的系数必须相等：\n$$ \\beta_0 = \\gamma_0 - \\gamma_1 \\frac{s_{01}}{s_{00}} - \\gamma_2 \\frac{s_{02}}{s_{00}} $$\n$$ \\beta_1 = \\gamma_1 $$\n$$ \\beta_2 = \\gamma_2 $$\n这个线性方程组将 $\\boldsymbol{\\beta}$ 的分量与 $\\boldsymbol{\\gamma}$ 的分量联系起来。我们可以将其表示为矩阵形式 $\\boldsymbol{\\beta} = T\\boldsymbol{\\gamma}$：\n$$ \\begin{pmatrix} \\beta_0 \\\\ \\beta_1 \\\\ \\beta_2 \\end{pmatrix} = \\begin{pmatrix} 1  -\\frac{s_{01}}{s_{00}}  -\\frac{s_{02}}{s_{00}} \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} \\gamma_0 \\\\ \\gamma_1 \\\\ \\gamma_2 \\end{pmatrix} $$\n由此，我们可以按要求确定变换矩阵 $T$。\n$$ T = \\begin{pmatrix} 1  -\\frac{s_{01}}{s_{00}}  -\\frac{s_{02}}{s_{00}} \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} $$\n这个矩阵 $T$ 提供了从残差化模型系数 ($\\boldsymbol{\\gamma}$) 到原始模型系数 ($\\boldsymbol{\\beta}$) 的精确逆变换。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  -\\frac{s_{01}}{s_{00}}  -\\frac{s_{02}}{s_{00}} \\\\\n0  1  0 \\\\\n0  0  1\n\\end{pmatrix}\n}\n$$"
        }
    ]
}