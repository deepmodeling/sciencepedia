{
    "hands_on_practices": [
        {
            "introduction": "Before we can correct for temporal artifacts, we must first understand their origin in the data acquisition process. A single fMRI volume is not captured instantaneously; instead, it is built slice by slice over the course of the Repetition Time ($TR$). This exercise  challenges you to derive the precise acquisition time for any given slice based on the sequence parameters, providing a foundational understanding of the within-volume temporal offsets that slice timing correction aims to resolve.",
            "id": "4164941",
            "problem": "You are analyzing a single-band Echo Planar Imaging (EPI) functional Magnetic Resonance Imaging (fMRI) sequence with interleaved even-odd slice ordering. The volume comprises $N=36$ axial slices, indexed by integers $s \\in \\{1,2,\\dots,36\\}$ from inferior to superior. The Repetition Time (TR) is $TR = 2.0 \\text{ s}$. Assume:\n- Each slice occupies a constant acquisition duration, and slices are acquired back-to-back within the volume without idle time. Thus, the per-slice acquisition duration is $\\Delta t = TR/N$.\n- The acquisition order is interleaved with even slices first in ascending index, followed by odd slices in ascending index, that is, $2,4,6,\\dots,36,1,3,5,\\dots,35$.\n- The acquisition time $t(s)$ of slice $s$ is defined as the onset time of the slice readout relative to the start of the volume at $t=0$.\n\nStarting from fundamental definitions of EPI timing and uniform per-slice acquisition, derive a closed-form expression for the mapping from slice index $s$ to acquisition time $t(s)$ under the specified interleaved even-odd ordering. Then, using your derived mapping, compute the acquisition time of slice $s=26$ relative to the volume start. Express the final numerical time in seconds and round your answer to four significant figures.",
            "solution": "The problem is to derive a closed-form expression for the acquisition time $t(s)$ of a slice with index $s$ in a single-band EPI sequence and then to compute this time for a specific slice. The given parameters are the total number of slices $N=36$, the Repetition Time $TR = 2.0 \\text{ s}$, and a specific interleaved acquisition order. The slice index $s$ ranges from $1$ to $36$.\n\nFirst, we establish the fundamental timing unit. The problem states that all slices are acquired with a constant duration and back-to-back within the volume time $TR$. Therefore, the per-slice acquisition duration, $\\Delta t$, is the total time divided by the number of slices:\n$$\n\\Delta t = \\frac{TR}{N}\n$$\nSubstituting the given values, we find:\n$$\n\\Delta t = \\frac{2.0 \\text{ s}}{36} = \\frac{1}{18} \\text{ s}\n$$\nThe acquisition time $t(s)$ of slice $s$ is its onset time relative to the start of the volume. This time is determined by the slice's position in the acquisition sequence. Let us define a zero-indexed acquisition position, $p$, where $p \\in \\{0, 1, \\dots, N-1\\}$. The first slice acquired corresponds to $p=0$, the second to $p=1$, and so on. The acquisition time for a slice at position $p$ is given by:\n$$\nt_p = p \\cdot \\Delta t = p \\frac{TR}{N}\n$$\nTo find the function $t(s)$, we must first find the mapping from the slice index $s$ to its acquisition position, $p(s)$. The acquisition order is specified as interleaved even-odd: all even-indexed slices are acquired first in ascending order, followed by all odd-indexed slices in ascending order. The sequence is $2, 4, \\dots, 36, 1, 3, \\dots, 35$.\n\nWe derive the function $p(s)$ by considering two cases based on the parity of the slice index $s$.\n\nCase 1: $s$ is an even number.\nThe even slices are acquired in the order $2, 4, 6, \\dots, 36$.\nThe slice $s=2$ is the first slice acquired, so its position is $p(2)=0$.\nThe slice $s=4$ is the second slice acquired, so its position is $p(4)=1$.\nThe slice $s=6$ is the third slice acquired, so its position is $p(6)=2$.\nWe can see a pattern. For an even slice $s$, it is the $(s/2)$-th slice in the acquisition sequence. Since the position index $p$ is zero-based, the position is one less than its order in the sequence. Thus, for an even slice $s$:\n$$\np(s) = \\frac{s}{2} - 1\n$$\n\nCase 2: $s$ is an odd number.\nThe odd slices are acquired after all the even slices have been acquired. There are $N/2$ even slices. For $N=36$, this is $36/2 = 18$ even slices. These slices occupy the first $18$ positions in the sequence, from $p=0$ to $p=17$. Therefore, the acquisition of odd slices begins at position $p=18$, which is $p=N/2$.\nThe odd slices are acquired in the order $1, 3, 5, \\dots, 35$.\nThe first odd slice acquired is $s=1$, and its position is $p(1) = N/2 = 18$.\nThe second odd slice acquired is $s=3$, and its position is $p(3) = N/2 + 1 = 19$.\nAn odd slice $s$ can be written as $s = 2k-1$ for some integer $k \\ge 1$. For $s=1$, $k=1$. For $s=3$, $k=2$. In general, $k = (s+1)/2$. The slice $s$ is the $k$-th odd slice to be acquired.\nThe position of the $k$-th odd slice in the overall sequence is $p = (N/2) + (k-1)$. Substituting the expression for $k$ in terms of $s$:\n$$\np(s) = \\frac{N}{2} + \\left(\\frac{s+1}{2} - 1\\right) = \\frac{N}{2} + \\frac{s-1}{2} = \\frac{N+s-1}{2}\n$$\n\nCombining these two cases, we can write the complete mapping from slice index $s$ to acquisition position $p(s)$ as a piecewise function:\n$$\np(s) = \\begin{cases} \\frac{s-2}{2} & \\text{if } s \\text{ is even} \\\\ \\frac{N+s-1}{2} & \\text{if } s \\text{ is odd} \\end{cases}\n$$\nNow, we can write the closed-form expression for the acquisition time $t(s) = p(s) \\cdot \\Delta t$:\n$$\nt(s) = \\begin{cases} \\left(\\frac{s-2}{2}\\right) \\frac{TR}{N} & \\text{if } s \\text{ is even} \\\\ \\left(\\frac{N+s-1}{2}\\right) \\frac{TR}{N} & \\text{if } s \\text{ is odd} \\end{cases}\n$$\nThis is the required general closed-form expression for the acquisition time as a function of the slice index.\n\nThe problem then asks to compute the acquisition time of slice $s=26$.\nSince $s=26$ is an even number, we use the first part of the piecewise function:\n$$\nt(26) = \\left(\\frac{26-2}{2}\\right) \\frac{TR}{N}\n$$\nSubstituting the given values $N=36$ and $TR=2.0 \\text{ s}$:\n$$\nt(26) = \\left(\\frac{24}{2}\\right) \\frac{2.0}{36} = 12 \\cdot \\frac{2.0}{36} = \\frac{24.0}{36}\n$$\nSimplifying the fraction gives:\n$$\nt(26) = \\frac{2}{3} \\text{ s}\n$$\nAs a decimal, this is $t(26) = 0.6666\\dots \\text{ s}$. The problem requires the answer to be rounded to four significant figures.\n$$\nt(26) \\approx 0.6667 \\text{ s}\n$$",
            "answer": "$$\n\\boxed{0.6667}\n$$"
        },
        {
            "introduction": "Head motion is a primary source of noise in fMRI data, and while correction algorithms estimate translations and rotations, we need a single, intuitive metric to assess data quality. Framewise Displacement (FD) provides this by summarizing volume-to-volume head movement into one number, reflecting the displacement at the brain's surface. This practice exercise  guides you through the process of calculating FD from motion parameters, a core skill for identifying high-motion time points and ensuring the integrity of your analysis.",
            "id": "4164971",
            "problem": "In functional Magnetic Resonance Imaging (fMRI), head motion between successive volumes is modeled as a rigid-body transformation composed of three translations and three rotations. A commonly used scalar summary of volume-to-volume motion is the Framewise Displacement (FD), which quantifies the total instantaneous displacement at the brain surface by combining translational and rotational changes. Using rigid-body kinematics and the small-angle arc-length relationship, derive from first principles the expression for FD between consecutive volumes, and then compute the FD time series for the following realignment parameters. Rotations are given in radians, and translations are given in millimeters, with the head approximated as a sphere of radius $r=50\\,\\mathrm{mm}$ centered at the rotation pivot.\n\nGiven parameters for volumes indexed by $t=0,1,\\dots,7$:\n- Volume $t=0$: translations $(t_x,t_y,t_z)=(0.00,0.00,0.00)\\,\\mathrm{mm}$; rotations $(\\alpha,\\beta,\\gamma)=(0.000,0.000,0.000)\\,\\mathrm{rad}$.\n- Volume $t=1$: translations $(t_x,t_y,t_z)=(0.10,0.05,-0.08)\\,\\mathrm{mm}$; rotations $(\\alpha,\\beta,\\gamma)=(0.004,-0.003,0.002)\\,\\mathrm{rad}$.\n- Volume $t=2$: translations $(t_x,t_y,t_z)=(0.12,0.03,-0.02)\\,\\mathrm{mm}$; rotations $(\\alpha,\\beta,\\gamma)=(0.015,0.000,0.004)\\,\\mathrm{rad}$.\n- Volume $t=3$: translations $(t_x,t_y,t_z)=(0.20,0.00,-0.05)\\,\\mathrm{mm}$; rotations $(\\alpha,\\beta,\\gamma)=(0.018,0.006,0.006)\\,\\mathrm{rad}$.\n- Volume $t=4$: translations $(t_x,t_y,t_z)=(0.22,0.02,-0.06)\\,\\mathrm{mm}$; rotations $(\\alpha,\\beta,\\gamma)=(0.022,0.010,0.006)\\,\\mathrm{rad}$.\n- Volume $t=5$: translations $(t_x,t_y,t_z)=(0.25,0.02,-0.10)\\,\\mathrm{mm}$; rotations $(\\alpha,\\beta,\\gamma)=(0.025,0.020,0.010)\\,\\mathrm{rad}$.\n- Volume $t=6$: translations $(t_x,t_y,t_z)=(0.27,0.03,-0.20)\\,\\mathrm{mm}$; rotations $(\\alpha,\\beta,\\gamma)=(0.030,0.030,0.015)\\,\\mathrm{rad}$.\n- Volume $t=7$: translations $(t_x,t_y,t_z)=(0.30,0.05,-0.25)\\,\\mathrm{mm}$; rotations $(\\alpha,\\beta,\\gamma)=(0.040,0.050,0.025)\\,\\mathrm{rad}$.\n\nTasks:\n1. Using rigid-body motion and the small-angle arc-length relationship, derive the expression for the FD between volumes $t-1$ and $t$ in terms of the changes in translations and rotations and the radius $r$.\n2. Compute the FD for each transition $t=1,2,\\dots,7$.\n3. Using a motion censoring threshold of $\\tau=0.5\\,\\mathrm{mm}$, identify all volumes $t$ with $\\mathrm{FD}(t)>\\tau$ and report the total number of such volumes. Treat $\\mathrm{FD}(0)$ as $0$ and do not apply thresholding to $t=0$.\n\nProvide the final answer as the total count of volumes exceeding the threshold. No rounding is necessary. The count is unitless; do not include units in the final reported answer.",
            "solution": "This problem requires deriving the Framewise Displacement (FD) formula, calculating it for a given time series of motion parameters, and counting the number of volumes that exceed a specified motion threshold.\n\n**Part 1: Derivation of the Framewise Displacement (FD) expression**\n\nFramewise Displacement quantifies instantaneous head motion between consecutive volumes, indexed by $t-1$ and $t$. The motion is given by six rigid-body parameters: three translations $(t_x, t_y, t_z)$ and three rotations $(\\alpha, \\beta, \\gamma)$. The FD is a scalar summary of the change in these parameters.\n\nLet the motion parameters at time $t$ be $P(t) = (t_x(t), t_y(t), t_z(t), \\alpha(t), \\beta(t), \\gamma(t))$. The change in parameters from volume $t-1$ to $t$ is the temporal difference, $\\Delta P(t) = P(t) - P(t-1)$.\n\nThe total FD is the sum of translational and rotational displacements.\n1.  **Translational Displacement**: The changes in translational parameters $(\\Delta t_x, \\Delta t_y, \\Delta t_z)$ are direct displacements in millimeters. The total translational displacement is the sum of their absolute values (an L1-norm):\n    $$ D_{\\text{trans}}(t) = |\\Delta t_x(t)| + |\\Delta t_y(t)| + |\\Delta t_z(t)| $$\n2.  **Rotational Displacement**: The changes in rotational parameters $(\\Delta \\alpha, \\Delta \\beta, \\Delta \\gamma)$ are in radians. To convert these to linear displacements, we model the head as a sphere of radius $r$ and use the arc-length formula $s = r\\theta$. This estimates the displacement of a point on the surface of the sphere. The total rotational displacement is the sum of these individual arc lengths:\n    $$ D_{\\text{rot}}(t) = r (|\\Delta\\alpha(t)| + |\\Delta\\beta(t)| + |\\Delta\\gamma(t)|) $$\n3.  **Total Framewise Displacement**: Combining both components gives the FD formula in millimeters:\n    $$ \\mathrm{FD}(t) = D_{\\text{trans}}(t) + D_{\\text{rot}}(t) = |\\Delta t_x(t)| + |\\Delta t_y(t)| + |\\Delta t_z(t)| + r (|\\Delta\\alpha(t)| + |\\Delta\\beta(t)| + |\\Delta\\gamma(t)|) $$\n\n**Part 2: Calculation of FD for each time point**\n\nWe apply the formula with $r=50\\,\\mathrm{mm}$. We define $\\mathrm{FD}(0) = 0$ and calculate FD for $t=1, \\dots, 7$.\n\n*   **For $t=1$**: $\\Delta\\text{params} = (0.10, 0.05, -0.08, 0.004, -0.003, 0.002)$.\n    $\\mathrm{FD}(1) = |0.10| + |0.05| + |-0.08| + 50(|0.004| + |-0.003| + |0.002|) = 0.23 + 50(0.009) = 0.68\\,\\mathrm{mm}$.\n\n*   **For $t=2$**: $\\Delta\\text{params} = (0.02, -0.02, 0.06, 0.011, 0.003, 0.002)$.\n    $\\mathrm{FD}(2) = |0.02| + |-0.02| + |0.06| + 50(|0.011| + |0.003| + |0.002|) = 0.10 + 50(0.016) = 0.90\\,\\mathrm{mm}$.\n\n*   **For $t=3$**: $\\Delta\\text{params} = (0.08, -0.03, -0.03, 0.003, 0.006, 0.002)$.\n    $\\mathrm{FD}(3) = |0.08| + |-0.03| + |-0.03| + 50(|0.003| + |0.006| + |0.002|) = 0.14 + 50(0.011) = 0.69\\,\\mathrm{mm}$.\n\n*   **For $t=4$**: $\\Delta\\text{params} = (0.02, 0.02, -0.01, 0.004, 0.004, 0.000)$.\n    $\\mathrm{FD}(4) = |0.02| + |0.02| + |-0.01| + 50(|0.004| + |0.004| + |0.000|) = 0.05 + 50(0.008) = 0.45\\,\\mathrm{mm}$.\n\n*   **For $t=5$**: $\\Delta\\text{params} = (0.03, 0.00, -0.04, 0.003, 0.010, 0.004)$.\n    $\\mathrm{FD}(5) = |0.03| + |0.00| + |-0.04| + 50(|0.003| + |0.010| + |0.004|) = 0.07 + 50(0.017) = 0.92\\,\\mathrm{mm}$.\n\n*   **For $t=6$**: $\\Delta\\text{params} = (0.02, 0.01, -0.10, 0.005, 0.010, 0.005)$.\n    $\\mathrm{FD}(6) = |0.02| + |0.01| + |-0.10| + 50(|0.005| + |0.010| + |0.005|) = 0.13 + 50(0.020) = 1.13\\,\\mathrm{mm}$.\n\n*   **For $t=7$**: $\\Delta\\text{params} = (0.03, 0.02, -0.05, 0.010, 0.020, 0.010)$.\n    $\\mathrm{FD}(7) = |0.03| + |0.02| + |-0.05| + 50(|0.010| + |0.020| + |0.010|) = 0.10 + 50(0.040) = 2.10\\,\\mathrm{mm}$.\n\n**Part 3: Thresholding**\n\nThe censoring threshold is $\\tau=0.5\\,\\mathrm{mm}$. We identify all volumes $t$ where $\\mathrm{FD}(t) > \\tau$.\n*   $\\mathrm{FD}(1) = 0.68 > 0.5$ (Flag)\n*   $\\mathrm{FD}(2) = 0.90 > 0.5$ (Flag)\n*   $\\mathrm{FD}(3) = 0.69 > 0.5$ (Flag)\n*   $\\mathrm{FD}(4) = 0.45 \\le 0.5$ (Do not flag)\n*   $\\mathrm{FD}(5) = 0.92 > 0.5$ (Flag)\n*   $\\mathrm{FD}(6) = 1.13 > 0.5$ (Flag)\n*   $\\mathrm{FD}(7) = 2.10 > 0.5$ (Flag)\n\nThe volumes with FD exceeding the threshold are $t=1, 2, 3, 5, 6, 7$. The total count of such volumes is 6.",
            "answer": "$$\n\\boxed{6}\n$$"
        },
        {
            "introduction": "Effective fMRI preprocessing is more than just applying a sequence of steps; it requires designing a strategy that minimizes data degradation. Both slice timing and motion correction involve data resampling, and performing them optimally is key to preserving signal fidelity. This final exercise  challenges you to think critically about this process, deriving the optimal reference time for correction and considering how to integrate temporal and spatial resampling into a single, scientifically sound step.",
            "id": "4164960",
            "problem": "A functional Magnetic Resonance Imaging (fMRI) experiment uses an event-related design with nominal event onsets jittered in steps of $0.5$ seconds across runs. The data are acquired with a Repetition Time (TR) of $2$ seconds and interleaved slice acquisition in a single-shot echo-planar imaging sequence. Assume each slice’s time stamp corresponds to the temporal center of its readout window within each volume. A General Linear Model (GLM) is fit to the data using regressors constructed by convolving the event time series with a fixed Hemodynamic Response Function (HRF). You are tasked with designing a slice timing correction strategy that is compatible with rigid-body motion correction and minimizes bias in the GLM regressors due to within-volume slice-time offsets.\n\nStarting from the fundamental linear time-invariant convolution model for the Blood Oxygen Level Dependent (BOLD) signal, and treating small temporal resampling shifts via first-order approximations, derive the choice of a single slice timing correction reference time $t_{\\mathrm{ref}}$ (within each TR) that minimizes the expected bias in the GLM regressors across slices when event phases relative to the volume onset are distributed uniformly over the TR due to the $0.5$-second jitter. Interleaved ordering need not be modeled explicitly beyond the fact that slice acquisition times are uniformly spaced within each volume.\n\nDesign a scientifically sound strategy that integrates slice timing correction with rigid-body motion correction in a way that minimizes interpolation-induced blurring, and compute the numerical value of the optimal $t_{\\mathrm{ref}}$ for this dataset. Express your final numerical answer for $t_{\\mathrm{ref}}$ in seconds, rounded to four significant figures.",
            "solution": "This problem has three parts: deriving the optimal slice timing correction reference time ($t_{\\mathrm{ref}}$), designing an integrated correction strategy, and computing the numerical value of $t_{\\mathrm{ref}}$.\n\n**Part 1: Derivation of the Optimal Reference Time $t_{\\mathrm{ref}}$**\n\nThe goal of slice timing correction (STC) is to adjust the data so that all slices in a volume appear to have been acquired at a single reference time, $t_{\\mathrm{ref}}$, within the Repetition Time ($TR$). The BOLD signal for slice $s$ is sampled at time $t_v + \\Delta t_s$, where $t_v$ is the volume onset and $\\Delta t_s$ is the slice acquisition time relative to the volume onset.\n\nSTC temporally shifts the signal for each slice from its acquisition time $\\Delta t_s$ to the reference time $t_{\\mathrm{ref}}$. This interpolation introduces an error, whose magnitude is related to the temporal shift distance, $|\\Delta t_s - t_{\\mathrm{ref}}|$. To minimize this interpolation error on average across the entire volume, we must choose a $t_{\\mathrm{ref}}$ that minimizes the mean squared temporal shift.\n\nAssuming slice acquisition times, $\\Delta t_s$, are uniformly distributed over the interval $[0, TR]$, we want to find the $t_{\\mathrm{ref}}$ that minimizes the expected squared error:\n$$ L(t_{\\mathrm{ref}}) = E_{\\Delta t_s}[(\\Delta t_s - t_{\\mathrm{ref}})^2] $$\nFor a continuous uniform distribution with probability density function $p(\\tau) = 1/TR$ for $\\tau \\in [0, TR]$, the expectation is:\n$$ L(t_{\\mathrm{ref}}) = \\int_0^{TR} (\\tau - t_{\\mathrm{ref}})^2 \\frac{1}{TR} d\\tau $$\nTo find the minimum, we differentiate $L(t_{\\mathrm{ref}})$ with respect to $t_{\\mathrm{ref}}$ and set the derivative to zero:\n$$ \\frac{dL}{dt_{\\mathrm{ref}}} = \\frac{d}{dt_{\\mathrm{ref}}} \\left[ \\frac{1}{TR} \\int_0^{TR} (\\tau^2 - 2\\tau t_{\\mathrm{ref}} + t_{\\mathrm{ref}}^2) d\\tau \\right] $$\nUsing the Leibniz integral rule, we can move the derivative inside the integral:\n$$ \\frac{dL}{dt_{\\mathrm{ref}}} = \\frac{1}{TR} \\int_0^{TR} \\frac{\\partial}{\\partial t_{\\mathrm{ref}}} (\\tau^2 - 2\\tau t_{\\mathrm{ref}} + t_{\\mathrm{ref}}^2) d\\tau = \\frac{1}{TR} \\int_0^{TR} (-2\\tau + 2t_{\\mathrm{ref}}) d\\tau $$\n$$ \\frac{dL}{dt_{\\mathrm{ref}}} = \\frac{2}{TR} \\left[ - \\frac{\\tau^2}{2} + t_{\\mathrm{ref}}\\tau \\right]_0^{TR} = \\frac{2}{TR} \\left( -\\frac{TR^2}{2} + t_{\\mathrm{ref}}TR - 0 \\right) = 2\\left(t_{\\mathrm{ref}} - \\frac{TR}{2}\\right) $$\nSetting the derivative to zero yields the optimal value:\n$$ 2\\left(t_{\\mathrm{ref}} - \\frac{TR}{2}\\right) = 0 \\implies t_{\\mathrm{ref}} = \\frac{TR}{2} $$\nThe second derivative, $\\frac{d^2L}{dt_{\\mathrm{ref}}^2} = 2 > 0$, confirms this is a minimum. The reference time that minimizes average interpolation error is the temporal midpoint of the acquisition window. Choosing this $t_{\\mathrm{ref}}$ and constructing GLM regressors to match this timing minimizes bias.\n\n**Part 2: Integrated Motion and Slice Timing Correction Strategy**\n\nA scientifically sound strategy must minimize data degradation from interpolation. Both motion correction (MC) and STC require resampling the data—MC in space and STC in time. Sequential application would involve two separate interpolations, compounding blurring and reducing data fidelity.\n\nThe optimal strategy is a single 4D resampling step:\n1.  **Estimate Transformations**: First, estimate the rigid-body transformation parameters for MC for each volume relative to a reference. This yields a set of spatial transformation matrices. The temporal transformation for STC is a shift for each slice to the reference time $t_{\\mathrm{ref}} = TR/2$.\n2.  **Combine Transformations**: Without applying the transforms, for each point in the target 4D grid (the final corrected dataset), calculate its corresponding source coordinate in the original raw 4D dataset. This calculation combines the inverse spatial transformation from MC and the inverse temporal shift from STC.\n3.  **Perform Single-Step 4D Resampling**: Apply a 4D interpolation function (e.g., using sinc or spline kernels) to the raw data at the calculated source coordinates to generate the value for each point in the final corrected grid. This single operation simultaneously corrects for both motion and slice timing offsets, applying only one interpolation step to the original data, thereby maximally preserving signal precision.\n\n**Part 3: Numerical Calculation of $t_{\\mathrm{ref}}$**\n\nFrom the derivation, the optimal reference time is $t_{\\mathrm{ref}} = TR/2$.\nThe problem provides the Repetition Time:\n$$ TR = 2 \\text{ s} $$\nTherefore, the optimal reference time is:\n$$ t_{\\mathrm{ref}} = \\frac{2 \\text{ s}}{2} = 1 \\text{ s} $$\nExpressed with four significant figures, the numerical value is $1.000$ seconds.",
            "answer": "$$\\boxed{1.000}$$"
        }
    ]
}