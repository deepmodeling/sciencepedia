{
    "hands_on_practices": [
        {
            "introduction": "在fMRI分析中，广义线性模型（GLM）的第一步是将抽象的实验事件转化为一个数值回归量（regressor）。这个练习将引导您完成这一基本过程，即通过一个事件时间序列与血流动力学响应函数（HRF）进行卷积来实现。本实践强调了在不同时间尺度（微观时间与重复时间 $T_R$）上进行精确建模的重要性，这是将实验设计与数学模型联系起来的核心信号处理任务。",
            "id": "4191942",
            "problem": "您正在将功能性磁共振成像 (fMRI) 设计矩阵的一列建模为在微时间分辨率下采样的离散事件脉冲函数与离散血流动力学响应函数 (HRF) 之间的卷积。fMRI 建模的假设是，血氧水平依赖 (BOLD) 信号可以很好地通过一个线性时不变 (LTI) 系统来近似，这意味着系统对输入的输出由卷积给出。事件脉冲函数将神经事件表示为在指定起始时间的脉冲，而 HRF 则表征了系统的脉冲响应。目标是通过在微时间分辨率下计算此卷积并降采样到重复时间采样网格来构建设计矩阵的单个列。\n\n从以下定义和事实开始：\n- 系统是线性时不变 (LTI) 的，因此对于输入 $u[n]$ 和脉冲响应 $h[n]$，其输出是离散卷积 $y[n] = \\sum_{k=-\\infty}^{\\infty} u[k] \\, h[n-k]$，对于有限长度的序列需要进行适当的零填充。\n- 设重复时间为 $T_R$ 秒，微时间因子为 $m \\in \\mathbb{N}$，这意味着微时间步长为 $\\Delta t = T_R / m$ 秒。\n- 设共有 $N_{\\text{TR}}$ 次扫描，因此总微时间长度为 $N_{\\mu} = N_{\\text{TR}} \\cdot m$ 个样本点。\n- 事件起始时间以相对于扫描周期开始的秒数给出，事件脉冲函数通过在微时间网格上的索引 $n_e = \\lfloor t_e / \\Delta t \\rfloor$ 处放置一个幅度为 $1$ 的脉冲来定义，其中 $t_e$ 是事件起始时间（秒）。只包括满足 $0 \\le n_e  N_{\\mu}$ 的索引；超出范围的事件将被忽略。\n- HRF $h[n]$ 以离散序列的形式提供，该序列以相同的微时间步长 $\\Delta t$ 采样，并具有有限长度 $L$。微时间域响应 $y[n]$ 通过计算 $u[n]$ 与 $h[n]$ 的完整离散卷积，然后裁剪为前 $N_{\\mu}$ 个样本来得到：$y[0], y[1], \\dots, y[N_{\\mu}-1]$。\n- 降采样到重复时间网格，得到设计列 $x[j] = y[j \\cdot m]$，其中 $j = 0, 1, \\dots, N_{\\text{TR}} - 1$。\n\n实现一个程序，为每个提供的测试用例构建事件脉冲函数 $u[n]$，与提供的 HRF $h[n]$ 进行离散卷积，将结果裁剪为 $N_{\\mu}$，并通过从索引 $0$ 开始每隔 $m$ 个样本选取一个来降采样，以形成设计列 $x[j]$。对事件起始时间 $t_e$ 使用映射 $n_e = \\lfloor t_e / \\Delta t \\rfloor$。所有时间量都必须以秒为单位处理。\n\n测试套件：\n对于每个测试用例，参数为 $(T_R, m, N_{\\text{TR}}, \\text{events}, h)$，其中 $T_R$ 是重复时间（秒），$m$ 是微时间因子（无单位整数），$N_{\\text{TR}}$ 是扫描次数（无单位整数），events 是起始时间的列表（秒），$h$ 是在微时间分辨率下采样的离散 HRF（无单位幅度）。使用以下测试用例：\n\n1. 一般情况：\n   - $T_R = 2.0$\n   - $m = 5$\n   - $N_{\\text{TR}} = 10$\n   - $\\text{events} = [4.0, 12.0]$\n   - $h = [0.0, 0.005, 0.020, 0.050, 0.090, 0.140, 0.180, 0.220, 0.250, 0.270, 0.280, 0.280, 0.270, 0.250, 0.220, 0.190, 0.160, 0.130, 0.100, 0.080, 0.060, 0.045, 0.030, 0.020, 0.010, 0.005, 0.000, -0.005, -0.008, -0.010]$\n\n2. 靠近开始和结束的边界事件：\n   - $T_R = 2.0$\n   - $m = 10$\n   - $N_{\\text{TR}} = 10$\n   - $\\text{events} = [0.0, 19.6]$\n   - $h = [0.0, 0.003, 0.012, 0.028, 0.050, 0.075, 0.100, 0.125, 0.145, 0.160, 0.170, 0.175, 0.176, 0.172, 0.165, 0.155, 0.140, 0.120, 0.100, 0.085, 0.070, 0.058, 0.047, 0.038, 0.030, 0.024, 0.019, 0.015, 0.012, 0.009, 0.007, 0.005, 0.003, 0.001, 0.000, -0.002, -0.004, -0.006, -0.008, -0.010]$\n\n3. 无事件：\n   - $T_R = 1.5$\n   - $m = 4$\n   - $N_{\\text{TR}} = 8$\n   - $\\text{events} = []$\n   - $h = [0.0, 0.010, 0.040, 0.090, 0.140, 0.180, 0.200, 0.210, 0.200, 0.180, 0.150, 0.120, 0.090, 0.070, 0.050, 0.035, 0.025, 0.015, 0.005, 0.000]$\n\n4. 多个紧密间隔的事件和一个靠近结尾的事件：\n   - $T_R = 1.25$\n   - $m = 8$\n   - $N_{\\text{TR}} = 16$\n   - $\\text{events} = [3.10, 3.25, 3.30, 19.99]$\n   - $h = [0.0, 0.002, 0.008, 0.018, 0.034, 0.055, 0.082, 0.115, 0.150, 0.180, 0.205, 0.220, 0.228, 0.230, 0.225, 0.215, 0.200, 0.180, 0.160, 0.140, 0.120, 0.105, 0.090, 0.078, 0.067, 0.057, 0.048, 0.040, 0.033, 0.027, 0.022, 0.018, 0.014, 0.011, 0.009, 0.007, 0.005, 0.004, 0.003, 0.002, 0.001, 0.0005, 0.0000, -0.0010, -0.0020, -0.0030, -0.0040, -0.0050, -0.0060, -0.0070]$\n\n您的程序必须为每个测试用例计算降采样后的设计列 $x[j]$（其中 $j = 0, 1, \\dots, N_{\\text{TR}} - 1$），并生成单行输出，该输出包含一个用方括号括起来的逗号分隔列表。其中每个元素对应一个测试用例的结果，其本身也是一个用方括号括起来的浮点数逗号分隔列表。所有浮点数表示为四舍五入到六位小数，并且输出中不包含任何空格。例如，包含两个测试用例的输出可能如下所示： “[[0.000000,0.123456],[0.000000,0.654321]]”。",
            "solution": "该问题要求为功能性磁共振成像 (fMRI) 分析中使用的设计矩阵构建单个列。此过程基于一个原理：测得的血氧水平依赖 (BOLD) 信号可以建模为线性时不变 (LTI) 系统的输出。解决方案涉及一系列信号处理步骤：生成神经事件模型，将其与血流动力学响应函数进行卷积，并在扫描仪的采集时间点对结果进行采样。\n\n该过程首先定义时间网格。实验包含 $N_{\\text{TR}}$ 次扫描，每次扫描每 $T_R$ 秒采集一次。为了以比扫描分辨率更高的保真度对生物响应进行建模，我们建立了一个更精细的“微时间”网格。该网格的时间分辨率为 $\\Delta t = T_R / m$，其中 $m$ 是整数微时间因子。实验在微时间样本中的总持续时间为 $N_{\\mu} = N_{\\text{TR}} \\cdot m$。\n\nLTI 系统的输入是神经活动的理想化表示，称为“事件脉冲函数”，记作 $u[n]$。这是微时间网格上长度为 $N_{\\mu}$ 的离散时间信号。对于在连续时间 $t_e$（秒）发生的每个刺激或认知事件，我们在微时间网格上放置一个幅度为 $1$ 的离散脉冲。相应的离散时间索引 $n_e$ 通过量化事件时间来确定：\n$$n_e = \\lfloor t_e / \\Delta t \\rfloor$$\n向下取整函数 $\\lfloor \\cdot \\rfloor$ 确保连续时间 $t_e$ 被映射到相应微时间区间的开始。然后将事件脉冲函数构建为一个除这些索引外全为零的向量。如果多个事件落入同一个微时间区间，它们对应的脉冲会相加，这是线性假设的直接结果。形式上，对于一组事件时间 $\\{t_{e_i}\\}$，脉冲函数为：\n$$u[n] = \\sum_i \\delta[n - \\lfloor t_{e_i} / \\Delta t \\rfloor]$$\n其中 $\\delta[k]$ 是克罗内克δ函数。起始时间在扫描窗口之外（即 $n_e  0$ 或 $n_e \\ge N_{\\mu}$）的事件将被忽略。\n\nLTI 系统本身由其脉冲响应，即血流动力学响应函数 (HRF) 来表征，记作 $h[n]$。问题将 $h[n]$ 作为长度为 $L$ 的有限长度离散序列提供，该序列以相同的微时间分辨率 $\\Delta t$ 采样。\n\nLTI 模型的核心是卷积运算。在微时间分辨率下预测的 BOLD 信号 $y[n]$ 是输入 $u[n]$ 与系统脉冲响应 $h[n]$ 的离散卷积：\n$$y[n] = (u * h)[n] = \\sum_{k=-\\infty}^{\\infty} u[k] h[n-k]$$\n对于有限长度序列 $u[n]$（长度 $N_{\\mu}$）和 $h[n]$（长度 $L$），“完整”卷积产生一个长度为 $N_{\\mu} + L - 1$ 的序列。这能正确地模拟对扫描后期发生的事件的响应，此时 HRF 可能会延伸到最终时间点 $N_{\\mu}-1$ 之后。然而，由于 fMRI 数据只采集到这个最终时间点，问题规定，卷积产生的信号必须裁剪为前 $N_{\\mu}$ 个样本。我们将这个裁剪后的信号称为 $y'[n]$，其中对于 $n \\in \\{0, 1, \\dots, N_{\\mu}-1\\}$，$y'[n] = y[n]$。\n\n最后，这个高分辨率的 BOLD 信号模型必须在与实际 fMRI 扫描仪采集相对应的时间点进行采样。扫描以 $T_R$ 的时间间隔采集，对应于时间 $t_j = j \\cdot T_R$，其中 $j \\in \\{0, 1, \\dots, N_{\\text{TR}}-1\\}$。在微时间域中，这些采集时间对应于索引 $j \\cdot m$。因此，最终的设计矩阵列 $x[j]$ 是通过对微时间信号 $y'[n]$ 进行降采样获得的：\n$$x[j] = y'[j \\cdot m] \\quad \\text{其中 } j = 0, 1, \\dots, N_{\\text{TR}}-1$$\n这个过程产生一个长度为 $N_{\\text{TR}}$ 的向量 $x$，它在广义线性模型 (GLM) 中用作回归量，以解释测量的 fMRI 时间序列中的方差。实现将为每个给定的测试用例精确遵循这些步骤，使用数值库高效地执行卷积和数组操作。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and formats the fMRI design matrix columns for all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (\n            2.0, 5, 10, [4.0, 12.0],\n            [0.0, 0.005, 0.020, 0.050, 0.090, 0.140, 0.180, 0.220, 0.250, 0.270, 0.280, 0.280, 0.270, 0.250, 0.220, 0.190, 0.160, 0.130, 0.100, 0.080, 0.060, 0.045, 0.030, 0.020, 0.010, 0.005, 0.000, -0.005, -0.008, -0.010]\n        ),\n        (\n            2.0, 10, 10, [0.0, 19.6],\n            [0.0, 0.003, 0.012, 0.028, 0.050, 0.075, 0.100, 0.125, 0.145, 0.160, 0.170, 0.175, 0.176, 0.172, 0.165, 0.155, 0.140, 0.120, 0.100, 0.085, 0.070, 0.058, 0.047, 0.038, 0.030, 0.024, 0.019, 0.015, 0.012, 0.009, 0.007, 0.005, 0.003, 0.001, 0.000, -0.002, -0.004, -0.006, -0.008, -0.010]\n        ),\n        (\n            1.5, 4, 8, [],\n            [0.0, 0.010, 0.040, 0.090, 0.140, 0.180, 0.200, 0.210, 0.200, 0.180, 0.150, 0.120, 0.090, 0.070, 0.050, 0.035, 0.025, 0.015, 0.005, 0.000]\n        ),\n        (\n            1.25, 8, 16, [3.10, 3.25, 3.30, 19.99],\n            [0.0, 0.002, 0.008, 0.018, 0.034, 0.055, 0.082, 0.115, 0.150, 0.180, 0.205, 0.220, 0.228, 0.230, 0.225, 0.215, 0.200, 0.180, 0.160, 0.140, 0.120, 0.105, 0.090, 0.078, 0.067, 0.057, 0.048, 0.040, 0.033, 0.027, 0.022, 0.018, 0.014, 0.011, 0.009, 0.007, 0.005, 0.004, 0.003, 0.002, 0.001, 0.0005, 0.0000, -0.0010, -0.0020, -0.0030, -0.0040, -0.0050, -0.0060, -0.0070]\n        )\n    ]\n    \n    results = []\n    for case in test_cases:\n        T_R, m, N_TR, events, h = case\n\n        # Calculate microtime parameters\n        dt = T_R / m\n        N_micro = N_TR * m\n\n        # Create the event stick function u[n]\n        u = np.zeros(N_micro)\n        for t_e in events:\n            n_e = int(np.floor(t_e / dt))\n            if 0 = n_e  N_micro:\n                u[n_e] += 1\n        \n        # Ensure h is a numpy array\n        h_np = np.array(h)\n        \n        # Compute the full discrete convolution\n        y_full = np.convolve(u, h_np, mode='full')\n        \n        # Crop the result to the first N_micro samples\n        y = y_full[:N_micro]\n        \n        # Downsample to the repetition time grid\n        x = y[::m]\n        \n        # Format the result as a string\n        formatted_list = [f\"{val:.6f}\" for val in x]\n        result_str = \"[\" + \",\".join(formatted_list) + \"]\"\n        results.append(result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在创建了单个回归量之后，我们需要将它们与截距、头部运动等其他变量组合成一个完整的设计矩阵。这个练习探讨了矩阵秩和线性无关性的关键概念，以确保模型是适定（well-posed）且可解的。理解秩亏（rank deficiency）的潜在来源对于稳健的实验设计和分析至关重要，它能帮助我们避免模型设定中的共线性陷阱。",
            "id": "4191926",
            "problem": "一位研究人员正在为功能性磁共振成像 (fMRI) 分析构建一个广义线性模型 (GLM)。该单次运行实验包含一个长度为 $N$ 的时间序列，每 $T_R$ 秒采样一次，其中 $N = 300$， $T_R = 2\\,\\mathrm{s}$，因此总扫描时长为 $600\\,\\mathrm{s}$。设计矩阵包含以下列：\n\n- 一个截距列，即一个由 1 组成的常数列。\n- 两个任务回归量，分别对应条件 $\\mathcal{A}$ 和 $\\mathcal{B}$，它们由各自的二元刺激时间序列（每个事件为一个持续 $2\\,\\mathrm{s}$ 的矩形脉冲）与一个固定的、已知的血流动力学响应函数 (HRF) 进行卷积构建而成。条件 $\\mathcal{A}$ 和 $\\mathcal{B}$各有 $20$ 个事件，它们的起始时间不重叠；在许多时间点上，两个条件均未激活（即存在真正的静息期）。\n- 六个头部运动伪迹回归量，对应于每个 $T_R$ 测量的平移和旋转。\n\n假设以下符合经验的现实条件成立：\n\n1. 运动回归量不是精确的常数，也不是彼此的精确线性组合。\n2. 没有任何一个运动回归量是任务回归量或截距的精确线性组合。\n3. HRF 是固定的、线性时不变的，且卷积是精确实现的（没有会引起精确简并性的混叠或数值近似）。\n4. 条件 $\\mathcal{A}$ 和 $\\mathcal{B}$ 的刺激时间序列不是彼此的标量倍数。\n\n从矩阵秩的基本定义（即其列空间的维度）以及向量线性无关的定义出发。仅使用这些定义和线性时不变系统的卷积线性性质，在所述假设下，论证设计矩阵的列之间是否存在精确的线性相关性。在你的论证中，明确阐述至少两种对所述设计进行修改的具体方式，这些修改会即使在当前假设下不适用，也会导致精确的秩亏。\n\n在上述条件下，计算本次运行的设计矩阵的秩。仅报告秩作为你的最终答案。秩是一个整数，无单位；无需四舍五入。",
            "solution": "问题要求我们确定一个功能性磁共振成像 (fMRI) 实验的特定设计矩阵的秩。矩阵的秩定义为其列空间的维度，这等价于矩阵中线性无关列的最大数量。\n\n首先，我们定义设计矩阵，记为 $X$。它是一个 $N \\times P$ 矩阵，其中 $N$ 是时间点（扫描）的数量，$P$ 是回归量（列）的数量。\n根据问题描述，我们有：\n- $N = 300$ 个时间点。\n- 回归量的数量 $P$ 是一个截距、两个任务回归量和六个运动回归量的总和。\n- $P = 1 (\\text{截距}) + 2 (\\text{任务}) + 6 (\\text{运动}) = 9$。\n因此，设计矩阵 $X$ 的维度是 $300 \\times 9$。$X$ 的最大可能秩为 $\\min(300, 9) = 9$。当且仅当其所有 $9$ 个列都是线性无关时，秩才精确等于 $9$。\n\n设矩阵 $X$ 的列向量表示如下：\n- $\\mathbf{c}_0$：截距列，一个长度为 $300$ 的全 1 向量。\n- $\\mathbf{r_A}$ 和 $\\mathbf{r_B}$：分别对应条件 $\\mathcal{A}$ 和 $\\mathcal{B}$ 的两个任务回归量。\n- $\\mathbf{m}_1, \\mathbf{m}_2, \\dots, \\mathbf{m}_6$：六个头部运动伪迹回归量。\n\n一组向量 $\\{\\mathbf{v}_1, \\dots, \\mathbf{v}_P\\}$ 是线性无关的，如果方程 $k_1\\mathbf{v}_1 + k_2\\mathbf{v}_2 + \\dots + k_P\\mathbf{v}_P = \\mathbf{0}$（其中 $\\mathbf{0}$ 是零向量）的唯一解是平凡解 $k_1 = k_2 = \\dots = k_P = 0$。我们必须评估这组包含 $9$ 个列向量的集合 $\\{\\mathbf{c}_0, \\mathbf{r_A}, \\mathbf{r_B}, \\mathbf{m}_1, \\dots, \\mathbf{m}_6\\}$ 是否线性无关。我们将使用给定的假设来进行论证。\n\n1.  **运动回归量的线性无关性：**\n    假设（1）指出，运动回归量不是彼此的精确线性组合。在一组向量的语境中，这正是线性无关的定义。因此，这六个运动回归量组成的集合 $\\{\\mathbf{m}_1, \\dots, \\mathbf{m}_6\\}$ 是线性无关的。\n\n2.  **任务回归量和截距的线性无关性：**\n    让我们考虑集合 $\\{\\mathbf{c}_0, \\mathbf{r_A}, \\mathbf{r_B}\\}$。要使它们线性无关，方程 $k_0\\mathbf{c}_0 + k_A\\mathbf{r_A} + k_B\\mathbf{r_B} = \\mathbf{0}$ 必须只有唯一解 $k_0=k_A=k_B=0$。\n    任务回归量 $\\mathbf{r_A}$ 和 $\\mathbf{r_B}$ 是通过将二元刺激时间序列（我们称之为 $S_A$ 和 $S_B$）与血流动力学响应函数 (HRF) $h(t)$ 进行卷积而形成的。问题指出存在真正的静息期，这意味着在某些时间段内，刺激 $\\mathcal{A}$ 和 $\\mathcal{B}$ 均未激活。在一个足够长的静息期内，HRF 将衰减回零。在这样的一个时间点 $t_j$，任务回归量的值将是 $\\mathbf{r_A}(t_j) \\approx 0$ 和 $\\mathbf{r_B}(t_j) \\approx 0$。然而，截距是恒定的：$\\mathbf{c}_0(t_j) = 1$。此时，线性相关方程变为 $k_0(1) + k_A(0) + k_B(0) = 0$，这意味着 $k_0=0$。\n    当 $k_0=0$ 时，方程简化为 $k_A\\mathbf{r_A} + k_B\\mathbf{r_B} = \\mathbf{0}$。\n    卷积是线性运算。因此，$k_A(S_A * h) + k_B(S_B * h) = (k_A S_A + k_B S_B) * h = \\mathbf{0}$。由于 HRF $h(t)$ 是一个固定的、已知的函数（并且隐含地不恒为零），要使卷积的输出为零，其输入必须为零。因此，$k_A S_A + k_B S_B = \\mathbf{0}$。\n    问题指出，条件 $\\mathcal{A}$ 和 $\\mathcal{B}$ 的刺激起始时间是不重叠的。这意味着至少存在一个时间点 $t_a$，在该点 $S_A(t_a) = 1$ 且 $S_B(t_a) = 0$。此时，方程变为 $k_A(1) + k_B(0) = 0$，这意味着 $k_A=0$。同样，必然存在一个时间点 $t_b$，在该点 $S_A(t_b) = 0$ 且 $S_B(t_b) = 1$，这意味着 $k_B=0$。\n    因此，我们证明了 $k_0=k_A=k_B=0$，这证明了集合 $\\{\\mathbf{c}_0, \\mathbf{r_A}, \\mathbf{r_B}\\}$ 是线性无关的。这个结论也依赖于假设（4），该假设保证了 $S_A$ 和 $S_B$ 不是彼此的标量倍数。我们关于不重叠事件的推理是一个确保了更强形式无关性的特例。\n\n3.  **完整回归量集合的线性无关性：**\n    我们已经确定，与任务相关的回归量子集 $\\{\\mathbf{c}_0, \\mathbf{r_A}, \\mathbf{r_B}\\}$ 是线性无关的，并且运动回归量的子集 $\\{\\mathbf{m}_1, \\dots, \\mathbf{m}_6\\}$ 也是线性无关的。现在我们必须考虑包含所有 $9$ 个回归量的整个集合。\n    如果运动回归量列空间中的某个向量可以被任务/截距回归量列空间中的某个向量完美表示，那么就存在线性相关性。\n    假设（2）指出，没有任何一个单独的运动回归量是任务回归量或截距的精确线性组合。虽然这在数学上并不禁止运动回归量的某个线性组合成为任务回归量的线性组合，但问题是在“符合经验的现实条件”下提出的。任务回归量源自确定性的、预先指定的实验设计。运动回归量源自一个随机的生物过程（被试的头部运动）。在任何现实情景中，这两组源于物理上和因果上独立来源的时间序列，在 $N=300$ 个样本上不会表现出精确的线性相关性。给定的假设旨在从数学上排除最常见的“设计性”共线性形式。从这种物理推理得出的结论是，由 $\\{\\mathbf{c}_0, \\mathbf{r_A}, \\mathbf{r_B}\\}$ 张成的子空间与由 $\\{\\mathbf{m}_1, \\dots, \\mathbf{m}_6\\}$ 张成的子空间之间，除了零向量外，不存在线性相关性。\n    因此，完整的 $9$ 个列的集合是线性无关的。\n\n由于这个 $300 \\times 9$ 的设计矩阵 $X$ 有 $9$ 个线性无关的列，其列空间的维度为 $9$。\n\n作为论证的一部分，我们必须阐述两种会导致秩亏（即精确共线性）的修改。\n1.  **在任务回归量之间引入共线性：** 如果改变实验设计，使得条件 $\\mathcal{A}$ 和条件 $\\mathcal{B}$ 总是在完全相同的时间发生，那么它们的刺激时间序列将是相同的，$S_A = S_B$。由于卷积的线性性质，它们对应的回归量也将是相同的，$\\mathbf{r_A} = \\mathbf{r_B}$。这将引入线性相关性，因为 $1 \\cdot \\mathbf{r_A} - 1 \\cdot \\mathbf{r_B} = \\mathbf{0}$。设计矩阵的秩将下降到最多为 $8$。这种修改违反了起始时间不重叠的前提和假设（4）。\n2.  **与截距引入共线性：** 如果某个运动测量设备发生故障，在整个扫描期间输出一个恒定值，那么对应的回归量（例如 $\\mathbf{m}_1$）将是一个常数向量。例如，对于某个常数 $k$，有 $\\mathbf{m}_1 = k \\cdot \\mathbf{1}$。截距列是 $\\mathbf{c}_0 = \\mathbf{1}$。这将产生线性相关性 $k \\cdot \\mathbf{c}_0 - 1 \\cdot \\mathbf{m}_1 = \\mathbf{0}$。矩阵将变得秩亏，秩最多为 $8$。这种修改违反了假设（1），该假设指出运动回归量不是精确的常数。\n\n基于给定的假设以及从秩和线性无关的定义出发的推理，该特定设计矩阵的 $9$ 个列是线性无关的。因此，矩阵的秩为 $9$。",
            "answer": "$$\n\\boxed{9}\n$$"
        },
        {
            "introduction": "拥有一个有效的设计矩阵后，下一步是解释其参数并检验科学假设。本实践深入探讨了虚拟编码（dummy coding），这是一种对分类因子进行编码的常用方法。它演示了如何构建对比向量（contrast vectors）来检验关于不同实验条件之间差异的具体假设，从而将数学模型与具体的实验问题直接联系起来。",
            "id": "4191947",
            "problem": "一位研究者设计了一项功能性磁共振成像 (fMRI) 研究，以考察一个具有三个有序水平（标记为低 ($L$)、中 ($M$) 和高 ($H$)）的单一认知因素。该研究采用组块设计 (block design)，每个体积的重复时间为 $2$ 秒，总共采集了 $60$ 个体积，并平均分配给三个条件：$L$ 条件 $20$ 个体积，$M$ 条件 $20$ 个体积，$H$ 条件 $20$ 个体积。为了明确关注设计的分类编码结构，研究者将回归量构建为不含血流动力学卷积的箱形指示函数，并指出这种选择隔离了线性模型的编码，同时仍在通用线性模型 (GLM) 的一般假设范围内。\n\n建模框架是通用线性模型 (GLM)，其中测得的血氧水平依赖信号 $y \\in \\mathbb{R}^{n}$ 被建模为 $y = X \\beta + \\epsilon$，其中 $\\epsilon \\sim \\mathcal{N}(0, \\sigma^{2} I)$，$X \\in \\mathbb{R}^{n \\times p}$ 是设计矩阵，$\\beta \\in \\mathbb{R}^{p}$ 是参数向量，$\\epsilon$ 是均值为零的高斯误差向量。研究者使用带截距的虚拟编码 (dummy coding)，选择 $L$ 作为基线条件。具体来说，设计矩阵 $X$ 有三列：一个截距项 $x_{0}$，对所有 $n=60$ 个观测值均为1；一个虚拟回归量 $x_{M}$，对于分配给 $M$ 的体积为 $1$，否则为 $0$；以及一个虚拟回归量 $x_{H}$，对于分配给 $H$ 的体积为 $1$，否则为 $0$。基线水平 $L$ 没有自己的列，其均值被截距项吸收。\n\n从 GLM 的第一性原理出发，推导检验三个条件均值之间的成对差异（$L$ 与 $M$、$L$ 与 $H$、以及 $M$ 与 $H$）以及三水平因素的总体效应（即，检验非基线水平与基线相比是否存在任何偏差的综合检验）所需的对比结构。仅使用 GLM 的定义、虚拟编码的含义以及在这种编码下 $\\beta$ 的可解释性来构建适当的对比向量和对比矩阵。\n\n最后，考虑在这种平衡配置下设计矩阵 $X$ 的信息含量。将 $x_{0}$、$x_{M}$ 和 $x_{H}$ 按上述规定处理，计算格拉姆矩阵 (Gram matrix) $X^{\\top} X$ 的行列式，其中 $n=60$ 且平衡计数为 $n_{L} = 20$、$n_{M} = 20$ 和 $n_{H} = 20$。最终答案表示为一个无单位的实数。无需四舍五入。",
            "solution": "该解答分为两部分，与问题的目标一致。\n\n#### 第1部分：对比结构的推导\n通用线性模型由 $y = X \\beta + \\epsilon$ 给出。对于给定的观测值，信号 $y$ 的期望值为 $E[y] = X_{row} \\beta$，其中 $X_{row}$ 是设计矩阵 $X$ 的对应行。我们必须首先通过检查每种条件下的模型来解释参数 $\\beta = [\\beta_0, \\beta_M, \\beta_H]^\\top$。\n\n设 $\\mu_L$、$\\mu_M$ 和 $\\mu_H$ 分别为低、中、高条件的真实平均激活水平。\n\n1.  **对于条件 $L$ (基线) 下的一次扫描**：$X$ 中的对应行为 $[1, 0, 0]$。因此，期望信号为：\n    $$E[y_L] = [1, 0, 0] \\begin{pmatrix} \\beta_0 \\\\ \\beta_M \\\\ \\beta_H \\end{pmatrix} = 1 \\cdot \\beta_0 + 0 \\cdot \\beta_M + 0 \\cdot \\beta_H = \\beta_0$$\n    因此，$\\mu_L = \\beta_0$。截距项 $\\beta_0$ 代表基线条件 $L$ 的平均激活水平。\n\n2.  **对于条件 $M$ 下的一次扫描**：$X$ 中的对应行为 $[1, 1, 0]$。期望信号为：\n    $$E[y_M] = [1, 1, 0] \\begin{pmatrix} \\beta_0 \\\\ \\beta_M \\\\ \\beta_H \\end{pmatrix} = 1 \\cdot \\beta_0 + 1 \\cdot \\beta_M + 0 \\cdot \\beta_H = \\beta_0 + \\beta_M$$\n    因此，$\\mu_M = \\beta_0 + \\beta_M$。这意味着 $\\beta_M = \\mu_M - \\beta_0 = \\mu_M - \\mu_L$。参数 $\\beta_M$ 代表条件 $M$ 的平均激活水平与基线条件 $L$ 的平均激活水平之差。\n\n3.  **对于条件 $H$ 下的一次扫描**：$X$ 中的对应行为 $[1, 0, 1]$。期望信号为：\n    $$E[y_H] = [1, 0, 1] \\begin{pmatrix} \\beta_0 \\\\ \\beta_M \\\\ \\beta_H \\end{pmatrix} = 1 \\cdot \\beta_0 + 0 \\cdot \\beta_M + 1 \\cdot \\beta_H = \\beta_0 + \\beta_H$$\n    因此，$\\mu_H = \\beta_0 + \\beta_H$。这意味着 $\\beta_H = \\mu_H - \\beta_0 = \\mu_H - \\mu_L$。参数 $\\beta_H$ 代表条件 $H$ 的平均激活水平与基线条件 $L$ 的平均激活水平之差。\n\n有了这些解释，我们就可以为形式为 $H_0: c^\\top\\beta = 0$ 的零假设构建对比向量 $c$。\n\n- **$L$ 与 $M$ 的对比**：我们检验零假设，即 $L$ 和 $M$ 的均值之间没有差异，即 $H_0: \\mu_M - \\mu_L = 0$。根据我们的参数解释，这等价于 $H_0: \\beta_M = 0$。相应的参数线性组合是 $0 \\cdot \\beta_0 + 1 \\cdot \\beta_M + 0 \\cdot \\beta_H$。所需的对比向量是：\n  $$c_{M-L} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$$\n\n- **$L$ 与 $H$ 的对比**：我们检验 $H_0: \\mu_H - \\mu_L = 0$。这等价于 $H_0: \\beta_H = 0$。线性组合是 $0 \\cdot \\beta_0 + 0 \\cdot \\beta_M + 1 \\cdot \\beta_H$。对比向量是：\n  $$c_{H-L} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}$$\n\n- **$M$ 与 $H$ 的对比**：我们检验 $H_0: \\mu_H - \\mu_M = 0$。用 $\\beta$ 参数表示条件均值：$(\\beta_0 + \\beta_H) - (\\beta_0 + \\beta_M) = \\beta_H - \\beta_M$。所以，我们检验 $H_0: \\beta_H - \\beta_M = 0$。线性组合是 $0 \\cdot \\beta_0 - 1 \\cdot \\beta_M + 1 \\cdot \\beta_H$。对比向量是：\n  $$c_{H-M} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix}$$\n\n- **综合检验**：因素总体效应的综合检验旨在探究非基线水平与基线水平相比是否存在任何差异。这是一个对零假设 $H_0: \\beta_M = 0$ 和 $\\beta_H = 0$ 的联合检验。这两个假设是线性无关的。我们可以构建一个对比矩阵 $C$，其中每一行对应这些假设中的一个。\n  $$C_{omnibus} = \\begin{pmatrix} 0  1  0 \\\\ 0  0  1 \\end{pmatrix}$$\n这个矩阵检验联合零假设 $C_{omnibus}\\beta = \\mathbf{0}$。\n\n#### 第2部分：$\\det(X^{\\top} X)$ 的计算\n格拉姆矩阵是 $X^{\\top} X$，一个 $p \\times p$ 的对称矩阵，其中第 $(i, j)$ 个元素是 $X$ 的第 $i$ 列和第 $j$ 列的内积，记作 $x_{i-1}^{\\top} x_{j-1}$。给定我们的3列设计矩阵 $X = [x_0, x_M, x_H]$，格拉姆矩阵为：\n$$X^{\\top} X = \\begin{pmatrix} x_0^{\\top} x_0  x_0^{\\top} x_M  x_0^{\\top} x_H \\\\ x_M^{\\top} x_0  x_M^{\\top} x_M  x_M^{\\top} x_H \\\\ x_H^{\\top} x_0  x_H^{\\top} x_M  x_H^{\\top} x_H \\end{pmatrix}$$\n我们使用给定的计数 $n=60$，$n_L=20$，$n_M=20$，$n_H=20$ 计算每个元素：\n\n- $x_0^{\\top} x_0 = \\sum_{i=1}^{n} 1 \\cdot 1 = n = 60$。\n- $x_0^{\\top} x_M = \\sum_{i \\in M} 1 \\cdot 1 + \\sum_{i \\notin M} 1 \\cdot 0 = n_M = 20$。\n- $x_0^{\\top} x_H = \\sum_{i \\in H} 1 \\cdot 1 + \\sum_{i \\notin H} 1 \\cdot 0 = n_H = 20$。\n- $x_M^{\\top} x_M = \\sum_{i \\in M} 1^2 + \\sum_{i \\notin M} 0^2 = n_M = 20$。\n- $x_H^{\\top} x_H = \\sum_{i \\in H} 1^2 + \\sum_{i \\notin H} 0^2 = n_H = 20$。\n- $x_M^{\\top} x_H = \\sum_{i=1}^{n} x_{Mi} x_{Hi}$。因为这些条件是互斥的，所以对于任何一次扫描 $i$，$x_{Mi}$ 或 $x_{Hi}$ 中至少有一个必须为零。因此，它们的乘积始终为零，总和为 $0$。\n\n将这些值代入矩阵中：\n$$X^{\\top} X = \\begin{pmatrix} 60  20  20 \\\\ 20  20  0 \\\\ 20  0  20 \\end{pmatrix}$$\n我们现在使用沿第一行的代数余子式展开来计算行列式：\n\\begin{align*}\n\\det(X^{\\top} X) = 60 \\cdot \\det \\begin{pmatrix} 20  0 \\\\ 0  20 \\end{pmatrix} - 20 \\cdot \\det \\begin{pmatrix} 20  0 \\\\ 20  20 \\end{pmatrix} + 20 \\cdot \\det \\begin{pmatrix} 20  20 \\\\ 20  0 \\end{pmatrix} \\\\\n= 60 \\cdot (20 \\cdot 20 - 0 \\cdot 0) - 20 \\cdot (20 \\cdot 20 - 0 \\cdot 20) + 20 \\cdot (20 \\cdot 0 - 20 \\cdot 20) \\\\\n= 60 \\cdot (400) - 20 \\cdot (400) + 20 \\cdot (-400) \\\\\n= 24000 - 8000 - 8000 \\\\\n= 8000\n\\end{align*}",
            "answer": "$$\\boxed{8000}$$"
        }
    ]
}