{
    "hands_on_practices": [
        {
            "introduction": "这项首个实践是基础性的。我们将把高斯函数的抽象概念转化为一个具体的数字滤波器。你将推导全宽半高（FWHM）和标准差之间的基本关系，然后用它来创建一个离散的一维平滑核，并在此过程中学习到诸如截断和归一化等实际考虑因素。这项练习构成了所有空间平滑操作的基石。",
            "id": "4164563",
            "problem": "功能性磁共振成像（fMRI）中一个常见的预处理步骤是使用高斯核沿每个成像轴进行空间平滑。考虑一维体素线，其各向同性体素宽度为 $h=3$ 毫米，并假设高斯平滑核的目标半峰全宽（FWHM）沿此轴为 $6$ 毫米。仅从标准差为 $\\sigma$ 的高斯函数 $G(x)$ 的定义以及半峰全宽（FWHM）作为 $G(x)$ 达到其峰值一半的两个点之间的距离的定义出发：\n- 推导 $\\mathrm{FWHM}$ 与 $\\sigma$ 之间的关系。\n- 对于给定的 $\\mathrm{FWHM}=6$ 毫米，计算 $\\sigma$，并以毫米和体素单位（即除以 $h$）表示 $\\sigma$。\n- 设整数体素偏移量 $k \\in \\mathbb{Z}$ 处的离散核权重从连续高斯形状中采样，即 $w_{k}^{\\mathrm{raw}} \\propto \\exp\\!\\big(-k^{2}/(2\\sigma_{\\mathrm{vox}}^{2})\\big)$，其中 $\\sigma_{\\mathrm{vox}}$ 是以体素为单位的 $\\sigma$。使用 $3\\sigma$ 截断规则，确定要保留的有限索引集。\n- 归一化截断后的权重，使其总和为 $1$。\n\n解释在离散卷积中，基于高斯尾部行为以及准确性与计算效率之间的实际权衡，在 $3\\sigma$ 处进行截断的原理。报告最终归一化的一维核权重，形式为单个行向量，按顺序对应索引 $k=-2,-1,0,1,2$。不要四舍五入；如果可以，请提供精确值。最终答案必须仅为该向量，在适当情况下使用 LaTeX 分数表示，且不得包含单位。",
            "solution": "问题陈述经解析和验证，具有科学依据、提法明确且客观。它为 fMRI 数据分析中的一个标准流程提供了一套完整且一致的给定条件。因此，我们可以进行完整解答。\n\n该问题需要分四部分解答：首先，推导高斯函数的半峰全宽（$\\mathrm{FWHM}$）与标准差（$\\sigma$）之间的关系；其次，根据给定参数计算 $\\sigma$；第三，使用截断规则确定离散平滑核的大小；第四，计算该离散核的归一化权重。\n\n**1. $\\mathrm{FWHM}$ 与 $\\sigma$ 关系的推导**\n\n以 $x=0$ 为中心的一维高斯函数由下式给出：\n$$G(x) = A \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)$$\n其中 $A$ 是振幅，$\\sigma$ 是标准差。\n\n函数的峰值出现在 $x=0$ 处，此时 $G(0) = A \\exp(0) = A$。\n$\\mathrm{FWHM}$ 定义为函数值等于其峰值一半的两个点 $x$ 之间的距离，即 $G(x) = \\frac{A}{2}$。\n\n我们将 $G(x)$ 设为其最大值的一半，并求解 $x$：\n$$A \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right) = \\frac{A}{2}$$\n两边除以 $A$（假设 $A \\neq 0$），我们得到：\n$$\\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right) = \\frac{1}{2}$$\n取两边的自然对数：\n$$-\\frac{x^2}{2\\sigma^2} = \\ln\\left(\\frac{1}{2}\\right) = -\\ln(2)$$\n求解 $x^2$：\n$$x^2 = 2\\sigma^2\\ln(2)$$\n这两个点是：\n$$x = \\pm\\sqrt{2\\sigma^2\\ln(2)} = \\pm\\sigma\\sqrt{2\\ln(2)}$$\n$\\mathrm{FWHM}$ 是这两点之间的绝对差值：\n$$\\mathrm{FWHM} = \\left( \\sigma\\sqrt{2\\ln(2)} \\right) - \\left( -\\sigma\\sqrt{2\\ln(2)} \\right) = 2\\sigma\\sqrt{2\\ln(2)}$$\n这就是 $\\mathrm{FWHM}$ 和 $\\sigma$ 之间的基本关系。\n\n**2. $\\sigma$ 的计算**\n\n给定目标 $\\mathrm{FWHM} = 6$ 毫米。我们现在可以计算以物理单位（毫米）表示的 $\\sigma$：\n$$\\sigma = \\frac{\\mathrm{FWHM}}{2\\sqrt{2\\ln(2)}} = \\frac{6 \\text{ mm}}{2\\sqrt{2\\ln(2)}} = \\frac{3}{\\sqrt{2\\ln(2)}} \\text{ mm}$$\n问题还指定了各向同性体素宽度 $h=3$ 毫米。为了以体素单位表示 $\\sigma$，我们将其除以 $h$。令此值为 $\\sigma_{\\mathrm{vox}}$：\n$$\\sigma_{\\mathrm{vox}} = \\frac{\\sigma}{h} = \\frac{3 / \\sqrt{2\\ln(2)} \\text{ mm}}{3 \\text{ mm}} = \\frac{1}{\\sqrt{2\\ln(2)}} \\text{ voxels}$$\n\n**3. 核截断**\n\n问题指定了 $3\\sigma$ 截断规则。这意味着离散核应包含整数体素偏移量 $k$，其对应的物理距离 $|k \\cdot h|$ 小于或等于 $3\\sigma$。以体素单位表示，这等同于 $|k| \\le 3\\sigma_{\\mathrm{vox}}$。\n我们来计算这个界限：\n$$3\\sigma_{\\mathrm{vox}} = 3 \\times \\frac{1}{\\sqrt{2\\ln(2)}} = \\frac{3}{\\sqrt{2\\ln(2)}}$$\n为了找到整数索引，我们对该值进行近似计算：$\\ln(2) \\approx 0.693147$。\n$$3\\sigma_{\\mathrm{vox}} \\approx \\frac{3}{\\sqrt{2 \\times 0.693147}} = \\frac{3}{\\sqrt{1.386294}} \\approx \\frac{3}{1.17741} \\approx 2.548$$\n整数体素索引 $k$ 必须满足 $|k| \\le 2.548$。满足此条件的整数集合是：\n$$k \\in \\{-2, -1, 0, 1, 2\\}$$\n$3\\sigma$ 截断规则的原理是一种实际的权衡。理论上，高斯函数延伸至无穷大。然而，其值在尾部迅速减小。区间 $[-3\\sigma, 3\\sigma]$ 包含了高斯曲线下约 $99.73\\%$ 的总面积。通过截断此范围之外的核，我们保留了核的绝大部分能量，从而确保了平滑操作的高保真度。包含更远的体素（例如，达到 $4\\sigma$ 或 $5\\sigma$）只会给核增加非常小的权重，对准确性的提升微乎其微，却会大幅增加成像体积中每个体素进行卷积所需的乘法和加法运算次数。$3\\sigma$ 规则是计算效率和准确性之间一个被广泛接受的折衷方案。\n\n**4. 核权重的归一化**\n\n离散核权重 $w_k$ 是在整数体素偏移量 $k$ 处从连续高斯形状中采样的：\n$$w_{k}^{\\mathrm{raw}} \\propto \\exp\\left(-\\frac{k^2}{2\\sigma_{\\mathrm{vox}}^2}\\right)$$\n我们可以代入 $\\sigma_{\\mathrm{vox}}^2$ 的表达式：\n$$\\sigma_{\\mathrm{vox}}^2 = \\left(\\frac{1}{\\sqrt{2\\ln(2)}}\\right)^2 = \\frac{1}{2\\ln(2)}$$\n因此，$2\\sigma_{\\mathrm{vox}}^2 = \\frac{1}{\\ln(2)}$。将此代入权重公式，得到一个非常简洁的形式：\n$$w_{k}^{\\mathrm{raw}} = \\exp\\left(-\\frac{k^2}{1/\\ln(2)}\\right) = \\exp(-k^2\\ln(2)) = \\exp(\\ln(2^{-k^2})) = 2^{-k^2}$$\n我们计算索引 $k \\in \\{-2, -1, 0, 1, 2\\}$ 的原始权重：\n$$w_{0}^{\\mathrm{raw}} = 2^{-0^2} = 2^0 = 1$$\n$$w_{1}^{\\mathrm{raw}} = 2^{-1^2} = 2^{-1} = \\frac{1}{2}$$\n$$w_{-1}^{\\mathrm{raw}} = 2^{-(-1)^2} = 2^{-1} = \\frac{1}{2}$$\n$$w_{2}^{\\mathrm{raw}} = 2^{-2^2} = 2^{-4} = \\frac{1}{16}$$\n$$w_{-2}^{\\mathrm{raw}} = 2^{-(-2)^2} = 2^{-4} = \\frac{1}{16}$$\n为了归一化，我们首先求出这些原始权重的总和 $S$：\n$$S = \\sum_{k=-2}^{2} w_{k}^{\\mathrm{raw}} = \\frac{1}{16} + \\frac{1}{2} + 1 + \\frac{1}{2} + \\frac{1}{16} = 1 + 1 + \\frac{2}{16} = 2 + \\frac{1}{8} = \\frac{17}{8}$$\n最终的归一化权重 $w_k = w_{k}^{\\mathrm{raw}} / S$ 为：\n$$w_0 = \\frac{1}{17/8} = \\frac{8}{17}$$\n$$w_1 = w_{-1} = \\frac{1/2}{17/8} = \\frac{1}{2} \\cdot \\frac{8}{17} = \\frac{4}{17}$$\n$$w_2 = w_{-2} = \\frac{1/16}{17/8} = \\frac{1}{16} \\cdot \\frac{8}{17} = \\frac{1}{34}$$\n最终的一维核，表示为对应索引 $k=(-2, -1, 0, 1, 2)$ 的行向量，是：\n$$\\begin{pmatrix} w_{-2} & w_{-1} & w_{0} & w_{1} & w_{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{34} & \\frac{4}{17} & \\frac{8}{17} & \\frac{4}{17} & \\frac{1}{34} \\end{pmatrix}$$\n作为检验，这些归一化权重的总和为 $\\frac{1}{34} + \\frac{8}{34} + \\frac{16}{34} + \\frac{8}{34} + \\frac{1}{34} = \\frac{34}{34} = 1$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{34}  \\frac{4}{17}  \\frac{8}{17}  \\frac{4}{17}  \\frac{1}{34}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "现实世界的功能磁共振成像数据通常具有非立方体的体素，这一特性被称为各向异性。这项实践将挑战你如何为这类数据调整平滑过程。你将学习如何通过在体素空间中设计一个各向异性的核，来保持物理空间中各向同性的平滑效果，这是确保神经科学推论有效性的关键一步。",
            "id": "4164641",
            "problem": "一位研究人员在分析功能性磁共振成像 (fMRI) 数据时，打算使用一个三维高斯核进行空间平滑，以达到指定的半峰全宽 (FWHM)（单位为毫米）。该数据集具有各向异性体素采样，其体素尺寸 $(\\Delta_x,\\Delta_y,\\Delta_z)$ 分别为 $\\Delta_x = 1.8$ 毫米、$\\Delta_y = 2.0$ 毫米和 $\\Delta_z = 3.6$ 毫米。平滑核期望的物理 FWHM 为 $7.5$ 毫米，在物理空间中的所有空间轴向上均相同。\n\n请从高斯函数和 FWHM 的核心定义出发，并基于离散体素空间中的卷积对应于在间距为 $(\\Delta_x,\\Delta_y,\\Delta_z)$ 的网格上对连续核进行采样的概念，推导从期望的物理 FWHM 到高斯核沿各轴的标准差 $\\sigma$（以体素为单位）的转换关系。在推导中仅使用这些基本原理；不要假设或引用任何专门的简化公式。\n\n计算沿 $x$、$y$ 和 $z$ 轴的 $\\sigma$ 值（以体素为单位），记为 $(\\sigma_x,\\sigma_y,\\sigma_z)$，并将其作为无量纲量报告。将最终数值结果四舍五入至四位有效数字。此外，从采样和有效点扩散函数形状的角度，简要解释各向异性体素尺寸对于在离散空间中实现物理上各向同性的平滑所产生的影响。",
            "solution": "该问题要求在给定一个期望的各向同性物理半峰全宽 (FWHM) 和各向异性的体素尺寸的情况下，推导高斯平滑核的标准差 $(\\sigma_x, \\sigma_y, \\sigma_z)$（以体素为单位）。解答过程将分为四个部分：首先，推导高斯函数的 FWHM 与标准差 $\\sigma$ 之间的基本关系；其次，将此关系从物理空间转换到离散体素空间；第三，对所需的 $\\sigma$ 值进行数值计算；第四，解释这种转换所带来的影响。\n\n首先，我们推导 FWHM 和 $\\sigma$ 之间的关系。一个以原点为中心的一维高斯函数可以写成：\n$$g(x) = \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)$$\n该函数的最大值为 $g(0) = 1$。FWHM 定义为函数值等于其最大值一半处的宽度。我们必须找到使 $g(x) = \\frac{1}{2}$ 成立的坐标 $x$。设这些点为 $\\pm x_{1/2}$。\n$$\\exp\\left(-\\frac{x_{1/2}^2}{2\\sigma^2}\\right) = \\frac{1}{2}$$\n对两边取自然对数，得到：\n$$-\\frac{x_{1/2}^2}{2\\sigma^2} = \\ln\\left(\\frac{1}{2}\\right) = -\\ln(2)$$\n解出 $x_{1/2}^2$:\n$$x_{1/2}^2 = 2\\sigma^2 \\ln(2)$$\n这两个点是 $x_{1/2} = \\pm \\sigma \\sqrt{2 \\ln(2)}$。FWHM 是这两点之间的距离：\n$$\\text{FWHM} = (\\sigma \\sqrt{2 \\ln(2)}) - (-\\sigma \\sqrt{2 \\ln(2)}) = 2\\sigma \\sqrt{2 \\ln(2)}$$\n这可以更简洁地写成：\n$$\\text{FWHM} = \\sigma \\sqrt{8 \\ln(2)}$$\n这个方程提供了高斯分布的标准差 $\\sigma$ 和 FWHM 之间的直接转换关系。\n\n其次，我们必须将物理空间中的参数（以毫米为单位）与离散体素空间中的参数（以体素为单位，一个无量纲量）联系起来。设期望的物理 FWHM 为 $\\text{FWHM}_p$，其被指定为各向同性，即在所有轴向上都相同。设物理单位中相应的标准差为 $\\sigma_p$。根据我们的推导：\n$$\\sigma_p = \\frac{\\text{FWHM}_p}{\\sqrt{8 \\ln(2)}}$$\n体素尺寸给定为 $(\\Delta_x, \\Delta_y, \\Delta_z)$。这些值表示单个体素沿每个轴的物理尺寸（例如，单位为毫米/体素）。高斯核的标准差可以用物理单位 ($\\sigma_p$) 或体素单位 ($\\sigma_x, \\sigma_y, \\sigma_z$) 表示。它们之间的关系是每个维度上按体素大小进行的简单缩放：\n$$\\sigma_p = \\sigma_x \\Delta_x$$\n$$\\sigma_p = \\sigma_y \\Delta_y$$\n$$\\sigma_p = \\sigma_z \\Delta_z$$\n为了实现各向同性的物理平滑效果（即所有方向上的 $\\sigma_p$ 相同），体素单位的标准差在每个方向上必须不同，以补偿各向异性的体素尺寸。我们可以解出每个轴上以体素为单位的标准差：\n$$\\sigma_x = \\frac{\\sigma_p}{\\Delta_x} = \\frac{\\text{FWHM}_p}{\\Delta_x \\sqrt{8 \\ln(2)}}$$\n$$\\sigma_y = \\frac{\\sigma_p}{\\Delta_y} = \\frac{\\text{FWHM}_p}{\\Delta_y \\sqrt{8 \\ln(2)}}$$\n$$\\sigma_z = \\frac{\\sigma_p}{\\Delta_z} = \\frac{\\text{FWHM}_p}{\\Delta_z \\sqrt{8 \\ln(2)}}$$\n\n第三，我们计算 $(\\sigma_x, \\sigma_y, \\sigma_z)$ 的数值。给定值为 $\\text{FWHM}_p = 7.5$ 毫米, $\\Delta_x = 1.8$ 毫米, $\\Delta_y = 2.0$ 毫米, 以及 $\\Delta_z = 3.6$ 毫米。\n首先，我们计算常数因子：\n$$\\sqrt{8 \\ln(2)} \\approx \\sqrt{8 \\times 0.693147} \\approx \\sqrt{5.545177} \\approx 2.354820$$\n现在我们可以计算每个轴上以体素为单位的标准差：\n$$\\sigma_x = \\frac{7.5}{1.8 \\times \\sqrt{8 \\ln(2)}} \\approx \\frac{7.5}{1.8 \\times 2.354820} \\approx \\frac{7.5}{4.238676} \\approx 1.76943$$\n$$\\sigma_y = \\frac{7.5}{2.0 \\times \\sqrt{8 \\ln(2)}} \\approx \\frac{7.5}{2.0 \\times 2.354820} \\approx \\frac{7.5}{4.709640} \\approx 1.59249$$\n$$\\sigma_z = \\frac{7.5}{3.6 \\times \\sqrt{8 \\ln(2)}} \\approx \\frac{7.5}{3.6 \\times 2.354820} \\approx \\frac{7.5}{8.477352} \\approx 0.88471$$\n将这些结果四舍五入到四位有效数字，我们得到：\n$$\\sigma_x \\approx 1.769$$\n$$\\sigma_y \\approx 1.592$$\n$$\\sigma_z \\approx 0.8847$$\n\n第四，我们解释各向异性体素尺寸的影响。物理上各向同性平滑的目标是确保平滑操作的有效点扩散函数 (PSF) 在连续物理空间中是球形对称的。在这种情况下，PSF 是一个在所有方向上具有相同标准差 $\\sigma_p$ 的高斯函数。然而，fMRI 数据存在于一个离散的体素网格上，在本问题中，该网格是各向异性的——即每个轴上的采样密度不同。为了在物理空间中创建一个球形对称的 PSF，用于卷积的离散核在体素空间中必须是各向异性的。\n我们的计算证明了这种必要性：$\\sigma_x \\neq \\sigma_y \\neq \\sigma_z$。以体素为单位的标准差在体素尺寸最小的轴上最大（对于 $\\Delta_x = 1.8$ 毫米，$\\sigma_x \\approx 1.769$），而在体素尺寸最大的轴上最小（对于 $\\Delta_z = 3.6$ 毫米，$\\sigma_z \\approx 0.8847$）。这意味着离散高斯核在体素坐标中，沿着高空间采样（小体素）的方向被“拉伸”，而沿着低空间采样（大体素）的方向被“压缩”。如果在体素空间中简单地使用一个各向同性的核（例如，$\\sigma_x = \\sigma_y = \\sigma_z$），那么在物理空间中产生的平滑效果将是各向异性的，在体素尺寸较大的轴上会应用更强的模糊。因此，为了正确实现物理上各向同性的平滑，软件必须在离散体素网格中构建一个各向异性的核，以精确抵消底层数据采样的各向异性。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.769 & 1.592 & 0.8847\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "对一个大型三维fMRI数据体进行平滑处理，其计算量可能非常巨大。这最后一个练习将探讨核可分离性这一优雅而强大的概念，它是实现高效平滑的关键。通过比较朴素的三维卷积与一系列三次一维卷积，你将量化地感受到巨大的计算优势，正是这种优势使得大规模fMRI分析成为可能。",
            "id": "4164640",
            "problem": "一个功能性磁共振成像 (fMRI) 数据体使用各向同性高斯核进行平滑处理。该数据体的维度为 $N_{x} = 128$、$N_{y} = 128$、$N_{z} = 64$ 体素，各向同性体素大小为 $s = 2\\ \\mathrm{mm}$。目标平滑度为 $8\\ \\mathrm{mm}$ 的半峰全宽 (FWHM)。离散核的构建方式为：沿每个轴在 $\\pm M \\sigma$ 处截断连续高斯函数，其中 $M = 3$，$\\sigma$ 是高斯标准差，离散核沿每个轴的长度为 $K = 2 r + 1$，其中 $r = \\lceil M \\sigma / s \\rceil$。\n\n从卷积的定义和高斯函数的定义出发，并利用从第一性原理推导出的 FWHM 与高斯标准差之间的关系，比较以下两种方法的计算复杂度（以总乘法运算次数衡量）：\n- 使用完整的 $K \\times K \\times K$ 核，在单次处理中应用朴素三维卷积。\n- 沿 $x$、$y$ 和 $z$ 轴依次应用三次一维卷积（利用高斯函数的可分离性）。\n\n假设是内部体素，因此边界效应不改变每个体素的操作计数，并计算整个数据体所需的乘法次数。计算朴素三维卷积所需的总乘法次数与可分离三遍一维卷积所需的总乘法次数之比 $R$，并将 $R$ 表示为一个无量纲实数。将最终答案四舍五入到四位有效数字。",
            "solution": "在尝试求解之前，需要验证问题的前提条件。\n\n### 第1步：提取已知条件\n- fMRI 数据体维度：$N_{x} = 128$，$N_{y} = 128$，$N_{z} = 64$ 体素。\n- 体素大小（各向同性）：$s = 2\\ \\mathrm{mm}$。\n- 目标平滑度：半峰全宽 (FWHM) $= 8\\ \\mathrm{mm}$。\n- 核截断参数：$M = 3$。核在 $\\pm M \\sigma$ 处被截断。\n- 单轴离散核长度：$K = 2 r + 1$，其中 $r = \\lceil M \\sigma / s \\rceil$。\n- 任务：比较朴素三维卷积与可分离一维卷积的计算复杂度（总乘法次数）。\n- 假设：内部体素，无边界效应。\n- 要求输出：朴素方法与可分离方法的乘法次数之比 $R$，四舍五入到四位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据充分**：该问题基于信号处理和神经影像数据分析的基本原理。高斯平滑、卷积、高斯函数的可分离性以及半峰全宽与标准差之间的关系都是标准且成熟的概念。\n- **适定性**：该问题提供了所有必要的参数（$N_x, N_y, N_z, s, \\text{FWHM}, M$）和定义，以唯一确定核的大小，并进而确定计算复杂度及其比率。目标明确，且存在唯一解。\n- **客观性**：该问题以精确、定量和无偏见的语言陈述。\n\n该问题不存在科学上不健全、信息缺失或含糊不清等缺陷。给定的参数对于 fMRI 分析是切合实际的。\n\n### 第3步：结论与行动\n该问题有效。将提供一个完整的、有理有据的解答。\n\n解题过程分为几个步骤：首先，我们推导高斯函数的半峰全宽（FWHM）与标准差 $\\sigma$ 之间的关系。其次，我们计算达到目标 FWHM 所需的 $\\sigma$ 的具体值。第三，我们确定离散卷积核的大小 $K$。第四，我们计算朴素三维卷积和可分离一维卷积方法的总乘法运算次数。最后，我们计算这两个量的比率。\n\n**1. FWHM与$\\sigma$之间的关系**\n\n一个以零为中心的一维高斯函数由下式给出：\n$$g(x) = A \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)$$\n其中 $A$ 是振幅，$\\sigma$ 是标准差。函数的最大值为 $g(0) = A$。FWHM 是函数值为其最大值一半（即 $A/2$）时的宽度。设 $x_{HM}$ 是这种情况发生的位置。\n$$g(x_{HM}) = \\frac{A}{2}$$\n$$A \\exp\\left(-\\frac{x_{HM}^2}{2\\sigma^2}\\right) = \\frac{A}{2}$$\n$$\\exp\\left(-\\frac{x_{HM}^2}{2\\sigma^2}\\right) = \\frac{1}{2}$$\n对两边取自然对数：\n$$-\\frac{x_{HM}^2}{2\\sigma^2} = \\ln\\left(\\frac{1}{2}\\right) = -\\ln(2)$$\n$$x_{HM}^2 = 2\\sigma^2 \\ln(2)$$\n$$|x_{HM}| = \\sigma\\sqrt{2\\ln(2)}$$\nFWHM 是点 $-x_{HM}$ 和 $+x_{HM}$ 之间的距离，因此 $\\text{FWHM} = 2 |x_{HM}|$。\n$$\\text{FWHM} = 2\\sigma\\sqrt{2\\ln(2)}$$\n\n**2. 计算 $\\sigma$**\n\n问题陈述了目标平滑度为 $\\text{FWHM} = 8\\ \\mathrm{mm}$。我们可以求解 $\\sigma$：\n$$\\sigma = \\frac{\\text{FWHM}}{2\\sqrt{2\\ln(2)}} = \\frac{8\\ \\mathrm{mm}}{2\\sqrt{2\\ln(2)}} = \\frac{4}{\\sqrt{2\\ln(2)}}\\ \\mathrm{mm}$$\n\n**3. 确定核大小 $K$**\n\n离散核是通过在每个轴上距离中心 $\\pm M\\sigma$ 的位置截断连续高斯函数来构建的。参数 $M$ 给定为 $3$。核的物理半径是 $M\\sigma$。\n$$M\\sigma = 3 \\times \\frac{4}{\\sqrt{2\\ln(2)}}\\ \\mathrm{mm} = \\frac{12}{\\sqrt{2\\ln(2)}}\\ \\mathrm{mm}$$\n体素大小为 $s = 2\\ \\mathrm{mm}$。核的半径（以体素为单位），$r$，是通过将物理半径除以体素大小并对结果向上取整得到的，如题中所述。\n$$r = \\left\\lceil \\frac{M\\sigma}{s} \\right\\rceil = \\left\\lceil \\frac{12 / \\sqrt{2\\ln(2)}}{2} \\right\\rceil = \\left\\lceil \\frac{6}{\\sqrt{2\\ln(2)}} \\right\\rceil$$\n为了计算这个值，我们使用近似值 $\\ln(2) \\approx 0.693147$。\n$$\\sqrt{2\\ln(2)} \\approx \\sqrt{2 \\times 0.693147} \\approx \\sqrt{1.386294} \\approx 1.17741$$\n$$r = \\left\\lceil \\frac{6}{1.17741} \\right\\rceil = \\lceil 5.096 \\rceil = 6$$\n离散核沿单轴的全长是 $K = 2r + 1$。\n$$K = 2(6) + 1 = 13$$\n因此，各向同性的三维核是一个 $13 \\times 13 \\times 13$ 体素的立方体。\n\n**4. 计算复杂度**\n\n设数据体中的总体素数为 $N_{total} = N_x N_y N_z$。\n$$N_{total} = 128 \\times 128 \\times 64 = 1048576$$\n\n**方法1：朴素三维卷积**\n在朴素三维卷积中，对于每个输出体素，我们将核中的每个体素与输入数据体中相应的体素相乘，然后将结果相加。每个输出体素的乘法次数等于核中的元素数量。\n核元素数量 $= K \\times K \\times K = K^3$。\n$$K^3 = 13^3 = 2197$$\n整个数据体的总乘法次数 $N_{mult, 3D}$ 是每个体素的乘法次数乘以总体素数。\n$$N_{mult, 3D} = N_{total} \\times K^3 = (N_x N_y N_z) K^3$$\n\n**方法2：可分离一维卷积**\n三维高斯核是可分离的，意味着 $G(x,y,z) = G_x(x)G_y(y)G_z(z)$。与可分离核的卷积可以作为三个一维卷积序列来执行。\n1.  用长度为 $K$ 的一维核沿 x 轴对整个数据体进行卷积。对于每个体素，这需要 $K$ 次乘法。此遍的总次数为 $N_{total} \\times K$。\n2.  用长度为 $K$ 的一维核沿 y 轴对第 1 步得到的数据体进行卷积。这也需要 $N_{total} \\times K$ 次乘法。\n3.  用长度为 $K$ 的一维核沿 z 轴对第 2 步得到的数据体进行卷积。这同样需要 $N_{total} \\times K$ 次乘法。\n\n可分离方法的总乘法次数 $N_{mult, 1D}$ 是三遍乘法次数的总和。\n$$N_{mult, 1D} = (N_{total} \\times K) + (N_{total} \\times K) + (N_{total} \\times K) = N_{total} \\times (3K)$$\n\n**5. 计算比率 $R$**\n\n比率 $R$ 定义为朴素方法的总乘法次数除以可分离方法的总乘法次数。\n$$R = \\frac{N_{mult, 3D}}{N_{mult, 1D}} = \\frac{(N_x N_y N_z) K^3}{(N_x N_y N_z) (3K)}$$\n数据体维度被约去，简化了比率：\n$$R = \\frac{K^3}{3K} = \\frac{K^2}{3}$$\n代入计算出的值 $K = 13$：\n$$R = \\frac{13^2}{3} = \\frac{169}{3} = 56.3333...$$\n问题要求将答案四舍五入到四位有效数字。\n$$R \\approx 56.33$$\n这个结果展示了在平滑操作中使用高斯核的可分离特性所带来的显著计算优势。",
            "answer": "$$\\boxed{56.33}$$"
        }
    ]
}