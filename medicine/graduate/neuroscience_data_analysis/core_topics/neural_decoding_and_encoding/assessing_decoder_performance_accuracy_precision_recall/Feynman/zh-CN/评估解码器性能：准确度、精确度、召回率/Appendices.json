{
    "hands_on_practices": [
        {
            "introduction": "准确率通常是我们学习的第一个指标，但它可能具有欺骗性，尤其是在处理神经科学中常见的不平衡数据集时。这个练习将展示两个解码器可以具有完全相同的准确率，但表现出截然不同的性能特征。通过为具有相反精确率-召回率特性的解码器构建混淆矩阵，您将对分类器设计中涉及的实际权衡有更深入的直观理解，并明白为什么细致的评估至关重要。",
            "id": "4139270",
            "problem": "在一项皮层群体解码实验中，一个二元解码器被训练用于根据多神经元发放活动和局部场电位（LFP）来分类每次试验中刺激是存在（$\\text{positive}$，阳性）还是缺失（$\\text{negative}$，阴性）。评估集包含 $N=1500$ 次试验，其真实标签为：$300$ 次阳性和 $1200$ 次阴性。两个独立训练的解码器 $D_{1}$ 和 $D_{2}$ 在这同一个评估集上进行评估。相对于真实标签，两个解码器都达到了 $0.92$ 的相同准确率。\n\n仅使用准确率、精确率、召回率以及精确率和召回率的调和平均值的正式定义，为 $D_{1}$ 构建一个反映较高召回率和较低精确率的允许混淆矩阵，并为 $D_{2}$ 构建另一个反映较高精确率和较低召回率的允许混淆矩阵，且必须满足以下约束条件：\n- 错误总数由准确率要求固定。\n- 对于 $D_{1}$，假阳性的数量比假阴性的数量多 $80$。\n- 对于 $D_{2}$，假阴性的数量比假阳性的数量多 $80$。\n\n设混淆矩阵由真阳性（$TP$）、假阳性（$FP$）、真阴性（$TN$）和假阴性（$FN$）的数量参数化。构建两个矩阵后，计算每个解码器的精确率和召回率，然后计算每个解码器的精确率和召回率的调和平均值。请在这种神经科学背景下，考虑类别流行度以及假阳性与假阴性的代价，为偏好更高召回率与更高精确率的实际意义提供一个有理有据的解释。\n\n最后，计算 $D_{1}$ 和 $D_{2}$ 的精确率和召回率的调和平均值之间的绝对差，并以小数形式报告。将您的最终数值答案四舍五入到四位有效数字。答案中不允许使用百分号。",
            "solution": "问题陈述已经过验证，被认为是合理的、适定的和有科学依据的。所有必要信息均已提供，且约束条件是一致的，并能导出一个唯一解。\n\n核心任务是基于一组约束条件，为二元解码器 $D_1$ 和 $D_2$ 构建并评估两个混淆矩阵。设混淆矩阵的四个组分为真阳性（$TP$）、假阳性（$FP$）、真阴性（$TN$）和假阴性（$FN$）。\n\n性能指标的基本定义如下：\n-   准确率（$A$）：正确分类的比例。\n$$A = \\frac{TP + TN}{TP + TN + FP + FN}$$\n-   精确率（$P$）：预测为阳性的样本中实际为阳性的比例。\n$$P = \\frac{TP}{TP + FP}$$\n-   召回率（$R$）：实际为阳性的样本中被正确识别的比例。也称为灵敏度或真阳性率。\n$$R = \\frac{TP}{TP + FN}$$\n-   精确率和召回率的调和平均值（$H$）：通常表示为 $F_1$ 分数，它提供了一个平衡精确率和召回率的单一指标。\n$$H = \\frac{2 \\cdot P \\cdot R}{P + R} = \\frac{2TP}{2TP + FP + FN}$$\n\n问题提供了以下全局参数：\n-   试验总数：$N = 1500$。\n-   实际阳性试验次数（真实标签）：$N_{pos} = TP + FN = 300$。\n-   实际阴性试验次数（真实标签）：$N_{neg} = TN + FP = 1200$。\n-   两个解码器的准确率：$A = 0.92$。\n\n从准确率中，我们可以确定正确和错误预测的总数。\n正确预测总数（$TP+TN$）= $A \\times N = 0.92 \\times 1500 = 1380$。\n错误预测总数（$FP+FN$）= $(1-A) \\times N = (1 - 0.92) \\times 1500 = 0.08 \\times 1500 = 120$。\n这个固定的错误总数 $FP+FN = 120$ 适用于解码器 $D_1$ 和 $D_2$。\n\n**解码器 $D_1$ 的分析（较高召回率，较低精确率）**\n\n对于 $D_1$，我们有两个关于其错误的约束条件：\n1.  错误总数为 $120$：$FP_1 + FN_1 = 120$。\n2.  假阳性数量比假阴性数量多 $80$：$FP_1 = FN_1 + 80$。\n\n我们解这个线性方程组：\n$$(FN_1 + 80) + FN_1 = 120$$\n$$2FN_1 + 80 = 120$$\n$$2FN_1 = 40$$\n$$FN_1 = 20$$\n因此，$FP_1 = 20 + 80 = 100$。\n\n现在我们可以确定 $D_1$ 的正确预测数量：\n-   $TP_1 = N_{pos} - FN_1 = 300 - 20 = 280$。\n-   $TN_1 = N_{neg} - FP_1 = 1200 - 100 = 1100$。\n\n$D_1$ 的混淆矩阵为：$TP_1=280$, $FN_1=20$, $FP_1=100$, $TN_1=1100$。\n\n我们计算 $D_1$ 的精确率、召回率和调和平均值：\n-   精确率 $P_1 = \\frac{TP_1}{TP_1 + FP_1} = \\frac{280}{280 + 100} = \\frac{280}{380} = \\frac{14}{19}$。\n-   召回率 $R_1 = \\frac{TP_1}{TP_1 + FN_1} = \\frac{280}{280 + 20} = \\frac{280}{300} = \\frac{14}{15}$。\n-   调和平均值 $H_1 = \\frac{2 P_1 R_1}{P_1 + R_1} = \\frac{2 \\cdot \\frac{14}{19} \\cdot \\frac{14}{15}}{\\frac{14}{19} + \\frac{14}{15}} = \\frac{2 \\cdot 14 \\cdot (\\frac{14}{19 \\cdot 15})}{14 \\cdot (\\frac{1}{19} + \\frac{1}{15})} = \\frac{2 \\cdot \\frac{14}{285}}{\\frac{15+19}{285}} = \\frac{2 \\cdot 14}{34} = \\frac{14}{17}$。\n\n**解码器 $D_2$ 的分析（较高精确率，较低召回率）**\n\n对于 $D_2$，关于错误的约束条件是：\n1.  错误总数为 $120$：$FP_2 + FN_2 = 120$。\n2.  假阴性数量比假阳性数量多 $80$：$FN_2 = FP_2 + 80$。\n\n我们解这个方程组：\n$$FP_2 + (FP_2 + 80) = 120$$\n$$2FP_2 + 80 = 120$$\n$$2FP_2 = 40$$\n$$FP_2 = 20$$\n因此，$FN_2 = 20 + 80 = 100$。\n\n现在我们确定 $D_2$ 的正确预测数量：\n-   $TP_2 = N_{pos} - FN_2 = 300 - 100 = 200$。\n-   $TN_2 = N_{neg} - FP_2 = 1200 - 20 = 1180$。\n\n$D_2$ 的混淆矩阵为：$TP_2=200$, $FN_2=100$, $FP_2=20$, $TN_2=1180$。\n\n我们计算 $D_2$ 的精确率、召回率和调和平均值：\n-   精确率 $P_2 = \\frac{TP_2}{TP_2 + FP_2} = \\frac{200}{200 + 20} = \\frac{200}{220} = \\frac{10}{11}$。\n-   召回率 $R_2 = \\frac{TP_2}{TP_2 + FN_2} = \\frac{200}{200 + 100} = \\frac{200}{300} = \\frac{2}{3}$。\n-   调和平均值 $H_2 = \\frac{2 P_2 R_2}{P_2 + R_2} = \\frac{2 \\cdot \\frac{10}{11} \\cdot \\frac{2}{3}}{\\frac{10}{11} + \\frac{2}{3}} = \\frac{2 \\cdot \\frac{20}{33}}{\\frac{30+22}{33}} = \\frac{40}{52} = \\frac{10}{13}$。\n\n**实际意义**\n\n在像 $D_1$（$R_1 = 14/15 \\approx 0.933$, $P_1 = 14/19 \\approx 0.737$）这样的高召回率解码器和像 $D_2$（$R_2 = 2/3 \\approx 0.667$, $P_2 = 10/11 \\approx 0.909$）这样的高精确率解码器之间进行选择，取决于在特定的神经科学或临床应用中，假阴性与假阳性的相对代价。\n\n当解码器未能检测到存在的刺激时，就会发生假阴性（$FN$）（一次“漏报”）。当解码器报告了不存在的刺激时，就会发生假阳性（$FP$）（一次“虚警”）。\n\n-   **偏好高召回率（$D_1$）：**解码器 $D_1$ 的假阴性很少（$FN_1=20$），代价是更多的假阳性（$FP_1=100$）。当漏报的后果严重时，首选高召回率模型。例如，在一个用于检测即将发生的癫痫发作的脑机接口中，未能检测到一次真正的癫痫发作（漏报）对患者来说可能是灾难性的。在这种情况下，偶尔触发不必要警告的虚警是可以接受得多的。\n\n-   **偏好高精确率（$D_2$）：**解码器 $D_2$ 的假阳性非常少（$FP_2=20$），代价是更多的假阴性（$FN_2=100$）。当虚警的后果严重时，高精确率模型至关重要。例如，如果解码器的输出会触发侵入性或高风险的干预措施，例如向大脑输送强效药物或电刺激，那么一次虚警的代价将极其高昂（例如，引起有害的副作用）。在这种情况下，宁可错过一些真实事件，以确保任何干预都基于高度可信的检测。\n\n显著的类别不平衡（$300$ 个阳性 vs. $1200$ 个阴性）的存在使得准确率成为一个不充分的指标。一个总是预测“阴性”的平凡解码器将达到 $1200/1500 = 80\\%$ 的准确率，但其召回率为零，因此毫无用处。精确率和召回率在这种不平衡数据集上提供了更细致、更有意义的性能评估。\n\n**最终计算**\n\n最后一步是计算 $D_1$ 和 $D_2$ 之间精确率和召回率的调和平均值的绝对差。\n$$|H_1 - H_2| = \\left| \\frac{14}{17} - \\frac{10}{13} \\right|$$\n为了进行分数相减，我们找到公分母 $17 \\times 13 = 221$。\n$$|H_1 - H_2| = \\left| \\frac{14 \\times 13}{17 \\times 13} - \\frac{10 \\times 17}{13 \\times 17} \\right| = \\left| \\frac{182}{221} - \\frac{170}{221} \\right| = \\frac{12}{221}$$\n换算成小数，结果是 $12 \\div 221 \\approx 0.05429864$。\n四舍五入到四位有效数字得到 $0.05430$。",
            "answer": "$$\\boxed{0.05430}$$"
        },
        {
            "introduction": "现实世界中的解码任务通常需要区分两个以上的刺激或大脑状态，而不仅仅是二元分类。这个练习将精确率和召回率的概念推广到多类别场景中，这是一个必要的技能。您将学习如何从一个多类混淆矩阵中为每个单独的类别计算性能指标，以及如何使用宏平均法将它们聚合，以获得解码器整体性能的单一综合度量。",
            "id": "4139294",
            "problem": "一个群体解码器被训练用于将多神经元脉冲计数向量映射到四个刺激类别之一，记为 $s_1, s_2, s_3, s_4$。在一个留出测试集上，其性能由一个 $K \\times K$ 的混淆矩阵 $C$（其中 $K=4$）总结，其中 $C_{ij}$ 记录了真实刺激类别为 $s_i$ 而预测类别为 $s_j$ 的测试试验次数。经验混淆矩阵为\n$$\nC \\;=\\;\n\\begin{pmatrix}\n42  5  3  0 \\\\\n6  38  4  2 \\\\\n5  7  30  8 \\\\\n1  2  9  33\n\\end{pmatrix}.\n$$\n仅使用每个类别 $s_k$ 的分类事件的基本定义——真正例、假正例、假负例——以及 $\\mathrm{F1}$-分数是精确率和召回率的调和平均数这一事实，计算 $k \\in \\{1,2,3,4\\}$ 时每个类别的精确率和召回率，以及宏平均 $\\mathrm{F1}$-分数（四个逐类别 $\\mathrm{F1}$-分数的算术平均值）。将所有要求的量表示为无单位的十进制数，并四舍五入到四位有效数字。在你的最终答案中，将这九个数字按以下顺序呈现在一个单行矩阵中：$s_1, s_2, s_3, s_4$ 的精确率；$s_1, s_2, s_3, s_4$ 的召回率；宏平均 $\\mathrm{F1}$-分数。",
            "solution": "该问题要求基于一个给定的四分类问题的混淆矩阵，计算每个类别的精确率和召回率，以及宏平均 $\\mathrm{F1}$-分数。该问题陈述科学合理、定义明确且客观，使用了机器学习性能评估中的标准定义。因此，这是一个有效的问题。\n\n给定的混淆矩阵 $C$ 为：\n$$\nC \\;=\\;\n\\begin{pmatrix}\n42  5  3  0 \\\\\n6  38  4  2 \\\\\n5  7  30  8 \\\\\n1  2  9  33\n\\end{pmatrix}\n$$\n其中 $C_{ij}$ 是真实类别为 $s_i$ 而预测类别为 $s_j$ 的试验次数。\n\n对于一个给定的类别 $s_k$，真正例（$TP_k$）、假正例（$FP_k$）和假负例（$FN_k$）的数量是根据混淆矩阵 $C$ 的元素定义的。\n- 真正例（$TP_k$）：类别为 $s_k$ 的样本被正确预测为类别 $s_k$ 的数量。这对应于对角线元素 $C_{kk}$。\n$$TP_k = C_{kk}$$\n- 假正例（$FP_k$）：来自其他类别的样本被错误预测为类别 $s_k$ 的数量。这是第 $k$ 列中除真正例之外所有元素的总和。\n$$FP_k = \\sum_{i \\neq k} C_{ik} = \\left(\\sum_{i=1}^{4} C_{ik}\\right) - C_{kk}$$\n- 假负例（$FN_k$）：类别为 $s_k$ 的样本被错误预测为任何其他类别的数量。这是第 $k$ 行中除真正例之外所有元素的总和。\n$$FN_k = \\sum_{j \\neq k} C_{kj} = \\left(\\sum_{j=1}^{4} C_{kj}\\right) - C_{kk}$$\n\n精确率（$P_k$）是真正例与所有被预测为类别 $s_k$ 的样本总数的比率。\n$$P_k = \\frac{TP_k}{TP_k + FP_k}$$\n召回率（$R_k$）是真正例与类别 $s_k$ 的所有实际样本总数的比率。\n$$R_k = \\frac{TP_k}{TP_k + FN_k}$$\n$\\mathrm{F1}$-分数（$F1_k$）是精确率和召回率的调和平均数。\n$$F1_k = 2 \\cdot \\frac{P_k \\cdot R_k}{P_k + R_k}$$\n\n我们现在为每个类别 $k \\in \\{1, 2, 3, 4\\}$ 计算这些量。\n\n对于类别 $s_1$ ($k=1$):\n$TP_1 = C_{11} = 42$\n$FP_1 = C_{21} + C_{31} + C_{41} = 6 + 5 + 1 = 12$\n$FN_1 = C_{12} + C_{13} + C_{14} = 5 + 3 + 0 = 8$\n$P_1 = \\frac{42}{42+12} = \\frac{42}{54} = \\frac{7}{9} \\approx 0.777777...$\n$R_1 = \\frac{42}{42+8} = \\frac{42}{50} = 0.84$\n$F1_1 = 2 \\cdot \\frac{P_1 R_1}{P_1 + R_1} = 2 \\cdot \\frac{(42/54) \\cdot (42/50)}{(42/54) + (42/50)} = \\frac{2 \\cdot 42}{54+50} = \\frac{84}{104} = \\frac{21}{26} \\approx 0.807692...$\n\n对于类别 $s_2$ ($k=2$):\n$TP_2 = C_{22} = 38$\n$FP_2 = C_{12} + C_{32} + C_{42} = 5 + 7 + 2 = 14$\n$FN_2 = C_{21} + C_{23} + C_{24} = 6 + 4 + 2 = 12$\n$P_2 = \\frac{38}{38+14} = \\frac{38}{52} = \\frac{19}{26} \\approx 0.730769...$\n$R_2 = \\frac{38}{38+12} = \\frac{38}{50} = 0.76$\n$F1_2 = 2 \\cdot \\frac{P_2 R_2}{P_2 + R_2} = 2 \\cdot \\frac{(38/52) \\cdot (38/50)}{(38/52) + (38/50)} = \\frac{2 \\cdot 38}{52+50} = \\frac{76}{102} = \\frac{38}{51} \\approx 0.745098...$\n\n对于类别 $s_3$ ($k=3$):\n$TP_3 = C_{33} = 30$\n$FP_3 = C_{13} + C_{23} + C_{43} = 3 + 4 + 9 = 16$\n$FN_3 = C_{31} + C_{32} + C_{34} = 5 + 7 + 8 = 20$\n$P_3 = \\frac{30}{30+16} = \\frac{30}{46} = \\frac{15}{23} \\approx 0.652173...$\n$R_3 = \\frac{30}{30+20} = \\frac{30}{50} = 0.6$\n$F1_3 = 2 \\cdot \\frac{P_3 R_3}{P_3 + R_3} = 2 \\cdot \\frac{(30/46) \\cdot (30/50)}{(30/46) + (30/50)} = \\frac{2 \\cdot 30}{46+50} = \\frac{60}{96} = \\frac{5}{8} = 0.625$\n\n对于类别 $s_4$ ($k=4$):\n$TP_4 = C_{44} = 33$\n$FP_4 = C_{14} + C_{24} + C_{34} = 0 + 2 + 8 = 10$\n$FN_4 = C_{41} + C_{42} + C_{43} = 1 + 2 + 9 = 12$\n$P_4 = \\frac{33}{33+10} = \\frac{33}{43} \\approx 0.767441...$\n$R_4 = \\frac{33}{33+12} = \\frac{33}{45} = \\frac{11}{15} \\approx 0.733333...$\n$F1_4 = 2 \\cdot \\frac{P_4 R_4}{P_4 + R_4} = 2 \\cdot \\frac{(33/43) \\cdot (33/45)}{(33/43) + (33/45)} = \\frac{2 \\cdot 33}{43+45} = \\frac{66}{88} = \\frac{3}{4} = 0.75$\n\n宏平均 $\\mathrm{F1}$-分数，$F1_{\\text{macro}}$，是各类别 $\\mathrm{F1}$-分数的算术平均值。\n$$F1_{\\text{macro}} = \\frac{1}{4} \\sum_{k=1}^4 F1_k = \\frac{F1_1 + F1_2 + F1_3 + F1_4}{4}$$\n$$F1_{\\text{macro}} = \\frac{1}{4} \\left( \\frac{21}{26} + \\frac{38}{51} + \\frac{5}{8} + \\frac{3}{4} \\right) \\approx \\frac{0.807692 + 0.745098 + 0.625 + 0.75}{4} = \\frac{2.92779}{4} \\approx 0.731947...$$\n\n将所有要求的量四舍五入到四位有效数字：\n- $P_1 \\approx 0.7778$\n- $P_2 \\approx 0.7308$\n- $P_3 \\approx 0.6522$\n- $P_4 \\approx 0.7674$\n\n- $R_1 = 0.8400$\n- $R_2 = 0.7600$\n- $R_3 = 0.6000$\n- $R_4 \\approx 0.7333$\n\n- $F1_{\\text{macro}} \\approx 0.7319$\n\n最终答案要求将这九个值按指定顺序包含在一个单行矩阵中：$P_1, P_2, P_3, P_4, R_1, R_2, R_3, R_4, F1_{\\text{macro}}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.7778  0.7308  0.6522  0.7674  0.8400  0.7600  0.6000  0.7333  0.7319\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在许多应用中，例如临床脑机接口，假阳性错误（“虚惊一场”）的代价与假阴性错误（“错过警报”）的代价是不同的。这个高级练习介绍了统计决策理论的原理，表明优化像 $\\mathrm{F1}$-分数这样的标准指标可能与最大化预期效用的目标不一致。通过比较从最大化 $\\mathrm{F1}$-分数和最小化成本中得出的决策阈值，您将理解如何将非对称的错误成本纳入评估中，从而设计出在实践中更优的解码器。",
            "id": "4139336",
            "problem": "一个团队正在开发一种闭环脑机接口解码器，该解码器必须从群体脉冲活动中实时检测是否存在短暂的感觉刺激。在 $12$ 个试验时期中的每一个时期，解码器会输出一个关于刺激是否存在的校准后验概率 $p_i \\in [0,1]$，以及一个真实标签 $y_i \\in \\{0,1\\}$，其中 $y_i=1$ 表示刺激存在，$y_i=0$ 表示刺激不存在。按 $p_i$ 降序排列的 $(p_i,y_i)$ 列表如下：\n\n$$\n(0.95,1),\\ (0.90,0),\\ (0.80,1),\\ (0.70,1),\\ (0.60,0),\\ (0.50,0),\\ (0.45,0),\\ (0.40,1),\\ (0.35,0),\\ (0.30,1),\\ (0.20,0),\\ (0.10,0).\n$$\n\n对于一个固定的决策阈值 $\\tau \\in [0,1]$，当 $p_i \\ge \\tau$ 时解码器预测为 $1$，否则预测为 $0$。该团队正在考虑用两种标准来选择 $\\tau$：\n\n1. $\\mathrm{F1}$ 分数（F1），由基于已实现标签计算出的精确率（precision）和召回率（recall）定义。精确率是预测为正例的样本中真正为正例的比例，而召回率是所有实际为正例的样本中被正确预测的比例。$\\mathrm{F1}$ 分数是精确率和召回率的调和平均值。团队将选择在所有能导出不同预测正例集的阈值中，使 $\\mathrm{F1}$ 分数最大化的那个 $\\tau$。如果存在多个最大化 $\\mathrm{F1}$ 分数的 $\\tau$，则选择其中最大的一个。\n\n2. 在非对称错误成本下的期望效用。假设假正例（false positive）的成本为 $c_{\\mathrm{FP}} = 1$ 个效用单位，假负例（false negative）的成本为 $c_{\\mathrm{FN}} = 10$ 个效用单位，而正确决策的成本为零。团队将选择相对于后验概率 $p_i$ 而言，能够最大化期望效用（等价于最小化期望成本）的那个 $\\tau$。\n\n仅使用精确率、召回率、$\\mathrm{F1}$ 分数、期望成本和后验概率的基本定义，不借助任何预先推导的阈值规则，确定使 $\\mathrm{F1}$ 分数最大化的决策阈值以及使期望成本最小化的决策阈值。然后，计算在 $\\mathrm{F1}$ 最优阈值下的总期望成本与在期望效用最优阈值下的总期望成本之间的差值。将你的最终数值答案四舍五入到四位有效数字，并以效用单位表示。你的最终答案必须是一个实数。",
            "solution": "题目陈述经过严格验证，确认为有效。它在科学上基于统计决策理论和机器学习评估的标准原则，问题设定良好，包含所有必要信息和明确定义，且表述客观。因此，我们可以进行完整解答。\n\n该问题要求完成两项主要任务：首先，找到能优化两个不同标准（$\\mathrm{F1}$ 分数和期望效用）的决策阈值；其次，计算使用这两个阈值所产生的总期望成本之间的差值。\n\n设 $N=12$ 个数据点的集合为 $\\{(p_i, y_i)\\}_{i=1}^{12}$。真实标签 $y_i \\in \\{0, 1\\}$ 表示刺激不存在（$0$）或存在（$1$）。后验概率 $p_i$ 代表 $P(y_i=1)$。决策规则是：如果 $p_i \\ge \\tau$，则预测为正结果（$\\hat{y}_i=1$）；如果 $p_i  \\tau$，则预测为负结果（$\\hat{y}_i=0$）。\n\n首先，我们确定数据集中实际正例（$P$）和实际负例（$N$）的数量。\n正例（$y_i=1$）对应的 $p_i$ 值为 $\\{0.95, 0.80, 0.70, 0.40, 0.30\\}$。因此，正例总数为 $P=5$。\n负例（$y_i=0$）对应的 $p_i$ 值为 $\\{0.90, 0.60, 0.50, 0.45, 0.35, 0.20, 0.10\\}$。因此，负例总数为 $N=7$。\n\n### 第一部分：寻找 F1 最优阈值 ($\\tau_{\\mathrm{F1}}$)\n\nF1 分数是精确率（Prec）和召回率（Rec）的调和平均值：\n$$ \\mathrm{Prec} = \\frac{\\mathrm{TP}}{\\mathrm{TP}+\\mathrm{FP}}, \\quad \\mathrm{Rec} = \\frac{\\mathrm{TP}}{\\mathrm{TP}+\\mathrm{FN}}, \\quad \\mathrm{F1} = 2 \\frac{\\mathrm{Prec} \\cdot \\mathrm{Rec}}{\\mathrm{Prec} + \\mathrm{Rec}} = \\frac{2\\mathrm{TP}}{2\\mathrm{TP}+\\mathrm{FP}+\\mathrm{FN}} $$\n其中 TP、FP 和 FN 分别代表真正例、假正例和假负例的数量。这些数量取决于阈值 $\\tau$ 的选择。能够产生不同预测集的阈值是数据集中 $p_i$ 的唯一值。我们对每个潜在的阈值评估 $\\mathrm{F1}$ 分数。数据已按 $p_i$ 排序，这简化了计算。对于一个阈值 $\\tau=p_{(k)}$，排序列表中的前 $k$ 个项目被预测为正例。\n\n让我们将以 $12$ 个唯一的 $p_i$ 值作为阈值时的结果制成表格：\n- 对于 $\\tau=0.95$：预测 $\\{ (0.95, 1) \\}$ 为正例。TP=$1$, FP=$0$。FN=$P$-TP=$5-1=4$。F1 = $\\frac{2(1)}{2(1)+0+4} = \\frac{2}{6} = \\frac{1}{3} \\approx 0.3333$。\n- 对于 $\\tau=0.90$：预测 $\\{ (0.95, 1), (0.90, 0) \\}$ 为正例。TP=$1$, FP=$1$。FN=$4$。F1 = $\\frac{2(1)}{2(1)+1+4} = \\frac{2}{7} \\approx 0.2857$。\n- 对于 $\\tau=0.80$：预测前 $3$ 个项目为正例。TP=$2$, FP=$1$。FN=$3$。F1 = $\\frac{2(2)}{2(2)+1+3} = \\frac{4}{8} = \\frac{1}{2} = 0.5$。\n- 对于 $\\tau=0.70$：预测前 $4$ 个项目为正例。TP=$3$, FP=$1$。FN=$2$。F1 = $\\frac{2(3)}{2(3)+1+2} = \\frac{6}{9} = \\frac{2}{3} \\approx 0.6667$。\n- 对于 $\\tau=0.60$：预测前 $5$ 个项目为正例。TP=$3$, FP=$2$。FN=$2$。F1 = $\\frac{2(3)}{2(3)+2+2} = \\frac{6}{10} = \\frac{3}{5} = 0.6$。\n- 对于 $\\tau=0.50$：预测前 $6$ 个项目为正例。TP=$3$, FP=$3$。FN=$2$。F1 = $\\frac{2(3)}{2(3)+3+2} = \\frac{6}{11} \\approx 0.5455$。\n- 对于 $\\tau=0.45$：预测前 $7$ 个项目为正例。TP=$3$, FP=$4$。FN=$2$。F1 = $\\frac{2(3)}{2(3)+4+2} = \\frac{6}{12} = \\frac{1}{2} = 0.5$。\n- 对于 $\\tau=0.40$：预测前 $8$ 个项目为正例。TP=$4$, FP=$4$。FN=$1$。F1 = $\\frac{2(4)}{2(4)+4+1} = \\frac{8}{13} \\approx 0.6154$。\n- 对于 $\\tau=0.35$：预测前 $9$ 个项目为正例。TP=$4$, FP=$5$。FN=$1$。F1 = $\\frac{2(4)}{2(4)+5+1} = \\frac{8}{14} = \\frac{4}{7} \\approx 0.5714$。\n- 对于 $\\tau=0.30$：预测前 $10$ 个项目为正例。TP=$5$, FP=$5$。FN=$0$。F1 = $\\frac{2(5)}{2(5)+5+0} = \\frac{10}{15} = \\frac{2}{3} \\approx 0.6667$。\n- 对于 $\\tau=0.20$：预测前 $11$ 个项目为正例。TP=$5$, FP=$6$。FN=$0$。F1 = $\\frac{2(5)}{2(5)+6+0} = \\frac{10}{16} = \\frac{5}{8} = 0.625$。\n- 对于 $\\tau=0.10$：预测所有 $12$ 个项目为正例。TP=$5$, FP=$7$。FN=$0$。F1 = $\\frac{2(5)}{2(5)+7+0} = \\frac{10}{17} \\approx 0.5882$。\n\n最大 $\\mathrm{F1}$ 分数是 $\\frac{2}{3}$，它在 $\\tau=0.70$ 和 $\\tau=0.30$ 时出现。问题规定了打破平局的规则：“选择最大化者中最大的 $\\tau$”。因此，$\\mathrm{F1}$ 最优阈值为 $\\tau_{\\mathrm{F1}} = 0.70$。\n\n### 第二部分：寻找期望效用最优阈值 ($\\tau_{\\mathrm{EU}}$)\n\n目标是在给定后验概率 $p_i$ 的情况下，选择一个能使总期望成本最小化的阈值 $\\tau$。成本为 $c_{\\mathrm{FP}} = 1$ 和 $c_{\\mathrm{FN}} = 10$。正确决策的成本为 $0$。\n\n对于单次试验 $i$，我们考虑每种可能决策的期望成本：\n- 如果我们预测为正（$\\hat{y}_i=1$），期望成本是假正例的概率（$1-p_i$）乘以其成本：\n  $E[\\text{Cost} | \\hat{y}_i=1] = p_i \\cdot 0 + (1-p_i) \\cdot c_{\\mathrm{FP}} = 1-p_i$。\n- 如果我们预测为负（$\\hat{y}_i=0$），期望成本是假负例的概率（$p_i$）乘以其成本：\n  $E[\\text{Cost} | \\hat{y}_i=0] = p_i \\cdot c_{\\mathrm{FN}} + (1-p_i) \\cdot 0 = 10 p_i$。\n\n为了最小化试验 $i$ 的期望成本，我们应该在 $E[\\text{Cost} | \\hat{y}_i=1]  E[\\text{Cost} | \\hat{y}_i=0]$ 时预测为正。\n$$ 1-p_i  10 p_i \\implies 1  11 p_i \\implies p_i > \\frac{1}{11} $$\n如果 $p_i = \\frac{1}{11}$，则两种决策的成本相等。最优规则是当 $p_i \\ge \\frac{1}{11}$ 时预测为正，否则预测为负。问题将决策规则定义为当 $p_i \\ge \\tau$ 时预测为正。因此，在所有试验中实施此最优策略的阈值是 $\\tau_{\\mathrm{EU}} = \\frac{1}{11}$。\n\n### 第三部分：计算总期望成本的差值\n\n对于给定的阈值 $\\tau$，总期望成本是每次试验的期望成本之和，该成本取决于为该试验所做的决策：\n$$ C(\\tau) = \\sum_{i: p_i \\ge \\tau} (1-p_i)c_{\\mathrm{FP}} + \\sum_{i: p_i  \\tau} p_i c_{\\mathrm{FN}} = \\sum_{i: p_i \\ge \\tau} (1-p_i) + 10 \\sum_{i: p_i  \\tau} p_i $$\n我们需要计算 $\\Delta C = C(\\tau_{\\mathrm{F1}}) - C(\\tau_{\\mathrm{EU}})$。\n\n**A. 计算 $C(\\tau_{\\mathrm{F1}}) = C(0.70)$：**\n$p_i \\ge 0.70$ 的试验集合是 $\\{0.95, 0.90, 0.80, 0.70\\}$。\n$p_i  0.70$ 的试验集合是 $\\{0.60, 0.50, 0.45, 0.40, 0.35, 0.30, 0.20, 0.10\\}$。\n$$\n\\begin{align*}\nC(0.70) = [(1-0.95) + (1-0.90) + (1-0.80) + (1-0.70)] \\\\\n\\quad + 10 \\cdot [0.60 + 0.50 + 0.45 + 0.40 + 0.35 + 0.30 + 0.20 + 0.10] \\\\\n= [0.05 + 0.10 + 0.20 + 0.30] + 10 \\cdot [2.90] \\\\\n= 0.65 + 29.0 \\\\\n= 29.65\n\\end{align*}\n$$\n\n**B. 计算 $C(\\tau_{\\mathrm{EU}}) = C(1/11)$：**\n阈值为 $\\tau_{\\mathrm{EU}} = \\frac{1}{11} \\approx 0.0909$。我们必须检查哪些 $p_i$ 值大于或等于此阈值。\n数据集中最小的 $p_i$ 是 $0.10$。由于 $0.10 = \\frac{1}{10} > \\frac{1}{11}$，所有 $12$ 个给定的概率 $p_i$ 都大于 $\\tau_{\\mathrm{EU}}$。\n因此，对于 $\\tau_{\\mathrm{EU}}$，所有试验都被预测为正例。成本函数中的第二个求和项是对一个空集求和，因此为 $0$。\n$$\nC(1/11) = \\sum_{i=1}^{12} (1-p_i) = 12 - \\sum_{i=1}^{12} p_i\n$$\n所有概率的总和是：\n$$ \\sum_{i=1}^{12} p_i = 0.95+0.90+0.80+0.70+0.60+0.50+0.45+0.40+0.35+0.30+0.20+0.10 = 6.25 $$\n所以，最小总期望成本是：\n$$ C(1/11) = 12 - 6.25 = 5.75 $$\n\n**C. 计算差值：**\n在 F1 最优阈值下的总期望成本与在效用最优阈值下的总期望成本之间的差值为：\n$$ \\Delta C = C(0.70) - C(1/11) = 29.65 - 5.75 = 23.90 $$\n问题要求答案四舍五入到四位有效数字。数值 $23.90$ 已经有四位有效数字。",
            "answer": "$$\\boxed{23.90}$$"
        }
    ]
}