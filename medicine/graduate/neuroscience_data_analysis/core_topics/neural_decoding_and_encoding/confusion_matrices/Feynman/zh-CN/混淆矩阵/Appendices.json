{
    "hands_on_practices": [
        {
            "introduction": "评估分类器性能的第一步是理解其评估指标。虽然总体准确率（accuracy）是最直观的指标，但在类别不平衡的数据集上，它可能具有高度的误导性——这在神经科学研究中是常见情况。本练习将引导您从第一性原理出发，推导准确率在此类情况下为何会失效，并阐释平衡准确率（balanced accuracy）如何通过重新加权各类别贡献，从而提供一个更鲁棒的评估方法 。",
            "id": "4147499",
            "problem": "一个研究团队正在分析一种用于颅内脑电图 (EEG) 数据的二元事件检测器，以在连续记录中标记癫痫发作。相对于基线活动，癫痫发作片段是罕见的。该检测器为每个片段输出一个二元标签 $\\hat{Y} \\in \\{0,1\\}$，真实标签为 $Y \\in \\{0,1\\}$，其中 $Y=1$ 表示癫痫发作，$Y=0$ 表示非癫痫发作。令 $\\mathrm{TP}$、$\\mathrm{FP}$、$\\mathrm{FN}$ 和 $\\mathrm{TN}$ 表示混淆矩阵的条目。\n\n从分类器准确率的基本定义出发，即准确率是在经验数据分布下正确分类指示符的期望值，也就是 $\\mathrm{Accuracy} = \\mathbb{E}[\\mathbf{1}\\{\\hat{Y} = Y\\}]$，请仅使用条件概率和混淆矩阵术语的核心定义来：\n- 将 $\\mathrm{Accuracy}$ 表示为各类别召回率的加权组合；\n- 通过在一个关于 $Y$ 的假设均匀类别先验下评估相同的期望，定义一个与类别分布无关的摘要指标；\n- 并仅从这些定义出发，利用这些推导来论证为什么对于罕见事件，与类别分布无关的摘要指标比 $\\mathrm{Accuracy}$ 更可取。\n\n然后，对于一个假设的数据集，其中 $\\mathrm{TP}=40$, $\\mathrm{FN}=10$, $\\mathrm{FP}=50$, $\\mathrm{TN}=900$，计算上面推导出的与类别分布无关的摘要指标。将最终值表示为小数，并四舍五入到四位有效数字。",
            "solution": "分析始于准确率的正式定义，即正确预测的指示函数 $\\mathbf{1}\\{\\hat{Y} = Y\\}$ 的期望值，其中期望是在经验数据分布上计算的。\n$$\n\\mathrm{Accuracy} = \\mathbb{E}[\\mathbf{1}\\{\\hat{Y} = Y\\}]\n$$\n这个期望等价于正确分类的概率 $P(\\hat{Y}=Y)$。我们可以使用全概率定律，以真实类别标签 $Y$ 为条件来展开这个概率：\n$$\nP(\\hat{Y}=Y) = P(\\hat{Y}=Y | Y=1)P(Y=1) + P(\\hat{Y}=Y | Y=0)P(Y=0)\n$$\n这个表达式中的条件概率对应于各类别性能指标。\n项 $P(\\hat{Y}=Y | Y=1)$ 是在真实标签为 $1$ 的条件下，分类器正确预测标签为 $1$ 的概率。这是正类别（类别 1）召回率的定义，也称为灵敏度或真正率 ($\\mathrm{TPR}$)。用混淆矩阵的组成部分表示，它由以下公式给出：\n$$\n\\mathrm{Recall}_{1} = P(\\hat{Y}=1 | Y=1) = \\frac{\\mathrm{TP}}{\\mathrm{TP}+\\mathrm{FN}}\n$$\n项 $P(\\hat{Y}=Y | Y=0)$ 是在真实标签为 $0$ 的条件下，分类器正确预测标签为 $0$ 的概率。这是负类别（类别 0）召回率的定义，也称为特异度或真负率 ($\\mathrm{TNR}$)。它由以下公式给出：\n$$\n\\mathrm{Recall}_{0} = P(\\hat{Y}=0 | Y=0) = \\frac{\\mathrm{TN}}{\\mathrm{TN}+\\mathrm{FP}}\n$$\n概率 $P(Y=1)$ 和 $P(Y=0)$ 分别代表数据集中正类别和负类别的分布比例。令 $p = P(Y=1)$ 为正类别的分布比例。那么 $P(Y=0) = 1-p$。将这些定义代回准确率的表达式中，我们得到：\n$$\n\\mathrm{Accuracy} = \\mathrm{Recall}_{1} \\cdot p + \\mathrm{Recall}_{0} \\cdot (1-p)\n$$\n这个表达式表明，准确率是各类别召回率的加权平均值，其中权重是各类别在数据中的分布比例。\n\n接下来，我们通过在一个假设的均匀类别先验下评估相同的期望 $\\mathbb{E}[\\mathbf{1}\\{\\hat{Y} = Y\\}]$，来定义一个与类别分布无关的摘要指标。均匀先验意味着每个类别都是等可能的，因此我们设定 $P(Y=1) = P(Y=0) = \\frac{1}{2}$。让我们用 $S$ 来表示这个摘要指标。将这些假设的分布比例代入我们推导出的表达式中，得到：\n$$\nS = \\mathrm{Recall}_{1} \\cdot \\frac{1}{2} + \\mathrm{Recall}_{0} \\cdot \\frac{1}{2} = \\frac{1}{2}(\\mathrm{Recall}_{1} + \\mathrm{Recall}_{0})\n$$\n这个指标是每个类别召回率的算术平均值，通常被称为平衡准确率。\n\n我们现在可以利用这些推导来论证，为什么在评估包含罕见事件的数据集上的性能时，这个与类别分布无关的摘要指标 $S$ 比准确率更可取。对于罕见事件，例如癫痫发作，正类别 $p = P(Y=1)$ 的分布比例非常小 ($p \\ll 1$)。因此，负类别 $1-p$ 的分布比例非常接近于 $1$。\n在准确率的表达式 $\\mathrm{Accuracy} = \\mathrm{Recall}_{1} \\cdot p + \\mathrm{Recall}_{0} \\cdot (1-p)$ 中，正类别召回率 $\\mathrm{Recall}_{1}$ 的贡献被微小的因子 $p$ 加权，而负类别召回率 $\\mathrm{Recall}_{0}$ 的贡献则被一个接近 $1$ 的因子 $(1-p)$ 加权。因此，准确率主要由模型在多数（负）类别上的性能决定：\n$$\n\\mathrm{Accuracy} \\approx \\mathrm{Recall}_{0}\n$$\n一个总是预测多数类别（即对所有输入都预测 $\\hat{Y}=0$）的平凡分类器，其 $\\mathrm{TP}=0$，$\\mathrm{FN}$ 等于正实例的总数，因此 $\\mathrm{Recall}_{1}=0$。然而，它的 $\\mathrm{FP}=0$，$\\mathrm{TN}$ 等于负实例的总数，从而得到 $\\mathrm{Recall}_{0}=1$。对于这个无用的分类器，其准确率约为 $1-p$，如果 $p$ 很小，这个值就会非常高。这表明，标准准确率对于罕见事件检测是一个具有误导性的指标，因为它未能对模型在感兴趣的罕见类别上的糟糕性能进行惩罚。\n\n相比之下，与类别分布无关的摘要指标 $S = \\frac{1}{2}(\\mathrm{Recall}_{1} + \\mathrm{Recall}_{0})$ 对正类别和负类别的召回率给予了同等的权重（$\\frac{1}{2}$），而不管它们在数据中的分布比例如何。一个低的 $\\mathrm{Recall}_{1}$ 值会显著降低 $S$ 的值，从而正确地反映出分类器未能识别出罕见事件。因此，在类别不平衡的情况下，$S$ 为分类器的效用提供了一个更平衡、更真实的评估。\n\n最后，我们为给定的数据集计算这个与类别分布无关的摘要指标的值：$\\mathrm{TP}=40, \\mathrm{FN}=10, \\mathrm{FP}=50, \\mathrm{TN}=900$。\n首先，我们计算各类别召回率：\n$$\n\\mathrm{Recall}_{1} = \\frac{\\mathrm{TP}}{\\mathrm{TP}+\\mathrm{FN}} = \\frac{40}{40+10} = \\frac{40}{50} = 0.8\n$$\n$$\n\\mathrm{Recall}_{0} = \\frac{\\mathrm{TN}}{\\mathrm{TN}+\\mathrm{FP}} = \\frac{900}{900+50} = \\frac{900}{950} = \\frac{18}{19}\n$$\n现在，我们计算摘要指标 $S$：\n$$\nS = \\frac{1}{2}(\\mathrm{Recall}_{1} + \\mathrm{Recall}_{0}) = \\frac{1}{2}\\left(\\frac{4}{5} + \\frac{18}{19}\\right)\n$$\n为了将分数相加，我们找到一个公分母，即 $5 \\times 19 = 95$：\n$$\nS = \\frac{1}{2}\\left(\\frac{4 \\times 19}{95} + \\frac{18 \\times 5}{95}\\right) = \\frac{1}{2}\\left(\\frac{76}{95} + \\frac{90}{95}\\right) = \\frac{1}{2}\\left(\\frac{76+90}{95}\\right) = \\frac{1}{2}\\left(\\frac{166}{95}\\right) = \\frac{83}{95}\n$$\n将此分数转换为小数得到：\n$$\nS = \\frac{83}{95} \\approx 0.87368421...\n$$\n四舍五入到四位有效数字，我们得到 $0.8737$。",
            "answer": "$$\n\\boxed{0.8737}\n$$"
        },
        {
            "introduction": "除了修正简单的指标，更深入的理解源于那些能够整体捕捉性能的指标。马修斯相关系数（Matthews Correlation Coefficient, MCC）因其鲁棒性而备受推崇，尤其是在处理不平衡类别时。本练习旨在揭开 MCC 公式的神秘面纱，要求您直接从皮尔逊相关系数（Pearson correlation coefficient）出发推导出 MCC，从而揭示其作为观测标签与预测标签之间相关性度量的根本性质 。",
            "id": "4147553",
            "problem": "一个实验室正在评估一个二元检测器，该检测器用于标记局部场电位记录中的海马体尖波涟漪事件。对于 $n$ 个时间窗口中的每一个，记录了真实事件标签 $Y_{i} \\in \\{0,1\\}$ 和预测标签 $\\hat{Y}_{i} \\in \\{0,1\\}$，其中 $1$ 表示有事件，$0$ 表示无事件。经验 $2 \\times 2$ 混淆矩阵的计数定义如下：真阳性 $TP$、假阳性 $FP$、真阴性 $TN$ 和假阴性 $FN$，且有 $n = TP + FP + TN + FN$。\n\n从两个随机变量之间 Pearson 积矩相关系数的基本定义出发，\n$$\nr = \\frac{\\sum_{i=1}^{n} \\left(X_{i} - \\bar{X}\\right)\\left(Z_{i} - \\bar{Z}\\right)}{\\sqrt{\\left(\\sum_{i=1}^{n} \\left(X_{i} - \\bar{X}\\right)^{2}\\right)\\left(\\sum_{i=1}^{n} \\left(Z_{i} - \\bar{Z}\\right)^{2}\\right)}},\n$$\n推导二元真实标签 $Y_{i}$ 和二元预测标签 $\\hat{Y}_{i}$ 之间相关性的闭式表达式，该表达式仅用混淆矩阵计数 $TP$、$FP$、$TN$ 和 $FN$ 表示。将得出的表达式解释为 Matthews 相关系数 (MCC)，并说明为什么它可以被看作是预测标签和真实二元标签之间的相关性。将你的最终结果表示为一个仅包含 $TP$、$FP$、$TN$ 和 $FN$ 的符号表达式。",
            "solution": "为了推导真实标签 $Y_i$ 和预测标签 $\\hat{Y}_i$ 之间的相关性表达式，我们将使用 Pearson 相关系数的计算公式，该公式在代数上与所给公式等价：\n$$\nr = \\frac{n \\sum_{i=1}^{n} Y_i \\hat{Y}_i - \\left(\\sum_{i=1}^{n} Y_i\\right) \\left(\\sum_{i=1}^{n} \\hat{Y}_i\\right)}{\\sqrt{\\left[n \\sum_{i=1}^{n} Y_i^2 - \\left(\\sum_{i=1}^{n} Y_i\\right)^2\\right] \\left[n \\sum_{i=1}^{n} \\hat{Y}_i^2 - \\left(\\sum_{i=1}^{n} \\hat{Y}_i\\right)^2\\right]}}\n$$\n我们的任务是将此公式中的每个求和项用混淆矩阵计数 $TP$、$FP$、$TN$ 和 $FN$ 来表示。\n\n1.  **表示涉及 $Y_i$ 和 $\\hat{Y}_i$ 的求和项**：\n    求和 $\\sum_{i=1}^{n} Y_i$ 计算的是实际为阳性（即 $Y_i = 1$）的总数。根据定义，这是真阳性和假阴性的总和。\n    $$ \\sum_{i=1}^{n} Y_i = TP + FN $$\n    同样地，求和 $\\sum_{i=1}^{n} \\hat{Y}_i$ 计算的是预测为阳性（即 $\\hat{Y}_i = 1$）的总数。这是真阳性和假阳性的总和。\n    $$ \\sum_{i=1}^{n} \\hat{Y}_i = TP + FP $$\n\n2.  **表示平方和**：\n    由于 $Y_i$ 和 $\\hat{Y}_i$ 都是取值为 $\\{0,1\\}$ 的二元变量，我们有 $Y_i^2 = Y_i$ 和 $\\hat{Y}_i^2 = \\hat{Y}_i$。\n    因此，平方和等于变量自身的和。\n    $$ \\sum_{i=1}^{n} Y_i^2 = \\sum_{i=1}^{n} Y_i = TP + FN $$\n    $$ \\sum_{i=1}^{n} \\hat{Y}_i^2 = \\sum_{i=1}^{n} \\hat{Y}_i = TP + FP $$\n\n3.  **表示乘积和**：\n    乘积 $Y_i \\hat{Y}_i$ 等于 $1$ 当且仅当 $Y_i=1$ 和 $\\hat{Y}_i=1$ 同时成立。这种情况对应于一个真阳性。求和 $\\sum_{i=1}^{n} Y_i \\hat{Y}_i$ 计算的是这种情况的实例数量。\n    $$ \\sum_{i=1}^{n} Y_i \\hat{Y}_i = TP $$\n\n现在，我们将这些表达式代回到 $r$ 的公式中。\n\n**分子**：\n分子是 $n \\sum Y_i \\hat{Y}_i - (\\sum Y_i)(\\sum \\hat{Y}_i)$。\n$$ \\text{分子} = n(TP) - (TP + FN)(TP + FP) $$\n代入 $n = TP + FP + TN + FN$：\n$$ \\text{分子} = (TP + FP + TN + FN)TP - (TP + FN)(TP + FP) $$\n$$ = (TP^2 + FP \\cdot TP + TN \\cdot TP + FN \\cdot TP) - (TP^2 + TP \\cdot FP + FN \\cdot TP + FN \\cdot FP) $$\n$$ = TP^2 + FP \\cdot TP + TN \\cdot TP + FN \\cdot TP - TP^2 - TP \\cdot FP - FN \\cdot TP - FN \\cdot FP $$\n消去项后，我们得到：\n$$ \\text{分子} = TP \\cdot TN - FP \\cdot FN $$\n\n**分母**：\n分母是两项乘积的平方根。让我们分别计算每一项。\n\n被开方数中的第一项：$n \\sum Y_i^2 - (\\sum Y_i)^2$。\n$$ n(TP + FN) - (TP + FN)^2 = (TP + FN) [n - (TP + FN)] $$\n由于 $n = TP + FP + TN + FN$，我们有 $n - (TP + FN) = FP + TN$。\n$$ \\text{第一项} = (TP + FN)(FP + TN) $$\n\n被开方数中的第二项：$n \\sum \\hat{Y}_i^2 - (\\sum \\hat{Y}_i)^2$。\n$$ n(TP + FP) - (TP + FP)^2 = (TP + FP) [n - (TP + FP)] $$\n由于 $n = TP + FP + TN + FN$，我们有 $n - (TP + FP) = TN + FN$。\n$$ \\text{第二项} = (TP + FP)(TN + FN) $$\n\n完整的分母是这两项乘积的平方根：\n$$ \\text{分母} = \\sqrt{ (TP + FN)(FP + TN) \\cdot (TP + FP)(TN + FN) } $$\n\n**最终组合**：\n结合分子和分母，得到相关系数 $r$ 的最终表达式：\n$$ r = \\frac{TP \\cdot TN - FP \\cdot FN}{\\sqrt{(TP + FP)(TP + FN)(TN + FP)(TN + FN)}} $$\n\n这个表达式正是 Matthews 相关系数 (MCC) 的定义。这个推导表明，MCC 不是一个随意的度量标准，它本质上是在真实标签和预测标签的二元向量之间计算的 Pearson 积矩相关系数。\n\n对这一结果的解释是，MCC 直接以相关性的形式衡量了二元分类的质量。$r = MCC = +1$ 的值表示完美预测，即预测标签与真实标签完全相关。$r = MCC = -1$ 的值表示完全不一致，即预测结果与真实标签完全负相关。$r = MCC = 0$ 的值表示相对于真实标签，该预测不比随机猜测更好。这种以相关性理论为基础的特性，使得 MCC 成为一个全面且均衡的度量标准，因为它考虑了混淆矩阵中的所有四个值，并且对类别不平衡问题具有鲁棒性。",
            "answer": "$$\n\\boxed{\\frac{TP \\cdot TN - FP \\cdot FN}{\\sqrt{(TP + FP)(TP + FN)(TN + FP)(TN + FN)}}}\n$$"
        },
        {
            "introduction": "在实际应用中，分类器性能几乎总是通过交叉验证来评估，这需要对多个折（fold）的指标进行汇总。然而，聚合方法的选择——是平均各个分数（宏平均，macro-averaging）还是合并所有数据（微平均，micro-averaging）——可能会导致不同的结论。本练习将使用 F1-score 探讨这一关键问题，阐明像 F1-score 这样的非线性指标为何会使这两种聚合方法的结果产生差异，这对于准确报告模型性能至关重要 。",
            "id": "4147572",
            "problem": "一个神经科学实验室正在评估一个用于检测颅内脑电图 (EEG) 片段中癫痫样棘波的二元分类器。该分类器使用双折交叉验证 (CV) 进行评估。对于每一折，混淆矩阵的条目以真阳性 ($\\mathrm{TP}$)、假阳性 ($\\mathrm{FP}$)、假阴性 ($\\mathrm{FN}$) 和真阴性 ($\\mathrm{TN}$) 的计数形式记录。记录的计数如下：\n- 第 $1$ 折：$\\mathrm{TP}_1 = 90$，$\\mathrm{FP}_1 = 10$，$\\mathrm{FN}_1 = 90$，$\\mathrm{TN}_1 = 810$。\n- 第 $2$ 折：$\\mathrm{TP}_2 = 10$，$\\mathrm{FP}_2 = 90$，$\\mathrm{FN}_2 = 10$，$\\mathrm{TN}_2 = 890$。\n\n研究人员考虑用两种方法来总结各折的 $F1$ 分数：\n- 宏平均：计算每折的 $F1$ 分数，然后计算各折的未加权平均值。\n- 微平均：聚合各折的混淆矩阵计数，然后根据聚合后的计数计算单个 $F1$ 分数。\n\n仅使用混淆矩阵、精确率、召回率和调和平均数的核心定义，并从第一性原理出发进行推理，判断以下关于“为什么聚合每折的 $F1$ 分数通常不等于从聚合的混淆矩阵计算 $F1$ 分数”的陈述中，哪些是正确的。\n\nA. 无论各折之间是否存在类别不平衡，宏平均 $F1$ 都等于从聚合混淆矩阵计算出的 $F1$。\n\nB. 因为 $F1$ 分数是混淆计数的非线性函数，所以每折 $F1$ 的未加权平均值（宏平均）通常不同于聚合计数后计算的 $F1$（微平均）；它们仅在特殊条件下才会一致。\n\nC. 如果对于每一折 $i$，都存在常数 $a$ 和 $b$，使得 $\\mathrm{FP}_i = a \\,\\mathrm{TP}_i$ 且 $\\mathrm{FN}_i = b \\,\\mathrm{TP}_i$，那么宏平均 $F1$ 等于从聚合计数计算出的 $F1$。\n\nD. 对于上面提供的各折，宏平均 $F1$ 等于从聚合混淆矩阵计算出的 $F1$。\n\nE. 根据 Jensen’s 不等式，在交叉验证设置中，宏平均 $F1$ 总是严格小于微平均 $F1$。\n\n选择所有正确的选项。",
            "solution": "从核心定义开始。对于一个具有混淆矩阵条目 $\\mathrm{TP}$、$\\mathrm{FP}$、$\\mathrm{FN}$ 和 $\\mathrm{TN}$ 的二元分类器，精确率 $P$ 和召回率 $R$ 的定义如下：\n$$\nP = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FP}}, \\qquad R = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FN}}.\n$$\n$F1$ 分数被定义为精确率和召回率的调和平均数：\n$$\nF1 = \\frac{2 P R}{P + R}.\n$$\n直接用混淆计数来表示 $F1$。将 $P$ 和 $R$ 的定义代入调和平均数公式：\n$$\nF1 = \\frac{2 \\left( \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FP}} \\right) \\left( \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FN}} \\right)}{\\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FP}} + \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FN}}}\n= \\frac{2 \\mathrm{TP}}{2 \\mathrm{TP} + \\mathrm{FP} + \\mathrm{FN}}.\n$$\n因此，对于单组计数，$F1$ 是 $\\mathrm{TP}$、$\\mathrm{FP}$ 和 $\\mathrm{FN}$ 的有理函数。\n\n考虑在 $i = 1,2,\\dots,k$ 折上的两种聚合策略：\n- 宏平均（未加权）：计算每折的 $F1_i$，然后取平均值 $F1_{\\text{macro}} = \\frac{1}{k} \\sum_{i=1}^k F1_i$。\n- 通过聚合混淆矩阵进行微平均：计算\n$$\n\\mathrm{TP}_{\\text{agg}} = \\sum_{i=1}^k \\mathrm{TP}_i, \\quad \\mathrm{FP}_{\\text{agg}} = \\sum_{i=1}^k \\mathrm{FP}_i, \\quad \\mathrm{FN}_{\\text{agg}} = \\sum_{i=1}^k \\mathrm{FN}_i,\n$$\n然后\n$$\nF1_{\\text{micro}} = \\frac{2 \\,\\mathrm{TP}_{\\text{agg}}}{2 \\,\\mathrm{TP}_{\\text{agg}} + \\mathrm{FP}_{\\text{agg}} + \\mathrm{FN}_{\\text{agg}}}.\n$$\n通常情况下，\n$$\n\\frac{1}{k} \\sum_{i=1}^k \\frac{2 \\,\\mathrm{TP}_i}{2 \\,\\mathrm{TP}_i + \\mathrm{FP}_i + \\mathrm{FN}_i}\n\\neq\n\\frac{2 \\sum_{i=1}^k \\mathrm{TP}_i}{2 \\sum_{i=1}^k \\mathrm{TP}_i + \\sum_{i=1}^k \\mathrm{FP}_i + \\sum_{i=1}^k \\mathrm{FN}_i},\n$$\n因为一个非线性有理函数的平均值通常不等于该函数在参数平均值（或总和）处的取值。\n\n用所提供的折数据进行演示。计算每折的精确率、召回率和 $F1$。\n\n第 $1$ 折：\n$$\nP_1 = \\frac{90}{90 + 10} = \\frac{90}{100} = 0.9, \\qquad R_1 = \\frac{90}{90 + 90} = \\frac{90}{180} = 0.5,\n$$\n$$\nF1_1 = \\frac{2 \\cdot 0.9 \\cdot 0.5}{0.9 + 0.5} = \\frac{0.9}{1.4} \\approx 0.642857.\n$$\n或者通过计数计算，\n$$\nF1_1 = \\frac{2\\cdot 90}{2\\cdot 90 + 10 + 90} = \\frac{180}{280} = 0.642857.\n$$\n\n第 $2$ 折：\n$$\nP_2 = \\frac{10}{10 + 90} = \\frac{10}{100} = 0.1, \\qquad R_2 = \\frac{10}{10 + 10} = \\frac{10}{20} = 0.5,\n$$\n$$\nF1_2 = \\frac{2 \\cdot 0.1 \\cdot 0.5}{0.1 + 0.5} = \\frac{0.1}{0.6} \\approx 0.1666667,\n$$\n等价地\n$$\nF1_2 = \\frac{2\\cdot 10}{2\\cdot 10 + 90 + 10} = \\frac{20}{120} = 0.1666667.\n$$\n\n宏平均 $F1$：\n$$\nF1_{\\text{macro}} = \\frac{F1_1 + F1_2}{2} \\approx \\frac{0.642857 + 0.1666667}{2} \\approx 0.4047619.\n$$\n\n聚合计数：\n$$\n\\mathrm{TP}_{\\text{agg}} = 90 + 10 = 100, \\quad \\mathrm{FP}_{\\text{agg}} = 10 + 90 = 100, \\quad \\mathrm{FN}_{\\text{agg}} = 90 + 10 = 100,\n$$\n然后\n$$\nF1_{\\text{micro}} = \\frac{2\\cdot 100}{2\\cdot 100 + 100 + 100} = \\frac{200}{400} = 0.5.\n$$\n我们观察到 $F1_{\\text{macro}} \\approx 0.405 \\neq 0.5 = F1_{\\text{micro}}$，这证明了它们是不等价的。\n\n描述等价的条件。假设对于每一折 $i$，都存在与 $i$ 无关的常数 $a$ 和 $b$，使得\n$$\n\\mathrm{FP}_i = a \\,\\mathrm{TP}_i, \\qquad \\mathrm{FN}_i = b \\,\\mathrm{TP}_i.\n$$\n那么每折的 $F1$ 简化为\n$$\nF1_i = \\frac{2 \\,\\mathrm{TP}_i}{2 \\,\\mathrm{TP}_i + a \\,\\mathrm{TP}_i + b \\,\\mathrm{TP}_i} = \\frac{2}{2 + a + b},\n$$\n这个值在各折之间是恒定的。因此，\n$$\nF1_{\\text{macro}} = \\frac{1}{k} \\sum_{i=1}^k F1_i = \\frac{2}{2 + a + b}.\n$$\n聚合计数满足\n$$\n\\mathrm{TP}_{\\text{agg}} = \\sum_i \\mathrm{TP}_i, \\quad \\mathrm{FP}_{\\text{agg}} = \\sum_i a \\,\\mathrm{TP}_i = a \\sum_i \\mathrm{TP}_i, \\quad \\mathrm{FN}_{\\text{agg}} = \\sum_i b \\,\\mathrm{TP}_i = b \\sum_i \\mathrm{TP}_i,\n$$\n因此\n$$\nF1_{\\text{micro}} = \\frac{2 \\sum_i \\mathrm{TP}_i}{2 \\sum_i \\mathrm{TP}_i + a \\sum_i \\mathrm{TP}_i + b \\sum_i \\mathrm{TP}_i} = \\frac{2}{2 + a + b} = F1_{\\text{macro}}.\n$$\n因此，在各折的错误计数相对于 $\\mathrm{TP}$ 满足特殊比例条件时，等式成立；否则，非线性会导致差异。\n\n最后，讨论一些常见的错误陈述。琴生不等式为凸函数或凹函数的期望值提供了界限；然而，作为计数的有理函数，$F1$ 在相关定义域上既不是全局凸的也不是全局凹的，并且这里的平均混合了各折不同的分母。因此，没有普遍的不等式能保证宏平均 $F1$ 总是小于微平均 $F1$；它可能小于、等于或大于微平均 $F1$，具体取决于计数的分布。\n\n逐项分析：\n\nA. 声称无论类别不平衡如何，等式都成立。上面的演示表明，对于不平衡的折，$F1_{\\text{macro}} \\approx 0.405$ 而 $F1_{\\text{micro}} = 0.5$，所以等式通常不成立。结论：错误。\n\nB. 陈述了正确的原因（非线性），并正确区分了宏平均与微平均聚合，指出等式仅在特殊条件下成立。结论：正确。\n\nC. 提供了一个具体的特殊条件，即对于所有折，$\\mathrm{FP}_i = a \\,\\mathrm{TP}_i$ 且 $\\mathrm{FN}_i = b \\,\\mathrm{TP}_i$，在此条件下宏平均和微平均 $F1$ 相等。上面的推导证明了这一点。结论：正确。\n\nD. 断言对于所提供的折，等式成立。数值计算表明它们不相等（$0.4047619$ 对比 $0.5$）。结论：错误。\n\nE. 引用 Jensen’s 不等式声称宏平均 $F1$ 总是严格小于微平均 $F1$。因为 $F1$ 在相关变量上并非全局凸或凹，并且平均是跨具有不同分母的比率进行的，所以不存在这样的普遍排序关系。结论：错误。",
            "answer": "$$\\boxed{BC}$$"
        }
    ]
}