{
    "hands_on_practices": [
        {
            "introduction": "要想真正理解AUC，从头开始构建一条ROC曲线是至关重要的。第一个练习  提供了一个上手实践的机会，你将根据一组在神经科学中常见的离散解码器分数来构建一条经验ROC曲线。通过解决这个问题，你将具体理解ROC曲线是如何逐点形成的，以及在其下的面积（尤其是在处理分数并列的情况时）是如何计算的。",
            "id": "4138914",
            "problem": "一个在多单元脉冲特征上训练的群体解码器，试图在每次试验中确定振动触觉刺激是存在（$+$）还是缺失（$-$）。该解码器输出一个离散化的分数，该分数被解释为校准后的后验概率 $p(\\text{刺激存在} \\mid \\text{神经特征})$，并被分箱到五个水平 $\\{0.9, 0.7, 0.5, 0.3, 0.1\\}$。由于分箱，许多试验具有相同的分数。在一个大的留出测试集上，在每个分数水平观察到以下计数：\n- 分数 $0.9$：$10$ 次试验刺激存在（$+$），$1$ 次试验刺激缺失（$-$）。\n- 分数 $0.7$：$8$ 次试验刺激存在（$+$），$3$ 次试验刺激缺失（$-$）。\n- 分数 $0.5$：$5$ 次试验刺激存在（$+$），$6$ 次试验刺激缺失（$-$）。\n- 分数 $0.3$：$3$ 次试验刺激存在（$+$），$9$ 次试验刺激缺失（$-$）。\n- 分数 $0.1$：$1$ 次试验刺激存在（$+$），$12$ 次试验刺激缺失（$-$）。\n\n仅使用受试者工作特征（ROC）和ROC曲线下面积（AUC）的基本定义，通过将决策阈值从最高分数上方开始向下扫过各个分箱来构建经验ROC曲线，并将同一分箱内的所有试验视为同分。令 $N_{+}$ 表示刺激存在的试验总数，$N_{-}$ 表示刺激缺失的试验总数。将真阳性率（TPR）定义为 $\\mathrm{TPR} = \\mathrm{TP}/N_{+}$，假阳性率（FPR）定义为 $\\mathrm{FPR} = \\mathrm{FP}/N_{-}$，其中 $\\mathrm{TP}$ 和 $\\mathrm{FP}$ 分别是在每个阈值下被正确和错误阈值化的试验计数。\n\n从基本原理出发，解释阶梯函数ROC如何累积面积：为什么垂直线段不贡献面积，为什么水平线段贡献的面积等于其宽度乘以相应的高度，以及一个分箱内的同分如何以一种能产生唯一AUC值的方式确定该高度。然后，计算该经验ROC的AUC，结果为一个单一的精确值。提供最终的AUC值，不要四舍五入。最终答案必须是单个实数或单个无单位的闭式解析表达式。",
            "solution": "在尝试解答之前，对问题进行验证。\n\n### 步骤1：提取已知条件\n- 一个群体解码器输出一个离散化的分数，分箱到五个水平：$\\{0.9, 0.7, 0.5, 0.3, 0.1\\}$。\n- 每个分数的刺激存在（$+$）和刺激缺失（$-$）试验的计数：\n    - 分数 $0.9$：$10$ ($+$), $1$ ($-$)。\n    - 分数 $0.7$：$8$ ($+$), $3$ ($-$)。\n    - 分数 $0.5$：$5$ ($+$), $6$ ($-$)。\n    - 分数 $0.3$：$3$ ($+$), $9$ ($-$)。\n    - 分数 $0.1$：$1$ ($+$), $12$ ($-$)。\n- 刺激存在的试验总数表示为 $N_{+}$。\n- 刺激缺失的试验总数表示为 $N_{-}$。\n- 真阳性率（TPR）定义为 $\\mathrm{TPR} = \\mathrm{TP}/N_{+}$。\n- 假阳性率（FPR）定义为 $\\mathrm{FPR} = \\mathrm{FP}/N_{-}$。\n- 经验受试者工作特征（ROC）曲线将通过从最高分数上方开始向下移动决策阈值来构建。\n- 一个分箱内的所有试验都将被视为同分。\n- 任务要求解释AUC如何累积，并最终计算出AUC的单个精确值。\n\n### 步骤2：使用提取的已知条件进行验证\n根据验证标准评估问题。\n- **科学依据充分：** 该问题牢固地植根于应用于神经科学数据分析的信号检测论和机器学习的标准实践中。ROC分析是评估分类器性能的基本工具。所描述的场景是一个典型的应用。\n- **定义明确：** 该问题提供了所有必要的数据（每个分数分箱的结果计数）和待计算量（TPR，FPR）的明确定义。将分箱内试验视为同分的指令，结合经验ROC曲线的标准定义，明确了获得唯一解的清晰步骤。\n- **客观性：** 该问题使用精确、定量和无偏见的语言陈述。\n\n该问题不存在任何无效性缺陷：\n- 它不违反任何科学或数学原理。\n- 它是可形式化的，并与所述主题领域直接相关。\n- 设置是完整且一致的。\n- 条件和数据对于神经生理学实验是现实的。\n- 结构导向一个唯一且有意义的解。\n- 问题并非微不足道，因为它需要仔细的逐步构建和计算，以及概念上的解释。\n- 结果是数学上可验证的。\n\n### 步骤3：结论和行动\n问题是有效的。将提供完整解答。\n\n### 解答\n受试者工作特征曲线下面积（AUC）是衡量分类器区分两个类别能力的一种度量。ROC曲线本身是在不同阈值设置下，真阳性率（TPR）对假阳性率（FPR）的图。我们首先计算阳性（$N_{+}$）和阴性（$N_{-}$）试验的总数。\n\n根据已知条件：\n$N_{+} = 10 + 8 + 5 + 3 + 1 = 27$\n$N_{-} = 1 + 3 + 6 + 9 + 12 = 31$\n\n经验ROC曲线是通过从高到低移动决策阈值来构建的。如果一个试验的分数大于或等于阈值，则被分类为阳性。该曲线由一系列对应于一组递减阈值的点 $(FPR_i, TPR_i)$ 组成。曲线总是从 $(0, 0)$（阈值高到没有任何试验被分类为阳性）开始，到 $(1, 1)$（阈值低到所有试验都被分类为阳性）结束。\n\n由于分数是分箱的并被视为同分，我们从最高分数到最低分数逐个分箱处理数据。对于每个分箱，我们计算真阳性（TP）和假阳性（FP）的变化，并更新累积计数。ROC曲线将是连接由这些累积计数得出的点的线段序列。\n\n设 $n_{+,s}$ 和 $n_{-,s}$ 分别为分数 $s$ 处的阳性和阴性试验数量。设 $CTP_i$ 和 $CFP_i$ 分别为处理第 $i$ 个分箱（从最高分到最低分排序）后的累积TP和FP计数。ROC曲线上对应的点是 $P_i = (FPR_i, TPR_i) = (CFP_i/N_{-}, CTP_i/N_{+})$。\n\n- **初始状态（阈值 $> 0.9$）：** $CTP_0 = 0, CFP_0 = 0$。这给出了起始点 $P_0 = (0, 0)$。\n\n- **处理分数 $s = 0.9$：** 我们加上来自这个分箱的试验。\n  $n_{+,0.9} = 10, n_{-,0.9} = 1$。\n  $CTP_1 = CTP_0 + 10 = 10$。\n  $CFP_1 = CFP_0 + 1 = 1$。\n  $P_1 = (FPR_1, TPR_1) = (\\frac{1}{31}, \\frac{10}{27})$。\n\n- **处理分数 $s = 0.7$：**\n  $n_{+,0.7} = 8, n_{-,0.7} = 3$。\n  $CTP_2 = CTP_1 + 8 = 18$。\n  $CFP_2 = CFP_1 + 3 = 4$。\n  $P_2 = (FPR_2, TPR_2) = (\\frac{4}{31}, \\frac{18}{27})$。\n\n- **处理分数 $s = 0.5$：**\n  $n_{+,0.5} = 5, n_{-,0.5} = 6$。\n  $CTP_3 = CTP_2 + 5 = 23$。\n  $CFP_3 = CFP_2 + 6 = 10$。\n  $P_3 = (FPR_3, TPR_3) = (\\frac{10}{31}, \\frac{23}{27})$。\n\n- **处理分数 $s = 0.3$：**\n  $n_{+,0.3} = 3, n_{-,0.3} = 9$。\n  $CTP_4 = CTP_3 + 3 = 26$。\n  $CFP_4 = CFP_3 + 9 = 19$。\n  $P_4 = (FPR_4, TPR_4) = (\\frac{19}{31}, \\frac{26}{27})$。\n\n- **处理分数 $s = 0.1$：**\n  $n_{+,0.1} = 1, n_{-,0.1} = 12$。\n  $CTP_5 = CTP_4 + 1 = 27$。\n  $CFP_5 = CFP_4 + 12 = 31$。\n  $P_5 = (FPR_5, TPR_5) = (\\frac{31}{31}, \\frac{27}{27}) = (1, 1)$。\n\n经验ROC曲线是连接 $P_0, P_1, P_2, P_3, P_4,$ 和 $P_5$ 的线段集合。\n\n### AUC累积的基本原理解释\nROC曲线下面积（AUC）是TPR关于FPR从$FPR=0$到$FPR=1$的积分：$AUC = \\int_{0}^{1} TPR(FPR) \\, dFPR$。\n对于由线段组成的经验ROC曲线，这个积分变成了每个线段下方几何形状面积的总和。\n\n- **垂直线段：** 如果一个阈值跨越了只属于阳性样本的分数（$n_+=k, n_-=0$），曲线将从 $(FPR, TPR_{old})$ 垂直移动到 $(FPR, TPR_{new})$。FPR的变化量 $\\Delta FPR = 0$。该线段贡献的面积是一个宽度为0的矩形，因此面积为0。垂直线段对AUC没有面积贡献。\n\n- **水平线段：** 如果一个阈值跨越了只属于阴性样本的分数（$n_+=0, n_-=k$），曲线将从 $(FPR_{old}, TPR)$ 水平移动到 $(FPR_{new}, TPR)$。高度（TPR）是恒定的。该线段形成一个高度为 $TPR$、宽度为 $\\Delta FPR = FPR_{new} - FPR_{old}$ 的矩形。贡献的面积是 $TPR \\times \\Delta FPR$。\n\n- **斜线段（同分情况）：** 在本问题中，每个分数分箱都包含阳性和阴性样本，导致同分。当阈值跨越这样一个分箱时，TP和FP计数会同时增加。这会在ROC图上产生一条连接点 $P_{i-1} = (FPR_{i-1}, TPR_{i-1})$ 到点 $P_{i} = (FPR_{i}, TPR_{i})$ 的斜线段。该线段下的面积是一个梯形。这个梯形的面积由以下公式给出：\n$$Area_i = \\frac{1}{2}(\\text{height}_1 + \\text{height}_2) \\times \\text{width} = \\frac{1}{2}(TPR_{i-1} + TPR_i) (FPR_i - FPR_{i-1})$$\n这种方法能产生唯一的AUC，因为它遵循一个标准的、确定性的约定。虽然同分块内试验的真实排序是未知的，但这条斜线代表了如果考虑了同分阳性和阴性试验所有可能的排序并对其ROC路径进行平均后的期望路径。因此，梯形面积是来自同分块的有原则的、期望的面积贡献，从而确保了AUC的单一、唯一值。\n\n总AUC是这些梯形面积的总和：\n$$AUC = \\sum_{i=1}^{5} \\frac{1}{2}(TPR_{i-1} + TPR_i)(FPR_i - FPR_{i-1})$$\n\n### AUC计算\n我们现在计算每个线段的面积。\n$AUC = \\frac{1}{2}\\sum_{i=1}^{5} (TPR_{i-1} + TPR_i)(FPR_i - FPR_{i-1})$\n\n- 面积1（线段 $P_0P_1$）：\n$A_1 = \\frac{1}{2}(0 + \\frac{10}{27})(\\frac{1}{31} - 0) = \\frac{1}{2} \\cdot \\frac{10}{27} \\cdot \\frac{1}{31} = \\frac{5}{27 \\cdot 31}$\n\n- 面积2（线段 $P_1P_2$）：\n$A_2 = \\frac{1}{2}(\\frac{10}{27} + \\frac{18}{27})(\\frac{4}{31} - \\frac{1}{31}) = \\frac{1}{2} \\cdot \\frac{28}{27} \\cdot \\frac{3}{31} = \\frac{42}{27 \\cdot 31}$\n\n- 面积3（线段 $P_2P_3$）：\n$A_3 = \\frac{1}{2}(\\frac{18}{27} + \\frac{23}{27})(\\frac{10}{31} - \\frac{4}{31}) = \\frac{1}{2} \\cdot \\frac{41}{27} \\cdot \\frac{6}{31} = \\frac{123}{27 \\cdot 31}$\n\n- 面积4（线段 $P_3P_4$）：\n$A_4 = \\frac{1}{2}(\\frac{23}{27} + \\frac{26}{27})(\\frac{19}{31} - \\frac{10}{31}) = \\frac{1}{2} \\cdot \\frac{49}{27} \\cdot \\frac{9}{31} = \\frac{441}{2 \\cdot 27 \\cdot 31}$\n\n- 面积5（线段 $P_4P_5$）：\n$A_5 = \\frac{1}{2}(\\frac{26}{27} + 1)(\\frac{31}{31} - \\frac{19}{31}) = \\frac{1}{2}(\\frac{53}{27})(\\frac{12}{31}) = \\frac{318}{27 \\cdot 31}$\n\n现在，我们将这些面积相加。我们使用公分母 $2 \\cdot 27 \\cdot 31 = 1674$。\n$AUC = \\frac{2 \\cdot 5 + 2 \\cdot 42 + 2 \\cdot 123 + 441 + 2 \\cdot 318}{1674}$\n$AUC = \\frac{10 + 84 + 246 + 441 + 636}{1674}$\n$AUC = \\frac{1417}{1674}$\n\n这就是ROC曲线下面积的精确值。",
            "answer": "$$\\boxed{\\frac{1417}{1674}}$$"
        },
        {
            "introduction": "一个高准确率分数可能具有欺骗性，尤其是在处理不平衡数据集时。这个练习  展示了一个经典但至关重要的场景：一个分类器根据准确率看似完美，但实际上完全没有提供任何信息。这个思想实验将巩固你对AUC为何通常是比准确率更可靠、更有洞察力的分类器内在判别能力评估指标的理解。",
            "id": "4138865",
            "problem": "一个研究团队正在分析钙成像信号，以检测小鼠嗅皮层中是否存在微弱的气味刺激。每次试验都会从一个训练好的解码器中产生一个标量决策变量 $S \\in [0,1]$，该解码器聚合了 $100$ 毫秒窗口内的荧光动态。由于实验限制，数据集严重不平衡：刺激存在的概率为 $P(Y=1)=0.01$，不存在的概率为 $P(Y=0)=0.99$，其中 $Y \\in \\{0,1\\}$ 表示真实类别。在一次特定的实验中，由于解码器是在未对齐的特征上训练的，其分数不具信息量：对于两个类别，$S$ 均独立且连续地服从 $\\mathrm{Uniform}(0,1)$ 分布。在部署期间，实验室使用了一个固定的决策阈值 $\\tau^{\\star}=1$ 以最小化假警报；在此阈值下，分类器对所有试验都预测 $Y=0$，从而产生由多数类主导的高准确率。\n\n从受试者工作特征（ROC）曲线的标准定义出发，计算在上述连续分数模型下该实验的受试者工作特征曲线下面积（AUC）。在你的推理中，简要解释为什么在这种严重类别不平衡的情况下，ROC分析比准确率更具信息量。将最终的AUC值表示为一个四舍五入到四位有效数字的实数。不需要单位。",
            "solution": "在进行解答之前，首先对问题进行验证。\n\n### 步骤1：提取已知条件\n- 决策变量：$S \\in [0,1]$。\n- 数据来源：用于检测气味刺激的小鼠嗅皮层钙成像信号。\n- 时间窗口：$100$ 毫秒。\n- 真实类别变量：$Y \\in \\{0,1\\}$，其中 $Y=1$ 表示刺激存在，$Y=0$ 表示刺激不存在。\n- 类别概率：$P(Y=1)=0.01$ 和 $P(Y=0)=0.99$。\n- 分数 $S$ 的条件概率分布：\n  - 对于类别 $Y=1$ (存在): $P(S|Y=1) \\sim \\mathrm{Uniform}(0,1)$。\n  - 对于类别 $Y=0$ (不存在): $P(S|Y=0) \\sim \\mathrm{Uniform}(0,1)$。\n- 分布是连续且独立的。\n- 部署中使用了固定的决策阈值 $\\tau^{\\star}=1$。\n- 任务是计算受试者工作特征曲线下面积（AUC），解释为什么在这种情况下ROC分析比准确率更具信息量，并提供四舍五入到四位有效数字的AUC值。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，描述了信号检测理论和机器学习应用于神经科学数据的标准场景。一个不具信息量的分类器（其两个类别的分数分布相同）的概念，是说明ROC分析特性的经典教科书案例。所提供的信息是完整的、自洽的且逻辑一致的。分布定义明确，计算AUC的任务是适定的。该问题没有违反任何基本科学原理，不包含事实错误，也不依赖于主观论断。类别不平衡的数值是极端的，但对于许多筛选应用来说是现实的。因此，该问题被认定为有效。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解答。\n\n### 解答推导\n\n受试者工作特征（ROC）曲线是一个图表，它展示了二元分类器系统在改变其判别阈值时的诊断能力。它是通过在不同阈值设置下，绘制真阳性率（TPR）对假阳性率（FPR）的曲线而创建的。\n\n真阳性率，也称为灵敏度或召回率，是在条件真实存在的情况下，测试结果为阳性的概率。对于给定的决策阈值 $\\tau$，如果分数 $S \\ge \\tau$，则预测为阳性（$\\hat{Y}=1$）。因此：\n$$\n\\text{TPR}(\\tau) = P(\\hat{Y}=1 | Y=1) = P(S \\ge \\tau | Y=1)\n$$\n\n假阳性率是在条件真实不存在的情况下，测试结果为阳性的概率：\n$$\n\\text{FPR}(\\tau) = P(\\hat{Y}=1 | Y=0) = P(S \\ge \\tau | Y=0)\n$$\n\n问题陈述，两个类别的分数 $S$ 均服从区间 $[0,1]$ 上的连续均匀分布。对于一个随机变量 $X \\sim \\mathrm{Uniform}(a,b)$，其概率密度函数（PDF）为，当 $x \\in [a,b]$ 时，$f(x) = \\frac{1}{b-a}$，否则为 $0$。其累积分布函数（CDF）为，当 $x \\in [a,b]$ 时，$F(x) = P(X \\le x) = \\frac{x-a}{b-a}$。\n\n在本例中，对于 $P(S|Y=1)$ 和 $P(S|Y=0)$，分布均为 $\\mathrm{Uniform}(0,1)$。令 $f_1(s)$ 和 $f_0(s)$ 分别为阳性类和阴性类的概率密度函数。我们有，当 $s \\in [0,1]$ 时，$f_1(s) = f_0(s) = 1$，否则为 $0$。\n\n现在我们可以计算对于任意阈值 $\\tau \\in [0,1]$ 的 $\\text{TPR}(\\tau)$ 和 $\\text{FPR}(\\tau)$。\n$$\n\\text{TPR}(\\tau) = P(S \\ge \\tau | Y=1) = \\int_{\\tau}^{1} f_1(s) ds = \\int_{\\tau}^{1} 1 ds = [s]_{\\tau}^{1} = 1 - \\tau\n$$\n$$\n\\text{FPR}(\\tau) = P(S \\ge \\tau | Y=0) = \\int_{\\tau}^{1} f_0(s) ds = \\int_{\\tau}^{1} 1 ds = [s]_{\\tau}^{1} = 1 - \\tau\n$$\n\nROC曲线由 $\\tau$ 参数化。令 $x = \\text{FPR}(\\tau)$ 和 $y = \\text{TPR}(\\tau)$。根据我们的计算，我们有：\n$$\nx = 1 - \\tau\n$$\n$$\ny = 1 - \\tau\n$$\n这意味着ROC曲线的方程是 $y=x$。当阈值 $\\tau$ 从 $1$ 扫描到 $0$ 时，$x$ 和 $y$ 都从 $0$ 扫描到 $1$。因此，ROC曲线是ROC空间中从点 $(0,0)$ 到 $(1,1)$ 的对角线段。\n\n曲线下面积（AUC）是ROC曲线 $y(x)$ 从 $x=0$ 到 $x=1$ 的积分。\n$$\n\\text{AUC} = \\int_{0}^{1} y(x) dx = \\int_{0}^{1} x dx\n$$\n计算该积分：\n$$\n\\text{AUC} = \\left[ \\frac{1}{2}x^2 \\right]_{0}^{1} = \\frac{1}{2}(1)^2 - \\frac{1}{2}(0)^2 = \\frac{1}{2} = 0.5\n$$\nAUC为 $0.5$ 表示该分类器没有判别能力；其性能不优于随机猜测。这个结果是预料之中的，因为阳性类和阴性类的分数分布是相同的。\n\n关于与准确率的比较：在问题中，使用了阈值 $\\tau^{\\star}=1$。对于 $[0,1]$ 上的连续分布， $S \\ge 1$ 的概率实际上是 $P(S=1)$，即为 $0$。因此，该分类器总是预测为阴性类，即 $\\hat{Y}=0$。\n\n准确率是正确预测的总概率：\n$$\n\\text{Accuracy} = P(\\hat{Y}=Y) = P(\\hat{Y}=0, Y=0) + P(\\hat{Y}=1, Y=1)\n$$\n由于 $\\hat{Y}$ 总是 $0$，第二项为 $0$。第一项是：\n$$\nP(\\hat{Y}=0, Y=0) = P(\\hat{Y}=0 | Y=0) P(Y=0)\n$$\n$P(\\hat{Y}=0 | Y=0)$ 是真阴性率（TNR）。由于预测总是阴性，$\\text{TNR}=1$。阴性类的先验概率给定为 $P(Y=0)=0.99$。\n因此，准确率为：\n$$\n\\text{Accuracy} = 1 \\times 0.99 = 0.99\n$$\n这个 $99\\%$ 的准确率异常高，但却具有极大的误导性。它暗示这是一个优秀的分类器，而实际上该分类器完全不具信息量。这个悖论的产生是因为在严重类别不平衡（$99\\%$ vs $1\\%$）的情况下，准确率指标被多数类（$Y=0$）的性能所主导。通过总是猜测多数类，分类器在没有任何真正判别能力的情况下获得了很高的准确率分数。\n\n相比之下，ROC曲线和AUC对类别流行率不敏感。TPR和FPR都是以真实类别为条件的，这意味着它们分别评估在阳性群体和阴性群体内部的性能。$0.5$ 的AUC正确且明确地揭示了该分类器没有能力区分这两个类别，暴露了高准确率所掩盖的失败。因此，在严重类别不平衡的环境中，ROC分析是一种信息量大得多、也更可靠的分类器性能衡量标准。\n\n最终的AUC值，四舍五入到四位有效数字，是 $0.5000$。",
            "answer": "$$\\boxed{0.5000}$$"
        },
        {
            "introduction": "从计算转向严谨的科学实践，获得一个可信且无偏的AUC估计需要严格的方法论。这最后一个练习  挑战你像研究员一样思考，在一个包含多个记录会话和超参数的复杂场景中，识别出一种有效的模型评估方案。它强调了嵌套交叉验证和正确处理数据依赖性的重要性，以防止乐观偏差并确保你的结果是可复现的。",
            "id": "4138948",
            "problem": "一个实验室正在评估一个神经解码流程，该流程将多变量神经特征映射到一个标量决策分数，以分类刺激存在与否。假设有从 $S$ 个记录会话中抽取的 $N$ 次试验，其中包含 $n_+$ 次阳性（刺激存在）试验和 $n_-$ 次阴性（刺激不存在）试验，并让解码器为每个特征向量 $\\mathbf{x} \\in \\mathbb{R}^d$ 生成一个分数 $s(\\mathbf{x}) \\in \\mathbb{R}$。该实验室计划使用接收者操作特征（ROC）曲线及其曲线下面积（AUC）来评估性能。\n\n基本原理和定义：接收者操作特征（ROC）曲线绘制了真阳性率 $TPR(t)$ 与假阳性率 $FPR(t)$ 的关系，作为应用于 $s(\\mathbf{x})$ 的阈值 $t \\in \\mathbb{R}$ 的函数。曲线下面积（AUC）可以等价地定义为随机选择一个阳性样本的分数高于随机选择一个阴性样本分数的概率，即\n$$\n\\mathrm{AUC} = \\Pr\\!\\big(s(X^+) > s(X^-)\\big),\n$$\n并采用适当的平局处理约定。交叉验证的目标是生成泛化性能的样本外估计，这要求测试数据不影响模型拟合或超参数选择。\n\n实验室怀疑，如果使用从测试数据中泄露的信息来调整超参数，可能会产生乐观偏差。为避免乐观偏差并报告无偏的 $ \\mathrm{AUC} $，他们考虑了以下几种方案。假设解码模型 $f_{\\lambda}$ 依赖于超参数 $\\lambda \\in \\Lambda$（例如，正则化强度和特征选择阈值），并且其参数仅在训练数据上拟合。令 $K$ 表示外层折叠数，$M$ 表示内层折叠数。假设会话级别的依赖性要求外层折叠按会话定义（即，留一会话法或会话分层折叠），而内层折叠则在外层训练数据内部操作。\n\n哪个选项正确描述了一种在神经解码的超参数调整过程中避免乐观 $ \\mathrm{AUC} $ 偏差的方案，并正确概述了如何报告最终的无偏 $ \\mathrm{AUC} $？\n\nA. 对所有试验执行单次 $K$ 折交叉验证。在分割数据前，使用在所有 $N$ 次试验上计算出的均值和方差进行 $z$-score 标准化，并通过最大化 $K$ 折上的平均 $ \\mathrm{AUC} $ 来选择 $\\lambda$。最后，将 $K$ 折的平均 $ \\mathrm{AUC} $ 作为无偏估计进行报告。\n\nB. 使用嵌套交叉验证，其中 $K$ 个外层折叠在会话级别上定义。对于每个外层折叠，将所有预处理、特征选择和内部 $M$ 折交叉验证限制在外层训练数据上，以选择能最大化内层折叠 $ \\mathrm{AUC} $ 的 $\\lambda$。在整个外层训练分区上拟合 $f_{\\hat{\\lambda}}$，对保留的外层测试分区进行评分，以获得样本外分数 $\\{s_i\\}$ 和标签 $\\{y_i\\}$。汇总所有 $K$ 个外层折叠的样本外预测，并从 $\\{(s_i,y_i)\\}$ 中计算一个合并的 ROC 及其 $ \\mathrm{AUC} $；报告这个合并的样本外 $ \\mathrm{AUC} $，并附上通过在会话级别上重采样以考虑依赖性的自举法（bootstrap）获得的 $95\\%$ 置信区间。在预处理、特征选择或超参数调整中不使用任何外层测试数据。\n\nC. 使用 $K$ 个外层折叠。对于每个外层折叠，通过直接在 $\\lambda \\in \\Lambda$ 上最大化外层测试折叠的 $ \\mathrm{AUC} $ 来选择 $\\lambda$，然后在合并的外层训练和测试数据上重新拟合 $f_{\\hat{\\lambda}}$ 以稳定参数，并报告所达到的最大外层测试折叠 $ \\mathrm{AUC} $。\n\nD. 使用具有 $K$ 个外层折叠和 $M$ 个内层折叠的嵌套交叉验证。在每个外层折叠内，选择 $\\lambda$ 以最大化内层折叠的 $ \\mathrm{AUC} $，并计算平均内层折叠 $ \\mathrm{AUC} $。将这些跨外层折叠的内层折叠 $ \\mathrm{AUC} $ 值的平均值作为最终的无偏估计进行报告，因为内层验证反映了泛化能力。\n\nE. 使用留一会话法外层交叉验证（$K=S$），在 $S-1$ 个会话内执行内层交叉验证以调整 $\\lambda$，为每个留出的会话计算一个 $ \\mathrm{AUC} $，并报告会话级 $ \\mathrm{AUC} $ 值的未加权算术平均值，而不合并预测或提供置信区间，因为 $ \\mathrm{AUC} $ 对类别不平衡不敏感且不需要不确定性量化。",
            "solution": "目标是通过确保超参数调整和所有依赖于数据的预处理都仅限于训练分区，并且评估使用在拟合或调整的任何阶段都未见过的数据上的预测，来获得 $ \\mathrm{AUC} $ 的无偏估计。\n\n基于原理的推导：\n\n1. $ \\mathrm{AUC} $ 的定义和无偏估计。$ \\mathrm{AUC} $ 是阳性样本分数 $s(X^+)$ 和阴性样本分数 $s(X^-)$ 联合分布的泛函。样本外 $ \\mathrm{AUC} $ 的无偏估计要求，用于计算 $ \\mathrm{AUC} $ 的分数是由一个模型生成的，该模型的训练（包括超参数选择）独立于测试数据。这与交叉验证的目标一致：模拟 $s(\\mathbf{x})$ 在未见数据上的分布。\n\n2. 在测试数据上进行超参数调整导致的乐观偏差。如果在测试分区上选择 $\\lambda \\in \\Lambda$ 来最大化 $ \\mathrm{AUC} $，这个选择利用了测试数据中的随机波动（估计噪声）。数学上，选择 $\\hat{\\lambda} = \\arg\\max_{\\lambda \\in \\Lambda} \\widehat{\\mathrm{AUC}}_{\\text{test}}(\\lambda)$ 会产生一个乐观的估计，因为根据 Jensen 不等式和顺序统计量，$\\mathbb{E}\\big[\\max_{\\lambda} \\widehat{\\mathrm{AUC}}_{\\text{test}}(\\lambda)\\big] \\ge \\mathrm{AUC}_{\\text{true}}$，当噪声方差非零时为严格不等式。这是一种多重比较或“二次探底”（double dipping）的形式。\n\n3. 嵌套交叉验证避免了信息泄露。为了消除泄露，嵌套交叉验证构建了一个外循环，将数据划分为 $K$ 个外层折叠。在每个外层折叠中，所有的调整都局限于从外层训练数据创建的内层折叠中。计算统计量（例如，$z$-score缩放、特征选择）的预处理步骤必须只在外层训练数据上拟合，并使用从训练分区中学到的参数应用于外层测试数据。这确保了外层测试数据上的 $s(\\mathbf{x})$ 是由一个在给定训练数据的情况下独立于测试标签的模型生成的，从而保留了 $TPR(t)$ 和 $FPR(t)$ 估计的有效性，因此也保留了 $ \\mathrm{AUC} $ 的有效性。\n\n4. 报告最终的无偏 $ \\mathrm{AUC} $。通过汇总所有外层折叠的样本外预测来获得无偏估计。可以使用所有样本外 $(s_i,y_i)$ 对来计算一个单一的合并ROC曲线和合并 $ \\mathrm{AUC} $。不确定性可以通过尊重依赖结构（例如，会话级自举法）的重采样来量化，从而产生一个 $95\\%$ 的置信区间。重要的是，绝不能在训练数据上计算 $ \\mathrm{AUC} $，也不能使用外层测试分区来选择 $\\lambda$。\n\n逐项分析：\n\nA. 该方案在分割数据之前，使用在所有 $N$ 次试验上计算的统计数据进行 $z$-score 标准化，这引入了信息泄露：标准化参数依赖于测试数据。它还使用受泄露的预处理信息影响的平均值来调整 $\\lambda$。因此，得到的 $ \\mathrm{AUC} $ 存在乐观偏差。结论：不正确。\n\nB. 该方案描述了标准的嵌套交叉验证过程。外层折叠按会话定义以尊重依赖性，内层 $M$ 折交叉验证局限于外层训练数据以选择 $\\lambda$，所有预处理也同样受到限制。外层测试分区上的分数是样本外的。汇总所有样本外预测来计算单一的合并 ROC 和 $ \\mathrm{AUC} $，可以在该数据分割方案下产生一个无偏的性能估计，而使用会话级自举法获得 $95\\%$ 的置信区间恰当地尊重了依赖性。没有发生信息泄露，因为没有任何外层测试数据影响拟合或调整。结论：正确。\n\nC. 该方案选择 $\\lambda$ 来最大化外层测试折叠的 $ \\mathrm{AUC} $，这直接违反了独立性要求，从而产生乐观偏差。它还在合并的训练和测试数据上重新拟合，破坏了测试集作为无偏评估样本的作用。报告最大的测试折叠 $ \\mathrm{AUC} $ 加剧了选择偏差。结论：不正确。\n\nD. 该方案报告内层折叠的 $ \\mathrm{AUC} $，这衡量的是调整过程中的验证性能，但不能反映对外部测试分区的样本外泛化能力。内层验证数据间接影响了 $\\lambda$ 的选择和模型配置，因此将跨外层折叠的内层折叠 $ \\mathrm{AUC} $ 进行平均并不是泛化能力的无偏估计；它忽略了最终的外层测试评估步骤，并将调整与评估混为一谈。结论：不正确。\n\nE. 该方案使用留一会话法外层交叉验证，并在训练会话内调整 $\\lambda$，这在结构上是可以接受的，能够避免信息泄露。然而，它报告的是会话级 $ \\mathrm{AUC} $ 值的未加权算术平均值，而没有合并预测或量化不确定性。虽然 $ \\mathrm{AUC} $ 对类别不平衡的敏感度低于准确率，但必须定义目标估计量：所有样本外预测的合并 $ \\mathrm{AUC} $ 估计的是试验级别的性能，而会话级 $ \\mathrm{AUC} $ 的未加权平均估计的是会话级别的平均性能。在没有理由或不确定性量化的情况下报告未加权平均值，并没有在既定目标下正确地概述如何报告最终的无偏 $ \\mathrm{AUC} $。该选项还忽略了关于尊重依赖性的区间的指导。结论：不正确。\n\n因此，唯一既能在超参数调整期间避免乐观偏差，又正确概述了如何报告最终无偏 $ \\mathrm{AUC} $ 的选项是 B。",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}