{
    "hands_on_practices": [
        {
            "introduction": "dPCA 的核心思想是将数据的总方差分解为可归因于不同任务参数的组分，这类似于方差分析 (ANOVA) 的原理。第一个练习提供了一个基础的计算，将这个抽象概念具体化。通过手动分解一个简单的数据矩阵 ，你将亲眼看到 dPCA 如何创建正交的、零均值的边缘化数据，这是实现解混的数学基础。",
            "id": "4154721",
            "problem": "考虑解混主成分分析 (dPCA)，它通过使用条件平均边缘化，将神经群体活动解混为依赖于不同任务变量的分量。在一个包含刺激和决策的平衡、全交叉双因素设计中，基本的平均算子由跨条件水平的均匀权重定义。两个矩阵之间的弗罗贝尼乌斯内积是所有对应元素乘积之和。假设有 $S=2$ 种刺激和 $D=2$ 种决策，并考虑一个单特征、试验平均的神经响应矩阵 $Y \\in \\mathbb{R}^{2 \\times 2}$，其形式为\n$$\nY \\;=\\; \\begin{pmatrix}\n3   1 \\\\\n5   9\n\\end{pmatrix}.\n$$\n仅使用均匀权重下的因子式平均和弗罗贝尼乌斯内积的基本定义，执行以下操作：\n- 计算 $Y$ 的总均值分量、仅刺激边缘化分量、仅决策边缘化分量和刺激-决策交互边缘化分量。\n- 使用弗罗贝尼乌斯内积，通过计算这三个去均值分量（仅刺激、仅决策和交互）的两两弗罗贝尼乌斯内积之和，验证在均匀平均权重下这些去均值边缘化分量的正交性。\n\n报告这三个两两弗罗贝尼乌斯内积之和的标量值。无需四舍五入。最终答案以纯数字形式表示，不带任何单位。",
            "solution": "该问题要求对给定的数据矩阵进行分量分解，这类似于方差分析 (ANOVA)，然后使用弗罗贝尼乌斯内积验证得到的去均值分量的正交性。这是解混主成分分析 (dPCA) 在平衡实验设计中的一个基本方面。\n\n给定的试验平均神经响应矩阵为：\n$$ Y = \\begin{pmatrix} 3   1 \\\\ 5   9 \\end{pmatrix} $$\n这代表了来自一个具有 $S=2$ 种刺激条件和 $D=2$ 种决策条件的全交叉设计的数据。\n\n总数据矩阵 $Y$ 可以分解为四个正交分量之和：总均值分量、仅刺激分量、仅决策分量和刺激-决策交互分量。\n$$ Y = Y_{gm} + Y_{stim} + Y_{dec} + Y_{int} $$\n这里，$Y_{stim}$、$Y_{dec}$ 和 $Y_{int}$ 是问题中提到的“去均值边缘化分量”。我们将计算这四个分量中的每一个。\n\n首先，我们按照规定使用均匀权重计算必要的平均值。总均值 $\\bar{y}$ 是 $Y$ 中所有元素的平均值：\n$$ \\bar{y} = \\frac{1}{S \\times D} \\sum_{s=1}^{S} \\sum_{d=1}^{D} y_{sd} = \\frac{1}{2 \\times 2} (3 + 1 + 5 + 9) = \\frac{18}{4} = 4.5 $$\n对于每种刺激，跨决策的平均值为：\n$$ \\bar{y}_{s=1, \\cdot} = \\frac{1}{D} (y_{11} + y_{12}) = \\frac{1}{2} (3 + 1) = 2 $$\n$$ \\bar{y}_{s=2, \\cdot} = \\frac{1}{D} (y_{21} + y_{22}) = \\frac{1}{2} (5 + 9) = 7 $$\n对于每种决策，跨刺激的平均值为：\n$$ \\bar{y}_{\\cdot, d=1} = \\frac{1}{S} (y_{11} + y_{21}) = \\frac{1}{2} (3 + 5) = 4 $$\n$$ \\bar{y}_{\\cdot, d=2} = \\frac{1}{S} (y_{12} + y_{22}) = \\frac{1}{2} (1 + 9) = 5 $$\n\n现在，我们定义并计算分解的四个分量。\n\n1.  **总均值分量 ($Y_{gm}$)**：这是一个每个元素都是总均值 $\\bar{y}$ 的矩阵。\n    $$ Y_{gm} = \\begin{pmatrix} 4.5   4.5 \\\\ 4.5   4.5 \\end{pmatrix} $$\n\n2.  **仅刺激边缘化分量 ($Y_{stim}$)**：这是第一个去均值分量，捕捉仅由刺激引起的变化。它的计算方法是用按刺激计算的平均值矩阵减去总均值分量。\n    $$ Y_{stim} = \\begin{pmatrix} 2   2 \\\\ 7   7 \\end{pmatrix} - Y_{gm} = \\begin{pmatrix} 2   2 \\\\ 7   7 \\end{pmatrix} - \\begin{pmatrix} 4.5   4.5 \\\\ 4.5   4.5 \\end{pmatrix} = \\begin{pmatrix} -2.5   -2.5 \\\\ 2.5   2.5 \\end{pmatrix} $$\n\n3.  **仅决策边缘化分量 ($Y_{dec}$)**：这是第二个去均值分量，捕捉仅由决策引起的变化。它的计算方法是用按决策计算的平均值矩阵减去总均值分量。\n    $$ Y_{dec} = \\begin{pmatrix} 4   5 \\\\ 4   5 \\end{pmatrix} - Y_{gm} = \\begin{pmatrix} 4   5 \\\\ 4   5 \\end{pmatrix} - \\begin{pmatrix} 4.5   4.5 \\\\ 4.5   4.5 \\end{pmatrix} = \\begin{pmatrix} -0.5   0.5 \\\\ -0.5   0.5 \\end{pmatrix} $$\n\n4.  **刺激-决策交互边缘化分量 ($Y_{int}$)**：这是第三个去均值分量，捕捉了未被主效应或总均值解释的剩余变化。它是从原始数据矩阵中减去其他分量后剩下的残差。\n    $$ Y_{int} = Y - Y_{gm} - Y_{stim} - Y_{dec} $$\n    代入各分量的定义：\n    $$ Y_{int} = Y - Y_{gm} - \\left( \\begin{pmatrix} 2   2 \\\\ 7   7 \\end{pmatrix} - Y_{gm} \\right) - \\left( \\begin{pmatrix} 4   5 \\\\ 4   5 \\end{pmatrix} - Y_{gm} \\right) $$\n    $$ Y_{int} = Y - \\begin{pmatrix} 2   2 \\\\ 7   7 \\end{pmatrix} - \\begin{pmatrix} 4   5 \\\\ 4   5 \\end{pmatrix} + Y_{gm} $$\n    $$ Y_{int} = \\begin{pmatrix} 3   1 \\\\ 5   9 \\end{pmatrix} - \\begin{pmatrix} 2   2 \\\\ 7   7 \\end{pmatrix} - \\begin{pmatrix} 4   5 \\\\ 4   5 \\end{pmatrix} + \\begin{pmatrix} 4.5   4.5 \\\\ 4.5   4.5 \\end{pmatrix} $$\n    $$ Y_{int} = \\begin{pmatrix} 3-2-4+4.5   1-2-5+4.5 \\\\ 5-7-4+4.5   9-7-5+4.5 \\end{pmatrix} = \\begin{pmatrix} 1.5   -1.5 \\\\ -1.5   1.5 \\end{pmatrix} $$\n\n问题要求通过计算三个去均值边缘化分量（$Y_{stim}$、$Y_{dec}$、$Y_{int}$）的两两弗罗贝尼乌斯内积之和来验证其正交性。两个矩阵 $A, B \\in \\mathbb{R}^{m \\times n}$ 的弗罗贝尼乌斯内积定义为 $\\langle A, B \\rangle_F = \\sum_{i=1}^{m} \\sum_{j=1}^{n} A_{ij} B_{ij}$。\n\n我们计算三个两两内积：\n\n1.  $\\langle Y_{stim}, Y_{dec} \\rangle_F$：\n    $$ \\langle Y_{stim}, Y_{dec} \\rangle_F = (-2.5)(-0.5) + (-2.5)(0.5) + (2.5)(-0.5) + (2.5)(0.5) $$\n    $$ = 1.25 - 1.25 - 1.25 + 1.25 = 0 $$\n\n2.  $\\langle Y_{stim}, Y_{int} \\rangle_F$：\n    $$ \\langle Y_{stim}, Y_{int} \\rangle_F = (-2.5)(1.5) + (-2.5)(-1.5) + (2.5)(-1.5) + (2.5)(1.5) $$\n    $$ = -3.75 + 3.75 - 3.75 + 3.75 = 0 $$\n\n3.  $\\langle Y_{dec}, Y_{int} \\rangle_F$：\n    $$ \\langle Y_{dec}, Y_{int} \\rangle_F = (-0.5)(1.5) + (0.5)(-1.5) + (-0.5)(-1.5) + (0.5)(1.5) $$\n    $$ = -0.75 - 0.75 + 0.75 + 0.75 = 0 $$\n\n三个两两弗罗贝尼乌斯内积均为 $0$，证实了它们的相互正交性。这是平衡设计的一个普遍属性。\n\n最后一步是计算这三个两两内积之和：\n$$ \\text{Sum} = \\langle Y_{stim}, Y_{dec} \\rangle_F + \\langle Y_{stim}, Y_{int} \\rangle_F + \\langle Y_{dec}, Y_{int} \\rangle_F = 0 + 0 + 0 = 0 $$\n总和为 $0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "dPCA 究竟是如何“解混”方差的？其秘诀在于它独特的数据中心化策略，这与标准 PCA 不同。本练习  直接比较了全局中心化与 dPCA 中使用的条件别中心化，展示了这一选择如何关键性地重塑协方差矩阵，从而分离出与特定任务参数相关的方差。",
            "id": "4154819",
            "problem": "您正在分析一个简单的神经元群体数据集，以说明中心化选择如何影响解混主成分分析（dPCA）中的解混过程。考虑一个神经元群体，包含 $2$ 个神经元，在 $2$ 种刺激（$s \\in \\{1,2\\}$）和 $2$ 个时间点（$t \\in \\{1,2\\}$）下进行记录。每个条件下试验平均的群体活动向量（单位为尖峰发放率，但最终答案中不要求单位）如下：\n- $x_{:,1,1} = \\begin{pmatrix}8\\\\3\\end{pmatrix}$，\n- $x_{:,1,2} = \\begin{pmatrix}8\\\\7\\end{pmatrix}$，\n- $x_{:,2,1} = \\begin{pmatrix}2\\\\3\\end{pmatrix}$，\n- $x_{:,2,2} = \\begin{pmatrix}2\\\\7\\end{pmatrix}$。\n\n假设解混主成分分析（dPCA）旨在通过在计算神经元间的协方差矩阵之前采用适当的中心化方案，来分离与刺激相关的成分和与时间相关的成分。您将比较两种中心化方案：\n- 全局均值减法：从每个观测值中减去所有 $(s,t)$ 条件下的总均值，然后使用观测值数量进行总体归一化，计算神经元间的协方- 全局均值减法：从每个观测值中减去所有 $(s,t)$ 条件下的总均值，然后使用观测值数量进行总体归一化，计算神经元间的协方差。\n- 按条件均值减法（刺激内中心化）：对于每种刺激 $s$，从该刺激对应的观测值中减去其在所有时间点 $t$ 上的均值，然后使用相同的总体归一化方法计算神经元间的协方差。\n\n从多变量数据的中心化和协方差的基本定义出发，计算这两种中心化方案所对应的两个协方差矩阵，找出每个矩阵的最大特征值（即第一主成分方差），并报告全局均值减法下的最大特征值与按条件均值减法下的最大特征值之比。请以精确值的形式提供您的最终答案。无需四舍五入。最终答案中不要包含单位。",
            "solution": "我们首先将数据和两种中心化方案形式化。令 $N=2$ 表示神经元的数量，令 $M=4$ 表示观测到的条件-时间组合的数量。观测值为 $x_{m} \\in \\mathbb{R}^{2}$，其中 $m \\in \\{1,2,3,4\\}$ 分别对应 $(s,t) \\in \\{(1,1),(1,2),(2,1),(2,2)\\}$：\n$$\nx_{1}=\\begin{pmatrix}8\\\\3\\end{pmatrix},\\quad\nx_{2}=\\begin{pmatrix}8\\\\7\\end{pmatrix},\\quad\nx_{3}=\\begin{pmatrix}2\\\\3\\end{pmatrix},\\quad\nx_{4}=\\begin{pmatrix}2\\\\7\\end{pmatrix}.\n$$\n根据定义，对于中心化后的数据 $\\tilde{x}_{m}$，神经元间的总体协方差为\n$$\nC \\;=\\; \\frac{1}{M}\\sum_{m=1}^{M} \\tilde{x}_{m}\\,\\tilde{x}_{m}^{\\top}.\n$$\n我们将用两种不同的中心化方案来计算这个协方差。\n\n全局均值减法：令所有条件下的总均值为\n$$\n\\bar{x} \\;=\\; \\frac{1}{M}\\sum_{m=1}^{M} x_{m}.\n$$\n分量计算 $\\bar{x}$。对于神经元1，\n$$\n\\bar{x}_{1} \\;=\\; \\frac{8+8+2+2}{4} \\;=\\; \\frac{20}{4} \\;=\\; 5.\n$$\n对于神经元2，\n$$\n\\bar{x}_{2} \\;=\\; \\frac{3+7+3+7}{4} \\;=\\; \\frac{20}{4} \\;=\\; 5.\n$$\n因此 $\\bar{x}=\\begin{pmatrix}5\\\\5\\end{pmatrix}$。中心化后的观测值为\n$$\n\\tilde{x}_{1}=\\begin{pmatrix}3\\\\-2\\end{pmatrix},\\quad\n\\tilde{x}_{2}=\\begin{pmatrix}3\\\\2\\end{pmatrix},\\quad\n\\tilde{x}_{3}=\\begin{pmatrix}-3\\\\-2\\end{pmatrix},\\quad\n\\tilde{x}_{4}=\\begin{pmatrix}-3\\\\2\\end{pmatrix}.\n$$\n计算协方差：\n$$\nC_{\\text{global}} \\;=\\; \\frac{1}{4}\\sum_{m=1}^{4}\\tilde{x}_{m}\\tilde{x}_{m}^{\\top}.\n$$\n注意，对于每个 $\\tilde{x}_{m}=\\begin{pmatrix}\\tilde{x}_{m,1}\\\\\\tilde{x}_{m,2}\\end{pmatrix}$，$\\tilde{x}_{m,1}\\in\\{3,-3\\}$ 和 $\\tilde{x}_{m,2}\\in\\{-2,2\\}$ 在4个观测值中出现的频率相同，且符号在各分量间独立分布，交叉项的平均值为零。因此，\n$$\n\\frac{1}{4}\\sum_{m=1}^{4}\\tilde{x}_{m,1}^{2} \\;=\\; 9,\\qquad\n\\frac{1}{4}\\sum_{m=1}^{4}\\tilde{x}_{m,2}^{2} \\;=\\; 4,\\qquad\n\\frac{1}{4}\\sum_{m=1}^{4}\\tilde{x}_{m,1}\\tilde{x}_{m,2} \\;=\\; 0.\n$$\n因此\n$$\nC_{\\text{global}} \\;=\\; \\begin{pmatrix}9  0 \\\\ 0  4\\end{pmatrix}.\n$$\n对角矩阵的特征值就是其对角线上的元素，所以 $C_{\\text{global}}$ 的最大特征值为\n$$\n\\lambda_{\\max}(C_{\\text{global}}) \\;=\\; 9.\n$$\n\n按条件均值减法（刺激内中心化）：对于每种刺激 $s\\in\\{1,2\\}$，计算在两个时间点 $t\\in\\{1,2\\}$ 上的均值，并从具有该刺激 $s$ 的相应观测值中减去该均值。对于 $s=1$，\n$$\n\\bar{x}^{(s=1)} \\;=\\; \\frac{1}{2}\\left(\\begin{pmatrix}8\\\\3\\end{pmatrix}+\\begin{pmatrix}8\\\\7\\end{pmatrix}\\right) \\;=\\; \\begin{pmatrix}8\\\\5\\end{pmatrix}.\n$$\n对于 $s=2$，\n$$\n\\bar{x}^{(s=2)} \\;=\\; \\frac{1}{2}\\left(\\begin{pmatrix}2\\\\3\\end{pmatrix}+\\begin{pmatrix}2\\\\7\\end{pmatrix}\\right) \\;=\\; \\begin{pmatrix}2\\\\5\\end{pmatrix}.\n$$\n刺激内中心化后的观测值变为\n$$\n\\tilde{x}_{1}^{(\\text{pc})}=\\begin{pmatrix}0\\\\-2\\end{pmatrix},\\quad\n\\tilde{x}_{2}^{(\\text{pc})}=\\begin{pmatrix}0\\\\2\\end{pmatrix},\\quad\n\\tilde{x}_{3}^{(\\text{pc})}=\\begin{pmatrix}0\\\\-2\\end{pmatrix},\\quad\n\\tilde{x}_{4}^{(\\text{pc})}=\\begin{pmatrix}0\\\\2\\end{pmatrix}.\n$$\n使用总体归一化计算协方差：\n$$\nC_{\\text{pc}} \\;=\\; \\frac{1}{4}\\sum_{m=1}^{4}\\tilde{x}_{m}^{(\\text{pc})}\\left(\\tilde{x}_{m}^{(\\text{pc})}\\right)^{\\top}.\n$$\n显然，在刺激内中心化后，第一个坐标恒为 $0$，而第二个坐标等概率地取值为 $\\pm 2$。因此，\n$$\nC_{\\text{pc}} \\;=\\; \\begin{pmatrix}0  0 \\\\ 0  4\\end{pmatrix},\n$$\n其最大特征值为\n$$\n\\lambda_{\\max}(C_{\\text{pc}}) \\;=\\; 4.\n$$\n\n对解混的影响：在全局均值减法下，刺激偏移（沿神经元1）和时间调制（沿神经元2）都对总方差有贡献，得到 $C_{\\text{global}}=\\begin{pmatrix}9  0\\\\0  4\\end{pmatrix}$，其主导成分与神经元1对齐。在按条件中心化下，每个刺激内的均值偏移被移除，从而分离出与时间相关的方差，使得 $C_{\\text{pc}}=\\begin{pmatrix}0  0\\\\0  4\\end{pmatrix}$，方差集中在神经元2上。这说明了条件内中心化如何通过消除刺激主效应来促进协方差中的解混。\n\n所要求的全局均值减法下的最大特征值与按条件均值减法下的最大特征值之比为\n$$\n\\frac{\\lambda_{\\max}(C_{\\text{global}})}{\\lambda_{\\max}(C_{\\text{pc}})} \\;=\\; \\frac{9}{4}.\n$$\n无需四舍五入。",
            "answer": "$$\\boxed{\\frac{9}{4}}$$"
        },
        {
            "introduction": "一个成功的 dPCA 应用不仅需要运行算法，还需要验证解混的质量。最后一个练习  为你提供了一个强大的定量工具，用以衡量所恢复子空间之间的“泄漏”或重叠。通过实现一个计算主角的函数，你将学会如何客观地评估与不同任务变量相关的组分是否真正分离。",
            "id": "4154790",
            "problem": "您正在分析从神经元群体数据中派生出的解混主成分分析（dPCA）子空间。对于每个任务变量索引 $m$，解混分量方向被组合成一个列空间基矩阵 $U^{(m)} \\in \\mathbb{R}^{p \\times k_m}$，其列张成解混子空间 $\\mathcal{S}_m \\subset \\mathbb{R}^p$。在实践中，$U^{(m)}$ 的列可能不是标准正交的。为了科学地量化跨变量泄露，您需要定义两个子空间 $\\mathcal{S}_m$ 和 $\\mathcal{S}_{m'}$ 之间的主角 $\\theta_i$，并使用奇异值分解（SVD）这一成熟的线性代数分解方法来计算它们。利用这些角度构建一个在 dPCA 背景下可解释的泄露指数。\n\n从子空间、标准正交基和主角的基于优化的定义出发，设计并实现一个程序，对每对 $(U^{(m)}, U^{(m')})$ 执行以下步骤：\n\n- 将 $U^{(m)}$ 和 $U^{(m')}$ 的列进行标准正交化，以获得两个张成相同子空间的正交基矩阵 $Q^{(m)}$ 和 $Q^{(m')}$。使用基于 $QR$ 分解的数值稳定方法。\n\n- 通过奇异值分解（SVD）计算 $\\mathcal{S}_m$ 和 $\\mathcal{S}_{m'}$ 之间的主角 $\\theta_i$，SVD 应用于一个从 $Q^{(m)}$ 和 $Q^{(m')}$ 导出的适当矩阵。从第一性原理推导 SVD 输出与主角之间的联系；不要在问题陈述中直接使用或陈述任何快捷公式。\n\n- 定义一个对称泄露指数 $L_{m,m'}$ 为主角余弦平方的平均值，即 $$L_{m,m'} = \\frac{1}{r} \\sum_{i=1}^{r} \\cos^2(\\theta_i),$$ 其中 $r = \\min(k_m, k_{m'})$。该指数是无量纲的，位于闭区间 $[0, 1]$ 内，值越接近 $1$ 表示解混子空间之间的重叠越强，潜在泄露越严重。\n\n- 返回以度为单位的主角和泄露指数 $L_{m,m'}$。所有角度必须以度表示。将所有浮点输出四舍五入到六位小数。\n\n测试套件。为了科学地覆盖 dPCA 子空间比较中的典型和边缘情况，请使用以下参数集。在每种情况下，$U^{(m)}$ 和 $U^{(m')}$ 都明确地以列堆叠矩阵的形式给出，并且所有条目都是实数。\n\n- 情况 $1$（理想情况，相同的子空间，最大重叠）：\n  环境维度 $p = 4$。令\n  $$U^{(m)} = \\begin{bmatrix}\n  1   0 \\\\\n  0   1 \\\\\n  0   0 \\\\\n  0   0\n  \\end{bmatrix}, \\quad\n  U^{(m')} = \\begin{bmatrix}\n  1   0 \\\\\n  0   1 \\\\\n  0   0 \\\\\n  0   0\n  \\end{bmatrix}。$$\n\n- 情况 $2$（正交子空间，无重叠）：\n  环境维度 $p = 4$。令\n  $$U^{(m)} = \\begin{bmatrix}\n  1   0 \\\\\n  0   1 \\\\\n  0   0 \\\\\n  0   0\n  \\end{bmatrix}, \\quad\n  U^{(m')} = \\begin{bmatrix}\n  0   0 \\\\\n  0   0 \\\\\n  1   0 \\\\\n  0   1\n  \\end{bmatrix}。$$\n\n- 情况 $3$（部分重叠，子空间维度不等）：\n  环境维度 $p = 5$。设角度参数为 $\\theta = 30^\\circ$，其中 $\\cos(\\theta) = \\frac{\\sqrt{3}}{2}$ 且 $\\sin(\\theta) = \\frac{1}{2}$。定义\n  $$U^{(m)} = \\begin{bmatrix}\n  1   0   0 \\\\\n  0   1   0 \\\\\n  0   0   1 \\\\\n  0   0   0 \\\\\n  0   0   0\n  \\end{bmatrix}, \\quad\n  U^{(m')} = \\begin{bmatrix}\n  \\cos(\\theta)   0 \\\\\n  \\sin(\\theta)   0 \\\\\n  0   0 \\\\\n  0   1 \\\\\n  0   0\n  \\end{bmatrix}。$$\n\n- 情况 $4$（数值边缘情况，近共线向量和非标准正交列）：\n  环境维度 $p = 3$。令 $\\varepsilon = 10^{-8}$。定义\n  $$U^{(m)} = \\begin{bmatrix}\n  1   1 \\\\\n  0   \\varepsilon \\\\\n  0   0\n  \\end{bmatrix}, \\quad\n  U^{(m')} = \\begin{bmatrix}\n  1 \\\\\n  -\\varepsilon \\\\\n  0\n  \\end{bmatrix}。$$\n\n实现和输出要求。\n\n- 对于每种情况，计算按升序排列的主角 $\\theta_i$（以度为单位）列表，然后将泄露指数 $L_{m,m'}$ 作为列表的最后一个元素追加。将所有数值输出四舍五入到六位小数。\n\n- 您的程序应生成一行输出，其中包含一个以方括号括起来的逗号分隔列表形式的结果，其中每个条目对应一个测试用例，并且本身是一个浮点数列表（主角后跟泄露指数）。例如，输出格式必须是 $$[\\text{case}_1,\\text{case}_2,\\text{case}_3,\\text{case}_4],$$ 其中每个 $\\text{case}_i$ 是一个列表。\n\n- 角度单位：度。此外不要求任何物理单位。所有浮点输出均表示为四舍五入到六位小数。\n\n- 所有计算必须完全自包含，并严格基于所提供的矩阵；不要求任何外部输入。",
            "solution": "该问题要求制定并实现一个程序，以量化从解混主成分分析（dPCA）中派生出的两个子空间 $\\mathcal{S}_m$ 和 $\\mathcal{S}_{m'}$ 之间的对齐或“泄露”。这是通过计算子空间之间的主角，然后用它们来计算一个已定义的泄露指数 $L_{m,m'}$ 来完成的。子空间通过它们的基矩阵 $U^{(m)}$ 和 $U^{(m')}$ 提供，这些矩阵的列可能不是标准正交的。\n\n解决方案主要分为三个步骤：首先，为子空间构建标准正交基；其次，使用奇异值分解（SVD）从第一性原理推导主角；第三，计算泄露指数。\n\n### 1. 标准正交基的构建\n子空间由一组基向量唯一确定，但这种表示不是唯一的。对于角度等几何计算，使用标准正交基在计算上和概念上都是必要的。给定一个基矩阵 $U \\in \\mathbb{R}^{p \\times k}$，其列张成一个 $k$ 维子空间 $\\mathcal{S} \\subset \\mathbb{R}^p$，我们必须找到一个矩阵 $Q \\in \\mathbb{R}^{p \\times k}$，其列是标准正交的（即 $Q^T Q = I_k$，其中 $I_k$ 是 $k \\times k$ 单位矩阵）并且张成相同的子空间，$\\text{span}(Q) = \\text{span}(U) = \\mathcal{S}$。\n\n实现这种转换的一种数值稳定的方法是QR分解。对于一个具有 $p \\ge k$ 和满列秩的矩阵 $A \\in \\mathbb{R}^{p \\times k}$，其“瘦”或“简化”QR分解产生唯一的分解 $A = QR$，其中 $Q \\in \\mathbb{R}^{p \\times k}$ 是一个具有标准正交列的矩阵，$R \\in \\mathbb{R}^{k \\times k}$ 是一个上三角可逆矩阵。$Q$ 的列构成了所期望的标准正交基。\n\n将此方法应用于给定的矩阵 $U^{(m)}$ 和 $U^{(m')}$，我们执行QR分解以获得标准正交基矩阵 $Q^{(m)}$ 和 $Q^{(m')}$：\n$$ U^{(m)} = Q^{(m)} R^{(m)} $$\n$$ U^{(m')} = Q^{(m')} R^{(m')} $$\n这些矩阵 $Q^{(m)} \\in \\mathbb{R}^{p \\times k_m}$ 和 $Q^{(m')} \\in \\mathbb{R}^{p \\times k_{m'}}$ 将用于所有后续计算。\n\n### 2. 通过SVD从第一性原理推导主角\n两个子空间 $\\mathcal{S}_m$ 和 $\\mathcal{S}_{m'}$ 之间的主角 $\\theta_i$ 提供了一种层次化且全面的对其相对方向的度量。它们是基于一个优化原则递归定义的。\n\n第一个也是最小的主角 $\\theta_1$ 是向量 $\\mathbf{u} \\in \\mathcal{S}_m$ 和向量 $\\mathbf{v} \\in \\mathcal{S}_{m'}$ 之间可能的最小角度。最大化角度的余弦等价于最小化角度本身。因此，$\\theta_1$ 定义为：\n$$ \\cos(\\theta_1) = \\max_{\\substack{\\mathbf{u} \\in \\mathcal{S}_m, \\|\\mathbf{u}\\|_2=1 \\\\ \\mathbf{v} \\in \\mathcal{S}_{m'}, \\|\\mathbf{v}\\|_2=1}} \\mathbf{u}^T \\mathbf{v} $$\n实现此最大值的向量 $\\mathbf{u}_1$ 和 $\\mathbf{v}_1$ 是第一对主向量。对于 $i  1$ 的后续主角 $\\theta_i$ 是通过在先前找到的主向量的正交补空间中重复此最大化过程来找到的。\n\n为了建立一种使用SVD的计算方法，我们将向量 $\\mathbf{u}$ 和 $\\mathbf{v}$ 用标准正交基 $Q^{(m)}$ 和 $Q^{(m')}$ 表示。任何单位向量 $\\mathbf{u} \\in \\mathcal{S}_m$ 都可以写成 $\\mathbf{u} = Q^{(m)} \\mathbf{x}$，其中坐标向量 $\\mathbf{x} \\in \\mathbb{R}^{k_m}$ 满足 $\\|\\mathbf{x}\\|_2 = 1$。类似地，$\\mathbf{v} = Q^{(m')} \\mathbf{y}$，其中 $\\mathbf{y} \\in \\mathbb{R}^{k_{m'}}$ 且 $\\|\\mathbf{y}\\|_2 = 1$。点积 $\\mathbf{u}^T \\mathbf{v}$ 随后可以重写为：\n$$ \\mathbf{u}^T \\mathbf{v} = (Q^{(m)} \\mathbf{x})^T (Q^{(m')} \\mathbf{y}) = \\mathbf{x}^T ( (Q^{(m)})^T Q^{(m')} ) \\mathbf{y} $$\n令 $M = (Q^{(m)})^T Q^{(m')}$。矩阵 $M \\in \\mathbb{R}^{k_m \\times k_{m'}}$ 包含了两个子空间的基向量之间的内积。$\\cos(\\theta_1)$ 的优化问题现在是：\n$$ \\cos(\\theta_1) = \\max_{\\substack{\\|\\mathbf{x}\\|_2=1 \\\\ \\|\\mathbf{y}\\|_2=1}} \\mathbf{x}^T M \\mathbf{y} $$\n这个表达式是矩阵 $M$ 的谱范数（或最大奇异值 $\\sigma_1$）的定义。Courant-Fischer定理表明，$M$ 的奇异值，按降序排列 $\\sigma_1 \\ge \\sigma_2 \\ge \\dots \\ge \\sigma_r \\ge 0$（其中 $r = \\min(k_m, k_{m'})$），是定义主角的逐次最大化问题的解。\n\n因此，主角的余弦恰好是矩阵 $M = (Q^{(m)})^T Q^{(m')}$ 的奇异值：\n$$ \\sigma_i = \\cos(\\theta_i) \\quad \\text{for } i = 1, \\dots, r $$\n由于 $Q^{(m)}$ 和 $Q^{(m')}$ 的列是单位向量，$M$ 的元素是余弦值，因此奇异值 $\\sigma_i$ 保证在区间 $[0, 1]$ 内。为了计算角度，我们首先找到 $M$ 的奇异值 $\\sigma_i$，然后计算 $\\theta_i = \\arccos(\\sigma_i)$。为保证数值鲁棒性，在应用反余弦函数之前，将计算出的奇异值裁剪到 $[0.0, 1.0]$ 范围内是明智的，以防止浮点不准确性导致的错误。得到的角度将以弧度为单位，必须转换为度。\n\n### 3. 泄露指数的计算\n问题将对称泄露指数 $L_{m,m'}$ 定义为主角余弦平方的平均值：\n$$ L_{m,m'} = \\frac{1}{r} \\sum_{i=1}^{r} \\cos^2(\\theta_i), \\quad \\text{where } r = \\min(k_m, k_{m'}) $$\n该指数为子空间重叠提供了一个单一的标量度量。$L_{m,m'} = 1$ 的值表示较小的子空间完全包含在较大的子空间内（最大重叠），而 $L_{m,m'} = 0$ 表示子空间完全正交（无重叠）。\n代入 $\\cos(\\theta_i) = \\sigma_i$，该公式可以直接从奇异值计算：\n$$ L_{m,m'} = \\frac{1}{r} \\sum_{i=1}^{r} \\sigma_i^2 $$\n最后一步是按升序对计算出的主角进行排序，并将它们与泄露指数一起呈现，所有值按要求四舍五入到 $6$ 位小数。",
            "answer": "[[0.0,0.0,1.0],[90.0,90.0,0.0],[0.0,90.0,0.5],[0.0,1.0]]"
        }
    ]
}