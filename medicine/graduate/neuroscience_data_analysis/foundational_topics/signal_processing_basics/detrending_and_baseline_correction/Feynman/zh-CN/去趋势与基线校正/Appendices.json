{
    "hands_on_practices": [
        {
            "introduction": "许多直观的去趋势方法，例如减去移动平均值，实际上是数字滤波的一种形式。这个练习通过推导一种常见的基线校正方案的精确频率响应，巩固了这一理解。它有助于将时域的直观操作与频域的分析联系起来，这是信号处理中的一项核心技能。",
            "id": "4155619",
            "problem": "一个连续的细胞外神经信号由于热波动和电极界面波动而表现出缓慢的基线漂移。为了进行去趋势，考虑以下以速率$f_{s}$采样的离散时间基线校正方案，其中采样周期为$T_{s} = 1/f_{s}$。令$x[n]$表示观测信号，$b[n]$表示基线估计，$y[n]$表示去趋势输出。基线通过参数为$\\gamma \\in (0,1)$的指数加权移动平均计算得出：\n$$b[n] = \\gamma\\, b[n-1] + (1 - \\gamma)\\, x[n],$$\n而去趋势信号则通过减法形成：\n$$y[n] = x[n] - b[n].$$\n假设$b[-1] = 0$作为因果性初始化条件，且$\\gamma$被选择为$\\gamma = \\exp(-T_{s}/\\tau)$，其中$\\tau > 0$是某个基线时间常数。\n\n仅从线性时不变系统和离散时间傅里叶变换的定义出发，并且不使用任何现成的滤波器设计公式，完成以下任务：\n1. 证明对于固定的$\\gamma$，上述定义的从$x[n]$到$y[n]$的映射是线性和时不变的。\n2. 消去$b[n]$，推导出一个关联$y[n]$、$y[n-1]$、$x[n]$和$x[n-1]$的一阶差分方程。\n3. 从此差分方程推导将$x[n]$映射到$y[n]$的所导出的一阶高通无限脉冲响应 (IIR) 滤波器的频率响应$H(\\exp(j\\omega))$。用$\\gamma$和$\\omega$的闭式形式表示$H(\\exp(j\\omega))$。\n4. 使用你的$H(\\exp(j\\omega))$所隐含的极点-零点位置，讨论关于$\\gamma$的稳定性条件、定性相位响应和最小相位特性。解释群延迟在不同频率下的行为方式及其原因。\n5. 通过推导定义相对于高频渐近增益的 -3 分贝点的隐式条件，将极点参数$\\gamma$与相对于采样率$f_{s}$的期望截止频率$f_{c}$联系起来。利用此条件将$f_{c}$写成关于$\\gamma$和$f_{s}$的表达式，并解释$\\gamma \\to 1$的情况。\n\n你的最终答案必须是第 3 部分推导出的频率响应$H(\\exp(j\\omega))$的单一闭式解析表达式。不需要数值近似或四舍五入。最终答案中不要包含单位。",
            "solution": "问题陈述已经过验证，被认为是可靠、适定且客观的。它提供了一个由低通滤波器（指数加权移动平均）派生出的一阶高通滤波器的标准公式，这是信号处理中用于去趋势的一种常用技术。所有定义都清晰且可在数学上形式化。因此，我们可以着手求解。\n\n该系统由两个方程定义：\n1. 基线估计：$b[n] = \\gamma\\, b[n-1] + (1 - \\gamma)\\, x[n]$\n2. 去趋势输出：$y[n] = x[n] - b[n]$\n初始条件为$b[-1] = 0$，参数$\\gamma \\in (0,1)$。\n\n第 1 部分：证明从$x[n]$到$y[n]$的映射是线性和时不变的。\n\n线性：如果对于任意两个输入$x_1[n]$和$x_2[n]$（分别产生输出$y_1[n]$和$y_2[n]$），输入$x[n] = a_1 x_1[n] + a_2 x_2[n]$产生的输出为$y[n] = a_1 y_1[n] + a_2 y_2[n]$（其中$a_1, a_2$为任意常数），则该系统是线性的。\n令$b_1[n]$和$b_2[n]$为对应于$x_1[n]$和$x_2[n]$的基线。\n$b_1[n] = \\gamma b_1[n-1] + (1-\\gamma)x_1[n]$\n$b_2[n] = \\gamma b_2[n-1] + (1-\\gamma)x_2[n]$\n现在考虑输入$x[n] = a_1 x_1[n] + a_2 x_2[n]$。令其对应的基线为$b[n]$。\n$b[n] = \\gamma b[n-1] + (1-\\gamma)(a_1 x_1[n] + a_2 x_2[n])$。\n我们可以看到表达式$a_1 b_1[n] + a_2 b_2[n]$满足同样的递归关系：\n$a_1 b_1[n] + a_2 b_2[n] = a_1(\\gamma b_1[n-1] + (1-\\gamma)x_1[n]) + a_2(\\gamma b_2[n-1] + (1-\\gamma)x_2[n])$\n$= \\gamma(a_1 b_1[n-1] + a_2 b_2[n-1]) + (1-\\gamma)(a_1 x_1[n] + a_2 x_2[n])$。\n由于$b[n]$和$a_1 b_1[n] + a_2 b_2[n]$都满足相同的一阶差分方程，并且共享相同的初始条件$0$（因为$b_1[-1]=0$且$b_2[-1]=0$），它们必定是相同的。因此，$b[n] = a_1 b_1[n] + a_2 b_2[n]$。\n现在考虑输出$y[n]$：\n$y[n] = x[n] - b[n] = (a_1 x_1[n] + a_2 x_2[n]) - (a_1 b_1[n] + a_2 b_2[n])$\n$= a_1(x_1[n] - b_1[n]) + a_2(x_2[n] - b_2[n]) = a_1 y_1[n] + a_2 y_2[n]$。\n因此该系统是线性的。\n\n时不变性：如果输入信号移动$n_0$个样本导致输出信号发生相同的移动，则系统是时不变的。即，如果$x[n] \\to y[n]$，那么$x[n-n_0] \\to y[n-n_0]$。\n令$x_d[n] = x[n-n_0]$为延迟后的输入。令$b_d[n]$和$y_d[n]$为其对应的基线和输出。\n$b_d[n] = \\gamma b_d[n-1] + (1-\\gamma)x_d[n] = \\gamma b_d[n-1] + (1-\\gamma)x[n-n_0]$。\n现在考虑原始基线的延迟版本$b[n-n_0]$。将原始基线方程中的索引$n$变为$n-n_0$得到：\n$b[n-n_0] = \\gamma b[n-n_0-1] + (1-\\gamma)x[n-n_0]$。\n这与$b_d[n]$的递推关系相同。假设系统从静止状态开始（输入开始前初始条件为零），则该差分方程的解是唯一的。因此，$b_d[n] = b[n-n_0]$。\n延迟输入的输出为：\n$y_d[n] = x_d[n] - b_d[n] = x[n-n_0] - b[n-n_0]$。\n右侧恰好是原始输出延迟$n_0$的定义，即$y[n-n_0]$。\n所以，$y_d[n] = y[n-n_0]$，证明了时不变性。\n\n第 2 部分：推导关联$y[n]$、$y[n-1]$、$x[n]$和$x[n-1]$的一阶差分方程。\n我们从给定的方程开始：\n(1) $y[n] = x[n] - b[n]$\n(2) $b[n] = \\gamma b[n-1] + (1-\\gamma)x[n]$\n从(1)式，我们将基线表示为输入和输出的函数：$b[n] = x[n] - y[n]$。\n因此，延迟后的基线是$b[n-1] = x[n-1] - y[n-1]$。\n将$b[n]$和$b[n-1]$的这些表达式代入方程(2)：\n$x[n] - y[n] = \\gamma(x[n-1] - y[n-1]) + (1-\\gamma)x[n]$\n我们现在重新整理这个方程，将包含$y$和$x$的项分组：\n$y[n] = x[n] - \\gamma(x[n-1] - y[n-1]) - (1-\\gamma)x[n]$\n$y[n] = x[n] - \\gamma x[n-1] + \\gamma y[n-1] - x[n] + \\gamma x[n]$\n$y[n] = \\gamma y[n-1] + \\gamma x[n] - \\gamma x[n-1]$\n这可以写成：\n$y[n] - \\gamma y[n-1] = \\gamma x[n] - \\gamma x[n-1]$\n\n第 3 部分：推导频率响应$H(\\exp(j\\omega))$。\n频率响应是系统脉冲响应的离散时间傅里叶变换 (DTFT)，可以通过对差分方程应用 DTFT 来求得。令$X(\\exp(j\\omega))$和$Y(\\exp(j\\omega))$分别为$x[n]$和$y[n]$的 DTFT。我们使用 DTFT 的时移特性：$\\mathcal{F}\\{z[n-n_0]\\} = \\exp(-j\\omega n_0) Z(\\exp(j\\omega))$。\n对第 2 部分的差分方程应用 DTFT：\n$Y(\\exp(j\\omega)) - \\gamma \\exp(-j\\omega) Y(\\exp(j\\omega)) = \\gamma X(\\exp(j\\omega)) - \\gamma \\exp(-j\\omega) X(\\exp(j\\omega))$\n将变换$Y(\\exp(j\\omega))$和$X(\\exp(j\\omega))$因子分解出来：\n$Y(\\exp(j\\omega))(1 - \\gamma \\exp(-j\\omega)) = X(\\exp(j\\omega))(\\gamma - \\gamma \\exp(-j\\omega))$\n频率响应$H(\\exp(j\\omega))$是比值$Y(\\exp(j\\omega)) / X(\\exp(j\\omega))$：\n$H(\\exp(j\\omega)) = \\frac{\\gamma - \\gamma \\exp(-j\\omega)}{1 - \\gamma \\exp(-j\\omega)}$\n从分子中提出因子$\\gamma$得到最终的闭式表达式：\n$H(\\exp(j\\omega)) = \\frac{\\gamma(1 - \\exp(-j\\omega))}{1 - \\gamma \\exp(-j\\omega)}$\n\n第 4 部分：讨论稳定性、相位、最小相位特性和群延迟。\n通过代入$z = \\exp(j\\omega)$，可以得到 Z 域中的传递函数：\n$H(z) = \\frac{\\gamma(1 - z^{-1})}{1 - \\gamma z^{-1}} = \\frac{\\gamma(z - 1)}{z - \\gamma}$\n极点-零点位置：该滤波器在$p = \\gamma$处有一个单极点，在$z = 1$处有一个单零点。\n稳定性：一个离散时间 LTI 系统是稳定的，当且仅当其所有极点都严格位于 z 平面的单位圆内。该极点位于$z=\\gamma$。由于问题规定$\\gamma \\in (0,1)$，我们有$|\\gamma| < 1$。极点在单位圆内，因此系统是稳定的。\n定性相位响应：位于$z=1$的零点对应于频率$\\omega=0$。这意味着滤波器完全阻断直流信号（$H(\\exp(j0))=0$），这是高通或带通滤波器的特征。可以证明，相位响应$\\arg[H(\\exp(j\\omega))]$在$\\omega \\to 0^+$时从$\\pi/2$开始，并随着$\\omega \\to \\pi$减小到$0$。这种正的、递减的相位是简单高通滤波器的特征。\n最小相位特性：一个因果且稳定的 LTI 系统被称为最小相位的，如果它的所有零点也严格位于单位圆内。其逆系统$H^{-1}(z)$在$z=1$处有一个极点，该点位于单位圆上，使得逆系统不稳定。因此，系统$H(z)$不是最小相位的。\n群延迟：群延迟为$\\tau_g(\\omega) = -\\frac{d}{d\\omega} \\arg[H(\\exp(j\\omega))]$。相位为$\\arg[H(\\exp(j\\omega))] = \\frac{\\pi}{2} - \\frac{\\omega}{2} - \\arctan\\left(\\frac{\\gamma \\sin(\\omega)}{1-\\gamma\\cos(\\omega)}\\right)$。对其求导得到$\\tau_g(\\omega) = \\frac{1}{2} + \\frac{\\gamma\\cos\\omega - \\gamma^2}{1 - 2\\gamma\\cos\\omega + \\gamma^2}$。在低频（$\\omega \\approx 0$）时，$\\tau_g(0) = \\frac{1}{2} + \\frac{\\gamma}{1-\\gamma}$。对于$\\gamma \\to 1$的情况，这个延迟变得非常大，反映了估计一个非常缓慢的趋势所需要的长时记忆。在高频（$\\omega = \\pi$）时，$\\tau_g(\\pi) = \\frac{1-\\gamma}{2(1+\\gamma)}$。对于$\\gamma \\to 1$的情况，这个延迟趋近于$0$，意味着高频分量几乎瞬时通过。频率相关的群延迟表明该滤波器会引入相位失真。\n\n第 5 部分：将$\\gamma$与 -3 dB 截止频率$f_c$联系起来。\n该高通滤波器的增益在最高频率$\\omega = \\pi$（奈奎斯特频率）处达到最大。此频率下的幅值即为渐近高频增益：\n$|H(\\exp(j\\pi))| = \\left|\\frac{\\gamma(1 - \\exp(-j\\pi))}{1 - \\gamma \\exp(-j\\pi)}\\right| = \\left|\\frac{\\gamma(1 - (-1))}{1 - \\gamma(-1)}\\right| = \\frac{2\\gamma}{1+\\gamma}$。\n此频率下的功率增益为$|H(\\exp(j\\pi))|^2 = \\frac{4\\gamma^2}{(1+\\gamma)^2}$。\n-3 dB 频率$\\omega_c$是指功率增益为该最大值一半时的频率。\n$|H(\\exp(j\\omega_c))|^2 = \\frac{1}{2} |H(\\exp(j\\pi))|^2$。\n频率响应的幅值平方为：\n$|H(\\exp(j\\omega))|^2 = \\frac{\\gamma^2(1 - \\exp(-j\\omega))(1 - \\exp(j\\omega))}{(1 - \\gamma\\exp(-j\\omega))(1 - \\gamma\\exp(j\\omega))} = \\frac{\\gamma^2(2 - 2\\cos(\\omega))}{1 - 2\\gamma\\cos(\\omega) + \\gamma^2}$。\n建立截止条件：\n$\\frac{\\gamma^2(2 - 2\\cos(\\omega_c))}{1 - 2\\gamma\\cos(\\omega_c) + \\gamma^2} = \\frac{1}{2}\\frac{4\\gamma^2}{(1+\\gamma)^2} = \\frac{2\\gamma^2}{(1+\\gamma)^2}$\n$\\frac{1 - \\cos(\\omega_c)}{1 - 2\\gamma\\cos(\\omega_c) + \\gamma^2} = \\frac{1}{(1+\\gamma)^2}$\n$(1 - \\cos(\\omega_c))(1+2\\gamma+\\gamma^2) = 1 - 2\\gamma\\cos(\\omega_c) + \\gamma^2$\n$1 + 2\\gamma + \\gamma^2 - \\cos(\\omega_c) - 2\\gamma\\cos(\\omega_c) - \\gamma^2\\cos(\\omega_c) = 1 - 2\\gamma\\cos(\\omega_c) + \\gamma^2$\n$2\\gamma - \\cos(\\omega_c) - \\gamma^2\\cos(\\omega_c) = 0$\n$2\\gamma = \\cos(\\omega_c)(1 + \\gamma^2)$\n这给出了隐式条件：$\\cos(\\omega_c) = \\frac{2\\gamma}{1+\\gamma^2}$。\n使用$\\omega_c = 2\\pi f_c / f_s$求解$f_c$：\n$f_c = \\frac{f_s}{2\\pi} \\arccos\\left(\\frac{2\\gamma}{1+\\gamma^2}\\right)$。\n在$\\gamma \\to 1$的情况下，反余弦函数的参数趋近于$\\frac{2(1)}{1+1^2}=1$。由于$\\arccos(1)=0$，这意味着$\\omega_c \\to 0$，因此$f_c \\to 0$。这在物理上是一致的：当$\\gamma$趋近于$1$时，时间常数$\\tau=-T_s/\\ln(\\gamma)$变得非常长，意味着指数加权移动平均（EWMA）是一个非常低通的滤波器，仅跟踪极其缓慢的漂移。因此，通过减法形成的高通滤波器的截止频率趋近于$0$，仅滤除这些非常缓慢的分量。",
            "answer": "$$\\boxed{\\frac{\\gamma (1 - \\exp(-j\\omega))}{1 - \\gamma \\exp(-j\\omega)}}$$"
        },
        {
            "introduction": "在理解了去趋势是什么之后，我们必须学会明智地应用它。多项式去趋势功能强大但存在风险，因为过于复杂的模型可能不仅会去除漂移，还会去除我们感兴趣的信号。这个实践问题提供了一个真实场景，通过实施残差谱分析和$F$检验等诊断工具，您将学习如何检测和防止此类过拟合，确保您的数据处理能够增强而非扭曲您的发现。",
            "id": "4155651",
            "problem": "您将处理一个时间序列分析任务，该任务在神经科学数据分析的背景下，专注于去趋势和基线校正。目标是构建一个科学上现实的场景，其中$3$次多项式去趋势会移除部分缓慢的任务相关振荡分量（过拟合），并实现用于检测此问题的诊断方法。假设有一个一维时间序列$y[n]$，在$N$个样本上以赫兹为单位的频率$f_s$进行采样，时间$t_n$（以秒为单位）由$t_n = n / f_s$定义，其中$n \\in \\{0,1,\\dots,N-1\\}$。信号被建模为基线漂移（$t_n$的低阶多项式）、缓慢的任务相关振荡以及加性独立零均值高斯噪声之和。所有振幅都是无量纲的。三角函数中使用的角度以弧度为单位。除秒和赫兹外，不涉及其他物理单位，所有频率必须以赫兹处理。\n\n从下面的核心定义开始，您必须实现一个完整的程序，该程序使用普通最小二乘法执行三次多项式去趋势，然后计算诊断指标，以在去趋势移除了非基线的任务相关内容时指示过拟合。\n\n使用的基本原理：\n\n- 用于线性模型的普通最小二乘法，其设计矩阵的列由中心化和缩放后的时间的幂形成，其中$p$次多项式模型有$p+1$个参数，并最小化残差平方和。\n- 使用离散傅里叶变换（DFT）定义残差谱，以及周期图，其定义为在频率$k f_s / N$（其中$k$为整数）处的 DFT 系数的平方幅值。\n- 线性模型的帽子矩阵定义及其对角线元素（杠杆值），其中杠杆值量化了每个样本对拟合的影响。\n- 比较低阶多项式模型与高阶多项式模型的嵌套模型$F$检验。\n\n您的程序必须：\n\n1. 构造三次多项式设计矩阵，其列为$[1, \\tilde{t}, \\tilde{t}^2, \\tilde{t}^3]$，其中$\\tilde{t}$是中心化和缩放后的时间，定义为$\\tilde{t}_n = (t_n - \\bar{t}) / (t_{\\max} - t_{\\min})$，$\\bar{t}$是平均时间，$t_{\\max}$是最大时间，$t_{\\min}$是最小时间。同时构造线性模型的设计矩阵，其列为$[1, \\tilde{t}]$。\n2. 通过普通最小二乘法将两个多项式模型拟合到观测到的$y[n]$，并计算残差。\n3. 通过以下步骤计算残差谱诊断指标：\n   - 对原始信号和三次去趋势后的残差使用非负频率上的实值 DFT 进行离散傅里叶变换。\n   - 识别与已知任务频率$f_{\\text{task}}$最接近的 DFT 频率点，并计算去趋势前和三次去趋势后该频率点上的周期图功率。\n   - 形成抑制比$r = P_{\\text{res}} / P_{\\text{orig}}$，其中$P_{\\text{res}}$是残差功率，$P_{\\text{orig}}$是在最接近$f_{\\text{task}}$的频率点上的原始功率；为避免除以一个极小的值，当$P_{\\text{orig}}$小于一个小的常数$\\epsilon$时，设置$r = 1$。\n4. 通过以下步骤计算杠杆值诊断指标：\n   - 为三次模型形成帽子矩阵$H = X (X^\\top X)^{-1} X^\\top$，其中$X$是三次设计矩阵。\n   - 提取对角线元素$h_{ii}$并计算$h_{\\max} = \\max_i h_{ii}$。\n5. 通过以下步骤计算嵌套模型$F$检验诊断指标：\n   - 使用线性模型作为简化模型（参数个数$p_1 = 2$），三次模型作为完整模型（参数个数$p_3 = 4$）。\n   - 计算残差平方和$\\mathrm{RSS}_1$和$\\mathrm{RSS}_3$。\n   - 计算$F$统计量，其分子自由度为$m = p_3 - p_1 = 2$，分母自由度为$N - p_3$。\n   - 计算$F$分布的相关尾部概率（p值）。\n6. 根据以下阈值，要求三个诊断指标中至少有两个指示过拟合，来判断是否检测到过拟合：\n   - 残差谱抑制：$r < 0.3$。\n   - 高杠杆值：$h_{\\max} > 3 p_3 / N$，其中$p_3 = 4$。\n   - 显著的$F$检验：$p\\text{-value} < 0.01$。\n   最终决策是一个布尔值，指示是否至少满足其中两个条件。\n\n测试套件规范：\n\n在以下测试用例上实现并运行您的程序。在所有情况下，使用采样频率$f_s = 1$赫兹，并将噪声标准差设置为给定值。振荡分量是$A \\sin(2 \\pi f_{\\text{task}} t_n)$，其振幅为$A$，频率为$f_{\\text{task}}$。基线漂移多项式为$b(t_n) = c_0 + c_1 t_n + c_2 t_n^2 + c_3 t_n^3$。\n\n- 测试用例$1$（预期为存在过拟合的一般情况）：$N = 600$, $A = 2.0$, $f_{\\text{task}} = 1 / 600$, $(c_0, c_1, c_2, c_3) = (0.0, 0.0, 0.0, 0.0)$, 噪声标准差$= 0.05$。\n- 测试用例$2$（没有任务振荡的边界情况）：$N = 600$, $A = 0.0$, $f_{\\text{task}} = 1 / 600$, $(c_0, c_1, c_2, c_3) = (0.0, 0.01, 0.0, 0.0)$, 噪声标准差$= 0.05$。\n- 测试用例$3$（短时长和半周期振荡的边缘情况）：$N = 80$, $A = 1.5$, $f_{\\text{task}} = 1 / 160$, $(c_0, c_1, c_2, c_3) = (0.0, 0.0, 0.0, 0.0)$, 噪声标准差$= 0.10$。\n\n最终输出格式：\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3]”）。每个结果都必须是一个布尔值，表示相应测试用例是否检测到过拟合（$\\mathrm{True}$）或未检测到（$\\mathrm{False}$），该布尔值通过上述第 6 项中的决策规则进行评估。不应打印任何额外文本。使用固定的随机种子以确保噪声的可复现性。\n\n在本问题陈述中，所有数学实体都必须使用 LaTeX 表示法编写。时间单位是秒，频率单位是赫兹。除弧度外不使用其他角度单位，也不使用百分比；诸如$r$之类的比率必须视为十进制数。",
            "solution": "我们从普通最小二乘法、离散傅里叶变换、帽子矩阵和杠杆值以及嵌套模型$F$检验的基本定义开始。我们将把这些集成到一个算法流程中，以模拟数据，通过三次多项式去趋势，并计算诊断指标以检测过拟合。\n\n信号模型与采样：观测到的信号为$y[n] = b(t_n) + s(t_n) + \\eta[n]$，其中$b(t)$是基线多项式漂移，$s(t)$是缓慢的任务相关振荡，$\\eta[n]$是加性独立高斯噪声，其均值为零，标准差为指定值。我们有$t_n = n / f_s$对于$n \\in \\{0,1,\\dots,N-1\\}$且$f_s = 1$赫兹，因此$t_n$的单位是秒。振荡分量是$s(t_n) = A \\sin(2 \\pi f_{\\text{task}} t_n)$，振幅为$A$，频率为$f_{\\text{task}}$（单位为赫兹）。在测试用例中，基线漂移是一个多项式$b(t_n) = c_0 + c_1 t_n + c_2 t_n^2 + c_3 t_n^3$。\n\n多项式回归与去趋势：对于一个$p$次多项式，线性模型可以写成$y = X \\beta + \\varepsilon$，其中$X$是设计矩阵，$\\beta$是参数向量，$\\varepsilon$是噪声。为了提高数值稳定性和可解释性，我们通过对时间进行中心化和缩放来构建时间回归量：\n$$\n\\tilde{t}_n = \\frac{t_n - \\bar{t}}{t_{\\max} - t_{\\min}},\n$$\n其中$\\bar{t}$是时间样本的均值，$t_{\\max}$是最大时间，$t_{\\min}$是最小时间。对于$3$次模型，设计矩阵是\n$$\nX_3 = \\begin{bmatrix}\n1 & \\tilde{t}_0 & \\tilde{t}_0^2 & \\tilde{t}_0^3 \\\\\n1 & \\tilde{t}_1 & \\tilde{t}_1^2 & \\tilde{t}_1^3 \\\\\n\\vdots & \\vdots & \\vdots & \\vdots \\\\\n1 & \\tilde{t}_{N-1} & \\tilde{t}_{N-1}^2 & \\tilde{t}_{N-1}^3\n\\end{bmatrix},\n$$\n而对于$1$次模型，设计矩阵是\n$$\nX_1 = \\begin{bmatrix}\n1 & \\tilde{t}_0 \\\\\n1 & \\tilde{t}_1 \\\\\n\\vdots & \\vdots \\\\\n1 & \\tilde{t}_{N-1}\n\\end{bmatrix}.\n$$\n普通最小二乘估计最小化$\\sum_{n=0}^{N-1} (y[n] - (X \\beta)[n])^2$，其解为\n$$\n\\hat{\\beta} = (X^\\top X)^{-1} X^\\top y.\n$$\n残差为$r = y - X \\hat{\\beta}$。去趋势操作包括从$y$中减去拟合的多项式分量$X_3 \\hat{\\beta}_3$，得到残差信号$r_3$。\n\n残差谱诊断：为评估去趋势是否移除了任务频率处的功率，我们计算最接近$f_{\\text{task}}$的 DFT 频率点上的周期图。通过以下方式定义非负频率上的实值离散傅里叶变换：\n$$\nY[k] = \\sum_{n=0}^{N-1} y[n] e^{-2 \\pi i n k / N}, \\quad k = 0,1,\\dots,\\left\\lfloor \\frac{N}{2} \\right\\rfloor,\n$$\n对应的频率为$\\omega_k = k f_s / N$。我们确定使$| \\omega_k - f_{\\text{task}} |$最小化的索引$k^*$。在$k^*$处的周期图功率为$P_{\\text{orig}} = |Y[k^*]|^2 / N$。对于三次去趋势后的残差，计算其变换$R_3[k]$和功率$P_{\\text{res}} = |R_3[k^*]|^2 / N$。抑制比为\n$$\nr = \\begin{cases}\n\\frac{P_{\\text{res}}}{P_{\\text{orig}}}, & P_{\\text{orig}} \\ge \\epsilon, \\\\\n1, & P_{\\text{orig}} < \\epsilon,\n\\end{cases}\n$$\n其中$\\epsilon$是一个小的正常数，用于防止除以可忽略的分母。如果$r < 0.3$，则表示过拟合，这表明三次去趋势已显著抑制了与任务相关的功率。\n\n杠杆值诊断：三次模型的帽子矩阵为\n$$\nH_3 = X_3 (X_3^\\top X_3)^{-1} X_3^\\top,\n$$\n其对角线元素$h_{ii}$量化了样本$i$的杠杆作用。帽子矩阵的一个性质是$\\mathrm{trace}(H_3) = p_3$，其中$p_3 = 4$是三次模型中的参数数量。平均杠杆值为$p_3 / N$。相对于平均值的高杠杆值表明可能存在过拟合或不稳定性。我们计算$h_{\\max} = \\max_i h_{ii}$，如果\n$$\nh_{\\max} > 3 \\frac{p_3}{N}.\n$$\n则判定为高杠杆值。\n\n嵌套模型$F$检验诊断：为比较参数数量为$p_1 = 2$的线性模型（简化模型）与参数数量为$p_3 = 4$的三次模型（完整模型），计算残差平方和\n$$\n\\mathrm{RSS}_1 = \\| y - X_1 \\hat{\\beta}_1 \\|_2^2, \\quad \\mathrm{RSS}_3 = \\| y - X_3 \\hat{\\beta}_3 \\|_2^2.\n$$\n$F$统计量为\n$$\nF = \\frac{(\\mathrm{RSS}_1 - \\mathrm{RSS}_3)/m}{\\mathrm{RSS}_3 / (N - p_3)},\n$$\n其中$m = p_3 - p_1 = 2$。在零假设（即增加的三次项并未在噪声之外改善拟合）下，$F$服从具有$m$和$N - p_3$自由度的$F$分布。计算尾部概率（p值）为$p = \\Pr(F_{m, N-p_3} \\ge F)$。如果\n$$\np < 0.01.\n$$\n我们判定其为显著。\n\n决策规则：如果以下至少两项为真，我们检测到过拟合：\n- $r < 0.3$（残差谱抑制），\n- $h_{\\max} > 3 p_3 / N$（高杠杆值），\n- $p < 0.01$（显著的$F$检验）。\n\n基本原理：如果三次去趋势移除了真正的与任务相关的慢振荡内容，任务频率处的周期图将显示相对于原始信号减小的功率。杠杆值标准防止拟合被极端样本主导，这在短时或病态设计中更可能发生。$F$检验表明，增加的多项式次数在统计上显著减少了残差方差，这可能是模型拟合了超出基线漂移的内容的证据。要求至少两个条件可以减少任何单一诊断指标带来的假阳性。\n\n测试套件覆盖范围：指定的测试用例涵盖了多个方面：\n- 测试用例$1$模拟了一个在整个持续时间内有一个周期的慢振荡（$f_{\\text{task}} = 1/600$赫兹）。三次多项式可以吸收不可忽略的低频结构，导致抑制和显著的模型改进，因此应检测到过拟合。\n- 测试用例$2$没有振荡（$A = 0$），因此在$f_{\\text{task}}$处的抑制不应发生；杠杆值和$F$检验可能不会同时超过阈值，因此不应检测到过拟合。\n- 测试用例$3$持续时间短，$N = 80$，具有半周期振荡（$f_{\\text{task}} = 1/160$赫兹）。由于较高的杠杆值（与平均值相比$h_{\\max}$更大）和对低频功率的抑制，三次模型可能会过拟合，从而导致检测。\n\n算法实现步骤：\n- 对于每个测试用例，根据给定的$N$、$f_s$、$A$、$f_{\\text{task}}$、基线系数$(c_0, c_1, c_2, c_3)$和噪声标准差来模拟$y[n]$。使用固定的随机种子以确保可复现性。\n- 使用中心化和缩放后的$\\tilde{t}$构建$X_1$和$X_3$。\n- 通过普通最小二乘法拟合$\\hat{\\beta}_1$和$\\hat{\\beta}_3$并计算残差。\n- 对原始信号和残差信号计算非负频率上的实值 DFT，找到与$f_{\\text{task}}$对应的$k^*$，并计算功率$P_{\\text{orig}}$和$P_{\\text{res}}$以及比率$r$。\n- 通过$H_3$计算$h_{ii}$并找到$h_{\\max}$。\n- 使用$F$分布计算$F$统计量和 p 值。\n- 应用决策规则为每个案例生成一个布尔值。\n\n最终输出将是包含布尔值列表$[\\mathrm{result}_1, \\mathrm{result}_2, \\mathrm{result}_3]$的单行文本，按顺序对应于各个测试用例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import f as f_dist\n\ndef build_time(N, Fs):\n    t = np.arange(N) / Fs\n    t_center = t.mean()\n    t_range = t.max() - t.min()\n    # Center and scale to stabilize polynomial columns\n    t_tilde = (t - t_center) / (t_range if t_range != 0 else 1.0)\n    return t, t_tilde\n\ndef design_matrix_poly(t_tilde, degree):\n    # Columns: [1, t, t^2, ..., t^degree]\n    cols = [np.ones_like(t_tilde)]\n    for d in range(1, degree + 1):\n        cols.append(t_tilde ** d)\n    X = np.column_stack(cols)\n    return X\n\ndef ols_fit_and_residual(y, X):\n    XtX = X.T @ X\n    XtX_inv = np.linalg.inv(XtX)\n    beta = XtX_inv @ (X.T @ y)\n    y_hat = X @ beta\n    residual = y - y_hat\n    return beta, residual, XtX_inv\n\ndef periodogram_power_at_freq(signal, Fs, f_task, eps=1e-12):\n    N = signal.size\n    # Real FFT non-negative frequencies\n    spec = np.fft.rfft(signal)\n    freqs = np.fft.rfftfreq(N, d=1.0/Fs)\n    # Nearest bin to task frequency\n    idx = int(np.argmin(np.abs(freqs - f_task)))\n    power = (np.abs(spec[idx]) ** 2) / N\n    return power, idx\n\ndef leverage_diag(X, XtX_inv):\n    # Hat matrix H = X (X^T X)^{-1} X^T\n    # Diagonal h_ii = row_i(X) * (X^T X)^{-1} * row_i(X)^T\n    # Efficient computation: For each row x_i, h_ii = x_i^T * XtX_inv * x_i\n    # Compute B = XtX_inv\n    B = XtX_inv\n    # h_ii for each row\n    h_diag = np.sum((X @ B) * X, axis=1)\n    return h_diag\n\ndef f_test_nested(y, X_reduced, X_full):\n    # Fit reduced and full models\n    _, res_reduced, _ = ols_fit_and_residual(y, X_reduced)\n    _, res_full, _ = ols_fit_and_residual(y, X_full)\n    RSS_reduced = float(res_reduced.T @ res_reduced)\n    RSS_full = float(res_full.T @ res_full)\n    p_reduced = X_reduced.shape[1]\n    p_full = X_full.shape[1]\n    N = y.size\n    m = p_full - p_reduced\n    df_den = N - p_full\n    # Guard against degenerate denominators\n    if df_den == 0 or m == 0:\n        return np.nan, 1.0\n    # F statistic\n    num = (RSS_reduced - RSS_full) / m\n    den = RSS_full / df_den\n    # If numerical issues produce negative num, clip at zero (no improvement)\n    if num < 0:\n        num = 0.0\n    F = num / den if den > 0 else np.inf\n    # p-value from F-distribution survival function\n    p_value = f_dist.sf(F, m, df_den) if np.isfinite(F) else 0.0\n    return F, p_value\n\ndef detect_overfitting(y, Fs, f_task, t_tilde, eps=1e-12):\n    # Build design matrices\n    X1 = design_matrix_poly(t_tilde, degree=1)\n    X3 = design_matrix_poly(t_tilde, degree=3)\n    # Fit models\n    _, res1, _ = ols_fit_and_residual(y, X1)\n    beta3, res3, XtX_inv3 = ols_fit_and_residual(y, X3)\n    # Residual spectrum suppression\n    P_orig, idx = periodogram_power_at_freq(y, Fs, f_task, eps=eps)\n    P_res, _ = periodogram_power_at_freq(res3, Fs, f_task, eps=eps)\n    r = P_res / P_orig if P_orig >= eps else 1.0\n    # Leverage\n    h_diag = leverage_diag(X3, XtX_inv3)\n    h_max = float(np.max(h_diag))\n    p3 = X3.shape[1]\n    N = y.size\n    leverage_threshold = 3.0 * p3 / N\n    high_leverage = h_max > leverage_threshold\n    # F-test\n    F_stat, p_value = f_test_nested(y, X1, X3)\n    # Decision: at least two diagnostics positive\n    suppression_positive = r < 0.3\n    ftest_positive = p_value < 0.01\n    positives = sum([suppression_positive, high_leverage, ftest_positive])\n    overfit = positives >= 2\n    return overfit, {\n        \"r\": r,\n        \"h_max\": h_max,\n        \"lev_thr\": leverage_threshold,\n        \"F\": F_stat,\n        \"p_value\": p_value\n    }\n\ndef simulate_signal(N, Fs, A_task, f_task, coeffs, noise_sigma, rng):\n    t, t_tilde = build_time(N, Fs)\n    c0, c1, c2, c3 = coeffs\n    baseline = c0 + c1 * t + c2 * (t ** 2) + c3 * (t ** 3)\n    oscillation = A_task * np.sin(2.0 * np.pi * f_task * t)\n    noise = rng.normal(loc=0.0, scale=noise_sigma, size=N)\n    y = baseline + oscillation + noise\n    return y, t_tilde\n\ndef solve():\n    # Fixed random seed for reproducibility\n    rng = np.random.default_rng(seed=123456)\n    # Define the test cases from the problem statement.\n    # Each case: (N, Fs, A_task, f_task, (c0,c1,c2,c3), noise_sigma)\n    test_cases = [\n        (600, 1.0, 2.0, 1.0/600.0, (0.0, 0.0, 0.0, 0.0), 0.05),   # Case 1: general overfitting\n        (600, 1.0, 0.0, 1.0/600.0, (0.0, 0.01, 0.0, 0.0), 0.05),  # Case 2: boundary, no oscillation\n        (80,  1.0, 1.5, 1.0/160.0, (0.0, 0.0, 0.0, 0.0), 0.10),   # Case 3: edge, short duration half-cycle\n    ]\n\n    results = []\n    for N, Fs, A_task, f_task, coeffs, noise_sigma in test_cases:\n        y, t_tilde = simulate_signal(N, Fs, A_task, f_task, coeffs, noise_sigma, rng)\n        overfit, _ = detect_overfitting(y, Fs, f_task, t_tilde, eps=1e-12)\n        results.append(overfit)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "除了技术实现，我们还必须理解我们方法背后的假设。在事件相关研究（如脑电图/事件相关电位）中，基线校正依赖于一个关于刺激前时期的关键假设。这个问题将引导您通过一个正式的推导，揭示一个主要的解释陷阱：不同实验条件下的刺激前活动差异如何在刺激后振幅估计中引入系统性偏差。这个练习强调了数据分析选择与实验结论有效性之间的关键联系。",
            "id": "4155672",
            "problem": "考虑一个典型的脑电图（EEG）事件相关分析，其中对于每个实验条件$c \\in \\{1,2\\}$和试验$i \\in \\{1,\\dots,N_c\\}$，围绕刺激起始时间$t=0$提取一个时间段$s_{c,i}(t)$，该时间段包含一个刺激前区间$t \\in [-T_{pre},0)$和一个刺激后区间$t \\in [0,T_{post}]$。假设以下生成模型，该模型通过一个分段常数均值结构和加性噪声来捕捉持续活动和刺激诱发的变化：\n$$\ns_{c,i}(t) \\;=\\; \\mu_{c}(t) \\;+\\; \\eta_{c,i}(t),\n$$\n其中$\\mu_{c}(t)$是特定于条件的并且是分段常数，\n$$\n\\mu_{c}(t) \\;=\\; \\begin{cases}\n\\mu_{pre,c}, & t \\in [-T_{pre},0),\\\\\n\\mu_{post,c}, & t \\in [0,T_{post}],\n\\end{cases}\n$$\n并且$\\eta_{c,i}(t)$是一个零均值随机过程，用于建模噪声和背景活动，对于所有的$t$、$i$和$c$，都有$\\mathbb{E}[\\eta_{c,i}(t)]=0$。假设对每个试验应用标准的基线校正程序，即从整个时间段中减去刺激前样本均值。定义原始（未校正）信号上每个试验的刺激前和刺激后样本均值为\n$$\n\\hat{\\mu}_{pre,c,i} \\;=\\; \\frac{1}{T_{pre}} \\int_{-T_{pre}}^{0} s_{c,i}(t)\\,dt, \\qquad\n\\hat{\\mu}_{post,c,i} \\;=\\; \\frac{1}{T_{post}} \\int_{0}^{T_{post}} s_{c,i}(t)\\,dt,\n$$\n定义试验$i$中条件$c$的基线校正振幅估计量为\n$$\n\\hat{A}_{c,i} \\;=\\; \\hat{\\mu}_{post,c,i} \\;-\\; \\hat{\\mu}_{pre,c,i}.\n$$\n条件水平的振幅估计量是所有试验的平均值，\n$$\n\\hat{A}_{c} \\;=\\; \\frac{1}{N_c} \\sum_{i=1}^{N_c} \\hat{A}_{c,i}.\n$$\n你需要从期望的第一性原理和平均的线性性质出发，推导不同条件间刺激前活动的差异如何影响基线校正后的期望振幅，并将条件水平上估计量$\\hat{\\mu}_{post} - \\hat{\\mu}_{pre}$相对于真实刺激后均值$\\mu_{post,c}$的期望偏差形式化。具体来说，在上述模型和假设下，推导期望偏差的解析表达式\n$$\nb_c \\;=\\; \\mathbb{E}\\!\\left[\\hat{\\mu}_{post,c} \\;-\\; \\hat{\\mu}_{pre,c}\\right] \\;-\\; \\mu_{post,c}.\n$$\n以条件水平量的闭式解析表达式给出你的最终结果。如果要计算该偏差的任何数值实例，请以微伏（microvolts）为单位表示。最终的解析表达式无需四舍五入。",
            "solution": "目标是推导期望偏差$b_c$的解析表达式，其定义为：\n$$\nb_c \\;=\\; \\mathbb{E}\\!\\left[\\hat{\\mu}_{post,c} \\;-\\; \\hat{\\mu}_{pre,c}\\right] \\;-\\; \\mu_{post,c}\n$$\n项$\\hat{\\mu}_{post,c} - \\hat{\\mu}_{pre,c}$是条件水平的基线校正振幅估计量，我们已将其表示为$\\hat{A}_c$。因此，我们要求解的是：\n$$\nb_c \\;=\\; \\mathbb{E}[\\hat{A}_c] \\;-\\; \\mu_{post,c}\n$$\n第一步是计算估计量$\\hat{A}_c$的期望值。估计量$\\hat{A}_c$定义为试验水平估计量$\\hat{A}_{c,i}$的平均值：\n$$\n\\hat{A}_c \\;=\\; \\frac{1}{N_c} \\sum_{i=1}^{N_c} \\hat{A}_{c,i} \\;=\\; \\frac{1}{N_c} \\sum_{i=1}^{N_c} (\\hat{\\mu}_{post,c,i} \\;-\\; \\hat{\\mu}_{pre,c,i})\n$$\n根据期望算子的线性性质，平均值的期望等于期望的平均值。\n$$\n\\mathbb{E}[\\hat{A}_c] \\;=\\; \\mathbb{E}\\left[\\frac{1}{N_c} \\sum_{i=1}^{N_c} \\hat{A}_{c,i}\\right] \\;=\\; \\frac{1}{N_c} \\sum_{i=1}^{N_c} \\mathbb{E}[\\hat{A}_{c,i}]\n$$\n由于在条件$c$内，所有试验$i$的生成模型都是相同的，因此期望$\\mathbb{E}[\\hat{A}_{c,i}]$对所有$i$都是相同的。因此，总和变为：\n$$\n\\mathbb{E}[\\hat{A}_c] \\;=\\; \\frac{1}{N_c} (N_c \\cdot \\mathbb{E}[\\hat{A}_{c,1}]) \\;=\\; \\mathbb{E}[\\hat{A}_{c,1}]\n$$\n这里我们使用试验$i=1$作为代表。再次使用期望的线性性质：\n$$\n\\mathbb{E}[\\hat{A}_c] \\;=\\; \\mathbb{E}[\\hat{\\mu}_{post,c,1} \\;-\\; \\hat{\\mu}_{pre,c,1}] \\;=\\; \\mathbb{E}[\\hat{\\mu}_{post,c,1}] \\;-\\; \\mathbb{E}[\\hat{\\mu}_{pre,c,1}]\n$$\n我们现在分别计算每个样本均值估计量的期望值。让我们从刺激前样本均值$\\hat{\\mu}_{pre,c,i}$开始：\n$$\n\\mathbb{E}[\\hat{\\mu}_{pre,c,i}] \\;=\\; \\mathbb{E}\\left[\\frac{1}{T_{pre}} \\int_{-T_{pre}}^{0} s_{c,i}(t)\\,dt\\right]\n$$\n我们可以交换期望和积分算子（根据 Fubini-Tonelli 定理），并代入生成模型$s_{c,i}(t) = \\mu_c(t) + \\eta_{c,i}(t)$：\n$$\n\\mathbb{E}[\\hat{\\mu}_{pre,c,i}] \\;=\\; \\frac{1}{T_{pre}} \\int_{-T_{pre}}^{0} \\mathbb{E}[s_{c,i}(t)]\\,dt \\;=\\; \\frac{1}{T_{pre}} \\int_{-T_{pre}}^{0} \\mathbb{E}[\\mu_c(t) + \\eta_{c,i}(t)]\\,dt\n$$\n均值$\\mu_c(t)$是确定性的，噪声是零均值的，$\\mathbb{E}[\\eta_{c,i}(t)]=0$。因此，$\\mathbb{E}[s_{c,i}(t)] = \\mu_c(t)$。对于刺激前区间$t \\in [-T_{pre}, 0)$，我们已知$\\mu_c(t) = \\mu_{pre,c}$。\n$$\n\\mathbb{E}[\\hat{\\mu}_{pre,c,i}] \\;=\\; \\frac{1}{T_{pre}} \\int_{-T_{pre}}^{0} \\mu_{pre,c}\\,dt \\;=\\; \\frac{\\mu_{pre,c}}{T_{pre}} [t]_{-T_{pre}}^{0} \\;=\\; \\frac{\\mu_{pre,c}}{T_{pre}}(0 - (-T_{pre})) \\;=\\; \\mu_{pre,c}\n$$\n刺激前样本均值是真实刺激前均值的无偏估计量。\n\n接下来，我们对刺激后样本均值$\\hat{\\mu}_{post,c,i}$遵循相同的过程：\n$$\n\\mathbb{E}[\\hat{\\mu}_{post,c,i}] \\;=\\; \\mathbb{E}\\left[\\frac{1}{T_{post}} \\int_{0}^{T_{post}} s_{c,i}(t)\\,dt\\right] \\;=\\; \\frac{1}{T_{post}} \\int_{0}^{T_{post}} \\mathbb{E}[s_{c,i}(t)]\\,dt\n$$\n在刺激后区间$t \\in [0, T_{post}]$，我们已知$\\mu_c(t) = \\mu_{post,c}$。\n$$\n\\mathbb{E}[\\hat{\\mu}_{post,c,i}] \\;=\\; \\frac{1}{T_{post}} \\int_{0}^{T_{post}} \\mu_{post,c}\\,dt \\;=\\; \\frac{\\mu_{post,c}}{T_{post}} [t]_{0}^{T_{post}} \\;=\\; \\frac{\\mu_{post,c}}{T_{post}}(T_{post} - 0) \\;=\\; \\mu_{post,c}\n$$\n刺激后样本均值是真实刺激后均值的无偏估计量。\n\n现在，我们将这些期望值代回到$\\mathbb{E}[\\hat{A}_c]$的表达式中：\n$$\n\\mathbb{E}[\\hat{A}_c] \\;=\\; \\mathbb{E}[\\hat{\\mu}_{post,c,i}] \\;-\\; \\mathbb{E}[\\hat{\\mu}_{pre,c,i}] \\;=\\; \\mu_{post,c} \\;-\\; \\mu_{pre,c}\n$$\n这个结果表明，基线校正振幅估计量$\\hat{A}_c$是*真实平均振幅变化*$\\mu_{post,c} - \\mu_{pre,c}$的无偏估计量。\n\n最后，我们计算问题中定义的偏差$b_c$。问题指定了估计量$\\hat{A}_c$*相对于真实刺激后均值$\\mu_{post,c}$*的偏差。这是一个非标准但定义明确的量，它突出了基线校正的一个关键属性。\n$$\nb_c \\;=\\; \\mathbb{E}[\\hat{A}_c] \\;-\\; \\mu_{post,c}\n$$\n代入我们得到的$\\mathbb{E}[\\hat{A}_c]$的结果：\n$$\nb_c \\;=\\; (\\mu_{post,c} \\;-\\; \\mu_{pre,c}) \\;-\\; \\mu_{post,c} \\;=\\; -\\mu_{pre,c}\n$$\n推导表明，当基线校正振幅$\\hat{A}_c$用作刺激后平均活动$\\mu_{post,c}$的估计量时，其期望偏差等于真实刺激前平均活动$\\mu_{pre,c}$的负值。这形式化了一个关键的见解，即任何刺激前活动水平都会直接使基线校正后的刺激后估计产生偏差。如果不同实验条件之间存在刺激前活动的差异（即$\\mu_{pre,1} \\neq \\mu_{pre,2}$），基线校正将在刺激后振幅中引入人为的差异，从而混淆对结果的解释。最终推导出的表达式是按照要求以条件水平量表示的闭式解析表达式。",
            "answer": "$$\\boxed{-\\mu_{pre,c}}$$"
        }
    ]
}