{
    "hands_on_practices": [
        {
            "introduction": "A correctly normalized Power Spectral Density (PSD) must account for the total power, or variance, of the signal. This exercise  provides a hands-on verification of this principle by asking you to numerically confirm that the total area under the periodogram equals the time-domain variance. By deriving the necessary normalization from Parseval's theorem, you will solidify your understanding of the fundamental link between the time and frequency domains.",
            "id": "4187236",
            "problem": "Let a real-valued, finite-length neural time series be denoted by $x[n]$ for $n \\in \\{0,1,\\dots,N-1\\}$, sampled uniformly with sampling frequency $F_s$ measured in hertz (Hz). Define the mean-removed series $y[n] = x[n] - \\bar{x}$ where $\\bar{x} = \\frac{1}{N} \\sum_{n=0}^{N-1} x[n]$. The finite-sample variance is defined as $\\frac{1}{N} \\sum_{n=0}^{N-1} y[n]^2$ (note: this is not the unbiased estimator with $N-1$ in the denominator). Let $Y[k]$ denote the Discrete Fourier Transform (DFT) of $y[n]$ using the non-unitary forward transform and $1/N$-scaled inverse transform, and let the periodogram-based power spectral density (PSD) be constructed from first principles so that integrating it over frequency equals the time-domain average power according to energy conservation.\n\nStarting from the fundamental definitions of the Discrete Fourier Transform (DFT) and the inverse Discrete Fourier Transform (IDFT), and from the statement that energy is preserved between the time and frequency domains for the DFT (Parseval’s theorem), derive the normalization for a two-sided periodogram in hertz that is consistent with the equality between the integral of the PSD over frequency and the finite-sample variance of $y[n]$. Then, implement a numerical verification that the sum of the periodogram values over all DFT bins multiplied by the bin width equals the finite-sample variance of $y[n]$.\n\nYour implementation must:\n- Use the non-unitary DFT convention $Y[k] = \\sum_{n=0}^{N-1} y[n] e^{-j 2 \\pi k n / N}$ and $y[n] = \\frac{1}{N} \\sum_{k=0}^{N-1} Y[k] e^{j 2 \\pi k n / N}$, with angular measure in radians.\n- Construct a two-sided periodogram in hertz obtained directly from $Y[k]$ such that summing over all $N$ frequency bins and multiplying by the frequency bin width in hertz equals the finite-sample variance $\\frac{1}{N} \\sum_{n=0}^{N-1} y[n]^2$.\n- Apply no tapering window; use the raw mean-removed signal.\n- Use the sampling frequency $F_s$ in hertz; the periodogram values must have units of squared signal units per hertz (e.g., $\\mu\\mathrm{V}^2/\\mathrm{Hz}$ if $x[n]$ is in microvolts). The final numerical check compares dimensionless quantities (variance and integrated PSD) and thus requires no physical units in the output.\n\nNumerical verification requirement and tolerance:\n- For each test case, compute the absolute error $E_\\mathrm{abs} = \\left| \\sum_{k=0}^{N-1} S[k] \\, \\Delta f \\;-\\; \\frac{1}{N} \\sum_{n=0}^{N-1} y[n]^2 \\right|$, where $S[k]$ is the two-sided periodogram in hertz and $\\Delta f = \\frac{F_s}{N}$ is the bin width in hertz.\n- Also compute the relative error $E_\\mathrm{rel} = \\frac{E_\\mathrm{abs}}{\\max\\left(\\frac{1}{N} \\sum_{n=0}^{N-1} y[n]^2,\\; \\epsilon\\right)}$ where $\\epsilon$ is a small positive constant to avoid division by zero.\n- Report a boolean for each case indicating whether $\\max(E_\\mathrm{abs}, E_\\mathrm{rel}) < 10^{-10}$.\n\nTest suite (angles for trigonometric functions are in radians; frequencies are in hertz):\n- Case $1$: $N=1024$, $F_s=1000$. Signal $x[n] = 0.5 + 2.0 \\sin\\!\\left(2\\pi \\cdot 50 \\cdot \\frac{n}{F_s}\\right) + 1.0 \\sin\\!\\left(2\\pi \\cdot 120 \\cdot \\frac{n}{F_s} + 0.3\\right)$.\n- Case $2$: $N=1000$, $F_s=800$. Signal $x[n]$ is white Gaussian noise with zero mean and standard deviation $0.8$; use a fixed random seed for reproducibility.\n- Case $3$: $N=4096$, $F_s=2000$. Signal $x[n] = 1.23$ (constant).\n- Case $4$: $N=1501$, $F_s=600$. Signal $x[n]$ is piecewise-defined: for $n < \\lfloor N/3 \\rfloor$, $x[n]=0$; for $\\lfloor N/3 \\rfloor \\le n < \\lfloor 2N/3 \\rfloor$, $x[n]=3.0$; for $n \\ge \\lfloor 2N/3 \\rfloor$, $x[n]=3.0 + 0.001 \\cdot \\left(n - \\lfloor 2N/3 \\rfloor \\right)$ (a small linear ramp).\n- Case $5$: $N=2048$, $F_s=1000$. Signal $x[n] = 1.5 \\cos\\!\\left(\\pi n\\right) + 0.7 \\sin\\!\\left(2\\pi \\cdot 70 \\cdot \\frac{n}{F_s} + 0.1\\right) + 0.4 \\sin\\!\\left(2\\pi \\cdot 125.5 \\cdot \\frac{n}{F_s} + 1.7\\right) + 0.05 \\cdot \\eta[n]$, where $\\eta[n]$ is white Gaussian noise with zero mean and unit variance; use a fixed random seed for reproducibility.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases above, for example, $[r_1,r_2,r_3,r_4,r_5]$, where each $r_i$ is the boolean indicating whether the numerical verification passed for that case.",
            "solution": "The problem requires the derivation of a normalization factor for a two-sided periodogram, $S[k]$, such that the total power computed in the frequency domain is equal to the finite-sample variance of a mean-removed time-series, $y[n]$. This equality is a direct consequence of the principle of energy conservation as expressed by Parseval's theorem for the Discrete Fourier Transform (DFT).\n\nFirst, we establish the relationship between the time and frequency domains using Parseval's theorem for the specified DFT pair. The problem defines the forward and inverse DFTs as:\n- Forward DFT: $Y[k] = \\sum_{n=0}^{N-1} y[n] e^{-j 2 \\pi k n / N}$\n- Inverse DFT (IDFT): $y[n] = \\frac{1}{N} \\sum_{k=0}^{N-1} Y[k] e^{j 2 \\pi k n / N}$\n\nTo derive Parseval's relation, we start with the total energy of the signal, which is the sum of its squared magnitudes. Since $y[n]$ is real-valued, this is simply the sum of squares, $\\sum_{n=0}^{N-1} y[n]^2$.\nWe substitute the IDFT definition for one of the $y[n]$ terms:\n$$ \\sum_{n=0}^{N-1} y[n]^2 = \\sum_{n=0}^{N-1} y[n] \\cdot y[n] = \\sum_{n=0}^{N-1} y[n] \\left( \\frac{1}{N} \\sum_{k=0}^{N-1} Y[k] e^{j 2 \\pi k n / N} \\right) $$\nBy swapping the order of summation, we can group terms:\n$$ \\sum_{n=0}^{N-1} y[n]^2 = \\frac{1}{N} \\sum_{k=0}^{N-1} Y[k] \\left( \\sum_{n=0}^{N-1} y[n] e^{j 2 \\pi k n / N} \\right) $$\nWe recognize the inner sum as the complex conjugate of the forward DFT, $Y^*[k]$. For a real signal $y[n]$, the term $\\sum_{n=0}^{N-1} y[n] e^{j 2 \\pi k n / N}$ is equivalent to $Y[-k]$ which is $Y^*[k]$. A more direct path is to substitute the conjugate of the IDFT:\n$$ \\sum_{n=0}^{N-1} y[n]^2 = \\sum_{n=0}^{N-1} y[n] \\cdot y^*[n] = \\sum_{n=0}^{N-1} y[n] \\left( \\frac{1}{N} \\sum_{k=0}^{N-1} Y[k] e^{j 2 \\pi k n / N} \\right)^* = \\sum_{n=0}^{N-1} y[n] \\left( \\frac{1}{N} \\sum_{k=0}^{N-1} Y^*[k] e^{-j 2 \\pi k n / N} \\right) $$\nSwapping the summations:\n$$ \\sum_{n=0}^{N-1} y[n]^2 = \\frac{1}{N} \\sum_{k=0}^{N-1} Y^*[k] \\left( \\sum_{n=0}^{N-1} y[n] e^{-j 2 \\pi k n / N} \\right) $$\nThe inner sum is now exactly the definition of the forward DFT, $Y[k]$. This yields:\n$$ \\sum_{n=0}^{N-1} y[n]^2 = \\frac{1}{N} \\sum_{k=0}^{N-1} Y^*[k] Y[k] = \\frac{1}{N} \\sum_{k=0}^{N-1} |Y[k]|^2 $$\nThis is Parseval's theorem for the given DFT convention.\n\nThe problem defines the time-domain average power as the finite-sample variance of $y[n]$:\n$$ P_{\\text{avg}} = \\frac{1}{N} \\sum_{n=0}^{N-1} y[n]^2 $$\nUsing the derived Parseval's relation, we can express this average power in terms of the DFT coefficients:\n$$ P_{\\text{avg}} = \\frac{1}{N} \\left( \\frac{1}{N} \\sum_{k=0}^{N-1} |Y[k]|^2 \\right) = \\frac{1}{N^2} \\sum_{k=0}^{N-1} |Y[k]|^2 $$\nThe problem requires that the integral of the Power Spectral Density (PSD), approximated by a sum over the discrete frequency bins of the periodogram $S[k]$, must equal this average power:\n$$ \\int \\text{PSD}(f) df \\approx \\sum_{k=0}^{N-1} S[k] \\Delta f = P_{\\text{avg}} $$\nThe frequency bin width, $\\Delta f$, is the spacing between adjacent frequency components in the DFT, given by $\\Delta f = F_s / N$, where $F_s$ is the sampling frequency in Hz and $N$ is the number of samples.\n\nSubstituting the expressions for $\\Delta f$ and $P_{\\text{avg}}$ into the required equality gives:\n$$ \\sum_{k=0}^{N-1} S[k] \\left( \\frac{F_s}{N} \\right) = \\frac{1}{N^2} \\sum_{k=0}^{N-1} |Y[k]|^2 $$\nFor this equality to hold, we can establish a term-by-term relationship, defining the periodogram $S[k]$ as a function of the squared magnitude of the DFT coefficients, $|Y[k]|^2$.\n$$ S[k] \\frac{F_s}{N} = \\frac{1}{N^2} |Y[k]|^2 $$\nSolving for $S[k]$ yields the normalization formula:\n$$ S[k] = \\frac{1}{N F_s} |Y[k]|^2 $$\nThis expression defines the two-sided periodogram. Let's verify the units. If the signal $y[n]$ has units of $\\mu\\mathrm{V}$, then its DFT $Y[k]$ (being a sum) has units of $\\mu\\mathrm{V}$. Thus, $|Y[k]|^2$ has units of $\\mu\\mathrm{V}^2$. $N$ is dimensionless and $F_s$ is in Hz. Therefore, the units of $S[k]$ are $\\mu\\mathrm{V}^2/\\mathrm{Hz}$, which is power per unit frequency, as required for a PSD.\n\nThe numerical implementation will follow these steps for each test case:\n1.  Generate the time-series $x[n]$ of length $N$ at sampling frequency $F_s$.\n2.  Compute the mean-removed series $y[n] = x[n] - \\bar{x}$.\n3.  Calculate the time-domain average power (finite-sample variance) as $P_{\\text{avg}} = \\frac{1}{N} \\sum_{n=0}^{N-1} y[n]^2$. This is efficiently computed as `np.mean(y**2)`.\n4.  Compute the DFT $Y[k]$ of $y[n]$ using `numpy.fft.fft`, which matches the specified DFT definition.\n5.  Calculate the two-sided periodogram $S[k]$ using the derived formula: $S[k] = \\frac{1}{N F_s} |Y[k]|^2$.\n6.  Approximate the PSD integral by summing the periodogram values and multiplying by the frequency bin width $\\Delta f = F_s/N$. The total power in the frequency domain is $P_{\\text{freq}} = \\sum_{k=0}^{N-1} S[k] \\Delta f$.\n7.  Verify the equality by computing the absolute error $E_{\\text{abs}} = |P_{\\text{freq}} - P_{\\text{avg}}|$ and relative error $E_{\\text{rel}} = E_{\\text{abs}} / \\max(P_{\\text{avg}}, \\epsilon)$. The test passes if $\\max(E_{\\text{abs}}, E_{\\text{rel}})$ is below the tolerance of $10^{-10}$. Using double-precision floating-point arithmetic, this direct mathematical identity should hold to a very high degree of precision, limited only by machine epsilon.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and numerically verifies the normalization of a periodogram-based PSD.\n    The verification confirms that the integral of the PSD over frequency equals the\n    time-domain finite-sample variance of the signal, based on Parseval's theorem.\n    \"\"\"\n\n    test_cases_params = [\n        {'N': 1024, 'Fs': 1000.0, 'case_id': 1, 'info': 'Sinusoids'},\n        {'N': 1000, 'Fs': 800.0,  'case_id': 2, 'info': 'White noise'},\n        {'N': 4096, 'Fs': 2000.0, 'case_id': 3, 'info': 'Constant signal'},\n        {'N': 1501, 'Fs': 600.0,  'case_id': 4, 'info': 'Piecewise signal'},\n        {'N': 2048, 'Fs': 1000.0, 'case_id': 5, 'info': 'Mixed signal with noise'},\n    ]\n\n    results = []\n    \n    # Use a fixed random seed for reproducibility of noise-based signals.\n    rng = np.random.default_rng(seed=0)\n\n    for params in test_cases_params:\n        N = params['N']\n        Fs = params['Fs']\n        n = np.arange(N)\n        t = n / Fs\n\n        if params['case_id'] == 1:\n            x = 0.5 + 2.0 * np.sin(2 * np.pi * 50 * t) + 1.0 * np.sin(2 * np.pi * 120 * t + 0.3)\n        \n        elif params['case_id'] == 2:\n            x = rng.normal(loc=0.0, scale=0.8, size=N)\n        \n        elif params['case_id'] == 3:\n            x = np.full(N, 1.23)\n        \n        elif params['case_id'] == 4:\n            x = np.zeros(N, dtype=np.float64)\n            n1 = int(np.floor(N / 3))\n            n2 = int(np.floor(2 * N / 3))\n            x[n1:n2] = 3.0\n            ramp_indices = np.arange(n2, N)\n            x[ramp_indices] = 3.0 + 0.001 * (ramp_indices - n2)\n            \n        elif params['case_id'] == 5:\n            eta = rng.normal(loc=0.0, scale=1.0, size=N)\n            x = 1.5 * np.cos(np.pi * n) + \\\n                0.7 * np.sin(2 * np.pi * 70 * t + 0.1) + \\\n                0.4 * np.sin(2 * np.pi * 125.5 * t + 1.7) + \\\n                0.05 * eta\n\n        # Step 1: Mean-remove the signal to get y[n].\n        y = x - np.mean(x)\n\n        # Step 2: Calculate the finite-sample variance (time-domain average power).\n        # Variance = (1/N) * sum(y[n]^2)\n        time_domain_power = np.mean(y**2)\n\n        # Step 3: Compute the DFT of y[n].\n        # Y[k] = sum_{n=0}^{N-1} y[n] * exp(-j*2*pi*k*n/N)\n        Y = np.fft.fft(y)\n\n        # Step 4: Construct the two-sided periodogram S[k].\n        # From derivation: S[k] = (1 / (N * Fs)) * |Y[k]|^2\n        S = (1 / (N * Fs)) * np.abs(Y)**2\n        \n        # Step 5: Define the frequency bin width, delta_f.\n        delta_f = Fs / N\n\n        # Step 6: Calculate total power by integrating the PSD (sum * bin_width).\n        freq_domain_power = np.sum(S) * delta_f\n\n        # Step 7: Perform numerical verification.\n        epsilon = 1e-12\n        E_abs = np.abs(freq_domain_power - time_domain_power)\n        \n        # The denominator must not be zero.\n        denominator = np.maximum(time_domain_power, epsilon)\n        E_rel = E_abs / denominator\n\n        # Check if the maximum of the absolute and relative errors is within tolerance.\n        verification_passed = np.maximum(E_abs, E_rel)  1e-10\n        \n        results.append(verification_passed)\n\n    # Final print statement in the exact required format.\n    # Booleans are converted to lowercase strings 'true'/'false'.\n    print(f\"[{','.join(str(r).lower() for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A common pitfall in spectral analysis is confusing the density of the frequency grid with the actual spectral resolution of the estimator. This practice  guides you to derive and quantify these two distinct concepts: the fundamental resolution, which is determined by the signal's observation time, and the apparent grid spacing, which can be arbitrarily refined by zero-padding. Mastering this distinction is crucial for correctly interpreting spectral features and avoiding false conclusions about the resolvability of closely spaced frequencies.",
            "id": "4187294",
            "problem": "A local field potential from rat hippocampus is recorded for power spectral density (PSD) estimation using the periodogram. The sampled discrete-time signal is $x[n]$ with $n=0,1,\\dots,N-1$, where $N=4096$ samples are acquired at a sampling frequency $f_{s}=1000\\,\\mathrm{Hz}$. The classical periodogram uses a rectangular window (i.e., an observation that is time-limited to the finite record). You will consider zero-padding the record to a longer length $L=65536$ before computing the discrete Fourier transform (DFT) via the fast Fourier transform (FFT). \n\nStarting from the following fundamental bases:\n- The observation is the product of the underlying infinite-length signal and a rectangular window in time, and multiplication in time corresponds to convolution in frequency.\n- The discrete-time Fourier transform samples the continuous spectrum on a discrete grid determined by the transform length and sampling frequency.\n\nPerform the following tasks:\n1. From the properties of the rectangular window’s frequency-domain envelope, derive the fundamental frequency resolution limit of the periodogram in Hertz as a function of $N$ and $f_{s}$. Your derivation should explicitly justify why this resolution is dictated by the record length and not by zero-padding.\n2. From the definition of the DFT frequency sampling, derive the apparent frequency grid spacing (in Hertz) after zero-padding to $L$ points, showing how the grid spacing depends on $L$ and $f_{s}$.\n\nThen, evaluate both quantities numerically for the given $N$, $f_{s}$, and $L$, and provide your final numerical results in Hertz. Round each numerical value to eight significant figures. Present your final answer as a two-entry row vector where the first entry is the periodogram’s fundamental resolution and the second entry is the apparent grid spacing after zero-padding. Express all intermediate and final frequencies in $\\mathrm{Hz}$ (Hertz).",
            "solution": "The problem asks for the derivation and calculation of two distinct frequency metrics associated with the periodogram-based power spectral density (PSD) estimation of a discrete-time signal: the fundamental frequency resolution and the apparent frequency grid spacing after zero-padding.\n\nFirst, the validity of the problem statement is established.\n\n**Step 1: Extract Givens**\n- Sampled discrete-time signal: $x[n]$\n- Number of samples in the original record: $N=4096$\n- Sampling frequency: $f_{s}=1000\\,\\mathrm{Hz}$\n- Window type: rectangular window\n- Zero-padded length for DFT computation: $L=65536$\n- Fundamental Basis 1: The observation is the product of the underlying infinite-length signal and a rectangular window in time, corresponding to convolution in frequency.\n- Fundamental Basis 2: The discrete-time Fourier transform samples the continuous spectrum on a discrete grid determined by the transform length and sampling frequency.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem is based on the fundamental principles of digital signal processing, specifically Fourier analysis and spectral estimation. The concepts of windowing, spectral leakage, frequency resolution, zero-padding, and the Discrete Fourier Transform (DFT) are standard and scientifically sound. The application to local field potential (LFP) data is realistic and common in neuroscience.\n- **Well-Posed**: The problem provides all necessary parameters ($N$, $f_s$, $L$) and clear objectives to derive and calculate the two required quantities. The solution is unique and stable.\n- **Objective**: The problem is stated using precise, unambiguous technical language. It is free of subjective or opinion-based claims.\n- The problem does not violate any of the invalidity criteria. It is not unsound, incomplete, unrealistic, or ill-posed.\n\n**Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n**Part 1: Derivation of the Fundamental Frequency Resolution**\n\nThe fundamental frequency resolution of a spectral estimate is its ability to distinguish between two distinct, closely spaced frequency components. For the periodogram, this resolution is determined by the length of the observation window, not by the length of the DFT used to compute the spectrum.\n\nThe problem states that the observed finite-length signal, let's call it $x_w[n]$, is the product of the true, potentially infinite-length, underlying signal $x_{true}[n]$ and a rectangular window $w_R[n]$ of length $N$.\n$$x_w[n] = x_{true}[n] \\cdot w_R[n]$$\nwhere the rectangular window is defined as:\n$$w_R[n] = \\begin{cases} 1  \\text{for } n = 0, 1, \\dots, N-1 \\\\ 0  \\text{otherwise} \\end{cases}$$\nThe multiplication in the time domain corresponds to circular convolution in the frequency domain. The Discrete-Time Fourier Transform (DTFT), which represents the continuous spectrum of the discrete-time signal, of the windowed signal $X_w(e^{j\\omega})$ is the convolution of the true signal's spectrum $X_{true}(e^{j\\omega})$ and the window's spectrum $W_R(e^{j\\omega})$:\n$$X_w(e^{j\\omega}) = \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} X_{true}(e^{j\\theta}) W_R(e^{j(\\omega-\\theta)}) d\\theta$$\nThis convolution operation \"smears\" the true spectrum $X_{true}(e^{j\\omega})$ by the shape of the window's spectrum $W_R(e^{j\\omega})$. The width of the main lobe of $W_R(e^{j\\omega})$ determines the extent of this smearing and thus sets the limit on frequency resolution.\n\nThe DTFT of the rectangular window $w_R[n]$ is given by:\n$$W_R(e^{j\\omega}) = \\sum_{n=0}^{N-1} 1 \\cdot e^{-j\\omega n} = e^{-j\\omega\\frac{N-1}{2}} \\frac{\\sin(N\\omega/2)}{\\sin(\\omega/2)}$$\nThis function is a form of the Dirichlet kernel. Its magnitude, $|W_R(e^{j\\omega})|$, has a main lobe centered at $\\omega=0$. The resolution is conventionally defined based on the width of this main lobe. The first nulls of the main lobe occur when the numerator, $\\sin(N\\omega/2)$, equals zero, but the denominator, $\\sin(\\omega/2)$, is non-zero. This condition is met when:\n$$\\frac{N\\omega}{2} = k\\pi, \\quad \\text{for any non-zero integer } k$$\nThe first nulls on either side of the main lobe correspond to $k=\\pm 1$. Thus, the locations of the first nulls are:\n$$\\omega_{\\text{null}} = \\pm \\frac{2\\pi}{N} \\quad (\\text{radians per sample})$$\nThe frequency resolution, $\\Delta f_{res}$, is the minimum separation required to distinguish two frequency components. According to the Rayleigh criterion, two components are just resolvable if the maximum of one component's spectral response coincides with the first minimum (null) of the other. This separation corresponds to the distance from the center of the main lobe ($\\omega=0$) to the first null, which is $\\frac{2\\pi}{N}$ radians per sample.\n\nTo convert this resolution from normalized angular frequency (radians/sample) to physical frequency (Hertz), we use the relationship $\\omega = 2\\pi f / f_s$, where $f$ is the physical frequency and $f_s$ is the sampling frequency.\nLet $\\Delta \\omega_{res}$ be the resolution in radians per sample and $\\Delta f_{res}$ be the resolution in Hertz.\n$$\\Delta \\omega_{res} = \\frac{2\\pi}{N}$$\n$$2\\pi \\frac{\\Delta f_{res}}{f_s} = \\frac{2\\pi}{N}$$\nSolving for $\\Delta f_{res}$, we obtain the fundamental frequency resolution:\n$$\\Delta f_{res} = \\frac{f_s}{N}$$\nThis derivation explicitly shows that the resolution depends only on the sampling frequency $f_s$ and the original record length $N$. Zero-padding the signal to a length $L  N$ before the DFT does not change the duration of the original time-domain window. Therefore, it does not alter the shape of the window's transform $W_R(e^{j\\omega})$ and cannot improve the fundamental resolution limit imposed by it. Zero-padding merely provides a denser sampling of the smeared spectrum $X_w(e^{j\\omega})$.\n\n**Part 2: Derivation of the Apparent Frequency Grid Spacing**\n\nThe DFT computes samples of the DTFT at discrete frequency points. The spacing of these points depends on the total length of the sequence transformed, which in this case is the zero-padded length $L$.\n\nThe $L$-point DFT of a signal $x[n]$ (assumed to be of length $L$) is defined as:\n$$X[k] = \\sum_{n=0}^{L-1} x[n] e^{-j \\frac{2\\pi k n}{L}}, \\quad \\text{for } k = 0, 1, \\dots, L-1$$\nEach DFT bin index $k$ corresponds to a specific analysis frequency. The DFT samples the continuous spectrum $X(e^{j\\omega})$ at the discrete normalized angular frequencies:\n$$\\omega_k = \\frac{2\\pi k}{L} \\quad (\\text{radians per sample})$$\nTo find the physical frequencies $f_k$ in Hertz corresponding to these bins, we again use the relation $\\omega_k = 2\\pi f_k / f_s$:\n$$2\\pi \\frac{f_k}{f_s} = \\frac{2\\pi k}{L}$$\nThis yields the frequency of the $k$-th bin:\n$$f_k = k \\cdot \\frac{f_s}{L}$$\nThe apparent frequency grid spacing, $\\Delta f_{grid}$, is the difference in frequency between adjacent DFT bins, such as between bin $k$ and bin $k+1$:\n$$\\Delta f_{grid} = f_{k+1} - f_k = (k+1)\\frac{f_s}{L} - k\\frac{f_s}{L}$$\nThis simplifies to:\n$$\\Delta f_{grid} = \\frac{f_s}{L}$$\nThis result shows that the spacing of the DFT frequency grid is determined by the sampling frequency $f_s$ and the total transform length $L$ (including zero-padding), and is independent of the original signal length $N$.\n\n**Numerical Evaluation**\n\nThe given values are:\n- $N=4096$\n- $f_s=1000\\,\\mathrm{Hz}$\n- $L=65536$\n\n1.  **Fundamental Frequency Resolution ($\\Delta f_{res}$):**\n    $$\\Delta f_{res} = \\frac{f_s}{N} = \\frac{1000}{4096} = 0.244140625\\,\\mathrm{Hz}$$\n    Rounding to eight significant figures, we get $0.24414063\\,\\mathrm{Hz}$.\n\n2.  **Apparent Frequency Grid Spacing ($\\Delta f_{grid}$):**\n    $$\\Delta f_{grid} = \\frac{f_s}{L} = \\frac{1000}{65536} = 0.0152587890625\\,\\mathrm{Hz}$$\n    Rounding to eight significant figures, we get $0.015258789\\,\\mathrm{Hz}$.\n\nThe final answer will be presented as a two-entry row vector containing these two numerical values.",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.24414063  0.015258789 \\end{pmatrix}}$$"
        },
        {
            "introduction": "While zero-padding does not improve the fundamental spectral resolution, it is an invaluable tool for improving the *accuracy* of peak frequency estimation. This coding exercise  allows you to see this effect in action by simulating a signal with a known frequency and observing how the estimation bias changes with and without zero-padding. This will clarify the practical utility of zero-padding in mitigating the \"picket-fence effect\" and obtaining more precise frequency estimates from a periodogram.",
            "id": "4187300",
            "problem": "Consider a synthetic Local Field Potential (LFP) time series segment modeled as a sampled deterministic sinusoid of finite duration. Let the sampling frequency be $f_s = 1000$ Hz and the segment duration be $T = 5$ seconds, so the number of samples is $N = f_s T = 5000$. For a discrete-time signal $x[n]$, $n \\in \\{0,1,\\ldots,N-1\\}$, the Discrete Fourier Transform (DFT) is defined by\n$$\nX[k] = \\sum_{n=0}^{N-1} x[n] e^{-j 2\\pi k n / N}, \\quad k \\in \\{0,1,\\ldots,N-1\\},\n$$\nand the corresponding frequency grid is\n$$\nf_k = \\frac{k f_s}{N}.\n$$\nThe periodogram estimate of the Power Spectral Density (PSD) is defined from first principles as the squared magnitude of the DFT, appropriately normalized to have physical units of power per Hertz. One widely used normalization for a one-sided periodogram of a real-valued finite-duration sequence is\n$$\nP[f_k] = \\frac{1}{f_s N} \\left| X[k] \\right|^2,\n$$\nfor $k$ corresponding to nonnegative frequencies. Zero-padding by a factor $z \\in \\mathbb{N}$ does not change the information content or the effective rectangular window of duration $T$, but it increases the density of the sampled frequency grid to\n$$\n\\tilde{f}_k = \\frac{k f_s}{M}, \\quad M = z N,\n$$\nand the DFT computed on the zero-padded sequence of length $M$ is\n$$\n\\tilde{X}[k] = \\sum_{n=0}^{M-1} \\tilde{x}[n] e^{-j 2\\pi k n / M}, \\quad \\tilde{x}[n] = \\begin{cases} x[n],  0 \\le n \\le N-1, \\\\ 0,  N \\le n \\le M-1. \\end{cases}\n$$\nYou will implement a program that synthesizes sinusoidal LFP segments, computes periodograms with and without zero-padding, and returns peak frequency estimates. You must reason from these definitions and facts: the rectangular window of duration $T$ implies a fundamental spectral resolution on the order of $1/T$, and zero-padding does not reduce the main-lobe width of the spectral window but samples it more densely. The algorithm must compute the DFT magnitude-squared, form a one-sided periodogram, restrict the search to a physiologically plausible LFP band, and locate the peak frequency as the grid point with maximal periodogram power. The goal is to compare peak estimates with and without zero-padding and quantify the bias relative to the known sinusoid frequency.\n\nYour program must implement the following steps for each test case:\n- Construct $x[n] = A \\sin\\left( 2\\pi f_0 \\frac{n}{f_s} \\right)$ for $n = 0,1,\\ldots,N-1$, with amplitude $A$ and target frequency $f_0$ given in the test suite. Do not add noise; the purpose is to isolate discretization and windowing effects.\n- Compute the one-sided periodogram using the DFT magnitude-squared. Use zero-padding factor $z=1$ (no padding) for the first estimate, and $z=8$ for the second estimate. For both, restrict the peak search to the frequency band $[f_{\\min}, f_{\\max}]$ specified in the test suite.\n- Report the peak frequencies $\\hat{f}_{\\text{no-pad}}$ and $\\hat{f}_{\\text{pad}}$ in Hertz, and the biases $\\Delta_{\\text{no-pad}} = \\hat{f}_{\\text{no-pad}} - f_0$ and $\\Delta_{\\text{pad}} = \\hat{f}_{\\text{pad}} - f_0$ in Hertz.\n\nPhysical units requirement: All reported frequencies and biases must be expressed in Hertz (Hz) as decimal numbers.\n\nTest suite:\n- Case $1$ (happy path off-bin): $f_0 = 40.3$ Hz, $A = 1.0$, $f_{\\min} = 1$ Hz, $f_{\\max} = 100$ Hz.\n- Case $2$ (bin-centered boundary): $f_0 = 40.2$ Hz, $A = 1.0$, $f_{\\min} = 1$ Hz, $f_{\\max} = 100$ Hz.\n- Case $3$ (low-frequency edge off-bin): $f_0 = 5.05$ Hz, $A = 1.0$, $f_{\\min} = 1$ Hz, $f_{\\max} = 50$ Hz.\n\nDesign for coverage: Case $1$ tests off-bin peak estimation in the beta band; Case $2$ tests a sinusoid exactly aligned with a native DFT bin; Case $3$ tests off-bin estimation near the low-frequency edge of the search band.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case’s result must itself be a list of four decimal numbers in Hertz, ordered as $[\\hat{f}_{\\text{no-pad}}, \\hat{f}_{\\text{pad}}, \\Delta_{\\text{no-pad}}, \\Delta_{\\text{pad}}]$. For example, the full output must look like $[[r_{11},r_{12},r_{13},r_{14}],[r_{21},r_{22},r_{23},r_{24}],[r_{31},r_{32},r_{33},r_{34}]]$, where all $r_{ij}$ are decimal numbers in Hertz.",
            "solution": "The problem is valid. It is a well-posed, scientifically grounded exercise in digital signal processing, specifically concerning the estimation of power spectral density using the periodogram method, a common task in neuroscience for analyzing Local Field Potential (LFP) data. All definitions, constants, and test cases are provided, free of contradiction or ambiguity, allowing for a unique and meaningful solution.\n\nThe core of this problem lies in understanding the consequences of analyzing a finite-duration, discretely sampled signal using the Discrete Fourier Transform (DFT). The finite duration $T$ of the signal implies a convolution in the frequency domain with the Fourier transform of a rectangular window, which is a sinc function. This convolution causes spectral leakage, where the energy of a pure sinusoid at frequency $f_0$ is spread across the frequency spectrum, with a main lobe centered at $f_0$ and a width proportional to $1/T$. The DFT samples this continuous spectrum at a discrete set of frequencies. If the true frequency $f_0$ does not align perfectly with one of these DFT frequency bins, a phenomenon known as \"picket-fence effect\" occurs, and the maximum of the DFT magnitude will be found at the nearest bin, introducing an estimation bias. Zero-padding is a technique to mitigate this specific bias by interpolating the DFT spectrum, providing a denser sampling of the underlying sinc-shaped spectral peak and thus enabling a more accurate estimate of its true maximum.\n\nThe solution proceeds by implementing the specified steps for each test case.\n\n**1. Signal Generation**\n\nFor each case, we synthesize a deterministic sinusoidal signal $x[n]$ according to the model:\n$$x[n] = A \\sin\\left( 2\\pi f_0 \\frac{n}{f_s} \\right)$$\nwhere the amplitude $A$, true frequency $f_0$, and sampling frequency $f_s = 1000$ Hz are given. The signal is generated for a duration of $T = 5$ seconds, resulting in $N = f_s T = 5000$ discrete samples, indexed by $n \\in \\{0, 1, \\ldots, N-1\\}$. No noise is added, isolating the effects of windowing and discretization.\n\n**2. Periodogram Estimation without Zero-Padding ($z=1$)**\n\nFirst, we analyze the signal without zero-padding. The DFT length is equal to the signal length, $N=5000$.\nThe DFT, $X[k]$, is computed:\n$$X[k] = \\sum_{n=0}^{N-1} x[n] e^{-j 2\\pi k n / N}$$\nThe frequency grid for this DFT is given by $f_k = k \\frac{f_s}{N}$ for $k \\in \\{0, 1, \\ldots, N-1\\}$. The fundamental frequency resolution, determined by the observation window duration $T$, is $\\Delta f = f_s/N = 1/T = 1000/5000 = 0.2$ Hz.\nThe algorithm requires locating the peak of the periodogram, which corresponds to the maximum of $|X[k]|^2$. The normalization factor given in the problem, $1/(f_s N)$, is a constant scaling and does not affect the location of the peak; thus, we can simply find the maximum of the squared DFT magnitude. Since the input signal $x[n]$ is real-valued, the magnitude spectrum is symmetric, and we only need to analyze the one-sided spectrum for non-negative frequencies, which corresponds to indices $k \\in \\{0, 1, \\ldots, \\lfloor N/2 \\rfloor\\}$.\nThe search for the peak is constrained to the frequency band $[f_{\\min}, f_{\\max}]$. We identify the range of indices $[k_{\\min}, k_{\\max}]$ corresponding to this band and find the index $k^*$ that maximizes $|X[k]|^2$ within this range. The estimated peak frequency is then:\n$$\\hat{f}_{\\text{no-pad}} = k^* \\frac{f_s}{N}$$\n\n**3. Periodogram Estimation with Zero-Padding ($z=8$)**\n\nNext, we apply zero-padding. A new signal $\\tilde{x}[n]$ is formed by appending zeros to the original signal $x[n]$ to achieve a total length of $M = zN = 8 \\times 5000 = 40000$.\n$$\\tilde{x}[n] = \\begin{cases} x[n],  0 \\le n \\le N-1 \\\\ 0,  N \\le n \\le M-1 \\end{cases}$$\nThe DFT, $\\tilde{X}[k]$, of this zero-padded sequence is computed:\n$$\\tilde{X}[k] = \\sum_{n=0}^{M-1} \\tilde{x}[n] e^{-j 2\\pi k n / M}$$\nThis operation does not alter the underlying continuous spectrum (the sinc function) but samples it at a much denser grid of frequencies:\n$$\\tilde{f}_k = k \\frac{f_s}{M} = k \\frac{1000}{40000} = k \\times 0.025 \\text{ Hz}$$\nThe frequency resolution has been effectively interpolated by a factor of $z=8$. We again find the index $\\tilde{k}^*$ that maximizes $|\\tilde{X}[k]|^2$ within the search band $[f_{\\min}, f_{\\max}]$ and compute the corresponding peak frequency:\n$$\\hat{f}_{\\text{pad}} = \\tilde{k}^* \\frac{f_s}{M}$$\n\n**4. Bias Calculation**\n\nFor both estimates, the bias is calculated as the difference between the estimated frequency and the true frequency $f_0$:\n$$\\Delta_{\\text{no-pad}} = \\hat{f}_{\\text{no-pad}} - f_0$$\n$$\\Delta_{\\text{pad}} = \\hat{f}_{\\text{pad}} - f_0$$\n\n**Analysis of Test Cases**\n\n- **Case 1 ($f_0 = 40.3$ Hz):** The true frequency is off-bin, as $40.3$ is not an integer multiple of the native resolution $\\Delta f = 0.2$ Hz. It lies between the bins for $40.2$ Hz ($k=201$) and $40.4$ Hz ($k=202$). The unpadded periodogram peak will be snapped to the nearest bin, causing a bias. With zero-padding, the denser frequency grid allows for a sample point much closer to the true peak of the sinc lobe, significantly reducing the bias.\n\n- **Case 2 ($f_0 = 40.2$ Hz):** The true frequency is exactly on-bin, since $40.2 = 201 \\times 0.2$. In this ideal scenario, spectral leakage is minimized, and the DFT should peak exactly at bin $k=201$. Both the unpadded and padded estimates are expected to be highly accurate, with near-zero bias.\n\n- **Case 3 ($f_0 = 5.05$ Hz):** Similar to Case $1$, this frequency is off-bin ($5.05$ is not a multiple of $0.2$). It lies between the bins for $5.0$ Hz ($k=25$) and $5.2$ Hz ($k=26$). The unpadded estimate will have a notable bias, which should be substantially reduced by zero-padding.\n\nThis procedure systematically demonstrates that zero-padding is an effective method for improving frequency estimation accuracy in periodograms when the signal frequency does not align with the DFT's native frequency grid. It does not improve spectral *resolution* (the ability to distinguish two closely spaced frequencies), which remains limited by $1/T$, but it improves the precision of locating a single spectral peak.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of estimating sinusoidal frequencies from synthetic LFP data\n    using the periodogram method, with and without zero-padding, and quantifies the bias.\n    \"\"\"\n    \n    # Common parameters for all test cases\n    fs = 1000.0  # Sampling frequency in Hz\n    T = 5.0     # Segment duration in seconds\n    N = int(fs * T)  # Number of samples\n\n    # Test suite as defined in the problem statement\n    test_cases = [\n        {'f0': 40.3, 'A': 1.0, 'f_min': 1.0, 'f_max': 100.0},\n        {'f0': 40.2, 'A': 1.0, 'f_min': 1.0, 'f_max': 100.0},\n        {'f0': 5.05, 'A': 1.0, 'f_min': 1.0, 'f_max': 50.0},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        f0 = case['f0']\n        A = case['A']\n        f_min = case['f_min']\n        f_max = case['f_max']\n\n        # Step 1: Construct the synthetic LFP signal\n        n = np.arange(N)\n        x = A * np.sin(2 * np.pi * f0 * n / fs)\n\n        # --- Analysis without Zero-Padding (z=1) ---\n        M_nopad = N\n        \n        # Compute the DFT and its squared magnitude\n        X_nopad = np.fft.fft(x, n=M_nopad)\n        # We only need the one-sided spectrum (positive frequencies)\n        P_nopad = np.abs(X_nopad[:M_nopad // 2])**2\n        \n        # Create the frequency grid for the one-sided spectrum\n        freq_nopad = np.fft.fftfreq(M_nopad, d=1/fs)[:M_nopad // 2]\n        \n        # Restrict the search to the specified frequency band\n        # np.searchsorted is efficient for finding indices in a sorted array\n        idx_min_nopad = np.searchsorted(freq_nopad, f_min, side='left')\n        idx_max_nopad = np.searchsorted(freq_nopad, f_max, side='right')\n\n        # Find the peak frequency in the restricted band\n        search_range_nopad = P_nopad[idx_min_nopad:idx_max_nopad]\n        peak_idx_local_nopad = np.argmax(search_range_nopad)\n        peak_idx_global_nopad = idx_min_nopad + peak_idx_local_nopad\n        f_hat_nopad = freq_nopad[peak_idx_global_nopad]\n\n        # --- Analysis with Zero-Padding (z=8) ---\n        z_pad_factor = 8\n        M_pad = z_pad_factor * N\n\n        # Compute the DFT using the M_pad length (numpy handles the padding)\n        X_pad = np.fft.fft(x, n=M_pad)\n        # One-sided power spectrum\n        P_pad = np.abs(X_pad[:M_pad // 2])**2\n\n        # Create the denser frequency grid\n        freq_pad = np.fft.fftfreq(M_pad, d=1/fs)[:M_pad // 2]\n\n        # Restrict search to the frequency band\n        idx_min_pad = np.searchsorted(freq_pad, f_min, side='left')\n        idx_max_pad = np.searchsorted(freq_pad, f_max, side='right')\n        \n        # Find the peak frequency in the restricted band\n        search_range_pad = P_pad[idx_min_pad:idx_max_pad]\n        peak_idx_local_pad = np.argmax(search_range_pad)\n        peak_idx_global_pad = idx_min_pad + peak_idx_local_pad\n        f_hat_pad = freq_pad[peak_idx_global_pad]\n        \n        # Step 3: Calculate the biases\n        delta_nopad = f_hat_nopad - f0\n        delta_pad = f_hat_pad - f0\n        \n        # Store results for this case\n        results.append([f_hat_nopad, f_hat_pad, delta_nopad, delta_pad])\n    \n    # Format the final output string exactly as required\n    # map(str, results) converts each inner list like [1.0, 2.0] into its string representation \"'[1.0, 2.0]'\"\n    # which is then joined by commas.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n\n```"
        }
    ]
}