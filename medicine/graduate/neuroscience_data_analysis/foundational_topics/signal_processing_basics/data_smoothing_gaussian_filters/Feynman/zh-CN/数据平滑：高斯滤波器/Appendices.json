{
    "hands_on_practices": [
        {
            "introduction": "在神经科学数据分析中，我们处理的通常是时间上有限的数据段，例如“刺激前后时间直方图”（Peri-Stimulus Time Histogram, PSTH）。在对这类数据应用高斯滤波器时，一个常见的陷阱是在数据窗口的边界处会产生不自然的失真或“边缘伪影”。本练习旨在通过量化分析几种常见的“数据填充”（padding）策略——即对观测窗口之外的数据做出不同假设——来揭示这些伪影的来源和大小，这对于任何严谨的数据处理流程都是至关重要的一步。",
            "id": "4153097",
            "problem": "神经科学数据分析中的一个常见操作是使用高斯滤波器平滑刺激周边时间直方图（Peri-Stimulus Time Histogram, PSTH），以估计时变发放率。考虑一个连续时间PSTH，其模型为在刺激开始时发生阶跃变化，在时间 $t < 0$ 时基线发放率为 $B \\ge 0$，在时间 $t \\ge 0$ 时阶跃至 $B + A$，其中 $A > 0$ 是阶跃幅度。令高斯滤波器核为 $g_{\\sigma}(t) = \\frac{1}{\\sigma \\sqrt{2 \\pi}} \\exp\\!\\left(-\\frac{t^{2}}{2 \\sigma^{2}}\\right)$，其中标准差 $\\sigma > 0$，并将信号 $x(t)$ 的高斯平滑定义为卷积 $(x * g_{\\sigma})(t) = \\int_{-\\infty}^{\\infty} g_{\\sigma}(\\tau)\\, x(t - \\tau)\\, d\\tau$。理想的完整数据平滑输出为 $y^{\\star}(t) = (x_{\\star} * g_{\\sigma})(t)$，其中完整数据信号 $x_{\\star}(t)$ 定义为：当 $t < 0$ 时 $x_{\\star}(t) = B$，当 $t \\ge 0$ 时 $x_{\\star}(t) = B + A$。\n\n在实践中，由于只有 $t \\ge 0$ 的数据可用，因此在 $t = 0$ 的刺激开始边界附近进行平滑需要一种填充方案。定义三种填充方案，将仅在 $t \\ge 0$ 上已知的观测信号 $x(t)$ 扩展为对所有 $t \\in \\mathbb{R}$ 的填充信号 $\\tilde{x}(t)$：\n- 零填充 (Zero padding)：当 $t \\ge 0$ 时 $\\tilde{x}(t) = x(t)$，当 $t < 0$ 时 $\\tilde{x}(t) = 0$。\n- 反射填充 (Reflection padding)：当 $t \\ge 0$ 时 $\\tilde{x}(t) = x(t)$，当 $t < 0$ 时 $\\tilde{x}(t) = x(|t|)$。\n- 常数扩展填充 (Constant extension padding)：当 $t \\ge 0$ 时 $\\tilde{x}(t) = x(t)$，当 $t < 0$ 时 $\\tilde{x}(t) = x(0)$。\n\n对于每种填充方案，从卷积定义和高斯核的性质出发，推导出在时间 $t \\ge 0$ 时的平滑输出 $\\tilde{y}(t) = (\\tilde{x} * g_{\\sigma})(t)$。然后，将每种方案的边缘伪影幅度 $M$ 定义为在非负时间内，填充平滑输出与理想完整数据平滑输出之间的最大绝对偏差，\n$$\nM \\equiv \\sup_{t \\ge 0} \\left| \\tilde{y}(t) - y^{\\star}(t) \\right|.\n$$\n通过报告上述指定顺序（零填充、反射填充、常数扩展填充）的三种方案的 $M/A$，将最终结果表示为阶跃幅度的无量纲分数。将这三个值以单行矩阵的形式提供。无需四舍五入。",
            "solution": "该问题具有科学依据，提法明确且客观。所有术语和条件都经过了形式化定义，可以进行严格的数学求解。因此，该问题被认为是有效的。\n\n解决方案要求计算三种不同填充方案的平滑输出，并将每种方案与理想平滑输出进行比较。问题的核心在于计算与高斯核的卷积积分。\n\n首先，我们建立必要的定义并计算理想平滑输出，它作为一个共同的参考。代表发放率阶跃变化的理想信号由下式给出\n$$\nx_{\\star}(t) = \\begin{cases} B,  t  0 \\\\ B+A,  t \\ge 0 \\end{cases}\n$$\n这可以使用Heaviside阶跃函数 $H(t)$（其中当 $t \\ge 0$ 时 $H(t)=1$，当 $t  0$ 时 $H(t)=0$）表示为 $x_{\\star}(t) = B + A H(t)$。\n\n高斯滤波器核为 $g_{\\sigma}(t) = \\frac{1}{\\sigma \\sqrt{2 \\pi}} \\exp\\left(-\\frac{t^{2}}{2 \\sigma^{2}}\\right)$。该核的积分是卷积运算的核心。令 $\\Phi(u)$ 为标准正态分布 $N(0, 1)$ 的累积分布函数 (CDF)：\n$$\n\\Phi(u) = \\int_{-\\infty}^{u} \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{v^2}{2}\\right) dv\n$$\n通过变量代换 $v = \\tau/\\sigma$，我们可以证明所指定高斯核的积分与 $\\Phi(u)$ 相关：\n$$\n\\int_{-\\infty}^{t} g_{\\sigma}(\\tau) d\\tau = \\int_{-\\infty}^{t/\\sigma} \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{v^2}{2}\\right) dv = \\Phi\\left(\\frac{t}{\\sigma}\\right)\n$$\n$\\Phi(u)$ 的一个关键性质是 $\\Phi(0) = 1/2$。\n\n理想平滑输出 $y^{\\star}(t)$ 是卷积 $(x_{\\star} * g_{\\sigma})(t)$：\n$$\ny^{\\star}(t) = \\int_{-\\infty}^{\\infty} g_{\\sigma}(\\tau) x_{\\star}(t - \\tau) d\\tau\n$$\n根据卷积的线性性质，$y^{\\star}(t) = ((B + A H) * g_{\\sigma})(t) = (B * g_{\\sigma})(t) + (A H * g_{\\sigma})(t)$。\n常数 $B$ 与归一化核 $g_{\\sigma}$ 的卷积就是 $B$。缩放后的Heaviside函数 $A H(t)$ 的卷积是：\n$$\n(A H * g_{\\sigma})(t) = A \\int_{-\\infty}^{\\infty} g_{\\sigma}(\\tau) H(t - \\tau) d\\tau = A \\int_{-\\infty}^{t} g_{\\sigma}(\\tau) d\\tau = A \\Phi\\left(\\frac{t}{\\sigma}\\right)\n$$\n因此，理想平滑输出为：\n$$\ny^{\\star}(t) = B + A \\Phi\\left(\\frac{t}{\\sigma}\\right)\n$$\n\n现在我们针对观测信号 $x(t) = B+A$（对于 $t \\ge 0$）分析每种填充方案。\n\n**1. 零填充**\n填充信号 $\\tilde{x}_{zero}(t)$ 定义为当 $t \\ge 0$ 时 $\\tilde{x}_{zero}(t) = x(t)$，当 $t  0$ 时 $\\tilde{x}_{zero}(t) = 0$。这可以写成 $\\tilde{x}_{zero}(t) = (B+A)H(t)$。\n平滑输出 $\\tilde{y}_{zero}(t)$ 为：\n$$\n\\tilde{y}_{zero}(t) = (\\tilde{x}_{zero} * g_{\\sigma})(t) = ((B+A)H * g_{\\sigma})(t) = (B+A) \\Phi\\left(\\frac{t}{\\sigma}\\right)\n$$\n当 $t \\ge 0$ 时，与理想输出的偏差为：\n$$\nD_{zero}(t) = \\tilde{y}_{zero}(t) - y^{\\star}(t) = (B+A) \\Phi\\left(\\frac{t}{\\sigma}\\right) - \\left(B + A \\Phi\\left(\\frac{t}{\\sigma}\\right)\\right) = B \\Phi\\left(\\frac{t}{\\sigma}\\right) - B = B\\left(\\Phi\\left(\\frac{t}{\\sigma}\\right) - 1\\right)\n$$\n边缘伪影幅度 $M_{zero}$ 是当 $t \\ge 0$ 时绝对偏差的上确界：\n$$\nM_{zero} = \\sup_{t \\ge 0} \\left| B\\left(\\Phi\\left(\\frac{t}{\\sigma}\\right) - 1\\right) \\right|\n$$\n由于 $B \\ge 0$ 且 $\\Phi(u) \\le 1$，绝对值内的表达式为非正。因此：\n$$\nM_{zero} = \\sup_{t \\ge 0} -B\\left(\\Phi\\left(\\frac{t}{\\sigma}\\right) - 1\\right) = \\sup_{t \\ge 0} B\\left(1 - \\Phi\\left(\\frac{t}{\\sigma}\\right)\\right)\n$$\n对于 $t \\ge 0$，函数 $\\Phi(t/\\sigma)$ 是单调递增的，从 $\\Phi(0)=1/2$ 开始。因此，$1 - \\Phi(t/\\sigma)$ 是单调递减的。上确界出现在定义域的下界 $t=0$ 处：\n$$\nM_{zero} = B\\left(1 - \\Phi(0)\\right) = B\\left(1 - \\frac{1}{2}\\right) = \\frac{B}{2}\n$$\n所需的无量纲分数为 $M_{zero}/A = \\frac{B}{2A}$。\n\n**2. 反射填充**\n填充信号 $\\tilde{x}_{refl}(t)$ 定义为当 $t \\ge 0$ 时 $\\tilde{x}_{refl}(t) = x(t)$，当 $t  0$ 时 $\\tilde{x}_{refl}(t) = x(|t|)$。\n给定当 $t \\ge 0$ 时 $x(t) = B+A$，我们有：\n- 当 $t \\ge 0$ 时，$\\tilde{x}_{refl}(t) = B+A$。\n- 当 $t  0$ 时， $|t| > 0$，所以 $\\tilde{x}_{refl}(t) = x(|t|) = B+A$。\n因此，对于所有 $t \\in \\mathbb{R}$，$\\tilde{x}_{refl}(t) = B+A$。\n平滑输出 $\\tilde{y}_{refl}(t)$ 是一个常数与 $g_{\\sigma}(t)$ 的卷积：\n$$\n\\tilde{y}_{refl}(t) = \\int_{-\\infty}^{\\infty} g_{\\sigma}(\\tau) (B+A) d\\tau = (B+A) \\int_{-\\infty}^{\\infty} g_{\\sigma}(\\tau) d\\tau = B+A\n$$\n当 $t \\ge 0$ 时，与理想输出的偏差为：\n$$\nD_{refl}(t) = \\tilde{y}_{refl}(t) - y^{\\star}(t) = (B+A) - \\left(B + A \\Phi\\left(\\frac{t}{\\sigma}\\right)\\right) = A - A \\Phi\\left(\\frac{t}{\\sigma}\\right) = A\\left(1 - \\Phi\\left(\\frac{t}{\\sigma}\\right)\\right)\n$$\n边缘伪影幅度 $M_{refl}$ 是：\n$$\nM_{refl} = \\sup_{t \\ge 0} \\left| A\\left(1 - \\Phi\\left(\\frac{t}{\\sigma}\\right)\\right) \\right|\n$$\n由于 $A > 0$ 且对于 $u \\ge 0$ 有 $1 - \\Phi(u) \\ge 0$，因此绝对值是多余的。待最大化的函数对于 $t \\ge 0$ 是单调递减的，因此上确界在 $t=0$ 处取得：\n$$\nM_{refl} = A\\left(1 - \\Phi(0)\\right) = A\\left(1 - \\frac{1}{2}\\right) = \\frac{A}{2}\n$$\n所需的无量纲分数为 $M_{refl}/A = \\frac{1}{2}$。\n\n**3. 常数扩展填充**\n填充信号 $\\tilde{x}_{const}(t)$ 定义为当 $t \\ge 0$ 时 $\\tilde{x}_{const}(t) = x(t)$，当 $t  0$ 时 $\\tilde{x}_{const}(t) = x(0)$。\n给定当 $t \\ge 0$ 时 $x(t) = B+A$，我们有 $x(0)=B+A$。因此：\n- 当 $t \\ge 0$ 时，$\\tilde{x}_{const}(t) = B+A$。\n- 当 $t  0$ 时，$\\tilde{x}_{const}(t) = x(0) = B+A$。\n这得出对于所有 $t \\in \\mathbb{R}$，$\\tilde{x}_{const}(t) = B+A$，这与本特定问题中反射填充情况下的填充信号相同。\n因此，所有后续计算都与反射填充情况相同。\n$$\n\\tilde{y}_{const}(t) = B+A\n$$\n$$\nM_{const} = \\frac{A}{2}\n$$\n所需的无量纲分数为 $M_{const}/A = \\frac{1}{2}$。\n\n按指定顺序（零填充、反射填充、常数扩展填充）的三个无量纲伪影幅度 $M/A$ 分别是 $\\frac{B}{2A}$、$\\frac{1}{2}$ 和 $\\frac{1}{2}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{B}{2A}  \\frac{1}{2}  \\frac{1}{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "高斯平滑的核心价值在于抑制噪声，但这是一个有代价的权衡。平滑在抹去噪声的同时，也必然会模糊信号本身的快速变化特征，从而可能影响我们对关键事件时间点的精确判断。本练习将引导你从理论上量化这一权衡，通过推导平滑处理如何具体地增加一个理想化的突触事件起始时间估计的方差，从而让你深刻理解滤波器带宽 $\\sigma$ 与时间精度之间的数学关系。",
            "id": "4153041",
            "problem": "在电压钳记录中，单次试验的突触起始在连续时间上被建模为一个受到加性噪声干扰的确定性基线到阶跃的转变。设潜在的无噪声信号为 $s(t) = A \\, H(t - \\tau)$，其中 $A  0$ 是幅度，$\\tau$ 是真实起始时间，$H(\\cdot)$ 是赫维赛德阶跃函数。测量信号为 $x(t) = s(t) + n(t)$，其中 $n(t)$ 是一个零均值、广义平稳高斯过程，其双边功率谱密度 (PSD) 为 $S_{n}(\\omega) = N_{0}/2$，其中 $N_{0}  0$ 为常数。\n\n在进行起始时间估计以及对不同条件下起始时间的差异进行下游假设检验之前，数据通过与高斯核进行卷积来平滑\n$$\ng_{\\sigma}(t) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\frac{t^{2}}{2\\sigma^{2}}\\right),\n$$\n其中 $\\sigma  0$ 是高斯滤波器的时间标准差。将平滑信号定义为 $y(t) = (g_{\\sigma} * x)(t)$。起始时间估计器 $\\hat{\\tau}$ 被定义为随 t 递增的阈值交叉方程 $y(t) = A/2$ 的唯一解。\n\n假设在小噪声、一阶线性化机制下，阈值交叉发生在 $t = \\tau$ 附近，并且可以通过对无噪声交叉点进行扰动来分析。从卷积的基本定义、高斯函数的傅里叶变换，以及滤波后平稳高斯过程的功率谱密度与方差之间的关系出发，推导在这些假设下近似方差 $\\mathrm{Var}(\\hat{\\tau})$ 作为 $A$、$\\sigma$ 和 $N_{0}$ 的函数的闭式解析表达式。请将最终方差以 $\\mathrm{s}^{2}$ 为单位表示。不需要进行数值近似，并且您的最终表达式必须是闭式的。",
            "solution": "该问题陈述经评估是有效的，因为它具有科学依据、提法明确、客观、内容自洽，并且没有任何指出的缺陷。该问题描述了信号处理和估计理论中的一个标准任务。我们可以开始求解。\n\n测量信号由 $x(t) = s(t) + n(t)$ 给出，其中 $s(t) = A \\, H(t - \\tau)$ 是确定性信号，$n(t)$ 是一个零均值、广义平稳 (WSS) 高斯噪声过程，其双边功率谱密度 (PSD) 为 $S_{n}(\\omega) = N_{0}/2$。\n\n信号通过与高斯核 $g_{\\sigma}(t) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp(-t^{2}/(2\\sigma^{2}))$ 进行卷积来平滑。平滑后的信号为 $y(t) = (g_{\\sigma} * x)(t)$。根据卷积的线性性质，我们可以将 $y(t)$ 写成一个平滑信号分量和一个平滑噪声分量之和：\n$$y(t) = (g_{\\sigma} * s)(t) + (g_{\\sigma} * n)(t) = y_s(t) + y_n(t)$$\n\n首先，我们分析平滑的无噪声信号 $y_s(t)$：\n$$y_s(t) = (g_{\\sigma} * s)(t) = \\int_{-\\infty}^{\\infty} g_{\\sigma}(u) s(t-u) du = \\int_{-\\infty}^{\\infty} g_{\\sigma}(u) A H(t - u - \\tau) du$$\n赫维赛德函数 $H(t - u - \\tau)$ 在 $u  t-\\tau$ 时等于 $1$，否则等于 $0$。积分变为：\n$$y_s(t) = A \\int_{-\\infty}^{t-\\tau} g_{\\sigma}(u) du = A \\int_{-\\infty}^{t-\\tau} \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\left(-\\frac{u^2}{2\\sigma^2}\\right) du$$\n该积分代表了均值为 $0$、标准差为 $\\sigma$ 的高斯随机变量的累积分布函数 (CDF)。设 $\\Phi(z)$ 为标准正态分布 $N(0,1)$ 的累积分布函数。那么 $y_s(t)$可以表示为：\n$$y_s(t) = A \\, \\Phi\\left(\\frac{t-\\tau}{\\sigma}\\right)$$\n\n在没有噪声的情况下，阈值交叉会发生在一个时间 $t_{cross}$ 处，使得 $y_s(t_{cross}) = A/2$。\n$$A \\, \\Phi\\left(\\frac{t_{cross}-\\tau}{\\sigma}\\right) = \\frac{A}{2} \\implies \\Phi\\left(\\frac{t_{cross}-\\tau}{\\sigma}\\right) = \\frac{1}{2}$$\n由于 $\\Phi(0) = 1/2$，这意味着 $\\frac{t_{cross}-\\tau}{\\sigma} = 0$，从而得到 $t_{cross} = \\tau$。因此，无噪声的平滑信号在真实起始时间穿过阈值。\n\n起始时间估计器 $\\hat{\\tau}$ 由方程 $y(\\hat{\\tau}) = A/2$ 定义，使用我们的分解，该方程为：\n$$y_s(\\hat{\\tau}) + y_n(\\hat{\\tau}) = \\frac{A}{2}$$\n我们已知可以在真实起始时间 $\\tau$ 附近使用一阶线性化。我们假设估计的起始时间 $\\hat{\\tau}$ 接近 $\\tau$，因此我们可以在 $t=\\tau$ 附近对 $y_s(\\hat{\\tau})$ 进行泰勒展开：\n$$y_s(\\hat{\\tau}) \\approx y_s(\\tau) + y_s'(\\tau) (\\hat{\\tau}-\\tau)$$\n将此代入阈值方程得到：\n$$y_s(\\tau) + y_s'(\\tau) (\\hat{\\tau}-\\tau) + y_n(\\hat{\\tau}) \\approx \\frac{A}{2}$$\n我们知道 $y_s(\\tau) = A \\Phi(0) = A/2$。在小噪声机制下，$\\hat{\\tau} \\approx \\tau$，所以我们可以近似 $y_n(\\hat{\\tau}) \\approx y_n(\\tau)$。该方程简化为：\n$$\\frac{A}{2} + y_s'(\\tau) (\\hat{\\tau}-\\tau) + y_n(\\tau) \\approx \\frac{A}{2}$$\n$$y_s'(\\tau) (\\hat{\\tau}-\\tau) \\approx -y_n(\\tau)$$\n因此，估计误差 $\\delta\\tau = \\hat{\\tau}-\\tau$ 近似为：\n$$\\delta\\tau \\approx -\\frac{y_n(\\tau)}{y_s'(\\tau)}$$\n估计器 $\\hat{\\tau}$ 的方差 $\\mathrm{Var}(\\hat{\\tau})$ 可以用这个误差项的方差来近似。由于 $\\tau$ 和 $y_s'(\\tau)$ 是确定性的非随机量：\n$$\\mathrm{Var}(\\hat{\\tau}) = \\mathrm{Var}(\\delta\\tau) \\approx \\mathrm{Var}\\left(-\\frac{y_n(\\tau)}{y_s'(\\tau)}\\right) = \\frac{\\mathrm{Var}(y_n(\\tau))}{(y_s'(\\tau))^2}$$\n\n我们现在需要计算这个表达式中的两项：$y_s'(\\tau)$ 和 $\\mathrm{Var}(y_n(\\tau))$。\n\n首先，是平滑信号的导数 $y_s'(t)$。利用微分与卷积可交换的性质 $(f*g)' = f*g'$，我们有：\n$$y_s'(t) = (g_\\sigma * s)'(t) = (g_\\sigma * s')(t)$$\n信号 $s(t) = A H(t-\\tau)$ 的导数是 $s'(t) = A \\delta(t-\\tau)$，其中 $\\delta(\\cdot)$ 是狄拉克δ函数。\n$$y_s'(t) = \\int_{-\\infty}^{\\infty} g_{\\sigma}(t-u) A \\delta(u-\\tau) du = A g_{\\sigma}(t-\\tau)$$\n在 $t=\\tau$ 处求值：\n$$y_s'(\\tau) = A g_{\\sigma}(0) = A \\left(\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp(0)\\right) = \\frac{A}{\\sqrt{2\\pi}\\sigma}$$\n\n其次，是平滑噪声的方差 $\\mathrm{Var}(y_n(\\tau))$。过程 $y_n(t)$ 是一个脉冲响应为 $g_\\sigma(t)$、输入为广义平稳过程 $n(t)$ 的线性时不变 (LTI) 系统的输出。输出过程 $y_n(t)$ 也是广义平稳的，因此其方差不随时间变化。一个零均值广义平稳过程的方差等于其总功率，即其功率谱密度 (PSD) 在所有角频率 $\\omega$ 上的积分除以 $2\\pi$。输出功率谱密度 $S_{y_n}(\\omega)$ 与输入功率谱密度 $S_n(\\omega)$ 的关系如下：\n$$S_{y_n}(\\omega) = |G_{\\sigma}(\\omega)|^2 S_{n}(\\omega)$$\n其中 $G_{\\sigma}(\\omega)$ 是滤波器 $g_{\\sigma}(t)$ 的傅里叶变换。一个归一化高斯函数的傅里叶变换是另一个高斯函数：\n$$G_{\\sigma}(\\omega) = \\mathcal{F}\\{g_{\\sigma}(t)\\} = \\mathcal{F}\\left\\{\\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{t^2}{2\\sigma^2}\\right)\\right\\} = \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)$$\n给定的输入噪声功率谱密度为 $S_n(\\omega) = N_0/2$。因此，输出功率谱密度为：\n$$S_{y_n}(\\omega) = \\left|\\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)\\right|^2 \\frac{N_0}{2} = \\exp(-\\omega^2\\sigma^2) \\frac{N_0}{2}$$\n平滑噪声的方差为：\n$$\\mathrm{Var}(y_n) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} S_{y_n}(\\omega) d\\omega = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} \\frac{N_0}{2} \\exp(-\\omega^2\\sigma^2) d\\omega = \\frac{N_0}{4\\pi} \\int_{-\\infty}^{\\infty} \\exp(-\\sigma^2\\omega^2) d\\omega$$\n这是一个形式为 $\\int_{-\\infty}^{\\infty} \\exp(-ax^2)dx = \\sqrt{\\pi/a}$ 的标准高斯积分。此处，$a=\\sigma^2$。\n$$\\int_{-\\infty}^{\\infty} \\exp(-\\sigma^2\\omega^2) d\\omega = \\sqrt{\\frac{\\pi}{\\sigma^2}} = \\frac{\\sqrt{\\pi}}{\\sigma}$$\n将此结果代回方差表达式：\n$$\\mathrm{Var}(y_n) = \\frac{N_0}{4\\pi} \\left(\\frac{\\sqrt{\\pi}}{\\sigma}\\right) = \\frac{N_0}{4\\sqrt{\\pi}\\sigma}$$\n\n最后，我们将 $y_s'(\\tau)$ 和 $\\mathrm{Var}(y_n)$ 的表达式代入 $\\mathrm{Var}(\\hat{\\tau})$ 的公式中：\n$$\\mathrm{Var}(\\hat{\\tau}) \\approx \\frac{\\mathrm{Var}(y_n)}{(y_s'(\\tau))^2} = \\frac{\\frac{N_0}{4\\sqrt{\\pi}\\sigma}}{\\left(\\frac{A}{\\sqrt{2\\pi}\\sigma}\\right)^2} = \\frac{N_0}{4\\sqrt{\\pi}\\sigma} \\cdot \\frac{(\\sqrt{2\\pi}\\sigma)^2}{A^2}$$\n$$\\mathrm{Var}(\\hat{\\tau}) \\approx \\frac{N_0}{4\\sqrt{\\pi}\\sigma} \\cdot \\frac{2\\pi\\sigma^2}{A^2} = \\frac{2\\pi N_0 \\sigma^2}{4\\sqrt{\\pi} \\sigma A^2} = \\frac{\\pi N_0 \\sigma}{2\\sqrt{\\pi} A^2} = \\frac{\\sqrt{\\pi} N_0 \\sigma}{2 A^2}$$\n$A$ 的单位是伏特 (V)，$\\sigma$ 的单位是秒 (s)，$N_0$ 的单位是 $V^2 \\cdot s$。因此，方差的单位是 $(V^2 \\cdot s) \\cdot s / V^2 = s^2$，符合要求。",
            "answer": "$$ \\boxed{\\frac{\\sqrt{\\pi} N_0 \\sigma}{2 A^2}} $$"
        },
        {
            "introduction": "掌握了平滑的优势与代价后，最关键的实践问题便是：如何选择最佳的平滑带宽 $\\sigma$？一个过小的 $\\sigma$ 会导致噪声残留，而一个过大的 $\\sigma$ 则会过度模糊信号的真实动态。本练习将指导你完成一个完整的解决方案，从第一性原理出发，推导并实现一种基于“留一法交叉验证”（Leave-One-Out Cross-Validation, LOOCV）的客观函数，用以从真实脉冲数据中自动选择最优的 $\\sigma$ 值。",
            "id": "4153064",
            "problem": "神经科学数据分析中的一个基本任务是根据事件时间估计瞬时脉冲发放率，并为高斯滤波器选择一个合适的平滑带宽。考虑一个脉冲序列，表示为狄拉克δ函数之和，$x(t) = \\sum_{i=1}^{N} \\delta(t - t_i)$，在以秒为单位的有限记录窗口 $[0,T]$ 内观测得到。假设脉冲产生于一个非齐次泊松过程，其速率函数为 $\\lambda(t)$，观测事件的似然由标准的非齐次泊松公式给出：似然为 $\\mathcal{L}(\\lambda) = \\exp\\left(-\\int_{0}^{T} \\lambda(t) \\, dt\\right) \\prod_{i=1}^{N} \\lambda(t_i)$。我们通过使用标准差为 $\\sigma$（单位为秒）的高斯滤波器对脉冲序列进行平滑来估计发放率，其核函数为 $K_\\sigma(t) = \\dfrac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\left(-\\dfrac{t^2}{2\\sigma^2}\\right)$，从而得到一个估计量 $\\hat{\\lambda}_\\sigma(t) = \\sum_{i=1}^{N} K_\\sigma(t - t_i)$。\n\n你的任务是：\n- 从第一性原理和上述似然函数出发，推导出一个用于带宽选择的交叉验证目标函数（作为 $\\sigma$ 的函数），该函数消除了每个脉冲对自身的自我影响。使用留一法交叉验证（LOOCV）定义一个基于对数似然的目标，其中在 $t_i$ 处对 $\\hat{\\lambda}_\\sigma$ 的评估排除了来自 $t_i$ 处脉冲的贡献。记录窗口是有限的，因此不要假设积分是在整个实数轴上进行的；确保你的推导考虑了 $t=0$ 和 $t=T$ 处的边界。\n- 实现这个目标函数，并通过在候选值的固定网格上最大化该目标来选择 $\\sigma$。\n\n单位：所有时间，包括脉冲时间 $t_i$、记录窗口长度 $T$ 和高斯带宽 $\\sigma$，都必须以秒为单位处理。你的程序必须报告每个选定的带宽（单位为秒），并四舍五入到六位小数。\n\n测试套件：\n对于以下四个测试用例，计算并返回带宽 $\\sigma$（单位为秒），该带宽在候选网格 $\\mathcal{S} = [\\,0.002,\\,0.005,\\,0.010,\\,0.020,\\,0.050,\\,0.100,\\,0.200,\\,0.300\\,]$（秒）上最大化你推导的LOOCV对数似然目标。每个用例指定了 $T$（秒）和脉冲时间 $\\{t_i\\}$（秒）。\n1. 理想情况（脉冲间隔大致均匀）：$T = 1.0$，脉冲 $t_i = \\dfrac{i + 0.5}{50}$，其中 $i \\in \\{0,1,\\dots,49\\}$。\n2. 爆发加背景：$T = 1.0$，脉冲由一个爆发集和一个背景集的并集定义。爆发集：$t_i^{\\text{burst}} = 0.5 + 0.0005\\,(i-10)$，其中 $i \\in \\{0,1,\\dots,19\\}$。背景集：$t_j^{\\text{bg}} = \\dfrac{j + 0.5}{10}$，其中 $j \\in \\{0,1,\\dots,9\\}$。\n3. 稀疏：$T = 1.0$，脉冲位于 $\\{0.1,\\,0.5,\\,0.9\\}$。\n4. 两个相近的脉冲：$T = 1.0$，脉冲位于 $\\{0.5,\\,0.505\\}$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含四个测试用例选定的带宽（单位为秒），格式为用方括号括起来的逗号分隔列表，并四舍五入到六位小数（例如：\"[0.020000,0.015000,0.100000,0.005000]\"）。",
            "solution": "任务是推导一个交叉验证目标函数，用于为神经脉冲序列的高斯核平滑选择最优带宽 $\\sigma$，然后实现该方法，从给定的候选网格中为几个测试用例找到最优的 $\\sigma$。该脉冲序列被建模为非齐次泊松过程的一个实现。\n\n我们方法的基础是，在给定观测到的脉冲时间 $\\{t_1, t_2, \\dots, t_N\\}$ 的情况下，一个速率函数为 $\\lambda(t)$ 的非齐次泊松过程在时间区间 $[0, T]$ 上的对数似然函数：\n$$ \\log \\mathcal{L}(\\lambda) = \\sum_{i=1}^{N} \\log \\lambda(t_i) - \\int_{0}^{T} \\lambda(t) \\, dt $$\n速率函数 $\\lambda(t)$ 是未知的，我们通过将脉冲序列（表示为狄拉克δ函数之和 $x(t) = \\sum_{i=1}^{N} \\delta(t - t_i)$）与高斯核函数 $K_\\sigma(t)$ 进行卷积来从数据中估计它。这产生了速率估计：\n$$ \\hat{\\lambda}_\\sigma(t) = \\sum_{j=1}^{N} K_\\sigma(t - t_j) = \\sum_{j=1}^{N} \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\left(-\\frac{(t - t_j)^2}{2\\sigma^2}\\right) $$\n一个朴素的方法是直接将 $\\hat{\\lambda}_\\sigma(t)$ 代入对数似然函数，并对 $\\sigma$ 进行最大化。这种方法会失败，因为 $\\sum_{i=1}^{N} \\log \\hat{\\lambda}_\\sigma(t_i)$ 项存在一个病态问题。当在脉冲时间 $t_i$ 处评估速率时，用于计算 $\\hat{\\lambda}_\\sigma(t_i)$ 的和中包含了 $K_\\sigma(t_i - t_i) = K_\\sigma(0)$ 这一项。高斯核函数在其中心点的值 $K_\\sigma(0) = 1/(\\sqrt{2\\pi}\\sigma)$，在 $\\sigma \\to 0$ 时会发散到无穷大。这种“自我影响”将导致对数似然在 $\\sigma$ 无穷小时变得任意大，从而选择 $\\sigma=0$，这对应于一个完全过拟合的模型（一系列δ函数），并非一个有用的速率估计。\n\n为规避此问题，我们采用留一法交叉验证（LOOCV）。LOOCV的核心原则是在未用于训练的数据上评估模型的预测能力。对于每个脉冲 $t_i$，我们使用所有其他脉冲 $\\{t_j\\}_{j \\neq i}$ 来构建一个速率估计。这个留一法估计量是：\n$$ \\hat{\\lambda}_{\\sigma, (-i)}(t) = \\sum_{j=1, j\\neq i}^{N} K_\\sigma(t - t_j) $$\n然后，我们使用这个部分估计来评估被留出的脉冲 $t_i$ 的对数似然。我们所表示的交叉验证目标函数 $J(\\sigma)$ 是通过对每个留出脉冲的对数似然贡献求和，并减去一个对应于完整速率估计积分的惩罚项来构建的。该惩罚项考虑了估计速率函数的整体复杂度和幅度。因此，需要最大化的目标函数是：\n$$ J(\\sigma) = \\sum_{i=1}^{N} \\log \\left( \\hat{\\lambda}_{\\sigma, (-i)}(t_i) \\right) - \\int_{0}^{T} \\hat{\\lambda}_\\sigma(t) \\, dt $$\n现在我们来推导每一项的显式形式。\n\n第一项是对数预测概率之和，它量化了模型基于其他脉冲预测每个脉冲位置的能力：\n$$ \\text{Term 1} = \\sum_{i=1}^{N} \\log \\left( \\sum_{j=1, j\\neq i}^{N} K_\\sigma(t_i - t_j) \\right) = \\sum_{i=1}^{N} \\log \\left( \\sum_{j=1, j\\neq i}^{N} \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\left(-\\frac{(t_i - t_j)^2}{2\\sigma^2}\\right) \\right) $$\n当 $\\sigma \\to 0$ 时，该项是良态的。如果 $\\sigma$ 非常小，对数的参数将变成来自最近邻的速率贡献，从而避免了由自我贡献引起的发散。\n\n第二项是惩罚项，即完整速率估计在记录窗口 $[0, T]$ 上的积分。该项必须考虑积分的有限边界。\n$$ \\text{Term 2} = \\int_{0}^{T} \\hat{\\lambda}_\\sigma(t) \\, dt = \\int_{0}^{T} \\sum_{j=1}^{N} K_\\sigma(t - t_j) \\, dt = \\sum_{j=1}^{N} \\int_{0}^{T} K_\\sigma(t - t_j) \\, dt $$\n对于每个单独的脉冲 $j$，积分为：\n$$ \\int_{0}^{T} \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\left(-\\frac{(t - t_j)^2}{2\\sigma^2}\\right) dt $$\n我们进行变量替换，令 $u = \\frac{t - t_j}{\\sigma}$，这意味着 $dt = \\sigma \\, du$。积分上下限从 $t=0$ 和 $t=T$ 分别变为 $u = \\frac{0 - t_j}{\\sigma} = -\\frac{t_j}{\\sigma}$ 和 $u = \\frac{T - t_j}{\\sigma}$。积分变为：\n$$ \\int_{-t_j/\\sigma}^{(T-t_j)/\\sigma} \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{u^2}{2}\\right) du $$\n该积分是标准正态分布 $N(0, 1)$ 在区间 $[ -t_j/\\sigma, (T-t_j)/\\sigma ]$ 上的概率质量。它可以用标准正态分布的累积分布函数 (CDF) $\\Phi(z) = \\int_{-\\infty}^{z} \\frac{1}{\\sqrt{2\\pi}} e^{-v^2/2} dv$ 来表示：\n$$ \\int_{0}^{T} K_\\sigma(t - t_j) \\, dt = \\Phi\\left(\\frac{T-t_j}{\\sigma}\\right) - \\Phi\\left(-\\frac{t_j}{\\sigma}\\right) $$\n对所有脉冲 $j$ 求和，得到完整的惩罚项：\n$$ \\text{Term 2} = \\sum_{j=1}^{N} \\left[ \\Phi\\left(\\frac{T-t_j}{\\sigma}\\right) - \\Phi\\left(-\\frac{t_j}{\\sigma}\\right) \\right] $$\n这个经过边界校正的项妥善处理了以记录窗口边缘附近的点为中心的核函数所带来的概率质量损失。在数值实现中，CDF $\\Phi(z)$ 是通过误差函数 $\\text{erf}(x)$，利用关系式 $\\Phi(z) = \\frac{1}{2}\\left(1 + \\text{erf}\\left(\\frac{z}{\\sqrt{2}}\\right)\\right)$ 来计算的。\n\n结合这两项，需要在候选带宽网格 $\\mathcal{S}$ 上最大化的最终LOOCV目标函数是：\n$$ J(\\sigma) = \\sum_{i=1}^{N} \\log \\left( \\sum_{j \\neq i} \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\left(-\\frac{(t_i - t_j)^2}{2\\sigma^2}\\right) \\right) - \\sum_{j=1}^{N} \\left[ \\Phi\\left(\\frac{T-t_j}{\\sigma}\\right) - \\Phi\\left(-\\frac{t_j}{\\sigma}\\right) \\right] $$\n该实现将为每个 $\\sigma \\in \\mathcal{S}$ 计算 $J(\\sigma)$，并选择产生最大值的那个。为了提高效率，我们使用了向量化计算，特别是在计算第一项中的成对相互作用时。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import erf\n\ndef solve():\n    \"\"\"\n    Derives and applies a LOOCV objective to select Gaussian filter bandwidths for spike trains.\n    \"\"\"\n\n    def norm_cdf(x):\n        \"\"\"\n        Calculates the cumulative distribution function (CDF) of the standard normal distribution.\n        Uses the error function (erf) for computation.\n        Φ(z) = 0.5 * (1 + erf(z / sqrt(2)))\n        \"\"\"\n        return 0.5 * (1.0 + erf(x / np.sqrt(2.0)))\n\n    def calculate_loocv_objective(sigma, spikes, T):\n        \"\"\"\n        Calculates the Leave-One-Out Cross-Validation log-likelihood objective J(sigma).\n        \n        Args:\n            sigma (float): The bandwidth (standard deviation) of the Gaussian kernel.\n            spikes (np.ndarray): An array of spike times.\n            T (float): The total recording time.\n        \n        Returns:\n            float: The value of the objective function J(sigma).\n        \"\"\"\n        N = len(spikes)\n        # For N = 1, the sum over j!=i is empty, log(0) - -inf.\n        # This is a sensible result as bandwidth selection is ill-defined.\n        if N == 1:\n            return -np.inf\n        # sigma must be positive.\n        if sigma == 0:\n            return -np.inf\n\n        # Term 1: Sum of log-likelihoods of left-out spikes\n        # spikes[:, np.newaxis] creates a column vector for broadcasting.\n        dists_sq = (spikes[:, np.newaxis] - spikes)**2\n        \n        # Evaluate the exponential part of the kernel for all pairs.\n        exp_terms = np.exp(-dists_sq / (2.0 * sigma**2))\n        \n        # Exclude self-influence by setting diagonal (i=j) terms to zero.\n        np.fill_diagonal(exp_terms, 0.0)\n        \n        # Sum contributions for each leave-one-out estimate.\n        sum_exp_terms = np.sum(exp_terms, axis=1)\n\n        # If sum_exp_terms is zero (e.g., for very sparse spikes and small sigma),\n        # the estimated rate is zero, and its log is -inf.\n        if np.any(sum_exp_terms = 1e-300): # Use a small threshold to avoid log(0)\n            return -np.inf\n            \n        constant_factor = 1.0 / (np.sqrt(2.0 * np.pi) * sigma)\n        loo_rates = constant_factor * sum_exp_terms\n        \n        log_lik_term = np.sum(np.log(loo_rates))\n\n        # Term 2: Integral of the full rate estimate over [0, T]\n        # This is the sum of boundary-corrected kernel integrals.\n        z_upper = (T - spikes) / sigma\n        z_lower = -spikes / sigma\n        \n        integral_contributions = norm_cdf(z_upper) - norm_cdf(z_lower)\n        integral_term = np.sum(integral_contributions)\n        \n        return log_lik_term - integral_term\n\n    def find_optimal_sigma(T, spikes, sigma_grid):\n        \"\"\"\n        Finds the optimal sigma from a grid by maximizing the LOOCV objective.\n        \"\"\"\n        objective_values = [calculate_loocv_objective(sigma, spikes, T) for sigma in sigma_grid]\n        \n        # In case all values are -inf, np.argmax would pick the first one. This is an acceptable tie-break.\n        max_index = np.argmax(objective_values)\n        return sigma_grid[max_index]\n\n    # Define the grid of candidate bandwidths (in seconds).\n    sigma_grid = np.array([0.002, 0.005, 0.010, 0.020, 0.050, 0.100, 0.200, 0.300])\n\n    # ---- Define the test cases from the problem statement. ----\n    \n    # Case 1: Happy path (approximately uniform spike spacing)\n    T1 = 1.0\n    spikes1 = (np.arange(50) + 0.5) / 50.0\n\n    # Case 2: Burst plus background\n    T2 = 1.0\n    burst = 0.5 + 0.0005 * (np.arange(20) - 10.0)\n    background = (np.arange(10) + 0.5) / 10.0\n    spikes2 = np.sort(np.concatenate((burst, background)))\n\n    # Case 3: Sparse\n    T3 = 1.0\n    spikes3 = np.array([0.1, 0.5, 0.9])\n\n    # Case 4: Two close spikes\n    T4 = 1.0\n    spikes4 = np.array([0.5, 0.505])\n\n    test_cases = [\n        (T1, spikes1),\n        (T2, spikes2),\n        (T3, spikes3),\n        (T4, spikes4),\n    ]\n\n    results = []\n    for T, spikes in test_cases:\n        optimal_sigma = find_optimal_sigma(T, spikes, sigma_grid)\n        results.append(optimal_sigma)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}