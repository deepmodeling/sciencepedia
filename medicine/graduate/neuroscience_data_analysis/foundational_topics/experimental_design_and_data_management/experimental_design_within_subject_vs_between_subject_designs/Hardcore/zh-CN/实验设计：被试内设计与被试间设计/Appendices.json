{
    "hands_on_practices": [
        {
            "introduction": "在选择实验设计时，统计功效是一个核心考量因素。被试内设计通常因其能有效控制个体差异而具有更高的统计功效，但这究竟意味着什么，以及我们如何量化这种优势？本练习将引导你从第一性原理出发，推导和比较两种设计在相同观测总数下的功效差异，并进一步探讨在资源（如时间和预算）受限的情况下，如何优化被试间设计中的样本分配策略，这是规划高效、可行实验的关键技能。",
            "id": "4161680",
            "problem": "一个认知神经科学实验室正在计划一项实验，旨在比较两种任务条件下（表示为条件 $A$ 和条件 $B$）的条件水平神经反应（例如，功能性磁共振成像 (fMRI) 中的血氧水平依赖 (Blood Oxygenation Level Dependent) 信号振幅）。科学上感兴趣的量是群体平均神经反应估计值的平均差 $\\Delta = \\mu_{A} - \\mu_{B}$。该团队正在考虑采用被试间设计（两种条件使用独立的被试组）或被试内设计（对同一批被试在两种条件下进行配对测量）。您需要从抽样分布和中心极限定理的基本原理出发，分析统计功效作为分配函数的表现，并确定在成本约束下的最优组别大小比例。\n\n假设以下建模假设已通过先前的预实验数据和标准预处理得到验证：\n- 在被试间设计中，每个被试在其被分配的条件下贡献一个单一的条件水平估计值。设条件 $A$ 的被试水平估计值的变异性为 $\\sigma_{1}^{2}$，条件 $B$ 的为 $\\sigma_{2}^{2}$。假设有 $n_{1}$ 名被试被分配到条件 $A$，$n_{2}$ 名被试被分配到条件 $B$。按条件计的总观测数为 $N_{\\mathrm{tot}} = n_{1} + n_{2}$。\n- 在被试内设计中， $m$ 名被试中的每一名都在两种条件下进行测量，每个条件的被试水平方差为 $\\sigma^{2}$，来自同一个人的两个条件水平估计值之间的被试内相关性为 $\\rho$。按条件计的总观测数为 $N_{\\mathrm{tot}} = 2 m$。跨被试效应 $\\Delta$ 在两种设计中是相同的目标。\n- 对于大样本，使用中心极限定理将样本均值建模为近似高斯分布，其适当的方差由独立性和相关性结构确定。\n\n第1部分（在总观测数固定的情况下，不等组别大小的影响）。假设被试间设计中每个条件的方差相等，即 $\\sigma_{1}^{2} = \\sigma_{2}^{2} = \\sigma^{2}$，但组别大小可能不相等，分配比例为 $r = n_{1} / n_{2}$。在保持按条件计的总观测数 $N_{\\mathrm{tot}}$ 不变的情况下，推导在被试间设计下，对 $H_{0} : \\Delta = 0$ 进行大样本 $Z$ 检验的非中心参数，并将其表示为 $r$ 和 $N_{\\mathrm{tot}}$ 的函数。对被试内设计做同样的操作，将其表示为 $N_{\\mathrm{tot}}$ 和 $\\rho$ 的函数。然后，推导非中心参数之比（被试内设计相对于被试间设计）的解析表达式，将其表示为 $r$ 和 $\\rho$ 的函数，并解释其对 $r$ 和 $\\rho$ 的依赖性。\n\n第2部分（线性成本约束下的最优分配）。现在回到方差可能不等的（$\\sigma_{1}^{2}$ 和 $\\sigma_{2}^{2}$）一般被试间设计情况。假设将一名参与者分配到条件 $A$ 的单位成本是 $c_{1}$，分配到条件 $B$ 的单位成本是 $c_{2}$，总预算固定为 $C$，因此有 $c_{1} n_{1} + c_{2} n_{2} = C$。仅使用均值差估计量的方差结构和中心极限定理，从基本原理出发，推导在此预算下，能够最大化检验 $H_{0} : \\Delta = 0$ 的大样本功效的分配比例 $r^{\\ast} = n_{1} / n_{2}$。\n\n以包含 $\\sigma_{1}$、$\\sigma_{2}$、$c_{1}$ 和 $c_{2}$ 的单一闭式解析表达式形式提供您的最终答案。最终答案中不要包含任何额外评论。如果在推导过程中进行了任何中间数值简化，最终表达式中请保留精确的符号形式。最终答案中不表示单位。",
            "solution": "该问题要求分析两种常见实验设计的统计功效，并推导在预算约束下的最优样本量分配。分析将从抽样分布的基本原理出发。\n\n对于一个检验原假设 $H_{0} : \\Delta = 0$ 与备择假设 $H_{A} : \\Delta \\neq 0$ 的功效，是在备择假设下，检验统计量分布的非中心参数 (NCP) 大小的单调递增函数。对于大样本 $Z$ 检验，检验统计量由 $Z = \\frac{\\hat{\\Delta}}{\\text{SE}(\\hat{\\Delta})}$ 给出，其中 $\\hat{\\Delta}$ 是均值差 $\\Delta = \\mu_{A} - \\mu_{B}$ 的样本估计量，$\\text{SE}(\\hat{\\Delta})$ 是其标准误。在备择假设下，$\\mathbb{E}[\\hat{\\Delta}] = \\Delta$，检验统计量服从非中心正态分布，其非中心参数 $\\lambda$ 由下式给出：\n$$\n\\lambda = \\frac{\\mathbb{E}[\\hat{\\Delta}]}{\\text{SE}(\\hat{\\Delta})} = \\frac{\\Delta}{\\sqrt{\\text{Var}(\\hat{\\Delta})}}\n$$\n因此，最大化功效等价于最大化 $|\\lambda|$，而这又等价于最小化估计量的方差 $\\text{Var}(\\hat{\\Delta})$。\n\n第1部分：在总观测数固定的情况下比较设计\n\n首先，我们分析被试间设计。均值差的估计量是 $\\hat{\\Delta}_{\\text{between}} = \\bar{X}_{1} - \\bar{X}_{2}$，其中 $\\bar{X}_{1}$ 和 $\\bar{X}_{2}$ 分别是条件 $A$ 和条件 $B$ 的样本均值。由于两组被试是独立的，估计量的方差是样本均值方差之和：\n$$\n\\text{Var}(\\hat{\\Delta}_{\\text{between}}) = \\text{Var}(\\bar{X}_{1}) + \\text{Var}(\\bar{X}_{2})\n$$\n根据中心极限定理，对于大样本量 $n_{1}$ 和 $n_{2}$，样本均值的方差近似为 $\\frac{\\sigma_{1}^{2}}{n_{1}}$ 和 $\\frac{\\sigma_{2}^{2}}{n_{2}}$。对于第1部分，我们已知 $\\sigma_{1}^{2} = \\sigma_{2}^{2} = \\sigma^{2}$。因此，\n$$\n\\text{Var}(\\hat{\\Delta}_{\\text{between}}) = \\frac{\\sigma^{2}}{n_{1}} + \\frac{\\sigma^{2}}{n_{2}} = \\sigma^{2} \\left( \\frac{1}{n_{1}} + \\frac{1}{n_{2}} \\right)\n$$\n我们需要将此方差表示为按条件计的总观测数 $N_{\\mathrm{tot}} = n_{1} + n_{2}$ 和分配比例 $r = n_{1} / n_{2}$ 的函数。我们有 $n_{1} = r n_{2}$。将其代入 $N_{\\mathrm{tot}}$ 的表达式中，得到 $N_{\\mathrm{tot}} = r n_{2} + n_{2} = (r+1)n_{2}$，这意味着 $n_{2} = \\frac{N_{\\mathrm{tot}}}{r+1}$ 和 $n_{1} = r \\frac{N_{\\mathrm{tot}}}{r+1}$。将这些代入方差表达式中：\n$$\n\\text{Var}(\\hat{\\Delta}_{\\text{between}}) = \\sigma^{2} \\left( \\frac{r+1}{r N_{\\mathrm{tot}}} + \\frac{r+1}{N_{\\mathrm{tot}}} \\right) = \\frac{\\sigma^{2}(r+1)}{N_{\\mathrm{tot}}} \\left( \\frac{1}{r} + 1 \\right) = \\frac{\\sigma^{2}(r+1)}{N_{\\mathrm{tot}}} \\frac{1+r}{r} = \\frac{\\sigma^{2}(r+1)^{2}}{r N_{\\mathrm{tot}}}\n$$\n被试间设计的非中心参数 $\\lambda_{\\text{between}}$ 为：\n$$\n\\lambda_{\\text{between}} = \\frac{\\Delta}{\\sqrt{\\frac{\\sigma^{2}(r+1)^{2}}{r N_{\\mathrm{tot}}}}} = \\frac{\\Delta \\sqrt{r N_{\\mathrm{tot}}}}{\\sigma (r+1)}\n$$\n接下来，我们分析被试内设计。在这里， $m$ 名被试每人都为两种条件提供一次测量。估计量 $\\hat{\\Delta}_{\\text{within}}$ 是配对差异的均值 $\\bar{D}$，其中 $D_{i} = X_{Ai} - X_{Bi}$ 代表第 $i$ 个被试。单个差异 $D_{i}$ 的方差为：\n$$\n\\text{Var}(D_{i}) = \\text{Var}(X_{Ai} - X_{Bi}) = \\text{Var}(X_{Ai}) + \\text{Var}(X_{Bi}) - 2 \\text{Cov}(X_{Ai}, X_{Bi})\n$$\n已知每个条件的方差为 $\\sigma^{2}$，被试内相关性为 $\\rho$，我们有 $\\text{Cov}(X_{Ai}, X_{Bi}) = \\rho \\sqrt{\\sigma^{2} \\sigma^{2}} = \\rho \\sigma^{2}$。因此，\n$$\n\\text{Var}(D_{i}) = \\sigma^{2} + \\sigma^{2} - 2\\rho\\sigma^{2} = 2\\sigma^{2}(1-\\rho)\n$$\n样本均值差 $\\hat{\\Delta}_{\\text{within}} = \\bar{D}$ 的方差是：\n$$\n\\text{Var}(\\hat{\\Delta}_{\\text{within}}) = \\frac{\\text{Var}(D_{i})}{m} = \\frac{2\\sigma^{2}(1-\\rho)}{m}\n$$\n按条件计的总观测数为 $N_{\\mathrm{tot}} = 2m$，所以 $m = N_{\\mathrm{tot}}/2$。将此代入方差表达式中：\n$$\n\\text{Var}(\\hat{\\Delta}_{\\text{within}}) = \\frac{2\\sigma^{2}(1-\\rho)}{N_{\\mathrm{tot}}/2} = \\frac{4\\sigma^{2}(1-\\rho)}{N_{\\mathrm{tot}}}\n$$\n被试内设计的非中心参数 $\\lambda_{\\text{within}}$ 为：\n$$\n\\lambda_{\\text{within}} = \\frac{\\Delta}{\\sqrt{\\frac{4\\sigma^{2}(1-\\rho)}{N_{\\mathrm{tot}}}}} = \\frac{\\Delta \\sqrt{N_{\\mathrm{tot}}}}{2\\sigma\\sqrt{1-\\rho}}\n$$\n非中心参数之比（被试内设计相对于被试间设计）为：\n$$\n\\frac{\\lambda_{\\text{within}}}{\\lambda_{\\text{between}}} = \\frac{\\frac{\\Delta \\sqrt{N_{\\mathrm{tot}}}}{2\\sigma\\sqrt{1-\\rho}}}{\\frac{\\Delta \\sqrt{r N_{\\mathrm{tot}}}}{\\sigma (r+1)}} = \\frac{\\Delta \\sqrt{N_{\\mathrm{tot}}}}{2\\sigma\\sqrt{1-\\rho}} \\cdot \\frac{\\sigma(r+1)}{\\Delta \\sqrt{r N_{\\mathrm{tot}}}} = \\frac{r+1}{2\\sqrt{r}\\sqrt{1-\\rho}}\n$$\n对该比例的解释：\n1.  对 $r$ 的依赖性：当 $r=1$ 时（均衡分组，$n_1=n_2$），项 $\\frac{r+1}{2\\sqrt{r}}$ 达到最小值，等于 $1$。任何不均衡（$r \\neq 1$）都会增加该项的值，从而降低被试间设计的效率，进而增加了被试内设计的相对效率。\n2.  对 $\\rho$ 的依赖性：该比例与 $\\sqrt{1-\\rho}$ 成反比。随着被试内相关性 $\\rho$ 趋近于 $1$，项 $\\sqrt{1-\\rho}$ 趋近于 $0$，该比例趋近于无穷大。这表明当同一被试的测量值高度相关时，被试内设计具有显著的功效优势，因为求差操作有效地抵消了稳定的被试间变异。如果 $\\rho=0$，该比例变为 $\\frac{r+1}{2\\sqrt{r}}$。如果此时 $r=1$，该比例为 $1$，表示在总观测数 $N_{\\mathrm{tot}}$ 固定且不存在被试内相关性的情况下，两种设计的功效相等。\n\n第2部分：预算约束下的最优分配\n\n我们现在回到方差 $\\sigma_{1}^{2}$ 和 $\\sigma_{2}^{2}$ 可能不同的一般被试间设计情况。我们寻求最大化功效，这等价于在固定预算 $C$ 的约束下最小化估计量的方差 $\\text{Var}(\\hat{\\Delta}_{\\text{between}})$。\n优化问题是：\n最小化 $V(n_{1}, n_{2}) = \\frac{\\sigma_{1}^{2}}{n_{1}} + \\frac{\\sigma_{2}^{2}}{n_{2}}$\n约束条件为 $g(n_{1}, n_{2}) = c_{1}n_{1} + c_{2}n_{2} - C = 0$。\n\n我们使用拉格朗日乘数法。拉格朗日函数 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L}(n_{1}, n_{2}, \\gamma) = \\left( \\frac{\\sigma_{1}^{2}}{n_{1}} + \\frac{\\sigma_{2}^{2}}{n_{2}} \\right) - \\gamma (c_{1}n_{1} + c_{2}n_{2} - C)\n$$\n为了找到最小值，我们将关于 $n_{1}$ 和 $n_{2}$ 的偏导数设为零，并将它们视为连续变量：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial n_{1}} = -\\frac{\\sigma_{1}^{2}}{n_{1}^{2}} - \\gamma c_{1} = 0 \\implies \\frac{\\sigma_{1}^{2}}{n_{1}^{2}} = -\\gamma c_{1}\n$$\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial n_{2}} = -\\frac{\\sigma_{2}^{2}}{n_{2}^{2}} - \\gamma c_{2} = 0 \\implies \\frac{\\sigma_{2}^{2}}{n_{2}^{2}} = -\\gamma c_{2}\n$$\n由第一个方程，我们得到 $-\\gamma = \\frac{\\sigma_{1}^{2}}{c_{1}n_{1}^{2}}$。由第二个方程，我们得到 $-\\gamma = \\frac{\\sigma_{2}^{2}}{c_{2}n_{2}^{2}}$。令这两个关于 $-\\gamma$ 的表达式相等，可得：\n$$\n\\frac{\\sigma_{1}^{2}}{c_{1}n_{1}^{2}} = \\frac{\\sigma_{2}^{2}}{c_{2}n_{2}^{2}}\n$$\n我们现在求解分配比例 $r^{\\ast} = n_{1}/n_{2}$。重新整理各项：\n$$\n\\frac{n_{1}^{2}}{n_{2}^{2}} = \\frac{\\sigma_{1}^{2} c_{2}}{\\sigma_{2}^{2} c_{1}}\n$$\n对两边取平方根（因为样本量 $n_{1}, n_{2}$ 必须为正）得到最优比例：\n$$\nr^{\\ast} = \\frac{n_{1}}{n_{2}} = \\sqrt{\\frac{\\sigma_{1}^{2} c_{2}}{\\sigma_{2}^{2} c_{1}}} = \\frac{\\sigma_{1}}{\\sigma_{2}} \\sqrt{\\frac{c_{2}}{c_{1}}}\n$$\n这个结果表明，在预算约束下要最大化功效，应将更多被试分配给变异性更大（$\\sigma$ 更高）且成本更低（$c$ 更低）的条件。具体来说，一个组的最优样本量与其标准差成正比，与其单位被试成本的平方根成反比。",
            "answer": "$$\n\\boxed{\\frac{\\sigma_{1}}{\\sigma_{2}} \\sqrt{\\frac{c_{2}}{c_{1}}}}\n$$"
        },
        {
            "introduction": "为了进行功效分析或元分析（meta-analysis），我们需要一种“通用货币”来衡量效应量，而不受具体实验设计的影响。不同的设计有其相应的效应量指标，如用于被试间设计的科恩$d$（Cohen's $d$）和用于被试内设计的标准化平均变化$d_z$。本练习将帮助你厘清这些关键指标的定义，并推导它们之间的转换公式，这是在不同研究之间进行比较和综合时不可或缺的工具。",
            "id": "4161688",
            "problem": "一个认知神经科学实验室正在设计一项新研究，以在相同的被试上比较两种任务条件，标记为条件 $1$ 和条件 $2$（一种被试内设计）。主要结果是一个连续的神经测量指标（例如，单次试验平均的事件相关电位振幅）。在之前一项使用被试内设计的研究中，报告的效应量是标准化平均变化量 $d_z$。该新实验室打算计划一项独立组（被试间）研究，因此需要知道在已知测量值分布特性的情况下，与先前报告的 $d_z$ 等效的独立组 Cohen's $d$。\n\n请从第一性原理出发，仔细定义和区分以下效应量指标：\n- 针对两个独立组，使用合并标准差的 Cohen's $d$，\n- 作为 Cohen's $d$ 的小样本偏差校正版本的 Hedges' $g$，\n- 在被试内设计中针对配对测量的标准化平均变化量 $d_z$。\n\n假设神经测量指标满足以下科学上合理的条件：\n- 两种特定条件下的测量值 $X_1$ 和 $X_2$ 均近似服从正态分布，且具有有限二阶矩，其特定条件下的总体标准差分别为 $\\sigma_1$ 和 $\\sigma_2$。如果被视为独立组，则每个条件的样本量均为 $n$。\n- 在被试内设计中，$X_1$ 和 $X_2$ 的配对测量值之间存在总体相关性 $\\rho$。\n- 在被试内设计中，差异分数的方差由经过充分检验的恒等式 $\\operatorname{Var}(X_1 - X_2) = \\sigma_1^2 + \\sigma_2^2 - 2 \\rho \\sigma_1 \\sigma_2$ 给出。\n- 在计划独立组研究时，合并标准差对应于基于两种特定条件下的离散度的等样本量 $n$ 合并形式。\n\n从这些基础出发，并且不使用任何未经证明的捷径，推导出一个封闭形式的转换公式，该公式将把被试内标准化平均变化量 $d_z$ 映射到被试间 Cohen's $d$，并将其表示为 $d_z$、$\\sigma_1$、$\\sigma_2$ 和 $\\rho$ 的函数。将您的最终答案表示为一个关于 $d$ 的单一封闭形式解析表达式，用 $d_z$、$\\sigma_1$、$\\sigma_2$ 和 $\\rho$ 表示。不包含任何单位，也不提供数值近似。",
            "solution": "该问题要求严谨推导被试内设计的标准化平均变化量 $d_z$ 与被试间设计的 Cohen's $d$ 之间的转换公式。本解答将从第一性原理出发，首先给出相关效应量指标的正式定义。\n\n首先，我们按要求定义这三个效应量指标。设 $\\mu_1$ 和 $\\mu_2$ 分别为条件 $1$ 和条件 $2$ 的总体均值。设 $\\sigma_1$ 和 $\\sigma_2$ 为相应的总体标准差。两种条件下的测量值用随机变量 $X_1$ 和 $X_2$ 表示。\n\n1.  **针对两个独立组的 Cohen's $d$**：该指标量化了两个独立总体均值之间的差异大小，并通过其合并标准差进行标准化。总体参数 $d$ 定义为总体均值之差除以总体合并标准差 $\\sigma_p$。对于计划研究中可能具有不同标准差 $\\sigma_1$ 和 $\\sigma_2$ 且样本量均为 $n$ 的两个组，其合并标准差由下式给出：\n    $$\n    \\sigma_p = \\sqrt{\\frac{\\sigma_1^2 + \\sigma_2^2}{2}}\n    $$\n    因此，Cohen's $d$ 定义为：\n    $$\n    d = \\frac{\\mu_1 - \\mu_2}{\\sigma_p} = \\frac{\\mu_1 - \\mu_2}{\\sqrt{\\frac{\\sigma_1^2 + \\sigma_2^2}{2}}}\n    $$\n\n2.  **Hedges' $g$**：当从样本数据中估计 Cohen's $d$ 时，它是总体参数 $d$ 的一个有偏估计量，尤其是在小样本情况下。Hedges' $g$ 是对这种偏差的校正。它的计算方法是将样本 Cohen's $d$ 乘以一个校正因子 $J$，该因子是总自由度 $df$ 的函数。对于大小为 $n_1$ 和 $n_2$ 的两个独立组， $df = n_1 + n_2 - 2$。校正因子的确切形式是：\n    $$\n    J(df) = \\frac{\\Gamma\\left(\\frac{df}{2}\\right)}{\\sqrt{\\frac{df}{2}} \\Gamma\\left(\\frac{df-1}{2}\\right)}\n    $$\n    其中 $\\Gamma$ 是伽马函数。那么 Hedges' $g$ 就是 $g = d_{\\text{sample}} \\times J(df)$。该指标提供了对总体效应量更准确的估计，但对于本次推导并非必需，因为本次推导关注的是总体参数 $d$ 和 $d_z$ 之间的关系。\n\n3.  **标准化平均变化量 $d_z$**：该效应量用于被试内（配对或重复测量）设计。它通过差异分数的标准差来标准化两个配对测量值 $X_1$ 和 $X_2$ 之间的平均差异。设 $D = X_1 - X_2$ 为差异分数。差异分数的均值为 $\\mu_D = E[D] = E[X_1 - X_2] = \\mu_1 - \\mu_2$。差异分数的标准差为 $\\sigma_D = \\sqrt{\\operatorname{Var}(D)}$。标准化平均变化量 $d_z$ 定义为：\n    $$\n    d_z = \\frac{\\mu_D}{\\sigma_D} = \\frac{\\mu_1 - \\mu_2}{\\sqrt{\\operatorname{Var}(X_1 - X_2)}}\n    $$\n\n在确立了这些定义之后，我们现在可以推导转换公式。目标是把 $d$ 表示为 $d_z$、$\\sigma_1$、$\\sigma_2$ 以及配对测量值 $X_1$ 和 $X_2$ 之间的相关性 $\\rho$ 的函数。\n\n$d$ 和 $d_z$ 的定义如下：\n$$\nd = \\frac{\\mu_1 - \\mu_2}{\\sqrt{\\frac{\\sigma_1^2 + \\sigma_2^2}{2}}}\n$$\n$$\nd_z = \\frac{\\mu_1 - \\mu_2}{\\sigma_{X_1 - X_2}}\n$$\n两个表达式有共同的分子 $\\mu_1 - \\mu_2$。我们可以用 $d_z$ 的定义来表示这一项：\n$$\n\\mu_1 - \\mu_2 = d_z \\cdot \\sigma_{X_1 - X_2}\n$$\n问题陈述提供了两个相关变量之差的方差的恒等式：\n$$\n\\operatorname{Var}(X_1 - X_2) = \\sigma_1^2 + \\sigma_2^2 - 2 \\rho \\sigma_1 \\sigma_2\n$$\n差异分数的标准差 $\\sigma_{X_1 - X_2}$ 是该方差的平方根：\n$$\n\\sigma_{X_1 - X_2} = \\sqrt{\\sigma_1^2 + \\sigma_2^2 - 2 \\rho \\sigma_1 \\sigma_2}\n$$\n将此代入均值差的表达式中，得到：\n$$\n\\mu_1 - \\mu_2 = d_z \\cdot \\sqrt{\\sigma_1^2 + \\sigma_2^2 - 2 \\rho \\sigma_1 \\sigma_2}\n$$\n现在，我们将这个关于 $\\mu_1 - \\mu_2$ 的表达式代入 Cohen's $d$ 的定义中：\n$$\nd = \\frac{d_z \\cdot \\sqrt{\\sigma_1^2 + \\sigma_2^2 - 2 \\rho \\sigma_1 \\sigma_2}}{\\sqrt{\\frac{\\sigma_1^2 + \\sigma_2^2}{2}}}\n$$\n这个表达式将 $d$ 与 $d_z$ 及其他参数联系起来。可以通过将各项合并到一个平方根下来简化它：\n$$\nd = d_z \\cdot \\sqrt{\\frac{\\sigma_1^2 + \\sigma_2^2 - 2 \\rho \\sigma_1 \\sigma_2}{\\left(\\frac{\\sigma_1^2 + \\sigma_2^2}{2}\\right)}}\n$$\n将平方根内的分子和分母同乘以 $2$，得到最终的封闭形式表达式：\n$$\nd = d_z \\cdot \\sqrt{\\frac{2(\\sigma_1^2 + \\sigma_2^2 - 2 \\rho \\sigma_1 \\sigma_2)}{\\sigma_1^2 + \\sigma_2^2}}\n$$\n这个方程提供了在给定两种条件的标准差及其相关性的情况下，从被试内效应量 $d_z$ 到等效的被试间效应量 Cohen's $d$ 的直接转换。",
            "answer": "$$\\boxed{d_z \\sqrt{\\frac{2(\\sigma_1^2 + \\sigma_2^2 - 2 \\rho \\sigma_1 \\sigma_2)}{\\sigma_1^2 + \\sigma_2^2}}}$$"
        },
        {
            "introduction": "一个精心选择的实验设计如果未能妥善处理混淆变量，也可能得出误导性的结论。在神经科学实验中，诸如疲劳或唤醒度随时间的变化等时间漂移（temporal drift）是常见的混淆因素。本练习将通过一个具体案例，向你展示一个混淆变量如何凭空制造出虚假的组间差异，并引导你运用多元回归模型来统计性地“校正”这种偏差，这一强大的技术同样适用于被试内和被试间设计。",
            "id": "4161717",
            "problem": "一个实验室进行了一项被试内实验，以测量单次实验过程中神经反应 $Y$ 的变化。每个试次 $i \\in \\{1,\\dots,n\\}$ 被分配到两种条件之一，编码为 $C_i \\in \\{0,1\\}$，并在相对于实验开始的时间 $T_i \\in \\mathbb{R}$ 发生。一个公认的现象是，由于唤醒或疲劳，神经元基线在单次实验中会随时间发生近似线性的漂移。研究人员怀疑存在一个斜率为 $\\beta$ 的线性漂移。他们还注意到，与 $C_i = 0$ 的试次相比，$C_i = 1$ 的试次被不成比例地安排在了实验的早期。考虑生成模型\n$$\nY_i \\;=\\; \\theta \\;+\\; \\alpha\\, C_i \\;+\\; \\beta\\, T_i \\;+\\; \\varepsilon_i,\n$$\n其中 $\\theta \\in \\mathbb{R}$ 是基线截距，$\\alpha \\in \\mathbb{R}$ 是真实的条件效应，$\\beta \\in \\mathbb{R}$ 是线性漂移斜率，$\\varepsilon_i$ 是独立的、均值为零的误差，满足 $\\mathbb{E}[\\varepsilon_i] = 0$ 且方差有限。令 $\\bar{Y}_c$ 表示在条件 $C_i = c$ 下 $Y_i$ 的样本均值，类似地，定义 $\\bar{T}_c$ 为在条件 $C_i = c$ 下 $T_i$ 的样本均值，其中 $c \\in \\{0,1\\}$。\n\n第1部分（虚假差异）：假设 $\\alpha = 0$。使用上述模型和条件样本均值的定义，推导在忽略线性漂移时，朴素条件均值差异 $\\bar{Y}_1 - \\bar{Y}_0$ 的期望值。用 $\\beta$、$\\bar{T}_1$ 和 $\\bar{T}_0$ 表示你的最终表达式。\n\n第2部分（回归调整）：提出一种回归调整方法，以消除由 $C$ 和 $T$ 之间的相关性引起的偏差。当将 $Y$ 对 $C$ 和 $T$ 进行回归时，推导调整后的条件效应 $\\hat{\\alpha}_{\\mathrm{adj}}$ 的闭式普通最小二乘法（OLS; Ordinary Least Squares）估计量。用样本二阶矩\n$$\nS_{XY} \\;=\\; \\frac{1}{n}\\sum_{i=1}^{n} \\big(X_i - \\bar{X}\\big)\\big(Y_i - \\bar{Y}\\big),\n$$\n来表示该估计量，其中 $X$ 和 $Y$ 可以是 $Y$、$C$ 或 $T$ 中的任意一个，$\\bar{X}$ 和 $\\bar{Y}$ 表示样本均值。你关于 $\\hat{\\alpha}_{\\mathrm{adj}}$ 的最终表达式必须是仅使用 $S_{YC}$、$S_{YT}$、$S_{CT}$、$S_{CC}$ 和 $S_{TT}$ 的闭式形式。\n\n在你的推导中，讨论如果平均实验时间或测试日期在不同组之间存在系统性差异，同样的偏差机制如何在被试间设计（其中每个被试的 $C$ 是恒定的）中出现，并解释为什么所提出的回归调整方法同样适用于被试内和被试间设计。\n\n你的最终答案必须是一个闭式解析表达式。如果需要多个表达式，请将它们表示为单个行矩阵。不需要数值近似。",
            "solution": "问题陈述已经过验证，被认为是科学上合理的、适定的和客观的。它提出了实验数据分析中一个标准的混杂情景，这在神经科学和其他领域很常见。问题是精确且可形式化的，能够得出唯一的、有意义的解。\n\n按照要求，问题分两部分解决。\n\n第1部分：预期虚假差异的推导\n\n我们被要求在假设真实条件效应为零（即 $\\alpha = 0$）的情况下，推导朴素条件均值差异 $\\bar{Y}_1 - \\bar{Y}_0$ 的期望值。\n\n在此假设下，生成模型为：\n$$\nY_i = \\theta + \\beta T_i + \\varepsilon_i\n$$\n其中 $\\mathbb{E}[\\varepsilon_i] = 0$。\n\n给定条件 $c \\in \\{0, 1\\}$ 下响应 $Y$ 的样本均值定义为 $\\bar{Y}_c = \\frac{1}{n_c} \\sum_{i: C_i=c} Y_i$，其中 $n_c$ 是条件 $c$ 下的试次数量。\n\n让我们写出 $\\bar{Y}_1$ 和 $\\bar{Y}_0$ 的表达式：\n$$\n\\bar{Y}_1 = \\frac{1}{n_1} \\sum_{i: C_i=1} Y_i = \\frac{1}{n_1} \\sum_{i: C_i=1} (\\theta + \\beta T_i + \\varepsilon_i)\n$$\n根据求和的线性性质，这变为：\n$$\n\\bar{Y}_1 = \\frac{1}{n_1} (n_1 \\theta + \\beta \\sum_{i: C_i=1} T_i + \\sum_{i: C_i=1} \\varepsilon_i) = \\theta + \\beta \\left( \\frac{1}{n_1} \\sum_{i: C_i=1} T_i \\right) + \\left( \\frac{1}{n_1} \\sum_{i: C_i=1} \\varepsilon_i \\right)\n$$\n使用时间条件样本均值的定义 $\\bar{T}_1 = \\frac{1}{n_1} \\sum_{i: C_i=1} T_i$，并定义 $\\bar{\\varepsilon}_1 = \\frac{1}{n_1} \\sum_{i: C_i=1} \\varepsilon_i$，我们得到：\n$$\n\\bar{Y}_1 = \\theta + \\beta \\bar{T}_1 + \\bar{\\varepsilon}_1\n$$\n类似地，对于条件 $c=0$：\n$$\n\\bar{Y}_0 = \\theta + \\beta \\bar{T}_0 + \\bar{\\varepsilon}_0\n$$\n因此，朴素的条件均值差异为：\n$$\n\\bar{Y}_1 - \\bar{Y}_0 = (\\theta + \\beta \\bar{T}_1 + \\bar{\\varepsilon}_1) - (\\theta + \\beta \\bar{T}_0 + \\bar{\\varepsilon}_0) = \\beta(\\bar{T}_1 - \\bar{T}_0) + (\\bar{\\varepsilon}_1 - \\bar{\\varepsilon}_0)\n$$\n为了求这个差异的期望值，我们对两边取期望。在这种情况下，实验设计参数，包括试次时间 $T_i$ 和条件分配 $C_i$，被认为是固定的。因此，$\\bar{T}_1$ 和 $\\bar{T}_0$ 是非随机量。唯一的随机变量是误差项 $\\varepsilon_i$。\n$$\n\\mathbb{E}[\\bar{Y}_1 - \\bar{Y}_0] = \\mathbb{E}[\\beta(\\bar{T}_1 - \\bar{T}_0) + (\\bar{\\varepsilon}_1 - \\bar{\\varepsilon}_0)] = \\beta(\\bar{T}_1 - \\bar{T}_0) + \\mathbb{E}[\\bar{\\varepsilon}_1] - \\mathbb{E}[\\bar{\\varepsilon}_0]\n$$\n每个条件下平均误差的期望是：\n$$\n\\mathbb{E}[\\bar{\\varepsilon}_c] = \\mathbb{E}\\left[\\frac{1}{n_c} \\sum_{i: C_i=c} \\varepsilon_i\\right] = \\frac{1}{n_c} \\sum_{i: C_i=c} \\mathbb{E}[\\varepsilon_i]\n$$\n由于对所有 $i$ 都有 $\\mathbb{E}[\\varepsilon_i] = 0$，我们得到对 $c \\in \\{0, 1\\}$ 都有 $\\mathbb{E}[\\bar{\\varepsilon}_c] = 0$。\n将此代入期望差异的表达式中：\n$$\n\\mathbb{E}[\\bar{Y}_1 - \\bar{Y}_0] = \\beta(\\bar{T}_1 - \\bar{T}_0)\n$$\n这个结果表明，如果存在非零的线性漂移（$\\beta \\neq 0$）并且两种条件下的试次平均时间存在系统性差异（$\\bar{T}_1 \\neq \\bar{T}_0$），则预期会出现虚假的条件均值差异。\n\n第2部分：回归调整和OLS估计量的推导\n\n所提出的回归调整是拟合完整的多元线性模型，该模型包含混杂变量 $T$ 作为协变量：\n$$\nY_i = \\theta + \\alpha C_i + \\beta T_i + \\varepsilon_i\n$$\n我们寻求参数 $\\alpha$ 的普通最小二乘法（OLS）估计量，它代表了对线性时间漂移进行调整后的条件效应。我们将此估计量表示为 $\\hat{\\alpha}_{\\mathrm{adj}}$。\n\n多元回归的OLS估计量通常使用中心化变量来推导。令 $y_i = Y_i - \\bar{Y}$，$c_i = C_i - \\bar{C}$ 和 $t_i = T_i - \\bar{T}$，其中 $\\bar{Y}$、$\\bar{C}$ 和 $\\bar{T}$ 是总体样本均值。将 $y_i$ 对 $c_i$ 和 $t_i$ 进行回归，可以得到 $\\alpha$ 和 $\\beta$ 的估计量。中心化变量的模型是 $y_i = \\alpha c_i + \\beta t_i + \\varepsilon'_i$。OLS估计量 $\\hat{\\alpha}_{\\mathrm{adj}}$ 和 $\\hat{\\beta}_{\\mathrm{adj}}$ 最小化残差平方和 $RSS = \\sum_{i=1}^{n} (y_i - \\alpha c_i - \\beta t_i)^2$。\n\n通过将 $RSS$ 对 $\\alpha$ 和 $\\beta$ 的偏导数设为零，可以得到正规方程组：\n$$\n\\frac{\\partial RSS}{\\partial \\alpha} = -2\\sum_{i=1}^{n} c_i(y_i - \\alpha c_i - \\beta t_i) = 0 \\quad \\implies \\quad \\alpha \\sum_{i=1}^{n} c_i^2 + \\beta \\sum_{i=1}^{n} c_i t_i = \\sum_{i=1}^{n} c_i y_i\n$$\n$$\n\\frac{\\partial RSS}{\\partial \\beta} = -2\\sum_{i=1}^{n} t_i(y_i - \\alpha c_i - \\beta t_i) = 0 \\quad \\implies \\quad \\alpha \\sum_{i=1}^{n} c_i t_i + \\beta \\sum_{i=1}^{n} t_i^2 = \\sum_{i=1}^{n} t_i y_i\n$$\n我们使用提供的样本二阶矩定义，$S_{XY} = \\frac{1}{n}\\sum_{i=1}^{n} (X_i - \\bar{X})(Y_i - \\bar{Y}) = \\frac{1}{n}\\sum_{i=1}^{n} x_i y_i$。正规方程组中的求和项可以用这些量来表示：\n$\\sum c_i y_i = n S_{CY} = n S_{YC}$，$\\sum c_i^2 = n S_{CC}$，$\\sum c_i t_i = n S_{CT}$，$\\sum t_i y_i = n S_{TY} = n S_{YT}$，以及 $\\sum t_i^2 = n S_{TT}$。\n\n将这些代入正规方程组并除以 $n$，得到一个关于估计量 $\\hat{\\alpha}_{\\mathrm{adj}}$ 和 $\\hat{\\beta}_{\\mathrm{adj}}$ 的二元线性方程组：\n$$\n\\hat{\\alpha}_{\\mathrm{adj}} S_{CC} + \\hat{\\beta}_{\\mathrm{adj}} S_{CT} = S_{YC} \\quad (1)\n$$\n$$\n\\hat{\\alpha}_{\\mathrm{adj}} S_{CT} + \\hat{\\beta}_{\\mathrm{adj}} S_{TT} = S_{YT} \\quad (2)\n$$\n为了求解 $\\hat{\\alpha}_{\\mathrm{adj}}$，我们首先从方程（2）中分离出 $\\hat{\\beta}_{\\mathrm{adj}}$：\n$$\n\\hat{\\beta}_{\\mathrm{adj}} = \\frac{S_{YT} - \\hat{\\alpha}_{\\mathrm{adj}} S_{CT}}{S_{TT}}\n$$\n接下来，我们将此表达式代入方程（1）：\n$$\n\\hat{\\alpha}_{\\mathrm{adj}} S_{CC} + \\left( \\frac{S_{YT} - \\hat{\\alpha}_{\\mathrm{adj}} S_{CT}}{S_{TT}} \\right) S_{CT} = S_{YC}\n$$\n为了消去分母，我们将整个方程乘以 $S_{TT}$：\n$$\n\\hat{\\alpha}_{\\mathrm{adj}} S_{CC} S_{TT} + (S_{YT} - \\hat{\\alpha}_{\\mathrm{adj}} S_{CT}) S_{CT} = S_{YC} S_{TT}\n$$\n展开各项：\n$$\n\\hat{\\alpha}_{\\mathrm{adj}} S_{CC} S_{TT} + S_{YT} S_{CT} - \\hat{\\alpha}_{\\mathrm{adj}} S_{CT}^2 = S_{YC} S_{TT}\n$$\n我们将包含 $\\hat{\\alpha}_{\\mathrm{adj}}$ 的项收集到一边：\n$$\n\\hat{\\alpha}_{\\mathrm{adj}} (S_{CC} S_{TT} - S_{CT}^2) = S_{YC} S_{TT} - S_{YT} S_{CT}\n$$\n最后，求解 $\\hat{\\alpha}_{\\mathrm{adj}}$ 得到闭式OLS估计量：\n$$\n\\hat{\\alpha}_{\\mathrm{adj}} = \\frac{S_{YC} S_{TT} - S_{YT} S_{CT}}{S_{CC} S_{TT} - S_{CT}^2}\n$$\n该估计量表示在统计上控制了时间 $T$ 的线性效应后，条件 $C$ 对响应 $Y$ 的偏效应。\n\n相同的偏差机制和相应的解决方案也适用于被试间设计。在被试间设计中，索引 $i$ 将代表不同的被试，条件变量 $C_i$ 将指示被试 $i$ 所属的实验组。如果另一个变量 $T_i$（例如，一天中的时间、星期几或被试的年龄）与分组 $C_i$ 相关，那么它就成了一个混杂变量。例如，如果治疗组（$C_i = 1$）主要在上午进行测试，而对照组（$C_i = 0$）在下午进行测试，那么神经反应 $Y$ 的任何日间变化都会混淆到估计的治疗效应中。这个问题的统计结构与被试内情况相同：$C$ 和 $T$ 之间的非零相关性会使对 $C$ 效应的简单估计产生偏差。多元回归模型 $Y_i = \\theta + \\alpha C_i + \\beta T_i + \\varepsilon_i$ 是处理线性混杂的通用工具。$\\hat{\\alpha}_{\\mathrm{adj}}$ 的推导是纯代数的，不依赖于索引 $i$ 的具体解释（是试次还是被试）。因此，将被混杂变量 $T$ 作为回归量纳入模型，在被试内和被试间设计中都是合适的调整方法，并且得到的调整后效应的估计量是相同的。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\beta (\\bar{T}_1 - \\bar{T}_0)  \\frac{S_{YC} S_{TT} - S_{YT} S_{CT}}{S_{CC} S_{TT} - S_{CT}^2} \\end{pmatrix}}\n$$"
        }
    ]
}