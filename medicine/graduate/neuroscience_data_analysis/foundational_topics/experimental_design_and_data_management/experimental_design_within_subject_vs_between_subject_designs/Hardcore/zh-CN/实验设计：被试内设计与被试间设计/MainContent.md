## 引言
在任何寻求建立因果关系的科学探索中，[实验设计](@entry_id:142447)都扮演着无可替代的基石角色。一个严谨的设计能够将信号从噪声中分离出来，使我们对现象的解释既可靠又具有说服力。在众多设计策略中，一个根本性的抉择摆在每位研究者面前：是采用**[被试间设计](@entry_id:1121530) (between-subject design)**，让不同的参与者体验不同的实验条件；还是采用**[被试内设计](@entry_id:902755) (within-subject design)**，让每位参与者经历所有实验条件？这个选择远非简单的程序性问题，它深刻地影响着研究的统计功效、资源成本、潜在的混淆因素以及最终结论的有效范围。

本文旨在系统性地阐明这两种基本设计的原理、优劣及其在复杂数据分析中的应用，特别是在神经科学领域。许多研究者可能直观地了解[被试内设计](@entry_id:902755)因“自我控制”而更高效，但其背后的统计机制、固有的实践挑战以及现代分析方法的选择，往往构成了知识上的缺口。本文致力于填补这一缺口，帮助读者从“知其然”迈向“知其所以然”。

在接下来的内容中，我们将分三步深入探索这一主题。首先，在“**原理与机制**”一章中，我们将借助[潜在结果框架](@entry_id:636884)，从第一性原理出发，剖析两种设计的统计学基础，量化其在[统计功效](@entry_id:197129)上的差异，并探讨[被试内设计](@entry_id:902755)必须面对的核心挑战——顺序效应及其应对策略。随后，在“**应用与跨学科连接**”一章中，我们将视野扩展到具体的科研场景，展示这些设计原则如何在[神经影像学](@entry_id:896120)、临床研究和高级统计建模（如[线性混合效应模型](@entry_id:917842)）中发挥关键作用，并讨论如何将推断范围从被试泛化到刺激。最后，“**动手实践**”部分将通过一系列问题导向的练习，巩固核心概念，培养读者在实际研究中应用这些知识解决问题的能力。通过这一结构化的学习路径，读者将能够更自信、更严谨地做出[实验设计](@entry_id:142447)决策，从而提升其研究的质量与影响力。

## 原理与机制

在实验科学中，比较不同条件下（例如，药物与安慰剂）的测量结果是推断因果关系的核心。选择正确的[实验设计](@entry_id:142447)是确保这些推断有效性的基石。两种最基本的[实验设计](@entry_id:142447)是**[被试间设计](@entry_id:1121530) (between-subject design)** 和 **[被试内设计](@entry_id:902755) (within-subject design)**，也被称为独立组设计和[重复测量](@entry_id:896842)设计。本章将深入探讨这两种设计的核心原理、统计机制、各自的优缺点以及在复杂[神经科学数据分析](@entry_id:1128665)中的应用。

### 基本定义：分析单元与因果推断

区分被试间和[被试内设计](@entry_id:902755)的根本在于**[随机化](@entry_id:198186)单元 (unit of randomization)** 的不同，这直接决定了我们如何构建因果推断的逻辑。我们可以借助**[潜在结果框架](@entry_id:636884) (potential outcomes framework)** 来精确地阐述这一区别 。

假设一个研究旨在比较两种条件（如药物和安慰剂）对受试者大脑信号（如BOLD响应）的影响。根据[潜在结果框架](@entry_id:636884)，对于每个受试者 $i$，都存在两个[潜在结果](@entry_id:753644)：$Y_i(1)$ 表示该受试者在接受药物条件下的测量结果，$Y_i(0)$ 表示其在接受安慰剂条件下的测量结果。因果效应的核心问题在于，我们永远无法在同一时刻同时观测到同一个体的这两个[潜在结果](@entry_id:753644)。[实验设计](@entry_id:142447)的目的就是通过巧妙的安排来估计它们的差异。

在**[被试间设计](@entry_id:1121530)**中，[随机化](@entry_id:198186)的基本单元是**受试者**。研究者将受试者随机分配到不同的组，每组只接受一种条件。例如，一组受试者接受药物，另一组接受安慰剂。对于任何受试者 $i$，我们只能观测到 $Y_i(1)​$ 或 $Y_i(0)​$ 中的一个。在这种设计中，我们通过比较两组受试者的平均反应来估计**[平均因果效应](@entry_id:920217) (Average Causal Effect, ACE)**，即 $E[Y(1) - Y(0)]$。其逻辑是，随机分配使得两组在所有其他特征上（平均而言）是可比的，因此两组平均结果的差异可以归因于实验条件的差异。这里的关键假设是，一个受试者的结果与其他任何受试者的结果都是**统计独立的** 。

相比之下，在**[被试内设计](@entry_id:902755)**中，每个受试者都会经历所有的实验条件。因此，[随机化](@entry_id:198186)的单元不再是受试者本身，而是**条件在受试者内部的呈现顺序**。例如，每个受试者都会在不同时间（如不同天）分别接受药物和安慰剂，而接受的顺序（先药物后安慰剂，还是先安慰剂后药物）是随机的。这种设计的美妙之处在于，对于每个受试者 $i$，我们（在忽略顺序效应等复杂因素的前提下）能够同时观测到近似于 $Y_i(1)​$ 和 $Y_i(0)​$ 的两个值。这使得我们能够计算每个受试者的**个体因果效应**的估计值，即差值分数 $D_i = Y_{i, \text{药物}} - Y_{i, \text{安慰剂}}$。通过对所有受试者的 $D_i$ 求平均，我们同样可以估计[平均因果效应](@entry_id:920217) $E[Y(1) - Y(0)]$。

这两种设计在统计假设上存在根本差异。[被试间设计](@entry_id:1121530)假设所有观测值（每个受试者一个）之间[相互独立](@entry_id:273670)。而[被试内设计](@entry_id:902755)中，来自同一受试者的多个观测值（例如 $Y_i(1)$ 和 $Y_i(0)$）是内在**相关的**或**非独立的**，因为它们共享同一个体的生物学和心理学背景。有效的统计分析必须明确地处理这种非独立性。然而，不同受试者之间的测量（或差值分数）仍然被假定为独立的 。

### 统计推论：方差与相关性

设计的选择直接影响着[统计模型](@entry_id:165873)的构建和最终的[统计效率](@entry_id:164796)。核心区别在于如何处理数据中的变异来源。

#### [独立性与相关性](@entry_id:266084)的建模

在[被试间设计](@entry_id:1121530)中，由于每个受试者只提供一个数据点，我们可以使用一个简单的[线性模型](@entry_id:178302)来描述数据，例如 $Y_i = \mu_{g(i)} + \epsilon_i$，其中 $g(i)$ 是受试者 $i$ 所属的组别，$\epsilon_i$ 是独立的误差项，假定其方差为 $\sigma^2$。分析方法通常是[双样本t检验](@entry_id:164898)或等效的[方差分析 (ANOVA)](@entry_id:262372)，其基础就是观测值之间的独立性假设 。

而在[被试内设计](@entry_id:902755)中，情况则更为复杂。来自同一受试者的重复测量是相关的。我们可以使用一个**[随机效应模型](@entry_id:914467) (random-effects model)** 来显式地表达这种相关性。一个简单的模型是**[随机截距模型](@entry_id:903767) (random-intercept model)**：
$Y_{ik} = \mu_k + b_i + \epsilon_{ik}$
其中，$Y_{ik}$ 是受试者 $i$ 在条件 $k$ 下的观测值，$\mu_k$ 是条件 $k$ 的固定效应（[总体均值](@entry_id:175446)），$b_i$ 是受试者 $i$ 特有的**[随机效应](@entry_id:915431)**或随机截距，代表该受试者相对于总体的固有偏差（例如，其大脑信号普遍偏高或偏低）。$b_i$ 通常假定服从均值为0，方差为 $\tau^2$ 的分布，$\tau^2$ 代表了**被试间的变异**。$\epsilon_{ik}$ 是与特定测量相关的随机误差，其方差为 $\sigma^2$，代表了**被试内的变异**。

在这个模型下，来自同一受试者 $i$ 的两个不同条件（如 A 和 B）下的观测值 $Y_{iA}$ 和 $Y_{iB}$ 的协方差为：
$\mathrm{Cov}(Y_{iA}, Y_{iB}) = \mathrm{Cov}(\mu_A + b_i + \epsilon_{iA}, \mu_B + b_i + \epsilon_{iB}) = \mathrm{Var}(b_i) = \tau^2$
由于受试者之间存在差异（即 $\tau^2 > 0$），这两个观测值是正相关的。这种由共享的随机效应 $b_i$ 引起的内生相关性，是分析[被试内设计](@entry_id:902755)数据时必须考虑的核心特征 。

#### [被试内设计](@entry_id:902755)的[方差缩减](@entry_id:145496)优势

[被试内设计](@entry_id:902755)的主要统计优势在于它能够有效“消除”由个体差异引起的变异，从而提高统计功效。我们可以通过分析差值分数的方差来理解这一点 。

令 $X_1$ 和 $X_2$ 分别代表一个受试者在两个条件下的测量结果。它们的方差分别为 $\sigma_1^2$ 和 $\sigma_2^2$，它们之间的相关系数为 $\rho$。差值分数 $D = X_1 - X_2$ 的方差是：
$\mathrm{Var}(D) = \mathrm{Var}(X_1 - X_2) = \mathrm{Var}(X_1) + \mathrm{Var}(X_2) - 2\mathrm{Cov}(X_1, X_2)$
代入相关系数的定义 $\mathrm{Cov}(X_1, X_2) = \rho\sigma_1\sigma_2$，我们得到：
$\mathrm{Var}(D) = \sigma_1^2 + \sigma_2^2 - 2\rho\sigma_1\sigma_2$

这个公式揭示了一个关键点：当两个测量值呈正相关时（即 $\rho > 0$），这个正相关项会减小差值分数的方差。在神经科学和心理学实验中，来自同一个体的重复测量几乎总是正相关的，因为稳定的个体特质会影响所有测量。

使用[随机截距模型](@entry_id:903767)的语言，差值分数为 $D_i = Y_{iB} - Y_{iA} = (\mu_B + b_i + \epsilon_{iB}) - (\mu_A + b_i + \epsilon_{iA}) = (\mu_B - \mu_A) + (\epsilon_{iB} - \epsilon_{iA})$。可以看到，代表被试间变异的随机效应 $b_i$ 在相减过程中被完全消除了！因此，差值分数的方差仅取决于被试内的误差项：$\mathrm{Var}(D_i) = \mathrm{Var}(\epsilon_{iB} - \epsilon_{iA}) = 2\sigma^2$ (在 $\mathrm{Var}(\epsilon_{ik}) = \sigma^2$ 的假设下) 。这[直接证明](@entry_id:141172)了[被试内设计](@entry_id:902755)如何通过“自我控制”来隔离和移除被试间的变异源 $\tau^2$，从而使得对条件差异 $(\mu_B - \mu_A)$ 的估计更加精确。

### 效率与功效：定量比较

现在我们可以定量地比较两种设计的[统计效率](@entry_id:164796)。效率通常通过比较估计同一参数所需的方差来衡量，方差越小，效率越高。

假设我们总共有 $N$ 个受试者。在[被试内设计](@entry_id:902755)中，我们使用全部 $N$ 个受试者，得到 $N$ 个差值分数 $D_i$。效应估计量 $\bar{D}$ 的方差为 $\mathrm{Var}(\bar{D}) = \frac{\mathrm{Var}(D)}{N}$。

在[被试间设计](@entry_id:1121530)中，我们将 $N$ 个受试者分成两组，每组 $N/2$ 人。效应估计量 $\bar{X}_1 - \bar{X}_2$ 的方差为 $\mathrm{Var}(\bar{X}_1 - \bar{X}_2) = \mathrm{Var}(\bar{X}_1) + \mathrm{Var}(\bar{X}_2) = \frac{\sigma_1^2}{N/2} + \frac{\sigma_2^2}{N/2} = \frac{2(\sigma_1^2 + \sigma_2^2)}{N}$。

我们定义两种设计[估计量方差](@entry_id:263211)的比值为[相对效率](@entry_id:165851) $E$ ：
$E = \frac{\mathrm{Var}(\text{被试间估计量})}{\mathrm{Var}(\text{被试内估计量})} = \frac{2(\sigma_1^2 + \sigma_2^2) / N}{(\sigma_1^2 + \sigma_2^2 - 2\rho\sigma_1\sigma_2) / N} = \frac{2(\sigma_1^2 + \sigma_2^2)}{\sigma_1^2 + \sigma_2^2 - 2\rho\sigma_1\sigma_2}$

为了更直观地理解，让我们考虑一个简化但常见的情形：两种条件下的方差相等，即 $\sigma_1^2 = \sigma_2^2 = \sigma^2$ 。在这种情况下，效应估计的[标准误](@entry_id:635378)（方差的平方根）之比为：
$\frac{\mathrm{SE}_{\text{被试内}}}{\mathrm{SE}_{\text{被试间}}} = \frac{\sqrt{2\sigma^2(1 - \rho)/n}}{\sqrt{2\sigma^2/n + 2\sigma^2/n}} = \frac{\sqrt{2\sigma^2(1 - \rho)/n}}{\sqrt{4\sigma^2/n}} = \sqrt{\frac{1-\rho}{2}}$
*注意：此处  的设置是每组n人，总共2n人，而此处为保持一致性，假设总[样本量](@entry_id:910360)固定。若按  的设定（被试内n人，被试间2n人），比值为 $\sqrt{1-\rho}$。*
无论具体设定如何，结论是相同的：只要 $\rho > 0$，[被试内设计](@entry_id:902755)的[标准误](@entry_id:635378)就更小，因此[统计效率](@entry_id:164796)更高。当 $\rho=0$ 时，两者效率相当。当 $\rho  0$ 时（非常罕见），[被试间设计](@entry_id:1121530)反而更优。这个简单的关系 $\rho > 0$ 就是[被试内设计](@entry_id:902755)效率优势的“盈亏平衡点” 。

更高的效率直接转化为更高的**[统计功效](@entry_id:197129) (statistical power)**，即在真实效应存在时能够成功检测到它的概率。统计功效由[检验统计量](@entry_id:897871)的非中心分布决定。对于[配对t检验](@entry_id:925256)（被试内）和[独立样本t检验](@entry_id:896293)（被试间），其功效均可由**非中心[t分布](@entry_id:267063)**的[累积分布函数](@entry_id:143135) $F_{\mathrm{nct}}(x; \nu, \delta)$ 精确计算 。功效主要取决于**非中心化参数 (noncentrality parameter, NCP)** $\delta$。
- 对于[配对t检验](@entry_id:925256)，$\delta_{\text{被试内}} = d_z \sqrt{n}$，其中 $d_z = \Delta / \sigma_D$ 是基于差值标准差的[效应量](@entry_id:907012)。
- 对于[独立样本t检验](@entry_id:896293)（每组n人），$\delta_{\text{被试间}} = d \sqrt{n/2}$，其中 $d = \Delta / \sigma$ 是基于原始标准差的效应量。

由于 $\sigma_D^2 = 2\sigma^2(1-\rho)$，我们可以建立两个[效应量](@entry_id:907012)之间的关系：$d_z = \Delta / \sqrt{2\sigma^2(1-\rho)} = d / \sqrt{2(1-\rho)}$。因此，$\delta_{\text{被试内}} = \frac{d}{\sqrt{2(1-\rho)}} \sqrt{n}$。比较两个NCP，可以看出当 $\rho > 0$ 时，$\delta_{\text{被试内}} > \delta_{\text{被试间}}$，这直接导致了更高的统计功效。

### [被试内设计](@entry_id:902755)的实践挑战：顺序效应

尽管[被试内设计](@entry_id:902755)在[统计效率](@entry_id:164796)上具有显著优势，但它也引入了独特的挑战，即**顺序效应 (order effects)**。当受试者依次经历多个条件时，一个条件下的表现可能会受到其在序列中所处位置的影响。这些效应主要分为三类 ：
1.  **学习效应 (Learning Effects)**：随着任务的重复，受试者可能变得更加熟练，导致表现提升（如反应时间缩短）。
2.  **疲劳效应 (Fatigue Effects)**：长时间的实验可能导致受试者疲劳或注意力下降，导致表现下降。
3.  **遗留效应 (Carryover Effects)**：前一个条件的效应可能会“遗留”下来，影响到紧随其后的下一个条件的表现。例如，一种长效药物的生理效应可能在切换到安慰剂条件时仍未完全消退。

学习和疲劳效应通常被认为是**与条件无关的**，它们是时间或顺序的[单调函数](@entry_id:145115)，表现为顺序的主效应。而遗留效应则是**与条件相关的**，其影响依赖于前一个条件的具体内容。

处理顺序效应的主要实验策略是**平衡化 (counterbalancing)**。在只有两种条件A和B的简单情况下，最常用的方法是 **AB/BA 平衡化**。一半的受试者遵循AB顺序，另一半遵循BA顺序。我们可以从数学上证明这种策略的有效性 。假设存在一个线性的顺序效应，即每次试验位置后移，测量值会增加一个固定的量 $\alpha$。
- 对于AB组，A在位置1，B在位置2。
- 对于BA组，A在位置2，B在位置1。
当我们计算所有A条件的平均值时，其期望位置是 $(1+2)/2 = 1.5$。同样，所有B条件的平均值，其期望位置也是 $(1+2)/2 = 1.5$。因为两个条件在顺序上的平均位置完全相同，线性的顺序效应在计算均值差异时被完美抵消了。更一般地，如果分配到AB组的比例为 $p$，则最终估计的偏差为 $\alpha(1-2p)$。只有当 $p=1/2$ 时，偏差才为零 。

然而，平衡化并不能消除所有问题。它主要用于防止顺序效应系统性地混淆条件的主效应。更复杂的[非线性](@entry_id:637147)顺序效应或不对称的遗留效应仍然可能存在。在现代[统计模型](@entry_id:165873)（如[线性混合效应模型](@entry_id:917842)）中，我们可以通过在模型中包含**条件×顺序交互项**来检验这些复杂的顺序效应。一个显著的[交互作用](@entry_id:164533)意味着随时间变化的趋势在不同条件下是不同的。但这本身也存在模糊性：它可能代表了**条件特异性的学习/疲劳**（例如，在某个条件下学习得更快），也可能源于**遗留效应**。要真正分离遗留效应，需要在模型中明确包含一个代表**前一条件**的预测变量，直接对从条件 $c_{t-1}$ 到 $c_t$ 的转换效应进行建模 。

### 重复测量分析的高级主题

当[被试内设计](@entry_id:902755)包含两个以上（$k > 2$）的条件时，数据分析变得更加复杂。传统的[配对t检验](@entry_id:925256)被**[重复测量方差分析](@entry_id:902778) (Repeated Measures [ANOVA](@entry_id:275547), RM-[ANOVA](@entry_id:275547))** 所取代。

#### 球形假设

RM-[ANOVA](@entry_id:275547)的标准[F检验](@entry_id:274297)依赖于一个关键假设，称为**球形假设 (sphericity assumption)**。非正式地说，球形假设要求所有可能的成对条件之差的方差都相等。也就是说，对于任意两个不同的条件 $i$ 和 $j$，$\mathrm{Var}(Y_i - Y_j)$ 都是一个常数 。

一个更精确的定义是几何上的：球形假设要求任何**对比 (contrast)** 的方差仅取决于[对比系数](@entry_id:914091)向量的长度，而与其方向无关。一个对比是响应的线性组合 $\sum a_i Y_i$，其中系数之和为零（$\sum a_i = 0$）。球形假设表明，$\mathrm{Var}(\mathbf{a}^\top \mathbf{Y}) = \phi \|\mathbf{a}\|_2^2$，其中 $\phi$ 是一个常数。对于成对差异 $Y_i - Y_j$，其对比向量为 $\mathbf{a} = \mathbf{e}_i - \mathbf{e}_j$，其范数的平方 $\|\mathbf{a}\|_2^2 = 1^2 + (-1)^2 = 2$。因此，其方差为 $2\phi$，这是一个与具体的 $i$ 和 $j$ 无关的常数，从而证明了该定义蕴含了“所有成对差值方差相等”的推论 。

一个满足球形假设的常见但非必需的特例是**复合对称性 (compound symmetry)**，即所有条件的方差都相等，且所有不同条件间的协方差也都相等。球形假设是一个比复合对称性更弱的要求。当球形假设不被满足时，RM-[ANOVA](@entry_id:275547)的[F检验](@entry_id:274297)会变得过于宽松（即I类错误率膨胀），需要进行校正（如Greenhouse-Geisser或[Huynh-Feldt校正](@entry_id:894282)）。

#### 现代方法：[混合效应模型](@entry_id:910731)与协方差结构

现代统计实践越来越倾向于使用**[线性混合效应模型](@entry_id:917842) (Linear Mixed-Effects Models, LMM)** 来分析[重复测量数据](@entry_id:907978)。LMM的优势在于其灵活性：它不要求球形假设，而是允许研究者为数据的**协方差结构 (covariance structure)** 指定一个明确的模型。

研究者需要根据理论和数据探索来选择合适的协方差结构。常见的选项包括 ：
- **复合对称 (CS)**：假设方差恒定，协方差也恒定。对应于简单的[随机截距模型](@entry_id:903767)。需要2个参数。
- **一阶自回归 (AR(1))**：假设方差恒定，但协方差随时间间隔的增加呈指数衰减。这对于等时间间隔的测量（如[时间序列数据](@entry_id:262935)）非常适用。需要2个参数。
- **非结构化 (UN)**：不施加任何约束，为每一对时间点的协方差（以及每个时间点的方差）都估计一个独立的参数。这提供了最佳的拟合度，但参数数量最多（对于 $T$ 个时间点，需要 $T(T+1)/2$ 个参数），容易导致[过拟合](@entry_id:139093)。

选择最佳模型的原则是在拟合优度和[模型简约性](@entry_id:1128045)之间取得平衡。**[赤池信息准则](@entry_id:139671) (Akaike Information Criterion, AIC)** 和 **贝叶斯信息准则 (Bayesian Information Criterion, BIC)** 是常用的工具，它们都对模型的对数似然（拟合优度）和参数数量（复杂性）进行惩罚，值越小表示模型越优。此外，对于**[嵌套模型](@entry_id:635829)**（即一个模型是另一个模型的特例，如CS和UN），可以使用**[似然比检验](@entry_id:1127231) (Likelihood Ratio Test, LRT)** 来判断复杂模型相对于简单模型的显著提升是否值得增加参数。例如，AR(1) 和 CS 都是 UN 的[嵌套模型](@entry_id:635829)，但它们彼此之间是非嵌套的，因此不能用LRT直接比较 。

### 框架的扩展：混合设计

最后，我们可以将这两种基本设计结合起来，形成**混合设计 (mixed design)**，它同时包含被试内和被试间两种因子。这是一个在神经科学研究中极为常见和强大的设计。

一个典型的例子是一个 $2 \times 2$ 的混合设计：一个被试[内因子](@entry_id:148039)“任务”（A vs. B）和一个被试间因子“组别”（病人 vs. 对照组）。在这种设计中，研究者通常最关心的是**交互效应 (interaction effect)**。[交互效应](@entry_id:164533)旨在回答：组别是否调节了任务的影响？换句话说，从任务A到任务B的神经活动变化，在病人组和对照组中是否有所不同？

这个交互效应可以通过一个特定的**对比**来精确量化。令 $\mu_{pA}, \mu_{pB}, \mu_{cA}, \mu_{cB}$ 分别代表病人组/任务A、病人组/任务B、对照组/任务A、[对照组](@entry_id:747837)/任务B的[总体均值](@entry_id:175446)。[交互作用](@entry_id:164533)对比 $L$ 就是“差异的差异”：
$L = (\mu_{pB} - \mu_{pA}) - (\mu_{cB} - \mu_{cA})$

这个公式的含义是：我们首先分别计算病人组和[对照组](@entry_id:747837)内部的任务效应（$B-A$ 的变化），然后比较这两个任务效应的差异。如果 $L > 0$，则意味着从任务A到B的变化在病人组中比在对照组中更大。检验 $L$ 是否显著不为零，就等同于检验是否存在显著的组别×任务交互作用 。这种设计巧妙地结合了两种基本设计的优点，既能利用[被试内设计](@entry_id:902755)的高效率来精确测量任务效应，又能利用[被试间设计](@entry_id:1121530)来比较不同群体之间的差异。