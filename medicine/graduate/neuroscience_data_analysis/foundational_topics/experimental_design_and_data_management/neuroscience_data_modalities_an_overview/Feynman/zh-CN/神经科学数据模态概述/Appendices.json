{
    "hands_on_practices": [
        {
            "introduction": "在分析神经信号时，一个基本但至关重要的步骤是选择参考方案，因为它深刻地影响着我们对大脑活动的解读。此练习  将探讨不同的参考方法（如共同平均参考和双极参考）如何充当空间滤波器，并改变通道间功能连接的度量（如相干性）。通过这个计算实践，您将具体理解选择参考方案并非只是一个技术细节，而是一个影响分析结果的关键决策。",
            "id": "4181539",
            "problem": "一个研究团队正在分析从一个由 $M=5$ 个电极组成的线性阵列中以固定频率 $f_0$ 记录的皮层脑电图 (ECoG) 信号。设原始零均值信号为 $x_i(t)$，$i \\in \\{1,2,3,4,5\\}$，其被建模为一个平稳多元过程，在频率 $f_0$ 处的交叉谱密度矩阵是具有以下元素的对称 Toeplitz 矩阵：\n$$\nS_{ij}(f_0) \\equiv S_{ij} = s \\exp\\!\\big(-|i-j|\\big) + n \\,\\delta_{ij},\n$$\n其中 $s>0$ 捕获空间相关场，$n>0$ 捕获独立通道噪声。假设 $s=1$ 且 $n=0.2$。\n\n考虑两种空间线性滤波参考方案：\n- 共同平均参考 (CAR)：$y = R_{\\mathrm{CAR}} x$，其中 $R_{\\mathrm{CAR}} = I - \\frac{1}{M} \\mathbf{1}\\mathbf{1}^{\\top}$，$\\mathbf{1}$ 是 $M \\times 1$ 的全一向量，$I$ 是 $M \\times M$ 的单位矩阵。CAR 参考后的信号为 $y_i(t)$。\n- 相邻电极间的双极参考：定义 $b_k(t) = x_k(t) - x_{k+1}(t)$，其中 $k \\in \\{1,2,3,4\\}$，将它们收集成 $b = R_{\\mathrm{BIP}} x$，其中 $R_{\\mathrm{BIP}}$ 是沿阵列的 $(M-1)\\times M$ 一阶差分算子。\n\n仅从线性滤波和谱密度的定义，以及两个零均值平稳过程 $u(t)$ 和 $v(t)$ 在频率 $f_0$ 处的幅值平方相干性定义出发：\n$$\nC(u,v; f_0) = \\frac{|S_{uv}(f_0)|^2}{S_{uu}(f_0)\\,S_{vv}(f_0)},\n$$\n推导两种参考方案对交叉谱密度的空间滤波作用，并计算 $y_2(t)$ 和 $y_3(t)$ 之间的幅值平方相干性（记为 $C_{\\mathrm{CAR}}$）以及 $b_2(t)$ 和 $b_3(t)$ 之间的幅值平方相干性（记为 $C_{\\mathrm{BIP}}$）。然后，通过计算比率来量化参考方法对相干性的影响：\n$$\n\\rho = \\frac{C_{\\mathrm{CAR}}}{C_{\\mathrm{BIP}}}.\n$$\n使用 $s=1$，$n=0.2$，以及上述模型所暗示的空间相关项 $\\exp(-1)$、$\\exp(-2)$、$\\exp(-3)$、$\\exp(-4)$。将 $\\rho$ 的最终数值四舍五入到四位有效数字。将答案表示为无量纲小数。",
            "solution": "该问题要求分析两种不同的空间参考方案——共同平均参考 (CAR) 和双极参考——如何影响成对皮层脑电图 (ECoG) 通道之间的幅值平方相干性。我们必须从第一性原理出发，计算应用每种方案后相干性的比率。\n\n线性空间滤波器下交叉谱密度变换的基本原理如下。设 $x(t)$ 是一个由 $M$ 个零均值平稳时间序列组成的向量，其交叉谱密度矩阵为 $S_x(f)$。如果通过线性变换 $y(t) = R x(t)$ 得到一组新的时间序列 $y(t)$，其中 $R$ 是一个变换矩阵，则其交叉谱密度矩阵 $S_y(f)$ 由下式给出：\n$$S_y(f) = R S_x(f) R^{\\dagger}$$\n其中 $R^{\\dagger}$ 是 $R$ 的共轭转置。由于本问题中的参考矩阵是实数矩阵，因此这可以简化为 $S_y(f) = R S_x(f) R^{\\top}$。所有计算都在固定频率 $f_0$ 下进行，因此为简洁起见，我们将省略参数 $f_0$，写作 $S_{ij}$ 而非 $S_{ij}(f_0)$。\n\n首先，我们为原始信号 $x_i(t)$ 构建 $M \\times M$ 的输入交叉谱密度矩阵 $S_x$。\n问题陈述 $M=5$，矩阵元素为 $S_{ij} = s \\exp(-|i-j|) + n \\delta_{ij}$，参数值为 $s=1$ 和 $n=0.2$。因此，矩阵 $S_x$ 是一个 $5 \\times 5$ 的对称 Toeplitz 矩阵：\n$$S_x = \\begin{pmatrix}\n1+n  s e^{-1}  s e^{-2}  s e^{-3}  s e^{-4} \\\\\ns e^{-1}  1+n  s e^{-1}  s e^{-2}  s e^{-3} \\\\\ns e^{-2}  s e^{-1}  1+n  s e^{-1}  s e^{-2} \\\\\ns e^{-3}  s e^{-2}  s e^{-1}  1+n  s e^{-1} \\\\\ns e^{-4}  s e^{-3}  s e^{-2}  s e^{-1}  1+n\n\\end{pmatrix}$$\n代入 $s=1$ 和 $n=0.2$：\n$$S_x = \\begin{pmatrix}\n1.2  e^{-1}  e^{-2}  e^{-3}  e^{-4} \\\\\ne^{-1}  1.2  e^{-1}  e^{-2}  e^{-3} \\\\\ne^{-2}  e^{-1}  1.2  e^{-1}  e^{-2} \\\\\ne^{-3}  e^{-2}  e^{-1}  1.2  e^{-1} \\\\\ne^{-4}  e^{-3}  e^{-2}  e^{-1}  1.2\n\\end{pmatrix}$$\n\n我们需要为这两种参考方案计算幅值平方相干性 $C(u,v) = \\frac{|S_{uv}|^2}{S_{uu} S_{vv}}$。\n\n**1. 共同平均参考 (CAR)**\n\nCAR 变换由 $y = R_{\\mathrm{CAR}} x$ 给出，其中 $R_{\\mathrm{CAR}} = I - \\frac{1}{M} \\mathbf{1}\\mathbf{1}^{\\top}$。该矩阵是对称的，因此 $R_{\\mathrm{CAR}}^{\\top} = R_{\\mathrm{CAR}}$。CAR 参考后信号 $y_i(t)$ 的交叉谱矩阵为 $S_y = R_{\\mathrm{CAR}} S_x R_{\\mathrm{CAR}}$。\n该矩阵的元素 $(S_y)_{ij}$ 可表示为：\n$$(S_y)_{ij} = (S_x)_{ij} - \\frac{1}{M} \\sum_{k=1}^{M} (S_x)_{ik} - \\frac{1}{M} \\sum_{k=1}^{M} (S_x)_{kj} + \\frac{1}{M^2} \\sum_{k=1}^{M}\\sum_{l=1}^{M} (S_x)_{kl}$$\n设 $R_i = \\sum_{k=1}^{M}(S_x)_{ik}$ 为 $S_x$ 第 $i$ 行的和，而 $T = \\sum_{i,j} (S_x)_{ij}$ 为所有元素的和。由于 $S_x$ 是对称的，第 $j$ 列的和等于第 $j$ 行的和，即 $R_j$。公式变为：\n$$(S_y)_{ij} = (S_x)_{ij} - \\frac{R_i}{M} - \\frac{R_j}{M} + \\frac{T}{M^2}$$\n我们需要计算 $C_{\\mathrm{CAR}} = \\frac{|(S_y)_{23}|^2}{(S_y)_{22}(S_y)_{33}}$。这需要计算 $M=5$ 时 $S_x$ 的行和。设 $c_k = \\exp(-k)$。\n$R_1 = (1.2 + c_1 + c_2 + c_3 + c_4)$\n$R_2 = (c_1 + 1.2 + c_1 + c_2 + c_3) = 1.2 + 2c_1 + c_2 + c_3$\n$R_3 = (c_2 + c_1 + 1.2 + c_1 + c_2) = 1.2 + 2c_1 + 2c_2$\n根据对称性，$R_4 = R_2$ 且 $R_5 = R_1$。\n总和为 $T = 2R_1 + 2R_2 + R_3$。\n\n使用近似值 $c_1 \\approx 0.367879$，$c_2 \\approx 0.135335$，$c_3 \\approx 0.049787$，$c_4 \\approx 0.018316$：\n$R_1 \\approx 1.2 + 0.367879 + 0.135335 + 0.049787 + 0.018316 = 1.771317$\n$R_2 \\approx 1.2 + 2(0.367879) + 0.135335 + 0.049787 = 2.120880$\n$R_3 \\approx 1.2 + 2(0.367879) + 2(0.135335) = 2.206429$\n$T \\approx 2(1.771317) + 2(2.120880) + 2.206429 = 9.990822$\n而 $\\frac{T}{M^2} = \\frac{T}{25} \\approx 0.399633$。\n\n现在我们计算 $S_y$ 所需的元素：\n$(S_y)_{22} = (S_x)_{22} - \\frac{2R_2}{M} + \\frac{T}{M^2} \\approx 1.2 - \\frac{2(2.120880)}{5} + 0.399633 = 1.2 - 0.848352 + 0.399633 = 0.751281$\n$(S_y)_{33} = (S_x)_{33} - \\frac{2R_3}{M} + \\frac{T}{M^2} \\approx 1.2 - \\frac{2(2.206429)}{5} + 0.399633 = 1.2 - 0.882572 + 0.399633 = 0.717061$\n$(S_y)_{23} = (S_x)_{23} - \\frac{R_2+R_3}{M} + \\frac{T}{M^2} \\approx c_1 - \\frac{2.120880+2.206429}{5} + 0.399633 = 0.367879 - 0.865462 + 0.399633 = -0.097950$\n\n那么相干性为：\n$$C_{\\mathrm{CAR}} = \\frac{(-0.097950)^2}{(0.751281)(0.717061)} \\approx \\frac{0.0095942}{0.538722} \\approx 0.017809$$\n\n**2. 双极参考**\n\n双极信号为 $b_k(t) = x_k(t) - x_{k+1}(t)$，其中 $k \\in \\{1,2,3,4\\}$。我们需要 $b_2(t) = x_2(t) - x_3(t)$ 和 $b_3(t) = x_3(t) - x_4(t)$ 之间的相干性。交叉谱密度通过线性组合推导得出：\n$S_{b_i b_j} = \\mathbb{E}[\\tilde{b}_i(f) \\tilde{b}_j(f)^*]$。对于 $i=2, j=2$：\n$S_{b_2 b_2} = S_{(x_2-x_3)(x_2-x_3)} = S_{22} - S_{23} - S_{32} + S_{33}$。由于 $S_x$ 是实对称矩阵，所以 $S_{23}=S_{32}$。\n$S_{b_2 b_2} = S_{22} + S_{33} - 2S_{23} = 1.2 + 1.2 - 2 e^{-1} = 2.4 - 2e^{-1}$。\n对于 $i=3, j=3$：\n$S_{b_3 b_3} = S_{(x_3-x_4)(x_3-x_4)} = S_{33} + S_{44} - 2S_{34}$。根据 Toeplitz 属性，$S_{33}=S_{44}=1.2$ 且 $S_{34}=e^{-1}$。\n$S_{b_3 b_3} = 1.2 + 1.2 - 2 e^{-1} = 2.4 - 2e^{-1}$。\n因此，$S_{b_2 b_2} = S_{b_3 b_3}$。\n\n交叉项是：\n$S_{b_2 b_3} = S_{(x_2-x_3)(x_3-x_4)} = S_{23} - S_{24} - S_{33} + S_{34}$。\n使用 $S_x$ 的元素：\n$S_{b_2 b_3} = e^{-1} - e^{-2} - 1.2 + e^{-1} = 2e^{-1} - e^{-2} - 1.2$。\n\n现在，我们代入数值：\n$S_{b_2 b_2} = S_{b_3 b_3} \\approx 2.4 - 2(0.367879) = 1.664242$。\n$S_{b_2 b_3} \\approx 2(0.367879) - 0.135335 - 1.2 = 0.735758 - 0.135335 - 1.2 = -0.599577$。\n\n双极相干性为：\n$$C_{\\mathrm{BIP}} = \\frac{|S_{b_2 b_3}|^2}{S_{b_2 b_2} S_{b_3 b_3}} = \\frac{(S_{b_2 b_3})^2}{(S_{b_2 b_2})^2} \\approx \\frac{(-0.599577)^2}{(1.664242)^2} \\approx \\frac{0.359493}{2.769696} \\approx 0.129795$$\n\n**3. 相干性比率**\n\n最后，我们计算比率 $\\rho = \\frac{C_{\\mathrm{CAR}}}{C_{\\mathrm{BIP}}}$。\n$$\\rho \\approx \\frac{0.017809}{0.129795} \\approx 0.137209$$\n四舍五入到四位有效数字，我们得到 $0.1372$。这个结果量化了两种参考方案对测量的通道间相干性的相对影响。在这个特定场景中，CAR 比双极参考更显著地降低了相干性。",
            "answer": "$$\\boxed{0.1372}$$"
        },
        {
            "introduction": "从连续的神经信号中准确识别离散的神经元放电事件（即“锋电位”），是许多电生理学研究的核心。锋电位分类算法旨在完成此任务，但我们如何验证其输出的可靠性呢？本练习  介绍了一种使用光遗传学标记获得的“金标准”数据来评估算法性能的框架，并应用精确率和召回率等基本分类指标。这使您能够亲手实践如何量化算法的准确性，并理解在设定决策阈值时所涉及的权衡。",
            "id": "4181531",
            "problem": "您正在分析一种通过光遗传学标记（optotagging）提供配对基准真相的模态下的神经元脉冲数据。对于由脉冲分类算法产生的每个候选脉冲，您都有一个置信度分数和一个二元配对标签，该标签指示此候选脉冲是否与一个基准真相标记事件相匹配。一个决策阈值决定了一个候选脉冲是否被接受为属于被标记的神经元。\n\n基本原理：在二元决策分析中，对于任何阈值 $\\tau \\in [0,1]$，一个分数为 $s_i \\in [0,1]$ 的事件，如果 $s_i \\ge \\tau$，则被分类为预测为正，否则分类为预测为负。使用基准真相标签 $g_i \\in \\{0,1\\}$，在阈值 $\\tau$ 下的混淆计数根据第一性原理定义如下：真阳性是一个预测为正且 $g_i = 1$ 的事件，假阳性是一个预测为正且 $g_i = 0$ 的事件，假阴性是一个预测为负且 $g_i = 1$ 的事件。令 $TP(\\tau)$、$FP(\\tau)$ 和 $FN(\\tau)$ 分别表示这些计数。使用从这些计数导出的标准定义，为下面的每个测试用例计算精确率、召回率和错误发现率。所有指标都必须表示为无单位的小数。\n\n必须应用边界约定以确保在边界情况下的输出是明确定义的：如果 $TP(\\tau)+FP(\\tau)=0$，则将精确率定义为 $1$，错误发现率定义为 $0$；如果 $TP(\\tau)+FN(\\tau)=0$，则将召回率定义为 $1$。\n\n输入规范：每个测试用例提供一个分数列表 $[s_1,\\dots,s_n]$、一个配对的基准真相标签列表 $[g_1,\\dots,g_n]$ 和一个阈值 $\\tau$。假设配对已经使用适用于光遗传学标记的时间窗匹配方法执行并验证；您只需使用所提供的标签 $g_i$。\n\n任务：对于每个测试用例，严格根据上述基本原理，计算在给定阈值 $\\tau$ 下的精确率、召回率和错误发现率。\n\n测试套件：\n- 用例 A（混合基准真相，中等阈值）：分数 $[0.9,0.8,0.1,0.4,0.6,0.3,0.95,0.2]$，标签 $[1,1,0,1,0,0,1,0]$，阈值 $\\tau=0.5$。\n- 用例 B（相同数据，最低阈值）：分数 $[0.9,0.8,0.1,0.4,0.6,0.3,0.95,0.2]$，标签 $[1,1,0,1,0,0,1,0]$，阈值 $\\tau=0.0$。\n- 用例 C（相同数据，无脉冲被接受的最高阈值）：分数 $[0.9,0.8,0.1,0.4,0.6,0.3,0.95,0.2]$，标签 $[1,1,0,1,0,0,1,0]$，阈值 $\\tau=1.0$。\n- 用例 D（无基准真相阳性样本）：分数 $[0.7,0.2,0.9]$，标签 $[0,0,0]$，阈值 $\\tau=0.8$。\n- 用例 E（全为基准真相阳性样本，且有分数与阈值相等）：分数 $[0.51,0.49,0.5]$，标签 $[1,1,1]$，阈值 $\\tau=0.5$。\n- 用例 F（相同的混合数据，更严格的阈值）：分数 $[0.9,0.8,0.1,0.4,0.6,0.3,0.95,0.2]$，标签 $[1,1,0,1,0,0,1,0]$，阈值 $\\tau=0.7$。\n\n输出规范：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例贡献一个子列表，其顺序为在其指定阈值下计算的 $\\left[\\text{精确率},\\text{召回率},\\text{错误发现率}\\right]$。例如，输出格式必须类似于 $[[p_A,r_A,f_A],[p_B,r_B,f_B],\\dots]$，其中每个 $p_X$、$r_X$ 和 $f_X$ 都是四舍五入到六位小数的十进制数。",
            "solution": "所提出的问题是在神经科学的一个特定现实场景中应用二元分类分析基本原理的一个有效且定义明确的练习：使用光遗传学标记的基准真相来验证脉冲分类结果。问题陈述提供了所有必要的数据、混淆矩阵计数的明确定义，以及处理性能指标中分母为零的边界情况的清晰约定。任务是为几个测试用例计算精确率、召回率和错误发现率。\n\n我们首先将所提供的定义形式化。假设有 $n$ 个候选脉冲事件。对于每个事件 $i \\in \\{1, \\dots, n\\}$，我们给定一个置信度分数 $s_i \\in [0, 1]$ 和一个二元基准真相标签 $g_i \\in \\{0, 1\\}$，其中 $g_i=1$ 表示来自被标记神经元的真实脉冲，而 $g_i=0$ 表示非真实脉冲。\n\n给定一个决策阈值 $\\tau \\in [0, 1]$，如果一个候选脉冲的分数 $s_i$ 满足 $s_i \\ge \\tau$，则它被分类为“预测为正”。否则，它被分类为“预测为负”。\n\n根据这些预测和基准真相标签，我们可以计算在给定阈值 $\\tau$ 下的混淆计数：\n-   真阳性（True Positives, $TP(\\tau)$）：$s_i \\ge \\tau$ 且 $g_i=1$ 的事件数量。\n-   假阳性（False Positives, $FP(\\tau)$）：$s_i \\ge \\tau$ 且 $g_i=0$ 的事件数量。\n-   假阴性（False Negatives, $FN(\\tau)$）：$s_i  \\tau$ 且 $g_i=1$ 的事件数量。\n\n被分类为正例的总事件数是 $TP(\\tau) + FP(\\tau)$。数据集中实际正例的总数是 $P = TP(\\tau) + FN(\\tau)$，这个数量与阈值 $\\tau$ 无关。\n\n使用这些计数，所需指标的标准定义是：\n-   **精确率 (Precision)**：$\\text{Precision}(\\tau) = \\frac{TP(\\tau)}{TP(\\tau) + FP(\\tau)}$\n-   **召回率 (Recall)**（也称为真阳性率或灵敏度）：$\\text{Recall}(\\tau) = \\frac{TP(\\tau)}{TP(\\tau) + FN(\\tau)} = \\frac{TP(\\tau)}{P}$\n-   **错误发现率 (False Discovery Rate)**：$\\text{FDR}(\\tau) = \\frac{FP(\\tau)}{TP(\\tau) + FP(\\tau)}$\n\n该问题指定了处理分母为零的边界情况的约定：\n1.  如果 $TP(\\tau) + FP(\\tau) = 0$，则 $\\text{Precision}(\\tau)$ 定义为 $1$，$\\text{FDR}(\\tau)$ 定义为 $0$。这种情况发生在阈值 $\\tau$ 下没有脉冲被接受时。\n2.  如果 $TP(\\tau) + FN(\\tau) = 0$，则 $\\text{Recall}(\\tau)$ 定义为 $1$。这种情况发生在数据集中没有基准真相阳性事件时。\n\n现在我们将这些原理应用于每个测试用例。\n\n**用例 A**：`scores = [0.9, 0.8, 0.1, 0.4, 0.6, 0.3, 0.95, 0.2]`，`labels = [1, 1, 0, 1, 0, 0, 1, 0]`，$\\tau=0.5$。\n-   $s_i \\ge 0.5$ 的事件：分数为 $0.9, 0.8, 0.6, 0.95$。\n-   对应的标签：$1, 1, 0, 1$。\n-   $TP(0.5) = 3$（来自得分 $0.9, 0.8, 0.95$）。\n-   $FP(0.5) = 1$（来自得分 $0.6$）。\n-   $s_i  0.5$ 的事件：分数为 $0.1, 0.4, 0.3, 0.2$。\n-   对应的标签：$0, 1, 0, 0$。\n-   $FN(0.5) = 1$（来自得分 $0.4$）。\n-   $\\text{精确率} = \\frac{3}{3+1} = 0.75$。\n-   $\\text{召回率} = \\frac{3}{3+1} = 0.75$。\n-   $\\text{错误发现率} = \\frac{1}{3+1} = 0.25$。\n\n**用例 B**：相同数据，$\\tau=0.0$。\n-   $s_i \\ge 0.0$ 的事件：所有 $8$ 个事件。\n-   对应的标签：$1, 1, 0, 1, 0, 0, 1, 0$。\n-   $TP(0.0) = 4$。\n-   $FP(0.0) = 4$。\n-   $s_i  0.0$ 的事件：无。\n-   $FN(0.0) = 0$。\n-   $\\text{精确率} = \\frac{4}{4+4} = 0.5$。\n-   $\\text{召回率} = \\frac{4}{4+0} = 1.0$。\n-   $\\text{错误发现率} = \\frac{4}{4+4} = 0.5$。\n\n**用例 C**：相同数据，$\\tau=1.0$。\n-   $s_i \\ge 1.0$ 的事件：无。\n-   $TP(1.0) = 0$。\n-   $FP(1.0) = 0$。\n-   分母 $TP+FP = 0$，因此我们使用边界约定。\n-   $\\text{精确率} = 1.0$。\n-   $\\text{错误发现率} = 0.0$。\n-   $s_i  1.0$ 的事件：所有 $8$ 个事件。\n-   实际阳性样本总数为 $4$。所有都被漏掉了。\n-   $FN(1.0) = 4$。\n-   $\\text{召回率} = \\frac{TP}{TP+FN} = \\frac{0}{0+4} = 0.0$。\n\n**用例 D**：`scores = [0.7, 0.2, 0.9]`，`labels = [0, 0, 0]`，$\\tau=0.8$。\n-   $s_i \\ge 0.8$ 的事件：分数为 $0.9$。\n-   对应的标签：$0$。\n-   $TP(0.8) = 0$。\n-   $FP(0.8) = 1$。\n-   $\\text{精确率} = \\frac{0}{0+1} = 0.0$。\n-   $\\text{错误发现率} = \\frac{1}{0+1} = 1.0$。\n-   数据中没有基准真相阳性样本，因此无论 $\\tau$ 为何值，$TP+FN=0$。\n-   这是召回率的边界情况。$\\text{召回率} = 1.0$。\n\n**用例 E**：`scores = [0.51, 0.49, 0.5]`，`labels = [1, 1, 1]`，$\\tau=0.5$。\n-   $s_i \\ge 0.5$ 的事件：分数为 $0.51, 0.5$。\n-   对应的标签：$1, 1$。\n-   $TP(0.5) = 2$。\n-   $FP(0.5) = 0$。\n-   $\\text{精确率} = \\frac{2}{2+0} = 1.0$。\n-   $\\text{错误发现率} = \\frac{0}{2+0} = 0.0$。\n-   $s_i  0.5$ 的事件：分数为 $0.49$。\n-   对应的标签：$1$。\n-   $FN(0.5) = 1$。\n-   实际阳性样本总数为 $3$。\n-   $\\text{召回率} = \\frac{2}{2+1} = \\frac{2}{3} \\approx 0.666667$。\n\n**用例 F**：与用例 A 相同的数据，$\\tau=0.7$。\n-   `scores = [0.9, 0.8, 0.1, 0.4, 0.6, 0.3, 0.95, 0.2]`，`labels = [1, 1, 0, 1, 0, 0, 1, 0]`。\n-   $s_i \\ge 0.7$ 的事件：分数为 $0.9, 0.8, 0.95$。\n-   对应的标签：$1, 1, 1$。\n-   $TP(0.7) = 3$。\n-   $FP(0.7) = 0$。\n-   $\\text{精确率} = \\frac{3}{3+0} = 1.0$。\n-   $\\text{错误发现率} = \\frac{0}{3+0} = 0.0$。\n-   实际阳性样本总数为 $4$。\n-   $FN(0.7) = (\\text{阳性样本总数}) - TP(0.7) = 4 - 3 = 1$。被漏掉的阳性样本分数为 $0.4$。\n-   $\\text{召回率} = \\frac{3}{3+1} = \\frac{3}{4} = 0.75$。\n\n这些计算将在最终程序中实现。",
            "answer": "[[0.750000,0.750000,0.250000],[0.500000,1.000000,0.500000],[1.000000,0.000000,0.000000],[0.000000,1.000000,1.000000],[1.000000,0.666667,0.000000],[1.000000,0.750000,0.000000]]"
        },
        {
            "introduction": "将功能性神经活动与大脑的解剖结构联系起来，是神经科学研究的最终目标之一。这通常需要将来自个体被试的数据映射到一个标准的解剖图谱中。此练习  模拟了这一过程，要求您将一个已配准的脑磁图（MEG）源定位映射到一个简化的球形大脑图谱上，并使用信息熵来量化定位的不确定性。通过这项实践，您将学会如何以一种系统性的方式处理源定位中的内在不确定性，从而超越简单的“赢家通吃”式指派，获得更细致的概率性理解。",
            "id": "4181504",
            "problem": "一名研究人员正在分析不同被试的脑磁图（MEG）皮层源估计。皮层表面被建模为嵌入三维空间中的光滑二维流形。基于表面的配准过程通过将每个被试的皮层表面映射到单位球面上，并建立一种试图保留从脑沟和脑回模式派生出的测地邻域的对应关系来进行。这种策略改善了皮层信号的跨被试对齐，因为皮层源主要沿着折叠的皮层薄片分布；基于体积的对齐不尊重皮层薄片的几何形状，并且会混合跨越皮层厚度和在拓扑上相距甚远的邻近脑回的信号。相比之下，球面配准可以对齐折叠模式，并建立一种顶点到顶点的映射，从而更好地保留跨被试的皮层信号特征的局部性。\n\n您必须设计并实现一个计算流程，将 MEG 源映射到模板球面的一组标准皮层分区上，并产生不确定性估计。该设计必须基于神经科学数据分析背景下的一个有效基础：光滑流形、测地距离、作为简单配准模型的球面上刚性旋转，以及在切平面中的高斯不确定性建模。\n\n假设以下基础定义和事实：\n\n- 单位球面为 $\\mathbb{S}^2 = \\{ \\mathbf{x} \\in \\mathbb{R}^3 \\mid \\| \\mathbf{x} \\|_2 = 1 \\}$。\n- 被试球面与模板球面之间的刚性球面配准由一个旋转矩阵 $R \\in \\mathrm{SO}(3)$ 近似，其中 $\\mathrm{SO}(3) = \\{ R \\in \\mathbb{R}^{3 \\times 3} \\mid R^\\top R = I, \\det(R) = 1 \\}$。\n- 在 $\\mathbb{S}^2$ 上，两点 $\\mathbf{x}, \\mathbf{y} \\in \\mathbb{S}^2$ 之间的测地距离为 $d(\\mathbf{x}, \\mathbf{y}) = \\arccos(\\mathbf{x}^\\top \\mathbf{y})$，以弧度表示。\n- 皮层表面的一个局部化 MEG 源，在经过被试到模板的配准后，可以由模板球面上的一个单位向量 $\\mathbf{t} \\in \\mathbb{S}^2$ 表示。定位不确定性在小角度情况下被近似为局部切平面中的各向同性高斯噪声，其方差为 $\\sigma^2$（单位为弧度的平方）。在小角度近似下，源属于质心为 $\\mathbf{c}_i \\in \\mathbb{S}^2$ 的分区 $i$ 的概率通过基于测地距离的高斯径向基函数建模：\n$$\nw_i = a_i \\exp\\left( -\\frac{d(\\mathbf{t}, \\mathbf{c}_i)^2}{2 \\sigma^2} \\right),\n\\quad\np_i = \\frac{w_i}{\\sum_{j=1}^P w_j},\n$$\n其中 $a_i  0$ 是一个分区面积权重，$P$ 是分区数量。\n- 不确定性由 Shannon 熵量化：\n$$\nH(\\mathbf{p}) = -\\sum_{i=1}^P p_i \\log(p_i),\n$$\n使用自然对数。\n\n您的程序必须实现以下流程：\n\n1. 给定一个被试源方向 $\\mathbf{s} \\in \\mathbb{S}^2$ 和一个旋转 $R \\in \\mathrm{SO}(3)$，计算模板源方向 $\\mathbf{t} = R \\mathbf{s}$ 并重新归一化为单位长度，以防止数值漂移。\n2. 给定分区质心 $\\{ \\mathbf{c}_i \\}_{i=1}^P \\subset \\mathbb{S}^2$ 和分区面积权重 $\\{ a_i \\}_{i=1}^P$，计算测地距离 $d_i = d(\\mathbf{t}, \\mathbf{c}_i)$，单位为弧度。\n3. 根据上述高斯径向基模型计算未归一化的权重 $w_i$ 和归一化的概率 $p_i$。\n4. 返回顶部分区标签 $L = \\arg\\max_i p_i$、置信度 $c = \\max_i p_i$ 和熵 $H(\\mathbf{p})$。\n\n角度量必须以弧度为单位。所有输出数值必须以浮点数计算，不得有舍入指令。分区在模板球面上由其质心定义，并具有相等的面积权重 $a_i = 1$。\n\n使用以下固定的模板分区（$P = 4$），其质心和标签如下：\n\n- 分区 $0$：质心 $\\mathbf{c}_0 = (0, 0, 1)$（北极点）。\n- 分区 $1$：质心 $\\mathbf{c}_1 = (0, 0, -1)$（南极点）。\n- 分区 $2$：质心 $\\mathbf{c}_2 = (1, 0, 0)$（东赤道点）。\n- 分区 $3$：质心 $\\mathbf{c}_3 = (-1, 0, 0)$（西赤道点）。\n\n设计一个包含 $4$ 个案例的测试套件来检验该流程，使用以下参数：\n\n- 案例 1（正常路径，源准确定位于分区 2 附近）：\n    - 旋转 $R = I$（单位矩阵）。\n    - 被试源 $\\mathbf{s} = (1, 0, 0)$。\n    - 不确定性 $\\sigma = 0.05$（弧度）。\n- 案例 2（配准将东方旋转至北方，测试跨被试对齐）：\n    - 绕 $y$ 轴旋转角度 $\\theta = -\\pi/2$：\n    $$\n    R = \\begin{bmatrix}\n    \\cos(\\theta)  0  \\sin(\\theta) \\\\\n    0  1  0 \\\\\n    -\\sin(\\theta)  0  \\cos(\\theta)\n    \\end{bmatrix},\n    \\quad \\theta = -\\pi/2.\n    $$\n    - 被试源 $\\mathbf{s} = (1, 0, 0)$。\n    - 不确定性 $\\sigma = 0.1$（弧度）。\n- 案例 3（源位置模糊，与东、西等距，测试平局情况和熵）：\n    - 旋转 $R = I$（单位矩阵）。\n    - 被试源 $\\mathbf{s} = (0, 1, 0)$。\n    - 不确定性 $\\sigma = 0.3$（弧度）。\n- 案例 4（高不确定性，几乎均匀分配）：\n    - 旋转 $R = I$（单位矩阵）。\n    - 被试源 $\\mathbf{s} = \\left( \\frac{\\sqrt{2}}{2}, \\frac{\\sqrt{2}}{2}, 0 \\right)$。\n    - 不确定性 $\\sigma = 2.0$（弧度）。\n\n您的程序必须生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。每个测试案例的结果必须是 $[L, c, H]$ 形式的列表，其中 $L$ 是一个整数，$c$ 和 $H$ 是浮点数，因此最终输出行的格式为\n$[ [L_1, c_1, H_1], [L_2, c_2, H_2], [L_3, c_3, H_3], [L_4, c_4, H_4] ]$，不含任何额外文本。",
            "solution": "该问题是有效的。它提出了一个有科学依据且适定的计算任务，其根植于神经科学数据分析的原理，特别是大脑皮层上的脑磁图（MEG）源定位。所有提供的信息，包括几何定义、数学模型和数值参数，都是自洽、一致且足以推导出唯一解的。该模型虽然是对真实世界皮层配准的简化，但基于既有概念：将皮层建模为光滑流形（$\\mathbb{S}^2$）、使用测地距离、用刚性旋转（$R \\in \\mathrm{SO}(3)$）近似配准，以及应用高斯不确定性模型和 Shannon 熵进行量化。该问题是可形式化的，并且需要对线性代数、微分几何和信息论中的概念进行非平凡的整合。\n\n解决方案将通过遵循问题陈述中描述的四步计算流程来实现。\n\n**第 1 步：源转换**\n初始步骤是将来自被试的 MEG 源位置与模板大脑的坐标系对齐。被试皮层表面的一个源，由单位向量 $\\mathbf{s} \\in \\mathbb{S}^2$ 表示，通过提供的刚性旋转矩阵 $R \\in \\mathrm{SO}(3)$ 转换到模板空间中。旋转矩阵 $R$ 封装了将被试皮层折叠模式与模板对齐的配准过程。模板球面上的转换后源位置 $\\mathbf{t}$ 通过矩阵-向量乘法计算：\n$$\n\\mathbf{t}' = R \\mathbf{s}\n$$\n由于计算过程中可能存在浮点数误差，所得向量 $\\mathbf{t}'$ 可能不具有完美的单位范数。为确保它位于单位球面 $\\mathbb{S}^2$ 上，需要明确地对其进行重新归一化：\n$$\n\\mathbf{t} = \\frac{\\mathbf{t}'}{\\| \\mathbf{t}' \\|_2}\n$$\n这保证了 $\\mathbf{t}$ 是 $\\mathbb{S}^2_i$ 上的一个有效点，可用于后续的测地距离计算。\n\n**第 2 步：测地距离计算**\n转换后的源 $\\mathbf{t}$ 与 $P$ 个皮层分区中每个分区的质心 $\\mathbf{c}_i$ 之间的距离使用单位球面上的测地距离来测量。对于任意两点 $\\mathbf{x}, \\mathbf{y} \\in \\mathbb{S}^2$，该距离是连接它们的大圆最短弧的长度。它由向量之间的夹角给出，计算如下：\n$$\nd(\\mathbf{x}, \\mathbf{y}) = \\arccos(\\mathbf{x}^\\top \\mathbf{y})\n$$\n在应用反余弦函数之前，点积 $\\mathbf{x}^\\top \\mathbf{y}$ 的值必须被限制在 $[-1, 1]$ 范围内，以防止出现数值定义域错误。对每个分区质心 $\\mathbf{c}_i \\in \\{\\mathbf{c}_0, \\mathbf{c}_1, \\mathbf{c}_2, \\mathbf{c}_3\\}$ 进行此计算，得到一组距离 $\\{d_i\\}_{i=0}^{P-1}$。所得距离的单位为弧度。\n\n**第 3 步：分区概率和置信度计算**\n源属于给定分区的概率使用以每个分区质心为中心的高斯径向基函数建模。该模型反映了定位不确定性 $\\sigma$，其中较小的 $\\sigma$ 意味着源的位置更确定。首先，为每个分区 $i$ 计算一个未归一化的权重 $w_i$：\n$$\nw_i = a_i \\exp\\left( -\\frac{d_i^2}{2 \\sigma^2} \\right)\n$$\n其中 $d_i = d(\\mathbf{t}, \\mathbf{c}_i)$ 是测地距离，$\\sigma^2$ 是不确定性方差，$a_i$ 是分区面积权重。根据规定，我们对所有分区使用 $a_i = 1$。\n\n然后将这些权重归一化，形成一个概率分布 $\\mathbf{p} = (p_0, \\dots, p_{P-1})^\\top$，确保概率总和为 1：\n$$\np_i = \\frac{w_i}{\\sum_{j=0}^{P-1} w_j}\n$$\n从此概率分布中，可以导出两个关键指标：\n- 顶部分区标签 $L$，即具有最高概率的分区的索引：$L = \\arg\\max_i p_i$。\n- 置信度 $c$，即最可能分区的概率：$c = \\max_i p_i$。\n\n**第 4 步：熵计算**\n分区分配的不确定性通过概率分布 $\\mathbf{p}$ 的 Shannon 熵进行量化。熵 $H(\\mathbf{p})$ 使用自然对数计算：\n$$\nH(\\mathbf{p}) = -\\sum_{i=0}^{P-1} p_i \\log(p_i)\n$$\n按照惯例，如果 $p_i = 0$，则 $p_i \\log(p_i)$ 项取为 $0$。较低的熵值（趋近于 $0$）表示高确定性，即某个分区的概率接近于 $1$。较高的熵值（趋近于 $\\log(P)$）表示高不确定性，即概率在各个分区之间均匀分布。\n\n这一完整的流程提供了一种原则性的方法，用于将皮层源分配到一组标准分区，同时提供对分配置信度和不确定性的量化度量。",
            "answer": "[[2, 1.0, 1.1102230246251565e-16],[0, 0.9999999999999998, 9.999999999999995e-16],[0, 0.25, 1.3862943611198906],[2, 0.319853375838531, 1.36214552554759]]"
        }
    ]
}