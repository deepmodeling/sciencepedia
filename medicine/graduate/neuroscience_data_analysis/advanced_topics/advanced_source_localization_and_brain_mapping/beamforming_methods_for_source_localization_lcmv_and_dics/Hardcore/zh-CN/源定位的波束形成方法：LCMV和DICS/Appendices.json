{
    "hands_on_practices": [
        {
            "introduction": "掌握新方法的第一步是实现其核心逻辑。本练习将指导您从头开始构建一个波束形成器，并计算其点扩散函数 (Point Spread Function, PSF)。点扩散函数揭示了波束形成器如何“看到”一个单独的点源，通过计算一个“聚焦指数”，我们可以量化其空间锐度，从而让您对算法的行为有一个直观的感受 。",
            "id": "4141741",
            "problem": "给定一个用于脑磁图/脑电图波束形成的简化线性混合模型，其中测量的传感器信号 $x(t) \\in \\mathbb{R}^m$ 被建模为 $x(t) = L s(t) + n(t)$，其中 $L \\in \\mathbb{R}^{m \\times n}$ 是将 $n$ 个假定源映射到 $m$ 个传感器的导联场矩阵，$s(t) \\in \\mathbb{R}^n$ 是源活动，$n(t) \\in \\mathbb{R}^m$ 是加性噪声。假设存在平稳性，因此传感器协方差 $C \\in \\mathbb{R}^{m \\times m}$ 满足 $C = \\mathbb{E}[x(t) x(t)^\\top]$，并且在固定频率 $f$ 下，（实值）交叉谱密度 $S \\in \\mathbb{R}^{m \\times m}$ 满足 $S = \\mathbb{E}[X(f) X(f)^\\top]$，其中 $X(f)$ 是 $x(t)$ 的傅里叶变换。考虑两种波束形成器：作用于 $C$ 的线性约束最小方差（Linearly Constrained Minimum Variance, LCMV）波束形成器，以及作用于 $S$ 的相干源动态成像（Dynamic Imaging of Coherent Sources, DICS）波束形成器。\n\n您的任务是提出并实现一种方法，通过在单个位置模拟单位功率源，应用波束形成器，并绘制所有候选源位置上的重建功率，来计算 LCMV 或 DICS 的点扩散函数（PSF）。PSF 定义如下：对于每个候选位置索引 $j \\in \\{0,1,\\dots,n-1\\}$，形成一个空间滤波器 $w_j \\in \\mathbb{R}^m$，该滤波器在位置 $j$ 处施加单位增益约束，并最小化相对于矩阵 $M \\in \\mathbb{R}^{m \\times m}$ 的波束形成器输出功率，其中对于 LCMV，$M = C$；对于 DICS，$M = S$。位置 $j$ 处的重建功率为 $\\hat{p}_j = w_j^\\top M w_j$。收集所有 $j$ 的 $\\hat{p}_j$ 得到 PSF 向量 $\\hat{p} \\in \\mathbb{R}^n$。从 $\\hat{p}$ 定义聚焦指数 $F$ 为 $F = \\hat{p}_{j^\\ast} \\big/ \\sum_{j=0}^{n-1} \\hat{p}_j$，其中 $j^\\ast$ 是真实源索引。聚焦指数 $F$ 必须报告为十进制数（无单位）。\n\n您必须遵守以下建模和计算约束：\n\n- 源模拟：通过将源功率对角矩阵 $P_s \\in \\mathbb{R}^{n \\times n}$ 设置为除 $(P_s)_{j^\\ast,j^\\ast} = 1$ 外全为零，来模拟位于索引 $j^\\ast$ 处的单个单位功率源。噪声被建模为方差为 $\\sigma^2$ 的空间白噪声，因此 $C = L P_s L^\\top + \\sigma^2 I_m$ 且 $S = L P_s L^\\top + \\sigma^2 I_m$，其中 $I_m$ 是 $m \\times m$ 的单位矩阵。所有量均无单位。\n- 导联场构建：传感器和源位于一条一维直线上。传感器位置为 $s_i = i \\cdot d_s$（对于 $i \\in \\{0,1,\\dots,m-1\\}$），源位置为 $r_j = (j \\cdot d_r) + \\delta$（对于 $j \\in \\{0,1,\\dots,n-1\\}$）。导联场条目由 $L_{i,j} = \\frac{1}{1 + \\lvert s_i - r_j \\rvert}$ 给出（对于所有 $i,j$）。\n- 正则化：为确保 $M$ 的可逆性，使用 Tikhonov 型对角加载 $M_{\\text{reg}} = M + \\alpha \\cdot \\frac{\\operatorname{tr}(M)}{m} I_m$，其中 $\\alpha$ 是一个非负标量。空间滤波器 $w_j$ 必须使用 $M_{\\text{reg}}$ 计算，而重建功率 $\\hat{p}_j$ 则使用未经正则化的 $M$ 进行评估。\n\n您的程序必须实现上述内容，并为以下每个测试用例计算聚焦指数 $F$。每个测试用例由 $(\\text{method}, m, n, d_s, d_r, \\delta, \\sigma^2, \\alpha, j^\\ast)$ 完全指定：\n\n- 测试用例 1（理想情况，LCMV）：$(\\text{LCMV}, m=6, n=5, d_s=1.0, d_r=1.0, \\delta=0.5, \\sigma^2=0.01, \\alpha=0.05, j^\\ast=2)$。\n- 测试用例 2（近奇异协方差，LCMV）：$(\\text{LCMV}, m=6, n=5, d_s=1.0, d_r=1.0, \\delta=0.5, \\sigma^2=0.000001, \\alpha=0.10, j^\\ast=3)$。\n- 测试用例 3（频域模拟，DICS）：$(\\text{DICS}, m=6, n=5, d_s=1.0, d_r=1.0, \\delta=0.5, \\sigma^2=0.05, \\alpha=0.05, j^\\ast=1)$。\n- 测试用例 4（导联场中高度共线性，DICS）：$(\\text{DICS}, m=6, n=5, d_s=1.0, d_r=0.2, \\delta=0.1, \\sigma^2=0.001, \\alpha=0.05, j^\\ast=4)$。\n\n算法要求：\n\n- 对于每个测试用例，使用 $s_i = i \\cdot d_s$ 和 $r_j = (j \\cdot d_r) + \\delta$ 从指定的 $(m, n, d_s, d_r, \\delta)$ 构建 $L$，其中 $L_{i,j} = \\frac{1}{1 + \\lvert s_i - r_j \\rvert}$。\n- 形成 $P_s$，其中 $(P_s)_{j^\\ast,j^\\ast} = 1$ 且其他地方为零。如果方法是 LCMV，则计算 $M=C$，如果方法是 DICS，则计算 $M=S$，公式为 $M = L P_s L^\\top + \\sigma^2 I_m$。\n- 对于每个 $j \\in \\{0,1,\\dots,n-1\\}$，计算一个空间滤波器 $w_j$，该滤波器最小化 $w^\\top M_{\\text{reg}} w$，约束条件为 $w^\\top l_j = 1$，其中 $l_j$ 是 $L$ 的第 $j$ 列。使用 $M_{\\text{reg}} = M + \\alpha \\cdot \\frac{\\operatorname{tr}(M)}{m} I_m$。\n- 计算 $\\hat{p}_j = w_j^\\top M w_j$，然后计算聚焦指数 $F = \\hat{p}_{j^\\ast} \\big/ \\sum_{j=0}^{n-1} \\hat{p}_j$（作为十进制数）。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含四个测试用例的聚焦指数，格式为逗号分隔的列表，并用方括号括起来，例如 $[\\ldots]$。条目必须是十进制数。确切的输出格式是 $[F_1,F_2,F_3,F_4]$，其中 $F_k$ 是测试用例 $k$ 的聚焦指数。\n\n不允许外部输入；所有值必须完全按照上述规定在程序内部生成。",
            "solution": "用户提供的问题经评估有效。它基于源定位信号处理的原理，具有科学依据，是适定的，并为一项计算任务提供了一套完整的、自洽的规范。所做的简化，如一维模型和交叉谱密度矩阵的特定公式，对于一个已定义的计算问题是合适的，不构成科学缺陷。\n\n该问题要求计算一个波束形成源定位任务的聚焦指数。这涉及几个步骤：定义物理模型，建立数据协方差矩阵，通过约束优化计算空间滤波器，最后评估重建功率的空间扩展。\n\n波束形成方法的核心是为每个假定源位置 $j$ 计算空间滤波器 $w_j \\in \\mathbb{R}^m$。该滤波器是一个约束优化问题的解：最小化输出功率，同时满足目标源的单位增益约束。输出功率由 $w^\\top M_{\\text{reg}} w$ 给出，其中 $M_{\\text{reg}} \\in \\mathbb{R}^{m \\times m}$ 是正则化后的数据协方差（对于 LCMV）或交叉谱密度（对于 DICS）矩阵。单位增益约束表示为 $w^\\top l_j = 1$，其中 $l_j \\in \\mathbb{R}^m$ 是第 $j$ 个源位置的导联场向量，即导联场矩阵 $L$ 的第 $j$ 列。\n\n该优化问题正式表述为：\n$$\n\\text{minimize } w^\\top M_{\\text{reg}} w \\quad \\text{subject to} \\quad w^\\top l_j = 1\n$$\n这是一个标准问题，可以使用拉格朗日乘子法求解。拉格朗日函数 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L}(w, \\lambda) = w^\\top M_{\\text{reg}} w - \\lambda(w^\\top l_j - 1)\n$$\n其中 $\\lambda$ 是拉格朗日乘子。为了找到最小值，我们计算关于 $w$ 的梯度并将其设为零：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial w} = 2 M_{\\text{reg}} w - \\lambda l_j = 0\n$$\n假设 $M_{\\text{reg}}$ 是可逆的（这由问题的正则化方案保证），我们可以解出 $w$：\n$$\nw = \\frac{\\lambda}{2} M_{\\text{reg}}^{-1} l_j\n$$\n为了找到 $\\lambda$，我们将这个 $w$ 的表达式代回到约束方程 $w^\\top l_j = 1$ 中：\n$$\n\\left( \\frac{\\lambda}{2} M_{\\text{reg}}^{-1} l_j \\right)^\\top l_j = 1 \\implies \\frac{\\lambda}{2} (l_j^\\top M_{\\text{reg}}^{-1} l_j) = 1\n$$\n解出项 $\\frac{\\lambda}{2}$ 得到：\n$$\n\\frac{\\lambda}{2} = \\frac{1}{l_j^\\top M_{\\text{reg}}^{-1} l_j}\n$$\n将此代回到 $w$ 的表达式中，得到最优空间滤波器 $w_j$：\n$$\nw_j = \\frac{M_{\\text{reg}}^{-1} l_j}{l_j^\\top M_{\\text{reg}}^{-1} l_j}\n$$\n问题规定，位置 $j$ 处的重建功率 $\\hat{p}_j$ 使用未正则化的矩阵 $M$ 计算：\n$$\n\\hat{p}_j = w_j^\\top M w_j\n$$\n通过代入 $w_j$ 的表达式，我们得到：\n$$\n\\hat{p}_j = \\left( \\frac{M_{\\text{reg}}^{-1} l_j}{l_j^\\top M_{\\text{reg}}^{-1} l_j} \\right)^\\top M \\left( \\frac{M_{\\text{reg}}^{-1} l_j}{l_j^\\top M_{\\text{reg}}^{-1} l_j} \\right) = \\frac{l_j^\\top (M_{\\text{reg}}^{-1})^\\top M M_{\\text{reg}}^{-1} l_j}{(l_j^\\top M_{\\text{reg}}^{-1} l_j)^2}\n$$\n由于 $M_{\\text{reg}}$ 是对称的，其逆矩阵也是对称的，因此 $(M_{\\text{reg}}^{-1})^\\top = M_{\\text{reg}}^{-1}$。功率的表达式变为：\n$$\n\\hat{p}_j = \\frac{l_j^\\top M_{\\text{reg}}^{-1} M M_{\\text{reg}}^{-1} l_j}{(l_j^\\top M_{\\text{reg}}^{-1} l_j)^2}\n$$\n为每个测试用例实现的总体算法如下：\n\n1.  **构建矩阵**：\n    a.  根据传感器位置 $s_i = i \\cdot d_s$（对于 $i \\in \\{0, \\dots, m-1\\}$）和源位置 $r_j = (j \\cdot d_r) + \\delta$（对于 $j \\in \\{0, \\dots, n-1\\}$）构建导联场矩阵 $L \\in \\mathbb{R}^{m \\times n}$。每个元素由 $L_{i,j} = \\frac{1}{1 + \\lvert s_i - r_j \\rvert}$ 给出。\n    b.  生成模拟数据矩阵 $M \\in \\mathbb{R}^{m \\times m}$（对于 LCMV 表示 $C$，对于 DICS 表示 $S$）。对于在索引 $j^\\ast$ 处具有单位功率的单个活动源，源功率矩阵 $P_s$ 是一个对角矩阵，其 $(P_s)_{j^\\ast, j^\\ast} = 1$ 且其他地方为零。然后数据矩阵为 $M = L P_s L^\\top + \\sigma^2 I_m$。这可以高效地计算为 $M = l_{j^\\ast} l_{j^\\ast}^\\top + \\sigma^2 I_m$，其中 $l_{j^\\ast}$ 是 $L$ 的第 $j^\\ast$ 列，$I_m$ 是 $m \\times m$ 的单位矩阵。\n    c.  使用 Tikhonov 型正则化计算正则化矩阵 $M_{\\text{reg}}$：$M_{\\text{reg}} = M + \\alpha \\cdot \\frac{\\operatorname{tr}(M)}{m} I_m$。在 $M$ 中包含噪声项 $\\sigma^2 I_m$ 和额外的对角加载确保了 $M_{\\text{reg}}$ 是良态且可逆的。\n\n2.  **计算点扩散函数（PSF）**：\n    a.  对于每个候选源位置 $j \\in \\{0, 1, \\dots, n-1\\}$，从 $L$ 中提取相应的导联场向量 $l_j$。\n    b.  使用推导出的公式 $w_j = (M_{\\text{reg}}^{-1} l_j) / (l_j^\\top M_{\\text{reg}}^{-1} l_j)$ 计算空间滤波器 $w_j$。这需要计算 $M_{\\text{reg}}$ 的逆。\n    c.  计算重建功率 $\\hat{p}_j = w_j^\\top M w_j$。\n    d.  所有功率值 $\\{\\hat{p}_j\\}_{j=0}^{n-1}$ 的集合构成了 PSF 向量 $\\hat{p}$。\n\n3.  **计算聚焦指数**：\n    a.  聚焦指数 $F$ 计算为真实源位置处的功率与所有位置总重建功率之比：\n        $$\n        F = \\frac{\\hat{p}_{j^\\ast}}{\\sum_{j=0}^{n-1} \\hat{p}_j}\n        $$\n该过程应用于四个测试用例中的每一个，从而产生四个不同的聚焦指数。值得注意的是，在这个问题中，LCMV 和 DICS 之间的区别是名义上的，因为根据提供的模拟模型，计算数据矩阵 $M$ 的过程对两种方法是相同的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the beamforming focality index problem.\n    It iterates through predefined test cases and prints the results.\n    \"\"\"\n\n    def compute_focality(method, m, n, d_s, d_r, delta, sigma2, alpha, j_star):\n        \"\"\"\n        Computes the focality index for a single beamformer configuration.\n\n        Args:\n            method (str): 'LCMV' or 'DICS'. Nominal in this problem.\n            m (int): Number of sensors.\n            n (int): Number of sources.\n            d_s (float): Distance between sensors.\n            d_r (float): Distance between sources.\n            delta (float): Offset for source positions.\n            sigma2 (float): Noise variance.\n            alpha (float): Regularization parameter.\n            j_star (int): Index of the true source.\n\n        Returns:\n            float: The computed focality index.\n        \"\"\"\n        # Step 1: Construct Matrices\n\n        # 1a. Construct Lead Field Matrix L\n        # Sensor and source positions are generated as 1D arrays.\n        s_pos = np.arange(m, dtype=float) * d_s\n        r_pos = np.arange(n, dtype=float) * d_r + delta\n        # L is computed using broadcasting for efficiency.\n        L = 1.0 / (1.0 + np.abs(s_pos[:, np.newaxis] - r_pos))\n\n        # 1b. Construct Data Matrix M\n        # The model is M = L @ P_s @ L.T + sigma2 * I.\n        # With a single unit-power source at j_star, P_s has only one non-zero\n        # element, P_s[j_star, j_star] = 1. This simplifies the product\n        # L @ P_s @ L.T to an outer product of the j_star-th column of L.\n        l_j_star = L[:, j_star]\n        M = np.outer(l_j_star, l_j_star) + sigma2 * np.identity(m)\n\n        # 1c. Construct Regularized Matrix M_reg\n        trace_M = np.trace(M)\n        reg_term = alpha * (trace_M / m)\n        M_reg = M + reg_term * np.identity(m)\n        \n        # Step 2: Compute Point Spread Function (PSF)\n        p_hat_vec = np.zeros(n)\n        \n        # The inverse of the regularized matrix is pre-computed.\n        M_reg_inv = np.linalg.inv(M_reg)\n\n        for j in range(n):\n            l_j = L[:, j]\n            \n            # 2b. Compute spatial filter w_j using the derived formula.\n            numerator_w = M_reg_inv @ l_j\n            denominator_w = l_j.T @ numerator_w\n            \n            # The denominator should not be zero due to regularization,\n            # but this check ensures robustness.\n            if np.isclose(denominator_w, 0):\n                w_j = np.zeros(m)\n            else:\n                w_j = numerator_w / denominator_w\n            \n            # 2c. Compute reconstructed power p_hat_j using unregularized M.\n            p_hat_j = w_j.T @ M @ w_j\n            p_hat_vec[j] = p_hat_j\n            \n        # Step 3: Compute Focality Index F\n        p_hat_at_true_source = p_hat_vec[j_star]\n        sum_of_all_powers = np.sum(p_hat_vec)\n        \n        # Avoid division by zero if all reconstructed powers are zero.\n        if np.isclose(sum_of_all_powers, 0):\n            return 0.0\n            \n        focality_index = p_hat_at_true_source / sum_of_all_powers\n        \n        return focality_index\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (method, m, n, d_s, d_r, delta, sigma2, alpha, j_star)\n        (\"LCMV\", 6, 5, 1.0, 1.0, 0.5, 0.01, 0.05, 2),\n        (\"LCMV\", 6, 5, 1.0, 1.0, 0.5, 0.000001, 0.10, 3),\n        (\"DICS\", 6, 5, 1.0, 1.0, 0.5, 0.05, 0.05, 1),\n        (\"DICS\", 6, 5, 1.0, 0.2, 0.1, 0.001, 0.05, 4),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters and compute focality for each case.\n        focality = compute_focality(*case)\n        results.append(focality)\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) converts each float result to its string representation.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实现核心算法之后，一个更全面的评估方法是在充满噪声和变化的条件下检验其性能。本练习要求您设计一个蒙特卡洛模拟，以系统地测量定位误差。通过改变样本量 $N$ 和正则化强度 $\\lambda$ 等关键参数，您将凭经验研究它们对波束形成器准确性和可靠性的影响，这是任何方法开发者都必须具备的关键技能 。",
            "id": "4141681",
            "problem": "您的任务是设计并实现一个蒙特卡洛模拟，在受控的合成脑电图 (EEG) 传感器阵列场景中，量化线性约束最小方差 (LCMV) 波束形成器在不同样本量和正则化强度下的定位误差分布。该模拟必须从线性正向模型和 LCMV 优化问题的定义出发，推导出源扫描所需的算法步骤，并计算定位误差分布的汇总统计量。所有涉及物理距离的量都必须以米为单位表示。您的最终程序必须为预定义的测试套件生成指定的聚合汇总输出。\n\n基本和模型假设：\n- 对多通道神经测量使用线性正向模型。假设有 $M$ 个传感器，在 $N$ 个时间样本上采集测量数据。传感器阵列的模型是在平面上一个半径为 $R$ 的圆上放置 $M$ 个传感器。位于 $\\mathbf{r}_{\\text{true}}$ 的单个神经源产生一个标量时间序列 $s(t)$，该序列通过导联场向量 $\\mathbf{l}(\\mathbf{r}_{\\text{true}}) \\in \\mathbb{R}^M$ 线性映射到传感器。在时间 $t$ 观测到的数据由下式给出\n$$\n\\mathbf{x}(t) = s(t)\\,\\mathbf{l}(\\mathbf{r}_{\\text{true}}) + \\mathbf{n}(t),\n$$\n其中 $\\mathbf{n}(t)$ 是附加传感器噪声。\n- 样本协方差矩阵 $\\widehat{\\mathbf{C}} \\in \\mathbb{R}^{M \\times M}$ 是使用标准估计量从去均值数据中计算得出的\n$$\n\\widehat{\\mathbf{C}} = \\frac{1}{N} \\sum_{t=1}^{N} \\left( \\mathbf{x}(t) - \\bar{\\mathbf{x}} \\right)\\left( \\mathbf{x}(t) - \\bar{\\mathbf{x}} \\right)^\\top,\n$$\n其中 $\\bar{\\mathbf{x}}$ 是跨时间的样本均值。\n- 正则化以附加 Tikhonov 正则化的形式应用\n$$\n\\widehat{\\mathbf{C}}_{\\lambda} = \\widehat{\\mathbf{C}} + \\lambda \\,\\alpha\\, \\mathbf{I},\n$$\n其中 $\\lambda \\ge 0$ 是正则化强度，$\\alpha = \\frac{\\operatorname{trace}(\\widehat{\\mathbf{C}})}{M}$ 提供单位缩放，$\\mathbf{I}$ 是单位矩阵。\n\n波束形成目标：\n- LCMV 波束形成器（线性约束最小方差）由以下约束优化问题定义\n$$\n\\min_{\\mathbf{w} \\in \\mathbb{R}^M} \\quad \\mathbf{w}^\\top \\widehat{\\mathbf{C}}_{\\lambda}\\, \\mathbf{w} \\quad \\text{subject to} \\quad \\mathbf{w}^\\top \\mathbf{l}(\\mathbf{r}) = 1,\n$$\n对于预定义扫描网格中的每个候选源位置 $\\mathbf{r}$。您必须从此公式推导出用于对每个位置进行评分并选择估计源位置 $\\widehat{\\mathbf{r}}$ 的所有必要量。\n\n导联场：\n- 在均匀介质中使用简化的准静态正向模型，其中位于 $\\mathbf{r}$ 的标量源的导联场在传感器位置 $\\mathbf{s}_m$ 处按分量定义为\n$$\nl_m(\\mathbf{r}) = \\frac{1}{\\|\\mathbf{r} - \\mathbf{s}_m\\|^2},\n$$\n对于 $m = 1, \\ldots, M$，其中 $\\|\\cdot\\|$ 是欧几里得范数。此选择确保了物理上随距离的衰减以及传感器间非平凡的空间模式。\n\n传感器阵列和扫描网格：\n- 在 $z=0$ 平面中，以原点为中心、半径为 $R = 0.09$ 米的圆上放置 $M = 12$ 个传感器，角度均匀分布。真实源位置为 $\\mathbf{r}_{\\text{true}} = (0.03, -0.02, 0)$ 米。\n- 在 $z=0$ 平面中定义一个二维候选源位置扫描网格，范围为 $x,y \\in [-0.06, 0.06]$ 米，均匀步长为 $0.01$ 米。对每个网格位置 $\\mathbf{r}$，计算导联场 $\\mathbf{l}(\\mathbf{r})$。\n\n噪声和信号生成：\n- 对于每个蒙特卡洛试验，将源样本 $s(t)$ 生成为均值为零、方差为 $\\sigma_s^2$ 的独立高斯随机变量，即\n$$\ns(t) \\sim \\mathcal{N}(0, \\sigma_s^2).\n$$\n- 从协方差为\n$$\n\\boldsymbol{\\Sigma}_n = \\sigma_n^2 \\left[ (1-\\rho)\\,\\mathbf{I} + \\rho\\,\\mathbf{1}\\mathbf{1}^\\top \\right],\n$$\n的零均值多元高斯分布中生成传感器噪声 $\\mathbf{n}(t)$，其中 $\\mathbf{1} \\in \\mathbb{R}^M$ 是全一向量，$\\rho \\in [0,1)$ 控制传感器间的相关性，$\\sigma_n^2$ 控制噪声功率。使用 $\\sigma_s^2 = 1.0$、$\\sigma_n = 0.1$ 和 $\\rho = 0.1$。这些设置提供了真实的信噪比，并确保了 $\\boldsymbol{\\Sigma}_n$ 的正定性。\n\n定位误差度量：\n- 对于每次试验，使用从上述优化问题推导出的 LCMV 准则在网格上执行源扫描，以选择估计位置 $\\widehat{\\mathbf{r}}$。计算定位误差\n$$\ne = \\left\\| \\widehat{\\mathbf{r}} - \\mathbf{r}_{\\text{true}} \\right\\|,\n$$\n以米为单位表示。\n\n蒙特卡洛协议：\n- 对每个参数对 $(N, \\lambda)$，运行 $T$ 次独立试验（信号和噪声独立抽取），计算样本协方差 $\\widehat{\\mathbf{C}}$，应用正则化，执行源扫描以找到 $\\widehat{\\mathbf{r}}$，并记录以米为单位的定位误差 $e$。\n- 每个参数对使用 $T = 200$ 次试验。\n\n测试套件：\n- 评估以下参数对 $(N, \\lambda)$：\n    1. $(24, 0.0)$\n    2. $(24, 10^{-3})$\n    3. $(64, 0.0)$\n    4. $(64, 10^{-3})$\n    5. $(256, 0.0)$\n    6. $(256, 10^{-2})$\n\n要求输出：\n- 对每个参数对，计算并返回在 $T$ 次试验中定位误差分布的以下汇总统计量：\n    1. 平均定位误差 $\\overline{e}$，单位为米。\n    2. 定位误差的标准差 $\\operatorname{std}(e)$，单位为米。\n    3. 定位误差的经验 $0.95$ 分位数（第 95 百分位数）$q_{0.95}$，单位为米。\n- 您的程序应生成单行输出，其中包含所有参数对的结果，格式为一个用方括号括起来的逗号分隔列表。对应于一个参数对的每个元素本身必须是一个形式为 $[N, \\lambda, \\overline{e}, \\operatorname{std}(e), q_{0.95}]$ 的列表，例如：\n$$\n\\left[ [24, 0.0, 0.0123, 0.0045, 0.0199], [24, 0.001, \\ldots], \\ldots \\right]\n$$\n所有距离必须以米为单位表示，所有数值输出应为十进制形式（不涉及百分比或角度单位）。",
            "solution": "该问题定义明确且有科学依据。我们将着手提供一个解决方案。\n\n目标是通过蒙特卡洛模拟来量化线性约束最小方差 (LCMV) 波束形成器的定位性能。该分析基于一个合成的脑电图 (EEG) 场景，该场景由一个线性正向模型、特定的传感器几何结构以及信号和噪声的统计模型定义。\n\n**1. 理论框架**\n\n**1.1. 正向模型与数据生成**\n神经源活动与传感器测量值之间的关系由线性正向模型描述。对于位于 $\\mathbf{r}_{\\text{true}}$ 位置、时间序列为 $s(t)$ 的单个源，来自 $M$ 个传感器的阵列的测量值 $\\mathbf{x}(t) \\in \\mathbb{R}^M$ 由下式给出：\n$$\n\\mathbf{x}(t) = s(t)\\,\\mathbf{l}(\\mathbf{r}_{\\text{true}}) + \\mathbf{n}(t)\n$$\n此处，$\\mathbf{l}(\\mathbf{r}_{\\text{true}}) \\in \\mathbb{R}^M$ 是导联场向量，它将源映射到传感器，而 $\\mathbf{n}(t) \\in \\mathbb{R}^M$ 是附加传感器噪声。\n\n在模拟中，每个时间样本 $t$ 的源信号 $s(t)$ 独立地从零均值高斯分布中抽取，其方差为 $\\sigma_s^2 = 1.0$：\n$$\ns(t) \\sim \\mathcal{N}(0, \\sigma_s^2)\n$$\n传感器噪声 $\\mathbf{n}(t)$ 是从一个具有结构化协方差矩阵 $\\boldsymbol{\\Sigma}_n$ 的零均值多元高斯分布中抽取的：\n$$\n\\mathbf{n}(t) \\sim \\mathcal{N}(\\mathbf{0}, \\boldsymbol{\\Sigma}_n)\n$$\n其中 $\\boldsymbol{\\Sigma}_n = \\sigma_n^2 \\left[ (1-\\rho)\\,\\mathbf{I} + \\rho\\,\\mathbf{1}\\mathbf{1}^\\top \\right]$。参数设置为 $\\sigma_n = 0.1$ 和 $\\rho = 0.1$，这引入了基线噪声水平和传感器间的空间相关性。$\\mathbf{I}$ 是 $M \\times M$ 单位矩阵，$\\mathbf{1}$ 是全一向量。信号和噪声被假定为不相关。\n\n**1.2. 导联场模型**\n导联场模型模拟了每个传感器对源的敏感度。由于位于 $\\mathbf{r}$ 的源，第 $m$ 个传感器在位置 $\\mathbf{s}_m$ 的分量 $l_m(\\mathbf{r})$ 由一个简化的准静态模型给出：\n$$\nl_m(\\mathbf{r}) = \\frac{1}{\\|\\mathbf{r} - \\mathbf{s}_m\\|^2}\n$$\n该模型表示信号强度随距离平方衰减，这是物理场中的一个共同特征。\n\n**1.3. 协方差估计与正则化**\nLCMV 波束形成器依赖于数据的二阶统计量，这些统计量由协方差矩阵捕获。给定 $N$ 个时间样本的数据，样本协方差矩阵 $\\widehat{\\mathbf{C}}$ 估计如下：\n$$\n\\widehat{\\mathbf{C}} = \\frac{1}{N} \\sum_{t=1}^{N} \\left( \\mathbf{x}(t) - \\bar{\\mathbf{x}} \\right)\\left( \\mathbf{x}(t) - \\bar{\\mathbf{x}} \\right)^\\top\n$$\n其中 $\\bar{\\mathbf{x}}$ 是时间平均的测量向量。在实践中，特别是当样本数量 $N$ 较小时，$\\widehat{\\mathbf{C}}$ 可能是病态的。为了提高其稳定性，应用 Tikhonov 正则化：\n$$\n\\widehat{\\mathbf{C}}_{\\lambda} = \\widehat{\\mathbf{C}} + \\lambda \\,\\alpha\\, \\mathbf{I}\n$$\n正则化参数为 $\\lambda \\ge 0$。缩放因子 $\\alpha = \\frac{\\operatorname{trace}(\\widehat{\\mathbf{C}})}{M}$ 将正则化强度相对于平均传感器功率进行归一化，使得 $\\lambda$ 的选择较少依赖于整体信号幅度。\n\n**2. LCMV 波束形成器推导与源定位**\n\n**2.1. 优化问题**\nLCMV 波束形成器通过构建一个空间滤波器 $\\mathbf{w}(\\mathbf{r}) \\in \\mathbb{R}^M$ 来估计特定位置 $\\mathbf{r}$ 的源活动。该滤波器被设计为以单位增益通过来自位置 $\\mathbf{r}$ 的信号，同时最小化滤波器的输出功率（方差），从而抑制来自噪声和其他位置的贡献。这被表述为一个约束优化问题：\n$$\n\\min_{\\mathbf{w} \\in \\mathbb{R}^M} \\mathbf{w}^\\top \\widehat{\\mathbf{C}}_{\\lambda}\\, \\mathbf{w} \\quad \\text{subject to} \\quad \\mathbf{w}^\\top \\mathbf{l}(\\mathbf{r}) = 1\n$$\n**2.2. 空间滤波器的推导**\n这个问题可以使用拉格朗日乘数法解决。拉格朗日函数为：\n$$\n\\mathcal{L}(\\mathbf{w}, \\mu) = \\mathbf{w}^\\top \\widehat{\\mathbf{C}}_{\\lambda}\\, \\mathbf{w} - \\mu \\left(\\mathbf{w}^\\top \\mathbf{l}(\\mathbf{r}) - 1\\right)\n$$\n对 $\\mathbf{w}$ 求梯度并将其设为零可得：\n$$\n\\nabla_{\\mathbf{w}} \\mathcal{L} = 2 \\widehat{\\mathbf{C}}_{\\lambda} \\mathbf{w} - \\mu \\mathbf{l}(\\mathbf{r}) = \\mathbf{0} \\implies \\mathbf{w} = \\frac{\\mu}{2} \\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r})\n$$\n通过施加约束 $\\mathbf{w}^\\top \\mathbf{l}(\\mathbf{r}) = 1$ 来找到拉格朗日乘数 $\\mu$：\n$$\n\\left(\\frac{\\mu}{2} \\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r})\\right)^\\top \\mathbf{l}(\\mathbf{r}) = 1 \\implies \\frac{\\mu}{2} \\left( \\mathbf{l}(\\mathbf{r})^\\top \\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r}) \\right) = 1\n$$\n求解 $\\frac{\\mu}{2}$ 可得 $\\frac{\\mu}{2} = \\frac{1}{\\mathbf{l}(\\mathbf{r})^\\top \\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r})}$。将其代回 $\\mathbf{w}$ 的表达式，得到位置 $\\mathbf{r}$ 的最优空间滤波器：\n$$\n\\mathbf{w}(\\mathbf{r}) = \\frac{\\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r})}{\\mathbf{l}(\\mathbf{r})^\\top \\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r})}\n$$\n\n**2.3. 通过功率扫描进行源定位**\n位于位置 $\\mathbf{r}$ 的源的波束形成器输出功率是 $P(\\mathbf{r}) = \\mathbf{w}(\\mathbf{r})^\\top \\widehat{\\mathbf{C}}_{\\lambda} \\mathbf{w}(\\mathbf{r})$。代入最优滤波器 $\\mathbf{w}(\\mathbf{r})$ 可得：\n$$\nP(\\mathbf{r}) = \\frac{\\left(\\mathbf{l}(\\mathbf{r})^\\top \\widehat{\\mathbf{C}}_{\\lambda}^{-1}\\right) \\widehat{\\mathbf{C}}_{\\lambda} \\left(\\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r})\\right)}{\\left(\\mathbf{l}(\\mathbf{r})^\\top \\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r})\\right)^2} = \\frac{\\mathbf{l}(\\mathbf{r})^\\top \\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r})}{\\left(\\mathbf{l}(\\mathbf{r})^\\top \\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r})\\right)^2} = \\frac{1}{\\mathbf{l}(\\mathbf{r})^\\top \\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r})}\n$$\n为了定位源，我们在预定义的候选位置网格上进行扫描。对于每个网格点 $\\mathbf{r}_j$，我们计算输出功率 $P(\\mathbf{r}_j)$。产生最大功率的位置被选为估计的源位置 $\\widehat{\\mathbf{r}}$：\n$$\n\\widehat{\\mathbf{r}} = \\arg\\max_{\\mathbf{r} \\in \\text{grid}} P(\\mathbf{r}) = \\arg\\max_{\\mathbf{r} \\in \\text{grid}} \\left( \\frac{1}{\\mathbf{l}(\\mathbf{r})^\\top \\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r})} \\right)\n$$\n\n**3. 蒙特卡洛模拟协议**\n\n该模拟量化了对于不同样本量 $N$ 和正则化强度 $\\lambda$ 的定位误差 $e = \\| \\widehat{\\mathbf{r}} - \\mathbf{r}_{\\text{true}} \\|$ 的分布。\n\n**设置：**\n- 传感器阵列：$M = 12$ 个传感器被放置在 $z=0$ 平面中一个以原点为中心、半径为 $R = 0.09$ 米的圆上。坐标为 $\\mathbf{s}_m = (R \\cos(2\\pi m/M), R \\sin(2\\pi m/M), 0)$，对于 $m=0, \\ldots, 11$。\n- 真实源位置：$\\mathbf{r}_{\\text{true}} = (0.03, -0.02, 0)$ 米。\n- 扫描网格：$z=0$ 平面中的一个二维网格，其 $x$ 和 $y$ 坐标范围为 $[-0.06, 0.06]$ 米，步长为 $0.01$ 米。\n- 试验：对每个 $(N, \\lambda)$ 对运行 $T = 200$ 次独立试验。\n\n**对每次试验：**\n1.  **生成数据**：对于给定的 $N$，根据指定的模型生成 $N$ 个源信号 $s(t)$ 和传感器噪声 $\\mathbf{n}(t)$ 的样本。构建 $M \\times N$ 的数据矩阵 $\\mathbf{X}$。\n2.  **估计协方差**：从 $\\mathbf{X}$ 计算样本协方差矩阵 $\\widehat{\\mathbf{C}}$。\n3.  **正则化协方差**：计算 $\\widehat{\\mathbf{C}}_{\\lambda} = \\widehat{\\mathbf{C}} + \\lambda \\frac{\\operatorname{trace}(\\widehat{\\mathbf{C}})}{M} \\mathbf{I}$。\n4.  **执行扫描**：\n    - 对正则化的协方差矩阵求逆以得到 $\\widehat{\\mathbf{C}}_{\\lambda}^{-1}$。\n    - 对于扫描网格上的每个点 $\\mathbf{r}_j$，计算导联场 $\\mathbf{l}(\\mathbf{r}_j)$，然后计算波束形成器功率 $P(\\mathbf{r}_j) = (\\mathbf{l}(\\mathbf{r}_j)^\\top \\widehat{\\mathbf{C}}_{\\lambda}^{-1} \\mathbf{l}(\\mathbf{r}_j))^{-1}$。\n    - 将具有最大功率的网格点确定为估计的源位置 $\\widehat{\\mathbf{r}}$。\n5.  **计算误差**：计算欧几里得距离 $e = \\| \\widehat{\\mathbf{r}} - \\mathbf{r}_{\\text{true}} \\|$。\n\n**分析：**\n对于测试套件中的每个 $(N, \\lambda)$ 对，收集了 $T=200$ 个定位误差的集合 $\\{e_i\\}_{i=1}^{200}$。然后计算以下汇总统计量：\n- 平均误差：$\\overline{e} = \\frac{1}{T} \\sum_{i=1}^T e_i$。\n- 误差标准差：$\\operatorname{std}(e) = \\sqrt{\\frac{1}{T-1} \\sum_{i=1}^T (e_i - \\overline{e})^2}$。\n- 误差的第 $95$ 百分位数：$q_{0.95}$，即 $95\\%$ 的观测误差都低于此值。\n\n这些步骤通过编程实现，为指定的测试套件生成所需的输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Designs and implements a Monte Carlo simulation to quantify the localization\n    error distribution of the LCMV beamformer.\n    \"\"\"\n    # Set a seed for reproducibility of random number generation.\n    np.random.seed(0)\n\n    # --- Fixed Parameters ---\n    M = 12  # Number of sensors\n    R = 0.09  # Radius of sensor circle in meters\n    r_true = np.array([0.03, -0.02, 0.0])  # True source location in meters\n    sigma_s2 = 1.0  # Source signal variance\n    sigma_n = 0.1  # Sensor noise standard deviation\n    rho = 0.1  # Sensor noise correlation\n    T = 200  # Number of Monte Carlo trials per condition\n\n    # --- Sensor Array and Scanning Grid Setup ---\n    # Sensor positions\n    thetas = np.linspace(0, 2 * np.pi, M, endpoint=False)\n    sensor_pos = np.zeros((M, 3))\n    sensor_pos[:, 0] = R * np.cos(thetas)\n    sensor_pos[:, 1] = R * np.sin(thetas)\n\n    # Scanning grid positions\n    grid_coords = np.arange(-0.06, 0.061, 0.01) # Use 0.061 to include endpoint\n    grid_x, grid_y = np.meshgrid(grid_coords, grid_coords)\n    grid_points = np.vstack([grid_x.ravel(), grid_y.ravel(), np.zeros(grid_x.size)]).T\n\n    # --- Pre-computation ---\n    # Lead fields for all grid points\n    # L_grid has shape (M, num_grid_points)\n    dist_sq_grid = np.sum((grid_points[np.newaxis, :, :] - sensor_pos[:, np.newaxis, :])**2, axis=2)\n    # Avoid division by zero if a grid point coincides with a sensor\n    dist_sq_grid[dist_sq_grid == 0] = 1e-12 \n    L_grid = 1.0 / dist_sq_grid\n    \n    # Lead field for the true source location\n    dist_sq_true = np.sum((r_true - sensor_pos)**2, axis=1)\n    l_true = 1.0 / dist_sq_true\n    l_true = l_true[:, np.newaxis] # Shape (M, 1)\n\n    # Noise covariance matrix\n    I = np.eye(M)\n    ones_vec = np.ones((M, M))\n    Sigma_n = sigma_n**2 * ((1 - rho) * I + rho * ones_vec)\n    noise_mean = np.zeros(M)\n    \n    # Test suite from the problem statement\n    test_cases = [\n        (24, 0.0),\n        (24, 10**-3),\n        (64, 0.0),\n        (64, 10**-3),\n        (256, 0.0),\n        (256, 10**-2),\n    ]\n\n    results = []\n\n    for N, lam in test_cases:\n        localization_errors = np.zeros(T)\n\n        for t in range(T):\n            # 1. Data Generation\n            s = np.random.normal(0, np.sqrt(sigma_s2), size=N)\n            n = np.random.multivariate_normal(noise_mean, Sigma_n, size=N).T # Shape (M, N)\n            x = l_true * s + n  # Signal + Noise, shape (M, N)\n\n            # 2. Covariance Estimation\n            x_demeaned = x - np.mean(x, axis=1, keepdims=True)\n            C_hat = (x_demeaned @ x_demeaned.T) / N\n\n            # 3. Regularization\n            alpha = np.trace(C_hat) / M\n            C_lam = C_hat + lam * alpha * I\n\n            # 4. Source Scanning\n            try:\n                C_lam_inv = np.linalg.inv(C_lam)\n                # Denominator of power expression: l(r)^T * C_inv * l(r)\n                # Vectorized computation for all grid points\n                denominators = np.sum(L_grid * (C_lam_inv @ L_grid), axis=0)\n                # Power is 1/denominator; find max power\n                best_idx = np.argmax(1.0 / denominators)\n            except np.linalg.LinAlgError:\n                # If matrix is singular (can happen with lambda=0), localization fails.\n                # A robust simulation would handle this, but for this specific problem\n                # setup, N  M so the matrix is invertible with probability 1.\n                # We add the handler as a safeguard.\n                max_grid_err = np.max(np.linalg.norm(grid_points - r_true, axis=1))\n                localization_errors[t] = max_grid_err\n                continue\n\n            r_hat = grid_points[best_idx]\n\n            # 5. Error Calculation\n            error = np.linalg.norm(r_hat - r_true)\n            localization_errors[t] = error\n        \n        # --- Summary Statistics ---\n        mean_e = np.mean(localization_errors)\n        std_e = np.std(localization_errors, ddof=1) # Sample standard deviation\n        q95_e = np.quantile(localization_errors, 0.95)\n        \n        result_tuple = [N, lam, mean_e, std_e, q95_e]\n        results.append(result_tuple)\n\n    # Format the final output string\n    # str(list) produces '[val1, val2, ...]' which matches the format\n    formatted_results = ','.join(map(str, results))\n    print(f\"[{formatted_results}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "真实世界的数据分析充满了实际挑战，从算法实现转向故障排除是至关重要的一步。本练习探讨了波束形成中最常见的陷阱之一：由病态或秩亏的协方差矩阵引起的数值不稳定性。您将批判性地评估一系列标准的诊断检查和补救措施，从而巩固您对如何确保波束形成结果稳定且科学有效的理解 。",
            "id": "4141744",
            "problem": "您正在使用线性约束最小方差（Linear Constrained Minimum Variance, LCMV）波束形成器分析脑磁图（magnetoencephalography）数据，以进行皮层源定位。前向模型通过一个导联场矩阵（leadfield matrix）将源映射到传感器，而 LCMV 方法旨在寻找一组传感器权重，以最小化阵列输出功率，同时满足对候选源的单位增益约束。您的传感器阵列有 $M$ 个通道，您从每个包含 $N$ 个样本的短时间窗口中估计数据协方差矩阵 $C$。在实践中，当 $N  M$ 时，样本协方差矩阵 $C$ 会变得秩亏（rank-deficient），这可能导致 LCMV 权重不稳定，因为计算过程涉及求解由 $C$ 控制的线性系统和施加线性约束。相干源动态成像（Dynamic Imaging of Coherent Sources, DICS）方法是一种频域上的类似方法，它使用目标频率上的交叉谱密度（cross-spectral density）；根据分段（segments）/锥窗（tapers）的数量，可能会出现类似的条件数问题。\n\n从以下定义出发：(i) 样本协方差为 $C = \\frac{1}{N} X X^{\\top}$，其中数据矩阵 $X \\in \\mathbb{R}^{M \\times N}$；(ii) $\\mathrm{rank}(C) \\leq \\min(M, N)$；(iii) LCMV 权重是通过最小化 $w^{\\top} C w$ 并在 $w$ 上施加线性约束得到的。请在存在 $N  M$、传感器间共线性以及有限样本噪声的情况下，找出那些用于检查和修正以确保 LCMV 权重稳定性的科学合理程序。选择所有适用项。\n\nA. 检查 $C$ 的特征值谱并计算条件数 $\\kappa(C)$；如果若干特征值接近于零或 $\\kappa(C)$ 很大，则预期会出现不稳定性，并采取相应措施。\n\nB. 应用 Tikhonov 正则化，通过构建 $C_{\\mathrm{reg}} = C + \\lambda I$（其中 $\\lambda  0$ 通过有原则的标准，例如交叉验证或L曲线来选择），然后在 LCMV 优化中使用 $C_{\\mathrm{reg}}$。\n\nC. 在合理的平稳性假设下，通过聚合更多的时间样本或试验来增加 $N$，以改善 $C$ 的秩和条件数。\n\nD. 使用 $C$ 的 Moore–Penrose 伪逆，不进行奇异值阈值处理（接受默认的数值公差），从而在处理 $N  M$ 的同时避免显式正则化。\n\nE. 在估计协方差之前，将传感器数据投影到前 $r$ 个主成分上（$r \\leq N$），在降维后的空间中执行 LCMV 计算，然后将得到的权重反向投影回完整的传感器空间。\n\nF. 将 $C$ 替换为目标频率的交叉谱密度，并使用相同的约束执行相干源动态成像（DICS）；频域平均即使在 $N  M$ 时也能保证满秩。\n\nG. 对导联场矩阵的列进行正交规范化以处理矢量源方向，并通过检查约束矩阵是否为列满秩来验证约束的可行性；这可以减少数值耦合并提高稳定性。\n\nH. 使用从基线期独立估计的噪声协方差 $C_{n}$ 对传感器数据进行白化处理，采用秩感知白化（rank-aware whitening）丢弃接近零的特征值，然后在白化空间中估计 $C$ 并计算权重；通过将权重重新应用于留出试验来评估稳定性。\n\nI. 在估计 $C$ 之前，对每个传感器进行 Z-score 标准化以使其方差为1，这确保了 $C=I$，从而使问题具有完美的条件数。",
            "solution": "问题描述了在使用诸如线性约束最小方差（LCMV）方法之类的波束形成技术进行脑磁图（MEG）和脑电图（EEG）源定位时一个常见且关键的问题。问题的核心是当用于估计的样本协方差矩阵是秩亏或病态（ill-conditioned）时，波束形成器的权重会不稳定，这种情况在用于估计的时间样本数（$N$）小于传感器数（$M$）时经常发生。问题要求找出用于诊断和纠正这种不稳定性的科学合理程序。\n\n首先，我将验证问题陈述。\n\n### 步骤1：提取已知条件\n- **方法：** 用于脑磁图（MEG）数据皮层源定位的线性约束最小方差（LCMV）波束形成器。\n- **系统组成部分：** $M$ 个传感器通道，数据协方差矩阵 $C$，由一个导联场矩阵表示的前向模型。\n- **LCMV 目标：** 最小化传感器权重输出功率 $w^{\\top} C w$，同时满足对候选源的单位增益约束。\n- **关键条件：** 每个窗口的样本数 $N$ 小于通道数 $M$（$N  M$）。\n- **后果：** 样本协方差矩阵 $C$ 变得秩亏，导致 LCMV 权重不稳定。\n- **不稳定的原因：** 计算需要求解涉及 $C$ 的线性系统，如果 $C$ 是奇异的，该问题就是不适定的。条件 $N  M$ 保证了样本协方差 $C = \\frac{1}{N} XX^{\\top}$ 是秩亏的，因为它的秩不能超过 $N$。\n- **类似方法：** 相干源动态成像（DICS），一种频域上的类似方法，面临类似的条件数问题。\n- **形式化定义：**\n    - (i) 样本协方差矩阵：$C = \\frac{1}{N} X X^{\\top}$，其中数据矩阵 $X \\in \\mathbb{R}^{M \\times N}$。\n    - (ii) 秩属性：$\\mathrm{rank}(C) \\leq \\min(M, N)$。\n    - (iii) 优化问题：最小化 $w^{\\top} C w$，并对 $w$ 施加线性约束。\n- **问题：** 在 $N  M$、传感器共线性以及有限样本噪声的条件下，找出检查和纠正 LCMV 权重不稳定性的合理程序。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据：** 该问题牢固地植根于统计信号处理和神经影像数据分析的成熟领域。LCMV 波束形成、协方差估计、由 $N  M$ 引起的秩亏以及正则化方法都是标准且有据可查的概念。表述是准确的。（结论：有效）\n- **适定性：** 任务是根据已建立的科学原则来评估一组提议的程序。这是一个适定问题，根据数值线性代数和波束形成的文献，它有一组确定的正确答案。（结论：有效）\n- **客观性：** 语言技术性强且精确。没有主观或基于意见的陈述。（结论：有效）\n- **完整性与一致性：** 问题提供了足够的背景来理解在 LCMV 公式中对秩亏的样本协方差矩阵求逆的挑战。没有内部矛盾。$N  M$ 导致 $C$ 秩亏（因为 $\\mathrm{rank}(XX^{\\top}) = \\mathrm{rank}(X) \\leq N$）的前提在数学上是正确的。（结论：有效）\n- **现实性：** $N  M$ 的场景非常现实，是时间分辨的 M/EEG 分析中一个常见的挑战，其中短时间窗口被用来捕捉神经动态。（结论：有效）\n\n### 步骤3：结论与行动\n问题陈述是有效的。它科学合理、适定，并准确描述了神经科学数据分析中的一个现实挑战。我现在将通过评估每个选项来推导出正确答案。\n\n### 推导与选项分析\n\nLCMV 波束形成器通过解决以下约束优化问题来确定给定位置源的最优权重向量 $w$：\n$$ \\min_{w} w^{\\top} C w \\quad \\text{subject to} \\quad L^{\\top} w = \\mathbf{1} $$\n其中 $C$ 是 $M \\times M$ 的数据协方差矩阵，$L$ 是该源的 $M \\times d$ 导联场矩阵（对于标量源 $d=1$，对于矢量源 $d=3$）。该解可使用拉格朗日乘子法求得，其形式为：\n$$ w = C^{-1} L (L^{\\top} C^{-1} L)^{-1} \\mathbf{1} $$\n关键的计算步骤是协方差矩阵的求逆，即 $C^{-1}$。如果 $C$ 是秩亏的（其行列式为零）或病态的（其行列式接近于零），则矩阵的逆 $C^{-1}$ 要么不存在，要么数值不稳定。这种不稳定性会传播到权重 $w$ 上，可能导致 $w$ 变得任意大并由噪声主导。条件 $N  M$ 保证了样本协方差 $C = \\frac{1}{N} XX^{\\top}$ 是秩亏的，因为它的秩不能超过 $N$。因此，我们必须采用方法来诊断或解决这个问题。\n\n**A. 检查 $C$ 的特征值谱并计算条件数 $\\kappa(C)$；如果若干特征值接近于零或 $\\kappa(C)$ 很大，则预期会出现不稳定性，并采取相应措施。**\n条件数 $\\kappa(C) = \\frac{\\sigma_{\\max}}{\\sigma_{\\min}}$（其中 $\\sigma_{\\max}$ 和 $\\sigma_{\\min}$ 是 $C$ 的最大和最小奇异值）直接量化了矩阵求逆对数值误差的敏感性。对于像 $C$ 这样的半正定矩阵，这些奇异值就是最大和最小特征值。一个非常大的 $\\kappa(C)$ 或存在接近零的特征值是病态或奇异的明确标志。在尝试求解任何线性系统之前，这种检查是数值线性代数中一个标准且必要的诊断步骤。它确认了是否有必要采取补救措施。\n**结论：正确**\n\n**B. 应用 Tikhonov 正则化，通过构建 $C_{\\mathrm{reg}} = C + \\lambda I$（其中 $\\lambda  0$ 通过有原则的标准，例如交叉验证或L曲线来选择），然后在 LCMV 优化中使用 $C_{\\mathrm{reg}}$。**\nTikhonov 正则化是解决不适定反问题的一种经典而稳健的方法。通过加上一个小的、正的单位矩阵倍数，$C_{\\mathrm{reg}} = C + \\lambda I$，得到的矩阵保证是可逆的。如果 $C$ 的特征值是 $\\mu_i \\ge 0$，那么对于 $\\lambda  0$，$C_{\\mathrm{reg}}$ 的特征值就是 $\\mu_i + \\lambda  0$。这将特征值“提升”使其远离零，从而使矩阵成为良态的，其逆矩阵也变得稳定。正则化参数 $\\lambda$ 控制着对原始数据的保真度与解的稳定性之间的权衡。通过有原则的方法选择 $\\lambda$ 对获得良好性能至关重要。这是一种主要且广泛使用的补救方法。\n**结论：正确**\n\n**C. 在合理的平稳性假设下，通过聚合更多的时间样本或试验来增加 $N$，以改善 $C$ 的秩和条件数。**\n秩亏的根本原因是 $N  M$。一个直接的解决方案是增加用于估计 $C$ 的数据量，使得 $N \\ge M$。如果可以从相同的平稳过程中获得更多数据（例如，更长的时间窗口或更多的实验试验），将它们聚合起来会增加 $N$。当 $N$ 接近并超过 $M$ 时，假设底层信号不是完全共线性的，样本协方差 $C$ 通常会变成满秩且条件更好的。关于平稳性的告诫在科学上是至关重要的，并且被正确地指出了。\n**结论：正确**\n\n**D. 使用 $C$ 的 Moore–Penrose 伪逆，不进行奇异值阈值处理（接受默认的数值公差），从而在处理 $N  M$ 的同时避免显式正则化。**\nMoore-Penrose 伪逆 $C^{+}$ 为线性系统提供了一个最小二乘解。它是通过奇异值分解（SVD）计算得出的，方法是只对非零奇异值进行求逆。在实践中，会使用一个数值公差来区分非零和零奇异值。然而，在存在噪声的情况下，协方差矩阵有许多小的、非零的奇异值，这些奇异值主要由噪声驱动。对这些小值求逆会导致噪声的放大，而这正是我们试图避免的问题。使用通用的、默认的数值公差并没有根据数据的信噪比进行调整，因此不是一个合理的科学程序。一个稳健的应用需要仔细地对奇异值进行阈值处理，这本身就是一种正则化形式。所描述的程序是幼稚的，容易失败。\n**结论：错误**\n\n**E. 在估计协方差之前，将传感器数据投影到前 $r$ 个主成分上（$r \\leq N$），在降维后的空间中执行 LCMV 计算，然后将得到的权重反向投影回完整的传感器空间。**\n这个过程是一种降维形式，也称为截断SVD（truncated SVD）或基于主成分分析（PCA）的正则化。由于数据空间的有效秩最多为 $N$，将数据投影到前 $r \\le N$ 个主成分（即 $C$ 对应于最大特征值的特征向量）上，可以捕捉数据子空间，同时丢弃方差为零或接近零的维度（这些维度是空的或由噪声主导的）。然后，在这个更小的、条件良好的 $r$ 维空间中解决 LCMV 问题。得到的权重可以被投影回原始的 $M$ 维传感器空间。这是正则化协方差矩阵的一种标准而有效的方法。\n**结论：正确**\n\n**F. 将 $C$ 替换为目标频率的交叉谱密度，并使用相同的约束执行相干源动态成像（DICS）；频域平均即使在 $N  M$ 时也能保证满秩。**\nDICS 是 LCMV 的频域类似物，并使用交叉谱密度（CSD）矩阵。CSD 通常通过对多个短期分段或试验的频谱图进行平均来估计。估计出的 CSD 矩阵的秩受限于被平均的分段数，我们称之为 $K$。如果 $K  M$，CSD 矩阵将是秩亏的，就像时域协方差矩阵在 $N  M$ 时一样。关于频域平均“保证”满秩的说法是错误的。从 LCMV 切换到 DICS 本身并不能解决秩亏问题；它只是将问题重新表述为平均分段/锥窗的数量。\n**结论：错误**\n\n**G. 对导联场矩阵的列进行正交规范化以处理矢量源方向，并通过检查约束矩阵是否为列满秩来验证约束的可行性；这可以减少数值耦合并提高稳定性。**\nLCMV 权重计算的稳定性不仅取决于 $C$ 的条件数，还取决于约束矩阵 $L$ 以及最终要求逆的矩阵 $(L^{\\top} C^{-1} L)$ 的条件数。对于矢量波束形成器，对应于不同偶极子方向的 $L$ 的列可能接近共线性。对它们进行正交规范化可以改善约束集的数值特性。此外，验证约束矩阵 $L$ 是否为列满秩是问题适定的一个先决条件。这些是确保波束形成器解的整体数值稳定性和正确性的有效且重要的程序，是对 $C$ 的正则化的补充。\n**结论：正确**\n\n**H. 使用从基线期独立估计的噪声协方差 $C_{n}$ 对传感器数据进行白化处理，采用秩感知白化（rank-aware whitening）丢弃接近零的特征值，然后在白化空间中估计 $C$ 并计算权重；通过将权重重新应用于留出试验来评估稳定性。**\n预白化（Pre-whitening）是一种复杂的正则化技术。它使用一个独立的噪声协方差估计 $C_n$ 来变换数据，使得新空间中的噪声协方差为单位矩阵。白化矩阵 $W$ 与 $C_n^{-1/2}$ 相关。“秩感知白化”（rank-aware whitening）这个说法正确地暗示了必须使用 $C_n$ 的正则化逆来计算 $W$，以防止在白化步骤中放大噪声。然后在白化后的数据上解决 LCMV 问题，此时噪声的结构已被考虑在内。这是一种强大且科学合理的方法。在留出数据上评估稳定性是一种标准的模型验证技术。\n**结论：正确**\n\n**I. 在估计 $C$ 之前，对每个传感器进行 Z-score 标准化以使其方差为1，这确保了 $C=I$，从而使问题具有完美的条件数。**\n对一个变量进行 Z-score 标准化意味着减去其均值并除以其标准差。将此应用于每个传感器通道会迫使后续协方差矩阵的对角元素为1。得到的这个矩阵是相关矩阵，而不是单位矩阵 $I$。代表传感器之间相关性的非对角元素通常是非零的。如果传感器高度相关（这在 M/EEG 中是预期的），相关矩阵可能与原始协方差矩阵一样病态或秩亏。声称 z-scoring 确保 $C=I$ 在事实上是不正确的。因此，所提出的理由从根本上就是有缺陷的。\n**结论：错误**\n\n正确选项总结：A、B、C、E、G、H。",
            "answer": "$$\\boxed{ABCEGH}$$"
        }
    ]
}