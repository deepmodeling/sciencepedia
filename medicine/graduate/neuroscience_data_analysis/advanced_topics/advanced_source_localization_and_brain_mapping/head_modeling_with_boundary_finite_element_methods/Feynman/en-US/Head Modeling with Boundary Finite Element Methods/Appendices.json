{
    "hands_on_practices": [
        {
            "introduction": "The Finite Element Method (FEM) is a powerful technique that transforms the continuous differential equations governing physics into a discrete system of linear equations that can be solved computationally. This foundational exercise guides you through the process of constructing the FEM stiffness matrix from first principles for a single tetrahedral element, the basic building block of a 3D head model. By completing this practice , you will gain a concrete understanding of how the properties of the stiffness matrix, such as symmetry and definiteness, directly emerge from the underlying physics and geometry of the problem.",
            "id": "4168180",
            "problem": "In forward modeling for electroencephalography in neuroscience data analysis, the head can be represented as a piecewise homogeneous volume conductor. Both the Boundary Element Method (BEM) and the Finite Element Method (FEM) are used. Consider a single homogeneous isotropic compartment with scalar conductivity $\\,\\sigma > 0\\,$ represented by the tetrahedron $\\,\\Omega\\,$ with vertices at $\\,\\mathbf{x}_{1} = (0,0,0)\\,$, $\\,\\mathbf{x}_{2} = (1,0,0)\\,$, $\\,\\mathbf{x}_{3} = (0,1,0)\\,$, and $\\,\\mathbf{x}_{4} = (0,0,1)\\,$. Let $\\,u\\,$ denote the electric potential governed by the static current continuity equation $\\,\\nabla \\cdot (\\sigma \\nabla u) = 0\\,$ in $\\,\\Omega\\,$, with homogeneous Neumann boundary conditions $\\,\\mathbf{n} \\cdot (\\sigma \\nabla u) = 0\\,$ on $\\,\\partial \\Omega\\,$. Use the standard continuous piecewise linear (hat) basis on the tetrahedron, with nodal basis functions $\\,N_{i}\\,$ corresponding to nodes $\\,\\mathbf{x}_{i}\\,$ for $\\,i \\in \\{1,2,3,4\\}\\,$.\n\nTasks:\n- Starting from the weak form of the governing equation, assemble the global FEM stiffness matrix $\\,\\mathbf{K} \\in \\mathbb{R}^{4 \\times 4}\\,$ and the load vector $\\,\\mathbf{f} \\in \\mathbb{R}^{4}\\,$ using the above basis on the given tetrahedron.\n- From first principles, verify that $\\,\\mathbf{K}\\,$ is symmetric and positive semidefinite under the stated Neumann boundary conditions, and identify the dimension and a basis vector of its nullspace.\n- Determine the spectrum of $\\,\\mathbf{K}\\,$ explicitly and report the smallest strictly positive eigenvalue as a closed-form analytic expression in terms of $\\,\\sigma\\,$.\n\nYour final answer must be the smallest strictly positive eigenvalue of $\\,\\mathbf{K}\\,$ expressed in terms of $\\,\\sigma\\,$ only, with no units. Do not round; provide the exact expression.",
            "solution": "The problem requires the determination of the smallest strictly positive eigenvalue of the Finite Element Method (FEM) stiffness matrix for a specific electrostatic problem. The problem is first validated as being well-posed and scientifically sound, allowing for a complete solution.\n\nThe governing equation for the electric potential $u$ in a homogeneous isotropic medium with conductivity $\\sigma$ and no current sources is the Laplace equation, which follows from the static current continuity equation $\\nabla \\cdot \\mathbf{J} = 0$ with $\\mathbf{J} = -\\sigma \\nabla u$. For constant $\\sigma > 0$, this simplifies to $\\sigma \\nabla^2 u = 0$, or $\\nabla^2 u = 0$.\n\nTo derive the FEM system, we start with the weak formulation. We multiply the governing equation $\\nabla \\cdot (\\sigma \\nabla u) = 0$ by a test function $v$ and integrate over the domain $\\Omega$:\n$$ \\int_{\\Omega} v (\\nabla \\cdot (\\sigma \\nabla u)) dV = 0 $$\nApplying Green's first identity (integration by parts in multiple dimensions) gives:\n$$ \\int_{\\partial \\Omega} v (\\sigma \\nabla u) \\cdot \\mathbf{n} \\, dS - \\int_{\\Omega} \\nabla v \\cdot (\\sigma \\nabla u) dV = 0 $$\nwhere $\\partial \\Omega$ is the boundary of the domain and $\\mathbf{n}$ is the outward unit normal vector. The problem specifies homogeneous Neumann boundary conditions, $\\mathbf{n} \\cdot (\\sigma \\nabla u) = 0$ on $\\partial \\Omega$. This condition states that there is no current flow across the boundary. Consequently, the boundary integral vanishes, and the weak form of the problem is to find a potential $u \\in H^1(\\Omega)$ such that for all test functions $v \\in H^1(\\Omega)$:\n$$ \\int_{\\Omega} \\sigma (\\nabla u \\cdot \\nabla v) dV = 0 $$\nIn the FEM, the potential $u$ is approximated by a linear combination of basis functions $N_j(\\mathbf{x})$, $u_h(\\mathbf{x}) = \\sum_{j=1}^{4} u_j N_j(\\mathbf{x})$, where $u_j$ are the unknown potential values at the four nodes $\\mathbf{x}_j$ of the tetrahedron. The Galerkin method uses the basis functions as test functions, i.e., $v = N_i$ for $i \\in \\{1, 2, 3, 4\\}$. Substituting these into the weak form yields a system of linear equations:\n$$ \\sum_{j=1}^{4} \\left( \\int_{\\Omega} \\sigma (\\nabla N_i \\cdot \\nabla N_j) dV \\right) u_j = 0 $$\nThis system is expressed in matrix form as $\\mathbf{K} \\mathbf{u} = \\mathbf{f}$, where $\\mathbf{u} = [u_1, u_2, u_3, u_4]^T$. The entries of the stiffness matrix $\\mathbf{K} \\in \\mathbb{R}^{4 \\times 4}$ are given by:\n$$ K_{ij} = \\int_{\\Omega} \\sigma (\\nabla N_i \\cdot \\nabla N_j) dV $$\nSince there are no internal or boundary source terms, the load vector is the zero vector, $\\mathbf{f} = \\mathbf{0} \\in \\mathbb{R}^4$.\n\nThe domain $\\Omega$ is a tetrahedron with vertices $\\mathbf{x}_{1} = (0,0,0)$, $\\mathbf{x}_{2} = (1,0,0)$, $\\mathbf{x}_{3} = (0,1,0)$, and $\\mathbf{x}_{4} = (0,0,1)$. For a point $\\mathbf{x}=(x,y,z)$ in this tetrahedron, the linear (hat) basis functions $N_i$ are the barycentric coordinates:\n$N_1(\\mathbf{x}) = 1-x-y-z$\n$N_2(\\mathbf{x}) = x$\n$N_3(\\mathbf{x}) = y$\n$N_4(\\mathbf{x}) = z$\nThese functions are linear, so their gradients are constant over the tetrahedron:\n$\\nabla N_1 = (-1, -1, -1)$\n$\\nabla N_2 = (1, 0, 0)$\n$\\nabla N_3 = (0, 1, 0)$\n$\\nabla N_4 = (0, 0, 1)$\n\nThe volume of the tetrahedron, $V$, is $V = \\frac{1}{6} |\\det(\\mathbf{x}_2-\\mathbf{x}_1, \\mathbf{x}_3-\\mathbf{x}_1, \\mathbf{x}_4-\\mathbf{x}_1)| = \\frac{1}{6} |\\det(\\mathbf{I})| = \\frac{1}{6}$. Since $\\sigma$ and the gradients are constant over $\\Omega$, the integral for $K_{ij}$ simplifies to $K_{ij} = \\sigma (\\nabla N_i \\cdot \\nabla N_j) V = \\frac{\\sigma}{6} (\\nabla N_i \\cdot \\nabla N_j)$. We compute the dot products of the gradients:\n$\\nabla N_1 \\cdot \\nabla N_1 = 3$\n$\\nabla N_2 \\cdot \\nabla N_2 = 1$\n$\\nabla N_3 \\cdot \\nabla N_3 = 1$\n$\\nabla N_4 \\cdot \\nabla N_4 = 1$\n$\\nabla N_1 \\cdot \\nabla N_2 = -1$, $\\nabla N_1 \\cdot \\nabla N_3 = -1$, $\\nabla N_1 \\cdot \\nabla N_4 = -1$\n$\\nabla N_2 \\cdot \\nabla N_3 = 0$, $\\nabla N_2 \\cdot \\nabla N_4 = 0$, $\\nabla N_3 \\cdot \\nabla N_4 = 0$\nAssembling these values gives the stiffness matrix $\\mathbf{K}$:\n$$ \\mathbf{K} = \\frac{\\sigma}{6} \\begin{pmatrix} 3 & -1 & -1 & -1 \\\\ -1 & 1 & 0 & 0 \\\\ -1 & 0 & 1 & 0 \\\\ -1 & 0 & 0 & 1 \\end{pmatrix} $$\nThe matrix is symmetric, as expected from $K_{ij}=K_{ji}$. It is positive semidefinite because for any vector $\\mathbf{c} \\in \\mathbb{R}^4$, the quadratic form $\\mathbf{c}^T \\mathbf{K} \\mathbf{c} = \\int_{\\Omega} \\sigma ||\\nabla(\\sum_j c_j N_j)||^2 dV \\ge 0$. The nullspace consists of vectors $\\mathbf{c}$ for which $\\nabla(\\sum_j c_j N_j) = \\mathbf{0}$, which implies $\\sum_j c_j N_j$ is a constant. As $\\sum_j N_j = 1$, this occurs when $c_1=c_2=c_3=c_4$. Thus, the nullspace has dimension $1$ and is spanned by the vector $(1,1,1,1)^T$. This corresponds to an eigenvalue of $0$.\n\nTo find the other eigenvalues, we analyze the matrix $\\mathbf{K}' = \\frac{6}{\\sigma}\\mathbf{K}$:\n$$ \\mathbf{K}' = \\begin{pmatrix} 3 & -1 & -1 & -1 \\\\ -1 & 1 & 0 & 0 \\\\ -1 & 0 & 1 & 0 \\\\ -1 & 0 & 0 & 1 \\end{pmatrix} $$\nThe eigenvalues $\\lambda$ of $\\mathbf{K}$ are related to the eigenvalues $\\lambda'$ of $\\mathbf{K}'$ by $\\lambda = \\frac{\\sigma}{6}\\lambda'$. We find the characteristic polynomial of $\\mathbf{K}'$:\n$$ P(\\lambda') = \\det(\\mathbf{K}' - \\lambda' \\mathbf{I}) = \\det \\begin{pmatrix} 3-\\lambda' & -1 & -1 & -1 \\\\ -1 & 1-\\lambda' & 0 & 0 \\\\ -1 & 0 & 1-\\lambda' & 0 \\\\ -1 & 0 & 0 & 1-\\lambda' \\end{pmatrix} $$\nExpanding the determinant, we get:\n$P(\\lambda') = (3-\\lambda')(1-\\lambda')^3 - 3(1-\\lambda')^2 = (1-\\lambda')^2[(3-\\lambda')(1-\\lambda') - 3]$\n$P(\\lambda') = (1-\\lambda')^2[3 - 4\\lambda' + (\\lambda')^2 - 3] = (1-\\lambda')^2[(\\lambda')^2 - 4\\lambda']$\n$P(\\lambda') = \\lambda'(\\lambda' - 4)(1-\\lambda')^2$\nThe roots are $\\lambda' = 0$ (multiplicity $1$), $\\lambda' = 1$ (multiplicity $2$), and $\\lambda' = 4$ (multiplicity $1$).\nThe spectrum of $\\mathbf{K}'$ is $\\{0, 1, 1, 4\\}$.\nThe spectrum of $\\mathbf{K}$ is obtained by multiplying these values by $\\frac{\\sigma}{6}$:\n$$ \\text{Spectrum}(\\mathbf{K}) = \\left\\{ \\frac{\\sigma}{6} \\cdot 0, \\frac{\\sigma}{6} \\cdot 1, \\frac{\\sigma}{6} \\cdot 1, \\frac{\\sigma}{6} \\cdot 4 \\right\\} = \\left\\{ 0, \\frac{\\sigma}{6}, \\frac{\\sigma}{6}, \\frac{2\\sigma}{3} \\right\\} $$\nThe strictly positive eigenvalues are $\\frac{\\sigma}{6}$ and $\\frac{2\\sigma}{3}$. Since $\\sigma > 0$, the smallest of these is $\\frac{\\sigma}{6}$.",
            "answer": "$$\\boxed{\\frac{\\sigma}{6}}$$"
        },
        {
            "introduction": "Beyond simply calculating the electric field for a given anatomy, computational head models are invaluable tools for investigating how anatomical variability impacts bioelectric measurements. This practice problem explores this application by guiding you through the derivation and implementation of a simplified one-dimensional model to quantify the sensitivity of the EEG signal to changes in skull properties. Working through this exercise  will demonstrate how to perform a sensitivity analysis, a crucial skill for understanding the sources of variance and the robustness of conclusions drawn from EEG data.",
            "id": "4168157",
            "problem": "Consider the electroencephalography forward problem in the quasi-static regime of Maxwellâ€™s equations for a piecewise homogeneous, isotropic, layered head model. Let the electric potential be denoted by $\\phi(\\mathbf{r})$, electrical conductivity by $\\sigma(\\mathbf{r})$, and the electric field by $\\mathbf{E}(\\mathbf{r})$. In the quasi-static limit relevant for electroencephalography, the governing equation in a source-free region is $\\nabla \\cdot \\left( \\sigma(\\mathbf{r}) \\nabla \\phi(\\mathbf{r}) \\right) = 0$, with $\\mathbf{E}(\\mathbf{r}) = -\\nabla \\phi(\\mathbf{r})$ and current density $\\mathbf{J}(\\mathbf{r}) = \\sigma(\\mathbf{r}) \\mathbf{E}(\\mathbf{r})$. Lead-field reciprocity states that the potential at an electrode due to a current dipole in the brain equals the dot product of the dipole moment with the electric field at the dipole location created by a unit current at the electrode under the same boundary and material conditions.\n\nTo isolate the impact of skull thickness variability on lead fields, approximate a small neighborhood beneath an electrode by a locally planar, one-dimensional, four-layer conductor stack with uniform cross-sectional area and piecewise constant conductivities and thicknesses along the $z$-axis, normal to the layers. From top to bottom, the layers are scalp, skull, cerebrospinal fluid, and brain. Assume that the electric potential at the top boundary $z=0$ (electrode-skin interface) is fixed to a known value and that the potential at a reference depth $z=L$ inside the brain is grounded. Using this boundary value problem as the reciprocal drive, the electric field magnitude at a specified cortical depth is proportional to the electroencephalography lead-field magnitude for a cortical dipole at that depth and alignment, up to a multiplicative constant that depends on the choice of reciprocal drive normalization.\n\nYour tasks are:\n- Starting from $\\nabla \\cdot \\left( \\sigma(\\mathbf{r}) \\nabla \\phi(\\mathbf{r}) \\right) = 0$, $\\mathbf{E}(\\mathbf{r}) = -\\nabla \\phi(\\mathbf{r})$, and $\\mathbf{J}(\\mathbf{r}) = \\sigma(\\mathbf{r}) \\mathbf{E}(\\mathbf{r})$, reduce the problem to a one-dimensional ordinary differential equation for $\\phi(z)$ in the layered medium with piecewise constant $\\sigma(z)$. Impose Dirichlet boundary conditions $\\phi(0) = \\Delta V$ and $\\phi(L) = 0$ for a given electrode-to-reference potential difference $\\Delta V$, with $L$ equal to the sum of the layer thicknesses from the electrode to the cortical depth of interest.\n- Using continuity of normal current density and potential across interfaces, derive a closed-form expression for the electric field magnitude in the brain layer at the cortical depth of interest as a function of the layer thicknesses and conductivities, under the above Dirichlet boundary conditions. Express the result in volts per meter.\n- Derive the sensitivity of the brain-layer electric field magnitude with respect to the skull thickness, that is, the derivative of the field magnitude with respect to the skull thickness. Express the derivative in volts per meter per meter. Also derive the relative sensitivity defined as the derivative of the natural logarithm of the field magnitude with respect to the skull thickness. Express the relative sensitivity in inverse meters.\n- Implement a program that, for each test case in the suite below, computes three quantities: the electric field magnitude in the brain layer at the cortical depth of interest for $\\Delta V = 1$ volt, the absolute sensitivity with respect to skull thickness, and the relative sensitivity with respect to skull thickness. Use the planar, one-dimensional, four-layer model described above, with cross-sectional area set to unity so that the result is purely a function of thicknesses and conductivities. All thicknesses must be in meters and all conductivities in siemens per meter. Report the electric field magnitude in volts per meter, the absolute sensitivity in volts per meter per meter, and the relative sensitivity in inverse meters.\n\nScientific realism constraints:\n- Use physically plausible layer conductivities and thicknesses representative of the human head in the quasi-static regime.\n- Treat each layer as isotropic and homogeneous with piecewise constant conductivity along $z$. The cortex is modeled as the top subregion of the brain layer at the specified cortical depth.\n\nTest suite and output specification:\n- For all cases, set the electrode-to-reference potential difference to $\\Delta V = 1$ volt. The cross-sectional area is set to $1$ square meter.\n- Each test case is specified by a $7$-tuple $(t_{\\text{scalp}}, t_{\\text{skull}}, t_{\\text{csf}}, t_{\\text{brain}}, \\sigma_{\\text{scalp}}, \\sigma_{\\text{skull}}, \\sigma_{\\text{csf}}, \\sigma_{\\text{brain}})$ where $t_{\\cdot}$ are layer thicknesses in meters from the electrode down to the cortical depth of interest and $\\sigma_{\\cdot}$ are conductivities in siemens per meter. Note that $t_{\\text{brain}}$ is the cortical depth within the brain layer.\n- Use the following five test cases:\n    1. Baseline realistic values: $(t_{\\text{scalp}}, t_{\\text{skull}}, t_{\\text{csf}}, t_{\\text{brain}}, \\sigma_{\\text{scalp}}, \\sigma_{\\text{skull}}, \\sigma_{\\text{csf}}, \\sigma_{\\text{brain}}) = (0.006, 0.006, 0.002, 0.015, 0.43, 0.010, 1.79, 0.33)$.\n    2. Increased skull thickness: $(0.006, 0.010, 0.002, 0.015, 0.43, 0.010, 1.79, 0.33)$.\n    3. Near-minimal skull thickness: $(0.006, 0.001, 0.002, 0.015, 0.43, 0.010, 1.79, 0.33)$.\n    4. Reduced skull conductivity with baseline thickness: $(0.006, 0.006, 0.002, 0.015, 0.43, 0.004, 1.79, 0.33)$.\n    5. Uniformly thicker head to probe scaling: $(0.012, 0.012, 0.004, 0.030, 0.43, 0.010, 1.79, 0.33)$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, consisting of, in order for each test case, the electric field magnitude, the absolute sensitivity with respect to skull thickness, and the relative sensitivity, all rounded to six decimal places. For example, the list should have length $15$ and follow the pattern $[\\text{E}_1, \\text{SensAbs}_1, \\text{SensRel}_1, \\text{E}_2, \\text{SensAbs}_2, \\text{SensRel}_2, \\dots]$ with no additional text printed.",
            "solution": "The problem asks for the derivation and computation of the electric field and its sensitivities in a simplified one-dimensional, four-layer head model. The derivation proceeds from first principles as requested.\n\nThe governing equation for the electric potential $\\phi(\\mathbf{r})$ in a source-free, piecewise homogeneous, isotropic conductor in the quasi-static approximation is given as:\n$$ \\nabla \\cdot \\left( \\sigma(\\mathbf{r}) \\nabla \\phi(\\mathbf{r}) \\right) = 0 $$\nwhere $\\sigma(\\mathbf{r})$ is the electrical conductivity. The electric field is the negative gradient of the potential, $\\mathbf{E}(\\mathbf{r}) = -\\nabla \\phi(\\mathbf{r})$, and the current density is $\\mathbf{J}(\\mathbf{r}) = \\sigma(\\mathbf{r}) \\mathbf{E}(\\mathbf{r})$.\n\nFor the specified planar, one-dimensional model, the potential $\\phi$ and conductivity $\\sigma$ vary only along the $z$-axis, which is normal to the layers. Thus, $\\phi(\\mathbf{r})=\\phi(z)$ and $\\sigma(\\mathbf{r})=\\sigma(z)$. The gradient simplifies to $\\nabla\\phi = (0, 0, \\frac{d\\phi}{dz})\\hat{\\mathbf{k}}$, and the divergence operator applied to the vector field $\\mathbf{F} = \\sigma \\nabla \\phi$ becomes $\\nabla \\cdot \\mathbf{F} = \\frac{d F_z}{dz}$. The governing equation reduces to a one-dimensional ordinary differential equation:\n$$ \\frac{d}{dz} \\left( \\sigma(z) \\frac{d\\phi}{dz} \\right) = 0 $$\nIntegrating this equation once with respect to $z$ yields:\n$$ \\sigma(z) \\frac{d\\phi}{dz} = C $$\nwhere $C$ is a constant of integration. The term $-\\sigma(z) \\frac{d\\phi}{dz}$ represents the component of the current density normal to the layers, $J_z$. Thus, the equation implies that the normal current density is constant throughout the layered medium: $J_z = \\sigma(z) E_z(z) = -C = J_0$.\n\nThe model consists of four layers: scalp (1), skull (2), cerebrospinal fluid (CSF) (3), and brain (4). Each layer $i$ has a uniform thickness $t_i$ and a constant conductivity $\\sigma_i$. The interfaces are located at depths $z_0=0$, $z_1=t_1$, $z_2=t_1+t_2$, and $z_3=t_1+t_2+t_3$. The reference depth is at $z_4=L=t_1+t_2+t_3+t_4$.\n\nThe problem states Dirichlet boundary conditions $\\phi(0) = \\Delta V$ and $\\phi(L) = 0$. The total potential difference across the stack is $\\phi(0) - \\phi(L) = \\Delta V$. This potential difference can also be expressed as the integral of the electric field $E(z) = -d\\phi/dz$ over the total thickness $L$:\n$$ \\Delta V = \\int_0^L E(z) dz $$\nSince the medium is piecewise constant, this integral becomes a sum of potential drops across each layer:\n$$ \\Delta V = \\sum_{i=1}^4 \\int_{z_{i-1}}^{z_i} E_i dz = \\sum_{i=1}^4 E_i t_i $$\nwhere $E_i$ is the constant electric field magnitude in layer $i$. From the constant current density relation $J_0 = \\sigma_i E_i$, we can express the field as $E_i = J_0 / \\sigma_i$. Substituting this into the expression for $\\Delta V$:\n$$ \\Delta V = \\sum_{i=1}^4 \\left(\\frac{J_0}{\\sigma_i}\\right) t_i = J_0 \\sum_{i=1}^4 \\frac{t_i}{\\sigma_i} $$\nLet $R_{tot} = \\sum_{i=1}^4 \\frac{t_i}{\\sigma_i}$ be the total resistance of the stack per unit area. We can solve for the constant current density $J_0$:\n$$ J_0 = \\frac{\\Delta V}{R_{tot}} = \\frac{\\Delta V}{\\frac{t_{scalp}}{\\sigma_{scalp}} + \\frac{t_{skull}}{\\sigma_{skull}} + \\frac{t_{csf}}{\\sigma_{csf}} + \\frac{t_{brain}}{\\sigma_{brain}}} $$\nThe electric field magnitude in the brain layer (layer $4$) is what we seek. It is given by $E_{brain} = J_0 / \\sigma_{brain}$. Substituting the expression for $J_0$, we obtain the closed-form expression for the electric field:\n$$ E_{brain} = \\frac{1}{\\sigma_{brain}} \\frac{\\Delta V}{R_{tot}} = \\frac{\\Delta V}{\\sigma_{brain} \\left( \\frac{t_{scalp}}{\\sigma_{scalp}} + \\frac{t_{skull}}{\\sigma_{skull}} + \\frac{t_{csf}}{\\sigma_{csf}} + \\frac{t_{brain}}{\\sigma_{brain}} \\right)} $$\n\nNext, we derive the sensitivity of the brain-layer electric field magnitude with respect to the skull thickness, $t_{skull}$. Let us denote this absolute sensitivity by $S_{abs}$.\n$$ S_{abs} = \\frac{\\partial E_{brain}}{\\partial t_{skull}} = \\frac{\\partial}{\\partial t_{skull}} \\left[ \\Delta V (\\sigma_{brain} R_{tot})^{-1} \\right] $$\nUsing the chain rule, this becomes:\n$$ S_{abs} = -\\Delta V (\\sigma_{brain} R_{tot})^{-2} \\frac{\\partial(\\sigma_{brain} R_{tot})}{\\partial t_{skull}} $$\nThe derivative of the denominator term is:\n$$ \\frac{\\partial(\\sigma_{brain} R_{tot})}{\\partial t_{skull}} = \\sigma_{brain} \\frac{\\partial R_{tot}}{\\partial t_{skull}} = \\sigma_{brain} \\frac{\\partial}{\\partial t_{skull}} \\left(\\sum_i \\frac{t_i}{\\sigma_i}\\right) = \\sigma_{brain} \\left(\\frac{1}{\\sigma_{skull}}\\right) $$\nSubstituting this back, we get the expression for absolute sensitivity:\n$$ S_{abs} = -\\frac{\\Delta V}{(\\sigma_{brain} R_{tot})^2} \\frac{\\sigma_{brain}}{\\sigma_{skull}} = -\\frac{\\Delta V}{\\sigma_{brain} \\sigma_{skull} R_{tot}^2} $$\n\nFinally, we derive the relative sensitivity, $S_{rel}$, defined as the derivative of the natural logarithm of the field magnitude with respect to the skull thickness.\n$$ S_{rel} = \\frac{\\partial (\\ln E_{brain})}{\\partial t_{skull}} $$\nUsing the identity $\\frac{d(\\ln u)}{dx} = \\frac{1}{u}\\frac{du}{dx}$, the relative sensitivity is:\n$$ S_{rel} = \\frac{1}{E_{brain}} \\frac{\\partial E_{brain}}{\\partial t_{skull}} = \\frac{S_{abs}}{E_{brain}} $$\nSubstituting the expressions for $S_{abs}$ and $E_{brain}$:\n$$ S_{rel} = \\frac{-\\frac{\\Delta V}{\\sigma_{brain} \\sigma_{skull} R_{tot}^2}}{\\frac{\\Delta V}{\\sigma_{brain} R_{tot}}} = -\\frac{\\sigma_{brain} R_{tot}}{\\sigma_{brain} \\sigma_{skull} R_{tot}^2} = -\\frac{1}{\\sigma_{skull} R_{tot}} $$\nThese three derived expressions for $E_{brain}$, $S_{abs}$, and $S_{rel}$ will be implemented to compute the required values for the given test cases with $\\Delta V = 1$ V.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\n\ndef solve():\n    \"\"\"\n    Computes the electric field, absolute sensitivity, and relative sensitivity\n    for a 1D layered head model for a series of test cases.\n    \"\"\"\n    # Set the potential difference as per the problem statement.\n    DELTA_V = 1.0  # V\n\n    # Test cases:\n    # Each tuple is (t_scalp, t_skull, t_csf, t_brain, \n    #                sigma_scalp, sigma_skull, sigma_csf, sigma_brain)\n    # with thicknesses 't' in meters and conductivities 'sigma' in Siemens/meter.\n    test_cases = [\n        (0.006, 0.006, 0.002, 0.015, 0.43, 0.010, 1.79, 0.33),\n        (0.006, 0.010, 0.002, 0.015, 0.43, 0.010, 1.79, 0.33),\n        (0.006, 0.001, 0.002, 0.015, 0.43, 0.010, 1.79, 0.33),\n        (0.006, 0.006, 0.002, 0.015, 0.43, 0.004, 1.79, 0.33),\n        (0.012, 0.012, 0.004, 0.030, 0.43, 0.010, 1.79, 0.33),\n    ]\n\n    # List to store all computed results.\n    results = []\n\n    for case in test_cases:\n        t_scalp, t_skull, t_csf, t_brain, \\\n        sigma_scalp, sigma_skull, sigma_csf, sigma_brain = case\n\n        # Calculate the total resistance per unit area (R_tot).\n        # R_tot = sum(t_i / sigma_i)\n        r_total = (t_scalp / sigma_scalp) + \\\n                  (t_skull / sigma_skull) + \\\n                  (t_csf / sigma_csf) + \\\n                  (t_brain / sigma_brain)\n        \n        # 1. Electric field magnitude in the brain layer (E_brain)\n        # E_brain = DELTA_V / (sigma_brain * R_tot)\n        e_brain = DELTA_V / (sigma_brain * r_total)\n        \n        # 2. Absolute sensitivity of E_brain w.r.t. skull thickness (S_abs)\n        # S_abs = -DELTA_V / (sigma_brain * sigma_skull * R_tot^2)\n        s_abs = -DELTA_V / (sigma_brain * sigma_skull * r_total**2)\n        \n        # 3. Relative sensitivity of E_brain w.r.t. skull thickness (S_rel)\n        # S_rel = -1 / (sigma_skull * R_tot)\n        s_rel = -1.0 / (sigma_skull * r_total)\n        \n        results.extend([e_brain, s_abs, s_rel])\n        \n    # Format the output string as required: a single comma-separated list\n    # in brackets, with each number rounded to six decimal places.\n    formatted_results = [f\"{x:.6f}\" for x in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "For any given study, the choice between the Boundary Element Method (BEM) and the Finite Element Method (FEM) is a critical design decision, balancing model fidelity against computational resources. This exercise shifts the focus from solving the physics to analyzing the algorithms themselves by developing performance models for runtime and memory usage. By deriving and applying these scaling laws , you will build a quantitative framework for reasoning about the practical tradeoffs between BEM and FEM, enabling an informed choice of method for your specific research needs.",
            "id": "4168169",
            "problem": "Consider the quasi-static electromagnetic forward problem for electroencephalography (EEG), where the head is modeled as a homogeneous spherical conductor of radius $R$. Two numerical formulations are considered: the Boundary Element Method (BEM) and the Finite Element Method (FEM). Let the spherical head have surface area $A$ and volume $V$, and let the mesh resolutions be characterized by a mean surface edge length $h_{\\mathrm{s}}$ for BEM and a mean volumetric edge length $h_{\\mathrm{v}}$ for FEM. Assume the following widely accepted modeling facts:\n\n- The number of BEM unknowns $B$ scales with surface area as $B \\approx \\eta_{\\mathrm{b}} A h_{\\mathrm{s}}^{-2}$, where $\\eta_{\\mathrm{b}}$ is a mesh-density constant.\n- The number of FEM unknowns $V_{\\mathrm{n}}$ scales with volume as $V_{\\mathrm{n}} \\approx \\eta_{\\mathrm{v}} V h_{\\mathrm{v}}^{-3}$, where $\\eta_{\\mathrm{v}}$ is a mesh-density constant. The sparse stiffness matrix has an average of $z$ structurally nonzero entries per row, so $\\mathrm{nnz} \\approx z V_{\\mathrm{n}}$.\n\nConsider Krylov iterative solvers applied to the resulting linear systems:\n- For the BEM second-kind integral equation solved by Generalized Minimal Residual (GMRES), the iteration count is $m_{\\mathrm{BEM}} = \\alpha \\ln(1/\\epsilon)$ to reach residual tolerance $\\epsilon$, with per-iteration dense matrix-vector product time proportional to $B^{2}$ with coefficient $\\gamma_{\\mathrm{BEM}}$.\n- For the FEM system solved by Conjugate Gradient (CG) with Algebraic Multigrid (AMG) preconditioning, the iteration count is $m_{\\mathrm{FEM}} = \\beta \\ln(1/\\epsilon)$, and the per-iteration time is proportional to $\\mathrm{nnz}$ with coefficient $\\gamma_{\\mathrm{FEM}}$.\n\nMemory models:\n- BEM stores a dense matrix with $8 B^{2}$ bytes.\n- FEM stores a sparse matrix and multigrid hierarchy with memory $M_{\\mathrm{FEM}} \\approx \\mu \\,\\mathrm{nnz} + \\nu V_{\\mathrm{n}}$ bytes, where $\\mu$ and $\\nu$ are storage coefficients.\n\nStarting from the above fundamentals and the geometric facts $A = 4 \\pi R^{2}$ and $V = \\frac{4}{3} \\pi R^{3}$, derive the runtime models $T_{\\mathrm{BEM}}(h_{\\mathrm{s}}, \\epsilon)$ and $T_{\\mathrm{FEM}}(h_{\\mathrm{v}}, \\epsilon)$, and the memory models $M_{\\mathrm{BEM}}(h_{\\mathrm{s}})$ and $M_{\\mathrm{FEM}}(h_{\\mathrm{v}})$. Then evaluate the runtime ratio $T_{\\mathrm{BEM}} / T_{\\mathrm{FEM}}$ for the following parameters:\n- $R = 9.0 \\times 10^{-2} \\,\\mathrm{m}$,\n- $h_{\\mathrm{s}} = 3.0 \\times 10^{-3} \\,\\mathrm{m}$,\n- $h_{\\mathrm{v}} = 2.0 \\times 10^{-3} \\,\\mathrm{m}$,\n- $\\epsilon = 10^{-6}$,\n- $\\eta_{\\mathrm{b}} = 5.0 \\times 10^{-1}$,\n- $\\eta_{\\mathrm{v}} = 1.2$,\n- $z = 30$,\n- $\\alpha = 12$,\n- $\\beta = 18$,\n- $\\gamma_{\\mathrm{BEM}} = 2.0 \\times 10^{-9} \\,\\mathrm{s}$,\n- $\\gamma_{\\mathrm{FEM}} = 5.0 \\times 10^{-10} \\,\\mathrm{s}$,\n- $\\mu = 12 \\,\\mathrm{bytes}$,\n- $\\nu = 40 \\,\\mathrm{bytes}$.\n\nRound your final runtime ratio to four significant figures. The answer is dimensionless; no physical unit is required for the ratio.",
            "solution": "### Derivation of Runtime and Memory Models\n\nFirst, we derive the expressions for the runtime and memory usage for both BEM and FEM as functions of the given parameters. The total runtime $T$ is the product of the number of iterations $m$ and the time per iteration.\n\n**Boundary Element Method (BEM)**\nThe number of BEM unknowns $B$ is given by:\n$$ B \\approx \\eta_{\\mathrm{b}} A h_{\\mathrm{s}}^{-2} = \\eta_{\\mathrm{b}} (4 \\pi R^{2}) h_{\\mathrm{s}}^{-2} = 4 \\pi \\eta_{\\mathrm{b}} R^{2} h_{\\mathrm{s}}^{-2} $$\nThe total runtime for BEM, $T_{\\mathrm{BEM}}$, is:\n$$ T_{\\mathrm{BEM}} = m_{\\mathrm{BEM}} \\times (\\text{time per iteration}) = (\\alpha \\ln(1/\\epsilon)) \\times (\\gamma_{\\mathrm{BEM}} B^{2}) $$\nSubstituting the expression for $B$:\n$$ T_{\\mathrm{BEM}}(h_{\\mathrm{s}}, \\epsilon) = \\alpha \\gamma_{\\mathrm{BEM}} \\ln(1/\\epsilon) (4 \\pi \\eta_{\\mathrm{b}} R^{2} h_{\\mathrm{s}}^{-2})^{2} = 16 \\pi^{2} \\alpha \\gamma_{\\mathrm{BEM}} \\eta_{\\mathrm{b}}^{2} \\ln(1/\\epsilon) R^{4} h_{\\mathrm{s}}^{-4} $$\nThe memory required for BEM, $M_{\\mathrm{BEM}}$, is:\n$$ M_{\\mathrm{BEM}}(h_{\\mathrm{s}}) = 8 B^{2} = 8 (4 \\pi \\eta_{\\mathrm{b}} R^{2} h_{\\mathrm{s}}^{-2})^{2} = 128 \\pi^{2} \\eta_{\\mathrm{b}}^{2} R^{4} h_{\\mathrm{s}}^{-4} $$\n\n**Finite Element Method (FEM)**\nThe number of FEM unknowns $V_{\\mathrm{n}}$ is given by:\n$$ V_{\\mathrm{n}} \\approx \\eta_{\\mathrm{v}} V h_{\\mathrm{v}}^{-3} = \\eta_{\\mathrm{v}} \\left(\\frac{4}{3} \\pi R^{3}\\right) h_{\\mathrm{v}}^{-3} = \\frac{4}{3} \\pi \\eta_{\\mathrm{v}} R^{3} h_{\\mathrm{v}}^{-3} $$\nThe number of non-zero entries in the sparse matrix is $\\mathrm{nnz} \\approx z V_{\\mathrm{n}}$:\n$$ \\mathrm{nnz} \\approx \\frac{4}{3} \\pi z \\eta_{\\mathrm{v}} R^{3} h_{\\mathrm{v}}^{-3} $$\nThe total runtime for FEM, $T_{\\mathrm{FEM}}$, is:\n$$ T_{\\mathrm{FEM}} = m_{\\mathrm{FEM}} \\times (\\text{time per iteration}) = (\\beta \\ln(1/\\epsilon)) \\times (\\gamma_{\\mathrm{FEM}} \\mathrm{nnz}) $$\nSubstituting the expression for $\\mathrm{nnz}$:\n$$ T_{\\mathrm{FEM}}(h_{\\mathrm{v}}, \\epsilon) = \\beta \\gamma_{\\mathrm{FEM}} \\ln(1/\\epsilon) \\left(\\frac{4}{3} \\pi z \\eta_{\\mathrm{v}} R^{3} h_{\\mathrm{v}}^{-3}\\right) = \\frac{4}{3} \\pi \\beta \\gamma_{\\mathrm{FEM}} z \\eta_{\\mathrm{v}} \\ln(1/\\epsilon) R^{3} h_{\\mathrm{v}}^{-3} $$\nThe memory required for FEM, $M_{\\mathrm{FEM}}$, is:\n$$ M_{\\mathrm{FEM}}(h_{\\mathrm{v}}) \\approx \\mu \\,\\mathrm{nnz} + \\nu V_{\\mathrm{n}} = (\\mu z + \\nu) V_{\\mathrm{n}} = (\\mu z + \\nu) \\frac{4}{3} \\pi \\eta_{\\mathrm{v}} R^{3} h_{\\mathrm{v}}^{-3} $$\n\n### Evaluation of the Runtime Ratio\nWe now compute the ratio $T_{\\mathrm{BEM}} / T_{\\mathrm{FEM}}$ using the derived runtime models:\n$$ \\frac{T_{\\mathrm{BEM}}}{T_{\\mathrm{FEM}}} = \\frac{16 \\pi^{2} \\alpha \\gamma_{\\mathrm{BEM}} \\eta_{\\mathrm{b}}^{2} \\ln(1/\\epsilon) R^{4} h_{\\mathrm{s}}^{-4}}{\\frac{4}{3} \\pi \\beta \\gamma_{\\mathrm{FEM}} z \\eta_{\\mathrm{v}} \\ln(1/\\epsilon) R^{3} h_{\\mathrm{v}}^{-3}} $$\nThe term $\\ln(1/\\epsilon)$ cancels out. We can simplify the expression by rearranging terms:\n$$ \\frac{T_{\\mathrm{BEM}}}{T_{\\mathrm{FEM}}} = \\frac{16 \\pi^{2}}{\\frac{4}{3} \\pi} \\cdot \\frac{\\alpha \\gamma_{\\mathrm{BEM}} \\eta_{\\mathrm{b}}^{2}}{\\beta \\gamma_{\\mathrm{FEM}} z \\eta_{\\mathrm{v}}} \\cdot \\frac{R^{4} h_{\\mathrm{s}}^{-4}}{R^{3} h_{\\mathrm{v}}^{-3}} = 12 \\pi \\cdot \\frac{\\alpha \\gamma_{\\mathrm{BEM}} \\eta_{\\mathrm{b}}^{2}}{\\beta \\gamma_{\\mathrm{FEM}} z \\eta_{\\mathrm{v}}} \\cdot \\frac{R h_{\\mathrm{v}}^{3}}{h_{\\mathrm{s}}^{4}} $$\nThis combines to:\n$$ \\frac{T_{\\mathrm{BEM}}}{T_{\\mathrm{FEM}}} = \\frac{12 \\pi \\alpha \\gamma_{\\mathrm{BEM}} \\eta_{\\mathrm{b}}^{2} R h_{\\mathrm{v}}^{3}}{\\beta \\gamma_{\\mathrm{FEM}} z \\eta_{\\mathrm{v}} h_{\\mathrm{s}}^{4}} $$\nNow, we substitute the given numerical values:\n-   $\\alpha = 12$, $\\beta = 18$\n-   $\\gamma_{\\mathrm{BEM}} = 2.0 \\times 10^{-9}$, $\\gamma_{\\mathrm{FEM}} = 5.0 \\times 10^{-10}$\n-   $\\eta_{\\mathrm{b}} = 0.5$, $\\eta_{\\mathrm{v}} = 1.2$\n-   $z = 30$\n-   $R = 9.0 \\times 10^{-2}$\n-   $h_{\\mathrm{v}} = 2.0 \\times 10^{-3}$\n-   $h_{\\mathrm{s}} = 3.0 \\times 10^{-3}$\n\nThe ratio becomes:\n$$ \\frac{T_{\\mathrm{BEM}}}{T_{\\mathrm{FEM}}} = \\frac{12 \\pi (12) (2.0 \\times 10^{-9}) (0.5)^{2} (9.0 \\times 10^{-2}) (2.0 \\times 10^{-3})^{3}}{(18) (5.0 \\times 10^{-10}) (30) (1.2) (3.0 \\times 10^{-3})^{4}} $$\nLet's group the terms for easier computation:\n$$ \\frac{T_{\\mathrm{BEM}}}{T_{\\mathrm{FEM}}} = \\left( \\frac{12 \\pi \\alpha \\eta_{\\mathrm{b}}^{2} \\gamma_{\\mathrm{BEM}}}{\\beta z \\eta_{\\mathrm{v}} \\gamma_{\\mathrm{FEM}}} \\right) \\left( \\frac{R h_{\\mathrm{v}}^{3}}{h_{\\mathrm{s}}^{4}} \\right) $$\nThe first group of parameters evaluates to:\n$$ \\frac{12 \\pi (12) (0.5)^{2} (2.0 \\times 10^{-9})}{(18) (30) (1.2) (5.0 \\times 10^{-10})} = \\frac{12 \\pi \\cdot 12 \\cdot 0.25 \\cdot 2.0 \\cdot 10^{-9}}{18 \\cdot 30 \\cdot 1.2 \\cdot 5.0 \\cdot 10^{-10}} = \\frac{72 \\pi \\times 10^{-9}}{3240 \\times 10^{-10}} = \\frac{72 \\pi \\times 10^{-9}}{324 \\times 10^{-9}} = \\frac{72 \\pi}{324} = \\frac{2 \\pi}{9} $$\nThe second group involving geometry and mesh size evaluates to:\n$$ \\frac{R h_{\\mathrm{v}}^{3}}{h_{\\mathrm{s}}^{4}} = \\frac{(9.0 \\times 10^{-2}) (2.0 \\times 10^{-3})^{3}}{(3.0 \\times 10^{-3})^{4}} = \\frac{9.0 \\times 10^{-2} \\times 8.0 \\times 10^{-9}}{81.0 \\times 10^{-12}} = \\frac{72.0 \\times 10^{-11}}{81.0 \\times 10^{-12}} = \\frac{72.0}{81.0} \\times 10 = \\frac{8}{9} \\times 10 = \\frac{80}{9} $$\nMultiplying the two results gives the final ratio:\n$$ \\frac{T_{\\mathrm{BEM}}}{T_{\\mathrm{FEM}}} = \\left(\\frac{2 \\pi}{9}\\right) \\left(\\frac{80}{9}\\right) = \\frac{160 \\pi}{81} $$\nNow, we compute the numerical value and round to four significant figures:\n$$ \\frac{160 \\pi}{81} \\approx \\frac{160 \\times 3.14159265}{81} \\approx \\frac{502.654824}{81} \\approx 6.2056151 $$\nRounding to four significant figures gives $6.206$.",
            "answer": "$$\\boxed{6.206}$$"
        }
    ]
}