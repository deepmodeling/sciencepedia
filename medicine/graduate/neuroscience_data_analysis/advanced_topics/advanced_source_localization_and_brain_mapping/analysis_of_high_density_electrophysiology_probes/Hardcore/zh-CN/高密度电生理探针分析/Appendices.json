{
    "hands_on_practices": [
        {
            "introduction": "从生物电压信号到数字数据的转换之旅始于模数转换器 (ADC)。本练习探讨了数字化过程中的一个基本权衡：ADC 的位深度 ($B$) 决定了测量的精度，更高的位深度意味着更小的量化步长，从而减少了转换中的误差。通过解决这个问题 ，您将定量地理解 ADC 规格如何直接影响数据质量，这对于设计实验和解释记录到的信号至关重要。",
            "id": "4138220",
            "problem": "一个高密度电生理探头使用模数转换器（ADC；Analog-to-Digital Converter）对峰值幅度特征进行数字化。经过适当的模拟增益后，峰值幅度被建模为在区间 $\\left[50\\,\\mu\\mathrm{V},\\,300\\,\\mu\\mathrm{V}\\right]$上均匀分布。该ADC采用一个具有 $2^{B}$ 个码字的均匀标量量化器，这些码字可以完全覆盖此动态范围而不会产生削波，其中 $B$ 表示位深度。设量化误差为 $q$，定义为真实峰值幅度与其量化表示之间的差值，并设其标准差为 $\\sigma_{q}$。\n\n根据有限区间上均匀量化器步长的定义以及关于区间上均匀随机变量方差的熟知事实，在所述模型假设下，确定使 $\\sigma_{q}  5\\,\\mu\\mathrm{V}$ 成立的最小整数位深度 $B$。将最终答案表示为整数 $B$。无需四舍五入。",
            "solution": "问题要求解一个均匀标量量化器的最小整数位深度 $B$，使得量化误差的标准差 $\\sigma_q$ 小于 $5\\,\\mu\\mathrm{V}$。代表峰值幅度的输入信号被建模为一个在区间 $[50\\,\\mu\\mathrm{V}, 300\\,\\mu\\mathrm{V}]$ 上均匀分布的随机变量。\n\n首先，我们验证问题陈述的有效性。\n1.  **提取已知条件**：\n    *   峰值幅度范围：$[50\\,\\mu\\mathrm{V}, 300\\,\\mu\\mathrm{V}]$。\n    *   峰值幅度分布：在给定范围内均匀分布。\n    *   量化器类型：均匀标量量化器。\n    *   量化级别数（码字数）：$2^B$，其中 $B$ 是整数位深度。\n    *   量化器范围：量化器完全覆盖信号的动态范围 $[50\\,\\mu\\mathrm{V}, 300\\,\\mu\\mathrm{V}]$，无削波。\n    *   量化误差定义：$q$ 是真实幅度与量化幅度之间的差值。\n    *   约束条件：量化误差的标准差 $\\sigma_q$ 必须满足 $\\sigma_q  5\\,\\mu\\mathrm{V}$。\n    *   提示：使用均匀随机变量方差的公式。\n\n2.  **验证**：\n    *   该问题具有科学依据，采用了数字信号处理（均匀量化）和概率论中的标准模型。\n    *   问题提法严谨，提供了所有必要信息来为未知变量 $B$ 建立一个可解的不等式。\n    *   语言客观、精确。\n    *   设定自洽且无矛盾。物理数值对于电生理学是符合实际的。\n    *   因此，该问题被认为是 **有效的**。\n\n我们现在开始求解。\n\n信号的动态范围（我们记为 $R$）是最大和最小幅度之差：\n$$R = 300\\,\\mu\\mathrm{V} - 50\\,\\mu\\mathrm{V} = 250\\,\\mu\\mathrm{V}$$\n一个具有 $2^B$ 个量化级别的均匀量化器将此动态范围划分为 $2^B$ 个相等的量化区间。每个区间的尺寸，即步长 $\\Delta$，由下式给出：\n$$\\Delta = \\frac{R}{2^B} = \\frac{250\\,\\mu\\mathrm{V}}{2^B}$$\n问题指出，输入信号在整个动态范围内均匀分布。对于施加于均匀量化器上的此类信号，量化误差 $q$ 可以很好地近似为一个在区间 $[-\\frac{\\Delta}{2}, \\frac{\\Delta}{2}]$ 上均匀分布的随机变量。\n$$q \\sim U\\left(-\\frac{\\Delta}{2}, \\frac{\\Delta}{2}\\right)$$\n问题引导我们使用均匀随机变量的方差公式。对于一个在区间 $[a, b]$ 上均匀分布的随机变量 $X$，其方差 $\\sigma_X^2$ 为：\n$$\\sigma_X^2 = \\frac{(b-a)^2}{12}$$\n将此公式应用于量化误差 $q$，我们设 $a = -\\frac{\\Delta}{2}$ 和 $b = \\frac{\\Delta}{2}$。因此，量化误差的方差 $\\sigma_q^2$ 为：\n$$\\sigma_q^2 = \\frac{\\left(\\frac{\\Delta}{2} - \\left(-\\frac{\\Delta}{2}\\right)\\right)^2}{12} = \\frac{(\\Delta)^2}{12}$$\n标准差 $\\sigma_q$ 是方差的平方根：\n$$\\sigma_q = \\sqrt{\\frac{\\Delta^2}{12}} = \\frac{\\Delta}{\\sqrt{12}}$$\n现在，我们将步长 $\\Delta = \\frac{R}{2^B}$ 的表达式代入 $\\sigma_q$ 的方程中：\n$$\\sigma_q = \\frac{1}{\\sqrt{12}} \\left( \\frac{R}{2^B} \\right) = \\frac{R}{2^B \\sqrt{12}}$$\n问题施加了约束条件 $\\sigma_q  5\\,\\mu\\mathrm{V}$。我们可以将其写成一个不等式：\n$$\\frac{R}{2^B \\sqrt{12}}  5\\,\\mu\\mathrm{V}$$\n代入 $R = 250\\,\\mu\\mathrm{V}$ 的值：\n$$\\frac{250\\,\\mu\\mathrm{V}}{2^B \\sqrt{12}}  5\\,\\mu\\mathrm{V}$$\n单位 $\\mu\\mathrm{V}$ 在两边抵消。我们重排不等式以求解 $B$：\n$$\\frac{250}{5}  2^B \\sqrt{12}$$\n$$50  2^B \\sqrt{12}$$\n$$2^B > \\frac{50}{\\sqrt{12}}$$\n我们可以将项 $\\sqrt{12}$ 简化为 $\\sqrt{4 \\times 3} = 2\\sqrt{3}$。\n$$2^B > \\frac{50}{2\\sqrt{3}}$$\n$$2^B > \\frac{25}{\\sqrt{3}}$$\n为了求出 $B$，我们对两边取以 $2$ 为底的对数：\n$$B > \\log_2\\left(\\frac{25}{\\sqrt{3}}\\right)$$\n为了确定 $B$ 的最小整数值，我们必须计算不等式右侧的值。我们知道 $\\sqrt{3} \\approx 1.732$。\n$$\\frac{25}{\\sqrt{3}} \\approx \\frac{25}{1.732} \\approx 14.434$$\n所以，不等式变为：\n$$2^B > 14.434$$\n我们考察 $2$ 的整数次幂：\n$2^3 = 8$\n$2^4 = 16$\n由于 $16 > 14.434$ 且 $8  14.434$，满足该不等式的最小整数 $B$ 是 $4$。\n更正式地，我们可以计算对数的值：\n$$B > \\log_2(14.434) \\approx 3.851$$\n由于 $B$ 必须是整数，满足 $B > 3.851$ 的最小整数值为 $B=4$。\n因此，需要最小位深度为 $4$。",
            "answer": "$$\\boxed{4}$$"
        },
        {
            "introduction": "一旦我们获得了数字化的尖峰波形，下一个任务就是提取能够描述其形状的量化特征，这些特征是“尖峰排序”（spike sorting）的基础。这个动手实践问题  要求您编写算法，从原始波形数组中计算关键特征，如波谷到波峰时间和复极化斜率。掌握这些基本的特征提取技术对于任何处理电生理数据的神经科学家来说都是必不可少的，因为它是几乎所有下游分析流程的基础。",
            "id": "4138195",
            "problem": "您将得到一个从高密度电生理探针采样的单通道胞外尖峰波形片段。从基本的离散时间信号定义出发，构建能够捕捉与尖峰分选和神经元电生理分析相关的关键生物物理特征的尖峰特征。具体来说，您必须仅使用离散时间采样和数值微分的原理，从波形片段中推导并实现三个特征：波谷到波峰时间、复极化斜率和能量。\n\n使用以下基础知识：\n- 离散时间信号是以固定采样率 $f_s$（单位为赫兹，Hz，即每秒周期数）对连续时间过程进行采样的样本。采样周期为 $T_s = 1/f_s$ 秒。离散索引 $n$ 对应于时间 $t = n T_s$ 秒，或等效地 $t_{\\mathrm{ms}} = n \\cdot (1000/f_s)$ 毫秒（毫秒，ms，是 $10^{-3}$ 秒）。\n- 离散时间中的数值微分可以通过一阶前向差分来近似：对于一个以微伏（$\\mu$V，是 $10^{-6}$ 伏特）为单位的信号 $w[n]$，从样本 $n$ 到 $n+1$ 区间的离散时间斜率为 $\\Delta w / \\Delta t \\approx \\dfrac{w[n+1] - w[n]}{T_s}$，或者以微伏每毫秒为单位时为 $\\dfrac{w[n+1] - w[n]}{1000/f_s}$。\n- 有限片段上的离散时间信号能量是连续时间能量积分的黎曼和近似：$E \\approx \\sum_{n=0}^{N-1} w[n]^2 \\cdot T_s$。如果以平方微伏毫秒为单位表示，则使用 $E_{\\mathrm{ms}} \\approx \\sum_{n=0}^{N-1} w[n]^2 \\cdot (1000/f_s)$。\n\n要构建的特征的定义：\n1. 波谷到波峰时间：将波谷样本索引 $n_{\\mathrm{trough}}$ 确定为整个片段中 $w[n]$ 的最小值索引。然后在严格位于波谷之后的样本中，即在 $n \\in \\{n_{\\mathrm{trough}}+1, \\dots, N-1\\}$ 的范围内，将波峰样本索引 $n_{\\mathrm{peak}}$ 确定为 $w[n]$ 的最大值索引。如果在 $n_{\\mathrm{trough}}$ 之后没有样本，则设置 $n_{\\mathrm{peak}} = n_{\\mathrm{trough}}$。波谷到波峰时间为 $\\Delta t_{\\mathrm{tp,ms}} = (n_{\\mathrm{peak}} - n_{\\mathrm{trough}}) \\cdot (1000/f_s)$，以毫秒表示。\n2. 复极化斜率：在从 $n_{\\mathrm{trough}}$ 到 $n_{\\mathrm{peak}}$ 的区间内，为索引 $n \\in \\{n_{\\mathrm{trough}}, \\dots, \\min(n_{\\mathrm{peak}}-1, N-2)\\}$ 计算前向差分斜率 $s[n] = \\dfrac{w[n+1] - w[n]}{1000/f_s}$。复极化斜率是该集合中的最大非负值。如果所有这些斜率都为负，则报告 $0$。以微伏每毫秒表示复极化斜率。\n3. 能量：计算 $E_{\\mathrm{ms}} = \\sum_{n=0}^{N-1} w[n]^2 \\cdot (1000/f_s)$，以平方微伏毫秒表示。\n\n科学真实性：胞外尖峰通常表现为显著的负向偏转（波谷），随后是正向反弹（波峰）。高密度探针的采样率通常在 $20000$ 到 $40000$ 赫兹之间。振幅通常在几十到几百微伏。上述定义反映了神经科学数据分析中使用的标准离散时间分析方法。\n\n您的程序必须实现这些特征计算，并将其应用于以下测试套件。每个波形以微伏为单位，采样率以赫兹为单位。答案必须以指定单位表示：波谷到波峰时间（毫秒），复极化斜率（微伏每毫秒），以及能量（平方微伏毫秒）。本问题不涉及角度。不要使用百分比。\n\n测试套件：\n- 案例 $1$（一般真实尖峰）：$f_s = 30000$ 赫兹，波形 $w[n]$（微伏）：\n$[0,-5,-12,-20,-35,-60,-85,-110,-125,-140,-150,-145,-120,-80,-40,-10,5,20,35,50,60,55,40,20,5]$.\n- 案例 $2$（波谷在最后一个样本的边界情况）：$f_s = 20000$ 赫兹，波形 $w[n]$（微伏）：\n$[0,-1,-2,-3,-4,-5]$.\n- 案例 $3$（平坦信号的边缘情况）：$f_s = 30000$ 赫兹，波形 $w[n]$（微伏）：\n$[0,0,0,0,0,0,0,0,0,0]$.\n- 案例 $4$（波峰紧随波谷）：$f_s = 40000$ 赫兹，波形 $w[n]$（微伏）：\n$[2,0,-10,-50,-100,20,10,0]$.\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果必须是按 $[\\Delta t_{\\mathrm{tp,ms}}, s_{\\mathrm{rep}}\\,(\\mu\\mathrm{V}/\\mathrm{ms}), E_{\\mathrm{ms}}]$ 顺序排列的列表。将四个案例的结果汇总到一个顶层列表中。例如，总输出应类似于 $[[a_1,b_1,c_1],[a_2,b_2,c_2],[a_3,b_3,c_3],[a_4,b_4,c_4]]$，其中符号由数值替换。",
            "solution": "我们从连续时间电生理信号的离散时间表示开始。令 $w[n]$ 表示以微伏为单位的波形样本，由整数 $n \\in \\{0,1,\\dots,N-1\\}$ 索引。采样率为 $f_s$ 赫兹，因此采样周期为 $T_s = 1/f_s$ 秒。与索引 $n$ 相关联的时间是 $t = n T_s$ 秒，或 $t_{\\mathrm{ms}} = n \\cdot (1000/f_s)$ 毫秒。\n\n特征 $1$：波谷到波峰时间。波谷索引 $n_{\\mathrm{trough}}$ 是 $w[n]$ 在整个片段上的最小化子：\n$$\nn_{\\mathrm{trough}} = \\operatorname{argmin}_{0 \\le n \\le N-1} w[n].\n$$\n波峰索引 $n_{\\mathrm{peak}}$ 被定义为严格在波谷之后 $w[n]$ 的最大化子：\n$$\nn_{\\mathrm{peak}} =\n\\begin{cases}\n\\operatorname{argmax}_{n_{\\mathrm{trough}}  n \\le N-1} w[n],  \\text{若 } n_{\\mathrm{trough}}  N-1, \\\\\nn_{\\mathrm{trough}},  \\text{若 } n_{\\mathrm{trough}} = N-1.\n\\end{cases}\n$$\n因此，以毫秒为单位的波谷到波峰时间差为\n$$\n\\Delta t_{\\mathrm{tp,ms}} = (n_{\\mathrm{peak}} - n_{\\mathrm{trough}}) \\cdot \\frac{1000}{f_s}.\n$$\n这个定义自然地处理了波谷出现在最后一个样本的边界情况：此时差值为零。\n\n特征 $2$：复极化斜率。复极化反映了从负向波谷向更正值恢复的过程。我们使用一阶前向差分来近似导数，这是一种经过充分检验且适用于离散时间信号的数值方法：\n$$\ns[n] = \\frac{w[n+1] - w[n]}{1000/f_s} \\quad \\text{单位：} \\mu\\mathrm{V}/\\mathrm{ms}.\n$$\n我们在从波谷到波峰（不包括波峰）的区间上计算这个值，确保索引保持有效：\n$$\nn \\in \\left\\{n_{\\mathrm{trough}}, n_{\\mathrm{trough}}+1, \\dots, \\min(n_{\\mathrm{peak}}-1, N-2) \\right\\}.\n$$\n为了捕捉最陡峭的复极化过程，我们取该集合中的最大非负斜率：\n$$\ns_{\\mathrm{rep}} = \\max\\left( \\{ s[n] \\}_{n} \\cup \\{0\\} \\right).\n$$\n包含 $0$ 确保了如果所有计算出的斜率都为负（表示在指定区间内没有正向恢复），报告的复极化斜率将是 $0$。\n\n特征 $3$：能量。离散时间能量是振幅平方积分的黎曼和近似。以平方微伏毫秒表示：\n$$\nE_{\\mathrm{ms}} = \\sum_{n=0}^{N-1} w[n]^2 \\cdot \\frac{1000}{f_s}.\n$$\n这个量随振幅和持续时间而变化，是信号分析中用于量化活动度的标准方法。\n\n算法设计：\n1. 通过单次遍历找到 $w[n]$ 的最小值来计算 $n_{\\mathrm{trough}}$。\n2. 如果 $n_{\\mathrm{trough}}  N-1$，则通过扫描 $n > n_{\\mathrm{trough}}$ 的 $w[n]$ 来找到其最大值，从而确定 $n_{\\mathrm{peak}}$。否则，设置 $n_{\\mathrm{peak}} = n_{\\mathrm{trough}}$。\n3. 使用索引差乘以 $1000/f_s$ 来计算 $\\Delta t_{\\mathrm{tp,ms}}$。\n4. 对于复极化斜率，在指定区间上计算前向差分 $s[n]$。如果区间为空（例如，$n_{\\mathrm{peak}} \\le n_{\\mathrm{trough}}$ 或 $N  2$），则设置 $s_{\\mathrm{rep}} = 0$。否则，取不小于0的 $s[n]$ 的最大值。\n5. 通过振幅平方和乘以 $1000/f_s$ 来计算能量 $E_{\\mathrm{ms}}$。\n\n处理的边缘情况：\n- 波谷在最后一个样本（$n_{\\mathrm{trough}} = N-1$）：$n_{\\mathrm{peak}} = n_{\\mathrm{trough}}$，因此 $\\Delta t_{\\mathrm{tp,ms}} = 0$，且复极化斜率的计算区间为空，得出 $s_{\\mathrm{rep}} = 0$。\n- 平坦信号（对所有 $n$，$w[n] = 0$）：波谷和波峰索引可以通过最小化和最大化进行任意一致的选择；差值产生 $\\Delta t_{\\mathrm{tp,ms}} = 0$，$s_{\\mathrm{rep}} = 0$ 和 $E_{\\mathrm{ms}} = 0$。\n- 波峰紧随波谷：时间差缩减为单硗样本间隔 $\\Delta t_{\\mathrm{tp,ms}} = (1000/f_s)$，并且复极化斜率等于该间隔上的单次前向差分。\n\n将该算法应用于四个测试案例，为每个案例生成一个明确的包含三个值的列表 $[\\Delta t_{\\mathrm{tp,ms}}, s_{\\mathrm{rep}}, E_{\\mathrm{ms}}]$，并汇总成一个顶层列表，以所要求的精确格式打印。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_spike_features(waveform_uV: np.ndarray, fs_hz: float):\n    \"\"\"\n    Compute trough-to-peak time (ms), repolarization slope (uV/ms), and energy (uV^2*ms)\n    for a given single-channel waveform segment.\n    \"\"\"\n    N = waveform_uV.size\n    dt_ms = 1000.0 / fs_hz\n\n    # Edge case: empty waveform\n    if N == 0:\n        return [0.0, 0.0, 0.0]\n\n    # Trough index (minimum value)\n    n_trough = int(np.argmin(waveform_uV))\n\n    # Peak index after trough (if possible)\n    if n_trough  N - 1:\n        # Search for maximum strictly after trough\n        sub = waveform_uV[n_trough + 1:]\n        n_peak = n_trough + 1 + int(np.argmax(sub))\n    else:\n        n_peak = n_trough  # no sample after trough\n\n    # Trough-to-peak time in ms\n    t_tp_ms = (n_peak - n_trough) * dt_ms\n\n    # Repolarization slope using forward differences between trough and peak\n    # Valid indices for forward differences: n in [n_trough, min(n_peak-1, N-2)]\n    start = n_trough\n    end = min(n_peak - 1, N - 2)\n    if end >= start:\n        diffs = waveform_uV[start + 1 : end + 2] - waveform_uV[start : end + 1]\n        slopes_uV_per_ms = diffs / dt_ms\n        # Maximum nonnegative slope; if all negative, return 0\n        rep_slope = float(np.maximum(0.0, np.max(slopes_uV_per_ms)))\n    else:\n        rep_slope = 0.0\n\n    # Energy in uV^2 * ms\n    energy_uV2_ms = float(np.sum(waveform_uV.astype(float) ** 2) * dt_ms)\n\n    return [float(t_tp_ms), float(rep_slope), float(energy_uV2_ms)]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: general realistic spike\n        (\n            np.array([0,-5,-12,-20,-35,-60,-85,-110,-125,-140,-150,-145,-120,-80,-40,-10,5,20,35,50,60,55,40,20,5], dtype=float),\n            30000.0\n        ),\n        # Case 2: boundary with trough at the last sample\n        (\n            np.array([0,-1,-2,-3,-4,-5], dtype=float),\n            20000.0\n        ),\n        # Case 3: flat signal\n        (\n            np.array([0,0,0,0,0,0,0,0,0,0], dtype=float),\n            30000.0\n        ),\n        # Case 4: peak immediately follows trough\n        (\n            np.array([2,0,-10,-50,-100,20,10,0], dtype=float),\n            40000.0\n        ),\n    ]\n\n    results = []\n    for waveform, fs in test_cases:\n        t_ms, slope, energy = compute_spike_features(waveform, fs)\n        results.append([t_ms, slope, energy])\n\n    # Format the output exactly as a single-line comma-separated list enclosed in square brackets,\n    # with no spaces for strictness.\n    def fmt_triplet(trip):\n        # Format numbers with up to 6 decimal places to ensure deterministic string output\n        return \"[\" + \",\".join(f\"{x:.6f}\" for x in trip) + \"]\"\n\n    output = \"[\" + \",\".join(fmt_triplet(trip) for trip in results) + \"]\"\n    print(output)\n\nsolve()\n```"
        },
        {
            "introduction": "高密度探针能同时从数百个通道进行记录，而这些通道常常被相同的噪声源污染，共平均参考 (Common Average Referencing, CAR) 是一种消除此类广泛伪影的强大技术。本练习深入探讨了 CAR 的数学原理，展示了减去所有通道的平均信号如何能够降低噪声，同时也揭示了其內在的权衡：CAR 会轻微减小真实神经信号的幅度。通过推导 CAR 对信号和噪声的影响 ，您将对这一必要的预处理步骤产生深刻的理解，从而能够明智地应用它并理解其对最终分析结果的影响。",
            "id": "4138224",
            "problem": "一个具有 $M = 384$ 个记录位点的高密度硅探针测量细胞外电压。在某一特定时刻 $t_{0}$，单个神经元产生一个尖峰，该尖峰在恰好 $K=3$ 个通道上以相同的峰值幅度 $A$ 出现，而在所有其他通道上可以忽略不计。设每个通道的观测信号为一个确定性分量与噪声之和，记为 $x_{i}(t) = s_{i}(t) + n_{i}(t)$，其中噪声 $n_{i}(t)$ 是零均值、时间白噪声、在各通道间同分布，方差为 $\\sigma^{2}$，且通道间不相关。该探针阵列采用公共平均参考（CAR），其在每个时间点 $t$ 的定义为\n$$\ny_{i}(t) \\equiv x_{i}(t) - \\frac{1}{M} \\sum_{j=1}^{M} x_{j}(t).\n$$\n假设 CAR 使用所有 $M$ 个通道，包括被参考的通道本身。将一个通道上的信噪比（SNR）定义为该通道上尖峰的峰值幅度与噪声标准差的比值。\n\n仅从这些定义和假设出发：\n1) 推导在时间 $t_{0}$ 时，CAR 对 $K$ 个含尖峰通道中任意一个通道上尖峰峰值幅度的缩放乘法因子，用 $K$ 和 $M$ 表示，然后计算 $K=3$ 和 $M=384$ 时的精确表达式。\n2) 推导 CAR 对一个含尖峰通道上的信噪比相对于 CAR 处理前信噪比的重新缩放乘法因子，用 $K$ 和 $M$ 表示，然后精确计算 $K=3$ 和 $M=384$ 时的值。\n\n将你的最终答案表示为两个精确的无量纲表达式，按 [幅度缩放因子, 信噪比缩放因子] 的顺序排列在一个单行矩阵中。不要进行近似或四舍五入；请给出精确的封闭形式表达式。",
            "solution": "该问题要求进行两项推导，均与公共平均参考（CAR）对高密度电生理探针检测到的尖峰信号的影响有关。第一项是尖峰峰值幅度的缩放因子，第二项是信噪比（SNR）的缩放因子。\n\n设所有通道的集合为 $\\mathcal{M} = \\{1, 2, ..., M\\}$。在时间 $t$，通道 $i$ 上的信号 $x_i(t)$ 由 $x_i(t) = s_i(t) + n_i(t)$ 给出，其中 $s_i(t)$ 是确定性信号分量，$n_i(t)$ 是噪声。噪声 $n_i(t)$ 是零均值的，$E[n_i(t)] = 0$，对于所有 $i \\in \\mathcal{M}$，其方差为 $Var(n_i(t)) = \\sigma^2$，并且通道间不相关，即对于 $i \\neq j$，$E[n_i(t)n_j(t)] = 0$。\n\n在尖峰峰值时刻 $t_0$，来自神经元的信号在一组特定的 $K$ 个通道上幅度为 $A$，在其余的 $M-K$ 个通道上为零。不失一般性地，设通道 $\\{1, ..., K\\}$ 为含尖峰通道。\n在时间 $t_0$ 的信号分量为：\n$$\ns_i(t_0) =\n\\begin{cases}\nA  \\text{for } i \\in \\{1, ..., K\\} \\\\\n0  \\text{for } i \\in \\{K+1, ..., M\\}\n\\end{cases}\n$$\n经过 CAR 处理的信号 $y_i(t)$ 定义为：\n$$\ny_i(t) = x_i(t) - \\frac{1}{M} \\sum_{j=1}^{M} x_j(t)\n$$\n我们可以将 $y_i(t)$ 分解为信号和噪声分量：\n$$\ny_i(t) = \\left(s_i(t) - \\frac{1}{M} \\sum_{j=1}^{M} s_j(t)\\right) + \\left(n_i(t) - \\frac{1}{M} \\sum_{j=1}^{M} n_j(t)\\right)\n$$\n我们定义 CAR 处理后的信号分量为 $s'_i(t) = s_i(t) - \\frac{1}{M} \\sum_{j=1}^{M} s_j(t)$，CAR 处理后的噪声分量为 $n'_i(t) = n_i(t) - \\frac{1}{M} \\sum_{j=1}^{M} n_j(t)$。\n\n**1) 幅度缩放因子**\n\n我们需要找到 CAR 对含尖峰通道（例如通道 $i=1$）上尖峰峰值幅度的缩放乘法因子。原始幅度为 $s_1(t_0) = A$。CAR 处理后的幅度为 $s'_1(t_0)$。\n\n首先，计算在 $t_0$ 时所有信号分量的和：\n$$\n\\sum_{j=1}^{M} s_j(t_0) = \\sum_{j=1}^{K} A + \\sum_{j=K+1}^{M} 0 = K A\n$$\n一个含尖峰通道（$i \\in \\{1, ..., K\\}$）上经 CAR 处理后的信号幅度为：\n$$\ns'_i(t_0) = s_i(t_0) - \\frac{1}{M} \\sum_{j=1}^{M} s_j(t_0) = A - \\frac{1}{M} (K A) = A \\left(1 - \\frac{K}{M}\\right)\n$$\n幅度的乘法缩放因子是 CAR 处理后幅度与 CAR 处理前幅度的比值：\n$$\n\\text{Amplitude Scaling Factor} = \\frac{s'_i(t_0)}{s_i(t_0)} = \\frac{A \\left(1 - \\frac{K}{M}\\right)}{A} = 1 - \\frac{K}{M}\n$$\n对于给定的值 $K = 3$ 和 $M = 384$：\n$$\n\\text{Amplitude Scaling Factor} = 1 - \\frac{3}{384} = 1 - \\frac{1}{128} = \\frac{128 - 1}{128} = \\frac{127}{128}\n$$\n\n**2) 信噪比缩放因子**\n\n信噪比定义为峰值幅度与噪声标准差的比值。\n\n一个含尖峰通道在 CAR 处理前的信噪比是：\n$$\n\\text{SNR}_{\\text{pre}} = \\frac{\\text{Amplitude}_{\\text{pre}}}{\\text{StdDev}_{\\text{pre}}} = \\frac{A}{\\sigma}\n$$\n因为原始噪声标准差为 $\\sqrt{\\sigma^2} = \\sigma$。\n\n为了求出 CAR 处理后的信噪比，我们需要 CAR 处理后噪声 $n'_i(t)$ 的标准差。我们来计算其方差 $Var(n'_i(t))$。由于原始噪声是零均值的，CAR 处理后的噪声也是零均值的：\n$E[n'_i(t)] = E[n_i(t)] - \\frac{1}{M} \\sum_{j=1}^{M} E[n_j(t)] = 0 - 0 = 0$。\n方差为：\n$$\nVar(n'_i(t)) = Var\\left(n_i(t) - \\frac{1}{M} \\sum_{j=1}^{M} n_j(t)\\right) = Var\\left(\\left(1-\\frac{1}{M}\\right)n_i(t) - \\frac{1}{M} \\sum_{j \\neq i} n_j(t)\\right)\n$$\n由于噪声信号 $n_j(t)$ 是不相关的，和的方差等于各项的方差之和：\n$$\nVar(n'_i(t)) = Var\\left(\\left(1-\\frac{1}{M}\\right)n_i(t)\\right) + \\sum_{j \\neq i} Var\\left(-\\frac{1}{M} n_j(t)\\right)\n$$\n使用性质 $Var(cZ) = c^2 Var(Z)$：\n$$\nVar(n'_i(t)) = \\left(1-\\frac{1}{M}\\right)^2 Var(n_i(t)) + \\sum_{j \\neq i} \\left(\\frac{1}{M}\\right)^2 Var(n_j(t))\n$$\n我们知道对于所有的 $j$，$Var(n_j(t)) = \\sigma^2$。对 $j \\neq i$ 的求和有 $M-1$ 项。\n$$\nVar(n'_i(t)) = \\left(1-\\frac{2}{M}+\\frac{1}{M^2}\\right)\\sigma^2 + (M-1) \\frac{1}{M^2}\\sigma^2\n$$\n$$\nVar(n'_i(t)) = \\sigma^2 \\left( 1 - \\frac{2}{M} + \\frac{1}{M^2} + \\frac{M-1}{M^2} \\right) = \\sigma^2 \\left( 1 - \\frac{2}{M} + \\frac{1}{M^2} + \\frac{1}{M} - \\frac{1}{M^2} \\right)\n$$\n$$\nVar(n'_i(t)) = \\sigma^2 \\left(1 - \\frac{1}{M}\\right)\n$$\nCAR 处理后的噪声标准差为 $\\sigma' = \\sqrt{Var(n'_i(t))} = \\sigma \\sqrt{1 - \\frac{1}{M}}$。\n\n一个含尖峰通道在 CAR 处理后的信噪比是：\n$$\n\\text{SNR}_{\\text{post}} = \\frac{\\text{Amplitude}_{\\text{post}}}{\\text{StdDev}_{\\text{post}}} = \\frac{A \\left(1 - \\frac{K}{M}\\right)}{\\sigma \\sqrt{1 - \\frac{1}{M}}}\n$$\n信噪比的缩放因子是比值 $\\frac{\\text{SNR}_{\\text{post}}}{\\text{SNR}_{\\text{pre}}}$：\n$$\n\\text{SNR Scaling Factor} = \\frac{A \\left(1 - \\frac{K}{M}\\right) / \\left(\\sigma \\sqrt{1 - \\frac{1}{M}}\\right)}{A / \\sigma} = \\frac{1 - \\frac{K}{M}}{\\sqrt{1 - \\frac{1}{M}}}\n$$\n对于给定的值 $K = 3$ 和 $M = 384$：\n$$\n\\text{SNR Scaling Factor} = \\frac{1 - \\frac{3}{384}}{\\sqrt{1 - \\frac{1}{384}}} = \\frac{1 - \\frac{1}{128}}{\\sqrt{\\frac{383}{384}}} = \\frac{\\frac{127}{128}}{\\frac{\\sqrt{383}}{\\sqrt{384}}}\n$$\n我们可以简化 $\\sqrt{384} = \\sqrt{64 \\times 6} = 8\\sqrt{6}$。\n$$\n\\text{SNR Scaling Factor} = \\frac{127}{128} \\cdot \\frac{8\\sqrt{6}}{\\sqrt{383}} = \\frac{127\\sqrt{6}}{16\\sqrt{383}}\n$$\n这就是信噪比缩放因子的精确表达式。\n\n最终结果是幅度缩放因子 $\\frac{127}{128}$ 和信噪比缩放因子 $\\frac{127\\sqrt{6}}{16\\sqrt{383}}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{127}{128}  \\frac{127\\sqrt{6}}{16\\sqrt{383}}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}