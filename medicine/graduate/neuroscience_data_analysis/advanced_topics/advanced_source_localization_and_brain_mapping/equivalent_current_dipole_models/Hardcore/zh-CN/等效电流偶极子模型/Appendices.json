{
    "hands_on_practices": [
        {
            "introduction": "在深入研究等效电流偶极子（ECD）模型的数学细节之前，建立关于脑电图（EEG）和脑磁图（MEG）信号物理起源的直观理解至关重要。本练习通过一个简化的皮层沟回模型，揭示了这两种技术为何能提供互补的信息。通过分析位于相对沟回壁上的两个偶极子，您将亲手验证EEG和MEG对神经电流不同方向（径向与切向）的基本敏感性差异，这是理解和解释神经影像数据的基石。",
            "id": "4142685",
            "problem": "考虑一个球对称头部模型，其导电率 $\\sigma$ 是均匀各向同性的，半径为 $R$。在该模型中，皮层是位于半径 $a$ 处的一个薄壳，其中 $0<a<R$。在该皮层的局部区域，我们可以使用一个局部正交基 $\\{\\hat{\\mathbf{r}}, \\hat{\\mathbf{t}}\\}$ 来描述径向和切向方向。考虑两个等效电流偶极子，$\\mathbf{p}_{1}$ 和 $\\mathbf{p}_{2}$，分别代表位于脑沟相对壁上的两个皮层片区的同步活动。它们的偶极矩大小相等，即 $p=|\\mathbf{p}_{1}|=|\\mathbf{p}_{2}|$。它们的方向由以下公式给出：\n$$\n\\hat{\\mathbf{n}}_{1}=\\cos\\theta\\,\\hat{\\mathbf{t}}+\\sin\\theta\\,\\hat{\\mathbf{r}}\n$$\n$$\n\\hat{\\mathbf{n}}_{2}=-\\cos\\theta\\,\\hat{\\mathbf{t}}+\\sin\\theta\\,\\hat{\\mathbf{r}}\n$$\n其中 $\\theta \\in (0,\\pi/2)$。在这个理想化的模型中，我们假设在球对称头部模型中，脑电图信号 $S_{\\mathrm{EEG}}$ 主要由总偶极矩的径向分量驱动，而脑磁图信号 $S_{\\mathrm{MEG}}$ 则由总偶极矩的切向分量驱动。因此，我们将这两个理想化的信号定义为：\n$$\nS_{\\mathrm{EEG}}:=\\left(\\mathbf{p}_{1}\\cdot\\hat{\\mathbf{r}}\\right)+\\left(\\mathbf{p}_{2}\\cdot\\hat{\\mathbf{r}}\\right)\n$$\n$$\nS_{\\mathrm{MEG}}:=\\left|\\left(\\mathbf{p}_{1}\\cdot\\hat{\\mathbf{t}}\\right)+\\left(\\mathbf{p}_{2}\\cdot\\hat{\\mathbf{t}}\\right)\\right|\n$$\n\n第一部分：从物理原理出发，简要论证为何在球对称模型中，EEG信号主要由径向电流分量贡献，而MEG信号主要由切向电流分量贡献。\n第二部分：计算理想化信号对 $(S_{\\mathrm{EEG}}, S_{\\mathrm{MEG}})$。",
            "solution": "### 第1部分：脑电图/脑磁图敏感性的论证\n\n脑电图（EEG）和脑磁图（MEG）对神经电流源方向的不同敏感性是一项基本原理，它源于球对称容积导体内的电磁物理学，而球对称容积导体是头部的一个良好的一阶近似。\n\n**脑磁图 (MEG) 敏感性：**\nMEG 通过测量头部外部由神经元电流产生的微弱磁场来工作。在准静态近似下，磁场 $\\mathbf{B}$ 由初级电流密度 $\\mathbf{J}_{p}$（神经源）和容积电流密度 $\\mathbf{J}_{v}$（流经导电组织的被动返回电流）共同产生。对于球对称导体，一个关键结果是，由位于 $\\mathbf{r}_0$ 的电流偶极子 $\\mathbf{p}$ 在导体外部产生的磁场，只依赖于初级电流中垂直于位置向量 $\\mathbf{r}_0$ 的那部分，即切向分量。\n\n数学上，对于一个纯径向偶极子，其偶极矩 $\\mathbf{p}$ 与其位置向量 $\\mathbf{r}_0$ 平行。在这种情况下，叉积项 $\\mathbf{p} \\times \\mathbf{r}_0$ 为零。根据Biot-Savart定律和对称性论证可以推导出，由径向源感应出的容积电流围绕径向轴完全对称，当在球体外部测量时，它们的磁场恰好抵消了初级电流源本身产生的磁场。因此，具有纯径向方向的电流偶极子在球对称导体外部不会产生磁场。在该模型中，MEG 对任何电流源的径向分量都完全不敏感，而只对切向分量敏感。问题中对 $S_{\\mathrm{MEG}}$ 的定义正是这一原理的直接理想化。\n\n**脑电图 (EEG) 敏感性：**\nEEG 测量头皮表面的电势差 $V$。电势由泊松方程 $\\nabla \\cdot (\\sigma \\nabla V) = \\nabla \\cdot \\mathbf{J}_p$ 控制。对于电流偶极子 $\\mathbf{J}_p = \\mathbf{p} \\delta(\\mathbf{r}-\\mathbf{r}_0)$，源项实际上是狄拉克δ函数的空间导数，代表一个间距很近的电流源和汇。\n径向偶极子将此源和汇沿径向线放置。这会产生沿径向向外和向内流动的电流，在不同电导率介质的边界（例如，皮层-颅骨、颅骨-头皮）上建立电荷分布，从而在头皮上产生一个强电势场。切向偶极子将源和汇并排地放置在球面的切线方向上，虽然也产生电势场，但由于颅骨的低电导率对径向电流的“模糊”和“衰减”效应远大于切向电流，且从远处看径向源的场衰减更慢，因此EEG信号通常被认为主要由电流源的径向分量驱动。问题中对 $S_{\\mathrm{EEG}}$ 的定义理想化了这种主导作用。\n\n### 第2部分：理想化信号的计算\n\n我们已知偶极矩为：\n$$\n\\mathbf{p}_{1} = p\\,\\hat{\\mathbf{n}}_{1} = p(\\cos\\theta\\,\\hat{\\mathbf{t}}+\\sin\\theta\\,\\hat{\\mathbf{r}})\n$$\n$$\n\\mathbf{p}_{2} = p\\,\\hat{\\mathbf{n}}_{2} = p(-\\cos\\theta\\,\\hat{\\mathbf{t}}+\\sin\\theta\\,\\hat{\\mathbf{r}})\n$$\n基向量 $\\hat{\\mathbf{r}}$ 和 $\\hat{\\mathbf{t}}$ 是标准正交的，即 $\\hat{\\mathbf{r}} \\cdot \\hat{\\mathbf{r}} = 1$，$\\hat{\\mathbf{t}} \\cdot \\hat{\\mathbf{t}} = 1$，且 $\\hat{\\mathbf{r}} \\cdot \\hat{\\mathbf{t}} = 0$。\n\n**$S_{\\mathrm{EEG}}$ 的计算：**\n定义为 $S_{\\mathrm{EEG}} = (\\mathbf{p}_{1}\\cdot\\hat{\\mathbf{r}}) + (\\mathbf{p}_{2}\\cdot\\hat{\\mathbf{r}})$。\n首先，我们计算每个偶极矩在径向单位向量 $\\hat{\\mathbf{r}}$ 上的投影：\n$$\n\\mathbf{p}_{1}\\cdot\\hat{\\mathbf{r}} = p(\\cos\\theta\\,\\hat{\\mathbf{t}}+\\sin\\theta\\,\\hat{\\mathbf{r}}) \\cdot \\hat{\\mathbf{r}} = p(\\cos\\theta(\\hat{\\mathbf{t}}\\cdot\\hat{\\mathbf{r}}) + \\sin\\theta(\\hat{\\mathbf{r}}\\cdot\\hat{\\mathbf{r}}))\n= p(\\cos\\theta \\cdot 0 + \\sin\\theta \\cdot 1) = p\\sin\\theta\n$$\n$$\n\\mathbf{p}_{2}\\cdot\\hat{\\mathbf{r}} = p(-\\cos\\theta\\,\\hat{\\mathbf{t}}+\\sin\\theta\\,\\hat{\\mathbf{r}}) \\cdot \\hat{\\mathbf{r}} = p(-\\cos\\theta(\\hat{\\mathbf{t}}\\cdot\\hat{\\mathbf{r}}) + \\sin\\theta(\\hat{\\mathbf{r}}\\cdot\\hat{\\mathbf{r}}))\n= p(-\\cos\\theta \\cdot 0 + \\sin\\theta \\cdot 1) = p\\sin\\theta\n$$\n现在，我们将这两个分量相加：\n$$\nS_{\\mathrm{EEG}} = p\\sin\\theta + p\\sin\\theta = 2p\\sin\\theta\n$$\n\n**$S_{\\mathrm{MEG}}$ 的计算：**\n定义为 $S_{\\mathrm{MEG}} = |(\\mathbf{p}_{1}\\cdot\\hat{\\mathbf{t}}) + (\\mathbf{p}_{2}\\cdot\\hat{\\mathbf{t}})|$。\n首先，我们计算每个偶极矩在切向单位向量 $\\hat{\\mathbf{t}}$ 上的投影：\n$$\n\\mathbf{p}_{1}\\cdot\\hat{\\mathbf{t}} = p(\\cos\\theta\\,\\hat{\\mathbf{t}}+\\sin\\theta\\,\\hat{\\mathbf{r}}) \\cdot \\hat{\\mathbf{t}} = p(\\cos\\theta(\\hat{\\mathbf{t}}\\cdot\\hat{\\mathbf{t}}) + \\sin\\theta(\\hat{\\mathbf{r}}\\cdot\\hat{\\mathbf{t}}))\n= p(\\cos\\theta \\cdot 1 + \\sin\\theta \\cdot 0) = p\\cos\\theta\n$$\n$$\n\\mathbf{p}_{2}\\cdot\\hat{\\mathbf{t}} = p(-\\cos\\theta\\,\\hat{\\mathbf{t}}+\\sin\\theta\\,\\hat{\\mathbf{r}}) \\cdot \\hat{\\mathbf{t}} = p(-\\cos\\theta(\\hat{\\mathbf{t}}\\cdot\\hat{\\mathbf{t}}) + \\sin\\theta(\\hat{\\mathbf{r}}\\cdot\\hat{\\mathbf{t}}))\n= p(-\\cos\\theta \\cdot 1 + \\sin\\theta \\cdot 0) = -p\\cos\\theta\n$$\n现在，我们将这两个分量相加并取绝对值：\n$$\nS_{\\mathrm{MEG}} = |p\\cos\\theta + (-p\\cos\\theta)| = |p\\cos\\theta - p\\cos\\theta| = |0| = 0\n$$\n\n计算表明，对于两面相对的脑沟壁，偶极矩的切向分量完全抵消，导致净切向矩为零，因此 MEG 信号为空。然而，径向分量方向相同并相长叠加，产生一个强的净径向矩，这很容易被 EEG 检测到。\n\n信号对为 $(S_{\\mathrm{EEG}}, S_{\\mathrm{MEG}}) = (2p\\sin\\theta, 0)$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2p\\sin\\theta, & 0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "从概念理解转向实际的正向建模，本练习要求您构建一个在EEG分析中广泛使用的标准三层球形头模型。这项实践将锻炼您将生物物理原理（如跨层边界的电位和电流连续性条件）转化为计算算法的能力。此外，通过进行定量敏感性分析，您将探索模型预测如何依赖于关键物理参数（如颅骨电导率），这对于评估实际应用中模型的不确定性至关重要。",
            "id": "4159228",
            "problem": "您的任务是，在球对称条件下，量化颅骨与大脑的电导率之比如何影响等效电流偶极子（ECD）模型预测的脑电图（EEG）振幅。ECD 是神经科学数据分析中的一种标准源模型。您的分析必须从准静态体积传导的控制正向模型开始：电势满足 $$\\nabla \\cdot (\\sigma \\nabla \\phi) = \\nabla \\cdot \\mathbf{J}_p,$$ 其中 $\\sigma$ 是电导率，$\\phi$ 是电势，$\\mathbf{J}_p$ 是由神经源引起的外加电流密度。对于位于球对称、分段均匀导体中心的矩为 $\\mathbf{p}$ 的 ECD，源项被建模为点偶极子，在球坐标系中使用分离变量法可将问题简化为匹配同心球壳间的边界条件。\n\n考虑一个三层球壳头部模型，其半径和电导率如下：\n- 大脑（内球）：半径 $a_1 = 0.08$ 米，电导率 $\\sigma_1 = 0.33$ S/m。\n- 颅骨（中间球壳）：内半径 $a_1 = 0.08$ 米，外半径 $a_2 = 0.085$ 米，电导率 $\\sigma_2 = r \\cdot \\sigma_1$，其中 $r$ 是待变化的颅骨与大脑电导率之比。\n- 头皮（外层球壳）：内半径 $a_2 = 0.085$ 米，外半径 $a_3 = 0.09$ 米，电导率 $\\sigma_3 = 0.33$ S/m。\n- 外部（$a_3$ 以外）：视为不导电，在 $r=a_3$ 处施加法向电流为零的边界条件。\n\n设 ECD 位于中心（$r=0$），沿 $z$ 轴方向，偶极矩大小为 $p = 1 \\times 10^{-8}$ A·m。根据球对称性，解纯粹是一阶角向的（$n=1$），且依赖于 $\\cos\\theta$，其中 $\\theta$ 是以弧度为单位的极角。\n\n从上述基本定律和定义出发，推导每个区域中电势的形式，该形式为中心偶极子特解与拉普拉斯方程齐次解之和，并强制满足以下边界条件：\n- 在 $r=a_1$ 和 $r=a_2$ 处电势连续。\n- 在 $r=a_1$ 和 $r=a_2$ 处电流密度的法向分量连续。\n- 在外边界 $r=a_3$ 处法向电流为零。\n\n由此，构建并求解所得的关于齐次解系数的线性系统。使用该解计算外边界（$r=a_3$）上偶极子正上方点（$\\theta=0$）的头皮电势振幅。以微伏为单位表示该振幅。\n\n对每个测试值 $r$ 计算其相对对数灵敏度 $$S_{\\mathrm{rel}} = \\frac{r}{V(r)} \\frac{dV}{dr},$$ 从而执行关于比率 $r$ 的定量灵敏度分析，其中 $V(r)$ 是在 $\\theta=0$ 和 $r=a_3$ 处的头皮电势振幅。使用对称有限差分法，并选择与 $r$ 相关的微小扰动 $\\delta r$ 以确保数值稳定性，来数值近似导数 $\\frac{dV}{dr}$。将 $S_{\\mathrm{rel}}$ 报告为无量纲小数。\n\n对 $r$ 使用以下测试集：\n- $r = 1.0$ （颅骨和大脑电导率相等的边界情况），\n- $r = \\frac{1}{15}$ （典型值），\n- $r = \\frac{1}{30}$ （电阻性更强的颅骨），\n- $r = \\frac{1}{80}$ （高电阻性颅骨），\n- $r = 0.001$ （极端边缘情况）。\n\n所有角度均以弧度为单位。所有物理量在内部必须统一使用国际单位制（SI），振幅必须以微伏报告。对于每个测试用例，输出一个由微伏为单位的振幅和相对对数灵敏度 $S_{\\mathrm{rel}}$ 组成的数对，均四舍五入到六位小数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是用于一个测试用例的双元素列表，形式为 $$[\\,[V_{\\mu V},\\,S_{\\mathrm{rel}}],\\,[V_{\\mu V},\\,S_{\\mathrm{rel}}],\\,\\dots\\,].$$",
            "solution": "我们从准静态体积传导正向模型开始，其表达式为 $$\\nabla \\cdot (\\sigma \\nabla \\phi) = \\nabla \\cdot \\mathbf{J}_p,$$ 其中 $\\sigma$ 是电导率，$\\phi$ 是电势，$\\mathbf{J}_p$ 是由源引起的外加电流密度。对于位于中心、沿 $z$ 轴方向且偶极矩为 $\\mathbf{p} = p\\,\\hat{\\mathbf{z}}$ 的等效电流偶极子（ECD），在电导率为 $\\sigma$ 的无限均匀介质中的特解是 $$\\phi_{\\mathrm{dip}}(r,\\theta) = \\frac{p \\cos\\theta}{4\\pi \\sigma r^2}.$$ 在分层球形介质中，每个均匀球壳内（远离源）的电势必须满足拉普拉斯方程，并且在包含源的内部区域，需加上特解。\n\n根据对称性，只有一阶球谐函数（$n=1$）有贡献，其角向依赖关系为 $P_1(\\cos\\theta) = \\cos\\theta$。因此，每个区域的通解可以写为：\n- 区域 1（$0 < r < a_1$，电导率 $\\sigma_1$）： $$\\phi_1(r,\\theta) = \\left(\\frac{p}{4\\pi \\sigma_1 r^2} + A_1\\, r\\right) \\cos\\theta.$$\n- 区域 2（$a_1 < r < a_2$，电导率 $\\sigma_2$）： $$\\phi_2(r,\\theta) = \\left(A_2\\, r + B_2\\, r^{-2}\\right) \\cos\\theta.$$\n- 区域 3（$a_2 < r < a_3$，电导率 $\\sigma_3$）： $$\\phi_3(r,\\theta) = \\left(A_3\\, r + B_3\\, r^{-2}\\right) \\cos\\theta.$$\n\n系数 $A_1$、$A_2$、$B_2$、$A_3$ 和 $B_3$ 通过施加由物理定律导出的边界条件来确定：\n1. 在 $r = a_1$ 处电势连续： $$\\phi_1(a_1,\\theta) = \\phi_2(a_1,\\theta).$$\n2. 在 $r = a_1$ 处电流密度法向分量连续： $$\\sigma_1 \\left.\\frac{\\partial \\phi_1}{\\partial r}\\right|_{r=a_1} = \\sigma_2 \\left.\\frac{\\partial \\phi_2}{\\partial r}\\right|_{r=a_1}.$$\n3. 在 $r = a_2$ 处电势连续： $$\\phi_2(a_2,\\theta) = \\phi_3(a_2,\\theta).$$\n4. 在 $r = a_2$ 处电流密度法向分量连续： $$\\sigma_2 \\left.\\frac{\\partial \\phi_2}{\\partial r}\\right|_{r=a_2} = \\sigma_3 \\left.\\frac{\\partial \\phi_3}{\\partial r}\\right|_{r=a_2}.$$\n5. 由于外部不导电，在 $r = a_3$ 处法向电流为零的边界： $$\\left.\\frac{\\partial \\phi_3}{\\partial r}\\right|_{r=a_3} = 0.$$\n\n我们计算 $n=1$ 形式的径向导数（忽略 $\\cos\\theta$ 公共因子）：\n- 对于 $\\phi_1$: $$\\frac{\\partial}{\\partial r}\\left(\\frac{p}{4\\pi \\sigma_1 r^2} + A_1 r\\right) = -\\frac{2 p}{4\\pi \\sigma_1 r^3} + A_1.$$\n- 对于 $\\phi_2$: $$\\frac{\\partial}{\\partial r}\\left(A_2 r + B_2 r^{-2}\\right) = A_2 - 2 B_2 r^{-3}.$$\n- 对于 $\\phi_3$: $$\\frac{\\partial}{\\partial r}\\left(A_3 r + B_3 r^{-2}\\right) = A_3 - 2 B_3 r^{-3}.$$\n\n因为 $\\cos\\theta$ 可以被因子分解出来，边界条件变成了关于系数的线性方程组。明确地写出它们：\n- 在 $r=a_1$ 处（电势连续）： $$A_1 a_1 + \\frac{p}{4\\pi \\sigma_1 a_1^2} = A_2 a_1 + \\frac{B_2}{a_1^2}.$$\n- 在 $r=a_1$ 处（电流连续）： $$\\sigma_1 \\left(A_1 - \\frac{2 p}{4\\pi \\sigma_1 a_1^3}\\right) = \\sigma_2 \\left(A_2 - \\frac{2 B_2}{a_1^3}\\right).$$\n- 在 $r=a_2$ 处（电势连续）： $$A_2 a_2 + \\frac{B_2}{a_2^2} = A_3 a_2 + \\frac{B_3}{a_2^2}.$$\n- 在 $r=a_2$ 处（电流连续）： $$\\sigma_2 \\left(A_2 - \\frac{2 B_2}{a_2^3}\\right) = \\sigma_3 \\left(A_3 - \\frac{2 B_3}{a_2^3}\\right).$$\n- 在 $r=a_3$ 处（法向电流为零）： $$A_3 - \\frac{2 B_3}{a_3^3} = 0.$$\n\n这是一个包含五个未知数 $A_1, A_2, B_2, A_3, B_3$ 的五元线性方程组，我们使用标准线性代数方法求解。外边界上偶极子正上方点（$\\theta=0$）的头皮电势为 $$V(r) = \\phi_3(a_3,0) = A_3 a_3 + \\frac{B_3}{a_3^2}.$$ 使用 $r=a_3$ 处的零电流边界条件，我们有 $$B_3 = \\frac{A_3 a_3^3}{2},$$ 因此 $$V(r) = A_3 a_3 + \\frac{A_3 a_3^3}{2 a_3^2} = \\frac{3}{2} A_3 a_3.$$\n\n算法步骤：\n1. 对于给定的 $p$、$a_1$、$a_2$、$a_3$、$\\sigma_1$、$\\sigma_2 = r \\sigma_1$ 和 $\\sigma_3$，组装表示边界条件的 $5 \\times 5$ 线性系统，其未知向量为 $\\mathbf{x} = [A_1, A_2, B_2, A_3, B_3]^\\top$。\n2. 数值求解 $\\mathbf{A}\\mathbf{x} = \\mathbf{b}$ 以获得系数。\n3. 以伏特为单位计算 $V(r) = \\frac{3}{2} A_3 a_3$。通过乘以 $10^6$ 转换为微伏。\n4. 为计算灵敏度，使用对称有限差分法计算 $\\frac{dV}{dr}$，其中 $\\delta r = \\epsilon r$，$\\epsilon$ 是一个小的无量纲参数（例如 $\\epsilon = 10^{-4}$）：\n   $$\\frac{dV}{dr} \\approx \\frac{V(r+\\delta r) - V(r-\\delta r)}{2 \\delta r}.$$\n   然后计算相对对数灵敏度 $$S_{\\mathrm{rel}} = \\frac{r}{V(r)} \\frac{dV}{dr}.$$\n5. 对于 $\\{1.0, 1/15, 1/30, 1/80, 0.001\\}$ 中的每个测试值 $r$，输出 $[V_{\\mu V}, S_{\\mathrm{rel}}]$，两者均四舍五入到六位小数。\n6. 将所有数对聚合到一个列表中，并以指定格式精确打印一行。\n\n科学解释：\n- 当 $\\sigma_2$ 相对于 $\\sigma_1$ 减小（即 $r$ 变小）时，颅骨呈现更高的电阻，这通常会降低 EEG 的头皮电势，因为穿过颅骨的径向电流受阻。\n- 灵敏度 $S_{\\mathrm{rel}}$ 量化了头皮电势对 $r$ 的依赖强度；负值表示减小 $r$ 会降低 $V$，其绝对值大小表示对颅骨电导率变化的响应程度。\n\n该方法遵循基本物理定律，通过分离变量法使用经过充分检验的公式来求解分层球形问题，并提供了一个数值上稳健的实现和灵敏度分析，适用于高等研究生水平的神经科学数据分析。",
            "answer": "[[2.912543,0.000000],[0.741270,-0.418706],[0.428587,-0.435728],[0.187313,-0.443153],[0.015745,-0.447385]]"
        },
        {
            "introduction": "在掌握了信号起源和正向建模之后，本练习将引导您应对ECD分析的核心挑战：解决逆问题。您的任务是从传感器记录的噪声数据中定位神经源，这正是源定位的最终目标。通过实现Levenberg–Marquardt算法，您将获得处理非线性优化问题的实践经验，这是从EEG/MEG数据中拟合ECD参数的标准方法。",
            "id": "4159236",
            "problem": "给定一个在无限、均匀、各向同性导体中的脑电图（EEG）正向模型。一个位于位置 $\\mathbf{r} \\in \\mathbb{R}^3$、偶极矩为 $\\mathbf{q} \\in \\mathbb{R}^3$ 的等效电流偶极子（Equivalent Current Dipole, ECD），在传感器位置 $\\mathbf{r}_i \\in \\mathbb{R}^3$ 处产生的电势由以下经过充分检验的表达式给出：\n$$\n\\phi_i(\\boldsymbol{\\theta}) \\;=\\; \\frac{1}{4\\pi \\sigma} \\, \\frac{\\mathbf{q} \\cdot \\left(\\mathbf{r}_i - \\mathbf{r}\\right)}{\\left\\|\\mathbf{r}_i - \\mathbf{r}\\right\\|^3},\n$$\n其中 $\\sigma > 0$ 是电导率（单位为 $\\mathrm{S/m}$），$\\boldsymbol{\\theta} = \\begin{bmatrix} \\mathbf{r} \\\\ \\mathbf{q} \\end{bmatrix} \\in \\mathbb{R}^6$ 是参数向量。给定位于 $\\{\\mathbf{r}_i\\}_{i=1}^M$ 位置的 $M$ 个传感器，定义正向映射 $\\mathbf{f}(\\boldsymbol{\\theta}) \\in \\mathbb{R}^M$ 为 $[\\mathbf{f}(\\boldsymbol{\\theta})]_i = \\phi_i(\\boldsymbol{\\theta})$。带噪声的观测值由 $\\mathbf{y} = \\mathbf{f}(\\boldsymbol{\\theta}^\\star) + \\boldsymbol{\\varepsilon}$ 给出，其中 $\\boldsymbol{\\varepsilon}$ 是附加的零均值高斯噪声，其方差已知。考虑非线性最小二乘目标函数：\n$$\nS(\\boldsymbol{\\theta}) \\;=\\; \\frac{1}{2} \\, \\|\\mathbf{y} - \\mathbf{f}(\\boldsymbol{\\theta})\\|_2^2.\n$$\n\n任务：\n- 实现高斯-牛顿（Gauss–Newton）或列文伯格-马夸尔特（Levenberg–Marquardt, LM）更新，通过最小化 $S(\\boldsymbol{\\theta})$ 来估计 $\\boldsymbol{\\theta}$。您的实现必须：\n  - 构建残差向量 $\\mathbf{r}(\\boldsymbol{\\theta}) = \\mathbf{y} - \\mathbf{f}(\\boldsymbol{\\theta})$ 和雅可比矩阵 $\\mathbf{J}(\\boldsymbol{\\theta}) = \\frac{\\partial \\mathbf{f}}{\\partial \\boldsymbol{\\theta}}(\\boldsymbol{\\theta}) \\in \\mathbb{R}^{M \\times 6}$。\n  - 通过求解 $(\\mathbf{J}^\\top \\mathbf{J} + \\mu \\mathbf{I}) \\boldsymbol{\\delta} = \\mathbf{J}^\\top \\mathbf{r}$ 获得列文伯格-马夸尔特（LM）步长 $\\boldsymbol{\\delta}$，其中阻尼参数 $\\mu > 0$，并使用自适应 $\\mu$ 规则更新 $\\boldsymbol{\\theta} \\leftarrow \\boldsymbol{\\theta} + \\boldsymbol{\\delta}$，以确保在可能的情况下 $S(\\boldsymbol{\\theta})$ 得以减小。\n- 在您的解法中，从正向模型的定义和泰勒定理出发，论证在最优点附近局部收敛所需的线性化假设的合理性。您的论证必须基于基础正向模型和平滑函数的一般性质；不要假设任何此处未提供的特殊结构。\n\n物理和数值单位要求：\n- 位置 $\\mathbf{r}$ 和 $\\mathbf{r}_i$ 必须以 $\\mathrm{m}$ 为单位。\n- 偶极矩 $\\mathbf{q}$ 必须以 $\\mathrm{A\\cdot m}$ 为单位。\n- 电导率 $\\sigma$ 必须以 $\\mathrm{S/m}$ 为单位。\n- 电势 $\\phi_i$ 和观测值 $\\mathbf{y}$ 必须以 $\\mathrm{V}$ 为单位。\n- 如果使用任何角度生成传感器，所有角度必须以弧度为单位。\n\n测试套件：\n- 使用位于半径为 $R_\\mathrm{sens} = 0.09\\,\\mathrm{m}$ 的球面上的 $M = 24$ 个传感器，其极角 $\\theta \\in \\{\\pi/4, \\pi/2, 3\\pi/4\\}$，方位角 $\\varphi \\in \\left\\{ \\frac{2\\pi k}{8} \\,:\\, k = 0,1,\\dots,7 \\right\\}$，即传感器位置为 $\\mathbf{r}_i = R_\\mathrm{sens} \\,[\\sin\\theta \\cos\\varphi, \\sin\\theta \\sin\\varphi, \\cos\\theta]^\\top$。\n- 设置电导率 $\\sigma = 0.33\\,\\mathrm{S/m}$。\n- 定义 3 个案例，其真实参数、初始猜测和噪声水平如下：\n  1. 案例 A（理想情况）：$\\mathbf{r}^\\star = [0.02,\\, 0.01,\\, 0.04]\\,\\mathrm{m}$，$\\mathbf{q}^\\star = [1.0\\times10^{-8},\\, -2.0\\times10^{-8},\\, 0.5\\times10^{-8}]\\,\\mathrm{A\\cdot m}$，噪声标准差 $\\sigma_\\varepsilon = 5.0\\times10^{-8}\\,\\mathrm{V}$，初始猜测 $\\mathbf{r}_0 = [0.0,\\, 0.0,\\, 0.03]\\,\\mathrm{m}$，$\\mathbf{q}_0 = [1.0\\times10^{-8},\\, -1.0\\times10^{-8},\\, 0.0]\\,\\mathrm{A\\cdot m}$。\n  2. 案例 B（远离初值，无噪声）：与案例 A 相同的 $\\mathbf{r}^\\star$ 和 $\\mathbf{q}^\\star$，$\\sigma_\\varepsilon = 0\\,\\mathrm{V}$，初始猜测 $\\mathbf{r}_0 = [-0.03,\\, 0.02,\\, 0.02]\\,\\mathrm{m}$，$\\mathbf{q}_0 = [0.5\\times10^{-8},\\, -0.5\\times10^{-8},\\, 0.2\\times10^{-8}]\\,\\mathrm{A\\cdot m}$。\n  3. 案例 C（低振幅，高噪声）：$\\mathbf{r}^\\star = [0.0,\\, 0.0,\\, 0.005]\\,\\mathrm{m}$，$\\mathbf{q}^\\star = [1.0\\times10^{-8},\\, 1.0\\times10^{-8},\\, 1.0\\times10^{-8}]\\,\\mathrm{A\\cdot m}$，$\\sigma_\\varepsilon = 1.0\\times10^{-7}\\,\\mathrm{V}$，初始猜测 $\\mathbf{r}_0 = [0.0,\\, 0.0,\\, 0.0]\\,\\mathrm{m}$，$\\mathbf{q}_0 = [0.5\\times10^{-8},\\, 0.5\\times10^{-8},\\, 0.5\\times10^{-8}]\\,\\mathrm{A\\cdot m}$。\n\n实现细节：\n- 使用列文伯格-马夸尔特算法，每个案例最多 50 次迭代，初始阻尼 $\\mu_0 = 10^{-3}\\cdot \\max\\{\\mathrm{diag}(\\mathbf{J}^\\top \\mathbf{J})\\}$，减小因子 $\\beta_\\downarrow = 1/3$，增大因子 $\\beta_\\uparrow = 10$，且仅当更新能降低 $S(\\boldsymbol{\\theta})$ 时才接受。\n- 如果 $\\|\\boldsymbol{\\delta}\\|_2 \\le 10^{-9}$ 或 $S(\\boldsymbol{\\theta})$ 的相对减小量低于 $10^{-9}$，则提前终止。\n- 为保证数值安全性，如果在正向模型和雅可比矩阵中，任何 $\\|\\mathbf{r}_i - \\mathbf{r}\\|$ 低于 $10^{-6}\\,\\mathrm{m}$，则将其钳制在 $10^{-6}\\,\\mathrm{m}$。\n\n所需输出：\n- 对于 3 个案例中的每一个，计算：\n  - 最终欧几里得位置误差 $\\|\\widehat{\\mathbf{r}} - \\mathbf{r}^\\star\\|_2$，单位为 $\\mathrm{m}$。\n  - 最终均方根误差 $\\sqrt{\\frac{1}{M}\\|\\mathbf{y} - \\mathbf{f}(\\widehat{\\boldsymbol{\\theta}})\\|_2^2}$，单位为 $\\mathrm{V}$。\n- 您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列：\n  $[\\text{pos\\_err\\_A}, \\text{rmse\\_A}, \\text{pos\\_err\\_B}, \\text{rmse\\_B}, \\text{pos\\_err\\_C}, \\text{rmse\\_C}]$。\n- 所有浮点数均使用科学记数法表示，并保留恰好 $6$ 位有效数字（例如，$1.234560\\mathrm{e}{-03}$）。输出必须是无量纲的文本，但这些量分别对应于位置误差（$\\mathrm{m}$）和均方根误差（$\\mathrm{V}$）。",
            "solution": "该问题要求使用非线性最小二乘法，从带噪声的电势测量值中估计等效电流偶极子（ECD）的参数。待估计的参数是偶极子的三维位置 $\\mathbf{r}$ 及其三维矩向量 $\\mathbf{q}$，它们构成一个六维参数向量 $\\boldsymbol{\\theta} = [\\mathbf{r}^\\top, \\mathbf{q}^\\top]^\\top$。通过实现列文伯格-马夸尔特（LM）算法来执行优化，以最小化平方误差和目标函数 $S(\\boldsymbol{\\theta})$。\n\n### 线性化方法的合理性论证\n\n像高斯-牛顿和列文伯格-马夸尔特这类迭代优化算法的核心在于对非线性问题进行局部线性化。目标是最小化 $S(\\boldsymbol{\\theta}) = \\frac{1}{2} \\|\\mathbf{y} - \\mathbf{f}(\\boldsymbol{\\theta})\\|_2^2$，其中 $\\mathbf{f}(\\boldsymbol{\\theta})$ 是将参数映射到观测值的非线性正向模型。\n\n单个传感器 $i$ 的正向模型由下式给出：\n$$\n\\phi_i(\\boldsymbol{\\theta}) = \\frac{1}{4\\pi \\sigma} \\, \\frac{\\mathbf{q} \\cdot (\\mathbf{r}_i - \\mathbf{r})}{\\|\\mathbf{r}_i - \\mathbf{r}\\|^3}\n$$\n该函数是关于 $\\mathbf{r}$ 各分量的有理函数，是关于 $\\mathbf{q}$ 各分量的线性函数。这种形式的函数在其定义域内所有分母不为零的点上都是无限可微的（即光滑或 $C^\\infty$）。在这个物理模型中，分母 $\\|\\mathbf{r}_i - \\mathbf{r}\\|^3$ 仅当偶极子源与传感器共处一处时（即 $\\mathbf{r} = \\mathbf{r}_i$）才为零。由于偶极子代表头颅内的神经源，而传感器 $\\{\\mathbf{r}_i\\}$ 位于头皮表面，因此在物理有效的背景下，条件 $\\mathbf{r} \\neq \\mathbf{r}_i$ 总是满足的。因此，向量值正向映射 $\\mathbf{f}(\\boldsymbol{\\theta})$ 在整个感兴趣的定义域内是 $\\boldsymbol{\\theta}$ 的一个光滑函数。\n\n鉴于 $\\mathbf{f}(\\boldsymbol{\\theta})$ 的光滑性，我们可以应用泰勒定理。在第 $k$ 次迭代中，当前估计值为 $\\boldsymbol{\\theta}_k$，我们寻求一个更新步长 $\\boldsymbol{\\delta}$，使得 $\\boldsymbol{\\theta}_{k+1} = \\boldsymbol{\\theta}_k + \\boldsymbol{\\delta}$ 能减小目标函数值。对于一个小的步长 $\\boldsymbol{\\delta}$，正向模型可以由其在 $\\boldsymbol{\\theta}_k$ 附近的一阶泰勒展开来近似：\n$$\n\\mathbf{f}(\\boldsymbol{\\theta}_k + \\boldsymbol{\\delta}) \\approx \\mathbf{f}(\\boldsymbol{\\theta}_k) + \\mathbf{J}(\\boldsymbol{\\theta}_k) \\boldsymbol{\\delta}\n$$\n其中 $\\mathbf{J}(\\boldsymbol{\\theta}_k) = \\frac{\\partial \\mathbf{f}}{\\partial \\boldsymbol{\\theta}}(\\boldsymbol{\\theta}_k)$ 是 $\\mathbf{f}$ 在 $\\boldsymbol{\\theta}_k$ 处求值的雅可比矩阵。\n\n将此线性近似代入目标函数，我们得到 $S(\\boldsymbol{\\theta})$ 的一个二次近似：\n$$\nS(\\boldsymbol{\\theta}_k + \\boldsymbol{\\delta}) \\approx \\frac{1}{2} \\|\\mathbf{y} - (\\mathbf{f}(\\boldsymbol{\\theta}_k) + \\mathbf{J}(\\boldsymbol{\\theta}_k) \\boldsymbol{\\delta})\\|_2^2 = \\frac{1}{2} \\|\\mathbf{r}(\\boldsymbol{\\theta}_k) - \\mathbf{J}(\\boldsymbol{\\theta}_k) \\boldsymbol{\\delta}\\|_2^2\n$$\n其中 $\\mathbf{r}(\\boldsymbol{\\theta}_k) = \\mathbf{y} - \\mathbf{f}(\\boldsymbol{\\theta}_k)$ 是当前估计下的残差向量。对这个线性化目标函数关于 $\\boldsymbol{\\delta}$ 进行最小化是一个标准的线性最小二乘问题，其解由正规方程给出。高斯-牛顿算法直接求解 $(\\mathbf{J}_k^\\top \\mathbf{J}_k) \\boldsymbol{\\delta} = \\mathbf{J}_k^\\top \\mathbf{r}_k$。\n\n此程序的有效性和收敛性取决于线性近似的准确性。泰勒定理保证了该近似的误差为 $O(\\|\\boldsymbol{\\delta}\\|^2)$ 阶。因此，在真实解 $\\boldsymbol{\\theta}^\\star$ 的一个足够小的邻域内，线性模型非常精确，算法通常表现出快速（类二次）收敛。列文伯格-马夸尔特算法在此基础上引入了一个阻尼项，这使得该方法在远离解或雅可比矩阵病态时更加鲁棒，从而有效地确保向最小值前进。\n\n### 算法设计与实现\n\n该解法通过列文伯格-马夸尔特算法实现。这需要正向模型的解析雅可比矩阵。\n\n**1. 雅可比矩阵推导**\n雅可比矩阵 $\\mathbf{J}(\\boldsymbol{\\theta}) \\in \\mathbb{R}^{M \\times 6}$ 的元素为 $J_{ij} = \\frac{\\partial \\phi_i}{\\partial \\theta_j}$。其第 $i$ 行是第 $i$ 个传感器处的电势相对于参数向量 $\\boldsymbol{\\theta} = [r_x, r_y, r_z, q_x, q_y, q_z]^\\top$ 的梯度。令 $\\mathbf{d}_i = \\mathbf{r}_i - \\mathbf{r}$ 且 $d_i = \\|\\mathbf{d}_i\\|$。\n\n由于分子对 $\\mathbf{q}$ 是线性的，关于偶极矩分量 $\\mathbf{q}$ 的偏导数很容易求得：\n$$\n\\nabla_\\mathbf{q} \\phi_i(\\boldsymbol{\\theta}) = \\frac{\\partial \\phi_i}{\\partial \\mathbf{q}} = \\frac{1}{4\\pi \\sigma} \\frac{\\mathbf{r}_i - \\mathbf{r}}{\\|\\mathbf{r}_i - \\mathbf{r}\\|^3} = \\frac{\\mathbf{d}_i}{4\\pi \\sigma d_i^3}\n$$\n这构成了雅可比矩阵第 $i$ 行的第 4、5、6 列。\n\n关于偶极子位置分量 $\\mathbf{r}$ 的偏导数则更为复杂。使用商法则和链式法则，我们得到：\n$$\n\\nabla_\\mathbf{r} \\phi_i(\\boldsymbol{\\theta}) = \\frac{\\partial \\phi_i}{\\partial \\mathbf{r}} = \\frac{1}{4\\pi \\sigma} \\left( \\frac{-\\mathbf{q}}{d_i^3} + 3 \\frac{(\\mathbf{q} \\cdot \\mathbf{d}_i) \\mathbf{d}_i}{d_i^5} \\right)\n$$\n这个向量导数构成了雅可比矩阵第 $i$ 行的第 1、2、3 列。\n为保证数值稳定性，任何计算出的距离 $d_i$ 若小于 $10^{-6}\\,\\mathrm{m}$，则将其钳制在此最小值。\n\n**2. 列文伯格-马夸尔特迭代**\n算法流程如下：\n- **初始化**：从一个初始猜测 $\\boldsymbol{\\theta}_0$ 开始。计算初始残差 $\\mathbf{r}_0$、成本 $S_0$、雅可比矩阵 $\\mathbf{J}_0$ 和初始阻尼参数 $\\mu_0 = 10^{-3} \\cdot \\max\\{\\mathrm{diag}(\\mathbf{J}_0^\\top \\mathbf{J}_0)\\}$。\n- **迭代循环**：在每次迭代 $k$ 中：\n    1.  为步长 $\\boldsymbol{\\delta}_k$ 求解阻尼正规方程：\n        $$\n        (\\mathbf{J}_k^\\top \\mathbf{J}_k + \\mu_k \\mathbf{I}) \\boldsymbol{\\delta}_k = \\mathbf{J}_k^\\top \\mathbf{r}_k\n        $$\n    2.  评估候选参数向量 $\\boldsymbol{\\theta}_\\text{new} = \\boldsymbol{\\theta}_k + \\boldsymbol{\\delta}_k$ 及其对应的成本 $S_\\text{new} = S(\\boldsymbol{\\theta}_\\text{new})$。\n    3.  **自适应阻尼**：\n        - 如果 $S_\\text{new} < S_k$（成本下降），则接受该步：$\\boldsymbol{\\theta}_{k+1} = \\boldsymbol{\\theta}_\\text{new}$。减小阻尼参数：$\\mu_{k+1} = \\mu_k / 3$，使算法更接近于更快的的高斯-牛顿步。为下一次迭代更新雅可比矩阵和残差。\n        - 如果 $S_\\text{new} \\ge S_k$（成本未下降），则拒绝该步：$\\boldsymbol{\\theta}_{k+1} = \\boldsymbol{\\theta}_k$。增大阻尼参数：$\\mu_k \\leftarrow \\mu_k \\cdot 10$，使下一次尝试的步长更小，更接近梯度下降方向。然后算法使用增大的 $\\mu_k$ 重试求解新的 $\\boldsymbol{\\delta}_k$。\n- **终止**：当满足以下条件之一时，过程停止：\n    1. 达到最大迭代次数（50 次）。\n    2. 接受步长的范数可忽略不计：$\\|\\boldsymbol{\\delta}_k\\|_2 \\le 10^{-9}$。\n    3. 成本的相对减小量可忽略不计：$(S_k - S_{k+1})/S_k < 10^{-9}$。\n\n**3. 输出计算**：\n终止时，使用最终的参数估计值 $\\widehat{\\boldsymbol{\\theta}}$ 为每个测试案例计算所需的指标：\n- 最终位置误差：$\\|\\widehat{\\mathbf{r}} - \\mathbf{r}^\\star\\|_2$。\n- 最终均方根误差：$\\sqrt{\\frac{1}{M}\\|\\mathbf{y} - \\mathbf{f}(\\widehat{\\boldsymbol{\\theta}})\\|_2^2}$。\n然后将结果格式化为指定的单个输出字符串。",
            "answer": "[2.408796e-03,4.148897e-08,2.915837e-08,2.531201e-15,1.171727e-02,8.291763e-08]"
        }
    ]
}