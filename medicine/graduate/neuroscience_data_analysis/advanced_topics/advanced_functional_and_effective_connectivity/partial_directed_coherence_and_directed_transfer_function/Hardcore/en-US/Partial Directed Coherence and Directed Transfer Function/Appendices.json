{
    "hands_on_practices": [
        {
            "introduction": "Mastering any new tool begins with understanding its basic mechanics. This first practice grounds you in the fundamentals by asking you to compute Partial Directed Coherence (PDC) from its core definition for a simple, specified multivariate autoregressive (MVAR) model . By performing this calculation, you will see precisely how the coefficients of the autoregressive model, represented by the matrix $A_1$, translate into a frequency-specific measure of direct directed influence.",
            "id": "4184284",
            "problem": "Consider a stationary three-node multivariate autoregressive process of order one (AR(1)) for neural time series, written as $x(t)=A_{1}\\,x(t-1)+w(t)$, where $x(t)\\in\\mathbb{R}^{3}$, $A_{1}\\in\\mathbb{R}^{3\\times 3}$, and $w(t)$ is a zero-mean white innovation process with finite covariance. Let\n$$\nA_{1}=\\begin{bmatrix}\n0.5 & 0 & 0\\\\\n0.3 & 0.4 & 0\\\\\n0 & 0.2 & 0.6\n\\end{bmatrix}.\n$$\nUsing the standard frequency-domain construction of the autoregressive operator and the definition of Partial Directed Coherence (PDC) from node $j$ to node $i$, compute the PDC values $\\pi_{21}(f)$ and $\\pi_{31}(f)$ at frequency $f=0$ (frequency in cycles per sample). Based on these values, explain which directed influence from node $1$ is stronger at $f=0$ and why, in terms of the model structure.\n\nFor grading, report the single scalar quantity given by the squared magnitude of $\\pi_{21}(0)$, that is $|\\pi_{21}(0)|^2$. Round your answer to four significant figures. The reported value is unitless and must be provided as a pure number.",
            "solution": "The problem is valid as it is scientifically grounded in the theory of multivariate time series analysis, well-posed with all necessary information provided, and objective in its formulation. The stationarity condition for the given AR(1) process is met, as the eigenvalues of the matrix $A_1$, which are its diagonal entries ($0.5$, $0.4$, and $0.6$), all have magnitudes less than $1$.\n\nThe multivariate autoregressive (MVAR) process of order $p=1$ is given by:\n$$\nx(t) = A_1 x(t-1) + w(t)\n$$\nwhere $x(t) \\in \\mathbb{R}^3$ is the vector of time series values at time $t$, $A_1 \\in \\mathbb{R}^{3\\times 3}$ is the coefficient matrix, and $w(t)$ is a white noise vector process.\n\nTo analyze the process in the frequency domain, we perform a Fourier transform. This leads to the frequency-domain representation:\n$$\n\\bar{A}(f) X(f) = W(f)\n$$\nwhere $\\bar{A}(f)$ is the autoregressive operator in the frequency domain, defined as:\n$$\n\\bar{A}(f) = I - A_1 \\exp(-i 2 \\pi f)\n$$\nHere, $I$ is the $3 \\times 3$ identity matrix, $f$ is the frequency in cycles per sample, and $i = \\sqrt{-1}$.\n\nThe problem requires evaluation at frequency $f=0$. At this frequency, the exponential term becomes $\\exp(0) = 1$. The operator simplifies to:\n$$\n\\bar{A}(0) = I - A_1\n$$\nUsing the given matrix $A_1$:\n$$\nA_1 = \\begin{bmatrix}\n0.5 & 0 & 0 \\\\\n0.3 & 0.4 & 0 \\\\\n0 & 0.2 & 0.6\n\\end{bmatrix}\n$$\nwe compute $\\bar{A}(0)$:\n$$\n\\bar{A}(0) = \\begin{bmatrix}\n1 & 0 & 0 \\\\\n0 & 1 & 0 \\\\\n0 & 0 & 1\n\\end{bmatrix} - \\begin{bmatrix}\n0.5 & 0 & 0 \\\\\n0.3 & 0.4 & 0 \\\\\n0 & 0.2 & 0.6\n\\end{bmatrix} = \\begin{bmatrix}\n1-0.5 & -0 & -0 \\\\\n-0.3 & 1-0.4 & -0 \\\\\n-0 & -0.2 & 1-0.6\n\\end{bmatrix} = \\begin{bmatrix}\n0.5 & 0 & 0 \\\\\n-0.3 & 0.6 & 0 \\\\\n0 & -0.2 & 0.4\n\\end{bmatrix}\n$$\nPartial Directed Coherence (PDC) from node $j$ to node $i$ at frequency $f$, denoted $\\pi_{ij}(f)$, is defined using the elements of the $\\bar{A}(f)$ matrix. Its standard definition is:\n$$\n\\pi_{ij}(f) = \\frac{\\bar{A}_{ij}(f)}{\\sqrt{\\sum_{k=1}^{3} |\\bar{A}_{kj}(f)|^2}}\n$$\nwhere $\\bar{A}_{ij}(f)$ is the element in the $i$-th row and $j$-th column of $\\bar{A}(f)$. The denominator is the Euclidean norm of the $j$-th column of the matrix $\\bar{A}(f)$. This metric is normalized and quantifies the direct influence from $j$ to $i$ relative to the total influence of $j$ on all other nodes.\n\nWe need to compute $\\pi_{21}(0)$ and $\\pi_{31}(0)$, representing the influence from node $1$ to node $2$ and from node $1$ to node $3$, respectively, at frequency $f=0$. Both calculations use the first column ($j=1$) of the $\\bar{A}(0)$ matrix.\n\nThe first column of $\\bar{A}(0)$ is $\\begin{pmatrix} 0.5 \\\\ -0.3 \\\\ 0 \\end{pmatrix}$. The elements are $\\bar{A}_{11}(0)=0.5$, $\\bar{A}_{21}(0)=-0.3$, and $\\bar{A}_{31}(0)=0$.\nFirst, we calculate the denominator term for $j=1$:\n$$\n\\sqrt{\\sum_{k=1}^{3} |\\bar{A}_{k1}(0)|^2} = \\sqrt{|\\bar{A}_{11}(0)|^2 + |\\bar{A}_{21}(0)|^2 + |\\bar{A}_{31}(0)|^2} = \\sqrt{|0.5|^2 + |-0.3|^2 + |0|^2} = \\sqrt{0.25 + 0.09 + 0} = \\sqrt{0.34}\n$$\nNow, we compute $\\pi_{21}(0)$:\n$$\n\\pi_{21}(0) = \\frac{\\bar{A}_{21}(0)}{\\sqrt{0.34}} = \\frac{-0.3}{\\sqrt{0.34}}\n$$\nNext, we compute $\\pi_{31}(0)$:\n$$\n\\pi_{31}(0) = \\frac{\\bar{A}_{31}(0)}{\\sqrt{0.34}} = \\frac{0}{\\sqrt{0.34}} = 0\n$$\nTo compare the strengths of the influences, we examine their squared magnitudes, $|\\pi_{ij}(0)|^2$:\n$$\n|\\pi_{21}(0)|^2 = \\left| \\frac{-0.3}{\\sqrt{0.34}} \\right|^2 = \\frac{0.09}{0.34} \\approx 0.2647\n$$\n$$\n|\\pi_{31}(0)|^2 = |0|^2 = 0\n$$\nSince $|\\pi_{21}(0)|^2 > |\\pi_{31}(0)|^2$, the directed influence from node $1$ to node $2$ is stronger than from node $1$ to node $3$ at $f=0$.\n\nThis result can be explained directly from the model structure. In an AR model, the coefficient $(A_p)_{ij}$ quantifies the direct linear influence of $x_j(t-p)$ on $x_i(t)$. In our AR(1) model, the coefficient $(A_1)_{ij}$ represents the influence of $x_j(t-1)$ on $x_i(t)$.\nFrom the given matrix $A_1$:\n- The influence $1 \\to 2$ is determined by $(A_1)_{21} = 0.3$.\n- The influence $1 \\to 3$ is determined by $(A_1)_{31} = 0$.\nA non-zero coefficient $(A_1)_{21}$ implies a direct causal link from node $1$ to node $2$, which results in a non-zero PDC value. Conversely, the zero coefficient $(A_1)_{31}$ signifies the absence of a direct causal link from node $1$ to node $3$, leading to a PDC value of zero for all frequencies. The PDC analysis thus correctly identifies the presence of the $1 \\to 2$ connection and the absence of the $1 \\to 3$ connection specified in the model's coefficient matrix.\n\nThe problem asks for the scalar quantity $|\\pi_{21}(0)|^2$, rounded to four significant figures.\n$$\n|\\pi_{21}(0)|^2 = \\frac{0.09}{0.34} = \\frac{9}{34} \\approx 0.26470588...\n$$\nRounding to four significant figures yields $0.2647$.",
            "answer": "$$\n\\boxed{0.2647}\n$$"
        },
        {
            "introduction": "While PDC reveals direct connections, neuroscience questions often involve influences that propagate through multi-step pathways. The Directed Transfer Function (DTF) is designed to capture this total influence, and its properties stem from the transfer matrix $H(f)$, which is the inverse of the MVAR model's operator $A(f)$. This thought experiment challenges you to explore the mathematical relationship between $A(f)$ and $H(f)$ to understand precisely why DTF can detect indirect connections that PDC misses .",
            "id": "4184225",
            "problem": "Consider a $N$-dimensional Multivariate Autoregressive (MVAR) model in the frequency domain, where the spectral representation takes the form $A(f) X(f) = E(f)$ with $X(f)$ the vector of Fourier transforms of the observed processes, $E(f)$ the Fourier transforms of the innovations, and $A(f)$ the complex-valued MVAR polynomial matrix. The corresponding transfer matrix is $H(f) = A(f)^{-1}$ so that $X(f) = H(f) E(f)$. Partial Directed Coherence (PDC) and Directed Transfer Function (DTF) are frequency-domain measures of directed interactions defined from $A(f)$ and $H(f)$, respectively, with PDC emphasizing direct connections and DTF emphasizing the net propagated influence. Assume that for each frequency $f$, $A(f)$ is lower triangular with nonzero entries only on and below the diagonal (i.e., $A_{ij}(f) = 0$ whenever $i < j$) and $A_{ii}(f) \\neq 0$ for all $i$. Focus on the $3$-node case with indices ordered so that possible influences are $1 \\to 2 \\to 3$ and potentially $1 \\to 3$, consistent with the lower-triangular structure.\n\nSelect all statements that must hold under these assumptions.\n\nA. If $A_{31}(f) = 0$ but $A_{21}(f) \\neq 0$ and $A_{32}(f) \\neq 0$, then the Directed Transfer Function (DTF) entry $H_{31}(f)$ is nonzero.\n\nB. The Partial Directed Coherence (PDC) from node $1$ to node $3$ at frequency $f$ is nonzero if and only if $A_{31}(f) \\neq 0$.\n\nC. If $A(f)$ is lower triangular with $A_{ii}(f)\\neq 0$, then $H(f)=A(f)^{-1}$ is lower triangular and $H_{31}(f) = \\frac{A_{21}(f)A_{32}(f) - A_{31}(f)A_{22}(f)}{A_{33}(f)A_{22}(f)A_{11}(f)}$.\n\nD. Because both DTF and PDC use frequency-domain normalization, they coincide entrywise: for all $i,j$, $|H_{ij}(f)|$ is proportional to $|A_{ij}(f)|$ after normalization.\n\nE. The PDC from node $1$ to node $2$ depends only on $H_{21}(f)$ since $H(f)$ propagates direct edges.\n\nF. Under the same triangularity assumptions, $H_{21}(f) = -\\frac{A_{21}(f)}{A_{22}(f) A_{11}(f)}$.",
            "solution": "The problem statement is subjected to validation.\n\n### Step 1: Extract Givens\n-   The model is a $N$-dimensional Multivariate Autoregressive (MVAR) model.\n-   The frequency-domain representation is $A(f) X(f) = E(f)$.\n-   $X(f)$ is the vector of Fourier transforms of the observed processes.\n-   $E(f)$ is the vector of Fourier transforms of the innovations.\n-   $A(f)$ is the complex-valued MVAR polynomial matrix.\n-   The transfer matrix is $H(f) = A(f)^{-1}$.\n-   The relationship $X(f) = H(f) E(f)$ holds.\n-   Partial Directed Coherence (PDC) is a measure defined from $A(f)$ and emphasizes direct connections.\n-   Directed Transfer Function (DTF) is a measure defined from $H(f)$ and emphasizes net propagated influence.\n-   Assumption: For each frequency $f$, $A(f)$ is a lower triangular matrix.\n-   This means $A_{ij}(f) = 0$ for all $i < j$.\n-   Assumption: $A_{ii}(f) \\neq 0$ for all $i$.\n-   The context is a $3$-node case, so $N=3$.\n-   The node indices are ordered $1, 2, 3$ such that influences are consistent with the lower-triangular structure (e.g., $1 \\to 2, 1 \\to 3, 2 \\to 3$).\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientific Grounding**: The problem is correctly framed within the standard theory of MVAR models and their frequency-domain analysis. The definitions of $A(f)$, $H(f)$, PDC, and DTF, and their conceptual roles (direct vs. propagated influence) are consistent with established literature in signal processing and computational neuroscience. The relationship $H(f) = A(f)^{-1}$ is fundamental.\n-   **Well-Posedness**: The problem is well-posed. The assumption that $A(f)$ is a lower triangular matrix with non-zero diagonal entries guarantees that it is invertible, and its inverse $H(f)$ is also a lower triangular matrix. This provides a sound mathematical basis for uniquely determining the entries of $H(f)$ from $A(f)$ and evaluating the statements.\n-   **Objectivity**: The problem is stated in precise, objective mathematical language, free of ambiguity or subjective claims.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is a sound and well-posed question about the mathematical properties of MVAR-based connectivity measures under specific, clear assumptions. I will proceed with deriving the solution.\n\n### Principle-Based Derivation\n\nFor the $N=3$ case, the matrix $A(f)$ is a $3 \\times 3$ lower triangular matrix:\n$$ A(f) = \\begin{pmatrix} A_{11}(f) & 0 & 0 \\\\ A_{21}(f) & A_{22}(f) & 0 \\\\ A_{31}(f) & A_{32}(f) & A_{33}(f) \\end{pmatrix} $$\nWe are given that $A_{ii}(f) \\neq 0$ for $i \\in \\{1, 2, 3\\}$. The transfer matrix $H(f) = A(f)^{-1}$. The inverse of a lower triangular matrix is also lower triangular, so $H(f)$ has the form:\n$$ H(f) = \\begin{pmatrix} H_{11}(f) & 0 & 0 \\\\ H_{21}(f) & H_{22}(f) & 0 \\\\ H_{31}(f) & H_{32}(f) & H_{33}(f) \\end{pmatrix} $$\nWe find the entries of $H(f)$ by solving the matrix equation $A(f)H(f) = I$, where $I$ is the $3 \\times 3$ identity matrix. For clarity, the frequency argument $(f)$ will be omitted in the intermediate steps.\n\n$$ \\begin{pmatrix} A_{11} & 0 & 0 \\\\ A_{21} & A_{22} & 0 \\\\ A_{31} & A_{32} & A_{33} \\end{pmatrix} \\begin{pmatrix} H_{11} & 0 & 0 \\\\ H_{21} & H_{22} & 0 \\\\ H_{31} & H_{32} & H_{33} \\end{pmatrix} = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} $$\n\n1.  **Diagonal Entries**:\n    -   $(1,1)$: $A_{11}H_{11} = 1 \\implies H_{11} = \\frac{1}{A_{11}}$\n    -   $(2,2)$: $A_{22}H_{22} = 1 \\implies H_{22} = \\frac{1}{A_{22}}$\n    -   $(3,3)$: $A_{33}H_{33} = 1 \\implies H_{33} = \\frac{1}{A_{33}}$\n\n2.  **Off-Diagonal Entries**:\n    -   $(2,1)$: $A_{21}H_{11} + A_{22}H_{21} = 0 \\implies H_{21} = -\\frac{A_{21}H_{11}}{A_{22}} = -\\frac{A_{21}}{A_{11}A_{22}}$\n    -   $(3,2)$: $A_{32}H_{22} + A_{33}H_{32} = 0 \\implies H_{32} = -\\frac{A_{32}H_{22}}{A_{33}} = -\\frac{A_{32}}{A_{22}A_{33}}$\n    -   $(3,1)$: $A_{31}H_{11} + A_{32}H_{21} + A_{33}H_{31} = 0$\n        $A_{33}H_{31} = -A_{31}H_{11} - A_{32}H_{21}$\n        $A_{33}H_{31} = -A_{31}\\left(\\frac{1}{A_{11}}\\right) - A_{32}\\left(-\\frac{A_{21}}{A_{11}A_{22}}\\right)$\n        $A_{33}H_{31} = \\frac{-A_{31}A_{22} + A_{21}A_{32}}{A_{11}A_{22}}$\n        $H_{31} = \\frac{A_{21}A_{32} - A_{31}A_{22}}{A_{11}A_{22}A_{33}}$\n\nRestoring the frequency argument $(f)$, we have:\n$$ H_{21}(f) = -\\frac{A_{21}(f)}{A_{11}(f)A_{22}(f)} $$\n$$ H_{31}(f) = \\frac{A_{21}(f)A_{32}(f) - A_{31}(f)A_{22}(f)}{A_{11}(f)A_{22}(f)A_{33}(f)} $$\n\n**Conceptual Definitions:**\n-   **PDC** from node $j$ to $i$ is a normalized measure of the coefficient $A_{ij}(f)$. It is designed to be non-zero if and only if the direct causal link from $j$ to $i$ (as represented by $A_{ij}(f)$) is non-zero.\n-   **DTF** from node $j$ to $i$ is a normalized measure of the transfer function element $H_{ij}(f)$. It is non-zero if and only if $H_{ij}(f)$ is non-zero. $H_{ij}(f)$ represents the total influence of the innovation at node $j$ on the signal at node $i$, which includes all direct and indirect pathways.\n\n### Option-by-Option Analysis\n\n**A. If $A_{31}(f) = 0$ but $A_{21}(f) \\neq 0$ and $A_{32}(f) \\neq 0$, then the Directed Transfer Function (DTF) entry $H_{31}(f)$ is nonzero.**\nLet's use the derived formula for $H_{31}(f)$ and substitute the given conditions:\n$$ H_{31}(f) = \\frac{A_{21}(f)A_{32}(f) - A_{31}(f)A_{22}(f)}{A_{11}(f)A_{22}(f)A_{33}(f)} $$\nWith $A_{31}(f) = 0$, this simplifies to:\n$$ H_{31}(f) = \\frac{A_{21}(f)A_{32}(f)}{A_{11}(f)A_{22}(f)A_{33}(f)} $$\nThe problem states $A_{21}(f) \\neq 0$ and $A_{32}(f) \\neq 0$, so their product in the numerator is non-zero. The problem assumptions also state $A_{ii}(f) \\neq 0$ for all $i$, so the denominator is non-zero. Therefore, $H_{31}(f)$ must be non-zero. This reflects that while the direct path $1 \\to 3$ is absent ($A_{31}(f) = 0$), there is an indirect path $1 \\to 2 \\to 3$ (since $A_{21}(f) \\neq 0$ and $A_{32}(f) \\neq 0$), which is captured by the DTF.\nThe statement is **Correct**.\n\n**B. The Partial Directed Coherence (PDC) from node $1$ to node $3$ at frequency $f$ is nonzero if and only if $A_{31}(f) \\neq 0$.**\nBy its definition, PDC from node $j$ to node $i$ is a normalized version of the MVAR coefficient $A_{ij}(f)$. A common definition is $\\text{PDC}_{i \\leftarrow j}(f) \\propto A_{ij}(f)$. The normalization factor involves a sum of squares of the coefficients in the $j$-th column of $A(f)$. Since we assume $A_{jj}(f) \\neq 0$, this column is never a zero vector, and the normalization factor is always non-zero and finite. Consequently, $\\text{PDC}_{i \\leftarrow j}(f)$ is zero if and only if $A_{ij}(f)$ is zero. For the connection from node $1$ to node $3$, this means $\\text{PDC}_{3 \\leftarrow 1}(f)$ is non-zero if and only if $A_{31}(f) \\neq 0$. This is the core purpose of PDC: to isolate and quantify direct causal influences as represented in the MVAR coefficients.\nThe statement is **Correct**.\n\n**C. If $A(f)$ is lower triangular with $A_{ii}(f)\\neq 0$, then $H(f)=A(f)^{-1}$ is lower triangular and $$H_{31}(f) = \\frac{A_{21}(f)A_{32}(f) - A_{31}(f)A_{22}(f)}{A_{33}(f)A_{22}(f)A_{11}(f)}.$$**\nThe fact that the inverse of a lower triangular matrix is lower triangular is a standard theorem in linear algebra. The formula for $H_{31}(f)$ was derived above:\n$$ H_{31}(f) = \\frac{A_{21}(f)A_{32}(f) - A_{31}(f)A_{22}(f)}{A_{11}(f)A_{22}(f)A_{33}(f)} $$\nThis is mathematically identical to the formula provided in the option, as multiplication of scalars is commutative. Both parts of the statement are accurate.\nThe statement is **Correct**.\n\n**D. Because both DTF and PDC use frequency-domain normalization, they coincide entrywise: for all $i,j$, $|H_{ij}(f)|$ is proportional to $|A_{ij}(f)|$ after normalization.**\nThis statement is fundamentally incorrect. It conflates the MVAR coefficient matrix $A(f)$ with its inverse, the transfer matrix $H(f)$. Matrix inversion is a global operation; an element $H_{ij}(f)$ generally depends on multiple elements of $A(f)$. A clear counterexample is provided by the analysis for option A: when $A_{31}(f)=0$ but there is an indirect path ($A_{21}(f) \\neq 0, A_{32}(f) \\neq 0$), we have $|A_{31}(f)|=0$ while $|H_{31}(f)| \\neq 0$. Zero cannot be proportional to a non-zero value. PDC measures direct links ($A_{ij}$), while DTF measures total propagated influence ($H_{ij}$); they are conceptually and mathematically distinct.\nThe statement is **Incorrect**.\n\n**E. The PDC from node $1$ to node $2$ depends only on $H_{21}(f)$ since $H(f)$ propagates direct edges.**\nThis statement contains two falsehoods. First, PDC is defined from the matrix $A(f)$, not $H(f)$. The PDC from $1 \\to 2$ is a normalized version of $A_{21}(f)$. While we can express $A_{21}(f)$ in terms of $H_{21}(f)$ (i.e., $A_{21}(f) = -H_{21}(f)A_{11}(f)A_{22}(f)$), its calculation also requires $A_{11}(f)$ and $A_{22}(f)$, and the normalization term for PDC itself depends on other elements of $A(f)$, such as $A_{11}(f)$ and $A_{31}(f)$. Thus, PDC does not depend *only* on $H_{21}(f)$. Second, the reasoning \"since $H(f)$ propagates direct edges\" is incorrect. $A(f)$ represents the direct one-step predictive relationships in the model, whereas $H(f)$ represents the total transfer function, encompassing all (direct and indirect) pathways.\nThe statement is **Incorrect**.\n\n**F. Under the same triangularity assumptions, $$H_{21}(f) = -\\frac{A_{21}(f)}{A_{22}(f) A_{11}(f)}.$$**\nThis formula was derived in the initial section of the solution. From the $(2,1)$-th entry of the matrix product $A(f)H(f)=I$, we have $A_{21}(f)H_{11}(f) + A_{22}(f)H_{21}(f) = 0$. Using $H_{11}(f) = 1/A_{11}(f)$, we solve for $H_{21}(f)$:\n$$ A_{22}(f)H_{21}(f) = -A_{21}(f)H_{11}(f) = -\\frac{A_{21}(f)}{A_{11}(f)} $$\n$$ H_{21}(f) = -\\frac{A_{21}(f)}{A_{11}(f)A_{22}(f)} $$\nThe formula in the option is identical, just with the denominator terms swapped, which is permissible.\nThe statement is **Correct**.",
            "answer": "$$\\boxed{ABCF}$$"
        },
        {
            "introduction": "Theoretical knowledge comes to life when applied in practice. This coding exercise tasks you with implementing both PDC and DTF to analyze a simulated network where influence flows indirectly from one node to another via an intermediary . By observing the outputs of your own implementation, you will gain a powerful, intuitive confirmation of how DTF captures total (unconditional) causality, while PDC isolates direct (conditional) causality, a critical distinction for interpreting brain connectivity results.",
            "id": "4184294",
            "problem": "Consider a three-dimensional, discrete-time, stationary, linear Multivariate Autoregressive (MVAR) process of order $p$ with whitened innovations, written as $X(t) = \\sum_{k=1}^{p} A_k X(t-k) + \\varepsilon(t)$, where $X(t) \\in \\mathbb{R}^3$, $\\varepsilon(t)$ is zero-mean white noise with identity covariance, and the coefficient matrices $\\{A_k\\}$ yield a stable system. In the context of neuroscience data analysis, this model is commonly used to study spectral causality measures such as Directed Transfer Function (DTF) and Partial Directed Coherence (PDC), which are frequency-domain tools used to assess directed influence among nodes. Directed Transfer Function (DTF) and Partial Directed Coherence (PDC) must be implemented using their canonical definitions derived from the MVAR spectral representation without relying on any shortcut formulas provided in this problem statement.\n\nYour task is to construct and analyze a three-node example where the influence from $x_1$ to $x_2$ occurs only via $x_3$, and to show that Directed Transfer Function (DTF) indicates a $1 \\to 2$ influence whereas Partial Directed Coherence (PDC) does not, and to relate this to conditional versus unconditional Granger causality (GC) behavior.\n\nUse an MVAR($1$) model, with coefficient matrix $A_1$ defined as follows for the base case:\n$$\nA_1 =\n\\begin{bmatrix}\n0 & 0 & 0 \\\\\n0 & 0 & g \\\\\nh & 0 & 0\n\\end{bmatrix},\n$$\nwith $g = 0.4$ and $h = 0.5$, which encodes $x_1 \\to x_3$ with strength $h$ and $x_3 \\to x_2$ with strength $g$, and no direct $x_1 \\to x_2$ term. The system has whitened innovations and is stable. Consider the frequency domain on the unit circle with $z = e^{i 2 \\pi f}$, where $f$ is the frequency in cycles per sample.\n\nImplement both Partial Directed Coherence (PDC) and Directed Transfer Function (DTF) from first principles, starting from the MVAR spectral representation. For each measure, determine whether there is a directed influence $1 \\to 2$ according to the following detection rule: at a given frequency $f$, the measure indicates a link $2 \\leftarrow 1$ if its magnitude for $2 \\leftarrow 1$ exceeds a detection threshold $\\tau = 10^{-8}$; for a model, declare that a measure indicates $1 \\to 2$ if this occurs at any tested frequency.\n\nUse the following test suite of three parameter settings and three frequency points:\n- Frequencies to evaluate: $f \\in \\{0.0, 0.25, 0.5\\}$ cycles per sample.\n- Test Case 1 (indirect only): $A_1$ as above with $g = 0.4$, $h = 0.5$, and no direct $x_1 \\to x_2$.\n- Test Case 2 (indirect plus direct): same as Test Case 1, but add a direct connection $x_1 \\to x_2$ with coefficient $d = 0.3$, i.e., set the $(2,1)$ entry of $A_1$ to $d$.\n- Test Case 3 (no path): set $g = 0$, $h = 0$, and $d = 0$, i.e., $A_1$ is the zero matrix, so there is no $x_1 \\to x_2$ influence either directly or indirectly.\n\nFor each test case, compute the boolean detection pair $\\big[\\text{DTF detects } 1 \\to 2, \\text{PDC detects } 1 \\to 2\\big]$ according to the above rule across the specified frequencies.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the following aggregated format: a list of three lists, one per test case, where each inner list contains two booleans in the order $\\big[\\text{DTF detects}, \\text{PDC detects}\\big]$. For example, the output should look like $\\big[[b_{11},b_{12}],[b_{21},b_{22}],[b_{31},b_{32}]\\big]$, where each $b_{ij}$ is either $\\text{True}$ or $\\text{False}$.",
            "solution": "We start from the Multivariate Autoregressive (MVAR) spectral representation for a stable MVAR($p$) process with whitened innovations. Let the autoregressive polynomial be defined as\n$$\nA(f) = I - \\sum_{k=1}^{p} A_k e^{-i 2 \\pi f k},\n$$\nwhere $I$ is the identity matrix and $f$ is frequency in cycles per sample. The transfer matrix is\n$$\nH(f) = A(f)^{-1}.\n$$\nDirected Transfer Function (DTF) and Partial Directed Coherence (PDC) are frequency-domain measures defined in terms of $H(f)$ and $A(f)$, respectively. For Directed Transfer Function (DTF), we use row-wise normalization of the transfer matrix:\n$$\n\\text{DTF}_{i \\leftarrow j}(f) = \\frac{\\left|H_{ij}(f)\\right|}{\\sqrt{\\sum_{k=1}^{N} \\left|H_{ik}(f)\\right|^2}},\n$$\nwhich quantifies the fraction of the signal power arriving at node $i$ from node $j$ at frequency $f$ relative to all incoming sources to node $i$. For Partial Directed Coherence (PDC), we use column-wise normalization of the autoregressive polynomial:\n$$\n\\text{PDC}_{i \\leftarrow j}(f) = \\frac{\\left|A_{ij}(f)\\right|}{\\sqrt{\\sum_{k=1}^{N} \\left|A_{kj}(f)\\right|^2}}.\n$$\nPartial Directed Coherence (PDC) reflects conditional Granger causality (GC), focusing on direct edges after conditioning on the remaining variables (it normalizes across what flows out of $x_j$ in the autoregressive representation). Directed Transfer Function (DTF), in contrast, reflects unconditional Granger causality in the sense that it captures any pathway through which $x_j$ can influence $x_i$ in the transfer function, including indirect paths, because $H(f)$ contains the accumulated effect of all lags and paths.\n\nNow consider the specified three-node MVAR($1$) model. For the base case, the coefficient matrix is\n$$\nA_1 =\n\\begin{bmatrix}\n0 & 0 & 0 \\\\\n0 & 0 & g \\\\\nh & 0 & 0\n\\end{bmatrix},\n\\quad g = 0.4,\\ h = 0.5.\n$$\nThe autoregressive polynomial for order $p=1$ is\n$$\nA(f) = I - A_1 e^{-i 2 \\pi f}.\n$$\nNote that the $(2,1)$ entry of $A_1$ is zero in the base case, so\n$$\nA_{21}(f) = 0 \\quad \\text{for all } f,\n$$\nand therefore\n$$\n\\text{PDC}_{2 \\leftarrow 1}(f) = 0 \\quad \\text{for all } f,\n$$\nsince the numerator is zero while the denominator is finite due to the nonzero diagonal term in $A(f)$.\n\nTo analyze Directed Transfer Function (DTF), we examine the transfer matrix\n$$\nH(f) = A(f)^{-1}.\n$$\nDefine $B(f) = A_1 e^{-i 2 \\pi f}$; then $A(f) = I - B(f)$. For a stable system with small operator norm of $B(f)$, we can write the Neumann expansion\n$$\nH(f) = (I - B(f))^{-1} = I + B(f) + B(f)^2 + B(f)^3 + \\cdots.\n$$\nIn the present case, the matrix $A_1$ is strictly off-diagonal and nilpotent of index $3$ due to the $x_1 \\to x_3$ and $x_3 \\to x_2$ chain; specifically, $A_1^3 = 0$. Consequently,\n$$\nH(f) = I + B(f) + B(f)^2,\n$$\nwith higher powers zero. The $(2,1)$ entry of $H(f)$ is contributed only by the second power term,\n$$\nH_{21}(f) = \\left[B(f)^2\\right]_{21}.\n$$\nBecause $B(f) = A_1 e^{-i 2 \\pi f}$ and matrix multiplication yields\n$$\n\\left[A_1^2\\right]_{21} = \\left[A_1\\right]_{23} \\left[A_1\\right]_{31} = g h,\n$$\nwe obtain\n$$\nH_{21}(f) = e^{-i 4 \\pi f} \\, g h,\n$$\nwhich has nonzero magnitude for all $f$. Therefore,\n$$\n\\text{DTF}_{2 \\leftarrow 1}(f) = \\frac{|g h|}{\\sqrt{|H_{21}(f)|^2 + |H_{22}(f)|^2 + |H_{23}(f)|^2}} = \\frac{|g h|}{\\sqrt{(g h)^2 + 1^2 + g^2}},\n$$\nsince $H_{22}(f) = 1$ (from $I$) and $H_{23}(f) = e^{-i 2 \\pi f} g$ (from $B(f)$). Hence, Directed Transfer Function (DTF) indicates a nonzero $1 \\to 2$ influence, while Partial Directed Coherence (PDC) does not, precisely capturing the distinction between unconditional Granger causality (DTF attracting indirect paths) and conditional Granger causality (PDC isolating direct edges).\n\nFor Test Case 2, include a direct connection $x_1 \\to x_2$ by setting $A_{21} = d$ with $d = 0.3$. Then\n$$\nA_{21}(f) = -d e^{-i 2 \\pi f} \\neq 0,\n$$\nso Partial Directed Coherence (PDC) detects the $1 \\to 2$ edge (the numerator is nonzero), and Directed Transfer Function (DTF) also detects it since $H_{21}(f)$ remains nonzero. For Test Case 3, set $g = h = d = 0$, so $A_1 = 0$, $A(f) = I$, and $H(f) = I$. Then both $\\text{DTF}_{2 \\leftarrow 1}(f)$ and $\\text{PDC}_{2 \\leftarrow 1}(f)$ are zero for all $f$.\n\nAlgorithmic steps for the program:\n1. For each test case, construct $A_1$.\n2. For each frequency $f \\in \\{0.0, 0.25, 0.5\\}$, compute $A(f) = I - A_1 e^{-i 2 \\pi f}$ and $H(f) = A(f)^{-1}$.\n3. Compute $\\text{DTF}_{2 \\leftarrow 1}(f)$ via row-wise normalization of $H(f)$ for row $i=2$ and column $j=1$.\n4. Compute $\\text{PDC}_{2 \\leftarrow 1}(f)$ via column-wise normalization of $A(f)$ for column $j=1$ and row $i=2$.\n5. Apply the detection rule with threshold $\\tau = 10^{-8}$: a measure indicates $1 \\to 2$ if its magnitude exceeds $\\tau$ for any frequency.\n6. Aggregate the booleans per test case into the specified single-line output format.\n\nExpected qualitative outcomes:\n- Test Case 1: $\\big[\\text{True}, \\text{False}\\big]$ because $\\text{DTF}_{2 \\leftarrow 1}(f) > 0$ for all $f$ due to the indirect path via $x_3$, while $\\text{PDC}_{2 \\leftarrow 1}(f) = 0$ since there is no direct $x_1 \\to x_2$ coefficient.\n- Test Case 2: $\\big[\\text{True}, \\text{True}\\big]$ because both measures detect the direct edge and the indirect path.\n- Test Case 3: $\\big[\\text{False}, \\text{False}\\big]$ because there is no path from $x_1$ to $x_2$.\n\nThis behavior directly illustrates the relationship to Granger causality: Directed Transfer Function (DTF) reflects unconditional Granger causality by aggregating all pathways encoded in the transfer matrix, while Partial Directed Coherence (PDC) reflects conditional Granger causality by isolating direct dependencies in the autoregressive polynomial after conditioning on all other nodes.",
            "answer": "```python\nimport numpy as np\n\ndef compute_A_f(A_list, f):\n    \"\"\"\n    Compute A(f) = I - sum_k A_k * exp(-i 2 pi f k)\n    for a given list of A_k (k=1..p) and frequency f in cycles/sample.\n    \"\"\"\n    n = A_list[0].shape[0]\n    A_f = np.eye(n, dtype=complex)\n    for k, A_k in enumerate(A_list, start=1):\n        A_f = A_f - A_k * np.exp(-1j * 2 * np.pi * f * k)\n    return A_f\n\ndef dtf_ij(A_list, f, i, j):\n    \"\"\"\n    Compute row-normalized DTF_{i<-j}(f) = |H_ij(f)| / sqrt(sum_k |H_ik(f)|^2)\n    where H(f) = A(f)^{-1}.\n    \"\"\"\n    A_f = compute_A_f(A_list, f)\n    H_f = np.linalg.inv(A_f)\n    row_i = H_f[i, :]\n    denom = np.sqrt(np.sum(np.abs(row_i)**2))\n    if denom == 0:\n        return 0.0\n    return np.abs(H_f[i, j]) / denom\n\ndef pdc_ij(A_list, f, i, j):\n    \"\"\"\n    Compute column-normalized PDC_{i<-j}(f) = |A_ij(f)| / sqrt(sum_k |A_kj(f)|^2)\n    where A(f) = I - sum_k A_k * exp(-i 2 pi f k).\n    \"\"\"\n    A_f = compute_A_f(A_list, f)\n    col_j = A_f[:, j]\n    denom = np.sqrt(np.sum(np.abs(col_j)**2))\n    if denom == 0:\n        return 0.0\n    return np.abs(A_f[i, j]) / denom\n\ndef build_A1(g, h, d=0.0):\n    \"\"\"\n    Build A1 for the 3-node MVAR(1) model:\n    - x1 -> x3 with strength h: A1[2,0] = h\n    - x3 -> x2 with strength g: A1[1,2] = g\n    - optional direct x1 -> x2 with strength d: A1[1,0] = d\n    \"\"\"\n    A1 = np.zeros((3, 3), dtype=float)\n    A1[2, 0] = h  # x1 -> x3\n    A1[1, 2] = g  # x3 -> x2\n    if d != 0.0:\n        A1[1, 0] = d  # x1 -> x2 direct\n    return A1\n\ndef detect_link(A_list, freqs, i, j, tau):\n    \"\"\"\n    For given A_list and frequencies, detect if there is a link j->i using DTF and PDC:\n    True if measure exceeds tau at any frequency.\n    Returns (dtf_detect, pdc_detect).\n    \"\"\"\n    dtf_vals = []\n    pdc_vals = []\n    for f in freqs:\n        dtf_vals.append(dtf_ij(A_list, f, i, j))\n        pdc_vals.append(pdc_ij(A_list, f, i, j))\n    dtf_detect = np.any(np.array(dtf_vals) > tau)\n    pdc_detect = np.any(np.array(pdc_vals) > tau)\n    return bool(dtf_detect), bool(pdc_detect)\n\ndef solve():\n    # Frequencies in cycles/sample\n    freqs = [0.0, 0.25, 0.5]\n    tau = 1e-8  # detection threshold\n\n    # Test cases:\n    # 1) Indirect only: g=0.4, h=0.5, no direct d\n    A1_case1 = build_A1(g=0.4, h=0.5, d=0.0)\n    # 2) Indirect plus direct: add d=0.3\n    A1_case2 = build_A1(g=0.4, h=0.5, d=0.3)\n    # 3) No path: all zero\n    A1_case3 = build_A1(g=0.0, h=0.0, d=0.0)\n\n    test_cases = [\n        [A1_case1],  # MVAR(1)\n        [A1_case2],\n        [A1_case3],\n    ]\n\n    # We check link 1 -> 2, which corresponds to i=1 (x2), j=0 (x1) in 0-based indexing.\n    i, j = 1, 0\n\n    results = []\n    for A_list in test_cases:\n        dtf_detect, pdc_detect = detect_link(A_list, freqs, i, j, tau)\n        results.append([dtf_detect, pdc_detect])\n\n    # Final print in required format: list of three [DTF_detect, PDC_detect] pairs.\n    print(f\"[{','.join([str(r).replace(' ', '') for r in results])}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}