## 引言
在大脑这样由亿万神经元组成的复杂系统中，理解不同脑区之间如何动态地交换信息是神经科学的核心挑战之一。仅仅知道哪些区域在活动中相关联（即功能连接）是远远不够的；我们更需要揭示信息流动的方向和因果关系，即探索“有效连接”。偏定向相干（PDC）与[有向传递函数](@entry_id:1123799)（DTF）是两种强大的计算工具，它们能够从EEG、MEG或LFP等多通道神经信号中，揭示隐藏在数据背后的频域有向交互网络。然而，这两种方法在理论基础和解释上存在本质区别，如何正确选择、应用和解释它们，是研究人员面临的关键问题。

本文旨在提供一个从理论到实践的全面指南。在第一部分“**原理与机制**”中，我们将从两种方法的共同基础——多元自回归（MVAR）模型讲起，深入剖析PDC和DTF的数学定义、核心区别及其与格兰杰因果的深刻联系。接下来，在“**应用与跨学科交叉**”部分，我们将探讨如何将这些理论应用于真实的神经科学研究，构建一个从[数据预处理](@entry_id:197920)到统计推断的完整分析流程，并展示其如何与网络科学及机器学习等领域交叉融合。最后，通过“**动手实践**”中的一系列编程练习，您将亲手实现并验证这些核心概念，巩固对PDC和DTF的理解。通过学习本文，您将掌握分析大脑有效连接的关键技能，为您的研究打开新的视角。

## 原理与机制

本章旨在深入阐述偏定向相干（Partial Directed Coherence, PDC）与[有向传递函数](@entry_id:1123799)（Directed Transfer Function, DTF）这两种关键的频域有向连接性分析方法的理论基础和核心机制。这些方法广泛应用于从多元时间序列（尤其在神经科学领域）中推断信息流动的方向和强度。我们将从它们的共同基础——多元自回归（MVAR）模型出发，系统地构建这些概念，并阐明它们在量化直接与间接、流出与流入相互作用方面的本质区别。

### 多元自回归（MVAR）模型：时域基础

分析有向连接性的第一步是为观测到的多元[时间序列数据](@entry_id:262935)建立一个[生成模型](@entry_id:177561)。[MVAR模型](@entry_id:1128381)是此框架的基石，它假设一个系统中每个变量的当前值可以由系统所有变量的过去值的[线性组合](@entry_id:154743)来预测。

对于一个$N$维、零均值、宽义平稳的神经时间序列向量$x(t) \in \mathbb{R}^{N}$，其$p$阶[MVAR模型](@entry_id:1128381)表示为：

$$
x(t) = \sum_{k=1}^{p} A_k x(t-k) + e(t)
$$

其中：
- $x(t) = [x_1(t), x_2(t), \dots, x_N(t)]^\top$ 是在时间点$t$的$N$维观测向量。
- $A_k$ 是$N \times N$的**[系数矩阵](@entry_id:151473)**，对应于时间延迟$k$。矩阵中的每一个元素$(A_k)_{ij}$量化了序列$j$在$t-k$时刻的值$x_j(t-k)$对序列$i$在$t$时刻的值$x_i(t)$的线性影响。因此，非对角的$A_k$元素是捕捉不同序列间有向相互作用的关键。
- $e(t) = [e_1(t), e_2(t), \dots, e_N(t)]^\top$ 是模型的**[新息向量](@entry_id:750666)**（innovations）或预测误差。它代表了$x(t)$中不能被模型过去值[线性预测](@entry_id:180569)的部分。

为了确保PDC和DTF等连接性度量的有效性，[MVAR模型](@entry_id:1128381)必须满足特定的统计属性 。新息过程$e(t)$被假定为一个零[均值向量](@entry_id:266544)[白噪声过程](@entry_id:146877)，其关键特性是它在时间上是序列不相关的。这意味着不同时间点的新息是互不相关的，其协方差结构可以表示为：

$$
\mathbb{E}[e(t)e(s)^\top] = \Sigma_{ee}\,\delta_{t-s}
$$

这里，$\delta_{t-s}$是克罗内克函数（当$t=s$时为1，否则为0），而$\Sigma_{ee}$是$N \times N$的**同期协方差矩阵**。$\Sigma_{ee}$是一个[对称正定矩阵](@entry_id:136714)，其对角线元素$(\Sigma_{ee})_{ii}$表示新息分量$e_i(t)$的方差，而非对角[线元](@entry_id:196833)素$(\Sigma_{ee})_{ij}$（当$i \neq j$时）表示不同新息分量$e_i(t)$和$e_j(t)$之间的**同期相关性**。这种同期相关性可能源于未建模的共同输入、极快的作用或信号采集中的体导效应，因此$\Sigma_{ee}$通常不被假定为[对角矩阵](@entry_id:637782)。此外，新息的定义蕴含着它与过程的过去正交，即$\mathbb{E}[e(t)x(s)^\top]=0$对于所有$s  t$成立。

#### 模型的稳定性与[平稳性](@entry_id:143776)

PDC和DTF的有效应用，一个至关重要的前提是所拟合的[MVAR模型](@entry_id:1128381)是**稳定**的。一个稳定的MVAR过程保证了其输出是宽义平稳的，即其均值和[自协方差](@entry_id:270483)不随时间改变。稳定性确保了系统对过去的扰动（新息）的响应会随时间衰减，而不会无限放大。

这一稳定性条件与一个在复平面上定义的多项式矩阵的根的位置密切相关。定义[特征多项式](@entry_id:150909)矩阵为 $\mathbf{A}(z) = I - \sum_{k=1}^{p} A_k z^k$，其中$z \in \mathbb{C}$。[MVAR模型](@entry_id:1128381)是稳定的，当且仅当方程$\det(\mathbf{A}(z)) = 0$的所有复数根$z$都位于[单位圆](@entry_id:267290)之外，即$|z| > 1$ 。从系统理论的角度看，这一条件保证了模型的脉冲响应是绝对可和的，这意味着任何瞬时冲击的影响最终都会消失。这可以通过将[MVAR模型](@entry_id:1128381)写成[状态空间](@entry_id:160914)形式并分析其[伴随矩阵](@entry_id:148203)的谱半径来严格证明。[伴随矩阵](@entry_id:148203)的特征值的倒数恰好是$\det(\mathbf{A}(z))=0$的根，因此要求所有特征值的模长小于1等价于所有根的模长大于1。

### 频域表示：$A(f)$与$H(f)$

为了在特定频率上分析连接性，我们需要将时域[MVAR模型](@entry_id:1128381)转换到频域。通过对MVAR方程进行傅里叶变换，我们得到：

$$
A(f)X(f) = E(f)
$$

这里，$X(f)$和$E(f)$分别是过程$x(t)$和新息$e(t)$的傅里叶变换，而$A(f)$是**频域自回归矩阵**，定义为：

$$
A(f) = I - \sum_{k=1}^{p} A_k \exp(-i 2\pi f k)
$$

其中$i$是虚数单位，$f$是频率。矩阵$A(f)$的元素$A_{ij}(f)$（对于$i \neq j$）整合了所有时间延迟上从通道$j$到通道$i$的直接线性影响。因此，$A(f)$是推断**直接**因果作用的自然起点。

通过对$A(f)$求逆，我们得到**[传递函数矩阵](@entry_id:271746)**$H(f)$：

$$
H(f) = A(f)^{-1}
$$

这使得我们可以将系统输出$X(f)$表示为系统输入$E(f)$的函数：

$$
X(f) = H(f)E(f)
$$

[传递函数矩阵](@entry_id:271746)的元素$H_{ij}(f)$描述了在频率$f$上，来自通道$j$的新息（输入）对通道$i$的信号（输出）的**总**影响。这个总影响包括了从$j$到$i$的所有可能路径——无论是直接连接还是通过网络中其他节点的中介作用。

### 偏定向相干（PDC）：量化直接流出

PDC旨在量化从一个源节点$j$到目标节点$i$的**直接**因果流。它建立在$A(f)$矩阵之上，因为该矩阵的非对角元素直接反映了[MVAR模型](@entry_id:1128381)系数所编码的直接连接。

PDC的定义（在此我们使用其平方形式以表示能量）为  ：

$$
|\pi_{ij}(f)|^2 = \frac{|A_{ij}(f)|^2}{\sum_{\ell=1}^{N} |A_{\ell j}(f)|^2}
$$

让我们剖析这个公式：
- **分子** $|A_{ij}(f)|^2$：代表了在频率$f$上，从$j$到$i$的直接连接强度。根据定义，如果[MVAR模型](@entry_id:1128381)中不存在从$j$到$i$的直接连接（即所有$A_k$矩阵的$(i,j)$元素都为零），那么$A_{ij}(f)$将恒等于零，从而$|\pi_{ij}(f)|^2$也恒等于零。这凸显了PDC对直接路径的专一性 。
- **分母** $\sum_{\ell=1}^{N} |A_{\ell j}(f)|^2$：这是$A(f)$矩阵第$j$列的元素模平方和，即该列向量的[欧几里得范数](@entry_id:172687)的平方。这一项代表了在频率$f$上，从源节点$j$流向网络中所有节点（包括其自身）的**总直接流出（total direct outflow）**。

因此，PDC的本质是**源端归一化（source-normalized）**。它衡量的是在频率$f$上，从$j$到$i$的直接影响在$j$的总直接流出中所占的比例 。PDC的值对接收节点$i$接收到的其他输入不敏感，它只关注源节点$j$如何分配其影响力。

### [有向传递函数](@entry_id:1123799)（DTF）：量化总流入

与PDC不同，DTF旨在量化从源$j$到目标$i$的**总**因果影响，包括所有直接和间接路径。它基于[传递函数矩阵](@entry_id:271746)$H(f)$，因为它捕捉了完整的[系统响应](@entry_id:264152)。

DTF的定义（同样使用平方形式）为  ：

$$
|\gamma_{ij}(f)|^2 = \frac{|H_{ij}(f)|^2}{\sum_{k=1}^{N} |H_{ik}(f)|^2}
$$
（注：这里我们假设新息是单位方差且不相关的，即$\Sigma_{ee}=I$，以便于解释。稍后将讨论一般情况。）

该公式的解读如下：
- **分子** $|H_{ij}(f)|^2$：代表了源于节点$j$的新息对节点$i$[信号功率](@entry_id:273924)的贡献。由于$H(f)$是$A(f)$的逆，即使直接连接$A_{ij}(f)=0$，只要存在如$j \to k \to i$这样的间接路径，$H_{ij}(f)$通常也不为零。因此，DTF能够捕捉到间接连接的影响 。
- **分母** $\sum_{k=1}^{N} |H_{ik}(f)|^2$：这是$H(f)$矩阵第$i$行的元素模[平方和](@entry_id:161049)。在$\Sigma_{ee}=I$的假设下，这一项等于节点$i$的功率谱$S_{ii}(f)$。它代表了在频率$f$上，由网络中所有源节点的新息共同贡献给节点$i$的**总流入（total inflow）**。

DTF的本质是**目标端归一化（target-normalized）**。它衡量的是在频率$f$上，源于节点$j$的影响在节点$i$接收到的总影响中所占的比例 。一个重要的数学特性是，对于给定的目标节点$i$和频率$f$，所有源的DTF平方和为1，即$\sum_{j=1}^{N} |\gamma_{ij}(f)|^2 = 1$ 。这意味着DTF将目标节点的总输入功率“分配”给了网络中的所有源。

### PDC与DTF的核心区别与实践意义

PDC和DTF通过其不同的定义和归一化方案，提供了关于网络动力学的互补视角。

- **直接 vs. 间接影响**：PDC是“局部”的，仅反映由MVAR系数直接编码的连接。它对间接路径不敏感。相反，DTF是“全局”的，它通过[矩阵求逆](@entry_id:636005)隐式地整合了网络中所有长度的路径，因此能反映间接影响 。
- **流出 vs. 流入视角**：PDC从源节点的角度出发，回答“$j$的直接影响力是如何分配的？”。DTF从目标节点的角度出发，回答“$i$接收到的影响来自何方？”。
- **对节点自身动力学的敏感性**：由于DTF按目标节点的总输入进行归一化，如果目标节点$i$在某个频率$f$上具有非常强的自身振荡（即$|H_{ii}(f)|$很大），这会增大归一化分母，从而可能压低从其他节点$j$到$i$的DT[F值](@entry_id:178445)，即使物理连接很强。PDC则不受目标节点自身动力学的影响，因为它在源端进行归一化 。

### 与其他连接性度量的关系

为了更好地理解PDC和DTF，将它们与频域中其他连接性度量进行对比是有益的。

- **无向度量：相干与偏相干**
传统的**相干**（Coherence）$C_{ij}(f) = \frac{|S_{ij}(f)|^2}{S_{ii}(f)S_{jj}(f)}$，以及**偏相干**（Partial Coherence）$PC_{ij}(f) = \frac{|K_{ij}(f)|^2}{K_{ii}(f)K_{jj}(f)}$（其中$K(f)=S(f)^{-1}$是逆谱矩阵），都是**无向**的度量。它们的定义在交换索引$i$和$j$时保持不变，即$C_{ij}(f)=C_{ji}(f)$和$PC_{ij}(f)=PC_{ji}(f)$。它们量化的是[线性关联](@entry_id:912650)的强度，而不是信息流动的方向 。PDC和DTF的非对称性（通常$|\pi_{ij}| \neq |\pi_{ji}|$）是它们作为有向连接性度量的根本特征。

- **与谱格兰杰因果（Spectral Granger Causality）的关系**
PDC和DTF可以被看作是维纳-[格兰杰因果关系](@entry_id:137286)概念在频域的[MVAR模型](@entry_id:1128381)框架下的实现。特别是，一个被称为**有向相干**（Directed Coherence, DC）的度量，其定义与DTF密切相关，在特定的双变量、不相关新息和[最小相位](@entry_id:273619)条件下，它与Geweke提出的谱格兰杰因果（GC）存在一个单调关系：$F_{j \to i}(f) = -\ln(1 - |\text{DC}_{ij}(f)|^2)$ 。这揭示了这些MVAR度量与格兰杰因果原始思想之间的深刻联系。PDC则通过其对直接路径的分离，提供了对格兰杰因果的另一种分解。

### 推广：处理相关新息

标准的PDC和DTF公式在解释上依赖于新息分量不相关的假设。然而在实际数据中，由于未观测到的共同输入或体导效应，新息[协方差矩阵](@entry_id:139155)$\Sigma_{ee}$往往不是对角的。这种同期相关性会混淆因果推断。为了解决这个问题，发展了**广义PDC（gPDC）**和**广义DTF（gDTF）**。

其核心思想是对系统方程进行“白化”变换，以消除新息的相关性。以gPDC为例，我们首先通过左乘$\Sigma_{ee}$的逆平方根来变换MVAR频域方程 ：

$$
\Sigma_{ee}^{-1/2} A(f) X(f) = \Sigma_{ee}^{-1/2} E(f)
$$

令$\bar{A}(f) = \Sigma_{ee}^{-1/2}A(f)$，而新的[新息向量](@entry_id:750666)$W(f) = \Sigma_{ee}^{-1/2}E(f)$的协方差为[单位矩阵](@entry_id:156724)。然后，将标准的PDC公式应用于变换后的矩阵$\bar{A}(f)$：

$$
|\pi^{g}_{ij}(f)|^2 = \frac{|\bar{A}_{ij}(f)|^2}{\sum_{\ell=1}^{N} |\bar{A}_{\ell j}(f)|^2}
$$

通过这种方式，gPDC在计算有向影响之前，首先移除了同期相关的混淆效应，从而提供了更为可靠的直接连接性估计。类似地，gDTF也通过对传递函数进行相应的变换来考虑相关新息 。这些推广对于在复杂的生物系统中进行严谨的因果推断至关重要。