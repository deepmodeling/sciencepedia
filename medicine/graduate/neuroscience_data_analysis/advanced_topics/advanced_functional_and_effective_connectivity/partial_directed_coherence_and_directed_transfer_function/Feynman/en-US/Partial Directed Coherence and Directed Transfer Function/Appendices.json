{
    "hands_on_practices": [
        {
            "introduction": "To truly grasp how Partial Directed Coherence (PDC) operates, it is essential to move from its definition to direct computation. This first exercise provides a foundational, by-hand calculation for a simple three-node MVAR(1) model. By computing the PDC values from the model's coefficient matrix, you will build a concrete intuition for how this measure directly reflects the strength of specified causal links in the underlying system .",
            "id": "4184284",
            "problem": "Consider a stationary three-node multivariate autoregressive process of order one (AR(1)) for neural time series, written as $x(t)=A_{1}\\,x(t-1)+w(t)$, where $x(t)\\in\\mathbb{R}^{3}$, $A_{1}\\in\\mathbb{R}^{3\\times 3}$, and $w(t)$ is a zero-mean white innovation process with finite covariance. Let\n$$\nA_{1}=\\begin{bmatrix}\n0.5 & 0 & 0\\\\\n0.3 & 0.4 & 0\\\\\n0 & 0.2 & 0.6\n\\end{bmatrix}.\n$$\nUsing the standard frequency-domain construction of the autoregressive operator and the definition of Partial Directed Coherence (PDC) from node $j$ to node $i$, compute the PDC values $\\pi_{21}(f)$ and $\\pi_{31}(f)$ at frequency $f=0$ (frequency in cycles per sample). Based on these values, explain which directed influence from node $1$ is stronger at $f=0$ and why, in terms of the model structure.\n\nFor grading, report the single scalar quantity given by the squared magnitude of $\\pi_{21}(0)$, that is $|\\pi_{21}(0)|^{2}$. Round your answer to four significant figures. The reported value is unitless and must be provided as a pure number.",
            "solution": "The problem is valid as it is scientifically grounded in the theory of multivariate time series analysis, well-posed with all necessary information provided, and objective in its formulation. The stationarity condition for the given AR(1) process is met, as the eigenvalues of the matrix $A_1$, which are its diagonal entries ($0.5$, $0.4$, and $0.6$), all have magnitudes less than $1$.\n\nThe multivariate autoregressive (MVAR) process of order $p=1$ is given by:\n$$\nx(t) = A_1 x(t-1) + w(t)\n$$\nwhere $x(t) \\in \\mathbb{R}^3$ is the vector of time series values at time $t$, $A_1 \\in \\mathbb{R}^{3\\times 3}$ is the coefficient matrix, and $w(t)$ is a white noise vector process.\n\nTo analyze the process in the frequency domain, we perform a Fourier transform. This leads to the frequency-domain representation:\n$$\n\\bar{A}(f) X(f) = W(f)\n$$\nwhere $\\bar{A}(f)$ is the autoregressive operator in the frequency domain, defined as:\n$$\n\\bar{A}(f) = I - A_1 \\exp(-i 2 \\pi f)\n$$\nHere, $I$ is the $3 \\times 3$ identity matrix, $f$ is the frequency in cycles per sample, and $i = \\sqrt{-1}$.\n\nThe problem requires evaluation at frequency $f=0$. At this frequency, the exponential term becomes $\\exp(0) = 1$. The operator simplifies to:\n$$\n\\bar{A}(0) = I - A_1\n$$\nUsing the given matrix $A_1$:\n$$\nA_1 = \\begin{bmatrix}\n0.5 & 0 & 0 \\\\\n0.3 & 0.4 & 0 \\\\\n0 & 0.2 & 0.6\n\\end{bmatrix}\n$$\nwe compute $\\bar{A}(0)$:\n$$\n\\bar{A}(0) = \\begin{bmatrix}\n1 & 0 & 0 \\\\\n0 & 1 & 0 \\\\\n0 & 0 & 1\n\\end{bmatrix} - \\begin{bmatrix}\n0.5 & 0 & 0 \\\\\n0.3 & 0.4 & 0 \\\\\n0 & 0.2 & 0.6\n\\end{bmatrix} = \\begin{bmatrix}\n1-0.5 & -0 & -0 \\\\\n-0.3 & 1-0.4 & -0 \\\\\n-0 & -0.2 & 1-0.6\n\\end{bmatrix} = \\begin{bmatrix}\n0.5 & 0 & 0 \\\\\n-0.3 & 0.6 & 0 \\\\\n0 & -0.2 & 0.4\n\\end{bmatrix}\n$$\nPartial Directed Coherence (PDC) from node $j$ to node $i$ at frequency $f$, denoted $\\pi_{ij}(f)$, is defined using the elements of the $\\bar{A}(f)$ matrix. Its standard definition is:\n$$\n\\pi_{ij}(f) = \\frac{\\bar{A}_{ij}(f)}{\\sqrt{\\sum_{k=1}^{3} |\\bar{A}_{kj}(f)|^2}}\n$$\nwhere $\\bar{A}_{ij}(f)$ is the element in the $i$-th row and $j$-th column of $\\bar{A}(f)$. The denominator is the Euclidean norm of the $j$-th column of the matrix $\\bar{A}(f)$. This metric is normalized and quantifies the direct influence from $j$ to $i$ relative to the total influence of $j$ on all other nodes.\n\nWe need to compute $\\pi_{21}(0)$ and $\\pi_{31}(0)$, representing the influence from node $1$ to node $2$ and from node $1$ to node $3$, respectively, at frequency $f=0$. Both calculations use the first column ($j=1$) of the $\\bar{A}(0)$ matrix.\n\nThe first column of $\\bar{A}(0)$ is $\\begin{pmatrix} 0.5 \\\\ -0.3 \\\\ 0 \\end{pmatrix}$. The elements are $\\bar{A}_{11}(0)=0.5$, $\\bar{A}_{21}(0)=-0.3$, and $\\bar{A}_{31}(0)=0$.\nFirst, we calculate the denominator term for $j=1$:\n$$\n\\sqrt{\\sum_{k=1}^{3} |\\bar{A}_{k1}(0)|^2} = \\sqrt{|\\bar{A}_{11}(0)|^2 + |\\bar{A}_{21}(0)|^2 + |\\bar{A}_{31}(0)|^2} = \\sqrt{|0.5|^2 + |-0.3|^2 + |0|^2} = \\sqrt{0.25 + 0.09 + 0} = \\sqrt{0.34}\n$$\nNow, we compute $\\pi_{21}(0)$:\n$$\n\\pi_{21}(0) = \\frac{\\bar{A}_{21}(0)}{\\sqrt{0.34}} = \\frac{-0.3}{\\sqrt{0.34}}\n$$\nNext, we compute $\\pi_{31}(0)$:\n$$\n\\pi_{31}(0) = \\frac{\\bar{A}_{31}(0)}{\\sqrt{0.34}} = \\frac{0}{\\sqrt{0.34}} = 0\n$$\nTo compare the strengths of the influences, we examine their squared magnitudes, $|\\pi_{ij}(0)|^2$:\n$$\n|\\pi_{21}(0)|^2 = \\left| \\frac{-0.3}{\\sqrt{0.34}} \\right|^2 = \\frac{0.09}{0.34} \\approx 0.2647\n$$\n$$\n|\\pi_{31}(0)|^2 = |0|^2 = 0\n$$\nSince $|\\pi_{21}(0)|^2 > |\\pi_{31}(0)|^2$, the directed influence from node $1$ to node $2$ is stronger than from node $1$ to node $3$ at $f=0$.\n\nThis result can be explained directly from the model structure. In an AR model, the coefficient $(A_p)_{ij}$ quantifies the direct linear influence of $x_j(t-p)$ on $x_i(t)$. In our AR(1) model, the coefficient $(A_1)_{ij}$ represents the influence of $x_j(t-1)$ on $x_i(t)$.\nFrom the given matrix $A_1$:\n- The influence $1 \\to 2$ is determined by $(A_1)_{21} = 0.3$.\n- The influence $1 \\to 3$ is determined by $(A_1)_{31} = 0$.\nA non-zero coefficient $(A_1)_{21}$ implies a direct causal link from node $1$ to node $2$, which results in a non-zero PDC value. Conversely, the zero coefficient $(A_1)_{31}$ signifies the absence of a direct causal link from node $1$ to node $3$, leading to a PDC value of zero for all frequencies. The PDC analysis thus correctly identifies the presence of the $1 \\to 2$ connection and the absence of the $1 \\to 3$ connection specified in the model's coefficient matrix.\n\nThe problem asks for the scalar quantity $|\\pi_{21}(0)|^2$, rounded to four significant figures.\n$$\n|\\pi_{21}(0)|^2 = \\frac{0.09}{0.34} = \\frac{9}{34} \\approx 0.26470588...\n$$\nRounding to four significant figures yields $0.2647$.",
            "answer": "$$\n\\boxed{0.2647}\n$$"
        },
        {
            "introduction": "A central theme in connectivity analysis is the distinction between direct and indirect influence. This practical coding exercise is designed to illuminate the fundamental difference between PDC and the Directed Transfer Function (DTF) in this regard. You will construct a network with a known indirect pathway ($1 \\to 3 \\to 2$) and implement both measures from first principles to demonstrate that DTF captures the total influence, while PDC correctly identifies the absence of a direct $1 \\to 2$ link, thus clarifying their relationship to unconditional and conditional Granger causality, respectively .",
            "id": "4184294",
            "problem": "Consider a three-dimensional, discrete-time, stationary, linear Multivariate Autoregressive (MVAR) process of order $p$ with whitened innovations, written as $X(t) = \\sum_{k=1}^{p} A_k X(t-k) + \\varepsilon(t)$, where $X(t) \\in \\mathbb{R}^3$, $\\varepsilon(t)$ is zero-mean white noise with identity covariance, and the coefficient matrices $\\{A_k\\}$ yield a stable system. In the context of neuroscience data analysis, this model is commonly used to study spectral causality measures such as Directed Transfer Function (DTF) and Partial Directed Coherence (PDC), which are frequency-domain tools used to assess directed influence among nodes. Directed Transfer Function (DTF) and Partial Directed Coherence (PDC) must be implemented using their canonical definitions derived from the MVAR spectral representation without relying on any shortcut formulas provided in this problem statement.\n\nYour task is to construct and analyze a three-node example where the influence from $x_1$ to $x_2$ occurs only via $x_3$, and to show that Directed Transfer Function (DTF) indicates a $1 \\to 2$ influence whereas Partial Directed Coherence (PDC) does not, and to relate this to conditional versus unconditional Granger causality (GC) behavior.\n\nUse an MVAR($1$) model, with coefficient matrix $A_1$ defined as follows for the base case:\n$$\nA_1 =\n\\begin{bmatrix}\n0 & 0 & 0 \\\\\n0 & 0 & g \\\\\nh & 0 & 0\n\\end{bmatrix},\n$$\nwith $g = 0.4$ and $h = 0.5$, which encodes $x_1 \\to x_3$ with strength $h$ and $x_3 \\to x_2$ with strength $g$, and no direct $x_1 \\to x_2$ term. The system has whitened innovations and is stable. Consider the frequency domain on the unit circle with $z = e^{i 2 \\pi f}$, where $f$ is the frequency in cycles per sample.\n\nImplement both Partial Directed Coherence (PDC) and Directed Transfer Function (DTF) from first principles, starting from the MVAR spectral representation. For each measure, determine whether there is a directed influence $1 \\to 2$ according to the following detection rule: at a given frequency $f$, the measure indicates a link $1 \\to 2$ if its magnitude for $2 \\leftarrow 1$ exceeds a detection threshold $\\tau = 10^{-8}$; for a model, declare that a measure indicates $1 \\to 2$ if this occurs at any tested frequency.\n\nUse the following test suite of three parameter settings and three frequency points:\n- Frequencies to evaluate: $f \\in \\{0.0, 0.25, 0.5\\}$ cycles per sample.\n- Test Case 1 (indirect only): $A_1$ as above with $g = 0.4$, $h = 0.5$, and no direct $x_1 \\to x_2$.\n- Test Case 2 (indirect plus direct): same as Test Case 1, but add a direct connection $x_1 \\to x_2$ with coefficient $d = 0.3$, i.e., set the $(2,1)$ entry of $A_1$ to $d$.\n- Test Case 3 (no path): set $g = 0$, $h = 0$, and $d = 0$, i.e., $A_1$ is the zero matrix, so there is no $x_1 \\to x_2$ influence either directly or indirectly.\n\nFor each test case, compute the boolean detection pair `[DTF detects, PDC detects]` according to the above rule across the specified frequencies.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the following aggregated format: a list of three lists, one per test case, where each inner list contains two booleans in the order `[DTF detects, PDC detects]`. For example, the output should look like `[[True, False], [True, True], [False, False]]`.",
            "solution": "We start from the Multivariate Autoregressive (MVAR) spectral representation for a stable MVAR($p$) process with whitened innovations. Let the autoregressive polynomial be defined as\n$$\nA(f) = I - \\sum_{k=1}^{p} A_k e^{-i 2 \\pi f k},\n$$\nwhere $I$ is the identity matrix and $f$ is frequency in cycles per sample. The transfer matrix is\n$$\nH(f) = A(f)^{-1}.\n$$\nDirected Transfer Function (DTF) and Partial Directed Coherence (PDC) are frequency-domain measures defined in terms of $H(f)$ and $A(f)$, respectively. For Directed Transfer Function (DTF), we use row-wise normalization of the transfer matrix:\n$$\n\\text{DTF}_{i \\leftarrow j}(f) = \\frac{\\left|H_{ij}(f)\\right|}{\\sqrt{\\sum_{k=1}^{N} \\left|H_{ik}(f)\\right|^2}},\n$$\nwhich quantifies the fraction of the signal power arriving at node $i$ from node $j$ at frequency $f$ relative to all incoming sources to node $i$. For Partial Directed Coherence (PDC), we use column-wise normalization of the autoregressive polynomial:\n$$\n\\text{PDC}_{i \\leftarrow j}(f) = \\frac{\\left|A_{ij}(f)\\right|}{\\sqrt{\\sum_{k=1}^{N} \\left|A_{kj}(f)\\right|^2}}.\n$$\nPartial Directed Coherence (PDC) reflects conditional Granger causality (GC), focusing on direct edges after conditioning on the remaining variables (it normalizes across what flows out of $x_j$ in the autoregressive representation). Directed Transfer Function (DTF), in contrast, reflects unconditional Granger causality in the sense that it captures any pathway through which $x_j$ can influence $x_i$ in the transfer function, including indirect paths, because $H(f)$ contains the accumulated effect of all lags and paths.\n\nNow consider the specified three-node MVAR($1$) model. For the base case, the coefficient matrix is\n$$\nA_1 =\n\\begin{bmatrix}\n0 & 0 & 0 \\\\\n0 & 0 & g \\\\\nh & 0 & 0\n\\end{bmatrix},\n\\quad g = 0.4,\\ h = 0.5.\n$$\nThe autoregressive polynomial for order $p=1$ is\n$$\nA(f) = I - A_1 e^{-i 2 \\pi f}.\n$$\nNote that the $(2,1)$ entry of $A_1$ is zero in the base case, so\n$$\nA_{21}(f) = 0 \\quad \\text{for all } f,\n$$\nand therefore\n$$\n\\text{PDC}_{2 \\leftarrow 1}(f) = 0 \\quad \\text{for all } f,\n$$\nsince the numerator is zero while the denominator is finite due to the nonzero diagonal term in $A(f)$.\n\nTo analyze Directed Transfer Function (DTF), we examine the transfer matrix\n$$\nH(f) = A(f)^{-1}.\n$$\nDefine $B(f) = A_1 e^{-i 2 \\pi f}$; then $A(f) = I - B(f)$. For a stable system with small operator norm of $B(f)$, we can write the Neumann expansion\n$$\nH(f) = (I - B(f))^{-1} = I + B(f) + B(f)^2 + B(f)^3 + \\cdots.\n$$\nIn the present case, the matrix $A_1$ is strictly off-diagonal and nilpotent of index $3$ due to the $x_1 \\to x_3$ and $x_3 \\to x_2$ chain; specifically, $A_1^3 = 0$. Consequently,\n$$\nH(f) = I + B(f) + B(f)^2,\n$$\nwith higher powers zero. The $(2,1)$ entry of $H(f)$ is contributed only by the second power term,\n$$\nH_{21}(f) = \\left[B(f)^2\\right]_{21}.\n$$\nBecause $B(f) = A_1 e^{-i 2 \\pi f}$ and matrix multiplication yields\n$$\n\\left[A_1^2\\right]_{21} = \\left[A_1\\right]_{23} \\left[A_1\\right]_{31} = g h,\n$$\nwe obtain\n$$\nH_{21}(f) = e^{-i 4 \\pi f} \\, g h,\n$$\nwhich has nonzero magnitude for all $f$. Therefore,\n$$\n\\text{DTF}_{2 \\leftarrow 1}(f) = \\frac{|g h|}{\\sqrt{|H_{21}(f)|^2 + |H_{22}(f)|^2 + |H_{23}(f)|^2}} = \\frac{|g h|}{\\sqrt{(g h)^2 + 1^2 + g^2}},\n$$\nsince $H_{22}(f) = 1$ (from $I$) and $H_{23}(f) = e^{-i 2 \\pi f} g$ (from $B(f)$). Hence, Directed Transfer Function (DTF) indicates a nonzero $1 \\to 2$ influence, while Partial Directed Coherence (PDC) does not, precisely capturing the distinction between unconditional Granger causality (DTF attracting indirect paths) and conditional Granger causality (PDC isolating direct edges).\n\nFor Test Case 2, include a direct connection $x_1 \\to x_2$ by setting $A_{21} = d$ with $d = 0.3$. Then\n$$\nA_{21}(f) = -d e^{-i 2 \\pi f} \\neq 0,\n$$\nso Partial Directed Coherence (PDC) detects the $1 \\to 2$ edge (the numerator is nonzero), and Directed Transfer Function (DTF) also detects it since $H_{21}(f)$ remains nonzero. For Test Case 3, set $g = h = d = 0$, so $A_1 = 0$, $A(f) = I$, and $H(f) = I$. Then both $\\text{DTF}_{2 \\leftarrow 1}(f)$ and $\\text{PDC}_{2 \\leftarrow 1}(f)$ are zero for all $f$.\n\nAlgorithmic steps for the program:\n1. For each test case, construct $A_1$.\n2. For each frequency $f \\in \\{0.0, 0.25, 0.5\\}$, compute $A(f) = I - A_1 e^{-i 2 \\pi f}$ and $H(f) = A(f)^{-1}$.\n3. Compute $\\text{DTF}_{2 \\leftarrow 1}(f)$ via row-wise normalization of $H(f)$ for row $i=2$ and column $j=1$.\n4. Compute $\\text{PDC}_{2 \\leftarrow 1}(f)$ via column-wise normalization of $A(f)$ for column $j=1$ and row $i=2$.\n5. Apply the detection rule with threshold $\\tau = 10^{-8}$: a measure indicates $1 \\to 2$ if its magnitude exceeds $\\tau$ for any frequency.\n6. Aggregate the booleans per test case into the specified single-line output format.\n\nExpected qualitative outcomes:\n- Test Case 1: $\\big[\\text{True}, \\text{False}\\big]$ because $\\text{DTF}_{2 \\leftarrow 1}(f) > 0$ for all $f$ due to the indirect path via $x_3$, while $\\text{PDC}_{2 \\leftarrow 1}(f) = 0$ since there is no direct $x_1 \\to x_2$ coefficient.\n- Test Case 2: $\\big[\\text{True}, \\text{True}\\big]$ because both measures detect the direct edge and the indirect path.\n- Test Case 3: $\\big[\\text{False}, \\text{False}\\big]$ because there is no path from $x_1$ to $x_2$.\n\nThis behavior directly illustrates the relationship to Granger causality: Directed Transfer Function (DTF) reflects unconditional Granger causality by aggregating all pathways encoded in the transfer matrix, while Partial Directed Coherence (PDC) reflects conditional Granger causality by isolating direct dependencies in the autoregressive polynomial after conditioning on all other nodes.",
            "answer": "```python\nimport numpy as np\n\ndef compute_A_f(A_list, f):\n    \"\"\"\n    Compute A(f) = I - sum_k A_k * exp(-i 2 pi f k)\n    for a given list of A_k (k=1..p) and frequency f in cycles/sample.\n    \"\"\"\n    n = A_list[0].shape[0]\n    A_f = np.eye(n, dtype=complex)\n    for k, A_k in enumerate(A_list, start=1):\n        A_f = A_f - A_k * np.exp(-1j * 2 * np.pi * f * k)\n    return A_f\n\ndef dtf_ij(A_list, f, i, j):\n    \"\"\"\n    Compute row-normalized DTF_{i<-j}(f) = |H_ij(f)| / sqrt(sum_k |H_ik(f)|^2)\n    where H(f) = A(f)^{-1}.\n    \"\"\"\n    A_f = compute_A_f(A_list, f)\n    H_f = np.linalg.inv(A_f)\n    row_i = H_f[i, :]\n    denom = np.sqrt(np.sum(np.abs(row_i)**2))\n    if denom == 0:\n        return 0.0\n    return np.abs(H_f[i, j]) / denom\n\ndef pdc_ij(A_list, f, i, j):\n    \"\"\"\n    Compute column-normalized PDC_{i<-j}(f) = |A_ij(f)| / sqrt(sum_k |A_kj(f)|^2)\n    where A(f) = I - sum_k A_k * exp(-i 2 pi f k).\n    \"\"\"\n    A_f = compute_A_f(A_list, f)\n    col_j = A_f[:, j]\n    denom = np.sqrt(np.sum(np.abs(col_j)**2))\n    if denom == 0:\n        return 0.0\n    return np.abs(A_f[i, j]) / denom\n\ndef build_A1(g, h, d=0.0):\n    \"\"\"\n    Build A1 for the 3-node MVAR(1) model:\n    - x1 -> x3 with strength h: A1[2,0] = h\n    - x3 -> x2 with strength g: A1[1,2] = g\n    - optional direct x1 -> x2 with strength d: A1[1,0] = d\n    \"\"\"\n    A1 = np.zeros((3, 3), dtype=float)\n    A1[2, 0] = h  # x1 -> x3\n    A1[1, 2] = g  # x3 -> x2\n    if d != 0.0:\n        A1[1, 0] = d  # x1 -> x2 direct\n    return A1\n\ndef detect_link(A_list, freqs, i, j, tau):\n    \"\"\"\n    For given A_list and frequencies, detect if there is a link j->i using DTF and PDC:\n    True if measure exceeds tau at any frequency.\n    Returns (dtf_detect, pdc_detect).\n    \"\"\"\n    dtf_vals = []\n    pdc_vals = []\n    for f in freqs:\n        dtf_vals.append(dtf_ij(A_list, f, i, j))\n        pdc_vals.append(pdc_ij(A_list, f, i, j))\n    dtf_detect = np.any(np.array(dtf_vals) > tau)\n    pdc_detect = np.any(np.array(pdc_vals) > tau)\n    return bool(dtf_detect), bool(pdc_detect)\n\ndef solve():\n    # Frequencies in cycles/sample\n    freqs = [0.0, 0.25, 0.5]\n    tau = 1e-8  # detection threshold\n\n    # Test cases:\n    # 1) Indirect only: g=0.4, h=0.5, no direct d\n    A1_case1 = build_A1(g=0.4, h=0.5, d=0.0)\n    # 2) Indirect plus direct: add d=0.3\n    A1_case2 = build_A1(g=0.4, h=0.5, d=0.3)\n    # 3) No path: all zero\n    A1_case3 = build_A1(g=0.0, h=0.0, d=0.0)\n\n    test_cases = [\n        [A1_case1],  # MVAR(1)\n        [A1_case2],\n        [A1_case3],\n    ]\n\n    # We check link 1 -> 2, which corresponds to i=1 (x2), j=0 (x1) in 0-based indexing.\n    i, j = 1, 0\n\n    results = []\n    for A_list in test_cases:\n        dtf_detect, pdc_detect = detect_link(A_list, freqs, i, j, tau)\n        results.append([dtf_detect, pdc_detect])\n\n    # Final print in required format: list of three [DTF_detect, PDC_detect] pairs.\n    print(f\"[{','.join([str(r).replace(' ', '') for r in results])}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "This final practice serves as a capstone exercise, applying the principles of PDC and DTF to a more complex and realistic network inference problem. You will work with a four-node, second-order MVAR model that includes specific oscillatory dynamics, a common feature in real neural data. Your task is to compute both connectivity measures, use them to rank potential network edges, and quantitatively assess their performance in recovering the known ground-truth structure, mimicking a typical validation pipeline in computational neuroscience .",
            "id": "4184234",
            "problem": "You are given a discrete-time multivariate autoregressive model of order $p=2$ with $4$ nodes. The model is specified by the matrices $A_1$ and $A_2$ for the lag-$1$ and lag-$2$ coefficients, respectively, in the equation $X(n) = A_1 X(n-1) + A_2 X(n-2) + E(n)$, where $E(n)$ is an innovation vector. The sampling frequency is $f_s = 100$ Hz, angles in all complex exponentials are to be treated in radians, and the $4 \\times 4$ coefficient matrices are given as:\n$$\nA_1 = \\begin{bmatrix}\n1.53713 & 0.13 & 0 & 0 \\\\\n0.22 & 1.53713 & 0 & 0 \\\\\n0 & 0.17 & 0.55623 & 0 \\\\\n0 & 0 & 0.25 & 0.55623\n\\end{bmatrix},\\quad\nA_2 = \\begin{bmatrix}\n-0.9025 & 0 & 0 & 0 \\\\\n0 & -0.9025 & 0 & 0 \\\\\n0 & 0 & -0.81 & 0 \\\\\n0 & 0 & 0 & -0.81\n\\end{bmatrix}.\n$$\nThe directed edges intentionally encoded in this network are the $4$ directed connections: $1 \\to 2$, $2 \\to 1$, $2 \\to 3$, and $3 \\to 4$. The diagonal coefficients implement oscillatory autoregressive dynamics near $10$ Hz for nodes $1$ and $2$, and near $20$ Hz for nodes $3$ and $4$. Off-diagonal entries in $A_1$ encode directionality among nodes.\n\nYour task is to compute, from first principles consistent with the multivariate autoregressive definition, both the Partial Directed Coherence (PDC) and the Directed Transfer Function (DTF) for this $4$-node network across frequency. Use a uniform frequency grid from $0$ Hz to $50$ Hz with step $0.5$ Hz, and define two oscillatory bands: a $10$ Hz band $[9,11]$ Hz and a $20$ Hz band $[19,21]$ Hz. For each directed pair $(j \\to i)$ with $i \\ne j$, compute an edge score for PDC and for DTF as the maximum magnitude of the respective measure across the union of these two bands.\n\nDefine a decision rule that selects the top-$K$ directed edges by descending edge score for each measure (PDC and DTF) separately. Compare the selected sets against the known ground-truth set $\\{1 \\to 2, 2 \\to 1, 2 \\to 3, 3 \\to 4\\}$, and report the F1-score for PDC and for DTF, where F1-score is defined as the harmonic mean of precision and recall with precision equal to the fraction of selected edges that are truly present and recall equal to the fraction of true edges that are selected. All F1-scores must be reported as floats.\n\nImplement your computations in a complete, runnable program. The program must use the $A_1$ and $A_2$ matrices provided above and proceed from fundamental definitions and operations (discrete-time Fourier analysis, complex matrix inversion, and normalization appropriate for PDC and DTF), without relying on any pre-specified closed-form shortcut formulas in the problem statement. Angles must be treated in radians.\n\nTest Suite:\n- Case $1$: $K = 4$ (happy path; matches the number of true edges).\n- Case $2$: $K = 3$ (boundary condition; fewer selected edges than true edges).\n- Case $3$: $K = 6$ (edge case; more selected edges than true edges).\n\nFinal Output Specification:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\"). The list must contain the six F1-scores in the order: $[\\text{F1-PDC-case1}, \\text{F1-DTF-case1}, \\text{F1-PDC-case2}, \\text{F1-DTF-case2}, \\text{F1-PDC-case3}, \\text{F1-DTF-case3}]$. No other text should be printed.",
            "solution": "The user provides a multivariate autoregressive (MVAR) model of order $p=2$ for a $4$-node network and asks for the computation and evaluation of two directed connectivity measures: Partial Directed Coherence (PDC) and Directed Transfer Function (DTF).\n\nThe solution proceeds in four main steps:\n1.  Transform the MVAR model from the time domain to the frequency domain.\n2.  Define and compute the PDC and DTF measures across a specified frequency range based on the frequency-domain representation of the MVAR coefficients.\n3.  Calculate an edge score for each possible directed connection by taking the maximum of the connectivity measure over a predefined frequency band of interest.\n4.  For different values of a threshold parameter $K$, select the top-$K$ connections, compare them to the ground-truth network structure, and quantify the performance using the F1-score.\n\n**1. Frequency-Domain Representation of the MVAR Model**\n\nThe MVAR model is given by the equation:\n$$ X(n) = \\sum_{k=1}^{p} A_k X(n-k) + E(n) $$\nwhere $X(n)$ is the $m \\times 1$ vector of signals at time $n$, $A_k$ are the $m \\times m$ coefficient matrices for lag $k$, and $E(n)$ is the $m \\times 1$ vector of innovation processes. Here, the number of nodes is $m=4$ and the model order is $p=2$.\n\nRearranging the equation gives:\n$$ X(n) - A_1 X(n-1) - A_2 X(n-2) = E(n) $$\nApplying the Discrete-Time Fourier Transform, which transforms a time-shifted signal $G(n-k)$ to $G(f) e^{-i 2\\pi f k / f_s}$, we obtain the frequency-domain representation:\n$$ X(f) - A_1 X(f) e^{-i 2\\pi f / f_s} - A_2 X(f) e^{-i 4\\pi f / f_s} = E(f) $$\nFactoring out $X(f)$ yields:\n$$ \\left(I - A_1 e^{-i 2\\pi f / f_s} - A_2 e^{-i 4\\pi f / f_s}\\right) X(f) = E(f) $$\nThis can be written compactly as:\n$$ \\bar{A}(f) X(f) = E(f) $$\nwhere $I$ is the $4 \\times 4$ identity matrix and $\\bar{A}(f)$ is the frequency-domain coefficient matrix:\n$$ \\bar{A}(f) = I - \\sum_{k=1}^{2} A_k e^{-i 2\\pi f k / f_s} $$\nThe elements of $\\bar{A}(f)$, denoted $\\bar{A}_{ij}(f)$, are central to the definition of PDC.\n\n**2. Partial Directed Coherence (PDC)**\n\nPDC from node $j$ to node $i$ at frequency $f$ quantifies the direct causal influence of $j$ on $i$. It is defined using the elements of the $\\bar{A}(f)$ matrix. The magnitude of PDC is given by:\n$$ |\\pi_{ij}(f)| = \\frac{|\\bar{A}_{ij}(f)|}{\\sqrt{\\sum_{k=1}^{m} |\\bar{A}_{kj}(f)|^2}} $$\nThe term $\\bar{A}_{ij}(f)$ represents the direct influence from node $j$ to node $i$ at frequency $f$. The denominator is the L2-norm of the $j$-th column of the $\\bar{A}(f)$ matrix, which represents the total influence originating from node $j$ to all other nodes (including itself). Thus, PDC normalizes the direct influence by the total \"outflow\" from the source node $j$.\n\n**3. Directed Transfer Function (DTF)**\n\nTo define DTF, we first express the signal vector $X(f)$ in terms of the innovation vector $E(f)$ by inverting $\\bar{A}(f)$:\n$$ X(f) = \\bar{A}(f)^{-1} E(f) = H(f) E(f) $$\nThe matrix $H(f) = \\bar{A}(f)^{-1}$ is the transfer function matrix of the system. An element $H_{ij}(f)$ describes the total influence of the innovation $E_j(f)$ at node $j$ on the signal $X_i(f)$ at node $i$, including both direct and indirect pathways.\n\nThe DTF from node $j$ to node $i$ is defined based on the elements of this transfer matrix $H(f)$. The magnitude of DTF is given by:\n$$ |\\gamma_{ij}(f)| = \\frac{|H_{ij}(f)|}{\\sqrt{\\sum_{k=1}^{m} |H_{ik}(f)|^2}} $$\nThe denominator is the L2-norm of the $i$-th row of the $H(f)$ matrix, representing the total influence from all innovations to the signal at node $i$. Thus, DTF normalizes the influence of $j$ on $i$ by the total \"inflow\" to the target node $i$.\n\n**4. Computational Algorithm and Evaluation**\n\nThe algorithm proceeds as follows:\n-   A frequency grid is created from $f=0$ Hz to $f=50$ Hz with a step of $0.5$ Hz.\n-   For each frequency $f$ in the grid, the matrices $\\bar{A}(f)$ and $H(f) = \\bar{A}(f)^{-1}$ are computed.\n-   Using these matrices, the PDC values $|\\pi_{ij}(f)|$ and DTF values $|\\gamma_{ij}(f)|$ are calculated for all pairs $(i, j)$ with $i \\ne j$.\n-   An \"edge score\" for each potential connection $j \\to i$ is determined by finding the maximum value of the respective measure (PDC or DTF) over the union of two frequency bands: $[9, 11]$ Hz and $[19, 21]$ Hz.\n-   All possible $4 \\times 3 = 12$ directed edges are ranked in descending order based on their scores, separately for PDC and DTF.\n-   For each test case ($K=4$, $K=3$, $K=6$), the top-$K$ edges are selected. This set of selected edges, $S_K$, is compared against the ground-truth set of edges, $G = \\{1 \\to 2, 2 \\to 1, 2 \\to 3, 3 \\to 4\\}$.\n-   The performance is evaluated using the F1-score, calculated as:\n    $$ \\text{F1} = \\frac{2 \\times \\text{Precision} \\times \\text{Recall}}{\\text{Precision} + \\text{Recall}} $$\n    where Precision $= |S_K \\cap G| / |S_K|$ and Recall $= |S_K \\cap G| / |G|$. A value of $0.0$ is assigned if Precision and Recall are both zero.\n\nThis comprehensive procedure, executed from the first principles of MVAR modeling and frequency analysis, allows for a robust assessment of PDC and DTF in recovering the underlying network structure.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes PDC and DTF for a given MVAR model, and evaluates their\n    performance in identifying network connections using the F1-score.\n    \"\"\"\n    \n    # --- Step 1: Define MVAR model parameters and analysis settings ---\n    A1 = np.array([\n        [1.53713, 0.13, 0, 0],\n        [0.22, 1.53713, 0, 0],\n        [0, 0.17, 0.55623, 0],\n        [0, 0, 0.25, 0.55623]\n    ])\n    A2 = np.array([\n        [-0.9025, 0, 0, 0],\n        [0, -0.9025, 0, 0],\n        [0, 0, -0.81, 0],\n        [0, 0, 0, -0.81]\n    ])\n    \n    fs = 100.0  # Sampling frequency in Hz\n    num_nodes = 4\n    \n    freqs = np.arange(0, 50.5, 0.5)\n    num_freqs = len(freqs)\n    \n    ground_truth_edges = set([(1, 2), (2, 1), (2, 3), (3, 4)]) # Edges are (from, to)\n    \n    test_cases = [4, 3, 6] # Values for K\n\n    # --- Step 2: Compute PDC and DTF spectra from first principles ---\n    pdc_spectra = np.zeros((num_freqs, num_nodes, num_nodes))\n    dtf_spectra = np.zeros((num_freqs, num_nodes, num_nodes))\n    I = np.identity(num_nodes)\n\n    for i_f, f in enumerate(freqs):\n        omega = 2 * np.pi * f / fs\n        z1 = np.exp(-1j * omega)\n        z2 = np.exp(-2j * omega)\n\n        A_bar = I - A1 * z1 - A2 * z2\n\n        # PDC calculation: measures direct pathways\n        A_bar_abs = np.abs(A_bar)\n        col_norms = np.linalg.norm(A_bar, axis=0) # L2 norm of each column\n        col_norms[col_norms == 0] = 1.0 # Avoid division by zero\n        pdc_spectra[i_f, :, :] = A_bar_abs / col_norms\n\n        # DTF calculation: measures total (direct + indirect) pathways\n        try:\n            H = np.linalg.inv(A_bar)\n        except np.linalg.LinAlgError:\n            # This should not occur for a stable MVAR model\n            H = np.full((num_nodes, num_nodes), np.nan)\n\n        H_abs = np.abs(H)\n        row_norms = np.linalg.norm(H, axis=1) # L2 norm of each row\n        row_norms[row_norms == 0] = 1.0 # Avoid division by zero\n        dtf_spectra[i_f, :, :] = H_abs / row_norms[:, np.newaxis] # Reshape for broadcasting\n\n    # --- Step 3: Compute edge scores from spectra ---\n    band1_indices = np.where((freqs >= 9) & (freqs <= 11))[0]\n    band2_indices = np.where((freqs >= 19) & (freqs <= 21))[0]\n    union_indices = np.union1d(band1_indices, band2_indices)\n\n    pdc_scores = []\n    dtf_scores = []\n    \n    for j in range(1, num_nodes + 1):  # 'from' node (1-based)\n        for i in range(1, num_nodes + 1):  # 'to' node (1-based)\n            if i == j:\n                continue\n            \n            j_idx, i_idx = j - 1, i - 1 # Convert to 0-based index\n\n            # PDC score for connection j -> i\n            pdc_in_bands = pdc_spectra[union_indices, i_idx, j_idx]\n            pdc_score = np.max(pdc_in_bands)\n            pdc_scores.append(((j, i), pdc_score))\n\n            # DTF score for connection j -> i\n            dtf_in_bands = dtf_spectra[union_indices, i_idx, j_idx]\n            dtf_score = np.max(dtf_in_bands)\n            dtf_scores.append(((j, i), dtf_score))\n            \n    # --- Step 4: Evaluate for each K and compute F1-scores ---\n    pdc_scores.sort(key=lambda x: x[1], reverse=True)\n    dtf_scores.sort(key=lambda x: x[1], reverse=True)\n    \n    results = []\n\n    def calculate_f1(selected_edges, ground_truth):\n        true_positives = len(selected_edges.intersection(ground_truth))\n        \n        num_selected = len(selected_edges)\n        num_ground_truth = len(ground_truth)\n        \n        if num_selected == 0 or num_ground_truth == 0:\n            return 0.0\n\n        precision = true_positives / num_selected\n        recall = true_positives / num_ground_truth\n        \n        if precision + recall == 0:\n            return 0.0\n            \n        f1_score = 2 * (precision * recall) / (precision + recall)\n        return f1_score\n\n    for K in test_cases:\n        # Get top-K edges for PDC\n        pdc_selected_edges = set(edge for edge, score in pdc_scores[:K])\n        f1_pdc = calculate_f1(pdc_selected_edges, ground_truth_edges)\n        \n        # Get top-K edges for DTF\n        dtf_selected_edges = set(edge for edge, score in dtf_scores[:K])\n        f1_dtf = calculate_f1(dtf_selected_edges, ground_truth_edges)\n\n        results.extend([f1_pdc, f1_dtf])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}