{
    "hands_on_practices": [
        {
            "introduction": "要建立坚实的理论基础，我们的第一个练习将通过直接的手动计算来巩固部分导向相干（PDC）的定义。通过分析一个简单的三节点 MVAR 模型，您将清楚地看到 PDC 值是如何从模型的系数矩阵中推导出来的，从而强化 PDC 量化模型中直接因果关系的概念。这个练习旨在揭开公式的神秘面纱，并将其与底层模型结构具体联系起来 。",
            "id": "4184284",
            "problem": "考虑一个用于神经时间序列的平稳三节点一阶多元自回归过程(AR(1))，其表达式为 $x(t)=A_{1}\\,x(t-1)+w(t)$，其中 $x(t)\\in\\mathbb{R}^{3}$，$A_{1}\\in\\mathbb{R}^{3\\times 3}$，且 $w(t)$ 是一个均值为零、协方差有限的白新息过程。设\n$$\nA_{1}=\\begin{bmatrix}\n0.5  0  0\\\\\n0.3  0.4  0\\\\\n0  0.2  0.6\n\\end{bmatrix}.\n$$\n使用自回归算子的标准频域构建方法以及部分有向相干(PDC)从节点$j$到节点$i$的定义，计算在频率$f=0$（频率单位为周期/样本）时的PDC值$\\pi_{21}(f)$和$\\pi_{31}(f)$。根据这些值，解释在$f=0$时，从节点1发出的哪个有向影响更强，并根据模型结构说明原因。\n\n为进行评分，请报告由$\\pi_{21}(0)$的模平方给出的单个标量值，即$|\\pi_{21}(0)|^{2}$。将您的答案四舍五入至四位有效数字。报告的值是无量纲的，必须以纯数字形式提供。",
            "solution": "该问题是有效的，因为它在科学上基于多元时间序列分析理论，问题陈述清晰，提供了所有必要信息，并且其表述是客观的。对于给定的AR(1)过程，其平稳性条件是满足的，因为矩阵$A_1$的特征值，即其对角线元素（$0.5$、$0.4$和$0.6$），其模都小于$1$。\n\n阶数为$p=1$的多元自回归(MVAR)过程由下式给出：\n$$\nx(t) = A_1 x(t-1) + w(t)\n$$\n其中 $x(t) \\in \\mathbb{R}^3$ 是在时间$t$时的时间序列值向量，$A_1 \\in \\mathbb{R}^{3\\times 3}$ 是系数矩阵，$w(t)$ 是一个白噪声向量过程。\n\n为了在频域中分析该过程，我们进行傅里叶变换。这导出了频域表示：\n$$\n\\bar{A}(f) X(f) = W(f)\n$$\n其中 $\\bar{A}(f)$ 是频域中的自回归算子，定义为：\n$$\n\\bar{A}(f) = I - A_1 \\exp(-i 2 \\pi f)\n$$\n这里，$I$ 是$3 \\times 3$的单位矩阵，$f$ 是频率（单位为周期/样本），$i = \\sqrt{-1}$。\n\n问题要求在频率$f=0$处进行评估。在此频率下，指数项变为$\\exp(0) = 1$。算子简化为：\n$$\n\\bar{A}(0) = I - A_1\n$$\n使用给定的矩阵$A_1$：\n$$\nA_1 = \\begin{bmatrix}\n0.5  0  0 \\\\\n0.3  0.4  0 \\\\\n0  0.2  0.6\n\\end{bmatrix}\n$$\n我们计算$\\bar{A}(0)$：\n$$\n\\bar{A}(0) = \\begin{bmatrix}\n1  0  0 \\\\\n0  1  0 \\\\\n0  0  1\n\\end{bmatrix} - \\begin{bmatrix}\n0.5  0  0 \\\\\n0.3  0.4  0 \\\\\n0  0.2  0.6\n\\end{bmatrix} = \\begin{bmatrix}\n1-0.5  -0  -0 \\\\\n-0.3  1-0.4  -0 \\\\\n-0  -0.2  1-0.6\n\\end{bmatrix} = \\begin{bmatrix}\n0.5  0  0 \\\\\n-0.3  0.6  0 \\\\\n0  -0.2  0.4\n\\end{bmatrix}\n$$\n部分有向相干(PDC)从节点$j$到节点$i$在频率$f$的值，记为$\\pi_{ij}(f)$，是使用$\\bar{A}(f)$矩阵的元素定义的。其标准定义为：\n$$\n\\pi_{ij}(f) = \\frac{\\bar{A}_{ij}(f)}{\\sqrt{\\sum_{k=1}^{3} |\\bar{A}_{kj}(f)|^2}}\n$$\n其中$\\bar{A}_{ij}(f)$是$\\bar{A}(f)$矩阵第$i$行第$j$列的元素。分母是矩阵$\\bar{A}(f)$第$j$列的欧几里得范数。此度量是归一化的，量化了从$j$到$i$的直接影响相对于$j$对所有其他节点的总影响。\n\n我们需要计算$\\pi_{21}(0)$和$\\pi_{31}(0)$，分别表示在频率$f=0$时从节点1到节点2以及从节点1到节点3的影响。这两个计算都使用$\\bar{A}(0)$矩阵的第一列（$j=1$）。\n\n$\\bar{A}(0)$的第一列是 $\\begin{pmatrix} 0.5 \\\\ -0.3 \\\\ 0 \\end{pmatrix}$。其元素为$\\bar{A}_{11}(0)=0.5$，$\\bar{A}_{21}(0)=-0.3$，和$\\bar{A}_{31}(0)=0$。\n首先，我们计算$j=1$时的分母项：\n$$\n\\sqrt{\\sum_{k=1}^{3} |\\bar{A}_{k1}(0)|^2} = \\sqrt{|\\bar{A}_{11}(0)|^2 + |\\bar{A}_{21}(0)|^2 + |\\bar{A}_{31}(0)|^2} = \\sqrt{|0.5|^2 + |-0.3|^2 + |0|^2} = \\sqrt{0.25 + 0.09 + 0} = \\sqrt{0.34}\n$$\n现在，我们计算$\\pi_{21}(0)$：\n$$\n\\pi_{21}(0) = \\frac{\\bar{A}_{21}(0)}{\\sqrt{0.34}} = \\frac{-0.3}{\\sqrt{0.34}}\n$$\n接下来，我们计算$\\pi_{31}(0)$：\n$$\n\\pi_{31}(0) = \\frac{\\bar{A}_{31}(0)}{\\sqrt{0.34}} = \\frac{0}{\\sqrt{0.34}} = 0\n$$\n为了比较影响的强度，我们考察它们的模平方，$|\\pi_{ij}(0)|^2$：\n$$\n|\\pi_{21}(0)|^2 = \\left| \\frac{-0.3}{\\sqrt{0.34}} \\right|^2 = \\frac{0.09}{0.34} \\approx 0.2647\n$$\n$$\n|\\pi_{31}(0)|^2 = |0|^2 = 0\n$$\n由于$|\\pi_{21}(0)|^2 > |\\pi_{31}(0)|^2$，在$f=0$时，从节点1到节点2的有向影响强于从节点1到节点3的有向影响。\n\n这个结果可以直接从模型结构中得到解释。在AR模型中，系数$(A_p)_{ij}$量化了$x_j(t-p)$对$x_i(t)$的直接线性影响。在我们的AR(1)模型中，系数$(A_1)_{ij}$表示$x_j(t-1)$对$x_i(t)$的影响。\n从给定的矩阵$A_1$中：\n- $1 \\to 2$的影响由$(A_1)_{21} = 0.3$确定。\n- $1 \\to 3$的影响由$(A_1)_{31} = 0$确定。\n非零系数$(A_1)_{21}$意味着从节点1到节点2存在直接的因果联系，这导致了非零的PDC值。相反，零系数$(A_1)_{31}$表示从节点1到节点3不存在直接的因果联系，导致其PDC值在所有频率上都为零。因此，PDC分析正确地识别了模型系数矩阵中指定的$1 \\to 2$连接的存在和$1 \\to 3$连接的缺失。\n\n问题要求的是标量值$|\\pi_{21}(0)|^2$，四舍五入到四位有效数字。\n$$\n|\\pi_{21}(0)|^2 = \\frac{0.09}{0.34} = \\frac{9}{34} \\approx 0.26470588...\n$$\n四舍五入到四位有效数字得到$0.2647$。",
            "answer": "$$\n\\boxed{0.2647}\n$$"
        },
        {
            "introduction": "尽管 PDC 在识别直接连接方面表现出色，但神经和生物系统充满了间接通路。下一个练习要求您同时实现 PDC 和导向传递函数（DTF），以探索一个经典场景：信号仅通过一个中间节点 3 从节点 1 传播到节点 2。通过观察 DTF 如何捕捉这种介导影响而 PDC 却不能，您将对它们在绘制网络连接图中的互补作用获得实践性的理解 。",
            "id": "4184294",
            "problem": "考虑一个三维、离散时间、平稳的$p$阶线性多元自回归（MVAR）过程，其新息（innovations）是白化的，表示为 $X(t) = \\sum_{k=1}^{p} A_k X(t-k) + \\varepsilon(t)$，其中 $X(t) \\in \\mathbb{R}^3$，$\\varepsilon(t)$ 是零均值、单位协方差的白噪声，且系数矩阵 $\\{A_k\\}$ 构成一个稳定的系统。在神经科学数据分析的背景下，该模型常用于研究谱因果性度量，如定向传递函数（DTF）和部分定向相干（PDC），它们是用于评估节点间定向影响的频域工具。定向传递函数（DTF）和部分定向相干（PDC）必须使用它们从MVAR谱表示中推导出的规范定义来实现，而不是依赖于本问题陈述中提供的任何快捷公式。\n\n您的任务是构建并分析一个三节点示例，其中从 $x_1$ 到 $x_2$ 的影响仅通过 $x_3$ 发生，并证明定向传递函数（DTF）显示存在 $1 \\to 2$ 的影响，而部分定向相干（PDC）则不显示，同时将此现象与条件格兰杰因果（GC）与非条件格兰杰因果的行为联系起来。\n\n使用一个MVAR($1$)模型，其基本情况的系数矩阵 $A_1$ 定义如下：\n$$\nA_1 =\n\\begin{bmatrix}\n0  0  0 \\\\\n0  0  g \\\\\nh  0  0\n\\end{bmatrix},\n$$\n其中 $g = 0.4$ 且 $h = 0.5$，这编码了强度为 $h$ 的 $x_1 \\to x_3$ 和强度为 $g$ 的 $x_3 \\to x_2$ 的连接，并且没有直接的 $x_1 \\to x_2$ 项。该系统具有白化新息并且是稳定的。考虑单位圆上的频域，其中 $z = e^{i 2 \\pi f}$，$f$ 是以“周期/样本”为单位的频率。\n\n从MVAR谱表示的第一性原理出发，实现部分定向相干（PDC）和定向传递函数（DTF）。对于每个度量，根据以下检测规则判断是否存在定向影响 $1 \\to 2$：在给定频率 $f$ 下，如果该度量对于 $2 \\leftarrow 1$ 的幅值超过检测阈值 $\\tau = 10^{-8}$，则表示存在 $1 \\to 2$ 的连接；对于一个模型，如果在任何测试频率下出现这种情况，则声明该度量指示存在 $1 \\to 2$ 的连接。\n\n使用以下包含三种参数设置和三个频率点的测试套件：\n- 待评估的频率：$f \\in \\{0.0, 0.25, 0.5\\}$ 周期/样本。\n- 测试用例1（仅间接）：$A_1$ 如上所述，其中 $g = 0.4$，$h = 0.5$，且没有直接的 $x_1 \\to x_2$ 连接。\n- 测试用例2（间接加直接）：与测试用例1相同，但增加一个系数为 $d = 0.3$ 的直接连接 $x_1 \\to x_2$，即将 $A_1$ 的 $(2,1)$ 元素设为 $d$。\n- 测试用例3（无路径）：设置 $g = 0$，$h = 0$，$d = 0$，即 $A_1$ 为零矩阵，因此既没有直接也没有间接的 $x_1 \\to x_2$ 影响。\n\n对于每个测试用例，根据上述规则在指定频率上计算布尔检测对 $\\big[\\text{DTF 检测到 } 1 \\to 2, \\text{PDC 检测到 } 1 \\to 2\\big]$。\n\n您的程序应生成单行输出，其中包含结果，格式为方括号括起来的逗号分隔列表，具体聚合格式为：一个包含三个列表的列表，每个测试用例一个，其中每个内部列表按 $\\big[\\text{DTF 检测结果}, \\text{PDC 检测结果}\\big]$ 的顺序列出两个布尔值。例如，输出应类似于 $\\big[[b_{11},b_{12}],[b_{21},b_{22}],[b_{31},b_{32}]\\big]$，其中每个 $b_{ij}$ 为 $\\text{True}$ 或 $\\text{False}$。",
            "solution": "我们从一个具有白化新息的稳定MVAR($p$)过程的多元自回归（MVAR）谱表示开始。设自回归多项式定义为\n$$\nA(f) = I - \\sum_{k=1}^{p} A_k e^{-i 2 \\pi f k},\n$$\n其中 $I$ 是单位矩阵，$f$ 是以“周期/样本”为单位的频率。传递矩阵为\n$$\nH(f) = A(f)^{-1}.\n$$\n定向传递函数（DTF）和部分定向相干（PDC）是分别根据 $H(f)$ 和 $A(f)$ 定义的频域度量。对于定向传递函数（DTF），我们使用传递矩阵的按行归一化：\n$$\n\\text{DTF}_{i \\leftarrow j}(f) = \\frac{\\left|H_{ij}(f)\\right|}{\\sqrt{\\sum_{k=1}^{N} \\left|H_{ik}(f)\\right|^2}},\n$$\n该公式量化了在频率 $f$ 下，从节点 $j$ 到达节点 $i$ 的信号功率相对于所有进入节点 $i$ 的源的比例。对于部分定向相干（PDC），我们使用自回归多项式的按列归一化：\n$$\n\\text{PDC}_{i \\leftarrow j}(f) = \\frac{\\left|A_{ij}(f)\\right|}{\\sqrt{\\sum_{k=1}^{N} \\left|A_{kj}(f)\\right|^2}}.\n$$\n部分定向相干（PDC）反映了条件格兰杰因果（GC），在对剩余变量进行条件化后，它关注直接的边（它对自回归表示中流出 $x_j$ 的部分进行归一化）。相比之下，定向传递函数（DTF）反映了非条件格兰杰因果，因为它捕捉了 $x_j$ 能够影响 $x_i$ 的任何路径，包括间接路径，因为 $H(f)$ 包含了所有滞后和路径的累积效应。\n\n现在考虑指定的三节点MVAR($1$)模型。对于基本情况，系数矩阵为\n$$\nA_1 =\n\\begin{bmatrix}\n0  0  0 \\\\\n0  0  g \\\\\nh  0  0\n\\end{bmatrix},\n\\quad g = 0.4,\\ h = 0.5.\n$$\n对于$p=1$阶，自回归多项式为\n$$\nA(f) = I - A_1 e^{-i 2 \\pi f}.\n$$\n请注意，在基本情况下，$A_1$ 的 $(2,1)$ 元素为零，因此\n$$\nA_{21}(f) = 0 \\quad \\text{对于所有 } f,\n$$\n所以\n$$\n\\text{PDC}_{2 \\leftarrow 1}(f) = 0 \\quad \\text{对于所有 } f,\n$$\n因为分子为零，而分母由于 $A(f)$ 中非零的对角项而为有限值。\n\n为了分析定向传递函数（DTF），我们检查传递矩阵\n$$\nH(f) = A(f)^{-1}.\n$$\n定义 $B(f) = A_1 e^{-i 2 \\pi f}$；则 $A(f) = I - B(f)$。对于一个稳定的系统，如果 $B(f)$ 的算子范数很小，我们可以写出诺伊曼展开\n$$\nH(f) = (I - B(f))^{-1} = I + B(f) + B(f)^2 + B(f)^3 + \\cdots.\n$$\n在本例中，由于 $x_1 \\to x_3$ 和 $x_3 \\to x_2$ 的链式结构，矩阵 $A_1$ 是严格非对角的，并且是3次幂零的；具体来说，$A_1^3 = 0$。因此，\n$$\nH(f) = I + B(f) + B(f)^2,\n$$\n更高次幂为零。$H(f)$ 的 $(2,1)$ 元素仅由二次项贡献，\n$$\nH_{21}(f) = \\left[B(f)^2\\right]_{21}.\n$$\n因为 $B(f) = A_1 e^{-i 2 \\pi f}$ 且矩阵乘法得到\n$$\n\\left[A_1^2\\right]_{21} = \\left[A_1\\right]_{23} \\left[A_1\\right]_{31} = g h,\n$$\n我们得到\n$$\nH_{21}(f) = e^{-i 4 \\pi f} \\, g h,\n$$\n其幅值对所有 $f$ 都不为零。因此，\n$$\n\\text{DTF}_{2 \\leftarrow 1}(f) = \\frac{|g h|}{\\sqrt{|H_{21}(f)|^2 + |H_{22}(f)|^2 + |H_{23}(f)|^2}} = \\frac{|g h|}{\\sqrt{(g h)^2 + 1^2 + g^2}},\n$$\n因为 $H_{22}(f) = 1$ (来自 $I$) 且 $H_{23}(f) = e^{-i 2 \\pi f} g$ (来自 $B(f)$)。因此，定向传递函数（DTF）指示存在一个非零的 $1 \\to 2$ 影响，而部分定向相干（PDC）则没有，这精确地捕捉了非条件格兰杰因果（DTF吸引间接路径）和条件格兰杰因果（PDC分离直接边）之间的区别。\n\n对于测试用例2，通过设置 $A_{21} = d$（其中 $d = 0.3$）来包含一个直接连接 $x_1 \\to x_2$。那么\n$$\nA_{21}(f) = -d e^{-i 2 \\pi f} \\neq 0,\n$$\n所以部分定向相干（PDC）检测到 $1 \\to 2$ 的边（分子不为零），而定向传递函数（DTF）也检测到它，因为 $H_{21}(f)$ 仍然不为零。对于测试用例3，设置 $g = h = d = 0$，所以 $A_1 = 0$，$A(f) = I$，以及 $H(f) = I$。那么 $\\text{DTF}_{2 \\leftarrow 1}(f)$ 和 $\\text{PDC}_{2 \\leftarrow 1}(f)$ 对所有 $f$ 都为零。\n\n程序的算法步骤：\n1. 对每个测试用例，构建 $A_1$。\n2. 对每个频率 $f \\in \\{0.0, 0.25, 0.5\\}$，计算 $A(f) = I - A_1 e^{-i 2 \\pi f}$ 和 $H(f) = A(f)^{-1}$。\n3. 通过对 $H(f)$ 的第 $i=2$ 行和第 $j=1$ 列进行按行归一化，计算 $\\text{DTF}_{2 \\leftarrow 1}(f)$。\n4. 通过对 $A(f)$ 的第 $j=1$ 列和第 $i=2$ 行进行按列归一化，计算 $\\text{PDC}_{2 \\leftarrow 1}(f)$。\n5. 应用阈值为 $\\tau = 10^{-8}$ 的检测规则：如果在任何频率下其幅值超过 $\\tau$，则该度量指示存在 $1 \\to 2$ 的连接。\n6. 将每个测试用例的布尔值聚合成指定的单行输出格式。\n\n预期的定性结果：\n- 测试用例1: $\\big[\\text{True}, \\text{False}\\big]$ 因为由于通过 $x_3$ 的间接路径，$\\text{DTF}_{2 \\leftarrow 1}(f) > 0$ 对所有 $f$ 成立，而 $\\text{PDC}_{2 \\leftarrow 1}(f) = 0$ 因为没有直接的 $x_1 \\to x_2$ 系数。\n- 测试用例2: $\\big[\\text{True}, \\text{True}\\big]$ 因为两种度量都检测到了直接边和间接路径。\n- 测试用例3: $\\big[\\text{False}, \\text{False}\\big]$ 因为没有从 $x_1$ 到 $x_2$ 的路径。\n\n这种行为直接说明了与格兰杰因果的关系：定向传递函数（DTF）通过聚合传递矩阵中编码的所有路径来反映非条件格兰杰因果，而部分定向相干（PDC）通过在对所有其他节点进行条件化后，分离自回归多项式中的直接依赖关系来反映条件格兰杰因果。",
            "answer": "```python\nimport numpy as np\n\ndef compute_A_f(A_list, f):\n    \"\"\"\n    Compute A(f) = I - sum_k A_k * exp(-i 2 pi f k)\n    for a given list of A_k (k=1..p) and frequency f in cycles/sample.\n    \"\"\"\n    n = A_list[0].shape[0]\n    A_f = np.eye(n, dtype=complex)\n    for k, A_k in enumerate(A_list, start=1):\n        A_f = A_f - A_k * np.exp(-1j * 2 * np.pi * f * k)\n    return A_f\n\ndef dtf_ij(A_list, f, i, j):\n    \"\"\"\n    Compute row-normalized DTF_{i-j}(f) = |H_ij(f)| / sqrt(sum_k |H_ik(f)|^2)\n    where H(f) = A(f)^{-1}.\n    \"\"\"\n    A_f = compute_A_f(A_list, f)\n    H_f = np.linalg.inv(A_f)\n    row_i = H_f[i, :]\n    denom = np.sqrt(np.sum(np.abs(row_i)**2))\n    if denom == 0:\n        return 0.0\n    return np.abs(H_f[i, j]) / denom\n\ndef pdc_ij(A_list, f, i, j):\n    \"\"\"\n    Compute column-normalized PDC_{i-j}(f) = |A_ij(f)| / sqrt(sum_k |A_kj(f)|^2)\n    where A(f) = I - sum_k A_k * exp(-i 2 pi f k).\n    \"\"\"\n    A_f = compute_A_f(A_list, f)\n    col_j = A_f[:, j]\n    denom = np.sqrt(np.sum(np.abs(col_j)**2))\n    if denom == 0:\n        return 0.0\n    return np.abs(A_f[i, j]) / denom\n\ndef build_A1(g, h, d=0.0):\n    \"\"\"\n    Build A1 for the 3-node MVAR(1) model:\n    - x1 -> x3 with strength h: A1[2,0] = h\n    - x3 -> x2 with strength g: A1[1,2] = g\n    - optional direct x1 -> x2 with strength d: A1[1,0] = d\n    \"\"\"\n    A1 = np.zeros((3, 3), dtype=float)\n    A1[2, 0] = h  # x1 -> x3\n    A1[1, 2] = g  # x3 -> x2\n    if d != 0.0:\n        A1[1, 0] = d  # x1 -> x2 direct\n    return A1\n\ndef detect_link(A_list, freqs, i, j, tau):\n    \"\"\"\n    For given A_list and frequencies, detect if there is a link j->i using DTF and PDC:\n    True if measure exceeds tau at any frequency.\n    Returns (dtf_detect, pdc_detect).\n    \"\"\"\n    dtf_vals = []\n    pdc_vals = []\n    for f in freqs:\n        dtf_vals.append(dtf_ij(A_list, f, i, j))\n        pdc_vals.append(pdc_ij(A_list, f, i, j))\n    dtf_detect = np.any(np.array(dtf_vals) > tau)\n    pdc_detect = np.any(np.array(pdc_vals) > tau)\n    return bool(dtf_detect), bool(pdc_detect)\n\ndef solve():\n    # Frequencies in cycles/sample\n    freqs = [0.0, 0.25, 0.5]\n    tau = 1e-8  # detection threshold\n\n    # Test cases:\n    # 1) Indirect only: g=0.4, h=0.5, no direct d\n    A1_case1 = build_A1(g=0.4, h=0.5, d=0.0)\n    # 2) Indirect plus direct: add d=0.3\n    A1_case2 = build_A1(g=0.4, h=0.5, d=0.3)\n    # 3) No path: all zero\n    A1_case3 = build_A1(g=0.0, h=0.0, d=0.0)\n\n    test_cases = [\n        [A1_case1],  # MVAR(1)\n        [A1_case2],\n        [A1_case3],\n    ]\n\n    # We check link 1 -> 2, which corresponds to i=1 (x2), j=0 (x1) in 0-based indexing.\n    i, j = 1, 0\n\n    results = []\n    for A_list in test_cases:\n        dtf_detect, pdc_detect = detect_link(A_list, freqs, i, j, tau)\n        results.append([dtf_detect, pdc_detect])\n\n    # Final print in required format: list of three [DTF_detect, PDC_detect] pairs.\n    print(f\"[{','.join([str(r).replace(' ', '') for r in results])}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "在前一个练习的基础上，我们现在来解决一个对于实验研究者至关重要的问题：如果间接通路中的中间节点未被观测到，会发生什么？这个练习通过比较完整的多元 DTF 分析与忽略了中间节点的成对（双元）分析，来模拟这种常见情况。通过量化由此产生的影响高估，您将了解到在连接性研究中忽略相关变量的风险，以及采用全面多元方法的重要性 。",
            "id": "4184297",
            "problem": "考虑一个一阶离散时间多元自回归过程，该过程常用于神经科学数据分析，以模拟大脑区域之间的定向相互作用。设该三维过程由以下递归关系定义\n$$\n\\mathbf{x}(t) = \\mathbf{A}_1 \\mathbf{x}(t-1) + \\mathbf{e}(t),\n$$\n其中 $\\mathbf{x}(t) \\in \\mathbb{R}^3$ 是时间 $t$ 的状态向量，$\\mathbf{A}_1 \\in \\mathbb{R}^{3 \\times 3}$ 是自回归系数矩阵，$\\mathbf{e}(t)$ 是一个具有单位协方差的白噪声向量。假设一个链式拓扑 $1 \\to 2 \\to 3$，由一个下三角矩阵 $\\mathbf{A}_1$ 实现，其对角线上以及对应于该链的次对角线上的元素为非零值：\n$$\n\\mathbf{A}_1 =\n\\begin{bmatrix}\nb_{11}  0  0 \\\\\na_{12}  b_{22}  0 \\\\\n0  a_{23}  b_{33}\n\\end{bmatrix},\n$$\n其中 $|b_{ii}|  1$ 以确保稳定性，$a_{12}, a_{23} \\ge 0$ 分别表示定向耦合 $1 \\to 2$ 和 $2 \\to 3$。\n\n从多元自回归过程的频域表示出发，根据第一性原理推导频率相关的传递矩阵 $\\mathbf{H}(f)$。然后，将从节点 $i$ 到节点 $j$ 在频率 $f$ 处的定向传递函数（DTF）模平方定义为 $\\mathbf{H}(f)$ 对应项的模平方相对于节点 $j$ 的总流入量的归一化。考虑两种归一化情境：\n- 多元归一化，包含所有三个源 $k \\in \\{1,2,3\\}$。\n- 二元归一化，只包含观测对中的源 $k \\in \\{1,3\\}$，这模拟了省略节点 $2$ 的配对分析。\n\n您的任务是实现一个程序，对于给定的 $\\mathbf{A}_1$，在一个均匀的频率网格 $f \\in [0, 0.5]$（单位为每样本周期数）上，计算从节点 $1$ 到节点 $3$ 的二元和多元 DTF 模平方。通过计算频率网格上的平均差异，量化二元情况下对 $1 \\to 3$ 影响的高估程度：\n$$\n\\Delta = \\frac{1}{M} \\sum_{m=1}^{M} \\left( \\gamma^{\\text{bi}}_{1 \\to 3}(f_m) - \\gamma^{\\text{multi}}_{1 \\to 3}(f_m) \\right),\n$$\n其中 $M$ 是频率样本的数量，$\\gamma^{\\text{bi}}_{1 \\to 3}(f)$ 表示源为 $\\{1,3\\}$ 的二元 DTF 模平方，$\\gamma^{\\text{multi}}_{1 \\to 3}(f)$ 表示源为 $\\{1,2,3\\}$ 的多元 DTF 模平方。如果在某个频率 $f$ 上，二元和多元 DTF 值均恒等于零，则将该频率 $f$ 处的差异视为零。最终报告的 $\\Delta$ 必须是一个非负实数。\n\n构建一个包含四个参数集的测试套件，用以探索该链的不同模式：\n1. 具有中等强度自动态和耦合的正常路径：\n   - $(b_{11}, b_{22}, b_{33}, a_{12}, a_{23}) = (0.4, 0.4, 0.4, 0.5, 0.5)$。\n2. 最后一个连接断开的链（$2 \\to 3$ 缺失）：\n   - $(b_{11}, b_{22}, b_{33}, a_{12}, a_{23}) = (0.4, 0.4, 0.4, 0.5, 0.0)$。\n3. 具有强记忆性和中等强度耦合：\n   - $(b_{11}, b_{22}, b_{33}, a_{12}, a_{23}) = (0.7, 0.7, 0.7, 0.4, 0.4)$。\n4. 具有异构自动态和非对称耦合：\n   - $(b_{11}, b_{22}, b_{33}, a_{12}, a_{23}) = (0.2, 0.6, 0.8, 0.2, 0.5)$。\n\n您的程序必须：\n- 针对给定的 $\\mathbf{A}_1$，推导并使用正确的频域传递矩阵 $\\mathbf{H}(f)$。\n- 在对节点 $3$ 进行归一化时，仅使用源 $\\{1,3\\}$ 来计算 $\\gamma^{\\text{bi}}_{1 \\to 3}(f)$。\n- 在对节点 $3$ 进行归一化时，使用源 $\\{1,2,3\\}$ 来计算 $\\gamma^{\\text{multi}}_{1 \\to 3}(f)$。\n- 在 $[0, 0.5]$ 范围内使用一个包含 $M = 512$ 个点的均匀频率网格（单位为每样本周期数）。\n- 将每个参数集的平均差异 $\\Delta$ 以浮点数形式输出。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含四个结果，按上述测试套件的顺序排列，以逗号分隔，并用方括号括起来，四舍五入到六位小数（例如：\"[0.123456,0.000000,0.987654,0.456789]\"）。\n\n注意：\n- 频率必须以每样本周期数处理；不要在最终输出中转换为弧度。\n- 本程序不计算偏定向相干（PDC），但您应牢记其与定向传递函数（DTF）的区别：PDC 根据自回归系数来量化直接相互作用，而 DTF 通过传递函数来量化因果传播，可能包含间接路径。当中间节点被省略时，二元归一化会高估表观影响，这一区别正是其根本原因。",
            "solution": "用户提供的问题被认为是有效的，因为它具有科学依据、是良定的、客观的，并包含获得唯一解所需的所有必要信息。\n\n该问题要求计算在一个三节点链（$1 \\to 2 \\to 3$）中，当分析省略中间节点 $2$ 时，从节点 $1$ 到节点 $3$ 的定向传递函数（DTF）的高估程度。这种高估程度通过在指定频率范围内，二元 DTF 度量与完全多元 DTF 度量之间的平均差异 $\\Delta$ 来量化。\n\n求解过程分几步进行：首先，我们从给定的多元自回归（MVAR）模型中推导出频域传递函数 $\\mathbf{H}(f)$。其次，我们获得计算所需的 $\\mathbf{H}(f)$ 特定元素的解析表达式。第三，我们定义多元和二元 DTF 度量。最后，我们构建高估度量 $\\Delta$ 并描述其计算算法。\n\n### 步骤 1：传递矩阵 $\\mathbf{H}(f)$ 的推导\n该系统由一个一阶 MVAR 过程描述：\n$$\n\\mathbf{x}(t) = \\mathbf{A}_1 \\mathbf{x}(t-1) + \\mathbf{e}(t)\n$$\n其中 $\\mathbf{x}(t)$ 是 $3$ 维状态向量，$\\mathbf{A}_1$ 是系数矩阵，$\\mathbf{e}(t)$ 是一个协方差矩阵为单位矩阵 $\\mathbf{\\Sigma}_e = \\mathbf{I}$ 的白噪声向量。为求传递矩阵，我们使用离散时间傅里叶变换转换到频域。设 $f$ 为频率（单位为每样本周期数）。$\\mathbf{x}(t-1)$ 的变换是 $e^{-j 2\\pi f} \\mathbf{X}(f)$，其中 $\\mathbf{X}(f)$ 是 $\\mathbf{x}(t)$ 的变换，$j = \\sqrt{-1}$。对 MVAR 方程应用变换，得到：\n$$\n\\mathbf{X}(f) = \\mathbf{A}_1 e^{-j 2\\pi f} \\mathbf{X}(f) + \\mathbf{E}(f)\n$$\n重新整理各项以求解 $\\mathbf{X}(f)$：\n$$\n(\\mathbf{I} - \\mathbf{A}_1 e^{-j 2\\pi f}) \\mathbf{X}(f) = \\mathbf{E}(f)\n$$\n我们定义矩阵 $\\mathbf{A}(f) = \\mathbf{I} - \\mathbf{A}_1 e^{-j 2\\pi f}$。方程变为 $\\mathbf{A}(f) \\mathbf{X}(f) = \\mathbf{E}(f)$。于是，频域中的状态向量为：\n$$\n\\mathbf{X}(f) = \\mathbf{A}(f)^{-1} \\mathbf{E}(f)\n$$\n传递矩阵 $\\mathbf{H}(f)$ 通过 $\\mathbf{X}(f) = \\mathbf{H}(f) \\mathbf{E}(f)$ 将噪声输入与过程输出关联起来。因此，传递矩阵是 $\\mathbf{A}(f)$ 的逆：\n$$\n\\mathbf{H}(f) = \\mathbf{A}(f)^{-1} = (\\mathbf{I} - \\mathbf{A}_1 e^{-j 2\\pi f})^{-1}\n$$\n\n### 步骤 2：$\\mathbf{H}(f)$ 的解析形式\n问题指定了一个表示链 $1 \\to 2 \\to 3$ 的下三角系数矩阵 $\\mathbf{A}_1$：\n$$\n\\mathbf{A}_1 =\n\\begin{bmatrix}\nb_{11}  0  0 \\\\\na_{12}  b_{22}  0 \\\\\n0  a_{23}  b_{33}\n\\end{bmatrix}\n$$\n我们定义复变量 $z = e^{-j 2\\pi f}$。矩阵 $\\mathbf{A}(f)$ 变为：\n$$\n\\mathbf{A}(f) = \\mathbf{I} - z\\mathbf{A}_1 =\n\\begin{bmatrix}\n1 - z b_{11}  0  0 \\\\\n-z a_{12}  1 - z b_{22}  0 \\\\\n0  -z a_{23}  1 - z b_{33}\n\\end{bmatrix}\n$$\n由于 $\\mathbf{A}(f)$ 是一个下三角矩阵，它的逆矩阵 $\\mathbf{H}(f)$ 也是下三角矩阵。我们关心的是对节点 $3$ 的影响，这对应于 $\\mathbf{H}(f)$ 的第三行。设 $\\mathbf{H}(f) = (\\mathbf{A}(f))^{-1}$。第三行的元素是 $H_{31}(f)$、$H_{32}(f)$ 和 $H_{33}(f)$。通过求解方程组 $\\mathbf{A}(f)\\mathbf{H}(f) = \\mathbf{I}$，我们发现：\n\\begin{itemize}\n    \\item $H_{33}(f)$：$\\mathbf{H}(f)$ 的对角元素是 $\\mathbf{A}(f)$ 对角元素的倒数：\n    $$\n    H_{33}(f) = \\frac{1}{1 - b_{33} e^{-j 2\\pi f}}\n    $$\n    \\item $H_{32}(f)$：从 $\\mathbf{A}(f)\\mathbf{H}(f) = \\mathbf{I}$ 的 $(3,2)$ 项，我们有 $(-z a_{23})H_{22}(f) + (1-z b_{33})H_{32}(f) = 0$。由于 $H_{22}(f) = 1/(1-z b_{22})$，这得出：\n    $$\n    H_{32}(f) = \\frac{z a_{23} H_{22}(f)}{1 - z b_{33}} = \\frac{a_{23} e^{-j 2\\pi f}}{(1-b_{22}e^{-j 2\\pi f})(1-b_{33}e^{-j 2\\pi f})}\n    $$\n    \\item $H_{31}(f)$：从 $(3,1)$ 项，我们有 $(-z a_{23})H_{21}(f) + (1-z b_{33})H_{31}(f) = 0$。我们首先求得 $H_{21}(f) = \\frac{z a_{12}}{(1-z b_{11})(1-z b_{22})}$。将其代入得到：\n    $$\n    H_{31}(f) = \\frac{z a_{23} H_{21}(f)}{1 - z b_{33}} = \\frac{a_{12} a_{23} e^{-j 4\\pi f}}{(1-b_{11}e^{-j 2\\pi f})(1-b_{22}e^{-j 2\\pi f})(1-b_{33}e^{-j 2\\pi f})}\n    $$\n\\end{itemize}\n这些表达式表明，只有当 $a_{12}$ 和 $a_{23}$ 都非零时，$H_{31}(f)$ 才非零，这正确地模拟了通过链 $1 \\to 2 \\to 3$ 的因果影响传播。\n\n### 步骤 3：定向传递函数（DTF）的定义\n从节点 $i$到节点 $j$ 的 DTF 模平方是节点 $j$ 处源自节点 $i$ 的功率分数。它被定义为将相应传递函数元素的模平方通过节点 $j$ 的总功率流入进行归一化：\n$$\n\\gamma_{i \\to j}(f) = \\frac{|H_{ji}(f)|^2}{\\sum_{k} |H_{jk}(f)|^2}\n$$\n分母中的求和是针对所考虑的源通道集合 $k$进行的。\n\n### 步骤 4：$1 \\to 3$ 的多元和二元 DTF\n我们的任务是计算从节点 $1$ 到节点 $3$ 的两种版本的 DTF：\n\\begin{enumerate}\n    \\item **多元 DTF**：归一化考虑了所有可能的源 $k \\in \\{1, 2, 3\\}$。流入节点 $j=3$ 的量是 $\\mathbf{H}(f)$ 第三行模平方的和：\n    $$\n    \\gamma^{\\text{multi}}_{1 \\to 3}(f) = \\frac{|H_{31}(f)|^2}{|H_{31}(f)|^2 + |H_{32}(f)|^2 + |H_{33}(f)|^2}\n    $$\n    \\item **二元 DTF**：此情境模拟了忽略中间节点 $2$ 的配对分析。归一化仅在观测到的源 $k \\in \\{1, 3\\}$ 上进行：\n    $$\n    \\gamma^{\\text{bi}}_{1 \\to 3}(f) = \\frac{|H_{31}(f)|^2}{|H_{31}(f)|^2 + |H_{33}(f)|^2}\n    $$\n\\end{enumerate}\n\n### 步骤 5：高估度量 $\\Delta$\n影响的高估程度通过二元和多元 DTF 值之间的差异来量化，该差异在频率网格上取平均。$\\gamma^{\\text{multi}}_{1 \\to 3}(f)$ 的分母包含非负项 $|H_{32}(f)|^2$，而 $\\gamma^{\\text{bi}}_{1 \\to 3}(f)$ 的分母中没有该项。因此，多元 DTF 的分母大于或等于二元 DTF 的分母。这意味着对于所有 $f$，都有 $\\gamma^{\\text{bi}}_{1 \\to 3}(f) \\ge \\gamma^{\\text{multi}}_{1 \\to 3}(f)$。\n\n平均差异 $\\Delta$ 定义为：\n$$\n\\Delta = \\frac{1}{M} \\sum_{m=1}^{M} \\left( \\gamma^{\\text{bi}}_{1 \\to 3}(f_m) - \\gamma^{\\text{multi}}_{1 \\to 3}(f_m) \\right)\n$$\n其中 $\\{f_m\\}$ 是在区间 $[0, 0.5]$（单位为每样本周期数）内的 $M=512$ 个频率的均匀网格。如果连接 $1 \\to 3$ 断开（$a_{12}=0$ 或 $a_{23}=0$），则 $H_{31}(f)=0$，这使得两种 DTF 度量都恒等于零。在这种情况下，差异为 $0$，因此 $\\Delta = 0$。\n\n### 步骤 6：计算算法\n每个参数集的最终算法如下：\n1.  解包参数 $(b_{11}, b_{22}, b_{33}, a_{12}, a_{23})$。\n2.  如果 $a_{12}=0$ 或 $a_{23}=0$，则结果为 $\\Delta = 0.0$。\n3.  否则，创建一个从 $f=0$ 到 $f=0.5$ 的包含 $M=512$ 个点的均匀频率网格。\n4.  对频率网格上的计算进行向量化。计算复指数向量 $z = e^{-j 2\\pi f}$。\n5.  使用步骤 2 中的解析公式计算向量 $H_{31}(f)$、$H_{32}(f)$ 和 $H_{33}(f)$。\n6.  计算模平方向量：$|H_{31}(f)|^2$、$|H_{32}(f)|^2$ 和 $|H_{33}(f)|^2$。\n7.  使用步骤 4 中的公式计算向量 $\\gamma^{\\text{multi}}_{1 \\to 3}(f)$ 和 $\\gamma^{\\text{bi}}_{1 \\to 3}(f)$。由于 $|b_{33}|  1$ 确保了 $H_{33}(f)$ 永不为零，因此分母不会为零。\n8.  计算逐元素差分向量 $\\gamma^{\\text{bi}}_{1 \\to 3}(f) - \\gamma^{\\text{multi}}_{1 \\to 3}(f)$。\n9.  计算该差分向量的平均值以获得 $\\Delta$ 的最终值。\n对提供的四个测试套件中的每一个都执行此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases.\n    It calculates the average difference between bivariate and multivariate\n    Directed Transfer Function (DTF) measures for a 3-node chain process.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (b11, b22, b33, a12, a23)\n    test_cases = [\n        (0.4, 0.4, 0.4, 0.5, 0.5),  # 1. Happy path\n        (0.4, 0.4, 0.4, 0.5, 0.0),  # 2. Broken chain\n        (0.7, 0.7, 0.7, 0.4, 0.4),  # 3. Strong memory\n        (0.2, 0.6, 0.8, 0.2, 0.5),  # 4. Heterogeneous dynamics\n    ]\n\n    results = []\n    for params in test_cases:\n        delta = calculate_dtf_difference(params)\n        results.append(delta)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\ndef calculate_dtf_difference(params, M=512):\n    \"\"\"\n    Calculates the average difference Delta for a given parameter set.\n    \n    Args:\n        params (tuple): A tuple of MVAR parameters (b11, b22, b33, a12, a23).\n        M (int): The number of frequency samples.\n    \n    Returns:\n        float: The calculated average difference Delta.\n    \"\"\"\n    b11, b22, b33, a12, a23 = params\n\n    # Per the model, the path 1-2-3 is required for H_31 to be non-zero.\n    # If a12 or a23 is zero, H_31 is zero, so both DTF measures are zero,\n    # and their difference is zero.\n    if a12 == 0.0 or a23 == 0.0:\n        return 0.0\n\n    # Create a uniform frequency grid from 0 to 0.5 cycles/sample.\n    freqs = np.linspace(0, 0.5, M)\n    \n    # Calculate the complex exponential vector z = exp(-j*2*pi*f).\n    z = np.exp(-1j * 2 * np.pi * freqs)\n\n    # Use analytical expressions for the elements of the transfer matrix H(f).\n    # This is a vectorized calculation over the entire frequency grid.\n    \n    # Denominators for individual H elements\n    D1 = 1.0 - b11 * z\n    D2 = 1.0 - b22 * z\n    D3 = 1.0 - b33 * z\n    \n    # Elements of the 3rd row of H(f), representing inflows to node 3.\n    H31 = (a12 * a23 * z**2) / (D1 * D2 * D3)\n    H32 = (a23 * z) / (D2 * D3)\n    H33 = 1.0 / D3\n    \n    # Calculate squared magnitudes of the transfer function elements.\n    H31_sq_mag = np.abs(H31)**2\n    H32_sq_mag = np.abs(H32)**2\n    H33_sq_mag = np.abs(H33)**2\n    \n    # Denominator for the multivariate DTF (all sources {1, 2, 3}).\n    denom_multi = H31_sq_mag + H32_sq_mag + H33_sq_mag\n    \n    # Denominator for the bivariate DTF (observed sources {1, 3}).\n    denom_bi = H31_sq_mag + H33_sq_mag\n\n    # The denominators cannot be zero because H33 is never zero due to the\n    # stability condition |b33|  1. So, a direct division is safe.\n    \n    # Calculate multivariate DTF for 1 - 3.\n    gamma_multi = H31_sq_mag / denom_multi\n    \n    # Calculate bivariate DTF for 1 - 3.\n    gamma_bi = H31_sq_mag / denom_bi\n    \n    # Calculate the difference at each frequency point.\n    differences = gamma_bi - gamma_multi\n    \n    # The final metric Delta is the average of these differences.\n    delta = np.mean(differences)\n    \n    return delta\n\nsolve()\n```"
        }
    ]
}