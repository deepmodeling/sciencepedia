{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握尖峰-场位相干性，我们必须首先理解其数学基础。本练习将引导您从第一性原理出发，为一个典型的神经活动模型推导相干性数值。通过解决这个问题，您将巩固对尖峰序列和局部场电位（LFP）的属性（例如放电率调制和信噪比）如何共同决定最终相干性度量的理解。",
            "id": "4194952",
            "problem": "在一个持续时间为 $T$ 的时段内，观测一个单通道局部场电位 (LFP) 信号和一个同时记录的尖峰序列，该时段包含频率 $f_0$ 的整数个周期（即，对于某个整数 $K \\geq 1$，有 $T = K/f_0$）。LFP被建模为\n$$y(t) = A \\cos\\!\\big(2\\pi f_0 t + \\psi\\big) + n(t),$$\n其中 $A>0$ 和 $\\psi \\in \\mathbb{R}$ 是常数，$n(t)$ 是一个零均值的宽平稳噪声过程，与尖峰序列无关，其功率谱密度 (PSD) $S_n(f)$ 在 $f_0$ 处是有限的。尖峰序列被建模为具有条件强度的一个非齐次泊松过程的实现\n$$\\lambda(t) = \\lambda_0 \\big[1 + m \\cos\\!\\big(2\\pi f_0 t + \\phi\\big)\\big],$$\n其中 $\\lambda_0>0$, $0 \\le m \\le 1$ 且 $\\phi \\in \\mathbb{R}$。\n\n定义有限时间傅里叶变换\n$$X_T(f) = \\int_{0}^{T} x(t) \\exp\\!\\big(-i 2\\pi f t\\big)\\, dt, \\quad Y_T(f) = \\int_{0}^{T} y(t) \\exp\\!\\big(-i 2\\pi f t\\big)\\, dt,$$\n其中 $x(t) = \\sum_k \\delta(t - t_k)$ 是尖峰序列，表示为在尖峰时刻 $\\{t_k\\}$ 的狄拉克δ函数的和。仅使用非齐次泊松过程和宽平稳噪声的基本性质，从第一性原理出发，推导在频率 $f_0$ 处的期望有限时间自谱和互谱，\n$$S_{xx}^{(T)}(f_0) = \\frac{1}{T}\\,\\mathbb{E}\\!\\big[|X_T(f_0)|^2\\big], \\quad S_{yy}^{(T)}(f_0) = \\frac{1}{T}\\,\\mathbb{E}\\!\\big[|Y_T(f_0)|^2\\big], \\quad S_{xy}^{(T)}(f_0) = \\frac{1}{T}\\,\\mathbb{E}\\!\\big[X_T(f_0) Y_T^*(f_0)\\big],$$\n然后推导有限时间幅值平方相干性\n$$\\gamma_T^2(f_0) = \\frac{\\big|S_{xy}^{(T)}(f_0)\\big|^2}{S_{xx}^{(T)}(f_0)\\, S_{yy}^{(T)}(f_0)}.$$\n\n你可以假设非齐次泊松过程的标准二阶矩恒等式，\n$$\\mathbb{E}\\!\\big[x(t)\\big] = \\lambda(t), \\quad \\mathbb{E}\\!\\big[x(t)\\, x(s)\\big] = \\lambda(t)\\, \\delta(t-s) + \\lambda(t)\\, \\lambda(s),$$\n以及宽平稳噪声的经过充分检验的关系式\n$$\\mathbb{E}\\!\\left[\\left|\\int_0^T n(t)\\, \\exp\\!\\big(-i 2\\pi f t\\big)\\, dt\\right|^2\\right] = T\\, S_n(f).$$\n\n将你的最终答案表示为一个关于 $\\lambda_0$, $m$, $A$, $T$ 和 $S_n(f_0)$ 的单一闭式解析表达式。不需要数值近似，也不需要单位，因为相干性是无量纲的。不要报告中间结果；只报告 $\\gamma_T^2(f_0)$ 的最终表达式作为你的答案。",
            "solution": "所述问题具有科学依据、是良定的、客观的且内部一致。这是一个计算神经科学中的标准理论问题，用于在规范模型下计算尖峰-场相干性。所有必要的参数、模型和恒等式都已提供。因此，该问题是有效的，并且可以推导出解。\n\n目标是计算定义如下的有限时间幅值平方相干性 $\\gamma_T^2(f_0)$：\n$$\n\\gamma_T^2(f_0) = \\frac{\\big|S_{xy}^{(T)}(f_0)\\big|^2}{S_{xx}^{(T)}(f_0)\\, S_{yy}^{(T)}(f_0)}\n$$\n这需要计算自谱 $S_{xx}^{(T)}(f_0)$ 和 $S_{yy}^{(T)}(f_0)$，以及互谱 $S_{xy}^{(T)}(f_0)$。\n\n1.  **尖峰序列自谱 $S_{xx}^{(T)}(f_0)$ 的计算**\n\n尖峰序列 $x(t)$ 的有限时间自谱由下式给出：\n$$\nS_{xx}^{(T)}(f_0) = \\frac{1}{T}\\,\\mathbb{E}\\!\\big[|X_T(f_0)|^2\\big] = \\frac{1}{T}\\,\\mathbb{E}\\!\\left[\\left(\\int_{0}^{T} x(t) \\exp\\!\\big(-i 2\\pi f_0 t\\big)\\, dt\\right) \\left(\\int_{0}^{T} x(s) \\exp\\!\\big(i 2\\pi f_0 s\\big)\\, ds\\right)\\right]\n$$\n根据期望的线性性质，我们可以将期望算子移到积分内部：\n$$\nS_{xx}^{(T)}(f_0) = \\frac{1}{T} \\int_{0}^{T} \\int_{0}^{T} \\mathbb{E}\\!\\big[x(t) x(s)\\big] \\exp\\!\\big(-i 2\\pi f_0 (t-s)\\big)\\, dt\\, ds\n$$\n使用提供的非齐次泊松过程二阶矩的恒等式 $\\mathbb{E}\\!\\big[x(t)\\, x(s)\\big] = \\lambda(t)\\, \\delta(t-s) + \\lambda(t)\\, \\lambda(s)$，我们将其代入表达式中：\n$$\nS_{xx}^{(T)}(f_0) = \\frac{1}{T} \\int_{0}^{T} \\int_{0}^{T} \\big(\\lambda(t)\\, \\delta(t-s) + \\lambda(t)\\, \\lambda(s)\\big) \\exp\\!\\big(-i 2\\pi f_0 (t-s)\\big)\\, dt\\, ds\n$$\n这可以分成两项。第一项涉及狄拉克δ函数 $\\delta(t-s)$，为：\n$$\n\\frac{1}{T} \\int_{0}^{T} \\int_{0}^{T} \\lambda(t)\\, \\delta(t-s) \\exp\\!\\big(-i 2\\pi f_0 (t-s)\\big)\\, ds\\, dt = \\frac{1}{T} \\int_{0}^{T} \\lambda(t) \\exp\\!\\big(-i 2\\pi f_0 (t-t)\\big)\\, dt = \\frac{1}{T} \\int_{0}^{T} \\lambda(t)\\, dt\n$$\n我们在区间 $[0, T]$ 上对条件强度 $\\lambda(t) = \\lambda_0 \\big[1 + m \\cos\\!\\big(2\\pi f_0 t + \\phi\\big)\\big]$ 进行积分。由于 $T=K/f_0$ 且 $K$ 为整数，余弦项在 $K$ 个完整周期上的积分为零。\n$$\n\\int_{0}^{T} \\lambda(t)\\, dt = \\int_{0}^{T} \\lambda_0 \\big[1 + m \\cos\\!\\big(2\\pi f_0 t + \\phi\\big)\\big]\\, dt = \\lambda_0 [t]_0^T + 0 = \\lambda_0 T\n$$\n因此，第一项的贡献为 $\\frac{1}{T}(\\lambda_0 T) = \\lambda_0$。\n\n第二项是：\n$$\n\\frac{1}{T} \\int_{0}^{T} \\int_{0}^{T} \\lambda(t)\\, \\lambda(s) \\exp\\!\\big(-i 2\\pi f_0 (t-s)\\big)\\, dt\\, ds = \\frac{1}{T} \\left|\\int_{0}^{T} \\lambda(t) \\exp\\!\\big(-i 2\\pi f_0 t\\big)\\, dt\\right|^2\n$$\n我们来计算这个积分，它是 $\\lambda(t)$ 在 $f_0$ 处的傅里叶变换，我们记为 $\\Lambda_T(f_0)$：\n$$\n\\Lambda_T(f_0) = \\int_{0}^{T} \\lambda_0 \\big[1 + m \\cos\\!\\big(2\\pi f_0 t + \\phi\\big)\\big] \\exp\\!\\big(-i 2\\pi f_0 t\\big)\\, dt\n$$\n使用欧拉公式 $\\cos(\\theta) = \\frac{1}{2}(\\exp(i\\theta) + \\exp(-i\\theta))$：\n$$\n\\Lambda_T(f_0) = \\lambda_0 \\int_{0}^{T} \\left[1 + \\frac{m}{2}\\left(\\exp\\!\\big(i(2\\pi f_0 t + \\phi)\\big) + \\exp\\!\\big(-i(2\\pi f_0 t + \\phi)\\big)\\right)\\right] \\exp\\!\\big(-i 2\\pi f_0 t\\big)\\, dt\n$$\n$$\n\\Lambda_T(f_0) = \\lambda_0 \\int_{0}^{T} \\left[\\exp\\!\\big(-i 2\\pi f_0 t\\big) + \\frac{m}{2}\\exp(i\\phi) + \\frac{m}{2}\\exp(-i\\phi)\\exp\\!\\big(-i 4\\pi f_0 t\\big)\\right] dt\n$$\n在区间 $[0, T]$ 上，其中 $T=K/f_0$，$\\exp(-i 2\\pi f_0 t)$ 和 $\\exp(-i 4\\pi f_0 t)$ 的积分为零。唯一非零的贡献来自常数项：\n$$\n\\Lambda_T(f_0) = \\lambda_0 \\left( \\frac{m}{2}\\exp(i\\phi) \\cdot T \\right) = \\frac{\\lambda_0 m T}{2} \\exp(i\\phi)\n$$\n因此，$S_{xx}^{(T)}(f_0)$ 的第二项是：\n$$\n\\frac{1}{T} |\\Lambda_T(f_0)|^2 = \\frac{1}{T} \\left|\\frac{\\lambda_0 m T}{2} \\exp(i\\phi)\\right|^2 = \\frac{1}{T} \\frac{\\lambda_0^2 m^2 T^2}{4} = \\frac{T}{4}\\lambda_0^2 m^2\n$$\n结合两项，尖峰序列自谱为：\n$$\nS_{xx}^{(T)}(f_0) = \\lambda_0 + \\frac{T}{4}\\lambda_0^2 m^2\n$$\n\n2.  **LFP自谱 $S_{yy}^{(T)}(f_0)$ 的计算**\n\nLFP自谱为 $S_{yy}^{(T)}(f_0) = \\frac{1}{T}\\,\\mathbb{E}\\!\\big[|Y_T(f_0)|^2\\big]$。首先，我们求 $Y_T(f_0)$：\n$$\nY_T(f_0) = \\int_{0}^{T} \\big(A \\cos\\!\\big(2\\pi f_0 t + \\psi\\big) + n(t)\\big) \\exp\\!\\big(-i 2\\pi f_0 t\\big)\\, dt\n$$\n这可以分为信号部分和噪声部分，$Y_T(f_0) = C_T(f_0) + N_T(f_0)$。信号部分是：\n$$\nC_T(f_0) = \\int_{0}^{T} A \\cos\\!\\big(2\\pi f_0 t + \\psi\\big) \\exp\\!\\big(-i 2\\pi f_0 t\\big)\\, dt = \\frac{A}{2} \\int_{0}^{T} \\big(\\exp(i(2\\pi f_0 t + \\psi)) + \\exp(-i(2\\pi f_0 t + \\psi))\\big) \\exp\\!\\big(-i 2\\pi f_0 t\\big)\\, dt\n$$\n$$\nC_T(f_0) = \\frac{A}{2} \\int_{0}^{T} \\big(\\exp(i\\psi) + \\exp(-i\\psi)\\exp(-i 4\\pi f_0 t)\\big)\\, dt = \\frac{A}{2} \\exp(i\\psi) T\n$$\n噪声部分是 $N_T(f_0) = \\int_{0}^{T} n(t) \\exp\\!\\big(-i 2\\pi f_0 t\\big)\\, dt$。\n现在我们计算幅值平方的期望：\n$$\n\\mathbb{E}\\!\\big[|Y_T(f_0)|^2\\big] = \\mathbb{E}\\!\\big[|C_T(f_0) + N_T(f_0)|^2\\big] = \\mathbb{E}\\!\\big[|C_T(f_0)|^2 + C_T(f_0)N_T^*(f_0) + C_T^*(f_0)N_T(f_0) + |N_T(f_0)|^2\\big]\n$$\n由于 $C_T(f_0)$ 是确定性的，而 $n(t)$ 是一个零均值过程，所以 $\\mathbb{E}[N_T(f_0)]=0$，因此交叉项为零。我们剩下：\n$$\n\\mathbb{E}\\!\\big[|Y_T(f_0)|^2\\big] = |C_T(f_0)|^2 + \\mathbb{E}\\!\\big[|N_T(f_0)|^2\\big]\n$$\n第一项是 $|C_T(f_0)|^2 = \\left|\\frac{A T}{2} \\exp(i\\psi)\\right|^2 = \\frac{A^2 T^2}{4}$。对于第二项，我们使用提供的恒等式 $\\mathbb{E}\\!\\big[|N_T(f_0)|^2\\big] = T S_n(f_0)$。\n$$\n\\mathbb{E}\\!\\big[|Y_T(f_0)|^2\\big] = \\frac{A^2 T^2}{4} + T S_n(f_0)\n$$\n因此，LFP自谱为：\n$$\nS_{yy}^{(T)}(f_0) = \\frac{1}{T} \\left(\\frac{A^2 T^2}{4} + T S_n(f_0)\\right) = \\frac{T A^2}{4} + S_n(f_0)\n$$\n\n3.  **互谱 $S_{xy}^{(T)}(f_0)$ 的计算**\n\n互谱是 $S_{xy}^{(T)}(f_0) = \\frac{1}{T}\\,\\mathbb{E}\\!\\big[X_T(f_0) Y_T^*(f_0)\\big]$。\n$$\nS_{xy}^{(T)}(f_0) = \\frac{1}{T} \\mathbb{E}\\!\\big[X_T(f_0) (C_T^*(f_0) + N_T^*(f_0))\\big] = \\frac{1}{T} \\big(\\mathbb{E}\\!\\big[X_T(f_0)C_T^*(f_0)\\big] + \\mathbb{E}\\!\\big[X_T(f_0)N_T^*(f_0)\\big]\\big)\n$$\n尖峰序列 $x(t)$ 和噪声 $n(t)$ 是独立的。因此，它们乘积的期望等于它们期望的乘积：$\\mathbb{E}\\!\\big[X_T(f_0)N_T^*(f_0)\\big] = \\mathbb{E}[X_T(f_0)] \\mathbb{E}[N_T^*(f_0)]$。由于 $n(t)$ 是零均值的，$\\mathbb{E}[N_T^*(f_0)]=0$，所以这一整项为零。\n我们剩下第一项。由于 $C_T^*(f_0)$ 是确定性的：\n$$\nS_{xy}^{(T)}(f_0) = \\frac{1}{T} \\mathbb{E}[X_T(f_0)] C_T^*(f_0)\n$$\n我们需要 $\\mathbb{E}[X_T(f_0)]$：\n$$\n\\mathbb{E}[X_T(f_0)] = \\mathbb{E}\\!\\left[\\int_{0}^{T} x(t) \\exp\\!\\big(-i 2\\pi f_0 t\\big)\\, dt\\right] = \\int_{0}^{T} \\mathbb{E}[x(t)] \\exp\\!\\big(-i 2\\pi f_0 t\\big)\\, dt = \\int_{0}^{T} \\lambda(t) \\exp\\!\\big(-i 2\\pi f_0 t\\big)\\, dt\n$$\n这正是 $\\Lambda_T(f_0)$，我们已经计算出它为 $\\frac{\\lambda_0 m T}{2} \\exp(i\\phi)$。LFP信号分量的复共轭是 $C_T^*(f_0) = \\frac{A T}{2} \\exp(-i\\psi)$。\n将这些代入：\n$$\nS_{xy}^{(T)}(f_0) = \\frac{1}{T} \\left( \\frac{\\lambda_0 m T}{2} \\exp(i\\phi) \\right) \\left( \\frac{A T}{2} \\exp(-i\\psi) \\right) = \\frac{T \\lambda_0 m A}{4} \\exp\\!\\big(i(\\phi - \\psi)\\big)\n$$\n\n4.  **幅值平方相干性 $\\gamma_T^2(f_0)$ 的计算**\n\n我们组合成最终的表达式。我们需要 $|S_{xy}^{(T)}(f_0)|^2$：\n$$\n|S_{xy}^{(T)}(f_0)|^2 = \\left| \\frac{T \\lambda_0 m A}{4} \\exp\\!\\big(i(\\phi - \\psi)\\big) \\right|^2 = \\frac{T^2 \\lambda_0^2 m^2 A^2}{16}\n$$\n现在，我们构建相干性：\n$$\n\\gamma_T^2(f_0) = \\frac{|S_{xy}^{(T)}(f_0)|^2}{S_{xx}^{(T)}(f_0)\\, S_{yy}^{(T)}(f_0)} = \\frac{\\frac{T^2 \\lambda_0^2 m^2 A^2}{16}}{ \\left(\\lambda_0 + \\frac{T}{4}\\lambda_0^2 m^2\\right) \\left(S_n(f_0) + \\frac{T}{4} A^2\\right) }\n$$\n为了简化，我们从分母中提取公因式：\n$$\nS_{xx}^{(T)}(f_0) = \\frac{T \\lambda_0^2 m^2}{4} \\left(\\frac{4 \\lambda_0}{T \\lambda_0^2 m^2} + 1\\right) = \\frac{T \\lambda_0^2 m^2}{4} \\left(\\frac{4}{T \\lambda_0 m^2} + 1\\right)\n$$\n$$\nS_{yy}^{(T)}(f_0) = \\frac{T A^2}{4} \\left(\\frac{4 S_n(f_0)}{T A^2} + 1\\right)\n$$\n乘积为：\n$$\nS_{xx}^{(T)}(f_0)\\, S_{yy}^{(T)}(f_0) = \\left(\\frac{T \\lambda_0^2 m^2}{4}\\right) \\left(\\frac{T A^2}{4}\\right) \\left(1 + \\frac{4}{T \\lambda_0 m^2}\\right) \\left(1 + \\frac{4 S_n(f_0)}{T A^2}\\right) = \\frac{T^2 \\lambda_0^2 m^2 A^2}{16} \\left(1 + \\frac{4}{T \\lambda_0 m^2}\\right) \\left(1 + \\frac{4 S_n(f_0)}{T A^2}\\right)\n$$\n将此代入相干性公式，前置因子被消掉：\n$$\n\\gamma_T^2(f_0) = \\frac{\\frac{T^2 \\lambda_0^2 m^2 A^2}{16}}{\\frac{T^2 \\lambda_0^2 m^2 A^2}{16} \\left(1 + \\frac{4}{T \\lambda_0 m^2}\\right) \\left(1 + \\frac{4 S_n(f_0)}{T A^2}\\right)} = \\frac{1}{\\left(1 + \\frac{4}{T \\lambda_0 m^2}\\right) \\left(1 + \\frac{4 S_n(f_0)}{T A^2}\\right)}\n$$",
            "answer": "$$\n\\boxed{\\frac{1}{\\left(1 + \\frac{4}{T \\lambda_0 m^2}\\right) \\left(1 + \\frac{4 S_n(f_0)}{T A^2}\\right)}}\n$$"
        },
        {
            "introduction": "标准的尖峰-场位相干性（SFC）可能同时受到尖峰与LFP之间相位关系和振幅协同调制的影响。本练习通过研究一个“振幅归一化”的SFC版本来探讨一个关键的区别，该版本分离了锁相的贡献。这个推导将揭示该度量（也称为锁相值，PLV）与底层相位调制强度之间的直接关系，从而阐明不同尖峰-场耦合度量的解释。",
            "id": "4194924",
            "problem": "考虑一个局部场电位 (LFP) 窄带信号，该信号通过围绕中心频率 $f_{0}$ 进行带通滤波，并通过希尔伯特变换转换为其解析表示 $z(t) = A(t)\\exp(i\\phi(t))$，其中 $A(t) \\ge 0$ 是瞬时振幅（包络），$\\phi(t)$ 是瞬时相位。假设采用以下生成模型进行尖峰发放：尖峰源于一个非齐次泊松过程，其条件强度为\n$$\n\\lambda(t) = \\lambda_{0}\\left[1 + r \\cos\\big(\\phi(t) - \\phi_{0}\\big)\\right],\n$$\n其中 $0 \\le r \\le 1$ 是一个相位调制强度参数，$\\phi_{0} \\in [0,2\\pi)$ 是一个偏好相位。假设 $A(t)$ 在统计上独立于 $\\phi(t)$，并且在给定 $\\phi(t)$ 的情况下独立于尖峰过程，并且在没有尖峰调制的情况下，$\\phi(t)$ 在 $[0,2\\pi)$ 上均匀分布。通过点过程与 LFP 之间的归一化互谱的模值来定义频率 $f_{0}$ 处的尖峰-场相干性 (SFC)。在估计 SFC 之前，不使用原始解析信号 $z(t)$，而是考虑通过定义 $y(t) = \\exp(i\\phi(t))$ 来进行振幅归一化以移除 $A(t)$。\n\n从上述假设以及相干性和条件强度的核心定义出发，推导振幅归一化如何影响 SFC 的模值以及相对于仅考虑相位的度量（如锁相值 PLV）的结果可解释性。在这些假设下，提供一个频率为 $f_{0}$ 的振幅归一化 SFC 模值的封闭形式表达式，该表达式纯粹以相位调制强度 $r$ 来表示。您的最终答案必须是单个解析表达式。不需要四舍五入，表达式中不应包含单位。",
            "solution": "该问题要求针对给定的神经元尖峰发放生成模型，推导振幅归一化的尖峰-场相干性 (SFC)。它还要求讨论这种归一化如何影响可解释性。\n\n首先，让我们验证问题陈述。\n\n### 第1步：提取给定条件\n- LFP 解析信号：$z(t) = A(t)\\exp(i\\phi(t))$，其中 $A(t) \\ge 0$ 是瞬时振幅，$\\phi(t)$ 是瞬时相位。\n- 尖峰生成模型：一个非齐次泊松过程，其条件强度为 $\\lambda(t) = \\lambda_{0}\\left[1 + r \\cos\\big(\\phi(t) - \\phi_{0}\\big)\\right]$。\n- 参数：$\\lambda_{0}$ 是基线发放率，$0 \\le r \\le 1$ 是相位调制强度，$\\phi_{0} \\in [0,2\\pi)$ 是偏好相位。\n- 假设：\n    1. $A(t)$ 在统计上独立于 $\\phi(t)$。\n    2. 在给定 $\\phi(t)$ 的情况下，$A(t)$ 在统计上独立于尖峰过程。\n    3. $\\phi(t)$ 的边际分布在 $[0,2\\pi)$ 上是均匀的。\n- 步骤：通过使用信号 $y(t) = \\exp(i\\phi(t))$ 进行 SFC 估计来执行振幅归一化。\n- 目标：推导频率 $f_{0}$ 处的振幅归一化 SFC 的模值，作为 $r$ 的函数。\n\n### 第2步：使用提取的给定条件进行验证\n该问题具有科学依据，使用了计算神经科学中的标准模型（解析信号、非齐次泊松过程、发放率的余弦调制）。问题陈述清晰，具有足够的假设以允许唯一推导。语言客观、精确。该问题未违反任何无效性标准。\n\n### 第3步：结论与行动\n问题有效。将提供完整的推导过程。\n\n### 推导\n尖峰-场相干性 (SFC) 定义为尖峰序列点过程（我们将其表示为 $S(t)$）与局部场电位 (LFP) 之间的归一化互谱的模。问题指定使用振幅归一化的 LFP 信号 $y(t) = \\exp(i\\phi(t))$ 进行计算。通过移除振幅信息 $A(t)$，得到的度量不再对发放率和 LFP 振幅之间的相关性敏感。相反，它专门测量尖峰和 LFP 振荡之间相位关系的一致性。这个量被称为锁相值 (PLV)，或平均合向量的长度。\n\nPLV 定义为在每个尖峰时刻 $t_k$ 评估的复相位向量 $\\exp(i\\phi_k)$ 的期望值的模：\n$$\n\\text{PLV} = \\left| \\mathbb{E}_{\\text{spikes}}\\left[ \\exp(i\\phi(t_k)) \\right] \\right|\n$$\n在问题的假设下，感兴趣频率 $f_0$ 处的振幅归一化 SFC 等同于 PLV。\n$$\n\\text{SFC}_{\\text{norm}} = \\text{PLV}\n$$\n对于一个条件强度函数为 $\\lambda(t)$ 的非齐次泊松过程，任意函数 $g(t)$ 在尖峰时刻的期望可以通过以下关系找到：\n$$\n\\mathbb{E}_{\\text{spikes}}\\left[ g(t_k) \\right] = \\frac{\\mathbb{E}_{t}\\left[ \\lambda(t) g(t) \\right]}{\\mathbb{E}_{t}\\left[ \\lambda(t) \\right]}\n$$\n在我们的例子中，函数是 $g(t) = \\exp(i\\phi(t))$。我们需要计算分子和分母。期望是基于相位 $\\phi(t)$ 的分布计算的，根据假设，该相位在 $[0, 2\\pi)$ 上均匀分布，因此 $p(\\phi) = 1/(2\\pi)$。\n\n首先，我们计算分母，即平均发放率 $\\bar{\\lambda}$：\n$$\n\\mathbb{E}_{t}\\left[ \\lambda(t) \\right] = \\mathbb{E}_{\\phi}\\left[ \\lambda_{0}\\left(1 + r \\cos(\\phi - \\phi_{0})\\right) \\right]\n$$\n$$\n= \\int_{0}^{2\\pi} \\lambda_{0}\\left(1 + r \\cos(\\phi - \\phi_{0})\\right) \\frac{d\\phi}{2\\pi}\n$$\n$$\n= \\frac{\\lambda_{0}}{2\\pi} \\left[ \\int_{0}^{2\\pi} 1 \\, d\\phi + r \\int_{0}^{2\\pi} \\cos(\\phi - \\phi_{0}) \\, d\\phi \\right]\n$$\n余弦函数在一个完整周期内的积分为 $0$。因此，\n$$\n\\mathbb{E}_{t}\\left[ \\lambda(t) \\right] = \\frac{\\lambda_{0}}{2\\pi} \\left[ 2\\pi + 0 \\right] = \\lambda_{0}\n$$\n\n接下来，我们计算分子 $\\mathbb{E}_{t}\\left[ \\lambda(t) \\exp(i\\phi(t)) \\right]$：\n$$\n\\mathbb{E}_{t}\\left[ \\lambda(t) \\exp(i\\phi(t)) \\right] = \\mathbb{E}_{\\phi}\\left[ \\lambda_{0}\\left(1 + r \\cos(\\phi - \\phi_{0})\\right) \\exp(i\\phi) \\right]\n$$\n我们使用欧拉公式 $\\cos(\\theta) = \\frac{1}{2}(\\exp(i\\theta) + \\exp(-i\\theta))$ 来重写余弦项：\n$$\n\\cos(\\phi - \\phi_{0}) = \\frac{1}{2}\\left( \\exp(i(\\phi - \\phi_{0})) + \\exp(-i(\\phi - \\phi_{0})) \\right)\n$$\n将此代入期望积分中：\n$$\n\\text{Numerator} = \\int_{0}^{2\\pi} \\lambda_{0}\\left[1 + \\frac{r}{2}\\left( \\exp(i(\\phi - \\phi_{0})) + \\exp(-i(\\phi - \\phi_{0})) \\right)\\right] \\exp(i\\phi) \\frac{d\\phi}{2\\pi}\n$$\n$$\n= \\frac{\\lambda_{0}}{2\\pi} \\int_{0}^{2\\pi} \\left[ \\exp(i\\phi) + \\frac{r}{2}\\exp(i(\\phi - \\phi_{0}))\\exp(i\\phi) + \\frac{r}{2}\\exp(-i(\\phi - \\phi_{0}))\\exp(i\\phi) \\right] d\\phi\n$$\n$$\n= \\frac{\\lambda_{0}}{2\\pi} \\int_{0}^{2\\pi} \\left[ \\exp(i\\phi) + \\frac{r}{2}\\exp(i(2\\phi - \\phi_{0})) + \\frac{r}{2}\\exp(i\\phi_{0}) \\right] d\\phi\n$$\n我们逐项计算积分。对于任何非零整数 $k$，$\\exp(ik\\phi)$ 在 $[0, 2\\pi]$ 上的积分为 $0$。\n$$\n\\int_{0}^{2\\pi} \\exp(i\\phi) \\, d\\phi = 0\n$$\n$$\n\\int_{0}^{2\\pi} \\frac{r}{2}\\exp(i(2\\phi - \\phi_{0})) \\, d\\phi = \\frac{r}{2}\\exp(-i\\phi_{0}) \\int_{0}^{2\\pi} \\exp(i2\\phi) \\, d\\phi = 0\n$$\n唯一非零的贡献来自常数项 $\\frac{r}{2}\\exp(i\\phi_{0})$：\n$$\n\\int_{0}^{2\\pi} \\frac{r}{2}\\exp(i\\phi_{0}) \\, d\\phi = \\frac{r}{2}\\exp(i\\phi_{0}) \\cdot (2\\pi)\n$$\n因此，分子是：\n$$\n\\text{Numerator} = \\frac{\\lambda_{0}}{2\\pi} \\left[ 0 + 0 + \\frac{r}{2}\\exp(i\\phi_{0}) \\cdot 2\\pi \\right] = \\frac{\\lambda_{0} r}{2} \\exp(i\\phi_{0})\n$$\n\n现在我们可以计算平均合向量：\n$$\n\\mathbb{E}_{\\text{spikes}}\\left[ \\exp(i\\phi_k) \\right] = \\frac{\\frac{\\lambda_{0} r}{2} \\exp(i\\phi_{0})}{\\lambda_{0}} = \\frac{r}{2} \\exp(i\\phi_{0})\n$$\n振幅归一化的 SFC 是这个复数的模：\n$$\n\\text{SFC}_{\\text{norm}} = \\text{PLV} = \\left| \\frac{r}{2} \\exp(i\\phi_{0}) \\right| = \\frac{r}{2} \\left| \\exp(i\\phi_{0}) \\right| = \\frac{r}{2}\n$$\n因为 $|\\exp(i\\phi_{0})| = 1$。\n\n关于可解释性，标准的 SFC 混合了两种效应：纯粹的锁相（尖峰出现在一致的 LFP 相位上）和振幅共调制（发放率随 LFP 振幅变化）。例如，如果尖峰倾向于只在高振幅 LFP 周期中发生，即使锁相很弱，也可能导致高 SFC。通过将 LFP 解析信号 $z(t)$ 归一化为 $y(t) = z(t)/|z(t)| = \\exp(i\\phi(t))$，振幅信息被丢弃。由此产生的度量，即振幅归一化的 SFC，对振幅共调制不再敏感，并简化为纯粹的锁相度量，即 PLV。在给定模型下，该值与相位调制强度参数 $r$ 成正比，提供了清晰而直接的解释。\n\n最终结果是频率为 $f_{0}$ 的振幅归一化 SFC 的模的一个封闭形式表达式，该表达式纯粹以相位调制强度 $r$ 表示。",
            "answer": "$$\\boxed{\\frac{r}{2}}$$"
        },
        {
            "introduction": "除了测量静态耦合，神经科学的一个关键目标是推断神经信号之间的方向性影响。这个编码练习要求您实现一个格兰杰因果检验，以确定尖峰时间是否能预测性地引起未来的LFP波动。通过从头开始构建仿真和统计检验，您将在实际的神经科学背景下获得拟合混合自回归模型和应用假设检验的动手经验。",
            "id": "4194915",
            "problem": "考虑一个连续值的局部场电位（LFP）时间序列和一个表示为点过程、同时记录的脉冲序列。设 LFP 以秒为单位的固定采样间隔 $\\Delta t$ 进行离散时间采样。脉冲序列是一个二元序列，其中 $1$ 表示在大小为 $\\Delta t$ 的时间窗内至少有一次脉冲，否则为 $0$。任务是构建一个检验，判断脉冲时间是否 Granger 引起未来的 LFP 波动，即判断包含过去的脉冲时间是否能比仅用过去的 LFP 更好地预测未来的 LFP。此检验需使用一种混合公式，该公式既考虑了脉冲的点过程结构，也考虑了 LFP 的线性自回归结构。程序必须以逻辑和数学上严谨的方式实现此检验，从核心定义和经过充分检验的建模假设出发，而不是依赖于预先指定的简化公式。\n\n您将严格按照规格和单位实现以下内容：\n\n1. 仿真模型。为时间索引 $t = 1,2,\\ldots,N$ 生成合成配对数据 $(x_t, s_t)$，其中 $x_t$ 是 LFP，$s_t \\in \\{0,1\\}$ 是时间窗 $t$ 中的脉冲指示符。LFP 使用二阶自回归作为基础，并通过将过去的脉冲与一个因果核进行卷积来注入因果脉冲历史效应。具体来说，将每个时间窗内的脉冲作为独立的伯努利事件抽取，成功概率为 $\\lambda \\Delta t$（这近似于一个速率为 $\\lambda$ 脉冲/秒的齐次泊松过程），并根据以下方式生成 LFP：\n- 一个系数为 $(a_1,a_2)$、加性零均值高斯噪声方差为 $\\sigma^2$ 的二阶自回归，\n- 加上一个与过去的脉冲历史（与一个在 $K$ 个滞后上的固定因果核卷积）成比例的加性因果项。\n所有基于时间的量都必须以秒为单位处理；离散时间窗大小为 $\\Delta t$ 秒。\n\n2. Granger 框架。为 LFP 构建两个嵌套的预测模型：\n- 受限模型仅使用最多滞后 $p$ 阶的过去 LFP 值来预测 $x_t$。\n- 完整模型使用相同的过去 LFP 值，并额外使用一组脉冲历史回归量，这些回归量编码了从滞后 $1$ 到 $K$ 的点过程脉冲时间。\n在高斯残差假设下（在此设置中，普通最小二乘法等价于最大似然），通过最大似然估计两个模型。为嵌套模型计算一个基于似然的检验统计量，并在由模型间参数差异决定的适当参考分布下获得一个 $p$ 值。零假设是脉冲对于预测的改善程度不超过过去的 LFP。\n\n3. 决策规则。使用显著性水平 $\\alpha = 0.01$。对于每个测试案例，返回一个布尔值，指示 $p$ 值是否严格小于 $\\alpha$，这意味着脉冲时间被认为在上述定义的意义上 Granger 引起 LFP。\n\n4. 测试套件。为以下构成测试套件的参数集实现该过程。所有时间单位均为秒，所有速率均为脉冲/秒。每个参数集是一个元组 $(N, \\Delta t, a_1, a_2, \\lambda, \\sigma, b, \\tau, K)$，其中：\n- $N$ 是要仿真的时间窗数量，\n- $\\Delta t$ 是时间窗宽度（秒），\n- $(a_1,a_2)$ 是 $p = 2$ 阶的自回归系数，\n- $\\lambda$ 是齐次脉冲速率（脉冲/秒），\n- $\\sigma$ 是添加到 LFP 的高斯噪声的标准差，\n- $b$ 是耦合幅度，用于缩放脉冲历史核对 LFP 的贡献，\n- $\\tau$ 是在仿真过程中用于形成因果脉冲历史贡献的指数核的时间常数（秒），\n- $K$ 是在仿真中和完整模型中用作回归量的脉冲历史滞后数。\n\n使用固定的随机种子以确保每次运行的输出是确定性的。测试套件的值为：\n- 案例 A: $(N = 20000, \\Delta t = 0.001, a_1 = 0.9, a_2 = -0.4, \\lambda = 5.0, \\sigma = 0.5, b = 0.6, \\tau = 0.01, K = 20)$。\n- 案例 B: $(N = 20000, \\Delta t = 0.001, a_1 = 0.9, a_2 = -0.4, \\lambda = 5.0, \\sigma = 0.5, b = 0.0, \\tau = 0.01, K = 20)$。\n- 案例 C: $(N = 800, \\Delta t = 0.001, a_1 = 0.9, a_2 = -0.4, \\lambda = 5.0, \\sigma = 0.5, b = 0.2, \\tau = 0.01, K = 20)$。\n- 案例 D: $(N = 5000, \\Delta t = 0.001, a_1 = 0.9, a_2 = -0.4, \\lambda = 10.0, \\sigma = 0.5, b = 1.0, \\tau = 0.005, K = 30)$。\n\n5. 输出格式。您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 $[r_A,r_B,r_C,r_D]$，其中每个 $r_\\cdot$ 是按上述顺序列出的相应案例的布尔结果。\n\n程序必须完全自包含，根据规范生成自己的合成数据，执行所描述的混合 Granger 检验，并以确切的最终输出格式返回四个案例的布尔决策。不允许外部输入。最终输出不包括物理单位，因为输出是布尔值；但是，所有内部计算都必须遵守上述单位。",
            "solution": "该问题要求实现一个统计检验，以确定一个点过程脉冲序列是否 Granger 因果影响一个连续的局部场电位（LFP）。这是计算神经科学中的一个标准问题，旨在评估脉冲时间的历史信息是否有助于提高对未来 LFP 值的预测，超越 LFP 自身历史信息的预测能力。解决方案将分三个主要阶段进行阐述：首先，概述 Granger 因果关系检验的理论框架；其次，指定数据仿真模型；第三，详细说明模型估计和假设检验的算法流程。\n\n### 1. Granger 因果关系的理论框架\n\nGranger 因果关系是基于预测的统计因果概念。如果时间序列 $S$ 的过去值包含有助于预测时间序列 $X$ 未来值的信息，并且这种预测优于仅使用 $X$ 的过去值所做的预测，则称 $S$ Granger 引起 $X$。\n\n设 LFP 时间序列表示为 $\\{x_t\\}_{t=1}^N$，分箱后的脉冲序列表示为 $\\{s_t\\}_{t=1}^N$，其中 $s_t \\in \\{0, 1\\}$。两者均以 $\\Delta t$ 秒的离散时间间隔进行采样。任务是检验零假设 $H_0$，即脉冲序列 $\\{s_t\\}$ 不 Granger 引起 LFP $\\{x_t\\}$。\n\n我们使用嵌套自回归模型来形式化这个问题。LFP 动态被建模为一个线性自回归过程。\n\n**受限模型：** 该模型仅使用其自身的过去值（最多滞后 $p$ 阶）来预测当前的 LFP 值 $x_t$。对于此问题，$p=2$。模型为：\n$$\nx_t = c_R + \\alpha_1 x_{t-1} + \\alpha_2 x_{t-2} + e_{R,t}\n$$\n其中 $c_R$ 是一个常数偏移量，$\\{\\alpha_1, \\alpha_2\\}$ 是自回归系数，$e_{R,t}$ 是预测误差（残差），假设为均值为 $0$、方差为 $\\sigma_R^2$ 的独立同分布（i.i.d.）高斯随机变量。\n\n**完整模型：** 该模型通过包含最多滞后 $K$ 阶的脉冲序列历史来扩展受限模型。模型为：\n$$\nx_t = c_F + \\beta_1 x_{t-1} + \\beta_2 x_{t-2} + \\sum_{k=1}^{K} \\gamma_k s_{t-k} + e_{F,t}\n$$\n其中 $c_F$，$\\{\\beta_1, \\beta_2\\}$ 和 $\\{\\gamma_k\\}_{k=1}^K$ 是模型系数，$e_{F,t}$ 是均值为 $0$、方差为 $\\sigma_F^2$ 的 i.i.d. 高斯残差。\n\n零假设 $H_0$ 对应于断言脉冲历史不提供额外的预测信息。在完整模型的背景下，这等价于所有脉冲历史系数均为零：\n$$\nH_0: \\gamma_1 = \\gamma_2 = \\dots = \\gamma_K = 0\n$$\n在 $H_0$ 下，完整模型简化为受限模型。\n\n为了检验这个假设，我们使用似然比检验（LRT），它适用于比较嵌套模型。假设残差为高斯分布，最大化似然等价于最小化残差平方和（SSR），这个过程称为普通最小二乘法（OLS）。设 $SSR_R$ 和 $SSR_F$ 分别为拟合的受限模型和完整模型的 SSR。LRT 统计量 $L$ 由下式给出：\n$$\nL = n_{\\text{obs}} \\ln \\left( \\frac{SSR_R}{SSR_F} \\right)\n$$\n其中 $n_{\\text{obs}}$ 是用于回归的观测数量。在零假设下，$L$ 渐近服从卡方分布 $\\chi^2(q)$，其中自由度 $q$ 等于完整模型中额外参数的数量。在这种情况下，$q = K$。\n\n然后，通过计算在 $\\chi^2(K)$ 分布下观测到至少与 $L$ 一样大的检验统计量的概率来得到 $p$ 值。如果此 $p$ 值小于所选的显著性水平 $\\alpha = 0.01$，我们拒绝 $H_0$，并得出脉冲序列 Granger 引起 LFP 的结论。\n\n### 2. 数据仿真模型\n\n为了测试该程序，我们必须首先生成已知真实情况的合成数据。仿真包括生成一对时间序列 $(x_t, s_t)$，其中 $t=1, \\dots, N$。\n\n**脉冲序列生成：** 脉冲序列是一个二元序列 $\\{s_t\\}$，其中 $s_t=1$ 表示在时间窗 $[t\\Delta t, (t+1)\\Delta t)$ 内有脉冲。这被建模为一系列独立的伯努利试验。在任何给定时间窗内出现脉冲的概率是 $p_{\\text{spike}} = \\lambda \\Delta t$，其中 $\\lambda$ 是以脉冲/秒为单位的平均脉冲速率。这可作为齐次泊松过程的离散时间近似，在 $\\Delta t$ 很小时有效。\n\n**LFP 生成：** LFP 时间序列 $\\{x_t\\}$ 是作为一个二阶自回归过程生成的，并带有一个表示来自脉冲历史的因果影响的附加项。生成方程为：\n$$\nx_t = a_1 x_{t-1} + a_2 x_{t-2} + (\\text{脉冲历史项})_t + \\epsilon_t\n$$\n其中 $\\{a_1, a_2\\}$ 是 AR 系数，$\\epsilon_t \\sim \\mathcal{N}(0, \\sigma^2)$ 是 i.i.d. 高斯噪声。\n\n脉冲历史项是过去脉冲与一个因果指数核的卷积，由耦合幅度 $b$ 缩放。该核的时间常数为 $\\tau$，并应用于过去 $K$ 个滞后。该项为：\n$$\n(\\text{脉冲历史项})_t = b \\sum_{k=1}^{K} h_k s_{t-k}\n$$\n其中离散核值为 $h_k = \\exp(-k \\Delta t / \\tau)$。在收集用于分析的 $N$ 个数据点之前，使用一个预烧期（burn-in period）来确保仿真过程达到稳态。\n\n### 3. 算法实现\n\n整个过程针对测试套件中提供的每组参数执行。固定的随机种子确保结果的确定性和可复现性。\n\n**步骤 1：数据生成**\n对于每个具有参数 $(N, \\Delta t, a_1, a_2, \\lambda, \\sigma, b, \\tau, K)$ 的测试案例：\n- 总共仿真 $N_{\\text{total}} = N + N_{\\text{burn-in}}$ 个时间点，其中 $N_{\\text{burn-in}}$ 是一个足够长的预烧期（例如，500 个时间窗）。\n- 从参数为 $p_{\\text{spike}} = \\lambda \\Delta t$ 的伯努利分布生成脉冲序列 $\\{s_t\\}_{t=1}^{N_{\\text{total}}}$。\n- 根据第 2 节中定义的生成方程迭代生成 LFP 时间序列 $\\{x_t\\}_{t=1}^{N_{\\text{total}}}$。\n- 丢弃两个时间序列的前 $N_{\\text{burn-in}}$ 个点。\n\n**步骤 2：通过 OLS 进行模型拟合**\n模型拟合使用最后的 $N$ 个数据点。设所需的最大滞后为 $m = \\max(p, K) = \\max(2, K)$。回归使用 $n_{\\text{obs}} = N - m$ 个观测值。\n- 响应向量为 $Y = [x_m, x_{m+1}, \\dots, x_{N-1}]^T$。\n- 构建受限模型的设计矩阵 $X_R \\in \\mathbb{R}^{n_{\\text{obs}} \\times (1+p)}$。第 $i$ 行对应于时间 $t=m+i$，由 $[1, x_{t-1}, x_{t-2}]$ 给出。\n- 构建完整模型的设计矩阵 $X_F \\in \\mathbb{R}^{n_{\\text{obs}} \\times (1+p+K)}$。第 $i$ 行是 $[1, x_{t-1}, x_{t-2}, s_{t-1}, \\dots, s_{t-K}]$。\n- 使用 OLS 估计两个模型的参数，通过 `numpy.linalg.lstsq` 进行数值稳健的计算。该函数还直接提供残差平方和（$SSR_R$ 和 $SSR_F$）。\n\n**步骤 3：假设检验**\n- 计算 LRT 统计量 $L = n_{\\text{obs}} \\ln(SSR_R / SSR_F)$。\n- 检验的自由度为 $q = K$。\n- $p$ 值计算为在 $L$ 处评估的 $\\chi^2(q)$ 分布的生存函数：$p = \\text{sf}(L, q)$。\n\n**步骤 4：决策**\n- 如果计算出的 $p$ 值严格小于显著性水平 $\\alpha = 0.01$，则拒绝零假设 $H_0$。如果 $p  0.01$，函数返回 `True`，否则返回 `False`。对所有四个测试案例重复此过程。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import chi2\n\ndef solve():\n    \"\"\"\n    Main function to run the Granger causality tests for the specified cases.\n    \"\"\"\n    # Set a fixed random seed for reproducibility.\n    np.random.seed(0)\n\n    # Test suite values:\n    # (N, delta_t, a1, a2, lambda_rate, sigma, b, tau, K)\n    test_cases = [\n        # Case A: Strong coupling, large N\n        (20000, 0.001, 0.9, -0.4, 5.0, 0.5, 0.6, 0.01, 20),\n        # Case B: No coupling (null case)\n        (20000, 0.001, 0.9, -0.4, 5.0, 0.5, 0.0, 0.01, 20),\n        # Case C: Weak coupling, small N\n        (800, 0.001, 0.9, -0.4, 5.0, 0.5, 0.2, 0.01, 20),\n        # Case D: Strong coupling, different K and tau\n        (5000, 0.001, 0.9, -0.4, 10.0, 0.5, 1.0, 0.005, 30),\n    ]\n\n    results = []\n    for params in test_cases:\n        decision = run_granger_test(params)\n        results.append(decision)\n\n    # Format the output as a list of booleans. Note that Python's bool `True`\n    # becomes lowercase `true` in many JSON/string contexts, but here we want\n    # the exact string representation matching the Python `str(bool)`.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_granger_test(params):\n    \"\"\"\n    Performs a single Granger causality test for a given set of parameters.\n\n    Args:\n        params (tuple): A tuple of simulation and model parameters\n                        (N, delta_t, a1, a2, lambda_rate, sigma, b, tau, K).\n\n    Returns:\n        bool: True if the null hypothesis is rejected, False otherwise.\n    \"\"\"\n    N, delta_t, a1, a2, lambda_rate, sigma, b, tau, K = params\n    p = 2  # AR order for LFP\n    alpha = 0.01 # Significance level\n\n    # --- 1. Data Simulation ---\n    burn_in = 500\n    N_total = N + burn_in\n\n    # Generate spike train as a Bernoulli process\n    spike_prob = lambda_rate * delta_t\n    s = np.random.binomial(1, spike_prob, N_total).astype(float)\n    \n    # Generate LFP time series\n    x = np.zeros(N_total)\n    noise = np.random.normal(0, sigma, N_total)\n\n    # Define the causal spike history kernel\n    kernel_lags = np.arange(1, K + 1)\n    spike_kernel = b * np.exp(-kernel_lags * delta_t / tau)\n\n    # Iteratively generate LFP data\n    for t in range(max(p, K), N_total):\n        # AR(p) component\n        ar_term = a1 * x[t-1] + a2 * x[t-2]\n        # Spike history component\n        spike_hist_term = np.sum(spike_kernel * s[t-K:t][::-1])\n        x[t] = ar_term + spike_hist_term + noise[t]\n        \n    # Discard burn-in period\n    x = x[burn_in:]\n    s = s[burn_in:]\n\n    # --- 2. Model Fitting and Testing ---\n    max_lag = max(p, K)\n    n_obs = N - max_lag\n    \n    # Create the response vector Y\n    Y = x[max_lag:]\n\n    # Create the design matrix for the restricted model (LFP lags only)\n    X_R = np.ones((n_obs, 1 + p))\n    for i in range(n_obs):\n        t = max_lag + i\n        X_R[i, 1:] = [x[t-1], x[t-2]]\n\n    # Create the design matrix for the full model (LFP + spike lags)\n    X_F = np.ones((n_obs, 1 + p + K))\n    for i in range(n_obs):\n        t = max_lag + i\n        X_F[i, 1:1+p] = [x[t-1], x[t-2]]\n        X_F[i, 1+p:] = s[t-K:t][::-1]\n\n    # Fit models and get Sum of Squared Residuals (SSR)\n    _, ssr_R_array, _, _ = np.linalg.lstsq(X_R, Y, rcond=None)\n    ssr_R = ssr_R_array[0]\n\n    _, ssr_F_array, _, _ = np.linalg.lstsq(X_F, Y, rcond=None)\n    ssr_F = ssr_F_array[0]\n    \n    # Check for valid SSR values. For nested models, SSR_R must be >= SSR_F.\n    # If SSR_F > SSR_R (due to numerical precision) or if SSR_F is zero, \n    # the test is invalid or implies no improvement.\n    if ssr_F = 0 or ssr_R  ssr_F:\n        return False\n\n    # Calculate Likelihood Ratio Test statistic\n    lrt_stat = n_obs * np.log(ssr_R / ssr_F)\n    \n    # Degrees of freedom is the number of extra parameters\n    df = K\n    \n    # Calculate the p-value from the chi-squared distribution\n    p_value = chi2.sf(lrt_stat, df)\n\n    # --- 3. Decision ---\n    return p_value  alpha\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}