{
    "hands_on_practices": [
        {
            "introduction": "Effective real-time brain-computer interfaces (BCIs) depend on the ability to distill meaningful information from complex neural signals under strict time constraints. A primary method for this is extracting features that represent the underlying neural state, such as the power of neural oscillations in specific frequency bands. This exercise  delves into the foundational signal processing technique used for this purpose: the Short-Time Fourier Transform (STFT). By deriving the properties of an analysis window, you will gain a deeper understanding of the fundamental trade-offs between temporal and spectral resolution, which are critical for designing robust feature extraction pipelines in any closed-loop system.",
            "id": "4188932",
            "problem": "Consider a closed-loop Brain-Computer Interface (BCI) that decodes neural oscillations in real time by extracting spectral features from microelectrode recordings using the Short-Time Fourier Transform (STFT). The continuous discrete-time neural signal is denoted by $x[n]$ sampled at rate $f_s$ samples per second. Features are computed on a sliding analysis window of length $N$ samples with hop size $H$ samples. The window function is a periodic Hamming window defined by $w[n] = \\alpha - \\beta \\cos\\!\\left(\\frac{2\\pi n}{N}\\right)$ for $n = 0,1,\\dots,N-1$, with constants $\\alpha = 0.54$ and $\\beta = 0.46$. The STFT at frame index $m$ and discrete frequency bin $k \\in \\{0,1,\\dots,N-1\\}$ is formed by the Discrete-Time Fourier Transform over the windowed segment $x[n+mH]w[n]$ evaluated at $\\omega_k = \\frac{2\\pi k}{N}$.\n\nStarting from the fundamental definitions of the STFT and of a window’s spectral energy, and using only identities that follow from the Discrete-Time Fourier Transform and Parseval’s theorem, derive the STFT feature map $F[m,k]$ that produces a normalized power estimate across frequency bins suitable for closed-loop decoding. Then, using the same foundational base, compute:\n\n1) The fundamental frequency resolution associated with the discrete Fourier analysis on a window of length $N$ (express this in Hertz).\n\n2) A leakage metric defined as the Equivalent Noise Bandwidth (ENBW) of the periodic Hamming window in Hertz, which is given by the ratio of the integrated squared magnitude of the window’s frequency response to the squared peak magnitude at zero frequency, converted to Hertz via the sampling rate.\n\nExpress all frequency-related quantities in Hertz and do not include units in the final boxed answer. Provide the final answer as a single row matrix containing, in order, the frequency resolution and the ENBW, each as a closed-form analytic expression in terms of $N$, $f_s$, $\\alpha$, and $\\beta$. No numerical approximation or rounding is required.",
            "solution": "The problem statement is first subjected to a validation procedure.\n\n### Step 1: Extract Givens\n-   **Signal**: Continuous discrete-time neural signal $x[n]$.\n-   **Sampling Rate**: $f_s$ samples per second.\n-   **Window Length**: $N$ samples.\n-   **Hop Size**: $H$ samples.\n-   **Window Function**: Periodic Hamming window, $w[n] = \\alpha - \\beta \\cos\\left(\\frac{2\\pi n}{N}\\right)$ for $n = 0,1,\\dots,N-1$.\n-   **Window Constants**: $\\alpha = 0.54$, $\\beta = 0.46$.\n-   **STFT Definition**: The Short-Time Fourier Transform (STFT) at frame $m$ and frequency bin $k$ is formed by the Discrete-Time Fourier Transform (DTFT) of the windowed segment $x[n+mH]w[n]$ evaluated at discrete frequencies $\\omega_k = \\frac{2\\pi k}{N}$ for $k \\in \\{0,1,\\dots,N-1\\}$.\n-   **Feature Map**: $F[m,k]$ is a normalized power estimate across frequency bins.\n-   **Task 1**: Derive the fundamental frequency resolution in Hertz.\n-   **Task 2**: Derive the Equivalent Noise Bandwidth (ENBW) of the periodic Hamming window in Hertz, defined as the ratio of the integrated squared magnitude of the window’s frequency response to the squared peak magnitude at zero frequency, converted to Hertz.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientific or Factual Unsoundness**: The problem is scientifically sound. It is based on established principles of digital signal processing, specifically the Short-Time Fourier Transform (STFT) with a Hamming window, which are standard techniques in time-frequency analysis of signals like neural data.\n2.  **Non-Formalizable or Irrelevant**: The problem is formalizable and directly relevant to the analysis of neuroscience data for applications such as Brain-Computer Interfaces.\n3.  **Incomplete or Contradictory Setup**: The problem is self-contained. It provides all necessary symbolic variables ($N, f_s, \\alpha, \\beta$) and definitions to derive the requested quantities. The constants $\\alpha=0.54, \\beta=0.46$ are consistent with the common definition of a Hamming window.\n4.  **Unrealistic or Infeasible**: The setup is entirely realistic and describes a common practical implementation of real-time spectral analysis.\n5.  **Ill-Posed or Poorly Structured**: The problem is well-posed. The quantities to be derived—frequency resolution and Equivalent Noise Bandwidth—are uniquely defined and standard metrics in signal processing.\n6.  **Pseudo-Profound, Trivial, or Tautological**: The problem requires a substantive derivation based on foundational DSP theorems and identities. It is neither trivial nor artificially contrived.\n7.  **Outside Scientific Verifiability**: The derivations are purely mathematical and can be rigorously verified.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Solution Derivation\n\nThe analysis begins by formalizing the concepts outlined in the problem statement. The STFT of the signal $x[n]$ is given by the Discrete Fourier Transform (DFT) of windowed segments:\n$$\nX[m,k] = \\sum_{n=0}^{N-1} x[n+mH]w[n] e^{-j \\frac{2\\pi k n}{N}}\n$$\nwhere $m$ is the frame index and $k$ is the frequency bin index.\n\nThe problem asks to first derive a normalized power estimate $F[m,k]$. A physically meaningful power estimate can be derived from Parseval's theorem for the DFT. The energy of the windowed segment is:\n$$\nE_{seg} = \\sum_{n=0}^{N-1} |x[n+mH]w[n]|^2\n$$\nBy Parseval's theorem, this energy is related to the DFT coefficients by:\n$$\nE_{seg} = \\frac{1}{N} \\sum_{k=0}^{N-1} |X[m,k]|^2\n$$\nThe average power over the duration of the window, which is $T = N/f_s$ seconds, is the energy divided by the duration:\n$$\nP_{avg} = \\frac{E_{seg}}{T} = \\frac{f_s}{N} E_{seg} = \\frac{f_s}{N^2} \\sum_{k=0}^{N-1} |X[m,k]|^2\n$$\nThis total average power is distributed among the $N$ frequency bins. A logical definition for the power in a single bin $k$ is therefore:\n$$\nF[m,k] = \\frac{f_s}{N^2} |X[m,k]|^2\n$$\nThis represents a valid normalized power estimate suitable for a feature map.\n\n**1) Fundamental Frequency Resolution**\n\nThe DFT analyzes a signal of length $N$ at a set of discrete-time angular frequencies $\\omega_k = \\frac{2\\pi k}{N}$ for $k=0, 1, \\dots, N-1$. The relationship between the discrete-time angular frequency $\\omega$ (in radians per sample) and the continuous-time physical frequency $f$ (in Hertz) is $\\omega = 2\\pi f / f_s$.\n\nSubstituting this into the expression for $\\omega_k$, we find the physical frequency corresponding to each bin $k$:\n$$\n\\frac{2\\pi f_k}{f_s} = \\frac{2\\pi k}{N} \\implies f_k = k \\frac{f_s}{N}\n$$\nThe fundamental frequency resolution, denoted $\\Delta f$, is the spacing between adjacent frequency bins.\n$$\n\\Delta f = f_{k+1} - f_k = (k+1)\\frac{f_s}{N} - k\\frac{f_s}{N} = \\frac{f_s}{N}\n$$\nThis is the first requested quantity.\n\n**2) Equivalent Noise Bandwidth (ENBW)**\n\nThe ENBW is defined as the ratio of the integrated squared magnitude of the window’s frequency response to the squared peak magnitude at zero frequency, converted to Hertz.\n\nThe frequency response of the window $w[n]$ is its DTFT, $W(e^{j\\omega})$. The problem's reliance on the DFT implies we work with its samples, $W[k] = \\left. W(e^{j\\omega}) \\right|_{\\omega=2\\pi k/N} = \\sum_{n=0}^{N-1} w[n] e^{-j \\frac{2\\pi k n}{N}}$.\n\nThe \"integrated squared magnitude\" in the discrete frequency domain is the sum of the squared magnitudes of the DFT coefficients, $\\sum_{k=0}^{N-1} |W[k]|^2$. Using Parseval's theorem for the window itself:\n$$\n\\sum_{k=0}^{N-1} |W[k]|^2 = N \\sum_{n=0}^{N-1} |w[n]|^2\n$$\nThe \"peak magnitude at zero frequency\" corresponds to $k=0$:\n$$\nW[0] = \\sum_{n=0}^{N-1} w[n] e^0 = \\sum_{n=0}^{N-1} w[n]\n$$\nThe squared peak magnitude is $|W[0]|^2 = \\left(\\sum_{n=0}^{N-1} w[n]\\right)^2$.\n\nThe ENBW, in units of frequency bins, is the ratio:\n$$\n\\text{ENBW}_{\\text{bins}} = \\frac{\\sum_{k=0}^{N-1} |W[k]|^2}{|W[0]|^2} = \\frac{N \\sum_{n=0}^{N-1} w[n]^2}{\\left(\\sum_{n=0}^{N-1} w[n]\\right)^2}\n$$\nTo convert this to Hertz, we multiply by the frequency resolution (the width of one bin):\n$$\n\\text{ENBW}_{\\text{Hz}} = \\text{ENBW}_{\\text{bins}} \\times \\Delta f = \\frac{N \\sum_{n=0}^{N-1} w[n]^2}{\\left(\\sum_{n=0}^{N-1} w[n]\\right)^2} \\times \\frac{f_s}{N} = \\frac{f_s \\sum_{n=0}^{N-1} w[n]^2}{\\left(\\sum_{n=0}^{N-1} w[n]\\right)^2}\n$$\nNow, we must compute the sums for the periodic Hamming window $w[n] = \\alpha - \\beta \\cos\\left(\\frac{2\\pi n}{N}\\right)$. Let $S_1 = \\sum_{n=0}^{N-1} w[n]$ and $S_2 = \\sum_{n=0}^{N-1} w[n]^2$.\n\nCalculation of $S_1$:\n$$\nS_1 = \\sum_{n=0}^{N-1} \\left(\\alpha - \\beta \\cos\\left(\\frac{2\\pi n}{N}\\right)\\right) = \\sum_{n=0}^{N-1} \\alpha - \\beta \\sum_{n=0}^{N-1} \\cos\\left(\\frac{2\\pi n}{N}\\right)\n$$\nThe first term is $N\\alpha$. The second sum is over one full period of the cosine function. The sum of samples of a sinusoid over an integer number of periods is zero. This can be formally shown by representing the cosine as the real part of a complex exponential and summing the resulting geometric series, which equals zero assuming $N1$.\n$$\n\\sum_{n=0}^{N-1} \\cos\\left(\\frac{2\\pi n}{N}\\right) = \\text{Re}\\left(\\sum_{n=0}^{N-1} \\left(e^{j2\\pi/N}\\right)^n\\right) = \\text{Re}\\left(\\frac{1 - (e^{j2\\pi/N})^N}{1 - e^{j2\\pi/N}}\\right) = \\text{Re}\\left(\\frac{1 - e^{j2\\pi}}{1 - e^{j2\\pi/N}}\\right) = 0\n$$\nThus, $S_1 = N\\alpha$.\n\nCalculation of $S_2$:\n$$\nS_2 = \\sum_{n=0}^{N-1} \\left(\\alpha - \\beta \\cos\\left(\\frac{2\\pi n}{N}\\right)\\right)^2 = \\sum_{n=0}^{N-1} \\left(\\alpha^2 - 2\\alpha\\beta\\cos\\left(\\frac{2\\pi n}{N}\\right) + \\beta^2\\cos^2\\left(\\frac{2\\pi n}{N}\\right)\\right)\n$$\nWe can separate the terms:\n$$\nS_2 = \\sum_{n=0}^{N-1}\\alpha^2 - 2\\alpha\\beta\\sum_{n=0}^{N-1}\\cos\\left(\\frac{2\\pi n}{N}\\right) + \\beta^2\\sum_{n=0}^{N-1}\\cos^2\\left(\\frac{2\\pi n}{N}\\right)\n$$\nThe first term is $N\\alpha^2$. The second term is zero, as shown before. For the third term, we use the identity $\\cos^2(\\theta) = \\frac{1}{2}(1 + \\cos(2\\theta))$.\n$$\n\\sum_{n=0}^{N-1}\\cos^2\\left(\\frac{2\\pi n}{N}\\right) = \\sum_{n=0}^{N-1} \\frac{1}{2}\\left(1 + \\cos\\left(\\frac{4\\pi n}{N}\\right)\\right) = \\frac{1}{2}\\sum_{n=0}^{N-1} 1 + \\frac{1}{2}\\sum_{n=0}^{N-1}\\cos\\left(\\frac{2\\pi (2) n}{N}\\right)\n$$\nThe first part is $\\frac{N}{2}$. The second sum is over two full periods of a cosine, which is also zero (assuming $N2$, a condition always met in practice).\nThus, $\\sum_{n=0}^{N-1}\\cos^2\\left(\\frac{2\\pi n}{N}\\right) = \\frac{N}{2}$.\nSubstituting this back into the expression for $S_2$:\n$$\nS_2 = N\\alpha^2 + \\beta^2 \\left(\\frac{N}{2}\\right) = N\\left(\\alpha^2 + \\frac{\\beta^2}{2}\\right)\n$$\nFinally, we substitute $S_1$ and $S_2$ into the formula for $\\text{ENBW}_{\\text{Hz}}$:\n$$\n\\text{ENBW}_{\\text{Hz}} = \\frac{f_s S_2}{S_1^2} = \\frac{f_s N\\left(\\alpha^2 + \\frac{\\beta^2}{2}\\right)}{(N\\alpha)^2} = \\frac{f_s N\\left(\\alpha^2 + \\frac{\\beta^2}{2}\\right)}{N^2\\alpha^2} = \\frac{f_s}{N} \\frac{\\alpha^2 + \\frac{\\beta^2}{2}}{\\alpha^2}\n$$\nThis expression can be simplified to:\n$$\n\\text{ENBW}_{\\text{Hz}} = \\frac{f_s}{N} \\left(1 + \\frac{\\beta^2}{2\\alpha^2}\\right)\n$$\nThis is the second requested quantity, the ENBW in Hertz.\n\nThe final answer consists of the two derived expressions in the requested order.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{f_s}{N}  \\frac{f_s}{N} \\left( 1 + \\frac{\\beta^2}{2\\alpha^2} \\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Building a BCI decoder is only half the battle; we must also be able to reliably measure its performance, especially as it operates in real time. Standard metrics like accuracy can be deeply misleading in typical BCI scenarios, such as detecting a rare motor intent, where class imbalance is the norm. This practice  challenges you to confront this issue head-on by analyzing a streaming accuracy estimator. You will derive its inherent bias and then construct a calibrated, online performance metric that provides a much more faithful assessment of decoder performance, a crucial skill for developing and deploying effective BCIs.",
            "id": "4188866",
            "problem": "A binary decoder in a real-time Brain-Computer Interface (BCI) controls a closed-loop intervention by deciding at each time step whether a latent motor intent is present ($y=1$) or absent ($y=0$). The intervention is rare relative to rest, producing class imbalance. To evaluate performance online, the system maintains Exponentially Weighted Moving Average (EWMA) confusion counts with forgetting factor $\\lambda \\in (0,1)$:\n$$\n\\mathrm{TP}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 1,\\, y_{t-k} = 1\\right], \\quad\n\\mathrm{FP}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 1,\\, y_{t-k} = 0\\right],\n$$\n$$\n\\mathrm{FN}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 0,\\, y_{t-k} = 1\\right], \\quad\n\\mathrm{TN}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 0,\\, y_{t-k} = 0\\right].\n$$\nThe streaming accuracy estimator is defined as\n$$\n\\widehat{A}_{\\lambda}(t) = \\frac{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{FP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}.\n$$\nStarting from first principles, derive the expected value of $\\widehat{A}_{\\lambda}(t)$ under a stationary window characterized by a positive-class prior $\\,\\pi = \\mathbb{P}(y=1)\\,$, a true positive rate $\\,\\theta_{p} = \\mathbb{P}(\\hat{y}=1 \\mid y=1)\\,$, and a true negative rate $\\,\\theta_{n} = \\mathbb{P}(\\hat{y}=0 \\mid y=0)\\,$. Show the bias of $\\widehat{A}_{\\lambda}(t)$ relative to a class-prior invariant score that equally weights per-class hit rates, and then construct a streaming calibration scheme that replaces $\\widehat{A}_{\\lambda}(t)$ with an estimator of this class-prior invariant score using only the EWMA confusion counts.\n\nFinally, using the following realized EWMA counts at time $t$ with forgetting factor $\\lambda = 0.95$,\n$$\n\\mathrm{TP}_{\\lambda}(t) = 180.0,\\quad \\mathrm{FP}_{\\lambda}(t) = 60.0,\\quad \\mathrm{FN}_{\\lambda}(t) = 220.0,\\quad \\mathrm{TN}_{\\lambda}(t) = 1540.0,\n$$\ncompute the calibrated streaming score you derived. Round your answer to five significant figures. Express the final answer as a decimal in the unitless interval $[0,1]$.",
            "solution": "The problem will be addressed by first validating its premises and structure, then proceeding with a three-part solution: (1) deriving the expected value of the streaming accuracy estimator, (2) analyzing its bias and constructing a calibrated, class-prior invariant score estimator, and (3) computing the value of this calibrated score using the provided data.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n-   Binary latent state: $y \\in \\{0, 1\\}$, with $y=1$ (present) and $y=0$ (absent).\n-   Binary decoder prediction: $\\hat{y} \\in \\{0, 1\\}$.\n-   EWMA forgetting factor: $\\lambda \\in (0,1)$.\n-   EWMA confusion counts at time $t$:\n    -   True Positives: $\\mathrm{TP}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 1,\\, y_{t-k} = 1\\right]$\n    -   False Positives: $\\mathrm{FP}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 1,\\, y_{t-k} = 0\\right]$\n    -   False Negatives: $\\mathrm{FN}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 0,\\, y_{t-k} = 1\\right]$\n    -   True Negatives: $\\mathrm{TN}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 0,\\, y_{t-k} = 0\\right]$\n-   Streaming accuracy estimator definition: $\\widehat{A}_{\\lambda}(t) = \\frac{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{FP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}$.\n-   Stationary window characteristics:\n    -   Positive class prior: $\\pi = \\mathbb{P}(y=1)$\n    -   True positive rate (sensitivity): $\\theta_{p} = \\mathbb{P}(\\hat{y}=1 \\mid y=1)$\n    -   True negative rate (specificity): $\\theta_{n} = \\mathbb{P}(\\hat{y}=0 \\mid y=0)$\n-   Realized EWMA counts at a specific time $t$:\n    -   $\\mathrm{TP}_{\\lambda}(t) = 180.0$\n    -   $\\mathrm{FP}_{\\lambda}(t) = 60.0$\n    -   $\\mathrm{FN}_{\\lambda}(t) = 220.0$\n    -   $\\mathrm{TN}_{\\lambda}(t) = 1540.0$\n-   Forgetting factor value: $\\lambda = 0.95$.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded:** The problem uses standard definitions from machine learning and signal processing for evaluating binary classifiers in a streaming (online) setting. EWMA is a common technique for tracking performance over a moving window. The concepts of accuracy, true/false positive/negative rates, and class priors are fundamental to classification theory.\n-   **Well-Posed:** The problem is clearly structured and asks for specific derivations and a final calculation. The assumption of a stationary process (constant $\\pi$, $\\theta_p$, $\\theta_n$) makes the expectation calculation tractable and leads to a unique analytical solution.\n-   **Objective:** The problem is expressed with precise mathematical definitions and avoids any subjective or ambiguous language.\n-   **No Flaws Identified:** The problem is self-contained, consistent, and scientifically sound. It does not violate any of the invalidity criteria.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n### Solution Derivation\n\n**Part 1: Expected Value of the Streaming Accuracy Estimator**\n\nFirst, we analyze the denominator of $\\widehat{A}_{\\lambda}(t)$. Let this be $D_{\\lambda}(t)$.\n$$\nD_{\\lambda}(t) = \\mathrm{TP}_{\\lambda}(t) + \\mathrm{FP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)\n$$\nSubstituting the definitions of the EWMA counts:\n$$\nD_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^k \\left( \\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=1] + \\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=0] + \\mathbf{1}[\\hat{y}_{t-k}=0, y_{t-k}=1] + \\mathbf{1}[\\hat{y}_{t-k}=0, y_{t-k}=0] \\right)\n$$\nThe four events inside the indicator functions are mutually exclusive and exhaustive for any given time step $t-k$. Therefore, the sum of the indicator functions is always equal to $1$.\n$$\nD_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^k = \\frac{1}{1-\\lambda}\n$$\nThis is a deterministic constant, given $\\lambda$.\n\nNext, we find the expected value of the numerator, $N_{\\lambda}(t) = \\mathrm{TP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)$. Using the linearity of expectation:\n$$\n\\mathbb{E}[N_{\\lambda}(t)] = \\mathbb{E}[\\mathrm{TP}_{\\lambda}(t)] + \\mathbb{E}[\\mathrm{TN}_{\\lambda}(t)]\n$$\nWe need the expected value of each EWMA count. For $\\mathrm{TP}_{\\lambda}(t)$:\n$$\n\\mathbb{E}[\\mathrm{TP}_{\\lambda}(t)] = \\mathbb{E}\\left[\\sum_{k=0}^{\\infty} \\lambda^k \\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=1]\\right] = \\sum_{k=0}^{\\infty} \\lambda^k \\mathbb{E}[\\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=1]]\n$$\nThe expectation of an indicator function is the probability of the event it indicates. Under the stationary assumption, this probability is constant for all $k$.\n$$\n\\mathbb{E}[\\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=1]] = \\mathbb{P}(\\hat{y}=1, y=1) = \\mathbb{P}(\\hat{y}=1|y=1)\\mathbb{P}(y=1) = \\theta_p \\pi\n$$\nTherefore,\n$$\n\\mathbb{E}[\\mathrm{TP}_{\\lambda}(t)] = \\sum_{k=0}^{\\infty} \\lambda^k (\\theta_p \\pi) = (\\theta_p \\pi) \\sum_{k=0}^{\\infty} \\lambda^k = \\frac{\\theta_p \\pi}{1-\\lambda}\n$$\nSimilarly, for $\\mathrm{TN}_{\\lambda}(t)$:\n$$\n\\mathbb{P}(\\hat{y}=0, y=0) = \\mathbb{P}(\\hat{y}=0|y=0)\\mathbb{P}(y=0) = \\theta_n (1-\\pi)\n$$\n$$\n\\mathbb{E}[\\mathrm{TN}_{\\lambda}(t)] = \\frac{\\theta_n (1-\\pi)}{1-\\lambda}\n$$\nThe expected value of the numerator is then:\n$$\n\\mathbb{E}[N_{\\lambda}(t)] = \\frac{\\theta_p \\pi}{1-\\lambda} + \\frac{\\theta_n (1-\\pi)}{1-\\lambda} = \\frac{\\theta_p \\pi + \\theta_n (1-\\pi)}{1-\\lambda}\n$$\nSince the denominator $D_{\\lambda}(t)$ is a constant, the expected value of the estimator $\\widehat{A}_{\\lambda}(t)$ is the ratio of the expected numerator to the denominator:\n$$\n\\mathbb{E}[\\widehat{A}_{\\lambda}(t)] = \\frac{\\mathbb{E}[N_{\\lambda}(t)]}{D_{\\lambda}(t)} = \\frac{\\frac{\\theta_p \\pi + \\theta_n (1-\\pi)}{1-\\lambda}}{\\frac{1}{1-\\lambda}} = \\theta_p \\pi + \\theta_n (1-\\pi)\n$$\nThis is the standard formula for accuracy, confirming that the streaming estimator is an unbiased estimator of the latent process's true accuracy.\n\n**Part 2: Bias Analysis and Construction of a Calibrated Estimator**\n\nThe problem defines a \"class-prior invariant score that equally weights per-class hit rates.\" The per-class hit rates are the true positive rate, $\\theta_p$, and the true negative rate, $\\theta_n$. An equally weighted score is their arithmetic mean, which is the definition of Balanced Accuracy ($S_{BA}$).\n$$\nS_{BA} = \\frac{\\theta_p + \\theta_n}{2}\n$$\nThe bias of $\\widehat{A}_{\\lambda}(t)$ with respect to this score is the difference between their expected values:\n$$\n\\text{Bias} = \\mathbb{E}[\\widehat{A}_{\\lambda}(t)] - S_{BA} = \\left[ \\theta_p \\pi + \\theta_n (1-\\pi) \\right] - \\frac{\\theta_p + \\theta_n}{2}\n$$\n$$\n\\text{Bias} = \\theta_p \\left( \\pi - \\frac{1}{2} \\right) + \\theta_n \\left( 1 - \\pi - \\frac{1}{2} \\right) = \\theta_p \\left( \\pi - \\frac{1}{2} \\right) - \\theta_n \\left( \\pi - \\frac{1}{2} \\right)\n$$\n$$\n\\text{Bias} = (\\theta_p - \\theta_n)\\left(\\pi - \\frac{1}{2}\\right)\n$$\nThis shows that the accuracy estimator is biased relative to the balanced score whenever class priors are imbalanced ($\\pi \\neq 1/2$) and the per-class hit rates are unequal ($\\theta_p \\neq \\theta_n$). As the problem notes, the intervention is rare, meaning $\\pi$ is small, so $\\pi - 1/2$ is negative, leading to a significant bias.\n\nTo construct a streaming estimator for $S_{BA}$, we must first estimate $\\theta_p$ and $\\theta_n$ from the available EWMA counts. The definitions of $\\theta_p$ and $\\theta_n$ involve ratios of population counts:\n$$\n\\theta_p = \\frac{\\mathbb{P}(\\hat{y}=1, y=1)}{\\mathbb{P}(y=1)} = \\frac{\\mathbb{P}(\\text{TP})}{\\mathbb{P}(\\text{TP}) + \\mathbb{P}(\\text{FN})}, \\quad \\theta_n = \\frac{\\mathbb{P}(\\hat{y}=0, y=0)}{\\mathbb{P}(y=0)} = \\frac{\\mathbb{P}(\\text{TN})}{\\mathbb{P}(\\text{TN}) + \\mathbb{P}(\\text{FP})}\n$$\nWe can form estimators for $\\theta_p$ and $\\theta_n$ by replacing the true probabilities/counts with their EWMA counterparts. The EWMA counts $\\mathrm{TP}_{\\lambda}(t)$, etc., are weighted sums that act as proxies for the total counts in a recent time window.\nThe EWMA of the total number of positive instances is $\\mathrm{P}_{\\lambda}(t) = \\mathrm{TP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t)$.\nThe EWMA of the total number of negative instances is $\\mathrm{N}_{\\lambda}(t) = \\mathrm{FP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)$.\nThus, streaming estimators for the per-class hit rates are:\n$$\n\\hat{\\theta}_p(t) = \\frac{\\mathrm{TP}_{\\lambda}(t)}{\\mathrm{P}_{\\lambda}(t)} = \\frac{\\mathrm{TP}_{\\lambda}(t)}{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t)}\n$$\n$$\n\\hat{\\theta}_n(t) = \\frac{\\mathrm{TN}_{\\lambda}(t)}{\\mathrm{N}_{\\lambda}(t)} = \\frac{\\mathrm{TN}_{\\lambda}(t)}{\\mathrm{FP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}\n$$\nThe calibrated streaming score, which we denote $\\widehat{S}_{BA,\\lambda}(t)$, is the estimator for the Balanced Accuracy, constructed by substituting these estimators:\n$$\n\\widehat{S}_{BA,\\lambda}(t) = \\frac{\\hat{\\theta}_p(t) + \\hat{\\theta}_n(t)}{2} = \\frac{1}{2} \\left( \\frac{\\mathrm{TP}_{\\lambda}(t)}{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t)} + \\frac{\\mathrm{TN}_{\\lambda}(t)}{\\mathrm{FP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)} \\right)\n$$\nThis is the desired calibration scheme. It provides an online estimate of balanced accuracy, mitigating the bias caused by class imbalance.\n\n**Part 3: Numerical Calculation**\n\nWe are given the following realized EWMA counts at time $t$:\n$\\mathrm{TP}_{\\lambda}(t) = 180.0$\n$\\mathrm{FP}_{\\lambda}(t) = 60.0$\n$\\mathrm{FN}_{\\lambda}(t) = 220.0$\n$\\mathrm{TN}_{\\lambda}(t) = 1540.0$\n\nFirst, we compute the estimated per-class hit rates, $\\hat{\\theta}_p(t)$ and $\\hat{\\theta}_n(t)$:\n$$\n\\hat{\\theta}_p(t) = \\frac{180.0}{180.0 + 220.0} = \\frac{180.0}{400.0} = 0.45\n$$\n$$\n\\hat{\\theta}_n(t) = \\frac{1540.0}{60.0 + 1540.0} = \\frac{1540.0}{1600.0} = \\frac{154}{160} = \\frac{77}{80} = 0.9625\n$$\nNow, we compute the calibrated streaming score, $\\widehat{S}_{BA,\\lambda}(t)$:\n$$\n\\widehat{S}_{BA,\\lambda}(t) = \\frac{\\hat{\\theta}_p(t) + \\hat{\\theta}_n(t)}{2} = \\frac{0.45 + 0.9625}{2} = \\frac{1.4125}{2} = 0.70625\n$$\nThe problem requires the answer to be rounded to five significant figures. The calculated value $0.70625$ already has exactly five significant figures.",
            "answer": "$$\n\\boxed{0.70625}\n$$"
        },
        {
            "introduction": "The pinnacle of many BCI systems is closing the loop, where decoded neural activity is used to actively modulate either the brain itself through stimulation or an external device. This creates a complex, dynamic feedback system whose stability is a paramount concern. This capstone exercise  guides you through the core principles of designing and analyzing such a system using the Linear-Quadratic-Gaussian (LQG) framework. By deriving the conditions for closed-loop stability and implementing a complete controller-estimator system, you will master the concepts that ensure a BCI operates safely and effectively.",
            "id": "4188920",
            "problem": "You are given a discrete-time linear time-invariant neural population model driven by a stimulation input and observed through a linear measurement process. The plant dynamics and observation equations are modeled as follows: for each integer time index $t \\ge 0$,\n$x_{t+1} = A x_t + B u_t + w_t$ and $y_t = C x_t + v_t$,\nwhere $x_t \\in \\mathbb{R}^{n}$ is the neural state, $u_t \\in \\mathbb{R}^{m_u}$ is the stimulation amplitude delivered by the controller, $y_t \\in \\mathbb{R}^{m_y}$ is the observation, and $w_t \\in \\mathbb{R}^{n}$ and $v_t \\in \\mathbb{R}^{m_y}$ are independent zero-mean Gaussian noise processes with covariances $W \\in \\mathbb{S}_{+}^{n}$ and $V \\in \\mathbb{S}_{+}^{m_y}$, respectively. The controller has access only to the observation $y_t$ and uses a causal state estimate $\\hat{x}_t$ generated by a linear estimator. The controller modulates the stimulation amplitude linearly via $u_t = -K \\hat{x}_t$, where $K \\in \\mathbb{R}^{m_u \\times n}$ is a feedback gain to be designed based on a quadratic cost with state and input weights. The estimator is chosen to be a steady-state linear minimum variance estimator with gain $L \\in \\mathbb{R}^{n \\times m_y}$ derived from noise covariances $W$ and $V$.\n\nTask 1 (Derivation): Starting from the fundamental definitions of discrete-time linear systems, Gaussian noise, linear quadratic regulation, and linear minimum variance estimation, derive conditions under which the combined neurostimulation–decoder closed-loop system is exponentially stable in the mean (that is, the expected state norm decays to zero exponentially fast for zero-mean noise). In your derivation, express the closed-loop deterministic mean dynamics of the augmented system in terms of the estimated state and the estimation error. Then, derive a necessary and sufficient condition for exponential stability in terms of the spectral radii of matrices constructed from $A$, $B$, $C$, $K$, and $L$. Your derivation must be presented in mathematical form only, without resorting to any domain-specific heuristics.\n\nTask 2 (Algorithm Design): Design an algorithm that, for each given test case below, constructs:\n- A stabilizing linear quadratic regulator (LQR) state feedback gain $K$ by solving the discrete-time algebraic Riccati equation associated with a quadratic cost $\\sum_{t=0}^{\\infty} \\left( x_t^\\top Q_c x_t + u_t^\\top R_c u_t \\right)$, with given $Q_c \\in \\mathbb{S}_{+}^{n}$ and $R_c \\in \\mathbb{S}_{++}^{m_u}$.\n- A steady-state linear minimum variance estimator (Kalman filter) gain $L$ by solving the discrete-time algebraic Riccati equation associated with the dual estimation problem using $W$ and $V$.\n\nThen, evaluate the spectral radius conditions for closed-loop stability derived in Task 1. For each test case, output a boolean indicating whether the combined system is exponentially stable.\n\nTest Suite:\nProvide a program that uses the following four test cases. All matrices are given explicitly. In each case, $n = 2$.\n\n- Test case $1$ (happy path, stabilizable and detectable):\n  - $A = \\begin{bmatrix} 1.1  0.1 \\\\ 0.0  0.95 \\end{bmatrix}$,\n  - $B = \\begin{bmatrix} 0.1 \\\\ 0.05 \\end{bmatrix}$,\n  - $C = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix}$,\n  - $Q_c = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix}$,\n  - $R_c = \\begin{bmatrix} 0.1 \\end{bmatrix}$,\n  - $W = \\begin{bmatrix} 0.01  0.0 \\\\ 0.0  0.01 \\end{bmatrix}$,\n  - $V = \\begin{bmatrix} 0.05  0.0 \\\\ 0.0  0.05 \\end{bmatrix}$.\n\n- Test case $2$ (boundary case with a marginally unstable mode that is stabilized via coupling; detectable):\n  - $A = \\begin{bmatrix} 1.0  0.2 \\\\ 0.0  0.9 \\end{bmatrix}$,\n  - $B = \\begin{bmatrix} 0.0 \\\\ 1.0 \\end{bmatrix}$,\n  - $C = \\begin{bmatrix} 1.0  0.0 \\end{bmatrix}$,\n  - $Q_c = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix}$,\n  - $R_c = \\begin{bmatrix} 0.5 \\end{bmatrix}$,\n  - $W = \\begin{bmatrix} 0.02  0.0 \\\\ 0.0  0.02 \\end{bmatrix}$,\n  - $V = \\begin{bmatrix} 0.2 \\end{bmatrix}$.\n\n- Test case $3$ (not stabilizable: an unstable mode is uncontrollable):\n  - $A = \\begin{bmatrix} 1.2  0.0 \\\\ 0.0  0.9 \\end{bmatrix}$,\n  - $B = \\begin{bmatrix} 0.0 \\\\ 1.0 \\end{bmatrix}$,\n  - $C = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix}$,\n  - $Q_c = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix}$,\n  - $R_c = \\begin{bmatrix} 0.1 \\end{bmatrix}$,\n  - $W = \\begin{bmatrix} 0.01  0.0 \\\\ 0.0  0.01 \\end{bmatrix}$,\n  - $V = \\begin{bmatrix} 0.05  0.0 \\\\ 0.0  0.05 \\end{bmatrix}$.\n\n- Test case $4$ (not detectable: an unstable mode is unobservable):\n  - $A = \\begin{bmatrix} 1.1  0.0 \\\\ 0.0  0.95 \\end{bmatrix}$,\n  - $B = \\begin{bmatrix} 0.1 \\\\ 0.05 \\end{bmatrix}$,\n  - $C = \\begin{bmatrix} 0.0  1.0 \\end{bmatrix}$,\n  - $Q_c = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix}$,\n  - $R_c = \\begin{bmatrix} 0.1 \\end{bmatrix}$,\n  - $W = \\begin{bmatrix} 0.01  0.0 \\\\ 0.0  0.01 \\end{bmatrix}$,\n  - $V = \\begin{bmatrix} 0.05 \\end{bmatrix}$.\n\nAnswer specification:\n- Your program must compute, for each test case, the boolean indicating whether the combined closed-loop system with the designed $K$ and $L$ is exponentially stable in the mean, according to the stability conditions you derive in Task $1$.\n- The final output must be a single line containing the results as a comma-separated list enclosed in square brackets. For example, if there are four booleans $b_1,b_2,b_3,b_4$, then the program should print exactly the line $[b_1,b_2,b_3,b_4]$ with no additional text or whitespace differences.\n- There are no physical units in this problem; all quantities are dimensionless.",
            "solution": "The problem requires the derivation of stability conditions for a discrete-time Linear-Quadratic-Gaussian (LQG) control system and the subsequent design and analysis of such a system for several test cases. The analysis is predicated upon the fundamental principles of linear systems theory, optimal control, and state estimation.\n\n### **Validation of the Problem Statement**\n\n**Step 1: Extract Givens**\n\n*   **System Model (Plant Dynamics):** $x_{t+1} = A x_t + B u_t + w_t$, for integer time index $t \\ge 0$.\n*   **System Model (Observation):** $y_t = C x_t + v_t$.\n*   **State and Signal Dimensions:** $x_t \\in \\mathbb{R}^{n}$, $u_t \\in \\mathbb{R}^{m_u}$, $y_t \\in \\mathbb{R}^{m_y}$.\n*   **System Matrices:** $A \\in \\mathbb{R}^{n \\times n}$, $B \\in \\mathbb{R}^{n \\times m_u}$, $C \\in \\mathbb{R}^{m_y \\times n}$.\n*   **Noise Processes:** $w_t \\in \\mathbb{R}^{n}$ and $v_t \\in \\mathbb{R}^{m_y}$ are independent, zero-mean Gaussian processes with covariances $W \\in \\mathbb{S}_{+}^{n}$ and $V \\in \\mathbb{S}_{+}^{m_y}$, respectively. $\\mathbb{S}_{+}^{k}$ denotes the set of $k \\times k$ positive semi-definite matrices.\n*   **Controller:** $u_t = -K \\hat{x}_t$, where $K \\in \\mathbb{R}^{m_u \\times n}$ is the feedback gain and $\\hat{x}_t$ is a causal state estimate.\n*   **Estimator:** A steady-state linear minimum variance estimator (Kalman filter) with gain $L \\in \\mathbb{R}^{n \\times m_y}$.\n*   **LQR Cost Function:** $\\sum_{t=0}^{\\infty} \\left( x_t^\\top Q_c x_t + u_t^\\top R_c u_t \\right)$, with given $Q_c \\in \\mathbb{S}_{+}^{n}$ and $R_c \\in \\mathbb{S}_{++}^{m_u}$. $\\mathbb{S}_{++}^{k}$ denotes the set of $k \\times k$ positive definite matrices.\n*   **Tasks:**\n    1.  Derive conditions for exponential stability in the mean of the closed-loop system, expressed in terms of the spectral radii of matrices constructed from $A, B, C, K, L$.\n    2.  Design an algorithm to find $K$ and $L$ by solving discrete-time algebraic Riccati equations (DAREs) and evaluate the stability for given test cases.\n*   **Test Suite:** Four distinct test cases are provided with explicit numerical matrices for $A, B, C, Q_c, R_c, W, V$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem statement is scientifically grounded, well-posed, and objective. It represents a standard and fundamental problem in modern control theory: the design and analysis of an LQG controller.\n1.  **Scientific Soundness:** The model is a discrete-time linear time-invariant system with Gaussian noise, and the controller is based on Linear Quadratic Regulation and Kalman filtering. These are canonical, well-established concepts in control engineering and applied mathematics.\n2.  **Formalizability:** The problem is stated in precise mathematical terms, and all components can be formalized and solved algorithmically.\n3.  **Completeness:** All necessary matrices and parameters ($A, B, C, Q_c, R_c, W, V$) are provided for the specific algorithmic task. The derivation task relies on first principles, not on missing information.\n4.  **Realism:** The problem is an idealized mathematical model but is not physically impossible or inconsistent.\n5.  **Well-Posedness:** The problem of finding stabilizing gains $K$ and $L$ is well-posed under conditions of stabilizability and detectability, respectively. The test suite is designed to explore these conditions, making the problem's structure a feature, not a flaw. The stability analysis leads to a unique conclusion for each case.\n\n**Step 3: Verdict and Action**\n\nThe problem is deemed **valid**. A solution will be provided.\n\n### **Task 1: Derivation of Closed-Loop Stability Conditions**\n\nThe objective is to determine the conditions under which the expected state, $E[x_t]$, converges to zero. This is defined as exponential stability in the mean. The analysis relies on the separation principle of LQG control.\n\nWe begin with the system dynamics and the definitions of the controller and estimator.\nThe plant state evolves according to:\n$$x_{t+1} = A x_t + B u_t + w_t$$\nThe observation is:\n$$y_t = C x_t + v_t$$\nThe control law is based on the state estimate $\\hat{x}_t$:\n$$u_t = -K \\hat{x}_t$$\nThe state estimate $\\hat{x}_t$ is generated by a steady-state Kalman filter. The filter dynamics are given by a prediction step and a correction step. A combined one-step update equation for the estimate $\\hat{x}_t$ (interpreted as $\\hat{x}_{t|t}$) is:\n$$\\hat{x}_{t+1} = A \\hat{x}_t + B u_t + L (y_{t+1} - C(A \\hat{x}_t + B u_t))$$\nHowever, a more direct approach is to analyze the dynamics of the estimate and the estimation error. Let the estimation error be $e_t = x_t - \\hat{x}_t$. The standard steady-state a posteriori Kalman filter update equation is:\n$$\\hat{x}_{t+1} = A\\hat{x}_t + B u_t + L(y_t - C\\hat{x}_t)$$\nSubstituting $y_t = C x_t + v_t = C(\\hat{x}_t + e_t) + v_t$ and $u_t = -K\\hat{x}_t$:\n$$\\hat{x}_{t+1} = A\\hat{x}_t - B K \\hat{x}_t + L(C(\\hat{x}_t + e_t) + v_t - C\\hat{x}_t)$$\n$$\\hat{x}_{t+1} = (A - B K)\\hat{x}_t + L C e_t + L v_t$$\nThis equation describes the evolution of the state estimate.\n\nNext, we derive the dynamics for the estimation error $e_t = x_t - \\hat{x}_t$.\n$$e_{t+1} = x_{t+1} - \\hat{x}_{t+1}$$\nSubstitute the expressions for $x_{t+1}$ and $\\hat{x}_{t+1}$:\n$$x_{t+1} = A x_t - B K \\hat{x}_t + w_t = A(\\hat{x}_t + e_t) - B K \\hat{x}_t + w_t = (A-BK)\\hat{x}_t + A e_t + w_t$$\n$$e_{t+1} = ((A - BK)\\hat{x}_t + A e_t + w_t) - ((A - B K)\\hat{x}_t + L C e_t + L v_t)$$\n$$e_{t+1} = (A - L C)e_t + w_t - L v_t$$\nThis equation describes the evolution of the estimation error, which is independent of the state estimate $\\hat{x}_t$.\n\nWe can now form an augmented state vector $\\xi_t = \\begin{bmatrix} \\hat{x}_t \\\\ e_t \\end{bmatrix}$. The dynamics of this augmented system are:\n$$\n\\begin{bmatrix} \\hat{x}_{t+1} \\\\ e_{t+1} \\end{bmatrix} =\n\\begin{pmatrix} A-BK  LC \\\\ 0  A-LC \\end{pmatrix}\n\\begin{bmatrix} \\hat{x}_t \\\\ e_t \\end{bmatrix}\n+\n\\begin{pmatrix} L  0 \\\\ -L  I \\end{pmatrix}\n\\begin{bmatrix} v_t \\\\ w_t \\end{bmatrix}\n$$\nLet the closed-loop state-transition matrix be $A_{cl} = \\begin{pmatrix} A-BK  LC \\\\ 0  A-LC \\end{pmatrix}$.\n\nThe problem asks for exponential stability in the mean. We take the expectation of the augmented system dynamics. Since $w_t$ and $v_t$ are zero-mean processes, $E[w_t]=0$ and $E[v_t]=0$.\nLet $\\bar{\\xi}_t = E[\\xi_t] = \\begin{bmatrix} E[\\hat{x}_t] \\\\ E[e_t] \\end{bmatrix}$. The dynamics of the mean are:\n$$\n\\bar{\\xi}_{t+1} = E\\left[ A_{cl} \\xi_t + \\begin{pmatrix} L  0 \\\\ -L  I \\end{pmatrix} \\begin{bmatrix} v_t \\\\ w_t \\end{bmatrix} \\right] = A_{cl} E[\\xi_t] + 0 = A_{cl} \\bar{\\xi}_t\n$$\nThe mean of the original state is $E[x_t] = E[\\hat{x}_t + e_t]$. The system is exponentially stable in the mean if $\\bar{\\xi}_t \\to 0$ as $t \\to \\infty$ for any initial condition $\\bar{\\xi}_0$. For a discrete-time linear system $\\bar{\\xi}_{t+1} = A_{cl} \\bar{\\xi}_t$, this is true if and only if all eigenvalues of $A_{cl}$ lie strictly within the unit circle in the complex plane. This is equivalent to the condition that the spectral radius of $A_{cl}$, denoted $\\rho(A_{cl})$, is less than $1$.\n$$\\rho(A_{cl})  1$$\nSince $A_{cl}$ is a block upper triangular matrix, its eigenvalues are the union of the eigenvalues of its diagonal blocks, $(A-BK)$ and $(A-LC)$. Therefore, the condition $\\rho(A_{cl})  1$ is equivalent to the two separate conditions:\n$$\n\\rho(A-BK)  1 \\quad \\text{and} \\quad \\rho(A-LC)  1\n$$\nThis is the separation principle for discrete-time systems. The stability of the controller, governed by the eigenvalues of the regulator matrix $(A-BK)$, can be analyzed independently of the stability of the estimator, governed by the eigenvalues of the error dynamics matrix $(A-LC)$.\n\n### **Task 2: Algorithm Design**\n\nThe algorithm must first compute the controller gain $K$ and the estimator gain $L$, and then check the stability conditions derived in Task 1.\n\n**1. Design of the LQR Controller Gain $K$**\nThe gain $K$ is designed to minimize the quadratic cost $\\sum_{t=0}^{\\infty} ( x_t^\\top Q_c x_t + u_t^\\top R_c u_t )$. The optimal gain is given by:\n$$K = (R_c + B^\\top P_c B)^{-1} B^\\top P_c A$$\nwhere $P_c$ is the unique positive semi-definite solution to the discrete-time algebraic Riccati equation (DARE) for control:\n$$P_c = A^\\top P_c A - (A^\\top P_c B)(R_c + B^\\top P_c B)^{-1}(B^\\top P_c A) + Q_c$$\nA stabilizing solution exists if and only if the pair $(A, B)$ is stabilizable. If an uncontrollable mode of $A$ is unstable (has magnitude $\\ge 1$), no such stabilizing $K$ can be found.\n\n**2. Design of the Kalman Filter Gain $L$**\nThe gain $L$ is the steady-state gain for the linear minimum variance estimator (Kalman filter). By the principle of duality, this problem is equivalent to an LQR problem for a dual system. The gain $L$ is given by:\n$$L = P_e C^\\top (V + C P_e C^\\top)^{-1}$$\nwhere $P_e$ is the steady-state error covariance, which is the unique positive semi-definite solution to the DARE for filtering:\n$$P_e = A P_e A^\\top - (A P_e C^\\top)(V + C P_e C^\\top)^{-1}(C P_e A^\\top) + W$$\nTo solve this using a standard DARE solver designed for the control problem, we use the dual substitutions: $A \\to A^\\top$, $B \\to C^\\top$, $Q \\to W$, $R \\to V$. A stabilizing solution (i.e., one that makes $(A-LC)$ stable) exists if and only if the pair $(A, C)$ is detectable (or equivalently, $(A^\\top, C^\\top)$ is stabilizable). If an unobservable mode of $A$ is unstable (has magnitude $\\ge 1$), no such stabilizing $L$ can be found.\n\n**3. Overall Algorithm**\nFor each test case:\na. Attempt to solve the control DARE for $P_c$ using the matrices $A, B, Q_c, R_c$. If the solver fails (e.g., if $(A,B)$ is not stabilizable), conclude the system is unstable.\nb. If successful, compute the gain $K$ and the regulator matrix $A_{reg} = A - B K$. Calculate its spectral radius $\\rho(A_{reg})$.\nc. Attempt to solve the filtering DARE for $P_e$ using the dual matrices $A^\\top, C^\\top, W, V$. If the solver fails (e.g., if $(A,C)$ is not detectable), conclude the system is unstable.\nd. If successful, compute the gain $L$ and the estimator error matrix $A_{est} = A - L C$. Calculate its spectral radius $\\rho(A_{est})$.\ne. The combined system is exponentially stable in the mean if and only if both $\\rho(A_{reg})  1$ and $\\rho(A_{est})  1$. The algorithm will return a boolean indicating if this condition is met. If any step failed, the result is `False`.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_discrete_are\n\ndef solve():\n    \"\"\"\n    Solves the LQG stability problem for the given test cases.\n\n    For each case, it designs an LQR controller and a Kalman filter, then\n    evaluates the stability of the combined closed-loop system based on the\n    separation principle.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1 (happy path, stabilizable and detectable)\n        {\n            \"A\": np.array([[1.1, 0.1], [0.0, 0.95]]),\n            \"B\": np.array([[0.1], [0.05]]),\n            \"C\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"Q_c\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"R_c\": np.array([[0.1]]),\n            \"W\": np.array([[0.01, 0.0], [0.0, 0.01]]),\n            \"V\": np.array([[0.05, 0.0], [0.0, 0.05]]),\n        },\n        # Test case 2 (boundary case, stabilizable and detectable)\n        {\n            \"A\": np.array([[1.0, 0.2], [0.0, 0.9]]),\n            \"B\": np.array([[0.0], [1.0]]),\n            \"C\": np.array([[1.0, 0.0]]),\n            \"Q_c\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"R_c\": np.array([[0.5]]),\n            \"W\": np.array([[0.02, 0.0], [0.0, 0.02]]),\n            \"V\": np.array([[0.2]]),\n        },\n        # Test case 3 (not stabilizable)\n        {\n            \"A\": np.array([[1.2, 0.0], [0.0, 0.9]]),\n            \"B\": np.array([[0.0], [1.0]]),\n            \"C\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"Q_c\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"R_c\": np.array([[0.1]]),\n            \"W\": np.array([[0.01, 0.0], [0.0, 0.01]]),\n            \"V\": np.array([[0.05, 0.0], [0.0, 0.05]]),\n        },\n        # Test case 4 (not detectable)\n        {\n            \"A\": np.array([[1.1, 0.0], [0.0, 0.95]]),\n            \"B\": np.array([[0.1], [0.05]]),\n            \"C\": np.array([[0.0, 1.0]]),\n            \"Q_c\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"R_c\": np.array([[0.1]]),\n            \"W\": np.array([[0.01, 0.0], [0.0, 0.01]]),\n            \"V\": np.array([[0.05]]),\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        A, B, C = params[\"A\"], params[\"B\"], params[\"C\"]\n        Q_c, R_c = params[\"Q_c\"], params[\"R_c\"]\n        W, V = params[\"W\"], params[\"V\"]\n\n        # --- Sub-problem 1: Controller Stability ---\n        is_controller_stable = False\n        try:\n            # Solve the discrete-time algebraic Riccati equation for the controller\n            # P = A'PA - (A'PB)(R + B'PB)^-1(B'PA) + Q\n            P_c = solve_discrete_are(A, B, Q_c, R_c)\n            \n            # Compute the LQR gain K\n            # K = (R + B'PB)^-1 B'PA\n            K = np.linalg.inv(R_c + B.T @ P_c @ B) @ (B.T @ P_c @ A)\n            \n            # Form the closed-loop regulator matrix\n            A_reg = A - B @ K\n            \n            # Check stability: spectral radius of (A - BK) must be  1\n            eigvals_reg = np.linalg.eigvals(A_reg)\n            spectral_radius_reg = np.max(np.abs(eigvals_reg))\n            \n            if spectral_radius_reg  1.0:\n                is_controller_stable = True\n        except np.linalg.LinAlgError:\n            # DARE solver fails if (A,B) is not stabilizable.\n            is_controller_stable = False\n\n        # --- Sub-problem 2: Estimator Stability ---\n        is_estimator_stable = False\n        try:\n            # Solve the DARE for the filter using duality:\n            # A - A', B - C', Q - W, R - V\n            P_e = solve_discrete_are(A.T, C.T, W, V)\n            \n            # Compute the Kalman gain L\n            # L = PC'(V + CPC')^-1\n            L = P_e @ C.T @ np.linalg.inv(V + C @ P_e @ C.T)\n            \n            # Form the closed-loop estimator matrix\n            A_est = A - L @ C\n            \n            # Check stability: spectral radius of (A - LC) must be  1\n            eigvals_est = np.linalg.eigvals(A_est)\n            spectral_radius_est = np.max(np.abs(eigvals_est))\n            \n            if spectral_radius_est  1.0:\n                is_estimator_stable = True\n        except np.linalg.LinAlgError:\n            # DARE solver fails if (A',C') is not stabilizable,\n            # which means (A,C) is not detectable.\n            is_estimator_stable = False\n            \n        # The overall system is stable iff both controller and estimator are stable\n        is_system_stable = is_controller_stable and is_estimator_stable\n        results.append(is_system_stable)\n\n    # Format the final output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}