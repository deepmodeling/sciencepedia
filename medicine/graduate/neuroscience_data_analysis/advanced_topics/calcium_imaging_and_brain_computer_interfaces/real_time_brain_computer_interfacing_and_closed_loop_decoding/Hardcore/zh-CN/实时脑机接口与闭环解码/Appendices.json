{
    "hands_on_practices": [
        {
            "introduction": "在任何脑机接口（BCI）系统中，信号的质量是解码性能的基石。此实践练习  将带您回到信号采集的最前端——微电极本身，探索其固有的物理噪声极限。通过从基本物理原理出发，您将推导出由约翰逊-奈奎斯特热噪声决定的噪声基底，并计算出在给定信噪比阈值下可被可靠检测到的最小神经脉冲幅度，这对于评估闭环系统设计的可行性至关重要。",
            "id": "4188846",
            "problem": "单个微电极用于实时脑机接口（BCI）的闭环尖峰检测。采集链应用了一个通带范围为 $300\\,\\mathrm{Hz}$ 至 $3000\\,\\mathrm{Hz}$ 的因果带通滤波器来分离尖峰活动。在该频带内，微电极的阻抗主要由一个纯电阻分量主导，可建模为一个阻值为 $R = 5.0 \\times 10^{5}\\,\\Omega$ 的电阻。实验制备的温度为 $T = 310\\,\\mathrm{K}$。尖峰检测模块使用一个幅度阈值，该阈值被选择以达到指定的信噪比（SNR）。此处的信噪比定义为尖峰峰值幅度与滤波后信号中噪声的均方根（RMS）幅度的比值。信噪比阈值为 $\\gamma = 5.0$。\n\n从 Johnson–Nyquist 热噪声的基本定义和涨落-耗散定理出发，并假设热噪声在通带内是平稳白噪声，且电极的实部阻抗在通带内是恒定的，请推导电极上带限均方根热电压噪声，然后计算在此闭环设置中满足信噪比阈值所需的最小尖峰峰值幅度。将总噪声视为仅由电极的 Johnson–Nyquist 热噪声产生，并忽略任何放大器或 $1/f$ 噪声的贡献。\n\n令 $k_{B}$ 表示玻尔兹曼常数。滤波器带宽为 $B = f_{2} - f_{1}$，其中 $f_{1} = 300\\,\\mathrm{Hz}$ 且 $f_{2} = 3000\\,\\mathrm{Hz}$。将每个最终值四舍五入至三位有效数字。以微伏为单位表示最终的噪声幅度和最小可检测尖峰幅度。你的最终答案必须以单行矩阵的形式包含这两个数值。",
            "solution": "首先验证问题，确保其具有科学依据、问题提出得当且客观。提取并评估所有给定条件。\n- **给定条件**：\n    - 滤波器通带下限频率：$f_{1} = 300\\,\\mathrm{Hz}$。\n    - 滤波器通带上限频率：$f_{2} = 3000\\,\\mathrm{Hz}$。\n    - 电极电阻：$R = 5.0 \\times 10^{5}\\,\\Omega$。\n    - 温度：$T = 310\\,\\mathrm{K}$。\n    - 信噪比阈值：$\\gamma = 5.0$。\n    - 常数：玻尔兹曼常数，$k_{B}$。\n- **假设**：\n    - 电极阻抗在通带内是纯电阻性的且恒定。\n    - 噪声仅为 Johnson–Nyquist 热噪声。\n    - 热噪声在通带内是平稳白噪声。\n    - 放大器和 $1/f$ 噪声可以忽略不计。\n- **验证结论**：问题有效。它基于物理学的基本原理（Johnson-Nyquist 噪声，涨落-耗散定理），并涉及神经生理学记录场景中的实际参数。问题提出得当，提供了足够的信息以获得唯一解。\n\n求解过程首先推导热噪声电压的均方根（RMS）表达式，然后使用给定的信噪比（SNR）来找出最小可检测的尖峰幅度。\n\n问题要求从涨落-耗散定理出发。对于处于热平衡状态的系统，该定理将自发涨落的大小与系统的耗散特性联系起来。对于阻抗为 $Z(f)$ 的电导体，该定理给出了开路热电压噪声的功率谱密度（PSD）。考虑正频率功率的单边功率谱密度 $S_v(f)$ 由下式给出：\n$$S_v(f) = 4 k_B T \\operatorname{Re}\\{Z(f)\\}$$\n其中 $k_{B}$ 是玻尔兹曼常数（约 $1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$），$T$ 是以开尔文为单位的绝对温度，$\\operatorname{Re}\\{Z(f)\\}$ 是频率 $f$ 下阻抗的实部（电阻）部分。\n\n问题指出，在所关注的频带内，电极的阻抗是纯电阻性的且恒定，电阻为 $R = 5.0 \\times 10^{5}\\,\\Omega$。因此，对于通带内的所有频率，$\\operatorname{Re}\\{Z(f)\\} = R$。噪声电压的功率谱密度在该频带内是恒定的：\n$$S_v(f) = 4 k_B T R$$\n这证实了问题中关于噪声在通带内是白噪声的假设。\n\n滤波器通带内的总均方噪声电压 $\\langle V_n^2 \\rangle$ 是通过将功率谱密度在滤波器带宽 $B$ 上积分得到的。带宽为 $B = f_2 - f_1$。\n$$\\langle V_n^2 \\rangle = \\int_{f_1}^{f_2} S_v(f) \\, df$$\n由于 $S_v(f)$ 在积分区间 $[f_1, f_2]$ 上是常数，我们有：\n$$\\langle V_n^2 \\rangle = 4 k_B T R \\int_{f_1}^{f_2} df = 4 k_B T R (f_2 - f_1) = 4 k_B T R B$$\n\n均方根（RMS）噪声电压 $V_{n, \\text{rms}}$ 是均方电压的平方根：\n$$V_{n, \\text{rms}} = \\sqrt{\\langle V_n^2 \\rangle} = \\sqrt{4 k_B T R B}$$\n现在我们将给定值代入此表达式。\n带宽为 $B = f_2 - f_1 = 3000\\,\\mathrm{Hz} - 300\\,\\mathrm{Hz} = 2700\\,\\mathrm{Hz}$。\n常数值如下：\n$k_B \\approx 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$\n$T = 310\\,\\mathrm{K}$\n$R = 5.0 \\times 10^{5}\\,\\Omega$\n\n代入这些值：\n$$\\langle V_n^2 \\rangle = 4 \\times (1.380649 \\times 10^{-23}\\,\\mathrm{J/K}) \\times (310\\,\\mathrm{K}) \\times (5.0 \\times 10^{5}\\,\\Omega) \\times (2700\\,\\mathrm{Hz})$$\n$$\\langle V_n^2 \\rangle \\approx 2.31289 \\times 10^{-11}\\,\\mathrm{V}^2$$\n那么，均方根噪声电压为：\n$$V_{n, \\text{rms}} = \\sqrt{2.31289 \\times 10^{-11}\\,\\mathrm{V}^2} \\approx 4.80925 \\times 10^{-6}\\,\\mathrm{V}$$\n为了以微伏（$1\\,\\mu\\mathrm{V} = 10^{-6}\\,\\mathrm{V}$）为单位表示该值：\n$$V_{n, \\text{rms}} \\approx 4.80925\\,\\mu\\mathrm{V}$$\n四舍五入至三位有效数字，均方根噪声电压为 $4.81\\,\\mu\\mathrm{V}$。\n\n接下来，我们计算满足信噪比阈值 $\\gamma$ 所需的最小尖峰峰值幅度 $A_{\\text{peak, min}}$。信噪比定义为尖峰峰值幅度与均方根噪声幅度的比值：\n$$\\gamma = \\frac{A_{\\text{peak}}}{V_{n, \\text{rms}}}$$\n因此，最小可检测峰值幅度为：\n$$A_{\\text{peak, min}} = \\gamma \\cdot V_{n, \\text{rms}}$$\n使用给定的信噪比阈值 $\\gamma = 5.0$ 和未经四舍五入的 $V_{n, \\text{rms}}$ 值：\n$$A_{\\text{peak, min}} = 5.0 \\times (4.80925 \\times 10^{-6}\\,\\mathrm{V}) \\approx 2.404625 \\times 10^{-5}\\,\\mathrm{V}$$\n以微伏表示：\n$$A_{\\text{peak, min}} \\approx 24.04625\\,\\mu\\mathrm{V}$$\n四舍五入至三位有效数字，最小尖峰峰值幅度为 $24.0\\,\\mu\\mathrm{V}$。\n\n所需的两个值是均方根噪声幅度和最小可检测尖峰幅度，两者均以微伏为单位，并四舍五入至三位有效数字。\n均方根噪声幅度为 $4.81\\,\\mu\\mathrm{V}$。\n最小可检测尖峰幅度为 $24.0\\,\\mu\\mathrm{V}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n4.81  24.0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "一旦我们获取了神经信号，下一步就是从中提取有意义的特征以供解码器使用。本练习  聚焦于一种核心技术——短时傅里叶变换（STFT），它被广泛用于分析神经振荡的动态变化。您将深入研究STFT的关键参数，如频率分辨率和由窗函数引起的频谱泄露，这些参数直接影响着解码器区分不同脑状态的能力。",
            "id": "4188932",
            "problem": "考虑一个闭环脑机接口 (BCI)，它通过使用短时傅里叶变换 (STFT) 从微电极记录中提取谱特征，实时解码神经振荡。连续的离散时间神经信号表示为 $x[n]$，采样率为每秒 $f_s$ 个样本。特征是在长度为 $N$ 个样本、跳跃步长为 $H$ 个样本的滑动分析窗上计算的。窗函数为周期性汉明窗，定义为 $w[n] = \\alpha - \\beta \\cos\\!\\left(\\frac{2\\pi n}{N}\\right)$，其中 $n = 0,1,\\dots,N-1$，常量 $\\alpha = 0.54$ 和 $\\beta = 0.46$。在帧索引为 $m$ 和离散频率仓为 $k \\in \\{0,1,\\dots,N-1\\}$ 时的 STFT，是通过对加窗段 $x[n+mH]w[n]$ 进行离散时间傅里叶变换，并在 $\\omega_k = \\frac{2\\pi k}{N}$ 处求值得到的。\n\n从 STFT 和窗谱能量的基本定义出发，并仅使用离散时间傅里叶变换和帕塞瓦尔定理的恒等式，推导出 STFT 特征图 $F[m,k]$，该特征图生成一个适用于闭环解码的、跨频率仓的归一化功率估计。然后，在相同的基础上，计算：\n\n1) 与长度为 $N$ 的窗上的离散傅里叶分析相关的基本频率分辨率（以赫兹表示）。\n\n2) 一个泄露度量，定义为周期性汉明窗的等效噪声带宽 (ENBW)，以赫兹为单位。其计算方法为窗的频率响应的积分平方幅值与零频处峰值幅度的平方之比，再通过采样率转换为赫兹。\n\n所有与频率相关的量都用赫兹表示，并且在最终的方框答案中不包含单位。以单行矩阵的形式提供最终答案，其中依次包含频率分辨率和 ENBW，每个都表示为关于 $N$、$f_s$、$\\alpha$ 和 $\\beta$ 的闭式解析表达式。不需要进行数值近似或四舍五入。",
            "solution": "首先对问题陈述进行验证。\n\n### 第 1 步：提取已知条件\n-   **信号**：连续的离散时间神经信号 $x[n]$。\n-   **采样率**：每秒 $f_s$ 个样本。\n-   **窗长**：$N$ 个样本。\n-   **跳跃步长**：$H$ 个样本。\n-   **窗函数**：周期性汉明窗，$w[n] = \\alpha - \\beta \\cos\\left(\\frac{2\\pi n}{N}\\right)$，其中 $n = 0,1,\\dots,N-1$。\n-   **窗常量**：$\\alpha = 0.54$，$\\beta = 0.46$。\n-   **STFT 定义**：在帧 $m$ 和频率仓 $k$ 处的短时傅里叶变换 (STFT) 是通过对加窗段 $x[n+mH]w[n]$ 进行离散时间傅里叶变换 (DTFT) 并在离散频率 $\\omega_k = \\frac{2\\pi k}{N}$（其中 $k \\in \\{0,1,\\dots,N-1\\}$）处求值得到的。\n-   **特征图**：$F[m,k]$ 是一个跨频率仓的归一化功率估计。\n-   **任务 1**：推导以赫兹为单位的基本频率分辨率。\n-   **任务 2**：推导周期性汉明窗的等效噪声带宽 (ENBW)，以赫兹为单位，其定义为窗的频率响应的积分平方幅值与零频处峰值幅度的平方之比，并转换为赫兹。\n\n### 第 2 步：使用提取的已知条件进行验证\n1.  **科学或事实不健全**：该问题在科学上是健全的。它基于数字信号处理的既定原则，特别是使用汉明窗的短时傅里叶变换 (STFT)，这些是分析神经数据等信号时频的标准技术。\n2.  **不可形式化或不相关**：该问题是可形式化的，并且与神经科学数据分析在脑机接口等应用中直接相关。\n3.  **不完整或矛盾的设置**：该问题是自洽的。它提供了所有必要的符号变量（$N, f_s, \\alpha, \\beta$）和定义来推导所要求的量。常量 $\\alpha=0.54, \\beta=0.46$ 与汉明窗的通用定义一致。\n4.  **不现实或不可行**：该设置完全现实，描述了实时谱分析的一种常见实际实现。\n5.  **不适定或结构不良**：该问题是适定的。待推导的量——频率分辨率和等效噪声带宽——是唯一定义的，并且是信号处理中的标准度量。\n6.  **伪深刻、琐碎或同义反复**：该问题需要基于基本的数字信号处理 (DSP) 定理和恒等式进行实质性推导。它既不琐碎，也不是人为设计的。\n7.  **超出科学可验证性**：推导过程纯属数学推导，可以进行严格验证。\n\n### 第 3 步：结论与行动\n问题有效。将提供完整解答。\n\n### 解答推导\n\n分析首先将问题陈述中概述的概念形式化。信号 $x[n]$ 的 STFT 由加窗段的离散傅里叶变换 (DFT) 给出：\n$$\nX[m,k] = \\sum_{n=0}^{N-1} x[n+mH]w[n] e^{-j \\frac{2\\pi k n}{N}}\n$$\n其中 $m$ 是帧索引，$k$ 是频率仓索引。\n\n问题首先要求推导一个归一化功率估计 $F[m,k]$。一个具有物理意义的功率估计可以从 DFT 的帕塞瓦尔定理推导出来。加窗段的能量为：\n$$\nE_{seg} = \\sum_{n=0}^{N-1} |x[n+mH]w[n]|^2\n$$\n根据帕塞瓦尔定理，该能量与 DFT 系数的关系为：\n$$\nE_{seg} = \\frac{1}{N} \\sum_{k=0}^{N-1} |X[m,k]|^2\n$$\n在窗的持续时间（即 $T = N/f_s$ 秒）内的平均功率是能量除以持续时间：\n$$\nP_{avg} = \\frac{E_{seg}}{T} = \\frac{f_s}{N} E_{seg} = \\frac{f_s}{N^2} \\sum_{k=0}^{N-1} |X[m,k]|^2\n$$\n这个总平均功率分布在 $N$ 个频率仓中。因此，单个频率仓 $k$ 中的功率的合乎逻辑的定义是：\n$$\nF[m,k] = \\frac{f_s}{N^2} |X[m,k]|^2\n$$\n这代表了一个适用于特征图的有效归一化功率估计。\n\n**1) 基本频率分辨率**\n\nDFT 在一组离散时间角频率 $\\omega_k = \\frac{2\\pi k}{N}$（其中 $k=0, 1, \\dots, N-1$）上分析长度为 $N$ 的信号。离散时间角频率 $\\omega$（单位：弧度/样本）与连续时间物理频率 $f$（单位：赫兹）之间的关系是 $\\omega = 2\\pi f / f_s$。\n\n将此关系代入 $\\omega_k$ 的表达式中，我们得到对应于每个频率仓 $k$ 的物理频率：\n$$\n\\frac{2\\pi f_k}{f_s} = \\frac{2\\pi k}{N} \\implies f_k = k \\frac{f_s}{N}\n$$\n基本频率分辨率，记为 $\\Delta f$，是相邻频率仓之间的间隔。\n$$\n\\Delta f = f_{k+1} - f_k = (k+1)\\frac{f_s}{N} - k\\frac{f_s}{N} = \\frac{f_s}{N}\n$$\n这是第一个所求的量。\n\n**2) 等效噪声带宽 (ENBW)**\n\nENBW 定义为窗的频率响应的积分平方幅值与零频处峰值幅度的平方之比，并转换为赫兹。\n\n窗函数 $w[n]$ 的频率响应是其 DTFT, $W(e^{j\\omega})$。问题依赖于 DFT，这意味着我们处理其样本 $W[k] = \\left. W(e^{j\\omega}) \\right|_{\\omega=2\\pi k/N} = \\sum_{n=0}^{N-1} w[n] e^{-j \\frac{2\\pi k n}{N}}$。\n\n离散频率域中的“积分平方幅值”是 DFT 系数平方幅值的总和，即 $\\sum_{k=0}^{N-1} |W[k]|^2$。对窗函数本身使用帕塞瓦尔定理：\n$$\n\\sum_{k=0}^{N-1} |W[k]|^2 = N \\sum_{n=0}^{N-1} |w[n]|^2\n$$\n“零频处的峰值幅度”对应于 $k=0$：\n$$\nW[0] = \\sum_{n=0}^{N-1} w[n] e^0 = \\sum_{n=0}^{N-1} w[n]\n$$\n峰值幅度的平方是 $|W[0]|^2 = \\left(\\sum_{n=0}^{N-1} w[n]\\right)^2$。\n\n以频率仓为单位的 ENBW 是以下比率：\n$$\n\\text{ENBW}_{\\text{bins}} = \\frac{\\sum_{k=0}^{N-1} |W[k]|^2}{|W[0]|^2} = \\frac{N \\sum_{n=0}^{N-1} w[n]^2}{\\left(\\sum_{n=0}^{N-1} w[n]\\right)^2}\n$$\n要将其转换为赫兹，我们乘以频率分辨率（一个频率仓的宽度）：\n$$\n\\text{ENBW}_{\\text{Hz}} = \\text{ENBW}_{\\text{bins}} \\times \\Delta f = \\frac{N \\sum_{n=0}^{N-1} w[n]^2}{\\left(\\sum_{n=0}^{N-1} w[n]\\right)^2} \\times \\frac{f_s}{N} = \\frac{f_s \\sum_{n=0}^{N-1} w[n]^2}{\\left(\\sum_{n=0}^{N-1} w[n]\\right)^2}\n$$\n现在，我们必须为周期性汉明窗 $w[n] = \\alpha - \\beta \\cos\\left(\\frac{2\\pi n}{N}\\right)$ 计算这些和。设 $S_1 = \\sum_{n=0}^{N-1} w[n]$ 和 $S_2 = \\sum_{n=0}^{N-1} w[n]^2$。\n\n$S_1$ 的计算：\n$$\nS_1 = \\sum_{n=0}^{N-1} \\left(\\alpha - \\beta \\cos\\left(\\frac{2\\pi n}{N}\\right)\\right) = \\sum_{n=0}^{N-1} \\alpha - \\beta \\sum_{n=0}^{N-1} \\cos\\left(\\frac{2\\pi n}{N}\\right)\n$$\n第一项是 $N\\alpha$。第二项求和是余弦函数的一个完整周期。正弦曲线在整数个周期内的样本总和为零。这可以通过将余弦表示为复指数的实部并对所得的几何级数求和来正式证明，假设 $N1$，该和等于零。\n$$\n\\sum_{n=0}^{N-1} \\cos\\left(\\frac{2\\pi n}{N}\\right) = \\text{Re}\\left(\\sum_{n=0}^{N-1} \\left(e^{j2\\pi/N}\\right)^n\\right) = \\text{Re}\\left(\\frac{1 - (e^{j2\\pi/N})^N}{1 - e^{j2\\pi/N}}\\right) = \\text{Re}\\left(\\frac{1 - e^{j2\\pi}}{1 - e^{j2\\pi/N}}\\right) = 0\n$$\n因此，$S_1 = N\\alpha$。\n\n$S_2$ 的计算：\n$$\nS_2 = \\sum_{n=0}^{N-1} \\left(\\alpha - \\beta \\cos\\left(\\frac{2\\pi n}{N}\\right)\\right)^2 = \\sum_{n=0}^{N-1} \\left(\\alpha^2 - 2\\alpha\\beta\\cos\\left(\\frac{2\\pi n}{N}\\right) + \\beta^2\\cos^2\\left(\\frac{2\\pi n}{N}\\right)\\right)\n$$\n我们可以将各项分开：\n$$\nS_2 = \\sum_{n=0}^{N-1}\\alpha^2 - 2\\alpha\\beta\\sum_{n=0}^{N-1}\\cos\\left(\\frac{2\\pi n}{N}\\right) + \\beta^2\\sum_{n=0}^{N-1}\\cos^2\\left(\\frac{2\\pi n}{N}\\right)\n$$\n第一项是 $N\\alpha^2$。第二项为零，如前所示。对于第三项，我们使用恒等式 $\\cos^2(\\theta) = \\frac{1}{2}(1 + \\cos(2\\theta))$。\n$$\n\\sum_{n=0}^{N-1}\\cos^2\\left(\\frac{2\\pi n}{N}\\right) = \\sum_{n=0}^{N-1} \\frac{1}{2}\\left(1 + \\cos\\left(\\frac{4\\pi n}{N}\\right)\\right) = \\frac{1}{2}\\sum_{n=0}^{N-1} 1 + \\frac{1}{2}\\sum_{n=0}^{N-1}\\cos\\left(\\frac{2\\pi (2) n}{N}\\right)\n$$\n第一部分是 $\\frac{N}{2}$。第二项求和是余弦函数的两个完整周期，其和也为零（假设 $N2$，这个条件在实践中总是满足的）。\n因此，$\\sum_{n=0}^{N-1}\\cos^2\\left(\\frac{2\\pi n}{N}\\right) = \\frac{N}{2}$。\n将此结果代回 $S_2$ 的表达式中：\n$$\nS_2 = N\\alpha^2 + \\beta^2 \\left(\\frac{N}{2}\\right) = N\\left(\\alpha^2 + \\frac{\\beta^2}{2}\\right)\n$$\n最后，我们将 $S_1$ 和 $S_2$ 代入 $\\text{ENBW}_{\\text{Hz}}$ 的公式中：\n$$\n\\text{ENBW}_{\\text{Hz}} = \\frac{f_s S_2}{S_1^2} = \\frac{f_s N\\left(\\alpha^2 + \\frac{\\beta^2}{2}\\right)}{(N\\alpha)^2} = \\frac{f_s N\\left(\\alpha^2 + \\frac{\\beta^2}{2}\\right)}{N^2\\alpha^2} = \\frac{f_s}{N} \\frac{\\alpha^2 + \\frac{\\beta^2}{2}}{\\alpha^2}\n$$\n该表达式可以简化为：\n$$\n\\text{ENBW}_{\\text{Hz}} = \\frac{f_s}{N} \\left(1 + \\frac{\\beta^2}{2\\alpha^2}\\right)\n$$\n这是第二个所求的量，即以赫兹为单位的 ENBW。\n\n最终答案由按要求顺序排列的两个推导出的表达式组成。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{f_s}{N}  \\frac{f_s}{N} \\left( 1 + \\frac{\\beta^2}{2\\alpha^2} \\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "构建解码器后，准确评估其在真实闭环场景中的性能是一项关键挑战，尤其是在目标事件（如运动意图）稀疏的非均衡数据条件下。此实践练习  揭示了在这种情况下使用标准准确率指标的陷阱。您将推导并构建一个更稳健的流式评估方案，该方案能够校准由类别不平衡引起的偏差，从而提供对解码器性能更真实的洞察。",
            "id": "4188866",
            "problem": "在实时脑机接口 (BCI) 中，一个二进制解码器通过在每个时间步决定潜在运动意图是否存在 ($y=1$) 或不存在 ($y=0$) 来控制一个闭环干预。相对于静息状态，干预是罕见的，这导致了类别不平衡。为了在线评估性能，该系统使用遗忘因子 $\\lambda \\in (0,1)$ 来维护指数加权移動平均 (EWMA) 混淆计数：\n$$\n\\mathrm{TP}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 1,\\, y_{t-k} = 1\\right], \\quad\n\\mathrm{FP}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 1,\\, y_{t-k} = 0\\right],\n$$\n$$\n\\mathrm{FN}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 0,\\, y_{t-k} = 1\\right], \\quad\n\\mathrm{TN}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 0,\\, y_{t-k} = 0\\right].\n$$\n流式准确率估计器定义为\n$$\n\\widehat{A}_{\\lambda}(t) = \\frac{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{FP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}.\n$$\n从第一性原理出发，推导在一个由正类先验概率 $\\,\\pi = \\mathbb{P}(y=1)\\,$、真阳性率 $\\,\\theta_{p} = \\mathbb{P}(\\hat{y}=1 \\mid y=1)\\,$ 和真阴性率 $\\,\\theta_{n} = \\mathbb{P}(\\hat{y}=0 \\mid y=0)\\,$ 表征的平稳窗口下，$\\widehat{A}_{\\lambda}(t)$ 的期望值。展示 $\\widehat{A}_{\\lambda}(t)$ 相对于一个对各类别命中率赋予相等权重的类别先验不变分数的偏差，然后构建一个流式校准方案，该方案仅使用 EWMA 混淆计数，用这个类别先验不变分数的估计器来替代 $\\widehat{A}_{\\lambda}(t)$。\n\n最后，使用在时间 $t$、遗忘因子 $\\lambda = 0.95$ 下实现的以下 EWMA 计数，\n$$\n\\mathrm{TP}_{\\lambda}(t) = 180.0,\\quad \\mathrm{FP}_{\\lambda}(t) = 60.0,\\quad \\mathrm{FN}_{\\lambda}(t) = 220.0,\\quad \\mathrm{TN}_{\\lambda}(t) = 1540.0,\n$$\n计算您推导出的校准流式分数。将您的答案四舍五入到五位有效数字。最终答案以无单位区间 $[0,1]$ 内的小数表示。",
            "solution": "本问题将首先验证其前提和结构，然后分三部分进行解答：(1) 推导流式准确率估计器的期望值，(2) 分析其偏差并构建一个校准的、类别先验不变的分数估计器，以及 (3) 使用所提供的数据计算该校准分数的值。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   二进制潜在状态：$y \\in \\{0, 1\\}$，其中 $y=1$（存在）和 $y=0$（不存在）。\n-   二进制解码器预测：$\\hat{y} \\in \\{0, 1\\}$。\n-   EWMA 遗忘因子：$\\lambda \\in (0,1)$。\n-   时间 $t$ 的 EWMA 混淆计数：\n    -   真阳性：$\\mathrm{TP}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 1,\\, y_{t-k} = 1\\right]$\n    -   假阳性：$\\mathrm{FP}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 1,\\, y_{t-k} = 0\\right]$\n    -   假阴性：$\\mathrm{FN}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 0,\\, y_{t-k} = 1\\right]$\n    -   真阴性：$\\mathrm{TN}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 0,\\, y_{t-k} = 0\\right]$\n-   流式准确率估计器定义：$\\widehat{A}_{\\lambda}(t) = \\frac{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{FP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}$。\n-   平稳窗口特征：\n    -   正类先验概率：$\\pi = \\mathbb{P}(y=1)$\n    -   真阳性率（灵敏度）：$\\theta_{p} = \\mathbb{P}(\\hat{y}=1 \\mid y=1)$\n    -   真阴性率（特异度）：$\\theta_{n} = \\mathbb{P}(\\hat{y}=0 \\mid y=0)$\n-   在特定时间 $t$ 实现的 EWMA 计数：\n    -   $\\mathrm{TP}_{\\lambda}(t) = 180.0$\n    -   $\\mathrm{FP}_{\\lambda}(t) = 60.0$\n    -   $\\mathrm{FN}_{\\lambda}(t) = 220.0$\n    -   $\\mathrm{TN}_{\\lambda}(t) = 1540.0$\n-   遗忘因子值：$\\lambda = 0.95$。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学依据：**该问题使用了机器学习和信号处理中用于评估流式（在线）设置下二元分类器的标准定义。EWMA 是一种在移动窗口上跟踪性能的常用技术。准确率、真/假阳性/阴性率以及类别先验概率等概念是分类理论的基础。\n-   **问题良定性：**该问题结构清晰，要求进行特定的推导和最终计算。平稳过程的假设（恒定的 $\\pi$、$\\theta_p$、$\\theta_n$）使得期望值计算易于处理，并能导出一个唯一的解析解。\n-   **客观性：**该问题使用精确的数学定义进行表述，避免了任何主观或模糊的语言。\n-   **未发现缺陷：**该问题是自洽的、一致的且科学上合理的。它没有违反任何无效性标准。\n\n**步骤 3：结论与行动**\n该问题是有效的。将提供完整的解决方案。\n\n### 解答推导\n\n**第 1 部分：流式准确率估计器的期望值**\n\n首先，我们分析 $\\widehat{A}_{\\lambda}(t)$ 的分母。设其为 $D_{\\lambda}(t)$。\n$$\nD_{\\lambda}(t) = \\mathrm{TP}_{\\lambda}(t) + \\mathrm{FP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)\n$$\n代入 EWMA 计数的定义：\n$$\nD_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^k \\left( \\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=1] + \\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=0] + \\mathbf{1}[\\hat{y}_{t-k}=0, y_{t-k}=1] + \\mathbf{1}[\\hat{y}_{t-k}=0, y_{t-k}=0] \\right)\n$$\n对于任何给定的时间步 $t-k$，指示函数内的四个事件是互斥且穷尽的。因此，这些指示函数的和恒等于 $1$。\n$$\nD_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^k = \\frac{1}{1-\\lambda}\n$$\n给定 $\\lambda$，这是一个确定性常数。\n\n接下来，我们求分子 $N_{\\lambda}(t) = \\mathrm{TP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)$ 的期望值。利用期望的线性性质：\n$$\n\\mathbb{E}[N_{\\lambda}(t)] = \\mathbb{E}[\\mathrm{TP}_{\\lambda}(t)] + \\mathbb{E}[\\mathrm{TN}_{\\lambda}(t)]\n$$\n我们需要每个 EWMA 计数的期望值。对于 $\\mathrm{TP}_{\\lambda}(t)$：\n$$\n\\mathbb{E}[\\mathrm{TP}_{\\lambda}(t)] = \\mathbb{E}\\left[\\sum_{k=0}^{\\infty} \\lambda^k \\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=1]\\right] = \\sum_{k=0}^{\\infty} \\lambda^k \\mathbb{E}[\\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=1]]\n$$\n指示函数的期望是其所指示事件的概率。在平稳假设下，这个概率对所有 $k$ 都是恒定的。\n$$\n\\mathbb{E}[\\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=1]] = \\mathbb{P}(\\hat{y}=1, y=1) = \\mathbb{P}(\\hat{y}=1|y=1)\\mathbb{P}(y=1) = \\theta_p \\pi\n$$\n因此，\n$$\n\\mathbb{E}[\\mathrm{TP}_{\\lambda}(t)] = \\sum_{k=0}^{\\infty} \\lambda^k (\\theta_p \\pi) = (\\theta_p \\pi) \\sum_{k=0}^{\\infty} \\lambda^k = \\frac{\\theta_p \\pi}{1-\\lambda}\n$$\n类似地，对于 $\\mathrm{TN}_{\\lambda}(t)$：\n$$\n\\mathbb{P}(\\hat{y}=0, y=0) = \\mathbb{P}(\\hat{y}=0|y=0)\\mathbb{P}(y=0) = \\theta_n (1-\\pi)\n$$\n$$\n\\mathbb{E}[\\mathrm{TN}_{\\lambda}(t)] = \\frac{\\theta_n (1-\\pi)}{1-\\lambda}\n$$\n那么分子的期望值为：\n$$\n\\mathbb{E}[N_{\\lambda}(t)] = \\frac{\\theta_p \\pi}{1-\\lambda} + \\frac{\\theta_n (1-\\pi)}{1-\\lambda} = \\frac{\\theta_p \\pi + \\theta_n (1-\\pi)}{1-\\lambda}\n$$\n由于分母 $D_{\\lambda}(t)$ 是一个常数，估计器 $\\widehat{A}_{\\lambda}(t)$ 的期望值是期望分子与分母的比值：\n$$\n\\mathbb{E}[\\widehat{A}_{\\lambda}(t)] = \\frac{\\mathbb{E}[N_{\\lambda}(t)]}{D_{\\lambda}(t)} = \\frac{\\frac{\\theta_p \\pi + \\theta_n (1-\\pi)}{1-\\lambda}}{\\frac{1}{1-\\lambda}} = \\theta_p \\pi + \\theta_n (1-\\pi)\n$$\n这是准确率的标准公式，证实了该流式估计器是潜在过程真实准确率的无偏估计器。\n\n**第 2 部分：偏差分析与校准估计器的构建**\n\n问题定义了一个“对各类别命中率赋予相等权重的类别先验不变分数”。各类别命中率即真阳性率 $\\theta_p$ 和真阴性率 $\\theta_n$。一个等权重的分数是它们的算术平均值，也就是平衡准确率 ($S_{BA}$) 的定义。\n$$\nS_{BA} = \\frac{\\theta_p + \\theta_n}{2}\n$$\n$\\widehat{A}_{\\lambda}(t)$ 相对于此分数的偏差是它们期望值之间的差：\n$$\n\\text{Bias} = \\mathbb{E}[\\widehat{A}_{\\lambda}(t)] - S_{BA} = \\left[ \\theta_p \\pi + \\theta_n (1-\\pi) \\right] - \\frac{\\theta_p + \\theta_n}{2}\n$$\n$$\n\\text{Bias} = \\theta_p \\left( \\pi - \\frac{1}{2} \\right) + \\theta_n \\left( 1 - \\pi - \\frac{1}{2} \\right) = \\theta_p \\left( \\pi - \\frac{1}{2} \\right) - \\theta_n \\left( \\pi - \\frac{1}{2} \\right)\n$$\n$$\n\\text{Bias} = (\\theta_p - \\theta_n)\\left(\\pi - \\frac{1}{2}\\right)\n$$\n这表明，只要类别先验概率不平衡 ($\\pi \\neq 1/2$) 且各类别命中率不相等 ($\\theta_p \\neq \\theta_n$)，准确率估计器相对于平衡分数就是有偏的。正如问题所述，干预是罕见的，意味着 $\\pi$ 很小，因此 $\\pi - 1/2$ 是负数，导致了显著的偏差。\n\n为了构建 $S_{BA}$ 的流式估计器，我们必须首先从可用的 EWMA 计数中估计 $\\theta_p$ 和 $\\theta_n$。$\\theta_p$ 和 $\\theta_n$ 的定义涉及总体计数的比率：\n$$\n\\theta_p = \\frac{\\mathbb{P}(\\hat{y}=1, y=1)}{\\mathbb{P}(y=1)} = \\frac{\\mathbb{P}(\\text{TP})}{\\mathbb{P}(\\text{TP}) + \\mathbb{P}(\\text{FN})}, \\quad \\theta_n = \\frac{\\mathbb{P}(\\hat{y}=0, y=0)}{\\mathbb{P}(y=0)} = \\frac{\\mathbb{P}(\\text{TN})}{\\mathbb{P}(\\text{TN}) + \\mathbb{P}(\\text{FP})}\n$$\n我们可以通过用 EWMA 对应项替换真实的概率/计数来构建 $\\theta_p$ 和 $\\theta_n$ 的估计器。EWMA 计数 $\\mathrm{TP}_{\\lambda}(t)$ 等是加权和，可作为最近时间窗口内总计数的代理。\n正例总数的 EWMA 是 $\\mathrm{P}_{\\lambda}(t) = \\mathrm{TP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t)$。\n负例总数的 EWMA 是 $\\mathrm{N}_{\\lambda}(t) = \\mathrm{FP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)$。\n因此，各类别命中率的流式估计器为：\n$$\n\\hat{\\theta}_p(t) = \\frac{\\mathrm{TP}_{\\lambda}(t)}{\\mathrm{P}_{\\lambda}(t)} = \\frac{\\mathrm{TP}_{\\lambda}(t)}{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t)}\n$$\n$$\n\\hat{\\theta}_n(t) = \\frac{\\mathrm{TN}_{\\lambda}(t)}{\\mathrm{N}_{\\lambda}(t)} = \\frac{\\mathrm{TN}_{\\lambda}(t)}{\\mathrm{FP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}\n$$\n我们记作 $\\widehat{S}_{BA,\\lambda}(t)$ 的校准流式分数，是通过代入这些估计器构建的平衡准确率的估计器：\n$$\n\\widehat{S}_{BA,\\lambda}(t) = \\frac{\\hat{\\theta}_p(t) + \\hat{\\theta}_n(t)}{2} = \\frac{1}{2} \\left( \\frac{\\mathrm{TP}_{\\lambda}(t)}{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t)} + \\frac{\\mathrm{TN}_{\\lambda}(t)}{\\mathrm{FP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)} \\right)\n$$\n这就是所需的校准方案。它提供了平衡准确率的在线估计，减轻了由类别不平衡引起的偏差。\n\n**第 3 部分：数值计算**\n\n给定在时间 $t$ 实现的以下 EWMA 计数：\n$\\mathrm{TP}_{\\lambda}(t) = 180.0$\n$\\mathrm{FP}_{\\lambda}(t) = 60.0$\n$\\mathrm{FN}_{\\lambda}(t) = 220.0$\n$\\mathrm{TN}_{\\lambda}(t) = 1540.0$\n\n首先，我们计算估计的各类别命中率 $\\hat{\\theta}_p(t)$ 和 $\\hat{\\theta}_n(t)$：\n$$\n\\hat{\\theta}_p(t) = \\frac{180.0}{180.0 + 220.0} = \\frac{180.0}{400.0} = 0.45\n$$\n$$\n\\hat{\\theta}_n(t) = \\frac{1540.0}{60.0 + 1540.0} = \\frac{1540.0}{1600.0} = \\frac{154}{160} = \\frac{77}{80} = 0.9625\n$$\n现在，我们计算校准流式分数 $\\widehat{S}_{BA,\\lambda}(t)$：\n$$\n\\widehat{S}_{BA,\\lambda}(t) = \\frac{\\hat{\\theta}_p(t) + \\hat{\\theta}_n(t)}{2} = \\frac{0.45 + 0.9625}{2} = \\frac{1.4125}{2} = 0.70625\n$$\n问题要求答案四舍五入到五位有效数字。计算出的值 $0.70625$ 恰好有五位有效数字。",
            "answer": "$$\n\\boxed{0.70625}\n$$"
        }
    ]
}