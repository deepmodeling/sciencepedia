{
    "hands_on_practices": [
        {
            "introduction": "在设计任何复杂的实时解码器之前，我们必须首先理解我们测量系统的基本物理限制。本练习将我们带回神经接口的物理基础，探讨由电极热噪声（即约翰逊-奈奎斯特噪声）设定的性能下限。通过从第一性原理推导并计算噪声基底，我们可以确定能够可靠检测到的最小神经信号幅度，这是评估BCI系统可行性和指导硬件设计的关键一步。",
            "id": "4188846",
            "problem": "单个微电极用于实时脑机接口 (BCI) 闭环尖峰检测。采集链应用了一个通带范围为 $300\\,\\mathrm{Hz}$ 到 $3000\\,\\mathrm{Hz}$ 的因果带通滤波器来分离尖峰活动。在该频带内，微电极的阻抗主要由一个纯电阻分量决定，该分量可以建模为一个阻值为 $R = 5.0 \\times 10^{5}\\,\\Omega$ 的电阻。实验样本的温度为 $T = 310\\,\\mathrm{K}$。尖峰检测模块使用一个振幅阈值，该阈值的选择是为了达到一个特定的信噪比 (SNR)，此处定义为尖峰峰值振幅与滤波后信号中噪声均方根 (RMS) 振幅之比。信噪比阈值为 $\\gamma = 5.0$。\n\n从基本定义和关于约翰逊-奈奎斯特热噪声的涨落-耗散定理出发，并假设热噪声在通带内是平稳的白噪声，且电极的实部阻抗在通带内是恒定的，推导出电极上带限热电压噪声的均方根值，然后计算在这种闭环设置下满足信噪比阈值所需的最小尖峰峰值振幅。将总噪声视为仅由电极的约翰逊-奈奎斯特热噪声产生，并忽略任何放大器或 $1/f$ 噪声的贡献。\n\n令 $k_{B}$ 表示玻尔兹曼常数。滤波器带宽为 $B = f_{2} - f_{1}$，其中 $f_{1} = 300\\,\\mathrm{Hz}$，$f_{2} = 3000\\,\\mathrm{Hz}$。将每个最终值四舍五入到三位有效数字。以微伏为单位表示最终的噪声振幅和最小可检测尖峰振幅。你的最终答案必须以单行矩阵的形式包含这两个数值。",
            "solution": "首先验证问题，以确保其具有科学依据、提法恰当且客观。提取并评估所有给定条件。\n- **给定条件**：\n    - 滤波器通带下限频率：$f_{1} = 300\\,\\mathrm{Hz}$。\n    - 滤波器通带上限频率：$f_{2} = 3000\\,\\mathrm{Hz}$。\n    - 电极电阻：$R = 5.0 \\times 10^{5}\\,\\Omega$。\n    - 温度：$T = 310\\,\\mathrm{K}$。\n    - 信噪比阈值：$\\gamma = 5.0$。\n    - 常数：玻尔兹曼常数，$k_{B}$。\n- **假设**：\n    - 电极阻抗在通带内是纯电阻性的且恒定。\n    - 噪声完全是约翰逊-奈奎斯特热噪声。\n    - 热噪声在通带内是平稳的白噪声。\n    - 放大器噪声和 $1/f$ 噪声可以忽略不计。\n- **验证结论**：该问题有效。它基于物理学的基本原理（约翰逊-奈奎斯特噪声，涨落-耗散定理），并涉及神经生理学记录场景中的实际参数。该问题提法恰当，为求得唯一解提供了足够的信息。\n\n求解过程首先推导热噪声电压的均方根 (RMS) 值的表达式，然后使用给定的信噪比 (SNR) 来求出最小可检测尖峰振幅。\n\n问题要求从涨落-耗散定理开始。对于一个处于热平衡的系统，该定理将自发涨落的幅度与系统的耗散特性联系起来。对于一个阻抗为 $Z(f)$ 的电导体，该定理给出了开路热电压噪声的功率谱密度 (PSD)。单边功率谱密度 $S_v(f)$ 考虑了正频率上的功率，由下式给出：\n$$S_v(f) = 4 k_B T \\operatorname{Re}\\{Z(f)\\}$$\n其中 $k_{B}$ 是玻尔兹曼常数（约 $1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$），$T$ 是以开尔文为单位的绝对温度，$\\operatorname{Re}\\{Z(f)\\}$ 是频率 $f$ 下阻抗的实部（电阻）部分。\n\n问题指出，在所关心的频带内，电极的阻抗是纯电阻性的且恒定，电阻为 $R = 5.0 \\times 10^{5}\\,\\Omega$。因此，对于通带内的所有频率，$\\operatorname{Re}\\{Z(f)\\} = R$。噪声电压的功率谱密度在该频带内是恒定的：\n$$S_v(f) = 4 k_B T R$$\n这证实了问题中关于噪声在通带内是白噪声的假设。\n\n滤波器通带内的总均方噪声电压 $\\langle V_n^2 \\rangle$ 是通过在滤波器带宽 $B$ 上对功率谱密度进行积分得到的。带宽为 $B = f_2 - f_1$。\n$$\\langle V_n^2 \\rangle = \\int_{f_1}^{f_2} S_v(f) \\, df$$\n由于 $S_v(f)$ 在积分区间 $[f_1, f_2]$ 上是常数，我们有：\n$$\\langle V_n^2 \\rangle = 4 k_B T R \\int_{f_1}^{f_2} df = 4 k_B T R (f_2 - f_1) = 4 k_B T R B$$\n\n均方根 (RMS) 噪声电压 $V_{n, \\text{rms}}$ 是均方电压的平方根：\n$$V_{n, \\text{rms}} = \\sqrt{\\langle V_n^2 \\rangle} = \\sqrt{4 k_B T R B}$$\n现在我们将给定值代入此表达式。\n带宽为 $B = f_2 - f_1 = 3000\\,\\mathrm{Hz} - 300\\,\\mathrm{Hz} = 2700\\,\\mathrm{Hz}$。\n常数值为：\n$k_B \\approx 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$\n$T = 310\\,\\mathrm{K}$\n$R = 5.0 \\times 10^{5}\\,\\Omega$\n\n代入这些值：\n$$\\langle V_n^2 \\rangle = 4 \\times (1.380649 \\times 10^{-23}\\,\\mathrm{J/K}) \\times (310\\,\\mathrm{K}) \\times (5.0 \\times 10^{5}\\,\\Omega) \\times (2700\\,\\mathrm{Hz})$$\n$$\\langle V_n^2 \\rangle \\approx 2.31289 \\times 10^{-11}\\,\\mathrm{V}^2$$\n那么均方根噪声电压为：\n$$V_{n, \\text{rms}} = \\sqrt{2.31289 \\times 10^{-11}\\,\\mathrm{V}^2} \\approx 4.80925 \\times 10^{-6}\\,\\mathrm{V}$$\n以微伏 ($1\\,\\mu\\mathrm{V} = 10^{-6}\\,\\mathrm{V}$) 为单位表示该值：\n$$V_{n, \\text{rms}} \\approx 4.80925\\,\\mu\\mathrm{V}$$\n四舍五入到三位有效数字，均方根噪声电压为 $4.81\\,\\mu\\mathrm{V}$。\n\n接下来，我们计算满足信噪比阈值 $\\gamma$ 所需的最小尖峰峰值振幅 $A_{\\text{peak, min}}$。信噪比定义为尖峰峰值振幅与均方根噪声振幅之比：\n$$\\gamma = \\frac{A_{\\text{peak}}}{V_{n, \\text{rms}}}$$\n因此，最小可检测峰值振幅为：\n$$A_{\\text{peak, min}} = \\gamma \\cdot V_{n, \\text{rms}}$$\n使用给定的信噪比阈值 $\\gamma = 5.0$ 和未经四舍五入的 $V_{n, \\text{rms}}$ 值：\n$$A_{\\text{peak, min}} = 5.0 \\times (4.80925 \\times 10^{-6}\\,\\mathrm{V}) \\approx 2.404625 \\times 10^{-5}\\,\\mathrm{V}$$\n以微伏表示：\n$$A_{\\text{peak, min}} \\approx 24.04625\\,\\mu\\mathrm{V}$$\n四舍五入到三位有效数字，最小尖峰峰值振幅为 $24.0\\,\\mu\\mathrm{V}$。\n\n所需的两个值是均方根噪声振幅和最小可检测尖峰振幅，均以微伏为单位并四舍五入到三位有效数字。\n均方根噪声振幅为 $4.81\\,\\mu\\mathrm{V}$。\n最小可检测尖峰振幅为 $24.0\\,\\mu\\mathrm{V}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n4.81 & 24.0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在成功检测到神经信号后，下一步是评估解码器的分类性能，尤其是在实时流数据中。许多BCI应用，例如检测罕见的异常放电或特定的运动意图，都面临着严重的类别不平衡问题，这使得传统的准确率指标产生误导。本练习探讨了如何通过使用平衡准确率等对类别先验不敏感的度量，来构建一个更稳健的流式性能评估方案，以确保我们对解码器的真实性能有准确的认识。",
            "id": "4188866",
            "problem": "在实时脑机接口（BCI）中，一个二元解码器通过在每个时间步长决定潜在的运动意图是否存在（$y=1$）或不存在（$y=0$）来控制一个闭环干预。相对于静息状态，干预是罕见的，这导致了类别不平衡。为了在线评估性能，该系统使用遗忘因子 $\\lambda \\in (0,1)$ 来维护指数加权移动平均（EWMA）混淆计数：\n$$\n\\mathrm{TP}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 1,\\, y_{t-k} = 1\\right], \\quad\n\\mathrm{FP}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 1,\\, y_{t-k} = 0\\right],\n$$\n$$\n\\mathrm{FN}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 0,\\, y_{t-k} = 1\\right], \\quad\n\\mathrm{TN}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 0,\\, y_{t-k} = 0\\right].\n$$\n流式准确率估计器定义为\n$$\n\\widehat{A}_{\\lambda}(t) = \\frac{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{FP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}.\n$$\n从第一性原理出发，推导在一个由正类别先验概率 $\\,\\pi = \\mathbb{P}(y=1)\\,$、真阳性率 $\\,\\theta_{p} = \\mathbb{P}(\\hat{y}=1 \\mid y=1)\\,$ 和真阴性率 $\\,\\theta_{n} = \\mathbb{P}(\\hat{y}=0 \\mid y=0)\\,$ 表征的平稳窗口下，$\\widehat{A}_{\\lambda}(t)$ 的期望值。展示 $\\widehat{A}_{\\lambda}(t)$ 相对于一个对每个类别的命中率进行同等加权的类别先验不变分数的偏差，然后构建一个流式校准方案，该方案仅使用EWMA混淆计数，用这个类别先验不变分数的估计器来取代 $\\widehat{A}_{\\lambda}(t)$。\n\n最后，使用在时间 $t$、遗忘因子 $\\lambda = 0.95$ 下实现的以下EWMA计数，\n$$\n\\mathrm{TP}_{\\lambda}(t) = 180.0,\\quad \\mathrm{FP}_{\\lambda}(t) = 60.0,\\quad \\mathrm{FN}_{\\lambda}(t) = 220.0,\\quad \\mathrm{TN}_{\\lambda}(t) = 1540.0,\n$$\n计算你所推导的校准流式分数。将你的答案四舍五入到五位有效数字。将最终答案表示为在无单位区间 $[0,1]$ 内的一个小数。",
            "solution": "将通过首先验证其前提和结构来解决该问题，然后进行一个三部分的解答：(1) 推导流式准确率估计器的期望值，(2) 分析其偏差并构建一个校准的、类别先验不变的分数估计器，以及 (3) 使用所提供的数据计算该校准分数的值。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   二元潜在状态：$y \\in \\{0, 1\\}$，其中 $y=1$ (存在) 且 $y=0$ (不存在)。\n-   二元解码器预测：$\\hat{y} \\in \\{0, 1\\}$。\n-   EWMA 遗忘因子：$\\lambda \\in (0,1)$。\n-   时间 $t$ 时的 EWMA 混淆计数：\n    -   真阳性：$\\mathrm{TP}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 1,\\, y_{t-k} = 1\\right]$\n    -   假阳性：$\\mathrm{FP}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 1,\\, y_{t-k} = 0\\right]$\n    -   假阴性：$\\mathrm{FN}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 0,\\, y_{t-k} = 1\\right]$\n    -   真阴性：$\\mathrm{TN}_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^{k} \\,\\mathbf{1}\\!\\left[\\hat{y}_{t-k} = 0,\\, y_{t-k} = 0\\right]$\n-   流式准确率估计器定义：$\\widehat{A}_{\\lambda}(t) = \\frac{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{FP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}$。\n-   平稳窗口特征：\n    -   正类别先验概率：$\\pi = \\mathbb{P}(y=1)$\n    -   真阳性率（灵敏度）：$\\theta_{p} = \\mathbb{P}(\\hat{y}=1 \\mid y=1)$\n    -   真阴性率（特异度）：$\\theta_{n} = \\mathbb{P}(\\hat{y}=0 \\mid y=0)$\n-   在特定时间 $t$ 实现的 EWMA 计数：\n    -   $\\mathrm{TP}_{\\lambda}(t) = 180.0$\n    -   $\\mathrm{FP}_{\\lambda}(t) = 60.0$\n    -   $\\mathrm{FN}_{\\lambda}(t) = 220.0$\n    -   $\\mathrm{TN}_{\\lambda}(t) = 1540.0$\n-   遗忘因子值：$\\lambda = 0.95$。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学基础：** 该问题使用了机器学习和信号处理中用于评估流式（在线）设置下二元分类器的标准定义。EWMA 是一种用于在移动窗口上跟踪性能的常用技术。准确率、真/假阳性/阴性率以及类别先验等概念是分类理论的基础。\n-   **问题明确：** 问题结构清晰，要求进行具体的推导和最终计算。平稳过程的假设（恒定的 $\\pi$、$\\theta_p$、$\\theta_n$）使得期望值计算变得易于处理，并能得到唯一的解析解。\n-   **客观性：** 问题以精确的数学定义表述，避免了任何主观或模糊的语言。\n-   **未发现缺陷：** 该问题是自洽、一致且科学合理的。它没有违反任何无效性标准。\n\n**步骤 3：结论与行动**\n该问题是有效的。将提供一个完整的解答。\n\n### 解答推导\n\n**第 1 部分：流式准确率估计器的期望值**\n\n首先，我们分析 $\\widehat{A}_{\\lambda}(t)$ 的分母。令其为 $D_{\\lambda}(t)$。\n$$\nD_{\\lambda}(t) = \\mathrm{TP}_{\\lambda}(t) + \\mathrm{FP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)\n$$\n代入 EWMA 计数的定义：\n$$\nD_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^k \\left( \\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=1] + \\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=0] + \\mathbf{1}[\\hat{y}_{t-k}=0, y_{t-k}=1] + \\mathbf{1}[\\hat{y}_{t-k}=0, y_{t-k}=0] \\right)\n$$\n对于任何给定的时间步长 $t-k$，指示函数内的四个事件是互斥且穷尽的。因此，指示函数的和总是等于 $1$。\n$$\nD_{\\lambda}(t) = \\sum_{k=0}^{\\infty} \\lambda^k = \\frac{1}{1-\\lambda}\n$$\n这是一个确定性的常数，给定 $\\lambda$。\n\n接下来，我们求分子的期望值，$N_{\\lambda}(t) = \\mathrm{TP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)$。利用期望的线性性质：\n$$\n\\mathbb{E}[N_{\\lambda}(t)] = \\mathbb{E}[\\mathrm{TP}_{\\lambda}(t)] + \\mathbb{E}[\\mathrm{TN}_{\\lambda}(t)]\n$$\n我们需要每个 EWMA 计数的期望值。对于 $\\mathrm{TP}_{\\lambda}(t)$：\n$$\n\\mathbb{E}[\\mathrm{TP}_{\\lambda}(t)] = \\mathbb{E}\\left[\\sum_{k=0}^{\\infty} \\lambda^k \\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=1]\\right] = \\sum_{k=0}^{\\infty} \\lambda^k \\mathbb{E}[\\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=1]]\n$$\n指示函数的期望是它所指示事件的概率。在平稳性假设下，这个概率对于所有的 $k$ 都是恒定的。\n$$\n\\mathbb{E}[\\mathbf{1}[\\hat{y}_{t-k}=1, y_{t-k}=1]] = \\mathbb{P}(\\hat{y}=1, y=1) = \\mathbb{P}(\\hat{y}=1|y=1)\\mathbb{P}(y=1) = \\theta_p \\pi\n$$\n因此，\n$$\n\\mathbb{E}[\\mathrm{TP}_{\\lambda}(t)] = \\sum_{k=0}^{\\infty} \\lambda^k (\\theta_p \\pi) = (\\theta_p \\pi) \\sum_{k=0}^{\\infty} \\lambda^k = \\frac{\\theta_p \\pi}{1-\\lambda}\n$$\n同样，对于 $\\mathrm{TN}_{\\lambda}(t)$：\n$$\n\\mathbb{P}(\\hat{y}=0, y=0) = \\mathbb{P}(\\hat{y}=0|y=0)\\mathbb{P}(y=0) = \\theta_n (1-\\pi)\n$$\n$$\n\\mathbb{E}[\\mathrm{TN}_{\\lambda}(t)] = \\frac{\\theta_n (1-\\pi)}{1-\\lambda}\n$$\n分子的期望值则为：\n$$\n\\mathbb{E}[N_{\\lambda}(t)] = \\frac{\\theta_p \\pi}{1-\\lambda} + \\frac{\\theta_n (1-\\pi)}{1-\\lambda} = \\frac{\\theta_p \\pi + \\theta_n (1-\\pi)}{1-\\lambda}\n$$\n由于分母 $D_{\\lambda}(t)$ 是一个常数，估计器 $\\widehat{A}_{\\lambda}(t)$ 的期望值是期望分子与分母的比值：\n$$\n\\mathbb{E}[\\widehat{A}_{\\lambda}(t)] = \\frac{\\mathbb{E}[N_{\\lambda}(t)]}{D_{\\lambda}(t)} = \\frac{\\frac{\\theta_p \\pi + \\theta_n (1-\\pi)}{1-\\lambda}}{\\frac{1}{1-\\lambda}} = \\theta_p \\pi + \\theta_n (1-\\pi)\n$$\n这是准确率的标准公式，证实了流式估计器是潜在过程真实准确率的无偏估计器。\n\n**第 2 部分：偏差分析与校准估计器的构建**\n\n问题定义了一个“对每个类别的命中率进行同等加权的类别先验不变分数”。每个类别的命中率是真阳性率 $\\theta_p$ 和真阴性率 $\\theta_n$。一个同等加权的分数是它们的算术平均值，即平衡准确率（$S_{BA}$）的定义。\n$$\nS_{BA} = \\frac{\\theta_p + \\theta_n}{2}\n$$\n$\\widehat{A}_{\\lambda}(t)$ 相对于此分数的偏差是它们期望值之间的差：\n$$\n\\text{Bias} = \\mathbb{E}[\\widehat{A}_{\\lambda}(t)] - S_{BA} = \\left[ \\theta_p \\pi + \\theta_n (1-\\pi) \\right] - \\frac{\\theta_p + \\theta_n}{2}\n$$\n$$\n\\text{Bias} = \\theta_p \\left( \\pi - \\frac{1}{2} \\right) + \\theta_n \\left( 1 - \\pi - \\frac{1}{2} \\right) = \\theta_p \\left( \\pi - \\frac{1}{2} \\right) - \\theta_n \\left( \\pi - \\frac{1}{2} \\right)\n$$\n$$\n\\text{Bias} = (\\theta_p - \\theta_n)\\left(\\pi - \\frac{1}{2}\\right)\n$$\n这表明，只要类别先验不平衡（$\\pi \\neq 1/2$）且每个类别的命中率不相等（$\\theta_p \\neq \\theta_n$），准确率估计器相对于平衡分数就是有偏的。正如问题所指出的，干预是罕见的，意味着 $\\pi$ 很小，所以 $\\pi - 1/2$ 是负数，导致显著的偏差。\n\n要为 $S_{BA}$ 构建一个流式估计器，我们必须首先从可用的 EWMA 计数中估计 $\\theta_p$ 和 $\\theta_n$。$\\theta_p$ 和 $\\theta_n$ 的定义涉及总体计数的比率：\n$$\n\\theta_p = \\frac{\\mathbb{P}(\\hat{y}=1, y=1)}{\\mathbb{P}(y=1)} = \\frac{\\mathbb{P}(\\text{TP})}{\\mathbb{P}(\\text{TP}) + \\mathbb{P}(\\text{FN})}, \\quad \\theta_n = \\frac{\\mathbb{P}(\\hat{y}=0, y=0)}{\\mathbb{P}(y=0)} = \\frac{\\mathbb{P}(\\text{TN})}{\\mathbb{P}(\\text{TN}) + \\mathbb{P}(\\text{FP})}\n$$\n我们可以通过用其 EWMA 对应项替换真实概率/计数来形成 $\\theta_p$ 和 $\\theta_n$ 的估计器。EWMA 计数 $\\mathrm{TP}_{\\lambda}(t)$ 等是作为近期时间窗口内总计数的代理的加权和。\n阳性实例总数的 EWMA 是 $\\mathrm{P}_{\\lambda}(t) = \\mathrm{TP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t)$。\n阴性实例总数的 EWMA 是 $\\mathrm{N}_{\\lambda}(t) = \\mathrm{FP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)$。\n因此，每个类别命中率的流式估计器是：\n$$\n\\hat{\\theta}_p(t) = \\frac{\\mathrm{TP}_{\\lambda}(t)}{\\mathrm{P}_{\\lambda}(t)} = \\frac{\\mathrm{TP}_{\\lambda}(t)}{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t)}\n$$\n$$\n\\hat{\\theta}_n(t) = \\frac{\\mathrm{TN}_{\\lambda}(t)}{\\mathrm{N}_{\\lambda}(t)} = \\frac{\\mathrm{TN}_{\\lambda}(t)}{\\mathrm{FP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)}\n$$\n校准的流式分数，我们记为 $\\widehat{S}_{BA,\\lambda}(t)$，是通过代入这些估计器构建的平衡准确率的估计器：\n$$\n\\widehat{S}_{BA,\\lambda}(t) = \\frac{\\hat{\\theta}_p(t) + \\hat{\\theta}_n(t)}{2} = \\frac{1}{2} \\left( \\frac{\\mathrm{TP}_{\\lambda}(t)}{\\mathrm{TP}_{\\lambda}(t) + \\mathrm{FN}_{\\lambda}(t)} + \\frac{\\mathrm{TN}_{\\lambda}(t)}{\\mathrm{FP}_{\\lambda}(t) + \\mathrm{TN}_{\\lambda}(t)} \\right)\n$$\n这就是所期望的校准方案。它提供了平衡准确率的在线估计，减轻了由类别不平衡引起的偏差。\n\n**第 3 部分：数值计算**\n\n给定在时间 $t$ 实现的以下 EWMA 计数：\n$\\mathrm{TP}_{\\lambda}(t) = 180.0$\n$\\mathrm{FP}_{\\lambda}(t) = 60.0$\n$\\mathrm{FN}_{\\lambda}(t) = 220.0$\n$\\mathrm{TN}_{\\lambda}(t) = 1540.0$\n\n首先，我们计算估计的各类别命中率，$\\hat{\\theta}_p(t)$ 和 $\\hat{\\theta}_n(t)$：\n$$\n\\hat{\\theta}_p(t) = \\frac{180.0}{180.0 + 220.0} = \\frac{180.0}{400.0} = 0.45\n$$\n$$\n\\hat{\\theta}_n(t) = \\frac{1540.0}{60.0 + 1540.0} = \\frac{1540.0}{1600.0} = \\frac{154}{160} = \\frac{77}{80} = 0.9625\n$$\n现在，我们计算校准的流式分数，$\\widehat{S}_{BA,\\lambda}(t)$：\n$$\n\\widehat{S}_{BA,\\lambda}(t) = \\frac{\\hat{\\theta}_p(t) + \\hat{\\theta}_n(t)}{2} = \\frac{0.45 + 0.9625}{2} = \\frac{1.4125}{2} = 0.70625\n$$\n问题要求答案四舍五入到五位有效数字。计算出的值 $0.70625$ 已经恰好是五位有效数字。",
            "answer": "$$\n\\boxed{0.70625}\n$$"
        },
        {
            "introduction": "闭环BCI的最终目标是利用解码器的输出来实时调控神经活动，从而形成一个完整的反馈系统。这种“解码-刺激”的互动引入了控制器与被控对象（大脑）之间的动态耦合，其稳定性至关重要。本练习应用现代控制理论中的一个基石——分离原理——来分析整个闭环系统的稳定性，确保解码器与神经刺激的结合能够安全、可预测地运行，而不会导致不稳定的振荡或意外的后果。",
            "id": "4188920",
            "problem": "给定一个由刺激输入驱动并通过线性测量过程观测的离散时间线性时不变神经群体模型。其对象动态和观测方程建模如下：对于每个整数时间索引 $t \\ge 0$，\n$x_{t+1} = A x_t + B u_t + w_t$ 且 $y_t = C x_t + v_t$，\n其中 $x_t \\in \\mathbb{R}^{n}$ 是神经状态， $u_t \\in \\mathbb{R}^{m_u}$ 是控制器传递的刺激幅度， $y_t \\in \\mathbb{R}^{m_y}$ 是观测值， $w_t \\in \\mathbb{R}^{n}$ 和 $v_t \\in \\mathbb{R}^{m_y}$ 是独立的零均值高斯噪声过程，其协方差分别为 $W \\in \\mathbb{S}_{+}^{n}$ 和 $V \\in \\mathbb{S}_{+}^{m_y}$ 。控制器只能访问观测值 $y_t$ ，并使用由线性估计器生成的因果状态估计 $\\hat{x}_t$ 。控制器通过 $u_t = -K \\hat{x}_t$ 线性地调制刺激幅度，其中 $K \\in \\mathbb{R}^{m_u \\times n}$ 是一个反馈增益，需要根据带有状态和输入权重的二次型代价函数进行设计。估计器被选为稳态线性最小方差估计器，其增益 $L \\in \\mathbb{R}^{n \\times m_y}$ 从噪声协方差 $W$ 和 $V$ 导出。\n\n任务 1（推导）：从离散时间线性系统、高斯噪声、线性二次型调节和线性最小方差估计的基本定义出发，推导组合的神经刺激-解码器闭环系统在均值上指数稳定（即，对于零均值噪声，期望状态范数以指数速度衰减到零）的条件。在您的推导中，用估计状态和估计误差来表示增广系统的闭环确定性均值动态。然后，推导出一个关于由 $A$、$B$、$C$、$K$ 和 $L$ 构建的矩阵的谱半径的指数稳定性的充要条件。您的推导必须仅以数学形式呈现，不借助于任何领域特定的启发式方法。\n\n任务 2（算法设计）：设计一个算法，对于下面给出的每个测试用例，构建：\n- 一个稳定的线性二次型调节器（LQR）状态反馈增益 $K$，通过求解与二次型代价 $\\sum_{t=0}^{\\infty} \\left( x_t^\\top Q_c x_t + u_t^\\top R_c u_t \\right)$ 相关的离散时间代数Riccati方程，其中给定 $Q_c \\in \\mathbb{S}_{+}^{n}$ 和 $R_c \\in \\mathbb{S}_{++}^{m_u}$。\n- 一个稳态线性最小方差估计器（卡尔曼滤波器）增益 $L$，通过使用 $W$ 和 $V$ 求解与对偶估计问题相关的离散时间代数Riccati方程。\n\n然后，评估在任务1中推导出的闭环稳定性谱半径条件。对于每个测试用例，输出一个布尔值，指示组合系统是否指数稳定。\n\n测试套件：\n提供一个使用以下四个测试用例的程序。所有矩阵都明确给出。在每种情况下，$n = 2$。\n\n- 测试用例 $1$（理想情况，可镇定且可检测）：\n  - $A = \\begin{bmatrix} 1.1 & 0.1 \\\\ 0.0 & 0.95 \\end{bmatrix}$,\n  - $B = \\begin{bmatrix} 0.1 \\\\ 0.05 \\end{bmatrix}$,\n  - $C = \\begin{bmatrix} 1.0 & 0.0 \\\\ 0.0 & 1.0 \\end{bmatrix}$,\n  - $Q_c = \\begin{bmatrix} 1.0 & 0.0 \\\\ 0.0 & 1.0 \\end{bmatrix}$,\n  - $R_c = \\begin{bmatrix} 0.1 \\end{bmatrix}$,\n  - $W = \\begin{bmatrix} 0.01 & 0.0 \\\\ 0.0 & 0.01 \\end{bmatrix}$,\n  - $V = \\begin{bmatrix} 0.05 & 0.0 \\\\ 0.0 & 0.05 \\end{bmatrix}$。\n\n- 测试用例 $2$（边界情况，一个边际不稳定模式通过耦合实现稳定；可检测）：\n  - $A = \\begin{bmatrix} 1.0 & 0.2 \\\\ 0.0 & 0.9 \\end{bmatrix}$,\n  - $B = \\begin{bmatrix} 0.0 \\\\ 1.0 \\end{bmatrix}$,\n  - $C = \\begin{bmatrix} 1.0 & 0.0 \\end{bmatrix}$,\n  - $Q_c = \\begin{bmatrix} 1.0 & 0.0 \\\\ 0.0 & 1.0 \\end{bmatrix}$,\n  - $R_c = \\begin{bmatrix} 0.5 \\end{bmatrix}$,\n  - $W = \\begin{bmatrix} 0.02 & 0.0 \\\\ 0.0 & 0.02 \\end{bmatrix}$,\n  - $V = \\begin{bmatrix} 0.2 \\end{bmatrix}$。\n\n- 测试用例 $3$（不可镇定：一个不稳定模式不可控）：\n  - $A = \\begin{bmatrix} 1.2 & 0.0 \\\\ 0.0 & 0.9 \\end{bmatrix}$,\n  - $B = \\begin{bmatrix} 0.0 \\\\ 1.0 \\end{bmatrix}$,\n  - $C = \\begin{bmatrix} 1.0 & 0.0 \\\\ 0.0 & 1.0 \\end{bmatrix}$,\n  - $Q_c = \\begin{bmatrix} 1.0 & 0.0 \\\\ 0.0 & 1.0 \\end{bmatrix}$,\n  - $R_c = \\begin{bmatrix} 0.1 \\end{bmatrix}$,\n  - $W = \\begin{bmatrix} 0.01 & 0.0 \\\\ 0.0 & 0.01 \\end{bmatrix}$,\n  - $V = \\begin{bmatrix} 0.05 & 0.0 \\\\ 0.0 & 0.05 \\end{bmatrix}$。\n\n- 测试用例 $4$（不可检测：一个不稳定模式不可观测）：\n  - $A = \\begin{bmatrix} 1.1 & 0.0 \\\\ 0.0 & 0.95 \\end{bmatrix}$,\n  - $B = \\begin{bmatrix} 0.1 \\\\ 0.05 \\end{bmatrix}$,\n  - $C = \\begin{bmatrix} 0.0 & 1.0 \\end{bmatrix}$,\n  - $Q_c = \\begin{bmatrix} 1.0 & 0.0 \\\\ 0.0 & 1.0 \\end{bmatrix}$,\n  - $R_c = \\begin{bmatrix} 0.1 \\end{bmatrix}$,\n  - $W = \\begin{bmatrix} 0.01 & 0.0 \\\\ 0.0 & 0.01 \\end{bmatrix}$,\n  - $V = \\begin{bmatrix} 0.05 \\end{bmatrix}$。\n\n答案规格：\n- 您的程序必须为每个测试用例计算一个布尔值，根据您在任务1中推导出的稳定性条件，指示组合的闭环系统（使用设计的 $K$ 和 $L$）是否在均值上指数稳定。\n- 最终输出必须是单行文本，包含一个用方括号括起来的逗号分隔列表。例如，如果有四个布尔值 $b_1,b_2,b_3,b_4$，则程序应精确打印 `[b_1,b_2,b_3,b_4]` 这一行，不得有额外的文本或空白差异。\n- 此问题中没有物理单位；所有量均为无量纲量。",
            "solution": "该问题要求推导离散时间线性二次型高斯（LQG）控制系统的稳定性条件，并随后为几个测试用例设计和分析这样的系统。该分析基于线性系统理论、最优控制和状态估计的基本原理。\n\n### **问题陈述的验证**\n\n**第1步：提取给定信息**\n\n*   **系统模型（对象动态）：** $x_{t+1} = A x_t + B u_t + w_t$，对于整数时间索引 $t \\ge 0$。\n*   **系统模型（观测）：** $y_t = C x_t + v_t$。\n*   **状态与信号维度：** $x_t \\in \\mathbb{R}^{n}$， $u_t \\in \\mathbb{R}^{m_u}$， $y_t \\in \\mathbb{R}^{m_y}$。\n*   **系统矩阵：** $A \\in \\mathbb{R}^{n \\times n}$， $B \\in \\mathbb{R}^{n \\times m_u}$， $C \\in \\mathbb{R}^{m_y \\times n}$。\n*   **噪声过程：** $w_t \\in \\mathbb{R}^{n}$ 和 $v_t \\in \\mathbb{R}^{m_y}$ 是独立的零均值高斯过程，其协方差分别为 $W \\in \\mathbb{S}_{+}^{n}$ 和 $V \\in \\mathbb{S}_{+}^{m_y}$ 。$\\mathbb{S}_{+}^{k}$ 表示 $k \\times k$ 正半定矩阵的集合。\n*   **控制器：** $u_t = -K \\hat{x}_t$，其中 $K \\in \\mathbb{R}^{m_u \\times n}$ 是反馈增益， $\\hat{x}_t$ 是因果状态估计。\n*   **估计器：** 增益为 $L \\in \\mathbb{R}^{n \\times m_y}$ 的稳态线性最小方差估计器（卡尔曼滤波器）。\n*   **LQR代价函数：** $\\sum_{t=0}^{\\infty} \\left( x_t^\\top Q_c x_t + u_t^\\top R_c u_t \\right)$，其中给定 $Q_c \\in \\mathbb{S}_{+}^{n}$ 和 $R_c \\in \\mathbb{S}_{++}^{m_u}$。$\\mathbb{S}_{++}^{k}$ 表示 $k \\times k$ 正定矩阵的集合。\n*   **任务：**\n    1.  推导闭环系统在均值上指数稳定的条件，以由 $A, B, C, K, L$ 构建的矩阵的谱半径表示。\n    2.  设计一种算法，通过求解离散时间代数Riccati方程（DARE）来找到 $K$ 和 $L$，并为给定的测试用例评估稳定性。\n*   **测试套件：** 提供了四个不同的测试用例，包含 $A, B, C, Q_c, R_c, W, V$ 的明确数值矩阵。\n\n**第2步：使用提取的给定信息进行验证**\n\n该问题陈述具有科学依据，定义明确且客观。它代表了现代控制理论中一个标准且基本的问题：LQG控制器的设计与分析。\n1.  **科学合理性：** 模型是一个带有高斯噪声的离散时间线性时不变系统，控制器基于线性二次型调节和卡尔曼滤波。这些都是控制工程和应用数学中规范且成熟的概念。\n2.  **可形式化性：** 问题以精确的数学术语陈述，所有组成部分都可以形式化并用算法解决。\n3.  **完整性：** 为特定的算法任务提供了所有必需的矩阵和参数（$A, B, C, Q_c, R_c, W, V$）。推导任务依赖于第一性原理，而不是缺失的信息。\n4.  **现实性：** 该问题是一个理想化的数学模型，但并非物理上不可能或不一致。\n5.  **适定性：** 找到稳定化增益 $K$ 和 $L$ 的问题在分别满足可镇定性和可检测性的条件下是适定的。测试套件旨在探讨这些条件，使得问题的结构成为一个特点，而非缺陷。对每个案例的稳定性分析都会得出唯一的结论。\n\n**第3步：结论与行动**\n\n问题被判定为**有效**。将提供解决方案。\n\n### **任务1：闭环稳定性条件的推导**\n\n目标是确定期望状态 $E[x_t]$ 收敛到零的条件。这被定义为均值指数稳定。该分析依赖于LQG控制的分离原理。\n\n我们从系统动态以及控制器和估计器的定义开始。\n对象状态演化如下：\n$$x_{t+1} = A x_t + B u_t + w_t$$\n观测值为：\n$$y_t = C x_t + v_t$$\n控制律基于状态估计 $\\hat{x}_t$：\n$$u_t = -K \\hat{x}_t$$\n状态估计 $\\hat{x}_t$ 由稳态卡尔曼滤波器生成。滤波器动态由预测步骤和校正步骤给出。估计 $\\hat{x}_t$（解释为 $\\hat{x}_{t|t}$）的组合一步更新方程为：\n$$\\hat{x}_{t+1} = A \\hat{x}_t + B u_t + L (y_{t+1} - C(A \\hat{x}_t + B u_t))$$\n然而，更直接的方法是分析估计和估计误差的动态。设估计误差为 $e_t = x_t - \\hat{x}_t$。标准的稳态后验卡尔曼滤波器更新方程为：\n$$\\hat{x}_{t+1} = A\\hat{x}_t + B u_t + L(y_t - C\\hat{x}_t)$$\n代入 $y_t = C x_t + v_t = C(\\hat{x}_t + e_t) + v_t$ 和 $u_t = -K\\hat{x}_t$：\n$$\\hat{x}_{t+1} = A\\hat{x}_t - B K \\hat{x}_t + L(C(\\hat{x}_t + e_t) + v_t - C\\hat{x}_t)$$\n$$\\hat{x}_{t+1} = (A - B K)\\hat{x}_t + L C e_t + L v_t$$\n这个方程描述了状态估计的演化。\n\n接下来，我们推导估计误差 $e_t = x_t - \\hat{x}_t$ 的动态。\n$$e_{t+1} = x_{t+1} - \\hat{x}_{t+1}$$\n代入 $x_{t+1}$ 和 $\\hat{x}_{t+1}$ 的表达式：\n$$x_{t+1} = A x_t - B K \\hat{x}_t + w_t = A(\\hat{x}_t + e_t) - B K \\hat{x}_t + w_t = (A-BK)\\hat{x}_t + A e_t + w_t$$\n$$e_{t+1} = ((A - BK)\\hat{x}_t + A e_t + w_t) - ((A - B K)\\hat{x}_t + L C e_t + L v_t)$$\n$$e_{t+1} = (A - L C)e_t + w_t - L v_t$$\n这个方程描述了估计误差的演化，它独立于状态估计 $\\hat{x}_t$。\n\n我们现在可以构成一个增广状态向量 $\\xi_t = \\begin{bmatrix} \\hat{x}_t \\\\ e_t \\end{bmatrix}$。这个增广系统的动态是：\n$$\n\\begin{bmatrix} \\hat{x}_{t+1} \\\\ e_{t+1} \\end{bmatrix} =\n\\begin{pmatrix} A-BK & LC \\\\ 0 & A-LC \\end{pmatrix}\n\\begin{bmatrix} \\hat{x}_t \\\\ e_t \\end{bmatrix}\n+\n\\begin{pmatrix} L & 0 \\\\ -L & I \\end{pmatrix}\n\\begin{bmatrix} v_t \\\\ w_t \\end{bmatrix}\n$$\n令闭环状态转移矩阵为 $A_{cl} = \\begin{pmatrix} A-BK & LC \\\\ 0 & A-LC \\end{pmatrix}$。\n\n问题要求均值指数稳定。我们取增广系统动态的期望。由于 $w_t$ 和 $v_t$ 是零均值过程，所以 $E[w_t]=0$ 和 $E[v_t]=0$。\n令 $\\bar{\\xi}_t = E[\\xi_t] = \\begin{bmatrix} E[\\hat{x}_t] \\\\ E[e_t] \\end{bmatrix}$。均值动态为：\n$$\n\\bar{\\xi}_{t+1} = E\\left[ A_{cl} \\xi_t + \\begin{pmatrix} L & 0 \\\\ -L & I \\end{pmatrix} \\begin{bmatrix} v_t \\\\ w_t \\end{bmatrix} \\right] = A_{cl} E[\\xi_t] + 0 = A_{cl} \\bar{\\xi}_t\n$$\n原始状态的均值为 $E[x_t] = E[\\hat{x}_t + e_t]$。如果对于任何初始条件 $\\bar{\\xi}_0$，当 $t \\to \\infty$ 时 $\\bar{\\xi}_t \\to 0$，则系统在均值上是指数稳定的。对于离散时间线性系统 $\\bar{\\xi}_{t+1} = A_{cl} \\bar{\\xi}_t$，这成立的充要条件是 $A_{cl}$ 的所有特征值都严格位于复平面的单位圆内。这等价于 $A_{cl}$ 的谱半径，记为 $\\rho(A_{cl})$，小于1的条件。\n$$\\rho(A_{cl}) < 1$$\n由于 $A_{cl}$ 是一个块上三角矩阵，它的特征值是其对角块 $(A-BK)$ 和 $(A-LC)$ 的特征值的并集。因此，条件 $\\rho(A_{cl}) < 1$ 等价于以下两个独立条件：\n$$\n\\rho(A-BK) < 1 \\quad \\text{且} \\quad \\rho(A-LC) < 1\n$$\n这就是离散时间系统的分离原理。控制器的稳定性，由调节器矩阵 $(A-BK)$ 的特征值决定，可以独立于估计器的稳定性进行分析，估计器的稳定性由误差动态矩阵 $(A-LC)$ 的特征值决定。\n\n### **任务2：算法设计**\n\n该算法必须首先计算控制器增益 $K$ 和估计器增益 $L$，然后检查任务1中推导出的稳定性条件。\n\n**1. LQR控制器增益 $K$ 的设计**\n增益 $K$ 被设计用来最小化二次型代价 $\\sum_{t=0}^{\\infty} ( x_t^\\top Q_c x_t + u_t^\\top R_c u_t )$。最优增益由下式给出：\n$$K = (R_c + B^\\top P_c B)^{-1} B^\\top P_c A$$\n其中 $P_c$ 是控制的离散时间代数Riccati方程（DARE）的唯一正半定解：\n$$P_c = A^\\top P_c A - (A^\\top P_c B)(R_c + B^\\top P_c B)^{-1}(B^\\top P_c A) + Q_c$$\n存在稳定解的充要条件是 $(A, B)$ 对是可镇定的。如果 $A$ 的某个不可控模式是不稳定的（模长 $\\ge 1$），则无法找到这样的稳定化增益 $K$。\n\n**2. 卡尔曼滤波器增益 $L$ 的设计**\n增益 $L$ 是线性最小方差估计器（卡尔曼滤波器）的稳态增益。根据对偶性原理，此问题等价于一个对偶系统的LQR问题。增益 $L$ 由下式给出：\n$$L = P_e C^\\top (V + C P_e C^\\top)^{-1}$$\n其中 $P_e$ 是稳态误差协方差，它是滤波的DARE的唯一正半定解：\n$$P_e = A P_e A^\\top - (A P_e C^\\top)(V + C P_e C^\\top)^{-1}(C P_e A^\\top) + W$$\n为了使用为控制问题设计的标准DARE求解器来解决这个问题，我们使用对偶替换：$A \\to A^\\top$，$B \\to C^\\top$，$Q \\to W$，$R \\to V$。存在一个稳定解（即，一个使 $(A-LC)$ 稳定的解）的充要条件是 $(A, C)$ 对是可检测的（或等价地，$(A^\\top, C^\\top)$ 是可镇定的）。如果 $A$ 的某个不可观测模式是不稳定的（模长 $\\ge 1$），则无法找到这样的稳定化增益 $L$。\n\n**3. 总体算法**\n对于每个测试用例：\na. 尝试使用矩阵 $A, B, Q_c, R_c$ 求解控制DARE以获得 $P_c$。如果求解器失败（例如，如果 $(A,B)$ 不可镇定），则断定系统不稳定。\nb. 如果成功，计算增益 $K$ 和调节器矩阵 $A_{reg} = A - B K$。计算其谱半径 $\\rho(A_{reg})$。\nc. 尝试使用对偶矩阵 $A^\\top, C^\\top, W, V$ 求解滤波DARE以获得 $P_e$。如果求解器失败（例如，如果 $(A,C)$ 不可检测），则断定系统不稳定。\nd. 如果成功，计算增益 $L$ 和估计器误差矩阵 $A_{est} = A - L C$。计算其谱半径 $\\rho(A_{est})$。\ne. 组合系统在均值上指数稳定的充要条件是 $\\rho(A_{reg}) < 1$ 和 $\\rho(A_{est}) < 1$。算法将返回一个布尔值，指示此条件是否满足。如果任何步骤失败，结果为 `False`。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_discrete_are\n\ndef solve():\n    \"\"\"\n    Solves the LQG stability problem for the given test cases.\n\n    For each case, it designs an LQR controller and a Kalman filter, then\n    evaluates the stability of the combined closed-loop system based on the\n    separation principle.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1 (happy path, stabilizable and detectable)\n        {\n            \"A\": np.array([[1.1, 0.1], [0.0, 0.95]]),\n            \"B\": np.array([[0.1], [0.05]]),\n            \"C\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"Q_c\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"R_c\": np.array([[0.1]]),\n            \"W\": np.array([[0.01, 0.0], [0.0, 0.01]]),\n            \"V\": np.array([[0.05, 0.0], [0.0, 0.05]]),\n        },\n        # Test case 2 (boundary case, stabilizable and detectable)\n        {\n            \"A\": np.array([[1.0, 0.2], [0.0, 0.9]]),\n            \"B\": np.array([[0.0], [1.0]]),\n            \"C\": np.array([[1.0, 0.0]]),\n            \"Q_c\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"R_c\": np.array([[0.5]]),\n            \"W\": np.array([[0.02, 0.0], [0.0, 0.02]]),\n            \"V\": np.array([[0.2]]),\n        },\n        # Test case 3 (not stabilizable)\n        {\n            \"A\": np.array([[1.2, 0.0], [0.0, 0.9]]),\n            \"B\": np.array([[0.0], [1.0]]),\n            \"C\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"Q_c\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"R_c\": np.array([[0.1]]),\n            \"W\": np.array([[0.01, 0.0], [0.0, 0.01]]),\n            \"V\": np.array([[0.05, 0.0], [0.0, 0.05]]),\n        },\n        # Test case 4 (not detectable)\n        {\n            \"A\": np.array([[1.1, 0.0], [0.0, 0.95]]),\n            \"B\": np.array([[0.1], [0.05]]),\n            \"C\": np.array([[0.0, 1.0]]),\n            \"Q_c\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"R_c\": np.array([[0.1]]),\n            \"W\": np.array([[0.01, 0.0], [0.0, 0.01]]),\n            \"V\": np.array([[0.05]]),\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        A, B, C = params[\"A\"], params[\"B\"], params[\"C\"]\n        Q_c, R_c = params[\"Q_c\"], params[\"R_c\"]\n        W, V = params[\"W\"], params[\"V\"]\n\n        # --- Sub-problem 1: Controller Stability ---\n        is_controller_stable = False\n        try:\n            # Solve the discrete-time algebraic Riccati equation for the controller\n            # P = A'PA - (A'PB)(R + B'PB)^-1(B'PA) + Q\n            P_c = solve_discrete_are(A, B, Q_c, R_c)\n            \n            # Compute the LQR gain K\n            # K = (R + B'PB)^-1 B'PA\n            K = np.linalg.inv(R_c + B.T @ P_c @ B) @ (B.T @ P_c @ A)\n            \n            # Form the closed-loop regulator matrix\n            A_reg = A - B @ K\n            \n            # Check stability: spectral radius of (A - BK) must be  1\n            eigvals_reg = np.linalg.eigvals(A_reg)\n            spectral_radius_reg = np.max(np.abs(eigvals_reg))\n            \n            if spectral_radius_reg  1.0:\n                is_controller_stable = True\n        except np.linalg.LinAlgError:\n            # DARE solver fails if (A,B) is not stabilizable.\n            is_controller_stable = False\n\n        # --- Sub-problem 2: Estimator Stability ---\n        is_estimator_stable = False\n        try:\n            # Solve the DARE for the filter using duality:\n            # A -> A', B -> C', Q -> W, R -> V\n            P_e = solve_discrete_are(A.T, C.T, W, V)\n            \n            # Compute the Kalman gain L\n            # L = PC'(V + CPC')^-1\n            L = P_e @ C.T @ np.linalg.inv(V + C @ P_e @ C.T)\n            \n            # Form the closed-loop estimator matrix\n            A_est = A - L @ C\n            \n            # Check stability: spectral radius of (A - LC) must be  1\n            eigvals_est = np.linalg.eigvals(A_est)\n            spectral_radius_est = np.max(np.abs(eigvals_est))\n            \n            if spectral_radius_est  1.0:\n                is_estimator_stable = True\n        except np.linalg.LinAlgError:\n            # DARE solver fails if (A',C') is not stabilizable,\n            # which means (A,C) is not detectable.\n            is_estimator_stable = False\n            \n        # The overall system is stable iff both controller and estimator are stable\n        is_system_stable = is_controller_stable and is_estimator_stable\n        results.append(is_system_stable)\n\n    # Format the final output as specified\n    print(f\"[{','.join(str(r).lower() for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}