{
    "hands_on_practices": [
        {
            "introduction": "在神经科学数据分析中，一个常见的挑战是处理非高斯噪声，尤其是那些导致测量中出现异常值的重尾分布噪声。标准的卡尔曼滤波器在这种情况下会失效，而粒子滤波器则提供了一个灵活的框架来应对这一挑战。本练习将指导你如何为钙成像数据中常见的拉普拉斯噪声模型推导粒子滤波器的权重更新方程，并从原理上理解为什么这种方法比标准高斯模型更具稳健性。",
            "id": "4184449",
            "problem": "一个神经科学实验室使用钙成像技术来观察神经元活动。设潜在的细胞内钙离子浓度在时间 $t$ 由状态变量 $c_t$ 表示。成像测量被建模为 $y_t \\approx c_t + \\epsilon_t$，其中观测噪声 $\\epsilon_t$ 服从均值为零、尺度参数为 $b0$ 的拉普拉斯分布。钙动力学是非线性的，由尖峰依赖效应和生物物理衰减驱动，并为了推断，使用一个包含 $N$ 个离散粒子的集合进行近似。具体来说，假设使用一个引导粒子滤波器（PF）来跟踪 $c_t$，其中提议密度等于状态转移密度。在时间 $t-1$，滤波分布的粒子近似 $\\{c_{t-1}^{(i)}, w_{t-1}^{(i)}\\}_{i=1}^{N}$ 是可用的，经过非线性动力学传播后，可以获得时间 $t$ 的预测粒子 $\\{c_t^{(i)}\\}_{i=1}^{N}$。\n\n从贝叶斯滤波的原理、引导粒子滤波器（PF）的定义以及已知的拉普拉斯分布的概率密度函数出发，推导在时间 $t$ 时每个粒子 $i$ 的归一化重要性权重更新，用 $y_t$、$c_t^{(i)}$、$w_{t-1}^{(i)}$ 和 $b$ 表示。然后，从第一性原理出发，解释为什么与高斯观测噪声模型相比，这种更新赋予了对测量中离群值的鲁棒性。你的最终答案必须是归一化权重 $w_t^{(i)}$ 的一个单一闭式解析表达式，该表达式是 $y_t$、$c_t^{(i)}$、$w_{t-1}^{(i)}$ 和 $b$ 的函数。答案中不需要进行数值四舍五入，也不需要报告物理单位。",
            "solution": "该问题是有效的，因为它在计算神经科学和统计学方面有科学依据，问题提出得当，客观，并包含了进行严谨推导所需的所有信息。\n\n贝叶斯滤波器的目标是递归地估计状态 $c_t$ 的后验概率密度函数（PDF），给定截至时间 $t$ 的所有测量值，记为 $y_{1:t}$。该后验为 $p(c_t | y_{1:t})$。递归估计包括两个步骤：预测和更新。\n\n1.  **预测**：时间 $t$ 的预测密度是基于时间 $t-1$ 的后验计算得出的：\n    $$p(c_t | y_{1:t-1}) = \\int p(c_t | c_{t-1}) p(c_{t-1} | y_{1:t-1}) dc_{t-1}$$\n    其中 $p(c_t | c_{t-1})$ 是状态转移模型。\n\n2.  **更新**：通过贝叶斯法则，使用新的测量值 $y_t$ 来更新预测密度：\n    $$p(c_t | y_{1:t}) = \\frac{p(y_t | c_t) p(c_t | y_{1:t-1})}{p(y_t | y_{1:t-1})} \\propto p(y_t | c_t) p(c_t | y_{1:t-1})$$\n    其中 $p(y_t | c_t)$ 是从观测模型导出的似然函数。\n\n粒子滤波器（PF）使用一组 $N$ 个加权样本或“粒子”来近似这些分布。时间 $t-1$ 的后验表示为：\n$$p(c_{t-1} | y_{1:t-1}) \\approx \\sum_{i=1}^{N} w_{t-1}^{(i)} \\delta(c_{t-1} - c_{t-1}^{(i)})$$\n其中 $\\delta(\\cdot)$ 是狄拉克δ函数，而 $\\{c_{t-1}^{(i)}, w_{t-1}^{(i)}\\}_{i=1}^{N}$ 是粒子及其相关权重的集合，其中 $\\sum_{i=1}^{N} w_{t-1}^{(i)} = 1$。\n\n问题陈述我们已知预测粒子 $\\{c_t^{(i)}\\}_{i=1}^{N}$，它们是通过将每个粒子 $c_{t-1}^{(i)}$ 通过（可能是随机的）状态动力学传播得到的。对于引导粒子滤波器，生成新粒子的提议分布就是状态转移模型，$q(c_t | c_{t-1}, y_t) = p(c_t | c_{t-1})$。在这种简单情况下，上一步的粒子权重被带到预测粒子中。因此，预测分布近似为：\n$$p(c_t | y_{1:t-1}) \\approx \\sum_{i=1}^{N} w_{t-1}^{(i)} \\delta(c_t - c_t^{(i)})$$\n\n更新步骤涉及为每个粒子计算新的权重 $\\tilde{w}_t^{(i)}$，这取决于它能多好地解释新的测量值 $y_t$。根据重要性采样的原理，粒子 $i$ 的未归一化权重由其先验权重与给定该粒子状态下测量的似然的乘积给出：\n$$\\tilde{w}_t^{(i)} = w_{t-1}^{(i)} p(y_t | c_t^{(i)})$$\n$p(y_t | c_t^{(i)})$ 项是重要性权重。我们必须从问题陈述中推导出这一点。\n\n测量模型被给出为 $y_t \\approx c_t + \\epsilon_t$，或者更正式地，$y_t = c_t + \\epsilon_t$。测量噪声 $\\epsilon_t$ 服从均值为零、尺度参数为 $b > 0$ 的拉普拉斯分布。一个均值为 $\\mu$、尺度为 $b$ 的拉普拉斯分布随机变量 $x$ 的概率密度函数（PDF）是：\n$$f(x | \\mu, b) = \\frac{1}{2b} \\exp\\left(-\\frac{|x-\\mu|}{b}\\right)$$\n在我们的情况下，随机变量是噪声 $\\epsilon_t = y_t - c_t$，其均值为 $\\mu=0$。因此，似然函数 $p(y_t | c_t)$ 是在 $y_t - c_t$ 处求值的噪声的概率密度函数：\n$$p(y_t | c_t) = \\frac{1}{2b} \\exp\\left(-\\frac{|y_t - c_t|}{b}\\right)$$\n对于每个粒子 $c_t^{(i)}$，其似然为：\n$$p(y_t | c_t^{(i)}) = \\frac{1}{2b} \\exp\\left(-\\frac{|y_t - c_t^{(i)}|}{b}\\right)$$\n将此代入未归一化的权重更新方程，我们得到：\n$$\\tilde{w}_t^{(i)} = w_{t-1}^{(i)} \\frac{1}{2b} \\exp\\left(-\\frac{|y_t - c_t^{(i)}|}{b}\\right)$$\n为了获得归一化权重 $w_t^{(i)}$，我们将每个未归一化的权重除以所有未归一化权重的总和：\n$$w_t^{(i)} = \\frac{\\tilde{w}_t^{(i)}}{\\sum_{j=1}^{N} \\tilde{w}_t^{(j)}} = \\frac{w_{t-1}^{(i)} \\frac{1}{2b} \\exp\\left(-\\frac{|y_t - c_t^{(i)}|}{b}\\right)}{\\sum_{j=1}^{N} w_{t-1}^{(j)} \\frac{1}{2b} \\exp\\left(-\\frac{|y_t - c_t^{(j)}|}{b}\\right)}$$\n常数因子 $\\frac{1}{2b}$ 出现在分子和分母中求和的每一项中，因此可以消去。这就得到了归一化权重更新的最终表达式：\n$$w_t^{(i)} = \\frac{w_{t-1}^{(i)} \\exp\\left(-\\frac{|y_t - c_t^{(i)}|}{b}\\right)}{\\sum_{j=1}^{N} w_{t-1}^{(j)} \\exp\\left(-\\frac{|y_t - c_t^{(j)}|}{b}\\right)}$$\n\n接下来，我们从第一性原理出发，解释为什么该模型比高斯观测模型对离群值更具鲁棒性。对离群值的鲁棒性取决于似然函数 $p(y_t | c_t)$ 的性质。让我们比较一下拉普拉斯似然和高斯似然。一个均值为 $0$、方差为 $\\sigma^2$ 的高斯噪声模型会产生如下似然：\n$$p_G(y_t | c_t) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y_t - c_t)^2}{2\\sigma^2}\\right)$$\n分配给粒子的权重与此似然成正比。设粒子 $i$ 的预测误差为 $d^{(i)} = y_t - c_t^{(i)}$。\n对于拉普拉斯模型，似然与 $\\exp(-|d^{(i)}|/b)$ 成正比。\n对于高斯模型，似然与 $\\exp(-(d^{(i)})^2/(2\\sigma^2))$ 成正比。\n\n离群值是一个远离真实状态的测量值 $y_t$，因此也远离预测粒子云 $\\{c_t^{(i)}\\}$。这意味着对于大多数粒子来说，误差的幅度 $|d^{(i)}|$ 很大。\n\n在高斯情况下，指数中的似然惩罚项是误差的二次方，即 $(d^{(i)})^2$。随着 $|d^{(i)}|$ 的增加，这个惩罚项增长得非常迅速。因此，似然值会异常迅速地骤降至零。如果出现离群测量值，所有与先验动力学一致（因此远离离群值）的粒子都将被赋予接近零的权重。滤波器将被迫只对恰好在离群值附近的少数（或单个）游离粒子赋予显著权重，这可能导致滤波器完全失去对真实状态的跟踪。这种现象是高斯分布非常薄的尾部的结果，它隐含地假设大误差几乎是不可能发生的。\n\n在拉普拉斯情况下，似然惩罚项与误差的幅度 $|d^{(i)}|$ 是线性的。随着 $|d^{(i)}|$ 的增加，这个惩罚项仅线性增长，这比高斯模型中的二次增长慢得多。因此，似然呈指数衰减，但速度慢得多。当出现离群值时，与先验动力学一致的粒子的权重会降低，但不会降到高斯模型中看到的灾难性的近零值。它们保留了非平凡的权重，使得滤波器能够“不信任”离群测量值并保持对真实状态的跟踪。这种鲁棒性源于拉普拉斯分布的重尾特性，它为大误差事件（离群值）分配了比高斯分布更高的概率。从第一性原理的角度来看，选择拉普拉斯观测模型等同于陈述一个先验信念，即测量值可能被离群值污染，而高斯模型则反映了一种信念，即此类事件极为罕见。",
            "answer": "$$\\boxed{\\frac{w_{t-1}^{(i)} \\exp\\left(-\\frac{|y_t - c_t^{(i)}|}{b}\\right)}{\\sum_{j=1}^{N} w_{t-1}^{(j)} \\exp\\left(-\\frac{|y_t - c_t^{(j)}|}{b}\\right)}}$$"
        },
        {
            "introduction": "粒子滤波器的有效性在很大程度上取决于维持粒子集的多样性，但权重更新步骤后常常只有少数粒子拥有显著权重，导致所谓的“粒子退化”问题。重采样是解决此问题的标准方法，但不同的重采样策略会引入不同程度的随机性。本练习将深入探讨重采样步骤，通过定量分析最基本的多项式重采样引入的变异，来理解为什么分层重采样等更先进的策略在统计上更为优越，从而帮助你构建更高效的滤波器。",
            "id": "4184410",
            "problem": "一位神经科学家正在使用序列重要性重采样 (SIR) 粒子滤波器来推断一个非线性、非高斯状态空间模型中调制神经元脉冲发放强度的潜在突触驱动。在给定时间的加权步骤之后，有 $N$ 个粒子，其归一化权重为 $\\tilde{w}_{1},\\ldots,\\tilde{w}_{N}$，其中 $\\tilde{w}_{i} \\ge 0$ 且 $\\sum_{i=1}^{N} \\tilde{w}_{i} = 1$。重采样步骤为每个粒子 $i \\in \\{1,\\ldots,N\\}$ 分配一个整数后代数量 $N_{i}$，且满足 $\\sum_{i=1}^{N} N_{i} = N$，以形成下一代。\n\n您将仅使用核心概率论工具，在两种标准重采样方案下分析 $N_{i}$ 的变异性。\n\n1) 在多项式重采样下，算法从具有概率 $\\tilde{w}_{1},\\ldots,\\tilde{w}_{N}$ 的分类分布 $\\{1,\\ldots,N\\}$ 中执行 $N$ 次有放回的独立抽取。从 $N_{i}$ 的指示变量分解以及独立伯努利随机变量之和的方差性质出发，推导一个用 $N$ 和 $\\tilde{w}_{i}$ 表示 $\\mathrm{Var}(N_{i})$ 的闭式表达式。您的最终答案必须是单个解析表达式。\n\n2) 在分层重采样下，算法抽取 $U_{j} = \\frac{j-1+V_{j}}{N}$，其中对于 $j \\in \\{1,\\ldots,N\\}$，$V_{j} \\stackrel{\\mathrm{iid}}{\\sim} \\mathrm{Uniform}(0,1)$，并将每个 $U_{j}$ 分配给索引 $i$，使得 $U_{j} \\in (C_{i-1}, C_{i}]$，其中 $C_{k} = \\sum_{m=1}^{k} \\tilde{w}_{m}$ 且 $C_{0}=0$。仅使用 $U_{j}$ 的独立性以及 $U_{j}$ 在区间 $\\left(\\frac{j-1}{N}, \\frac{j}{N}\\right]$ 上均匀分布的事实，用 $(C_{i-1}, C_{i}]$ 与各层 $\\left(\\frac{j-1}{N}, \\frac{j}{N}\\right]$ 之间的重叠长度来表示 $\\mathrm{Var}(N_{i})$。然后，使用平方和的基本不等式，严格论证分层方差不大于您在第 $1)$ 部分得到的答案，并指出严格不等式何时成立。\n\n答案说明：只提供您在第 $1)$ 部分中为多项式重采样下的 $\\mathrm{Var}(N_{i})$ 推导出的表达式作为最终答案。不包括单位。无需四舍五入。",
            "solution": "该问题要求分析在两种不同的重采样方案（多项式重采样和分层重采样）下，粒子 $i$ 的后代数量 $N_i$ 的方差。\n\n第1部分：多项式重采样\n\n在多项式重采样下，通过从旧的粒子集合 $\\{1, \\ldots, N\\}$ 中有放回地独立抽取 $N$ 次，来形成新的 $N$ 个粒子集合。在任何单次抽取中，抽到粒子 $i$ 的概率由其归一化权重 $\\tilde{w}_i$ 给出。随机变量 $N_i$ 表示在这 $N$ 次抽取中粒子 $i$ 被选中的总次数。\n\n为了求 $N_i$ 的方差，记作 $\\mathrm{Var}(N_i)$，我们遵循问题的建议，使用指示变量分解。设 $I_j$ 为第 $j$ 次抽取的指示随机变量，其中 $j \\in \\{1, \\ldots, N\\}$。我们定义，如果在第 $j$ 次抽取中选中了粒子 $i$，则 $I_j=1$，否则 $I_j=0$。\n\n粒子 $i$ 的总计数是这 $N$ 次抽取的指示变量之和：\n$$\nN_i = \\sum_{j=1}^{N} I_j\n$$\n每次抽取都是一次伯努利试验，其“成功”概率为 $p = P(I_j=1) = \\tilde{w}_i$。每次抽取的结果都与其他次独立。因此，随机变量 $I_1, I_2, \\ldots, I_N$ 是独立同分布 (i.i.d.) 的伯努利随机变量，服从 $I_j \\sim \\mathrm{Bernoulli}(\\tilde{w}_i)$。\n\n单个伯努利随机变量 $I_j$ 的方差由下式给出：\n$$\n\\mathrm{Var}(I_j) = p(1-p) = \\tilde{w}_i(1-\\tilde{w}_i)\n$$\n方差的一个基本性质是，对于独立随机变量之和，和的方差等于方差的和。因此，\n$$\n\\mathrm{Var}(N_i) = \\mathrm{Var}\\left(\\sum_{j=1}^{N} I_j\\right) = \\sum_{j=1}^{N} \\mathrm{Var}(I_j)\n$$\n由于变量 $I_j$ 是同分布的，它们的方差都相等。因此，和简化为：\n$$\n\\mathrm{Var}(N_i) = N \\cdot \\mathrm{Var}(I_1) = N \\tilde{w}_i(1-\\tilde{w}_i)\n$$\n这就是多项式重采样下后代数量 $N_i$ 方差的闭式表达式。这个推导也证实了 $N_i$ 服从二项分布，$N_i \\sim \\mathrm{Binomial}(N, \\tilde{w}_i)$，对于该分布，此方差公式是一个标准结果。\n\n第2部分：分层重采样与比较\n\n在分层重采样下，区间 $(0, 1]$ 被划分为 $N$ 个不相交的层 $S_j = \\left(\\frac{j-1}{N}, \\frac{j}{N}\\right]$，其中 $j \\in \\{1, \\ldots, N\\}$。从每层中抽取一个均匀随机样本 $U_j$。粒子 $i$ 的后代数量 $N_i$ 是样本 $U_j$ 中落入粒子 $i$ 的累积权重区间 $I_i = (C_{i-1}, C_i]$ 的数量，其中 $C_k = \\sum_{m=1}^{k} \\tilde{w}_m$。这个区间的长度是 $\\text{length}(I_i) = C_i - C_{i-1} = \\tilde{w}_i$。\n\n后代数量可以写成指示变量的和：\n$$\nN_i = \\sum_{j=1}^{N} J_j, \\quad \\text{其中 } J_j = \\mathbf{1}_{I_i}(U_j) = \\begin{cases} 1  \\text{若 } U_j \\in I_i \\\\ 0  \\text{否则} \\end{cases}\n$$\n抽取的 $U_j$ 是独立的，这意味着指示变量 $J_j$ 也是独立的。$N_i$ 的方差同样是各项方差之和：\n$$\n\\mathrm{Var}(N_i)_{\\text{strat}} = \\sum_{j=1}^{N} \\mathrm{Var}(J_j)\n$$\n每个 $J_j$ 是一个伯努利随机变量。设 $p_{ij} = P(J_j=1) = P(U_j \\in I_i)$。由于 $U_j$ 在长度为 $1/N$ 的层 $S_j$ 上均匀分布，这个概率是两个区间交集的长度与该层长度的比值：\n$$\np_{ij} = \\frac{\\text{length}(I_i \\cap S_j)}{\\text{length}(S_j)} = \\frac{\\text{length}(I_i \\cap S_j)}{1/N} = N \\cdot \\text{length}(I_i \\cap S_j)\n$$\n每个 $J_j$ 的方差是 $\\mathrm{Var}(J_j) = p_{ij}(1-p_{ij})$。因此，总方差为：\n$$\n\\mathrm{Var}(N_i)_{\\text{strat}} = \\sum_{j=1}^{N} p_{ij}(1-p_{ij})\n$$\n这就是用重叠长度表示的分层方差的表达式。现在我们将其与多项式方差进行比较。在此方案下，$N_i$ 的期望值为 $E[N_i]_{\\text{strat}} = \\sum_{j=1}^{N} E[J_j] = \\sum_{j=1}^{N} p_{ij}$。由于层 $\\{S_j\\}$ 构成了 $(0, 1]$ 的一个划分，交集长度之和就是 $I_i$ 本身的长度：$\\sum_{j=1}^{N} \\text{length}(I_i \\cap S_j) = \\text{length}(I_i) = \\tilde{w}_i$。因此，$E[N_i]_{\\text{strat}} = \\sum_{j=1}^{N} N \\cdot \\text{length}(I_i \\cap S_j) = N \\tilde{w}_i$，这证实了该方案是无偏的，与多项式方案相同。\n\n我们可以将方差重写为：\n$$\n\\mathrm{Var}(N_i)_{\\text{multi}} = N\\tilde{w}_i - N\\tilde{w}_i^2\n$$\n$$\n\\mathrm{Var}(N_i)_{\\text{strat}} = \\sum_{j=1}^{N} p_{ij} - \\sum_{j=1}^{N} p_{ij}^2 = N\\tilde{w}_i - \\sum_{j=1}^{N} p_{ij}^2\n$$\n为了证明 $\\mathrm{Var}(N_i)_{\\text{strat}} \\le \\mathrm{Var}(N_i)_{\\text{multi}}$，我们必须证明 $N\\tilde{w}_i - \\sum_{j=1}^{N} p_{ij}^2 \\le N\\tilde{w}_i - N\\tilde{w}_i^2$，这等价于证明：\n$$\n\\sum_{j=1}^{N} p_{ij}^2 \\ge N\\tilde{w}_i^2\n$$\n我们知道 $\\sum_{j=1}^{N} p_{ij} = N\\tilde{w}_i$。设 $\\mathbf{p}_i = (p_{i1}, p_{i2}, \\ldots, p_{iN})$ 和 $\\mathbf{1} = (1, 1, \\ldots, 1)$ 是 $\\mathbb{R}^N$ 中的向量。柯西-施瓦茨不等式表明 $(\\mathbf{p}_i \\cdot \\mathbf{1})^2 \\le \\|\\mathbf{p}_i\\|^2 \\|\\mathbf{1}\\|^2$。应用此不等式：\n$$\n\\left(\\sum_{j=1}^{N} p_{ij}\\right)^2 \\le \\left(\\sum_{j=1}^{N} p_{ij}^2\\right) \\left(\\sum_{j=1}^{N} 1^2\\right)\n$$\n代入已知量：\n$$\n(N\\tilde{w}_i)^2 \\le \\left(\\sum_{j=1}^{N} p_{ij}^2\\right) (N)\n$$\n$$\nN^2\\tilde{w}_i^2 \\le N \\sum_{j=1}^{N} p_{ij}^2\n$$\n两边同除以 $N$ (因为 $N \\ge 1$)，得到所需的不等式：\n$$\nN\\tilde{w}_i^2 \\le \\sum_{j=1}^{N} p_{ij}^2\n$$\n这严格地证明了 $\\mathrm{Var}(N_i)_{\\text{strat}} \\le \\mathrm{Var}(N_i)_{\\text{multi}}$。\n\n如果柯西-施瓦茨不等式的等号成立条件不满足，则严格不等式成立。等号成立当且仅当一个向量是另一个向量的标量倍，即对某个标量 $c$ 有 $\\mathbf{p}_i = c \\mathbf{1}$。这意味着 $p_{i1} = p_{i2} = \\ldots = p_{iN}$。这个条件意味着区间 $I_i$ 与每层 $S_j$ 的重叠是相同的。这只在平凡情况下发生，即 $\\tilde{w}_i=0$ (所有 $p_{ij}=0$) 或 $\\tilde{w}_i=1$ (所有 $p_{ij}=1$)。在所有非平凡情况下，即 $0  \\tilde{w}_i  1$ 时，区间 $I_i$ 不会与所有层等量重叠（它会完全包含某些层，部分重叠另一些层，而与某些层完全不重叠）。因此，$p_{ij}$ 的值不会全都相等，不等式将是严格的。所以，对于任何权重满足 $0  \\tilde{w}_i  1$ 的粒子 $i$，都有 $\\mathrm{Var}(N_i)_{\\text{strat}}  \\mathrm{Var}(N_i)_{\\text{multi}}$。",
            "answer": "$$\\boxed{N \\tilde{w}_{i} (1 - \\tilde{w}_{i})}$$"
        },
        {
            "introduction": "真实的神经记录不仅受到测量噪声的影响，还可能因技术限制而存在数据缺失，例如棘波分拣（spike sorting）失败。本练习将展示如何构建一个更贴近现实的观测模型，该模型明确地考虑了这一不完美的数据生成过程。你将学习如何通过对未观测的真实棘波数量进行边缘化，来推导在数据部分缺失情况下的正确观测似然，这是在粒子滤波器框架内应用层级贝叶斯建模的一项关键技能。",
            "id": "4184375",
            "problem": "一个神经群体潜藏状态 $\\{x_t\\}_{t=1}^T$ 遵循一个非线性马尔可夫过程进行演化，其转移密度为 $p(x_t \\mid x_{t-1})$，其中 $x_t \\in \\mathbb{R}^d$ 代表一个低维潜藏发放率轨迹。在时间 $t$ 的观测过程如下：\n\n1. 在给定 $x_t$ 的条件下，真实的脉冲计数 $y_t \\in \\mathbb{N}_0$ 是根据一个强度为 $\\lambda_t = \\lambda(x_t)$ 的点过程生成的。对于本问题，你可以假设一个规范的脉冲计数模型 $y_t \\mid x_t \\sim \\mathrm{Poisson}(\\lambda_t)$，其中 $\\lambda_t  0$。\n\n2. 由于脉冲分拣失败，每个真实脉冲以概率 $q_t \\in (0,1)$ 被独立地检测到，从而得到观测计数 $z_t \\in \\mathbb{N}_0$。形式上， $z_t \\mid y_t \\sim \\mathrm{Binomial}(y_t, q_t)$。\n\n你实现了一个自举序贯蒙特卡洛（SMC）粒子滤波器，其中提议分布等于转移密度 $p(x_t \\mid x_{t-1})$。设 $\\{x_t^{(i)}, w_{t-1}^{(i)}\\}_{i=1}^N$ 表示用先前的权重 $w_{t-1}^{(i)}$ 传播到时间 $t$ 的粒子。自举权重更新由贝叶斯法则和SMC构造定义为 $w_t^{(i)} \\propto w_{t-1}^{(i)} \\, p(z_t \\mid x_t^{(i)})$，其中观测似然 $p(z_t \\mid x_t^{(i)})$ 必须对未观测到的 $y_t$ 进行边缘化。\n\n从泊松模型和二项模型的定义以及贝叶斯法则出发，并且不使用任何快捷公式，确定应该在粒子权重更新中使用的边缘化观测似然 $p(z_t \\mid x_t^{(i)})$ 的正确表达式。假设一旦给出 $x_t^{(i)}$，$\\lambda_t^{(i)} = \\lambda(x_t^{(i)})$ 就是已知的，并且 $q_t$ 从脉冲分拣质量度量中是已知的。\n\n哪个选项正确地给出了 $p(z_t \\mid x_t^{(i)})$？\n\nA. $p(z_t \\mid x_t^{(i)}) = \\dfrac{\\exp\\!\\big(- q_t \\lambda_t^{(i)}\\big) \\, \\big(q_t \\lambda_t^{(i)}\\big)^{z_t}}{z_t!}$\n\nB. $p(z_t \\mid x_t^{(i)}) = \\binom{\\lambda_t^{(i)}}{z_t} \\, q_t^{z_t} \\, (1 - q_t)^{\\lambda_t^{(i)} - z_t}$\n\nC. $p(z_t \\mid x_t^{(i)}) = \\dfrac{\\exp\\!\\big(- \\lambda_t^{(i)}\\big) \\, \\big(\\lambda_t^{(i)}\\big)^{z_t}}{z_t!}$\n\nD. $p(z_t \\mid x_t^{(i)}) = (1 - q_t) \\, \\delta_{z_t, 0} + q_t \\, \\dfrac{\\exp\\!\\big(- \\lambda_t^{(i)}\\big) \\, \\big(\\lambda_t^{(i)}\\big)^{z_t}}{z_t!}$\n\n此处，$\\delta_{z_t, 0}$ 表示克罗内克δ函数，如果 $z_t = 0$ 则等于 $1$，否则等于 $0$。",
            "solution": "问题陈述经过严格验证，具有科学依据、良定且客观。它描述了计算神经科学中使用的标准分层贝叶斯状态空间模型，其中从受到检测失败过程影响的观测脉冲计数中估计潜藏状态（发放率）。概率模型（泊松和二项）是此场景的典型选择。该问题是自洽的，并提供了执行所要求推导的所有必要信息。未发现任何缺陷。\n\n目标是推导边缘化观测似然 $p(z_t \\mid x_t^{(i)})$，这在自举粒子滤波器的权重更新步骤中是必需的。这需要边缘化掉未观测到的真实脉冲计数 $y_t$。\n\n为清晰起见且不失一般性，我们在推导过程中将省略时间下标 $t$ 和粒子索引 $i$。给定以下条件分布：\n1. 在给定潜藏状态 $x$ 的条件下，真实脉冲计数 $y$ 服从速率为 $\\lambda = \\lambda(x)$ 的泊松分布。其概率质量函数 (PMF) 为：\n$$p(y \\mid x) = \\frac{\\exp(-\\lambda) \\lambda^y}{y!}, \\quad \\text{for } y \\in \\{0, 1, 2, \\dots\\}$$\n2. 在给定真实计数 $y$ 的条件下，观测脉冲计数 $z$ 服从二项分布。这模拟了一个“稀疏化”过程，其中 $y$ 个真实脉冲中的每一个都以概率 $q$ 被独立检测到。其 PMF 为：\n$$p(z \\mid y) = \\binom{y}{z} q^z (1-q)^{y-z}, \\quad \\text{for } z \\in \\{0, 1, \\dots, y\\}$$\n注意，如果 $z > y$，则 $p(z \\mid y) = 0$。问题陈述还意味着，在给定 $y$ 的情况下，观测计数 $z$ 条件独立于潜藏状态 $x$，即 $p(z \\mid y, x) = p(z \\mid y)$。\n\n为了找到所需的似然 $p(z \\mid x)$，我们必须对潜变量 $y$ 的所有可能值进行积分（或者，对于离散变量，求和）：\n$$p(z \\mid x) = \\sum_{y=0}^{\\infty} p(z, y \\mid x)$$\n使用概率的链式法则，$p(z, y \\mid x) = p(z \\mid y, x) p(y \\mid x)$。如前所述，这可以简化为 $p(z \\mid y)p(y \\mid x)$。\n$$p(z \\mid x) = \\sum_{y=0}^{\\infty} p(z \\mid y) p(y \\mid x)$$\n我们现在将二项分布和泊松分布的 PMF 代入此求和式中：\n$$p(z \\mid x) = \\sum_{y=0}^{\\infty} \\left[ \\binom{y}{z} q^z (1-q)^{y-z} \\right] \\left[ \\frac{\\exp(-\\lambda) \\lambda^y}{y!} \\right]$$\n二项式系数 $\\binom{y}{z}$ 在 $y  z$ 时为零。因此，求和可以从 $y=z$ 开始：\n$$p(z \\mid x) = \\sum_{y=z}^{\\infty} \\left[ \\frac{y!}{z!(y-z)!} q^z (1-q)^{y-z} \\right] \\left[ \\frac{\\exp(-\\lambda) \\lambda^y}{y!} \\right]$$\n二项式系数的分子中的 $y!$ 项和泊松 PMF 的分母中的 $y!$ 项相互抵消：\n$$p(z \\mid x) = \\sum_{y=z}^{\\infty} \\frac{1}{z!(y-z)!} q^z (1-q)^{y-z} \\exp(-\\lambda) \\lambda^y$$\n我们可以将不依赖于求和索引 $y$ 的项从求和中提出来：\n$$p(z \\mid x) = \\frac{\\exp(-\\lambda) q^z}{z!} \\sum_{y=z}^{\\infty} \\frac{1}{(y-z)!} (1-q)^{y-z} \\lambda^y$$\n为了简化求和内的项 $\\lambda^y$，我们可以将其重写为 $\\lambda^y = \\lambda^z \\lambda^{y-z}$，并将因子 $\\lambda^z$ 移到求和之外：\n$$p(z \\mid x) = \\frac{\\exp(-\\lambda) q^z \\lambda^z}{z!} \\sum_{y=z}^{\\infty} \\frac{(1-q)^{y-z} \\lambda^{y-z}}{(y-z)!}$$\n合并求和外的各项，我们得到：\n$$p(z \\mid x) = \\frac{\\exp(-\\lambda) (q\\lambda)^z}{z!} \\sum_{y=z}^{\\infty} \\frac{((1-q)\\lambda)^{y-z}}{(y-z)!}$$\n让我们对求和索引进行变量替换，令 $k = y - z$。当 $y = z$ 时，$k = 0$。当 $y \\to \\infty$ 时，$k \\to \\infty$。求和变为：\n$$\\sum_{k=0}^{\\infty} \\frac{((1-q)\\lambda)^k}{k!}$$\n这是指数函数 $\\exp(\\alpha) = \\sum_{k=0}^{\\infty} \\frac{\\alpha^k}{k!}$ 的泰勒级数展开，其中 $\\alpha = (1-q)\\lambda$。因此，该和等于 $\\exp((1-q)\\lambda)$。\n\n将此结果代回到我们关于 $p(z \\mid x)$ 的表达式中：\n$$p(z \\mid x) = \\frac{\\exp(-\\lambda) (q\\lambda)^z}{z!} \\exp((1-q)\\lambda)$$\n现在，我们简化指数项：\n$$p(z \\mid x) = \\frac{(q\\lambda)^z}{z!} \\exp(-\\lambda + (1-q)\\lambda) = \\frac{(q\\lambda)^z}{z!} \\exp(-\\lambda + \\lambda - q\\lambda) = \\frac{(q\\lambda)^z}{z!} \\exp(-q\\lambda)$$\n这是速率参数等于 $q\\lambda$ 的新泊松分布的 PMF。这是一个众所周知的结果，被称为泊松过程的稀疏化性质。重新引入粒子和时间索引，我们有 $\\lambda_t^{(i)} = \\lambda(x_t^{(i)})$ 和 $q_t$。边缘化似然的最终表达式是：\n$$p(z_t \\mid x_t^{(i)}) = \\frac{\\exp(-q_t \\lambda_t^{(i)}) (q_t \\lambda_t^{(i)})^{z_t}}{z_t!}$$\n\n现在我们评估给定的选项。\n\nA. $p(z_t \\mid x_t^{(i)}) = \\dfrac{\\exp\\!\\big(- q_t \\lambda_t^{(i)}\\big) \\, \\big(q_t \\lambda_t^{(i)}\\big)^{z_t}}{z_t!}$\n该表达式与我们推导出的结果完全匹配。它是速率为 $q_t \\lambda_t^{(i)}$ 的泊松分布的 PMF。\n**结论：正确**\n\nB. $p(z_t \\mid x_t^{(i)}) = \\binom{\\lambda_t^{(i)}}{z_t} \\, q_t^{z_t} \\, (1 - q_t)^{\\lambda_t^{(i)} - z_t}$\n这是二项分布 $\\mathrm{Binomial}(\\lambda_t^{(i)}, q_t)$ 的 PMF。这是不正确的，主要有两个原因。首先，二项模型中的试验次数必须是整数，但 $\\lambda_t^{(i)}$ 是一个速率参数并且是实数。其次，真实的脉冲数 $y_t$ 是一个随机变量，而不是一个固定的参数 $\\lambda_t^{(i)}$。\n**结论：不正确**\n\nC. $p(z_t \\mid x_t^{(i)}) = \\dfrac{\\exp\\!\\big(- \\lambda_t^{(i)}\\big) \\, \\big(\\lambda_t^{(i)}\\big)^{z_t}}{z_t!}$\n这是速率为 $\\lambda_t^{(i)}$ 的泊松分布的 PMF。该表达式表示 $p(y_t = z_t \\mid x_t^{(i)})$，即真实脉冲数等于观测脉冲数的概率。它完全忽略了脉冲可能被漏掉的观测过程（即，它假设 $q_t=1$）。\n**结论：不正确**\n\nD. $p(z_t \\mid x_t^{(i)}) = (1 - q_t) \\, \\delta_{z_t, 0} + q_t \\, \\dfrac{\\exp\\!\\big(- \\lambda_t^{(i)}\\big) \\, \\big(\\lambda_t^{(i)}\\big)^{z_t}}{z_t!}$\n这描述了一个混合模型，表明观测值以 $1-q_t$ 的概率为零，并以 $q_t$ 的概率服从原始的泊松过程。这与所描述的模型不同，后者涉及稀疏化每个单独的脉冲，而不是为整个观测在两个结果之间切换。推导出的泊松($q_t\\lambda_t^{(i)}$)分布具有不同的函数形式。对于 $z_t=0$，该选项给出 $p(z_t=0 \\mid x_t^{(i)}) = (1 - q_t) + q_t \\exp(-\\lambda_t^{(i)})$，而正确的概率是 $\\exp(-q_t \\lambda_t^{(i)})$。这两者通常不相等。\n**结论：不正确**\n\n因此，只有选项 A 为边缘化观测似然提供了正确的数学形式。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}