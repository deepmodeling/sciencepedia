{
    "hands_on_practices": [
        {
            "introduction": "在实际的神经数据分析中，我们处理的数据往往是不完美的。例如，由于尖峰分类的失败，我们观测到的尖峰数量可能只是真实发放活动的一部分。这个练习  将引导你推导在这种情况下正确的观测似然函数，其核心在于通过对未观测的“真实”尖峰数量进行边缘化，来处理这种数据缺失问题。掌握这一技巧对于构建能够应对现实世界数据挑战的稳健滤波器至关重要。",
            "id": "4184375",
            "problem": "一个神经群体潜藏状态 $\\{x_t\\}_{t=1}^T$ 遵循一个非线性马尔可夫过程演化，其转移密度为 $p(x_t \\mid x_{t-1})$，其中 $x_t \\in \\mathbb{R}^d$ 表示一个低维潜藏发放率轨迹。在时间 $t$ 的观测过程按如下方式进行：\n\n1. 在给定 $x_t$ 的条件下，真实的脉冲计数 $y_t \\in \\mathbb{N}_0$ 根据一个强度为 $\\lambda_t = \\lambda(x_t)$ 的点过程生成。对于本问题，你可以假设一个经典的脉冲计数模型 $y_t \\mid x_t \\sim \\mathrm{Poisson}(\\lambda_t)$，其中 $\\lambda_t  0$。\n\n2. 由于脉冲分拣失败，每个真实脉冲以概率 $q_t \\in (0,1)$ 被独立检测到，从而得到观测计数 $z_t \\in \\mathbb{N}_0$。形式上， $z_t \\mid y_t \\sim \\mathrm{Binomial}(y_t, q_t)$。\n\n你实现了一个自举序列蒙特卡洛（SMC）粒子滤波器，其中提议分布等于转移密度 $p(x_t \\mid x_{t-1})$。设 $\\{x_t^{(i)}, w_{t-1}^{(i)}\\}_{i=1}^N$ 表示用先前的权重 $w_{t-1}^{(i)}$ 传播到时间 $t$ 的粒子。根据贝叶斯法则和SMC构造，自举权重更新定义为 $w_t^{(i)} \\propto w_{t-1}^{(i)} \\, p(z_t \\mid x_t^{(i)})$，其中观测似然 $p(z_t \\mid x_t^{(i)})$ 必须对未观测到的 $y_t$ 进行边缘化。\n\n从泊松模型和二项模型的定义以及贝叶斯法则出发，并且不使用任何快捷公式，确定应用于粒子权重更新的边缘化观测似然 $p(z_t \\mid x_t^{(i)})$ 的正确表达式。假设一旦给定 $x_t^{(i)}$，$\\lambda_t^{(i)} = \\lambda(x_t^{(i)})$ 就是已知的，并且 $q_t$ 从脉冲分拣质量度量中已知。\n\n哪个选项正确地给出了 $p(z_t \\mid x_t^{(i)})$？\n\nA. $p(z_t \\mid x_t^{(i)}) = \\dfrac{\\exp\\!\\big(- q_t \\lambda_t^{(i)}\\big) \\, \\big(q_t \\lambda_t^{(i)}\\big)^{z_t}}{z_t!}$\n\nB. $p(z_t \\mid x_t^{(i)}) = \\binom{\\lambda_t^{(i)}}{z_t} \\, q_t^{z_t} \\, (1 - q_t)^{\\lambda_t^{(i)} - z_t}$\n\nC. $p(z_t \\mid x_t^{(i)}) = \\dfrac{\\exp\\!\\big(- \\lambda_t^{(i)}\\big) \\, \\big(\\lambda_t^{(i)}\\big)^{z_t}}{z_t!}$\n\nD. $p(z_t \\mid x_t^{(i)}) = (1 - q_t) \\, \\delta_{z_t, 0} + q_t \\, \\dfrac{\\exp\\!\\big(- \\lambda_t^{(i)}\\big) \\, \\big(\\lambda_t^{(i)}\\big)^{z_t}}{z_t!}$\n\n此处，$\\delta_{z_t, 0}$ 表示克罗内克 delta 函数，如果 $z_t = 0$ 则等于 $1$，否则等于 $0$。",
            "solution": "问题陈述经严格验证，具有科学依据、良定且客观。它描述了计算神经科学中使用的标准分层贝叶斯状态空间模型，其中潜藏状态（发放率）是根据受检测失败过程影响的观测脉冲计数来估计的。概率模型（泊松和二项分布）是此场景下的经典选择。该问题是自洽的，并提供了进行所要求推导的所有必要信息。未发现任何缺陷。\n\n目标是推导边缘化观测似然 $p(z_t \\mid x_t^{(i)})$，这是自举粒子滤波器中权重更新步骤所必需的。这需要将未观测到的真实脉冲计数 $y_t$ 边缘化掉。\n\n为清晰起见且不失一般性，我们在推导过程中将省略时间下标 $t$ 和粒子索引 $i$。给定以下条件分布：\n1. 真实脉冲计数 $y$，在给定潜藏状态 $x$ 的条件下，遵循率参数为 $\\lambda = \\lambda(x)$ 的泊松分布。其概率质量函数（PMF）为：\n$$p(y \\mid x) = \\frac{\\exp(-\\lambda) \\lambda^y}{y!}, \\quad \\text{for } y \\in \\{0, 1, 2, \\dots\\}$$\n2. 观测脉冲计数 $z$，在给定真实计数 $y$ 的条件下，遵循二项分布。这为“稀疏化”过程建模，其中 $y$ 个真实脉冲中的每一个都以概率 $q$ 被独立检测到。其 PMF 为：\n$$p(z \\mid y) = \\binom{y}{z} q^z (1-q)^{y-z}, \\quad \\text{for } z \\in \\{0, 1, \\dots, y\\}$$\n注意，如果 $z  y$，则 $p(z \\mid y) = 0$。问题陈述也暗示，给定 $y$，观测计数 $z$ 条件独立于潜藏状态 $x$，即 $p(z \\mid y, x) = p(z \\mid y)$。\n\n为了找到所求的似然 $p(z \\mid x)$，我们必须对潜变量 $y$ 的所有可能值进行积分（或者，对于离散变量，求和）：\n$$p(z \\mid x) = \\sum_{y=0}^{\\infty} p(z, y \\mid x)$$\n使用概率的链式法则，$p(z, y \\mid x) = p(z \\mid y, x) p(y \\mid x)$。如前所述，这可以简化为 $p(z \\mid y)p(y \\mid x)$。\n$$p(z \\mid x) = \\sum_{y=0}^{\\infty} p(z \\mid y) p(y \\mid x)$$\n现在我们将二项分布和泊松分布的 PMF 代入此求和式中：\n$$p(z \\mid x) = \\sum_{y=0}^{\\infty} \\left[ \\binom{y}{z} q^z (1-q)^{y-z} \\right] \\left[ \\frac{\\exp(-\\lambda) \\lambda^y}{y!} \\right]$$\n二项式系数 $\\binom{y}{z}$ 在 $y  z$ 时为零。因此，求和可以从 $y = z$ 开始：\n$$p(z \\mid x) = \\sum_{y=z}^{\\infty} \\left[ \\frac{y!}{z!(y-z)!} q^z (1-q)^{y-z} \\right] \\left[ \\frac{\\exp(-\\lambda) \\lambda^y}{y!} \\right]$$\n二项式系数分子中的项 $y!$ 与泊松分布 PMF 分母中的 $y!$ 相抵消：\n$$p(z \\mid x) = \\sum_{y=z}^{\\infty} \\frac{1}{z!(y-z)!} q^z (1-q)^{y-z} \\exp(-\\lambda) \\lambda^y$$\n我们可以将不依赖于求和索引 $y$ 的项从求和中提出来：\n$$p(z \\mid x) = \\frac{\\exp(-\\lambda) q^z}{z!} \\sum_{y=z}^{\\infty} \\frac{1}{(y-z)!} (1-q)^{y-z} \\lambda^y$$\n为了简化求和内部的项 $\\lambda^y$，我们可以将其重写为 $\\lambda^y = \\lambda^z \\lambda^{y-z}$，并将因子 $\\lambda^z$ 移到求和之外：\n$$p(z \\mid x) = \\frac{\\exp(-\\lambda) q^z \\lambda^z}{z!} \\sum_{y=z}^{\\infty} \\frac{(1-q)^{y-z} \\lambda^{y-z}}{(y-z)!}$$\n组合求和外的项，我们得到：\n$$p(z \\mid x) = \\frac{\\exp(-\\lambda) (q\\lambda)^z}{z!} \\sum_{y=z}^{\\infty} \\frac{((1-q)\\lambda)^{y-z}}{(y-z)!}$$\n让我们对求和索引进行变量替换，令 $k = y - z$。当 $y = z$ 时，$k = 0$。当 $y \\to \\infty$ 时，$k \\to \\infty$。求和变为：\n$$\\sum_{k=0}^{\\infty} \\frac{((1-q)\\lambda)^k}{k!}$$\n这是指数函数 $\\exp(\\alpha) = \\sum_{k=0}^{\\infty} \\frac{\\alpha^k}{k!}$ 的泰勒级数展开，其中 $\\alpha = (1-q)\\lambda$。因此，该和等于 $\\exp((1-q)\\lambda)$。\n\n将此结果代回到我们关于 $p(z \\mid x)$ 的表达式中：\n$$p(z \\mid x) = \\frac{\\exp(-\\lambda) (q\\lambda)^z}{z!} \\exp((1-q)\\lambda)$$\n现在，我们简化指数项：\n$$p(z \\mid x) = \\frac{(q\\lambda)^z}{z!} \\exp(-\\lambda + (1-q)\\lambda) = \\frac{(q\\lambda)^z}{z!} \\exp(-\\lambda + \\lambda - q\\lambda) = \\frac{(q\\lambda)^z}{z!} \\exp(-q\\lambda)$$\n这是具有新率参数 $q\\lambda$ 的泊松分布的 PMF。这是一个众所周知的结果，称为泊松过程的稀疏化性质。重新引入粒子和时间索引，我们有 $\\lambda_t^{(i)} = \\lambda(x_t^{(i)})$ 和 $q_t$。边缘化似然的最终表达式为：\n$$p(z_t \\mid x_t^{(i)}) = \\frac{\\exp(-q_t \\lambda_t^{(i)}) (q_t \\lambda_t^{(i)})^{z_t}}{z_t!}$$\n\n现在我们评估给定的选项。\n\nA. $p(z_t \\mid x_t^{(i)}) = \\dfrac{\\exp\\!\\big(- q_t \\lambda_t^{(i)}\\big) \\, \\big(q_t \\lambda_t^{(i)}\\big)^{z_t}}{z_t!}$\n该表达式与我们推导的结果完全匹配。它是率参数为 $q_t \\lambda_t^{(i)}$ 的泊松分布的 PMF。\n**结论：正确**\n\nB. $p(z_t \\mid x_t^{(i)}) = \\binom{\\lambda_t^{(i)}}{z_t} \\, q_t^{z_t} \\, (1 - q_t)^{\\lambda_t^{(i)} - z_t}$\n这是二项分布 $\\mathrm{Binomial}(\\lambda_t^{(i)}, q_t)$ 的 PMF。这是不正确的，主要有两个原因。首先，二项模型中的试验次数必须是整数，但 $\\lambda_t^{(i)}$ 是一个率参数，是一个实数。其次，真实脉冲数 $y_t$ 是一个随机变量，而不是一个固定的参数 $\\lambda_t^{(i)}$。\n**结论：不正确**\n\nC. $p(z_t \\mid x_t^{(i)}) = \\dfrac{\\exp\\!\\big(- \\lambda_t^{(i)}\\big) \\, \\big(\\lambda_t^{(i)}\\big)^{z_t}}{z_t!}$\n这是率参数为 $\\lambda_t^{(i)}$ 的泊松分布的 PMF。此表达式表示 $p(y_t = z_t \\mid x_t^{(i)})$，即真实脉冲数等于观测脉冲数的概率。它完全忽略了脉冲可能被漏检的观测过程（即，它假设 $q_t=1$）。\n**结论：不正确**\n\nD. $p(z_t \\mid x_t^{(i)}) = (1 - q_t) \\, \\delta_{z_t, 0} + q_t \\, \\dfrac{\\exp\\!\\big(- \\lambda_t^{(i)}\\big) \\, \\big(\\lambda_t^{(i)}\\big)^{z_t}}{z_t!}$\n这描述了一个混合模型，表明观测值为零的概率为 $1-q_t$，而以概率 $q_t$ 遵循原始泊松过程。这与所描述的模型不同，后者涉及对每个单独的脉冲进行稀疏化，而不是为整个观测在两种结果之间切换。推导出的泊松($q_t\\lambda_t^{(i)}$)分布具有不同的函数形式。对于 $z_t=0$，该选项给出 $p(z_t=0 \\mid x_t^{(i)}) = (1 - q_t) + q_t \\exp(-\\lambda_t^{(i)})$，而正确的概率是 $\\exp(-q_t \\lambda_t^{(i)})$。这两者在一般情况下是不相等的。\n**结论：不正确**\n\n因此，只有选项 A 为边缘化观测似然提供了正确的数学形式。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在权重更新步骤之后，粒子退化是粒子滤波器必须面对的一个核心挑战，即少数粒子占据了几乎所有的权重。重采样是克服这一问题的标准技术，但不同的重采样策略其效率也不同。这个练习  旨在通过第一性原理，让你定量地分析和比较不同重采样方案的统计特性。通过推导粒子后代数量的方差，你将从根本上理解为什么分层重采样等先进方法能够比基本的多项式重采样更有效地保持粒子多样性。",
            "id": "4184410",
            "problem": "一位神经科学家正在使用序列重要性重采样（SIR）粒子滤波器，在一个非线性、非高斯状态空间模型中推断一个潜在的突触驱动，该驱动调制了神经元的脉冲发放强度。在给定时间的加权步骤之后，存在 $N$ 个粒子，其归一化权重为 $\\tilde{w}_{1},\\ldots,\\tilde{w}_{N}$，其中 $\\tilde{w}_{i} \\ge 0$ 且 $\\sum_{i=1}^{N} \\tilde{w}_{i} = 1$。重采样步骤为每个粒子 $i \\in \\{1,\\ldots,N\\}$ 分配一个整数后代数量 $N_{i}$，满足 $\\sum_{i=1}^{N} N_{i} = N$，以形成下一代。\n\n您将仅使用核心概率论工具，分析在两种标准重采样方案下 $N_{i}$ 的变异性。\n\n1) 在多项式重采样下，算法从集合 $\\{1,\\ldots,N\\}$ 上的分类分布（概率为 $\\tilde{w}_{1},\\ldots,\\tilde{w}_{N}$）中有放回地进行 $N$ 次独立抽取。从 $N_{i}$ 的指示变量分解以及独立伯努利随机变量之和的方差性质出发，推导出 $\\mathrm{Var}(N_{i})$ 关于 $N$ 和 $\\tilde{w}_{i}$ 的闭式表达式。您的最终答案必须是一个单一的解析表达式。\n\n2) 在分层重采样下，对于 $j \\in \\{1,\\ldots,N\\}$，算法抽取 $U_{j} = \\frac{j-1+V_{j}}{N}$（其中 $V_{j} \\stackrel{\\mathrm{iid}}{\\sim} \\mathrm{Uniform}(0,1)$），并将每个 $U_{j}$ 分配给索引 $i$，使得 $U_{j} \\in (C_{i-1}, C_{i}]$，其中 $C_{k} = \\sum_{m=1}^{k} \\tilde{w}_{m}$ 且 $C_{0}=0$。仅利用 $U_{j}$ 的独立性以及 $U_{j}$ 在区间 $\\left(\\frac{j-1}{N}, \\frac{j}{N}\\right]$ 上均匀分布的事实，将 $\\mathrm{Var}(N_{i})$ 表示为 $(C_{i-1}, C_{i}]$ 与各分层 $\\left(\\frac{j-1}{N}, \\frac{j}{N}\\right]$ 之间重叠长度的函数。然后，使用关于平方和的基本不等式，严格论证分层方差不大于您在第1部分中得到的答案，并确定严格不等式何时成立。\n\n答案规格：仅提供您在第1部分中为多项式重采样下的 $\\mathrm{Var}(N_{i})$ 推导出的表达式作为您的最终答案。不包括单位。无需四舍五入。",
            "solution": "问题要求在两种不同的重采样方案（多项式重采样和分层重采样）下，对粒子 $i$ 的后代数量 $N_i$ 的方差进行分析。\n\n第1部分：多项式重采样\n\n在多项式重采样下，新的 $N$ 个粒子集合是通过从旧的粒子集合 $\\{1, \\ldots, N\\}$ 中有放回地独立抽取 $N$ 次而形成的。在任何单次抽取中，抽到粒子 $i$ 的概率由其归一化权重 $\\tilde{w}_i$ 给出。随机变量 $N_i$ 表示在这 $N$ 次抽取中粒子 $i$ 被选中的总次数。\n\n为了求出 $N_i$ 的方差（记为 $\\mathrm{Var}(N_i)$），我们遵循问题的建议，使用指示变量分解法。令 $I_j$ 为第 $j$ 次抽取的指示随机变量，其中 $j \\in \\{1, \\ldots, N\\}$。我们定义，如果在第 $j$ 次抽取中选中了粒子 $i$，则 $I_j=1$，否则 $I_j=0$。\n\n粒子 $i$ 的总数是这 $N$ 次抽取中所有这些指示变量的和：\n$$\nN_i = \\sum_{j=1}^{N} I_j\n$$\n每次抽取都是一次伯努利试验，其“成功”概率为 $p = P(I_j=1) = \\tilde{w}_i$。每次抽取的结果都与其他抽取独立。因此，随机变量 $I_1, I_2, \\ldots, I_N$ 是独立同分布（i.i.d.）的伯努利随机变量，服从 $I_j \\sim \\mathrm{Bernoulli}(\\tilde{w}_i)$。\n\n单个伯努利随机变量 $I_j$ 的方差由下式给出：\n$$\n\\mathrm{Var}(I_j) = p(1-p) = \\tilde{w}_i(1-\\tilde{w}_i)\n$$\n方差的一个基本性质是，对于独立随机变量的和，其方差等于各方差之和。因此，\n$$\n\\mathrm{Var}(N_i) = \\mathrm{Var}\\left(\\sum_{j=1}^{N} I_j\\right) = \\sum_{j=1}^{N} \\mathrm{Var}(I_j)\n$$\n由于变量 $I_j$ 是同分布的，它们的方差都相等。因此，该和可以简化为：\n$$\n\\mathrm{Var}(N_i) = N \\cdot \\mathrm{Var}(I_1) = N \\tilde{w}_i(1-\\tilde{w}_i)\n$$\n这就是在多项式重采样下，后代数量 $N_i$ 的方差的闭式表达式。这个推导也证实了 $N_i$ 服从二项分布，$N_i \\sim \\mathrm{Binomial}(N, \\tilde{w}_i)$，而这个方差公式是二项分布的一个标准结果。\n\n第2部分：分层重采样与比较\n\n在分层重采样下，区间 $(0, 1]$ 被划分为 $N$ 个不相交的分层 $S_j = \\left(\\frac{j-1}{N}, \\frac{j}{N}\\right]$，其中 $j \\in \\{1, \\ldots, N\\}$。从每个分层中抽取一个均匀随机样本 $U_j$。粒子 $i$ 的后代数量 $N_i$ 是落在粒子 $i$ 的累积权重区间 $I_i = (C_{i-1}, C_i]$（其中 $C_k = \\sum_{m=1}^{k} \\tilde{w}_m$）内的样本 $U_j$ 的数量。这个区间的长度是 $\\text{length}(I_i) = C_i - C_{i-1} = \\tilde{w}_i$。\n\n后代数量可以写成指示变量的和：\n$$\nN_i = \\sum_{j=1}^{N} J_j, \\quad \\text{where } J_j = \\mathbf{1}_{I_i}(U_j) = \\begin{cases} 1  \\text{if } U_j \\in I_i \\\\ 0  \\text{otherwise} \\end{cases}\n$$\n抽取 $U_j$ 是独立的，这意味着指示变量 $J_j$ 也是独立的。$N_i$ 的方差同样是各方差之和：\n$$\n\\mathrm{Var}(N_i)_{\\text{strat}} = \\sum_{j=1}^{N} \\mathrm{Var}(J_j)\n$$\n每个 $J_j$ 都是一个伯努利随机变量。令 $p_{ij} = P(J_j=1) = P(U_j \\in I_i)$。由于 $U_j$ 在长度为 $1/N$ 的分层 $S_j$ 上是均匀分布的，这个概率是两个区间交集的长度与该分层长度的比值：\n$$\np_{ij} = \\frac{\\text{length}(I_i \\cap S_j)}{\\text{length}(S_j)} = \\frac{\\text{length}(I_i \\cap S_j)}{1/N} = N \\cdot \\text{length}(I_i \\cap S_j)\n$$\n每个 $J_j$ 的方差是 $\\mathrm{Var}(J_j) = p_{ij}(1-p_{ij})$。因此，总方差为：\n$$\n\\mathrm{Var}(N_i)_{\\text{strat}} = \\sum_{j=1}^{N} p_{ij}(1-p_{ij})\n$$\n这就是用重叠长度表示的分层方差的表达式。现在我们将其与多项式方差进行比较。在此方案下，$N_i$ 的期望值为 $E[N_i]_{\\text{strat}} = \\sum_{j=1}^{N} E[J_j] = \\sum_{j=1}^{N} p_{ij}$。由于分层 $\\{S_j\\}$ 构成 $(0, 1]$ 的一个划分，交集长度之和就是 $I_i$ 本身的长度：$\\sum_{j=1}^{N} \\text{length}(I_i \\cap S_j) = \\text{length}(I_i) = \\tilde{w}_i$。因此，$E[N_i]_{\\text{strat}} = \\sum_{j=1}^{N} N \\cdot \\text{length}(I_i \\cap S_j) = N \\tilde{w}_i$，这证实了该方案是无偏的，与多项式方案相同。\n\n我们可以将方差重写为：\n$$\n\\mathrm{Var}(N_i)_{\\text{multi}} = N\\tilde{w}_i - N\\tilde{w}_i^2\n$$\n$$\n\\mathrm{Var}(N_i)_{\\text{strat}} = \\sum_{j=1}^{N} p_{ij} - \\sum_{j=1}^{N} p_{ij}^2 = N\\tilde{w}_i - \\sum_{j=1}^{N} p_{ij}^2\n$$\n为了证明 $\\mathrm{Var}(N_i)_{\\text{strat}} \\le \\mathrm{Var}(N_i)_{\\text{multi}}$，我们必须证明 $N\\tilde{w}_i - \\sum_{j=1}^{N} p_{ij}^2 \\le N\\tilde{w}_i - N\\tilde{w}_i^2$，这等价于证明：\n$$\n\\sum_{j=1}^{N} p_{ij}^2 \\ge N\\tilde{w}_i^2\n$$\n我们知道 $\\sum_{j=1}^{N} p_{ij} = N\\tilde{w}_i$。令 $\\mathbf{p}_i = (p_{i1}, p_{i2}, \\ldots, p_{iN})$ 和 $\\mathbf{1} = (1, 1, \\ldots, 1)$ 为 $\\mathbb{R}^N$ 中的向量。Cauchy-Schwarz不等式表明 $(\\mathbf{p}_i \\cdot \\mathbf{1})^2 \\le \\|\\mathbf{p}_i\\|^2 \\|\\mathbf{1}\\|^2$。应用该不等式：\n$$\n\\left(\\sum_{j=1}^{N} p_{ij}\\right)^2 \\le \\left(\\sum_{j=1}^{N} p_{ij}^2\\right) \\left(\\sum_{j=1}^{N} 1^2\\right)\n$$\n代入已知量：\n$$\n(N\\tilde{w}_i)^2 \\le \\left(\\sum_{j=1}^{N} p_{ij}^2\\right) (N)\n$$\n$$\nN^2\\tilde{w}_i^2 \\le N \\sum_{j=1}^{N} p_{ij}^2\n$$\n两边除以 $N$（因为 $N \\ge 1$）得到所需的不等式：\n$$\nN\\tilde{w}_i^2 \\le \\sum_{j=1}^{N} p_{ij}^2\n$$\n这严格证明了 $\\mathrm{Var}(N_i)_{\\text{strat}} \\le \\mathrm{Var}(N_i)_{\\text{multi}}$。\n\n如果Cauchy-Schwarz不等式的等号成立条件不满足，则严格不等式成立。等号成立的充分必要条件是一个向量是另一个向量的标量倍，即对于某个标量 $c$ 有 $\\mathbf{p}_i = c \\mathbf{1}$。这意味着 $p_{i1} = p_{i2} = \\ldots = p_{iN}$。这个条件意味着区间 $I_i$ 与每个分层 $S_j$ 的重叠部分是相同的。这只在平凡情况下才可能发生，即 $\\tilde{w}_i=0$（所有 $p_{ij}=0$）或 $\\tilde{w}_i=1$（所有 $p_{ij}=1$）。在所有非平凡情况下，即 $0  \\tilde{w}_i  1$ 时，区间 $I_i$ 不会与所有分层均等地重叠（它会完全包含某些分层，部分重叠其他分层，而与某些分层完全不重叠）。因此，$p_{ij}$ 的值不会全部相等，不等式将是严格的。所以，对于任何权重满足 $0  \\tilde{w}_i  1$ 的粒子 $i$，都有 $\\mathrm{Var}(N_i)_{\\text{strat}}  \\mathrm{Var}(N_i)_{\\text{multi}}$。",
            "answer": "$$\\boxed{N \\tilde{w}_{i} (1 - \\tilde{w}_{i})}$$"
        },
        {
            "introduction": "标准自举粒子滤波器的效率在很大程度上取决于状态转移密度与真实后验分布的匹配程度，当观测信息非常丰富时，这种简单提议可能导致严重的样本贫化。为了解决这个问题，我们可以设计更智能的提议分布来主动引导粒子。这个高级练习  将指导你设计一个混合提议分布，它通过结合多个拉普拉斯近似来有效捕捉复杂或多模态的后验分布，并推导在这种高级框架下正确的粒子权重更新公式。这项实践是实现高效、研究级别粒子滤波器的关键一步。",
            "id": "4184466",
            "problem": "考虑一个用于神经元集群放电的隐状态空间模型，其中隐状态 $x_t \\in \\mathbb{R}^{d}$ 编码了一个低维运动学变量（例如，伸臂方向和速度），并根据一个由 $p(x_t \\mid x_{t-1}) = \\mathcal{N}\\!\\big(x_t; f(x_{t-1}), Q\\big)$ 给出的非线性高斯转移密度演化，其中 $f(\\cdot)$ 是一个已知的可微非线性转移函数，$Q \\in \\mathbb{R}^{d \\times d}$ 是一个正定协方差矩阵。时间 $t$ 的观测值是一个放电计数向量 $y_t = (y_{t,1}, \\dots, y_{t,N}) \\in \\mathbb{N}_0^{N}$，它来自在时长为 $\\Delta$ 的短时间窗内记录的 $N$ 个神经元，建模为独立的泊松随机变量，其率（rate）为 $\\lambda_n(x_t) = \\Delta\\, r_n\\, g_n(x_t)$，其中 $r_n  0$ 是一个增益参数，$g_n: \\mathbb{R}^{d} \\to \\mathbb{R}_{+}$ 是神经元 $n$ 的一个已知的可微调谐函数。因此，似然函数为 $p(y_t \\mid x_t) = \\prod_{n=1}^{N} \\exp\\!\\big(-\\lambda_n(x_t)\\big)\\, \\lambda_n(x_t)^{y_{t,n}} / y_{t,n}!$，而由此产生的滤波后验分布通常是非线性和非高斯的，由于多模态或对称调谐，可能具有多个模式。\n\n您正在设计一个粒子滤波器，其在时间 $t$ 的提议分布通过结合围绕 $K$ 个不同假设的局部拉普拉斯近似来针对多个后验模式。令联合项（似然乘以转移密度）的负对数为 $L(x) \\equiv -\\ln p(y_t \\mid x) - \\ln p(x \\mid x_{t-1})$。假设从 $K$ 个不同的假设种子出发，您运行一个二阶局部优化，以找到 $L(x)$ 的 $K$ 个不同的局部极小值点 $m_k \\in \\mathbb{R}^{d}$，以及相应的正定海森矩阵 $H_k = \\nabla^{2} L(x)\\big|_{x = m_k}$，其中 $k = 1, \\dots, K$。通过 $\\mathcal{N}\\!\\big(x; m_k, \\Sigma_k\\big)$（其中 $\\Sigma_k = H_k^{-1}$）定义局部高斯近似（拉普拉斯分量），并构建一个混合提议分布\n$$\nq(x_t \\mid x_{t-1}, y_t) = \\sum_{k=1}^{K} \\alpha_k\\, \\mathcal{N}\\!\\big(x_t; m_k, \\Sigma_k\\big),\n$$\n其中混合权重 $\\alpha_k$ 由拉普拉斯近似的局部后验质量确定。使用序贯蒙特卡洛的重要性采样原理，推导从 $q(x_t \\mid x_{t-1}, y_t)$ 中抽取的单个粒子 $x_t$ 的未归一化重要性权重 $w(x_t)$ 的闭式解析表达式，该表达式应明确地用 $p(y_t \\mid x_t)$、$p(x_t \\mid x_{t-1})$、混合分量 $\\{m_k, \\Sigma_k\\}_{k=1}^{K}$ 以及选择为如下形式的拉普拉斯混合权重来表示\n$$\n\\alpha_k = \\frac{c_k}{\\sum_{j=1}^{K} c_j}\n\\quad\\text{其中}\\quad\nc_k = p(y_t \\mid m_k)\\, p(m_k \\mid x_{t-1})\\, |\\Sigma_k|^{\\frac{1}{2}}。\n$$\n将权重 $w(x_t)$ 写成一个单一的闭式表达式，该表达式使用上面给出的显式泊松似然和高斯转移密度定义，以及每个拉普拉斯分量的显式高斯密度。您的最终答案必须是一个单一的解析表达式。不要通过舍去在 $x_t$ 上为常数的任何因子来简化。无需进行数值计算。",
            "solution": "题目陈述已经过验证，被认为是科学上合理的、适定的和客观的。它呈现了神经科学数据分析中高级贝叶斯滤波的一个标准场景。推导所需的所有要素均已提供且相互一致。因此，我们可以开始进行解答。\n\n重要性采样的核心原理是通过从一个更简单的提议分布 $q(x)$ 中抽取样本来近似一个目标概率分布，我们将其表示为 $\\pi(x)$。两个分布之间的差异通过为每个样本分配一个权重来校正。对于单个时间步 $t$ 的粒子滤波器，状态 $x_t$ 的目标分布与状态和新观测值在过去信息条件下的联合概率成正比。这由 $p(x_t, y_t \\mid x_{t-1})$ 给出，可以分解为 $p(y_t \\mid x_t)p(x_t \\mid x_{t-1})$。题目定义了一个提议分布 $q(x_t \\mid x_{t-1}, y_t)$。\n\n对于从提议分布 $q(x_t \\mid x_{t-1}, y_t)$ 中抽取的粒子（样本）$x_t$，其未归一化的重要性权重 $w(x_t)$ 定义为在 $x_t$ 处求值的目标密度与提议密度的比值：\n$$\nw(x_t) = \\frac{p(y_t \\mid x_t) p(x_t \\mid x_{t-1})}{q(x_t \\mid x_{t-1}, y_t)}\n$$\n我们的任务是通过代入题目陈述中提供的具体函数形式，来推导该表达式的显式解析形式。\n\n首先，我们写出分子的显式形式，它是似然与状态转移密度的乘积。\n\n似然 $p(y_t \\mid x_t)$ 由独立的泊松分布的乘积给出：\n$$\np(y_t \\mid x_t) = \\prod_{n=1}^{N} \\frac{\\exp(-\\lambda_n(x_t))\\, \\lambda_n(x_t)^{y_{t,n}}}{y_{t,n}!}\n$$\n代入给定的放电率定义 $\\lambda_n(x_t) = \\Delta\\, r_n\\, g_n(x_t)$，我们得到：\n$$\np(y_t \\mid x_t) = \\prod_{n=1}^{N} \\frac{\\exp\\big(-\\Delta r_n g_n(x_t)\\big) \\big(\\Delta r_n g_n(x_t)\\big)^{y_{t,n}}}{y_{t,n}!}\n$$\n\n状态转移密度 $p(x_t \\mid x_{t-1})$ 是一个多元高斯分布 $\\mathcal{N}\\!\\big(x_t; f(x_{t-1}), Q\\big)$。其概率密度函数 (PDF) 是：\n$$\np(x_t \\mid x_{t-1}) = \\frac{1}{(2\\pi)^{\\frac{d}{2}} |Q|^{\\frac{1}{2}}} \\exp\\left(-\\frac{1}{2} (x_t - f(x_{t-1}))^T Q^{-1} (x_t - f(x_{t-1}))\\right)\n$$\n\n结合这两个表达式，权重方程的分子变为：\n$$\np(y_t \\mid x_t) p(x_t \\mid x_{t-1}) = \\left( \\prod_{n=1}^{N} \\frac{\\exp\\big(-\\Delta r_n g_n(x_t)\\big) \\big(\\Delta r_n g_n(x_t)\\big)^{y_{t,n}}}{y_{t,n}!} \\right) \\left( \\frac{1}{(2\\pi)^{\\frac{d}{2}} |Q|^{\\frac{1}{2}}} \\exp\\left(-\\frac{1}{2} (x_t - f(x_{t-1}))^T Q^{-1} (x_t - f(x_{t-1}))\\right) \\right)\n$$\n\n接下来，我们写出分母的显式形式，即提议分布 $q(x_t \\mid x_{t-1}, y_t)$。题目将其定义为 $K$ 个高斯分布的混合：\n$$\nq(x_t \\mid x_{t-1}, y_t) = \\sum_{k=1}^{K} \\alpha_k\\, \\mathcal{N}\\!\\big(x_t; m_k, \\Sigma_k\\big)\n$$\n其中每个分量 $\\mathcal{N}\\!\\big(x_t; m_k, \\Sigma_k\\big)$ 是一个多元高斯概率密度函数。代入每个高斯分量的显式形式，我们得到：\n$$\nq(x_t \\mid x_{t-1}, y_t) = \\sum_{k=1}^{K} \\alpha_k \\left( \\frac{1}{(2\\pi)^{\\frac{d}{2}} |\\Sigma_k|^{\\frac{1}{2}}} \\exp\\left(-\\frac{1}{2} (x_t - m_k)^T \\Sigma_k^{-1} (x_t - m_k)\\right) \\right)\n$$\n混合权重 $\\alpha_k$ 已给出，并且题目要求我们在最终表达式中以符号形式保留它们。\n\n最后，我们通过取推导出的分子与推导出的分母的比值，来构造未归一化的重要性权重 $w(x_t)$。题目要求不舍去任何相对于 $x_t$ 为常数的因子，因此我们不会在分子和分母之间进行任何此类常数（如 $(2\\pi)^{\\frac{d}{2}}$）的代数约分，从而呈现真实的、未经缩放的概率密度的比值。\n\n未归一化的重要性权重 $w(x_t)$ 的完整、闭式解析表达式为：\n$$\nw(x_t) = \\frac{\\left( \\prod_{n=1}^{N} \\frac{\\exp\\big(-\\Delta r_n g_n(x_t)\\big) \\big(\\Delta r_n g_n(x_t)\\big)^{y_{t,n}}}{y_{t,n}!} \\right) \\frac{1}{(2\\pi)^{\\frac{d}{2}} |Q|^{\\frac{1}{2}}} \\exp\\left(-\\frac{1}{2} (x_t - f(x_{t-1}))^T Q^{-1} (x_t - f(x_{t-1}))\\right)}{\\sum_{k=1}^{K} \\alpha_k \\left( \\frac{1}{(2\\pi)^{\\frac{d}{2}} |\\Sigma_k|^{\\frac{1}{2}}} \\exp\\left(-\\frac{1}{2} (x_t - m_k)^T \\Sigma_k^{-1} (x_t - m_k)\\right) \\right)}\n$$\n该表达式表示了最终答案，它是一个单一的解析公式，由题目陈述中提供的显式定义构建而成。",
            "answer": "$$\n\\boxed{\\frac{\\left( \\prod_{n=1}^{N} \\frac{\\exp\\big(-\\Delta r_n g_n(x_t)\\big) \\big(\\Delta r_n g_n(x_t)\\big)^{y_{t,n}}}{y_{t,n}!} \\right) \\frac{1}{(2\\pi)^{\\frac{d}{2}} |Q|^{\\frac{1}{2}}} \\exp\\left(-\\frac{1}{2} (x_t - f(x_{t-1}))^T Q^{-1} (x_t - f(x_{t-1}))\\right)}{\\sum_{k=1}^{K} \\alpha_k \\left( \\frac{1}{(2\\pi)^{\\frac{d}{2}} |\\Sigma_k|^{\\frac{1}{2}}} \\exp\\left(-\\frac{1}{2} (x_t - m_k)^T \\Sigma_k^{-1} (x_t - m_k)\\right) \\right)}}\n$$"
        }
    ]
}