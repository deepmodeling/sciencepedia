{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂群体模型之前，我们首先需要掌握其基本构件：如何根据新数据更新单个参数。本练习将通过神经科学中分析脉冲计数的经典Gamma-Poisson模型，引导您推导共轭先验下的后验分布。通过这个过程，您将直观地理解贝叶斯推断如何将先验知识与观测数据相结合，从而得到精确且符合理论的后验信念。",
            "id": "4141070",
            "problem": "在对多个记录区间内的单神经元脉冲序列进行群体分析时，假设神经元 $i$ 在已知暴露时长 $\\{T_{it}\\}_{t=1}^{n_i}$（单位为秒）的观察窗口内产生脉冲计数 $\\{y_{it}\\}_{t=1}^{n_i}$。假设存在以下生成模型，该模型基于标准的点过程近似来处理脉冲计数：在给定神经元特有的发放率参数 $\\lambda_i$ 的条件下，各个区间的脉冲计数是条件独立的，且服从泊松随机变量分布，其均值与暴露时长成正比，即 $y_{it} \\mid \\lambda_i, T_{it} \\sim \\text{Poisson}(\\lambda_i T_{it})$。在群体层面，为 $\\lambda_i$ 设置一个形状参数为 $\\alpha$、速率参数为 $\\beta$ 的伽马先验，记为 $\\lambda_i \\mid \\alpha,\\beta \\sim \\text{Gamma}(\\alpha,\\beta)$，其概率密度函数为 $p(\\lambda_i \\mid \\alpha,\\beta) = \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} \\lambda_i^{\\alpha-1} \\exp(-\\beta \\lambda_i)$，其中 $\\lambda_i > 0$。将 $\\alpha$ 和 $\\beta$ 视为所有神经元共享的已知超参数。利用贝叶斯法则以及泊松概率质量函数和伽马概率密度函数的标准形式，推导后验分布 $p(\\lambda_i \\mid \\{y_{it}\\}_{t=1}^{n_i}, \\{T_{it}\\}_{t=1}^{n_i}, \\alpha, \\beta)$，并将其识别为一个已命名的参数族成员。将你的最终答案表示为单个解析表达式，给出该分布族的名称及其参数，参数应以 $\\alpha$、$\\beta$、$\\sum_{t=1}^{n_i} y_{it}$ 和 $\\sum_{t=1}^{n_i} T_{it}$ 表示。不要进行数值简化。你的最终答案必须是单个封闭形式的解析表达式。",
            "solution": "首先验证问题，以确保其具有科学依据、良定性和客观性。\n\n**步骤 1：提取已知条件**\n- 神经元 $i$ 的数据：脉冲计数 $\\{y_{it}\\}_{t=1}^{n_i}$ 和暴露时长 $\\{T_{it}\\}_{t=1}^{n_i}$。\n- 单个观测的似然模型：$y_{it} \\mid \\lambda_i, T_{it} \\sim \\text{Poisson}(\\lambda_i T_{it})$。\n- 条件独立性：在给定神经元特有的发放率参数 $\\lambda_i$ 的条件下，脉冲计数 $y_{it}$ 是条件独立的。\n- 发放率的先验模型：$\\lambda_i \\mid \\alpha,\\beta \\sim \\text{Gamma}(\\alpha,\\beta)$。\n- 先验的概率密度函数（PDF）：$p(\\lambda_i \\mid \\alpha,\\beta) = \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} \\lambda_i^{\\alpha-1} \\exp(-\\beta \\lambda_i)$，其中 $\\lambda_i > 0$。\n- 超参数：$\\alpha$ 和 $\\beta$ 是已知常数。\n- 目标：推导后验分布 $p(\\lambda_i \\mid \\{y_{it}\\}_{t=1}^{n_i}, \\{T_{it}\\}_{t=1}^{n_i}, \\alpha, \\beta)$，并确定其所属分布族和参数。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，采用了标准的泊松模型来描述神经脉冲计数，并使用了伽马先验，这是泊松率参数的共轭先验。这是贝叶斯统计和计算神经科学中的一个典型问题。该问题是良定的，因为所有必要组成部分（似然、先验、数据）都已指定，从而可以得到一个唯一的后验分布。语言客观且数学上精确。未发现任何缺陷。\n\n**步骤 3：结论与行动**\n问题有效。将提供完整解答。\n\n目标是为单个神经元 $i$ 推导其发放率参数 $\\lambda_i$ 的后验分布。设神经元 $i$ 的完整数据集表示为 $D_i = (\\{y_{it}\\}_{t=1}^{n_i}, \\{T_{it}\\}_{t=1}^{n_i})$。我们应用贝叶斯定理，该定理指出后验分布正比于似然与先验分布的乘积。\n\n$$\np(\\lambda_i \\mid D_i, \\alpha, \\beta) \\propto p(D_i \\mid \\lambda_i) \\times p(\\lambda_i \\mid \\alpha, \\beta)\n$$\n\n首先，我们构建似然函数 $p(D_i \\mid \\lambda_i)$。问题指出，在给定 $\\lambda_i$ 的条件下，脉冲计数 $y_{it}$ 是条件独立的泊松随机变量。单个观测 $y_{it}$ 的概率质量函数（PMF）为：\n$$\np(y_{it} \\mid \\lambda_i, T_{it}) = \\frac{(\\lambda_i T_{it})^{y_{it}} \\exp(-\\lambda_i T_{it})}{y_{it}!}\n$$\n由于条件独立性，神经元 $i$ 的所有 $n_i$ 个观测的总似然是各个 PMF 的乘积：\n$$\nL(\\lambda_i; D_i) = p(D_i \\mid \\lambda_i) = \\prod_{t=1}^{n_i} p(y_{it} \\mid \\lambda_i, T_{it}) = \\prod_{t=1}^{n_i} \\frac{(\\lambda_i T_{it})^{y_{it}} \\exp(-\\lambda_i T_{it})}{y_{it}!}\n$$\n在贝叶斯推断中，我们关心的是似然函数关于参数 $\\lambda_i$ 的函数形式。因此，我们可以忽略任何不依赖于 $\\lambda_i$ 的项，因为它们将被吸收到归一化常数中。\n$$\nL(\\lambda_i; D_i) \\propto \\prod_{t=1}^{n_i} (\\lambda_i T_{it})^{y_{it}} \\exp(-\\lambda_i T_{it})\n$$\n我们可以分离包含 $\\lambda_i$ 的项并简化乘积：\n$$\nL(\\lambda_i; D_i) \\propto \\prod_{t=1}^{n_i} \\lambda_i^{y_{it}} \\cdot \\prod_{t=1}^{n_i} T_{it}^{y_{it}} \\cdot \\prod_{t=1}^{n_i} \\exp(-\\lambda_i T_{it})\n$$\n再次忽略不含 $\\lambda_i$ 的项（具体来说是 $\\prod T_{it}^{y_{it}}$）：\n$$\nL(\\lambda_i; D_i) \\propto \\left( \\prod_{t=1}^{n_i} \\lambda_i^{y_{it}} \\right) \\left( \\prod_{t=1}^{n_i} \\exp(-\\lambda_i T_{it}) \\right)\n$$\n利用指数的性质，可将其简化为：\n$$\nL(\\lambda_i; D_i) \\propto \\lambda_i^{\\sum_{t=1}^{n_i} y_{it}} \\exp\\left(-\\lambda_i \\sum_{t=1}^{n_i} T_{it}\\right)\n$$\n接下来，我们考虑 $\\lambda_i$ 的先验分布，它是一个形状参数为 $\\alpha$、速率参数为 $\\beta$ 的伽马分布：\n$$\np(\\lambda_i \\mid \\alpha, \\beta) = \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} \\lambda_i^{\\alpha-1} \\exp(-\\beta \\lambda_i)\n$$\n该先验分布的核（kernel）包含了所有对 $\\lambda_i$ 的依赖关系，其形式为：\n$$\np(\\lambda_i \\mid \\alpha, \\beta) \\propto \\lambda_i^{\\alpha-1} \\exp(-\\beta \\lambda_i)\n$$\n现在，我们将似然函数的核与先验分布的核相乘，以得到后验分布的核：\n$$\np(\\lambda_i \\mid D_i, \\alpha, \\beta) \\propto \\left( \\lambda_i^{\\sum_{t=1}^{n_i} y_{it}} \\exp\\left(-\\lambda_i \\sum_{t=1}^{n_i} T_{it}\\right) \\right) \\times \\left( \\lambda_i^{\\alpha-1} \\exp(-\\beta \\lambda_i) \\right)\n$$\n合并同底项：\n$$\np(\\lambda_i \\mid D_i, \\alpha, \\beta) \\propto \\lambda_i^{\\left(\\sum_{t=1}^{n_i} y_{it}\\right) + (\\alpha-1)} \\exp\\left(-\\lambda_i \\sum_{t=1}^{n_i} T_{it} - \\beta \\lambda_i\\right)\n$$\n$$\np(\\lambda_i \\mid D_i, \\alpha, \\beta) \\propto \\lambda_i^{\\left(\\alpha + \\sum_{t=1}^{n_i} y_{it}\\right) - 1} \\exp\\left(-\\left(\\beta + \\sum_{t=1}^{n_i} T_{it}\\right) \\lambda_i\\right)\n$$\n这个结果的函数形式是一个伽马分布的核。一个服从形状参数为 $\\alpha'$、速率参数为 $\\beta'$ 的伽马分布的随机变量 $X$，记作 $X \\sim \\text{Gamma}(\\alpha', \\beta')$，其概率密度函数正比于 $x^{\\alpha'-1}\\exp(-\\beta'x)$。\n\n通过将此形式与我们的后验核进行比较，我们可以确定后验分布的参数。\n后验形状参数 $\\alpha'$ 为：\n$$\n\\alpha' = \\alpha + \\sum_{t=1}^{n_i} y_{it}\n$$\n后验速率参数 $\\beta'$ 为：\n$$\n\\beta' = \\beta + \\sum_{t=1}^{n_i} T_{it}\n$$\n因此，$\\lambda_i$ 的后验分布是具有这些更新后参数的伽马分布。这个结果证明了伽马先验和泊松似然之间的共轭性。后验分布为：\n$$\n\\lambda_i \\mid D_i, \\alpha, \\beta \\sim \\text{Gamma}\\left(\\alpha + \\sum_{t=1}^{n_i} y_{it}, \\beta + \\sum_{t=1}^{n_i} T_{it}\\right)\n$$\n参数的更新方式很直观：后验形状参数等于先验形状参数加上观测到的总脉冲数，后验速率参数等于先验速率参数加上总暴露时长。",
            "answer": "$$\n\\boxed{\\text{Gamma}\\left(\\alpha + \\sum_{t=1}^{n_i} y_{it}, \\beta + \\sum_{t=1}^{n_i} T_{it}\\right)}\n$$"
        },
        {
            "introduction": "理解了单个神经元的更新后，我们现在将探讨分层模型的真正威力：跨神经元“借用统计强度”。本练习将通过一个高斯分层模型，具体展示“收缩” (shrinkage) 现象，即后验估计值会从个体观测数据向群体均值“收缩”。您将通过计算发现，这种效应甚至可能颠覆基于原始数据的直观结论，从而揭示分层分析在提高估计稳定性和准确性方面的核心优势。",
            "id": "4141091",
            "problem": "考虑在一次系统神经科学实验中，在单一刺激条件下记录到的一个神经元群体的诱发发放率测量值。对于每个单元 $i \\in \\{A,B,C\\}$，将其潜在诱发发放率记为 $\\theta_i$（单位：$\\mathrm{spikes/s}$），并将其在多次试验中观测到的样本均值记为 $y_i$（单位：$\\mathrm{spikes/s}$）。假设一个高斯层级模型，其中潜在诱发发放率围绕一个已知的群体均值 $ \\mu $ 是可交换的，其先验方差为 $ \\tau^2 $，并且观测值受到具有已知方差的独立高斯测量噪声的干扰：\n- 先验：$ \\theta_i \\mid \\mu \\sim \\mathcal{N}(\\mu, \\tau^2) $。\n- 似然：$ y_i \\mid \\theta_i \\sim \\mathcal{N}(\\theta_i, \\sigma_i^2) $。\n假设根据一个大型历史数据集，已知群体均值为 $ \\mu = 20 $（单位：$\\mathrm{spikes/s}$），且当前实验得出以下观测均值和测量方差：\n- 单元 $A$：$ y_A = 12 $，$ \\sigma_A^2 = 9 $。\n- 单元 $B$：$ y_B = 15 $，$ \\sigma_B^2 = 1 $。\n- 单元 $C$：$ y_C = 40 $，$ \\sigma_C^2 = 4 $。\n所有量 $ y_i $ 和 $ \\sigma_i^2 $ 的单位均如上所述。朴素差异 $ y_B - y_A $ 是正的。从贝叶斯定理以及高斯似然和高斯先验的共轭性出发，推导每个单元 $ i $ 的后验均值 $ \\mathbb{E}[\\theta_i \\mid y_i, \\mu, \\tau^2] $，用 $ \\tau^2 $ 表示后验差异 $ \\mathbb{E}[\\theta_B \\mid y_B, \\mu, \\tau^2] - \\mathbb{E}[\\theta_A \\mid y_A, \\mu, \\tau^2] $，并解析地证明存在一个临界先验方差 $ \\tau_{\\star}^2 $，使得单元 $A$ 和 $B$ 的后验均值相等。计算上述给定数值下的这个临界值 $ \\tau_{\\star}^2 $，并解释对于 $ \\tau^2  \\tau_{\\star}^2 $ 的情况，收缩如何逆转朴素差异的方向。将 $ \\tau_{\\star}^2 $ 的最终数值答案以 $(\\mathrm{spikes/s})^2$ 为单位表示，并四舍五入到四位有效数字。",
            "solution": "该问题陈述在贝叶斯统计分析领域提出了一个标准的、定义明确的问题，特别是在神经科学数据的层级模型背景下。所有参数和分布都已明确指定，该模型在科学上是合理的且被广泛使用，问题在数学上是可解的。所提供的数据是内部一致的。因此，该问题被认为是有效的，可以推导出完整的解。\n\n该问题描述了一个高斯-高斯层级模型。对于每个单元 $i$，其潜在发放率 $\\theta_i$ 的先验分布由下式给出\n$$ p(\\theta_i \\mid \\mu, \\tau^2) = \\frac{1}{\\sqrt{2\\pi\\tau^2}} \\exp\\left(-\\frac{(\\theta_i - \\mu)^2}{2\\tau^2}\\right) $$\n即正态分布 $\\mathcal{N}(\\mu, \\tau^2)$。在给定潜在发放率 $\\theta_i$ 的条件下，观测到样本均值发放率 $y_i$ 的似然为\n$$ p(y_i \\mid \\theta_i, \\sigma_i^2) = \\frac{1}{\\sqrt{2\\pi\\sigma_i^2}} \\exp\\left(-\\frac{(y_i - \\theta_i)^2}{2\\sigma_i^2}\\right) $$\n即正态分布 $\\mathcal{N}(\\theta_i, \\sigma_i^2)$。\n\n我们的首要任务是推导在给定观测值 $y_i$ 和超参数 $\\mu$、$\\tau^2$ 的条件下 $\\theta_i$ 的后验分布。根据贝叶斯定理，后验概率密度与似然和先验的乘积成正比：\n$$ p(\\theta_i \\mid y_i, \\mu, \\tau^2) \\propto p(y_i \\mid \\theta_i, \\sigma_i^2) p(\\theta_i \\mid \\mu, \\tau^2) $$\n由于两个高斯分布的乘积与另一个高斯分布成正比（这一性质称为共轭性），后验分布 $p(\\theta_i \\mid y_i, \\mu, \\tau^2)$ 也将是一个高斯分布。我们可以通过检查乘积的指数部分来找到其参数。\n$$ p(\\theta_i \\mid y_i, \\mu, \\tau^2) \\propto \\exp\\left(-\\frac{(y_i - \\theta_i)^2}{2\\sigma_i^2}\\right) \\exp\\left(-\\frac{(\\theta_i - \\mu)^2}{2\\tau^2}\\right) $$\n$$ \\propto \\exp\\left( -\\frac{1}{2} \\left[ \\frac{(\\theta_i - y_i)^2}{\\sigma_i^2} + \\frac{(\\theta_i - \\mu)^2}{\\tau^2} \\right] \\right) $$\n为求后验均值，我们对指数中的 $\\theta_i$ 进行配方。设后验分布为 $\\mathcal{N}(\\hat{\\theta}_i, \\sigma_{\\text{post},i}^2)$。指数将具有 $-\\frac{(\\theta_i - \\hat{\\theta}_i)^2}{2\\sigma_{\\text{post},i}^2}$ 的形式。展开括号中的项：\n$$ \\frac{\\theta_i^2 - 2\\theta_i y_i + y_i^2}{\\sigma_i^2} + \\frac{\\theta_i^2 - 2\\theta_i \\mu + \\mu^2}{\\tau^2} $$\n合并关于 $\\theta_i^2$ 和 $\\theta_i$ 的项：\n$$ \\theta_i^2 \\left(\\frac{1}{\\sigma_i^2} + \\frac{1}{\\tau^2}\\right) - 2\\theta_i \\left(\\frac{y_i}{\\sigma_i^2} + \\frac{\\mu}{\\tau^2}\\right) + \\dots $$\n后验精度（方差的倒数）是各个精度（先验精度和似然精度）之和：\n$$ \\frac{1}{\\sigma_{\\text{post},i}^2} = \\frac{1}{\\sigma_i^2} + \\frac{1}{\\tau^2} $$\n后验均值 $\\hat{\\theta}_i = \\mathbb{E}[\\theta_i \\mid y_i, \\mu, \\tau^2]$ 由 $-2\\theta_i$ 的系数与 $\\theta_i^2$ 的系数之比给出：\n$$ \\hat{\\theta}_i = \\frac{\\frac{y_i}{\\sigma_i^2} + \\frac{\\mu}{\\tau^2}}{\\frac{1}{\\sigma_i^2} + \\frac{1}{\\tau^2}} $$\n这表明后验均值是观测数据 $y_i$ 和先验均值 $\\mu$ 的精度加权平均。通过将分子和分母同乘以 $\\sigma_i^2 \\tau^2$，我们得到一个更方便的形式：\n$$ \\hat{\\theta}_i = \\frac{y_i \\tau^2 + \\mu \\sigma_i^2}{\\tau^2 + \\sigma_i^2} $$\n该表达式可以解释为一个加权平均：\n$$ \\hat{\\theta}_i = \\left(\\frac{\\tau^2}{\\sigma_i^2 + \\tau^2}\\right) y_i + \\left(\\frac{\\sigma_i^2}{\\sigma_i^2 + \\tau^2}\\right) \\mu = (1 - B_i) y_i + B_i \\mu $$\n其中 $B_i = \\frac{\\sigma_i^2}{\\sigma_i^2 + \\tau^2}$ 是“收缩因子”，它量化了估计值从观测值 $y_i$ 向先验均值 $\\mu$ 收缩的程度。\n\n问题要求的是单元 $A$ 和 $B$ 的后验均值相等的条件。令 $\\hat{\\theta}_A = \\mathbb{E}[\\theta_A \\mid y_A, \\mu, \\tau^2]$ 且 $\\hat{\\theta}_B = \\mathbb{E}[\\theta_B \\mid y_B, \\mu, \\tau^2]$。我们令 $\\hat{\\theta}_A = \\hat{\\theta}_B$：\n$$ \\frac{y_A \\tau^2 + \\mu \\sigma_A^2}{\\tau^2 + \\sigma_A^2} = \\frac{y_B \\tau^2 + \\mu \\sigma_B^2}{\\tau^2 + \\sigma_B^2} $$\n为了找到使该等式成立的临界方差 $\\tau_{\\star}^2$，我们求解 $\\tau^2$。\n$$ (y_A \\tau^2 + \\mu \\sigma_A^2)(\\tau^2 + \\sigma_B^2) = (y_B \\tau^2 + \\mu \\sigma_B^2)(\\tau^2 + \\sigma_A^2) $$\n$$ y_A (\\tau^2)^2 + y_A \\tau^2 \\sigma_B^2 + \\mu \\sigma_A^2 \\tau^2 + \\mu \\sigma_A^2 \\sigma_B^2 = y_B (\\tau^2)^2 + y_B \\tau^2 \\sigma_A^2 + \\mu \\sigma_B^2 \\tau^2 + \\mu \\sigma_B^2 \\sigma_A^2 $$\n项 $\\mu \\sigma_A^2 \\sigma_B^2$ 在等式两边被消去。我们重新整理以合并 $(\\tau^2)^2$ 和 $\\tau^2$ 的项：\n$$ (\\tau^2)^2 (y_A - y_B) + \\tau^2 (y_A \\sigma_B^2 + \\mu \\sigma_A^2 - y_B \\sigma_A^2 - \\mu \\sigma_B^2) = 0 $$\n$$ \\tau^2 \\left[ \\tau^2 (y_A - y_B) + (y_A \\sigma_B^2 - y_B \\sigma_A^2 + \\mu \\sigma_A^2 - \\mu \\sigma_B^2) \\right] = 0 $$\n一个解是平凡情况 $\\tau^2 = 0$。非平凡解 $\\tau_{\\star}^2$ 可以通过将方括号中的项设为零来找到：\n$$ \\tau_{\\star}^2 (y_A - y_B) = - (y_A \\sigma_B^2 - y_B \\sigma_A^2 + \\mu \\sigma_A^2 - \\mu \\sigma_B^2) $$\n$$ \\tau_{\\star}^2 (y_A - y_B) = y_B \\sigma_A^2 - y_A \\sigma_B^2 - \\mu \\sigma_A^2 + \\mu \\sigma_B^2 $$\n$$ \\tau_{\\star}^2 (y_A - y_B) = \\sigma_A^2 (y_B - \\mu) - \\sigma_B^2 (y_A - \\mu) $$\n分离出 $\\tau_{\\star}^2$：\n$$ \\tau_{\\star}^2 = \\frac{\\sigma_A^2 (y_B - \\mu) - \\sigma_B^2 (y_A - \\mu)}{y_A - y_B} $$\n这解析地证明了只要该临界方差为正，它就存在。我们现在代入给定的数值：$\\mu = 20$，$y_A = 12$，$\\sigma_A^2 = 9$，$y_B = 15$，$\\sigma_B^2 = 1$。\n$$ \\tau_{\\star}^2 = \\frac{9(15 - 20) - 1(12 - 20)}{12 - 15} $$\n$$ \\tau_{\\star}^2 = \\frac{9(-5) - 1(-8)}{-3} = \\frac{-45 + 8}{-3} = \\frac{-37}{-3} = \\frac{37}{3} $$\n由于 $\\tau_{\\star}^2 = 37/3  0$，一个具有物理意义的临界方差存在。其数值约为 $12.3333...$ $(\\mathrm{spikes/s})^2$。四舍五入到四位有效数字，结果为 $12.33$ $(\\mathrm{spikes/s})^2$。\n\n最后，我们必须解释在 $\\tau^2  \\tau_{\\star}^2$ 时朴素差异的逆转现象。朴素差异为 $y_B - y_A = 15 - 12 = 3  0$。我们想分析后验差异 $\\hat{\\theta}_B - \\hat{\\theta}_A$ 的符号。\n$$ \\hat{\\theta}_B - \\hat{\\theta}_A = \\frac{y_B \\tau^2 + \\mu \\sigma_B^2}{\\tau^2 + \\sigma_B^2} - \\frac{y_A \\tau^2 + \\mu \\sigma_A^2}{\\tau^2 + \\sigma_A^2} $$\n公分母 $(\\tau^2 + \\sigma_B^2)(\\tau^2 + \\sigma_A^2)$ 是正的。该差异的符号由分子决定：\n$$ N(\\tau^2) = (y_B \\tau^2 + \\mu \\sigma_B^2)(\\tau^2 + \\sigma_A^2) - (y_A \\tau^2 + \\mu \\sigma_A^2)(\\tau^2 + \\sigma_B^2) $$\n这正是我们之前设为零的那个表达式的相反数。根据前面的推导：\n$$ N(\\tau^2) = \\tau^2 (\\tau^2(y_B - y_A) - [\\sigma_A^2(y_A - \\mu) - \\sigma_B^2(y_B - \\mu)]) $$\n使用 $\\tau_{\\star}^2$ 的定义：$\\tau_{\\star}^2 (y_A - y_B) = \\sigma_A^2(y_B - \\mu) - \\sigma_B^2(y_A - \\mu)$，这等价于 $\\tau_{\\star}^2 (y_B - y_A) = -[\\sigma_A^2(y_A - \\mu) - \\sigma_B^2(y_B - \\mu)]$。\n将此代入 $N(\\tau^2)$ 的表达式中：\n$$ N(\\tau^2) = \\tau^2 (\\tau^2(y_B - y_A) - [-\\tau_{\\star}^2(y_B - y_A)]) $$\n$$ N(\\tau^2) = \\tau^2 (y_B - y_A) (\\tau^2 - \\tau_{\\star}^2) $$\n$\\hat{\\theta}_B - \\hat{\\theta}_A$ 的符号与 $N(\\tau^2)$ 的符号相同。我们已知 $y_B - y_A = 3  0$。并且 $\\tau^2 \\ge 0$。因此，符号由项 $(\\tau^2 - \\tau_{\\star}^2)$ 决定。\n当 $\\tau^2  \\tau_{\\star}^2$ 时，项 $(\\tau^2 - \\tau_{\\star}^2)$ 为负。\n因此，$N(\\tau^2)$ 的符号为 $(+)(+)(-) = (-)$。\n这意味着对于 $\\tau^2  \\tau_{\\star}^2$，我们有 $\\hat{\\theta}_B - \\hat{\\theta}_A  0$，即 $\\hat{\\theta}_B  \\hat{\\theta}_A$。\n朴素差异 $y_B > y_A$ 被逆转为 $\\hat{\\theta}_B  \\hat{\\theta}_A$。这种现象是差异性收缩的结果。两个观测均值 $y_A = 12$ 和 $y_B = 15$ 都低于群体均值 $\\mu=20$。贝叶斯模型将两个估计值都向 $\\mu$ 收缩，从而增加了它们的值。收缩的强度由收缩因子 $B_i = \\sigma_i^2/(\\sigma_i^2 + \\tau^2)$ 决定。我们比较 $A$ 和 $B$ 的收缩因子：\n$$ B_A = \\frac{9}{9+\\tau^2} \\quad \\text{和} \\quad B_B = \\frac{1}{1+\\tau^2} $$\n因为 $9(1+\\tau^2) = 9+9\\tau^2 > 9+\\tau^2 = 1(9+\\tau^2)$，所以可得 $\\frac{9}{9+\\tau^2} > \\frac{1}{1+\\tau^2}$，即 $B_A > B_B$。\n单元 $A$ 的测量方差（$\\sigma_A^2=9$）远大于单元 $B$ 的测量方差（$\\sigma_B^2=1$），表明其测量值的可靠性较低。因此，其后验均值 $\\hat{\\theta}_A$ 会更强烈地向群体均值 $\\mu$ 收缩。由于 $y_A$ 和 $y_B$ 都低于 $\\mu$，$\\hat{\\theta}_A$ 从 $12$ 被“拉高”的幅度要大于 $\\hat{\\theta}_B$ 从 $15$ 被“拉高”的幅度。当先验信息足够丰富时（即 $\\tau^2$ 较小，特别是 $\\tau^2  \\tau_{\\star}^2$），这种差异性拉动足够强大，导致 $\\hat{\\theta}_A$ 超过 $\\hat{\\theta}_B$，从而逆转了在原始数据中观察到的差异方向。\n后验差异由下式给出\n$$ \\hat{\\theta}_B - \\hat{\\theta}_A = \\frac{\\tau^2 (y_B - y_A) (\\tau^2 - \\tau_{\\star}^2)}{(\\tau^2 + \\sigma_A^2)(\\tau^2 + \\sigma_B^2)} $$",
            "answer": "$$\\boxed{12.33}$$"
        },
        {
            "introduction": "分层模型的强大能力源于其核心假设——可交换性。然而，何时可以做出此假设？本概念性练习旨在挑战您对这一基本前提的理解。通过分析一个包含不同实验分组的场景，您将学会识别何时简单的“汇集” (pooling) 会导致系统性偏差，并理解为何需要引入更精细的模型结构（如分组特定的超先验）来确保分析的有效性。",
            "id": "4141082",
            "problem": "在对非人灵长类动物的记录会话中的脉冲计数进行群体分析时，考虑使用泊松观测模型和会话级随机效应对试验级计数进行建模。可交换性及其对分层建模的意义定义如下。如果一个会话特定参数序列 $\\{\\theta_s\\}_{s=1}^S$ 的联合分布在排列下保持不变，则该序列是可交换的。根据 de Finetti 定理，无限可交换性意味着联合定律可以写成独立同分布（i.i.d.）定律的混合形式，因此，在给定一个潜在群体参数 $\\phi$ 的条件下，会话参数是从一个共同分布 $F(\\theta \\mid \\phi)$ 中独立同分布地抽取的。在贝叶斯分层建模中，跨会话的可交换性为设置单个超先验 $p(\\phi)$ 并从中抽取每个 $\\theta_s \\sim F(\\cdot \\mid \\phi)$ 提供了依据。\n\n在神经生理学背景下，假设会话 $s$ 和试验 $t$ 的试验级脉冲计数 $y_{s,t}$ 服从 $y_{s,t} \\sim \\text{Poisson}(\\lambda_s)$，在给定会话率 $\\lambda_s$ 的情况下，各试验之间是独立的。一种常见的“朴素汇集”方法假设跨会话具有可交换性，并为所有 $s$ 设定一个单一的超先验 $\\lambda_s \\sim \\text{Gamma}(\\alpha, \\beta)$，从而得到共轭后验 $\\lambda_s \\mid \\{y_{s,t}\\} \\sim \\text{Gamma}\\left(\\alpha + \\sum_{t=1}^{n_s} y_{s,t}, \\beta + n_s\\right)$，以及对于一个留存试验的后验预测均值等于 $\\mathbb{E}[y_{s,\\text{new}} \\mid \\text{data}] = \\dfrac{\\alpha + \\sum_{t=1}^{n_s} y_{s,t}}{\\beta + n_s}$。\n\n以下哪个选项提供了一个有效的反例，证明了跨会话缺乏可交换性会使朴素汇集方法失效，并促使引入特定于组的超参数？即，与为具有科学意义的组别设置不同超参数的模型相比，使用单一超先验 $p(\\alpha, \\beta)$ 的模型会对留存试验产生系统性校准不当的后验预测均值。\n\nA. 两个科学上不同的会话组（例如，清醒会话 $A$ 和麻醉会话 $B$）具有不同的比率群体分布：对于 $A$，$\\lambda_s \\sim \\text{Gamma}(\\alpha_A, \\beta_A)$ 且 $(\\alpha_A, \\beta_A) = (2, 2)$，因此 $\\mathbb{E}[\\lambda_s \\mid g=A] = \\dfrac{2}{2} = 1$；对于 $B$，$\\lambda_s \\sim \\text{Gamma}(\\alpha_B, \\beta_B)$ 且 $(\\alpha_B, \\beta_B) = (20, 2)$，因此 $\\mathbb{E}[\\lambda_s \\mid g=B] = \\dfrac{20}{2} = 10$。考虑 $S=2$ 个会话，每组一个，每个会话有 $n_s = 5$ 次试验。观察到的总数对于 $A$ 是 $\\sum_{t=1}^{5} y_{A,t} = 5$，对于 $B$ 是 $\\sum_{t=1}^{5} y_{B,t} = 50$，这与它们各自组的均值是一致的。单一的汇集经验贝叶斯（EB; Empirical Bayes）拟合设置 $(\\alpha, \\beta) = (11, 2)$ 以反映汇集均值 $\\dfrac{5 + 50}{5 + 5} = \\dfrac{55}{10} = 5.5$。在朴素汇集下，$A$ 会话的后验预测均值为 $\\dfrac{11 + 5}{2 + 5} = \\dfrac{16}{7} \\approx 2.286$，$B$ 会话的后验预测均值为 $\\dfrac{11 + 50}{2 + 5} = \\dfrac{61}{7} \\approx 8.714$，这相对于具有科学意义的组均值 $1$ 和 $10$ 存在系统性偏倚。相比之下，具有特定于组的超参数的模型产生的后验预测均值为：$A$ 组 $\\dfrac{2 + 5}{2 + 5} = 1$，$B$ 组 $\\dfrac{20 + 50}{2 + 5} = \\dfrac{70}{7} = 10$，这证明了跨会话缺乏可交换性（它们在组内是可交换的，但在组间不是）使得朴素汇集无效，并促使使用特定于组的超参数。\n\nB. 所有会话共享相同的群体分布 $\\lambda_s \\sim \\text{Gamma}(\\alpha, \\beta)$，其中 $(\\alpha, \\beta)$ 是固定的且已知的，观察到的总数因泊松抽样变异性而在各会话间有所不同。例如，对于两个会话，$n_1 = n_2 = 5$，一个会话的 $\\sum_{t=1}^{5} y_{1,t} = 6$，另一个会话的 $\\sum_{t=1}^{5} y_{2,t} = 4$。因为存在一个单一共享的 $\\text{Gamma}(\\alpha, \\beta)$ 先验，所以会话是可交换的，朴素汇集是合适的，并且不存在组结构。\n\nC. 各会话仅在试验次数 $n_s$ 上有所不同，但在分布上是相同的，所有 $\\lambda_s \\sim \\text{Gamma}(\\alpha, \\beta)$，并且设计上是独立于 $\\lambda_s$ 随机分配 $n_s$ 的。例如，一个会话有 $n_1 = 100$ 次试验，另一个有 $n_2 = 10$ 次，并且它们观察到的总数也相应地按比例变化。在分层更新中按 $n_s$ 加权可以校正不同的暴露量，因此跨会话的可交换性仍然成立，朴素汇集是合适的。\n\nD. 会话具有相同的比率先验，但在试验间的刺激协变量上有所不同；例如，$x_t \\in \\{0, 1\\}$ 在各会话间不平衡，并且我们拟合了一个泊松回归 $y_{s,t} \\sim \\text{Poisson}(\\exp(\\beta_0 + \\beta_1 x_t))$，对 $(\\beta_0, \\beta_1)$ 使用单一先验。尽管 $x_t$ 的不平衡可能会使忽略 $x_t$ 的朴素分析产生偏倚，但在回归中包含 $x_t$ 会产生一个单一共享的 $(\\beta_0, \\beta_1)$ 先验，从而在参数级别上保持了会话的可交换性，并且不需要特定于组的超参数。",
            "solution": "用户希望我扮演一位严谨的STEM教授，验证一个关于贝叶斯分层模型的问题陈述，然后解决它。\n\n### 第一步：提取给定信息\n- **观测模型：** 对于会话 $s$ 和试验 $t$，脉冲计数 $y_{s,t} \\sim \\text{Poisson}(\\lambda_s)$，其中 $\\lambda_s$ 是特定于会话的平均率。在给定 $\\lambda_s$ 的情况下，各试验之间是独立的。\n- **可交换性定义：** 如果参数序列 $\\{\\theta_s\\}_{s=1}^S$ 的联合分布 $p(\\theta_1, \\dots, \\theta_S)$ 在索引 $(1, \\dots, S)$ 的任何排列下都保持不变，则该序列是可交换的。\n- **可交换性的推论（de Finetti 定理）：** 对于一个无限可交换序列，存在一个潜在的群体参数 $\\phi$，使得联合分布可以写为 $p(\\theta_1, \\dots, \\theta_S) = \\int \\left( \\prod_{s=1}^S F(\\theta_s \\mid \\phi) \\right) p(\\phi) d\\phi$。这意味着，在以 $\\phi$ 为条件下，$\\theta_s$ 是从一个共同分布 $F(\\cdot \\mid \\phi)$ 中独立同分布地（i.i.d.）抽取的。\n- **“朴素汇集”模型：**\n    1. 假设所有会话之间具有可交换性。\n    2. 对会话率设置单一超先验：对于所有 $s=1, \\dots, S$，有 $\\lambda_s \\sim \\text{Gamma}(\\alpha, \\beta)$。\n    3. 一个会话率的后验分布是 $\\lambda_s \\mid \\{y_{s,t}\\} \\sim \\text{Gamma}(\\alpha + \\sum_{t=1}^{n_s} y_{s,t}, \\beta + n_s)$。\n    4. 在会话 $s$ 中一个新试验的后验预测均值是 $\\mathbb{E}[y_{s,\\text{new}} \\mid \\text{data}] = \\frac{\\alpha + \\sum_{t=1}^{n_s} y_{s,t}}{\\beta + n_s}$。\n- **任务：** 识别出提供了一个有效反例的选项，其中跨会话缺乏可交换性使得朴素汇集无效。这种无效性应表现为，与具有特定于组的超参数的模型相比，单一超先验模型的后验预测均值存在系统性的校准不当。\n\n### 第二步：使用提取的给定信息进行验证\n现在将对问题陈述进行验证。\n\n1.  **科学基础：** 该问题牢固地植根于神经科学数据分析中使用的标准统计方法。用于脉冲计数的泊松观测模型是经典的。伽马先验是其共轭先验，构成了泊松-伽马混合模型（负二项分布）。可交换性、de Finetti 定理和分层建模的概念是现代贝叶斯统计学及其在群体分析中应用的核心。比较实验条件（例如，清醒与麻醉）的情景在科学上是现实的，并且是采用更复杂分层结构的常见原因。该问题在科学上和数学上都是合理的。\n2.  **问题明确：** 问题为模型、可交换性的关键假设以及失败的度量标准（后验预测均值的系统性校准不当）提供了清晰的定义。它要求从给定选项中找出一个具体的反例。这种结构导向一个唯一且有意义的解决方案。\n3.  **客观性：** 语言正式而精确。所有相关模型和量都用数学公式定义。评估选项的标准是客观的，并基于计算。\n\n问题陈述没有明显的缺陷。它在科学上是合理的，可形式化的，完整的，无矛盾的，现实的，并且问题提法是明确的。\n\n### 第三步：结论与行动\n问题陈述有效。解决方案将通过推导正确答案和评估每个选项来进行。\n\n### 基于原则的推导\n关键的核心原则是**可交换性**。“朴素汇集”模型对所有会话使用单一超先验 $\\lambda_s \\sim \\text{Gamma}(\\alpha, \\beta)$，其合理性当且仅当会话级参数 $\\{\\lambda_s\\}$ 被认为是可交换的。这意味着，在观察任何数据之前，对会话标签的任何排列都不会改变我们对其联合分布的信念。\n\n当存在能够区分某些会话与其他会话的先验信息时，就会出现缺乏可交换性的情况。一个经典的例子是存在已知的、具有科学意义的分组。如果我们知道某些会话是在清醒受试者上进行的，而另一些是在麻醉受试者上进行的，那么有理由假设这两组之间的潜在发放率存在系统性差异。在这种情况下，所有 $\\lambda_s$ 的序列是不可交换的。然而，“清醒”组内的率序列可能是可交换的，“麻醉”组内的率序列也可能是可交换的。\n\n这种对全局可交换性的违反意味着单一超先验是不合适的。相反，应该使用具有特定于组的超参数的分层模型：\n如果会话 $s$ 在组 $A$ 中，则 $\\lambda_s \\sim \\text{Gamma}(\\alpha_A, \\beta_A)$。\n如果会话 $s$ 在组 $B$ 中，则 $\\lambda_s \\sim \\text{Gamma}(\\alpha_B, \\beta_B)$。\n\n朴素汇集强制所有会话级估计向一个单一的全局均值“收缩”。当存在不同的群体组时，这个全局均值是不同组均值的无意义平均。因此，低值组中会话的估计会偏高，而高值组中会话的估计会偏低。这就是问题要求我们识别的“系统性校准不当”。\n\n我们正在寻找一个选项，该选项：\n1.  提出了一个由于已知的分组结构而导致会话并非全局可交换的情景。\n2.  证明了应用朴素汇集模型会导致后验预测均值系统性地偏倚。\n3.  展示了具有特定于组的超参数的模型可以纠正这种偏倚。\n\n### 逐项分析\n\n**A. 两个科学上不同的会话组（例如，清醒会话 $A$ 和麻醉会话 $B$）具有不同的比率群体分布：对于 $A$，$\\lambda_s \\sim \\text{Gamma}(\\alpha_A, \\beta_A)$ 且 $(\\alpha_A, \\beta_A) = (2, 2)$，因此 $\\mathbb{E}[\\lambda_s \\mid g=A] = \\frac{2}{2} = 1$；对于 $B$，$\\lambda_s \\sim \\text{Gamma}(\\alpha_B, \\beta_B)$ 且 $(\\alpha_B, \\beta_B) = (20, 2)$，因此 $\\mathbb{E}[\\lambda_s \\mid g=B] = \\frac{20}{2} = 10$。考虑 $S=2$ 个会话，每组一个，每个会话有 $n_s = 5$ 次试验。观察到的总数对于 $A$ 是 $\\sum_{t=1}^{5} y_{A,t} = 5$，对于 $B$ 是 $\\sum_{t=1}^{5} y_{B,t} = 50$，这与它们各自组的均值是一致的。单一的汇集经验贝叶斯（EB; Empirical Bayes）拟合设置 $(\\alpha, \\beta) = (11, 2)$ 以反映汇集均值 $\\frac{5 + 50}{5 + 5} = \\frac{55}{10} = 5.5$。在朴素汇集下，$A$ 会话的后验预测均值为 $\\frac{11 + 5}{2 + 5} = \\frac{16}{7} \\approx 2.286$，$B$ 会话的后验预测均值为 $\\frac{11 + 50}{2 + 5} = \\frac{61}{7} \\approx 8.714$，$这相对于具有科学意义的组均值 $1$ 和 $10$ 存在系统性偏倚。相比之下，具有特定于组的超参数的模型产生的后验预测均值为：$A$ 组 $\\frac{2 + 5}{2 + 5} = 1$，$B$ 组 $\\frac{20 + 50}{2 + 5} = \\frac{70}{7} = 10$，$这证明了跨会话缺乏可交换性（它们在组内是可交换的，但在组间不是）使得朴素汇集无效，并促使使用特定于组的超参数。**\n\n该选项直接实现了推导中描述的情景。\n- **缺乏可交换性：** 它假定了两个已知的、不同的组（$A$ 和 $B$），它们具有不同的潜在率分布：$\\mathbb{E}[\\lambda_s \\mid A] = 1$ 和 $\\mathbb{E}[\\lambda_s \\mid B] = 10$。这明确违反了全局可交换性。\n- **朴素汇集的校准不当：** 它应用了一个单一的汇集先验 $\\text{Gamma}(11, 2)$（其均值 $11/2 = 5.5$ 与数据的总均值匹配）。\n    - 对于 $A$ 组，数据均值为 $5/5 = 1$。真实的先验均值为 $1$。朴素模型预测 $\\mathbb{E}[y_{A,\\text{new}} \\mid \\text{data}] = \\frac{11+5}{2+5} = \\frac{16}{7} \\approx 2.286$。这被高估了，向全局均值 $5.5$ 收缩。\n    - 对于 $B$ 组，数据均值为 $50/5 = 10$。真实的先验均值为 $10$。朴素模型预测 $\\mathbb{E}[y_{B,\\text{new}} \\mid \\text{data}] = \\frac{11+50}{2+5} = \\frac{61}{7} \\approx 8.714$。这被低估了，向全局均值 $5.5$ 收缩。\n    - 这种校准不当是系统性的：低值组被高估，高值组被低估。\n- **分组模型的成功：** 特定于组的模型为每个组使用了正确的先验。\n    - 对于 $A$ 组，它正确地计算出 $\\mathbb{E}[y_{A,\\text{new}} \\mid \\text{data}] = \\frac{\\alpha_A + \\sum y_{A,t}}{\\beta_A + n_A} = \\frac{2+5}{2+5} = 1$。\n    - 对于 $B$ 组，它正确地计算出 $\\mathbb{E}[y_{B,\\text{new}} \\mid \\text{data}] = \\frac{\\alpha_B + \\sum y_{B,t}}{\\beta_B + n_B} = \\frac{20+50}{2+5} = 10$。\n    - 这些结果与组均值完美校准。\n所有计算都是正确的，并且推理完全符合问题的要求。\n\n结论：**正确**。\n\n**B. 所有会话共享相同的群体分布 $\\lambda_s \\sim \\text{Gamma}(\\alpha, \\beta)$，其中 $(\\alpha, \\beta)$ 是固定的且已知的，观察到的总数因泊松抽样变异性而在各会话间有所不同。例如，对于两个会话，$n_1 = n_2 = 5$，一个会话的 $\\sum_{t=1}^{5} y_{1,t} = 6$，另一个会话的 $\\sum_{t=1}^{5} y_{2,t} = 4$。因为存在一个单一共享的 $\\text{Gamma}(\\alpha, \\beta)$ 先验，所以会话是可交换的，朴素汇集是合适的，并且不存在组结构。**\n\n该选项描述了可交换性假设成立的确切情景。数据的变异（$\\sum y_{1,t} = 6$ vs. $\\sum y_{2,t} = 4$）归因于随机抽样噪声，而不是潜在率的系统性差异。因此，朴素汇集是正确且合理的过程。这是何时使用朴素汇集的例子，而不是反对它的反例。\n\n结论：**错误**。\n\n**C. 各会话仅在试验次数 $n_s$ 上有所不同，但在分布上是相同的，所有 $\\lambda_s \\sim \\text{Gamma}(\\alpha, \\beta)$，并且设计上是独立于 $\\lambda_s$ 随机分配 $n_s$ 的。例如，一个会话有 $n_1 = 100$ 次试验，另一个有 $n_2 = 10$ 次，并且它们观察到的总数也相应地按比例变化。在分层更新中按 $n_s$ 加权可以校正不同的暴露量，因此跨会话的可交换性仍然成立，朴素汇集是合适的。**\n\n该选项也描述了可交换性成立的情况。会话级参数 $\\lambda_s$ 被明确说明是从一个相同的分布中抽取的。试验次数 $n_s$ 的差异并不违反参数级的可交换性。贝叶斯更新公式 $\\text{Gamma}(\\alpha + \\sum y_{s,t}, \\beta + n_s)$ 正确地考虑了 $n_s$，为具有更多试验的会话数据赋予了更大的权重。这是分层模型的一个特性，而不是一个缺陷。朴素汇集仍然是合适的。\n\n结论：**错误**。\n\n**D. 会话具有相同的比率先验，但在试验间的刺激协变量上有所不同；例如，$x_t \\in \\{0, 1\\}$ 在各会话间不平衡，并且我们拟合了一个泊松回归 $y_{s,t} \\sim \\text{Poisson}(\\exp(\\beta_0 + \\beta_1 x_t))$，对 $(\\beta_0, \\beta_1)$ 使用单一先验。尽管 $x_t$ 的不平衡可能会使忽略 $x_t$ 的朴素分析产生偏倚，但在回归中包含 $x_t$ 会产生一个单一共享的 $(\\beta_0, \\beta_1)$ 先验，从而在参数级别上保持了会话的可交换性，并且不需要特定于组的超参数。**\n\n该选项描述了一个更复杂的模型（泊松广义线性模型），该模型使用协变量 $x_t$ 来解释逐个试验的异质性。关键点在于，假设一组单一的回归参数 $(\\beta_0, \\beta_1)$ 适用于所有会话，并对它们设置了一个单一的先验。这在参数级别上维持了可交换性的假设。该选项正确地指出，不考虑协变量 $x_t$ 会导致问题，但它接着描述了*正确*的建模解决方案，该方案不涉及将会话分成具有不同超参数的组。相反，它维持了一个更灵活的单一群体模型。这不是一个关于可交换性失效导致汇集无效的反例，而是一个如何正确建模异质性以保持有效汇集结构的例子。\n\n结论：**错误**。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}