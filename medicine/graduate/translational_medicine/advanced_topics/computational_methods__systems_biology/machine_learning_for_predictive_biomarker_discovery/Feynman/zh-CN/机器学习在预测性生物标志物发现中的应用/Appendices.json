{
    "hands_on_practices": [
        {
            "introduction": "在转化医学中，一个核心目标是实现个体化治疗，而这依赖于对生物标志物的深刻理解。然而，“生物标志物”一词涵盖了不同的功能角色。本练习旨在通过一个精确的思维实验，帮助您掌握预后性 (prognostic) 和预测性 (predictive) 生物标志物之间的根本区别。理解这一区别至关重要，因为它直接决定了我们应该如何构建和评估机器学习模型，以确保其在临床决策中具有真正的实用价值 。",
            "id": "5027244",
            "problem": "考虑一项评估抗血管生成疗法的转化肿瘤学随机临床试验，其中治疗分配 $T \\in \\{0,1\\}$ 是随机的，满足 $P(T=1)=P(T=0)=\\frac{1}{2}$。设在治疗前测量了一个基线血液生物标志物 $X \\in \\mathbb{R}$，并让二元结局 $Y \\in \\{0,1\\}$ 表示在 $6$ 个月内是否发生疾病进展（$Y=1$ 表示发生进展）。假设满足随机试验中因果推断的标准可识别性条件：一致性、正值性和随机化意味着可交换性，因此 $E[Y \\mid X=x, T=t]$ 可识别在治疗 $t$ 下的条件平均潜在结局。\n\n将预后性生物标志物定义为基线风险随 $X$ 变化的标志物（即 $P(Y=1 \\mid X=x, T=0)$ 在 $x$ 上不是常数），并将预测性生物标志物定义为条件平均治疗效应（CATE）在其上不是常数的标志物，CATE 由 $\\tau(x) = E[Y \\mid X=x, T=1] - E[Y \\mid X=x, T=0]$ 给出。\n\n您的任务是选择提供以下内容的选项：\n- 一个明确的、科学上合理的、生物标志物 $X$ 是预后性但不是预测性的数据生成机制，表现为 $P(Y=1 \\mid X=x)$ 随 $x$ 变化而 $\\tau(x)$ 在 $x$ 上是常数。\n- 一个正确的、基于原则的关于其对转化医学中机器学习模型效用的影响的讨论，包括 $X$ 是否能改善个性化治疗决策，哪种类型的模型是合适的，以及哪些评估标准能反映所述机制下的效用。\n\n选择唯一的最佳选项。\n\nA. 设 $X \\sim \\mathcal{N}(0,1)$，$T \\in \\{0,1\\}$ 是随机的，且 $Y \\mid X=x, T=t \\sim \\text{Bernoulli}(p_0(x) + \\delta t)$，其中 $p_0(x) = 0.15 + 0.3 \\Phi(x)$，$\\Phi$ 是标准正态累积分布函数，且 $\\delta = -0.10$。那么对于所有 $x$，$E[Y \\mid X=x, T=1] - E[Y \\mid X=x, T=0] = \\delta$，而 $P(Y=1 \\mid X=x, T=0) = p_0(x)$ 随 $x$ 增加而增加。影响：$X$ 是预后性的（对基线进展风险进行分层）但不是预测性的（治疗效应没有异质性）。最优治疗策略是治疗所有患者，因为风险差异 $\\delta$ 是一致有益的（降低了进展概率）。使用 $X$ 来针对异质性治疗效应的机器学习模型没有增加临床决策价值；估计 $p_0(X)$ 的风险模型对于试验富集、资源规划和基线风险分层仍然有用。适当的评估应强调治疗规则下的策略价值（此处通过治疗所有患者来最大化）以及基线风险的校准度/区分度（例如，受试者工作特征曲线下面积（AUROC）和校准曲线），而不是条件平均治疗效应（CATE）的估计性能。\n\nB. 设 $X \\sim \\mathcal{N}(0,1)$，$T \\in \\{0,1\\}$ 是随机的，且 $P(Y=1 \\mid X=x, T=t) = \\sigma(\\alpha + \\beta x + \\gamma t)$，其中 $\\sigma(u) = \\frac{1}{1+e^{-u}}$，$\\alpha = -1.0$，$\\beta = 1.0$，$\\gamma = -0.5$。因为 $\\gamma$ 是常数，该机制产生一个恒定的 $E[Y \\mid X=x, T=1] - E[Y \\mid X=x, T=0]$，所以 $X$ 是预后性的但不是预测性的。影响：可以安全地使用 $X$ 来进行个性化治疗；异质性治疗效应模型将识别出具有更大利益绝对值的亚组。\n\nC. 设 $X$ 被缩放到 $[0,1]$，$T \\in \\{0,1\\}$ 是随机的，且 $P(Y=1 \\mid X=x, T=t) = 0.30 + 0.10 x + 0.20 t$。那么对于所有 $x$，$E[Y \\mid X=x, T=1] - E[Y \\mid X=x, T=0] = 0.20$，并且 $P(Y=1 \\mid X=x, T=0) = 0.30 + 0.10 x$ 随 $x$ 变化。影响：因为该生物标志物增加了基线风险，所以在个性化治疗决策规则中使用 $X$ 将通过更积极地治疗那些基线风险最高的人来提高临床效用，因为他们有更大的绝对获益。\n\nD. 设 $X \\sim \\mathcal{N}(0,1)$，$T \\in \\{0,1\\}$ 是随机的，且 $P(Y=1 \\mid X=x, T=t) = 0.40 + 0.20 t$。那么 $E[Y \\mid X=x, T=1] - E[Y \\mid X=x, T=0] = 0.20$ 是常数，且 $P(Y=1 \\mid X=x)$ 不依赖于 $x$。影响：$X$ 是预后性的但不是预测性的。使用 $X$ 的异质性治疗效应机器学习模型将提高策略价值。",
            "solution": "问题陈述已经过验证，是合理的。这是一个在因果推断和转化医学领域中定义明确的问题，它要求对预后性和预测性生物标志物的定义及其对模型构建和评估的影响有精确的理解。任务是识别出那个提供了正确的数据生成机制和正确解读的选项。\n\n一个生物标志物 $X$ 被定义为：\n1.  **预后性 (Prognostic)**：如果结局的基线风险随生物标志物的值而变化。数学上，$P(Y=1 \\mid X=x, T=0)$ 在 $x$ 上不是常数。\n2.  **预测性 (Predictive)**：如果治疗效应随生物标志物的值而变化。数学上，条件平均治疗效应 (CATE)，$\\tau(x) = E[Y \\mid X=x, T=1] - E[Y \\mid X=x, T=0]$，在 $x$ 上不是常数。一个非预测性的生物标志物是指 $\\tau(x)$ 为常数的标志物。\n\n问题要求我们找到一个选项，其中生物标志物 $X$ 是预后性的但*不是*预测性的，并且其影响被正确地描述。\n\n我们来分析每个选项。\n\n**选项 A 的分析：**\n- **数据生成机制**：进展（$Y=1$）的条件概率由一个线性概率模型给出：\n$$P(Y=1 \\mid X=x, T=t) = p_0(x) + \\delta t$$\n其中 $p_0(x) = 0.15 + 0.3 \\Phi(x)$ 且 $\\delta = -0.10$。这里，$\\Phi(x)$ 是标准正态分布的累积分布函数（CDF）。\n\n- **预后性验证**：我们评估基线风险（在 $T=0$ 下）：\n$$P(Y=1 \\mid X=x, T=0) = p_0(x) + \\delta(0) = p_0(x) = 0.15 + 0.3 \\Phi(x)$$\n由于 $\\Phi(x)$ 是 $x$ 的严格递增函数，因此 $P(Y=1 \\mid X=x, T=0)$ 在 $x$ 上不是常数。所以，**$X$ 是一个预后性生物标志物**。\n\n- **预测性验证**：我们计算 CATE，$\\tau(x)$:\n$$\\tau(x) = E[Y \\mid X=x, T=1] - E[Y \\mid X=x, T=0]$$\n$$E[Y \\mid X=x, T=1] = p_0(x) + \\delta(1) = p_0(x) + \\delta$$\n$$E[Y \\mid X=x, T=0] = p_0(x) + \\delta(0) = p_0(x)$$\n$$\\tau(x) = (p_0(x) + \\delta) - p_0(x) = \\delta = -0.10$$\nCATE，$\\tau(x)$，对于所有 $x$ 的值都是常数。因此，**$X$ 不是一个预测性生物标志物**。\n\n- **合理性检查**：线性概率模型必须产生在 $[0,1]$ 范围内的概率。由于对于 $x \\in \\mathbb{R}$ 有 $0  \\Phi(x)  1$，基线风险 $p_0(x)$ 是有界的：$0.15  p_0(x)  0.15 + 0.3 = 0.45$。对于 $T=1$，风险是 $p_0(x) - 0.10$，其界限为 $0.05  p_0(x) - 0.10  0.35$。所有概率都是有效的。该机制是合理的。\n\n- **影响分析**：将 $X$ 定性为预后性但非预测性是正确的。治疗效应为 $\\delta = -0.10$，意味着无论患者的 $X$ 值如何，该疗法都能将进展概率降低一个恒定的量。这是一种统一的益处。因此，最优策略是治疗所有患者。由于治疗效应不存在异质性（HTE），一个旨在估计作为 $X$ 函数的 CATE 的机器学习模型对于优化治疗决策是无用的。最优决策规则不依赖于 $X$。一个针对 $p_0(X)$ 的风险模型是一个预后模型。它可以根据基线风险对患者进行分层，这对于识别用于临床试验招募（富集）的高风险人群、患者咨询和卫生服务规划非常有价值。模型的评估应侧重于实际有用的方面。在这里，这意味着评估预后模型的性能（例如，通过 AUROC 进行区分度评估，通过校准图进行准确性评估），并认识到治疗策略的价值是通过一个简单的规则（治疗所有人）而不是一个复杂的 CATE 模型来最大化的。所有陈述的影响在科学上和逻辑上都是合理的。\n\n- **对 A 的结论**：**正确**。\n\n**选项 B 的分析：**\n- **数据生成机制**：条件概率由逻辑斯蒂模型给出：\n$$P(Y=1 \\mid X=x, T=t) = \\sigma(\\alpha + \\beta x + \\gamma t) = \\frac{1}{1 + e^{-(\\alpha + \\beta x + \\gamma t)}}$$\n其中 $\\alpha = -1.0$，$\\beta = 1.0$，$\\gamma = -0.5$。\n\n- **预后性验证**：\n$$P(Y=1 \\mid X=x, T=0) = \\sigma(-1.0 + x)$$\n这是 $x$ 的一个非恒定函数，所以 **$X$ 是预后性的**。\n\n- **预测性验证**：该选项错误地声称一个恒定的 $\\gamma$ 意味着一个恒定的 CATE。我们来计算 CATE：\n$$\\tau(x) = \\sigma(-1.0 + x - 0.5) - \\sigma(-1.0 + x) = \\sigma(x - 1.5) - \\sigma(x - 1.0)$$\n逻辑斯蒂函数 $\\sigma(u)$ 是非线性的。S 型曲线上两点之差 $\\sigma(z+c) - \\sigma(z)$ 在 $z$ 上不是常数。因此，$\\tau(x)$ 在 $x$ 上不是常数。**$X$ 是一个预测性生物标志物**。该选项分析的基本前提是错误的。在逻辑斯蒂模型中，一个恒定的 $\\gamma$ 意味着治疗的*比值比*是恒定的，而不是风险差异（CATE）恒定。\n\n- **对 B 的结论**：**不正确**。其数学推理存在缺陷；该模型描述的是一个预测性生物标志物，与选项的声明相反。\n\n**选项 C 的分析：**\n- **数据生成机制**：一个线性概率模型：\n$$P(Y=1 \\mid X=x, T=t) = 0.30 + 0.10x + 0.20t$$\n\n- **预后性验证**：\n$$P(Y=1 \\mid X=x, T=0) = 0.30 + 0.10x$$\n这在 $x$ 上不是常数。所以，**$X$ 是预后性的**。\n\n- **预测性验证**：\n$$\\tau(x) = (0.30 + 0.10x + 0.20) - (0.30 + 0.10x) = 0.20$$\nCATE 是常数。所以，**$X$ 不是预测性的**。\n\n- **合理性检查**：对于 $x\\in[0,1]$，概率 $P(Y=1|x, T=0)$ 的范围是 $0.30$ 到 $0.40$，而 $P(Y=1|x, T=1)$ 的范围是 $0.50$ 到 $0.60$。所有概率都是有效的。\n\n- **影响分析**：该选项声称“……在个性化治疗决策规则中使用 $X$ 将通过更积极地治疗那些基线风险最高的人来提高临床效用，因为他们有更大的绝对获益。”这是一个错误的结论。我们刚刚证明了“绝对获益”（即 CATE，或风险差异）是一个常数 $0.20$。它对所有患者都是相同的，无论他们的基线风险如何。将高的预后风险与高的预测获益混为一谈是一个经典的错误。最优治疗规则不依赖于 $X$。（在这种情况下，由于 $\\tau(x)=0.20>0$，治疗增加了进展的概率，所以最优规则是不治疗任何人）。\n\n- **对 C 的结论**：**不正确**。虽然机制被正确指定，但对其影响的解读存在根本性错误。\n\n**选项 D 的分析：**\n- **数据生成机制**：\n$$P(Y=1 \\mid X=x, T=t) = 0.40 + 0.20t$$\n\n- **预后性验证**：\n$$P(Y=1 \\mid X=x, T=0) = 0.40 + 0.20(0) = 0.40$$\n这在 $x$ 上是常数。因此，**$X$ 不是一个预后性生物标志物**。这直接与问题要求 $X$ 是预后性的条件相矛盾。\n\n- **影响分析**：该选项错误地陈述“$X$ 是预后性的”。它还错误地声称“使用 $X$ 的异质性治疗效应机器学习模型将提高策略价值”。由于在这个模型中 $X$ 既不是预后性的也不是预测性的（CATE 是一个常数 $0.20$），它对于风险分层或个性化治疗没有任何价值。\n\n- **对 D 的结论**：**不正确**。所提出的数据生成机制不满足问题中生物标志物是预后性的首要条件。\n\n**结论**\n只有选项 A 提供了一个既科学合理又正确满足生物标志物是预后性但非预测性条件的数据生成机制。此外，它是唯一一个对此类场景下机器学习模型效用得出正确、细致入微结论的选项。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在确定了寻找预测性生物标志物的目标后，我们面临着如何从高维数据（例如基因组学数据，特征数量 $p$ 远大于样本数量 $n$）中稳健地构建和验证模型的挑战。一个常见且严重的陷阱是在特征筛选过程中发生“数据泄漏”，这会导致对模型性能的评估过于乐观。本练习将指导您设计一个无泄漏的嵌套交叉验证流程，以获得对模型泛化能力的无偏估计，这是确保生物标志物发现研究可信度和可重复性的关键一步 。",
            "id": "5027250",
            "problem": "您正在使用高维基因表达数据，设计一项转化肿瘤学中的预测性生物标志物发现研究。您有一个包含 $n$ 名患者的队列，这些患者具有二元临床终点（有效 vs. 无效），$Y \\in \\{0,1\\}$，以及 $p$ 个信使核糖核酸 (mRNA) 特征，其中 $p \\gg n$。您计划将使用双样本 $t$ 检验的单变量筛选与最小绝对收缩和选择算子 (LASSO) 逻辑回归相结合，以构建一个分类器。您的目标是获得泛化性能的无偏估计和一组可复现的候选生物标志物。\n\n您的同事提出了几个流程。请选择同时满足以下两点的选项：(i) 正确指定了一个无泄漏的嵌套交叉验证设计，用于结合单变量筛选和 LASSO 逻辑回归，以及 (ii) 从第一性原理出发，严格论证了为什么在交叉验证之前对完整数据集执行一次单变量 $t$ 检验会导致估计的泛化误差出现乐观偏差。\n\n注：\n- 交叉验证 (CV) 用于估计一个学习到的预测器 $f$ 的预期样本外风险 $\\mathcal{R}(f) = \\mathbb{E}_{(X,Y)}[\\ell(f(X),Y)]$，其中 $\\ell$ 是一个损失函数（对于二元分类，$\\ell$ 可能是错分损失或逻辑损失）。\n- 嵌套交叉验证指的是用于无偏性能估计的外部 CV 循环和用于超参数调整的内部 CV 循环。\n- 对于一个特征 $j$ 的双样本 $t$ 检验，是在仅使用可用于该计算的数据的情况下，比较 $Y=1$ 和 $Y=0$ 组之间的均值。\n- 所有使用数据信息（例如，特征选择、归一化、插补）的预处理步骤，都必须明确说明使用了哪些样本来学习参数。\n\n哪个选项是正确的？\n\nA. 外部 $K_{\\text{out}}$-折交叉验证：对于每个外部折，将数据划分为训练集和测试集。仅在外部训练集上，为每个特征 $j \\in \\{1,\\dots,p\\}$ 计算双样本 $t$-统计量，并按预先指定的规则（例如，按 $|t|$ 值取前 $m$ 个或使用 $p$-值阈值）选择特征，然后仅使用来自外部训练集的均值和标准差对所选特征进行标准化。在这些选定的特征范围内，对外部训练集运行内部 $K_{\\text{in}}$-折交叉验证，以调整逻辑回归的 LASSO 惩罚项 $\\lambda$。使用选择的 $\\lambda$ 和选定的特征，在完整的外部训练集上拟合 LASSO 逻辑模型，并在未接触的外部测试集上进行评估。汇总所有外部折的性能。论证：交叉验证旨在通过数据划分来估计 $\\mathcal{R}(f)$，这种划分在数据生成分布的条件下保持了训练数据和验证数据之间的独立性。如果在交叉验证之前对完整数据集执行一次单变量 $t$ 检验，选择算子 $\\mathcal{S}$ 将依赖于整个标签向量 $Y$，包括外部测试折的标签；这将使模型类别受制于测试结果，破坏了无偏风险估计所需的可交换性，并导致了乐观偏差。在全局零假设（即 $X$ 和 $Y$ 独立）下，$p$ 个特征的 $t$-统计量近似为独立的标准正态分布，因此选择最大的 $|t|$ 值会产生一个量级约为 $\\sqrt{2 \\log p}$ 的期望最大值；在对所有样本进行选择后，在交叉验证中使用这些特征，会使得测试折中存在的偶然相关性夸大表观准确率，即使真实风险仍处于随机水平。\n\nB. 对完整数据集执行一轮双样本 $t$ 检验以预选特征，应用错误发现率阈值，并锁定此特征集。然后仅使用预选的特征运行嵌套交叉验证，以调整 LASSO 惩罚项 $\\lambda$。由于 LASSO 是通过嵌套交叉验证调整的，并且测试折未用于拟合 LASSO 系数，因此尽管使用了完整数据集进行单变量筛选，性能估计仍是无偏的。\n\nC. 为了计算效率，仅在第一个外部折中，在外部训练集内执行内部交叉验证以选择超参数，并同时通过在每个内部训练分割上运行双样本 $t$ 检验并取所有内部折中通过阈值的特征的并集来选择特征。为所有剩余的外部折重复使用此固定的特征集以减少方差。由于在那些剩余的折中没有重新学习特征，所以外部交叉验证的估计是无偏的。\n\nD. 带分层的外部 $K_{\\text{out}}$-折交叉验证。在每次外部迭代中，使用从完整数据集计算出的均值和标准差对所有特征进行标准化（以避免不稳定性），然后，仅在外部训练集上，使用双样本 $t$ 检验选择特征，并照常拟合内部调整后的 LASSO 模型。由于标准化不使用标签，因此在完整数据集上计算它不会使交叉验证的估计产生偏差。\n\nE. 为了防止多重检验问题，首先对所有 $p$ 个特征在完整数据集上运行双样本 $t$ 检验，并在水平 $\\alpha$ 下应用 Benjamini–Hochberg 错误发现率 (FDR) 控制。将得到的集合用作固定的候选生物标志物。然后执行嵌套交叉验证来调整 LASSO 并估计性能。严格论证：FDR 控制考虑了选择过程，因此在交叉验证前使用完整数据的 $t$ 检验不会使性能估计产生偏差；任何偏差都通过 FDR 控制和用于 $\\lambda$ 选择的交叉验证嵌套而消除了。",
            "solution": "用户希望对一个用于生物标志物发现的机器学习流程进行批判性评估。\n\n### 第1步：提取已知信息\n- **研究背景**：转化肿瘤学中的预测性生物标志物发现。\n- **数据类型**：高维基因表达数据。\n- **队列大小**：$n$ 名患者。\n- **特征空间**：$p$ 个信使核糖核酸 (mRNA) 特征，满足高维条件 $p \\gg n$。\n- **终点**：一个二元临床终点，$Y \\in \\{0,1\\}$，表示有效对无效状态。\n- **提议的方法论**：结合使用双样本 $t$ 检验的单变量筛选和基于最小绝对收缩和选择算子 (LASSO) 逻辑回归的分类器。\n- **主要目标**：\n    1. 获得泛化性能的无偏估计。\n    2. 获得一组可复现的候选生物标志物。\n- **技术定义**：\n    - 交叉验证 (CV) 用于估计一个学习到的预测器 $f$ 的预期样本外风险，定义为 $\\mathcal{R}(f) = \\mathbb{E}_{(X,Y)}[\\ell(f(X),Y)]$，其中 $\\ell$ 是一个损失函数。\n    - 嵌套交叉验证包含一个用于性能估计的外部 CV 循环和一个用于超参数调整的内部 CV 循环。\n    - 对于一个特征 $j$ 的双样本 $t$ 检验比较的是 $Y=1$ 和 $Y=0$ 组之间的平均表达水平。\n    - 所有依赖于数据的预处理步骤都必须明确说明使用了哪些数据样本。\n\n### 第2步：使用提取的已知信息进行验证\n- **科学依据**：该问题在生物信息学和统计机器学习领域有充分的依据。使用来自基因组学（mRNA表达）的高维数据（$p \\gg n$）来预测临床结果的场景是一个典型问题。所提到的方法——单变量筛选、$t$ 检验、LASSO 和嵌套交叉验证——都是此背景下的标准且合适的方法。“数据泄漏”及其对性能估计影响的核心问题是机器学习方法论中一个基本且关键的概念。\n- **适定性**：该问题是适定的。它要求从一系列选项中识别出正确的程序及其论证。基于已建立的统计学习理论原则，存在一个唯一的、客观正确的答案。\n- **客观性**：该问题使用来自统计学和机器学习的精确、客观和标准的术语进行陈述。它没有歧义和主观性陈述。\n\n### 第3步：结论与行动\n问题陈述是**有效的**。它科学合理、适定、客观，并描述了应用机器学习中一个现实且重要的挑战。我现在将继续推导和评估这些选项。\n\n### 基于原则的推导\n\n估计泛化性能的核心原则是模拟真实世界的场景，即将在可用数据上训练的模型应用于新的、未见过的数据。交叉验证 (CV) 是实现这一目标的统计方法。CV 的核心假设是，每个折中的测试集可作为真正未见过数据的代理。为使此假设成立，测试集绝不能以任何方式用于构建、调整或选择模型。任何在训练阶段使用来自测试数据信息的程序都违反了这一原则。这种现象被称为“数据泄漏”或“信息泄漏”。\n\n一个完整的模型构建流程包括所有依赖于数据的步骤：\n1.  特征预处理（例如，标准化）。\n2.  特征选择（例如，使用 $t$ 检验）。\n3.  超参数调整（例如，选择 LASSO 惩罚项 $\\lambda$）。\n4.  模型拟合（例如，估计逻辑回归系数）。\n\n为了获得泛化误差的无偏估计，*所有*这些步骤都必须仅使用给定 CV 折的训练数据来执行。然后将得到的流程应用于该折的留出测试数据，以计算性能指标。所有折的这些指标的平均值提供了最终的估计。\n\n设完整数据集为 $\\mathcal{D} = \\{(X_i, Y_i)\\}_{i=1}^n$。设 $\\mathcal{S}$ 是一个特征选择算子，它将数据集映射到特征索引的一个子集。如果 $\\mathcal{S}$ 应用于完整数据集 $\\mathcal{D}$ 以获得一个特征集 $\\mathcal{F} = \\mathcal{S}(\\mathcal{D})$，然后在 $\\mathcal{D}_{\\mathcal{F}}$（只包含 $\\mathcal{F}$ 中特征的数据）上执行 CV，则该过程被污染了。选择算子 $\\mathcal{S}$ 使用了来自整个数据集的标签 $Y$，包括了那些稍后会出现在测试折中的样本的标签。\n\n这会引起乐观偏差。考虑零假设，即没有任何特征真正与结果 $Y$ 相关。在高维设置（$p \\gg n$）中，纯粹由于偶然性，某些特征会表现出与 $Y$ 的伪相关性。在完整数据集上执行的特征选择程序将优先选择这些伪相关特征。因为测试数据是此选择过程的一部分，所以所选特征在构造上就与测试数据中的标签相关。随后在这些特征上训练的模型在测试数据上会表现得很好，但这并非因为它学习到了一种可泛化的模式，而是因为它利用了存在于整个数据集中的特定偶然相关性。这导致估计的性能优于真实的泛化性能（在零假设下，真实性能应处于随机水平）。\n\n正确的程序是嵌套交叉验证，其中外部循环用于性能估计，内部循环用于超参数调整。至关重要的是，任何特征选择都必须是外部循环的一部分。\n对于每个外部折 $k \\in \\{1, \\dots, K_{\\text{out}}\\}$：\n1.  将 $\\mathcal{D}$ 划分为外部训练集 $\\mathcal{D}_{\\text{train}}^{(k)}$ 和外部测试集 $\\mathcal{D}_{\\text{test}}^{(k)}$。\n2.  *仅*使用 $\\mathcal{D}_{\\text{train}}^{(k)}$ 进行特征选择，得到一个特征集 $\\mathcal{F}^{(k)}$。\n3.  *仅*使用带有特征 $\\mathcal{F}^{(k)}$ 的 $\\mathcal{D}_{\\text{train}}^{(k)}$ 进行内部 CV，以找到最优超参数 $\\lambda^{\\star}$。\n4.  在完整的 $\\mathcal{D}_{\\text{train}}^{(k)}$ 上，使用特征 $\\mathcal{F}^{(k)}$ 和超参数 $\\lambda^{\\star}$ 训练该折的最终模型 $f^{(k)}$。\n5.  在留出的测试集 $\\mathcal{D}_{\\text{test}}^{(k)}$ 上计算 $f^{(k)}$ 的性能。\n最终的性能估计是所有 $K_{\\text{out}}$ 个折上性能的平均值。\n\n### 逐个选项分析\n\n**A. 外部 $K_{\\text{out}}$-折交叉验证：对于每个外部折，将数据划分为训练集和测试集。仅在外部训练集上，为每个特征 $j \\in \\{1,\\dots,p\\}$ 计算双样本 $t$-统计量并按预先指定的规则选择特征... 然后仅使用来自外部训练集的均值和标准差对所选特征进行标准化。在这些选定的特征范围内，对外部训练集运行内部 $K_{\\text{in}}$-折交叉验证以调整 LASSO 惩罚项 $\\lambda$... 在完整的外部训练集上拟合 LASSO 逻辑模型，使用选择的 $\\lambda$ 和选定的特征，并在未接触的外部测试集上进行评估... 论证：...如果在交叉验证之前对完整数据集执行一次单变量 $t$ 检验...选择算子 $\\mathcal{S}$ 将依赖于整个标签向量 $Y$,... 破坏了无偏风险估计所需的可交换性，并导致了乐观偏差。在全局零假设下...，选择最大的 $|t|$ 值会产生一个量级约为 $\\sqrt{2 \\log p}$ 的期望最大值...**\n\n- **程序**：所描述的程序是一个教科书式的正确、无泄漏的嵌套交叉验证流程的例子。每个依赖于数据的步骤（通过 $t$ 检验进行特征选择、标准化、通过内部 CV 进行超参数调整）都严格地在外部训练折内执行，不使用来自外部测试折的任何信息。\n- **论证**：其论证是严谨且统计上合理的。它正确地指出，使用完整数据集进行特征选择使得选择算子依赖于测试标签，这破坏了无偏风险估计的条件。所提供的关于全局零假设下偏差来源的推理是复杂而正确的：在高维中，预期会出现极端的偶然相关性（最大检验统计量的量级为 $\\sqrt{2 \\log p}$），而在完整数据集上进行预筛选会将这些偶然相关性固化到模型评估阶段，从而导致乐观偏差。\n- **结论**：**正确**。\n\n**B. 对完整数据集执行一轮双样本 $t$ 检验以预选特征... 然后仅使用预选的特征运行嵌套交叉验证以调整 LASSO 惩罚项 $\\lambda$。由于 LASSO 是通过嵌套交叉验证调整的，并且测试折未用于拟合 LASSO 系数，因此性能估计仍是无偏的...**\n\n- **程序**：此程序涉及在开始交叉验证*之前*对整个数据集执行特征选择。如上所述，这是数据泄漏的一个典型例子。\n- **论证**：其论证存在缺陷。它错误地声称估计是无偏的，理由是测试折没有用于拟合 LASSO 模型的*最终系数*。这忽略了一个事实，即测试折*被用来*定义构建模型的特征空间本身。特征选择步骤是学习算法的一个组成部分，其对测试数据的使用使性能估计无效。\n- **结论**：**不正确**。\n\n**C. 为了计算效率，仅在第一个外部折中，在外部训练集内执行内部交叉验证以选择超参数并同时选择特征... 为所有剩余的外部折重复使用此固定的特征集以减少方差。由于在那些剩余的折中没有重新学习特征，所以外部交叉验证的估计是无偏的。**\n\n- **程序**：此程序仅基于第一个外部折的训练数据选择特征，然后在所有后续的外部折中重复使用此选择。\n- **论证**：这违反了交叉验证的原则，即模拟在 $K_{\\text{out}}$ 个不同的训练集上从头开始训练模型 $K_{\\text{out}}$ 次。在第一个折之后固定特征集，使得第 $2, \\dots, K_{\\text{out}}$ 折的建模过程与第 1 折的过程不同。基于 $\\mathcal{D}_{\\text{train}}^{(1)}$ 选择的特征集不一定适用于在 $\\mathcal{D}_{\\text{train}}^{(2)}$ 上训练的模型等。这引入了未知的偏差，并使将 CV 结果解释为*完整程序*的预期风险的估计无效。声称估计是无偏的说法是错误的。\n- **结论**：**不正确**。\n\n**D. 带分层的外部 $K_{\\text{out}}$-折交叉验证。在每次外部迭代中，使用从完整数据集计算出的均值和标准差对所有特征进行标准化（以避免不稳定性），然后，仅在外部训练集上，使用双样本 $t$ 检验选择特征并拟合内部调整后的 LASSO 模型。由于标准化不使用标签，因此在完整数据集上计算它不会使交叉验证的估计产生偏差。**\n\n- **程序**：此程序在外部 CV 循环开始之前，对完整数据集执行其中一个预处理步骤，即标准化。\n- **论证**：标准化涉及计算每个特征的均值和标准差。虽然这不使用标签 $Y$，但它确实使用了来自测试集的特征值 $X$。关于测试数据分布的信息（其均值和方差）泄漏到了训练过程中。对于一个给定的折，训练数据是使用部分源自该折测试数据的参数进行转换的。这是一种比使用标签更微妙的数据泄漏形式，但它仍然是泄漏，并可能导致微小的乐观偏差。最严格的程序，如选项 A 所述，是仅从每个折的训练数据中计算标准化参数。其论证“不会使...产生偏差”的说法过于绝对，并且通常是不正确的。\n- **结论**：**不正确**。\n\n**E. 为了防止多重检验问题，首先对所有 $p$ 个特征在完整数据集上运行双样本 $t$ 检验，并应用 Benjamini–Hochberg 错误发现率 (FDR) 控制... 使用得到的集合作为固定的候选生物标志物。然后执行嵌套交叉验证... 严格论证：FDR 控制考虑了选择过程，因此在交叉验证前使用完整数据的 $t$ 检验不会使性能估计产生偏差...**\n\n- **程序**：这在结构上与选项 B 相同，只是增加了将 FDR 控制指定为设置 $t$ 检验阈值的方法。\n- **论证**：其论证完全错误。Benjamini-Hochberg FDR 控制是一种统计方法，用于在同时执行多个假设检验时管理预期中的错误发现比例。它对于纠正当此分析在基于交叉验证的性能估计之前在整个数据集上执行时发生的数据泄漏完全没有任何作用。CV 估计中的偏差源于使用测试标签进行特征选择，而 FDR 控制根本不解决这个问题。\n- **结论**：**不正确**。\n\n总而言之，只有选项 A 正确地描述了一个无泄漏的验证流程，并提供了一个稳健的、基于第一性原理的论证，解释了为什么其他常见但有缺陷的方法会产生偏差。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "一个经过严格验证的预测模型本身可能是一个“黑箱”，但这对于“发现”生物标志物而言是远远不够的。为了从模型中提取科学洞见，我们必须理解是哪些特征在驱动其预测。本练习将向您介绍 SHAP (SHapley Additive exPlanations) 值，这是一种基于博弈论、具有坚实理论基础的先进模型解释方法。通过推导其在特定条件下的简化形式并进行具体计算，您将掌握如何量化每个生物标志物对特定患者预测结果的贡献，从而真正实现从数据到发现的转化 。",
            "id": "5027210",
            "problem": "一个转化医学团队正在开发一个预测性生物标志物组合，以估计肿瘤试验中的临床响应概率。他们在一个标准化的生物标志物特征上，训练了一个通过最小绝对收缩和选择算子 (LASSO) 惩罚获得的稀疏逻辑回归模型。设特征向量为 $X \\in \\mathbb{R}^{p}$，其坐标 $X_{j}$ 代表经检测标准化的生物标志物测量值，并假设特征已被标准化，使得对于每个 $j$，$\\mathbb{E}[X_{j}]=0$ 且 $\\operatorname{Var}(X_{j})=1$。模型输出为 $f(x)=\\sigma(g(x))$，其中 $g(x)=w_{0}+\\sum_{j=1}^{p}w_{j}x_{j}$ 是对数几率，而 $\\sigma(t)=\\frac{1}{1+\\exp(-t)}$ 是 logistic 函数。考虑合作博弈论中的 Shapley 值框架，其价值函数对于任意子集 $S \\subseteq \\{1,\\dots,p\\}$ 定义为 $v(S)=\\mathbb{E}[f(X)\\mid X_{S}=x_{S}]$，其中 $X_{S}$ 表示由 $S$ 索引的子向量，缺失特征通过模型无关的条件期望进行边际化处理。\n\n首先，从 Shapley 值的公理化定义和 $g(x)$ 的线性性质出发，推导在何种关于 $X$ 的联合分布以及缺失特征的插补方案的一般条件下，计算在 $g(x)$ 上的 Shapley 值等于每个特征 $j$ 的边际贡献 $w_{j}\\left(x_{j}-\\mathbb{E}[X_{j}]\\right)$。你的推导必须从基本的 Shapley 值定义开始，且不得使用任何快捷公式；明确陈述使等式成立的最小假设。\n\n其次，考虑一个训练好的稀疏模型，其具有 $p=3$ 个非零的生物标志物系数。假设特征是独立的、标准化的，并且在 $g(x)$ 中对缺失特征的插补方案使用它们的无条件期望。学习到的参数为 $w_{0}=-1.2$，$w_{1}=0.8$，$w_{2}=-0.5$，$w_{3}=0.3$。对于一个标准化生物标志物测量值为 $x=(1.5,-0.7,2.0)$ 的新患者，使用合作博弈论的定义和你推导出的假设，计算这三个生物标志物在对数几率尺度上的精确 Shapley 特征归因。将最终答案表示为一个行向量，其中包含三个以对数几率单位表示的特征级 Shapley 值。不需要四舍五入，且不适用任何物理单位。",
            "solution": "我们从合作博弈论中 Shapley 值的定义开始。设 $N=\\{1,\\dots,p\\}$ 为特征的索引集。对于定义在子集 $S\\subseteq N$ 上的价值函数 $v:\\mathcal{P}(N)\\to\\mathbb{R}$，特征 $j\\in N$ 的 Shapley 值为\n$$\n\\phi_{j}=\\sum_{S\\subseteq N\\setminus\\{j\\}}\\frac{|S|!\\,(p-|S|-1)!}{p!}\\left[v(S\\cup\\{j\\})-v(S)\\right].\n$$\nShapley 值由有效性、对称性、哑元性和线性四条公理来刻画。在模型解释中，我们设置 $v(S)=\\mathbb{E}[f(X)\\mid X_{S}=x_{S}]$，即对缺失特征取平均。\n\n我们寻求在何种条件下，在对数几率函数 $g(x)=w_{0}+\\sum_{j=1}^{p}w_{j}x_{j}$ 上计算的 Shapley 值可以简化为边际贡献 $w_{j}\\left(x_{j}-\\mathbb{E}[X_{j}]\\right)$。将 $g$ 视为支付函数，并定义 $v_{g}(S)=\\mathbb{E}[g(X)\\mid X_{S}=x_{S}]$。由于 $g$ 对于 $X$ 是线性的，我们有\n$$\nv_{g}(S)=\\mathbb{E}\\left[w_{0}+\\sum_{k=1}^{p}w_{k}X_{k}\\,\\middle|\\,X_{S}=x_{S}\\right]=w_{0}+\\sum_{k\\in S}w_{k}x_{k}+\\sum_{k\\notin S}w_{k}\\,\\mathbb{E}[X_{k}\\mid X_{S}=x_{S}].\n$$\n因此，\n$$\nv_{g}(S\\cup\\{j\\})-v_{g}(S)=w_{j}x_{j}-w_{j}\\,\\mathbb{E}[X_{j}\\mid X_{S}=x_{S}]=w_{j}\\left(x_{j}-\\mathbb{E}[X_{j}\\mid X_{S}=x_{S}]\\right).\n$$\n为了使这个差值独立于 $S$ 并且等于 $w_{j}\\left(x_{j}-\\mathbb{E}[X_{j}]\\right)$，我们需要以下最小条件：\n- 对于所考虑的支付，模型是关于特征的加性和线性的，即支付函数为 $g(x)=w_{0}+\\sum_{j}w_{j}x_{j}$，因此每个特征的贡献是可分离的。\n- 价值函数中对缺失特征的插补方案使用 $\\mathbb{E}[X_{k}\\mid X_{S}=x_{S}]$，并且对于任何缺失特征 $k\\notin S$，这个条件期望等于其无条件期望 $\\mathbb{E}[X_{k}]$。一个充分条件是特征是联合独立的，因此对于所有 $k\\notin S$ 和所有 $S$，都有 $\\mathbb{E}[X_{k}\\mid X_{S}=x_{S}]=\\mathbb{E}[X_{k}]$。\n- 期望 $\\mathbb{E}[X_{j}]$ 存在且为有限值。\n\n在这些条件下，我们得到\n$$\nv_{g}(S\\cup\\{j\\})-v_{g}(S)=w_{j}\\left(x_{j}-\\mathbb{E}[X_{j}]\\right)\n$$\n对于所有的 $S\\subseteq N\\setminus\\{j\\}$。代入 Shapley 公式，\n$$\n\\phi_{j}=\\left[w_{j}\\left(x_{j}-\\mathbb{E}[X_{j}]\\right)\\right]\\sum_{S\\subseteq N\\setminus\\{j\\}}\\frac{|S|!\\,(p-|S|-1)!}{p!}.\n$$\n该组合和等于 $1$，因为 Shapley 权重构成了在所有子集 $S\\subseteq N\\setminus\\{j\\}$ 上的一个概率分布。因此，\n$$\n\\phi_{j}=w_{j}\\left(x_{j}-\\mathbb{E}[X_{j}]\\right).\n$$\n如果特征被标准化以至于对每个 $j$ 都有 $\\mathbb{E}[X_{j}]=0$，那么 $\\phi_{j}=w_{j}x_{j}$。\n\n现在我们为给定的稀疏逻辑回归计算在对数几率尺度上的 Shapley 特征归因。指定的模型参数为 $w_{0}=-1.2$，$w_{1}=0.8$，$w_{2}=-0.5$，$w_{3}=0.3$，患者的标准化生物标志物为 $x=(1.5,-0.7,2.0)$。特征是独立的、标准化的，并且 $g$ 的价值函数通过无条件期望来插补缺失特征，因此上面推导的条件得到满足。因此，\n$$\n\\phi_{1}=w_{1}x_{1}=0.8\\times 1.5=1.2,\n$$\n$$\n\\phi_{2}=w_{2}x_{2}=-0.5\\times(-0.7)=0.35,\n$$\n$$\n\\phi_{3}=w_{3}x_{3}=0.3\\times 2.0=0.6.\n$$\n这些就是三个生物标志物在对数几率尺度上的精确 Shapley 特征归因。注意，在对数几率尺度上的基线归因是 $\\phi_{0}=w_{0}=-1.2$，并且有效性公理成立，因为 $\\phi_{0}+\\phi_{1}+\\phi_{2}+\\phi_{3}=w_{0}+\\sum_{j}w_{j}x_{j}=g(x)$，但要求的最终答案是特征级向量 $\\left(\\phi_{1},\\phi_{2},\\phi_{3}\\right)$。",
            "answer": "$$\\boxed{\\begin{pmatrix}1.2  0.35  0.6\\end{pmatrix}}$$"
        }
    ]
}