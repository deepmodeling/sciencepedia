{
    "hands_on_practices": [
        {
            "introduction": "单细胞RNA测序的核心产出是一个庞大的“计数矩阵”，但这些计数的本质是什么？本练习将引导你从第一性原理出发，估算在典型的测序实验中每个细胞能检测到的分子数量，并剖析观测到的细胞间表达变异的两个主要来源：技术噪音和真实的生物学差异。理解这两种变异的构成是后续所有分析的基石。",
            "id": "4991002",
            "problem": "一个转化医学团队计划使用三末端 ($3'$) 计数法进行单细胞RNA测序 (scRNA-seq)，以量化治疗前后患者来源的肿瘤细胞的转录状态。在此工作流程中，细胞中存在的每个信使核糖核酸 (mRNA) 分子被独立捕获、反转录，并被分配一个唯一分子标识符 (UMI)，之后进行聚合酶链式反应 (PCR) 扩增和测序。将捕获效率定义为细胞中存在的mRNA被成功转化为可被UMI观测到的互补脱氧核糖核酸 (cDNA) 分子的每个分子的概率。假设：\n- 每个细胞平均包含 $10{,}000$ 个mRNA分子。\n- 捕获效率为 $10\\%$。\n- 测序深度是饱和的，因此每个被捕获的分子都至少被观测到一次。\n- UMI空间足够大，以至于在全细胞水平上UMI碰撞可以忽略不计。\n\n仅使用独立试验的概率抽样第一性原理以及“$3'$ 计数法对每个成功捕获的原始mRNA分子最多产生一个UMI”的定义，估计每个细胞检测到的UMI的期望数量。然后，从第一性原理出发，在适当的地方使用符号表达式，简要解释在名义上相同的细胞中，检测到的UMI计数存在方差的至少两个不同来源，并确定它们的机理来源以及它们如何通过全方差定律做出贡献。\n\n请以单一数字形式提供您的期望值，不带单位，不要四舍五入。",
            "solution": "该问题具有科学依据，提法明确，且计算期望值所需的所有参数均已提供。这些假设是单细胞测序实验建模中使用的标准简化。因此，该问题是有效的。\n\n第一个任务是估计每个细胞检测到的唯一分子标识符（UMI）的期望数量。\n设 $N$ 是代表单个细胞中信使核糖核酸（mRNA）分子总数的随机变量。问题指出，每个细胞的平均mRNA分子数为 $10{,}000$。这对应于 $N$ 的期望值。\n$$E[N] = 10000$$\n设 $p$ 为捕获效率，定义为mRNA被成功捕获并转化为可观测的互补脱氧核糖核酸（cDNA）分子的每个分子的概率。问题指出此效率为 $10\\%$。\n$$p = 0.10$$\n问题指出，该过程涉及对每个mRNA分子进行独立的捕获试验。对于一个恰好包含 $n$ 个mRNA分子的细胞，捕获过程可以被建模为一系列 $n$ 次独立的伯努利试验，其中每次试验的成功（捕获）概率为 $p$。\n设 $U$ 是代表一个细胞中检测到的UMI数量的随机变量。问题的假设——测序深度是饱和的，UMI碰撞可以忽略不计，以及 $3'$ 测序法对每个捕获的mRNA最多产生一个UMI——意味着检测到的UMI数量完全等于成功捕获的mRNA分子数量。\n对于一个具有固定分子数 $N=n$ 的细胞，检测到的UMI数量 $U$ 服从二项分布：\n$$U | (N=n) \\sim \\text{Binomial}(n, p)$$\n对于一个恰好有 $n$ 个分子的细胞，其UMI数量的期望值是该二项分布的期望：\n$$E[U | N=n] = np$$\n然而，mRNA分子的数量 $N$ 本身是一个随机变量，在细胞间变化，其均值 $E[N]$ 已知。为了求出每个细胞UMI的总体期望数量，我们必须使用全期望定律（也称为塔特性），该定律指出 $E[U] = E[E[U|N]]$。\n首先，我们求条件期望 $E[U|N]$，它是随机变量 $N$ 的一个函数：\n$$E[U|N] = Np$$\n接下来，我们对这个表达式关于 $N$ 的分布求期望：\n$$E[U] = E[Np]$$\n由于 $p$ 是一个常数，它可以从期望中提取出来：\n$$E[U] = p E[N]$$\n代入给定值：\n$$E[U] = 0.10 \\times 10000 = 1000$$\n每个细胞检测到的UMI的期望数量是 $1000$。\n\n第二个任务是解释在名义上相同的细胞中，检测到的UMI计数存在方差的至少两个不同来源，并将它们与全方差定律联系起来。\n全方差定律指出，对于两个随机变量 $U$ 和 $N$，$U$ 的方差可以分解为：\n$$\\text{Var}(U) = E[\\text{Var}(U|N)] + \\text{Var}(E[U|N])$$\n这个方程为识别UMI计数中两个主要方差来源提供了一个框架。\n\n来源1：来自抽样过程的技术方差。\n该方差来源由全方差定律中的第一项 $E[\\text{Var}(U|N)]$ 表示。\n- **机理来源：** 这种方差源于分子捕获过程的随机性。对于一个具有固定数量mRNA分子（$N=n$）的细胞，每个分子的捕获都是一个随机事件。并非每个分子都会被捕获，而被捕获的分子的具体子集在不同次相同实验中会随机变化。这是一个概率抽样过程固有的技术限制。\n- **数学贡献：** 对于固定的 $N=n$，$U$ 的条件分布是 $\\text{Binomial}(n,p)$。该分布的方差为 $\\text{Var}(U|N=n) = np(1-p)$。因此，作为随机变量 $N$ 的函数的条件方差是 $\\text{Var}(U|N) = Np(1-p)$。对总方差的贡献是该项的期望：$E[\\text{Var}(U|N)] = E[Np(1-p)] = E[N]p(1-p)$。该分量通常被称为“抽样噪声”或“散粒噪声”，并与数据的基于计数的特性直接相关。\n\n来源2：细胞mRNA含量的生物学方差。\n该方差来源由全方差定律中的第二项 $\\text{Var}(E[U|N])$ 表示。\n- **机理来源：** 这种方差源于细胞群体中真实的生物异质性。即使是“名义上相同”的细胞也并非真正相同。它们在大小、代谢活动、细胞周期阶段和随机基因表达方面都有差异，所有这些都会导致细胞间总mRNA分子数 $N$ 的差异。输入材料中这种预先存在的生物学变异是scRNA-seq实验通常旨在表征的关键信号。\n- **数学贡献：** 我们之前确定了条件期望为 $E[U|N] = Np$。这一项代表了来自细胞的“真实”信号（其mRNA含量 $N$），并按技术效率（$p$）进行了缩放。该项的方差 $\\text{Var}(E[U|N]) = \\text{Var}(Np)$，捕捉了 $N$ 中的生物学方差如何传播到观测到的UMI计数中。由于 $p$ 是一个常数，这变为 $\\text{Var}(E[U|N]) = p^2 \\text{Var}(N)$。这一项表明，生物学方差 $\\text{Var}(N)$ 对观测方差有贡献，但其效应被捕获效率的平方所衰减。\n\n总而言之，观测到的UMI计数的总方差 $\\text{Var}(U)$ 是一个技术组分 $E[N]p(1-p)$（来自测量过程的噪声）和一个生物学组分 $p^2 \\text{Var}(N)$（反映细胞群体中真实的异质性）之和。",
            "answer": "$$\\boxed{1000}$$"
        },
        {
            "introduction": "在基于液滴的单细胞测序中，一个常见的技术难题是“双细胞”（doublets）的形成，即单个液滴意外捕获了两个或更多细胞，导致数据混杂。本练习将运用泊松分布这一强大的统计工具，来模拟细胞在液滴中的随机捕获过程。通过这个模型，你将能亲手计算出在给定实验参数下产生双细胞的预期概率，这是评估数据质量的关键一步。",
            "id": "4990977",
            "problem": "一项转化肿瘤学研究正在部署基于液滴的单细胞RNA测序（scRNA-seq；单细胞核糖核酸测序），以分析来自患者活检样本的肿瘤浸润免疫细胞。为了限制细胞类型推断中的人为误差，该团队需要估计在标准微流控加载条件下的预期双细胞率，该条件假设每个液滴的细胞捕获事件是独立的，并且占有率较低，使得每个液滴中的细胞数量遵循平均值为每个液滴 $\\lambda$ 个细胞的泊松分布。\n\n从占有率的泊松概率质量函数的定义出发，并利用“双细胞”是任何捕获了至少两个细胞的液滴这一解释，推导出泊松均值为 $\\lambda$ 时的预期双细胞概率。然后，对于调整为 $\\lambda = 0.08$ 的一次运行，计算该概率的数值。\n\n将最终数值答案四舍五入至四位有效数字。以小数形式表示答案，不带百分号，也不带任何单位。",
            "solution": "问题陈述被评估为有效。它在科学上基于液滴微流控中细胞加载的标准泊松模型，这是单细胞测序分析的基石。该问题是适定的，提供了得出唯一、有意义解所需的所有必要定义（泊松分布、双细胞定义）、参数（$\\lambda$）和约束（四舍五入）。语言客观，且场景在转化医学领域内是现实的。\n\n设 $K$ 为单个液滴中捕获的细胞数的随机变量。根据问题陈述，$K$ 遵循均值为 $\\lambda$ 的泊松分布。$K$ 的概率质量函数 (PMF) 由下式给出：\n$$P(K=k) = \\frac{\\lambda^k \\exp(-\\lambda)}{k!}$$\n其中 $k$ 是一个非负整数 ($k=0, 1, 2, \\dots$)，表示一个液滴中的细胞数量。\n\n“双细胞”被定义为任何含有至少两个细胞的液滴。这对应于事件 $K \\geq 2$。我们需要推导这个事件的概率，记为 $P_{\\text{doublet}}$。\n$$P_{\\text{doublet}} = P(K \\geq 2)$$\n\n直接计算这个概率会涉及一个无穷级数求和：$P(K=2) + P(K=3) + P(K=4) + \\dots$。使用补集法则更为直接。所有可能结果的概率之和必须为 $1$：\n$$\\sum_{k=0}^{\\infty} P(K=k) = P(K=0) + P(K=1) + P(K=2) + \\dots = 1$$\n因此，含有至少两个细胞的概率是 $1$ 减去含有少于两个细胞的概率：\n$$P(K \\geq 2) = 1 - P(K  2)$$\n事件 $K  2$ 包括两个互斥的结果：含有零个细胞 ($K=0$) 或恰好含有一个细胞 ($K=1$)。\n$$P(K  2) = P(K=0) + P(K=1)$$\n我们可以使用泊松 PMF 计算这两个概率：\n液滴为空的概率 ($k=0$) 是：\n$$P(K=0) = \\frac{\\lambda^0 \\exp(-\\lambda)}{0!} = \\frac{1 \\cdot \\exp(-\\lambda)}{1} = \\exp(-\\lambda)$$\n液滴含有一个细胞（“单细胞”，$k=1$）的概率是：\n$$P(K=1) = \\frac{\\lambda^1 \\exp(-\\lambda)}{1!} = \\frac{\\lambda \\exp(-\\lambda)}{1} = \\lambda \\exp(-\\lambda)$$\n将这些代入 $P(K  2)$ 的表达式中：\n$$P(K  2) = \\exp(-\\lambda) + \\lambda \\exp(-\\lambda) = (1+\\lambda)\\exp(-\\lambda)$$\n最后，我们可以推导出预期的双细胞概率的一般表达式：\n$$P_{\\text{doublet}} = 1 - P(K  2) = 1 - (1+\\lambda)\\exp(-\\lambda)$$\n这完成了问题的第一部分。\n\n在第二部分中，我们被要求计算当一次运行调整到平均占有率为 $\\lambda = 0.08$ 时该概率的数值。我们将这个值代入推导出的公式中：\n$$P_{\\text{doublet}} = 1 - (1+0.08)\\exp(-0.08)$$\n$$P_{\\text{doublet}} = 1 - 1.08 \\exp(-0.08)$$\n现在，我们计算数值：\n$$\\exp(-0.08) \\approx 0.923116346$$\n$$P_{\\text{doublet}} \\approx 1 - 1.08 \\times 0.923116346$$\n$$P_{\\text{doublet}} \\approx 1 - 0.996965654$$\n$$P_{\\text{doublet}} \\approx 0.003034346$$\n问题要求将最终答案四舍五入至四位有效数字。$0.003034346$ 中的第一位有效数字是 $3$。前四位有效数字是 $3$、$0$、$3$ 和 $4$。第五位有效数字是 $3$。由于 $3  5$，我们向下舍入，这意味着我们保持第四位有效数字不变。\n四舍五入后的数值为 $0.003034$。",
            "answer": "$$\n\\boxed{0.003034}\n$$"
        },
        {
            "introduction": "单细胞数据的一个强大应用是重建细胞分化或响应等动态过程，这通常通过“伪时间”（pseudotime）分析来实现。本练习将揭开伪时间计算的神秘面纱，在一个简化的细胞分化轨迹图上，你将学习如何通过计算图论中的“测地距离”（geodesic distance）来确定细胞的谱系归属并量化其在发育路径上的相对位置。这个实践将帮助你直观地理解如何从静态的快照中推断出动态的过程。",
            "id": "4990957",
            "problem": "一项转化医学研究使用单细胞核糖核酸测序 (scRNA-seq) 技术，为受治疗扰动的髓系细胞重建分化轨迹。细胞被嵌入到一个源自扩散图的潜二维流形中，并在这个潜空间中构建了一个加权$k$近邻图。该图呈现出从一个共同祖细胞开始的单一分岔，形成两个分支。图中边的权重由潜空间中的欧几里得弧长定义，这与“在扩散几何中，转录相似性近似于沿着生物过程的进展距离”这一原理相符。\n\n给定一个最小分岔结构的以下潜坐标：\n- 根节点（共同祖细胞）$r_0 = (0, 0)$。\n- 主干节点 $t_1 = (0.9, 0)$。\n- 分支A节点 $a_2 = (1.8, 0.2)$ 和末端 $a_3 = (2.8, 0.6)$。\n- 分支B节点 $b_2 = (1.8, -0.2)$ 和末端 $b_3 = (2.6, -0.6)$。\n- 分岔点附近的一个模糊细胞 $c = (1.0, -0.05)$。\n\n图中的无向边为：\n- $(r_0, t_1)$，\n- $(t_1, a_2)$，$(a_2, a_3)$，\n- $(t_1, b_2)$，$(b_2, b_3)$，\n- $(t_1, c)$，$(c, b_2)$，$(c, a_2)$。\n\n边权重为 $w_{ij} = \\|x_i - x_j\\|_2$。两节点之间的测地距离定义为连接它们的所有路径中总边权重之和的最小值。根据单细胞分析中轨迹推断的既定实践：\n- 分支 $J \\in \\{A, B\\}$ 的长度是从 $r_0$ 到该分支末端（分支A为 $a_3$，分支B为 $b_3$）的测地距离。\n- 细胞的分支归属由其到各分支末端的最小测地距离决定。\n- 某个细胞 $i$ 在其被分配的分支 $J$ 上的伪时间，是其从 $r_0$ 到 $i$ 沿着位于分支 $J$ 上的子图（包括主干）的测地距离，再除以该分支的总长度进行归一化。\n\n根据以上定义以及所提供的坐标和边，确定模糊细胞 $c$ 在其被分配的分支上的伪时间。将最终答案表示为一个无量纲数，并四舍五入至四位有效数字。",
            "solution": "本问题要求基于一个模糊细胞（记为 $c$）在细胞分化潜空间表示中的位置，计算其伪时间。计算过程遵循一系列定义的步骤，这些步骤涉及一个根据单细胞数据构建的加权图。\n\n首先，我们通过列出给定点的坐标来将问题形式化：\n- 根节点：$r_0 = (0, 0)$\n- 主干：$t_1 = (0.9, 0)$\n- 分支A：$a_2 = (1.8, 0.2)$，$a_3 = (2.8, 0.6)$\n- 分支B：$b_2 = (1.8, -0.2)$，$b_3 = (2.6, -0.6)$\n- 模糊细胞：$c = (1.0, -0.05)$\n\n图中的无向边为 $(r_0, t_1)$, $(t_1, a_2)$, $(a_2, a_3)$, $(t_1, b_2)$, $(b_2, b_3)$, $(t_1, c)$, $(c, a_2)$ 和 $(c, b_2)$。坐标分别为 $x_i$ 和 $x_j$ 的两个节点 $i$ 和 $j$ 之间的边权重是欧几里得距离 $w_{ij} = \\|x_i - x_j\\|_2$。\n\n我们计算所有相关边的权重：\n- $w_{r_0, t_1} = \\sqrt{(0.9 - 0)^{2} + (0 - 0)^{2}} = 0.9$\n- $w_{t_1, a_2} = \\sqrt{(1.8 - 0.9)^{2} + (0.2 - 0)^{2}} = \\sqrt{0.9^{2} + 0.2^{2}} = \\sqrt{0.81 + 0.04} = \\sqrt{0.85}$\n- $w_{a_2, a_3} = \\sqrt{(2.8 - 1.8)^{2} + (0.6 - 0.2)^{2}} = \\sqrt{1.0^{2} + 0.4^{2}} = \\sqrt{1 + 0.16} = \\sqrt{1.16}$\n- $w_{t_1, b_2} = \\sqrt{(1.8 - 0.9)^{2} + (-0.2 - 0)^{2}} = \\sqrt{0.9^{2} + (-0.2)^{2}} = \\sqrt{0.81 + 0.04} = \\sqrt{0.85}$\n- $w_{b_2, b_3} = \\sqrt{(2.6 - 1.8)^{2} + (-0.6 - (-0.2))^{2}} = \\sqrt{0.8^{2} + (-0.4)^{2}} = \\sqrt{0.64 + 0.16} = \\sqrt{0.80}$\n- $w_{t_1, c} = \\sqrt{(1.0 - 0.9)^{2} + (-0.05 - 0)^{2}} = \\sqrt{0.1^{2} + (-0.05)^{2}} = \\sqrt{0.01 + 0.0025} = \\sqrt{0.0125}$\n- $w_{c, a_2} = \\sqrt{(1.8 - 1.0)^{2} + (0.2 - (-0.05))^{2}} = \\sqrt{0.8^{2} + 0.25^{2}} = \\sqrt{0.64 + 0.0625} = \\sqrt{0.7025}$\n- $w_{c, b_2} = \\sqrt{(1.8 - 1.0)^{2} + (-0.2 - (-0.05))^{2}} = \\sqrt{0.8^{2} + (-0.15)^{2}} = \\sqrt{0.64 + 0.0225} = \\sqrt{0.6625}$\n\n伪时间的计算需要三个主要步骤：\n1.  将细胞 $c$ 分配到一个分支。\n2.  计算所分配分支的长度。\n3.  计算从根节点 $r_0$ 到 $c$ 的测地距离，并用分支长度对其进行归一化。\n\n**步骤1：细胞 $c$ 的分支分配**\n细胞的分支归属由到分支末端的最小测地距离决定。测地距离是图中的最短路径长度。我们必须计算测地距离 $d(c, a_3)$ 和 $d(c, b_3)$。\n\n- 为了计算 $d(c, a_3)$，路径必须经过 $a_2$。我们需要求出从 $c$ 到 $a_2$ 的最短路径，即 $d(c, a_2) = \\min(w_{c, a_2}, w_{c, t_1} + w_{t_1, a_2}) = \\min(\\sqrt{0.7025}, \\sqrt{0.0125} + \\sqrt{0.85})$。因为 $\\sqrt{0.7025} \\approx 0.838$ 且 $\\sqrt{0.0125} + \\sqrt{0.85} \\approx 0.112 + 0.922 = 1.034$，所以直连边更短。因此，$d(c, a_2) = w_{c, a_2} = \\sqrt{0.7025}$。到末端的测地距离为 $d(c, a_3) = d(c, a_2) + w_{a_2, a_3} = \\sqrt{0.7025} + \\sqrt{1.16}$。\n\n- 类似地，对于 $d(c, b_3)$，路径必须经过 $b_2$。从 $c$ 到 $b_2$ 的最短路径是 $d(c, b_2) = \\min(w_{c, b_2}, w_{c, t_1} + w_{t_1, b_2}) = \\min(\\sqrt{0.6625}, \\sqrt{0.0125} + \\sqrt{0.85})$。因为 $\\sqrt{0.6625} \\approx 0.814$，所以直连边更短。因此，$d(c, b_2) = w_{c, b_2} = \\sqrt{0.6625}$。到末端的测地距离为 $d(c, b_3) = d(c, b_2) + w_{b_2, b_3} = \\sqrt{0.6625} + \\sqrt{0.80}$。\n\n现在我们比较这两个距离：\n$d(c, a_3) \\approx \\sqrt{0.7025} + \\sqrt{1.16} \\approx 0.83815 + 1.07703 \\approx 1.91518$\n$d(c, b_3) \\approx \\sqrt{0.6625} + \\sqrt{0.80} \\approx 0.81394 + 0.89443 \\approx 1.70837$\n由于 $d(c, b_3)  d(c, a_3)$，细胞 $c$ 被分配到分支B。\n\n**步骤2：计算分支B的长度**\n分支B的长度 $L_B$ 是从根节点 $r_0$ 到末端 $b_3$ 的测地距离，即 $d(r_0, b_3)$。通过观察，最短路径为 $r_0 \\to t_1 \\to b_2 \\to b_3$。该路径的长度是其各段权重之和，前提是每一段本身都是最短路径。\n- $d(r_0, t_1) = w_{r_0, t_1} = 0.9$。\n- $d(t_1, b_2) = \\min(w_{t_1, b_2}, w_{t_1, c} + w_{c, b_2}) = \\min(\\sqrt{0.85}, \\sqrt{0.0125} + \\sqrt{0.6625})$。由于 $\\sqrt{0.85} \\approx 0.9220$ 且 $\\sqrt{0.0125} + \\sqrt{0.6625} \\approx 0.1118 + 0.8139 = 0.9257$，直连边更短。所以 $d(t_1, b_2) = \\sqrt{0.85}$。\n- $d(b_2, b_3) = w_{b_2, b_3} = \\sqrt{0.80}$，因为这是从 $b_2$ 到 $b_3$ 的唯一一条边。\n分支总长度为 $L_B = d(r_0, b_3) = d(r_0, t_1) + d(t_1, b_2) + d(b_2, b_3) = 0.9 + \\sqrt{0.85} + \\sqrt{0.80}$。\n\n**步骤3：计算细胞 $c$ 的伪时间**\n伪时间 $\\tau_c$ 是从根节点到该细胞的测地距离 $d(r_0, c)$，再用其所属分支的长度 $L_B$ 进行归一化。\n首先，我们计算 $d(r_0, c)$。最短路径是 $r_0 \\to t_1 \\to c$。其长度为 $d(r_0, t_1) + d(t_1, c)$。\n- $d(r_0, t_1) = 0.9$。\n- $d(t_1, c) = \\min(w_{t_1, c}, w_{t_1, a_2} + w_{a_2, c}, w_{t_1, b_2} + w_{b_2, c})$。直连距离是 $w_{t_1, c} = \\sqrt{0.0125} \\approx 0.1118$。其他路径明显更长，所以 $d(t_1, c) = \\sqrt{0.0125}$。\n未归一化的伪时间是 $d(r_0, c) = 0.9 + \\sqrt{0.0125}$。\n问题定义指出，计算伪时间的路径必须位于所分配分支的子图上。路径 $r_0 \\to t_1 \\to c$ 使用了根节点、主干节点 $t_1$ 和细胞 $c$。由于 $c$ 被分配到分支B，并且主干也被包括在内，因此该路径是有效的。\n\n归一化的伪时间是：\n$$ \\tau_c = \\frac{d(r_0, c)}{L_B} = \\frac{0.9 + \\sqrt{0.0125}}{0.9 + \\sqrt{0.85} + \\sqrt{0.80}} $$\n数值计算如下：\n$$ \\tau_c \\approx \\frac{0.9 + 0.1118034}{0.9 + 0.9219544 + 0.8944272} = \\frac{1.0118034}{2.7163816} \\approx 0.372481 $$\n四舍五入到四位有效数字，细胞 $c$ 的伪时间为 $0.3725$。",
            "answer": "$$\\boxed{0.3725}$$"
        }
    ]
}