{
    "hands_on_practices": [
        {
            "introduction": "This first exercise lays the groundwork for all quantitative recruitment planning. By starting from the fundamental principles of probability, you will derive the essential equation that links target enrollment size to the required screening volume and expected time. This practice reinforces how core parameters like disease prevalence ($p$), eligibility rate ($e$), and screening rate ($s$) combine to determine the feasibility and timeline of a clinical study .",
            "id": "5039005",
            "problem": "A multi-center translational clinical study aims to recruit a target of $n$ analyzable participants with a specific biomarker-defined condition from a general outpatient population. In this population, the prevalence of the target condition is $p$ (interpreted as the probability that a randomly screened individual has the condition). Among individuals who have the condition, the eligibility and consent fraction is $e$ (interpreted as the probability that a condition-positive individual meets all inclusion and exclusion criteria and consents to participate). Assume that individuals are screened independently and identically distributed across time and sites, the population composition is stationary, and each screened individual is drawn at random from the population.\n\nScreening is conducted at a constant rate of $s$ screens per day across all sites. Let each screen be classified as an enrollment “success” if it yields an eligible, consenting individual with the target condition, and a “failure” otherwise. Assume independence of screening outcomes across individuals.\n\nStarting only from fundamental definitions of probability and expectation for sums of independent Bernoulli indicator variables, and from the definition of constant-rate processes (that the expected number of screenings accrued in $t$ days is $s t$), derive the minimal expected number of screenings needed to achieve an expected $n$ enrollees and, from that, derive the expected elapsed time to reach this target under the constant screening rate. Provide your final result as a single closed-form expression for the expected time as a function of $n$, $p$, $e$, and $s$. Express the final time in days. No numerical substitution is required, and no rounding is requested. Assume $0 < p \\leq 1$, $0 < e \\leq 1$, $s > 0$, and $n \\in \\mathbb{N}$.",
            "solution": "The problem is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\n- Target number of analyzable participants: $n$, where $n \\in \\mathbb{N}$.\n- Prevalence of the target condition in the general outpatient population: $p$, where $0 < p \\leq 1$.\n- Eligibility and consent fraction among condition-positive individuals: $e$, where $0 < e \\leq 1$.\n- Constant screening rate: $s$ screens per day, where $s > 0$.\n- Definition of \"success\": A screen yields an eligible, consenting individual with the target condition.\n- Assumptions:\n    - Individuals are screened independently and identically distributed.\n    - Population composition is stationary.\n    - Each screened individual is drawn at random from the population.\n    - Screening outcomes are independent across individuals.\n- The expected number of screenings accrued in $t$ days is $st$.\n- The derivation must start from fundamental definitions of probability and expectation for sums of independent Bernoulli indicator variables.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is reviewed against the validation criteria.\n- **Scientifically Grounded**: The problem is a standard application of probability theory to model clinical trial recruitment. The concepts of prevalence, eligibility, and screening rates are fundamental in translational medicine and clinical operations. The model, while simplified, is scientifically valid for planning and estimation purposes.\n- **Well-Posed**: The problem is clearly stated, providing all necessary variables ($n$, $p$, $e$, $s$) and constraints. The objective is to derive a specific quantity (expected time) as a function of these givens. The phrasiology \"achieve an expected $n$ enrollees\" specifies the target condition clearly, ensuring a unique solution exists.\n- **Objective**: The problem is formulated with precise, unbiased language. All terms are standard in mathematics and clinical research.\n\nThe problem exhibits no flaws such as scientific unsoundness, incompleteness, contradiction, or ambiguity. It is a formalizable and relevant problem in applied statistics.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A solution will be derived as per the specified methodology.\n\n### Derivation\nThe objective is to find the expected time, $T_{exp}$, required to achieve an expected enrollment of $n$ participants. The derivation proceeds in two stages: first, determining the number of screenings required to yield an expected $n$ enrollees, and second, calculating the time needed to perform these screenings.\n\nLet a single screening be represented by a random trial. A \"success\" corresponds to enrolling a participant. The probability of success for a single trial, denoted $\\pi_{succ}$, must be determined. For a randomly screened individual to be a success, two sequential conditions must be met:\n$1$. The individual must have the target condition. The probability of this event is the prevalence, $p$.\n$2$. Given that the individual has the condition, they must also meet all eligibility criteria and provide consent. The probability of this conditional event is given as $e$.\n\nUsing the definition of conditional probability, the probability of the joint event (having the condition AND being eligible/consenting) is:\n$$ \\pi_{succ} = P(\\text{eligible and consent} \\mid \\text{has condition}) \\times P(\\text{has condition}) $$\n$$ \\pi_{succ} = e \\cdot p $$\n\nLet us define a Bernoulli indicator variable, $X_i$, for the outcome of the $i$-th screening.\n$$\nX_i =\n\\begin{cases}\n1 & \\text{if screen } i \\text{ is a success} \\\\\n0 & \\text{if screen } i \\text{ is a failure}\n\\end{cases}\n$$\nThe probability of success is $P(X_i = 1) = \\pi_{succ} = pe$. The trials are independent and identically distributed. The expected value of a single Bernoulli trial is its probability of success:\n$$ E[X_i] = 1 \\cdot P(X_i=1) + 0 \\cdot P(X_i=0) = P(X_i=1) = pe $$\n\nNow, consider a fixed number of screenings, $N_{scr}$. The total number of enrollees, $Y$, from these $N_{scr}$ screenings is the sum of the outcomes of the individual trials:\n$$ Y = \\sum_{i=1}^{N_{scr}} X_i $$\n\nThe problem asks for the conditions required to achieve an *expected* number of $n$ enrollees. We seek the number of screenings, let's call it $N_{req}$, such that the expected value of the total enrollees $Y$ is equal to $n$.\n$$ E[Y] = n $$\n\nUsing the linearity of expectation for the sum of random variables:\n$$ E[Y] = E\\left[\\sum_{i=1}^{N_{req}} X_i\\right] = \\sum_{i=1}^{N_{req}} E[X_i] $$\nSince $E[X_i] = pe$ for all $i$, the sum becomes:\n$$ E[Y] = \\sum_{i=1}^{N_{req}} (pe) = N_{req} \\cdot (pe) $$\n\nWe set this expected number of enrollees equal to the target $n$:\n$$ N_{req} \\cdot (pe) = n $$\n\nSolving for $N_{req}$, we obtain the minimal number of screenings needed to expect $n$ enrollees:\n$$ N_{req} = \\frac{n}{pe} $$\n\nThe second part of the problem is to find the expected elapsed time to conduct these $N_{req}$ screenings. The problem states that screening is conducted at a constant rate of $s$ screens per day. Let $T_{exp}$ be the required time in days. The total number of screenings is the rate multiplied by the time elapsed:\n$$ N_{req} = s \\cdot T_{exp} $$\n\nWe can now solve for $T_{exp}$:\n$$ T_{exp} = \\frac{N_{req}}{s} $$\n\nSubstituting the expression for $N_{req}$:\n$$ T_{exp} = \\frac{\\left(\\frac{n}{pe}\\right)}{s} $$\n\nSimplifying this expression gives the final closed-form result for the expected time:\n$$ T_{exp} = \\frac{n}{pes} $$\nThe units are implicitly in days, as $n$ and enrollees are dimensionless, $p$ and $e$ are probabilities (dimensionless), and $s$ is in screens per day. The result $T_{exp}$ is therefore in days. The constraints $p > 0$, $e > 0$, $s > 0$, and $n \\geq 1$ ensure that $T_{exp}$ is a well-defined, positive quantity.",
            "answer": "$$\\boxed{\\frac{n}{pes}}$$"
        },
        {
            "introduction": "Effective patient retention is as critical as successful recruitment. This practice moves beyond simple dropout rates to a more sophisticated competing risks framework, allowing you to model *why* patients leave a study. By calculating the cumulative incidence for a specific cause of dropout from its underlying cause-specific hazard rate, you will gain hands-on experience with a powerful survival analysis tool used to design and evaluate targeted retention strategies .",
            "id": "5039021",
            "problem": "A translational medicine clinical trial evaluates a new community-based digital intervention for patients with chronic obstructive pulmonary disease. To inform targeted retention strategies, the trial team models early study dropout as a competing risks process with three causes: (1) access barriers (transportation or scheduling), (2) clinical withdrawal due to disease progression, and (3) adverse events. The team implements a retention program at month $3$ (telehealth visits plus transportation vouchers) that is expected to reduce dropout due to access barriers without affecting other causes.\n\nUse the following foundational definitions from time-to-event analysis with competing risks:\n- The cause-specific hazard $h_{k}(t)$ is the instantaneous risk of event of cause $k$ at time $t$ for individuals event-free just prior to $t$.\n- The overall hazard is the sum of cause-specific hazards, $\\sum_{k} h_{k}(t)$.\n- The survival function $S(t)$ is the probability of remaining event-free through time $t$ and satisfies $S(t) = \\exp\\!\\left(-\\int_{0}^{t} \\sum_{k} h_{k}(u)\\,\\mathrm{d}u\\right)$.\n\nAssume the following scientifically plausible, piecewise-constant cause-specific hazards in units of per month:\n- For $0 \\leq t < 3$ months: $h_{1}(t) = 0.03$, $h_{2}(t) = 0.01$, $h_{3}(t) = 0.015$.\n- For $3 \\leq t \\leq 6$ months: $h_{1}(t) = 0.015$ (reduced after the retention program), $h_{2}(t) = 0.012$, $h_{3}(t) = 0.015$.\n\nStarting from the above fundamental definitions only (do not assume any additional formulas), derive an expression for the cumulative incidence for access-barrier dropout up to $t = 6$ months, and then evaluate it numerically. Express the final result as a decimal (unitless probability) and round your answer to four significant figures.",
            "solution": "The user wants to solve the problem by following these steps:\n1.  **Validate the problem statement:** Check the problem's validity based on its scientific grounding, completeness, and objectivity.\n2.  **Derive and solve:** If the problem is valid, derive the solution from first principles as specified, perform the calculations, and present the final answer according to the formatting rules.\n\n### Problem Validation\n\n#### Step 1: Extract Givens\n-   **Topic**: Competing risks analysis in a translational medicine clinical trial.\n-   **Process**: Early study dropout with three competing causes: (1) access barriers, (2) clinical withdrawal, (3) adverse events.\n-   **Intervention**: A retention program is implemented at month $t=3$.\n-   **Definitions**:\n    -   Cause-specific hazard: $h_{k}(t)$ is the instantaneous risk of event of cause $k$ at time $t$.\n    -   Overall hazard: $\\sum_{k} h_{k}(t)$.\n    -   Survival function: $S(t) = \\exp\\!\\left(-\\int_{0}^{t} \\sum_{k} h_{k}(u)\\,\\mathrm{d}u\\right)$.\n-   **Data (piecewise-constant cause-specific hazards, units of per month)**:\n    -   For $0 \\leq t < 3$: $h_{1}(t) = 0.03$, $h_{2}(t) = 0.01$, $h_{3}(t) = 0.015$.\n    -   For $3 \\leq t \\leq 6$: $h_{1}(t) = 0.015$, $h_{2}(t) = 0.012$, $h_{3}(t) = 0.015$.\n-   **Task**: \"Starting from the above fundamental definitions only (do not assume any additional formulas), derive an expression for the cumulative incidence for access-barrier dropout up to $t = 6$ months, and then evaluate it numerically. Express the final result as a decimal (unitless probability) and round your answer to four significant figures.\"\n\n#### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is well-grounded in the established statistical field of survival and competing risks analysis. The concepts of cause-specific hazard, survival function, and cumulative incidence are standard in biostatistics and epidemiology. The modeling of hazards as piecewise-constant is a common and valid simplification.\n-   **Well-Posed**: The problem is well-posed. It requests the derivation and calculation of a specific quantity (cumulative incidence for cause 1 at $t=6$) and provides all necessary data (hazard functions) and foundational definitions. A unique, stable solution exists.\n-   **Objective**: The problem is stated in precise, objective, and quantitative terms. There are no subjective or ambiguous statements.\n-   **Other Flaws**: The problem does not violate any of the criteria for invalidity. It is self-contained, scientifically sound, formalizable, and presents a non-trivial calculation based on first principles.\n\n#### Step 3: Verdict and Action\nThe problem is valid. The solution process will now proceed.\n\n### Derivation and Solution\n\nThe objective is to compute the cumulative incidence for cause 1 (access-barrier dropout), denoted as $CI_1(t)$, evaluated at $t=6$ months.\n\nFrom first principles, the cumulative incidence function for an event of cause $k$ is the probability of that event occurring by time $t$. This is found by integrating the probability density of the event over the time interval. The probability density for an event of cause $k$ at time $u$ is the product of the instantaneous rate of that event, $h_k(u)$, and the probability of surviving event-free up to that time, $S(u)$. Therefore, the fundamental formula for the cumulative incidence of cause $k$ is:\n$$CI_k(t) = \\int_{0}^{t} h_k(u) S(u) \\, \\mathrm{d}u$$\nWe must first determine the overall survival function, $S(t)$, which depends on the overall hazard, $\\sum_k h_k(t)$. The overall hazard is a piecewise-constant function.\n\nFor $0 \\leq t < 3$:\nThe overall hazard is $h_{all}(t) = h_1(t) + h_2(t) + h_3(t) = 0.03 + 0.01 + 0.015 = 0.055$.\n\nFor $3 \\leq t \\leq 6$:\nThe overall hazard is $h_{all}(t) = h_1(t) + h_2(t) + h_3(t) = 0.015 + 0.012 + 0.015 = 0.042$.\n\nNext, we derive the survival function $S(t) = \\exp\\left(-\\int_0^t h_{all}(u) \\, \\mathrm{d}u\\right)$. This will also be a piecewise function.\n\nFor $0 \\leq t < 3$:\nThe cumulative hazard is $\\Lambda(t) = \\int_0^t 0.055 \\, \\mathrm{d}u = 0.055t$.\nThus, $S(t) = \\exp(-0.055t)$.\n\nFor $3 \\leq t \\leq 6$:\nThe cumulative hazard is $\\Lambda(t) = \\int_0^3 h_{all}(u) \\, \\mathrm{d}u + \\int_3^t h_{all}(u) \\, \\mathrm{d}u$.\n$\\Lambda(t) = \\int_0^3 0.055 \\, \\mathrm{d}u + \\int_3^t 0.042 \\, \\mathrm{d}u = (0.055 \\times 3) + 0.042(t-3) = 0.165 + 0.042t - 0.126 = 0.042t + 0.039$.\nThus, $S(t) = \\exp(-(0.042t + 0.039))$.\n\nNow, we can compute $CI_1(6)$ by splitting the integral at the point where the hazard functions change, $t=3$:\n$$CI_1(6) = \\int_{0}^{6} h_1(u) S(u) \\, \\mathrm{d}u = \\int_{0}^{3} h_1(u) S(u) \\, \\mathrm{d}u + \\int_{3}^{6} h_1(u) S(u) \\, \\mathrm{d}u$$\n\nLet's evaluate each integral separately.\n\nFor the first integral ($0 \\leq u < 3$):\n$h_1(u) = 0.03$ and $S(u) = \\exp(-0.055u)$.\n$$I_1 = \\int_{0}^{3} 0.03 \\exp(-0.055u) \\, \\mathrm{d}u$$\n$$I_1 = 0.03 \\left[ \\frac{\\exp(-0.055u)}{-0.055} \\right]_{0}^{3}$$\n$$I_1 = -\\frac{0.03}{0.055} \\left( \\exp(-0.055 \\times 3) - \\exp(0) \\right)$$\n$$I_1 = -\\frac{30}{55} \\left( \\exp(-0.165) - 1 \\right) = \\frac{6}{11} \\left( 1 - \\exp(-0.165) \\right)$$\n\nFor the second integral ($3 \\leq u \\leq 6$):\n$h_1(u) = 0.015$ and $S(u) = \\exp(-(0.042u + 0.039))$.\n$$I_2 = \\int_{3}^{6} 0.015 \\exp(-(0.042u + 0.039)) \\, \\mathrm{d}u$$\n$$I_2 = 0.015 \\exp(-0.039) \\int_{3}^{6} \\exp(-0.042u) \\, \\mathrm{d}u$$\n$$I_2 = 0.015 \\exp(-0.039) \\left[ \\frac{\\exp(-0.042u)}{-0.042} \\right]_{3}^{6}$$\n$$I_2 = -\\frac{0.015}{0.042} \\exp(-0.039) \\left( \\exp(-0.042 \\times 6) - \\exp(-0.042 \\times 3) \\right)$$\n$$I_2 = -\\frac{15}{42} \\exp(-0.039) \\left( \\exp(-0.252) - \\exp(-0.126) \\right)$$\n$$I_2 = \\frac{5}{14} \\left( \\exp(-0.039) \\exp(-0.126) - \\exp(-0.039) \\exp(-0.252) \\right)$$\n$$I_2 = \\frac{5}{14} \\left( \\exp(-0.165) - \\exp(-0.291) \\right)$$\n\nThe total cumulative incidence is the sum of the two parts:\n$$CI_1(6) = I_1 + I_2 = \\frac{6}{11} \\left( 1 - \\exp(-0.165) \\right) + \\frac{5}{14} \\left( \\exp(-0.165) - \\exp(-0.291) \\right)$$\n\nNow, we evaluate this expression numerically:\n$\\exp(-0.165) \\approx 0.8478953$\n$\\exp(-0.291) \\approx 0.7475140$\n\n$I_1 \\approx \\frac{6}{11} (1 - 0.8478953) = \\frac{6}{11} (0.1521047) \\approx 0.0829662$\n$I_2 \\approx \\frac{5}{14} (0.8478953 - 0.7475140) = \\frac{5}{14} (0.1003813) \\approx 0.0358505$\n\n$CI_1(6) \\approx 0.0829662 + 0.0358505 = 0.1188167$\n\nRounding the final result to four significant figures gives $0.1188$.",
            "answer": "$$\\boxed{0.1188}$$"
        },
        {
            "introduction": "Ultimately, managing a clinical trial involves making high-stakes decisions under uncertainty. This advanced practice introduces a formal decision-analytic approach, using the Expected Value of Sample Information (EVSI) to compare different recruitment strategies. You will build a model that weighs the potential knowledge gained from further recruitment against the associated costs and delays, providing a rational basis for choosing whether to extend a trial, add new sites, or stop and analyze the current data .",
            "id": "5039018",
            "problem": "You are tasked to design and implement a fully specified, decision-analytic program for patient recruitment strategy selection in translational medicine. The goal is to compare three recruitment actions using first principles from decision theory and Bayesian inference: extend the timeline, add sites, or stop recruitment now. Each action leads to a value-of-information trade-off and an expected net benefit that must be computed from foundational definitions.\n\nYou must assume a single scalar treatment effect parameter $\\theta$ representing the true incremental clinical benefit (on an appropriate continuous scale) of proceeding to clinical implementation. Assume a conjugate normal-normal model:\n- Prior on the effect: $\\theta \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)$.\n- Sampling model for a future aggregated outcome mean $\\bar{Y}$ from the next recruited cohort: $\\bar{Y} \\sim \\mathcal{N}(\\theta, \\sigma^2/n_{\\text{eff}})$, where $n_{\\text{eff}}$ is the effective sample size that accounts for pre-specified retention.\n\nAdoption after observing data is determined by maximizing expected net benefit under the posterior distribution. Use the following fundamental constructs:\n- Expected utility maximization: choose the action that maximizes expected net benefit.\n- Bayes’ theorem: update the distribution of $\\theta$ based on the normal-normal conjugacy.\n- Time discounting: model delay to implementation by a multiplicative discount factor $\\exp(-q d)$ with delay $d$ (in months) and monthly discount rate $q$ (in per-month units).\n- Linear net benefit model for adoption: if adopting with expectation based on the posterior, the net benefit of adoption is $N_{\\text{pop}} \\, v \\, \\theta - F_{\\text{impl}}$, where $N_{\\text{pop}}$ is the remaining addressable population size, $v$ is the value per unit of effect in monetary units per effect-unit, and $F_{\\text{impl}}$ is a fixed implementation cost. If not adopting, the net benefit is $0$.\n\nLet $A = N_{\\text{pop}} \\, v$ and define the threshold $t = F_{\\text{impl}}/A$. With no additional sampling, the current decision uses the prior; thus the current net benefit is $\\max\\{0, A (\\mu_0 - t)\\}$. With additional sampling for an option that yields effective sample size $n_{\\text{eff}}$ and delay $d$, compute the discounted expected net benefit of the subsequent adopt-or-not decision by integrating the maximum of the two linear choices (adopt or not) with respect to the preposterior distribution of the posterior mean. Use the law of total expectation, normal-normal conjugacy, and the decision rule that selects the action with greater expected net benefit given the posterior. The Expected Value of Sample Information (EVSI) for an option is the difference between the discounted expected net benefit with that option and the current net benefit (excluding data collection costs). The expected net benefit of an option is the discounted expected net benefit with sampling minus the data collection costs for that option. The stop option has no sampling, no delay, EVSI equal to $0$, and its expected net benefit equals the current net benefit.\n\nFor each option:\n- Extend timeline (E): $n_{\\text{eff}} = n \\, r$, delay $d$ months, per-patient data collection cost $c_{\\text{per}}$, fixed overhead cost $C_{\\text{fix}}$; total sampling cost is $c_{\\text{per}} n + C_{\\text{fix}}$.\n- Add sites (S): $n_{\\text{eff}} = n \\, r$, delay $d$ months, per-patient cost $c_{\\text{per}}$, number of new sites $s$, overhead per site $C_{\\text{site}}$; total sampling cost is $c_{\\text{per}} n + s C_{\\text{site}}$.\n- Stop (T): no additional data collection, $n_{\\text{eff}} = 0$, no delay, no cost.\n\nThe following test suite specifies all parameters for three independent test cases. All monetary quantities are in arbitrary monetary units, time is in months, and all probabilities must be expressed as decimals, not percentages.\n\nFor each test case, shared parameters are $(\\mu_0, \\sigma_0, \\sigma, N_{\\text{pop}}, v, F_{\\text{impl}}, q)$.\n\n- Test case 1 (general case):\n  - Shared: $\\mu_0 = 0.05$, $\\sigma_0 = 0.10$, $\\sigma = 1.00$, $N_{\\text{pop}} = 10000$, $v = 100$, $F_{\\text{impl}} = 80000$, $q = 0.01$.\n  - Extend timeline (E): $n = 200$, $r = 0.85$, $d = 6$, $c_{\\text{per}} = 500$, $C_{\\text{fix}} = 100000$.\n  - Add sites (S): $n = 150$, $r = 0.90$, $d = 4$, $c_{\\text{per}} = 600$, $s = 3$, $C_{\\text{site}} = 50000$.\n  - Stop (T): no additional parameters.\n\n- Test case 2 (boundary where stopping is competitive):\n  - Shared: $\\mu_0 = 0.06$, $\\sigma_0 = 0.08$, $\\sigma = 1.00$, $N_{\\text{pop}} = 50000$, $v = 200$, $F_{\\text{impl}} = 400000$, $q = 0.01$.\n  - Extend timeline (E): $n = 300$, $r = 0.90$, $d = 5$, $c_{\\text{per}} = 300$, $C_{\\text{fix}} = 50000$.\n  - Add sites (S): $n = 200$, $r = 0.95$, $d = 3$, $c_{\\text{per}} = 350$, $s = 5$, $C_{\\text{site}} = 40000$.\n  - Stop (T): no additional parameters.\n\n- Test case 3 (edge where shorter delay dominates):\n  - Shared: $\\mu_0 = 0.04$, $\\sigma_0 = 0.12$, $\\sigma = 1.00$, $N_{\\text{pop}} = 30000$, $v = 250$, $F_{\\text{impl}} = 250000$, $q = 0.01$.\n  - Extend timeline (E): $n = 250$, $r = 0.80$, $d = 8$, $c_{\\text{per}} = 400$, $C_{\\text{fix}} = 120000$.\n  - Add sites (S): $n = 180$, $r = 0.95$, $d = 4$, $c_{\\text{per}} = 500$, $s = 2$, $C_{\\text{site}} = 60000$.\n  - Stop (T): no additional parameters.\n\nYour program must:\n1. For each test case, compute:\n   - The current net benefit with no additional sampling, $\\max\\{0, A (\\mu_0 - t)\\}$, where $A = N_{\\text{pop}} v$ and $t = F_{\\text{impl}}/A$.\n   - For E and S:\n     - The effective sample size $n_{\\text{eff}} = n r$.\n     - The preposterior distribution of the posterior mean of $\\theta$ under the normal-normal model and the discounted expected net benefit of the optimal implementation decision after sampling (using only foundational definitions).\n     - The Expected Value of Sample Information (EVSI) as the discounted expected net benefit with sampling for that option minus the current net benefit (exclude sampling costs from EVSI).\n     - The expected net benefit of the option as discounted expected net benefit with sampling minus sampling costs.\n   - For T: EVSI equals $0$ and expected net benefit equals the current net benefit.\n2. Select the option with the highest expected net benefit among E, S, and T. Encode the best option as an integer index: $0$ for E, $1$ for S, $2$ for T.\n3. Output, for each test case, a list containing:\n   - The best option index,\n   - The expected net benefits for E, S, and T (in monetary units),\n   - The EVSI for E, S, and T (in monetary units).\n4. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with one list per test case in order, and no spaces. For example: \"[[case1_results],[case2_results],[case3_results]]\".\n\nAll outputs must be real numbers (floats) or integers as specified, with monetary units implicitly in the same arbitrary monetary unit as inputs, and delays in months already incorporated via discounting where applicable. No user input is required; the program must be fully self-contained and executable as-is.",
            "solution": "The problem requires the design of a decision-analytic program to select the optimal patient recruitment strategy among three options: extend the timeline ($E$), add new sites ($S$), or stop recruitment and make a decision now ($T$). The selection criterion is the maximization of the Expected Net Benefit (ENB), a principle derived from decision theory. The analysis is grounded in Bayesian inference using a conjugate normal-normal model.\n\nThe core of the problem is to quantify the value of gathering additional information through options $E$ and $S$ and weigh it against the costs and delays incurred. This is a classic application of the Expected Value of Sample Information (EVSI).\n\n**1. Foundational Framework and Quantities**\n\nThe decision revolves around a single treatment effect parameter, $\\theta$. The value of implementing the treatment is modeled as a linear function of $\\theta$.\nThe net benefit of adopting the treatment is given by $N_{\\text{pop}} v \\theta - F_{\\text{impl}}$, where $N_{\\text{pop}}$ is the addressable population, $v$ is the value per unit of effect, and $F_{\\text{impl}}$ is the fixed implementation cost. The net benefit of not adopting is $0$.\n\nWe define two key constants:\n-   The total potential value scaled by population: $A = N_{\\text{pop}} v$.\n-   The breakeven threshold for the effect parameter: $t = F_{\\text{impl}} / A$.\n\nWith these definitions, the net benefit of adoption simplifies to $A(\\theta - t)$. A rational agent will adopt the treatment only if the expected value of $\\theta$ is greater than the threshold $t$.\n\nThe uncertainty in $\\theta$ is modeled by a probability distribution. Initially, this is the prior distribution, which is given as a normal distribution:\n$$\n\\theta \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)\n$$\nwhere $\\mu_0$ is the prior mean and $\\sigma_0^2$ is the prior variance.\n\n**2. Decision without Sampling (Action T: Stop)**\n\nIf we stop recruitment now, the decision to adopt or not must be made based solely on the prior information. The expected net benefit of adoption is:\n$$\nE[\\text{Net Benefit | Adopt}] = E[A(\\theta - t)] = A(E[\\theta] - t) = A(\\mu_0 - t)\n$$\nThe expected net benefit of not adopting is $0$. The optimal decision is to choose the action with the greater expected net benefit. Therefore, the current net benefit, which we denote $NB_0$, is:\n$$\nNB_0 = \\max\\{0, A(\\mu_0 - t)\\}\n$$\nFor action $T$ (Stop), there are no additional sampling costs or delays. Thus, its Expected Net Benefit is equal to the current net benefit:\n$$\nENB_T = NB_0\n$$\nBy definition, the EVSI for taking no action is zero: $EVSI_T = 0$.\n\n**3. Decision with Sampling (Actions E and S)**\n\nActions $E$ (Extend) and $S$ (Add Sites) involve collecting more data before making the adoption decision. This process is modeled as follows:\n-   A new cohort of effective sample size $n_{\\text{eff}}$ is recruited.\n-   The aggregated outcome mean from this cohort, $\\bar{Y}$, is assumed to follow a normal distribution centered at the true effect $\\theta$: $\\bar{Y} \\sim \\mathcal{N}(\\theta, \\sigma^2/n_{\\text{eff}})$.\n-   This new data $\\bar{Y}$ is used to update the prior distribution of $\\theta$ to a posterior distribution via Bayes' theorem.\n\nFor the normal-normal conjugate model, if $\\theta \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)$ and $\\bar{Y} \\sim \\mathcal{N}(\\theta, \\sigma^2/n_{\\text{eff}})$, the posterior distribution of $\\theta$ given an observed sample mean $\\bar{y}$ is also normal, $\\theta|\\bar{y} \\sim \\mathcal{N}(\\mu_1, \\sigma_1^2)$, with posterior mean $\\mu_1$ and variance $\\sigma_1^2$.\n\nThe decision process with sampling has two stages: first sample, then decide. To evaluate this process beforehand, we perform a preposterior analysis. We must determine the expected net benefit over all possible outcomes of the future experiment.\n\nAfter sampling, the decision to adopt will be based on the posterior mean $\\mu_1$. We adopt if $A(\\mu_1 - t) > 0$. The value of this posterior decision is $\\max\\{0, A(\\mu_1 - t)\\}$.\n\nBefore we sample, the posterior mean $\\mu_1$ is itself a random variable, as it depends on the yet-to-be-observed data $\\bar{Y}$. Its distribution is known as the preposterior distribution of the posterior mean. For the specified model, this distribution is normal:\n$$\n\\mu_1 \\sim \\mathcal{N}(\\mu_0, \\sigma_{\\mu_1}^2)\n$$\nThe mean of the preposterior distribution is the prior mean $\\mu_0$. Its variance, $\\sigma_{\\mu_1}^2$, represents the expected reduction in variance about $\\theta$ and is given by:\n$$\n\\sigma_{\\mu_1}^2 = \\frac{n_{\\text{eff}} \\sigma_0^4}{\\sigma^2 + n_{\\text{eff}} \\sigma_0^2}\n$$\nThe gross expected net benefit from the two-stage sampling-then-decision process, before accounting for costs or delays, is the expectation of the posterior decision's value taken over the preposterior distribution of $\\mu_1$:\n$$\nENBS_{\\text{pre\\_discount}} = E_{\\mu_1}[\\max\\{0, A(\\mu_1 - t)\\}] = \\int_{-\\infty}^{\\infty} \\max\\{0, A(x-t)\\} p(x) dx\n$$\nwhere $p(x)$ is the probability density function (PDF) of $\\mathcal{N}(\\mu_0, \\sigma_{\\mu_1}^2)$. This integral evaluates to a standard result in value-of-information analysis:\n$$\nENBS_{\\text{pre\\_discount}} = A \\left[ (\\mu_0 - t)(1 - \\Phi(z_t)) + \\sigma_{\\mu_1} \\phi(z_t) \\right]\n$$\nwhere $z_t = (t - \\mu_0) / \\sigma_{\\mu_1}$, and $\\phi(\\cdot)$ and $\\Phi(\\cdot)$ are the PDF and cumulative distribution function (CDF) of the standard normal distribution, respectively.\n\n**4. Incorporating Costs and Delays**\n\nA sampling strategy is only worthwhile if its benefits outweigh its costs. The gross benefit calculated above must be adjusted for delay and sampling costs.\n-   **Delay**: Each sampling option incurs a delay $d$ (in months). Future benefits are discounted to present value using a continuous monthly discount rate $q$. The discount factor is $\\exp(-qd)$. The discounted expected net benefit with sampling is:\n    $ENBS_{\\text{disc}} = ENBS_{\\text{pre\\_discount}} \\times \\exp(-qd)$\n-   **Sampling Costs ($C_{\\text{sample}}$)**: Each option has an associated cost.\n    -   For option E: $C_{\\text{sample},E} = c_{\\text{per}} n + C_{\\text{fix}}$\n    -   For option S: $C_{\\text{sample},S} = c_{\\text{per}} n + s C_{\\text{site}}$\n-   **Expected Net Benefit (ENB)**: The final ENB for a sampling option is its discounted benefit minus its cost:\n    $ENB_{\\text{option}} = ENBS_{\\text{disc}} - C_{\\text{sample}}$\n-   **Expected Value of Sample Information (EVSI)**: As per the problem's definition, this is the increase in discounted expected benefit over the baseline (no-sampling) case:\n    $EVSI_{\\text{option}} = ENBS_{\\text{disc}} - NB_0$\n\n**5. Optimal Decision and Algorithmic Implementation**\n\nThe optimal strategy is the one with the highest Expected Net Benefit. The algorithm proceeds as follows for each test case:\n1.  Calculate shared constants $A$ and $t$.\n2.  Calculate $NB_0$, which gives $ENB_T$ and establishes $EVSI_T=0$.\n3.  For each sampling option ($E$ and $S$):\n    a. Determine $n_{\\text{eff}}$, $C_{\\text{sample}}$, and $d$.\n    b. Compute the preposterior variance $\\sigma_{\\mu_1}^2$.\n    c. Calculate $ENBS_{\\text{pre\\_discount}}$ using the formula involving $\\phi(z_t)$ and $\\Phi(z_t)$.\n    d. Apply the discount factor to get $ENBS_{\\text{disc}}$.\n    e. Compute the final $ENB$ and $EVSI$ for the option.\n4.  Compare $ENB_E$, $ENB_S$, and $ENB_T$ to find the maximum. The index of the maximum value ($0$ for $E$, $1$ for $S$, $2$ for $T$) is the solution.\n5.  The computed values ($ENB_E, ENB_S, ENB_T, EVSI_E, EVSI_S, EVSI_T$) are compiled into the final output list.\n\nThis procedure rigorously translates the principles of Bayesian decision theory into a concrete computational method for solving the specified problem.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Solves the patient recruitment strategy selection problem for three test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"shared\": (0.05, 0.10, 1.00, 10000, 100, 80000, 0.01),\n            \"E\": {\"n\": 200, \"r\": 0.85, \"d\": 6, \"c_per\": 500, \"C_fix\": 100000},\n            \"S\": {\"n\": 150, \"r\": 0.90, \"d\": 4, \"c_per\": 600, \"s\": 3, \"C_site\": 50000}\n        },\n        {\n            \"shared\": (0.06, 0.08, 1.00, 50000, 200, 400000, 0.01),\n            \"E\": {\"n\": 300, \"r\": 0.90, \"d\": 5, \"c_per\": 300, \"C_fix\": 50000},\n            \"S\": {\"n\": 200, \"r\": 0.95, \"d\": 3, \"c_per\": 350, \"s\": 5, \"C_site\": 40000}\n        },\n        {\n            \"shared\": (0.04, 0.12, 1.00, 30000, 250, 250000, 0.01),\n            \"E\": {\"n\": 250, \"r\": 0.80, \"d\": 8, \"c_per\": 400, \"C_fix\": 120000},\n            \"S\": {\"n\": 180, \"r\": 0.95, \"d\": 4, \"c_per\": 500, \"s\": 2, \"C_site\": 60000}\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        mu0, sigma0, sigma, N_pop, v, F_impl, q = case[\"shared\"]\n\n        # 1. Calculate shared constants\n        A = N_pop * v\n        t = F_impl / A if A > 0 else float('inf')\n\n        # 2. Calculate for Stop option (T)\n        nb0 = max(0.0, A * (mu0 - t))\n        enb_t = nb0\n        evsi_t = 0.0\n\n        enb_values = {}\n        evsi_values = {}\n\n        # 3. Process sampling options E and S\n        options_to_process = [(\"E\", case[\"E\"]), (\"S\", case[\"S\"])]\n\n        for name, params in options_to_process:\n            # 3a. Get option parameters\n            d = params[\"d\"]\n            n_eff = params[\"n\"] * params[\"r\"]\n            \n            if name == \"E\":\n                sampling_cost = params[\"c_per\"] * params[\"n\"] + params[\"C_fix\"]\n            else:  # name == \"S\"\n                sampling_cost = params[\"c_per\"] * params[\"n\"] + params[\"s\"] * params[\"C_site\"]\n            \n            # 3b. Compute preposterior variance of the posterior mean\n            if n_eff > 0:\n                prepost_var_mu1 = (n_eff * sigma0**4) / (sigma**2 + n_eff * sigma0**2)\n                prepost_std_mu1 = np.sqrt(prepost_var_mu1)\n            else:\n                # Should not happen for E and S, but for completeness\n                prepost_std_mu1 = 0\n            \n            # 3c. Calculate gross expected net benefit (pre-discounting)\n            if prepost_std_mu1 > 1e-12: # Avoid division by zero\n                z_t = (t - mu0) / prepost_std_mu1\n                enbs_pre_discount = A * (\n                    (mu0 - t) * (1 - norm.cdf(z_t)) +\n                    prepost_std_mu1 * norm.pdf(z_t)\n                )\n            else: # Limiting case as preposterior variance -> 0\n                enbs_pre_discount = nb0\n\n            # 3d. Apply discount factor\n            discount_factor = np.exp(-q * d)\n            enbs_disc = enbs_pre_discount * discount_factor\n            \n            # 3e. Compute final ENB and EVSI\n            enb_option = enbs_disc - sampling_cost\n            evsi_option = enbs_disc - nb0\n            \n            enb_values[name] = enb_option\n            evsi_values[name] = evsi_option\n\n        # 4. Compare ENBs and select best option\n        enb_e = enb_values[\"E\"]\n        enb_s = enb_values[\"S\"]\n        \n        enbs = [enb_e, enb_s, enb_t]\n        best_enb = max(enbs)\n        best_option_index = enbs.index(best_enb)\n\n        # 5. Compile results for this case\n        case_result = [\n            best_option_index,\n            enb_e,\n            enb_s,\n            enb_t,\n            evsi_values[\"E\"],\n            evsi_values[\"S\"],\n            evsi_t\n        ]\n        all_results.append(case_result)\n\n    # Format the final output string to be exactly \"[[...],[...],...]\" without spaces.\n    case_strings = []\n    for case_res in all_results:\n        case_strings.append(\"[\" + \",\".join(map(str, case_res)) + \"]\")\n    final_output_str = \"[\" + \",\".join(case_strings) + \"]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}