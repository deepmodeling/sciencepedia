{
    "hands_on_practices": [
        {
            "introduction": "主成分分析（Principal Component Analysis, PCA）是群体遗传学中的基石技术，用于从高维基因型数据中可视化遗传祖源和群体结构。这项练习将引导您亲手实践PCA的核心步骤：标准化基因型、计算遗传关系矩阵和提取主成分，从而深入理解如何揭示样本中的群体分层。",
            "id": "5047840",
            "problem": "给定一个包含 $N$ 个个体和 $M$ 个双等位基因标记的基因型矩阵，其中每个基因型条目 $X_{i m}$ 是个体 $i$ 在标记 $m$ 处的替代等位基因计数，取值于 $\\{0,1,2\\}$。同时给定一个对应的向量，其中包含每个标记的次要等位基因频率 $p_m$。请利用二项分布方差的标准化原理和基于协方差的主成分分析 (PCA) 原理，构建一个程序，对每个提供的测试用例执行以下操作：\n\n1. 使用以下源自基因型二项模型的程序对基因型矩阵进行标准化，以生成 $Z \\in \\mathbb{R}^{N \\times M}$：对于每个标记 $m$，设置\n   $$Z_{i m} = \\begin{cases}\n   \\dfrac{X_{i m} - 2 p_m}{\\sqrt{2 p_m (1 - p_m)}},  & \\text{if } p_m \\in (0,1),\\\\[6pt]\n   0,  & \\text{if } p_m \\in \\{0,1\\},\n   \\end{cases}$$\n   适用于所有个体 $i \\in \\{1,\\dots,N\\}$。此标准化方法基于以下事实：在 Hardy–Weinberg 平衡假设下，对于次要等位基因频率为 $p_m$ 的双等位基因位点，基因型计数 $X_{i m}$ 的期望值为 $2 p_m$，方差为 $2 p_m (1 - p_m)$。\n\n2. 计算个体间协方差矩阵\n   $$C = \\frac{1}{M} Z Z^\\top \\in \\mathbb{R}^{N \\times N}.$$\n\n3. 按如下方式计算 $C$ 的前两个主成分。设 $C$ 的特征分解为\n   $$C = U \\Lambda U^\\top,$$\n   其中 $U \\in \\mathbb{R}^{N \\times N}$ 具有标准正交列 $u_k$，$\\Lambda = \\mathrm{diag}(\\lambda_1,\\dots,\\lambda_N)$ 的特征值按降序排列 $\\lambda_1 \\ge \\lambda_2 \\ge \\dots \\ge \\lambda_N \\ge 0$。为每个特征向量 $u_k$ 定义一个确定性的符号约定：找到第一个索引 $j$ 使得 $|u_{j k}| > 0$，如果 $u_{j k} < 0$，则将 $u_k$ 替换为 $-u_k$；否则保持 $u_k$ 不变。将个体在主成分 $k$ 上的得分定义为\n   $$s^{(k)} = \\sqrt{\\lambda_k} \\, u_k,$$\n   对于 $k = 1,2$。对于任何 $\\lambda_k = 0$ 的情况，将 $s^{(k)}$ 定义为零向量。\n\n4. 对于每个测试用例，输出所有个体的二维主成分得分列表，即列表 $\\big[ [s^{(1)}_1, s^{(2)}_1], \\dots, [s^{(1)}_N, s^{(2)}_N] \\big]$，每个条目四舍五入到 $6$ 位小数。\n\n您的程序必须处理以下参数值的测试套件。在每种情况下，$X$ 以列表的列表形式提供（行代表个体），$p$ 以长度为 $M$ 的浮点数列表形式提供：\n- 测试用例 A (具有对称结构的平衡等位基因频率):\n  - $X = \\begin{bmatrix}\n  0  1  2 \\\\\n  2  1  0 \\\\\n  1  1  1\n  \\end{bmatrix}$,\n  - $p = [0.5, 0.5, 0.5]$.\n- 测试用例 B (包括一个单态性标记和相同的个体):\n  - $X = \\begin{bmatrix}\n  0  0 \\\\\n  0  0\n  \\end{bmatrix}$,\n  - $p = [0.0, 0.3]$.\n- 测试用例 C (四个个体和四个标记，具有不同的等位基因频率，形成两个对立的聚类):\n  - $X = \\begin{bmatrix}\n  0  0  2  2 \\\\\n  0  1  2  1 \\\\\n  2  2  0  0 \\\\\n  2  1  0  1\n  \\end{bmatrix}$,\n  - $p = [0.1, 0.2, 0.8, 0.5]$.\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素对应一个测试用例，并且本身是一个包含 $N$ 对浮点数的列表，每对浮点数四舍五入到 $6$ 位小数。例如：\n  - \"[$\\text{caseA},\\text{caseB},\\text{caseC}$]\"，其中每个 $\\text{caseX}$ 的格式为 \"[[a,b],[c,d],...]\"。\n- 此处不适用单位。\n- 不使用角度。\n- 所有数值结果必须表示为十进制浮点数。\n\n不应从标准输入读取任何输入，也不应访问任何外部文件。程序必须完全自包含，并且仅为上述测试套件生成指定的单行输出。",
            "solution": "该问题要求对基因型数据实施主成分分析 (PCA)，这是群体基因组学中一种基础技术，用于推断群体结构和校正遗传关联研究中的混杂因素。该过程涉及标准化基因型矩阵，计算个体间协方差矩阵，然后通过特征分解找到其主成分。\n\n问题陈述的验证过程如下：\n- **步骤 1：提取给定信息**\n    - 基因型矩阵：$X \\in \\mathbb{R}^{N \\times M}$，条目为 $X_{i m} \\in \\{0, 1, 2\\}$。\n    - 个体数量：$N$。\n    - 标记数量：$M$。\n    - 等位基因频率向量：$p$，包含每个标记 $m$ 的条目 $p_m$。\n    - 标准化规则：当 $p_m \\in (0,1)$ 时，$Z_{i m} = \\frac{X_{i m} - 2 p_m}{\\sqrt{2 p_m (1 - p_m)}}$；当 $p_m \\in \\{0,1\\}$ 时，$Z_{i m} = 0$。\n    - 协方差矩阵：$C = \\frac{1}{M} Z Z^\\top$。\n    - 特征分解：$C = U \\Lambda U^\\top$，其中 $\\lambda_1 \\ge \\lambda_2 \\ge \\dots \\ge \\lambda_N \\ge 0$。\n    - 特征向量符号约定：对每个特征向量 $u_k$，找到第一个索引 $j$ 使得 $u_{j k} \\neq 0$。如果 $u_{j k} < 0$，则将 $u_k$ 替换为 $-u_k$。\n    - 主成分得分计算：$s^{(k)} = \\sqrt{\\lambda_k} u_k$，对于 $k=1,2$。\n    - 测试用例：提供了三个特定的 $(X, p)$ 对。\n    - 输出格式：一个表示结果列表的单行字符串，每个结果是一个包含二维坐标对的列表，四舍五入到 6 位小数。\n\n- **步骤 2：使用提取的给定信息进行验证**\n    - **科学依据**：该方法是群体遗传学中用于 PCA 的标准且广泛使用的方法。标准化公式在 Hardy-Weinberg 平衡假设下，通过基因型计数的期望均值（$2p_m$）和标准差（$\\sqrt{2p_m(1-p_m)}$）对其进行正确归一化。协方差矩阵 $C = \\frac{1}{M}ZZ^\\top$ 是遗传关系矩阵 (GRM) 的一种形式。其特征向量（主成分）代表了样本中遗传变异的主轴。该过程在科学上是合理的。\n    - **良态问题**：该问题在数学上是良定义的。协方差矩阵 $C$ 是对称半正定矩阵，这保证了其特征值为实的非负数，并存在一组完备的标准正交特征向量。为特征向量提供了确定性的符号约定，确保了解决方案的唯一性。\n    - **客观性**：所有指令都是定量的，没有主观或模糊的语言。\n    - 该问题没有其他缺陷；它是完整的、一致的，并且计算上是可行的。存在一个微小的术语不准确之处，即 $p_m$ 被称为“次要等位基因频率”，即使当使用 0.8 这样的值时（这使其成为主要等位基因频率），但数学上下文正确且明确地将 $p_m$ 定义为在 $X_{im}$ 中计数的等位基因的频率。这并不影响问题的有效性。\n\n- **步骤 3：结论与行动**\n    - 该问题是 **有效的**。将构建一个解决方案。\n\n通过对每个测试用例遵循规定的步骤来实施解决方案。\n\n1.  **基因型矩阵标准化**：对于每个测试用例，给定基因型矩阵 $X$ 和等位基因频率向量 $p$，我们首先构建标准化矩阵 $Z$。对于每个标记 $m$（列），我们检查其对应的等位基因频率 $p_m$ 是否为多态性（$0 < p_m < 1$）。如果是，我们使用提供的公式转换列 $X_{:m}$。如果标记是单态性（$p_m=0$ 或 $p_m=1$），则方差为零，标准化的列 $Z_{:m}$ 被设置为零向量，因为这些标记对群体结构不提供任何信息。\n\n2.  **协方差矩阵计算**：个体间协方差矩阵 $C$ 计算为 $C = \\frac{1}{M} Z Z^\\top$。这个 $N \\times N$ 矩阵总结了所有 $M$ 个标记上每对个体之间的平均遗传相似性。\n\n3.  **特征分解**：主成分由协方差矩阵 $C$ 的特征分解确定。由于 $C$ 是一个实对称矩阵，我们可以使用诸如 `numpy.linalg.eigh` 之类的专用例程，它在数值上稳定且高效。该函数返回按升序排列的特征值 $\\lambda_k$ 和一个矩阵 $U$，其列是对应的标准正交特征向量 $u_k$。为了获得最大的主成分，我们反转特征值及其对应特征向量的顺序。\n\n4.  **符号约定强制执行**：特征向量的方向是任意的（即，如果 $u_k$ 是一个特征向量，那么 $-u_k$ 也是）。为确保确定性输出，对前两个特征向量 $u_1$ 和 $u_2$ 应用了特定的符号约定。对于每个向量，我们找到其第一个非零元素。如果此元素为负，则通过乘以 $-1$ 来翻转整个向量的符号。\n\n5.  **主成分得分计算**：最后，计算每个个体的主成分得分。个体在第 $k$ 个主成分上的得分是第 $k$ 个特征向量乘以相应第 $k$ 个特征值的平方根。我们计算前两个主成分的得分，$s^{(1)} = \\sqrt{\\lambda_1} u_1$ 和 $s^{(2)} = \\sqrt{\\lambda_2} u_2$。请注意，如果一个特征值 $\\lambda_k$ 由于数值精度问题为零或非常接近于零，则 $\\sqrt{\\lambda_k}$ 也将为零，从而得到零得分向量，这是正确的行为。然后将每个个体 $i$ 的得分组合成二维坐标对 $[s^{(1)}_i, s^{(2)}_i]$。\n\n整个过程被封装在一个程序中，该程序处理提供的测试用例，并按规定将输出格式化为单行字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It orchestrates the calculation of principal components for each case\n    and formats the final output string.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (\n            [[0, 1, 2], [2, 1, 0], [1, 1, 1]],\n            [0.5, 0.5, 0.5]\n        ),\n        (\n            [[0, 0], [0, 0]],\n            [0.0, 0.3]\n        ),\n        (\n            [[0, 0, 2, 2], [0, 1, 2, 1], [2, 2, 0, 0], [2, 1, 0, 1]],\n            [0.1, 0.2, 0.8, 0.5]\n        )\n    ]\n\n    all_results = []\n    for x_list, p_list in test_cases:\n        X = np.array(x_list, dtype=float)\n        p = np.array(p_list, dtype=float)\n        \n        # Call the core computation function\n        pc_scores = compute_principal_components(X, p)\n        \n        all_results.append(pc_scores)\n\n    # Format the final output string as specified.\n    case_strings = []\n    for case_result in all_results:\n        # Format each [score1, score2] pair\n        pair_strings = [f\"[{s1:.6f},{s2:.6f}]\" for s1, s2 in case_result]\n        # Join pairs into a case string like \"[[a,b],[c,d]]\"\n        case_str = f\"[{','.join(pair_strings)}]\"\n        case_strings.append(case_str)\n        \n    final_output = f\"[{','.join(case_strings)}]\"\n    print(final_output)\n\ndef compute_principal_components(X, p):\n    \"\"\"\n    Calculates the top two principal component scores for a given genotype matrix\n    and allele frequency vector.\n\n    Args:\n        X (np.ndarray): N x M genotype matrix.\n        p (np.ndarray): Vector of M allele frequencies.\n\n    Returns:\n        list: A list of N pairs, where each pair is the [PC1, PC2] score for an individual.\n    \"\"\"\n    N, M = X.shape\n    \n    # 1. Standardize the genotype matrix\n    Z = np.zeros_like(X, dtype=float)\n    for m in range(M):\n        pm = p[m]\n        # The standardization is only defined for polymorphic markers.\n        # For monomorphic markers (p=0 or p=1), variance is 0, so Z remains 0.\n        if 0 < pm < 1:\n            denominator = np.sqrt(2 * pm * (1 - pm))\n            if denominator > 0:\n                Z[:, m] = (X[:, m] - 2 * pm) / denominator\n\n    # 2. Compute the individual-by-individual covariance matrix C\n    # If M is 0, C should be a zero matrix.\n    if M == 0:\n        C = np.zeros((N, N))\n    else:\n        C = (1 / M) * (Z @ Z.T)\n\n    # 3. Compute the eigendecomposition of C\n    # np.linalg.eigh is used for symmetric matrices and returns eigenvalues\n    # in ascending order.\n    if N > 0:\n        eigenvalues, eigenvectors = np.linalg.eigh(C)\n        \n        # Reverse to get descending order for principal components\n        eigenvalues = eigenvalues[::-1]\n        eigenvectors = eigenvectors[:, ::-1]\n    else: # Handle empty genotype matrix\n        eigenvalues = np.array([])\n        eigenvectors = np.array([[]])\n\n    # Extract top two components, handling cases where N < 2\n    lambda_1 = eigenvalues[0] if N > 0 else 0.0\n    lambda_2 = eigenvalues[1] if N > 1 else 0.0\n    \n    u_1 = eigenvectors[:, 0] if N > 0 else np.zeros(N)\n    u_2 = eigenvectors[:, 1] if N > 1 else np.zeros(N)\n\n    # 4. Apply the deterministic sign convention\n    # A small tolerance is used to find the first 'non-zero' element.\n    # The default atol in np.isclose is 1e-08.\n    for u in [u_1, u_2]:\n        if u.size > 0:\n            first_nonzero_idx = -1\n            for i, val in enumerate(u):\n                if not np.isclose(val, 0.0):\n                    first_nonzero_idx = i\n                    break\n            \n            if first_nonzero_idx != -1 and u[first_nonzero_idx] < 0:\n                u *= -1\n\n    # 5. Compute the principal component scores\n    # Use max(0, lambda) to prevent sqrt of small negative numbers from FP error\n    s1 = np.sqrt(max(0, lambda_1)) * u_1\n    s2 = np.sqrt(max(0, lambda_2)) * u_2\n    \n    # Combine scores into a list of [PC1, PC2] pairs\n    scores = np.stack((s1, s2), axis=1).tolist()\n    \n    return scores\n\nsolve()\n\n```"
        },
        {
            "introduction": "将理论应用于实践是精准公共卫生的核心。这项练习将基础概率论（特别是贝叶斯定理）应用于评估基因筛查项目的实际性能。通过计算阳性预测值（Positive Predictive Value, PPV），您将学会如何量化一个筛查测试在真实世界人群中的有效性，这是任何公共卫生干预措施的关键考量。",
            "id": "5047891",
            "problem": "一个国家的转化医学精准公共卫生项目正在考虑实施一项针对由致病性变异定义的罕见单基因疾病的人群基因组筛查。该检测的灵敏度为$0.95$，特异性为$0.99$。该疾病在人群中的患病率（先验概率）为 $K = 0.001$。假设该检测的性能在不同亚组中是稳定的，并且每个被筛查个体的结果是相互独立的。\n\n从灵敏度和特异性的定义以及条件概率的贝叶斯定理出发，推导该筛查在此人群中的阳性预测值（PPV；positive predictive value）$P(\\text{疾病} \\mid +)$。然后，使用概率和独立伯努利试验期望的第一性原理，推导在 $100{,}000$ 名被筛查个体中真阳性的期望数量。\n\n将阳性预测值表示为小数（而非百分比），四舍五入至四位有效数字，并提供每 $100{,}000$ 名筛查者中真阳性期望数的精确整数值。按照以下顺序报告您的最终答案：PPV，期望真阳性数。",
            "solution": "题目要求推导一项人群范围内的基因筛查的阳性预测值（PPV）和真阳性的期望数量。该问题陈述清晰且有科学依据，提供了完整解答所需的所有参数。\n\n设 $D$ 为个体患有该单基因疾病的事件，设 $D^c$ 为个体未患该疾病的事件。\n设 $+$ 为检测结果为阳性的事件，设 $-$ 为检测结果为阴性的事件。\n\n题目陈述中给出的已知条件可以转化为概率术语：\n1.  该疾病的人群患病率 $K$ 是患病的先验概率：$P(D) = K = 0.001$。\n2.  该检测的灵敏度是指在个体患病的情况下，检测结果为阳性的概率：$P(+ \\mid D) = 0.95$。\n3.  该检测的特异性是指在个体未患病的情况下，检测结果为阴性的概率：$P(- \\mid D^c) = 0.99$。\n4.  被筛查的总人数为 $N = 100000$。\n\n首先，我们推导阳性预测值（PPV），其定义为在检测结果为阳性的条件下患有该疾病的条件概率，$P(D \\mid +)$。\n根据贝叶斯定理：\n$$P(D \\mid +) = \\frac{P(+ \\mid D) P(D)}{P(+)}$$\n为了使用这个公式，我们必须首先使用全概率公式计算检测结果为阳性的总概率 $P(+)$。检测结果为阳性的事件可以分为两个互斥事件：真阳性（检测为阳性且患有疾病）和假阳性（检测为阳性但未患病）。\n$$P(+) = P(+ \\cap D) + P(+ \\cap D^c)$$\n使用条件概率的定义 $P(A \\cap B) = P(A \\mid B)P(B)$，上式可展开为：\n$$P(+) = P(+ \\mid D) P(D) + P(+ \\mid D^c) P(D^c)$$\n我们已知 $P(+ \\mid D)$ 和 $P(D)$。我们需要确定 $P(D^c)$ 和 $P(+ \\mid D^c)$。\n未患病的概率 $P(D^c)$ 是患病率的补集：\n$$P(D^c) = 1 - P(D) = 1 - 0.001 = 0.999$$\n在未患病个体中检测结果为阳性的概率 $P(+ \\mid D^c)$ 是特异性 $P(- \\mid D^c)$ 的补集。这是因为对于一个未患病的个体，检测结果只能是阳性或阴性。\n$$P(+ \\mid D^c) = 1 - P(- \\mid D^c) = 1 - 0.99 = 0.01$$\n这个量 $P(+ \\mid D^c)$ 也被称为假阳性率。\n\n现在我们可以计算检测结果为阳性的总概率 $P(+)$：\n$$P(+) = (0.95)(0.001) + (0.01)(0.999) = 0.00095 + 0.00999 = 0.01094$$\n计算出 $P(+)$ 后，我们可以确定 PPV：\n$$P(D \\mid +) = \\frac{P(+ \\mid D) P(D)}{P(+)} = \\frac{(0.95)(0.001)}{0.01094} = \\frac{0.00095}{0.01094}$$\n$$P(D \\mid +) \\approx 0.086837294332724...$$\n题目要求将此值四舍五入至四位有效数字。\n$$PPV = P(D \\mid +) \\approx 0.08684$$\n\n接下来，我们推导在 $N=100000$ 名被筛查个体中真阳性的期望数量。\n真阳性（TP）是个体既患有疾病（$D$）又检测结果为阳性（$+$）的事件。一个随机选择的个体为真阳性的概率是 $P(TP) = P(D \\cap +)$。\n使用条件概率的定义：\n$$P(TP) = P(D \\cap +) = P(+ \\mid D) P(D)$$\n代入给定值：\n$$P(TP) = (0.95)(0.001) = 0.00095$$\n对 $N$ 个个体中的每一个进行筛查都是一次独立的伯努利试验，其中“成功”定义为该个体是真阳性。设 $X$ 为代表 $N$ 个个体样本中真阳性总数的随机变量。$X$ 服从二项分布，$X \\sim B(N, p)$，其中试验次数 $N=100000$，每次试验的成功概率 $p = P(TP) = 0.00095$。\n\n服从二项分布的随机变量的期望值（或均值）由公式 $E[X] = Np$ 给出。\n因此，真阳性的期望数量 $E[X]$ 为：\n$$E[X] = N \\times p = 100000 \\times 0.00095$$\n$$E[X] = 95$$\n这是一个精确的整数值，符合题目要求。\n\n最终答案包含两个值，按顺序排列：四舍五入到四位有效数字的PPV，以及真阳性期望数的精确整数值。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.08684 & 95 \\end{pmatrix}}$$"
        },
        {
            "introduction": "随着基因组风险模型在临床中的应用，确保其在不同人群间的公平性变得至关重要。这项练习将您带到精准医学的前沿，介绍如“均等化赔率”等正式的公平性度量。您将通过一个定量优化问题，学习如何调整模型阈值以减少人群间的性能差异，这是转化医学中一项关键且富有挑战性的任务。",
            "id": "5047738",
            "problem": "一个国家级精准公共卫生项目部署了一个基因组-临床风险模型，以优先进行十年期冠状动脉疾病筛查。该风险评分结合了多基因风险评分 (PRS) 和临床协变量，并输出一个估计风险 $p \\in [0,1]$。如果个体的预测风险超过一个决策阈值，他们将被标记为需要进行强化筛查。\n\n评估了两个按血统分层的人群：Group $A$（参考组）和 Group $B$（阈值调整的目标组）。在当前通用阈值 $t=0.20$ 下，通过独立验证估计，观察到以下操作特征：\n\n- Group $A$：真阳性率 (TPR) $=0.82$，假阳性率 (FPR) $=0.12$，校准斜率 $s_A=0.97$，疾病患病率 $\\pi_A=0.15$。\n- Group $B$：真阳性率 (TPR) $=0.70$，假阳性率 (FPR) $=0.08$，校准斜率 $s_B=0.85$，疾病患病率 $\\pi_B=0.10$。\n\n要求您量化群体公平性，并为 Group $B$ 确定一个小的阈值调整，以在考虑校准的同时减少差异。仅使用以下基本依据和定义：\n\n- 真阳性率 (TPR) 为 $TPR=P(\\hat{Y}=1 \\mid Y=1)$，假阳性率 (FPR) 为 $FPR=P(\\hat{Y}=1 \\mid Y=0)$。\n- 阳性预测值 (PPV) 为 $PPV=P(Y=1 \\mid \\hat{Y}=1)$，可由贝叶斯法则推导得出，对于患病率 $\\pi$，其公式为 $PPV=\\dfrac{\\pi \\cdot TPR}{\\pi \\cdot TPR + (1-\\pi)\\cdot FPR}$。\n- 两组之间的均等化赔率差异通过 $\\{TPR,FPR\\}$ 空间中的欧几里得距离来衡量，$D_{EO}=\\sqrt{(TPR_A-TPR_B)^2+(FPR_A-FPR_B)^2}$。\n- 校准斜率 $s$ 是将观测结果对预测风险的 logit 进行回归得到的斜率；理想的校准对应于 $s=1$。\n\n假设在 $t=0.20$ 附近，Group $B$ 的操作特征随阈值平滑变化。设此操作点的一阶阈值敏感度为：\n$$\\alpha=\\frac{d\\,TPR_B}{dt}=-3.00 \\quad\\text{和}\\quad \\beta=\\frac{d\\,FPR_B}{dt}=-1.00.$$\n您将只对 Group $B$ 的阈值进行一个小的增量调整 $\\Delta t$（Group $A$ 固定不变），使得 $TPR_B$ 和 $FPR_B$ 近似地按如下方式变化：\n$$TPR_B(t+\\Delta t)\\approx TPR_B(t)+\\alpha\\,\\Delta t,\\qquad FPR_B(t+\\Delta t)\\approx FPR_B(t)+\\beta\\,\\Delta t.$$\n\n将公平性目标定义为正则化的均等化赔率平方差异，\n$$E(\\Delta t)=\\big(TPR_A-\\big[TPR_B+\\alpha\\,\\Delta t\\big]\\big)^2+\\big(FPR_A-\\big[FPR_B+\\beta\\,\\Delta t\\big]\\big)^2+\\lambda\\,(\\Delta t)^2,$$\n其中正则化权重是考虑校准的\n$$\\lambda=(1-s_B)^2.$$\n\n任务：\n1. 使用给定的定义，计算在 $t=0.20$ 时的以下指标：\n   - Group $A$ 和 Group $B$ 之间的均等化赔率距离 $D_{EO}$。\n   - 阳性预测值差异 $\\Delta_{PPV}=PPV_A-PPV_B$。\n   - 校准斜率差异 $\\Delta_s=s_A-s_B$。\n2. 从第一性原理和给定的近似出发，推导 $E(\\Delta t)$ 的闭式解最小化器 $\\Delta t^\\star$，并使用所提供的数据进行数值计算。将最终答案表示为 $\\Delta t^\\star$ 的单个数值（无单位的阈值变化，解释为风险的比例），并将您的最终答案四舍五入到四位有效数字。",
            "solution": "首先对问题陈述进行严格的验证过程。\n\n### 第 1 步：提取给定信息\n问题陈述中提供的数据、定义和条件如下：\n- 风险评分 $p \\in [0,1]$。\n- 通用阈值 $t=0.20$。\n- Group $A$ (参考组) 在 $t=0.20$ 时的特征：\n  - 真阳性率 $TPR_A=0.82$\n  - 假阳性率 $FPR_A=0.12$\n  - 校准斜率 $s_A=0.97$\n  - 疾病患病率 $\\pi_A=0.15$\n- Group $B$ (目标组) 在 $t=0.20$ 时的特征：\n  - 真阳性率 $TPR_B=0.70$\n  - 假阳性率 $FPR_B=0.08$\n  - 校准斜率 $s_B=0.85$\n  - 疾病患病率 $\\pi_B=0.10$\n- 定义：\n  - $TPR=P(\\hat{Y}=1 \\mid Y=1)$\n  - $FPR=P(\\hat{Y}=1 \\mid Y=0)$\n  - $PPV=\\dfrac{\\pi \\cdot TPR}{\\pi \\cdot TPR + (1-\\pi)\\cdot FPR}$\n  - 均等化赔率距离 $D_{EO}=\\sqrt{(TPR_A-TPR_B)^2+(FPR_A-FPR_B)^2}$\n  - 校准斜率 $s$ 来自于将观测结果对预测风险的 logit 进行回归。\n- Group $B$ 在 $t=0.20$ 时的阈值敏感度：\n  - $\\alpha=\\frac{d\\,TPR_B}{dt}=-3.00$\n  - $\\beta=\\frac{d\\,FPR_B}{dt}=-1.00$\n- Group $B$ 的操作特征随阈值变化 $\\Delta t$ 的一阶近似：\n  - $TPR_B(t+\\Delta t)\\approx TPR_B(t)+\\alpha\\,\\Delta t$\n  - $FPR_B(t+\\Delta t)\\approx FPR_B(t)+\\beta\\,\\Delta t$\n- 待最小化的公平性目标函数：\n  - $E(\\Delta t)=\\big(TPR_A-\\big[TPR_B+\\alpha\\,\\Delta t\\big]\\big)^2+\\big(FPR_A-\\big[FPR_B+\\beta\\,\\Delta t\\big]\\big)^2+\\lambda\\,(\\Delta t)^2$\n- 考虑校准的正则化权重：\n  - $\\lambda=(1-s_B)^2$\n\n### 第 2 步：使用提取的给定信息进行验证\n根据既定标准评估问题的有效性。\n- **科学依据**：该问题恰好位于转化医学领域，特别解决了算法医学和精准公共卫生中公平性的关键问题。所有使用的概念，如 $TPR$、$FPR$、$PPV$、校准斜率和均等化赔率，都是机器学习公平性和临床模型评估中的标准、明确定义的度量标准。使用一阶泰勒展开来模拟小阈值变化的影响是一种标准且适当的数学近似方法。为了平衡竞争目标（公平性与校准）而对目标函数进行正则化是优化中的常用技术。该问题在科学上是合理的。\n- **适定性**：该问题是适定的。它提供了执行所需计算的所有必要数据和定义。目标函数 $E(\\Delta t)$ 是关于 $\\Delta t$ 的二次函数，其 $(\\Delta t)^2$ 项的系数为正（因为 $\\alpha^2+\\beta^2+\\lambda > 0$），确保存在唯一的全局最小值。\n- **客观性**：该问题使用精确、定量和无偏见的语言陈述。所有术语都有正式定义。没有主观或基于观点的陈述。\n\n该问题没有表现出验证标准中列出的任何缺陷（例如，事实不健全、不完整、模糊性）。\n\n### 第 3 步：结论与行动\n该问题被判定为**有效**。将提供完整的解决方案。\n\n解决方案按要求分为两部分进行。首先，我们计算基线差异度量。其次，我们推导并评估最优阈值调整 $\\Delta t^\\star$。\n\n**第 1 部分：基线差异计算**\n\n我们被要求在通用阈值 $t=0.20$ 处计算三个度量。\n\n1.  **均等化赔率距离 ($D_{EO}$)**\n    该度量衡量了两组在 $\\{TPR, FPR\\}$ 平面中的欧几里得距离。\n    $$D_{EO} = \\sqrt{(TPR_A-TPR_B)^2+(FPR_A-FPR_B)^2}$$\n    代入给定值：\n    $$D_{EO} = \\sqrt{(0.82-0.70)^2+(0.12-0.08)^2} = \\sqrt{(0.12)^2+(0.04)^2} = \\sqrt{0.0144+0.0016} = \\sqrt{0.016}$$\n    数值上，$D_{EO} \\approx 0.1265$。\n\n2.  **阳性预测值差异 ($\\Delta_{PPV}$)**\n    首先，我们使用公式 $PPV=\\dfrac{\\pi \\cdot TPR}{\\pi \\cdot TPR + (1-\\pi)\\cdot FPR}$ 计算每个组的 $PPV$。\n    对于 Group $A$：\n    $$PPV_A = \\frac{\\pi_A \\cdot TPR_A}{\\pi_A \\cdot TPR_A + (1-\\pi_A) \\cdot FPR_A} = \\frac{0.15 \\cdot 0.82}{0.15 \\cdot 0.82 + (1-0.15) \\cdot 0.12} = \\frac{0.123}{0.123 + 0.85 \\cdot 0.12} = \\frac{0.123}{0.123 + 0.102} = \\frac{0.123}{0.225} \\approx 0.5467$$\n    对于 Group $B$：\n    $$PPV_B = \\frac{\\pi_B \\cdot TPR_B}{\\pi_B \\cdot TPR_B + (1-\\pi_B) \\cdot FPR_B} = \\frac{0.10 \\cdot 0.70}{0.10 \\cdot 0.70 + (1-0.10) \\cdot 0.08} = \\frac{0.07}{0.07 + 0.90 \\cdot 0.08} = \\frac{0.07}{0.07 + 0.072} = \\frac{0.07}{0.142} \\approx 0.4930$$\n    差异是两者之差：\n    $$\\Delta_{PPV} = PPV_A-PPV_B \\approx 0.5467 - 0.4930 = 0.0537$$\n\n3.  **校准斜率差异 ($\\Delta_s$)**\n    这是对给定校准斜率的直接相减：\n    $$\\Delta_s = s_A-s_B = 0.97 - 0.85 = 0.12$$\n\n**第 2 部分：最优阈值调整 ($\\Delta t^\\star$) 的推导与评估**\n\n目标是找到使以下函数最小化的 $\\Delta t$ 值：\n$$E(\\Delta t)=\\big(TPR_A-\\big[TPR_B+\\alpha\\,\\Delta t\\big]\\big)^2+\\big(FPR_A-\\big[FPR_B+\\beta\\,\\Delta t\\big]\\big)^2+\\lambda\\,(\\Delta t)^2$$\n让我们将初始差异定义为 $\\Delta_{TPR} = TPR_A - TPR_B$ 和 $\\Delta_{FPR} = FPR_A - FPR_B$。该函数可以重写为：\n$$E(\\Delta t) = (\\Delta_{TPR} - \\alpha \\Delta t)^2 + (\\Delta_{FPR} - \\beta \\Delta t)^2 + \\lambda (\\Delta t)^2$$\n为了找到最小值，我们将 $E(\\Delta t)$ 对 $\\Delta t$ 求导，并令导数等于零。\n$$\\frac{dE}{d(\\Delta t)} = \\frac{d}{d(\\Delta t)} \\left[ (\\Delta_{TPR} - \\alpha \\Delta t)^2 + (\\Delta_{FPR} - \\beta \\Delta t)^2 + \\lambda (\\Delta t)^2 \\right]$$\n使用链式法则：\n$$\\frac{dE}{d(\\Delta t)} = 2(\\Delta_{TPR} - \\alpha \\Delta t)(-\\alpha) + 2(\\Delta_{FPR} - \\beta \\Delta t)(-\\beta) + 2\\lambda \\Delta t$$\n令导数等于零并除以 $2$：\n$$-\\alpha(\\Delta_{TPR} - \\alpha \\Delta t) - \\beta(\\Delta_{FPR} - \\beta \\Delta t) + \\lambda \\Delta t = 0$$\n展开各项：\n$$-\\alpha\\Delta_{TPR} + \\alpha^2 \\Delta t - \\beta\\Delta_{FPR} + \\beta^2 \\Delta t + \\lambda \\Delta t = 0$$\n我们现在分离出包含 $\\Delta t$ 的项：\n$$\\Delta t (\\alpha^2 + \\beta^2 + \\lambda) = \\alpha\\Delta_{TPR} + \\beta\\Delta_{FPR}$$\n求解 $\\Delta t$，我们得到最优调整量 $\\Delta t^\\star$：\n$$\\Delta t^\\star = \\frac{\\alpha\\Delta_{TPR} + \\beta\\Delta_{FPR}}{\\alpha^2 + \\beta^2 + \\lambda}$$\n代入 $\\Delta_{TPR}$ 和 $\\Delta_{FPR}$ 的原始定义：\n$$\\Delta t^\\star = \\frac{\\alpha(TPR_A - TPR_B) + \\beta(FPR_A - FPR_B)}{\\alpha^2 + \\beta^2 + \\lambda}$$\n现在，我们代入所提供的数值。\n首先，计算正则化权重 $\\lambda$：\n$$\\lambda = (1 - s_B)^2 = (1 - 0.85)^2 = (0.15)^2 = 0.0225$$\n接下来，计算 $\\Delta t^\\star$ 表达式的分子：\n$$\\text{分子} = (-3.00)(0.82 - 0.70) + (-1.00)(0.12 - 0.08)$$\n$$\\text{分子} = (-3.00)(0.12) + (-1.00)(0.04) = -0.36 - 0.04 = -0.40$$\n然后，计算分母：\n$$\\text{分母} = \\alpha^2 + \\beta^2 + \\lambda = (-3.00)^2 + (-1.00)^2 + 0.0225$$\n$$\\text{分母} = 9.00 + 1.00 + 0.0225 = 10.0225$$\n最后，我们计算 $\\Delta t^\\star$：\n$$\\Delta t^\\star = \\frac{-0.40}{10.0225} \\approx -0.03990773...$$\n问题要求将答案四舍五入到四位有效数字。\n$$\\Delta t^\\star \\approx -0.03991$$\n这个结果表明，对于 Group $B$，决策阈值应从 $0.20$ 降低到约 $0.20 - 0.03991 = 0.16009$，以最小化正则化的公平性-校准目标。这一调整旨在同时增加 $TPR_B$ 和 $FPR_B$（因为 $\\alpha$ 和 $\\beta$ 为负），使它们更接近 Group $A$ 的值，从而减少均等化赔率差异。正则化项惩罚大的调整，由于 Group $B$ 较差的初始校准度（$s_B=0.85$），惩罚力度更大。",
            "answer": "$$\\boxed{-0.03991}$$"
        }
    ]
}