{
    "hands_on_practices": [
        {
            "introduction": "在研究设计中，严谨性的一个核心要素是前瞻性地确定研究所需的样本量。样本量不足的研究（即统计功效不足）无法可靠地检测出真实的效应，从而导致结论模糊且不可复现的结果，这是当前“可重复性危机”的一个主要原因。通过进行先验功效分析，研究人员可以确保他们的研究在资源投入和获得明确结论的可能性之间达到合理的平衡。本练习将引导你从第一性原理出发，推导双臂平行组试验中用于连续性结局的样本量计算公式，从而加深你对统计功效、效应大小、显著性水平和样本量之间相互作用的理解。",
            "id": "5057046",
            "problem": "一个转化医学团队正在计划一项双臂、平行组、随机对照试验，以比较一种新型抗炎小分子药物与标准治疗在生物标志物水平升高的患者中的疗效。主要终点是使用标准化单位测量的、经过验证的炎症生物标志物的连续性变化评分。研究者希望通过前瞻性地确定为达到双侧显著性检验的预设统计功效所需的每组最小样本量，来确保研究的严谨性和可重复性，从而避免因统计功效不足而导致无法重复的结果。\n\n假设以下设计特征和模型假设：\n- 两个独立组，等比例分配，每组样本量为 $n$。\n- 各组内的结局是独立同分布的，具有共同方差 $\\sigma^{2}$。\n- 主要分析将使用显著性水平为 $\\alpha$ 的双侧双样本 $t$ 检验，检验原假设 $H_{0}:\\ \\mu_{1}-\\mu_{2}=0$ 与备择假设 $H_{1}:\\ \\mu_{1}-\\mu_{2}\\neq 0$。其中 $\\mu_{1}-\\mu_{2}$ 表示试验组和对照组之间的真实均值差异。\n- 为计划目的，当代入 $\\sigma^{2}$ 的一个计划值时，可根据中心极限定理，使用标准正态分布来近似标准化样本均值差的抽样分布。\n\n任务：\n1. 从I类错误（当 $H_{0}$ 为真时拒绝 $H_{0}$ 的概率为 $\\alpha$）、II类错误（当 $H_{1}$ 为真时未能拒绝 $H_{0}$ 的概率为 $\\beta$）的核心定义，以及两个独立样本均值之差的分布出发，推导出一个解析表达式，用于计算在显著性水平为 $\\alpha$ 的双侧检验下，达到 $1-\\beta$ 的统计功效以检测大小为 $\\delta=|\\mu_{1}-\\mu_{2}|$ 的临床有意义差异所需的最小每组样本量 $n$。您的推导必须从样本均值差的分布、显著性水平为 $\\alpha$ 的双侧检验的拒绝域的定义，以及在固定备择假设 $|\\mu_{1}-\\mu_{2}|=\\delta$ 下统计功效的定义开始。\n2. 然后，根据设计值 $\\alpha=0.05$（双侧）、$1-\\beta=0.90$、临床有意义的差异 $\\delta=5$ 和共同方差 $\\sigma^{2}=64$，计算所得的每组样本量 $n$。报告在您推导出的准则下，达到或超过目标统计功效的每组最小整数 $n$。请将此整数作为您的最终答案。不要包含任何单位，也不要四舍五入到指定的有效数字位数；相反，应报告满足要求的确切最小整数 $n$。",
            "solution": "### 第一步：提取已知条件\n- **研究设计**：双臂、平行组、随机对照试验。\n- **分配**：两个独立组，等比例分配，每组样本量为 $n$。\n- **结局**：一个连续变量，假设在每组内独立同分布。\n- **方差**：两组的共同方差为 $\\sigma^{2}$。\n- **假设检验**：针对原假设 $H_{0}:\\ \\mu_{1}-\\mu_{2}=0$ 与备择假设 $H_{1}:\\ \\mu_{1}-\\mu_{2}\\neq 0$ 的双侧双样本 $t$ 检验。\n- **显著性水平**：$\\alpha$。\n- **统计功效**：$1-\\beta$。\n- **效应量**：大小为 $\\delta=|\\mu_{1}-\\mu_{2}|$ 的临床有意义的差异。\n- **近似**：为计划目的，标准化样本均值差的抽样分布可用标准正态分布近似。\n- **推导要求**：推导必须从（1）样本均值差的分布，（2）双侧检验的拒绝域的定义，以及（3）固定备择假设下的统计功效的定义开始。\n- **用于计算的数值**：\n    - 显著性水平 $\\alpha=0.05$（双侧）。\n    - 期望统计功效 $1-\\beta=0.90$。\n    - 临床有意义的差异 $\\delta=5$。\n    - 共同方差 $\\sigma^{2}=64$。\n\n### 第二步：使用提取的已知条件进行验证\n该问题具有科学依据，提法明确且客观。它提出了一个生物统计学和临床试验设计中标准的、基本的问题：为确保足够的统计功效而进行的先验样本量计算。该问题与转化医学中的研究严谨性和可重复性主题直接相关。所有获得唯一解所需的参数和假设都已提供，且没有矛盾之处。在计划阶段使用正态分布近似 $t$ 检验是一种标准且公认的做法，这将推导过程简化为代数运算而非迭代运算。该问题并非微不足道，因为它要求从第一性原理进行推导。\n\n### 第三步：结论与行动\n该问题有效。将提供严谨的解答。\n\n### 第一部分：样本量公式推导\n\n设 $\\bar{X}_1$ 和 $\\bar{X}_2$ 分别为两个独立组（试验组和对照组）的样本均值，每组样本量为 $n$。假设总体均值分别为 $\\mu_1$ 和 $\\mu_2$，共同方差为 $\\sigma^2$。\n\n1.  **样本均值差的分布**：\n    $\\bar{X}_1$ 的均值为 $E[\\bar{X}_1] = \\mu_1$，其方差为 $Var(\\bar{X}_1) = \\frac{\\sigma^2}{n}$。类似地，$E[\\bar{X}_2] = \\mu_2$，其方差为 $Var(\\bar{X}_2) = \\frac{\\sigma^2}{n}$。\n    样本均值之差为 $D = \\bar{X}_1 - \\bar{X}_2$。\n    该差值的期望为 $E[D] = E[\\bar{X}_1] - E[\\bar{X}_2] = \\mu_1 - \\mu_2$。\n    由于两组独立，差值的方差是方差之和：$Var(D) = Var(\\bar{X}_1) + Var(\\bar{X}_2) = \\frac{\\sigma^2}{n} + \\frac{\\sigma^2}{n} = \\frac{2\\sigma^2}{n}$。\n    该差值的标准误为 $SE(D) = \\sqrt{\\frac{2\\sigma^2}{n}}$。\n    根据中心极限定理和问题的明确假设，$D$ 的抽样分布可用正态分布近似：\n    $$D \\sim N\\left(\\mu_1 - \\mu_2, \\frac{2\\sigma^2}{n}\\right)$$\n\n2.  **原假设下的拒绝域**：\n    原假设为 $H_0: \\mu_1 - \\mu_2 = 0$。在 $H_0$ 下，差值的分布为 $D \\sim N\\left(0, \\frac{2\\sigma^2}{n}\\right)$。\n    检验统计量是通过在 $H_0$ 下对 $D$ 进行标准化来构建的：\n    $$Z = \\frac{\\bar{X}_1 - \\bar{X}_2}{SE(D)} = \\frac{\\bar{X}_1 - \\bar{X}_2}{\\sigma\\sqrt{2/n}}$$\n    在 $H_0$ 下，$Z \\sim N(0,1)$。\n    对于显著性水平为 $\\alpha$ 的双侧检验，如果观测到的统计量落在原假设分布的尾部，我们则拒绝 $H_0$。设 $z_{\\alpha/2}$ 为标准正态分布的上 $\\alpha/2$ 分位数，定义为 $P(Z > z_{\\alpha/2}) = \\alpha/2$。根据对称性，$P(Z < -z_{\\alpha/2}) = \\alpha/2$。\n    因此，拒绝域定义为 $|Z| > z_{\\alpha/2}$。用均值差 $D$ 表示，我们在以下情况下拒绝 $H_0$：\n    $$|D| > z_{\\alpha/2} \\sigma\\sqrt{\\frac{2}{n}}$$\n\n3.  **备择假设下的统计功效**：\n    统计功效是在备择假设 $H_1$ 为真时正确拒绝 $H_0$ 的概率。统计功效为 $1-\\beta$。我们考虑一个特定的备择假设，其中真实差异的大小为 $\\delta$，即 $|\\mu_1 - \\mu_2| = \\delta$。不失一般性，我们假设 $\\mu_1 - \\mu_2 = \\delta$，其中 $\\delta > 0$。在此特定备择假设下，样本均值差的分布为 $D \\sim N\\left(\\delta, \\frac{2\\sigma^2}{n}\\right)$。\n    统计功效是给定此备择分布时，$D$ 落入拒绝域的概率：\n    $$1-\\beta = P\\left(|D| > z_{\\alpha/2} \\sigma\\sqrt{\\frac{2}{n}} \\;\\middle|\\; \\mu_1 - \\mu_2 = \\delta\\right)$$\n    $$1-\\beta = P\\left(D > z_{\\alpha/2} \\sigma\\sqrt{\\frac{2}{n}}\\right) + P\\left(D < -z_{\\alpha/2} \\sigma\\sqrt{\\frac{2}{n}}\\right)$$\n    为了计算这些概率，我们在备择假设下对 $D$ 进行标准化。令 $Z' = \\frac{D - \\delta}{\\sigma\\sqrt{2/n}}$，其中 $Z' \\sim N(0,1)$。\n    $$1-\\beta = P\\left(\\frac{D - \\delta}{\\sigma\\sqrt{2/n}} > \\frac{z_{\\alpha/2} \\sigma\\sqrt{2/n} - \\delta}{\\sigma\\sqrt{2/n}}\\right) + P\\left(\\frac{D - \\delta}{\\sigma\\sqrt{2/n}} < \\frac{-z_{\\alpha/2} \\sigma\\sqrt{2/n} - \\delta}{\\sigma\\sqrt{2/n}}\\right)$$\n    $$1-\\beta = P\\left(Z' > z_{\\alpha/2} - \\frac{\\delta}{\\sigma\\sqrt{2/n}}\\right) + P\\left(Z' < -z_{\\alpha/2} - \\frac{\\delta}{\\sigma\\sqrt{2/n}}\\right)$$\n    对于一个有足够统计功效的研究，备择假设下的均值 $\\delta$ 位于原假设分布的右尾足够远的位置，以至于观察到结果落在相反（左）尾的概率可以忽略不计。也就是说，$P\\left(Z' < -z_{\\alpha/2} - \\frac{\\delta}{\\sigma\\sqrt{2/n}}\\right)$ 这一项非常接近于 $0$。我们采用标准近似法：\n    $$1-\\beta \\approx P\\left(Z' > z_{\\alpha/2} - \\frac{\\delta}{\\sigma\\sqrt{2/n}}\\right)$$\n    设 $z_{\\beta}$ 为标准正态分布的上 $\\beta$ 分位数，即 $P(Z' > z_{\\beta}) = \\beta$。根据对称性，$P(Z' > -z_{\\beta}) = 1-\\beta$。为达到 $1-\\beta$ 的统计功效，概率积分的下限必须等于 $-z_{\\beta}$：\n    $$z_{\\alpha/2} - \\frac{\\delta}{\\sigma\\sqrt{2/n}} = -z_{\\beta}$$\n    现在，我们求解每组的样本量 $n$：\n    $$z_{\\alpha/2} + z_{\\beta} = \\frac{\\delta}{\\sigma\\sqrt{2/n}}$$\n    $$\\sqrt{n} = \\frac{\\sigma\\sqrt{2}(z_{\\alpha/2} + z_{\\beta})}{\\delta}$$\n    两边平方，得到 $n$ 的解析表达式：\n    $$n = \\frac{2\\sigma^2(z_{\\alpha/2} + z_{\\beta})^2}{\\delta^2}$$\n    该表达式给出了使用显著性水平为 $\\alpha$ 的双侧检验，以 $1-\\beta$ 的统计功效检测大小为 $\\delta$ 的真实差异所需的每组最小样本量。\n\n### 第二部分：根据具体设计值进行计算\n\n给定：\n- $\\alpha = 0.05$，所以 $\\alpha/2 = 0.025$。对应的临界值为 $z_{0.025} \\approx 1.960$。\n- $1-\\beta = 0.90$，所以 $\\beta = 0.10$。对应的临界值为 $z_{0.10} \\approx 1.282$。\n- $\\delta = 5$。\n- $\\sigma^2 = 64$。\n\n将这些值代入推导出的 $n$ 的公式中：\n$$n = \\frac{2(64)(1.960 + 1.282)^2}{5^2}$$\n$$n = \\frac{128(3.242)^2}{25}$$\n$$n = \\frac{128(10.510564)}{25}$$\n$$n = \\frac{1345.352192}{25}$$\n$$n \\approx 53.814$$\n\n由于样本量 $n$ 必须是整数，且计算出的值代表最低要求，我们必须对该结果向上取整，以确保统计功效至少为 $0.90$。不能招募小数个受试者，而向下取整到 $n=53$ 会导致统计功效略低于 $0.90$ 的目标。\n\n因此，每组所需的最小整数样本量为 54。",
            "answer": "$$\\boxed{54}$$"
        },
        {
            "introduction": "研究的严谨性不仅体现在设计阶段，同样贯穿于执行的全过程。在临床试验中，盲法是防止观察者偏倚的关键保障措施，尤其是在评估主观性结局指标时。当结局评估者知晓受试者所在的分组时，他们可能会（无意识地）对不同组的结局进行系统性地差异化评估，这种偏倚不仅仅是一个定性的担忧，它能对研究结果产生可量化的影响。此实践练习要求你建立一个数学模型来量化这种差异性错分偏倚，并通过编程模拟来具体展示缺乏盲法如何扭曲或夸大治疗效果。通过这个练习，你将具体地看到一个程序上的疏忽如何导致结论上的巨大差异，从而深刻理解在试验操作中坚持严格规程的重要性。",
            "id": "5057005",
            "problem": "在转化医学中，随机对照试验（Randomized Controlled Trial, RCT）需要严格的结果评估，以确保研究的完整性、严谨性和可重复性。考虑一个具有二元临床结局（例如治疗干预成功或失败）的双臂随机对照试验。设治疗臂用 $T$ 表示，对照臂用 $C$ 表示。臂 $g \\in \\{T,C\\}$ 中结局的真实概率用 $p_g$ 表示，其中 $p_g \\in [0,1]$。结局评估者可能以灵敏度 $Se_g \\in [0,1]$ 和特异性 $Sp_g \\in [0,1]$ 对二元结局进行分类，当未设盲时，这些指标在不同臂之间可能存在差异，从而导致差异性错分。本问题中所有的率和概率都必须按0到1之间的小数处理和表示。\n\n仅从灵敏度、特异性、条件概率和全概率定律的基本定义出发，推导在评估者错分情况下各臂预期观察结局概率的解析表达式。利用此结果，推导预期观察风险差和预期观察风险比的表达式，然后定义两种偏倚度量：风险差的加性偏倚，定义为预期观察风险差与真实风险差之差；以及风险比的乘性相对偏倚，定义为预期观察风险比与真实风险比之比。高估效应估计的偏倚对应于增加风险差的加性偏倚，或对于风险比而言，对应于大于1的乘性相对偏倚。\n\n此外，实现一个蒙特卡洛模拟。对于给定的样本量 $n_T$ 和 $n_C$ 以及重复次数 $R$，在每次重复中模拟试验过程如下：使用 $p_T$ 和 $p_C$ 从二项分布中抽取各臂的真实结局数；然后使用 $Se_T$、$Sp_T$、$Se_C$ 和 $Sp_C$ 应用错分以获得观察结局；计算观察到的风险差和风险比；并计算相对于真实效应的重复水平偏倚。对所有重复的重复水平偏倚进行平均，以获得加性偏倚和乘性相对偏倚的蒙特卡洛估计值。在计算比率时，需排除任何分母为0的重复，以确保避免除以零。所有输出必须是无量纲的小数。\n\n您的程序必须为以下参数值的测试套件实现解析偏倚计算和蒙特卡洛偏倚估计。对于每个测试用例，参数以 $(p_T,p_C,Se_T,Sp_T,Se_C,Sp_C,n_T,n_C,R)$ 的形式给出：\n\n- 案例 $1$ （一般差异性错分）：$(0.30,0.20,0.92,0.92,0.85,0.95,2000,2000,4000)$。\n- 案例 $2$ （完美评估，无偏倚）：$(0.30,0.20,1.00,1.00,1.00,1.00,2000,2000,2000)$。\n- 案例 $3$ （非差异性错分）：$(0.30,0.20,0.85,0.85,0.85,0.85,3000,3000,4000)$。\n- 案例 $4$ （罕见结局且治疗组特异性较低）：$(0.08,0.05,0.90,0.80,0.88,0.92,5000,5000,4000)$。\n- 案例 $5$ （极端差异性错分）：$(0.30,0.20,0.60,0.60,0.95,0.95,3000,3000,4000)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。对于每个测试用例，按以下顺序输出四个浮点数：风险差的解析预期加性偏倚、风险比的解析预期乘性相对偏倚、风险差的蒙特卡洛估计加性偏倚，以及风险比的蒙特卡洛估计乘性相对偏倚。将这五个测试用例的四个输出按给定顺序连接起来，因此最终输出应包含20个浮点数，格式为单一列表，如 $[b_{RD,1},RB_{RR,1},\\hat b_{RD,1},\\widehat{RB}_{RR,1},\\dots,b_{RD,5},RB_{RR,5},\\hat b_{RD,5},\\widehat{RB}_{RR,5}]$。",
            "solution": "该问题被评估为有效。它在科学上基于生物统计学和流行病学中关于随机对照试验的原理，问题阐述清晰，目标明确，信息充分，并使用了客观、正式的语言。它没有任何指令中列出的导致无效的缺陷。\n\n### 1. 偏倚表达式的解析推导\n\n本节从基本定义出发，推导风险差的预期加性偏倚和风险比的预期乘性相对偏倚的解析表达式。\n\n设 $g \\in \\{T, C\\}$ 表示试验臂，其中 $T$ 是治疗臂，$C$ 是对照臂。设 $O_g$ 为臂 $g$ 中真实阳性结局（例如，治疗成功）的事件，$\\bar{O}_g$ 为真实阴性结局的事件。真实阳性结局的概率给定为 $p_g = P(O_g)$，这意味着 $P(\\bar{O}_g) = 1 - p_g$。\n\n结局评估并非完美。设 $\\hat{O}_g$ 为观察到阳性结局的事件。评估质量由灵敏度 ($Se_g$) 和特异性 ($Sp_g$) 定义：\n- 灵敏度：$Se_g = P(\\hat{O}_g | O_g)$，即在真实阳性结局条件下观察到阳性结局的概率。\n- 特异性：$Sp_g = P(\\bar{\\hat{O}}_g | \\bar{O}_g)$，即在真实阴性结局条件下观察到阴性结局的概率。\n\n根据特异性的定义，我们可以得出假陽性的概率，即在真实阴性结局条件下观察到阳性结局的概率：\n$$P(\\hat{O}_g | \\bar{O}_g) = 1 - P(\\bar{\\hat{O}}_g | \\bar{O}_g) = 1 - Sp_g$$\n\n臂 $g$ 中预期的观察结局概率，记为 $\\hat{p}_g = P(\\hat{O}_g)$，可以使用全概率定律推导得出：\n$$\\hat{p}_g = P(\\hat{O}_g) = P(\\hat{O}_g | O_g)P(O_g) + P(\\hat{O}_g | \\bar{O}_g)P(\\bar{O}_g)$$\n代入已定义的术语，我们得到臂 $g$ 中观察概率的表达式：\n$$\\hat{p}_g = (Se_g)(p_g) + (1 - Sp_g)(1 - p_g)$$\n该表达式可以重排以显示线性关系：$\\hat{p}_g = (Se_g + Sp_g - 1)p_g + (1 - Sp_g)$。\n\n在此基础上，我们可以定义真实和预期的观察效应度量，并随后定义偏倚项。\n\n**风险差 (RD)**\n- 真实风险差：$RD_{true} = p_T - p_C$\n- 预期观察风险差：$E[RD_{obs}] = \\hat{p}_T - \\hat{p}_C$\n- 风险差的加性偏倚 ($b_{RD}$): 这是预期观察风险差与真实风险差之间的差值。\n$$b_{RD} = E[RD_{obs}] - RD_{true} = (\\hat{p}_T - \\hat{p}_C) - (p_T - p_C)$$\n\n**风险比 (RR)**\n- 真实风险比：$RR_{true} = p_T / p_C$ (假设 $p_C > 0$)\n- 预期观察风险比：$E[RR_{obs}] = \\hat{p}_T / \\hat{p}_C$ (假设 $\\hat{p}_C > 0$)\n- 风险比的乘性相对偏倚 ($RB_{RR}$): 这是预期观察风险比与真实风险比之比。\n$$RB_{RR} = \\frac{E[RR_{obs}]}{RR_{true}} = \\frac{\\hat{p}_T / \\hat{p}_C}{p_T / p_C}$$\n\n这些解析表达式允许在给定真实概率和评估者性能特征的情况下，直接计算预期偏倚。\n\n### 2. 蒙特卡洛模拟方法\n\n蒙特卡洛模拟通过对大量重复（$R$ 次）的试验随机过程进行建模来估计偏倚。对于每次重复，模拟遵循以下步骤：\n\n1.  **模拟真实结局**：对于样本量为 $n_g$、真实结局概率为 $p_g$ 的每个臂 $g \\in \\{T,C\\}$，真实阳性结局数 $k_g$ 从二项分布中抽取：\n    $$k_g \\sim \\text{Binomial}(n_g, p_g)$$\n    那么真实阴性结局的数量是 $n_g - k_g$。\n\n2.  **模拟结局错分**：对于每个臂 $g$，通过模拟真实阳性和真实阴性的分类过程来确定观察到的阳性结局数：\n    - 正确识别的真实阳性数 ($TP_g$)：$TP_g \\sim \\text{Binomial}(k_g, Se_g)$。\n    - 错误识别的真实阴性数（假阳性，$FP_g$)：$FP_g \\sim \\text{Binomial}(n_g - k_g, 1 - Sp_g)$。\n    该次重复中臂 $g$ 的观察阳性结局总数为 $\\hat{k}_g = TP_g + FP_g$。\n\n3.  **计算重复水平的观察效应**：该次重复的观察结局概率为 $\\hat{p}_{T} = \\hat{k}_T / n_T$ 和 $\\hat{p}_{C} = \\hat{k}_C / n_C$。该次重复的观察效应度量为：\n    - 观察风险差：$RD_{obs} = \\hat{p}_T - \\hat{p}_C$。\n    - 观察风险比：$RR_{obs} = \\hat{p}_T / \\hat{p}_C$。仅当 $\\hat{k}_C > 0$ 时才执行此计算，以避免除以零。\n\n4.  **计算重复水平的偏倚**：该次重复的偏倚是相对于真实效应度量计算的：\n    - 加性偏倚：$b_{RD,i} = RD_{obs,i} - RD_{true}$。\n    - 乘性相对偏倚：$RB_{RR,i} = RR_{obs,i} / RR_{true}$。仅对 $RR_{obs,i}$ 有效的重复进行计算。\n\n5.  **平均偏倚**：完成所有 $R$ 次重复后，偏倚的蒙特卡洛估计值是重复水平偏倚的平均值。\n    - 估计的加性偏倚：$\\hat{b}_{RD} = \\frac{1}{R} \\sum_{i=1}^{R} b_{RD,i}$。\n    - 估计的乘性相对偏倚：$\\widehat{RB}_{RR} = \\frac{1}{R'} \\sum_{i \\in \\text{valid}} RB_{RR,i}$，其中 $R'$ 是 $RR_{obs,i}$ 可计算的重复次数。\n\n此模拟过程提供了偏倚的经验估计，当 $R \\to \\infty$ 时，该估计收敛于解析推导的期望值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates analytic and Monte Carlo estimates of bias in a two-arm RCT\n    with differential outcome misclassification for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Parameters: (p_T, p_C, Se_T, Sp_T, Se_C, Sp_C, n_T, n_C, R)\n    test_cases = [\n        (0.30, 0.20, 0.92, 0.92, 0.85, 0.95, 2000, 2000, 4000), # Case 1\n        (0.30, 0.20, 1.00, 1.00, 1.00, 1.00, 2000, 2000, 2000), # Case 2\n        (0.30, 0.20, 0.85, 0.85, 0.85, 0.85, 3000, 3000, 4000), # Case 3\n        (0.08, 0.05, 0.90, 0.80, 0.88, 0.92, 5000, 5000, 4000), # Case 4\n        (0.30, 0.20, 0.60, 0.60, 0.95, 0.95, 3000, 3000, 4000), # Case 5\n    ]\n\n    all_results = []\n    # Use a seeded random number generator for reproducibility\n    rng = np.random.default_rng(seed=42)\n\n    for case in test_cases:\n        p_T, p_C, Se_T, Sp_T, Se_C, Sp_C, n_T, n_C, R = case\n\n        # --- Analytic Bias Calculation ---\n        \n        # Expected observed outcome probabilities\n        p_hat_T = Se_T * p_T + (1 - Sp_T) * (1 - p_T)\n        p_hat_C = Se_C * p_C + (1 - Sp_C) * (1 - p_C)\n\n        # True effect measures\n        rd_true = p_T - p_C\n        rr_true = p_T / p_C if p_C > 0 else np.nan\n\n        # Expected observed effect measures\n        rd_obs_exp = p_hat_T - p_hat_C\n        rr_obs_exp = p_hat_T / p_hat_C if p_hat_C > 0 else np.nan\n\n        # Analytic bias measures\n        analytic_additive_bias = rd_obs_exp - rd_true\n        analytic_mult_rel_bias = rr_obs_exp / rr_true if rr_true > 0 and not np.isnan(rr_true) else np.nan\n\n        # --- Monte Carlo Simulation ---\n        \n        # Vectorized simulation for efficiency\n        # Step 1: Simulate true outcomes for all R replicates\n        k_T_reps = rng.binomial(n_T, p_T, size=R)\n        k_C_reps = rng.binomial(n_C, p_C, size=R)\n\n        # Step 2: Simulate misclassification\n        # Treatment arm\n        tp_T_reps = rng.binomial(k_T_reps, Se_T)\n        fp_T_reps = rng.binomial(n_T - k_T_reps, 1 - Sp_T)\n        k_hat_T_reps = tp_T_reps + fp_T_reps\n        \n        # Control arm\n        tp_C_reps = rng.binomial(k_C_reps, Se_C)\n        fp_C_reps = rng.binomial(n_C - k_C_reps, 1 - Sp_C)\n        k_hat_C_reps = tp_C_reps + fp_C_reps\n\n        # Step 3  4: Compute replicate-level biases\n        # Observed probabilities\n        p_hat_T_reps = k_hat_T_reps / n_T\n        p_hat_C_reps = k_hat_C_reps / n_C\n        \n        # Additive bias on Risk Difference\n        rd_obs_reps = p_hat_T_reps - p_hat_C_reps\n        replicate_additive_biases = rd_obs_reps - rd_true\n        \n        # Multiplicative relative bias on Risk Ratio\n        # Filter out replicates where the denominator (observed control rate) is zero\n        valid_rr_mask = k_hat_C_reps > 0\n        \n        # Avoid division by zero for rr_true as well (though not an issue with test data)\n        if rr_true > 0 and not np.isnan(rr_true) and np.any(valid_rr_mask):\n            p_hat_T_valid = p_hat_T_reps[valid_rr_mask]\n            p_hat_C_valid = p_hat_C_reps[valid_rr_mask]\n            rr_obs_valid_reps = p_hat_T_valid / p_hat_C_valid\n            replicate_mult_rel_biases = rr_obs_valid_reps / rr_true\n            mc_mult_rel_bias = np.mean(replicate_mult_rel_biases)\n        else:\n            mc_mult_rel_bias = np.nan # Or other placeholder if all replicates invalid\n\n        # Step 5: Average biases\n        mc_additive_bias = np.mean(replicate_additive_biases)\n        \n        all_results.extend([\n            analytic_additive_bias, \n            analytic_mult_rel_bias, \n            mc_additive_bias, \n            mc_mult_rel_bias\n        ])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in all_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "随着高维组学数据在转化医学中的广泛应用，机器学习模型已成为发现生物标志物和预测治疗反应的重要工具。然而，计算分析流程中的一个微小失误就可能导致结果完全不可复现。“数据泄露”（Data Leakage）就是这样一个常见且隐蔽的陷阱，它会导致模型性能被过度高估，使其在新的、独立的外部数据上表现不佳。本练习模拟了一个典型的生物信息学场景：在交叉验证之前对整个数据集进行标准化。你将需要诊断这个流程中的问题，并设计一个修正方案，以确保用于评估模型的测试数据在整个模型训练过程（包括预处理步骤）中始终保持“未知”。这个练习旨在培养你对数据分析流程的批判性思维，这是确保计算结果可重复性的关键一步。",
            "id": "5057006",
            "problem": "一个转化医学团队正在构建一个分类器，以根据从$n$名患者收集的基线多组学特征 ($x \\in \\mathbb{R}^p$) 来预测治疗反应 ($y \\in \\{0,1\\}$)。他们打算使用$k$折交叉验证（CV）来评估泛化性能。在每一折中，模型$f_i$在训练子集$S_i^{\\text{train}}$上进行训练，并在留出的测试子集$S_i^{\\text{test}}$上进行评估。在创建折之前，该团队使用变换$T_{\\hat{\\theta}}(x) = (x - \\hat{\\mu}) / \\hat{\\sigma}$对所有$n$名患者的每个特征进行标准化，其中$\\hat{\\mu}$和$\\hat{\\sigma}$是在整个数据集$D$上计算的样本均值和标准差。然后，他们对标准化后的数据执行交叉验证。\n\n请根据以下基本定义和经过充分检验的事实，从第一性原理出发，回答下面的诊断与设计问题：\n- 期望损失$R = \\mathbb{E}_{(X,Y) \\sim P}[\\ell(f(X),Y)]$的交叉验证估计量$\\hat{R}_{\\text{CV}}$依赖于测试数据与训练过程的独立性：对于第$i$折， $S_i^{\\text{test}}$必须被排除在任何用于推导$f_i$所用参数的操作之外。\n- 如果参数$\\theta$是从数据中估计的，那么带有参数$\\theta$的、依赖于数据的预处理变换$T_{\\theta}$就是训练过程的一部分。\n- 在转化医学中，重复测量或共享的批次效应可能会在样本之间引入依赖性；要保持独立性，就要求任何估计步骤都不能使用来自第$i$折的$S_i^{\\text{test}}$中的信息。\n\n哪个选项正确地诊断了问题，并指定了一个能保持测试折独立性的修正工作流程？\n\nA. 存在数据泄露，因为$\\hat{\\mu}$和$\\hat{\\sigma}$是使用所有$n$名患者的数据估计的，这通过$T_{\\hat{\\theta}}$将$S_i^{\\text{test}}$与$S_i^{\\text{train}}$耦合在了一起。修正后的工作流程是：对于每一折$i$，仅使用$S_i^{\\text{train}}$来拟合$\\hat{\\mu}_{\\text{train},i}$和$\\hat{\\sigma}_{\\text{train},i}$，用$T_{\\hat{\\theta}_{\\text{train},i}}$变换$S_i^{\\text{train}}$和$S_i^{\\text{test}}$，在变换后的$S_i^{\\text{train}}$上训练$f_i$，并在变换后的$S_i^{\\text{test}}$上进行评估。如果需要调整超参数，则在$S_i^{\\text{train}}$内部执行嵌套交叉验证，并在每个内部划分中重新拟合缩放器。\n\nB. 不存在泄露，因为标准化是无监督的（不使用$y$），并且逐特征的标准化是单调变换；因此，在交叉验证之前全局应用$T_{\\hat{\\theta}}$是可以接受的。\n\nC. 存在潜在泄露，但可以通过在全局标准化后对标签$y$进行混洗，然后计算受试者工作特征曲线下面积（AUROC）来消除；混洗消除了$T_{\\hat{\\theta}}$和测试折之间的依赖性。\n\nD. 存在数据泄露，但修正后的工作流程是为避免偏差，在每一折中仅使用$S_i^{\\text{test}}$计算$\\hat{\\mu}$和$\\hat{\\sigma}$，然后在训练和评估之前，使用这些从测试集派生的参数来变换$S_i^{\\text{train}}$和$S_i^{\\text{test}}$。\n\nE. 存在数据泄露，但可以通过对整个数据集进行标准化，然后执行留一特征交叉验证来缓解，这样每个模型都不会一次性看到所有特征；这可以在不改变标准化策略的情况下保持测试折的独立性。",
            "solution": "问题要求识别所提出的交叉验证（CV）流程中的方法论缺陷，并指定正确的工作流程。问题的核心在于评估预测模型的泛化性能，这要求交叉验证每一折中的测试数据在训练过程中完全不被看到。\n\n**1. 问题验证**\n\n问题陈述是有效的。它描述了机器学习流程中一个常见且关键的错误，称为数据泄露或信息泄露。所提供的关于交叉验证估计量、依赖于数据的变换的性质以及转化医学中独立性重要性的定义在科学上是合理的，并构成了进行推理的一致基础。该问题提法得当、客观，并与科学研究中的严谨性和可重复性原则直接相关。\n\n**2. 对所提工作流程的分析**\n\n既定目标是使用$k$折交叉验证来估计期望损失$R = \\mathbb{E}_{(X,Y) \\sim P}[\\ell(f(X),Y)]$。交叉验证的基本原则是在独立于训练数据的数据上，评估一个完整学习流程的性能。\n\n提出的工作流程是：\n1.  使用数据集$D$中所有$n$名患者的数据，为每个特征计算样本均值$\\hat{\\mu}$和样本标准差$\\hat{\\sigma}$。设这些参数为$\\hat{\\theta} = (\\hat{\\mu}, \\hat{\\sigma})$。\n2.  使用变换$T_{\\hat{\\theta}}(x) = (x - \\hat{\\mu}) / \\hat{\\sigma}$对整个数据集$D$进行变换。\n3.  对这个预先变换过的数据集执行$k$折交叉验证。\n\n让我们分析单一一折$i$的这个过程。数据集被划分为训练集$S_i^{\\text{train}}$和测试集$S_i^{\\text{test}}$。变换参数$\\hat{\\theta}$是使用所有$n$名患者的数据计算的，这意味着$\\hat{\\theta}$是同时使用了$S_i^{\\text{train}}$和$S_i^{\\text{test}}$中的数据计算得出的。\n\n问题陈述指出，“如果参数$\\theta$是从数据中估计的，那么带有参数$\\theta$的、依赖于数据的预处理变换$T_{\\theta}$就是训练过程的一部分。” 在本例中，标准化是一个依赖于数据的变换，其参数$\\hat{\\theta}$是从数据中估计的。\n\n问题还提出了一个关键要求：“对于第$i$折， $S_i^{\\text{test}}$必须被排除在任何用于推导$f_i$所用参数的操作之外。” 模型$f_i$是在经过$T_{\\hat{\\theta}}$变换的数据上训练的。因为参数$\\hat{\\theta}$依赖于$S_i^{\\text{test}}$，所以用于训练$f_i$的数据不再独立于测试集。来自测试集的信息已经“泄露”到了训练过程中。这违反了交叉验证的核心假设，导致对泛化性能的评估产生过于乐观的偏差。实际上，模型已经“窥探”到了测试数据的统计特性。\n\n**3. 修正后的工作流程**\n\n为确保测试集的独立性，对于每一折，整个学习流程（包括任何依赖于数据的预处理）都必须*仅*在训练数据上进行拟合。然后，测试集应被视为全新的、未见过的数据，并将完整拟合的流程应用于其上。\n\n对于每一折$i$（$i \\in \\{1, \\dots, k\\}$），修正后的工作流程应为：\n1.  将原始、未变换的数据集$D$划分为$S_i^{\\text{train}}$和$S_i^{\\text{test}}$。\n2.  *仅*使用$S_i^{\\text{train}}$中的数据来估计预处理参数$\\hat{\\theta}_{\\text{train},i} = (\\hat{\\mu}_{\\text{train},i}, \\hat{\\sigma}_{\\text{train},i})$。\n3.  将学习到的变换$T_{\\hat{\\theta}_{\\text{train},i}}$应用于训练数据和测试数据*两者*。这会创建一个变换后的训练集和一个变换后的测试集。\n4.  在变换后的训练集上训练分类器$f_i$。\n5.  在变换后的测试集上评估$f_i$。\n\n对所有$k$折重复此过程，并对性能指标取平均值。这确保了对于每一折，测试集都完全不参与模型构建过程的每一步，包括缩放参数的估计。\n\n**4. 选项评估**\n\n**A. 存在数据泄露，因为$\\hat{\\mu}$和$\\hat{\\sigma}$是使用所有$n$名患者的数据估计的，这通过$T_{\\hat{\\theta}}$将$S_i^{\\text{test}}$与$S_i^{\\text{train}}$耦合在了一起。修正后的工作流程是：对于每一折$i$，仅使用$S_i^{\\text{train}}$来拟合$\\hat{\\mu}_{\\text{train},i}$和$\\hat{\\sigma}_{\\text{train},i}$，用$T_{\\hat{\\theta}_{\\text{train},i}}$变换$S_i^{\\text{train}}$和$S_i^{\\text{test}}$，在变换后的$S_i^{\\text{train}}$上训练$f_i$，并在变换后的$S_i^{\\text{test}}$上进行评估。如果需要调整超参数，则在$S_i^{\\text{train}}$内部执行嵌套交叉验证，并在每个内部划分中重新拟合缩放器。**\n此选项正确地诊断了问题，即全局标准化导致的数据泄露。其提出的修正方案与上述推导出的原则完全一致：缩放器在每一折的训练数据上拟合，并应用于两个数据划分。提及嵌套交叉验证和在内部循环中重新拟合缩放器也是正确的，因为它将防止泄露的原则扩展到了超参数选择阶段。\n**结论：正确。**\n\n**B. 不存在泄露，因为标准化是无监督的（不使用$y$），并且逐特征的标准化是单调变换；因此，在交叉验证之前全局应用$T_{\\hat{\\theta}}$是可以接受的。**\n这是不正确的。有监督方法和无监督方法之间的区别不是判断数据泄露的决定性因素。当来自测试集的信息影响了训练过程时，泄露就会发生。在这里，来自测试集的特征统计量（$\\hat{\\mu}, \\hat{\\sigma}$）被用来定义应用于训练集的变换。变换的单调性也与违反测试集独立性无关。\n**结论：不正确。**\n\n**C. 存在潜在泄露，但可以通过在全局标准化后对标签$y$进行混洗，然后计算受试者工作特征曲线下面积（AUROC）来消除；混洗消除了$T_{\\hat{\\theta}}$和测试折之间的依赖性。**\n这是不正确的。混洗标签是一种用于置换检验的技术，旨在评估结果的统计显著性，而不是用来纠正数据泄露。此问题中的泄露是通过特征（$x$）发生的，而不是标签（$y$）。混洗标签会破坏特征与结果之间的真实关系，所得的性能指标将评估模型在随机数据上的性能，而不是其真实的泛化性能。它没有修复原始的缺陷。\n**结论：不正确。**\n\n**D. 存在数据泄露，但修正后的工作流程是为避免偏差，在每一折中仅使用$S_i^{\\text{test}}$计算$\\hat{\\mu}$和$\\hat{\\sigma}$，然后在训练和评估之前，使用这些从测试集派生的参数来变换$S_i^{\\text{train}}$和$S_i^{\\text{test}}$。**\n这是不正确的。虽然它正确地识别了泄露，但所提出的解决方案存在根本性缺陷。它建议在测试数据上拟合缩放器。这是一种极端形式的数据泄露。训练过程应该模拟从可用数据中学习，以预测未来的、未见过的数据。人们永远无法获知未来数据的统计特性。训练流程必须完全从训练集中派生。\n**结论：不正确。**\n\n**E. 存在数据泄露，但可以通过对整个数据集进行标准化，然后执行留一特征交叉验证来缓解，这样每个模型都不会一次性看到所有特征；这可以在不改变标准化策略的情况下保持测试折的独立性。**\n这是不正确的。“留一特征交叉验证”的概念不是解决基于样本的数据泄露的标准方法。数据泄露是关于来自*测试样本*（患者）的信息影响模型训练，而不是关于使用了哪些*特征*。即使排除了某些特征，剩余特征的标准化参数仍然是使用所有$n$个样本计算的，因此泄露依然存在。测试*折*（样本子集）的独立性没有得到保持。\n**结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}