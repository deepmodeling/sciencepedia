{
    "hands_on_practices": [
        {
            "introduction": "在功能基因组学中，合并式CRISPR筛选是识别新药物靶点的强大工具。然而，实验的成功与否取决于严谨的设计，以确保能够从复杂的细胞群体中获得清晰、可重复的信号。本练习  将引导您思考设计一次成功的筛选实验所需的关键定量参数，例如感染复数（MOI）和文库覆盖度，并理解这些参数如何影响统计功效和结果的偏差。",
            "id": "5066651",
            "problem": "一项混合文库的成簇规律间隔短回文重复序列（CRISPR）功能缺失筛选旨在鉴定一个肿瘤细胞系中的必需基因。一个慢病毒单导向RNA（sgRNA）文库包含 $L = 10^5$ 个不同的sgRNA，靶向推定的必需基因和非必需基因。细胞被感染，然后进行抗生素筛选、传代和存活率读出。假设以下基本前提：(i) 病毒进入细胞的事件是独立发生的，可以建模为泊松过程；(ii) 抗生素筛选会去除没有功能性整合的细胞；(iii) 筛选过程中最窄的群体瓶颈决定了有多少个独特的sgRNA能有效贡献信号给下游的下一代测序（NGS）计数。将感染复数（MOI）定义为感染过程的一个属性，将文库覆盖度定义为文库在细胞群体中代表性的一个属性。\n\n设计目标是在最大化检测靶向必需基因的sgRNA耗尽的统计功效的同时，最小化来自含有多个导向RNA细胞的偏倚和代表性丢失。一个团队考虑以 $m = 0.3$ 的MOI进行感染，并估计筛选后瓶颈（例如，药物筛选、传代、取样）的综合效应会将存活的可分析细胞数量减少到初始接种群体数量的 $f = 0.5$。他们要求在最窄瓶颈处，每个sgRNA的最终最低覆盖度为 $C_{\\min} = 500$ 个细胞。\n\n哪个选项正确地定义了混合文库CRISPR筛选中的MOI和文库覆盖度，正确地推断了MOI和覆盖度对鉴定必需靶点的统计功效和偏倚的影响，并正确地计算了上述假设所暗示的关键数量？\n\nA. MOI是在泊松感染下每个细胞的平均病毒整合数，而文库覆盖度是在最窄瓶颈处仍然对表型有贡献的每个sgRNA的平均细胞数。在MOI为 $m = 0.3$ 时，所有细胞中恰好有一次整合的细胞比例约为 $m e^{-m} \\approx 0.22$，而在受感染的细胞中，有多次整合的细胞比例约为 $\\dfrac{1 - e^{-m}(1+m)}{1 - e^{-m}} \\approx 0.14$。降低MOI会减少多sgRNA偏倚，但会增加未感染细胞的比例，这必须通过增加起始细胞数量来补偿以维持覆盖度。为确保在 $L = 10^5$ 和 $f = 0.5$ 的条件下 $C_{\\min} = 500$，最小起始细胞群体为 $N_0 \\ge \\dfrac{L \\, C_{\\min}}{(1 - e^{-m}) \\, f} \\approx 3.9 \\times 10^8$ 个细胞。更高的覆盖度会降低抽样方差，并增加检测sgRNA耗尽的统计功效。\n\nB. MOI是受感染细胞的比例，文库覆盖度是每个sgRNA的NGS读数。在MOI为 $m = 0.3$ 时，恰好有 $30\\%$ 的细胞被感染，因此多次感染可以忽略不计。更高的MOI总是能在不引入偏倚的情况下增加统计功效，因为有更多的细胞携带sgRNA。达到 $C_{\\min} = 500$ 的最小起始细胞数为 $N_0 \\ge L \\, C_{\\min} \\, f \\approx 2.5 \\times 10^7$ 个细胞。\n\nC. MOI是每个细胞的平均病毒整合数，覆盖度是筛选后每个sgRNA的受感染细胞数。在MOI为 $m = 0.3$ 时，受感染细胞中有多重整合的比例约为 $1 - e^{-m}(1+m) \\approx 0.037$，这个数值小到可以忽略。为达到 $C_{\\min} = 500$，我们需要 $N_0 \\ge \\dfrac{L \\, C_{\\min}}{f} \\approx 1.0 \\times 10^8$ 个细胞，因为只有筛选后的瓶颈对覆盖度有影响。增加覆盖度会降低检测强效应的统计功效，因为更多的细胞会稀释表型。\n\nD. MOI是每个细胞加入的病毒颗粒数，覆盖度是文库克隆过程中每个sgRNA的质粒菌落数。MOI为 $m = 2$ 可以确保几乎每个细胞都获得至少一个sgRNA，从而最小化偏倚。多次感染可以建模为概率为 $p = m/(1+m)$ 的二项过程，因此多次感染率为 $p^2$。对于 $L = 10^5$ 和 $C_{\\min} = 500$，所需的起始细胞数为 $N_0 \\ge L \\, C_{\\min} = 5 \\times 10^7$，这与筛选损失无关，因为筛选只去除未感染的细胞。",
            "solution": "用户希望我验证并解决一个关于混合文库CRISPR筛选实验设计的问题。\n\n### 第1步：提取已知条件\n- 实验类型：混合文库成簇规律间隔短回文重复序列（CRISPR）功能缺失筛选。\n- 目标：鉴定一个肿瘤细胞系中的必需基因。\n- 文库大小：$L = 10^5$ 个不同的单导向RNA（sgRNA）。\n- 过程模型：\n    - (i) 病毒进入是泊松过程。\n    - (ii) 抗生素筛选去除零功能性整合的细胞。\n    - (iii) 最窄的群体瓶颈决定了有效的sgRNA代表性。\n- 待定义的术语：感染复数（MOI）和文库覆盖度。\n- 设计参数：\n    - 建议的MOI：$m = 0.3$。\n    - 筛选后存活分数：$f = 0.5$（相对于初始接种群体）。\n    - 要求的最终最低覆盖度：$C_{\\min} = 500$ 个细胞/sgRNA。\n\n### 第2步：使用提取的已知条件进行验证\n问题陈述描述了功能基因组学中的一个标准情景。\n- **科学依据：**整个前提都基于已建立的、用于执行和分析混合文库CRISPR筛选的标准程序。慢病毒文库的使用、MOI的概念、感染的泊松模型、抗生素筛选、群体瓶颈，以及多次感染偏倚与筛选覆盖度之间的权衡，都是该领域基本且正确的原则。数值（$L = 10^5$，$m = 0.3$，$C_{\\min} = 500$）对于现代筛选来说非常现实。该问题属于*转化医学*中*使用遗传和功能基因组学方法进行靶点鉴定*这一特定主题。\n- **适定性：**该问题提供了定义术语、执行计算和评估选项中逻辑陈述所需的所有数据和假设。问题是明确的。\n- **客观性：**语言是技术性的，没有主观或基于观点的陈述。\n\n### 第3步：结论与行动\n问题有效。它在科学上是合理的，适定的，也是客观的。我将继续推导解决方案并评估选项。\n\n### 原理和计算推导\n\n**1. 定义与泊松模型**\n- **感染复数（MOI）：** 在一个建模为泊松过程的混合病毒文库感染的背景下，MOI（用 $m$ 表示）是该分布的均值。它代表每个细胞的功能性病毒整合的平均数。它是控制sgRNA在细胞中分布的关键参数。\n- **文库覆盖度：** 在此背景下，文库覆盖度指的是包含特定sgRNA并存活到实验最窄群体瓶颈的细胞的平均数量。这个瓶颈决定了筛选的统计功效，因为它设定了每个sgRNA的抽样深度。\n- **泊松分布：** 一个给定细胞接收到恰好 $k$ 次功能性病毒整合的概率 $P(k)$ 由泊松公式给出：\n$$P(k) = \\frac{e^{-m} m^k}{k!}$$\n给定 $m = 0.3$：\n- 未感染细胞的比例（$k=0$）：$P(0) = \\frac{e^{-0.3} (0.3)^0}{0!} = e^{-0.3} \\approx 0.7408$。这些细胞会被抗生素筛选淘汰。\n- 具有单次整合的细胞比例（$k=1$）：$P(1) = \\frac{e^{-0.3} (0.3)^1}{1!} = 0.3 e^{-0.3} \\approx 0.3 \\times 0.7408 \\approx 0.2222$。这是实现明确表型-基因型关联的理想群体。\n- 具有多次整合的细胞比例（$k \\ge 2$）：$P(k \\ge 2) = 1 - P(0) - P(1) = 1 - e^{-0.3} - 0.3 e^{-0.3} = 1 - e^{-0.3}(1+0.3) \\approx 1 - 0.7408 \\times 1.3 \\approx 1 - 0.96304 = 0.03696$。\n\n**2. 偏倚、统计功效和MOI权衡**\n- **偏倚：** 含有多个导向RNA的细胞（那些具有 $k \\ge 2$ 次整合的细胞）是偏倚的来源。如果一个含有两个sgRNA的细胞死亡，无法确定是哪个sgRNA导致了致死表型。选择低MOI是为了最小化这类细胞的比例。\n- **受感染细胞中的多次感染率：** *所有*细胞中受感染的比例是 $P(k \\ge 1) = 1 - P(0) = 1 - e^{-m}$。*受感染*的细胞中含有多个导向RNA的比例是一个条件概率：\n$$P(k \\ge 2 | k \\ge 1) = \\frac{P(k \\ge 2 \\cap k \\ge 1)}{P(k \\ge 1)} = \\frac{P(k \\ge 2)}{P(k \\ge 1)} = \\frac{1 - e^{-m}(1+m)}{1 - e^{-m}}$$\n对于 $m=0.3$：\n$$P(k \\ge 2 | k \\ge 1) \\approx \\frac{0.03696}{1 - 0.7408} = \\frac{0.03696}{0.2592} \\approx 0.1426$$\n因此，大约 $14.3\\%$ 的在抗生素筛选后存活的细胞会含有多个sgRNA。\n- **统计功效：** 检测基因必需性（相应sgRNA的耗尽）的统计功效取决于区分真实信号与抽样噪声的能力。更高的文库覆盖度（$C$）会减少sgRNA计数的方差，从而增加统计功效。降低MOI需要从更多的细胞开始，以获得相同数量的*受感染*细胞，从而维持覆盖度。\n\n**3. 初始细胞数（$N_0$）的计算**\n- 独特的sgRNA总数为 $L = 10^5$。\n- 瓶颈处所需的最低覆盖度为 $C_{\\min} = 500$ 个细胞/sgRNA。\n- 最窄瓶颈处所需的细胞总数为 $N_{\\text{bottleneck}} = L \\times C_{\\min} = 10^5 \\times 500 = 5 \\times 10^7$ 个细胞。\n- 这个瓶颈群体是从初始群体 $N_0$ 开始经过一系列损失事件的结果。\n- 首先，一部分比例为 $(1 - e^{-m})$ 的细胞成功感染并在抗生素筛选中存活下来。群体数量变为 $N_0 (1 - e^{-m})$。\n- 其次，其他过程（传代等）导致进一步的细胞损失，由存活分数 $f = 0.5$ 代表。选项A的问题陈述提出了一个序贯损失模型，这是最严谨的解释：瓶颈处的群体数量是 $N_0 \\times (1-e^{-m}) \\times f$。\n- 我们必须满足条件：$N_{\\text{bottleneck}} \\le N_0 (1-e^{-m}) f$。\n- 为了找到最小起始群体数量，我们将其设为等式并求解 $N_0$：\n$$N_0 = \\frac{N_{\\text{bottleneck}}}{(1-e^{-m})f} = \\frac{L C_{\\min}}{(1-e^{-m})f}$$\n- 代入数值：\n$$N_0 = \\frac{5 \\times 10^7}{(1 - e^{-0.3}) \\times 0.5} \\approx \\frac{5 \\times 10^7}{0.2592 \\times 0.5} = \\frac{5 \\times 10^7}{0.1296} \\approx 3.858 \\times 10^8$$\n这大约是 $3.9 \\times 10^8$ 个细胞。\n\n### 逐项分析\n\n**A. MOI是在泊松感染下每个细胞的平均病毒整合数，而文库覆盖度是在最窄瓶颈处仍然对表型有贡献的每个sgRNA的平均细胞数。在MOI为 $m = 0.3$ 时，所有细胞中恰好有一次整合的细胞比例约为 $m e^{-m} \\approx 0.22$，而在受感染的细胞中，有多次整合的细胞比例约为 $\\dfrac{1 - e^{-m}(1+m)}{1 - e^{-m}} \\approx 0.14$。降低MOI会减少多sgRNA偏倚，但会增加未感染细胞的比例，这必须通过增加起始细胞数量来补偿以维持覆盖度。为确保在 $L = 10^5$ 和 $f = 0.5$ 的条件下 $C_{\\min} = 500$，最小起始细胞群体为 $N_0 \\ge \\dfrac{L \\, C_{\\min}}{(1 - e^{-m}) \\, f} \\approx 3.9 \\times 10^8$ 个细胞。更高的覆盖度会降低抽样方差，并增加检测sgRNA耗尽的统计功效。**\n- MOI和覆盖度的定义正确且精确。\n- 单次整合细胞比例的计算（$P(1) = 0.3e^{-0.3} \\approx 0.22$）是正确的。\n- *受感染*细胞中多次整合比例的计算（$P(k \\ge 2 | k \\ge 1) \\approx 0.14$）是正确的。\n- 关于MOI权衡（偏倚 vs. 细胞数）的推理是正确的。\n- 起始细胞数 $N_0$ 的公式基于一个合理的序贯损失模型，并且计算得出了正确的值（$\\approx 3.9 \\times 10^8$）。\n- 关于覆盖度、抽样方差和统计功效的最终陈述是正确的。\n- **结论：正确。**\n\n**B. MOI是受感染细胞的比例，文库覆盖度是每个sgRNA的NGS读数。在MOI为 $m = 0.3$ 时，恰好有 $30\\%$ 的细胞被感染，因此多次感染可以忽略不计。更高的MOI总是能在不引入偏倚的情况下增加统计功效，因为有更多的细胞携带sgRNA。达到 $C_{\\min} = 500$ 的最小起始细胞数为 $N_0 \\ge L \\, C_{\\min} \\, f \\approx 2.5 \\times 10^7$ 个细胞。**\n- MOI的定义不正确。受感染细胞的比例是 $1 - e^{-m}$。\n- 覆盖度的定义不精确；覆盖度指的是细胞，而不是读数，尽管它们是相关的。\n- 声称在 $m=0.3$ 时，有 $30\\%$ 的细胞被感染是不正确的。实际比例是 $1 - e^{-0.3} \\approx 26\\%$。\n- 更高的MOI不引入偏倚的说法是根本错误的；它是偏倚的一个主要来源。\n- $N_0$ 的计算基于一个错误的公式，该公式忽略了未感染细胞的比例。\n- **结论：错误。**\n\n**C. MOI是每个细胞的平均病毒整合数，覆盖度是筛选后每个sgRNA的受感染细胞数。在MOI为 $m = 0.3$ 时，受感染细胞中有多重整合的比例约为 $1 - e^{-m}(1+m) \\approx 0.037$，这个数值小到可以忽略。为达到 $C_{\\min} = 500$，我们需要 $N_0 \\ge \\dfrac{L \\, C_{\\min}}{f} \\approx 1.0 \\times 10^8$ 个细胞，因为只有筛选后的瓶颈对覆盖度有影响。增加覆盖度会降低检测强效应的统计功效，因为更多的细胞会稀释表型。**\n- MOI的定义正确。覆盖度的定义可以接受，但不如选项A精确。\n- 对多次整合比例的描述不正确。公式 $1 - e^{-m}(1+m)$ 给出的是相对于*所有*细胞的比例，而不是*受感染*细胞。值 $0.037$ 是所有细胞中的比例，而受感染细胞中的比例要高得多（$\\approx 0.14$）。\n- 增加覆盖度会*降低*统计功效的说法是根本错误的。事实恰恰相反。\n- $N_0$ 的公式不正确，因为它未能考虑因未感染而损失的细胞（$1 - e^{-m}$ 因子）。\n- **结论：错误。**\n\n**D. MOI是每个细胞加入的病毒颗粒数，覆盖度是文库克隆过程中每个sgRNA的质粒菌落数。MOI为 $m = 2$ 可以确保几乎每个细胞都获得至少一个sgRNA，从而最小化偏倚。多次感染可以建模为概率为 $p = m/(1+m)$ 的二项过程，因此多次感染率为 $p^2$。对于 $L = 10^5$ 和 $C_{\\min} = 500$，所需的起始细胞数为 $N_0 \\ge L \\, C_{\\min} = 5 \\times 10^7$，这与筛选损失无关，因为筛选只去除未感染的细胞。**\n- MOI的定义不精确（加入的颗粒数 vs. 功能性整合数）。\n- 覆盖度的定义完全错误，将筛选覆盖度与克隆质量控制混为一谈。\n- 高MOI（如 $m=2$）*最小化偏倚*的说法与事实相反；它会最大化多次感染偏倚。\n- 将过程建模为二项分布的建议不正确；问题指定了泊松过程。\n- $N_0$ 的计算是错误的；它计算的是瓶颈处的细胞数（$N_{\\text{bottleneck}}$），而不是所需的起始数，并且忽略了所有损失因素。\n- **结论：错误。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "从全基因组关联研究（GWAS）等遗传学研究中获得的“命中”基因，往往并非直接的致病基因。网络医学提供了一个强大的框架，通过分析这些基因在复杂的生物网络（如蛋白质相互作用网络）中的位置和连接，来识别真正的核心调控因子。本练习  将让您亲手实现一种经典的网络扩散算法——带重启的随机游走（Random Walk with Restart），学会如何利用网络拓扑结构从遗传学线索中优先排序出最有潜力的药物靶点。",
            "id": "5066670",
            "problem": "给定一个加权无向的蛋白质-蛋白质相互作用网络，表示为图 $G = (V, E)$，其中包含 $|V| = n$ 个蛋白质（节点）。设加权邻接矩阵为 $A \\in \\mathbb{R}^{n \\times n}$，其中 $A_{ij} \\ge 0$ 编码了蛋白质 $i$ 和蛋白质 $j$ 之间的相互作用强度，并且对于所有 $i, j$，都有 $A_{ij} = A_{ji}$。定义对角度矩阵 $D \\in \\mathbb{R}^{n \\times n}$，其元素为 $D_{ii} = \\sum_{j=1}^{n} A_{ij}$。定义行归一化转移矩阵 $W \\in \\mathbb{R}^{n \\times n}$ 为\n$$\nW = D^{-1} A,\n$$\n并约定如果 $D_{ii} = 0$，则 $W$ 的第 $i$ 行为零行。\n\n假设你有一个非负种子向量 $s \\in \\mathbb{R}^n$，代表与疾病相关的蛋白质的全基因组关联研究 (GWAS) 证据，其中对于 GWAS 所涉及的蛋白质，$s_i > 0$；否则，$s_i = 0$。考虑由不动点方程定义的带重启参数 $\\lambda \\in (0, 1]$ 的随机游走扩散：\n$$\nf = \\lambda s + (1 - \\lambda) W f,\n$$\n其中 $f \\in \\mathbb{R}^n$ 是扩散得分向量。在给定 $W$ 的构造下，对于 $\\lambda \\in (0,1]$，该方程保证有唯一解。\n\n你的任务是编写一个程序，对每个测试用例执行以下操作：\n1. 从 $A$ 和 $D$ 计算 $W$。\n2. 使用上述不动点方程求解扩散得分向量 $f$。\n3. 将满足 $s_i = 0$ 和 $f_i > \\epsilon$ 的节点 $i$ 识别为候选目标，其中 $\\epsilon$ 是一个设为 $10^{-12}$ 的微小数值容差。\n4. 按 $f_i$ 的降序对候选目标进行排序，若得分相同则按节点索引的升序排序。\n5. 返回排名前 $k$ 的候选目标（节点索引）。如果严格正扩散得分的候选者少于 $k$ 个，则返回所有这些候选者。如果种子向量 $s$ 完全为零，则返回空列表。\n\n假设所有量均为无量纲量，不适用任何物理单位。\n\n缩写定义：全基因组关联研究 (Genome-Wide Association Study, GWAS)，蛋白质-蛋白质相互作用 (Protein–Protein Interaction, PPI)。\n\n使用以下测试套件，每个测试用例由其邻接矩阵 $A$、种子向量 $s$、重启参数 $\\lambda$ 和整数 $k$ 定义。\n\n测试用例 1 (正常路径，中等连通网络)：\n$$\nA^{(1)} =\n\\begin{bmatrix}\n0  0.5  0  0  0  0  0.1 \\\\\n0.5  0  0.4  0  0.1  0  0 \\\\\n0  0.4  0  0.3  0  0.2  0 \\\\\n0  0  0.3  0  0.7  0  0 \\\\\n0  0.1  0  0.7  0  0.2  0 \\\\\n0  0  0.2  0  0.2  0  0.6 \\\\\n0.1  0  0  0  0  0.6  0 \\\\\n\\end{bmatrix}, \\quad\ns^{(1)} =\n\\begin{bmatrix}\n0 \\\\\n1.2 \\\\\n0 \\\\\n0 \\\\\n0 \\\\\n0.8 \\\\\n0 \\\\\n\\end{bmatrix}, \\quad\n\\lambda^{(1)} = 0.65, \\quad k^{(1)} = 3.\n$$\n\n测试用例 2 (边界情况，含孤立种子节点)：\n$$\nA^{(2)} =\n\\begin{bmatrix}\n0  1.0  0.3  0  0 \\\\\n1.0  0  0.5  0  0.2 \\\\\n0.3  0.5  0  0  0 \\\\\n0  0  0  0  0 \\\\\n0  0.2  0  0  0 \\\\\n\\end{bmatrix}, \\quad\ns^{(2)} =\n\\begin{bmatrix}\n0 \\\\\n0 \\\\\n0 \\\\\n1.0 \\\\\n0 \\\\\n\\end{bmatrix}, \\quad\n\\lambda^{(2)} = 0.85, \\quad k^{(2)} = 2.\n$$\n\n测试用例 3 (不连通分量，种子位于不同分量中)：\n$$\nA^{(3)} =\n\\begin{bmatrix}\n0  0.9  0.4  0  0  0  0  0 \\\\\n0.9  0  0.9  0  0  0  0  0 \\\\\n0.4  0.9  0  0.9  0  0  0  0 \\\\\n0  0  0.9  0  0  0  0  0 \\\\\n0  0  0  0  0  0.8  0.3  0 \\\\\n0  0  0  0  0.8  0  0.8  0 \\\\\n0  0  0  0  0.3  0.8  0  0.8 \\\\\n0  0  0  0  0  0  0.8  0 \\\\\n\\end{bmatrix}, \\quad\ns^{(3)} =\n\\begin{bmatrix}\n0 \\\\\n1.0 \\\\\n0 \\\\\n0 \\\\\n0 \\\\\n0 \\\\\n1.1 \\\\\n0 \\\\\n\\end{bmatrix}, \\quad\n\\lambda^{(3)} = 0.7, \\quad k^{(3)} = 3.\n$$\n\n测试用例 4 (边缘情况，无种子)：\n$$\nA^{(4)} =\n\\begin{bmatrix}\n0  0.5  0  0.5 \\\\\n0.5  0  0.5  0 \\\\\n0  0.5  0  0.5 \\\\\n0.5  0  0.5  0 \\\\\n\\end{bmatrix}, \\quad\ns^{(4)} =\n\\begin{bmatrix}\n0 \\\\\n0 \\\\\n0 \\\\\n0 \\\\\n\\end{bmatrix}, \\quad\n\\lambda^{(4)} = 0.9, \\quad k^{(4)} = 2.\n$$\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素是該测试用例所选节点索引的列表；例如，形如 $[ [i_1, i_2, \\dots], [\\dots], [\\dots], [\\dots] ]$ 的输出，但不含空格，即使用确切格式：\"[list_case1,list_case2,list_case3,list_case4]\"。",
            "solution": "用户提供的问题陈述已经过仔细验证，并被确定为有效。它在基于网络的基因优先级排序的既定原则上具有科学依据，在数学上是适定的，并且其所有术语和目标都定义得足够精确。该问题要求实现带重启的随机游走 (RWR) 算法，以根据一组已知疾病相关蛋白质（种子）的网络邻近性来识别和排序新的蛋白质目标。\n\n解决方案分两个阶段进行：首先，对底层数学框架进行原则性阐述；其次，设计一个计算算法来解决给定的测试用例。\n\n### 网络扩散和带重启随机游走的原理\n\n这个问题的核心在于模拟一组种子蛋白质在蛋白质-蛋白质相互作用 (PPI) 网络中的“影响力”。这是通过网络扩散过程，特别是带重启的随机游走 (RWR) 算法来实现的。从概念上讲，RWR 模拟了一个在图上遍历的随机游走者。从任何给定节点出发，游走者可以移动到相邻节点（其概率由相互作用强度决定），也可以通过“重启”瞬移回初始种子节点之一。\n\n每个蛋白质的最终得分由向量 $f$ 表示，对应于在该蛋白质相应节点上找到游走者的稳态概率。对于非种子蛋白质 $i$ 而言，较高的得分 $f_i$ 意味着它通过网络中的各种路径与种子蛋白质连接良好，使其成为与种子所定义的疾病或生物过程功能上相关的强有力候选者。\n\n### 数学公式和解法\n\n该问题定义在一个加权无向图 $G = (V, E)$上，其中 $V$ 是 $n$ 个蛋白质的集合，$E$ 是相互作用的集合。相互作用强度由加权邻接矩阵 $A$ 给出。\n\n1.  **转移矩阵的构造**：第一步是定义节点之间移动的概率。节点 $i$ 的度 $D_{ii} = \\sum_{j=1}^{n} A_{ij}$ 表示蛋白质 $i$ 的总相互作用强度。构造行归一化转移矩阵 $W = D^{-1} A$，其中 $W_{ij} = A_{ij} / D_{ii}$ 是在不重启的条件下从节点 $i$ 转移到节点 $j$ 的概率。对于度为 $D_{ii}=0$ 的孤立节点 $i$，其在 $W$ 中对应的行定义为零向量，意味着游走者无法离开该节点。\n\n2.  **不动点方程**：稳态扩散得分由向量 $f \\in \\mathbb{R}^n$ 捕获，该向量满足不動點方程：\n    $$\n    f = \\lambda s + (1 - \\lambda) W f\n    $$\n    此处，$s$ 是标准化种子向量，$\\lambda \\in (0, 1]$ 是重启参数。$\\lambda s$ 项表示重启到种子节点的概率，而 $(1 - \\lambda) W f$ 表示来自相邻节点的概率流。\n\n3.  **求解线性系统**：为了找到 $f$ 的唯一解，我们将方程重排为一个标准的线性方程组。\n    $$\n    f - (1 - \\lambda) W f = \\lambda s\n    $$\n    提取 $f$ 因子得到：\n    $$\n    (I - (1 - \\lambda) W) f = \\lambda s\n    $$\n    其中 $I$ 是 $n \\times n$ 的单位矩阵。这是一个形如 $M x = b$ 的线性系统，其中矩阵 $M = I - (1 - \\lambda) W$，未知向量为 $x = f$，右侧向量为 $b = \\lambda s$。对于 $\\lambda \\in (0, 1]$，$(1-\\lambda)W$ 的谱半径严格小于 1，这保证了矩阵 $M$ 是可逆的。因此，$f$ 的唯一解存在，并且可以通过求解该线性系统找到。在计算上，使用数值线性代数求解器可以高效且稳定地实现这一点，而不是通过显式计算矩阵的逆 $M^{-1}$。\n\n### 算法流程\n\n为解决每个测试用例，实现了以下分步算法。\n\n1.  **输入**：接收邻接矩阵 $A$、种子向量 $s$、重启参数 $\\lambda$ 和整数 $k$。\n\n2.  **处理零种子情况**：如果种子向量 $s$ 只包含零，系统变为 $(I - (1 - \\lambda) W) f = 0$。由于矩阵是可逆的，唯一的解是平凡解 $f=0$。在这种情况下，没有候选者的得分会高于阈值 $\\epsilon$，因此我们根据问题规范返回一个空列表。\n\n3.  **计算度矩阵和转移矩阵**：a. 通过对 $A$ 的行求和来计算每个节点的度：$D_{ii} = \\sum_{j} A_{ij}$。b. 构造转移矩阵 $W = D^{-1} A$。必须小心处理度为 0 的节点。对于任何 $D_{ii} = 0$ 的行 $i$，其对应的行 $W_{i, \\cdot}$ 被设置为全零。\n\n4.  **求解线性系统**：a. 构造大小为 $n \\times n$ 的单位矩阵 $I$。b. 形成矩阵 $M = I - (1 - \\lambda) W$。c. 形成向量 $b = \\lambda s$。d. 求解系统 $M f = b$ 以得到扩散得分向量 $f$。\n\n5.  **识别和排序候选者**：a. 将初始种子得分为零的节点定义为候选节点集：$\\{i \\mid s_i = 0\\}$。b. 筛选这些候选者，只保留最终扩散得分严格为正的节点，即 $f_i > \\epsilon$，其中 $\\epsilon = 10^{-12}$。c. 为每个有效候选节点 $i$ 创建一个序对列表 $(f_i, i)$。d. 对此候选者列表进行排序。主要排序标准是扩散得分 $f_i$ 降序。次要的平局决胜标准是节点索引 $i$ 升序。\n\n6.  **生成输出**：a. 从排序后的列表中提取节点索引。b. 返回此列表中的前 $k$ 个索引。如果候选者数量少于 $k$，则返回所有候选索引。\n\n该过程应用于所提供的四个测试用例中的每一个。然后将结果格式化为指定的单行字符串输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve_diffusion(A, s, lam, k, epsilon=1e-12):\n    \"\"\"\n    Computes and ranks candidate targets using Random Walk with Restart.\n\n    Args:\n        A (np.ndarray): The weighted adjacency matrix of the network.\n        s (np.ndarray): The seed vector.\n        lam (float): The restart parameter lambda.\n        k (int): The number of top candidates to return.\n        epsilon (float): A small numerical tolerance for score comparison.\n\n    Returns:\n        list: A list of the top-k ranked candidate node indices.\n    \"\"\"\n    n = A.shape[0]\n\n    # Handle the special case where the seed vector is all zeros.\n    if np.all(s == 0):\n        return []\n\n    # 1. Compute the degree matrix D and the transition matrix W.\n    degrees = np.sum(A, axis=1)\n    \n    # Create an inverse degree vector, handling zero-degree nodes.\n    inv_degrees = np.zeros_like(degrees)\n    non_zero_mask = degrees != 0\n    inv_degrees[non_zero_mask] = 1.0 / degrees[non_zero_mask]\n    \n    # Construct W by element-wise multiplication with the inverse degrees.\n    # This is equivalent to D_inv @ A but safer for zero-degree nodes.\n    W = inv_degrees[:, np.newaxis] * A\n    \n    # 2. Solve the fixed-point equation (I - (1-lam)W)f = lam*s\n    I = np.identity(n)\n    M = I - (1 - lam) * W\n    b = lam * s\n    \n    try:\n        f = np.linalg.solve(M, b)\n    except np.linalg.LinAlgError:\n        # This case should not be reached given the problem's guarantee\n        # of a unique solution, but is included for robustness.\n        return []\n\n    # 3. Identify candidate targets.\n    # Candidates are non-seed nodes (s_i = 0) with a score > epsilon.\n    non_seed_indices = np.where(s == 0)[0]\n    \n    candidates = []\n    for i in non_seed_indices:\n        if f[i] > epsilon:\n            candidates.append({'score': f[i], 'index': i})\n            \n    # 4. Rank candidates: descending score, ascending index for ties.\n    # The sort key (-score, index) achieves this.\n    candidates.sort(key=lambda c: (-c['score'], c['index']))\n    \n    # 5. Return the top-k candidate indices.\n    ranked_indices = [c['index'] for c in candidates]\n    \n    return ranked_indices[:k]\n\ndef solve():\n    \"\"\"\n    Defines and runs the test suite for the network diffusion problem.\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"A\": np.array([\n                [0, 0.5, 0, 0, 0, 0, 0.1],\n                [0.5, 0, 0.4, 0, 0.1, 0, 0],\n                [0, 0.4, 0, 0.3, 0, 0.2, 0],\n                [0, 0, 0.3, 0, 0.7, 0, 0],\n                [0, 0.1, 0, 0.7, 0, 0.2, 0],\n                [0, 0, 0.2, 0, 0.2, 0, 0.6],\n                [0.1, 0, 0, 0, 0, 0.6, 0]\n            ]),\n            \"s\": np.array([0, 1.2, 0, 0, 0, 0.8, 0]),\n            \"lam\": 0.65,\n            \"k\": 3\n        },\n        {\n            \"A\": np.array([\n                [0, 1.0, 0.3, 0, 0],\n                [1.0, 0, 0.5, 0, 0.2],\n                [0.3, 0.5, 0, 0, 0],\n                [0, 0, 0, 0, 0],\n                [0, 0.2, 0, 0, 0]\n            ]),\n            \"s\": np.array([0, 0, 0, 1.0, 0]),\n            \"lam\": 0.85,\n            \"k\": 2\n        },\n        {\n            \"A\": np.array([\n                [0, 0.9, 0.4, 0, 0, 0, 0, 0],\n                [0.9, 0, 0.9, 0, 0, 0, 0, 0],\n                [0.4, 0.9, 0, 0.9, 0, 0, 0, 0],\n                [0, 0, 0.9, 0, 0, 0, 0, 0],\n                [0, 0, 0, 0, 0, 0.8, 0.3, 0],\n                [0, 0, 0, 0, 0.8, 0, 0.8, 0],\n                [0, 0, 0, 0, 0.3, 0.8, 0, 0.8],\n                [0, 0, 0, 0, 0, 0, 0.8, 0]\n            ]),\n            \"s\": np.array([0, 1.0, 0, 0, 0, 0, 1.1, 0]),\n            \"lam\": 0.7,\n            \"k\": 3\n        },\n        {\n            \"A\": np.array([\n                [0, 0.5, 0, 0.5],\n                [0.5, 0, 0.5, 0],\n                [0, 0.5, 0, 0.5],\n                [0.5, 0, 0.5, 0]\n            ]),\n            \"s\": np.array([0, 0, 0, 0]),\n            \"lam\": 0.9,\n            \"k\": 2\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = solve_diffusion(case[\"A\"], case[\"s\"], case[\"lam\"], case[\"k\"])\n        results.append(result)\n\n    # Format the output string precisely as required: \"[list1,list2,...]\"\n    # str() adds spaces, so they must be removed.\n    formatted_results = [str(r).replace(' ', '') for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在转化医学中，最终的靶点选择决策很少仅依赖于单一维度的证据。一个理想的候选靶点不仅需要有坚实的遗传学和功能基因组学证据支持其有效性，还需要仔细评估其潜在的安全性风险。本练习  构建了一个量化决策模型，教您如何整合来自不同来源的数据——包括遗传学、功能筛选和已知的通路毒性——以计算一个综合的效益-风险指数，从而为是否推进一个靶点进入后续开发提供一个理性的、数据驱动的依据。",
            "id": "5066778",
            "problem": "一个转化医学团队正在通过整合遗传学证据、功能基因组学和通路毒性评估，来优先确定一个用于治疗炎症性疾病的治疗靶点。其总体的生物学基础是分子生物学中心法则（DNA到RNA到蛋白质），它将经过遗传学验证的靶蛋白与疾病表型联系起来；同时，决策理论的预期效用原则指出，最优选择是使预期收益减去预期损害最大化。该团队以质量调整生命年（QALYs）为单位，对每位患者的预期临床获益和损害进行建模。\n\n靶点与疾病基因座的遗传共定位得出的因果概率为 $w_{g} = 0.65$。在一种疾病相关细胞系中进行的成簇规律间隔短回文重复序列（CRISPR）功能缺失筛选显示，当靶点受到扰动时，$\\log_2$ 存活率下降幅度为 $s = 1.2$，功能性命中置信度量化为 $w_{f} = 0.75$。假设遗传学证据和功能性证据相互独立，并使用标准的并集概率模型来获得靶点调节将具有临床疗效的总概率。临床获益的预期幅度通过一个饱和药效学效应函数进行建模，该函数的最大可及获益为 $E_{\\max} = 0.5$ QALY，敏感性参数为 $\\alpha = 0.4$，它将功能基因组学效应大小 $s$ 映射为临床获益幅度 $M$，这是一个基于经过充分检验的剂量-反应推理的单调饱和变换。来自该靶点机制网络的已知通路毒性包括三种潜在损害：心脏毒性（概率 $p_{1} = 0.12$，严重程度为损失 $w_{1} = 0.25$ QALY，暴露权重 $e_{1} = 0.9$）、肝毒性（$p_{2} = 0.08$，$w_{2} = 0.15$，$e_{2} = 0.8$）和血液毒性（$p_{3} = 0.05$，$w_{3} = 0.20$，$e_{3} = 0.7$）。假设对损害进行风险中性加权。\n\n从预期效用原则和基本概率规则出发，推导出获益-风险指数 $I$，即根据上述输入计算的预期净 QALY。此外，通过加上最小临床重要差异 $\\delta = 0.05$ QALY 和开发机会成本等效值 $D = 0.03$ QALY，推导出一个合理的“继续/终止”阈值 $\\theta$，并解释计算出的 $I$ 相对于 $\\theta$ 的意义。\n\n计算 $I$ 并报告其值。将最终的 $I$ 四舍五入到四位有效数字，并以 QALYs 为单位表示。",
            "solution": "用户希望我按照以下步骤解决问题：\n1.  验证问题陈述。\n2.  如果问题有效，提供一个完整且有理有据的解决方案。\n3.  将所有数学实体格式化为 LaTeX。\n4.  以指定格式提供最终答案。\n\n### 第 1 步：问题验证\n\n#### 提取已知条件\n-   遗传学因果概率: $w_g = 0.65$\n-   功能基因组学效应大小（$\\log_2$ 存活率下降）: $s = 1.2$\n-   功能性命中置信度: $w_f = 0.75$\n-   假设：遗传学证据和功能性证据相互独立。\n-   总疗效概率模型：标准的并集概率模型。\n-   最大可及临床获益: $E_{\\max} = 0.5$ QALY。\n-   获益函数的敏感性参数: $\\alpha = 0.4$。\n-   临床获益幅度 $M$ 的模型：$s$ 的单调饱和变换。\n-   心脏毒性参数：概率 $p_1 = 0.12$，严重程度 $w_1 = 0.25$ QALY，暴露权重 $e_1 = 0.9$。\n-   肝毒性参数：概率 $p_2 = 0.08$，严重程度 $w_2 = 0.15$ QALY，暴露权重 $e_2 = 0.8$。\n-   血液毒性参数：概率 $p_3 = 0.05$，严重程度 $w_3 = 0.20$ QALY，暴露权重 $e_3 = 0.7$。\n-   假设：对损害进行风险中性加权。\n-   最小临床重要差异: $\\delta = 0.05$ QALY。\n-   开发机会成本: $D = 0.03$ QALY。\n-   任务：推导并计算获益-风险指数 $I$（预期净 QALY）。\n-   任务：推导“继续/终止”阈值 $\\theta$。\n-   任务：解释计算出的 $I$ 相对于 $\\theta$ 的意义。\n-   要求：将最终的 $I$ 四舍五入到四位有效数字。\n\n#### 使用提取的已知条件进行验证\n该问题具有科学依据，借鉴了分子生物学（中心法则）、遗传学（CRISPR、共定位）、药理学（剂量-反应）和决策理论（预期效用、QALYs）的既定原则。该情景代表了转化医学决策过程的一个合理（尽管简化了）的定量模型。\n\n该问题提法明确。它提供了必要的定量输入，并指定了要使用的模型（例如，“并集概率模型”、“风险中性加权”）。虽然没有给出临床获益的“单调饱和变换”的确切代数形式，但其属性（$E_{\\max}$、敏感性 $\\alpha$）的描述足以证明使用标准的、常见的函数形式是合理的，例如 $M(s) = E_{\\max}(1 - \\exp(-\\alpha s))$，这与剂量-反应模型一致。术语“暴露权重”用于毒性，在药理学背景下也可以合理地解释为调节损害概率的一个因素。该问题是自洽的、客观的，并且不包含矛盾信息或不科学的前提。\n\n#### 结论与行动\n该问题被认为是有效的。将推导完整的解决方案。\n\n### 第 2 步：求解推导\n\n该问题要求计算获益-风险指数 $I$，定义为预期净质量调整生命年（QALYs）。这基于预期效用原则，该指数是预期获益与预期损害之间的差值。\n$$I = E[\\text{Benefit}] - E[\\text{Harm}]$$\n\n#### 预期获益计算\n预期获益 $E[\\text{Benefit}]$ 是疗法有效的概率 $P_{eff}$ 与其有效时的临床获益幅度 $M$ 的乘积。\n$$E[\\text{Benefit}] = P_{eff} \\times M$$\n\n首先，我们计算 $P_{eff}$。问题陈述要求对独立的遗传学证据 ($w_g$) 和功能性证据 ($w_f$) 使用“标准的并集概率模型”。设 $G$ 为基于遗传学证据靶点是因果靶点的事件，设 $F$ 为基于功能性证据靶点是因果靶点的事件。疗效概率是这两个事件的并集概率。\n$$P_{eff} = P(G \\cup F)$$\n鉴于证据来源是独立的，我们有：\n$$P_{eff} = P(G) + P(F) - P(G)P(F) = w_g + w_f - w_g w_f$$\n代入给定值：\n$$P_{eff} = 0.65 + 0.75 - (0.65)(0.75) = 1.40 - 0.4875 = 0.9125$$\n\n接下来，我们计算临床获益的幅度 $M$。问题将 $M$ 描述为功能基因组学效应大小 $s$ 的“单调饱和变换”，具有最大获益 $E_{\\max}$ 和敏感性 $\\alpha$。基于剂量-反应原则，这种关系的一个标准函数形式是指数饱和模型。我们将采用这种形式：\n$$M = E_{\\max} \\left(1 - \\exp(-\\alpha s)\\right)$$\n代入给定值：\n$$M = 0.5 \\left(1 - \\exp(-0.4 \\times 1.2)\\right) = 0.5 \\left(1 - \\exp(-0.48)\\right)$$\n\n现在，我们可以计算预期获益：\n$$E[\\text{Benefit}] = P_{eff} \\times M = 0.9125 \\times 0.5 \\left(1 - \\exp(-0.48)\\right)$$\n$$E[\\text{Benefit}] \\approx 0.9125 \\times 0.5 \\times (1 - 0.6187795) = 0.9125 \\times 0.5 \\times 0.3812205 \\approx 0.1739226 \\text{ QALYs}$$\n\n#### 预期损害计算\n预期损害 $E[\\text{Harm}]$ 是三种潜在毒性各自预期损害的总和，假设风险中性。单个毒性事件 $i$ 的预期损害是其发生概率乘以其严重程度。问题提供了概率 $p_i$、严重程度 $w_i$ 和一个“暴露权重” $e_i$。一个合理的解释是，经历该毒性的有效概率是内在通路概率 $p_i$ 经暴露权重 $e_i$ 调节后的结果。\n$$E[\\text{Harm}_i] = (p_i e_i) \\times w_i$$\n总预期损害 $H_{exp}$ 是三种毒性损害的总和：\n$$H_{exp} = \\sum_{i=1}^{3} p_i e_i w_i = (p_1 e_1 w_1) + (p_2 e_2 w_2) + (p_3 e_3 w_3)$$\n代入给定值：\n-   心脏毒性: $E[\\text{Harm}_1] = 0.12 \\times 0.9 \\times 0.25 = 0.027$\n-   肝毒性: $E[\\text{Harm}_2] = 0.08 \\times 0.8 \\times 0.15 = 0.0096$\n-   血液毒性: $E[\\text{Harm}_3] = 0.05 \\times 0.7 \\times 0.20 = 0.007$\n\n总预期损害为：\n$$H_{exp} = 0.027 + 0.0096 + 0.007 = 0.0436 \\text{ QALYs}$$\n\n#### 获益-风险指数和阈值计算\n获益-风险指数 $I$ 现在计算如下：\n$$I = E[\\text{Benefit}] - H_{exp} \\approx 0.1739226 - 0.0436 = 0.1303226$$\n按要求四舍五入到四位有效数字：\n$$I \\approx 0.1303 \\text{ QALYs}$$\n\n“继续/终止”阈值 $\\theta$ 定义为最小临床重要差异 $\\delta$ 与开发机会成本 $D$ 的和：\n$$\\theta = \\delta + D$$\n代入给定值：\n$$\\theta = 0.05 + 0.03 = 0.08 \\text{ QALYs}$$\n\n#### 解释\n最后一步是解释计算出的指数 $I$ 相对于阈值 $\\theta$ 的意义。\n-   计算的获益-风险指数：$I \\approx 0.1303$ QALYs。\n-   计算的“继续/终止”阈值：$\\theta = 0.08$ QALYs。\n\n由于 $I > \\theta$（$0.1303 > 0.08$），追求该治疗靶点的预期净获益超过了考虑临床意义和机会成本所需的阈值。因此，基于此模型，决策将是“继续”——即继续开发此靶点。",
            "answer": "$$\n\\boxed{0.1303}\n$$"
        }
    ]
}