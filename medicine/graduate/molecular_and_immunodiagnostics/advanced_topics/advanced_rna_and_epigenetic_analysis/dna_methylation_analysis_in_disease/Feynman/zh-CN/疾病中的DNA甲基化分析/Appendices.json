{
    "hands_on_practices": [
        {
            "introduction": "我们的第一个实践练习聚焦于DNA甲基化分析的基本单元：从测序数据中量化单个CpG位点的甲基化水平。我们将使用二项分布抽样模型来计算甲基化比例，并至关重要地，计算其置信区间。这个练习旨在强调统计严谨性的重要性，不仅要呈现甲基化水平的点估计值，还要表达测量过程中固有的不确定性，这对于做出可靠的生物学推断至关重要。",
            "id": "5109692",
            "problem": "进行了一项靶向亚硫酸氢盐测序分析，以量化结直肠肿瘤活检中单个胞嘧啶-磷酸-鸟嘌呤（CpG）位点的胞嘧啶甲基化水平。在亚硫酸氢钠转化过程中，未甲基化的胞嘧啶脱氨基变为尿嘧啶（经过聚合酶链式反应（PCR）和测序后被读取为胸腺嘧啶），而甲基化的胞嘧啶则能抵抗转化，被读取为胞嘧啶。经过严格的质量控制（去除重复序列和碱基质量过滤），该位点的测序覆盖度为 $n = 120$ 条读数，其中 $k = 54$ 条读数被鉴定为甲基化胞嘧啶。假设在该抽样细胞群体中，对于这个 CpG 位点，每一条读数都是一次独立的伯努利试验，其真实甲基化概率为 $p$，并且相对于抽样变异性，未转化和碱基识别错误可以忽略不计。\n\n以二项抽样模型为基本依据，并基于标准正态参考分布，使用 $0.95$ 的双侧置信水平，计算：\n1. 甲基化比例 $\\hat{p}$。\n2. 通过对二项比例的得分检验进行反演，得到的 $p$ 在 $0.95$ 水平下的 Wilson 得分置信区间。\n\n按 $(\\hat{p}, L, U)$ 的顺序报告你的三个最终数值，其中 $L$ 和 $U$ 分别是置信下限和上限。将所有三个数值表示为小数（而非百分比），并将你的答案四舍五入到四位有效数字。",
            "solution": "根据设计，该测量过程可映射为一个二项模型：假设在质量控制后系统误差可以忽略不计，那么覆盖该 CpG 位点的每一条读数都可以被视为一次独立的伯努利试验，观察到甲基化胞嘧啶的概率为 $p$。因此，甲基化读数的计数 $k$ 服从 $k \\sim \\mathrm{Binomial}(n, p)$ 分布，而 $p$ 的标准估计量是样本比例\n$$\n\\hat{p} \\equiv \\frac{k}{n}.\n$$\n对于目标覆盖率为 $0.95$ 的区间估计，一种比朴素的 Wald 区间能更好控制覆盖率的常用方法是 Wilson 得分区间，它是通过对原假设 $H_{0}: p = p_{0}$ 的得分检验进行反演得到的。\n\n从参数为 $p$ 的二项似然函数出发，得分检验统计量（在 $H_{0}$ 下由 Fisher 信息进行归一化）为\n$$\nS(p_{0}) \\equiv \\frac{\\hat{p} - p_{0}}{\\sqrt{\\frac{p_{0}(1 - p_{0})}{n}}}.\n$$\n在水平 $\\alpha$ 下，当 $|S(p_{0})|  z$ 时，双侧得分检验会拒绝 $H_{0}$，其中 $z$ 是标准正态分布的上 $(1-\\alpha/2)$ 分位数。$(1-\\alpha)$ Wilson 得分置信集是所有未被拒绝的 $p_{0}$ 的集合：\n$$\n\\left| \\frac{\\hat{p} - p_{0}}{\\sqrt{\\frac{p_{0}(1 - p_{0})}{n}}} \\right| \\leq z.\n$$\n将两边平方并重新整理，得到一个关于 $p_{0}$ 的二次不等式：\n$$\n\\frac{(\\hat{p} - p_{0})^{2}}{\\frac{p_{0}(1 - p_{0})}{n}} \\leq z^{2}\n\\;\\;\\Longleftrightarrow\\;\\;\nn(\\hat{p} - p_{0})^{2} \\leq z^{2} p_{0}(1 - p_{0}).\n$$\n展开并在左侧合并同类项：\n$$\nn\\hat{p}^{2} - 2n\\hat{p}p_{0} + np_{0}^{2} - z^{2}p_{0} + z^{2}p_{0}^{2} \\leq 0,\n$$\n我们将其写为\n$$\n(n + z^{2})p_{0}^{2} - (2n\\hat{p} + z^{2})p_{0} + n\\hat{p}^{2} \\leq 0.\n$$\n满足此不等式的 $p_{0}$ 集合是二次方程 $(n + z^{2})p_{0}^{2} - (2n\\hat{p} + z^{2})p_{0} + n\\hat{p}^{2} = 0$ 的两个根之间的区间。使用二次公式，根为\n$$\np_{0} \\;=\\; \\frac{(2n\\hat{p} + z^{2}) \\pm \\sqrt{(2n\\hat{p} + z^{2})^{2} - 4(n + z^{2})n\\hat{p}^{2}}}{2(n + z^{2})}.\n$$\n判别式简化如下：\n$$\n\\begin{aligned}\n(2n\\hat{p} + z^{2})^{2} - 4(n + z^{2})n\\hat{p}^{2}\n= 4n^{2}\\hat{p}^{2} + 4n\\hat{p}z^{2} + z^{4} - 4n^{2}\\hat{p}^{2} - 4n z^{2}\\hat{p}^{2} \\\\\n= z^{2}\\!\\left(z^{2} + 4n\\hat{p}(1 - \\hat{p})\\right).\n\\end{aligned}\n$$\n因此，Wilson 得分区间可以写成代数上等价且常用的形式\n$$\n\\left[\\,L, U\\,\\right] \\;=\\; \\frac{\\hat{p} + \\frac{z^{2}}{2n} \\;\\pm\\; z\\sqrt{\\frac{\\hat{p}(1 - \\hat{p})}{n} + \\frac{z^{2}}{4n^{2}}}}{1 + \\frac{z^{2}}{n}}.\n$$\n\n我们现在代入观测值。点估计值为\n$$\n\\hat{p} \\;=\\; \\frac{k}{n} \\;=\\; \\frac{54}{120} \\;=\\; 0.45.\n$$\n对于 $0.95$ 的双侧置信水平，我们取 $z \\approx 1.96$ 并计算各个组成部分：\n$$\n\\frac{z^{2}}{n} \\;=\\; \\frac{3.8416}{120} \\;=\\; 0.032013333\\ldots,\\quad\n1 + \\frac{z^{2}}{n} \\;=\\; 1.032013333\\ldots,\n$$\n$$\n\\hat{p} + \\frac{z^{2}}{2n} \\;=\\; 0.45 + \\frac{3.8416}{240} \\;=\\; 0.466006666\\ldots,\n$$\n$$\n\\frac{\\hat{p}(1 - \\hat{p})}{n} + \\frac{z^{2}}{4n^{2}}\n\\;=\\; \\frac{0.45 \\times 0.55}{120} + \\frac{3.8416}{4 \\times 120^{2}}\n\\;=\\; 0.0020625 + 0.000066694444\\ldots\n\\;=\\; 0.002129194444\\ldots,\n$$\n$$\nz\\sqrt{\\frac{\\hat{p}(1 - \\hat{p})}{n} + \\frac{z^{2}}{4n^{2}}}\n\\;=\\; 1.96 \\times \\sqrt{0.002129194444\\ldots}\n\\;=\\; 1.96 \\times 0.046143192\\ldots\n\\;=\\; 0.09043786\\ldots.\n$$\n因此，\n$$\nL \\;=\\; \\frac{0.466006666\\ldots - 0.09043786\\ldots}{1.032013333\\ldots}\n\\;=\\; \\frac{0.375568806\\ldots}{1.032013333\\ldots}\n\\;=\\; 0.363919\\ldots,\n$$\n$$\nU \\;=\\; \\frac{0.466006666\\ldots + 0.09043786\\ldots}{1.032013333\\ldots}\n\\;=\\; \\frac{0.556444526\\ldots}{1.032013333\\ldots}\n\\;=\\; 0.539184\\ldots.\n$$\n\n四舍五入到四位有效数字并以小数（而非百分比）表示，所求的三元组 $(\\hat{p}, L, U)$ 为\n$$\n\\hat{p} = 0.4500,\\quad L = 0.3639,\\quad U = 0.5392.\n$$\n在分子和免疫诊断的背景下，这些结果在科学上是恰当的，因为二项模型捕捉了独立性假设下读数级别的甲基化鉴定，并且对于靶向测序中常见的中等覆盖度 $n$，Wilson 区间相比 Wald 区间提供了更优的覆盖特性。",
            "answer": "$$\\boxed{\\begin{pmatrix}0.4500  0.3639  0.5392\\end{pmatrix}}$$"
        },
        {
            "introduction": "本练习将从单一位点分析转向多位点生物标志物，揭示“表观遗传时钟”这一概念的神秘面紗。您将应用一个预先训练好的线性模型到新样本的甲基化数据上，以预测其生物学年龄。这项实践展示了如何将多个CpG位点组合起来，创造出强大的预测工具，并介绍了具有临床意义的“年龄加速”概念，即生物学年龄与实足年龄之间的差异。",
            "id": "5109709",
            "problem": "一个用于全血的监督式表观遗传时钟是使用标准化的胞嘧啶-磷酸-鸟嘌呤 (CpG) 甲基化分数 (Beta值) 和一个带恒等连接的线性回归模型训练的。对于一个具有实测CpG Beta值的给定样本，该模型将表观遗传年龄预测为标准化输入的仿射函数。每个CpG特征的标准化 (z-score) 使用训练队列的均值和标准差。年龄加速在操作上定义为预测的表观遗传年龄与个体实足年龄之间的差值。\n\n现给定一个六-CpG时钟的以下信息。设CpG位点由 $i \\in \\{1,2,3,4,5,6\\}$ 索引。每个CpG的训练队列均值和标准差为：\n- $\\mu_{1} = 0.74$，$\\sigma_{1} = 0.05$；$\\mu_{2} = 0.36$，$\\sigma_{2} = 0.04$；$\\mu_{3} = 0.81$，$\\sigma_{3} = 0.03$；\n- $\\mu_{4} = 0.42$，$\\sigma_{4} = 0.06$；$\\mu_{5} = 0.55$，$\\sigma_{5} = 0.05$；$\\mu_{6} = 0.18$，$\\sigma_{6} = 0.02$。\n\n对于该样本，测得的CpG Beta值为：\n- $\\beta_{1} = 0.70$，$\\beta_{2} = 0.40$，$\\beta_{3} = 0.79$，$\\beta_{4} = 0.50$，$\\beta_{5} = 0.60$，$\\beta_{6} = 0.17$。\n\n训练后的模型系数 (特征权重) 和截距为：\n- $w_{1} = 8.0$, $w_{2} = -5.5$, $w_{3} = 12.0$, $w_{4} = 4.0$, $w_{5} = 6.5$, $w_{6} = -9.0$，以及截距 $b_{0} = 52.0$。\n\n该个体的实足年龄为 $50.0$ 岁。\n\n从z-score和带恒等连接的线性回归预测的核心定义出发，计算：\n1. 模型为此样本预测的表观遗传年龄 $\\hat{A}$。\n2. 年龄加速 $\\Delta A$，定义为 $\\hat{A}$ 减去实足年龄。\n\n将两个输出均以年为单位表示，并将您的最终数值结果四舍五入到四位有效数字。",
            "solution": "求解过程首先计算六个CpG位点中每一个的标准化输入特征 (z-score)，然后使用这些特征在提供的线性回归模型中预测表观遗传年龄。最后，根据其定义计算年龄加速。\n\n问题陈述指出，线性模型的输入特征是标准化的Beta值，即z-score。第 $i$ 个CpG位点的z-score，记作 $z_i$，使用以下公式计算：\n$$z_i = \\frac{\\beta_i - \\mu_i}{\\sigma_i}$$\n其中 $\\beta_i$ 是样本的实测Beta值，$\\mu_i$ 和 $\\sigma_i$ 分别是训练队列的均值和标准差。\n\n我们计算六个CpG位点（$i \\in \\{1, 2, 3, 4, 5, 6\\}$）中每一个的z-score：\n1.  对于CpG位点 $1$：$\\beta_1 = 0.70$, $\\mu_1 = 0.74$, $\\sigma_1 = 0.05$。\n    $$z_1 = \\frac{0.70 - 0.74}{0.05} = \\frac{-0.04}{0.05} = -0.8$$\n2.  对于CpG位点 $2$：$\\beta_2 = 0.40$, $\\mu_2 = 0.36$, $\\sigma_2 = 0.04$。\n    $$z_2 = \\frac{0.40 - 0.36}{0.04} = \\frac{0.04}{0.04} = 1.0$$\n3.  对于CpG位点 $3$：$\\beta_3 = 0.79$, $\\mu_3 = 0.81$, $\\sigma_3 = 0.03$。\n    $$z_3 = \\frac{0.79 - 0.81}{0.03} = \\frac{-0.02}{0.03} = -\\frac{2}{3}$$\n4.  对于CpG位点 $4$：$\\beta_4 = 0.50$, $\\mu_4 = 0.42$, $\\sigma_4 = 0.06$。\n    $$z_4 = \\frac{0.50 - 0.42}{0.06} = \\frac{0.08}{0.06} = \\frac{4}{3}$$\n5.  对于CpG位点 $5$：$\\beta_5 = 0.60$, $\\mu_5 = 0.55$, $\\sigma_5 = 0.05$。\n    $$z_5 = \\frac{0.60 - 0.55}{0.05} = \\frac{0.05}{0.05} = 1.0$$\n6.  对于CpG位点 $6$：$\\beta_6 = 0.17$, $\\mu_6 = 0.18$, $\\sigma_6 = 0.02$。\n    $$z_6 = \\frac{0.17 - 0.18}{0.02} = \\frac{-0.01}{0.02} = -0.5$$\n\n表观遗传年龄 $\\hat{A}$ 通过仿射函数 (带截距的线性回归模型) 预测：\n$$\\hat{A} = b_0 + \\sum_{i=1}^{6} w_i z_i$$\n其中 $b_0$ 是截距，$w_i$ 是模型系数。代入给定的系数和计算出的z-score：\n$$b_0 = 52.0, w_1 = 8.0, w_2 = -5.5, w_3 = 12.0, w_4 = 4.0, w_5 = 6.5, w_6 = -9.0$$\n求和项为：\n$$\\sum_{i=1}^{6} w_i z_i = w_1 z_1 + w_2 z_2 + w_3 z_3 + w_4 z_4 + w_5 z_5 + w_6 z_6$$\n$$\\sum_{i=1}^{6} w_i z_i = (8.0)(-0.8) + (-5.5)(1.0) + (12.0)(-\\frac{2}{3}) + (4.0)(\\frac{4}{3}) + (6.5)(1.0) + (-9.0)(-0.5)$$\n$$\\sum_{i=1}^{6} w_i z_i = -6.4 - 5.5 - 8.0 + \\frac{16}{3} + 6.5 + 4.5$$\n将各项相加，必要时使用分数以保持精度：\n$$\\sum_{i=1}^{6} w_i z_i = -19.9 + 11.0 + \\frac{16}{3} = -8.9 + \\frac{16}{3} = -\\frac{89}{10} + \\frac{16}{3} = \\frac{-267 + 160}{30} = -\\frac{107}{30}$$\n其小数值约为 $-3.5666...$。\n\n现在，我们计算预测的表观遗传年龄 $\\hat{A}$：\n$$\\hat{A} = 52.0 + (-\\frac{107}{30}) = \\frac{1560}{30} - \\frac{107}{30} = \\frac{1453}{30} \\approx 48.4333... \\text{ 岁}$$\n将此结果四舍五入到四位有效数字，得到：\n$$\\hat{A} \\approx 48.43 \\text{ 岁}$$\n\n接下来，我们计算年龄加速 $\\Delta A$，其定义为预测的表观遗传年龄与实足年龄 $A_{chrono}$ 之间的差值：\n$$\\Delta A = \\hat{A} - A_{chrono}$$\n给定实足年龄 $A_{chrono} = 50.0$ 岁，为确保准确性，我们使用 $\\hat{A}$ 的未四舍五入值：\n$$\\Delta A = \\frac{1453}{30} - 50.0 = \\frac{1453}{30} - \\frac{1500}{30} = -\\frac{47}{30} \\approx -1.5666... \\text{ 岁}$$\n将此结果四舍五入到四位有效数字，得到：\n$$\\Delta A \\approx -1.567 \\text{ 岁}$$\n\n所求的两个值是表观遗传年龄 $\\hat{A}$ 和年龄加速 $\\Delta A$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n48.43  -1.567\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在许多疾病研究中，最终目标是确定甲基化模式是否与疾病状态相关，同时需要校正其他影响因素。这项高级实践将介绍完成此任务所适用的统计学框架：广义线性模型 (Generalized Linear Model, GLM)。您将对汇总的测序数据拟合一个二项GLM，将甲基化概率建模为疾病、年龄和技术批次的函数，并学习如何解释模型结果以得出关于疾病特异性效应的有效结论。",
            "id": "5109769",
            "problem": "您将获得独立的个体中胞嘧啶-磷酸-鸟嘌呤（CpG）位点 DNA 甲基化的汇总亚硫酸氢盐测序数据。对于每个个体 $i$，您会观察到甲基化读取计数 $m_i$ 和总读取计数 $n_i$，以及协变量疾病状态 $D_i$（对照组 $0$，疾病组 $1$）、年龄 $A_i$（以年为单位）和批次 $B_i$（分类变量：A、B 或 C）。假设甲基化比例建模遵循分子和免疫诊断中的以下基本原理：每个 $m_i$ 在给定 $n_i$ 和甲基化概率 $p_i$ 的情况下，服从二项式随机变量分布，记为 $m_i \\sim \\mathrm{Binomial}(n_i,p_i)$，其中甲基化比例 $p_i \\in (0,1)$ 以小数形式表示。设协变量对甲基化概率的影响通过一个带有 logit 链接的广义线性模型进行关联，定义为 $\\mathrm{logit}(p_i)=\\log\\left(\\frac{p_i}{1-p_i}\\right)=\\mathbf{x}_i^\\top\\boldsymbol{\\beta}$，其中设计向量 $\\mathbf{x}_i$ 包括一个截距项、$D_i$、$A_i$ 以及 $B_i$ 的批次指示变量，并将批次 B 作为参考类别。使用虚拟变量，使得 $\\mathbf{x}_i=[1,D_i,A_i,\\mathbb{I}(B_i=\\mathrm{A}),\\mathbb{I}(B_i=\\mathrm{C})]$。\n\n您的任务是使用最大似然估计为以下三个测试用例拟合广义线性模型，并为每个用例计算以下用于解释疾病系数的量：\n- 估计的疾病状态系数 $\\hat{\\beta}_{\\mathrm{disease}}$（一个浮点数）。\n- 疾病状态优势比 $\\exp(\\hat{\\beta}_{\\mathrm{disease}})$（一个浮点数）。\n- 在标准正态近似下，$\\hat{\\beta}_{\\mathrm{disease}}$ 的双边 Wald 检验 $p$ 值（一个浮点数），以小数形式报告。\n- 一个布尔值，指示疾病是否增加甲基化概率，定义为 $\\exp(\\hat{\\beta}_{\\mathrm{disease}})1$。\n- 在年龄 $A^\\ast$ 和批次 B 的固定参考协变量配置下，预测甲基化概率的差异，等于 $\\Delta p = \\sigma(\\hat{\\beta}_0+\\hat{\\beta}_A A^\\ast+\\hat{\\beta}_{\\mathrm{disease}})-\\sigma(\\hat{\\beta}_0+\\hat{\\beta}_A A^\\ast)$，其中 $\\sigma(z)=\\frac{1}{1+\\exp(-z)}$，$A^\\ast$ 固定为 $60$，并且批次 A 和 C 的指示变量设置为 $0$ 以代表参考批次 B。以小数形式报告 $\\Delta p$。\n\n请遵循以下通用建模说明：\n- 使用二项式模型 $m_i \\sim \\mathrm{Binomial}(n_i,p_i)$ 和规范 logit 链接 $\\mathrm{logit}(p_i)=\\mathbf{x}_i^\\top\\boldsymbol{\\beta}$。\n- 构建包含截距项和指定协变量的设计矩阵，将批次 B 作为参考，使其虚拟变量为 $0$。\n- 通过最大似然法拟合模型，并从解处的观测 Fisher 信息中获取 $\\hat{\\boldsymbol{\\beta}}$ 的渐近方差。\n- 将疾病系数的 Wald 统计量计算为 $z=\\hat{\\beta}_{\\mathrm{disease}}/\\mathrm{SE}(\\hat{\\beta}_{\\mathrm{disease}})$，并使用标准正态分布计算双边 $p$ 值。\n\n所有甲基化比例必须以小数（而非百分比形式）处理。此任务中不涉及角度量。最终程序应生成单行输出，其中包含三个测试用例的结果，结果为方括号内以逗号分隔的列表。每个测试用例的结果本身应是按 $[\\hat{\\beta}_{\\mathrm{disease}},\\exp(\\hat{\\beta}_{\\mathrm{disease}}),p\\text{-值},\\text{布尔值},\\Delta p]$ 顺序排列的列表。\n\n测试套件：\n\n测试用例 1（中等覆盖度，平衡组）：\n- $m=\\{\\,38,55,39,54,41,88,38,60,45,66,24,56\\,\\}$\n- $n=\\{\\,100,95,110,100,90,120,80,100,85,100,75,95\\,\\}$\n- $D=\\{\\,0,1,0,1,0,1,0,1,0,1,0,1\\,\\}$\n- $A=\\{\\,50,52,60,58,45,65,70,55,62,48,52,68\\,\\}$\n- $B=\\{\\,\\mathrm{B},\\mathrm{B},\\mathrm{A},\\mathrm{A},\\mathrm{C},\\mathrm{C},\\mathrm{B},\\mathrm{B},\\mathrm{C},\\mathrm{C},\\mathrm{A},\\mathrm{A}\\,\\}$\n\n测试用例 2（小计数，包括零成功的边界行为）：\n- $m=\\{\\,6,4,1,0,36,30,2,1\\,\\}$\n- $n=\\{\\,20,20,5,2,50,50,10,10\\,\\}$\n- $D=\\{\\,0,1,0,1,0,1,0,1\\,\\}$\n- $A=\\{\\,40,40,30,30,70,70,25,25\\,\\}$\n- $B=\\{\\,\\mathrm{B},\\mathrm{B},\\mathrm{A},\\mathrm{A},\\mathrm{C},\\mathrm{C},\\mathrm{B},\\mathrm{B}\\,\\}$\n\n测试用例 3（强疾病效应，高覆盖度，非参考批次变异）：\n- $m=\\{\\,31,67,18,46,44,86,31,63,25,46\\,\\}$\n- $n=\\{\\,100,100,80,80,120,120,90,90,60,60\\,\\}$\n- $D=\\{\\,0,1,0,1,0,1,0,1,0,1\\,\\}$\n- $A=\\{\\,60,60,50,50,55,55,45,45,35,35\\,\\}$\n- $B=\\{\\,\\mathrm{B},\\mathrm{B},\\mathrm{A},\\mathrm{A},\\mathrm{C},\\mathrm{C},\\mathrm{B},\\mathrm{B},\\mathrm{C},\\mathrm{C}\\,\\}$\n\n您的程序应生成单行输出，其中包含一个方括号括起来的、以逗号分隔的列表形式的结果（例如，$[\\,[r_{11},r_{12},r_{13},r_{14},r_{15}],\\,[r_{21},r_{22},r_{23},r_{24},r_{25}],\\,[r_{31},r_{32},r_{33},r_{34},r_{35}]\\,]$），其中每个 $r_{jk}$ 是一个浮点数或布尔值，顺序如上文对测试用例 $j$ 和指标 $k$ 所指定。",
            "solution": "该问题要求对亚硫酸氢盐测序数据拟合一个广义线性模型（GLM），以分析 DNA 甲基化与疾病状态之间的关联，同时对协变量进行调整。该模型的核心假设是，个体 $i$ 的甲基化读取数 $m_i$ 服从二项分布，即 $m_i \\sim \\mathrm{Binomial}(n_i, p_i)$，其中 $n_i$ 是总读取数，$p_i$ 是特定 CpG 位点上未知的甲基化概率。\n\n**模型设定**\n甲基化概率 $p_i$ 与一组协变量之间的关系通过一个链接函数进行建模。指定的模型是带有 logit 链接函数的二项 GLM，这是二项分布族的规范链接，可确保预测概率 $p_i$ 被限制在区间 $(0, 1)$ 内。该模型定义为：\n$$\n\\mathrm{logit}(p_i) = \\log\\left(\\frac{p_i}{1-p_i}\\right) = \\eta_i = \\mathbf{x}_i^\\top \\boldsymbol{\\beta}\n$$\n这里，$\\eta_i$ 是第 $i$ 个观测值的线性预测器。协变量向量 $\\mathbf{x}_i$ 由 $\\mathbf{x}_i = [1, D_i, A_i, \\mathbb{I}(B_i=\\mathrm{A}), \\mathbb{I}(B_i=\\mathrm{C})]^\\top$ 给出，其中 $1$ 代表截距项，$D_i$ 是疾病状态（$0$ 或 $1$），$A_i$ 是年龄，$\\mathbb{I}(\\cdot)$ 是批次效应的指示函数，批次 B 作为参考类别。待估计的相应系数向量是 $\\boldsymbol{\\beta} = [\\beta_0, \\beta_{\\mathrm{disease}}, \\beta_A, \\beta_{B=\\mathrm{A}}, \\beta_{B=\\mathrm{C}}]^\\top$。\n\nlogit 链接函数的反函数是 logistic sigmoid 函数，$\\sigma(z) = \\frac{1}{1 + \\exp(-z)}$，它将线性预测器映射回概率尺度：$p_i = \\sigma(\\eta_i)$。\n\n**最大似然估计 (MLE)**\n系数 $\\boldsymbol{\\beta}$ 通过最大化对数似然函数来估计。对于 $N$ 个独立观测值，对数似然函数为：\n$$\n\\mathcal{L}(\\boldsymbol{\\beta}) = \\sum_{i=1}^N \\left( \\log\\binom{n_i}{m_i} + m_i \\log(p_i) + (n_i - m_i) \\log(1-p_i) \\right)\n$$\n代入 $p_i = \\sigma(\\mathbf{x}_i^\\top \\boldsymbol{\\beta})$，并经过一些代数简化后，关于 $\\boldsymbol{\\beta}$ 的对数似然函数变为：\n$$\n\\mathcal{L}(\\boldsymbol{\\beta}) = \\sum_{i=1}^N \\left( \\log\\binom{n_i}{m_i} + m_i(\\mathbf{x}_i^\\top \\boldsymbol{\\beta}) - n_i \\log(1 + \\exp(\\mathbf{x}_i^\\top \\boldsymbol{\\beta})) \\right)\n$$\n最大似然估计 $\\hat{\\boldsymbol{\\beta}}$ 是使该函数最大化的 $\\boldsymbol{\\beta}$ 值。由于带有规范链接的 GLM 的对数似然函数是凹函数，因此存在唯一的最大值。此最大化过程是数值执行的，通常使用诸如 Newton-Raphson 或迭代重加权最小二乘法（IRLS）之类的迭代算法。这些方法需要对数似然函数的梯度（得分向量）和 Hessian 矩阵。\n\n梯度由下式给出：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\boldsymbol{\\beta}} = \\sum_{i=1}^N (m_i - n_i p_i) \\mathbf{x}_i = \\mathbf{X}^\\top (\\mathbf{m} - n\\mathbf{p})\n$$\nHessian 矩阵为：\n$$\n\\mathbf{H}(\\boldsymbol{\\beta}) = \\frac{\\partial^2 \\mathcal{L}}{\\partial \\boldsymbol{\\beta} \\partial \\boldsymbol{\\beta}^\\top} = -\\sum_{i=1}^N n_i p_i (1 - p_i) \\mathbf{x}_i \\mathbf{x}_i^\\top = -\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X}\n$$\n其中 $\\mathbf{X}$ 是以 $\\mathbf{x}_i^\\top$ 为行的设计矩阵，$\\mathbf{W}$ 是一个对角矩阵，其对角元素为 $W_{ii} = n_i p_i (1-p_i)$。\n\n**推断和所需量的计算**\n一旦获得 MLE $\\hat{\\boldsymbol{\\beta}}$，我们就可以进行统计推断。估计量的渐近方差-协方差矩阵是解处评估的观测 Fisher 信息矩阵 $\\mathcal{I}(\\hat{\\boldsymbol{\\beta}})$ 的逆矩阵：\n$$\n\\mathrm{Var}(\\hat{\\boldsymbol{\\beta}}) \\approx \\mathcal{I}(\\hat{\\boldsymbol{\\beta}})^{-1} = (-\\mathbf{H}(\\hat{\\boldsymbol{\\beta}}))^{-1} = (\\mathbf{X}^\\top \\mathbf{W}(\\hat{\\boldsymbol{\\beta}}) \\mathbf{X})^{-1}\n$$\n单个系数估计的标准误差 $\\mathrm{SE}(\\hat{\\beta}_j)$ 是此方差-协方差矩阵相应对角元素的平方根。\n\n然后按如下方式计算所需的量：\n1.  **估计的疾病系数 ($\\hat{\\beta}_{\\mathrm{disease}}$)**：这是估计向量 $\\hat{\\boldsymbol{\\beta}}$ 的第二个元素。\n2.  **优势比 ($\\exp(\\hat{\\beta}_{\\mathrm{disease}})$)**：这表示在保持所有其他协变量不变的情况下，患病受试者（$D=1$）与对照组受试者（$D=0$）相比，甲基化优势变化的因子。\n3.  **Wald 检验 $p$ 值**：对于原假设 $H_0: \\beta_{\\mathrm{disease}}=0$ 的双边 Wald 检验统计量为 $z = \\hat{\\beta}_{\\mathrm{disease}} / \\mathrm{SE}(\\hat{\\beta}_{\\mathrm{disease}})$。在原假设下，该统计量服从标准正态分布。$p$ 值计算为 $p = 2 \\cdot (1 - \\Phi(|z|))$，其中 $\\Phi$ 是标准正态分布的累积分布函数。\n4.  **效应方向的布尔值**：这只是简单地判断 $\\exp(\\hat{\\beta}_{\\mathrm{disease}})  1$。如果为真，则疾病与甲基化优势的增加相关。\n5.  **预测甲基化概率的差异 ($\\Delta p$)**：这是在固定的参考配置下计算的：年龄 $A^\\ast=60$ 和批次 B。对于此配置，患病个体和对照组个体的线性预测器分别为 $\\eta_{1} = \\hat{\\beta}_0 + \\hat{\\beta}_{\\mathrm{disease}} + 60\\hat{\\beta}_A$ 和 $\\eta_{0} = \\hat{\\beta}_0 + 60\\hat{\\beta}_A$。预测概率的差异则为 $\\Delta p = \\sigma(\\eta_{1}) - \\sigma(\\eta_{0})$。\n\n将对每个测试用例应用以下计算过程以得出最终结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Solves the DNA methylation GLM problem for three test cases.\n    \"\"\"\n    test_cases = [\n        # Test case 1 (moderate coverage, balanced groups):\n        {\n            \"m\": [38, 55, 39, 54, 41, 88, 38, 60, 45, 66, 24, 56],\n            \"n\": [100, 95, 110, 100, 90, 120, 80, 100, 85, 100, 75, 95],\n            \"D\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"A\": [50, 52, 60, 58, 45, 65, 70, 55, 62, 48, 52, 68],\n            \"B\": ['B', 'B', 'A', 'A', 'C', 'C', 'B', 'B', 'C', 'C', 'A', 'A']\n        },\n        # Test case 2 (small counts, boundary behavior including zero successes):\n        {\n            \"m\": [6, 4, 1, 0, 36, 30, 2, 1],\n            \"n\": [20, 20, 5, 2, 50, 50, 10, 10],\n            \"D\": [0, 1, 0, 1, 0, 1, 0, 1],\n            \"A\": [40, 40, 30, 30, 70, 70, 25, 25],\n            \"B\": ['B', 'B', 'A', 'A', 'C', 'C', 'B', 'B']\n        },\n        # Test case 3 (strong disease effect, high coverage, non-reference batch variation):\n        {\n            \"m\": [31, 67, 18, 46, 44, 86, 31, 63, 25, 46],\n            \"n\": [100, 100, 80, 80, 120, 120, 90, 90, 60, 60],\n            \"D\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"A\": [60, 60, 50, 50, 55, 55, 45, 45, 35, 35],\n            \"B\": ['B', 'B', 'A', 'A', 'C', 'C', 'B', 'B', 'C', 'C']\n        }\n    ]\n\n    results = []\n    for case_data in test_cases:\n        m_vec = np.array(case_data[\"m\"])\n        n_vec = np.array(case_data[\"n\"])\n        D_vec = np.array(case_data[\"D\"])\n        A_vec = np.array(case_data[\"A\"])\n        B_cat = case_data[\"B\"]\n\n        # 1. Construct the design matrix X\n        num_obs = len(m_vec)\n        X = np.zeros((num_obs, 5))\n        X[:, 0] = 1  # Intercept\n        X[:, 1] = D_vec  # Disease status\n        X[:, 2] = A_vec  # Age\n        X[:, 3] = np.array([1 if b == 'A' else 0 for b in B_cat])  # Batch A\n        X[:, 4] = np.array([1 if b == 'C' else 0 for b in B_cat])  # Batch C\n\n        # 2. Define objective function (negative log-likelihood), gradient, and Hessian\n        def neg_log_likelihood(beta, X, m, n):\n            eta = X @ beta\n            # Use logaddexp for numerical stability: log(1 + exp(eta))\n            log_p_denom = np.logaddexp(0, eta)\n            log_lik = m * eta - n * log_p_denom\n            return -np.sum(log_lik)\n\n        def gradient(beta, X, m, n):\n            eta = X @ beta\n            p = 1 / (1 + np.exp(-eta))\n            # grad is sum over i of (n_i * p_i - m_i) * x_i\n            grad = (n * p - m) @ X\n            return grad\n\n        def hessian(beta, X, m, n):\n            eta = X @ beta\n            p = 1 / (1 + np.exp(-eta))\n            w = n * p * (1 - p)\n            W = np.diag(w)\n            hess = X.T @ W @ X\n            return hess\n\n        # 3. Perform optimization to find MLE for beta\n        initial_beta = np.zeros(X.shape[1])\n        opt_res = minimize(\n            fun=neg_log_likelihood,\n            x0=initial_beta,\n            args=(X, m_vec, n_vec),\n            method='Newton-CG',\n            jac=gradient,\n            hess=hessian,\n            options={'xtol': 1e-8, 'disp': False}\n        )\n        beta_hat = opt_res.x\n\n        # 4. Calculate the required quantities\n        # Estimated disease coefficient\n        beta_disease = beta_hat[1]\n\n        # Asymptotic covariance matrix\n        fisher_info_matrix = hessian(beta_hat, X, m_vec, n_vec)\n        cov_matrix = np.linalg.inv(fisher_info_matrix)\n        \n        # Standard error for the disease coefficient\n        se_beta_disease = np.sqrt(cov_matrix[1, 1])\n        \n        # Two-sided Wald test\n        wald_z_statistic = beta_disease / se_beta_disease\n        p_value = 2 * norm.sf(np.abs(wald_z_statistic))\n        \n        # Odds ratio\n        odds_ratio = np.exp(beta_disease)\n        \n        # Boolean indicating if methylation increases with disease\n        increases_methylation = odds_ratio > 1\n\n        # Difference in predicted methylation probability\n        def sigmoid(z):\n            return 1 / (1 + np.exp(-z))\n        \n        age_star = 60.0\n        # Linear predictors for a reference individual (Batch B, Age=60)\n        # beta_hat[0] is intercept, [1] is disease, [2] is age\n        eta_control = beta_hat[0] + beta_hat[2] * age_star\n        eta_disease = beta_hat[0] + beta_hat[1] + beta_hat[2] * age_star\n        \n        p_control = sigmoid(eta_control)\n        p_disease = sigmoid(eta_disease)\n        delta_p = p_disease - p_control\n        \n        case_result = [\n            float(beta_disease),\n            float(odds_ratio),\n            float(p_value),\n            bool(increases_methylation),\n            float(delta_p)\n        ]\n        results.append(case_result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}