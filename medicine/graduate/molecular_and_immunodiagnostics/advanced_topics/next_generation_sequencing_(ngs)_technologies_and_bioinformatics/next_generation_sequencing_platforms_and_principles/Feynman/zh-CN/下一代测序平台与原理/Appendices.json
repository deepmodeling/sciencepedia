{
    "hands_on_practices": [
        {
            "introduction": "对于任何使用NGS的科学家来说，一项基本技能是理解如何估算一次测序运行的数据产出。本实践练习将指导您从第一性原理出发，计算预期的测序产量，将流动槽设计和读长等核心仪器参数与最终产生的千兆碱基（Gb）数据直接联系起来。掌握这种计算方法，可以让您对合成法测序（sequencing by synthesis）的大规模并行特性有一个具体的理解。",
            "id": "5140026",
            "problem": "下一代测序（NGS）中高通量合成测序的一个核心原理是，每个测序循环都会为每个通过仪器质量筛选（通常称为通过滤网，PF）的簇添加一个核苷酸。如果产量严格定义为读段1和读段2中碱基的总和，则索引循环对报告的基因组产量没有贡献。Illumina型仪器上的图案化流动池被分割成泳道内的多个瓦片（tiles）；每个瓦片的簇数量和PF分数决定了每个循环中产生碱基检出的可用簇数量。\n\n考虑一次具有以下科学上真实且内部一致参数的运行：\n- 泳道：每个流动池有$2$个泳道。\n- 瓦片：每个泳道有$400$个成像瓦片。\n- 簇：在簇生成结束和PF过滤之前，每个瓦片平均有$5.0 \\times 10^{5}$个簇，均匀分布在所有瓦片和泳道上。\n- 通过滤网（PF）分数：$0.82$的簇通过供应商的纯度滤网，假设在所有瓦片和泳道上均匀应用。\n- 读段结构和循环：读段$1$使用$150$个循环，索引$1$使用$8$个循环，索引$2$使用$8$个循环，读段$2$使用$150$个循环。只有读段$1$和读段$2$对报告的产量有贡献。\n- 制造商针对此流动池和读段结构列出的规格：每个流动池$100$吉碱基作为标称产量目标。\n\n从基本原理出发，即每个对报告读段有贡献的测序循环中，每个PF簇产生一个碱基，并且PF簇的总数等于泳道数、每泳道瓦片数、每瓦片簇数和PF分数的乘积，计算本次运行产生的预期总碱基数，并将结果转换为吉碱基。使用$1 \\text{吉碱基} = 10^9 \\text{碱基}$。\n\n在您的推理中说明结果是否在仪器所列规格的$\\pm 10\\%$范围内，但最终答案只提供以吉碱基为单位的预期产量的数值。将您的最终答案四舍五入到四位有效数字，并以吉碱基（Gb）表示。",
            "solution": "计算的基本依据是，在合成测序中，每个测序循环都会为每个通过质量指标的簇附加一个核苷酸，因此每个适用的循环中，每个PF簇贡献一个碱基检出。索引循环会为索引读段添加碱基，但如果产量仅定义为读段$1$和读段$2$中的碱基，则它们对报告的基因组产量没有贡献。因此，报告的总碱基数是PF簇的数量乘以读段$1$和读段$2$中的总循环数。\n\n首先，计算在PF过滤之前整个流动池上的簇总数。有$2$个泳道，每个泳道$400$个瓦片，每个瓦片$5.0 \\times 10^{5}$个簇，总数为\n$$\nN_{\\text{clusters, total}} \\;=\\; 2 \\times 400 \\times \\left(5.0 \\times 10^{5}\\right) \\;=\\; 4.0 \\times 10^{8}.\n$$\n\n接下来，应用通过滤网分数$0.82$来获得可用簇的数量：\n$$\nN_{\\text{PF}} \\;=\\; 0.82 \\times \\left(4.0 \\times 10^{8}\\right) \\;=\\; 3.28 \\times 10^{8}.\n$$\n\n现在确定对报告产量有贡献的循环数。读段$1$贡献$150$个循环，读段$2$贡献$150$个循环，而索引$1$（$8$个循环）和索引$2$（$8$个循环）在所述定义下被排除在报告产量之外。因此，报告的总循环数是\n$$\nC_{\\text{reporting}} \\;=\\; 150 + 150 \\;=\\; 300.\n$$\n\n报告的总碱基数是PF簇数量与报告循环数的乘积：\n$$\nB_{\\text{total}} \\;=\\; N_{\\text{PF}} \\times C_{\\text{reporting}} \\;=\\; \\left(3.28 \\times 10^{8}\\right)\\times 300 \\;=\\; 9.84 \\times 10^{10} \\;\\text{bases}.\n$$\n\n使用$1 \\text{吉碱基} = 10^9 \\text{碱基}$将其转换为吉碱基：\n$$\nY_{\\text{Gb}} \\;=\\; \\frac{9.84 \\times 10^{10}}{10^{9}} \\;=\\; 98.4 \\;\\text{gigabases}.\n$$\n\n为了验证与仪器规格的一致性，将$98.4$吉碱基与标称的$100$吉碱基进行比较。分数偏差为\n$$\n\\frac{98.4 - 100}{100} \\;=\\; -0.016 \\;=\\; -1.6 \\times 10^{-2},\n$$\n这对应于幅度为$0.016$的偏差，即分数形式的$1.6 \\times 10^{-2}$，它在$\\pm 0.10$（即$\\pm 10\\%$的容差）范围内。因此，预期产量与仪器所列规格一致。\n\n最后，将数值产量四舍五入到四位有效数字。值$98.4$吉碱基有三位有效数字；要报告四位有效数字，写作$98.40$。\n\n因此，预期产量四舍五入到四位有效数字为$98.40$吉碱基。",
            "answer": "$$\\boxed{98.40}$$"
        },
        {
            "introduction": "虽然产生大量数据很重要，但确保其在定量应用中的准确性则至关重要。本练习通过一个经典的概率框架来模拟“碰撞”概率，从而深入探讨了用于精确分子计数的关键技术——独特分子标签（UMI）。通过解决这个问题，您将体会到理论极限如何为实际的实验设计提供信息，以避免低估不同分子的数量。",
            "id": "5139981",
            "problem": "在一项新一代测序 (NGS) 免疫诊断分析中，唯一分子标识符 (UMI) 是长度为 $L$ 的随机核苷酸标签，在聚合酶链式反应 (PCR) 扩增之前，这些标签被附加到互补脱氧核糖核酸 (cDNA) 分子上，用于对读数进行去重并估计分子数量。假设每个 UMI 都是从字母表 $\\{A,C,G,T\\}$ 中均匀、随机且独立地抽取的，因此 UMI 空间的大小为 $S=4^L$。当两个或更多个不同的分子获得了相同的 UMI 时，就会发生碰撞。在理想化的随机分配模型下，请从第一性原理推导在 $n$ 个分子中至少发生一次碰撞的近似概率，并使用基础概率方法推导成对碰撞的期望数，过程中不得使用预先推导出的快捷公式。然后，对于 $L=12$ 和 $n=250{,}000$ 的情况，计算成对碰撞的期望数。将您的最终数值答案四舍五入至三位有效数字。最终答案以纯计数形式表示（无单位）。",
            "solution": "本问题要求我们推导与UMI碰撞相关的概率和期望值。UMI空间的大小为 $S = 4^L$。我们为 $n$ 个分子分配UMI。\n\n#### 第1部分：至少发生一次碰撞的近似概率\n我们首先计算没有碰撞发生的概率 $P(\\text{no collision})$。这意味着所有 $n$ 个分子都被分配了不同的UMI。\n$$P(\\text{no collision}) = \\frac{S(S-1)\\dots(S-n+1)}{S^n} = \\prod_{k=0}^{n-1} \\left(1 - \\frac{k}{S}\\right)$$\n当 $n \\ll S$ 时，使用近似 $\\ln(1-x) \\approx -x$ 可得：\n$$ \\ln(P(\\text{no collision})) = \\sum_{k=0}^{n-1} \\ln\\left(1 - \\frac{k}{S}\\right) \\approx \\sum_{k=0}^{n-1} \\left(-\\frac{k}{S}\\right) = -\\frac{n(n-1)}{2S} $$\n因此，$P(\\text{no collision}) \\approx \\exp\\left(-\\frac{n(n-1)}{2S}\\right)$。至少发生一次碰撞的概率 $P(\\text{at least one collision})$ 为：\n$$P(\\text{at least one collision}) \\approx 1 - \\exp\\left(-\\frac{n(n-1)}{2S}\\right)$$\n\n#### 第2部分：成对碰撞的期望数\n我们想求被分配了相同UMI的分子对的期望数。总共有 $\\binom{n}{2}$ 对不同的分子。\n对于任意一对分子，它们被分配相同UMI的概率是 $\\frac{1}{S}$。\n根据期望的线性性，成对碰撞的总期望数 $E[N_c]$ 是所有分子对的碰撞概率之和：\n$$E[N_c] = \\binom{n}{2} \\times \\frac{1}{S} = \\frac{n(n-1)}{2S}$$\n\n#### 第3部分：数值计算\n给定 $L=12$ 和 $n=250,000$。\nUMI空间大小为 $S = 4^{12} = 16,777,216$。\n成对碰撞的期望数为：\n$$E[N_c] = \\frac{250,000 \\times (250,000 - 1)}{2 \\times 16,777,216} = \\frac{250,000 \\times 249,999}{33,554,432} \\approx 1862.616$$\n将结果四舍五入至三位有效数字，得到1860。",
            "answer": "$$\\boxed{1860}$$"
        },
        {
            "introduction": "多重测序（即将多个样本混合在一次测序中）对于经济高效地使用NGS至关重要，但它也引入了样本间交叉污染的风险。本练习将探讨“索引跳跃”（index hopping）现象，并定量地证明使用独特双索引（unique dual indexes）在减轻这一关键问题上的优势。理解这一原理对于设计稳健的实验至关重要，尤其是在对样本完整性要求极高的敏感诊断应用中。",
            "id": "5139951",
            "problem": "一次多重下一代测序（NGS）运行汇集了 $N$ 个等量的样本，每个样本都用索引序列进行标记，以便进行解复用。考虑两种解复用策略：\n- 单索引，使用一个索引（例如，Illumina i7 索引）。\n- 唯一双索引（UDI），使用两个独立的索引（例如，i7 和 i5），解复用时需要精确的索引对匹配。\n\n索引跳跃定义如下：对于测序读长（read）上的每个索引，它有 $h$ 的概率被替换为从池中其他 $N-1$ 个索引序列中随机选择的一个索引（也就是说，替换后的索引永远不等于原始索引），并有 $1-h$ 的概率保持不变。对于双索引，两个索引根据相同的规则独立地发生跳跃。解复用通过精确索引匹配（对于单索引）或精确索引对匹配（对于 UDI）将读长分配给样本；任何观测到的索引（单索引）或索引对（UDI）与任何样本的指定标签不匹配的读长都将被丢弃，不会造成污染。\n\n将给定样本的污染分数定义为分配给该样本的、但来源于池中其他样本的读长的期望分数。仅使用概率公理、全概率定律以及索引跳跃事件的独立性，推导出单索引和 UDI 下污染分数的封闭形式表达式，该表达式是跳跃率 $h$ 和池大小 $N$ 的函数。假设所有样本对池的贡献相等。\n\n将污染分数表示为小数或分数。以单行矩阵 $\\begin{pmatrix}C_{\\text{single}}  C_{\\text{dual}}\\end{pmatrix}$ 的形式给出你的最终答案，用 $h$ 和 $N$ 表示。",
            "solution": "设 $N$ 为池中样本的数量， $h$ 为单个索引发生跳跃的概率。一个读长来自样本 $i$ 的事件为 $R_i$，被分配给样本 $j$ 的事件为 $A_j$。由于样本量相等且对称，样本1的污染分数 $C$ 为：\n$$C = \\frac{(N-1) P(A_1 | R_i, i \\neq 1)}{P(A_1 | R_1) + (N-1) P(A_1 | R_i, i \\neq 1)}$$\n其中 $P(A_1 | R_1)$ 是正确分配的概率，$P(A_1 | R_i, i \\neq 1)$ 是来自其他样本的读长被错误分配的概率。\n\n**单索引 ($C_{\\text{single}}$)**\n1.  **正确分配** ($P(A_1 | R_1)$): 读长来自样本1，其索引未发生跳跃。概率为 $1-h$。\n2.  **错误分配** ($P(A_1 | R_i, i \\neq 1)$): 读长来自样本 $i$，其索引必须跳跃成样本1的索引。这需要索引发生跳跃（概率 $h$），并且从其他 $N-1$ 个索引中恰好选中了样本1的索引（概率 $\\frac{1}{N-1}$）。总概率为 $h \\times \\frac{1}{N-1} = \\frac{h}{N-1}$。\n\n代入公式：\n$$C_{\\text{single}} = \\frac{(N-1) \\left(\\frac{h}{N-1}\\right)}{(1-h) + (N-1) \\left(\\frac{h}{N-1}\\right)} = \\frac{h}{1-h+h} = h$$\n\n**唯一双索引 ($C_{\\text{dual}}$)**\n每个读长有两个独立的索引，都需要正确匹配。\n1.  **正确分配** ($P(A_1 | R_1)$): 两个索引都未发生跳跃。由于事件独立，概率为 $(1-h)(1-h) = (1-h)^2$。\n2.  **错误分配** ($P(A_1 | R_i, i \\neq 1)$): 读长来自样本 $i$，其两个索引都必须跳跃成样本1对应的索引。每次跳跃并选中正确索引的概率均为 $\\frac{h}{N-1}$。由于事件独立，总概率为 $\\left(\\frac{h}{N-1}\\right) \\left(\\frac{h}{N-1}\\right) = \\frac{h^2}{(N-1)^2}$。\n\n代入公式：\n$$C_{\\text{dual}} = \\frac{(N-1) \\frac{h^2}{(N-1)^2}}{(1-h)^2 + (N-1) \\frac{h^2}{(N-1)^2}} = \\frac{\\frac{h^2}{N-1}}{(1-h)^2 + \\frac{h^2}{N-1}}$$\n将分子和分母同乘以 $(N-1)$ 进行简化：\n$$C_{\\text{dual}} = \\frac{h^2}{(N-1)(1-h)^2 + h^2}$$\n\n因此，污染分数的最终表达式为 $C_{\\text{single}} = h$ 和 $C_{\\text{dual}} = \\frac{h^2}{(N-1)(1-h)^2 + h^2}$。",
            "answer": "$$\\boxed{\\begin{pmatrix}h  \\frac{h^2}{(N-1)(1-h)^2 + h^2}\\end{pmatrix}}$$"
        }
    ]
}