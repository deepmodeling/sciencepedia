{
    "hands_on_practices": [
        {
            "introduction": "任何诊断检测方法的核心问题是其区分真实信号与背景噪音的能力。检测限（Limit of Detection, LoD）是衡量此能力的关键性能指标。这个练习将带你超越LoD的简单定义，通过处理模拟的实验数据，亲手计算免疫分析的LoD。你将深入理解非特异性相互作用等分子决定因素如何转化为可量化的背景噪音，并学习如何基于统计置信度建立一个可靠的检测阈值。",
            "id": "5134067",
            "problem": "正在优化一种夹心免疫分析法，用于量化一种循环糖蛋白生物标志物，其表位亲和力和非特异性结合是已知的分析背景信号的分子决定因素。读数是荧光强度，单位为任意单位（a.u.）。在空白条件下（无分析物，基质匹配），实验室收集了 $n=12$ 次独立重复的荧光读数：$\\{40.2, 39.8, 41.1, 40.5, 38.9, 39.7, 40.3, 40.0, 41.4, 39.1, 40.6, 40.9\\}$。通过加标标准品在低浓度范围内获得了线性校准曲线，在空白附近，平均信号由 $S(C) = \\mu_{\\text{blank}} + m\\,C$ 描述，斜率 $m = 5.0$ a.u. 每 ng/mL，其中 $C$ 是分析物的浓度，单位为 ng/mL。假设空白测量是独立同分布的，并且背景信号的来源是由许多微小的、可加和的分子过程引起的，例如非特异性抗体-抗原相互作用、自发荧光和仪器噪声。\n\n使用检测限（LoD）的定义，即在高斯噪声模型下，以受控的假阳性风险超过空白信号的最小信号，通过 $LoD_{\\text{signal}} = \\mu_{\\text{blank}} + 3\\,\\sigma_{\\text{blank}}$ 计算以信号单位表示的LoD，其中 $\\mu_{\\text{blank}}$ 和 $\\sigma_{\\text{blank}}$ 分别是空白读数的样本均值和无偏样本标准差。然后使用提供的局部线性校准将此决策阈值转换为浓度单位，$LoD_{\\text{conc}} = (LoD_{\\text{signal}} - \\mu_{\\text{blank}})/m$。以 ng/mL 为单位表示您的最终答案 $LoD_{\\text{conc}}$。将您的答案四舍五入到四位有效数字。\n\n除了计算之外，请基于测量噪声聚合的第一性原理和非特异性信号的分子决定因素，对空白分布的正态性和低浓度范围内的方差齐性（恒定方差）所需的假设进行有原则的讨论。",
            "solution": "问题陈述已经过严格验证，被认为是合理的。它具有科学依据，提法明确且客观。为得出唯一且有意义的解，所有必需的数据、定义和条件均已提供。该问题是统计学原理在分析化学领域确定检测限（LoD）的标准应用，与分子诊断领域直接相关。因此，我将提供完整的解答。\n\n问题要求分为两部分：计算以浓度单位表示的检测限（$LoD_{\\text{conc}}$）和对基本统计假设的有原则的讨论。\n\n首先，我将阐述正态性和方差齐性假设的理论依据。\n问题假设空白测量遵循高斯（正态）分布。这一假设由中心极限定理（CLT）提供支持。免疫分析中的背景信号并非由单一过程引起，而是大量微小的、独立的或弱相关的随机事件的聚合效应。如问题所述，这些事件包括抗体试剂与分析板表面的非特异性结合、生物基质和塑料孔的自发荧光，以及测量仪器的电子噪声（例如，光电探测器中的热噪声和散粒噪声）。如果测得的总背景噪声是代表这些独立分子和物理事件的大量随机变量之和，那么中心极限定理预测，只要没有单一噪声源占绝对主导地位，这个总和的分布将近似于正态分布，而与各个构成过程的具体概率分布无关。\n\n第二个关键假设是方差齐性，即在校准曲线的低浓度范围（包括空白）内，方差（$\\sigma^2$）是恒定的。一次测量的总方差 $\\sigma^2(C)$ 可以建模为分析物浓度 $C$ 的函数。通常，该方差至少包含两个部分：一个常数项 $\\sigma_{\\text{blank}}^2$，代表了上述背景噪声源的方差；以及一个与信号相关的项，该项通常随平均信号 $S(C)$ 的增加而增加。例如，光子检测遵循泊松统计，其方差等于检测到的光子数的平均值。因此，一个更完整的模型可能是 $\\sigma^2(C) = \\sigma_0^2 + k \\cdot S(C)$，其中 $\\sigma_0^2$ 是与信号无关的方差，而 $k$ 是一个比例常数。当浓度接近零（$C \\to 0$）时，信号 $S(C)$ 接近空白信号 $\\mu_{\\text{blank}}$。在此范围内，与恒定的背景方差相比，信号对总方差的贡献是微乎其微的。因此，假设方差是恒定的并且等于空白方差（$\\sigma^2(C) \\approx \\sigma_{\\text{blank}}^2$），是确定 LoD 时一个合理且广泛使用的简化方法。\n\n现在，我将进行计算。问题提供了 $n=12$ 次独立空白重复读数：\n$x = \\{40.2, 39.8, 41.1, 40.5, 38.9, 39.7, 40.3, 40.0, 41.4, 39.1, 40.6, 40.9\\}$，单位为任意单位 (a.u.)。\n\n样本均值 $\\mu_{\\text{blank}}$ 按这些读数的算术平均值计算：\n$$ \\mu_{\\text{blank}} = \\frac{1}{n} \\sum_{i=1}^{n} x_i $$\n$$ \\mu_{\\text{blank}} = \\frac{1}{12} (40.2 + 39.8 + 41.1 + 40.5 + 38.9 + 39.7 + 40.3 + 40.0 + 41.4 + 39.1 + 40.6 + 40.9) $$\n$$ \\mu_{\\text{blank}} = \\frac{482.5}{12} \\approx 40.20833... \\, \\text{a.u.} $$\n\n问题指定使用无偏样本标准差 $\\sigma_{\\text{blank}}$，其计算公式如下：\n$$ \\sigma_{\\text{blank}} = \\sqrt{\\frac{1}{n-1} \\sum_{i=1}^{n} (x_i - \\mu_{\\text{blank}})^2} $$\n与均值的平方差之和 $\\sum_{i=1}^{n} (x_i - \\mu_{\\text{blank}})^2$ 为：\n$$ \\sum (x_i - \\mu_{\\text{blank}})^2 \\approx (40.2 - 40.20833)^2 + (39.8 - 40.20833)^2 + \\dots + (40.9 - 40.20833)^2 \\approx 6.3525 $$\n无偏样本方差 $s^2$ 为：\n$$ s^2 = \\frac{6.3525}{12-1} = \\frac{6.3525}{11} \\approx 0.5775 $$\n因此，无偏样本标准差为：\n$$ \\sigma_{\\text{blank}} = \\sqrt{\\frac{6.3525}{11}} \\approx 0.7597348... \\, \\text{a.u.} $$\n\n问题通过一个两步过程来定义以浓度单位表示的检测限 $LoD_{\\text{conc}}$。首先，定义一个信号阈值：\n$$ LoD_{\\text{signal}} = \\mu_{\\text{blank}} + 3\\,\\sigma_{\\text{blank}} $$\n然后，使用提供的线性校准模型 $S(C) = \\mu_{\\text{blank}} + m\\,C$ 将此信号转换为浓度。当 $S(C) = LoD_{\\text{signal}}$ 时，通过求解 $C$ 得到相应的浓度：\n$$ LoD_{\\text{conc}} = \\frac{LoD_{\\text{signal}} - \\mu_{\\text{blank}}}{m} $$\n将 $LoD_{\\text{signal}}$ 的表达式代入此方程，得到一个简化的公式：\n$$ LoD_{\\text{conc}} = \\frac{(\\mu_{\\text{blank}} + 3\\,\\sigma_{\\text{blank}}) - \\mu_{\\text{blank}}}{m} = \\frac{3\\,\\sigma_{\\text{blank}}}{m} $$\n我们已知校准斜率 $m = 5.0$ a.u. 每 ng/mL。代入计算出的 $\\sigma_{\\text{blank}}$ 值和给定的 $m$ 值：\n$$ LoD_{\\text{conc}} = \\frac{3 \\times 0.7597348...}{5.0} = \\frac{2.2792044...}{5.0} \\approx 0.45584088... \\, \\text{ng/mL} $$\n\n问题要求将最终答案四舍五入到四位有效数字。\n$$ LoD_{\\text{conc}} \\approx 0.4558 \\, \\text{ng/mL} $$",
            "answer": "$$\\boxed{0.4558}$$"
        },
        {
            "introduction": "在确定了检测的基本限度之后，下一个挑战是如何检测数量极其稀少的生物标志物。定量聚合酶链式反应（qPCR）是通过指数级扩增核酸信号来解决这一问题的基石技术。本练习将引导你从分子动力学的第一性原理出发，推导qPCR的指数增长定律，将引物结合和聚合酶活性这些分子决定因素与宏观的信号扩增联系起来。通过这个过程，你将能够量化预测达到检测阈值所需的扩增循环数。",
            "id": "5134112",
            "problem": "一种定量聚合酶链反应（qPCR）检测被用于检测一种低丰度的核酸生物标志物，其引物结合的分子决定因素是解离常数，定义为 $K_d = \\frac{[T][P]}{[TP]}$，其中 $[T]$ 是游离模板的浓度，$[P]$ 是游离引物的浓度，$[TP]$ 是引物-模板复合物的浓度。假设为单一扩增子，并基于以下机理：\n- 每个循环的步骤是变性、引物退火和延伸。\n- 在退火的伪一级反应条件下（$[P]_{\\text{tot}} \\gg [T]_{\\text{tot}}$），退火阶段结束时已退火模板的比例由平衡占据率 $f_{\\text{bind}} = \\frac{[P]}{K_d + [P]}$ 给出，其中 $[P] \\approx [P]_{\\text{tot}}$。\n- 将一个已退火的模板延伸成一个全长产物需要时间 $L/k_{\\text{pol}}$，其中 $L$ 是扩增子长度，$k_{\\text{pol}}$ 是聚合酶的延伸速率。如果每个循环的延伸时间为 $\\tau$，则当 $\\tau \\ge \\frac{L}{k_{\\text{pol}}}$ 时，延伸成功率为 $f_{\\text{ext}} = 1$，否则为 $f_{\\text{ext}} = 0$。\n- 令 $p = f_{\\text{bind}} f_{\\text{ext}}$ 表示在每个循环结束时，一个已有的双链分子产生一个额外双链拷贝的单循环概率。假设各个模板和循环之间相互独立，因此期望值是确定性演化的。\n\n从上述机理所隐含的递归关系出发，并且不预先假设任何特定的解的形式，推导出经过 $t$ 个循环后模板分子的期望数量关于初始拷贝数 $N_0$ 和单循环成功概率 $p$ 的闭合形式表达式。然后，对于一个配置如下的检测：初始分子数 $N_0 = 300$，$[P]_{\\text{tot}} = 250\\,\\text{nM}$，$K_d = 50\\,\\text{nM}$，$L = 120\\,\\text{nt}$，$k_{\\text{pol}} = 80\\,\\text{nt}\\,\\text{s}^{-1}$，以及 $\\tau = 30\\,\\text{s}$，计算期望拷贝数首次达到对应于 $N_{\\text{th}} = 1.0 \\times 10^9$ 个分子的荧光阈值时的实值循环数 $t^{\\ast}$。报告 $t^{\\ast}$ 的值，保留四位有效数字，并以循环数为单位。不要将 $t^{\\ast}$ 四舍五入为整数。",
            "solution": "该问题被认为是科学上合理的、提法恰当的且内部一致的。所有必要的参数和定义都已提供，可以推导出唯一且有意义的解。所用的聚合酶链反应（qPCR）模型是该过程的一个标准但简化的表示。因此，可以推导出完整的解。\n\n第一步是推导经过 $t$ 个循环后模板分子期望数 $N(t)$ 的闭合形式表达式。设 $N(t-1)$ 为第 $t$ 个循环开始时（或等效地，第 $t-1$ 个循环结束时）双链DNA分子的期望数量。根据问题陈述，$p$ 是每个循环中一个给定分子产生一个额外拷贝的概率。假设所有模板之间相互独立，在第 $t$ 个循环中产生的新分子的期望数量是该循环开始时存在的分子数 $N(t-1)$ 与成功复制概率 $p$ 的乘积。\n\n第 $t$ 循环中期望的新分子数 = $p \\cdot N(t-1)$。\n\n第 $t$ 循环结束时的总分子数 $N(t)$ 是该循环开始时存在的分子数与新合成的分子数之和。这给出了以下递推关系：\n$$N(t) = N(t-1) + p \\cdot N(t-1)$$\n$$N(t) = (1+p) \\cdot N(t-1)$$\n这是一个一阶线性齐次递推关系，初始条件为 $N(0) = N_0$。我们可以通过迭代来求解：\n对于 $t=1$：$N(1) = (1+p)N(0) = (1+p)N_0$\n对于 $t=2$：$N(2) = (1+p)N(1) = (1+p)[(1+p)N_0] = (1+p)^2 N_0$\n对于 $t=3$：$N(3) = (1+p)N(2) = (1+p)[(1+p)^2 N_0] = (1+p)^3 N_0$\n\n通过归纳法，经过 $t$ 个循环后分子期望数量的通用闭合形式表达式为：\n$$N(t) = N_0 (1+p)^t$$\n这完成了问题的第一部分。\n\n第二步是使用所提供的检测参数计算单循环成功概率 $p$ 的具体值。概率 $p$ 定义为 $p = f_{\\text{bind}} f_{\\text{ext}}$。\n\n首先，我们确定退火模板的比例 $f_{\\text{bind}}$。在伪一级反应条件 $[P]_{\\text{tot}} \\gg [T]_{\\text{tot}}$ 下，我们可以使用近似 $[P] \\approx [P]_{\\text{tot}}$。$f_{\\text{bind}}$ 的公式为：\n$$f_{\\text{bind}} = \\frac{[P]}{K_d + [P]} \\approx \\frac{[P]_{\\text{tot}}}{K_d + [P]_{\\text{tot}}}$$\n代入给定值 $[P]_{\\text{tot}} = 250\\,\\text{nM}$ 和 $K_d = 50\\,\\text{nM}$：\n$$f_{\\text{bind}} = \\frac{250\\,\\text{nM}}{50\\,\\text{nM} + 250\\,\\text{nM}} = \\frac{250}{300} = \\frac{5}{6}$$\n\n接下来，我们确定延伸成功率 $f_{\\text{ext}}$。如果每个循环的延伸时间 $\\tau$ 大于或等于聚合酶合成扩增子所需的时间 $L/k_{\\text{pol}}$，则该比率为 $1$。否则为 $0$。\n所需的延伸时间是：\n$$\\frac{L}{k_{\\text{pol}}} = \\frac{120\\,\\text{nt}}{80\\,\\text{nt}\\,\\text{s}^{-1}} = 1.5\\,\\text{s}$$\n提供的每个循环的延伸时间是 $\\tau = 30\\,\\text{s}$。比较这两个时间：\n$$30\\,\\text{s} \\ge 1.5\\,\\text{s}$$\n由于 $\\tau \\ge L/k_{\\text{pol}}$，延伸成功率为：\n$$f_{\\text{ext}} = 1$$\n\n现在，我们可以计算总的单循环成功概率 $p$：\n$$p = f_{\\text{bind}} \\cdot f_{\\text{ext}} = \\frac{5}{6} \\cdot 1 = \\frac{5}{6}$$\n\n最后一步是计算期望拷贝数 $N(t^{\\ast})$ 达到荧光阈值 $N_{\\text{th}} = 1.0 \\times 10^9$ 个分子时的实值循环数 $t^{\\ast}$。我们在我们推导的方程中设置 $N(t^{\\ast}) = N_{\\text{th}}$：\n$$N_{\\text{th}} = N_0 (1+p)^{t^{\\ast}}$$\n代入已知值 $N_0 = 300$，$N_{\\text{th}} = 1.0 \\times 10^9$，和 $p = 5/6$：\n$$1.0 \\times 10^9 = 300 \\left(1 + \\frac{5}{6}\\right)^{t^{\\ast}}$$\n$$1.0 \\times 10^9 = 300 \\left(\\frac{11}{6}\\right)^{t^{\\ast}}$$\n为了解出 $t^{\\ast}$，我们首先分离指数项：\n$$\\frac{1.0 \\times 10^9}{300} = \\left(\\frac{11}{6}\\right)^{t^{\\ast}}$$\n$$\\frac{10^7}{3} = \\left(\\frac{11}{6}\\right)^{t^{\\ast}}$$\n现在，对两边取自然对数：\n$$\\ln\\left(\\frac{10^7}{3}\\right) = \\ln\\left(\\left(\\frac{11}{6}\\right)^{t^{\\ast}}\\right)$$\n使用对数性质 $\\ln(a^b) = b \\ln(a)$：\n$$\\ln\\left(\\frac{10^7}{3}\\right) = t^{\\ast} \\ln\\left(\\frac{11}{6}\\right)$$\n最后，解出 $t^{\\ast}$：\n$$t^{\\ast} = \\frac{\\ln\\left(\\frac{10^7}{3}\\right)}{\\ln\\left(\\frac{11}{6}\\right)}$$\n这就是 $t^{\\ast}$ 的精确解析解。现在，我们计算其数值：\n$$t^{\\ast} = \\frac{\\ln(10^7) - \\ln(3)}{\\ln(11) - \\ln(6)} \\approx \\frac{16.11809565 - 1.098612289}{2.397895273 - 1.791759469} = \\frac{15.01948336}{0.606135804} \\approx 24.778839$$\n问题要求答案保留四位有效数字。\n$$t^{\\ast} \\approx 24.78$$\n这就是达到阈值所需的实值循环数。",
            "answer": "$$\\boxed{24.78}$$"
        },
        {
            "introduction": "现代诊断学正从依赖单一生物标志物转向利用复杂的分子模式进行判断。最后的这个实践练习将带你进入生物信息学和机器学习的前沿领域，利用游离DNA（cfDNA）的末端基序频率这一精细的分子特征来进行组织溯源。你的任务是从零开始构建一个贝叶斯分类器，将作为分子决定因素的组织特异性核酸酶切割模式，与最终的概率性诊断结论联系起来，并解决计算过程中的数值稳定性等实际问题。",
            "id": "5134070",
            "problem": "一名开发人员被要求形式化一个基于诊断性生物标志物分子决定因素的、有原理的组织来源分类器。分子背景如下：游离脱氧核糖核酸（cfDNA）片段的末端基序频率因组织而异，因为核酸酶的偏好和染色质结构会印刻下特征性的切割模式。对于一个固定的末端基序词汇表，可以使用组织特异性的基序频率图谱作为分子特征。\n\n您的任务是推导一个分类器，该分类器在给定一个 cfDNA 样本中观察到的末端基序计数的情况下，使用源自多项分布定义和贝叶斯定理的似然函数来计算类别后验概率。推导过程必须严格从以下核心定义开始：多项分布的概率质量函数和贝叶斯定理的陈述。您必须基于这些基础进行推理，以获得类别后验概率的可计算表达式，然后以数值稳定的方式实现该计算。\n\n设置：\n- 共有 $C = 3$ 种组织：肝脏、肺和结肠。在整个过程中请使用类别顺序 $[ \\text{肝脏}, \\text{肺}, \\text{结肠} ]$。\n- 共有 $K = 8$ 个末端基序。对于每种组织 $c \\in \\{1,2,3\\}$ 和基序索引 $k \\in \\{1,\\dots,8\\}$，令 $\\theta_{c,k}$ 表示基序 $k$ 的组织特异性概率。组织特异性概率由以下矩阵的行给出（每行总和为 $1$，且所有条目均为正）：\n  - 肝脏：$\\left[0.30, 0.25, 0.20, 0.10, 0.10, 0.03, 0.01, 0.01\\right]$\n  - 肺：$\\left[0.10, 0.15, 0.25, 0.20, 0.15, 0.10, 0.03, 0.02\\right]$\n  - 结肠：$\\left[0.05, 0.10, 0.10, 0.15, 0.20, 0.20, 0.10, 0.10\\right]$\n- 类别先验是均匀的：对于每个类别 $c$，$\\pi_c = 1/3$。\n\n您必须从以下定义开始：\n- 如果 $X = (X_1,\\dots,X_K)$ 是在 $N = \\sum_{k=1}^K X_k$ 次独立试验中对 $K$ 个类别的计数，且类别概率为 $\\Theta = (\\theta_1,\\dots,\\theta_K)$，则多项分布的概率质量函数定义为\n  $$P(X \\mid \\Theta) = \\frac{N!}{\\prod_{k=1}^K X_k!} \\prod_{k=1}^K \\theta_k^{X_k}.$$\n- 针对离散类别的贝叶斯定理陈述如下\n  $$P(c \\mid X) = \\frac{P(X \\mid c)\\,\\pi_c}{\\sum_{c'} P(X \\mid c')\\,\\pi_{c'}}.$$\n\n推导要求：\n- 从上述定义开始，推导出用 $\\pi_c$、$\\theta_{c,k}$ 和 $X_k$ 表示的 $P(c \\mid X)$ 的可计算表达式，并清楚说明在形成后验概率时如何处理多项概率质量函数中的组合因子。\n- 解释如何在对数空间中实现计算以确保数值稳定性，并说明如何进行归一化以获得总和为 $1$ 的有效后验概率。\n- 描述在所采用的模型和定义下，$N = 0$（所有计数均为零）的边界情况如何简化为后验概率等于先验概率。\n\n测试套件：\n对于以下每个观察到的计数向量 $X \\in \\mathbb{N}_0^8$（按8个基序排序），计算后验向量 $\\left[P(\\text{肝脏} \\mid X), P(\\text{肺} \\mid X), P(\\text{结肠} \\mid X)\\right]$，并将每个后验概率四舍五入到恰好 $6$ 位小数。\n\n- 情况A（一般情况，$N = 100$）：$X = [30, 26, 19, 10, 9, 3, 2, 1]$。\n- 情况B（一般情况，$N = 100$）：$X = [9, 16, 24, 20, 15, 10, 3, 3]$。\n- 情况C（小计数边缘情况，$N = 5$）：$X = [0, 1, 1, 1, 1, 1, 0, 0]$。\n- 情况D（模糊混合，$N = 100$）：$X = [12, 12, 13, 13, 12, 13, 12, 13]$。\n- 情况E（零计数边界情况，$N = 0$）：$X = [0, 0, 0, 0, 0, 0, 0, 0]$。\n\n最终输出格式：\n- 您的程序必须生成单行输出，其中包含按 A、B、C、D、E 顺序排列的测试用例的后验向量列表。每个后验向量必须是一个包含三个浮点数的列表，遵循固定的类别顺序 $[ \\text{肝脏}, \\text{肺}, \\text{结肠} ]$，每个浮点数四舍五入到恰好 $6$ 位小数。全部输出必须是打印在单行上的列表的列表，例如：$[[a_{11},a_{12},a_{13}],[a_{21},a_{22},a_{23}],\\dots]$。",
            "solution": "用户提供的问题经评估有效。它基于分子生物学（组织特异性 cfDNA 片段化）和统计学（使用多项模型的贝叶斯分类）的既定原理，具有科学依据。该问题定义明确，提供了所有必要的参数、定义和数据。它是客观的、可在数学上形式化的，并提出了一项非凡但可解的挑战。因此，这里提供一个完整的解决方案。\n\n目标是推导并实现一个贝叶斯分类器，以根据观察到的末端基序计数来确定游离DNA（cfDNA）样本的组织来源。该分类器必须在给定观察到的计数向量 $X = (X_1, \\dots, X_K)$ 的情况下，计算每个组织类别 $c$ 的后验概率 $P(c \\mid X)$。\n\n### 步骤1：后验概率表达式的推导\n\n推导从提供的两个定义开始：贝叶斯定理和多项分布的概率质量函数（PMF）。\n\n对于离散类别集合 $c \\in \\{1, \\dots, C\\}$ 和观察数据 $X$，贝叶斯定理给出如下：\n$$P(c \\mid X) = \\frac{P(X \\mid c)\\,\\pi_c}{\\sum_{c'=1}^C P(X \\mid c')\\,\\pi_{c'}}$$\n其中 $P(c \\mid X)$ 是类别 $c$ 的后验概率，$P(X \\mid c)$ 是在给定类别 $c$ 的情况下观察到数据 $X$ 的似然，而 $\\pi_c$ 是类别 $c$ 的先验概率。\n\n问题陈述，对于给定的组织来源 $c$，观察到的末端基序计数 $X = (X_1, \\dots, X_K)$ 服从多项分布。该分布的参数是观察到的基序总数 $N = \\sum_{k=1}^K X_k$ 和组织特异性基序概率 $\\Theta_c = (\\theta_{c,1}, \\dots, \\theta_{c,K})$。因此，似然 $P(X \\mid c)$ 由多项 PMF 给出：\n$$P(X \\mid c) = P(X \\mid \\Theta_c) = \\frac{N!}{\\prod_{k=1}^K X_k!} \\prod_{k=1}^K \\theta_{c,k}^{X_k}$$\n\n将此似然表达式代入贝叶斯定理，得到：\n$$P(c \\mid X) = \\frac{\\left( \\frac{N!}{\\prod_{k=1}^K X_k!} \\prod_{k=1}^K \\theta_{c,k}^{X_k} \\right) \\pi_c}{\\sum_{c'=1}^C \\left( \\frac{N!}{\\prod_{k=1}^K X_k!} \\prod_{k=1}^K \\theta_{c',k}^{X_k} \\right) \\pi_{c'}}$$\n\n一个关键的简化来自于观察多项式系数 $\\frac{N!}{\\prod_{k=1}^K X_k!}$。该项仅取决于总计数 $N$ 和各个计数 $X_k$，但它并**不**取决于类别 $c$。因此，它是分子和分母中求和项里每一项的公因子。我们可以将其提出并约去：\n$$P(c \\mid X) = \\frac{\\cancel{\\left(\\frac{N!}{\\prod_{k=1}^K X_k!}\\right)} \\left( \\prod_{k=1}^K \\theta_{c,k}^{X_k} \\right) \\pi_c}{\\cancel{\\left(\\frac{N!}{\\prod_{k=1}^K X_k!}\\right)} \\sum_{c'=1}^C \\left( \\prod_{k=1}^K \\theta_{c',k}^{X_k} \\right) \\pi_{c'}}$$\n\n这就得到了后验概率的简化、可计算的表达式：\n$$P(c \\mid X) = \\frac{\\left( \\prod_{k=1}^K \\theta_{c,k}^{X_k} \\right) \\pi_c}{\\sum_{c'=1}^C \\left( \\prod_{k=1}^K \\theta_{c',k}^{X_k} \\right) \\pi_{c'}}$$\n分子与联合概率 $P(X, c)$ 成正比，分母是数据的边缘概率 $P(X)$，它作为一个归一化常数，确保 $\\sum_{c=1}^C P(c \\mid X) = 1$。\n\n### 步骤2：在对数空间中进行数值稳定的实现\n\n乘积项 $\\prod_{k=1}^K \\theta_{c,k}^{X_k}$ 涉及将许多小于 $1$ 的概率相乘。对于较大的计数 $X_k$，这个乘积可能变得极小，导致标准浮点运算中出现数值下溢。为了缓解这个问题，计算在对数空间中进行。\n\n我们为每个类别 $c$ 定义未归一化的对数后验概率，记为 $L_c$，它是简化表达式中分子的対数：\n$$L_c = \\log\\left( \\left( \\prod_{k=1}^K \\theta_{c,k}^{X_k} \\right) \\pi_c \\right) = \\log(\\pi_c) + \\log\\left(\\prod_{k=1}^K \\theta_{c,k}^{X_k}\\right)$$\n利用对数的性质，这变成了一个和式：\n$$L_c = \\log(\\pi_c) + \\sum_{k=1}^K X_k \\log(\\theta_{c,k})$$\n这种涉及对数求和的形式是数值稳定的，可以避免下溢。\n\n后验概率可以通过取指数和归一化来恢复：\n$$P(c \\mid X) = \\frac{\\exp(L_c)}{\\sum_{c'=1}^C \\exp(L_{c'})}$$\n然而，如果 $L_c$ 值是大的正数或大的负数，$\\exp(L_c)$ 可能分别导致上溢或下溢。为了处理这个问题，我们使用 log-sum-exp 技巧。我们找到所有对数后验概率中的最大值 $L_{\\max} = \\max_{c'} \\{L_{c'}\\}$，并在取指数前从每个 $L_c$ 中减去它：\n$$P(c \\mid X) = \\frac{\\exp(L_c - L_{\\max})}{\\sum_{c'=1}^C \\exp(L_{c'} - L_{\\max})}$$\n根据构造，现在最大的指数是 $0$，所有其他指数都是负数。这可以防止上溢，并且由于分母求和中至少有一项是 $\\exp(0)=1$，分母不可能为零。这为计算最终的后验概率提供了一种鲁棒的方法。\n\n### 步驟3：边界情况 $N=0$ 的分析\n\n考虑没有观察到基序的情况，即计数向量为 $X = (0, 0, \\dots, 0)$。在这种情况下，总计数为 $N = \\sum_{k=1}^K X_k = 0$。\n\n将此情况应用于我们未归一化的对数后验概率 $L_c$ 的表达式：\n$$L_c = \\log(\\pi_c) + \\sum_{k=1}^K 0 \\cdot \\log(\\theta_{c,k})$$\n由于 $0$ 乘以任何有限数都为 $0$，求和项消失：\n$$L_c = \\log(\\pi_c) + 0 = \\log(\\pi_c)$$\n未归一化的对数后验概率就是对数先验概率。\n\n为了求得后验概率，我们取指数并进行归一化：\n$$P(c \\mid X=\\mathbf{0}) = \\frac{\\exp(L_c)}{\\sum_{c'} \\exp(L_{c'})} = \\frac{\\exp(\\log(\\pi_c))}{\\sum_{c'} \\exp(\\log(\\pi_{c'}))}$$\n这可以简化为：\n$$P(c \\mid X=\\mathbf{0}) = \\frac{\\pi_c}{\\sum_{c'} \\pi_{c'}}$$\n考虑到先验概率的总和必须为一（$\\sum_{c'} \\pi_{c'} = 1$），该表达式可简化为：\n$$P(c \\mid X=\\mathbf{0}) = \\pi_c$$\n这个结果是直观的：在完全没有证据（零计数）的情况下，我们对组织来源的后验信念与我们的先验信念相同。对于本问题，由于先验是均匀的（$\\pi_c = 1/3$），$N=0$ 情况下的后验概率将是 $(1/3, 1/3, 1/3)$。",
            "answer": "[[0.999999,0.000001,0.000000],[0.000011,0.999158,0.000831],[0.216653,0.552808,0.230539],[0.010261,0.430032,0.559707],[0.333333,0.333333,0.333333]]"
        }
    ]
}