{
    "hands_on_practices": [
        {
            "introduction": "To appreciate the adaptive immune system's power, we must first grasp the scale of its potential. This exercise walks you through a foundational calculation to estimate the vast number of unique B cell receptors (BCRs) that can be generated through V(D)J recombination alone . By applying simple combinatorial rules to the gene segments available for building heavy and light chains, you will quantify the 'combinatorial diversity' that forms the blueprint for the antibody repertoire, providing a crucial baseline against which observed repertoires can be understood.",
            "id": "5101624",
            "problem": "A clinical laboratory is designing a baseline molecular diversity model for the B cell receptor (BCR) repertoire to contextualize high-throughput repertoire sequencing outputs in molecular and immunodiagnostics. The model will include only combinatorial contributions from gene segment choice and will explicitly exclude any junctional diversity (for example, insertions and deletions at coding joints), somatic hypermutation, and selection. Start from the following fundamental base:\n\n- In immunoglobulin gene assembly by V(D)J recombination, each productive heavy chain rearrangement involves choosing one variable segment, one diversity segment, and one joining segment from the immunoglobulin heavy chain (IGH) locus, whereas each productive light chain rearrangement involves choosing one variable segment and one joining segment from a light chain locus (either immunoglobulin kappa light chain (IGK) or immunoglobulin lambda light chain (IGL)).\n- Combinatorial diversity is defined as the number of distinct receptor sequences generated solely by independent choices of gene segments across loci, with pseudogenes and nonfunctional open reading frames excluded from the counts.\n- A mature B cell expresses one heavy chain and one light chain, with the light chain being either kappa or lambda, not both.\n\nAssume independence of gene segment choice across loci (i.e., heavy chain choices are independent of light chain choices), and independence between the IGK and IGL pathways at the combinatorial counting level.\n\nThe International ImMunoGeneTics (IMGT) database curation for functional gene segments in the human genome provides the following counts per haploid locus:\n\n- For the immunoglobulin heavy chain (IGH): $N_{V}^{H} = 44$ functional $V$ segments, $N_{D}^{H} = 23$ functional $D$ segments, $N_{J}^{H} = 6$ functional $J$ segments.\n- For the immunoglobulin kappa light chain (IGK): $N_{V}^{K} = 34$ functional $V$ segments, $N_{J}^{K} = 5$ functional $J$ segments.\n- For the immunoglobulin lambda light chain (IGL): $N_{V}^{L} = 33$ functional $V$ segments, $N_{J}^{L} = 5$ functional $J$ segments.\n\nUsing only the principles stated above and standard combinatorial counting, derive the analytic expression for the heavy chain combinatorial diversity and extend it to obtain the total BCR combinatorial diversity that accounts for pairing with either kappa or lambda light chains. Then, evaluate the resulting total BCR combinatorial diversity numerically using the counts given.\n\nRound your final numerical result to three significant figures and express it in scientific notation as a dimensionless count.",
            "solution": "The problem asks for the derivation of the analytic expression for the total combinatorial diversity of the B cell receptor (BCR) repertoire and its numerical evaluation, based on provided counts of functional gene segments from the International ImMunoGeneTics (IMGT) database. The model is simplified to include only combinatorial diversity arising from the selection of V, D, and J gene segments, explicitly excluding other sources of diversity.\n\nThe problem has been validated and is deemed scientifically sound, well-posed, and objective. It is based on established principles of immunology, specifically V(D)J recombination, and uses standard combinatorial counting methods. All necessary data and assumptions are provided.\n\nThe fundamental principle for calculating combinatorial diversity in this context is the multiplication rule of counting. If a process can be broken down into a sequence of independent stages, the total number of outcomes is the product of the number of outcomes at each stage. Additionally, if an outcome can be achieved through one of several mutually exclusive pathways, the total number of outcomes is the sum of the outcomes for each pathway.\n\nFirst, we will derive the analytic expression for the combinatorial diversity of the heavy chain ($C_{H}$). A productive heavy chain rearrangement involves selecting one V segment, one D segment, and one J segment from the immunoglobulin heavy chain (IGH) locus. The problem states these choices are independent. The number of available functional segments are given as $N_{V}^{H}$, $N_{D}^{H}$, and $N_{J}^{H}$.\n\nApplying the multiplication rule, the heavy chain combinatorial diversity is:\n$$C_{H} = N_{V}^{H} \\times N_{D}^{H} \\times N_{J}^{H}$$\n\nNext, we derive the expression for the combinatorial diversity of the light chain ($C_{LC}$). A mature B cell expresses a light chain that is either a kappa ($\\kappa$) chain or a lambda ($\\lambda$) chain, but not both. These are mutually exclusive possibilities for the light chain. Therefore, the total light chain diversity is the sum of the diversities of the kappa and lambda chains.\n\nFor the kappa light chain, one V segment and one J segment are chosen from the immunoglobulin kappa (IGK) locus. The number of functional segments are $N_{V}^{K}$ and $N_{J}^{K}$. The diversity is:\n$$C_{K} = N_{V}^{K} \\times N_{J}^{K}$$\n\nFor the lambda light chain, one V segment and one J segment are chosen from the immunoglobulin lambda (IGL) locus. The number of functional segments are $N_{V}^{L}$ and $N_{J}^{L}$. The diversity is:\n$$C_{\\lambda} = N_{V}^{L} \\times N_{J}^{L}$$\n\nThe total light chain diversity is the sum of these two possibilities:\n$$C_{LC} = C_{K} + C_{\\lambda} = (N_{V}^{K} \\times N_{J}^{K}) + (N_{V}^{L} \\times N_{J}^{L})$$\n\nFinally, the total BCR combinatorial diversity ($C_{BCR}$) is determined by the pairing of one heavy chain with one light chain. The problem states that the choice of heavy chain is independent of the choice of light chain. Therefore, the total diversity is the product of the heavy chain diversity and the total light chain diversity.\n\nThe complete analytic expression for the total BCR combinatorial diversity is:\n$$C_{BCR} = C_{H} \\times C_{LC} = (N_{V}^{H} \\times N_{D}^{H} \\times N_{J}^{H}) \\times ((N_{V}^{K} \\times N_{J}^{K}) + (N_{V}^{L} \\times N_{J}^{L}))$$\n\nNow, we will evaluate this expression numerically using the provided data:\n- For IGH: $N_{V}^{H} = 44$, $N_{D}^{H} = 23$, $N_{J}^{H} = 6$.\n- For IGK: $N_{V}^{K} = 34$, $N_{J}^{K} = 5$.\n- For IGL: $N_{V}^{L} = 33$, $N_{J}^{L} = 5$.\n\nFirst, calculate the heavy chain diversity, $C_{H}$:\n$$C_{H} = 44 \\times 23 \\times 6 = 1012 \\times 6 = 6072$$\n\nNext, calculate the light chain diversities, $C_{K}$ and $C_{\\lambda}$:\n$$C_{K} = 34 \\times 5 = 170$$\n$$C_{\\lambda} = 33 \\times 5 = 165$$\n\nThe total light chain diversity, $C_{LC}$, is the sum:\n$$C_{LC} = 170 + 165 = 335$$\n\nFinally, calculate the total BCR diversity, $C_{BCR}$, by multiplying the heavy and total light chain diversities:\n$$C_{BCR} = C_{H} \\times C_{LC} = 6072 \\times 335 = 2034120$$\n\nThe problem requires this result to be rounded to three significant figures and expressed in scientific notation.\n$$2034120 \\approx 2.03 \\times 10^{6}$$\nThe fourth significant digit is $4$, so we round down.",
            "answer": "$$\\boxed{2.03 \\times 10^{6}}$$"
        },
        {
            "introduction": "While combinatorial diversity represents the theoretical potential, clinical diagnostics focuses on the actual repertoire present in a sample. This practice introduces Shannon entropy, a concept borrowed from information theory, as a robust metric for quantifying the diversity of a sequenced T-cell population . By calculating the entropy of a given frequency distribution, you will learn to distill complex repertoire data into a single, interpretable value that directly relates to the balance between polyclonality (health) and oligoclonality (a sign of a targeted immune response or pathology).",
            "id": "5102035",
            "problem": "A peripheral blood sample from a patient suspected of a dominant clonal T cell expansion is profiled by high-throughput Complementarity-Determining Region 3 (CDR3) sequencing of the T cell receptor (TCR) $\\beta$ chain using Next-Generation Sequencing (NGS). After Polymerase Chain Reaction (PCR) amplification with unique molecular identifiers to correct amplification bias, the molecular counts are normalized to obtain a clone frequency distribution over the top $10$ detected clonotypes, denoted $\\{p_i\\}_{i=1}^{10}$. The frequencies are:\n$$\np_1 = 0.27,\\quad\np_2 = 0.14,\\quad\np_3 = 0.12,\\quad\np_4 = 0.10,\\quad\np_5 = 0.08,\\quad\np_6 = 0.07,\\quad\np_7 = 0.06,\\quad\np_8 = 0.06,\\quad\np_9 = 0.05,\\quad\np_{10} = 0.05.\n$$\nAssume the distribution $\\{p_i\\}$ is properly normalized so that $\\sum_{i=1}^{10} p_i = 1$. Using the information-theoretic diversity measure known as Shannon entropy, with the natural logarithm (base $e$), compute the entropy of this repertoire in units of natural information content (nats). Round your final numerical value to four significant figures. Then, based only on first principles that connect clonal selection and lymphocyte repertoire formation to information content, explain the diagnostic significance of the computed value with respect to oligoclonality versus polyclonality. Express the entropy in nats.",
            "solution": "The problem is first validated to ensure it is scientifically sound, well-posed, and complete.\n\n### Step 1: Extract Givens\n-   **System:** A T-cell repertoire from a peripheral blood sample.\n-   **Technique:** High-throughput Complementarity-Determining Region 3 (CDR3) sequencing of the T cell receptor (TCR) $\\beta$ chain.\n-   **Data:** A clone frequency distribution for the top $10$ detected clonotypes, denoted $\\{p_i\\}_{i=1}^{10}$.\n-   **Frequencies:**\n    $p_1 = 0.27$,\n    $p_2 = 0.14$,\n    $p_3 = 0.12$,\n    $p_4 = 0.10$,\n    $p_5 = 0.08$,\n    $p_6 = 0.07$,\n    $p_7 = 0.06$,\n    $p_8 = 0.06$,\n    $p_9 = 0.05$,\n    $p_{10} = 0.05$.\n-   **Constraint:** The distribution is normalized, $\\sum_{i=1}^{10} p_i = 1$. A check confirms this: $0.27+0.14+0.12+0.10+0.08+0.07+2(0.06)+2(0.05) = 1.00$.\n-   **Task 1:** Compute the Shannon entropy, $H$, using the natural logarithm (base $e$).\n-   **Task 2:** Round the final numerical value to four significant figures.\n-   **Task 3:** Explain the diagnostic significance of the computed entropy value.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientific Grounding:** The problem is firmly grounded in immunoinformatics and molecular diagnostics. The use of TCR-beta CDR3 sequencing to profile T-cell repertoires and Shannon entropy to quantify repertoire diversity are standard, well-established methodologies in immunology. The concepts of clonal selection, oligoclonality, and polyclonality are central to the field.\n-   **Well-Posedness:** The problem is well-posed. It provides a complete, normalized probability distribution and asks for the computation of a well-defined mathematical quantity (Shannon entropy) and its standard scientific interpretation. A unique, stable numerical solution exists.\n-   **Objectivity:** The problem is stated in objective, scientific language, free of ambiguity or subjective claims. The provided frequency values are plausible for a patient with a suspected clonal expansion.\n\n### Step 3: Verdict and Action\nThe problem is valid. The solution process will now proceed.\n\n### Solution\nThe primary task is to compute the Shannon entropy of the given T-cell clonotype frequency distribution and interpret its diagnostic meaning.\n\n**Part 1: Calculation of Shannon Entropy**\n\nThe Shannon entropy, $H$, for a discrete probability distribution $\\{p_i\\}_{i=1}^{N}$ is defined by the formula:\n$$\nH = - \\sum_{i=1}^{N} p_i \\log_b(p_i)\n$$\nThe problem specifies the use of the natural logarithm, so the base $b$ is Euler's number, $e$, and the entropy will be expressed in units of nats (natural units of information). The formula is thus:\n$$\nH = - \\sum_{i=1}^{N} p_i \\ln(p_i)\n$$\nIn this problem, the number of clonotypes is $N=10$, and their frequencies $\\{p_i\\}$ are given. We compute the entropy by substituting these values into the formula. Note that the convention $0 \\ln(0) = 0$ is used, though it is not applicable here as all $p_i > 0$.\n\nThe calculation is as follows:\n$$\nH = - \\sum_{i=1}^{10} p_i \\ln(p_i)\n$$\n$$\nH = - \\left[ p_1 \\ln(p_1) + p_2 \\ln(p_2) + p_3 \\ln(p_3) + p_4 \\ln(p_4) + p_5 \\ln(p_5) + p_6 \\ln(p_6) + p_7 \\ln(p_7) + p_8 \\ln(p_8) + p_9 \\ln(p_9) + p_{10} \\ln(p_{10}) \\right]\n$$\nSubstituting the given frequency values:\n$$\nH = - \\left[ 0.27\\ln(0.27) + 0.14\\ln(0.14) + 0.12\\ln(0.12) + 0.10\\ln(0.10) + 0.08\\ln(0.08) + 0.07\\ln(0.07) + 0.06\\ln(0.06) + 0.06\\ln(0.06) + 0.05\\ln(0.05) + 0.05\\ln(0.05) \\right]\n$$\nThis can be written more compactly as:\n$$\nH = - \\left[ 0.27\\ln(0.27) + 0.14\\ln(0.14) + 0.12\\ln(0.12) + 0.10\\ln(0.10) + 0.08\\ln(0.08) + 0.07\\ln(0.07) + 2(0.06\\ln(0.06)) + 2(0.05\\ln(0.05)) \\right]\n$$\nPerforming the numerical calculations for each term:\n- $0.27\\ln(0.27) \\approx -0.353519$\n- $0.14\\ln(0.14) \\approx -0.275256$\n- $0.12\\ln(0.12) \\approx -0.254432$\n- $0.10\\ln(0.10) \\approx -0.230259$\n- $0.08\\ln(0.08) \\approx -0.202058$\n- $0.07\\ln(0.07) \\approx -0.186148$\n- $2 \\times (0.06\\ln(0.06)) \\approx 2 \\times (-0.168805) = -0.337609$\n- $2 \\times (0.05\\ln(0.05)) \\approx 2 \\times (-0.149787) = -0.299573$\n\nSumming these values:\n$$\n\\sum_{i=1}^{10} p_i \\ln(p_i) \\approx -0.353519 - 0.275256 - 0.254432 - 0.230259 - 0.202058 - 0.186148 - 0.337609 - 0.299573 = -2.138854\n$$\nThe entropy $H$ is the negative of this sum:\n$$\nH \\approx -(-2.138854) = 2.138854 \\text{ nats}\n$$\nRounding to four significant figures, as requested:\n$$\nH \\approx 2.139 \\text{ nats}\n$$\n\n**Part 2: Diagnostic Significance**\n\nThe Shannon entropy, $H$, when applied to a lymphocyte repertoire, is a quantitative measure of its diversity. It reflects the uncertainty in predicting the identity of a randomly chosen T-cell clone from the population. The diagnostic significance of the value $H \\approx 2.139$ nats is understood by comparing it to the theoretical minimum and maximum values for a repertoire of $N=10$ clones.\n\n1.  **Maximum Entropy (Polyclonality):** The entropy is maximized when the distribution is uniform, i.e., all clones have the same frequency, $p_i = 1/N = 1/10 = 0.1$ for all $i$. This represents a perfectly polyclonal state, characteristic of a healthy and diverse immune repertoire. The maximum possible entropy, $H_{\\text{max}}$, is:\n    $$\n    H_{\\text{max}} = -\\sum_{i=1}^{10} \\frac{1}{10} \\ln\\left(\\frac{1}{10}\\right) = -10 \\left(\\frac{1}{10} \\ln(0.1)\\right) = -\\ln(0.1) = \\ln(10) \\approx 2.303 \\text{ nats}\n    $$\n    A high entropy value, close to $H_{\\text{max}}$, signifies high clonal diversity and evenness.\n\n2.  **Minimum Entropy (Monoclonality):** The entropy is minimized when one clone completely dominates the repertoire, i.e., $p_k=1$ for one clone $k$ and $p_i=0$ for all other clones $i \\neq k$. This represents an extreme monoclonal state. The minimum entropy, $H_{\\text{min}}$, is:\n    $$\n    H_{\\text{min}} = -(1 \\cdot \\ln(1) + \\sum_{i \\neq k} 0 \\cdot \\ln(0)) = 0 \\text{ nats}\n    $$\n    A low entropy value, close to $0$, signifies a collapse of diversity and the dominance of a single clone.\n\n**Interpretation:**\nThe calculated entropy for the patient's sample is $H \\approx 2.139$ nats. This value is significantly greater than $H_{\\text{min}} = 0$ but is noticeably less than the maximum possible entropy $H_{\\text{max}} \\approx 2.303$ nats.\n\nThis intermediate value is indicative of an **oligoclonal** repertoire. The term \"oligoclonal\" describes a state of diversity that is reduced from the highly polyclonal baseline, where a few clones (oligo-) have expanded to occupy a substantial fraction of the repertoire. The frequency distribution is skewed, as seen by the top clone having a frequency of $p_1=0.27$, which is $2.7$ times higher than the frequency in a perfectly uniform distribution.\n\nFrom a diagnostic perspective, the entropy value of $2.139$ nats provides quantitative evidence to support the initial suspicion of a \"dominant clonal T cell expansion\". A healthy, unperturbed repertoire would exhibit a higher entropy, closer to $\\ln(10)$. The observed reduction in entropy reflects a loss of diversity due to the proliferative expansion of one or more T-cell clones. This can be caused by a persistent infection driving an antigen-specific response, an autoimmune process, or a lymphoproliferative disorder such as T-cell lymphoma or leukemia. Therefore, the calculated entropy serves as a crucial quantitative biomarker for the degree of clonal skewing in the T-cell population, helping to characterize the immune state and guide further diagnostic investigation.",
            "answer": "$$\n\\boxed{2.139}\n$$"
        },
        {
            "introduction": "Observing a change in a diversity index between two samples, such as pre- and post-treatment, is only the first step; the critical question is whether this change is statistically significant. This practice addresses this challenge head-on by guiding you through the implementation of a nonparametric bootstrap, a cornerstone of modern computational immunology . By generating confidence intervals for the change in diversity metrics, you will learn how to make statistically sound inferences about repertoire dynamics, distinguishing genuine biological effects from the inherent uncertainty of high-throughput sequencing data.",
            "id": "5101603",
            "problem": "You are given discrete pre-event and post-event clonotype count vectors representing observed lymphocyte receptor repertoires measured using Next-Generation Sequencing (NGS). Each vector comprises nonnegative integers where each entry is the observed number of unique cells assigned to a clonotype label in a single sample. In the biological context of clonal selection and lymphocyte repertoire formation, antigen exposure and subsequent selection reshape the distribution of clonotypes, thereby affecting repertoire diversity. Your task is to compute effect sizes and confidence intervals for changes in repertoire diversity using nonparametric bootstrap methods derived from fundamental probability definitions.\n\nFundamental base and definitions to be used:\n- Let the observed pre-event clonotype counts be represented by the vector $\\mathbf{c}^{\\mathrm{pre}} = \\left[c^{\\mathrm{pre}}_1, c^{\\mathrm{pre}}_2, \\dots, c^{\\mathrm{pre}}_K\\right]$ and the post-event clonotype counts by $\\mathbf{c}^{\\mathrm{post}} = \\left[c^{\\mathrm{post}}_1, c^{\\mathrm{post}}_2, \\dots, c^{\\mathrm{post}}_L\\right]$, where $K$ and $L$ denote the number of clonotype labels in each sample (they need not be equal).\n- Define the sample sizes $N^{\\mathrm{pre}} = \\sum_{i=1}^{K} c^{\\mathrm{pre}}_i$ and $N^{\\mathrm{post}} = \\sum_{j=1}^{L} c^{\\mathrm{post}}_j$.\n- The empirical category probabilities are $p^{\\mathrm{pre}}_i = c^{\\mathrm{pre}}_i / N^{\\mathrm{pre}}$ for $i \\in \\{1,\\dots,K\\}$ and $p^{\\mathrm{post}}_j = c^{\\mathrm{post}}_j / N^{\\mathrm{post}}$ for $j \\in \\{1,\\dots,L\\}$, with the convention that terms with zero probability do not contribute to sums.\n- The Shannon entropy (order-$1$ diversity) is defined as\n$$\nH(\\mathbf{p}) = - \\sum_{m} p_m \\log p_m,\n$$\nwhere $\\log$ denotes the natural logarithm.\n- The Hill number of order $q$ is defined for $q \\neq 1$ as\n$$\nD_q(\\mathbf{p}) = \\left(\\sum_{m} p_m^q\\right)^{\\frac{1}{1-q}}.\n$$\nFor $q = 2$, this yields the inverse Simpson diversity\n$$\nD_2(\\mathbf{p}) = \\frac{1}{\\sum_{m} p_m^2}.\n$$\n- Define two effect sizes:\n    1. The additive difference in Shannon entropy\n    $$\n    \\Delta H = H(\\mathbf{p}^{\\mathrm{post}}) - H(\\mathbf{p}^{\\mathrm{pre}}).\n    $$\n    2. The log-response ratio for order-$2$ Hill diversity\n    $$\n    \\mathrm{LRR}_2 = \\log\\left(\\frac{D_2(\\mathbf{p}^{\\mathrm{post}})}{D_2(\\mathbf{p}^{\\mathrm{pre}})}\\right).\n    $$\n- Nonparametric bootstrap construction: For a given number of bootstrap replicates $B$, generate $B$ independent multinomial resamples for the pre-event sample by drawing $\\mathbf{X}^{\\mathrm{pre}}_{(b)} \\sim \\mathrm{Multinomial}(N^{\\mathrm{pre}}, \\mathbf{p}^{\\mathrm{pre}})$ for $b \\in \\{1,\\dots,B\\}$ and similarly for the post-event sample $\\mathbf{X}^{\\mathrm{post}}_{(b)} \\sim \\mathrm{Multinomial}(N^{\\mathrm{post}}, \\mathbf{p}^{\\mathrm{post}})$. For each bootstrap pair, compute the empirical probabilities $\\hat{\\mathbf{p}}^{\\mathrm{pre}}_{(b)} = \\mathbf{X}^{\\mathrm{pre}}_{(b)}/N^{\\mathrm{pre}}$ and $\\hat{\\mathbf{p}}^{\\mathrm{post}}_{(b)} = \\mathbf{X}^{\\mathrm{post}}_{(b)}/N^{\\mathrm{post}}$, then compute $\\Delta H_{(b)}$ and $\\mathrm{LRR}_{2,(b)}$ analogously to the observed definitions. Construct two-sided bootstrap confidence intervals for each effect size using the percentile method at confidence level $1-\\alpha$ by taking the $\\alpha/2$ and $1 - \\alpha/2$ quantiles of the bootstrap replicate distributions. Express the confidence level as a decimal $1-\\alpha$ (e.g., $0.95$).\n\nInputs are specified as exact test cases below. For each test case, you are given a tuple $\\left(\\mathbf{c}^{\\mathrm{pre}}, \\mathbf{c}^{\\mathrm{post}}, B, \\alpha, s\\right)$, where $s$ is an integer random seed to ensure reproducibility of the bootstrap replicates. The test suite is:\n\n- Test case $1$ (balanced evenness increases):\n    - $\\mathbf{c}^{\\mathrm{pre}} = \\left[50, 40, 30, 20, 10\\right]$\n    - $\\mathbf{c}^{\\mathrm{post}} = \\left[20, 20, 20, 20, 20\\right]$\n    - $B = 3000$\n    - $\\alpha = 0.05$\n    - $s = 123$\n- Test case $2$ (clonal expansion reduces diversity):\n    - $\\mathbf{c}^{\\mathrm{pre}} = \\left[10, 10, 10, 10, 10, 10, 10, 10, 10, 10\\right]$\n    - $\\mathbf{c}^{\\mathrm{post}} = \\left[90, 5, 2, 1, 0, 0, 0, 0, 0, 0\\right]$\n    - $B = 3000$\n    - $\\alpha = 0.05$\n    - $s = 456$\n- Test case $3$ (small sample sizes):\n    - $\\mathbf{c}^{\\mathrm{pre}} = \\left[5, 1\\right]$\n    - $\\mathbf{c}^{\\mathrm{post}} = \\left[6, 1\\right]$\n    - $B = 3000$\n    - $\\alpha = 0.05$\n    - $s = 789$\n- Test case $4$ (boundary case with a monoclonal pre-event repertoire):\n    - $\\mathbf{c}^{\\mathrm{pre}} = \\left[100\\right]$\n    - $\\mathbf{c}^{\\mathrm{post}} = \\left[80, 5, 5, 5, 5\\right]$\n    - $B = 3000$\n    - $\\alpha = 0.05$\n    - $s = 987$\n\nAlgorithmic requirements:\n- Implement the bootstrap using the multinomial resampling scheme described above for both pre-event and post-event samples, using the provided random seed $s$.\n- Compute observed effect sizes $\\Delta H$ and $\\mathrm{LRR}_2$ from the input counts.\n- Compute the bootstrap percentile confidence intervals for both effect sizes at confidence level $1-\\alpha$.\n\nFinal output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to a test case in the order given above. Each test caseâ€™s result must itself be a list of six floats in the order $\\left[\\Delta H, \\mathrm{CI}^{\\Delta H}_{\\mathrm{lower}}, \\mathrm{CI}^{\\Delta H}_{\\mathrm{upper}}, \\mathrm{LRR}_2, \\mathrm{CI}^{\\mathrm{LRR}_2}_{\\mathrm{lower}}, \\mathrm{CI}^{\\mathrm{LRR}_2}_{\\mathrm{upper}}\\right]$. For example, the overall output format must be $\\left[[x_1,x_2,x_3,x_4,x_5,x_6],[y_1,y_2,y_3,y_4,y_5,y_6],\\dots\\right]$, containing exactly $4$ inner lists in this problem.",
            "solution": "### Problem Validation\n\nThe problem statement has been critically evaluated and is determined to be **valid**.\n\n**Step 1: Extract Givens**\n\n-   **Pre-event clonotype counts**: A vector $\\mathbf{c}^{\\mathrm{pre}} = \\left[c^{\\mathrm{pre}}_1, c^{\\mathrm{pre}}_2, \\dots, c^{\\mathrm{pre}}_K\\right]$ of non-negative integers.\n-   **Post-event clonotype counts**: A vector $\\mathbf{c}^{\\mathrm{post}} = \\left[c^{\\mathrm{post}}_1, c^{\\mathrm{post}}_2, \\dots, c^{\\mathrm{post}}_L\\right]$ of non-negative integers.\n-   **Sample sizes**: $N^{\\mathrm{pre}} = \\sum_{i=1}^{K} c^{\\mathrm{pre}}_i$ and $N^{\\mathrm{post}} = \\sum_{j=1}^{L} c^{\\mathrm{post}}_j$.\n-   **Empirical probabilities**: $p^{\\mathrm{pre}}_i = c^{\\mathrm{pre}}_i / N^{\\mathrm{pre}}$ and $p^{\\mathrm{post}}_j = c^{\\mathrm{post}}_j / N^{\\mathrm{post}}$.\n-   **Shannon entropy definition**: $H(\\mathbf{p}) = - \\sum_{m} p_m \\log p_m$, where $\\log$ is the natural logarithm.\n-   **Hill number of order $q$ definition**: $D_q(\\mathbf{p}) = \\left(\\sum_{m} p_m^q\\right)^{\\frac{1}{1-q}}$ for $q \\neq 1$. For $q=2$, this gives the inverse Simpson diversity $D_2(\\mathbf{p}) = 1/\\sum_{m} p_m^2$.\n-   **Effect size definitions**:\n    1.  Additive difference in Shannon entropy: $\\Delta H = H(\\mathbf{p}^{\\mathrm{post}}) - H(\\mathbf{p}^{\\mathrm{pre}})$.\n    2.  Log-response ratio for order-$2$ Hill diversity: $\\mathrm{LRR}_2 = \\log\\left(D_2(\\mathbf{p}^{\\mathrm{post}}) / D_2(\\mathbf{p}^{\\mathrm{pre}})\\right)$.\n-   **Bootstrap procedure**:\n    -   Generate $B$ independent multinomial resamples:\n        -   $\\mathbf{X}^{\\mathrm{pre}}_{(b)} \\sim \\mathrm{Multinomial}(N^{\\mathrm{pre}}, \\mathbf{p}^{\\mathrm{pre}})$ for $b \\in \\{1,\\dots,B\\}$.\n        -   $\\mathbf{X}^{\\mathrm{post}}_{(b)} \\sim \\mathrm{Multinomial}(N^{\\mathrm{post}}, \\mathbf{p}^{\\mathrm{post}})$ for $b \\in \\{1,\\dots,B\\}$.\n    -   Compute bootstrap probabilities: $\\hat{\\mathbf{p}}^{\\mathrm{pre}}_{(b)} = \\mathbf{X}^{\\mathrm{pre}}_{(b)}/N^{\\mathrm{pre}}$ and $\\hat{\\mathbf{p}}^{\\mathrm{post}}_{(b)} = \\mathbf{X}^{\\mathrm{post}}_{(b)}/N^{\\mathrm{post}}$.\n    -   Compute bootstrap effect sizes: $\\Delta H_{(b)}$ and $\\mathrm{LRR}_{2,(b)}$.\n-   **Confidence Interval method**: Two-sided percentile method at confidence level $1-\\alpha$, using $\\alpha/2$ and $1 - \\alpha/2$ quantiles.\n-   **Inputs**: Test cases as tuples of $\\left(\\mathbf{c}^{\\mathrm{pre}}, \\mathbf{c}^{\\mathrm{post}}, B, \\alpha, s\\right)$, where $s$ is a random seed.\n\n**Step 2: Validate Using Extracted Givens**\n\n-   **Scientifically Grounded**: The problem is well-grounded in computational immunology and statistics. The use of Shannon entropy and Hill numbers to quantify diversity of lymphocyte repertoires is standard practice. The nonparametric bootstrap with multinomial resampling is a canonical and statistically valid method for estimating confidence intervals for parameters derived from count data.\n-   **Well-Posed**: The problem is well-posed. All quantities are precisely defined, and the inputs are sufficient to compute a unique, stable solution. The use of a random seed ensures reproducibility of the stochastic bootstrap component.\n-   **Objective**: The language is objective and formal. There are no subjective or ambiguous terms.\n-   **Completeness and Consistency**: The problem is self-contained and internally consistent. The definitions, procedural steps, and inputs are all provided and do not contradict one another. The test cases cover a range of immunologically plausible scenarios, including a boundary case (monoclonal repertoire), confirming the robustness of the required methodology.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. A solution will be developed and implemented as specified.\n\n### Solution Design\n\nThe task is to compute point estimates and bootstrap confidence intervals for two effect sizes, $\\Delta H$ and $\\mathrm{LRR}_2$, that quantify the change in lymphocyte repertoire diversity between a pre-event and a post-event sample. The solution is structured around the principles of statistical estimation and resampling.\n\n**1. Point Estimation of Diversity and Effect Sizes**\n\nFirst, we compute the observed diversity metrics and effect sizes from the raw input count vectors $\\mathbf{c}^{\\mathrm{pre}}$ and $\\mathbf{c}^{\\mathrm{post}}$.\n\nFor each sample (pre and post), the total number of cells, $N = \\sum_i c_i$, is calculated. The vector of clonotype frequencies, $\\mathbf{p} = [c_1/N, c_2/N, \\dots]$, is then derived. These empirical probabilities form the basis for all diversity calculations.\n\nThe **Shannon entropy** (diversity of order $1$) is calculated as:\n$$\nH(\\mathbf{p}) = - \\sum_{i} p_i \\ln(p_i)\n$$\nIn this sum, terms where $p_i = 0$ are treated as $0$, since $\\lim_{p \\to 0^+} p \\ln p = 0$.\n\nThe **inverse Simpson diversity** (Hill number of order $q=2$) is calculated as:\n$$\nD_2(\\mathbf{p}) = \\frac{1}{\\sum_{i} p_i^2}\n$$\n\nUsing these diversity metrics, the two required effect sizes are computed:\n-   The **additive difference in Shannon entropy**, $\\Delta H$, measures the absolute change in entropy:\n    $$\n    \\Delta H = H(\\mathbf{p}^{\\mathrm{post}}) - H(\\mathbf{p}^{\\mathrm{pre}})\n    $$\n-   The **log-response ratio of $D_2$ diversity**, $\\mathrm{LRR}_2$, measures the proportional change on a logarithmic scale. This is appropriate for ratio-scale measures like Hill numbers.\n    $$\n    \\mathrm{LRR}_2 = \\ln\\left(\\frac{D_2(\\mathbf{p}^{\\mathrm{post}})}{D_2(\\mathbf{p}^{\\mathrm{pre}})}\\right) = \\ln(D_2(\\mathbf{p}^{\\mathrm{post}})) - \\ln(D_2(\\mathbf{p}^{\\mathrm{pre}}))\n    $$\n\n**2. Nonparametric Bootstrap for Confidence Intervals**\n\nTo quantify the statistical uncertainty of the point estimates, we use a nonparametric bootstrap, which simulates the original sampling process. The core assumption is that the empirical distributions, $\\mathbf{p}^{\\mathrm{pre}}$ and $\\mathbf{p}^{\\mathrm{post}}$, are the best estimates of the true underlying population distributions.\n\nThe procedure is as follows:\n-   A random number generator is initialized with the given seed $s$ for reproducibility.\n-   For a specified number of replicates $B$:\n    1.  A bootstrap pre-event sample of counts $\\mathbf{X}^{\\mathrm{pre}}_{(b)}$ is generated by drawing $N^{\\mathrm{pre}}$ times from a multinomial distribution with probabilities $\\mathbf{p}^{\\mathrm{pre}}$:\n        $$\n        \\mathbf{X}^{\\mathrm{pre}}_{(b)} \\sim \\mathrm{Multinomial}(N^{\\mathrm{pre}}, \\mathbf{p}^{\\mathrm{pre}})\n        $$\n    2.  Similarly, a bootstrap post-event sample $\\mathbf{X}^{\\mathrm{post}}_{(b)}$ is generated:\n        $$\n        \\mathbf{X}^{\\mathrm{post}}_{(b)} \\sim \\mathrm{Multinomial}(N^{\\mathrm{post}}, \\mathbf{p}^{\\mathrm{post}})\n        $$\n-   For each bootstrap pair $(\\mathbf{X}^{\\mathrm{pre}}_{(b)}, \\mathbf{X}^{\\mathrm{post}}_{(b)})$, the bootstrap frequencies $\\hat{\\mathbf{p}}^{\\mathrm{pre}}_{(b)}$ and $\\hat{\\mathbf{p}}^{\\mathrm{post}}_{(b)}$ are calculated. Then, the effect sizes $\\Delta H_{(b)}$ and $\\mathrm{LRR}_{2,(b)}$ are computed, mirroring the calculation for the observed data.\n-   This process yields two distributions of $B$ bootstrap-replicated effect sizes: $\\{\\Delta H_{(1)}, \\dots, \\Delta H_{(B)}\\}$ and $\\{\\mathrm{LRR}_{2,(1)}, \\dots, \\mathrm{LRR}_{2,(B)}\\}$.\n\n**3. Confidence Interval Construction**\n\nThe bootstrap percentile method is employed to construct the confidence intervals. For a given confidence level $1-\\alpha$, the two-sided confidence interval is formed by the $\\alpha/2$ and $1-\\alpha/2$ quantiles of the sorted bootstrap distribution.\n-   The confidence interval for $\\Delta H$ is $[\\quantile(\\{\\Delta H_{(b)}\\}, \\alpha/2), \\quantile(\\{\\Delta H_{(b)}\\}, 1-\\alpha/2)]$.\n-   The confidence interval for $\\mathrm{LRR}_2$ is $[\\quantile(\\{\\mathrm{LRR}_{2,(b)}\\}, \\alpha/2), \\quantile(\\{\\mathrm{LRR}_{2,(b)}\\}, 1-\\alpha/2)]$.\n\n**4. Implementation Strategy**\n\nThe implementation will leverage the `numpy` library for efficient, vectorized numerical operations, avoiding explicit loops over the $B$ replicates. `scipy.stats.entropy` will be used for a numerically stable and vectorized calculation of Shannon entropy. The `numpy.random.default_rng` class will be used to generate the multinomial samples, ensuring that the results are reproducible via the given random seed. The final output is then formatted into a string exactly as specified.",
            "answer": "[[0.1347073614833219,0.04639943564998399,0.2220194883584814,0.28768207245178085,0.0880026615555462,0.48580632551475736],[-1.905620025965427,-2.030588698188179,-1.7820163353702588,-1.9863433557884143,-2.321743015484803,-1.7247738240465223],[0.04505030221345404,-0.41372557999863116,0.4839446878415714,0.08693836371133596,-0.741031904724036,0.8999839973832185],[0.7377758909339397,0.4909893970349275,0.9996501178229654,1.3862943611198906,0.9234856094329381,1.862426362544154]]"
        }
    ]
}