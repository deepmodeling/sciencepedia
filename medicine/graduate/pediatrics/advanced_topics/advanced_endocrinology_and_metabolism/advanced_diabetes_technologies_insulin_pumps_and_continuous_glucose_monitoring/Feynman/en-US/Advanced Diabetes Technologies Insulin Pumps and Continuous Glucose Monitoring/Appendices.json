{
    "hands_on_practices": [
        {
            "introduction": "To prevent hypoglycemia, insulin pumps must account for the lingering effects of recent doses, a concept known as Insulin-On-Board (IOB). This exercise guides you through calculating IOB from first principles by modeling the time course of insulin action with a pharmacodynamic kernel . Understanding this calculation is crucial for appreciating how modern diabetes technology mitigates the risk of \"stacking\" insulin doses.",
            "id": "5099493",
            "problem": "A pediatric patient with Type 1 diabetes mellitus uses an insulin pump and Continuous Glucose Monitoring (CGM). The pump algorithm is configured to compute the correction component of a bolus by ensuring that the predicted total future glucose-lowering from insulin equals the current deviation from the glucose target. The following foundational assumptions are used:\n\n- The Correction Factor (CF) is defined as the proportionality between effective insulin units and the expected glucose decrease, so that an effective insulin quantity of $U$ units is expected to lower glucose by $CF \\times U$ in $\\mathrm{mg/dL}$.\n- Only bolus insulin contributes to Insulin-On-Board (IOB) for correction purposes; basal delivery is ignored for IOB in this computation.\n- The pharmacodynamic action of a bolus dose is modeled by a normalized impulse response (kernel) $a(t)$, representing the fraction of total glucose-lowering action delivered per unit time at time $t$ after the bolus. Assume a gamma-distribution kernel with shape parameter $2$ and time constant $\\tau$, given by\n$$\na(t) \\;=\\; \\frac{t}{\\tau^{2}} \\exp\\!\\left(-\\frac{t}{\\tau}\\right), \\quad t \\ge 0,\n$$\nwhich integrates to $1$ over $t \\in [0,\\infty)$.\n- The fraction of the bolus glucose-lowering action that remains to be delivered after time $t$ (the “tail” of the action that has not yet occurred) is the tail integral\n$$\nR(t) \\;=\\; \\int_{t}^{\\infty} a(s)\\, ds.\n$$\nThis quantity represents the fraction of the bolus that is still “on board” in the pharmacodynamic sense relevant to glucose-lowering.\n\nAt the present time, the CGM reports a current glucose of $G = 235 \\ \\mathrm{mg/dL}$ and the target glucose is $G^{*} = 120 \\ \\mathrm{mg/dL}$. The Correction Factor is $CF = 45 \\ \\mathrm{mg/dL}/\\mathrm{U}$. The pharmacodynamic time constant is $\\tau = 50 \\ \\mathrm{min}$. Two prior bolus doses were administered and logged in the pump:\n- A meal bolus of $2.0 \\ \\mathrm{U}$ given $120 \\ \\mathrm{min}$ ago.\n- A correction bolus of $0.8 \\ \\mathrm{U}$ given $45 \\ \\mathrm{min}$ ago.\n\nUsing first principles with the definitions above, determine the correction bolus to be delivered now, in International Units (U), that makes the predicted total future glucose-lowering equal to the current deviation $G - G^{*}$ while incorporating Insulin-On-Board (IOB) from the recent doses to avoid stacking. Round your final numerical answer to three significant figures and express it in $\\mathrm{U}$.",
            "solution": "The problem is a well-posed, scientifically grounded application of pharmacokinetics and pharmacodynamics as used in modern insulin pump algorithms. It is self-contained, with all necessary parameters and functional forms provided. Therefore, a validation of the problem statement finds it to be valid. We may proceed with the solution.\n\nThe core principle of the correction bolus algorithm is that the total predicted future glucose-lowering effect from all insulin sources must equal the current glucose deviation from the target. The current glucose deviation is $\\Delta G = G - G^{*}$, where $G$ is the current glucose and $G^{*}$ is the target glucose. The total future glucose-lowering effect is determined by the Correction Factor, $CF$, applied to the total effective insulin that will act in the future.\n\nThe total future-acting insulin consists of two components:\n1. The new correction bolus, which we denote as $U_{corr}$. Its entire action is in the future.\n2. The remaining action of previous boluses, which is quantified as Insulin-On-Board ($IOB$).\n\nThe relationship can be stated as:\n$$CF \\times (U_{corr} + IOB) = G - G^{*}$$\n\nOur objective is to determine $U_{corr}$. To do so, we must first calculate the $IOB$. The $IOB$ is the sum of the effective units of insulin remaining from all prior boluses. For a single bolus of dose $U_i$ administered at time $t_i$ ago, its contribution to the current $IOB$ is $U_i$ multiplied by the fraction of its total action that has yet to occur. This fraction is given by the tail integral $R(t_i)$.\n\nThe total $IOB$ from the two prior boluses is:\n$$IOB = U_1 R(t_1) + U_2 R(t_2)$$\nwhere $U_1 = 2.0 \\ \\mathrm{U}$ was given $t_1 = 120 \\ \\mathrm{min}$ ago, and $U_2 = 0.8 \\ \\mathrm{U}$ was given $t_2 = 45 \\ \\mathrm{min}$ ago.\n\nWe are given the insulin action kernel $a(t)$:\n$$a(t) = \\frac{t}{\\tau^{2}} \\exp\\left(-\\frac{t}{\\tau}\\right)$$\nThe fraction of remaining action, $R(t)$, is defined as:\n$$R(t) = \\int_{t}^{\\infty} a(s)\\, ds = \\int_{t}^{\\infty} \\frac{s}{\\tau^{2}} \\exp\\left(-\\frac{s}{\\tau}\\right)\\, ds$$\nTo evaluate this integral, we use integration by parts, $\\int u \\, dv = uv - \\int v \\, du$. Let:\n$u = s$\n$dv = \\frac{1}{\\tau^2} \\exp\\left(-\\frac{s}{\\tau}\\right) ds$\n\nThen we find:\n$du = ds$\n$v = \\int \\frac{1}{\\tau^2} \\exp\\left(-\\frac{s}{\\tau}\\right) ds = -\\frac{1}{\\tau} \\exp\\left(-\\frac{s}{\\tau}\\right)$\n\nApplying the integration by parts formula:\n$$ \\int \\frac{s}{\\tau^{2}} \\exp\\left(-\\frac{s}{\\tau}\\right)\\, ds = s \\left(-\\frac{1}{\\tau} \\exp\\left(-\\frac{s}{\\tau}\\right)\\right) - \\int \\left(-\\frac{1}{\\tau} \\exp\\left(-\\frac{s}{\\tau}\\right)\\right) \\, ds $$\n$$ = -\\frac{s}{\\tau} \\exp\\left(-\\frac{s}{\\tau}\\right) + \\frac{1}{\\tau} \\int \\exp\\left(-\\frac{s}{\\tau}\\right) \\, ds $$\n$$ = -\\frac{s}{\\tau} \\exp\\left(-\\frac{s}{\\tau}\\right) - \\exp\\left(-\\frac{s}{\\tau}\\right) = -\\left(\\frac{s}{\\tau} + 1\\right) \\exp\\left(-\\frac{s}{\\tau}\\right) $$\n\nNow we evaluate the definite integral for $R(t)$:\n$$ R(t) = \\left[ -\\left(\\frac{s}{\\tau} + 1\\right) \\exp\\left(-\\frac{s}{\\tau}\\right) \\right]_{s=t}^{s\\to\\infty} $$\nAs $s \\to \\infty$, the term $\\exp(-s/\\tau)$ approaches $0$ faster than any polynomial in $s$, so the expression evaluates to $0$ at the upper limit.\n$$ R(t) = 0 - \\left[ -\\left(\\frac{t}{\\tau} + 1\\right) \\exp\\left(-\\frac{t}{\\tau}\\right) \\right] = \\left(\\frac{t}{\\tau} + 1\\right) \\exp\\left(-\\frac{t}{\\tau}\\right) $$\nThis is the analytical expression for the fraction of insulin action remaining at time $t$ after a bolus.\n\nWe are given the pharmacodynamic time constant $\\tau = 50 \\ \\mathrm{min}$. We can now calculate $R(t_1)$ and $R(t_2)$.\nFor the first bolus at $t_1 = 120 \\ \\mathrm{min}$:\nThe dimensionless time is $t_1/\\tau = 120/50 = 2.4$.\n$$ R(t_1) = R(120) = \\left(\\frac{120}{50} + 1\\right) \\exp\\left(-\\frac{120}{50}\\right) = (2.4 + 1) \\exp(-2.4) = 3.4 \\exp(-2.4) $$\n\nFor the second bolus at $t_2 = 45 \\ \\mathrm{min}$:\nThe dimensionless time is $t_2/\\tau = 45/50 = 0.9$.\n$$ R(t_2) = R(45) = \\left(\\frac{45}{50} + 1\\right) \\exp\\left(-\\frac{45}{50}\\right) = (0.9 + 1) \\exp(-0.9) = 1.9 \\exp(-0.9) $$\n\nNow, we compute the total $IOB$:\n$$ IOB = U_1 R(t_1) + U_2 R(t_2) = (2.0) \\times [3.4 \\exp(-2.4)] + (0.8) \\times [1.9 \\exp(-0.9)] $$\n$$ IOB = 6.8 \\exp(-2.4) + 1.52 \\exp(-0.9) $$\nUsing numerical values for the exponential functions: $\\exp(-2.4) \\approx 0.090718$ and $\\exp(-0.9) \\approx 0.406570$.\n$$ IOB \\approx 6.8 \\times 0.090718 + 1.52 \\times 0.406570 $$\n$$ IOB \\approx 0.616882 + 0.617986 \\approx 1.234868 \\ \\mathrm{U} $$\n\nWith the $IOB$ calculated, we can now solve for the required correction bolus $U_{corr}$. Rearranging the primary equation:\n$$ U_{corr} = \\frac{G - G^{*}}{CF} - IOB $$\nWe substitute the given values:\n$G = 235 \\ \\mathrm{mg/dL}$\n$G^{*} = 120 \\ \\mathrm{mg/dL}$\n$CF = 45 \\ \\mathrm{mg/dL}/\\mathrm{U}$\n$$ \\frac{G - G^{*}}{CF} = \\frac{235 - 120}{45} = \\frac{115}{45} = \\frac{23}{9} \\approx 2.555556 \\ \\mathrm{U} $$\nThis term represents the total correction needed if there were no insulin on board. Subtracting the $IOB$ to prevent over-correction (stacking):\n$$ U_{corr} \\approx 2.555556 - 1.234868 \\approx 1.320688 \\ \\mathrm{U} $$\nThe problem requires the final answer to be rounded to three significant figures.\n$$ U_{corr} \\approx 1.32 \\ \\mathrm{U} $$\nThis is the correction bolus to be delivered now.",
            "answer": "$$\\boxed{1.32}$$"
        },
        {
            "introduction": "Effective glycemic control often requires anticipating and counteracting predictable patterns, such as the dawn phenomenon. This practice challenges you to design a proactive basal insulin adjustment to offset a modeled morning glucose rise, maintaining the patient at their target . By modeling a continuous insulin infusion and its delayed pharmacodynamic effects, you will apply principles of dynamic systems control to a real-world clinical problem.",
            "id": "5099515",
            "problem": "A pediatric patient with Type 1 Diabetes Mellitus is using a modern subcutaneous insulin pump and Continuous Glucose Monitoring (CGM). At time $04{:}00$, the CGM shows an emerging dawn phenomenon characterized by a plasma glucose rate-of-change of $dG/dt = 2\\,\\mathrm{mg/dL/min}$ at onset. The dawn phenomenon is modeled as an endogenously driven disturbance whose instantaneous effect on glucose rate-of-change decays exponentially from its onset according to $r(t) = 2\\,\\exp(-t/\\tau_{d})\\,\\mathrm{mg/dL/min}$ for $t \\in [0,T]$, where $t$ is minutes after $04{:}00$, the decay time constant is $\\tau_{d} = 60\\,\\mathrm{min}$, and $T = 180\\,\\mathrm{min}$ corresponds to $07{:}00$. The child starts at glucose target at $04{:}00$, there is no carbohydrate intake, and the preexisting basal profile is otherwise appropriate outside of the dawn disturbance.\n\nAssume the rapid-acting insulin’s glucose-lowering effect after a unit dose follows a standard linear time-invariant impulse response consistent with a two-stage subcutaneous absorption and effect process. Specifically, the fraction of a unit dose’s total glucose-lowering effect that has manifested by elapsed time $\\tau \\ge 0$ is given by the Erlang-$2$ cumulative function\n$$F(\\tau) = 1 - \\exp\\!\\left(-\\frac{\\tau}{\\theta}\\right)\\left(1 + \\frac{\\tau}{\\theta}\\right),$$\nwith scale $\\theta = 50\\,\\mathrm{min}$. The Insulin Sensitivity Factor (ISF) is $60\\,\\mathrm{mg/dL}$ per unit insulin, meaning that over its full action a net one unit reduces glucose by $60\\,\\mathrm{mg/dL}$.\n\nThe pump can superimpose a constant incremental basal rate $\\Delta u$ (in $\\mathrm{U/min}$) starting at $04{:}00$ and continuing until $07{:}00$ so that the net glucose at $07{:}00$ remains at target (no net rise by $07{:}00$). Using first principles of mass balance on glucose and superposition of insulin action (with the lag-corrected pharmacokinetics encoded by $F$), derive and compute the unique constant $\\Delta u$ that exactly offsets the dawn disturbance at $07{:}00$.\n\nExpress your final answer as the basal rate increase in $\\mathrm{U/h}$ and round to three significant figures.",
            "solution": "The problem requires the calculation of a constant incremental basal insulin rate, denoted as $\\Delta u$, needed to counteract the hyperglycemic effect of a modeled dawn phenomenon, such that the net change in plasma glucose concentration at a specified future time is zero.\n\nThe fundamental principle governing the plasma glucose concentration, $G(t)$, is the mass balance equation. The net rate of change of glucose, $\\frac{dG}{dt}$, is the sum of all influences:\n$$ \\frac{dG}{dt}(t) = (\\text{endogenous disturbance rate}) - (\\text{insulin-driven glucose uptake rate}) $$\nWe are given that the pre-existing basal profile is appropriate, meaning it balances the baseline endogenous glucose production and utilization. Therefore, we only need to consider the changes from the baseline, which are the dawn phenomenon disturbance and the effect of the incremental insulin rate $\\Delta u$.\n\nThe change in glucose concentration over the time interval from $t=0$ (corresponding to $04{:}00$) to $t=T$ (corresponding to $07{:}00$, so $T=180\\,\\mathrm{min}$) is the integral of its rate of change:\n$$ \\Delta G(T) = G(T) - G(0) = \\int_{0}^{T} \\frac{dG}{dt}(t) \\, dt $$\nThe goal is for the net glucose to remain at the target, which means the net change must be zero: $\\Delta G(T) = 0$.\n\nThe total change $\\Delta G(T)$ can be separated into two components: the rise due to the dawn phenomenon, $\\Delta G_{\\text{dawn}}(T)$, and the drop due to the incremental insulin, $\\Delta G_{\\text{insulin}}(T)$.\n$$ \\Delta G(T) = \\Delta G_{\\text{dawn}}(T) + \\Delta G_{\\text{insulin}}(T) = 0 $$\nThis implies that the glucose rise from the disturbance must be exactly cancelled by the glucose drop from the insulin action:\n$$ \\Delta G_{\\text{dawn}}(T) = - \\Delta G_{\\text{insulin}}(T) $$\n\nFirst, we calculate the total glucose rise from the dawn phenomenon. The rate of this disturbance is given as $r(t) = r_0 \\exp(-t/\\tau_d)$, where $r_0 = 2\\,\\mathrm{mg/dL/min}$ and $\\tau_d = 60\\,\\mathrm{min}$.\n$$ \\Delta G_{\\text{dawn}}(T) = \\int_{0}^{T} r(t) \\, dt = \\int_{0}^{180} 2 \\exp(-t/60) \\, dt $$\n$$ \\Delta G_{\\text{dawn}}(T) = 2 \\left[ -60 \\exp(-t/60) \\right]_{0}^{180} = -120 \\left[ \\exp(-180/60) - \\exp(0) \\right] $$\n$$ \\Delta G_{\\text{dawn}}(T) = -120 (\\exp(-3) - 1) = 120(1 - \\exp(-3)) \\,\\mathrm{mg/dL} $$\n\nNext, we calculate the total glucose drop from the incremental insulin infusion. The pump delivers a constant infusion rate of $\\Delta u$ in units of $\\mathrm{U/min}$. At any time $\\tau$ within the interval $[0, T]$, an infinitesimal amount of insulin $dI = \\Delta u \\, d\\tau$ is delivered. The total potential glucose-lowering effect of this dose is $\\text{ISF} \\cdot dI$, where $\\text{ISF} = 60\\,\\mathrm{mg/dL/U}$. The insulin action is delayed, and the fraction of the total effect that has manifested by an elapsed time $s$ is given by the cumulative distribution function $F(s)$. For the dose $dI$ delivered at time $\\tau$, the elapsed time at the final moment $T$ is $s = T-\\tau$. Thus, the glucose drop at time $T$ due to this infinitesimal dose is:\n$$ d(-\\Delta G_{\\text{insulin}}) = \\text{ISF} \\cdot dI \\cdot F(T-\\tau) = \\text{ISF} \\cdot (\\Delta u \\, d\\tau) \\cdot F(T-\\tau) $$\nTo find the total glucose drop, we integrate over the entire infusion period from $\\tau=0$ to $\\tau=T$:\n$$ -\\Delta G_{\\text{insulin}}(T) = \\int_{0}^{T} \\text{ISF} \\cdot \\Delta u \\cdot F(T-\\tau) \\, d\\tau $$\nSince $\\Delta u$ and ISF are constants:\n$$ -\\Delta G_{\\text{insulin}}(T) = \\Delta u \\cdot \\text{ISF} \\cdot \\int_{0}^{T} F(T-\\tau) \\, d\\tau $$\n\nEquating the glucose rise and drop:\n$$ 120(1 - \\exp(-3)) = \\Delta u \\cdot 60 \\cdot \\int_{0}^{180} F(180-\\tau) \\, d\\tau $$\nSolving for $\\Delta u$:\n$$ \\Delta u = \\frac{120(1 - \\exp(-3))}{60 \\int_{0}^{180} F(180-\\tau) \\, d\\tau} = \\frac{2(1 - \\exp(-3))}{\\int_{0}^{180} F(180-\\tau) \\, d\\tau} $$\nThe integral can be simplified by a change of variable $s = 180 - \\tau$, so $d\\tau = -ds$. When $\\tau=0$, $s=180$. When $\\tau=180$, $s=0$.\n$$ \\int_{0}^{180} F(180-\\tau) \\, d\\tau = \\int_{180}^{0} F(s) (-ds) = \\int_{0}^{180} F(s) \\, ds $$\nThe problem provides $F(s) = 1 - \\exp(-s/\\theta)(1 + s/\\theta)$, with $\\theta = 50\\,\\mathrm{min}$. We must evaluate $\\int_{0}^{T} F(s) \\, ds$.\n$$ \\int_{0}^{T} F(s) \\, ds = \\int_{0}^{T} \\left( 1 - \\exp(-s/\\theta) - \\frac{s}{\\theta}\\exp(-s/\\theta) \\right) ds $$\n$$ = \\int_{0}^{T} 1 \\, ds - \\int_{0}^{T} \\exp(-s/\\theta) \\, ds - \\frac{1}{\\theta} \\int_{0}^{T} s \\exp(-s/\\theta) \\, ds $$\nThe first integral is $T$.\nThe second integral is $\\int_{0}^{T} \\exp(-s/\\theta) \\, ds = [-\\theta \\exp(-s/\\theta)]_{0}^{T} = \\theta(1 - \\exp(-T/\\theta))$.\nThe third integral requires integration by parts. Let $u=s$ and $dv = \\exp(-s/\\theta) ds$. Then $du=ds$ and $v = -\\theta \\exp(-s/\\theta)$.\n$$ \\int_{0}^{T} s \\exp(-s/\\theta) \\, ds = [-s\\theta \\exp(-s/\\theta)]_{0}^{T} - \\int_{0}^{T} (-\\theta \\exp(-s/\\theta)) \\, ds $$\n$$ = -T\\theta \\exp(-T/\\theta) + \\theta \\int_{0}^{T} \\exp(-s/\\theta) \\, ds = -T\\theta \\exp(-T/\\theta) + \\theta^2(1 - \\exp(-T/\\theta)) $$\n$$ = \\theta^2 - (T\\theta + \\theta^2)\\exp(-T/\\theta) $$\nCombining these results:\n$$ \\int_{0}^{T} F(s) \\, ds = T - \\theta(1 - \\exp(-T/\\theta)) - \\frac{1}{\\theta}(\\theta^2 - (T\\theta + \\theta^2)\\exp(-T/\\theta)) $$\n$$ = T - \\theta + \\theta\\exp(-T/\\theta) - \\theta + (T+\\theta)\\exp(-T/\\theta) $$\n$$ = T - 2\\theta + (T + 2\\theta)\\exp(-T/\\theta) $$\nSubstituting the values $T=180$ and $\\theta=50$:\n$$ \\int_{0}^{180} F(s) \\, ds = 180 - 2(50) + (180 + 2(50))\\exp(-180/50) $$\n$$ = 180 - 100 + (180 + 100)\\exp(-3.6) = 80 + 280\\exp(-3.6) \\,\\mathrm{min} $$\nNow we substitute this back into the expression for $\\Delta u$ (in $\\mathrm{U/min}$):\n$$ \\Delta u = \\frac{2(1 - \\exp(-3))}{80 + 280\\exp(-3.6)} $$\nNumerically:\n$$ \\Delta u \\approx \\frac{2(1 - 0.049787)}{80 + 280(0.027324)} = \\frac{2(0.950213)}{80 + 7.65072} = \\frac{1.900426}{87.65072} \\approx 0.021683\\,\\mathrm{U/min} $$\nThe question asks for the rate in units of $\\mathrm{U/h}$.\n$$ \\Delta u_{\\mathrm{U/h}} = \\Delta u_{\\mathrm{U/min}} \\times 60\\,\\mathrm{min/h} \\approx 0.021683\\,\\mathrm{U/min} \\times 60\\,\\mathrm{min/h} \\approx 1.30098\\,\\mathrm{U/h} $$\nRounding to three significant figures, we get $1.30\\,\\mathrm{U/h}$.",
            "answer": "$$\\boxed{1.30}$$"
        },
        {
            "introduction": "The true power of advanced diabetes technology lies in its ability to be personalized. This exercise places you in the role of a clinical data scientist, tasked with deriving a patient's specific Insulin-to-Carbohydrate Ratio (ICR) from their CGM and meal log data . Using linear regression, you will learn how to translate observational data into a fundamental parameter for effective and personalized mealtime insulin dosing.",
            "id": "5099525",
            "problem": "A pediatric endocrinology service is evaluating data from Continuous Glucose Monitoring (CGM) and insulin pump meal logs to estimate a data-driven Insulin-to-Carbohydrate Ratio (ICR) for postprandial glucose control. Continuous Glucose Monitoring (CGM) provides interstitial glucose measurements in milligrams per deciliter (mg/dL) at fixed time points after meals. For each meal, carbohydrate amount in grams and bolus insulin amount in international units (IU) are recorded. The aim is to use these records to estimate an ICR that captures how many grams of carbohydrate are neutralized per unit of rapid-acting insulin to prevent a postprandial rise in glucose, and to quantify the model error in milligrams per deciliter (mg/dL).\n\nFundamental basis. Begin from a mass-balance perspective: postprandial glucose concentration change is driven by exogenous carbohydrate appearance into blood and insulin-mediated disposal. Over short postprandial windows, treat the net excursion as the observable outcome of these opposing processes. Assume the relationship between the postprandial excursion and the carbohydrate and insulin dosing is well approximated by a linear model over the studied range, and estimate model parameters by Ordinary Least Squares (OLS).\n\nDefinitions to use. For meal index $m$, define the postprandial excursion $E_m$ as the maximum CGM reading in a fixed postprandial window minus the premeal baseline CGM value. The baseline for meal $m$ is the CGM level immediately prior to meal onset. The postprandial window comprises six fixed time points at $30$, $60$, $90$, $120$, $150$, and $180$ minutes after meal onset. The carbohydrate dose $c_m$ is expressed in grams, and the bolus insulin dose $b_m$ is expressed in international units (IU). The linear model relates $E_m$ to $(c_m,b_m)$ via an affine relation. The estimated Insulin-to-Carbohydrate Ratio (ICR) is the grams per unit necessary to render the predicted excursion zero, derived logically from the fitted model coefficients without using any shortcut formula. Model error is quantified by the Root Mean Squared Error (RMSE) between the observed excursions and the model-predicted excursions, expressed in mg/dL.\n\nData and computation instructions. Use the following test suite of three cases. In each case, for each meal $m$, you are given a baseline CGM value (in mg/dL), a carbohydrate dose $c_m$ (in grams), a bolus insulin dose $b_m$ (in IU), and an excursion amplitude parameter $A_m$ (in mg/dL). Construct the CGM postprandial profile for each meal as six values in mg/dL: baseline plus $A_m$ multiplied by the fixed shape fractions vector $S=[0.1,0.5,1.0,0.8,0.6,0.2]$, evaluated at $30$, $60$, $90$, $120$, $150$, and $180$ minutes, respectively. Compute $E_m$ as the difference between the maximum of these six CGM postprandial values and the baseline. Then fit the linear model relating $E_m$ to $c_m$ and $b_m$ via OLS with an intercept, and finally derive the data-driven ICR (grams per unit) implied by the fitted model coefficients such that the predicted excursion is zero. Compute the RMSE between observed $E_m$ and model-predicted excursions, in mg/dL.\n\nUnits. All CGM values are in mg/dL, all carbohydrate doses are in grams, all insulin doses are in international units (IU), and the ICR must be reported in grams per unit. The RMSE must be reported in mg/dL.\n\nTest suite. For each case, use the given meal-level parameters:\n\nCase $1$ (happy path, mixed doses):\n- Shape fractions $S=[0.1,0.5,1.0,0.8,0.6,0.2]$\n- Meals (baseline in mg/dL, $c_m$ in grams, $b_m$ in IU, $A_m$ in mg/dL):\n  - $(95,60,5,15)$\n  - $(105,45,3,20)$\n  - $(100,75,6,10)$\n  - $(110,30,2,12)$\n  - $(98,90,7,15)$\n  - $(102,50,0,95)$\n\nCase $2$ (boundary coverage, some zero insulin):\n- Shape fractions $S=[0.1,0.5,1.0,0.8,0.6,0.2]$\n- Meals:\n  - $(100,20,0,42)$\n  - $(97,80,6,38)$\n  - $(103,10,1,5)$\n  - $(108,100,10,8)$\n\nCase $3$ (edge with noise and an outlier):\n- Shape fractions $S=[0.1,0.5,1.0,0.8,0.6,0.2]$\n- Meals:\n  - $(94,60,3,40)$\n  - $(99,90,6,20)$\n  - $(101,30,1,30)$\n  - $(96,120,10,5)$\n  - $(104,45,0,75)$\n\nAlgorithmic requirements. For each case:\n- Build the design matrix with an intercept and columns for $c_m$ and $b_m$, and the response vector of observed $E_m$ computed from the CGM profiles.\n- Estimate model coefficients by OLS via the Moore–Penrose pseudoinverse.\n- Derive the ICR from first principles as the grams per unit that sets the model-predicted excursion to zero for changes along the carbohydrate–insulin dosing axis.\n- Compute the RMSE in mg/dL as the square root of the mean of squared residuals.\n\nAnswer format and rounding. Your program should produce a single line of output containing the six results as a comma-separated list enclosed in square brackets, in the order: $[\\text{ICR}_{1},\\text{RMSE}_{1},\\text{ICR}_{2},\\text{RMSE}_{2},\\text{ICR}_{3},\\text{RMSE}_{3}]$. Round each floating-point result to two decimal places. ICR values must be in grams per unit and RMSE values must be in mg/dL. No other text should be printed.",
            "solution": "The objective is to estimate a data-driven Insulin-to-Carbohydrate Ratio (ICR) using Continuous Glucose Monitoring (CGM) and insulin pump meal logs. The logic proceeds from a first-principles mass-balance perspective and then constructs an algorithm that is implementable.\n\nFundamental basis. We consider postprandial glucose dynamics as the result of carbohydrate appearance and insulin-mediated glucose disposal. Over the short window following a meal, assume a locally linear relationship between meal carbohydrate $c_m$ and insulin bolus $b_m$ and the observed excursion $E_m$ in the CGM. Specifically, write an affine approximation for meal $m$:\n$$\nE_m \\approx \\beta_0 + \\beta_c \\, c_m + \\beta_b \\, b_m + \\varepsilon_m,\n$$\nwhere $\\beta_0$ captures baseline offsets and other factors, $\\beta_c$ captures the marginal effect of carbohydrate intake on glucose excursion, $\\beta_b$ captures the marginal effect of insulin bolus on excursion, and $\\varepsilon_m$ is random error. This linearization is a standard approximation arising from a first-order Taylor expansion of the underlying nonlinear mass-balance relations over the operating range, under the assumption that variations in $c_m$ and $b_m$ are moderate around a typical operating point.\n\nInsulin-to-Carbohydrate Ratio (ICR) derivation. The Insulin-to-Carbohydrate Ratio (ICR) is defined as the grams of carbohydrate per unit of rapid-acting insulin required to neutralize a meal's glucose-raising effect. Within the affine model, consider small changes $\\Delta c$ and $\\Delta b$ that leave the excursion unchanged, i.e., $\\Delta E = 0$. Taking the differential of the linear model yields\n$$\n0 \\approx \\beta_c \\, \\Delta c + \\beta_b \\, \\Delta b.\n$$\nSolving for the neutralizing dosing ratio gives\n$$\n\\frac{\\Delta c}{\\Delta b} \\approx - \\frac{\\beta_b}{\\beta_c}.\n$$\nThe left-hand side is the Insulin-to-Carbohydrate Ratio (ICR), expressed in grams per unit. Thus, a data-driven estimate for the ICR is obtained directly from the fitted coefficients without invoking any shortcut formula: after estimating $\\beta_c$ and $\\beta_b$ by Ordinary Least Squares (OLS), compute\n$$\n\\widehat{\\text{ICR}} = - \\frac{\\widehat{\\beta}_b}{\\widehat{\\beta}_c}.\n$$\n\nExcursion computation from CGM. For each meal $m$, we define the excursion $E_m$ as the maximum CGM value in a fixed postprandial window minus the premeal baseline. The postprandial window is specified at $30$, $60$, $90$, $120$, $150$, and $180$ minutes after the meal. Given a baseline CGM value (in mg/dL) and an amplitude parameter $A_m$ (in mg/dL), the CGM sequence is constructed at those six time points as\n$$\n\\text{CGM}_{m}(t_k) = \\text{baseline}_m + A_m \\cdot s_k,\n$$\nwhere the shape fractions vector is $S = [s_1, s_2, s_3, s_4, s_5, s_6] = [0.1, 0.5, 1.0, 0.8, 0.6, 0.2]$. The excursion is then\n$$\nE_m = \\max_{k \\in \\{1,\\dots,6\\}} \\text{CGM}_{m}(t_k) - \\text{baseline}_m.\n$$\nBy construction with $s_3 = 1.0$, the maximum occurs at $90$ minutes and equals the amplitude $A_m$; nevertheless, the algorithm must compute it from the CGM data rather than assume a value.\n\nOrdinary Least Squares (OLS). Stack the meals into a design matrix $X$ and response vector $y$:\n$$\nX = \\begin{bmatrix}\n1 & c_1 & b_1 \\\\\n\\vdots & \\vdots & \\vdots \\\\\n1 & c_M & b_M\n\\end{bmatrix}, \\quad\ny = \\begin{bmatrix}\nE_1 \\\\\n\\vdots \\\\\nE_M\n\\end{bmatrix}.\n$$\nThe OLS coefficient vector $\\widehat{\\beta} = [\\widehat{\\beta}_0,\\widehat{\\beta}_c,\\widehat{\\beta}_b]^\\top$ is computed using the Moore–Penrose pseudoinverse:\n$$\n\\widehat{\\beta} = X^{+} y,\n$$\nwhere $X^{+}$ denotes the pseudoinverse of $X$. This is numerically stable even if $X^\\top X$ is ill-conditioned.\n\nModel error. Compute the model-predicted excursions\n$$\n\\widehat{y} = X \\, \\widehat{\\beta},\n$$\nand the residuals $r = y - \\widehat{y}$. The Root Mean Squared Error (RMSE) quantifies error in mg/dL:\n$$\n\\text{RMSE} = \\sqrt{\\frac{1}{M} \\sum_{m=1}^{M} r_m^2 }.\n$$\n\nAlgorithmic steps for each case.\n1. For each meal, construct the six CGM values using the baseline and amplitude with the fixed shape fractions, compute $E_m$ as the maximum minus baseline.\n2. Build $X$ and $y$ across all meals in the case.\n3. Compute $\\widehat{\\beta}$ via the pseudoinverse, derive $\\widehat{\\text{ICR}} = -\\widehat{\\beta}_b / \\widehat{\\beta}_c$ (grams per unit).\n4. Compute $\\widehat{y}$ and RMSE in mg/dL.\n5. Round $\\widehat{\\text{ICR}}$ and RMSE to two decimal places and prepare the single-line output.\n\nTest suite coverage rationale. Case $1$ offers a balanced set with varied carbohydrate and insulin doses and one zero-insulin meal; Case $2$ includes boundary scenarios with minimal or zero insulin and a wide carbohydrate range; Case $3$ includes noisy excursions and an outlier meal that produces a small peak despite high insulin, testing robustness. These collectively exercise identifiability, stability of the pseudoinverse, and sensitivity to noise.\n\nFinal output specification. The program must print a single line containing $[\\text{ICR}_{1},\\text{RMSE}_{1},\\text{ICR}_{2},\\text{RMSE}_{2},\\text{ICR}_{3},\\text{RMSE}_{3}]$, with each value rounded to two decimals, where ICR values are in grams per unit and RMSE values are in mg/dL.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef construct_cgm_series(baseline, amplitude, shape_fracs):\n    \"\"\"\n    Construct the CGM postprandial series for a meal:\n    baseline + amplitude * shape_fracs at fixed times 30-180 min.\n    Returns the array of CGM values in mg/dL.\n    \"\"\"\n    return baseline + amplitude * np.array(shape_fracs, dtype=float)\n\ndef compute_excursions(meals, shape_fracs):\n    \"\"\"\n    Given a list of meals with fields:\n      - 'baseline' (mg/dL)\n      - 'carb' (grams)\n      - 'bolus' (IU)\n      - 'amplitude' (mg/dL)\n    and a shape fractions vector,\n    construct CGM series and compute excursions E_m as max(post) - baseline.\n    Returns:\n      - c_list: list of carbs per meal (grams)\n      - b_list: list of bolus per meal (IU)\n      - e_list: list of excursions per meal (mg/dL)\n    \"\"\"\n    c_list, b_list, e_list = [], [], []\n    for meal in meals:\n        baseline = float(meal['baseline'])\n        amplitude = float(meal['amplitude'])\n        c = float(meal['carb'])\n        b = float(meal['bolus'])\n        cgm_series = construct_cgm_series(baseline, amplitude, shape_fracs)\n        excursion = float(np.max(cgm_series) - baseline)\n        c_list.append(c)\n        b_list.append(b)\n        e_list.append(excursion)\n    return np.array(c_list), np.array(b_list), np.array(e_list)\n\ndef ols_icr_and_rmse(c, b, e):\n    \"\"\"\n    Perform OLS with intercept to fit e ~ beta0 + beta_c * c + beta_b * b.\n    Derive ICR = -beta_b / beta_c (grams per unit).\n    Compute RMSE between observed e and predicted.\n    Returns (icr, rmse).\n    \"\"\"\n    # Design matrix with intercept\n    X = np.column_stack([np.ones_like(c), c, b])\n    # Moore–Penrose pseudoinverse solution\n    beta = np.linalg.pinv(X) @ e\n    beta0, beta_c, beta_b = beta.tolist()\n    # Derive ICR from first principles: grams per unit that neutralizes excursion\n    # Avoid division by zero: if beta_c ~ 0, set ICR to np.nan\n    icr = -beta_b / beta_c if abs(beta_c) > 1e-12 else np.nan\n    # Predictions and RMSE\n    y_hat = X @ beta\n    rmse = float(np.sqrt(np.mean((e - y_hat) ** 2)))\n    return float(icr), rmse\n\ndef solve():\n    # Fixed shape fractions at 30,60,90,120,150,180 minutes\n    shape_fracs = [0.1, 0.5, 1.0, 0.8, 0.6, 0.2]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path, mixed doses\n        [\n            {'baseline': 95,  'carb': 60, 'bolus': 5,  'amplitude': 15},\n            {'baseline': 105, 'carb': 45, 'bolus': 3,  'amplitude': 20},\n            {'baseline': 100, 'carb': 75, 'bolus': 6,  'amplitude': 10},\n            {'baseline': 110, 'carb': 30, 'bolus': 2,  'amplitude': 12},\n            {'baseline': 98,  'carb': 90, 'bolus': 7,  'amplitude': 15},\n            {'baseline': 102, 'carb': 50, 'bolus': 0,  'amplitude': 95},\n        ],\n        # Case 2: boundary coverage, some zero insulin\n        [\n            {'baseline': 100, 'carb': 20,  'bolus': 0,  'amplitude': 42},\n            {'baseline': 97,  'carb': 80,  'bolus': 6,  'amplitude': 38},\n            {'baseline': 103, 'carb': 10,  'bolus': 1,  'amplitude': 5},\n            {'baseline': 108, 'carb': 100, 'bolus': 10, 'amplitude': 8},\n        ],\n        # Case 3: edge with noise and an outlier\n        [\n            {'baseline': 94,  'carb': 60,  'bolus': 3,  'amplitude': 40},\n            {'baseline': 99,  'carb': 90,  'bolus': 6,  'amplitude': 20},\n            {'baseline': 101, 'carb': 30,  'bolus': 1,  'amplitude': 30},\n            {'baseline': 96,  'carb': 120, 'bolus': 10, 'amplitude': 5},\n            {'baseline': 104, 'carb': 45,  'bolus': 0,  'amplitude': 75},\n        ],\n    ]\n\n    results = []\n    for meals in test_cases:\n        c, b, e = compute_excursions(meals, shape_fracs)\n        icr, rmse = ols_icr_and_rmse(c, b, e)\n        # Round to two decimals for output\n        results.append(f\"{icr:.2f}\")\n        results.append(f\"{rmse:.2f}\")\n\n    # Final print statement in the exact required format: single line, comma-separated in brackets.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}