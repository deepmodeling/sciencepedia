{
    "hands_on_practices": [
        {
            "introduction": "准确诊断急性爱泼斯坦-巴尔病毒（EBV）感染对于临床管理至关重要，但这通常需要对复杂的血清学结果进行细致解读。本练习  演示了如何运用贝叶斯定理，结合病毒衣壳抗原（VCA）IgM 和 EB 病毒核抗原（EBNA）IgG 两项检测结果，从而超越简单的“阳性”或“阴性”判断。通过计算阳性预测值（PPV）、阴性预测值（NPV）和后验概率，您将学习如何量化诊断确定性，这是循证诊断的核心技能。",
            "id": "4651588",
            "problem": "一组有症状的成年人在一家三级医疗机构的传染病诊所接受评估，怀疑患有急性爱泼斯坦-巴尔病毒（EBV）单核细胞增多症。每位患者都接受两种酶联免疫吸附试验（ELISA）血清学检测：EBV病毒衣壳抗原免疫球蛋白M（VCA IgM）和EBV核抗原免疫球蛋白G（EBNA IgG）。为诊断急性EBV感染，将EBNA IgG检测定义为一种二元测试：当EBNA IgG缺失时（记为EBNA IgG阴性），检测结果视为“阳性”；当EBNA IgG存在时（记为EBNA IgG阳性），检测结果视为“阴性”。该队列中急性EBV感染的患病率为 $\\pi = 0.18$。\n\nVCA IgM ELISA检测急性EBV感染的灵敏度为 $Se_A = 0.93$，特异性为 $Sp_A = 0.97$，其中“阳性”表示VCA IgM存在。EBNA IgG ELISA检测（当EBNA IgG缺失时解读为“阳性”）对急性EBV感染的灵敏度为 $Se_B = 0.90$，对非急性EBV感染的特异性为 $Sp_B = 0.94$。\n\n仅使用灵敏度、特异性、阳性预测值（PPV）、阴性预测值（NPV）和贝叶斯定理的核心定义，并假设在给定真实疾病状态的情况下，两项测试条件独立，请完成以下任务：\n\n- 在此队列中，推导每项独立测试的PPV和NPV。\n- 在此队列中，推导在“VCA IgM阳性”和“EBNA IgG阴性”的联合结果下，患有急性EBV感染的后验概率的解析表达式，并进行数值计算。\n\n最后，以小数形式报告在“VCA IgM阳性”和“EBNA IgG阴性”的联合结果下，患有急性EBV感染的后验概率。将最终答案四舍五入至四位有效数字。不要使用百分号。",
            "solution": "评估问题陈述的有效性。\n\n### 步骤1：提取已知信息\n- **患者队列**：因疑似急性爱泼斯坦-巴尔病毒（EBV）单核细胞增多症而接受评估的有症状成年人。\n- **急性EBV感染患病率 ($\\pi$)**：$\\pi = P(D) = 0.18$。\n- **测试A (VCA IgM ELISA)**：\n    - “阳性”结果表示VCA IgM存在。\n    - 对急性EBV的灵敏度：$Se_A = 0.93$。\n    - 对急性EBV的特异性：$Sp_A = 0.97$。\n- **测试B (EBNA IgG ELISA)**：\n    - “阳性”结果定义为EBNA IgG缺失（EBNA IgG阴性）。\n    - “阴性”结果定义为EBNA IgG存在（EBNA IgG阳性）。\n    - 对急性EBV的灵敏度（基于此定义）：$Se_B = 0.90$。\n    - 对急性EBV的特异性（基于此定义）：$Sp_B = 0.94$。\n- **假设**：在给定真实疾病状态的情况下，两项测试条件独立。\n- **目标**：\n    1. 推导每项独立测试的阳性预测值（PPV）和阴性预测值（NPV）。\n    2. 推导在“VCA IgM阳性”和“EBNA IgG阴性”的联合结果下，患有急性EBV感染的后验概率的解析表达式。\n    3. 对此后验概率进行数值计算，并四舍五入至四位有效数字。\n\n### 步骤2：使用提取的已知信息进行验证\n该问题具有科学依据。使用VCA IgM和EBNA IgG血清学检测来区分急性与既往EBV感染是标准的临床实践。VCA IgM是急性感染的标志物，而EBNA IgG在感染后期才产生，其缺失也表明是急性（而非既往）感染。将EBNA IgG检测的“阳性”定义为抗体缺失虽然不常规，但在此情境下为识别急性疾病是明确陈述且临床上合理的。所提供的灵敏度、特异性和患病率值对于所述临床环境是合理的。问题设定良好，提供了所有必要信息和假设（例如，条件独立性），足以使用源自贝叶斯定理的标准生物统计学公式唯一地求解所要求的量。问题客观且无歧义。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解答。\n\n### 解答推导\n设 $D$ 为患者患有急性EBV感染的事件， $D^c$ 为患者未患有急性EBV感染的事件。\n疾病的先验概率（患病率）为 $P(D) = \\pi = 0.18$。\n无疾病的先验概率为 $P(D^c) = 1 - \\pi = 1 - 0.18 = 0.82$。\n\n设 $A^+$ 和 $A^-$ 分别表示测试A（VCA IgM）的阳性和阴性结果。\n设 $B^+$ 和 $B^-$ 分别表示测试B（EBNA IgG）的阳性和阴性结果。\n\n给定的测试特性如下：\n- 测试A的灵敏度：$Se_A = P(A^+|D) = 0.93$。\n- 测试A的特异性：$Sp_A = P(A^-|D^c) = 0.97$。\n- 测试B的灵敏度：$Se_B = P(B^+|D) = 0.90$。\n- 测试B的特异性：$Sp_B = P(B^-|D^c) = 0.94$。\n\n由此，我们可以推导出互补概率：\n- 测试A的假阴性率：$P(A^-|D) = 1 - Se_A = 1 - 0.93 = 0.07$。\n- 测试A的假阳性率：$P(A^+|D^c) = 1 - Sp_A = 1 - 0.97 = 0.03$。\n- 测试B的假阴性率：$P(B^-|D) = 1 - Se_B = 1 - 0.90 = 0.10$。\n- 测试B的假阳性率：$P(B^+|D^c) = 1 - Sp_B = 1 - 0.94 = 0.06$。\n\n**独立测试的PPV和NPV**\n阳性预测值（PPV）是在给定阳性测试结果的情况下患有该疾病的概率，即 $P(D|T^+)$。使用贝叶斯定理：\n$$PPV = P(D|T^+) = \\frac{P(T^+|D)P(D)}{P(T^+|D)P(D) + P(T^+|D^c)P(D^c)} = \\frac{Se \\cdot \\pi}{Se \\cdot \\pi + (1 - Sp) \\cdot (1 - \\pi)}$$\n阴性预测值（NPV）是在给定阴性测试结果的情况下未患该疾病的概率，即 $P(D^c|T^-)$。使用贝叶斯定理：\n$$NPV = P(D^c|T^-) = \\frac{P(T^-|D^c)P(D^c)}{P(T^-|D^c)P(D^c) + P(T^-|D)P(D)} = \\frac{Sp \\cdot (1 - \\pi)}{Sp \\cdot (1 - \\pi) + (1 - Se) \\cdot \\pi}$$\n\n对于测试A (VCA IgM)：\n$$PPV_A = \\frac{Se_A \\cdot \\pi}{Se_A \\cdot \\pi + (1 - Sp_A) \\cdot (1 - \\pi)} = \\frac{0.93 \\cdot 0.18}{0.93 \\cdot 0.18 + (1 - 0.97) \\cdot 0.82} = \\frac{0.1674}{0.1674 + 0.03 \\cdot 0.82} = \\frac{0.1674}{0.1674 + 0.0246} = \\frac{0.1674}{0.192} \\approx 0.8719$$\n$$NPV_A = \\frac{Sp_A \\cdot (1 - \\pi)}{(1 - Se_A) \\cdot \\pi + Sp_A \\cdot (1 - \\pi)} = \\frac{0.97 \\cdot 0.82}{(1 - 0.93) \\cdot 0.18 + 0.97 \\cdot 0.82} = \\frac{0.7954}{0.07 \\cdot 0.18 + 0.7954} = \\frac{0.7954}{0.0126 + 0.7954} = \\frac{0.7954}{0.808} \\approx 0.9844$$\n\n对于测试B（EBNA IgG，“阳性”=缺失）：\n$$PPV_B = \\frac{Se_B \\cdot \\pi}{Se_B \\cdot \\pi + (1 - Sp_B) \\cdot (1 - \\pi)} = \\frac{0.90 \\cdot 0.18}{0.90 \\cdot 0.18 + (1 - 0.94) \\cdot 0.82} = \\frac{0.162}{0.162 + 0.06 \\cdot 0.82} = \\frac{0.162}{0.162 + 0.0492} = \\frac{0.162}{0.2112} \\approx 0.7671$$\n$$NPV_B = \\frac{Sp_B \\cdot (1 - \\pi)}{(1 - Se_B) \\cdot \\pi + Sp_B \\cdot (1 - \\pi)} = \\frac{0.94 \\cdot 0.82}{(1 - 0.90) \\cdot 0.18 + 0.94 \\cdot 0.82} = \\frac{0.7708}{0.10 \\cdot 0.18 + 0.7708} = \\frac{0.7708}{0.018 + 0.7708} = \\frac{0.7708}{0.7888} \\approx 0.9772$$\n\n**联合测试结果的后验概率**\n我们需要计算在两项测试均为阳性的情况下，患有急性EBV感染的后验概率，即 $P(D|A^+ \\cap B^+)$。该联合结果对应于“VCA IgM阳性”和“EBNA IgG阴性”。\n使用贝叶斯定理：\n$$P(D|A^+ \\cap B^+) = \\frac{P(A^+ \\cap B^+ | D) P(D)}{P(A^+ \\cap B^+)}$$\n分母是联合阳性结果的全概率，可以使用全概率定律展开：\n$$P(A^+ \\cap B^+) = P(A^+ \\cap B^+|D)P(D) + P(A^+ \\cap B^+|D^c)P(D^c)$$\n使用在给定疾病状态下测试条件独立的假设：\n- $P(A^+ \\cap B^+|D) = P(A^+|D)P(B^+|D) = Se_A \\cdot Se_B$\n- $P(A^+ \\cap B^+|D^c) = P(A^+|D^c)P(B^+|D^c) = (1 - Sp_A) \\cdot (1 - Sp_B)$\n\n将这些代入贝叶斯定理表达式，得到后验概率的解析公式：\n$$P(D|A^+ \\cap B^+) = \\frac{Se_A \\cdot Se_B \\cdot P(D)}{Se_A \\cdot Se_B \\cdot P(D) + (1 - Sp_A) \\cdot (1 - Sp_B) \\cdot P(D^c)}$$\n$$P(D|A^+ \\cap B^+) = \\frac{Se_A \\cdot Se_B \\cdot \\pi}{Se_A \\cdot Se_B \\cdot \\pi + (1 - Sp_A) \\cdot (1 - Sp_B) \\cdot (1 - \\pi)}$$\n\n现在，我们对此表达式进行数值计算：\n- 分子：$Se_A \\cdot Se_B \\cdot \\pi = 0.93 \\cdot 0.90 \\cdot 0.18 = 0.837 \\cdot 0.18 = 0.15066$。\n- 分母第一项（与分子相同）：$0.15066$。\n- 分母第二项：$(1 - Sp_A) \\cdot (1 - Sp_B) \\cdot (1 - \\pi) = (1 - 0.97) \\cdot (1 - 0.94) \\cdot (1 - 0.18) = 0.03 \\cdot 0.06 \\cdot 0.82 = 0.0018 \\cdot 0.82 = 0.001476$。\n- 分母（总和）：$0.15066 + 0.001476 = 0.152136$。\n\n$$P(D|A^+ \\cap B^+) = \\frac{0.15066}{0.152136} \\approx 0.99029780$$\n\n四舍五入至四位有效数字，后验概率为 $0.9903$。",
            "answer": "$$\n\\boxed{0.9903}\n$$"
        },
        {
            "introduction": "在从诊断转向治疗的过程中，对巨细胞病毒（CMV）等严重感染的有效管理不仅需要选择正确的药物，更需要确定合适的剂量。本练习  将指导您进行一次真实世界中的个体化给药计算。您将学习如何整合患者特异性生理数据（如肌酐清除率）与药效学目标（如 $AUC_{0-24}/\\text{MIC}$），为免疫功能低下患者精确计算更昔洛韦的剂量，以实现疗效最大化和毒性最小化。",
            "id": "4651527",
            "problem": "一名患有活动性巨细胞病毒（CMV；人疱疹病毒5型）病毒血症的造血干细胞移植受者将接受静脉注射更昔洛韦治疗。为确保病毒学抑制并最小化耐药性，感染科团队旨在使24小时浓度-时间曲线下面积与最低抑菌浓度的比值$\\left(AUC_{0-24}/\\text{MIC}\\right)$达到一个由移植受者药代动力学/药效动力学（PK/PD）模型推导出的特定阈值。假设以下具有科学依据的特性：(i) 在线性、时不变的药代动力学条件下，固定时间间隔内的全身暴露量与剂量成正比，与全身清除率成反比；(ii) 对于静脉给药，生物利用度为 $F=1$；(iii) 更昔洛韦的全身清除率是肾脏和非肾脏组分的总和，其中肾清除率与肌酐清除率呈线性关系，这与主要通过肾脏消除的特性一致。\n\n患者测得的肌酐清除率为 $\\text{CrCl} = 35$ mL/min。更昔洛韦清除率的肾脏组分模型为 $CL_{\\text{renal}} = \\beta \\cdot \\text{CrCl}$，其中 $\\beta = 0.06$ L/小时 每 (mL/分钟)。非肾清除率为 $CL_{\\text{nonrenal}} = 0.20$ L/小时。通过标准化噬斑减少试验测定，CMV分离株的实验室最低抑菌浓度为 $\\text{MIC} = 0.58$ mg/L。目标指数为 $\\Phi = AUC_{0-24}/\\text{MIC} = 1000$。更昔洛韦将以每 $\\tau = 12$ 小时一次的相等剂量给药。\n\n仅使用上述基本定义，推导出在稳态下能够达到目标 $AUC_{0-24}/\\text{MIC}$ 的个体化每次给药剂量（以mg为单位）。假设为单室线性动力学，且每个给药间隔内的蓄积可忽略不计。将最终的每次给药剂量四舍五入至三位有效数字。以mg为单位表示你的答案。",
            "solution": "用户希望我在问题有效的情况下解决它。\n\n### 第一步：提取已知条件\n- **患者类型**：造血干细胞移植受者。\n- **感染**：活动性巨细胞病毒（CMV；人疱疹病毒5型）病毒血症。\n- **药物**：静脉注射更昔洛韦。\n- **给药间隔**：$\\tau = 12$ 小时，等剂量给药。\n- **目标PK/PD指数**：24小时浓度-时间曲线下面积与最低抑菌浓度的比值，$\\Phi = AUC_{0-24}/\\text{MIC}$。\n- **目标值**：$\\Phi = 1000$。\n- **药代动力学模型假设**：\n    - 线性、时不变药代动力学。\n    - 全身暴露量与剂量成正比，与全身清除率成反比。\n    - 静脉给药的生物利用度：$F=1$。\n    - 全身清除率（$CL$）是肾脏和非肾脏组分的总和：$CL = CL_{\\text{renal}} + CL_{\\text{nonrenal}}$。\n    - 肾清除率模型：$CL_{\\text{renal}} = \\beta \\cdot \\text{CrCl}$。\n    - 单室线性动力学。\n- **患者特异性数据**：\n    - 肌酐清除率：$\\text{CrCl} = 35$ mL/min。\n- **药物特异性参数**：\n    - 肾清除率比例因子：$\\beta = 0.06$ L/小时 每 (mL/分钟)。\n    - 非肾清除率：$CL_{\\text{nonrenal}} = 0.20$ L/小时。\n- **病毒特异性数据**：\n    - 最低抑菌浓度：$\\text{MIC} = 0.58$ mg/L。\n- **要求输出**：每次给药剂量（以mg为单位），四舍五入至三位有效数字。\n\n### 第二步：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n\n- **科学依据**：该问题在临床药代动力学和传染病学方面有充分的依据。更昔洛韦是治疗CMV的标准药物，特别是在像移植受者这样的免疫功能低下宿主中。使用$AUC/\\text{MIC}$比值作为PK/PD目标是浓度依赖性抗菌药物的一个基本概念。将药物清除率划分为肾脏和非肾脏组分，并将肾清除率与肌酐清除率联系起来的模型，是处理经肾脏消除药物的标准且科学有效的方法。提供的肌酐清除率、MIC和清除率参数值在临床上是合理的。该主题正确定位于传染病学和人疱疹病毒的特定领域内。\n- **适定性**：该问题是适定的。它提供了一个明确的目标（计算更昔洛韦的每次给药剂量）以及实现该目标所需的所有定量数据和关系。其结构保证了唯一解的存在。\n- **客观性**：该问题使用精确、客观和定量的语言进行陈述。它不含主观或模棱两可的术语。\n- **不完整或矛盾的设定**：设定是完整且一致的。计算所需的所有变量都已定义并赋值。关于“每个给药间隔内蓄积可忽略不计”的假设可以解释为一种简化，即使用基本的稳态下面积-剂量关系，这与线性动力学的其他假设是一致的。\n- **不切实际或不可行**：所提供的数据是现实的。35 mL/min的肌酐清除率表明中度肾功能损害，这在该患者群体中很常见，需要调整剂量。MIC和清除率参数在预期范围内。\n- **结论**：该问题未违反任何无效标准。这是一个科学合理、适定且客观的临床药代动力学问题。\n\n### 第三步：裁决与行动\n该问题是**有效的**。将提供完整解答。\n\n### 解题推导\n目标是确定每 $\\tau = 12$ 小时给予一次的更昔洛韦个体化剂量 $D$，以达到目标24小时暴露指数。\n\n首先，我们建立稳态下剂量、清除率和浓度-时间曲线下面积（AUC）之间的基本关系。对于静脉给药（$F=1$）且具有线性药代动力学的药物，单个给药间隔 $\\tau$ 内的AUC由下式给出：\n$$AUC_{0-\\tau, ss} = \\frac{D}{CL}$$\n其中 $D$ 是每个间隔的给药剂量，$CL$ 是总全身清除率。\n\n目标是基于24小时内的AUC，即 $AUC_{0-24}$。由于药物每 $\\tau=12$ 小时给药一次，所以在24小时内给药两次。根据线性叠加原理，稳态下24小时内的总AUC是两个给药间隔AUC的总和：\n$$AUC_{0-24, ss} = AUC_{0-12, ss} + AUC_{12-24, ss} = 2 \\times AUC_{0-12, ss}$$\n代入单次给药间隔AUC的表达式，我们得到：\n$$AUC_{0-24, ss} = 2 \\times \\frac{D}{CL}$$\n\n接下来，我们计算患者的总全身清除率 $CL$。它是肾脏（$CL_{\\text{renal}}$）和非肾脏（$CL_{\\text{nonrenal}}$）清除率组分的总和。\n$$CL = CL_{\\text{renal}} + CL_{\\text{nonrenal}}$$\n肾清除率被建模为患者肌酐清除率 $\\text{CrCl}$ 的线性函数。\n$$CL_{\\text{renal}} = \\beta \\cdot \\text{CrCl}$$\n给定值 $\\beta = 0.06$ L/小时 每 (mL/分钟) 和 $\\text{CrCl} = 35$ mL/min：\n$$CL_{\\text{renal}} = 0.06 \\frac{\\text{L/hour}}{\\text{mL/min}} \\times 35 \\text{ mL/min} = 2.1 \\text{ L/hour}$$\n非肾清除率给定为 $CL_{\\text{nonrenal}} = 0.20$ L/小时。\n现在，总全身清除率为：\n$$CL = 2.1 \\text{ L/hour} + 0.20 \\text{ L/hour} = 2.30 \\text{ L/hour}$$\n\n问题指定了目标PK/PD指数 $\\Phi$：\n$$\\Phi = \\frac{AUC_{0-24}}{\\text{MIC}} = 1000$$\n注意，$AUC_{0-24}$ 的单位是（浓度 $\\times$ 时间），例如 (mg/L)$\\cdot$h，而 $\\text{MIC}$ 的单位是浓度，例如 mg/L。因此，指数 $\\Phi$ 的单位是时间（小时），所以 $\\Phi = 1000$ h。\n\n我们现在可以将推导出的 $AUC_{0-24}$ 和 $CL$ 的表达式代入目标方程，以求解剂量 $D$。\n$$\\frac{2D/CL}{\\text{MIC}} = \\Phi$$\n重新整理方程以求解 $D$：\n$$2D = \\Phi \\cdot CL \\cdot \\text{MIC}$$\n$$D = \\frac{\\Phi \\cdot CL \\cdot \\text{MIC}}{2}$$\n\n最后，我们将已知的数值代入此方程：\n- $\\Phi = 1000$ h\n- $CL = 2.30$ L/小时\n- $\\text{MIC} = 0.58$ mg/L\n\n$$D = \\frac{(1000 \\text{ h}) \\cdot (2.30 \\text{ L/hour}) \\cdot (0.58 \\text{ mg/L})}{2}$$\n单位组合为 $(\\text{h}) \\cdot (\\frac{\\text{L}}{\\text{h}}) \\cdot (\\frac{\\text{mg}}{\\text{L}}) = \\text{mg}$，这对于剂量来说是正确的。\n$$D = \\frac{2300 \\cdot 0.58}{2} \\text{ mg}$$\n$$D = \\frac{1334}{2} \\text{ mg}$$\n$$D = 667 \\text{ mg}$$\n\n问题要求将最终答案四舍五入至三位有效数字。计算出的值 $667$ 已经有三位有效数字。因此，每12小时给予的个体化更昔洛韦剂量是 $667$ mg。",
            "answer": "$$\\boxed{667}$$"
        },
        {
            "introduction": "将视野从个体治疗扩展到群体水平的疾病动态，潜伏病毒的再激活是一个关键的流行病学问题，例如水痘-带状疱疹病毒（VZV）的再激活（带状疱疹）。本练习  引导您构建一个数学模型，将免疫衰老这一基础生物学过程与带状疱疹的发病风险联系起来。通过应用非齐次泊松过程，您将学会如何预测潜伏感染的长期动态，并量化评估特定人群的疾病发生率。",
            "id": "4651414",
            "problem": "要求您设计并实现一个完整的、可运行的程序，该程序基于一个由年龄相关的T细胞介导免疫力下降所调节的潜伏期至裂解期转换的随机模型，估算在一个指定时间窗口内，队列中经历水痘-带状疱疹病毒（Varicella-Zoster Virus, VZV）带状疱疹再激活的个体的预期比例。所需的推导和计算必须从基本原理出发，并遵循严谨的数学公式。\n\n假设和基本原理：\n- 潜伏期再激活事件被建模为一个非齐次泊松过程，其瞬时风险率 $h(a)$ 依赖于年龄，其中 $a$ 是以年为单位的年龄。对于从年龄 $a$ 开始的长度为 $w$ 年的时间窗口，至少发生一次事件的概率为 $1 - \\exp\\!\\left(-\\int_{0}^{w} h(a+t) \\, dt\\right)$。\n- 年龄相关的T细胞介导免疫力下降由一个分段函数 $T(a)$ 表示，当 $a \\le a_{m}$ 时，$T(a) = T_{0}$（免疫成熟阈值），当 $a > a_{m}$ 时，$T(a) = T_{0} \\exp\\!\\left(-r (a - a_{m})\\right)$，其中 $T_{0}$ 是基线T细胞水平，$a_{m}$ 是下降起始年龄，$r$ 是下降速率（每年）。\n- 风险函数受T细胞相对损失的调节，表示为\n$$\nh(a) = h_{\\min} + h_{\\max}\\left(1 - \\frac{T(a)}{T_{0}}\\right),\n$$\n其中 $h_{\\min} \\ge 0$ 代表免疫力完好时的基线风险，$h_{\\max} > 0$ 代表当T细胞有效耗尽时达到饱和的额外风险贡献。所有风险的单位均为每年，所有时间的单位均为年。\n\n任务要求：\n1. 对于窗口开始时年龄为 $a$、窗口长度为 $w$ 的每个个体，根据上述基本原理，推导在该窗口内至少发生一次再激活的概率表达式。这需要计算积分 $\\int_{0}^{w} h(a+t) \\, dt$，并正确处理 $T(a)$ 的分段定义，同时考虑到窗口内跨越 $a_{m}$ 的情况。\n2. 对于由一个有限年龄列表定义的队列，计算在窗口期内至少有一次再激活的队列预期比例，即个体概率的算术平均值。\n3. 实现一个程序，为下面测试套件中的每一组参数评估预期的队列比例。程序必须生成单行输出，包含一个由方括号括起来的逗号分隔的结果列表（例如，$[\\text{result}_1,\\text{result}_2,\\text{result}_3]$）。\n4. 将结果表示为小数值。年龄和时间单位必须是年，风险参数单位必须是每年。\n\n测试套件（每个案例指定 $(\\text{ages}, a_{m}, r, h_{\\min}, h_{\\max}, w)$）：\n- 案例 1：年龄 $[45, 55, 65]$，$a_{m} = 50$，$r = 0.03$，$h_{\\min} = 0.005$，$h_{\\max} = 0.05$，$w = 1$。\n- 案例 2：年龄 $[30, 35, 40]$，$a_{m} = 50$，$r = 0.04$，$h_{\\min} = 0.003$，$h_{\\max} = 0.06$，$w = 0.5$。\n- 案例 3：年龄 $[70, 80, 90]$，$a_{m} = 50$，$r = 0.05$，$h_{\\min} = 0.004$，$h_{\\max} = 0.08$，$w = 2$。\n- 案例 4：年龄 $[49]$，$a_{m} = 50$，$r = 0.03$，$h_{\\min} = 0.005$，$h_{\\max} = 0.05$，$w = 1$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。为保持一致性，请将每个数值结果格式化为六位小数。不应打印任何其他文本。",
            "solution": "用户请求了一个关于水痘-带状疱疹病毒（VZV）再激活建模问题的解决方案。第一步是验证问题陈述。\n\n### 步骤1：提取已知信息\n\n已知信息如下：\n- **模型类型**：潜伏期再激活事件被建模为非齐次泊松过程。\n- **风险函数**：瞬时风险是年龄依赖的，表示为 $h(a)$，其中 $a$ 是以年为单位的年龄。\n- **再激活概率**：对于从年龄 $a$ 开始，长度为 $w$ 年的时间窗口，至少发生一次事件的概率是 $P(a, w) = 1 - \\exp(-\\int_{0}^{w} h(a+t) \\, dt)$。\n- **T细胞免疫函数**：$T(a)$ 是一个表示T细胞介导免疫力的分段函数。\n    - 当 $a \\le a_{m}$ 时，$T(a) = T_{0}$。\n    - 当 $a > a_{m}$ 时，$T(a) = T_{0} \\exp(-r (a - a_{m}))$。\n    - 参数：$T_0$ 是基线水平，$a_m$ 是下降起始年龄（免疫成熟阈值），$r$ 是每年的下降率。\n- **风险函数公式**：\n$$\nh(a) = h_{\\min} + h_{\\max}\\left(1 - \\frac{T(a)}{T_{0}}\\right)\n$$\n    - 参数：$h_{\\min} \\ge 0$ 是基线风险，$h_{\\max} > 0$ 是额外的风险贡献。所有风险的单位均为每年。\n- **任务1**：推导再激活概率的表达式，这需要计算积分 $\\Lambda(a, w) = \\int_{0}^{w} h(a+t) \\, dt$。\n- **任务2**：对于具有年龄列表的队列，计算再激活的预期比例，即个体概率的算术平均值。\n- **任务3和4**：实现一个程序，为几个测试案例计算此比例，并以逗号分隔、格式化为六位小数的小数形式输出结果。\n- **测试套件**：\n    - 案例 $1$：$(\\text{ages}=[45, 55, 65], a_{m} = 50, r = 0.03, h_{\\min} = 0.005, h_{\\max} = 0.05, w = 1)$\n    - 案例 $2$：$(\\text{ages}=[30, 35, 40], a_{m} = 50, r = 0.04, h_{\\min} = 0.003, h_{\\max} = 0.06, w = 0.5)$\n    - 案例 $3$：$(\\text{ages}=[70, 80, 90], a_{m} = 50, r = 0.05, h_{\\min} = 0.004, h_{\\max} = 0.08, w = 2)$\n    - 案例 $4$：$(\\text{ages}=[49], a_{m} = 50, r = 0.03, h_{\\min} = 0.005, h_{\\max} = 0.05, w = 1)$\n\n### 步骤2：使用提取的已知信息进行验证\n\n- **科学依据**：该问题基于标准的流行病学建模技术。使用带有年龄依赖风险函数的非齐次泊松过程，是为随时间变化的事件发生率建模的一种常见且有效的方法。免疫衰老模型虽然是一个简化的指数衰减，但对于这类问题而言是一个合理的抽象。总体框架具有科学合理性。\n- **适定性**：该问题是适定的。所有必需的函数、参数和边界条件都已定义。目标是推导解析表达式并计算数值结果，基于所提供的输入，存在唯一解。\n- **客观性**：该问题以精确、客观的数学语言陈述，没有主观性或歧义。\n- **其他缺陷**：该问题没有违反任何其他无效标准。它是可形式化的、与指定主题相关、完整、一致且科学上可信的。\n\n### 步骤3：结论与行动\n\n该问题是**有效的**。将提供完整的解决方案。\n\n### 基于原理的解决方案推导\n\n解决方案需要推导和计算经历VZV再激活的队列的预期比例。这可以通过首先求出单个个体的再激活概率，然后在整个队列中对该概率取平均值来实现。\n\n**1. 年龄依赖风险函数 $h(a)$ 的推导**\n\n风险函数 $h(a)$ 依赖于T细胞免疫函数 $T(a)$。通过将 $T(a)$ 的分段定义代入 $h(a)$ 的表达式中，我们得到了一个分段风险函数。\n\n- 对于年龄 $a \\le a_{m}$：\n$T(a) = T_{0}$，因此 $\\frac{T(a)}{T_{0}} = 1$。风险函数变为：\n$h(a) = h_{\\min} + h_{\\max}(1 - 1) = h_{\\min}$。\n\n- 对于年龄 $a > a_{m}$：\n$T(a) = T_{0} \\exp(-r(a - a_{m}))$，因此 $\\frac{T(a)}{T_{0}} = \\exp(-r(a - a_{m}))$。风险函数变为：\n$h(a) = h_{\\min} + h_{\\max}(1 - \\exp(-r(a - a_{m})))$。\n\n**2. 累积风险 $\\Lambda(a, w)$ 的推导**\n\n再激活概率取决于时间窗口 $[0, w]$ 内的累积风险，即 $\\int_{0}^{w} h(a+t) \\, dt$。在数学上等价且在概念上更简单的方法是，将风险函数对年龄从 $a$ 积分到 $a+w$：\n$$\n\\Lambda(a, w) = \\int_{a}^{a+w} h(x) \\, dx\n$$\n此积分的值取决于积分区间 $[a, a+w]$ 是在免疫阈值 $a_{m}$ 之前、之后，还是跨越该阈值。\n\n**情况 A：整个窗口在免疫阈值之前或恰好在阈值上 ($a+w \\le a_{m}$)**\n在这种情况下，对于区间 $[a, a+w]$ 内的任何年龄 $x$，都有 $x \\le a_{m}$，因此 $h(x) = h_{\\min}$。\n$$\n\\Lambda(a, w) = \\int_{a}^{a+w} h_{\\min} \\, dx = h_{\\min} [x]_{a}^{a+w} = h_{\\min}(a+w - a) = h_{\\min} w\n$$\n\n**情况 B：整个窗口在免疫阈值之后 ($a > a_{m}$)**\n在这种情况下，对于区间 $[a, a+w]$ 内的任何年龄 $x$，都有 $x > a_{m}$，因此 $h(x) = h_{\\min} + h_{\\max}(1 - \\exp(-r(x - a_{m})))$。\n$$\n\\Lambda(a, w) = \\int_{a}^{a+w} \\left[ h_{\\min} + h_{\\max} - h_{\\max}\\exp(-r(x - a_{m})) \\right] \\, dx\n$$\n$$\n\\Lambda(a, w) = \\left[ (h_{\\min} + h_{\\max})x - h_{\\max} \\left(-\\frac{1}{r}\\right)\\exp(-r(x - a_{m})) \\right]_{a}^{a+w}\n$$\n$$\n\\Lambda(a, w) = (h_{\\min} + h_{\\max})(a+w - a) + \\frac{h_{\\max}}{r} \\left[ \\exp(-r(x-a_m)) \\right]_{a}^{a+w}\n$$\n$$\n\\Lambda(a, w) = (h_{\\min} + h_{\\max})w + \\frac{h_{\\max}}{r} \\left( \\exp(-r(a+w-a_m)) - \\exp(-r(a-a_m)) \\right)\n$$\n\n**情况 C：窗口跨越免疫阈值 ($a \\le a_{m} < a+w$)**\n积分在 $a_{m}$ 处被分割：\n$$\n\\Lambda(a, w) = \\int_{a}^{a_{m}} h(x) \\, dx + \\int_{a_{m}}^{a+w} h(x) \\, dx\n$$\n第一部分在 $[a, a_{m}]$ 上，其中 $h(x) = h_{\\min}$：\n$$\n\\int_{a}^{a_{m}} h_{\\min} \\, dx = h_{\\min}(a_{m} - a)\n$$\n第二部分在 $[a_{m}, a+w]$ 上，其中 $h(x)$ 遵循 $a > a_{m}$ 的表达式。这个积分等同于情况 B，起始年龄为 $a_{m}$，持续时间为 $(a+w) - a_{m}$：\n$$\n\\int_{a_{m}}^{a+w} h(x) \\, dx = (h_{\\min} + h_{\\max})(a+w-a_{m}) + \\frac{h_{\\max}}{r} \\left( \\exp(-r(a+w-a_{m})) - \\exp(-r(a_{m}-a_{m})) \\right)\n$$\n$$\n= (h_{\\min} + h_{\\max})(a+w-a_{m}) + \\frac{h_{\\max}}{r} \\left( \\exp(-r(a+w-a_{m})) - 1 \\right)\n$$\n$$\n= (h_{\\min} + h_{\\max})(a+w-a_{m}) - \\frac{h_{\\max}}{r} \\left( 1 - \\exp(-r(a+w-a_{m})) \\right)\n$$\n结合情况 C 的两部分：\n$$\n\\Lambda(a, w) = h_{\\min}(a_m - a) + (h_{\\min} + h_{\\max})(a+w-a_m) - \\frac{h_{\\max}}{r} \\left( 1 - \\exp(-r(a+w-a_m)) \\right)\n$$\n\n**3. 个体概率和队列比例**\n\n对于起始年龄为 $a$ 的个体，在长度为 $w$ 的窗口内至少发生一次再激活事件的概率是：\n$$\nP(a, w) = 1 - \\exp(-\\Lambda(a, w))\n$$\n对于一个由 $N$ 个年龄为 $\\{a_1, a_2, \\dots, a_N\\}$ 的个体组成的队列，经历再激活的预期比例是他们个体概率的算术平均值：\n$$\nF = \\frac{1}{N} \\sum_{i=1}^{N} P(a_i, w)\n$$\n程序实现将把这些推导出的公式应用于测试案例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the expected fraction of a cohort experiencing VZV zoster reactivation\n    based on a stochastic model of latency-to-lytic transition modulated by age-related\n    decline of T cell-mediated immunity.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: (ages, am, r, hmin, hmax, w)\n        (np.array([45.0, 55.0, 65.0]), 50.0, 0.03, 0.005, 0.05, 1.0),\n        # Case 2\n        (np.array([30.0, 35.0, 40.0]), 50.0, 0.04, 0.003, 0.06, 0.5),\n        # Case 3\n        (np.array([70.0, 80.0, 90.0]), 50.0, 0.05, 0.004, 0.08, 2.0),\n        # Case 4\n        (np.array([49.0]), 50.0, 0.03, 0.005, 0.05, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        ages, am, r, hmin, hmax, w = case\n        \n        cohort_probabilities = []\n        for a in ages:\n            integrated_hazard = 0.0\n            \n            # Case A: Entire window is before or at the immunity threshold (a + w = am)\n            if a + w = am:\n                integrated_hazard = hmin * w\n            \n            # Case B: Entire window is after the immunity threshold (a > am)\n            elif a > am:\n                term1 = (hmin + hmax) * w\n                exp_term1 = np.exp(-r * (a + w - am))\n                exp_term2 = np.exp(-r * (a - am))\n                term2 = (hmax / r) * (exp_term1 - exp_term2)\n                integrated_hazard = term1 + term2\n            \n            # Case C: Window straddles the immunity threshold (a = am  a + w)\n            else:\n                part1_duration = am - a\n                part1_hazard = hmin * part1_duration\n                \n                part2_duration = a + w - am\n                term1 = (hmin + hmax) * part2_duration\n                exp_term = np.exp(-r * part2_duration)\n                term2 = (hmax / r) * (exp_term - 1.0)\n                part2_hazard = term1 + term2\n                \n                integrated_hazard = part1_hazard + part2_hazard\n                \n            # Calculate the probability of at least one reactivation for the individual\n            prob = 1.0 - np.exp(-integrated_hazard)\n            cohort_probabilities.append(prob)\n\n        # The expected fraction is the arithmetic mean of individual probabilities\n        expected_fraction = np.mean(cohort_probabilities)\n        results.append(f\"{expected_fraction:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}