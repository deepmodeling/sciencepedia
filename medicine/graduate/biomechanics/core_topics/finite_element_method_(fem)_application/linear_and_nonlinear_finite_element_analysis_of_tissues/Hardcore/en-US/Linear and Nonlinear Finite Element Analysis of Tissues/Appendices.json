{
    "hands_on_practices": [
        {
            "introduction": "The foundation of the finite element method lies in discretizing a continuous problem into a system of algebraic equations. This exercise takes you through the essential process of constructing an element stiffness matrix, which relates nodal forces to nodal displacements. By deriving a component of the stiffness matrix for a 2D plane strain element from first principles, you will gain a concrete understanding of how continuum mechanics concepts like strain and stress are translated into the building blocks of a computational model .",
            "id": "4185741",
            "problem": "A thick, homogeneous, isotropic tissue patch is modeled as a single bilinear quadrilateral finite element in plane strain using the Finite Element Method (FEM). The element occupies a rectangle in the physical coordinates with nodes at $(-a/2,-b/2)$, $(a/2,-b/2)$, $(a/2,b/2)$, and $(-a/2,b/2)$, where $a>0$ and $b>0$ are the side lengths along the $x$- and $y$-axes, respectively. The element has uniform thickness $t$ out of plane. Let the displacement field be small and denote its components by $u(x,y)$ and $v(x,y)$. Assume plane strain kinematics and linear, isotropic elasticity with Young’s modulus $E$ and Poisson’s ratio $\\nu$, so that the Cauchy stress is linearly related to the strain via the standard plane strain constitutive tensor.\n\nUsing only:\n- the small-strain kinematic relations $ \\varepsilon_{xx}=\\partial u/\\partial x$, $ \\varepsilon_{yy}=\\partial v/\\partial y$, and $ \\gamma_{xy}=\\partial u/\\partial y+\\partial v/\\partial x$,\n- the principle of virtual work,\n- the bilinear quadrilateral shape functions defined on the natural coordinate square $-1\\le \\xi,\\eta \\le 1$ with the isoparametric mapping $x(\\xi,\\eta)=(a/2)\\,\\xi$ and $y(\\xi,\\eta)=(b/2)\\,\\eta$,\n\nderive the element-level expressions necessary to obtain the consistent stiffness matrix for this element. Then, specializing your derivation to the first node’s horizontal degree of freedom (i.e., the entry coupling the horizontal displacement at node $1$ with itself), carry out the exact integration over the element domain and report the resulting nondimensional scalar\n$$\\widehat{K}_{11}\\equiv \\frac{K_{11}}{E\\,t}$$\nas a closed-form algebraic expression in terms of $a$, $b$, and $\\nu$. Do not perform any numerical substitutions. Your final answer must be a single closed-form expression. Do not include units in your final answer. No rounding is required.",
            "solution": "The problem is subjected to validation against the specified criteria.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **Model:** A single bilinear quadrilateral finite element in plane strain. The tissue is thick, homogeneous, and isotropic.\n- **Geometry:** Rectangular element with nodes at $(-\\frac{a}{2},-\\frac{b}{2})$, $(\\frac{a}{2},-\\frac{b}{2})$, $(\\frac{a}{2},\\frac{b}{2})$, and $(-\\frac{a}{2},\\frac{b}{2})$, where $a>0$ and $b>0$.\n- **Thickness:** Uniform thickness $t$.\n- **Kinematics:** Small strain, with components $\\varepsilon_{xx}=\\frac{\\partial u}{\\partial x}$, $\\varepsilon_{yy}=\\frac{\\partial v}{\\partial y}$, and $\\gamma_{xy}=\\frac{\\partial u}{\\partial y}+\\frac{\\partial v}{\\partial x}$.\n- **Material Model:** Linear, isotropic elasticity with Young’s modulus $E$ and Poisson’s ratio $\\nu$. The constitutive relation is the standard for plane strain.\n- **Methodology:** Principle of virtual work.\n- **FE Formulation:** Isoparametric formulation with bilinear quadrilateral shape functions on the natural coordinate square $-1 \\le \\xi, \\eta \\le 1$.\n- **Mapping:** $x(\\xi,\\eta)=\\frac{a}{2}\\xi$ and $y(\\xi,\\eta)=\\frac{b}{2}\\eta$.\n- **Objective:** Derive the consistent stiffness matrix component $K_{11}$, which is the entry coupling the horizontal force at node $1$ with the horizontal displacement at node $1$.\n- **Final Answer Format:** Report the nondimensional scalar $\\widehat{K}_{11}\\equiv \\frac{K_{11}}{E\\,t}$ as a closed-form algebraic expression in terms of $a$, $b$, and $\\nu$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded:** The problem is a standard exercise in the Finite Element Method applied to linear elasticity, a cornerstone of computational mechanics and biomechanics. All principles are well-established.\n- **Well-Posed:** The problem provides all necessary information: geometry, material properties, kinematic relations, and the numerical method. The objective is clearly defined. The standard counter-clockwise node numbering convention is implied, making node $1$ the vertex at $(-\\frac{a}{2}, -\\frac{b}{2})$, corresponding to $(\\xi, \\eta) = (-1, -1)$. This leads to a unique, well-defined solution.\n- **Objective:** The problem is stated using precise, standard terminology from engineering and mathematics. It is free from ambiguity and subjectivity.\n\n**Step 3: Verdict and Action**\nThe problem is deemed valid. A detailed solution follows.\n\n### Solution Derivation\n\nThe element stiffness matrix $\\mathbf{K}$ relates the nodal force vector $\\mathbf{f}$ to the nodal displacement vector $\\mathbf{d}$ via $\\mathbf{f} = \\mathbf{K} \\mathbf{d}$. Using the principle of virtual work, the stiffness matrix for a plane strain element of thickness $t$ is given by the integral over the element's area $A$:\n$$ \\mathbf{K} = t \\int_{A} \\mathbf{B}^T \\mathbf{C} \\mathbf{B} \\, dA $$\nwhere $\\mathbf{B}$ is the strain-displacement matrix and $\\mathbf{C}$ is the constitutive matrix. The integral is evaluated in the natural coordinate system $(\\xi, \\eta)$ using the isoparametric mapping.\n$$ \\mathbf{K} = t \\int_{-1}^{1} \\int_{-1}^{1} \\mathbf{B}^T(\\xi, \\eta) \\mathbf{C} \\mathbf{B}(\\xi, \\eta) \\det(\\mathbf{J}) \\, d\\xi d\\eta $$\nHere, $\\mathbf{J}$ is the Jacobian matrix of the coordinate transformation.\n\nThe nodal displacement vector is ordered as $\\mathbf{d} = \\{u_1, v_1, u_2, v_2, u_3, v_3, u_4, v_4\\}^T$. We seek the component $K_{11}$, which couples the force $f_{x1}$ to the displacement $u_1$. This corresponds to the $(1,1)$ entry of the $8 \\times 8$ stiffness matrix. $K_{11}$ can be computed by considering only the first column of the $\\mathbf{B}$ matrix, which we denote $\\mathbf{b}_1$.\n$$ K_{11} = t \\int_{-1}^{1} \\int_{-1}^{1} \\mathbf{b}_1^T \\mathbf{C} \\mathbf{b}_1 \\det(\\mathbf{J}) \\, d\\xi d\\eta $$\n\n**1. Isoparametric Mapping and Jacobian**\nThe physical coordinates $(x,y)$ are mapped from the natural coordinates $(\\xi, \\eta)$ by:\n$$ x = \\frac{a}{2}\\xi, \\quad y = \\frac{b}{2}\\eta $$\nThe Jacobian matrix $\\mathbf{J}$ of this mapping is:\n$$ \\mathbf{J} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\frac{a}{2} & 0 \\\\ 0 & \\frac{b}{2} \\end{pmatrix} $$\nThe Jacobian is constant over the element. Its determinant is $\\det(\\mathbf{J}) = \\frac{ab}{4}$. The inverse Jacobian is:\n$$ \\mathbf{J}^{-1} = \\begin{pmatrix} \\frac{2}{a} & 0 \\\\ 0 & \\frac{2}{b} \\end{pmatrix} $$\n\n**2. Shape Functions and Derivatives**\nFor a bilinear quadrilateral element, the shape function for node $1$ (at $(\\xi, \\eta) = (-1,-1)$) is:\n$$ N_1(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta) $$\nThe derivatives with respect to the natural coordinates are:\n$$ \\frac{\\partial N_1}{\\partial \\xi} = -\\frac{1}{4}(1-\\eta), \\quad \\frac{\\partial N_1}{\\partial \\eta} = -\\frac{1}{4}(1-\\xi) $$\nDerivatives with respect to physical coordinates are found using the inverse Jacobian:\n$$ \\begin{Bmatrix} \\frac{\\partial N_1}{\\partial x} \\\\ \\frac{\\partial N_1}{\\partial y} \\end{Bmatrix} = \\mathbf{J}^{-1} \\begin{Bmatrix} \\frac{\\partial N_1}{\\partial \\xi} \\\\ \\frac{\\partial N_1}{\\partial \\eta} \\end{Bmatrix} = \\begin{pmatrix} \\frac{2}{a} & 0 \\\\ 0 & \\frac{2}{b} \\end{pmatrix} \\begin{Bmatrix} -\\frac{1}{4}(1-\\eta) \\\\ -\\frac{1}{4}(1-\\xi) \\end{Bmatrix} = \\begin{Bmatrix} -\\frac{1}{2a}(1-\\eta) \\\\ -\\frac{1}{2b}(1-\\xi) \\end{Bmatrix} $$\n\n**3. Strain-Displacement Vector $\\mathbf{b}_1$**\nThe strain vector is $\\boldsymbol{\\varepsilon} = \\{\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}\\}^T$. The column vector $\\mathbf{b}_1$ relates the strain components to the nodal displacement $u_1$:\n$$ \\mathbf{b}_1 = \\begin{Bmatrix} \\frac{\\partial N_1}{\\partial x} \\\\ 0 \\\\ \\frac{\\partial N_1}{\\partial y} \\end{Bmatrix} = \\begin{Bmatrix} -\\frac{1}{2a}(1-\\eta) \\\\ 0 \\\\ -\\frac{1}{2b}(1-\\xi) \\end{Bmatrix} $$\n\n**4. Constitutive Matrix $\\mathbf{C}$ for Plane Strain**\nFor a linear isotropic material under plane strain conditions, the stress-strain relationship $\\boldsymbol{\\sigma} = \\mathbf{C} \\boldsymbol{\\varepsilon}$ is defined by the matrix:\n$$ \\mathbf{C} = \\frac{E}{(1+\\nu)(1-2\\nu)} \\begin{pmatrix} 1-\\nu & \\nu & 0 \\\\ \\nu & 1-\\nu & 0 \\\\ 0 & 0 & \\frac{1-2\\nu}{2} \\end{pmatrix} $$\nThe components relevant to our calculation are $C_{11} = \\frac{E(1-\\nu)}{(1+\\nu)(1-2\\nu)}$ and the shear modulus term $C_{33} = \\frac{E(1-2\\nu)}{2(1+\\nu)(1-2\\nu)} = \\frac{E}{2(1+\\nu)}$.\n\n**5. Integrand Calculation**\nThe quadratic form in the integrand is $\\mathbf{b}_1^T \\mathbf{C} \\mathbf{b}_1$:\n$$ \\mathbf{b}_1^T \\mathbf{C} \\mathbf{b}_1 = C_{11} \\left(\\frac{\\partial N_1}{\\partial x}\\right)^2 + C_{33} \\left(\\frac{\\partial N_1}{\\partial y}\\right)^2 $$\nSubstituting the derivatives:\n$$ \\mathbf{b}_1^T \\mathbf{C} \\mathbf{b}_1 = C_{11} \\left(-\\frac{1}{2a}(1-\\eta)\\right)^2 + C_{33} \\left(-\\frac{1}{2b}(1-\\xi)\\right)^2 = \\frac{C_{11}}{4a^2}(1-\\eta)^2 + \\frac{C_{33}}{4b^2}(1-\\xi)^2 $$\n\n**6. Integration**\nWe now integrate this expression over the parent element domain $[-1,1] \\times [-1,1]$.\n$$ K_{11} = t \\det(\\mathbf{J}) \\int_{-1}^{1} \\int_{-1}^{1} \\left[ \\frac{C_{11}}{4a^2}(1-\\eta)^2 + \\frac{C_{33}}{4b^2}(1-\\xi)^2 \\right] d\\xi d\\eta $$\nThe two terms in the integral are separable. We evaluate the standard integral:\n$$ \\int_{-1}^{1} (1-z)^2 dz = \\int_{-1}^{1} (1-2z+z^2) dz = \\left[z - z^2 + \\frac{z^3}{3}\\right]_{-1}^{1} = \\left(1-1+\\frac{1}{3}\\right) - \\left(-1-1-\\frac{1}{3}\\right) = \\frac{1}{3} - \\left(-\\frac{7}{3}\\right) = \\frac{8}{3} $$\nThe integral becomes:\n$$ K_{11} = t \\left(\\frac{ab}{4}\\right) \\left[ \\frac{C_{11}}{4a^2} \\int_{-1}^{1}d\\xi \\int_{-1}^{1}(1-\\eta)^2 d\\eta + \\frac{C_{33}}{4b^2} \\int_{-1}^{1}(1-\\xi)^2 d\\xi \\int_{-1}^{1}d\\eta \\right] $$\n$$ K_{11} = t \\frac{ab}{4} \\left[ \\frac{C_{11}}{4a^2}(2)\\left(\\frac{8}{3}\\right) + \\frac{C_{33}}{4b^2}\\left(\\frac{8}{3}\\right)(2) \\right] = t \\frac{ab}{4} \\left[ \\frac{4C_{11}}{3a^2} + \\frac{4C_{33}}{3b^2} \\right] $$\n$$ K_{11} = \\frac{tab}{3} \\left( \\frac{C_{11}}{a^2} + \\frac{C_{33}}{b^2} \\right) = \\frac{t}{3} \\left( \\frac{b}{a}C_{11} + \\frac{a}{b}C_{33} \\right) $$\n\n**7. Final Nondimensional Expression**\nSubstitute the expressions for $C_{11}$ and $C_{33}$:\n$$ K_{11} = \\frac{t}{3} \\left( \\frac{b}{a} \\frac{E(1-\\nu)}{(1+\\nu)(1-2\\nu)} + \\frac{a}{b} \\frac{E}{2(1+\\nu)} \\right) $$\nThe problem requests the nondimensional stiffness $\\widehat{K}_{11} = \\frac{K_{11}}{Et}$:\n$$ \\widehat{K}_{11} = \\frac{1}{3E} \\left( \\frac{b}{a} \\frac{E(1-\\nu)}{(1+\\nu)(1-2\\nu)} + \\frac{a}{b} \\frac{E}{2(1+\\nu)} \\right) $$\n$$ \\widehat{K}_{11} = \\frac{1}{3} \\left( \\frac{b}{a} \\frac{1-\\nu}{(1+\\nu)(1-2\\nu)} + \\frac{a}{b} \\frac{1}{2(1+\\nu)} \\right) $$\nFactoring out the common terms to obtain a single pre-factor:\n$$ \\widehat{K}_{11} = \\frac{1}{6(1+\\nu)(1-2\\nu)} \\left( \\frac{2b}{a}(1-\\nu) + \\frac{a}{b}(1-2\\nu) \\right) $$\nThis is the final closed-form expression for the nondimensional stiffness coefficient.",
            "answer": "$$\\boxed{\\frac{1}{6(1+\\nu)(1-2\\nu)} \\left( \\frac{2b(1-\\nu)}{a} + \\frac{a(1-2\\nu)}{b} \\right)}$$"
        },
        {
            "introduction": "When modeling soft tissues, which are often nearly incompressible, standard finite elements can suffer from a numerical pathology known as volumetric locking, leading to overly stiff and inaccurate results. This practice introduces the B-bar method, an elegant and effective technique used to remedy this issue. By explicitly calculating the projected volumetric strain for a bilinear element, you will see how this method relaxes the spurious volumetric constraints imposed by the discretization, a crucial skill for performing reliable simulations of biological materials .",
            "id": "4185739",
            "problem": "Consider a two-dimensional small-strain formulation of linear elasticity for a soft tissue patch modeled with the Finite Element Method (FEM) using a single bilinear four-node quadrilateral element (often called a $Q4$ element) in plane strain. The physical element is the unit square with corner nodes at $(0,0)$, $(1,0)$, $(1,1)$, and $(0,1)$, labeled $1$ through $4$ in counterclockwise order. Let the nodal displacement components be $\\{u_{1x}, u_{1y}, u_{2x}, u_{2y}, u_{3x}, u_{3y}, u_{4x}, u_{4y}\\}$. The small-strain tensor is defined by the symmetric gradient of the displacement, and the volumetric strain is the trace of the small-strain tensor, which equals the divergence of the displacement field.\n\nNearly incompressible tissue behaviors (e.g., Poisson ratio near $0.5$) in standard equal-order displacement-based elements exhibit volumetric locking because the discretization overconstrains volumetric modes. A remedy is the modified strain-displacement formulation known as the $B$-bar method, which replaces the volumetric component of strain with an elementwise projection onto a lower-order subspace to relax the volumetric constraint while preserving the deviatoric response.\n\nStarting from the small-strain definition and the displacement interpolation with bilinear shape functions over the parent coordinates $(\\xi,\\eta)\\in[-1,1]\\times[-1,1]$ mapped affinely to the unit square, construct the $B$-bar method by defining the elementwise-constant projected volumetric strain as the area average of the divergence of the displacement. Show explicitly how this projection modifies the volumetric strain and justifies alleviation of locking via reducing the spurious volumetric stiffness contribution.\n\nThen, for the unit square element described above, compute the closed-form expression for the element-averaged volumetric strain $\\bar{\\epsilon}_{\\text{vol}}$ as a linear combination of the nodal displacement components $\\{u_{ix},u_{iy}\\}$, using exact integration over the element area and without resorting to numerical quadrature. Provide the final answer as a single analytic expression in terms of $\\{u_{ix},u_{iy}\\}$, with all coefficients in exact fractional form. No rounding is required. No physical units are required because strain is dimensionless.",
            "solution": "The fundamental basis is the definition of small strain in continuum mechanics and the standard displacement-based finite element interpolation. In the small-strain regime, the strain tensor $\\boldsymbol{\\epsilon}$ is given by\n$$\n\\boldsymbol{\\epsilon} = \\frac{1}{2}\\left(\\nabla \\mathbf{u} + (\\nabla \\mathbf{u})^{\\top}\\right),\n$$\nand its volumetric part, the volumetric strain, is the trace of $\\boldsymbol{\\epsilon}$:\n$$\n\\epsilon_{\\text{vol}} = \\operatorname{tr}(\\boldsymbol{\\epsilon}) = \\nabla \\cdot \\mathbf{u}.\n$$\nIn plane strain with displacement components $\\mathbf{u} = [u_x, u_y]^{\\top}$, one has\n$$\n\\epsilon_{\\text{vol}} = \\frac{\\partial u_x}{\\partial x} + \\frac{\\partial u_y}{\\partial y}.\n$$\n\nIn a standard bilinear four-node quadrilateral ($Q4$) element, the displacement field is interpolated as\n$$\n\\mathbf{u}(x,y) = \\sum_{i=1}^{4} N_i(x,y)\\,\\mathbf{d}_i,\n$$\nwhere $\\mathbf{d}_i = [u_{ix}, u_{iy}]^{\\top}$ are the nodal displacement vectors and $N_i$ are the bilinear shape functions defined on the parent space $(\\xi,\\eta)\\in[-1,1]\\times[-1,1]$ and mapped to the physical element. For the unit square, the mapping is affine:\n$$\nx = \\frac{1+\\xi}{2}, \\quad y = \\frac{1+\\eta}{2}, \\quad \\text{with} \\quad dA = \\frac{1}{4}\\,d\\xi\\,d\\eta, \\quad A = 1.\n$$\nThe standard $Q4$ shape functions on the parent space are\n$$\nN_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta), \\quad\nN_2(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta), \\quad\nN_3(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta), \\quad\nN_4(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta).\n$$\nThe divergence of the interpolated displacement is\n$$\n\\nabla \\cdot \\mathbf{u} = \\sum_{i=1}^{4} \\left( \\frac{\\partial N_i}{\\partial x} u_{ix} + \\frac{\\partial N_i}{\\partial y} u_{iy} \\right).\n$$\n\nVolumetric locking arises when the discretization effectively enforces unrealistically stiff volumetric constraints for nearly incompressible materials. The $B$-bar method modifies the volumetric strain by projecting it onto a lower-order subspace, typically constants over the element, to reduce the rank of the volumetric constraint and thereby relax the spurious stiffness while preserving consistency. The projected volumetric strain that is constant over the element is defined by the $L^{2}$-projection onto the space of constants:\n$$\n\\bar{\\epsilon}_{\\text{vol}} = \\frac{1}{A} \\int_{A} \\nabla \\cdot \\mathbf{u}\\, dA.\n$$\nThe deviatoric strain is left unchanged, so the modified strain used in the constitutive response can be written as\n$$\n\\boldsymbol{\\epsilon}_{\\text{B-bar}} = \\boldsymbol{\\epsilon}_{\\text{dev}} + \\frac{1}{2}\\bar{\\epsilon}_{\\text{vol}}\\begin{bmatrix} 1 \\\\ 1 \\\\ 0 \\end{bmatrix}\n= \\left( \\boldsymbol{\\epsilon} - \\frac{1}{2}\\epsilon_{\\text{vol}}\\begin{bmatrix} 1 \\\\ 1 \\\\ 0 \\end{bmatrix} \\right) + \\frac{1}{2}\\bar{\\epsilon}_{\\text{vol}}\\begin{bmatrix} 1 \\\\ 1 \\\\ 0 \\end{bmatrix},\n$$\nwhich at the operator level corresponds to replacing the volumetric part of the strain-displacement matrix with its projected operator while leaving the deviatoric operator unchanged. This reduces the spurious constraints on the volumetric deformation modes and alleviates locking by ensuring that the element’s volumetric response is represented by the lowest-order consistent mode (constant over the element), akin to a stabilized mixed formulation where the pressure field is constant per element.\n\nTo compute $\\bar{\\epsilon}_{\\text{vol}}$ explicitly for the unit square $Q4$ element, we use the affine mapping relationships. The derivatives transform as\n$$\n\\frac{\\partial N_i}{\\partial x} = \\frac{\\partial N_i}{\\partial \\xi}\\frac{\\partial \\xi}{\\partial x} + \\frac{\\partial N_i}{\\partial \\eta}\\frac{\\partial \\eta}{\\partial x} = 2\\,\\frac{\\partial N_i}{\\partial \\xi}, \\quad\n\\frac{\\partial N_i}{\\partial y} = 2\\,\\frac{\\partial N_i}{\\partial \\eta},\n$$\nbecause $x$ depends only on $\\xi$, $y$ depends only on $\\eta$, and $\\frac{\\partial \\xi}{\\partial x} = \\frac{\\partial \\eta}{\\partial y} = 2$ for the unit-square mapping.\n\nThe area average is\n$$\n\\bar{\\epsilon}_{\\text{vol}} = \\frac{1}{A}\\int_{A} \\sum_{i=1}^{4}\\left( \\frac{\\partial N_i}{\\partial x} u_{ix} + \\frac{\\partial N_i}{\\partial y} u_{iy} \\right) dA\n= \\sum_{i=1}^{4}\\left( \\frac{1}{A}\\int_{A} \\frac{\\partial N_i}{\\partial x} dA \\right) u_{ix}\n+ \\sum_{i=1}^{4}\\left( \\frac{1}{A}\\int_{A} \\frac{\\partial N_i}{\\partial y} dA \\right) u_{iy}.\n$$\nSince $A=1$, we compute the integrals\n$$\nI_i^{x} = \\int_{A} \\frac{\\partial N_i}{\\partial x}\\, dA = \\int_{-1}^{1}\\int_{-1}^{1} \\left(2\\,\\frac{\\partial N_i}{\\partial \\xi}\\right)\\left(\\frac{1}{4}\\right)\\, d\\xi\\, d\\eta\n= \\frac{1}{2}\\int_{-1}^{1}\\int_{-1}^{1} \\frac{\\partial N_i}{\\partial \\xi}\\, d\\xi\\, d\\eta,\n$$\n$$\nI_i^{y} = \\int_{A} \\frac{\\partial N_i}{\\partial y}\\, dA = \\frac{1}{2}\\int_{-1}^{1}\\int_{-1}^{1} \\frac{\\partial N_i}{\\partial \\eta}\\, d\\xi\\, d\\eta.\n$$\nUsing the fundamental theorem of calculus in the parent coordinates,\n$$\n\\int_{-1}^{1} \\frac{\\partial N_i}{\\partial \\xi}\\, d\\xi = N_i(\\xi=1,\\eta) - N_i(\\xi=-1,\\eta), \\quad\n\\int_{-1}^{1} \\frac{\\partial N_i}{\\partial \\eta}\\, d\\eta = N_i(\\xi,\\eta=1) - N_i(\\xi,\\eta=-1).\n$$\nEvaluating these for each node:\n- For node $1$, $N_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$:\n$$\nN_1(1,\\eta) = 0, \\quad N_1(-1,\\eta) = \\frac{1}{2}(1-\\eta) \\;\\Rightarrow\\; \\int_{-1}^{1} \\frac{\\partial N_1}{\\partial \\xi} d\\xi = -\\frac{1}{2}(1-\\eta).\n$$\nThus\n$$\nI_1^{x} = \\frac{1}{2} \\int_{-1}^{1} \\left[ -\\frac{1}{2}(1-\\eta) \\right] d\\eta = -\\frac{1}{2}.\n$$\nSimilarly,\n$$\nN_1(\\xi,1) = 0, \\quad N_1(\\xi,-1) = \\frac{1}{2}(1-\\xi) \\;\\Rightarrow\\; \\int_{-1}^{1} \\frac{\\partial N_1}{\\partial \\eta} d\\eta = -\\frac{1}{2}(1-\\xi),\n$$\nand\n$$\nI_1^{y} = \\frac{1}{2} \\int_{-1}^{1} \\left[ -\\frac{1}{2}(1-\\xi) \\right] d\\xi = -\\frac{1}{2}.\n$$\n- For node $2$, $N_2(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)$:\n$$\nN_2(1,\\eta) = \\frac{1}{2}(1-\\eta), \\quad N_2(-1,\\eta) = 0 \\;\\Rightarrow\\; I_2^{x} = +\\frac{1}{2},\n$$\n$$\nN_2(\\xi,1) = 0, \\quad N_2(\\xi,-1) = \\frac{1}{2}(1+\\xi) \\;\\Rightarrow\\; I_2^{y} = -\\frac{1}{2}.\n$$\n- For node $3$, $N_3(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta)$:\n$$\nN_3(1,\\eta) = \\frac{1}{2}(1+\\eta), \\quad N_3(-1,\\eta) = 0 \\;\\Rightarrow\\; I_3^{x} = +\\frac{1}{2},\n$$\n$$\nN_3(\\xi,1) = \\frac{1}{2}(1+\\xi), \\quad N_3(\\xi,-1) = 0 \\;\\Rightarrow\\; I_3^{y} = +\\frac{1}{2}.\n$$\n- For node $4$, $N_4(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)$:\n$$\nN_4(1,\\eta) = 0, \\quad N_4(-1,\\eta) = \\frac{1}{2}(1+\\eta) \\;\\Rightarrow\\; I_4^{x} = -\\frac{1}{2},\n$$\n$$\nN_4(\\xi,1) = \\frac{1}{2}(1-\\xi), \\quad N_4(\\xi,-1) = 0 \\;\\Rightarrow\\; I_4^{y} = +\\frac{1}{2}.\n$$\n\nTherefore, the element-averaged volumetric strain is\n$$\n\\bar{\\epsilon}_{\\text{vol}} = I_1^{x} u_{1x} + I_2^{x} u_{2x} + I_3^{x} u_{3x} + I_4^{x} u_{4x}\n+ I_1^{y} u_{1y} + I_2^{y} u_{2y} + I_3^{y} u_{3y} + I_4^{y} u_{4y},\n$$\nwhich simplifies to\n$$\n\\bar{\\epsilon}_{\\text{vol}} = -\\frac{1}{2}u_{1x} + \\frac{1}{2}u_{2x} + \\frac{1}{2}u_{3x} - \\frac{1}{2}u_{4x}\n-\\frac{1}{2}u_{1y} - \\frac{1}{2}u_{2y} + \\frac{1}{2}u_{3y} + \\frac{1}{2}u_{4y}.\n$$\n\nThis expression is the constant-in-element projection of the volumetric strain implied by the bilinear displacement field. In the $B$-bar method, this $\\bar{\\epsilon}_{\\text{vol}}$ replaces the pointwise volumetric strain in the constitutive evaluation while the deviatoric part retains its standard $B$-matrix contribution. Because $\\bar{\\epsilon}_{\\text{vol}}$ is the $L^{2}$ projection onto constants, it reduces the rank of the volumetric constraint, preventing the element from artificially suppressing admissible volumetric modes, which removes the spurious stiffness characteristic of volumetric locking for nearly incompressible tissues.\n\nThe final analytic expression for $\\bar{\\epsilon}_{\\text{vol}}$ is as derived above.",
            "answer": "$$\\boxed{-\\frac{1}{2}u_{1x}+\\frac{1}{2}u_{2x}+\\frac{1}{2}u_{3x}-\\frac{1}{2}u_{4x}-\\frac{1}{2}u_{1y}-\\frac{1}{2}u_{2y}+\\frac{1}{2}u_{3y}+\\frac{1}{2}u_{4y}}$$"
        },
        {
            "introduction": "The mechanical behavior of soft tissues is fundamentally nonlinear, requiring iterative numerical solvers like the Newton-Raphson method to find equilibrium. The convergence speed of this method is critically dependent on the accuracy of the tangent stiffness matrix. This computational practice provides a direct, hands-on demonstration of why deriving the \"consistent tangent\" is not just a theoretical formality but a practical necessity, allowing you to compare the quadratic convergence of a proper Newton's method against the much slower performance when using a numerically approximated tangent .",
            "id": "4185707",
            "problem": "Consider a one-dimensional finite element (FE) model of a tissue strip represented by a single two-node axial element of reference length $L$ and cross-sectional area $A$. The left node is fixed, so the single unknown is the axial displacement at the right node $u$ (in meters). The material is modeled as a hyperelastic tissue with a strain energy density per unit volume $W(\\varepsilon)$ depending on the engineering strain $\\varepsilon = u/L$. The internal stress $\\sigma(\\varepsilon)$ is defined by $\\sigma(\\varepsilon) = \\dfrac{dW}{d\\varepsilon}$, and the nodal internal force at the right node is $F_{\\text{int}}(u) = A \\,\\sigma(\\varepsilon)$ (in Newtons). The external force applied at the right node is a prescribed scalar $F$ (in Newtons), so the scalar residual is $R(u) = F_{\\text{int}}(u) - F$.\n\nYou must implement Newton’s method to solve the scalar equilibrium equation $R(u) = 0$ starting from the initial guess $u_0 = 0$ with a stopping criterion $|R(u_k)| \\le \\text{tol}$, where $\\text{tol}$ is a given tolerance in Newtons. To study the necessity of consistent linearization, you must run Newton’s method with two types of tangent (Jacobian) approximations:\n- A consistent tangent $K_{\\text{cons}}(u) = \\dfrac{dR}{du}$ computed analytically.\n- A numerical differentiation tangent $K_{\\text{fd}}(u) \\approx \\dfrac{R(u+h) - R(u-h)}{2h}$ computed using central finite differences with specified step sizes $h$ (in meters).\n\nStart from fundamental definitions and equilibrium:\n- The engineering strain is $\\varepsilon(u) = u/L$.\n- The internal stress is $\\sigma(\\varepsilon) = \\dfrac{dW}{d\\varepsilon}$.\n- The nodal internal force is $F_{\\text{int}}(u) = A \\,\\sigma(\\varepsilon(u))$.\n- The residual is $R(u) = A \\,\\sigma(\\varepsilon(u)) - F$.\n- The consistent tangent is $K_{\\text{cons}}(u) = \\dfrac{dR}{du} = \\dfrac{A}{L}\\,\\sigma'(\\varepsilon(u))$, where $\\sigma'(\\varepsilon) = \\dfrac{d\\sigma}{d\\varepsilon}$.\n\nUse the tissue strain energy density\n$$\nW(\\varepsilon) = \\tfrac{1}{2} E \\varepsilon^2 + c\\left(e^{b \\varepsilon^2} - 1\\right),\n$$\nwhere $E$ (in Pascals) is a linear elastic modulus, $c$ (in Pascals) is a nonlinear stiffness scale, and $b$ (dimensionless) controls nonlinearity. Then\n$$\n\\sigma(\\varepsilon) = E \\varepsilon + 2 c b \\varepsilon e^{b \\varepsilon^2},\n\\quad\n\\sigma'(\\varepsilon) = E + 2 c b e^{b \\varepsilon^2} + 4 c b^2 \\varepsilon^2 e^{b \\varepsilon^2}.\n$$\n\nImplement Newton’s method update $u_{k+1} = u_k - \\dfrac{R(u_k)}{K(u_k)}$ with either $K_{\\text{cons}}$ or $K_{\\text{fd}}$ as prescribed. Record the absolute residual sequence $\\{|R(u_k)|\\}_{k=0}^{N}$ during iterations. Estimate the observed local order of convergence $p$ using the last three residuals $r_{k-2}$, $r_{k-1}$, $r_k$ by\n$$\np \\approx \\frac{\\ln\\left(\\dfrac{r_k}{r_{k-1}}\\right)}{\\ln\\left(\\dfrac{r_{k-1}}{r_{k-2}}\\right)},\n$$\nwhenever at least three residuals are available and strictly positive. If fewer than three residuals are available, set $p = 2.0$.\n\nTest Suite:\nUse the following three test cases (all quantities in SI units: meters, Newtons, Pascals):\n- Case 1 (linear, small load): $L = 0.1$, $A = 1.0\\times 10^{-4}$, $E = 1.0\\times 10^{4}$, $c = 0.0$, $b = 5.0$, $F = 0.01$.\n- Case 2 (moderately nonlinear): $L = 0.1$, $A = 1.0\\times 10^{-4}$, $E = 5.0\\times 10^{3}$, $c = 1.0\\times 10^{3}$, $b = 5.0$, $F = 0.2$.\n- Case 3 (strongly nonlinear): $L = 0.1$, $A = 1.0\\times 10^{-4}$, $E = 5.0\\times 10^{3}$, $c = 5.0\\times 10^{3}$, $b = 10.0$, $F = 1.0$.\n\nFinite difference step sizes for numerical differentiation:\n- $h_1 = 1.0\\times 10^{-9}$, $h_2 = 1.0\\times 10^{-6}$, $h_3 = 1.0\\times 10^{-3}$.\n\nSolver settings:\n- Initial guess $u_0 = 0.0$.\n- Tolerance $\\text{tol} = 1.0\\times 10^{-12}$ (in Newtons).\n- Maximum iterations $N_{\\text{max}} = 50$.\n\nFor each test case, run Newton’s method four times: once with the consistent tangent, and once with each of the three finite-difference tangents using $h_1$, $h_2$, and $h_3$. For each run, report:\n- The integer number of iterations $N$ taken to first satisfy $|R(u_k)| \\le \\text{tol}$ (or $N_{\\text{max}}$ if not satisfied within the maximum).\n- The floating-point estimated order $p$ computed from the residual history as defined above.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The entries must be ordered by test case, and within each test case by tangent choice, as:\n$[\\;N_{\\text{cons}}, N_{h_1}, N_{h_2}, N_{h_3}, p_{\\text{cons}}, p_{h_1}, p_{h_2}, p_{h_3}\\;]$\nfor Case 1, followed immediately by the same eight numbers for Case 2, and then Case 3. That is, a flat list of $24$ numbers representing iteration counts and observed orders. All iteration counts are integers and all orders are floats. Angles are not present, and displacements and forces are not printed; only the specified integers and floats are output.",
            "solution": "The problem is subjected to validation prior to presenting a solution.\n\n### Step 1: Extract Givens\n- **Model Geometry**: One-dimensional, two-node axial element with reference length $L$ and cross-sectional area $A$.\n- **Boundary Conditions**: Left node is fixed. An external axial force $F$ is applied to the right node.\n- **Unknown**: Axial displacement of the right node, $u$.\n- **Kinematics**: Engineering strain $\\varepsilon = u/L$.\n- **Material Model**: Hyperelastic tissue with strain energy density per unit volume $W(\\varepsilon) = \\tfrac{1}{2} E \\varepsilon^2 + c\\left(e^{b \\varepsilon^2} - 1\\right)$, where $E$ is a linear elastic modulus, $c$ is a nonlinear stiffness scale, and $b$ is a dimensionless nonlinearity parameter.\n- **Constitutive Relations**:\n    - Internal stress: $\\sigma(\\varepsilon) = \\dfrac{dW}{d\\varepsilon} = E \\varepsilon + 2 c b \\varepsilon e^{b \\varepsilon^2}$.\n    - Tangent modulus: $\\sigma'(\\varepsilon) = \\dfrac{d\\sigma}{d\\varepsilon} = E + 2 c b e^{b \\varepsilon^2} + 4 c b^2 \\varepsilon^2 e^{b \\varepsilon^2}$.\n- **Finite Element Formulation**:\n    - Nodal internal force: $F_{\\text{int}}(u) = A \\,\\sigma(\\varepsilon(u))$.\n    - Residual (equilibrium equation): $R(u) = F_{\\text{int}}(u) - F = 0$.\n- **Numerical Method**: Newton's method for solving the scalar equation $R(u) = 0$.\n    - Iterative update: $u_{k+1} = u_k - \\dfrac{R(u_k)}{K(u_k)}$.\n    - Initial guess: $u_0 = 0$.\n    - Stopping criterion: $|R(u_k)| \\le \\text{tol}$, with $\\text{tol} = 1.0 \\times 10^{-12}$ N.\n    - Maximum iterations: $N_{\\text{max}} = 50$.\n- **Tangent (Jacobian) Formulations**:\n    - Consistent tangent: $K_{\\text{cons}}(u) = \\dfrac{dR}{du} = \\dfrac{A}{L}\\,\\sigma'(\\varepsilon(u))$.\n    - Numerical differentiation tangent: $K_{\\text{fd}}(u) \\approx \\dfrac{R(u+h) - R(u-h)}{2h}$, using central finite differences with step sizes $h_1 = 1.0\\times 10^{-9}$ m, $h_2 = 1.0\\times 10^{-6}$ m, and $h_3 = 1.0\\times 10^{-3}$ m.\n- **Performance Evaluation**:\n    - Number of iterations $N$.\n    - Estimated order of convergence $p \\approx \\frac{\\ln(r_k/r_{k-1})}{\\ln(r_{k-1}/r_{k-2})}$ using the last three absolute residuals, where $r_k = |R(u_k)|$. If fewer than three residuals are available, $p=2.0$.\n- **Test Cases (SI units)**:\n    - Case 1: $L=0.1, A=10^{-4}, E=10^4, c=0.0, b=5.0, F=0.01$.\n    - Case 2: $L=0.1, A=10^{-4}, E=5\\times 10^3, c=10^3, b=5.0, F=0.2$.\n    - Case 3: $L=0.1, A=10^{-4}, E=5\\times 10^3, c=5\\times 10^3, b=10.0, F=1.0$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the validation criteria.\n- **Scientifically Grounded**: The problem is based on standard principles of continuum mechanics and nonlinear finite element analysis. The hyperelastic constitutive model is a simplified but valid representation for biological tissues. All mathematical derivations are correct.\n- **Well-Posed**: The problem is a well-defined scalar root-finding problem. All necessary parameters, initial conditions, and solution procedures are explicitly provided. The material properties are such that stiffness is positive, suggesting a unique solution exists for the given loads.\n- **Objective**: The problem is stated using precise mathematical language and numerical values, free from any subjectivity or ambiguity.\n- **Flaw Checklist**: The problem does not violate any of the listed invalidity criteria. It is a scientifically sound, complete, and formalizable problem directly relevant to computational biomechanics.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Principle-Based Solution and Algorithmic Design\n\nThe core of the problem is to solve the nonlinear scalar equilibrium equation $R(u)=0$ for the unknown displacement $u$. The equation represents the balance between the internal force developed in the tissue and the externally applied force.\n\nThe internal force is derived from a hyperelastic constitutive model, where the stress is the derivative of a strain energy density function $W$ with respect to strain $\\varepsilon$. The given form $W(\\varepsilon) = \\tfrac{1}{2} E \\varepsilon^2 + c\\left(e^{b \\varepsilon^2} - 1\\right)$ is a common representation for materials that exhibit a stiffening response at higher strains, characteristic of many soft biological tissues. The term $\\tfrac{1}{2} E \\varepsilon^2$ represents linear elasticity, while the exponential term introduces nonlinearity controlled by parameters $c$ and $b$.\n\nThe governing equation is $R(u) = A\\,\\sigma(u/L) - F = 0$. Since this equation is nonlinear in $u$ (for $c \\neq 0$), an iterative numerical method is required. Newton's method (also known as the Newton-Raphson method) is a powerful technique for this purpose, which is based on successively solving a linearized version of the problem.\n\nStarting from an initial guess $u_k$, the function $R(u)$ is approximated by its first-order Taylor expansion around $u_k$:\n$$R(u) \\approx R(u_k) + \\left.\\frac{dR}{du}\\right|_{u_k} (u - u_k)$$\nWe seek $u = u_{k+1}$ such that $R(u_{k+1})=0$. Setting the approximation to zero yields:\n$$0 = R(u_k) + K(u_k) (u_{k+1} - u_k)$$\nwhere $K(u_k) = \\left.\\frac{dR}{du}\\right|_{u_k}$ is the tangent stiffness (or Jacobian in a multi-dimensional context). Solving for the next iterate $u_{k+1}$ gives the Newton update rule:\n$$u_{k+1} = u_k - \\frac{R(u_k)}{K(u_k)}$$\nThe process begins with $u_0 = 0$ and is repeated until the magnitude of the residual, $|R(u_k)|$, falls below a specified tolerance $\\text{tol}$.\n\nA critical aspect of Newton's method is the calculation of the tangent stiffness $K(u)$.\nThe **consistent tangent** is the exact analytical derivative of the residual with respect to the unknown:\n$$K_{\\text{cons}}(u) = \\frac{dR}{du} = \\frac{d}{du} \\left[ A\\,\\sigma(\\varepsilon(u)) - F \\right]$$\nUsing the chain rule, and noting that $\\varepsilon(u) = u/L$, so $d\\varepsilon/du = 1/L$:\n$$K_{\\text{cons}}(u) = A \\frac{d\\sigma}{d\\varepsilon} \\frac{d\\varepsilon}{du} = \\frac{A}{L} \\sigma'(\\varepsilon(u))$$\nwhere $\\sigma'(\\varepsilon)$ is the tangent modulus given in the problem statement. When the exact tangent is used, Newton's method exhibits quadratic convergence ($p=2$) in the vicinity of the solution, meaning the number of correct digits in the solution roughly doubles with each iteration.\n\nThe problem also requires using a **numerical tangent**, obtained by finite differences, to approximate the derivative:\n$$K_{\\text{fd}}(u) \\approx \\frac{R(u+h) - R(u-h)}{2h}$$\nThis is a second-order central difference approximation. Using an approximate tangent transforms Newton's method into a quasi-Newton method. Because $K_{\\text{fd}}(u)$ is not the exact derivative, the quadratic convergence property is lost. The convergence rate degrades to linear ($p=1$). The accuracy of the approximation depends on the step size $h$.\n- If $h$ is very small (e.g., $h_1 = 10^{-9}$), the numerical tangent is very close to the consistent tangent. The convergence may appear nearly quadratic, but it is ultimately limited by floating-point precision, which can introduce round-off errors that pollute the derivative calculation.\n- If $h$ is large (e.g., $h_3 = 10^{-3}$), the truncation error of the finite difference formula becomes significant, making $K_{\\text{fd}}$ a poor approximation of $K_{\\text{cons}}$. This leads to a slower linear convergence rate, requiring more iterations to reach the solution.\n- An intermediate $h$ (e.g., $h_2 = 10^{-6}$) often provides a good balance between truncation and round-off errors.\n\nThe algorithm to be implemented will, for each of the three test cases:\n1.  Initialize the solver with $u_0 = 0.0$, $\\text{tol} = 10^{-12}$, and $N_{\\text{max}} = 50$.\n2.  Run the Newton's method solver four times, once for each tangent choice: $K_{\\text{cons}}$, and $K_{\\text{fd}}$ with $h_1, h_2, h_3$.\n3.  In each run, iterate the Newton update, storing the absolute residual $|R(u_k)|$ at each step $k=0, 1, 2, ...$.\n4.  Terminate when $|R(u_k)| \\le \\text{tol}$ or when $k=N_{\\text{max}}$. Record the number of iterations $N=k$.\n5.  After termination, use the stored residual history to calculate the observed order of convergence $p$ using the formula provided, applying the specified rules for cases with fewer than three residuals.\n6.  Collect the resulting values of $N$ and $p$ for all runs and format them into a single list as required.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the nonlinear FE problem using Newton's method with different tangent stiffness\n    approximations and reports the number of iterations and convergence order.\n    \"\"\"\n    test_cases = [\n        # Case 1 (linear, small load)\n        {'L': 0.1, 'A': 1.0e-4, 'E': 1.0e4, 'c': 0.0, 'b': 5.0, 'F': 0.01},\n        # Case 2 (moderately nonlinear)\n        {'L': 0.1, 'A': 1.0e-4, 'E': 5.0e3, 'c': 1.0e3, 'b': 5.0, 'F': 0.2},\n        # Case 3 (strongly nonlinear)\n        {'L': 0.1, 'A': 1.0e-4, 'E': 5.0e3, 'c': 5.0e3, 'b': 10.0, 'F': 1.0},\n    ]\n\n    h_steps = [1.0e-9, 1.0e-6, 1.0e-3]\n    tol = 1.0e-12\n    N_max = 50\n\n    all_results = []\n\n    def R(u, L, A, E, c, b, F):\n        \"\"\"Calculates the residual R(u) = F_int(u) - F.\"\"\"\n        if L == 0: return np.inf\n        eps = u / L\n        sigma = E * eps + 2 * c * b * eps * np.exp(b * eps**2)\n        F_int = A * sigma\n        return F_int - F\n\n    def K_cons(u, L, A, E, c, b):\n        \"\"\"Calculates the consistent tangent stiffness K_cons(u).\"\"\"\n        if L == 0: return np.inf\n        eps = u / L\n        sigma_prime = E + 2 * c * b * np.exp(b * eps**2) + 4 * c * b**2 * eps**2 * np.exp(b * eps**2)\n        return (A / L) * sigma_prime\n\n    def K_fd(u, h, L, A, E, c, b, F):\n        \"\"\"Calculates the finite difference tangent stiffness K_fd(u).\"\"\"\n        if h == 0: return np.inf\n        R_plus_h = R(u + h, L, A, E, c, b, F)\n        R_minus_h = R(u - h, L, A, E, c, b, F)\n        return (R_plus_h - R_minus_h) / (2 * h)\n\n    def run_newton(params, tangent_type, h=None):\n        \"\"\"Runs the Newton solver for a given configuration.\"\"\"\n        L, A, E, c, b, F = params.values()\n        \n        u = 0.0\n        residuals = []\n        N = N_max\n\n        for k in range(N_max + 1):\n            res = R(u, L, A, E, c, b, F)\n            residuals.append(abs(res))\n\n            if abs(res) = tol:\n                N = k\n                break\n            \n            if k == N_max:\n                break\n\n            if tangent_type == 'cons':\n                K = K_cons(u, L, A, E, c, b)\n            else:  # 'fd'\n                K = K_fd(u, h, L, A, E, c, b, F)\n            \n            if abs(K)  1e-20: # Avoid division by a near-zero stiffness\n                break # Non-convergence\n            \n            u = u - res / K\n        \n        # Calculate convergence order p\n        if len(residuals)  3:\n            p = 2.0\n        else:\n            r_k = residuals[-1]\n            r_km1 = residuals[-2]\n            r_km2 = residuals[-3]\n            \n            # Check conditions from the problem statement\n            if r_k > 0 and r_km1 > 0 and r_km2 > 0:\n                try:\n                    denominator = np.log(r_km1 / r_km2)\n                    if abs(denominator)  1e-15: # Stalled or linear convergence\n                        p = 1.0\n                    else:\n                        numerator = np.log(r_k / r_km1)\n                        p = numerator / denominator\n                except (ValueError, ZeroDivisionError):\n                    # This case should be rare given the checks\n                    p = 1.0 \n            else:\n                # If residuals are not strictly positive (e.g., one is zero)\n                # the formula is not applicable. Default to linear.\n                p = 1.0\n        \n        return N, p\n\n    for case_params in test_cases:\n        Ns = []\n        ps = []\n\n        # Run with consistent tangent\n        N_cons, p_cons = run_newton(case_params, 'cons')\n        Ns.append(N_cons)\n        ps.append(p_cons)\n\n        # Run with finite difference tangents\n        for h in h_steps:\n            N_fd, p_fd = run_newton(case_params, 'fd', h=h)\n            Ns.append(N_fd)\n            ps.append(p_fd)\n        \n        all_results.extend(Ns)\n        all_results.extend(ps)\n\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}