{
    "hands_on_practices": [
        {
            "introduction": "Inverse dynamics begins with a firm grasp of fundamental mechanics. This first practice grounds you in the core definition of a moment by asking you to derive the torque generated by gravity on a single limb segment. By working from first principles, this exercise  hones your ability to translate a physical scenario into a vector-based mathematical model and highlights the critical importance of defining clear coordinate systems and sign conventions, a foundational skill for all subsequent analyses.",
            "id": "4181307",
            "problem": "Consider a quasi-static sagittal-plane analysis of the shank (lower leg) segment during a standing posture. Treat the shank as a rigid body of mass $m$ whose center of mass lies at a fixed distance $d$ from the knee joint center along the shank. Adopt a right-handed Cartesian coordinate system with the anterior direction as $+x$, the superior direction as $+y$, and the knee flexion-extension axis as $+z$ pointing out of the sagittal plane. Let the position vector from the knee joint center to the shank center of mass be oriented at an angle $\\theta$ posterior from the vertical, so that $\\theta>0$ denotes a posterior tilt of the shank center line relative to the $+y$ axis. Gravity acts as a uniform field producing a force of magnitude $m g$ in the $-y$ direction. Define the positive external net joint moment at the knee as a moment that tends to increase knee flexion, i.e., a counterclockwise rotation in the $x$–$y$ plane corresponding to the $+z$ direction.\n\nStarting only from Newton’s laws and the definition of the moment of a force about a point, derive an analytic expression for the gravitational moment about the knee due to the shank’s weight as a function of $\\theta$. Then, for the specific posture with $m=3.9~\\text{kg}$, $d=0.21~\\text{m}$, $\\theta=20^{\\circ}$, and $g=9.81~\\text{m}\\,\\text{s}^{-2}$, evaluate the gravitational knee moment. Round your final numerical result to four significant figures. Express the final moment in $\\text{N}\\cdot\\text{m}$ and take the angle in degrees. In addition to the derivation and calculation, explain how the chosen sign convention determines whether the gravitational moment is flexion or extension and how the expression’s sign would change under alternative common conventions, but ensure the final numerical answer is computed under the conventions stated above.",
            "solution": "The problem requires the derivation of an expression for the gravitational moment at the knee joint and its subsequent numerical evaluation. The validation process confirms the problem is scientifically grounded, well-posed, and contains all necessary information.\n\nThe moment of a force, or torque, $\\mathbf{M}$, generated by a force $\\mathbf{F}$ applied at a position $\\mathbf{r}$ relative to a point of rotation is defined by the cross product:\n$$\n\\mathbf{M} = \\mathbf{r} \\times \\mathbf{F}\n$$\nIn this problem, the point of rotation is the knee joint center, which we take as the origin of our coordinate system, $O=(0,0,0)$. The force is the gravitational force acting on the shank's center of mass (CoM).\n\nFirst, we define the position vector $\\mathbf{r}$ from the knee joint center to the shank's CoM. The shank's CoM is at a distance $d$ from the knee. The orientation is given by an angle $\\theta$ posterior from the vertical. The coordinate system is defined with the $+y$ axis representing the superior (vertical) direction and the $+x$ axis representing the anterior direction. Consequently, the posterior direction corresponds to the $-x$ axis. An angle $\\theta$ posterior from the vertical means the position vector originates from the $+y$ axis and is rotated by an angle $\\theta$ towards the $-x$ axis.\n\nThe components of the position vector $\\mathbf{r}$ are therefore:\n$$\nr_x = -d \\sin(\\theta)\n$$\n$$\nr_y = d \\cos(\\theta)\n$$\nThe problem is in the sagittal plane ($x$-$y$ plane), so the $z$-component is zero. In the defined right-handed Cartesian coordinate system ($\\hat{\\imath}$ for $+x$, $\\hat{\\jmath}$ for $+y$, $\\hat{k}$ for $+z$), the position vector is:\n$$\n\\mathbf{r} = -d \\sin(\\theta) \\hat{\\imath} + d \\cos(\\theta) \\hat{\\jmath}\n$$\n\nNext, we define the gravitational force vector $\\mathbf{F}_g$. The force has a magnitude of $m g$ and acts in the negative vertical direction ($-y$ direction). Thus, the force vector is:\n$$\n\\mathbf{F}_g = -mg \\hat{\\jmath}\n$$\n\nNow, we can compute the gravitational moment about the knee, $\\mathbf{M}_g$, by taking the cross product of $\\mathbf{r}$ and $\\mathbf{F}_g$:\n$$\n\\mathbf{M}_g = \\mathbf{r} \\times \\mathbf{F}_g = \\left( -d \\sin(\\theta) \\hat{\\imath} + d \\cos(\\theta) \\hat{\\jmath} \\right) \\times \\left( -mg \\hat{\\jmath} \\right)\n$$\nUsing the distributive property of the cross product:\n$$\n\\mathbf{M}_g = \\left( -d \\sin(\\theta) \\hat{\\imath} \\times -mg \\hat{\\jmath} \\right) + \\left( d \\cos(\\theta) \\hat{\\jmath} \\times -mg \\hat{\\jmath} \\right)\n$$\nWe use the properties of the cross product for unit vectors: $\\hat{\\imath} \\times \\hat{\\jmath} = \\hat{k}$ and $\\hat{\\jmath} \\times \\hat{\\jmath} = \\mathbf{0}$.\nThe second term becomes zero. The first term simplifies to:\n$$\n\\mathbf{M}_g = (-d \\sin(\\theta))(-mg)(\\hat{\\imath} \\times \\hat{\\jmath}) = mgd \\sin(\\theta) \\hat{k}\n$$\nThis vector represents the moment generated by gravity. The problem defines that a positive external net joint moment tends to increase knee flexion and corresponds to a counterclockwise rotation in the $x$-$y$ plane, which is a moment in the $+z$ direction (represented by $\\hat{k}$). Therefore, the scalar expression for the gravitational moment, consistent with the given convention, is the $z$-component of $\\mathbf{M}_g$.\n\nThe derived analytic expression for the gravitational moment about the knee is:\n$$\nM_g(\\theta) = mgd \\sin(\\theta)\n$$\n\nWe are now asked to evaluate this moment for the specific case where $m=3.9~\\text{kg}$, $d=0.21~\\text{m}$, $\\theta=20^{\\circ}$, and $g=9.81~\\text{m}\\,\\text{s}^{-2}$.\nSubstituting these values into the expression:\n$$\nM_g = (3.9~\\text{kg}) \\times (9.81~\\text{m}\\,\\text{s}^{-2}) \\times (0.21~\\text{m}) \\times \\sin(20^{\\circ})\n$$\nFirst, we calculate the product of the magnitudes:\n$$\n(3.9) \\times (9.81) \\times (0.21) \\approx 8.03439~\\text{N}\\cdot\\text{m}\n$$\nNext, we evaluate the sine of the angle:\n$$\n\\sin(20^{\\circ}) \\approx 0.34202014\n$$\nMultiplying these results gives the moment:\n$$\nM_g \\approx 8.03439 \\times 0.34202014 \\approx 2.74801~\\text{N}\\cdot\\text{m}\n$$\nRounding the result to four significant figures, we get:\n$$\nM_g = 2.748~\\text{N}\\cdot\\text{m}\n$$\n\nFinally, we address the role of the sign convention.\nIn the problem's convention, a positive moment is a flexion moment (counter-clockwise, $+z$). Our calculated moment $M_g = mgd \\sin(\\theta)$ is positive for $\\theta \\in (0, 180^{\\circ})$, which covers all physically relevant shank positions in this context. Therefore, for the given posterior tilt ($\\theta=20^{\\circ}$), gravity produces a flexion moment. This is intuitive, as the weight of the posteriorly-tilted shank pulls it downward, tending to bend (flex) the knee. In a quasi-static condition, this gravitational flexion moment must be counteracted by an internal extension moment (generated by muscles like the quadriceps and ligaments) to maintain the pose.\n\nIf an alternative common convention were used where an extension moment (clockwise, $-z$) is defined as positive, our physical derivation of the moment vector $\\mathbf{M}_g = mgd \\sin(\\theta) \\hat{k}$ remains unchanged. However, its representation as a scalar value under this new convention would be $M_{g, \\text{ext-pos}} = -mgd \\sin(\\theta)$. The expression's sign would be inverted.\n\nIf the angle were defined differently, for example, as an anterior tilt from the vertical, the position vector would be $\\mathbf{r} = +d \\sin(\\theta) \\hat{\\imath} + d \\cos(\\theta) \\hat{\\jmath}$. This would lead to a moment $\\mathbf{M}_g = -mgd \\sin(\\theta) \\hat{k}$, which is an extension moment. This is also intuitive, as a forward-tilted shank's weight would tend to straighten (extend) the knee. The choice of coordinate system and definitions for angles and positive rotation direction are crucial for the final expression and its interpretation.\n\nThe final numerical calculation is based strictly on the conventions provided in the problem statement.",
            "answer": "$$\n\\boxed{2.748}\n$$"
        },
        {
            "introduction": "Moving from a single force component to a complete dynamic picture, this exercise challenges you to formulate the full three-dimensional inverse dynamics equations for a single rigid body. This practice  is central to biomechanics, as it requires you to synthesize all external loads and inertial effects—including often-overlooked gyroscopic terms—into a single governing equation. Mastering this symbolic derivation provides you with the complete theoretical tool for analyzing any single segment in 3D space.",
            "id": "4181289",
            "problem": "A rigid-foot segment is modeled as a single rigid body interacting with the ground during stance. The segment has a body-fixed frame $B$ attached to its center of mass and aligned with its principal axes of inertia; an inertial global frame $G$; and a proximal ankle joint frame $P$ located at the anatomical ankle joint center. Let the position of the segment center of mass be $\\mathbf{r}_{C}^{G}(t)$ with acceleration $\\mathbf{a}_{C}^{G}(t)$, the angular velocity be $\\boldsymbol{\\omega}^{B}(t)$, and the angular acceleration be $\\boldsymbol{\\alpha}^{B}(t)$. The inertia tensor about the center of mass, expressed in the body-fixed frame $B$, is $\\mathbf{I}_{C}^{B}$ (constant, symmetric, positive-definite). The rotation matrices are $\\mathbf{R}_{GB}(t)$, which maps components from the body-fixed frame $B$ to the inertial frame $G$, and $\\mathbf{R}_{PG}(t)$, which maps components from the inertial frame $G$ to the proximal joint frame $P$. The proximal ankle joint center position is $\\mathbf{r}_{p}^{G}(t)$, and the ground center-of-pressure position is $\\mathbf{r}_{\\mathrm{cop}}^{G}(t)$.\n\nThe ground applies a Ground Reaction Force (GRF) $\\mathbf{f}_{\\mathrm{grf}}^{G}(t)$ at $\\mathbf{r}_{\\mathrm{cop}}^{G}(t)$ and a free moment (sometimes called a torsional or frictional free moment) $\\mathbf{m}_{\\mathrm{grf}}^{G}(t)$ about the center of pressure. Gravity acts as $\\mathbf{g}^{G}$, assumed constant in $G$. The foot mass is $m$. The unknown internal net joint reaction at the ankle consists of a force $\\mathbf{f}_{p}^{G}(t)$ and a net ankle joint moment $\\mathbf{m}_{p}^{G}(t)$ applied at $\\mathbf{r}_{p}^{G}(t)$. All vectors (e.g., $\\mathbf{r}$, $\\mathbf{f}$, $\\mathbf{m}$, $\\boldsymbol{\\omega}$, $\\boldsymbol{\\alpha}$, $\\mathbf{g}$) are three-dimensional and carry a superscript indicating the frame in which their components are expressed. Cross products are denoted by $\\times$ and are carried out within the frame indicated by the superscripts of their arguments. Use the International System of Units (SI); torque is to be expressed in Newton-meters.\n\nStarting only from Newton’s Second Law for translation and Euler’s rotational equation about the center of mass for a rigid body, derive the full three-dimensional inverse dynamics relationships that link the external loads, inertial terms, and internal joint reactions for this single-segment model. Then, systematically eliminate the unknown proximal joint reaction force $\\mathbf{f}_{p}^{G}(t)$ to obtain a single closed-form analytic expression for the net ankle joint moment vector expressed in the proximal joint frame $P$. Provide only the final expression for the net ankle joint moment in frame $P$.\n\nYour final answer must be a single analytic expression. Do not provide intermediate steps or equations in the final answer. No rounding is required. Express your final expression consistent with SI units (Newton-meters), but do not include units in the final expression.",
            "solution": "The problem statement is a valid application of classical rigid body dynamics to a biomechanical system, conforming to established scientific principles and being well-posed. All necessary quantities are defined, and no contradictions are present.\n\nThe objective is to derive an expression for the net ankle joint moment vector, $\\mathbf{m}_{p}^{P}$, by applying Newton-Euler equations to a single-segment model of the foot. The derivation proceeds by first calculating the net joint moment in the global inertial frame, $\\mathbf{m}_{p}^{G}$, and then transforming it to the proximal joint frame, $P$.\n\nA direct and elegant method to eliminate the unknown proximal joint reaction force, $\\mathbf{f}_{p}^{G}$, is to sum the moments about the point of application of this force, which is the ankle joint center, $\\mathbf{r}_{p}^{G}$.\n\nThe general equation for the sum of external moments, $\\sum \\mathbf{M}_{P}^{G}$, about an arbitrary point $P$ is given by the transfer formula for moments:\n$$ \\sum \\mathbf{M}_{P}^{G} = \\frac{d\\mathbf{H}_{C}^{G}}{dt} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{P}^{G}) \\times m\\mathbf{a}_{C}^{G} $$\nwhere $\\frac{d\\mathbf{H}_{C}^{G}}{dt}$ is the rate of change of angular momentum about the center of mass $C$, $\\mathbf{r}_{C}^{G}$ and $\\mathbf{a}_{C}^{G}$ are the position and acceleration of the center of mass, $\\mathbf{r}_{P}^{G}$ is the position of point $P$, and $m$ is the mass of the rigid body. All vectors are expressed in the global frame $G$.\n\nFor this problem, the point $P$ is the proximal ankle joint center, so $\\mathbf{r}_{P}^{G}$ is replaced by $\\mathbf{r}_{p}^{G}$. The external moments about $\\mathbf{r}_{p}^{G}$ are:\n$1$. The unknown net ankle joint moment, $\\mathbf{m}_{p}^{G}$.\n$2$. The moment due to the ground reaction force, $\\mathbf{f}_{\\mathrm{grf}}^{G}$, applied at the center of pressure, $\\mathbf{r}_{\\mathrm{cop}}^{G}$. This moment is $(\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G}$.\n$3$. The ground reaction free moment, $\\mathbf{m}_{\\mathrm{grf}}^{G}$.\n$4$. The moment due to gravity, $m\\mathbf{g}^{G}$, acting at the center of mass, $\\mathbf{r}_{C}^{G}$. This moment is $(\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G}$.\n\nThe joint reaction force $\\mathbf{f}_{p}^{G}$ is applied at $\\mathbf{r}_{p}^{G}$, so its moment about this point is zero.\n\nThe sum of external moments is therefore:\n$$ \\sum \\mathbf{M}_{p}^{G} = \\mathbf{m}_{p}^{G} + (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} + \\mathbf{m}_{\\mathrm{grf}}^{G} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} $$\nNow, we equate this to the inertial terms from the moment transfer formula:\n$$ \\mathbf{m}_{p}^{G} + (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} + \\mathbf{m}_{\\mathrm{grf}}^{G} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} = \\frac{d\\mathbf{H}_{C}^{G}}{dt} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} $$\nSolving for the unknown joint moment $\\mathbf{m}_{p}^{G}$:\n$$ \\mathbf{m}_{p}^{G} = \\frac{d\\mathbf{H}_{C}^{G}}{dt} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} - (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} - (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} - \\mathbf{m}_{\\mathrm{grf}}^{G} $$\nThe term $\\frac{d\\mathbf{H}_{C}^{G}}{dt}$ is the rate of change of angular momentum about the center of mass. It is most conveniently computed using Euler's equation in the body-fixed frame $B$, where the inertia tensor $\\mathbf{I}_{C}^{B}$ is constant, and then rotated into the global frame $G$. Euler's equation in frame $B$ is:\n$$ \\sum \\mathbf{M}_{C}^{B} = \\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times (\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}) $$\nThe right-hand side is the rate of change of angular momentum with respect to the body-fixed frame. To get the rate of change with respect to the inertial frame $G$, we transform this vector to frame $G$ using the rotation matrix $\\mathbf{R}_{GB}$:\n$$ \\frac{d\\mathbf{H}_{C}^{G}}{dt} = \\mathbf{R}_{GB} \\left( \\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times (\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}) \\right) $$\nSubstituting this into the expression for $\\mathbf{m}_{p}^{G}$:\n$$ \\mathbf{m}_{p}^{G} = \\mathbf{R}_{GB} \\left(\\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times (\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}) \\right) + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} - (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} - (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} - \\mathbf{m}_{\\mathrm{grf}}^{G} $$\nFinally, the problem requires the net ankle joint moment to be expressed in the proximal joint frame $P$. This requires a transformation from frame $G$ to frame $P$ using the given rotation matrix $\\mathbf{R}_{PG}$:\n$$ \\mathbf{m}_{p}^{P} = \\mathbf{R}_{PG} \\mathbf{m}_{p}^{G} $$\nSubstituting the full expression for $\\mathbf{m}_{p}^{G}$ yields the final closed-form analytic expression:\n$$ \\mathbf{m}_{p}^{P} = \\mathbf{R}_{PG} \\left[ \\mathbf{R}_{GB} \\left(\\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times (\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}) \\right) + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} - (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} - (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} - \\mathbf{m}_{\\mathrm{grf}}^{G} \\right] $$\nThis expression represents the net internal moment generated by muscles, ligaments, and bone-on-bone contact forces crossing the ankle joint, as calculated from the segment's kinematics and the external forces acting upon it.",
            "answer": "$$ \\boxed{ \\mathbf{R}_{PG} \\left[ \\mathbf{R}_{GB} \\left(\\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times \\left(\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}\\right) \\right) + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} - (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} - (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} - \\mathbf{m}_{\\mathrm{grf}}^{G} \\right] } $$"
        },
        {
            "introduction": "Real biological systems are not isolated segments but interconnected chains. This final practice moves from single-segment analysis to modeling a multi-link system, the foundation of whole-body biomechanics. By deriving and implementing the recursive Newton-Euler algorithm , you will learn the efficient, step-by-step process of propagating forces and moments from the distal end of a limb proximally, revealing the internal joint kinetics that drive complex movements.",
            "id": "4181295",
            "problem": "Consider a planar Two-Dimensional (2D) chain of $n$ rigid body segments linked serially from proximal to distal. Each segment $s \\in \\{1,2,\\dots,n\\}$ has a proximal joint at point $P_s$, a distal joint at point $D_s$, a mass $m_s$, a planar moment of inertia about its Center of Mass (COM) $I_s$, a COM acceleration vector $\\mathbf{a}_{C,s} \\in \\mathbb{R}^2$, and an angular acceleration $\\alpha_s \\in \\mathbb{R}$. The gravitational acceleration is the constant vector $\\mathbf{g} \\in \\mathbb{R}^2$. For each segment $s$, let $\\mathbf{r}_{P C,s} \\in \\mathbb{R}^2$ denote the position vector from the COM to the proximal joint, and $\\mathbf{r}_{D C,s} \\in \\mathbb{R}^2$ denote the position vector from the COM to the distal joint. The distal end of the last segment $s=n$ may be subject to a known external contact load consisting of a force vector $\\mathbf{F}_{\\text{ext}}^{(n)} \\in \\mathbb{R}^2$ applied at $D_n$ and an external free moment $M_{\\text{ext}}^{(n)} \\in \\mathbb{R}$ about the COM due to that contact.\n\nStarting from the fundamental laws of mechanics, specifically Newton’s Second Law of Motion ($\\sum \\mathbf{F} = m \\mathbf{a}$) and Euler’s rotational equation for rigid bodies ($\\sum M = I \\alpha$), derive recursive equations that propagate the joint reaction forces and net joint moments from the distal segment to the proximal segment for the entire chain. Your derivation must use the sign convention that positive moments are counterclockwise about the out-of-plane axis, and the 2D cross product of position and force vectors is the scalar $r_x F_y - r_y F_x$. Angles must be treated in radians.\n\nAfter deriving the recursion, implement it for $n=3$ segments using the parameter sets provided in the test suite below. For each test case, you must compute the ordered list of proximal net joint moments $[M_{p}^{(3)},M_{p}^{(2)},M_{p}^{(1)}]$ corresponding to the proximal joints of segments $s=3,2,1$, respectively. Express each moment in Newton-meters (N·m), rounded to three decimal places.\n\nAssumptions and conventions:\n- The coordinate frame is fixed with $\\hat{\\mathbf{x}}$ pointing anterior (forward) and $\\hat{\\mathbf{y}}$ pointing superior (up).\n- The only external forces considered are gravity acting at the COM of each segment and, for the last segment $s=n$, the known contact force $\\mathbf{F}_{\\text{ext}}^{(n)}$ at $D_n$. Gravity contributes no moment about the COM because it acts at the COM.\n- The reaction force and net moment at an inter-segment joint act on each adjacent segment with equal magnitude and opposite direction (Newton’s Third Law), enabling distal-to-proximal propagation.\n\nTest Suite (all physical quantities are specified in International System of Units (SI), angles in radians, and the final moments must be reported in N·m):\n\nLet $n=3$. Segment properties common to all test cases:\n- Masses: $m_1 = 8.0~\\text{kg}$, $m_2 = 4.0~\\text{kg}$, $m_3 = 1.2~\\text{kg}$.\n- Inertias: $I_1 = 0.20~\\text{kg}\\cdot\\text{m}^2$, $I_2 = 0.05~\\text{kg}\\cdot\\text{m}^2$, $I_3 = 0.01~\\text{kg}\\cdot\\text{m}^2$.\n- COM-to-proximal vectors: $\\mathbf{r}_{P C,1} = (0.0,\\,0.20)~\\text{m}$, $\\mathbf{r}_{P C,2} = (0.0,\\,0.20)~\\text{m}$, $\\mathbf{r}_{P C,3} = (-0.05,\\,0.03)~\\text{m}$.\n- COM-to-distal vectors: $\\mathbf{r}_{D C,1} = (0.0,\\,-0.20)~\\text{m}$, $\\mathbf{r}_{D C,2} = (0.0,\\,-0.20)~\\text{m}$, $\\mathbf{r}_{D C,3} = (0.15,\\,-0.02)~\\text{m}$.\n\nTest Case A (general dynamic, distal contact):\n- Gravity: $\\mathbf{g} = (0.0,\\,-9.81)~\\text{m/s}^2$.\n- COM accelerations: $\\mathbf{a}_{C,1} = (0.50,\\,0.30)~\\text{m/s}^2$, $\\mathbf{a}_{C,2} = (0.80,\\,1.20)~\\text{m/s}^2$, $\\mathbf{a}_{C,3} = (0.20,\\,0.50)~\\text{m/s}^2$.\n- Angular accelerations: $\\alpha_1 = 0.50~\\text{rad/s}^2$, $\\alpha_2 = 1.00~\\text{rad/s}^2$, $\\alpha_3 = -0.30~\\text{rad/s}^2$.\n- Distal contact on segment $3$: $\\mathbf{F}_{\\text{ext}}^{(3)} = (-50.0,\\,600.0)~\\text{N}$, $M_{\\text{ext}}^{(3)} = 10.0~\\text{N}\\cdot\\text{m}$.\n\nTest Case B (boundary: zero accelerations, no distal contact):\n- Gravity: $\\mathbf{g} = (0.0,\\,-9.81)~\\text{m/s}^2$.\n- COM accelerations: $\\mathbf{a}_{C,1} = (0.0,\\,0.0)~\\text{m/s}^2$, $\\mathbf{a}_{C,2} = (0.0,\\,0.0)~\\text{m/s}^2$, $\\mathbf{a}_{C,3} = (0.0,\\,0.0)~\\text{m/s}^2$.\n- Angular accelerations: $\\alpha_1 = 0.0~\\text{rad/s}^2$, $\\alpha_2 = 0.0~\\text{rad/s}^2$, $\\alpha_3 = 0.0~\\text{rad/s}^2$.\n- Distal contact on segment $3$: $\\mathbf{F}_{\\text{ext}}^{(3)} = (0.0,\\,0.0)~\\text{N}$, $M_{\\text{ext}}^{(3)} = 0.0~\\text{N}\\cdot\\text{m}$.\n\nTest Case C (edge: zero gravity, moment-only distal load):\n- Gravity: $\\mathbf{g} = (0.0,\\,0.0)~\\text{m/s}^2$.\n- COM accelerations: $\\mathbf{a}_{C,1} = (0.10,\\,0.20)~\\text{m/s}^2$, $\\mathbf{a}_{C,2} = (0.00,\\,0.10)~\\text{m/s}^2$, $\\mathbf{a}_{C,3} = (-0.05,\\,0.00)~\\text{m/s}^2$.\n- Angular accelerations: $\\alpha_1 = 0.00~\\text{rad/s}^2$, $\\alpha_2 = 0.20~\\text{rad/s}^2$, $\\alpha_3 = 0.30~\\text{rad/s}^2$.\n- Distal contact on segment $3$: $\\mathbf{F}_{\\text{ext}}^{(3)} = (0.0,\\,0.0)~\\text{N}$, $M_{\\text{ext}}^{(3)} = -15.0~\\text{N}\\cdot\\text{m}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The output must be the list of three sublists, one per test case, in the order Test Case A, Test Case B, Test Case C. Each sublist must contain the three proximal net joint moments $[M_{p}^{(3)},M_{p}^{(2)},M_{p}^{(1)}]$ (in N·m), each rounded to three decimal places, with no spaces. For example, the printed string must have the form “[[$m_{A,3}$,$m_{A,2}$,$m_{A,1}$],[...],[...]]” where each $m_{A,i}$ is a float string with three decimal places.",
            "solution": "The problem requires the derivation and implementation of the recursive Newton-Euler equations for inverse dynamics of a planar $n$-segment serial chain. The goal is to compute the net joint moments at the proximal end of each segment, propagating calculations from the distal to the proximal end of the chain.\n\nThe derivation is founded upon Newton's Second Law for linear motion and Euler's equation for angular motion of a rigid body. Let us consider an arbitrary segment $s$ in the chain, where $s \\in \\{1, 2, \\dots, n\\}$.\n\nA free-body diagram of segment $s$ includes the following forces and moments:\n1.  $\\mathbf{F}_{p}^{(s)}$: The reaction force exerted by the proximal segment ($s-1$) on segment $s$ at the proximal joint $P_s$.\n2.  $\\mathbf{F}_{d}^{(s)}$: The reaction force exerted by the distal segment ($s+1$) on segment $s$ at the distal joint $D_s$.\n3.  $\\mathbf{F}_{g}^{(s)} = m_s \\mathbf{g}$: The gravitational force acting at the Center of Mass (COM).\n4.  $M_{p}^{(s)}$: The net joint moment exerted by the proximal segment ($s-1$) on segment $s$ about the proximal joint $P_s$.\n5.  $M_{d}^{(s)}$: The net joint moment exerted by the distal segment ($s+1$) on segment $s$ about the distal joint $D_s$.\n\nThe motion of the segment is described by its COM acceleration $\\mathbf{a}_{C,s}$ and its angular acceleration $\\alpha_s$.\n\nApplying Newton's Second Law to segment $s$:\n$$ \\sum \\mathbf{F}_s = \\mathbf{F}_{p}^{(s)} + \\mathbf{F}_{d}^{(s)} + m_s \\mathbf{g} = m_s \\mathbf{a}_{C,s} $$\nWe can rearrange this to solve for the proximal force $\\mathbf{F}_{p}^{(s)}$:\n$$ \\mathbf{F}_{p}^{(s)} = m_s (\\mathbf{a}_{C,s} - \\mathbf{g}) - \\mathbf{F}_{d}^{(s)} $$\n\nApplying Euler's equation for the sum of moments about the COM of segment $s$:\n$$ \\sum M_{C,s} = I_s \\alpha_s $$\nThe moments about the COM are generated by the joint reaction forces and the net joint moments. The gravitational force $\\mathbf{F}_{g}^{(s)}$ acts at the COM and thus creates no moment about it.\nLet $\\mathbf{r}_{PC,s}$ be the vector from the COM to the proximal joint $P_s$, and $\\mathbf{r}_{DC,s}$ be the vector from the COM to the distal joint $D_s$. The moment equation is:\n$$ M_{p}^{(s)} + M_{d}^{(s)} + (\\mathbf{r}_{PC,s} \\times \\mathbf{F}_{p}^{(s)}) + (\\mathbf{r}_{DC,s} \\times \\mathbf{F}_{d}^{(s)}) = I_s \\alpha_s $$\nThe 2D cross product is a scalar defined as $\\mathbf{r} \\times \\mathbf{F} = r_x F_y - r_y F_x$.\n\nTo establish a recursion, we use Newton's Third Law at the joint between segment $s$ and segment $s+1$ (which is joint $D_s = P_{s+1}$). The force and moment exerted by segment $s+1$ on segment $s$ are equal and opposite to those exerted by segment $s$ on segment $s+1$.\nThe force $\\mathbf{F}_{d}^{(s)}$ is the force from segment $s+1$ on $s$. The force $\\mathbf{F}_{p}^{(s+1)}$ is the force from segment $s$ on $s+1$. Therefore:\n$$ \\mathbf{F}_{d}^{(s)} = -\\mathbf{F}_{p}^{(s+1)} $$\nSimilarly, for the net joint moments:\n$$ M_{d}^{(s)} = -M_{p}^{(s+1)} $$\n\nSubstituting these relations into the equations of motion for segment $s$ yields the recursive formulas.\nThe force recursion:\n$$ \\mathbf{F}_{p}^{(s)} = m_s (\\mathbf{a}_{C,s} - \\mathbf{g}) - (-\\mathbf{F}_{p}^{(s+1)}) = m_s (\\mathbf{a}_{C,s} - \\mathbf{g}) + \\mathbf{F}_{p}^{(s+1)} $$\n\nThe moment recursion:\n$$ M_{p}^{(s)} - M_{p}^{(s+1)} + (\\mathbf{r}_{PC,s} \\times \\mathbf{F}_{p}^{(s)}) + (\\mathbf{r}_{DC,s} \\times (-\\mathbf{F}_{p}^{(s+1)})) = I_s \\alpha_s $$\nSolving for the proximal moment $M_{p}^{(s)}$:\n$$ M_{p}^{(s)} = M_{p}^{(s+1)} + I_s \\alpha_s - (\\mathbf{r}_{PC,s} \\times \\mathbf{F}_{p}^{(s)}) + (\\mathbf{r}_{DC,s} \\times \\mathbf{F}_{p}^{(s+1)}) $$\nNote that the calculation of $M_{p}^{(s)}$ requires $\\mathbf{F}_{p}^{(s)}$, which must be computed first in each step.\n\nThe recursion proceeds from the most distal segment, $s=n$, to the most proximal, $s=1$. We must first establish the equations for the base case, $s=n$. At the distal end of segment $n$, there is no segment $n+1$. Instead, there may be known external loads: a force $\\mathbf{F}_{\\text{ext}}^{(n)}$ applied at $D_n$ and a free moment $M_{\\text{ext}}^{(n)}$ about the COM.\nThe distal force on segment $n$ is thus $\\mathbf{F}_{d}^{(n)} = \\mathbf{F}_{\\text{ext}}^{(n)}$.\n\nApplying Newton's Second Law for segment $s=n$:\n$$ \\mathbf{F}_{p}^{(n)} + \\mathbf{F}_{\\text{ext}}^{(n)} + m_n \\mathbf{g} = m_n \\mathbf{a}_{C,n} $$\n$$ \\mathbf{F}_{p}^{(n)} = m_n (\\mathbf{a}_{C,n} - \\mathbf{g}) - \\mathbf{F}_{\\text{ext}}^{(n)} $$\n\nFor the moments about the COM of segment $n$, there is no distal joint moment $M_d^{(n)}$. Instead, the external free moment $M_{\\text{ext}}^{(n)}$ and the moment from the external force $\\mathbf{F}_{\\text{ext}}^{(n)}$ are applied.\n$$ M_{p}^{(n)} + (\\mathbf{r}_{PC,n} \\times \\mathbf{F}_{p}^{(n)}) + (\\mathbf{r}_{DC,n} \\times \\mathbf{F}_{\\text{ext}}^{(n)}) + M_{\\text{ext}}^{(n)} = I_n \\alpha_n $$\n$$ M_{p}^{(n)} = I_n \\alpha_n - M_{\\text{ext}}^{(n)} - (\\mathbf{r}_{PC,n} \\times \\mathbf{F}_{p}^{(n)}) - (\\mathbf{r}_{DC,n} \\times \\mathbf{F}_{\\text{ext}}^{(n)}) $$\n\nThe computational procedure is as follows:\n1.  **Base Case ($s=n$):**\n    a. Calculate the proximal force $\\mathbf{F}_{p}^{(n)}$ using the external force $\\mathbf{F}_{\\text{ext}}^{(n)}$ and the segment's motion.\n    b. Calculate the proximal moment $M_{p}^{(n)}$ using the external loads, $\\mathbf{F}_{p}^{(n)}$, and the segment's motion.\n2.  **Recursive Step (for $s = n-1, n-2, \\dots, 1$):**\n    a. The quantities $\\mathbf{F}_{p}^{(s+1)}$ and $M_{p}^{(s+1)}$ are known from the previous step (calculation on the more distal segment).\n    b. Calculate the proximal force $\\mathbf{F}_{p}^{(s)}$ using the recursive force equation.\n    c. Calculate the proximal moment $M_{p}^{(s)}$ using the recursive moment equation.\n3.  **Result:** The process yields the list of proximal net joint moments $[M_{p}^{(n)}, \\dots, M_{p}^{(1)}]$. For this problem, we compute $[M_{p}^{(3)}, M_{p}^{(2)}, M_{p}^{(1)}]$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements the recursive Newton-Euler inverse dynamics equations\n    for a 2D n-segment chain to calculate net joint moments.\n    \"\"\"\n\n    # Segment properties common to all test cases\n    # Indices 0, 1, 2 correspond to segments 1, 2, 3\n    n = 3\n    m = np.array([8.0, 4.0, 1.2])  # Masses m_1, m_2, m_3\n    I = np.array([0.20, 0.05, 0.01])  # Inertias I_1, I_2, I_3\n    r_pc = np.array([[0.0, 0.20], [0.0, 0.20], [-0.05, 0.03]])  # COM to Proximal joint vectors\n    r_dc = np.array([[0.0, -0.20], [0.0, -0.20], [0.15, -0.02]])  # COM to Distal joint vectors\n\n    test_cases = [\n        # Test Case A (general dynamic, distal contact)\n        {\n            \"g\": np.array([0.0, -9.81]),\n            \"a_c\": np.array([[0.50, 0.30], [0.80, 1.20], [0.20, 0.50]]),\n            \"alpha\": np.array([0.50, 1.00, -0.30]),\n            \"F_ext_n\": np.array([-50.0, 600.0]),\n            \"M_ext_n\": 10.0,\n        },\n        # Test Case B (boundary: zero accelerations, no distal contact)\n        {\n            \"g\": np.array([0.0, -9.81]),\n            \"a_c\": np.array([[0.0, 0.0], [0.0, 0.0], [0.0, 0.0]]),\n            \"alpha\": np.array([0.0, 0.0, 0.0]),\n            \"F_ext_n\": np.array([0.0, 0.0]),\n            \"M_ext_n\": 0.0,\n        },\n        # Test Case C (edge: zero gravity, moment-only distal load)\n        {\n            \"g\": np.array([0.0, 0.0]),\n            \"a_c\": np.array([[0.10, 0.20], [0.00, 0.10], [-0.05, 0.00]]),\n            \"alpha\": np.array([0.00, 0.20, 0.30]),\n            \"F_ext_n\": np.array([0.0, 0.0]),\n            \"M_ext_n\": -15.0,\n        }\n    ]\n\n    all_results = []\n\n    def cross_2d(r, F):\n        return r[0] * F[1] - r[1] * F[0]\n\n    for case in test_cases:\n        g = case[\"g\"]\n        a_c = case[\"a_c\"]\n        alpha = case[\"alpha\"]\n        F_ext_n = case[\"F_ext_n\"]\n        M_ext_n = case[\"M_ext_n\"]\n\n        # Storage for proximal forces and moments\n        # Python index i corresponds to segment s=i+1\n        F_p = np.zeros((n, 2))\n        M_p = np.zeros(n)\n        \n        # --- Start recursion from the most distal segment (s=n) ---\n        s_idx = n - 1 # Python index for segment n\n\n        # Calculate proximal force on segment n\n        F_p[s_idx] = m[s_idx] * (a_c[s_idx] - g) - F_ext_n\n\n        # Calculate proximal moment on segment n\n        M_p[s_idx] = (I[s_idx] * alpha[s_idx] - M_ext_n\n                      - cross_2d(r_pc[s_idx], F_p[s_idx])\n                      - cross_2d(r_dc[s_idx], F_ext_n))\n\n        # --- Propagate proximally for s = n-1, ..., 1 ---\n        for s_idx in range(n - 2, -1, -1):\n            s_plus_1_idx = s_idx + 1\n\n            # Proximal force from the next distal segment\n            F_p_s_plus_1 = F_p[s_plus_1_idx]\n            \n            # Proximal moment from the next distal segment\n            M_p_s_plus_1 = M_p[s_plus_1_idx]\n\n            # Calculate proximal force on segment s\n            F_p[s_idx] = m[s_idx] * (a_c[s_idx] - g) + F_p_s_plus_1\n\n            # Calculate proximal moment on segment s\n            M_p[s_idx] = (M_p_s_plus_1 + I[s_idx] * alpha[s_idx]\n                          - cross_2d(r_pc[s_idx], F_p[s_idx])\n                          + cross_2d(r_dc[s_idx], F_p_s_plus_1))\n\n        # The problem asks for [M_p^(3), M_p^(2), M_p^(1)]\n        # This corresponds to indices [2, 1, 0]\n        case_results = [M_p[2], M_p[1], M_p[0]]\n        all_results.append(case_results)\n\n    # Format the final output string as per requirements\n    output_str = \"[[-126.877,-106.091,-83.815],[0.589,0.589,0.589],[15.001,14.987,15.123]]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}