{
    "hands_on_practices": [
        {
            "introduction": "The first step in analyzing the motion of a body segment is to establish a consistent, segment-fixed reference frame. This allows us to describe the segment's orientation and the movement of joints relative to the segment itself, a cornerstone of biomechanical analysis. This exercise demonstrates the fundamental process of constructing a right-handed orthonormal basis from anatomical landmark data using core vector algebra concepts like the Gram-Schmidt process and the cross product .",
            "id": "4163223",
            "problem": "A laboratory coordinate measurement system has captured three-dimensional positions of anatomical landmarks on a human forearm segment in a global Cartesian frame. From these landmarks, two displacement vectors were formed:\n$$\\mathbf{u} = \\begin{pmatrix}36 \\\\ -12 \\\\ 48\\end{pmatrix}\\ \\text{mm}, \\quad \\mathbf{v} = \\begin{pmatrix}18 \\\\ 30 \\\\ -6\\end{pmatrix}\\ \\text{mm}.$$\nAccording to common practices endorsed by the International Society of Biomechanics (ISB), an anatomical reference frame fixed to a rigid segment can be constructed from landmark-based directions. You are to build a segment-fixed orthonormal right-handed basis $\\{\\hat{\\mathbf{x}}, \\hat{\\mathbf{y}}, \\hat{\\mathbf{z}}\\}$ using only the following core definitions:\n- The dot product of vectors $\\mathbf{a}$ and $\\mathbf{b}$ is $\\mathbf{a}\\cdot\\mathbf{b}$, and the Euclidean norm is $\\|\\mathbf{a}\\| = \\sqrt{\\mathbf{a}\\cdot\\mathbf{a}}$.\n- The Gram–Schmidt process orthonormalizes a set of noncollinear vectors using projections defined by the dot product and normalization by the Euclidean norm.\n- The cross product $\\mathbf{a}\\times\\mathbf{b}$ returns a vector orthogonal to both $\\mathbf{a}$ and $\\mathbf{b}$ and determines right-handedness.\nDefine $\\hat{\\mathbf{x}}$ to be the unit vector along $\\mathbf{u}$ (the long axis proximal-to-distal direction), define $\\hat{\\mathbf{y}}$ to be the unit vector obtained by orthonormalizing $\\mathbf{v}$ against $\\hat{\\mathbf{x}}$ so that $\\hat{\\mathbf{y}}$ lies in the span of $\\mathbf{u}$ and $\\mathbf{v}$ but is orthogonal to $\\hat{\\mathbf{x}}$, and define $\\hat{\\mathbf{z}} = \\hat{\\mathbf{x}} \\times \\hat{\\mathbf{y}}$ to complete a right-handed triad. Write the resulting basis as the $3\\times 3$ orientation matrix\n$$B = [\\hat{\\mathbf{x}}\\ \\hat{\\mathbf{y}}\\ \\hat{\\mathbf{z}}],$$\nexpressing all entries exactly using radicals. The orientation matrix is dimensionless. No numerical rounding is required.",
            "solution": "The user has requested the construction of a right-handed orthonormal basis $\\{\\hat{\\mathbf{x}}, \\hat{\\mathbf{y}}, \\hat{\\mathbf{z}}\\}$ from two given vectors $\\mathbf{u}$ and $\\mathbf{v}$, and to express this basis as a $3\\times 3$ orientation matrix $B = [\\hat{\\mathbf{x}}\\ \\hat{\\mathbf{y}}\\ \\hat{\\mathbf{z}}]$.\n\n### Step 1: Problem Validation\n\n**Extracted Givens:**\n- The input vectors are $\\mathbf{u} = \\begin{pmatrix}36 \\\\ -12 \\\\ 48\\end{pmatrix}\\ \\text{mm}$ and $\\mathbf{v} = \\begin{pmatrix}18 \\\\ 30 \\\\ -6\\end{pmatrix}\\ \\text{mm}$.\n- The anatomical basis $\\{\\hat{\\mathbf{x}}, \\hat{\\mathbf{y}}, \\hat{\\mathbf{z}}\\}$ must be orthonormal and right-handed.\n- The construction rules are:\n    1. $\\hat{\\mathbf{x}}$ is the unit vector along $\\mathbf{u}$.\n    2. $\\hat{\\mathbf{y}}$ is the unit vector obtained by orthonormalizing $\\mathbf{v}$ against $\\hat{\\mathbf{x}}$.\n    3. $\\hat{\\mathbf{z}} = \\hat{\\mathbf{x}} \\times \\hat{\\mathbf{y}}$.\n- The final output must be the matrix $B = [\\hat{\\mathbf{x}}\\ \\hat{\\mathbf{y}}\\ \\hat{\\mathbf{z}}]$ with exact entries using radicals.\n\n**Validation using Extracted Givens:**\nThe problem is scientifically grounded, employing standard vector algebra (normalization, Gram-Schmidt process, cross product) in a context—biomechanical reference frames—where these methods are routinely applied. The problem is well-posed; the instructions are precise and, given that the input vectors are non-zero and non-collinear, will lead to a unique orthonormal basis. The vectors are not collinear, as there is no single scalar $k$ such that $\\mathbf{v} = k\\mathbf{u}$ (e.g., $18/36 = 1/2$, but $30/(-12) \\neq 1/2$). The language is objective and the data are complete and consistent. Therefore, the problem is valid.\n\n### Step 2: Solution Derivation\n\nThe procedure to construct the basis vectors is followed sequentially.\n\n**1. Calculation of the first basis vector, $\\hat{\\mathbf{x}}$:**\nThe vector $\\hat{\\mathbf{x}}$ is defined as the unit vector in the direction of $\\mathbf{u}$. This is calculated by dividing $\\mathbf{u}$ by its Euclidean norm, $\\|\\mathbf{u}\\|$.\nFirst, calculate the norm of $\\mathbf{u}$:\n$$ \\|\\mathbf{u}\\| = \\sqrt{36^2 + (-12)^2 + 48^2} $$\nTo simplify the arithmetic, we can factor out the greatest common divisor of the components of $\\mathbf{u}$, which is $12$.\n$$ \\mathbf{u} = 12 \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix} $$\nThe norm is then:\n$$ \\|\\mathbf{u}\\| = |12| \\sqrt{3^2 + (-1)^2 + 4^2} = 12 \\sqrt{9 + 1 + 16} = 12\\sqrt{26} $$\nNow, we find the unit vector $\\hat{\\mathbf{x}}$:\n$$ \\hat{\\mathbf{x}} = \\frac{\\mathbf{u}}{\\|\\mathbf{u}\\|} = \\frac{12 \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix}}{12\\sqrt{26}} = \\frac{1}{\\sqrt{26}} \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix} = \\begin{pmatrix} 3/\\sqrt{26} \\\\ -1/\\sqrt{26} \\\\ 4/\\sqrt{26} \\end{pmatrix} $$\n\n**2. Calculation of the second basis vector, $\\hat{\\mathbf{y}}$:**\nThe vector $\\hat{\\mathbf{y}}$ is found by applying the Gram-Schmidt process to orthogonalize $\\mathbf{v}$ with respect to $\\hat{\\mathbf{x}}$, and then normalizing the result.\nLet $\\mathbf{w}$ be the component of $\\mathbf{v}$ that is orthogonal to $\\hat{\\mathbf{x}}$.\n$$ \\mathbf{w} = \\mathbf{v} - (\\mathbf{v} \\cdot \\hat{\\mathbf{x}})\\hat{\\mathbf{x}} $$\nWe must first compute the dot product $\\mathbf{v} \\cdot \\hat{\\mathbf{x}}$:\n$$ \\mathbf{v} \\cdot \\hat{\\mathbf{x}} = \\begin{pmatrix} 18 \\\\ 30 \\\\ -6 \\end{pmatrix} \\cdot \\frac{1}{\\sqrt{26}} \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix} = \\frac{1}{\\sqrt{26}} (18 \\cdot 3 + 30 \\cdot (-1) + (-6) \\cdot 4) $$\n$$ \\mathbf{v} \\cdot \\hat{\\mathbf{x}} = \\frac{1}{\\sqrt{26}} (54 - 30 - 24) = \\frac{1}{\\sqrt{26}}(0) = 0 $$\nThe dot product is zero, which signifies that the original vectors $\\mathbf{u}$ and $\\mathbf{v}$ are already orthogonal. The Gram-Schmidt orthogonalization step is therefore simplified, as the projection of $\\mathbf{v}$ onto $\\hat{\\mathbf{x}}$ is zero.\n$$ \\mathbf{w} = \\mathbf{v} - (0)\\hat{\\mathbf{x}} = \\mathbf{v} $$\nTo find $\\hat{\\mathbf{y}}$, we simply normalize $\\mathbf{w} = \\mathbf{v}$.\nFirst, calculate the norm of $\\mathbf{v}$:\n$$ \\|\\mathbf{v}\\| = \\sqrt{18^2 + 30^2 + (-6)^2} $$\nWe factor out the greatest common divisor, which is $6$.\n$$ \\mathbf{v} = 6 \\begin{pmatrix} 3 \\\\ 5 \\\\ -1 \\end{pmatrix} $$\nThe norm is:\n$$ \\|\\mathbf{v}\\| = |6| \\sqrt{3^2 + 5^2 + (-1)^2} = 6 \\sqrt{9 + 25 + 1} = 6\\sqrt{35} $$\nNow, we find the unit vector $\\hat{\\mathbf{y}}$:\n$$ \\hat{\\mathbf{y}} = \\frac{\\mathbf{v}}{\\|\\mathbf{v}\\|} = \\frac{6 \\begin{pmatrix} 3 \\\\ 5 \\\\ -1 \\end{pmatrix}}{6\\sqrt{35}} = \\frac{1}{\\sqrt{35}} \\begin{pmatrix} 3 \\\\ 5 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 3/\\sqrt{35} \\\\ 5/\\sqrt{35} \\\\ -1/\\sqrt{35} \\end{pmatrix} $$\n\n**3. Calculation of the third basis vector, $\\hat{\\mathbf{z}}$:**\nThe vector $\\hat{\\mathbf{z}}$ is defined by the cross product of $\\hat{\\mathbf{x}}$ and $\\hat{\\mathbf{y}}$ to form a right-handed system.\n$$ \\hat{\\mathbf{z}} = \\hat{\\mathbf{x}} \\times \\hat{\\mathbf{y}} = \\left( \\frac{1}{\\sqrt{26}} \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix} \\right) \\times \\left( \\frac{1}{\\sqrt{35}} \\begin{pmatrix} 3 \\\\ 5 \\\\ -1 \\end{pmatrix} \\right) $$\n$$ \\hat{\\mathbf{z}} = \\frac{1}{\\sqrt{26}\\sqrt{35}} \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix} \\times \\begin{pmatrix} 3 \\\\ 5 \\\\ -1 \\end{pmatrix} $$\nThe scalar prefactor is $1/\\sqrt{26 \\cdot 35} = 1/\\sqrt{910}$.\nThe cross product of the integer vectors is:\n$$ \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix} \\times \\begin{pmatrix} 3 \\\\ 5 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} (-1)(-1) - (4)(5) \\\\ (4)(3) - (3)(-1) \\\\ (3)(5) - (-1)(3) \\end{pmatrix} = \\begin{pmatrix} 1 - 20 \\\\ 12 + 3 \\\\ 15 + 3 \\end{pmatrix} = \\begin{pmatrix} -19 \\\\ 15 \\\\ 18 \\end{pmatrix} $$\nThus, the third basis vector is:\n$$ \\hat{\\mathbf{z}} = \\frac{1}{\\sqrt{910}} \\begin{pmatrix} -19 \\\\ 15 \\\\ 18 \\end{pmatrix} = \\begin{pmatrix} -19/\\sqrt{910} \\\\ 15/\\sqrt{910} \\\\ 18/\\sqrt{910} \\end{pmatrix} $$\n\n**4. Assembly of the Orientation Matrix, $B$:**\nThe orientation matrix $B$ is formed by arranging the basis vectors $\\hat{\\mathbf{x}}$, $\\hat{\\mathbf{y}}$, and $\\hat{\\mathbf{z}}$ as its columns.\n$$ B = [\\hat{\\mathbf{x}}\\ \\hat{\\mathbf{y}}\\ \\hat{\\mathbf{z}}] = \\begin{pmatrix} 3/\\sqrt{26} & 3/\\sqrt{35} & -19/\\sqrt{910} \\\\ -1/\\sqrt{26} & 5/\\sqrt{35} & 15/\\sqrt{910} \\\\ 4/\\sqrt{26} & -1/\\sqrt{35} & 18/\\sqrt{910} \\end{pmatrix} $$\nThe matrix is constructed as requested, with all entries expressed exactly using radicals. This concludes the derivation.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{3}{\\sqrt{26}} & \\frac{3}{\\sqrt{35}} & -\\frac{19}{\\sqrt{910}} \\\\ -\\frac{1}{\\sqrt{26}} & \\frac{5}{\\sqrt{35}} & \\frac{15}{\\sqrt{910}} \\\\ \\frac{4}{\\sqrt{26}} & -\\frac{1}{\\sqrt{35}} & \\frac{18}{\\sqrt{910}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "In biomechanics, data is often pooled from multiple sources, making standardized coordinate systems essential, yet inconsistencies in axis definitions are a common practical hurdle. This practice explores how a seemingly minor difference, such as an inverted axis, fundamentally changes the \"handedness\" of a coordinate system and how to mathematically detect and correct for this discrepancy. By analyzing the determinant of the transformation matrix, you will learn to identify improper rotations and restore data to a consistent, right-handed framework, a crucial skill for ensuring data integrity in collaborative research .",
            "id": "4163226",
            "problem": "A biomechanics consortium attempts to merge kinematic data from $2$ laboratories that use different anatomical reference frames. Both laboratories report body segment orientations as Direction Cosine Matrices (DCM), where a DCM $R$ maps a column vector expressed in the segment’s anatomical frame $\\mathcal{S}$ to the laboratory’s global frame $\\mathcal{G}$ via $v_{\\mathcal{G}} = R\\,v_{\\mathcal{S}}$. Laboratory $\\mathcal{A}$ defines a right-handed global frame $\\mathcal{G}_{\\mathcal{A}}$ with axes: $x$ anterior, $y$ subject’s left (frontal axis), and $z$ superior. Laboratory $\\mathcal{B}$ is identical except it defines the frontal axis oppositely: $\\hat{y}_{\\mathcal{B}} = -\\hat{y}_{\\mathcal{A}}$, with $\\hat{x}_{\\mathcal{B}} = \\hat{x}_{\\mathcal{A}}$ and $\\hat{z}_{\\mathcal{B}} = \\hat{z}_{\\mathcal{A}}$. The segment frame $\\mathcal{S}$ is the same in both labs. Assume column-vector convention and passive rotations (DCM maps segment to global), and that any DCM obtained from a physically valid right-handed coordinate transformation must be orthonormal with determinant $+1$.\n\nA static validation trial is recorded in laboratory $\\mathcal{B}$ for a segment undergoing a pure axial rotation about the superior axis, with an unknown signed angle $\\phi$ about the $z$-axis of $\\mathcal{G}_{\\mathcal{A}}$. For a particular frame of interest, laboratory $\\mathcal{B}$ reports the DCM\n$$\nR_{\\mathcal{B}} = \\begin{pmatrix}\n\\frac{\\sqrt{3}}{2} & -\\frac{1}{2} & 0 \\\\\n-\\frac{1}{2} & -\\frac{\\sqrt{3}}{2} & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix}.\n$$\n\nUsing only fundamental definitions and properties of rotations and reflections in Cartesian coordinate systems:\n- Justify a detection criterion for a sign-convention inconsistency based on $R_{\\mathcal{B}}$ alone, and apply it to the given $R_{\\mathcal{B}}$.\n- Derive the axis-flip matrix $F_{y}$ that maps vectors from $\\mathcal{G}_{\\mathcal{A}}$ to $\\mathcal{G}_{\\mathcal{B}}$ and use it to construct the corrected DCM $R_{\\mathcal{A}}$ that would have been reported in laboratory $\\mathcal{A}$ for the same physical orientation.\n- From $R_{\\mathcal{A}}$, identify the signed yaw angle $\\phi$ about the superior axis under the $z$-$y$-$x$ intrinsic sequence, working from first principles.\n\nExpress the final angle $\\phi$ in radians as an exact value. Do not round.",
            "solution": "The problem is first subjected to validation.\n\n### Step 1: Extract Givens\n- Kinematic data from $2$ laboratories, $\\mathcal{A}$ and $\\mathcal{B}$.\n- Data are Direction Cosine Matrices (DCM), denoted $R$.\n- A DCM maps a vector from a segment frame $\\mathcal{S}$ to a global frame $\\mathcal{G}$: $v_{\\mathcal{G}} = R\\,v_{\\mathcal{S}}$.\n- Global frame $\\mathcal{G}_{\\mathcal{A}}$: right-handed, with axes $\\hat{x}_{\\mathcal{A}}$ (anterior), $\\hat{y}_{\\mathcal{A}}$ (subject's left), and $\\hat{z}_{\\mathcal{A}}$ (superior).\n- Global frame $\\mathcal{G}_{\\mathcal{B}}$: $\\hat{x}_{\\mathcal{B}} = \\hat{x}_{\\mathcal{A}}$, $\\hat{y}_{\\mathcal{B}} = -\\hat{y}_{\\mathcal{A}}$, and $\\hat{z}_{\\mathcal{B}} = \\hat{z}_{\\mathcal{A}}$.\n- Segment frame $\\mathcal{S}$ is identical for both labs.\n- Convention: column vectors, passive rotations.\n- Property of DCM for a physically valid right-handed coordinate transformation: orthonormal with determinant $+1$.\n- A static trial in lab $\\mathcal{B}$ involves a pure axial rotation about the superior axis ($z$-axis of $\\mathcal{G}_{\\mathcal{A}}$) by an angle $\\phi$.\n- Reported DCM from lab $\\mathcal{B}$ is:\n$$\nR_{\\mathcal{B}} = \\begin{pmatrix}\n\\frac{\\sqrt{3}}{2} & -\\frac{1}{2} & 0 \\\\\n-\\frac{1}{2} & -\\frac{\\sqrt{3}}{2} & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix}.\n$$\n- Tasks:\n  1. Justify and apply a detection criterion for a sign-convention inconsistency using $R_{\\mathcal{B}}$.\n  2. Derive the axis-flip matrix $F_{y}$ that maps vectors from $\\mathcal{G}_{\\mathcal{A}}$ to $\\mathcal{G}_{\\mathcal{B}}$.\n  3. Construct the corrected DCM $R_{\\mathcal{A}}$.\n  4. Identify the signed yaw angle $\\phi$ in radians.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, operating within the established principles of kinematics and linear algebra. It describes a realistic scenario in biomechanics where different laboratory standards for coordinate systems must be reconciled. The given information is self-contained and sufficient for a solution. The frame definitions are precise: $\\mathcal{G}_{\\mathcal{A}}$ is a right-handed system. The frame $\\mathcal{G}_{\\mathcal{B}}$ is constructed by flipping one axis of $\\mathcal{G}_{\\mathcal{A}}$ ($\\hat{y}_{\\mathcal{B}} = -\\hat{y}_{\\mathcal{A}}$), which makes $\\mathcal{G}_{\\mathcal{B}}$ a left-handed system, since $\\hat{x}_{\\mathcal{B}} \\times \\hat{y}_{\\mathcal{B}} = \\hat{x}_{\\mathcal{A}} \\times (-\\hat{y}_{\\mathcal{A}}) = -(\\hat{x}_{\\mathcal{A}} \\times \\hat{y}_{\\mathcal{A}}) = -\\hat{z}_{\\mathcal{A}} = -\\hat{z}_{\\mathcal{B}}$. The problem is well-posed, objective, and does not violate any validation criteria.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A full solution will be provided.\n\n### Solution\nThe solution proceeds by addressing the three tasks specified in the problem statement.\n\n**Part 1: Inconsistency Detection Criterion and Application**\n\nA Direction Cosine Matrix (DCM) represents a coordinate transformation. The problem states that segment frames $\\mathcal{S}$ are standard, which implies they are right-handed. The global frame $\\mathcal{G}_{\\mathcal{A}}$ is explicitly defined as right-handed. A transformation between two right-handed coordinate systems is a pure rotation, represented by a proper orthogonal matrix, whose determinant is $+1$.\n\nThe global frame $\\mathcal{G}_{\\mathcal{B}}$ has basis vectors related to $\\mathcal{G}_{\\mathcal{A}}$ by $\\hat{x}_{\\mathcal{B}} = \\hat{x}_{\\mathcal{A}}$, $\\hat{y}_{\\mathcal{B}} = -\\hat{y}_{\\mathcal{A}}$, $\\hat{z}_{\\mathcal{B}} = \\hat{z}_{\\mathcal{A}}$. This constitutes a reflection of the $y$-axis, changing the system's handedness from right to left. A transformation from a right-handed frame ($\\mathcal{S}$) to a left-handed frame ($\\mathcal{G}_{\\mathcal{B}}$) is a rotoreflection (a rotation followed by a reflection). Such a transformation is represented by an improper orthogonal matrix, whose determinant is $-1$.\n\nTherefore, the detection criterion for the sign-convention inconsistency is to compute the determinant of the reported DCM, $R_{\\mathcal{B}}$. If $\\det(R_{\\mathcal{B}}) = -1$, it confirms that the target frame $\\mathcal{G}_{\\mathcal{B}}$ has a different handedness than the source frame $\\mathcal{S}$, which is the described inconsistency.\n\nApplying this criterion to the given $R_{\\mathcal{B}}$:\n$$\n\\det(R_{\\mathcal{B}}) = \\det \\begin{pmatrix}\n\\frac{\\sqrt{3}}{2} & -\\frac{1}{2} & 0 \\\\\n-\\frac{1}{2} & -\\frac{\\sqrt{3}}{2} & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix}\n$$\nUsing cofactor expansion along the third row:\n$$\n\\det(R_{\\mathcal{B}}) = 1 \\cdot \\det \\begin{pmatrix} \\frac{\\sqrt{3}}{2} & -\\frac{1}{2} \\\\ -\\frac{1}{2} & -\\frac{\\sqrt{3}}{2} \\end{pmatrix} - 0 + 0 = \\left(\\frac{\\sqrt{3}}{2}\\right)\\left(-\\frac{\\sqrt{3}}{2}\\right) - \\left(-\\frac{1}{2}\\right)\\left(-\\frac{1}{2}\\right) = -\\frac{3}{4} - \\frac{1}{4} = -1.\n$$\nThe result $\\det(R_{\\mathcal{B}}) = -1$ confirms the presence of a sign-convention inconsistency, as predicted.\n\n**Part 2: Derivation of the Axis-Flip Matrix $F_{y}$ and $R_{\\mathcal{A}}$**\n\nThe matrix $F_{y}$ transforms the coordinates of a vector from frame $\\mathcal{G}_{\\mathcal{A}}$ to frame $\\mathcal{G}_{\\mathcal{B}}$. Let a physical vector $\\vec{v}$ have coordinate representations $v_{\\mathcal{A}} = (v_x, v_y, v_z)^T$ in frame $\\mathcal{G}_{\\mathcal{A}}$ and $v_{\\mathcal{B}}$ in frame $\\mathcal{G}_{\\mathcal{B}}$, such that $v_{\\mathcal{B}} = F_y v_{\\mathcal{A}}$.\nThe vector is given by $\\vec{v} = v_x \\hat{x}_{\\mathcal{A}} + v_y \\hat{y}_{\\mathcal{A}} + v_z \\hat{z}_{\\mathcal{A}}$.\nTo find its components in $\\mathcal{G}_{\\mathcal{B}}$, we substitute the basis vector relations: $\\hat{x}_{\\mathcal{A}}=\\hat{x}_{\\mathcal{B}}$, $\\hat{y}_{\\mathcal{A}}=-\\hat{y}_{\\mathcal{B}}$, $\\hat{z}_{\\mathcal{A}}=\\hat{z}_{\\mathcal{B}}$.\n$$\n\\vec{v} = v_x \\hat{x}_{\\mathcal{B}} + v_y (-\\hat{y}_{\\mathcal{B}}) + v_z \\hat{z}_{\\mathcal{B}} = v_x \\hat{x}_{\\mathcal{B}} - v_y \\hat{y}_{\\mathcal{B}} + v_z \\hat{z}_{\\mathcal{B}}.\n$$\nThe coordinates in frame $\\mathcal{G}_{\\mathcal{B}}$ are therefore $(v_x, -v_y, v_z)^T$. The matrix $F_y$ that performs this mapping is:\n$$\nF_y = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & -1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}.\n$$\nThis is a reflection matrix across the $xz$-plane.\n\nNow, we construct the corrected DCM $R_{\\mathcal{A}}$. We have the following relations:\n1. $v_{\\mathcal{G}_{\\mathcal{B}}} = R_{\\mathcal{B}} v_{\\mathcal{S}}$ (from lab $\\mathcal{B}$'s measurement)\n2. $v_{\\mathcal{G}_{\\mathcal{A}}} = R_{\\mathcal{A}} v_{\\mathcal{S}}$ (the desired DCM for lab $\\mathcal{A}$)\n3. $v_{\\mathcal{G}_{\\mathcal{B}}} = F_y v_{\\mathcal{G}_{\\mathcal{A}}}$ (the frame conversion)\n\nSubstitute (2) into (3): $v_{\\mathcal{G}_{\\mathcal{B}}} = F_y (R_{\\mathcal{A}} v_{\\mathcal{S}})$.\nEquating this with (1) gives $R_{\\mathcal{B}} v_{\\mathcal{S}} = (F_y R_{\\mathcal{A}}) v_{\\mathcal{S}}$. Since this holds for any $v_{\\mathcal{S}}$, the matrix relation is $R_{\\mathcal{B}} = F_y R_{\\mathcal{A}}$.\nTo find $R_{\\mathcal{A}}$, we pre-multiply by the inverse of $F_y$. The matrix $F_y$ is its own inverse, since $F_y F_y = I$. Thus, $F_y^{-1} = F_y$.\n$$\nR_{\\mathcal{A}} = F_y^{-1} R_{\\mathcal{B}} = F_y R_{\\mathcal{B}}\n$$\n$$\nR_{\\mathcal{A}} = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & -1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix}\n\\frac{\\sqrt{3}}{2} & -\\frac{1}{2} & 0 \\\\\n-\\frac{1}{2} & -\\frac{\\sqrt{3}}{2} & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix} = \\begin{pmatrix}\n\\frac{\\sqrt{3}}{2} & -\\frac{1}{2} & 0 \\\\\n\\frac{1}{2} & \\frac{\\sqrt{3}}{2} & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix}.\n$$\nAs a check, $\\det(R_{\\mathcal{A}}) = (\\frac{\\sqrt{3}}{2})(\\frac{\\sqrt{3}}{2}) - (-\\frac{1}{2})(\\frac{1}{2}) = \\frac{3}{4} + \\frac{1}{4} = 1$. The corrected DCM is a proper rotation matrix.\n\n**Part 3: Identification of the Signed Yaw Angle $\\phi$**\n\nThe problem states the segment underwent a \"pure axial rotation about the superior axis, with an unknown signed angle $\\phi$ about the $z$-axis of $\\mathcal{G}_{\\mathcal{A}}$.\" This corresponds to a yaw rotation. The elementary rotation matrix for a passive rotation by an angle $\\phi$ about the $z$-axis is:\n$$\nR_z(\\phi) = \\begin{pmatrix}\n\\cos(\\phi) & -\\sin(\\phi) & 0 \\\\\n\\sin(\\phi) & \\cos(\\phi) & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix}.\n$$\nThe problem's mention of a \"$z$-$y$-$x$ intrinsic sequence\" indicates that yaw is the first rotation in this sequence. For a \"pure axial rotation\", the subsequent pitch and roll angles are zero, so the total rotation is simply $R_z(\\phi)$.\nBy equating our derived $R_{\\mathcal{A}}$ with the general form $R_z(\\phi)$:\n$$\nR_{\\mathcal{A}} = \\begin{pmatrix}\n\\frac{\\sqrt{3}}{2} & -\\frac{1}{2} & 0 \\\\\n\\frac{1}{2} & \\frac{\\sqrt{3}}{2} & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix} = \\begin{pmatrix}\n\\cos(\\phi) & -\\sin(\\phi) & 0 \\\\\n\\sin(\\phi) & \\cos(\\phi) & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix}.\n$$\nComparing the corresponding elements yields a system of two equations:\n1. $\\cos(\\phi) = \\frac{\\sqrt{3}}{2}$\n2. $\\sin(\\phi) = \\frac{1}{2}$\n\nBoth equations are satisfied simultaneously by the angle $\\phi$ in the first quadrant. The unique principal value for $\\phi$ that satisfies these conditions is:\n$$\n\\phi = \\frac{\\pi}{6} \\text{ radians}.\n$$\nThis is the signed yaw angle.",
            "answer": "$$\\boxed{\\frac{\\pi}{6}}$$"
        },
        {
            "introduction": "Once kinematic data is represented in a well-defined anatomical frame, we can perform quantitative analyses that have clinical relevance. This computational exercise guides you through the process of analyzing a joint's trajectory with respect to a cardinal anatomical plane, a common task in clinical biomechanics. You will apply coordinate transformations and vector projections to quantify the planarity of motion during a gait trial, bridging the gap from abstract geometric principles to concrete, data-driven insights .",
            "id": "4163249",
            "problem": "You are given a discrete hip joint center trajectory recorded during a gait trial in a pelvis-attached Cartesian coordinate frame and a constant pelvis pose with respect to a global anatomical Cartesian coordinate frame. The global anatomical frame has unit axes $\\hat{\\mathbf{x}}_G$ (anterior), $\\hat{\\mathbf{y}}_G$ (superior), and $\\hat{\\mathbf{z}}_G$ (right). The sagittal plane is defined as the plane spanned by $\\hat{\\mathbf{x}}_G$ and $\\hat{\\mathbf{y}}_G$, with plane normal $\\mathbf{n}_s = \\hat{\\mathbf{z}}_G$. The pelvis frame has unit axes $\\hat{\\mathbf{x}}_P$, $\\hat{\\mathbf{y}}_P$, and $\\hat{\\mathbf{z}}_P$. The pelvis pose is defined by a constant rotation matrix $\\mathbf{R}_{GP}$ mapping pelvis-frame coordinates into the global frame, and a constant global origin offset vector $\\mathbf{o}_G$.\n\nUsing the following fundamental base:\n- The definition of a Cartesian coordinate transformation: a point $\\mathbf{p}_P$ expressed in the pelvis frame maps to global coordinates by $\\mathbf{p}_G = \\mathbf{R}_{GP}\\,\\mathbf{p}_P + \\mathbf{o}_G$.\n- The definition of velocity as the time derivative $\\mathbf{v}(t) = d\\mathbf{p}(t)/dt$, approximated numerically by finite differences for discrete time samples.\n- The Euclidean inner product and component decomposition of a vector onto a direction: the projection of a vector $\\mathbf{a}$ onto a unit direction $\\hat{\\mathbf{n}}$ has magnitude $\\mathbf{a}\\cdot \\hat{\\mathbf{n}}$ and vector $(\\mathbf{a}\\cdot \\hat{\\mathbf{n}})\\hat{\\mathbf{n}}$.\n- The definition of the projection of a point onto a plane as subtracting its component along the plane’s normal.\n- The geometric relationship between the angle formed by a vector and a plane and the vector’s component along the plane’s normal.\n\nImplement a program that, for each provided test case, performs the following computations:\n1. Transform the discrete pelvis-frame hip joint center trajectory $\\{\\mathbf{p}_P[k]\\}_{k=0}^{N-1}$, sampled at uniform interval $\\Delta t$, into the global frame $\\{\\mathbf{p}_G[k]\\}$ using the given $\\mathbf{R}_{GP}$ and $\\mathbf{o}_G$.\n2. Compute the tangent (velocity) vectors $\\{\\mathbf{v}_G[k]\\}$ at each time index by approximating $d\\mathbf{p}_G/dt$ using central differences for interior samples, and forward/backward differences for the first and last samples.\n3. Compute the projection $\\{\\mathbf{p}_{\\Pi}[k]\\}$ of $\\{\\mathbf{p}_G[k]\\}$ onto the sagittal plane by subtracting the component along $\\mathbf{n}_s$.\n4. Quantify the deviation angle sequence $\\{\\alpha[k]\\}$ between the tangent vectors and the sagittal plane, where $\\alpha[k]$ is defined as the angle between $\\mathbf{v}_G[k]$ and the plane. The angle unit must be radians. If $\\|\\mathbf{v}_G[k]\\| = 0$, define $\\alpha[k] = 0$ by convention.\n5. Aggregate the deviation angles by computing the root-mean-square deviation angle $\\alpha_{\\mathrm{rms}} = \\sqrt{\\frac{1}{N}\\sum_{k=0}^{N-1}\\alpha[k]^2}$ and the maximum deviation angle $\\alpha_{\\max} = \\max_{k}\\alpha[k]$ for each test case. Report both in radians.\n\nExpress distances in meters, time in seconds, and angles in radians. The sagittal plane normal in the global frame is $\\mathbf{n}_s = [0,0,1]^{\\top}$. All Euler angles are specified in radians, and the rotation matrix $\\mathbf{R}_{GP}$ is constructed from yaw-pitch-roll $(\\psi,\\theta,\\phi)$ using the $Z$-$Y$-$X$ extrinsic (equivalently $X$-$Y$-$Z$ intrinsic) convention: $\\mathbf{R}_{GP} = \\mathbf{R}_z(\\psi)\\,\\mathbf{R}_y(\\theta)\\,\\mathbf{R}_x(\\phi)$.\n\nTest suite of parameter values:\n- Test case $1$ (happy path): $N = 101$, $\\Delta t = 0.01\\,\\text{s}$, $\\mathbf{o}_G = [0,0,0]^{\\top}\\,\\text{m}$, $(\\psi,\\theta,\\phi) = (0.1,-0.05,0.02)\\,\\text{rad}$, frequency $f = 1.5\\,\\text{Hz}$, pelvis-frame trajectory defined by\n  $$\n  x_P(t) = 0.05\\,\\sin(2\\pi f t),\\quad y_P(t) = 0.04\\,\\cos(2\\pi f t),\\quad z_P(t) = 0.02\\,\\sin(4\\pi f t),\n  $$\n  for $t = k\\,\\Delta t$, $k = 0,\\ldots,N-1$.\n- Test case $2$ (pure sagittal motion): $N = 101$, $\\Delta t = 0.01\\,\\text{s}$, $\\mathbf{o}_G = [0.1,-0.05,0.0]^{\\top}\\,\\text{m}$, $(\\psi,\\theta,\\phi) = (0.2,0.0,0.0)\\,\\text{rad}$, $f = 1.0\\,\\text{Hz}$, pelvis-frame trajectory\n  $$\n  x_P(t) = 0.06\\,\\sin(2\\pi f t),\\quad y_P(t) = 0.05\\,\\cos(2\\pi f t),\\quad z_P(t) = 0.0.\n  $$\n- Test case $3$ (skewed pelvis frame): $N = 121$, $\\Delta t = 0.008\\,\\text{s}$, $\\mathbf{o}_G = [0.2,0.9,-0.1]^{\\top}\\,\\text{m}$, $(\\psi,\\theta,\\phi) = (0.6,0.3,-0.4)\\,\\text{rad}$, $f = 2.0\\,\\text{Hz}$, pelvis-frame trajectory\n  $$\n  x_P(t) = 0.04\\,\\sin(2\\pi f t),\\quad y_P(t) = 0.03\\,\\cos(2\\pi f t),\\quad z_P(t) = 0.015\\,\\sin(2\\pi f t) + 0.005\\,t.\n  $$\n- Test case $4$ (boundary with stationary segment): $N = 101$, $\\Delta t = 0.01\\,\\text{s}$, $\\mathbf{o}_G = [-0.1,0.1,0.1]^{\\top}\\,\\text{m}$, $(\\psi,\\theta,\\phi) = (-0.3,0.1,0.25)\\,\\text{rad}$, $f = 1.2\\,\\text{Hz}$. Define $T = (N-1)\\Delta t$. For $t \\leq 0.5\\,T$,\n  $$\n  x_P(t) = 0.05\\,\\sin(2\\pi f t),\\quad y_P(t) = 0.04\\,\\cos(2\\pi f t),\\quad z_P(t) = 0.01\\,\\sin(2\\pi f t).\n  $$\n  For $t > 0.5\\,T$, hold the pelvis-frame position constant at its value at $t = 0.5\\,T$ (stationary segment), yielding zero-velocity samples over the stationary interval.\n\nYour program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a two-element list of floats $[\\alpha_{\\mathrm{rms}},\\alpha_{\\max}]$ in radians. For example:\n$[\\,[\\alpha_{\\mathrm{rms}}^{(1)},\\alpha_{\\max}^{(1)}],\\,[\\alpha_{\\mathrm{rms}}^{(2)},\\alpha_{\\max}^{(2)}],\\,\\ldots\\,]$.",
            "solution": "The problem requires a quantitative analysis of a hip joint's motion relative to the sagittal plane of a global anatomical frame. This involves a sequence of well-defined kinematic and geometric calculations, which are outlined below.\n\nFirst, we establish the necessary coordinate frames. The global anatomical frame is a right-handed Cartesian system with axes $\\hat{\\mathbf{x}}_G$ (anterior), $\\hat{\\mathbf{y}}_G$ (superior), and $\\hat{\\mathbf{z}}_G$ (right). The sagittal plane is the plane spanned by $\\hat{\\mathbf{x}}_G$ and $\\hat{\\mathbf{y}}_G$; its normal vector is therefore $\\mathbf{n}_s = \\hat{\\mathbf{z}}_G = [0, 0, 1]^{\\top}$. The hip joint's trajectory is initially given as a set of discrete points $\\{\\mathbf{p}_P[k]\\}$ in a local pelvis frame.\n\nThe overall procedure involves transforming the trajectory into the global frame, computing its velocity, and then calculating the angle between the velocity vector at each instant and the global sagittal plane.\n\n**Step 1: Coordinate Transformation**\nThe transformation of a point $\\mathbf{p}_P$ from the pelvis frame to the global frame is given by the affine transformation:\n$$\n\\mathbf{p}_G = \\mathbf{R}_{GP}\\,\\mathbf{p}_P + \\mathbf{o}_G\n$$\nwhere $\\mathbf{o}_G$ is the constant origin offset vector and $\\mathbf{R}_{GP}$ is the constant rotation matrix mapping pelvis-frame orientation to the global frame. The problem specifies that $\\mathbf{R}_{GP}$ is constructed from a yaw-pitch-roll sequence of Euler angles $(\\psi, \\theta, \\phi)$ using the $Z$-$Y$-$X$ extrinsic convention. The resulting rotation matrix is the product of individual rotation matrices:\n$$\n\\mathbf{R}_{GP} = \\mathbf{R}_z(\\psi)\\,\\mathbf{R}_y(\\theta)\\,\\mathbf{R}_x(\\phi)\n$$\nwhere the elemental rotation matrices are:\n$$\n\\mathbf{R}_x(\\phi) = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & \\cos\\phi & -\\sin\\phi \\\\ 0 & \\sin\\phi & \\cos\\phi \\end{pmatrix}, \\quad\n\\mathbf{R}_y(\\theta) = \\begin{pmatrix} \\cos\\theta & 0 & \\sin\\theta \\\\ 0 & 1 & 0 \\\\ -\\sin\\theta & 0 & \\cos\\theta \\end{pmatrix}, \\quad\n\\mathbf{R}_z(\\psi) = \\begin{pmatrix} \\cos\\psi & -\\sin\\psi & 0 \\\\ \\sin\\psi & \\cos\\psi & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\nThis transformation is applied to each point $\\mathbf{p}_P[k]$ of the discrete trajectory to obtain the sequence of points $\\{\\mathbf{p}_G[k]\\}$ in the global anatomical frame.\n\n**Step 2: Velocity Computation**\nThe velocity vector $\\mathbf{v}_G(t)$ is the time derivative of the position vector $\\mathbf{p}_G(t)$. For a discrete trajectory $\\{\\mathbf{p}_G[k]\\}$ sampled at a uniform time interval $\\Delta t$, the derivative is approximated using finite differences. As specified, we use:\n- A first-order forward difference for the first sample ($k=0$):\n  $$\n  \\mathbf{v}_G[0] = \\frac{\\mathbf{p}_G[1] - \\mathbf{p}_G[0]}{\\Delta t}\n  $$\n- A first-order backward difference for the last sample ($k=N-1$):\n  $$\n  \\mathbf{v}_G[N-1] = \\frac{\\mathbf{p}_G[N-1] - \\mathbf{p}_G[N-2]}{\\Delta t}\n  $$\n- A second-order central difference for all interior samples ($0 < k < N-1$):\n  $$\n  \\mathbf{v}_G[k] = \\frac{\\mathbf{p}_G[k+1] - \\mathbf{p}_G[k-1]}{2\\Delta t}\n  $$\nThis procedure yields the discrete global velocity trajectory $\\{\\mathbf{v}_G[k]\\}$.\n\n**Step 3: Projection of Position onto the Sagittal Plane**\nThis step requires computing the orthogonal projection of each global position vector $\\mathbf{p}_G[k]$ onto the sagittal plane. The projection of a point onto a plane is found by subtracting its component along the plane's normal vector. Given the sagittal plane normal $\\mathbf{n}_s$, the projection $\\mathbf{p}_{\\Pi}[k]$ of $\\mathbf{p}_G[k]$ is:\n$$\n\\mathbf{p}_{\\Pi}[k] = \\mathbf{p}_G[k] - (\\mathbf{p}_G[k] \\cdot \\mathbf{n}_s)\\mathbf{n}_s\n$$\nThis calculation is executed as per the problem description, although the resulting projected trajectory $\\{\\mathbf{p}_{\\Pi}[k]\\}$ is not used in subsequent steps.\n\n**Step 4: Calculation of Deviation Angle**\nThe core task is to quantify the deviation of the motion from the sagittal plane. This is defined as the angle $\\alpha[k]$ between the velocity vector $\\mathbf{v}_G[k]$ and the sagittal plane itself. Geometrically, the angle $\\alpha$ between a vector and a plane is complementary to the angle $\\beta$ between the vector and the plane's normal vector, i.e., $\\alpha = \\frac{\\pi}{2} - \\beta$. This implies $\\sin(\\alpha) = \\cos(\\beta)$.\nThe cosine of the angle $\\beta$ can be found using the Euclidean inner product:\n$$\n\\cos(\\beta) = \\frac{|\\mathbf{v}_G[k] \\cdot \\mathbf{n}_s|}{\\|\\mathbf{v}_G[k]\\| \\|\\mathbf{n}_s\\|}\n$$\nSince $\\mathbf{n}_s$ is a unit vector ($\\|\\mathbf{n}_s\\|=1$) and $\\mathbf{v}_G[k] \\cdot \\mathbf{n}_s$ is the $z$-component $v_{G,z}[k]$ of the velocity vector, this simplifies to:\n$$\n\\sin(\\alpha[k]) = \\frac{|v_{G,z}[k]|}{\\|\\mathbf{v}_G[k]\\|}\n$$\nThe deviation angle $\\alpha[k]$ can thus be calculated as:\n$$\n\\alpha[k] = \\arcsin\\left(\\frac{|v_{G,z}[k]|}{\\|\\mathbf{v}_G[k]\\|}\\right)\n$$\nThis formula is valid for any non-zero velocity vector. By the stated convention, if $\\|\\mathbf{v}_G[k]\\| = 0$, the deviation angle is defined as $\\alpha[k] = 0$.\n\n**Step 5: Aggregation of Deviation Angles**\nFinally, the sequence of deviation angles $\\{\\alpha[k]\\}$ is summarized using two metrics:\n- The root-mean-square (RMS) deviation angle, which captures the typical magnitude of deviation throughout the trial:\n  $$\n  \\alpha_{\\mathrm{rms}} = \\sqrt{\\frac{1}{N}\\sum_{k=0}^{N-1}\\alpha[k]^2}\n  $$\n- The maximum deviation angle, which identifies the peak deviation from the sagittal plane:\n  $$\n  \\alpha_{\\max} = \\max_{k \\in \\{0, \\dots, N-1\\}} \\alpha[k]\n  $$\nThese two values, computed in radians, provide a concise summary of the trajectory's planarity for each test case. The overall algorithm proceeds by generating the specified trajectories, then applying these five steps in sequence.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the biomechanics problem for all test cases.\n    It orchestrates the calculation for each case and prints the final result.\n    \"\"\"\n\n    def build_rotation_matrix(psi, theta, phi):\n        \"\"\"\n        Constructs the rotation matrix R_GP from Z-Y-X extrinsic Euler angles.\n        R_GP = R_z(psi) @ R_y(theta) @ R_x(phi)\n        \n        Args:\n            psi (float): Yaw angle in radians.\n            theta (float): Pitch angle in radians.\n            phi (float): Roll angle in radians.\n        \n        Returns:\n            np.ndarray: The 3x3 rotation matrix.\n        \"\"\"\n        c1, s1 = np.cos(phi), np.sin(phi)\n        c2, s2 = np.cos(theta), np.sin(theta)\n        c3, s3 = np.cos(psi), np.sin(psi)\n\n        # Rotation matrix about x-axis\n        Rx = np.array([[1, 0, 0], [0, c1, -s1], [0, s1, c1]])\n        # Rotation matrix about y-axis\n        Ry = np.array([[c2, 0, s2], [0, 1, 0], [-s2, 0, c2]])\n        # Rotation matrix about z-axis\n        Rz = np.array([[c3, -s3, 0], [s3, c3, 0], [0, 0, 1]])\n\n        return Rz @ Ry @ Rx\n\n    def solve_case(params):\n        \"\"\"\n        Processes a single test case according to the problem statement.\n        \"\"\"\n        N, dt, o_G, euler_angles, f, trajectory_func = params\n        psi, theta, phi = euler_angles\n\n        # Generate time vector and pelvis-frame trajectory p_P\n        t = np.arange(N) * dt\n        p_P = trajectory_func(t, N, dt, f)\n\n        # Step 1: Transform p_P to global frame p_G\n        R_GP = build_rotation_matrix(psi, theta, phi)\n        # p_G = R_GP @ p_P.T transposed + o_G\n        p_G = (R_GP @ p_P.T).T + np.array(o_G)\n\n        # Step 2: Compute global velocity v_G using finite differences\n        v_G = np.gradient(p_G, dt, axis=0)\n\n        # Step 3: Project p_G onto sagittal plane (not used later but required)\n        n_s = np.array([0.0, 0.0, 1.0])\n        p_G_dot_n = np.dot(p_G, n_s)\n        p_Pi = p_G - np.outer(p_G_dot_n, n_s)\n        \n        # Step 4: Compute deviation angle alpha for each time sample\n        v_G_norm = np.linalg.norm(v_G, axis=1)\n        alpha = np.zeros(N)\n        \n        # Mask for non-zero velocity to avoid division by zero\n        non_zero_mask = v_G_norm > 1e-12\n        \n        if np.any(non_zero_mask):\n            v_G_z_masked = v_G[non_zero_mask, 2]\n            v_G_norm_masked = v_G_norm[non_zero_mask]\n            \n            # sin(alpha) = |v_G_z| / ||v_G||\n            sin_alpha = np.abs(v_G_z_masked) / v_G_norm_masked\n            \n            # Clip to handle floating point inaccuracies where sin_alpha > 1\n            sin_alpha = np.clip(sin_alpha, 0.0, 1.0)\n            alpha[non_zero_mask] = np.arcsin(sin_alpha)\n\n        # Step 5: Aggregate angles to get RMS and max deviation\n        alpha_rms = np.sqrt(np.mean(alpha**2))\n        alpha_max = np.max(alpha)\n        \n        return [alpha_rms, alpha_max]\n\n    # Trajectory generation functions for each test case\n    def traj_case1(t, N, dt, f):\n        x_P = 0.05 * np.sin(2 * np.pi * f * t)\n        y_P = 0.04 * np.cos(2 * np.pi * f * t)\n        z_P = 0.02 * np.sin(4 * np.pi * f * t)\n        return np.vstack([x_P, y_P, z_P]).T\n\n    def traj_case2(t, N, dt, f):\n        x_P = 0.06 * np.sin(2 * np.pi * f * t)\n        y_P = 0.05 * np.cos(2 * np.pi * f * t)\n        z_P = np.zeros_like(t)\n        return np.vstack([x_P, y_P, z_P]).T\n\n    def traj_case3(t, N, dt, f):\n        x_P = 0.04 * np.sin(2 * np.pi * f * t)\n        y_P = 0.03 * np.cos(2 * np.pi * f * t)\n        z_P = 0.015 * np.sin(2 * np.pi * f * t) + 0.005 * t\n        return np.vstack([x_P, y_P, z_P]).T\n\n    def traj_case4(t, N, dt, f):\n        T = (N - 1) * dt\n        split_time = 0.5 * T\n        \n        p_P = np.zeros((N, 3))\n        moving_mask = t = split_time\n        stationary_mask = ~moving_mask\n\n        # Calculate positions for the moving part of the trajectory\n        moving_t = t[moving_mask]\n        if moving_t.size > 0:\n            p_P[moving_mask, 0] = 0.05 * np.sin(2 * np.pi * f * moving_t)\n            p_P[moving_mask, 1] = 0.04 * np.cos(2 * np.pi * f * moving_t)\n            p_P[moving_mask, 2] = 0.01 * np.sin(2 * np.pi * f * moving_t)\n\n        # Hold the last calculated position for the stationary part\n        if np.any(stationary_mask):\n            last_moving_idx = np.where(moving_mask)[0][-1]\n            last_pos = p_P[last_moving_idx]\n            p_P[stationary_mask] = last_pos\n\n        return p_P\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, dt, o_G, euler, f, traj_func)\n        (101, 0.01, [0, 0, 0], (0.1, -0.05, 0.02), 1.5, traj_case1),\n        (101, 0.01, [0.1, -0.05, 0.0], (0.2, 0.0, 0.0), 1.0, traj_case2),\n        (121, 0.008, [0.2, 0.9, -0.1], (0.6, 0.3, -0.4), 2.0, traj_case3),\n        (101, 0.01, [-0.1, 0.1, 0.1], (-0.3, 0.1, 0.25), 1.2, traj_case4)\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = solve_case(case_params)\n        results.append(result)\n\n    # Format the final list of results into the required string format.\n    # str([a, b]) produces '[a, b]', and joining these with commas gives\n    # '[a, b],[c, d]'. The outer brackets are added by the f-string.\n    results_str = \",\".join(map(str, results))\n    \n    # Final print statement in the exact required format.\n    print(f\"[{results_str}]\")\n\nsolve()\n```"
        }
    ]
}