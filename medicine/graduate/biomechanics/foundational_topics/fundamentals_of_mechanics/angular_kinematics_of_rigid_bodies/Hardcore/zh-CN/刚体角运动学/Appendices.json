{
    "hands_on_practices": [
        {
            "introduction": "在生物力学分析中，我们经常从运动捕捉系统获得旋转矩阵。为了直观地理解运动，例如确定旋转轴和旋转量，我们必须将这种矩阵转换为轴角表示法。这项练习  将挑战你从第一性原理出发，推导并应用这种转换，并特别关注在接近180度旋转时出现的数值稳定性问题——这在关节运动中很常见。",
            "id": "4153714",
            "problem": "一个运动捕捉系统采集了在前臂快速旋前运动中，前臂段相对于肱骨的方位。该方位被重构为一个三维特殊正交群（SO(3)）中的刚体旋转矩阵。测得的旋转矩阵为\n$$\nR \\;=\\;\n\\begin{pmatrix}\n-0.7777773333  0.4437776666  0.4451110000 \\\\\n\\;\\;0.4451110000  -0.1111108333  0.8885553334 \\\\\n\\;\\;0.4437776666  0.8892220000  -0.1111108333\n\\end{pmatrix}.\n$$\n仅使用刚体角运动学的第一性原理以及表征旋转矩阵和轴角表示的核心定义，推导该旋转的轴角描述。您的推导必须从旋转矩阵的性质以及通过叉积（斜对称）算子的矩阵指数生成旋转的单位轴和角度的存在性出发，并且必须从这些基础出发来论证您使用的任何恒等式。然后，从给定的矩阵中数值计算旋转角和单位轴，注意在旋转角接近 $0$ 或 $\\pi$ 的情况下使用数值稳定的方法。为消除轴方向的歧义，选择 $z$ 分量 $u_{z} > 0$ 的轴。将轴的每个分量和角度四舍五入到六位有效数字。角度以弧度表示。以单行向量的形式提供您的最终答案，其中包含轴分量和角度，顺序为 $u_{x}$, $u_{y}$, $u_{z}$, $\\theta$。",
            "solution": "问题要求从第一性原理出发，由给定的旋转矩阵 $R$ 推导出轴角表示 $(\\mathbf{u}, \\theta)$，然后为所提供的特定矩阵计算数值。推导过程必须是稳健的，尤其是在角度 $\\theta$ 接近 $0$ 或 $\\pi$ 的数值敏感区域。\n\n### 第一步：问题验证\n\n**1.1. 提取已知条件**\n- 研究对象是前臂段相对于肱骨的方位。\n- 该方位由一个旋转矩阵 $R \\in SO(3)$ 表示：\n$$\nR \\;=\\;\n\\begin{pmatrix}\n-0.7777773333  0.4437776666  0.4451110000 \\\\\n\\;\\;0.4451110000  -0.1111108333  0.8885553334 \\\\\n\\;\\;0.4437776666  0.8892220000  -0.1111108333\n\\end{pmatrix}\n$$\n- 推导必须从旋转的矩阵指数定义开始。\n- 最终的轴角描述必须进行数值计算。\n- 对于接近 $0$ 或 $\\pi$ 的角度，需要采用数值稳定的方法。\n- 轴方向的歧义必须通过选择 $z$ 分量为正 ($u_z > 0$) 的轴 $\\mathbf{u}$ 来解决。\n- 轴分量和角度（以弧度为单位）的最终数值结果必须四舍五入到六位有效数字。\n- 最终答案的格式是一个行向量 $[u_x, u_y, u_z, \\theta]$。\n\n**1.2. 使用已知条件进行验证**\n- **科学依据**：该问题在应用于机器人学和生物力学的刚体运动学和李群理论原理方面有很好的基础。使用 $SO(3)$ 矩阵、轴角表示和矩阵指数是标准做法。需要对矩阵 $R$ 进行初步检查。一个理想的旋转矩阵必须是正交的（$R^TR = I$）并且行列式为 $+1$。\n让我们检查迹：$Tr(R) = -0.7777773333 - 0.1111108333 - 0.1111108333 = -0.999999$。由于 $Tr(R) = 1 + 2\\cos(\\theta)$，这意味着 $\\cos(\\theta) \\approx -1$，即旋转角 $\\theta$ 非常接近 $\\pi$。这是一个已知的数值敏感情况，问题明确要求处理。矩阵元素看起来与大约 $\\pi$ 弧度的旋转一致。当角度不完全是 $\\pi$ 时，轻微的不对称性（例如，$R_{12} \\neq R_{21}$）是噪声数据或有限精度算术的预期结果。该问题在科学上是合理的。\n- **适定性**：对于给定的 $R \\in SO(3)$，存在一个轴角表示。按照惯例，$\\theta$ 被限制在 $[0, \\pi]$ 范围内。这使得角度是唯一的。对于 $\\theta \\in (0, \\pi)$，轴 $\\mathbf{u}$ 是唯一的。对于 $\\theta=\\pi$，$\\mathbf{u}$ 和 $-\\mathbf{u}$ 产生相同的旋转。问题指定了一个条件（$u_z > 0$）来解决这种歧义，确保了唯一解。该问题是适定的。\n- **客观性**：语言精确、技术性强，没有任何主观陈述。\n\n**1.3. 结论与行动**\n该问题是有效的。它具有科学依据、适定性和客观性。将提供完整的解答。\n\n### 第二步：从第一性原理推导\n\n三维欧几里得空间中的旋转是一种保持距离和方向的线性变换。这种变换可以用一个 $3 \\times 3$ 的特殊正交矩阵 $R \\in SO(3)$ 来描述，即 $R^T R = I$ 且 $\\det(R) = 1$。根据欧拉旋转定理，任何此类旋转都有一个固定轴。设该轴由单位向量 $\\mathbf{u}$ 表示。那么，旋转就是将点围绕该轴 $\\mathbf{u}$ 旋转一个角度 $\\theta$。\n\n轴角表示 $(\\mathbf{u}, \\theta)$ 与旋转矩阵 $R$ 之间的关系由矩阵指数给出：\n$$\nR = \\exp([\\mathbf{u}]_\\times \\theta)\n$$\n其中 $[\\mathbf{u}]_\\times$ 是与向量 $\\mathbf{u} = [u_x, u_y, u_z]^T$ 的叉积运算相对应的斜对称矩阵：\n$$\n[\\mathbf{u}]_\\times = \\begin{pmatrix} 0  -u_z  u_y \\\\ u_z  0  -u_x \\\\ -u_y  u_x  0 \\end{pmatrix}\n$$\n矩阵指数由其泰勒级数展开定义：\n$$\nR = \\exp([\\mathbf{u}]_\\times \\theta) = \\sum_{k=0}^{\\infty} \\frac{(\\theta [\\mathbf{u}]_\\times)^k}{k!} = I + \\theta [\\mathbf{u}]_\\times + \\frac{\\theta^2}{2!} [\\mathbf{u}]_\\times^2 + \\frac{\\theta^3}{3!} [\\mathbf{u}]_\\times^3 + \\dots\n$$\n为了对该级数求和，我们研究 $[\\mathbf{u}]_\\times$ 的幂。对于任意向量 $\\mathbf{v}$，$[\\mathbf{u}]_\\times \\mathbf{v} = \\mathbf{u} \\times \\mathbf{v}$。使用向量三重积恒等式 $\\mathbf{a} \\times (\\mathbf{b} \\times \\mathbf{c}) = \\mathbf{b}(\\mathbf{a} \\cdot \\mathbf{c}) - \\mathbf{c}(\\mathbf{a} \\cdot \\mathbf{b})$，我们求出 $[\\mathbf{u}]_\\times^2$ 的作用：\n$$\n[\\mathbf{u}]_\\times^2 \\mathbf{v} = \\mathbf{u} \\times (\\mathbf{u} \\times \\mathbf{v}) = \\mathbf{u}(\\mathbf{u} \\cdot \\mathbf{v}) - \\mathbf{v}(\\mathbf{u} \\cdot \\mathbf{u})\n$$\n由于 $\\mathbf{u}$ 是单位向量，$\\mathbf{u} \\cdot \\mathbf{u} = |\\mathbf{u}|^2 = 1$。并且，$\\mathbf{u} \\cdot \\mathbf{v} = \\mathbf{u}^T \\mathbf{v}$。因此：\n$$\n[\\mathbf{u}]_\\times^2 \\mathbf{v} = \\mathbf{u}(\\mathbf{u}^T \\mathbf{v}) - \\mathbf{v} = (\\mathbf{u}\\mathbf{u}^T)\\mathbf{v} - I\\mathbf{v} = (\\mathbf{u}\\mathbf{u}^T - I)\\mathbf{v}\n$$\n这对任何向量 $\\mathbf{v}$ 都成立，所以我们建立了矩阵恒等式 $[\\mathbf{u}]_\\times^2 = \\mathbf{u}\\mathbf{u}^T - I$。\n那么三次方为：\n$$\n[\\mathbf{u}]_\\times^3 = [\\mathbf{u}]_\\times ([\\mathbf{u}]_\\times^2) = [\\mathbf{u}]_\\times(\\mathbf{u}\\mathbf{u}^T - I) = [\\mathbf{u}]_\\times (\\mathbf{u}\\mathbf{u}^T) - [\\mathbf{u}]_\\times\n$$\n将 $[\\mathbf{u}]_\\times (\\mathbf{u}\\mathbf{u}^T)$ 项作用于向量 $\\mathbf{v}$，得到 $(\\mathbf{u} \\times \\mathbf{u})(\\mathbf{u}^T\\mathbf{v}) = \\mathbf{0}$。因此，$[\\mathbf{u}]_\\times (\\mathbf{u}\\mathbf{u}^T)$ 是零矩阵。这导致了循环性质：\n$$\n[\\mathbf{u}]_\\times^3 = -[\\mathbf{u}]_\\times\n$$\n更高次的幂遵循这个循环：$[\\mathbf{u}]_\\times^4 = -[\\mathbf{u}]_\\times^2$, $[\\mathbf{u}]_\\times^5 = [\\mathbf{u}]_\\times$，依此类推。我们现在可以对泰勒级数中的项进行分组：\n$$\nR = I + \\left(\\theta - \\frac{\\theta^3}{3!} + \\frac{\\theta^5}{5!} - \\dots\\right) [\\mathbf{u}]_\\times + \\left(\\frac{\\theta^2}{2!} - \\frac{\\theta^4}{4!} + \\frac{\\theta^6}{6!} - \\dots\\right) [\\mathbf{u}]_\\times^2\n$$\n括号中的级数分别是 $\\sin(\\theta)$ 和 $(1 - \\cos(\\theta))$ 的泰勒级数。这就得到了著名的罗德里格旋转公式：\n$$\nR = I + \\sin(\\theta) [\\mathbf{u}]_\\times + (1-\\cos(\\theta)) [\\mathbf{u}]_\\times^2\n$$\n\n### 第三步：提取角度和轴\n\n**3.1. 提取角度 $\\theta$**\n为了求角度 $\\theta$，我们取罗德里格公式的迹：\n$$\n\\mathrm{Tr}(R) = \\mathrm{Tr}(I) + \\sin(\\theta)\\mathrm{Tr}([\\mathbf{u}]_\\times) + (1-\\cos(\\theta))\\mathrm{Tr}([\\mathbf{u}]_\\times^2)\n$$\n矩阵的迹为：$\\mathrm{Tr}(I) = 3$，$\\mathrm{Tr}([\\mathbf{u}]_\\times) = 0$，以及 $\\mathrm{Tr}([\\mathbf{u}]_\\times^2) = \\mathrm{Tr}(\\mathbf{u}\\mathbf{u}^T - I) = \\mathrm{Tr}(\\mathbf{u}\\mathbf{u}^T) - \\mathrm{Tr}(I) = |\\mathbf{u}|^2 - 3 = 1-3 = -2$。\n代入这些值：\n$$\n\\mathrm{Tr}(R) = 3 + \\sin(\\theta)(0) + (1-\\cos(\\theta))(-2) = 3 - 2 + 2\\cos(\\theta) = 1 + 2\\cos(\\theta)\n$$\n由此，我们可以解出 $\\cos(\\theta)$：\n$$\n\\cos(\\theta) = \\frac{\\mathrm{Tr}(R) - 1}{2}\n$$\n然后可以通过 $\\theta = \\arccos\\left(\\frac{\\mathrm{Tr}(R) - 1}{2}\\right)$ 求出角度 $\\theta$。反余弦函数的范围 $[0, \\pi]$ 是旋转角的标准约定。\n\n**3.2. 提取轴 $\\mathbf{u}$**\n为了求轴 $\\mathbf{u}$，我们可以分离出 $R$ 的斜对称部分。\n$$\nR - R^T = (I + \\sin(\\theta) [\\mathbf{u}]_\\times + \\dots) - (I^T + \\sin(\\theta) [\\mathbf{u}]_\\times^T + \\dots)\n$$\n因为 $I^T = I$ 且 $[\\mathbf{u}]_\\times^T = -[\\mathbf{u}]_\\times$，并且 $([\\mathbf{u}]_\\times^2)^T = ([\\mathbf{u}]_\\times^T)^2 = (-[\\mathbf{u}]_\\times)^2 = [\\mathbf{u}]_\\times^2$（对称），我们得到：\n$$\nR - R^T = 2\\sin(\\theta) [\\mathbf{u}]_\\times = 2\\sin(\\theta)\\begin{pmatrix} 0  -u_z  u_y \\\\ u_z  0  -u_x \\\\ -u_y  u_x  0 \\end{pmatrix}\n$$\n如果 $\\sin(\\theta) \\neq 0$，这允许我们提取 $\\mathbf{u}$ 的分量：\n$$\nu_x = \\frac{R_{32} - R_{23}}{2\\sin(\\theta)}, \\quad u_y = \\frac{R_{13} - R_{31}}{2\\sin(\\theta)}, \\quad u_z = \\frac{R_{21} - R_{12}}{2\\sin(\\theta)}\n$$\n\n**3.3. 数值稳定性考虑**\n上述公式在两种情况下会变得数值不稳定：\n- **$\\theta \\approx 0$**：$\\sin(\\theta) \\approx 0$ 且 $R \\approx I$。轴的定义不明确，$\\mathbf{u}$ 的公式涉及 $0/0$ 型不定式。\n- **$\\theta \\approx \\pi$**：$\\sin(\\theta) \\approx 0$。同样，$\\mathbf{u}$ 的公式不稳定。本问题就属于这种情况。\n\n对于 $\\theta \\approx \\pi$ 的情况，我们必须使用更稳定的方法。当 $\\theta=\\pi$ 时，我们有 $\\sin(\\pi)=0$ 和 $\\cos(\\pi)=-1$。罗德里格公式简化为：\n$$\nR = I + (1 - (-1))[\\mathbf{u}]_\\times^2 = I + 2[\\mathbf{u}]_\\times^2\n$$\n代入 $[\\mathbf{u}]_\\times^2 = \\mathbf{u}\\mathbf{u}^T - I$：\n$$\nR = I + 2(\\mathbf{u}\\mathbf{u}^T - I) = 2\\mathbf{u}\\mathbf{u}^T - I\n$$\n由此，我们可以解出对称矩阵 $\\mathbf{u}\\mathbf{u}^T$：\n$$\n\\mathbf{u}\\mathbf{u}^T = \\frac{1}{2}(R + I)\n$$\n$\\mathbf{u}\\mathbf{u}^T$ 的分量是 $u_i u_j$。对角线元素给出了轴分量的平方：\n$$\nu_x^2 = \\frac{1}{2}(R_{11} + 1), \\quad u_y^2 = \\frac{1}{2}(R_{22} + 1), \\quad u_z^2 = \\frac{1}{2}(R_{33} + 1)\n$$\n这使我们能够求出大小 $|u_x|, |u_y|, |u_z|$。相对符号可以从非对角线元素确定，例如 $u_x u_y = \\frac{1}{2}R_{12}$（在恰好 $\\theta=\\pi$ 时，$R$ 是对称的，所以 $R_{12}=R_{21}$）。当 $\\theta$ 仅接近 $\\pi$ 时，$R$ 是近似对称的。一种稳健的方法是找到幅度最大的分量（例如，从 $R$ 的最大对角元素），确定其值，然后使用像 $u_i u_j = \\frac{1}{4}(R_{ij} + R_{ji})$ 这样的非对角项来找到其他分量及其符号。然而，$R$ 的反对称部分虽然很小，却能清晰地提供轴分量的比率。设 $\\mathbf{v} = [R_{32}-R_{23}, R_{13}-R_{31}, R_{21}-R_{12}]^T$。那么 $\\mathbf{u} = \\mathbf{v}/|\\mathbf{v}|$。如果矩阵数据足够精确，这种方法出奇地有效，因为它直接从旋转的（小的）动态分量中提取轴方向。\n\n### 第四步：数值计算\n\n给定矩阵：\n$$\nR \\;=\\;\n\\begin{pmatrix}\n-0.7777773333  0.4437776666  0.4451110000 \\\\\n\\;\\;0.4451110000  -0.1111108333  0.8885553334 \\\\\n\\;\\;0.4437776666  0.8892220000  -0.1111108333\n\\end{pmatrix}\n$$\n\n**4.1. 计算角度 $\\theta$**\n首先，计算 $R$ 的迹：\n$$\n\\mathrm{Tr}(R) = -0.7777773333 - 0.1111108333 - 0.1111108333 = -0.9999990000\n$$\n现在，计算 $\\cos(\\theta)$：\n$$\n\\cos(\\theta) = \\frac{-0.9999990000 - 1}{2} = \\frac{-1.9999990000}{2} = -0.9999995000\n$$\n角度 $\\theta$ 为：\n$$\n\\theta = \\arccos(-0.9999995000) = 3.1405926538... \\text{ rad}\n$$\n四舍五入到六位有效数字，我们得到 $\\theta = 3.14059$ 弧度。\n\n**4.2. 计算轴 $\\mathbf{u}$**\n如前所述，$\\theta \\approx \\pi$，所以我们必须使用稳定的方法。我们从 $R$ 的反对称部分计算与 $\\mathbf{u}$ 成比例的向量的分量：\n$$\nR_{32} - R_{23} = 0.8892220000 - 0.8885553334 = 0.0006666666\n$$\n$$\nR_{13} - R_{31} = 0.4451110000 - 0.4437776666 = 0.0013333334\n$$\n$$\nR_{21} - R_{12} = 0.4451110000 - 0.4437776666 = 0.0013333334\n$$\n设 $\\mathbf{v} = [0.0006666666, 0.0013333334, 0.0013333334]^T$。分量的比率为：\n$$\n\\frac{v_y}{v_x} = \\frac{0.0013333334}{0.0006666666} \\approx 2.0000002 \\approx 2\n$$\n$$\n\\frac{v_z}{v_x} = \\frac{0.0013333334}{0.0006666666} \\approx 2.0000002 \\approx 2\n$$\n输入矩阵元素的高精度揭示了一个精确的整数比。轴向量与 $[1, 2, 2]^T$ 成比例。为了求单位向量 $\\mathbf{u}$，我们对该向量进行归一化：\n$$\n|\\,[1, 2, 2]\\,| = \\sqrt{1^2 + 2^2 + 2^2} = \\sqrt{1+4+4} = \\sqrt{9} = 3\n$$\n所以，两个可能的轴是 $\\mathbf{u}_a = [1/3, 2/3, 2/3]^T$ 和 $\\mathbf{u}_b = [-1/3, -2/3, -2/3]^T$。\n问题指定了约束条件 $u_z > 0$，这唯一地选择了 $\\mathbf{u}_a$。\n$$\n\\mathbf{u} = \\begin{pmatrix} 1/3 \\\\ 2/3 \\\\ 2/3 \\end{pmatrix} = \\begin{pmatrix} 0.333333... \\\\ 0.666666... \\\\ 0.666666... \\end{pmatrix}\n$$\n将分量四舍五入到六位有效数字：\n$u_x = 0.333333$\n$u_y = 0.666667$\n$u_z = 0.666667$\n\n### 第五步：最终答案汇编\n\n计算出的轴分量和角度，四舍五入到六位有效数字，为：\n- $u_x = 0.333333$\n- $u_y = 0.666667$\n- $u_z = 0.666667$\n- $\\theta = 3.14059$ rad\n\n按要求将它们表示为单行向量。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.333333  0.666667  0.666667  3.14059\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "计算两个身体节段之间的相对运动，例如膝关节的屈伸，是关节运动学的基石。这需要将两个节段的角速度相减。一个常见且关键的错误是使用在不同坐标系中表示的向量直接进行减法运算。这项练习  提供了一个具体的场景来展示这个陷阱，并指导你完成将向量转换到同一坐标系下再进行算术运算的正确步骤。",
            "id": "4153655",
            "problem": "人体膝关节被建模为一个旋转关节，连接近端大腿段和远端小腿段。实验室坐标系 (LAB) 具有固定在空间中的标准正交基向量。大腿段附带一个局部标准正交坐标系，记为 $T$，小腿段附带一个局部标准正交坐标系，记为 $S$。在一次动态试验的某个特定时刻，这些分段坐标系相对于 LAB 的方向是绕 LAB $z$ 轴的纯旋转：\n- 大腿坐标系 $T$ 绕 LAB $z$ 轴旋转了 $30^{\\circ}$。\n- 小腿坐标系 $S$ 绕 LAB $z$ 轴旋转了 $75^{\\circ}$。\n\n刚体的角速度是一个与坐标系无关的矢量，但其坐标表示取决于所选择的基。在所考虑的时刻，动作捕捉估计提供了各分段的以下角速度矢量，每个都在其自身的局部坐标系中表示：\n- 在 $T$ 中表示的大腿角速度：$\\boldsymbol{\\omega}_{T}^{T} = \\begin{pmatrix} 0.10 \\\\ 1.20 \\\\ 0.05 \\end{pmatrix}$，单位为 $\\mathrm{rad/s}$。\n- 在 $S$ 中表示的小腿角速度：$\\boldsymbol{\\omega}_{S}^{S} = \\begin{pmatrix} 0.20 \\\\ 1.80 \\\\ 0.04 \\end{pmatrix}$，单位为 $\\mathrm{rad/s}$。\n\n膝关节的屈伸轴与大腿坐标系 $T$ 的 $y$ 轴对齐，因此标量膝关节屈伸速率是小腿相对于大腿的相对角速度在 $T$ 坐标系 $y$ 轴上的投影。\n\n一种常见但错误的做法是直接减去 $\\boldsymbol{\\omega}_{S}^{S}$ 和 $\\boldsymbol{\\omega}_{T}^{T}$ 的 $y$ 分量，尽管这些分量是在不同坐标系中表示的。这种混合坐标系的做法会得出一个不正确的关节速率估计值。\n\n请使用刚体运动学的基本原理，在相减之前将所有角速度矢量在单一、一致的坐标系中表示，从而确定此刻校正后的标量膝关节屈伸角速度。将最终结果保留四位有效数字，并以 $\\mathrm{rad/s}$ 为单位表示。",
            "solution": "这个问题是有效的，因为它在科学上基于刚体运动学原理，数据充分且一致，问题陈述客观适定。因此我们可以进行求解。\n\n问题的核心是计算小腿与大腿之间的相对角速度，然后求其沿膝关节屈伸轴的分量。小腿段 ($S$) 相对于大腿段 ($T$) 的相对角速度的基本方程如下：\n$$\n\\boldsymbol{\\omega}_{S/T} = \\boldsymbol{\\omega}_{S} - \\boldsymbol{\\omega}_{T}\n$$\n此处，$\\boldsymbol{\\omega}_{S}$ 和 $\\boldsymbol{\\omega}_{T}$ 分别是小腿和大腿的绝对角速度。矢量代数的一个关键原则是，只有当矢量的分量在同一坐标系中表示时，才能进行矢量减法。\n\n问题指出，膝关节屈伸轴与大腿坐标系 $T$ 的 $y$ 轴对齐。设此轴由单位向量 $\\hat{y}_T$ 表示。我们记为 $\\omega_{flex/ext}$ 的标量膝关节屈伸角速度，是相对角速度矢量 $\\boldsymbol{\\omega}_{S/T}$ 在该轴上的投影。这通过点积计算：\n$$\n\\omega_{flex/ext} = \\boldsymbol{\\omega}_{S/T} \\cdot \\hat{y}_T\n$$\n为了计算此点积，最方便的方法是将两个矢量都在大腿坐标系 $T$ 的坐标中表示。在此坐标系中，单位向量 $\\hat{y}_T$ 有一个简单的表示：\n$$\n(\\hat{y}_T)^T = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n在坐标系 $T$ 中表示的相对角速度为 $\\boldsymbol{\\omega}_{S/T}^T = \\boldsymbol{\\omega}_{S}^T - \\boldsymbol{\\omega}_{T}^T$。因此，点积成为相对角速度矢量在 $T$ 坐标系中的第二个分量（$y$ 分量）：\n$$\n\\omega_{flex/ext} = (\\boldsymbol{\\omega}_{S}^T - \\boldsymbol{\\omega}_{T}^T) \\cdot (\\hat{y}_T)^T = (\\boldsymbol{\\omega}_{S}^T)_y - (\\boldsymbol{\\omega}_{T}^T)_y\n$$\n我们已知在大腿自身坐标系 $T$ 中表示的角速度：\n$$\n\\boldsymbol{\\omega}_{T}^{T} = \\begin{pmatrix} 0.10 \\\\ 1.20 \\\\ 0.05 \\end{pmatrix} \\, \\mathrm{rad/s}\n$$\n由此，我们直接得到 $(\\boldsymbol{\\omega}_{T}^T)_y = 1.20 \\, \\mathrm{rad/s}$。\n\n主要任务是确定 $(\\boldsymbol{\\omega}_{S}^T)_y$。我们已知在小腿自身坐标系 $S$ 中的角速度：\n$$\n\\boldsymbol{\\omega}_{S}^{S} = \\begin{pmatrix} 0.20 \\\\ 1.80 \\\\ 0.04 \\end{pmatrix} \\, \\mathrm{rad/s}\n$$\n为了求此矢量在坐标系 $T$ 中的分量，我们必须使用一个旋转矩阵 $R_{S \\to T}$ 进行坐标变换，该矩阵将坐标从坐标系 $S$ 映射到坐标系 $T$。\n$$\n\\boldsymbol{\\omega}_{S}^{T} = R_{S \\to T} \\boldsymbol{\\omega}_{S}^{S}\n$$\n旋转矩阵 $R_{S \\to T}$ 可以通过复合经过实验室 (LAB) 坐标系的旋转来确定。从 $S$ 到 $T$ 的变换等价于先从 $S$ 变换到 LAB，然后再从 LAB 变换到 $T$：\n$$\nR_{S \\to T} = R_{L \\to T} R_{S \\to L}\n$$\n问题指出，分段坐标系是通过绕 LAB $z$ 轴的纯旋转来定向的。一个坐标系绕其父坐标系的 $z$ 轴旋转角度 $\\theta$，对应于一个从旋转后坐标系到父坐标系的坐标变换矩阵 $R_z(\\theta)$。\n$$\nR_z(\\theta) = \\begin{pmatrix} \\cos\\theta  -\\sin\\theta  0 \\\\ \\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n大腿坐标系 $T$ 相对于 LAB 旋转了 $\\theta_T = 30^{\\circ}$，因此从 $T$ 到 LAB 的变换是 $R_{T \\to L} = R_z(\\theta_T)$。其逆变换，即从 LAB 到 $T$，是该矩阵的转置：$R_{L \\to T} = (R_{T \\to L})^T = R_z(-\\theta_T)$。\n\n小腿坐标系 $S$ 相对于 LAB 旋转了 $\\theta_S = 75^{\\circ}$，因此从 $S$ 到 LAB 的变换是 $R_{S \\to L} = R_z(\\theta_S)$。\n\n将这些代入 $R_{S \\to T}$ 的表达式中：\n$$\nR_{S \\to T} = R_z(-\\theta_T) R_z(\\theta_S)\n$$\n由于绕同一轴的旋转是可加的，这可以简化为：\n$$\nR_{S \\to T} = R_z(\\theta_S - \\theta_T)\n$$\n我们计算相对角度 $\\Delta\\theta = \\theta_S - \\theta_T = 75^{\\circ} - 30^{\\circ} = 45^{\\circ}$。因此，所需的旋转矩阵是：\n$$\nR_{S \\to T} = R_z(45^{\\circ}) = \\begin{pmatrix} \\cos(45^{\\circ})  -\\sin(45^{\\circ})  0 \\\\ \\sin(45^{\\circ})  \\cos(45^{\\circ})  0 \\\\ 0  0  1 \\end{pmatrix} = \\begin{pmatrix} \\frac{\\sqrt{2}}{2}  -\\frac{\\sqrt{2}}{2}  0 \\\\ \\frac{\\sqrt{2}}{2}  \\frac{\\sqrt{2}}{2}  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n现在我们可以计算矢量 $\\boldsymbol{\\omega}_{S}^T$：\n$$\n\\boldsymbol{\\omega}_{S}^{T} = \\begin{pmatrix} \\frac{\\sqrt{2}}{2}  -\\frac{\\sqrt{2}}{2}  0 \\\\ \\frac{\\sqrt{2}}{2}  \\frac{\\sqrt{2}}{2}  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} 0.20 \\\\ 1.80 \\\\ 0.04 \\end{pmatrix}\n$$\n我们只需要 $y$ 分量 $(\\boldsymbol{\\omega}_{S}^T)_y$，它可由矩阵-矢量乘积的第二行得到：\n$$\n(\\boldsymbol{\\omega}_{S}^T)_y = \\left(\\frac{\\sqrt{2}}{2}\\right)(0.20) + \\left(\\frac{\\sqrt{2}}{2}\\right)(1.80) = \\frac{\\sqrt{2}}{2} (0.20 + 1.80) = \\frac{\\sqrt{2}}{2} (2.00) = \\sqrt{2} \\, \\mathrm{rad/s}\n$$\n最后，我们可以计算标量膝关节屈伸角速度：\n$$\n\\omega_{flex/ext} = (\\boldsymbol{\\omega}_{S}^T)_y - (\\boldsymbol{\\omega}_{T}^T)_y = \\sqrt{2} - 1.20 \\, \\mathrm{rad/s}\n$$\n现在我们代入 $\\sqrt{2}$ 的数值，$\\sqrt{2} \\approx 1.41421356...$：\n$$\n\\omega_{flex/ext} \\approx 1.41421356 - 1.20 = 0.21421356 \\, \\mathrm{rad/s}\n$$\n按要求将结果保留四位有效数字，得到：\n$$\n\\omega_{flex/ext} \\approx 0.2142 \\, \\mathrm{rad/s}\n$$\n这个校正值考虑了大腿和小腿坐标系的相对方向，与直接减去不同坐标系分量的错误方法形成对比，后者的计算结果会是 $1.80 - 1.20 = 0.60 \\, \\mathrm{rad/s}$。",
            "answer": "$$\n\\boxed{0.2142}\n$$"
        },
        {
            "introduction": "从瞬时运动学到模拟随时间变化的运动，需要进行数值积分。然而，旋转空间$SO(3)$是一个弯曲的流形，而非平坦的欧几里得空间，这意味着像前向欧拉法这样的标准积分器将无法保持旋转矩阵的基本性质。这项练习  将邀请你亲身体验这种失效，并实现几何一致的积分方案，以正确地维持$SO(3)$的结构，这是对任何刚体进行动力学模拟的一项关键技能。",
            "id": "4153654",
            "problem": "在生物力学中，一个刚体节段在三维空间中旋转。其方向由一个旋转矩阵 $R(t)\\in \\mathbb{R}^{3\\times 3}$ 表示，其中 $R(t)\\in \\text{特殊正交群 (SO(3))}$，意味着 $R(t)^{\\top}R(t)=I$ 且 $\\det(R(t))=1$。角速度是一个向量 $\\omega(t)\\in\\mathbb{R}^3$，单位为弧度/秒。刚体方向的基本运动学关系表明，旋转矩阵的时间导数满足 $ \\dot{R}(t) = R(t)[\\omega(t)]_{\\times}$，其中 $[\\omega]_{\\times}$ 是斜对称叉乘矩阵，使得对于任意 $v\\in\\mathbb{R}^3$ 都有 $[\\omega]_{\\times}v = \\omega\\times v$。\n\n您将分析对此运动学方程进行朴素前向积分的后果，并设计能够保持 $R\\in \\text{SO(3)}$ 的数值方案。\n\n任务：\n\n1. 严格从基本运动学关系 $ \\dot{R} = R[\\omega]_{\\times}$ 出发，考虑一个大小为 $\\Delta t>0$ 的离散时间步和前向欧拉更新 $ R_{k+1} \\approx R_k + R_k[\\omega_k]_{\\times}\\Delta t$。证明即使 $R_k^{\\top}R_k=I$ 且 $[\\omega_k]_{\\times}^{\\top} = -[\\omega_k]_{\\times}$，此更新通常也会违反标准正交性。明确证明，在 $\\Delta t$ 的非平凡主导阶上，$R_{k+1}^{\\top}R_{k+1} \\neq I$，并且偏差的尺度与 $\\Delta t^2$ 相当。\n\n2. 构建一个数学上合理的到 $\\text{SO(3)}$ 上的收缩（retraction），该收缩可应用于前向欧拉步之后。您的收缩必须由一个适定且单位一致的操作来定义，该操作将一个通用的 $3\\times 3$ 矩阵 $M$ 映射到弗罗贝尼乌斯范数意义下最接近的 $R\\in \\text{SO(3)}$。您可以调用一个能产生正交因子的规范分解，然后强制要求 $\\det(R)=1$。用标准的线性代数运算清晰地指定该映射，确保最终的 $R$ 满足 $R^{\\top}R=I$ 且 $\\det(R)=1$。\n\n3. 从 $ \\dot{R} = R[\\omega]_{\\times}$ 推导出一个积分更新，通过使用斜对称生成元的矩阵指数，保证对于任何 $\\Delta t$，都有 $R_{k+1}\\in \\text{SO(3)}$。利用应用于斜对称矩阵的矩阵指数的性质，论证为什么此更新对所有步长都能保持标准正交性和单位行列式。\n\n4. 实现一个程序，对于一组具有恒定角速度的测试用例，使用三种方法从 $ R_0 = I$ 开始积分方向：\n   - 方法A：没有任何校正的朴素欧拉积分，\n   - 方法B：欧拉积分，并在每步之后进行到 $\\text{SO(3)}$ 上的收缩，\n   - 方法C：从连续时间运动学推导出的指数映射更新。\n\n对于每个测试用例，在 $N$ 步之后，为每种方法计算两个标量诊断指标：\n   - 标准正交性偏差 $ \\| R^{\\top}R - I\\|_F$，其中 $\\|\\cdot\\|_F$ 表示弗罗贝尼乌斯范数，\n   - 行列式绝对偏差 $ |\\det(R) - 1|$。\n\n角速度以弧度/秒表示，时间步以秒表示。角度必须是弧度。输出是无单位的浮点数。为保证报告时的数值稳定性，请将每个诊断指标四舍五入到 $10$ 位小数。\n\n测试套件：\n\n- 用例1 (正常路径): $\\omega = [0.5,\\,0.1,\\,-0.2]$ rad/s, $\\Delta t = 0.01$ s, $N = 100$。\n- 用例2 (边界：零运动): $\\omega = [0,\\,0,\\,0]$ rad/s, $\\Delta t = 0.05$ s, $N = 10$。\n- 用例3 (边缘：每步大旋转): $\\omega = [30.0,\\,0.0,\\,0.0]$ rad/s, $\\Delta t = 0.1$ s, $N = 5$。\n- 用例4 (边缘：小步长，高角速度): $\\omega = [10.0,\\,10.0,\\,10.0]$ rad/s, $\\Delta t = 0.001$ s, $N = 1000$。\n\n最终输出格式：\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的、由逗号分隔的列表的列表。对于每个测试用例，输出一个包含六个浮点数的列表，顺序为 $[\\text{A\\_orth},\\,\\text{A\\_det},\\,\\text{B\\_orth},\\,\\text{B\\_det},\\,\\text{C\\_orth},\\,\\text{C\\_det}]$，其中 $\\text{A\\_orth}$ 是方法A的标准正交性偏差，$\\text{A\\_det}$ 是方法A的行列式偏差，方法B和C以此类推。\n\n所需最终输出形状示例（此处的值为占位符）：\n$[[a_1,a_2,b_1,b_2,c_1,c_2],[a_1',a_2',b_1',b_2',c_1',c_2'],[...]]$。\n\n您的实现必须是一个完整的、可运行的程序，并且只能使用指定的运行时环境和库。",
            "solution": "该问题探讨了刚体方向的数值积分，这是从机器人学、航空航天工程到生物力学等领域的一项基本任务。方向由一个属于特殊正交群 $\\text{SO(3)}$ 的旋转矩阵 $R(t)$ 表示。这个群是一个可微流形，而不是向量空间，这意味着像前向欧拉法这样为欧几里得空间设计的标准数值积分方案，通常不经修改是无法直接应用的。这种朴素的方法无法保持 $\\text{SO(3)}$ 的定义属性，即标准正交性（$R^{\\top}R=I$）和单位行列式（$\\det(R)=1$），导致物理上无意义的误差累积。本分析验证并比较了三种数值方法：朴素的前向欧拉法、使用到 $\\text{SO(3)}$ 上的投影（收缩）的修正欧拉法，以及使用矩阵指数的几何内蕴方法。\n\n### 任务1：前向欧拉法分析\n\n基本运动学方程为 $\\dot{R}(t) = R(t)[\\omega(t)]_{\\times}$，其中 $R(t) \\in \\text{SO(3)}$，$\\omega(t) \\in \\mathbb{R}^3$ 是角速度，$[\\omega]_{\\times}$ 是叉乘算子的斜对称矩阵表示。\n\n从时间 $t_k$ 到 $t_{k+1} = t_k + \\Delta t$ 的离散时间前向欧拉更新表示为：\n$$\nR_{k+1} = R_k + \\dot{R}_k \\Delta t = R_k + R_k[\\omega_k]_{\\times}\\Delta t\n$$\n提出因子 $R_k$ 得：\n$$\nR_{k+1} = R_k(I + [\\omega_k]_{\\times}\\Delta t)\n$$\n其中 $I$ 是 $3 \\times 3$ 单位矩阵。\n\n为了研究此更新是否保持标准正交性，我们分析乘积 $R_{k+1}^{\\top}R_{k+1}$。我们假设在步长开始时的矩阵 $R_k$ 是完全标准正交的，即 $R_k \\in \\text{SO(3)}$ 因而有 $R_k^{\\top}R_k = I$。\n\n$$\nR_{k+1}^{\\top}R_{k+1} = \\left[R_k(I + [\\omega_k]_{\\times}\\Delta t)\\right]^{\\top} \\left[R_k(I + [\\omega_k]_{\\times}\\Delta t)\\right]\n$$\n使用性质 $(AB)^{\\top} = B^{\\top}A^{\\top}$：\n$$\nR_{k+1}^{\\top}R_{k+1} = (I + [\\omega_k]_{\\times}\\Delta t)^{\\top} R_k^{\\top}R_k (I + [\\omega_k]_{\\times}\\Delta t)\n$$\n代入 $R_k^{\\top}R_k = I$ 并使用斜对称性质 $[\\omega_k]_{\\times}^{\\top} = -[\\omega_k]_{\\times}$：\n$$\nR_{k+1}^{\\top}R_{k+1} = (I^{\\top} + ([\\omega_k]_{\\times}\\Delta t)^{\\top}) (I + [\\omega_k]_{\\times}\\Delta t) = (I - [\\omega_k]_{\\times}\\Delta t) (I + [\\omega_k]_{\\times}\\Delta t)\n$$\n展开乘积：\n$$\nR_{k+1}^{\\top}R_{k+1} = I^2 + I[\\omega_k]_{\\times}\\Delta t - [\\omega_k]_{\\times}\\Delta t I - ([\\omega_k]_{\\times}\\Delta t)([\\omega_k]_{\\times}\\Delta t)\n$$\n$$\nR_{k+1}^{\\top}R_{k+1} = I - [\\omega_k]_{\\times}^2 \\Delta t^2\n$$\n当且仅当 $R_{k+1}^{\\top}R_{k+1} = I$ 时，得到的矩阵 $R_{k+1}$ 才是标准正交的。这要求 $[\\omega_k]_{\\times}^2 \\Delta t^2 = 0$。由于 $\\Delta t > 0$，这只在 $[\\omega_k]_{\\times}=0$ 时成立，对应于零角速度 $\\omega_k=0$。对于任何非零旋转，$[\\omega_k]_{\\times} \\neq 0$，因此 $[\\omega_k]_{\\times}^2 \\neq 0$。所以，前向欧拉更新通常会违反标准正交性条件。\n\n与标准正交性的偏差为矩阵 $R_{k+1}^{\\top}R_{k+1} - I = -[\\omega_k]_{\\times}^2 \\Delta t^2$。此偏差为 $\\mathcal{O}(\\Delta t^2)$ 阶，表明满足标准正交性约束的误差与步长的平方成正比。证明完毕。\n\n### 任务2：到SO(3)上的收缩\n\n执行一个前向欧拉步后，$R_{k+1}^{\\text{Euler}} = R_k(I + [\\omega_k]_{\\times}\\Delta t)$，结果是一个矩阵 $M = R_{k+1}^{\\text{Euler}}$，它通常不在 $\\text{SO(3)}$ 中。收缩是一个将 $M$ 投影回 $\\text{SO(3)}$ 流形上的映射。我们寻求在弗罗贝尼乌斯范数意义下最接近 $M$ 的矩阵 $R \\in \\text{SO(3)}$，即最小化 $\\|R - M\\|_F$ 的矩阵。\n\n这是一个经典的正交普罗克汝斯忒斯问题（Orthogonal Procrustes problem）。其解可通过对 $M$ 进行奇异值分解（SVD）得到。设 $M$ 的SVD为：\n$$\nM = U\\Sigma V^{\\top}\n$$\n其中 $U, V \\in \\mathbb{R}^{3\\times3}$ 是正交矩阵（$U^{\\top}U = I$, $V^{\\top}V = I$），$\\Sigma$ 是包含 $M$ 的奇异值 $\\sigma_1 \\ge \\sigma_2 \\ge \\sigma_3 \\ge 0$ 的对角矩阵。\n\n最接近 $M$ 的正交矩阵是 $R_{ortho} = UV^{\\top}$。然而，这个矩阵的行列式可能为 $-1$，这将使其属于正交群 $\\text{O(3)}$ 而非特殊正交群 $\\text{SO(3)}$。我们必须强制要求 $\\det(R)=1$。\n\n在 $R \\in \\text{SO(3)}$ 的约束下，最大化 $\\text{tr}(R^{\\top}M)$ 的解由下式给出：\n$$\nR = U S V^{\\top}\n$$\n其中 $S$ 是一个对角矩阵，定义为 $S = \\text{diag}(1, 1, \\det(UV^{\\top}))$。\n\n我们来验证所得矩阵 $R$ 的性质：\n1.  **标准正交性**：我们必须检查是否 $R^{\\top}R = I$。\n    矩阵 $S$ 是对角矩阵，其对角元为 $1$ 或 $-1$（因为 $\\det(U), \\det(V) \\in \\{-1, 1\\}$，所以 $\\det(UV^{\\top}) \\in \\{-1, 1\\}$）。因此，$S^{\\top}S = S^2 = \\text{diag}(1^2, 1^2, (\\det(UV^{\\top}))^2) = I$。\n    $$\n    R^{\\top}R = (USV^{\\top})^{\\top}(USV^{\\top}) = V S^{\\top} U^{\\top} U S V^{\\top} = V S^{\\top} I S V^{\\top} = V S^2 V^{\\top} = V I V^{\\top} = I\n    $$\n    标准正交性被成功恢复。\n\n2.  **单位行列式**：我们必须检查是否 $\\det(R) = 1$。\n    使用性质 $\\det(ABC) = \\det(A)\\det(B)\\det(C)$：\n    $$\n    \\det(R) = \\det(U) \\det(S) \\det(V^{\\top}) = \\det(U) \\det(\\text{diag}(1, 1, \\det(UV^{\\top}))) \\det(V)\n    $$\n    $$\n    \\det(R) = \\det(U) (\\det(UV^{\\top})) \\det(V) = (\\det(U)\\det(V)) \\det(UV^{\\top}) = \\det(UV^{\\top}) \\det(UV^{\\top}) = (\\det(UV^{\\top}))^2 = 1\n    $$\n    行列式保证为 $1$。\n\n这个过程定义了一个从通用 $3 \\times 3$ 矩阵到 $\\text{SO(3)}$ 的有效收缩映射。步骤如下：\n1. 计算 $M = R_k + R_k[\\omega_k]_{\\times}\\Delta t$。\n2. 计算 $M$ 的SVD分解 $M = U\\Sigma V^{\\top}$。\n3. 构建 $R = U \\text{diag}(1, 1, \\det(UV^{\\top})) V^{\\top}$。\n\n### 任务3：指数映射更新\n\n一种更根本的方法是直接求解微分方程 $\\dot{R} = R[\\omega]_{\\times}$。如果我们假设角速度 $\\omega$ 在时间步 $\\Delta t$ 内是恒定的，即对于 $t \\in [t_k, t_{k+1}]$ 有 $\\omega(t) = \\omega_k$，则该方程变为一个常系数线性常微分方程。其解由矩阵指数给出：\n$$\nR(t) = R(t_k) \\exp([\\omega_k]_{\\times}(t-t_k))\n$$\n设 $t = t_{k+1} = t_k + \\Delta t$，我们得到更新规则：\n$$\nR_{k+1} = R_k \\exp([\\omega_k]_{\\times}\\Delta t)\n$$\n这个更新保证了能保持 $\\text{SO(3)}$ 结构。令 $A = [\\omega_k]_{\\times}\\Delta t$。由于 $[\\omega_k]_{\\times}$ 是斜对称的，矩阵 $A$ 也是斜对称的。我们需要证明如果 $R_k \\in \\text{SO(3)}$，则 $R_{k+1} \\in \\text{SO(3)}$。这需要证明更新矩阵 $\\Delta R_k = \\exp(A)$ 属于 $\\text{SO(3)}$。\n\n1.  **标准正交性**：矩阵指数的一个关键性质是，如果矩阵 $A$ 是斜对称的（$A^{\\top} = -A$），那么它的指数 $\\exp(A)$ 是一个正交矩阵。\n    **证明**：$(\\exp(A))^{\\top} = \\exp(A^{\\top}) = \\exp(-A)$。由于 $A$ 和 $-A$ 可交换，$\\exp(A)\\exp(-A) = \\exp(A-A) = \\exp(0) = I$。因此，$(\\exp(A))^{\\top}\\exp(A) = I$。矩阵 $\\exp(A)$ 是正交的。\n    因此，$R_{k+1}^{\\top}R_{k+1} = (R_k \\exp(A))^{\\top}(R_k \\exp(A)) = (\\exp(A))^{\\top}R_k^{\\top}R_k\\exp(A) = (\\exp(A))^{\\top}I\\exp(A) = I$。对于任意 $\\Delta t$，标准正交性都得以保持。\n\n2.  **单位行列式**：另一个性质，即雅可比公式（Jacobi's formula），表明 $\\det(\\exp(A)) = \\exp(\\text{tr}(A))$，其中 $\\text{tr}(A)$ 是矩阵 $A$ 的迹。\n    对于任何斜对称矩阵，其所有对角元素都必须为零。因此，$\\text{tr}(A) = \\text{tr}([\\omega_k]_{\\times}\\Delta t) = 0$。\n    因此，$\\det(\\exp(A)) = \\exp(0) = 1$。\n    更新后矩阵的行列式为 $\\det(R_{k+1}) = \\det(R_k \\exp(A)) = \\det(R_k)\\det(\\exp(A))$。假设 $\\det(R_k) = 1$，我们得到 $\\det(R_{k+1}) = 1 \\cdot 1 = 1$。\n\n指数映射更新内在地尊重 $\\text{SO(3)}$ 的几何结构，并为积分步内角速度恒定的情况提供了精确解。\n\n### 任务4：实现策略\n三种方法将按如下方式实现：\n- **方法A (朴素欧拉法)**：进行 $N$ 步更新 $R_{k+1} = R_k(I + [\\omega_k]_{\\times}\\Delta t)$。\n- **方法B (带收缩的欧拉法)**：每一步，计算朴素欧拉更新 $M = R_k(I + [\\omega_k]_{\\times}\\Delta t)$，然后使用任务2中推导的基于SVD的收缩将 $M$ 投影回 $\\text{SO(3)}$ 以得到 $R_{k+1}$。\n- **方法C (指数映射)**：进行 $N$ 步更新 $R_{k+1} = R_k \\exp([\\omega_k]_{\\times}\\Delta t)$，使用库函数计算矩阵指数。\n\n对于每种方法，将对最终矩阵 $R_N$ 进行标准正交性偏差 $\\|R_N^{\\top}R_N - I\\|_F$ 和行列式偏差 $|\\det(R_N) - 1|$ 的诊断。这些诊断指标量化了每种方法在保持 $\\text{SO(3)}$ 群属性方面的成败。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Solves the rigid body kinematics problem by comparing three numerical\n    integration methods for a set of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path\n        {'omega': np.array([0.5, 0.1, -0.2]), 'dt': 0.01, 'N': 100},\n        # Case 2: boundary: zero motion\n        {'omega': np.array([0.0, 0.0, 0.0]), 'dt': 0.05, 'N': 10},\n        # Case 3: edge: large rotation per step\n        {'omega': np.array([30.0, 0.0, 0.0]), 'dt': 0.1, 'N': 5},\n        # Case 4: edge: small step, high rate\n        {'omega': np.array([10.0, 10.0, 10.0]), 'dt': 0.001, 'N': 1000},\n    ]\n\n    all_results = []\n    for case in test_cases:\n        omega = case['omega']\n        dt = case['dt']\n        N = case['N']\n        \n        case_results = []\n\n        # --- Method A: Naive Euler ---\n        R_A = np.identity(3)\n        omega_skew = np.array([\n            [0, -omega[2], omega[1]],\n            [omega[2], 0, -omega[0]],\n            [-omega[1], omega[0], 0]\n        ])\n        for _ in range(N):\n            R_A = R_A @ (np.identity(3) + omega_skew * dt)\n        \n        ortho_dev_A = np.linalg.norm(R_A.T @ R_A - np.identity(3), 'fro')\n        det_dev_A = abs(np.linalg.det(R_A) - 1.0)\n        case_results.extend([round(ortho_dev_A, 10), round(det_dev_A, 10)])\n        \n        # --- Method B: Euler with Retraction ---\n        R_B = np.identity(3)\n        # omega_skew is the same as in Method A\n        for _ in range(N):\n            # Naive Euler step\n            M = R_B @ (np.identity(3) + omega_skew * dt)\n            \n            # Retraction using SVD\n            U, _, Vt = np.linalg.svd(M)\n            # Ensure proper rotation by fixing determinant\n            det_UVt = np.linalg.det(U @ Vt)\n            S = np.diag([1, 1, det_UVt])\n            R_B = U @ S @ Vt\n\n        ortho_dev_B = np.linalg.norm(R_B.T @ R_B - np.identity(3), 'fro')\n        det_dev_B = abs(np.linalg.det(R_B) - 1.0)\n        case_results.extend([round(ortho_dev_B, 10), round(det_dev_B, 10)])\n\n        # --- Method C: Exponential Map ---\n        R_C = np.identity(3)\n        # omega_skew is the same as in Method A\n        Delta_R = expm(omega_skew * dt)\n        for _ in range(N):\n            R_C = R_C @ Delta_R\n            \n        ortho_dev_C = np.linalg.norm(R_C.T @ R_C - np.identity(3), 'fro')\n        det_dev_C = abs(np.linalg.det(R_C) - 1.0)\n        case_results.extend([round(ortho_dev_C, 10), round(det_dev_C, 10)])\n\n        all_results.append(case_results)\n\n    # Format output as a list of lists string representation\n    # e.g., [[1, 2], [3, 4]] -> \"[[1, 2],[3, 4]]\"\n    output_str = f\"[{','.join(map(str, all_results))}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}