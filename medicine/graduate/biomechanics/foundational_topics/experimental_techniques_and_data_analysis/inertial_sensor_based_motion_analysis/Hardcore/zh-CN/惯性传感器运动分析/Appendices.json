{
    "hands_on_practices": [
        {
            "introduction": "原始的磁力计数据常常会因为周围的铁磁材料和传感器自身缺陷而失真。这个练习将指导您推导经典的椭球拟合算法，这是将失真的传感器读数转换为地球磁场干净测量的关键第一步。通过这个过程，您将学习如何对硬铁（hard-iron）和软铁（soft-iron）效应进行建模和校正 。",
            "id": "4180076",
            "problem": "一个嵌入在可穿戴惯性测量单元（IMU）中的三轴磁力计，用于在磁场均匀的室内环境中缓慢旋转时测量局部地磁场。设理想的、无量纲的、归一化的地磁场向量表示为 $m \\in \\mathbb{R}^{3}$，且 $|m| = 1$。在设备坐标系中，磁力计的测量模型为\n$$\nm_{m} = A\\,m + b_{m} + \\varepsilon,\n$$\n其中 $A \\in \\mathbb{R}^{3 \\times 3}$ 是一个未知的满秩矩阵，用于捕捉软铁失真和轴刻度/失准，$b_{m} \\in \\mathbb{R}^{3}$ 是一个未知的硬铁偏置，$\\varepsilon$ 是均值为零的测量噪声。假设旋转充分激励了所有方向，使得 $m$ 遍历了单位球面。\n\n1) 从上述模型和定义 $|m|=1$ 出发，证明在无噪声的情况下，测量值集合 $m_{m}$ 位于一个满足以下条件的椭球上\n$$\n\\left(m_{m} - b_{m}\\right)^{\\top} W \\left(m_{m} - b_{m}\\right) = 1,\n$$\n对于某个对称正定矩阵 $W \\in \\mathbb{R}^{3 \\times 3}$。用 $A$ 表示 $W$。\n\n2) 将椭球方程写成展开的二次型形式\n$$\nm_{m}^{\\top} Q\\, m_{m} + 2\\, q^{\\top} m_{m} + q_{0} = 0,\n$$\n其中 $Q \\in \\mathbb{R}^{3 \\times 3}$ 是对称的，$q \\in \\mathbb{R}^{3}$，$q_{0} \\in \\mathbb{R}$。为样本 $m_{m}^{(i)}$ 定义代数残差，并提出最小二乘问题，该问题在 $N$ 个样本上最小化代数残差的平方和，并受一个避免全零平凡解的归一化约束。显式地构建一个合适的线性设计矩阵和相应的广义特征值问题，其解可以得到 $\\left(Q, q, q_{0}\\right)$（相差一个非零尺度因子）。\n\n3) 给定一个拟合的三元组 $\\left(Q, q, q_{0}\\right)$，其中 $Q$ 是对称正定的，推导表达式以恢复中心椭球形式 $\\left(m_{m} - b_{m}\\right)^{\\top} W \\left(m_{m} - b_{m}\\right) = 1$ 中的硬铁偏置 $b_{m}$ 和形状矩阵 $W$。你的推导必须通过对代数拟合结果进行显式缩放来确保方程右侧为单位 1。然后，推导如何获得一个校准矩阵 $A$，使得校准后的测量值\n$$\nm_{c} \\triangleq A^{-1}\\left(m_{m} - b_{m}\\right)\n$$\n满足 $|m_{c}| = 1$，仅使用 $W$ 是对称正定的要求。基于 $W$ 的矩阵分解，给出一个唯一的 $A$ 选择。\n\n4) 现在考虑以下六个无噪声测量值（单位任意），这些值是通过保持设备，使真实场 $m$ 与设备轴的六个基本方向对齐而获得的。测得的向量为：\n$$\n\\begin{aligned}\n\\text{沿 } +x \\text{ 轴:}  m_{m}^{(1)} = \\begin{pmatrix} 1.25 \\\\ -0.02 \\\\ 0.03 \\end{pmatrix}, \\quad\n\\text{沿 } -x \\text{ 轴:}  m_{m}^{(2)} = \\begin{pmatrix} -1.15 \\\\ -0.02 \\\\ 0.03 \\end{pmatrix},\\\\\n\\text{沿 } +y \\text{ 轴:}  m_{m}^{(3)} = \\begin{pmatrix} 0.05 \\\\ 0.78 \\\\ 0.03 \\end{pmatrix}, \\quad\n\\text{沿 } -y \\text{ 轴:}  m_{m}^{(4)} = \\begin{pmatrix} 0.05 \\\\ -0.82 \\\\ 0.03 \\end{pmatrix},\\\\\n\\text{沿 } +z \\text{ 轴:}  m_{m}^{(5)} = \\begin{pmatrix} 0.05 \\\\ -0.02 \\\\ 1.03 \\end{pmatrix}, \\quad\n\\text{沿 } -z \\text{ 轴:}  m_{m}^{(6)} = \\begin{pmatrix} 0.05 \\\\ -0.02 \\\\ -0.97 \\end{pmatrix}.\n\\end{aligned}\n$$\n使用第 1-3 部分的推导，计算校准矩阵 $A$ 的行列式，其中 $A$ 选择为 $W$ 的 Cholesky 因子的逆矩阵。将你的最终答案表示为一个无量纲值，并四舍五入到四位有效数字。",
            "solution": "我们从仿射测量模型和二次型的基本原理出发。\n\n1) 测量模型为 $m_{m} = A m + b_{m} + \\varepsilon$。在无噪声情况 $\\varepsilon = 0$下，我们有 $m_{m} - b_{m} = A m$。左乘 $A^{-1}$ 得到 $A^{-1}\\left(m_{m} - b_{m}\\right) = m$。因为 $|m| = 1$，我们得到\n$$\n\\left\\|A^{-1}\\left(m_{m} - b_{m}\\right)\\right\\|^{2} = 1.\n$$\n等价地，\n$$\n\\left(m_{m} - b_{m}\\right)^{\\top} \\left(A^{-T} A^{-1}\\right) \\left(m_{m} - b_{m}\\right) = 1.\n$$\n因此，测量值集合 $m_{m}$ 位于一个椭球上，其形状矩阵为\n$$\nW = A^{-T} A^{-1},\n$$\n由于 $A$ 是满秩的，该矩阵是对称正定的。\n\n2) 任何中心椭球方程都可以写成展开的二次型形式\n$$\nm_{m}^{\\top} Q\\, m_{m} + 2\\, q^{\\top} m_{m} + q_{0} = 0,\n$$\n其中 $Q = Q^{\\top}$，$q \\in \\mathbb{R}^{3}$，$q_{0} \\in \\mathbb{R}$。对于一个给定的样本 $m_{m}^{(i)} \\in \\mathbb{R}^{3}$，代数残差为\n$$\nr_{i} \\triangleq \\left(m_{m}^{(i)}\\right)^{\\top} Q\\, m_{m}^{(i)} + 2\\, q^{\\top} m_{m}^{(i)} + q_{0}.\n$$\n对于 $N$ 个样本，我们将参数堆叠成一个向量 $\\theta \\in \\mathbb{R}^{10}$，代表 $Q$，$q$ 和 $q_{0}$ 的独立元素。一种方便的参数化映射为\n$$\n\\theta \\triangleq \\begin{pmatrix} q_{xx} & q_{yy} & q_{zz} & q_{yz} & q_{xz} & q_{xy} & q_{x} & q_{y} & q_{z} & q_{0} \\end{pmatrix}^{\\top},\n$$\n其中 $Q = \\begin{pmatrix} q_{xx} & q_{xy} & q_{xz} \\\\ q_{xy} & q_{yy} & q_{yz} \\\\ q_{xz} & q_{yz} & q_{zz} \\end{pmatrix}$ 且 $q = \\begin{pmatrix} q_{x} \\\\ q_{y} \\\\ q_{z} \\end{pmatrix}$。对于每个样本 $m_{m}^{(i)} = \\begin{pmatrix} x_{i} \\\\ y_{i} \\\\ z_{i} \\end{pmatrix}$，残差可以线性地表示为 $\\theta$ 的函数\n$$\nr_{i} = d_{i}^{\\top} \\theta,\n$$\n其中 $10 \\times 1$ 的数据向量为\n$$\nd_{i} \\triangleq \\begin{pmatrix} x_{i}^{2} \\\\ y_{i}^{2} \\\\ z_{i}^{2} \\\\ 2 y_{i} z_{i} \\\\ 2 x_{i} z_{i} \\\\ 2 x_{i} y_{i} \\\\ 2 x_{i} \\\\ 2 y_{i} \\\\ 2 z_{i} \\\\ 1 \\end{pmatrix}.\n$$\n将 $d_{i}^{\\top}$ 作为行堆叠起来，得到设计矩阵 $D \\in \\mathbb{R}^{N \\times 10}$。最小化代数残差平方和的最小二乘问题是\n$$\n\\min_{\\theta \\neq 0} \\; \\| D \\theta \\|_{2}^{2} \\quad \\text{受 } \\theta \\text{ 的归一化约束},\n$$\n以避免 $\\theta = 0$ 的平凡解。一种常见的归一化方法是对 $Q$ 块中与正定性相关的二次型施加约束；一种实用的选择是强制\n$$\n\\operatorname{trace}(Q) = 1,\n$$\n这可以写成线性约束 $c^{\\top} \\theta = 1$，其中 $c = \\begin{pmatrix} 1 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\end{pmatrix}^{\\top}$。使用拉格朗日乘子 $\\lambda$，约束最小化器满足 Karush–Kuhn–Tucker 条件\n$$\nD^{\\top} D \\, \\theta = \\lambda \\, c, \\quad c^{\\top} \\theta = 1.\n$$\n等价地，可以通过构建一个广义特征值问题来消除显式线性约束。定义一个对称约束矩阵 $C \\in \\mathbb{R}^{10 \\times 10}$，它对与 $Q$ 对应的左上角 $3 \\times 3$ 块的缩放进行惩罚，例如\n$$\nC \\triangleq \\operatorname{diag}(1, 1, 1, 0, 0, 0, 0, 0, 0, 0).\n$$\n然后求解\n$$\n\\left(D^{\\top} D\\right) \\theta = \\lambda \\, C \\, \\theta,\n$$\n并选择与最小正广义特征值 $\\lambda$ 相关联的广义特征向量 $\\theta$，条件是恢复的 $Q$ 是正定的。这将得到 $\\left(Q, q, q_{0}\\right)$（相差一个非零标量因子），该因子将在下一步中确定。\n\n3) 将中心椭球形式\n$$\n\\left(m_{m} - b_{m}\\right)^{\\top} W \\left(m_{m} - b_{m}\\right) = 1\n$$\n与展开的二次型形式进行匹配，可得\n$$\nQ = W, \\quad q = -W b_{m}, \\quad q_{0} = b_{m}^{\\top} W b_{m} - 1.\n$$\n对于代数拟合返回的任何非零缩放的 $\\left(Q, q, q_{0}\\right)$（其中 $Q$ 是对称正定的），我们首先恢复偏置作为二次曲面的中心\n$$\nb_{m} = - Q^{-1} q.\n$$\n代入二次型可得\n$$\nm_{m}^{\\top} Q\\, m_{m} + 2\\, q^{\\top} m_{m} + q_{0} = \\left(m_{m} - b_{m}\\right)^{\\top} Q \\left(m_{m} - b_{m}\\right) - \\left(b_{m}^{\\top} Q b_{m} - q_{0}\\right).\n$$\n定义标量\n$$\n\\alpha \\triangleq b_{m}^{\\top} Q b_{m} - q_{0}.\n$$\n为强制方程右侧为单位1，设置\n$$\nW = \\frac{Q}{\\alpha}.\n$$\n那么，根据构造，\n$$\n\\left(m_{m} - b_{m}\\right)^{\\top} W \\left(m_{m} - b_{m}\\right) = 1.\n$$\n因为 $W$ 是对称正定的，我们可以将其进行 Cholesky 分解\n$$\nW = L^{\\top} L,\n$$\n其中 $L$ 是上三角且可逆的。校准矩阵的一个唯一且数值稳定的选择是\n$$\nA = L^{-1},\n$$\n这确保了校准后的测量值满足\n$$\n|m_{c}|^{2} = \\left\\|A^{-1}\\left(m_{m} - b_{m}\\right)\\right\\|^{2} = \\left(m_{m} - b_{m}\\right)^{\\top} A^{-T} A^{-1} \\left(m_{m} - b_{m}\\right) = \\left(m_{m} - b_{m}\\right)^{\\top} W \\left(m_{m} - b_{m}\\right) = 1.\n$$\n\n4) 对于给定的六个测量值，我们可以利用基本方向的对称性。设 $m_{m}^{(+x)}$ 和 $m_{m}^{(-x)}$ 分别表示沿 $+x$ 和 $-x$ 方向的测量值，对 $y$ 和 $z$ 也类似。椭球中心满足\n$$\nb_{m} = \\frac{1}{2}\\left(m_{m}^{(+x)} + m_{m}^{(-x)}\\right) = \\frac{1}{2}\\left(m_{m}^{(+y)} + m_{m}^{(-y)}\\right) = \\frac{1}{2}\\left(m_{m}^{(+z)} + m_{m}^{(-z)}\\right),\n$$\n这逐分量地得出，\n$$\n\\begin{aligned}\nb_{x} = \\frac{1}{2}\\left(1.25 + \\left(-1.15\\right)\\right) = \\frac{1}{2}\\left(0.10\\right) = 0.05,\\\\\nb_{y} = \\frac{1}{2}\\left(-0.02 + \\left(-0.02\\right)\\right) = -0.02,\\\\\nb_{z} = \\frac{1}{2}\\left(0.03 + 0.03\\right) = 0.03.\n\\end{aligned}\n$$\n因此，\n$$\nb_{m} = \\begin{pmatrix} 0.05 \\\\ -0.02 \\\\ 0.03 \\end{pmatrix}.\n$$\n沿每个主轴从中心算起的偏移量给出了测量空间中椭球的半轴长度，当 $A$ 为对角矩阵时，这些长度等于 $A$ 的对角线元素。具体来说，\n$$\n\\begin{aligned}\n\\Delta x = \\left(1.25 - 0.05\\right) = 1.20, \\quad \\text{且 } \\left(-1.15 - 0.05\\right) = -1.20,\\\\\n\\Delta y = \\left(0.78 - \\left(-0.02\\right)\\right) = 0.80, \\quad \\text{且 } \\left(-0.82 - \\left(-0.02\\right)\\right) = -0.80,\\\\\n\\Delta z = \\left(1.03 - 0.03\\right) = 1.00, \\quad \\text{且 } \\left(-0.97 - 0.03\\right) = -1.00.\n\\end{aligned}\n$$\n因此，中心椭球的主半轴长度为 $s_{x} = 1.20$，$s_{y} = 0.80$ 和 $s_{z} = 1.00$，与设备轴对齐。在这种轴对齐的情况下，形状矩阵和校准矩阵都是对角矩阵：\n$$\nW = \\operatorname{diag}\\!\\left(\\frac{1}{s_{x}^{2}}, \\frac{1}{s_{y}^{2}}, \\frac{1}{s_{z}^{2}}\\right) = \\operatorname{diag}\\!\\left(\\frac{1}{1.20^{2}}, \\frac{1}{0.80^{2}}, \\frac{1}{1.00^{2}}\\right),\n$$\n其 Cholesky 因子是 $L = \\operatorname{diag}\\!\\left(\\frac{1}{1.20}, \\frac{1}{0.80}, \\frac{1}{1.00}\\right)$。因此选择的校准矩阵是\n$$\nA = L^{-1} = \\operatorname{diag}\\!\\left(1.20, 0.80, 1.00\\right).\n$$\n所求的行列式是\n$$\n\\det(A) = 1.20 \\times 0.80 \\times 1.00 = 0.96.\n$$\n四舍五入到四位有效数字，无量纲的行列式为 $0.9600$。",
            "answer": "$$\\boxed{0.9600}$$"
        },
        {
            "introduction": "一旦我们得到了姿态估计，一个关键任务就是量化两个不同姿态之间的误差。本练习深入探讨了旋转的几何学，展示了如何使用四元数数学来找到最短旋转角，即测地距离。这是评估任何姿态估计算法性能的最有意义的指标 。",
            "id": "4180113",
            "problem": "考虑一个惯性测量单元 (IMU) 姿态估计流程，其中姿态由单位四元数表示，遵循哈密顿约定和标量优先形式。令 $q = [w, x, y, z]$ 表示一个单位四元数，其范数为1，通过标准的四元数夹积运算作用于向量。将姿态 $q_1$ 变换到姿态 $q_2$ 的相对姿态由四元数乘积 $q_{\\Delta} = q_2 \\otimes q_1^{-1}$ 给出，其中 $q_1^{-1}$ 是四元数逆。在三维特殊正交群 $\\mathrm{SO}(3)$ 上，两个姿态之间的测地距离定义为将一个姿态映射到另一个姿态的最小旋转角，即由 $q_{\\Delta}$ 所表示的最短旋转的旋转角。\n\n从第一性原理（单位四元数的性质、四元数逆的定义和四元数乘法法则）出发，推导 $q_{\\Delta}$ 的轴角表示，明确说明如何从其标量和矢量部分获得测地旋转角和旋转轴，并包括对单位四元数双重覆盖的正确处理以确保得到最短旋转。\n\n然后，对以下特定姿态计算测地旋转角：\n- $q_1 = \\left[\\frac{\\sqrt{3}}{2}, \\frac{1}{2\\sqrt{3}}, \\frac{1}{2\\sqrt{3}}, \\frac{1}{2\\sqrt{3}}\\right]$,\n- $q_2 = \\left[\\frac{1}{2}, 0, 0, \\frac{\\sqrt{3}}{2}\\right]$.\n\n请以弧度为单位，给出最小测地旋转角的精确闭式表达式。不要提供数值近似值。最终答案必须是单一的实值表达式。",
            "solution": "该问题已经过验证，被认为是科学上可靠、定义明确且客观的。它为使用四元数的旋转运动学中的一个标准问题提供了完整且一致的设定。所提供的四元数 $q_1$ 和 $q_2$ 的数据是有效的单位四元数。因此，我们可以进行完整的推导和求解。\n\n解答过程分为两部分。首先，从第一性原理推导相对姿态四元数的一般轴角表示。其次，应用此结果计算给定姿态 $q_1$ 和 $q_2$ 之间的具体测地角。\n\n一个单位四元数 $q$ 以标量优先形式表示为 $q = [w, x, y, z]$，其中 $w$ 是标量部分，$\\mathbf{v} = [x, y, z]$ 是矢量部分。对于单位四元数，其范数为 $\\|q\\| = \\sqrt{w^2 + x^2 + y^2 + z^2} = 1$。在三维空间中，围绕单位轴向量 $\\mathbf{u}$ 旋转角度 $\\theta$ 的旋转可以由单位四元数表示\n$$q = \\left[\\cos\\left(\\frac{\\theta}{2}\\right), \\sin\\left(\\frac{\\theta}{2}\\right)\\mathbf{u}\\right]$$\n通过将一般形式 $q = [w, \\mathbf{v}]$ 与轴角形式进行比较，我们可以建立以下关系：\n$$w = \\cos\\left(\\frac{\\theta}{2}\\right)$$\n$$\\mathbf{v} = \\sin\\left(\\frac{\\theta}{2}\\right)\\mathbf{u}$$\n由此，可以从给定的单位四元数 $q=[w, \\mathbf{v}]$ 中提取旋转角 $\\theta$ 和旋转轴 $\\mathbf{u}$：\n$$\\theta = 2 \\arccos(w)$$\n$\\arccos$ 函数的值域为 $[0, \\pi]$，因此计算出的 $\\theta$ 将在 $[0, 2\\pi]$ 范围内。矢量部分给出了旋转轴：\n$$\\|\\mathbf{v}\\| = \\left\\|\\sin\\left(\\frac{\\theta}{2}\\right)\\mathbf{u}\\right\\| = \\left|\\sin\\left(\\frac{\\theta}{2}\\right)\\right| \\|\\mathbf{u}\\| = \\left|\\sin\\left(\\frac{\\theta}{2}\\right)\\right|$$\n由于 $\\theta/2 \\in [0, \\pi]$，$\\sin(\\theta/2) \\ge 0$。因此，$\\|\\mathbf{v}\\| = \\sin(\\theta/2)$。旋转轴则为：\n$$\\mathbf{u} = \\frac{\\mathbf{v}}{\\sin(\\theta/2)} = \\frac{\\mathbf{v}}{\\|\\mathbf{v}\\|}$$\n只要 $\\|\\mathbf{v}\\| \\neq 0$（对应于 $\\theta \\neq 0$），该式就有定义。如果 $\\theta=0$，四元数为 $[1, 0, 0, 0]$，表示一个旋转轴未定义的单位旋转。\n\n将由 $q_1$ 表示的姿态变换到由 $q_2$ 表示的姿态的相对姿态由四元数乘积 $q_{\\Delta} = q_2 \\otimes q_1^{-1}$ 给出。\n对于任意四元数 $q_1 = [w_1, \\mathbf{v}_1]$，其逆为 $q_1^{-1} = \\frac{q_1^*}{\\|q_1\\|^2}$，其中 $q_1^* = [w_1, -\\mathbf{v}_1]$ 是其共轭。由于 $q_1$ 是单位四元数，$\\|q_1\\|^2=1$，其逆简化为其共轭：$q_1^{-1} = q_1^*$。\n设 $q_1 = [w_1, \\mathbf{v}_1]$ 和 $q_2 = [w_2, \\mathbf{v}_2]$。相对姿态为 $q_{\\Delta} = q_2 \\otimes q_1^*$。使用哈密顿乘法法则 $([w_a, \\mathbf{v}_a] \\otimes [w_b, \\mathbf{v}_b] = [w_a w_b - \\mathbf{v}_a \\cdot \\mathbf{v}_b, w_a \\mathbf{v}_b + w_b \\mathbf{v}_a + \\mathbf{v}_a \\times \\mathbf{v}_b])$，我们得到：\n$$q_{\\Delta} = [w_2, \\mathbf{v}_2] \\otimes [w_1, -\\mathbf{v}_1] = [w_2 w_1 - \\mathbf{v}_2 \\cdot (-\\mathbf{v}_1), w_2(-\\mathbf{v}_1) + w_1\\mathbf{v}_2 + \\mathbf{v}_2 \\times (-\\mathbf{v}_1)]$$\n令 $q_{\\Delta} = [w_\\Delta, \\mathbf{v}_\\Delta]$。标量部分为：\n$$w_\\Delta = w_1 w_2 + \\mathbf{v}_1 \\cdot \\mathbf{v}_2$$\n这可以看作是 $q_1$ 和 $q_2$ 作为 $\\mathbb{R}^4$ 中向量的点积。矢量部分为：\n$$\\mathbf{v}_\\Delta = w_1 \\mathbf{v}_2 - w_2 \\mathbf{v}_1 - \\mathbf{v}_2 \\times \\mathbf{v}_1$$\n与 $q_\\Delta$ 对应的旋转角是 $\\theta_\\Delta = 2\\arccos(w_\\Delta)$。\n\n使用四元数表示旋转的一个关键性质是它对特殊正交群 $\\mathrm{SO}(3)$ 的双重覆盖。这意味着 $q$ 和 $-q$ 都表示同一个物理旋转。如果 $q = [\\cos(\\theta/2), \\sin(\\theta/2)\\mathbf{u}]$ 表示一个角度为 $\\theta$ 的旋转，那么 $-q = [-\\cos(\\theta/2), -\\sin(\\theta/2)\\mathbf{u}]$ 表示一个角度为 $\\theta' = 2\\arccos(-\\cos(\\theta/2)) = 2\\arccos(\\cos(\\pi - \\theta/2)) = 2(\\pi - \\theta/2) = 2\\pi - \\theta$ 的旋转。$\\mathrm{SO}(3)$ 上的测地距离对应于最小旋转角，即 $\\min(\\theta, 2\\pi - \\theta)$。这个最小角必须位于区间 $[0, \\pi]$ 内。\n一个角在 $[0, \\pi]$ 内，当且仅当其半角在 $[0, \\pi/2]$ 内，这意味着其半角的余弦值必须为非负数。为了找到最小旋转角 $\\theta_{geo}$，我们必须选择具有非负标量部分的四元数表示（$q_\\Delta$ 或 $-q_\\Delta$）。该表示的标量部分将是 $|w_\\Delta|$。因此，测地旋转角为：\n$$\\theta_{geo} = 2 \\arccos(|w_\\Delta|) = 2 \\arccos(|w_1 w_2 + \\mathbf{v}_1 \\cdot \\mathbf{v}_2|)$$\n\n我们现在对给定的四元数计算这个值：\n$$q_1 = \\left[\\frac{\\sqrt{3}}{2}, \\frac{1}{2\\sqrt{3}}, \\frac{1}{2\\sqrt{3}}, \\frac{1}{2\\sqrt{3}}\\right]$$\n$$q_2 = \\left[\\frac{1}{2}, 0, 0, \\frac{\\sqrt{3}}{2}\\right]$$\n首先，我们确定标量和矢量部分：\n$$w_1 = \\frac{\\sqrt{3}}{2}, \\quad \\mathbf{v}_1 = \\left[\\frac{1}{2\\sqrt{3}}, \\frac{1}{2\\sqrt{3}}, \\frac{1}{2\\sqrt{3}}\\right]$$\n$$w_2 = \\frac{1}{2}, \\quad \\mathbf{v}_2 = \\left[0, 0, \\frac{\\sqrt{3}}{2}\\right]$$\n接下来，我们计算相对四元数的标量部分 $w_\\Delta$：\n$$w_\\Delta = w_1 w_2 + \\mathbf{v}_1 \\cdot \\mathbf{v}_2$$\n标量部分的乘积为：\n$$w_1 w_2 = \\left(\\frac{\\sqrt{3}}{2}\\right)\\left(\\frac{1}{2}\\right) = \\frac{\\sqrt{3}}{4}$$\n矢量部分的点积为：\n$$\\mathbf{v}_1 \\cdot \\mathbf{v}_2 = \\left(\\frac{1}{2\\sqrt{3}}\\right)(0) + \\left(\\frac{1}{2\\sqrt{3}}\\right)(0) + \\left(\\frac{1}{2\\sqrt{3}}\\right)\\left(\\frac{\\sqrt{3}}{2}\\right) = 0 + 0 + \\frac{\\sqrt{3}}{4\\sqrt{3}} = \\frac{1}{4}$$\n将这些结果相加得到 $w_\\Delta$：\n$$w_\\Delta = \\frac{\\sqrt{3}}{4} + \\frac{1}{4} = \\frac{1+\\sqrt{3}}{4}$$\n由于 $1+\\sqrt{3} > 0$，我们有 $|w_\\Delta| = w_\\Delta = \\frac{1+\\sqrt{3}}{4}$。\n测地旋转角 $\\theta_{geo}$ 是：\n$$\\theta_{geo} = 2 \\arccos\\left(\\frac{1+\\sqrt{3}}{4}\\right)$$\n这即为所要求的精确闭式表达式。",
            "answer": "$$\\boxed{2 \\arccos\\left(\\frac{1+\\sqrt{3}}{4}\\right)}$$"
        },
        {
            "introduction": "即使是经过校准的磁力计也容易受到局部磁场干扰的影响，这会严重破坏姿态滤波器中的航向估计。这个高级练习将演示如何设计一个统计门控机制，利用马氏距离（Mahalanobis distance）来智能地拒绝错误的测量数据，从而使传感器融合算法在真实环境中更加鲁棒 。",
            "id": "4180109",
            "problem": "一个可穿戴的惯性测量单元 (IMU) 被安装在胸腔上，用于在室内行走时估计航向（偏航）。该 IMU 包含一个三轴加速度计、陀螺仪和磁力计。IMU 运行一个姿态扩展卡尔曼滤波器 (EKF)，该滤波器融合陀螺仪、加速度计和磁力计的测量值，以限制偏航漂移。仅当统计门限表明局部磁场环境未受干扰时，EKF 才会使用磁力计进行更新。\n\n假设存在以下物理上真实合理的模型。设导航坐标系为东北天坐标系，导航坐标系中真实的单位地球磁场方向为已知向量 $\\mathbf{b}^{n} \\in \\mathbb{R}^{3}$，且 $|\\mathbf{b}^{n}| = 1$。EKF 具有一个当前的姿态估计 $\\widehat{\\mathbf{R}}_{n}^{b} \\in \\mathrm{SO}(3)$，该估计将向量从导航坐标系旋转到机体坐标系，并存在一个小的姿态估计误差，该误差由机体坐标系中的小角度向量 $\\delta \\boldsymbol{\\theta} \\in \\mathbb{R}^{3}$ 参数化，其中 $\\delta \\boldsymbol{\\theta} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{P}_{\\theta})$。预测的机体坐标系单位磁场方向为 $\\mathbf{h} = \\widehat{\\mathbf{R}}_{n}^{b} \\mathbf{b}^{n}$，其中 $|\\mathbf{h}| = 1$。\n\n磁力计提供机体坐标系中的磁场测量值，该值被归一化为单位长度，得到 $\\mathbf{m}^{b} \\in \\mathbb{R}^{3}$，且 $|\\mathbf{m}^{b}| \\approx 1$。在没有局部干扰的情况下，将测量值（经过归一化和偏差补偿后）建模为\n$$\n\\mathbf{m}^{b} \\approx \\mathbf{h} - [\\mathbf{h}]_{\\times} \\, \\delta \\boldsymbol{\\theta} + \\mathbf{v},\n$$\n其中 $[\\mathbf{h}]_{\\times} \\in \\mathbb{R}^{3 \\times 3}$ 是斜对称矩阵，对于任意 $\\mathbf{x} \\in \\mathbb{R}^{3}$ 满足 $[\\mathbf{h}]_{\\times} \\mathbf{x} = \\mathbf{h} \\times \\mathbf{x}$，而 $\\mathbf{v} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{R}_{m})$ 是零均值测量噪声。局部磁场干扰会在方程右侧增加一个未知的扰动 $\\mathbf{d}$，该扰动可能是非高斯且时变的。为避免在受干扰时进行不当更新，EKF 使用一个残差对磁力计更新进行门限控制，该残差被构造成对幅度变化不敏感，而仅对方向不一致敏感。\n\n将在 $\\mathbf{h}$ 处的单位球面上切平面的正交投影算子定义为 $\\mathbf{P}(\\mathbf{h}) = \\mathbf{I}_{3} - \\mathbf{h} \\mathbf{h}^{\\top}$。考虑残差\n$$\n\\mathbf{r} = \\mathbf{P}(\\mathbf{h}) \\left( \\mathbf{m}^{b} - \\mathbf{h} \\right),\n$$\n并假设在无干扰条件下 ($\\mathbf{d} = \\mathbf{0}$)，该残差可以线性化为\n$$\n\\mathbf{r} \\approx \\mathbf{H} \\, \\delta \\boldsymbol{\\theta} + \\mathbf{w}, \\quad \\text{with} \\quad \\mathbf{H} = - \\mathbf{P}(\\mathbf{h}) [\\mathbf{h}]_{\\times}, \\quad \\mathbf{w} = \\mathbf{P}(\\mathbf{h}) \\mathbf{v}.\n$$\n设无干扰时的残差协方差为 $\\mathbf{S} = \\mathbf{H} \\mathbf{P}_{\\theta} \\mathbf{H}^{\\top} + \\mathbf{P}(\\mathbf{h}) \\mathbf{R}_{m} \\mathbf{P}(\\mathbf{h})$。由于 $\\mathbf{r}$ 位于二维切平面内，有效残差具有两个自由度。\n\n从基本的运动学线性化和高斯残差建模出发，推导一个基于 $\\mathbf{r}$ 的马氏范数的统计门限判据。在无干扰条件下，该判据需维持 $\\alpha = 0.01$ 的虚警概率（即错误地判断存在干扰的概率）。您的推导必须证明残差的分布以及门限中使用的自由度数。然后，计算马氏统计量对应的门限阈值的数值。将您的最终答案四舍五入到四位有效数字。将最终答案表示为无量纲数。",
            "solution": "该问题要求为扩展卡尔曼滤波器 (EKF) 中的磁力计测量推导一个基于统计原理的门限判据。目标是计算马氏检验统计量的数值阈值，以确保虚警概率为 $\\alpha = 0.01$。\n\n门限判决过程是一个假设检验。零假设 $H_0$ 是局部磁场环境未受干扰 ($\\mathbf{d}=\\mathbf{0}$)。备择假设 $H_1$ 是存在干扰 ($\\mathbf{d} \\neq \\mathbf{0}$)。当我们拒绝为真的 $H_0$ 时，就会发生虚警。此事件的概率用 $\\alpha$ 表示。\n\n在零假设下，测量残差 $\\mathbf{r}$ 被建模为零均值高斯随机向量的线性变换。姿态估计误差为 $\\delta \\boldsymbol{\\theta} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{P}_{\\theta})$，磁力计测量噪声为 $\\mathbf{v} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{R}_{m})$。线性化后的残差为 $\\mathbf{r} \\approx \\mathbf{H} \\, \\delta \\boldsymbol{\\theta} + \\mathbf{w}$，其中 $\\mathbf{H} = - \\mathbf{P}(\\mathbf{h}) [\\mathbf{h}]_{\\times}$ 且 $\\mathbf{w} = \\mathbf{P}(\\mathbf{h}) \\mathbf{v}$。由于高斯随机向量的线性变换结果仍然是高斯随机向量，因此在 $H_0$ 下，残差 $\\mathbf{r}$ 是一个零均值高斯随机向量，即 $\\mathbf{r} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{S})$。协方差矩阵 $\\mathbf{S}$ 由 $\\mathbf{S} = \\mathbf{H} \\mathbf{P}_{\\theta} \\mathbf{H}^{\\top} + \\mathbf{P}(\\mathbf{h}) \\mathbf{R}_{m} \\mathbf{P}(\\mathbf{h})$ 给出。\n\n门限判据基于残差的马氏平方距离，定义为检验统计量 $\\gamma$：\n$$\n\\gamma = \\mathbf{r}^{\\top} \\mathbf{S}^{\\dagger} \\mathbf{r}\n$$\n其中 $\\mathbf{S}^{\\dagger}$ 是协方差矩阵 $\\mathbf{S}$ 的 Moore-Penrose 伪逆。\n\n统计学中的一个基本定理指出，如果一个随机向量 $\\mathbf{x} \\in \\mathbb{R}^{n}$ 服从多元正态分布 $\\mathcal{N}(\\mathbf{0}, \\mathbf{\\Sigma})$，其中协方差矩阵 $\\mathbf{\\Sigma}$ 的秩为 $k \\leq n$，那么二次型 $\\mathbf{x}^{\\top} \\mathbf{\\Sigma}^{\\dagger} \\mathbf{x}$ 服从自由度为 $k$ 的卡方分布，记为 $\\chi^{2}(k)$。\n\n要应用此定理，我们必须确定协方差矩阵 $\\mathbf{S}$ 的秩。残差向量定义为 $\\mathbf{r} = \\mathbf{P}(\\mathbf{h}) (\\mathbf{m}^{b} - \\mathbf{h})$。矩阵 $\\mathbf{P}(\\mathbf{h}) = \\mathbf{I}_{3} - \\mathbf{h} \\mathbf{h}^{\\top}$ 是一个正交投影算子。它的作用是将一个向量投影到与单位向量 $\\mathbf{h}$ 正交的平面上。这个平面的维数是 2。因此，$\\mathbf{P}(\\mathbf{h})$ 的像空间中的任何向量 $\\mathbf{r}$ 都必须位于这个二维子空间内。这样一个随机向量的协方差矩阵 $\\mathbf{S}$ 将是秩亏的，其秩最多为 2。假设来自 $\\mathbf{P}_{\\theta}$ 和 $\\mathbf{R}_{m}$ 的不确定性相对于该平面不是退化的，那么 $\\mathbf{S}$ 的秩将恰好为 2。问题陈述通过说明“有效残差具有两个自由度”来证实这一点。因此，检验统计量 $\\gamma$ 服从自由度为 $k=2$ 的卡方分布：\n$$\n\\gamma \\sim \\chi^{2}(2)\n$$\n门限规则是，如果观测到的统计量 $\\gamma$ 超过某个阈值 $\\tau$，则拒绝该测量更新。我们寻求找到 $\\tau$ 的值，使得虚警概率为 $\\alpha = 0.01$。这表示为：\n$$\nP(\\gamma > \\tau | H_0) = \\alpha\n$$\n这等价于找到使 $\\chi^{2}(2)$ 分布的累积分布函数 (CDF) 等于 $1-\\alpha$ 的值 $\\tau$。设 $F_{\\chi^{2}(k)}(x)$ 是自由度为 $k$ 的卡方分布的 CDF。我们必须求解方程中的 $\\tau$：\n$$\nF_{\\chi^{2}(2)}(\\tau) = 1 - \\alpha\n$$\n自由度为 $k$ 的 $\\chi^{2}(k)$ 分布的概率密度函数 (PDF) 是 $f(x;k) = \\frac{1}{2^{k/2} \\Gamma(k/2)} x^{k/2-1} \\exp(-x/2)$。对于 $k=2$，伽马函数项为 $\\Gamma(2/2)=\\Gamma(1)=1$。PDF 简化为：\n$$\nf(x;2) = \\frac{1}{2^{1} \\cdot 1} x^{1-1} \\exp(-x/2) = \\frac{1}{2}\\exp(-x/2)\n$$\n这是速率参数为 $\\lambda = 1/2$ 的指数分布的 PDF。对于 $x \\geq 0$，CDF 通过积分得到：\n$$\nF_{\\chi^{2}(2)}(x) = \\int_{0}^{x} \\frac{1}{2}\\exp(-t/2) \\, dt = \\left[ -\\exp(-t/2) \\right]_{0}^{x} = 1 - \\exp(-x/2)\n$$\n我们现在可以求解阈值 $\\tau$：\n$$\n1 - \\exp(-\\tau/2) = 1 - \\alpha\n$$\n$$\n\\exp(-\\tau/2) = \\alpha\n$$\n对两边取自然对数：\n$$\n-\\frac{\\tau}{2} = \\ln(\\alpha)\n$$\n$$\n\\tau = -2 \\ln(\\alpha)\n$$\n代入给定的虚警概率 $\\alpha = 0.01$：\n$$\n\\tau = -2 \\ln(0.01)\n$$\n这可以计算为：\n$$\n\\tau = -2 \\ln(10^{-2}) = -2 (-2 \\ln(10)) = 4 \\ln(10)\n$$\n使用值 $\\ln(10) \\approx 2.30258509...$：\n$$\n\\tau \\approx 4 \\times 2.30258509... \\approx 9.21034037...\n$$\n问题要求将最终答案四舍五入到四位有效数字。因此，门限阈值的无量纲值为 $9.210$。\n因此，门限判据为：如果 $\\mathbf{r}^{\\top} \\mathbf{S}^{\\dagger} \\mathbf{r} > 9.210$，则判断存在干扰并拒绝该磁力计测量。",
            "answer": "$$\n\\boxed{9.210}\n$$"
        }
    ]
}