{
    "hands_on_practices": [
        {
            "introduction": "理解外部力（如与地面接触产生的力）如何对我们的关节产生旋转需求，是生物力学分析的基石。本练习将通过一个基础但至关重要的计算，帮助您掌握如何利用地面反作用力（Ground Reaction Force, GRF）和压力中心（Center of Pressure, CoP）的数据来求解外部踝关节力矩 。这是任何步态或运动分析中评估关节负荷的第一步，其核心在于应用力矩的定义：力臂向量与力向量的叉积。",
            "id": "4154677",
            "problem": "在以踝关节中心为原点的实验室右手坐标系中对右脚进行建模。坐标轴定义如下：$x$轴指向前方，$y$轴指向上方，$z$轴指向外侧（向右）。在站立期的某一瞬间，测得的外部地面反作用力（GRF）矢量在该坐标系中表示为 $\\boldsymbol{F}=\\big(F_{x},F_{y},F_{z}\\big)=\\big(-120,950,-30\\big)$，单位为牛顿。相对于踝关节中心的压力中心（CoP）位置为 $\\boldsymbol{r}_{\\text{CoP}}-\\boldsymbol{r}_{A}=\\big(0.19,-0.045,0.015\\big)$，单位为米。使用牛顿定律和力对某点的力矩定义，计算由地面反作用力（GRF）产生的、绕踝关节中心的外部踝关节力矩矢量，并提取其绕内外侧轴（$z$轴）的标量分量。采用右手定则确定力矩方向，并遵循以下符号约定进行解释：绕$+z$轴的正力矩倾向于使足部背屈，负力矩倾向于使足部跖屈。以牛顿·米（$\\text{N}\\cdot\\text{m}$）为单位表示所求的踝关节力矩标量分量，并将答案四舍五入至四位有效数字。在你的推理中，使用所述的符号约定明确说明所计算力矩符号的理由。不要计算任何内力矩；仅需求解由地面反作用力（GRF）引起的的外力矩。",
            "solution": "由作用在相对于枢转点的位置矢量为 $\\boldsymbol{r}$ 的点上的力 $\\boldsymbol{F}$ 所产生的的外力矩 $\\boldsymbol{M}$，定义为 $\\boldsymbol{r}$ 和 $\\boldsymbol{F}$ 的叉积。在本问题中，枢转点是踝关节中心（坐标系原点），力是地面反作用力 $\\boldsymbol{F}$，位置矢量是压力中心的位置 $\\boldsymbol{r}$。\n\n力矩矢量 $\\boldsymbol{M}$ 因此由以下公式给出：\n$$\n\\boldsymbol{M} = \\boldsymbol{r} \\times \\boldsymbol{F}\n$$\n力矩矢量 $\\boldsymbol{M} = (M_x, M_y, M_z)$ 的分量可以通过由单位矢量以及 $\\boldsymbol{r}$ 和 $\\boldsymbol{F}$ 的分量组成的矩阵的行列式来计算：\n$$\n\\boldsymbol{M} = \n\\begin{vmatrix}\n\\boldsymbol{\\hat{\\imath}} & \\boldsymbol{\\hat{\\jmath}} & \\boldsymbol{\\hat{k}} \\\\\nr_x & r_y & r_z \\\\\nF_x & F_y & F_z\n\\end{vmatrix}\n= (r_y F_z - r_z F_y)\\boldsymbol{\\hat{\\imath}} - (r_x F_z - r_z F_x)\\boldsymbol{\\hat{\\jmath}} + (r_x F_y - r_y F_x)\\boldsymbol{\\hat{k}}\n$$\n其中 $\\boldsymbol{\\hat{\\imath}}$、$\\boldsymbol{\\hat{\\jmath}}$ 和 $\\boldsymbol{\\hat{k}}$ 分别是沿 $x$、$y$ 和 $z$ 轴的单位矢量。\n\n问题要求的是踝关节力矩绕内外侧轴（即$z$轴）的标量分量。这对应于分量 $M_z$。根据叉积的定义，$M_z$ 标量分量为：\n$$\nM_z = r_x F_y - r_y F_x\n$$\n给定的值为：\n- $\\boldsymbol{r} = \\big(0.19, -0.045, 0.015\\big)$ m, so $r_x = 0.19 \\, \\text{m}$ 和 $r_y = -0.045 \\, \\text{m}$。\n- $\\boldsymbol{F} = \\big(-120, 950, -30\\big)$ N, so $F_x = -120 \\, \\text{N}$ 和 $F_y = 950 \\, \\text{N}$。\n\n将这些值代入 $M_z$ 的方程中：\n$$\nM_z = (0.19) \\cdot (950) - (-0.045) \\cdot (-120)\n$$\n我们对每一项进行乘法运算：\n$$\n(0.19) \\cdot (950) = 180.5 \\, \\text{N}\\cdot\\text{m}\n$$\n$$\n(-0.045) \\cdot (-120) = 5.4 \\, \\text{N}\\cdot\\text{m}\n$$\n现在，我们计算 $M_z$ 的最终值：\n$$\nM_z = 180.5 - 5.4 = 175.1 \\, \\text{N}\\cdot\\text{m}\n$$\n问题要求答案四舍五入到四位有效数字。计算出的值 $175.1$ 已经有四位有效数字，因此无需进一步四舍五入。\n\n计算出的力矩分量 $M_z$ 的符号为正。根据问题的符号约定，“绕$+z$轴的正力矩倾向于使足部背屈”。因此，外部地面反作用力在踝关节周围产生了一个大小为 $175.1 \\, \\text{N}\\cdot\\text{m}$ 的背屈力矩。这个结果在物理上是直观的：主要的垂直力分量（$F_y = 950 \\, \\text{N}$）作用于踝关节前方（$r_x = 0.19 \\, \\text{m}$），这会产生一个强大的使足部向上旋转（背屈）的趋势，绕着内外侧轴。作用于踝关节下方（$r_y = -0.045 \\, \\text{m}$）的制动力（$F_x = -120 \\, \\text{N}$）产生了一个较小的相反的跖屈力矩，但净效应是一个强大的背屈力矩。",
            "answer": "$$\\boxed{175.1}$$"
        },
        {
            "introduction": "在了解了关节的外部力矩需求后，接下来的问题是：身体是如何通过内部结构来满足这一需求的？本练习将带您探索“正向动力学”的世界，使用经典的希尔式（Hill-type）肌肉模型来估算关键踝关节肌肉（如比目鱼肌和腓肠肌）产生的力和力矩 。通过这个实践，您将学习如何将肌肉的生理参数（如激活水平、纤维长度）与它们的机械输出（即产生的力）联系起来，从而理解肌肉在控制关节运动中的作用。",
            "id": "4154633",
            "problem": "在平地行走的站立后期某一瞬间，您通过肌电图（EMG）驱动建模得到了三个主要踝关节肌肉的估计值：soleus、medial gastrocnemius 和 tibialis anterior。使用 Hill 型肌肉模型，根据它们的瞬时贡献计算净跖屈踝力矩。假设以下与标准肌肉骨骼实践一致的建模假设：此时肌腱不可伸展，羽状角可忽略不计，因此肌纤维力等于沿作用线的肌腱力，并且纤维速度为零，因此此时的力-速度效应简化为1。\n\n使用以下数据，其中跖屈力矩定义为正值：\n- Soleus (SOL)：激活度 $a_{\\text{SOL}} = 0.60$，最大等长力 $F_{\\max,\\text{SOL}} = 4000\\,\\text{N}$，最佳纤维长度 $l_{\\text{opt},\\text{SOL}} = 0.040\\,\\text{m}$，肌腱松弛长度 $l_{\\text{ts},\\text{SOL}} = 0.330\\,\\text{m}$，肌腱复合体长度 $l_{\\text{mt},\\text{SOL}}(t_{0}) = 0.370\\,\\text{m}$，解剖力臂 $r_{\\text{SOL}} = 0.050\\,\\text{m}$。\n- Medial gastrocnemius (MG)：激活度 $a_{\\text{MG}} = 0.50$，最大等长力 $F_{\\max,\\text{MG}} = 1800\\,\\text{N}$，最佳纤维长度 $l_{\\text{opt},\\text{MG}} = 0.050\\,\\text{m}$，肌腱松弛长度 $l_{\\text{ts},\\text{MG}} = 0.350\\,\\text{m}$，肌腱复合体长度 $l_{\\text{mt},\\text{MG}}(t_{0}) = 0.400\\,\\text{m}$，解剖力臂 $r_{\\text{MG}} = 0.050\\,\\text{m}$。\n- Tibialis anterior (TA)：激活度 $a_{\\text{TA}} = 0.10$，最大等长力 $F_{\\max,\\text{TA}} = 900\\,\\text{N}$，最佳纤维长度 $l_{\\text{opt},\\text{TA}} = 0.060\\,\\text{m}$，肌腱松弛长度 $l_{\\text{ts},\\text{TA}} = 0.190\\,\\text{m}$，肌腱复合体长度 $l_{\\text{mt},\\text{TA}}(t_{0}) = 0.240\\,\\text{m}$，解剖力臂 $r_{\\text{TA}} = -0.030\\,\\text{m}$（负值是因为根据所述约定，tibialis anterior 产生背屈力矩）。\n\n对于每块肌肉，此时的主动肌纤维力模型为\n$$F = a\\,F_{\\max}\\,f_{l}(l_{f})\\,f_{v}(v_{f}),$$\n其中 $f_{v}(0) = 1$（等长收缩条件），归一化的力-长度关系由广泛使用的高斯近似给出\n$$f_{l}(l_{f}) = \\exp\\!\\left(-\\frac{\\left(\\frac{l_{f}}{l_{\\text{opt}}}-1\\right)^{2}}{w^{2}}\\right), \\quad w = 0.56.$$\n在肌腱不可伸展和羽状角可忽略的情况下，此时使用 $l_{f} = l_{\\text{mt}} - l_{\\text{ts}}$ 和 $v_{f} = 0$。净踝关节力矩是各肌肉力矩的总和，\n$$\\tau = \\sum_{i \\in \\{\\text{SOL},\\text{MG},\\text{TA}\\}} r_{i}\\,F_{i}.$$\n\n计算此时的瞬时净跖屈踝力矩 $\\tau$。最终答案以 $\\text{N}\\cdot\\text{m}$ 为单位表示，并四舍五入到四位有效数字。",
            "solution": "目标是计算瞬时净踝关节力矩，即由三个指定肌肉产生的力矩之和：soleus (SOL)、medial gastrocnemius (MG) 和 tibialis anterior (TA)。单个肌肉 $i$ 产生的力矩 $\\tau_i$ 是其力 $F_i$ 与其绕踝关节的力臂 $r_i$ 的乘积。\n$$ \\tau_i = r_i F_i $$\n总净力矩 $\\tau$ 是各个肌肉力矩的总和。\n$$ \\tau = \\sum_{i \\in \\{\\text{SOL},\\text{MG},\\text{TA}\\}} \\tau_i = \\tau_{\\text{SOL}} + \\tau_{\\text{MG}} + \\tau_{\\text{TA}} $$\n每个肌肉的力 $F_i$ 由所提供的 Hill 型模型方程确定：\n$$ F_i = a_i F_{\\max,i} f_{l,i}(l_{f,i}) f_{v,i}(v_{f,i}) $$\n其中 $a_i$ 是肌肉激活度，$F_{\\max,i}$ 是最大等长力，$f_{l,i}$ 是归一化力-长度乘子，$f_{v,i}$ 是归一化力-速度乘子。\n\n问题陈述，此时纤维速度为零（$v_f=0$），这意味着在纤维层面发生等长收缩。在此条件下，力-速度乘子为1：\n$$ f_{v,i}(0) = 1 $$\n因此，力方程简化为：\n$$ F_i = a_i F_{\\max,i} f_{l,i}(l_{f,i}) $$\n力-长度关系由一个高斯函数给出：\n$$ f_{l,i}(l_{f,i}) = \\exp\\left(-\\frac{\\left(\\frac{l_{f,i}}{l_{\\text{opt},i}}-1\\right)^{2}}{w^{2}}\\right) $$\n其中 $l_{f,i}$ 是肌纤维长度，$l_{\\text{opt},i}$ 是最佳纤维长度，$w = 0.56$ 是一个形状参数。\n\n问题假设肌腱不可伸展且羽状角可忽略。这使我们可以直接从总肌腱复合体长度 $l_{\\text{mt},i}$ 和肌腱松弛长度 $l_{\\text{ts},i}$ 计算肌纤维长度 $l_{f,i}$：\n$$ l_{f,i} = l_{\\text{mt},i} - l_{\\text{ts},i} $$\n我们现在将计算每块肌肉的力和力矩。\n\n**1. Soleus (SOL)**\n首先，计算纤维长度 $l_{f,\\text{SOL}}$：\n$$ l_{f,\\text{SOL}} = l_{\\text{mt},\\text{SOL}} - l_{\\text{ts},\\text{SOL}} = 0.370\\,\\text{m} - 0.330\\,\\text{m} = 0.040\\,\\text{m} $$\n接下来，计算归一化纤维长度 $\\tilde{l}_{f,\\text{SOL}} = l_{f,\\text{SOL}} / l_{\\text{opt},\\text{SOL}}$：\n$$ \\tilde{l}_{f,\\text{SOL}} = \\frac{0.040\\,\\text{m}}{0.040\\,\\text{m}} = 1 $$\n现在，计算力-长度乘子 $f_{l,\\text{SOL}}$：\n$$ f_{l,\\text{SOL}} = \\exp\\left(-\\frac{(1-1)^2}{0.56^2}\\right) = \\exp(0) = 1 $$\n这个结果是预料之中的，因为纤维处于其最佳长度。由 soleus 产生的力是：\n$$ F_{\\text{SOL}} = a_{\\text{SOL}} F_{\\max,\\text{SOL}} f_{l,\\text{SOL}} = (0.60)(4000\\,\\text{N})(1) = 2400\\,\\text{N} $$\n由 soleus 产生的力矩是（注意跖屈为正）：\n$$ \\tau_{\\text{SOL}} = r_{\\text{SOL}} F_{\\text{SOL}} = (0.050\\,\\text{m})(2400\\,\\text{N}) = 120\\,\\text{N}\\cdot\\text{m} $$\n\n**2. Medial Gastrocnemius (MG)**\n计算纤维长度 $l_{f,\\text{MG}}$：\n$$ l_{f,\\text{MG}} = l_{\\text{mt},\\text{MG}} - l_{\\text{ts},\\text{MG}} = 0.400\\,\\text{m} - 0.350\\,\\text{m} = 0.050\\,\\text{m} $$\n计算归一化纤维长度 $\\tilde{l}_{f,\\text{MG}} = l_{f,\\text{MG}} / l_{\\text{opt},\\text{MG}}$：\n$$ \\tilde{l}_{f,\\text{MG}} = \\frac{0.050\\,\\text{m}}{0.050\\,\\text{m}} = 1 $$\n因此，力-长度乘子 $f_{l,\\text{MG}}$ 也为 $1$：\n$$ f_{l,\\text{MG}} = \\exp\\left(-\\frac{(1-1)^2}{0.56^2}\\right) = \\exp(0) = 1 $$\n由 medial gastrocnemius 产生的力是：\n$$ F_{\\text{MG}} = a_{\\text{MG}} F_{\\max,\\text{MG}} f_{l,\\text{MG}} = (0.50)(1800\\,\\text{N})(1) = 900\\,\\text{N} $$\n由 medial gastrocnemius 产生的力矩是：\n$$ \\tau_{\\text{MG}} = r_{\\text{MG}} F_{\\text{MG}} = (0.050\\,\\text{m})(900\\,\\text{N}) = 45\\,\\text{N}\\cdot\\text{m} $$\n\n**3. Tibialis Anterior (TA)**\n计算纤维长度 $l_{f,\\text{TA}}$：\n$$ l_{f,\\text{TA}} = l_{\\text{mt},\\text{TA}} - l_{\\text{ts},\\text{TA}} = 0.240\\,\\text{m} - 0.190\\,\\text{m} = 0.050\\,\\text{m} $$\n计算归一化纤维长度 $\\tilde{l}_{f,\\text{TA}} = l_{f,\\text{TA}} / l_{\\text{opt},\\text{TA}}$：\n$$ \\tilde{l}_{f,\\text{TA}} = \\frac{0.050\\,\\text{m}}{0.060\\,\\text{m}} = \\frac{5}{6} $$\n现在，计算力-长度乘子 $f_{l,\\text{TA}}$：\n$$ f_{l,\\text{TA}} = \\exp\\left(-\\frac{\\left(\\frac{5}{6}-1\\right)^{2}}{0.56^2}\\right) = \\exp\\left(-\\frac{\\left(-\\frac{1}{6}\\right)^2}{0.3136}\\right) = \\exp\\left(-\\frac{1/36}{0.3136}\\right) \\approx \\exp(-0.08858) \\approx 0.91524 $$\n由 tibialis anterior 产生的力是：\n$$ F_{\\text{TA}} = a_{\\text{TA}} F_{\\max,\\text{TA}} f_{l,\\text{TA}} = (0.10)(900\\,\\text{N})(0.91524) = 82.37\\,\\text{N} $$\n力臂 $r_{\\text{TA}}$ 为负，因为 TA 是一个背屈肌。由 tibialis anterior 产生的力矩是：\n$$ \\tau_{\\text{TA}} = r_{\\text{TA}} F_{\\text{TA}} = (-0.030\\,\\text{m})(82.37\\,\\text{N}) = -2.471\\,\\text{N}\\cdot\\text{m} $$\n\n**4. 净踝关节力矩**\n净踝关节力矩是各个力矩的总和：\n$$ \\tau = \\tau_{\\text{SOL}} + \\tau_{\\text{MG}} + \\tau_{\\text{TA}} $$\n$$ \\tau = 120\\,\\text{N}\\cdot\\text{m} + 45\\,\\text{N}\\cdot\\text{m} - 2.471\\,\\text{N}\\cdot\\text{m} $$\n$$ \\tau = 162.529\\,\\text{N}\\cdot\\text{m} $$\n按要求将最终答案四舍五入到四位有效数字：\n$$ \\tau \\approx 162.5\\,\\text{N}\\cdot\\text{m} $$\n这个值代表一个净跖屈力矩，这与行走中站立后期阶段一致，在该阶段跖屈肌高度活跃以推动身体向前。",
            "answer": "$$\n\\boxed{162.5}\n$$"
        },
        {
            "introduction": "这项综合性练习将运动学（物体的运动）和动力学（引起运动的力）结合起来，引导您完成一次完整的逆动力学分析，这是现代生物力学研究和临床评估的支柱。您将应用牛顿-欧拉（Newton-Euler）运动方程，根据已知的足部运动学数据和外部受力情况，来计算产生该运动所需的*净*踝关节内部力矩 。这个强大的方法使我们能够量化肌肉、韧带等所有内部结构协同作用的最终结果。",
            "id": "4154601",
            "problem": "考虑一个下肢的平面矢状面双节段模型，该模型由一个在踝关节处连接的小腿节段和一个足部节段组成。全局坐标系定义为：前后轴沿 $x$ 轴（向前为正），垂直轴沿 $y$ 轴（向上为正），平面外轴沿 $z$ 轴（根据右手定则，绕 $z$ 轴的逆时针力矩为正）。该模型在瞬时时间点上使用刚体动力学和牛顿定律进行分析。\n\n给定以下已知的节段质量特性：\n- 足部节段质量 $m_f$（单位：$\\mathrm{kg}$）和足部节段绕其质心的转动惯量 $I_f$（单位：$\\mathrm{kg\\cdot m^2}$）。\n- 小腿节段质量 $m_s$（单位：$\\mathrm{kg}$）和小腿节段绕其质心的转动惯量 $I_s$（单位：$\\mathrm{kg\\cdot m^2}$）。\n\n对于每个测试用例，还给出了在某一瞬间测得的足部节段的运动学和外部载荷数据：\n- 足部方向角 $\\theta_f$（单位：$\\mathrm{rad}$）。\n- 足部角速度 $\\omega_f$（单位：$\\mathrm{rad/s}$）。\n- 足部角加速度 $\\alpha_f$（单位：$\\mathrm{rad/s^2}$）。\n- 踝关节线性加速度 $\\mathbf{a}_A = [a_{Ax}, a_{Ay}]$（单位：$\\mathrm{m/s^2}$）。\n- 作用于压力中心 (COP) 的地面反作用力 (GRF) 矢量 $\\mathbf{F}_G = [F_{Gx}, F_{Gy}]$（单位：$\\mathrm{N}$）。\n- 绕 COP 的自由力矩 $M_G$（单位：$\\mathrm{N\\cdot m}$），绕 $z$ 轴逆时针为正。\n- 足部局部矢量（在足部的体坐标系中表示）：从踝关节到足部质心的矢量 $\\mathbf{r}^{\\text{local}}_{A\\to c_f} = [r^{\\ell}_{cx}, r^{\\ell}_{cy}]$（单位：$\\mathrm{m}$），以及从踝关节到 COP 的矢量 $\\mathbf{r}^{\\text{local}}_{A\\to \\text{COP}} = [r^{\\ell}_{\\text{COP}x}, r^{\\ell}_{\\text{COP}y}]$（单位：$\\mathrm{m}$）。\n\n重力加速度大小为 $g = 9.81$ $\\mathrm{m/s^2}$，沿负 $y$ 轴向下作用。\n\n使用的基本原理：\n- 牛顿第二运动平移定律：$\\sum \\mathbf{F}_{\\text{ext}} = m \\mathbf{a}_c$。\n- 牛顿第二运动旋转定律（欧拉方程），绕质心：$\\sum M_{\\text{ext},c} = I_c \\alpha$。\n- 旋转体上某点加速度的刚体运动学：$\\mathbf{a}_c = \\mathbf{a}_A + \\boldsymbol{\\alpha} \\times \\mathbf{r}_{A\\to c} + \\boldsymbol{\\omega} \\times (\\boldsymbol{\\omega} \\times \\mathbf{r}_{A\\to c})$，其中 $\\boldsymbol{\\omega} = \\omega \\hat{\\mathbf{z}}$ 且 $\\boldsymbol{\\alpha} = \\alpha \\hat{\\mathbf{z}}$。\n- 平面内力对点 $A$ 的力矩：$M_A = r_x F_y - r_y F_x$，其中 $\\mathbf{r} = [r_x, r_y]$ 且 $\\mathbf{F} = [F_x, F_y]$。\n\n任务：\n1. 从基本原理出发，推导小腿-足部双节段系统在矢状面内的运动方程，从上述基本定律开始，并用已知量和未知的踝关节力矩 $M_A$ 来表示足部节段绕踝关节的旋转平衡。\n2. 实现一个算法，该算法对每个测试用例，仅使用测量的足部运动学数据、GRF 和 COP、足部质量特性以及重力来计算足部节段的踝关节力矩 $M_A$（绕 $z$ 轴）。该算法必须使用测量的足部方向角 $\\theta_f$ 正确地将足部局部矢量转换到全局坐标系，并且必须使用刚体运动学计算足部质心的加速度。提供小腿节段的特性是为了完善双节段模型的推导，但在仅使用足部的逆动力学计算踝关节力矩 $M_A$ 时，这些特性不是必需的。\n3. 以 $\\mathrm{N\\cdot m}$ 为单位表示每个计算出的踝关节力矩。\n\n角度单位要求：所有角度均以弧度为单位。\n\n最终输出格式要求：\n- 你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 $[m_1,m_2,m_3,m_4]$，其中每个 $m_i$ 是第 $i$ 个测试用例计算出的踝关节力矩，四舍五入到三位小数，单位为 $\\mathrm{N\\cdot m}$。\n\n测试套件：\n在所有测试用例中，使用以下足部和小腿的质量特性：\n- 足部质量 $m_f = 1.2$ $\\mathrm{kg}$。\n- 足部绕质心的转动惯量 $I_f = 0.008$ $\\mathrm{kg\\cdot m^2}$。\n- 小腿质量 $m_s = 3.5$ $\\mathrm{kg}$。\n- 小腿绕质心的转动惯量 $I_s = 0.043$ $\\mathrm{kg\\cdot m^2}$。\n- 足部局部质心矢量 $\\mathbf{r}^{\\text{local}}_{A\\to c_f} = [0.03, -0.02]$ $\\mathrm{m}$。\n\n提供四个测试用例，涵盖典型的站立期（“理想路径”）、准静态条件、边界情况（COP 在踝关节正下方）和高加速度边缘情况：\n\n- 用例 1（理想路径）：\n  - $\\theta_f = 0.2$ $\\mathrm{rad}$，$\\omega_f = 1.5$ $\\mathrm{rad/s}$，$\\alpha_f = -10.0$ $\\mathrm{rad/s^2}$。\n  - $\\mathbf{a}_A = [0.5, 0.2]$ $\\mathrm{m/s^2}$。\n  - $\\mathbf{F}_G = [120.0, 900.0]$ $\\mathrm{N}$，$M_G = 6.0$ $\\mathrm{N\\cdot m}$。\n  - $\\mathbf{r}^{\\text{local}}_{A\\to \\text{COP}} = [0.06, -0.04]$ $\\mathrm{m}$。\n\n- 用例 2（准静态）：\n  - $\\theta_f = 0.0$ $\\mathrm{rad}$，$\\omega_f = 0.0$ $\\mathrm{rad/s}$，$\\alpha_f = 0.0$ $\\mathrm{rad/s^2}$。\n  - $\\mathbf{a}_A = [0.0, 0.0]$ $\\mathrm{m/s^2}$。\n  - $\\mathbf{F}_G = [0.0, 350.0]$ $\\mathrm{N}$，$M_G = 0.0$ $\\mathrm{N\\cdot m}$。\n  - $\\mathbf{r}^{\\text{local}}_{A\\to \\text{COP}} = [0.05, -0.04]$ $\\mathrm{m}$。\n\n- 用例 3（边界：COP 在踝关节下方）：\n  - $\\theta_f = 0.3$ $\\mathrm{rad}$，$\\omega_f = 2.0$ $\\mathrm{rad/s}$，$\\alpha_f = 0.0$ $\\mathrm{rad/s^2}$。\n  - $\\mathbf{a}_A = [-0.2, 0.1]$ $\\mathrm{m/s^2}$。\n  - $\\mathbf{F}_G = [50.0, 800.0]$ $\\mathrm{N}$，$M_G = -4.0$ $\\mathrm{N\\cdot m}$。\n  - $\\mathbf{r}^{\\text{local}}_{A\\to \\text{COP}} = [0.0, -0.04]$ $\\mathrm{m}$。\n\n- 用例 4（高加速度边缘）：\n  - $\\theta_f = -0.1$ $\\mathrm{rad}$，$\\omega_f = 0.0$ $\\mathrm{rad/s}$，$\\alpha_f = 20.0$ $\\mathrm{rad/s^2}$。\n  - $\\mathbf{a}_A = [-1.0, 2.0]$ $\\mathrm{m/s^2}$。\n  - $\\mathbf{F}_G = [100.0, 600.0]$ $\\mathrm{N}$，$M_G = 2.5$ $\\mathrm{N\\cdot m}$。\n  - $\\mathbf{r}^{\\text{local}}_{A\\to \\text{COP}} = [0.07, -0.05]$ $\\mathrm{m}$。\n\n实现计算并按指定格式生成最终的单行输出，每个踝关节力矩以 $\\mathrm{N\\cdot m}$ 为单位，并四舍五入到三位小数。",
            "solution": "该问题要求使用逆动力学方法，在一个平面矢状面足部模型上，计算小腿施加于足部的踝关节力矩 $M_A$。该问题定义明确，科学依据充分，并提供了计算唯一解所需的所有信息。我们将按照规定，从基本原理出发推导控制方程。\n\n分析基于足部节段的受力体图。作用于足部的外力和力矩包括：\n1.  重力 $\\mathbf{F}_g$，作用于足部质心 $c_f$。在全局坐标系中，$\\mathbf{F}_g = [0, -m_f g]$。\n2.  地面反作用力 $\\mathbf{F}_G = [F_{Gx}, F_{Gy}]$，作用于压力中心 COP。\n3.  地面自由力矩 $M_G$，作用于 COP。\n4.  踝关节反作用力 $\\mathbf{F}_A = [F_{Ax}, F_{Ay}]$，由小腿在踝关节中心 $A$ 处施加于足部。\n5.  踝关节力矩 $M_A$，由小腿施加于足部。这是待求量。按照惯例，逆时针方向的力矩为正。\n\n足部的运动由牛顿第二平移和旋转定律描述。我们将围绕足部质心 $c_f$ 来表述这些定律。\n\n平移运动方程为：\n$$ \\sum \\mathbf{F}_{\\text{ext}} = m_f \\mathbf{a}_{c_f} $$\n$$ \\mathbf{F}_A + \\mathbf{F}_G + \\mathbf{F}_g = m_f \\mathbf{a}_{c_f} \\quad (1) $$\n其中 $\\mathbf{a}_{c_f}$ 是足部质心的线性加速度。\n\n绕质心 $c_f$ 的旋转运动方程为：\n$$ \\sum M_{c_f} = I_f \\alpha_f $$\n绕 $c_f$ 的力矩总和包括作用于 $A$ 点的力 $\\mathbf{F}_A$、作用于 COP 的力 $\\mathbf{F}_G$、自由力矩 $M_G$ 和踝关节力矩 $M_A$ 所产生的力矩。重力 $\\mathbf{F}_g$ 通过 $c_f$ 作用，因此其对 $c_f$ 的力矩为零。\n$$ M_A + M_G + (\\mathbf{r}_{c_f \\to A} \\times \\mathbf{F}_A)_z + (\\mathbf{r}_{c_f \\to \\text{COP}} \\times \\mathbf{F}_G)_z = I_f \\alpha_f \\quad (2) $$\n其中 $(\\mathbf{v})_z$ 表示矢量 $\\mathbf{v}$ 的 $z$ 分量，$\\mathbf{r}_{P \\to Q}$ 是从点 $P$到点 $Q$ 的位置矢量。\n\n我们的目标是求出 $M_A$。方程 (2) 包含另一个未知量 $\\mathbf{F}_A$。我们可以通过先在方程 (1) 中求解 $\\mathbf{F}_A$ 来消除它：\n$$ \\mathbf{F}_A = m_f \\mathbf{a}_{c_f} - \\mathbf{F}_G - \\mathbf{F}_g $$\n现在，我们将这个 $\\mathbf{F}_A$ 的表达式代入方程 (2)，并利用 $\\mathbf{r}_{c_f \\to A} = -\\mathbf{r}_{A \\to c_f}$ 以及 $\\mathbf{r}_{c_f \\to \\text{COP}} - \\mathbf{r}_{c_f \\to A} = \\mathbf{r}_{A \\to \\text{COP}}$ 的关系进行代数运算，最终分离出 $M_A$ 得到求解方程：\n$$ M_A = I_f \\alpha_f + (\\mathbf{r}_{A \\to c_f} \\times m_f \\mathbf{a}_{c_f})_z - (\\mathbf{r}_{A \\to \\text{COP}} \\times \\mathbf{F}_G)_z - (\\mathbf{r}_{A \\to c_f} \\times \\mathbf{F}_g)_z - M_G $$\n这个关于净关节力矩的完整方程包括旋转惯性项 ($I_f \\alpha_f$)、由质心线性加速度引起的惯性效应，以及所有外力（GRF、重力）和外自由力矩 ($M_G$) 产生的力矩。\n\n要使用这个方程，我们必须首先确定全局坐标系中的未知量 $\\mathbf{r}_{A \\to c_f}$、$\\mathbf{r}_{A \\to \\text{COP}}$ 和 $\\mathbf{a}_{c_f}$。\n\n**1. 坐标变换：**\n矢量 $\\mathbf{r}^{\\text{local}}_{A\\to c_f}$ 和 $\\mathbf{r}^{\\text{local}}_{A\\to \\text{COP}}$ 是在足部的局部坐标系中给出的。为了在全局坐标系中表示它们，我们应用足部方向角 $\\theta_f$ 进行旋转。逆时针角度 $\\theta_f$ 的旋转矩阵是：\n$$ R(\\theta_f) = \\begin{pmatrix} \\cos\\theta_f & -\\sin\\theta_f \\\\ \\sin\\theta_f & \\cos\\theta_f \\end{pmatrix} $$\n全局矢量是：\n$$ \\mathbf{r}_{A\\to c_f} = R(\\theta_f) \\cdot \\mathbf{r}^{\\text{local}}_{A\\to c_f} $$\n$$ \\mathbf{r}_{A\\to \\text{COP}} = R(\\theta_f) \\cdot \\mathbf{r}^{\\text{local}}_{A\\to \\text{COP}} $$\n\n**2. 运动学计算：**\n足部质心的加速度 $\\mathbf{a}_{c_f}$ 是使用刚体加速度方程计算的，给定踝关节的线性加速度 $\\mathbf{a}_A$ 和足部的角运动学参数（$\\omega_f, \\alpha_f$）：\n$$ \\mathbf{a}_{c_f} = \\mathbf{a}_A + \\boldsymbol{\\alpha}_f \\times \\mathbf{r}_{A\\to c_f} + \\boldsymbol{\\omega}_f \\times (\\boldsymbol{\\omega}_f \\times \\mathbf{r}_{A\\to c_f}) $$\n在二维中，对于 $\\mathbf{r} = [r_x, r_y]$，$\\boldsymbol{\\alpha} = [0, 0, \\alpha]$ 和 $\\boldsymbol{\\omega} = [0, 0, \\omega]$，叉积项解析为：\n$$ \\boldsymbol{\\alpha} \\times \\mathbf{r} = [-\\alpha r_y, \\alpha r_x] $$\n$$ \\boldsymbol{\\omega} \\times (\\boldsymbol{\\omega} \\times \\mathbf{r}) = -\\omega^2 \\mathbf{r} = [-\\omega^2 r_x, -\\omega^2 r_y] $$\n将这些代入加速度方程，得到 $\\mathbf{a}_{c_f} = [a_{c_f,x}, a_{c_f,y}]$ 的分量：\n$$ a_{c_f,x} = a_{Ax} - \\alpha_f r_{cy} - \\omega_f^2 r_{cx} $$\n$$ a_{c_f,y} = a_{Ay} + \\alpha_f r_{cx} - \\omega_f^2 r_{cy} $$\n其中 $\\mathbf{r}_{A\\to c_f} = [r_{cx}, r_{cy}]$ 是全局分量。\n\n**3. 力矩计算：**\n对于平面矢量 $\\mathbf{r}=[r_x, r_y]$ 和 $\\mathbf{F}=[F_x, F_y]$，力矩 $\\mathbf{M} = \\mathbf{r} \\times \\mathbf{F}$ 的 $z$ 分量是 $M_z = r_x F_y - r_y F_x$。我们将此应用于 $M_A$ 最终方程中的每一项。\n\n**算法摘要：**\n对于每个测试用例：\n1.  给定 $\\theta_f$，从其局部对应项计算全局矢量 $\\mathbf{r}_{A\\to c_f}$ 和 $\\mathbf{r}_{A\\to \\text{COP}}$。\n2.  使用全局 $\\mathbf{r}_{A\\to c_f}$ 和给定的 $\\mathbf{a}_A, \\omega_f, \\alpha_f$，计算质心的全局加速度 $\\mathbf{a}_{c_f}$。\n3.  计算 $M_A$ 最终方程中的每个力矩项：\n    a. 旋转惯性：$I_f \\alpha_f$\n    b. 平移惯性：$(\\mathbf{r}_{A \\to c_f} \\times m_f \\mathbf{a}_{c_f})_z$\n    c. 地面反作用力力矩：$-(\\mathbf{r}_{A \\to \\text{COP}} \\times \\mathbf{F}_G)_z$\n    d. 重力力矩：$-(\\mathbf{r}_{A \\to c_f} \\times \\mathbf{F}_g)_z$ 其中 $\\mathbf{F}_g = [0, -m_f g]$。\n    e. 地面自由力矩：$-M_G$\n4.  将这五项相加，求得踝关节力矩 $M_A$。\n\n此过程在以下代码中实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_ankle_moment(\n    m_f, I_f, r_local_cf, g,\n    theta_f, omega_f, alpha_f, a_A, F_G, M_G, r_local_cop\n):\n    \"\"\"\n    Calculates the ankle joint moment for the foot segment using inverse dynamics.\n\n    The calculation follows the derived equation of motion:\n    M_A = I_f*alpha_f + (r_A_cf x m_f*a_cf)_z - (r_A_cop x F_G)_z - (r_A_cf x F_g)_z - M_G\n\n    Args:\n        m_f (float): Foot mass in kg.\n        I_f (float): Foot moment of inertia about CoM in kg*m^2.\n        r_local_cf (np.ndarray): Local vector from ankle to foot CoM [x, y] in m.\n        g (float): Gravitational acceleration in m/s^2.\n        theta_f (float): Foot orientation angle in rad.\n        omega_f (float): Foot angular velocity in rad/s.\n        alpha_f (float): Foot angular acceleration in rad/s^2.\n        a_A (np.ndarray): Ankle joint linear acceleration [ax, ay] in m/s^2.\n        F_G (np.ndarray): Ground Reaction Force at COP [Fx, Fy] in N.\n        M_G (float): Free moment about the COP in N*m.\n        r_local_cop (np.ndarray): Local vector from ankle to COP [x, y] in m.\n\n    Returns:\n        float: The calculated ankle joint moment M_A in N*m.\n    \"\"\"\n    # Step 1: Coordinate Transformation\n    # Create the 2D rotation matrix for angle theta_f\n    cos_t = np.cos(theta_f)\n    sin_t = np.sin(theta_f)\n    R = np.array([[cos_t, -sin_t], [sin_t, cos_t]])\n\n    # Transform local vectors to the global frame\n    r_global_cf = R @ r_local_cf\n    r_global_cop = R @ r_local_cop\n    rcx, rcy = r_global_cf\n\n    # Step 2: Kinematics - Calculate Foot CoM Acceleration\n    # a_cf = a_A + alpha x r_A_cf + omega x (omega x r_A_cf)\n    a_Ax, a_Ay = a_A\n    a_cf_x = a_Ax - alpha_f * rcy - omega_f**2 * rcx\n    a_cf_y = a_Ay + alpha_f * rcx - omega_f**2 * rcy\n    a_cf = np.array([a_cf_x, a_cf_y])\n\n    # Step 3: Calculate Moment Terms for the M_A equation\n    # The equation is: M_A = term1 + term2 - term3 - term4 - term5\n\n    # Term 1: Rotational inertia term\n    term_I_alpha = I_f * alpha_f\n\n    # Term 2: Translational inertia term (moment of effective force m*a_cf)\n    # (r_A_cf x m_f*a_cf)_z\n    term_inertial_trans = m_f * np.cross(r_global_cf, a_cf)\n\n    # Term 3: Ground reaction force moment about the ankle\n    # (r_A_cop x F_G)_z\n    term_grf_moment = np.cross(r_global_cop, F_G)\n\n    # Term 4: Gravitational force moment about the ankle\n    # F_g = [0, -m_f*g]\n    # (r_A_cf x F_g)_z\n    F_g = np.array([0, -m_f * g])\n    term_grav_moment = np.cross(r_global_cf, F_g)\n\n    # Term 5: Ground free moment\n    term_free_moment = M_G\n\n    # Step 4: Assemble the final ankle joint moment M_A\n    M_A = term_I_alpha + term_inertial_trans - term_grf_moment - term_grav_moment - term_free_moment\n\n    return M_A\n\ndef solve():\n    # Define constants and mass properties valid for all cases\n    m_f = 1.2  # kg\n    I_f = 0.008  # kg*m^2\n    m_s = 3.5  # kg (not used for this specific problem)\n    I_s = 0.043  # kg*m^2 (not used)\n    r_local_cf = np.array([0.03, -0.02])  # m\n    g = 9.81  # m/s^2\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path)\n        {\n            'theta_f': 0.2, 'omega_f': 1.5, 'alpha_f': -10.0,\n            'a_A': np.array([0.5, 0.2]),\n            'F_G': np.array([120.0, 900.0]), 'M_G': 6.0,\n            'r_local_cop': np.array([0.06, -0.04])\n        },\n        # Case 2 (quasi-static)\n        {\n            'theta_f': 0.0, 'omega_f': 0.0, 'alpha_f': 0.0,\n            'a_A': np.array([0.0, 0.0]),\n            'F_G': np.array([0.0, 350.0]), 'M_G': 0.0,\n            'r_local_cop': np.array([0.05, -0.04])\n        },\n        # Case 3 (boundary: COP under ankle)\n        {\n            'theta_f': 0.3, 'omega_f': 2.0, 'alpha_f': 0.0,\n            'a_A': np.array([-0.2, 0.1]),\n            'F_G': np.array([50.0, 800.0]), 'M_G': -4.0,\n            'r_local_cop': np.array([0.0, -0.04])\n        },\n        # Case 4 (high-acceleration edge)\n        {\n            'theta_f': -0.1, 'omega_f': 0.0, 'alpha_f': 20.0,\n            'a_A': np.array([-1.0, 2.0]),\n            'F_G': np.array([100.0, 600.0]), 'M_G': 2.5,\n            'r_local_cop': np.array([0.07, -0.05])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Calculate the ankle joint moment for the current case\n        moment = calculate_ankle_moment(\n            m_f=m_f, I_f=I_f, r_local_cf=r_local_cf, g=g,\n            theta_f=case['theta_f'], omega_f=case['omega_f'], alpha_f=case['alpha_f'],\n            a_A=case['a_A'], F_G=case['F_G'], M_G=case['M_G'],\n            r_local_cop=case['r_local_cop']\n        )\n        # Round the result to three decimal places\n        results.append(round(moment, 3))\n\n    # Format the results into the required single-line string\n    result_str = f\"[{','.join(map(str, results))}]\"\n    \n    # Final print statement in the exact required format.\n    print(result_str)\n\nsolve()\n```"
        }
    ]
}