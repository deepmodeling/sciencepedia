{
    "hands_on_practices": [
        {
            "introduction": "本节练习是理解髌股关节力学的基础。我们将应用静态平衡原理，利用实验中可测量的数据来计算作用于髌骨的压缩力。在探索更复杂的关节负荷问题之前，掌握这一基本计算至关重要。",
            "id": "4197640",
            "problem": "一名受试者在三个膝关节屈曲角度下进行等长伸膝运动，同时通过测力计测量净外部伸膝力矩 $M_{k}(\\theta)$，通过成像测量关于胫股关节中心的髌腱力臂 $r_{t}(\\theta)$，以及通过动态磁共振成像 (MRI) 测量股四头肌腱与髌腱作用线之间的夹角 $\\phi(\\theta)$。髌骨被建模为一个无摩擦的滑轮，将股四头肌腱的力重新导向至髌腱，且髌骨的质量和惯性效应可忽略不计。所有角度均以度为单位。测量数据如下：\n- 在 $\\theta=30^{\\circ}$ 时：$M_{k}=85~\\text{N}\\cdot\\text{m}$，$r_{t}=0.045~\\text{m}$，$\\phi=25^{\\circ}$。\n- 在 $\\theta=60^{\\circ}$ 时：$M_{k}=120~\\text{N}\\cdot\\text{m}$，$r_{t}=0.040~\\text{m}$，$\\phi=45^{\\circ}$。\n- 在 $\\theta=90^{\\circ}$ 时：$M_{k}=110~\\text{N}\\cdot\\text{m}$，$r_{t}=0.035~\\text{m}$，$\\phi=65^{\\circ}$。\n\n利用髌骨和膝关节力学的静力平衡第一性原理，计算在 $\\theta=30^{\\circ}$、$\\theta=60^{\\circ}$ 和 $\\theta=90^{\\circ}$ 时髌股关节反作用力 $R(\\theta)$ 的大小。将每个值四舍五入到四位有效数字，并以牛顿为单位表示最终答案。",
            "solution": "首先对问题进行验证。\n\n### 步骤1：提取已知条件\n- 一名受试者进行等长伸膝运动。\n- 在三个膝关节屈曲角度下分析该系统：$\\theta = 30^{\\circ}$、$\\theta = 60^{\\circ}$ 和 $\\theta = 90^{\\circ}$。\n- 净外部伸膝力矩为 $M_{k}(\\theta)$。\n- 关于胫股关节中心的髌腱力臂为 $r_{t}(\\theta)$。\n- 股四头肌腱与髌腱作用线之间的夹角为 $\\phi(\\theta)$。\n- 髌骨被建模为无摩擦滑轮。\n- 髌骨的质量和惯性效应可忽略不计。\n- 所有角度均以度为单位。\n- 在 $\\theta=30^{\\circ}$ 时的数据：$M_{k}=85~\\text{N}\\cdot\\text{m}$，$r_{t}=0.045~\\text{m}$，$\\phi=25^{\\circ}$。\n- 在 $\\theta=60^{\\circ}$ 时的数据：$M_{k}=120~\\text{N}\\cdot\\text{m}$，$r_{t}=0.040~\\text{m}$，$\\phi=45^{\\circ}$。\n- 在 $\\theta=90^{\\circ}$ 时的数据：$M_{k}=110~\\text{N}\\cdot\\text{m}$，$r_{t}=0.035~\\text{m}$，$\\phi=65^{\\circ}$。\n- 目标是计算在每个角度下髌股关节反作用力的大小 $R(\\theta)$。\n- 最终值必须四舍五入到四位有效数字，并以牛顿为单位表示。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题根植于静力平衡和生物力学的既定原理。将髌骨建模为无摩擦滑轮是分析膝关节力的一个标准且公认的简化方法。\n- **适定性**：该问题提供了计算每个指定角度下反作用力的唯一解所需的所有数据和约束。\n- **客观性**：该问题使用精确、定量且无偏见的语言陈述。\n- **缺陷评估**：\n    - 该问题不违反任何基本科学原理。所提供的力矩、力臂和角度的数值对于最大等长收缩是符合生理实际的。\n    - 该问题不是隐喻性的，并且可以直接使用静力学定律进行形式化。它与髌股关节力学的主题高度相关。\n    - 问题设置完整且内部一致。\n    - 条件在物理上是合理的。\n    - 问题的结构清晰，并为每种情况导出一个唯一的、稳定的解。\n\n### 步骤3：结论与行动\n该问题有效。将提供完整的解。\n\n### 解题推导\n髌股关节反作用力 $R(\\theta)$ 的计算需要一个基于静力平衡原理的两步分析。\n\n**步骤1：计算髌腱力 $F_T(\\theta)$**\n\n净外部伸膝力矩 $M_k(\\theta)$ 由股四头肌肌群产生，并通过髌腱传递到胫骨。对于等长收缩，关节处于静态旋转平衡状态。由作用在其力臂 $r_t(\\theta)$ 上的髌腱力 $F_T(\\theta)$ 产生的内力矩，必须平衡所测量的伸膝力矩 $M_k(\\theta)$。\n\n关于胫股关节中心的力矩平衡方程为：\n$$ \\sum M_{\\text{knee}} = M_k(\\theta) - F_T(\\theta) \\cdot r_t(\\theta) = 0 $$\n求解髌腱力的大小可得：\n$$ F_T(\\theta) = \\frac{M_k(\\theta)}{r_t(\\theta)} $$\n\n**步骤2：计算髌股关节反作用力 $R(\\theta)$**\n\n髌骨本身被建模为一个处于静力平衡状态的受力体。它受到三个力的作用：股四头肌腱力 $\\vec{F}_Q$；髌腱力 $\\vec{F}_T$；以及髌股关节反作用力 $\\vec{R}$。由于髌骨质量可忽略不计，这些力的矢量和为零：\n$$ \\vec{F}_Q + \\vec{F}_T + \\vec{R} = \\vec{0} $$\n这意味着反作用力 $\\vec{R}$ 必须与两个肌腱力的合力大小相等、方向相反：\n$$ \\vec{R} = -(\\vec{F}_Q + \\vec{F}_T) $$\n因此，反作用力的大小 $R$ 为：\n$$ R = |\\vec{F}_Q + \\vec{F}_T| $$\n问题陈述髌骨作为一个无摩擦滑轮。这意味着张力在通过髌骨时是守恒的，所以股四头肌腱力和髌腱力的大小相等。我们将这个共同的大小记为 $F_{\\text{tendon}}(\\theta)$。\n$$ |\\vec{F}_Q| = |\\vec{F}_T| = F_{\\text{tendon}}(\\theta) = F_T(\\theta) $$\n矢量和的大小可以使用余弦定理求得。矢量 $\\vec{F}_Q$ 和 $\\vec{F}_T$ 之间的夹角由 $\\phi(\\theta)$ 给出。\n$$ R^2 = |\\vec{F}_Q|^2 + |\\vec{F}_T|^2 + 2|\\vec{F}_Q||\\vec{F}_T|\\cos(\\phi(\\theta)) $$\n将力的数量级代入为 $F_{\\text{tendon}}(\\theta)$：\n$$ R^2 = F_{\\text{tendon}}^2(\\theta) + F_{\\text{tendon}}^2(\\theta) + 2F_{\\text{tendon}}^2(\\theta)\\cos(\\phi(\\theta)) $$\n$$ R^2 = 2F_{\\text{tendon}}^2(\\theta)(1 + \\cos(\\phi(\\theta))) $$\n使用半角恒等式 $1 + \\cos(\\alpha) = 2\\cos^2(\\alpha/2)$：\n$$ R^2 = 2F_{\\text{tendon}}^2(\\theta) \\left(2\\cos^2\\left(\\frac{\\phi(\\theta)}{2}\\right)\\right) = 4F_{\\text{tendon}}^2(\\theta)\\cos^2\\left(\\frac{\\phi(\\theta)}{2}\\right) $$\n对两边取平方根，得到反作用力的大小：\n$$ R(\\theta) = 2 F_{\\text{tendon}}(\\theta) \\cos\\left(\\frac{\\phi(\\theta)}{2}\\right) $$\n将步骤1中得到的 $F_{\\text{tendon}}(\\theta) = F_T(\\theta)$ 表达式代入，我们得到最终公式：\n$$ R(\\theta) = 2 \\left( \\frac{M_k(\\theta)}{r_t(\\theta)} \\right) \\cos\\left(\\frac{\\phi(\\theta)}{2}\\right) $$\n\n**每个角度的计算：**\n\n**情况1：$\\theta = 30^{\\circ}$**\n已知：$M_{k}(30^{\\circ}) = 85~\\text{N}\\cdot\\text{m}$，$r_{t}(30^{\\circ}) = 0.045~\\text{m}$，$\\phi(30^{\\circ}) = 25^{\\circ}$。\n$$ R(30^{\\circ}) = 2 \\left( \\frac{85}{0.045} \\right) \\cos\\left(\\frac{25^{\\circ}}{2}\\right) = 2 \\left( \\frac{85}{0.045} \\right) \\cos(12.5^{\\circ}) $$\n$$ R(30^{\\circ}) \\approx 2 \\cdot (1888.88...) \\cdot (0.976296...) \\approx 3688.13~\\text{N} $$\n四舍五入到四位有效数字，$R(30^{\\circ}) = 3688~\\text{N}$。\n\n**情况2：$\\theta = 60^{\\circ}$**\n已知：$M_{k}(60^{\\circ}) = 120~\\text{N}\\cdot\\text{m}$，$r_{t}(60^{\\circ}) = 0.040~\\text{m}$，$\\phi(60^{\\circ}) = 45^{\\circ}$。\n$$ R(60^{\\circ}) = 2 \\left( \\frac{120}{0.040} \\right) \\cos\\left(\\frac{45^{\\circ}}{2}\\right) = 2 \\cdot (3000) \\cdot \\cos(22.5^{\\circ}) $$\n$$ R(60^{\\circ}) \\approx 6000 \\cdot (0.923880...) \\approx 5543.28~\\text{N} $$\n四舍五入到四位有效数字，$R(60^{\\circ}) = 5543~\\text{N}$。\n\n**情况3：$\\theta = 90^{\\circ}$**\n已知：$M_{k}(90^{\\circ}) = 110~\\text{N}\\cdot\\text{m}$，$r_{t}(90^{\\circ}) = 0.035~\\text{m}$，$\\phi(90^{\\circ}) = 65^{\\circ}$。\n$$ R(90^{\\circ}) = 2 \\left( \\frac{110}{0.035} \\right) \\cos\\left(\\frac{65^{\\circ}}{2}\\right) = 2 \\left( \\frac{110}{0.035} \\right) \\cos(32.5^{\\circ}) $$\n$$ R(90^{\\circ}) \\approx 2 \\cdot (3142.857...) \\cdot (0.843391...) \\approx 5300.91~\\text{N} $$\n四舍五入到四位有效数字，$R(90^{\\circ}) = 5301~\\text{N}$。\n\n计算得出在 $\\theta=30^{\\circ}$、$60^{\\circ}$ 和 $90^{\\circ}$ 时的髌股关节反作用力分别为 $3688~\\text{N}$、$5543~\\text{N}$ 和 $5301~\\text{N}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n3688  5543  5301\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "高关节反作用力本身并不能说明全部问题；该力如何在软骨上分布为压力，对关节健康至关重要。本练习在前一节的基础上，引入了接触应力的概念，并探讨了诸如髌骨倾斜等解剖学因素如何导致非均匀的压力分布。这有助于将抽象的力学概念与其对组织的生理影响联系起来。",
            "id": "4197634",
            "problem": "一名受试者在膝关节屈曲角为 $\\theta = 60^{\\circ}$ 时进行准静态伸膝运动。在此屈曲角度下，使用磁共振成像（MRI）分割技术测得的髌股接触面积 $A(\\theta)$ 为 $A(60^{\\circ}) = 5.2~\\text{cm}^{2}$。一个遵循 Newton 定律并强制执行静态平衡的肌肉骨骼模型，估计出合成的髌股关节压缩反作用力为 $R = 1.8 \\times 10^{3}~\\text{N}$。在轴向计算机断层扫描（CT）上测得的髌骨外侧倾斜角为 $\\alpha = 8^{\\circ}$。\n\n假设横跨内外侧宽度的局部接触压力场因倾斜而产生偏倚，并可理想化为叠加在均匀基线上的线性梯度分布，具体为 $p(x) = p_{m}\\left(1 + \\mu \\frac{2x}{W}\\right)$，适用于 $x \\in [-W/2, W/2]$，其中 $W$ 是有效接触宽度，$p_{m}$ 是一个未知的基线压力，$\\mu$ 是一个无量纲斜率参数。在这种理想化模型中，峰值压力出现在外侧偏倚边缘 $x = W/2$ 处，且在接触斑块上的空间平均值等于基线压力 $p_{m}$。为了反映 $\\mu$ 对倾斜角的依赖性，使用归一化几何校准 $\\mu(\\alpha) = \\tan(\\alpha)/\\tan(\\alpha_{0})$，其中 $\\alpha_{0} = 25^{\\circ}$ 代表一个校准倾斜角，在该角度下外侧偏倚达到参考斜率。\n\n使用平均压力的基本定义和所述的倾斜角依赖模型，首先确定在 $\\theta = 60^{\\circ}$ 时的平均接触压力 $p_{\\text{avg}}$，然后估计峰值接触压力 $p_{\\text{peak}}$。以兆帕斯卡（MPa）为单位表示最终所求量 $p_{\\text{peak}}$。角度以度为单位。将您报告的 $p_{\\text{peak}}$ 四舍五入到三位有效数字。",
            "solution": "目标是根据髌股关节反作用力 $R$ 和测量的接触面积 $A(\\theta)$ 计算平均接触压力 $p_{\\text{avg}}$，然后使用线性偏倚模型所隐含的倾斜角依赖的形状因子来估计峰值压力 $p_{\\text{peak}}$。\n\n从压力的基本定义（单位面积上的力）开始。对于作用在面积为 $A$ 的接触斑块上的非均匀压力场 $p(\\mathbf{x})$，在静态平衡状态下，合成的压缩反作用力 $R$ 为\n$$\nR = \\int_{A} p(\\mathbf{x}) \\,\\mathrm{d}A.\n$$\n空间平均压力 $p_{\\text{avg}}$ 的定义为\n$$\np_{\\text{avg}} = \\frac{1}{A} \\int_{A} p(\\mathbf{x}) \\,\\mathrm{d}A.\n$$\n结合以上两式，我们得到一般关系\n$$\np_{\\text{avg}} = \\frac{R}{A}.\n$$\n\n在给定的线性偏倚模型中，沿内外侧坐标 $x \\in [-W/2, W/2]$ 的局部压力为\n$$\np(x) = p_{m}\\left(1 + \\mu \\frac{2x}{W}\\right),\n$$\n其中 $p_{m}$ 是基线压力，$\\mu$ 是无量纲斜率。将此分布在接触宽度 $W$ 和任何纵向范围上积分，结果表明线性项是反对称的，其积分为零，因此空间平均值等于 $p_{m}$：\n$$p_{\\text{avg}} = p_{m}.$$\n在此模型中，峰值出现在外侧偏倚边缘 $x = W/2$ 处，得到\n$$\np_{\\text{peak}} = p\\left(\\frac{W}{2}\\right) = p_{m}\\left(1 + \\mu\\right) = \\left(1 + \\mu\\right) p_{\\text{avg}}.\n$$\n因此，峰均比形状因子为\n$$\n\\frac{p_{\\text{peak}}}{p_{\\text{avg}}} = 1 + \\mu.\n$$\n为了将 $\\mu$ 与倾斜角联系起来，我们采用给定的校准公式\n$$\n\\mu(\\alpha) = \\frac{\\tan(\\alpha)}{\\tan(\\alpha_{0})},\n$$\n其中 $\\alpha = 8^{\\circ}$ 且 $\\alpha_{0} = 25^{\\circ}$。\n\n现在根据 $R$ 和 $A(\\theta)$ 计算 $p_{\\text{avg}}$。首先将面积单位从平方厘米转换为平方米：\n$$\nA(60^{\\circ}) = 5.2~\\text{cm}^{2} = 5.2 \\times 10^{-4}~\\text{m}^{2}.\n$$\n那么\n$$\np_{\\text{avg}} = \\frac{R}{A} = \\frac{1.8 \\times 10^{3}~\\text{N}}{5.2 \\times 10^{-4}~\\text{m}^{2}} = \\frac{1.8 \\times 10^{3}}{5.2 \\times 10^{-4}}~\\text{Pa}.\n$$\n计算该商值：\n$$\n\\frac{1.8 \\times 10^{3}}{5.2 \\times 10^{-4}} = \\frac{1800}{0.00052} = 3.4615384615 \\times 10^{6}~\\text{Pa}.\n$$\n因此，\n$$\np_{\\text{avg}} = 3.4615384615~\\text{MPa}.\n$$\n\n接下来，使用以度为单位的角度计算 $\\mu(\\alpha)$，注意到当明确指明时，正切函数可以直接计算以度为单位的角度值：\n$$\n\\tan(8^{\\circ}) \\approx 0.140540833, \\quad \\tan(25^{\\circ}) \\approx 0.466307658,\n$$\n所以\n$$\n\\mu = \\frac{\\tan(8^{\\circ})}{\\tan(25^{\\circ})} \\approx \\frac{0.140540833}{0.466307658} \\approx 0.301375.\n$$\n因此形状因子为\n$$\n1 + \\mu \\approx 1.301375.\n$$\n最后，估计峰值压力：\n$$\np_{\\text{peak}} = (1 + \\mu) \\, p_{\\text{avg}} \\approx 1.301375 \\times 3.4615384615~\\text{MPa} \\approx 4.504759615~\\text{MPa}.\n$$\n按要求四舍五入到三位有效数字，\n$$\np_{\\text{peak}} \\approx 4.50~\\text{MPa}.\n$$\n所求的最终量是以兆帕斯卡（MPa）为单位的 $p_{\\text{peak}}$，并四舍五入到三位有效数字。",
            "answer": "$$\\boxed{4.50}$$"
        },
        {
            "introduction": "髌股关节力学不仅涉及矢状面内的压缩力，额状面内的稳定性对于防止髌骨脱位也至关重要。本练习要求您将所学知识综合到一个计算模型中，通过参数化分析来评估内侧髌股韧带（MPFL）等软组织结构对稳定性的贡献。这项练习反映了现代生物力学研究中常见的、基于模型的综合分析方法。",
            "id": "4197612",
            "problem": "你的任务是评估髌股关节 (PFJ) 压缩载荷的预测值如何响应内侧髌股韧带 (MPFL) 刚度的变化，并总结这种变化如何影响外侧稳定性余量。你需要构建一个程序，对每个测试用例的 MPFL 刚度进行参数扫描，并为每个用例输出一份总结。\n\n使用以下基于第一性原理的建模假设：\n- 髌骨在矢状面内充当一个无摩擦的滑轮，连接股四头肌腱和髌腱。在准静态条件下，股四头肌腱和髌腱的张力大小相等。\n- 应用静态平衡原理：每个关节节段的合力和合力矩必须平衡。\n- PFJ 压缩载荷是股四头肌腱和髌腱的力的矢量和的大小，这些力将髌骨压入滑车沟。\n- 在额状面内，通过比较在一个微小的外侧扰动下内侧约束分力之和与外侧驱动分力之和来评估外侧稳定性。\n- 内侧髌股韧带 (MPFL) 提供一个线性的弹性恢复力，其刚度单位为牛顿/米。\n\n下面提供的所有角度都以度为单位。你的实现必须在内部将角度转换为弧度以用于三角函数。所有力必须以牛顿 ($\\text{N}$) 表示，力矩以牛顿米 ($\\text{N}\\cdot\\text{m}$) 表示，刚度以牛顿/米 ($\\text{N/m}$) 表示，长度以米 ($\\text{m}$) 表示，外侧位移容差以米 ($\\text{m}$) 表示。\n\n需要实现的定义：\n- 设 $M_{\\text{ext}}$ 为外部膝关节屈曲力矩。设 $r_{\\text{eff}}$ 为股四头肌绕膝关节的有效力臂。在静态条件下，股四头肌力 $F_q$ 满足力矩平衡。\n- 在髌骨无摩擦滑轮的假设下，髌腱力 $F_p$ 的大小等于 $F_q$。\n- 设 $\\theta$ 为矢状面内的髌骨包裹角（股四头肌腱方向与髌腱方向之间的夹角）。PFJ 压缩反力的大小 $R$ 是 $F_q$ 和 $F_p$ 的矢量和的大小。\n- 设 $\\alpha_q$ 和 $\\alpha_p$ 为股四头肌腱和髌腱相对于矢状面的外侧方向角（在额状面内）。外侧驱动力是 $F_q$ 和 $F_p$ 的外侧分量之和。\n- 设 $\\mu$ 为 PFJ 接触面的摩擦系数。外侧摩擦阻力等于 $\\mu$ 乘以压缩反力的大小。\n- 设 $k$ 为 MPFL 刚度， $y_{\\text{tol}}$ 为一个微小的外侧位移容差。MPFL 提供的恢复力等于 $k$ 乘以 $y_{\\text{tol}}$。\n- 外侧稳定性余量 $S$ 定义为在 $y_{\\text{tol}}$ 处评估的内侧约束力之和减去外侧驱动分力。\n\n对于每个测试用例，对指定的 MPFL 刚度值 $\\{k_i\\}$ 进行参数扫描，并计算：\n1. PFJ 压缩载荷 $R$（单位：$\\text{N}$）。\n2. 每个 $k_i$ 对应的外侧稳定性余量 $S_i$。\n3. 扫描过程中外侧稳定性余量的最小值和最大值。\n\n测试套件（每个用例提供 $(M_{\\text{ext}}, r_{\\text{eff}}, \\theta, \\alpha_q, \\alpha_p, \\mu, y_{\\text{tol}}, \\{k_i\\})$）：\n- 用例 A（理想情况）：$(M_{\\text{ext}} = 50\\,\\text{N}\\cdot\\text{m}, r_{\\text{eff}} = 0.040\\,\\text{m}, \\theta = 35^\\circ, \\alpha_q = 12^\\circ, \\alpha_p = 7^\\circ, \\mu = 0.25, y_{\\text{tol}} = 0.002\\,\\text{m}, \\{0, 1500, 3000, 6000\\}\\,\\text{N/m})$。\n- 用例 B（极低约束的边界条件）：$(M_{\\text{ext}} = 60\\,\\text{N}\\cdot\\text{m}, r_{\\text{eff}} = 0.030\\,\\text{m}, \\theta = 60^\\circ, \\alpha_q = 15^\\circ, \\alpha_p = 8^\\circ, \\mu = 0.10, y_{\\text{tol}} = 0.001\\,\\text{m}, \\{0, 1000, 2000, 4000\\}\\,\\text{N/m})$。\n- 用例 C（高摩擦的边缘情况）：$(M_{\\text{ext}} = 20\\,\\text{N}\\cdot\\text{m}, r_{\\text{eff}} = 0.045\\,\\text{m}, \\theta = 20^\\circ, \\alpha_q = 12^\\circ, \\alpha_p = 12^\\circ, \\mu = 0.40, y_{\\text{tol}} = 0.003\\,\\text{m}, \\{500, 2000, 5000, 8000\\}\\,\\text{N/m})$。\n\n对于每个用例，还需确定在扫描的所有 $k_i$ 值下髌骨是否都处于外侧稳定状态，其定义为所有 $S_i \\ge 0$。\n\n你的程序应生成单行输出，其中包含每个测试用例的四个元素的列表：$[R, \\min S_i, \\max S_i, \\text{stable\\_all}]$，其中 $R$、$\\min S_i$ 和 $\\max S_i$ 是以牛顿为单位的浮点数，$\\text{stable\\_all}$ 是一个布尔值。将每个用例的列表聚合成一个单一的、用逗号分隔的列表，并用方括号括起来。例如：$[[R_1, \\min S_1, \\max S_1, \\text{True}], [R_2, \\min S_2, \\max S_2, \\text{False}], \\ldots]$。",
            "solution": "问题陈述已经过评估，被认为是有效的。它提出了一个有科学依据、适定且无矛盾的生物力学建模任务。其中的假设虽然经过简化，但在入门生物力学中是分析关节力的标准方法。所有必要的参数均已提供，目标也已明确定义。因此，我们可以着手提供一个正式的解决方案。\n\n该解决方案在一个简化的、解耦的髌股关节 (PFJ) 模型中综合了静力平衡和力分析的原理。分析分为矢状面部分（用于确定压缩载荷）和额状面部分（用于评估外侧稳定性）。\n\n**第一步：确定股四头肌腱力 ($F_q$)**\n在准静态条件下，外部膝关节屈曲力矩 $M_{\\text{ext}}$ 由股四头肌肌群产生的内部伸展力矩来平衡。该力矩是股四头肌腱力 $F_q$ 与其绕膝关节旋转中心的有效力臂 $r_{\\text{eff}}$ 的乘积。根据静力平衡原理，$\\sum M = 0$:\n$$M_{\\text{ext}} - F_q \\cdot r_{\\text{eff}} = 0$$\n因此，股四头肌力的大小为：\n$$F_q = \\frac{M_{\\text{ext}}}{r_{\\text{eff}}}$$\n\n**第二步：确定髌腱力 ($F_p$)**\n问题规定髌骨充当一个无摩擦滑轮。在此类系统中，张力通过相连的肌腱均等传递。因此，髌腱力 $F_p$ 的大小等于股四头肌力 $F_q$ 的大小：\n$$F_p = F_q$$\n\n**第三步：计算髌股关节 (PFJ) 压缩载荷 ($R$)**\nPFJ 压缩载荷 $R$ 是作用于髌骨的股四头肌腱和髌腱拉力的合力大小。这两个力矢量的大小分别为 $F_q$ 和 $F_p$（其中 $F_p = F_q$），在矢状面内被髌骨包裹角 $\\theta$ 分隔。它们的矢量和的大小可以通过在一个与角 $\\theta$ 的平分线对齐的坐标系中计算得出。这些力沿该平分线的分量之和即为合力的大小：\n$$R = 2 F_q \\cos\\left(\\frac{\\theta}{2}\\right)$$\n该压缩载荷 $R$ 充当垂直于髌骨和股骨关节面的法向力。所有以度为单位提供的角度（如 $\\theta$）都必须转换为弧度才能用于三角函数。\n\n**第四步：额状面内的力分析**\n外侧稳定性通过平衡额状面内的力来评估。假设存在一个微小的外侧位移 $y_{\\text{tol}}$。这些力被分为外侧驱动分力和内侧约束分力。\n\n*   **外侧驱动力 ($F_{\\text{lat\\_drive}}$)**：这是将髌骨向外侧拉动的净力。它是股四头肌腱和髌腱力的外侧分量之和。给定相对于矢状面的外侧方向角 $\\alpha_q$ 和 $\\alpha_p$，外侧驱动力为：\n    $$F_{\\text{lat\\_drive}} = F_q \\sin(\\alpha_q) + F_p \\sin(\\alpha_p)$$\n    由于 $F_p = F_q$，这可以简化为：\n    $$F_{\\text{lat\\_drive}} = F_q (\\sin(\\alpha_q) + \\sin(\\alpha_p))$$\n\n*   **内侧约束力**：这些力抵抗外侧驱动力并促进内侧稳定性。\n    1.  **摩擦阻力 ($F_{\\text{friction}}$)**：该力产生于髌骨和股骨滑车之间的接触。它使用库仑摩擦模型建模，其中摩擦力是摩擦系数 $\\mu$ 与法向力（即 PFJ 压缩载荷 $R$）的乘积。\n        $$F_{\\text{friction}} = \\mu R$$\n    2.  **MPFL 恢复力 ($F_{\\text{MPFL}}$)**：内侧髌股韧带 (MPFL) 被建模为一个线性弹性弹簧。当因外侧位移 $y_{\\text{tol}}$ 而被拉伸时，它提供一个与刚度 $k$ 成正比的内侧恢复力：\n        $$F_{\\text{MPFL}} = k \\cdot y_{\\text{tol}}$$\n\n**第五步：定义外侧稳定性余量 ($S$)**\n外侧稳定性余量 $S$ 定义为在位移 $y_{\\text{tol}}$ 处评估的所有内侧约束力之和减去总的外侧驱动力。非负的余量 ($S \\ge 0$) 表示稳定。\n$$S = (F_{\\text{friction}} + F_{\\text{MPFL}}) - F_{\\text{lat\\_drive}}$$\n代入各项的推导表达式，我们得到给定 MPFL 刚度 $k_i$ 时 $S$ 的计算公式：\n$$S_i = (\\mu R + k_i y_{\\text{tol}}) - F_q (\\sin(\\alpha_q) + \\sin(\\alpha_p))$$\n\n**第六步：参数扫描与输出生成**\n对于每个测试用例，程序将首先计算与 MPFL 刚度 $k$ 无关的常数值 $F_q$ 和 $R$。然后，它将遍历给定的刚度值集合 $\\{k_i\\}$。对于每个 $k_i$，它将计算相应的稳定性余量 $S_i$。\n计算出余量集合 $\\{S_i\\}$ 后，程序将确定：\n1.  最小稳定性余量 $\\min S_i$。\n2.  最大稳定性余量 $\\max S_i$。\n3.  一个布尔标志 `stable_all`，当且仅当所有计算出的 $S_i \\ge 0$ 时为 `True`。\n\n每个用例的最终输出将是一个列表，包含计算出的 PFJ 载荷 $R$、最小和最大稳定性余量以及稳定性标志：$[R, \\min S_i, \\max S_i, \\text{stable\\_all}]$。然后，这些列表被聚合成一个包含所有测试用例的最终列表。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the patellofemoral joint mechanics problem.\n    It evaluates PFJ compressive loads and lateral stability margins\n    for a series of test cases, sweeping over a range of MPFL stiffness values.\n    \"\"\"\n\n    # Test suite: each tuple contains\n    # (M_ext, r_eff, theta, alpha_q, alpha_p, mu, y_tol, stiffness_sweep)\n    test_cases = [\n        # Case A: Happy path\n        (50, 0.040, 35, 12, 7, 0.25, 0.002, [0, 1500, 3000, 6000]),\n        # Case B: Boundary condition with very low restraint\n        (60, 0.030, 60, 15, 8, 0.10, 0.001, [0, 1000, 2000, 4000]),\n        # Case C: Edge case with high friction\n        (20, 0.045, 20, 12, 12, 0.40, 0.003, [500, 2000, 5000, 8000]),\n    ]\n\n    # This function processes a single test case.\n    def analyze_pfj(M_ext, r_eff, theta_deg, alpha_q_deg, alpha_p_deg, mu, y_tol, k_sweep):\n        \"\"\"\n        Calculates PFJ load and lateral stability for a single set of parameters.\n\n        Args:\n            M_ext (float): External knee flexion moment (N*m).\n            r_eff (float): Effective moment arm of the quadriceps (m).\n            theta_deg (float): Patellar wrap angle (degrees).\n            alpha_q_deg (float): Lateral orientation of quadriceps tendon (degrees).\n            alpha_p_deg (float): Lateral orientation of patellar tendon (degrees).\n            mu (float): Friction coefficient at PFJ interface.\n            y_tol (float): Small lateral displacement tolerance (m).\n            k_sweep (list of float): MPFL stiffness values to sweep (N/m).\n\n        Returns:\n            list: [R, min_S, max_S, stable_all]\n                  R (float): PFJ compressive load (N).\n                  min_S (float): Minimum lateral stability margin (N).\n                  max_S (float): Maximum lateral stability margin (N).\n                  stable_all (bool): True if stable for all k values, False otherwise.\n        \"\"\"\n        # Convert angles from degrees to radians for trigonometric functions\n        theta_rad = np.deg2rad(theta_deg)\n        alpha_q_rad = np.deg2rad(alpha_q_deg)\n        alpha_p_rad = np.deg2rad(alpha_p_deg)\n\n        # Step 1  2: Calculate quadriceps and patellar tendon force (F_q = F_p)\n        F_q = M_ext / r_eff\n\n        # Step 3: Calculate PFJ compressive load (R)\n        R = 2 * F_q * np.cos(theta_rad / 2)\n\n        # Step 4: Calculate lateral forces\n        # Lateral driving force\n        F_lat_drive = F_q * (np.sin(alpha_q_rad) + np.sin(alpha_p_rad))\n        # Frictional restraining force\n        F_friction = mu * R\n        \n        # Step 5  6: Parametric sweep for stability margin S\n        S_margins = []\n        for k in k_sweep:\n            # MPFL restoring force\n            F_mpfl = k * y_tol\n            # Lateral stability margin\n            S = (F_friction + F_mpfl) - F_lat_drive\n            S_margins.append(S)\n\n        # Step 7: Summarize results\n        min_S = min(S_margins)\n        max_S = max(S_margins)\n        stable_all = all(s >= 0 for s in S_margins)\n\n        return [R, min_S, max_S, stable_all]\n\n    results = []\n    for case in test_cases:\n        result = analyze_pfj(*case)\n        results.append(result)\n    \n    # Format the final output string exactly as required, removing spaces.\n    final_output_string = str(results).replace(\" \", \"\")\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}