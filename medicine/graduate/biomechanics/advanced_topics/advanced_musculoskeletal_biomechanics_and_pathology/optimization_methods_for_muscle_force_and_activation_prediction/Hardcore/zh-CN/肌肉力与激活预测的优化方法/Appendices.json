{
    "hands_on_practices": [
        {
            "introduction": "在我们深入研究复杂的多肌肉系统之前，通过一个简化的模型来建立直观理解至关重要。本练习将引导您解决一个经典的双肌单关节问题，即从第一性原理出发，利用卡罗需-库恩-塔克（KKT）条件，以符号形式推导出最优肌肉激活策略。通过这个过程，您将清晰地看到二次优化如何在协同肌之间分配负荷，并理解当肌肉激活达到其生理极限时，解的结构会如何变化。",
            "id": "4196004",
            "problem": "考虑一个具有两条主动肌（索引为 $i \\in \\{1,2\\}$）的单自由度关节。设 $F_{\\max,i}  0$ 表示肌肉 $i$ 的最大等长力，$r_i  0$ 表示其绕关节的恒定力臂。由肌肉激活度 $a_1$ 和 $a_2$（无量纲，范围为 $0 \\le a_i \\le 1$）产生的关节力矩由刚体动力学中的静力平衡关系给出，\n$$\n\\tau = F_{\\max,1} r_1 a_1 + F_{\\max,2} r_2 a_2.\n$$\n你的任务是通过求解以下凸二次优化问题来预测肌肉激活度\n$$\n\\min_{a_1,a_2} \\;\\; a_1^2 + a_2^2\n$$\n约束条件为力矩匹配等式和激活度边界 $0 \\le a_i \\le 1$。假设 $F_{\\max,i}$ 和 $r_i$ 是已知的正常数，定义 $c_i = F_{\\max,i} r_i$，并假设一个可行的力矩需求 $0 \\le \\tau \\le c_1 + c_2$。从静力力矩平衡的第一性原理和 Karush–Kuhn–Tucker (KKT) 最优性条件出发，推导出最优激活度 $a_1^{\\star}$ 和 $a_2^{\\star}$ 作为 $\\tau$、$c_1$ 和 $c_2$ 的函数的闭式符号表达式，并描述边界 $a_i=1$ 变为激活状态的参数区域。\n\n请以最优激活度向量 $\\big(a_1^{\\star},a_2^{\\star}\\big)$ 的单一解析表达式形式提供最终答案，仅使用 $F_{\\max,i}$、$r_i$ 和 $\\tau$ 作为参数。如果使用了任何中间变量（例如 $c_i$），请在推导过程中明确定义它们。激活度是无量纲的，无需单位。最终答案必须是精确的，不得进行四舍五入。",
            "solution": "所述问题是一个标准的凸二次优化问题，在生物力学中常用于解决肌肉冗余问题。该问题具有科学依据、是良定的、客观且自洽的。目标函数是严格凸的，约束条件定义了一个非空、闭合的凸可行集。因此，保证存在唯一的最优解。该问题是有效的，可以使用所要求的第一性原理方法推导出解。\n\n任务是求解以下优化问题：\n$$\n\\min_{a_1, a_2} \\;\\; f(a_1, a_2) = a_1^2 + a_2^2\n$$\n约束条件为：\n$$\nh_1(a_1, a_2) = c_1 a_1 + c_2 a_2 - \\tau = 0\n$$\n$$\ng_1(a_1, a_2) = -a_1 \\le 0\n$$\n$$\ng_2(a_1, a_2) = -a_2 \\le 0\n$$\n$$\ng_3(a_1, a_2) = a_1 - 1 \\le 0\n$$\n$$\ng_4(a_1, a_2) = a_2 - 1 \\le 0\n$$\n其中我们定义了 $c_i = F_{\\max,i} r_i  0$ (对于 $i \\in \\{1, 2\\}$)。问题指明存在可行解，即 $0 \\le \\tau \\le c_1 + c_2$。\n\n由于这是一个带仿射约束的凸优化问题，Karush–Kuhn–Tucker (KKT) 条件是其最优性的充分必要条件。我们构建拉格朗日函数 $\\mathcal{L}$，其中 $\\lambda$ 是等式约束的拉格朗日乘子，$\\mu_1, \\mu_2, \\nu_1, \\nu_2$ 分别是四个不等式约束的非负乘子。\n$$\n\\mathcal{L}(a_1, a_2, \\lambda, \\mu_1, \\mu_2, \\nu_1, \\nu_2) = a_1^2 + a_2^2 + \\lambda(c_1 a_1 + c_2 a_2 - \\tau) - \\mu_1 a_1 - \\mu_2 a_2 + \\nu_1(a_1-1) + \\nu_2(a_2-1)\n$$\n对于最优解点 $(a_1^{\\star}, a_2^{\\star})$，KKT 条件如下：\n\n1.  **平稳性 (Stationarity)：** 拉格朗日函数对优化变量的梯度必须为零。\n    $$\n    \\frac{\\partial \\mathcal{L}}{\\partial a_1} = 2a_1^{\\star} + \\lambda c_1 - \\mu_1 + \\nu_1 = 0\n    $$\n    $$\n    \\frac{\\partial \\mathcal{L}}{\\partial a_2} = 2a_2^{\\star} + \\lambda c_2 - \\mu_2 + \\nu_2 = 0\n    $$\n\n2.  **原始可行性 (Primal Feasibility)：** 最优解点必须满足所有约束条件。\n    $$\n    c_1 a_1^{\\star} + c_2 a_2^{\\star} = \\tau\n    $$\n    $$\n    0 \\le a_1^{\\star} \\le 1, \\quad 0 \\le a_2^{\\star} \\le 1\n    $$\n\n3.  **对偶可行性 (Dual Feasibility)：** 不等式约束的乘子必须为非负。\n    $$\n    \\mu_1, \\mu_2, \\nu_1, \\nu_2 \\ge 0\n    $$\n\n4.  **互补松弛性 (Complementary Slackness)：** 不等式乘子与其对应的约束函数之积必须为零。\n    $$\n    \\mu_1 a_1^{\\star} = 0\n    $$\n    $$\n    \\mu_2 a_2^{\\star} = 0\n    $$\n    $$\n    \\nu_1 (a_1^{\\star} - 1) = 0\n    $$\n    $$\n    \\nu_2 (a_2^{\\star} - 1) = 0\n    $$\n\n我们通过讨论哪些约束是激活的来分情况分析解。由于 $\\tau \\ge 0$ 且 $c_i  0$，并且目标函数 $a_1^2+a_2^2$ 被最小化，最优激活度 $a_i^{\\star}$ 将为非负。如果 $\\tau=0$，唯一解是 $a_1^{\\star}=a_2^{\\star}=0$。对于 $\\tau0$ 的情况，至少有一个激活度必须为正。这意味着对于 $\\tau0$，下界 $a_i \\ge 0$ 将不会被激活，除非不需要该肌肉，而在这里情况并非如此，因为两条肌肉都是主动肌。因此，对于 $\\tau0$，我们可以假设 $\\mu_1=\\mu_2=0$。\n\n**情况1：上界均未激活（$0 \\le a_1^{\\star}  1$ 且 $0 \\le a_2^{\\star}  1$）。**\n根据互补松弛性，由于 $a_1^{\\star}  1$ 和 $a_2^{\\star}  1$，我们必有 $\\nu_1 = \\nu_2 = 0$。平稳性条件简化为：\n$$\n2a_1^{\\star} + \\lambda c_1 = 0 \\implies a_1^{\\star} = -\\frac{\\lambda c_1}{2}\n$$\n$$\n2a_2^{\\star} + \\lambda c_2 = 0 \\implies a_2^{\\star} = -\\frac{\\lambda c_2}{2}\n$$\n将这些代入力矩平衡方程：\n$$\nc_1 \\left(-\\frac{\\lambda c_1}{2}\\right) + c_2 \\left(-\\frac{\\lambda c_2}{2}\\right) = \\tau \\implies -\\frac{\\lambda}{2}(c_1^2 + c_2^2) = \\tau\n$$\n解出 $\\lambda$ 可得 $\\lambda = -\\frac{2\\tau}{c_1^2 + c_2^2}$。将其代回激活度的表达式中：\n$$\na_1^{\\star} = \\frac{c_1 \\tau}{c_1^2+c_2^2}\n$$\n$$\na_2^{\\star} = \\frac{c_2 \\tau}{c_1^2+c_2^2}\n$$\n只要初始假设（$a_1^{\\star}  1$ 且 $a_2^{\\star}  1$）成立，该解就有效。\n$a_1^{\\star}  1 \\iff \\frac{c_1 \\tau}{c_1^2+c_2^2}  1 \\iff \\tau  \\frac{c_1^2+c_2^2}{c_1}$。\n$a_2^{\\star}  1 \\iff \\frac{c_2 \\tau}{c_1^2+c_2^2}  1 \\iff \\tau  \\frac{c_1^2+c_2^2}{c_2}$。\n因此，该内部解在 $0 \\le \\tau  \\min\\left(\\frac{c_1^2+c_2^2}{c_1}, \\frac{c_1^2+c_2^2}{c_2}\\right) = \\frac{c_1^2+c_2^2}{\\max(c_1, c_2)}$ 的范围内有效。我们称这个阈值为 $\\tau_{sat}$。\n\n**情况2：肌肉1饱和，肌肉2未饱和（$a_1^{\\star}=1, 0 \\le a_2^{\\star}  1$）。**\n当 $\\tau$ 超过使 $a_1$ 首先达到其边界的阈值时，会出现这种情况，这发生在 $c_1 \\ge c_2$ 的条件下。根据互补松弛性，我们有 $\\nu_2=0$ 但 $\\nu_1 \\ge 0$。当 $a_1^{\\star}=1$ 时，力矩约束直接给出 $a_2^{\\star}$：\n$$\nc_1(1) + c_2 a_2^{\\star} = \\tau \\implies a_2^{\\star} = \\frac{\\tau - c_1}{c_2}\n$$\n如果 $0 \\le a_2^{\\star}  1$，该解有效。\n$a_2^{\\star} \\ge 0 \\implies \\tau - c_1 \\ge 0 \\implies \\tau \\ge c_1$。\n$a_2^{\\star}  1 \\implies \\tau - c_1  c_2 \\implies \\tau  c_1 + c_2$。\n从情况1到情况2的过渡发生在 $a_1^{\\star}$ 的内部解达到1时，即 $\\tau=\\frac{c_1^2+c_2^2}{c_1}$。注意 $\\frac{c_1^2+c_2^2}{c_1} = c_1 + \\frac{c_2^2}{c_1} \\ge c_1$。因此，这种情况的区域是 $\\frac{c_1^2+c_2^2}{c_1} \\le \\tau  c_1+c_2$。只有当 $\\frac{c_1^2+c_2^2}{c_1}  c_1+c_2$ 时，该区域才非空，这可以简化为 $c_1^2+c_2^2  c_1^2+c_1c_2 \\iff c_2^2  c_1c_2 \\iff c_2  c_1$。这证实了我们的预期，即肌肉1（具有更强的力矩产生能力）首先饱和。如果 $c_1=c_2$，该区间将坍缩为一个点。\n\n**情况3：肌肉2饱和，肌肉1未饱和（$a_2^{\\star}=1, 0 \\le a_1^{\\star}  1$）。**\n与情况2对称，这种情况发生在 $c_2 > c_1$ 的条件下。激活度为：\n$$\na_2^{\\star} = 1\n$$\n$$\na_1^{\\star} = \\frac{\\tau - c_2}{c_1}\n$$\n这在区域 $\\frac{c_1^2+c_2^2}{c_2} \\le \\tau  c_1+c_2$ 内有效。如果 $c_1  c_2$，该区域非空。\n\n**情况4：两条肌肉都饱和（$a_1^{\\star}=1, a_2^{\\star}=1$）。**\n这发生在最大可能力矩值处。力矩约束变为：\n$$\nc_1(1) + c_2(1) = \\tau \\implies \\tau = c_1+c_2\n$$\n这是可行力矩范围的上限，也是情况2和情况3的端点。\n\n**最优激活度与饱和区域总结**\n综合这些情况，最优激活度 $(a_1^{\\star}, a_2^{\\star})$ 基于力矩需求 $\\tau$ 有一个分段定义。设 $c_1 = F_{\\max,1}r_1$ 且 $c_2 = F_{\\max,2}r_2$。\n\n1.  **非饱和区域**：对于 $0 \\le \\tau  \\frac{c_1^2+c_2^2}{\\max(c_1, c_2)}$，两条肌肉的激活度都低于1。最优激活度按其力矩产生能力的比例进行分配：\n    $$\n    a_1^{\\star} = \\frac{c_1 \\tau}{c_1^2+c_2^2}, \\quad a_2^{\\star} = \\frac{c_2 \\tau}{c_1^2+c_2^2}\n    $$\n\n2.  **饱和区域**：当 $\\tau$ 足够大时，具有更大扭矩能力的肌肉，即 $\\max(c_1, c_2)$ 对应的肌肉，将首先饱和。\n    *   如果 $c_1 \\ge c_2$，肌肉1在 $\\tau \\ge \\frac{c_1^2+c_2^2}{c_1}$ 时饱和。激活度为：\n        $$\n        a_1^{\\star} = 1, \\quad a_2^{\\star} = \\frac{\\tau-c_1}{c_2}\n        $$\n    *   如果 $c_2 > c_1$，肌肉2在 $\\tau \\ge \\frac{c_1^2+c_2^2}{c_2}$ 时饱和。激活度为：\n        $$\n        a_1^{\\star} = \\frac{\\tau-c_2}{c_1}, \\quad a_2^{\\star} = 1\n        $$\n    这些关系一直有效，直到达到最大力矩 $\\tau = c_1+c_2$，届时两个激活度都变为1。\n\n这就完成了对解的描述。最终答案以最优激活度向量 $(a_1^{\\star}, a_2^{\\star})$ 的单一分段解析表达式形式在下面给出，并用原始问题参数表示。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix} a_1^{\\star}  a_2^{\\star} \\end{pmatrix} =\n\\begin{cases}\n\\begin{pmatrix} \\frac{(F_{\\max,1}r_1)\\tau}{(F_{\\max,1}r_1)^2 + (F_{\\max,2}r_2)^2}  \\frac{(F_{\\max,2}r_2)\\tau}{(F_{\\max,1}r_1)^2 + (F_{\\max,2}r_2)^2} \\end{pmatrix}  \\text{如果 } 0 \\le \\tau  \\frac{(F_{\\max,1}r_1)^2 + (F_{\\max,2}r_2)^2}{\\max(F_{\\max,1}r_1, F_{\\max,2}r_2)} \\\\\n\\\\\n\\begin{pmatrix} 1  \\frac{\\tau - F_{\\max,1}r_1}{F_{\\max,2}r_2} \\end{pmatrix}  \\text{如果 } F_{\\max,1}r_1 \\ge F_{\\max,2}r_2 \\text{ 且 } \\frac{(F_{\\max,1}r_1)^2 + (F_{\\max,2}r_2)^2}{F_{\\max,1}r_1} \\le \\tau \\le F_{\\max,1}r_1 + F_{\\max,2}r_2 \\\\\n\\\\\n\\begin{pmatrix} \\frac{\\tau - F_{\\max,2}r_2}{F_{\\max,1}r_1}  1 \\end{pmatrix}  \\text{如果 } F_{\\max,1}r_1  F_{\\max,2}r_2 \\text{ 且 } \\frac{(F_{\\max,1}r_1)^2 + (F_{\\max,2}r_2)^2}{F_{\\max,2}r_2} \\le \\tau \\le F_{\\max,1}r_1 + F_{\\max,2}r_2\n\\end{cases}\n}\n$$"
        },
        {
            "introduction": "现实世界中的生物力学模型通常涉及数十块肌肉和多个关节，这要求我们采用更通用的矩阵形式来构建优化问题。本练习不仅要求您为一般的二次静态优化问题推导 KKT 条件，更核心的目标是让您学会解读拉格朗日乘子。通过将这些乘子理解为“影子价格”，您将能够量化产生额外关节力矩的边际成本，或肌肉在饱和状态下所承受的“压力”，从而为优化结果提供深刻的经济学和生理学解释。",
            "id": "4196012",
            "problem": "考虑一个用于预测单关节等长任务中肌肉激活度的静态优化公式。设肌肉激活向量为 $\\mathbf{a} \\in \\mathbb{R}^{n}$，其分量 $a_{i}$ 表示肌肉 $i$ 最大激活度的分数，受限于 $0 \\leq a_{i} \\leq 1$。设关节力矩平衡表示为 $\\boldsymbol{\\tau} = M \\mathbf{a}$，其中 $\\boldsymbol{\\tau} \\in \\mathbb{R}^{m}$ 是指定的关节力矩向量，而 $M \\in \\mathbb{R}^{m \\times n}$ 是将激活度映射到净关节力矩的矩阵，该矩阵包含了力臂和等长条件下的归一化肌肉能力。设费力成本为 $J(\\mathbf{a}) = \\frac{1}{2} \\mathbf{a}^{\\top} Q \\mathbf{a}$，其中 $Q \\in \\mathbb{R}^{n \\times n}$ 是对称正定矩阵，表示对激活度的凸二次惩罚。\n\n从基本静态力矩平衡 $\\boldsymbol{\\tau} = M \\mathbf{a}$ 和边界 $0 \\leq a_{i} \\leq 1$ 出发，并使用标准不等式约束表示 $-a_{i} \\leq 0$ 和 $a_{i} - 1 \\leq 0$，完成以下任务：\n\n1. 为受力矩平衡和激活度边界约束的最小化 $J(\\mathbf{a})$ 的约束优化问题构建拉格朗日函数，并推导出全套 Karush–Kuhn–Tucker (KKT) 条件（平稳性、原始可行性、对偶可行性和互补松弛性）。在您的推导过程中，请明确指出与等式约束和不等式边界相关的拉格朗日乘子。\n2. 提供对拉格朗日乘子作为影子价格的原理性解释：描述与力矩平衡相关的乘子如何反映最优成本对指定力矩变化的敏感性，以及与激活度边界相关的乘子如何反映收紧或放宽这些边界的边际成本。\n3. 对一个具有 $n = 2$ 个肌肉和 $m = 1$ 个自由度的特定案例评估乘子。使用\n   $$\n   Q = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}, \\quad M = \\begin{pmatrix} 0.5  1.0 \\end{pmatrix}, \\quad \\boldsymbol{\\tau} = \\begin{pmatrix} 0.6 \\end{pmatrix}.\n   $$\n   计算在最优解处与力矩平衡相关的拉格朗日乘子（单个等式约束的标量乘子）。如果与您推导的 KKT 条件一致，则假设最优解严格位于激活度边界内。将您的最终数值答案四舍五入到四位有效数字，并以力矩的倒数单位表示，具体为 $\\text{(N·m)}^{-1}$。",
            "solution": "该问题要求建立并求解一个用于预测肌肉激活度的静态优化问题。这是一个经典的生物力学问题，通常被表述为一个凸二次规划 (QP)。我们将首先构建通用的 Karush–Kuhn–Tucker (KKT) 条件，然后解释由此产生的拉格朗日乘子，最后求解所给出的具体数值案例。\n\n该优化问题定义如下：\n最小化费力成本 $J(\\mathbf{a}) = \\frac{1}{2} \\mathbf{a}^{\\top} Q \\mathbf{a}$\n相对于激活向量 $\\mathbf{a} \\in \\mathbb{R}^{n}$。\n该最小化受限于三种类型的约束：\n1.  力矩平衡（等式约束）：$\\boldsymbol{\\tau} - M \\mathbf{a} = \\mathbf{0}$\n2.  激活度下界（不等式约束）：$-a_{i} \\leq 0$ 对 $i = 1, \\dots, n$\n3.  激活度上界（不等式约束）：$a_{i} - 1 \\leq 0$ 对 $i = 1, \\dots, n$\n\n在这里，$\\mathbf{a}$ 是肌肉激活向量，$Q$ 是定义二次成本的对称正定矩阵，$\\boldsymbol{\\tau}$ 是指定的关节力矩向量，$M$ 是将激活度映射到力矩的矩阵。由于 $Q$ 是正定的，目标函数 $J(\\mathbf{a})$ 是严格凸的。约束是线性的，定义了一个凸可行集。因此，这个 QP 有一个唯一的全局最小值。\n\n### 1. 拉格朗日函数和 KKT 条件\n\n为了解决这个约束优化问题，我们通过将目标函数与约束（由各自的拉格朗日乘子加权）相加来构建拉格朗日函数 $\\mathcal{L}$。设 $\\boldsymbol{\\lambda} \\in \\mathbb{R}^{m}$ 为等式约束的乘子向量，$\\boldsymbol{\\mu} \\in \\mathbb{R}^{n}$ 为下界不等式约束的乘子向量，$\\boldsymbol{\\nu} \\in \\mathbb{R}^{n}$ 为上界不等式约束的乘子向量。\n\n拉格朗日函数为：\n$$\n\\mathcal{L}(\\mathbf{a}, \\boldsymbol{\\lambda}, \\boldsymbol{\\mu}, \\boldsymbol{\\nu}) = J(\\mathbf{a}) + \\boldsymbol{\\lambda}^{\\top}(\\boldsymbol{\\tau} - M \\mathbf{a}) + \\boldsymbol{\\mu}^{\\top}(-\\mathbf{a}) + \\boldsymbol{\\nu}^{\\top}(\\mathbf{a} - \\mathbf{1})\n$$\n代入 $J(\\mathbf{a})$ 的表达式并展开各项，我们得到：\n$$\n\\mathcal{L}(\\mathbf{a}, \\boldsymbol{\\lambda}, \\boldsymbol{\\mu}, \\boldsymbol{\\nu}) = \\frac{1}{2} \\mathbf{a}^{\\top} Q \\mathbf{a} - \\boldsymbol{\\lambda}^{\\top}M \\mathbf{a} - \\boldsymbol{\\mu}^{\\top}\\mathbf{a} + \\boldsymbol{\\nu}^{\\top}\\mathbf{a} + \\boldsymbol{\\lambda}^{\\top}\\boldsymbol{\\tau} - \\boldsymbol{\\nu}^{\\top}\\mathbf{1}\n$$\n对于这个凸问题，Karush–Kuhn–Tucker (KKT) 条件提供了最优性的充要条件。它们是：\n\n1.  **平稳性**：拉格朗日函数关于原始变量 $\\mathbf{a}$ 的梯度在最优点 $(\\mathbf{a}^*, \\boldsymbol{\\lambda}^*, \\boldsymbol{\\mu}^*, \\boldsymbol{\\nu}^*)$ 处必须为零。\n    $$\n    \\nabla_{\\mathbf{a}} \\mathcal{L} = Q \\mathbf{a}^* - M^{\\top}\\boldsymbol{\\lambda}^* - \\boldsymbol{\\mu}^* + \\boldsymbol{\\nu}^* = \\mathbf{0}\n    $$\n2.  **原始可行性**：解 $\\mathbf{a}^*$ 必须满足所有原始约束。\n    $$\n    M \\mathbf{a}^* = \\boldsymbol{\\tau}\n    $$\n    $$\n    0 \\leq a_{i}^* \\leq 1 \\quad \\text{for } i = 1, \\dots, n\n    $$\n3.  **对偶可行性**：不等式约束的拉格朗日乘子必须为非负。\n    $$\n    \\mu_{i}^* \\geq 0 \\quad \\text{for } i = 1, \\dots, n\n    $$\n    $$\n    \\nu_{i}^* \\geq 0 \\quad \\text{for } i = 1, \\dots, n\n    $$\n4.  **互补松弛性**：每个不等式约束乘子与其对应松弛值的乘积必须为零。这意味着一个乘子只有在相应约束是激活的（即，等式成立）时才能为非零。\n    $$\n    \\mu_{i}^* a_{i}^* = 0 \\quad \\text{for } i = 1, \\dots, n\n    $$\n    $$\n    \\nu_{i}^* (a_{i}^* - 1) = 0 \\quad \\text{for } i = 1, \\dots, n\n    $$\n\n### 2. 将拉格朗日乘子解释为影子价格\n\n拉格朗日乘子有一个直接的经济学解释，即影子价格，表示最优目标值 $J^* = J(\\mathbf{a}^*)$ 对约束的无穷小松弛的敏感性。\n\n*   **力矩平衡乘子 ($\\boldsymbol{\\lambda}$)**：乘子 $\\boldsymbol{\\lambda}^*$ 量化了最优成本 $J^*$ 相对于指定力矩 $\\boldsymbol{\\tau}$ 变化的边际变化。具体来说，$\\lambda_{j}^* = \\frac{\\partial J^*}{\\partial \\tau_j}$。因此，$\\lambda_{j}^*$ 表示在关节 $j$ 产生额外单位力矩的边际成本。正值表示增加所需力矩将增加生理费力成本。\n\n*   **激活度边界乘子 ($\\boldsymbol{\\mu}, \\boldsymbol{\\nu}$)**：乘子 $\\boldsymbol{\\mu}^*$ 和 $\\boldsymbol{\\nu}^*$ 量化了与激活度边界相关的边际成本。\n    *   乘子 $\\mu_{i}^*$ 对应于下界 $a_i \\ge 0$。如果最优激活度 $a_{i}^*  0$，则该约束是非激活的，互补松弛性要求 $\\mu_{i}^* = 0$。如果 $a_{i}^* = 0$，则该约束是激活的，$\\mu_{i}^*$ 可以为正。它表示如果放宽下界（例如，如果允许肌肉 $i$ 具有负激活度），最优成本 $J^*$ 将会下降的速率。\n    *   乘子 $\\nu_{i}^*$ 对应于上界 $a_i \\le 1$。如果最优激活度 $a_{i}^*  1$，则该约束是非激活的，$\\nu_{i}^* = 0$。如果 $a_{i}^* = 1$（肌肉饱和），则该约束是激活的，$\\nu_{i}^*$ 可以为正。它表示如果放宽上界（即，如果肌肉的最大激活能力可以增加到超过 $1$），最优成本 $J^*$ 将会下降的速率。\n\n### 3. 具体案例的数值评估\n\n我们给定一个具有 $n=2$ 个肌肉和 $m=1$ 个自由度的系统。参数为：\n$$\nQ = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}, \\quad M = \\begin{pmatrix} 0.5  1.0 \\end{pmatrix}, \\quad \\boldsymbol{\\tau} = \\tau = 0.6\n$$\n由于 $m=1$，力矩 $\\boldsymbol{\\tau}$ 及其乘子 $\\boldsymbol{\\lambda}$ 是标量，记为 $\\tau$ 和 $\\lambda$。问题指示我们假设最优解严格位于激活度边界内，即 $0  a_{i}^*  1$ 对于 $i=1, 2$。\n\n在此假设下，下界和上界约束是非激活的。根据互补松弛性条件：\n*   $a_i^*  0 \\implies \\mu_i^* = 0$\n*   $a_i^*  1 \\implies a_i^* - 1 \\neq 0 \\implies \\nu_i^* = 0$\n\n因此，$\\boldsymbol{\\mu}^* = \\mathbf{0}$ 且 $\\boldsymbol{\\nu}^* = \\mathbf{0}$。KKT 条件简化为一个线性方程组：\n1.  平稳性：$Q \\mathbf{a}^* - M^{\\top} \\lambda^* = \\mathbf{0}$\n2.  原始可行性：$M \\mathbf{a}^* = \\tau$\n\n从平稳性方程，我们可以用 $\\lambda^*$ 表示 $\\mathbf{a}^*$：\n$$\n\\mathbf{a}^* = Q^{-1} M^{\\top} \\lambda^*\n$$\n将此代入原始可行性方程，得到：\n$$\nM (Q^{-1} M^{\\top} \\lambda^*) = \\tau \\implies (M Q^{-1} M^{\\top}) \\lambda^* = \\tau\n$$\n求解 $\\lambda^*$，我们得到：\n$$\n\\lambda^* = (M Q^{-1} M^{\\top})^{-1} \\tau\n$$\n我们现在计算此表达式中的各项。$Q$ 的逆矩阵是：\n$$\nQ^{-1} = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}^{-1} = \\begin{pmatrix} 1/2  0 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} 0.5  0 \\\\ 0  1.0 \\end{pmatrix}\n$$\n$M$ 的转置是：\n$$\nM^{\\top} = \\begin{pmatrix} 0.5 \\\\ 1.0 \\end{pmatrix}\n$$\n现在我们计算标量项 $M Q^{-1} M^{\\top}$：\n$$\nM Q^{-1} M^{\\top} = \\begin{pmatrix} 0.5  1.0 \\end{pmatrix} \\begin{pmatrix} 0.5  0 \\\\ 0  1.0 \\end{pmatrix} \\begin{pmatrix} 0.5 \\\\ 1.0 \\end{pmatrix}\n$$\n$$\n= \\begin{pmatrix} 0.5 \\times 0.5 + 1.0 \\times 0  0.5 \\times 0 + 1.0 \\times 1.0 \\end{pmatrix} \\begin{pmatrix} 0.5 \\\\ 1.0 \\end{pmatrix}\n$$\n$$\n= \\begin{pmatrix} 0.25  1.0 \\end{pmatrix} \\begin{pmatrix} 0.5 \\\\ 1.0 \\end{pmatrix} = (0.25 \\times 0.5) + (1.0 \\times 1.0) = 0.125 + 1.0 = 1.125\n$$\n现在我们可以计算 $\\lambda^*$：\n$$\n\\lambda^* = (1.125)^{-1} \\times 0.6 = \\frac{0.6}{1.125} = \\frac{8}{15}\n$$\n作为小数，$\\lambda^* \\approx 0.53333...$。四舍五入到四位有效数字，我们得到 $\\lambda^*=0.5333$。根据解释，$\\lambda^*$ 的单位是成本单位（无量纲）除以力矩单位（例如 $\\text{N·m}$），结果为 $(\\text{N·m})^{-1}$。\n\n为了完成求解，我们必须验证我们的初始假设 ($0  a_{i}^*  1$) 是一致的。我们计算最优激活向量 $\\mathbf{a}^*$：\n$$\n\\mathbf{a}^* = Q^{-1} M^{\\top} \\lambda^* = \\begin{pmatrix} 0.5  0 \\\\ 0  1.0 \\end{pmatrix} \\begin{pmatrix} 0.5 \\\\ 1.0 \\end{pmatrix} \\left(\\frac{8}{15}\\right) = \\begin{pmatrix} 0.25 \\\\ 1.0 \\end{pmatrix} \\frac{8}{15} = \\begin{pmatrix} 2/15 \\\\ 8/15 \\end{pmatrix}\n$$\n各个激活度为：\n$$\na_1^* = \\frac{2}{15} \\approx 0.1333\n$$\n$$\na_2^* = \\frac{8}{15} \\approx 0.5333\n$$\n由于 $0  2/15  1$ 且 $0  8/15  1$，我们关于解在激活度边界内部的假设得到了验证。因此，计算出的 $\\lambda^*$ 值是正确的。",
            "answer": "$$\\boxed{0.5333}$$"
        },
        {
            "introduction": "神经肌肉系统的控制策略往往不是为了优化单一目标，而是在多个相互冲突的生理需求之间寻求平衡。本练习将带您进入多目标优化的前沿领域，通过一个膝关节的实例，探索在最小化代谢能耗与降低关节剪切力风险之间的权衡。您将通过编写代码来实现一个帕累托分析，计算并比较不同权衡下的最优激活模式，并使用协同收缩指数（Co-Contraction Index, CCI）等指标来量化和解释这些复杂的控制策略。",
            "id": "4195942",
            "problem": "考虑一个准静态保持伸展的平面膝关节，其旋转加速度可以忽略不计，根据牛顿旋转运动第二定律，净扭矩等于所需的伸展扭矩。其基本原理是旋转平衡条件，在这种准静态情况下，该条件要求肌肉扭矩之和等于外部所需的关节扭矩。有两组肌肉作用于膝关节：集总股四头肌群（膝关节伸肌）和集总腘绳肌群（膝关节屈肌）。设股四头肌肌力为 $F_q$，腘绳肌肌力为 $F_h$，对应的膝关节力臂为 $r_q$ 和 $r_h$。当伸展扭矩定义为正时，$r_q  0$ 且 $r_h  0$。准静态扭矩平衡方程为\n$$\nr_q F_q + r_h F_h = T_{\\mathrm{req}},\n$$\n其中 $T_{\\mathrm{req}}$ 是膝关节所需的净伸展扭矩。肌肉力的模型为 $F_i = a_i F_{i,\\max}$（$i \\in \\{q,h\\}$），其中 $a_i \\in [0,1]$ 是肌肉激活度，$F_{i,\\max}  0$ 是最大肌力容量。\n\n我们考虑对肌肉激活度进行多目标优化 (MOO)，以平衡代谢消耗和前向剪切力缓解。第一个目标 $J_1$ 代表代谢消耗，模型为激活度的平方和，\n$$\nJ_1(a_q,a_h) = w_q a_q^2 + w_h a_h^2,\n$$\n其中 $w_q,w_h$ 为正常数权重。第二个目标 $J_2$ 代表胫骨前向剪切风险的代理指标，模型为两块肌肉剪切力贡献的平方差，\n$$\nJ_2(a_q,a_h) = \\left(c_q F_q - c_h F_h\\right)^2 = \\left(c_q F_{q,\\max} a_q - c_h F_{h,\\max} a_h\\right)^2,\n$$\n其中 $c_q0$ 和 $c_h0$ 是几何相关系数，用于将肌肉力映射为前向剪切力贡献。可行集由扭矩等式约束和边界约束 $0 \\le a_q \\le 1$、$0 \\le a_h \\le 1$ 定义。\n\n通过加权和方法生成一个帕累托解族：对于权衡参数 $\\alpha \\in [0,1]$，最小化\n$$\nJ_\\alpha(a_q,a_h) = \\alpha J_1(a_q,a_h) + (1-\\alpha) J_2(a_q,a_h),\n$$\n同时满足扭矩等式约束和激活度边界。权衡参数 $\\alpha$ 将解从 $\\alpha = 0$ 时优先缓解剪切力转变为 $\\alpha = 1$ 时优先考虑代谢消耗。\n\n从基本原理出发，通过代入扭矩平衡方程，将问题简化为单决策变量问题。定义 $A = r_q F_{q,\\max}  0$ 和 $B = r_h F_{h,\\max}  0$，可得\n$$\na_q = \\frac{T_{\\mathrm{req}} - B a_h}{A}.\n$$\n$a_h$ 的可行区间是使 $a_q$ 保持在 $[0,1]$ 且 $a_h$ 保持在 $[0,1]$ 内的值的集合。对于下文指定的膝关节伸展情况，其中 $T_{\\mathrm{req}} \\ge 0$ 且 $A \\ge T_{\\mathrm{req}}$，该区间为\n$$\na_h \\in \\left[0, \\min\\left(1, \\frac{A - T_{\\mathrm{req}}}{-B}\\right)\\right],\n$$\n因为 $-B0$ 且 $A - T_{\\mathrm{req}} \\ge 0$。在此区间内，一维目标函数 $J_\\alpha(a_h)$ 是关于 $a_h$ 的二次函数，最优解 $a_h^\\star$ 要么是区间内唯一的驻点（如果曲率为正），要么是区间的某个端点。\n\n将每个解的协同收缩指数定义为一个无量纲的度量，\n$$\n\\mathrm{CCI} = \\begin{cases}\n\\frac{2 \\min(F_q,F_h)}{F_q + F_h},  \\text{如果 } F_q + F_h > 0 \\\\ [6pt]\n0,  \\text{如果 } F_q + F_h = 0.\n\\end{cases}\n$$\n当只有一个肌肉激活时，该指数为 $0$；当两个肌肉的贡献几乎相等时，该指数接近 $1$。\n\n实现一个程序，对于下面测试套件中列出的每个测试用例，计算使 $J_\\alpha$（其中 $\\alpha \\in \\{0.0, 0.5, 1.0\\}$）最小化的最优激活度 $(a_q,a_h)$，然后将相应的 $\\mathrm{CCI}$ 值输出到一个嵌套列表中。不需要角度；没有要指定的角度单位。所有物理量均使用国际单位制 (SI)：扭矩单位为牛顿米 (N·m)，力单位为牛顿 (N)，力臂单位为米 (m)。激活度和协同收缩指数是无量纲的。\n\n测试套件：\n- 用例 1（正常路径，中等扭矩，剪切力调节相关）：$T_{\\mathrm{req}} = 40$ N·m, $r_q = 0.04$ m, $r_h = -0.03$ m, $F_{q,\\max} = 2000$ N, $F_{h,\\max} = 1500$ N, $w_q = 1$, $w_h = 1$, $c_q = 0.25$, $c_h = 0.20$。\n- 用例 2（边界可行性，股四头肌接近其能力极限）：$T_{\\mathrm{req}} = 80$ N·m, $r_q = 0.04$ m, $r_h = -0.03$ m, $F_{q,\\max} = 2000$ N, $F_{h,\\max} = 1500$ N, $w_q = 1$, $w_h = 1$, $c_q = 0.25$, $c_h = 0.20$。\n- 用例 3（低扭矩，更强的剪切力权重，鼓励协同收缩）：$T_{\\mathrm{req}} = 10$ N·m, $r_q = 0.04$ m, $r_h = -0.03$ m, $F_{q,\\max} = 2000$ N, $F_{h,\\max} = 1500$ N, $w_q = 1$, $w_h = 1$, $c_q = 0.60$, $c_h = 0.40$。\n- 用例 4（零扭矩，平凡平衡）：$T_{\\mathrm{req}} = 0$ N·m, $r_q = 0.04$ m, $r_h = -0.03$ m, $F_{q,\\max} = 2000$ N, $F_{h,\\max} = 1500$ N, $w_q = 1$, $w_h = 1$, $c_q = 0.25$, $c_h = 0.20$。\n\n您的程序应生成单行输出，其中包含四个测试用例在 $\\alpha \\in \\{0.0, 0.5, 1.0\\}$ 下的协同收缩指数值，以逗号分隔的嵌套列表形式按上述顺序排列。格式必须严格如下：\n$$\n[[\\mathrm{CCI}_{\\alpha=0.0}^{(1)}, \\mathrm{CCI}_{\\alpha=0.5}^{(1)}, \\mathrm{CCI}_{\\alpha=1.0}^{(1)}], [\\mathrm{CCI}_{\\alpha=0.0}^{(2)}, \\mathrm{CCI}_{\\alpha=0.5}^{(2)}, \\mathrm{CCI}_{\\alpha=1.0}^{(2)}], [\\mathrm{CCI}_{\\alpha=0.0}^{(3)}, \\mathrm{CCI}_{\\alpha=0.5}^{(3)}, \\mathrm{CCI}_{\\alpha=1.0}^{(3)}], [\\mathrm{CCI}_{\\alpha=0.0}^{(4)}, \\mathrm{CCI}_{\\alpha=0.5}^{(4)}, \\mathrm{CCI}_{\\alpha=1.0}^{(4)}]]\n$$\n其中上标表示测试用例索引，下标表示 $\\alpha$ 值。打印的输出必须是包含数值条目（浮点数）的有效 Python 列表字面量。",
            "solution": "该问题是有效的。它提出了一个有科学依据、适定的生物力学优化问题，并提供了所有必要的数据和约束。变量、目标和约束都得到了明确定义，从而可以得到一个形式化且唯一的解。\n\n问题的核心是找到肌肉激活度 $a_q$ 和 $a_h$，以对于不同的权衡参数 $\\alpha$ 最小化加权和目标函数 $J_\\alpha(a_q, a_h)$。该优化受代表扭矩平衡的线性等式约束和对激活度的箱型约束的限制。\n\n求解过程包括以下几个步骤：\n\n1.  **降维**：问题最初用两个决策变量 $a_q$ 和 $a_h$ 表示。扭矩平衡方程 $r_q F_q + r_h F_h = T_{\\mathrm{req}}$ 提供了一个线性等式约束。通过定义常数 $A = r_q F_{q,\\max}$ 和 $B = r_h F_{h,\\max}$，该约束可表示为 $A a_q + B a_h = T_{\\mathrm{req}}$。我们可以（因为 $A \\ne 0$）解出 $a_q$ 并将其代入目标函数，从而将问题简化为只有一个决策变量 $a_h$。\n    $$\n    a_q = \\frac{T_{\\mathrm{req}} - B a_h}{A}\n    $$\n\n2.  **目标函数推导**：组合目标函数为 $J_\\alpha(a_q,a_h) = \\alpha J_1 + (1-\\alpha) J_2$，其中 $J_1 = w_q a_q^2 + w_h a_h^2$ 且 $J_2 = (c_q F_{q,\\max} a_q - c_h F_{h,\\max} a_h)^2$。将 $a_q$ 的表达式代入 $J_\\alpha$ 可得到一维目标函数 $J_\\alpha(a_h)$。\n    \n    为清晰起见，我们定义额外的常数：$C_q = c_q F_{q,\\max}$ 和 $C_h = c_h F_{h,\\max}$。\n    \n    目标函数变为：\n    $$\n    J_\\alpha(a_h) = \\alpha \\left[ w_q \\left(\\frac{T_{\\mathrm{req}} - B a_h}{A}\\right)^2 + w_h a_h^2 \\right] + (1-\\alpha) \\left[ C_q \\left(\\frac{T_{\\mathrm{req}} - B a_h}{A}\\right) - C_h a_h \\right]^2\n    $$\n    展开此表达式表明 $J_\\alpha(a_h)$ 是 $a_h$ 的二次函数，可以写成标准形式 $J_\\alpha(a_h) = P a_h^2 + Q a_h + R$。系数 $P$ 和 $Q$ 为：\n    $$\n    P = \\alpha \\left[ w_q \\left(\\frac{B}{A}\\right)^2 + w_h \\right] + (1-\\alpha) \\left[ \\frac{C_q B}{A} + C_h \\right]^2\n    $$\n    $$\n    Q = -2 \\left[ \\alpha w_q \\frac{T_{\\mathrm{req}} B}{A^2} + (1-\\alpha) \\frac{C_q T_{\\mathrm{req}}}{A} \\left( \\frac{C_q B}{A} + C_h \\right) \\right]\n    $$\n    常数项 $R$ 不影响最小值的位置，因此优化过程不需要。由于所有权重 ($w_i$)、最大力 ($F_{i,max}$) 和系数 ($c_i$) 均为正，并且根据 $A$ 和 $B$ 的定义，可以证明对于 $\\alpha \\in [0,1)$ 和 $\\alpha=1$，$P > 0$。如果 $\\alpha=0$，$P$ 仅在特定几何条件下才能为零，而测试用例中不满足该条件。因此，目标函数是一个凸抛物线，保证了存在唯一的全局最小值。\n\n3.  **可行性分析**：变量 $a_h$ 受 $0 \\le a_h \\le 1$ 约束。代入的变量 $a_q$ 也必须在其边界 $0 \\le a_q \\le 1$ 内。这对 $a_h$ 施加了进一步的约束：\n    $$\n    0 \\le \\frac{T_{\\mathrm{req}} - B a_h}{A} \\le 1\n    $$\n    考虑到 $A  0$ 和 $-B  0$，并且在指定的情况下 $T_{\\mathrm{req}} \\ge 0$ 且 $A \\ge T_{\\mathrm{req}}$，这可简化为 $a_h$ 的一个可行区间：\n    $$\n    a_h \\in [a_{h,\\min}, a_{h,\\max}] = \\left[0, \\min\\left(1, \\frac{A - T_{\\mathrm{req}}}{-B}\\right)\\right]\n    $$\n\n4.  **优化**：二次函数 $J_\\alpha(a_h)$ 的无约束最小值出现在其顶点处，即导数为零的位置：$2 P a_h + Q = 0$。因此，驻点为：\n    $$\n    a_h^{\\mathrm{unc}} = -\\frac{Q}{2P}\n    $$\n    可行区间内的最优解 $a_h^\\star$ 可通过将此无约束最小值限制在区间 $[a_{h,\\min}, a_{h,\\max}]$ 内找到。\n    $$\n    a_h^\\star = \\max(a_{h,\\min}, \\min(a_h^{\\mathrm{unc}}, a_{h,\\max}))\n    $$\n    对于 $P=0$ 的特殊情况（线性目标），通过选择使函数最小化的区间端点来处理，具体选择哪个端点由 $Q$ 的符号决定。\n\n5.  **解的恢复与最终计算**：一旦找到最优腘绳肌激活度 $a_h^\\star$，就可以使用扭矩平衡方程计算出最优股四头肌激活度 $a_q^\\star$。\n    $$\n    a_q^\\star = \\frac{T_{\\mathrm{req}} - B a_h^\\star}{A}\n    $$\n    利用最优激活度 $(a_q^\\star, a_h^\\star)$，计算肌肉力为 $F_q = a_q^\\star F_{q,\\max}$ 和 $F_h = a_h^\\star F_{h,\\max}$。最后，根据其定义计算协同收缩指数 (CCI)：\n    $$\n    \\mathrm{CCI} = \\begin{cases}\n    \\frac{2 \\min(F_q,F_h)}{F_q + F_h},  \\text{如果 } F_q + F_h > 0 \\\\ [6pt]\n    0,  \\text{如果 } F_q + F_h = 0\n    \\end{cases}\n    $$\n对每个指定的测试用例和每个 $\\alpha \\in \\{0.0, 0.5, 1.0\\}$ 值应用此过程，以生成最终结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the muscle activation optimization problem for a series of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: T_req=40, r_q=0.04, r_h=-0.03, F_q_max=2000, F_h_max=1500, w_q=1, w_h=1, c_q=0.25, c_h=0.20\n        {\n            \"T_req\": 40.0, \"r_q\": 0.04, \"r_h\": -0.03, \"F_q_max\": 2000.0, \"F_h_max\": 1500.0,\n            \"w_q\": 1.0, \"w_h\": 1.0, \"c_q\": 0.25, \"c_h\": 0.20\n        },\n        # Case 2: T_req=80, r_q=0.04, r_h=-0.03, F_q_max=2000, F_h_max=1500, w_q=1, w_h=1, c_q=0.25, c_h=0.20\n        {\n            \"T_req\": 80.0, \"r_q\": 0.04, \"r_h\": -0.03, \"F_q_max\": 2000.0, \"F_h_max\": 1500.0,\n            \"w_q\": 1.0, \"w_h\": 1.0, \"c_q\": 0.25, \"c_h\": 0.20\n        },\n        # Case 3: T_req=10, r_q=0.04, r_h=-0.03, F_q_max=2000, F_h_max=1500, w_q=1, w_h=1, c_q=0.60, c_h=0.40\n        {\n            \"T_req\": 10.0, \"r_q\": 0.04, \"r_h\": -0.03, \"F_q_max\": 2000.0, \"F_h_max\": 1500.0,\n            \"w_q\": 1.0, \"w_h\": 1.0, \"c_q\": 0.60, \"c_h\": 0.40\n        },\n        # Case 4: T_req=0, r_q=0.04, r_h=-0.03, F_q_max=2000, F_h_max=1500, w_q=1, w_h=1, c_q=0.25, c_h=0.20\n        {\n            \"T_req\": 0.0, \"r_q\": 0.04, \"r_h\": -0.03, \"F_q_max\": 2000.0, \"F_h_max\": 1500.0,\n            \"w_q\": 1.0, \"w_h\": 1.0, \"c_q\": 0.25, \"c_h\": 0.20\n        }\n    ]\n\n    alpha_values = [0.0, 0.5, 1.0]\n    all_results = []\n\n    for params in test_cases:\n        case_results = []\n        for alpha in alpha_values:\n            cci = calculate_optimal_cci(params, alpha)\n            case_results.append(cci)\n        all_results.append(case_results)\n\n    # The required output format is a standard Python list representation.\n    # The default str() for a list of lists matches this format, including spaces.\n    print(all_results)\n\ndef calculate_optimal_cci(params, alpha):\n    \"\"\"\n    Calculates the Co-Contraction Index for a given set of parameters and alpha.\n    \"\"\"\n    # Extract parameters\n    T_req = params[\"T_req\"]\n    r_q, r_h = params[\"r_q\"], params[\"r_h\"]\n    F_q_max, F_h_max = params[\"F_q_max\"], params[\"F_h_max\"]\n    w_q, w_h = params[\"w_q\"], params[\"w_h\"]\n    c_q, c_h = params[\"c_q\"], params[\"c_h\"]\n    \n    # Pre-calculate constants\n    A = r_q * F_q_max\n    B = r_h * F_h_max\n    C_q = c_q * F_q_max\n    C_h = c_h * F_h_max\n\n    # Determine feasible interval for a_h\n    # The problem guarantees A > 0, -B > 0, and A >= T_req.\n    a_h_min = 0.0\n    a_h_max = np.min([1.0, (A - T_req) / (-B)])\n\n    # If the feasible interval is a single point, that's the solution.\n    if np.isclose(a_h_min, a_h_max):\n        a_h_opt = a_h_min\n    else:\n        # Coefficients for J1 (effort) part of the quadratic objective\n        # J1_term = p1 * a_h^2 + q1 * a_h + r1\n        p1 = w_q * (B / A)**2 + w_h\n        q1 = -2 * w_q * T_req * B / (A**2)\n\n        # Coefficients for J2 (shear) part of the quadratic objective\n        # J2_term = p2 * a_h^2 + q2 * a_h + r2\n        shear_coeff_in_a_h = C_q * B / A + C_h\n        p2 = shear_coeff_in_a_h**2\n        q2 = -2 * (C_q * T_req / A) * shear_coeff_in_a_h\n\n        # Total quadratic coefficients for J_alpha\n        # J_alpha = P * a_h^2 + Q * a_h + R\n        P = alpha * p1 + (1 - alpha) * p2\n        Q = alpha * q1 + (1 - alpha) * q2\n        \n        # Find the optimal a_h\n        if P > 1e-12: # Standard convex quadratic case\n            a_h_unc = -Q / (2 * P)\n            a_h_opt = np.clip(a_h_unc, a_h_min, a_h_max)\n        else: # Linear case (P is close to 0)\n            a_h_opt = a_h_min if Q >= 0 else a_h_max\n\n    # Calculate corresponding optimal a_q\n    a_q_opt = (T_req - B * a_h_opt) / A\n\n    # Calculate muscle forces\n    F_q = a_q_opt * F_q_max\n    F_h = a_h_opt * F_h_max\n\n    # Calculate Co-Contraction Index (CCI)\n    if F_q + F_h  1e-9:\n        cci = 0.0\n    else:\n        cci = 2.0 * np.min([F_q, F_h]) / (F_q + F_h)\n        \n    return cci\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}