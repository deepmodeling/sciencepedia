{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在帮助您掌握将生物力学系统转化为静态优化问题的第一步。通过一个等长收缩的假设场景，您将学习如何将描述单个肌肉力量的复杂关系，抽象并公式化为一个简洁的矩阵方程 。掌握这种从物理模型到数学表达的转换，是使用计算方法解决肌肉冗余问题的基础。",
            "id": "4195981",
            "problem": "考虑一个肌肉骨骼系统模型，该模型具有 $m$ 块肌肉，跨越 $n$ 个旋转自由度（关节）。设肌肉力向量为 $\\mathbf{F} \\in \\mathbb{R}^{m}$，肌肉激活度向量为 $\\mathbf{a} \\in \\mathbb{R}^{m}$，以及在静态姿势下满足逆动力学所需的净关节力矩向量为 $\\boldsymbol{\\tau} \\in \\mathbb{R}^{n}$。力臂矩阵 $R \\in \\mathbb{R}^{n \\times m}$ 的元素 $r_{j i}$ 表示肌肉 $i$ 相对于关节 $j$ 的带符号力臂；肌肉的净力矩贡献是肌肉力通过 $R$ 的线性映射。\n\n假设采用希尔型（Hill-type）肌肉模型，其中肌肉力与激活度、一个长度依赖因子和一个速度依赖因子成乘法关系。在等长收缩（isometric）情况下（所有关节 $j$ 的 $\\dot{\\theta}_{j} = 0$，因此关节角速度为零），速度依赖因子是固定的。假设姿势是固定的，因此每块肌肉的长度依赖因子也是固定的。在这些条件下，通常会进行线性化处理，其中每块肌肉的力与其激活度成正比，比例常数由最大等长收缩力和固定的长度依赖因子决定。\n\n从每个关节的旋转平衡和上述模型假设出发，推导静态优化（Static Optimization, SO）为匹配所需关节力矩必须满足的等式约束。用 $R$、最大等长收缩力向量 $\\mathbf{F}_{\\max} = \\left(F_{1,\\max}, \\dots, F_{m,\\max}\\right)^{\\top}$、固定长度因子向量 $\\mathbf{f}_{L} = \\left(f_{L,1}, \\dots, f_{L,m}\\right)^{\\top}$ 和激活度向量 $\\mathbf{a}$，将约束紧凑地表示为单个矩阵方程。你的最终答案必须是单个闭式解析表达式。最终表达式中不要包含任何单位。",
            "solution": "该问题陈述被评估为具有科学依据、问题明确且客观。所有必要信息均已提供，且术语在生物力学领域内是标准的。静态优化的等式约束推导是基于刚体动力学和肌肉建模原理的标准流程。因此，该问题被认为是有效的。\n\n目标是推导肌肉激活度向量 $\\mathbf{a}$ 为产生所需的净关节力矩向量 $\\boldsymbol{\\tau}$ 所必须满足的等式约束集。这些约束源于两个物理原理：关节处的旋转平衡和肌肉的力产生特性。\n\n首先，我们建立旋转平衡的条件。该系统包含 $n$ 个旋转自由度（关节）。为使肌肉骨骼系统处于静态平衡（或产生特定动态状态所需的净力矩，该力矩由逆动力学计算得出），由肌肉围绕每个关节产生的力矩总和必须等于该关节所需的净力矩。\n\n问题给出了动力学所需的净关节力矩向量 $\\boldsymbol{\\tau} \\in \\mathbb{R}^{n}$。肌肉对此力矩的贡献由力臂矩阵 $R \\in \\mathbb{R}^{n \\times m}$ 对肌肉力向量 $\\mathbf{F} \\in \\mathbb{R}^{m}$ 的线性变换给出。$R$ 的元素 $r_{ji}$ 表示肌肉 $i$ 相对于关节 $j$ 的力臂。因此，所有 $m$ 块肌肉产生的总力矩向量是矩阵-向量积 $R\\mathbf{F}$。\n\n因此，平衡方程为：\n$$R \\mathbf{F} = \\boldsymbol{\\tau}$$\n该方程代表一个包含 $n$ 个线性方程的系统，每个关节对应一个方程。\n\n接下来，我们必须对肌肉力向量 $\\mathbf{F}$ 进行建模。问题指定了在固定姿势下的等长收缩条件下，使用一个简化的希尔型（Hill-type）肌肉模型。在这种情况下，肌肉的产力能力仅取决于其激活水平 $a_i$、其最大等长收缩力 $F_{i,\\max}$ 以及一个考虑肌肉长度的因子 $f_{L,i}$。问题陈述肌肉力与激活度成正比。第 $i$ 块肌肉的力 $F_i$ 由下式给出：\n$$F_i = a_i F_{i,\\max} f_{L,i}$$\n在这里，$a_i$ 是肌肉 $i$ 的激活度，通常其取值范围为 $0 \\le a_i \\le 1$。$F_{i,\\max}$ 是肌肉在最佳条件下能产生的最大力。$f_{L,i}$ 是在给定姿势下的固定的、与长度相关的缩放因子。\n\n我们需要将所有肌肉的这种关系表示为单个向量方程。我们有激活度向量 $\\mathbf{a} = (a_1, \\dots, a_m)^{\\top}$，最大等长收缩力向量 $\\mathbf{F}_{\\max} = (F_{1,\\max}, \\dots, F_{m,\\max})^{\\top}$，以及固定长度因子向量 $\\mathbf{f}_{L} = (f_{L,1}, \\dots, f_{L,m})^{\\top}$。\n\n力 $F_i$ 是三个标量的乘积。为了用向量 $\\mathbf{a}$ 表示向量 $\\mathbf{F}$，我们注意到力的产生是一个逐元素操作。我们可以定义一个在给定姿势下的潜在力向量 $\\mathbf{F}_{\\text{pot}}$，其中每个元素为 $F_{i,\\max} f_{L,i}$。这可以用哈达玛积（Hadamard product）（逐元素积）来表示，记为 $\\odot$：\n$$\\mathbf{F}_{\\text{pot}} = \\mathbf{F}_{\\max} \\odot \\mathbf{f}_{L}$$\n那么，肌肉力向量 $\\mathbf{F}$ 是激活度向量 $\\mathbf{a}$ 和这个潜在力向量 $\\mathbf{F}_{\\text{pot}}$ 的逐元素积：\n$$\\mathbf{F} = \\mathbf{a} \\odot \\mathbf{F}_{\\text{pot}} = \\mathbf{a} \\odot (\\mathbf{F}_{\\max} \\odot \\mathbf{f}_{L})$$\n\n为了将其代入平衡的矩阵方程 $R \\mathbf{F} = \\boldsymbol{\\tau}$，最方便的方法是通过矩阵-向量积来表示逐元素乘法。我们可以构建一个对角矩阵，记为 $D \\in \\mathbb{R}^{m \\times m}$，其对角线元素是每块肌肉的潜在力。令 $D = \\text{diag}(\\mathbf{F}_{\\max} \\odot \\mathbf{f}_{L})$。对角线元素为 $D_{ii} = F_{i,\\max} f_{L,i}$，所有非对角线元素为 $0$。\n使用这个矩阵，肌肉力向量 $\\mathbf{F}$ 可以写成：\n$$\\mathbf{F} = D \\mathbf{a}$$\n这等价于逐元素积，因为 $(D\\mathbf{a})_i = D_{ii}a_i = (F_{i,\\max} f_{L,i}) a_i = F_i$。\n\n最后，我们将 $\\mathbf{F}$ 的这个表达式代回到旋转平衡方程中：\n$$R (D \\mathbf{a}) = \\boldsymbol{\\tau}$$\n展开矩阵 $D$ 的定义，我们得到静态优化（SO）必须满足的等式约束的最终表达式：\n$$R \\, \\text{diag}(\\mathbf{F}_{\\max} \\odot \\mathbf{f}_{L}) \\, \\mathbf{a} = \\boldsymbol{\\tau}$$\n这是一个单一、紧凑的矩阵方程，表示对向量 $\\mathbf{a}$ 中 $m$ 个未知肌肉激活度的 $n$ 个线性等式约束。左侧的矩阵乘积 $R \\, \\text{diag}(\\mathbf{F}_{\\max} \\odot \\mathbf{f}_{L})$ 形成一个大小为 $n \\times m$ 的常系数矩阵，该矩阵将激活度与所需的关节力矩联系起来。",
            "answer": "$$\\boxed{R \\, \\text{diag}(\\mathbf{F}_{\\max} \\odot \\mathbf{f}_{L}) \\, \\mathbf{a} = \\boldsymbol{\\tau}}$$"
        },
        {
            "introduction": "在建立了力矩平衡方程之后，我们如何求解最优的肌肉激活模式？本练习将通过一个经典的双肌单关节模型，引导您从第一性原理出发，利用Karush-Kuhn-Tucker (KKT) 条件推导出优化问题的符号解 。与仅依赖数值求解器不同，推导符号解能让您深刻理解在不同力矩需求下，肌肉是如何被招募的，以及何时会达到饱和状态。",
            "id": "4196004",
            "problem": "考虑一个具有两块协同肌的单自由度关节，肌肉索引为 $i \\in \\{1,2\\}$。令 $F_{\\max,i} > 0$ 表示肌肉 $i$ 的最大等长力，$r_i > 0$ 表示其绕关节的恒定力臂。由肌肉激活度 $a_1$ 和 $a_2$（无量纲，范围为 $0 \\le a_i \\le 1$）产生的关节力矩，可由刚体动力学中的静力平衡关系给出，\n$$\n\\tau = F_{\\max,1} r_1 a_1 + F_{\\max,2} r_2 a_2.\n$$\n您的任务是通过求解以下凸二次优化问题来预测肌肉激活度\n$$\n\\min_{a_1,a_2} \\;\\; a_1^2 + a_2^2\n$$\n其约束条件为力矩匹配等式和激活度边界 $0 \\le a_i \\le 1$。假设 $F_{\\max,i}$ 和 $r_i$ 是已知的正常数，定义 $c_i = F_{\\max,i} r_i$，并假设一个可行的力矩需求 $0 \\le \\tau \\le c_1 + c_2$。从静力矩平衡的第一性原理和 Karush–Kuhn–Tucker (KKT) 最优性条件出发，推导出最优激活度 $a_1^{\\star}$ 和 $a_2^{\\star}$ 作为 $\\tau$、$c_1$ 和 $c_2$ 的函数的闭式符号表达式，并描述边界 $a_i=1$ 变为激活状态的参数区域。\n\n请以最优激活度向量 $\\big(a_1^{\\star},a_2^{\\star}\\big)$ 的单个解析表达式形式提供您的最终答案，仅使用 $F_{\\max,i}$、$r_i$ 和 $\\tau$ 作为参数。如果您在推导中使用了任何中间变量（例如，$c_i$），请明确定义它们。激活度是无量纲的，不需要单位。最终答案必须是精确的，不得四舍五入。",
            "solution": "所述问题是一个标准的凸二次优化问题，在生物力学中常用于解决肌肉冗余问题。该问题具有科学依据，是适定的、客观且自洽的。目标函数是严格凸的，约束条件定义了一个非空、闭合的凸可行集。因此，保证存在唯一最优解。该问题是有效的，可以使用所要求的第一性原理方法推导出解。\n\n任务是求解以下优化问题：\n$$\n\\min_{a_1, a_2} \\;\\; f(a_1, a_2) = a_1^2 + a_2^2\n$$\n约束条件为：\n$$\nh_1(a_1, a_2) = c_1 a_1 + c_2 a_2 - \\tau = 0\n$$\n$$\ng_1(a_1, a_2) = -a_1 \\le 0\n$$\n$$\ng_2(a_1, a_2) = -a_2 \\le 0\n$$\n$$\ng_3(a_1, a_2) = a_1 - 1 \\le 0\n$$\n$$\ng_4(a_1, a_2) = a_2 - 1 \\le 0\n$$\n其中我们定义了 $c_i = F_{\\max,i} r_i > 0$，$i \\in \\{1, 2\\}$。问题指明存在可行解，即 $0 \\le \\tau \\le c_1 + c_2$。\n\n由于这是一个带有仿射约束的凸优化问题，Karush–Kuhn–Tucker (KKT) 条件是其最优性的充分必要条件。我们构建拉格朗日函数 $\\mathcal{L}$，其中 $\\lambda$ 是等式约束的拉格朗日乘子，$\\mu_1, \\mu_2, \\nu_1, \\nu_2$ 分别是四个不等式约束的非负乘子。\n$$\n\\mathcal{L}(a_1, a_2, \\lambda, \\mu_1, \\mu_2, \\nu_1, \\nu_2) = a_1^2 + a_2^2 + \\lambda(c_1 a_1 + c_2 a_2 - \\tau) - \\mu_1 a_1 - \\mu_2 a_2 + \\nu_1(a_1-1) + \\nu_2(a_2-1)\n$$\n对于最优点 $(a_1^{\\star}, a_2^{\\star})$，KKT 条件如下：\n\n1.  **平稳性 (Stationarity)：** 拉格朗日函数对优化变量的梯度必须为零。\n    $$\n    \\frac{\\partial \\mathcal{L}}{\\partial a_1} = 2a_1^{\\star} + \\lambda c_1 - \\mu_1 + \\nu_1 = 0\n    $$\n    $$\n    \\frac{\\partial \\mathcal{L}}{\\partial a_2} = 2a_2^{\\star} + \\lambda c_2 - \\mu_2 + \\nu_2 = 0\n    $$\n\n2.  **原始可行性 (Primal Feasibility)：** 最优点必须满足所有约束条件。\n    $$\n    c_1 a_1^{\\star} + c_2 a_2^{\\star} = \\tau\n    $$\n    $$\n    0 \\le a_1^{\\star} \\le 1, \\quad 0 \\le a_2^{\\star} \\le 1\n    $$\n\n3.  **对偶可行性 (Dual Feasibility)：** 不等式约束的乘子必须为非负。\n    $$\n    \\mu_1, \\mu_2, \\nu_1, \\nu_2 \\ge 0\n    $$\n\n4.  **互补松弛性 (Complementary Slackness)：** 不等式乘子与其对应的约束函数之积必须为零。\n    $$\n    \\mu_1 a_1^{\\star} = 0\n    $$\n    $$\n    \\mu_2 a_2^{\\star} = 0\n    $$\n    $$\n    \\nu_1 (a_1^{\\star} - 1) = 0\n    $$\n    $$\n    \\nu_2 (a_2^{\\star} - 1) = 0\n    $$\n\n我们通过考虑哪些约束是激活的，分情况分析解。由于 $\\tau \\ge 0$ 且 $c_i > 0$，并且目标函数 $a_1^2+a_2^2$ 被最小化，激活度 $a_i^{\\star}$ 将为非负。如果 $\\tau=0$，唯一解是 $a_1^{\\star}=a_2^{\\star}=0$。对于 $\\tau>0$，至少有一个激活度必须为正。这意味着对于 $\\tau>0$，下界约束 $a_i \\ge 0$ 不会是激活的，除非某个肌肉不需要发力，但在这里两块肌肉都是协同肌，所以不会出现这种情况。因此，对于 $\\tau>0$，我们可以假设 $\\mu_1=\\mu_2=0$。\n\n**情况 1：无上界约束被激活 ($0 \\le a_1^{\\star}  1$ 且 $0 \\le a_2^{\\star}  1$)。**\n根据互补松弛性，由于 $a_1^{\\star}  1$ 且 $a_2^{\\star}  1$，我们必然有 $\\nu_1 = \\nu_2 = 0$。平稳性条件简化为：\n$$\n2a_1^{\\star} + \\lambda c_1 = 0 \\implies a_1^{\\star} = -\\frac{\\lambda c_1}{2}\n$$\n$$\n2a_2^{\\star} + \\lambda c_2 = 0 \\implies a_2^{\\star} = -\\frac{\\lambda c_2}{2}\n$$\n将这些代入力矩平衡方程：\n$$\nc_1 \\left(-\\frac{\\lambda c_1}{2}\\right) + c_2 \\left(-\\frac{\\lambda c_2}{2}\\right) = \\tau \\implies -\\frac{\\lambda}{2}(c_1^2 + c_2^2) = \\tau\n$$\n求解 $\\lambda$ 得到 $\\lambda = -\\frac{2\\tau}{c_1^2 + c_2^2}$。将其代回激活度的表达式中：\n$$\na_1^{\\star} = \\frac{c_1 \\tau}{c_1^2+c_2^2}\n$$\n$$\na_2^{\\star} = \\frac{c_2 \\tau}{c_1^2+c_2^2}\n$$\n此解在初始假设成立的条件下有效，即 $a_1^{\\star}  1$ 且 $a_2^{\\star}  1$。\n$a_1^{\\star}  1 \\iff \\frac{c_1 \\tau}{c_1^2+c_2^2}  1 \\iff \\tau  \\frac{c_1^2+c_2^2}{c_1}$。\n$a_2^{\\star}  1 \\iff \\frac{c_2 \\tau}{c_1^2+c_2^2}  1 \\iff \\tau  \\frac{c_1^2+c_2^2}{c_2}$。\n因此，该内部解在 $0 \\le \\tau  \\min\\left(\\frac{c_1^2+c_2^2}{c_1}, \\frac{c_1^2+c_2^2}{c_2}\\right) = \\frac{c_1^2+c_2^2}{\\max(c_1, c_2)}$ 的范围内有效。我们称这个阈值为 $\\tau_{sat}$。\n\n**情况 2：肌肉 1 饱和，肌肉 2 未饱和 ($a_1^{\\star}=1, 0 \\le a_2^{\\star}  1$)。**\n这种情况发生在 $\\tau$ 超过阈值，使得 $a_1$ 首先达到其边界时，这在 $c_1 \\ge c_2$ 的条件下发生。根据互补松弛性，我们有 $\\nu_2=0$ 但 $\\nu_1 \\ge 0$。当 $a_1^{\\star}=1$ 时，力矩约束直接给出 $a_2^{\\star}$：\n$$\nc_1(1) + c_2 a_2^{\\star} = \\tau \\implies a_2^{\\star} = \\frac{\\tau - c_1}{c_2}\n$$\n此解在 $0 \\le a_2^{\\star}  1$ 时有效。\n$a_2^{\\star} \\ge 0 \\implies \\tau - c_1 \\ge 0 \\implies \\tau \\ge c_1$。\n$a_2^{\\star}  1 \\implies \\tau - c_1  c_2 \\implies \\tau  c_1 + c_2$。\n从情况 1 到情况 2 的过渡发生在 $a_1^{\\star}$ 的内部解达到 1 时，即在 $\\tau=\\frac{c_1^2+c_2^2}{c_1}$。注意 $\\frac{c_1^2+c_2^2}{c_1} = c_1 + \\frac{c_2^2}{c_1} \\ge c_1$。因此，这种情况的区域是 $\\frac{c_1^2+c_2^2}{c_1} \\le \\tau  c_1+c_2$。这个区域只有在 $\\frac{c_1^2+c_2^2}{c_1}  c_1+c_2$ 时才非空，这可以简化为 $c_1^2+c_2^2  c_1^2+c_1c_2 \\iff c_2^2  c_1c_2 \\iff c_2  c_1$。这证实了我们的预期，即肌肉 1（具有更强的力矩产生能力）首先饱和。如果 $c_1=c_2$，该区间坍缩为一个点。\n\n**情况 3：肌肉 2 饱和，肌肉 1 未饱和 ($a_2^{\\star}=1, 0 \\le a_1^{\\star}  1$)。**\n通过与情况 2 的对称性，这种情况在 $c_2 > c_1$ 时发生。激活度为：\n$$\na_2^{\\star} = 1\n$$\n$$\na_1^{\\star} = \\frac{\\tau - c_2}{c_1}\n$$\n这在区域 $\\frac{c_1^2+c_2^2}{c_2} \\le \\tau  c_1+c_2$ 内有效。这个区域在 $c_1  c_2$ 时非空。\n\n**情况 4：两块肌肉都饱和 ($a_1^{\\star}=1, a_2^{\\star}=1$)。**\n这发生在可能的最大力矩值处。力矩约束变为：\n$$\nc_1(1) + c_2(1) = \\tau \\implies \\tau = c_1+c_2\n$$\n这是可行力矩范围的上限，也是情况 2 和情况 3 的终点。\n\n**最优激活度和饱和区域总结**\n综合这些情况，最优激活度 $(a_1^{\\star}, a_2^{\\star})$ 具有基于力矩需求 $\\tau$ 的分段定义。令 $c_1 = F_{\\max,1}r_1$ 且 $c_2 = F_{\\max,2}r_2$。\n\n1.  **非饱和区**：对于 $0 \\le \\tau  \\frac{c_1^2+c_2^2}{\\max(c_1, c_2)}$，两块肌肉的激活度都低于 $1$。最优激活度按其力矩产生能力成比例分布：\n    $$\n    a_1^{\\star} = \\frac{c_1 \\tau}{c_1^2+c_2^2}, \\quad a_2^{\\star} = \\frac{c_2 \\tau}{c_1^2+c_2^2}\n    $$\n\n2.  **饱和区**：当 $\\tau$ 足够大时，具有较大力矩能力的肌肉 $\\max(c_1, c_2)$ 首先饱和。\n    *   如果 $c_1 \\ge c_2$，肌肉 1 在 $\\tau \\ge \\frac{c_1^2+c_2^2}{c_1}$ 时饱和。激活度为：\n        $$\n        a_1^{\\star} = 1, \\quad a_2^{\\star} = \\frac{\\tau-c_1}{c_2}\n        $$\n    *   如果 $c_2 > c_1$，肌肉 2 在 $\\tau \\ge \\frac{c_1^2+c_2^2}{c_2}$ 时饱和。激活度为：\n        $$\n        a_1^{\\star} = \\frac{\\tau-c_2}{c_1}, \\quad a_2^{\\star} = 1\n        $$\n    这些关系一直成立，直到最大力矩 $\\tau = c_1+c_2$，此时两个激活度都变为 $1$。\n\n至此完成了对解的描述。最终答案以下面单个分段解析表达式的形式给出，该表达式表示了激活度向量 $(a_1^{\\star}, a_2^{\\star})$ 与原始问题参数的关系。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix} a_1^{\\star}  a_2^{\\star} \\end{pmatrix} =\n\\begin{cases}\n\\begin{pmatrix} \\frac{(F_{\\max,1}r_1)\\tau}{(F_{\\max,1}r_1)^2 + (F_{\\max,2}r_2)^2}  \\frac{(F_{\\max,2}r_2)\\tau}{(F_{\\max,1}r_1)^2 + (F_{\\max,2}r_2)^2} \\end{pmatrix}  \\text{如果 } 0 \\le \\tau  \\frac{(F_{\\max,1}r_1)^2 + (F_{\\max,2}r_2)^2}{\\max(F_{\\max,1}r_1, F_{\\max,2}r_2)} \\\\\n\\\\\n\\begin{pmatrix} 1  \\frac{\\tau - F_{\\max,1}r_1}{F_{\\max,2}r_2} \\end{pmatrix}  \\text{如果 } F_{\\max,1}r_1 \\ge F_{\\max,2}r_2 \\text{ 且 } \\frac{(F_{\\max,1}r_1)^2 + (F_{\\max,2}r_2)^2}{F_{\\max,1}r_1} \\le \\tau \\le F_{\\max,1}r_1 + F_{\\max,2}r_2 \\\\\n\\\\\n\\begin{pmatrix} \\frac{\\tau - F_{\\max,2}r_2}{F_{\\max,1}r_1}  1 \\end{pmatrix}  \\text{如果 } F_{\\max,1}r_1  F_{\\max,2}r_2 \\text{ 且 } \\frac{(F_{\\max,1}r_1)^2 + (F_{\\max,2}r_2)^2}{F_{\\max,2}r_2} \\le \\tau \\le F_{\\max,1}r_1 + F_{\\max,2}r_2\n\\end{cases}\n}\n$$"
        },
        {
            "introduction": "真实的生物运动控制往往需要在多个相互竞争的目标之间取得平衡。本练习将挑战您从单目标优化走向更高级的多目标优化（MOO）框架，通过一个编程实践，探索在完成特定任务（如膝关节伸展）时，如何平衡“最小化代谢耗能”与“维持关节稳定性”（以减少胫骨前切力为代表）这两个目标 。通过调节不同目标的权重，您将亲手生成帕累托前沿（Pareto front）上的解，并量化不同策略下的协同收缩水平，这正是生物力学研究中的前沿应用。",
            "id": "4195942",
            "problem": "考虑一个在伸展状态下准静态保持的平面膝关节，因此旋转加速度可忽略不计，根据牛顿第二旋转定律，净扭矩等于所需的伸展扭矩。基本原理是旋转平衡条件，在这种准静态情况下，该条件要求肌肉扭矩之和等于外部所需的关节扭矩。有两组肌肉作用于膝关节：集总股四头肌群（膝关节伸肌）和集总腘绳肌群（膝关节屈肌）。设股四头肌肌力为 $F_q$，腘绳肌肌力为 $F_h$，相应的膝关节力臂为 $r_q$ 和 $r_h$。当伸展扭矩定义为正时，$r_q > 0$ 且 $r_h  0$。准静态扭矩平衡为\n$$\nr_q F_q + r_h F_h = T_{\\mathrm{req}},\n$$\n其中 $T_{\\mathrm{req}}$ 是膝关节所需的净伸展扭矩。肌肉力模型为 $F_i = a_i F_{i,\\max}$，其中 $i \\in \\{q,h\\}$，$a_i \\in [0,1]$ 是肌肉激活度，$F_{i,\\max} > 0$ 是最大肌力。\n\n我们考虑肌肉激活度的多目标优化（MOO），以平衡做功和前向剪切力缓和。第一个目标 $J_1$ 代表代谢功，模型为激活度的平方和，\n$$\nJ_1(a_q,a_h) = w_q a_q^2 + w_h a_h^2,\n$$\n其中权重 $w_q,w_h$ 为正。第二个目标 $J_2$ 代表胫骨前向剪切风险的替代指标，模型为两种肌肉产生的剪切力贡献的差的平方，\n$$\nJ_2(a_q,a_h) = \\left(c_q F_q - c_h F_h\\right)^2 = \\left(c_q F_{q,\\max} a_q - c_h F_{h,\\max} a_h\\right)^2,\n$$\n其中 $c_q>0$ 和 $c_h>0$ 是依赖于几何结构的系数，用于将肌肉力映射到前向剪切力贡献。可行集由扭矩相等约束和边界约束 $0 \\le a_q \\le 1$, $0 \\le a_h \\le 1$ 定义。\n\n通过加权和方法生成一个帕累托解族：对于一个权衡参数 $\\alpha \\in [0,1]$，最小化\n$$\nJ_\\alpha(a_q,a_h) = \\alpha J_1(a_q,a_h) + (1-\\alpha) J_2(a_q,a_h),\n$$\n同时满足扭矩相等约束和激活度边界。权衡参数 $\\alpha$ 将解从 $\\alpha = 0$ 时优先考虑剪切力缓和，转变为 $\\alpha = 1$ 时优先考虑做功。\n\n从第一性原理出发，通过代入扭矩平衡将问题简化为单个决策变量。定义 $A = r_q F_{q,\\max} > 0$ 和 $B = r_h F_{h,\\max}  0$，并写作\n$$\na_q = \\frac{T_{\\mathrm{req}} - B a_h}{A}.\n$$\n$a_h$ 的可行区间是能使 $a_q$ 保持在 $[0,1]$ 且 $a_h$ 保持在 $[0,1]$ 内的值的集合。对于下面指定的膝关节伸展情况，其中 $T_{\\mathrm{req}} \\ge 0$ 且 $A \\ge T_{\\mathrm{req}}$，该区间为\n$$\na_h \\in \\left[0, \\min\\left(1, \\frac{A - T_{\\mathrm{req}}}{-B}\\right)\\right],\n$$\n因为 $-B>0$ 且 $A - T_{\\mathrm{req}} \\ge 0$。在此区间内，一维目标函数 $J_\\alpha(a_h)$ 是关于 $a_h$ 的二次函数，最优解 $a_h^\\star$ 要么是区间内唯一的驻点（如果曲率为正），要么是端点。\n\n定义协同收缩指数为一个无量纲度量，\n$$\n\\mathrm{CCI} = \\begin{cases}\n\\dfrac{2 \\min(F_q,F_h)}{F_q + F_h},  \\text{当 } F_q + F_h > 0, \\\\\n0,  \\text{当 } F_q + F_h = 0.\n\\end{cases}\n$$\n当只有一个肌肉激活时，该指数为 $0$；当两个肌肉的贡献几乎相等时，该指数接近 $1$。\n\n实现一个程序，对于下面测试套件中列出的每个测试用例，计算使 $\\alpha \\in \\{0.0, 0.5, 1.0\\}$ 的 $J_\\alpha$ 最小化的最优激活度 $(a_q,a_h)$，然后在一个嵌套列表中输出相应的 $\\mathrm{CCI}$ 值。不需要角度；没有要指定的角度单位。所有物理量均使用国际单位制（SI）：扭矩单位为牛顿·米（N·m），力单位为牛顿（N），力臂单位为米（m）。激活度和协同收缩指数是无量纲的。\n\n测试套件：\n- 情况 $1$ (典型路径，中等扭矩，剪切力缓和相关): $T_{\\mathrm{req}} = 40$ N·m, $r_q = 0.04$ m, $r_h = -0.03$ m, $F_{q,\\max} = 2000$ N, $F_{h,\\max} = 1500$ N, $w_q = 1$, $w_h = 1$, $c_q = 0.25$, $c_h = 0.20$.\n- 情况 $2$ (边界可行性，股四头肌接近其能力极限): $T_{\\mathrm{req}} = 80$ N·m, $r_q = 0.04$ m, $r_h = -0.03$ m, $F_{q,\\max} = 2000$ N, $F_{h,\\max} = 1500$ N, $w_q = 1$, $w_h = 1$, $c_q = 0.25$, $c_h = 0.20$.\n- 情况 $3$ (低扭矩，更强的剪切力权重，鼓励协同收缩): $T_{\\mathrm{req}} = 10$ N·m, $r_q = 0.04$ m, $r_h = -0.03$ m, $F_{q,\\max} = 2000$ N, $F_{h,\\max} = 1500$ N, $w_q = 1$, $w_h = 1$, $c_q = 0.60$, $c_h = 0.40$.\n- 情况 $4$ (零扭矩，平凡平衡): $T_{\\mathrm{req}} = 0$ N·m, $r_q = 0.04$ m, $r_h = -0.03$ m, $F_{q,\\max} = 2000$ N, $F_{h,\\max} = 1500$ N, $w_q = 1$, $w_h = 1$, $c_q = 0.25$, $c_h = 0.20$.\n\n您的程序应生成一行输出，其中包含四个测试用例在 $\\alpha \\in \\{0.0, 0.5, 1.0\\}$ 下的协同收缩指数值的逗号分隔的嵌套列表，顺序如上所述。格式必须严格为：\n$$\n[[\\mathrm{CCI}_{\\alpha=0.0}^{(1)}, \\mathrm{CCI}_{\\alpha=0.5}^{(1)}, \\mathrm{CCI}_{\\alpha=1.0}^{(1)}], [\\mathrm{CCI}_{\\alpha=0.0}^{(2)}, \\mathrm{CCI}_{\\alpha=0.5}^{(2)}, \\mathrm{CCI}_{\\alpha=1.0}^{(2)}], [\\mathrm{CCI}_{\\alpha=0.0}^{(3)}, \\mathrm{CCI}_{\\alpha=0.5}^{(3)}, \\mathrm{CCI}_{\\alpha=1.0}^{(3)}], [\\mathrm{CCI}_{\\alpha=0.0}^{(4)}, \\mathrm{CCI}_{\\alpha=0.5}^{(4)}, \\mathrm{CCI}_{\\alpha=1.0}^{(4)}]]\n$$\n其中上标表示测试用例索引，下标表示 $\\alpha$ 值。打印的输出必须是带有数字（浮点数）条目的有效 Python 列表字面量。",
            "solution": "该问题是有效的。它提出了一个有科学依据、适定的生物力学优化问题，并提供了所有必要的数据和约束。变量、目标和约束都得到了清晰的定义，从而可以得出一个形式化且唯一的解。\n\n问题的核心是找到肌肉激活度 $a_q$ 和 $a_h$，对于不同的权衡参数 $\\alpha$，这些激活度能够最小化加权和目标函数 $J_\\alpha(a_q, a_h)$。该优化受到代表扭矩平衡的线性等式约束和激活度的箱式约束。\n\n求解过程分为几个步骤：\n\n1.  **降维**：问题最初用两个决策变量 $a_q$ 和 $a_h$ 来表述。扭矩平衡方程 $r_q F_q + r_h F_h = T_{\\mathrm{req}}$ 提供了一个线性等式约束。通过定义常数 $A = r_q F_{q,\\max}$ 和 $B = r_h F_{h,\\max}$，该约束表示为 $A a_q + B a_h = T_{\\mathrm{req}}$。我们可以解出 $a_q$（因为 $A \\ne 0$）并将其代入目标函数，从而将问题简化为单个决策变量 $a_h$。\n    $$\n    a_q = \\frac{T_{\\mathrm{req}} - B a_h}{A}\n    $$\n\n2.  **目标函数推导**：组合目标函数是 $J_\\alpha(a_q,a_h) = \\alpha J_1 + (1-\\alpha) J_2$，其中 $J_1 = w_q a_q^2 + w_h a_h^2$ 且 $J_2 = (c_q F_{q,\\max} a_q - c_h F_{h,\\max} a_h)^2$。将 $a_q$ 的表达式代入 $J_\\alpha$ 得到一维目标函数 $J_\\alpha(a_h)$。\n    \n    为清晰起见，我们定义额外的常数：$C_q = c_q F_{q,\\max}$ 和 $C_h = c_h F_{h,\\max}$。\n    \n    目标函数变为：\n    $$\n    J_\\alpha(a_h) = \\alpha \\left[ w_q \\left(\\frac{T_{\\mathrm{req}} - B a_h}{A}\\right)^2 + w_h a_h^2 \\right] + (1-\\alpha) \\left[ C_q \\left(\\frac{T_{\\mathrm{req}} - B a_h}{A}\\right) - C_h a_h \\right]^2\n    $$\n    展开此表达式表明 $J_\\alpha(a_h)$ 是 $a_h$ 的二次函数，可以写成标准形式 $J_\\alpha(a_h) = P a_h^2 + Q a_h + R$。系数 $P$ 和 $Q$ 为：\n    $$\n    P = \\alpha \\left[ w_q \\left(\\frac{B}{A}\\right)^2 + w_h \\right] + (1-\\alpha) \\left[ \\frac{C_q B}{A} + C_h \\right]^2\n    $$\n    $$\n    Q = -2 \\left[ \\alpha w_q \\frac{T_{\\mathrm{req}} B}{A^2} + (1-\\alpha) \\frac{C_q T_{\\mathrm{req}}}{A} \\left( \\frac{C_q B}{A} + C_h \\right) \\right]\n    $$\n    常数项 $R$ 不影响最小值的位置，因此在优化中不是必需的。由于所有权重 ($w_i$)、最大力 ($F_{i,max}$) 和系数 ($c_i$) 均为正，并且根据 $A$ 和 $B$ 的定义，可以证明对于 $\\alpha \\in [0,1)$ 和 $\\alpha=1$，$P > 0$。如果 $\\alpha=0$，$P$ 仅在特定几何条件下才能为零，而测试用例中不满足该条件。因此，目标函数是一个凸抛物线，保证了唯一的全局最小值。\n\n3.  **可行性分析**：变量 $a_h$ 的边界为 $0 \\le a_h \\le 1$。代入的变量 $a_q$ 也必须在其边界内，$0 \\le a_q \\le 1$。这对 $a_h$ 施加了进一步的约束：\n    $$\n    0 \\le \\frac{T_{\\mathrm{req}} - B a_h}{A} \\le 1\n    $$\n    考虑到 $A > 0$ 和 $-B > 0$，并且对于指定的 $T_{\\mathrm{req}} \\ge 0$ 和 $A \\ge T_{\\mathrm{req}}$ 的情况，这可以简化为 $a_h$ 的一个可行区间：\n    $$\n    a_h \\in [a_{h,\\min}, a_{h,\\max}] = \\left[0, \\min\\left(1, \\frac{A - T_{\\mathrm{req}}}{-B}\\right)\\right]\n    $$\n\n4.  **优化**：二次函数 $J_\\alpha(a_h)$ 的无约束最小值出现在其顶点处，该点导数为零：$2 P a_h + Q = 0$。因此驻点为：\n    $$\n    a_h^{\\mathrm{unc}} = -\\frac{Q}{2P}\n    $$\n    可行区间内的最优解 $a_h^\\star$ 通过将此无约束最小值“夹”在区间 $[a_{h,\\min}, a_{h,\\max}]$ 内得到。\n    $$\n    a_h^\\star = \\max(a_{h,\\min}, \\min(a_h^{\\mathrm{unc}}, a_{h,\\max}))\n    $$\n    当 $P=0$（线性目标）的特殊情况，通过选择能使函数最小化的区间端点来处理，这由 $Q$ 的符号决定。\n\n5.  **解的恢复与最终计算**：一旦找到最优腘绳肌激活度 $a_h^\\star$，就使用扭矩平衡方程计算最优股四头肌激活度 $a_q^\\star$。\n    $$\n    a_q^\\star = \\frac{T_{\\mathrm{req}} - B a_h^\\star}{A}\n    $$\n    利用最优激活度 $(a_q^\\star, a_h^\\star)$，肌肉力计算为 $F_q = a_q^\\star F_{q,\\max}$ 和 $F_h = a_h^\\star F_{h,\\max}$。最后，使用其定义计算协同收缩指数（CCI）：\n    $$\n    \\mathrm{CCI} = \\begin{cases}\n    \\dfrac{2 \\min(F_q,F_h)}{F_q + F_h},  \\text{当 } F_q + F_h > 0, \\\\\n    0,  \\text{当 } F_q + F_h = 0.\n    \\end{cases}\n    $$\n对每个指定的测试用例和每个 $\\alpha \\in \\{0.0, 0.5, 1.0\\}$ 值应用此过程，以生成最终结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the muscle activation optimization problem for a series of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: T_req=40, r_q=0.04, r_h=-0.03, F_q_max=2000, F_h_max=1500, w_q=1, w_h=1, c_q=0.25, c_h=0.20\n        {\n            \"T_req\": 40.0, \"r_q\": 0.04, \"r_h\": -0.03, \"F_q_max\": 2000.0, \"F_h_max\": 1500.0,\n            \"w_q\": 1.0, \"w_h\": 1.0, \"c_q\": 0.25, \"c_h\": 0.20\n        },\n        # Case 2: T_req=80, r_q=0.04, r_h=-0.03, F_q_max=2000, F_h_max=1500, w_q=1, w_h=1, c_q=0.25, c_h=0.20\n        {\n            \"T_req\": 80.0, \"r_q\": 0.04, \"r_h\": -0.03, \"F_q_max\": 2000.0, \"F_h_max\": 1500.0,\n            \"w_q\": 1.0, \"w_h\": 1.0, \"c_q\": 0.25, \"c_h\": 0.20\n        },\n        # Case 3: T_req=10, r_q=0.04, r_h=-0.03, F_q_max=2000, F_h_max=1500, w_q=1, w_h=1, c_q=0.60, c_h=0.40\n        {\n            \"T_req\": 10.0, \"r_q\": 0.04, \"r_h\": -0.03, \"F_q_max\": 2000.0, \"F_h_max\": 1500.0,\n            \"w_q\": 1.0, \"w_h\": 1.0, \"c_q\": 0.60, \"c_h\": 0.40\n        },\n        # Case 4: T_req=0, r_q=0.04, r_h=-0.03, F_q_max=2000, F_h_max=1500, w_q=1, w_h=1, c_q=0.25, c_h=0.20\n        {\n            \"T_req\": 0.0, \"r_q\": 0.04, \"r_h\": -0.03, \"F_q_max\": 2000.0, \"F_h_max\": 1500.0,\n            \"w_q\": 1.0, \"w_h\": 1.0, \"c_q\": 0.25, \"c_h\": 0.20\n        }\n    ]\n\n    alpha_values = [0.0, 0.5, 1.0]\n    all_results = []\n\n    for params in test_cases:\n        case_results = []\n        for alpha in alpha_values:\n            cci = calculate_optimal_cci(params, alpha)\n            case_results.append(cci)\n        all_results.append(case_results)\n\n    # The required output format is a standard Python list representation.\n    # The default str() for a list of lists matches this format, including spaces.\n    print(all_results)\n\ndef calculate_optimal_cci(params, alpha):\n    \"\"\"\n    Calculates the Co-Contraction Index for a given set of parameters and alpha.\n    \"\"\"\n    # Extract parameters\n    T_req = params[\"T_req\"]\n    r_q, r_h = params[\"r_q\"], params[\"r_h\"]\n    F_q_max, F_h_max = params[\"F_q_max\"], params[\"F_h_max\"]\n    w_q, w_h = params[\"w_q\"], params[\"w_h\"]\n    c_q, c_h = params[\"c_q\"], params[\"c_h\"]\n    \n    # Pre-calculate constants\n    A = r_q * F_q_max\n    B = r_h * F_h_max\n    C_q = c_q * F_q_max\n    C_h = c_h * F_h_max\n\n    # Determine feasible interval for a_h\n    # The problem guarantees A > 0, -B > 0, and A >= T_req.\n    a_h_min = 0.0\n    a_h_max = np.min([1.0, (A - T_req) / (-B)])\n\n    # If the feasible interval is a single point, that's the solution.\n    if np.isclose(a_h_min, a_h_max):\n        a_h_opt = a_h_min\n    else:\n        # Coefficients for J1 (effort) part of the quadratic objective\n        # J1_term = p1 * a_h^2 + q1 * a_h + r1\n        p1 = w_q * (B / A)**2 + w_h\n        q1 = -2 * w_q * T_req * B / (A**2)\n\n        # Coefficients for J2 (shear) part of the quadratic objective\n        # J2_term = p2 * a_h^2 + q2 * a_h + r2\n        shear_coeff_in_a_h = C_q * B / A + C_h\n        p2 = shear_coeff_in_a_h**2\n        q2 = -2 * (C_q * T_req / A) * shear_coeff_in_a_h\n\n        # Total quadratic coefficients for J_alpha\n        # J_alpha = P * a_h^2 + Q * a_h + R\n        P = alpha * p1 + (1 - alpha) * p2\n        Q = alpha * q1 + (1 - alpha) * q2\n        \n        # Find the optimal a_h\n        if P > 1e-12: # Standard convex quadratic case\n            a_h_unc = -Q / (2 * P)\n            a_h_opt = np.clip(a_h_unc, a_h_min, a_h_max)\n        else: # Linear case (P is close to 0)\n            a_h_opt = a_h_min if Q >= 0 else a_h_max\n\n    # Calculate corresponding optimal a_q\n    a_q_opt = (T_req - B * a_h_opt) / A\n\n    # Calculate muscle forces\n    F_q = a_q_opt * F_q_max\n    F_h = a_h_opt * F_h_max\n\n    # Calculate Co-Contraction Index (CCI)\n    if F_q + F_h  1e-9:\n        cci = 0.0\n    else:\n        cci = 2.0 * np.min([F_q, F_h]) / (F_q + F_h)\n        \n    return cci\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}