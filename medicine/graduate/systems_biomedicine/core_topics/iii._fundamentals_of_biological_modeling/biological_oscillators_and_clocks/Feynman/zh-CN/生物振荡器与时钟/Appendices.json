{
    "hands_on_practices": [
        {
            "introduction": "延迟负反馈是构成许多生物振荡器的基本结构模体。本练习提供了一个亲身实践的机会，让您对一个经典的转录-翻译反馈回路 (TTFL) 模型进行数学分析。通过执行线性稳定性分析，您将推导出触发持续振荡产生的临界条件——特别是最小时间延迟和分子协同性。",
            "id": "4319201",
            "problem": "考虑以下描述单个基因-蛋白质回路的延迟负反馈转录-翻译反馈回路（TTFL）模型，该模型包含蛋白质在经过一段有限的成熟/运输延迟后对自身转录的抑制：\n$$\n\\dot{m}(t)=\\frac{\\alpha}{1+\\left(\\frac{p(t-\\tau)}{K}\\right)^{n}}-\\gamma\\, m(t),\\qquad\n\\dot{p}(t)=\\beta\\, m(t)-\\delta\\, p(t)\n$$\n其中，$m(t)$ 和 $p(t)$ 分别表示信使核糖核酸（mRNA）和蛋白质的浓度；$\\alpha,\\beta,\\gamma,\\delta,K>0$，希尔系数 $n>0$，延迟 $\\tau \\ge 0$。假设参数满足标准的平滑性和正性，并且解在唯一的稳态附近进行研究。\n\n仅使用延迟微分方程（滞后型泛函微分方程）线性化和稳定性的基本原理，对该唯一平衡点进行线性稳定性分析，并导出通过霍普夫分岔产生振荡的条件。通过选择参数使得 $\\frac{\\alpha\\beta}{\\gamma\\delta}=2K$，施加一个实验上合理的校准，即稳态蛋白质水平等于抑制阈值 $p^{\\ast}=K$。在此校准下：\n- 确定允许存在非零霍普夫频率的希尔系数 $n$ 的最小值，以及\n- 推导当平衡点首次通过霍普夫分岔失去稳定性时的最小临界延迟 $\\tau_{c}$ 的显式闭式表达式，该表达式仅用 $n$、$\\gamma$ 和 $\\delta$ 表示。\n\n使用标准反三角函数（角度以弧度为单位）表示 $\\tau_{c}$。你最终报告的答案必须是这个关于 $\\tau_{c}(n,\\gamma,\\delta)$ 的单一闭式解析表达式。",
            "solution": "该问题要求对一个延迟负反馈基因回路模型进行线性稳定性分析，以确定霍普夫分岔的条件。具体来说，我们的任务是在一个特定的校准下，找到产生振荡的最小希尔系数 $n$，并推导出临界时间延迟 $\\tau_c$。\n\n首先，我们通过将时间导数设为零来确定系统的稳态 $(m^*, p^*)$：\n$$\n\\dot{m} = 0 \\implies \\frac{\\alpha}{1+\\left(\\frac{p^*}{K}\\right)^{n}} = \\gamma m^*\n$$\n$$\n\\dot{p} = 0 \\implies \\beta m^* = \\delta p^*\n$$\n从第二个方程，我们得到 $m^* = \\frac{\\delta p^*}{\\beta}$。将其代入第一个方程，得到：\n$$\n\\frac{\\alpha}{1+\\left(\\frac{p^*}{K}\\right)^{n}} = \\gamma \\frac{\\delta p^*}{\\beta}\n$$\n整理后得到一个关于稳态蛋白质浓度 $p^*$ 的单一方程：\n$$\np^* \\left(1 + \\left(\\frac{p^*}{K}\\right)^n\\right) = \\frac{\\alpha\\beta}{\\gamma\\delta}\n$$\n问题施加了校准条件 $\\frac{\\alpha\\beta}{\\gamma\\delta} = 2K$。将其代入稳态方程，得到：\n$$\np^* \\left(1 + \\left(\\frac{p^*}{K}\\right)^n\\right) = 2K\n$$\n经检验可知，$p^* = K$ 是一个解：$K(1 + (K/K)^n) = K(1+1) = 2K$。函数 $f(p^*) = p^*(1+(p^*/K)^n)$ 对 $p^*>0$ 是严格单调递增的，因此这是唯一的正稳态。相应的稳态mRNA浓度为 $m^* = \\frac{\\delta p^*}{\\beta} = \\frac{\\delta K}{\\beta}$。因此，唯一的平衡点是 $(m^*, p^*) = (\\frac{\\delta K}{\\beta}, K)$。\n\n接下来，我们在此平衡点附近对系统进行线性化。令 $u(t) = m(t) - m^*$ 和 $v(t) = p(t) - p^*$。线性化系统由 $\\dot{\\mathbf{x}}(t) = \\mathbf{J} \\mathbf{x}(t)$ 给出，其中 $\\mathbf{x}(t) = [u(t), v(t)]^T$，雅可比矩阵 $\\mathbf{J}$ 包含延迟项。\n$$\n\\begin{pmatrix} \\dot{u}(t) \\\\ \\dot{v}(t) \\end{pmatrix} = \\begin{pmatrix} \\frac{\\partial \\dot{m}}{\\partial m}  \\frac{\\partial \\dot{m}}{\\partial p_{\\tau}} \\\\ \\frac{\\partial \\dot{p}}{\\partial m}  \\frac{\\partial \\dot{p}}{\\partial p} \\end{pmatrix} \\begin{pmatrix} u(t) \\\\ v(t-\\tau) \\end{pmatrix}\n$$\n偏导数在稳态 $(m^*, p^*)$ 处计算：\n$J_{11} = \\frac{\\partial}{\\partial m} \\left[\\frac{\\alpha}{1+\\left(\\frac{p(t-\\tau)}{K}\\right)^{n}}-\\gamma m(t)\\right] \\bigg|_{(m^*,p^*)} = -\\gamma$\n$J_{12} = \\frac{\\partial}{\\partial p_{\\tau}} \\left[\\frac{\\alpha}{1+\\left(\\frac{p(t-\\tau)}{K}\\right)^{n}}-\\gamma m(t)\\right] \\bigg|_{p^*=K} = -\\alpha \\frac{n(p^*/K)^{n-1}(1/K)}{(1+(p^*/K)^n)^2} \\bigg|_{p^*=K} = -\\frac{\\alpha n}{4K}$\n$J_{21} = \\frac{\\partial}{\\partial m} \\left[\\beta m(t) - \\delta p(t)\\right] \\bigg|_{(m^*,p^*)} = \\beta$\n$J_{22} = \\frac{\\partial}{\\partial p} \\left[\\beta m(t) - \\delta p(t)\\right] \\bigg|_{(m^*,p^*)} = -\\delta$\n\n线性化系统为：\n$$\n\\dot{u}(t) = -\\gamma u(t) - \\frac{\\alpha n}{4K} v(t-\\tau)\n$$\n$$\n\\dot{v}(t) = \\beta u(t) - \\delta v(t)\n$$\n我们寻找形如 $(u(t), v(t)) = (u_0, v_0)e^{\\lambda t}$ 的解。代入此拟设，得到关于特征值 $\\lambda$ 的特征方程：\n$$\n\\det \\begin{pmatrix} \\lambda + \\gamma  \\frac{\\alpha n}{4K}e^{-\\lambda\\tau} \\\\ -\\beta  \\lambda + \\delta \\end{pmatrix} = 0\n$$\n$$\n(\\lambda + \\gamma)(\\lambda + \\delta) + \\frac{\\alpha\\beta n}{4K} e^{-\\lambda\\tau} = 0\n$$\n使用校准条件 $\\alpha\\beta = 2K\\gamma\\delta$，我们化简延迟项的系数：$\\frac{\\alpha\\beta n}{4K} = \\frac{2K\\gamma\\delta n}{4K} = \\frac{n\\gamma\\delta}{2}$。特征方程变为：\n$$\n(\\lambda + \\gamma)(\\lambda + \\delta) + \\frac{n\\gamma\\delta}{2} e^{-\\lambda\\tau} = 0\n$$\n当一对共轭复特征值穿过虚轴时，发生霍普夫分岔。我们设 $\\lambda = i\\omega_c$，其中 $\\omega_c > 0$ 为临界频率，$\\tau_c$ 为临界延迟。\n$$\n(i\\omega_c + \\gamma)(i\\omega_c + \\delta) + \\frac{n\\gamma\\delta}{2} e^{-i\\omega_c\\tau_c} = 0\n$$\n展开并整理：\n$$\n(-\\omega_c^2 + \\gamma\\delta) + i\\omega_c(\\gamma + \\delta) = -\\frac{n\\gamma\\delta}{2}(\\cos(\\omega_c\\tau_c) - i\\sin(\\omega_c\\tau_c))\n$$\n令实部和虚部分别相等：\n1. (实部) $-\\omega_c^2 + \\gamma\\delta = -\\frac{n\\gamma\\delta}{2} \\cos(\\omega_c\\tau_c) \\implies \\omega_c^2 - \\gamma\\delta = \\frac{n\\gamma\\delta}{2} \\cos(\\omega_c\\tau_c)$\n2. (虚部) $\\omega_c(\\gamma + \\delta) = \\frac{n\\gamma\\delta}{2} \\sin(\\omega_c\\tau_c)$\n\n为了求出 $\\omega_c$，我们通过将两个方程平方相加来消去 $\\tau_c$：\n$$\n(\\omega_c^2 - \\gamma\\delta)^2 + (\\omega_c(\\gamma + \\delta))^2 = \\left(\\frac{n\\gamma\\delta}{2}\\right)^2\n$$\n$$\n\\omega_c^4 - 2\\omega_c^2\\gamma\\delta + \\gamma^2\\delta^2 + \\omega_c^2(\\gamma^2 + 2\\gamma\\delta + \\delta^2) = \\frac{n^2\\gamma^2\\delta^2}{4}\n$$\n$$\n\\omega_c^4 + \\omega_c^2(\\gamma^2 + \\delta^2) + \\gamma^2\\delta^2(1 - \\frac{n^2}{4}) = 0\n$$\n这是一个关于 $\\omega_c^2$ 的一元二次方程。令 $W = \\omega_c^2$。对于霍普夫分岔，我们需要 $\\omega_c$ 有正实数解，这意味着 $W > 0$。二次方程 $W^2 + (\\gamma^2+\\delta^2)W + \\gamma^2\\delta^2(1 - n^2/4) = 0$ 的两根之和为 $-(\\gamma^2+\\delta^2)  0$。为了使其中一根为正，两根之积必须为负。\n$\\gamma^2\\delta^2\\left(1 - \\frac{n^2}{4}\\right)  0 \\implies 1 - \\frac{n^2}{4}  0 \\implies n^2 > 4$\n因为 $n0$，这意味着 $n > 2$。因此，允许存在非零霍普夫频率的希尔系数 $n$ 的最小值为 $2$。对于任意 $n  2$，$\\omega_c^2$ 存在唯一的正解：\n$$\n\\omega_c^2 = \\frac{-(\\gamma^2 + \\delta^2) + \\sqrt{(\\gamma^2 + \\delta^2)^2 - 4\\gamma^2\\delta^2(1 - n^2/4)}}{2}\n$$\n化简平方根下的项：\n$$\n(\\gamma^2 + \\delta^2)^2 - 4\\gamma^2\\delta^2 + n^2\\gamma^2\\delta^2 = \\gamma^4 + 2\\gamma^2\\delta^2 + \\delta^4 - 4\\gamma^2\\delta^2 + n^2\\gamma^2\\delta^2 = (\\gamma^2 - \\delta^2)^2 + n^2\\gamma^2\\delta^2\n$$\n所以，临界频率的平方为：\n$$\n\\omega_c^2 = \\frac{-(\\gamma^2 + \\delta^2) + \\sqrt{(\\gamma^2 - \\delta^2)^2 + n^2\\gamma^2\\delta^2}}{2}\n$$\n现在我们求最小的临界延迟 $\\tau_c  0$。从虚部方程可知，$\\sin(\\omega_c\\tau_c) = \\frac{2\\omega_c(\\gamma+\\delta)}{n\\gamma\\delta}$。因为所有参数和 $\\omega_c$ 都是正的，所以 $\\sin(\\omega_c\\tau_c)  0$。这意味着对于最小的正 $\\tau_c$，角 $\\omega_c\\tau_c$ 必须位于区间 $(0, \\pi)$ 内。反余弦函数 $\\arccos(x)$ 的值域是 $[0, \\pi]$，这使其成为合适的反函数。从实部方程可得：\n$$\n\\cos(\\omega_c\\tau_c) = \\frac{2(\\omega_c^2 - \\gamma\\delta)}{n\\gamma\\delta}\n$$\n应用反余弦函数，我们得到：\n$$\n\\omega_c\\tau_c = \\arccos\\left(\\frac{2(\\omega_c^2 - \\gamma\\delta)}{n\\gamma\\delta}\\right)\n$$\n因此，最小的临界延迟 $\\tau_c$ 为：\n$$\n\\tau_c = \\frac{1}{\\omega_c} \\arccos\\left(\\frac{2(\\omega_c^2 - \\gamma\\delta)}{n\\gamma\\delta}\\right)\n$$\n将 $\\omega_c$ (即 $\\omega_c^2$ 的平方根) 的表达式代入，即可得到仅用 $n$、$\\gamma$ 和 $\\delta$ 表示的 $\\tau_c$ 的最终显式闭式表达式。\n令 $\\omega_c = \\left(\\frac{-(\\gamma^2 + \\delta^2) + \\sqrt{(\\gamma^2 - \\delta^2)^2 + n^2\\gamma^2\\delta^2}}{2}\\right)^{1/2}$。\n反余弦函数自变量中的项 $\\omega_c^2 - \\gamma\\delta$ 是\n$$\n\\omega_c^2 - \\gamma\\delta = \\frac{-(\\gamma^2 + \\delta^2) - 2\\gamma\\delta + \\sqrt{(\\gamma^2 - \\delta^2)^2 + n^2\\gamma^2\\delta^2}}{2} = \\frac{-(\\gamma+\\delta)^2 + \\sqrt{(\\gamma^2 - \\delta^2)^2 + n^2\\gamma^2\\delta^2}}{2}\n$$\n$\\tau_c$ 的最终表达式是：\n$$\n\\tau_c = \\frac{1}{\\omega_c} \\arccos\\left(\\frac{-(\\gamma+\\delta)^2 + \\sqrt{(\\gamma^2 - \\delta^2)^2 + n^2\\gamma^2\\delta^2}}{n\\gamma\\delta}\\right)\n$$\n其中 $\\omega_c$ 如上定义。问题要求给出 $\\tau_c(n, \\gamma, \\delta)$ 的单一表达式。",
            "answer": "$$\n\\boxed{\\frac{1}{\\left(\\frac{-(\\gamma^2 + \\delta^2) + \\sqrt{(\\gamma^2 - \\delta^2)^2 + n^2\\gamma^2\\delta^2}}{2}\\right)^{\\frac{1}{2}}} \\arccos\\left(\\frac{-(\\gamma+\\delta)^2 + \\sqrt{(\\gamma^2 - \\delta^2)^2 + n^2\\gamma^2\\delta^2}}{n\\gamma\\delta}\\right)}\n$$"
        },
        {
            "introduction": "在确定了振荡器启动的条件之后，下一步是描述振荡本身的特征。本练习将探索霍普夫分岔范式，这是一个普适方程，它支配着任何系统在超临界霍普夫分岔点附近的行为。通过分析这个规范模型，您将能够推导出新生极限环的振幅和周期，并揭示这些特性如何依赖于系统参数。",
            "id": "4319256",
            "problem": "考虑一个 Hopf 分岔附近的生物化学振荡器的降维二维中心流形模型，其中主导模式的慢动力学由一个复值状态变量 $z(t) \\in \\mathbb{C}$ 描述，该变量由以下 Hopf 范式控制：\n$$\n\\dot{z} = (\\mu + i \\omega)\\, z - \\beta\\, |z|^{2}\\, z\n$$\n其中参数均为实数：$\\mu \\in \\mathbb{R}$（控制参数），$\\omega  0$（基线角频率），以及 $\\beta  0$（非线性饱和系数）。假设 $\\omega$ 的单位是弧度/单位时间，并且该范式源于系统生物医学背景下（例如，合成基因回路振荡器或糖酵解振荡器）的一个光滑、通用的超临界 Hopf 分岔，在分岔点邻域内高阶项可以忽略不计。\n\n从给定的范式出发，不使用任何预先推导的捷径公式，进行振幅-相位分解 $z(t) = r(t)\\, \\exp(i \\theta(t))$，并推导出在出现的极限环存在时其稳态振荡振幅 $A$ 和振荡周期 $T$ 的显式表达式。然后，仅基于推导出的振幅动力学，用参数 $\\mu$、$\\beta$ 和 $\\omega$ 解释此极限环存在且稳定的条件。\n\n以 $\\mu$、$\\beta$ 和 $\\omega$ 的形式，给出 $A$ 和 $T$ 的闭合形式最终表达式。如果没有要求进行数值计算，请勿近似；无需四舍五入。将周期 $T$ 用与 $\\omega$ 的单位（弧度/单位时间）相一致的时间单位表示。你的最终答案必须是由 $(A, T)$ 对组成的单行矩阵。",
            "solution": "问题给出了复值状态变量 $z(t)$ 的 Hopf 范式，它描述了系统在超临界 Hopf 分岔附近的动力学。控制方程为：\n$$\n\\dot{z} = (\\mu + i \\omega)\\, z - \\beta\\, |z|^{2}\\, z\n$$\n给定参数为 $\\mu \\in \\mathbb{R}$，$\\omega  0$ 和 $\\beta  0$。目标是通过进行振幅-相位分解，推导出极限环振荡的稳态振幅 $A$ 和周期 $T$。\n\n我们将复变量的极坐标形式 $z(t) = r(t)\\, \\exp(i \\theta(t))$ 代入方程。这里，$r(t)$ 是实值振幅，$\\theta(t)$ 是实值相位。首先，我们使用乘法法则和链式法则计算 $z(t)$ 的时间导数：\n$$\n\\dot{z} = \\frac{d}{dt} \\left( r(t)\\, \\exp(i \\theta(t)) \\right) = \\dot{r}\\, \\exp(i \\theta) + r\\, (i \\dot{\\theta})\\, \\exp(i \\theta) = (\\dot{r} + i r \\dot{\\theta})\\, \\exp(i \\theta)\n$$\n这里，$\\dot{r}$ 和 $\\dot{\\theta}$ 分别表示 $r(t)$ 和 $\\theta(t)$ 的时间导数。\n\n接下来，我们将范式方程的右侧用极坐标表示。我们利用 $z$ 的模的平方为 $|z|^{2} = |r \\exp(i \\theta)|^{2} = r^{2} |\\exp(i \\theta)|^{2} = r^{2}$ 这一事实。\n将此式和 $z = r \\exp(i \\theta)$ 代入右侧，得到：\n$$\n(\\mu + i \\omega)(r \\exp(i \\theta)) - \\beta r^{2} (r \\exp(i \\theta)) = [(\\mu + i \\omega)r - \\beta r^{3}] \\exp(i \\theta)\n$$\n$$\n= [\\mu r - \\beta r^{3} + i \\omega r] \\exp(i \\theta)\n$$\n\n现在，我们令等式左右两边相等：\n$$\n(\\dot{r} + i r \\dot{\\theta})\\, \\exp(i \\theta) = [\\mu r - \\beta r^{3} + i \\omega r] \\exp(i \\theta)\n$$\n由于对于任何实数 $\\theta$，$\\exp(i \\theta)$ 永远不为零，我们可以用该项除以等式两边：\n$$\n\\dot{r} + i r \\dot{\\theta} = (\\mu r - \\beta r^{3}) + i (\\omega r)\n$$\n要使两个复数相等，它们的实部和虚部必须相等。通过令该方程的实部和虚部相等，我们得到了一个关于振幅 $r(t)$ 和相位 $\\theta(t)$ 的耦合常微分方程组：\n\n1.  实部（振幅动力学）：\n    $$\n    \\dot{r} = \\mu r - \\beta r^{3}\n    $$\n2.  虚部（相位动力学）：\n    $$\n    r \\dot{\\theta} = \\omega r\n    $$\n\n我们分析这两个方程来找出极限环的性质。极限环对应于一个稳态解，其中振幅是恒定的非零值，即 $\\dot{r} = 0$ 且 $r = A  0$。\n\n从振幅方程出发，令 $\\dot{r} = 0$：\n$$\n\\mu A - \\beta A^{3} = 0\n$$\n$$\nA(\\mu - \\beta A^{2}) = 0\n$$\n该方程对于稳态振幅 $A$ 有两个可能的解：\ni) $A = 0$：这对应于原点的平凡不动点（无振荡）。\nii) $\\mu - \\beta A^{2} = 0 \\implies A^{2} = \\frac{\\mu}{\\beta}$。由于振幅必须为非负值（$A \\ge 0$），该解为 $A = \\sqrt{\\frac{\\mu}{\\beta}}$。\n\n一个非平凡极限环要求 $A  0$，这继而要求 $\\frac{\\mu}{\\beta}  0$。因为给定 $\\beta  0$，所以极限环存在的条件是 $\\mu  0$。\n\n现在，我们确定振幅动力学这些不动点的稳定性。设 $f(r) = \\dot{r} = \\mu r - \\beta r^{3}$。稳定性由导数 $f'(r) = \\frac{d f}{d r} = \\mu - 3 \\beta r^{2}$ 在不动点处的符号决定。\n- 对于平凡不动点 $A_0 = 0$：\n  $f'(0) = \\mu$。如果 $\\mu  0$，该不动点是稳定的。如果 $\\mu  0$，它是不稳定的。这证实了对于 $\\mu  0$，任何来自原点的微小扰动都会增长，使系统偏离非振荡状态。\n- 对于非平凡不动点 $A = \\sqrt{\\frac{\\mu}{\\beta}}$（当 $\\mu  0$ 时存在）：\n  $f'(A) = \\mu - 3 \\beta \\left(\\sqrt{\\frac{\\mu}{\\beta}}\\right)^{2} = \\mu - 3 \\beta \\left(\\frac{\\mu}{\\beta}\\right) = \\mu - 3\\mu = -2\\mu$。\n  由于极限环在 $\\mu  0$ 时存在，导数 $f'(A) = -2\\mu$ 总是负的。负导数表明这个不动点是稳定的。\n\n因此，当且仅当控制参数 $\\mu$ 为正时，存在一个具有恒定振幅 $A = \\sqrt{\\frac{\\mu}{\\beta}}$ 的稳定极限环。\n\n接下来，我们求此振荡的周期。从相位动力学方程 $r \\dot{\\theta} = \\omega r$ 出发。对于极限环振荡，$r = A  0$。我们可以安全地用 $r$（或 $A$）来除，得到：\n$$\n\\dot{\\theta} = \\omega\n$$\n这意味着极限环上的振荡角频率，我们称之为 $\\Omega$，是恒定的且等于 $\\omega$。\n$$\n\\Omega = \\omega\n$$\n振荡周期 $T$ 与角频率的关系是 $T = \\frac{2\\pi}{\\Omega}$。代入 $\\Omega = \\omega$，我们得到：\n$$\nT = \\frac{2\\pi}{\\omega}\n$$\n问题指明 $\\omega$ 的单位是弧度/单位时间，因此 $T$ 的单位被正确地表示为时间单位。\n\n总之，对于 $\\mu  0$，系统呈现出一个稳定的极限环振荡，其稳态振幅为 $A = \\sqrt{\\frac{\\mu}{\\beta}}$，周期为 $T = \\frac{2\\pi}{\\omega}$。\n\n出现的极限环的稳态振幅 $A$ 和周期 $T$ 的最终表达式是：\n振幅：$A = \\sqrt{\\frac{\\mu}{\\beta}}$\n周期：$T = \\frac{2\\pi}{\\omega}$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\sqrt{\\frac{\\mu}{\\beta}}  \\frac{2\\pi}{\\omega}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "将理论模型与实验现实联系起来需要强大的数据分析能力。这项计算实践模拟了分析含噪声和漂移的时间序列数据时遇到的常见挑战，例如来自生物发光报告基因的数据。您将实现一个标准的信号处理流程来对信号进行去趋势和滤波，然后定量评估这些步骤如何提高周期估计的准确性。",
            "id": "4319187",
            "problem": "给定一个模拟的发光时间序列，该序列模拟了一个受缓慢漂移和测量噪声影响的生物振荡器。目标是以一种有原则的、定量的方式，检验多项式去趋势后进行高通滤波对周期估计的影响。请在纯数学和算法框架内进行操作，并遵守以下约束。\n\n使用以下基本模型：\n- 测得的发光信号 $x(t)$ 被建模为一个振荡分量、一个平滑漂移分量和加性噪声之和。具体而言，$x(t) = s(t) + d(t) + \\eta(t)$，其中 $s(t)$ 是振荡的，$d(t)$ 是一个低频漂移，$\\eta(t)$ 是噪声。\n- 振荡分量 $s(t)$ 由一个正弦波近似，$s(t) = A \\sin\\left( \\frac{2\\pi}{P} t + \\phi \\right)$，其中 $A$ 是振幅，$P$ 是周期，$\\phi$ 是相位。\n- 漂移 $d(t)$ 是平滑的，并且在实验持续时间内可以用一个低阶多项式表示。\n- 使用离散傅里叶变换 (DFT) 和快速傅里叶变换 (FFT) 来计算功率谱密度 (PSD)，其中生物学上合理的频带内的主要谱峰用作周期估计值。PSD 是根据单边 FFT 的幅值平方计算得出的，周期 $P$ 估计为在指定搜索频带内使 PSD 最大化的频率 $f^\\star$ 的倒数。\n\n实现以下算法步骤：\n1. 在均匀网格上生成信号。对于采样间隔为 $\\Delta t$、总时长为 $T$ 的均匀采样，定义采样时间 $t_i = i\\Delta t$，其中 $i \\in \\{0, 1, \\dots, N-1\\}$ 且 $N = \\lfloor T / \\Delta t \\rfloor + 1$。构建振幅为 $A$、周期为 $P$、相位 $\\phi = 0$ 的振荡器 $s(t)$。使用一个在归一化时间 $\\tau(t) = 2 \\cdot \\frac{t - \\bar{t}}{t_\\text{max} - t_\\text{min}} \\in [-1, 1]$ 上求值的 $m$ 次 Legendre 多项式，并由漂移振幅 $D$ 进行缩放，来定义漂移 $d(t)$。添加均值为零、标准差为 $\\sigma$ 的独立高斯噪声 $\\eta(t)$。\n2. 对原始信号进行周期估计。对中心化后的原始信号使用 FFT 计算单边 DFT，并确定在搜索频带 $[f_\\text{min}, f_\\text{max}]$ 内使 PSD 最大化的频率 $f^\\star$。将其转换为周期估计值 $P_\\text{raw} = 1 / f^\\star$。通过频带选择排除 $f = 0$。\n3. 多项式去趋势。以最小二乘法将一个 $d$ 次多项式 $\\hat{p}_d(t)$ 拟合到 $x(t)$，并计算去趋势后的信号 $x_{\\text{det}}(t) = x(t) - \\hat{p}_d(t)$。\n4. 高通滤波。设计一个 $n$ 阶数字巴特沃斯高通滤波器，其截止频率为 $f_c$（单位：周/小时），并按奈奎斯特频率进行归一化。对 $x_{\\text{det}}(t)$ 应用零相位滤波以获得 $x_{\\text{proc}}(t)$。\n5. 去趋势和滤波后进行周期估计。对 $x_{\\text{proc}}(t)$ 重复步骤 2 以获得 $P_\\text{proc}$。\n6. 基准测试。对于每个模拟案例，计算绝对周期估计误差 $E_\\text{raw} = |P_\\text{raw} - P_\\text{true}|$ 和 $E_\\text{proc} = |P_\\text{proc} - P_\\text{true}|$，其中 $P_\\text{true}$ 是模拟中使用的基准真实周期。所有周期和误差都必须以小时表示。\n\n要求的搜索频带和单位：\n- 周期估计值和误差必须以小时为单位报告。\n- 频率以周/小时表示，频带 $[f_\\text{min}, f_\\text{max}]$ 通过 $f_\\text{min} = 1 / P_\\text{max}$ 和 $f_\\text{max} = 1 / P_\\text{min}$ 对应于周期搜索范围 $[P_\\text{min}, P_\\text{max}]$。\n- 如果需要，内部角度计算请使用弧度。\n\n测试套件规范：\n实现并运行以下参数集，这些参数集探讨了生物振荡器和生物钟的一系列现实场景：\n- 案例 1 (理想情况下的昼夜节律):\n  - $P_\\text{true} = 24$ 小时, $A = 1.0$, $\\Delta t = 0.5$ 小时, $T = 168$ 小时, $m = 3$, $D = 1.0$, $\\sigma = 0.3$, 多项式去趋势阶数 $d = 3$, 高通阶数 $n = 3$, 截止频率 $f_c = 1/36$ 周/小时, 周期搜索范围 $[P_\\text{min}, P_\\text{max}] = [6, 42]$ 小时, 随机种子 $123$.\n- 案例 2 (强漂移，低振幅):\n  - $P_\\text{true} = 24$ 小时, $A = 0.5$, $\\Delta t = 0.5$ 小时, $T = 168$ 小时, $m = 3$, $D = 2.0$, $\\sigma = 0.2$, $d = 3$, $n = 4$, $f_c = 1/30$ 周/小时, $[P_\\text{min}, P_\\text{max}] = [6, 42]$ 小时, 种子 $456$.\n- 案例 3 (昼夜节律频带内的超日节律):\n  - $P_\\text{true} = 12$ 小时, $A = 0.8$, $\\Delta t = 0.5$ 小时, $T = 168$ 小时, $m = 2$, $D = 1.5$, $\\sigma = 0.3$, $d = 2$, $n = 3$, $f_c = 1/36$ 周/小时, $[P_\\text{min}, P_\\text{max}] = [6, 42]$ 小时, 种子 $789$.\n- 案例 4 (粗采样边界):\n  - $P_\\text{true} = 24$ 小时, $A = 1.0$, $\\Delta t = 2.0$ 小时, $T = 240$ 小时, $m = 3$, $D = 1.0$, $\\sigma = 0.4$, $d = 3$, $n = 3$, $f_c = 1/40$ 周/小时, $[P_\\text{min}, P_\\text{max}] = [6, 42]$ 小时, 种子 $321$.\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔的浮点数列表，所有案例的结果按以下顺序排列：\n$[E_\\text{raw}^{(1)}, E_\\text{proc}^{(1)}, E_\\text{raw}^{(2)}, E_\\text{proc}^{(2)}, E_\\text{raw}^{(3)}, E_\\text{proc}^{(3)}, E_\\text{raw}^{(4)}, E_\\text{proc}^{(4)}]$,\n其中 $E_\\text{raw}^{(k)}$ 和 $E_\\text{proc}^{(k)}$ 分别是案例 $k$ 在去趋势和滤波前后的绝对误差（单位：小时）。",
            "solution": "该问题要求对一个标准的信号处理流程——包括多项式去趋势和高通滤波——如何影响模拟生物振荡器信号的周期估计准确性进行定量分析。该分析将针对代表不同实验场景的几个参数集进行。\n\n问题的核心在于实现一系列定义的信号生成和处理步骤，然后比较处理前后的周期估计误差。一旦固定了随机种子，整个过程就是确定性的，从而可以进行可复现的验证。\n\n解决方案按以下算法流程进行：\n\n1.  **信号生成**：对于每个测试案例，我们构建一个时间序列 $x(t)$ 来表示测得的发光信号。该信号定义在一个均匀的时间网格 $t_i = i \\Delta t$ 上，其中 $i \\in \\{0, 1, \\dots, N-1\\}$ 且 $N = \\lfloor T / \\Delta t \\rfloor + 1$。该信号是三个分量的加性组合：\n    $$\n    x(t_i) = s(t_i) + d(t_i) + \\eta(t_i)\n    $$\n    -   振荡分量 $s(t_i)$ 是一个纯正弦波，其基准真实周期为 $P_{\\text{true}}$，振幅为 $A$，相位为零：\n        $$\n        s(t_i) = A \\sin\\left(\\frac{2\\pi}{P_{\\text{true}}} t_i\\right)\n        $$\n    -   漂移分量 $d(t_i)$ 模拟一个缓慢的、非振荡的基线变化。它使用一个 $m$ 次 Legendre 多项式构建。首先，时间向量 $t$ 被归一化到区间 $[-1, 1]$：\n        $$\n        \\tau(t_i) = 2 \\cdot \\frac{t_i - (t_{\\text{max}} + t_{\\text{min}})/2}{t_{\\text{max}} - t_{\\text{min}}}\n        $$\n        其中 $t_{\\text{min}} = t_0$ 且 $t_{\\text{max}} = t_{N-1}$。然后，漂移是由漂移振幅 $D$ 缩放的 $m$ 次 Legendre 多项式 $L_m(\\tau)$：\n        $$\n        d(t_i) = D \\cdot L_m(\\tau(t_i))\n        $$\n    -   噪声分量 $\\eta(t_i)$ 被建模为独立同分布的高斯噪声，其均值为零，标准差为 $\\sigma$：\n        $$\n        \\eta(t_i) \\sim \\mathcal{N}(0, \\sigma^2)\n        $$\n\n2.  **通过功率谱密度 (PSD) 进行周期估计**：周期估计的核心方法基于离散傅里叶变换 (DFT)。对于一个长度为 $N$ 的给定时间序列 $y(t_i)$：\n    -   首先对信号进行中心化：$y'(t_i) = y(t_i) - \\frac{1}{N}\\sum_{j=0}^{N-1} y(t_j)$。\n    -   使用适用于实值输入的快速傅里叶变换 (FFT) 算法计算单边 DFT。这将为一组离散频率 $f_k = k / (N \\Delta t)$ 生成复系数 $Y_k$。\n    -   功率谱密度 (PSD) 与这些系数的幅值平方成正比，$S_{yy}(f_k) \\propto |Y_k|^2$。\n    -   通过在预定义的、生物学上合理的搜索频带 $[f_{\\text{min}}, f_{\\text{max}}]$ 内找到使 PSD 最大化的频率 $f^\\star$ 来估计与振荡器对应的频率：\n        $$\n        f^\\star = \\underset{f_k \\in [f_{\\text{min}}, f_{\\text{max}}]}{\\arg\\max} S_{yy}(f_k)\n        $$\n        搜索频带由周期范围 $[P_{\\text{min}}, P_{\\text{max}}]$ 推导得出，即 $[1/P_{\\text{max}}, 1/P_{\\text{min}}]$。直流分量 ($f=0$) 自然地被这一选择排除。\n    -   最终的周期估计值是这个主导频率的倒数：$P_{\\text{est}} = 1/f^\\star$。\n\n3.  **原始信号分析**：首先将上述周期估计程序直接应用于生成的原始信号 $x(t_i)$，以获得估计值 $P_{\\text{raw}}$。\n\n4.  **信号处理流程**：然后对原始信号进行处理，以减轻漂移和噪声的影响。\n    -   **多项式去趋势**：使用最小二乘法将一个 $d$ 次多项式 $\\hat{p}_d(t)$ 拟合到原始信号 $x(t)$。这个拟合的多项式作为漂移分量的估计。通过减去这个拟合值得到去趋势信号 $x_{\\text{det}}(t)$：\n        $$\n        x_{\\text{det}}(t) = x(t) - \\hat{p}_d(t)\n        $$\n    -   **高通滤波**：然后对去趋势信号进行滤波，以去除剩余的低频噪声和漂移残留。设计一个 $n$ 阶数字巴特沃斯高通滤波器。其截止频率 $f_c$ (单位：周/小时) 通过奈奎斯特频率 $f_{\\text{Nyquist}} = 1/(2\\Delta t)$ 进行归一化，以获得滤波器设计中使用的归一化截止频率 $W_n = f_c / f_{\\text{Nyquist}}$。为防止可能改变峰谷时间从而影响周期估计的相位失真，应用了零相位滤波。这通过先对信号进行一次正向处理，然后再进行一次反向处理来实现。结果是最终处理后的信号 $x_{\\text{proc}}(t)$。\n\n5.  **处理后信号分析**：将相同的周期估计程序应用于处理后的信号 $x_{\\text{proc}}(t)$，以得出估计值 $P_{\\text{proc}}$。\n\n6.  **误差基准测试**：对于每个测试案例，通过比较处理前后的绝对估计误差来评估处理流程的性能。误差是相对于已知的基准真实周期 $P_{\\text{true}}$ 计算的：\n    $$\n    E_{\\text{raw}} = |P_{\\text{raw}} - P_{\\text{true}}|\n    $$\n    $$\n    E_{\\text{proc}} = |P_{\\text{proc}} - P_{\\text{true}}|\n    $$\n    为每个指定案例计算的这些误差值构成了最终输出。这一比较展示了去趋势和滤波步骤在提高从含噪声、漂移的振荡数据中估计周期的准确性方面的有效性。",
            "answer": "```python\nimport numpy as np\nfrom scipy import signal\nfrom numpy.polynomial import legendre, polynomial\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation and analysis for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: happy path circadian\n        {\n            \"P_true\": 24.0, \"A\": 1.0, \"dt\": 0.5, \"T\": 168.0, \n            \"m\": 3, \"D\": 1.0, \"sigma\": 0.3, \"d\": 3, \"n\": 3, \n            \"fc\": 1/36.0, \"P_band\": [6.0, 42.0], \"seed\": 123\n        },\n        # Case 2: strong drift, lower amplitude\n        {\n            \"P_true\": 24.0, \"A\": 0.5, \"dt\": 0.5, \"T\": 168.0, \n            \"m\": 3, \"D\": 2.0, \"sigma\": 0.2, \"d\": 3, \"n\": 4, \n            \"fc\": 1/30.0, \"P_band\": [6.0, 42.0], \"seed\": 456\n        },\n        # Case 3: ultradian within circadian band\n        {\n            \"P_true\": 12.0, \"A\": 0.8, \"dt\": 0.5, \"T\": 168.0, \n            \"m\": 2, \"D\": 1.5, \"sigma\": 0.3, \"d\": 2, \"n\": 3, \n            \"fc\": 1/36.0, \"P_band\": [6.0, 42.0], \"seed\": 789\n        },\n        # Case 4: coarse sampling boundary\n        {\n            \"P_true\": 24.0, \"A\": 1.0, \"dt\": 2.0, \"T\": 240.0, \n            \"m\": 3, \"D\": 1.0, \"sigma\": 0.4, \"d\": 3, \"n\": 3, \n            \"fc\": 1/40.0, \"P_band\": [6.0, 42.0], \"seed\": 321\n        }\n    ]\n\n    results = []\n\n    for params in test_cases:\n        # Unpack parameters\n        P_true, A, dt, T = params[\"P_true\"], params[\"A\"], params[\"dt\"], params[\"T\"]\n        m, D, sigma = params[\"m\"], params[\"D\"], params[\"sigma\"]\n        d, n, fc, P_band = params[\"d\"], params[\"n\"], params[\"fc\"], params[\"P_band\"]\n        seed = params[\"seed\"]\n        \n        # Set random seed for reproducibility\n        np.random.seed(seed)\n\n        # 1. Signal Generation\n        # Time vector\n        N = int(T / dt) + 1\n        t = np.linspace(0, T, N)\n        \n        # Oscillator component\n        s_t = A * np.sin(2 * np.pi * t / P_true)\n\n        # Drift component\n        t_normalized = 2 * (t - (t[-1] + t[0]) / 2) / (t[-1] - t[0])\n        leg_coeffs = [0] * m + [1]\n        d_t = D * legendre.legval(t_normalized, leg_coeffs)\n\n        # Noise component\n        eta_t = np.random.normal(0, sigma, N)\n\n        # Composite signal\n        x_t = s_t + d_t + eta_t\n        \n        P_min, P_max = P_band\n\n        # 2. Period estimation on the raw signal\n        P_raw = estimate_period(x_t, dt, P_min, P_max)\n        \n        # 3. Polynomial detrending\n        poly_coeffs = polynomial.polyfit(t, x_t, d)\n        poly_fit = polynomial.polyval(t, poly_coeffs)\n        x_det = x_t - poly_fit\n\n        # 4. High-pass filtering\n        nyquist = 0.5 / dt\n        Wn = fc / nyquist\n        sos = signal.butter(n, Wn, btype='high', output='sos')\n        x_proc = signal.sosfiltfilt(sos, x_det)\n\n        # 5. Period estimation after detrending and filtering\n        P_proc = estimate_period(x_proc, dt, P_min, P_max)\n        \n        # 6. Benchmarking\n        E_raw = abs(P_raw - P_true)\n        E_proc = abs(P_proc - P_true)\n        \n        results.extend([E_raw, E_proc])\n\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\n\ndef estimate_period(y, dt, P_min, P_max):\n    \"\"\"\n    Estimates the dominant period of a signal using FFT.\n    \"\"\"\n    # Mean-center the signal\n    y_centered = y - np.mean(y)\n    N = len(y_centered)\n    \n    # Compute one-sided FFT for real signal\n    fft_vals = np.fft.rfft(y_centered)\n    # Compute corresponding frequencies\n    freqs = np.fft.rfftfreq(N, d=dt)\n    \n    # Compute Power Spectral Density (proportional to magnitude-squared)\n    psd = np.abs(fft_vals)**2\n    \n    # Define frequency search band\n    f_min = 1.0 / P_max\n    f_max = 1.0 / P_min\n    \n    # Find indices of frequencies within the search band\n    # This also excludes f=0 as f_min  0\n    valid_indices = np.where((freqs >= f_min)  (freqs = f_max))\n    \n    if len(valid_indices[0]) == 0:\n        return np.nan # No frequencies found in the band\n\n    # Find the peak power within the band\n    peak_index = valid_indices[0][np.argmax(psd[valid_indices])]\n    \n    # Get the dominant frequency\n    f_star = freqs[peak_index]\n    \n    if f_star == 0:\n        return np.inf # Avoid division by zero\n        \n    return 1.0 / f_star\n\n# Execute the main function\nsolve()\n```"
        }
    ]
}