{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握Gillespie算法，最好的方法就是亲手执行一遍。本练习将算法的单次迭代分解为其基本组成部分。通过手动计算每个反应的倾向性（propensity）、抽样确定下一个反应发生的时间和通道，并更新系统状态，您将对该算法的核心机制建立起具体而深入的理解。",
            "id": "4388732",
            "problem": "考虑一个单细胞中的组成型基因表达微电路，其中包含两种分子：信使核糖核酸 ($M$) 和蛋白质 ($P$)。该系统在质量作用动力学下被建模为一个由化学主方程 (CME) 控制的连续时间马尔可夫链。应用了随机模拟算法 (SSA; Gillespie 算法)。反应网络如下：\n1. $\\varnothing \\rightarrow M$，随机速率常数为 $c_{1}$，\n2. $M \\rightarrow M + P$，随机速率常数为 $c_{2}$，\n3. $M \\rightarrow \\varnothing$，随机速率常数为 $c_{3}$，\n4. $P \\rightarrow \\varnothing$，随机速率常数为 $c_{4}$。\n\n假设随机速率常数为 $c_{1} = 0.05\\,\\mathrm{s}^{-1}$、$c_{2} = 0.50\\,\\mathrm{s}^{-1}$、$c_{3} = 0.10\\,\\mathrm{s}^{-1}$ 和 $c_{4} = 0.02\\,\\mathrm{s}^{-1}$。在时间 $t(0)$ 时的初始分子数为 $x_{M}(0) = 3$ 和 $x_{P}(0) = 10$，初始时间为 $t(0) = 0\\,\\mathrm{s}$。对于单次 SSA 迭代，使用 $(0,1)$ 上的两个独立均匀分布的随机变量，给定为 $r_{1} = \\exp(-2)$ 和 $r_{2} = 0.925$。\n\n从 CME 中倾向函数的基本定义和控制 SSA 反应时间的指数等待时间的无记忆性出发，执行一次 SSA 迭代：计算倾向 $a_{\\mu}(x)$（其中 $\\mu \\in \\{1,2,3,4\\}$）、总倾向 $a_{0}$、等待时间 $\\tau$、下一个反应的索引 $j$，以及在反应 $j$ 发生后更新的时间和状态。将等待时间和更新后的时间四舍五入到四位有效数字，并用秒表示更新后的时间。提供 $a_{0}$、$\\tau$、$j$、更新后的时间 $t(0)+\\tau$ 以及更新后的状态 $(x_{M}, x_{P})$ 的最终数值。",
            "solution": "该问题要求对给定的基因表达网络执行一次随机模拟算法 (SSA)（也称为 Gillespie 算法）的迭代。系统的状态由分子数向量 $x(t) = (x_{M}(t), x_{P}(t))$ 描述，其中 $x_{M}$ 是信使 RNA 分子的数量，$x_{P}$ 是蛋白质分子的数量。\n\n四个化学反应如下：\n1. $R_1: \\varnothing \\xrightarrow{c_1} M$\n2. $R_2: M \\xrightarrow{c_2} M + P$\n3. $R_3: M \\xrightarrow{c_3} \\varnothing$\n4. $R_4: P \\xrightarrow{c_4} \\varnothing$\n\n在时间 $t(0) = 0\\,\\mathrm{s}$ 时的初始状态给定为 $x(0) = (x_{M}(0), x_{P}(0)) = (3, 10)$。随机速率常数为 $c_{1} = 0.05\\,\\mathrm{s}^{-1}$、$c_{2} = 0.50\\,\\mathrm{s}^{-1}$、$c_{3} = 0.10\\,\\mathrm{s}^{-1}$ 和 $c_{4} = 0.02\\,\\mathrm{s}^{-1}$。\n\nSSA 的第一步是为每个反应 $\\mu \\in \\{1, 2, 3, 4\\}$ 计算倾向函数 $a_{\\mu}(x)$。倾向函数表示在给定当前状态 $x$ 的情况下，单位时间内发生特定反应的概率。对于质量作用动力学，倾向函数为：\n- $a_{1}(x) = c_{1}$ (零级反应)\n- $a_{2}(x) = c_{2} x_{M}$ (一级反应)\n- $a_{3}(x) = c_{3} x_{M}$ (一级反应)\n- $a_{4}(x) = c_{4} x_{P}$ (一级反应)\n\n我们在初始状态 $x(0) = (3, 10)$ 下计算这些倾向：\n- $a_{1}(x(0)) = 0.05\\,\\mathrm{s}^{-1}$\n- $a_{2}(x(0)) = (0.50\\,\\mathrm{s}^{-1})(3) = 1.50\\,\\mathrm{s}^{-1}$\n- $a_{3}(x(0)) = (0.10\\,\\mathrm{s}^{-1})(3) = 0.30\\,\\mathrm{s}^{-1}$\n- $a_{4}(x(0)) = (0.02\\,\\mathrm{s}^{-1})(10) = 0.20\\,\\mathrm{s}^{-1}$\n\n总倾向 $a_{0}(x)$ 是各倾向之和。它表示任一反应发生的速率。\n$$a_{0}(x(0)) = \\sum_{\\mu=1}^{4} a_{\\mu}(x(0)) = 0.05 + 1.50 + 0.30 + 0.20 = 2.05\\,\\mathrm{s}^{-1}$$\n\n第二步是从 $(0, 1)$ 上的均匀分布中生成两个独立的随机数 $r_{1}$ 和 $r_{2}$。给定值为 $r_{1} = \\exp(-2)$ 和 $r_{2} = 0.925$。\n\n到下一次反应的等待时间 $\\tau$ 是一个速率为 $a_{0}(x)$ 的指数分布随机变量。指数分布的无记忆性在这里是基础。我们可以使用逆变换法生成 $\\tau$：\n$$\\tau = \\frac{1}{a_{0}(x)} \\ln\\left(\\frac{1}{r_{1}}\\right) = -\\frac{\\ln(r_{1})}{a_{0}(x)}$$\n代入给定的 $r_{1}$ 值和计算出的 $a_{0}(x(0))$：\n$$\\tau = -\\frac{\\ln(\\exp(-2))}{2.05} = -\\frac{-2}{2.05} = \\frac{2}{2.05} \\approx 0.975609756\\,\\mathrm{s}$$\n根据要求四舍五入到四位有效数字，我们得到 $\\tau \\approx 0.9756\\,\\mathrm{s}$。\n\n下一个要发生的反应，其索引为 $j$，是使用第二个随机数 $r_{2}$ 确定的。索引 $j$ 是满足以下条件的最小整数：\n$$\\sum_{\\mu=1}^{j} a_{\\mu}(x) \\ge r_{2} \\cdot a_{0}(x)$$\n首先，我们计算目标值：\n$$r_{2} \\cdot a_{0}(x(0)) = 0.925 \\cdot 2.05 = 1.89625$$\n现在我们检查倾向的累积和：\n- 对于 $j=1$：$\\sum_{\\mu=1}^{1} a_{\\mu} = a_{1} = 0.05$。这小于 $1.89625$。\n- 对于 $j=2$：$\\sum_{\\mu=1}^{2} a_{\\mu} = a_{1} + a_{2} = 0.05 + 1.50 = 1.55$。这小于 $1.89625$。\n- 对于 $j=3$：$\\sum_{\\mu=1}^{3} a_{\\mu} = a_{1} + a_{2} + a_{3} = 1.55 + 0.30 = 1.85$。这小于 $1.89625$。\n- 对于 $j=4$：$\\sum_{\\mu=1}^{4} a_{\\mu} = a_{1} + a_{2} + a_{3} + a_{4} = 1.85 + 0.20 = 2.05$。这大于或等于 $1.89625$。\n\n条件对 $j=4$ 成立。因此，下一个发生的反应是 $R_4$。\n\n最后一步是更新系统时间和状态。\n新时间 $t'$ 是旧时间和等待时间 $\\tau$ 的和：\n$$t' = t(0) + \\tau = 0\\,\\mathrm{s} + 0.9756\\,\\mathrm{s} = 0.9756\\,\\mathrm{s}$$\n\n新状态 $x'$ 是通过将反应 $j=4$ 的状态改变向量 $\\nu_j$ 加到旧状态 $x(0)$ 上得到的。反应 $R_4: P \\rightarrow \\varnothing$ 对应于一个蛋白质 $P$ 分子的减少。状态改变向量为 $\\nu_4 = (0, -1)$。\n$$x' = x(0) + \\nu_4 = (3, 10) + (0, -1) = (3, 9)$$\n更新后的状态为 $x_{M}' = 3$ 和 $x_{P}' = 9$。\n\n总之，一次 SSA 迭代的结果是：\n- 总倾向 $a_{0} = 2.05\\,\\mathrm{s}^{-1}$。\n- 等待时间 $\\tau \\approx 0.9756\\,\\mathrm{s}$。\n- 下一个反应的索引 $j=4$。\n- 更新后的时间 $t' \\approx 0.9756\\,\\mathrm{s}$。\n- 更新后的状态 $(x_{M}', x_{P}') = (3, 9)$。\n\n将这些值汇总为最终答案。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2.05  0.9756  4  0.9756  3  9\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Gillespie算法不仅是一个抽象的数学过程，它还深植于物理化学原理之中。本练习旨在探讨算法参数与系统物理属性（如体积）之间的关键联系。您将研究细胞体积的变化如何对单分子和双分子反应产生不同的影响，从而深入了解物理约束如何塑造细胞的动态行为。",
            "id": "4388690",
            "problem": "一个单细胞的胞质信号模块使用Gillespie算法（也称为随机模拟算法（SSA））进行建模。该模块包含一个蛋白质种类 $A$ 和一个衔接蛋白种类 $B$。在当前状态下，有 $X_A = 1000$ 个 $A$ 分子和 $X_B = 300$ 个 $B$ 分子。细胞体积为 $V = 1.0 \\times 10^{-12}$ 升。蛋白质 $A$ 经历单分子降解反应 $A \\rightarrow \\varnothing$，其宏观一级速率常数为 $k_1 = 2.0 \\times 10^{-3} \\ \\mathrm{s}^{-1}$。蛋白质 $A$ 和 $B$ 通过双分子反应 $A + B \\rightarrow C$ 结合形成复合物 $C$，其宏观二级速率常数为 $k_M = 1.0 \\times 10^{6} \\ \\mathrm{L \\ mol^{-1} \\ s^{-1}}$。假设宏观速率常数（以摩尔浓度表示）和随机速率常数（以分子数表示）之间的关系使用阿伏伽德罗常数 $N_A = 6.02214076 \\times 10^{23} \\ \\mathrm{mol^{-1}}$ 和系统体积 $V$。\n\n细胞发生渗透性收缩，使其体积减半至 $V/2$，而在所关注的瞬间，分子数 $X_A$ 和 $X_B$ 保持不变。使用Gillespie框架并从第一性原理出发，计算体积减半状态下到下一个反应事件的期望等待时间与原始体积状态下的期望等待时间之比。将您的答案四舍五入到四位有效数字。在您的推导中，明确指出体积减半如何影响单分子反应与双分子反应的SSA倾向性，并简要解释这一变化在分子碰撞频率和反应竞争方面的生物学意义。",
            "solution": "Gillespie算法，或随机模拟算法（SSA），通过将每个反应通道视为一个随机事件来模拟一个充分混合的化学系统的时间演化。SSA中的两个关键量是每个反应的倾向性（propensity）和系统的总倾向性。反应通道 $j$ 的倾向性 $a_j$ 定义为：在下一个无穷小时间间隔 $[t, t+dt)$ 内，发生一次 $j$ 型反应的概率是 $a_j dt$。总倾向性 $a_0 = \\sum_j a_j$ 决定了到下一个反应事件的等待时间 $\\tau$。这个等待时间服从一个均值为 $\\mathbb{E}[\\tau] = 1/a_0$ 的指数分布。\n\n首先，我们必须将给定的宏观速率常数 ($k_1$, $k_M$) 转换为随机速率常数 ($c_1$, $c_2$)。\n\n对于单分子反应 $R_1: A \\rightarrow \\varnothing$，宏观速率定律是 $v_1 = k_1 [A]$，其中 $[A]$ 是 $A$ 的摩尔浓度。随机速率由倾向性函数 $a_1 = c_1 X_A$ 给出，其中 $X_A$ 是 $A$ 的分子数。为了找到 $k_1$ 和 $c_1$ 之间的关系，我们可以关联浓度和分子数的变化率。\n浓度为 $[A] = \\frac{X_A}{N_A V}$。\n浓度的变化率为 $\\frac{d[A]}{dt} = \\frac{1}{N_A V} \\frac{dX_A}{dt}$。\n根据宏观动力学，$\\frac{d[A]}{dt} = -k_1 [A] = -k_1 \\frac{X_A}{N_A V}$。\n根据随机动力学， $X_A$ 的平均变化率为 $\\frac{dX_A}{dt} = -a_1 = -c_1 X_A$。\n将随机表达式代入浓度速率方程得到：\n$\\frac{d[A]}{dt} = \\frac{1}{N_A V} (-c_1 X_A) = -\\frac{c_1}{N_A V} X_A$。\n比较 $\\frac{d[A]}{dt}$ 的两个表达式，我们发现 $-k_1 \\frac{X_A}{N_A V} = -\\frac{c_1}{N_A V} X_A$，这简化为 $c_1 = k_1$。\n因此，对于单分子反应，随机速率常数等于宏观速率常数，并且与体积无关。\n\n对于双分子反应 $R_2: A + B \\rightarrow C$，宏观速率定律是 $v_2 = k_M [A][B]$。随机倾向性函数是 $a_2 = c_2 X_A X_B$，其中 $X_A X_B$ 是反应物分子的不同对的数量。遵循类似的推导：\n$\\frac{d[A]}{dt} = -k_M [A][B] = -k_M \\frac{X_A}{N_A V} \\frac{X_B}{N_A V}$。\n由于此反应，$X_A$ 的平均变化率为 $\\frac{dX_A}{dt} = -a_2 = -c_2 X_A X_B$。\n将其代入浓度速率方程：\n$\\frac{d[A]}{dt} = \\frac{1}{N_A V} \\frac{dX_A}{dt} = \\frac{1}{N_A V} (-c_2 X_A X_B) = -\\frac{c_2}{N_A V} X_A X_B$。\n比较 $\\frac{d[A]}{dt}$ 的两个表达式：\n$-k_M \\frac{X_A X_B}{(N_A V)^2} = -\\frac{c_2}{N_A V} X_A X_B$。\n这简化为 $c_2 = \\frac{k_M}{N_A V}$。\n与单分子情况不同，双分子反应的随机速率常数与系统体积 $V$ 成反比。\n\n现在，我们计算原始体积 $V$ 下的倾向性。\n给定的值为 $X_A = 1000$， $X_B = 300$， $k_1 = 2.0 \\times 10^{-3} \\ \\mathrm{s}^{-1}$， $k_M = 1.0 \\times 10^{6} \\ \\mathrm{L \\ mol^{-1} \\ s^{-1}}$， $V = 1.0 \\times 10^{-12} \\ \\mathrm{L}$，以及 $N_A = 6.02214076 \\times 10^{23} \\ \\mathrm{mol^{-1}}$。\n\n**原始体积下反应1（降解）的倾向性：**\n$c_1 = k_1 = 2.0 \\times 10^{-3} \\ \\mathrm{s}^{-1}$。\n$a_1 = c_1 X_A = (2.0 \\times 10^{-3} \\ \\mathrm{s}^{-1}) \\times 1000 = 2.0 \\ \\mathrm{s}^{-1}$。\n\n**原始体积下反应2（结合）的倾向性：**\n$c_2 = \\frac{k_M}{N_A V} = \\frac{1.0 \\times 10^{6} \\ \\mathrm{L \\ mol^{-1} \\ s^{-1}}}{(6.02214076 \\times 10^{23} \\ \\mathrm{mol^{-1}})(1.0 \\times 10^{-12} \\ \\mathrm{L})} \\approx 1.660539 \\times 10^{-6} \\ \\mathrm{s^{-1}}$。\n$a_2 = c_2 X_A X_B = (1.660539 \\times 10^{-6} \\ \\mathrm{s^{-1}}) \\times 1000 \\times 300 \\approx 0.498162 \\ \\mathrm{s}^{-1}$。\n\n原始体积下的总倾向性为：\n$a_{0, \\text{orig}} = a_1 + a_2 = 2.0 \\ \\mathrm{s}^{-1} + 0.498162 \\ \\mathrm{s}^{-1} = 2.498162 \\ \\mathrm{s}^{-1}$。\n\n到下一个反应的期望等待时间为：\n$\\mathbb{E}[\\tau_{\\text{orig}}] = \\frac{1}{a_{0, \\text{orig}}} = \\frac{1}{2.498162 \\ \\mathrm{s}^{-1}} \\approx 0.4003 \\ \\mathrm{s}$。\n\n接下来，我们计算体积减半（$V' = V/2$）后的倾向性，保持 $X_A$ 和 $X_B$ 不变。\n\n**体积减半后反应1（降解）的倾向性：**\n随机速率常数 $c'_1 = k_1 = c_1$ 与体积无关。\n倾向性 $a'_1 = c'_1 X_A = c_1 X_A = a_1 = 2.0 \\ \\mathrm{s}^{-1}$。\n体积减半对单分子反应的倾向性没有影响。\n\n**体积减半后反应2（结合）的倾向性：**\n新的随机速率常数为 $c'_2 = \\frac{k_M}{N_A V'} = \\frac{k_M}{N_A (V/2)} = 2 \\frac{k_M}{N_A V} = 2c_2$。\n新的倾向性为 $a'_2 = c'_2 X_A X_B = (2c_2)X_A X_B = 2a_2$。\n$a'_2 = 2 \\times 0.498162 \\ \\mathrm{s}^{-1} \\approx 0.996324 \\ \\mathrm{s}^{-1}$。\n体积减半使双分子反应的倾向性加倍。\n\n体积减半后的总倾向性为：\n$a_{0, \\text{half}} = a'_1 + a'_2 = a_1 + 2a_2 = 2.0 \\ \\mathrm{s}^{-1} + 0.996324 \\ \\mathrm{s}^{-1} \\approx 2.996324 \\ \\mathrm{s}^{-1}$。\n\n体积减半后到下一个反应的期望等待时间为：\n$\\mathbb{E}[\\tau_{\\text{half}}] = \\frac{1}{a_{0, \\text{half}}} = \\frac{1}{a_1 + 2a_2} \\approx \\frac{1}{2.996324 \\ \\mathrm{s}^{-1}} \\approx 0.3337 \\ \\mathrm{s}$。\n\n我们需要计算期望等待时间的比率：\n比率 $= \\frac{\\mathbb{E}[\\tau_{\\text{half}}]}{\\mathbb{E}[\\tau_{\\text{orig}}]} = \\frac{1/a_{0, \\text{half}}}{1/a_{0, \\text{orig}}} = \\frac{a_{0, \\text{orig}}}{a_{0, \\text{half}}} = \\frac{a_1 + a_2}{a_1 + 2a_2}$。\n\n代入倾向性的数值：\n比率 $= \\frac{2.498162}{2.996324} \\approx 0.833742$。\n\n四舍五入到四位有效数字，比率为 $0.8337$。\n\n**推导总结与生物学解释：**\n\n单分子反应的倾向性 $a_1 = k_1 X_A$，仅取决于反应物分子数 $X_A$ 和一个与体积无关的速率常数 $c_1=k_1$。因此，改变体积不会影响其倾向性。在生物学上，像自发降解这样的单分子事件是分子的内在属性，与其浓度或其他分子的接近程度无关。\n\n相反，双分子反应的倾向性 $a_2 = c_2 X_A X_B$，通过随机速率常数 $c_2 = k_M/(N_A V)$ 依赖于体积。这种与体积成反比的关系反映了分子需要碰撞才能发生反应的物理要求。当体积减半时 ($V \\rightarrow V/2$)，所有物种的浓度都加倍。这种限制增加了分子拥挤程度，导致任意两个分子（包括反应物 $A$ 和 $B$）之间的碰撞频率更高。SSA框架通过将双分子反应的倾向性加倍 ($a_2 \\rightarrow 2a_2$) 来捕捉这一点，这表示其瞬时概率加倍。\n\n总倾向性 $a_0 = a_1 + a_2$ 代表了系统的整体反应性。随着体积缩小，$a_0$ 从 $a_1+a_2$ 增加到 $a_1+2a_2$。总倾向性的增加导致*下一个*反应事件的期望等待时间减少，因为 $\\mathbb{E}[\\tau] = 1/a_0$。细胞的反应平均而言会加速。\n\n此外，体积变化改变了反应路径之间的竞争。下一个反应是双分子结合事件的概率从 $P(R_2) = \\frac{a_2}{a_1+a_2}$ 变为 $P'(R_2) = \\frac{2a_2}{a_1+2a_2}$。由于对于正数 $x,y$ 而言，$\\frac{2x}{y+2x}  \\frac{x}{y+x}$ 成立，因此体积减小选择性地偏向于双分子反应而非单分子反应。在生物学背景下，这表明像渗透压和细胞体积改变这样的物理变化可以改变信号或代谢网络的平衡，促进高阶反应（例如，二聚化、复合物形成）而非一级过程（例如，降解、异构化），从而在不改变基因表达的情况下重新编程细胞行为。",
            "answer": "$$\\boxed{0.8337}$$"
        },
        {
            "introduction": "虽然Gillespie算法的直接法在概念上很简单，但对于系统生物学中常见的大规模反应网络，其朴素实现的计算效率可能很低。最后一个练习将挑战您像计算科学家一样思考，评估不同的数据结构和算法策略，以实现高效的随机模拟算法（SSA）。理解这些实现方式之间的优劣权衡，是将随机模拟应用于真实复杂生物模型的关键。",
            "id": "4388739",
            "problem": "你的任务是为 Daniel Gillespie 的随机模拟算法 (SSA) 在一个具有质量作用动力学的系统生物医学反应网络中的高效实现设计数据结构。该网络有 $S$ 种化学物种和 $M$ 个反应通道。设时间 $t$ 的状态为 $X(t) \\in \\mathbb{Z}_{\\ge 0}^S$，倾向函数为 $\\{a_\\mu(X(t))\\}_{\\mu=1}^M$，总倾向为 $a_0(X(t)) = \\sum_{\\mu=1}^M a_\\mu(X(t))$。SSA 的经典直接法会抽取一个等待时间 $\\tau \\sim \\mathrm{Exp}(a_0)$，然后以概率 $a_\\mu/a_0$ 选择一个反应索引 $\\mu$，根据反应 $\\mu$ 的化学计量更新 $X(t+\\tau)$，并更新倾向函数。假设反应网络是稀疏的，即每次反应发生最多影响 $d$ 个倾向函数，其中 $d \\ll M$，并设 $E$ 表示由质量作用结构导出的反应依赖图中的边数，在稀疏情况下 $E = \\Theta(M d)$。\n\n实现的目标是在保持 SSA 精确性的同时，使每步 SSA 的期望时间复杂度相对于 $M$ 是亚线性的，并且空间复杂度随网络规模近线性增长。你可以使用以下经过充分检验的原则和事实：\n- SSA 可以实现为直接法（从由 $a_\\mu/a_0$ 定义的分类分布中采样，并从指数分布中采样 $\\tau$），也可以实现为下一反应法 (NRM)，该方法基于积分风险为每个反应维护暂定发生时间，并选择最小的下一事件时间。\n- 二叉索引树 (Fenwick 树) 支持在 $O(\\log M)$ 时间和 $O(M)$ 空间内进行点更新和前缀和查询，并可通过二进制提升遍历在 $O(\\log M)$ 时间内找到使累积和超过阈值的最小索引 $k$。\n- 二叉堆支持在 $O(\\log M)$ 时间和 $O(M)$ 空间内进行删除最小值和键值减小/增加操作。\n- 具有 $E$ 条边的有向依赖图的稀疏邻接表表示使用 $O(M+E)$ 空间，并允许在 $O(d)$ 时间内遍历受任何一次反应发生影响的 $O(d)$ 个反应。\n\n假设在一个大型生物医学网络中，$M$ 的数量级为 $10^5$，$d$ 的数量级为 $10^1$，因此 $d \\ll M$，并且化学计量使得依赖稀疏性始终成立。在这种稀疏情况下，以下哪种实现架构同时满足随机精确性，并达到每步期望时间复杂度 $O(\\log M + d \\log M)$ 和空间复杂度 $O(M + S + E)$？\n\nA. 直接法，使用基于倾向函数的二叉索引树 (Fenwick 树) 通过前缀搜索在 $O(\\log M)$ 时间内支持反应索引的加权采样，在更新期间通过增量 $O(1)$ 调整来维护总倾向，并使用稀疏邻接表仅更新 $O(d)$ 个受影响的倾向，每次更新耗时 $O(\\log M)$。不维护暂定时间的堆。\n\nB. 下一反应法，使用一个以 $M$ 个反应的暂定发生时间为键的最小堆，一个用于依赖关系的稀疏邻接表，并且在一次反应发生后，通过积分风险变换重用每个受影响反应的现有指数时钟来计算其新的暂定时间，然后对 $O(d)$ 个受影响的反应进行 $O(\\log M)$ 的堆键值更新。\n\nC. 直接法，使用一个以当前倾向为键的最大堆，在每一步返回具有最大倾向的反应，理由是随着 $M$ 的增长，采样最大倾向的反应可以近似分类分布，并使用稀疏邻接表在 $O(\\log M)$ 时间内更新 $O(d)$ 个键。\n\nD. 直接法，使用一个稠密的 $M \\times M$ 邻接矩阵表示依赖关系，一个用于分类采样的二叉索引树，并在每一步扫描已发生反应的整个邻接矩阵行来确定受影响的倾向，并声称每步时间由树操作的 $O(\\log M)$ 主导。\n\nE. 直接法，使用一个用于分类采样的二叉索引树，但在每一步通过重新计算所有 $M$ 个倾向并重新插入来从头重建整个树，而稀疏邻接表仅用于更新物种数量。\n\n选择所有在所述稀疏情况下同时满足精确性以及所述时间和空间复杂度界限的选项。",
            "solution": "用户要求基于三个标准分析几种为 Gillespie 随机模拟算法 (SSA) 提出的实现架构：随机精确性、每步期望时间复杂度 $O(\\log M + d \\log M)$，以及空间复杂度 $O(M + S + E)$。背景是一个稀疏反应网络，其中有 $M$ 个反应，$S$ 个物种，以及一个依赖图，其中每次反应发生最多影响 $d$ 个倾向，且 $d \\ll M$，依赖边数为 $E = \\Theta(M d)$。\n\n一个有效的 SSA 实现必须是随机精确的，这意味着它生成的轨迹在统计上与底层的连续时间离散状态马尔可夫过程无法区分。一个高效算法的每步时间复杂度应该利用稀疏性 ($d \\ll M$) 来避免对 $M$ 的线性或超线性伸缩。目标复杂度为 $O(\\log M + d \\log M)$，由于 $d \\ge 1$，可以简化为 $O(d \\log M)$。空间复杂度应与网络描述的大小呈近线性关系，给定为 $O(M + S + E)$。\n\n让我们根据这些标准逐一分析每个提议的架构。\n\n### 选项 A 分析\n\n**描述**：使用二叉索引树 (BIT) 进行反应选择的直接法，使用稀疏邻接表进行依赖跟踪，并对总倾向进行增量更新。\n\n1.  **随机精确性**：**正确**。根据定义，直接法是 SSA 的一个精确表述。使用二叉索引树来搜索对应于从 $[0, a_0)$ 均匀抽取的随机数的反应索引 $\\mu$，是一种从权重为 $\\{a_\\mu\\}_{\\mu=1}^M$ 的分类分布中采样的标准、精确算法。此架构正确地实现了直接法的采样步骤。\n\n2.  **时间复杂度**：每一步的期望时间包括反应选择和倾向更新。\n    *   **选择**：抽取一个均匀随机数 $r$ 并找到满足 $\\sum_{k=1}^{\\mu} a_k  r \\cdot a_0$ 的最小索引 $\\mu$，这可以通过在 BIT 上进行类似二分搜索的遍历来完成。如问题前提所述，这需要 $O(\\log M)$ 时间。\n    *   **更新**：一个反应发生后，状态 $X(t)$ 发生变化。我们必须更新倾向。使用稀疏邻接表（一个依赖图），我们可以在 $O(d)$ 时间内识别出 $O(d)$ 个受影响的倾向。对于这 $O(d)$ 个受影响的倾向中的每一个，我们重新计算其值并在 BIT 上执行点更新。BIT 上的点更新需要 $O(\\log M)$ 时间。因此，更新的总时间为 $O(d \\log M)$。总倾向 $a_0$ 既可以在 $O(\\log M)$ 时间内从 BIT 重新查询，也可以通过每次倾向变化的 $O(1)$ 工作量进行增量维护，总工作量为 $O(d)$。\n    *   **总时间**：选择和更新时间的总和为 $O(\\log M) + O(d \\log M) = O(d \\log M)$。这满足了指定的时间复杂度界限 $O(\\log M + d \\log M)$。\n\n3.  **空间复杂度**：所需的数据结构是：\n    *   $S$ 个物种的状态向量：$O(S)$。\n    *   $M$ 个反应的二叉索引树：$O(M)$。\n    *   具有 $E$ 条边的依赖图的稀疏邻接表：$O(M+E)$。\n    *   总空间：$O(S + M + M + E) = O(M + S + E)$。这符合规范。\n\n**结论**：选项 A 是随机精确的，并且同时满足时间和空间复杂度的要求。它描述了一种著名的有效 SSA 实现，通常称为对数直接法。此选项是**正确的**。\n\n### 选项 B 分析\n\n**描述**：使用最小堆存储反应时间的下一反应法 (NRM)，并使用稀疏邻接表表示依赖关系。\n\n1.  **随机精确性**：**正确**。下一反应法，特别是通过重用随机数（“积分风险变换”）所暗示的 Gibson-Bruck 变体，在数学上被证明是随机精确的，并且与 Gillespie 的原始公式等价。\n\n2.  **时间复杂度**：\n    *   **选择**：下一个要发生的反应是具有最小暂定发生时间的反应。这可以通过在最小堆上执行 `delete-min` 操作找到，该操作需要 $O(\\log M)$ 时间。\n    *   **更新**：一个反应发生后，必须重新计算其自身的暂定时间，并且必须更新 $O(d)$ 个依赖反应的时间。使用稀疏邻接表，可以在 $O(d)$ 时间内找到这 $O(d)$ 个反应。对于这 $O(d)+1$ 个反应中的每一个，其在最小堆中的键（暂定时间）都必须更新。二叉堆中的键更新操作需要 $O(\\log M)$ 时间。\n    *   **总时间**：每步的总时间为选择的 $O(\\log M)$ 加上更新的 $O(d \\log M)$，总和为 $O(d \\log M)$。这满足了指定的时间复杂度界限 $O(\\log M + d \\log M)$。\n\n3.  **空间复杂度**：\n    *   状态向量：$O(S)$。\n    *   $M$ 个暂定时间的最小堆：$O(M)$。（还需要一个将反应索引映射到堆位置的辅助数组，占用 $O(M)$ 空间）。\n    *   稀疏邻接表：$O(M+E)$。\n    *   用于 NRM 的随机数/状态的存储空间：$O(M)$。\n    *   总空间：$O(S + M + M + E + M) = O(M + S + E)$。这符合规范。\n\n**结论**：选项 B 描述了高效的 Gibson-Bruck 下一反应法。它是随机精确的，并满足所述的时间和空间复杂度界限。此选项是**正确的**。\n\n### 选项 C 分析\n\n**描述**：直接法的一个变体，使用最大堆确定性地选择具有最大倾向的反应，并声称这是一种近似。\n\n1.  **随机精确性**：**不正确**。这是该选项的致命缺陷。SSA 要求以与其倾向 $a_\\mu(X)$ 成正比的概率对反应 $\\mu$ 进行采样。相比之下，此方法总是选择反应 $\\mu^* = \\arg\\max_\\mu a_\\mu$。这构成了一个完全不同的算法。它是一个贪婪的、确定性的选择，而不是根据所需分布进行的随机选择。问题明确要求“随机精确”的实现，而这个方法不是。它是一种近似方法，因此未能满足首要标准。\n\n**结论**：选项 C 不是一个随机精确的 SSA 实现。此选项是**不正确的**。\n\n### 选项 D 分析\n\n**描述**：使用 BIT 进行采样的直接法，但使用稠密的 $M \\times M$ 矩阵进行依赖跟踪。\n\n1.  **随机精确性**：**正确**。该方法是直接法的一个实例，具有正确的采样过程 (BIT)，因此是随机精确的。用于依赖跟踪的数据结构的选择影响性能，而不是正确性。\n\n2.  **时间复杂度**：**不正确**。该提议使用稠密的 $M \\times M$ 矩阵表示依赖关系，并通过“扫描整个邻接矩阵行”来查找受影响的反应。该矩阵的一行有 $M$ 个条目。因此，识别一次反应发生的依赖关系需要 $O(M)$ 时间。这主导了 $O(\\log M)$ 的选择时间。每步的总时间复杂度将是 $O(M)$，而不是所要求的 $O(d \\log M)$。由于 $d \\ll M$，$O(M)$ 比目标复杂度差得多。声称时间由 $O(\\log M)$ 主导是错误的。\n\n3.  **空间复杂度**：**不正确**。一个稠密的 $M \\times M$ 矩阵需要 $O(M^2)$ 空间。目标是 $O(M + S + E)$。鉴于 $E=\\Theta(Md)$ 和稀疏情况 $d \\ll M$，所需的空间是 $O(M+S+Md)$，远小于 $O(M^2)$。对于给定的 $M \\approx 10^5$ 的规模，$M^2$ 矩阵在计算上是不可行的。\n\n**结论**：由于对稀疏问题使用了稠密邻接矩阵，选项 D 未能同时满足时间和空间复杂度的要求。此选项是**不正确的**。\n\n### 选项 E 分析\n\n**描述**：使用 BIT 的直接法，但在每一步都通过重新计算所有 $M$ 个倾向来重建整个树。\n\n1.  **随机精确性**：**正确**。在每一步都重新计算所有倾向并从头重建采样数据结构是实现直接法的一种有效但低效的方法。由于在每一步都使用正确的倾向进行采样，该方法是随机精确的。\n\n2.  **时间复杂度**：**不正确**。每一步的主要工作是“重新计算所有 $M$ 个倾向”，这需要 $O(M)$ 时间。从这 $M$ 个值构建一个 BIT 至少需要 $O(M)$ 时间。因此，每步的总时间复杂度为 $O(M)$。这不满足 $O(d \\log M)$ 的目标。这种方法完全没有利用稀疏邻接表本可以为更新提供的依赖稀疏性信息。\n\n3.  **空间复杂度**：**正确**。数据结构是状态向量 ($O(S)$)、BIT ($O(M)$) 和稀疏邻接表 ($O(M+E)$)。总空间为 $O(M+S+E)$，符合规范。\n\n**结论**：尽管选项 E 是随机精确的并且满足空间要求，但它在时间复杂度标准上明确失败。此选项是**不正确的**。",
            "answer": "$$\\boxed{AB}$$"
        }
    ]
}