{
    "hands_on_practices": [
        {
            "introduction": "一个稳健的机器学习模型建立在方法论上健全的验证流程之上。一个常见而微妙的错误是“数据泄漏”，即来自测试集的信息无意中污染了训练过程，导致过于乐观的性能估计。本练习从数学上阐明了为什么像特征归一化这样的预处理步骤必须严格限制在交叉验证的训练折叠内，并量化了由泄漏流程引起的误差大小。",
            "id": "4389509",
            "problem": "一项系统生物医学研究使用单个信使核糖核酸 (mRNA) 表达生物标志物 $X$ 通过监督学习对二元表型（例如，疾病与对照）进行分类。数据集包含从一个均衡总体中抽取的 $n$ 个独立同分布的样本，其中 $X$ 的无条件分布均值为 $0$，方差为 $v$。您执行 $K$ 折交叉验证 (Cross-Validation (CV))，其中 $K \\geq 2$，产生 $K$ 个大小为 $n_{\\mathrm{te}} = n/K$ 的不相交的测试折和大小为 $n_{\\mathrm{tr}} = n - n_{\\mathrm{te}} = n(K-1)/K$ 的训练折。\n\n考虑特征归一化映射 $\\phi(x) = (x - \\hat{\\mu})/\\sigma$，其中 $\\hat{\\mu}$ 是经验均值，$\\sigma = \\sqrt{v}$ 是一个通过先前技术校准得出的已知缩放常数（假设 $\\sigma$ 是已知且固定的，并且等于 $X$ 的真实标准差）。比较两种流程：\n\n- 泄漏流程：从所有 $n$ 个样本中计算 $\\hat{\\mu}_{\\mathrm{full}}$，并在将样本拆分到各折之前将 $\\phi_{\\mathrm{full}}(x) = (x - \\hat{\\mu}_{\\mathrm{full}})/\\sigma$ 应用于所有样本。\n- 正确流程：对每个折 $f$，仅从该折中的训练样本计算 $\\hat{\\mu}_{f,\\mathrm{tr}}$，并定义 $\\phi_{f}(x) = (x - \\hat{\\mu}_{f,\\mathrm{tr}})/\\sigma$。将 $\\phi_{f}$ 应用于折 $f$ 中的训练样本和测试样本。\n\n利用交叉验证风险估计要求训练数据和测试数据之间独立的核心定义，以及关于独立同分布随机变量样本均值的经过充分检验的事实，推导在一个任意折 $f$ 中随机选择的测试样本 $X_{j}$ 的泄漏标准化测试值与正确标准化测试值之间的期望平方差异，即\n$$\n\\mathbb{E}\\left[\\left(\\phi_{\\mathrm{full}}(X_{j}) - \\phi_{f}(X_{j})\\right)^{2}\\right],\n$$\n其中，期望是针对数据生成过程和到折的随机划分来计算的。将您的最终答案表示为关于 $n$ 和 $K$ 的单个封闭形式的解析表达式。\n\n此外，在您的解答中，简要阐明正确的流程，在该流程中，$\\phi$ 仅在训练折上进行拟合，然后应用于相应的测试折，并解释为什么这可以防止在归一化步骤中发生信息泄漏。\n\n无需四舍五入。请以单个解析表达式的形式提供最终答案。",
            "solution": "该问题要求在 $K$ 折交叉验证框架内，推导“泄漏”与“正确”特征归一化方案之间的期望平方差异。让我们首先正式定义所涉及的量，然后进行推导。\n\n数据集包含生物标志物 $X$ 的 $n$ 个独立同分布 (i.i.d.) 样本 $\\{X_1, X_2, \\dots, X_n\\}$。$X$ 的潜在分布均值为 $\\mathbb{E}[X_i] = 0$，方差为 $\\mathrm{Var}[X_i] = v$，对于所有 $i \\in \\{1, \\dots, n\\}$ 均成立。归一化常数 $\\sigma = \\sqrt{v}$ 是已知的。\n\n需要计算的量是：\n$$\n\\mathbb{E}\\left[\\left(\\phi_{\\mathrm{full}}(X_{j}) - \\phi_{f}(X_{j})\\right)^{2}\\right]\n$$\n其中 $X_j$ 是任意折 $f$ 的测试集中的一个样本。\n\n首先，我们代入归一化映射的定义：\n$$\n\\phi_{\\mathrm{full}}(X_{j}) = \\frac{X_{j} - \\hat{\\mu}_{\\mathrm{full}}}{\\sigma}\n$$\n$$\n\\phi_{f}(X_{j}) = \\frac{X_{j} - \\hat{\\mu}_{f,\\mathrm{tr}}}{\\sigma}\n$$\n这两个标准化值之间的差异是：\n$$\n\\phi_{\\mathrm{full}}(X_{j}) - \\phi_{f}(X_{j}) = \\frac{1}{\\sigma} \\left( (X_{j} - \\hat{\\mu}_{\\mathrm{full}}) - (X_{j} - \\hat{\\mu}_{f,\\mathrm{tr}}) \\right) = \\frac{\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{full}}}{\\sigma}\n$$\n因此，期望平方差异可以写为：\n$$\n\\mathbb{E}\\left[\\left(\\frac{\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{full}}}{\\sigma}\\right)^{2}\\right] = \\frac{1}{\\sigma^2} \\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{full}})^2\\right]\n$$\n鉴于 $\\sigma^2 = v$，上式变为：\n$$\n\\frac{1}{v} \\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{full}})^2\\right]\n$$\n我们的主要任务是计算期望 $\\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{full}})^2\\right]$。\n\n设 $I_{\\mathrm{tr}}$ 为折 $f$ 的训练样本索引集，$I_{\\mathrm{te}}$ 为折 $f$ 的测试样本索引集。我们有 $|I_{\\mathrm{tr}}| = n_{\\mathrm{tr}} = n(K-1)/K$ 和 $|I_{\\mathrm{te}}| = n_{\\mathrm{te}} = n/K$。完整的索引集为 $I = I_{\\mathrm{tr}} \\cup I_{\\mathrm{te}}$。\n\n经验均值定义如下：\n- 所有 $n$ 个样本的均值：$\\hat{\\mu}_{\\mathrm{full}} = \\frac{1}{n} \\sum_{i=1}^{n} X_i$。\n- 折 $f$ 的训练样本的均值：$\\hat{\\mu}_{f,\\mathrm{tr}} = \\frac{1}{n_{\\mathrm{tr}}} \\sum_{i \\in I_{\\mathrm{tr}}} X_i$。\n- 我们也定义折 $f$ 的测试样本的均值：$\\hat{\\mu}_{f,\\mathrm{te}} = \\frac{1}{n_{\\mathrm{te}}} \\sum_{i \\in I_{\\mathrm{te}}} X_i$。\n\n我们可以将 $\\hat{\\mu}_{\\mathrm{full}}$ 表示为折 $f$ 的训练均值和测试均值的加权平均：\n$$\n\\hat{\\mu}_{\\mathrm{full}} = \\frac{1}{n} \\left( \\sum_{i \\in I_{\\mathrm{tr}}} X_i + \\sum_{i \\in I_{\\mathrm{te}}} X_i \\right) = \\frac{1}{n} (n_{\\mathrm{tr}} \\hat{\\mu}_{f,\\mathrm{tr}} + n_{\\mathrm{te}} \\hat{\\mu}_{f,\\mathrm{te}}) = \\frac{n_{\\mathrm{tr}}}{n} \\hat{\\mu}_{f,\\mathrm{tr}} + \\frac{n_{\\mathrm{te}}}{n} \\hat{\\mu}_{f,\\mathrm{te}}\n$$\n现在，我们可以表示差异 $(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{full}})$：\n$$\n\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{full}} = \\hat{\\mu}_{f,\\mathrm{tr}} - \\left(\\frac{n_{\\mathrm{tr}}}{n} \\hat{\\mu}_{f,\\mathrm{tr}} + \\frac{n_{\\mathrm{te}}}{n} \\hat{\\mu}_{f,\\mathrm{te}}\\right) = \\left(1 - \\frac{n_{\\mathrm{tr}}}{n}\\right) \\hat{\\mu}_{f,\\mathrm{tr}} - \\frac{n_{\\mathrm{te}}}{n} \\hat{\\mu}_{f,\\mathrm{te}}\n$$\n由于 $n = n_{\\mathrm{tr}} + n_{\\mathrm{te}}$，我们有 $1 - n_{\\mathrm{tr}}/n = n_{\\mathrm{te}}/n$。此外，$n_{\\mathrm{te}}/n = (n/K)/n = 1/K$。因此：\n$$\n\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{full}} = \\frac{n_{\\mathrm{te}}}{n}(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{f,\\mathrm{te}}) = \\frac{1}{K}(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{f,\\mathrm{te}})\n$$\n现在我们计算这个差的平方的期望：\n$$\n\\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{full}})^2\\right] = \\mathbb{E}\\left[\\left(\\frac{1}{K}(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{f,\\mathrm{te}})\\right)^2\\right] = \\frac{1}{K^2} \\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{f,\\mathrm{te}})^2\\right]\n$$\n让我们展开期望内的项：\n$$\n\\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{f,\\mathrm{te}})^2\\right] = \\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{tr}}^2 - 2\\hat{\\mu}_{f,\\mathrm{tr}}\\hat{\\mu}_{f,\\mathrm{te}} + \\hat{\\mu}_{f,\\mathrm{te}}^2] = \\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{tr}}^2] - 2\\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{tr}}\\hat{\\mu}_{f,\\mathrm{te}}] + \\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{te}}^2]\n$$\n用于计算 $\\hat{\\mu}_{f,\\mathrm{tr}}$ 和 $\\hat{\\mu}_{f,\\mathrm{te}}$ 的样本集是不相交的。由于原始样本 $X_i$ 是独立同分布的，所以随机变量 $\\hat{\\mu}_{f,\\mathrm{tr}}$ 和 $\\hat{\\mu}_{f,\\mathrm{te}}$ 是独立的。\n任何样本均值的期望是 $\\mathbb{E}[\\hat{\\mu}] = \\mathbb{E}[\\frac{1}{m}\\sum X_i] = \\frac{1}{m}\\sum\\mathbb{E}[X_i] = 0$。因此，$\\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{tr}}] = 0$ 和 $\\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{te}}] = 0$。\n由于独立性，交叉项的期望是 $\\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{tr}}\\hat{\\mu}_{f,\\mathrm{te}}] = \\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{tr}}]\\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{te}}] = 0 \\cdot 0 = 0$。\n期望简化为：\n$$\n\\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{f,\\mathrm{te}})^2\\right] = \\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{tr}}^2] + \\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{te}}^2]\n$$\n对于任何期望 $\\mathbb{E}[Y]=0$ 的随机变量 $Y$，我们有 $\\mathrm{Var}[Y] = \\mathbb{E}[Y^2] - (\\mathbb{E}[Y])^2 = \\mathbb{E}[Y^2]$。$m$ 个方差为 $v$ 的独立同分布随机变量的样本均值的方差是 $v/m$。\n因此：\n$$\n\\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{tr}}^2] = \\mathrm{Var}[\\hat{\\mu}_{f,\\mathrm{tr}}] = \\frac{v}{n_{\\mathrm{tr}}}\n$$\n$$\n\\mathbb{E}[\\hat{\\mu}_{f,\\mathrm{te}}^2] = \\mathrm{Var}[\\hat{\\mu}_{f,\\mathrm{te}}] = \\frac{v}{n_{\\mathrm{te}}}\n$$\n将这些代回：\n$$\n\\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{f,\\mathrm{te}})^2\\right] = \\frac{v}{n_{\\mathrm{tr}}} + \\frac{v}{n_{\\mathrm{te}}} = v \\left(\\frac{1}{n_{\\mathrm{tr}}} + \\frac{1}{n_{\\mathrm{te}}}\\right)\n$$\n现在，我们代入 $n_{\\mathrm{tr}} = n(K-1)/K$ 和 $n_{\\mathrm{te}} = n/K$：\n$$\n\\frac{1}{n_{\\mathrm{tr}}} + \\frac{1}{n_{\\mathrm{te}}} = \\frac{K}{n(K-1)} + \\frac{K}{n} = \\frac{K}{n} \\left(\\frac{1}{K-1} + 1\\right) = \\frac{K}{n} \\left(\\frac{1 + K - 1}{K-1}\\right) = \\frac{K^2}{n(K-1)}\n$$\n所以，我们有：\n$$\n\\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{te}})^2\\right] = v \\frac{K^2}{n(K-1)}\n$$\n我们现在可以计算 $\\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{full}})^2\\right]$：\n$$\n\\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{full}})^2\\right] = \\frac{1}{K^2} \\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{f,\\mathrm{te}})^2\\right] = \\frac{1}{K^2} \\left( v \\frac{K^2}{n(K-1)} \\right) = \\frac{v}{n(K-1)}\n$$\n最后，我们将此结果代入所求的期望平方差异的表达式中：\n$$\n\\mathbb{E}\\left[\\left(\\phi_{\\mathrm{full}}(X_{j}) - \\phi_{f}(X_{j})\\right)^{2}\\right] = \\frac{1}{v} \\mathbb{E}\\left[(\\hat{\\mu}_{f,\\mathrm{tr}} - \\hat{\\mu}_{\\mathrm{full}})^2\\right] = \\frac{1}{v} \\left(\\frac{v}{n(K-1)}\\right) = \\frac{1}{n(K-1)}\n$$\n\n按照要求，我们简要阐述正确的流程及其所遵循的原则。在正确的流程中，对于交叉验证的 $K$ 次迭代中的每一次，数据集都被划分为一个训练集和一个测试集。所有数据驱动的预处理步骤，包括归一化参数的计算（此处为经验均值 $\\hat{\\mu}_{f,\\mathrm{tr}}$），都仅使用该特定折的训练数据来执行。然后将得到的变换 $\\phi_f$ 应用于该折的训练集和测试集。此过程通过严格保持测试集的独立性来防止信息泄漏。在模型拟合的所有阶段（包括预处理），测试集都保持“未见”状态，从而对模型在新数据上的性能产生无偏估计。泄漏流程则违反了这一原则，它使用所有折的数据计算全局均值 $\\hat{\\mu}_{\\mathrm{full}}$，从而用测试集的信息污染了训练过程。",
            "answer": "$$\n\\boxed{\\frac{1}{n(K-1)}}\n$$"
        },
        {
            "introduction": "生物医学数据集通常具有层次结构，例如来自单个患者的多个活检样本。在这种情况下，天真地在样本层面拆分数据会违反数据独立性的假设，构成一种严重的数据泄漏形式，从而使性能评估无效。本练习探讨了正确的验证策略——分组交叉验证——以及在这种相关数据结构存在的情况下，准确估计性能指标方差的统计学原理。",
            "id": "4389578",
            "problem": "一项转化肿瘤学研究招募了一个由 $N_p$ 名患者组成的队列，每位患者提供 $m_i \\geq 1$ 份多区域肿瘤活检样本。对于患者 $i$，第 $j$ 份活检样本具有一个通过批量核糖核酸测序（RNA-seq）测得的特征向量 $\\mathbf{x}_{ij} \\in \\mathbb{R}^d$，以及一个表示根据临床标准评估的免疫检查点疗法反应的二元患者级别标签 $y_i \\in \\{0,1\\}$。对于来自同一患者的所有活检样本，标签 $y_i$ 是恒定的。目标是训练一个监督分类器 $f: \\mathbb{R}^d \\to \\{0,1\\}$，以从活检级别的特征 $\\mathbf{x}_{ij}$ 预测 $y_i$，并以可靠的不确定性估计其泛化性能。研究人员怀疑存在患者内依赖性：对于任何固定的患者 $i$，由于共享的微环境和处理效应，分类器 $f$ 的活检级别预测误差在该患者的不同活检样本间呈正相关。\n\n设队列有 $N_p = 180$ 名患者和 $N = \\sum_{i=1}^{N_p} m_i = 540$ 份活检样本，经验平均簇大小为 $\\bar{m} = \\frac{1}{N_p} \\sum_{i=1}^{N_p} m_i = 3$。假设对活检级别残差的探索性分析得出，患者内误差指标的估计组内相关系数为 $\\hat{\\rho} = 0.4$。您需要构建一种数据划分策略，以在每位患者存在多个活检样本时防止患者级别的数据泄漏，并分析其相对于朴素的样本级别方法的性能估计方差所产生的影响。\n\n哪个选项能最好地同时满足以下两个要求：它在交叉验证中防止患者级别的数据泄漏，并且在存在如上所述的患者内相关性和平均簇大小的情况下，为性能估计的方差提供了正确的定性和定量影响？\n\nA. 在活检级别使用分层 $K$ 折交叉验证，随机将单个活检样本分配到各折，同时保持每折的总体响应率。通过对活检样本进行非参数自助法重采样来估计不确定性。这可以避免泄漏，因为分层控制了标签分布，并且性能估计的方差不变，因为更多的活检样本会增加精度。\n\nB. 在患者级别使用分层分组 $K$ 折交叉验证，将来自同一患者的所有活检样本分配到同一折，并保持各折的患者级别响应率。通过汇总每个患者的活检级别预测（例如，多数投票）来评估患者级别的性能，并通过对患者及其所有活检样本进行重采样的聚类（患者级别）自助法来量化不确定性。相对于朴素的活检级别独立同分布分析，活检级别平均性能估计的方差大约会膨胀一个设计效应因子，其尺度近似为 $1 + (\\bar{m} - 1)\\rho$，因此防止泄漏和考虑聚类会比样本级别划分产生更宽且更可靠的置信区间。\n\nC. 对每位患者，执行一次留出法，其中一份活检样本放入测试折，同一患者的其余活检样本保留在训练折，并对所有活检样本进行循环。使用分母为 $N$ 的标准独立同分布方差公式计算不确定性。这可以防止泄漏，因为每个活检样本至少被留出一次，并且由于训练集很大，方差会减小。\n\nD. 使用留一患者交叉验证，确保每折的测试集恰好包含一名患者，训练集包含其余患者。通过将活检样本视为独立的伯努利试验，使用 $\\widehat{\\mathrm{Var}}(\\widehat{\\mathrm{acc}}) \\approx \\widehat{\\mathrm{acc}}(1 - \\widehat{\\mathrm{acc}})/N$ 来计算样本级别准确率的方差。这可以防止泄漏，因为患者被留出，并且使用活检总数可以正确估计方差，这捕捉了每位患者多个活检样本所贡献的精度。",
            "solution": "### 步骤 1：问题验证\n\n我将首先根据要求的协议验证问题陈述。\n\n#### 提取已知条件\n- 一个队列由 $N_p$ 名患者组成。\n- 每位患者 $i$ 提供 $m_i \\geq 1$ 份多区域肿瘤活检样本。\n- 来自患者 $i$ 的第 $j$ 份活检样本的特征向量为 $\\mathbf{x}_{ij} \\in \\mathbb{R}^d$。\n- 患者 $i$ 的患者级别标签为 $y_i \\in \\{0,1\\}$，表示免疫检查点疗法的反应。\n- 对于来自同一患者 $i$ 的所有活检样本，标签 $y_i$ 是恒定的。\n- 目标是训练一个分类器 $f: \\mathbb{R}^d \\to \\{0,1\\}$。\n- 次要目标是以可靠的不确定性估计泛化性能。\n- 怀疑存在患者内依赖性：来自同一患者的活检样本的预测误差呈正相关。\n- 患者数量：$N_p = 180$。\n- 活检样本总数：$N = \\sum_{i=1}^{N_p} m_i = 540$。\n- 经验平均簇大小：$\\bar{m} = \\frac{1}{N_p} \\sum_{i=1}^{N_p} m_i = 3$。\n- 患者内误差指标的估计组内相关系数：$\\hat{\\rho} = 0.4$。\n- 核心任务是确定一种数据划分策略，该策略能（1）防止患者级别的数据泄漏，以及（2）正确分析其对性能估计方差的影响。\n\n#### 使用提取的已知条件进行验证\n1.  **科学上合理**：该问题设定在现实的转化肿瘤学背景中。使用活检样本的 RNA-seq 数据预测治疗反应是监督学习在系统生物医学中的标准应用。其核心的统计挑战——由于来自同一主体（患者）的多个样本导致的数据相关性——是生物统计学和医学机器学习中一个基本且关键的问题。“患者级别泄漏”指的是模型验证中一个有据可查的陷阱，它会导致过于乐观的性能估计。提供的数据值（$N_p=180$, $N=540$, $\\bar{m}=3$, $\\rho=0.4$）对于此类研究是合理的。该问题牢固地植根于既定的统计学和机器学习原则。\n\n2.  **定义明确**：问题要求根据两个清晰而独特的标准来评估几个选项：（1）防止数据泄漏，和（2）对性能估计器方差进行正确的定性和定量评估。问题提供了判断每个选项所需的所有信息。通过严格应用统计学原理，可以在选项中确定一个唯一的最佳答案。\n\n3.  **客观**：问题陈述使用了来自统计学、机器学习和肿瘤学的精确、客观和标准的技术术语。没有主观声明、模糊之处或基于观点的陈述。\n\n_结论_：问题陈述有效。它在科学上是合理的，定义明确，客观，并且提出了生物医学数据科学领域中一个重要但标准的挑战。我将继续进行解答。\n\n### 步骤 2：求解推导\n\n该问题需要一个解决方案，以解决两个不同但相关的问题：数据划分策略和性能估计的统计特性。\n\n#### 1. 防止患者级别的数据泄漏\n\n该数据集具有分层或聚类结构：活检样本嵌套在患者内部。患者级别标签 $y_i$ 由来自患者 $i$ 的所有活检样本 $\\mathbf{x}_{i1}, \\mathbf{x}_{i2}, \\dots, \\mathbf{x}_{im_i}$ 共享。此外，问题陈述指出预测误差存在患者内相关性，这是共享的遗传背景、肿瘤微环境和样本处理效应的结果。\n\n如果交叉验证方案在活检级别划分数据，那么来自同一患者的活检样本极有可能同时分布在训练集和测试集中。在一个来自患者 $i$ 的活检样本上训练的分类器将学习到患者特异性特征。当它随后在来自同一患者 $i$ 的另一个活检样本上进行测试时，它将获得人为的高预测准确率。这种现象被称为数据泄漏或信息泄漏。由此产生的性能估计将存在乐观偏差，并且不能反映模型泛化到全新、未见过的患者的能力。\n\n为了防止这种泄漏，交叉验证的随机化单位必须是患者，而不是活检样本。与单个患者相关的所有数据必须被专门分配到训练折或测试折中，但绝不能分割于两者之间。这种方法被称为分组 $K$ 折交叉验证，其中“组”是患者。其特殊版本包括留一组交叉验证（此处为留一患者交叉验证）。\n\n#### 2. 相关数据的性能估计方差\n\n第二个要求是正确地考虑数据聚类对性能估计方差的影响。活检样本不是独立同分布（i.i.d.）的。组内相关系数 $\\rho$ 量化了同一聚类（患者）内观测值之间的平均相关性。正的 $\\rho$ 表示同一聚类内的观测值比不同聚类内的观测值更相似。\n\n当数据是聚类的时候，有效样本量小于单个观测值的总数 $N$。一个假设 i.i.d. 数据的朴素方差计算（例如，在分母中使用 $N$）会低估真实方差。来自聚类数据的样本均值（或像准确率这样的比例）的正确方差会因一个称为“设计效应”（DEFF）的因子而膨胀。对于大小可变的聚类，设计效应近似为：\n$$\n\\text{DEFF} \\approx 1 + (\\bar{m} - 1)\\rho\n$$\n其中 $\\bar{m}$ 是平均簇大小，$\\rho$ 是组内相关性。\n\n使用提供的值：\n- 平均簇大小: $\\bar{m} = 3$\n- 组内相关系数: $\\rho = 0.4$\n\n近似的设计效应是：\n$$\n\\text{DEFF} \\approx 1 + (3 - 1) \\times 0.4 = 1 + 2 \\times 0.4 = 1 + 0.8 = 1.8\n$$\n这意味着活检级别性能指标（例如，平均准确率）的方差大约是错误地假设 i.i.d. 的情况下计算出的方差的 $1.8$ 倍。因此，置信区间必须加宽 $\\sqrt{\\text{DEFF}} \\approx \\sqrt{1.8} \\approx 1.34$ 倍才能在统计上有效（“可靠的”）。任何忽略这种效应的分析都是有缺陷的。\n\n### 步骤 3：逐项分析\n\n现在我将基于这些原则评估每个选项。\n\n**A. 在活检级别使用分层 $K$ 折交叉验证，随机将单个活检样本分配到各折，同时保持每折的总体响应率。通过对活检样本进行非参数自助法重采样来估计不确定性。这可以避免泄漏，因为分层控制了标签分布，并且性能估计的方差不变，因为更多的活检样本会增加精度。**\n\n-   **泄漏预防**：此方法失败。在活检级别进行划分是导致患者级别泄漏的典型例子。来自同一患者的活检样本可以同时存在于训练集和测试集中。对标签 $y_i$ 进行分层并不能防止这种情况。\n-   **方差影响**：“性能估计的方差不变”的说法是错误的。正的患者内相关性（$\\rho = 0.4 > 0$）的存在，相比于 i.i.d. 情况，严格增加了样本均值的方差。所提议的对单个活检样本进行自助法重采样也未能尊重聚类结构，并将产生无效的、过于狭窄的不确定性估计。\n-   **结论**：**不正确**。\n\n**B. 在患者级别使用分层分组 $K$ 折交叉验证，将来自同一患者的所有活检样本分配到同一折，并保持各折的患者级别响应率。通过汇总每个患者的活检级别预测（例如，多数投票）来评估患者级别的性能，并通过对患者及其所有活检样本进行重采样的聚类（患者级别）自助法来量化不确定性。相对于朴素的活检级别独立同分布分析，活检级别平均性能估计的方差大约会膨胀一个设计效应因子，其尺度近似为 $1 + (\\bar{m} - 1)\\rho$，因此防止泄漏和考虑聚类会比样本级别划分产生更宽且更可靠的置信区间。**\n\n-   **泄漏预防**：此方法正确。在患者级别使用分组 K 折交叉验证可确保来自给定患者的所有活检样本都包含在单个折中，从而防止泄漏。按患者级别标签进行分层也是一种合理的做法。\n-   **方差影响**：该选项正确地指出了聚类对 方差的定量影响。它正确地陈述了方差会因一个设计效应因子而膨胀，其尺度近似为 $1 + (\\bar{m} - 1)\\rho$。它还正确地得出结论，这将导致更宽、更“可靠”的置信区间。建议的评估方法（患者级别汇总）和不确定性量化方法（聚类自助法）是处理这类数据结构的最新技术。\n-   **结论**：**正确**。\n\n**C. 对每位患者，执行一次留出法，其中一份活检样本放入测试折，同一患者的其余活检样本保留在训练折，并对所有活检样本进行循环。使用分母为 $N$ 的标准独立同分布方差公式计算不确定性。这可以防止泄漏，因为每个活检样本至少被留出一次，并且由于训练集很大，方差会减小。**\n\n-   **泄漏预防**：此方法是灾难性的错误。它明确建议在来自某位患者的活检样本上训练模型，然后在*同一*患者的另一个活检样本上进行测试。这是可以想象的最直接的数据泄漏形式，将导致严重高估的性能。“防止泄漏”的说法是错误的。\n-   **方差影响**：提议的方差计算是朴素的 i.i.d. 公式，对于相关数据是不正确的。此选项的整个前提都是有缺陷的。\n-   **结论**：**不正确**。\n\n**D. 使用留一患者交叉验证，确保每折的测试集恰好包含一名患者，训练集包含其余患者。通过将活检样本视为独立的伯努利试验，使用 $\\widehat{\\mathrm{Var}}(\\widehat{\\mathrm{acc}}) \\approx \\widehat{\\mathrm{acc}}(1 - \\widehat{\\mathrm{acc}})/N$ 来计算样本级别准确率的方差。这可以防止泄漏，因为患者被留出，并且使用活检总数可以正确估计方差，这捕捉了每位患者多个活检样本所贡献的精度。**\n\n-   **泄漏预防**：此方法正确。留一患者交叉验证是分组 K 折交叉验证的一种特殊形式（其中 $K=N_p$），并成功地防止了患者级别的泄漏。\n-   **方差影响**：提议的方差计算 $\\widehat{\\mathrm{acc}}(1 - \\widehat{\\mathrm{acc}})/N$ 是来自 $N$ 个 i.i.d. 伯努利试验的比例方差的标准公式。这明确且错误地忽略了聚类数据结构和给定的组内相关性 $\\rho$。它未能考虑设计效应，导致对真实方差的低估。关于使用 $N$ “捕捉了精度”的理由是误导性的；它捕捉了原始样本数量，但没有捕捉到有效统计信息，后者由于相关性而较低。因此，该选项对方差的分析是不正确的。\n-   **结论**：**不正确**。\n\n### 结论\n\n选项 B 是唯一一个既正确识别了防止泄漏的适当数据划分策略（分组 K 折交叉验证），又正确指出了患者内相关性对性能估计方差的定性和定量影响（设计效应因子 $1 + (\\bar{m} - 1)\\rho$）的选项。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "一旦正确建立了验证方案，选择合适的性能指标对于得出有意义的科学结论至关重要。指标并非“一刀切”；它们的适用性取决于类别不平衡和不同预测错误的具体成本等因素。本练习要求您将关键的评估指标与适当的生物医学分类场景联系起来，从而培养准确报告和解释模型性能所需的批判性判断能力。",
            "id": "4389548",
            "problem": "一个系统生物医学小组正在对二元分类器进行基准测试，这些分类器将患者分为阳性类别（存在致病过程）和阴性类别（不存在致病过程）。混淆矩阵的条目按常规方式从第一性原理定义：真阳性（记作 TP）是被正确预测为阳性的阳性样本；假阳性（FP）是被错误预测为阳性的阴性样本；真阴性（TN）是被正确预测为阴性的阴性样本；假阴性（FN）是被错误预测为阴性的阳性样本。敏感性（也称为召回率或真阳性率）是生物学阳性样本中真阳性的比例，而特异性（真阴性率）是生物学阴性样本中真阴性的比例。精确率（阳性预测值）是预测为阳性的样本中真阳性的比例。在实践中，预测分数通常需要设定阈值以产生阳性或阴性标签，在多站点部署中，操作阈值可能因站点而异。\n\n考虑以下五类在系统生物医学的生物分类监督学习中常用的评估标准：准确率（Accuracy）、平衡准确率（Balanced accuracy）、F1分数（F1-score）、马修斯相关系数（Matthews Correlation Coefficient, MCC）和受试者工作特征曲线下面积（Area Under the Receiver Operating Characteristic, AUROC）。每种度量标准都体现了对混淆矩阵四个单元或底层排序函数的不同聚合方式，并适用于不同的科学场景。\n\n哪个选项正确且连贯地用基本量定义了每种度量标准，并将其与一个科学上恰当的生物分类场景配对，在该场景中它应被首选为主要报告的性能指标？\n\nA. \n- 准确率（Accuracy）：所有被正确标记的患者的比例，适用于类别大致均衡且错分成本相当的情况，例如，在一个横断面队列研究中区分两种肿瘤亚型，其中亚型患病率大致均衡，且下游行动是观察性分析而非干预。\n- 平衡准确率（Balanced accuracy）：敏感性和特异性的非加权平均值，适用于类别不平衡且两种类型的错误应同等重要的情况，例如，一项基于血液的筛查，其中生物学阳性样本约占队列的$10\\%$，但漏报的阳性病例和误报为阳性的阴性病例在临床上都具有重要意义。\n- F1分数（F1-score）：阈值化后，阳性类别的精确率和召回率的调和平均数，适用于阳性类别罕见且实验室将对预测的阳性样本进行验证的情况，因此寻求在预测的阳性样本中同时保持高召回率和高精确率，例如，对候选的罕见致病性变异进行分类以进行后续检测。\n- 马修斯相关系数（Matthews Correlation Coefficient, MCC）：预测标签和真实二元标签之间的相关性，对称地聚合了混淆矩阵的所有四个单元，范围从-1（完全不一致）到0（不比随机猜测好）再到1（完全一致），适用于类别不平衡严重且需要一个对标签不平衡不敏感的单一阈值化摘要指标的情况，例如，在临床前筛选中，根据多组学特征推断通路激活（阳性样本约占$1\\%$)。\n- 受试者工作特征曲线下面积（Area Under the Receiver Operating Characteristic, AUROC）：当决策阈值变化时，真阳性率对假阳性率绘制的曲线下的面积，等于一个随机选择的阳性样本比一个随机选择的阴性样本得分更高的概率，适用于操作阈值将在事后设定或在不同患病率的站点间变化的情况，例如，多中心部署一种败血症风险评分，其阈值将根据当地资源进行调整。\n\nB.\n- 准确率（Accuracy）：被正确标记的患者的比例，适用于严重不平衡的数据集，因为多数类的一致性占主导地位，例如，在人群筛查中检测患病率为$1\\%$的表型。\n- 平衡准确率（Balanced accuracy）：通过测试数据中的经验类别流行率重新加权后，正确决策的比例，适用于阳性类别占主导地位的情况。\n- F1分数（F1-score）：一种无阈值的排序度量，应在校准未知时使用，例如，当模型输出是未校准的概率时。\n- 马修斯相关系数（Matthews Correlation Coefficient, MCC）：当类别平衡时，其数值等同于F1，仅在TP、FP、TN和FN均非零时适用。\n- 受试者工作特征曲线下面积（Area Under the Receiver Operating Characteristic, AUROC）：跨阈值的敏感性和精确率的平均值，在阳性类别极其罕见且只关心检测到阳性样本时最佳。\n\nC.\n- 准确率（Accuracy）：正确预测的分数，适用于假阳性比假阴性的代价高得多的情况，例如，当无法进行验证性测试时。\n- 平衡准确率（Balanced accuracy）：敏感性和精确率的平均值，适用于阈值将在不同站点间变化且排序很重要的情形。\n- F1分数（F1-score）：敏感性和特异性的算术平均值，适用于类别完全平衡且错误成本相同的情况。\n- 马修斯相关系数（Matthews Correlation Coefficient, MCC）：一个界于$0$和$1$之间的度量，当FP或FN等于$0$时无定义，仅适用于平衡数据集。\n- 受试者工作特征曲线下面积（Area Under the Receiver Operating Characteristic, AUROC）：当阈值变化时，精确率-召回率曲线下的面积，适用于希望强调精确率而非召回率的情况。\n\nD.\n- 准确率（Accuracy）：敏感性和特异性之和，适用于类别平衡且阈值将在稍后调整的情况。\n- 平衡准确率（Balanced accuracy）：所有患者中正确标签的比例，适用于患病率未知的情况。\n- F1分数（F1-score）：特异性和精确率的调和平均数，适用于负类高度不平衡且假阳性主导成本的情况。\n- 马修斯相关系数（Matthews Correlation Coefficient, MCC）：一个可能为负的类相关系数，因此不适合报告模型质量；仅在类别不平衡时应避免使用。\n- 受试者工作特征曲线下面积（Area Under the Receiver Operating Characteristic, AUROC）：一个随机选择的阴性样本比一个随机选择的阳性样本得分更低的概率，适用于需要一个对跨站点类别患病率变化具有鲁棒性的、与阈值无关的排序度量。\n\n选择在定义和场景分配上完全正确的唯一选项。",
            "solution": "这项任务是找出哪个选项正确定义了二元分类中五个常见的性能度量标准，并将每个度量标准与其在系统生物医学中的恰当用例场景正确配对。这五个度量标准是：准确率（Accuracy）、平衡准确率（Balanced Accuracy）、F1分数（F1-score）、马修斯相关系数（Matthews Correlation Coefficient, MCC）和受试者工作特征曲线下面积（Area Under the Receiver Operating Characteristic, AUROC）。基本量是真阳性（$TP$）、假阳性（$FP$）、真阴性（$TN$）和假阴性（$FN$）。实际阳性样本总数为 $P = TP + FN$，实际阴性样本总数为 $N = TN + FP$。\n\n首先，我将陈述这些度量标准的形式化定义。\n\n1.  **敏感性（Sensitivity，也称召回率Recall或真阳性率True Positive Rate, $TPR$）**：被正确识别的实际阳性样本的比例。\n    $$ \\text{敏感性} = \\frac{TP}{TP + FN} = \\frac{TP}{P} $$\n\n2.  **特异性（Specificity，也称真阴性率True Negative Rate, $TNR$）**：被正确识别的实际阴性样本的比例。\n    $$ \\text{特异性} = \\frac{TN}{TN + FP} = \\frac{TN}{N} $$\n\n3.  **精确率（Precision，也称阳性预测值Positive Predictive Value, $PPV$）**：预测为阳性的样本中，实际为阳性的比例。\n    $$ \\text{精确率} = \\frac{TP}{TP + FP} $$\n\n4.  **假阳性率（False Positive Rate, $FPR$）**：被错误识别为阳性的实际阴性样本的比例。\n    $$ FPR = \\frac{FP}{TN + FP} = \\frac{FP}{N} = 1 - \\text{特异性} $$\n\n基于这些，五个主要度量标准定义如下：\n\n-   **准确率（Accuracy）**：所有实例中被正确分类的比例。\n    $$ \\text{准确率} = \\frac{TP + TN}{TP + FP + TN + FN} $$\n    准确率易于理解，但在不平衡的数据集上可能具有误导性，因为分类器只需预测多数类即可获得高分。\n\n-   **平衡准确率（Balanced Accuracy）**：敏感性和特异性的算术平均值。\n    $$ \\text{平衡准确率} = \\frac{\\text{敏感性} + \\text{特异性}}{2} = \\frac{1}{2} \\left( \\frac{TP}{TP + FN} + \\frac{TN}{TN + FP} \\right) $$\n    该度量标准对每个类别的性能给予同等权重，使其对类别不平衡具有鲁棒性。\n\n-   **F1分数（F1-score, F1）**：精确率和召回率（敏感性）的调和平均数。\n    $$ F_1 = 2 \\cdot \\frac{\\text{精确率} \\cdot \\text{召回率}}{\\text{精确率} + \\text{召回率}} = \\frac{2TP}{2TP + FP + FN} $$\n    当主要关注阳性类别且其通常是稀有类别时，F1分数非常有用。它旨在平衡发现阳性样本（召回率）和这些阳性预测的正确性（精确率）。值得注意的是，它的公式中不包括真阴性（$TN$）。\n\n-   **马修斯相关系数（Matthews Correlation Coefficient, MCC）**：真实分类和预测二元分类之间的相关系数。\n    $$ \\text{MCC} = \\frac{TP \\cdot TN - FP \\cdot FN}{\\sqrt{(TP+FP)(TP+FN)(TN+FP)(TN+FN)}} $$\n    MCC通常被认为是一个信息量非常丰富的单一评分指标，因为它包含了混淆矩阵的所有四个值，并且对类别不平衡具有鲁棒性。其值范围从-1（完全反相关）到+1（完全相关），0表示性能不优于随机猜测。\n\n-   **受试者工作特征曲线下面积（Area Under the Receiver Operating Characteristic, AUROC）**：这是一个与阈值无关的度量标准。ROC曲线绘制了所有可能的分类阈值下的敏感性（TPR）对假阳性率（FPR）。AUROC是该曲线下的面积。它有一个概率解释：它是一个随机选择的阳性实例被分类器评分高于一个随机选择的阴性实例的概率。它评估分类器的排序质量，独立于任何选定的阈值。\n\n现在，我将评估每个选项。\n\n**选项A**\n\n-   **准确率**：定义“所有被正确标记的患者的比例”是正确的。场景“适用于类别大致均衡且错分成本相当的情况”是使用准确率的标准和正确指南。平衡的肿瘤亚型用于观察性分析的例子是恰当的。这是正确的。\n-   **平衡准确率**：定义“敏感性和特异性的非加权平均值”是正确的。场景“适用于类别不平衡且两种类型的错误应同等重要的情况”是该度量标准的主要动机。一个$10\\%$阳性率的筛查，其中假阴性和假阳性都具有重要意义的例子是一个典型的用例。这是正确的。\n-   **F1分数（F1）**：定义“阈值化后，阳性类别的精确率和召回率的调和平均数”是正确的。场景“适用于阳性类别罕见且实验室将对预测的阳性样本进行验证的情况”是一个完美的匹配。在这种情况下，人们必须找到稀有的阳性样本（高召回率），同时又不能让验证实验室被大量的假警报（高精确率）所淹没。这是正确的。\n-   **马修斯相关系数（MCC）**：将其定义为从-1到1的对称相关性是正确的。在类别严重不平衡（$1\\%$的阳性样本）的情况下，需要一个单一的阈值化摘要指标的场景是偏好MCC的典型案例，因为它保持信息量，并且不像准确率那样受大量阴性样本的偏见影响。这是正确的。\n-   **受试者工作特征曲线下面积（AUROC）**：定义是正确的，包括对ROC曲线轴的准确描述和正确的概率解释。场景“适用于操作阈值将在事后设定或在不同站点间变化的情况”是使用像AUROC这样的阈值无关度量标准的主要原因。多中心败血症评分的例子高度相关。这是正确的。\n\n**对A的评判**：所有定义和场景在科学上都是合理的，并代表了该领域的最佳实践。该选项完全正确。\n\n**选项B**\n\n-   **准确率**：场景“适用于严重不平衡的数据集”是根本错误的。对于不平衡数据，准确率是一个众所周知的差指标。\n-   **平衡准确率**：场景“适用于阳性类别占主导地位的情况”具有误导性。虽然可以使用，但其主要用途是针对稀有类别。所提供的定义也不精确。\n-   **F1分数（F1）**：定义“一种无阈值的排序度量”是错误的。F1分数是依赖于阈值的。\n-   **马修斯相关系数（MCC）**：声称“当类别平衡时，其数值等同于F1”在数学上是错误的。\n-   **受试者工作特征曲线下面积（AUROC）**：定义“跨阈值的敏感性和精确率的平均值”是错误的；这描述的是精确率-召回率曲线下面积（AUPRC）。\n\n**对B的评判**：该选项包含多个基本错误。它是错误的。\n\n**选项C**\n\n-   **准确率**：场景“适用于假阳性比假阴性的代价高得多的情况”是错误的。准确率对两种错误类型的权重是相等的。\n-   **平衡准确率**：定义“敏感性和精确率的平均值”是错误的。它是敏感性和*特异性*的平均值。\n-   **F1分数（F1）**：定义“敏感性和特异性的算术平均值”是错误的。这定义的是平衡准确率。F1是精确率和召回率的调和平均数。\n-   **马修斯相关系数（MCC）**：定义“一个界于$0$和$1$之间的度量”是错误的；它界于-1和1之间。\n-   **受试者工作特征曲线下面积（AUROC）**：定义“当阈值变化时，精确率-召回率曲线下的面积”是错误的。这定义的是AUPRC。\n\n**对C的评判**：该选项充满了定义性错误。它是错误的。\n\n**选项D**\n\n-   **准确率**：定义“敏感性和特异性之和”是错误的。这是平衡准确率的两倍。\n-   **平衡准确率**：定义“所有患者中正确标签的比例”是错误的；这是准确率的定义。\n-   **F1分数（F1）**：定义“特异性和精确率的调和平均数”是错误的。它是*召回率*（敏感性）和精确率的调和平均数。\n-   **马修斯相关系数（MCC）**：因为它可能为负而“不适合报告模型质量”的结论是一个严重的误解。它能为负是一个特性，而不是一个缺陷，因为它能区分差的模型和反相关的模型。建议在类别不平衡时避免使用它，这与专家共识相反。\n-   **受试者工作特征曲线下面积（AUROC）**：定义和场景是正确的。然而，由于其他四个部分不正确，整个选项无效。\n\n**对D的评判**：该选项的绝大部分内容在事实上是不正确的。它是错误的。\n\n**结论**：我的分析证实，选项A是唯一一个所有定义和相应场景都正确、连贯，并与生物信息学和系统生物医学中既定的机器学习评估原则相一致的选项。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}