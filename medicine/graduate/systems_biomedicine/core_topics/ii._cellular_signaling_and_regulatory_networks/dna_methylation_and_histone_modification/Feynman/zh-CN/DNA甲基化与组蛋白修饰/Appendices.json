{
    "hands_on_practices": [
        {
            "introduction": "在哺乳动物基因组中，DNA甲基化并非均匀分布。CpG岛（CpG islands）是基因组中一些GC含量和CpG二核苷酸频率异常高的区域，它们通常位于基因的启动子附近并且免于被甲基化，从而在基因调控中扮演着关键角色。这项实践将挑战你利用基础的序列特征，通过贝叶斯定理推导出一个概率模型，来预测一个基因组区域是否为CpG岛。这个练习不仅能巩固你对贝叶斯分类的理解，更能让你亲身体会如何将抽象的DNA序列信息与具体的生物学状态（即甲基化易感性）联系起来。",
            "id": "4335581",
            "problem": "系统生物医学中的一个核心现象是，在胞嘧啶-磷酸-鸟嘌呤（CpG）岛内，脱氧核糖核酸（DNA）胞嘧啶甲基化水平降低。CpG岛是短的基因组区域，其特征是与基因组背景相比，具有高的鸟嘌呤+胞嘧啶（GC）含量和升高的CpG观测值/期望值。设一个长度为 $L$ 的基因组窗口由两个序列特征概括：GC含量 $g$ 定义为 $g = (n_{G} + n_{C})/L$，以及CpG观测/期望比值 $r$ 定义为 $r = \\dfrac{n_{\\mathrm{CpG}} \\cdot L}{n_{C} \\cdot n_{G}}$，其中 $n_{G}$、$n_{C}$ 和 $n_{\\mathrm{CpG}}$ 分别是窗口内鸟嘌呤、胞嘧啶和CpG二核苷酸的计数。我们考虑一个概率性的、仅基于序列的分类器，该分类器预测CpG岛的存在，并由此通过其补集预测甲基化易感性。\n\n假设存在两个潜在类别：岛（$I$）和非岛（$N$）。在给定类别的情况下，特征是独立且服从高斯分布的：$g \\mid I \\sim \\mathcal{N}(\\mu_{g,I}, \\sigma_{g,I}^{2})$，$r \\mid I \\sim \\mathcal{N}(\\mu_{r,I}, \\sigma_{r,I}^{2})$，$g \\mid N \\sim \\mathcal{N}(\\mu_{g,N}, \\sigma_{g,N}^{2})$ 以及 $r \\mid N \\sim \\mathcal{N}(\\mu_{r,N}, \\sigma_{r,N}^{2})$。设岛类别的先验概率为 $\\pi = \\mathbb{P}(I)$，因此 $\\mathbb{P}(N) = 1 - \\pi$。此处 $\\mu_{g,I}$、$\\sigma_{g,I}$、$\\mu_{r,I}$、$\\sigma_{r,I}$、$\\mu_{g,N}$、$\\sigma_{g,N}$、$\\mu_{r,N}$、$\\sigma_{r,N}$ 和 $\\pi$ 是代表基因组背景和物种的固定参数。\n\n仅从 $g$ 和 $r$ 的定义、独立性假设、高斯似然和贝叶斯定理出发，推导该模型下窗口的甲基化易感性 $S(g,r)$ 的解析表达式，其定义为 $S(g,r) = 1 - \\mathbb{P}(I \\mid g, r)$。将您的最终答案表示为关于 $g$、$r$、$\\mu_{g,I}$、$\\sigma_{g,I}$、$\\mu_{r,I}$、$\\sigma_{r,I}$、$\\mu_{g,N}$、$\\sigma_{g,N}$、$\\mu_{r,N}$、$\\sigma_{r,N}$ 和 $\\pi$ 的单个闭式函数。无需进行数值评估。用标准的初等函数以最简形式给出您的最终表达式。将最终答案表述为一个解析表达式；最终答案中不允许包含不等式或方程。",
            "solution": "该问题陈述经评估具有科学依据、提法恰当且客观。它为概率分类中的一个标准问题提供了一套完整且一致的定义和条件。该模型虽然是一个抽象，但基于计算生物学和统计建模中的既定原则。因此，该问题是有效的，并且可以推导出解决方案。\n\n甲基化易感性 $S(g,r)$ 定义为 $S(g,r) = 1 - \\mathbb{P}(I \\mid g, r)$，其中 $I$ 表示CpG岛类别，$(g, r)$ 是观测到的特征（GC含量和CpG比率）。由于潜在类别是岛（$I$）和非岛（$N$），根据条件概率的全概率法则，有 $\\mathbb{P}(I \\mid g, r) + \\mathbb{P}(N \\mid g, r) = 1$。因此，易感性正是给定数据下非岛类别的后验概率：\n$$\nS(g,r) = \\mathbb{P}(N \\mid g, r)\n$$\n为了求得这个后验概率，我们应用贝叶斯定理。设 $p(\\cdot)$ 表示概率密度函数。\n$$\n\\mathbb{P}(N \\mid g, r) = \\frac{p(g, r \\mid N) \\mathbb{P}(N)}{p(g, r)}\n$$\n分母 $p(g,r)$ 是数据的边际概率，可以使用全概率法则在两个潜在类别上展开：\n$$\np(g, r) = p(g, r \\mid I) \\mathbb{P}(I) + p(g, r \\mid N) \\mathbb{P}(N)\n$$\n将此代入后验概率的表达式中，得到：\n$$\n\\mathbb{P}(N \\mid g, r) = \\frac{p(g, r \\mid N) \\mathbb{P}(N)}{p(g, r \\mid I) \\mathbb{P}(I) + p(g, r \\mid N) \\mathbb{P}(N)}\n$$\n为简化此表达式，我们可以将分子和分母同除以项 $p(g, r \\mid N) \\mathbb{P}(N)$：\n$$\nS(g, r) = \\frac{1}{\\frac{p(g, r \\mid I) \\mathbb{P}(I)}{p(g, r \\mid N) \\mathbb{P}(N)} + 1}\n$$\n问题陈述指出，在给定类别的情况下，特征 $g$ 和 $r$ 是独立的。这使我们能够将联合条件似然写成各个条件似然的乘积：\n$$\np(g, r \\mid I) = p(g \\mid I) p(r \\mid I)\n$$\n$$\np(g, r \\mid N) = p(g \\mid N) p(r \\mid N)\n$$\n先验概率给定为 $\\mathbb{P}(I) = \\pi$ 和 $\\mathbb{P}(N) = 1 - \\pi$。分母中的比率变为：\n$$\n\\frac{p(g \\mid I) p(r \\mid I) \\pi}{p(g \\mid N) p(r \\mid N) (1 - \\pi)}\n$$\n条件分布给定为高斯分布。正态分布 $\\mathcal{N}(\\mu, \\sigma^2)$ 的概率密度函数为 $p(x) = \\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{(x - \\mu)^2}{2\\sigma^2}\\right)$。我们将相应各项的PDF代入：",
            "answer": "$$\\boxed{\\left(1 + \\frac{\\pi}{1-\\pi} \\frac{\\sigma_{g,N}\\sigma_{r,N}}{\\sigma_{g,I}\\sigma_{r,I}} \\exp\\left( \\frac{(g - \\mu_{g,N})^2}{2\\sigma_{g,N}^2} - \\frac{(g - \\mu_{g,I})^2}{2\\sigma_{g,I}^2} + \\frac{(r - \\mu_{r,N})^2}{2\\sigma_{r,N}^2} - \\frac{(r - \\mu_{r,I})^2}{2\\sigma_{r,I}^2} \\right)\\right)^{-1}}$$"
        },
        {
            "introduction": "识别出潜在的调控区域后，下一个关键问题是理解表观遗传标记是如何被动态地建立、传播和维持的。组蛋白修饰的“读取-写入”（reader-writer）机制，特别是像由PRC2复合物介导的抑制性标记H3K27me3，为细胞记忆提供了一个可能的分子基础。这项编码练习将指导你实现一个H3K27me3传播的动力学模型。通过模拟这个系统，你将探索双稳态（bistability）和结构域形成（domain formation）等关键概念，直观地感受表观遗传状态是如何通过正反馈机制进行动态调控和稳定维持的。",
            "id": "4335592",
            "problem": "您需要在一个一维核小体阵列中，实现并分析一个由 Polycomb Repressive Complex 2 (PRC2) 介导的组蛋白H3赖氨酸27三甲基化扩散的机制性网络模型，该模型需包含读写反馈和去甲基化过程。Polycomb Repressive Complex 2 (PRC2) 是一种组蛋白甲基转移酶，它在组蛋白H3上沉积赖氨酸27的三甲基化（H3K27me3）；PRC2 会更强地被已经带有 H3K27me3 标记的核小体招募，从而产生正反馈，这种正反馈可以驱动双稳态和空间域的形成。您的程序必须是一个完整的、可运行的程序，能够为指定的参数测试套件计算双稳态和域形成指标，并以下文描述的单行格式生成结果。\n\n模型定义：\n- 考虑一个由 $L$ 个核小体位置组成的线性链，索引为 $i \\in \\{0,1,\\dots,L-1\\}$。\n- 令 $x_i(t) \\in [0,1]$ 表示在时间 $t$ 时，位置 $i$ 处处于 H3K27me3 状态的组蛋白H3的比例。\n- 令 $w_{ij}$ 为一个相互作用核，描述从位置 $j$ 到位置 $i$ 的读写招募影响，其约束条件为对于每个 $i$，$\\sum_{j=0}^{L-1} w_{ij} = 1$。假设该核随基因组距离呈指数衰减：$w_{ij} \\propto \\exp(-|i-j|/\\lambda)$，并通过按行归一化来满足总和约束。\n- 将位置 $i$ 处的局部读取信号定义为 $M_i(t) = \\sum_{j=0}^{L-1} w_{ij} x_j(t)$。\n- 令甲基化倾向为基础写入项和读写反馈项之和，通过一个 Hill 函数建模：$k_b + \\alpha h(M_i)$，其中 $h(z) = \\dfrac{z^n}{K^n + z^n}$，Hill系数 $n \\geq 1$，半饱和常数 $K  0$。这里 $k_b \\geq 0$ 是基础甲基化速率，$\\alpha \\geq 0$ 是最大读写放大强度。\n- 令 $k_d \\geq 0$ 为去甲基化速率（例如，代表赖氨酸去甲基化酶如 KDM6 的活性）。\n\n在质量作用式动力学以及甲基化和非甲基化状态之间排他性的假设下，每个位置的动力学方程为：\n$$\n\\frac{dx_i}{dt} = \\left(k_b + \\alpha h(M_i)\\right)\\left(1 - x_i\\right) - k_d x_i.\n$$\n\n用于双稳态分析的均匀态简化：\n- 为在空间均匀近似中评估双稳态，假设对所有 $i$ 都有 $x_i(t) = x(t)$。对于归一化的核，$M_i(t) = x(t)$ 对所有 $i$ 都成立，动力学系统简化为单个变量的常微分方程：\n$$\n\\frac{dx}{dt} = f(x) = \\left(k_b + \\alpha h(x)\\right)\\left(1 - x\\right) - k_d x, \\quad x \\in [0,1].\n$$\n- 稳态 $x^\\ast$ 满足 $f(x^\\ast)=0$。如果 $f'(x^\\ast)  0$，则稳态是（线性）稳定的；如果 $f'(x^\\ast)  0$，则是不稳定的。在 $[0,1]$ 区间内存在至少两个不同的稳定稳态，即定义此简化模型具有双稳态。\n\n空间域形成：\n- 为评估域的形成，从一个初始条件开始对完整的 $L$ 维系统进行积分。该初始条件为：在指定位置 $s$ 处设置一个高 H3K27me3 的单个种子（例如，$x_s(0)=x_{\\text{seed}}$），所有其他位置则初始化为一个低基线值（例如，对于 $i\\neq s$，$x_i(0)=x_{\\text{bg}}$）。\n- 确定性地演化系统，直到其达到数值稳态。将稳态时的域大小定义为 $x_i$ 大于或等于指定阈值 $\\theta \\in (0,1)$ 的位置 $i$ 的数量。\n\n科学基础：\n- 从表观遗传学中读写反馈和质量作用动力学的核心定义出发，确认 PRC2 的招募依赖于现有的 H3K27me3 标记，并且去甲基化酶会降低标记水平。使用 Hill 函数来表示协同招募，这是一个在生化系统中用于模拟协同结合和反应速率放大的、经过充分检验的现象学模型。\n\n您的程序必须执行的数学任务：\n1. 给定参数 $(k_b,\\alpha,k_d,K,n)$，计算简化的单变量系统在 $x \\in [0,1]$上是否是双稳态的。这需要找到 $f(x)$ 在 $[0,1]$ 上的所有根，并通过解析计算的 $f'(x)$ 的符号来对其稳定性进行分类。输出一个布尔值，指示是否存在至少两个稳定稳态。\n2. 给定完整的网络参数 $(L,\\lambda,k_b,\\alpha,k_d,K,n,s,x_{\\text{seed}},x_{\\text{bg}},\\theta)$，构造具有指数衰减和行归一化的 $w_{ij}$，从带种子的初始条件开始将完整网络常微分方程积分至稳态，并计算整数域大小，即 $\\#\\{i : x_i \\geq \\theta\\}$。\n\n数值细节：\n- 使用适用于光滑常微分方程的确定性积分方案；确保 $x_i(t)$ 保持在 $[0,1]$ 区间内（例如，通过钳位或适当的步长）。不需要物理单位；在本练习中，所有速率都是无量纲的。\n- 对于双稳态分析，精细扫描区间 $[0,1]$ 以界定 $f(x)$ 的根的范围，并使用稳健的求根方法对其进行优化。使用解析导数 $f'(x)$ 来分类稳定性：\n$$\nh(x) = \\frac{x^n}{K^n + x^n}, \\quad h'(x) = \\frac{n K^n x^{n-1}}{\\left(K^n + x^n\\right)^2},\n$$\n$$\nf'(x) = \\alpha h'(x)\\left(1 - x\\right) - \\left(k_b + \\alpha h(x)\\right) - k_d.\n$$\n\n测试套件：\n您的程序必须评估以下四组参数集，每组产生两个输出：双稳态（布尔值）和域大小（整数）。对每个案例使用相同的阈值 $\\theta$。种子索引 $s$ 是中点 $s=\\lfloor L/2 \\rfloor$。\n\n- 案例1（一般读写反馈，中等去甲基化；如果反馈足够强，预计会产生双稳态和域形成）：\n    - $L=50$, $\\lambda=5$, $k_b=0.01$, $\\alpha=0.60$, $k_d=0.05$, $K=0.20$, $n=4$, $s=25$, $x_{\\text{seed}}=0.80$, $x_{\\text{bg}}=0.00$, $\\theta=0.60$。\n- 案例2（弱反馈；预计为单稳态，域形成极小或无）：\n    - $L=50$, $\\lambda=3$, $k_b=0.01$, $\\alpha=0.10$, $k_d=0.05$, $K=0.30$, $n=2$, $s=25$, $x_{\\text{seed}}=0.80$, $x_{\\text{bg}}=0.00$, $\\theta=0.60$。\n- 案例3（强反馈，较高去甲基化；预计会对双稳态构成挑战并限制域大小）：\n    - $L=50$, $\\lambda=7$, $k_b=0.02$, $\\alpha=0.80$, $k_d=0.20$, $K=0.25$, $n=3$, $s=25$, $x_{\\text{seed}}=0.80$, $x_{\\text{bg}}=0.00$, $\\theta=0.60$。\n- 案例4（非常强的反馈和长程扩散；预计有利于双稳态和形成大域）：\n    - $L=50$, $\\lambda=10$, $k_b=0.03$, $\\alpha=0.90$, $k_d=0.05$, $K=0.15$, $n=5$, $s=25$, $x_{\\text{seed}}=0.80$, $x_{\\text{bg}}=0.00$, $\\theta=0.60$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，条目按案例顺序排列为 $[\\text{bistability}_1,\\text{domain}_1,\\text{bistability}_2,\\text{domain}_2,\\text{bistability}_3,\\text{domain}_3,\\text{bistability}_4,\\text{domain}_4]$。布尔值必须以其编程语言的规范形式打印，域大小必须是整数。\n\n实现约束：\n- 语言：Python\n- 版本：3.12\n- 库：仅限 numpy (1.23.5), scipy (1.11.4)\n- 自包含：无用户输入，无外部文件，无网络访问\n- 确保代码可读性，并精确生成指定的单行输出。",
            "solution": "用户提供了一个需要实现和分析表观遗传扩散机制模型的问题。该问题定义明确，在科学上基于系统生物学原理，并且在计算上是可行的。验证过程确认所有必要的组件都已指定且一致。因此，我将着手提供一个完整的解决方案。\n\n该解决方案按要求分为两个主要的计算任务：\n1.  **双稳态分析**：确定模型的空间均匀（零维）简化形式是否表现出至少两个稳定稳态。\n2.  **空间域模拟**：模拟完整的一维模型，以确定从带种子的初始条件形成的 H3K27me3 域的大小。\n\n### 第1部分：均匀态简化的双稳态分析\n\n问题为每个核小体位置 $i$ 处的 H3K27me3 甲基化比例 $x_i(t)$ 的动力学建立了一个模型。在空间均匀系统中，我们假设对于所有 $i$，$x_i(t) = x(t)$。由于相互作用核 $w_{ij}$ 经过按行归一化，使得 $\\sum_j w_{ij} = 1$，局部读取信号简化为 $M_i(t) = \\sum_j w_{ij} x_j(t) = x(t) \\sum_j w_{ij} = x(t)$。因此，完整的 $L$ 个微分方程组简化为关于均匀甲基化比例 $x(t) \\in [0,1]$ 的单个常微分方程（ODE）：\n$$\n\\frac{dx}{dt} = f(x) = \\left(k_b + \\alpha h(x)\\right)\\left(1 - x\\right) - k_d x\n$$\n其中 $h(x) = \\frac{x^n}{K^n + x^n}$ 是代表协同读写反馈的 Hill 函数。参数 $k_b, \\alpha, k_d, K, n$ 分别是基础甲基化速率、最大反馈强度、去甲基化速率、半饱和常数和 Hill 系数。\n\n稳态，记为 $x^\\ast$，是方程 $f(x^\\ast) = 0$ 的根。稳态的稳定性由 $f(x)$ 在该状态的导数 $f'(x^\\ast)$ 的符号决定。如果 $f'(x^\\ast)  0$，则稳态是线性稳定的；如果 $f'(x^\\ast)  0$，则是不稳定的。如果区间 $[0,1]$ 中存在至少两个不同的稳定稳态，则该系统被定义为双稳态。\n\n解析导数 $f'(x)$ 由下式给出：\n$$\nf'(x) = \\alpha h'(x)\\left(1 - x\\right) - \\left(k_b + \\alpha h(x)\\right) - k_d\n$$\n其中 Hill 函数的导数为：\n$$\nh'(x) = \\frac{n K^n x^{n-1}}{\\left(K^n + x^n\\right)^2}\n$$\n\n为实现双稳态分析，我们遵循一个数值程序：\n1.  **求根**：我们必须找到 $f(x)=0$ 在区间 $x \\in [0,1]$ 上的所有根。一个稳健的方法是首先用一个精细的网格（例如，从0到1的1001个点）扫描该区间，以识别 $f(x)$ 符号发生变化的子区间。根据介值定理，两点之间的符号变化保证了它们之间至少存在一个根。然后，我们对每个这样的子区间使用数值求根算法，例如 Brent-Dekker 方法（`scipy.optimize.brentq`），以高精度找到根。\n2.  **稳定性分类**：对于找到的每个根 $x^\\ast$，我们计算解析导数 $f'(x^\\ast)$ 的值。\n3.  **双稳态判定**：我们计算稳定稳态（即 $f'(x^\\ast)  0$ 的状态）的数量。如果此计数大于或等于二，则宣布该系统为双稳态。\n\n### 第2部分：空间域形成\n\n此任务涉及模拟由 $L$ 个耦合ODE组成的完整一维系统：\n$$\n\\frac{dx_i}{dt} = \\left(k_b + \\alpha h(M_i)\\right)\\left(1 - x_i\\right) - k_d x_i, \\quad \\text{for } i = 0, 1, \\dots, L-1\n$$\n其中 $M_i = \\sum_{j=0}^{L-1} w_{ij} x_j$。\n\n实现需要几个步骤：\n1.  **构建相互作用核 ($w_{ij}$)**：核 $w_{ij}$ 描述了核小体 $j$ 对核小体 $i$ 的影响。它由随基因组距离的指数衰减定义，$w_{ij}' = \\exp(-|i-j|/\\lambda)$，其中 $\\lambda$ 是特征扩散长度。然后，这个未归一化的核按行进行归一化，以满足对所有 $i$ 的约束 $\\sum_{j=0}^{L-1} w_{ij} = 1$。在矩阵形式中，我们构建一个未归一化的权重矩阵，然后将每一行除以其总和。\n2.  **建立ODE系统**：我们定义一个函数，该函数在给定当前状态向量 $\\vec{x}(t)$ 和时间 $t$ 的情况下，计算导数向量 $\\frac{d\\vec{x}}{dt}$。该函数首先通过矩阵-向量乘法计算读取信号向量 $\\vec{M} = W \\vec{x}$，然后对 $\\vec{M}$ 的每个分量逐元素计算 Hill 函数值，最后根据控制方程计算所有 $x_i$ 的导数。状态变量 $x_i$ 被约束在 $[0,1]$ 内。ODE的结构确保了如果系统从超立方体 $[0,1]^L$ 开始，它将始终保持在其中，因为边界上的向量场指向内部。\n3.  **数值积分**：我们使用一个稳健的ODE求解器，例如 `scipy.integrate.solve_ivp`，来随时间积分系统。积分从指定的初始条件开始：在中心位置 $s=\\lfloor L/2 \\rfloor$ 有一个高甲基化的单个“种子”，$x_s(0) = x_{\\text{seed}}$，而所有其他位置处于低背景水平，$x_i(0)=x_{\\text{bg}}$ （对于 $i \\neq s$）。我们进行足够长时间的积分，以使系统收敛到数值稳态。\n4.  **测量域大小**：一旦获得稳态向量 $\\vec{x}_{\\text{ss}}$（即最终积分时间的解），我们确定域的大小。这被定义为甲基化水平 $x_{i, \\text{ss}}$ 超过给定阈值 $\\theta$ 的核小体位置 $i$ 的数量。这通过计算满足 $x_{i, \\text{ss}} \\ge \\theta$ 的 $\\vec{x}_{\\text{ss}}$ 元素个数来完成。\n\n通过实现这两个组件，我们可以处理给定的测试案例并生成所需的输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\nfrom scipy.integrate import solve_ivp\n\ndef check_bistability(kb, alpha, kd, K, n):\n    \"\"\"\n    Computes whether the reduced one-variable system is bistable.\n\n    Args:\n        kb (float): Basal methylation rate.\n        alpha (float): Maximal reader-writer amplification strength.\n        kd (float): Demethylation rate.\n        K (float): Half-saturation constant for Hill function.\n        n (float): Hill coefficient.\n\n    Returns:\n        bool: True if the system is bistable, False otherwise.\n    \"\"\"\n    # Define the function f(x) for which roots are the steady states.\n    def f(x):\n        # The Hill function h(x)\n        try:\n            h_x = (x**n) / (K**n + x**n)\n        except (ValueError, ZeroDivisionError):\n            # Handle potential numerical issues at x=0 for n1, although n>=1 is a constraint.\n            if x == 0:\n                h_x = 0\n            else:\n                # This case should not be reached with valid inputs\n                h_x = 1.0 if x > K else 0.0\n        return (kb + alpha * h_x) * (1 - x) - kd * x\n\n    # Define the derivative f'(x) to classify stability.\n    def f_prime(x):\n        # The Hill function h(x) and its derivative h'(x)\n        x_n = x**n\n        K_n = K**n\n        denom = K_n + x_n\n        h_x = x_n / denom\n        # Handle x=0 case for n=1 in derivative\n        if x == 0 and n == 1:\n            h_prime_x = n * K_n / (denom**2)\n        elif x == 0 and n > 1:\n            h_prime_x = 0\n        else:\n             h_prime_x = (n * K_n * x**(n - 1)) / (denom**2)\n        \n        return alpha * h_prime_x * (1 - x) - (kb + alpha * h_x) - kd\n\n    # Find roots of f(x) in [0, 1] by bracketing and then refining.\n    roots = []\n    grid = np.linspace(0, 1, 1001)\n    y_grid = np.array([f(p) for p in grid])\n\n    for i in range(len(grid) - 1):\n        if np.sign(y_grid[i]) != np.sign(y_grid[i+1]):\n            try:\n                root = brentq(f, grid[i], grid[i+1])\n                # Add root if it's not a duplicate\n                if not any(np.isclose(root, r) for r in roots):\n                    roots.append(root)\n            except ValueError:\n                # brentq raises ValueError if signs are not opposite, but we checked.\n                # This is a safeguard.\n                pass\n\n    # Count number of stable steady states.\n    stable_states_count = 0\n    for r in roots:\n        if f_prime(r)  0:\n            stable_states_count += 1\n\n    return stable_states_count >= 2\n\ndef compute_domain_size(L, lam, kb, alpha, kd, K, n, s, x_seed, x_bg, theta):\n    \"\"\"\n    Computes the steady-state domain size for the full spatial model.\n\n    Args:\n        L (int): Number of nucleosomes.\n        lam (float): Spreading length for the interaction kernel.\n        kb, alpha, kd, K, n: Model parameters.\n        s (int): Seed position index.\n        x_seed (float): Methylation fraction at the seed.\n        x_bg (float): Background methylation fraction.\n        theta (float): Threshold for counting a position in the domain.\n\n    Returns:\n        int: The number of positions with methylation >= theta at steady state.\n    \"\"\"\n    # 1. Construct the interaction kernel W\n    indices = np.arange(L)\n    dist_matrix = np.abs(indices[:, np.newaxis] - indices)\n    W_unnormalized = np.exp(-dist_matrix / lam)\n    row_sums = W_unnormalized.sum(axis=1)\n    W = W_unnormalized / row_sums[:, np.newaxis]\n\n    # 2. Define the system of ODEs\n    def dxdt(t, y, W_mat, kb_p, alpha_p, kd_p, K_p, n_p):\n        M = W_mat @ y\n        # Clipping M to [0, 1] is a safeguard against numerical integration errors.\n        M_safe = np.clip(M, 0.0, 1.0)\n        K_n = K_p**n_p\n        M_safe_n = M_safe**n_p\n        h_M = M_safe_n / (K_n + M_safe_n)\n        return (kb_p + alpha_p * h_M) * (1 - y) - kd_p * y\n\n    # 3. Set up initial conditions\n    x0 = np.full(L, x_bg, dtype=float)\n    x0[s] = x_seed\n\n    # 4. Integrate the ODEs to steady state\n    t_final = 5000.0\n    t_span = (0, t_final)\n    \n    sol = solve_ivp(\n        fun=dxdt,\n        t_span=t_span,\n        y0=x0,\n        method='RK45',\n        args=(W, kb, alpha, kd, K, n)\n    )\n\n    # 5. Compute domain size from the final state\n    x_ss = sol.y[:, -1]\n    domain_size = int(np.sum(x_ss >= theta))\n    \n    return domain_size\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {'L': 50, 'lambda': 5, 'kb': 0.01, 'alpha': 0.60, 'kd': 0.05, 'K': 0.20, 'n': 4, 's': 25, 'x_seed': 0.80, 'x_bg': 0.00, 'theta': 0.60},\n        # Case 2\n        {'L': 50, 'lambda': 3, 'kb': 0.01, 'alpha': 0.10, 'kd': 0.05, 'K': 0.30, 'n': 2, 's': 25, 'x_seed': 0.80, 'x_bg': 0.00, 'theta': 0.60},\n        # Case 3\n        {'L': 50, 'lambda': 7, 'kb': 0.02, 'alpha': 0.80, 'kd': 0.20, 'K': 0.25, 'n': 3, 's': 25, 'x_seed': 0.80, 'x_bg': 0.00, 'theta': 0.60},\n        # Case 4\n        {'L': 50, 'lambda': 10, 'kb': 0.03, 'alpha': 0.90, 'kd': 0.05, 'K': 0.15, 'n': 5, 's': 25, 'x_seed': 0.80, 'x_bg': 0.00, 'theta': 0.60},\n    ]\n\n    results = []\n    for case in test_cases:\n        bistable = check_bistability(case['kb'], case['alpha'], case['kd'], case['K'], case['n'])\n        domain = compute_domain_size(\n            case['L'], case['lambda'], case['kb'], case['alpha'], case['kd'], \n            case['K'], case['n'], case['s'], case['x_seed'], case['x_bg'], case['theta']\n        )\n        results.extend([bistable, domain])\n\n    # Format output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == '__main__':\n    solve()\n\n```"
        },
        {
            "introduction": "在系统生物医学中，一个终极目标是阐明分子因素在健康和疾病中的因果作用。然而，在观察性研究中，表观遗传标记与表型（如疾病状态）之间的相关性常常受到混杂因素的干扰，使得因果推断变得异常困难。这项压轴实践将带你进入因果推断的前沿领域。你将深入思考如何运用遗传变异作为“工具变量”（instrumental variables），在孟德尔随机化（Mendelian Randomization）的框架下，从复杂的观察数据中剥离出表观遗传标记对表型的真实因果效应，这是解读高维组学数据并提出可靠生物学结论的核心技能。",
            "id": "4335638",
            "problem": "一个系统生物医学的研究团队旨在确定表观遗传标记是否对一个复杂的炎症表型有因果影响。设$M$表示一个细胞因子基因附近启动子CpG位点的DNA甲基化，设$H$表示同一启动子的组蛋白H$3$赖氨酸$27$乙酰化（H$3$K$27$ac），设$Y$表示在血浆中测量的一个连续的炎症生物标志物。在一个规模为$n$的队列中进行的观察性分析显示，$M$和$H$均与$Y$相关。设$U$表示未测量的因素，如吸烟强度、潜伏感染负荷和循环免疫细胞类型构成。该团队考虑以下线性结构模型作为起点：\n- $M = \\alpha_{G_M} G_M + \\alpha_{U \\to M} U + \\varepsilon_M$，\n- $H = \\alpha_{G_H} G_H + \\alpha_{U \\to H} U + \\varepsilon_H$，\n- $Y = \\beta_M M + \\beta_H H + \\beta_U U + \\varepsilon_Y$，\n其中$G_M$是$M$的一个顺式甲基化数量性状位点（cis-meQTL），$G_H$是$H$的一个顺式组蛋白数量性状位点（cis-hQTL），$\\varepsilon_M$、$\\varepsilon_H$和$\\varepsilon_Y$是均值为零的误差，所有系数都是有限常数。假设生殖系基因型在受孕时根据Mendel定律分配，并在整个生命过程中保持不变，且中心法则（DNA到RNA到蛋白质）作为经过充分检验的分子流动组织原则是成立的。该团队认识到，$M$或$H$与$Y$之间的相关性通常不等于因果关系。\n\n根据因果推断和遗传学的基本原理，解释为什么将$Y$对$M$（或$H$）进行朴素回归可能会产生偏倚，并评估使用遗传变异来识别$M$和$H$对$Y$的因果效应的工具变量策略。考虑工具变量的核心假设，即相关性、独立性和排他性限制，以及水平多效性和连锁不平衡的可能性。\n\n在这种情况下，以下哪些策略和主张对于识别和诊断$M$和/或$H$对$Y$的因果效应是有效的？选择所有适用的选项。\n\nA. 使用单个顺式甲基化数量性状位点（cis-meQTL）$G_M$作为$M$的工具变量，并在单样本分析中使用比率估计量来估计$M$对$Y$的因果效应，前提是先验证$G_M$与$M$强相关（例如，$F$统计量$ 10$），$G_M$与$U$的可测量代理变量不相关，且精细定位和共定位表明相同的因果变异驱动了$G_M$–$M$和$G_M$–$Y$的关联；并辅以针对水平多效性的敏感性分析。\n\nB. 使用一个能广泛影响多个基因的反式表达数量性状位点（trans-eQTL）作为$H$的工具变量，因为其广泛的调控影响既能增强工具变量，又能通过平均跨通路效应来最小化对排他性限制的违反。\n\nC. 在$Y$对$M$和$H$的多元回归中对已测量的混杂因素进行校正；当$n$足够大时，$U$造成的任何残余未测量混杂预计可以忽略不计，因此$M$的系数可以在没有工具变量的情况下被解释为因果效应。\n\nD. 实施结合了汇总统计数据的双样本孟德尔随机化：对于同一个顺式甲基化数量性状位点$G_M$，从$Y$的全基因组关联研究中获得$\\widehat{\\beta}_{YG}$，从$M$的全表观基因组关联研究中获得$\\widehat{\\beta}_{MG}$，要求在位点上$M$和$Y$之间有高的共定位后验概率，应用Steiger方向性检验来测试$G_M \\to M \\to Y$，并限制于祖源匹配的样本以减轻群体分层的影响。\n\nE. 构建$Y$的多基因风险评分并将其用作$M$的工具变量以最大化工具变量强度；由于生殖系变异是固定的，这将满足独立性假设，从而识别出$M$对$Y$的因果效应。\n\nF. 使用$G_M$作为$M$的工具变量，$G_H$作为$H$的工具变量，拟合一个多变量孟德尔随机化模型，以同时估计直接效应$\\beta_M$和$\\beta_H$；使用条件$F$统计量诊断弱工具变量，并使用多变量MR-Egger等方法评估定向多效性，同时验证$G_M$和$G_H$除了分别通过$M$和$H$之外，没有其他直接通向$Y$的路径。\n\n选项是独立的；选择所有正确的选项。不要假设可以获得干预性数据。你的推理应基于结构方程、孟德尔自由组合以及工具变量假设的定义，而不依赖任何未提及的快捷公式。",
            "solution": "该问题陈述是对系统生物医学中一个因果推断挑战的有效表述。它具有科学依据，问题提出得当，客观且内部一致。它提出了一个关于在存在未测量混杂的情况下从观察数据中估计因果效应的非平凡问题，这是流行病学和统计遗传学的核心问题。\n\n### 朴素回归偏倚分析\n\n目标是从结果$Y$的结构方程中估计因果参数$\\beta_M$和$\\beta_H$：\n$$Y = \\beta_M M + \\beta_H H + \\beta_U U + \\varepsilon_Y$$\n仅对$Y$关于$M$进行朴素回归，即拟合$Y \\sim M$，将得到一个收敛于$\\frac{\\text{Cov}(Y, M)}{\\text{Var}(M)}$的估计系数。我们来分析这个项。为简单起见，假设所有变量都已中心化：\n$$ \\text{Cov}(Y, M) = \\text{Cov}(\\beta_M M + \\beta_H H + \\beta_U U + \\varepsilon_Y, M) $$\n$$ = \\beta_M \\text{Cov}(M, M) + \\beta_H \\text{Cov}(H, M) + \\beta_U \\text{Cov}(U, M) + \\text{Cov}(\\varepsilon_Y, M) $$\n给定$M$和$H$的结构模型：\n$$ M = \\alpha_{G_M} G_M + \\alpha_{U \\to M} U + \\varepsilon_M $$\n$$ H = \\alpha_{G_H} G_H + \\alpha_{U \\to H} U + \\varepsilon_H $$\n未测量因素$U$是$M$、$H$和$Y$的共同原因。从方程中可以看出，$U$与$M$相关（如果$\\alpha_{U \\to M} \\neq 0$）且与$H$相关（如果$\\alpha_{U \\to H} \\neq 0$）。因此，$\\text{Cov}(U, M)$和$\\text{Cov}(H, M)$（通过对$U$的共同依赖）通常不为零。\n具体来说，$\\text{Cov}(U, M) = \\alpha_{U \\to M} \\text{Var}(U)$（假设$U$与$G_M$和$\\varepsilon_M$不相关）。\n朴素模型的回归系数为：\n$$ \\frac{\\text{Cov}(Y, M)}{\\text{Var}(M)} = \\beta_M + \\beta_H \\frac{\\text{Cov}(H, M)}{\\text{Var}(M)} + \\beta_U \\frac{\\text{Cov}(U, M)}{\\text{Var}(M)} $$\n这个表达式对于真实的因果效应$\\beta_M$是有偏的。偏倚由两项组成：一项是由于平行暴露$H$的混杂（$H$本身受$U$影响，路径为$M \\leftarrow U \\to H \\to Y$），另一项是由于$U$的直接混杂（路径为$M \\leftarrow U \\to Y$）。因为$U$是未测量的，所以这种偏倚不能通过简单地在回归模型中包含$U$来消除。这是遗漏变量偏倚的典型例子。\n\n### 工具变量（IV）策略\n\n为了克服这种偏倚，我们可以使用遗传变异作为工具变量。一个有效的暴露$M$的工具变量$G$必须满足三个核心假设：\n1.  **相关性（IV1）：** $G$必须与$M$相关。对于$G_M$，这意味着$\\alpha_{G_M} \\neq 0$。\n2.  **独立性（IV2）：** $G$必须与$M-Y$关系的所有未测量混杂因素$U$独立。由于孟德尔自由组合，对于生殖系变异相对于环境或行为混杂因素来说，这是合理的，即$\\text{Cov}(G_M, U) = 0$。\n3.  **排他性限制（IV3）：** $G$仅通过$M$影响$Y$。任何从$G$到$Y$的路径都必须经过$M$。\n\n模型所强调的一个关键挑战是，一个暴露的工具变量可能与另一个暴露相关，从而违反了排他性限制。这被称为水平多效性。例如，如果我们使用$G_M$作为$M$的工具变量，$\\beta_M$的IV估计量是$\\frac{\\text{Cov}(G_M, Y)}{\\text{Cov}(G_M, M)}$。\n$$ \\text{Cov}(G_M, Y) = \\text{Cov}(G_M, \\beta_M M + \\beta_H H + \\beta_U U) = \\beta_M \\text{Cov}(G_M, M) + \\beta_H \\text{Cov}(G_M, H) $$\nIV估计量是$\\beta_M + \\beta_H \\frac{\\text{Cov}(G_M, H)}{\\text{Cov}(G_M, M)}$。除非$\\beta_H=0$或$\\text{Cov}(G_M, H)=0$，否则它是有偏的。如果$G_M$对$H$有多效性影响，或者与$G_H$处于连锁不平衡（LD）状态，那么$\\text{Cov}(G_M, H)$项将不为零。\n\n### 选项评估\n\n**A. 使用单个顺式甲基化数量性状位点（cis-meQTL）$G_M$作为$M$的工具变量...**\n该选项提出了一套严谨的单工具变量孟德尔随机化（MR）工作流程。检查强工具变量（$F$统计量$ 10$）验证了相关性假设（IV1），并减轻了弱工具变量偏倚。检查与$U$的代理变量的关联是对独立性假设（IV2）的必要（尽管不完全）检验。至关重要的是，使用精细定位和共定位来确认$G_M-M$和$G_M-Y$关联共享一个因果变异，是加强排他性限制（IV3）证据和排除连锁不平衡混杂的最新方法。最后，承认需要对残余的水平多效性进行敏感性分析，表明这是一种方法学上合理且谨慎的方法。\n结论：**正确**。\n\n**B. 使用一个反式表达数量性状位点（trans-eQTL）...**\n这个提议根本上是错误的。一个能广泛影响多个基因的`trans-eQTL`，根据定义，是高度多效性的。排他性限制（IV3）要求工具变量*仅*通过指定的暴露（$H$）影响结果。一个具有广泛效应的工具变量最大程度地违反了这一假设，因为它创造了无数不经过$H$而到达结果（$Y$）的路径。声称这“通过平均跨通路效应来最小化对排他性限制的违反”是毫无根据的；广泛的多效性是MR研究有效性的主要威胁，而不是一个理想的特性。此外，`trans`效应通常比`cis`效应弱得多，所以这样的变异很可能是一个弱工具变量，导致显著的偏倚。\n结论：**错误**。\n\n**C. 在多元回归中对已测量的混杂因素进行校正...**\n这种说法显示了对混杂偏倚的基本误解。由未测量变量（$U$）引起的混杂是系统误差（偏倚），而不是随机误差（方差）。增加样本量$n$会减少方差并提高估计的精度，但不会减少偏倚。受混杂影响的估计量是不一致的；当$n \\to \\infty$时，它收敛到一个错误的值，而不是真实的因果效应。鉴于$U$被定义为包括吸烟和免疫细胞构成等强效因素，无论样本量大小，残余的未测量混杂预计都是显著的，而不是可以忽略不计的。\n结论：**错误**。\n\n**D. 实施结合了汇总统计数据的双样本孟德尔随机化...**\n该选项描述了一种复杂且有效的双样本MR研究设计。使用来自大规模GWAS和EWAS的汇总统计数据（$\\widehat{\\beta}_{YG}$和$\\widehat{\\beta}_{MG}$）是一种强大而高效的方法。所提出的验证步骤是关键且恰当的：共定位解决了工具变量位点上的连锁不平衡混杂；Steiger方向性检验有助于确认假定的因果方向（$G_M \\to M \\to Y$）并防止反向因果关系（$G_M \\to Y \\to M$）；限制于祖源匹配的样本可以减轻群体分层带来的偏倚。这构成了一个稳健、先进的MR流程。\n结论：**正确**。\n\n**E. 构建$Y$的多基因风险评分并将其用作$M$的工具变量...**\n这个策略是无效的。一个针对结果$Y$的多基因风险评分（PRS）是由大量已知与$Y$相关的遗传变异构建的。要作为一个有效的$M$的工具变量，这个PRS需要满足排他性限制：它必须*仅*通过$M$影响$Y$。根据其构建方式，一个$Y$的PRS包含了通过无数生物学通路影响$Y$的变异，其中大多数通路不会涉及特定的表观遗传标记$M$。这代表了由于普遍的水平多效性而对排他性限制的严重违反。虽然这些变异是生殖系的，满足了与环境混杂因素的独立性（IV2），但对排他性限制（IV3）的违反使得该工具变量完全不适合估计$M$的因果效应。\n结论：**错误**。\n\n**F. 使用$G_M$作为$M$的工具变量，$G_H$作为$H$的工具变量，拟合一个多变量孟德尔随机化模型...**\n对于给定的问题，这是一种先进且非常合适的策略。结构模型明确包含了两个暴露$M$和$H$，它们很可能相关，并且它们的遗传影响可能有关联。多变量MR（MVMR）就是专门为解决这种情况而设计的。通过为两个暴露（$G_M$和$G_H$）都使用工具变量，MVMR可以同时估计$M$对$Y$的直接因果效应（$\\beta_M$）和$H$对$Y$的直接因果效应（$\\beta_H$），同时考虑到工具变量之间的相关性（例如，连锁不平衡）和暴露之间的相关性。所描述的诊断方法——用于工具变量强度的条件$F$统计量和用于多效性的多变量MR-Egger——是验证MVMR分析的正确的、最先进的工具。这种方法正确地解决了会使标准单暴露MR产生偏倚的多效性混杂路径（$G_M \\to H \\to Y$或$G_M \\leftrightarrow G_H \\to H \\to Y$）。\n结论：**正确**。",
            "answer": "$$\\boxed{ADF}$$"
        }
    ]
}