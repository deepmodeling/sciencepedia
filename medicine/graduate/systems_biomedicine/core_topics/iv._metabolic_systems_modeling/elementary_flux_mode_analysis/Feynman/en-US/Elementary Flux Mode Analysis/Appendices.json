{
    "hands_on_practices": [
        {
            "introduction": "This first practice is a foundational exercise designed to build your intuition for Elementary Flux Modes (EFMs). By working with a small, manageable metabolic network, you will learn to identify these minimal pathways \"by inspection\" – translating the system of linear equations $S v = 0$ into functional routes through the network. This hands-on calculation is crucial for understanding how the abstract concept of a support-minimal flux vector corresponds to a coherent biological pathway .",
            "id": "4337330",
            "problem": "Consider a minimal intracellular conversion module in a mammalian cell involving three internal metabolites $A$, $B$, and $C$, with six exchange and transformation reactions. The stoichiometric matrix $S \\in \\mathbb{R}^{3 \\times 6}$ (rows ordered as $A$, $B$, $C$; columns ordered as reactions $v_{1},\\dots,v_{6}$) and the irreversibility pattern $I$ are given by\n$$\nS \\;=\\;\n\\begin{pmatrix}\n1 & -1 & 0 & 0 & -1 & 0 \\\\\n0 & 1 & -1 & 0 & 0 & -1 \\\\\n0 & 0 & 1 & -1 & 1 & 0\n\\end{pmatrix},\n\\qquad\nI \\;=\\; (1,\\,1,\\,1,\\,1,\\,1,\\,1),\n$$\nwhere $I_{i} = 1$ indicates reaction $i$ is irreversible, imposing $v_{i} \\ge 0$ for all $i \\in \\{1,\\dots,6\\}$. The reactions can be interpreted as follows: $v_{1}$ is uptake into $A$, $v_{2}$ is $A \\to B$, $v_{3}$ is $B \\to C$, $v_{4}$ is secretion from $C$, $v_{5}$ is $A \\to C$, and $v_{6}$ is secretion from $B$. Under the standard steady-state assumption for intracellular metabolites, the flux vector $v \\in \\mathbb{R}^{6}$ satisfies $S v = 0$ and $v \\ge 0$ componentwise.\n\nStarting from the fundamental definition that an Elementary Flux Mode (EFM) is a nonzero flux vector that lies in the flux cone $\\{v \\in \\mathbb{R}^{6} \\mid S v = 0,\\, v \\ge 0\\}$ and has minimal support with respect to set inclusion among feasible flux vectors, enumerate all EFMs of this network by inspection and verify minimality by testing all proper supports for feasibility. Provide the total number of EFMs as your final answer. Express your final answer as a unitless number. No rounding is required.",
            "solution": "The problem asks for the enumeration of all Elementary Flux Modes (EFMs) for a given metabolic network. The network's stoichiometry is described by the matrix $S \\in \\mathbb{R}^{3 \\times 6}$, and all reactions are irreversible.\n\nFirst, we establish the system of equations that define the flux cone. A flux vector $v = (v_1, v_2, v_3, v_4, v_5, v_6)^T$ must satisfy the steady-state condition $S v = 0$ and the non-negativity constraints $v_i \\ge 0$ for $i \\in \\{1, \\dots, 6\\}$.\n\nThe matrix equation $S v = 0$ translates to the following system of linear equations:\n1.  $v_1 - v_2 - v_5 = 0$\n2.  $v_2 - v_3 - v_6 = 0$\n3.  $v_3 - v_4 + v_5 = 0$\n\nAn Elementary Flux Mode (EFM) is a non-zero vector $v$ that satisfies these three equations and $v \\ge 0$, and whose support, $supp(v) = \\{i \\mid v_i \\neq 0\\}$, is minimal with respect to set inclusion. This means no other non-zero flux vector $v'$ exists such that $supp(v') \\subsetneq supp(v)$.\n\nThe problem suggests finding the EFMs \"by inspection,\" which corresponds to identifying the minimal, self-contained pathways from input to output. The only uptake reaction is $v_1$, so any EFM must have $v_1 > 0$. The secretion reactions are $v_4$ and $v_6$. Thus, any EFM must represent a pathway from the uptake of $A$ to the secretion of $B$ or $C$.\n\nWe identify three such simple pathways:\n\nPathway 1: $v_1 \\to v_2 \\to v_3 \\to v_4$. This corresponds to the overall conversion of external substrate to product $C$ via intermediate $B$. The active reactions are $v_1, v_2, v_3, v_4$. We assume $v_5=0$ and $v_6=0$.\nThe system of equations becomes:\n$v_1 - v_2 = 0 \\implies v_1 = v_2$\n$v_2 - v_3 = 0 \\implies v_2 = v_3$\n$v_3 - v_4 = 0 \\implies v_3 = v_4$\nThis leads to $v_1 = v_2 = v_3 = v_4$. Setting the flux to a normalized value of $1$, we obtain the candidate flux vector $e_1 = (1, 1, 1, 1, 0, 0)^T$. The support is $supp(e_1) = \\{1, 2, 3, 4\\}$.\n\nPathway 2: $v_1 \\to v_5 \\to v_4$. This is a direct conversion of $A$ to $C$. The active reactions are $v_1, v_5, v_4$. We assume $v_2=0, v_3=0, v_6=0$.\nThe system becomes:\n$v_1 - v_5 = 0 \\implies v_1 = v_5$\n$0 = 0$\n$-v_4 + v_5 = 0 \\implies v_4 = v_5$\nThis leads to $v_1 = v_5 = v_4$. For a normalized flux of $1$, we get the candidate vector $e_2 = (1, 0, 0, 1, 1, 0)^T$. The support is $supp(e_2) = \\{1, 4, 5\\}$.\n\nPathway 3: $v_1 \\to v_2 \\to v_6$. This pathway represents the conversion of external substrate to product $B$, which is then secreted. The active reactions are $v_1, v_2, v_6$. We assume $v_3=0, v_4=0, v_5=0$.\nThe system becomes:\n$v_1 - v_2 = 0 \\implies v_1 = v_2$\n$v_2 - v_6 = 0 \\implies v_2 = v_6$\n$0 = 0$\nThis leads to $v_1 = v_2 = v_6$. For a normalized flux of $1$, we get the candidate vector $e_3 = (1, 1, 0, 0, 0, 1)^T$. The support is $supp(e_3) = \\{1, 2, 6\\}$.\n\nNext, we must verify the minimality of the support for each candidate vector.\n\nFor $e_1$ with $supp(e_1) = \\{1, 2, 3, 4\\}$:\nIf we consider any proper subset of this support, the chain of reactions is broken. For example, let's test the support $\\{1, 2, 3\\}$ by setting $v_4=0$ (in addition to $v_5=0, v_6=0$). The third equation $v_3 - v_4 + v_5 = 0$ becomes $v_3=0$. This implies $v_2=v_3=0$ and $v_1=v_2=0$. Thus, only the zero flux is possible. This holds for any proper subset. Therefore, $supp(e_1)$ is minimal, and $e_1$ is an EFM.\n\nFor $e_2$ with $supp(e_2) = \\{1, 4, 5\\}$:\nLet's test the support $\\{1, 5\\}$ by setting $v_4=0$. The third equation $v_3 - v_4 + v_5 = 0$ (with $v_3=0$) becomes $v_5=0$. From the first equation, $v_1 - v_2 - v_5 = 0$ (with $v_2=0$), we get $v_1=v_5=0$. Again, only the zero flux is possible. This argument can be repeated for other proper subsets $\\{1, 4\\}$ and $\\{4, 5\\}$. Thus, $supp(e_2)$ is minimal, and $e_2$ is an EFM.\n\nFor $e_3$ with $supp(e_3) = \\{1, 2, 6\\}$:\nLet's test the support $\\{1, 2\\}$ by setting $v_6=0$. The second equation $v_2 - v_3 - v_6 = 0$ (with $v_3=0$) becomes $v_2=0$. The first equation $v_1 - v_2 - v_5 = 0$ (with $v_5=0$) gives $v_1=v_2=0$. Trivial flux only. This logic applies to all proper subsets. Thus, $supp(e_3)$ is minimal, and $e_3$ is an EFM.\n\nTo confirm that these are the *only* EFMs, we can solve the system of equations completely. We can express three dependent variables in terms of three free variables. Let's choose $v_4, v_5, v_6$ as free variables. From the equations:\n$v_3 = v_4 - v_5$\n$v_2 = v_3 + v_6 = v_4 - v_5 + v_6$\n$v_1 = v_2 + v_5 = (v_4 - v_5 + v_6) + v_5 = v_4 + v_6$\n\nThe non-negativity constraints $v_i \\ge 0$ impose conditions on the free variables:\n$v_4 \\ge 0, v_5 \\ge 0, v_6 \\ge 0$\n$v_3 \\ge 0 \\implies v_4 - v_5 \\ge 0 \\implies v_4 \\ge v_5$\n$v_2 \\ge 0 \\implies v_4 - v_5 + v_6 \\ge 0$ (This is automatically satisfied if $v_4 \\ge v_5$ and $v_6 \\ge 0$)\n$v_1 \\ge 0 \\implies v_4 + v_6 \\ge 0$ (Automatically satisfied if $v_4 \\ge 0, v_6 \\ge 0$)\n\nThe feasible flux cone is described by vectors $v = (v_4+v_6, v_4-v_5+v_6, v_4-v_5, v_4, v_5, v_6)^T$ with $v_4 \\ge v_5 \\ge 0$ and $v_6 \\ge 0$.\nTo find the extreme rays (the EFMs), we can re-parameterize to eliminate the inequality constraint $v_4 \\ge v_5$. Let $\\gamma = v_4 - v_5 \\ge 0$. Then $v_4 = v_5 + \\gamma$. Let's use $v_5, v_6, \\gamma$ as non-negative parameters.\nLet $v_5 = \\alpha, v_6 = \\beta, \\gamma = \\delta$, with $\\alpha, \\beta, \\delta \\ge 0$.\nThen $v_4 = \\alpha + \\delta$. Substituting these into the expressions for the other variables:\n$v_1 = (\\alpha+\\delta) + \\beta = \\alpha + \\beta + \\delta$\n$v_2 = (\\alpha+\\delta) - \\alpha + \\beta = \\beta + \\delta$\n$v_3 = (\\alpha+\\delta) - \\alpha = \\delta$\n$v_4 = \\alpha + \\delta$\n$v_5 = \\alpha$\n$v_6 = \\beta$\n\nAny flux vector $v$ in the cone can be written as a non-negative linear combination of three vectors:\n$$\nv = \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\\\ v_4 \\\\ v_5 \\\\ v_6 \\end{pmatrix} =\n\\alpha \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 1 \\\\ 1 \\\\ 0 \\end{pmatrix} +\n\\beta \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix} +\n\\delta \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThe three vectors in this decomposition are precisely the vectors $e_2$, $e_3$, and $e_1$ we found by inspection (with $\\delta$ corresponding to $e_1$, $\\alpha$ to $e_2$, and $\\beta$ to $e_3$).\nThese vectors form the set of extreme rays of the flux cone. As we have already verified their minimal support property, they are the complete set of EFMs.\n\nThere are exactly three Elementary Flux Modes.\n1.  EFM 1: $e_1 = (1, 1, 1, 1, 0, 0)^T$\n2.  EFM 2: $e_2 = (1, 0, 0, 1, 1, 0)^T$\n3.  EFM 3: $e_3 = (1, 1, 0, 0, 0, 1)^T$\n\nThe question asks for the total number of EFMs. The total number is $3$.",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "Moving from theory to application, this practice demonstrates how EFM analysis serves as a powerful tool for metabolic engineering. Here, you will go beyond merely enumerating pathways to use them for a specific design objective: identifying Minimal Cut Sets (MCSs) to shut down a target reaction. This exercise  involves implementing an algorithm to compute MCSs, providing a tangible example of how abstract network properties can be leveraged to predict genetic intervention strategies.",
            "id": "4337272",
            "problem": "You are given a set of small, irreversible biochemical reaction networks in steady state and a target reaction index for each network. The task is to compute all elementary flux modes that carry a positive flux through the target reaction and then compute all minimal cut sets that block the target reaction by intersecting every such elementary flux mode. The final answer must be a complete, runnable program.\n\nFoundational base:\n- Steady state implies that the internal metabolite balances satisfy $S v = 0$, where $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix, $m$ is the number of internal metabolites, $n$ is the number of reactions, and $v \\in \\mathbb{R}^{n}$ is the flux vector.\n- Irreversible reactions impose $v \\ge 0$ component-wise.\n- An elementary flux mode (EFM) is defined as a nonzero feasible flux vector $v$ that satisfies $S v = 0$, $v \\ge 0$ for irreversible reactions, where the support $\\mathrm{supp}(v) = \\{ j \\in \\{0,\\dots,n-1\\} \\mid v_j \\ne 0 \\}$ is minimal with respect to set inclusion among all feasible flux vectors. Elementary flux modes are rays of the convex cone defined by $S v = 0$, $v \\ge 0$, and for an irreversible network, every active reaction in an elementary flux mode has strictly positive flux.\n- A minimal cut set (MCS) for a given target reaction is a minimal set of reactions whose removal blocks all feasible flux vectors with strictly positive flux through the target reaction. Equivalently, the MCSs are exactly the minimal hitting sets (also called minimal transversals) of the family of supports of all elementary flux modes that carry strictly positive flux through the target reaction. Here, a set $C$ is a hitting set of a family $\\mathcal{F}$ of sets if $C \\cap F \\ne \\emptyset$ for all $F \\in \\mathcal{F}$, and $C$ is minimal if no proper subset of $C$ is a hitting set.\n\nYour program must:\n1) Enumerate all supports of elementary flux modes that carry strictly positive flux through the given target reaction for each test network, adhering to $S v = 0$ and $v \\ge 0$.\n2) Compute all minimal hitting sets of these supports to obtain all minimal cut sets for blocking the target reaction.\n3) Return, for each test network, the set of minimal cut sets as a list of sorted lists of zero-based reaction indices, sorted lexicographically.\n\nFormalization of the feasibility and minimality checks:\n- For a candidate support $J \\subseteq \\{0,\\dots,n-1\\}$ that contains the target index $t$, feasibility means the existence of a vector $x \\in \\mathbb{R}^{|J|}$ with $x \\ge \\mathbf{1}$ such that $S_{:,J} x = 0$. Because the constraint is homogeneous, the existence of a strictly positive solution with $x > 0$ is equivalent to the existence of one with $x \\ge \\mathbf{1}$ after appropriate scaling. This ensures that every reaction in the candidate support is truly active with strictly positive flux.\n- Support minimality means that no proper subset $K \\subset J$ admits a strictly positive solution to $S_{:,K} x = 0$ with $x > 0$.\n\nInput specification within the program:\n- There are three test networks. For each case, you are provided the stoichiometric matrix $S$ and the zero-based target reaction index $t$. All reactions are irreversible and subject to $v \\ge 0$.\n\nTest suite:\n- Case A (branched pathway to product):\n  - Metabolites: $A, B, C$ ($m = 3$).\n  - Reactions (all irreversible, $n = 6$):\n    - $R_0$: $S_{\\mathrm{ext}} \\to A$: column $[1, 0, 0]^\\top$.\n    - $R_1$: $A \\to B$: column $[-1, 1, 0]^\\top$.\n    - $R_2$: $B \\to C$: column $[0, -1, 1]^\\top$.\n    - $R_3$: $C \\to P_{\\mathrm{ext}}$ (target): column $[0, 0, -1]^\\top$.\n    - $R_4$: $A \\to C$: column $[-1, 0, 1]^\\top$.\n    - $R_5$: $B \\to \\mathrm{waste}$: column $[0, -1, 0]^\\top$.\n  - Target index: $t = 3$.\n\n- Case B (two routes to target via a conversion step):\n  - Metabolites: $A, B, C$ ($m = 3$).\n  - Reactions (all irreversible, $n = 5$):\n    - $R_0$: $S_{\\mathrm{ext}} \\to A$: column $[1, 0, 0]^\\top$.\n    - $R_1$: $A \\to B$: column $[-1, 1, 0]^\\top$.\n    - $R_2$: $A \\to C$: column $[-1, 0, 1]^\\top$.\n    - $R_3$: $B \\to P_{\\mathrm{ext}}$ (target): column $[0, -1, 0]^\\top$.\n    - $R_4$: $C \\to B$: column $[0, 1, -1]^\\top$.\n  - Target index: $t = 3$.\n\n- Case C (infeasible target flux):\n  - Metabolites: $A$ ($m = 1$).\n  - Reactions (all irreversible, $n = 1$):\n    - $R_0$: $A \\to P_{\\mathrm{ext}}$ (target): column $[-1]^\\top$.\n  - Target index: $t = 0$.\n\nOutput specification:\n- For each test case, output the list of minimal cut sets as a list of sorted lists of zero-based reaction indices, with the following ordering conventions:\n  - Inside each minimal cut set, reaction indices must be in strictly increasing order.\n  - The collection of minimal cut sets for a test case must be sorted lexicographically by these lists.\n  - The overall program output must be a single line containing a list of the three per-case results in the given order Case A, Case B, Case C.\n- The final output must be a single line in the exact format of a Python list literal, for example: $[\\,[\\dots],\\,[\\dots],\\,[\\dots]\\,]$.\n\nAnswer types:\n- Each per-case result is a list of lists of integers. The top-level result is a list of length $3$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[resultA,resultB,resultC]\").",
            "solution": "The problem requires the computation of minimal cut sets (MCSs) for a target reaction in several small, irreversible biochemical networks. This task is broken down into two principal stages: first, the enumeration of all elementary flux modes (EFMs) that involve the target reaction, and second, the computation of all minimal hitting sets of the supports of these EFMs. The problem correctly states that these minimal hitting sets are precisely the MCSs.\n\nThe solution will be implemented as a Python program structured into several functions, each addressing a specific part of the problem.\n\n### Part 1: Enumeration of Target-Flux-Carrying Elementary Flux Modes\n\nAn elementary flux mode is defined by the minimality of its support—the set of reactions with non-zero flux. For an irreversible network, all reactions in an EFM have strictly positive flux. A support set $J$ corresponds to an EFM if and only if:\n1.  **Feasibility**: There exists a flux vector $v > 0$ with $\\mathrm{supp}(v) = J$ such that $S v = 0$. As specified, this can be tested by checking for the existence of a solution to the linear system $S_{:,J} x = 0$ with the constraint $x \\ge 1$, which is a standard linear programming feasibility problem. Let $k = |J|$, the system is finding $x \\in \\mathbb{R}^k$ such that $S_{:,J} x = 0$ and $x \\ge 1$. This can be solved using `scipy.optimize.linprog` by setting the objective function to zero.\n2.  **Minimality**: No proper subset of $J$ is also a feasible support.\n\nThe algorithm to find all EFM supports containing a target reaction $t$ is as follows:\n- Generate all possible reaction subsets $J$ that include the target reaction $t$. This is achieved by taking the power set of all other reactions and adding $t$ to each subset.\n- For each candidate support $J$, check for feasibility using `scipy.optimize.linprog`. Collect all feasible supports.\n- From the list of feasible supports, filter for minimality. A feasible support $J$ is minimal if no other feasible support $K$ is a proper subset of $J$. This filtering is performed efficiently by first sorting the feasible supports by size and then, for each candidate, checking if it is a superset of any already confirmed minimal support.\n\n### Part 2: Computation of Minimal Cut Sets (Minimal Hitting Sets)\n\nOnce the set of relevant EFM supports, $\\mathcal{F} = \\{E_1, E_2, \\dots, E_p\\}$, is determined, the next step is to compute their minimal hitting sets (MHSs). A set $C$ is a hitting set of $\\mathcal{F}$ if it has a non-empty intersection with every set in $\\mathcal{F}$ (i.e., $\\forall E_i \\in \\mathcal{F}, C \\cap E_i \\ne \\emptyset$). An MCS is a hitting set that is minimal with respect to set inclusion.\n\nThe computation of MHSs can be performed using an iterative procedure known as the transversal algorithm. The algorithm proceeds as follows:\n- Initialize the collection of MHSs with the MHS of an empty family, which is the set containing only the empty set: $\\mathcal{H}_0 = \\{\\emptyset\\}$.\n- Iteratively process each EFM support $E_i \\in \\mathcal{F}$:\n  - For each existing MHS $H \\in \\mathcal{H}_{i-1}$ and each reaction $r \\in E_i$, form a new candidate hitting set $H' = H \\cup \\{r\\}$.\n  - The new collection of candidates is $\\mathcal{H}'_i = \\{ H \\cup \\{r\\} \\mid H \\in \\mathcal{H}_{i-1}, r \\in E_i \\}$.\n  - The next set of MHSs, $\\mathcal{H}_i$, is obtained by retaining only the minimal sets from $\\mathcal{H}'_i$.\n- After iterating through all EFM supports, the final collection $\\mathcal{H}_p$ is the set of all MCSs.\n\nThis process correctly computes all MCSs. If the set of target-carrying EFMs is empty (as in Case C, where the target flux is infeasible), the family $\\mathcal{F}$ is empty. The minimal hitting set of an empty family is the empty set $\\emptyset$, as the condition for being a hitting set is vacuously satisfied. Therefore, the set of MCSs is $\\{\\emptyset\\}$, which will be represented as `[[]]`.\n\n### Final Output Formatting\n\nThe resulting list of MCSs for each test case is sorted according to the problem's specifications: each individual MCS (a list of reaction indices) is sorted in increasing order, and the list of all MCSs is sorted lexicographically. The results for all test cases are then aggregated into a single list and printed in a dense, single-line format.\n\nThe following Python program implements this complete logic.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\nfrom itertools import combinations\n\ndef _check_feasibility(S, support):\n    \"\"\"\n    Checks if a given support is feasible by solving a linear programming problem.\n    A support J is feasible if there exists a flux vector v > 0 with supp(v) = J.\n    This is equivalent to checking if the system S_J * x = 0 has a solution with x >= 1.\n    \"\"\"\n    if not support:\n        return False\n    \n    S_J = S[:, support]\n    m, k = S_J.shape\n\n    # We are solving a feasibility problem, so the objective function is irrelevant.\n    # min c^T * x, where c is a vector of zeros.\n    c = np.zeros(k)\n\n    # Constraints are S_J * x = 0 and x >= 1.\n    bounds = [(1, None)] * k\n\n    # Solve the linear program. The 'highs' method is robust.\n    # We only care about whether a solution was found (res.success).\n    res = linprog(c, A_eq=S_J, b_eq=np.zeros(m), bounds=bounds, method='highs')\n    \n    return res.success\n\ndef find_target_efms(S, t):\n    \"\"\"\n    Enumerates all elementary flux mode supports that include the target reaction 't'.\n    It first finds all feasible supports containing 't' and then filters for minimality.\n    \"\"\"\n    num_reactions = S.shape[1]\n    other_reactions = [r for r in range(num_reactions) if r != t]\n    \n    feasible_supports = []\n    \n    # Iterate over all subsets of other_reactions to form candidate supports with 't'.\n    for i in range(len(other_reactions) + 1):\n        for combo in combinations(other_reactions, i):\n            support_candidate = sorted(list(combo) + [t])\n            if _check_feasibility(S, support_candidate):\n                feasible_supports.append(support_candidate)\n\n    # Filter for minimal supports to get EFMs.\n    # Sorting by length allows for efficient checking of minimality.\n    feasible_supports.sort(key=len)\n    \n    efm_supports = []\n    for J in feasible_supports:\n        is_minimal = True\n        # A support J is not minimal if it's a superset of an already found EFM.\n        for K in efm_supports:\n            if set(K).issubset(set(J)):\n                is_minimal = False\n                break\n        if is_minimal:\n            efm_supports.append(J)\n            \n    return efm_supports\n\ndef _minimize_sets(list_of_sets):\n    \"\"\"\n    Given a list of sets (represented as lists), returns a new list\n    containing only the minimal sets with respect to subset inclusion.\n    \"\"\"\n    if not list_of_sets:\n        return []\n\n    # Use frozensets for hashing and efficient storage.\n    set_versions = {frozenset(s) for s in list_of_sets}\n    \n    # Sort by size for efficient subset checking.\n    sorted_sets = sorted(list(set_versions), key=len)\n    \n    minimal_sets = []\n    for s_i in sorted_sets:\n        is_minimal = True\n        for m_j in minimal_sets:\n            if m_j.issubset(s_i):\n                is_minimal = False\n                break\n        if is_minimal:\n            minimal_sets.append(s_i)\n            \n    # Convert back to sorted lists of integers.\n    return [sorted(list(s)) for s in minimal_sets]\n\ndef compute_minimal_hitting_sets(family_of_sets):\n    \"\"\"\n    Computes all minimal hitting sets (transversals) for a family of sets\n    using an iterative transversal algorithm.\n    \"\"\"\n    # The minimal hitting set of an empty family is {emptyset}.\n    mhs = [[]]\n    \n    for s in family_of_sets:\n        new_mhs = []\n        for h in mhs:\n            for element in s:\n                # Form a new candidate hitting set by adding an element from the current set 's'.\n                new_h = h + [element]\n                new_mhs.append(new_h)\n        # Prune the generated candidates to keep only minimal ones for the next iteration.\n        mhs = _minimize_sets(new_mhs)\n        \n    return mhs\n\ndef compute_overall_mcs_for_case(S, t):\n    \"\"\"\n    Orchestrates the computation of MCS for a single network case.\n    1. Finds target-carrying EFMs.\n    2. Computes the minimal hitting sets of their supports.\n    3. Sorts the result as specified.\n    \"\"\"\n    # 1. Enumerate supports of elementary flux modes that use the target reaction.\n    efm_supports = find_target_efms(S, t)\n\n    # 2. Compute minimal hitting sets, which are the minimal cut sets.\n    mcs_list = compute_minimal_hitting_sets(efm_supports)\n    \n    # 3. Sort the final list of MCSs lexicographically.\n    mcs_list.sort()\n    \n    return mcs_list\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run the computation, and print the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    \n    # Case A: Branched pathway to product\n    S_A = np.array([\n        [1., -1., 0., 0., -1., 0.],\n        [0., 1., -1., 0., 0., -1.],\n        [0., 0., 1., -1., 1., 0.]\n    ])\n    t_A = 3\n\n    # Case B: Two routes to target via a conversion step\n    S_B = np.array([\n        [1., -1., -1., 0., 0.],\n        [0., 1., 0., -1., 1.],\n        [0., 0., 1., 0., -1.]\n    ])\n    t_B = 3\n\n    # Case C: Infeasible target flux\n    S_C = np.array([[-1.]])\n    t_C = 0\n\n    test_cases = [ (S_A, t_A), (S_B, t_B), (S_C, t_C) ]\n\n    results = []\n    for S, t in test_cases:\n        result = compute_overall_mcs_for_case(S, t)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The string representation is modified to remove spaces for a compact output.\n    output_str = str(results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "A stoichiometrically valid pathway is not always a biophysically viable one. This final practice introduces an essential layer of realism by integrating thermodynamic constraints into EFM analysis. You will learn to formulate and solve a feasibility problem that checks whether an EFM can operate given realistic ranges of metabolite concentrations and standard Gibbs energies. This exercise  bridges the gap between purely structural network analysis and a more complete understanding of metabolic function under physiological conditions.",
            "id": "4337268",
            "problem": "You are given a set of Elementary Flux Modes (EFMs) for a small biochemical network and thermodynamic parameter ranges. Starting from fundamental thermodynamics, you must derive a mixed-integer linear feasibility formulation that filters EFMs by thermodynamic feasibility and implement it as a runnable program that outputs, for each EFM under each parameter set, whether there exists a set of metabolite chemical potentials within the given bounds that renders all active internal reactions thermodynamically consistent with their flux directions.\n\nFundamental base and assumptions:\n- The stoichiometric matrix is $S \\in \\mathbb{R}^{m \\times n}$, with $m$ internal metabolites and $n$ reactions. The reaction Gibbs energy change for reaction $j$ is defined by $$\\Delta_r G_j = \\sum_{i=1}^{m} S_{i,j} \\, \\mu_i = \\left(S^\\top \\mu\\right)_j,$$ where $\\mu_i$ is the chemical potential of metabolite $i$.\n- The chemical potential of metabolite $i$ is given by $$\\mu_i = \\mu_i^\\circ + R T \\ln c_i,$$ where $\\mu_i^\\circ$ is the standard chemical potential, $R$ is the molar gas constant, $T$ is the absolute temperature, and $c_i$ is the concentration of metabolite $i$. Given bounds on $c_i$, i.e., $c_i \\in [c_i^{\\min}, c_i^{\\max}]$, this implies bounds on $\\mu_i$: $$\\mu_i^{\\min} = \\mu_i^\\circ + R T \\ln c_i^{\\min}, \\quad \\mu_i^{\\max} = \\mu_i^\\circ + R T \\ln c_i^{\\max}.$$\n- For thermodynamic consistency, an active reaction flowing in the forward direction must satisfy $$\\Delta_r G_j \\le -\\varepsilon,$$ and an active reaction flowing in the reverse direction must satisfy $$\\Delta_r G_j \\ge \\varepsilon,$$ where $\\varepsilon > 0$ is a small strict inequality tolerance.\n\nMixed-Integer Linear Programming (MILP) formulation description:\n- Introduce a binary variable $y_j \\in \\{0,1\\}$ for each reversible reaction $j$ to indicate direction: $y_j = 1$ if reaction $j$ flows forward and $y_j = 0$ if reaction $j$ flows backward. Use a big-$M$ formulation to encode direction-dependent linear inequalities:\n  $$\\Delta_r G_j \\le -\\varepsilon + M\\,(1 - y_j), \\quad \\Delta_r G_j \\ge \\varepsilon - M\\,y_j,$$\n  with $M$ a sufficiently large positive constant.\n- For an EFM with known reaction directions, set $y_j$ to the direction indicated by the EFM (fixing $y_j$), which reduces the MILP to a linear feasibility problem in $\\mu$ with bound constraints.\n\nNetwork specification:\n- Internal metabolites: $A$, $B$, $C$ (so $m = 3$).\n- Reactions ($n = 6$), with stoichiometry given for internal metabolites only (exchanges include external pools not represented in $S$):\n  1. $R_0$: $\\text{ext} \\to A$, with $S_{\\cdot,0} = [1,\\,0,\\,0]^\\top$ (exchange; do not constrain $\\Delta_r G_0$).\n  2. $R_1$: $A \\to B$, with $S_{\\cdot,1} = [-1,\\,1,\\,0]^\\top$ (internal; constrain thermodynamics).\n  3. $R_2$: $B \\to C$, with $S_{\\cdot,2} = [0,\\,-1,\\,1]^\\top$ (internal; constrain thermodynamics).\n  4. $R_3$: $C \\to A$, with $S_{\\cdot,3} = [1,\\,0,\\,-1]^\\top$ (internal; constrain thermodynamics).\n  5. $R_4$: $A \\to \\text{ext}$, with $S_{\\cdot,4} = [-1,\\,0,\\,0]^\\top$ (exchange; do not constrain thermodynamics).\n  6. $R_5$: $C \\to \\text{ext}$, with $S_{\\cdot,5} = [0,\\,0,\\,-1]^\\top$ (exchange; do not constrain thermodynamics).\n\nEFM list (flux directions for $(R_0,R_1,R_2,R_3,R_4,R_5)$, using $+1$ for forward, $-1$ for reverse, $0$ for inactive; assume exchanges are unconstrained thermodynamically):\n- $\\text{EFM}_1$: $[+1,\\,+1,\\,+1,\\,0,\\,0,\\,+1]$.\n- $\\text{EFM}_2$: $[0,\\,+1,\\,+1,\\,+1,\\,0,\\,0]$.\n- $\\text{EFM}_3$: $[+1,\\,0,\\,0,\\,0,\\,+1,\\,0]$.\n- $\\text{EFM}_4$: $[+1,\\,+1,\\,+1,\\,+1,\\,+1,\\,0]$.\n- $\\text{EFM}_5$: $[+1,\\,+1,\\,+1,\\,0,\\,+1,\\,+1]$.\n- $\\text{EFM}_6$: $[+1,\\,-1,\\,+1,\\,0,\\,0,\\,+1]$.\n\nConstants and units:\n- Use $R = 0.008314$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$.\n- Use $T = 310$ in $\\mathrm{K}$.\n- Use $\\varepsilon = 10^{-6}$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n- Concentrations $c_i$ are in $\\mathrm{M}$ (moles per liter).\n- All energies must be in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n\nTest suite (three parameter sets):\n1. Case $1$ (happy path): $\\mu^\\circ = [ -10,\\,-20,\\,-30 ]$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$; concentration ranges $[c^{\\min},c^{\\max}]$ for each of $A$, $B$, $C$ are $[10^{-6},\\,10^{-3}]$ in $\\mathrm{M}$.\n2. Case $2$ (boundary case with zero driving): $\\mu^\\circ = [ -20,\\,-20,\\,-20 ]$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$; concentration ranges are all $[10^{-4},\\,10^{-4}]$ in $\\mathrm{M}$ (fixed).\n3. Case $3$ (skewed ranges that invert one step): $\\mu^\\circ = [ -20,\\,-20,\\,-20 ]$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$; concentration ranges: $A$ in $[10^{-9},\\,10^{-8}]$ $\\mathrm{M}$, $B$ in $[10^{-2},\\,10^{-1}]$ $\\mathrm{M}$, $C$ in $[10^{-2},\\,10^{-1}]$ $\\mathrm{M}$.\n\nTask:\n- For each test case, compute $\\mu_i^{\\min}$ and $\\mu_i^{\\max}$ from the provided $\\mu_i^\\circ$, $R$, $T$, and $[c_i^{\\min},c_i^{\\max}]$.\n- For each EFM and test case, construct the linear feasibility problem over $\\mu \\in \\mathbb{R}^3$:\n  - Bounds: $\\mu_i^{\\min} \\le \\mu_i \\le \\mu_i^{\\max}$ for $i \\in \\{A,B,C\\}$.\n  - For each active internal reaction $j \\in \\{1,2,3\\}$:\n    - If the EFM direction is forward, enforce $\\sum_i S_{i,j} \\mu_i \\le -\\varepsilon$.\n    - If the EFM direction is reverse, enforce $\\sum_i S_{i,j} \\mu_i \\ge \\varepsilon$.\n  - Exchange reactions $j \\in \\{0,4,5\\}$ impose no thermodynamic constraint.\n- Determine feasibility (boolean) for each EFM under each case.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The result for each case must be a list of booleans for $\\text{EFM}_1$ through $\\text{EFM}_6$ in order. Thus the overall output is a list of three lists: $$[\\,[b_{1,1},\\,b_{1,2},\\,b_{1,3},\\,b_{1,4},\\,b_{1,5},\\,b_{1,6}],\\,[b_{2,1},\\,\\dots,\\,b_{2,6}],\\,[b_{3,1},\\,\\dots,\\,b_{3,6}]\\,],$$ where $b_{k,\\ell}$ is a boolean value indicating feasibility. Print booleans as Python literals (`True` or `False`) in the nested list.",
            "solution": "The problem requires determining the thermodynamic feasibility of several Elementary Flux Modes (EFMs) for a given metabolic network under different parametric conditions. This task translates to solving a series of linear feasibility problems. For each EFM and each parameter set (test case), we must ascertain if there exists a vector of metabolite chemical potentials, $\\mu$, that simultaneously satisfies all imposed thermodynamic and concentration-based constraints.\n\n### 1. Theoretical Formulation\n\nThe problem is defined by two sets of linear constraints on the chemical potentials $\\mu = [\\mu_A, \\mu_B, \\mu_C]^\\top$ of the internal metabolites $A$, $B$, and $C$.\n\n#### 1.1. Bounds on Chemical Potentials\nThe chemical potential $\\mu_i$ of a metabolite $i$ is given by the fundamental thermodynamic relation:\n$$ \\mu_i = \\mu_i^\\circ + R T \\ln c_i $$\nwhere $\\mu_i^\\circ$ is the standard chemical potential, $R$ is the molar gas constant, $T$ is the absolute temperature, and $c_i$ is the metabolite concentration. Given a concentration range $c_i \\in [c_i^{\\min}, c_i^{\\max}]$, the chemical potential $\\mu_i$ is correspondingly bounded:\n$$ \\mu_i^{\\min} \\le \\mu_i \\le \\mu_i^{\\max} $$\nwhere $\\mu_i^{\\min} = \\mu_i^\\circ + R T \\ln c_i^{\\min}$ and $\\mu_i^{\\max} = \\mu_i^\\circ + R T \\ln c_i^{\\max}$. These bounds define a hyperrectangle in the space of chemical potentials, which represents the feasible search space for $\\mu$.\n\n#### 1.2. Thermodynamic Driving Force Constraints\nThe second law of thermodynamics dictates that a reaction can only proceed in a direction that results in a decrease in Gibbs free energy. For a reaction $j$, the Gibbs energy change, $\\Delta_r G_j$, is given by:\n$$ \\Delta_r G_j = \\left(S^\\top \\mu\\right)_j = \\sum_{i=1}^{m} S_{i,j} \\mu_i $$\nwhere $S$ is the stoichiometric matrix. An EFM specifies the direction of each active reaction. For the system to be thermodynamically consistent, the following conditions must hold for each active internal reaction $j \\in \\{1, 2, 3\\}$:\n- If reaction $j$ proceeds in the forward direction (flux is positive): $\\Delta_r G_j \\le -\\varepsilon$.\n- If reaction $j$ proceeds in the reverse direction (flux is negative): $\\Delta_r G_j \\ge \\varepsilon$.\n\nHere, $\\varepsilon > 0$ is a small tolerance to ensure a strict negative or positive driving force, preventing operation at thermodynamic equilibrium. These conditions are linear inequalities in the variables $\\mu_i$. A forward reaction constraint $\\left(S^\\top \\mu\\right)_j \\le -\\varepsilon$ is already in the standard form $a^\\top x \\le b$. A reverse reaction constraint $\\left(S^\\top \\mu\\right)_j \\ge \\varepsilon$ can be rewritten as $-\\left(S^\\top \\mu\\right)_j \\le -\\varepsilon$ to fit the same standard form.\n\n### 2. Algorithmic Approach\n\nFor each test case and each EFM, we construct a linear feasibility problem. The variables of this problem are the chemical potentials $\\mu_A, \\mu_B, \\mu_C$. The problem is to find a vector $\\mu$ that satisfies:\n1.  The bound constraints: $\\mu_i^{\\min} \\le \\mu_i \\le \\mu_i^{\\max}$ for $i \\in \\{A, B, C\\}$.\n2.  A system of linear inequalities, $A_{ub} \\mu \\le b_{ub}$, derived from the thermodynamic constraints of the active internal reactions in the EFM.\n\nThis is a canonical linear feasibility problem. We can solve it using a linear programming (LP) solver. By setting the objective function to a constant (e.g., $c^\\top \\mu = 0$), the LP solver's task reduces to finding any point within the feasible region defined by the constraints. If the solver finds such a point, the system is feasible; otherwise, it is infeasible.\n\n### 3. Implementation Plan\n\nThe solution is implemented in Python, utilizing `numpy` for efficient linear algebra and `scipy.optimize.linprog` as the LP solver.\n\n1.  **Constants and Network Definition**: The physical constants ($R$, $T$, $\\varepsilon$), the transposed stoichiometric matrix $S^\\top$, and the list of EFMs are defined.\n2.  **Iterate Test Cases**: The main loop iterates through the three provided test cases. In each iteration, it first calculates the $\\mu_i^{\\min}$ and $\\mu_i^{\\max}$ bounds for each metabolite based on the case-specific standard potentials $\\mu_i^\\circ$ and concentration ranges.\n3.  **Iterate EFMs**: A nested loop iterates through the six EFMs. For each EFM:\n    a.  An empty list of constraints is initialized.\n    b.  The algorithm inspects the flux direction for each internal reaction ($R_1, R_2, R_3$).\n    c.  If a reaction is active, the corresponding inequality ($S_{\\cdot,j}^\\top \\mu \\le -\\varepsilon$ or $-S_{\\cdot,j}^\\top \\mu \\le -\\varepsilon$) is formulated and added to the constraint system (i.e., a row is added to $A_{ub}$ and an element to $b_{ub}$).\n    d.  If no internal reactions are active for an EFM (e.g., $\\text{EFM}_3$), the problem is trivially feasible, as any set of potentials within the non-empty bounds is a valid solution.\n4.  **Solve Feasibility**: The `scipy.optimize.linprog` function is called with a zero objective function, the constructed inequality constraints ($A_{ub}$, $b_{ub}$), and the calculated potential bounds.\n5.  **Store and Output Result**: The `success` attribute of the result object from `linprog` directly provides the boolean feasibility. These booleans are collected into a list for each test case, and the lists of results are aggregated. The final nested list is printed to standard output in the specified format.\n\nA preliminary analysis reveals that $\\text{EFM}_2$ and $\\text{EFM}_4$ each contain a futile cycle ($A \\to B \\to C \\to A$), which is structurally infeasible. The sum of their thermodynamic constraints leads to the contradiction $0 \\le -3\\varepsilon$, guaranteeing their infeasibility in all test cases. Conversely, $\\text{EFM}_3$ has no active internal reactions and is thus always thermodynamically feasible. The feasibility of the remaining EFMs is dependent on the specific thermodynamic parameters of each test case.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Validates a set of Elementary Flux Modes (EFMs) for thermodynamic feasibility\n    by solving a series of linear feasibility problems.\n    \"\"\"\n    # Define constants and units\n    R = 0.008314  # kJ mol^-1 K^-1\n    T = 310.0      # K\n    epsilon = 1e-6 # kJ mol^-1\n\n    # Transposed stoichiometric matrix S_T for internal metabolites A, B, C\n    # Rows correspond to reactions R0-R5, columns to metabolites A, B, C\n    S_T = np.array([\n        [1.0, 0.0, 0.0],   # R0: ext -> A\n        [-1.0, 1.0, 0.0],  # R1: A -> B\n        [0.0, -1.0, 1.0],  # R2: B -> C\n        [1.0, 0.0, -1.0],  # R3: C -> A\n        [-1.0, 0.0, 0.0],  # R4: A -> ext\n        [0.0, 0.0, -1.0],  # R5: C -> ext\n    ])\n    \n    # Internal reactions are R1, R2, R3 (indices 1, 2, 3)\n    INTERNAL_REACTION_INDICES = [1, 2, 3]\n\n    # Elementary Flux Modes (EFMs)\n    efms = [\n        # Directions for (R0, R1, R2, R3, R4, R5)\n        [+1, +1, +1, 0, 0, +1],  # EFM1\n        [0, +1, +1, +1, 0, 0],   # EFM2\n        [+1, 0, 0, 0, +1, 0],    # EFM3\n        [+1, +1, +1, +1, +1, 0], # EFM4\n        [+1, +1, +1, 0, +1, +1], # EFM5\n        [+1, -1, +1, 0, 0, +1],  # EFM6\n    ]\n\n    test_cases = [\n        {\n            \"mu_standard\": np.array([-10.0, -20.0, -30.0]),\n            \"c_ranges\": np.array([[1e-6, 1e-3], [1e-6, 1e-3], [1e-6, 1e-3]]) # A, B, C\n        },\n        {\n            \"mu_standard\": np.array([-20.0, -20.0, -20.0]),\n            \"c_ranges\": np.array([[1e-4, 1e-4], [1e-4, 1e-4], [1e-4, 1e-4]]) # A, B, C\n        },\n        {\n            \"mu_standard\": np.array([-20.0, -20.0, -20.0]),\n            \"c_ranges\": np.array([[1e-9, 1e-8],   # A\n                                  [1e-2, 1e-1],   # B\n                                  [1e-2, 1e-1]])  # C\n        }\n    ]\n\n    RT = R * T\n    final_results = []\n\n    for case in test_cases:\n        mu_standard = case[\"mu_standard\"]\n        c_ranges = case[\"c_ranges\"]\n        \n        # Calculate chemical potential bounds for mu = [mu_A, mu_B, mu_C]\n        mu_min = mu_standard + RT * np.log(c_ranges[:, 0])\n        mu_max = mu_standard + RT * np.log(c_ranges[:, 1])\n        mu_bounds = list(zip(mu_min, mu_max))\n        \n        case_results = []\n        for efm in efms:\n            # Construct the linear inequality system A_ub * mu <= b_ub\n            A_ub_list = []\n            b_ub_list = []\n\n            for j in INTERNAL_REACTION_INDICES:\n                flux_dir = efm[j]\n                \n                if flux_dir == 1:  # Forward reaction: S_T[j] * mu <= -epsilon\n                    A_ub_list.append(S_T[j])\n                    b_ub_list.append(-epsilon)\n                elif flux_dir == -1:  # Reverse reaction: S_T[j] * mu >= epsilon  (or -S_T[j] * mu <= -epsilon)\n                    A_ub_list.append(-S_T[j])\n                    b_ub_list.append(-epsilon)\n            \n            # If there are no active internal reactions, the problem is trivially feasible\n            if not A_ub_list:\n                case_results.append(True)\n                continue\n\n            A_ub = np.array(A_ub_list)\n            b_ub = np.array(b_ub_list)\n\n            # Solve the linear feasibility problem\n            # Objective function is zero as we only care about feasibility\n            c = np.zeros(S_T.shape[1])\n            \n            # Use 'highs' for robustness. It is the default in newer SciPy versions.\n            res = linprog(c=c, A_ub=A_ub, b_ub=b_ub, bounds=mu_bounds, method='highs')\n            \n            # The 'success' flag indicates if a feasible solution was found\n            case_results.append(res.success)\n            \n        final_results.append(case_results)\n\n    # Print the final result in the requested format\n    print(final_results)\n\nsolve()\n```"
        }
    ]
}