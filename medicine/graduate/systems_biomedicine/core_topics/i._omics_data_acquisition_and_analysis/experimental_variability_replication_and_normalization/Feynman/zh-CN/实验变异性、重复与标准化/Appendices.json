{
    "hands_on_practices": [
        {
            "introduction": "在应用任何复杂的归一化算法之前，首要任务是深入理解重复测量之间变异的来源和性质。本练习将引导你使用经典的Bland-Altman分析方法，这是一种评估两次测量一致性的标准技术。通过计算均值差异和一致性界限，并检验差异与均值之间的关系，你可以判断实验误差是固定的（加性误差）还是随测量值的增大而变化的（比例误差），这是验证分析方法性能和选择合适归一化策略的关键一步。",
            "id": "4339892",
            "problem": "在相同的分析前和分析条件下，使用基于多重微珠免疫分析的方法，对8个血浆样本进行了一项细胞因子定量检测，每个样本重复检测两次。为了消除系统性板效应，使用内标对测量值进行了事后归一化。设样本 $i$ 的两次技术重复测量值分别为 $y_{i1}$ 和 $y_{i2}$，单位均为纳克/毫升 (ng/mL)。配对数据如下：\n- 样本 $1$：$(y_{11}, y_{12}) = (50, 50)$\n- 样本 $2$：$(y_{21}, y_{22}) = (99, 101)$\n- 样本 $3$：$(y_{31}, y_{32}) = (148, 152)$\n- 样本 $4$：$(y_{41}, y_{42}) = (198.5, 201.5)$\n- 样本 $5$：$(y_{51}, y_{52}) = (247.5, 252.5)$\n- 样本 $6$：$(y_{61}, y_{62}) = (296.5, 303.5)$\n- 样本 $7$：$(y_{71}, y_{72}) = (347, 353)$\n- 样本 $8$：$(y_{81}, y_{82}) = (396, 404)$\n\n对于每个样本 $i$，定义对内均值 $m_i = (y_{i1}+y_{i2})/2$ 和差值 $d_i = y_{i2} - y_{i1}$。假设差值集合 $\\{d_i\\}$ 在原始尺度上近似服从均值为 $\\bar{d}$、标准差为 $s_d$ 的正态分布，并且任何比例偏倚都表现为 $d_i$ 对 $m_i$ 的线性依赖关系。\n\n任务：\n- 计算均值差 $\\bar{d}$ 和差值尺度上的Bland–Altman一致性界限。该界限由 $\\{d_i\\}$ 的经验均值和标准差定义，在正态近似下达到95%的覆盖范围。将界限以纳克/毫升 (ng/mL) 为单位表示。\n- 通过拟合带截距项的线性回归模型 $d_i = \\alpha + \\beta m_i + \\varepsilon_i$ 来检验比例偏倚，其中 $\\varepsilon_i$ 是方差恒定的独立残差。报告估计斜率 $\\hat{\\beta}$，并使用自由度为 $n-2$ 的经典$t$统计量来判断在显著性水平 $\\alpha = 0.05$ 下是否存在比例偏倚。\n- 如果存在比例偏倚且与乘性误差一致，建议采用形式为 $$ y^{(\\lambda)} = \\begin{cases} \\frac{y^{\\lambda}-1}{\\lambda},  \\lambda \\neq 0 \\\\ \\ln(y),  \\lambda=0 \\end{cases} $$ 的稳定方差的Box–Cox变换，并报告在此假设下能够消除比例缩放效应的推荐指数 $\\lambda$。\n\n将最终答案以单个行向量的形式提供，其中按顺序包含以下量：$\\bar{d}$、一致性界限下限、一致性界限上限、$\\hat{\\beta}$ 和推荐的 $\\lambda$。使用精确的解析表达式，不要进行四舍五入，并且在最终的行向量中不要包含单位。为报告目的，一致性界限的单位是纳克/毫升 (ng/mL)。",
            "solution": "用户希望解决一个涉及方法比较分析的生物统计学问题。\n\n### 第一步：提取已知条件\n-   样本数量， $n=8$。\n-   测量值为重复两次，$(y_{i1}, y_{i2})$，其中 $i=1, \\dots, 8$。\n-   样本 1：$(y_{11}, y_{12}) = (50, 50)$\n-   样本 2：$(y_{21}, y_{22}) = (99, 101)$\n-   样本 3：$(y_{31}, y_{32}) = (148, 152)$\n-   样本 4：$(y_{41}, y_{42}) = (198.5, 201.5)$\n-   样本 5：$(y_{51}, y_{52}) = (247.5, 252.5)$\n-   样本 6：$(y_{61}, y_{62}) = (296.5, 303.5)$\n-   样本 7：$(y_{71}, y_{72}) = (347, 353)$\n-   样本 8：$(y_{81}, y_{82}) = (396, 404)$\n-   对内均值的定义：$m_i = (y_{i1}+y_{i2})/2$。\n-   对内差值的定义：$d_i = y_{i2} - y_{i1}$。\n-   假设：差值集合 $\\{d_i\\}$ 近似服从正态分布。\n-   假设：比例偏倚通过线性回归 $d_i = \\alpha + \\beta m_i + \\varepsilon_i$ 进行建模。\n-   任务1：计算均值差 $\\bar{d}$ 和95% Bland–Altman一致性界限。\n-   任务2：拟合线性回归以检验比例偏倚，报告估计斜率 $\\hat{\\beta}$，并在显著性水平 $\\alpha_{sig} = 0.05$ 下对 $\\beta=0$ 进行假设检验。\n-   任务3：如果发现比例偏倚，推荐一个Box–Cox变换指数 $\\lambda$。\n\n### 第二步：使用提取的已知条件进行验证\n-   **科学上合理**：该问题使用了标准的、成熟的生物统计学方法（Bland-Altman分析、用于比例偏倚的线性回归、Box-Cox变换），这些方法是评估系统生物医学中检测性能、重复性和变异性的基础。其背景和数据对于细胞因子免疫分析是现实的。\n-   **定义明确**：数据完整，变量定义清晰，任务是具体的计算练习。对于每个要求解的量，都存在唯一且有意义的解。\n-   **客观性**：问题以精确、定量的术语陈述，不含主观性或非科学性主张。\n\n该问题没有任何缺陷。它在科学上是合理的、定义明确的、客观的、完整的且相关的。\n\n### 第三步：结论和行动\n该问题有效。将提供完整的解答。\n\n### 解\n\n首先，我们为 $n=8$ 个样本中的每一个计算对内均值 $m_i$ 和差值 $d_i$。\n-   $i=1$：$m_1 = (50+50)/2 = 50$, $d_1 = 50-50 = 0$\n-   $i=2$：$m_2 = (99+101)/2 = 100$, $d_2 = 101-99 = 2$\n-   $i=3$：$m_3 = (148+152)/2 = 150$, $d_3 = 152-148 = 4$\n-   $i=4$：$m_4 = (198.5+201.5)/2 = 200$, $d_4 = 201.5-198.5 = 3$\n-   $i=5$：$m_5 = (247.5+252.5)/2 = 250$, $d_5 = 252.5-247.5 = 5$\n-   $i=6$：$m_6 = (296.5+303.5)/2 = 300$, $d_6 = 303.5-296.5 = 7$\n-   $i=7$：$m_7 = (347+353)/2 = 350$, $d_7 = 353-347 = 6$\n-   $i=8$：$m_8 = (396+404)/2 = 400$, $d_8 = 404-396 = 8$\n\n均值集合为 $\\{m_i\\} = \\{50, 100, 150, 200, 250, 300, 350, 400\\}$。\n差值集合为 $\\{d_i\\} = \\{0, 2, 4, 3, 5, 7, 6, 8\\}$。\n\n**任务1：Bland–Altman一致性界限**\n\n我们计算均值差 $\\bar{d}$ 和差值的标准差 $s_d$。\n$$ \\bar{d} = \\frac{1}{n} \\sum_{i=1}^{n} d_i = \\frac{0+2+4+3+5+7+6+8}{8} = \\frac{35}{8} $$\n对于样本方差 $s_d^2$：\n$$ \\sum_{i=1}^{n} d_i^2 = 0^2 + 2^2 + 4^2 + 3^2 + 5^2 + 7^2 + 6^2 + 8^2 = 0+4+16+9+25+49+36+64 = 203 $$\n$$ s_d^2 = \\frac{1}{n-1} \\left( \\sum_{i=1}^{n} d_i^2 - n \\bar{d}^2 \\right) = \\frac{1}{7} \\left( 203 - 8 \\left(\\frac{35}{8}\\right)^2 \\right) = \\frac{1}{7} \\left( 203 - \\frac{1225}{8} \\right) = \\frac{1}{7} \\left( \\frac{1624 - 1225}{8} \\right) = \\frac{399}{56} = \\frac{57}{8} $$\n标准差为：\n$$ s_d = \\sqrt{\\frac{57}{8}} = \\frac{\\sqrt{57}}{2\\sqrt{2}} = \\frac{\\sqrt{114}}{4} $$\n95%一致性界限 (LoA) 定义为 $\\bar{d} \\pm z_{0.975} s_d$。对于正态近似，95%覆盖范围的z分数为 $z_{0.975} \\approx 1.96$。我们使用精确的分数形式 $1.96 = \\frac{196}{100} = \\frac{49}{25}$。\n界限为：\n$$ \\text{LoA} = \\bar{d} \\pm \\frac{49}{25} s_d = \\frac{35}{8} \\pm \\frac{49}{25} \\frac{\\sqrt{114}}{4} = \\frac{35}{8} \\pm \\frac{49\\sqrt{114}}{100} $$\n一致性界限下限：$\\frac{35}{8} - \\frac{49\\sqrt{114}}{100}$\n一致性界限上限：$\\frac{35}{8} + \\frac{49\\sqrt{114}}{100}$\n\n**任务2：检验比例偏倚**\n\n我们拟合线性模型 $d_i = \\alpha + \\beta m_i + \\varepsilon_i$。斜率 $\\beta$ 的估计值为 $\\hat{\\beta} = \\frac{S_{md}}{S_{mm}}$。\n首先，我们计算 $m_i$ 值的均值：\n$$ \\bar{m} = \\frac{1}{n} \\sum_{i=1}^{n} m_i = \\frac{50+100+150+200+250+300+350+400}{8} = \\frac{1800}{8} = 225 $$\n接下来，我们计算平方和 $S_{mm}$ 和交叉乘积和 $S_{md}$：\n$$ S_{mm} = \\sum_{i=1}^{n} (m_i - \\bar{m})^2 = \\sum_{i=1}^{n} m_i^2 - n \\bar{m}^2 $$\n$$ \\sum_{i=1}^{n} m_i^2 = 50^2 + 100^2 + \\dots + 400^2 = 510000 $$\n$$ S_{mm} = 510000 - 8(225)^2 = 510000 - 8(50625) = 510000 - 405000 = 105000 $$\n$$ S_{md} = \\sum_{i=1}^{n} (m_i - \\bar{m})(d_i - \\bar{d}) = \\sum_{i=1}^{n} m_i d_i - n \\bar{m} \\bar{d} $$\n$$ \\sum_{i=1}^{n} m_i d_i = 50(0) + 100(2) + 150(4) + 200(3) + 250(5) + 300(7) + 350(6) + 400(8) = 0 + 200 + 600 + 600 + 1250 + 2100 + 2100 + 3200 = 10050 $$\n$$ S_{md} = 10050 - 8(225)\\left(\\frac{35}{8}\\right) = 10050 - 225(35) = 10050 - 7875 = 2175 $$\n估计的斜率为：\n$$ \\hat{\\beta} = \\frac{S_{md}}{S_{mm}} = \\frac{2175}{105000} = \\frac{435}{21000} = \\frac{87}{4200} = \\frac{29}{1400} $$\n为了检验假设 $H_0: \\beta=0$，我们计算 $t$ 统计量 $t = \\frac{\\hat{\\beta}}{SE(\\hat{\\beta})}$，它服从自由度为 $n-2=6$ 的 $t$ 分布。斜率的标准误需要误差平方和 $SSE$。\n$$ S_{dd} = \\sum_{i=1}^{n} (d_i - \\bar{d})^2 = (n-1)s_d^2 = 7 \\left(\\frac{57}{8}\\right) = \\frac{399}{8} $$\n$$ SSE = S_{dd} - \\frac{S_{md}^2}{S_{mm}} = \\frac{399}{8} - \\frac{2175^2}{105000} = \\frac{399}{8} - \\frac{4730625}{105000} = \\frac{399}{8} - \\frac{2523}{56} = \\frac{2793 - 2523}{56} = \\frac{270}{56} = \\frac{135}{28} $$\n残差的方差为 $s_e^2 = \\frac{SSE}{n-2} = \\frac{135/28}{6} = \\frac{135}{168} = \\frac{45}{56}$。\n斜率的标准误为 $SE(\\hat{\\beta}) = \\sqrt{\\frac{s_e^2}{S_{mm}}} = \\sqrt{\\frac{45/56}{105000}}$。\n$t$统计量为：\n$$ t = \\frac{\\hat{\\beta}}{SE(\\hat{\\beta})} = \\frac{29/1400}{\\sqrt{\\frac{45/56}{105000}}} = \\frac{S_{md}/\\sqrt{S_{mm}}}{\\sqrt{SSE/(n-2)}} = \\frac{S_{md}\\sqrt{n-2}}{\\sqrt{S_{mm}S_{dd} - S_{md}^2}} $$\n$$ t = \\frac{2175 \\sqrt{6}}{\\sqrt{105000 \\left(\\frac{399}{8}\\right) - 2175^2}} = \\frac{2175 \\sqrt{6}}{\\sqrt{5236875 - 4730625}} = \\frac{2175 \\sqrt{6}}{\\sqrt{506250}} = \\frac{2175 \\sqrt{6}}{\\sqrt{225^2 \\times 10}} = \\frac{2175 \\sqrt{6}}{225 \\sqrt{10}} $$\n$$ t = \\frac{29 \\times 75 \\sqrt{6}}{3 \\times 75 \\sqrt{10}} = \\frac{29\\sqrt{6}}{3\\sqrt{10}} = \\frac{29\\sqrt{60}}{30} = \\frac{29 \\times 2\\sqrt{15}}{30} = \\frac{29\\sqrt{15}}{15} $$\n数值上， $|t| \\approx \\frac{29 \\times 3.873}{15} \\approx 7.48$。在显著性水平 $\\alpha_{sig}=0.05$下，对于自由度为 $n-2=6$ 的双尾检验，来自 $t$ 分布的临界值为 $t_{0.975, 6} = 2.447$。因为 $|t| \\approx 7.48  2.447$，我们拒绝原假设 $H_0: \\beta=0$。存在具有统计显著性的比例偏倚证据。\n\n**任务3：Box–Cox变换**\n\n存在显著的比例偏倚，即测量值之间的差值 ($d_i$) 与其均值大小 ($m_i$)呈线性相关，这是乘性误差而非加性误差的特征。乘性误差模型通常采用 $y_{ij} = \\mu_i (1+\\epsilon_{ij})$ 或 $y_{ij} = \\mu_i \\exp(\\eta_{ij})$ 的形式，其中误差项按真值 $\\mu_i$ 进行缩放。在这种情况下，测量值的标准差与均值成正比，这种情况称为异方差性。\n\n稳定方差变换的目的是找到一个函数 $f(y)$，使得 $f(y)$ 的方差近似恒定。对于一个测量值的标准差与均值成正比（即变异系数恒定）的测量系统，合适的稳定方差变换是对数变换。\n让我们在Box–Cox变换族 $y^{(\\lambda)} = \\frac{y^{\\lambda}-1}{\\lambda}$ 的背景下确认这一点。对数变换对应于 $\\lambda \\to 0$ 的极限情况。\n问题陈述假设比例偏倚与乘性误差一致。这意味着误差的标准差与均值成正比，即 $\\sigma_y \\propto \\mu_y$。这个特定的关系 $\\sigma_y \\propto \\mu_y^1$ 指向方差模型 $\\text{Var}(y) \\propto \\mu^{2\\theta}$ 中的幂 $\\theta=1$。稳定该方差的Box-Cox参数是 $\\lambda = 1-\\theta = 1-1 = 0$。\n因此，推荐的变换是自然对数，它对应于指数 $\\lambda=0$。\n\n最终需要报告的量是 $\\bar{d}$、一致性界限下限、一致性界限上限、$\\hat{\\beta}$ 和 $\\lambda$。\n1.  $\\bar{d} = \\frac{35}{8}$\n2.  一致性界限下限 = $\\frac{35}{8} - \\frac{49\\sqrt{114}}{100}$\n3.  一致性界限上限 = $\\frac{35}{8} + \\frac{49\\sqrt{114}}{100}$\n4.  $\\hat{\\beta} = \\frac{29}{1400}$\n5.  $\\lambda = 0$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{35}{8}  \\frac{35}{8} - \\frac{49\\sqrt{114}}{100}  \\frac{35}{8} + \\frac{49\\sqrt{114}}{100}  \\frac{29}{1400}  0 \\end{pmatrix} } $$"
        },
        {
            "introduction": "当样本间的技术性变异导致其数据分布不一致时，我们需要一种强大的工具来校正这些差异。分位数归一化（Quantile Normalization）就是这样一种广泛应用的非参数方法，它能强制使所有样本具有完全相同的经验分布。本练习将带你逐步完成分位数归一化的计算过程，通过对数据进行排序、计算秩均值并重新赋值，你将亲身体验该算法如何消除样本间的分布差异，从而更清晰地揭示真实的生物学信号。",
            "id": "4339948",
            "problem": "在一项高通量基因表达分析中，对四个基因进行了三个生物学重复的分析，得到了一个 $4\\times 3$ 的原始强度矩阵。重复样本间的实验变异源于生物学和技术因素的混合。在系统生物医学中，一种用于协调各重复样本边缘强度分布的标准方法是分位数归一化，该方法对每个样本的经验累积分布函数（Empirical Cumulative Distribution Function, ECDF）进行操作。考虑原始强度矩阵\n$$\nX \\;=\\;\n\\begin{pmatrix}\n10  16  22 \\\\\n3  8  26 \\\\\n20  23  13 \\\\\n6  12  21\n\\end{pmatrix},\n$$\n其中行代表基因（$i\\in\\{1,2,3,4\\}$），列代表重复样本（$j\\in\\{1,2,3\\}$）。分位数归一化过程定义如下：对每个样本 $j$，将其强度值进行排序，得到顺序统计量 $x_{(1)j}\\leq x_{(2)j}\\leq x_{(3)j}\\leq x_{(4)j}$。然后，通过按秩平均值 $q_{r}=\\frac{1}{3}\\sum_{j=1}^{3} x_{(r)j}$（其中 $r\\in\\{1,2,3,4\\}$）来定义一个参考分布。最后，对每个条目 $x_{ij}$，赋予归一化后的值 $y_{ij}=q_{\\mathrm{rank}(x_{ij},j)}$，其中 $\\mathrm{rank}(x_{ij},j)$ 是 $x_{ij}$ 在第 $j$ 列中的秩。这种映射保留了列内的秩，同时强制所有样本列共享由 $\\{q_{r}\\}_{r=1}^{4}$ 给出的相同边缘分布。\n\n任务：\n- 通过计算 $\\{q_{r}\\}_{r=1}^{4}$ 对矩阵 $X$ 应用分位数归一化，并明确展示从每个原始条目 $x_{ij}$ 到其归一化值 $y_{ij}$ 的逐步映射过程。\n- 对每个样本 $j$，使用无偏样本方差公式\n$$\ns_{j}^{2} \\;=\\; \\frac{1}{m-1}\\sum_{i=1}^{m} \\left(x_{ij}-\\bar{x}_{\\cdot j}\\right)^{2},\n$$\n（其中 $m=4$ 且 $\\bar{x}_{\\cdot j}=\\frac{1}{m}\\sum_{i=1}^{m} x_{ij}$）计算归一化前后的样本内方差，并对归一化数据 $y_{ij}$ 进行类似计算。然后计算样本内方差的变化，定义为\n$$\n\\Delta \\;=\\; \\left(\\frac{1}{3}\\sum_{j=1}^{3} s_{j,\\mathrm{after}}^{2}\\right) \\;-\\; \\left(\\frac{1}{3}\\sum_{j=1}^{3} s_{j,\\mathrm{before}}^{2}\\right).\n$$\n\n提供所有中间计算过程。将 $\\Delta$ 的最终答案表示为精确数。无需四舍五入，在此情境下强度值没有物理单位。",
            "solution": "用户在系统生物医学的背景下提供了一个定义明确的计算问题。该问题具有科学依据，因为分位数归一化是一种标准技术。问题提法得当，提供了所有必要的数据和公式，可以导出一个唯一且可验证的解。问题陈述是客观的，不含任何歧义或矛盾。因此，该问题是有效的，并将提供完整的解答。\n\n该问题要求对给定的数据矩阵 $X$ 应用分位数归一化，并随后计算平均样本内方variance的变化。该过程将按定义逐步执行。\n\n原始强度矩阵如下：\n$$\nX \\;=\\;\n\\begin{pmatrix}\n10  16  22 \\\\\n3  8  26 \\\\\n20  23  13 \\\\\n6  12  21\n\\end{pmatrix}\n$$\n共有 $m=4$ 个基因（行）和 $3$ 个重复样本（列）。\n\n### 第 1 部分：分位数归一化\n\n**步骤 1：对每列进行排序。**\n对每个列向量，我们按升序对强度值进行排序。\n\n对于第 $j=1$ 列：$(10, 3, 20, 6) \\rightarrow (3, 6, 10, 20)$\n对于第 $j=2$ 列：$(16, 8, 23, 12) \\rightarrow (8, 12, 16, 23)$\n对于第 $j=3$ 列：$(22, 26, 13, 21) \\rightarrow (13, 21, 22, 26)$\n\n我们可以将其表示为一个顺序统计量矩阵，其中每列 $j$ 包含 $r \\in \\{1, 2, 3, 4\\}$ 的值 $x_{(r)j}$。\n$$\nX_{\\text{sorted}} \\;=\\;\n\\begin{pmatrix}\n3  8  13 \\\\\n6  12  21 \\\\\n10  16  22 \\\\\n20  23  26\n\\end{pmatrix}\n$$\n\n**步骤 2：计算参考分布。**\n参考分位数 $q_r$ 是各重复样本的按秩平均值。\n$$\nq_r = \\frac{1}{3}\\sum_{j=1}^{3} x_{(r)j}\n$$\n对于 $r=1$： $q_1 = \\frac{3+8+13}{3} = \\frac{24}{3} = 8$\n对于 $r=2$： $q_2 = \\frac{6+12+21}{3} = \\frac{39}{3} = 13$\n对于 $r=3$： $q_3 = \\frac{10+16+22}{3} = \\frac{48}{3} = 16$\n对于 $r=4$： $q_4 = \\frac{20+23+26}{3} = \\frac{69}{3} = 23$\n\n参考分布为 $\\{q_1, q_2, q_3, q_4\\} = \\{8, 13, 16, 23\\}$。\n\n**步骤 3：赋予归一化值。**\n我们首先确定每个条目 $x_{ij}$ 在其所在列 $j$ 中的秩。令 $R$ 为秩矩阵。\n对于第 $j=1$ 列：$(10, 3, 20, 6)$ 的秩分别为 $(3, 1, 4, 2)$。\n对于第 $j=2$ 列：$(16, 8, 23, 12)$ 的秩分别为 $(3, 1, 4, 2)$。\n对于第 $j=3$ 列：$(22, 26, 13, 21)$ 的秩分别为 $(3, 4, 1, 2)$。\n$$\nR \\;=\\;\n\\begin{pmatrix}\n3  3  3 \\\\\n1  1  4 \\\\\n4  4  1 \\\\\n2  2  2\n\\end{pmatrix}\n$$\n归一化后的值为 $y_{ij} = q_{\\mathrm{rank}(x_{ij},j)}$。我们使用秩矩阵 $R$ 将参考分位数映射回原始矩阵结构。\n$$\nY \\;=\\;\n\\begin{pmatrix}\nq_{R_{11}}  q_{R_{12}}  q_{R_{13}} \\\\\nq_{R_{21}}  q_{R_{22}}  q_{R_{23}} \\\\\nq_{R_{31}}  q_{R_{32}}  q_{R_{33}} \\\\\nq_{R_{41}}  q_{R_{42}}  q_{R_{43}}\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\nq_3  q_3  q_3 \\\\\nq_1  q_1  q_4 \\\\\nq_4  q_4  q_1 \\\\\nq_2  q_2  q_2\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n16  16  16 \\\\\n8  8  23 \\\\\n23  23  8 \\\\\n13  13  13\n\\end{pmatrix}\n$$\n这就是经过分位数归一化的矩阵 $Y$。\n\n### 第 2 部分：方差计算\n\n对于大小为 $m=4$ 的样本，其无偏样本方差为 $s^2 = \\frac{1}{3}\\sum_{i=1}^{4} (z_i - \\bar{z})^2$。\n\n**归一化前的方差 ($s_{j,\\mathrm{before}}^{2}$):**\n\n对于值为 $(10, 3, 20, 6)$ 的第 $j=1$ 列：\n均值 $\\bar{x}_{\\cdot 1} = \\frac{10+3+20+6}{4} = \\frac{39}{4}$。\n差方和：$\\sum_{i=1}^{4} (x_{i1}-\\bar{x}_{\\cdot 1})^2 = (10 - \\frac{39}{4})^2 + (3 - \\frac{39}{4})^2 + (20 - \\frac{39}{4})^2 + (6 - \\frac{39}{4})^2$\n$= (\\frac{1}{4})^2 + (-\\frac{27}{4})^2 + (\\frac{41}{4})^2 + (-\\frac{15}{4})^2 = \\frac{1+729+1681+225}{16} = \\frac{2636}{16} = \\frac{659}{4}$。\n方差 $s_{1,\\mathrm{before}}^{2} = \\frac{1}{3} \\times \\frac{659}{4} = \\frac{659}{12}$。\n\n对于值为 $(16, 8, 23, 12)$ 的第 $j=2$ 列：\n均值 $\\bar{x}_{\\cdot 2} = \\frac{16+8+23+12}{4} = \\frac{59}{4}$。\n差方和：$\\sum_{i=1}^{4} (x_{i2}-\\bar{x}_{\\cdot 2})^2 = (16 - \\frac{59}{4})^2 + (8 - \\frac{59}{4})^2 + (23 - \\frac{59}{4})^2 + (12 - \\frac{59}{4})^2$\n$= (\\frac{5}{4})^2 + (-\\frac{27}{4})^2 + (\\frac{33}{4})^2 + (-\\frac{11}{4})^2 = \\frac{25+729+1089+121}{16} = \\frac{1964}{16} = \\frac{491}{4}$。\n方差 $s_{2,\\mathrm{before}}^{2} = \\frac{1}{3} \\times \\frac{491}{4} = \\frac{491}{12}$。\n\n对于值为 $(22, 26, 13, 21)$ 的第 $j=3$ 列：\n均值 $\\bar{x}_{\\cdot 3} = \\frac{22+26+13+21}{4} = \\frac{82}{4} = \\frac{41}{2}$。\n差方和：$\\sum_{i=1}^{4} (x_{i3}-\\bar{x}_{\\cdot 3})^2 = (22 - \\frac{41}{2})^2 + (26 - \\frac{41}{2})^2 + (13 - \\frac{41}{2})^2 + (21 - \\frac{41}{2})^2$\n$= (\\frac{3}{2})^2 + (\\frac{11}{2})^2 + (-\\frac{15}{2})^2 + (\\frac{1}{2})^2 = \\frac{9+121+225+1}{4} = \\frac{356}{4} = 89$。\n方差 $s_{3,\\mathrm{before}}^{2} = \\frac{1}{3} \\times 89 = \\frac{89}{3}$。\n\n归一化前的平均方差：\n$\\frac{1}{3}\\sum_{j=1}^{3} s_{j,\\mathrm{before}}^{2} = \\frac{1}{3} \\left(\\frac{659}{12} + \\frac{491}{12} + \\frac{89}{3}\\right) = \\frac{1}{3} \\left(\\frac{659+491+4 \\times 89}{12}\\right) = \\frac{1}{3} \\left(\\frac{1150+356}{12}\\right) = \\frac{1506}{36} = \\frac{251}{6}$。\n\n**归一化后的方差 ($s_{j,\\mathrm{after}}^{2}$):**\n\n根据构造，归一化矩阵 $Y$ 的每一列都是参考分布 $\\{8, 13, 16, 23\\}$ 的一个排列。因此，所有列的均值和方差都相同。\n均值 $\\bar{y} = \\frac{8+13+16+23}{4} = \\frac{60}{4} = 15$。\n差方和：$\\sum (y_i - \\bar{y})^2 = (8-15)^2 + (13-15)^2 + (16-15)^2 + (23-15)^2$\n$= (-7)^2 + (-2)^2 + (1)^2 + (8)^2 = 49+4+1+64 = 118$。\n任意列 $j$ 的方差：$s_{j,\\mathrm{after}}^{2} = \\frac{1}{3} \\times 118 = \\frac{118}{3}$。\n\n归一化后的平均方差：\n$\\frac{1}{3}\\sum_{j=1}^{3} s_{j,\\mathrm{after}}^{2} = \\frac{1}{3} \\left(\\frac{118}{3} + \\frac{118}{3} + \\frac{118}{3}\\right) = \\frac{1}{3} \\left(3 \\times \\frac{118}{3}\\right) = \\frac{118}{3}$。\n\n### 第 3 部分：方差的变化\n\n样本内方差的变化 $\\Delta$ 定义为：\n$$\n\\Delta = \\left(\\frac{1}{3}\\sum_{j=1}^{3} s_{j,\\mathrm{after}}^{2}\\right) - \\left(\\frac{1}{3}\\sum_{j=1}^{3} s_{j,\\mathrm{before}}^{2}\\right)\n$$\n代入计算出的平均方差：\n$$\n\\Delta = \\frac{118}{3} - \\frac{251}{6} = \\frac{2 \\times 118}{6} - \\frac{251}{6} = \\frac{236 - 251}{6} = -\\frac{15}{6}\n$$\n化简分数得到：\n$$\n\\Delta = -\\frac{5}{2}\n$$",
            "answer": "$$\n\\boxed{-\\frac{5}{2}}\n$$"
        },
        {
            "introduction": "通用的归一化方法虽然强大，但对于具有特殊统计属性的数据（如来自RNA测序的计数数据）可能并非最优选择。本练习介绍了一种针对计数数据设计的、基于“大小因子”（size factor）的归一化策略，该策略能有效处理不同样本测序深度的差异。你将学习如何通过计算每个基因在样本间的几何平均值来建立一个稳定的参考，并估算每个样本的缩放因子，同时还将直面处理零计数这一实际数据分析中的常见挑战。",
            "id": "4339967",
            "problem": "在基于计数的RNA测序（RNA-seq）转录本定量中，使用样本特异性的缩放因子来减轻样本间测序深度的变异。一种广泛使用的方法是计算每个基因在所有样本中的几何平均值，以提供该基因的预期表达尺度，然后将每个样本的原始计数与该基因的几何平均值之比的中位数作为该样本的缩放因子。零的存在会使对数未定义，从而使几何平均值的计算复杂化。因此，可以选择在计算每个基因的几何平均值时忽略零值，或者在估计缩放因子时排除任何含有零的基因，因为它们在所有样本中的几何平均值为零。\n\n考虑以下针对基因 $g \\in \\{1,2,3,4,5\\}$ 和样本 $i \\in \\{1,2,3\\}$ 的整数计数矩阵：\n$$\n\\mathbf{C} \\;=\\;\n\\begin{pmatrix}\n0  50  100 \\\\\n30  0  60 \\\\\n5  15  0 \\\\\n80  120  160 \\\\\n10  10  10\n\\end{pmatrix}.\n$$\n\n执行以下步骤。\n\n1) 对于每个基因 $g$，通过忽略零值来计算其几何平均值 $g_g$，即计算一个唯一的正数，其自然对数等于该基因非零计数的自然对数的算术平均值。\n\n2) 对于每个样本 $i$，将所有基因（具有已定义的 $g_g$）的计数值与几何平均值之比 $C_{g,i}/g_g$ 的中位数作为其缩放因子 $s_i$ 的估计值。如果用于计算中位数的值的个数为偶数，则将中位数定义为中间两个值的算术平均值。\n\n3) 使用步骤2中得到的缩放因子 $s_i$，计算归一化计数值 $N_{g,i} = C_{g,i}/s_i$。\n\n4) 为了评估零值处理的影响，通过排除在任何样本中存在零值的基因来重新估计缩放因子。也就是说，重复步骤2，但仅使用在所有样本中计数值均为非零的基因，来计算第二组缩放因子 $s^{(\\mathrm{drop})}_i$。\n\n设样本 $i=2$ 的评估统计量为比率\n$$\nR \\;=\\; \\frac{s^{(\\mathrm{drop})}_2}{s_2}.\n$$\n\n根据上述步骤计算 $R$。将最终答案四舍五入到四位有效数字。以纯数字形式表示最终答案，不带单位。",
            "solution": "该问题陈述具有科学依据，表述清晰，客观，并包含了获得唯一解所需的所有信息。所描述的程序是转录组学中使用的标准归一化方法（例如，在DESeq2中）的简化版本，这使得该问题具有相关性和有效性。我们开始进行求解。\n\n提供的计数矩阵为：\n$$\n\\mathbf{C} \\;=\\;\n\\begin{pmatrix}\n0  50  100 \\\\\n30  0  60 \\\\\n5  15  0 \\\\\n80  120  160 \\\\\n10  10  10\n\\end{pmatrix}\n$$\n其中行对应于基因 $g \\in \\{1, 2, 3, 4, 5\\}$，列对应于样本 $i \\in \\{1, 2, 3\\}$。\n\n**1) 计算各基因的几何平均值 ($g_g$)**\n每个基因的几何平均值 $g_g$ 仅使用该基因 $g$ 的非零计数进行计算。公式为 $g_g = \\left( \\prod_{i \\text{ s.t. } C_{g,i}0} C_{g,i} \\right)^{1/N_g^*}$，其中 $N_g^*$ 是基因 $g$ 的非零计数个数。\n\n对于基因 $g=1$：非零计数为 $C_{1,2}=50$ 和 $C_{1,3}=100$。\n$$ g_1 = \\sqrt{50 \\times 100} = \\sqrt{5000} = \\sqrt{2500 \\times 2} = 50\\sqrt{2} $$\n\n对于基因 $g=2$：非零计数为 $C_{2,1}=30$ 和 $C_{2,3}=60$。\n$$ g_2 = \\sqrt{30 \\times 60} = \\sqrt{1800} = \\sqrt{900 \\times 2} = 30\\sqrt{2} $$\n\n对于基因 $g=3$：非零计数为 $C_{3,1}=5$ 和 $C_{3,2}=15$。\n$$ g_3 = \\sqrt{5 \\times 15} = \\sqrt{75} = \\sqrt{25 \\times 3} = 5\\sqrt{3} $$\n\n对于基因 $g=4$：计数为 $C_{4,1}=80$，$C_{4,2}=120$ 和 $C_{4,3}=160$。没有零值。\n$$ g_4 = (80 \\times 120 \\times 160)^{1/3} = ( (2 \\times 40) \\times (3 \\times 40) \\times (4 \\times 40) )^{1/3} = (40^3 \\times 24)^{1/3} = 40 \\times 24^{1/3} $$\n\n对于基因 $g=5$：计数为 $C_{5,1}=10$，$C_{5,2}=10$ 和 $C_{5,3}=10$。\n$$ g_5 = (10 \\times 10 \\times 10)^{1/3} = 10 $$\n\n**2) 估计缩放因子 $s_2$**\n样本 $i=2$ 的缩放因子，记为 $s_2$，是所有基因 $g \\in \\{1, 2, 3, 4, 5\\}$ 的比率 $C_{g,2}/g_g$ 的中位数。样本2的计数为 $(50, 0, 15, 120, 10)$。\n\n这些比率为：\n对于 $g=1$： $\\frac{C_{1,2}}{g_1} = \\frac{50}{50\\sqrt{2}} = \\frac{1}{\\sqrt{2}}$\n对于 $g=2$： $\\frac{C_{2,2}}{g_2} = \\frac{0}{30\\sqrt{2}} = 0$\n对于 $g=3$： $\\frac{C_{3,2}}{g_3} = \\frac{15}{5\\sqrt{3}} = \\frac{3}{\\sqrt{3}} = \\sqrt{3}$\n对于 $g=4$： $\\frac{C_{4,2}}{g_4} = \\frac{120}{40 \\times 24^{1/3}} = \\frac{3}{24^{1/3}}$\n对于 $g=5$： $\\frac{C_{5,2}}{g_5} = \\frac{10}{10} = 1$\n\n样本2的比率集合为 $\\{ \\frac{1}{\\sqrt{2}}, 0, \\sqrt{3}, \\frac{3}{24^{1/3}}, 1 \\}$。为了找到中位数，我们对这些值进行排序。\n数值上，这些值约等于：\n$\\frac{1}{\\sqrt{2}} \\approx 0.7071$\n$0$\n$\\sqrt{3} \\approx 1.7321$\n$\\frac{3}{24^{1/3}} \\approx \\frac{3}{2.8845} \\approx 1.0400$\n$1$\n\n排序后的比率列表为 $\\{0, \\frac{1}{\\sqrt{2}}, 1, \\frac{3}{24^{1/3}}, \\sqrt{3}\\}$。\n这5个值的中位数是排序后列表中的第3个值。\n$$ s_2 = 1 $$\n\n**3) 重新估计缩放因子 $s_2^{(\\mathrm{drop})}}$**\n在这一步中，我们排除了在任何样本中具有零计数的基因。基因1、2和3有零计数。在所有样本中计数均为非零的基因只有基因4和基因5。\n缩放因子 $s_2^{(\\mathrm{drop})}$ 是 $g \\in \\{4, 5\\}$ 时比率 $C_{g,2}/g_g$ 的中位数。\n\n这两个比率为：\n对于 $g=4$： $\\frac{C_{4,2}}{g_4} = \\frac{3}{24^{1/3}}$\n对于 $g=5$： $\\frac{C_{5,2}}{g_5} = 1$\n\n比率的集合是 $\\{1, \\frac{3}{24^{1/3}}\\}$。由于值的数量为偶数（2个），中位数是它们的算术平均值。\n$$ s_2^{(\\mathrm{drop})} = \\frac{1}{2} \\left( 1 + \\frac{3}{24^{1/3}} \\right) $$\n\n**4) 计算评估统计量 $R$**\n评估统计量是比率 $R = \\frac{s_2^{(\\mathrm{drop})}}{s_2}$。\n代入我们求得的值：\n$$ R = \\frac{\\frac{1}{2} \\left( 1 + \\frac{3}{24^{1/3}} \\right)}{1} = \\frac{1}{2} \\left( 1 + \\frac{3}{24^{1/3}} \\right) $$\n\n现在，我们计算数值并四舍五入到四位有效数字。\n$24^{1/3} \\approx 2.88449914$\n$$ R = \\frac{1}{2} \\left( 1 + \\frac{3}{2.88449914} \\right) \\approx \\frac{1}{2} (1 + 1.04004191) = \\frac{1}{2} (2.04004191) \\approx 1.02002096 $$\n四舍五入到四位有效数字得到 $1.020$。",
            "answer": "$$\\boxed{1.020}$$"
        }
    ]
}