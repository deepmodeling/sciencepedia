{
    "hands_on_practices": [
        {
            "introduction": "在分析高通量测序数据之前，理解其生成过程至关重要。本练习将探讨Lander-Waterman模型，这是预测鸟枪法测序中基因组覆盖度的基本工具。通过完成这个计算，你将直观地理解测序深度、读长和基因组覆盖完整性之间的定量关系，为实验设计和数据质量评估打下坚实基础。",
            "id": "4350626",
            "problem": "一个长度为 $G = 5.0 \\times 10^{6}$ 碱基对 (bp) 的微生物基因组，使用一个新一代测序 (NGS) 平台上的两个单端文库进行鸟枪法测序。经过质量控制并移除低质量读段后，文库 A 贡献了 $N_{A} = 6.0 \\times 10^{4}$ 条固定长度为 $L_{A} = 150$ bp 的读段，文库 B 贡献了 $N_{B} = 4.0 \\times 10^{4}$ 条固定长度为 $L_{B} = 300$ bp 的读段。假设经典的 Lander–Waterman 假设成立：读段起始位点在基因组上均匀且独立地分布；读段具有固定长度；没有边缘或边界效应；并且在整个基因组的采样中没有偏差。\n\n从读段起始位置沿一维基因组坐标的齐次泊松过程的定义以及两个文库的独立性出发，推导一个表达式，用于计算基因组中未被任一文库的任何读段覆盖的碱基的期望数量。然后，使用给定的 $G$、$N_{A}$、$L_{A}$、$N_{B}$ 和 $L_{B}$ 计算该表达式的值。用碱基对 (bp) 表示最终的期望未覆盖基因组长度，并将答案四舍五入到四位有效数字。",
            "solution": "首先验证问题，以确保其在科学上是合理的、良定的和客观的。\n\n### 步骤 1：提取给定条件\n- 基因组长度：$G = 5.0 \\times 10^{6}$ bp\n- 文库 A，读段数量：$N_{A} = 6.0 \\times 10^{4}$\n- 文库 A，读段长度：$L_{A} = 150$ bp\n- 文库 B，读段数量：$N_{B} = 4.0 \\times 10^{4}$\n- 文库 B，读段长度：$L_{B} = 300$ bp\n- 假设：\n  - Lander–Waterman 模型假设成立。\n  - 读段起始位点在基因组上均匀且独立地分布。\n  - 读段起始位置遵循齐次泊松过程。\n  - 两个文库（A 和 B）是独立的。\n  - 不考虑边缘或边界效应。\n\n### 步骤 2：使用提取的给定条件进行验证\n- **科学合理性**：该问题基于 Lander–Waterman 模型，这是生物信息学中分析鸟枪法测序数据的基石。使用泊松过程对读段放置进行建模是一种标准且成熟的方法。所提供的基因组大小、读段计数和读段长度的数值对于微生物测序实验是符合实际的。\n- **良定性**：该问题提供了所有必要的参数和一套清晰的假设，以推导出未覆盖碱基期望数量的唯一、有意义的解。\n- **客观性**：该问题使用精确的、定量的语言陈述，没有任何主观性或歧义。\n\n### 步骤 3：结论与行动\n该问题是有效的。它是 Lander-Waterman 理论在基因组测序覆盖度方面的标准应用。将通过推导相关公式，然后代入给定值来求解。\n\n### 求解推导\n\n问题要求计算基因组中未被任何读段覆盖的碱基的期望数量。我们可以通过首先找到单个任意碱基未被覆盖的概率，然后将其推广到整个基因组来解决这个问题。\n\n让我们考虑基因组中任意位置 $x$ 的一个碱基。问题指出，读段的起始位置是均匀且独立分布的，遵循齐次泊松过程。\n\n对于文库 A，有 $N_{A}$ 条读段。每个碱基对的读段起始率为 $\\lambda_{A} = \\frac{N_{A}}{G}$。长度为 $L_{A}$ 的读段将覆盖位置 $x$ 处的碱基，当且仅当它起始于区间 $[x - L_{A} + 1, x]$ 内的一个位置。该区间的长度为 $L_{A}$。无边缘效应的假设意味着我们可以忽略当 $x$ 靠近基因组的起点或终点时的复杂情况。\n\n从文库 A 中，起始于这个长度为 $L_{A}$ 的区间内的读段数量遵循泊松分布，其均值为 $\\mu_{A} = \\lambda_{A} L_{A} = \\frac{N_{A} L_{A}}{G}$。这个值也被称为由文库 A 提供的测序覆盖度或深度，记作 $c_{A}$。\n$$c_{A} = \\frac{N_{A} L_{A}}{G}$$\n位置 $x$ 处的碱基**不**被文库 A 的任何读段覆盖的概率，即为在指定区间内起始的读段数量为零的概率。对于均值为 $c_{A}$ 的泊松分布，该概率为：\n$$P(\\text{未被 A 覆盖}) = \\frac{c_{A}^{0} \\exp(-c_{A})}{0!} = \\exp(-c_{A})$$\n\n类似地，对于文库 B，有 $N_{B}$ 条长度为 $L_{B}$ 的读段，其读段起始率为 $\\lambda_{B} = \\frac{N_{B}}{G}$。长度为 $L_{B}$ 的读段覆盖位置 $x$，如果它起始于区间 $[x - L_{B} + 1, x]$。从文库 B 中，起始于此区间内的读段数量是一个泊松随机变量，其均值为 $\\mu_{B} = \\lambda_{B} L_{B} = \\frac{N_{B} L_{B}}{G}$。这是文库 B 的覆盖深度 $c_{B}$。\n$$c_{B} = \\frac{N_{B} L_{B}}{G}$$\n位置 $x$ 处的碱基**不**被文库 B 的任何读段覆盖的概率为：\n$$P(\\text{未被 B 覆盖}) = \\exp(-c_{B})$$\n\n问题指出两个文库是独立的。因此，“未被 A 覆盖”事件和“未被 B 覆盖”事件是独立的。位置 $x$ 处的碱基未被**任一**文库的**任何**读段覆盖的概率，是它同时未被 A 覆盖且未被 B 覆盖的概率。\n$$P(\\text{未被覆盖}) = P(\\text{未被 A 覆盖}) \\times P(\\text{未被 B 覆盖})$$\n$$P(\\text{未被覆盖}) = \\exp(-c_{A}) \\times \\exp(-c_{B}) = \\exp(-(c_{A} + c_{B}))$$\n代入 $c_A$ 和 $c_B$ 的表达式：\n$$P(\\text{未被覆盖}) = \\exp\\left(-\\left(\\frac{N_{A} L_{A}}{G} + \\frac{N_{B} L_{B}}{G}\\right)\\right) = \\exp\\left(-\\frac{N_A L_A + N_B L_B}{G}\\right)$$\n\n设 $E[U]$ 为整个长度为 $G$ 的基因组中未覆盖碱基的期望数量。我们可以为每个碱基 $i=1, 2, \\dots, G$ 定义一个指示随机变量 $I_i$，其中如果碱基 $i$ 未被覆盖，则 $I_i=1$，如果被覆盖，则 $I_i=0$。$I_i$ 的期望值为 $E[I_i] = 1 \\cdot P(I_i=1) + 0 \\cdot P(I_i=0) = P(\\text{碱基 } i \\text{ 未被覆盖})$。\n由于均匀分布的假设，这个概率对于所有碱基都是相同的，等于上面推导出的 $P(\\text{未被覆盖})$。\n未覆盖碱基的总数是 $U = \\sum_{i=1}^{G} I_i$。根据期望的线性性质：\n$$E[U] = E\\left[\\sum_{i=1}^{G} I_i\\right] = \\sum_{i=1}^{G} E[I_i] = G \\cdot P(\\text{未被覆盖})$$\n因此，未覆盖碱基的期望数量的表达式为：\n$$E[U] = G \\exp\\left(-\\frac{N_A L_A + N_B L_B}{G}\\right)$$\n\n现在，我们使用给定的值来计算这个表达式。\n- $G = 5.0 \\times 10^{6}$ bp\n- $N_{A} = 6.0 \\times 10^{4}$\n- $L_{A} = 150$ bp\n- $N_{B} = 4.0 \\times 10^{4}$\n- $L_{B} = 300$ bp\n\n首先，计算测序的总碱基数，即指数部分参数的分子：\n$$N_A L_A = (6.0 \\times 10^{4}) \\times 150 = 9.0 \\times 10^{6}$$\n$$N_B L_B = (4.0 \\times 10^{4}) \\times 300 = 12.0 \\times 10^{6}$$\n$$N_A L_A + N_B L_B = 9.0 \\times 10^{6} + 12.0 \\times 10^{6} = 21.0 \\times 10^{6}$$\n\n接下来，计算总覆盖深度 $c = c_A + c_B$：\n$$c = \\frac{N_A L_A + N_B L_B}{G} = \\frac{21.0 \\times 10^{6}}{5.0 \\times 10^{6}} = 4.2$$\n\n最后，计算未覆盖碱基的期望数量：\n$$E[U] = G \\exp(-c) = (5.0 \\times 10^{6}) \\times \\exp(-4.2)$$\n$$E[U] \\approx (5.0 \\times 10^{6}) \\times 0.014995576$$\n$$E[U] \\approx 74977.88 \\text{ bp}$$\n\n问题要求答案四舍五入到四位有效数字。\n$$E[U] \\approx 74980 \\text{ bp}$$\n用科学记数法表示，这结果是 $7.498 \\times 10^{4}$ bp。",
            "answer": "$$\\boxed{7.498 \\times 10^4}$$"
        },
        {
            "introduction": "原始的RNA测序读数计数会受到测序深度等技术偏差的影响，因此必须进行校正才能进行有意义的定量分析。本练习深入探讨了广泛使用的DESeq2工具包所采用的“比例中值”归一化方法。通过亲手实现这一优雅而稳健的算法，你将理解如何计算样本特异性的缩放因子，从而使得不同样本间的基因表达水平具有可比性。",
            "id": "4350607",
            "problem": "给定来自高通量核糖核酸测序 (RNA-seq) 实验的计数矩阵，其中的条目是非负整数，表示每个样本中每个基因（特征）的读数计数。目标是使用源自系统生物医学中常见的、基于原理的乘性测量模型的 DESeq$_{2}$ (使用序列计数数据的差异表达分析第2版) 比率中位数方法，来估计样本特异性缩放因子并计算标准化计数。\n\n出发点与假设：\n- 测量模型：对于每个基因 $i$ 和样本 $j$，观测计数 $K_{ij}$ 被建模为一个分布的实现，其均值 $\\mu_{ij}$ 满足乘性结构 $\\mu_{ij} = s_j \\cdot q_i$，其中 $s_j$ 编码样本特异性测序深度或文库大小，$q_i$ 编码基因特异性表达水平。这与 RNA-seq 分析中广泛使用的计数模型（如负二项分布）是一致的，在这些模型中，方差相对于泊松分布是过离散的。此处的分析重点是估计 $s_j$ 并构建标准化计数 $N_{ij}$，以使下游比较反映的是 $q_i$ 而非 $s_j$。\n- 稳健估计原理：$s_j$ 的尺度估计量应能抵抗基因特异性离群值和组成偏差，并且不应需要外部对照。这促使我们使用一个跨样本的基因层面参考水平和样本层面的比率稳健聚合方法。\n\n任务：\n- 从上述乘性基础出发，推导出一个使用基因层面参考和样本层面比率稳健聚合来估计 $s_j$ 并计算标准化计数 $N_{ij}$ 的算法流程。\n- 使用以下明确约定来实现该流程，以确保确定性的输出：\n  $1.$ 将每个基因 $i$ 的基因层面参考计算为其在所有样本中的几何平均值，但前提是该基因的计数在所有样本中都严格为正。形式上，对于基因 $i$，如果 $\\prod_{j} \\mathbb{I}(K_{ij} > 0) = 1$，则定义 $G_i$ 为 $G_i = \\exp\\left( \\frac{1}{m} \\sum_{j=1}^{m} \\log K_{ij} \\right)$，其中 $m$ 是样本数量；否则，设置 $G_i = 0$ 并从比率计算中排除基因 $i$。\n  $2.$ 对于每个样本 $j$，构建比率集合 $\\{ R_{ij} = K_{ij} / G_i \\mid G_i > 0 \\}$，并将样本大小因子 $s_j$ 定义为这些比率的中位数。如果某个样本的该集合为空（即没有任何基因在所有样本中的计数都严格为正），则定义 $s_j = 1$。\n  $3.$ 对于所有基因 $i$ 和样本 $j$，将标准化计数定义为 $N_{ij} = K_{ij} / s_j$。\n  $4.$ 将所有浮点数输出四舍五入到 $6$ 位小数。\n- 您必须将最终输出表示为单行文本，其中包含一个用方括号括起来的逗号分隔列表，该列表聚合了所有测试用例的结果。对于每个测试用例，其结果必须是一个包含两个列表的列表：第一个列表是大小因子 $[s_1, s_2, \\dots, s_m]$，第二个列表是行主序扁平化的标准化计数列表 $[N_{11}, N_{12}, \\dots, N_{1m}, N_{21}, \\dots, N_{nm}]$。\n\n单位和数值格式：\n- 本问题中没有物理单位；所有输出都是无单位的计数或缩放因子。\n- 所有输出都必须是四舍五入到 $6$ 位小数的浮点数。\n- 不允许使用百分号；任何分数量都必须表示为小数。\n\n测试套件：\n为以下测试用例提供结果，这些测试用例是基因×样本的计数矩阵。每个测试用例都是一个整数矩阵；您必须遵循上述约定计算相应的大小因子和标准化计数。\n\n- 测试用例 $1$ (理想情况，严格为正的计数，成比例缩放)：\n  基因 $3$，样本 $3$，\n  矩阵：\n  $$\\begin{bmatrix}\n  100  200  50 \\\\\n  200  400  100 \\\\\n  300  600  150\n  \\end{bmatrix}$$\n\n- 测试用例 $2$ (含零基因被排除在参考之外，稳健的中位数行为)：\n  基因 $4$，样本 $3$，\n  矩阵：\n  $$\\begin{bmatrix}\n  10  20  5 \\\\\n  0  0  0 \\\\\n  4  8  2 \\\\\n  7  14  3\n  \\end{bmatrix}$$\n\n- 测试用例 $3$ (边界情况，至少一个样本中没有可用于比率计算的基因，默认大小因子)：\n  基因 $2$，样本 $2$，\n  矩阵：\n  $$\\begin{bmatrix}\n  0  5 \\\\\n  0  10\n  \\end{bmatrix}$$\n\n输出规格：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[result1,result2,result3]$），其中每个 $resultk$ 对应测试用例 $k$，并且其本身就是如上所述的包含两个列表的列表。",
            "solution": "我们从作为基于计数的高通量检测（如核糖核酸测序 RNA-seq）基础的乘性测量模型开始。对于每个基因 $i$ 和样本 $j$，观测计数 $K_{ij}$ 的期望值被建模为 $\\mu_{ij} = s_j \\cdot q_i$，其中 $s_j$ 反映了样本特异性缩放（例如，测序深度或文库大小），而 $q_i$ 反映了基因特异性丰度。这种结构与广泛使用的负二项 (Negative Binomial) 计数模型一致，在这些模型中，$K_{ij}$ 的均值为 $\\mu_{ij}$，且由于过离散，其方差超过均值，但 $\\mu_{ij}$ 的尺度仍然可以分解为一个样本特异性因子和一个基因特异性因子。\n\n核心目标是在不受 $q_i$ 混淆的情况下估计样本特异性尺度参数 $s_j$，然后构建标准化计数 $N_{ij}$ 以消除 $s_j$ 的影响，从而能够在样本间对 $q_i$ 进行下游比较。为此，我们采用一个从乘性模型推导出的、稳健的基于比率的估计量。\n\n考虑以下原理：如果 $\\mu_{ij} = s_j \\cdot q_i$，那么观测计数除以 $q_i$ 的估计值所得的商将集中在 $s_j$ 附近。一个跨样本的、针对 $q_i$ 的自然的、无分布的参考是观测计数的基因层面几何平均值，因为几何平均值遵循乘性结构。具体来说，对于基因 $i$ 和 $m$ 个样本，定义\n$$\nG_i = \\exp\\left( \\frac{1}{m} \\sum_{j=1}^{m} \\log K_{ij} \\right),\n$$\n但仅当所有 $K_{ij} > 0$ 时才如此，以确保对数有定义且乘性参考在所有样本中都有意义。如果基因 $i$ 的任何计数为零，则设置 $G_i = 0$ 并从比率计算中排除该基因。这种排除方式遵循了一个实际约束，即只要有任何一个条目为零，跨所有样本的几何平均值就为零，并且它避免了引入会改变乘性结构的任意伪计数。\n\n在乘性模型下，对于在所有样本中都具有严格正计数的基因，我们有 $K_{ij} \\approx s_j \\cdot q_i$ 并伴有围绕均值的随机波动，因此比率\n$$\nR_{ij} = \\frac{K_{ij}}{G_i}\n$$\n近似于 $s_j \\cdot \\frac{q_i}{G_i}$。由于 $G_i$ 是 $q_i$ 在样本间的乘性参考，$\\frac{q_i}{G_i}$ 对于基因 $i$ 在不同的 $j$ 之间是恒定的，而在不同基因之间，对于固定的 $j$，$R_{ij}$ 的变化是由基因特异性偏差和随机噪声驱动的。因此，对固定 $j$ 的集合 $\\{ R_{ij} : G_i > 0 \\}$ 进行稳健聚合，应能恢复 $s_j$（误差在一个乘性噪声范围内）。样本层面的中位数是集中趋势的一个稳健估计量，它能抵抗离群值和组成效应，因此非常适合此目的。\n\n因此，对于每个样本 $j$，我们定义大小因子\n$$\ns_j = \\operatorname{median}\\{ R_{ij} \\mid G_i > 0 \\}。\n$$\n如果对于样本 $j$，可用基因集（即那些 $G_i > 0$ 的基因）为空，则数据无法提供任何信息来估计 $s_j$。为了确定性，在这种情况下，我们采用约定 $s_j = 1$，这使得计数保持不变，并明确指出无法执行标准化。\n\n计算出大小因子后，通过移除样本特异性尺度来生成标准化计数：\n$$\nN_{ij} = \\frac{K_{ij}}{s_j}。\n$$\n这些标准化计数的期望值与 $q_i$ 成比例，并且由于 $s_j$ 的影响已被移除，它们适用于下游的比较分析。\n\n算法设计：\n$1.$ 输入一个基因×样本的非负整数矩阵 $K$。令 $n$ 表示基因数量（行数），$m$ 表示样本数量（列数）。\n$2.$ 对于每个基因 $i \\in \\{1,\\dots,n\\}$，如果 $\\prod_{j=1}^{m} \\mathbb{I}(K_{ij} > 0) = 1$，则通过计算 $\\log K_{ij}$ 在 $j$ 上的算术平均值并取指数来计算 $G_i$；否则设置 $G_i = 0$。\n$3.$ 对于每个样本 $j \\in \\{1,\\dots,m\\}$，构建比率集 $\\{ R_{ij} = K_{ij} / G_i : G_i > 0 \\}$。如果比率集非空，则将 $s_j$ 设置为这些比率的中位数；如果为空，则设置 $s_j = 1$。\n$4.$ 为所有 $i,j$ 计算 $N_{ij} = K_{ij} / s_j$。\n$5.$ 将所有浮点数输出四舍五入到 $6$ 位小数，以产生确定性结果。\n\n测试套件覆盖范围：\n- 测试用例 1 使用了在样本间成比例缩放的严格正计数。乘性模型意味着 $s_j$ 应反映比例常数，而标准化计数 $N_{ij}$ 应在样本间按基因对齐。\n- 测试用例 2 包含带零的基因，这些基因被排除在几何平均值计算之外。对其余比率进行稳健的中位数计算得出的样本大小因子与比例缩放一致，展示了对排除情况的处理能力和稳健性。\n- 测试用例 3 呈现了一个边界条件，即没有基因在所有样本中都具有严格正计数。算法为所有样本设置 $s_j = 1$，标准化计数等于原始计数，展示了指定的默认行为。\n\n实现细节：\n- 使用数值数组和基本的向量化操作来计算几何平均值、中位数和标准化计数。\n- 确保所有输出都四舍五入到 $6$ 位小数。\n- 生成单行输出，以指定的嵌套列表格式聚合所有测试用例的结果，其中每个测试用例的结果是一对列表：大小因子和按行主序扁平化的标准化计数。",
            "answer": "[[[1.000000,2.000000,0.500000],[100.000000,100.000000,100.000000,200.000000,200.000000,200.000000,300.000000,300.000000,300.000000]],[[1.000000,2.000000,0.428571],[10.000000,10.000000,11.666667,0.000000,0.000000,0.000000,4.000000,4.000000,4.666667,7.000000,7.000000,7.000000]],[[1.000000,1.000000],[0.000000,5.000000,0.000000,10.000000]]]"
        },
        {
            "introduction": "任何高通量实验的最终目标都是获得可靠的科学发现，而这需要严格的统计置信度评估。本练习将我们的视野拓宽到蛋白质组学，并介绍了目标-诱饵策略（target-decoy strategy），这是一种在质谱蛋白质组学中估算错误发现率（False Discovery Rate, $FDR$）的核心方法。通过计算$FDR$和$q$值，你将学会如何控制假阳性，并为鉴定出的肽段分配统计置信度。",
            "id": "4350609",
            "problem": "给定一组来自串联质谱蛋白质组学实验的肽谱匹配（PSM）得分，每个得分都被标记为目标鉴定或伪库鉴定。在目标-伪库方法中，伪库PSM用作错误匹配的空分布的经验近似。您必须使用假设检验的基本定义，推导并实现固定得分阈值下的错误发现率（FDR）估计量，并使用基于经验伪库的$p$值为目标PSM计算Benjamini–Hochberg（BH）q值。\n\n使用的定义和原则：\n- 一个PSM是一次假设检验，其原假设是匹配不正确。错误发现率（FDR）是所有发现中假阳性比例的期望值。\n- 在目标-伪库方法中，在级联搜索和可比较的搜索空间大小的条件下，经验空分布可以通过伪库得分来近似。设 $N_D(s)$ 是得分大于或等于得分阈值 $s$ 的伪库数量，设 $N_T(s)$ 是得分大于或等于 $s$ 的目标数量。在阈值 $s$ 处的FDR的目标-伪库估计量为\n$$\n\\widehat{\\mathrm{FDR}}(s) = \n\\begin{cases}\n\\frac{N_D(s)}{N_T(s)}, & \\text{if } N_T(s) > 0, \\\\\n1, & \\text{if } N_T(s) = 0,\n\\end{cases}\n$$\n这反映了按照惯例，如果没有目标发现，则错误发现率取为$1$。\n- 对于每个目标PSM得分 $x$，定义一个相对于伪库空分布的经验单边$p$值为\n$$\np(x) = \\frac{1 + \\#\\{d \\in \\text{decoys} : d \\ge x\\}}{1 + n_D},\n$$\n其中 $n_D$ 是伪库PSM的总数。$+1$ 项实现了一种连续性校正，以避免在有限样本中出现零$p$值。\n- 对于具有$p$值 $p_1,\\dots,p_n$ 的 $n$ 个假设，Benjamini–Hochberg (BH) 程序通过以下步骤计算q值：首先将$p$值排序为 $p_{(1)} \\le \\cdots \\le p_{(n)}$，然后构成\n$$\nq_{(j)} = \\min_{k \\ge j} \\left( \\frac{n}{k} p_{(k)} \\right),\n$$\n最后将 $q_{(j)}$ 映射回原始的假设顺序。q值被截断在 $[0,1]$ 区间内。\n\n任务：\n1. 对于每个提供的测试用例，使用上述定义计算每个指定阈值 $s$ 处的 $\\widehat{\\mathrm{FDR}}(s)$。\n2. 使用上述公式为每个目标PSM得分计算基于经验伪库的$p$值，然后为这些目标计算BH q值。\n\n将所有的FDR和q值表示为小数值。不涉及物理单位或角度单位。所有输出必须是数字浮点数或浮点数列表。\n\n测试套件：\n- 用例1（一般情况，目标和伪库混合，具有不同阈值）：\n  - 得分：$[52.1, 47.3, 25.5, 10.2, 5.1, 41.0, 38.2, 2.5, 1.8, 0.5, 55.0, 12.3, 29.7, 3.0]$\n  - 标签：$[\\text{T}, \\text{T}, \\text{T}, \\text{T}, \\text{D}, \\text{T}, \\text{T}, \\text{D}, \\text{D}, \\text{D}, \\text{T}, \\text{T}, \\text{T}, \\text{D}]$\n  - 阈值：$[5.0, 10.0, 40.0]$\n- 用例2（边界情况，无目标）：\n  - 得分：$[0.4, 1.0, 2.1, 3.3, 8.0, 12.0, 15.5, 22.0]$\n  - 标签：全为 $\\text{D}$\n  - 阈值：$[1.0, 10.0, 20.0]$\n- 用例3（边缘情况，目标和伪库之间存在得分相同的情况）：\n  - 得分：$[10.0, 10.0, 5.0, 5.0, 20.0, 2.0, 12.0, 12.0, 1.5]$\n  - 标签：$[\\text{T}, \\text{D}, \\text{T}, \\text{D}, \\text{T}, \\text{D}, \\text{T}, \\text{D}, \\text{T}]$\n  - 阈值：$[2.0, 10.0, 12.0]$\n\n程序要求：\n- 使用提供的数据，精确地按照所述方式实现计算。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。对于每个测试用例，输出一个包含两个元素的列表：第一个元素是在给定阈值下的 $\\widehat{\\mathrm{FDR}}(s)$ 值列表（与阈值顺序相同），第二个元素是目标PSM的BH q值列表（按原始输入顺序）。例如，总输出结构必须是 $[[\\text{FDRs\\_case1},\\ \\text{qvals\\_case1}],[\\text{FDRs\\_case2},\\ \\text{qvals\\_case2}],[\\text{FDRs\\_case3},\\ \\text{qvals\\_case3}]]$ 的形式。",
            "solution": "问题陈述已经过严格验证，并被确定为有效。它在科学上是合理的、良构的、客观的和自洽的，提出了一个根植于系统生物医学（特别是蛋白质组学数据分析）中统计分析基本原理的正式计算任务。所提供的错误发现率（FDR）估计量、经验$p$值和Benjamini-Hochberg（BH）q值的定义是标准且正确的。为得出唯一解，所有必要的数据和条件均已提供。\n\n该任务是为每个给定的肽谱匹配（PSM）得分测试用例计算两组值：\n1.  在一系列指定的得分阈值 $s$ 处，估算的错误发现率 $\\widehat{\\mathrm{FDR}}(s)$。\n2.  所有目标PSM的Benjamini-Hochberg（BH）q值。\n\n解决方案通过为每个任务精确实现所提供的公式来展开。首先，将输入的得分和标签分离为两个不同的集合：目标得分和伪库得分。伪库得分用于对不正确匹配的空分布进行建模。\n\n第一个任务是计算给定阈值下的FDR。基于目标-伪库的FDR估计量在得分阈值 $s$ 处的定义如下：\n$$\n\\widehat{\\mathrm{FDR}}(s) = \n\\begin{cases}\n\\frac{N_D(s)}{N_T(s)}, & \\text{if } N_T(s) > 0 \\\\\n1, & \\text{if } N_T(s) = 0\n\\end{cases}\n$$\n此处，$N_T(s)$ 是得分大于或等于 $s$ 的目标PSM数量，$N_D(s)$ 是得分大于或等于 $s$ 的伪库PSM数量。对于测试用例中提供的每个阈值，我们将从输入数据中计算符合条件的目标和伪库的数量，并应用此公式。\n\n第二个任务是为目标PSM集合计算q值。这是一个多步骤的过程。\n\n步骤1：经验$p$值计算。对于 $n$ 个目标得分中的每一个 $x_i$，通过将其与 $n_D$ 个伪库得分的分布进行比较来计算经验$p$值。所提供的公式为：\n$$\np(x_i) = \\frac{1 + \\#\\{d \\in \\text{decoys} : d \\ge x_i\\}}{1 + n_D}\n$$\n在分子和分母上加1是一种伪计数或连续性校正，可防止在有限的伪库集中出现$p$值为0的情况，这是一种标准做法。\n\n步骤2：Benjamini-Hochberg (BH) 程序。计算出包含 $n$ 个p值的列表 $\\{p_1, \\dots, p_n\\}$ 后，应用BH程序来控制错误发现率。\n-   将$p$值按升序排序：$p_{(1)} \\le p_{(2)} \\le \\cdots \\le p_{(n)}$。必须跟踪这些$p$值的原始索引，以便重新映射最终的q值。\n-   对于排名为 $j$ 的每个已排序$p$值 $p_{(j)}$，计算一个中间值：$\\frac{n}{j} p_{(j)}$。\n-   然后通过确保单调性来计算已排序的q值 $q_{(j)}$。它是所有排名大于或等于 $j$ 的此类中间值的最小值：\n    $$\n    q_{(j)} = \\min_{k \\ge j} \\left( \\frac{n}{k} p_{(k)} \\right)\n    $$\n    这在计算上是通过从最大排名 $n$ 开始向下取累积最小值来实现的：\n    $$\n    q_{(n)} = \\frac{n}{n} p_{(n)} = p_{(n)}\n    $$\n    $$\n    q_{(j)} = \\min\\left(\\frac{n}{j} p_{(j)}, q_{(j+1)}\\right) \\quad \\text{for } j = n-1, \\dots, 1\n    $$\n-   得到的q值被截断在 $[0, 1]$ 范围内，因为q值作为一种FDR，不能超过1。\n-   最后，将已排序和调整后的q值 $\\{q_{(1)}, \\dots, q_{(n)}\\}$ 重新排序，以匹配目标PSM的原始未排序顺序。\n\n该方法论将通过计算应用于每个提供的测试用例。实现将使用数值库进行高效和准确的数组操作。",
            "answer": "[[[0.200000,0.125000,0.000000],[0.100000,0.100000,0.166667,0.125000,0.100000,0.100000,0.100000,0.125000,0.166667]],[[1.000000,0.750000,0.250000],[]],[[2.000000,0.500000,0.250000],[0.500000,0.500000,1.000000,0.500000,1.000000]]]"
        }
    ]
}