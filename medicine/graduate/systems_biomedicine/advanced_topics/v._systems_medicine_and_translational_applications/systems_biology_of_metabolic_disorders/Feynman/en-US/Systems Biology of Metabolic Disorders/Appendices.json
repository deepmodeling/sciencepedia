{
    "hands_on_practices": [
        {
            "introduction": "A robust metabolic model must be grounded in physical reality, which begins with ensuring that every included reaction obeys the laws of conservation of mass and charge. This exercise provides hands-on practice in the fundamental quality control step of verifying the elemental and charge balance of a biochemical reaction . By representing metabolites as vectors of their atomic compositions and reactions as stoichiometric vectors, you will see how this conservation law translates into a simple, yet powerful, matrix-vector relationship that is essential for constructing valid genome-scale models.",
            "id": "4390638",
            "problem": "Consider a genome-scale metabolic reconstruction (GEM) of hepatocyte metabolism used to study insulin-resistant states in type 2 diabetes. In such reconstructions, the stoichiometric matrix $S$ encodes reactions, and elemental and charge conservation are enforced by requiring that each reaction column respects conservation of atoms and charge. This is represented by a composition matrix $E$ whose rows enumerate elemental counts and net charge for each metabolite, and the constraint $E\\,\\nu^{(j)}=\\mathbf{0}$ must hold for every reaction column $\\nu^{(j)}$ of $S$. Here, focus on cytosolic adenosine triphosphate (ATP) hydrolysis, which is a central energy-transducing reaction perturbed in metabolic disorders.\n\nAssume the metabolite set $\\mathcal{M}=\\{\\text{ATP}^{4-},\\ \\text{ADP}^{3-},\\ \\text{H}_{2}\\text{O},\\ \\text{HPO}_{4}^{2-},\\ \\text{H}^{+}\\}$ with the following elemental composition vectors at physiological pH $7.0$ (consistent with curated reconstructions), ordered by elements $\\{ \\text{C}, \\text{H}, \\text{N}, \\text{O}, \\text{P}, q \\}$ where $q$ denotes net charge:\n- $\\text{ATP}^{4-}$: $(10,\\ 12,\\ 5,\\ 13,\\ 3,\\ -4)$,\n- $\\text{ADP}^{3-}$: $(10,\\ 12,\\ 5,\\ 10,\\ 2,\\ -3)$,\n- $\\text{H}_{2}\\text{O}$: $(0,\\ 2,\\ 0,\\ 1,\\ 0,\\ 0)$,\n- $\\text{HPO}_{4}^{2-}$: $(0,\\ 1,\\ 0,\\ 4,\\ 1,\\ -2)$,\n- $\\text{H}^{+}$: $(0,\\ 1,\\ 0,\\ 0,\\ 0,\\ +1)$.\n\nDefine the composition matrix $E \\in \\mathbb{R}^{6\\times 5}$ as the matrix whose columns are these per-metabolite composition vectors in the above metabolite order. Consider two candidate reaction columns for ATP hydrolysis (cytosol) written with reactants having negative stoichiometric coefficients and products positive:\n- Correct reaction $R_{1}$: $$\\nu^{(1)} = \\begin{pmatrix} -1 \\\\ +1 \\\\ -1 \\\\ +1 \\\\ +1 \\end{pmatrix}$$ corresponding to $\\text{ATP}^{4-} + \\text{H}_{2}\\text{O} \\rightarrow \\text{ADP}^{3-} + \\text{HPO}_{4}^{2-} + \\text{H}^{+}$.\n- Erroneous reaction $R_{2}$: $$\\nu^{(2)} = \\begin{pmatrix} -1 \\\\ +1 \\\\ -1 \\\\ +1 \\\\ 0 \\end{pmatrix}$$ corresponding to $\\text{ATP}^{4-} + \\text{H}_{2}\\text{O} \\rightarrow \\text{ADP}^{3-} + \\text{HPO}_{4}^{2-}$ (omitting the proton).\n\nStarting from the fundamental conservation principles of mass (elemental atoms are neither created nor destroyed) and charge (net electric charge is conserved), derive why the constraint $E\\,\\nu^{(j)}=\\mathbf{0}$ must hold for any physically admissible reaction column $\\nu^{(j)}$. Using the provided $E$ and $\\nu^{(1)},\\nu^{(2)}$, compute the imbalance vectors $b^{(1)}=E\\,\\nu^{(1)}$ and $b^{(2)}=E\\,\\nu^{(2)}$. Then, quantify the violation in $R_{2}$ by computing the $L_{1}$ norm $\\|b^{(2)}\\|_{1}$ (the sum of absolute values across all entries of $b^{(2)}$). Express your final scalar imbalance measure as an exact integer with no units. No rounding is required.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of mass and charge conservation, well-posed with all necessary information provided, and objective in its formulation. We will proceed with the solution.\n\nThe first task is to derive the constraint $E\\,\\nu^{(j)}=\\mathbf{0}$ from fundamental principles. A chemical reaction is a process that transforms a set of reactant metabolites into a set of product metabolites. The fundamental principles of conservation of mass and charge dictate that the total count of each element's atoms and the total net charge must be the same before and after the reaction.\n\nLet the set of metabolites in the system be indexed by $i=1, \\dots, m$, and the set of conserved entities (atomic elements and charge) be indexed by $k=1, \\dots, p$. The composition matrix, $E$, is a $p \\times m$ matrix where the entry $E_{ki}$ represents the number of atoms of element $k$ (or the charge, if $k$ corresponds to charge) in one molecule of metabolite $i$.\n\nA reaction $j$ is described by a stoichiometric vector $\\nu^{(j)}$, which is an $m$-dimensional column vector. The entry $\\nu_i^{(j)}$ is the stoichiometric coefficient of metabolite $i$ in reaction $j$. By convention, $\\nu_i^{(j)} < 0$ for reactants and $\\nu_i^{(j)} > 0$ for products.\n\nFor a given reaction $j$, the total amount of entity $k$ consumed is the sum over all reactants:\n$$ \\text{Total } k \\text{ consumed} = \\sum_{i \\text{ where } \\nu_i^{(j)} < 0} E_{ki} \\cdot | \\nu_i^{(j)} | = - \\sum_{i \\text{ where } \\nu_i^{(j)} < 0} E_{ki} \\nu_i^{(j)} $$\nThe total amount of entity $k$ produced is the sum over all products:\n$$ \\text{Total } k \\text{ produced} = \\sum_{i \\text{ where } \\nu_i^{(j)} > 0} E_{ki} \\nu_i^{(j)} $$\nThe law of conservation for entity $k$ requires that the amount consumed equals the amount produced:\n$$ - \\sum_{i \\text{ where } \\nu_i^{(j)} < 0} E_{ki} \\nu_i^{(j)} = \\sum_{i \\text{ where } \\nu_i^{(j)} > 0} E_{ki} \\nu_i^{(j)} $$\nRearranging this equation yields:\n$$ \\sum_{i \\text{ where } \\nu_i^{(j)} > 0} E_{ki} \\nu_i^{(j)} + \\sum_{i \\text{ where } \\nu_i^{(j)} < 0} E_{ki} \\nu_i^{(j)} = 0 $$\nThis sum can be written more compactly as a single sum over all metabolites $i=1, \\dots, m$:\n$$ \\sum_{i=1}^{m} E_{ki} \\nu_i^{(j)} = 0 $$\nThis equation represents the $k$-th row of the matrix-vector product $E\\nu^{(j)}$. Since this must hold for all conserved entities $k=1, \\dots, p$, the entire product vector must be the zero vector:\n$$ E\\nu^{(j)} = \\mathbf{0} $$\nThis demonstrates that any physically and chemically valid reaction must satisfy this null-space relationship.\n\nNext, we construct the composition matrix $E$ using the provided data for the metabolites in the order $\\mathcal{M}=\\{\\text{ATP}^{4-},\\ \\text{ADP}^{3-},\\ \\text{H}_{2}\\text{O},\\ \\text{HPO}_{4}^{2-},\\ \\text{H}^{+}\\}$ and elements in the order $\\{ \\text{C}, \\text{H}, \\text{N}, \\text{O}, \\text{P}, q \\}$.\n$$ E = \\begin{pmatrix} 10 & 10 & 0 & 0 & 0 \\\\ 12 & 12 & 2 & 1 & 1 \\\\ 5 & 5 & 0 & 0 & 0 \\\\ 13 & 10 & 1 & 4 & 0 \\\\ 3 & 2 & 0 & 1 & 0 \\\\ -4 & -3 & 0 & -2 & 1 \\end{pmatrix} $$\nThe reaction vectors are given as:\n$$ \\nu^{(1)} = \\begin{pmatrix} -1 \\\\ 1 \\\\ -1 \\\\ 1 \\\\ 1 \\end{pmatrix} \\quad \\text{and} \\quad \\nu^{(2)} = \\begin{pmatrix} -1 \\\\ 1 \\\\ -1 \\\\ 1 \\\\ 0 \\end{pmatrix} $$\nNow we compute the imbalance vectors $b^{(1)} = E\\nu^{(1)}$ and $b^{(2)} = E\\nu^{(2)}$.\n\nFor the correct reaction $R_1$:\n$$ b^{(1)} = E\\nu^{(1)} = \\begin{pmatrix} 10 & 10 & 0 & 0 & 0 \\\\ 12 & 12 & 2 & 1 & 1 \\\\ 5 & 5 & 0 & 0 & 0 \\\\ 13 & 10 & 1 & 4 & 0 \\\\ 3 & 2 & 0 & 1 & 0 \\\\ -4 & -3 & 0 & -2 & 1 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 1 \\\\ -1 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} (10)(-1) + (10)(1) \\\\ (12)(-1) + (12)(1) + (2)(-1) + (1)(1) + (1)(1) \\\\ (5)(-1) + (5)(1) \\\\ (13)(-1) + (10)(1) + (1)(-1) + (4)(1) \\\\ (3)(-1) + (2)(1) + (0)(-1) + (1)(1) + (0)(1) \\\\ (-4)(-1) + (-3)(1) + (0)(-1) + (-2)(1) + (1)(1) \\end{pmatrix} $$\n$$ b^{(1)} = \\begin{pmatrix} -10+10 \\\\ -12+12-2+1+1 \\\\ -5+5 \\\\ -13+10-1+4 \\\\ -3+2+1 \\\\ 4-3-2+1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\nAs expected, the imbalance vector for the correct reaction is the zero vector, $b^{(1)}=\\mathbf{0}$, satisfying the conservation constraint.\n\nFor the erroneous reaction $R_2$:\n$$ b^{(2)} = E\\nu^{(2)} = \\begin{pmatrix} 10 & 10 & 0 & 0 & 0 \\\\ 12 & 12 & 2 & 1 & 1 \\\\ 5 & 5 & 0 & 0 & 0 \\\\ 13 & 10 & 1 & 4 & 0 \\\\ 3 & 2 & 0 & 1 & 0 \\\\ -4 & -3 & 0 & -2 & 1 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 1 \\\\ -1 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} (10)(-1) + (10)(1) \\\\ (12)(-1) + (12)(1) + (2)(-1) + (1)(1) + (1)(0) \\\\ (5)(-1) + (5)(1) \\\\ (13)(-1) + (10)(1) + (1)(-1) + (4)(1) \\\\ (3)(-1) + (2)(1) + (0)(-1) + (1)(1) + (0)(0) \\\\ (-4)(-1) + (-3)(1) + (0)(-1) + (-2)(1) + (1)(0) \\end{pmatrix} $$\n$$ b^{(2)} = \\begin{pmatrix} -10+10 \\\\ -12+12-2+1 \\\\ -5+5 \\\\ -13+10-1+4 \\\\ -3+2+1 \\\\ 4-3-2 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ -1 \\end{pmatrix} $$\nThe imbalance vector $b^{(2)}$ is non-zero. The entry $-1$ in the second row (Hydrogen) and the entry $-1$ in the sixth row (charge) indicate that the reaction is not balanced: it results in a net loss of one hydrogen atom and one unit of positive charge.\n\nFinally, we quantify this violation by computing the $L_1$ norm of $b^{(2)}$. The $L_1$ norm of a vector is the sum of the absolute values of its components.\n$$ \\|b^{(2)}\\|_{1} = \\sum_{k=1}^{6} |b_k^{(2)}| = |0| + |-1| + |0| + |0| + |0| + |-1| = 0 + 1 + 0 + 0 + 0 + 1 = 2 $$\nThe total imbalance, as measured by the $L_1$ norm, is $2$.",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "Once a metabolic network is constructed and validated, we can use it to predict cellular behavior under different conditions through Flux Balance Analysis (FBA). This practice guides you through setting up and solving a classic FBA problem to maximize an objective, such as ATP production, which is central to understanding metabolic disorders . Critically, this exercise goes beyond just finding an optimal flux distribution by introducing the concept of shadow prices, the dual variables of the optimization problem, which provide invaluable insight into how the availability of specific metabolites limits the network's performance.",
            "id": "4390696",
            "problem": "Consider a steady-state metabolic network described by stoichiometric mass conservation. At steady state the net production and consumption of each metabolite must balance, which is represented by the linear constraints $S v = b$, where $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix, $v \\in \\mathbb{R}^n$ is the vector of reaction fluxes, and $b \\in \\mathbb{R}^m$ is the right-hand side vector representing any net supply or demand of metabolites (for a closed intracellular network, $b$ is the zero vector). Flux Balance Analysis (FBA) selects fluxes consistent with mass balance and bound constraints that optimize a linear objective $c^\\top v$, where $c \\in \\mathbb{R}^n$.\n\nYou will implement and solve an FBA problem for a simplified glycolysisâ€“lactate network relevant to metabolic disorders, with metabolite rows ordered as $\\{\\text{Glc}, \\text{Pyr}, \\text{Lac}, \\text{ATP}\\}$ and reaction columns ordered as $\\{v_1, v_2, v_3, v_4, v_5, v_6\\}$. All fluxes must be expressed in $\\text{mmol}\\ \\text{gDW}^{-1}\\ \\text{h}^{-1}$.\n\nThe stoichiometric matrix $S$ and objective vector $c$ are:\n$$\nS = \n\\begin{bmatrix}\n+1 & -1 & 0 & 0 & 0 & 0 \\\\\n0 & +2 & -1 & -1 & 0 & 0 \\\\\n0 & 0 & +1 & 0 & -1 & 0 \\\\\n0 & +2 & 0 & 0 & 0 & -1\n\\end{bmatrix},\\quad\nc = \n\\begin{bmatrix}\n0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 1\n\\end{bmatrix}.\n$$\nThe reactions represent:\n- $v_1$: glucose uptake (external to intracellular glucose),\n- $v_2$: glycolysis (glucose to pyruvate and adenosine triphosphate),\n- $v_3$: lactate dehydrogenase (pyruvate to lactate),\n- $v_4$: mitochondrial pyruvate consumption (pyruvate sink),\n- $v_5$: lactate export (intracellular lactate to external),\n- $v_6$: adenosine triphosphate maintenance (adenosine triphosphate consumption).\n\nThe constraints are $S v = b$ with $b = 0$ (the zero vector of length $4$) and reaction-wise bounds:\n- $0 \\le v_1 \\le G_{\\max}$,\n- $0 \\le v_2 \\le 1000$,\n- $0 \\le v_3 \\le 1000$,\n- $0 \\le v_4 \\le U_{\\text{mito}}$,\n- $0 \\le v_5 \\le L_{\\max}$,\n- $m_{\\min} \\le v_6 \\le 1000$.\n\nThe objective is to maximize adenosine triphosphate maintenance flux, that is to maximize $c^\\top v = v_6$.\n\nYour program must:\n1. Formulate the linear program for each test case as a minimization of $-c^\\top v$ subject to $S v = b$ and the bounds above, solve for the optimal flux vector $v^\\star$, and compute the associated dual variables for the equality constraints. Interpret these dual variables as shadow prices on metabolites, defined as the sensitivity of the optimal objective value with respect to marginal changes in $b$; for the minimization of $-c^\\top v$, the shadow price vector for metabolites is $-\\lambda$, where $\\lambda$ are the equality-constraint dual variables returned by the solver.\n2. Validate the shadow price interpretation numerically: for each equality constraint $i \\in \\{1,2,3,4\\}$, perturb $b_i$ by a small $\\delta$ (in the same unit $\\text{mmol}\\ \\text{gDW}^{-1}\\ \\text{h}^{-1}$), re-solve the linear program, and compare the measured change in the maximized objective $c^\\top v$ to the predicted change given by the shadow price. Use $\\delta = 10^{-6}$ and report absolute errors.\n\nTest suite:\n- Case A (happy path, multiple active limits): $G_{\\max} = 10$, $U_{\\text{mito}} = 6$, $L_{\\max} = 5$, $m_{\\min} = 0.1$.\n- Case B (boundary condition, mitochondrial shutdown): $G_{\\max} = 10$, $U_{\\text{mito}} = 0$, $L_{\\max} = 8$, $m_{\\min} = 0.1$.\n- Case C (edge case, uptake-limited with abundant disposal capacity): $G_{\\max} = 3$, $U_{\\text{mito}} = 100$, $L_{\\max} = 100$, $m_{\\min} = 0.1$.\n\nOutput specification:\n- For each test case, output a list with three elements:\n    1. The optimal flux vector $v^\\star$ as a list of six floats in $\\text{mmol}\\ \\text{gDW}^{-1}\\ \\text{h}^{-1}$.\n    2. The metabolite shadow prices (a list of four floats), defined as the sensitivity of the maximized objective $c^\\top v$ to a unit increase in each component of $b$.\n    3. The absolute error list (four floats) comparing predicted versus measured objective changes under the perturbations by $\\delta$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets; specifically, the output must be a list of the three per-case lists described above, for Cases A, B, and C, in that order (for example, formatted as a nested list like \"[[...],[...],[...]]\").\n\nAll computations must be scientifically sound and reproducible. No external input is permitted. All outputs must be numerical lists of floats, expressed implicitly in $\\text{mmol}\\ \\text{gDW}^{-1}\\ \\text{h}^{-1}$ for fluxes and in the same units per unit perturbation for shadow price interpretations (dimensionless as a ratio of flux change to flux perturbation).",
            "solution": "The user has provided a problem in the domain of computational systems biology, specifically requiring the application of Flux Balance Analysis (FBA) to a simplified metabolic network. The problem is scientifically and mathematically well-defined, and all necessary data and constraints for its resolution are provided. It is a valid problem.\n\nThe problem requires the formulation and solution of a linear programming (LP) problem to determine the optimal metabolic fluxes in a simplified model of glycolysis and associated pathways. We are asked to maximize the flux through the ATP maintenance reaction ($v_6$), subject to stoichiometric mass balance constraints and reaction flux bounds. Furthermore, we must calculate the shadow prices of the metabolites and numerically validate their interpretation.\n\nThe problem formulation as a linear program is as follows:\n\nObjective Function:\nMaximize $Z = c^\\top v$, where the objective vector is $c = [0, 0, 0, 0, 0, 1]^\\top \\in \\mathbb{R}^6$ and $v \\in \\mathbb{R}^6$ is the vector of reaction fluxes. This is equivalent to maximizing the scalar flux $v_6$. Standard LP solvers are typically designed for minimization problems. Therefore, we reformulate the objective as the minimization of $-Z = -c^\\top v$. The objective vector for the minimization problem is $c_{\\min} = -c = [0, 0, 0, 0, 0, -1]^\\top$.\n\nConstraints:\n1.  Equality Constraints: The system is at a steady state, meaning the production and consumption of each internal metabolite must balance. This is expressed by the linear system $S v = b$, where $S \\in \\mathbb{R}^{4 \\times 6}$ is the stoichiometric matrix, and $b \\in \\mathbb{R}^4$ is the vector of net metabolite exchange fluxes with the environment. For the closed intracellular network specified, $b$ is the zero vector, $b = [0, 0, 0, 0]^\\top$. The full equality constraint is:\n    $$\n    S v =\n    \\begin{bmatrix}\n    +1 & -1 & 0 & 0 & 0 & 0 \\\\\n    0 & +2 & -1 & -1 & 0 & 0 \\\\\n    0 & 0 & +1 & 0 & -1 & 0 \\\\\n    0 & +2 & 0 & 0 & 0 & -1\n    \\end{bmatrix}\n    \\begin{bmatrix} v_1 \\\\ v_2 \\\\ v_3 \\\\ v_4 \\\\ v_5 \\\\ v_6 \\end{bmatrix}\n    =\n    \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix}\n    $$\n    The rows correspond to the metabolites $\\{\\text{Glc}, \\text{Pyr}, \\text{Lac}, \\text{ATP}\\}$.\n\n2.  Inequality (Bound) Constraints: Each reaction flux $v_i$ is constrained to lie within a given range, $l_i \\le v_i \\le u_i$. The lower bound vector $l \\in \\mathbb{R}^6$ and upper bound vector $u \\in \\mathbb{R}^6$ are determined by the parameters of each test case:\n    $$\n    l = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ m_{\\min} \\end{bmatrix}, \\quad\n    u = \\begin{bmatrix} G_{\\max} \\\\ 1000 \\\\ 1000 \\\\ U_{\\text{mito}} \\\\ L_{\\max} \\\\ 1000 \\end{bmatrix}\n    $$\n    where $G_{\\max}$, $U_{\\text{mito}}$, $L_{\\max}$, and $m_{\\min}$ are provided for each test case.\n\nShadow Prices and Dual Variables:\nThe solution to the LP yields not only the optimal primal solution $v^\\star$ but also the optimal dual solution $\\lambda^\\star \\in \\mathbb{R}^4$, which corresponds to the dual variables (or Lagrange multipliers) for the equality constraints $S v = b$. For a minimization problem, the dual variable $\\lambda^\\star_i$ represents the sensitivity of the optimal objective value ($-c^\\top v^\\star$) to a small change in the right-hand side of the $i$-th constraint, $b_i$.\n$$\n\\lambda^\\star_i = \\frac{\\partial(-c^\\top v^\\star)}{\\partial b_i}\n$$\nThe problem defines the metabolite shadow price, $\\pi_i$, as the sensitivity of the original maximized objective, $c^\\top v^\\star$, to a change in $b_i$. The relationship is therefore:\n$$\n\\pi_i = \\frac{\\partial(c^\\top v^\\star)}{\\partial b_i} = -\\frac{\\partial(-c^\\top v^\\star)}{\\partial b_i} = -\\lambda_i^\\star\n$$\nThe vector of shadow prices is $\\pi = -\\lambda^\\star$.\n\nNumerical Validation:\nTo validate this interpretation, we perform a sensitivity analysis. For each metabolite $i$, we perturb the corresponding right-hand side element $b_i$ by a small amount $\\delta = 10^{-6}$ and re-solve the LP.\n- The new constraint is $S v = b^{\\text{pert}}$, where $b^{\\text{pert}}_j = \\delta$ if $j=i$, and $b^{\\text{pert}}_j = 0$ otherwise.\n- Let $Z^\\star = c^\\top v^\\star$ be the original optimal objective value and $Z^\\star_{\\text{pert}}$ be the new optimal objective value under perturbation.\n- The measured change is $\\Delta Z_{\\text{measured}} = Z^\\star_{\\text{pert}} - Z^\\star$.\n- The predicted change from the shadow price is $\\Delta Z_{\\text{predicted}} = \\pi_i \\times \\delta$.\n- The absolute error, $|\\Delta Z_{\\text{measured}} - \\Delta Z_{\\text{predicted}}|$, should be close to zero, confirming the validity of the shadow price.\n\nImplementation:\nThe solution is implemented in Python using the `numpy` library for matrix and vector operations and `scipy.optimize.linprog` to solve the linear programming problem. A function is defined to encapsulate the logic for a single test case. This function:\n1.  Constructs the LP problem (objective vector, constraint matrix, and bounds) from the input parameters.\n2.  Calls `linprog` to find the optimal flux vector $v^\\star$ and the equality constraint duals $\\lambda$.\n3.  Calculates the shadow prices $\\pi = -\\lambda$.\n4.  Iteratively perturbs each component of $b$, re-solves the LP, and computes the absolute error between the measured change in the objective function and the change predicted by the shadow price.\n5.  Returns the optimal flux vector, the shadow price vector, and the vector of validation errors.\n\nThe main script defines the parameters for the three test cases, calls the solver function for each, and formats the collected results into the specified nested list structure for the final output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef format_list(data):\n    \"\"\"\n    Recursively formats a list into a string without spaces,\n    to match the exact output specification.\n    \"\"\"\n    if isinstance(data, list):\n        return '[' + ','.join(format_list(item) for item in data) + ']'\n    else:\n        # Using str() for floats, which may use scientific notation for small numbers.\n        return str(data)\n\ndef solve_fba_case(G_max, U_mito, L_max, m_min):\n    \"\"\"\n    Solves the FBA problem for a given set of parameters.\n\n    Args:\n        G_max (float): Maximum glucose uptake flux.\n        U_mito (float): Maximum mitochondrial pyruvate consumption flux.\n        L_max (float): Maximum lactate export flux.\n        m_min (float): Minimum ATP maintenance flux.\n\n    Returns:\n        tuple: A tuple containing:\n            - v_star (list): The optimal flux vector.\n            - shadow_prices (list): The metabolite shadow prices.\n            - errors (list): The absolute errors from numerical validation.\n    \"\"\"\n    # Stoichiometric matrix S (m x n)\n    # m=4 metabolites: Glc, Pyr, Lac, ATP\n    # n=6 reactions: v1..v6\n    S = np.array([\n        [1., -1., 0., 0., 0., 0.],  # Glc balance\n        [0., 2., -1., -1., 0., 0.],  # Pyr balance\n        [0., 0., 1., 0., -1., 0.],  # Lac balance\n        [0., 2., 0., 0., 0., -1.]   # ATP balance\n    ])\n\n    # Right-hand side vector b for Sv = b\n    b_eq = np.zeros(S.shape[0])\n\n    # Objective function vector (minimize -v6)\n    c_obj = np.array([0., 0., 0., 0., 0., -1.])\n\n    # Flux bounds (lower, upper)\n    bounds = [\n        (0., G_max),       # v1: glucose uptake\n        (0., 1000.),      # v2: glycolysis\n        (0., 1000.),      # v3: lactate dehydrogenase\n        (0., U_mito),     # v4: mitochondrial pyruvate consumption\n        (0., L_max),      # v5: lactate export\n        (m_min, 1000.)    # v6: ATP maintenance\n    ]\n\n    # Solve the base linear programming problem\n    res = linprog(c=c_obj, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n    if not res.success:\n        # This should not happen for the given problem cases.\n        raise RuntimeError(f\"LP solver failed for case with G_max={G_max}, U_mito={U_mito}\")\n\n    v_star = res.x\n    # The objective value from the solver is min(-v6) = -max(v6).\n    # So, the maximized objective is -res.fun.\n    obj_star_maximized = -res.fun\n\n    # Dual variables (lambda) for equality constraints Sv = b\n    # These are the sensitivities of the minimized objective (-v6) to changes in b.\n    duals_lambda = res.eqlin.marginals\n\n    # Shadow prices (pi) are sensitivities of the maximized objective (+v6)\n    # pi = d(v6)/db = -d(-v6)/db = -lambda\n    shadow_prices = -duals_lambda\n\n    # --- Numerical Validation of Shadow Prices ---\n    delta = 1e-6\n    validation_errors = []\n    num_metabolites = S.shape[0]\n\n    for i in range(num_metabolites):\n        # Create a perturbed b vector\n        b_pert = np.zeros(num_metabolites)\n        b_pert[i] = delta\n\n        # Re-solve the LP with the perturbed b\n        res_pert = linprog(c=c_obj, A_eq=S, b_eq=b_pert, bounds=bounds, method='highs')\n        obj_pert_maximized = -res_pert.fun\n        \n        # Calculate measured vs. predicted change\n        measured_change = obj_pert_maximized - obj_star_maximized\n        predicted_change = shadow_prices[i] * delta\n        \n        # Calculate absolute error\n        error = abs(measured_change - predicted_change)\n        validation_errors.append(error)\n\n    return v_star.tolist(), shadow_prices.tolist(), validation_errors\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results in the required format.\n    \"\"\"\n    # Test cases parameters\n    test_cases = [\n        # Case A (happy path, multiple active limits)\n        {'G_max': 10., 'U_mito': 6., 'L_max': 5., 'm_min': 0.1},\n        # Case B (boundary condition, mitochondrial shutdown)\n        {'G_max': 10., 'U_mito': 0., 'L_max': 8., 'm_min': 0.1},\n        # Case C (edge case, uptake-limited)\n        {'G_max': 3., 'U_mito': 100., 'L_max': 100., 'm_min': 0.1}\n    ]\n\n    all_results = []\n    for params in test_cases:\n        v_star, sp, errors = solve_fba_case(**params)\n        all_results.append([v_star, sp, errors])\n\n    # Format the final output string as a nested list without spaces.\n    # e.g., [[v_list_A,p_list_A,e_list_A],[v_list_B,p_list_B,e_list_B],...]\n    print(format_list(all_results))\n\nsolve()\n```"
        },
        {
            "introduction": "Biological systems rarely optimize for a single objective; more often, they navigate complex trade-offs between competing goals, such as maximizing growth versus minimizing resource expenditure. This practice introduces multi-objective optimization by tasking you with computing the Pareto front for a model that trades off biomass production against the total metabolic flux, a proxy for enzymatic cost . By applying the $\\varepsilon$-constraint method, you will learn to map the spectrum of optimal metabolic strategies, providing a richer, more realistic view of cellular decision-making than single-objective optimization alone.",
            "id": "4390630",
            "problem": "You are given a small, abstract metabolic network intended to model the trade-off between biomass production and minimal total flux in a steady-state system. The network is constrained by a stoichiometric balance of internal metabolites and an upper bound on substrate uptake. Your task is to compute the Pareto front between maximizing biomass production and minimizing total flux using a principled optimization approach and produce numerical outputs that are directly testable. All fluxes must be expressed in mmol per gram dry weight per hour (mmol/gDW/h).\n\nFundamental base:\n- Mass balance at steady state imposes that the net production rate of each internal metabolite is zero. If $S$ is the stoichiometric matrix and $v$ is the flux vector, then $$S\\,v = 0.$$\n- Flux Balance Analysis (FBA) models use linear constraints and objective functions. Maximizing biomass production can be posed as maximizing a biomass flux $v_{\\mathrm{bio}}$, while minimizing total flux can be posed as minimizing the $L_1$ norm of $v$, which equals $\\sum_i v_i$ when all fluxes are constrained to be nonnegative.\n- Exchange and pseudo-metabolite reactions (such as substrate uptake and biomass formation) are commonly modeled without mass balance for external pools or pseudo-metabolites; only internal metabolites are balanced.\n\nNetwork definition:\n- Internal metabolites: $S$ (substrate), $A$, $B$.\n- Reactions (all irreversible, $v_i \\ge 0$):\n  1. Uptake: external source $\\rightarrow S$ with flux $v_1$ and upper bound $v_1 \\le V_{\\max}$.\n  2. Conversion(s) $S \\rightarrow A$: there may be one or two parallel pathways indexed by $k$, with fluxes $v_{2,k}$ and substrate stoichiometric costs $\\sigma_{A,k} \\in \\{1,2\\}$ meaning $S$ consumption per unit $A$ produced in pathway $k$.\n  3. Conversion $S \\rightarrow B$ with flux $v_3$.\n  4. Biomass formation: $a\\,A + b\\,B \\rightarrow \\text{biomass}$ with flux $v_4$; biomass is a pseudo-drain (not mass-balanced).\n  5. Waste drains: $A \\rightarrow \\text{waste}$ with flux $v_5$, $B \\rightarrow \\text{waste}$ with flux $v_6$, $S \\rightarrow \\text{waste}$ with flux $v_7$.\n\nSteady-state mass balance constraints for internal metabolites:\n- Substrate: $$v_1 - \\sum_k \\sigma_{A,k}\\, v_{2,k} - v_3 - v_7 = 0.$$\n- Metabolite $A$: $$\\sum_k v_{2,k} - a\\, v_4 - v_5 = 0.$$\n- Metabolite $B$: $$v_3 - b\\, v_4 - v_6 = 0.$$\n\nOptimization framework:\n- Biomass production is represented by $v_4$ and is to be maximized.\n- Total flux to be minimized is the $L_1$ norm $\\sum_i v_i$, which here is simply $\\sum_i v_i$ because all fluxes are nonnegative.\n- To construct a Pareto front, use an $\\varepsilon$-constraint method: for a set of biomass targets $B_t$, minimize total flux subject to $v_4 \\ge B_t$ as well as the mass balance and bounds. The set of resulting points $\\{(v_4^\\star, \\sum_i v_i^\\star)\\}$ approximates the Pareto front of biomass versus minimal total flux.\n\nYour program must:\n1. Implement the above model for the following test suite of four cases, each defined by $(V_{\\max}, a, b, \\{\\sigma_{A,k}\\})$. For all cases, bounds are $v_i \\ge 0$ for every flux, with $v_1 \\le V_{\\max}$ and all other $v_i$ having a sufficiently large upper bound (e.g., $10^6$).\n   - Case $1$ (happy path): $(V_{\\max} = 10, a = 1, b = 1, \\{\\sigma_{A,1} = 1\\})$; single pathway $S \\rightarrow A$ with unit substrate cost; biomass requires $1\\,A + 1\\,B$.\n   - Case $2$ (altered stoichiometry): $(V_{\\max} = 10, a = 2, b = 1, \\{\\sigma_{A,1} = 1\\})$; biomass requires $2\\,A + 1\\,B$.\n   - Case $3$ (parallel $A$ pathways): $(V_{\\max} = 10, a = 1, b = 1, \\{\\sigma_{A,1} = 1, \\sigma_{A,2} = 2\\})$; two pathways $S \\rightarrow A$ with different substrate costs.\n   - Case $4$ (boundary condition): $(V_{\\max} = 0, a = 1, b = 1, \\{\\sigma_{A,1} = 1\\})$; no substrate uptake possible.\n\n2. For each case:\n   - First compute the maximum biomass $v_4^{\\max}$ by maximizing $v_4$ subject to the constraints. Implement this as a linear program by minimizing $-v_4$.\n   - Construct an evenly spaced set of $K$ biomass targets $B_t$ from $0$ to $v_4^{\\max}$ inclusive. Use $K = 6$ when $v_4^{\\max} > 0$ and $K = 1$ when $v_4^{\\max} = 0$.\n   - For each $B_t$, minimize the total flux $\\sum_i v_i$ subject to $v_4 \\ge B_t$ and the constraints, and record the pair $(v_4^\\star, T^\\star)$ where $v_4^\\star$ is the optimal biomass flux and $T^\\star$ is the minimal total flux. All flux values must be in mmol/gDW/h as floats.\n\n3. Output format:\n   - Your program should produce a single line of output containing the results for the four cases as a JSON-like nested list of lists. Each case result must be a list of ordered pairs $[b, t]$, where $b$ is the biomass flux $v_4^\\star$ and $t$ is the minimal total flux $\\sum_i v_i^\\star$, both as floats in mmol/gDW/h.\n   - For example, an output with two points for one case would look like: $[[b_1,t_1],[b_2,t_2]]$. The overall output must aggregate the four case results in order as $[case_1,case_2,case_3,case_4]$ and be printed on a single line, such as $\"[[[b_{11},t_{11}],\\dots],[\\dots],[\\dots],[\\dots]]\"$ where each $b_{ij}$ and $t_{ij}$ are floats.\n\nThe solution must be expressed in purely mathematical and logical terms, with the above units and format strictly enforced. Angles are not used. Percentages must not be used; any fractional quantities should be expressed as decimals or rational numbers if needed.",
            "solution": "The problem is valid. It concerns the computation of a Pareto front for a bi-objective optimization problem in a metabolic network, a standard task in systems biology. The network, constraints, and optimization procedure are scientifically sound, well-posed, objective, and completely specified. The solution involves applying Flux Balance Analysis (FBA) and the $\\varepsilon$-constraint method, which are formulated as a series of linear programs (LPs).\n\nThe core of the model is the steady-state mass balance equation $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of reaction fluxes. The fluxes are all non-negative, $v_i \\ge 0$, and the substrate uptake flux $v_1$ is bounded by $v_1 \\le V_{\\max}$.\n\nThe flux vector $v$ and the matrix $S$ vary depending on the number of pathways for the $S \\rightarrow A$ conversion.\n\nFor a single pathway ($k=1$), as in Cases $1$, $2$, and $4$, the flux vector is $v = [v_1, v_2, v_3, v_4, v_5, v_6, v_7]^T$. The mass balance equations are:\n$$\n\\begin{cases}\nv_1 - \\sigma_{A,1} v_2 - v_3 - v_7 = 0 & \\text{(for metabolite S)} \\\\\nv_2 - a v_4 - v_5 = 0 & \\text{(for metabolite A)} \\\\\nv_3 - b v_4 - v_6 = 0 & \\text{(for metabolite B)}\n\\end{cases}\n$$\nThese can be written as $A_{eq} v = b_{eq}$ where $b_{eq} = [0, 0, 0]^T$ and\n$$\nA_{eq} = \\begin{pmatrix}\n1 & -\\sigma_{A,1} & -1 & 0 & 0 & 0 & -1 \\\\\n0 & 1 & 0 & -a & -1 & 0 & 0 \\\\\n0 & 0 & 1 & -b & 0 & -1 & 0\n\\end{pmatrix}\n$$\n\nFor two parallel pathways ($k=1, 2$), as in Case $3$, the flux vector is $v = [v_1, v_{2,1}, v_{2,2}, v_3, v_4, v_5, v_6, v_7]^T$. The mass balance equations are:\n$$\n\\begin{cases}\nv_1 - \\sigma_{A,1} v_{2,1} - \\sigma_{A,2} v_{2,2} - v_3 - v_7 = 0 & \\text{(for S)} \\\\\nv_{2,1} + v_{2,2} - a v_4 - v_5 = 0 & \\text{(for A)} \\\\\nv_3 - b v_4 - v_6 = 0 & \\text{(for B)}\n\\end{cases}\n$$\nThe corresponding stoichiometric matrix for the equality constraints is:\n$$\nA_{eq} = \\begin{pmatrix}\n1 & -\\sigma_{A,1} & -\\sigma_{A,2} & -1 & 0 & 0 & 0 & -1 \\\\\n0 & 1 & 1 & 0 & -a & -1 & 0 & 0 \\\\\n0 & 0 & 0 & 1 & -b & 0 & -1 & 0\n\\end{pmatrix}\n$$\n\nThe solution proceeds in two stages for each case.\n\n**Stage 1: Determine Maximum Biomass ($v_4^{\\max}$)**\nThis is an LP problem:\n- Objective: Maximize $v_4$, or equivalently, minimize $c^T v$ where $c$ is a vector with $-1$ at the position of $v_4$ and $0$ elsewhere.\n- Constraints: $A_{eq} v = b_{eq}$, $v_i \\ge 0$, and $v_1 \\le V_{\\max}$.\n\n**Stage 2: Compute Pareto Front**\nA set of $K$ biomass targets, $B_t$, is generated, evenly spaced from $0$ to $v_4^{\\max}$. For each $B_t$, a second LP is solved:\n- Objective: Minimize total flux $T = \\sum_i v_i$. The objective vector $c$ is a vector of ones.\n- Constraints: All constraints from Stage 1, plus the $\\varepsilon$-constraint $v_4 \\ge B_t$.\n\nAnalytically, to minimize total flux, the system must operate with maximum efficiency. This means waste fluxes ($v_5, v_6, v_7$) should be zero, and the most substrate-efficient pathways should be used. For a given biomass production $v_4 = B_t$, the necessary fluxes are determined by the stoichiometry, and the resulting minimum total flux can be calculated. The optimal solution will always satisfy $v_4^\\star = B_t$ because any production exceeding the target ($v_4 > B_t$) would require larger input fluxes, thus increasing the total flux sum.\n\n**Case 1:** $(V_{\\max} = 10, a = 1, b = 1, \\{\\sigma_{A,1} = 1\\})$\n- **Max Biomass:** To produce $1$ unit of biomass, $1$ unit of $A$ and $1$ unit of $B$ are needed. Producing $1A$ costs $\\sigma_{A,1}=1$ unit of $S$. Producing $1B$ costs $1$ unit of $S$. Total substrate cost per biomass is $1+1=2$ units of $S$. With $v_1 \\le 10$, the maximum biomass is $v_4^{\\max} = 10 / 2 = 5$.\n- **Pareto Front:** $K=6$ targets are $B_t \\in \\{0, 1, 2, 3, 4, 5\\}$. For a target $B_t$, the efficient fluxes are $v_4=B_t$, $v_2=B_t$, $v_3=B_t$, $v_1=2B_t$. The total flux is $T^\\star = v_1+v_2+v_3+v_4 = 2B_t+B_t+B_t+B_t = 5B_t$. The points are $(0, 0), (1, 5), (2, 10), (3, 15), (4, 20), (5, 25)$.\n\n**Case 2:** $(V_{\\max} = 10, a = 2, b = 1, \\{\\sigma_{A,1} = 1\\})$\n- **Max Biomass:** To produce $1$ biomass, $2A$ and $1B$ are needed. Substrate cost is $(2 \\times \\sigma_{A,1}) + 1 = (2 \\times 1) + 1 = 3$. With $v_1 \\le 10$, $v_4^{\\max} = 10 / 3$.\n- **Pareto Front:** $K=6$ targets are $B_t = i \\cdot \\frac{10/3}{5} = i \\cdot \\frac{2}{3}$ for $i=0,...,5$. For a target $B_t$, fluxes are $v_4=B_t$, $v_2=2B_t$, $v_3=B_t$, $v_1=3B_t$. The total flux is $T^\\star = 3B_t+2B_t+B_t+B_t = 7B_t$.\n\n**Case 3:** $(V_{\\max} = 10, a = 1, b = 1, \\{\\sigma_{A,1} = 1, \\sigma_{A,2} = 2\\})$\n- **Max Biomass:** The two pathways to produce $A$ have costs $\\sigma_{A,1}=1$ and $\\sigma_{A,2}=2$. To maximize biomass, the most efficient (lowest cost) pathway must be used exclusively ($v_{2,1} > 0, v_{2,2}=0$). The problem reduces to Case 1. $v_4^{\\max} = 5$.\n- **Pareto Front:** To minimize total flux for any given $B_t$, the most efficient pathway must also be used. The analysis and results are identical to Case 1.\n\n**Case 4:** $(V_{\\max} = 0, a = 1, b = 1, \\{\\sigma_{A,1} = 1\\})$\n- **Max Biomass:** $v_1 \\le 0$ and $v_1 \\ge 0$ implies $v_1=0$. No substrate can enter the system. From the mass balance equations, if all fluxes must be non-negative, the only possible solution is $v_i=0$ for all $i$. Thus, $v_4^{\\max} = 0$.\n- **Pareto Front:** $K=1$ target, $B_t=0$. The only solution is all fluxes being zero, so $T^\\star=0$. The only point is $(0, 0)$.\n\nThe following program implements this logic using `scipy.optimize.linprog` to solve the LPs numerically.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Main function to solve the metabolic modeling problem for all test cases.\n    \"\"\"\n    \n    test_cases = [\n        {'V_max': 10.0, 'a': 1.0, 'b': 1.0, 'sigmas': [1.0]},\n        {'V_max': 10.0, 'a': 2.0, 'b': 1.0, 'sigmas': [1.0]},\n        {'V_max': 10.0, 'a': 1.0, 'b': 1.0, 'sigmas': [1.0, 2.0]},\n        {'V_max': 0.0, 'a': 1.0, 'b': 1.0, 'sigmas': [1.0]},\n    ]\n\n    all_results = []\n    \n    for case_params in test_cases:\n        V_max = case_params['V_max']\n        a = case_params['a']\n        b = case_params['b']\n        sigmas = case_params['sigmas']\n        \n        num_s_to_a_pathways = len(sigmas)\n        # v = [v1, v2_1, ..., v2_k, v3, v4, v5, v6, v7]\n        # Total number of fluxes = 1(v1) + k(v2s) + 1(v3) + 1(v4) + 1(v5) + 1(v6) + 1(v7) = k + 6\n        num_fluxes = num_s_to_a_pathways + 6\n        v4_idx = num_s_to_a_pathways + 2\n\n        # A_eq * v = b_eq\n        A_eq = np.zeros((3, num_fluxes))\n        b_eq = np.zeros(3)\n\n        # Substrate balance: v1 - sum(sigma_k * v2_k) - v3 - v7 = 0\n        A_eq[0, 0] = 1.0\n        for i, sigma in enumerate(sigmas):\n            A_eq[0, 1 + i] = -sigma\n        A_eq[0, num_s_to_a_pathways + 1] = -1.0 # v3\n        A_eq[0, -1] = -1.0 # v7\n        \n        # Metabolite A balance: sum(v2_k) - a*v4 - v5 = 0\n        for i in range(num_s_to_a_pathways):\n            A_eq[1, 1 + i] = 1.0\n        A_eq[1, v4_idx] = -a # v4\n        A_eq[1, -3] = -1.0 # v5\n        \n        # Metabolite B balance: v3 - b*v4 - v6 = 0\n        A_eq[2, num_s_to_a_pathways + 1] = 1.0 # v3\n        A_eq[2, v4_idx] = -b # v4\n        A_eq[2, -2] = -1.0 # v6\n\n        # Bounds for fluxes\n        bounds = [(0, None)] * num_fluxes\n        bounds[0] = (0, V_max)\n\n        # Stage 1: Maximize biomass flux v4\n        c_max_bio = np.zeros(num_fluxes)\n        c_max_bio[v4_idx] = -1.0 # Minimize -v4 to maximize v4\n        \n        res_max_bio = linprog(c=c_max_bio, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        if not res_max_bio.success or res_max_bio.fun is None:\n             # Should not happen for valid problems, but as a safeguard\n            v4_max = 0.0\n        else:\n            v4_max = -res_max_bio.fun\n\n        # Generate biomass targets\n        if v4_max > 1e-9: # Use a tolerance for floating point\n            K = 6\n            biomass_targets = np.linspace(0, v4_max, K)\n        else:\n            K = 1\n            biomass_targets = np.array([0.0])\n\n        case_pareto_points = []\n        \n        # Stage 2: Minimize total flux for each biomass target\n        c_min_flux = np.ones(num_fluxes)\n        \n        for bt in biomass_targets:\n            # Add constraint v4 >= bt, which is -v4 <= -bt\n            A_ub = np.zeros((1, num_fluxes))\n            A_ub[0, v4_idx] = -1.0\n            b_ub = np.array([-bt])\n            \n            res_min_flux = linprog(c=c_min_flux, A_eq=A_eq, b_eq=b_eq, A_ub=A_ub, b_ub=b_ub, bounds=bounds, method='highs')\n\n            if res_min_flux.success:\n                v4_star = res_min_flux.x[v4_idx]\n                total_flux_star = res_min_flux.fun\n                \n                # Clamp small negative values to 0 due to precision issues\n                v4_star = max(0.0, v4_star)\n                total_flux_star = max(0.0, total_flux_star)\n                \n                case_pareto_points.append([float(f\"{v4_star:.10f}\"), float(f\"{total_flux_star:.10f}\")])\n\n        all_results.append(case_pareto_points)\n\n    # Format the final output string\n    case_strings = []\n    for result_list in all_results:\n        case_strings.append(str(result_list).replace(\" \", \"\"))\n    \n    final_output_string = f\"[{','.join(case_strings)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}