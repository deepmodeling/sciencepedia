{
    "hands_on_practices": [
        {
            "introduction": "在识别组织结构之前，我们必须首先理解我们所使用技术的根本物理限制。本练习探讨了空间转录组学平台的设计（特别是其捕获点的大小和固有的分子模糊）如何决定其能够解析的最小特征。通过推导允许的最大捕获点直径，您将对硬件设计与可实现的生物分辨率之间的权衡有一个具体的认识。[@problem_id=4354059]",
            "id": "4354059",
            "problem": "一个空间转录组学平台使用一个由直径为 $S$ 的圆形捕获点组成的规则阵列，其排列间距 $p$ 等于捕获点直径（即 $p = S$，因此捕获点不重叠）。在一个组织切片中，考虑两个相邻的空间域，它们沿一维横断面的质心之间的中心距为 $d$（以微米为单位）。捕获过程中的分子分配和扩散会引入一种模糊，该模糊可由标准差为 $\\sigma_{b}$（以微米为单位）的高斯点扩散函数 (PSF) 近似。每个捕获点在其面积上整合 RNA 计数；沿着横断面，将此整合建模为一个宽度为 $S$ 的一维矩形平均核。\n\n从线性系统和采样的第一性原理出发：\n\n- 独立核的卷积会使方差相加，因此沿横断面的有效 PSF 标准差 $\\sigma_{\\mathrm{eff}}$ 由高斯模糊方差与矩形核方差之和的平方根给出。\n- 成像领域一个广泛使用的分辨率判据指出，两个相同的峰与一个标准差为 $\\sigma_{\\mathrm{eff}}$ 的高斯函数卷积后，当它们的间距等于 $2 \\sigma_{\\mathrm{eff}}$ 时，它们恰好可分辨。\n- Shannon–Nyquist 采样定理要求，为了分辨尺度为 $d$ 的特征，采样间距 $p$ 必须满足 $p \\leq d/2$。\n\n假设 $d > 2 \\sigma_{b}$，从而在模糊后分辨率在物理上是可能的。仅使用上述原理和事实，推导在给定间距 $d$ 和模糊 $\\sigma_{b}$ 的情况下，仍能保证两个相邻域可分辨的最大允许捕获点直径 $S_{\\max}$（以微米为单位）的闭式解析表达式。此 $S_{\\max}$ 是分辨率约束对 $S$ 施加的严格上限，因此表征了平台的最小捕获点直径要求，即 $S$ 必须不超过 $S_{\\max}$ 才能分辨这些域。\n\n将您的最终答案表示为关于 $d$ 和 $\\sigma_{b}$ 的单个解析表达式。无需进行数值计算。",
            "solution": "我们将穿过两个相邻域边界的一维横断面上的测量信号，建模为真实的潜在空间信号与两个核的卷积：一个代表分子扩散和错误分配的高斯模糊，以及一个代表捕获点整合的矩形平均核。两个方差分别为 $\\sigma_{1}^{2}$ 和 $\\sigma_{2}^{2}$ 的独立核的卷积，其有效方差等于方差之和 $\\sigma_{1}^{2} + \\sigma_{2}^{2}$，因为在概率解释中，卷积对应于独立随机变量的和。\n\n首先，我们确定矩形平均核贡献的方差。一个宽度为 $S$、单位面积的一维矩形（均匀）核具有概率密度函数\n$$\nu(x) = \\begin{cases}\n\\frac{1}{S},   |x| \\leq \\frac{S}{2}, \\\\\n0,   \\text{otherwise}.\n\\end{cases}\n$$\n在区间 $\\left[-\\frac{S}{2}, \\frac{S}{2}\\right]$ 上的均匀分布的方差为\n$$\n\\sigma_{\\mathrm{rect}}^{2} = \\frac{S^{2}}{12}.\n$$\n高斯模糊被建模为一个方差为 $\\sigma_{b}^{2}$（标准差为 $\\sigma_{b}$）的零均值高斯核。因此，将高斯模糊与矩形平均核卷积后，沿横断面的有效 PSF 标准差为\n$$\n\\sigma_{\\mathrm{eff}} = \\sqrt{\\sigma_{b}^{2} + \\sigma_{\\mathrm{rect}}^{2}} = \\sqrt{\\sigma_{b}^{2} + \\frac{S^{2}}{12}}.\n$$\n\n接下来，我们引用一个适用于高斯受限系统的、经过充分检验的分辨率判据：当两个相同峰的中心距等于高斯 PSF 标准差的两倍时，它们恰好可分辨。这个用于高斯响应的类瑞利判据是\n$$\nd_{\\mathrm{R}} = 2 \\sigma_{\\mathrm{eff}}.\n$$\n为确保间距为 $d$ 的两个相邻域的可分辨性，我们要求\n$$\nd \\geq 2 \\sigma_{\\mathrm{eff}} = 2 \\sqrt{\\sigma_{b}^{2} + \\frac{S^{2}}{12}}.\n$$\n对 $S$ 求解此不等式可得到捕获点直径的上限。两边平方：\n$$\nd^{2} \\geq 4 \\left( \\sigma_{b}^{2} + \\frac{S^{2}}{12} \\right) = 4 \\sigma_{b}^{2} + \\frac{S^{2}}{3}.\n$$\n重新整理以分离出 $S^{2}$：\n$$\n\\frac{S^{2}}{3} \\leq d^{2} - 4 \\sigma_{b}^{2} \\quad \\Longrightarrow \\quad S^{2} \\leq 3 \\left( d^{2} - 4 \\sigma_{b}^{2} \\right).\n$$\n因此，高斯可分辨性约束得出\n$$\nS \\leq \\sqrt{3 \\left( d^{2} - 4 \\sigma_{b}^{2} \\right)}.\n$$\n该约束仅在 $d^{2} - 4 \\sigma_{b}^{2}  0$（即 $d  2 \\sigma_{b}$）时才有意义，而这已在题目中假设。\n\n除了基于模糊的可分辨性，我们还必须确保捕获点阵列的采样不会对尺度为 $d$ 的特征产生混叠。Shannon–Nyquist 采样定理规定，要分辨尺度为 $d$ 的特征，采样间距 $p$ 必须满足\n$$\np \\leq \\frac{d}{2}.\n$$\n由于该平台使用的间距等于捕获点直径（$p = S$），这可转换为\n$$\nS \\leq \\frac{d}{2}.\n$$\n\n为使系统能够分辨相邻域，两个独立的约束必须同时满足。因此，最大允许捕获点直径 $S_{\\max}$ 是两个上限中的最小值：\n$$\nS_{\\max}(d, \\sigma_{b}) = \\min \\left( \\frac{d}{2}, \\, \\sqrt{3 \\left( d^{2} - 4 \\sigma_{b}^{2} \\right)} \\right).\n$$\n该表达式给出了由分辨率约束（高斯受限可分辨性和奈奎斯特采样）施加在捕获点直径上的严格上限。为保证可分辨性，平台必须选择 $S$ 以满足 $S \\leq S_{\\max}(d, \\sigma_{b})$。由于题目要求的是仍能保证分辨率的最大允许捕获点直径，因此所求的解析表达式正是 $S_{\\max}(d, \\sigma_{b})$。",
            "answer": "$$\\boxed{\\min\\!\\left(\\frac{d}{2},\\,\\sqrt{3\\left(d^{2}-4\\sigma_{b}^{2}\\right)}\\right)}$$"
        },
        {
            "introduction": "识别空间域通常不仅仅是简单的阈值分割，它需要能够捕捉数据中固有空间相关性的统计模型。本练习通过条件自回归（CAR）模型的形式，介绍了高斯马尔可夫随机场（GMRF）这一强大的框架。通过推导和实现模型的精度矩阵，您将学习到组织中的邻域关系是如何在数学上被编码以实现空间平滑的，这是定义连贯生物域的一个关键原则。[@problem_id=4354044]",
            "id": "4354044",
            "problem": "考虑一个用于系统生物医学中组织结构的空间模型，其中组织位置（例如，点或细胞）被表示为一个图上的节点，该图捕捉了物理邻接关系。设邻接关系由一个对称、非负的加权矩阵 $W \\in \\mathbb{R}^{n \\times n}$ 编码，其中 $w_{ii} = 0$ 且 $w_{ij} = w_{ji} \\ge 0$。定义节点 $i$ 的度为 $d_i = \\sum_{j=1}^{n} w_{ij}$，度矩阵为 $D = \\operatorname{diag}(d_1,\\dots,d_n)$。考虑一个通过条件自回归（CAR）模型指定的高斯马尔可夫随机场（GMRF）先验：对于每个节点 $i$，其全条件分布为\n$$\nx_i \\mid x_{-i} \\sim \\mathcal{N}\\left(\\mu_i, \\sigma_i^2\\right),\n\\quad \\text{其中} \\quad\n\\mu_i = \\frac{\\rho}{d_i} \\sum_{j \\neq i} w_{ij} x_j,\n\\quad\n\\sigma_i^2 = \\frac{1}{\\tau d_i},\n$$\n其中 $\\tau  0$ 是一个标量精度参数，$\\rho \\in [0,1]$ 是一个空间平滑参数（$\\rho = 1$ 对应于内在CAR，而 $\\rho  1$ 在适当的谱界限下对应于正常CAR）。从多元正态分布在其典范精度形式下的基本定义以及高斯条件分布的结构出发，推导由上述CAR条件所隐含的GMRF的联合精度矩阵 $Q \\in \\mathbb{R}^{n \\times n}$。利用此推导，实现一个算法，在给定 $(W, \\tau, \\rho)$ 的情况下，构造 $Q$，然后评估 $Q$ 的稀疏模式与由 $W$ 定义的组织邻接图之间的关系。\n\n您的程序必须为每个测试用例 $(W, \\tau, \\rho)$ 执行以下任务：\n1. 计算CAR规范所隐含的精度矩阵 $Q$。\n2. 验证 $Q$ 的非对角稀疏模式是否与 $W$ 的邻接模式匹配，即检查对于所有 $i \\neq j$，$Q_{ij} \\neq 0$ 当且仅当 $w_{ij} \\neq 0$。返回一个布尔值。\n3. 计算 $Q$ 中数值上非零项的总数（包括对角线），对绝对值使用 $10^{-12}$ 的数值公差。返回一个整数。\n4. 通过验证所有特征值是否严格大于 $10^{-12}$ 来确定 $Q$ 是否为正定矩阵。返回一个布尔值。\n5. 通过计算小于或等于 $10^{-10}$ 的特征值数量来计算 $Q$ 的零度（零空间的维度）。返回一个整数。\n\n推导中使用的基本依据：\n- 多元正态分布的典范（精度）形式：具有精度矩阵 $Q$ 的GMRF的密度为 $p(x) \\propto \\exp\\left(-\\frac{1}{2} x^\\top Q x\\right)$，其中 $Q$ 是对称半正定矩阵，以确保分布有效。\n- 高斯条件分布在精度矩阵方面的结构：对于具有精度矩阵 $Q$ 的联合正态分布，给定 $x_{-i}$ 时 $x_i$ 的条件分布是高斯分布，其方差为 $1/Q_{ii}$，均值等于 $x_{-i}$ 的线性组合，系数由 $Q$ 的非对角项和 $Q_{ii}$ 决定。\n- 条件独立性与精度矩阵中零元素之间的关系：$Q_{ij} = 0$ 意味着节点 $i$ 和 $j$ 在给定所有其他节点的情况下是条件独立的。\n\n测试套件：\n- 案例A（连通，正常CAR）：$W$ 是具有4-邻域邻接的无权 $3 \\times 3$ 网格，$\\tau = 2.0$，$\\rho = 0.4$。\n- 案例B（连通，内在CAR）：$W$ 是相同的 $3 \\times 3$ 网格，$\\tau = 1.0$，$\\rho = 1.0$。\n- 案例C（不连通，内在CAR）：$W$ 是由两个不相交的无权 $2 \\times 2$ 网格（每个都具有4-邻域邻接）组成的块对角邻接矩阵，$\\tau = 1.0$，$\\rho = 1.0$。\n- 案例D（加权链，正常CAR）：$W$ 是一个长度为5的一维链，边为 $(1,2)$, $(2,3)$, $(3,4)$, $(4,5)$，权重为单位权重，除了一个弱边界 $w_{2,3} = 0.2$，$\\tau = 1.5$，$\\rho = 0.9$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试用例贡献一个形式为 $[\\text{布尔值}, \\text{整数}, \\text{布尔值}, \\text{整数}]$ 的列表。因此，总输出是一个列表的列表，形式为\n$$\n[\\,[b_1,i_1,b_2,i_2],\\,[b_1',i_1',b_2',i_2'],\\,\\ldots\\,].\n$$",
            "solution": "目标是为由条件自回归（CAR）模型指定的高斯马尔可夫随机场（GMRF）推导其联合精度矩阵 $Q$，并随后基于组织邻接图结构分析 $Q$ 的属性。\n\n### 1. 精度矩阵 $Q$ 的推导\n\n推导始于多元正态分布在其典范形式下的基本定义。对于一个随机向量 $x \\in \\mathbb{R}^n$，零均值GMRF的概率密度函数（PDF）由下式给出：\n$$\np(x) \\propto \\exp\\left(-\\frac{1}{2} x^\\top Q x\\right)\n$$\n其中 $Q \\in \\mathbb{R}^{n \\times n}$ 是对称、半正定的精度矩阵。该矩阵的结构编码了变量之间的条件独立性关系。\n\n为了找到单个变量 $x_i$ 在给定所有其他变量 $x_{-i} = (x_1, \\dots, x_{i-1}, x_{i+1}, \\dots, x_n)^\\top$ 的情况下的全条件分布，我们检查二次型 $x^\\top Q x$ 中涉及 $x_i$ 的项。\n$$\nx^\\top Q x = \\sum_{k=1}^n \\sum_{l=1}^n Q_{kl} x_k x_l = Q_{ii} x_i^2 + 2x_i \\sum_{j \\neq i} Q_{ij} x_j + \\sum_{k \\neq i, l \\neq i} Q_{kl} x_k x_l\n$$\n涉及 $x_i$ 的项是 $Q_{ii} x_i^2 + 2x_i \\sum_{j \\neq i} Q_{ij} x_j$。条件PDF $p(x_i | x_{-i})$ 正比于 $\\exp(-\\frac{1}{2} (Q_{ii} x_i^2 + 2x_i \\sum_{j \\neq i} Q_{ij} x_j))$。我们可以对 $x_i$ 进行配方：\n$$\nQ_{ii} x_i^2 + 2x_i \\sum_{j \\neq i} Q_{ij} x_j = Q_{ii} \\left( x_i^2 + 2x_i \\frac{\\sum_{j \\neq i} Q_{ij} x_j}{Q_{ii}} \\right) = Q_{ii} \\left( x_i + \\frac{\\sum_{j \\neq i} Q_{ij} x_j}{Q_{ii}} \\right)^2 - \\text{不涉及 } x_i \\text{ 的项}\n$$\n因此，条件分布 $p(x_i|x_{-i})$ 是一个高斯分布，其参数为：\n- 条件均值：$E[x_i | x_{-i}] = -\\frac{1}{Q_{ii}} \\sum_{j \\neq i} Q_{ij} x_j$\n- 条件方差：$\\operatorname{Var}(x_i | x_{-i}) = \\frac{1}{Q_{ii}}$\n\n接下来，我们将这些通用形式与CAR模型提供的特定条件分布相等同：\n$$\nx_i \\mid x_{-i} \\sim \\mathcal{N}\\left(\\mu_i, \\sigma_i^2\\right)\n\\quad \\text{其中} \\quad\n\\mu_i = \\frac{\\rho}{d_i} \\sum_{j \\neq i} w_{ij} x_j\n\\quad \\text{和} \\quad\n\\sigma_i^2 = \\frac{1}{\\tau d_i}\n$$\n其中 $d_i = \\sum_{j=1}^n w_{ij}$。\n\n通过比较条件方差，我们找到 $Q$ 的对角元素：\n$$\n\\frac{1}{Q_{ii}} = \\sigma_i^2 = \\frac{1}{\\tau d_i} \\implies Q_{ii} = \\tau d_i\n$$\n\n通过比较条件均值，我们找到 $Q$ 的非对角元素：\n$$\n-\\frac{1}{Q_{ii}} \\sum_{j \\neq i} Q_{ij} x_j = \\mu_i = \\frac{\\rho}{d_i} \\sum_{j \\neq i} w_{ij} x_j\n$$\n代入 $Q_{ii} = \\tau d_i$：\n$$\n-\\frac{1}{\\tau d_i} \\sum_{j \\neq i} Q_{ij} x_j = \\frac{\\rho}{d_i} \\sum_{j \\neq i} w_{ij} x_j\n$$\n两边乘以 $-\\tau d_i$ 得：\n$$\n\\sum_{j \\neq i} Q_{ij} x_j = -\\tau \\rho \\sum_{j \\neq i} w_{ij} x_j\n$$\n由于这对任意向量 $x_{-i}$ 都必须成立，因此等式两边每个 $x_j$（对于 $j \\neq i$）的系数必须相等：\n$$\nQ_{ij} = -\\tau \\rho w_{ij} \\quad \\text{对于 } i \\neq j\n$$\n\n结合对角和非对角项的结果，我们可以用矩阵形式表示精度矩阵 $Q$。令 $D = \\operatorname{diag}(d_1, \\dots, d_n)$ 为对角度矩阵，$W$ 为邻接矩阵。精度矩阵为：\n$$\nQ = \\tau (D - \\rho W)\n$$\n这个推导提供了一个从给定的模型参数 $W$、$\\tau$ 和 $\\rho$ 直接构造 $Q$ 的公式。\n\n### 2. 算法流程与属性分析\n\n基于推导出的 $Q$ 的公式，我们可以系统地解决问题的各项任务。\n\n**任务1：计算精度矩阵 $Q$。**\n算法很简单：给定矩阵 $W$ 和标量 $\\tau$、$\\rho$，首先计算每个节点的度 $d_i = \\sum_{j} w_{ij}$ 以形成对角矩阵 $D$。然后，使用公式 $Q = \\tau (D - \\rho W)$ 计算 $Q$。\n\n**任务2：验证稀疏模式。**\n$Q$ 的非对角项由 $Q_{ij} = -\\tau \\rho w_{ij}$（当 $i \\neq j$ 时）给出。问题规定 $\\tau  0$ 且 $\\rho \\in [0, 1]$。对于测试用例，$\\rho  0$。因此，一个非对角项 $Q_{ij}$ 非零当且仅当 $w_{ij}$ 也非零。这证实了精度矩阵 $Q$ 的非对角稀疏模式与邻接矩阵 $W$ 的稀疏模式相同。这是GMRF的一个标志性属性，其中精度矩阵中的零项对应于条件独立性。\n\n**任务3：计算 $Q$ 中数值非零项的数量。**\n由于 $Q_{ii} = \\tau d_i$，并且对于任何连通的节点，$d_i  0$ 且 $\\tau  0$，因此 $Q$ 的所有对角项都将非零。非零的非对角项直接对应于 $W$ 中的非零项。因此，总数是 $n$（对角线）加上 $W$ 中非零非对角项的数量，即图中边数的两倍。实现时将计算绝对值大于公差 $10^{-12}$ 的所有 $Q$ 的项数。\n\n**任务4和5：确定正定性和零度。**\n这些属性通过分析 $Q$ 的特征值来确定。由于 $Q$ 是对称的（$D$ 是对角的，$W$ 是对称的），其所有特征值都是实数。\n- **正定性**：如果 $Q$ 的所有特征值都严格为正，则 $Q$ 是正定的。算法将检查所有特征值是否大于公差 $10^{-12}$。\n- **零度**：$Q$ 的零度是其零空间的维度，等于零特征值的数量。在数值上，这被计算为小于或等于公差 $10^{-10}$ 的特征值的数量。\n\n$Q$ 的属性关键地依赖于参数 $\\rho$：\n- 如果 $\\rho = 1$（内在CAR），$Q = \\tau(D-W) = \\tau L$，其中 $L$ 是图拉普拉斯矩阵。已知 $L$ 是半正定的。$L$ 的零度等于由 $W$ 定义的图中连通分量的数量。对于一个连通图，零度为1，且 $Q$ 不是正定的。\n- 如果 $\\rho  1$（正常CAR）且图是连通的，$Q$ 通常是正定的，前提是 $\\rho$ 满足与 $W$ 和 $D$ 相关的某些谱界限。对于给定的 $\\rho  1$ 的测试用例，这些条件得到满足，导致 $Q$ 是正定的，零度为零。\n\n这个框架使我们能够将抽象的CAR模型规范转化为一个具体的矩阵 $Q$，并分析其与底层邻接图相关的结构和数学属性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef build_grid_adjacency(height, width):\n    \"\"\"\n    Constructs an unweighted adjacency matrix for a grid graph with 4-neighborhood.\n    \"\"\"\n    n = height * width\n    W = np.zeros((n, n))\n    for r in range(height):\n        for c in range(width):\n            i = r * width + c\n            # Horizontal connection to the right\n            if c  width - 1:\n                j = i + 1\n                W[i, j] = W[j, i] = 1\n            # Vertical connection downwards\n            if r  height - 1:\n                j = i + width\n                W[i, j] = W[j, i] = 1\n    return W\n\ndef process_case(W, tau, rho):\n    \"\"\"\n    Performs all required computations for a single test case.\n    \"\"\"\n    n = W.shape[0]\n\n    # Task 1: Compute the precision matrix Q\n    d = W.sum(axis=1)\n    D = np.diag(d)\n    Q = tau * (D - rho * W)\n\n    # Task 2: Verify the off-diagonal sparsity pattern\n    # The derivation Q_ij = -tau * rho * w_ij shows that for tau, rho > 0,\n    # the off-diagonal sparsity patterns must match. We verify this numerically.\n    q_is_nonzero_offdiag = np.abs(Q) > 1e-12\n    np.fill_diagonal(q_is_nonzero_offdiag, False)\n    w_is_nonzero = np.abs(W) > 1e-12\n    # w_ii is given as 0, so no need to touch the diagonal for W\n    sparsity_match = np.all(q_is_nonzero_offdiag == w_is_nonzero)\n\n    # Task 3: Count the total number of numerically nonzero entries of Q\n    nonzero_count = int(np.sum(np.abs(Q) > 1e-12))\n\n    # For tasks 4 and 5, compute the eigenvalues of Q.\n    # Q is real and symmetric, so its eigenvalues are real. np.linalg.eigvalsh is efficient and stable.\n    eigenvalues = np.linalg.eigvalsh(Q)\n    \n    # Task 4: Determine whether Q is positive definite\n    is_pd = np.all(eigenvalues > 1e-12)\n\n    # Task 5: Compute the nullity (dimension of the null space) of Q\n    nullity = int(np.sum(eigenvalues = 1e-10))\n\n    return [sparsity_match, nonzero_count, is_pd, nullity]\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run them, and print the results.\n    \"\"\"\n    # Case A: 3x3 grid, proper CAR\n    W_A = build_grid_adjacency(3, 3)\n    case_A = (W_A, 2.0, 0.4)\n\n    # Case B: 3x3 grid, intrinsic CAR\n    W_B = build_grid_adjacency(3, 3)\n    case_B = (W_B, 1.0, 1.0)\n\n    # Case C: Two disjoint 2x2 grids, intrinsic CAR\n    W_2x2 = build_grid_adjacency(2, 2)\n    W_C = np.block([\n        [W_2x2, np.zeros((4, 4))],\n        [np.zeros((4, 4)), W_2x2]\n    ])\n    case_C = (W_C, 1.0, 1.0)\n    \n    # Case D: Weighted chain, proper CAR.\n    # Nodes are 0-indexed: 0, 1, 2, 3, 4.\n    # The problem statement says w_{2,3}=0.2. In 1-based indexing, this is edge (2,3).\n    # In 0-based indexing, this is edge (1,2).\n    W_D = np.zeros((5, 5))\n    edges = [(0, 1, 1.0), (1, 2, 0.2), (2, 3, 1.0), (3, 4, 1.0)]\n    for i, j, w in edges:\n        W_D[i, j] = W_D[j, i] = w\n    case_D = (W_D, 1.5, 0.9)\n\n    test_cases = [case_A, case_B, case_C, case_D]\n\n    results = []\n    for W_case, tau_case, rho_case in test_cases:\n        result = process_case(W_case, tau_case, rho_case)\n        results.append(result)\n\n    # Format the final output string to match the problem specification\n    # e.g., [[true,33,true,0],[true,33,false,1],...]\n    formatted_results = []\n    for res in results:\n        # Convert python boolean True/False to lowercase true/false\n        b1_str = str(res[0]).lower()\n        i1 = res[1]\n        b2_str = str(res[2]).lower()\n        i2 = res[3]\n        formatted_results.append(f\"[{b1_str},{i1},{b2_str},{i2}]\")\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在使用计算方法将组织分割成空间域后，关键的下一步是评估其准确性。本练习介绍了几个用于比较预测域与“金标准”注释的标准指标——交并比（$\\mathrm{IoU}$）、戴斯系数（Dice coefficient）和调整兰德指数（$\\mathrm{ARI}$）。通过一个具体的例子，您将理解这些指标在量化性能方面的细微但重要的差异，并了解为什么像 $\\mathrm{ARI}$ 这样的经机会校正的指数在严谨的科学评估中通常更受青睐。[@problem_id=4354070]",
            "id": "4354070",
            "problem": "一项空间转录组学分析得到了一张包含 $n$ 个具有已知空间坐标的单细胞的二维组织图。一份组织学图谱提供了这些细胞的基准分区，将其分为反映组织结构的两个空间域 $T_1$ 和 $T_2$。一个无监督分割流程产生了两个预测簇 $P_1$ 和 $P_2$，旨在恢复这些空间域。给定以下联合分配的计数（一个列联表）：\n- $|T_1 \\cap P_1| = 18$， $|T_1 \\cap P_2| = 2$，\n- $|T_2 \\cap P_1| = 7$， $|T_2 \\cap P_2| = 13$，\n因此 $n = 40$，$|T_1| = 20$，$|T_2| = 20$，$|P_1| = 25$，且 $|P_2| = 15$。\n\n请仅使用与系统生物医学中评估域分割相关的基本原理和核心定义——即有限集上交集和并集的集合论定义、有限集划分为带标签类别的概念，以及划分间一致性的配对计数观点——来评估以下关于三种评估指标及其解释差异的陈述：\n\n- 交并比（Intersection-over-Union, $\\mathrm{IoU}$）：定义为两个集合重叠元素相对于其并集的比例。\n- Dice 系数（也称为 Sørensen–Dice）：定义为两个集合的对称重叠分数，基于交集大小相对于集合大小之和的比例。\n- 调整兰德指数（Adjusted Rand Index, ARI）：一种基于配对一致性的、经过机会调整的两个分区之间的相似性度量，对类别标签的排列不变，在给定类别大小的情况下，随机标记的期望值为 $0$。\n\n哪些陈述是正确的？\n\nA. 对于配对 $(T_1, P_1)$，交并比等于 $18/(18+2+7) \\approx 0.667$，Dice 系数等于 $2 \\cdot 18/(20+25) = 36/45 \\approx 0.800$，并且只要 $|T_1 \\cap P_1|  0$ 且 $|T_1 \\cup P_1|  |T_1 \\cap P_1|$，Dice 系数就严格大于交并比。\n\nB. 对于 $n=40$ 个细胞上的完整两个分区的比较，调整兰德指数等于 $1448/5075 \\approx 0.285$，它对预测簇标签的任何排列都是不变的，并且在固定边际类别大小的随机标记下，其期望值为 $0$。\n\nC. 交并比和 Dice 系数包含了类似于调整兰德指数的机会调整，因此在固定边际大小的随机分割下，它们的期望值为 $0$。\n\nD. 对于任意两个集合，Dice 系数等于交并比；因此对于 $(T_1, P_1)$，两个分数都等于 $0.800$。\n\nE. 交换预测簇的名称（例如，交换 $P_1$ 和 $P_2$）将改变调整兰德指数，但不会影响交并比和 Dice 系数。",
            "solution": "本问题要求基于给定的真实域划分 ($T_1, T_2$) 与预测簇 ($P_1, P_2$) 的列联表，评估关于三种常用分割评估指标（交并比IoU、Dice系数、调整兰德指数ARI）的陈述。\n给定的数据为：\n- $|T_1 \\cap P_1| = 18$, $|T_1 \\cap P_2| = 2$\n- $|T_2 \\cap P_1| = 7$, $|T_2 \\cap P_2| = 13$\n由此可得边际计数：\n- $|T_1| = 18 + 2 = 20$\n- $|T_2| = 7 + 13 = 20$\n- $|P_1| = 18 + 7 = 25$\n- $|P_2| = 2 + 13 = 15$\n- 总细胞数 $n = 18+2+7+13 = 40$。\n所有计数均一致，问题是适定的。\n\n我们首先定义各个指标的数学公式：\n- **交并比 (IoU):** $\\mathrm{IoU}(A, B) = \\frac{|A \\cap B|}{|A \\cup B|} = \\frac{|A \\cap B|}{|A| + |B| - |A \\cap B|}$\n- **Dice 系数:** $\\mathrm{Dice}(A, B) = \\frac{2|A \\cap B|}{|A| + |B|}$\n- **调整兰德指数 (ARI):** ARI通过比较两个分区中所有点对的一致性进行计算，并根据随机情况进行调整。其公式为：\n  $$ \\mathrm{ARI} = \\frac{\\sum_{ij}\\binom{n_{ij}}{2} - \\left[ \\left( \\sum_i \\binom{a_i}{2} \\right) \\left( \\sum_j \\binom{b_j}{2} \\right) \\right] / \\binom{n}{2}}{\\frac{1}{2}\\left(\\sum_i \\binom{a_i}{2} + \\sum_j \\binom{b_j}{2}\\right) - \\left[ \\left( \\sum_i \\binom{a_i}{2} \\right) \\left( \\sum_j \\binom{b_j}{2} \\right) \\right] / \\binom{n}{2}} $$\n  其中，$n_{ij}$ 是列联表中的计数，$a_i$ 是行和，$b_j$ 是列和。\n\n现在我们逐一评估每个选项：\n\n**A.** 对于配对 $(T_1, P_1)$，$|T_1| = 20$, $|P_1| = 25$, $|T_1 \\cap P_1| = 18$。\n-   **交并比** $\\mathrm{IoU}(T_1, P_1) = \\frac{|T_1 \\cap P_1|}{|T_1 \\cup P_1|} = \\frac{18}{20 + 25 - 18} = \\frac{18}{27} = \\frac{2}{3} \\approx 0.667$。陈述中的 $|T_1 \\cup P_1|$ 计算为 $18+2+7=27$ 也是正确的。\n-   **Dice系数** $\\mathrm{Dice}(T_1, P_1) = \\frac{2|T_1 \\cap P_1|}{|T_1| + |P_1|} = \\frac{2 \\times 18}{20 + 25} = \\frac{36}{45} = \\frac{4}{5} = 0.800$。\n-   不等式关系：只要两个集合不完全相同（即 $|A \\cup B| > |A \\cap B|$），Dice 系数总是严格大于 IoU。这是因为 $\\frac{2I}{A+B} > \\frac{I}{A+B-I}$（其中 $I=|A \\cap B|, A=|A|, B=|B|$）可以简化为 $A+B > 2I$，这等价于两个集合的非重叠部分之和为正。陈述中的条件满足此要求。因此，**陈述 A 是正确的。**\n\n**B.** 对于完整的两个分区的比较，我们计算ARI：\n-   同类点对总数（Index）: $\\sum_{ij}\\binom{n_{ij}}{2} = \\binom{18}{2} + \\binom{2}{2} + \\binom{7}{2} + \\binom{13}{2} = 153 + 1 + 21 + 78 = 253$。\n-   真实分区和预测分区的同类点对数：$\\sum_i \\binom{a_i}{2} = \\binom{20}{2} + \\binom{20}{2} = 190 + 190 = 380$；$\\sum_j \\binom{b_j}{2} = \\binom{25}{2} + \\binom{15}{2} = 300 + 105 = 405$。\n-   点对总数：$\\binom{40}{2} = 780$。\n-   随机期望的同类点对数 (Expected Index)：$E = \\frac{380 \\times 405}{780} = \\frac{2565}{13}$。\n-   最大同类点对数均值 (Max Index)：$\\frac{1}{2}(380 + 405) = \\frac{785}{2}$。\n-   $\\mathrm{ARI} = \\frac{\\text{Index} - E}{\\text{Max Index} - E} = \\frac{253 - 2565/13}{785/2 - 2565/13} = \\frac{(3289 - 2565)/13}{(10205 - 5130)/26} = \\frac{724/13}{5075/26} = \\frac{724 \\times 2}{5075} = \\frac{1448}{5075} \\approx 0.2853$。\n-   陈述中的数值 $\\approx 0.285$ 是正确的。ARI的关键特性包括对簇标签排列的不变性，以及在随机标记下的期望值为0。因此，**陈述 B 是正确的。**\n\n**C.** IoU 和 Dice 系数不包含机会调整。它们是基于集合重叠的直接度量。对于随机分区，由于总会有偶然的重叠，它们的期望值通常大于0，而不是0。只有像ARI这样经过调整的指数才具有期望值为0的特性。因此，**陈述 C 是不正确的。**\n\n**D.** Dice 系数通常不等于交并比。从A的计算中我们看到，对于 $(T_1, P_1)$，Dice系数(0.800)不等于交并比(0.667)。只有当两个集合完全相同时，它们的值才都等于1；或者当两个集合没有交集时，它们的值才都等于0。在其他情况下，它们是不同的。因此，**陈述 D 是不正确的。**\n\n**E.** ARI 是基于点对一致性计算的，它评估的是分区的结构相似性，与簇的具体名称无关。因此，交换 $P_1$ 和 $P_2$ 的标签**不会**改变ARI的值。相反，成对的 IoU 和 Dice 分数是针对特定标签对计算的。例如，$\\mathrm{IoU}(T_1, P_1)$ 和 $\\mathrm{Dice}(T_1, P_1)$ 的值与 $\\mathrm{IoU}(T_1, P_2)$ 和 $\\mathrm{Dice}(T_1, P_2)$ 是不同的。因此，交换标签会改变我们正在评估的特定成对分数。该陈述的说法与事实完全相反。因此，**陈述 E 是不正确的。**\n\n综上所述，只有陈述A和B是正确的。",
            "answer": "$$\\boxed{AB}$$"
        }
    ]
}