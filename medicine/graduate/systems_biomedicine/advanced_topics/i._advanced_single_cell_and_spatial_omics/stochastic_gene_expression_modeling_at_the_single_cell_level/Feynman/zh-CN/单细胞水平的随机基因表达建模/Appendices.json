{
    "hands_on_practices": [
        {
            "introduction": "基因表达的动态特性通常通过其时间尺度来表征，例如一个基因维持“开启”或“关闭”状态的持续时间。本实践将指导您通过解析推导启动子状态的自相关函数来探索这些动态特性，这是一个关键的分析工具。通过完成此推导，您将揭示仅从动态数据中可以获知的信息存在根本性的限制，并学习如何克服这些限制。",
            "id": "4388478",
            "problem": "哺乳动物细胞中的单个基因启动子根据一个连续时间双态马尔可夫过程（电报模型）在非活性状态和活性状态之间随机切换。令启动子状态为 $S(t) \\in \\{0,1\\}$，其中 $S(t)=1$ 表示活性状态，$S(t)=0$ 表示非活性状态。从 $0 \\to 1$ 的转换速率为 $k_{on}$，从 $1 \\to 0$ 的转换速率为 $k_{off}$。假设该过程是平稳的且遍历的。你可以将测量理想化为一个足够快速的光学报告基因，使得测量到的信号直接就是 $S(t)$。\n\n从连续时间马尔可夫链的第一性原理和弱平稳过程的自相关定义出发，推导出中心化的启动子信号 $S(t)-\\mathbb{E}[S(t)]$ 的归一化自相关函数 $C(\\tau)$，该函数是时间延迟 $\\tau \\ge 0$ 以及参数 $k_{on}$ 和 $k_{off}$ 的函数。然后计算 $C(\\tau)$ 对每个参数的局部灵敏度，定义为 $S_{on}(\\tau) \\equiv \\partial C(\\tau)/\\partial k_{on}$ 和 $S_{off}(\\tau) \\equiv \\partial C(\\tau)/\\partial k_{off}$，并构成比率\n$$\nR(\\tau) \\equiv \\frac{S_{on}(\\tau)}{S_{off}(\\tau)} \\, .\n$$\n\n利用你的推导来讨论仅凭归一化自相关函数的形状是否能单独辨识 $k_{on}$ 和 $k_{off}$，并提出一个单一的补充稳态测量方法，当与自相关形状结合时，能使参数对 $(k_{on},k_{off})$ 变得可辨识。对于计算部分，仅需报告 $R(\\tau)$ 的封闭形式解析表达式。无需四舍五入，也无需为 $R(\\tau)$ 添加单位。",
            "solution": "用户希望我解决一个关于随机双态基因启动子模型的问题。\n\n以下是计划：\n1.  **验证问题：**\n    *   **第1步：提取已知条件：** 我将列出问题陈述中提供的所有信息。\n        *   模型：连续时间双态马尔可夫过程（电报模型）。\n        *   状态：$S(t) \\in \\{0, 1\\}$，其中 $0$ 为非活性，$1$ 为活性。\n        *   转换速率：$k_{on}$ 对应 $0 \\to 1$，$k_{off}$ 对应 $1 \\to 0$。\n        *   过程性质：平稳和遍历。\n        *   测量：理想化的，直接测量 $S(t)$。\n        *   任务1：推导中心化信号 $S(t)-\\mathbb{E}[S(t)]$ 的归一化自相关函数 $C(\\tau)$。\n        *   任务2：计算局部灵敏度 $S_{on}(\\tau) = \\partial C(\\tau)/\\partial k_{on}$ 和 $S_{off}(\\tau) = \\partial C(\\tau)/\\partial k_{off}$。\n        *   任务3：构成比率 $R(\\tau) = S_{on}(\\tau) / S_{off}(\\tau)$。\n        *   任务4：讨论仅从 $C(\\tau)$ 是否能辨识参数。\n        *   任务5：提出一个补充测量方法以实现完全可辨识性。\n        *   任务6：报告 $R(\\tau)$ 的封闭形式表达式作为最终答案。\n\n    *   **第2步：验证：** 我将根据我的验证标准检查问题。\n        *   *科学依据*：是的，双态电报模型是随机基因表达建模的基石。它是系统生物学和生物物理学中一个标准且广为接受的模型。所有概念（马尔可夫过程、自相关、灵敏度）都是数学和物理学中的标准概念。\n        *   *良态问题*：是的，这个问题定义明确。它要求为一个标准模型推导一个标准量（自相关），然后执行标准的数学运算（微分）和分析（可辨识性）。平稳性假设是关键。存在唯一解。\n        *   *客观性*：是的，语言精确、技术性强，没有主观性。\n        *   *无缺陷*：\n            1.  *科学/事实不准确*：无。\n            2.  *不可形式化/不相关*：这是一个直接属于指定领域的形式化问题。\n            3.  *不完整/矛盾*：问题提供了所有必要信息。平稳性假设允许计算稳态概率和自相关函数。\n            4.  *不切实际/不可行*：该模型是一种理想化，但它具有科学价值且被广泛使用。“理想化测量”是理论推导中一个标准的简化假设。\n            5.  *病态问题*：否，这是一个标准的教科书式推导。\n            6.  *伪深刻/琐碎*：该推导需要基于概率论和微积分的多个逻辑推理步骤。它并不琐碎。\n            7.  *超出科学可验证性*：结果可以通过数学方式验证，并与随机过程的模拟进行比较。\n\n    *   **第3步：结论：** 该问题是**有效的**。我将继续进行解答。\n\n2.  **解决问题：**\n    *   **第1部分：稳态概率。**\n        *   该过程是状态空间 $\\{0, 1\\}$ 上的连续时间马尔可夫链。\n        *   令 $p_0(t) = \\mathbb{P}(S(t)=0)$ 且 $p_1(t) = \\mathbb{P}(S(t)=1)$。\n        *   主方程为：\n            $$ \\frac{d p_1}{dt} = k_{on} p_0(t) - k_{off} p_1(t) $$\n            $$ \\frac{d p_0}{dt} = k_{off} p_1(t) - k_{on} p_0(t) $$\n        *   约束条件为 $p_0(t) + p_1(t) = 1$。\n        *   在平稳状态下，$d p_1/dt = 0$ 且 $d p_0/dt = 0$。令稳态概率为 $\\pi_0$ 和 $\\pi_1$。\n        *   $k_{on} \\pi_0 - k_{off} \\pi_1 = 0$。\n        *   并且，$\\pi_0 + \\pi_1 = 1$。\n        *   代入 $\\pi_0 = 1 - \\pi_1$：$k_{on} (1 - \\pi_1) - k_{off} \\pi_1 = 0 \\implies k_{on} - k_{on} \\pi_1 - k_{off} \\pi_1 = 0 \\implies k_{on} = (k_{on} + k_{off}) \\pi_1$。\n        *   所以，$\\pi_1 = \\frac{k_{on}}{k_{on} + k_{off}}$。\n        *   并且 $\\pi_0 = 1 - \\pi_1 = 1 - \\frac{k_{on}}{k_{on} + k_{off}} = \\frac{k_{off}}{k_{on} + k_{off}}$。\n        *   这些是平稳概率。\n\n    *   **第2部分：S(t)的期望和方差。**\n        *   信号是 $S(t) \\in \\{0, 1\\}$。\n        *   在平稳条件下的期望值为 $\\mathbb{E}[S(t)] = 0 \\cdot \\pi_0 + 1 \\cdot \\pi_1 = \\pi_1$。\n        *   $\\mathbb{E}[S(t)] = \\frac{k_{on}}{k_{on} + k_{off}}$。我们称之为 $\\mu_S$。\n        *   信号的方差是 $\\text{Var}(S(t)) = \\mathbb{E}[S(t)^2] - (\\mathbb{E}[S(t)])^2$。\n        *   由于 $S(t)$ 只能是 $0$ 或 $1$，因此 $S(t)^2 = S(t)$。\n        *   所以 $\\mathbb{E}[S(t)^2] = \\mathbb{E}[S(t)] = \\pi_1$。\n        *   $\\text{Var}(S(t)) = \\pi_1 - \\pi_1^2 = \\pi_1(1-\\pi_1) = \\pi_1 \\pi_0$。\n        *   $\\text{Var}(S(t)) = \\frac{k_{on}}{k_{on} + k_{off}} \\frac{k_{off}}{k_{on} + k_{off}} = \\frac{k_{on} k_{off}}{(k_{on} + k_{off})^2}$。\n\n    *   **第3部分：自相关函数。**\n        *   问题要求的是中心化信号 $X(t) = S(t) - \\mu_S$ 的归一化自相关。\n        *   $X(t)$ 对于延迟 $\\tau \\ge 0$ 的未归一化自相关是 $R_X(\\tau) = \\mathbb{E}[X(t+\\tau)X(t)]$。\n        *   $R_X(\\tau) = \\mathbb{E}[(S(t+\\tau) - \\mu_S)(S(t) - \\mu_S)] = \\mathbb{E}[S(t+\\tau)S(t)] - \\mu_S \\mathbb{E}[S(t+\\tau)] - \\mu_S \\mathbb{E}[S(t)] + \\mu_S^2$。\n        *   由于过程是平稳的，$\\mathbb{E}[S(t+\\tau)] = \\mathbb{E}[S(t)] = \\mu_S$。\n        *   所以，$R_X(\\tau) = \\mathbb{E}[S(t+\\tau)S(t)] - \\mu_S^2 - \\mu_S^2 + \\mu_S^2 = \\mathbb{E}[S(t+\\tau)S(t)] - \\mu_S^2$。\n        *   这是 $S(t)$ 的自协方差函数，记为 $\\text{Cov}(S(t+\\tau), S(t))$。\n        *   现在我需要计算 $\\mathbb{E}[S(t+\\tau)S(t)]$。\n        *   $\\mathbb{E}[S(t+\\tau)S(t)] = \\sum_{i,j \\in \\{0,1\\}} (j \\cdot i) \\mathbb{P}(S(t+\\tau)=j, S(t)=i)$。\n        *   唯一非零项是 $i=1, j=1$。\n        *   所以，$\\mathbb{E}[S(t+\\tau)S(t)] = \\mathbb{P}(S(t+\\tau)=1, S(t)=1)$。\n        *   使用条件概率：$\\mathbb{P}(S(t+\\tau)=1, S(t)=1) = \\mathbb{P}(S(t+\\tau)=1 | S(t)=1) \\mathbb{P}(S(t)=1)$。\n        *   $\\mathbb{P}(S(t)=1) = \\pi_1$。\n        *   我需要找到转移概率 $P_{11}(\\tau) = \\mathbb{P}(S(t+\\tau)=1 | S(t)=1)$。\n        *   转移概率 $P_{ij}(\\tau) = \\mathbb{P}(S(t+\\tau)=j | S(t)=i)$ 可以通过求解具有特定初始条件的主方程来找到。\n        *   令 $p_1(t)$ 为在时间 $t$ 处于状态1的概率。方程为 $\\frac{dp_1}{dt} = k_{on} p_0 - k_{off} p_1$。\n        *   使用 $p_0 = 1 - p_1$，我们得到 $\\frac{dp_1}{dt} = k_{on} (1 - p_1) - k_{off} p_1 = k_{on} - (k_{on} + k_{off}) p_1$。\n        *   这是一个线性一阶常微分方程。令 $k = k_{on} + k_{off}$。$\\frac{dp_1}{dt} + k p_1 = k_{on}$。\n        *   通解是 $p_1(t) = A e^{-kt} + \\frac{k_{on}}{k}$。\n        *   为了找到 $P_{11}(\\tau)$，我们需要从状态1开始的解，所以 $p_1(0)=1$。我们求解 $p_1(\\tau)$。\n        *   $1 = A e^0 + \\frac{k_{on}}{k} \\implies A = 1 - \\frac{k_{on}}{k} = \\frac{k-k_{on}}{k} = \\frac{k_{off}}{k}$。\n        *   所以，$P_{11}(\\tau) = \\frac{k_{off}}{k_{on}+k_{off}} e^{-(k_{on}+k_{off})\\tau} + \\frac{k_{on}}{k_{on}+k_{off}}$。\n        *   $P_{11}(\\tau) = \\pi_0 e^{-(k_{on}+k_{off})\\tau} + \\pi_1$。\n        *   现在，$\\mathbb{E}[S(t+\\tau)S(t)] = P_{11}(\\tau) \\pi_1 = (\\pi_0 e^{-(k_{on}+k_{off})\\tau} + \\pi_1) \\pi_1 = \\pi_0 \\pi_1 e^{-(k_{on}+k_{off})\\tau} + \\pi_1^2$。\n        *   自协方差是 $R_X(\\tau) = \\mathbb{E}[S(t+\\tau)S(t)] - \\mu_S^2 = (\\pi_0 \\pi_1 e^{-(k_{on}+k_{off})\\tau} + \\pi_1^2) - \\pi_1^2 = \\pi_0 \\pi_1 e^{-(k_{on}+k_{off})\\tau}$。\n        *   延迟 $\\tau=0$ 时的自协方差是 $R_X(0) = \\pi_0 \\pi_1$。正如预期的那样，这是方差 $\\text{Var}(S(t))$。\n        *   归一化自相关函数是 $C(\\tau) = \\frac{R_X(\\tau)}{R_X(0)}$。\n        *   $C(\\tau) = \\frac{\\pi_0 \\pi_1 e^{-(k_{on}+k_{off})\\tau}}{\\pi_0 \\pi_1} = e^{-(k_{on}+k_{off})\\tau}$。\n        *   所以，$C(\\tau) = \\exp(-(k_{on}+k_{off})\\tau)$。这是一个简单的指数衰减。\n\n    *   **使用生成元矩阵推导转移概率的另一种方法。**\n        *   生成元矩阵（或速率矩阵）$Q$ 是：\n            $$ Q = \\begin{pmatrix} -k_{on}  k_{on} \\\\ k_{off}  -k_{off} \\end{pmatrix} $$\n            （行是“从”状态，列是“到”状态；或者是转置，需要小心。假设 $\\frac{d\\vec{p}}{dt} = \\vec{p} Q$，其中 $\\vec{p} = (p_0, p_1)$ 是一个行向量。\n            $\\frac{dp_0}{dt} = -k_{on} p_0 + k_{off} p_1$。\n            $\\frac{dp_1}{dt} = k_{on} p_0 - k_{off} p_1$。\n            这与我的主方程相匹配。所以行向量的约定是正确的）。\n        *   转移概率矩阵是 $P(\\tau) = \\exp(Q\\tau)$。\n        *   $Q$ 的特征值：$\\det(Q - \\lambda I) = (-k_{on}-\\lambda)(-k_{off}-\\lambda) - k_{on}k_{off} = \\lambda^2 + (k_{on}+k_{off})\\lambda + k_{on}k_{off} - k_{on}k_{off} = \\lambda(\\lambda + k_{on}+k_{off}) = 0$。\n        *   特征值是 $\\lambda_1 = 0$ 和 $\\lambda_2 = -(k_{on}+k_{off})$。\n        *   特征值 $\\lambda_1 = 0$ 对应于平稳分布。\n        *   时间演化由非零特征值决定。\n        *   对于平稳双态马尔可夫过程，其自相关函数已知为单指数衰减，其速率等于非零特征值的绝对值。\n        *   $C(\\tau) = \\exp(\\lambda_2 \\tau) = \\exp(-(k_{on}+k_{off})\\tau)$。\n        *   这证实了我之前的推导。结果是正确的。\n\n    *   **第4部分：灵敏度。**\n        *   $C(\\tau) = \\exp(-(k_{on}+k_{off})\\tau)$。\n        *   $S_{on}(\\tau) = \\frac{\\partial C(\\tau)}{\\partial k_{on}} = \\frac{\\partial}{\\partial k_{on}} \\exp(-(k_{on}+k_{off})\\tau)$。\n        *   使用链式法则：$S_{on}(\\tau) = \\exp(-(k_{on}+k_{off})\\tau) \\cdot (-\\tau)$。\n        *   $S_{off}(\\tau) = \\frac{\\partial C(\\tau)}{\\partial k_{off}} = \\frac{\\partial}{\\partial k_{off}} \\exp(-(k_{on}+k_{off})\\tau)$。\n        *   使用链式法则：$S_{off}(\\tau) = \\exp(-(k_{on}+k_{off})\\tau) \\cdot (-\\tau)$。\n        *   它们是相同的。\n\n    *   **第5部分：比率 R(τ)。**\n        *   $R(\\tau) = \\frac{S_{on}(\\tau)}{S_{off}(\\tau)} = \\frac{-\\tau \\exp(-(k_{on}+k_{off})\\tau)}{-\\tau \\exp(-(k_{on}+k_{off})\\tau)}$。\n        *   对于 $\\tau \\neq 0$，$R(\\tau) = 1$。问题陈述暗示 $\\tau \\ge 0$。在 $\\tau=0$ 时导数未定义（函数在该点不可微）。然而，如果我们取 $\\tau \\to 0^+$ 的极限，比率仍然是1。让我们假设比率指的是 $\\tau > 0$ 的情况。\n        *   这里可能有一个细微之处。问题要求 $\\tau \\ge 0$ 时的比率。在 $\\tau=0$ 时，$C(0)=1$，这是一个常数。它对参数的导数为0。所以 $S_{on}(0)=0$ 且 $S_{off}(0)=0$。比率是 $0/0$，这是未定式。\n        *   让我们再检查一下微分。\n        *   $C(\\tau) = \\exp(-(k_{on}+k_{off})\\tau)$ 对于 $\\tau \\ge 0$。\n        *   $\\frac{\\partial C(\\tau)}{\\partial k_{on}} = -\\tau \\exp(-(k_{on}+k_{off})\\tau)$。\n        *   $\\frac{\\partial C(\\tau)}{\\partial k_{off}} = -\\tau \\exp(-(k_{on}+k_{off})\\tau)$。\n        *   这些表达式对所有 $\\tau \\ge 0$ 都有效。在 $\\tau=0$ 时，两个导数都为 $0$。\n        *   比率 $R(\\tau) = \\frac{S_{on}(\\tau)}{S_{off}(\\tau)}$ 对于所有 $\\tau > 0$ 都为 $1$。\n        *   在 $\\tau=0$ 时，它是未定式。但通常，这类问题暗示 $\\tau > 0$，即函数实际衰减的部分。函数的形状由其在 $\\tau > 0$ 的行为定义。我们假设问题隐含地指 $\\tau>0$。\n        *   最终答案只是 $R(\\tau)$ 的表达式。所以，它就是 $1$。这似乎太简单了。让我非常仔细地重读问题。\n        *   “中心化启动子信号 $S(t)-\\mathbb{E}[S(t)]$ 的归一化自相关函数 $C(\\tau)$”\n        *   是的，这就是我计算的。$C(\\tau) = \\frac{\\text{Cov}(S(t+\\tau), S(t))}{\\text{Var}(S(t))}$。\n        *   我的推导似乎很可靠。$\\text{Cov}(S(t+\\tau), S(t)) = \\pi_1 \\pi_0 e^{-(k_{on}+k_{off})\\tau}$ 且 $\\text{Var}(S(t)) = \\pi_1 \\pi_0$。除法抵消了预因子。\n        *   这个问题是标准的。我对 $C(\\tau)$ 的推导是标准的。结果是一个速率为 $k = k_{on}+k_{off}$ 的单指数衰减。\n        *   因此，$C(\\tau) = \\exp(-k\\tau)$ 其中 $k=k_{on}+k_{off}$。\n        *   $\\frac{\\partial C}{\\partial k_{on}} = \\frac{\\partial C}{\\partial k} \\frac{\\partial k}{\\partial k_{on}} = (-\\tau e^{-k\\tau}) \\cdot 1 = -\\tau e^{-(k_{on}+k_{off})\\tau}$。\n        *   $\\frac{\\partial C}{\\partial k_{off}} = \\frac{\\partial C}{\\partial k} \\frac{\\partial k}{\\partial k_{off}} = (-\\tau e^{-k\\tau}) \\cdot 1 = -\\tau e^{-(k_{on}+k_{off})\\tau}$。\n        *   对于 $\\tau > 0$，比率确实是1。\n        *   也许我误解了“归一化自相关函数”。它可能是别的东西吗？\n        *   在某些情境下，归一化可能有不同的含义，但在时间序列分析中，它几乎普遍意味着用自协方差除以方差。\n        *   我的第一个推导是标准的和正确的。结果简单并不意味着它错了。事实上，它直接引出了问题的讨论部分。\n        *   我将坚持我的第一个推导。基于归一化自相关函数的标准定义，结果 $R(\\tau)=1$ 是正确的。\n\n    *   **第6部分：关于可辨识性的讨论。**\n        *   归一化自相关函数是 $C(\\tau) = \\exp(-(k_{on}+k_{off})\\tau)$。\n        *   当我们将这个函数拟合到实验数据（例如，来自荧光相关光谱法，FCS）时，我们只能确定衰减速率，即速率之和 $k_{decay} = k_{on} + k_{off}$。\n        *   我们无法仅从自相关曲线的*形状*中单独确定 $k_{on}$ 和 $k_{off}$。形状完全由和 $k_{on}+k_{off}$ 决定。任何满足 $k_{on}' + k_{off}' = k_{on} + k_{off}$ 的参数对 $(k_{on}', k_{off}')$ 都会产生相同的归一化自相关函数。\n        *   这是可辨识性问题的核心。$C(\\tau)$ 的形状只给了我们关于两个参数的一个约束。\n        *   问题要求提出一个补充的*稳态*测量。\n        *   我们有哪些稳态量？\n            *   平均启动子活性：$\\mu_S = \\mathbb{E}[S(t)] = \\pi_1 = \\frac{k_{on}}{k_{on}+k_{off}}$。\n            *   启动子活性的方差：$\\text{Var}(S(t)) = \\pi_1 \\pi_0 = \\frac{k_{on}k_{off}}{(k_{on}+k_{off})^2}$。\n        *   让我们看看将ACF形状与其中一个结合是否有帮助。\n        *   从ACF形状，我们得到 $k = k_{on} + k_{off}$ 的值。\n        *   如果我们还测量平均活性 $\\mu_S$，我们就有了一个包含两个未知数的两个方程的方程组：\n            1.  $k_{on} + k_{off} = k$\n            2.  $\\frac{k_{on}}{k_{on}+k_{off}} = \\mu_S$\n        *   从(2)，我们得到 $k_{on} / k = \\mu_S$，所以 $k_{on} = k \\mu_S$。\n        *   将此代入(1)：$k \\mu_S + k_{off} = k \\implies k_{off} = k(1 - \\mu_S)$。\n        *   这给出了 $k_{on}$ 和 $k_{off}$ 的唯一解：\n            *   $k_{on} = (k_{on}+k_{off}) \\frac{k_{on}}{k_{on}+k_{off}}$\n            *   $k_{off} = (k_{on}+k_{off}) \\frac{k_{off}}{k_{on}+k_{off}}$\n        *   因此，如果在测量自相关函数之外，我们还测量启动子的平均占据率（启动子处于活性状态的时间分数），该系统就变得可辨识。\n        *   如果我们改用方差呢？\n            1.  $k_{on} + k_{off} = k$\n            2.  $\\frac{k_{on}k_{off}}{(k_{on}+k_{off})^2} = \\text{Var}(S)$\n        *   从(2)，$\\frac{k_{on}k_{off}}{k^2} = \\text{Var}(S) \\implies k_{on}k_{off} = k^2 \\text{Var}(S)$。\n        *   我们有和 $k_{on}+k_{off}=k$ 以及积 $k_{on}k_{off} = P = k^2 \\text{Var}(S)$。\n        *   $k_{on}$ 和 $k_{off}$ 是二次方程 $x^2 - (\\text{根之和})x + (\\text{根之积}) = 0$ 的根。\n        *   $x^2 - kx + P = 0$。\n        *   根是 $x = \\frac{k \\pm \\sqrt{k^2 - 4P}}{2}$。\n        *   所以我们得到两个解，一个用于 $k_{on}$，一个用于 $k_{off}$。但是哪个是哪个呢？我们得到集合 $\\{k_{on}, k_{off}\\}$，但无法分配它们。例如，如果根是 $2$ 和 $5$，我们不知道 $(k_{on}, k_{off}) = (2,5)$ 还是 $(5,2)$。\n        *   因此，测量方差不足以唯一地辨识参数对 $(k_{on}, k_{off})$。它只能辨识集合 $\\{k_{on}, k_{off}\\}$。\n        *   然而，测量均值 $\\mu_S$ 是*足够的*。$\\mu_S = k_{on} / (k_{on}+k_{off})$。这个比率在交换 $k_{on}$ 和 $k_{off}$ 时是不对称的。\n        *   因此，建议的补充测量是稳态平均活性 $\\mathbb{E}[S(t)] = \\pi_1$。在实验上，这对应于在大量细胞中（由于遍历性）长时间测量平均报告基因信号。\n\n    *   **组织完整的回应。**\n        *   从问题验证开始。它是有效的。\n        *   开始解题。\n        *   定义状态和速率。写下主方程。\n        *   求解平稳概率 $\\pi_0$ 和 $\\pi_1$。\n        *   计算均值 $\\mu_S = \\mathbb{E}[S(t)]$ 和方差 $\\text{Var}(S(t))$。注意 $\\text{Var}(S(t))$ 是 $\\tau=0$ 时的自协方差。\n        *   推导自协方差函数。这需要计算条件概率 $P_{11}(\\tau)$。求解 $p_1(t)$ 的常微分方程，初始条件为 $p_1(0)=1$，得到 $P_{11}(\\tau)$。\n        *   使用 $P_{11}(\\tau)$ 找到 $\\mathbb{E}[S(t+\\tau)S(t)] = P_{11}(\\tau)\\pi_1$。\n        *   计算自协方差 $\\text{Cov}(S(t+\\tau),S(t)) = \\mathbb{E}[S(t+\\tau)S(t)] - \\mu_S^2$。证明它等于 $\\pi_1\\pi_0 \\exp(-(k_{on}+k_{off})\\tau)$。\n        *   定义归一化自相关函数 $C(\\tau) = \\frac{\\text{Cov}(\\tau)}{\\text{Cov}(0)}$。证明它简化为 $\\exp(-(k_{on}+k_{off})\\tau)$。\n        *   计算灵敏度 $S_{on}(\\tau) = \\partial C/\\partial k_{on}$ 和 $S_{off}(\\tau) = \\partial C/\\partial k_{off}$。\n        *   计算比率 $R(\\tau) = S_{on}/S_{off}$。\n        *   提供关于可辨识性的讨论，解释ACF形状只产生 $k_{on}+k_{off}$。\n        *   提出测量平均活性 $\\pi_1 = k_{on}/(k_{on}+k_{off})$ 作为补充测量。展示这与 $k_{on}+k_{off}$ 结合如何唯一地确定 $k_{on}$ 和 $k_{off}$。\n        *   最终答案框包含 $R(\\tau)$ 的表达式。也就是 $1$。这看起来简单，但它是对所提问题的正确答案。我不能仅仅因为结果简单就怀疑一个正确的推导。这种简单性正是重点，因为它突出了可辨识性问题。\n\n    *   **最终答案检查**：问题要求 $R(\\tau)$ 的封闭形式解析表达式。表达式为 $1$。这是一个常数，是有效的解析表达式。无单位，无舍入。看起来不错。\n\n    *   **最终逻辑双重检查：**\n        *   问题陈述：“中心化启动子信号 $S(t)-\\mathbb{E}[S(t)]$ 的归一化自相关函数 $C(\\tau)$”。\n        *   中心化信号：$X(t) = S(t) - \\mathbb{E}[S(t)]$。\n        *   $X(t)$ 的自相关：$R_X(\\tau) = \\mathbb{E}[X(t)X(t+\\tau)] = \\text{Cov}(S(t), S(t+\\tau))$。\n        *   归一化：$C(\\tau) = R_X(\\tau) / R_X(0) = \\text{Cov}(S(t), S(t+\\tau)) / \\text{Var}(S(t))$。\n        *   这是归一化自相关函数（也称为自相关系数函数）的标准定义。\n        *   推导得出 $C(\\tau) = \\exp(-(k_{on}+k_{off})\\tau)$。这是电报过程的标准结果。\n        *   导数为 $\\frac{\\partial C}{\\partial k_{on}} = -\\tau \\exp(-(k_{on}+k_{off})\\tau)$ 和 $\\frac{\\partial C}{\\partial k_{off}} = -\\tau \\exp(-(k_{on}+k_{off})\\tau)$。\n        *   这两个相同的非零函数（对于 $\\tau>0$）的比值为 $1$。\n        *   逻辑成立。结果的简单性是 $k_{on}$ 和 $k_{off}$ 在衰减速率中对称出现的直接后果。问题的讨论部分明确地询问了这一后果，因此这个简单的结果是该问题教学意义的组成部分。\n\n    *   **撰写：**\n        *   所有数学公式使用LaTeX。\n        *   从验证开始。\n        *   然后是解答，遵循计划。清晰、分步的推导。\n        *   讨论部分必须融入解答文本中。\n        *   最终答案框将包含 `$$\\boxed{1}$$`。\n\n我将现在撰写完整的答复。\n### 第1步：提取已知条件\n- **模型：** 连续时间双态马尔可夫过程（电报模型）。\n- **状态空间：** 启动子状态为 $S(t) \\in \\{0, 1\\}$，其中 $1$ 为活性，$0$ 为非活性。\n- **转换速率：** $k_{on}$ 对应转换 $0 \\to 1$，$k_{off}$ 对应转换 $1 \\to 0$。\n- **过程假设：** 过程是平稳且遍历的。\n- **测量：** 信号为 $S(t)$。\n- **任务1：** 推导中心化信号 $S(t) - \\mathbb{E}[S(t)]$ 在 $\\tau \\ge 0$ 时的归一化自相关函数 $C(\\tau)$。\n- **任务2：** 计算局部灵敏度 $S_{on}(\\tau) \\equiv \\partial C(\\tau)/\\partial k_{on}$ 和 $S_{off}(\\tau) \\equiv \\partial C(\\tau)/\\partial k_{off}$。\n- **任务3：** 计算比率 $R(\\tau) \\equiv S_{on}(\\tau) / S_{off}(\\tau)$。\n- **任务4：** 讨论仅凭 $C(\\tau)$ 的形状是否能辨识 $k_{on}$ 和 $k_{off}$。\n- **任务5：** 提出一个补充的稳态测量方法，以使 $(k_{on}, k_{off})$ 可辨识。\n- **报告要求：** 报告 $R(\\tau)$ 的封闭形式解析表达式。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据：** 该问题基于双态电报模型，这是系统生物学中用于描述随机基因表达的一个基础且广泛使用的模型。所有概念，包括连续时间马尔可夫链、自相关和灵敏度分析，都是数学和物理科学中的标准概念。\n- **良态问题：** 问题是良态的。平稳性假设保证了时间无关的稳态概率和时间平移不变的自相关函数的存在。指令具体，导向唯一的数学解。\n- **客观性：** 问题以精确、客观和形式化的数学语言陈述。\n\n该问题未表现出任何缺陷，如科学不准确、信息缺失或歧义。\n\n### 第3步：结论与行动\n该问题是**有效的**。将提供完整解答。\n\n启动子状态 $S(t)$ 遵循状态空间 $\\{0, 1\\}$ 上的连续时间马尔可夫链。令 $\\pi_0$ 和 $\\pi_1$ 分别为处于非活性状态 ($S=0$) 和活性状态 ($S=1$) 的平稳概率。处于活性状态的概率 $p_1(t) = \\mathbb{P}(S(t)=1)$ 的时间演化由主方程给出：\n$$\n\\frac{dp_1(t)}{dt} = k_{on} p_0(t) - k_{off} p_1(t)\n$$\n其中 $p_0(t) = 1 - p_1(t)$。在稳态下，$\\frac{dp_1}{dt}=0$，因此我们有：\n$$\nk_{on} \\pi_0 - k_{off} \\pi_1 = 0 \\quad \\text{且} \\quad \\pi_0 + \\pi_1 = 1\n$$\n将 $\\pi_0 = 1 - \\pi_1$ 代入第一个方程，得到 $k_{on}(1 - \\pi_1) - k_{off} \\pi_1 = 0$，解得：\n$$\n\\pi_1 = \\frac{k_{on}}{k_{on} + k_{off}} \\quad \\text{;} \\quad \\pi_0 = \\frac{k_{off}}{k_{on} + k_{off}}\n$$\n问题要求计算中心化信号 $X(t) = S(t) - \\mathbb{E}[S(t)]$ 的归一化自相关。首先，我们计算 $S(t)$ 的均值和方差。\n均值为 $\\mathbb{E}[S(t)] = 1 \\cdot \\pi_1 + 0 \\cdot \\pi_0 = \\pi_1$。\n方差为 $\\text{Var}(S(t)) = \\mathbb{E}[S(t)^2] - (\\mathbb{E}[S(t)])^2$。由于 $S(t)$ 是一个伯努利变量（$0$ 或 $1$），$S(t)^2 = S(t)$，因此 $\\mathbb{E}[S(t)^2] = \\mathbb{E}[S(t)] = \\pi_1$。\n$$\n\\text{Var}(S(t)) = \\pi_1 - \\pi_1^2 = \\pi_1(1-\\pi_1) = \\pi_1 \\pi_0 = \\frac{k_{on} k_{off}}{(k_{on} + k_{off})^2}\n$$\n归一化自相关函数 $C(\\tau)$ 定义为：\n$$\nC(\\tau) = \\frac{\\mathbb{E}[(S(t) - \\pi_1)(S(t+\\tau) - \\pi_1)]}{\\text{Var}(S(t))} = \\frac{\\text{Cov}(S(t), S(t+\\tau))}{\\text{Var}(S(t))}\n$$\n自协方差为 $\\text{Cov}(S(t), S(t+\\tau)) = \\mathbb{E}[S(t)S(t+\\tau)] - \\mathbb{E}[S(t)]\\mathbb{E}[S(t+\\tau)] = \\mathbb{E}[S(t)S(t+\\tau)] - \\pi_1^2$。\n乘积的期望使用条件概率计算：\n$$\n\\mathbb{E}[S(t)S(t+\\tau)] = \\sum_{i,j \\in \\{0,1\\}} ij \\cdot \\mathbb{P}(S(t)=i, S(t+\\tau)=j) = \\mathbb{P}(S(t)=1, S(t+\\tau)=1)\n$$\n$$\n\\mathbb{P}(S(t)=1, S(t+\\tau)=1) = \\mathbb{P}(S(t+\\tau)=1 | S(t)=1) \\mathbb{P}(S(t)=1) = P_{11}(\\tau) \\pi_1\n$$\n其中 $P_{11}(\\tau)$ 是在时刻 $0$ 系统处于状态 $1$ 的条件下，在时刻 $\\tau$ 处于状态 $1$ 的概率。我们通过求解主方程 $p_1(\\tau)$ 并代入初始条件 $p_1(0)=1$ 来找到 $P_{11}(\\tau)$：\n$$\n\\frac{dp_1}{dt} = k_{on} - (k_{on}+k_{off})p_1(t)\n$$\n这是一个线性一阶常微分方程，其解为：\n$$\np_1(\\tau) = \\frac{k_{on}}{k_{on}+k_{off}} + \\left(p_1(0) - \\frac{k_{on}}{k_{on}+k_{off}}\\right) \\exp(-(k_{on}+k_{off})\\tau)\n$$\n当 $p_1(0)=1$ 时，得到 $P_{11}(\\tau)$:\n$$\nP_{11}(\\tau) = \\pi_1 + (1-\\pi_1)\\exp(-(k_{on}+k_{off})\\tau) = \\pi_1 + \\pi_0 \\exp(-(k_{on}+k_{off})\\tau)\n$$\n现在我们可以计算自协方差：\n$$\n\\text{Cov}(S(t), S(t+\\tau)) = P_{11}(\\tau)\\pi_1 - \\pi_1^2 = (\\pi_1 + \\pi_0 e^{-(k_{on}+k_{off})\\tau})\\pi_1 - \\pi_1^2 = \\pi_1 \\pi_0 \\exp(-(k_{on}+k_{off})\\tau)\n$$\n归一化自相关函数是自协方差除以方差，而方差即为 $\\tau=0$ 时的自协方差：\n$$\nC(\\tau) = \\frac{\\pi_1 \\pi_0 \\exp(-(k_{on}+k_{off})\\tau)}{\\pi_1 \\pi_0} = \\exp(-(k_{on}+k_{off})\\tau)\n$$\n接下来，我们计算灵敏度 $S_{on}(\\tau)$ 和 $S_{off}(\\tau)$：\n$$\nS_{on}(\\tau) = \\frac{\\partial C(\\tau)}{\\partial k_{on}} = \\frac{\\partial}{\\partial k_{on}} \\exp(-(k_{on}+k_{off})\\tau) = -\\tau \\exp(-(k_{on}+k_{off})\\tau)\n$$\n$$\nS_{off}(\\tau) = \\frac{\\partial C(\\tau)}{\\partial k_{off}} = \\frac{\\partial}{\\partial k_{off}} \\exp(-(k_{on}+k_{off})\\tau) = -\\tau \\exp(-(k_{on}+k_{off})\\tau)\n$$\n因此，比率 $R(\\tau)$ 为：\n$$\nR(\\tau) = \\frac{S_{on}(\\tau)}{S_{off}(\\tau)} = \\frac{-\\tau \\exp(-(k_{on}+k_{off})\\tau)}{-\\tau \\exp(-(k_{on}+k_{off})\\tau)} = 1 \\quad (\\text{对于 } \\tau > 0)\n$$\n对于 $\\tau=0$，灵敏度为 $0$，比率为不定式，但对于任何表征衰减形状的 $\\tau>0$，该比率恰好为 $1$。\n\n这个结果直接引出了关于参数可辨识性的讨论。归一化自相关函数 $C(\\tau)$ 是一个单指数衰减，其速率仅由速率之和 $k_{decay} = k_{on} + k_{off}$ 决定。从实验数据（例如，使用荧光相关光谱法）中测量 $C(\\tau)$ 的形状可以确定 $k_{decay}$，但这只为两个参数 $k_{on}$ 和 $k_{off}$ 提供了一个约束。任何满足 $k'_{on}+k'_{off} = k_{decay}$ 的速率对 $(k'_{on}, k'_{off})$ 都会产生完全相同的归一化自相关函数。因此，仅凭 $C(\\tau)$ 的形状不足以单独辨识 $k_{on}$ 和 $k_{off}$。$R(\\tau)=1$ 的事实正式表明，$k_{on}$ 的变化对 $C(\\tau)$ 的影响与 $k_{off}$ 的相同变化完全一样，使得它们从 $C(\\tau)$ 的形状上无法区分。\n\n为了使参数对 $(k_{on}, k_{off})$ 可辨识，需要进行第二次独立的测量。一个合适的补充测量是一个稳态性质，它以不同的组合方式依赖于 $k_{on}$ 和 $k_{off}$。平均启动子活性 $\\mathbb{E}[S(t)] = \\pi_1$ 是一个理想的候选。这个量代表启动子处于活性状态的时间分数，可以通过对报告基因信号进行时间平均来实验测量。这样我们就会有一个包含两个未知数的两个方程的方程组：\n$$\n\\begin{cases}\nk_{on} + k_{off} = k_{decay} \\\\\n\\frac{k_{on}}{k_{on}+k_{off}} = \\pi_1\n\\end{cases}\n$$\n其中 $k_{decay}$ 从 ACF 形状确定，$\\pi_1$ 作为平均信号测量。该方程组的解是唯一的：\n$$\nk_{on} = \\pi_1 k_{decay}\n$$\n$$\nk_{off} = k_{decay} - k_{on} = (1 - \\pi_1) k_{decay}\n$$\n因此，通过将归一化自相关函数的形状与平均启动子活性的测量相结合，参数 $(k_{on}, k_{off})$ 就变得唯一可辨识。\n\n问题要求 $R(\\tau)$ 的封闭形式表达式。根据推导，结果为 $1$。",
            "answer": "$$\n\\boxed{1}\n$$"
        },
        {
            "introduction": "为了完全捕捉随机基因表达中固有的细胞间变异性，我们需要获得mRNA计数的完整概率分布，该分布由化学主方程（CME）控制。本实践介绍有限状态投影（FSP）方法，这是一种强大的数值算法，可以精确逼近通常难以处理的CME解。通过实施FSP算法，您将对如何计算概率分布并严格控制近似误差获得实践性的理解。",
            "id": "4388466",
            "problem": "考虑单细胞水平下基因表达的电报模型，其中启动子在非活性状态和活性状态之间进行随机切换，信使核糖核酸（mRNA）随时间合成和降解。该系统被建模为由化学主方程（CME）控制的连续时间马尔可夫链（CTMC）。令启动子状态由 $g \\in \\{0,1\\}$ 表示，其中 $g=0$ 代表非活性状态，$g=1$ 代表活性状态。令 mRNA 拷贝数由 $m \\in \\mathbb{N}_0$ 表示。启动子切换的速率为：从 $g=0$ 到 $g=1$ 的速率为 $k_{\\mathrm{on}}$，从 $g=1$ 到 $g=0$ 的速率为 $k_{\\mathrm{off}}$。当 $g=0$ 时，转录速率为 $s_0$；当 $g=1$ 时，转录速率为 $s_1$。每个 mRNA 分子的降解速率为 $\\gamma$，即从 $m$ 到 $m-1$ 的跃迁速率为 $\\gamma m$。其基本基础是化学主方程的定义以及 CTMC 的概率守恒。\n\n您必须：\n- 使用投影集 $S_M = \\{(g,m) \\mid g \\in \\{0,1\\}, m \\in \\{0,1,\\dots,M\\}\\}$（其中 $M \\in \\mathbb{N}_0$ 是 mRNA 数量的投影大小限制）来构建电报模型 CME 的有限状态投影（FSP）截断。通过增加一个吸收汇状态 $\\varnothing$ 来扩展 CTMC，该状态收集所有因任何将 $m$ 增加到超过 $M$ 的跃迁而离开 $S_M$ 的概率流。\n- 推导在时间 $t$ 的截断误差的上界，该误差定义为真实 CME 解中位于 $S_M$ 之外的概率质量，并将此上界明确表示为投影大小 $M$ 的函数。您的推导必须从 CME 和概率守恒出发，不得使用预先推导的简化公式。\n- 通过为 $S_M \\cup \\{\\varnothing\\}$ 上的 FSP 增广 CTMC 构建生成元矩阵，并对指定的时间范围 $T$ 积分前向常微分方程 $\\mathrm{d} \\mathbf{p}(t) / \\mathrm{d} t = A_M \\mathbf{p}(t)$，来实现一个截断系统的数值求解器。使用一个初始条件 $\\mathbf{p}(0)$，使其概率 $1$ 集中在 $(g,m)=(0,0)$，而在其他地方为 $0$。\n\n定义生成元 $A_M$，其约定为：对于从源状态 $i$ 到目标状态 $j$ 的跃迁，条目 $A_M[j,i]$ 等于从 $i$ 到 $j$ 的跃迁速率，从而确保概率守恒意味着 $A_M$ 的每一列之和为 $0$。对于汇状态 $\\varnothing$，不定义任何出向跃迁，即汇是吸收性的。截断误差上界必须是 FSP 增广系统产生的汇概率 $p_{\\varnothing}(t)$，并且您必须使用第一性原理解释此上界的合理性。\n\n您的程序必须为每个测试用例计算最终时间 $T$ 的上界值 $p_{\\varnothing}(T)$。速率或时间不需要物理单位；在计算中将它们视为无量纲数。不涉及角度。\n\n测试套件：\n- 情况 $1$ (一般情况): $k_{\\mathrm{on}}=1.0$, $k_{\\mathrm{off}}=1.5$, $s_0=0.0$, $s_1=5.0$, $\\gamma=1.0$, $M=50$, $T=5.0$。\n- 情况 $2$ (边界截断压力): $k_{\\mathrm{on}}=2.0$, $k_{\\mathrm{off}}=0.5$, $s_0=0.0$, $s_1=20.0$, $\\gamma=1.0$, $M=5$, $T=5.0$。\n- 情况 $3$ (无切换边缘情况): $k_{\\mathrm{on}}=0.0$, $k_{\\mathrm{off}}=0.0$, $s_0=0.0$, $s_1=5.0$, $\\gamma=1.0$, $M=10$, $T=10.0$。\n- 情况 $4$ (基础转录与慢降解): $k_{\\mathrm{on}}=0.2$, $k_{\\mathrm{off}}=2.0$, $s_0=1.0$, $s_1=8.0$, $\\gamma=0.5$, $M=20$, $T=10.0$。\n- 情况 $5$ (快速降解): $k_{\\mathrm{on}}=3.0$, $k_{\\mathrm{off}}=3.0$, $s_0=0.0$, $s_1=5.0$, $\\gamma=5.0$, $M=30$, $T=5.0$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，即 $[p_{\\varnothing}^{(1)},p_{\\varnothing}^{(2)},p_{\\varnothing}^{(3)},p_{\\varnothing}^{(4)},p_{\\varnothing}^{(5)}]$，其中 $p_{\\varnothing}^{(k)}$ 是为测试用例 $k$ 在其指定的最终时间 $T$ 计算出的上界。",
            "solution": "该问题要求使用有限状态投影（FSP）方法分析随机基因表达的电报模型。我们必须首先构建化学主方程（CME）的 FSP 截断，然后推导截断误差的上界，最后实现一个数值求解器来为几个测试用例计算这个上界。\n\n令系统的状态为 $(g, m)$，其中 $g \\in \\{0, 1\\}$ 是启动子状态（非活性/活性），$m \\in \\mathbb{N}_0$ 是 mRNA 分子的数量。系统作为连续时间马尔可夫链（CTMC）演化，具有以下跃迁和速率：\n- 启动子激活：$(0, m) \\to (1, m)$，速率为 $k_{\\mathrm{on}}$。\n- 启动子失活：$(1, m) \\to (0, m)$，速率为 $k_{\\mathrm{off}}$。\n- 转录（基础）：$(0, m) \\to (0, m+1)$，速率为 $s_0$。\n- 转录（活性）：$(1, m) \\to (1, m+1)$，速率为 $s_1$。\n- mRNA 降解：$(g, m) \\to (g, m-1)$，对于任何 $g \\in \\{0,1\\}$ 和 $m>0$，速率为 $\\gamma m$。\n\n令 $P(g, m, t)$ 为在时间 $t$ 处于状态 $(g, m)$ 的概率。这些概率的时间演化由化学主方程（CME）控制。对于 $m > 0$，CME 方程为：\n$$\n\\frac{d P(0, m, t)}{dt} = k_{\\mathrm{off}} P(1, m, t) + s_0 P(0, m-1, t) + \\gamma (m+1) P(0, m+1, t) - (k_{\\mathrm{on}} + s_0 + \\gamma m) P(0, m, t)\n$$\n$$\n\\frac{d P(1, m, t)}{dt} = k_{\\mathrm{on}} P(0, m, t) + s_1 P(1, m-1, t) + \\gamma (m+1) P(1, m+1, t) - (k_{\\mathrm{off}} + s_1 + \\gamma m) P(1, m, t)\n$$\n对于边界情况 $m=0$，降解项 $\\gamma m$ 为零，并且没有从 $m=-1$ 的状态流入：\n$$\n\\frac{d P(0, 0, t)}{dt} = k_{\\mathrm{off}} P(1, 0, t) + \\gamma P(0, 1, t) - (k_{\\mathrm{on}} + s_0) P(0, 0, t)\n$$\n$$\n\\frac{d P(1, 0, t)}{dt} = k_{\\mathrm{on}} P(0, 0, t) + \\gamma P(1, 1, t) - (k_{\\mathrm{off}} + s_1) P(1, 0, t)\n$$\n这是一个无限的耦合线性常微分方程（ODE）组，通常难以直接求解。\n\n有限状态投影（FSP）方法提供了一种近似求解的方法。我们对于某个整数 $M \\ge 0$，将无限状态空间截断为一个有限投影集 $S_M = \\{(g,m) \\mid g \\in \\{0,1\\}, m \\in \\{0, 1, \\dots, M\\}\\}$。FSP 方法对 $S_M$ 内状态的概率演化进行建模。为了解释离开这个有限集的概率，我们通过一个吸收汇状态（表示为 $\\varnothing$）来扩展系统。我们的新的有限 CTMC 的状态空间是 $S_M \\cup \\{\\varnothing\\}$。任何从 $S_M$ 中的状态导致到 $S_M$ 之外的状态的反应都被重新路由到汇状态 $\\varnothing$。在这个模型中，唯一的此类跃迁是来自 $m=M$ 状态的转录事件：\n- $(0, M) \\to \\varnothing$，速率为 $s_0$。\n- $(1, M) \\to \\varnothing$，速率为 $s_1$。\n\n令 $p_{(g,m)}(t)$ 为在这个 FSP 增广系统中处于状态 $(g,m) \\in S_M$ 的概率， $p_{\\varnothing}(t)$ 为处于汇状态的概率。总概率是守恒的：$\\sum_{(g,m) \\in S_M} p_{(g,m)}(t) + p_{\\varnothing}(t) = 1$。汇概率的时间演化由流出 $S_M$ 的通量驱动：\n$$\n\\frac{d p_{\\varnothing}(t)}{dt} = s_0 p_{(0,M)}(t) + s_1 p_{(1,M)}(t)\n$$\n初始条件为 $p_{\\varnothing}(0)=0$。\n\nFSP 的一个关键性质是，在汇状态中累积的概率 $p_{\\varnothing}(t)$ 为真实的截断误差提供了一个上界。截断误差 $E_M(t)$ 是原始无限系统中位于 $S_M$ 之外的状态的概率质量：\n$$\nE_M(t) = \\sum_{g \\in \\{0,1\\}} \\sum_{m=M+1}^{\\infty} P(g, m, t)\n$$\n我们需要从第一性原理证明对于所有 $t \\ge 0$ 都有 $p_{\\varnothing}(t) \\ge E_M(t)$。\n令 $\\mathbf{P}_F(t)$ 为有限集 $S_M$ 内状态的真实概率 $P(g,m,t)$ 构成的向量。$\\mathbf{P}_F(t)$ 的时间演化可以写为：\n$$\n\\frac{d \\mathbf{P}_F(t)}{dt} = A_F \\mathbf{P}_F(t) + \\mathbf{r}(t)\n$$\n此处，$A_F$ 是限制在 $S_M$ 内状态的生成元矩阵，其中离开 $S_M$ 的跃迁被视为概率损失。项 $\\mathbf{r}(t)$ 是一个表示从 $S_M$ 外部状态回流到 $S_M$ 内部的概率流入的向量。具体来说，这种流入来自降解反应 $(g, M+1) \\to (g, M)$。因此，$\\mathbf{r}(t)$ 的分量是非负的，其中 $r_{(g,M)}(t) = \\gamma (M+1) P(g, M+1, t) \\ge 0$，所有其他分量为零。\n现在，考虑 FSP 公式中 $S_M$ 内状态的概率 $\\mathbf{p}(t)$（不包括汇状态）。它们的演化遵循：\n$$\n\\frac{d \\mathbf{p}(t)}{dt} = A_F \\mathbf{p}(t)\n$$\n令 $\\mathbf{d}(t) = \\mathbf{P}_F(t) - \\mathbf{p}(t)$ 为差异向量。其动态为：\n$$\n\\frac{d \\mathbf{d}(t)}{dt} = A_F \\mathbf{d}(t) + \\mathbf{r}(t)\n$$\n问题指定的初始条件是 $(g,m)=(0,0)$，它在 $S_M$ 内部（对于任何 $M \\ge 0$）。因此，$\\mathbf{P}_F(0) = \\mathbf{p}(0)$，这意味着 $\\mathbf{d}(0) = \\mathbf{0}$。矩阵 $A_F$ 具有非负的非对角元素，这是 CTMC 生成元矩阵的一个性质。驱动项 $\\mathbf{r}(t)$ 是一个分量非负的向量。对于这种形式的线性系统（一个正系统），如果初始状态非负且输入非负，则状态向量在所有时间内都保持非负。由于 $\\mathbf{d}(0)=\\mathbf{0}$，我们可以得出结论，对于所有 $t \\ge 0$，$\\mathbf{d}(t) \\ge \\mathbf{0}$。这意味着对于所有 $(g,m) \\in S_M$ 和 $t \\ge 0$，都有 $P(g, m, t) \\ge p_{(g,m)}(t)$。\n原始系统中的总概率为 $1$：$\\sum_{(g,m) \\in S_M} P(g,m,t) + E_M(t) = 1$。\nFSP 增广系统中的总概率也为 $1$：$\\sum_{(g,m) \\in S_M} p_{(g,m)}(t) + p_{\\varnothing}(t) = 1$。\n截断误差为 $E_M(t) = 1 - \\sum_{(g,m) \\in S_M} P(g,m,t)$。\n从我们推导的不等式中，$\\sum P(g,m,t) \\ge \\sum p_{(g,m)}(t)$。\n因此，$-\\sum P(g,m,t) \\le -\\sum p_{(g,m)}(t)$，这导致：\n$$\nE_M(t) = 1 - \\sum_{(g,m) \\in S_M} P(g,m,t) \\le 1 - \\sum_{(g,m) \\in S_M} p_{(g,m)}(t) = p_{\\varnothing}(t)\n$$\n这证实了汇状态的概率 $p_{\\varnothing}(t)$ 是真实截断误差的一个可计算上界。\n\n为了计算 $p_{\\varnothing}(T)$，我们求解 FSP 增广 CTMC 的有限 ODE 系统。我们将系统表示为矩阵形式 $\\frac{d\\mathbf{p}(t)}{dt} = A_M \\mathbf{p}(t)$，其中 $\\mathbf{p}(t)$ 是状态概率向量，$A_M$ 是生成元矩阵。状态向量按如下方式排序：\n$\\mathbf{p} = [p_{(0,0)}, \\dots, p_{(0,M)}, p_{(1,0)}, \\dots, p_{(1,M)}, p_{\\varnothing}]^T$。\n这给出了总共 $N = 2(M+1)+1$ 个状态。生成元矩阵 $A_M$ 是一个 $N \\times N$ 矩阵，其中 $A_M[j,i]$ 是从状态 $i$ 到状态 $j$ 的跃迁速率。\n\n$A_M$ 的非对角线元素（对于源状态 $i=(g,m)$）如下：\n1.  **转录**：对于 $m  M$，状态 $(g,m)$ 以速率 $s_g$ 跃迁到 $(g,m+1)$。如果我们用 $i(g', m')$ 来索引状态 $(g', m')$，这意味着 $A_M[i(g, m+1), i(g, m)] = s_g$。\n2.  **降解**：对于 $m > 0$，状态 $(g,m)$ 以速率 $\\gamma m$ 跃迁到 $(g,m-1)$。这意味着 $A_M[i(g, m-1), i(g, m)] = \\gamma m$。\n3.  **切换**：对于任何 $m \\in \\{0, \\dots, M\\}$，状态 $(0,m)$ 以速率 $k_{\\mathrm{on}}$ 跃迁到 $(1,m)$，状态 $(1,m)$ 以速率 $k_{\\mathrm{off}}$ 跃迁到 $(0,m)$。这意味着 $A_M[i(1, m), i(0, m)] = k_{\\mathrm{on}}$ 和 $A_M[i(0, m), i(1, m)] = k_{\\mathrm{off}}$。\n4.  **到汇的流**：对于边界状态 $m=M$，转录跃迁被重新路由到汇状态 $\\varnothing$，其索引为 $N-1 = 2(M+1)$。\n    - $A_M[N-1, i(0, M)] = s_0$。\n    - $A_M[N-1, i(1, M)] = s_1$。\n对角线元素被设置为使每列之和为零，这代表了离开一个状态的总速率：$A_M[i, i] = - \\sum_{j \\neq i} A_M[j,i]$。对于吸收汇状态， $A_M$ 中对应的列全为零。\n\n构建好矩阵 $A_M$ 后，我们求解初始值问题 $\\frac{d\\mathbf{p}}{dt} = A_M \\mathbf{p}(t)$，其中 $\\mathbf{p}(0)$ 是一个在对应于状态 $(0,0)$ 的位置为 $1$、其他位置为 $0$ 的向量。通过数值积分到最终时间 $T$ 来获得解。所期望的误差上界是汇状态在最终时刻的概率 $p_{\\varnothing}(T)$，即解向量 $\\mathbf{p}(T)$ 的最后一个元素。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the Finite State Projection formulation of the telegraph model\n    for several test cases and computes the truncation error upper bound.\n    \"\"\"\n    test_cases = [\n        # Case 1 (general case)\n        {'kon': 1.0, 'koff': 1.5, 's0': 0.0, 's1': 5.0, 'gamma': 1.0, 'M': 50, 'T': 5.0},\n        # Case 2 (boundary-truncation stress)\n        {'kon': 2.0, 'koff': 0.5, 's0': 0.0, 's1': 20.0, 'gamma': 1.0, 'M': 5, 'T': 5.0},\n        # Case 3 (no-switching edge)\n        {'kon': 0.0, 'koff': 0.0, 's0': 0.0, 's1': 5.0, 'gamma': 1.0, 'M': 10, 'T': 10.0},\n        # Case 4 (basal transcription with slow degradation)\n        {'kon': 0.2, 'koff': 2.0, 's0': 1.0, 's1': 8.0, 'gamma': 0.5, 'M': 20, 'T': 10.0},\n        # Case 5 (fast degradation)\n        {'kon': 3.0, 'koff': 3.0, 's0': 0.0, 's1': 5.0, 'gamma': 5.0, 'M': 30, 'T': 5.0},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        kon, koff, s0, s1, gamma = case['kon'], case['koff'], case['s0'], case['s1'], case['gamma']\n        M, T = case['M'], case['T']\n\n        # The state space for the FSP is {(g, m) | g in {0,1}, m in {0,...,M}}\n        # plus one absorbing sink state.\n        # Total number of states = 2 * (M + 1) + 1\n        num_states = 2 * (M + 1) + 1\n        \n        # Generator matrix A, where A[j, i] is the rate from state i to state j.\n        A = np.zeros((num_states, num_states))\n\n        # Index mapping:\n        # g=0, m -> m\n        # g=1, m -> M + 1 + m\n        # sink   -> 2 * (M + 1)\n        sink_idx = 2 * (M + 1)\n\n        for m in range(M + 1):\n            # State (0, m)\n            idx0 = m\n            # State (1, m)\n            idx1 = M + 1 + m\n\n            # Promoter switching\n            A[idx1, idx0] = kon\n            A[idx0, idx1] = koff\n\n            # Degradation\n            if m > 0:\n                # From (0, m) to (0, m-1)\n                A[idx0 - 1, idx0] = gamma * m\n                # From (1, m) to (1, m-1)\n                A[idx1 - 1, idx1] = gamma * m\n        \n            # Transcription\n            if m  M:\n                # From (0, m) to (0, m+1)\n                A[idx0 + 1, idx0] = s0\n                # From (1, m) to (1, m+1)\n                A[idx1 + 1, idx1] = s1\n            else: # m == M, transcription leads to sink state\n                A[sink_idx, idx0] = s0\n                A[sink_idx, idx1] = s1\n\n        # Set diagonal elements to ensure columns sum to zero\n        # This conserves probability.\n        for i in range(num_states - 1): # Exclude the sink state column\n            A[i, i] = -np.sum(A[:, i])\n\n        # The column for the sink state is all zeros as it's absorbing.\n        A[:, sink_idx] = 0.0\n\n        # Initial condition: probability 1 in state (g=0, m=0), 0 elsewhere.\n        p0 = np.zeros(num_states)\n        p0[0] = 1.0\n\n        # Define the ODE system for the solver\n        def ode_system(t, p, A_matrix):\n            return A_matrix @ p\n\n        # Solve the ODE system\n        sol = solve_ivp(\n            fun=ode_system,\n            t_span=(0, T),\n            y0=p0,\n            args=(A,),\n            method='Radau', # Good for stiff problems\n            t_eval=[T]\n        )\n\n        # The result is the probability in the sink state at time T.\n        p_final = sol.y[:, -1]\n        p_sink = p_final[sink_idx]\n        results.append(p_sink)\n\n    # Format output as a comma-separated list in brackets\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "系统生物学的一个核心目标是从实验数据（如单细胞RNA测序计数）中推断基因表达的潜在动力学参数。本实践将向您介绍层级贝叶斯模型，这是一种先进的统计方法，用于估计细胞特异性参数，同时在整个细胞群体中借鉴信息。通过此实践，您将学会量化“收缩效应”，这是层级模型的一个标志性特征，它能提供更稳定和更切合实际的参数估计。",
            "id": "4388424",
            "problem": "考虑一个系统生物医学中单细胞水平的随机基因表达情景，其中转录以脉冲方式发生。在一个持续时间为 $\\Delta t$ 的固定观察窗口内，假设每个细胞 $i$ 产生一个信使核糖核酸（mRNA）分子的计数 $x_i$。假设一个简化的脉冲模型，其中对于每个细胞 $i$，在给定细胞特异性的平均脉冲大小 $b_i$（每个脉冲的 mRNA 分子数）和细胞间共同的脉冲频率 $f$（单位时间的脉冲数）的条件下，观察到的计数被建模为一个速率为 $f \\, \\Delta t \\, b_i$ 的泊松随机变量。也就是说，对于每个细胞 $i$，\n$$\nx_i \\mid b_i \\sim \\text{Poisson}(f \\, \\Delta t \\, b_i).\n$$\n假设在细胞间，$b_i$ 服从形状参数为 $\\alpha$、速率参数为 $\\beta$ 的 Gamma 先验，记作 $b_i \\sim \\text{Gamma}(\\alpha,\\beta)$，其中 Gamma 密度采用形状-速率参数化，并且速率参数的约定是较大的 $\\beta$ 意味着更强的收缩。在积分掉 $b_i$ 后，这会在群体水平上为 $x_i$ 导出负二项分布，这与稳态下的脉冲式基因表达相一致。\n\n您的任务是通过计算后验收缩效应及其对估计脉冲参数的影响，来比较分层分析与合并分析。对于分层分析，使用经验贝叶斯方法，通过匹配泊松-Gamma 混合分布的前两阶矩，从观测计数 $\\{x_i\\}_{i=1}^N$ 中估计超参数 $(\\alpha,\\beta)$。令 $c = f \\, \\Delta t$ 表示已知的暴露缩放因子。将细胞间的样本均值表示为\n$$\nm = \\frac{1}{N} \\sum_{i=1}^N x_i,\n$$\n并将总体（非无偏）样本方差表示为\n$$\ns^2 = \\frac{1}{N} \\sum_{i=1}^N (x_i - m)^2.\n$$\n泊松-Gamma 混合分布意味着\n$$\n\\mathbb{E}[x_i] = c \\, \\frac{\\alpha}{\\beta} = m, \\quad \\text{Var}(x_i) = c \\, \\frac{\\alpha}{\\beta} + c^2 \\, \\frac{\\alpha}{\\beta^2} = s^2.\n$$\n通过矩方法求解这些方程可得\n$$\n\\hat{\\alpha} = \\frac{m^2}{s^2 - m}, \\quad \\hat{\\beta} = c \\, \\frac{\\hat{\\alpha}}{m},\n$$\n前提是 $s^2  m$。在边界情况 $s^2 \\le m$（没有超出泊松分布的过度离散）下，将 $\\hat{\\alpha}$ 设置为一个大值（例如，$\\hat{\\alpha} = 10^6$）并将 $\\hat{\\beta} = c \\, \\hat{\\alpha} / m$ 以反映可忽略的过度离散；如果 $m = 0$，则设置 $\\hat{\\alpha} = 10^{-6}$ 和 $\\hat{\\beta} = 10^{-6}$ 以避免除以零。\n\n在分层模型下，给定 $x_i$ 时每个 $b_i$ 的后验是共轭的：\n$$\nb_i \\mid x_i \\sim \\text{Gamma}(\\hat{\\alpha} + x_i, \\hat{\\beta} + c),\n$$\n因此分层后验均值为\n$$\n\\hat{b}_i^{\\text{hier}} = \\frac{\\hat{\\alpha} + x_i}{\\hat{\\beta} + c}.\n$$\n对于条件泊松模型下脉冲大小的单细胞最大似然估计（MLE），\n$$\n\\hat{b}_i^{\\text{MLE}} = \\frac{x_i}{c}.\n$$\n将每个细胞的分层后验收缩差异（单位为每个脉冲的 mRNA 分子数）定义为\n$$\ns_i = \\hat{b}_i^{\\text{hier}} - \\hat{b}_i^{\\text{MLE}}.\n$$\n\n对于合并分析，假设所有细胞共享一个单一的脉冲大小参数 $b_{\\text{pool}}$，其先验为 $b_{\\text{pool}} \\sim \\text{Gamma}(\\alpha_0, \\beta_0)$。使用所有细胞的合并似然，\n$$\nb_{\\text{pool}} \\mid x_{1:N} \\sim \\text{Gamma}\\left(\\alpha_0 + \\sum_{i=1}^N x_i,\\, \\beta_0 + N c \\right),\n$$\n合并后验均值为\n$$\n\\hat{b}^{\\text{pool}} = \\frac{\\alpha_0 + \\sum_{i=1}^N x_i}{\\beta_0 + N c}.\n$$\n将每个细胞的合并影响差异定义为\n$$\nd_i = \\hat{b}^{\\text{pool}} - \\hat{b}_i^{\\text{hier}}.\n$$\n\n对于每个测试用例，计算以下三个摘要指标：\n1. 平均分层收缩差异\n$$\n\\overline{s} = \\frac{1}{N} \\sum_{i=1}^N s_i,\n$$\n单位为每个脉冲的 mRNA 分子数，四舍五入到六位小数。\n2. 平均绝对合并影响差异\n$$\n\\overline{|d|} = \\frac{1}{N} \\sum_{i=1}^N |d_i|,\n$$\n单位为每个脉冲的 mRNA 分子数，四舍五入到六位小数。\n3. 比率\n$$\nR = \\frac{\\hat{b}^{\\text{pool}}}{\\frac{1}{N} \\sum_{i=1}^N \\hat{b}_i^{\\text{hier}}},\n$$\n无量纲，四舍五入到六位小数。\n\n使用以下涵盖一般情况、边界条件和边缘情况的参数值测试套件：\n- 测试用例 1：$x_{1:10} = [\\,3,\\,0,\\,1,\\,5,\\,2,\\,4,\\,6,\\,1,\\,0,\\,3\\,]$，$f = 0.5$ (脉冲/分钟)，$\\Delta t = 2$ (分钟)，因此 $c = 1$。合并先验超参数：$\\alpha_0 = 1$，$\\beta_0 = 1$。\n- 测试用例 2：$x_{1:8} = [\\,0,\\,0,\\,0,\\,1,\\,2,\\,0,\\,3,\\,0\\,]$，$f = 1$ (脉冲/分钟)，$\\Delta t = 1$ (分钟)，因此 $c = 1$。合并先验超参数：$\\alpha_0 = 0.5$，$\\beta_0 = 0.5$。\n- 测试用例 3：$x_{1:12} = [\\,10,\\,15,\\,12,\\,8,\\,20,\\,5,\\,18,\\,11,\\,7,\\,9,\\,14,\\,16\\,]$，$f = 2$ (脉冲/分钟)，$\\Delta t = 3$ (分钟)，因此 $c = 6$。合并先验超参数：$\\alpha_0 = 1$，$\\beta_0 = 0.1$。\n- 测试用例 4：$x_{1:3} = [\\,2,\\,9,\\,1\\,]$，$f = 0.2$ (脉冲/分钟)，$\\Delta t = 5$ (分钟)，因此 $c = 1$。合并先验超参数：$\\alpha_0 = 2$，$\\beta_0 = 2$。\n\n您的程序必须实现 $(\\hat{\\alpha}, \\hat{\\beta})$ 的经验贝叶斯估计，计算 $\\hat{b}_i^{\\text{hier}}$、$\\hat{b}_i^{\\text{MLE}}$、$\\hat{b}^{\\text{pool}}$，然后为每个测试用例生成三个指标 $(\\overline{s}, \\overline{|d|}, R)$。所有涉及脉冲大小的输出都必须视为每个脉冲的 mRNA 分子数。最终输出格式必须是单行输出，包含所有测试用例结果的逗号分隔列表，该列表被展平并用方括号括起来，具体为\n$$\n[\\overline{s}_1,\\overline{|d|}_1,R_1,\\overline{s}_2,\\overline{|d|}_2,R_2,\\overline{s}_3,\\overline{|d|}_3,R_3,\\overline{s}_4,\\overline{|d|}_4,R_4],\n$$\n其中每个条目都是四舍五入到六位小数的浮点数。",
            "solution": "目标是在脉冲式转录模型中比较分层分析与合并分析，通过量化后验收缩效应及其对单细胞水平上估计脉冲参数的影响。我们从适用于随机基因表达的基本原理出发。\n\n首先，我们采用一种与双态启动子模型（电报模型）及其脉冲式极限一致的机理观点：转录事件以脉冲方式发生，在短观察窗口 $\\Delta t$ 内，每个细胞 $i$ 累积的 mRNA 计数可以近似为一个条件泊松随机变量，该变量以一个潜在的细胞特异性生产参数为条件。设 $b_i$ 表示平均脉冲大小（每个脉冲的 mRNA 分子数），并设 $f$ 表示脉冲频率（单位时间内的脉冲数）。那么在时间 $\\Delta t$ 内的预期产量为 $f \\, \\Delta t \\, b_i$，因此我们设定\n$$\nx_i \\mid b_i \\sim \\text{Poisson}(f \\, \\Delta t \\, b_i),\n$$\n其中 $x_i$ 是细胞 $i$ 的观测 mRNA 计数。这个条件泊松模型源于以下假设：事件随时间以速率 $f$ 独立到达，每次平均产生 $b_i$ 个分子，这与稳态下脉冲式转录的广泛使用的近似方法相一致。\n\n其次，为了捕捉细胞间脉冲大小的变异性，我们假定一个 Gamma 先验 $b_i \\sim \\text{Gamma}(\\alpha,\\beta)$，使用形状-速率参数化。这一假设因其数学上的易处理性和生物学上的可解释性，在共轭贝叶斯建模中被广泛使用：Gamma 先验反映了群体水平上细胞间脉冲大小的异质性。泊松分布与 Gamma 分布的混合意味着细胞间 $x_i$ 的边际分布为负二项分布，这是在脉冲式生产下单细胞转录组学中一个经过充分检验的事实。\n\n我们现在通过经验贝叶斯推导一个分层贝叶斯估计器。定义已知的暴露缩放因子 $c = f \\, \\Delta t$。泊松-Gamma 混合分布意味着总体均值和方差（根据全期望定律和全方差定律）：\n$$\n\\mathbb{E}[x_i] = \\mathbb{E}\\left[\\mathbb{E}[x_i \\mid b_i]\\right] = \\mathbb{E}[c \\, b_i] = c \\, \\frac{\\alpha}{\\beta},\n$$\n$$\n\\text{Var}(x_i) = \\mathbb{E}[\\text{Var}(x_i \\mid b_i)] + \\text{Var}(\\mathbb{E}[x_i \\mid b_i]) = \\mathbb{E}[c \\, b_i] + \\text{Var}(c \\, b_i) = c \\, \\frac{\\alpha}{\\beta} + c^2 \\, \\frac{\\alpha}{\\beta^2}.\n$$\n从观测数据 $\\{x_i\\}_{i=1}^N$ 中，计算样本均值\n$$\nm = \\frac{1}{N} \\sum_{i=1}^N x_i\n$$\n和总体（非无偏）样本方差\n$$\ns^2 = \\frac{1}{N} \\sum_{i=1}^N (x_i - m)^2.\n$$\n通过矩匹配得到两个关于未知数 $(\\alpha,\\beta)$ 的方程：\n$$\nm = c \\, \\frac{\\alpha}{\\beta}, \\quad s^2 = c \\, \\frac{\\alpha}{\\beta} + c^2 \\, \\frac{\\alpha}{\\beta^2}.\n$$\n相减可得\n$$\ns^2 - m = c^2 \\, \\frac{\\alpha}{\\beta^2}.\n$$\n求解可得\n$$\n\\hat{\\alpha} = \\frac{m^2}{s^2 - m}, \\quad \\hat{\\beta} = c \\, \\frac{\\hat{\\alpha}}{m},\n$$\n假设 $s^2  m$。边界情况 $s^2 \\le m$ 表明变异性至多为泊松变异性，没有额外的超泊松离散；在这种情况下，我们强制 $\\hat{\\alpha}$ 为大值（例如 $\\hat{\\alpha} = 10^6$），并设置 $\\hat{\\beta} = c \\, \\hat{\\alpha} / m$ 以维持 $\\mathbb{E}[x_i] = m$（如果 $m = 0$，则使用 $\\hat{\\alpha} = 10^{-6}, \\hat{\\beta} = 10^{-6}$ 以避免除以零）。这种正则化在适当的情况下强制向样本均值进行强收缩。\n\n得到 $(\\hat{\\alpha}, \\hat{\\beta})$ 后，每个 $b_i$ 的共轭后验为\n$$\nb_i \\mid x_i \\sim \\text{Gamma}(\\hat{\\alpha} + x_i, \\hat{\\beta} + c),\n$$\n其后验均值为\n$$\n\\hat{b}_i^{\\text{hier}} = \\frac{\\hat{\\alpha} + x_i}{\\hat{\\beta} + c}.\n$$\n作为比较，条件泊松似然下的单细胞最大似然估计（MLE）为\n$$\n\\hat{b}_i^{\\text{MLE}} = \\frac{x_i}{c}.\n$$\n细胞 $i$ 的分层后验收缩差异为\n$$\ns_i = \\hat{b}_i^{\\text{hier}} - \\hat{b}_i^{\\text{MLE}},\n$$\n单位是每个脉冲的 mRNA 分子数，它量化了每个细胞的收缩效应（从 MLE 到分层后验均值的移动）。对所有细胞取平均值可得\n$$\n\\overline{s} = \\frac{1}{N} \\sum_{i=1}^N s_i,\n$$\n单位同样是每个脉冲的 mRNA 分子数。\n\n对于合并分析，我们假设所有细胞共享一个单一的脉冲大小参数 $b_{\\text{pool}}$，其先验为 $b_{\\text{pool}} \\sim \\text{Gamma}(\\alpha_0, \\beta_0)$，且似然由各细胞泊松似然的乘积构成。根据共轭性，\n$$\nb_{\\text{pool}} \\mid x_{1:N} \\sim \\text{Gamma}\\left(\\alpha_0 + \\sum_{i=1}^N x_i,\\, \\beta_0 + N c \\right),\n$$\n因此合并后验均值为\n$$\n\\hat{b}^{\\text{pool}} = \\frac{\\alpha_0 + \\sum_{i=1}^N x_i}{\\beta_0 + N c}.\n$$\n细胞 $i$ 的合并影响差异为\n$$\nd_i = \\hat{b}^{\\text{pool}} - \\hat{b}_i^{\\text{hier}},\n$$\n所有细胞的平均绝对影响为\n$$\n\\overline{|d|} = \\frac{1}{N} \\sum_{i=1}^N |d_i|,\n$$\n单位也是每个脉冲的 mRNA 分子数。最后，为比较合并缩放与分层缩放，计算比率\n$$\nR = \\frac{\\hat{b}^{\\text{pool}}}{\\frac{1}{N} \\sum_{i=1}^N \\hat{b}_i^{\\text{hier}}},\n$$\n此比率为无量纲；请注意，当通过经验贝叶斯设置分层超参数时，分层后验均值的平均值通常会跟随按 $c$ 缩放的样本均值，而合并后验均值则包含了合并先验 $\\text{Gamma}(\\alpha_0,\\beta_0)$ 和暴露量 $N c$，这可能会引入差异，并反映在 $R$ 中。\n\n因此，每个测试用例的算法步骤如下：\n1. 计算 $c = f \\, \\Delta t$。\n2. 使用总体方差，从观测到的 $x_i$ 列表中计算 $m$ 和 $s^2$。\n3. 通过矩方法估计 $(\\hat{\\alpha}, \\hat{\\beta})$，并在 $s^2 \\le m$ 或 $m = 0$ 时应用边界正则化。\n4. 对每个细胞，计算 $\\hat{b}_i^{\\text{hier}} = (\\hat{\\alpha} + x_i)/(\\hat{\\beta} + c)$ 和 $\\hat{b}_i^{\\text{MLE}} = x_i/c$，然后计算 $s_i = \\hat{b}_i^{\\text{hier}} - \\hat{b}_i^{\\text{MLE}}$。\n5. 通过对 $s_i$ 取平均值计算 $\\overline{s}$。\n6. 计算合并后验均值 $\\hat{b}^{\\text{pool}} = (\\alpha_0 + \\sum x_i)/(\\beta_0 + N c)$。\n7. 计算 $d_i = \\hat{b}^{\\text{pool}} - \\hat{b}_i^{\\text{hier}}$，然后计算 $\\overline{|d|} = \\frac{1}{N} \\sum |d_i|$。\n8. 计算 $R = \\hat{b}^{\\text{pool}} / \\left(\\frac{1}{N} \\sum \\hat{b}_i^{\\text{hier}}\\right)$。\n9. 将 $\\overline{s}$、$\\overline{|d|}$ 和 $R$ 四舍五入到六位小数。\n10. 输出单行，包含展平的列表 $[\\overline{s}_1,\\overline{|d|}_1,R_1,\\overline{s}_2,\\overline{|d|}_2,R_2,\\overline{s}_3,\\overline{|d|}_3,R_3,\\overline{s}_4,\\overline{|d|}_4,R_4]$。\n\n该方法体现了基于原理的推理：它从脉冲式生产的条件泊松模型出发，使用泊松-Gamma 混合分布的全期望定律和全方差定律（这在单细胞分析中得到了广泛检验），利用共轭性以获得分析上的易处理性，并通过矩方法使用经验贝叶斯来从数据中估计超参数。边界处理确保了当数据未表现出超出泊松噪声的过度离散时，模型的科学真实性。计算出的指标以可量化的方式描述了收缩和合并影响，并且对于差异使用适当的单位（每个脉冲的 mRNA 分子数），对于 $R$ 则为无量纲比率。.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef empirical_bayes_hyperparams(counts, c, large_alpha=1e6):\n    \"\"\"\n    Estimate Gamma(shape=alpha, rate=beta) hyperparameters for burst size b_i\n    from Poisson-Gamma mixture moments, handling boundary cases.\n    \"\"\"\n    x = np.array(counts, dtype=float)\n    N = x.size\n    m = x.mean()\n    # Population (non-unbiased) variance\n    s2 = ((x - m) ** 2).mean()\n\n    if m == 0.0:\n        # Degenerate case: no counts observed\n        alpha_hat = 1e-6\n        beta_hat = 1e-6\n        return alpha_hat, beta_hat\n\n    if s2 > m:\n        alpha_hat = (m ** 2) / (s2 - m)\n        beta_hat = c * alpha_hat / m\n    else:\n        # No over-dispersion beyond Poisson; enforce strong shrinkage to mean\n        alpha_hat = large_alpha\n        beta_hat = c * alpha_hat / m\n\n    return alpha_hat, beta_hat\n\ndef hierarchical_post_means(counts, alpha_hat, beta_hat, c):\n    \"\"\"\n    Compute hierarchical posterior means for burst size b_i given counts.\n    Posterior: Gamma(alpha_hat + x_i, beta_hat + c), mean = (alpha_hat + x_i)/(beta_hat + c).\n    \"\"\"\n    x = np.array(counts, dtype=float)\n    denom = beta_hat + c\n    return (alpha_hat + x) / denom\n\ndef mle_burst_sizes(counts, c):\n    \"\"\"\n    Per-cell MLE for burst size under Poisson model: b_i_hat = x_i / c.\n    \"\"\"\n    x = np.array(counts, dtype=float)\n    return x / c\n\ndef pooled_posterior_mean(counts, alpha0, beta0, c):\n    \"\"\"\n    Pooled posterior mean for single burst size parameter across all cells:\n    Gamma(alpha0 + sum x_i, beta0 + N*c), mean = (alpha0 + sum x_i)/(beta0 + N*c).\n    \"\"\"\n    x = np.array(counts, dtype=float)\n    N = x.size\n    return (alpha0 + x.sum()) / (beta0 + N * c)\n\ndef summarize_metrics(counts, f, dt, alpha0, beta0):\n    \"\"\"\n    For a single test case, compute:\n    - average hierarchical shrinkage difference: mean(hier_mean - mle)\n    - average absolute pooled impact difference: mean(abs(pool_mean - hier_mean))\n    - ratio R: pool_mean / mean(hier_mean)\n    All bursts differences are in mRNA molecules per burst. Ratio is dimensionless.\n    \"\"\"\n    c = f * dt\n    alpha_hat, beta_hat = empirical_bayes_hyperparams(counts, c)\n    hier_means = hierarchical_post_means(counts, alpha_hat, beta_hat, c)\n    mle_means = mle_burst_sizes(counts, c)\n    shrink_diff = hier_means - mle_means\n    avg_shrink = float(shrink_diff.mean())\n\n    pool_mean = pooled_posterior_mean(counts, alpha0, beta0, c)\n    pooled_impact = pool_mean - hier_means\n    avg_abs_pooled_impact = float(np.mean(np.abs(pooled_impact)))\n\n    avg_hier_mean = float(hier_means.mean())\n    # Guard against division by zero in ratio\n    if avg_hier_mean == 0.0:\n        R = float('inf') if pool_mean > 0 else 1.0\n    else:\n        R = pool_mean / avg_hier_mean\n\n    # Round to six decimals as specified\n    return (round(avg_shrink, 6), round(avg_abs_pooled_impact, 6), round(R, 6))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1\n        {\n            \"counts\": [3, 0, 1, 5, 2, 4, 6, 1, 0, 3],\n            \"f\": 0.5, \"dt\": 2.0,\n            \"alpha0\": 1.0, \"beta0\": 1.0\n        },\n        # Test case 2\n        {\n            \"counts\": [0, 0, 0, 1, 2, 0, 3, 0],\n            \"f\": 1.0, \"dt\": 1.0,\n            \"alpha0\": 0.5, \"beta0\": 0.5\n        },\n        # Test case 3\n        {\n            \"counts\": [10, 15, 12, 8, 20, 5, 18, 11, 7, 9, 14, 16],\n            \"f\": 2.0, \"dt\": 3.0,\n            \"alpha0\": 1.0, \"beta0\": 0.1\n        },\n        # Test case 4\n        {\n            \"counts\": [2, 9, 1],\n            \"f\": 0.2, \"dt\": 5.0,\n            \"alpha0\": 2.0, \"beta0\": 2.0\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        counts = case[\"counts\"]\n        f = case[\"f\"]\n        dt = case[\"dt\"]\n        alpha0 = case[\"alpha0\"]\n        beta0 = case[\"beta0\"]\n        avg_shrink, avg_abs_pooled_impact, R = summarize_metrics(counts, f, dt, alpha0, beta0)\n        # Append the three metrics per test case\n        results.extend([f\"{avg_shrink:.6f}\", f\"{avg_abs_pooled_impact:.6f}\", f\"{R:.6f}\"])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}