{
    "hands_on_practices": [
        {
            "introduction": "Understanding single-cell transcriptome data begins with a firm grasp of the data generation process itself. The capture of messenger RNA (mRNA) molecules within a droplet is not an exhaustive census but rather a stochastic sampling process. This exercise  provides a first-principles model for this fundamental step, using a Poisson distribution to connect a key experimental parameter—capture efficiency—to the resulting number of unique transcripts observed. Mastering this calculation builds a crucial intuition for the inherent sparsity of scRNA-seq data and provides a foundation for more complex generative models of gene expression.",
            "id": "4378852",
            "problem": "A droplet-based single-cell ribonucleic acid sequencing (scRNA-seq) protocol tags complementary deoxyribonucleic acid (cDNA) fragments with Unique Molecular Identifiers (UMIs) so that polymerase chain reaction (PCR) duplicates can be collapsed to the original molecule level. Consider a single cell that contains a total of $N$ distinct ribonucleic acid (RNA) molecules. Assume the following model grounded in standard stochastic sampling used in high-throughput sequencing:\n\n- For each original RNA molecule, the downstream library preparation and sequencing generate a random number of captured cDNA fragments, each carrying a UMI, modeled as an independent Poisson-distributed random variable with mean (capture efficiency) $\\eta$, where $\\eta$ encapsulates the cumulative efficiency of reverse transcription, ligation, and detection steps.\n- After UMI deduplication, a molecule is deemed \"observed\" if and only if at least one cDNA fragment from that molecule was captured.\n- Molecules act independently, and there is no length bias or saturation in capture at the parameter regime considered.\n\nFrom this model and fundamental properties of the Poisson distribution and expectation, derive an expression for the expected number of unique transcripts (i.e., distinct original RNA molecules) observed in this cell after UMI deduplication, expressed in terms of $N$ and $\\eta$. Provide your final answer as a single closed-form analytic expression. No rounding is required.",
            "solution": "The goal is to find the expected number of unique transcripts observed after UMI deduplication.\n\nLet $C_i$ be the random variable representing the number of cDNA fragments captured from the $i$-th original RNA molecule, where $i$ ranges from $1$ to $N$. According to the problem statement, $C_i$ follows a Poisson distribution with mean $\\eta$.\n$$\nC_i \\sim \\text{Poisson}(\\eta)\n$$\nThe probability mass function (PMF) for a Poisson-distributed random variable is given by:\n$$\nP(C_i = k) = \\frac{\\eta^k \\exp(-\\eta)}{k!}\n$$\nfor $k = 0, 1, 2, \\ldots$.\n\nA molecule is considered \"observed\" if at least one cDNA fragment from it is captured. This corresponds to the event $C_i \\ge 1$. The probability of this event, which we can denote as $p_{obs}$, is the same for all molecules due to the independence assumption. We can calculate this probability by considering the complement event, which is that zero fragments are captured ($C_i = 0$).\n$$\np_{obs} = P(C_i \\ge 1) = 1 - P(C_i = 0)\n$$\nUsing the Poisson PMF for $k=0$:\n$$\nP(C_i = 0) = \\frac{\\eta^0 \\exp(-\\eta)}{0!} = \\frac{1 \\cdot \\exp(-\\eta)}{1} = \\exp(-\\eta)\n$$\nTherefore, the probability of observing a single, specific molecule is:\n$$\np_{obs} = 1 - \\exp(-\\eta)\n$$\nTo find the total number of observed unique molecules, we can define an indicator random variable, $I_i$, for each of the $N$ molecules:\n$$\nI_i =\n\\begin{cases}\n1 & \\text{if molecule } i \\text{ is observed (i.e., } C_i \\ge 1\\text{)} \\\\\n0 & \\text{if molecule } i \\text{ is not observed (i.e., } C_i = 0\\text{)}\n\\end{cases}\n$$\nThe total number of observed unique molecules, let's call it $M_{obs}$, is the sum of these indicator variables:\n$$\nM_{obs} = \\sum_{i=1}^{N} I_i\n$$\nWe are asked to find the expected number of observed unique molecules, which is $E[M_{obs}]$. By the linearity of expectation, the expectation of a sum is the sum of the expectations:\n$$\nE[M_{obs}] = E\\left[\\sum_{i=1}^{N} I_i\\right] = \\sum_{i=1}^{N} E[I_i]\n$$\nThe expectation of an indicator random variable is equal to the probability of the event it indicates. Thus, for each molecule $i$:\n$$\nE[I_i] = (1 \\cdot P(I_i=1)) + (0 \\cdot P(I_i=0)) = P(I_i=1) = p_{obs}\n$$\nWe have already found that $p_{obs} = 1 - \\exp(-\\eta)$. Since this probability is the same for all $N$ molecules, we have:\n$$\nE[M_{obs}] = \\sum_{i=1}^{N} (1 - \\exp(-\\eta))\n$$\nThis is a sum of $N$ identical terms, so it simplifies to:\n$$\nE[M_{obs}] = N(1 - \\exp(-\\eta))\n$$\nThis expression gives the expected number of unique transcripts observed in the cell as a function of the total number of distinct molecules $N$ and the capture efficiency $\\eta$.",
            "answer": "$$\n\\boxed{N(1 - \\exp(-\\eta))}\n$$"
        },
        {
            "introduction": "From modeling data generation, we move to a critical, practical question: how do we design an experiment to ensure we can answer our biological questions? A common goal is the discovery and characterization of rare cell populations, but this is only possible if the experiment is designed with sufficient statistical power. This practice exercise  guides you through the process of calculating the minimum number of cells required to detect a rare cell type at a desired level of statistical confidence. This type of power analysis is an indispensable skill for any researcher, as it directly informs the feasibility, scale, and potential success of a single-cell study.",
            "id": "4378856",
            "problem": "Design a statistically principled sampling strategy for a single-cell ribonucleic acid sequencing (scRNA-seq) experiment aimed at detecting a rare cell type in a single biological sample. Assume each captured cell is independently and identically classified into cell types, and the presence of the target cell type in the captured set follows a binomial model with true prevalence $p$ in the sample. The count of target-type cells among $n$ captured cells is modeled as a binomial random variable $X \\sim \\mathrm{Bin}(n,p)$, reflecting independent Bernoulli trials with success probability $p$.\n\nYou will use a one-sided hypothesis testing framework to formalize “detection” as rejecting a null hypothesis that the target type is absent in the captured set. The significance level $\\alpha$ is the maximum Type I error rate tolerated, and the power $1-\\beta$ is the minimum probability to correctly detect the target type when its true prevalence equals $p$. The decision rule is based on a critical count threshold $k_{\\mathrm{crit}}$ such that observing $X \\geq k_{\\mathrm{crit}}$ constitutes “detection.”\n\nStarting from the binomial model and the definitions of significance and power, derive an expression for the minimal per-sample cell count $n_{\\min}(p,\\alpha,\\beta)$ needed to guarantee power at least $1-\\beta$ while controlling the significance at $\\alpha$ under the idealized null hypothesis that the target type is absent in the captured set. Then, compute the minimal per-sample cell count for $p=0.01$, $\\alpha=0.05$, and $\\beta=0.2$. Report the minimal integer $n$ that satisfies the design constraints. If any approximation is used, express the final numerical answer to four significant figures. No physical units are required for the answer.",
            "solution": "The solution proceeds as follows.\n\n1.  **Formulation of the Hypothesis Test and Determination of $k_{\\mathrm{crit}}$**\n\nLet $X$ be the random variable for the number of detected target cells out of a total of $n$ cells, with $X \\sim \\mathrm{Bin}(n, p)$.\nThe hypothesis test is:\n- Null Hypothesis $H_0: p = 0$ (the cell type is absent).\n- Alternative Hypothesis $H_1: p > 0$ (the cell type is present).\n\nThe significance level $\\alpha$ is the maximum probability of a Type I error: $\\alpha \\geq P(X \\geq k_{\\mathrm{crit}} | p=0)$.\nUnder $H_0: p=0$, $P(X=0 | p=0) = 1$ and $P(X=k | p=0) = 0$ for any integer $k > 0$. To have a non-trivial test, we must choose a critical value $k_{\\mathrm{crit}} \\geq 1$. For any such choice, the Type I error probability is $P(X \\geq k_{\\mathrm{crit}} | p=0) = 0$. Since the given significance level is $\\alpha=0.05$, the condition $0 \\leq 0.05$ is always satisfied. To maximize power, we choose the smallest possible critical value, $k_{\\mathrm{crit}}=1$. The decision rule is: \"detection\" occurs if we observe at least one target cell, i.e., $X \\geq 1$.\n\n2.  **Derivation of Minimal Sample Size $n_{\\min}$ from the Power Constraint**\n\nThe power is the probability of detection when the true prevalence is $p$. The power constraint is $P(X \\geq 1 | p) \\geq 1-\\beta$. Using the complement rule:\n$$ 1 - P(X=0 | p) \\geq 1-\\beta $$\nThis simplifies to:\n$$ P(X=0 | p) \\leq \\beta $$\nFor a binomial distribution $X \\sim \\mathrm{Bin}(n, p)$, the probability of $X=0$ is $P(X=0 | p) = (1-p)^n$. The inequality becomes:\n$$ (1-p)^n \\leq \\beta $$\nTo solve for $n$, we take the natural logarithm of both sides:\n$$ n \\ln(1-p) \\leq \\ln(\\beta) $$\nSince $0 < p < 1$, $\\ln(1-p)$ is negative. Dividing by a negative number reverses the inequality:\n$$ n \\geq \\frac{\\ln(\\beta)}{\\ln(1-p)} $$\nThe minimal integer cell count, $n_{\\min}$, is the ceiling of this expression:\n$$ n_{\\min}(p, \\alpha, \\beta) = \\left\\lceil \\frac{\\ln(\\beta)}{\\ln(1-p)} \\right\\rceil $$\nThe dependence on $\\alpha$ is satisfied by our choice of $k_{\\mathrm{crit}}=1$, which is valid for any $\\alpha > 0$.\n\n3.  **Numerical Calculation**\n\nFor the parameters $p=0.01$, $\\alpha=0.05$, and $\\beta=0.2$:\n$$ n \\geq \\frac{\\ln(0.2)}{\\ln(1-0.01)} = \\frac{\\ln(0.2)}{\\ln(0.99)} $$\nCalculating the values:\n$$ n \\geq \\frac{-1.60943791}{-0.01005034} \\approx 160.137 $$\nSince the number of cells $n$ must be an integer, we take the smallest integer that satisfies the condition:\n$$ n_{\\min} = \\lceil 160.137 \\rceil = 161 $$\nA minimum of 161 cells must be captured to satisfy the design constraints.",
            "answer": "$$\n\\boxed{161}\n$$"
        },
        {
            "introduction": "Once data is collected, we must use appropriate statistical models to interpret it. UMI-based count data is characterized by two key features: a variance that often exceeds the mean (overdispersion) and a large proportion of zero counts. This exercise  delves into the gamma-Poisson mixture model, which gives rise to the Negative Binomial distribution—the workhorse model in modern scRNA-seq analysis. By working through this model, you will gain a rigorous understanding of how both overdispersion and high zero counts can arise naturally from a single, unified statistical framework, clarifying why explicit \"zero-inflated\" components are often unnecessary for UMI data.",
            "id": "4378811",
            "problem": "Consider a single gene measured in single-cell ribonucleic acid sequencing (single-cell RNA-seq) using Unique Molecular Identifiers (UMI). Under UMI-based protocols, deduplication ensures each captured messenger ribonucleic acid (mRNA) molecule contributes at most one count, so the observed count for a gene in a cell can be modeled as a sampling outcome. A core, well-tested modeling approach in systems biomedicine for UMI counts is the following hierarchical model: conditional on a latent expression intensity, the observed count is a Poisson sample, and the latent intensity varies across cells due to biological heterogeneity. Specifically, let the observed UMI count for the gene in a randomly chosen cell be $Y$, and the latent intensity be $\\Lambda$. Assume $Y \\mid \\Lambda \\sim \\operatorname{Poisson}(\\Lambda)$, and the latent intensity follows a gamma distribution $\\Lambda \\sim \\operatorname{Gamma}(\\theta, \\text{rate}=\\theta/\\mu)$ so that $\\mathbb{E}[\\Lambda] = \\mu$ and $\\operatorname{Var}[\\Lambda] = \\mu^{2}/\\theta$. This gamma-Poisson mixture produces a negative binomial marginal for $Y$ with mean $\\mu$ and variance $\\mu + \\mu^{2}/\\theta$.\n\nUsing only these fundamental definitions and the hierarchical structure described above, provide a first-principles argument for why explicit zero inflation is often unnecessary for UMI data under appropriate models, addressing the origin of zeros as sampling zeros and how the gamma-Poisson mixture naturally captures both mean-variance structure and zero frequency without an additional zero-generating mechanism. Then, derive the closed-form expression for the marginal probability of observing a zero count, $\\mathbb{P}(Y = 0)$, in terms of the parameters $\\mu$ and $\\theta$ under the gamma-Poisson model specified.\n\nYour final answer must be the single analytic expression for $\\mathbb{P}(Y = 0)$. No numerical approximation is required, and no units are needed.",
            "solution": "The modeling of Unique Molecular Identifier (UMI) counts in single-cell RNA-seq leverages key properties of the protocol: PCR amplification bias is mitigated by deduplication, and each captured mRNA molecule contributes at most one count. This supports using a Poisson sampling model for observed counts conditional on a latent intensity. Biological heterogeneity between cells induces variation in this latent intensity. A widely accepted representation of this heterogeneity is a gamma distribution, producing a gamma-Poisson mixture (i.e., a negative binomial marginal).\n\nExplicit zero inflation is often unnecessary because zeros arise naturally from this framework. Conditional on the latent intensity $\\Lambda$, the probability of a zero count is $\\mathbb{P}(Y = 0 \\mid \\Lambda) = \\exp(-\\Lambda)$. Cells with low latent intensity $\\Lambda$ will frequently produce \"sampling zeros\". When $\\Lambda$ itself varies according to a gamma distribution that includes low values, the model naturally generates a high frequency of zero counts by integrating over this cellular heterogeneity. This gamma-Poisson mixture inherently produces both overdispersion and elevated zero frequencies consistent with empirical UMI data, obviating the need for a separate structural zero-generating process, provided appropriate normalization and covariates are included in the model.\n\nWe now derive the closed-form expression for the marginal zero probability $\\mathbb{P}(Y=0)$ under the specified gamma-Poisson model. Given $Y \\mid \\Lambda \\sim \\operatorname{Poisson}(\\Lambda)$ and $\\Lambda \\sim \\operatorname{Gamma}(\\theta, \\text{rate}=\\theta/\\mu)$, the probability density function of $\\Lambda$ is\n$$\nf_{\\Lambda}(\\lambda) = \\frac{(\\theta/\\mu)^{\\theta}}{\\Gamma(\\theta)} \\lambda^{\\theta - 1} \\exp\\!\\left(-\\frac{\\theta}{\\mu}\\lambda\\right), \\quad \\lambda > 0.\n$$\nThe marginal zero probability is the expectation of the conditional zero probability over the distribution of $\\Lambda$:\n$$\n\\mathbb{P}(Y = 0) = \\mathbb{E}\\big[\\mathbb{P}(Y = 0 \\mid \\Lambda)\\big] = \\mathbb{E}\\big[\\exp(-\\Lambda)\\big] = \\int_{0}^{\\infty} \\exp(-\\lambda) \\, f_{\\Lambda}(\\lambda) \\, d\\lambda.\n$$\nSubstituting the gamma density:\n$$\n\\mathbb{P}(Y = 0) = \\int_{0}^{\\infty} \\exp(-\\lambda) \\, \\frac{(\\theta/\\mu)^{\\theta}}{\\Gamma(\\theta)} \\lambda^{\\theta - 1} \\exp\\!\\left(-\\frac{\\theta}{\\mu}\\lambda\\right) d\\lambda = \\frac{(\\theta/\\mu)^{\\theta}}{\\Gamma(\\theta)} \\int_{0}^{\\infty} \\lambda^{\\theta - 1} \\exp\\!\\left(-\\left[1 + \\frac{\\theta}{\\mu}\\right]\\lambda\\right) d\\lambda.\n$$\nThe integral is a standard form related to the gamma function. For $c > 0$ and $\\alpha > 0$, $\\int_{0}^{\\infty} x^{\\alpha - 1} \\exp(-c x) \\, dx = \\frac{\\Gamma(\\alpha)}{c^{\\alpha}}$.\nSetting $\\alpha = \\theta$ and $c = 1 + \\theta/\\mu$, the integral evaluates to $\\frac{\\Gamma(\\theta)}{\\left(1 + \\frac{\\theta}{\\mu}\\right)^{\\theta}}$.\nSubstituting this back:\n$$\n\\mathbb{P}(Y = 0) = \\frac{(\\theta/\\mu)^{\\theta}}{\\Gamma(\\theta)} \\cdot \\frac{\\Gamma(\\theta)}{\\left(1 + \\frac{\\theta}{\\mu}\\right)^{\\theta}} = \\left(\\frac{\\theta/\\mu}{1 + \\theta/\\mu}\\right)^{\\theta} = \\left(\\frac{\\theta}{\\mu+\\theta}\\right)^{\\theta}.\n$$\nThis expression, also commonly written as $(1 + \\mu/\\theta)^{-\\theta}$, is the probability of a zero count for a negative binomial distribution parameterized by mean $\\mu$ and dispersion $\\theta$.",
            "answer": "$$\\boxed{\\left(\\frac{\\theta}{\\theta+\\mu}\\right)^{\\theta}}$$"
        }
    ]
}