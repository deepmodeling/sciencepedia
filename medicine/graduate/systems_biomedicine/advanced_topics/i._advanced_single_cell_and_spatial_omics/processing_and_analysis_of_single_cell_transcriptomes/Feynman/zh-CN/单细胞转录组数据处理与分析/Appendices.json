{
    "hands_on_practices": [
        {
            "introduction": "单细胞转录组数据的一个显著特征是其稀疏性——在表达矩阵中存在大量的零值。这些零值部分源于生物学现实（基因未表达），但更主要的是源于技术限制，即并非细胞中的每个RNA分子都能被成功捕获和测序。本练习通过一个基础的泊松捕获模型，帮助您量化这一过程，从而深入理解技术的“捕获效率” $\\eta$ 如何直接决定我们能观察到的独特转录本的期望数量。通过推导这个关系 ，您将对单细胞数据的内在属性及其与实验技术的关联建立起一个核心的数学直觉。",
            "id": "4378852",
            "problem": "一种基于液滴的单细胞核糖核酸测序 (scRNA-seq) 方案，使用独特分子标识符 (UMI) 来标记互补脱氧核糖核酸 (cDNA) 片段，以便将聚合酶链式反应 (PCR) 产生的扩增产物合并到原始分子水平。考虑一个包含总共 $N$ 个不同核糖核酸 (RNA) 分子的单细胞。假设以下模型基于高通量测序中使用的标准随机抽样：\n\n- 对于每个原始 RNA 分子，下游文库制备和测序会生成随机数量的携带 UMI 的捕获 cDNA 片段，该数量被建模为一个独立的泊松分布随机变量，其均值（捕获效率）为 $\\eta$。其中 $\\eta$ 包含了逆转录、连接和检测步骤的累积效率。\n- 经过 UMI 去重后，当且仅当一个分子的至少一个 cDNA 片段被捕获时，该分子才被视为“观测到”。\n- 分子之间独立作用，在所考虑的参数范围内，捕获过程没有长度偏好或饱和现象。\n\n根据此模型以及泊松分布和期望的基本性质，推导一个表达式，用于表示在该细胞中经过 UMI 去重后观测到的独特转录本（即不同的原始 RNA 分子）的期望数量，该表达式用 $N$ 和 $\\eta$ 表示。请以单一闭合形式的解析表达式给出最终答案。无需进行四舍五入。",
            "solution": "首先，我们验证此问题的有效性。\n\n**步骤 1：提取已知条件**\n- 单细胞中不同核糖核酸 (RNA) 分子的总数：$N$。\n- 每个原始 RNA 分子捕获到的互补脱氧核糖核酸 (cDNA) 片段的数量是一个随机变量。\n- 该随机变量服从均值为 $\\eta$ 的独立泊松分布。\n- $\\eta$ 代表捕获效率。\n- 当且仅当一个分子的至少一个 cDNA 片段被捕获时，该分子被定义为“观测到”。\n- 所有 $N$ 个分子独立作用。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于生物信息学中用于分析单细胞 RNA 测序 (scRNA-seq) 数据的标准且广泛使用的随机模型。使用泊松分布对分子捕获进行建模以及使用独特分子标识符 (UMI) 进行去重是该领域的基础。该模型是一个有效且科学上切合实际的简化。\n- **良态问题：** 问题陈述清晰，给出的条件（$N$、$\\eta$、泊松模型）足以推导出所求量（观测到的独特转录本的期望数量）的唯一且有意义的解。\n- **客观性：** 问题使用精确、技术性和无偏见的语言陈述。\n\n该问题科学上合理、定义明确且表述客观，因此是有效的。问题有效，开始求解。\n\n**推导**\n\n目标是求出经过 UMI 去重后观测到的独特转录本的期望数量。\n\n令 $C_i$ 为从第 $i$ 个原始 RNA 分子捕获的 cDNA 片段数量的随机变量，其中 $i$ 的范围为 1 到 $N$。根据问题陈述，$C_i$ 服从均值为 $\\eta$ 的泊松分布。\n$$\nC_i \\sim \\text{Poisson}(\\eta)\n$$\n泊松分布随机变量的概率质量函数 (PMF) 由下式给出：\n$$\nP(C_i = k) = \\frac{\\eta^k \\exp(-\\eta)}{k!}\n$$\n对于 $k = 0, 1, 2, \\ldots$。\n\n如果一个分子的至少一个 cDNA 片段被捕获，则该分子被视为“观测到”。这对应于事件 $C_i \\ge 1$。由于独立性假设，对于所有分子，此事件的概率（我们可以表示为 $p_{obs}$）是相同的。我们可以通过考虑其补事件，即捕获到零个片段 ($C_i = 0$)，来计算此概率。\n$$\np_{obs} = P(C_i \\ge 1) = 1 - P(C_i = 0)\n$$\n使用 $k=0$ 时的泊松 PMF：\n$$\nP(C_i = 0) = \\frac{\\eta^0 \\exp(-\\eta)}{0!} = \\frac{1 \\cdot \\exp(-\\eta)}{1} = \\exp(-\\eta)\n$$\n因此，观测到单个特定分子的概率为：\n$$\np_{obs} = 1 - \\exp(-\\eta)\n$$\n为了求出观测到的独特分子的总数，我们可以为 $N$ 个分子中的每一个定义一个指示随机变量 $I_i$：\n$$\nI_i =\n\\begin{cases}\n1  \\text{如果分子 } i \\text{ 被观测到（即 } C_i \\ge 1\\text{）} \\\\\n0  \\text{如果分子 } i \\text{ 未被观测到（即 } C_i = 0\\text{）}\n\\end{cases}\n$$\n观测到的独特分子的总数，我们称之为 $M_{obs}$，是这些指示变量的总和：\n$$\nM_{obs} = \\sum_{i=1}^{N} I_i\n$$\n我们要求的是观测到的独特分子的期望数量，即 $E[M_{obs}]$。根据期望的线性性质，和的期望等于期望的和：\n$$\nE[M_{obs}] = E\\left[\\sum_{i=1}^{N} I_i\\right] = \\sum_{i=1}^{N} E[I_i]\n$$\n指示随机变量的期望等于它所指示的事件的概率。因此，对于每个分子 $i$：\n$$\nE[I_i] = (1 \\cdot P(I_i=1)) + (0 \\cdot P(I_i=0)) = P(I_i=1) = p_{obs}\n$$\n我们已经求得 $p_{obs} = 1 - \\exp(-\\eta)$。由于这个概率对于所有 $N$ 个分子都是相同的，我们有：\n$$\nE[M_{obs}] = \\sum_{i=1}^{N} (1 - \\exp(-\\eta))\n$$\n这是 $N$ 个相同项的和，因此可以简化为：\n$$\nE[M_{obs}] = N(1 - \\exp(-\\eta))\n$$\n该表达式给出了在细胞中观测到的独特转录本的期望数量，是总独特分子数 $N$ 和捕获效率 $\\eta$ 的函数。",
            "answer": "$$\n\\boxed{N(1 - \\exp(-\\eta))}\n$$"
        },
        {
            "introduction": "在理解了单细胞测序数据的基本采样性质之后，一个关键的实践问题随之而来：为了可靠地检测到一个稀有细胞类型，我需要对多少个细胞进行测序？这个问题的答案对实验成本和成功率至关重要。本练习将指导您运用假设检验和功效分析等经典的统计学原理来解决这一实验设计问题 。通过构建一个二项分布模型，您将能够推算出在给定的显著性水平 $\\alpha$ 和统计功效 $1-\\beta$ 下，检测特定丰度 $p$ 的细胞类型所需的最小细胞数量，这是将理论知识转化为严谨实验方案的关键一步。",
            "id": "4378856",
            "problem": "为一项旨在单个生物样本中检测稀有细胞类型的单细胞核糖核酸测序 (scRNA-seq) 实验，设计一个有统计学原理支持的抽样策略。假设每个捕获的细胞都被独立同分布地分类到不同细胞类型中，并且目标细胞类型在捕获集合中的出现遵循二项分布模型，其在样本中的真实流行率为 $p$。在 $n$ 个捕获的细胞中，目标类型细胞的数量被建模为一个二项随机变量 $X \\sim \\mathrm{Bin}(n,p)$，反映了成功概率为 $p$ 的独立伯努利试验。\n\n您将使用单边假设检验框架，将“检测”形式化为拒绝“目标类型在捕获集合中不存在”的原假设。显著性水平 $\\alpha$ 是可容忍的最大 I 型错误率，而功效 $1-\\beta$ 是在真实流行率为 $p$ 时正确检测到目标类型的最小概率。决策规则基于一个临界计数阈值 $k_{\\mathrm{crit}}$，当观测到 $X \\geq k_{\\mathrm{crit}}$ 时，即构成“检测”。\n\n从二项模型以及显著性和功效的定义出发，推导在“目标类型在捕获集合中不存在”的理想化原假设下，为保证功效至少为 $1-\\beta$ 并将显著性水平控制在 $\\alpha$ 所需的最小单样本细胞数 $n_{\\min}(p,\\alpha,\\beta)$ 的表达式。然后，计算当 $p=0.01$，$\\alpha=0.05$ 和 $\\beta=0.2$ 时的最小单样本细胞数。报告满足设计约束的最小整数 $n$。如果使用了任何近似，将最终数值答案表示为四位有效数字。答案无需物理单位。",
            "solution": "首先，我们验证该问题的有效性。该问题要求基于标准的统计假设检验框架来确定实验设计所需的最小样本量。使用二项分布对稀有细胞类型的抽样进行建模，并通过功效分析来约束样本量，这是基因组学中合理且常规的方法。问题陈述清晰，提供了所有必需的参数，因此问题是有效的。\n\n解题过程如下。\n\n1.  **假设检验的构建与 $k_{\\mathrm{crit}}$ 的确定**\n\n令 $X$ 为从总共 $n$ 个细胞中检测到的目标细胞数量的随机变量。我们已知 $X$ 服从二项分布，$X \\sim \\mathrm{Bin}(n, p)$。\n假设检验设置如下：\n- 原假设 $H_0: p = 0$（细胞类型不存在）。\n- 备择假设 $H_1: p > 0$（细胞类型存在）。\n\n显著性水平 $\\alpha$ 是I型错误的最大概率，即在 $H_0$ 为真时拒绝它的概率。\n$$ \\alpha \\geq P(\\text{Reject } H_0 | H_0 \\text{ is true}) = P(X \\geq k_{\\mathrm{crit}} | p=0) $$\n在 $H_0: p=0$ 的条件下，$X$ 的分布是 $\\mathrm{Bin}(n, 0)$。对于此分布，观察到任何非零计数的概率为零。具体来说，对于任何整数 $k > 0$，$P(X=0 | p=0) = 1$ 且 $P(X=k | p=0) = 0$。\n因此，I型错误的概率是：\n$$ P(X \\geq k_{\\mathrm{crit}} | p=0) = \\sum_{j=k_{\\mathrm{crit}}}^{n} P(X=j | p=0) $$\n如果我们选择任何临界计数 $k_{\\mathrm{crit}} \\geq 1$，这个概率恰好为 $0$。因为给定的显著性水平是 $\\alpha=0.05$，所以条件 $P(\\text{I型错误}) \\leq \\alpha$ 变为 $0 \\leq 0.05$，这总是成立的。\n\n为了最大化检验的功效，我们应该选择在概念上合理的最小 $k_{\\mathrm{crit}}$ 值。阈值 $k_{\\mathrm{crit}}=0$ 意味着总是拒绝 $H_0$，这是没有意义的。能够提供反对 $H_0$ 的证据的最小整数计数是 $1$。因此，我们设定临界值为 $k_{\\mathrm{crit}}=1$。这个选择对于任何 $\\alpha > 0$ 都满足显著性约束，并且对于给定的 $n$ 和 $p$ 能最大化功效。决策规则是：如果我们观察到至少一个目标细胞，即 $X \\geq 1$，则发生“检测”。\n\n2.  **从功效约束推导最小样本量 $n_{\\min}$**\n\n检验的功效是在备择假设为真时正确拒绝 $H_0$ 的概率。问题要求当真实流行率为特定值 $p$ 时，功效至少为 $1-\\beta$。\n$$ \\text{Power} = P(\\text{Reject } H_0 | \\text{prevalence is } p) = P(X \\geq 1 | p) $$\n功效约束是：\n$$ P(X \\geq 1 | p) \\geq 1-\\beta $$\n使用补集法则，观察到至少一个目标细胞的概率是 $1$ 减去观察到零个目标细胞的概率：\n$$ P(X \\geq 1 | p) = 1 - P(X=0 | p) $$\n将此代入功效约束得到：\n$$ 1 - P(X=0 | p) \\geq 1-\\beta $$\n这可以简化为：\n$$ P(X=0 | p) \\leq \\beta $$\n对于二项分布 $X \\sim \\mathrm{Bin}(n, p)$， $X=0$ 的概率由其概率质量函数给出：\n$$ P(X=0 | p) = \\binom{n}{0} p^0 (1-p)^{n-0} = (1-p)^n $$\n不等式变为：\n$$ (1-p)^n \\leq \\beta $$\n为了解出 $n$，我们对两边取自然对数。由于 $\\ln(x)$ 是一个单调递增函数，不等式的方向保持不变。\n$$ \\ln((1-p)^n) \\leq \\ln(\\beta) $$\n$$ n \\ln(1-p) \\leq \\ln(\\beta) $$\n我们希望分离出 $n$。因为 $0  p  1$，所以有 $0  1-p  1$，这意味着 $\\ln(1-p)$ 是一个负数。不等式两边同时除以一个负数会反转不等式的方向：\n$$ n \\geq \\frac{\\ln(\\beta)}{\\ln(1-p)} $$\n这给出了所需最小样本量的一般表达式。由于 $n$ 必须是整数，最小细胞数 $n_{\\min}$ 是满足此条件的最小整数，也就是右侧表达式的向上取整。\n$$ n_{\\min}(p, \\alpha, \\beta) = \\left\\lceil \\frac{\\ln(\\beta)}{\\ln(1-p)} \\right\\rceil $$\n注意，对 $\\alpha$ 的依赖性通过我们选择 $k_{\\mathrm{crit}}=1$ 得到了满足，这对任何 $\\alpha > 0$ 都有效。\n\n3.  **数值计算**\n\n我们被要求计算在特定参数 $p=0.01$, $\\alpha=0.05$ 和 $\\beta=0.2$ 下的最小整数 $n$。\n使用推导出的最小样本量公式：\n$$ n \\geq \\frac{\\ln(0.2)}{\\ln(1-0.01)} = \\frac{\\ln(0.2)}{\\ln(0.99)} $$\n我们计算对数的数值：\n$$ \\ln(0.2) \\approx -1.60943791 $$\n$$ \\ln(0.99) \\approx -0.01005034 $$\n现在，我们计算比率：\n$$ n \\geq \\frac{-1.60943791}{-0.01005034} \\approx 160.137 $$\n因为细胞数 $n$ 必须是整数，我们必须取大于或等于此值的最小整数。\n$$ n_{\\min} = \\lceil 160.137 \\rceil = 161 $$\n因此，必须捕获并测序至少 $161$ 个细胞才能满足指定的设计约束。此计算无需对公式 $\\ln(1-p)$ 进行近似。",
            "answer": "$$\n\\boxed{161}\n$$"
        },
        {
            "introduction": "当我们获得了单细胞表达数据后，下一步便是对其进行精确的统计建模。数据中普遍存在的“零值”常常引起困惑，并导致“零膨胀”（zero-inflation）模型的误用。本练习旨在阐明，对于基于UMI的现代单细胞测序技术，许多零值实际上是源于低表达基因的“采样性零”（sampling zeros），而非独立的“结构性零”（structural zeros）。通过探索伽马-泊松（即负二项）混合模型 ，您将从第一性原理出发，理解该模型如何在一个统一的框架内同时捕捉到细胞间的生物学异质性和技术采样噪声，从而自然地解释了数据中的高比例零值，而无需引入额外的零膨胀组件。这有助于您为下游的差异表达等分析选择更为恰当和简洁的统计模型。",
            "id": "4378811",
            "problem": "考虑一个通过使用唯一分子标识符 (UMI) 的单细胞核糖核酸测序 (single-cell RNA-seq) 测量的单个基因。在基于 UMI 的方案下，去重复化确保每个捕获的信使核糖核酸 (mRNA) 分子最多贡献一个计数，因此在一个细胞中观察到的某个基因的计数可以被建模为一个抽样结果。在系统生物医学中，一个用于 UMI 计数的核心且经过充分检验的建模方法是以下的分层模型：以一个潜在表达强度为条件，观察到的计数是一个泊松样本，而潜在强度由于生物异质性在细胞间变化。具体来说，令随机选择的细胞中该基因的 UMI 观测计数为 $Y$，潜在强度为 $\\Lambda$。假设 $Y \\mid \\Lambda \\sim \\operatorname{Poisson}(\\Lambda)$，且潜在强度服从伽马分布 $\\Lambda \\sim \\operatorname{Gamma}(\\theta, \\text{rate}=\\theta/\\mu)$，因此 $\\mathbb{E}[\\Lambda] = \\mu$ 且 $\\operatorname{Var}[\\Lambda] = \\mu^{2}/\\theta$。这种伽马-泊松混合为 $Y$ 生成了一个均值为 $\\mu$、方差为 $\\mu + \\mu^{2}/\\theta$ 的负二项边际分布。\n\n仅使用这些基本定义和上述分层结构，提供一个基于基本原理的论证，说明为什么在适当的模型下，显式的零膨胀对于 UMI 数据通常是不必要的，并论述零的来源是抽样零点，以及伽马-泊松混合如何在没有额外零生成机制的情况下自然地捕捉均值-方差结构和零频率。然后，根据指定的伽马-泊松模型，推导观察到零计数的边际概率 $\\mathbb{P}(Y = 0)$ 关于参数 $\\mu$ 和 $\\theta$ 的闭式表达式。\n\n你的最终答案必须是 $\\mathbb{P}(Y = 0)$ 的单一解析表达式。不需要数值近似，也不需要单位。",
            "solution": "对单细胞核糖核酸测序 (single-cell RNA-seq) 中唯一分子标识符 (UMI) 计数的建模利用了该方案的关键特性：聚合酶链式反应 (PCR) 的扩增偏差通过去重复得到缓解，并且每个捕获的信使核糖核酸 (mRNA) 分子最多贡献一个计数。这支持了使用泊松抽样模型来为以潜在强度为条件的观测计数建模。细胞间的生物异质性，包括细胞状态变异性、转录爆发以及有效捕获效率的差异，引起了潜在强度的变化。一种被广泛接受且经过充分检验的对这种异质性的表示方法是对潜在强度使用伽马分布，从而产生伽马-泊松混合（也称为负二项边际）。这些建模选择与中心法则一致，因为捕获的 mRNA 分子反映了基因表达水平，并且也与抽样变异性下计数过程的统计描述相符。\n\n为了论证为什么显式的零膨胀对于 UMI 数据通常是不必要的，我们观察到当潜在强度很小时，在泊松抽样下零点会自然产生。在 UMI 方案下，去重复后的计数近似于一个真实的抽样过程，其中每个分子被捕获和计数的概率很小。以潜在强度 $\\Lambda$ 为条件，零的概率是\n$$\n\\mathbb{P}(Y = 0 \\mid \\Lambda) = \\exp(-\\Lambda).\n$$\n因此，即使没有任何额外的零生成机制，$\\Lambda$ 值较低的细胞也会频繁地产生抽样零点。当 $\\Lambda$ 本身根据伽马分布在细胞间变化时，零的边际概率是对这种异质性进行积分的结果。因此，伽马-泊松混合既能产生过离散（方差超过均值），也能产生与经验 UMI 数据一致的偏高零频率，从而无需一个显式的零膨胀组件。相比之下，零膨胀模型引入了一个独立的产生结构性零点的过程，而当抽样加异质性机制已经能够解释观察到的零率时，这通常是不必要的——前提是在模型中包含了适当的偏移量和协变量（例如文库大小或细胞特异性深度）。实证研究表明，在 UMI 方案下，带有细胞和基因特异性归一化的负二项模型通常能匹配零频率而无需零膨胀。\n\n我们现在推导在指定的伽马-泊松模型下，边际零概率 $\\mathbb{P}(Y=0)$ 的闭式表达式。设 $Y \\mid \\Lambda \\sim \\operatorname{Poisson}(\\Lambda)$ 且 $\\Lambda \\sim \\operatorname{Gamma}(\\theta, \\text{rate}=\\theta/\\mu)$，因此 $\\Lambda$ 的概率密度函数是\n$$\nf_{\\Lambda}(\\lambda) = \\frac{(\\theta/\\mu)^{\\theta}}{\\Gamma(\\theta)} \\lambda^{\\theta - 1} \\exp\\!\\left(-\\frac{\\theta}{\\mu}\\lambda\\right), \\quad \\lambda  0.\n$$\n边际零概率是条件零概率关于伽马分布的期望：\n$$\n\\mathbb{P}(Y = 0) = \\mathbb{E}\\big[\\exp(-\\Lambda)\\big] = \\int_{0}^{\\infty} \\exp(-\\lambda) \\, f_{\\Lambda}(\\lambda) \\, d\\lambda.\n$$\n代入伽马密度函数，\n$$\n\\mathbb{P}(Y = 0) = \\int_{0}^{\\infty} \\exp(-\\lambda) \\, \\frac{(\\theta/\\mu)^{\\theta}}{\\Gamma(\\theta)} \\lambda^{\\theta - 1} \\exp\\!\\left(-\\frac{\\theta}{\\mu}\\lambda\\right) d\\lambda = \\frac{(\\theta/\\mu)^{\\theta}}{\\Gamma(\\theta)} \\int_{0}^{\\infty} \\lambda^{\\theta - 1} \\exp\\!\\left(-\\left[1 + \\frac{\\theta}{\\mu}\\right]\\lambda\\right) d\\lambda.\n$$\n识别出该积分为带有一个缩放因子的伽马积分。对于 $c  0$ 和 $\\alpha  0$，\n$$\n\\int_{0}^{\\infty} \\lambda^{\\alpha - 1} \\exp(-c \\lambda) \\, d\\lambda = \\frac{\\Gamma(\\alpha)}{c^{\\alpha}}.\n$$\n令 $\\alpha = \\theta$ 且 $c = 1 + \\theta/\\mu$，我们得到\n$$\n\\int_{0}^{\\infty} \\lambda^{\\theta - 1} \\exp\\!\\left(-\\left[1 + \\frac{\\theta}{\\mu}\\right]\\lambda\\right) d\\lambda = \\frac{\\Gamma(\\theta)}{\\left(1 + \\frac{\\theta}{\\mu}\\right)^{\\theta}}.\n$$\n因此，\n$$\n\\mathbb{P}(Y = 0) = \\frac{(\\theta/\\mu)^{\\theta}}{\\Gamma(\\theta)} \\cdot \\frac{\\Gamma(\\theta)}{\\left(1 + \\frac{\\theta}{\\mu}\\right)^{\\theta}} = \\left(\\frac{\\theta/\\mu}{1 + \\theta/\\mu}\\right)^{\\theta} = \\left(\\frac{\\theta}{\\theta + \\mu}\\right)^{\\theta}.\n$$\n等价地，使用恒等式 $\\left(\\frac{\\theta}{\\theta + \\mu}\\right)^{\\theta} = \\left(1 + \\frac{\\mu}{\\theta}\\right)^{-\\theta}$，我们有\n$$\n\\mathbb{P}(Y = 0) = \\left(1 + \\frac{\\mu}{\\theta}\\right)^{-\\theta}.\n$$\n这与失败次数为 $r = \\theta$、成功概率为 $p = \\theta/(\\theta + \\mu)$ 的负二项参数化下的零概率相匹配，在该参数化下 $\\mathbb{P}(Y = 0) = p^{r}$。从伽马-泊松混合的推导表明，偏高的零频率是该模型的一个内在属性，这为当包含适当的归一化和协变量时，显式零膨胀对于 UMI 数据通常是不必要的提供了根本原因。",
            "answer": "$$\\boxed{\\left(\\frac{\\theta}{\\theta+\\mu}\\right)^{\\theta}}$$"
        }
    ]
}