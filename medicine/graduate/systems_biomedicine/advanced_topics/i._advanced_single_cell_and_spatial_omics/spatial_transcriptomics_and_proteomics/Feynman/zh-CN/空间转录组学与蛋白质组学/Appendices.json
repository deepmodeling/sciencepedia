{
    "hands_on_practices": [
        {
            "introduction": "空间组学研究常常需要整合多种数据模态，例如高分辨率的组织学图像和相应的基因表达图谱。本练习将引导你完成一项核心的预处理任务：图像配准。你将通过最小二乘法求解一个仿射变换，以精确对齐不同来源的数据点，这是将分子信息精确映射到组织结构上的关键一步。",
            "id": "5062750",
            "problem": "在转化医学中，空间转录组学和蛋白质组学流程的一个常见步骤是配准互补模态，例如将 Slide-seq 磁珠图谱与苏木精-伊红 (H&E) 组织学图像进行配准，以实现空间基因和蛋白质表达的联合推断。考虑一个实验，其中荧光基准标记在两种模态中都可见。设磁珠图谱坐标表示为 $\\mathbf{x}_i = (x_i, y_i)$，相应的组织学图像坐标表示为 $\\mathbf{u}_i = (u_i, v_i)$，其中 $i = 1, \\dots, n$。假设从磁珠空间到组织学空间的映射可以由一个二维仿射变换很好地近似，该变换由一个 $2 \\times 2$ 矩阵 $\\mathbf{A}$ 和一个平移向量 $\\mathbf{t}$ 定义，因此 $\\mathbf{u}_i \\approx \\mathbf{A}\\mathbf{x}_i + \\mathbf{t}$，其中 $\\mathbf{A}$ 模拟旋转、各向异性缩放和剪切，而 $\\mathbf{t}$ 模拟平移。两个坐标系都以微米为单位。\n\n从最小二乘目标的定义出发，\n$$\nJ(\\mathbf{A}, \\mathbf{t}) = \\sum_{i=1}^{n} \\left\\| \\mathbf{A}\\mathbf{x}_i + \\mathbf{t} - \\mathbf{u}_i \\right\\|^{2},\n$$\n推导使 $J(\\mathbf{A}, \\mathbf{t})$ 相对于六个未知标量参数 $(\\alpha_{11}, \\alpha_{12}, \\alpha_{21}, \\alpha_{22}, \\tau_{1}, \\tau_{2})$ 最小化的正规方程，其中 $\\mathbf{A} = \\begin{pmatrix} \\alpha_{11} & \\alpha_{12} \\\\ \\alpha_{21} & \\alpha_{22} \\end{pmatrix}$ 且 $\\mathbf{t} = (\\tau_{1}, \\tau_{2})$。然后，使用以下基准对应点来计算使配准误差平方最小化的参数值：\n\n- $i = 1$: $\\mathbf{x}_1 = (-1, -1)$, $\\mathbf{u}_1 = (6.7, -6.6)$\n- $i = 2$: $\\mathbf{x}_2 = (1, -1)$, $\\mathbf{u}_2 = (8.9, -7.2)$\n- $i = 3$: $\\mathbf{x}_3 = (-1, 1)$, $\\mathbf{u}_3 = (7.1, -4.8)$\n- $i = 4$: $\\mathbf{x}_4 = (1, 1), \\mathbf{u}_4 = (9.3, -5.4)$\n- $i = 5$: $\\mathbf{x}_5 = (-2, 0)$, $\\mathbf{u}_5 = (5.8, -5.4)$\n- $i = 6$: $\\mathbf{x}_6 = (2, 0)$, $\\mathbf{u}_6 = (10.2, -6.6)$\n- $i = 7$: $\\mathbf{x}_7 = (0, -2)$, $\\mathbf{u}_7 = (7.6, -7.8)$\n- $i = 8$: $\\mathbf{x}_8 = (0, 2)$, $\\mathbf{u}_8 = (8.4, -4.2)$\n\n所有坐标 $(x_i, y_i)$ 和 $(u_i, v_i)$ 都以微米表示。清楚地说明您使用的任何假设。将您的最终答案报告为有序参数元组 $(\\alpha_{11}, \\alpha_{12}, \\alpha_{21}, \\alpha_{22}, \\tau_{1}, \\tau_{2})$。条目 $\\alpha_{11}, \\alpha_{12}, \\alpha_{21}, \\alpha_{22}$ 是无量纲的；将 $\\tau_{1}$ 和 $\\tau_{2}$ 以微米表示。如果您进行任何数值近似，请将您的值四舍五入到四位有效数字。",
            "solution": "该问题要求确定一个二维仿射变换的参数，该变换将一组源点 $\\mathbf{x}_i$ 映射到一组对应的目标点 $\\mathbf{u}_i$。变换由 $\\mathbf{u}_i \\approx \\mathbf{A}\\mathbf{x}_i + \\mathbf{t}$ 给出，参数是矩阵 $\\mathbf{A}$ 和向量 $\\mathbf{t}$ 的元素。这些参数将通过最小化误差平方和来找到，这是一个标准的最小二乘问题。\n\n首先，对问题陈述进行验证。\n\n### 第 1 步：提取已知条件\n- 仿射变换模型为 $\\mathbf{u}_i \\approx \\mathbf{A}\\mathbf{x}_i + \\mathbf{t}$。\n- 坐标向量为 $\\mathbf{x}_i = (x_i, y_i)$ 和 $\\mathbf{u}_i = (u_i, v_i)$。\n- 变换矩阵为 $\\mathbf{A} = \\begin{pmatrix} \\alpha_{11} & \\alpha_{12} \\\\ \\alpha_{21} & \\alpha_{22} \\end{pmatrix}$。\n- 平移向量为 $\\mathbf{t} = (\\tau_{1}, \\tau_{2})$。\n- 目标函数是误差平方和：$J(\\mathbf{A}, \\mathbf{t}) = \\sum_{i=1}^{n} \\left\\| \\mathbf{A}\\mathbf{x}_i + \\mathbf{t} - \\mathbf{u}_i \\right\\|^{2}$。\n- 有 $n=8$ 对对应点：\n  - $\\mathbf{x}_1 = (-1, -1), \\mathbf{u}_1 = (6.7, -6.6)$\n  - $\\mathbf{x}_2 = (1, -1), \\mathbf{u}_2 = (8.9, -7.2)$\n  - $\\mathbf{x}_3 = (-1, 1), \\mathbf{u}_3 = (7.1, -4.8)$\n  - $\\mathbf{x}_4 = (1, 1), \\mathbf{u}_4 = (9.3, -5.4)$\n  - $\\mathbf{x}_5 = (-2, 0), \\mathbf{u}_5 = (5.8, -5.4)$\n  - $\\mathbf{x}_6 = (2, 0), \\mathbf{u}_6 = (10.2, -6.6)$\n  - $\\mathbf{x}_7 = (0, -2), \\mathbf{u}_7 = (7.6, -7.8)$\n  - $\\mathbf{x}_8 = (0, 2), \\mathbf{u}_8 = (8.4, -4.2)$\n- 所有坐标都以微米为单位。\n- 最终答案应为有序元组 $(\\alpha_{11}, \\alpha_{12}, \\alpha_{21}, \\alpha_{22}, \\tau_{1}, \\tau_{2})$，如果使用近似，则数值四舍五入到四位有效数字。\n\n### 第 2 步：使用提取的已知条件进行验证\n这个问题具有科学依据，因为通过最小二乘法找到最优仿射变换是图像配准和数据对齐中的一种标准和基本技术，在空间组学等领域尤其重要。这个问题是适定的；它是一个超定的线性最小二乘问题，有 8 个数据点用于求解 6 个未知参数。鉴于源点 $\\mathbf{x}_i$ 的空间分布，预期存在唯一解。问题陈述是客观、完整的，并且不包含任何矛盾或科学上不成立的前提。\n\n### 第 3 步：结论与行动\n问题是有效的。将推导解答。\n\n### 正规方程的推导\n\n目标函数 $J(\\mathbf{A}, \\mathbf{t})$ 可以用标量参数表示：\n$$\nJ(\\alpha_{11}, \\alpha_{12}, \\alpha_{21}, \\alpha_{22}, \\tau_{1}, \\tau_{2}) = \\sum_{i=1}^{n} \\left[ (\\alpha_{11}x_i + \\alpha_{12}y_i + \\tau_1 - u_i)^2 + (\\alpha_{21}x_i + \\alpha_{22}y_i + \\tau_2 - v_i)^2 \\right]\n$$\n该函数可分离为两个独立的部分：\n$$\nJ = J_1(\\alpha_{11}, \\alpha_{12}, \\tau_1) + J_2(\\alpha_{21}, \\alpha_{22}, \\tau_2)\n$$\n其中\n$$\nJ_1 = \\sum_{i=1}^{n} (\\alpha_{11}x_i + \\alpha_{12}y_i + \\tau_1 - u_i)^2\n$$\n$$\nJ_2 = \\sum_{i=1}^{n} (\\alpha_{21}x_i + \\alpha_{22}y_i + \\tau_2 - v_i)^2\n$$\n为了最小化 $J$，我们可以独立地最小化 $J_1$ 和 $J_2$。我们通过将 $J_1$ 关于 $\\alpha_{11}$、$\\alpha_{12}$ 和 $\\tau_1$ 的偏导数设为零来找到最小值，对 $J_2$ 也进行类似操作。\n\n对于 $J_1$：\n$$\n\\frac{\\partial J_1}{\\partial \\alpha_{11}} = \\sum_{i=1}^{n} 2(\\alpha_{11}x_i + \\alpha_{12}y_i + \\tau_1 - u_i)x_i = 0\n$$\n$$\n\\frac{\\partial J_1}{\\partial \\alpha_{12}} = \\sum_{i=1}^{n} 2(\\alpha_{11}x_i + \\alpha_{12}y_i + \\tau_1 - u_i)y_i = 0\n$$\n$$\n\\frac{\\partial J_1}{\\partial \\tau_1} = \\sum_{i=1}^{n} 2(\\alpha_{11}x_i + \\alpha_{12}y_i + \\tau_1 - u_i) = 0\n$$\n重新整理这些方程，得到第一组参数的正规方程：\n$$\n\\alpha_{11}\\left(\\sum x_i^2\\right) + \\alpha_{12}\\left(\\sum x_i y_i\\right) + \\tau_1\\left(\\sum x_i\\right) = \\sum u_i x_i\n$$\n$$\n\\alpha_{11}\\left(\\sum x_i y_i\\right) + \\alpha_{12}\\left(\\sum y_i^2\\right) + \\tau_1\\left(\\sum y_i\\right) = \\sum u_i y_i\n$$\n$$\n\\alpha_{11}\\left(\\sum x_i\\right) + \\alpha_{12}\\left(\\sum y_i\\right) + \\tau_1(n) = \\sum u_i\n$$\n这可以写成矩阵形式：\n$$\n\\begin{pmatrix} \\sum x_i^2 & \\sum x_i y_i & \\sum x_i \\\\ \\sum x_i y_i & \\sum y_i^2 & \\sum y_i \\\\ \\sum x_i & \\sum y_i & n \\end{pmatrix}\n\\begin{pmatrix} \\alpha_{11} \\\\ \\alpha_{12} \\\\ \\tau_1 \\end{pmatrix} =\n\\begin{pmatrix} \\sum u_i x_i \\\\ \\sum u_i y_i \\\\ \\sum u_i \\end{pmatrix}\n$$\n对 $J_2$ 进行类似的推导，得到第二组正规方程：\n$$\n\\begin{pmatrix} \\sum x_i^2 & \\sum x_i y_i & \\sum x_i \\\\ \\sum x_i y_i & \\sum y_i^2 & \\sum y_i \\\\ \\sum x_i & \\sum y_i & n \\end{pmatrix}\n\\begin{pmatrix} \\alpha_{21} \\\\ \\alpha_{22} \\\\ \\tau_2 \\end{pmatrix} =\n\\begin{pmatrix} \\sum v_i x_i \\\\ \\sum v_i y_i \\\\ \\sum v_i \\end{pmatrix}\n$$\n这里做的主要假设是存在唯一解，这要求和的 $3 \\times 3$ 矩阵是可逆的。\n\n### 参数计算\n\n我们使用提供的 $n=8$ 个数据点计算所需的和。\n- $\\sum_{i=1}^8 x_i = -1 + 1 - 1 + 1 - 2 + 2 + 0 + 0 = 0$\n- $\\sum_{i=1}^8 y_i = -1 - 1 + 1 + 1 + 0 + 0 - 2 + 2 = 0$\n- $\\sum_{i=1}^8 x_i^2 = (-1)^2 + 1^2 + (-1)^2 + 1^2 + (-2)^2 + 2^2 + 0^2 + 0^2 = 12$\n- $\\sum_{i=1}^8 y_i^2 = (-1)^2 + (-1)^2 + 1^2 + 1^2 + 0^2 + 0^2 + (-2)^2 + 2^2 = 12$\n- $\\sum_{i=1}^8 x_i y_i = (-1)(-1) + (1)(-1) + (-1)(1) + (1)(1) + 0 + 0 + 0 + 0 = 0$\n\n因此 $3 \\times 3$ 矩阵为：\n$$\n\\begin{pmatrix} 12 & 0 & 0 \\\\ 0 & 12 & 0 \\\\ 0 & 0 & 8 \\end{pmatrix}\n$$\n该矩阵是对角矩阵且显然可逆，证实了唯一解的存在。\n\n接下来，我们计算右侧向量的和。\n对于 $(\\alpha_{11}, \\alpha_{12}, \\tau_1)$ 系统：\n- $\\sum u_i = 6.7 + 8.9 + 7.1 + 9.3 + 5.8 + 10.2 + 7.6 + 8.4 = 64.0$\n- $\\sum u_i x_i = 6.7(-1) + 8.9(1) + 7.1(-1) + 9.3(1) + 5.8(-2) + 10.2(2) = -6.7 + 8.9 - 7.1 + 9.3 - 11.6 + 20.4 = 13.2$\n- $\\sum u_i y_i = 6.7(-1) + 8.9(-1) + 7.1(1) + 9.3(1) + 7.6(-2) + 8.4(2) = -6.7 - 8.9 + 7.1 + 9.3 - 15.2 + 16.8 = 2.4$\n\n第一个线性系统是：\n$$\n\\begin{pmatrix} 12 & 0 & 0 \\\\ 0 & 12 & 0 \\\\ 0 & 0 & 8 \\end{pmatrix}\n\\begin{pmatrix} \\alpha_{11} \\\\ \\alpha_{12} \\\\ \\tau_1 \\end{pmatrix} =\n\\begin{pmatrix} 13.2 \\\\ 2.4 \\\\ 64.0 \\end{pmatrix}\n$$\n解这个对角系统：\n- $12 \\alpha_{11} = 13.2 \\implies \\alpha_{11} = \\frac{13.2}{12} = 1.1$\n- $12 \\alpha_{12} = 2.4 \\implies \\alpha_{12} = \\frac{2.4}{12} = 0.2$\n- $8 \\tau_1 = 64.0 \\implies \\tau_1 = \\frac{64.0}{8} = 8.0$\n\n对于 $(\\alpha_{21}, \\alpha_{22}, \\tau_2)$ 系统：\n- $\\sum v_i = -6.6 - 7.2 - 4.8 - 5.4 - 5.4 - 6.6 - 7.8 - 4.2 = -48.0$\n- $\\sum v_i x_i = -6.6(-1) - 7.2(1) - 4.8(-1) - 5.4(1) - 5.4(-2) - 6.6(2) = 6.6 - 7.2 + 4.8 - 5.4 + 10.8 - 13.2 = -3.6$\n- $\\sum v_i y_i = -6.6(-1) - 7.2(-1) - 4.8(1) - 5.4(1) - 7.8(-2) - 4.2(2) = 6.6 + 7.2 - 4.8 - 5.4 + 15.6 - 8.4 = 10.8$\n\n第二个线性系统是：\n$$\n\\begin{pmatrix} 12 & 0 & 0 \\\\ 0 & 12 & 0 \\\\ 0 & 0 & 8 \\end{pmatrix}\n\\begin{pmatrix} \\alpha_{21} \\\\ \\alpha_{22} \\\\ \\tau_2 \\end{pmatrix} =\n\\begin{pmatrix} -3.6 \\\\ 10.8 \\\\ -48.0 \\end{pmatrix}\n$$\n解这个对角系统：\n- $12 \\alpha_{21} = -3.6 \\implies \\alpha_{21} = \\frac{-3.6}{12} = -0.3$\n- $12 \\alpha_{22} = 10.8 \\implies \\alpha_{22} = \\frac{10.8}{12} = 0.9$\n- $8 \\tau_2 = -48.0 \\implies \\tau_2 = \\frac{-48.0}{8} = -6.0$\n\n计算是精确的，因此无需四舍五入。计算出的参数为：\n- $\\alpha_{11} = 1.1$ (无量纲)\n- $\\alpha_{12} = 0.2$ (无量纲)\n- $\\alpha_{21} = -0.3$ (无量纲)\n- $\\alpha_{22} = 0.9$ (无量纲)\n- $\\tau_1 = 8.0$ (微米)\n- $\\tau_2 = -6.0$ (微米)\n\n最终答案是有序元组 $(\\alpha_{11}, \\alpha_{12}, \\alpha_{21}, \\alpha_{22}, \\tau_{1}, \\tau_{2})$。",
            "answer": "$$\\boxed{(1.1, 0.2, -0.3, 0.9, 8.0, -6.0)}$$"
        },
        {
            "introduction": "在对齐数据之后，一个核心的分析问题是确定基因表达是否呈现出空间模式，而非随机分布。本练习将介绍用于量化空间自相关的关键统计量——莫兰指数（Moran's $I$），并指导你完成其计算过程。掌握这项技能对于识别具有空间显著性表达模式的基因至关重要，这些基因往往揭示了组织中具有特定功能的区域。",
            "id": "4386267",
            "problem": "考虑一个通过空间转录组学（Spatial Transcriptomics, ST）分析的一维组织条带，其中相邻的捕获点位于一个等间距的线性格点上。关注单个基因，并假设其在 $n$ 个点上的标准化表达量被建模为一个实值场 $x_{i}$，其位置由索引 $i \\in \\{1,2,\\dots,n\\}$ 标记。空间自相关通过一个对称、对角线为零、非行标准化的空间权重矩阵 $W=\\{w_{ij}\\}$ 来评估，该矩阵编码了邻近关系，其中较大的 $w_{ij}$ 意味着位置 $i$ 和 $j$ 之间有更强的空间耦合。\n\n从样本均值、样本方差和空间加权协方差概念的基础统计定义出发，推导空间自相关的无量纲指数，这些指数 (i) 将 $x_{i}$ 的空间加权交叉偏差与其总偏差进行比较，以及 (ii) 将 $x_{i}$ 相邻值之间的平方差与总偏差进行比较。这些构造被称为莫兰指数 $I$ (Moran's $I$) 和吉尔里指数 $C$ (Geary's $C$)。你的推导必须确定由 $n$ 和总权重 $S_{0}$ (其中 $S_{0}=\\sum_{i=1}^{n}\\sum_{j=1}^{n} w_{ij}$) 构建的适当归一化因子，以使每个指数对于 $x_{i}$ 都是尺度不变且无量纲的。\n\n然后，为以下科学上真实的 ST 场景计算莫兰指数 $I$：\n- 格点上有 $n=7$ 个有序点，其表达值 $x_{1},\\dots,x_{7}$ 由下式给出\n$$\nx = \\left(5,\\,6,\\,7,\\,12,\\,11,\\,9,\\,8\\right).\n$$\n- 空间权重在格点上实现一阶邻接：\n$$\nw_{ij}=\\begin{cases}\n1 & \\text{if } |i-j|=1,\\\\\n0 & \\text{otherwise,}\n\\end{cases}\n\\quad \\text{and} \\quad w_{ii}=0 \\text{ for all } i.\n$$\n\n将莫兰指数 $I$ 的最终数值结果表示为未经四舍五入的精确值。不包含任何单位。如果您引入任何首字母缩写词，请在首次使用时写出其全称并将缩写词放在括号中。",
            "solution": "我们从在 $n$ 个空间位置观测到的实值场 $x_{i}$ 的基本统计构造开始。样本均值为\n$$\n\\bar{x}=\\frac{1}{n}\\sum_{i=1}^{n}x_{i},\n$$\n样本总偏差（未归一化的方差分子）为\n$$\n\\sum_{i=1}^{n}(x_{i}-\\bar{x})^{2}.\n$$\n为了编码空间结构，我们考虑一个对称的空间权重矩阵 $W=\\{w_{ij}\\}$，其中 $w_{ii}=0$，总权重为\n$$\nS_{0}=\\sum_{i=1}^{n}\\sum_{j=1}^{n}w_{ij}.\n$$\n空间加权交叉偏差由以下公式捕获\n$$\n\\sum_{i=1}^{n}\\sum_{j=1}^{n} w_{ij}\\,(x_{i}-\\bar{x})(x_{j}-\\bar{x}),\n$$\n它通过根据空间邻近性对配对进行加权，推广了协方差的概念。\n\n莫兰指数 $I$ 的构建旨在使其对于 $x_{i}$ 是无量纲和尺度不变的，方法是用样本总偏差对空间加权交叉偏差进行归一化，并引入一个仅取决于 $n$ 和 $S_{0}$ 的因子，以说明总权重大小和位置数量。其标准形式推导为\n$$\nI=\\frac{n}{S_{0}}\\cdot \\frac{\\sum_{i=1}^{n}\\sum_{j=1}^{n} w_{ij}\\,(x_{i}-\\bar{x})(x_{j}-\\bar{x})}{\\sum_{i=1}^{n}(x_{i}-\\bar{x})^{2}},\n$$\n该指数是无量纲的，在仿射缩放 $x_{i}\\mapsto a x_{i}+b$ ($a\\neq 0$) 下保持不变，并使用 $S_{0}$ 来归一化总权重大小。\n\n吉尔里指数 $C$ 将相邻位置之间的平方差与总偏差进行比较，并通过归一化确保其无量纲和尺度不变性。从空间加权平方差之和开始，\n$$\n\\sum_{i=1}^{n}\\sum_{j=1}^{n} w_{ij}\\,(x_{i}-x_{j})^{2},\n$$\n其标准归一化形式为\n$$\nC=\\frac{n-1}{2 S_{0}}\\cdot \\frac{\\sum_{i=1}^{n}\\sum_{j=1}^{n} w_{ij}\\,(x_{i}-x_{j})^{2}}{\\sum_{i=1}^{n}(x_{i}-\\bar{x})^{2}},\n$$\n它同样是无量纲和尺度不变的。\n\n我们现在为给定的一维格点计算莫兰指数 $I$。\n\n步骤 1：计算以下数据的均值 $\\bar{x}$\n$$\nx=\\left(5,\\,6,\\,7,\\,12,\\,11,\\,9,\\,8\\right).\n$$\n其和为\n$$\n\\sum_{i=1}^{7} x_{i} = 5+6+7+12+11+9+8 = 58,\n$$\n所以\n$$\n\\bar{x}=\\frac{58}{7}.\n$$\n\n步骤 2：计算偏差 $d_{i}=x_{i}-\\bar{x}$：\n$$\nd_{1}=\\frac{35-58}{7}=-\\frac{23}{7},\\quad\nd_{2}=\\frac{42-58}{7}=-\\frac{16}{7},\\quad\nd_{3}=\\frac{49-58}{7}=-\\frac{9}{7},\n$$\n$$\nd_{4}=\\frac{84-58}{7}=\\frac{26}{7},\\quad\nd_{5}=\\frac{77-58}{7}=\\frac{19}{7},\\quad\nd_{6}=\\frac{63-58}{7}=\\frac{5}{7},\\quad\nd_{7}=\\frac{56-58}{7}=-\\frac{2}{7}.\n$$\n\n步骤 3：计算总偏差分母\n$$\n\\sum_{i=1}^{7}(x_{i}-\\bar{x})^{2}=\\sum_{i=1}^{7} d_{i}^{2}\n=\\frac{529+256+81+676+361+25+4}{49}=\\frac{1932}{49}.\n$$\n\n步骤 4：计算指定邻接权重的 $S_{0}$。在一个有 $7$ 个节点的链上，无向边位于配对 $(1,2),(2,3),(3,4),(4,5),(5,6),(6,7)$ 之间，总共有 $6$ 条边。因为 $w_{ij}=w_{ji}=1$ 且我们对有序对 $(i,j)$ 求和，所以我们有\n$$\nS_{0}=\\sum_{i=1}^{7}\\sum_{j=1}^{7} w_{ij} = 2\\times 6 = 12.\n$$\n\n步骤 5：计算空间加权交叉偏差分子 $\\sum_{i=1}^{7}\\sum_{j=1}^{7} w_{ij} d_{i} d_{j}$。非零贡献仅在 $|i-j|=1$ 时出现，根据对称性可得\n$$\n\\sum_{i=1}^{7}\\sum_{j=1}^{7} w_{ij} d_{i} d_{j}\n=2\\sum_{\\text{edges }(i,j)} d_{i} d_{j}.\n$$\n计算边的乘积：\n$$\n(1,2):\\; d_{1}d_{2}=\\left(-\\frac{23}{7}\\right)\\left(-\\frac{16}{7}\\right)=\\frac{368}{49},\n$$\n$$\n(2,3):\\; d_{2}d_{3}=\\left(-\\frac{16}{7}\\right)\\left(-\\frac{9}{7}\\right)=\\frac{144}{49},\n$$\n$$\n(3,4):\\; d_{3}d_{4}=\\left(-\\frac{9}{7}\\right)\\left(\\frac{26}{7}\\right)=-\\frac{234}{49},\n$$\n$$\n(4,5):\\; d_{4}d_{5}=\\left(\\frac{26}{7}\\right)\\left(\\frac{19}{7}\\right)=\\frac{494}{49},\n$$\n$$\n(5,6):\\; d_{5}d_{6}=\\left(\\frac{19}{7}\\right)\\left(\\frac{5}{7}\\right)=\\frac{95}{49},\n$$\n$$\n(6,7):\\; d_{6}d_{7}=\\left(\\frac{5}{7}\\right)\\left(-\\frac{2}{7}\\right)=-\\frac{10}{49}.\n$$\n将这些边的乘积相加，\n$$\n\\sum_{\\text{edges }(i,j)} d_{i} d_{j}\n=\\frac{368+144-234+494+95-10}{49}\n=\\frac{857}{49}.\n$$\n因此，\n$$\n\\sum_{i=1}^{7}\\sum_{j=1}^{7} w_{ij} d_{i} d_{j}\n=2\\cdot \\frac{857}{49}=\\frac{1714}{49}.\n$$\n\n步骤 6：组装莫兰指数 $I$：\n$$\nI=\\frac{n}{S_{0}}\\cdot \\frac{\\sum_{i=1}^{7}\\sum_{j=1}^{7} w_{ij} d_{i} d_{j}}{\\sum_{i=1}^{7} d_{i}^{2}}\n=\\frac{7}{12}\\cdot \\frac{\\frac{1714}{49}}{\\frac{1932}{49}}\n=\\frac{7}{12}\\cdot \\frac{1714}{1932}.\n$$\n化简：\n$$\nI=\\frac{7\\cdot 1714}{12\\cdot 1932}\n=\\frac{7\\cdot (2 \\cdot 857)}{12\\cdot 1932}\n=\\frac{7\\cdot 857}{6\\cdot 1932}\n=\\frac{5999}{11592}.\n$$\n分子分母同时除以 $7$：\n$$\nI=\\frac{857}{1656}.\n$$\n分数 $\\frac{857}{1656}$ 已是最简形式，所以莫兰指数 $I$ 的精确值为\n$$\nI=\\frac{857}{1656}.\n$$",
            "answer": "$$\\boxed{\\frac{857}{1656}}$$"
        },
        {
            "introduction": "许多空间转录组学技术在单个测量点（spot）中捕获的是多个细胞的混合表达信号。本练习将带你应对一项关键的计算挑战：细胞类型去卷积，即估计每个点中不同细胞类型的构成比例。你将把这个问题构建为一个带约束的回归模型并进行求解，这是一种从混合空间数据中计算解析细胞异质性的强大技术。",
            "id": "4386305",
            "problem": "给定一个系统生物医学场景，其中来自Visium空间基因表达（Visium）技术的一个空间点（spot）包含多种细胞类型的混合物，这些细胞类型的信使核糖核酸（mRNA）转录本丰度是跨多个基因测量的。在这样的一个点中，观测到的表达谱是组成细胞类型表达谱的混合。为了量化一个点的组成，假设有一个参考特征矩阵，该矩阵编码了每种细胞类型的平均基因表达。任务是构建并解决一个约束回归问题，以估计每个点的细胞类型比例。\n\n使用以下基本原理和假设：\n- 分子生物学中心法则：脱氧核糖核酸（DNA）转录为核糖核酸（RNA），RNA再翻译为蛋白质。在充分平均和标准化的设置中，观测到的每个基因的转录本计数反映了样本中存在的不同细胞类型贡献的总和。\n- 线性混合模型：一个点中观测到的基因表达向量可以建模为由未知的非负比例加权的细胞类型特异性特征的线性组合。设 $G$ 为基因数，$K$ 为细胞类型数，$\\mathbf{S} \\in \\mathbb{R}_{\\ge 0}^{G \\times K}$ 为已知的特征矩阵，其第 $k$ 列是细胞类型 $k$ 的参考表达谱，$\\mathbf{y} \\in \\mathbb{R}_{\\ge 0}^{G}$ 为一个点的观测表达向量。未知的细胞类型比例向量为 $\\mathbf{p} \\in \\mathbb{R}_{\\ge 0}^{K}$。\n- 约束条件：比例为非负且总和为一，即 $\\mathbf{p} \\succeq \\mathbf{0}$ 和 $\\mathbf{1}^{\\top} \\mathbf{p} = 1$，其中 $\\mathbf{1}$ 是 $\\mathbb{R}^{K}$ 中的全一向量。\n- 目标：估计准则是预测表达与观测表达之间的平方欧几里得距离，可选地为每个基因设置非负权重 $w_g$ 以反映可靠性，并加入一个小的岭正则化以确保唯一性和数值稳定性。\n\n形式上，将解卷积定义为对每个点的以下约束优化问题：\n最小化函数\n$$\n\\frac{1}{2} \\sum_{g=1}^{G} w_g \\left( (\\mathbf{S}\\mathbf{p})_g - \\mathbf{y}_g \\right)^2 + \\frac{\\alpha}{2} \\lVert \\mathbf{p} \\rVert_2^2\n$$\n约束条件为 $\\mathbf{p} \\succeq \\mathbf{0}$ 和 $\\mathbf{1}^{\\top} \\mathbf{p} = 1$，\n其中 $w_g \\ge 0$ 是给定的每个基因的权重，$\\alpha \\ge 0$ 是一个小的正则化参数。\n\n您的程序必须实现一个求解器，对于每个测试用例，计算在约束条件下最小化上述目标的细胞类型比例向量 $\\widehat{\\mathbf{p}}$。您可以假设问题是凸的并且存在极小值点。该求解器必须是通用的，并且不得依赖于对约束的闭式反演。程序必须将 $\\widehat{\\mathbf{p}}$ 的每个分量四舍五入到4位小数。\n\n角度单位不适用。没有物理单位；比例必须以小数形式报告。\n\n测试套件：\n对于每个案例，给定 $G$、$K$、特征矩阵 $\\mathbf{S}$、观测表达 $\\mathbf{y}$、权重 $\\mathbf{w}$ 和岭参数 $\\alpha$。所有数值均在下方明确给出。\n\n- 案例A（通用情况，低噪声）：\n  - $G = 5$，$K = 3$，$\\alpha = 10^{-6}$。\n  - $\\mathbf{S} = \\begin{bmatrix}\n  8 & 2 & 1 \\\\\n  1 & 7 & 2 \\\\\n  0 & 1 & 9 \\\\\n  5 & 2 & 1 \\\\\n  2 & 3 & 4\n  \\end{bmatrix}$。\n  - $\\mathbf{y} = \\begin{bmatrix} 4.9 \\\\ 2.95 \\\\ 2.12 \\\\ 3.27 \\\\ 2.7 \\end{bmatrix}$。\n  - $\\mathbf{w} = \\begin{bmatrix} 1 \\\\ 1 \\\\ 1 \\\\ 1 \\\\ 1 \\end{bmatrix}$。\n\n- 案例B（纯细胞类型，无噪声）：\n  - $G = 5$，$K = 3$，$\\alpha = 10^{-6}$。\n  - $\\mathbf{S}$ 与案例A相同。\n  - $\\mathbf{y} = \\begin{bmatrix} 2 \\\\ 7 \\\\ 1 \\\\ 2 \\\\ 3 \\end{bmatrix}$。\n  - $\\mathbf{w} = \\begin{bmatrix} 1 \\\\ 1 \\\\ 1 \\\\ 1 \\\\ 1 \\end{bmatrix}$。\n\n- 案例C（共线性，精确混合）：\n  - $G = 4$，$K = 3$，$\\alpha = 10^{-6}$。\n  - $\\mathbf{S} = \\begin{bmatrix}\n  3 & 3 & 1 \\\\\n  2 & 2 & 0.5 \\\\\n  1 & 1 & 4 \\\\\n  0.5 & 0.5 & 2\n  \\end{bmatrix}$。\n  - $\\mathbf{y} = \\begin{bmatrix} 2.6 \\\\ 1.7 \\\\ 1.6 \\\\ 0.8 \\end{bmatrix}$。\n  - $\\mathbf{w} = \\begin{bmatrix} 1 \\\\ 1 \\\\ 1 \\\\ 1 \\\\ 1 \\end{bmatrix}$。\n\n- 案例D（零值与dropout，中度噪声）：\n  - $G = 4$，$K = 2$，$\\alpha = 10^{-6}$。\n  - $\\mathbf{S} = \\begin{bmatrix}\n  0 & 3 \\\\\n  5 & 0 \\\\\n  0 & 2 \\\\\n  4 & 1\n  \\end{bmatrix}$。\n  - $\\mathbf{y} = \\begin{bmatrix} 1.15 \\\\ 3.1 \\\\ 0.4 \\\\ 2.7 \\end{bmatrix}$。\n  - $\\mathbf{w} = \\begin{bmatrix} 1 \\\\ 1 \\\\ 1 \\\\ 1 \\\\ 1 \\end{bmatrix}$。\n\n- 案例E（加权拟合，对含噪声的第二个基因降权）：\n  - $G = 3$，$K = 3$，$\\alpha = 10^{-6}$。\n  - $\\mathbf{S} = \\begin{bmatrix}\n  10 & 1 & 0.5 \\\\\n  0.5 & 8 & 1 \\\\\n  1 & 1 & 6\n  \\end{bmatrix}$。\n  - $\\mathbf{y} = \\begin{bmatrix} 2.65 \\\\ 5.9 \\\\ 2.4 \\end{bmatrix}$。\n  - $\\mathbf{w} = \\begin{bmatrix} 1 \\\\ 0.2 \\\\ 1 \\end{bmatrix}$。\n\n实现要求：\n- 实现一个求解器，精确处理约束条件 $\\mathbf{p} \\succeq \\mathbf{0}$ 和 $\\mathbf{1}^{\\top} \\mathbf{p} = 1$，不放宽这些条件，并在目标函数中包含岭正则化 $\\alpha$。\n- 算法必须有原则且通用（例如，使用具有数学上合理的步长和到概率单纯形上的投影的投影梯度法）。\n- 对于每个案例，计算估计的比例 $\\widehat{\\mathbf{p}}$ 并将每个分量四舍五入到4位小数。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表的结果（例如，$[result1,result2,result3]$），其中每个 $resulti$ 是对应案例的四舍五入比例列表。输出不得包含空格。例如：$[[0.5000,0.3000,0.2000],[0.0000,1.0000,0.0000],\\dots]$。",
            "solution": "用户提供了一个问题陈述，该陈述已被验证为具有科学依据、格式良好且客观。\n\n该问题要求解决一个约束二次优化问题，以在空间转录组学中执行细胞类型解卷积。一个点观测到的基因表达向量 $\\mathbf{y} \\in \\mathbb{R}_{\\ge 0}^{G}$ 被建模为参考细胞类型表达特征的线性组合。这些特征被编码在一个已知矩阵 $\\mathbf{S} \\in \\mathbb{R}_{\\ge 0}^{G \\times K}$ 的列中，其中 $G$ 是基因数量，$K$ 是细胞类型数量。未知量是每种细胞类型的比例，由向量 $\\mathbf{p} \\in \\mathbb{R}_{\\ge 0}^{K}$ 表示。\n\n比例必须满足两个物理约束：它们必须是非负的，$\\mathbf{p} \\succeq \\mathbf{0}$，并且它们的总和必须为一，$\\mathbf{1}^{\\top} \\mathbf{p} = 1$。满足这些约束的所有向量 $\\mathbf{p}$ 构成了标准的(K-1)维单纯形，记为 $\\Delta^{K-1}$。\n\n目标是找到比例向量 $\\widehat{\\mathbf{p}}$，以最小化一个正则化的、加权的平方误差目标函数。目标函数由下式给出：\n$$\nf(\\mathbf{p}) = \\frac{1}{2} \\sum_{g=1}^{G} w_g \\left( (\\mathbf{S}\\mathbf{p})_g - y_g \\right)^2 + \\frac{\\alpha}{2} \\lVert \\mathbf{p} \\rVert_2^2\n$$\n其中 $w_g \\ge 0$ 是基因特异性权重，$\\alpha \\ge 0$ 是一个吉洪诺夫（岭）正则化参数。\n\n这个问题可以用矩阵形式表示。设 $\\mathbf{W}$ 是一个 $G \\times G$ 的对角矩阵，其对角线上的元素为权重 $w_g$。目标函数是：\n$$\nf(\\mathbf{p}) = \\frac{1}{2} (\\mathbf{S}\\mathbf{p} - \\mathbf{y})^{\\top} \\mathbf{W} (\\mathbf{S}\\mathbf{p} - \\mathbf{y}) + \\frac{\\alpha}{2} \\mathbf{p}^{\\top}\\mathbf{p}\n$$\n该问题是一个二次规划（QP），具有凸目标函数和紧凑的凸可行集（单纯形 $\\Delta^{K-1}$）。由岭项（$\\alpha > 0$）赋予的严格凸性保证了唯一解的存在。\n\n一个合适且通用的解决此问题的算法是投影梯度下降法。这种迭代方法包括沿负梯度方向迈出一步，然后将结果点投影回可行集。\n\n算法流程如下：\n1. 将 $\\mathbf{p}^{(0)}$ 初始化为一个可行点，通常是单纯形的中心：$\\mathbf{p}^{(0)} = \\frac{1}{K}\\mathbf{1}$。\n2. 对于迭代 $t = 0, 1, 2, \\dots$ 直至收敛：\n    a. 通过计算目标函数在当前迭代点 $\\mathbf{p}^{(t)}$ 的梯度 $\\nabla f(\\mathbf{p})$ 来确定下降方向。\n    b. 沿此方向迈出一步：$\\mathbf{z}^{(t+1)} = \\mathbf{p}^{(t)} - \\eta \\nabla f(\\mathbf{p}^{(t)})$，其中 $\\eta > 0$ 是步长。\n    c. 将点 $\\mathbf{z}^{(t+1)}$ 投影到单纯形 $\\Delta^{K-1}$上：$\\mathbf{p}^{(t+1)} = \\Pi_{\\Delta^{K-1}}(\\mathbf{z}^{(t+1)})$。\n3. 当两次迭代之间 $\\mathbf{p}$ 的变化量小于一个很小的容差时，算法终止。\n\n该算法的关键组成部分是梯度计算、步长确定和投影算子。\n\n**1. 梯度计算**\n\n目标函数为：\n$$\nf(\\mathbf{p}) = \\frac{1}{2} \\left( \\mathbf{p}^{\\top}\\mathbf{S}^{\\top}\\mathbf{W}\\mathbf{S}\\mathbf{p} - 2\\mathbf{y}^{\\top}\\mathbf{W}\\mathbf{S}\\mathbf{p} + \\mathbf{y}^{\\top}\\mathbf{W}\\mathbf{y} \\right) + \\frac{\\alpha}{2} \\mathbf{p}^{\\top}\\mathbf{p}\n$$\n关于 $\\mathbf{p}$ 的梯度是：\n$$\n\\nabla f(\\mathbf{p}) = \\mathbf{S}^{\\top}\\mathbf{W}\\mathbf{S}\\mathbf{p} - \\mathbf{S}^{\\top}\\mathbf{W}\\mathbf{y} + \\alpha\\mathbf{p} = \\mathbf{S}^{\\top}\\mathbf{W}(\\mathbf{S}\\mathbf{p} - \\mathbf{y}) + \\alpha\\mathbf{p}\n$$\n\n**2. 步长确定**\n\n为使梯度下降收敛，必须适当地选择步长 $\\eta$。对于具有利普希茨连续梯度的凸函数，收敛的充分条件是 $0 < \\eta < 2/L$，其中 $L$ 是梯度的利普希茨常数。对于我们的二次目标函数，$L$ 是海森矩阵 $\\nabla^2 f(\\mathbf{p})$ 的最大特征值。海森矩阵是：\n$$\n\\nabla^2 f(\\mathbf{p}) = \\mathbf{S}^{\\top}\\mathbf{W}\\mathbf{S} + \\alpha\\mathbf{I}\n$$\n其中 $\\mathbf{I}$ 是 $K \\times K$ 的单位矩阵。该海森矩阵是一个常数、对称、正定矩阵（对于 $\\alpha > 0$）。我们可以计算其特征值，并将 $L$ 设置为最大特征值 $\\lambda_{\\text{max}}$。一个安全且恒定的步长则是 $\\eta = 1/L$。\n\n**3. 到概率单纯形上的投影**\n\n投影步骤 $\\mathbf{p}^{(t+1)} = \\Pi_{\\Delta^{K-1}}(\\mathbf{z}^{(t+1)})$ 寻找在欧几里得距离上最接近 $\\mathbf{z}^{(t+1)}$ 的单纯形上的点。这本身也是一个二次规划问题：\n$$\n\\text{minimize}_{\\mathbf{p}} \\quad \\frac{1}{2} \\lVert \\mathbf{p} - \\mathbf{z} \\rVert_2^2 \\quad \\text{subject to} \\quad \\mathbf{p} \\succeq \\mathbf{0}, \\mathbf{1}^{\\top}\\mathbf{p} = 1\n$$\n存在一种高效的算法可以在 $O(K \\log K)$ 时间内解决这个投影问题。步骤如下：\n1. 将向量 $\\mathbf{z}$ 的元素按降序排序，得到一个新向量 $\\mathbf{u}$。\n2. 找到一个整数 $\\rho$ 使得 $\\rho = \\max\\left\\{ j \\in \\{1, \\dots, K\\} \\mid u_j - \\frac{1}{j} \\left( \\sum_{i=1}^j u_i - 1 \\right) > 0 \\right\\}$。\n3. 定义一个阈值 $\\theta = \\frac{1}{\\rho} \\left( \\sum_{i=1}^\\rho u_i - 1 \\right)$。\n4. 投影向量 $\\mathbf{p}$ 是通过对原始向量 $\\mathbf{z}$ 的每个元素应用软阈值算子得到的：$p_k = \\max(z_k - \\theta, 0)$，对于 $k = 1, \\dots, K$。\n\n通过将这三个组成部分组合到一个迭代循环中，算法将为每个测试用例收敛到唯一的极小值点 $\\widehat{\\mathbf{p}}$。",
            "answer": "[[0.5186,0.3294,0.1520],[0.0000,1.0000,0.0000],[0.4000,0.4000,0.2000],[0.6136,0.3864],[0.2005,0.4996,0.2999]]"
        }
    ]
}