{
    "hands_on_practices": [
        {
            "introduction": "本节的第一个实践将探讨作为空间动力学基石的纯扩散方程。我们将利用热核卷积这一基本方法，求解高斯初始条件下的扩散问题。这个练习有助于深入理解初始分布如何随时间演变和扩散，这是许多生物学现象（如信号分子梯度形成）的核心过程。",
            "id": "4372301",
            "problem": "在一个被建模为$n$维欧几里得空间$\\mathbb{R}^{n}$的均匀、各向同性的组织中，考虑一个信号分子的扩散，其浓度场$u(\\mathbf{x},t)$遵循线性扩散偏微分方程(PDE) $\\partial_{t} u = D \\nabla^{2} u$演化，其中$D>0$是常数扩散系数，$\\nabla^{2}$是$\\mathbb{R}^{n}$中的拉普拉斯算子，而$t>0$是时间。在时间$t=0$时，浓度是一个球对称的高斯分布，由$u(\\mathbf{x},0)= A \\exp\\!\\big(-|\\mathbf{x}|^{2}/(4\\beta)\\big)$给出，其中常数$A>0$且$\\beta>0$。利用以热核为基础的卷积表示法作为$\\mathbb{R}^{n}$上扩散方程解的基本方法，从第一性原理出发，推导出一个关于$A$、$\\beta$、$D$、$n$和$|\\mathbf{x}|$的$u(\\mathbf{x},t)$（对于$t>0$）的闭式表达式。你的最终表达式必须完全简化，并且不能以未求值的卷积分形式保留。不需要四舍五入，也无需报告物理单位。使用$\\exp(\\cdot)$符号表示任何指数函数。",
            "solution": "问题陈述具有科学依据、适定、客观且完整。它描述了$\\mathbb{R}^n$上扩散方程的一个标准初值问题。给定的条件是偏微分方程$\\partial_{t} u = D \\nabla^{2} u$、定义域$\\mathbb{R}^n$、初始条件$u(\\mathbf{x},0)= A \\exp\\!\\big(-|\\mathbf{x}|^{2}/(4\\beta)\\big)$以及常数$D>0$、$A>0$、$\\beta>0$。问题要求给出$u(\\mathbf{x},t)$在$t>0$时的闭式解。该问题是有效的。\n\n在$\\mathbb{R}^n$上，带有初始条件$u(\\mathbf{x},0) = g(\\mathbf{x})$的扩散方程的解可以表示为初始条件与热核的卷积。扩散方程$\\partial_{t} u = D \\nabla^{2} u$在$n$维空间中的热核，或称基本解，由以下公式给出：\n$$ K(\\mathbf{x}, t) = \\frac{1}{(4 \\pi D t)^{n/2}} \\exp\\left(-\\frac{|\\mathbf{x}|^2}{4Dt}\\right) $$\n初始条件为$g(\\mathbf{x}) = u(\\mathbf{x},0) = A \\exp\\left(-\\frac{|\\mathbf{x}|^2}{4\\beta}\\right)$。\n\n解$u(\\mathbf{x}, t)$是卷积积分：\n$$ u(\\mathbf{x}, t) = \\int_{\\mathbb{R}^n} K(\\mathbf{x} - \\mathbf{y}, t) g(\\mathbf{y}) \\, d^n\\mathbf{y} $$\n代入$K$和$g$的表达式：\n$$ u(\\mathbf{x}, t) = \\int_{\\mathbb{R}^n} \\frac{1}{(4 \\pi D t)^{n/2}} \\exp\\left(-\\frac{|\\mathbf{x} - \\mathbf{y}|^2}{4Dt}\\right) A \\exp\\left(-\\frac{|\\mathbf{y}|^2}{4\\beta}\\right) \\, d^n\\mathbf{y} $$\n我们可以把常数从积分中提出来：\n$$ u(\\mathbf{x}, t) = \\frac{A}{(4 \\pi D t)^{n/2}} \\int_{\\mathbb{R}^n} \\exp\\left(-\\frac{|\\mathbf{x} - \\mathbf{y}|^2}{4Dt} - \\frac{|\\mathbf{y}|^2}{4\\beta}\\right) \\, d^n\\mathbf{y} $$\n计算这个积分的关键是通过对积分变量$\\mathbf{y}$进行配方来简化指数。我们来分析指数中的项：\n$$ -\\left( \\frac{|\\mathbf{x} - \\mathbf{y}|^2}{4Dt} + \\frac{|\\mathbf{y}|^2}{4\\beta} \\right) = -\\frac{1}{4} \\left( \\frac{|\\mathbf{x}|^2 - 2\\mathbf{x}\\cdot\\mathbf{y} + |\\mathbf{y}|^2}{Dt} + \\frac{|\\mathbf{y}|^2}{\\beta} \\right) $$\n合并涉及$\\mathbf{y}$的项：\n$$ = -\\frac{1}{4} \\left[ \\left(\\frac{1}{Dt} + \\frac{1}{\\beta}\\right)|\\mathbf{y}|^2 - \\frac{2\\mathbf{x}\\cdot\\mathbf{y}}{Dt} + \\frac{|\\mathbf{x}|^2}{Dt} \\right] $$\n$$ = -\\frac{1}{4} \\left[ \\left(\\frac{\\beta + Dt}{\\beta Dt}\\right)|\\mathbf{y}|^2 - \\frac{2\\mathbf{x}\\cdot\\mathbf{y}}{Dt} + \\frac{|\\mathbf{x}|^2}{Dt} \\right] $$\n现在我们对$\\mathbf{y}$中的项进行配方。我们使用恒等式$az^2 - 2bz = a(z-b/a)^2 - b^2/a$。这里，变量是一个向量$\\mathbf{y}$，所以我们有$a|\\mathbf{y}|^2 - 2\\mathbf{b}\\cdot\\mathbf{y} = a|\\mathbf{y}-\\mathbf{b}/a|^2 - |\\mathbf{b}|^2/a$。在我们的例子中，$a = \\frac{\\beta + Dt}{\\beta Dt}$且$\\mathbf{b} = \\frac{\\mathbf{x}}{Dt}$。\n$\\mathbf{y}$中的项变为：\n$$ \\left(\\frac{\\beta + Dt}{\\beta Dt}\\right)\\left|\\mathbf{y} - \\frac{\\mathbf{x}}{Dt}\\frac{\\beta Dt}{\\beta+Dt}\\right|^2 - \\frac{|\\mathbf{x}|^2}{(Dt)^2}\\frac{\\beta Dt}{\\beta+Dt} = \\left(\\frac{\\beta + Dt}{\\beta Dt}\\right)\\left|\\mathbf{y} - \\frac{\\beta}{\\beta+Dt}\\mathbf{x}\\right|^2 - \\frac{\\beta|\\mathbf{x}|^2}{Dt(\\beta+Dt)} $$\n将此代回完整的指数中：\n$$ -\\frac{1}{4} \\left[ \\left(\\frac{\\beta + Dt}{\\beta Dt}\\right)\\left|\\mathbf{y} - \\frac{\\beta}{\\beta+Dt}\\mathbf{x}\\right|^2 - \\frac{\\beta|\\mathbf{x}|^2}{Dt(\\beta+Dt)} + \\frac{|\\mathbf{x}|^2}{Dt} \\right] $$\n涉及$|\\mathbf{x}|^2$的项简化为：\n$$ \\frac{|\\mathbf{x}|^2}{Dt} - \\frac{\\beta|\\mathbf{x}|^2}{Dt(\\beta+Dt)} = \\frac{|\\mathbf{x}|^2}{Dt}\\left(1 - \\frac{\\beta}{\\beta+Dt}\\right) = \\frac{|\\mathbf{x}|^2}{Dt}\\left(\\frac{\\beta+Dt-\\beta}{\\beta+Dt}\\right) = \\frac{|\\mathbf{x}|^2}{\\beta+Dt} $$\n所以指数是：\n$$ -\\frac{\\beta + Dt}{4\\beta Dt}\\left|\\mathbf{y} - \\frac{\\beta}{\\beta+Dt}\\mathbf{x}\\right|^2 - \\frac{|\\mathbf{x}|^2}{4(\\beta+Dt)} $$\n我们现在可以将积分写成：\n$$ u(\\mathbf{x}, t) = \\frac{A}{(4 \\pi D t)^{n/2}} \\int_{\\mathbb{R}^n} \\exp\\left(-\\frac{\\beta + Dt}{4\\beta Dt}\\left|\\mathbf{y} - \\frac{\\beta}{\\beta+Dt}\\mathbf{x}\\right|^2 - \\frac{|\\mathbf{x}|^2}{4(\\beta+Dt)}\\right) \\, d^n\\mathbf{y} $$\n只涉及$\\mathbf{x}$的项可以从积分中因子分解出来：\n$$ u(\\mathbf{x}, t) = \\frac{A}{(4 \\pi D t)^{n/2}} \\exp\\left(-\\frac{|\\mathbf{x}|^2}{4(\\beta+Dt)}\\right) \\int_{\\mathbb{R}^n} \\exp\\left(-\\frac{\\beta + Dt}{4\\beta Dt}\\left|\\mathbf{y} - \\frac{\\beta}{\\beta+Dt}\\mathbf{x}\\right|^2\\right) \\, d^n\\mathbf{y} $$\n剩余的积分是一个多维高斯积分。令$\\mathbf{z} = \\mathbf{y} - \\frac{\\beta}{\\beta+Dt}\\mathbf{x}$，所以$d^n\\mathbf{y} = d^n\\mathbf{z}$。积分变为：\n$$ \\int_{\\mathbb{R}^n} \\exp\\left(-c|\\mathbf{z}|^2\\right) \\, d^n\\mathbf{z} \\quad \\text{with} \\quad c = \\frac{\\beta + Dt}{4\\beta Dt} $$\n这个积分的值是$(\\pi/c)^{n/2}$。\n$$ \\left(\\frac{\\pi}{(\\beta + Dt)/(4\\beta Dt)}\\right)^{n/2} = \\left(\\frac{4\\pi\\beta Dt}{\\beta+Dt}\\right)^{n/2} $$\n将此结果代回$u(\\mathbf{x}, t)$的表达式中：\n$$ u(\\mathbf{x}, t) = \\frac{A}{(4 \\pi D t)^{n/2}} \\exp\\left(-\\frac{|\\mathbf{x}|^2}{4(\\beta+Dt)}\\right) \\left(\\frac{4\\pi\\beta Dt}{\\beta+Dt}\\right)^{n/2} $$\n我们可以简化前置因子：\n$$ \\frac{A}{(4 \\pi D t)^{n/2}} \\left(4\\pi\\beta Dt\\right)^{n/2} \\left(\\frac{1}{\\beta+Dt}\\right)^{n/2} = A \\left(\\frac{4\\pi\\beta Dt}{4\\pi Dt}\\right)^{n/2} \\left(\\frac{1}{\\beta+Dt}\\right)^{n/2} = A \\left(\\frac{\\beta}{\\beta+Dt}\\right)^{n/2} $$\n因此，浓度场的最终闭式表达式是：\n$$ u(\\mathbf{x}, t) = A \\left(\\frac{\\beta}{\\beta+Dt}\\right)^{n/2} \\exp\\left(-\\frac{|\\mathbf{x}|^2}{4(\\beta+Dt)}\\right) $$\n这个表达式代表一个保持在原点中心的高斯分布，但其振幅随时间减小，宽度随时间增加，这是从初始局部源扩散的特征行为。",
            "answer": "$$\\boxed{A \\left(\\frac{\\beta}{\\beta + Dt}\\right)^{n/2} \\exp\\left(-\\frac{|\\mathbf{x}|^{2}}{4(\\beta + Dt)}\\right)}$$"
        },
        {
            "introduction": "真实的生物系统通常包含增殖和饱和等反应过程，从而引出反应扩散方程。本实践将探讨著名的Fisher-KPP方程 $\\partial_{t} u = D \\nabla^{2} u + k u (1 - u)$ 中均匀稳态的稳定性。通过对系统进行线性化并使用傅里叶分析，我们可以确定一个状态是稳定的还是容易形成空间模式，这是发育生物学和生态学中的一个关键概念。",
            "id": "4372328",
            "problem": "考虑一个单物种细胞种群，其在 $n$ 维空间中的密度为 $u(\\mathbf{x}, t)$，该种群经历随机迁移和逻辑斯蒂增殖。随机迁移通过菲克定律建模，该定律指出通量为 $\\mathbf{J} = - D \\nabla u$，其中 $D$ 是扩散系数，而质量守恒意味着偏微分方程中存在扩散项 $D \\nabla^{2} u$。逻辑斯蒂增殖通过反应项 $k u (1 - u)$ 建模，其中 $k$ 是内禀增殖率。由此得到的偏微分方程 (PDE) 是\n$$\n\\partial_{t} u = D \\nabla^{2} u + k u (1 - u).\n$$\n假设空间域为无界的 $\\mathbb{R}^{n}$，以便应用空间傅里叶分析。仅从上述基本建模假设（菲克扩散和逻辑斯蒂增殖）和基本线性化原理出发，完成以下任务：\n- 通过要求时间导数为零且空间梯度不存在，推导该偏微分方程的所有空间均匀稳态 $u^{*}$。\n- 通过计算在 $u^{*}$ 处求值的反应项的雅可比矩阵（对于标量反应项，即其导数），将偏微分方程在空间均匀稳态 $u^{*}$ 附近线性化，并使用空间傅里叶模来获得波数向量为 $\\mathbf{q} \\in \\mathbb{R}^{n}$ 的无穷小扰动的色散关系。\n- 根据色散关系，确定稳态 $u^{*} = 1$ 在所有波数 $\\mathbf{q}$ 上的最大实数增长率 $\\lambda_{\\max}$。\n\n请以 $D$ 和 $k$ 表示的单一闭式解析表达式形式提供您的最终答案 $\\lambda_{\\max}$。不需要进行数值近似或四舍五入。最终表达式中不要包含单位。",
            "solution": "问题陈述是连贯的，在反应扩散系统的既定理论中有科学依据，并提供了进行形式分析所需的所有必要信息。因此，该问题被认为是有效的。\n\n控制细胞种群密度 $u(\\mathbf{x}, t)$ 的偏微分方程 (PDE) 如下所示：\n$$\n\\partial_{t} u = D \\nabla^{2} u + k u (1 - u)\n$$\n其中 $D$ 是扩散系数，$k$ 是内禀增殖率。$D$ 和 $k$ 都是正常数，即 $D > 0$ 且 $k > 0$。空间域是无界的 $n$ 维空间 $\\mathbb{R}^{n}$。\n\n首先，我们确定空间均匀稳态，记作 $u^{*}$。稳态是一个不随时间变化的解，这意味着 $\\partial_{t} u = 0$。空间均匀解是一个不随空间变化的解，这意味着所有空间导数都为零，因此 $\\nabla u = \\mathbf{0}$，从而 $\\nabla^{2} u = 0$。将这些条件代入偏微分方程得到：\n$$\n0 = D(0) + k u^{*} (1 - u^{*})\n$$\n$$\nk u^{*} (1 - u^{*}) = 0\n$$\n由于增殖率 $k$ 为正，该方程成立的充要条件是：\n$$\nu^{*} (1 - u^{*}) = 0\n$$\n这给出了两个可能的空间均匀稳态：\n$$\nu^{*} = 0 \\quad \\text{或} \\quad u^{*} = 1\n$$\n状态 $u^{*}=0$ 对应于种群灭绝，而 $u^{*}=1$ 代表环境的环境承载力。\n\n接下来，我们在一个一般稳态 $u^{*}$ 附近对偏微分方程进行线性化，以分析其对小扰动的稳定性。设解表示为稳态与一个小扰动 $\\delta u(\\mathbf{x}, t)$ 之和：\n$$\nu(\\mathbf{x}, t) = u^{*} + \\delta u(\\mathbf{x}, t)\n$$\n反应项为 $f(u) = k u (1 - u)$。$f(u)$ 在 $u^{*}$ 附近的泰勒展开为：\n$$\nf(u) = f(u^{*} + \\delta u) \\approx f(u^{*}) + f'(u^{*}) \\delta u + \\mathcal{O}((\\delta u)^2)\n$$\n从稳态条件可知，$f(u^{*}) = 0$。反应项的导数为：\n$$\nf'(u) = \\frac{d}{du} \\left( ku - ku^2 \\right) = k - 2ku = k(1 - 2u)\n$$\n在稳态 $u^{*}$ 处计算该导数，得到反应项的雅可比矩阵：\n$$\nf'(u^{*}) = k(1 - 2u^{*})\n$$\n将 $u = u^{*} + \\delta u$ 代入原始偏微分方程，并仅保留 $\\delta u$ 的线性项，我们得到扰动的线性化方程：\n$$\n\\partial_{t} (u^{*} + \\delta u) = D \\nabla^{2} (u^{*} + \\delta u) + f(u^{*} + \\delta u)\n$$\n$$\n\\partial_{t} \\delta u = D \\nabla^{2} \\delta u + f(u^{*}) + f'(u^{*})\\delta u + \\mathcal{O}((\\delta u)^2)\n$$\n$$\n\\partial_{t} (\\delta u) = D \\nabla^{2} (\\delta u) + k(1 - 2u^{*}) \\delta u\n$$\n为了找到色散关系，我们考虑扰动的单个空间傅里叶模：\n$$\n\\delta u(\\mathbf{x}, t) = A \\exp(\\lambda t + i \\mathbf{q} \\cdot \\mathbf{x})\n$$\n其中 $A$ 是恒定振幅，$\\mathbf{q}$ 是波数向量，$\\lambda$ 是扰动的增长率，它依赖于 $\\mathbf{q}$。此扰动的时间导数和拉普拉斯算子为：\n$$\n\\partial_{t} (\\delta u) = \\lambda \\delta u\n$$\n$$\n\\nabla^{2} (\\delta u) = (i\\mathbf{q}) \\cdot (i\\mathbf{q}) \\delta u = -|\\mathbf{q}|^2 \\delta u = -q^2 \\delta u\n$$\n其中 $q = |\\mathbf{q}|$ 是波数向量的模。将这些代入线性化的偏微分方程：\n$$\n\\lambda \\delta u = D(-q^2 \\delta u) + k(1 - 2u^{*}) \\delta u\n$$\n两边同除以 $\\delta u$（因为它代表一个非平凡扰动），我们得到色散关系 $\\lambda(q)$：\n$$\n\\lambda(q) = -D q^2 + k(1 - 2u^{*})\n$$\n该关系给出了围绕稳态 $u^{*}$ 的扰动的增长率 $\\lambda$ 作为波数大小 $q$ 的函数。\n\n最后，我们将此结果应用于特定的稳态 $u^{*} = 1$。将 $u^{*} = 1$ 代入色散关系得到：\n$$\n\\lambda(q) = -D q^2 + k(1 - 2(1))\n$$\n$$\n\\lambda(q) = -D q^2 - k\n$$\n我们需要通过在所有可能的波数 $\\mathbf{q} \\in \\mathbb{R}^{n}$上最大化 $\\lambda(q)$ 来找到最大实数增长率 $\\lambda_{\\max}$。这等价于在所有非负波数大小 $q \\ge 0$上进行最大化。$\\lambda(q)$ 的表达式是两项之和：$-k$ 和 $-Dq^2$。由于 $D > 0$，项 $-Dq^2$ 总是非正的，即 $-Dq^2 \\le 0$。函数 $\\lambda(q)$ 是 $q^2$ 的单调递减函数。因此，其最大值在 $q^2$ 的可能最小值处取得，即 $q^2=0$（对应于空间均匀扰动，$q=0$）。\n\n在 $\\lambda(q)$ 的表达式中令 $q=0$：\n$$\n\\lambda_{\\max} = \\lambda(0) = -D(0)^2 - k\n$$\n$$\n\\lambda_{\\max} = -k\n$$\n因此，对于稳态 $u^{*}=1$，任何无穷小扰动的最大增长率为 $-k$。由于 $k > 0$，该率为负，表明稳态 $u^{*}=1$ 对所有小扰动都是稳定的。最持久的扰动是那些具有无限波长（$q=0$）的扰动，它们以由内禀增殖参数 $k$ 决定的速率衰减。",
            "answer": "$$\\boxed{-k}$$"
        },
        {
            "introduction": "虽然解析方法能提供深刻的洞见，但大多数涉及复杂几何形状或空间异质性的现实世界问题都需要数值求解。本实践将介绍功能强大的有限元方法（FEM），用于解决稳态扩散问题。您不仅需要推导理论上的“弱形式”，还将亲手实现一个基础的FEM求解器，为掌握系统生物医学中的高等计算建模打下坚实的基础。",
            "id": "4372332",
            "problem": "考虑一个标量浓度场在平面域上的稳态扩散。设该域为一个有界多边形集，记为 $\\Omega \\subset \\mathbb{R}^2$，其边界为 $\\partial \\Omega$。从菲克第一定律（Fick's First Law）和质量守恒推导出的控制偏微分方程（PDE）为\n$$\n-\\nabla \\cdot \\left(D \\nabla u\\right) = f \\quad \\text{in } \\Omega,\n$$\n并带有狄利克雷（Dirichlet）边界条件\n$$\nu = g \\quad \\text{on } \\partial \\Omega,\n$$\n其中 $u$ 是浓度，$D$ 是严格为正的标量扩散系数，$f$ 是给定的体积源。请从上述强形式出发，利用：(i) 菲克第一定律，(ii) 散度定理，以及 (iii) 在 $\\partial \\Omega$ 上为零的函数的索博列夫空间（Sobolev space）$\\mathcal{H}_0^1(\\Omega)$ 的定义，推导其弱形式。您的推导必须从这些基本原理出发，不得依赖任何预先给出的有限元公式。\n\n然后，在二维三角形网格上，对每个三角形使用一阶（线性）形函数，实现线性有限元方法（FEM）。您的实现必须：\n- 通过对扩散项进行精确积分（注意线性形函数的梯度在每个三角形上是常数），并对源项使用一致的单点形心积分，来组装全局刚度矩阵和载荷向量。\n- 强施加狄利克雷边界条件。\n- 求解得到的线性系统，并根据测试套件中指定的精确解 $u_{\\text{exact}}$ 计算最大绝对节点误差。\n\n本问题中的所有量都是纯数学的；将 $D$、$u$ 和 $f$ 视为无量纲量。要求的输出是无量纲的节点误差，表示为实数。\n\n测试套件。实现并运行以下三种情况。对于每种情况，报告其最大绝对节点误差（一个实数）作为该情况的结果。\n\n- 情况 $\\mathbf{1}$（在线性精确解的最小网格上进行验证）：\n  - 节点：$\\left(x,y\\right) \\in \\left\\{(0,0),(1,0),(1,1),(0,1)\\right\\}$。\n  - 三角形：$\\left[\\,(0,1,2),\\,(0,2,3)\\,\\right]$，使用从零开始的节点索引和逆时针方向。\n  - 扩散系数：$D = 1$。\n  - 源：$f(x,y) = 0$。\n  - 边界数据：$g(x,y) = x + y$ on $\\partial \\Omega$。\n  - 精确解：$u_{\\text{exact}}(x,y) = x + y$。\n\n- 情况 $\\mathbf{2}$（在线性精确解下进行几何和扩散系数缩放）：\n  - 节点：$\\left(x,y\\right) \\in \\left\\{(0,0),(2,0),(2,1),(0,1)\\right\\}$。\n  - 三角形：$\\left[\\,(0,1,2),\\,(0,2,3)\\,\\right]$，使用从零开始的节点索引和逆时针方向。\n  - 扩散系数：$D = \\tfrac{1}{2}$。\n  - 源：$f(x,y) = 0$。\n  - 边界数据：$g(x,y) = x - y$ on $\\partial \\Omega$。\n  - 精确解：$u_{\\text{exact}}(x,y) = x - y$。\n\n- 情况 $\\mathbf{3}$（在加密网格上的非零源；二次精确解）：\n  - 节点：在 $\\left[0,1\\right]\\times\\left[0,1\\right]$ 上的均匀网格，间距为 $\\Delta = \\tfrac{1}{2}$，即 $\\left(x,y\\right) \\in \\left\\{0,\\tfrac{1}{2},1\\right\\}\\times\\left\\{0,\\tfrac{1}{2},1\\right\\}$，按行主序枚举。\n  - 三角形：每个方形单元由其左下角到右上角的对角线分割成两个三角形，并逆时针定向。\n  - 扩散系数：$D = 1$。\n  - 源：$f(x,y) = -4$（以便二次精确解满足该偏微分方程）。\n  - 边界数据：$g(x,y) = x^2 + y^2$ on $\\partial \\Omega$。\n  - 精确解：$u_{\\text{exact}}(x,y) = x^2 + y^2$。\n\n数值方法说明：\n- 在每个三角形上使用线性形函数。对于顶点为 $\\left(x_1,y_1\\right)$、$\\left(x_2,y_2\\right)$、$\\left(x_3,y_3\\right)$ 的三角形，其面积 $A$ 必须为正，并由有向行列式计算得出。\n- 对于扩散项，必须利用线性形函数的梯度在三角形上为常数的性质来精确计算单元刚度项。\n- 单元载荷向量必须使用形心法则：在形心处计算 $f$ 的值，并对三角形的每个节点乘以 $A/3$。\n- 通过强施加所有边界节点上的节点值来施加狄利克雷边界条件。\n\n您的程序必须生成单行输出，其中包含用方括号括起来的、按三个案例顺序排列的、以逗号分隔的结果列表，例如：$\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3\\right]$。每个 $\\text{result}_i$ 必须是一个实数（一个 Python 浮点数）。程序不需要用户输入，答案中也不使用单位。",
            "solution": "该问题要求两个主要部分：首先，推导稳态扩散方程的弱形式；其次，实现有限元方法 (FEM) 来求解三个特定的测试案例。\n\n### 第一部分：弱形式的推导\n\n分析从稳态扩散方程的强形式开始，这是一个控制域 $\\Omega \\subset \\mathbb{R}^2$ 中浓度场 $u$ 的偏微分方程 (PDE)。\n\n控制 PDE 为：\n$$\n-\\nabla \\cdot \\mathbf{J} = f \\quad \\text{in } \\Omega\n$$\n其中 $\\mathbf{J}$ 是扩散通量，$f$ 是一个体积源项。菲克第一定律（Fick's First Law）为通量提供了一个本构关系：\n$$\n\\mathbf{J} = -D \\nabla u\n$$\n其中 $D$ 是扩散系数，假定为严格为正的标量。将菲克定律代入守恒方程，得到 PDE 的强形式：\n$$\n-\\nabla \\cdot (D \\nabla u) = f \\quad \\text{in } \\Omega\n$$\n该方程辅以狄利克雷（Dirichlet）边界条件，该条件指定了在边界 $\\partial\\Omega$ 上的浓度值：\n$$\nu = g \\quad \\text{on } \\partial\\Omega\n$$\n为了推导弱形式，我们遵循变分法中的标准程序。\n\n**第一步：乘以一个测试函数并积分**\n\n我们引入一个测试函数（或变分）$v$。此函数必须属于一个合适的函数空间。出于稍后将明了的原因，我们从索博列夫空间（Sobolev space）$\\mathcal{H}_0^1(\\Omega)$ 中选择 $v$。这是在 $\\Omega$ 上一阶导数平方可积且在边界 $\\partial\\Omega$ 上等于零的函数空间。在 $\\partial\\Omega$ 上 $v=0$ 的条件是至关重要的。\n\n我们将 PDE 乘以一个任意的测试函数 $v \\in \\mathcal{H}_0^1(\\Omega)$，并在整个域 $\\Omega$ 上积分：\n$$\n\\int_{\\Omega} -v \\left[ \\nabla \\cdot (D \\nabla u) \\right] dA = \\int_{\\Omega} v f \\, dA\n$$\n\n**第二步：应用分部积分（散度定理）**\n\n核心步骤是将一个导数从解 $u$ 转移到测试函数 $v$ 上。这是通过使用多维分部积分形式来完成的，它是散度定理的直接推论。我们使用向量微积分恒等式：\n$$\n\\nabla \\cdot (v \\mathbf{F}) = (\\nabla v) \\cdot \\mathbf{F} + v (\\nabla \\cdot \\mathbf{F})\n$$\n其中 $\\mathbf{F}$ 是一个向量场。令 $\\mathbf{F} = D \\nabla u$。该恒等式变为：\n$$\n\\nabla \\cdot (v D \\nabla u) = (\\nabla v) \\cdot (D \\nabla u) + v (\\nabla \\cdot (D \\nabla u))\n$$\n为我们积分中的项重新整理：\n$$\nv (\\nabla \\cdot (D \\nabla u)) = \\nabla \\cdot (v D \\nabla u) - (\\nabla v) \\cdot (D \\nabla u)\n$$\n将此代回积分方程：\n$$\n\\int_{\\Omega} - \\left[ \\nabla \\cdot (v D \\nabla u) - D (\\nabla v) \\cdot (\\nabla u) \\right] dA = \\int_{\\Omega} v f \\, dA\n$$\n$$\n-\\int_{\\Omega} \\nabla \\cdot (v D \\nabla u) \\, dA + \\int_{\\Omega} D (\\nabla v) \\cdot (\\nabla u) \\, dA = \\int_{\\Omega} v f \\, dA\n$$\n现在，我们将散度定理应用于第一项。该定理指出，对于向量场 $\\mathbf{G}$，有 $\\int_{\\Omega} \\nabla \\cdot \\mathbf{G} \\, dA = \\int_{\\partial\\Omega} \\mathbf{G} \\cdot \\mathbf{n} \\, dS$，其中 $\\mathbf{n}$ 是边界 $\\partial\\Omega$ 的外向单位法向量。令 $\\mathbf{G} = v D \\nabla u$，我们得到：\n$$\n-\\int_{\\partial\\Omega} (v D \\nabla u) \\cdot \\mathbf{n} \\, dS + \\int_{\\Omega} D (\\nabla v) \\cdot (\\nabla u) \\, dA = \\int_{\\Omega} v f \\, dA\n$$\n\n**第三步：应用测试函数边界条件**\n\n测试函数 $v$ 是从空间 $\\mathcal{H}_0^1(\\Omega)$ 中选择的。根据定义，该空间中的任何函数在边界上都为零，即在 $\\partial\\Omega$ 上 $v=0$。这个选择使得边界积分为零：\n$$\n-\\int_{\\partial\\Omega} (0 \\cdot D \\nabla u) \\cdot \\mathbf{n} \\, dS = 0\n$$\n方程简化为：\n$$\n\\int_{\\Omega} D (\\nabla v) \\cdot (\\nabla u) \\, dA = \\int_{\\Omega} v f \\, dA\n$$\n这就是问题的**弱形式**。我们不再寻找一个在每一点都满足 PDE 的函数 $u$（这要求 $u$ 是二次可微的），而是寻找一个对于所有测试函数 $v \\in \\mathcal{H}_0^1(\\Omega)$ 都满足此积分方程，并且在边界 $\\partial\\Omega$ 上满足边界条件 $u=g$ 的函数 $u$。这“弱化”了对 $u$ 的可微性要求，仅要求其一阶导数是平方可积的。\n\n问题可以表述为：寻找 $u \\in \\mathcal{H}^1(\\Omega)$，使得在 $\\partial\\Omega$ 上 $u=g$ 并且对于所有 $v \\in \\mathcal{H}_0^1(\\Omega)$ 都有\n$$\na(u,v) = L(v)\n$$\n其中 $a(u,v) = \\int_{\\Omega} D (\\nabla v) \\cdot (\\nabla u) \\, dA$ 是一个双线性形式，$L(v) = \\int_{\\Omega} v f \\, dA$ 是一个线性泛函。\n\n### 第二部分：有限元方法实现\n\nFEM 将弱形式离散化。域 $\\Omega$ 被剖分为一个由简单单元（在本例中为三角形）组成的网格。\n\n**解的离散化**\n\n在每个三角形单元 $K$ 内，解 $u$ 由一个线性多项式近似。全局解 $u_h$ 是一个连续的分段线性函数，表示为对网格中所有节点的求和：\n$$\nu_h(x,y) = \\sum_{j=1}^{N_p} U_j \\phi_j(x,y)\n$$\n这里，$N_p$ 是节点的总数，$U_j$ 是解在节点 $j$ 处的未知值，$\\phi_j(x,y)$ 是与节点 $j$ 相关联的线性基函数（或“帽函数”）。基函数 $\\phi_j$ 具有在节点 $j$ 处等于1，在所有其他节点处等于0的性质。\n\n**伽辽金（Galerkin）方法**\n\n在伽辽金方法中，测试函数空间被选择为与齐次问题的近似空间相同，即由对应于内部节点的基函数 $\\phi_i$ 张成。通过要求弱形式对每一个这样的基函数都成立，我们得到一个线性方程组。将 $u_h$ 代入弱形式，并取测试函数为 $v=\\phi_i$（其中 $i$ 是一个内部节点索引）：\n$$\n\\int_{\\Omega} D \\left(\\nabla \\phi_i\\right) \\cdot \\left(\\nabla \\sum_{j=1}^{N_p} U_j \\phi_j\\right) dA = \\int_{\\Omega} \\phi_i f \\, dA\n$$\n$$\n\\sum_{j=1}^{N_p} \\left( \\int_{\\Omega} D (\\nabla \\phi_i) \\cdot (\\nabla \\phi_j) \\, dA \\right) U_j = \\int_{\\Omega} \\phi_i f \\, dA\n$$\n这是一个形如 $\\mathbf{K}\\mathbf{U} = \\mathbf{F}$ 的线性系统，其中 $\\mathbf{U}$ 是节点未知量向量。全局刚度矩阵 $\\mathbf{K}$ 和载荷向量 $\\mathbf{F}$ 的项为：\n$$\nK_{ij} = \\int_{\\Omega} D (\\nabla \\phi_i) \\cdot (\\nabla \\phi_j) \\, dA\n$$\n$$\nF_i = \\int_{\\Omega} \\phi_i f \\, dA\n$$\n\n**单元级计算**\n\n这些积分是通过对每个单元 $K$ 的贡献求和来计算的。\n\n*   **单元刚度矩阵 ($k^K$)**：对于一个顶点为 $(x_1, y_1), (x_2, y_2), (x_3, y_3)$ 的三角形 $K$，线性形函数 $N_i$ 具有恒定的梯度。局部项 $k^K_{ij}$ 为 $\\int_K D (\\nabla N_i) \\cdot (\\nabla N_j) \\, dA$。由于被积函数在单元上是常数，该积分就是被积函数乘以单元面积 $A_K$。梯度分量为 $\\nabla N_i = (b_i, c_i)$，其中 $b_i = (y_j-y_k)/(2A_K)$ 和 $c_i = (x_k-x_j)/(2A_K)$（对于循环索引 $i,j,k$）。因此，单元刚度可以精确计算为：\n    $$\n    k^K_{ij} = D A_K (b_i b_j + c_i c_j)\n    $$\n\n*   **单元载荷向量 ($f^K$)**：问题指定对源项使用单点形心积分。单元载荷向量的积分近似为：\n    $$\n    f^K_i = \\int_K N_i f \\, dA \\approx A_K \\left[ N_i(\\mathbf{x}_c) f(\\mathbf{x}_c) \\right]\n    $$\n    其中 $\\mathbf{x}_c$ 是三角形的形心。在形心处，所有线性形函数的值都为 $1/3$，因此 $N_i(\\mathbf{x}_c) = 1/3$。这得到：\n    $$\n    f^K_i = \\frac{A_K}{3} f(\\mathbf{x}_c)\n    $$\n\n**组装与边界条件**\n\n全局刚度矩阵 $\\mathbf{K}$ 和载荷向量 $\\mathbf{F}$ 是通过遍历所有三角形，并将单元贡献 $k^K$ 和 $f^K$ 添加到相应的全局位置来组装的。\n\n为了强施加狄利克雷边界条件，系统被剖分为对应于内部（未知）和边界（已知）节点的分量。设 $U_I$ 为内部节点上的未知量向量，$U_B$ 为边界节点上的给定值向量。完整的系统 $\\mathbf{K}\\mathbf{U} = \\mathbf{F}$ 可以写成分块形式：\n$$\n\\begin{pmatrix} \\mathbf{K}_{II} & \\mathbf{K}_{IB} \\\\ \\mathbf{K}_{BI} & \\mathbf{K}_{BB} \\end{pmatrix} \\begin{pmatrix} \\mathbf{U}_I \\\\ \\mathbf{U}_B \\end{pmatrix} = \\begin{pmatrix} \\mathbf{F}_I \\\\ \\mathbf{F}_B \\end{pmatrix}\n$$\n第一行给出了关于未知量 $\\mathbf{U}_I$ 的一个系统：\n$$\n\\mathbf{K}_{II} \\mathbf{U}_I + \\mathbf{K}_{IB} \\mathbf{U}_B = \\mathbf{F}_I \\quad \\implies \\quad \\mathbf{K}_{II} \\mathbf{U}_I = \\mathbf{F}_I - \\mathbf{K}_{IB} \\mathbf{U}_B\n$$\n这个更小的、适定的系统被求解以得到 $\\mathbf{U}_I$。然后通过组合计算出的 $\\mathbf{U}_I$ 和给定的 $\\mathbf{U}_B$ 来构造完整的解向量 $\\mathbf{U}$。\n\n**误差计算**\n\n最后一步是计算最大绝对节点误差，定义为 $\\max_i |U_i - u_{\\text{exact}}(\\mathbf{x}_i)|$，其中 $U_i$ 是计算得到的节点值，$u_{\\text{exact}}$ 是在节点坐标 $\\mathbf{x}_i$ 处求值的给定精确解。对于给定的测试案例，其精确解是线性解或在特殊对称网格上的二次多项式解，这个误差预计接近于零（在机器精度范围内）。这是因为线性 FEM 对于线性解是精确的，而对于案例3，由于网格对称性和二次解的性质，在节点处会发生一种称为超收敛的现象，从而得到精确的节点解。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the FEM solver for all test cases.\n    \"\"\"\n    \n    # --- Test Case Definitions ---\n\n    # Case 1: Linear exact solution, unit square\n    nodes1 = np.array([\n        (0.0, 0.0), (1.0, 0.0), (1.0, 1.0), (0.0, 1.0)\n    ])\n    triangles1 = np.array([[0, 1, 2], [0, 2, 3]])\n    D1 = 1.0\n    f1 = lambda x, y: 0.0\n    g1 = lambda x, y: x + y\n    u_exact1 = lambda x, y: x + y\n    case1 = (nodes1, triangles1, D1, f1, g1, u_exact1, \"Case 1\")\n\n    # Case 2: Linear exact solution, scaled domain and diffusivity\n    nodes2 = np.array([\n        (0.0, 0.0), (2.0, 0.0), (2.0, 1.0), (0.0, 1.0)\n    ])\n    triangles2 = np.array([[0, 1, 2], [0, 2, 3]])\n    D2 = 0.5\n    f2 = lambda x, y: 0.0\n    g2 = lambda x, y: x - y\n    u_exact2 = lambda x, y: x - y\n    case2 = (nodes2, triangles2, D2, f2, g2, u_exact2, \"Case 2\")\n\n    # Case 3: Quadratic exact solution, refined mesh, non-zero source\n    nodes3_list = []\n    for y in [0.0, 0.5, 1.0]:\n        for x in [0.0, 0.5, 1.0]:\n            nodes3_list.append((x, y))\n    nodes3 = np.array(nodes3_list)\n    \n    # Triangles for the 4 squares in the 2x2 grid\n    triangles3 = np.array([\n        [0, 1, 4], [0, 4, 3],  # Bottom-left square\n        [1, 2, 5], [1, 5, 4],  # Bottom-right square\n        [3, 4, 7], [3, 7, 6],  # Top-left square\n        [4, 5, 8], [4, 8, 7]   # Top-right square\n    ])\n    D3 = 1.0\n    f3 = lambda x, y: -4.0\n    g3 = lambda x, y: x**2 + y**2\n    u_exact3 = lambda x, y: x**2 + y**2\n    case3 = (nodes3, triangles3, D3, f3, g3, u_exact3, \"Case 3\")\n\n    test_cases = [case1, case2, case3]\n    results = []\n\n    for case in test_cases:\n        nodes, triangles, D, f, g, u_exact, case_name = case\n        n_nodes = len(nodes)\n\n        K = np.zeros((n_nodes, n_nodes))\n        F = np.zeros(n_nodes)\n\n        # --- Assembly Phase ---\n        for tri_nodes in triangles:\n            p_indices = tri_nodes\n            p_coords = nodes[p_indices]\n            (x1, y1), (x2, y2), (x3, y3) = p_coords[0], p_coords[1], p_coords[2]\n\n            # Calculate triangle area (must be positive for CCW orientation)\n            area = 0.5 * (x1 * (y2 - y3) + x2 * (y3 - y1) + x3 * (y1 - y2))\n            if area = 1e-12: # Check for degenerate or incorrectly oriented triangles\n                raise ValueError(f\"Triangle {p_indices} has non-positive area.\")\n\n            # Coefficients for shape function gradients\n            b = np.array([y2 - y3, y3 - y1, y1 - y2]) / (2 * area)\n            c = np.array([x3 - x2, x1 - x3, x2 - x1]) / (2 * area)\n            \n            # Element stiffness matrix (exact integration)\n            k_e = np.zeros((3, 3))\n            for r in range(3):\n                for s in range(3):\n                    k_e[r, s] = D * area * (b[r] * b[s] + c[r] * c[s])\n            \n            # Element load vector (centroid quadrature)\n            centroid = np.mean(p_coords, axis=0)\n            f_val = f(centroid[0], centroid[1])\n            f_e = (area * f_val / 3.0) * np.ones(3)\n\n            # Assemble into global system\n            ix = np.ix_(p_indices, p_indices)\n            K[ix] += k_e\n            F[p_indices] += f_e\n            \n        # --- Boundary Condition Enforcement ---\n        \n        # Identify boundary and interior nodes\n        if case_name == \"Case 3\":\n            # For Case 3, boundary nodes are on x=0,1 or y=0,1\n            boundary_nodes = [i for i, (x, y) in enumerate(nodes) \n                              if np.isclose(x, 0.) or np.isclose(x, 1.) or \n                                 np.isclose(y, 0.) or np.isclose(y, 1.)]\n        else:\n            # For Cases 1 and 2, all nodes are on the boundary\n            boundary_nodes = list(range(n_nodes))\n\n        all_nodes_set = set(range(n_nodes))\n        interior_nodes = sorted(list(all_nodes_set - set(boundary_nodes)))\n        \n        U = np.zeros(n_nodes)\n        \n        # Prescribe values at boundary nodes\n        U_B = np.array([g(nodes[i, 0], nodes[i, 1]) for i in boundary_nodes])\n        U[boundary_nodes] = U_B\n\n        # --- Solution Phase ---\n        if interior_nodes:\n            # Partition the system for interior nodes\n            K_II = K[np.ix_(interior_nodes, interior_nodes)]\n            K_IB = K[np.ix_(interior_nodes, boundary_nodes)]\n            F_I = F[interior_nodes]\n            \n            # Modify the right-hand side\n            F_rhs = F_I - K_IB @ U_B\n            \n            # Solve for interior nodal values\n            U_I = np.linalg.solve(K_II, F_rhs)\n            U[interior_nodes] = U_I\n\n        # --- Error Calculation ---\n        exact_U = np.array([u_exact(node[0], node[1]) for node in nodes])\n        max_error = np.max(np.abs(U - exact_U))\n        results.append(max_error)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}