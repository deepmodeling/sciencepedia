{
    "hands_on_practices": [
        {
            "introduction": "我们从非负矩阵分解（Nonnegative Matrix Factorization, NMF）的基础算法开始。这项练习将引导您从第一性原理出发，推导经典的乘法更新规则，从而深入理解作为许多数据集成方法基础的优化过程。掌握此推导过程是为特定生物医学应用开发和定制分解模型的关键。",
            "id": "4360201",
            "problem": "在一项系统生物医学研究中，你正在通过使用非负矩阵分解（NMF）来近似一个非负数据矩阵，以整合两种组学模态。设整合后的数据矩阵为 $X \\in \\mathbb{R}_{\\ge 0}^{m \\times n}$，在平方弗罗贝尼乌斯（Frobenius）目标下，寻求一个分解 $X \\approx W H$，其中 $W \\in \\mathbb{R}_{\\ge 0}^{m \\times r}$ 且 $H \\in \\mathbb{R}_{\\ge 0}^{r \\times n}$。仅从平方弗罗贝尼乌斯范数的定义、矩阵微积分的标准法则以及针对非负性约束的 Karush–Kuhn–Tucker (KKT) 条件出发：\n\n- 推导 $W$ 和 $H$ 的乘性更新法则，这些法则能够单调递减目标函数值，同时保持非负性。\n- 陈述这些乘性更新保持非负性并导出一个非增目标序列的条件，并辨识其极限点的性质。\n\n然后，将你推导出的 $H$ 更新法则应用于一个 $m = 3$、$n = 3$ 和 $r = 2$ 的具体玩具示例。考虑以下初始化和数据：\n$$\nX \\;=\\; \\begin{pmatrix}\n5  2  3 \\\\\n4  1  2 \\\\\n3  2  4\n\\end{pmatrix},\\quad\nW^{(0)} \\;=\\; \\begin{pmatrix}\n1  2 \\\\\n2  1 \\\\\n1  1\n\\end{pmatrix},\\quad\nH^{(0)} \\;=\\; \\begin{pmatrix}\n1  1  1 \\\\\n1  1  1\n\\end{pmatrix}.\n$$\n假设采用一个交替方案，首先在将 $W$ 固定为 $W^{(0)}$ 的同时，对 $H$ 进行一个完整的乘性更新步骤。使用你推导出的法则，计算条目 $h_{1,2}^{(1)}$ 的更新值。以精确分数形式给出你的最终答案（不要四舍五入）。最终答案必须是一个没有单位的实数。",
            "solution": "### 乘性更新法则的推导\n\n问题在于找到非负矩阵 $W$ 和 $H$，以最小化目标函数 $J$，该函数定义为近似误差的平方弗罗贝尼乌斯范数的一半：\n$$\nJ(W, H) = \\frac{1}{2} \\|X - WH\\|_F^2 = \\frac{1}{2} \\sum_{i=1}^{m} \\sum_{j=1}^{n} \\left(X_{ij} - \\sum_{k=1}^{r} W_{ik}H_{kj}\\right)^2\n$$\n优化是在所有索引 $i,j,k$ 满足约束 $W_{ik} \\ge 0$ 和 $H_{kj} \\ge 0$ 的条件下进行的。由于目标函数 $J$ 对于 $W$ 和 $H$ 不是联合凸的，我们采用交替最小二乘法，即在固定一个矩阵的同时优化另一个矩阵。\n\n目标函数可以用迹算子写作：\n$$\nJ(W, H) = \\frac{1}{2} \\operatorname{tr}\\left((X-WH)^T(X-WH)\\right) = \\frac{1}{2} \\operatorname{tr}\\left(X^T X - X^T WH - H^T W^T X + H^T W^T W H\\right)\n$$\n我们将使用矩阵微积分的法则，具体为 $\\frac{\\partial}{\\partial A} \\operatorname{tr}(AB) = B^T$、$\\frac{\\partial}{\\partial A} \\operatorname{tr}(A^T B) = B$ 以及 $\\frac{\\partial}{\\partial A} \\operatorname{tr}(A^T C A) = (C+C^T)A$。\n\n**1. H 的更新法则**\n\n固定 $W$，问题转化为在 $H \\ge 0$ 的约束下最小化 $J(H)$。这是一个带约束的凸优化问题。我们为非负性约束 $H \\ge 0$ 引入一个拉格朗日乘子矩阵 $\\Lambda \\in \\mathbb{R}_{\\ge 0}^{r \\times n}$。拉格朗日函数为：\n$$\n\\mathcal{L}(H, \\Lambda) = J(H) - \\operatorname{tr}(\\Lambda^T H)\n$$\n最优性的 Karush–Kuhn–Tucker (KKT) 条件是：\n-   平稳性: $\\nabla_H \\mathcal{L} = \\nabla_H J(H) - \\Lambda = 0$\n-   原始可行性: $H_{kj} \\ge 0$\n-   对偶可行性: $\\Lambda_{kj} \\ge 0$\n-   互补松弛性: $\\Lambda_{kj} H_{kj} = 0$ 对于所有的 $k,j$。\n\n首先，我们计算梯度 $\\nabla_H J(H)$。使用迹公式和矩阵微积分法则：\n$$\n\\nabla_H J = \\frac{\\partial J}{\\partial H} = \\frac{1}{2} \\left( -W^T X - W^T X + (W^T W + (W^T W)^T) H \\right) = -W^T X + W^T W H\n$$\nKKT平稳性条件意味着 $\\Lambda = -W^T X + W^T W H$。互补松弛性条件变为：\n$$\n(-W^T X + W^T W H)_{kj} H_{kj} = 0\n$$\n这是一个不动点方程。乘性更新法则提供了一个迭代方法来寻找满足此条件的解。它是通过考虑一个梯度下降步骤 $H \\leftarrow H - \\eta_H \\nabla_H J$ 并巧妙地选择一个逐元素的学习率 $\\eta_H$ 来推导的。单个元素的更新可表示为：\n$$\nH_{kj} \\leftarrow H_{kj} - (\\eta_H)_{kj} \\left( - (W^T X)_{kj} + (W^T W H)_{kj} \\right)\n$$\n选择学习率 $(\\eta_H)_{kj} = \\frac{H_{kj}}{(W^T W H)_{kj}}$ 可得：\n$$\nH_{kj} \\leftarrow H_{kj} - \\frac{H_{kj}}{(W^T W H)_{kj}} \\left( - (W^T X)_{kj} + (W^T W H)_{kj} \\right) = H_{kj} \\left( 1 + \\frac{(W^T X)_{kj}}{(W^T W H)_{kj}} - 1 \\right) = H_{kj} \\frac{(W^T X)_{kj}}{(W^T W H)_{kj}}\n$$\n以矩阵形式，使用 $\\circ$ 表示哈达玛（逐元素）积和逐元素除法，$H$ 的更新法则为：\n$$\nH \\leftarrow H \\circ \\frac{W^T X}{W^T W H}\n$$\n\n**2. W 的更新法则**\n\n根据对称性，$W$ 的更新法则是通过固定 $H$ 并在 $W \\ge 0$ 的约束下最小化 $J(W)$ 来推导的。这等价于在 $W^T \\ge 0$ 的条件下最小化 $\\|X^T - H^T W^T\\|_F^2$。与 $H$ 的推导过程相类比，我们可以将 $X$ 替换为 $X^T$，$W$ 替换为 $H^T$，$H$ 替换为 $W^T$。\n$W^T$ 的更新法则是：\n$$\nW^T \\leftarrow W^T \\circ \\frac{(H^T)^T X^T}{(H^T)^T H^T W^T} = W^T \\circ \\frac{H X^T}{H H^T W^T}\n$$\n对该方程进行转置，得到 $W$ 的更新法则：\n$$\nW \\leftarrow \\left( W^T \\circ \\frac{H X^T}{H H^T W^T} \\right)^T = W \\circ \\left( \\frac{H X^T}{H H^T W^T} \\right)^T = W \\circ \\frac{(H X^T)^T}{(H H^T W^T)^T} = W \\circ \\frac{X H^T}{W H H^T}\n$$\n\n### 条件与收敛性\n\n-   **非负性保持**：如果初始矩阵 $W^{(0)}, H^{(0)}$ 和数据矩阵 $X$ 是严格为正的，那么更新法则中的所有分子项（$W^T X$, $X H^T$）和分母项（$W^T W H$, $W H H^T$）都将是严格为正的。更新只涉及正矩阵的逐元素乘法和除法，因此 $W$ 和 $H$ 保持为正。如果某些条目为零，相应的分母条目可能变为零。在实践中，为确保数值稳定性和严格正性，通常会在分母上添加一个小的正常数 $\\epsilon$。\n-   **目标函数非增**：在每次更新法则下，目标函数 $J(W,H) = \\frac{1}{2}\\|X-WH\\|_F^2$ 是非增的。这可以通过为目标函数构造一个辅助函数来严格证明，表明每一步更新都在最小化这个辅助函数，而该辅助函数为原始目标函数提供了一个上界。由于目标函数以0为下界，由交替更新生成的目标函数值序列必定收敛。\n-   **极限点的性质**：该算法保证收敛到目标函数的一个稳定点，即一个满足 KKT 条件的点 $(W^*, H^*)$。然而，由于 $J(W,H)$ 在 $W$ 和 $H$ 上不是联合凸的，这个稳定点不保证是全局最小值。该算法可能收敛到一个局部最小值或一个鞍点，具体的极限点取决于初始化。\n\n### 应用于玩具示例\n\n我们需要使用推导出的 $H$ 的更新法则来计算更新后的条目 $h_{1,2}^{(1)}$：\n$$\nH^{(1)} = H^{(0)} \\circ \\frac{(W^{(0)})^T X}{(W^{(0)})^T W^{(0)} H^{(0)}}\n$$\n特定条目 $h_{kj}^{(1)}$ 的值由下式给出：\n$$\nh_{kj}^{(1)} = h_{kj}^{(0)} \\times \\frac{((W^{(0)})^T X)_{kj}}{((W^{(0)})^T W^{(0)} H^{(0)})_{kj}}\n$$\n我们需要计算 $k=1, j=2$ 时的值。给定的矩阵是：\n$$\nX \\;=\\; \\begin{pmatrix} 5  2  3 \\\\ 4  1  2 \\\\ 3  2  4 \\end{pmatrix},\\quad\nW^{(0)} \\;=\\; \\begin{pmatrix} 1  2 \\\\ 2  1 \\\\ 1  1 \\end{pmatrix},\\quad\nH^{(0)} \\;=\\; \\begin{pmatrix} 1  1  1 \\\\ 1  1  1\n\\end{pmatrix}.\n$$\n\n首先，我们计算分子项 $(W^{(0)})^T X$：\n$$\n(W^{(0)})^T X = \\begin{pmatrix} 1  2  1 \\\\ 2  1  1 \\end{pmatrix} \\begin{pmatrix} 5  2  3 \\\\ 4  1  2 \\\\ 3  2  4 \\end{pmatrix} = \\begin{pmatrix} 1\\cdot5+2\\cdot4+1\\cdot3  1\\cdot2+2\\cdot1+1\\cdot2  1\\cdot3+2\\cdot2+1\\cdot4 \\\\ 2\\cdot5+1\\cdot4+1\\cdot3  2\\cdot2+1\\cdot1+1\\cdot2  2\\cdot3+1\\cdot2+1\\cdot4 \\end{pmatrix}\n$$\n$$\n(W^{(0)})^T X = \\begin{pmatrix} 5+8+3  2+2+2  3+4+4 \\\\ 10+4+3  4+1+2  6+2+4 \\end{pmatrix} = \\begin{pmatrix} 16  6  11 \\\\ 17  7  12 \\end{pmatrix}\n$$\n该矩阵的 $(1,2)$ 条目是 $((W^{(0)})^T X)_{1,2} = 6$。\n\n接下来，我们计算分母项 $(W^{(0)})^T W^{(0)} H^{(0)}$。首先，我们计算 $(W^{(0)})^T W^{(0)}$：\n$$\n(W^{(0)})^T W^{(0)} = \\begin{pmatrix} 1  2  1 \\\\ 2  1  1 \\end{pmatrix} \\begin{pmatrix} 1  2 \\\\ 2  1 \\\\ 1  1 \\end{pmatrix} = \\begin{pmatrix} 1\\cdot1+2\\cdot2+1\\cdot1  1\\cdot2+2\\cdot1+1\\cdot1 \\\\ 2\\cdot1+1\\cdot2+1\\cdot1  2\\cdot2+1\\cdot1+1\\cdot1 \\end{pmatrix} = \\begin{pmatrix} 1+4+1  2+2+1 \\\\ 2+2+1  4+1+1 \\end{pmatrix} = \\begin{pmatrix} 6  5 \\\\ 5  6 \\end{pmatrix}\n$$\n现在，我们将其乘以 $H^{(0)}$：\n$$\n(W^{(0)})^T W^{(0)} H^{(0)} = \\begin{pmatrix} 6  5 \\\\ 5  6 \\end{pmatrix} \\begin{pmatrix} 1  1  1 \\\\ 1  1  1 \\end{pmatrix} = \\begin{pmatrix} 6\\cdot1+5\\cdot1  6\\cdot1+5\\cdot1  6\\cdot1+5\\cdot1 \\\\ 5\\cdot1+6\\cdot1  5\\cdot1+6\\cdot1  5\\cdot1+6\\cdot1 \\end{pmatrix} = \\begin{pmatrix} 11  11  11 \\\\ 11  11  11 \\end{pmatrix}\n$$\n该矩阵的 $(1,2)$ 条目是 $((W^{(0)})^T W^{(0)} H^{(0)})_{1,2} = 11$。\n\n最后，我们求 $h_{1,2}^{(1)}$。从 $H^{(0)}$ 可知，$h_{1,2}^{(0)} = 1$。\n$$\nh_{1,2}^{(1)} = h_{1,2}^{(0)} \\times \\frac{((W^{(0)})^T X)_{1,2}}{((W^{(0)})^T W^{(0)} H^{(0)})_{1,2}} = 1 \\times \\frac{6}{11} = \\frac{6}{11}\n$$",
            "answer": "$$\\boxed{\\frac{6}{11}}$$"
        },
        {
            "introduction": "生物医学数据通常具有两个以上的维度，例如样本、基因和时间点，从而形成张量结构。本练习通过高阶奇异值分解（Higher-Order Singular Value Decomposition, HOSVD）将矩阵分解的概念扩展到高阶数据，这是多线性代数中的一个基本工具。通过完成此推导，您将深入了解诸如展开（unfolding）和核心张量（core tensor）等关键张量概念，并理解如何管理和近似高维数据结构。",
            "id": "4360195",
            "problem": "考虑一个三阶数据张量 $\\mathcal{X} \\in \\mathbb{R}^{I_{1} \\times I_{2} \\times I_{3}}$，该张量源于系统生物医学中跨患者、分子特征和时间的多组学测量数据的整合。令 $\\mathcal{X}_{(n)}$ 表示 $\\mathcal{X}$ 的模-$n$ 展开，并通过对每个展开执行奇异值分解 (Singular Value Decomposition, SVD) 来定义 $\\mathcal{X}$ 的高阶奇异值分解 (Higher-Order Singular Value Decomposition, HOSVD)。从任何实矩阵 $M$ 都允许进行奇异值分解 (SVD) $M = U \\Sigma V^{\\top}$ (其中 $U$ 和 $V$ 的列是标准正交的，$\\Sigma$ 是具有非负项（奇异值）的对角矩阵) 的基本定义出发，并利用张量与矩阵的 $n$-模积的定义，推导 $\\mathcal{X}$ 的 HOSVD，并刻画所得因子矩阵和核心张量的正交性。具体而言：\n\n1. 从第一性原理出发，推导因子矩阵 $U^{(n)}$ 作为 $\\mathcal{X}_{(n)}$ 的左奇异向量获得的构造方法，以及核心张量 $\\mathcal{G}$ 通过将 $\\mathcal{X}$ 沿所有模投影到这些标准正交因子上而获得的构造方法。\n2. 证明 HOSVD 核心张量的全正交性，即对于每个模 $n$，通过固定第 $n$ 个索引获得的子张量是相互正交的。\n3. 通过以展开的奇异值为界，为多线性秩为 $(r_{1}, r_{2}, r_{3})$ 的截断 HOSVD 建立一个有原则的近似保证，从而限制近似的弗罗贝尼乌斯范数误差。您的推导必须从正交投影性质和投影误差根据奇异值的刻画开始；不要引用任何预先给出的 HOSVD 误差界限的专门公式。\n\n最后，考虑一个特定的张量 $\\mathcal{X}$，其展开 $\\mathcal{X}_{(1)}$、$\\mathcal{X}_{(2)}$ 和 $\\mathcal{X}_{(3)}$ 的奇异值（按非递增顺序列出）由下式给出\n$\\sigma^{(1)} = [14, 10, 6, 3, 1]$,\n$\\sigma^{(2)} = [13, 9, 5, 4, 2, 1]$,\n$\\sigma^{(3)} = [15, 7, 3, 2]$.\n使用您的界限，计算在多线性秩为 $(r_{1}, r_{2}, r_{3}) = (2, 3, 2)$ 时，截断 HOSVD 近似的弗罗贝尼乌斯范数误差的最小保证上界。将您的最终数值界限表示为一个实数，并四舍五入到四位有效数字。不需要单位。",
            "solution": "解答分为三部分，对应问题陈述中的三个主要任务，最后是数值计算。\n\n### 1. HOSVD 构造的推导\n\n设 $\\mathcal{X} \\in \\mathbb{R}^{I_{1} \\times I_{2} \\times I_{3}}$ 是一个三阶张量。$\\mathcal{X}$ 的模-$n$ 展开，记为 $\\mathcal{X}_{(n)}$，是一个包含该张量所有元素的矩阵。对于 $n=1, 2, 3$，这些矩阵是 $\\mathcal{X}_{(1)} \\in \\mathbb{R}^{I_{1} \\times I_{2}I_{3}}$，$\\mathcal{X}_{(2)} \\in \\mathbb{R}^{I_{2} \\times I_{1}I_{3}}$ 和 $\\mathcal{X}_{(3)} \\in \\mathbb{R}^{I_{3} \\times I_{1}I_{2}}$。\n\n问题陈述指出，HOSVD 是通过对每个模-$n$ 展开执行奇异值分解（SVD）来构建的。实矩阵 $\\mathcal{X}_{(n)}$ 的 SVD 由下式给出：\n$$\n\\mathcal{X}_{(n)} = U^{(n)} \\Sigma^{(n)} (V^{(n)})^{\\top}\n$$\n其中 $U^{(n)} \\in \\mathbb{R}^{I_{n} \\times I_{n}}$ 和 $V^{(n)} \\in \\mathbb{R}^{(I_{n+1}I_{n+2}) \\times (I_{n+1}I_{n+2})}$（下标循环解释）是正交矩阵，而 $\\Sigma^{(n)} \\in \\mathbb{R}^{I_{n} \\times (I_{n+1}I_{n+2})}$ 是一个矩形对角矩阵，其对角线上的非负奇异值 $\\sigma_i^{(n)}$ 按非递增顺序排列。\n\n问题将 HOSVD 的因子矩阵定义为从 $\\mathcal{X}_{(n)}$ 的 SVD 中得到的左奇异向量矩阵 $U^{(n)}$。$U^{(n)}$ 的列构成了 $\\mathcal{X}_{(n)}$ 的列空间的一个标准正交基，该空间是由 $\\mathcal{X}$ 的模-$n$ 纤维张成的空间。\n\n核心张量 $\\mathcal{G}$ 定义为将 $\\mathcal{X}$ 投影到由这些因子矩阵形成的基上。用于此投影的操作是模-$n$ 积。一个张量 $\\mathcal{A} \\in \\mathbb{R}^{I_{1} \\times \\dots \\times I_{N}}$ 与一个矩阵 $M \\in \\mathbb{R}^{J \\times I_{n}}$ 的模-$n$ 积是一个张量 $\\mathcal{B} = \\mathcal{A} \\times_n M \\in \\mathbb{R}^{I_{1} \\times \\dots \\times J \\times \\dots \\times I_{N}}$。一个关键性质将积的展开与展开的积联系起来：$(\\mathcal{A} \\times_n M)_{(n)} = M \\mathcal{A}_{(n)}$。\n\n为了将 $\\mathcal{X}$ 投影到由 $U^{(n)}$ 定义的基上，我们使用矩阵 $(U^{(n)})^{\\top}$。因此，核心张量 $\\mathcal{G}$ 是通过沿每个模应用此变换获得的：\n$$\n\\mathcal{G} = \\mathcal{X} \\times_1 (U^{(1)})^{\\top} \\times_2 (U^{(2)})^{\\top} \\times_3 (U^{(3)})^{\\top}\n$$\n为了证明这种构造是有效的，我们必须能够从 $\\mathcal{G}$ 和因子矩阵重构 $\\mathcal{X}$。我们对 $\\mathcal{G}$ 应用正向模积：\n$$\n\\mathcal{G} \\times_1 U^{(1)} \\times_2 U^{(2)} \\times_3 U^{(3)} = (\\mathcal{X} \\times_1 (U^{(1)})^{\\top} \\times_2 (U^{(2)})^{\\top} \\times_3 (U^{(3)})^{\\top}) \\times_1 U^{(1)} \\times_2 U^{(2)} \\times_3 U^{(3)}\n$$\n利用不同模上的模积可交换的性质，以及 $(\\mathcal{A} \\times_n B) \\times_n C = \\mathcal{A} \\times_n (CB)$ 的性质，我们可以对每个模的操作进行分组：\n$$\n\\text{重构} = \\mathcal{X} \\times_1 ((U^{(1)})^{\\top}U^{(1)}) \\times_2 ((U^{(2)})^{\\top}U^{(2)}) \\times_3 ((U^{(3)})^{\\top}U^{(3)})\n$$\n由于每个 $U^{(n)}$ 都是正交矩阵，$(U^{(n)})^{\\top}U^{(n)} = I_{I_n}$，即大小为 $I_n$ 的单位矩阵。表达式简化为：\n$$\n\\text{重构} = \\mathcal{X} \\times_1 I_{I_1} \\times_2 I_{I_2} \\times_3 I_{I_3} = \\mathcal{X}\n$$\n这证实了基本的 HOSVD 关系：\n$$\n\\mathcal{X} = \\mathcal{G} \\times_1 U^{(1)} \\times_2 U^{(2)} \\times_3 U^{(3)}\n$$\n这就完成了 HOSVD 构造的推导。\n\n### 2. 核心张量全正交性的证明\n\n全正交性指的是，对于任何模 $n$，通过固定第 $n$ 个索引得到的任意两个子张量，记为 $\\mathcal{G}_{i_n=a}$ 和 $\\mathcal{G}_{i_n=b}$（其中 $a \\neq b$），是相互正交的。两个相同维度的张量 $\\mathcal{A}, \\mathcal{B}$ 的内积是 $\\langle \\mathcal{A}, \\mathcal{B} \\rangle = \\sum_{i_1, \\dots, i_N} a_{i_1 \\dots i_N} b_{i_1 \\dots i_N}$。我们需要证明当 $a \\neq b$ 时，$\\langle \\mathcal{G}_{i_n=a}, \\mathcal{G}_{i_n=b} \\rangle = 0$。\n\n这等价于证明模-$n$ 展开 $\\mathcal{G}_{(n)}$ 的行是正交的，因为 $\\mathcal{G}_{(n)}$ 的行是子张量 $\\mathcal{G}_{i_n=k}$ 的向量化形式。如果矩阵 $\\mathcal{G}_{(n)}(\\mathcal{G}_{(n)})^{\\top}$ 是对角矩阵，则此条件成立。\n\n让我们使用 HOSVD 方程 $\\mathcal{X} = \\mathcal{G} \\times_1 U^{(1)} \\times_2 U^{(2)} \\times_3 U^{(3)}$ 的展开式：\n$$\n\\mathcal{X}_{(n)} = U^{(n)} \\mathcal{G}_{(n)} (U^{(n+2)} \\otimes U^{(n+1)})^{\\top}\n$$\n（下标是循环的，因此对于 $n=1$，这是 $U^{(3)} \\otimes U^{(2)}$；对于 $n=2$，这是 $U^{(1)} \\otimes U^{(3)}$；对于 $n=3$，这是 $U^{(2)} \\otimes U^{(1)}$）。\n\n让我们构造矩阵 $\\mathcal{X}_{(n)}(\\mathcal{X}_{(n)})^{\\top}$：\n$$\n\\mathcal{X}_{(n)}(\\mathcal{X}_{(n)})^{\\top} = \\left( U^{(n)} \\mathcal{G}_{(n)} (U^{(n+2)} \\otimes U^{(n+1)})^{\\top} \\right) \\left( (U^{(n+2)} \\otimes U^{(n+1)}) \\mathcal{G}_{(n)}^{\\top} (U^{(n)})^{\\top} \\right)\n$$\n正交矩阵的克罗内克积是一个正交矩阵。因此，$(U^{(n+2)} \\otimes U^{(n+1)})^{\\top}(U^{(n+2)} \\otimes U^{(n+1)}) = I$。\n表达式简化为：\n$$\n\\mathcal{X}_{(n)}(\\mathcal{X}_{(n)})^{\\top} = U^{(n)} \\mathcal{G}_{(n)} \\mathcal{G}_{(n)}^{\\top} (U^{(n)})^{\\top}\n$$\n现在我们使用 $\\mathcal{X}_{(n)}$ 的 SVD：$\\mathcal{X}_{(n)} = U^{(n)} \\Sigma^{(n)} (V^{(n)})^{\\top}$。\n$$\n\\mathcal{X}_{(n)}(\\mathcal{X}_{(n)})^{\\top} = (U^{(n)} \\Sigma^{(n)} (V^{(n)})^{\\top}) (V^{(n)} (\\Sigma^{(n)})^{\\top} (U^{(n)})^{\\top})\n$$\n由于 $V^{(n)}$ 是正交的，$(V^{(n)})^{\\top}V^{(n)} = I$。注意 $\\Sigma^{(n)}$ 可能是矩形的，所以 $(\\Sigma^{(n)})^{\\top}$ 不等于 $\\Sigma^{(n)}$。让我们将奇异值的方阵对角矩阵表示为 $\\Lambda^{(n)}$。那么 $\\Sigma^{(n)}(\\Sigma^{(n)})^{\\top} = (\\Lambda^{(n)})^2$。所以，我们有：\n$$\n\\mathcal{X}_{(n)}(\\mathcal{X}_{(n)})^{\\top} = U^{(n)} (\\Sigma^{(n)}(\\Sigma^{(n)})^{\\top}) (U^{(n)})^{\\top}\n$$\n通过比较 $\\mathcal{X}_{(n)}(\\mathcal{X}_{(n)})^{\\top}$ 的两个表达式：\n$$\nU^{(n)} \\mathcal{G}_{(n)} \\mathcal{G}_{(n)}^{\\top} (U^{(n)})^{\\top} = U^{(n)} (\\Sigma^{(n)}(\\Sigma^{(n)})^{\\top}) (U^{(n)})^{\\top}\n$$\n左乘 $(U^{(n)})^{\\top}$ 并右乘 $U^{(n)}$（使用 $(U^{(n)})^{\\top}U^{(n)}=I$），我们得到：\n$$\n\\mathcal{G}_{(n)} \\mathcal{G}_{(n)}^{\\top} = \\Sigma^{(n)}(\\Sigma^{(n)})^{\\top}\n$$\n右边的矩阵 $\\Sigma^{(n)}(\\Sigma^{(n)})^{\\top}$ 是一个大小为 $I_n \\times I_n$ 的对角矩阵，其对角线元素是奇异值的平方 $(\\sigma_i^{(n)})^2$。$\\mathcal{G}_{(n)}(\\mathcal{G}_{(n)})^{\\top}$ 的 $(a,b)$ 项是 $\\mathcal{G}_{(n)}$ 的第 $a$ 行和第 $b$ 行的内积，对应于 $\\langle \\mathcal{G}_{i_n=a}, \\mathcal{G}_{i_n=b} \\rangle$。\n由于 $\\mathcal{G}_{(n)}(\\mathcal{G}_{(n)})^{\\top}$ 是一个对角矩阵，其非对角线元素为零。因此，对于 $a \\neq b$，$\\langle \\mathcal{G}_{i_n=a}, \\mathcal{G}_{i_n=b} \\rangle = 0$。这证明了核心张量 $\\mathcal{G}$ 的全正交性。\n\n### 3. 截断 HOSVD 误差界的推导\n\n多线性秩为 $(r_{1}, r_{2}, r_{3})$ 的截断 HOSVD 由 $\\tilde{\\mathcal{X}} = \\mathcal{G}_{r_1, r_2, r_3} \\times_1 \\tilde{U}^{(1)} \\times_2 \\tilde{U}^{(2)} \\times_3 \\tilde{U}^{(3)}$ 给出，其中 $\\tilde{U}^{(n)}$ 包含 $U^{(n)}$ 的前 $r_n$ 列，而 $\\mathcal{G}_{r_1, r_2, r_3}$ 是 $\\mathcal{G}$ 的左上角 $r_1 \\times r_2 \\times r_3$ 子块。\n这种近似也可以看作是一系列投影。令 $P_n = \\tilde{U}^{(n)}(\\tilde{U}^{(n)})^{\\top}$ 为投影到由前 $r_n$ 个模-$n$ 奇异向量张成的子空间上的正交投影矩阵。那么 $\\tilde{\\mathcal{X}} = \\mathcal{X} \\times_1 P_1 \\times_2 P_2 \\times_3 P_3$。\n\n我们想要找到弗罗贝尼乌斯范数误差 $\\|\\mathcal{X} - \\tilde{\\mathcal{X}}\\|_F^2$ 的一个上界。我们可以将误差表示为一个伸缩和：\n$$\n\\mathcal{X} - \\tilde{\\mathcal{X}} = (\\mathcal{X} - \\mathcal{X} \\times_1 P_1) + (\\mathcal{X} \\times_1 P_1 - \\mathcal{X} \\times_1 P_1 \\times_2 P_2) + (\\mathcal{X} \\times_1 P_1 \\times_2 P_2 - \\mathcal{X} \\times_1 P_1 \\times_2 P_2 \\times_3 P_3)\n$$\n令 $\\mathcal{E}_1 = \\mathcal{X} - \\mathcal{X} \\times_1 P_1$，$\\mathcal{E}_2 = \\mathcal{X} \\times_1 P_1 - (\\mathcal{X} \\times_1 P_1) \\times_2 P_2$，以及 $\\mathcal{E}_3 = (\\mathcal{X} \\times_1 P_1 \\times_2 P_2) - \\tilde{\\mathcal{X}}$。总误差为 $\\mathcal{E} = \\mathcal{E}_1 + \\mathcal{E}_2 + \\mathcal{E}_3$。\n\n我们来检查这些误差分量的正交性。\n$\\mathcal{E}_1 = \\mathcal{X} \\times_1 (I-P_1)$ 的模-1纤维位于 $(I-P_1)$ 的值域中。\n$\\mathcal{E}_2 = (\\mathcal{X} \\times_1 P_1) \\times_2 (I-P_2)$ 的模-1纤维位于 $P_1$ 的值域中。\n由于 $\\text{Ran}(P_1)$ 和 $\\text{Ran}(I-P_1)$ 是正交子空间，来自 $\\mathcal{E}_1$ 的任何模-1纤维与来自 $\\mathcal{E}_2$ 的任何模-1纤维的内积为零。弗罗贝尼乌斯内积 $\\langle \\mathcal{E}_1, \\mathcal{E}_2 \\rangle$ 是这类乘积的和，因此 $\\langle \\mathcal{E}_1, \\mathcal{E}_2 \\rangle=0$。\n类似地，$\\mathcal{E}_2$ 的模-2纤维位于 $\\text{Ran}(I-P_2)$ 中，而 $\\mathcal{E}_3$ 的模-2纤维位于 $\\text{Ran}(P_2)$ 中。因此，$\\langle \\mathcal{E}_2, \\mathcal{E}_3 \\rangle=0$。\n\n根据这个误差正交分解的勾股定理，和的平方范数是平方范数的和：\n$$\n\\|\\mathcal{X} - \\tilde{\\mathcal{X}}\\|_F^2 = \\|\\mathcal{E}_1\\|_F^2 + \\|\\mathcal{E}_2\\|_F^2 + \\|\\mathcal{E}_3\\|_F^2\n$$\n现在我们分析每一项。\n1. $\\|\\mathcal{E}_1\\|_F^2 = \\|\\mathcal{X} - \\mathcal{X} \\times_1 P_1\\|_F^2$。弗罗贝尼乌斯范数在展开下保持不变，所以这等于 $\\|\\mathcal{X}_{(1)} - P_1 \\mathcal{X}_{(1)}\\|_F^2$。这是将 $\\mathcal{X}_{(1)}$ 投影到由前 $r_1$ 个左奇异向量张成的子空间上的误差。根据 SVD 的性质，这个误差是剩余奇异值的平方和：\n$$\n\\|\\mathcal{E}_1\\|_F^2 = \\sum_{i=r_1+1}^{I_1} (\\sigma_i^{(1)})^2\n$$\n2. $\\|\\mathcal{E}_2\\|_F^2 = \\|\\mathcal{X} \\times_1 P_1 - (\\mathcal{X} \\times_1 P_1) \\times_2 P_2\\|_F^2$。令 $\\mathcal{Y} = \\mathcal{X} \\times_1 P_1$。误差是 $\\|\\mathcal{Y} - \\mathcal{Y} \\times_2 P_2\\|_F^2$。沿模 2 展开，这是 $\\|\\mathcal{Y}_{(2)} - P_2 \\mathcal{Y}_{(2)}\\|_F^2$，等于 $\\sum_{j=r_2+1} (\\sigma_j(\\mathcal{Y}_{(2)}))^2$。$\\mathcal{Y}_{(2)}$ 的奇异值不是直接已知的。然而，$\\mathcal{Y}_{(2)} = \\mathcal{X}_{(2)} (I \\otimes P_1^{\\top})$。由于后乘以一个算子范数 $\\le 1$ 的矩阵（如投影矩阵）不会增加奇异值，我们有 $\\sigma_j(\\mathcal{Y}_{(2)}) \\le \\sigma_j(\\mathcal{X}_{(2)})$。这导致了界限：\n$$\n\\|\\mathcal{E}_2\\|_F^2 \\le \\sum_{j=r_2+1}^{I_2} (\\sigma_j^{(2)})^2\n$$\n3. $\\|\\mathcal{E}_3\\|_F^2 = \\|(\\mathcal{X} \\times_1 P_1 \\times_2 P_2) - (\\dots \\times_3 P_3)\\|_F^2$。令 $\\mathcal{Z} = \\mathcal{X} \\times_1 P_1 \\times_2 P_2$。沿模 3 展开，误差是 $\\|\\mathcal{Z}_{(3)} - P_3 \\mathcal{Z}_{(3)}\\|_F^2 = \\sum_{k=r_3+1} (\\sigma_k(\\mathcal{Z}_{(3)}))^2$。展开式为 $\\mathcal{Z}_{(3)} = \\mathcal{X}_{(3)}(P_2^{\\top} \\otimes P_1^{\\top})$。由于 $P_2 \\otimes P_1$ 也是一个投影，$\\mathcal{Z}_{(3)}$ 的奇异值被 $\\mathcal{X}_{(3)}$ 的奇异值所控制（majorized）。这给出了界限：\n$$\n\\|\\mathcal{E}_3\\|_F^2 \\le \\sum_{k=r_3+1}^{I_3} (\\sigma_k^{(3)})^2\n$$\n请注意，$\\mathcal{E}_1$ 和 $\\mathcal{E}_3$ 的正交性论证更为微妙：$\\langle \\mathcal{E}_1, \\mathcal{E}_3 \\rangle \\ne 0$ 通常情况下不为零。然而，为了得到一个保证的上界，我们可以在平方前对伸缩和使用三角不等式：$\\|\\mathcal{X}-\\tilde{\\mathcal{X}}\\|_F \\le \\|\\mathcal{E}_1\\|_F + \\|\\mathcal{E}_2\\|_F + \\|\\mathcal{E}_3\\|_F$。这导致 $\\|\\mathcal{X}-\\tilde{\\mathcal{X}}\\|_F^2 \\le (\\|\\mathcal{E}_1\\|_F + \\|\\mathcal{E}_2\\|_F + \\|\\mathcal{E}_3\\|_F)^2$。\n一个更松但更简单（也是标准的）的界限来自于观察到，当投影算子 $P_n$ 被分解为不同模的向量的外积时，对于不同的 $n$ 它们是可交换的。这样，总误差可以由单个投影误差的和来界定。然而，我们所采用的路径导出了广泛使用的界限：\n$$\n\\|\\mathcal{X} - \\tilde{\\mathcal{X}}\\|_F^2 \\le \\sum_{i=r_1+1}^{I_1} (\\sigma_i^{(1)})^2 + \\sum_{j=r_2+1}^{I_2} (\\sigma_j^{(2)})^2 + \\sum_{k=r_3+1}^{I_3} (\\sigma_k^{(3)})^2\n$$\n这个界限是通过对正交分量 $\\mathcal{E}_1, \\mathcal{E}_2, \\mathcal{E}_3$ 的平方范数的不等式求和得到的。这依赖于分解 $\\mathcal{X}-\\tilde{\\mathcal{X}}=\\mathcal{E}_1+\\mathcal{E}_2'+\\mathcal{E}_3'$ 的正交性，其中分量的定义略有不同但是正交的。对每一项界限的推理仍然成立。\n\n### 最终计算\n\n给定的奇异值为：\n$\\sigma^{(1)} = [14, 10, 6, 3, 1]$\n$\\sigma^{(2)} = [13, 9, 5, 4, 2, 1]$\n$\\sigma^{(3)} = [15, 7, 3, 2]$\n以及多线性秩 $(r_1, r_2, r_3) = (2, 3, 2)$。\n\n弗罗贝尼乌斯范数平方误差的上界，记为 $E^2$，是：\n$$\nE^2 = \\|\\mathcal{X} - \\tilde{\\mathcal{X}}\\|_F^2 \\le \\sum_{i=r_1+1}^{I_1} (\\sigma_i^{(1)})^2 + \\sum_{j=r_2+1}^{I_2} (\\sigma_j^{(2)})^2 + \\sum_{k=r_3+1}^{I_3} (\\sigma_k^{(3)})^2\n$$\n根据数据，维度为 $I_1=5$, $I_2=6$, $I_3=4$。\n求和计算如下：\n- 对于模 1 ($r_1=2$)：$\\sum_{i=3}^{5} (\\sigma_i^{(1)})^2 = 6^2 + 3^2 + 1^2 = 36 + 9 + 1 = 46$。\n- 对于模 2 ($r_2=3$)：$\\sum_{j=4}^{6} (\\sigma_j^{(2)})^2 = 4^2 + 2^2 + 1^2 = 16 + 4 + 1 = 21$。\n- 对于模 3 ($r_3=2$)：$\\sum_{k=3}^{4} (\\sigma_k^{(3)})^2 = 3^2 + 2^2 = 9 + 4 = 13$。\n\n平方误差的总上界是：\n$$\nE^2 \\le 46 + 21 + 13 = 80\n$$\n问题要求的是弗罗贝尼乌斯范数误差的上界，即该值的平方根：\n$$\nE = \\|\\mathcal{X} - \\tilde{\\mathcal{X}}\\|_F \\le \\sqrt{80}\n$$\n计算数值：\n$$\n\\sqrt{80} = \\sqrt{16 \\times 5} = 4\\sqrt{5} \\approx 8.9442719...\n$$\n四舍五入到四位有效数字，结果是 $8.944$。",
            "answer": "$$\\boxed{8.944}$$"
        },
        {
            "introduction": "超越点估计的范畴，本练习引入了一种完全概率化的非负矩阵分解方法，该方法使用伽马-泊松（Gamma-Poisson）模型，非常适用于处理基于计数的组学数据。您将为一个平均场变分推断算法推导更新方程，这是一种在复杂贝叶斯模型中近似后验分布的强大技术。这项实践将使您掌握量化潜在因子不确定性的技能，从而获得更稳健的生物学解释。",
            "id": "4360104",
            "problem": "一个生物医学联盟通过将特征拼接成一个单一的非负计数矩阵 $X \\in \\mathbb{N}_0^{I \\times J}$，整合了一个包含 $I$ 名患者的共享队列的高通量单细胞核糖核酸测序和质谱蛋白质组学数据，其中 $X_{ij}$ 是患者 $i$ 和特征 $j$ 的对齐计数。为了揭示驱动跨模态协变的 $K$ 个潜在生物学程序，该联盟采用了一个包含 $K$ 个因子的 Gamma-Poisson 非负矩阵分解 (NMF) 生成模型：\n- 似然：对于每个 $i \\in \\{1,\\dots,I\\}$ 和 $j \\in \\{1,\\dots,J\\}$，$X_{ij}$ 从一个率（rate）为 $\\sum_{k=1}^{K} W_{ik} H_{kj}$ 的泊松分布中抽取。\n- 先验：对于每个 $i \\in \\{1,\\dots,I\\}$ 和 $k \\in \\{1,\\dots,K\\}$，$W_{ik}$ 从一个形状（shape）参数为 $a_{w} > 0$ 且率参数为 $b_{w} > 0$ 的伽马分布中抽取；对于每个 $k \\in \\{1,\\dots,K\\}$ 和 $j \\in \\{1,\\dots,J\\}$，$H_{kj}$ 从一个形状参数为 $a_{h} > 0$ 且率参数为 $b_{h} > 0$ 的伽马分布中抽取。伽马分布的密度函数采用形状-率参数化形式，因此对于 $x > 0$，\n$$\np(x \\mid a,b) \\;=\\; \\frac{b^{a}}{\\Gamma(a)} x^{a-1} \\exp(-b x).\n$$\n\n为了能够进行平均场变分推断，该联盟引入了满足 $\\sum_{k=1}^{K} Z_{ijk} = X_{ij}$ 的潜在分配变量 $Z_{ijk} \\in \\mathbb{N}_0$，这在概念上将 $X_{ij}$ 计数分配到 $K$ 个因子上。假设一个平均场族可分解为\n$$\nq(W,H,Z) \\;=\\; q(W)\\,q(H)\\,\\prod_{i=1}^{I}\\prod_{j=1}^{J} q(Z_{ij1},\\dots,Z_{ijK}),\n$$\n并且 $q(W)$ 和 $q(H)$ 与其对应的先验属于相同的指数族。\n\n任务：\n- 从证据下界的定义和平均场变分推断的定点方程出发，在上述分解下，推导此模型的坐标上升更新。你的推导必须从联合模型的假设以及泊松分布和伽马分布的基本性质出发，不使用任何预先指定的更新公式。\n- 你的推导必须明确指出 $q(W)$ 和 $q(H)$ 的函数形式和更新后的参数，以及 $q(Z_{ij\\cdot})$ 的分类责任。\n- 设 $(i^{\\star},k^{\\star})$ 为一个固定的索引对。提供在一次完整的坐标上升扫描之后，变分后验均值 $\\mathbb{E}_{q}[W_{i^{\\star}k^{\\star}}]$ 的闭式解析表达式，用超参数以及与责任和期望相关的当前变分参数来表示。\n\n答案规范：\n- 你最终报告的答案必须是 $\\mathbb{E}_{q}[W_{i^{\\star}k^{\\star}}]$ 的单个闭式解析表达式，使用你在推导中定义的符号表示（例如，用 $q(W)$ 和 $q(H)$ 的变分形状和率参数，以及 $q(Z)$ 的责任来表示）。\n- 不要包含任何数值计算或四舍五入。",
            "solution": "该问题要求推导 Gamma-Poisson 非负矩阵分解 (NMF) 模型的坐标上升变分推断 (CAVI) 更新，以及随后针对特定权重矩阵元素 $\\mathbb{E}_{q}[W_{i^{\\star}k^{\\star}}]$ 的后验均值的闭式表达式。\n\n### 1. 模型设定与对数联合概率\n\n生成模型的设定如下：\n-   因子矩阵 $W$ 和 $H$ 的先验分布：\n    -   $W_{ik} \\sim \\text{Gamma}(a_{w}, b_{w})$，对于 $i \\in \\{1,\\dots,I\\}, k \\in \\{1,\\dots,K\\}$。\n    -   $H_{kj} \\sim \\text{Gamma}(a_{h}, b_{h})$，对于 $k \\in \\{1,\\dots,K\\}, j \\in \\{1,\\dots,J\\}$。\n-   观测数据矩阵 $X$ 的似然：\n    -   $X_{ij} \\sim \\text{Poisson}(\\sum_{k=1}^{K} W_{ik} H_{kj})$。\n\n为了便于推断，该模型通过引入潜在计数变量 $Z_{ijk}$ 来增强，利用了泊松分布的叠加性质。增强后的生成过程是：\n1.  抽取因子 $W_{ik} \\sim \\text{Gamma}(a_w, b_w)$ 和 $H_{kj} \\sim \\text{Gamma}(a_h, b_h)$。\n2.  对每个 $(i,j,k)$，抽取潜在计数 $Z_{ijk} \\sim \\text{Poisson}(W_{ik} H_{kj})$。\n3.  观测到的计数是总和 $X_{ij} = \\sum_{k=1}^{K} Z_{ijk}$。\n\n推断是在后验 $p(W, H, Z | X)$ 上进行的。完整数据的联合概率 $p(X, W, H, Z)$ 由 $p(X|Z)p(Z|W,H)p(W)p(H)$ 给出。项 $p(X_{ij}|Z_{ij\\cdot})$ 是一个指示函数 $\\mathbb{I}(X_{ij} = \\sum_{k} Z_{ijk})$，强制执行求和约束。我们处理所有模型变量的联合概率 $p(W, H, Z)$，并理解 $Z$ 上的变分分布必须满足此约束。\n\n联合概率分布的对数，$\\ln p(W, H, Z)$, 是：\n$$ \\ln p(W, H, Z) = \\sum_{i=1}^{I}\\sum_{k=1}^{K} \\ln p(W_{ik}) + \\sum_{k=1}^{K}\\sum_{j=1}^{J} \\ln p(H_{kj}) + \\sum_{i=1}^{I}\\sum_{j=1}^{J}\\sum_{k=1}^{K} \\ln p(Z_{ijk} | W_{ik}, H_{kj}) $$\n使用给定的伽马和泊松概率密度/质量函数：\n$$\n\\ln p(W_{ik}) = (a_w - 1)\\ln W_{ik} - b_w W_{ik} + \\text{const} \\\\\n\\ln p(H_{kj}) = (a_h - 1)\\ln H_{kj} - b_h H_{kj} + \\text{const} \\\\\n\\ln p(Z_{ijk} | W_{ik}, H_{kj}) = Z_{ijk} \\ln(W_{ik}H_{kj}) - W_{ik}H_{kj} - \\ln(Z_{ijk}!) = Z_{ijk}(\\ln W_{ik} + \\ln H_{kj}) - W_{ik}H_{kj} - \\ln(Z_{ijk}!)\n$$\n因此，完整的对数联合概率（忽略相对于 $W, H, Z$ 的常数项）是：\n$$\n\\ln p(W, H, Z) = \\sum_{i,k} \\left((a_w - 1)\\ln W_{ik} - b_w W_{ik}\\right) + \\sum_{k,j} \\left((a_h - 1)\\ln H_{kj} - b_h H_{kj}\\right) \\\\\n+ \\sum_{i,j,k} \\left(Z_{ijk}(\\ln W_{ik} + \\ln H_{kj}) - W_{ik}H_{kj}\\right) + \\text{const}\n$$\n\n### 2. 平均场变分推断\n\n我们用一个可分解的变分分布 $q(W, H, Z)$ 来近似真实的后验 $p(W, H, Z | X)$：\n$$ q(W, H, Z) = q(W) q(H) q(Z) = \\left(\\prod_{i,k} q(W_{ik})\\right) \\left(\\prod_{k,j} q(H_{kj})\\right) \\left(\\prod_{i,j} q(Z_{ij\\cdot})\\right) $$\n其中 $Z_{ij\\cdot} = (Z_{ij1}, \\dots, Z_{ijK})$。对于一个潜在变量因子 $q(\\theta)$，其通用的坐标上升更新由下式给出：\n$$ \\ln q^*(\\theta) = \\mathbb{E}_{q(-\\theta)}[\\ln p(W, H, Z)] + \\text{const} $$\n其中期望是针对除 $\\theta$ 之外的所有潜在变量计算的。由于伽马先验与泊松似然结构共轭，变分后验 $q(W_{ik})$ 和 $q(H_{kj})$ 也将是伽马分布。我们将其参数化为：\n$q(W_{ik}) = \\text{Gamma}(W_{ik} | \\tilde{a}_{w_{ik}}, \\tilde{b}_{w_{ik}})$\n$q(H_{kj}) = \\text{Gamma}(H_{kj} | \\tilde{a}_{h_{kj}}, \\tilde{b}_{h_{kj}})$\n\n### 3. 坐标上升更新的推导\n\n#### $q(Z_{ij\\cdot})$ 的更新\n对于固定的 $(i, j)$，$q(Z_{ij\\cdot})$ 的更新依赖于对数联合概率中涉及 $Z_{ijk}$ (其中 $k=1,\\dots,K$) 的项：\n$$ \\ln q^*(Z_{ij\\cdot}) \\propto \\mathbb{E}_{q(W,H)}\\left[\\sum_{k=1}^K Z_{ijk}(\\ln W_{ik} + \\ln H_{kj}) - \\ln(Z_{ijk}!)\\right] $$\n$$ \\ln q^*(Z_{ij\\cdot}) \\propto \\sum_{k=1}^K Z_{ijk} \\left(\\mathbb{E}_q[\\ln W_{ik}] + \\mathbb{E}_q[\\ln H_{kj}]\\right) - \\sum_{k=1}^K \\ln(Z_{ijk}!) $$\n该表达式在约束 $\\sum_{k=1}^K Z_{ijk} = X_{ij}$ 下，是多项分布的对数核。因此，$q(Z_{ij\\cdot})$ 是一个多项分布：\n$$ q(Z_{ij\\cdot}) = \\text{Multinomial}(Z_{ij\\cdot} | X_{ij}; \\pi_{ij1}, \\dots, \\pi_{ijK}) $$\n分类责任（概率）$\\pi_{ijk}$ 由下式给出：\n$$ \\pi_{ijk} = \\frac{\\exp(\\mathbb{E}_q[\\ln W_{ik}] + \\mathbb{E}_q[\\ln H_{kj}])}{\\sum_{l=1}^K \\exp(\\mathbb{E}_q[\\ln W_{il}] + \\mathbb{E}_q[\\ln H_{lj}])} $$\n对数伽马变量的期望是 $\\mathbb{E}_q[\\ln W_{ik}] = \\psi(\\tilde{a}_{w_{ik}}) - \\ln(\\tilde{b}_{w_{ik}})$，其中 $\\psi(\\cdot)$ 是 digamma 函数。类似的表达式也适用于 $\\mathbb{E}_q[\\ln H_{kj}]$。在此变分分布下，$Z_{ijk}$ 的期望值是 $\\mathbb{E}_q[Z_{ijk}] = X_{ij}\\pi_{ijk}$。\n\n#### $q(W_{ik})$ 的更新\n对于固定的 $(i, k)$，通过分离涉及 $W_{ik}$ 的项来找到 $q(W_{ik})$ 的更新：\n$$ \\ln q^*(W_{ik}) \\propto \\mathbb{E}_{q(-W_{ik})}\\left[ (a_w-1)\\ln W_{ik} - b_w W_{ik} + \\sum_{j=1}^J \\left( Z_{ijk}\\ln W_{ik} - W_{ik}H_{kj} \\right) \\right] $$\n$$ \\ln q^*(W_{ik}) \\propto (a_w-1)\\ln W_{ik} - b_w W_{ik} + \\left(\\sum_{j=1}^J \\mathbb{E}_q[Z_{ijk}]\\right) \\ln W_{ik} - W_{ik} \\left(\\sum_{j=1}^J \\mathbb{E}_q[H_{kj}]\\right) $$\n$$ \\ln q^*(W_{ik}) \\propto \\left( a_w - 1 + \\sum_{j=1}^J \\mathbb{E}_q[Z_{ijk}] \\right) \\ln W_{ik} - \\left( b_w + \\sum_{j=1}^J \\mathbb{E}_q[H_{kj}] \\right) W_{ik} $$\n这是伽马分布的对数核。$q(W_{ik})$ 更新后的变分参数是：\n$$ \\tilde{a}_{w_{ik}}^{\\text{new}} = a_w + \\sum_{j=1}^J \\mathbb{E}_q[Z_{ijk}] = a_w + \\sum_{j=1}^J X_{ij}\\pi_{ijk} $$\n$$ \\tilde{b}_{w_{ik}}^{\\text{new}} = b_w + \\sum_{j=1}^J \\mathbb{E}_q[H_{kj}] = b_w + \\sum_{j=1}^J \\frac{\\tilde{a}_{h_{kj}}}{\\tilde{b}_{h_{kj}}} $$\n\n#### $q(H_{kj})$ 的更新\n推导过程与 $q(W_{ik})$ 的推导对称。对于固定的 $(k, j)$：\n$$ \\ln q^*(H_{kj}) \\propto \\left( a_h - 1 + \\sum_{i=1}^I \\mathbb{E}_q[Z_{ijk}] \\right) \\ln H_{kj} - \\left( b_h + \\sum_{i=1}^I \\mathbb{E}_q[W_{ik}] \\right) H_{kj} $$\n$q(H_{kj})$ 更新后的变分参数是：\n$$ \\tilde{a}_{h_{kj}}^{\\text{new}} = a_h + \\sum_{i=1}^I \\mathbb{E}_q[Z_{ijk}] = a_h + \\sum_{i=1}^I X_{ij}\\pi_{ijk} $$\n$$ \\tilde{b}_{h_{kj}}^{\\text{new}} = b_h + \\sum_{i=1}^I \\mathbb{E}_q[W_{ik}] = b_h + \\sum_{i=1}^I \\frac{\\tilde{a}_{w_{ik}}}{\\tilde{b}_{w_{ik}}} $$\n\n### 4. 变分后验均值的表达式\n\n任务是找到 $\\mathbb{E}_{q}[W_{i^{\\star}k^{\\star}}]$ 在更新后的后验均值。形状参数为 $a$、率参数为 $b$ 的伽马分布的均值是 $a/b$。使用推导出的 $q(W_{i^{\\star}k^{\\star}})$ 参数的更新规则，我们得到：\n$$ \\mathbb{E}_{q}[W_{i^{\\star}k^{\\star}}] = \\frac{\\tilde{a}_{w_{i^{\\star}k^{\\star}}}^{\\text{new}}}{\\tilde{b}_{w_{i^{\\star}k^{\\star}}}^{\\text{new}}} $$\n在一个坐标上升步骤中，$W_{i^{\\star}k^{\\star}}$ 的新参数是使用其他变分参数的最新值计算的。具体来说，责任 $\\pi_{i^{\\star}jk^{\\star}}$ 刚刚被更新，而 $H_{k^{\\star}j}$ 的参数来自前一次扫描。代入更新后参数的表达式：\n$$ \\mathbb{E}_{q}[W_{i^{\\star}k^{\\star}}] = \\frac{a_w + \\sum_{j=1}^J X_{i^{\\star}j}\\pi_{i^{\\star}jk^{\\star}}}{b_w + \\sum_{j=1}^J \\mathbb{E}_q[H_{k^{\\star}j}]} $$\n其中 $\\pi_{i^{\\star}jk^{\\star}}$ 表示当前的责任，而 $\\mathbb{E}_q[H_{k^{\\star}j}] = \\frac{\\tilde{a}_{h_{k^{\\star}j}}}{\\tilde{b}_{h_{k^{\\star}j}}}$ 是基于其当前变分参数 $\\tilde{a}_{h_{k^{\\star}j}}$ 和 $\\tilde{b}_{h_{k^{\\star}j}}$ 的 $H_{k^{\\star}j}$ 的后验均值。这是更新后均值的闭式表达式。",
            "answer": "$$\n\\boxed{\\frac{a_w + \\sum_{j=1}^{J} X_{i^{\\star}j}\\pi_{i^{\\star}jk^{\\star}}}{b_w + \\sum_{j=1}^{J} \\frac{\\tilde{a}_{h_{k^{\\star}j}}}{\\tilde{b}_{h_{k^{\\star}j}}}}}\n$$"
        }
    ]
}