{
    "hands_on_practices": [
        {
            "introduction": "The first challenge in bisulfite sequencing analysis is aligning reads that have undergone chemical conversion, as standard algorithms would misinterpret C-to-T changes as genomic variants. This practice explores the foundational bioinformatic solution: creating in-silico converted reference genomes. By algorithmically simulating the bisulfite conversion on the reference sequence, you will understand how specialized aligners accurately map reads from both DNA strands, a critical first step for any downstream methylation analysis .",
            "id": "4544140",
            "problem": "You are given a single-stranded deoxyribonucleic acid (DNA) reference sequence $S$ over the alphabet $\\{\\text{A}, \\text{C}, \\text{G}, \\text{T}\\}$ and a set of observed sequencing reads $\\{r_i\\}$ originating from a directional sodium bisulfite sequencing library. Use the following foundational facts as the basis for your derivation and program design: (i) Sodium bisulfite converts unmethylated cytosine ($\\text{C}$) to uracil ($\\text{U}$), and during sequencing $\\text{U}$ is read as thymine ($\\text{T}$), while methylated cytosine remains as cytosine. (ii) Complementarity implies that cytosine ($\\text{C}$) pairs with guanine ($\\text{G}$), and adenine ($\\text{A}$) pairs with thymine ($\\text{T}$). (iii) In directional libraries from Whole-Genome Bisulfite Sequencing (WGBS), the sequenced read orientation is preserved, so reads derived from the forward-strand template exhibit $\\text{C}\\rightarrow\\text{T}$ conversions on the read sequence, whereas reads derived from the reverse-strand template exhibit $\\text{G}\\rightarrow\\text{A}$ conversions on the read sequence (reflecting $\\text{C}\\rightarrow\\text{T}$ on the opposite template and subsequent base pairing).\n\nYour task is to derive, from these facts, how to construct two converted references and show algorithmically how mapping to both captures reads from both strands in directional libraries. Construct the two converted references via functions $f_{\\text{CT}}$ and $f_{\\text{GA}}$ defined as:\n- $$f_{\\text{CT}}(S) = \\text{replace every } \\text{C} \\text{ in } S \\text{ with } \\text{T},$$\n- $$f_{\\text{GA}}(S) = \\text{replace every } \\text{G} \\text{ in } S \\text{ with } \\text{A}.$$\n\nDefine a read $r$ as \"mapped\" to a converted reference $R$ if and only if $r$ is an exact substring of $R$ with no mismatches. Treat the ambiguous base $\\text{N}$ as a strict mismatch (i.e., positions with $\\text{N}$ cannot match any character in $R$). Use this definition to compute, for each test case with a reference $S$ and reads $\\{r_i\\}$, the integers:\n- $$M_{\\text{CT}} = \\text{number of reads } r_i \\text{ that are exact substrings of } f_{\\text{CT}}(S),$$\n- $$M_{\\text{GA}} = \\text{number of reads } r_i \\text{ that are exact substrings of } f_{\\text{GA}}(S),$$\n- $$M_{\\text{both}} = \\text{number of reads } r_i \\text{ that are exact substrings of at least one of } f_{\\text{CT}}(S) \\text{ or } f_{\\text{GA}}(S).$$\n\nYour program must implement the construction of $f_{\\text{CT}}(S)$ and $f_{\\text{GA}}(S)$, perform exact substring mapping with the $\\text{N}$-mismatch rule, and compute the specified integers for each test case. No physical units are involved. All outputs must be integers.\n\nTest Suite (each test case is a pair $(S, \\{r_i\\})$):\n- Test Case $1$: \n  - $S = \\text{\"ACCGTGACCTAGC\"}$\n  - Reads $\\{r_i\\} = [\\text{\"ATTGTG\"}, \\text{\"ATAACC\"}, \\text{\"TTTAG\"}, \\text{\"ATNGTG\"}, \\text{\"ATTGTGATTTAGTAAAAA\"}, \\text{\"ACCGT\"}]$\n- Test Case $2$: \n  - $S = \\text{\"ATATATAT\"}$\n  - Reads $\\{r_i\\} = [\\text{\"ATATA\"}, \\text{\"TATAT\"}, \\text{\"GATAT\"}, \\text{\"ATATATAT\"}, \\text{\"NATAT\"}]$\n- Test Case $3$: \n  - $S = \\text{\"CCCCGGGG\"}$\n  - Reads $\\{r_i\\} = [\\text{\"TTTTG\"}, \\text{\"CCCAA\"}, \\text{\"CCCCG\"}, \\text{\"AAA\"}, \\text{\"GGGG\"}, \\text{\"TTTTAAAA\"}]$\n- Test Case $4$: \n  - $S = \\text{\"AGCT\"}$\n  - Reads $\\{r_i\\} = [\\text{\"AGTT\"}, \\text{\"AACT\"}, \\text{\"AGCT\"}, \\text{\"NNNN\"}, \\text{\"AGTTA\"}]$\n- Test Case $5$: \n  - $S = \\text{\"CGCGCG\"}$\n  - Reads $\\{r_i\\} = [\\text{\"TGTG\"}, \\text{\"CAC\"}, \\text{\"TGCA\"}, \\text{\"CACACA\"}, \\text{\"TGTGTG\"}, \\text{\"ACAC\"}, \\text{\"GTGT\"}]$\n\nYour program should produce a single line of output containing, for each test case, a list $[M_{\\text{CT}}, M_{\\text{GA}}, M_{\\text{both}}]$. Aggregate all test case results into a single top-level list. The exact output format is a single line with no spaces, as a comma-separated list enclosed in square brackets; for example, $$[[m_{1,\\text{CT}},m_{1,\\text{GA}},m_{1,\\text{both}}],[m_{2,\\text{CT}},m_{2,\\text{GA}},m_{2,\\text{both}}],\\dots]$$ where each $m_{k,\\cdot}$ is an integer for test case $k$.",
            "solution": "The problem requires the derivation and implementation of an algorithm to quantify read alignments in directional sodium bisulfite sequencing by creating two computationally converted reference sequences. The validation and solution are as follows.\n\n### **Problem Validation**\n\n**Step 1: Extract Givens**\n\n*   **Reference Sequence:** A single-stranded DNA sequence $S$ over the alphabet $\\{\\text{A}, \\text{C}, \\text{G}, \\text{T}\\}$.\n*   **Reads:** A set of observed sequencing reads $\\{r_i\\}$.\n*   **Sequencing Context:** Directional sodium bisulfite sequencing.\n*   **Principle (i):** Sodium bisulfite converts unmethylated cytosine ($\\text{C}$) to uracil ($\\text{U}$), which is sequenced as thymine ($\\text{T}$). Methylated cytosine remains as cytosine ($\\text{C}$).\n*   **Principle (ii):** Base complementarity is $\\text{C} \\leftrightarrow \\text{G}$ and $\\text{A} \\leftrightarrow \\text{T}$.\n*   **Principle (iii):** In directional libraries, reads from the forward-strand template exhibit $\\text{C}\\rightarrow\\text{T}$ conversions; reads from the reverse-strand template exhibit $\\text{G}\\rightarrow\\text{A}$ conversions on the read sequence relative to the forward reference $S$.\n*   **Function Definitions:**\n    *   $f_{\\text{CT}}(S) = \\text{replace every } \\text{C} \\text{ in } S \\text{ with } \\text{T}$.\n    *   $f_{\\text{GA}}(S) = \\text{replace every } \\text{G} \\text{ in } S \\text{ with } \\text{A}$.\n*   **Mapping Definition:** A read $r$ is \"mapped\" to a reference $R$ if $r$ is an exact substring of $R$.\n*   **Ambiguous Base Rule:** The base $\\text{N}$ is treated as a strict mismatch.\n*   **Quantities to Compute:**\n    *   $M_{\\text{CT}} = \\text{number of reads } r_i \\text{ that are exact substrings of } f_{\\text{CT}}(S)$.\n    *   $M_{\\text{GA}} = \\text{number of reads } r_i \\text{ that are exact substrings of } f_{\\text{GA}}(S)$.\n    *   $M_{\\text{both}} = \\text{number of reads } r_i \\text{ that are exact substrings of at least one of } f_{\\text{CT}}(S) \\text{ or } f_{\\text{GA}}(S)$.\n*   **Test Suite:** Five test cases, each consisting of a pair $(S, \\{r_i\\})$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is reviewed against the specified validation criteria.\n*   **Scientifically Grounded:** The problem statement is based on the well-established principles of Whole-Genome Bisulfite Sequencing (WGBS). The use of in-silico converted genomes to enable the alignment of bisulfite-treated reads is a standard and fundamental technique in the field of DNA methylation analysis, employed by widely-used bioinformatics tools. The description is a correct, albeit simplified, model of the process.\n*   **Well-Posed:** All terms ($S$, $r_i$, $f_{\\text{CT}}$, $f_{\\text{GA}}$, \"mapped\") are precisely defined. The inputs (test cases) are provided, and the required outputs ($M_{\\text{CT}}$, $M_{\\text{GA}}$, $M_{\\text{both}}$) are unambiguously specified. For any given input, a unique, stable, and meaningful set of integer outputs can be computed.\n*   **Objective:** The problem is stated in objective, scientific language, free from subjective claims or ambiguity.\n\nThe problem does not exhibit any of the listed flaws (e.g., scientific unsoundness, incompleteness, contradiction, infeasibility). It is a formalizable and solvable problem directly relevant to bioinformatics.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. A solution will be provided.\n\n### **Derivation and Algorithmic Design**\n\nThe core principle of bisulfite sequencing is that it introduces predictable changes to the DNA sequence that are dependent on methylation status. An alignment algorithm must account for these changes to correctly map reads back to a reference genome. The problem asks us to formalize this for a directional library.\n\n**1. Theoretical Foundation**\n\nLet $S$ be the original forward-strand reference sequence.\n\n*   **Forward-Strand Reads:** A read originating from the forward strand template is subject to bisulfite conversion. Any unmethylated cytosine ($\\text{C}$) on this strand becomes a uracil ($\\text{U}$), which is subsequently read as a thymine ($\\text{T}$) by the sequencer. Methylated cytosines are protected and remain as $\\text{C}$. Therefore, a sequencing read from this strand will align to the original reference $S$ at a position where all original $\\text{T}$s are still $\\text{T}$s, all methylated $\\text{C}$s are still $\\text{C}$s, but all unmethylated $\\text{C}$s have become $\\text{T}$s. Since we do not know the methylation status a priori, to find all possible alignment locations for such a read, we must consider that *any* $\\text{C}$ in the reference could have been unmethylated and thus converted to a $\\text{T}$. The function $f_{\\text{CT}}(S)$, which creates a converted reference by replacing every $\\text{C}$ in $S$ with a $\\text{T}$, correctly models this \"all-Cs-are-unmethylated\" scenario. A read derived from the forward strand will be an exact substring of $f_{\\text{CT}}(S)$ if all of its corresponding cytosines in the original genome were either unmethylated or were already thymines. Reads containing cytosines (from methylated sites) will not match this fully-converted reference, but this problem defines mapping against the fully converted references only.\n\n*   **Reverse-Strand Reads:** The reverse strand is the complement of $S$. A cytosine on the reverse strand corresponds to a guanine ($\\text{G}$) on the forward strand $S$. When the reverse strand undergoes bisulfite treatment, its unmethylated cytosines are converted to uracils (read as thymines). However, standard alignment practice is to map all reads back to the single forward-reference sequence $S$. A $\\text{C} \\rightarrow \\text{T}$ conversion on the reverse-complement strand manifests as a $\\text{G} \\rightarrow \\text{A}$ change when the read is oriented and compared against the forward reference $S$. This is a direct consequence of base pairing rules. Therefore, to account for reads originating from the reverse strand, we must consider that any $\\text{G}$ in the reference $S$ (corresponding to a $\\text{C}$ on the reverse strand) could be read as an $\\text{A}$. The function $f_{\\text{GA}}(S)$, which replaces every $\\text{G}$ in $S$ with an $\\text{A}$, correctly models this scenario for the reverse strand.\n\n**2. Algorithmic Procedure**\n\nBased on the derivation above, the algorithm to compute the required counts for a given test case $(S, \\{r_i\\})$ is as follows:\n\n*   **Step 1: Reference Conversion.**\n    *   Construct the forward-converted reference $R_{\\text{CT}} = f_{\\text{CT}}(S)$. This is achieved by replacing every occurrence of the character '$\\text{C}$' in string $S$ with '$\\text{T}$'.\n    *   Construct the reverse-converted reference $R_{\\text{GA}} = f_{\\text{GA}}(S)$. This is achieved by replacing every occurrence of the character '$\\text{G}$' in string $S$ with '$\\text{A}$'.\n\n*   **Step 2: Read Mapping and Counting.**\n    *   Initialize three integer counters: $M_{\\text{CT}} \\leftarrow 0$, $M_{\\text{GA}} \\leftarrow 0$, and $M_{\\text{both}} \\leftarrow 0$.\n    *   Iterate through each read $r$ in the set of reads $\\{r_i\\}$. For each $r$:\n        *   The rule that the ambiguous base '$\\text{N}$' is a strict mismatch implies that any read containing '$\\text{N}$' cannot be an exact substring of $R_{\\text{CT}}$ or $R_{\\text{GA}}$, as these references are composed only of characters from $\\{\\text{A}, \\text{C}, \\text{G}, \\text{T}\\}$. Standard substring search functions correctly handle this; no special check for '$\\text{N}$' is needed if using such functions.\n        *   Determine if $r$ maps to $R_{\\text{CT}}$. Let this be a boolean variable, `maps_ct`. This is true if and only if $r$ is an exact substring of $R_{\\text{CT}}$.\n        *   Determine if $r$ maps to $R_{\\text{GA}}$. Let this be a boolean variable, `maps_ga`. This is true if and only if $r$ is an exact substring of $R_{\\text{GA}}$.\n        *   Update the counters based on these findings:\n            *   If `maps_ct` is true, increment $M_{\\text{CT}}$ by $1$.\n            *   If `maps_ga` is true, increment $M_{\\text{GA}}$ by $1$.\n            *   If `maps_ct` is true OR `maps_ga` is true, increment $M_{\\text{both}}$ by $1$.\n\n*   **Step 3: Collate Results.**\n    *   After iterating through all reads, the final values of $M_{\\text{CT}}$, $M_{\\text{GA}}$, and $M_{\\text{both}}$ form the result triplet for the test case. This procedure is repeated for all test cases in the suite.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the bisulfite sequencing read mapping problem for a suite of test cases.\n    \"\"\"\n    # Test Suite: Each case is a tuple (S, reads) where S is the reference\n    # sequence and reads is a list of sequencing reads.\n    test_cases = [\n        # Test Case 1\n        (\"ACCGTGACCTAGC\", [\"ATTGTG\", \"ATAACC\", \"TTTAG\", \"ATNGTG\", \"ATTGTGATTTAGTAAAAA\", \"ACCGT\"]),\n        # Test Case 2\n        (\"ATATATAT\", [\"ATATA\", \"TATAT\", \"GATAT\", \"ATATATAT\", \"NATAT\"]),\n        # Test Case 3\n        (\"CCCCGGGG\", [\"TTTTG\", \"CCCAA\", \"CCCCG\", \"AAA\", \"GGGG\", \"TTTTAAAA\"]),\n        # Test Case 4\n        (\"AGCT\", [\"AGTT\", \"AACT\", \"AGCT\", \"NNNN\", \"AGTTA\"]),\n        # Test Case 5\n        (\"CGCGCG\", [\"TGTG\", \"CAC\", \"TGCA\", \"CACACA\", \"TGTGTG\", \"ACAC\", \"GTGT\"])\n    ]\n\n    all_results = []\n\n    for S, reads in test_cases:\n        # Step 1: Construct the two in-silico converted references.\n        # f_CT(S): C -> T conversion for reads from the forward strand.\n        R_CT = S.replace('C', 'T')\n        \n        # f_GA(S): G -> A conversion for reads from the reverse strand.\n        R_GA = S.replace('G', 'A')\n\n        # Step 2: Initialize counters for the current test case.\n        M_CT = 0\n        M_GA = 0\n        M_both = 0\n\n        # Step 3: Iterate through each read and check for exact substring matches.\n        for r in reads:\n            # The problem defines 'N' as a strict mismatch. The 'in' operator\n            # naturally handles this, as a read containing 'N' will not be found\n            # as a substring in a reference that does not contain 'N'.\n            \n            # Check if read r maps to the C->T converted reference.\n            maps_ct = r in R_CT\n            \n            # Check if read r maps to the G->A converted reference.\n            maps_ga = r in R_GA\n            \n            # Update counters based on mapping results.\n            if maps_ct:\n                M_CT += 1\n            \n            if maps_ga:\n                M_GA += 1\n            \n            # M_both counts reads that map to at least one of the references.\n            if maps_ct or maps_ga:\n                M_both += 1\n        \n        all_results.append([M_CT, M_GA, M_both])\n\n    # Format the final output as specified: [[r1_ct,r1_ga,r1_both],[r2_ct,r2_ga,r2_both],...]\n    # Using map(str, ...) converts each inner list to its string representation.\n    # Joining with ',' separates the string representations of the lists.\n    # The outer f-string adds the enclosing brackets.\n    output_str = f\"[{','.join(map(str, all_results))}]\"\n    \n    # The problem asks for a single line of output with no spaces.\n    # The string representation of a list in Python includes spaces after commas.\n    # To match the specified format precisely, we remove spaces.\n    print(output_str.replace(\" \", \"\"))\n\nsolve()\n\n```"
        },
        {
            "introduction": "After reads are mapped, not all alignments provide equally reliable evidence for methylation status. This exercise demonstrates how to apply critical quality filters—based on mapping quality, base quality, and PCR duplicates—to raw alignment data. You will learn to justify these essential data hygiene steps in terms of reducing statistical bias and variance, and then use the filtered data to derive a robust methylation estimate .",
            "id": "4544197",
            "problem": "A single cytosine–phosphate–guanine (CpG) site is interrogated by whole-genome bisulfite sequencing. In sodium bisulfite treatment, an unmethylated cytosine is deaminated to uracil and sequenced as thymine, while a methylated cytosine remains as cytosine. A Phred base quality score $Q$ encodes the probability of a base-calling error as $P(\\text{error}) = 10^{-Q/10}$. A Phred-scaled mapping quality $MQ$ encodes the probability that a read is incorrectly mapped as $P(\\text{wrong map}) = 10^{-MQ/10}$. Reads marked as duplicates are assumed to be polymerase chain reaction (PCR) duplicates and are to be excluded. You are given a set of $20$ reads covering a single CpG with the observed base at the CpG ($C$ or $T$), the read’s mapping quality $MQ$, the base quality $Q$ at the CpG position, and a duplicate flag $\\mathrm{DUP} \\in \\{0,1\\}$:\n- Read $1$: base $C$, $MQ=37$, $Q=35$, $\\mathrm{DUP}=0$\n- Read $2$: base $C$, $MQ=41$, $Q=32$, $\\mathrm{DUP}=0$\n- Read $3$: base $T$, $MQ=38$, $Q=33$, $\\mathrm{DUP}=0$\n- Read $4$: base $C$, $MQ=29$, $Q=38$, $\\mathrm{DUP}=0$\n- Read $5$: base $T$, $MQ=36$, $Q=28$, $\\mathrm{DUP}=0$\n- Read $6$: base $C$, $MQ=60$, $Q=40$, $\\mathrm{DUP}=1$\n- Read $7$: base $C$, $MQ=60$, $Q=40$, $\\mathrm{DUP}=0$\n- Read $8$: base $T$, $MQ=31$, $Q=31$, $\\mathrm{DUP}=0$\n- Read $9$: base $T$, $MQ=34$, $Q=30$, $\\mathrm{DUP}=0$\n- Read $10$: base $C$, $MQ=35$, $Q=30$, $\\mathrm{DUP}=0$\n- Read $11$: base $T$, $MQ=50$, $Q=39$, $\\mathrm{DUP}=0$\n- Read $12$: base $C$, $MQ=33$, $Q=29$, $\\mathrm{DUP}=0$\n- Read $13$: base $C$, $MQ=32$, $Q=35$, $\\mathrm{DUP}=0$\n- Read $14$: base $T$, $MQ=45$, $Q=35$, $\\mathrm{DUP}=1$\n- Read $15$: base $C$, $MQ=42$, $Q=31$, $\\mathrm{DUP}=0$\n- Read $16$: base $T$, $MQ=55$, $Q=37$, $\\mathrm{DUP}=0$\n- Read $17$: base $C$, $MQ=47$, $Q=30$, $\\mathrm{DUP}=0$\n- Read $18$: base $T$, $MQ=30$, $Q=30$, $\\mathrm{DUP}=0$\n- Read $19$: base $C$, $MQ=44$, $Q=34$, $\\mathrm{DUP}=0$\n- Read $20$: base $T$, $MQ=39$, $Q=31$, $\\mathrm{DUP}=0$\n\nApply the following filters to obtain high-confidence observations: retain only reads with $MQ \\geq 30$, base quality $Q \\geq 30$ at the CpG position, and $\\mathrm{DUP} = 0$. Let $n$ be the number of retained reads, $c$ the retained count of observed $C$, and $t$ the retained count of observed $T$, with $n=c+t$.\n\nAssume a bisulfite non-conversion rate $r = 0.01$, meaning an unmethylated cytosine fails to convert with probability $r$ before sequencing. Assume a symmetric base-calling error model with per-read error probability $e$ equal to the error implied by the minimum retained base-quality threshold, i.e., $e = 10^{-Q_{\\min}/10}$ with $Q_{\\min}=30$. Under these assumptions and the biochemical process of bisulfite conversion, derive from first principles the probability of observing a $C$ at this site in a retained read as a linear function of the methylation fraction $m \\in [0,1]$. Then, using a method-of-moments argument equating the empirical fraction $\\hat{p} = c/n$ to the derived expectation, solve for an estimator $\\hat{m}$ of $m$ in closed form and evaluate it numerically from the filtered data.\n\nBriefly justify how each filter (mapping quality, base quality, duplicate removal) affects estimation bias and variance in this context, but report as your final answer only the numerical value of $\\hat{m}$ as a decimal (no percentage sign). Round your final reported value to four significant figures.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of bisulfite sequencing, well-posed with sufficient data and clear objectives, and objectively stated.\n\nThe solution proceeds in five steps: first, filtering the provided sequencing data; second, deriving a probabilistic model for the observed base as a function of the methylation fraction; third, deriving an estimator for the methylation fraction using the method of moments; fourth, calculating the numerical value of the estimate; and fifth, justifying the use of data filters.\n\nFirst, the raw sequencing data must be filtered to retain only high-confidence observations. The specified criteria are a mapping quality $MQ \\geq 30$, a base quality $Q \\geq 30$ at the CpG position, and the absence of a duplicate flag (i.e., $\\mathrm{DUP} = 0$). We apply these filters to the set of $20$ reads:\n- Read $1$: $C, MQ=37, Q=35, \\mathrm{DUP}=0$. Kept.\n- Read $2$: $C, MQ=41, Q=32, \\mathrm{DUP}=0$. Kept.\n- Read $3$: $T, MQ=38, Q=33, \\mathrm{DUP}=0$. Kept.\n- Read $4$: $C, MQ=29, Q=38, \\mathrm{DUP}=0$. Discarded ($MQ < 30$).\n- Read $5$: $T, MQ=36, Q=28, \\mathrm{DUP}=0$. Discarded ($Q < 30$).\n- Read $6$: $C, MQ=60, Q=40, \\mathrm{DUP}=1$. Discarded ($\\mathrm{DUP} = 1$).\n- Read $7$: $C, MQ=60, Q=40, \\mathrm{DUP}=0$. Kept.\n- Read $8$: $T, MQ=31, Q=31, \\mathrm{DUP}=0$. Kept.\n- Read $9$: $T, MQ=34, Q=30, \\mathrm{DUP}=0$. Kept.\n- Read $10$: $C, MQ=35, Q=30, \\mathrm{DUP}=0$. Kept.\n- Read $11$: $T, MQ=50, Q=39, \\mathrm{DUP}=0$. Kept.\n- Read $12$: $C, MQ=33, Q=29, \\mathrm{DUP}=0$. Discarded ($Q < 30$).\n- Read $13$: $C, MQ=32, Q=35, \\mathrm{DUP}=0$. Kept.\n- Read $14$: $T, MQ=45, Q=35, \\mathrm{DUP}=1$. Discarded ($\\mathrm{DUP} = 1$).\n- Read $15$: $C, MQ=42, Q=31, \\mathrm{DUP}=0$. Kept.\n- Read $16$: $T, MQ=55, Q=37, \\mathrm{DUP}=0$. Kept.\n- Read $17$: $C, MQ=47, Q=30, \\mathrm{DUP}=0$. Kept.\n- Read $18$: $T, MQ=30, Q=30, \\mathrm{DUP}=0$. Kept.\n- Read $19$: $C, MQ=44, Q=34, \\mathrm{DUP}=0$. Kept.\n- Read $20$: $T, MQ=39, Q=31, \\mathrm{DUP}=0$. Kept.\n\nAfter filtering, the number of retained reads is $n=15$. The count of observed cytosines ($C$) is $c=8$. The count of observed thymines ($T$) is $t=7$. The sum is $c+t = 8+7=15=n$, as expected. The empirical fraction of observed $C$ bases is $\\hat{p} = \\frac{c}{n} = \\frac{8}{15}$.\n\nSecond, we derive the probability of observing a $C$ at this site in a given retained read, denoted $P(\\text{obs}=C)$. This probability is a function of the true methylation fraction $m \\in [0,1]$, the bisulfite non-conversion rate $r$, and the base-calling error rate $e$. Let a DNA molecule be methylated with probability $m$ and unmethylated with probability $1-m$.\n\nThe observation of a $C$ can arise from two mutually exclusive scenarios based on the true state of the DNA molecule:\n1.  The original cytosine is methylated (probability $m$). It is not affected by bisulfite treatment and remains a $C$. It is then sequenced correctly as a $C$. The probability of a correct base call is $1-e$. The total probability for this path is $P(\\text{obs}=C \\text{ and methylated}) = m \\times 1 \\times (1-e) = m(1-e)$.\n\n2.  The original cytosine is unmethylated (probability $1-m$). Two sub-paths can lead to observing a $C$:\n    a. Bisulfite non-conversion: The unmethylated $C$ fails to convert to uracil (probability $r$). It remains a $C$ and is then correctly sequenced as a $C$ (probability $1-e$). The probability for this sub-path is $(1-m) \\times r \\times (1-e)$.\n    b. Conversion and sequencing error: The unmethylated $C$ correctly converts to uracil (which is read as $T$) (probability $1-r$). This $T$ is then incorrectly sequenced as a $C$ due to a base-calling error (probability $e$). The probability for this sub-path is $(1-m) \\times (1-r) \\times e$.\n\nThe total probability of observing a $C$ is the sum of the probabilities of these disjoint paths:\n$$ P(\\text{obs}=C) = m(1-e) + (1-m)r(1-e) + (1-m)(1-r)e $$\nThis expression can be rearranged to show its linear dependence on $m$:\n$$ P(\\text{obs}=C) = m(1-e) + (1-m)[r(1-e) + e(1-r)] $$\n$$ P(\\text{obs}=C) = m(1-e) + (1-m)(r - re + e - re) $$\n$$ P(\\text{obs}=C) = m(1-e) + (1-m)(r + e - 2re) $$\nGrouping terms by $m$:\n$$ P(\\text{obs}=C) = m(1-e) - m(r+e-2re) + (r+e-2re) $$\n$$ P(\\text{obs}=C) = m[(1-e) - (r+e-2re)] + (r+e-2re) $$\n$$ P(\\text{obs}=C) = m[1 - 2e - r + 2re] + (r+e-2re) $$\nFactoring the coefficient of $m$ gives $(1-r)(1-2e)$. Thus, the linear function is:\n$$ P(\\text{obs}=C) = m(1-r)(1-2e) + (r+e-2re) $$\n\nThird, we derive the estimator $\\hat{m}$ for $m$. The method of moments equates the empirical sample moment with the corresponding theoretical population moment. Here, we equate the sample proportion of observed $C$s, $\\hat{p} = c/n$, to the theoretical probability $P(\\text{obs}=C)$:\n$$ \\hat{p} = \\hat{m}(1-r)(1-2e) + (r+e-2re) $$\nSolving for the estimator $\\hat{m}$:\n$$ \\hat{p} - (r+e-2re) = \\hat{m}(1-r)(1-2e) $$\n$$ \\hat{m} = \\frac{\\hat{p} - (r+e-2re)}{(1-r)(1-2e)} $$\nThis is the closed-form estimator for the methylation fraction $m$.\n\nFourth, we evaluate $\\hat{m}$ numerically. The given parameters are the non-conversion rate $r = 0.01$ and the base-calling error probability $e$, which is derived from the minimum quality threshold $Q_{\\min}=30$:\n$$ e = 10^{-Q_{\\min}/10} = 10^{-30/10} = 10^{-3} = 0.001 $$\nWe have the empirical fraction $\\hat{p} = 8/15$.\nThe term $r+e-2re$ is computed as:\n$$ r+e-2re = 0.01 + 0.001 - 2(0.01)(0.001) = 0.011 - 0.00002 = 0.01098 $$\nThe denominator term $(1-r)(1-2e)$ is:\n$$ (1-r)(1-2e) = (1-0.01)(1-2 \\times 0.001) = (0.99)(1-0.002) = (0.99)(0.998) = 0.98802 $$\nSubstituting these values into the estimator for $\\hat{m}$:\n$$ \\hat{m} = \\frac{\\frac{8}{15} - 0.01098}{0.98802} $$\n$$ \\hat{m} = \\frac{0.53333... - 0.01098}{0.98802} = \\frac{0.522353...}{0.98802} \\approx 0.528687 $$\nRounding to four significant figures, the estimated methylation level is $\\hat{m} \\approx 0.5287$.\n\nFifth, we briefly justify the data filtering steps.\n- **Mapping Quality ($MQ$) Filter**: This filter removes reads that may not originate from the genomic locus of interest. Including such reads could introduce significant bias, as their methylation state is unrelated to the target CpG site. For instance, if a mis-mapped read comes from an unmethylated paralogous region, it would contribute a $T$ observation, artificially deflating the methylation estimate. Removing low-$MQ$ reads reduces this source of bias.\n- **Base Quality ($Q$) Filter**: This filter removes base calls that have a high probability of being erroneous. Including low-quality bases would increase the noise in the counts of $C$ and $T$, leading to higher variance in the final estimate $\\hat{m}$. Furthermore, the derivation assumes a single, low error rate $e$. Including reads with much higher error probabilities would violate this model assumption and could introduce bias. Filtering for high $Q$ ensures that the error model is a reasonable approximation and improves the precision of the estimate.\n- **Duplicate Read Removal**: PCR duplicates are multiple reads originating from the amplification of a single DNA fragment. Including them would violate the assumption of independent observations. It would effectively over-count the evidence from one original molecule, leading to an artificially low variance estimate and potential for severe bias. If the single over-amplified fragment is methylated, the estimate would be biased upwards; if unmethylated, biased downwards. Removing duplicates ensures each retained read is an independent draw from the population of molecules, yielding a more accurate and unbiased estimate of $m$.",
            "answer": "$$\\boxed{0.5287}$$"
        },
        {
            "introduction": "Even after filtering, systematic errors inherent to the experimental process, such as incomplete bisulfite conversion, can bias methylation estimates. This advanced practice challenges you to derive a comprehensive probabilistic model from first principles, accounting for multiple, interacting sources of error. By solving for the true methylation proportion $p$ and quantifying the specific impact of artifacts, you will master the skill of deconvolving a true biological signal from experimental noise .",
            "id": "4544156",
            "problem": "A Whole-Genome Bisulfite Sequencing (WGBS) experiment is performed to estimate the DNA methylation proportion at a single cytosine–phosphate–guanine (CpG) site. In bisulfite treatment, unmethylated cytosine is chemically converted to uracil (which is read as thymine after polymerase chain reaction amplification), whereas 5-methylcytosine (5mC) largely resists conversion and remains cytosine. Consider the following stochastic model for a single CpG:\n\n- Let the true methylation proportion at the CpG be $p \\in [0,1]$.\n- For an unmethylated cytosine, bisulfite conversion to thymine occurs independently with probability $e \\in (0,1)$, and failure to convert (non-conversion) occurs with probability $1-e$.\n- For a methylated cytosine (5mC), erroneous conversion to thymine occurs with probability $\\delta \\in [0,1)$, and remains cytosine with probability $1-\\delta$.\n- During sequencing, base-calling errors are independent and occur with probabilities $\\epsilon_{CT}$ for calling a cytosine molecule as thymine and $\\epsilon_{TC}$ for calling a thymine molecule as cytosine.\n\nAfter alignment and quality filtering, the observed methylation proportion is defined as the fraction of reads reporting cytosine at the CpG, denoted by $m_{\\text{obs}} \\in [0,1]$.\n\nStarting only from the above definitions and the law of total probability, derive an expression for $m_{\\text{obs}}$ as a function of $p$, $e$, $\\delta$, $\\epsilon_{CT}$, and $\\epsilon_{TC}$. Then, using the measured value $m_{\\text{obs}} = 0.40$, and the experimentally calibrated parameters $e = 0.98$, $\\delta = 0.002$, $\\epsilon_{CT} = 0.001$, and $\\epsilon_{TC} = 0.0015$, solve for the true methylation proportion $p$.\n\nNext, quantify the additive bias in the observed methylation proportion attributable solely to incomplete conversion by comparing the observed proportion under incomplete conversion to its hypothetical value under perfect conversion. Formally, define the incomplete-conversion impact as\n$I \\equiv m_{\\text{obs}}(e) - m_{\\text{obs}}(1),$\nwhere $m_{\\text{obs}}(1)$ denotes the observed proportion in the hypothetical limit $e=1$ with all other parameters unchanged. Derive $I$ in terms of $p$, $e$, $\\epsilon_{CT}$, and $\\epsilon_{TC}$ and evaluate it numerically using the same parameters and your estimate of $p$.\n\nReport both the estimated true methylation proportion $p$ and the incomplete-conversion impact $I$ as decimal numbers, rounding each to four significant figures. No unit is required.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective. The problem describes a standard probabilistic model for analyzing Whole-Genome Bisulfite Sequencing (WGBS) data, a core technique in epigenetics. The parameters ($p, e, \\delta, \\epsilon_{CT}, \\epsilon_{TC}$) represent well-defined and realistic phenomena: true methylation level, bisulfite conversion efficiency, protection of methylated cytosines, and sequencing error rates. The given values are plausible for a real experiment. The problem is self-contained, with all necessary information provided to derive the requested expressions and solve for the unknown quantities. It is a formalizable problem in applied probability and bioinformatics, free of scientific or factual unsoundness, ambiguity, or contradiction. Therefore, the problem is deemed valid and a complete solution is provided below.\n\nThe observed methylation proportion, $m_{\\text{obs}}$, is the probability that a randomly selected sequencing read at the CpG site reports a cytosine. We can compute this using the law of total probability, by conditioning on the true state of the cytosine molecule before bisulfite treatment.\n\nLet $M$ be the event that the cytosine is methylated (5mC), and $U$ be the event that it is unmethylated. The probabilities are given as $P(M) = p$ and $P(U) = 1-p$.\nLet $C_{\\text{obs}}$ be the event that a cytosine is observed in the sequencing read. The quantity we seek is $m_{\\text{obs}} = P(C_{\\text{obs}})$.\n\nBy the law of total probability:\n$$m_{\\text{obs}} = P(C_{\\text{obs}}) = P(C_{\\text{obs}}|M)P(M) + P(C_{\\text{obs}}|U)P(U)$$\n$$m_{\\text{obs}} = p \\cdot P(C_{\\text{obs}}|M) + (1-p) \\cdot P(C_{\\text{obs}}|U)$$\n\nTo find the conditional probabilities $P(C_{\\text{obs}}|M)$ and $P(C_{\\text{obs}}|U)$, we condition further on the chemical state of the molecule after bisulfite treatment but before sequencing. Let $C_{\\text{chem}}$ be the event that the molecule is chemically a cytosine after treatment, and $T_{\\text{chem}}$ be the event that it has been converted to a uracil (which will become a thymine).\n\nFor a methylated cytosine (event $M$):\n- Resistance to conversion (remaining $C_{\\text{chem}}$) occurs with probability $1-\\delta$. So, $P(C_{\\text{chem}}|M) = 1-\\delta$.\n- Erroneous conversion (becoming $T_{\\text{chem}}$) occurs with probability $\\delta$. So, $P(T_{\\text{chem}}|M) = \\delta$.\n\nFor an unmethylated cytosine (event $U$):\n- Conversion (becoming $T_{\\text{chem}}$) occurs with probability $e$. So, $P(T_{\\text{chem}}|U) = e$.\n- Non-conversion (remaining $C_{\\text{chem}}$) occurs with probability $1-e$. So, $P(C_{\\text{chem}}|U) = 1-e$.\n\nDuring sequencing, errors can occur:\n- A chemical cytosine ($C_{\\text{chem}}$) is erroneously read as thymine with probability $\\epsilon_{CT}$. Thus, it is correctly read as cytosine with probability $P(C_{\\text{obs}}|C_{\\text{chem}}) = 1 - \\epsilon_{CT}$.\n- A chemical thymine ($T_{\\text{chem}}$) is erroneously read as cytosine with probability $P(C_{\\text{obs}}|T_{\\text{chem}}) = \\epsilon_{TC}$.\n\nNow we can compute $P(C_{\\text{obs}}|M)$ and $P(C_{\\text{obs}}|U)$:\n$$P(C_{\\text{obs}}|M) = P(C_{\\text{obs}}|C_{\\text{chem}}, M)P(C_{\\text{chem}}|M) + P(C_{\\text{obs}}|T_{\\text{chem}}, M)P(T_{\\text{chem}}|M)$$\nSince sequencing errors are independent of the original methylation state:\n$$P(C_{\\text{obs}}|M) = P(C_{\\text{obs}}|C_{\\text{chem}})P(C_{\\text{chem}}|M) + P(C_{\\text{obs}}|T_{\\text{chem}})P(T_{\\text{chem}}|M)$$\n$$P(C_{\\text{obs}}|M) = (1 - \\epsilon_{CT})(1 - \\delta) + \\epsilon_{TC}\\delta$$\n\nSimilarly, for the unmethylated case:\n$$P(C_{\\text{obs}}|U) = P(C_{\\text{obs}}|C_{\\text{chem}}, U)P(C_{\\text{chem}}|U) + P(C_{\\text{obs}}|T_{\\text{chem}}, U)P(T_{\\text{chem}}|U)$$\n$$P(C_{\\text{obs}}|U) = P(C_{\\text{obs}}|C_{\\text{chem}})P(C_{\\text{chem}}|U) + P(C_{\\text{obs}}|T_{\\text{chem}})P(T_{\\text{chem}}|U)$$\n$$P(C_{\\text{obs}}|U) = (1 - \\epsilon_{CT})(1 - e) + \\epsilon_{TC}e$$\n\nSubstituting these into the expression for $m_{\\text{obs}}$:\n$$m_{\\text{obs}} = p \\left[ (1 - \\epsilon_{CT})(1 - \\delta) + \\epsilon_{TC}\\delta \\right] + (1-p) \\left[ (1 - \\epsilon_{CT})(1 - e) + \\epsilon_{TC}e \\right]$$\nThis is the general expression for $m_{\\text{obs}}$.\n\nTo solve for the true methylation proportion $p$, we rearrange the equation. Let the coefficient of $p$ be $A$ and the coefficient of $(1-p)$ be $B$.\n$A = (1 - \\epsilon_{CT})(1 - \\delta) + \\epsilon_{TC}\\delta$\n$B = (1 - \\epsilon_{CT})(1 - e) + \\epsilon_{TC}e$\nSo, $m_{\\text{obs}} = pA + (1-p)B = pA + B - pB = p(A-B) + B$.\nSolving for $p$:\n$$p = \\frac{m_{\\text{obs}} - B}{A - B}$$\n\nNow, we substitute the given numerical values: $m_{\\text{obs}} = 0.40$, $e = 0.98$, $\\delta = 0.002$, $\\epsilon_{CT} = 0.001$, and $\\epsilon_{TC} = 0.0015$.\nFirst, calculate $A$ and $B$:\n$$A = (1 - 0.001)(1 - 0.002) + (0.0015)(0.002) = (0.999)(0.998) + 0.000003 = 0.997002 + 0.000003 = 0.997005$$\n$$B = (1 - 0.001)(1 - 0.98) + (0.0015)(0.98) = (0.999)(0.02) + 0.00147 = 0.01998 + 0.00147 = 0.02145$$\nThen, calculate $p$:\n$$p = \\frac{0.40 - 0.02145}{0.997005 - 0.02145} = \\frac{0.37855}{0.975555} \\approx 0.388040$$\nRounding to four significant figures, $p \\approx 0.3880$.\n\nNext, we quantify the incomplete-conversion impact, $I \\equiv m_{\\text{obs}}(e) - m_{\\text{obs}}(1)$.\nThe expression for $m_{\\text{obs}}(e)$ is the general one we derived. For $m_{\\text{obs}}(1)$, we substitute $e=1$ into the general expression:\n$$m_{\\text{obs}}(1) = p \\left[ (1 - \\epsilon_{CT})(1 - \\delta) + \\epsilon_{TC}\\delta \\right] + (1-p) \\left[ (1 - \\epsilon_{CT})(1 - 1) + \\epsilon_{TC}(1) \\right]$$\n$$m_{\\text{obs}}(1) = p \\left[ (1 - \\epsilon_{CT})(1 - \\delta) + \\epsilon_{TC}\\delta \\right] + (1-p) \\epsilon_{TC}$$\nNow, we compute the difference $I$:\n$$I = m_{\\text{obs}}(e) - m_{\\text{obs}}(1)$$\n$$I = \\left( p \\left[ \\dots \\right] + (1-p) \\left[ (1 - \\epsilon_{CT})(1 - e) + \\epsilon_{TC}e \\right] \\right) - \\left( p \\left[ \\dots \\right] + (1-p) \\epsilon_{TC} \\right)$$\nThe terms multiplied by $p$ cancel out.\n$$I = (1-p) \\left[ (1 - \\epsilon_{CT})(1 - e) + \\epsilon_{TC}e \\right] - (1-p) \\epsilon_{TC}$$\n$$I = (1-p) \\left( (1 - \\epsilon_{CT})(1 - e) + \\epsilon_{TC}e - \\epsilon_{TC} \\right)$$\n$$I = (1-p) \\left( (1 - \\epsilon_{CT})(1 - e) - \\epsilon_{TC}(1 - e) \\right)$$\n$$I = (1-p)(1-e)(1 - \\epsilon_{CT} - \\epsilon_{TC})$$\nThis is the expression for $I$ in terms of $p$, $e$, $\\epsilon_{CT}$, and $\\epsilon_{TC}$.\n\nFinally, we evaluate $I$ numerically using our calculated value of $p \\approx 0.388040$ and the given parameters:\n$$I = (1 - 0.388040)(1 - 0.98)(1 - 0.001 - 0.0015)$$\n$$I = (0.61196)(0.02)(1 - 0.0025)$$\n$$I = (0.61196)(0.02)(0.9975)$$\n$$I = (0.0122392)(0.9975) \\approx 0.012208594$$\nRounding to four significant figures, $I \\approx 0.01221$.\n\nThe estimated true methylation proportion is $p \\approx 0.3880$, and the incomplete-conversion impact is $I \\approx 0.01221$.",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.3880 & 0.01221 \\end{pmatrix}}$$"
        }
    ]
}