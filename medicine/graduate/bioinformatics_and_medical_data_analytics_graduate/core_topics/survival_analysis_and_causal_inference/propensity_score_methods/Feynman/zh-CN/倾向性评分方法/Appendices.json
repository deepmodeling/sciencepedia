{
    "hands_on_practices": [
        {
            "introduction": "应用倾向性得分方法后，关键的第一步是检查它们是否成功地平衡了治疗组和对照组之间的协变量。本练习介绍了用于此任务的最常用指标——标准化均数差（Standardized Mean Difference, $SMD$），以及判断平衡是否成功的常规经验法则。理解如何计算和解释 $SMD$ 是任何观察性研究中的一项基本技能。",
            "id": "4599524",
            "problem": "在一项医学数据分析的观察性队列研究中，应用倾向性评分方法后，评估了一种基因组指导的治疗对治疗组和未治疗组患者之间连续基线协变量 $X$（例如，生物标志物水平）的影响。设 $\\bar{X}_{1}$ 和 $\\bar{X}_{0}$ 分别表示治疗组和对照组的样本均值，设 $s_{1}^{2}$ 和 $s_{0}^{2}$ 表示从样本量分别为 $n_{1}$ 和 $n_{0}$ 的独立样本中计算出的相应样本方差。其科学目标是，在匹配或加权后，使用一个从第一性原理推导出的无量纲度量来量化协变量的平衡性，该度量反映了相对于合并离散程度度量的位置差异。\n\n从样本均值和样本方差的基本定义出发，并遵循通过共同尺度进行标准化可产生一个在不同协变量间可比较的无量纲效应量的原则，请选择正确指定了使用合并标准差的标准化均数差（Standardized Mean Difference (SMD)）并陈述了倾向性评分匹配或加权后可接受的协变量平衡的常规阈值的选项。当使用加权时（例如，治疗概率倒数加权），应将均值和方差解释为其加权对应量，并在合并尺度中使用相应的有效样本量。\n\n哪个选项是正确的？\n\nA. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{s_{p}}$，合并标准差为 $s_{p}=\\sqrt{\\dfrac{(n_{1}-1)s_{1}^{2}+(n_{0}-1)s_{0}^{2}}{n_{1}+n_{0}-2}}$。对于加权数据，用其加权对应量和有效样本量替换未加权的均值、方差和计数。在倾向性评分匹配或加权后，通常认为所有协变量的 $|SMD|  0.1$ 表示可接受的平衡。\n\nB. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{\\sqrt{s_{1}^{2}+s_{0}^{2}}}$，因为这直接汇总了离散度而没有进行自由度加权。在匹配或加权后，可接受的平衡为 $|SMD|  0.5$，以反映常规的“中等”效应量。\n\nC. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{s_{0}}$，仅通过对照组的标准差进行标准化以避免治疗组的影响。可接受的平衡为 $|SMD|  0.25$ 仅适用于基于倾向性评分的分层，而不适用于匹配或加权设计。\n\nD. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{\\bar{X}_{0}}\\times 100\\%$，这是一个对重新缩放不变的百分比差异。在匹配或加权后，可接受的平衡为 $|SMD|  10\\%$，因为这在任何单位系统中都将相对偏倚限制在 $10\\%$ 以内。",
            "solution": "用户要求对问题陈述进行细致而严格的验证，然后进行第一性原理推导并评估所提供的选项。\n\n**问题验证**\n\n**步骤1：提取已知信息**\n\n问题陈述提供了以下信息：\n- 背景是医学数据分析中的一项观察性队列研究。\n- 目标是评估一种基因组指导的治疗的效果。\n- 分析涉及一个连续的基线协变量，用 $X$ 表示。\n- 比较两组：治疗组和未治疗组（对照组）。\n- $\\bar{X}_{1}$ 和 $\\bar{X}_{0}$ 分别是治疗组和对照组中协变量 $X$ 的样本均值。\n- $s_{1}^{2}$ 和 $s_{0}^{2}$ 分别是治疗组和对照组中 $X$ 的样本方差。\n- $n_{1}$ 和 $n_{0}$ 分别是两个独立组的样本量。\n- 目标是量化应用倾向性评分方法（匹配或加权）后协变量的平衡性。\n- 所求的度量必须是无量纲的。\n- 该度量必须反映“相对于合并离散程度度量的位置差异”。\n- 推导必须从基本定义出发，并使用通过共同尺度进行标准化的原则。\n- 问题要求给出使用合并标准差的标准化均数差（SMD）的正确规范，以及其用于可接受平衡的常规阈值。\n- 对于加权数据，均值、方差和计数应解释为其加权对应量，并使用有效样本量。\n\n**步骤2：使用提取的已知信息进行验证**\n\n根据指定的标准对问题陈述进行验证。\n\n- **科学上合理**：该问题在科学上是合理的。标准化均数差（SMD）的概念是荟萃分析和观察性研究中协变量平衡评估的基石，尤其是在倾向性评分方法的背景下。所提供的样本均值、方差和样本量的定义在统计学中是标准的。所描述的情景是生物信息学和生物统计学中一个常见且现实的应用。\n- **提法恰当**：该问题提法恰当。它要求一个特定的、定义明确的统计量（SMD）及其使用的公认惯例。在该领域的既有文献中存在唯一的答案。\n- **客观的**：该问题使用精确、客观的统计术语进行表述。它不包含主观或基于观点的陈述。\n\n该问题没有表现出任何列出的缺陷：\n1. **科学或事实上的不健全**：不存在违反情况。所涉及的统计概念都是标准的。\n2. **不可形式化或不相关**：该问题可直接形式化，并且是倾向性评分方法主题的核心。\n3. **不完整或矛盾的设置**：设置是自洽的，足以根据所概述的原则定义SMD。\n4. **不切实际或不可行**：情景是现实的。\n5. **提法不当或结构不良**：问题清晰明确。\n6. **故作高深、微不足道或同义反复**：该问题需要统计方法论及其实际应用的特定知识；它既不微不足道，也非人为捏造。\n7. **超出科学可验证性范围**：SMD的定义及其常规阈值在统计学和流行病学文献中有详细记载且可验证。\n\n**步骤3：结论与行动**\n\n问题陈述是**有效的**。现在开始解答过程。\n\n**推导与解答**\n\n任务是推导一个无量纲的度量，该度量通过合并的离散程度度量进行标准化，以量化两组之间协变量 $X$ 均值的差异。\n\n1.  **位置差异**：治疗组和对照组之间协变量分布的位置差异自然地通过其样本均值的差来衡量：\n    $$ \\text{差异} = \\bar{X}_{1} - \\bar{X}_{0} $$\n    这个量与协变量 $X$ 具有相同的单位。\n\n2.  **通过合并的离散程度度量进行标准化**：为了创建一个在不同协变量之间可比较的无量纲度量，必须对该差异进行标准化。问题指定了通过“合并的离散程度度量”进行标准化，在此背景下，这意味着一个合并了两个组变异性的合并标准差。在假设方差齐性的前提下，从两个独立样本中合并方差的标准方法是计算各个样本方差的加权平均值，权重由其自由度（$n_{1}-1$ 和 $n_{0}-1$）确定。\n\n3.  **合并方差**：合并样本方差，记为 $s_{p}^{2}$，定义为：\n    $$ s_{p}^{2} = \\frac{(n_{1}-1)s_{1}^{2} + (n_{0}-1)s_{0}^{2}}{(n_{1}-1) + (n_{0}-1)} = \\frac{(n_{1}-1)s_{1}^{2} + (n_{0}-1)s_{0}^{2}}{n_{1}+n_{0}-2} $$\n    如果两个总体的方差确实相等，该公式提供了共同总体方差 $\\sigma^2$ 的一个无偏估计量。\n\n4.  **合并标准差**：合并标准差 $s_{p}$ 是合并方差的平方根：\n    $$ s_{p} = \\sqrt{\\frac{(n_{1}-1)s_{1}^{2} + (n_{0}-1)s_{0}^{2}}{n_{1}+n_{0}-2}} $$\n\n5.  **标准化均数差（SMD）**：SMD 是均值差与合并标准差的比值：\n    $$ SMD = \\frac{\\bar{X}_{1} - \\bar{X}_{0}}{s_{p}} = \\frac{\\bar{X}_{1} - \\bar{X}_{0}}{\\sqrt{\\frac{(n_{1}-1)s_{1}^{2} + (n_{0}-1)s_{0}^{2}}{n_{1}+n_{0}-2}}} $$\n    这种特定的公式也称为 Hedges' g。对于倾向性评分分析，使用这种通用形式，并且在加权数据的情况下，如问题所述，均值、方差和样本量被其加权或有效对应量所替代。\n\n6.  **平衡性的常规阈值**：在倾向性评分分析的背景下，SMD 被用作一种诊断工具，以检查匹配、分层或加权程序是否成功地平衡了治疗组和对照组之间的基线协变量。虽然已提出不同的阈值，但 $|SMD|  0.1$ 被广泛认为表示可忽略且可接受的不平衡水平。这一阈值在有影响力的论文中得到提倡，并已成为高质量医学研究中的事实标准。\n\n**逐项分析**\n\n**A. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{s_{p}}$，合并标准差为 $s_{p}=\\sqrt{\\dfrac{(n_{1}-1)s_{1}^{2}+(n_{0}-1)s_{0}^{2}}{n_{1}+n_{0}-2}}$。对于加权数据，用其加权对应量和有效样本量替换未加权的均值、方差和计数。在倾向性评分匹配或加权后，通常认为所有协变量的 $|SMD|  0.1$ 表示可接受的平衡。**\n\n-   **公式**：所提供的 SMD 和合并标准差 $s_{p}$ 的公式是根据第一性原理推导出的正确、标准的定义。处理加权数据的说明也是恰当的。\n-   **阈值**：阈值 $|SMD|  0.1$ 是宣布在倾向性评分调整后协变量达到充分平衡的最常用和公认的惯例。\n-   **结论**：**正确**。\n\n**B. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{\\sqrt{s_{1}^{2}+s_{0}^{2}}}$，因为这直接汇总了离散度而没有进行自由度加权。在匹配或加权后，可接受的平衡为 $|SMD|  0.5$，以反映常规的“中等”效应量。**\n\n-   **公式**：分母 $\\sqrt{s_{1}^{2}+s_{0}^{2}}$ 不是一个合并标准差。它是方差之和的平方根。合并估计量应该是平均值的一种形式，而不是和。该公式对于构建 SMD 是不正确的。\n-   **阈值**：$|SMD|  0.5$ 的阈值对应于 Cohen 分类中的“中等”效应量。这表示组间存在显著差异，对于平衡性诊断来说过于宽松。SMD 为 0.5 将意味着平衡性差。\n-   **结论**：**不正确**。\n\n**C. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{s_{0}}$，仅通过对照组的标准差进行标准化以避免治疗组的影响。可接受的平衡为 $|SMD|  0.25$ 仅适用于基于倾向性评分的分层，而不适用于匹配或加权设计。**\n\n-   **公式**：公式 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{s_{0}}$ 仅使用对照组的标准差进行标准化。虽然这是一种有效的 SMD 类型（称为 Glass's $\\Delta$），但它没有使用问题核心原则中指定的*合并*标准差。\n-   **阈值**：声称 $|SMD|  0.25$ 阈值*仅*适用于分层的说法是错误的。平衡阈值是一般性指导原则，通常不限于单一类型的倾向性评分方法。\n-   **结论**：**不正确**。\n\n**D. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{\\bar{X}_{0}}\\times 100\\%$，这是一个对重新缩放不变的百分比差异。在匹配或加权后，可接受的平衡为 $|SMD|  10\\%$，因为这在任何单位系统中都将相对偏倚限制在 $10\\%$ 以内。**\n\n-   **公式**：这是相对或百分比差异的公式，而不是标准化均数差。SMD 是通过离散程度的度量（标准差）进行标准化，而不是通过集中趋势的度量（均值）。如果均值 $\\bar{X}_{0}$ 接近于0，这个度量会非常不稳定。它不是适用于此应用的正确工具。\n-   **阈值**：10%的阈值与相对差异相关，而不是 SMD。所提供的理由是临时的，没有基于平衡诊断的标准理论。\n-   **结论**：**不正确**。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "逆概率治疗加权（Inverse Probability of Treatment Weighting, IPTW）是一种强大的技术，但它可能对倾向性得分极低或极高的个体非常敏感。这个实践问题提供了一个具体的例子，说明单个具有极端权重的患者如何不成比例地影响最终的治疗效果估计，从而突显了诊断权重稳定性的至关重要性。通过完成此计算，您将对估计量的机制及其潜在的不稳定性获得直观的理解。",
            "id": "4830875",
            "problem": "考虑一项观察性队列研究，该研究评估一个二元处理 $A \\in \\{0,1\\}$ 和一个连续的无量纲临床结局 $Y$（例如，标准化的症状减轻评分）。假设标准的因果识别条件成立：一致性、给定协变量 $X$ 的条件可交换性（无未测量混杂）和正值性。倾向性得分定义为 $e(X) = \\mathbb{P}(A=1 \\mid X)$，我们感兴趣的估计量是平均处理效应（ATE）的治疗概率倒数加权（IPTW）估计量，采用 Horvitz–Thompson 构造。\n\n给定一个由 $i = 1,2,3,4,5,6$ 索引的 $n = 6$ 名患者组成的小样本，其处理指示变量 $A_i$、结局 $Y_i$ 和估计的倾向性得分 $e_i = e(X_i)$ 记录如下。一名接受治疗的患者具有极端的倾向性得分，导致其倒数权重很大。数据如下：\n- 患者 1：$A_1 = 1$, $Y_1 = 1.2$, $e_1 = 0.02$。\n- 患者 2：$A_2 = 1$, $Y_2 = 0.8$, $e_2 = 0.55$。\n- 患者 3：$A_3 = 1$, $Y_3 = 1.0$, $e_3 = 0.65$。\n- 患者 4：$A_4 = 0$, $Y_4 = 0.9$, $e_4 = 0.50$。\n- 患者 5：$A_5 = 0$, $Y_5 = 1.1$, $e_5 = 0.30$。\n- 患者 6：$A_6 = 0$, $Y_6 = 0.7$, $e_6 = 0.20$。\n\n任务：\n- 从倾向性得分和平均处理效应（ATE）的定义出发，并引用所述的识别条件，推导在此有限样本中ATE的Horvitz–Thompson IPTW估计量。然后，使用所提供的数据，精确计算IPTW点估计值 $\\hat{\\tau}_{\\text{IPTW}}$。\n- 利用每个受试者的贡献，简要解释为什么单个极端权重会强烈影响点估计及其变异性。作为解释的一部分，计算每个受试者的经验影响函数贡献以及估计量的相应经验方差。你可以以数值形式呈现方差，无需四舍五入。\n\n请以精确的有理数形式表示最终的 $\\hat{\\tau}_{\\text{IPTW}}$。最终数值答案中不包含任何单位。首次出现时请定义任何缩略词（例如，治疗概率倒数加权（IPTW）和平均处理效应（ATE））。",
            "solution": "该问题要求推导和计算平均处理效应（ATE）的治疗概率倒数加权（IPTW）估计量，然后分析极端权重对估计值及其方差的影响。\n\n首先，我们定义核心概念。潜在结局 $Y_i(a)$ 表示患者 $i$ 在接受处理水平 $a \\in \\{0,1\\}$ 时本应经历的结局。平均处理效应（ATE），用 $\\tau$ 表示，是潜在结局的期望差异：\n$$\n\\tau = \\mathbb{E}[Y(1)] - \\mathbb{E}[Y(0)]\n$$\n\n为了从观察性数据中识别 $\\tau$，我们依赖于问题陈述中提供的三个标准假设：\n1.  **一致性**：对于每个个体 $i$，其观察到的结局 $Y_i$ 等于其接受的实际处理 $A_i$ 所对应的潜在结局。形式上，$Y_i = A_i Y_i(1) + (1-A_i) Y_i(0)$。\n2.  **条件可交换性（无未测量混杂）**：给定测量的协变量 $X$，处理分配 $A$ 独立于潜在结局 $\\{Y(0), Y(1)\\}$。形式上，$\\{Y(0), Y(1)\\} \\perp A \\mid X$。\n3.  **正值性（或重叠）**：对于总体中存在的任何一组协变量 $X$，接受任一处理水平的概率都非零。形式上，$0  \\mathbb{P}(A=1 \\mid X)  1$。倾向性得分定义为 $e(X) = \\mathbb{P}(A=1 \\mid X)$，所以这个假设是 $0  e(X)  1$。\n\n我们现在可以使用可观察量推导 $\\tau$ 的表达式。让我们专注于识别 $\\mathbb{E}[Y(1)]$。\n使用全期望定律，$\\mathbb{E}[Y(1)] = \\mathbb{E}_X[\\mathbb{E}[Y(1) \\mid X]]$。\n根据条件可交换性，$\\mathbb{E}[Y(1) \\mid X] = \\mathbb{E}[Y(1) \\mid A=1, X]$。\n根据一致性，$\\mathbb{E}[Y(1) \\mid A=1, X] = \\mathbb{E}[Y \\mid A=1, X]$。\n所以，$\\mathbb{E}[Y(1)] = \\mathbb{E}_X[\\mathbb{E}[Y \\mid A=1, X]]$。对于 $\\mathbb{E}[Y(0)]$ 也可进行类似的推导。\n\nIPTW 方法使用不同的方法来识别这些期望。考虑量 $\\frac{A Y}{e(X)}$。其期望为：\n$$\n\\mathbb{E}\\left[\\frac{A Y}{e(X)}\\right] = \\mathbb{E}_X\\left[\\mathbb{E}\\left[\\frac{A Y}{e(X)} \\mid X\\right]\\right] = \\mathbb{E}_X\\left[\\frac{1}{e(X)}\\mathbb{E}[A Y \\mid X]\\right]\n$$\n使用一致性，$A Y = A Y(1)$。所以，$\\mathbb{E}[A Y \\mid X] = \\mathbb{E}[A Y(1) \\mid X]$。\n根据条件可交换性，$Y(1) \\perp A \\mid X$，所以 $\\mathbb{E}[A Y(1) \\mid X] = \\mathbb{E}[A \\mid X] \\mathbb{E}[Y(1) \\mid X]$。\n根据定义，$\\mathbb{E}[A \\mid X] = e(X)$。\n代入回去，我们得到：\n$$\n\\mathbb{E}\\left[\\frac{A Y}{e(X)}\\right] = \\mathbb{E}_X\\left[\\frac{1}{e(X)} e(X) \\mathbb{E}[Y(1) \\mid X]\\right] = \\mathbb{E}_X[\\mathbb{E}[Y(1) \\mid X]] = \\mathbb{E}[Y(1)]\n$$\n对 $\\mathbb{E}[Y(0)]$ 使用量 $\\frac{(1-A)Y}{1-e(X)}$ 进行类似的推导，得到：\n$$\n\\mathbb{E}\\left[\\frac{(1-A)Y}{1-e(X)}\\right] = \\mathbb{E}[Y(0)]\n$$\n结合这些结果，ATE可以表示为：\n$$\n\\tau = \\mathbb{E}\\left[\\frac{A Y}{e(X)} - \\frac{(1-A)Y}{1-e(X)}\\right]\n$$\nHorvitz-Thompson IPTW 估计量是该期望的有限样本模拟，通过对样本求平均得到：\n$$\n\\hat{\\tau}_{\\text{IPTW}} = \\frac{1}{n} \\sum_{i=1}^{n} \\left( \\frac{A_i Y_i}{e_i} - \\frac{(1-A_i)Y_i}{1-e_i} \\right)\n$$\n其中 $n$ 是样本量，对于每个患者 $i$，$A_i$ 是处理指示变量，$Y_i$ 是结局，$e_i$ 是估计的倾向性得分。\n\n我们现在为给定的 $n=6$ 的样本计算 $\\hat{\\tau}_{\\text{IPTW}}$。令 $\\phi_i = \\frac{A_i Y_i}{e_i} - \\frac{(1-A_i)Y_i}{1-e_i}$。\n- 患者 1: $A_1=1, Y_1=1.2, e_1=0.02$。$\\phi_1 = \\frac{1 \\cdot 1.2}{0.02} - 0 = \\frac{1.2}{0.02} = 60$。\n- 患者 2: $A_2=1, Y_2=0.8, e_2=0.55$。$\\phi_2 = \\frac{1 \\cdot 0.8}{0.55} - 0 = \\frac{0.8}{0.55} = \\frac{80}{55} = \\frac{16}{11}$。\n- 患者 3: $A_3=1, Y_3=1.0, e_3=0.65$。$\\phi_3 = \\frac{1 \\cdot 1.0}{0.65} - 0 = \\frac{1.0}{0.65} = \\frac{100}{65} = \\frac{20}{13}$。\n- 患者 4: $A_4=0, Y_4=0.9, e_4=0.50$。$\\phi_4 = 0 - \\frac{1 \\cdot 0.9}{1-0.50} = -\\frac{0.9}{0.5} = -1.8 = -\\frac{9}{5}$。\n- 患者 5: $A_5=0, Y_5=1.1, e_5=0.30$。$\\phi_5 = 0 - \\frac{1 \\cdot 1.1}{1-0.30} = -\\frac{1.1}{0.7} = -\\frac{11}{7}$。\n- 患者 6: $A_6=0, Y_6=0.7, e_6=0.20$。$\\phi_6 = 0 - \\frac{1 \\cdot 0.7}{1-0.20} = -\\frac{0.7}{0.8} = -\\frac{7}{8}$。\n\n和为 $\\sum_{i=1}^6 \\phi_i = 60 + \\frac{16}{11} + \\frac{20}{13} - \\frac{9}{5} - \\frac{11}{7} - \\frac{7}{8}$。\n为了对分数求和，我们找到 $11, 13, 5, 7, 8$ 的公分母，即 $11 \\times 13 \\times 5 \\times 7 \\times 8 = 40040$。\n$$\n\\sum_{i=1}^6 \\phi_i = 60 + \\frac{16 \\cdot 3640}{40040} + \\frac{20 \\cdot 3080}{40040} - \\frac{9 \\cdot 8008}{40040} - \\frac{11 \\cdot 5720}{40040} - \\frac{7 \\cdot 5005}{40040}\n$$\n$$\n\\sum_{i=1}^6 \\phi_i = 60 + \\frac{58240 + 61600 - 72072 - 62920 - 35035}{40040} = 60 + \\frac{119840 - 170027}{40040} = 60 - \\frac{50187}{40040}\n$$\n$$\n\\sum_{i=1}^6 \\phi_i = \\frac{60 \\cdot 40040 - 50187}{40040} = \\frac{2402400 - 50187}{40040} = \\frac{2352213}{40040}\n$$\n现在，我们计算估计量 $\\hat{\\tau}_{\\text{IPTW}}$：\n$$\n\\hat{\\tau}_{\\text{IPTW}} = \\frac{1}{6} \\sum_{i=1}^6 \\phi_i = \\frac{1}{6} \\cdot \\frac{2352213}{40040} = \\frac{2352213}{240240}\n$$\n我们通过将分子和分母除以它们的最大公约数 $3$ 来化简分数：\n$$\n\\hat{\\tau}_{\\text{IPTW}} = \\frac{2352213 \\div 3}{240240 \\div 3} = \\frac{784071}{80080}\n$$\n该值的数值约等于 $9.79$。\n\n接下来，我们分析极端权重的影响。患者 1 是一个接受治疗的个体，其倾向性得分非常低，$e_1 = 0.02$。这个分数意味着，根据其协变量 $X_1$，他接受治疗的可能性非常小。IPTW 估计量通过给这位患者分配一个非常大的权重 $w_1 = 1/e_1 = 1/0.02 = 50$ 来补偿这种不平衡。该患者对未经缩放的总和的个体贡献是 $\\phi_1 = Y_1/e_1 = 1.2/0.02 = 60$。\n其他患者的贡献是：$\\phi_2 \\approx 1.45$，$\\phi_3 \\approx 1.54$，$\\phi_4 = -1.8$，$\\phi_5 \\approx -1.57$ 和 $\\phi_6 = -0.875$。患者 1 的贡献（$\\phi_1=60$）比其他任何贡献都大一个数量级，并且它压倒性地决定了最终的估计值。所有贡献的总和约为 $58.75$，ATE 估计值是这个总和除以 $6$，约为 $9.79$。仅患者 1 就对最终值贡献了 $60/6 = 10$。这表明 IPTW 估计量对具有极端倾向性得分（接近 $0$ 或 $1$）的受试者高度敏感，因为单个观测值可以主导估计值。这种敏感性导致估计量的高变异性（大方差）。\n\n为了量化这一点，我们计算每个受试者的经验影响函数贡献 $\\hat{\\psi}_i$。一个变量的样本均值的影响函数是该变量减去其均值。在这里，$\\hat{\\tau}_{\\text{IPTW}}$ 是 $\\phi_i$ 值的样本均值，所以受试者 $i$ 的经验影响贡献是 $\\hat{\\psi}_i = \\phi_i - \\hat{\\tau}_{\\text{IPTW}}$。\n使用 $\\hat{\\tau}_{\\text{IPTW}} = 784071/80080 \\approx 9.7911$：\n- $\\hat{\\psi}_1 = 60 - \\frac{784071}{80080} = \\frac{4804800 - 784071}{80080} = \\frac{4020729}{80080} \\approx 50.209$\n- $\\hat{\\psi}_2 = \\frac{16}{11} - \\frac{784071}{80080} = \\frac{116480 - 784071}{80080} = \\frac{-667591}{80080} \\approx -8.337$\n- $\\hat{\\psi}_3 = \\frac{20}{13} - \\frac{784071}{80080} = \\frac{123200 - 784071}{80080} = \\frac{-660871}{80080} \\approx -8.253$\n- $\\hat{\\psi}_4 = -\\frac{9}{5} - \\frac{784071}{80080} = \\frac{-144144 - 784071}{80080} = \\frac{-928215}{80080} \\approx -11.591$\n- $\\hat{\\psi}_5 = -\\frac{11}{7} - \\frac{784071}{80080} = \\frac{-125840 - 784071}{80080} = \\frac{-909911}{80080} \\approx -11.363$\n- $\\hat{\\psi}_6 = -\\frac{7}{8} - \\frac{784071}{80080} = \\frac{-70070 - 784071}{80080} = \\frac{-854141}{80080} \\approx -10.666$\n\n估计量的经验方差由 $\\phi_i$ 值的样本方差除以 $n$ 给出，可以从影响贡献中计算得出：\n$$\n\\widehat{\\text{Var}}(\\hat{\\tau}_{\\text{IPTW}}) = \\frac{1}{n(n-1)} \\sum_{i=1}^n \\hat{\\psi}_i^2\n$$\n计算影响贡献的平方和：\n$\\sum \\hat{\\psi}_i^2 \\approx (50.209)^2 + (-8.337)^2 + (-8.253)^2 + (-11.591)^2 + (-11.363)^2 + (-10.666)^2$\n$\\sum \\hat{\\psi}_i^2 \\approx 2520.94 + 69.51 + 68.11 + 134.35 + 129.12 + 113.76 \\approx 3035.79$\n方差为：\n$$\n\\widehat{\\text{Var}}(\\hat{\\tau}_{\\text{IPTW}}) = \\frac{3035.79}{6(5)} = \\frac{3035.79}{30} \\approx 101.193\n$$\n患者 1 的影响平方，$\\hat{\\psi}_1^2 \\approx 2520.94$，约占总平方和的 $2520.94 / 3035.79 \\approx 83\\%$，证实了估计量的方差绝大部分是由这单个有影响的观测值驱动的。",
            "answer": "$$\n\\boxed{\\frac{784071}{80080}}\n$$"
        },
        {
            "introduction": "对倾向性得分分析进行全面评估，需要的不仅仅是检查单个指标；它涉及对协变量平衡和权重分布的整体评估。这项综合练习将指导您构建一个决策算法，该算法整合了多个关键诊断指标，包括标准化均数差、方差比、有效样本量和重叠度。这种实践模拟了数据分析师的真实工作流程，教您如何综合各种证据来判断因果推断分析的质量。",
            "id": "5221137",
            "problem": "在医学领域的一项二元处理研究中，给定多个协变量的汇总统计量，包括应用倾向性得分调整前（未加权）和调整后（加权）的汇总。您的任务是构建一个程序，该程序为每个测试用例计算协变量平衡度量和权重诊断，然后从三个操作中做出决策：保留当前调整、重新估计倾向性得分函数 $e(X)$ 或切换到替代加权方案。所有计算和决策都必须仅使用所提供的汇总统计量来完成。\n\n使用一个有效的基础，包括：将倾向性得分 $e(X)$ 定义为在给定协变量的情况下接受处理的概率，协变量平衡可通过标准化均值差和方差比来评估的概念，以及利用权重计算有效样本量的二阶矩恒等式。您必须从这些定义出发来构建算法。\n\n为每个测试用例计算：\n- 对于每个协变量，使用带有合并标准差的标准定义计算调整后标准化均值差，以及作为组间方差之比的调整后方差比。\n- 权重诊断，包括使用二阶矩恒等式计算的有效样本量，基于前两个经验矩的权重变异系数，观测到的最大权重，以及一个基于处理组和控制组中估计的倾向性得分支撑集的简单重叠诊断。\n\n遵循以下原则和精确阈值做出决策：\n1) 当且仅当同时满足以下所有条件时，宣告平衡可接受（输出代码 $0$）：\n   - 对于所有协变量，标准化均值差的绝对值至多为 $0.1$。\n   - 对于所有协变量，调整后方差比位于闭区间 $\\left[0.5, 2.0\\right]$ 内。\n   - 权重诊断表明两组的加权情况均健康：每个组的有效样本量分数至少为 $0.5$，每个组的权重变异系数至多为 $2.0$，最大权重不超过 $20.0$，倾向性得分支撑集的重叠宽度至少为 $0.1$，并且每个组的倾向性得分范围严格位于区间 $\\left[0.01, 0.99\\right]$ 内（即，最小值至少为 $0.01$ 且最大值至多为 $0.99$）。\n2) 如果条件 (1) 因协变量不平衡（标准化均值差或方差比超出可接受范围）而未满足，但权重并非严重不稳定且重叠性不差，则建议重新估计 $e(X)$（输出代码 $1$）。\n3) 如果有证据表明存在严重的权重不稳定性或重叠性差，则建议采用替代加权策略，如重叠权重、权重截断或稳定性处理（输出代码 $2$）。具体而言，如果任一组中出现以下任一情况，则宣告为严重：有效样本量分数小于 $0.3$，权重变异系数超过 $3.0$，最大权重超过 $30.0$，重叠宽度小于 $0.05$，或倾向性得分范围超出 $\\left[0.01, 0.99\\right]$（即，最小值低于 $0.01$ 或最大值高于 $0.99$）。\n\n需从第一性原理实现的定义：\n- 协变量的标准化均值差使用两组的合并标准差来定义。\n- 方差比定义为处理组方差与控制组方差之比。\n- 一组非负权重的有效样本量使用基于权重之和与权重平方和的二阶矩恒等式，而变异系数使用权重的经验一阶矩和二阶矩。\n- 重叠宽度是处理组和控制组估计的倾向性得分两个支撑区间的交集长度。\n\n每个测试用例的输入按以下确切顺序以元组形式提供：\n- 调整前组别样本量：$n_T$，$n_C$。\n- 调整前处理组均值：一个数组 $\\mu_T^{pre}$。\n- 调整前控制组均值：一个数组 $\\mu_C^{pre}$。\n- 调整前处理组标准差：一个数组 $\\sigma_T^{pre}$。\n- 调整前控制组标准差：一个数组 $\\sigma_C^{pre}$。\n- 调整后处理组均值：一个数组 $\\mu_T^{post}$。\n- 调整后控制组均值：一个数组 $\\mu_C^{post}$。\n- 调整后处理组标准差：一个数组 $\\sigma_T^{post}$。\n- 调整后控制组标准差：一个数组 $\\sigma_C^{post}$。\n- 权重非零的单元计数：$m_T$，$m_C$。\n- 处理组的权重之和与权重平方和：$S_T$，$Q_T$。\n- 控制组的权重之和与权重平方和：$S_C$，$Q_C$。\n- 所有单元中的最大观测权重：$w_{\\max}$。\n- 处理组的倾向性得分支撑集：$p_{\\min,T}$，$p_{\\max,T}$。\n- 控制组的倾向性得分支撑集：$p_{\\min,C}$，$p_{\\max,C}$。\n\n您的程序必须精确实现上述计算和决策逻辑，并为提供的测试套件生成单行输出，其中包含一个用方括号括起的逗号分隔整数列表，每个整数按顺序对应一个测试用例，并且是如上定义的 $0$、$1$ 或 $2$ 之一。\n\n需要在程序中硬编码的测试套件：\n- 测试用例 $1$：\n  - $n_T = 500$，$n_C = 800$。\n  - $\\mu_T^{pre} = [65.0, 0.6, 1.5]$，$\\mu_C^{pre} = [62.0, 0.55, 1.4]$。\n  - $\\sigma_T^{pre} = [10.0, 0.49, 0.70]$，$\\sigma_C^{pre} = [11.0, 0.50, 0.80]$。\n  - $\\mu_T^{post} = [63.0, 0.58, 1.45]$，$\\mu_C^{post} = [63.1, 0.58, 1.46]$。\n  - $\\sigma_T^{post} = [10.5, 0.49, 0.74]$，$\\sigma_C^{post} = [10.6, 0.50, 0.75]$。\n  - $m_T = 500$，$m_C = 800$。\n  - $S_T = 500.0$，$Q_T = 556.0$，$S_C = 800.0$，$Q_C = 914.0$。\n  - $w_{\\max} = 4.0$。\n  - $p_{\\min,T} = 0.05$，$p_{\\max,T} = 0.95$，$p_{\\min,C} = 0.04$，$p_{\\max,C} = 0.96$。\n- 测试用例 $2$：\n  - $n_T = 400$，$n_C = 900$。\n  - $\\mu_T^{pre} = [69.0, 0.62, 1.6]$，$\\mu_C^{pre} = [66.0, 0.56, 1.45]$。\n  - $\\sigma_T^{pre} = [10.0, 0.50, 0.70]$，$\\sigma_C^{pre} = [12.0, 0.50, 0.80]$。\n  - $\\mu_T^{post} = [70.0, 0.60, 1.50]$，$\\mu_C^{post} = [68.0, 0.58, 1.40]$。\n  - $\\sigma_T^{post} = [9.0, 0.50, 0.60]$，$\\sigma_C^{post} = [11.0, 0.50, 0.60]$。\n  - $m_T = 400$，$m_C = 900$。\n  - $S_T = 400.0$，$Q_T = 571.4286$，$S_C = 900.0$，$Q_C = 1285.7143$。\n  - $w_{\\max} = 8.0$。\n  - $p_{\\min,T} = 0.08$，$p_{\\max,T} = 0.92$，$p_{\\min,C} = 0.07$，$p_{\\max,C} = 0.93$。\n- 测试用例 $3$：\n  - $n_T = 200$，$n_C = 1200$。\n  - $\\mu_T^{pre} = [66.0, 0.59, 1.52]$，$\\mu_C^{pre} = [63.5, 0.54, 1.42]$。\n  - $\\sigma_T^{pre} = [10.5, 0.48, 0.72]$，$\\sigma_C^{pre} = [11.2, 0.51, 0.82]$。\n  - $\\mu_T^{post} = [64.0, 0.57, 1.44]$，$\\mu_C^{post} = [64.05, 0.57, 1.45]$。\n  - $\\sigma_T^{post} = [11.0, 0.48, 0.70]$，$\\sigma_C^{post} = [10.8, 0.49, 0.71]$。\n  - $m_T = 200$，$m_C = 1200$。\n  - $S_T = 200.0$，$Q_T = 1000.0$，$S_C = 1200.0$，$Q_C = 4800.0$。\n  - $w_{\\max} = 50.0$。\n  - $p_{\\min,T} = 0.20$，$p_{\\max,T} = 0.95$，$p_{\\min,C} = 0.01$，$p_{\\max,C} = 0.50$。\n\n最终输出格式：您的程序应生成单行输出，其中包含测试用例的决策代码列表，格式为用方括号括起的逗号分隔列表，例如 $[0,1,2]$。条目必须是整数，且不得有空格。",
            "solution": "用户提供了一个因果推断领域的问题，具体涉及评估观察性研究中倾向性得分加权调整。任务是基于从汇总统计量中派生出的标准诊断度量，实现一个决策算法。该问题具有科学依据、问题明确且客观。它在定义“健康的”倾向性得分范围方面包含一个微小的模糊之处，但提供了一个澄清子句，我们将遵循该子句。\n\n解决方案首先从第一性原理定义必要的计算公式，然后阐明将计算出的诊断结果映射到三个建议操作之一的精确决策逻辑。\n\n### 1. 诊断度量公式\n\n令处理组表示为 $T$，控制组表示为 $C$。初始（调整前）样本量为 $n_T$ 和 $n_C$。权重非零的单元数量为 $m_T$ 和 $m_C$。对于给定的协变量 $k$，我们已知调整前的均值（$\\mu_{T,k}^{pre}$，$\\mu_{C,k}^{pre}$）和标准差（$\\sigma_{T,k}^{pre}$，$\\sigma_{C,k}^{pre}$），以及它们调整后的对应值（$\\mu_{T,k}^{post}$，$\\mu_{C,k}^{post}$，$\\sigma_{T,k}^{post}$，$\\sigma_{C,k}^{post}$）。\n\n**1.1. 协变量平衡度量**\n\n**标准化均值差 (SMD):** 协变量 $k$ 的调整后 SMD 衡量加权后两组之间的均值差异，并用合并标准差进行缩放。为了提供一个稳定且一致的比较尺度，合并标准差是根据调整前（未加权）的数据计算的。协变量 $k$ 的调整前合并标准差公式为：\n$$\n\\sigma_{p,k}^{pre} = \\sqrt{\\frac{(n_T - 1)(\\sigma_{T,k}^{pre})^2 + (n_C - 1)(\\sigma_{C,k}^{pre})^2}{n_T + n_C - 2}}\n$$\n调整后 SMD 则是调整后均值的绝对差，并用此值进行标准化：\n$$\n\\text{SMD}_k = \\frac{|\\mu_{T,k}^{post} - \\mu_{C,k}^{post}|}{\\sigma_{p,k}^{pre}}\n$$\n\n**方差比 (VR):** 协变量 $k$ 的调整后方差比评估分布二阶矩的平衡情况。它定义为处理组的调整后方差与控制组的调整后方差之比：\n$$\n\\text{VR}_k = \\frac{(\\sigma_{T,k}^{post})^2}{(\\sigma_{C,k}^{post})^2}\n$$\n\n**1.2. 权重与重叠诊断**\n\n令组 $g \\in \\{T, C\\}$ 的权重为 $\\{w_{g,i}\\}_{i=1}^{m_g}$。问题提供了权重之和 $S_g = \\sum_i w_{g,i}$ 和权重平方和 $Q_g = \\sum_i w_{g,i}^2$。\n\n**有效样本量 (ESS):** ESS 衡量加权样本中等效的独立观测数量，提供了因加权导致精度损失的指标。它使用二阶矩恒等式计算：\n$$\n\\text{ESS}_g = \\frac{(\\sum_i w_{g,i})^2}{\\sum_i w_{g,i}^2} = \\frac{S_g^2}{Q_g}\n$$\n决策规则中使用的诊断度量是 ESS 分数，即 ESS 相对于原始组别样本量 $n_g$ 的比例：\n$$\n\\text{ESS fraction}_g = \\frac{\\text{ESS}_g}{n_g}\n$$\n\n**权重变异系数 (CV):** 权重的 CV 衡量其变异性。高 CV 值表示存在少数非常大的权重，这可能导致不稳定的估计。CV 是权重标准差与其均值之比。平均权重为 $\\bar{w}_g = S_g / m_g$。权重的方差为 $\\sigma_{w,g}^2 = E[w^2] - (E[w])^2 = (Q_g / m_g) - (S_g / m_g)^2$。因此，CV 为：\n$$\n\\text{CV}_g = \\frac{\\sqrt{(Q_g / m_g) - (S_g / m_g)^2}}{S_g / m_g} = \\sqrt{\\frac{Q_g m_g}{S_g^2} - 1}\n$$\n\n**重叠宽度:** 此诊断评估处理组和控制组之间估计的倾向性得分 $e(X)$ 分布的重叠情况。给定处理组的倾向性得分支撑集为 $[p_{\\min,T}, p_{\\max,T}]$，控制组为 $[p_{\\min,C}, p_{\\max,C}]$，共同支撑集的区间为 $[\\max(p_{\\min,T}, p_{\\min,C}), \\min(p_{\\max,T}, p_{\\max,C})]$。重叠宽度是此区间的长度，如果没有重叠则为 $0$：\n$$\n\\text{Overlap Width} = \\max(0, \\min(p_{\\max,T}, p_{\\max,C}) - \\max(p_{\\min,T}, p_{\\min,C}))\n$$\n\n### 2. 决策算法\n\n通过依次检查对应于严重问题（代码 $2$）、可接受结果（代码 $0$）和中间问题（代码 $1$）的三组条件来做出决策。\n\n**步骤 1：检查严重不稳定性（代码 2）**\n如果存在以下任何严重问题，则标记该调整应使用替代加权策略：\n-   有效样本量：$\\text{ESS fraction}_T  0.3$ 或 $\\text{ESS fraction}_C  0.3$。\n-   权重变异性：$\\text{CV}_T  3.0$ 或 $\\text{CV}_C  3.0$。\n-   极端权重：所有单元中的最大权重 $w_{\\max}$ 超过 $30.0$。\n-   重叠性差：重叠宽度小于 $0.05$。\n-   实际正值假设违背：倾向性得分范围超出了区间 $[0.01, 0.99]$。即，$p_{\\min,T}  0.01$ 或 $p_{\\max,T}  0.99$ 或 $p_{\\min,C}  0.01$ 或 $p_{\\max,C}  0.99$。\n\n如果满足以上任何条件，决策为 **2**。\n\n**步骤 2：检查可接受的平衡（代码 0）**\n如果没有检测到严重的不稳定性，则检查调整是否可接受。当且仅当与平衡和权重健康相关的所有以下条件均得到满足时，该调整被视为可接受：\n-   协变量平衡：\n    -   均值平衡：对于所有协变量 $k$，$\\text{SMD}_k \\le 0.1$。\n    -   方差平衡：对于所有协变量 $k$，$0.5 \\le \\text{VR}_k \\le 2.0$。\n-   并且权重健康：\n    -   有效样本量：$\\text{ESS fraction}_T \\ge 0.5$ 且 $\\text{ESS fraction}_C \\ge 0.5$。\n    -   权重变异性：$\\text{CV}_T \\le 2.0$ 且 $\\text{CV}_C \\le 2.0$。\n    -   极端权重：$w_{\\max} \\le 20.0$。\n    -   足够的重叠：重叠宽度至少为 $0.1$。\n    -   倾向性得分范围：两个得分范围都位于 $[0.01, 0.99]$ 内。具体来说，对于两个组 $g \\in \\{T, C\\}$，都有 $p_{\\min,g} \\ge 0.01$ 且 $p_{\\max,g} \\le 0.99$。问题陈述在“严格位于”和澄清的 `i.e.` 子句之间存在矛盾；本解决方案遵循 `i.e.` 子句的说明（$p_{\\min} \\ge 0.01$ 且 $p_{\\max} \\le 0.99$）。\n\n如果所有这些条件都成立，决策为 **0**。\n\n**步骤 3：建议重新估计（代码 1）**\n如果调整没有表现出严重的不稳定性（步骤 1 失败），但也没有达到可接受性的标准（步骤 2 失败），则它属于中间类别。这种情况通常发生在协变量平衡未实现，但权重本身并未过度波动的情况下。在这种情况下，建议重新设定倾向性得分模型。决策为 **1**。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the propensity score evaluation problem for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        # Test case 1\n        (500, 800,  # n_T, n_C\n         np.array([65.0, 0.6, 1.5]), np.array([62.0, 0.55, 1.4]),  # mu_T_pre, mu_C_pre\n         np.array([10.0, 0.49, 0.70]), np.array([11.0, 0.50, 0.80]),  # sigma_T_pre, sigma_C_pre\n         np.array([63.0, 0.58, 1.45]), np.array([63.1, 0.58, 1.46]),  # mu_T_post, mu_C_post\n         np.array([10.5, 0.49, 0.74]), np.array([10.6, 0.50, 0.75]),  # sigma_T_post, sigma_C_post\n         500, 800,  # m_T, m_C\n         500.0, 556.0, 800.0, 914.0,  # S_T, Q_T, S_C, Q_C\n         4.0,  # w_max\n         0.05, 0.95, 0.04, 0.96),  # p_min_T, p_max_T, p_min_C, p_max_C\n        # Test case 2\n        (400, 900,\n         np.array([69.0, 0.62, 1.6]), np.array([66.0, 0.56, 1.45]),\n         np.array([10.0, 0.50, 0.70]), np.array([12.0, 0.50, 0.80]),\n         np.array([70.0, 0.60, 1.50]), np.array([68.0, 0.58, 1.40]),\n         np.array([9.0, 0.50, 0.60]), np.array([11.0, 0.50, 0.60]),\n         400, 900,\n         400.0, 571.4286, 900.0, 1285.7143,\n         8.0,\n         0.08, 0.92, 0.07, 0.93),\n        # Test case 3\n        (200, 1200,\n         np.array([66.0, 0.59, 1.52]), np.array([63.5, 0.54, 1.42]),\n         np.array([10.5, 0.48, 0.72]), np.array([11.2, 0.51, 0.82]),\n         np.array([64.0, 0.57, 1.44]), np.array([64.05, 0.57, 1.45]),\n         np.array([11.0, 0.48, 0.70]), np.array([10.8, 0.49, 0.71]),\n         200, 1200,\n         200.0, 1000.0, 1200.0, 4800.0,\n         50.0,\n         0.20, 0.95, 0.01, 0.50)\n    ]\n\n    results = []\n    for case in test_cases:\n        decision = analyze_adjustment(*case)\n        results.append(decision)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef analyze_adjustment(n_T, n_C, mu_T_pre, mu_C_pre, sigma_T_pre, sigma_C_pre,\n                         mu_T_post, mu_C_post, sigma_T_post, sigma_C_post,\n                         m_T, m_C, S_T, Q_T, S_C, Q_C, w_max,\n                         p_min_T, p_max_T, p_min_C, p_max_C):\n    \"\"\"\n    Computes diagnostics and returns a decision code (0, 1, or 2).\n    \"\"\"\n    \n    # 1. Compute Covariate Balance Metrics\n    var_T_pre = sigma_T_pre**2\n    var_C_pre = sigma_C_pre**2\n    pooled_sd_pre = np.sqrt(((n_T - 1) * var_T_pre + (n_C - 1) * var_C_pre) / (n_T + n_C - 2))\n    \n    smds = np.abs(mu_T_post - mu_C_post) / pooled_sd_pre\n    \n    var_T_post = sigma_T_post**2\n    var_C_post = sigma_C_post**2\n    vrs = var_T_post / var_C_post\n\n    # 2. Compute Weight and Overlap Diagnostics\n    ess_T = S_T**2 / Q_T if Q_T  0 else 0\n    ess_C = S_C**2 / Q_C if Q_C  0 else 0\n    ess_frac_T = ess_T / n_T\n    ess_frac_C = ess_C / n_C\n    \n    cv_T = np.sqrt((Q_T * m_T / S_T**2) - 1) if S_T  0 else float('inf')\n    cv_C = np.sqrt((Q_C * m_C / S_C**2) - 1) if S_C  0 else float('inf')\n    \n    overlap_min = max(p_min_T, p_min_C)\n    overlap_max = min(p_max_T, p_max_C)\n    overlap_width = max(0, overlap_max - overlap_min)\n    \n    # 3. Apply Decision Logic\n    # Check for severe instability (Code 2)\n    severe_instability = (\n        ess_frac_T  0.3 or ess_frac_C  0.3 or\n        cv_T  3.0 or cv_C  3.0 or\n        w_max  30.0 or\n        overlap_width  0.05 or\n        p_min_T  0.01 or p_max_T  0.99 or\n        p_min_C  0.01 or p_max_C  0.99\n    )\n    if severe_instability:\n        return 2\n        \n    # Check for acceptable balance (Code 0)\n    balance_ok = np.all(smds = 0.1) and np.all(vrs = 0.5) and np.all(vrs = 2.0)\n    \n    weights_healthy = (\n        ess_frac_T = 0.5 and ess_frac_C = 0.5 and\n        cv_T = 2.0 and cv_C = 2.0 and\n        w_max = 20.0 and\n        overlap_width = 0.1 and\n        p_min_T = 0.01 and p_max_T = 0.99 and\n        p_min_C = 0.01 and p_max_C = 0.99\n    )\n\n    if balance_ok and weights_healthy:\n        return 0\n    \n    # Otherwise, recommend re-estimation (Code 1)\n    return 1\n\nsolve()\n```"
        }
    ]
}