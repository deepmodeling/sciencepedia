{
    "hands_on_practices": [
        {
            "introduction": "在进行任何优化之前，我们必须能将一个代谢网络精确地转化为数学形式。本练习将带您回归最基础的步骤：学习如何将一组化学反应翻译成化学计量矩阵 $S$ 。这个矩阵是任何通量平衡分析（FBA）模型的基石，通过此练习，您将深入理解模型构建的基本逻辑，并接触到定义了所有可能稳态通量解空间的 $S$ 矩阵零空间的概念。",
            "id": "4565034",
            "problem": "考虑一个用于流平衡分析（FBA）的最小内部代谢网络，该网络恰好由三种内部代谢物 $A$、$B$ 和 $C$ 以及四个反应 $R_{1}$ 到 $R_{4}$ 组成。您必须使用的基本原理是稳态质量平衡原理（物质守恒），在FBA中，这等同于陈述：当系统处于稳态时，每种代谢物的净生成速率为零。在这个示例网络中，物质守恒被建模为追踪基团数的守恒。具体来说，假设 $A$、$B$ 和 $C$ 分别携带 $1$、$2$ 和 $3$ 个单位的守恒原子基团，并假设只有该基团被追踪。这四个反应被定义为相对于该守恒基团的化学平衡变换：\n- $R_{1}$: $A + A \\rightarrow B$，\n- $R_{2}$: $A + B \\rightarrow C$，\n- $R_{3}$: $C \\rightarrow A + B$，\n- $R_{4}$: $\\varnothing \\rightarrow A$（一个输入交换反应，将 $A$ 从环境输入系统；$\\varnothing$ 表示环境，不是内部代谢物）。\n\n根据标准的化学计量符号约定，底物被赋予负的化学计量系数，产物被赋予正的化学计量系数。设化学计量矩阵 $S$ 是一个 $3 \\times 4$ 的矩阵，其行序为 $(A,B,C)$，列序为 $(R_{1},R_{2},R_{3},R_{4})$，其中元素 $S_{i j}$ 等于代谢物 $i$ 在反应 $j$ 中的化学计量系数。\n\n任务：\n1. 通过书写并平衡上述化学方程式，从第一性原理的质量平衡出发，推导出所有化学计量系数，并构建化学计量矩阵 $S$。\n2. 使用通量向量 $v \\in \\mathbb{R}^{4}$ 的稳态质量平衡方程 $S v = 0$，确定可行稳态通量空间的维度，该空间定义为 $S$ 的零空间，忽略任何边界或不可逆性约束。\n\n将维度报告为单个整数，不带单位。无需四舍五入。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 步骤1：提取给定条件\n- **代谢物**：$A$、$B$、$C$。\n- **反应**：$R_{1}$、$R_{2}$、$R_{3}$、$R_{4}$。\n- **守恒基团数**：$A$ 携带 $1$ 个单位，$B$ 携带 $2$ 个单位，$C$ 携带 $3$ 个单位。\n- **反应定义**：\n  - $R_{1}$: $A + A \\rightarrow B$\n  - $R_{2}$: $A + B \\rightarrow C$\n  - $R_{3}$: $C \\rightarrow A + B$\n  - $R_{4}$: $\\varnothing \\rightarrow A$ (输入交换)\n- **化学计量矩阵定义**：$S$ 是一个 $3 \\times 4$ 矩阵。行序为 $(A, B, C)$。列序为 $(R_{1}, R_{2}, R_{3}, R_{4})$。元素 $S_{i j}$ 是代谢物 $i$ 在反应 $j$ 中的化学计量系数。底物具有负系数，产物具有正系数。\n- **基本原理**：稳态质量平衡，$S v = 0$，其中 $v$ 是通量向量。\n- **任务**：\n  1. 构建化学计量矩阵 $S$。\n  2. 确定可行稳态通量空间的维度，即 $S$ 的零空间的维度。\n\n### 步骤2：使用提取的给定条件进行验证\n- **具有科学依据**：该问题是流平衡分析（FBA）的一个标准（尽管简化了）的应用，FBA是系统生物学和生物信息学的核心方法。它正确地使用了化学计量矩阵、稳态质量平衡（$S v = 0$）和零空间分析等概念。所提供的反应也已确认相对于定义的守恒基团数是平衡的，这确保了内部一致性。\n- **适定的**：该问题要求推导一个矩阵并计算其零空间的维度。这是一个定义明确的数学任务，具有唯一的整数解。\n- **客观的**：该问题以精确的技术语言陈述，没有主观或模糊的术语。\n- **完整且一致**：构建矩阵 $S$ 和执行线性代数所需的所有信息均已提供。没有矛盾之处。\n\n### 步骤3：结论与行动\n问题是有效的。将提供完整的解答。\n\n### 解答推导\n\n第一步是根据给定的四个反应构建 $3 \\times 4$ 的化学计量矩阵 $S$。行对应于代谢物 $(A, B, C)$，列对应于反应 $(R_{1}, R_{2}, R_{3}, R_{4})$。标准约定是，反应的底物具有负的化学计量系数，而产物具有正的化学计量系数。\n\n1.  **反应 $R_{1}$: $A + A \\rightarrow B$ 或 $2A \\rightarrow B$**\n    - 代谢物 $A$ 是底物，化学计量为 $2$。系数 $S_{11} = -2$。\n    - 代谢物 $B$ 是产物，化学计量为 $1$。系数 $S_{21} = +1$。\n    - 代谢物 $C$ 不参与反应。系数 $S_{31} = 0$。\n    $S$ 的第一列是 $\\begin{pmatrix} -2 \\\\ 1 \\\\ 0 \\end{pmatrix}$。\n\n2.  **反应 $R_{2}$: $A + B \\rightarrow C$**\n    - 代谢物 $A$ 是底物，化学计量为 $1$。系数 $S_{12} = -1$。\n    - 代谢物 $B$ 是底物，化学计量为 $1$。系数 $S_{22} = -1$。\n    - 代谢物 $C$ 是产物，化学计量为 $1$。系数 $S_{32} = +1$。\n    $S$ 的第二列是 $\\begin{pmatrix} -1 \\\\ -1 \\\\ 1 \\end{pmatrix}$。\n\n3.  **反应 $R_{3}$: $C \\rightarrow A + B$**\n    - 代谢物 $A$ 是产物，化学计量为 $1$。系数 $S_{13} = +1$。\n    - 代谢物 $B$ 是产物，化学计量为 $1$。系数 $S_{23} = +1$。\n    - 代谢物 $C$ 是底物，化学计量为 $1$。系数 $S_{33} = -1$。\n    $S$ 的第三列是 $\\begin{pmatrix} 1 \\\\ 1 \\\\ -1 \\end{pmatrix}$。注意，该反应是 $R_{2}$ 的逆反应，因此其化学计量向量是 $R_{2}$ 向量的负数。\n\n4.  **反应 $R_{4}$: $\\varnothing \\rightarrow A$**\n    - 这是一个输入通量，因此从内部系统的角度来看，代谢物 $A$ 是被生成的。\n    - 代谢物 $A$ 是产物，化学计量为 $1$。系数 $S_{14} = +1$。\n    - 代谢物 $B$ 和 $C$ 不参与反应。系数 $S_{24} = 0$ 和 $S_{34} = 0$。\n    $S$ 的第四列是 $\\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n\n组合这些列得到完整的化学计量矩阵 $S$：\n$$ S = \\begin{pmatrix} -2  -1  1  1 \\\\ 1  -1  1  0 \\\\ 0  1  -1  0 \\end{pmatrix} $$\n\n任务的第二部分是确定可行稳态通量空间的维度。在稳态下，每种内部代谢物的净生成量为零。这由线性系统 $S v = 0$ 表示，其中 $v = (v_1, v_2, v_3, v_4)^T$ 是通过反应 $R_1$到$R_4$的通量向量。满足该方程的所有向量 $v$ 的集合构成了矩阵 $S$ 的零空间，记为 $\\text{Null}(S)$。该空间的维度 $\\dim(\\text{Null}(S))$ 是张成该空间的线性无关基向量的数量。\n\n根据秩-零度定理，对于一个有 $n$ 列的矩阵 $S$：\n$$ \\text{rank}(S) + \\dim(\\text{Null}(S)) = n $$\n在我们的例子中，$S$ 是一个 $3 \\times 4$ 矩阵，所以 $n=4$。因此：\n$$ \\dim(\\text{Null}(S)) = 4 - \\text{rank}(S) $$\n我们必须求出 $S$ 的秩，即线性无关的行（或列）的数量。这可以通过应用高斯消元法将 $S$ 简化为其行阶梯形来确定。\n\n从 $S$ 开始：\n$$ S = \\begin{pmatrix} -2  -1  1  1 \\\\ 1  -1  1  0 \\\\ 0  1  -1  0 \\end{pmatrix} $$\n交换第1行和第2行 ($R_1 \\leftrightarrow R_2$):\n$$ \\begin{pmatrix} 1  -1  1  0 \\\\ -2  -1  1  1 \\\\ 0  1  -1  0 \\end{pmatrix} $$\n将第1行的2倍加到第2行 ($R_2 \\rightarrow R_2 + 2R_1$):\n$$ \\begin{pmatrix} 1  -1  1  0 \\\\ 0  -3  3  1 \\\\ 0  1  -1  0 \\end{pmatrix} $$\n交换第2行和第3行 ($R_2 \\leftrightarrow R_3$):\n$$ \\begin{pmatrix} 1  -1  1  0 \\\\ 0  1  -1  0 \\\\ 0  -3  3  1 \\end{pmatrix} $$\n将第2行的3倍加到第3行 ($R_3 \\rightarrow R_3 + 3R_2$):\n$$ \\begin{pmatrix} 1  -1  1  0 \\\\ 0  1  -1  0 \\\\ 0  0  0  1 \\end{pmatrix} $$\n该矩阵是行阶梯形。它有三个非零行，每行都包含一个主元（首个非零元素）。主元的数量等于矩阵的秩。\n因此，$\\text{rank}(S) = 3$。\n\n现在，我们可以计算零空间的维度：\n$$ \\dim(\\text{Null}(S)) = 4 - \\text{rank}(S) = 4 - 3 = 1 $$\n可行稳态通量空间的维度是 $1$。这意味着该网络所有可能的稳态通量分布都可以用一个自由参数来描述。例如，从行阶梯形得到的方程组是 $v_1-v_2+v_3=0$，$v_2-v_3=0$ 和 $v_4=0$。解得 $v_4=0$，$v_2=v_3$ 和 $v_1=0$。解向量为 $v = (0, t, t, 0)^T$，其中 $t$ 为任意标量，这是一个由基向量 $(0, 1, 1, 0)^T$ 张成的一维空间。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "构建模型后，FBA 利用线性规划来寻找最优的通量分布。本练习旨在通过一个可通过基本推理或手工计算解决的极简 FBA 问题，来揭开优化过程的神秘面纱 。通过分析约束条件和目标函数，您将直观地理解最优解是如何在可行通量空间的“角落”被找到的，从而对 LP 求解器的内部工作建立起扎实的直觉。",
            "id": "4564999",
            "problem": "考虑一个通过通量平衡分析（FBA）研究的简单代谢网络，其中稳态假设通过化学计量矩阵强制实现质量守恒。该网络包含两种内部代谢物（记为 $A$ 和 $B$）和三个反应：\n- 反应 $R_{1}$（摄取）：$A$ 由外部来源产生。\n- 反应 $R_{2}$（转化）：$A$ 转化为 $B$。\n- 反应 $R_{3}$（生物质合成）：$B$ 转化为生物质。\n\n设化学计量矩阵 $S \\in \\mathbb{R}^{2 \\times 3}$ 为\n$$\nS \\;=\\; \\begin{pmatrix}\n1  -1  0 \\\\\n0  \\phantom{-}1  -1\n\\end{pmatrix},\n$$\n其通量向量为 $v = (v_{1}, v_{2}, v_{3})^{\\top}$。稳态质量平衡为 $S v = 0$，即：\n$$\nv_{1} - v_{2} \\;=\\; 0, \\quad v_{2} - v_{3} \\;=\\; 0.\n$$\n假设以下通量边界，这些边界反映了生物物理上合理的容量限制：\n$$\n0 \\;\\le\\; v_{1} \\;\\le\\; 6, \\qquad 0 \\;\\le\\; v_{2}, \\qquad 0 \\;\\le\\; v_{3} \\;\\le\\; 2.\n$$\n建立相关的线性规划（LP）问题以最大化生物质产量，其目标是最大化生物质反应通量 $v_{3}$。使用单纯形法从第一性原理出发求解此LP问题，从稳态约束和通量边界开始，不使用任何快捷公式。明确构建适用于单纯形法的标准形式LP，确定一个可行基，并通过单纯形枢轴变换或角点分析论证为何在此处达到最优解。报告最优目标值和最优通量向量 $v^{\\star}$。\n\n最终目标值和所有通量以 $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$ 为单位表示。无需四舍五入；请提供精确值。你最终报告的答案必须是一个单行矩阵，按顺序包含最优目标值、$v_{1}^{\\star}$、$v_{2}^{\\star}$ 和 $v_{3}^{\\star}$，正如该LP问题的单纯形解所要求的那样。",
            "solution": "用户提供了一个关于代谢网络通量平衡分析（FBA）领域的问题。我将首先根据指定标准验证问题陈述，如果问题被认为是有效的，则继续进行求解。\n\n### 第1步：提取已知条件\n- **化学计量矩阵（$S$）**：\n$$\nS \\;=\\; \\begin{pmatrix}\n1  -1  0 \\\\\n0  \\phantom{-}1  -1\n\\end{pmatrix}\n$$\n- **通量向量（$v$）**：$v = (v_{1}, v_{2}, v_{3})^{\\top}$\n- **稳态质量平衡约束**：$S v = 0$，可转化为以下线性方程组：\n  1. $v_{1} - v_{2} = 0$\n  2. $v_{2} - v_{3} = 0$\n- **通量边界（不等式约束）**：\n  1. $0 \\le v_{1} \\le 6$\n  2. $v_{2} \\ge 0$\n  3. $0 \\le v_{3} \\le 2$\n- **目标函数**：最大化生物质反应通量，$Z = v_{3}$。\n\n### 第2步：使用提取的已知条件进行验证\n根据验证标准对问题进行评估：\n- **科学性**：该问题是通量平衡分析（Flux Balance Analysis）的一个经典范例，这是系统生物学和生物信息学中一个公认的基础方法。化学计量矩阵的使用、稳态假设（$Sv=0$）、通量边界以及线性目标函数都是此方法论中标准且科学严谨的组成部分。\n- **适定性**：该问题被表述为一个线性规划（LP）问题：在一组线性等式和不等式约束下最大化一个线性目标函数。由这些约束定义的可行域是一个凸多胞体，并且线性规划理论保证最优解存在于其至少一个顶点上。该问题是适定的。\n- **客观性**：问题陈述使用了精确的数学语言和符号，没有歧义或主观声明。\n- **不完整或矛盾的设定**：问题是自洽的。所有必要信息（矩阵 $S$、所有约束和目标函数）都已提供。约束条件相互一致。例如，$v_1$ 和 $v_3$ 的非负性是明确给出的，而 $v_2$ 的非负性可以从 $v_1=v_2$ 和 $v_1 \\ge 0$ 推断得出。\n- **不切实际或不可行**：通量边界的数值对于一个模型问题是合理的，不代表任何物理上的不可能性。\n- **病态或结构不良**：该问题是一个标准的、结构良好的LP表述。\n- **伪深刻或过于简单**：虽然网络很简单，但解决该问题需要正确应用LP原理，无论是通过几何解释（角点分析）还是算法途径（单纯形法）。这是一个有效的练习，并非小事一桩。\n- **超出科学可验证范围**：该解是数学上可验证的。\n\n### 第3步：结论与行动\n问题是有效的。我现在开始求解。\n\n### 求解推导\n目标是解决以下线性规划问题：\n最大化 $Z = v_{3}$\n约束条件为：\n1. $v_{1} - v_{2} = 0$\n2. $v_{2} - v_{3} = 0$\n3. $v_{1} \\le 6$\n4. $v_{3} \\le 2$\n5. $v_{1} \\ge 0$\n6. $v_{2} \\ge 0$\n7. $v_{3} \\ge 0$\n\n首先，我们简化约束条件。根据稳态方程：\n- $v_{1} - v_{2} = 0 \\implies v_{1} = v_{2}$\n- $v_{2} - v_{3} = 0 \\implies v_{2} = v_{3}$\n\n结合这些方程，我们发现所有三个通量必须相等：\n$v_{1} = v_{2} = v_{3}$\n\n我们定义一个单一变量 $v$，使得 $v = v_{1} = v_{2} = v_{3}$。现在，这个LP问题可以用这个单一变量 $v$ 来重新表述。\n目标变为：最大化 $Z = v$。\n关于 $v_{1}$、$v_{2}$ 和 $v_{3}$ 的约束合并为：\n- 由 $0 \\le v_{1} \\le 6$，我们得到 $0 \\le v \\le 6$。\n- 由 $v_{2} \\ge 0$，我们得到 $v \\ge 0$。\n- 由 $0 \\le v_{3} \\le 2$，我们得到 $0 \\le v \\le 2$。\n\n为了同时满足所有这些约束，我们必须找到 $v$ 的可行域的交集。区间 $[0, 6]$ 和 $[0, 2]$ 的交集是 $[0, 2]$。因此，简化后的问题是：\n最大化 $Z = v$\n约束条件为：\n$0 \\le v \\le 2$\n\n这是一个简单的优化问题。满足约束 $0 \\le v \\le 2$ 的 $v$ 的最大值显然是 $v = 2$。\n\n这个结果可以通过允许的“角点分析”方法得到。$v$ 的可行域是区间 $[0, 2]$。这个一维多胞体的角点是 $v=0$ 和 $v=2$。在这些点上计算目标函数 $Z=v$ 的值，分别得到 $Z=0$ 和 $Z=2$。最大值是 $Z=2$，在 $v=2$ 时取得。\n\n为了按要求使用单纯形法正式求解，我们首先将简化后的问题转化为标准形式。标准形式要求变量非负且约束为等式。\n设 $v$ 为我们的决策变量。约束 $v \\le 2$ 通过引入一个非负松弛变量 $s$ 转化为等式：\n$v + s = 2$，其中 $v \\ge 0, s \\ge 0$。\n约束 $v \\le 6$ 是冗余的，因为任何满足 $v \\le 2$ 的解都自动满足 $v \\le 6$。\n标准形式的LP为：\n最大化 $Z = v$\n约束条件为：\n$v + s = 2$\n$v \\ge 0, s \\ge 0$\n\n我们可以将目标函数写为 $Z - v = 0$。构造初始单纯形表。我们可以选择一个初始基本可行解。在这里，我们可以让松弛变量 $s$ 作为基变量，$v$ 作为非基变量。令 $v=0$ 得到 $s=2$，这是一个有效的基本可行解。\n\n初始单纯形表为：\n$$\n\\begin{array}{c|c|ccc|c}\n\\text{基}  Z  v  s  \\text{右端项} \\\\\n\\hline\nZ  1  -1  0  0 \\\\\ns  0  \\phantom{-}1  1  2 \\\\\n\\end{array}\n$$\n目标函数行（$Z$行）中非基变量 $v$ 的系数为负（$-1$）。这表明将 $v$ 引入基可以增加目标函数的值。变量 $v$ 是进基变量。\n\n为了确定离基变量，我们进行比率测试。我们将右端项（RHS）的值除以主元列（$v$列）中对应的正项：\n- 对于 $s$ 行：$2 / 1 = 2$。\n只有一行，所以变量 $s$ 必须是离基变量。主元是位于 $s$ 行和 $v$ 列交点处的元素 $1$。\n\n我们执行枢轴变换操作，使主元列成为一个单位向量。新的 $v$ 行就是旧的 $s$ 行（因为主元已经是1）。新的 $Z$ 行通过 `(旧Z行) - (-1) * (新v行)` 计算得出。\n新 $Z$ 行 = `[1, -1, 0, 0] + [0, 1, 1, 2] = [1, 0, 1, 2]`\n\n新的单纯形表为：\n$$\n\\begin{array}{c|c|ccc|c}\n\\text{基}  Z  v  s  \\text{右端项} \\\\\n\\hline\nZ  1  0  1  2 \\\\\nv  0  1  1  2 \\\\\n\\end{array}\n$$\n$Z$行中非基变量（本例中只有 $s$）的系数均为非负（$\\ge 0$）。满足最优性条件。已找到最优解。\n\n从最终的单纯形表中，我们读出解：\n- 最优目标值为 $Z^{\\star} = 2$。\n- 基变量为 $v = 2$。\n- 非基变量为 $s = 0$。\n\n由于我们已经确定 $v_{1} = v_{2} = v_{3} = v$，最优通量向量 $v^{\\star} = (v_{1}^{\\star}, v_{2}^{\\star}, v_{3}^{\\star})^{\\top}$ 为：\n- $v_{1}^{\\star} = 2$\n- $v_{2}^{\\star} = 2$\n- $v_{3}^{\\star} = 2$\n\n最优目标值为 $Z^{\\star} = v_{3}^{\\star} = 2$。如问题背景所述，通量和目标值的单位是 $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$。\n\n最终答案要求一个行矩阵，包含最优目标值，后跟最优通量 $v_{1}^{\\star}$、$v_{2}^{\\star}$ 和 $v_{3}^{\\star}$。这对应于 $(Z^{\\star}, v_{1}^{\\star}, v_{2}^{\\star}, v_{3}^{\\star})$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2  2  2  2 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "本练习将展示 FBA 最强大的应用之一：预测基因改造对细胞表型的影响 。您将通过编程实现基因-蛋白质-反应（GPR）规则，来模拟单基因和双基因敲除，并计算其对生长速率的影响。最终，您将能够识别出“合成致死”的基因对——这是药物研发和理解系统遗传鲁棒性的一个核心概念，从而实现从抽象模型到具体生物学洞见的跨越。",
            "id": "4565011",
            "problem": "考虑一个使用稳态流量平衡分析 (FBA) 进行分析的玩具代谢网络。该网络有五种内部代谢物和九个反应。设代谢物为 $G$ (内部葡萄糖)、$A$、$B$、$P$ 和 $ATP$。设反应通量向量为 $v \\in \\mathbb{R}^9$，其索引如下：\n- $v_1$: 摄取，$\\rightarrow G$\n- $v_2$: 糖酵解，$G \\rightarrow A + ATP$\n- $v_3$: 替代转化，$G \\rightarrow B$\n- $v_4$: $A \\rightarrow P$\n- $v_5$: $B \\rightarrow P$\n- $v_6$: 生物质合成，$P \\rightarrow$ biomass\n- $v_7$: ATP合成，$\\rightarrow ATP$\n- $v_8$: (有意省略的索引；此模型中不存在反应 $v_8$)\n- $v_9$: 非生长相关ATP维持，$ATP \\rightarrow$\n\n内部代谢物在稳态下的化学计量平衡方程由线性系统 $S v = 0$ 给出，其中化学计量系数为：\n- 对于 $G$：$v_1$ 中为 $+1$，$v_2$ 中为 $-1$，$v_3$ 中为 $-1$。\n- 对于 $A$：$v_2$ 中为 $+1$，$v_4$ 中为 $-1$。\n- 对于 $B$：$v_3$ 中为 $+1$，$v_5$ 中为 $-1$。\n- 对于 $P$：$v_4$ 中为 $+1$，$v_5$ 中为 $+1$，$v_6$ 中为 $-1$。\n- 对于 $ATP$：$v_2$ 中为 $+1$，$v_7$ 中为 $+1$，$v_9$ 中为 $-1$。\n\n每个反应通量 $v_j$ 都有边界 $l_j \\le v_j \\le u_j$，这些边界反映了热力学和容量限制：\n- $v_1$: $0 \\le v_1 \\le 10$ (摄取能力有限)\n- $v_2$: $0 \\le v_2 \\le 1000$\n- $v_3$: $0 \\le v_3 \\le 1000$\n- $v_4$: $0 \\le v_4 \\le 1000$\n- $v_5$: $0 \\le v_5 \\le 1000$\n- $v_6$: $0 \\le v_6 \\le 1000$\n- $v_7$: $0 \\le v_7 \\le 1000$\n- $v_9$: $1 \\le v_9 \\le 1000$ (维持需求由下界强制执行)\n所有未列出的反应边界都应被视为不存在的反应（此模型中不存在 $v_8$）。\n\nFBA 的目标是最大化生物物质生产通量 $v_6$。形式上，该优化问题为：\n$$\n\\max_{v \\in \\mathbb{R}^9} \\quad c^\\top v \\quad \\text{约束条件为} \\quad S v = 0, \\quad l \\le v \\le u,\n$$\n其中 $c \\in \\mathbb{R}^9$ 满足 $c_6 = 1$ 且对于所有 $j \\neq 6$ 都有 $c_j = 0$。所有通量均以 $1/\\mathrm{h}$ 为单位表示，计算出的最优生长速率也必须以 $1/\\mathrm{h}$ 为单位表示。\n\n基因删除通过基因-蛋白质-反应 (GPR) 规则影响反应的可行性。一个反应是激活的，当且仅当其 GPR 规则对于未被删除的基因集合评估为真；否则，其通量边界将被设置为 $l_j = u_j = 0$。各反应的 GPR 规则如下：\n- $v_1$: $gT1 \\lor gT2$\n- $v_2$: $gGLY$\n- $v_3$: $gALT1 \\lor gALT2$\n- $v_4$: $gA2P1 \\land gA2P2$\n- $v_5$: $gB2P$\n- $v_6$: 无关联基因 (始终激活)\n- $v_7$: $gATPa \\land gATPb$\n- $v_9$: 无关联基因 (始终激活)\n\n您必须实现一个程序，该程序能够：\n1. 按规定构建化学计量矩阵 $S$、边界 $l$ 和 $u$ 以及目标向量 $c$。\n2. 通过评估 GPR 规则来应用单基因和双基因删除，并将任何在删除集下其 GPR 规则不被满足的反应的边界设置为零。\n3. 对每种情景求解上述线性规划问题，以获得最优生长速率 $v_6^\\star$ (单位为 $1/\\mathrm{h}$)。如果线性规划不可行，则定义生长速率 $v_6^\\star = 0$。\n4. 按如下方式确定基因对的合成致死性：一对 $\\{g_a, g_b\\}$ 表现出合成致死性，当且仅当双基因删除下的最优生长速率 $\\le \\tau$，而每个单基因删除下的最优生长速率均 $> \\tau$，容差 $\\tau = 10^{-9}$。\n\n使用以下测试套件：\n- 待评估的单基因删除：$[gGLY, gA2P2, gB2P, gATPa, gX]$，其中 $gX$ 是一个未出现在任何 GPR 规则中的基因。\n- 待评估的双基因删除：$[(gA2P1, gB2P), (gT1, gT2), (gATPa, gATPb), (gGLY, gGLY), (gX, gB2P), (gGLY, gATPa)]$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，其结构如下：\n- 第一个元素是无删除时的基线最优生长速率（一个以 $1/\\mathrm{h}$ 为单位的浮点数）。\n- 第二个元素是一个浮点数列表，按相同顺序给出指定单基因删除下的最优生长速率（单位为 $1/\\mathrm{h}$）。\n- 第三个元素是一个浮点数列表，按相同顺序给出指定双基因删除下的最优生长速率（单位为 $1/\\mathrm{h}$）。\n- 第四个元素是一个布尔值列表，按相同顺序给出指定双基因删除的合成致死性标志。\n\n因此，最终输出必须采用以下精确格式：\n$$\n[\\text{baseline},[\\text{single\\_1},\\dots,\\text{single\\_n}],[\\text{double\\_1},\\dots,\\text{double\\_m}],[\\text{SL\\_1},\\dots,\\text{SL\\_m}]]\n$$\n所有浮点数单位为 $1/\\mathrm{h}$，布尔值为 true 或 false。",
            "solution": "用户提供了一个定义明确的玩具代谢网络的流量平衡分析 (FBA) 问题，并要求编写一个程序来计算各种基因删除情景下的最优生长速率，包括合成致死性分析。\n\n### 步骤 1：提取已知条件\n\n- **代谢物**：$G$, $A$, $B$, $P$, $ATP$。\n- **反应和化学计量**：\n    - 指定了一个通量向量 $v \\in \\mathbb{R}^9$，其中 $v_8$ 是一个有意省略的反应。对于系统 $S v = 0$，化学计量矩阵 $S$ 中的非零项为：\n    - $G$: $v_1 - v_2 - v_3 = 0$\n    - $A$: $v_2 - v_4 = 0$\n    - $B$: $v_3 - v_5 = 0$\n    - $P$: $v_4 + v_5 - v_6 = 0$\n    - $ATP$: $v_2 + v_7 - v_9 = 0$\n- **通量边界 ($l \\le v \\le u$)**：\n    - $v_1$: $[0, 10]$\n    - $v_2$: $[0, 1000]$\n    - $v_3$: $[0, 1000]$\n    - $v_4$: $[0, 1000]$\n    - $v_5$: $[0, 1000]$\n    - $v_6$: $[0, 1000]$\n    - $v_7$: $[0, 1000]$\n    - $v_8$: 由于它是一个被省略的反应，因此隐式地为 $[0, 0]$。\n    - $v_9$: $[1, 1000]$\n- **目标函数**：最大化 $v_6$。这对应一个目标向量 $c$，其中 $c_6 = 1$ 且所有其他 $c_j = 0$。\n- **基因-蛋白质-反应 (GPR) 规则**：如果一个反应的 GPR 规则评估为假，则其通量设置为 $0$。\n    - $v_1$: $gT1 \\lor gT2$\n    - $v_2$: $gGLY$\n    - $v_3$: $gALT1 \\lor gALT2$\n    - $v_4$: $gA2P1 \\land gA2P2$\n    - $v_5$: $gB2P$\n    - $v_6$: 无关联基因\n    - $v_7$: $gATPa \\land gATPb$\n    - $v_9$: 无关联基因\n- **不可行条件**：如果线性规划不可行，最优生长速率 $v_6^\\star$ 定义为 $0$。\n- **合成致死性 (SL)**：一对基因 $\\{g_a, g_b\\}$ 是合成致死的，如果双基因删除下的生长速率 $\\le \\tau$，而每个单基因删除下的生长速率均 $> \\tau$，其中 $\\tau = 10^{-9}$。\n- **测试套件**：\n    - 单基因删除：$[gGLY, gA2P2, gB2P, gATPa, gX]$\n    - 双基因删除：$[(gA2P1, gB2P), (gT1, gT2), (gATPa, gATPb), (gGLY, gGLY), (gX, gB2P), (gGLY, gATPa)]$\n- **输出格式**：一个单行字符串 `[baseline,[single_...],[double_...],[SL_...]]`，其中生长速率为浮点数，SL 标志为小写的布尔值。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n- **科学依据**：该问题是流量平衡分析的一个标准应用，流量平衡分析是计算系统生物学中的一个基石方法。化学计量矩阵、通量边界、GPR 规则和合成致死性的概念在该领域都是标准且成熟的。\n- **良构的**：该问题被表述为一个线性规划 (LP) 问题，这是一个良构的数学问题。它指定了目标函数、等式约束 ($S v = 0$) 和不等式约束 ($l \\le v \\le u$) 。保证存在一个唯一的、稳定的最大目标值解，或者该问题将被确定为不可行。处理不可行性的程序也已明确定义。\n- **客观性**：问题使用精确的数学和逻辑术语陈述，没有主观语言。\n- **完整性和一致性**：为定义每种情景下的 LP 所需的所有必要组件都已提供：化学计量矩阵、所有边界、目标以及用于修改边界的逻辑（GPR 规则）。明确指出了有意省略反应 $v_8$，这可以通过将其在 $S$ 中的相应列设置为零并将其边界设置为 $[0, 0]$ 来处理，这是一个一致的建模选择。\n\n### 步骤 3：结论与行动\n\n问题是有效的。它具有科学合理性、良构性，并且提供了求解所需的所有信息。我将继续进行求解。\n\n### 基于原则的解决方案设计\n\n该解决方案将作为一个 Python 程序实现，利用 `scipy.optimize.linprog` 函数来解决由 FBA 模型定义的一系列线性规划问题。\n\n1.  **模型表示**：代谢网络模型将使用 NumPy 数组进行编码。\n    - 化学计量矩阵 $S$ 将是一个 $5 \\times 9$ 的矩阵，其中行对应代谢物，列对应反应（$v_1$ 到 $v_9$，其中用于虚拟反应 $v_8$ 的第 8 列全为零）。\n    - 基础的通量下界 ($l$) 和上界 ($u$) 将表示为两个 9 元素向量。\n    - 目标向量 $c$ 将是一个 9 元素向量，在对应于 $v_6$（索引 5）的位置为 1，其他位置为零。由于 `linprog` 执行最小化，我们将求解 $\\min(-c^\\top v)$。\n\n2.  **GPR 规则评估**：GPR 规则将存储在一个字典中，将反应索引映射到其对应的逻辑字符串。将创建一个函数来处理基因删除。对于给定的已删除基因集，该函数将：\n    - 从所有规则字符串中解析基因标识符，以建立模型中完整的基因集合。\n    - 为每个基因生成布尔状态（存在或缺失）。\n    - 在受限命名空间中使用 Python 的 `eval()` 函数评估每个 GPR 字符串。这提供了一种简单有效的方法来实现与/或逻辑。\n    - 如果规则评估为 `False`，相应反应的上下界将被设置为 $0$。\n\n3.  **FBA 求解器函数**：一个核心函数 `solve_fba(deleted_genes)` 将封装求解一个 FBA 实例的逻辑。\n    - 它接受一个已删除基因名称的集合作为输入。\n    - 它应用 GPR 逻辑来为给定的删除情景生成适当的通量边界。\n    - 它调用 `scipy.optimize.linprog` 并传入化学计量矩阵 $S$ 作为等式约束 (`A_eq`)、一个零向量作为 `b_eq`、计算出的边界以及负的目标向量 `-c`。\n    - 它检查求解器的状态码。如果问题不可行 (`status=2`)，则按规定返回生长速率 0.0。否则，它返回最大化的目标值，即最小化器返回值的负数 (`-result.fun`)。\n\n4.  **测试套件执行**：程序的主要部分将执行指定的测试套件。\n    - 它将首先计算无删除时的基线生长。\n    - 然后它将遍历单基因和双基因删除列表，对每种情况调用 `solve_fba` 函数，并存储由此产生的生长速率。\n    - 为了确定每个双基因删除对 $\\{g_a, g_b\\}$ 的合成致死性，它将检索双基因删除 $\\Delta(g_a, g_b)$ 和每个单基因删除 $\\Delta(g_a)$、$\\Delta(g_b)$ 的生长速率。将使用一个小缓存来存储和检索单基因删除的生长速率，以避免冗余计算。\n    - 将对每对基因评估合成致死性条件 ($\\Delta(g_a, g_b) \\le \\tau \\land \\Delta(g_a) > \\tau \\land \\Delta(g_b) > \\tau$)。\n\n5.  **输出格式化**：最后一个函数会将收集到的结果——基线生长、单基因删除生长、双基因删除生长和合成致死性标志——组装成一个嵌套列表结构。然后它会将此结构格式化为所需的精确字符串格式，包括将 Python 布尔值 (`True`, `False`) 转换为小写字符串 (`true`, `false`)。\n\n这种结构化方法确保问题的每个部分都得到正确和高效的处理，从而得到所需的输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\nimport re\n\ndef solve():\n    \"\"\"\n    Implements a Flux Balance Analysis (FBA) for a toy metabolic network\n    to calculate growth rates under gene deletions and identify synthetic lethality.\n    \"\"\"\n    # 1. DEFINE THE METABOLIC MODEL\n    # Stoichiometric matrix S (5 metabolites x 9 reactions)\n    # Rows: G, A, B, P, ATP\n    # Cols (0-indexed): v1, v2, v3, v4, v5, v6, v7, v8(dummy), v9\n    S = np.array([\n        # v1, v2, v3, v4, v5, v6, v7, v8, v9\n        [ 1., -1., -1.,  0.,  0.,  0.,  0.,  0.,  0.],  # G\n        [ 0.,  1.,  0., -1.,  0.,  0.,  0.,  0.,  0.],  # A\n        [ 0.,  0.,  1.,  0., -1.,  0.,  0.,  0.,  0.],  # B\n        [ 0.,  0.,  0.,  1.,  1., -1.,  0.,  0.,  0.],  # P\n        [ 0.,  1.,  0.,  0.,  0.,  0.,  1.,  0., -1.]   # ATP\n    ])\n\n    # Base reaction flux bounds (lower, upper). v8 (index 7) is inactive.\n    L_base = np.array([0., 0., 0., 0., 0., 0., 0., 0., 1.])\n    U_base = np.array([10., 1000., 1000., 1000., 1000., 1000., 1000., 0., 1000.])\n\n    # Objective function: maximize v6 (flux at index 5).\n    # linprog minimizes, so we will pass the negative of the objective vector.\n    c = np.zeros(9)\n    c[5] = 1.0\n\n    # Gene-Protein-Reaction (GPR) rules (0-based reaction indices).\n    gpr_rules = {\n        0: \"gT1 or gT2\",\n        1: \"gGLY\",\n        2: \"gALT1 or gALT2\",\n        3: \"gA2P1 and gA2P2\",\n        4: \"gB2P\",\n        6: \"gATPa and gATPb\",\n    }\n    \n    # Extract all unique gene names from GPR rules to build the evaluation context.\n    all_model_genes = set()\n    for rule in gpr_rules.values():\n        all_model_genes.update(re.findall(r'g[A-Za-z0-9]+', rule))\n\n    # Cache for single gene deletion growth rates to speed up SL calculation.\n    # The key is a sorted tuple of deleted genes.\n    fba_results_cache = {}\n\n    # 2. DEFINE THE CORE FBA SOLVER\n    def solve_fba(deleted_genes_set):\n        \"\"\"\n        Solves the FBA problem for a given set of gene deletions.\n        \"\"\"\n        # Use a canonical, sorted tuple as the cache key.\n        cache_key = tuple(sorted(list(deleted_genes_set)))\n        if cache_key in fba_results_cache:\n            return fba_results_cache[cache_key]\n\n        current_l = L_base.copy()\n        current_u = U_base.copy()\n\n        # Evaluate GPR rules and update bounds for knocked-out reactions.\n        gene_status = {gene: (gene not in deleted_genes_set) for gene in all_model_genes}\n        \n        for rxn_idx, rule_str in gpr_rules.items():\n            # Safely evaluate the boolean expression in a restricted namespace.\n            is_active = eval(rule_str, {\"__builtins__\": {}}, gene_status)\n            if not is_active:\n                current_l[rxn_idx] = 0.0\n                current_u[rxn_idx] = 0.0\n        \n        bounds = list(zip(current_l, current_u))\n        b_eq = np.zeros(S.shape[0])\n\n        # Solve the linear program using the 'highs' method.\n        res = linprog(c=-c, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n        # As per problem spec, if infeasible (status 2), growth is 0.\n        if res.status == 2:\n            growth_rate = 0.0\n        else:\n            # Maximization objective is the negative of the minimizer's result.\n            growth_rate = -res.fun if res.success else 0.0\n\n        # Cache the result before returning.\n        fba_results_cache[cache_key] = growth_rate\n        return growth_rate\n\n    # 3. EXECUTE THE TEST SUITE\n    tau = 1e-9\n\n    # Baseline growth (no deletions)\n    baseline_growth = solve_fba(set())\n\n    # Single deletions\n    single_deletion_genes = ['gGLY', 'gA2P2', 'gB2P', 'gATPa', 'gX']\n    single_growth_rates = [solve_fba({g}) for g in single_deletion_genes]\n\n    # Double deletions\n    double_deletion_gene_pairs = [\n        ('gA2P1', 'gB2P'), ('gT1', 'gT2'), ('gATPa', 'gATPb'), \n        ('gGLY', 'gGLY'), ('gX', 'gB2P'), ('gGLY', 'gATPa')\n    ]\n    double_growth_rates = [solve_fba(set(pair)) for pair in double_deletion_gene_pairs]\n\n    # Synthetic lethality analysis\n    synthetic_lethality_flags = []\n    for i, (g_a, g_b) in enumerate(double_deletion_gene_pairs):\n        double_growth = double_growth_rates[i]\n        \n        # Retrieve single growth rates (will use cache if already computed)\n        growth_a = solve_fba({g_a})\n        growth_b = solve_fba({g_b})\n\n        is_lethal = (double_growth <= tau) and (growth_a > tau) and (growth_b > tau)\n        synthetic_lethality_flags.append(is_lethal)\n\n    # 4. FORMAT AND PRINT THE FINAL OUTPUT\n    final_result_list = [\n        baseline_growth,\n        single_growth_rates,\n        double_growth_rates,\n        synthetic_lethality_flags\n    ]\n\n    def format_output(data):\n        \"\"\"Recursively formats the results into the required string format.\"\"\"\n        if isinstance(data, list):\n            return f\"[{','.join(format_output(x) for x in data)}]\"\n        elif isinstance(data, bool):\n            return str(data).lower()\n        elif isinstance(data, (float, np.floating)):\n            # Format floats to 1 decimal place if they are whole numbers.\n            return f\"{data:.1f}\" if data == int(data) else str(data)\n        else:\n            return str(data)\n            \n    print(format_output(final_result_list))\n\nsolve()\n```"
        }
    ]
}