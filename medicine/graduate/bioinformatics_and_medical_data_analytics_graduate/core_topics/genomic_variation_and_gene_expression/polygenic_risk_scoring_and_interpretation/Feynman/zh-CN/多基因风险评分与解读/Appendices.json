{
    "hands_on_practices": [
        {
            "introduction": "在将多基因风险评分（PRS）应用于临床实践之前，至关重要的一步是能够准确地解释其含义。由于PRS通常被标准化，其回归系数本身并不直观。本练习将指导您完成一个基础但关键的推导，阐明如何将来自逻辑回归或Cox比例风险模型的标准化PRS系数，转化为临床上更易于理解的风险度量，如比值比（Odds Ratio, OR）和风险比（Hazard Ratio, HR）。掌握这项技能对于向患者和临床医生有效沟通遗传风险至关重要。",
            "id": "4594841",
            "problem": "一项病例对照研究使用标准化的多基因风险评分 (Polygenic Risk Score, PRS)（记为 $Z$）来建立疾病风险模型，该评分的均值为 $0$，标准差为 $1$。二元疾病状态 $D \\in \\{0,1\\}$ 通过一个逻辑回归模型与 $Z$ 相关联，其中对数比值 (log-odds) 与 $Z$ 呈线性关系。另外，在一个用于生存时间数据的队列研究中，假设采用 Cox 比例风险模型，其中风险率与 $Z$ 呈乘法关系。\n\n仅从以下基本定义和模型陈述出发：\n- 当概率为 $p$ 时，疾病的比值 (odds) 为 $O(p) = \\frac{p}{1-p}$，其 logit (对数比值) 为 $\\ln\\!\\big(O(p)\\big)$。\n- 逻辑回归模型满足 $\\ln\\!\\big(O(p_Z)\\big) = \\alpha + \\gamma Z$，其中 $p_Z = \\Pr(D=1 \\mid Z)$，$\\alpha$ 是截距，$\\gamma$ 是 $Z$ 每增加一个单位的斜率。\n- Cox 模型假设 $h(t \\mid Z) = h_0(t)\\,\\exp(\\beta Z)$，其中 $h(t \\mid Z)$ 是时间 $t$ 时的风险率，$h_0(t)$ 是基准风险率，$\\beta$ 是 $Z$ 每增加一个单位的斜率。\n\n根据这些定义，推导在逻辑模型中 $Z$ 增加一个标准差如何对应于一个优势比 (Odds Ratio, OR)，以及在 Cox 模型中如何对应于一个风险比 (Hazard Ratio, HR)。解释系数 $\\gamma$ 和 $\\beta$ 的含义，说明当 $Z$ 每增加一个标准差时，它们如何表示比值或风险率的乘法变化。\n\n然后，假设一个拟合的逻辑回归模型得出的斜率估计值为 $\\gamma = 0.42$（$Z$ 每增加一个标准差的对数比值）。计算当 $Z$ 增加一个标准差时的优势比 (Odds Ratio) 的数值。将您的答案四舍五入到四位有效数字。将最终答案表示为一个不带单位的纯数。",
            "solution": "问题陈述定义了两个模型，将标准化的多基因风险评分 (PRS)（记为 $Z$）与健康结局联系起来。我们被要求推导模型系数在优势比 (OR) 和风险比 (HR) 方面的解释，然后计算一个具体的 OR 值。变量 $Z$ 是一个标准化评分，意味着其均值为 $0$，标准差为 $1$。\n\n首先，我们分析用于二元疾病结局 $D \\in \\{0,1\\}$ 的逻辑回归模型。该模型由下式给出：\n$$\n\\ln\\!\\big(O(p_Z)\\big) = \\alpha + \\gamma Z\n$$\n其中 $p_Z = \\Pr(D=1 \\mid Z)$ 是在给定 PRS $Z$ 的条件下患病的概率，$O(p_Z)$ 是相应的比值。$\\alpha$ 项是 $Z=0$（即群体平均 PRS）的个体的对数比值，而 $\\gamma$ 是 $Z$ 每增加一个单位时对数比值的变化量。\n\n为了求出 $Z$ 增加一个标准差时的优势比 (OR)，我们比较两个个体的比值。由于 $Z$ 是标准化的，一个标准差等于一个单位的 $Z$。我们考虑一个个体其 PRS 为 $Z$，另一个个体其 PRS 为 $Z+1$。\n\n第一个个体的对数比值为：\n$$\n\\ln(\\text{Odds}_1) = \\alpha + \\gamma Z\n$$\n因此，该个体的比值为 $\\text{Odds}_1 = \\exp(\\alpha + \\gamma Z)$。\n\n第二个个体的 PRS 高出一个单位，其对数比值为：\n$$\n\\ln(\\text{Odds}_2) = \\alpha + \\gamma (Z+1) = \\alpha + \\gamma Z + \\gamma\n$$\n该第二个个体的比值为 $\\text{Odds}_2 = \\exp(\\alpha + \\gamma Z + \\gamma)$。\n\n优势比 (OR) 定义为这两个比值的比率：\n$$\n\\text{OR} = \\frac{\\text{Odds}_2}{\\text{Odds}_1} = \\frac{\\exp(\\alpha + \\gamma Z + \\gamma)}{\\exp(\\alpha + \\gamma Z)}\n$$\n使用指数的性质 $\\exp(a+b) = \\exp(a)\\exp(b)$，我们得到：\n$$\n\\text{OR} = \\frac{\\exp(\\alpha + \\gamma Z) \\cdot \\exp(\\gamma)}{\\exp(\\alpha + \\gamma Z)} = \\exp(\\gamma)\n$$\n这个推导表明，$Z$ 每增加一个单位的 OR 是 $\\exp(\\gamma)$。由于 $Z$ 的一个单位对应于一个标准差，所以这也是 PRS 每增加一个标准差的 OR。\n\n系数 $\\gamma$ 的解释直接得出：$\\gamma$ 是与 PRS 增加一个标准差相关联的优势比的自然对数。值 $\\exp(\\gamma)$ 表示当 $Z$ 每增加一个标准差时，疾病比值增加（如果 $\\gamma > 0$）或减少（如果 $\\gamma < 0$）的乘法因子。\n\n其次，我们分析用于生存时间数据的 Cox 比例风险模型。该模型由下式给出：\n$$\nh(t \\mid Z) = h_0(t)\\,\\exp(\\beta Z)\n$$\n其中 $h(t \\mid Z)$ 是 PRS 为 $Z$ 的个体在时间 $t$ 的风险率，$h_0(t)$ 是基准风险函数，$\\beta$ 是 $Z$ 每增加一个单位的对数风险比。\n\n为了求出 $Z$ 增加一个标准差时的风险比 (HR)，我们再次比较两个 PRS 值分别为 $Z$ 和 $Z+1$ 的个体。\n\n第一个个体的风险率为：\n$$\nh(t \\mid Z) = h_0(t)\\,\\exp(\\beta Z)\n$$\n第二个个体的风险率为：\n$$\nh(t \\mid Z+1) = h_0(t)\\,\\exp(\\beta(Z+1)) = h_0(t)\\,\\exp(\\beta Z + \\beta)\n$$\n风险比 (HR) 是这两个风险率的比率。Cox 模型的一个关键特征是，这个比率不随时间 $t$ 变化。\n$$\n\\text{HR} = \\frac{h(t \\mid Z+1)}{h(t \\mid Z)} = \\frac{h_0(t)\\,\\exp(\\beta Z + \\beta)}{h_0(t)\\,\\exp(\\beta Z)}\n$$\n基准风险 $h_0(t)$ 被消掉，化简指数项后得到：\n$$\n\\text{HR} = \\frac{\\exp(\\beta Z) \\cdot \\exp(\\beta)}{\\exp(\\beta Z)} = \\exp(\\beta)\n$$\n这个推导表明，$Z$ 增加一个单位（即一个标准差）的 HR 是 $\\exp(\\beta)$。\n\n系数 $\\beta$ 的解释与 $\\gamma$ 的解释类似：$\\beta$ 是与 PRS 增加一个标准差相关联的风险比的自然对数。值 $\\exp(\\beta)$ 是当 $Z$ 每增加一个标准差时，事件风险变化的乘法因子。\n\n最后，我们被要求为一个拟合的逻辑回归模型计算数值上的优势比，其中斜率估计值为 $\\gamma = 0.42$。该系数表示 $Z$ 每增加一个标准差时对数比值的增加量。\n\n根据我们的推导，OR 由 $\\exp(\\gamma)$ 给出。代入给定的 $\\gamma$ 值：\n$$\n\\text{OR} = \\exp(0.42)\n$$\n计算该值：\n$$\n\\text{OR} \\approx 1.521961556...\n$$\n题目要求答案四舍五入到四位有效数字。前四位有效数字是 $1$、$5$、$2$ 和 $2$（因为第五位数字是 $9 \\ge 5$，所以我们将第四位数字向上取整）。\n$$\n\\text{OR} \\approx 1.522\n$$\n这意味着多基因风险评分每增加一个标准差，患病的比值大约变为原来的 $1.522$ 倍。",
            "answer": "$$\\boxed{1.522}$$"
        },
        {
            "introduction": "构建一个准确且稳健的PRS需要一个严谨、多步骤的流程。本练习将带您深入了解PRS构建中最经典的方法之一：连锁不平衡“削减”与$p$值阈值法（Clumping and Thresholding, C+T）。您将通过设计一个完整的分析流程，来练习如何处理从数据质量控制、等位基因协调到模型验证等一系列关键环节。这项实践旨在培养您对构建高质量PRS所需方法学严谨性的深刻理解。",
            "id": "4594729",
            "problem": "一个临床遗传学小组希望在一个欧洲血统的队列中，使用经典的聚类与 $p$ 值阈值方法，为一种复杂疾病构建多基因风险评分 (PRS)。该小组拥有以下资源：来自一项大型、无重叠荟萃分析的全基因组关联研究 (GWAS) 汇总统计数据，目标队列的 PLINK 二进制格式基因型数据，以及公共参考面板。PRS 必须通过一个科学上合理、步骤明确的流程来构建和评估，该流程需遵循 GWAS 衍生预测因子的统计学假设，包括训练数据和评估数据之间的独立性、对连锁不平衡 (LD) 的适当处理以及等位基因协调。为明确起见，在此背景下，PRS 是由 GWAS 效应量加权的单核苷酸多态性 (SNP) 预测因子的线性组合；LD 指的是不同位点上等位基因之间的相关性；聚类通过保留关联性最强的索引 SNP 并移除邻近的相关 SNP 来减少相关冗余。\n\n选择一个选项，该选项指定了使用聚类和 $p$ 值阈值法构建 PRS 的正确、分步流程，包括所需的输入文件和科学上合理的参数选择。该流程必须：\n\n- 遵循基础样本与目标样本的独立性（无数据泄露）。\n- 使用血统匹配的 LD 信息进行聚类。\n- 执行等位基因协调和适当的质量控制。\n- 使用正确尺度的效应量进行加权。\n- 通过验证选择一个 $p$ 值阈值，以避免过拟合。\n- 提供明确的输入文件和参数值。\n\n选项：\n\nA. \n- 输入：\n  - GWAS 汇总统计文件（例如，“sumstats.txt”），包含以下列：SNP 标识符、染色体、碱基对位置、效应等位基因、其他等位基因、单位点效应量 $\\hat{\\beta}$（对数优势比或线性效应）、标准误、$p$ 值 $p$ 和样本量 $N$。\n  - 目标队列的 PLINK 基因型文件：“target.bed”、“target.bim”、“target.fam”。\n  - 血统匹配的 LD 参考面板（例如，千人基因组计划欧洲子集）的 PLINK 格式文件。\n  - 包含年龄、性别和主成分 (PCs) 的协变量文件。\n- 汇总统计数据的质量控制和协调：\n  - 移除非双等位基因和链模糊的 SNP（腺嘌呤/胸腺嘧啶和胞嘧啶/鸟嘌呤），以防止链不匹配。\n  - 排除缺少 $\\hat{\\beta}$、$p$ 或等位基因信息的 SNP；限制在常染色体，并可选择性排除人类白细胞抗原 (HLA) 区域（6号染色体 $25$ 至 $34$ 兆碱基对）。\n  - 将效应等位基因与目标基因型编码对齐：当等位基因交换时，必要时翻转 $\\hat{\\beta}$ 的符号，移除无法解决等位基因不匹配的 SNP。\n- 目标基因型质量控制：\n  - 根据检出率（缺失率 $0.02$）、次要等位基因频率（MAF $>0.01$）、哈迪-温伯格平衡（HWE）（$p>10^{-6}$）和插补质量（如果使用剂量数据，信息分数 $>0.8$）过滤 SNP。\n  - 使用经过 LD 剪枝的 SNP 计算血统主成分，并将分析限制在欧洲血统子集内。\n- LD 聚类：\n  - 使用血统匹配的 LD 参考面板。\n  - 参数：$250$ 千碱基对的窗口，成对 $r^2 > 0.1$，根据区域内最小的 GWAS $p$ 值选择索引 SNP；移除与索引 SNP 的 $r^2$ 关系不符合条件的次要 SNP。\n- $p$ 值阈值法：\n  - 定义一个阈值网格 $p \\in \\{5\\times 10^{-8}, 10^{-6}, 10^{-4}, 10^{-3}, 10^{-2}, 5\\times 10^{-2}, 10^{-1}, 5\\times 10^{-1}, 1\\}$。\n  - 对于每个阈值，纳入 $p$ 值低于该阈值的聚类后 SNP。\n- 评分构建：\n  - 计算个体评分为 $\\mathrm{PRS}_j=\\sum_{i\\in S(\\alpha)} \\hat{\\beta}_i x_{ij}$，其中 $x_{ij}$ 是个体 $j$ 的目标基因型剂量（编码为 $0, 1, 2$ 或插补剂量），$S(\\alpha)$ 是通过聚类和 $p$ 值阈值 $\\alpha$ 的 SNP 集合。\n  - 在目标样本内对 $\\mathrm{PRS}_j$ 进行标准化（例如，z-score）。\n- 模型评估和选择：\n  - 将目标队列划分为训练集和验证集，或使用交叉验证；确保与 GWAS 训练数据无重叠。\n  - 使用 PRS 和协变量（年龄、性别、PCs）拟合回归模型：对二元性状使用逻辑回归，对数量性状使用线性回归。\n  - 在验证集中选择能够最大化解释方差（例如，$R^2$）或曲线下面积 (AUC) 的阈值 $\\alpha$，并报告性能。\n- 报告：\n  - 提供最终的 SNP 列表、权重 $\\hat{\\beta}_i$、选定的 $\\alpha$、聚类参数（$r^2$、窗口）和评估指标。\n\nB.\n- 输入：\n  - GWAS 汇总统计文件，包含 SNP 标识符和优势比，但无等位基因信息。\n  - 用于 LD 估计和 PRS 评估的目标队列 PLINK 基因型文件。\n- 流程：\n  - 跳过等位基因协调和模糊 SNP 移除；假设优势比已对齐。\n  - 使用目标队列的基因型进行 LD 聚类，参数为：$500$ 千碱基对窗口，$r^2 > 0.5$；如果索引 SNP 和相关 SNP 的 $p$ 值都低于 $5\\times 10^{-8}$，则同时保留它们。\n  - 直接使用已发布的优势比（而非对数优势比）对基因型计数进行加权，并对所有通过 $p$ 值阈值 $5\\times 10^{-8}$ 的 SNP 求和，以计算 PRS。\n  - 在整个目标队列（包括病例和对照）上优化 $p$ 值阈值，并在未经协变量调整的同一队列上报告性能。\n\nC.\n- 输入：\n  - 仅包含每个 SNP 的 $z$ 分数的 GWAS 荟萃分析汇总统计数据。\n  - 目标 PLINK 基因型。\n  - 来自混合血统样本（结合了欧洲和东亚个体）的 LD 参考面板。\n- 流程：\n  - 用标准化的 $z$ 分数替换权重 $\\hat{\\beta}$，并除以目标队列的等位基因频率，以强调稀有变异。\n  - LD 聚类参数：$1000$ 千碱基对窗口，保留 $r^2>0.8$ 的 SNP 以捕获单倍型。\n  - 使用单一的严格 $p$ 值阈值 $p  5\\times 10^{-8}$，不评估其他备选阈值。\n  - 计算 PRS 并在目标队列中使用未经调整的线性回归（无 PCs 或其他协变量）进行评估；报告样本内 $R^2$。\n\nD.\n- 输入：\n  - 包含效应等位基因和对数优势比 $\\hat{\\beta}$ 的 GWAS 汇总统计数据，但样本与目标队列有重叠。\n  - 目标 PLINK 基因型。\n  - 来自千人基因组计划东亚子集的 LD 参考面板。\n- 流程：\n  - 协调等位基因并移除模糊 SNP；排除在目标队列中 MAF  0.05 的 SNP。\n  - LD 聚类参数：$250$ 千碱基对窗口，$r^2 > 0.1$，对欧洲目标队列使用东亚 LD 参考。\n  - 使用一个阈值网格 $p \\in \\{5\\times 10^{-8}, 10^{-6}, 10^{-4}, 10^{-3}\\}$；通过在目标队列上最大化 $R^2$ 来选择最佳阈值。\n  - 使用 $\\hat{\\beta}$ 权重计算 PRS，并在包含协变量的同一目标队列上评估性能，然后报告最终的 PRS。\n\n哪个选项最正确地指定了一个科学上合理的、具有适当输入和参数的聚类和 $p$ 值阈值法 PRS 流程？",
            "solution": "问题要求确定使用聚类和 $p$ 值阈值 ($C+T$) 方法构建多基因风险评分 (PRS) 的正确、分步流程。该流程必须科学合理，遵循统计学假设和该领域的最佳实践。\n\n### 问题陈述的有效性验证\n首先，对问题陈述的有效性进行评估。\n\n**1. 提取已知条件：**\n- **目标：** 为一种复杂疾病构建 PRS。\n- **方法论：** 聚类和 $p$ 值阈值法。\n- **目标人群：** 欧洲血统队列。\n- **可用数据：**\n    - 来自一项大型、无重叠荟萃分析的全基因组关联研究 (GWAS) 汇总统计数据。\n    - 目标队列的 PLINK 二进制格式基因型数据。\n    - 公共参考面板。\n- **关键科学约束：**\n    - 基础 (GWAS) 样本与目标样本之间的独立性。\n    - 使用血统匹配的连锁不平衡 (LD) 信息。\n    - 正确的等位基因协调和质量控制 (QC)。\n    - 使用正确尺度的效应量。\n    - 通过避免过拟合的验证程序选择 $p$ 值阈值。\n    - 明确指定输入和参数。\n\n**2. 有效性分析：**\n- **科学基础：** 该问题牢固地基于统计遗传学和生物信息学的既定原则。所描述的 PRS 方法是一种标准且广泛使用的方法。\n- **适定性：** 这是一个适定问题。它要求根据一套明确的科学约束，从一组选项中识别出正确的程序。预期会有一个唯一的最佳答案。\n- **客观性：** 语言精确且无偏见。PRS、LD 和聚类的定义准确且标准。\n- **完整性和一致性：** 问题是自洽的。它明确指出 GWAS 和目标队列不重叠，这是有效分析的关键细节。没有内部矛盾。\n- **现实性：** 该场景非常现实，反映了临床遗传学研究人员的常见任务。数据类型和约束都是标准的。\n\n**3. 结论：**\n问题陈述是 **有效的**。在其领域内，这是一个表述良好、科学合理且相关的问题。\n\n### 正确流程的推导与选项评估\n\n一个科学严谨的 $C+T$ PRS 流程如下：\n\n1.  **数据准备和质控 (QC)：** 从高质量的 GWAS 汇总统计数据和目标基因型数据开始。一个关键的初始步骤是协调数据，确保 GWAS 中的效应等位基因与目标数据中计数的等位基因相对应。这包括检查和解决链模糊性和等位基因交换问题，必要时翻转效应量 ($\\hat{\\beta}$) 的符号。必须移除无法解决不匹配问题的 SNP。标准的 QC 过滤器应用于汇总统计数据（例如，根据信息分数、等位基因频率进行过滤，移除模糊 SNP）和目标基因型（根据缺失率、次要等位基因频率 (MAF)、哈迪-温伯格平衡 (HWE) $p$ 值进行过滤）。\n2.  **LD 聚类：** 为了满足效应可加性假设，必须对高度相关的 SNP 进行修剪。这通过 LD 聚类来完成，该过程迭代地识别出一个索引 SNP（在给定窗口中具有最低 GWAS $p$ 值的 SNP），并移除该窗口中与索引 SNP 处于高度 LD（例如，$r^2  0.1$）的所有其他 SNP。此步骤至关重要地需要一个与 GWAS 和目标人群 **血统匹配** 的 LD 参考面板。\n3.  **阈值设定和评分计算：** 生成一系列 PRS，每个 PRS 对应一个不同的 GWAS $p$ 值阈值。定义一个阈值网格（例如，$p \\in \\{5\\times 10^{-8}, 10^{-6}, ..., 1\\}$）。对于每个阈值，个体的评分计算为他们的基因型总和，由相应的 GWAS 效应量（$\\hat{\\beta}$，对于二元性状是对数优势比）加权。公式为 $\\mathrm{PRS}_j = \\sum_{i} \\hat{\\beta}_i G_{ij}$，其中 $G_{ij}$ 是个体 $j$ 在 SNP $i$ 上的效应等位基因计数。\n4.  **模型调优和评估：** 为了无偏地选择最佳 $p$ 值阈值，必须将目标队列划分为训练集和验证/测试集，或使用交叉验证。对于每个 PRS（对应一个 $p$ 值阈值），在训练集中拟合一个回归模型（例如，针对疾病状态的逻辑回归）：$\\text{trait} \\sim \\text{PRS} + \\text{covariates}$。协变量必须包括主成分 (PCs) 以控制群体分层，以及其他相关变量如年龄和性别。然后，在独立的验证集中使用合适的指标（例如，AUC、Nagelkerke's $R^2$）评估每个模型的性能。选择在验证集中产生最佳性能的 $p$ 值阈值作为最终模型。理想情况下，应在单独的、预留的测试集上报告此最终模型的性能，以获得无偏估计。\n\n### 逐项分析选项\n\n**A. 评估：**\n该选项概述了一个遵循严格 PRS 分析所有原则的流程。\n- **输入：** 正确指定了非重叠的 GWAS 汇总统计数据、目标基因型和一个血统匹配的 LD 面板。列出了所有必需的列和文件。\n- **QC 和协调：** 详细说明了一个全面且正确的程序，包括移除模糊 SNP、通过翻转 $\\hat{\\beta}$ 符号来协调效应等位基因，以及对汇总统计数据和目标基因型进行标准 QC。\n- **LD 聚类：** 使用血统匹配的面板，并采用标准、合理的参数（$250$ 千碱基对窗口，$r^2  0.1$）。\n- **$p$ 值阈值法：** 采用宽泛的 $p$ 值阈值网格，这是正确的调优方法。\n- **评分构建：** 使用正确的线性公式，以 $\\hat{\\beta}$ 作为权重。\n- **模型评估：** 关键在于，它强制要求划分目标队列或使用交叉验证来选择最佳阈值，使用必要的协变量（PCs）拟合模型，并使用适当的指标（$R^2$, AUC）。这可以防止过拟合。\n- **报告：** 指定了可重复性研究所需的信息。\n**结论：正确。**\n\n**B. 评估：**\n此选项包含多个基本错误。\n- **输入：** 没有等位基因信息的 GWAS 汇总统计数据无法用于协调，而协调是关键步骤。\n- **流程：** “跳过等位基因协调”是一个致命缺陷。假设对齐在科学上是站不住脚的。直接使用优势比作为权重在数学上是不正确的，因为 PRS 模型是加性的（需要对数优势比，即 $\\hat{\\beta}$）。$r^2  0.5$ 的聚类阈值过于宽松，无法充分移除相关的 SNP。保留相关 SNP 与聚类的目的相矛盾。\n- **评估：** 在没有训练/验证集划分或交叉验证的情况下，在整个目标队列上优化和评估模型会导致严重的过拟合和虚高的性能估计。忽略像 PCs 这样的协变量，则无法控制群体分层。\n**结论：不正确。**\n\n**C. 评估：**\n此选项的核心方法存在缺陷。\n- **输入：** 为欧洲队列使用来自混合血统样本的 LD 参考面板是一个重大错误，因为 LD 模式是人群特异性的，这种不匹配将导致不正确的聚类。\n- **流程：** 权重方案是临时的。更重要的是，聚类逻辑是颠倒的：保留 $r^2  0.8$ 的 SNP 会将高度相关的 SNP 分组在一起，这与为 PRS 进行聚类的目标相反。这描述的是一种识别单倍型标签 SNP 的方法，而不是创建一组独立预测因子的方法。\n- **评估：** 仅使用单一、严格的 $p$ 值阈值（$p  5\\times 10^{-8}$）违背了 $C+T$ 方法中阈值部分的宗旨，即通过经验找到信号和噪声之间的最佳权衡。报告未经调整的样本内 $R^2$ 是不良实践，因为它存在混杂和过拟合问题。\n**结论：不正确。**\n\n**D. 评估：**\n此选项违反了 PRS 构建中两个最关键的假设。\n- **输入：** “样本与目标队列有重叠”的陈述是一个致命缺陷。这种对基础 (GWAS) 数据和目标数据之间独立性的违反，保证了过拟合，并将产生性能估计被严重夸大且不具泛化性的 PRS。\n- **LD 参考面板：** 为欧洲目标队列使用东亚 LD 参考面板是一个科学上无效的选择，因为血统不匹配将导致不正确的聚类。\n- **评估：** 在同一个完整的靶队列上选择最佳阈值并评估性能的策略是一种数据泄露形式，会导致过拟合。需要一个独立的验证集。\n**结论：不正确。**\n\n### 总结\n选项 A 是唯一描述了使用聚类和 $p$ 值阈值法构建 PRS 的科学合理、严谨且完整的流程的选项。它正确地指定了所有必要的输入、QC 步骤、分析程序和验证策略。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "随着领域的发展，超越经典C+T方法的更先进PRS构建技术应运而生。本练习将介绍一种基于贝叶斯理论的强大方法——LDpred，它能更精细地利用连锁不平衡（LD）信息来估计SNP效应。您将探索构建LDpred模型的复杂工作流程，包括准备合适的LD参考面板和调整关键超参数。通过这项实践，您将掌握构建新一代高精度PRS所需的高级技能，并理解其相对于传统方法的理论优势。",
            "id": "4594392",
            "problem": "您获得了一份针对二元疾病性状的全基因组关联研究 (GWAS) 汇总统计数据，该研究在一个独立的欧洲血统队列中进行，其中包含 $N_{\\text{cases}} = 50{,}000$ 例病例和 $N_{\\text{controls}} = 150{,}000$ 例对照。数据报告了每个单核苷酸多态性 (SNP) 的效应估计值 $\\hat{\\beta}_j$、标准误 $\\mathrm{SE}_j$、效应等位基因、其他等位基因、等位基因频率、插补信息分数以及每个 SNP 的样本量。您的目标是为一个由 $N_{\\text{target}} = 100{,}000$ 名具有插补基因剂量的基因分型个体组成的无亲缘关系欧洲血统目标队列构建多基因风险评分 (PRS)，并使用 LDpred 方法（一种考虑了连锁不平衡 (LD) 的贝叶斯收缩方法）。您必须在流程中包含连锁不平衡 (LD) 参考数据集的准备和超参数调整，同时避免数据泄露。假设您可以访问一个外部的、血统匹配的 LD 参考面板，其中包含 $N_{\\text{ref}} = 20{,}000$ 名无亲缘关系的欧洲人，其基因分型和插补所用的参考构建版本与目标队列相同。您可以假设 LDpred 至少需要：与 LD 参考和目标基因型协调一致的 GWAS 汇总统计数据、为所用 SNP 集合在参考面板上计算的 LD 矩阵，以及包括全基因组 SNP 遗传力 $h^2$ 和致病变异比例 $p$ 在内的超参数。\n\n使用以下基本原则来推断正确的流程：\n- PRS 是一个线性预测器 $S_i = \\sum_{j=1}^M G_{ij} w_j$，其中 $G_{ij}$ 是个体 $i$ 在 SNP $j$ 处与效应等位基因对齐的基因剂量，$w_j$ 是从关联性的统计证据中得出的每个 SNP 的权重。\n- 在 SNP 效应的贝叶斯点-正态先验下，假设非零效应的比例为 $p$，总 SNP 遗传力为 $h^2$，则后验均值权重 $w_j$ 依赖于 LD 结构（通过标准化基因型的 LD 矩阵 $\\mathbf{R}$）、GWAS 的 $z$-分数 $z_j = \\hat{\\beta}_j / \\mathrm{SE}_j$ 以及超参数 $(h^2, p)$。\n- 对于病例-对照研究，有效样本量为 $N_{\\text{eff}} = \\frac{4}{\\frac{1}{N_{\\text{cases}}} + \\frac{1}{N_{\\text{controls}}}}$，并且在零假设下，$z$-分数近似服从标准正态分布。\n- 模型选择和超参数调整必须在验证数据上进行，这些数据不能用于训练，也不能用于最终测试，以避免有偏的性能估计（无数据泄露）。\n- LD 估计必须反映目标队列的血统和质控概况，以确保 $\\mathbf{R}$ 近似于所用 SNP 在目标队列中的 LD 结构。\n\n从以下选项中选择唯一最佳的流程，该流程正确地实施了 LDpred PRS 的构建，包括 LD 参考数据集的准备和超参数调整，同时遵循了这些原则。每个流程都使用相同的 GWAS 和目标数据，但在数据处理和调整策略上有所不同。\n\nA. 对 GWAS 和目标数据集进行严格的质量控制：在 GWAS 汇总统计数据中，移除插补信息分数  0.9、次要等位基因频率 (MAF)  0.01、有缺失标记或构建版本不匹配的 SNP；移除链模糊的 A/T 和 C/G SNP，如果其 MAF 接近 0.5，除非等位基因频率的一致性可以确认链方向；将等位基因与目标基因型编码进行协调。根据 $N_{\\text{cases}}$ 和 $N_{\\text{controls}}$ 计算 $N_{\\text{eff}}$ 以定义 $z_j = \\hat{\\beta}_j / \\mathrm{SE}_j$；在可用时确保使用每个 SNP 的样本量。准备 LD 参考：将外部的 $N_{\\text{ref}} = 20{,}000$ 欧洲人参考面板子集化，使其包含与 GWAS 和目标数据进行相同质控后相交的 SNP 集合，然后将每个 SNP 的基因型标准化为均值 0 和方差 1，并使用已建立的 LD 块计算一个块对角 LD 矩阵 $\\mathbf{R}$，将扩展区域（如主要组织相容性复合体 (MHC)）视为单个块或在调整期间排除它们。通过 LD 分数回归 (LDSC) 从 GWAS 估计 $h^2$，并限制在保留的 SNP 范围内；为 $p \\in \\{10^{-4}, 10^{-3}, 10^{-2}, 10^{-1}, 1\\}$ 定义一个网格，如果需要，也可以为 $h^2$ 定义一个以 LDSC 估计值为中心的适度网格。运行 LDpred，通过坐标步骤将汇总统计数据与 LD 参考对齐，使用具有足够预烧期和采样迭代次数的吉布斯采样器，并为每个网格点获取后验均值权重 $\\hat{w}_j(h^2,p)$。将目标队列划分为一个验证子集和一个无亲缘关系的保留测试子集；在验证子集上，计算 PRS $S_i = \\sum_j G_{ij} \\hat{w}_j$，并拟合一个逻辑回归模型，将病例状态对标准化的 PRS 进行回归，同时校正年龄、性别和前 10 个主成分 (PC)，以选择能最大化验证性能（例如，受试者工作特征曲线下面积 (AUC) 或伪 $R^2$）的 $(h^2,p)$。不需要重新拟合，因为 LDpred 使用的是外部汇总统计数据；最后，仅在保留的测试子集上评估一次所选的 PRS，报告 AUC 和校准度，并避免使用测试表型进行调整。\n\nB. 在 GWAS 和目标基因型之间协调等位基因，但不筛选链模糊的 SNP 以最大化覆盖率；直接从所有目标个体计算 LD 矩阵 $\\mathbf{R}$ 以最佳匹配目标 LD；将 $h^2$ 设为在整个目标队列上使用表型拟合的基因组亲缘关系限制模型得到的 REML（限制性最大似然）估计值；通过最大化在完整目标队列上计算的 AUC，从一个精细网格中选择 $p$；最后，使用选定的 $(h^2,p)$ 为所有目标个体计算 PRS，并在同一队列上报告性能。\n\nC. 首先通过在 $p  5 \\times 10^{-8}$ 处进行聚合和阈值化来减少 SNP，以限制为独立的全基因组显著变异；在仅限于这些 SNP 的整个目标基因型数据集上计算 LD 矩阵；将 $h^2$ 设为在目标表型上使用这些 SNP 通过 REML 估计的 SNP 遗传力；通过在完整目标队列上进行 $k$-折交叉验证来调整 $p$，然后使用选定的超参数在完整目标队列上重新计算 LDpred 权重，并在相同数据上进行评估。\n\nD. 使用 LDpred$2$-auto，并采用外部 LD 参考，除了 liftover 到正确的构建版本外，不进行明确的质控协调；让算法自动推断 $h^2$ 和 $p$；在所有目标个体上计算 PRS，并通过在完整目标队列上选择具有最高 AUC 的运行来确定最终的 PRS；不使用单独的验证或测试集划分。\n\n在所述原则和约束条件下，哪个选项最合适？",
            "solution": "用户要求对一个关于使用 LDpred 方法构建多基因风险评分 (PRS) 的问题进行批判性评估。任务是首先验证问题陈述的有效性，如果有效，则在给定选项中确定最合适的流程。\n\n### 问题验证\n\n**步骤 1：提取给定信息**\n\n*   **GWAS 数据：** 针对二元疾病性状的全基因组关联研究 (GWAS) 汇总统计数据。\n    *   队列：独立的欧洲血统。\n    *   样本量：$N_{\\text{cases}} = 50,000$ 例病例和 $N_{\\text{controls}} = 150,000$ 例对照。\n    *   报告的统计数据：每个单核苷酸多态性 (SNP) 的效应估计值 $\\hat{\\beta}_j$、标准误 $\\mathrm{SE}_j$、效应等位基因、其他等位基因、等位基因频率、插补信息分数以及每个 SNP 的样本量。\n*   **目标队列数据：**\n    *   队列：无亲缘关系的欧洲血统。\n    *   样本量：$N_{\\text{target}} = 100,000$。\n    *   数据：具有插补基因剂量的基因分型个体。\n*   **方法：** LDpred，一种考虑了连锁不平衡 (LD) 的贝叶斯收缩方法。\n*   **LD 参考面板数据：**\n    *   队列：外部的、血统匹配的欧洲人。\n    *   样本量：$N_{\\text{ref}} = 20,000$。\n    *   数据：无亲缘关系的个体，其基因分型和插补所用的参考构建版本与目标队列相同。\n*   **LDpred 要求（陈述的假设）：**\n    *   协调一致的 GWAS 汇总统计数据。\n    *   为所用 SNP 集合计算的 LD 矩阵 $\\mathbf{R}$。\n    *   超参数：SNP 遗传力 $h^2$ 和致病变异的比例 $p$。\n*   **基本原则：**\n    1.  PRS 公式：$S_i = \\sum_{j=1}^M G_{ij} w_j$。\n    2.  贝叶斯权重 $w_j$ 依赖于 LD 矩阵 $\\mathbf{R}$、GWAS 的 $z$-分数 $z_j = \\hat{\\beta}_j / \\mathrm{SE}_j$ 以及超参数 $(h^2, p)$。\n    3.  病例-对照研究的有效样本量：$N_{\\text{eff}} = \\frac{4}{\\frac{1}{N_{\\text{cases}}} + \\frac{1}{N_{\\text{controls}}}}$。\n    4.  模型选择必须使用与最终测试数据分开的验证数据，以防止有偏的性能估计（无数据泄露）。\n    5.  LD 估计必须使用一个能恰当反映目标队列血统和质控概况的参考面板。\n\n**步骤 2：使用提取的给定信息进行验证**\n\n根据验证标准评估问题陈述：\n\n*   **科学依据：** 该问题牢固地植根于成熟的统计遗传学领域。所描述的场景、方法（GWAS、LDpred、LD 分数回归）、数据类型和统计概念（$h^2$, $p$, $N_{\\text{eff}}$）都是标准的且表述准确。提供的 $N_{\\text{eff}}$ 公式是在某些假设下适用于二元性状的正确公式。\n*   **定义明确：** 该问题定义清晰。它提供了一个明确的目标（选择最佳流程）、充足的数据和背景（队列大小、数据类型、可用资源），以及一套指导评估的明确原则。预期会有一个唯一最佳答案。\n*   **客观性：** 该问题以精确、技术性的语言陈述，没有主观性或歧义。提供的基本原则是该领域的最佳实践基石，而非观点问题。\n\n**步骤 3：结论和行动**\n\n问题陈述是 **有效的**。它在科学上是合理的，定义明确，客观，并为评估所提议的流程提供了清晰的基础。因此，我将继续进行解答和选项分析。\n\n### 解答与选项分析\n\n构建和评估 PRS 的最佳流程必须遵守数据质量控制、LD 估计、超参数调整和模型评估的严格标准，以确保结果的稳健性和可推广性。一个核心原则是避免“数据泄露”，即来自测试集（或整个目标集）的信息被用于构建或调整模型，从而导致乐观偏误的性能估计。\n\n根据提供的原则，一个正确的流程应该：\n1.  对所有数据源（GWAS、LD 参考、目标基因型）执行严格的质量控制 (QC)，并将它们协调到一个具有对齐等位基因的高质量 SNP 公共集合。\n2.  使用外部的、血统匹配的 LD 参考面板来估计 LD 结构 ($\\mathbf{R}$)，而不是使用目标数据本身。\n3.  将目标队列划分为一个验证集和一个保留的测试集。\n4.  通过为一系列网格值构建 PRS 模型并在验证集上评估其性能来调整超参数（如 $p$）。\n5.  从验证步骤中选择性能最佳的超参数。\n6.  将最终模型（使用选定的超参数）仅应用于保留的测试集一次，以获得其性能的无偏估计。\n\n我们现在根据这些标准评估每个选项。\n\n**A. 流程 A**\n\n该流程描述了一个细致且在统计上合理的过程。\n*   **质控与协调：** 它正确地强调了对 GWAS 和目标数据进行严格的质控，包括按插补分数（ 0.9）、次要等位基因频率（MAF， 0.01）进行筛选，并妥善处理链模糊的 SNP。它正确地指明了必须协调等位基因。\n*   **LD 估计：** 它正确地使用外部的 $N_{\\text{ref}} = 20,000$ 欧洲人参考面板进行 LD 估计，并应用相同的质控以确保 SNP 的一致性。这避免了数据泄露。\n*   **超参数调整：** 它提出了一个合理的策略：使用 LD 分数回归 (LDSC) 从 GWAS 汇总统计数据中估计 $h^2$，并为 $p$ 定义一个网格。至关重要的是，它建议将目标队列划分为验证子集和测试子集。超参数网格在验证子集上进行评估，以找到能最大化性能指标（如受试者工作特征曲线下面积 (AUC)）的最佳 $(h^2, p)$ 对。这种划分可以防止对最终测试数据过拟合。\n*   **最终评估：** 然后将选择的 PRS 在保留的测试子集上进行评估，且仅评估一次，以报告最终的性能指标。这为模型在新数据上的预测能力提供了无偏的评估。\n\n该流程完全符合基本原则中概述的最佳实践。\n\n此选项的结论是：**正确**。\n\n**B. 流程 B**\n\n该流程包含多个严重缺陷。\n*   **质控与协调：** 它建议不筛选链模糊的 SNP 以“最大化覆盖率”。这是错误的做法，因为未处理的链模糊性可能导致效应被应用于错误的方向，从而严重降低 PRS 的准确性。\n*   **LD 估计：** 它建议直接从完整的目标队列计算 LD 矩阵 $\\mathbf{R}$。这是一种关键的数据泄露形式。目标个体的 LD 结构被用来构建模型，然后又在这些相同的个体上测试该模型。\n*   **超参数调整：** 它建议使用目标队列的表型（通过 REML）来估计 $h^2$，并通过最大化在完整目标队列上的性能来调整 $p$。这就是过拟合的定义。模型的参数是通过查看测试数据的答案（表型）来选择的。\n*   **最终评估：** 它在用于 LD 估计和超参数调整的同一队列上报告性能。由此产生的性能估计将是高度膨胀的，并且不具有可推广性。\n\n该流程违反了将训练/调整数据与测试数据分开的基本原则。\n\n此选项的结论是：**错误**。\n\n**C. 流程 C**\n\n该流程在方法上存在缺陷，并存在数据泄露问题。\n*   **方法论：** 它以“在 $p  5 \\times 10^{-8}$ 处进行聚合和阈值化”开始。这描述的是 C+T PRS 方法，而不是 LDpred。LDpred 的目的是利用所有 SNP 的信息并对其 LD 结构进行建模，这在概念上与 C+T 不同。将 LDpred 应用于一小部分聚合后的全基因组显著性 SNP，违背了其初衷。\n*   **LD 估计与超参数调整：** 与选项 B 类似，它建议使用整个目标队列的基因型和表型来计算 LD 矩阵和估计 $h^2$，这构成了数据泄露。它提到了在完整目标队列上进行 $k$-折交叉验证来进行调整，但随后又在相同的数据上进行评估，这无法得出对未见数据性能的无偏估计。为此需要一个单独的、保留的测试集。\n\n该流程误解了指定的方法 (LDpred)，并实施了一个存在严重数据泄露缺陷的程序。\n\n此选项的结论是：**错误**。\n\n**D. 流程 D**\n\n该流程使用了一个现代工具，但方式有误。\n*   **质控与协调：** 它建议“除了 liftover 到正确的构建版本外，不进行明确的质控协调”。这是不够的。Liftover 仅调整不同参考构建版本之间的基因组坐标；它不解决等位基因不匹配、链翻转或低质量变异等问题，而这些都是关键的错误来源。\n*   **模型选择与评估：** 它正确地指出 LDpred$2$-auto 可以推断超参数。然而，它建议通过“在完整目标队列上选择具有最高 AUC 的运行”来选择最终的 PRS。即使算法产生了多个候选模型，根据在整个目标集上的性能来选择最佳模型也是一种在测试集上进行超参数调整的形式。这会导致乐观偏误的性能指标。没有单独的验证/测试集划分是严重违反统计学最佳实践的行为。\n\n该流程使用了不当的质控过程，并在模型选择阶段造成了数据泄露。\n\n此选项的结论是：**错误**。\n\n**结论**\n\n流程 A 是唯一描述了使用 LDpred 构建 PRS 的完整、严谨且统计上有效的工作流程的选项。它正确地遵循了数据质控的原则，使用外部 LD 参考以避免数据泄露，并采用适当的验证/测试集划分来进行超参数调整和无偏的最终评估。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}