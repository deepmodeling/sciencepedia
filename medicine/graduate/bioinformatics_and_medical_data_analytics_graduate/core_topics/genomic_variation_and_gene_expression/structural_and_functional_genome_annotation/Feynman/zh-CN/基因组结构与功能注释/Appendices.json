{
    "hands_on_practices": [
        {
            "introduction": "基因组注释的核心任务之一是从头（ab initio）预测基因结构。本练习将引导您推导并应用广义隐马尔可夫模型（GHMM）的维特比算法 ，这是一种强大的统计框架，用于在给定DNA序列的情况下识别最可能的基因片段（如外显子）。通过这个实践，您将掌握许多现代基因预测工具背后的基本动态规划逻辑。",
            "id": "4611367",
            "problem": "一个基于广义隐马尔可夫模型 (GHMM) 的基因识别器，通过显式时长模型，将外显子片段建模为持续一段随机数量的核苷酸，该数量从指定的时长分布中抽取。考虑一个双状态 GHMM，其状态为基因间区（用 $I$ 表示）和外显子（用 $E$ 表示），它生成一个固定长度的观测脱氧核糖核酸 (DNA) 序列 $x_{1:L}$（字母表为 $\\{A,C,G,T\\}$）。该模型遵循以下生成性假设，这些假设基于隐马尔可夫模型 (HMM) 的定义和动态规划的最优性原理：路径和发射的联合概率可以分解为初始状态概率、片段到片段的转移概率、显式状态时长概率以及每个位置的发射概率的乘积。假设片段序列以概率 $1$ 从状态 $I$ 开始，各片段的时长在给定其状态的条件下是独立的，一个片段内的发射在给定状态的条件下是独立同分布的，并且片段转移只存在 $I \\to E$ 或 $E \\to I$（不存在创建相同标签的连续片段的自转移）。路径恰好在位置 $L$ 处终止。\n\n任务 1（推导）：从离散时间隐马尔可夫模型 (HMM) 的标准 Viterbi 算法出发，将动态规划递推扩展到具有外显子显式时长的 GHMM 情况。定义动态规划得分 $V(s,t)$ 为任何恰好在位置 $t$ 结束且状态为 $s \\in \\{I,E\\}$ 的分段的最大对数概率。通过考虑最终片段的所有可能时长 $d$ 和所有允许的前驱状态，推导出更新 $V(s,t)$ 的递推关系，该关系应使用转移概率 $a_{s',s}$、时长分布 $p_s(d)$ 和发射概率 $e_s(x)$ 来表示。明确指定 $t=0$ 时的基本情况。\n\n任务 2（在玩具序列上计算）：使用您推导出的递推关系，在以下参数化条件下，计算序列 $x_{1:6} = A\\,T\\,G\\,C\\,G\\,C$ 最可能分段的最大对数概率：\n- 初始状态：以概率 $1$ 从 $I$ 开始。\n- 片段转移：$a_{I,E} = 0.3$，$a_{E,I} = 1$，且创建相同状态的连续片段的转移概率为 0。\n- 显式时长：\n  - 对于基因间区，对所有整数 $d \\ge 1$，$p_I(d) = 0.5^{d}$。\n  - 对于外显子，$p_E(2) = 0.6$，$p_E(3) = 0.4$，对于所有其他 $d$，$p_E(d) = 0$。\n- 发射：\n  - 在基因间区，$e_I(A)=0.35$, $e_I(T)=0.35$, $e_I(C)=0.15$, $e_I(G)=0.15$。\n  - 在外显子区，$e_E(A)=0.10$, $e_E(T)=0.10$, $e_E(C)=0.40$, $e_E(G)=0.40$。\n- 路径必须恰好在 $t=L$ 处以 $I$ 或 $E$ 片段结束；最后一个片段之后的任何隐式终止的概率为 $1$。\n\n计算在此模型下，序列 $x_{1:6}$ 最可能路径和发射的联合概率的最大自然对数值。仅报告此最大自然对数值。将最终数值答案四舍五入到四位有效数字。不要报告路径或分段。答案无需单位。",
            "solution": "### 任务 1：GHMM Viterbi 递推的推导\n\n令 $V(s, t)$ 为观测到序列 $x_{1:t}$ 且最可能的路径（分段）在位置 $t$ 以状态 $s \\in \\{I, E\\}$ 的片段结束的最大对数概率。我们使用动态规划来计算这个值。\n\n一个在位置 $t$ 以状态 $s$ 的片段结束的路径，其最后一个片段的长度为 $d$（其中 $1 \\le d \\le t$）。这个片段从位置 $t-d+1$ 延伸到 $t$。根据最优性原理，这条最优路径必须是到达位置 $t-d$ 的最优路径的延伸。该前驱路径在 $t-d$ 处以某个状态 $s'$ 结束，其中 $s' \\neq s$（因为不允许自转移）。\n\n总对数概率是以下各项之和：\n1. 到达前驱状态 $V(s', t-d)$ 的最大对数概率。\n2. 从 $s'$ 转移到 $s$ 的对数转移概率 $\\ln(a_{s',s})$。\n3. 在状态 $s$ 停留时长为 $d$ 的对数概率 $\\ln(p_s(d))$。\n4. 从位置 $t-d+1$ 到 $t$ 观测到相应序列的对数发射概率 $\\sum_{i=t-d+1}^t \\ln(e_s(x_i))$。\n\n我们需要在所有可能的时长 $d$ 和前驱状态 $s'$ 上取最大值。\n**基本情况**：为了处理序列的开始，我们定义一个虚拟的起始位置 $t=0$。由于序列必须以状态 $I$ 的片段开始，我们将初始得分设为：\n$V(I, 0) = 0$\n$V(E, 0) = -\\infty$\n\n**递推关系**：对于 $t=1, \\dots, L$ 和 $s \\in \\{I,E\\}$：\n$V(s, t) = \\max_{1 \\le d \\le t} \\left( \\text{PrevScore}(s, t, d) + \\ln(p_s(d)) + \\sum_{i=t-d+1}^t \\ln(e_s(x_i)) \\right)$\n其中 `PrevScore` 是前驱路径的得分。\n对于状态 $I$：前驱状态必须是 $E$。\n$\\text{PrevScore}(I, t, d) = V(E, t-d) + \\ln(a_{E,I})$\n但是，如果片段 $I$ 是序列的第一个片段（即 $d=t$），则没有前驱片段。其得分来自 $V(I,0)=0$。因此，\n$V(I, t) = \\max \\left( \\max_{1 \\le d < t} \\left[ V(E, t-d) + \\ln(a_{E,I}) + \\ln(p_I(d)) + S_I(t-d+1, t) \\right], \\ln(p_I(t)) + S_I(1,t) \\right)$\n其中 $S_s(i,j) = \\sum_{k=i}^j \\ln(e_s(x_k))$ 是累积对数发射概率。\n\n对于状态 $E$：前驱状态必须是 $I$。\n$\\text{PrevScore}(E, t, d) = V(I, t-d) + \\ln(a_{I,E})$\n由于 $V(E,0)=-\\infty$，所以状态 $E$ 不可能是第一个片段。\n$V(E, t) = \\max_{1 \\le d \\le t} \\left[ V(I, t-d) + \\ln(a_{I,E}) + \\ln(p_E(d)) + S_E(t-d+1, t) \\right]$\n\n最终，整个序列的最大对数概率是 $\\max(V(I,L), V(E,L))$。\n\n### 任务 2：计算\n\n首先，计算所有必需的对数概率值：\n- $\\ln(a_{I,E}) = \\ln(0.3) \\approx -1.2040$\n- $\\ln(a_{E,I}) = \\ln(1) = 0$\n- $\\ln(p_I(d)) = d \\cdot \\ln(0.5) \\approx -0.6931 \\cdot d$\n- $\\ln(p_E(2)) = \\ln(0.6) \\approx -0.5108$\n- $\\ln(p_E(3)) = \\ln(0.4) \\approx -0.9163$\n- $\\ln(e_I(A/T)) \\approx -1.0498$; $\\ln(e_I(C/G)) \\approx -1.8971$\n- $\\ln(e_E(A/T)) \\approx -2.3026$; $\\ln(e_E(C/G)) \\approx -0.9163$\n\n序列 $x_{1:6} = ATGCGC$。\n\n**DP 表计算**\n$V(s, t)$\n\n$t=1$: $A$\n$V(I,1) = \\ln(p_I(1)) + \\ln(e_I(A)) = -0.6931 - 1.0498 = -1.7429$\n$V(E,1) = -\\infty$ (因为 $V(I,0)=-\\infty$ 且最小 $d=2$)\n\n$t=2$: $AT$\n$V(I,2) = \\ln(p_I(2)) + \\ln(e_I(A))+\\ln(e_I(T)) = -1.3862 - 1.0498 - 1.0498 = -3.4858$\n$V(E,2) = -\\infty$ (因为 $V(I,0)=-\\infty$)\n\n$t=3$: $ATG$\n$V(I,3) = \\ln(p_I(3)) + S_I(1,3) = -2.0793 + (-1.0498-1.0498-1.8971) = -6.0760$\n$V(E,3) = V(I,1) + \\ln(a_{I,E}) + \\ln(p_E(2)) + S_E(2,3) = -1.7429 - 1.2040 - 0.5108 + (-2.3026-0.9163) = -6.6766$\n\n$t=4$: $ATGC$\n$V(I,4) = \\max \\begin{cases} \\text{来自I(4): } \\ln(p_I(4)) + S_I(1,4) = -2.7724 - 5.8938 = -8.6662 \\\\ \\text{来自E(3)→I(1): } V(E,3) + \\ln(a_{E,I}) + \\ln(p_I(1)) + S_I(4,4) = -6.6766+0-0.6931-1.8971 = -9.2668 \\end{cases} = -8.6662$\n$V(E,4) = \\max \\begin{cases} \\text{来自I(2)→E(2): } V(I,2)+\\ln(a_{I,E})+\\ln(p_E(2))+S_E(3,4) = -3.4858-1.2040-0.5108-1.8326 = -7.0332 \\\\ \\text{来自I(1)→E(3): } V(I,1)+\\ln(a_{I,E})+\\ln(p_E(3))+S_E(2,4) = -1.7429-1.2040-0.9163-4.1352 = -7.9984 \\end{cases} = -7.0332$\n\n$t=5$: $ATGCG$\n$V(I,5) = \\max \\begin{cases} \\text{来自I(5): } \\ln(p_I(5)) + S_I(1,5) = -3.4655 - 7.7909 = -11.2564 \\\\ \\text{来自E(4)→I(1): } V(E,4) + \\ln(p_I(1)) + S_I(5,5) = -7.0332-0.6931-1.8971 = -9.6234 \\\\ \\text{来自E(3)→I(2): } V(E,3) + \\ln(p_I(2)) + S_I(4,5) = -6.6766-1.3862-3.7942 = -11.857 \\end{cases} = -9.6234$\n$V(E,5) = \\max \\begin{cases} \\text{来自I(3)→E(2): } V(I,3)+\\ln(a_{I,E})+\\ln(p_E(2))+S_E(4,5) = -6.0760-1.2040-0.5108-1.8326 = -9.6234 \\\\ \\text{来自I(2)→E(3): } V(I,2)+\\ln(a_{I,E})+\\ln(p_E(3))+S_E(3,5) = -3.4858-1.2040-0.9163-2.7489 = -8.3550 \\end{cases} = -8.3550$\n\n$t=6$: $ATGCGC$\n$V(I,6) = \\max \\begin{cases} \\text{来自I(6): } -13.8466 \\\\ \\text{来自E(5)→I(1): } V(E,5) + \\ln(p_I(1)) + S_I(6,6) = -8.3550-0.6931-1.8971 = -10.9452 \\\\ \\text{来自E(4)→I(2): } V(E,4) + \\ln(p_I(2)) + S_I(5,6) = -7.0332-1.3862-3.7942 = -12.2136 \\end{cases} = -10.9452$\n$V(E,6) = \\max \\begin{cases} \\text{来自I(4)→E(2): } V(I,4)+\\ln(a_{I,E})+\\ln(p_E(2))+S_E(5,6) = -8.6662-1.2040-0.5108-1.8326 = -12.2136 \\\\ \\text{来自I(3)→E(3): } V(I,3)+\\ln(a_{I,E})+\\ln(p_E(3))+S_E(4,6) = -6.0760-1.2040-0.9163-2.7489 = -10.9452 \\end{cases} = -10.9452$\n\n**最终得分**\n最大对数概率为 $\\max(V(I,6), V(E,6)) = \\max(-10.9452, -10.9452) = -10.9452$。\n四舍五入到四位有效数字，结果是 $-10.95$。",
            "answer": "$$\n\\boxed{-10.95}\n$$"
        },
        {
            "introduction": "真实的基因组注释流程很少只依赖单一证据来源，而是需要整合多种冲突的数据。本练习探讨了如何使用贝叶斯决策理论 ，以一种有原则的方式解决来自RNA测序和蛋白质同源性比对的矛盾证据。这个练习将教会您如何通过最小化预期损失来做出最优决策，这是在充满不确定性的生物数据中进行稳健推断的关键技能。",
            "id": "4611300",
            "problem": "在一个结构和功能基因组注释下的基因模型中，存在一个有争议的外显子边界，对此有两种相互竞争的假说：由核糖核酸测序（RNA-seq）建议的边界，记为$H_{R}$，以及由蛋白质同源性比对建议的边界，记为$H_{P}$。注释流程必须选择一个边界，以便在给定的损失函数下最大化预期准确性，同时考虑来自RNA-seq剪接接头和蛋白质同源性比对分数的观测证据$d$。\n\n使用以下基础依据：\n- 分子生物学的中心法则指出，基因编码信使核糖核酸（mRNA），后者再翻译成蛋白质。外显子边界决定了编码框；错误的注释可能导致移码或功能域截断。\n- 贝叶斯决策理论：后验概率由贝叶斯定理给出，最优行动是最小化预期损失。形式上，后验优势满足$$\\frac{P(H_{R}\\,|\\,d)}{P(H_{P}\\,|\\,d)}=\\frac{\\pi_{R}}{\\pi_{P}} \\cdot \\frac{p(d\\,|\\,H_{R})}{p(d\\,|\\,H_{P})},$$ 其中$\\pi_{R}$和$\\pi_{P}$是先验概率，而$p(d\\,|\\,H)$是在假说$H$下证据的似然。\n\n假设在给定真实边界的情况下，RNA-seq和蛋白质同源性证据是条件独立的，因此$$p(d\\,|\\,H)=p(d_{\\mathrm{RNA}}\\,|\\,H)\\cdot p(d_{\\mathrm{PROT}}\\,|\\,H)。$$ 先验概率由剪接基序强度和比较基因组学信息决定：$$\\pi_{R}=0.6,\\quad \\pi_{P}=0.4。$$ 在每个假说下，观测数据$d$的似然（从一个校准的关于剪接接头读数计数和比对分数的生成模型中估计）如下：\n- RNA-seq剪接证据：$$p(d_{\\mathrm{RNA}}\\,|\\,H_{R})=0.92,\\quad p(d_{\\mathrm{RNA}}\\,|\\,H_{P})=0.12。$$\n- 蛋白质同源性证据：$$p(d_{\\mathrm{PROT}}\\,|\\,H_{R})=0.35,\\quad p(d_{\\mathrm{PROT}}\\,|\\,H_{P})=0.78。$$\n\n由于潜在的移码与框内截断的后果不同，损失函数对错误选择的惩罚是不对称的：\n- 当$H_{P}$为真时选择$H_{R}$，造成的损失为$$L(H_{R},H_{P})=9。$$\n- 当$H_{R}$为真时选择$H_{P}$，造成的损失为$$L(H_{P},H_{R})=3。$$\n- 选择真实的边界不产生损失：$$L(H_{R},H_{R})=0,\\quad L(H_{P},H_{P})=0。$$\n\n任务：\n1. 从贝叶斯定理和预期损失的定义出发，推导一个以最小化预期损失为目标的决策规则，该规则用后验优势$\\frac{P(H_{R}\\,|\\,d)}{P(H_{P}\\,|\\,d)}$和损失比表示。\n2. 使用提供的先验概率和似然，计算后验优势，并应用该决策规则来选择最优边界。\n3. 将你的最终选择表示为一个无单位的数字：如果最优行动是选择RNA-seq支持的边界$H_{R}$，则输出$0$；如果最优行动是选择蛋白质同源性支持的边界$H_{P}$，则输出$1$。\n\n最终选择无需四舍五入。所有步骤都必须基于所述基础进行论证，不得援引任何未提供的快捷公式。",
            "solution": "### 第1步：提取已知条件\n- **假说**：$H_{R}$（来自RNA-seq的边界），$H_{P}$（来自蛋白质同源性的边界）。\n- **证据**：$d = (d_{\\mathrm{RNA}}, d_{\\mathrm{PROT}})$。\n- **贝叶斯框架**：\n  - 后验优势：$\\frac{P(H_{R}\\,|\\,d)}{P(H_{P}\\,|\\,d)}=\\frac{\\pi_{R}}{\\pi_{P}} \\cdot \\frac{p(d\\,|\\,H_{R})}{p(d\\,|\\,H_{P})}$。\n  - 条件独立性：$p(d\\,|\\,H)=p(d_{\\mathrm{RNA}}\\,|\\,H)\\cdot p(d_{\\mathrm{PROT}}\\,|\\,H)$。\n- **先验概率**：$\\pi_{R} = P(H_{R}) = 0.6$，$\\pi_{P} = P(H_{P}) = 0.4$。\n- **RNA-seq证据的似然($d_{\\mathrm{RNA}}$)**：\n  - $p(d_{\\mathrm{RNA}}\\,|\\,H_{R}) = 0.92$。\n  - $p(d_{\\mathrm{RNA}}\\,|\\,H_{P}) = 0.12$。\n- **蛋白质同源性证据的似然($d_{\\mathrm{PROT}}$)**：\n  - $p(d_{\\mathrm{PROT}}\\,|\\,H_{R}) = 0.35$。\n  - $p(d_{\\mathrm{PROT}}\\,|\\,H_{P}) = 0.78$。\n- **损失函数 ($L(\\text{行动}, \\text{真相})$)**：\n  - $L(H_{R}, H_{P}) = 9$。\n  - $L(H_{P}, H_{R}) = 3$。\n  - $L(H_{R}, H_{R}) = 0$。\n  - $L(H_{P}, H_{P}) = 0$。\n- **任务**：\n  1. 推导一个最小化预期损失的决策规则。\n  2. 计算后验优势并应用该规则。\n  3. 选择$H_{R}$输出$0$，选择$H_{P}$输出$1$。\n\n### 第2步：使用提取的已知条件进行验证\n问题评估如下：\n- **科学依据**：该问题基于生物信息学和分子生物学的原理，特别是基因组注释。使用贝叶斯决策理论来整合来自RNA-seq和蛋白质同源性的冲突证据是一种标准且科学合理的方法。\n- **适定性**：该问题是适定的。它提供了所有必要的信息：一套完整的假说，和为1的先验概率（$0.6 + 0.4 = 1$），在每个假说下关于证据的一整套似然值，以及一个明确定义的损失函数。任务是具体的，并导向一个唯一的、可计算的解。\n- **客观性**：问题以精确、定量和客观的语言陈述，没有歧义或主观陈述。\n\n该问题未表现出任何列举的无效性缺陷。它在科学上是合理的，形式上是明确的，信息是完整的，且逻辑上是一致的。\n\n### 第3步：结论与行动\n问题有效。下面提供完整的解答。\n\n### 任务1：决策规则的推导\n\n目标是选择一个行动，即选择$H_R$或$H_P$，以最小化预期损失。该期望是在给定观测证据$d$的条件下，对所有可能的自然真实状态（$H_R$或$H_P$）求得的。为此，我们使用后验概率$P(H_{R}\\,|\\,d)$和$P(H_{P}\\,|\\,d)$。\n\n选择行动$H_R$的预期损失，记为$E[L|a=H_R]$，是：\n$$ E[L\\,|\\,a=H_{R}] = L(H_{R}, H_{R}) \\cdot P(H_{R}\\,|\\,d) + L(H_{R}, H_{P}) \\cdot P(H_{P}\\,|\\,d) $$\n鉴于$L(H_{R}, H_{R}) = 0$，这可简化为：\n$$ E[L\\,|\\,a=H_{R}] = L(H_{R}, H_{P}) \\cdot P(H_{P}\\,|\\,d) $$\n\n选择行动$H_P$的预期损失，记为$E[L|a=H_P]$，是：\n$$ E[L\\,|\\,a=H_{P}] = L(H_{P}, H_{R}) \\cdot P(H_{R}\\,|\\,d) + L(H_{P}, H_{P}) \\cdot P(H_{P}\\,|\\,d) $$\n鉴于$L(H_{P}, H_{P}) = 0$，这可简化为：\n$$ E[L\\,|\\,a=H_{P}] = L(H_{P}, H_{R}) \\cdot P(H_{R}\\,|\\,d) $$\n\n为了最小化预期损失，如果选择行动$H_R$的预期损失小于选择$H_P$的预期损失，我们就应该选择$H_R$。也就是说，我们选择$H_R$如果：\n$$ E[L\\,|\\,a=H_{R}]  E[L\\,|\\,a=H_{P}] $$\n代入预期损失的表达式：\n$$ L(H_{R}, H_{P}) \\cdot P(H_{P}\\,|\\,d)  L(H_{P}, H_{R}) \\cdot P(H_{R}\\,|\\,d) $$\n为了用后验优势来表示，我们重排不等式。由于后验概率和损失都是非负的，并假设$P(H_{P}\\,|\\,d) > 0$和$L(H_{P}, H_{R}) > 0$，我们可以进行除法而不改变不等式的方向：\n$$ \\frac{L(H_{R}, H_{P})}{L(H_{P}, H_{R})}  \\frac{P(H_{R}\\,|\\,d)}{P(H_{P}\\,|\\,d)} $$\n这就是所期望的决策规则：如果支持$H_R$的后验优势大于错误决策的损失比，则选择$H_R$。反之，如果后验优势小于损失比，则选择$H_P$。\n\n### 任务2：计算与应用决策规则\n\n首先，我们根据给定的损失函数计算损失比：\n$$ \\text{损失比} = \\frac{L(H_{R}, H_{P})}{L(H_{P}, H_{R})} = \\frac{9}{3} = 3 $$\n因此，决策规则是：如果 $\\frac{P(H_{R}\\,|\\,d)}{P(H_{P}\\,|\\,d)} > 3$，则选择 $H_R$。\n\n接下来，我们使用提供的公式和数据计算后验优势。后验优势是先验优势与贝叶斯因子（似然比）的乘积。\n先验优势是：\n$$ \\frac{\\pi_{R}}{\\pi_{P}} = \\frac{0.6}{0.4} = 1.5 $$\n贝叶斯因子 $BF$ 是似然比，由于证据的条件独立性，其表达式为：\n$$ BF = \\frac{p(d\\,|\\,H_{R})}{p(d\\,|\\,H_{P})} = \\frac{p(d_{\\mathrm{RNA}}\\,|\\,H_{R}) \\cdot p(d_{\\mathrm{PROT}}\\,|\\,H_{R})}{p(d_{\\mathrm{RNA}}\\,|\\,H_{P}) \\cdot p(d_{\\mathrm{PROT}}\\,|\\,H_{P})} $$\n代入给定的似然值：\n$$ BF = \\frac{0.92 \\cdot 0.35}{0.12 \\cdot 0.78} = \\frac{0.322}{0.0936} $$\n现在，我们计算后验优势：\n$$ \\frac{P(H_{R}\\,|\\,d)}{P(H_{P}\\,|\\,d)} = \\frac{\\pi_{R}}{\\pi_{P}} \\cdot BF = 1.5 \\cdot \\frac{0.322}{0.0936} = \\frac{0.483}{0.0936} $$\n为了将此值与损失比 $3$ 进行比较，我们可以执行除法：\n$$ \\frac{0.483}{0.0936} \\approx 5.16025... $$\n或者，我们可以不进行除法直接比较：\n$\\frac{0.483}{0.0936} > 3$ 是否成立？\n这等价于问 $0.483 > 3 \\cdot 0.0936$ 是否成立。\n$3 \\cdot 0.0936 = 0.2808$。\n因为 $0.483 > 0.2808$，所以不等式成立。\n\n后验优势（约 5.16）大于损失比（3）。\n根据我们推导的决策规则，最优行动是选择RNA-seq支持的边界 $H_R$。\n\n### 任务3：最终选择\n题目要求如果最优行动是选择$H_R$则输出$0$，如果最优行动是选择$H_P$则输出$1$。由于我们的分析结论是选择$H_R$是最小化预期损失的最优行动，因此最终输出为$0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "在开发或应用任何注释工具后，量化其准确性是至关重要的一步。本练习将带您从第一性原理出发，定义和计算评估基因注释质量的基本指标，包括基于核苷酸的精确率、召回率和F1分数，以及更复杂的基于特征（如外显子对象）的评估 。掌握这些指标对于比较不同注释策略的性能和理解它们的优缺点至关重要。",
            "id": "4611315",
            "problem": "一个结构基因组注释系统在一个连续的基因组位点上，与一个经过整理的基准真相进行评估。在结构注释中，外显子表示为具有整数坐标的闭合基因组区间，评估可以在碱基水平（逐个核苷酸）或特征水平（整个外显子对象）上进行。从基本原理开始：集合、整数坐标上的计数测度，以及混淆矩阵的定义。使用这些原理，形式化地定义碱基水平的精确率、召回率、精确率和召回率的调和平均数（F1分数），以及基于明确匹配规则的特征水平对应指标。然后，为所提供的数据计算这些指标。\n\n使用的基本依据和定义：\n- 考虑一个位点，其整数坐标集为 $\\Omega \\subset \\mathbb{Z}$，计数测度为 $\\mu$。对于任意有限子集 $A \\subset \\Omega$，$\\mu$ 赋予其值 $\\mu(A)$，该值等于 $A$ 中元素的数量。\n- 设基准真相外显子集为 $\\Omega$ 上的一个有限闭区间集合，$T = \\{[s_i, e_i]\\}_{i=1}^{n}$，其中 $s_i, e_i \\in \\mathbb{Z}$ 且 $s_i \\leq e_i$。基准真相所覆盖的碱基并集为 $U_T = \\bigcup_{i=1}^{n} [s_i, e_i]$。\n- 设预测外显子集为 $P = \\{[a_j, b_j]\\}_{j=1}^{m}$，预测所覆盖的碱基并集为 $U_P = \\bigcup_{j=1}^{m} [a_j, b_j]$。\n- 碱基水平的混淆计数由集合定义：真阳性碱基 $TP_{\\text{b}} = \\mu(U_P \\cap U_T)$，假阳性碱基 $FP_{\\text{b}} = \\mu(U_P \\setminus U_T)$，以及假阴性碱基 $FN_{\\text{b}} = \\mu(U_T \\setminus U_P)$。\n- 碱基水平精确率为 $P_{\\text{b}} = \\frac{TP_{\\text{b}}}{TP_{\\text{b}} + FP_{\\text{b}}}$，碱基水平召回率为 $R_{\\text{b}} = \\frac{TP_{\\text{b}}}{TP_{\\text{b}} + FN_{\\text{b}}}$，碱基水平F1分数为 $F1_{\\text{b}} = \\frac{2 P_{\\text{b}} R_{\\text{b}}}{P_{\\text{b}} + R_{\\text{b}}}$。\n- 特征水平评估将外显子视为原子特征。定义一个预测区间 $[a,b]$ 和一个基准真相区间 $[s,e]$ 之间的交并比（IoU），也称为杰卡德指数，为 $\\mathrm{IoU}([a,b],[s,e]) = \\frac{\\mu([a,b] \\cap [s,e])}{\\mu([a,b] \\cup [s,e])}$。使用一对一匹配协议：按IoU降序贪婪地构建匹配，每个预测外显子和每个基准真相外显子最多只允许一个匹配，并且当且仅当其IoU至少为阈值 $\\tau = 0.5$ 时，才宣布一个匹配为有效。在此协议下，特征水平真阳性 $TP_{\\text{f}}$ 是有效匹配的数量，特征水平假阳性 $FP_{\\text{f}}$ 是未匹配的预测外显子的数量，特征水平假阴性 $FN_{\\text{f}}$ 是未匹配的基准真相外显子的数量。\n- 特征水平精确率为 $P_{\\text{f}} = \\frac{TP_{\\text{f}}}{TP_{\\text{f}} + FP_{\\text{f}}}$，特征水平召回率为 $R_{\\text{f}} = \\frac{TP_{\\text{f}}}{TP_{\\text{f}} + FN_{\\text{f}}}$，特征水平F1分数为 $F1_{\\text{f}} = \\frac{2 P_{\\text{f}} R_{\\text{f}}}{P_{\\text{f}} + R_{\\text{f}}}$。\n\n数据：\n- 基准真相外显子 $T$：$[1000,1199]$, $[1500,1699]$, $[2000,2199]$。\n- 预测外显子 $P$：$[995,1205]$, $[1600,1799]$, $[1900,2099]$, $[3000,3099]$。\n- 所有长度都包含性计算：区间 $[x,y]$ 的长度为 $y - x + 1$。\n\n任务：\n1. 使用上述基本定义，计算 $TP_{\\text{b}}$、$FP_{\\text{b}}$ 和 $FN_{\\text{b}}$，然后计算 $P_{\\text{b}}$、$R_{\\text{b}}$ 和 $F1_{\\text{b}}$。\n2. 使用基于IoU且阈值为 $\\tau = 0.5$ 的一对一匹配，计算 $TP_{\\text{f}}$、$FP_{\\text{f}}$ 和 $FN_{\\text{f}}$，然后计算 $P_{\\text{f}}$、$R_{\\text{f}}$ 和 $F1_{\\text{f}}$。\n\n将报告的每个指标四舍五入到四位有效数字，并以小数形式表示。按以下顺序报告您的六个指标：碱基水平精确率、碱基水平召回率、碱基水平F1分数、特征水平精确率、特征水平召回率、特征水平F1分数。",
            "solution": "问题陈述已经过验证，被认为是可靠的。它以标准生物信息学评估方法为科学依据，问题设定良好，拥有一套完整且一致的定义和数据，并以客观、正式的语言表达。根据所提供的信息可以推导出唯一解。我们现在开始解答，根据任务分为两部分。\n\n第1部分：碱基水平评估\n\n基准真相注释包含一个由 $n=3$ 个外显子组成的集合，$T = \\{T_1, T_2, T_3\\}$，其中 $T_1 = [1000, 1199]$，$T_2 = [1500, 1699]$，$T_3 = [2000, 2199]$。预测注释包含一个由 $m=4$ 个外显子组成的集合，$P = \\{P_1, P_2, P_3, P_4\\}$，其中 $P_1 = [995, 1205]$，$P_2 = [1600, 1799]$，$P_3 = [1900, 2099]$，$P_4 = [3000, 3099]$。一个整数坐标集的测度是其基数，对于区间 $[x,y]$，测度为 $\\mu([x,y]) = y-x+1$。\n\n首先，我们计算基准真相中的碱基总数 $\\mu(U_T)$ 和预测中的碱基总数 $\\mu(U_P)$。$T$ 中的区间是不相交的，$P$ 中的区间也是不相交的。\n基准真相外显子的长度为：\n$\\mu(T_1) = 1199 - 1000 + 1 = 200$\n$\\mu(T_2) = 1699 - 1500 + 1 = 200$\n$\\mu(T_3) = 2199 - 2000 + 1 = 200$\n基准真相碱基的并集为 $U_T = T_1 \\cup T_2 \\cup T_3$，其测度为 $\\mu(U_T) = \\mu(T_1) + \\mu(T_2) + \\mu(T_3) = 200 + 200 + 200 = 600$。这对应于基准真相中的阳性实例总数（$TP_{\\text{b}} + FN_{\\text{b}}$）。\n\n预测外显子的长度为：\n$\\mu(P_1) = 1205 - 995 + 1 = 211$\n$\\mu(P_2) = 1799 - 1600 + 1 = 200$\n$\\mu(P_3) = 2099 - 1900 + 1 = 200$\n$\\mu(P_4) = 3099 - 3000 + 1 = 100$\n预测碱基的并集为 $U_P = P_1 \\cup P_2 \\cup P_3 \\cup P_4$，其测度为 $\\mu(U_P) = \\mu(P_1) + \\mu(P_2) + \\mu(P_3) + \\mu(P_4) = 211 + 200 + 200 + 100 = 711$。这对应于预测的阳性实例总数（$TP_{\\text{b}} + FP_{\\text{b}}$）。\n\n接下来，我们确定真阳性碱基的集合，即两个并集的交集 $U_P \\cap U_T$。我们找到构成区间的交集：\n$P_1 \\cap T_1 = [995, 1205] \\cap [1000, 1199] = [1000, 1199]$。其测度为 $\\mu([1000, 1199]) = 200$。\n$P_2 \\cap T_2 = [1600, 1799] \\cap [1500, 1699] = [1600, 1699]$。其测度为 $\\mu([1600, 1699]) = 100$。\n$P_3 \\cap T_3 = [1900, 2099] \\cap [2000, 2199] = [2000, 2099]$。其测度为 $\\mu([2000, 2099]) = 100$。\n来自 $P$ 和 $T$ 的区间的所有其他两两相交的结果均为空集。\n真阳性碱基的测度是这些不相交的交集的测度之和：\n$TP_{\\text{b}} = \\mu(U_P \\cap U_T) = 200 + 100 + 100 = 400$。\n\n现在我们可以计算假阳性和假阴性碱基的数量：\n$FP_{\\text{b}} = \\mu(U_P \\setminus U_T) = \\mu(U_P) - \\mu(U_P \\cap U_T) = 711 - 400 = 311$。\n$FN_{\\text{b}} = \\mu(U_T \\setminus U_P) = \\mu(U_T) - \\mu(U_P \\cap U_T) = 600 - 400 = 200$。\n\n使用这些计数，我们计算碱基水平的精确率（$P_{\\text{b}}$）、召回率（$R_{\\text{b}}$）和 F1 分数（$F1_{\\text{b}}$）：\n$P_{\\text{b}} = \\frac{TP_{\\text{b}}}{TP_{\\text{b}} + FP_{\\text{b}}} = \\frac{400}{400 + 311} = \\frac{400}{711} \\approx 0.5625879...$\n$R_{\\text{b}} = \\frac{TP_{\\text{b}}}{TP_{\\text{b}} + FN_{\\text{b}}} = \\frac{400}{400 + 200} = \\frac{400}{600} = \\frac{2}{3} \\approx 0.666666...$\n$F1_{\\text{b}} = \\frac{2 P_{\\text{b}} R_{\\text{b}}}{P_{\\text{b}} + R_{\\text{b}}} = \\frac{2 TP_{\\text{b}}}{2 TP_{\\text{b}} + FP_{\\text{b}} + FN_{\\text{b}}} = \\frac{2 \\cdot 400}{2 \\cdot 400 + 311 + 200} = \\frac{800}{1311} \\approx 0.6102212...$\n\n四舍五入到四位有效数字，碱基水平的指标为：$P_{\\text{b}} = 0.5626$，$R_{\\text{b}} = 0.6667$，$F1_{\\text{b}} = 0.6102$。\n\n第2部分：特征水平评估\n\n对于特征水平评估，我们根据交并比（IoU）将预测外显子与基准真相外显子进行配对，阈值为 $\\tau = 0.5$。匹配是一对一且贪婪的，按IoU降序进行。\n$\\mathrm{IoU}([a,b],[s,e]) = \\frac{\\mu([a,b] \\cap [s,e])}{\\mu([a,b] \\cup [s,e])} = \\frac{\\mu([a,b] \\cap [s,e])}{\\mu([a,b]) + \\mu([s,e]) - \\mu([a,b] \\cap [s,e])}$。\n\n我们计算所有具有非空交集的配对 $(P_j, T_i)$ 的IoU：\n1.  对于 $(P_1, T_1)$: $\\mu(P_1 \\cap T_1) = 200$。 $\\mu(P_1) = 211$，$\\mu(T_1) = 200$。\n    $\\mathrm{IoU}(P_1, T_1) = \\frac{200}{211 + 200 - 200} = \\frac{200}{211} \\approx 0.947867$。\n2.  对于 $(P_2, T_2)$: $\\mu(P_2 \\cap T_2) = 100$。 $\\mu(P_2) = 200$，$\\mu(T_2) = 200$。\n    $\\mathrm{IoU}(P_2, T_2) = \\frac{100}{200 + 200 - 100} = \\frac{100}{300} = \\frac{1}{3} \\approx 0.333333$。\n3.  对于 $(P_3, T_3)$: $\\mu(P_3 \\cap T_3) = 100$。 $\\mu(P_3) = 200$，$\\mu(T_3) = 200$。\n    $\\mathrm{IoU}(P_3, T_3) = \\frac{100}{200 + 200 - 100} = \\frac{100}{300} = \\frac{1}{3} \\approx 0.333333$。\n\n所有其他配对的交集为 $\\emptyset$，因此IoU为 $0$。\n非零IoU配对按降序排列的列表是：$(\\mathrm{IoU}(P_1, T_1) \\approx 0.9479)$，$(\\mathrm{IoU}(P_2, T_2) \\approx 0.3333)$，$(\\mathrm{IoU}(P_3, T_3) \\approx 0.3333)$。\n\n应用贪婪匹配协议：\n1.  最高IoU是 $\\mathrm{IoU}(P_1, T_1) \\approx 0.9479$，大于阈值 $\\tau=0.5$。我们接受这是一个有效匹配。$P_1$ 和 $T_1$现在被视为已匹配。\n2.  次高的IoU是 $\\mathrm{IoU}(P_2, T_2) \\approx 0.3333$，小于 $\\tau=0.5$。这不是一个有效匹配。\n3.  再次高的IoU是 $\\mathrm{IoU}(P_3, T_3) \\approx 0.3333$，也小于 $\\tau=0.5$。这不是一个有效匹配。\n\n因此，只有一个有效匹配：$(P_1, T_1)$。我们现在计算特征水平的混淆计数：\n$TP_{\\text{f}}$ = 有效匹配数 = $1$。\n$FP_{\\text{f}}$ = 未匹配的预测外显子数 = $|\\{P_2, P_3, P_4\\}| = 3$。\n$FN_{\\text{f}}$ = 未匹配的基准真相外显子数 = $|\\{T_2, T_3\\}| = 2$。\n预测总数为 $m = TP_{\\text{f}} + FP_{\\text{f}} = 1 + 3 = 4$。基准真相特征总数为 $n = TP_{\\text{f}} + FN_{\\text{f}} = 1 + 2 = 3$。这些计数是一致的。\n\n使用这些计数，我们计算特征水平的精确率（$P_{\\text{f}}$）、召回率（$R_{\\text{f}}$）和 F1 分数（$F1_{\\text{f}}$）：\n$P_{\\text{f}} = \\frac{TP_{\\text{f}}}{TP_{\\text{f}} + FP_{\\text{f}}} = \\frac{1}{1 + 3} = \\frac{1}{4} = 0.25$。\n$R_{\\text{f}} = \\frac{TP_{\\text{f}}}{TP_{\\text{f}} + FN_{\\text{f}}} = \\frac{1}{1 + 2} = \\frac{1}{3} \\approx 0.333333...$\n$F1_{\\text{f}} = \\frac{2 P_{\\text{f}} R_{\\text{f}}}{P_{\\text{f}} + R_{\\text{f}}} = \\frac{2 \\cdot (1/4) \\cdot (1/3)}{(1/4) + (1/3)} = \\frac{2/12}{7/12} = \\frac{2}{7} \\approx 0.285714...$\n\n四舍五入到四位有效数字，特征水平的指标为：$P_{\\text{f}} = 0.2500$，$R_{\\text{f}} = 0.3333$，$F1_{\\text{f}} = 0.2857$。\n\n最终指标总结：\n碱基水平精确率 ($P_{\\text{b}}$): $0.5626$\n碱基水平召回率 ($R_{\\text{b}}$): $0.6667$\n碱基水平F1 ($F1_{\\text{b}}$): $0.6102$\n特征水平精确率 ($P_{\\text{f}}$): $0.2500$\n特征水平召回率 ($R_{\\text{f}}$): $0.3333$\n特征水平F1 ($F1_{\\text{f}}$): $0.2857$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.5626  0.6667  0.6102  0.2500  0.3333  0.2857\n\\end{pmatrix}\n}\n$$"
        }
    ]
}