{
    "hands_on_practices": [
        {
            "introduction": "机器学习模型的质量从根本上受限于其训练数据的质量。在临床命名实体识别（NER）中，这意味着需要确保人类标注员在标记医疗实体时保持一致性。诸如科恩系数（Cohen's kappa, $\\kappa$）之类的标注者间一致性（IAA）指标，为我们提供了一种量化这种一致性的方法，它同时校正了可能由偶然因素导致的一致性。本练习  将让您亲手实践如何从原始标注计数中计算一个广泛使用的IAA指标，并理解令牌级别（token-level）与实体跨度级别（span-level）一致性之间的关键区别。",
            "id": "4547588",
            "problem": "一个医院研究团队正在评估一份简短的去标识化医生笔记中临床命名实体识别（NER）标注的一致性。两名人工标注者独立地将每个词元标注为五个互斥类别之一：Outside ($O$)、Problem ($\\mathrm{PROB}$)、Medication ($\\mathrm{MED}$)、Laboratory Test ($\\mathrm{TEST}$) 和 Anatomy ($\\mathrm{ANAT}$)。词元总数为 $60$。两名标注者之间的词元级别联合计数总结如下，其中每个项目符号表示标注者A分配了固定类别的词元子集的计数，并按标注者B的分配进行了划分：\n\n- 对于标注者A标记为 $O$ 的词元：标注者B将 $38$ 个词元标记为 $O$，将 $1$ 个词元标记为 $\\mathrm{PROB}$，将 $0$ 个词元标记为 $\\mathrm{MED}$，将 $1$ 个词元标记为 $\\mathrm{TEST}$，将 $0$ 个词元标记为 $\\mathrm{ANAT}$。\n- 对于标注者A标记为 $\\mathrm{PROB}$ 的词元：标注者B将 $2$ 个词元标记为 $O$，将 $5$ 个词元标记为 $\\mathrm{PROB}$，将 $0$ 个词元标记为 $\\mathrm{MED}$，将 $1$ 个词元标记为 $\\mathrm{TEST}$，将 $0$ 个词元标记为 $\\mathrm{ANAT}$。\n- 对于标注者A标记为 $\\mathrm{MED}$ 的词元：标注者B将 $1$ 个词元标记为 $O$，将 $0$ 个词元标记为 $\\mathrm{PROB}$，将 $3$ 个词元标记为 $\\mathrm{MED}$，将 $1$ 个词元标记为 $\\mathrm{TEST}$，将 $1$ 个词元标记为 $\\mathrm{ANAT}$。\n- 对于标注者A标记为 $\\mathrm{TEST}$ 的词元：标注者B将 $1$ 个词元标记为 $O$，将 $0$ 个词元标记为 $\\mathrm{PROB}$，将 $1$ 个词元标记为 $\\mathrm{MED}$，将 $2$ 个词元标记为 $\\mathrm{TEST}$，将 $0$ 个词元标记为 $\\mathrm{ANAT}$。\n- 对于标注者A标记为 $\\mathrm{ANAT}$ 的词元：标注者B将 $0$ 个词元标记为 $O$，将 $1$ 个词元标记为 $\\mathrm{PROB}$，将 $1$ 个词元标记为 $\\mathrm{MED}$，将 $0$ 个词元标记为 $\\mathrm{TEST}$，将 $0$ 个词元标记为 $\\mathrm{ANAT}$。\n\n假设在标注者独立的条件下，观测一致性和期望一致性采用基于其边际标签分布的标准可靠性理论定义。计算这些标注的词元级别 Cohen's kappa $\\kappa$，表示为单个实数。将最终数值答案四舍五入到四位有效数字。\n\n然后，简要解释（无需计算任何额外的数值指标）在这种情况下，区间级别的一致性（例如，基于精确区间匹配的标注者间一致性（IAA））与词元级别的一致性可能有何不同，特别是在存在边界对齐问题时，例如一名标注者将“$\\mathrm{Type\\ 2\\ diabetes\\ mellitus}$”标注为单个$\\mathrm{PROB}$区间，而另一名标注者仅标注“$\\mathrm{diabetes}$”。最终数值答案不需要单位。",
            "solution": "该问题被验证为具有科学依据、提法恰当、客观且自洽。所提供的数据是完整且足以计算 Cohen's kappa（一种衡量标注者间信度的标准指标）的。从联合计数中得出的词元总数（$38+1+0+1+0 + 2+5+0+1+0 + 1+0+3+1+1 + 1+0+1+2+0 + 0+1+1+0+0=60$）与所述的总数 $60$ 相符。因此，该问题是有效的。\n\n解答过程分为两部分：首先，计算 Cohen's kappa ($\\kappa$)；其次，从概念上解释词元级别和区间级别一致性之间的差异。\n\n第1部分：Cohen's Kappa 的计算\n\nCohen's kappa 系数定义为 $\\kappa = \\frac{p_o - p_e}{1 - p_e}$，其中 $p_o$ 是标注者之间观测到的一致性比例，$p_e$ 是偶然达成一致的假设概率。标注的词元总数为 $N=60$。五个标注类别为 $O$、$\\mathrm{PROB}$、$\\mathrm{MED}$、$\\mathrm{TEST}$ 和 $\\mathrm{ANAT}$。\n\n首先，我们根据给定数据构建一个列联表（或混淆矩阵），其中行代表标注者A分配的标签，列代表标注者B分配的标签。设 $n_{ij}$ 为标注者A分配给类别 $i$、标注者B分配给类别 $j$ 的词元数量。\n\n计数的列联表如下：\n$$\nN_{obs} = \n\\begin{pmatrix}\n  \\text{O}  \\text{PROB}  \\text{MED}  \\text{TEST}  \\text{ANAT} \\\\\n\\text{O}  38  1  0  1  0 \\\\\n\\text{PROB}  2  5  0  1  0 \\\\\n\\text{MED}  1  0  3  1  1 \\\\\n\\text{TEST}  1  0  1  2  0 \\\\\n\\text{ANAT}  0  1  1  0  0\n\\end{pmatrix}\n$$\n\n接下来，我们计算观测一致性 $p_o$。这是两位标注者对标签达成一致的词元所占的比例。它是列联表对角线元素之和除以总词元数 $N$。\n$$\np_o = \\frac{\\sum_{i=1}^{5} n_{ii}}{N} = \\frac{38 + 5 + 3 + 2 + 0}{60} = \\frac{48}{60} = 0.8\n$$\n\n接下来，我们计算偶然期望一致性 $p_e$。这需要每个标注者的边际总数。设 $n_{i \\cdot}$ 为标注者A标记为类别 $i$ 的词元总数（行总和），设 $n_{\\cdot j}$ 为标注者B标记为类别 $j$ 的词元总数（列总和）。\n\n行总和（标注者A的边际值）：\n$n_{O \\cdot} = 38 + 1 + 0 + 1 + 0 = 40$\n$n_{\\mathrm{PROB} \\cdot} = 2 + 5 + 0 + 1 + 0 = 8$\n$n_{\\mathrm{MED} \\cdot} = 1 + 0 + 3 + 1 + 1 = 6$\n$n_{\\mathrm{TEST} \\cdot} = 1 + 0 + 1 + 2 + 0 = 4$\n$n_{\\mathrm{ANAT} \\cdot} = 0 + 1 + 1 + 0 + 0 = 2$\n行总和为 $40+8+6+4+2=60=N$。\n\n列总和（标注者B的边际值）：\n$n_{\\cdot O} = 38 + 2 + 1 + 1 + 0 = 42$\n$n_{\\cdot \\mathrm{PROB}} = 1 + 5 + 0 + 0 + 1 = 7$\n$n_{\\cdot \\mathrm{MED}} = 0 + 0 + 3 + 1 + 1 = 5$\n$n_{\\cdot \\mathrm{TEST}} = 1 + 1 + 1 + 2 + 0 = 5$\n$n_{\\cdot \\mathrm{ANAT}} = 0 + 0 + 1 + 0 + 0 = 1$\n列总和为 $42+7+5+5+1=60=N$。\n\n期望一致性 $p_e$ 是每个类别边际概率乘积的总和，假设标注者的判断是独立的。\n$$\np_e = \\sum_{i \\in \\{\\text{classes}\\}} P(\\text{Rater A}=i) \\times P(\\text{Rater B}=i) = \\frac{1}{N^2} \\sum_{i=1}^{5} (n_{i \\cdot} \\times n_{\\cdot i})\n$$\n$$\np_e = \\frac{1}{60^2} \\left[ (40 \\times 42) + (8 \\times 7) + (6 \\times 5) + (4 \\times 5) + (2 \\times 1) \\right]\n$$\n$$\np_e = \\frac{1}{3600} (1680 + 56 + 30 + 20 + 2) = \\frac{1788}{3600}\n$$\n化简分数：$\\frac{1788}{3600} = \\frac{447}{900} = \\frac{149}{300}$。\n\n最后，我们计算 Cohen's kappa, $\\kappa$。\n$$\n\\kappa = \\frac{p_o - p_e}{1 - p_e} = \\frac{\\frac{48}{60} - \\frac{1788}{3600}}{1 - \\frac{1788}{3600}} = \\frac{\\frac{4 \\times 60}{300} - \\frac{149}{300}}{1 - \\frac{149}{300}} = \\frac{\\frac{240 - 149}{300}}{\\frac{300-149}{300}} = \\frac{\\frac{91}{300}}{\\frac{151}{300}} = \\frac{91}{151}\n$$\n为了获得数值，我们进行除法运算：\n$$\n\\kappa = \\frac{91}{151} \\approx 0.6026490066...\n$$\n四舍五入到四位有效数字，我们得到 $\\kappa \\approx 0.6026$。\n\n第2部分：词元级别与区间级别一致性的解释\n\n如上计算的词元级别一致性将每个词元视为一个独立的标注单元。它衡量了两位标注者分配相同标签的词元比例（经偶然性校正）。在命名实体识别（NER）任务中，这个指标可能会误导性地偏高，因为它没有考虑实体的连续性。区间级别一致性是一种更严格的度量，它评估对被识别为实体的整个短语或文本“区间”的一致性。在一个常见的区间级别指标（如精确匹配的标注者间一致性（IAA））下，要计为一个一致，两位标注者必须识别出完全相同的词元序列（即相同的开始和结束边界）并为其分配相同的实体标签。\n\n边界对齐问题对这两种类型的一致性有显著不同的影响。考虑这个例子：标注者A将区间“$\\mathrm{Type\\ 2\\ diabetes\\ mellitus}$”标注为单个$\\mathrm{PROB}$实体，而标注者B仅将“$\\mathrm{diabetes}$”标注为$\\mathrm{PROB}$。在区间级别（使用精确匹配），这是一个完全的不一致；因为识别了两个不同的区间，所以它们不匹配，导致对一致性的贡献为零。然而，在词元级别，标注者们对词元“$\\mathrm{diabetes}$”的标签$\\mathrm{PROB}$达成了一致。这个单词元的一致性将对词元级别的kappa做出积极贡献，而对“$\\mathrm{Type}$”、“$2$”和“$\\mathrm{mellitus}$”的不一致则会做出消极贡献。因此，在NER任务中，区间级别的IAA通常低于词元级别的IAA，因为它对实体边界的不一致性（这很常见）要敏感得多。",
            "answer": "$$\n\\boxed{0.6026}\n$$"
        },
        {
            "introduction": "现代自然语言处理（NLP）模型，如Transformer，并非直接处理单词，而是处理亚词（subword）单元，即令牌（token）。在构建高性能NER系统时，如何将这些亚词令牌与实体标签正确对齐，是一个关键且常常棘手的步骤。这项练习  将揭开这一复杂过程的神秘面纱，引导您逐步将原始的临床文本片段，通过如WordPiece分词和BILOU标签方案，转换为可供模型训练的已标注序列。",
            "id": "4547499",
            "problem": "一项临床自然语言处理任务需要将 WordPiece 分词器产生的子词片段与 Begin–Inside–Last–Outside–Unit (BILOU) 方案中的实体标签对齐，以支持下游任务中药物名称、其强度和给药频率之间的关系抽取。考虑以下电子健康记录 (EHR) 片段：“metoprolol-XL 50mg qHS”。使用以下设置。\n\n基本基础：\n1) WordPiece 分词定义：一个基础分词器首先根据空白字符进行分割，并将标点符号分离成独立的词元。然后 WordPiece 对每个基础词元应用贪心最长匹配优先规则。在一个基础词元的开始，可以选择任何不带续接标记“##”的词汇项；对于同一基础词元内的续接，只能选择带有“##”前缀的词汇项。当移除“##”前缀并将子词按顺序连接时，这个过程必须能精确地重构出原始的基础词元字符串。\n2) BILOU 方案定义：对于任何实体范围，多词元范围中的第一个词元标记为 Begin ($B$)，任何严格内部的词元标记为 Inside ($I$)，最后一个词元标记为 Last ($L$)。单词元范围标记为 Unit ($U$)。不属于任何实体的词元标记为 Outside ($O$)。\n\n给定：\n- 一个基础分词器，它根据空白字符进行分割，并将连字符“-”视为一个单独的词元。\n- 一个 WordPiece 词汇表，限定为集合\n$$\\{\\texttt{met},\\ \\texttt{##op},\\ \\texttt{##ro},\\ \\texttt{##lol},\\ \\texttt{-},\\ \\texttt{XL},\\ \\texttt{50},\\ \\texttt{##mg},\\ \\texttt{q},\\ \\texttt{##HS}\\}.$$\n- 在原始文本字符串上定义的标准实体提及如下：\n  a) 药物名称 (DRUG)：“metoprolol-XL”\n  b) 强度 (STRENGTH)：“50mg”\n  c) 频率 (FREQ)：“qHS”\n\n任务：\n1) 将基础分词器，然后是 WordPiece 分词器（如上定义）应用于字符串“metoprolol-XL 50mg qHS”，确保正确处理连字符和单位。\n2) 将生成的 WordPiece 词元与标准实体范围对齐，并为每个 WordPiece 词元生成一个 BILOU 标签。在分配 BILOU 标签时，将每个 WordPiece 子词元视为一个独立的词元，因此多子词实体在其第一个子词上获得 $\\text{B}$，在内部子词上获得 $\\text{I}$，在最后一个子词上获得 $\\text{L}$；单子词实体获得 $\\text{U}$。\n3) 使用以下映射将每个 BILOU 标签映射到一个整数代码：\n   - $\\text{B-DRUG} \\mapsto 11$, $\\text{I-DRUG} \\mapsto 12$, $\\text{L-DRUG} \\mapsto 13$, $\\text{U-DRUG} \\mapsto 14$,\n   - $\\text{B-STRENGTH} \\mapsto 21$, $\\text{I-STRENGTH} \\mapsto 22$, $\\text{L-STRENGTH} \\mapsto 23$, $\\text{U-STRENGTH} \\mapsto 24$,\n   - $\\text{B-FREQ} \\mapsto 31$, $\\text{I-FREQ} \\mapsto 32$, $\\text{L-FREQ} \\mapsto 33$, $\\text{U-FREQ} \\mapsto 34$,\n   - $\\text{O} \\mapsto 0$.\n4) 设最终序列的长度为 $N$。定义校验和\n$$H \\;=\\; \\sum_{i=1}^{N} i \\cdot \\mathrm{code}_i,$$\n其中 $\\mathrm{code}_i$ 是第 $i$ 个 WordPiece 词元的 BILOU 标签按出现顺序对应的整数代码。\n\n计算 $H$ 的值。最终答案以整数形式表示，不带单位。无需四舍五入。",
            "solution": "在进行解答之前，对问题陈述进行了严格验证。\n\n### 步骤 1：提取给定信息\n- **输入字符串**：“metoprolol-XL 50mg qHS”\n- **基础分词器规则**：根据空白字符分割，并将连字符“-”视为单独的词元。更一般地，它“将标点符号分离成独立的词元”。\n- **WordPiece 分词器规则**：对每个基础词元应用贪心最长匹配优先算法。以“##”为前缀的词汇项是续接子词。子词必须能完全重构原始的基础词元。\n- **WordPiece 词汇表**：$\\{\\texttt{met},\\ \\texttt{##op},\\ \\texttt{##ro},\\ \\texttt{##lol},\\ \\texttt{-},\\ \\texttt{XL},\\ \\texttt{50},\\ \\texttt{##mg},\\ \\texttt{q},\\ \\texttt{##HS}\\}$\n- **标准实体范围**：\n  - 药物名称 (DRUG)：“metoprolol-XL”\n  - 强度 (STRENGTH)：“50mg”\n  - 频率 (FREQ)：“qHS”\n- **BILOU 方案定义**：多词元范围中的第一个词元是 Begin ($\\text{B}$)，内部词元是 Inside ($\\text{I}$)，最后一个词元是 Last ($\\text{L}$)。单词元范围是 Unit ($\\text{U}$)。非实体词元是 Outside ($\\text{O}$)。\n- **整数代码映射**：\n  - $\\text{B-DRUG} \\mapsto 11$, $\\text{I-DRUG} \\mapsto 12$, $\\text{L-DRUG} \\mapsto 13$, $\\text{U-DRUG} \\mapsto 14$\n  - $\\text{B-STRENGTH} \\mapsto 21$, $\\text{I-STRENGTH} \\mapsto 22$, $\\text{L-STRENGTH} \\mapsto 23$, $\\text{U-STRENGTH} \\mapsto 24$\n  - $\\text{B-FREQ} \\mapsto 31$, $\\text{I-FREQ} \\mapsto 32$, $\\text{L-FREQ} \\mapsto 33$, $\\text{U-FREQ} \\mapsto 34$\n  - $\\text{O} \\mapsto 0$\n- **校验和公式**：$H = \\sum_{i=1}^{N} i \\cdot \\mathrm{code}_i$，其中 $N$ 是 WordPiece 词元的数量，$\\mathrm{code}_i$ 是第 $i$ 个词元的整数代码。\n\n### 步骤 2：使用提取的给定信息进行验证\n根据验证标准对问题进行评估。\n- **科学性**：该问题在自然语言处理领域有充分的依据，该领域是计算机科学和人工智能的一个子领域。WordPiece 分词和用于命名实体识别的 BILOU 标注是临床 NLP 中的标准技术。\n- **适定性**：所有规则、定义和数据都已提供。分词算法是确定性的，标注和计算规则是明确的，从而导向一个唯一的、有意义的解。\n- **客观性**：问题陈述使用了精确、客观的语言，没有主观或基于意见的成分。\n- 不存在科学或事实上的不健全、不完整、矛盾或其他缺陷。\n\n### 步骤 3：结论与行动\n该问题被判定为**有效**。将提供一个完整的、有理有据的解答。\n\n通过执行问题陈述中指定的四个任务来得出解答。\n\n**任务 1：分词**\n\n首先，将基础分词器应用于输入字符串“metoprolol-XL 50mg qHS”。该分词器根据空白字符进行分割并分离标点符号。\n1.  根据空白字符分割，产生初步词元：`[“metoprolol-XL”, “50mg”, “qHS”]`。\n2.  `“metoprolol-XL”`中的连字符作为标点符号被分离。这将第一个词元分解为`[“metoprolol”, “-”, “XL”]`。\n3.  最终的基础词元列表是：`[“metoprolol”, “-”, “XL”, “50mg”, “qHS”]`。\n\n接下来，使用提供的词汇表和贪心最长匹配优先规则，将 WordPiece 分词器应用于每个基础词元。\n- 对于基础词元 `“metoprolol”`：\n  - `met`是词汇表中最长的前缀。剩余部分：`oprolol`。\n  - `##op`是最长的续接匹配。剩余部分：`rolol`。\n  - `##ro`是最长的续接匹配。剩余部分：`lol`。\n  - `##lol`是最长的续接匹配。剩余部分为空。\n  - 结果：`[“met”, “##op”, “##ro”, “##lol”]`\n- 对于基础词元 `“-”`：\n  - `-`在词汇表中。\n  - 结果：`[“-”]`\n- 对于基础词元 `“XL”`：\n  - `XL`在词汇表中。\n  - 结果：`[“XL”]`\n- 对于基础词元 `“50mg”`：\n  - `50`是最长的前缀。剩余部分：`mg`。\n  - `##mg`是续接匹配。剩余部分为空。\n  - 结果：`[“50”, “##mg”]`\n- 对于基础词元 `“qHS”`：\n  - `q`是最长的前缀。剩余部分：`HS`。\n  - `##HS`是续接匹配。剩余部分为空。\n  - 结果：`[“q”, “##HS”]`\n\n合并结果，最终的 $N=10$ 个 WordPiece 词元序列是：\n`[“met”, “##op”, “##ro”, “##lol”, “-”, “XL”, “50”, “##mg”, “q”, “##HS”]`\n\n**任务 2：BILOU 标注**\n\n将 WordPiece 词元与标准实体范围对齐，为每个词元分配一个 BILOU 标签。\n\n- **实体：药物名称 (DRUG) “metoprolol-XL”**\n  - 此范围对应前 $6$ 个 WordPiece 词元：`“met”, “##op”, “##ro”, “##lol”, “-”, “XL”`。\n  - 作为一个多词元范围，标签如下：\n    - `“met”`: B-DRUG (开始)\n    - `“##op”`: I-DRUG (内部)\n    - `“##ro”`: I-DRUG (内部)\n    - `“##lol”`: I-DRUG (内部)\n    - `“-”`: I-DRUG (内部)\n    - `“XL”`: L-DRUG (最后)\n- **实体：强度 (STRENGTH) “50mg”**\n  - 此范围对应接下来的 $2$ 个 WordPiece 词元：`“50”, “##mg”`。\n  - 作为一个 $2$ 词元范围，标签如下：\n    - `“50”`: B-STRENGTH (开始)\n    - `“##mg”`: L-STRENGTH (最后)\n- **实体：频率 (FREQ) “qHS”**\n  - 此范围对应最后的 $2$ 个 WordPiece 词元：`“q”, “##HS”`。\n  - 作为一个 $2$ 词元范围，标签如下：\n    - `“q”`: B-FREQ (开始)\n    - `“##HS”`: L-FREQ (最后)\n\n(词元, 标签) 对的有序列表是：\n1. (`“met”`, B-DRUG)\n2. (`“##op”`, I-DRUG)\n3. (`“##ro”`, I-DRUG)\n4. (`“##lol”`, I-DRUG)\n5. (`“-”`, I-DRUG)\n6. (`“XL”`, L-DRUG)\n7. (`“50”`, B-STRENGTH)\n8. (`“##mg”`, L-STRENGTH)\n9. (`“q”`, B-FREQ)\n10. (`“##HS”`, L-FREQ)\n\n**任务 3：整数代码映射**\n\n使用提供的映射，将每个 BILOU 标签映射到其对应的整数代码 $\\mathrm{code}_i$。\n1. B-DRUG $\\mapsto 11$\n2. I-DRUG $\\mapsto 12$\n3. I-DRUG $\\mapsto 12$\n4. I-DRUG $\\mapsto 12$\n5. I-DRUG $\\mapsto 12$\n6. L-DRUG $\\mapsto 13$\n7. B-STRENGTH $\\mapsto 21$\n8. L-STRENGTH $\\mapsto 23$\n9. B-FREQ $\\mapsto 31$\n10. L-FREQ $\\mapsto 33$\n\n整数代码序列是：$[11, 12, 12, 12, 12, 13, 21, 23, 31, 33]$。\n\n**任务 4：校验和计算**\n\n使用公式 $H = \\sum_{i=1}^{N} i \\cdot \\mathrm{code}_i$ 计算校验和 $H$，其中 $N = 10$。\n\n$H = (1 \\cdot \\mathrm{code}_1) + (2 \\cdot \\mathrm{code}_2) + (3 \\cdot \\mathrm{code}_3) + (4 \\cdot \\mathrm{code}_4) + (5 \\cdot \\mathrm{code}_5) + (6 \\cdot \\mathrm{code}_6) + (7 \\cdot \\mathrm{code}_7) + (8 \\cdot \\mathrm{code}_8) + (9 \\cdot \\mathrm{code}_9) + (10 \\cdot \\mathrm{code}_{10})$\n\n代入整数代码：\n$H = (1 \\cdot 11) + (2 \\cdot 12) + (3 \\cdot 12) + (4 \\cdot 12) + (5 \\cdot 12) + (6 \\cdot 13) + (7 \\cdot 21) + (8 \\cdot 23) + (9 \\cdot 31) + (10 \\cdot 33)$\n\n计算每一项：\n$H = 11 + 24 + 36 + 48 + 60 + 78 + 147 + 184 + 279 + 330$\n\n各项求和：\n$H = (11 + 24 + 36 + 48 + 60) + 78 + 147 + 184 + 279 + 330$\n$H = 179 + 78 + 147 + 184 + 279 + 330$\n$H = 257 + 147 + 184 + 279 + 330$\n$H = 404 + 184 + 279 + 330$\n$H = 588 + 279 + 330$\n$H = 867 + 330$\n$H = 1197$\n\n校验和 $H$ 的值为 $1197$。",
            "answer": "$$\\boxed{1197}$$"
        },
        {
            "introduction": "评估一个NER模型并非简单地判断答案“对”或“错”。预测实体边界上的微小错误可能会对最终得分产生巨大影响，因此我们需要能够捕捉这些细微差异的评估指标。评估可以在不同标准下进行，例如“严格”匹配（要求边界和类型完全匹配）和“宽松”匹配（允许部分重叠），比较这两种标准下的结果可以揭示模型的特定弱点。通过本练习 ，您将学会计算和解读严格及宽松$F1$分数，从而更深入地理解如何对NER系统的性能进行稳健且富有洞察力的评估。",
            "id": "4547529",
            "problem": "一个临床命名实体识别（NER）系统处理一段分词后的临床记录。每个实体表示为一个关联了语义类型的词元索引闭区间 $[s,e]$。标准答案集（gold standard set）包含以下五个实体：\n- $G_{1}: [3,6]$，类型“问题 (Problem)”。\n- $G_{2}: [10,10]$，类型“药物 (Medication)”。\n- $G_{3}: [11,12]$，类型“剂量 (Dosage)”。\n- $G_{4}: [15,17]$，类型“问题 (Problem)”。\n- $G_{5}: [21,22]$，类型“问题 (Problem)”。\n\n系统输出了以下六个预测实体（原始预测集）：\n- $P_{1}: [3,6]$，类型“问题 (Problem)”。\n- $P_{2}: [10,11]$，类型“药物 (Medication)”。\n- $P_{3}: [11,12]$，类型“剂量 (Dosage)”。\n- $P_{4}: [16,17]$，类型“问题 (Problem)”。\n- $P_{5}: [20,22]$，类型“问题 (Problem)”。\n- $P_{6}: [25,25]$，类型“药物 (Medication)”。\n\n评估使用两种匹配机制，每种机制都采用一对一的对齐方式（每个标准实体最多能匹配一个预测实体，反之亦然）：\n\n1. 严格匹配：当且仅当一个预测实体的边界 $[s,e]$ 与一个标准实体完全匹配，且类型相同时，该预测实体才被计为真正例（TP）。未匹配任何标准实体的预测实体为假正例（FP）。未被任何预测实体匹配的标准实体为假反例（FN）。\n\n2. 宽松匹配：当且仅当一个预测实体与一个标准实体至少重叠一个词元（即区间交集非空），且类型相同时，该预测实体才被计为真正例（TP）。允许完全匹配。如果一个预测实体与多个相同类型的标准实体重叠，它将与其中重叠词元数最多的未匹配标准实体对齐；若重叠数相同，则选择起始索引最小的标准实体。没有有效重叠的预测实体为假正例（FP）。未被匹配的标准实体为假反例（FN）。\n\n根据精确率和召回率的核心定义，\n- 精确率为 $P = \\frac{\\text{TP}}{\\text{TP} + \\text{FP}}$。\n- 召回率为 $R = \\frac{\\text{TP}}{\\text{TP} + \\text{FN}}$。\n$F1$分数定义为精确率和召回率的调和平均数：\n$$F1 = \\frac{2PR}{P+R}.$$\n\n任务A：使用原始预测集，计算 $F1^{\\mathrm{strict}}$ 和 $F1^{\\mathrm{relaxed}}$。\n\n任务B：为模拟边界错误，通过将每个预测区间的起始和结束索引向右移动一个词元来扰动该区间，生成一个类型相同的扰动集 $P'_{i}: [s+1,e+1]$。在严格匹配和宽松匹配下重新评估，计算 $F1'^{\\mathrm{strict}}$ 和 $F1'^{\\mathrm{relaxed}}$。\n\n任务C：通过计算变化量 $\\Delta F1^{\\mathrm{strict}} = F1'^{\\mathrm{strict}} - F1^{\\mathrm{strict}}$ 和 $\\Delta F1^{\\mathrm{relaxed}} = F1'^{\\mathrm{relaxed}} - F1^{\\mathrm{relaxed}}$ 来量化对边界错误的敏感度。\n\n以单行向量的形式报告你的最终结果，其中包含按以下顺序排列的四个分量：\n$$\\left(F1^{\\mathrm{strict}},\\ F1^{\\mathrm{relaxed}},\\ \\Delta F1^{\\mathrm{strict}},\\ \\Delta F1^{\\mathrm{relaxed}}\\right).$$\n精确表达所有量；无需四舍五入。",
            "solution": "首先对用户提供的问题进行严格的验证过程。\n\n### 步骤1：提取已知条件\n问题陈述中逐字给出的条件如下：\n\n**标准答案实体 ($G$):**\n- $G_{1}: [3,6]$，类型“问题 (Problem)”。\n- $G_{2}: [10,10]$，类型“药物 (Medication)”。\n- $G_{3}: [11,12]$，类型“剂量 (Dosage)”。\n- $G_{4}: [15,17]$，类型“问题 (Problem)”。\n- $G_{5}: [21,22]$，类型“问题 (Problem)”。\n标准实体总数：$N_G = 5$。\n\n**原始预测实体 ($P$):**\n- $P_{1}: [3,6]$，类型“问题 (Problem)”。\n- $P_{2}: [10,11]$，类型“药物 (Medication)”。\n- $P_{3}: [11,12]$，类型“剂量 (Dosage)”。\n- $P_{4}: [16,17]$，类型“问题 (Problem)”。\n- $P_{5}: [20,22]$，类型“问题 (Problem)”。\n- $P_{6}: [25,25]$，类型“药物 (Medication)”。\n预测实体总数：$N_P = 6$。\n\n**匹配机制：**\n- **严格匹配：** 当且仅当一个预测实体的区间 $[s,e]$ 和类型与一个标准实体完全相同时，该预测实体才为真正例（TP）。强制执行一对一对齐。\n- **宽松匹配：** 当且仅当一个预测实体的区间与一个标准实体的区间重叠（交集非空）且类型相同时，该预测实体才为真正例（TP）。强制执行一对一对齐，平局时根据最大重叠度，然后根据标准实体的最小起始索引来解决。\n\n**评估指标：**\n- 精确率：$P = \\frac{\\text{TP}}{\\text{TP} + \\text{FP}}$\n- 召回率：$R = \\frac{\\text{TP}}{\\text{TP} + \\text{FN}}$\n- F1分数：$F1 = \\frac{2PR}{P+R}$\n\n**任务：**\n- **任务A：** 计算原始集 $P$ 的 $F1^{\\mathrm{strict}}$ 和 $F1^{\\mathrm{relaxed}}$。\n- **任务B：** 通过将 $P$ 中的每个区间移动 $+1$（$[s+1, e+1]$）来创建一个扰动集 $P'$。计算 $F1'^{\\mathrm{strict}}$ 和 $F1'^{\\mathrm{relaxed}}$。\n- **任务C：** 计算变化量 $\\Delta F1^{\\mathrm{strict}} = F1'^{\\mathrm{strict}} - F1^{\\mathrm{strict}}$ 和 $\\Delta F1^{\\mathrm{relaxed}} = F1'^{\\mathrm{relaxed}} - F1^{\\mathrm{relaxed}}$。\n- **最终结果：** 以行向量 $(F1^{\\mathrm{strict}}, F1^{\\mathrm{relaxed}}, \\Delta F1^{\\mathrm{strict}}, \\Delta F1^{\\mathrm{relaxed}})$ 的形式报告。\n\n### 步骤2：使用提取的已知条件进行验证\n评估问题的有效性。\n1.  **科学依据：** 该问题使用了自然语言处理（NLP）领域的标准、公认的指标和概念，特别是用于评估命名实体识别（NER）系统的指标和概念。精确率、召回率、F1分数以及严格和宽松匹配的概念是该领域的基础。\n2.  **适定性：** 该问题提供了所有必要的数据（标准实体和预测实体），并为所有流程（匹配标准、平局打破规则、指标公式）提供了清晰、明确的定义。这些任务是具体的计算练习，能够得出唯一、确定的解。\n3.  **客观性：** 语言正式且技术性强。定义精确。没有主观或基于意见的元素。\n4.  **主题相关性：** 该问题明确地设定在*临床命名实体识别*的背景下，这是*生物信息学和医疗数据分析*中的一个核心任务。\n\n该问题是自包含、一致的，并遵循其所在领域的科学评估原则。\n\n### 步骤3：结论和行动\n该问题是**有效的**。将提供完整的解决方案。\n\n### 求解推导\n\n按顺序执行每个任务来求解。\n\n**任务A：评估原始预测集 ($P$)**\n\n**1. 严格匹配：**\n我们将每个预测实体 $P_i$ 与标准答案集 $G$进行比较，以寻找区间和类型的完全匹配。\n- $P_1:[3,6]$，“问题”与 $G_1:[3,6]$，“问题”完全匹配。这是一个真正例（TP）。\n- $P_2:[10,11]$，“药物”与 $G_2:[10,10]$，“药物”不匹配（边界不同）。\n- $P_3:[11,12]$，“剂量”与 $G_3:[11,12]$，“剂量”完全匹配。这是一个TP。\n- $P_4:[16,17]$，“问题”与 $G_4:[15,17]$，“问题”不匹配（边界不同）。\n- $P_5:[20,22]$，“问题”与 $G_5:[21,22]$，“问题”不匹配（边界不同）。\n- $P_6:[25,25]$，“药物”不与任何标准实体匹配。\n\n在严格匹配下，我们有 $2$ 个TP：$(P_1, G_1)$ 和 $(P_3, G_3)$。\n- 真正例数量：$\\text{TP}^{\\mathrm{strict}} = 2$。\n- 假正例数量：$\\text{FP}^{\\mathrm{strict}} = N_P - \\text{TP}^{\\mathrm{strict}} = 6 - 2 = 4$。（FP为 $P_2, P_4, P_5, P_6$）。\n- 假反例数量：$\\text{FN}^{\\mathrm{strict}} = N_G - \\text{TP}^{\\mathrm{strict}} = 5 - 2 = 3$。（FN为 $G_2, G_4, G_5$）。\n\n现在，我们计算精确率、召回率和F1分数：\n- 精确率：$P^{\\mathrm{strict}} = \\frac{\\text{TP}^{\\mathrm{strict}}}{\\text{TP}^{\\mathrm{strict}} + \\text{FP}^{\\mathrm{strict}}} = \\frac{2}{2+4} = \\frac{2}{6} = \\frac{1}{3}$。\n- 召回率：$R^{\\mathrm{strict}} = \\frac{\\text{TP}^{\\mathrm{strict}}}{\\text{TP}^{\\mathrm{strict}} + \\text{FN}^{\\mathrm{strict}}} = \\frac{2}{2+3} = \\frac{2}{5}$。\n- F1分数：$F1^{\\mathrm{strict}} = \\frac{2 \\cdot P^{\\mathrm{strict}} \\cdot R^{\\mathrm{strict}}}{P^{\\mathrm{strict}} + R^{\\mathrm{strict}}} = \\frac{2 \\cdot \\frac{1}{3} \\cdot \\frac{2}{5}}{\\frac{1}{3} + \\frac{2}{5}} = \\frac{\\frac{4}{15}}{\\frac{5+6}{15}} = \\frac{4}{11}$。\n\n**2. 宽松匹配：**\n我们检查相同类型的区间之间是否存在任何重叠。\n- $P_1:[3,6]$，“问题”与 $G_1:[3,6]$，“问题”重叠。匹配。\n- $P_2:[10,11]$，“药物”与 $G_2:[10,10]$，“药物”重叠。匹配。\n- $P_3:[11,12]$，“剂量”与 $G_3:[11,12]$，“剂量”重叠。匹配。\n- $P_4:[16,17]$，“问题”与 $G_4:[15,17]$，“问题”重叠。匹配。\n- $P_5:[20,22]$，“问题”与 $G_5:[21,22]$，“问题”重叠。匹配。\n- $P_6:[25,25]$，“药物”不与任何“药物”类型的标准实体（仅有 $G_2$）重叠。\n\n没有预测实体与多个相同类型的标准实体重叠，也没有标准实体被多个相同类型的预测实体重叠，因此一对一对齐是直接的。\n我们找到了 $5$ 个TP：$(P_1, G_1), (P_2, G_2), (P_3, G_3), (P_4, G_4), (P_5, G_5)$。\n- $\\text{TP}^{\\mathrm{relaxed}} = 5$。\n- $\\text{FP}^{\\mathrm{relaxed}} = N_P - \\text{TP}^{\\mathrm{relaxed}} = 6 - 5 = 1$。（FP为 $P_6$）。\n- $\\text{FN}^{\\mathrm{relaxed}} = N_G - \\text{TP}^{\\mathrm{relaxed}} = 5 - 5 = 0$。\n\n现在，我们计算各项指标：\n- 精确率：$P^{\\mathrm{relaxed}} = \\frac{5}{5+1} = \\frac{5}{6}$。\n- 召回率：$R^{\\mathrm{relaxed}} = \\frac{5}{5+0} = 1$。\n- F1分数：$F1^{\\mathrm{relaxed}} = \\frac{2 \\cdot \\frac{5}{6} \\cdot 1}{\\frac{5}{6} + 1} = \\frac{\\frac{10}{6}}{\\frac{11}{6}} = \\frac{10}{11}$。\n\n**任务B：评估扰动预测集 ($P'$)**\n\n首先，我们通过将每个区间 $[s,e]$ 移动到 $[s+1, e+1]$ 来定义扰动集 $P'$。\n- $P'_{1}: [4,7]$，“问题”\n- $P'_{2}: [11,12]$，“药物”\n- $P'_{3}: [12,13]$，“剂量”\n- $P'_{4}: [17,18]$，“问题”\n- $P'_{5}: [21,23]$，“问题”\n- $P'_{6}: [26,26]$，“药物”\n\n**1. 对 $P'$ 进行严格匹配：**\n我们将每个 $P'_i$ 与标准集 $G$进行比较。\n- $P'_1:[4,7]$ vs $G_1:[3,6]$。不匹配。\n- $P'_2:[11,12]$，“药物” vs $G_3:[11,12]$，“剂量”。类型不匹配。不匹配。\n- $P'$ 中没有实体的区间和类型与 $G$ 中的任何实体完全相同。\n- $\\text{TP}'^{\\mathrm{strict}} = 0$。\n- $\\text{FP}'^{\\mathrm{strict}} = N_P - \\text{TP}'^{\\mathrm{strict}} = 6 - 0 = 6$。\n- $\\text{FN}'^{\\mathrm{strict}} = N_G - \\text{TP}'^{\\mathrm{strict}} = 5 - 0 = 5$。\n\n计算F1分数：\n- $P'^{\\mathrm{strict}} = \\frac{0}{0+6} = 0$。\n- $R'^{\\mathrm{strict}} = \\frac{0}{0+5} = 0$。\n- $F1'^{\\mathrm{strict}} = 0$，因为精确率和召回率都为 $0$。\n\n**2. 对 $P'$ 进行宽松匹配：**\n我们检查是否存在类型匹配的重叠。\n- $P'_1:[4,7]$，“问题”与 $G_1:[3,6]$，“问题”重叠。匹配。\n- $P'_2:[11,12]$，“药物”不与 $G_2:[10,10]$，“药物”重叠。不匹配。\n- $P'_3:[12,13]$，“剂量”与 $G_3:[11,12]$，“剂量”重叠。匹配。\n- $P'_4:[17,18]$，“问题”与 $G_4:[15,17]$，“问题”重叠。匹配。\n- $P'_5:[21,23]$，“问题”与 $G_5:[21,22]$，“问题”重叠。匹配。\n- $P'_6:[26,26]$，“药物”不与 $G_2:[10,10]$，“药物”重叠。不匹配。\n\n对齐再次变得直接。\n我们从配对 $(P'_1, G_1), (P'_3, G_3), (P'_4, G_4), (P'_5, G_5)$ 中找到了 $4$ 个TP。\n- $\\text{TP}'^{\\mathrm{relaxed}} = 4$。\n- $\\text{FP}'^{\\mathrm{relaxed}} = N_P - \\text{TP}'^{\\mathrm{relaxed}} = 6 - 4 = 2$。（FP为 $P'_2$ 和 $P'_6$）。\n- $\\text{FN}'^{\\mathrm{relaxed}} = N_G - \\text{TP}'^{\\mathrm{relaxed}} = 5 - 4 = 1$。（FN为 $G_2$）。\n\n现在，我们计算各项指标：\n- $P'^{\\mathrm{relaxed}} = \\frac{4}{4+2} = \\frac{4}{6} = \\frac{2}{3}$。\n- $R'^{\\mathrm{relaxed}} = \\frac{4}{4+1} = \\frac{4}{5}$。\n- $F1'^{\\mathrm{relaxed}} = \\frac{2 \\cdot \\frac{2}{3} \\cdot \\frac{4}{5}}{\\frac{2}{3} + \\frac{4}{5}} = \\frac{\\frac{16}{15}}{\\frac{10+12}{15}} = \\frac{16}{22} = \\frac{8}{11}$。\n\n**任务C：量化对边界错误的敏感度**\n\n我们计算F1分数的变化。\n- $\\Delta F1^{\\mathrm{strict}} = F1'^{\\mathrm{strict}} - F1^{\\mathrm{strict}} = 0 - \\frac{4}{11} = -\\frac{4}{11}$。\n- $\\Delta F1^{\\mathrm{relaxed}} = F1'^{\\mathrm{relaxed}} - F1^{\\mathrm{relaxed}} = \\frac{8}{11} - \\frac{10}{11} = -\\frac{2}{11}$。\n\n**最终结果汇编**\n最终答案所需的四个分量是：\n- $F1^{\\mathrm{strict}} = \\frac{4}{11}$\n- $F1^{\\mathrm{relaxed}} = \\frac{10}{11}$\n- $\\Delta F1^{\\mathrm{strict}} = -\\frac{4}{11}$\n- $\\Delta F1^{\\mathrm{relaxed}} = -\\frac{2}{11}$\n\n将这些组合成一个单行向量。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{4}{11} & \\frac{10}{11} & -\\frac{4}{11} & -\\frac{2}{11}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}