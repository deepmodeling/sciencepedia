{
    "hands_on_practices": [
        {
            "introduction": "医学图像配准的核心在于找到一个最优的空间变换，将一个图像（或点集）与另一个对齐。在深入研究复杂的基于强度的方法之前，掌握一个基本问题至关重要：如何使用刚性变换精确对齐两组对应的解剖学标志点。这个练习将引导您推导著名的 Procrustes 分析问题的闭式解，该解使用奇异值分解（SVD）来找到最小化点集之间平方距离和的最佳旋转和平移。",
            "id": "4582035",
            "problem": "考虑从同一患者的术前和术中医学图像中提取的两组对应的三维空间中的解剖标志点，$\\{x_{i}\\}_{i=1}^{n}$ 和 $\\{y_{i}\\}_{i=1}^{n}$。三维空间中的一个刚性变换由一个旋转 $R \\in \\mathbb{R}^{3 \\times 3}$（满足 $R^{\\top}R = I$ 和 $\\det(R) = 1$）和一个平移 $t \\in \\mathbb{R}^{3}$ 组成。配准的目标是最小化欧几里得距离的平方和\n$$\nE(R,t) = \\sum_{i=1}^{n} \\| R x_{i} + t - y_{i} \\|^{2}.\n$$\n从第一性原理出发——即刚体变换的定义、正交矩阵的性质、通过中心化数据分解方差以及迹在循环置换下的不变性——使用 $3 \\times 3$ 互协方差矩阵的奇异值分解（SVD）推导最小化 $E(R,t)$ 的最优旋转 $R$ 和平移 $t$ 的闭式解，并解释如何处理反射以强制满足 $\\det(R) = 1$。\n\n设样本均值为 $\\bar{x} = \\frac{1}{n} \\sum_{i=1}^{n} x_{i}$ 和 $\\bar{y} = \\frac{1}{n} \\sum_{i=1}^{n} y_{i}$，并定义中心化点 $x_{i}' = x_{i} - \\bar{x}$ 和 $y_{i}' = y_{i} - \\bar{y}$。定义互协方差矩阵 $H = \\sum_{i=1}^{n} x_{i}' (y_{i}')^{\\top}$，并设其奇异值分解（SVD）为 $H = U \\Sigma V^{\\top}$，其中 $U, V \\in \\mathbb{R}^{3 \\times 3}$ 是正交矩阵，$\\Sigma = \\operatorname{diag}(\\sigma_{1}, \\sigma_{2}, \\sigma_{3})$ 且 $\\sigma_{1} \\geq \\sigma_{2} \\geq \\sigma_{3} \\geq 0$。令 $s = \\operatorname{sign}(\\det(U V^{\\top}))$。\n\n你的推导必须是自洽的，并且必须根据所列出的原理，解释为什么会出现反射情况以及如何纠正它以确保 $\\det(R) = 1$。\n\n答案规格：\n- 提供在最优 $(R,t)$ 处目标函数 $E(R,t)$ 的最小值，形式为一个单一的闭式解析表达式，用 $\\{x_{i}\\}$、$\\{y_{i}\\}$、$\\bar{x}$、$\\bar{y}$ 以及上面定义的奇异值 $\\sigma_{1}, \\sigma_{2}, \\sigma_{3}$ 和符号 $s$ 来表示。\n- 最终答案必须是一个单一的解析表达式。不要包含单位。",
            "solution": "问题是找到旋转 $R \\in \\mathbb{R}^{3 \\times 3}$（满足 $R^{\\top}R=I$ 和 $\\det(R)=1$）和平移 $t \\in \\mathbb{R}^{3}$，以最小化两组对应点集 $\\{x_i\\}_{i=1}^n$ 和 $\\{y_i\\}_{i=1}^n$ 之间的欧几里得距离平方和。目标函数是：\n$$\nE(R,t) = \\sum_{i=1}^{n} \\| R x_{i} + t - y_{i} \\|^{2}\n$$\n求解过程是首先对平移 $t$ 进行优化，然后对旋转 $R$ 进行优化。\n\n首先，我们对给定的旋转 $R$ 求解最优平移 $t$。函数 $E(R,t)$ 是一个关于 $t$ 的二次函数，其最小值可以通过将其关于 $t$ 的梯度设为零来找到。\n$$\n\\frac{\\partial E}{\\partial t} = \\sum_{i=1}^{n} \\frac{\\partial}{\\partial t} \\| R x_{i} + t - y_{i} \\|^{2} = \\sum_{i=1}^{n} 2(R x_{i} + t - y_{i}) = 0\n$$\n$$\n\\sum_{i=1}^{n} (R x_{i} + t - y_{i}) = 0\n$$\n$$\nR \\left(\\sum_{i=1}^{n} x_{i} \\right) + \\sum_{i=1}^{n} t - \\sum_{i=1}^{n} y_{i} = 0\n$$\n$$\nR (n \\bar{x}) + n t - n \\bar{y} = 0\n$$\n其中 $\\bar{x} = \\frac{1}{n} \\sum_{i=1}^{n} x_{i}$ 和 $\\bar{y} = \\frac{1}{n} \\sum_{i=1}^{n} y_{i}$ 是点集的质心。求解 $t$，我们得到最优平移 $t_{opt}$：\n$$\nt_{opt} = \\bar{y} - R \\bar{x}\n$$\n这个结果表明，最优平移将变换后的源点质心 $R\\bar{x}$ 与目标点质心 $\\bar{y}$ 对齐。\n\n接下来，我们将 $t_{opt}$ 代入目标函数 $E(R,t)$，得到一个只依赖于 $R$ 的新目标函数。\n$$\nR x_{i} + t_{opt} - y_{i} = R x_{i} + (\\bar{y} - R \\bar{x}) - y_{i} = R(x_{i} - \\bar{x}) - (y_{i} - \\bar{y})\n$$\n使用中心化点 $x'_{i} = x_{i} - \\bar{x}$ 和 $y'_{i} = y_{i} - \\bar{y}$，该表达式变为 $R x'_{i} - y'_{i}$。目标函数现在是：\n$$\nE(R) = \\sum_{i=1}^{n} \\| R x'_{i} - y'_{i} \\|^{2}\n$$\n我们展开平方范数：\n$$\n\\| R x'_{i} - y'_{i} \\|^{2} = (R x'_{i} - y'_{i})^{\\top}(R x'_{i} - y'_{i}) = (x_{i}'^{\\top}R^{\\top} - y_{i}'^{\\top})(R x'_{i} - y'_{i})\n$$\n$$\n= x_{i}'^{\\top}R^{\\top}R x'_{i} - x_{i}'^{\\top}R^{\\top}y'_{i} - y_{i}'^{\\top}R x'_{i} + y_{i}'^{\\top}y'_{i}\n$$\n因为 $R$ 是正交矩阵，所以 $R^{\\top}R = I$。两个交叉项是标量，并且互为转置，因此它们相等：$x_{i}'^{\\top}R^{\\top}y'_{i} = (y_{i}'^{\\top}R x'_{i})^{\\top} = y_{i}'^{\\top}R x'_{i}$。因此，表达式简化为：\n$$\n\\| R x'_{i} - y'_{i} \\|^{2} = \\|x'_{i}\\|^{2} + \\|y'_{i}\\|^{2} - 2 y_{i}'^{\\top}R x'_{i}\n$$\n对所有点 $i=1, \\dots, n$ 求和：\n$$\nE(R) = \\sum_{i=1}^{n} \\|x'_{i}\\|^{2} + \\sum_{i=1}^{n} \\|y'_{i}\\|^{2} - 2 \\sum_{i=1}^{n} y_{i}'^{\\top}R x'_{i}\n$$\n前两项 $\\sum \\|x'_{i}\\|^{2}$ 和 $\\sum \\|y'_{i}\\|^{2}$ 表示中心化点集的方差，并且与 $R$ 无关。因此，最小化 $E(R)$ 等价于最大化项 $\\sum_{i=1}^{n} y_{i}'^{\\top}R x'_{i}$。\n\n我们可以使用迹算子来表示这一项。对于一个标量 $a$，有 $a = \\operatorname{Tr}(a)$。\n$$\n\\sum_{i=1}^{n} y_{i}'^{\\top}R x'_{i} = \\sum_{i=1}^{n} \\operatorname{Tr}( y_{i}'^{\\top}R x'_{i} )\n$$\n利用迹的循环性质 $\\operatorname{Tr}(ABC) = \\operatorname{Tr}(CAB)$：\n$$\n\\sum_{i=1}^{n} \\operatorname{Tr}(y_{i}'^{\\top}R x'_{i}) = \\sum_{i=1}^{n} \\operatorname{Tr}(R x'_{i} y_{i}'^{\\top}) = \\operatorname{Tr}\\left(R \\sum_{i=1}^{n} x'_{i} y_{i}'^{\\top}\\right)\n$$\n我们识别出这个求和项是互协方差矩阵 $H = \\sum_{i=1}^{n} x'_{i} y_{i}'^{\\top}$。现在关于 $R$ 的优化问题是：\n$$\n\\underset{R}{\\operatorname{maximize}} \\quad \\operatorname{Tr}(RH) \\quad \\text{subject to} \\quad R^{\\top}R = I, \\det(R) = 1\n$$\n设 $H$ 的奇异值分解（SVD）为 $H = U \\Sigma V^{\\top}$，其中 $U$ 和 $V$ 是正交矩阵，$\\Sigma = \\operatorname{diag}(\\sigma_1, \\sigma_2, \\sigma_3)$ 是一个由奇异值组成的对角矩阵。\n$$\n\\operatorname{Tr}(RH) = \\operatorname{Tr}(R U \\Sigma V^{\\top})\n$$\n再次利用迹的循环性质 $\\operatorname{Tr}(ABCD) = \\operatorname{Tr}(DABC)$：\n$$\n\\operatorname{Tr}(R U \\Sigma V^{\\top}) = \\operatorname{Tr}(V^{\\top}R U \\Sigma)\n$$\n我们定义一个新矩阵 $M = V^{\\top}R U$。由于 $V^{\\top}$、$R$ 和 $U$ 都是正交矩阵，它们的乘积 $M$ 也是一个正交矩阵。我们必须最大化 $\\operatorname{Tr}(M \\Sigma)$。约束条件 $\\det(R)=1$ 对 $M$ 施加了一个约束：\n$$\n\\det(M) = \\det(V^{\\top}R U) = \\det(V^{\\top})\\det(R)\\det(U) = \\det(V)^{-1}(1)\\det(U)\n$$\n由于 $V$ 是正交的，$\\det(V) = \\pm 1$，因此 $\\det(V)^{-1} = \\det(V)$。所以，$\\det(M) = \\det(V)\\det(U)$。问题陈述中定义了 $s = \\operatorname{sign}(\\det(U V^{\\top})) = \\det(U V^{\\top}) = \\det(U)\\det(V^{\\top}) = \\det(U)\\det(V)$。因此，对 $M$ 的约束是 $\\det(M) = s$。\n\n我们的任务是在 $M$ 是正交矩阵且 $\\det(M)=s$ 的约束下，最大化 $\\operatorname{Tr}(M\\Sigma) = \\sum_{j=1}^{3} M_{jj}\\sigma_j$。由于 $\\sigma_1 \\geq \\sigma_2 \\geq \\sigma_3 \\geq 0$ 且正交矩阵的对角元素满足 $|M_{jj}| \\leq 1$，我们根据 $s$ 的值分两种情况进行分析。\n\n情况 1：$s=1$。我们需要找到一个行列式为 $\\det(M)=1$ 的正交矩阵 $M$（一个正常旋转）来最大化该和。当 $M_{jj}$ 的值尽可能大时，即 $M_{jj}=1$ 时，达到最大值。矩阵 $M = I = \\operatorname{diag}(1,1,1)$ 满足条件，因为 $\\det(I)=1$。这给出了可能的最大迹值：$\\operatorname{Tr}(I\\Sigma) = \\sigma_1 + \\sigma_2 + \\sigma_3$。\n\n情况 2：$s=-1$。我们需要找到一个行列式为 $\\det(M)=-1$ 的正交矩阵 $M$（一个反射）来最大化该和。为了在行列式为 $-1$ 的情况下最大化该和，我们应该使一个对角元素为 $-1$，其余为 $1$。为了最小化和的减少量，$-1$ 应该与最小的奇异值 $\\sigma_3$ 配对。因此，最优矩阵是 $M = \\operatorname{diag}(1,1,-1)$，其行列式为 $\\det(M)=-1$。最大化的迹是 $\\operatorname{Tr}(\\operatorname{diag}(1,1,-1)\\Sigma) = \\sigma_1 + \\sigma_2 - \\sigma_3$。这就是反射情况。SVD 过程提供了最佳的正交映射，但这可能不是一个正常旋转。修正方法是反转与最小奇异值相关的方向，该方向对应于两个点集之间“相关性”最弱的轴。\n\n结合两种情况，$\\operatorname{Tr}(RH)$ 的最大值是 $\\sigma_1 + \\sigma_2 + s \\sigma_3$。\n最优旋转 $R_{opt}$ 通过求解 $M_{opt} = V^{\\top}R_{opt}U$ 得到：\n$$\nR_{opt} = V M_{opt} U^{\\top}\n$$\n如果 $s=1$，则 $M_{opt}=I$，且 $R_{opt} = V U^{\\top}$。\n如果 $s=-1$，则 $M_{opt}=\\operatorname{diag}(1,1,-1)$，且 $R_{opt} = V \\operatorname{diag}(1,1,-1) U^{\\top}$。\n\n最后，我们将最大化的迹值代回到 $E(R)$ 的表达式中，计算目标函数的最小值 $E_{min}$。\n$$\nE_{min} = \\sum_{i=1}^{n} \\|x'_{i}\\|^{2} + \\sum_{i=1}^{n} \\|y'_{i}\\|^{2} - 2 \\max_{R}\\operatorname{Tr}(RH)\n$$\n代入最大化的迹值 $\\sigma_1 + \\sigma_2 + s \\sigma_3$ 和中心化点的定义：\n$$\nE_{min} = \\sum_{i=1}^{n} \\|x_{i} - \\bar{x}\\|^{2} + \\sum_{i=1}^{n} \\|y_{i} - \\bar{y}\\|^{2} - 2(\\sigma_1 + \\sigma_2 + s \\sigma_3)\n$$\n这就是最小平方误差和的最终闭式表达式。",
            "answer": "$$\n\\boxed{\\sum_{i=1}^{n} \\|x_{i} - \\bar{x}\\|^{2} + \\sum_{i=1}^{n} \\|y_{i} - \\bar{y}\\|^{2} - 2(\\sigma_1 + \\sigma_2 + s \\sigma_3)}\n$$"
        },
        {
            "introduction": "从刚性变换发展到非刚性变换，我们必须理解形变是如何影响空间的。仿射变换是超越刚性模型的第一步，它允许拉伸、剪切和压缩。这个练习探讨了如何通过计算变换的雅可比矩阵的行列式来量化局部体积变化，这是连续介质力学中的一个核心概念，对于分析和约束医学图像配准中的形变至关重要。",
            "id": "4582032",
            "problem": "一个以毫米坐标采样的三维合成组织地标网格，用于评估基线和随访磁共振成像（MRI）之间的仿射配准。该配准映射是一个仿射变换 $T : \\mathbb{R}^{3} \\to \\mathbb{R}^{3}$，由 $T(\\mathbf{x}) = A \\mathbf{x} + \\mathbf{b}$ 给出，其中 $3 \\times 3$ 矩阵 $A$ 和平移向量 $\\mathbf{b}$ 为\n$$\nA = \\begin{pmatrix}\n1.08  0.03  -0.02 \\\\\n0.01  0.92  0.05 \\\\\n0.04  -0.02  1.15\n\\end{pmatrix}, \\quad\n\\mathbf{b} = \\begin{pmatrix}\n0.6 \\\\\n-0.4 \\\\\n1.2\n\\end{pmatrix}.\n$$\n从医学图像配准的角度来看，变换 $T$ 在某一点的雅可比矩阵的行列式量化了在该配准下一个无穷小组织单元的局部体积变化。从多变量微积分和连续介质力学的第一性原理出发，确定网格中任意一点处 $T$ 的雅可比行列式，并解释其对局部体积变化的意义。将行列式报告为一个无单位的实数。无需四舍五入；请给出精确的小数值。",
            "solution": "仿射变换由 $T(\\mathbf{x}) = A\\mathbf{x} + \\mathbf{b}$ 给出。设向量 $\\mathbf{x}$ 由其分量 $(x_1, x_2, x_3)^T$ 表示。变换 $T$ 将 $\\mathbf{x}$ 映射到一个新点 $\\mathbf{y} = (y_1, y_2, y_3)^T$，其中：\n$$\n\\begin{pmatrix} y_1 \\\\ y_2 \\\\ y_3 \\end{pmatrix} = \\begin{pmatrix}\n1.08  0.03  -0.02 \\\\\n0.01  0.92  0.05 \\\\\n0.04  -0.02  1.15\n\\end{pmatrix}\n\\begin{pmatrix} x_1 \\\\ x_2 \\\\ x_3 \\end{pmatrix} +\n\\begin{pmatrix} 0.6 \\\\ -0.4 \\\\ 1.2 \\end{pmatrix}\n$$\n变换后向量 $\\mathbf{y} = T(\\mathbf{x})$ 的分量为：\n$$\ny_1(x_1, x_2, x_3) = 1.08 x_1 + 0.03 x_2 - 0.02 x_3 + 0.6\n$$\n$$\ny_2(x_1, x_2, x_3) = 0.01 x_1 + 0.92 x_2 + 0.05 x_3 - 0.4\n$$\n$$\ny_3(x_1, x_2, x_3) = 0.04 x_1 - 0.02 x_2 + 1.15 x_3 + 1.2\n$$\n根据第一性原理，变换 $T$ 在点 $\\mathbf{x}$ 处的雅可比矩阵，记为 $J_T(\\mathbf{x})$，是 $T$ 的各分量函数的所有一阶偏导数组成的矩阵。对于一个从 $\\mathbb{R}^3$ 到 $\\mathbb{R}^3$ 的变换，它被定义为：\n$$\nJ_T(\\mathbf{x}) = \\begin{pmatrix}\n\\frac{\\partial y_1}{\\partial x_1}  \\frac{\\partial y_1}{\\partial x_2}  \\frac{\\partial y_1}{\\partial x_3} \\\\\n\\frac{\\partial y_2}{\\partial x_1}  \\frac{\\partial y_2}{\\partial x_2}  \\frac{\\partial y_2}{\\partial x_3} \\\\\n\\frac{\\partial y_3}{\\partial x_1}  \\frac{\\partial y_3}{\\partial x_2}  \\frac{\\partial y_3}{\\partial x_3}\n\\end{pmatrix}\n$$\n我们计算每个偏导数：\n$$\n\\frac{\\partial y_1}{\\partial x_1} = 1.08, \\quad \\frac{\\partial y_1}{\\partial x_2} = 0.03, \\quad \\frac{\\partial y_1}{\\partial x_3} = -0.02\n$$\n$$\n\\frac{\\partial y_2}{\\partial x_1} = 0.01, \\quad \\frac{\\partial y_2}{\\partial x_2} = 0.92, \\quad \\frac{\\partial y_2}{\\partial x_3} = 0.05\n$$\n$$\n\\frac{\\partial y_3}{\\partial x_1} = 0.04, \\quad \\frac{\\partial y_3}{\\partial x_2} = -0.02, \\quad \\frac{\\partial y_3}{\\partial x_3} = 1.15\n$$\n将这些导数组合成雅可比矩阵，我们得到：\n$$\nJ_T(\\mathbf{x}) = \\begin{pmatrix}\n1.08  0.03  -0.02 \\\\\n0.01  0.92  0.05 \\\\\n0.04  -0.02  1.15\n\\end{pmatrix}\n$$\n这展示了仿射变换的一个基本性质：雅可比矩阵对于定义域中的所有点 $\\mathbf{x}$ 都是常数，并且等于变换的线性部分，即矩阵 $A$。平移向量 $\\mathbf{b}$ 不影响导数。\n\n雅可比行列式 $\\det(J_T)$ 量化了局部体积变化因子。在点 $\\mathbf{x}$ 处的一个无穷小体积元 $dV$ 被变换为一个体积为 $|\\det(J_T(\\mathbf{x}))| dV$ 的无穷小体积元。由于 $J_T = A$ 是常数，体积变化因子在整个空间中是均匀的。我们现在计算 $A$ 的行列式：\n$$\n\\det(A) = \\det \\begin{pmatrix}\n1.08  0.03  -0.02 \\\\\n0.01  0.92  0.05 \\\\\n0.04  -0.02  1.15\n\\end{pmatrix}\n$$\n沿第一行进行余子式展开：\n$$\n\\det(A) = 1.08 \\begin{vmatrix} 0.92  0.05 \\\\ -0.02  1.15 \\end{vmatrix} - 0.03 \\begin{vmatrix} 0.01  0.05 \\\\ 0.04  1.15 \\end{vmatrix} + (-0.02) \\begin{vmatrix} 0.01  0.92 \\\\ 0.04  -0.02 \\end{vmatrix}\n$$\n$$\n\\det(A) = 1.08 \\times ((0.92 \\times 1.15) - (0.05 \\times -0.02)) - 0.03 \\times ((0.01 \\times 1.15) - (0.05 \\times 0.04)) - 0.02 \\times ((0.01 \\times -0.02) - (0.92 \\times 0.04))\n$$\n$$\n\\det(A) = 1.08 \\times (1.058 - (-0.001)) - 0.03 \\times (0.0115 - 0.002) - 0.02 \\times (-0.0002 - 0.0368)\n$$\n$$\n\\det(A) = 1.08 \\times (1.059) - 0.03 \\times (0.0095) - 0.02 \\times (-0.037)\n$$\n$$\n\\det(A) = 1.14372 - 0.000285 + 0.00074\n$$\n$$\n\\det(A) = 1.144175\n$$\n雅可比行列式为 $1.144175$。\n\n解释：\n雅可比行列式 $\\det(J_T) = 1.144175$ 是在变换 $T$ 下局部体积缩放的因子。\n1. 由于 $\\det(J_T) > 0$，该变换是保向的。这在物理上对于组织变形是符合预期的，因为它意味着局部区域不会被“翻里为外”。\n2. 由于 $|\\det(J_T)| = 1.144175 > 1$，该变换导致局部体积膨胀。具体来说，任何无穷小的组织体积都被放大了 $1.144175$ 倍。这对应于 $(1.144175 - 1) \\times 100\\% = 14.4175\\%$ 的体积增加。\n3. 因为该变换是仿射的，所以这种体积膨胀在整个网格中是均匀的；它在每一点都相同。",
            "answer": "$$\n\\boxed{1.144175}\n$$"
        },
        {
            "introduction": "许多现代配准技术不依赖于离散的标志点，而是直接利用图像的强度信息来驱动对齐过程。这个练习将带您进入基于强度的可变形配准领域。您将从“亮度恒定”这一基本假设出发，推导出光流约束方程，这是许多迭代可变形配准算法（如“Demons”算法）的理论基石。",
            "id": "4582048",
            "problem": "在时间 $t$ 和 $t+\\delta t$ 采集了一个二维(2D)磁共振成像(MRI)切片序列。设图像强度为 $I(x,y,t)$，其中 $(x,y)$ 表示空间坐标，设在时间 $t$ 的未知平面内组织速度场为 $u(x,y) = (u_{x}(x,y), u_{y}(x,y))$。假设帧间形变很小，从而一阶展开有效，并且亮度恒定原理成立，即组织的一个物质点的强度在移动时不会改变。从亮度恒定的定义和基本运动学出发，在小形变假设下，推导连接强度的时间变化、强度的空间梯度和速度场的一阶线性关系。\n\n然后，假设在一个局部区域内速度近似恒定，$u(x,y) \\approx (u_{x}, u_{y})$，并且在三个像素点上测量了以下空间梯度和时间强度导数（每帧）：\n- 像素点1：$\\nabla I = (3, 1)$，$I_{t} = -7$，\n- 像素点2：$\\nabla I = (1, 2)$，$I_{t} = -5$，\n- 像素点3：$\\nabla I = (2, 2)$，$I_{t} = -8$。\n\n根据这些测量值，建立由推导出的线性关系所引申的最小二乘问题，以估计恒定速度 $u = (u_{x}, u_{y})$，并精确求解。请用一个包含 $u_{x}$ 和 $u_{y}$ 的行矩阵表示您的最终答案，以体素/帧为单位，并表示为精确分数。无需四舍五入。\n\n此外，请简洁地说明在小形变配准算法中，如何利用推导出的线性关系来估计增量位移。\n\n最终答案必须是估计的速度分量，以单个行矩阵的形式表示，单位为体素/帧。",
            "solution": "**第1部分：线性关系的推导**\n\n亮度恒定原理指出，特定组织点的强度在移动过程中随时间保持不变。设一个点在时间 $t$ 位于位置 $(x, y)$。在短暂的时间 $\\delta t$ 之后，它将移动到新位置 $(x + \\delta x, y + \\delta y)$。速度分量为 $u_x = \\frac{dx}{dt}$ 和 $u_y = \\frac{dy}{dt}$。对于一个微小的时间间隔 $\\delta t$，位移为 $\\delta x \\approx u_x \\delta t$ 和 $\\delta y \\approx u_y \\delta t$。\n\n亮度恒定可以用数学方式表示为：\n$$I(x + \\delta x, y + \\delta y, t + \\delta t) = I(x, y, t)$$\n代入位移的表达式：\n$$I(x + u_x \\delta t, y + u_y \\delta t, t + \\delta t) = I(x, y, t)$$\n问题陈述中提到我们可以假设小形变，这使得对左侧在点 $(x, y, t)$ 附近进行一阶泰勒级数展开是合理的：\n$$I(x, y, t) + \\frac{\\partial I}{\\partial x}(u_x \\delta t) + \\frac{\\partial I}{\\partial y}(u_y \\delta t) + \\frac{\\partial I}{\\partial t}(\\delta t) + O((\\delta t)^2) \\approx I(x, y, t)$$\n从两边减去 $I(x, y, t)$ 并忽略高阶项，得到：\n$$\\frac{\\partial I}{\\partial x} u_x \\delta t + \\frac{\\partial I}{\\partial y} u_y \\delta t + \\frac{\\partial I}{\\partial t} \\delta t \\approx 0$$\n除以非零时间间隔 $\\delta t$，我们得到所需的一阶线性关系，即光流约束方程：\n$$\\frac{\\partial I}{\\partial x} u_x + \\frac{\\partial I}{\\partial y} u_y + \\frac{\\partial I}{\\partial t} = 0$$\n使用向量表示法，设空间强度梯度为 $\\nabla I = \\left(\\frac{\\partial I}{\\partial x}, \\frac{\\partial I}{\\partial y}\\right)$，速度向量为 $u = (u_x, u_y)$，时间导数为 $I_t = \\frac{\\partial I}{\\partial t}$。方程变为：\n$$\\nabla I \\cdot u + I_t = 0$$\n\n**第2部分：速度的最小二乘估计**\n\n我们得到了三个像素点的测量值，并被要求找到一个单一的恒定速度向量 $u = (u_x, u_y)$，该向量在最小二乘意义上最佳拟合所有三个测量值。每个像素点 $i$ 的方程是 $(\\nabla I)_i \\cdot u = -(I_t)_i$。这给了我们一个线性方程组：\n$$\n\\begin{cases}\n(\\frac{\\partial I}{\\partial x})_1 u_x + (\\frac{\\partial I}{\\partial y})_1 u_y = -(I_t)_1 \\\\\n(\\frac{\\partial I}{\\partial x})_2 u_x + (\\frac{\\partial I}{\\partial y})_2 u_y = -(I_t)_2 \\\\\n(\\frac{\\partial I}{\\partial x})_3 u_x + (\\frac{\\partial I}{\\partial y})_3 u_y = -(I_t)_3\n\\end{cases}\n$$\n代入给定值：\n- 像素点1：$\\nabla I = (3, 1)$，$I_{t} = -7 \\implies 3u_x + 1u_y = 7$\n- 像素点2：$\\nabla I = (1, 2)$，$I_{t} = -5 \\implies 1u_x + 2u_y = 5$\n- 像素点3：$\\nabla I = (2, 2)$，$I_{t} = -8 \\implies 2u_x + 2u_y = 8$\n\n这是一个形如 $A\\mathbf{x} = \\mathbf{b}$ 的超定系统，其中 $\\mathbf{x} = \\begin{pmatrix} u_x \\\\ u_y \\end{pmatrix}$。矩阵 $A$ 和向量 $\\mathbf{b}$ 为：\n$$ A = \\begin{pmatrix} 3  1 \\\\ 1  2 \\\\ 2  2 \\end{pmatrix}, \\quad \\mathbf{b} = \\begin{pmatrix} 7 \\\\ 5 \\\\ 8 \\end{pmatrix} $$\n最小二乘问题是找到向量 $\\mathbf{x}$，以最小化残差的欧几里得范数的平方 $\\|A\\mathbf{x} - \\mathbf{b}\\|^2$。解由正规方程给出：\n$$ A^T A \\mathbf{x} = A^T \\mathbf{b} $$\n首先，我们计算 $A^T A$：\n$$ A^T A = \\begin{pmatrix} 3  1  2 \\\\ 1  2  2 \\end{pmatrix} \\begin{pmatrix} 3  1 \\\\ 1  2 \\\\ 2  2 \\end{pmatrix} = \\begin{pmatrix} 3(3)+1(1)+2(2)  3(1)+1(2)+2(2) \\\\ 1(3)+2(1)+2(2)  1(1)+2(2)+2(2) \\end{pmatrix} = \\begin{pmatrix} 9+1+4  3+2+4 \\\\ 3+2+4  1+4+4 \\end{pmatrix} = \\begin{pmatrix} 14  9 \\\\ 9  9 \\end{pmatrix} $$\n接下来，我们计算 $A^T \\mathbf{b}$：\n$$ A^T \\mathbf{b} = \\begin{pmatrix} 3  1  2 \\\\ 1  2  2 \\end{pmatrix} \\begin{pmatrix} 7 \\\\ 5 \\\\ 8 \\end{pmatrix} = \\begin{pmatrix} 3(7)+1(5)+2(8) \\\\ 1(7)+2(5)+2(8) \\end{pmatrix} = \\begin{pmatrix} 21+5+16 \\\\ 7+10+16 \\end{pmatrix} = \\begin{pmatrix} 42 \\\\ 33 \\end{pmatrix} $$\n正规方程为：\n$$ \\begin{pmatrix} 14  9 \\\\ 9  9 \\end{pmatrix} \\begin{pmatrix} u_x \\\\ u_y \\end{pmatrix} = \\begin{pmatrix} 42 \\\\ 33 \\end{pmatrix} $$\n这是一个由两个线性方程组成的方程组：\n1. $14u_x + 9u_y = 42$\n2. $9u_x + 9u_y = 33$\n\n从第二个方程，我们可以通过除以 $3$ 来简化：\n$$ 3u_x + 3u_y = 11 \\implies u_y = \\frac{11 - 3u_x}{3} $$\n将此代入第一个方程：\n$$ 14u_x + 9\\left(\\frac{11 - 3u_x}{3}\\right) = 42 $$\n$$ 14u_x + 3(11 - 3u_x) = 42 $$\n$$ 14u_x + 33 - 9u_x = 42 $$\n$$ 5u_x = 42 - 33 $$\n$$ 5u_x = 9 $$\n$$ u_x = \\frac{9}{5} $$\n现在，我们求 $u_y$：\n$$ u_y = \\frac{11 - 3(\\frac{9}{5})}{3} = \\frac{\\frac{55}{5} - \\frac{27}{5}}{3} = \\frac{\\frac{28}{5}}{3} = \\frac{28}{15} $$\n估计的恒定速度为 $u = \\left(\\frac{9}{5}, \\frac{28}{15}\\right)$ 体素/帧。\n\n**第3部分：在小形变配准中的应用**\n\n在小形变图像配准中，目标是找到一个将一幅图像映射到另一幅图像的位移场。推导出的线性关系 $\\nabla I \\cdot u + I_t = 0$ 为此任务提供了基本约束。在这里，$u$ 是速度，当乘以时间步长时，给出增量位移场，而 $I_t$ 代表待配准图像之间的强度差异。这个单一的方程是不适定的，因为它在每个像素点只为两个未知的位移分量 $(u_x, u_y)$ 提供一个约束（孔径问题）。配准算法通过引入额外的约束来克服这个问题。例如，本问题中演示的Lucas-Kanade方法假设位移在局部图像区域内是恒定的，从而创建一个可以通过最小二乘法求解的超定系统。对于较大的形变，配准通常是迭代执行的：算法使用此线性关系计算一个小的增量位移场，用该场对图像进行扭曲，然后重复此过程，直到图像对齐。因此，推导出的关系对于计算每次增量更新至关重要。",
            "answer": "$$ \\boxed{\\begin{pmatrix} \\frac{9}{5}  \\frac{28}{15} \\end{pmatrix}} $$"
        }
    ]
}