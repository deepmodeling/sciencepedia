{
    "hands_on_practices": [
        {
            "introduction": "这个练习将带你深入差分隐私的核心：拉普拉斯机制。为了保护健康数据中的个体隐私，我们不能直接发布原始的统计结果，而需要加入经过精确校准的“噪声”。通过这个实践，你将从第一性原理出发，推导出拉普拉斯机制的噪声参数应如何设置以满足严格的 $\\epsilon$-差分隐私定义，并通过编程模拟来直观感受不同隐私参数设置对数据可用性的影响。",
            "id": "4556484",
            "problem": "考虑在差分隐私（DP）的数学框架下，发布一个从健康登记库查询中获得的整数值计数（例如，医院数据库中具有特定诊断的个体数量）。如果两个数据集仅在单个个体的记录上存在差异，则称它们为邻近数据集。设查询函数为一个确定性计数，其全局敏感度定义为该函数在所有邻近数据集上的输出的最大变化量。假设一个机制通过添加从中心化拉普拉斯分布中抽取的噪声来发布带噪结果。从 $\\epsilon$-差分隐私（DP）的形式化定义和全局敏感度的定义出发，推导噪声分布必须满足的必要条件，以使该机制满足 $\\epsilon$-DP，并从此条件推导出具有给定敏感度的计数查询所需的拉普拉斯分布的尺度参数。然后，对于下面提供的具体参数值，计算拉普拉斯噪声尺度，并通过蒙特卡洛模拟估计发布值与真实计数之间的绝对偏差至少为一个指定的非负阈值的概率。该概率必须以十进制小数表示。\n\n使用的基本原理：\n- $\\epsilon$-差分隐私（DP）的形式化定义：对于所有可测集 $S$ 和所有邻近数据集 $D$ 和 $D'$，机制 $\\mathcal{M}$ 必须满足 $\\Pr[\\mathcal{M}(D) \\in S] \\leq e^{\\epsilon} \\Pr[\\mathcal{M}(D') \\in S]$。\n- 函数 $f$ 的全局敏感度为 $\\Delta f = \\max_{D,D'} \\lvert f(D) - f(D') \\rvert$，其中 $D$ 和 $D'$ 为所有邻近数据集。\n- 位置参数为 $0$、尺度参数为 $b$ 的拉普拉斯分布的概率密度函数为 $p(x) = \\frac{1}{2b} \\exp\\!\\left(-\\frac{\\lvert x \\rvert}{b}\\right)$。\n\n任务：\n- 使用上述基本定义，推导对于全局敏感度为 $\\Delta f$ 的确定性计数查询，为实现 $\\epsilon$-DP 所需的拉普拉斯分布的尺度参数 $b$。\n- 对于每个测试用例，计算尺度 $b$，并使用固定的随机种子通过蒙特卡洛方法估计概率 $\\Pr(\\lvert X \\rvert \\geq \\tau)$，其中 $X$ 是添加到真实计数的拉普拉斯噪声，$\\tau \\ge 0$ 是阈值。同时，根据拉普拉斯分布解析地计算出作为 $b$ 和 $\\tau$ 函数的精确概率。\n\n模拟协议：\n- 对于每个测试用例，从 $\\mathrm{Laplace}(0,b)$ 中抽取 $N$ 个独立样本，并将绝对值 $\\lvert X \\rvert \\geq \\tau$ 的样本比例作为偏差概率的估计值。\n- 为保证可复现性，使用固定的随机种子 $123456$。\n\n测试用例：\n- 情况 1：$\\epsilon = 0.5$, $\\Delta f = 1$, $\\tau = 3$, $N = 200000$。\n- 情况 2：$\\epsilon = 0.05$, $\\Delta f = 1$, $\\tau = 3$, $N = 200000$。\n- 情况 3：$\\epsilon = 5.0$, $\\Delta f = 1$, $\\tau = 3$, $N = 200000$。\n- 情况 4：$\\epsilon = 0.5$, $\\Delta f = 2$, $\\tau = 3$, $N = 200000$。\n- 情况 5：$\\epsilon = 0.5$, $\\Delta f = 1$, $\\tau = 0$, $N = 200000$。\n- 情况 6：$\\epsilon = 0.5$, $\\Delta f = 1$, $\\tau = 3.5$, $N = 200000$。\n- 情况 7：$\\epsilon = 0.5$, $\\Delta f = 1$, $\\tau = 50$, $N = 200000$。\n\n答案规格：\n- 对于每个测试用例，输出一个包含三个浮点数的列表：拉普拉斯尺度 $b$、模拟概率估计值和精确解析概率。每个数字必须以十进制小数报告，且每个结果必须四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，其本身是按 $[b, p_{\\text{sim}}, p_{\\text{exact}}]$ 顺序排列的包含三个四舍五入后的小数的列表。例如，格式为 $[[b_1,p_{\\text{sim},1},p_{\\text{exact},1}],[b_2,p_{\\text{sim},2},p_{\\text{exact},2}],\\dots]$。",
            "solution": "该问题要求对差分隐私中拉普拉斯机制的尺度参数进行形式化推导，然后对几个测试用例进行计算分析。该分析既涉及蒙特卡洛模拟，也涉及偏差概率的解析计算。\n\n### 步骤1：拉普拉斯尺度参数的推导\n\n目标是确定一个中心化拉普拉斯分布的尺度参数 $b$，使得将从该分布中抽取的噪声添加到函数 $f$ 的输出后，能够满足 $\\epsilon$-差分隐私（$\\epsilon$-DP）。\n\n设 $f: \\mathcal{D}^n \\to \\mathbb{Z}$ 是一个确定性的整数值计数查询。机制 $\\mathcal{M}$ 发布查询结果的带噪版本：$\\mathcal{M}(D) = f(D) + X$，其中 $X$ 是从位置参数为 $0$、尺度参数为 $b > 0$ 的拉普拉斯分布中抽取的随机变量。该噪声的概率密度函数（PDF）为 $p(x) = \\frac{1}{2b} \\exp(-\\frac{\\lvert x \\rvert}{b})$。\n\n机制 $\\mathcal{M}$ 在数据库 $D$ 上产生输出 $z \\in \\mathbb{R}$ 的概率由噪声在 $z - f(D)$ 处的概率密度函数给出：\n$$\np(z|D) = \\frac{1}{2b} \\exp\\left(-\\frac{\\lvert z - f(D) \\rvert}{b}\\right)\n$$\n\n$\\epsilon$-DP的定义指出，对于任意两个邻近数据集 $D$ 和 $D'$（仅相差一个个体的记录）以及任意可能的输出集合 $S$，必须满足以下不等式：\n$$\n\\Pr[\\mathcal{M}(D) \\in S] \\leq e^{\\epsilon} \\Pr[\\mathcal{M}(D') \\in S]\n$$\n如果对于任何可能的输出 $z$，其概率密度之比有界，则此条件成立：\n$$\n\\frac{p(z|D)}{p(z|D')} \\leq e^{\\epsilon}\n$$\n我们来计算这个比率：\n$$\n\\frac{p(z|D)}{p(z|D')} = \\frac{\\frac{1}{2b} \\exp\\left(-\\frac{\\lvert z - f(D) \\rvert}{b}\\right)}{\\frac{1}{2b} \\exp\\left(-\\frac{\\lvert z - f(D') \\rvert}{b}\\right)} = \\exp\\left(\\frac{\\lvert z - f(D') \\rvert - \\lvert z - f(D) \\rvert}{b}\\right)\n$$\n为确保DP条件，我们必须对指数项进行约束。根据反三角不等式，$\\lvert a \\rvert - \\lvert c \\rvert \\leq \\lvert a - c \\rvert$。令 $a = z - f(D')$ 和 $c = z - f(D)$。那么：\n$$\n\\lvert z - f(D') \\rvert - \\lvert z - f(D) \\rvert \\leq \\lvert (z - f(D')) - (z - f(D)) \\rvert = \\lvert f(D) - f(D') \\rvert\n$$\n全局敏感度 $\\Delta f$ 定义为在所有邻近数据集对 $D, D'$ 上该差值的最大可能值：\n$$\n\\Delta f = \\max_{D,D'} \\lvert f(D) - f(D') \\rvert\n$$\n对于一个简单的计数查询，添加或删除一个个体的记录最多使计数改变 $1$，因此全局敏感度为 $\\Delta f = 1$。\n\n将这个最大值代入我们关于指数的不等式中，得到概率比率的上限：\n$$\n\\frac{p(z|D)}{p(z|D')} \\leq \\exp\\left(\\frac{\\Delta f}{b}\\right)\n$$\n为了满足 $\\epsilon$-DP，这个上界不能大于 $e^{\\epsilon}$：\n$$\n\\exp\\left(\\frac{\\Delta f}{b}\\right) \\leq e^{\\epsilon}\n$$\n对两边取自然对数，得到：\n$$\n\\frac{\\Delta f}{b} \\leq \\epsilon\n$$\n为了在满足隐私保证的前提下添加最少的噪声（即最大化效用），我们选择 $b$ 的最小值，这在等式成立时达到：\n$$\nb = \\frac{\\Delta f}{\\epsilon}\n$$\n这就是拉普拉斯机制为具有全局敏感度 $\\Delta f$ 的函数实现 $\\epsilon$-DP 所需的尺度参数。\n\n### 步骤2：偏差概率的解析计算\n\n问题要求计算噪声的绝对偏差 $\\lvert X \\rvert$ 至少为某个阈值 $\\tau \\geq 0$ 的概率，其中 $X \\sim \\mathrm{Laplace}(0,b)$。\n$$\n\\Pr(\\lvert X \\rvert \\geq \\tau)\n$$\n这等价于 $1 - \\Pr(\\lvert X \\rvert  \\tau) = 1 - \\Pr(-\\tau  X  \\tau)$。另外，由于拉普拉斯分布关于 $0$ 的对称性，我们可以写成：\n$$\n\\Pr(\\lvert X \\rvert \\geq \\tau) = \\Pr(X \\geq \\tau) + \\Pr(X \\leq -\\tau) = 2 \\Pr(X \\geq \\tau)\n$$\n我们通过对概率密度函数（PDF）从 $\\tau$ 到 $\\infty$ 积分来计算 $\\Pr(X \\geq \\tau)$。对于 $x \\geq \\tau \\geq 0$，有 $\\lvert x \\rvert = x$：\n$$\n\\Pr(X \\geq \\tau) = \\int_{\\tau}^{\\infty} \\frac{1}{2b} \\exp\\left(-\\frac{x}{b}\\right) dx\n$$\n$$\n= \\frac{1}{2b} \\left[ -b \\exp\\left(-\\frac{x}{b}\\right) \\right]_{\\tau}^{\\infty} = -\\frac{1}{2} \\left[ \\lim_{x \\to \\infty} \\exp\\left(-\\frac{x}{b}\\right) - \\exp\\left(-\\frac{\\tau}{b}\\right) \\right]\n$$\n$$\n= -\\frac{1}{2} \\left[ 0 - \\exp\\left(-\\frac{\\tau}{b}\\right) \\right] = \\frac{1}{2} \\exp\\left(-\\frac{\\tau}{b}\\right)\n$$\n因此，总概率为：\n$$\n\\Pr(\\lvert X \\rvert \\geq \\tau) = 2 \\times \\frac{1}{2} \\exp\\left(-\\frac{\\tau}{b}\\right) = \\exp\\left(-\\frac{\\tau}{b}\\right)\n$$\n对于 $\\tau=0$ 的特殊情况，概率为 $\\exp(0)=1$，这与预期相符。\n\n### 步骤3：计算实现\n\n对于每个由参数 $(\\epsilon, \\Delta f, \\tau, N)$ 定义的测试用例：\n1.  拉普拉斯尺度参数计算为 $b = \\Delta f / \\epsilon$。\n2.  执行蒙特卡洛模拟。使用固定的随机种子 $123456$ 从 $\\mathrm{Laplace}(0, b)$ 分布中抽取总共 $N=200000$ 个随机样本，以保证可复现性。\n3.  模拟概率 $p_{\\text{sim}}$ 估计为绝对值大于或等于阈值 $\\tau$ 的样本所占的比例。\n4.  精确解析概率 $p_{\\text{exact}}$ 使用推导出的公式 $p_{\\text{exact}} = \\exp(-\\tau/b)$ 计算。\n5.  每个测试用例的结果，包括尺度 $b$、模拟概率 $p_{\\text{sim}}$ 和精确概率 $p_{\\text{exact}}$，都四舍五入到六位小数。最终输出是按指定格式组织的这些结果的列表。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the differential privacy problem for the given test suite.\n    \n    For each case, it computes:\n    1. The Laplace scale parameter 'b'.\n    2. The simulated probability that the noise exceeds a threshold.\n    3. The exact analytical probability for the same event.\n    \"\"\"\n\n    # Test suite as specified in the problem statement.\n    # Each case is a tuple: (epsilon, delta_f, tau, N)\n    test_cases = [\n        (0.5, 1, 3, 200000),   # Case 1\n        (0.05, 1, 3, 200000),  # Case 2\n        (5.0, 1, 3, 200000),   # Case 3\n        (0.5, 2, 3, 200000),   # Case 4\n        (0.5, 1, 0, 200000),   # Case 5\n        (0.5, 1, 3.5, 200000), # Case 6\n        (0.5, 1, 50, 200000)   # Case 7\n    ]\n\n    # Initialize the random number generator with a fixed seed for reproducibility.\n    # The use of default_rng is the modern, recommended practice in NumPy.\n    rng = np.random.default_rng(123456)\n\n    all_results = []\n\n    for epsilon, delta_f, tau, N in test_cases:\n        # Step 1: Compute the Laplace scale parameter 'b'.\n        # b = sensitivity / epsilon\n        if epsilon == 0:\n            # Epsilon must be positive. Handle this edge case, though not in test suite.\n            b = np.inf\n        else:\n            b = delta_f / epsilon\n\n        # Step 2: Estimate the probability via Monte Carlo simulation.\n        # Draw N samples from the Laplace distribution with location 0 and scale b.\n        laplace_samples = rng.laplace(loc=0.0, scale=b, size=N)\n        \n        # Count the number of samples where the absolute value is >= tau.\n        deviation_count = np.sum(np.abs(laplace_samples) >= tau)\n        \n        # The simulated probability is the fraction of such samples.\n        p_sim = deviation_count / N\n\n        # Step 3: Compute the exact analytical probability.\n        # The probability is P(|X| >= tau) = exp(-tau / b) for X ~ Laplace(0, b).\n        if b == 0: # Sensitivity is 0\n            p_exact = 1.0 if tau == 0 else 0.0\n        elif np.isinf(b): # Epsilon is 0\n            p_exact = 1.0 # Infinite noise, always deviates\n        else:\n            p_exact = np.exp(-tau / b)\n\n        # Store the results, rounded to six decimal places, as required.\n        result_triplet = [b, p_sim, p_exact]\n        all_results.append(result_triplet)\n\n    # Format the final output string as a list of lists of floats,\n    # with each number formatted to six decimal places.\n    case_strings = []\n    for res in all_results:\n        # rounding is done here before formatting to match the requirement\n        b_rounded = round(res[0], 6)\n        psim_rounded = round(res[1], 6)\n        pexact_rounded = round(res[2], 6)\n\n        # f-string formatting ensures trailing zeros are printed for 6 decimal places\n        b_str = f\"{b_rounded:.6f}\"\n        psim_str = f\"{psim_rounded:.6f}\"\n        pexact_str = f\"{pexact_rounded:.6f}\"\n        case_strings.append(f\"[{b_str},{psim_str},{pexact_str}]\")\n    \n    print(f\"[{','.join(case_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在为数据添加了隐私保护噪声之后，一个至关重要的问题随之而来：我们发布的数据在多大程度上仍然是准确和有用的？这个练习将引导你探讨隐私与效用之间的根本性权衡，特别是在处理罕见事件（例如，罕见病患者计数）时，这一挑战尤为突出。你将通过推导期望相对误差的精确表达式，来量化分析在使用拉普拉斯机制后，真实计数的数值大小如何直接影响发布结果的可靠性。",
            "id": "4556467",
            "problem": "一个国家健康登记系统包含 $N$ 个人的记录。令 $f(D)$ 表示计数查询，该查询返回数据集 $D$ 中患有某种罕见病的个体数量。该机构希望在差分隐私（DP）下，具体是 $\\epsilon$-差分隐私，发布此计数的隐私保护估计值，使用拉普拉斯机制，且不进行裁剪或舍入等后处理。邻近性定义为增加或删除单个个体的记录。\n\n从 $\\epsilon$-差分隐私的形式化定义和函数 $f$ 的全局敏感度概念出发，论证拉普拉斯机制对计数查询的校准方法，并从第一性原理上解释为何罕见病计数查询在差分隐私下具有较高的相对误差。然后，推导当真实计数为 $c \\geq 1$，函数的全局敏感度为 $1$，并且使用拉普拉斯机制（其尺度根据隐私参数 $\\epsilon$ 进行标准校准）时，发布的计数的预期相对误差。\n\n形式上，令发布的计数为 $\\hat{c} = c + Z$，其中 $Z$ 是一个中心为 $0$ 的拉普拉斯随机变量，其尺度被选择为满足全局敏感度为 $1$ 的函数的 $\\epsilon$-差分隐私。对于固定的真实计数 $c$，将相对误差定义为\n$$\nR(c,\\epsilon) \\equiv \\mathbb{E}\\left[\\frac{|\\hat{c} - c|}{c}\\right],\n$$\n其中期望是针对机制的随机性计算的。以 $c$ 和 $\\epsilon$ 的函数形式，推导 $R(c,\\epsilon)$ 的闭式解。将您的最终答案表示为解析表达式；无需舍入。在您的推导过程中，清楚地说明您所做的任何假设，并确保在健康数据的背景下具有科学真实性。",
            "solution": "问题陈述已经过严格验证，被认为是有效的。它在科学上基于成熟的差分隐私数学理论，问题提出得当，目标明确，并包含进行严谨推导所需的所有必要信息。\n\n该问题需要分三部分回答：论证拉普拉斯机制的校准方法，解释罕见事件计数相对误差高的原因，以及对预期相对误差的形式化推导。我们将依次处理每个部分。\n\n首先，我们建立基本原则。如果对于任何两个邻近数据集 $D_1$ 和 $D_2$（相差一个个体的记录），以及对于任何可能的输出集合 $S$，以下不等式成立，则机制 $\\mathcal{M}$ 提供 $\\epsilon$-差分隐私：\n$$\n\\text{Pr}[\\mathcal{M}(D_1) \\in S] \\le \\exp(\\epsilon) \\cdot \\text{Pr}[\\mathcal{M}(D_2) \\in S]\n$$\n拉普拉斯机制向函数 $f$ 的输出添加噪声。它定义为 $\\mathcal{M}(D) = f(D) + Z$，其中 $Z$ 是从均值为 $0$、尺度参数为 $b$ 的拉普拉斯分布中抽取的随机变量，记为 $Z \\sim \\text{Lap}(0, b)$。$Z$ 的概率密度函数（PDF）为 $p(z) = \\frac{1}{2b} \\exp\\left(-\\frac{|z|}{b}\\right)$。\n\n所需噪声量由函数 $f$ 的全局敏感度（记为 $\\Delta f$）决定。全局敏感度是指当数据集中增加或删除一个个体的记录时，函数输出可能发生的最大变化。对于实值函数，其定义为：\n$$\n\\Delta f = \\max_{D_1, D_2} |f(D_1) - f(D_2)|\n$$\n其中最大值取自所有邻近数据集对 $D_1$ 和 $D_2$。对于计数查询，例如计算患有特定疾病的个体数量，增加或删除单个记录最多只能使总数改变 $1$。因此，全局敏感度为 $\\Delta f = 1$。\n\n现在，我们来论证尺度参数 $b$ 的校准。对于任何输出值 $y$，拉普拉斯机制在邻近数据集 $D_1$ 和 $D_2$ 上的概率比为：\n$$\n\\frac{\\text{Pr}[\\mathcal{M}(D_1) = y]}{\\text{Pr}[\\mathcal{M}(D_2) = y]} = \\frac{\\frac{1}{2b} \\exp\\left(-\\frac{|y - f(D_1)|}{b}\\right)}{\\frac{1}{2b} \\exp\\left(-\\frac{|y - f(D_2)|}{b}\\right)} = \\exp\\left(\\frac{|y - f(D_2)| - |y - f(D_1)|}{b}\\right)\n$$\n根据反三角不等式，我们有 $|y - f(D_2)| - |y - f(D_1)| \\le |f(D_1) - f(D_2)|$。右侧受全局敏感度的限制，即 $|f(D_1) - f(D_2)| \\le \\Delta f$。因此，\n$$\n\\frac{\\text{Pr}[\\mathcal{M}(D_1) = y]}{\\text{Pr}[\\mathcal{M}(D_2) = y]} \\le \\exp\\left(\\frac{\\Delta f}{b}\\right)\n$$\n为满足 $\\epsilon$-差分隐私，我们要求该比率不大于 $\\exp(\\epsilon)$。这导致条件 $\\exp\\left(\\frac{\\Delta f}{b}\\right) \\le \\exp(\\epsilon)$，可简化为 $\\frac{\\Delta f}{b} \\le \\epsilon$，或 $b \\ge \\frac{\\Delta f}{\\epsilon}$。标准校准方法使用满足隐私保证所需的最小噪声量，因此我们选择 $b = \\frac{\\Delta f}{\\epsilon}$。对于 $\\Delta f = 1$ 的计数查询，尺度参数恰好为 $b = \\frac{1}{\\epsilon}$。这就完成了对机制校准的论证。\n\n第二，我们解释为何罕见病计数查询具有高相对误差。拉普拉斯机制添加的噪声量级由尺度 $b = \\frac{\\Delta f}{\\epsilon}$ 决定。对于计数查询，此噪声尺度为 $b = \\frac{1}{\\epsilon}$。关键在于，噪声的量级与真实计数 $c = f(D)$ 无关。绝对误差由 $|\\hat{c} - c| = |Z|$ 给出，其期望值为 $\\mathbb{E}[|Z|] = b = \\frac{1}{\\epsilon}$。然而，相对误差是绝对误差与真实计数的比值，即 $\\frac{|\\hat{c} - c|}{c}$。当疾病罕见时，真实计数 $c$ 是一个小整数。一个恒定的预期绝对误差 $\\frac{1}{\\epsilon}$ 除以一个很小的 $c$ 值，会导致一个很大的相对误差。例如，如果 $\\epsilon = 0.1$ 且真实计数为 $c=2$，则预期绝对误差为 $10$，是真实计数的五倍，这表明效用极差。形式上，预期相对误差约为 $\\frac{\\mathbb{E}[|Z|]}{c} = \\frac{1}{c\\epsilon}$，它与 $c$ 成反比。当 $c$ 接近 $1$（对于 $c \\ge 1$），此误差会很大。\n\n第三，我们推导预期相对误差 $R(c, \\epsilon)$ 的精确表达式。其定义如下：\n$$\nR(c, \\epsilon) \\equiv \\mathbb{E}\\left[\\frac{|\\hat{c} - c|}{c}\\right]\n$$\n问题陈述中指出，发布的计数为 $\\hat{c} = c + Z$，其中 $c$ 是真实计数，$Z$ 是拉普拉斯噪声。将此代入定义中：\n$$\n|\\hat{c} - c| = |(c + Z) - c| = |Z|\n$$\n$R(c, \\epsilon)$ 的表达式变为：\n$$\nR(c, \\epsilon) = \\mathbb{E}\\left[\\frac{|Z|}{c}\\right]\n$$\n由于 $c$ 是一个固定的、非随机的量（在此期望计算中，真实计数被假定为一个特定值），我们可以将其从期望中提出：\n$$\nR(c, \\epsilon) = \\frac{1}{c} \\mathbb{E}[|Z|]\n$$\n现在我们必须计算拉普拉斯噪声变量 $Z$ 的期望绝对值。如前所述，对于计数查询，$Z \\sim \\text{Lap}(0, b)$ 且 $b = \\frac{\\Delta f}{\\epsilon} = \\frac{1}{\\epsilon}$。$Z$ 的概率密度函数（PDF）为：\n$$\np(z) = \\frac{1}{2b} \\exp\\left(-\\frac{|z|}{b}\\right) = \\frac{\\epsilon}{2} \\exp(-\\epsilon|z|)\n$$\n期望 $\\mathbb{E}[|Z|]$ 通过积分计算得出：\n$$\n\\mathbb{E}[|Z|] = \\int_{-\\infty}^{\\infty} |z| p(z) dz = \\int_{-\\infty}^{\\infty} |z| \\frac{\\epsilon}{2} \\exp(-\\epsilon|z|) dz\n$$\n由于被积函数是 $z$ 的偶函数，我们可以简化积分为：\n$$\n\\mathbb{E}[|Z|] = 2 \\int_{0}^{\\infty} z \\frac{\\epsilon}{2} \\exp(-\\epsilon z) dz = \\epsilon \\int_{0}^{\\infty} z \\exp(-\\epsilon z) dz\n$$\n这个积分可以使用分部积分法求解。令 $u = z$ 且 $dv = \\exp(-\\epsilon z) dz$。则 $du = dz$ 且 $v = -\\frac{1}{\\epsilon}\\exp(-\\epsilon z)$。\n$$\n\\int z \\exp(-\\epsilon z) dz = z \\left(-\\frac{1}{\\epsilon}\\exp(-\\epsilon z)\\right) - \\int \\left(-\\frac{1}{\\epsilon}\\exp(-\\epsilon z)\\right) dz = -\\frac{z}{\\epsilon}\\exp(-\\epsilon z) - \\frac{1}{\\epsilon^2}\\exp(-\\epsilon z)\n$$\n计算从 $0$ 到 $\\infty$ 的定积分：\n$$\n\\int_{0}^{\\infty} z \\exp(-\\epsilon z) dz = \\left[-\\frac{z}{\\epsilon}\\exp(-\\epsilon z) - \\frac{1}{\\epsilon^2}\\exp(-\\epsilon z)\\right]_{0}^{\\infty}\n$$\n在上限 $z \\to \\infty$ 处，由于指数衰减项主导了线性项 $z$，两项都趋于 $0$。在下限 $z=0$ 处，第一项为 $0$，第二项为 $-\\frac{1}{\\epsilon^2}\\exp(0) = -\\frac{1}{\\epsilon^2}$。\n$$\n\\int_{0}^{\\infty} z \\exp(-\\epsilon z) dz = (0) - \\left(0 - \\frac{1}{\\epsilon^2}\\right) = \\frac{1}{\\epsilon^2}\n$$\n将此结果代回 $\\mathbb{E}[|Z|]$ 的表达式中：\n$$\n\\mathbb{E}[|Z|] = \\epsilon \\left(\\frac{1}{\\epsilon^2}\\right) = \\frac{1}{\\epsilon}\n$$\n这证实了尺度为 $b$ 的拉普拉斯分布的平均绝对偏差确实是 $b$。在我们的例子中，$b=1/\\epsilon$。\n\n最后，我们将此结果代入预期相对误差的表达式中：\n$$\nR(c, \\epsilon) = \\frac{1}{c} \\mathbb{E}[|Z|] = \\frac{1}{c} \\left(\\frac{1}{\\epsilon}\\right) = \\frac{1}{c\\epsilon}\n$$\n这就是使用拉普拉斯机制的差分隐私计数查询在真实计数 $c \\geq 1$ 时的预期相对误差的闭式表达式。",
            "answer": "$$\\boxed{\\frac{1}{c\\epsilon}}$$"
        },
        {
            "introduction": "现实世界中的数据分析任务往往不是一次性的查询，而是在一段时间内持续发布统计数据，例如医院每日更新疫情指标。每次发布都会消耗一部分“隐私预算”，那么如何追踪和控制总的隐私泄露风险呢？这个练习将带你进入一个更高级也更实际的场景，通过应用高级组合定理，来精确计算在连续发布多个关联查询（如滑动时间窗口平均值）后，累积的总体隐私损失。",
            "id": "4556441",
            "problem": "一家医院维护着一个由 $M = 1000$ 名患者组成的队列，记录了每位患者 $i \\in \\{1,\\dots,M\\}$ 在每一天 $t$ 的每日归一化血清肌酐值 $x_{i,t} \\in [0,1]$。每天 $t$，医院会发布一个滑动窗口聚合值，该值定义为队列每日均值的30天窗口平均值，即查询：\n$$\nf_{t}(D) \\;=\\; \\frac{1}{w}\\sum_{s=t-w+1}^{t} \\left(\\frac{1}{M}\\sum_{i=1}^{M} x_{i,s}\\right),\n$$\n窗口长度 $w=30$。医院使用拉普拉斯机制对每次发布进行私有化处理：它发布 $f_{t}(D) + Z_{t}$，其中 $Z_{t}$ 是一个拉普拉斯随机变量，其尺度参数的选择是为了在差分隐私 (DP) 下达到单次发布隐私参数 $\\epsilon_{0} = 0.05$。假设相邻数据集的差异在于单个个体在所有时间内的全部记录。医院使用独立的噪声，连续 $k=365$ 天每天执行一次此发布，因此窗口是重叠的。\n\n从差分隐私 (DP) 的核心定义、查询的全局敏感度以及DP的高级组合定理出发，确定在松弛参数 $\\delta' = 10^{-6}$ 的情况下，经过所有 $k$ 次发布后，在高级组合界限下的累积隐私损失参数 $\\epsilon_{\\text{total}}$。\n\n给出 $\\epsilon_{\\text{total}}$ 的最终数值，四舍五入到四位有效数字。答案中无需包含物理单位。",
            "solution": "用户要求使用差分隐私 (DP) 的高级组合定理，为一系列私有化数据发布计算累积隐私损失参数 $\\epsilon_{\\text{total}}$。\n\n首先，我将验证问题陈述。\n\n**第1步：提取已知条件**\n- 患者数量：$M = 1000$。\n- 患者数据范围：$x_{i,t} \\in [0,1]$。\n- 查询函数：$f_{t}(D) = \\frac{1}{w}\\sum_{s=t-w+1}^{t} \\left(\\frac{1}{M}\\sum_{i=1}^{M} x_{i,s}\\right)$。\n- 移动平均的窗口长度：$w=30$。\n- 私有化机制：拉普拉斯机制，$f_{t}(D) + Z_{t}$。\n- 单次发布隐私参数：$\\epsilon_{0} = 0.05$。\n- 连续每日发布次数（及机制数）：$k=365$。\n- 相邻条件：相邻数据集的差异在于单个个体在所有时间内的全部记录。\n- 高级组合的松弛参数：$\\delta' = 10^{-6}$。\n\n**第2步：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于已建立的差分隐私数学理论，利用了拉普拉斯机制、全局敏感度和高级组合定理等标准概念。所描述的场景是DP在医疗数据分析中的一个典型应用。该问题在科学上是合理的。\n- **适定性：** 计算所需的所有参数（$\\epsilon_0$, $k$, $\\delta'$, $M$, $w$）均已给出且无歧义。目标是基于一个标准定理计算一个单一、特定的值 $\\epsilon_{\\text{total}}$。该问题是适定的。\n- **客观性：** 该问题以精确、定量的术语陈述。它没有主观或模糊的语言。\n- **其他标准：** 该问题是自洽的，其约束条件是一致的，数据是合理的，且问题并非微不足道。\n\n**第3步：结论与行动**\n问题是有效的。我现在开始进行解答。\n\n解决方案需要三个主要步骤：\n1.  确定查询函数 $f_t$ 的全局敏感度。\n2.  确认每次发布都满足 $(\\epsilon_0, 0)$-DP。\n3.  应用高级组合定理，找出 $k$ 次发布后的总隐私损失 $\\epsilon_{\\text{total}}$。\n\n**1. 查询的全局敏感度**\n一个随机化机制 $\\mathcal{M}$ 提供 $(\\epsilon, \\delta)$-差分隐私，如果对于任何两个相邻的数据集 $D$ 和 $D'$ 以及任何可能的输出集合 $S$，以下不等式成立：$\\text{Pr}(\\mathcal{M}(D) \\in S) \\le \\exp(\\epsilon) \\text{Pr}(\\mathcal{M}(D') \\in S) + \\delta$。对于提供 $(\\epsilon, 0)$-DP 的拉普拉斯机制，我们需要查询函数的 $L_1$ 全局敏感度 $\\Delta_1 f$。它被定义为在任意两个相邻数据集之间切换时，查询输出可能产生的最大变化量：\n$$\n\\Delta_1 f = \\max_{D, D'} |f(D) - f(D')|\n$$\n在本问题中，查询为 $f_{t}(D) = \\frac{1}{wM}\\sum_{s=t-w+1}^{t} \\sum_{i=1}^{M} x_{i,s}$。相邻数据集 $D$ 和 $D'$ 的差异在于单个患者（例如患者 $j$）的全部记录。这意味着对于所有的 $i \\ne j$ 和所有的 $s$，数据集 $D$ 中的 $x_{i,s}$ 与数据集 $D'$ 中的 $x'_{i,s}$ 完全相同。查询输出的差值为：\n$$\n|f_t(D) - f_t(D')| = \\left| \\frac{1}{wM}\\sum_{s=t-w+1}^{t} \\sum_{i=1}^{M} x_{i,s} - \\frac{1}{wM}\\sum_{s=t-w+1}^{t} \\sum_{i=1}^{M} x'_{i,s} \\right|\n$$\n根据相邻性的定义，这可以简化为：\n$$\n|f_t(D) - f_t(D')| = \\left| \\frac{1}{wM}\\sum_{s=t-w+1}^{t} (x_{j,s} - x'_{j,s}) \\right|\n$$\n使用三角不等式：\n$$\n|f_t(D) - f_t(D')| \\le \\frac{1}{wM}\\sum_{s=t-w+1}^{t} |x_{j,s} - x'_{j,s}|\n$$\n患者数据被归一化，使得 $x_{i,s}, x'_{i,s} \\in [0,1]$。因此，$|x_{j,s} - x'_{j,s}|$ 的最大可能值为 $|1 - 0| = 1$。为了使总差值最大化，我们假设在大小为 $w$ 的窗口内的所有 $s$ 都发生这种最大变化。因此，全局敏感度 $\\Delta_1 f_t$ 为：\n$$\n\\Delta_1 f_t = \\max_{D, D'} |f_t(D) - f_t(D')| = \\frac{1}{wM}\\sum_{s=t-w+1}^{t} (1) = \\frac{1}{wM} \\cdot w = \\frac{1}{M}\n$$\n给定 $M=1000$，每次每日查询的全局敏感度为：\n$$\n\\Delta_1 f_t = \\frac{1}{1000}\n$$\n\n**2. 单次发布的隐私保障**\n医院使用拉普拉斯机制，该机制向查询结果 $f_t(D)$ 添加噪声 $Z_t \\sim \\text{Lap}(b)$。为了满足 $\\epsilon_0$-DP（即 $(\\epsilon_0, 0)$-DP），拉普拉斯分布的尺度参数 $b$ 必须设置为 $b = \\Delta_1 f_t / \\epsilon_0$。对于每次发布，该值为：\n$$\nb = \\frac{1/M}{\\epsilon_0} = \\frac{1/1000}{0.05} = \\frac{0.001}{0.05} = \\frac{1}{50} = 0.02\n$$\n问题陈述中指出，每次发布都旨在实现 $\\epsilon_0 = 0.05$ 的隐私性，这意味着 $k=365$ 个机制中的每一个都是 $(\\epsilon_0, 0)$-DP，其中 $\\epsilon_0 = 0.05$。\n\n**3. 高级组合**\n我们正在组合 $k=365$ 个机制，每个机制都满足 $(\\epsilon_0, 0)$-DP，其中 $\\epsilon_0 = 0.05$。高级组合定理为累积隐私损失提供了一个比简单线性组合更紧密的界限。它指出，对于任何 $\\delta'  0$，$k$ 个独立的 $(\\epsilon_0, 0)$-DP 机制的组合是 $(\\epsilon_{\\text{total}}, \\delta')$-DP，其中 $\\epsilon_{\\text{total}}$ 由下式给出：\n$$\n\\epsilon_{\\text{total}} = \\sqrt{2k \\ln(1/\\delta')} \\epsilon_0 + k \\epsilon_0 (\\exp(\\epsilon_0) - 1)\n$$\n我们已知以下参数：\n- $k = 365$\n- $\\epsilon_0 = 0.05$\n- $\\delta' = 10^{-6}$\n\n将这些值代入公式：\n$$\n\\epsilon_{\\text{total}} = \\sqrt{2(365) \\ln(1/10^{-6})} (0.05) + (365)(0.05) (\\exp(0.05) - 1)\n$$\n首先，计算主要项的参数：\n$$\n\\ln(1/10^{-6}) = \\ln(10^6) = 6 \\ln(10) \\approx 6 \\times 2.302585 = 13.81551\n$$\n现在，我们可以计算 $\\epsilon_{\\text{total}}$ 表达式的两个部分。\n第一项是：\n$$\n\\sqrt{2 \\times 365 \\times 13.81551} \\times 0.05 = \\sqrt{10085.3223} \\times 0.05 \\approx 100.4257 \\times 0.05 \\approx 5.021285\n$$\n第二项是：\n$$\n(365 \\times 0.05) (\\exp(0.05) - 1) = 18.25 \\times (1.051271 - 1) = 18.25 \\times 0.051271 \\approx 0.935606\n$$\n将这两项相加得到总隐私损失：\n$$\n\\epsilon_{\\text{total}} \\approx 5.021285 + 0.935606 = 5.956891\n$$\n问题要求将结果四舍五入到四位有效数字。\n$$\n\\epsilon_{\\text{total}} \\approx 5.957\n$$\n因此，在365次每日发布后，累积隐私保障为 $(5.957, 10^{-6})$-DP。累积隐私损失参数的值为 $\\epsilon_{\\text{total}} \\approx 5.957$。",
            "answer": "$$\\boxed{5.957}$$"
        }
    ]
}