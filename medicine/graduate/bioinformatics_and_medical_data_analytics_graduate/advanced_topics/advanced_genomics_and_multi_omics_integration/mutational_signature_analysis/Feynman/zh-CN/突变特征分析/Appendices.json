{
    "hands_on_practices": [
        {
            "introduction": "突变特征分析的核心在于使用非负矩阵分解 (NMF) 将一个突变目录矩阵 $V$ 近似为特征矩阵 $W$ 和暴露矩阵 $H$ 的乘积。这项基础练习 () 旨在通过一个具体的计算，帮助您直观地理解重建过程，并掌握如何使用弗罗贝尼乌斯范数 (Frobenius norm) 来量化模型重建的精确度。",
            "id": "4587886",
            "problem": "在生物信息学和医疗数据分析的突变特征分析中，一个非负突变目录矩阵 $V \\in \\mathbb{R}_{\\ge 0}^{m \\times n}$ 使用非负矩阵分解（NMF）近似为乘积 $W H$，其中 $W \\in \\mathbb{R}_{\\ge 0}^{m \\times r}$ 编码了 $r$ 个潜在的突变特征，作为 $m$ 个突变通道上的概率分布，而 $H \\in \\mathbb{R}_{\\ge 0}^{r \\times n}$ 编码了这 $n$ 个样本中这些特征的暴露程度。考虑一个合成目录，其中有 $m = 6$ 个突变通道和 $n = 3$ 个样本，并进行秩为2的近似（$r = 2$）。$W$ 的列被归一化，使其和为1（每个特征都是通道上的一个真离散分布），并且 $H$ 包含非负的暴露值。\n\n给定以下矩阵：\n$$\nV = \\begin{pmatrix}\n8  5  12 \\\\\n9  3  11 \\\\\n8  4  12 \\\\\n7  5  13 \\\\\n8  4  12 \\\\\n4  2  5\n\\end{pmatrix}, \\quad\nW = \\begin{pmatrix}\n\\frac{3}{12}  \\frac{1}{10} \\\\\n\\frac{2}{12}  \\frac{2}{10} \\\\\n\\frac{1}{12}  \\frac{3}{10} \\\\\n\\frac{3}{12}  \\frac{1}{10} \\\\\n\\frac{2}{12}  \\frac{2}{10} \\\\\n\\frac{1}{12}  \\frac{1}{10}\n\\end{pmatrix}, \\quad\nH = \\begin{pmatrix}\n24  12  36 \\\\\n20  10  30\n\\end{pmatrix}.\n$$\n\n计算重构目录 $W H$，然后计算由残差的弗罗贝尼乌斯范数量化的重构误差，即标量 $\\|V - W H\\|_{F}$。将最终误差表示为精确值；不要四舍五入。不需要单位。",
            "solution": "该问题被验证为具有科学依据、提法恰当且自洽。矩阵的维度与所需操作一致，并且在突变特征分析中的情境框架是恰当的。所有提供的数据和条件均有效。我们可以开始求解。\n\n目标是计算残差矩阵的弗罗贝尼乌斯范数 $\\|V - W H\\|_{F}$，其中 $V$、$W$ 和 $H$ 是给定的矩阵。一个矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 的弗罗贝尼乌斯范数定义为 $\\|A\\|_{F} = \\sqrt{\\sum_{i=1}^{m} \\sum_{j=1}^{n} |a_{ij}|^2}$。\n\n首先，我们必须计算重构目录，即特征矩阵 $W$ 和暴露矩阵 $H$ 的乘积。\n给定的矩阵是：\n$$\nV = \\begin{pmatrix}\n8  5  12 \\\\\n9  3  11 \\\\\n8  4  12 \\\\\n7  5  13 \\\\\n8  4  12 \\\\\n4  2  5\n\\end{pmatrix}, \\quad\nW = \\begin{pmatrix}\n\\frac{3}{12}  \\frac{1}{10} \\\\\n\\frac{2}{12}  \\frac{2}{10} \\\\\n\\frac{1}{12}  \\frac{3}{10} \\\\\n\\frac{3}{12}  \\frac{1}{10} \\\\\n\\frac{2}{12}  \\frac{2}{10} \\\\\n\\frac{1}{12}  \\frac{1}{10}\n\\end{pmatrix}, \\quad\nH = \\begin{pmatrix}\n24  12  36 \\\\\n20  10  30\n\\end{pmatrix}.\n$$\n我们可以简化矩阵 $W$ 中的分数：\n$$\nW = \\begin{pmatrix}\n\\frac{1}{4}  \\frac{1}{10} \\\\\n\\frac{1}{6}  \\frac{1}{5} \\\\\n\\frac{1}{12}  \\frac{3}{10} \\\\\n\\frac{1}{4}  \\frac{1}{10} \\\\\n\\frac{1}{6}  \\frac{1}{5} \\\\\n\\frac{1}{12}  \\frac{1}{10}\n\\end{pmatrix}\n$$\n现在，我们计算矩阵乘积 $WH$。设结果矩阵为 $V' = WH$。\n$$\nV' = WH = \\begin{pmatrix}\n\\frac{1}{4}  \\frac{1}{10} \\\\\n\\frac{1}{6}  \\frac{1}{5} \\\\\n\\frac{1}{12}  \\frac{3}{10} \\\\\n\\frac{1}{4}  \\frac{1}{10} \\\\\n\\frac{1}{6}  \\frac{1}{5} \\\\\n\\frac{1}{12}  \\frac{1}{10}\n\\end{pmatrix}\n\\begin{pmatrix}\n24  12  36 \\\\\n20  10  30\n\\end{pmatrix}\n$$\n我们计算 $V'$ 的每个元素：\n$V'_{11} = (\\frac{1}{4})(24) + (\\frac{1}{10})(20) = 6 + 2 = 8$\n$V'_{12} = (\\frac{1}{4})(12) + (\\frac{1}{10})(10) = 3 + 1 = 4$\n$V'_{13} = (\\frac{1}{4})(36) + (\\frac{1}{10})(30) = 9 + 3 = 12$\n\n$V'_{21} = (\\frac{1}{6})(24) + (\\frac{1}{5})(20) = 4 + 4 = 8$\n$V'_{22} = (\\frac{1}{6})(12) + (\\frac{1}{5})(10) = 2 + 2 = 4$\n$V'_{23} = (\\frac{1}{6})(36) + (\\frac{1}{5})(30) = 6 + 6 = 12$\n\n$V'_{31} = (\\frac{1}{12})(24) + (\\frac{3}{10})(20) = 2 + 6 = 8$\n$V'_{32} = (\\frac{1}{12})(12) + (\\frac{3}{10})(10) = 1 + 3 = 4$\n$V'_{33} = (\\frac{1}{12})(36) + (\\frac{3}{10})(30) = 3 + 9 = 12$\n\n$V'_{41} = (\\frac{1}{4})(24) + (\\frac{1}{10})(20) = 6 + 2 = 8$\n$V'_{42} = (\\frac{1}{4})(12) + (\\frac{1}{10})(10) = 3 + 1 = 4$\n$V'_{43} = (\\frac{1}{4})(36) + (\\frac{1}{10})(30) = 9 + 3 = 12$\n\n$V'_{51} = (\\frac{1}{6})(24) + (\\frac{1}{5})(20) = 4 + 4 = 8$\n$V'_{52} = (\\frac{1}{6})(12) + (\\frac{1}{5})(10) = 2 + 2 = 4$\n$V'_{53} = (\\frac{1}{6})(36) + (\\frac{1}{5})(30) = 6 + 6 = 12$\n\n$V'_{61} = (\\frac{1}{12})(24) + (\\frac{1}{10})(20) = 2 + 2 = 4$\n$V'_{62} = (\\frac{1}{12})(12) + (\\frac{1}{10})(10) = 1 + 1 = 2$\n$V'_{63} = (\\frac{1}{12})(36) + (\\frac{1}{10})(30) = 3 + 3 = 6$\n\n因此，重构矩阵为：\n$$\nWH = \\begin{pmatrix}\n8  4  12 \\\\\n8  4  12 \\\\\n8  4  12 \\\\\n8  4  12 \\\\\n8  4  12 \\\\\n4  2  6\n\\end{pmatrix}\n$$\n接下来，我们计算残差矩阵 $R = V - WH$。\n$$\nR = \\begin{pmatrix}\n8  5  12 \\\\\n9  3  11 \\\\\n8  4  12 \\\\\n7  5  13 \\\\\n8  4  12 \\\\\n4  2  5\n\\end{pmatrix} - \\begin{pmatrix}\n8  4  12 \\\\\n8  4  12 \\\\\n8  4  12 \\\\\n8  4  12 \\\\\n8  4  12 \\\\\n4  2  6\n\\end{pmatrix} = \\begin{pmatrix}\n8-8  5-4  12-12 \\\\\n9-8  3-4  11-12 \\\\\n8-8  4-4  12-12 \\\\\n7-8  5-4  13-12 \\\\\n8-8  4-4  12-12 \\\\\n4-4  2-2  5-6\n\\end{pmatrix}\n$$\n$$\nR = \\begin{pmatrix}\n0  1  0 \\\\\n1  -1  -1 \\\\\n0  0  0 \\\\\n-1  1  1 \\\\\n0  0  0 \\\\\n0  0  -1\n\\end{pmatrix}\n$$\n最后，我们计算残差矩阵 $R$ 的弗罗贝尼乌斯范数。\n$$\n\\|R\\|_{F} = \\sqrt{\\sum_{i=1}^{6} \\sum_{j=1}^{3} R_{ij}^2}\n$$\n$R$ 的元素平方和为：\n$$\n\\sum R_{ij}^2 = (0^2 + 1^2 + 0^2) + (1^2 + (-1)^2 + (-1)^2) + (0^2 + 0^2 + 0^2) + ((-1)^2 + 1^2 + 1^2) + (0^2 + 0^2 + 0^2) + (0^2 + 0^2 + (-1)^2)\n$$\n$$\n\\sum R_{ij}^2 = (0+1+0) + (1+1+1) + (0) + (1+1+1) + (0) + (1)\n$$\n$$\n\\sum R_{ij}^2 = 1 + 3 + 3 + 1 = 8\n$$\n因此，弗罗贝尼乌斯范数为：\n$$\n\\|V - WH\\|_{F} = \\|R\\|_{F} = \\sqrt{8} = \\sqrt{4 \\times 2} = 2\\sqrt{2}\n$$\n重构误差为 $2\\sqrt{2}$。",
            "answer": "$$\\boxed{2\\sqrt{2}}$$"
        },
        {
            "introduction": "在掌握了 NMF 的基本数学原理后，下一步是将其应用于实际的生物信息学工作流程中。本实践 () 要求您编写代码，模拟一个典型的“特征重配 (refitting)”分析场景：利用已知的参考突变特征（如 COSMIC 数据库中的特征），来解释一个新样本中的突变谱。这个过程将锻炼您解决非负最小二乘问题以及使用余弦相似度评估模型拟合优度的核心编程技能。",
            "id": "4587927",
            "problem": "给定一个简单碱基替换（SBS）突变印记的参考矩阵，以及在 $96$ 个分类突变通道中观测到的单核苷酸变异计数。目标是估计非负的印记暴露度，并使用余弦相似度评估重建图谱与观测图谱的匹配程度。该任务基于线性代数和凸优化，其基本原则如下：图谱表示为 $\\mathbb{R}^{96}$ 中的非负向量，印记暴露度为非负值，重建是参考印记的非负线性组合。\n\n从以下基础出发：\n\n- 线性叠加：一个观测到的计数向量 $c \\in \\mathbb{R}_{\\ge 0}^{96}$ 被建模为 $c \\approx S e$，其中 $S \\in \\mathbb{R}_{\\ge 0}^{96 \\times K}$ 的列是参考印记，$e \\in \\mathbb{R}_{\\ge 0}^{K}$ 是它们的非负暴露度。\n- 最小二乘最优性：暴露度估计应在非负性约束下最小化欧几里得重建误差的平方，即，在 $e \\ge 0$ 的条件下最小化 $\\lVert S e - c \\rVert_2^2$。\n- 归一化与可识别性：当 $S$ 的每一列都被归一化以使其 $\\ell_1$ 和等于 $1$ 时，总重建负荷 $\\sum_{i=1}^{96} (S e)_i$ 等于 $\\sum_{j=1}^{K} e_j$。这个恒等式使得通过缩放 $e$ 来使重建总数与观测总数相匹配成为可能。\n- 余弦相似度：对于两个向量 $x, y \\in \\mathbb{R}^{96}$，当两个范数都非零时，余弦相似度定义为 $\\mathrm{cos}(x, y) = \\dfrac{x^\\top y}{\\lVert x \\rVert_2 \\lVert y \\rVert_2}$。\n\n您的程序必须实现以下精确规范。\n\n1. 印记构建。使用 $K = 4$ 个参考印记，其灵感来源于癌症体细胞突变目录（COSMIC）的简单碱基替换（SBS）风格的 $96$ 通道图谱。将 $96$ 个通道划分为四个连续的、包含 $24$ 个索引的组：组 $0$ 是索引 $0$ 到 $23$，组 $1$ 是索引 $24$ 到 $47$，组 $2$ 是索引 $48$ 到 $71$，组 $3$ 是索引 $72$ 到 $95$。对于每个印记 $k \\in \\{0,1,2,3\\}$ 和通道索引 $i \\in \\{0,\\dots,95\\}$，定义未归一化的权重\n$$\nw_{i}^{(k)} = \\begin{cases}\n4,  \\text{if } \\left\\lfloor \\dfrac{i}{24} \\right\\rfloor = k, \\\\\n1,  \\text{otherwise.}\n\\end{cases}\n$$\n然后通过归一化至单位 $\\ell_1$ 和来形成每个印记列：\n$$\ns_{i}^{(k)} = \\dfrac{w_{i}^{(k)}}{\\sum_{r=0}^{95} w_{r}^{(k)}}, \\quad \\text{so that } \\sum_{i=0}^{95} s_{i}^{(k)} = 1 \\text{ for each } k.\n$$\n将这些列堆叠起来形成 $S \\in \\mathbb{R}_{\\ge 0}^{96 \\times 4}$。\n\n2. 暴露度估计。给定一个观测到的计数向量 $c \\in \\mathbb{R}_{\\ge 0}^{96}$，其总数为 $N = \\sum_{i=0}^{95} c_i$，计算一个暴露度估计 $\\hat e$ 作为非负最小二乘问题的解\n$$\n\\hat e \\in \\arg\\min_{e \\in \\mathbb{R}_{\\ge 0}^{4}} \\lVert S e - c \\rVert_2^2.\n$$\n然后，如果 $N > 0$ 且 $\\sum_{j=0}^{3} \\hat e_j > 0$，则重新缩放暴露度向量以匹配观测总数：\n$$\n\\tilde e = \\hat e \\cdot \\dfrac{N}{\\sum_{j=0}^{3} \\hat e_j}.\n$$\n如果 $N = 0$，则定义 $\\tilde e$ 为零向量。\n\n3. 重建与余弦相似度。形成重建图谱 $r = S \\tilde e$。定义 $c$ 和 $r$ 之间的余弦相似度为\n$$\n\\mathrm{cos}(c, r) = \\begin{cases}\n\\dfrac{c^\\top r}{\\lVert c \\rVert_2 \\lVert r \\rVert_2},  \\text{if } \\lVert c \\rVert_2 > 0 \\text{ and } \\lVert r \\rVert_2 > 0, \\\\\n1.0,  \\text{if } \\lVert c \\rVert_2 = 0 \\text{ and } \\lVert r \\rVert_2 = 0, \\\\\n0.0,  \\text{otherwise.}\n\\end{cases}\n$$\n\n4. 测试套件。通过以下保留总数的舍入到整数的过程，从指定的暴露度向量 $e^{(t)} \\in \\mathbb{R}_{\\ge 0}^{4}$ 确定性地构建三个观测图谱 $c^{(t)} \\in \\mathbb{R}_{\\ge 0}^{96}$（$t \\in \\{1,2,3\\}$）：\n   - 对于每个 $t$，定义\n   $$\n   e^{(1)} = (200, 400, 0, 100), \\quad e^{(2)} = (0, 0, 0, 0), \\quad e^{(3)} = (0, 0, 150, 0).\n   $$\n   - 令实值期望图谱为 $u^{(t)} = S e^{(t)} \\in \\mathbb{R}_{\\ge 0}^{96}$，由于 $S$ 的每一列的 $\\ell_1$ 和为单位 $1$，该图谱满足 $\\sum_{i=0}^{95} u^{(t)}_i = \\sum_{j=0}^{3} e^{(t)}_j$。\n   - 为所有 $i$ 定义初步整数 $f_i^{(t)} = \\lfloor u^{(t)}_i \\rfloor$，并计算差额\n   $$\n   D^{(t)} = \\left(\\sum_{j=0}^{3} e^{(t)}_j\\right) - \\sum_{i=0}^{95} f_i^{(t)}.\n   $$\n   注意 $D^{(t)} \\in \\{0,1,\\dots,95\\}$。\n   - 令 $\\rho_i^{(t)} = u^{(t)}_i - f_i^{(t)}$ 为小数部分。选择具有最大 $\\rho_i^{(t)}$ 的 $D^{(t)}$ 个索引（通过较小的索引 $i$ 来打破平局）。对于这些索引，设置 $c^{(t)}_i = f_i^{(t)} + 1$，对于所有其他索引，设置 $c^{(t)}_i = f_i^{(t)}$。这将产生整数计数，且满足 $\\sum_{i=0}^{95} c^{(t)}_i = \\sum_{j=0}^{3} e^{(t)}_j$。\n\n5. 要求输出。对于每个测试用例 $t \\in \\{1,2,3\\}$，计算 $c^{(t)}$ 与其通过上述过程获得的重建 $r^{(t)} = S \\tilde e^{(t)}$ 之间的余弦相似度。您的程序应生成单行输出，其中包含按 $t=1,2,3$ 顺序排列的三个余弦相似度值，每个值四舍五入到 $6$ 位小数，格式为逗号分隔的列表并用方括号括起来，例如 $[x_1,x_2,x_3]$。\n\n约束和说明：\n\n- 所有向量和矩阵均使用实数；计数在舍入后为非负整数。\n- 仅在与角度相关时使用弧度或度；此处除了作为向量空间度量的余弦相似度（无量纲）外，没有明确使用角度。\n- 在评估余弦相似度时，如果任一向量恒为零，则应用上述明确规则：若两者均为零，则返回 $1.0$，否则返回 $0.0$。\n- 在拟合暴露度之前，通过将 $S$ 的列显式归一化至单位 $\\ell_1$ 和来确保数值稳定性。\n- 该问题具有普遍适用性：它可归结为在 $\\mathbb{R}^{96}$ 中求解一个非负最小二乘问题以及计算内积和范数。您的程序必须是自包含的，不得读取任何外部输入，并且必须遵循指定的确切输出格式。",
            "solution": "该问题要求实现突变印记分析中的一个标准工作流程。这包括创建一组参考突变印记，生成合成的观测突变计数，估计每个印记对观测计数的贡献（暴露度），最后评估模型的拟合优度。整个过程基于线性代数和数值优化的原理。\n\n解决方案是通过遵循问题陈述中概述的精确步骤来实现的。\n\n**1. 印记矩阵 $S$ 的构建**\n\n模型的基础是印记矩阵 $S \\in \\mathbb{R}_{\\ge 0}^{96 \\times 4}$，其中 $K=4$ 列中的每一列代表一个在 $96$ 个突变通道上的参考突变印记图谱。其构建过程是确定性的。\n\n首先，我们定义一个未归一化的权重矩阵 $W \\in \\mathbb{R}^{96 \\times 4}$。这 $96$ 个通道被划分为四个连续不重叠的组，每组包含 $24$ 个索引：组 $k \\in \\{0,1,2,3\\}$ 对应于从 $24k$ 到 $24k+23$ 的索引 $i$。第 $k$ 个印记中第 $i$ 个通道的权重 $w_{i}^{(k)}$ 定义如下：\n$$\nw_{i}^{(k)} = \\begin{cases}\n4,  \\text{if } \\left\\lfloor \\dfrac{i}{24} \\right\\rfloor = k, \\\\\n1,  \\text{otherwise.}\n\\end{cases}\n$$\n这种结构意味着每个印记 $k$ 的特征在于其对应的 $24$ 个通道组中具有高突变概率，而在所有其他通道中具有较低的、均匀的背景概率。\n\n为确保暴露度可以解释为突变计数，每个印记（列）必须被归一化，使其 $\\ell_1$ 和为 $1$。每列 $k$ 的归一化常数是其权重的总和：\n$$\n\\sum_{r=0}^{95} w_{r}^{(k)} = (24 \\times 4) + ((96-24) \\times 1) = 96 + 72 = 168.\n$$\n对于所有印记 $k \\in \\{0,1,2,3\\}$，这个和是恒定的。因此，归一化后的印记-通道概率 $s_{i}^{(k)}$ 为：\n$$\ns_{i}^{(k)} = \\dfrac{w_{i}^{(k)}}{168}.\n$$\n最终的印记矩阵 $S$ 由这些列构成，即 $S_{ik} = s_{i}^{(k)}$。\n\n**2. 观测计数向量 $c^{(t)}$ 的生成**\n\n根据预定义的真实暴露度向量创建三个测试用例（$t \\in \\{1,2,3\\}$）：$e^{(1)} = (200, 400, 0, 100)$，$e^{(2)} = (0, 0, 0, 0)$ 和 $e^{(3)} = (0, 0, 150, 0)$。\n\n对于每个测试用例 $t$，通过一个保留突变总数的确定性舍入程序，生成一个观测到的整数计数向量 $c^{(t)} \\in \\mathbb{Z}_{\\ge 0}^{96}$。\n首先，将期望的实值图谱 $u^{(t)} \\in \\mathbb{R}_{\\ge 0}^{96}$ 计算为印记的线性组合：\n$$\nu^{(t)} = S e^{(t)}.\n$$\n由于 $S$ 的每一列之和为 $1$，因此 $u^{(t)}$ 中元素的总和等于暴露度的总和：$\\sum_{i=0}^{95} u_i^{(t)} = \\sum_{j=0}^{3} e_j^{(t)}$。设此总数为 $E^{(t)}$。\n\n为了将实值图谱 $u^{(t)}$ 转换为整数值计数向量 $c^{(t)}$，我们使用最大余数舍入法。\n- 取每个通道的整数部分：$f_i^{(t)} = \\lfloor u^{(t)}_i \\rfloor$。\n- 由于向下取整而损失的突变总数是差额，$D^{(t)} = E^{(t)} - \\sum_{i=0}^{95} f_i^{(t)}$。这个差额是一个整数。\n- 计算小数部分 $\\rho_i^{(t)} = u^{(t)}_i - f_i^{(t)}$。\n- 将 $D^{(t)}$ 个突变逐一分配给具有 $D^{(t)}$ 个最大小数部分 $\\rho_i^{(t)}$ 的通道。通过选择较小的通道索引 $i$ 来打破平局。\n- 最终的计数向量 $c^{(t)}$ 由以下方式给出：对于选定的 $D^{(t)}$ 个索引，$c_i^{(t)} = f_i^{(t)} + 1$；对于所有其他索引，$c_i^{(t)} = f_i^{(t)}$。根据构造，$\\sum_{i=0}^{95} c_i^{(t)} = E^{(t)}$。\n\n**3. 暴露度估计与重建**\n\n给定合成的观测计数 $c^{(t)}$，下一步是估计产生它们的暴露度。该模型假设观测图谱 $c$ 可由 $Se$ 近似。暴露度向量 $e$ 的最佳估计是通过求解非负最小二乘（NNLS）问题找到的，该问题在暴露度不能为负的约束下，最小化观测图谱与重建图谱之间的欧几里得距离平方：\n$$\n\\hat e^{(t)} = \\arg\\min_{e \\in \\mathbb{R}_{\\ge 0}^{4}} \\lVert S e - c^{(t)} \\rVert_2^2.\n$$\n这是一个凸优化问题，其解可以使用标准数值算法找到，例如 `scipy.optimize.nnls` 中提供的算法。\n\n然后对得到的暴露度向量 $\\hat e^{(t)}$进行重新缩放，以确保重建中的突变总数与观测总数 $N^{(t)} = \\sum_{i=0}^{95} c_i^{(t)}$ 相匹配。重新缩放后的暴露度向量 $\\tilde e^{(t)}$ 为：\n$$\n\\tilde e^{(t)} = \\hat e^{(t)} \\cdot \\dfrac{N^{(t)}}{\\sum_{j=0}^{3} \\hat e_j^{(t)}},\n$$\n前提是 $N^{(t)} > 0$ 且 $\\sum_{j=0}^{3} \\hat e_j^{(t)} > 0$。如果 $N^{(t)} = 0$，则将 $\\tilde e^{(t)}$ 定义为零向量。\n\n使用这个最终的暴露度向量，重建的图谱 $r^{(t)}$ 计算如下：\n$$\nr^{(t)} = S \\tilde e^{(t)}.\n$$\n\n**4. 使用余弦相似度进行评估**\n\n重建的质量通过观测向量 $c^{(t)}$ 和重建向量 $r^{(t)}$ 之间的余弦相似度来衡量。余弦相似度的定义如下：\n$$\n\\mathrm{cos}(c^{(t)}, r^{(t)}) = \\begin{cases}\n\\dfrac{(c^{(t)})^\\top r^{(t)}}{\\lVert c^{(t)} \\rVert_2 \\lVert r^{(t)} \\rVert_2},  \\text{if } \\lVert c^{(t)} \\rVert_2 > 0 \\text{ and } \\lVert r^{(t)} \\rVert_2 > 0, \\\\\n1.0,  \\text{if } \\lVert c^{(t)} \\rVert_2 = 0 \\text{ and } \\lVert r^{(t)} \\rVert_2 = 0, \\\\\n0.0,  \\text{otherwise.}\n\\end{cases}\n$$\n接近 $1.0$ 的值表示在图谱形状方面拟合得非常好。对于 $c^{(t)}$ 是零向量的测试用例，该过程同样会产生零向量 $r^{(t)}$，从而得到 $1.0$ 的余弦相似度。\n\n将这整个过程应用于三个测试用例中的每一个，收集并格式化所得的余弦相似度作为最终输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import nnls\n\ndef solve():\n    \"\"\"\n    Implements the full mutational signature analysis pipeline as specified.\n    1. Constructs the signature matrix S.\n    2. Generates three observed count vectors c^{(t)} from true exposures e^{(t)}.\n    3. For each c^{(t)}, estimates exposures, reconstructs the profile r^{(t)},\n       and computes the cosine similarity between c^{(t)} and r^{(t)}.\n    4. Prints the results in the specified format.\n    \"\"\"\n\n    # --- 1. Signature construction ---\n    K = 4\n    N_CHANNELS = 96\n    \n    # Construct the unnormalized weight matrix W\n    W = np.ones((N_CHANNELS, K), dtype=np.float64)\n    for k in range(K):\n        start_idx = k * 24\n        end_idx = (k + 1) * 24\n        W[start_idx:end_idx, k] = 4.0\n    \n    # Normalize columns to unit l1 sum to get S\n    col_sums = W.sum(axis=0)\n    S = W / col_sums\n\n    # --- 2. Test suite generation and analysis ---\n    test_exposures = [\n        np.array([200.0, 400.0, 0.0, 100.0]),\n        np.array([0.0, 0.0, 0.0, 0.0]),\n        np.array([0.0, 0.0, 150.0, 0.0])\n    ]\n\n    results = []\n    for e_true in test_exposures:\n        # --- Generate observed profile c^{(t)} from e^{(t)} ---\n        total_exposure = e_true.sum()\n\n        if total_exposure == 0:\n            c = np.zeros(N_CHANNELS, dtype=np.float64)\n        else:\n            # Calculate real-valued expected profile u\n            u = S @ e_true\n            \n            # Get integer and fractional parts\n            f = np.floor(u)\n            rho = u - f\n            \n            # Calculate deficit using integer arithmetic on total exposure\n            # Use rounding to be robust against floating point inaccuracies\n            deficit = int(round(total_exposure - f.sum()))\n            \n            # Find indices of largest fractional parts to increment\n            # Use a stable sort to break ties by smaller index\n            indices_to_increment = np.argsort(rho, kind='stable')[::-1][:deficit]\n            \n            c = f.copy()\n            c[indices_to_increment] += 1.0\n\n        # At this point, c is the observed count vector (as floats, but representing ints)\n\n        # --- 3. Exposure estimation and reconstruction ---\n        \n        # Estimate exposures using Non-Negative Least Squares (NNLS)\n        e_hat, _ = nnls(S, c)\n        \n        # Rescale exposures\n        N_counts = c.sum()\n        e_hat_sum = e_hat.sum()\n        \n        e_tilde = np.zeros_like(e_hat)\n        if N_counts > 0:\n            if e_hat_sum > 0:\n                e_tilde = e_hat * (N_counts / e_hat_sum)\n        # If N_counts is 0, e_tilde remains the zero vector, as per problem spec.\n\n        # Reconstruct the profile\n        r = S @ e_tilde\n\n        # --- 4. Cosine similarity calculation ---\n        norm_c = np.linalg.norm(c)\n        norm_r = np.linalg.norm(r)\n        \n        similarity = 0.0\n        if norm_c > 1e-9 and norm_r > 1e-9:\n            similarity = np.dot(c, r) / (norm_c * norm_r)\n        elif norm_c  1e-9 and norm_r  1e-9:\n            similarity = 1.0\n        # Otherwise, similarity remains 0.0 as initialized\n        \n        results.append(similarity)\n\n    # --- 5. Final output formatting ---\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个成功的分析不仅在于得出结果，更在于理解结果的可靠性。这项练习 () 将引导您深入探索突变特征分析背后的统计学原理，解决一个在实验设计中至关重要的问题：需要多少突变数据，才能确保我们对特征暴露度的估计达到预期的置信水平？通过推导和应用费雪信息 (Fisher Information)，您将学会如何从理论上评估和保证分析结果的统计功效。",
            "id": "4587872",
            "problem": "考虑一个突变印记重配场景，其中每个肿瘤样本在 $M$ 个类别上观测到的突变目录被建模为一个多项式随机向量，其总计数为 $n$，类别概率为 $\\mathbf{p}(\\mathbf{w})$，其中 $\\mathbf{p}(\\mathbf{w})$ 是一个固定印记目录的凸混合。具体来说，假设有 $K=2$ 个固定印记，其在 $M=4$ 个类别上的归一化图谱为 $\\mathbf{s}^{(1)}$ 和 $\\mathbf{s}^{(2)}$，并且设印记1的暴露度为 $w \\in (0,1)$，印记2的暴露度为 $1-w$。混合模型为\n$$\n\\mathbf{p}(w) \\;=\\; w\\,\\mathbf{s}^{(1)} \\;+\\; (1-w)\\,\\mathbf{s}^{(2)} \\;=\\; \\mathbf{s}^{(2)} + w\\big(\\mathbf{s}^{(1)} - \\mathbf{s}^{(2)}\\big).\n$$\n假设在多项式模型下推导出的印记1暴露度估计量 $\\hat{w}$ 具有大样本最大似然估计和渐近正态性。可靠性定义为 $w$ 的置信度为 $95\\%$ 的双侧 Wald 置信区间的半宽度最多为 $\\delta$。在多项式方差模型和可微参数化下，最大似然估计量 (MLE) $\\hat{w}$ 的渐近方差由 $w$ 的费雪信息决定。\n\n给定固定的印记和真实的暴露度：\n- $\\mathbf{s}^{(1)} = \\big(0.4,\\,0.3,\\,0.2,\\,0.1\\big)$,\n- $\\mathbf{s}^{(2)} = \\big(0.1,\\,0.2,\\,0.3,\\,0.4\\big)$,\n- $w = 0.6$。\n\n设可靠性阈值为 $\\delta = 0.05$，并使用标准正态分位数 $z_{0.975}$ 对应 $95\\%$ 的置信水平。使用基于似然的多项式模型推断的基本原理（从多项式对数似然和 $\\mathbf{p}(w)$ 关于 $w$ 的雅可比矩阵推导 $w$ 的费雪信息），确定每个样本的最小突变数 $n_{\\min}$，使得 $w$ 的 Wald 区间的半宽度最多为 $\\delta$。\n\n您的最终答案必须是满足此可靠性标准的单个最小整数 $n_{\\min}$。将结果表示为每个样本的突变总数。请勿在最终答案框内包含单位。",
            "solution": "用户希望确定所需的最少突变数 $n_{\\min}$，以达到对突变印记暴露度 $w$ 估计的指定精度。该精度由 $w$ 的 $95\\%$ Wald 置信区间的半宽度定义，该半宽度不得大于阈值 $\\delta$。\n\n首先，我将执行问题验证。\n\n### 步骤1：提取给定信息\n- **模型**：观测到的突变目录是一个多项式随机向量。\n- **类别数**：$M=4$。\n- **印记数**：$K=2$。\n- **总突变计数**：$n$。\n- **类别概率**：$\\mathbf{p}(w) = w\\,\\mathbf{s}^{(1)} + (1-w)\\,\\mathbf{s}^{(2)}$。\n- **印记1图谱**：$\\mathbf{s}^{(1)} = (0.4,\\,0.3,\\,0.2,\\,0.1)$。\n- **印记2图谱**：$\\mathbf{s}^{(2)} = (0.1,\\,0.2,\\,0.3,\\,0.4)$。\n- **对印记1的真实暴露度**：$w = 0.6$。\n- **可靠性阈值（最大半宽度）**：$\\delta = 0.05$。\n- **置信水平**：$95\\%$。\n- **标准正态分位数**：$z_{0.975}$。\n- **假设**：估计量 $\\hat{w}$ 的大样本最大似然估计(MLE)和渐近正态性。\n\n### 步骤2：使用提取的给定信息进行验证\n- **科学依据**：该问题基于一个标准的统计模型（多项式混合模型），该模型在生物信息学中广泛用于突变印记分析。所采用的方法，即最大似然估计、费雪信息和Wald置信区间，是统计推断的基本原理。该问题在科学上是合理的。\n- **定义明确**：该问题陈述清晰，并提供了计算唯一整数值 $n_{\\min}$ 所需的所有信息。问题在数学和统计上是明确定义的。\n- **客观性**：该问题使用精确、量化和无偏的语言进行表述。\n\n### 步骤3：结论和行动\n该问题有效。我现在将继续进行解答。\n\n解答源于基于似然的多项式模型推断原理。目标是找到最小样本量 $n$，使得暴露度参数 $w$ 的 $95\\%$ Wald 置信区间的半宽度最多为 $\\delta$。\n\n$w$ 的 $95\\%$ Wald 置信区间由下式给出：\n$$ \\hat{w} \\pm z_{0.975} \\sqrt{\\text{Var}(\\hat{w})} $$\n其中 $\\hat{w}$ 是 $w$ 的最大似然估计量，而 $z_{0.975}$ 是对应于累积概率为 $0.975$ 的标准正态分布的分位数。标准值为 $z_{0.975} \\approx 1.96$。\n\n该区间的半宽度为 $h = z_{0.975} \\sqrt{\\text{Var}(\\hat{w})}$。可靠性标准为 $h \\le \\delta$。\n$$ z_{0.975} \\sqrt{\\text{Var}(\\hat{w})} \\le \\delta $$\n在大样本最大似然估计的假设下，$\\hat{w}$ 的方差近似为费雪信息 $I_n(w)$ 的倒数：\n$$ \\text{Var}(\\hat{w}) \\approx [I_n(w)]^{-1} $$\n对于 $n$ 个独立观测（突变）的样本，总费雪信息为 $I_n(w) = n I_1(w)$，其中 $I_1(w)$ 是单个观测的费雪信息。不等式变为：\n$$ z_{0.975} \\sqrt{\\frac{1}{n I_1(w)}} \\le \\delta $$\n两边平方并重新整理以求解 $n$，我们得到：\n$$ \\frac{z_{0.975}^2}{n I_1(w)} \\le \\delta^2 \\implies n \\ge \\frac{z_{0.975}^2}{\\delta^2 I_1(w)} $$\n最小整数突变数 $n_{\\min}$ 是满足此条件的最小整数，即右侧表达式的向上取整。\n$$ n_{\\min} = \\left\\lceil \\frac{z_{0.975}^2}{\\delta^2 I_1(w)} \\right\\rceil $$\n现在，我们必须推导费雪信息 $I_1(w)$ 的表达式。对于来自多项式分布的单次试验，其概率 $\\mathbf{p}(w) = (p_1(w), \\dots, p_M(w))$ 依赖于标量参数 $w$，费雪信息由下式给出：\n$$ I_1(w) = \\sum_{j=1}^{M} \\frac{1}{p_j(w)} \\left( \\frac{dp_j(w)}{dw} \\right)^2 $$\n问题将概率混合模型定义为 $\\mathbf{p}(w) = w\\,\\mathbf{s}^{(1)} + (1-w)\\,\\mathbf{s}^{(2)}$。\n概率向量 $\\mathbf{p}(w)$ 关于 $w$ 的导数为：\n$$ \\frac{d\\mathbf{p}(w)}{dw} = \\mathbf{s}^{(1)} - \\mathbf{s}^{(2)} $$\n让我们使用给定的印记图谱计算这个向量差：\n$\\mathbf{s}^{(1)} = (0.4, 0.3, 0.2, 0.1)$\n$\\mathbf{s}^{(2)} = (0.1, 0.2, 0.3, 0.4)$\n$$ \\frac{d\\mathbf{p}(w)}{dw} = (0.4-0.1, 0.3-0.2, 0.2-0.3, 0.1-0.4) = (0.3, 0.1, -0.1, -0.3) $$\n设 $\\mathbf{d} = \\frac{d\\mathbf{p}(w)}{dw}$。其分量为 $d_j = \\frac{dp_j(w)}{dw}$。\n\n接下来，我们计算在真实暴露度值 $w=0.6$ 时的概率向量 $\\mathbf{p}(w)$：\n$$ \\mathbf{p}(0.6) = 0.6\\,\\mathbf{s}^{(1)} + (1-0.6)\\,\\mathbf{s}^{(2)} = 0.6\\,\\mathbf{s}^{(1)} + 0.4\\,\\mathbf{s}^{(2)} $$\n$$ p_1(0.6) = 0.6(0.4) + 0.4(0.1) = 0.24 + 0.04 = 0.28 $$\n$$ p_2(0.6) = 0.6(0.3) + 0.4(0.2) = 0.18 + 0.08 = 0.26 $$\n$$ p_3(0.6) = 0.6(0.2) + 0.4(0.3) = 0.12 + 0.12 = 0.24 $$\n$$ p_4(0.6) = 0.6(0.1) + 0.4(0.4) = 0.06 + 0.16 = 0.22 $$\n所以，$\\mathbf{p}(0.6) = (0.28, 0.26, 0.24, 0.22)$。\n\n现在，我们可以计算在 $w=0.6$ 时单次试验的费雪信息 $I_1(w)$：\n$$ I_1(0.6) = \\sum_{j=1}^{4} \\frac{d_j^2}{p_j(0.6)} = \\frac{(0.3)^2}{0.28} + \\frac{(0.1)^2}{0.26} + \\frac{(-0.1)^2}{0.24} + \\frac{(-0.3)^2}{0.22} $$\n$$ I_1(0.6) = \\frac{0.09}{0.28} + \\frac{0.01}{0.26} + \\frac{0.01}{0.24} + \\frac{0.09}{0.22} $$\n$$ I_1(0.6) = \\frac{9}{28} + \\frac{1}{26} + \\frac{1}{24} + \\frac{9}{22} $$\n数值上，这等于：\n$$ I_1(0.6) \\approx 0.32142857 + 0.03846154 + 0.04166667 + 0.40909091 \\approx 0.81064769 $$\n最后，我们可以使用给定的值 $\\delta=0.05$ 和 $z_{0.975} \\approx 1.96$ 来计算 $n_{\\min}$：\n$$ n_{\\min} = \\left\\lceil \\frac{(1.96)^2}{(0.05)^2 \\times I_1(0.6)} \\right\\rceil $$\n$$ n_{\\min} = \\left\\lceil \\frac{3.8416}{0.0025 \\times 0.81064769} \\right\\rceil $$\n$$ n_{\\min} = \\left\\lceil \\frac{3.8416}{0.0020266192} \\right\\rceil $$\n$$ n_{\\min} = \\lceil 1895.5506 \\dots \\rceil $$\n由于突变数必须是整数，我们对该值向上取整。\n$$ n_{\\min} = 1896 $$\n因此，每个样本至少需要 $1896$ 个突变，以确保印记1暴露度的 $95\\%$ 置信区间的半宽度最多为 $0.05$。",
            "answer": "$$\\boxed{1896}$$"
        }
    ]
}