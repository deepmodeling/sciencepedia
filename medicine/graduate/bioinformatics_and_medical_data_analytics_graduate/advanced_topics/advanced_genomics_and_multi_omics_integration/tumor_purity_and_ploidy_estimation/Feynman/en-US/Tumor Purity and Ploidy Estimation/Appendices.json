{
    "hands_on_practices": [
        {
            "introduction": "This practice grounds our understanding of tumor ploidy, a key summary statistic of a cancer genome. By calculating the weighted-average copy number from a segmented genome, you will directly apply the fundamental definition of ploidy and explore how evolutionary parsimony can be used to infer large-scale events like whole-genome duplication.  This exercise connects abstract copy number states to a concrete, genome-wide feature and introduces the logic used to reconstruct the evolutionary history of a tumor.",
            "id": "4616048",
            "problem": "A cancer genome is segmented into $n$ piecewise-constant copy-number states across the autosomal genome, with each segment $i$ having base length $\\ell_i$ (in megabases) and absolute tumor copy number $C_i$. Assume that absolute tumor copy numbers have been calibrated against a matched normal so that $C_i$ are integer totals for the tumor clone, independent of normal cell contamination. Consider a simplified autosomal genome of total length $L$ partitioned into $n = 6$ segments with lengths $\\ell_1 = 600$, $\\ell_2 = 450$, $\\ell_3 = 550$, $\\ell_4 = 300$, $\\ell_5 = 800$, and $\\ell_6 = 300$, so that $L = \\sum_{i=1}^{6} \\ell_i = 3{,}000$. The corresponding absolute tumor copy numbers are $C_1 = 4$, $C_2 = 5$, $C_3 = 4$, $C_4 = 3$, $C_5 = 4$, and $C_6 = 2$.\n\nStarting from the fundamental definition that tumor ploidy is the genome-wide average absolute copy number per base, and that the segmentation implies a piecewise-constant copy-number function over genomic position, derive an expression for the average ploidy $\\pi$ of this tumor in terms of $\\{\\ell_i\\}$ and $\\{C_i\\}$, and compute its value.\n\nThen, using integer parsimony for copy-number evolution, take the diploid baseline of $2$ copies per autosomal segment as the ancestral state. A segmental gain or loss event changes the copy number of a single segment by $1$ and counts as one event; a Whole-Genome Duplication (WGD) event doubles the copy number of every autosomal segment simultaneously and counts as one event. Compute the minimal total number of events required to produce the observed $\\{C_i\\}$ from the diploid baseline under two scenarios: (i) no WGD allowed, and (ii) one WGD allowed, with segmental events optimally arranged before and after the WGD to minimize the total number of events. Report the smaller of these two minimal totals as $E^{\\star}$.\n\nProvide the final answer as a row matrix containing $\\pi$ and $E^{\\star}$. No rounding is required.",
            "solution": "The user wants me to solve a problem in cancer genomics involving the calculation of tumor ploidy and the minimum number of evolutionary events (copy number changes and whole-genome duplication) to explain an observed copy number profile.\n\nFirst, I will validate the problem statement.\n\n### Step 1: Extract Givens\n- Number of segments: $n = 6$.\n- Segment lengths: $\\{\\ell_i\\} = \\{600, 450, 550, 300, 800, 300\\}$ in megabases.\n- Total autosomal genome length: $L = \\sum_{i=1}^{6} \\ell_i = 3000$ megabases.\n- Absolute tumor copy numbers for each segment: $\\{C_i\\} = \\{4, 5, 4, 3, 4, 2\\}$.\n- Definition of tumor ploidy ($\\pi$): Genome-wide average absolute copy number per base.\n- Ancestral state: Diploid, with copy number $2$ for all segments.\n- Segmental event: Change in copy number of a single segment by $\\pm 1$; costs $1$ event.\n- Whole-Genome Duplication (WGD) event: Doubling of copy number for all segments simultaneously; costs $1$ event.\n- Task 1: Derive an expression for $\\pi$ and compute its value.\n- Task 2: Compute the minimal total number of events, $E^{\\star}$, to produce $\\{C_i\\}$ from the diploid baseline, considering two scenarios: (i) no WGD and (ii) one WGD. $E^{\\star}$ is the minimum of the event counts from these two scenarios.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the field of cancer genomics, using standard concepts like copy number variation, ploidy, and whole-genome duplication. It is well-posed, providing all necessary data and clear definitions. The data provided are self-consistent (e.g., $\\sum \\ell_i = L$). The problem is objective and formalizable. There are no identifiable flaws such as scientific unsoundness, incompleteness, or ambiguity.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed with the solution.\n\n### Part 1: Derivation and Calculation of Tumor Ploidy ($\\pi$)\nThe problem defines tumor ploidy, $\\pi$, as the genome-wide average absolute copy number per base. The genome is partitioned into $n$ segments, where segment $i$ has length $\\ell_i$ and a constant absolute copy number $C_i$.\n\nThe total number of DNA copies within a single segment $i$ is proportional to its length $\\ell_i$ and its copy number $C_i$. To find the average copy number across the entire genome, we must compute the weighted average of the copy numbers $\\{C_i\\}$, where the weights are the fractional lengths of the segments.\n\nThe total \"copy-weighted\" length of the genome is the sum of the products of each segment's copy number and its length:\n$$\n\\text{Total copy-weighted length} = \\sum_{i=1}^{n} C_i \\ell_i\n$$\nThe total length of the genome is $L = \\sum_{i=1}^{n} \\ell_i$.\n\nThe average ploidy $\\pi$ is the ratio of the total copy-weighted length to the total length. Thus, the expression for $\\pi$ is:\n$$\n\\pi = \\frac{\\sum_{i=1}^{n} C_i \\ell_i}{\\sum_{i=1}^{n} \\ell_i} = \\frac{1}{L} \\sum_{i=1}^{n} C_i \\ell_i\n$$\nNow, we substitute the given values:\n$L = 3000$\n$\\{\\ell_i\\} = \\{600, 450, 550, 300, 800, 300\\}$\n$\\{C_i\\} = \\{4, 5, 4, 3, 4, 2\\}$\n\nThe sum in the numerator is:\n$$\n\\sum_{i=1}^{6} C_i \\ell_i = (4)(600) + (5)(450) + (4)(550) + (3)(300) + (4)(800) + (2)(300)\n$$\n$$\n\\sum_{i=1}^{6} C_i \\ell_i = 2400 + 2250 + 2200 + 900 + 3200 + 600 = 11550\n$$\nNow, we can compute $\\pi$:\n$$\n\\pi = \\frac{11550}{3000} = \\frac{11.55}{3} = 3.85\n$$\n\n### Part 2: Calculation of Minimal Evolutionary Events ($E^{\\star}$)\nWe need to find the minimum number of events to transform the ancestral diploid state, $C_{\\text{initial}} = \\{2, 2, 2, 2, 2, 2\\}$, to the observed final state, $C_{\\text{final}} = \\{4, 5, 4, 3, 4, 2\\}$. We consider two scenarios.\n\n#### Scenario (i): No WGD Allowed\nIn this scenario, only segmental gain and loss events are permitted. The number of events required to change the copy number of a single segment $i$ from $2$ to $C_i$ is simply the absolute difference $|C_i - 2|$. The total number of events, $E_{\\text{no-WGD}}$, is the sum of these differences over all segments:\n$$\nE_{\\text{no-WGD}} = \\sum_{i=1}^{n} |C_i - 2|\n$$\nSubstituting the values for $C_{\\text{final}}$:\n$$\nE_{\\text{no-WGD}} = |4 - 2| + |5 - 2| + |4 - 2| + |3 - 2| + |4 - 2| + |2 - 2|\n$$\n$$\nE_{\\text{no-WGD}} = 2 + 3 + 2 + 1 + 2 + 0 = 10\n$$\nThe minimum number of events without WGD is $10$.\n\n#### Scenario (ii): One WGD Allowed\nIn this scenario, the evolutionary path involves an intermediate pre-WGD state, $C_{\\text{pre-WGD}} = \\{c'_1, c'_2, \\ldots, c'_n\\}$, which is reached from the initial diploid state via segmental events. This is followed by a single WGD event, and then further segmental events lead to the final state $C_{\\text{final}}$. The total number of events is the sum of pre-WGD segmental events, the single WGD event, and the post-WGD segmental events.\n\nFor each segment $i$, we want to find an integer pre-WGD copy number $c'_i$ that minimizes the number of segmental events. The total number of events for a given $C_{\\text{pre-WGD}}$ is:\n$$\nE_{\\text{WGD}}(C_{\\text{pre-WGD}}) = \\sum_{i=1}^{n} |c'_i - 2| + 1 + \\sum_{i=1}^{n} |C_i - 2c'_i|\n$$\nTo find the overall minimum, we can minimize the event count for each segment independently. For each segment $i$, we must find the integer $c'_i \\geq 0$ that minimizes the segmental event count $e_i(c'_i) = |c'_i - 2| + |C_i - 2c'_i|$.\nThe total minimal event count for this scenario will be $E_{\\text{WGD}} = 1 + \\sum_{i=1}^{n} \\min_{c'_i} e_i(c'_i)$.\n\nLet's compute this for each segment:\n- **Segment 1 ($C_1 = 4$):** Minimize $e_1(c'_1) = |c'_1 - 2| + |4 - 2c'_1|$.\n  - If $c'_1 = 2$: $e_1(2) = |2-2| + |4 - 2(2)| = 0 + 0 = 0$. This is the minimum possible value.\n- **Segment 2 ($C_2 = 5$):** Minimize $e_2(c'_2) = |c'_2 - 2| + |5 - 2c'_2|$.\n  - If $c'_2 = 2$: $e_2(2) = |2-2| + |5 - 2(2)| = 0 + 1 = 1$.\n  - If $c'_2 = 3$: $e_2(3) = |3-2| + |5 - 2(3)| = 1 + 1 = 2$.\n  - The minimum is $1$, for $c'_2 = 2$.\n- **Segment 3 ($C_3 = 4$):** Same as segment 1. Minimum is $0$, for $c'_3 = 2$.\n- **Segment 4 ($C_4 = 3$):** Minimize $e_4(c'_4) = |c'_4 - 2| + |3 - 2c'_4|$.\n  - If $c'_4 = 1$: $e_4(1) = |1-2| + |3 - 2(1)| = 1 + 1 = 2$.\n  - If $c'_4 = 2$: $e_4(2) = |2-2| + |3 - 2(2)| = 0 + 1 = 1$.\n  - The minimum is $1$, for $c'_4 = 2$.\n- **Segment 5 ($C_5 = 4$):** Same as segment 1. Minimum is $0$, for $c'_5 = 2$.\n- **Segment 6 ($C_6 = 2$):** Minimize $e_6(c'_6) = |c'_6 - 2| + |2 - 2c'_6|$.\n  - If $c'_6 = 1$: $e_6(1) = |1-2| + |2 - 2(1)| = 1 + 0 = 1$.\n  - If $c'_6 = 2$: $e_6(2) = |2-2| + |2 - 2(2)| = 0 + 2 = 2$.\n  - The minimum is $1$, for $c'_6 = 1$.\n\nThe optimal pre-WGD state is $C_{\\text{pre-WGD}} = \\{2, 2, 2, 2, 2, 1\\}$.\nThe total number of segmental events is the sum of the minimums for each segment:\n$$\n\\sum_{i=1}^{6} \\min_{c'_i} e_i(c'_i) = 0 + 1 + 0 + 1 + 0 + 1 = 3\n$$\nThe total event count for the WGD scenario is the cost of the WGD event ($1$) plus the total segmental events ($3$):\n$$\nE_{\\text{WGD}} = 1 + 3 = 4\n$$\n\n#### Comparison and Final Minimal Event Count ($E^{\\star}$)\nWe compare the minimal event counts from the two scenarios:\n- Scenario (i) without WGD: $E_{\\text{no-WGD}} = 10$.\n- Scenario (ii) with one WGD: $E_{\\text{WGD}} = 4$.\n\nThe minimal total number of events, $E^{\\star}$, is the smaller of these two values:\n$$\nE^{\\star} = \\min(E_{\\text{no-WGD}}, E_{\\text{WGD}}) = \\min(10, 4) = 4\n$$\n\n### Final Answer\nThe calculated average ploidy is $\\pi = 3.85$.\nThe minimal total number of events is $E^{\\star} = 4$.\nThe problem requests the final answer as a row matrix containing $\\pi$ and $E^{\\star}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 3.85 & 4 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The variant allele fraction (VAF) of a somatic mutation is a powerful signal that encodes information about tumor purity, the fraction of tumor cells carrying the mutation, and the local copy number state. This exercise challenges you to derive the mathematical model connecting these parameters to the expected VAF.  You will then use a likelihood-based approach to quantitatively compare competing hypotheses for an observed data point, a core skill in interpreting genomic data.",
            "id": "4616113",
            "problem": "A tumor sample is a mixture of cancer cells and normal cells. The tumor cell fraction (purity) is denoted by $p$. At a given locus, the tumor cells have total copy number $C$ and the somatic mutation affects $m$ of those copies within the fraction $f$ of tumor cells that carry the mutation. Normal cells have total copy number $2$ at the locus and do not carry the mutation. Variant Allele Fraction (VAF) is defined as the fraction of sequencing reads supporting the mutated (alternate) allele. Under unbiased sampling of alleles, the read-level alternate allele probability equals the fraction of alternate allele copies among all allele copies in the bulk mixture. Sequencing sampling noise can be modeled by a Binomial distribution for the number of alternate reads $k$ out of total depth $n$ with success probability equal to the expected alternate allele probability.\n\nAn exome experiment shows a prominent peak near $0.66$ in the VAF distribution. To assess whether this peak is better explained by Model $A$ with parameters $(p,f,m,C)=(0.7,1,2,3)$ or Model $B$ with parameters $(p,f,m,C)=(0.5,1,2,2)$, consider a representative locus from the peak with total read depth $n=200$ and observed alternate reads $k=132$. Using only the fundamental definitions above and the Binomial sampling model:\n\n1. Derive the expected alternate allele probability $q$ as a function of $(p,f,m,C)$ by counting alternate allele copies and total allele copies in the mixture of tumor and normal cells.\n2. Compute the expected VAF under Model $A$ and Model $B$.\n3. Using the Binomial model with parameter $q$, compute the natural log-likelihood $\\ln \\mathcal{L}$ of observing $k=132$ alternate reads out of $n=200$ total reads for each model, and then compute the natural log-likelihood ratio $\\mathrm{LLR}=\\ln \\mathcal{L}(\\text{Model }A)-\\ln \\mathcal{L}(\\text{Model }B)$.\n\nRound your final numerical answer for the log-likelihood ratio to four significant figures. Express the final answer as a pure number without any units.",
            "solution": "The problem is evaluated as scientifically grounded, well-posed, objective, and self-contained. The provided parameters and models are standard in the field of cancer genomics, and the requested calculations are directly derivable from the problem statement. The problem is therefore deemed valid, and a solution is provided below.\n\nThe solution is presented in three parts as requested by the problem statement.\n\n**Part 1: Derivation of the expected alternate allele probability $q$**\n\nThe expected alternate allele probability, denoted as $q$, is the ratio of the total number of alternate (mutated) allele copies to the total number of all allele copies across the entire cell population in the sample. The sample is a mixture of normal cells and tumor cells.\n\nLet $p$ be the fraction of tumor cells (purity) and $1-p$ be the fraction of normal cells.\nLet's account for the number of alleles contributed by each cell type in a representative portion of the tissue.\n\n- **Normal Cells:**\n  - Constitute a fraction $1-p$ of the cells.\n  - Each normal cell has a copy number of $2$ at the locus.\n  - Normal cells do not carry the somatic mutation, so they have $0$ alternate allele copies.\n  - The number of total alleles contributed by the normal cell fraction is proportional to $(1-p) \\times 2$.\n\n- **Tumor Cells:**\n  - Constitute a fraction $p$ of the cells.\n  - A sub-fraction $f$ of these tumor cells carries the mutation, while a fraction $1-f$ does not.\n  - All tumor cells, regardless of mutation status, have a total copy number of $C$ at the locus.\n  - For the sub-fraction $p \\times f$ of mutation-carrying tumor cells, each cell has $m$ alternate allele copies.\n  - For the sub-fraction $p \\times (1-f)$ of non-mutation-carrying tumor cells, each cell has $0$ alternate allele copies.\n\nNow, we calculate the total number of alternate allele copies and the total number of all allele copies by summing the contributions from each subpopulation, weighted by their respective fractions.\n\nThe total number of alternate allele copies, $N_{\\text{alt}}$, is proportional to:\n$$N_{\\text{alt}} = \\underbrace{(1-p) \\times 0}_{\\text{Normal}} + \\underbrace{(p \\times f) \\times m}_{\\text{Mutated Tumor}} + \\underbrace{p \\times (1-f) \\times 0}_{\\text{Non-mutated Tumor}} = pfm$$\n\nThe total number of all allele copies, $N_{\\text{total}}$, is proportional to:\n$$N_{\\text{total}} = \\underbrace{(1-p) \\times 2}_{\\text{Normal}} + \\underbrace{p \\times C}_{\\text{All Tumor}} = 2(1-p) + pC$$\n\nThe expected alternate allele probability $q$ is the ratio of these two quantities:\n$$q(p, f, m, C) = \\frac{N_{\\text{alt}}}{N_{\\text{total}}} = \\frac{pfm}{2(1-p) + pC}$$\n\nThis is the derived general formula for the expected VAF.\n\n**Part 2: Computation of expected VAF for Model A and Model B**\n\nWe are given the parameters for two models.\n\n- **Model A:** $(p_A, f_A, m_A, C_A) = (0.7, 1, 2, 3)$.\n  The expected VAF, $q_A$, is:\n  $$q_A = \\frac{0.7 \\times 1 \\times 2}{2(1 - 0.7) + 0.7 \\times 3} = \\frac{1.4}{2(0.3) + 2.1} = \\frac{1.4}{0.6 + 2.1} = \\frac{1.4}{2.7} = \\frac{14}{27}$$\n  As a decimal, $q_A \\approx 0.5185$.\n\n- **Model B:** $(p_B, f_B, m_B, C_B) = (0.5, 1, 2, 2)$.\n  The expected VAF, $q_B$, is:\n  $$q_B = \\frac{0.5 \\times 1 \\times 2}{2(1 - 0.5) + 0.5 \\times 2} = \\frac{1}{2(0.5) + 1} = \\frac{1}{1 + 1} = \\frac{1}{2}$$\n  As a decimal, $q_B = 0.5$.\n\n**Part 3: Calculation of the log-likelihood ratio (LLR)**\n\nThe number of alternate reads $k$ out of a total read depth $n$ is modeled by a Binomial distribution with success probability $q$: $k \\sim \\text{Binomial}(n, q)$. The probability mass function is $P(k|n,q) = \\binom{n}{k} q^k (1-q)^{n-k}$.\n\nThe likelihood function $\\mathcal{L}$ is equal to this probability. The natural log-likelihood $\\ln \\mathcal{L}$ is:\n$$\\ln \\mathcal{L}(q | k, n) = \\ln \\left( \\binom{n}{k} q^k (1-q)^{n-k} \\right) = \\ln\\binom{n}{k} + k\\ln(q) + (n-k)\\ln(1-q)$$\n\nWe are given the observed data: $n=200$ and $k=132$. Therefore, $n-k = 200 - 132 = 68$.\n\nFor Model A, with $q_A = 14/27$:\n$$\\ln \\mathcal{L}_A = \\ln\\binom{200}{132} + 132\\ln\\left(\\frac{14}{27}\\right) + 68\\ln\\left(1-\\frac{14}{27}\\right)$$\n$$\\ln \\mathcal{L}_A = \\ln\\binom{200}{132} + 132\\ln\\left(\\frac{14}{27}\\right) + 68\\ln\\left(\\frac{13}{27}\\right)$$\n\nFor Model B, with $q_B = 1/2$:\n$$\\ln \\mathcal{L}_B = \\ln\\binom{200}{132} + 132\\ln\\left(\\frac{1}{2}\\right) + 68\\ln\\left(\\frac{1}{2}\\right)$$\n$$\\ln \\mathcal{L}_B = \\ln\\binom{200}{132} + (132+68)\\ln\\left(\\frac{1}{2}\\right) = \\ln\\binom{200}{132} + 200\\ln\\left(\\frac{1}{2}\\right)$$\n\nThe natural log-likelihood ratio is $\\mathrm{LLR} = \\ln \\mathcal{L}_A - \\ln \\mathcal{L}_B$.\n$$\\mathrm{LLR} = \\left( \\ln\\binom{200}{132} + 132\\ln\\left(\\frac{14}{27}\\right) + 68\\ln\\left(\\frac{13}{27}\\right) \\right) - \\left( \\ln\\binom{200}{132} + 200\\ln\\left(\\frac{1}{2}\\right) \\right)$$\nThe binomial coefficient term cancels out:\n$$\\mathrm{LLR} = 132\\ln\\left(\\frac{14}{27}\\right) + 68\\ln\\left(\\frac{13}{27}\\right) - 200\\ln\\left(\\frac{1}{2}\\right)$$\n$$\\mathrm{LLR} = 132\\ln\\left(\\frac{14}{27}\\right) + 68\\ln\\left(\\frac{13}{27}\\right) + 200\\ln(2)$$\nWe can regroup the terms for a simpler calculation:\n$$\\mathrm{LLR} = 132\\left(\\ln\\left(\\frac{14}{27}\\right) + \\ln(2)\\right) + 68\\left(\\ln\\left(\\frac{13}{27}\\right) + \\ln(2)\\right)$$\n$$\\mathrm{LLR} = 132\\ln\\left(\\frac{14 \\times 2}{27}\\right) + 68\\ln\\left(\\frac{13 \\times 2}{27}\\right)$$\n$$\\mathrm{LLR} = 132\\ln\\left(\\frac{28}{27}\\right) + 68\\ln\\left(\\frac{26}{27}\\right)$$\nNow, we compute the numerical value:\n$$\\ln\\left(\\frac{28}{27}\\right) \\approx \\ln(1.037037) \\approx 0.0363678$$\n$$\\ln\\left(\\frac{26}{27}\\right) \\approx \\ln(0.962963) \\approx -0.0377396$$\n$$\\mathrm{LLR} \\approx 132 \\times (0.0363678) + 68 \\times (-0.0377396)$$\n$$\\mathrm{LLR} \\approx 4.80055 - 2.56629 \\approx 2.23426$$\nRounding to four significant figures, the log-likelihood ratio is $2.234$.\nThe positive value indicates that the observed data are more likely under Model A than Model B.",
            "answer": "$$\\boxed{2.234}$$"
        },
        {
            "introduction": "Real-world algorithms must estimate tumor purity and copy number simultaneously by integrating signals across the entire genome. This advanced practice provides a look under the hood of such methods by framing the problem within a Hidden Markov Model (HMM).  You will derive a key optimization step of the Expectation-Maximization (EM) algorithm, revealing how a global parameter like purity can be systematically inferred from local observations of sequencing depth and allele frequencies.",
            "id": "4616142",
            "problem": "Consider a Hidden Markov Model (HMM) for allele-specific copy number segmentation along a chromosome with genomic bins indexed by $i \\in \\{1,\\dots,n\\}$. The latent state at bin $i$ is the ordered pair $(a,b)$ of nonnegative integers representing the allele-specific copy numbers of the major allele $A$ and the minor allele $B$ in the tumor at that locus. The state space is finite, for example $S=\\{(a,b) \\in \\mathbb{Z}_{\\ge 0}^{2} : a+b \\le C_{\\max}\\}$ for a fixed maximum total copy number $C_{\\max}$. Let the transition model favor state persistence and penalize changes in total and allelic configuration by\n$$\n\\Pr\\big((a',b') \\mid (a,b)\\big) \\propto \\exp\\big(-\\lambda_{C} \\, |(a'+b') - (a+b)| - \\lambda_{A} \\, |a'-a| - \\lambda_{B} \\, |b'-b|\\big),\n$$\nwhere $\\lambda_{C} > 0$, $\\lambda_{A} > 0$, and $\\lambda_{B} > 0$ are fixed hyperparameters controlling the transition penalties.\n\nAt each bin $i$, two observations are made: the normalized coverage $L_{i}$ (also known as read-depth ratio) and the B-allele frequency ($\\mathrm{BAF}_{i}$). Assume conditional independence of $L_{i}$ and $\\mathrm{BAF}_{i}$ given the latent state $(a,b)$ and the tumor purity $p \\in [0,1]$, where $p$ is the fraction of tumor cells in the sample. The emission model is specified as follows:\n- For normalized coverage, the observation $L_{i}$ is Gaussian with mean equal to the expected mixture copy number under tumor purity $p$ and variance $\\sigma_{L}^{2}$,\n$$\nL_{i} \\mid (a,b),p \\sim \\mathcal{N}\\big(\\mu_{L}(a,b,p), \\sigma_{L}^{2}\\big), \\quad \\text{with} \\quad \\mu_{L}(a,b,p) = 2 + p\\big((a+b)-2\\big).\n$$\nHere, the constant $2$ represents the diploid normal copy number, and the linear mixing reflects the expected total copy number in the tumor-normal mixture.\n- For the B-allele frequency, assume the locus is germline heterozygous in the normal cell population and let $(a,b)$ denote the allele-specific tumor counts aligned to alleles $(A,B)$, respectively. The observation $\\mathrm{BAF}_{i}$ is Gaussian with mean equal to the expected mixture minor-allele fraction and variance $\\sigma_{B}^{2}$,\n$$\n\\mathrm{BAF}_{i} \\mid (a,b),p \\sim \\mathcal{N}\\big(\\mu_{B}(a,b,p), \\sigma_{B}^{2}\\big), \\quad \\text{with} \\quad \\mu_{B}(a,b,p) = \\frac{p \\, b + (1-p)\\cdot 1}{p \\, (a+b) + (1-p)\\cdot 2}.\n$$\n\nAssume $\\sigma_{L}^{2}$ and $\\sigma_{B}^{2}$ are known constants. Let $\\gamma_{i}(a,b)$ denote the posterior responsibility of latent state $(a,b)$ at bin $i$, obtained from the forward-backward algorithm in the Expectation-Maximization (EM) framework using both emissions $L_{i}$ and $\\mathrm{BAF}_{i}$ along with the transition model given above.\n\nStarting from the complete-data log-likelihood and the independence assumptions stated, derive the closed-form M-step update for the tumor purity $p$ that maximizes the expected complete-data log-likelihood contribution of the normalized coverage emissions $\\{L_{i}\\}_{i=1}^{n}$, treating the responsibilities $\\{\\gamma_{i}(a,b)\\}$ as fixed weights. Your final expression must be in closed form, written in terms of $\\{L_{i}\\}$, $\\{\\gamma_{i}(a,b)\\}$, and the allele-specific copy numbers $\\{(a,b)\\}$, and should not depend on any unknown quantities other than $p$ itself. Express the final answer as a single analytical expression. No rounding is required and no units are to be included in the final expression.",
            "solution": "This problem requires the derivation of the M-step update for the tumor purity parameter, $p$, within an Expectation-Maximization (EM) framework for a Hidden Markov Model (HMM).\n\n### Problem Validation\nThe problem is scientifically sound, describing a standard HMM setup for allele-specific copy number analysis in cancer genomics. The mixture models for the observables (coverage and B-allele frequency) are correctly formulated based on established principles. The task is to derive a specific update step in the EM algorithm, a well-posed mathematical problem. All necessary components and assumptions are clearly stated. The problem is valid and can be solved as posed.\n\n### Derivation of the M-step Update\nThe M-step of the EM algorithm maximizes the expected complete-data log-likelihood ($Q$-function) with respect to the model parameters. We are asked to find the update for the tumor purity $p$ by maximizing the contribution from the normalized coverage emissions $\\{L_i\\}$.\n\nThe relevant part of the $Q$-function is the expected log-likelihood of the coverage data, where the expectation is over the posterior distribution of the latent states given the data and current parameters. This is calculated using the responsibilities $\\gamma_i(a,b)$ from the E-step:\n$$ Q_L(p) = \\mathbb{E}\\left[ \\sum_{i=1}^{n} \\ln \\Pr(L_i \\mid s_i, p) \\right] = \\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_i(a,b) \\ln \\Pr(L_i \\mid s_i=(a,b), p) $$\nThe emission probability for $L_i$ is given by the Gaussian probability density function:\n$$ \\Pr(L_i \\mid s_i=(a,b), p) = \\frac{1}{\\sqrt{2\\pi\\sigma_L^2}} \\exp\\left( -\\frac{(L_i - \\mu_L(a,b,p))^2}{2\\sigma_L^2} \\right) $$\nThe natural logarithm of this probability is:\n$$ \\ln \\Pr(L_i \\mid s_i=(a,b), p) = -\\frac{1}{2} \\ln(2\\pi\\sigma_L^2) - \\frac{(L_i - \\mu_L(a,b,p))^2}{2\\sigma_L^2} $$\nTo maximize $Q_L(p)$ with respect to $p$, we only need to consider the terms that depend on $p$. Maximizing $Q_L(p)$ is equivalent to minimizing the weighted sum of squared errors:\n$$ J(p) = \\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_i(a,b) (L_i - \\mu_L(a,b,p))^2 $$\nWe substitute the given model for the mean coverage, $\\mu_L(a,b,p) = 2 + p((a+b)-2)$:\n$$ J(p) = \\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_i(a,b) \\left( L_i - \\left(2 + p((a+b)-2)\\right) \\right)^2 $$\nThis is a quadratic function of $p$. To find the minimum, we take the derivative with respect to $p$ and set it to zero:\n$$ \\frac{dJ}{dp} = \\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_i(a,b) \\cdot 2 \\left( L_i - 2 - p((a+b)-2) \\right) \\cdot (-(a+b-2)) = 0 $$\nWe can divide by the constant $-2$ and rearrange the terms:\n$$ \\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_i(a,b) \\left( L_i - 2 - p((a+b)-2) \\right) ((a+b)-2) = 0 $$\n$$ \\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_i(a,b) (L_i - 2)(a+b-2) - p \\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_i(a,b) ((a+b)-2)^2 = 0 $$\nNow, we solve for $p$. Let this unconstrained solution be $p^*$:\n$$ p^* = \\frac{\\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_i(a,b) (L_i - 2)(a+b-2)}{\\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_i(a,b) (a+b-2)^2} $$\nSince tumor purity $p$ must be in the range $[0, 1]$, the final M-step update for $p$ is obtained by clamping $p^*$ to this interval. The objective function $J(p)$ is a convex parabola, so its minimum over the interval $[0, 1]$ is found by this projection.\nThe M-step update, $p_{\\text{new}}$, is:\n$$ p_{\\text{new}} = \\max(0, \\min(1, p^*)) $$\nSubstituting the expression for $p^*$ gives the final closed-form answer.",
            "answer": "$$\n\\boxed{\\max\\left(0, \\min\\left(1, \\frac{\\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_{i}(a,b) (L_{i} - 2) (a+b-2)}{\\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_{i}(a,b) (a+b-2)^2}\\right)\\right)}\n$$"
        }
    ]
}