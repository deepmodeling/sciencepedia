{
    "hands_on_practices": [
        {
            "introduction": "在机器学习项目中，数据泄漏是一个常见但极其严重的错误，它会导致模型性能被严重高估，最终在实际应用中彻底失效。一个成功的生物标志物发现项目，其基石是有效且无偏的训练与验证流程。本练习  将引导您在一个真实的前瞻性建模场景中，识别并预防多种形式的数据泄漏，从而确保模型评估的有效性。",
            "id": "4543002",
            "problem": "您正在使用组学生物标志物开发一个用于癌症进展的预后分类器。对于每位患者 $i \\in \\{1,\\dots,n\\}$，您拥有一个在诊断时的索引（基线）时间 $t_{0,i}$，一个在时间 $t_{0,i}$ 测量的基线组学向量 $X_{0,i} \\in \\mathbb{R}^p$，在 $t_{0,i}$ 之后开始的治疗 $T_i$，一个在 $t_{0,i} + \\Delta$（对于某个固定的 $\\Delta \\approx 3$ 个月）测量的早期治疗反应分数 $R_i$，一个最后联系（随访）时间 $F_i \\ge t_{0,i}$，以及一个二元标签 $Y_i \\in \\{0,1\\}$，该标签指示是否在从 $t_{0,i}$ 开始的 $5$ 年内发生了进展（如果在 $t_{0,i}+5$ 年或之前发生事件，则编码为 $Y_i=1$，否则为 $Y_i=0$）。假设一些患者在 $C_i$ 时被右删失，其中 $C_i \\le t_{0,i}+5$ 年，但标签 $Y_i$ 是使用标准生存时间数据处理方法一致定义的。多批次的检测按日历日进行，产生一个由检测日期决定的批次标识符 $B_i$。您打算学习一个预测器 $f:\\mathbb{R}^p \\to [0,1]$ 来近似在决策时间 $t_0$ 时的条件概率 $P(Y=1 \\mid X_{0})$。\n\n此任务的基础如下：\n- 在监督学习中，目标是仅使用决策时间 $t_0$ 可用的信息来近似贝叶斯决策规则。形式上，令 $\\mathcal{F}_{t}$ 表示由截至时间 $t$（含）可用的所有测量值生成的 sigma 代数，一个在基线时有效的预测器必须是 $\\mathcal{F}_{t_0}$-可测的。在损失函数 $\\ell$ 下的总体风险为 $\\mathcal{R}(f) = \\mathbb{E}[\\ell(Y, f(X_0))]$，其中 $X_0$ 表示基线特征向量。\n- 仅当训练集和验证集在给定数据生成过程的条件下是条件独立的，并且验证流程在训练或预处理期间不使用验证信息时，验证估计量对于部署风险才是无偏的。特别地，数据转换的拟合必须在不接触验证折的情况下进行。\n- 如果一个特征 $X_j$ 是未来信息、结果 $Y$ 或其下游后果的函数，那么在 $t_0$ 时以 $X_j$ 为条件会违反信息约束，并可能在估计的性能中引入乐观偏差。\n\n您的任务是定义标签泄漏的风险，并提供原则以防止在此生物标志物发现设置中，在训练和验证期间使用结果后变量或未来信息作为特征。请考虑以下候选实践。\n\n选择所有正确定义风险并陈述有效原则以防止在训练和验证中发生泄漏的选项。\n\nA. 当特征集包含任何相对于 $\\mathcal{F}_{t_0}$ 不可测的变量时，就会产生标签泄漏的风险，这些变量包括时间戳 $t_j > t_0$ 的变量或作为 $Y$ 的确定性或随机性函数的变量。一个有原则的预防方法是将预测器限制在 $X_0$ 上，并强制执行时间感知划分，使得所有训练患者满足 $t_{0,i} \\le t_{\\mathrm{cut}}$，所有验证患者满足 $t_{0,i} > t_{\\mathrm{cut}}$，以确保在模型拟合或验证中不使用在 $t>t_0$ 时从未来派生的信息。\n\nB. 将 $R_i$（在 $t_{0,i}+\\Delta$ 时的早期反应）和 $T_i$ 作为特征是可以接受的，因为它们具有预测性；为避免泄漏，可以使用带随机打乱的分层K折交叉验证（CV），因为对 $Y$ 进行分层可以控制标签不平衡，因此也能控制泄漏。\n\nC. 在任何训练-验证划分之前，对整个数据集上的每个基因进行 z-score 标准化，并使用关于 $Y$ 的双样本 t 检验对 $X_0$ 进行单变量特征选择，这是可以接受的，因为标准化是无监督的，并且 t 检验特征选择将在交叉验证内部重复；这提高了稳定性并且不会引入泄漏。\n\nD. 在K折交叉验证（CV）中，每个依赖于数据的转换，包括插补、缩放、经验贝叶斯批次校正（如 ComBat）和特征选择，都必须仅使用每折中的训练索引进行拟合，然后应用于留出折；如果批次指示符 $B_i$ 是与 $Y$ 相关的日历时间的函数，则不应将其用作预测特征。这可以防止从验证集到训练集以及从未来信息到特征的直接和间接泄漏。\n\nE. 在存在右删失的情况下，包含派生特征 $F_i - t_{0,i}$（“从基线到最后联系的天数”）有助于解决信息性删失问题，因此是减少泄漏同时提高区分度的一种有原则的方法。\n\nF. 当每个受试者存在多个样本（例如，技术重复或纵向抽样）时，为防止患者级别泄漏，应在受试者级别上划分数据，以使任何受试者的样本都不会同时出现在训练集和验证集中。如果测量是跨时间发生的，则强制执行 $t_{\\max}^{\\text{train}}  t_{\\min}^{\\text{test}}$ 以尊重年代顺序。这可以防止受试者泄漏和无意中使用未来信息。\n\n选择所有适用项。您的答案应为正确选项字母的集合。",
            "solution": "问题陈述描述了使用机器学习进行预后生物标志物发现的一项标准任务。它要求识别正确的原则和实践以防止标签泄漏。问题设置详细、内部一致，并在生物统计学、生物信息学和机器学习领域有科学依据。所提供的基本原则是统计学习理论的正确陈述。因此，该问题是有效的。\n\n在这种情况下，防止标签泄漏的核心原则是确保预测器 $f$ 仅是决策时间 $t_0$ 可用信息的函数。这通过要求预测器是 $\\mathcal{F}_{t_0}$-可测的来正式陈述。此外，任何验证过程都必须对模型在新患者上的性能产生无偏估计，这要求在模型开发的所有阶段（包括预处理）严格分离训练数据和验证数据。\n\n让我们根据这些原则评估每个选项。\n\n**A. 当特征集包含任何相对于 $\\mathcal{F}_{t_0}$ 不可测的变量时，就会产生标签泄漏的风险，这些变量包括时间戳 $t_j  t_0$ 的变量或作为 $Y$ 的确定性或随机性函数的变量。一个有原则的预防方法是将预测器限制在 $X_0$ 上，并强制执行时间感知划分，使得所有训练患者满足 $t_{0,i} \\le t_{\\mathrm{cut}}$，所有验证患者满足 $t_{0,i}  t_{\\mathrm{cut}}$，以确保在模型拟合或验证中不使用在 $tt_0$ 时从未来派生的信息。**\n\n此选项在时间背景下为标签泄漏提供了正确且正式的定义。所有信息必须相对于基线时的 sigma 代数 $\\mathcal{F}_{t_0}$ 可测这一要求，是“无未来信息”规则的精确数学表述。在 $t_0$ 之后测量的变量（例如 $R_i$）或从结果 $Y$（其本身取决于 $t_0$ 之后长达 5 年的事件）构建的变量，都不是 $\\mathcal{F}_{t_0}$-可测的，并构成泄漏。\n\n所提出的预防策略也是合理的。\n1.  将预测器限制在特征 $X_0$ 上是正确的，因为根据定义，$X_0$ 是在 $t_{0,i}$ 时测量的，因此是 $\\mathcal{F}_{t_{0}}$-可测的。\n2.  强制执行按时间顺序或时间感知的划分（例如，在截止日期 $t_{\\mathrm{cut}}$ 之前诊断的患者上进行训练，并在之后诊断的患者上进行验证）是一种稳健的方法，可以防止模型学习到虚假的时间趋势。这种划分结构确保了验证过程模拟了真实世界的部署场景，即在过去数据上训练的模型被应用于未来的患者。\n\n因此，该陈述正确地定义了风险，并提出了有效且有原则的预防方法。\n\n结论：**正确**。\n\n**B. 将 $R_i$（在 $t_{0,i}+\\Delta$ 时的早期反应）和 $T_i$ 作为特征是可以接受的，因为它们具有预测性；为避免泄漏，可以使用带随机打乱的分层K折交叉验证（CV），因为对 $Y$ 进行分层可以控制标签不平衡，因此也能控制泄漏。**\n\n这个陈述是根本错误的。\n1.  特征 $R_i$ 是在时间 $t_{0,i} + \\Delta$ 测量的早期治疗反应，这在决策时间 $t_0$ 之后。它不是 $\\mathcal{F}_{t_0}$-可测的。将其包含在旨在用于基线（$t_0$）预后的模型中，是直接违反信息约束的行为，也是标签泄漏的典型例子。虽然 $R_i$ 可能具有很高的预测性，但其值在预测时是未知的。\n2.  治疗 $T_i$ 也是一个基线后事件。包含它会将正在估计的量从 $P(Y=1 \\mid X_0)$ 改变为 $P(Y=1 \\mid X_0, T_i, \\dots)$。这是一个不同的，且通常更容易的预测任务，它没有回答在基线时提出的预后问题。\n3.  所提出的预防方法是不正确且不合逻辑的。分层K折交叉验证确保了类别比例在各折中保持一致。随机打乱使数据顺序随机化。这两种操作都无法弥补包含无效的基线后特征的问题。实际上，对于具有时间结构的数据，随机打乱是禁忌的，因为它可能允许模型在“未来”数据点上进行训练以预测“过去”的数据点，从而引入泄漏。分层并不能“控制泄漏”。\n\n结论：**不正确**。\n\n**C. 在任何训练-验证划分之前，对整个数据集上的每个基因进行 z-score 标准化，并使用关于 $Y$ 的双样本 t 检验对 $X_0$ 进行单变量特征选择，这是可以接受的，因为标准化是无监督的，并且 t 检验特征选择将在交叉验证内部重复；这提高了稳定性并且不会引入泄漏。**\n\n这个陈述描述了在预处理阶段数据泄漏的两个典型例子。\n1.  **在整个数据集上进行标准化**：Z-score 标准化需要计算每个特征的均值和标准差。如果这些参数是使用*整个*数据集（包括训练折和验证折）计算的，那么训练数据的转换就会受到验证数据的影响。这是一个微妙但明确的违规行为，违反了验证集必须完全被留出的原则。\n2.  **在整个数据集上进行特征选择**：在划分数据集之前，使用结果标签 $Y$（例如，通过 t 检验）在整个数据集上进行特征选择是一种严重的标签泄漏形式。这意味着特征的选择是基于对验证集标签的了解。这会导致信息泄漏，使得所选特征天生就偏向于在验证集上表现良好，从而产生一个具有欺骗性的乐观性能估计。\n\n所提供的理由是似是而非的。标准化是“无监督的”这一事实无关紧要；泄漏来自于使用验证数据来拟合标准化器。声称 t 检验“将在交叉验证内部重复”是没有意义的，如果选择已经在整个数据集上完成，那么损害已经造成。\n\n结论：**不正确**。\n\n**D. 在K折交叉验证（CV）中，每个依赖于数据的转换，包括插补、缩放、经验贝叶斯批次校正（如 ComBat）和特征选择，都必须仅使用每折中的训练索引进行拟合，然后应用于留出折；如果批次指示符 $B_i$ 是与 $Y$ 相关的日历时间的函数，则不应将其用作预测特征。**\n\n此选项正确地描述了在交叉验证框架内实施预处理的黄金标准。\n1.  该陈述的第一部分是获得无偏性能估计的关键原则。任何从数据中“学习”的步骤——无论是计算用于缩放的均值、用于插补的中位数、用于批次校正的参数，还是用于选择的特征排序标准——都必须*仅*在该特定折的训练部分上执行。然后将拟合好的转换应用于训练和验证部分。这种方法被封装在像 `sklearn.pipeline.Pipeline` 这样的工具中，对于防止从验证集到训练过程的泄漏至关重要。\n2.  第二部分解决了一个微妙但重要的问题。批次标识符 $B_i$ 是检测日历日期的函数。如果人群、治疗甚至生存结果随时间存在长期趋势，$B_i$ 可能会与结果 $Y$ 产生虚假相关。包含这样的特征可能导致模型学习到基于时间的伪影而不是潜在的生物信号，从而损害其泛化能力。使用 $B_i$ 来*校正*批次效应是正确的，但将其用作预测特征是有风险的。\n\n结论：**正确**。\n\n**E. 在存在右删失的情况下，包含派生特征 $F_i - t_{0,i}$（“从基线到最后联系的天数”）有助于解决信息性删失问题，因此是减少泄漏同时提高区分度的一种有原则的方法。**\n\n这个陈述是极其错误的。\n特征 $F_i - t_{0,i}$ 代表观察到的随访时间。结果标签 $Y_i$（5年内进展）本身是由事件时间和删失时间决定的。观察到的随访时间是 $F_i - t_{0,i} = \\min(\\text{EventTime}_i, \\text{CensoringTime}_i)$。对于一个发生事件的患者（即 $Y_i=1$），随访时间*就是*事件时间。将此作为特征提供，相当于在训练期间向模型提供了答案的很大一部分。例如，模型会学到一条琐碎且无用的规则：如果 $F_i - t_{0,i}  5$ 年，则患者很可能有 $Y_i=1$。这是循环论证。模型在交叉验证中会表现出惊人的高性能，但在实践中却毫无用处，因为对于一个新患者，随访时间正是我们希望预测的东西。这是一种严重的标签泄漏形式，声称它能“减少泄漏”与事实完全相反。\n\n结论：**不正确**。\n\n**F. 当每个受试者存在多个样本（例如，技术重复或纵向抽样）时，为防止患者级别泄漏，应在受试者级别上划分数据，以使任何受试者的样本都不会同时出现在训练集和验证集中。如果测量是跨时间发生的，则强制执行 $t_{\\max}^{\\text{train}}  t_{\\min}^{\\text{test}}$ 以尊重年代顺序。这可以防止受试者泄漏和无意中使用未来信息。**\n\n此选项描述了稳健验证的两个基本原则，尤其是在生物医学背景下。\n1.  **受试者级别划分**：当数据不是独立同分布（i.i.d.）时，例如当同一患者有多个样本时，简单的随机划分是无效的。来自同一患者的样本高度相关。如果它们同时出现在训练集和验证集中，模型可以“记住”患者特有的特征，导致过于乐观的性能评估。正确的程序是在患者级别上进行划分（例如，使用 `GroupKFold`），确保来自给定患者的所有数据只属于一个折。\n2.  **按时间顺序划分**：如选项 A 中也提到的，当数据具有时间成分时，划分必须尊重时间之箭。条件 $t_{\\max}^{\\text{train}}  t_{\\min}^{\\text{test}}$（其中 $t$ 是相关的时间戳，如诊断或样本日期）确保模型总是用过去的数据来预测未来。这可以防止来自未来数据的泄漏，并提供更现实的部署性能估计。\n\n这两个原则都是正确的，并且对于在复杂数据结构中防止泄漏是至关重要的。\n\n结论：**正确**。\n\n总之，选项 A、D 和 F 正确地陈述了在给定情境下定义和防止数据和标签泄漏的原则。",
            "answer": "$$\\boxed{ADF}$$"
        },
        {
            "introduction": "许多临床问题，例如罕见病筛查或早期预警，其数据都存在严重的类别不平衡问题。更重要的是，不同类型预测错误的代价往往是不对称的——漏诊（假阴性）的后果通常远比误诊（假阳性）严重。本练习  旨在探讨如何在这种情况下正确地构建问题，并运用分层验证和成本敏感学习等策略，来构建真正具有临床相关性的模型。",
            "id": "4542961",
            "problem": "一项临床生物标志物发现研究使用基因表达特征来预测一种二元疾病表型，该表型编码为 $Y \\in \\{0,1\\}$，其中 $Y=1$ 表示存在需要立即干预的状况，$Y=0$ 表示不存在。在目标人群中，该疾病的患病率很低，即 $P(Y=1)\\ll P(Y=0)$。该研究旨在训练一个分类器 $f:\\mathcal{X}\\to\\{0,1\\}$，以在非对称错误成本下最小化临床决策成本：假阴性（当 $Y=1$ 时预测为 $0$）产生成本 $c_{FN}0$，假阳性（当 $Y=0$ 时预测为 $1$）产生成本 $c_{FP}0$。由于错失治疗的风险，$c_{FN}$ 通常大于 $c_{FP}$。该团队将通过 $k$-折交叉验证（CV）来评估泛化性能，并考虑采用分层CV、成本敏感学习和类别重采样。\n\n使用期望损失（风险）的基本定义 $R(f)=\\mathbb{E}[L(Y,f(X))]$，其中损失为根据临床成本加权的、适合任务的 $0\\text{-}1$ 损失，并结合类别先验不平衡下的基本采样考量，选出所有正确的陈述。\n\nA. 在此背景下，类别不平衡意味着 $P(Y=1)\\neq P(Y=0)$，具体来说是 $P(Y=1)\\ll P(Y=0)$。当错误成本非对称时，未加权的准确率与临床效用不符；而分层 $k$-折交叉验证能在每一折中保持经验类别比例，从而在类别先验不相等的情况下降低风险估计的方差。\n\nB. 在 $c_{FN}\\gg c_{FP}$ 的非对称错误成本下，最小化期望临床成本的贝叶斯最优决策规则是在后验优势比 $\\frac{P(Y=1\\mid x)}{P(Y=0\\mid x)}$ 超过比率 $\\frac{c_{FP}}{c_{FN}}$ 时预测 $Y=1$；等价地，成本敏感的经验风险最小化可以通过为正类损失乘以权重 $c_{FN}$、为负类损失乘以权重 $c_{FP}$ 来实现。\n\nC. 对少数类进行随机过采样或对多数类进行欠采样会改变模型学习到的条件似然 $p(x\\mid y)$，从而改变贝叶斯最优分类器；因此，重采样通常是不一致的，绝不应该被用于解决非对称错误成本问题。\n\nD. 在类别不平衡的情况下，为实现对敏感性和特异性的无偏估计，必须使用分层 $k$-折交叉验证，因为非分层划分必然会在某些折中夸大少数类的频率，导致敏感性出现向上偏差和特异性出现向下偏差。\n\nE. 当 $P(Y=1)=0.05$，$c_{FN}=10$ 且 $c_{FP}=1$ 时，一个校准过的概率分类器应将 $P(Y=1\\mid x)$ 的决策阈值固定在 $t^{\\star}=\\frac{c_{FP}}{c_{FN}}=\\frac{1}{10}$；同时，将正类权重设为 10、负类权重设为 1 的成本敏感学习优化的是相同的期望成本目标。",
            "solution": "问题陈述描述了一个在临床背景下的二元分类任务，其特点是类别不平衡和非对称错误成本。目标是评估在此条件下关于分类策略和性能评估的几个陈述。\n\n首先，我们来形式化期望成本（风险）和最优决策规则。问题定义了一个二元表型 $Y \\in \\{0, 1\\}$，其中 $Y=1$ 是正类（疾病），$Y=0$ 是负类（无疾病）。分类器 $f(X)$ 将特征 $X$ 映射到一个预测 $\\hat{Y} \\in \\{0, 1\\}$。\n\n成本加权损失函数 $L(Y, \\hat{Y})$ 定义如下：\n- $L(1, 0) = c_{FN}$ (假阴性成本)\n- $L(0, 1) = c_{FP}$ (假阳性成本)\n- $L(1, 1) = 0$ (真阳性，零成本)\n- $L(0, 0) = 0$ (真阴性，零成本)\n\n分类器 $f$ 的期望风险是 $R(f) = \\mathbb{E}_{X,Y}[L(Y, f(X))]$。贝叶斯最优分类器 $f^*$ 是使该风险最小化的分类器。对于任意给定的输入 $x$，它通过最小化条件期望成本来实现这一点：\n$$\n\\mathbb{E}_{Y|X=x}[L(Y, f(x))]\n$$\n为了对给定的 $x$ 做出决策，我们比较预测 $\\hat{Y}=1$ 与预测 $\\hat{Y}=0$ 的期望成本。设 $p(x) = P(Y=1 \\mid X=x)$ 为正类的真实后验概率。那么 $P(Y=0 \\mid X=x) = 1 - p(x)$。\n\n预测 $\\hat{Y}=1$ 的条件期望成本是：\n$$\nC(\\text{predict } 1 \\mid x) = L(1,1)P(Y=1 \\mid x) + L(0,1)P(Y=0 \\mid x) = 0 \\cdot p(x) + c_{FP} \\cdot (1-p(x)) = c_{FP}(1-p(x))\n$$\n预测 $\\hat{Y}=0$ 的条件期望成本是：\n$$\nC(\\text{predict } 0 \\mid x) = L(1,0)P(Y=1 \\mid x) + L(0,0)P(Y=0 \\mid x) = c_{FN} \\cdot p(x) + 0 \\cdot (1-p(x)) = c_{FN}p(x)\n$$\n贝叶斯最优决策是在预测 $\\hat{Y}=1$ 的成本更低时做出该预测，即 $C(\\text{predict } 1 \\mid x)  C(\\text{predict } 0 \\mid x)$:\n$$\nc_{FP}(1-p(x))  c_{FN}p(x)\n$$\n这个不等式可以以两种有用的方式重新整理：\n1. 用后验优势比表示： $\\frac{p(x)}{1-p(x)} = \\frac{P(Y=1 \\mid x)}{P(Y=0 \\mid x)}  \\frac{c_{FP}}{c_{FN}}$。\n2. 用后验概率表示： $c_{FP}  c_{FP}p(x) + c_{FN}p(x) \\implies c_{FP}  (c_{FP} + c_{FN})p(x) \\implies p(x)  \\frac{c_{FP}}{c_{FP} + c_{FN}}$。\n$\\frac{c_{FP}}{c_{FP} + c_{FN}}$ 这一项是后验概率 $p(x)$ 的最优决策阈值。\n\n在这些原则建立之后，我们评估每个选项。\n\nA. 在此背景下，类别不平衡意味着 $P(Y=1)\\neq P(Y=0)$，具体来说是 $P(Y=1)\\ll P(Y=0)$。当错误成本非对称时，未加权的准确率与临床效用不符；而分层 $k$-折交叉验证能在每一折中保持经验类别比例，从而在类别先验不相等的情况下降低风险估计的方差。\n- 第一个分句正确地定义了问题中所描述的类别不平衡，即疾病患病率低（$P(Y=1)\\ll P(Y=0)$）。\n- 第二个分句也是正确的。未加权的准确率，定义为 $\\frac{TP+TN}{N}$，对所有分类错误赋予相同的权重。在低患病率和 $c_{FN}  c_{FP}$ 的情况下，一个总是预测多数类（$Y=0$）的分类器可以达到非常高的准确率（接近 $P(Y=0)$），但它会因为错过每一个阳性病例而产生巨大的临床成本。因此，在这种情况下，准确率是衡量临床效用的一个糟糕指标。\n- 第三个分句是交叉验证的一个关键原则。在患病率低的常规 $k$-折交叉验证中，将样本随机分配到各折可能导致某些测试折中没有或只有极少数的阳性实例。这使得像敏感性（$TP/(TP+FN)$）或精确率（$TP/(TP+FP)$）这样的指标在各折之间变得高度不稳定（高方差）甚至无法定义。分层 $k$-折交叉验证确保每个折中的类别分布都与整个数据集的分布相匹配，从而得到更稳定、更可靠（方差更低）的性能指标估计。\n这个陈述的三个部分都正确。\n**结论：正确**\n\nB. 在 $c_{FN}\\gg c_{FP}$ 的非对称错误成本下，最小化期望临床成本的贝叶斯最优决策规则是在后验优势比 $\\frac{P(Y=1\\mid x)}{P(Y=0\\mid x)}$ 超过比率 $\\frac{c_{FP}}{c_{FN}}$ 时预测 $Y=1$；等价地，成本敏感的经验风险最小化可以通过为正类损失乘以权重 $c_{FN}$、为负类损失乘以权重 $c_{FP}$ 来实现。\n- 陈述的第一部分用后验优势比描述了最优决策规则。正如上面推导的，预测 $Y=1$ 的规则是 $\\frac{P(Y=1 \\mid x)}{P(Y=0 \\mid x)}  \\frac{c_{FP}}{c_{FN}}$。这是最小化期望成本的直接结果，并且在数学上是正确的。\n- 第二部分讨论了一种实现策略。成本敏感学习旨在训练一个能隐式学习这个最优规则的模型。一种标准方法是修改在训练期间最小化的目标函数（经验风险）。最小化的不是 $\\sum_i L(y_i, f(x_i))$，而是一个加权和：$\\sum_{i: y_i=1} c_{FN} \\cdot \\ell(y_i, f(x_i)) + \\sum_{i: y_i=0} c_{FP} \\cdot \\ell(y_i, f(x_i))$，其中 $\\ell$ 是一个基础损失函数，如对数损失。这迫使学习算法更加关注避免在高成本的正类上出错。这是成本敏感学习的一种标准且正确的表述，等价于最小化目标临床成本。\n陈述的两个部分都正确。\n**结论：正确**\n\nC. 对少数类进行随机过采样或对多数类进行欠采样会改变模型学习到的条件似然 $p(x\\mid y)$，从而改变贝叶斯最优分类器；因此，重采样通常是不一致的，绝不应该被用于解决非对称错误成本问题。\n- 该陈述声称重采样会改变条件似然 $p(x \\mid y)$。这从根本上是错误的。重采样技术（如复制少数类的样本或丢弃多数类的样本）改变了训练集中的类别先验 $P(Y)$。它们不改变给定类别下特征的潜在分布 $p(x \\mid y)$。在重采样数据上训练的生成模型仍然会从可用样本中估计出正确的 $p(x \\mid y)$，但它会从现在平衡的数据集中估计出错误的类别先验 $P'(Y)$。由于先验的改变，判别模型会学到一个有偏的后验 $P'(Y \\mid x)$。\n- “绝不应该使用”重采样的结论是一个过于强烈和错误的泛化。尽管如果不进行校正，重采样可能会给后验概率估计引入偏差，但它是一种广泛使用且通常有效的启发式方法，用于解决严重类别不平衡给许多学习算法带来的实际问题（例如，防止模型简单地忽略少数类）。欠采样可以非常高效，而像 SMOTE 这样的过采样变体是标准实践。这一断言是错误的。\n**结论：错误**\n\nD. 在类别不平衡的情况下，为实现对敏感性和特异性的无偏估计，必须使用分层 $k$-折交叉验证，因为非分层划分必然会在某些折中夸大少数类的频率，导致敏感性出现向上偏差和特异性出现向下偏差。\n- 分层是“实现无偏估计所必需的”这一说法是不正确的。分层的主要目的是降低交叉验证估计量的方差，而不是校正偏差。交叉验证估计量本身通常被认为是近似无偏的，任何偏差通常都很小，并且是一个复杂的争论主题；非分层CV有偏而分层CV无偏并非一个已成定论的问题。\n- 其因果解释也是有缺陷的。首先，非分层划分并非“必然”会夸大少数类的频率；这是一个随机概率问题，并且一些折的频率可能会被缩小。其次，尚不清楚夸大的少数类频率会导致系统性的“敏感性向上偏差”。给定折中估计的敏感性取决于分类器在该折中特定实例上的性能。虽然折的构成会影响估计值，但没有简单、直接的路径能导致这种系统性偏差。主要问题是由于少数类样本过少的折所导致的不稳定性（高方差）。\n**结论：错误**\n\nE. 当 $P(Y=1)=0.05$，$c_{FN}=10$ 且 $c_{FP}=1$ 时，一个校准过的概率分类器应将 $P(Y=1\\mid x)$ 的决策阈值固定在 $t^{\\star}=\\frac{c_{FP}}{c_{FN}}=\\frac{1}{10}$；同时，将正类权重设为 10、负类权重设为 1 的成本敏感学习优化的是相同的期望成本目标。\n- 陈述的第一部分为后验概率 $P(Y=1 \\mid x)$ 提供了一个具体的阈值。根据第一性原理推导，后验概率的最优决策阈值是 $t^{\\star} = \\frac{c_{FP}}{c_{FP} + c_{FN}}$。使用给定值 $c_{FN}=10$ 和 $c_{FP}=1$，正确的阈值是 $t^{\\star} = \\frac{1}{1 + 10} = \\frac{1}{11} \\approx 0.0909$。该陈述错误地声称阈值是 $t^{\\star} = \\frac{c_{FP}}{c_{FN}} = \\frac{1}{10} = 0.1$。比率 $\\frac{c_{FP}}{c_{FN}}$ 是后验优势比的阈值，而不是后验概率的阈值。因此，陈述的这一部分在数学上是不正确的。先验概率 $P(Y=1)=0.05$ 与确定最优决策阈值无关，后者仅取决于成本。\n- 陈述的第二部分，关于通过将正类权重设为 $c_{FN}=10$、负类权重设为 $c_{FP}=1$ 来进行成本敏感学习，是对该方法的正确描述，正如在选项B的分析中所解释的。\n- 然而，由于陈述的第一部分包含一个明显的数学错误，所以整个陈述是不正确的。\n**结论：错误**\n\n结论总结：\nA: 正确\nB: 正确\nC: 错误\nD: 错误\nE: 错误\n\n最终正确的陈述是 A 和 B。",
            "answer": "$$\\boxed{AB}$$"
        },
        {
            "introduction": "准确率或曲线下面积（$AUC$）等标准统计指标，并不总能完全反映一个预测模型在真实临床决策中的实际价值。决策曲线分析（Decision Curve Analysis, DCA）是一个强大的框架，它根据模型在特定决策阈值下的净获益来评估和比较模型。本练习  要求您从基本原理出发推导净获益公式并将其应用于具体案例，从而架起从统计性能到临床实用性之间的桥梁。",
            "id": "4542960",
            "problem": "一个研究团队开发了一个多组学生物标志物组合，并将其整合到一个逻辑回归分类器中，用于预测一个高风险临床队列中的患者在$12$个月内发展为侵袭性疾病的风险。为了评估该模型的概率性预测是否能改善临床决策，该团队应用了决策曲线分析（DCA）。在DCA中，临床决策通过一个阈值风险概率$p_{t}$来操作化，当风险达到该阈值时，临床医生会选择开始治疗。设$B$表示对真正患病的患者进行适当治疗所带来的预期临床获益，设$H$表示对非患病患者进行不必要治疗所带来的预期临床损害。根据预期效用原则，一个理性的治疗决策会在$p B - (1-p) H  0$时对患者进行治疗，并且阈值$p_{t}$在无差异点满足等式。\n\n从基本预期效用以及灵敏度和特异度的定义出发：\n- 灵敏度是指患病患者被分类为阳性的概率。\n- 特异度是指非患病患者被分类为阴性的概率。\n\n请从第一性原理推导一个DCA中使用的净获益指标，该指标用于衡量在阈值$p_{t}$下使用分类器的临床效用，并将其表示为真阳性（$TP$）、假阳性（$FP$）的数量、总队列大小（$N$）和阈值概率（$p_{t}$）的函数。\n\n然后，考虑一个独立的验证队列，其中有$N = 1200$名患者，疾病患病率$\\pi = 0.30$，阈值概率$p_{t} = 0.20$，且在该阈值下运行的分类器表现出$0.80$的灵敏度和$0.85$的特异度。使用推导出的表达式计算该队列在$p_{t}$处的净获益。将最终净获益表示为最简分数。如果选择报告小数值，则将答案四舍五入到四位有效数字。净获益是无量纲的。",
            "solution": "用户提供了一个需要完成两项任务的问题：首先，从第一性原理推导决策曲线分析（DCA）中使用的净获益指标公式；其次，应用此公式计算特定验证队列的净获益。首先将进行问题验证。\n\n### 步骤1：提取已知条件\n- 一个逻辑回归分类器以概率$p$预测疾病风险。\n- 如果$p$大于阈值概率$p_t$，临床医生会对患者进行治疗。\n- $B$是治疗真正患病者的预期临床获益。\n- $H$是不必要地治疗非患病者的预期临床损害。\n- 当预期效用为正时做出治疗决定：$p B - (1-p) H  0$。\n- 阈值$p_t$由无差异点定义：$p_t B - (1-p_t) H = 0$。\n- 灵敏度是患病患者被分类为阳性的概率。\n- 特异度是非患病患者被分类为阴性的概率。\n- 净获益指标需表示为真阳性（$TP$）、假阳性（$FP$）、总队列大小（$N$）和阈值概率（$p_t$）的函数。\n- 对于计算部分：\n    - 总队列大小，$N = 1200$。\n    - 疾病患病率，$\\pi = 0.30$。\n    - 阈值概率，$p_t = 0.20$。\n    - $p_t$处的灵敏度，$\\text{Sens} = 0.80$。\n    - $p_t$处的特异度，$\\text{Spec} = 0.85$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据。决策曲线分析是一种用于评估预测模型和诊断测试的标准化、经过充分验证的统计方法，由Vickers和Elkin首次描述。从预期效用理论的推导是该方法的形式基础。灵敏度、特异度、患病率、$TP$和$FP$的定义是流行病学和生物统计学中的基本概念。该问题提法明确；它为推导和后续计算提供了所有必要信息。语言客观而精确。为验证队列提供的数值是现实的。因此，该问题被认为是有效的。\n\n### 第1部分：净获益指标的推导\n\n在给定风险阈值$p_t$下，预测模型的净获益衡量了使用该模型进行决策的临床效用，与治疗所有患者或不治疗任何患者的默认策略相比。推导从所提供的预期效用概念开始。\n\n使用模型的临床医生将决定治疗任何预测风险$p$等于或高于阈值$p_t$的患者。对于一个包含$N$名患者的队列，此决策过程会产生一定数量的真阳性决策（$TP$，被正确识别并治疗的患病患者）和假阳性决策（$FP$，被错误识别并治疗的非患病患者）。\n\n从$TP$决策中获得的总效用或获益是$TP \\times B$。\n从$FP$决策中产生的总负效用或损害是$FP \\times H$。\n\n以原始效用计，总体净获益是获益总和减去损害总和：\n$$ \\text{Net Benefit}_{\\text{raw}} = (TP \\times B) - (FP \\times H) $$\n此表达式依赖于$B$和$H$的具体值，而这些值通常是未知的。DCA的核心思想是以标准化的方式重新表达此获益。我们使用由阈值概率$p_t$定义的关系。在此阈值下，理性的决策者对治疗与不治疗持无差异态度，意味着预期获益等于预期损害：\n$$ p_t B = (1 - p_t) H $$\n从这个等式中，我们可以推导出损害与获益之间的“交换率”：\n$$ \\frac{H}{B} = \\frac{p_t}{1 - p_t} $$\n该比率代表决策者为避免一个单位的损害（$H$）而愿意放弃的获益（$B$）单位数。\n\n为了标准化净获益，通常将其以真阳性等价物的单位表示。这可以通过将原始净获益除以$B$来实现：\n$$ \\text{Net Benefit}_{\\text{scaled}} = \\frac{(TP \\times B) - (FP \\times H)}{B} = TP - FP \\left( \\frac{H}{B} \\right) $$\n现在，我们将交换率代入此方程：\n$$ \\text{Net Benefit}_{\\text{scaled}} = TP - FP \\left( \\frac{p_t}{1 - p_t} \\right) $$\n此表达式给出了在队列中使用模型而受益的绝对净患者数。为了创建一个可在不同规模研究中进行比较的标准化指标，将此数量在整个大小为$N$的队列上取平均值：\n$$ \\text{Net Benefit} = \\frac{\\text{Net Benefit}_{\\text{scaled}}}{N} = \\frac{TP - FP \\left( \\frac{p_t}{1 - p_t} \\right)}{N} $$\n这可以写成：\n$$ NB(p_t) = \\frac{TP}{N} - \\frac{FP}{N} \\left( \\frac{p_t}{1 - p_t} \\right) $$\n这是DCA中使用的净获益指标的最终表达式，是$TP$、$FP$、$N$和$p_t$的函数。它代表每位患者的真阳性净增益，其中假阳性根据所选风险阈值的几率进行惩罚。\n\n### 第2部分：验证队列的计算\n\n给定验证队列的以下参数：\n- 总队列大小：$N = 1200$\n- 疾病患病率：$\\pi = 0.30$\n- 阈值概率：$p_t = 0.20$\n- 此阈值下的灵敏度：$\\text{Sens} = 0.80$\n- 此阈值下的特异度：$\\text{Spec} = 0.85$\n\n首先，我们计算队列中患病（$D$）和非患病（$ND$）的个体数量。\n$$ D = N \\times \\pi = 1200 \\times 0.30 = 360 $$\n$$ ND = N \\times (1 - \\pi) = 1200 \\times (1 - 0.30) = 1200 \\times 0.70 = 840 $$\n\n接下来，我们使用灵敏度和特异度的定义计算真阳性（$TP$）和假阳性（$FP$）的数量。\n- 真阳性的数量是正确分类为阳性的患病个体数量。\n$$ TP = D \\times \\text{Sens} = 360 \\times 0.80 = 288 $$\n- 假阳性的数量是错误分类为阳性的非患病个体数量。此错误的发生率是$(1 - \\text{Specificity})$。\n$$ FP = ND \\times (1 - \\text{Spec}) = 840 \\times (1 - 0.85) = 840 \\times 0.15 = 126 $$\n\n现在，我们根据阈值概率$p_t$计算权重因子：\n$$ \\frac{p_t}{1 - p_t} = \\frac{0.20}{1 - 0.20} = \\frac{0.20}{0.80} = \\frac{1}{4} $$\n\n最后，我们将$TP=288$，$FP=126$，$N=1200$和权重因子代入推导出的净获益公式中：\n$$ NB(p_t=0.20) = \\frac{288}{1200} - \\frac{126}{1200} \\left( \\frac{1}{4} \\right) $$\n我们可以提出因子$\\frac{1}{1200}$：\n$$ NB(p_t=0.20) = \\frac{1}{1200} \\left( 288 - \\frac{126}{4} \\right) $$\n$$ NB(p_t=0.20) = \\frac{1}{1200} (288 - 31.5) $$\n$$ NB(p_t=0.20) = \\frac{256.5}{1200} $$\n为了将其表示为最简分数，我们首先消除小数：\n$$ NB(p_t=0.20) = \\frac{2565}{12000} $$\n我们可以用分子和分母的最大公约数来除它们。\n除以$5$：\n$$ \\frac{2565 \\div 5}{12000 \\div 5} = \\frac{513}{2400} $$\n$513$的各位数字之和是$5+1+3=9$，所以它可以被$9$整除（因此也可以被$3$整除）。$2400$的各位数字之和是$2+4+0+0=6$，所以它可以被$3$整除。除以$3$：\n$$ \\frac{513 \\div 3}{2400 \\div 3} = \\frac{171}{800} $$\n$171$的质因数分解是$3^2 \\times 19$。$800$的质因数分解是$8 \\times 100 = 2^3 \\times 10^2 = 2^3 \\times (2 \\times 5)^2 = 2^5 \\times 5^2$。没有公质因数。因此，该分数已是最简形式。\n\n在风险阈值为$p_t = 0.20$时使用该分类器的净获益是$\\frac{171}{800}$。\n以小数表示，这是$0.21375$。\n问题要求以最简分数或四位有效数字的小数（$0.2138$）作答。首选精确分数。",
            "answer": "$$\n\\boxed{\\frac{171}{800}}\n$$"
        }
    ]
}