{
    "hands_on_practices": [
        {
            "introduction": "统计功效分析是严谨科学研究设计的基石。通过从第一性原理出发，为简单的单样本 $z$ 检验推导功效和样本量公式，我们可以深入理解显著性水平（$\\alpha$）、效应大小（$\\mu_1 - \\mu_0$）、数据变异性（$\\sigma$）和样本量（$n$）之间错综复杂的关系。这项基础练习  不仅巩固了核心理论，也为后续更复杂的统计设计问题奠定了坚实的数学基础。",
            "id": "4610103",
            "problem": "一个转化基因组学团队正在一项单臂研究中评估一种治疗响应性生物标志物的平均log$_{2}$归一化表达水平是否超过一个临床相关阈值。先前的平台校准和大量的历史对照证明了将测量标准差视为已知且在受试者之间保持稳定是合理的。设零假设为 $H_{0}: \\mu = \\mu_{0}$，科学备择假设为 $H_{1}: \\mu  \\mu_{0}$，其中 $\\mu$ 是真实的群体生物标志物表达均值，$\\mu_{0}$ 是阈值。\n\n基本假设：根据中心极限定理（CLT），对于独立的受试者，$n$ 个受试者的样本均值 $\\bar{X}$ 近似服从均值为 $\\mu$、方差为 $\\sigma^{2}/n$ 的正态分布；单样本 $z$ 检验使用标准化统计量 $Z = (\\bar{X} - \\mu_{0})/(\\sigma/\\sqrt{n})$，其中 $\\sigma$ 根据先前的校准被视为已知。显著性水平 $\\alpha$ 是 I 型错误概率，统计功效是 $1 - \\beta$，其中 $\\beta$ 是在特定真实均值 $\\mu_{1}$ 下的 II 型错误概率。\n\n场景：假设临床相关阈值为 $\\mu_{0} = 0$，治疗下预期的真实均值为 $\\mu_{1} = 0.3$，已知标准差为 $\\sigma = 0.6$，计划的初步研究样本量为 $n = 30$，研究将使用 $\\alpha = 0.01$ 的单侧检验。\n\n任务：\n1. 仅使用上述基本假设，推导在 $H_{0}$ 和特定备择假设 $\\mu = \\mu_{1}$ 下 $z$ 统计量的抽样分布，并从第一性原理出发，计算显著性水平为 $\\alpha$ 的单侧检验的功效函数的确切解析形式。然后根据给定的值 $\\mu_{0}$、$\\mu_{1}$、$\\sigma$、$n$ 和 $\\alpha$ 计算功效。将功效表示为小数（而非百分比）。\n2. 对推导出的功效表达式进行逆运算，得到一个闭式表达式，用于计算在 $\\sigma$ 已知的情况下，在相同的 $\\alpha$ 水平下，为检测从 $\\mu_{0}$ 到 $\\mu_{1}$ 的变化而达到目标功效 $1 - \\beta = 0.9$ 所需的最小样本量 $n$。\n3. 根据给定的 $\\mu_{0}$、$\\mu_{1}$、$\\sigma$ 和 $\\alpha$ 数值计算这个最小的 $n$。将最终数值答案报告为达到或超过目标功效的最小整数 $n$。\n\n最终答案必须是一个数字。除了报告最小整数 $n$ 之外，不需要其他舍入说明。",
            "solution": "首先对问题陈述进行严格的验证过程。\n\n### 步骤 1：提取已知条件\n从问题陈述中逐字提取的已知条件如下：\n- 零假设：$H_{0}: \\mu = \\mu_{0}$\n- 备择假设：$H_{1}: \\mu  \\mu_{0}$\n- $\\mu$：真实的群体生物标志物表达均值\n- $\\mu_{0}$：临床相关阈值\n- 样本均值分布：对于 $n$ 个独立受试者，$\\bar{X} \\sim N(\\mu, \\sigma^{2}/n)$ 近似成立\n- 检验统计量：$Z = (\\bar{X} - \\mu_{0})/(\\sigma/\\sqrt{n})$\n- $\\sigma$：已知标准差\n- $\\alpha$：显著性水平 (I 型错误概率)\n- $1 - \\beta$：统计功效\n- $\\beta$：在特定真实均值 $\\mu_{1}$ 下的 II 型错误概率\n- 任务 1 的场景值：$\\mu_{0} = 0$，$\\mu_{1} = 0.3$，$\\sigma = 0.6$， $n = 30$，$\\alpha = 0.01$ (单侧检验)\n- 任务 2 和 3 的目标值：功效 $1 - \\beta = 0.9$，$\\alpha = 0.01$，$\\mu_{0} = 0$，$\\mu_{1} = 0.3$，$\\sigma = 0.6$\n\n### 步骤 2：使用提取的已知条件进行验证\n对问题的有效性进行评估：\n- **科学依据**：该问题是基于正态分布和中心极限定理的统计假设检验、功效分析和样本量确定的典型应用。转化基因组学中的生物标志物分析是此类方法的标准且合适的应用场景。该问题在根本上是合理的。\n- **适定性**：每个任务都提供了所有必需的参数（$\\mu_0, \\mu_1, \\sigma, \\alpha, \\text{目标功效}, n$）。目标陈述清晰，使得每个部分都有唯一且有意义的解。\n- **客观性**：问题使用精确、标准的统计术语和定量值进行陈述。它没有歧义、主观性或基于意见的主张。\n- **其他缺陷**：该问题没有违反任何其他有效性标准。它是完整的、一致的、现实的，并且与生物信息学中统计功效的指定主题直接相关。\n\n### 步骤 3：结论与行动\n问题被判定为**有效**。现在将提供一个完整的、有理有据的解决方案。\n\n---\n\n### 解题推导\n\n#### 任务 1：功效函数的推导与计算\n\n**检验统计量的分布**\n\n问题陈述指出，样本均值 $\\bar{X}$ 近似服从正态分布，$\\bar{X} \\sim N(\\mu, \\sigma^2/n)$。检验统计量为 $Z = (\\bar{X} - \\mu_{0})/(\\sigma/\\sqrt{n})$。\n\n1.  **在零假设 ($H_{0}$) 下**：真实均值为 $\\mu = \\mu_{0}$。样本均值的分布为 $\\bar{X} \\sim N(\\mu_{0}, \\sigma^2/n)$。检验统计量 $Z = (\\bar{X} - \\mu_{0})/(\\sigma/\\sqrt{n})$ 是将一个正态变量转换为其标准形式的标准线性变换。因此，在 $H_{0}$ 下，统计量 $Z$ 服从标准正态分布：\n    $$Z \\sim N(0, 1)$$\n\n2.  **在特定备择假设 ($H_{1}$) 下**：真实均值被指定为 $\\mu = \\mu_{1}$。样本均值的分布为 $\\bar{X} \\sim N(\\mu_{1}, \\sigma^2/n)$。检验统计量 $Z$ 仍然是相对于 $\\mu_{0}$ 计算的。它在此备择假设下的分布可以通过计算其期望和方差来找到：\n    $$E[Z] = E\\left[\\frac{\\bar{X} - \\mu_{0}}{\\sigma/\\sqrt{n}}\\right] = \\frac{E[\\bar{X}] - \\mu_{0}}{\\sigma/\\sqrt{n}} = \\frac{\\mu_{1} - \\mu_{0}}{\\sigma/\\sqrt{n}}$$\n    $$Var(Z) = Var\\left(\\frac{\\bar{X} - \\mu_{0}}{\\sigma/\\sqrt{n}}\\right) = \\frac{Var(\\bar{X})}{(\\sigma/\\sqrt{n})^2} = \\frac{\\sigma^2/n}{\\sigma^2/n} = 1$$\n    因此，在特定备择假设 $\\mu=\\mu_1$ 下，统计量 $Z$ 服从一个非标准正态分布：\n    $$Z \\sim N\\left(\\frac{\\mu_{1} - \\mu_{0}}{\\sigma/\\sqrt{n}}, 1\\right)$$\n\n**功效函数的推导**\n\n对于显著性水平为 $\\alpha$ 的单侧检验 $H_1: \\mu  \\mu_0$，如果观测到的检验统计量 $Z_{obs}$ 超过临界值 $z_{\\alpha}$，我们就拒绝 $H_0$。临界值 $z_{\\alpha}$ 定义为标准正态分布的上 $\\alpha$ 分位数，满足 $P(Z  z_{\\alpha} | H_0) = \\alpha$，其中 $Z \\sim N(0, 1)$。\n\n功效 ($1-\\beta$) 是在备择假设为真（即 $\\mu = \\mu_{1}$）时正确拒绝 $H_0$ 的概率。\n$$1 - \\beta = \\text{Power} = P(Z_{obs}  z_{\\alpha} | \\mu = \\mu_{1})$$\n由于 $Z_{obs} = (\\bar{X} - \\mu_{0})/(\\sigma/\\sqrt{n})$，且在 $\\mu = \\mu_1$ 下，我们有 $\\bar{X} \\sim N(\\mu_1, \\sigma^2/n)$，我们可以相对于真实均值 $\\mu_1$ 来标准化这个概率表达式。\n$$\\text{Power} = P\\left(\\frac{\\bar{X} - \\mu_{0}}{\\sigma/\\sqrt{n}}  z_{\\alpha}\\right)$$\n我们对概率内的项进行变换：\n$$\\frac{\\bar{X} - \\mu_{0}}{\\sigma/\\sqrt{n}} = \\frac{(\\bar{X} - \\mu_{1}) + (\\mu_{1} - \\mu_{0})}{\\sigma/\\sqrt{n}} = \\frac{\\bar{X} - \\mu_{1}}{\\sigma/\\sqrt{n}} + \\frac{\\mu_{1} - \\mu_{0}}{\\sigma/\\sqrt{n}}$$\n项 $Z' = (\\bar{X} - \\mu_{1})/(\\sigma/\\sqrt{n})$ 是一个标准正态变量，$Z' \\sim N(0, 1)$，因为 $\\bar{X} \\sim N(\\mu_1, \\sigma^2/n)$。将其代回功效表达式中：\n$$\\text{Power} = P\\left(Z' + \\frac{\\mu_{1} - \\mu_{0}}{\\sigma/\\sqrt{n}}  z_{\\alpha}\\right) = P\\left(Z'  z_{\\alpha} - \\frac{\\mu_{1} - \\mu_{0}}{\\sigma/\\sqrt{n}}\\right)$$\n设 $\\Phi(\\cdot)$ 为标准正态分布的累积分布函数（CDF）。那么 $P(Z'  k) = 1 - \\Phi(k)$。利用对称性质 $\\Phi(-x) = 1 - \\Phi(x)$，这也可以写成 $\\Phi(-k)$。因此，功效函数的精确解析形式为：\n$$\\text{Power}(\\mu_1) = 1 - \\Phi\\left(z_{\\alpha} - \\frac{\\mu_{1} - \\mu_{0}}{\\sigma/\\sqrt{n}}\\right) = \\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{\\sigma/\\sqrt{n}} - z_{\\alpha}\\right)$$\n\n**功效的计算**\n\n给定值为：$\\mu_{0} = 0$, $\\mu_{1} = 0.3$, $\\sigma = 0.6$, $n = 30$, 以及 $\\alpha = 0.01$。\n首先，找到临界值 $z_{\\alpha} = z_{0.01}$。该值满足 $\\Phi(z_{0.01}) = 1 - 0.01 = 0.99$。从标准正态分布表或计算器可知，$z_{0.01} \\approx 2.3263$。\n现在将这些值代入功效公式：\n$$\\text{Power} = \\Phi\\left(\\frac{0.3 - 0}{0.6/\\sqrt{30}} - 2.3263\\right)$$\n$$\\text{Power} = \\Phi\\left(\\frac{0.3\\sqrt{30}}{0.6} - 2.3263\\right) = \\Phi\\left(0.5\\sqrt{30} - 2.3263\\right)$$\n对参数进行数值计算：\n$$0.5\\sqrt{30} - 2.3263 \\approx 0.5 \\times 5.4772 - 2.3263 = 2.7386 - 2.3263 = 0.4123$$\n$$\\text{Power} = \\Phi(0.4123) \\approx 0.6600$$\n样本量为 $n=30$ 的研究的功效约为 $0.6600$。\n\n#### 任务 2：样本量公式的推导\n\n目标是找到达到目标功效 $1 - \\beta$ 所需的最小样本量 $n$。我们从任务 1 推导出的功效表达式开始：\n$$\\text{Power} = 1 - \\beta = \\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{\\sigma/\\sqrt{n}} - z_{\\alpha}\\right)$$\n对两边应用标准正态分布的逆累积分布函数 $\\Phi^{-1}$：\n$$\\Phi^{-1}(1 - \\beta) = \\frac{\\mu_{1} - \\mu_{0}}{\\sigma/\\sqrt{n}} - z_{\\alpha}$$\n上 $\\beta$ 分位数的标准记法是 $z_{\\beta}$，它满足 $P(Z  z_{\\beta}) = \\beta$，或 $\\Phi(z_{\\beta}) = 1 - \\beta$。因此，$\\Phi^{-1}(1-\\beta)$ 就是 $z_{\\beta}$。\n$$z_{\\beta} = \\frac{\\mu_{1} - \\mu_{0}}{\\sigma/\\sqrt{n}} - z_{\\alpha}$$\n现在，我们重新整理方程以解出 $n$：\n$$z_{\\alpha} + z_{\\beta} = \\frac{\\mu_{1} - \\mu_{0}}{\\sigma/\\sqrt{n}}$$\n$$\\sqrt{n} = \\frac{\\sigma(z_{\\alpha} + z_{\\beta})}{\\mu_{1} - \\mu_{0}}$$\n两边平方，得到样本量 $n$ 的闭式表达式：\n$$n = \\left(\\frac{\\sigma(z_{\\alpha} + z_{\\beta})}{\\mu_{1} - \\mu_{0}}\\right)^2$$\n\n#### 任务 3：样本量 $n$ 的数值计算\n\n给定：$\\mu_{0} = 0$, $\\mu_{1} = 0.3$, $\\sigma = 0.6$, $\\alpha = 0.01$, 以及目标功效 $1 - \\beta = 0.9$, 这意味着 $\\beta = 0.1$。\n\n我们需要 $\\alpha$ 和 $\\beta$ 的临界值：\n1.  $z_{\\alpha} = z_{0.01}$：标准正态分布的上 $1\\%$ 分位数。$P(Z  z_{0.01}) = 0.01$。如前所述，$z_{0.01} \\approx 2.3263$。\n2.  $z_{\\beta} = z_{0.1}$：标准正态分布的上 $10\\%$ 分位数。$P(Z  z_{0.1}) = 0.1$。查表可知，$z_{0.1} \\approx 1.2816$。\n\n将这些值代入推导出的 $n$ 的公式中：\n$$n = \\left(\\frac{0.6(2.3263 + 1.2816)}{0.3 - 0}\\right)^2$$\n$$n = \\left(\\frac{0.6(3.6079)}{0.3}\\right)^2$$\n$$n = (2 \\times 3.6079)^2$$\n$$n = (7.2158)^2$$\n$$n \\approx 52.0677$$\n由于样本量 $n$ 必须是整数，并且我们需要达到或超过目标功效，我们必须将计算出的值向上取整到下一个整数。\n$$n_{min} = \\lceil 52.0677 \\rceil = 53$$\n因此，所需的最小样本量是 $53$。",
            "answer": "$$\\boxed{53}$$"
        },
        {
            "introduction": "经典的统计检验方法通常依赖于理想化的假设，例如数据呈正态分布，然而在真实的生物医学数据中，这些假设常常因异常值的存在而不再成立。这项练习  旨在探讨数据污染对标准检验（如基于样本均值的检验）功效的实际影响，并引入了修剪均值（trimmed mean）和Huber M-估计量等稳健统计方法作为应对策略。通过这项计算实践，您将学会如何量化不同估计方法在异常值存在时的表现，并相应地调整样本量，从而设计出对真实世界数据不完美性更具韧性的研究方案。",
            "id": "4610080",
            "problem": "考虑一项两组（two-arm）生物医学研究，旨在使用相等的组样本量检测两个独立总体中标量生物标志物的差异。设位置差异为 $\\delta$，基线标准差为 $\\sigma$，显著性水平为 $\\alpha$（双侧），目标功效为 $1-\\beta$。假设离群值污染通过对称混合模型进行建模：观测值有 $(1-\\epsilon)$ 的概率从均值为 $0$、方差为 $\\sigma^2$ 的正态分布中抽取，有 $\\epsilon$ 的概率从均值为 $0$、方差为 $c^2 \\sigma^2$ 的正态分布中抽取，其中 $\\epsilon \\in [0,1)$ 且 $c \\ge 1$。两组共享相同的污染机制和方差参数，两样本估计量是两组位置估计量之差。使用中心极限定理 (CLT) 和估计量的渐近性质作为您的理论基础。\n\n您的程序必须实现三种组位置的估计量：\n- 样本均值。\n- $\\tau$-截尾均值，其定义为从每端截去比例为 $\\tau$ 的数据，然后对剩余的中间部分数据求平均。\n- 一种针对已知尺度的Huber型最大似然型估计量（M估计量），由阈值为 $k$ 的Huber影响函数 $\\psi(z)$ 定义，其中当 $|z| \\le k$ 时 $\\psi(z) = z$，否则 $\\psi(z) = k \\,\\mathrm{sign}(z)$，作用于标准化残差 $z = (x - \\mu)/\\sigma$。\n\n从方差、混合模型、中心极限定理 (CLT) 下的渐近正态性以及双侧检验功效的定义出发，推导：\n1. 在污染混合模型下，样本均值相对于未污染基线的方差膨胀。\n2. 在混合模型下，利用与Winsor化分布的联系，推导 $\\tau$-截尾均值的每组渐近方差常数。\n3. 在混合模型下，通过其影响函数和针对已知尺度的Fisher一致性条件，推导Huber M估计量的每组渐近方差常数。\n4. 一个计算每组最小整数样本量 $n$ 的程序，该程序基于利用CLT的双侧正态近似，为每个估计量实现至少为 $1-\\beta$ 的目标功效。您的程序必须通过验证候选 $n$ 的功效来确保单调性和正确性，并在需要时使用数值区间法。\n\n对于每个测试用例，您的程序必须生成一个包含五个量的有序列表：\n- 污染下样本均值的方差膨胀因子。\n- 无污染情况下样本均值所需的每组样本量。\n- 污染情况下样本均值所需的每组样本量。\n- 污染情况下 $\\tau$-截尾均值所需的每组样本量。\n- 污染情况下Huber M估计量所需的每组样本量。\n\n所有样本量必须作为最小整数 $n$ 返回，使得计算出的功效至少为 $1-\\beta$。方差膨胀因子必须作为浮点数返回。不涉及物理单位；概率必须视为小数（例如，将百分之五的显著性水平表示为 $0.05$）。\n\n使用以下测试套件，指定为有序元组 $(\\alpha, 1-\\beta, \\sigma, \\delta, \\epsilon, c, \\tau, k)$：\n- 案例 1：$(0.05, 0.90, 1.00, 0.50, 0.10, 5.00, 0.10, 1.50)$。\n- 案例 2：$(0.05, 0.90, 1.00, 0.50, 0.00, 5.00, 0.10, 1.50)$。\n- 案例 3：$(0.01, 0.80, 1.00, 0.50, 0.30, 10.00, 0.20, 1.20)$。\n- 案例 4：$(0.05, 0.90, 2.00, 0.10, 0.10, 7.00, 0.10, 1.50)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。例如，如果一个案例产生从 $r_1$ 到 $r_5$ 的五个结果，并且四个案例按顺序生成列表 $R_1$ 到 $R_4$ 的串联，则最终输出格式必须为 $[R_{1,1},R_{1,2},R_{1,3},R_{1,4},R_{1,5},R_{2,1},\\dots,R_{4,5}]$。",
            "solution": "该问题是有效的，因为它在科学上基于稳健统计学，问题设定完整、一致且表述规范。我们开始进行求解。\n\n此问题的基础是两样本均值检验的样本量计算。对于两个大小均为 $n$ 的独立组，位置估计量之差 $\\hat{\\delta} = \\hat{\\mu}_2 - \\hat{\\mu}_1$ 近似服从正态分布 $\\hat{\\delta} \\sim N(\\delta, \\frac{2V_{\\text{asym}}}{n})$。在显著性水平为 $\\alpha$ 的双侧检验中，要达到 $1-\\beta$ 的功效，所需样本量 $n$ 由以下关系确定：\n$$\n\\text{Power} = P\\left( \\left| \\frac{\\hat{\\delta}}{\\sqrt{2V_{\\text{asym}}/n}} \\right|  z_{1-\\alpha/2} \\bigg| \\delta \\right) \\ge 1-\\beta\n$$\n此处，$z_{q}$ 是标准正态分布的 $q$-分位数，$V_{\\text{asym}}$ 是所选位置估计量的每组渐近方差常数。功效由下式给出：\n$$\n\\text{Power}(n) = 1 - \\Phi\\left(z_{1-\\alpha/2} - \\frac{\\delta\\sqrt{n}}{\\sqrt{2V_{\\text{asym}}}}\\right) + \\Phi\\left(-z_{1-\\alpha/2} - \\frac{\\delta\\sqrt{n}}{\\sqrt{2V_{\\text{asym}}}}\\right)\n$$\n其中 $\\Phi$ 是标准正态分布的累积分布函数 (CDF)。我们寻求满足此不等式的最小整数 $n$。利用功效函数相对于 $n$ 的单调性，采用数值搜索（例如，二分搜索）来找到这个最小的 $n$。\n\n问题的核心在于确定在指定的污染混合模型下，每个估计量的渐近方差 $V_{\\text{asym}}$。观测值 $X$ 从一个概率密度函数 (PDF) 如下的分布中抽取：\n$$\nf(x) = (1-\\epsilon) \\phi(x; \\mu, \\sigma^2) + \\epsilon \\phi(x; \\mu, c^2\\sigma^2)\n$$\n其中 $\\phi(x; \\mu, s^2)$ 是均值为 $\\mu$、方差为 $s^2$ 的正态分布的PDF。为便于推导，我们可以不失一般性地假设 $\\mu=0$。其累积分布函数 (CDF) 为 $F(x) = (1-\\epsilon) \\Phi(x/\\sigma) + \\epsilon \\Phi(x/(c\\sigma))$。\n\n**1. 样本均值估计量**\n样本均值的影响函数为 $\\psi(x) = x$。渐近方差即为基础分布的方差。\n$$\nV_{\\text{asym, mean}} = \\text{Var}(X) = E[X^2] - (E[X])^2\n$$\n对称混合模型的均值为 $E[X] = 0$。其二阶矩为：\n$$\nE[X^2] = \\int_{-\\infty}^{\\infty} x^2 f(x) dx = (1-\\epsilon) \\int_{-\\infty}^{\\infty} x^2 \\phi(x; 0, \\sigma^2) dx + \\epsilon \\int_{-\\infty}^{\\infty} x^2 \\phi(x; 0, c^2\\sigma^2) dx\n$$\n由于 $N(0, s^2)$ 分布的方差为 $s^2$，我们有：\n$$\nV_{\\text{asym, mean}} = (1-\\epsilon)\\sigma^2 + \\epsilon c^2\\sigma^2 = \\sigma^2(1 - \\epsilon + \\epsilon c^2)\n$$\n方差膨胀因子 (VIF) 是该方差与基线（未污染，$\\epsilon=0$）方差 $\\sigma^2$ 的比值：\n$$\n\\text{VIF} = \\frac{\\sigma^2(1 - \\epsilon + \\epsilon c^2)}{\\sigma^2} = 1 - \\epsilon + \\epsilon c^2\n$$\n然后，使用 $V_{\\text{asym}} = \\sigma^2$ 计算无污染情况下的所需样本量，使用 $V_{\\text{asym}} = \\sigma^2 \\cdot \\text{VIF}$ 计算污染情况下的所需样本量。\n\n**2. $\\tau$-截尾均值估计量**\n对于CDF为 $F$ 的对称分布，$\\tau$-截尾均值的渐近方差由下式给出：\n$$\nV_{\\text{asym, \\tau-trim}} = \\frac{1}{(1-2\\tau)^2} \\left( \\int_{q_\\tau}^{q_{1-\\tau}} x^2 dF(x) + 2\\tau (q_{1-\\tau})^2 \\right)\n$$\n其中 $q_p = F^{-1}(p)$ 是混合分布的 $p$-分位数。由于对称性，$q_\\tau = -q_{1-\\tau}$。分位数 $q_{1-\\tau}$ 通过数值求解方程 $F(q_{1-\\tau}) = 1-\\tau$ 得到。积分项可以写为：\n$$\n\\int_{-q_{1-\\tau}}^{q_{1-\\tau}} x^2 f(x) dx = (1-\\epsilon) \\int_{-q_{1-\\tau}}^{q_{1-\\tau}} x^2 \\phi(x; 0, \\sigma^2) dx + \\epsilon \\int_{-q_{1-\\tau}}^{q_{1-\\tau}} x^2 \\phi(x; 0, c^2\\sigma^2) dx\n$$\n定积分 $\\int_{-A}^{A} x^2 \\phi(x; 0, s^2) dx$ 的计算结果为 $s^2 \\left( 2\\Phi(A/s) - 1 - 2(A/s)\\phi(A/s) \\right)$，其中 $\\phi$ 是标准正态PDF。通过代入 $A = q_{1-\\tau}$ 和各自的方差，我们可以计算出该积分，并进而得到 $V_{\\text{asym, \\tau-trim}}$。\n\n**3. Huber M估计量**\n对于已知尺度 $\\sigma$ 的位置参数 $\\mu$ 的M估计量由 $\\sum \\psi((x_i - \\hat{\\mu})/\\sigma) = 0$ 定义。其渐近方差为：\n$$\nV_{\\text{asym, Huber}} = \\sigma^2 \\frac{E[\\psi_k((X-\\mu)/\\sigma)^2]}{(E[\\psi_k'((X-\\mu)/\\sigma)])^2}\n$$\n令 $Z = (X-\\mu)/\\sigma$。来自混合模型的观测值 $X$ 导致 $Z$ 从一个正态分布的混合模型中抽取：$Z \\sim (1-\\epsilon)N(0, 1) + \\epsilon N(0, c^2)$，其PDF为 $f_Z(z) = (1-\\epsilon)\\phi(z; 0, 1) + \\epsilon\\phi(z; 0, c^2)$。\nHuber影响函数的导数为：当 $|z| \\le k$ 时 $\\psi_k'(z) = 1$，否则为 $0$。分母是 $B = E[\\psi_k'(Z)] = P(|Z| \\le k)$。\n$$\nB = \\int_{-k}^{k} f_Z(z) dz = (1-\\epsilon)(2\\Phi(k)-1) + \\epsilon(2\\Phi(k/c)-1)\n$$\n分子是 $A = E[\\psi_k(Z)^2] = \\int_{-\\infty}^{\\infty} \\psi_k(z)^2 f_Z(z) dz$。这可以分为两部分：\n$$\nA = \\int_{-k}^{k} z^2 f_Z(z) dz + \\int_{|z|k} k^2 f_Z(z) dz\n$$\n第二项是 $k^2 P(|Z|k) = k^2 (1 - B)$。第一项的计算方式与截尾均值的积分相似：\n$$\n\\int_{-k}^{k} z^2 f_Z(z) dz = (1-\\epsilon)\\int_{-k}^{k} z^2 \\phi(z;0,1)dz + \\epsilon\\int_{-k}^{k} z^2 \\phi(z;0,c^2)dz\n$$\n使用与之前相同的定积分公式，我们可以计算出这一项。最后，将所有部分组合起来，我们得到 $V_{\\text{asym, Huber}} = \\sigma^2 A/B^2$。\n\n利用每个估计量的 $V_{\\text{asym}}$ 表达式，我们可以计算出每个测试用例所需的值。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the problem for all test cases, calculating variance inflation and required sample sizes.\n    \"\"\"\n    \n    test_cases = [\n        # (alpha, power, sigma, delta, epsilon, c, tau, k)\n        (0.05, 0.90, 1.00, 0.50, 0.10, 5.00, 0.10, 1.50),\n        (0.05, 0.90, 1.00, 0.50, 0.00, 5.00, 0.10, 1.50),\n        (0.01, 0.80, 1.00, 0.50, 0.30, 10.00, 0.20, 1.20),\n        (0.05, 0.90, 2.00, 0.10, 0.10, 7.00, 0.10, 1.50),\n    ]\n\n    results = []\n\n    def calculate_power(n, V_asym, delta, alpha):\n        \"\"\"Calculates the power of the two-sample test for a given sample size n.\"\"\"\n        if n = 1:\n            return 0.0\n        # Non-centrality parameter\n        lambda_val = delta * np.sqrt(n) / np.sqrt(2 * V_asym)\n        z_alpha_half = norm.ppf(1 - alpha / 2)\n        power = 1 - norm.cdf(z_alpha_half - lambda_val) + norm.cdf(-z_alpha_half - lambda_val)\n        return power\n\n    def find_min_n(V_asym, delta, alpha, target_power):\n        \"\"\"Finds the minimum integer sample size n to achieve target power.\"\"\"\n        if V_asym == 0 or delta == 0:\n            return np.iinfo(np.int64).max\n\n        # Use the standard formula for an initial estimate of n\n        z_alpha_half = norm.ppf(1 - alpha / 2)\n        z_beta = norm.ppf(target_power)\n        n_approx = (2 * V_asym * (z_alpha_half + z_beta)**2) / (delta**2)\n\n        # Establish a search range [low, high] for n\n        low = max(2, int(n_approx * 0.8))\n        high = int(n_approx * 1.2) + 5\n        \n        # Ensure the search range is valid\n        while calculate_power(high, V_asym, delta, alpha)  target_power:\n            low = high\n            high = int(high * 1.5)\n        \n        while low > 2 and calculate_power(low, V_asym, delta, alpha) >= target_power:\n            high = low\n            low = max(2, int(low * 0.8))\n\n        # Bisection search for the minimal integer n\n        ans = high\n        while low = high:\n            mid = (low + high) // 2\n            if mid  2:\n                low = 2\n                continue\n            \n            if calculate_power(mid, V_asym, delta, alpha) >= target_power:\n                ans = mid\n                high = mid - 1\n            else:\n                low = mid + 1\n        return ans\n    \n    def integral_x_sq_phi(A, s_sq):\n        \"\"\"Computes integral of x^2 * phi(x; 0, s_sq) from -A to A.\"\"\"\n        s = np.sqrt(s_sq)\n        if s == 0:\n            return 0.0\n        A_over_s = A / s\n        return s_sq * (2 * norm.cdf(A_over_s) - 1 - 2 * A_over_s * norm.pdf(A_over_s))\n\n    for case in test_cases:\n        alpha, power, sigma, delta, epsilon, c, tau, k = case\n\n        # 1. Sample Mean\n        vif = 1 - epsilon + epsilon * c**2\n        V_asym_mean_no_contam = sigma**2\n        V_asym_mean_contam = sigma**2 * vif\n\n        n_mean_no_contam = find_min_n(V_asym_mean_no_contam, delta, alpha, power)\n        n_mean_contam = find_min_n(V_asym_mean_contam, delta, alpha, power)\n\n        # 2. Trimmed Mean\n        if epsilon == 0:\n            q_1_minus_tau = sigma * norm.ppf(1 - tau)\n        else:\n            def F_q(q):\n                return (1 - epsilon) * norm.cdf(q / sigma) + epsilon * norm.cdf(q / (c * sigma)) - (1 - tau)\n            q_1_minus_tau = brentq(F_q, 1e-9, 10 * c * sigma + 10)\n\n        integral_part = (1 - epsilon) * integral_x_sq_phi(q_1_minus_tau, sigma**2) + epsilon * integral_x_sq_phi(q_1_minus_tau, (c * sigma)**2)\n        V_asym_trimmed = (1 / (1 - 2 * tau)**2) * (integral_part + 2 * tau * q_1_minus_tau**2)\n        \n        n_trimmed = find_min_n(V_asym_trimmed, delta, alpha, power)\n\n        # 3. Huber M-estimator\n        Z_dist = {1: (1 - epsilon), c**2: epsilon} # Z ~ (1-eps)N(0,1) + eps*N(0,c^2)\n        \n        B = Z_dist[1] * (2 * norm.cdf(k) - 1) + Z_dist[c**2] * (2 * norm.cdf(k / c) - 1)\n        \n        A1 = Z_dist[1] * integral_x_sq_phi(k, 1) + Z_dist[c**2] * integral_x_sq_phi(k, c**2)\n        A2 = k**2 * (1 - B)\n        A = A1 + A2\n        \n        V_asym_huber = sigma**2 * A / B**2\n        n_huber = find_min_n(V_asym_huber, delta, alpha, power)\n        \n        results.extend([\n            vif,\n            n_mean_no_contam,\n            n_mean_contam,\n            n_trimmed,\n            n_huber\n        ])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "现代临床试验设计正从传统的固定样本量方法向更灵活、更高效的自适应设计演进。此练习  将引导您进入贝叶斯自适应设计的世界，展示如何运用贝叶斯原理，特别是“成功的预测概率”（Predictive Probability of Success, PPS），来构建可以基于中期分析结果提前终止的试验。通过为一项肿瘤学研究设计无效终止边界（futility boundary），您将亲手实践如何使试验在保证科学严谨性的同时，变得更具伦理性和经济效益，并能精确量化这种先进设计所带来的预期样本量节省。",
            "id": "4610096",
            "problem": "一项单臂、生物标志物靶向的肿瘤学研究计划对一组由基因组特征定义的患者队列采用二元应答终点。令真实应答概率表示为 $p$。该设计在期中样本量时采用基于成功预测概率（PPS）的贝叶斯期中无效性规则，其中成功预测概率（PPS）定义为在期中分析时，最终分析将宣布治疗相对于一个固定的基准应答概率有效的后验预测概率。\n\n假设应答者在期中和期末分析中均服从贝塔先验 $p \\sim \\text{Beta}(a,b)$ 和二项分布抽样模型。设研究计划总样本量为 $n$ 名患者，并在纳入 $n_1$ 名患者后进行一次期中分析。设历史基准应答概率为 $p_0$，并将最终贝叶斯成功标准定义为：在研究结束时，$p$ 超过 $p_0$ 的后验概率至少为一个固定的阈值 $\\tau$，即如果 $\\Pr(p  p_0 \\mid \\text{final data}) \\ge \\tau$，则研究宣布成功。在期中分析时，如果基于观测到的期中数据计算出的成功预测概率（PPS）小于一个固定的阈值 $\\gamma$，数据监察委员会将决定因无效而停止研究；否则，研究将继续进行至完整的 $n$ 名患者。\n\n您的任务是，从贝叶斯定理的基础以及贝塔先验与二项式似然的共轭性出发：\n\n- 推导并实现一种方法，用于计算满足上述最终贝叶斯成功标准的最小最终应答者总数 $k^\\star$（一个整数阈值，代表 $n$ 名患者中的总应答者人数）。\n- 推导并实现一种方法，用于在期中分析时，当 $n_1$ 名患者中有 $x$ 名观测到的应答者时，计算成功预测概率（PPS），即在 $n$ 名患者时总应答者人数将至少为 $k^\\star$ 的后验预测概率。\n- 从第一性原理出发，证明或提供一个清晰的论证，说明在所述模型假设下，PPS 是期中应答者计数 $x$ 的非递减函数，并利用此性质定义一个整数无效边界 $c$，使得当且仅当期中应答者计数满足 $x \\le c$ 时研究提前停止，否则继续进行。\n- 在指定的真实应答概率 $p_{\\text{true}}$下，通过计算带有无效中止的适应性设计的期望样本量 $\\mathbb{E}[N]$，以及相对于总是招募满 $n$ 名患者的节省量 $n - \\mathbb{E}[N]$，来量化由该无效边界带来的期望样本量减少。\n\n所有概率必须以 $[0,1]$ 区间内的小数表示，而非百分比。所有角度均与此问题无关。不涉及物理单位。所有浮点输出均四舍五入至六位小数。\n\n实现一个单一程序，对于下方的每个测试用例，返回一个列表，其中包含：\n- 推导出的无效边界 $c$（一个整数），\n- 期望样本量 $\\mathbb{E}[N]$（一个浮点数），\n- 期望节省量 $n - \\mathbb{E}[N]$（一个浮点数），\n- 节省比例 $(n - \\mathbb{E}[N])/n$（一个浮点数）。\n\n测试套件参数集，每个以元组 $(n, n_1, p_0, a, b, \\tau, \\gamma, p_{\\text{true}})$ 的形式给出：\n\n- 案例 A（疗效不佳的治疗）：$(100, 40, 0.25, 1, 1, 0.95, 0.10, 0.20)$，其中 $n = 100$, $n_1 = 40$, $p_0 = 0.25$, $a = 1$, $b = 1$, $\\tau = 0.95$, $\\gamma = 0.10$, $p_{\\text{true}} = 0.20$。\n- 案例 B（疗效临界）：$(100, 40, 0.25, 1, 1, 0.95, 0.10, 0.30)$，其中 $p_{\\text{true}} = 0.30$。\n- 案例 C（疗效显著）：$(100, 40, 0.25, 1, 1, 0.95, 0.10, 0.50)$，其中 $p_{\\text{true}} = 0.50$。\n- 案例 D（更严格的期中无效性标准和更宽松的最终成功标准）：$(100, 40, 0.25, 1, 1, 0.90, 0.50, 0.20)$，其中 $\\tau = 0.90$, $\\gamma = 0.50$, $p_{\\text{true}} = 0.20$。\n\n您的程序应生成单行输出，其中包含结果，格式为由逗号分隔的、包含在方括号内的各案例子列表，且无空格。例如，输出结构必须类似于：“[[c_A,EN_A,S_A,F_A],[c_B,EN_B,S_B,F_B],[c_C,EN_C,S_C,F_C],[c_D,EN_D,S_D,F_D]]”，其中 $c_{\\cdot}$ 是整数，$EN_{\\cdot}$、$S_{\\cdot}$、$F_{\\cdot}$ 是四舍五入到六位小数的浮点数。\n\n您的实现不得对问题陈述中的目标公式进行硬编码；它必须从上述基本定义中推导出这些公式，并以与所述模型一致的通用方式计算测试套件所需的量。",
            "solution": "问题陈述是在贝叶斯适应性临床试验设计领域中一个定义明确且具有科学依据的练习。它是自洽的，提供了所有必要的参数和定义。其概念，包括贝塔-二项共轭模型、后验概率和成功预测概率（PPS），在生物统计学领域都是标准概念。因此，该问题被认为是**有效的**。\n\n解决方案分为四个部分，对应于问题陈述中概述的任务。所有数学推导均从第一性原理进行。\n\n### 第 1 部分：期末分析与成功阈值 ($k^\\star$)\n\n该问题的贝叶斯框架包括未知应答概率 $p$ 的贝塔先验分布，以及观测到的应答者数量的二项式似然。\n\n$p$ 的先验分布给定为 $p \\sim \\text{Beta}(a,b)$。其概率密度函数 (PDF) 为：\n$$\nf(p; a, b) = \\frac{p^{a-1}(1-p)^{b-1}}{B(a,b)} \\quad \\text{for } p \\in [0,1]\n$$\n其中 $B(a,b)$ 是贝塔函数。\n\n试验数据包括总共 $n$ 名患者中的应答者数量 $k$。这通过二项分布进行建模，其似然函数为 $L(p \\mid k,n) \\propto p^k(1-p)^{n-k}$。\n\n由于贝塔先验和二项式似然的共轭性，在 $n$ 名患者中观测到 $k$ 名应答者后，$p$ 的后验分布也是一个贝塔分布。该后验分布通过贝叶斯定理推导得出：\n$$\n\\text{Posterior} \\propto \\text{Likelihood} \\times \\text{Prior}\n$$\n$$\nf(p \\mid k, n) \\propto p^k(1-p)^{n-k} \\times p^{a-1}(1-p)^{b-1} = p^{a+k-1}(1-p)^{b+n-k-1}\n$$\n该核函数对应于一个更新了参数的贝塔分布：\n$$\np \\mid k, n \\sim \\text{Beta}(a+k, b+n-k)\n$$\n\n最终成功标准是 $p$ 超过基准 $p_0$ 的后验概率至少为 $\\tau$。在数学上，这表示为 $\\Pr(p  p_0 \\mid k,n) \\ge \\tau$。\n这个概率是后验贝塔分布在 $p_0$ 处的生存函数（或互补累积分布函数，CCDF）：\n$$\n\\Pr(p  p_0 \\mid k,n) = 1 - F_{\\text{Beta}(a+k, b+n-k)}(p_0)\n$$\n其中 $F_{\\text{Beta}(\\alpha, \\beta)}(z)$ 是参数为 $\\alpha$ 和 $\\beta$ 的贝塔分布的累积分布函数 (CDF)。\n\n任务是找到满足此标准的最小整数总应答者数 $k^\\star$。\n$$\nk^\\star = \\min \\{ k \\in \\{0, 1, \\ldots, n\\} \\mid 1 - F_{\\text{Beta}(a+k, b+n-k)}(p_0) \\ge \\tau \\}\n$$\n函数 $g(k) = 1 - F_{\\text{Beta}(a+k, b+n-k)}(p_0)$ 是一个关于 $k$ 的单调非递减函数。随着 $k$ 的增加，后验分布 $\\text{Beta}(a+k, b+n-k)$ 向更大的 $p$ 值移动，这增加了 $p  p_0$ 的概率质量。因此，可以通过简单的迭代搜索找到 $k^\\star$，从 $k=0$ 开始递增，直到满足条件。第一个满足不等式的 $k$ 值即为 $k^\\star$。\n\n### 第 2 部分：期中分析与成功预测概率 (PPS)\n\n在对 $n_1$ 名患者进行期中分析后，观测到 $x$ 名应答者。基于此期中数据更新 $p$ 的后验分布：\n$$\np \\mid x, n_1 \\sim \\text{Beta}(a', b') \\quad \\text{where } a' = a+x \\text{ and } b' = b+n_1-x\n$$\n研究将继续招募剩余的 $n_2 = n - n_1$ 名患者。令 $Y$ 为这些未来患者中的应答者数量。在给定 $p$ 的具体值时，$Y$ 的条件分布是二项分布：$Y \\mid p \\sim \\text{Binomial}(n_2, p)$。\n\n成功预测概率（PPS）是从期中分析的角度看，最终研究结果将成功的概率。成功定义为总应答者人数 $x+Y$ 至少为 $k^\\star$。PPS是通过对 $p$ 的不确定性进行边缘化计算得出的，这种不确定性由期中后验分布所捕捉：\n$$\n\\text{PPS}(x) = \\Pr(x+Y \\ge k^\\star \\mid x, n_1) = \\Pr(Y \\ge k^\\star - x \\mid x, n_1)\n$$\n这需要 $Y$ 的后验预测分布。该分布是通过将 $Y$ 的条件分布对 $p$ 的期中后验进行积分得到的：\n$$\n\\Pr(Y=y \\mid x, n_1) = \\int_0^1 \\Pr(Y=y \\mid p) f(p \\mid x, n_1) \\, dp\n$$\n其中 $\\Pr(Y=y \\mid p) = \\binom{n_2}{y} p^y (1-p)^{n_2-y}$ 并且 $f(p \\mid x, n_1)$ 是 $\\text{Beta}(a', b')$ 分布的概率密度函数。这个积分定义了贝塔-二项分布：\n$$\n\\Pr(Y=y \\mid x, n_1) = \\binom{n_2}{y} \\frac{B(a'+y, b'+n_2-y)}{B(a', b')}\n$$\nPPS 则是这些概率在所有能导致试验成功的 $y$ 值上的总和：\n$$\n\\text{PPS}(x) = \\sum_{y=\\max(0, k^\\star-x)}^{n_2} \\Pr(Y=y \\mid x, n_1) = \\sum_{y=\\max(0, k^\\star-x)}^{n_2} \\binom{n_2}{y} \\frac{B(a+x+y, b+n_1-x+n_2-y)}{B(a+x, b+n_1-x)}\n$$\n为保证数值稳定性，涉及贝塔函数 $B(\\cdot, \\cdot)$ 和二项式系数 $\\binom{\\cdot}{\\cdot}$ 的计算最好在对数空间中使用对数伽马函数（$\\text{gammaln}$）或对数贝塔函数（$\\text{betaln}$）来执行。\n\n### 第 3 部分：无效边界 ($c$)\n\n问题要求提供一个清晰的论证，说明 $\\text{PPS}(x)$ 是期中应答者计数 $x$ 的一个非递减函数。$x$ 的增加通过两种方式影响 PPS：\n1.  **未来需求降低：** 成功所需的额外应答者数量 $k^\\star - x$ 随 $x$ 的增加而减少。这使得在任何给定的未来应答率下，目标都更容易实现。\n2.  **关于 $p$ 的信念更新：** 对于固定的 $n_1$，$x$ 的增加会使期中后验分布 $p \\mid x, n_1 \\sim \\text{Beta}(a+x, b+n_1-x)$ 向更高的 $p$ 值移动。形式上，如果 $x_2  x_1$，那么给定 $x_2$ 的 $p$ 的后验分布一阶随机占优于给定 $x_1$ 的后验分布。这意味着对于 $p$ 的任何上尾事件，其分配到的概率会增加。由于未来的应答者数量 $Y$ 与 $p$ 正相关，因此对更高 $p$ 值的更强信念会导致对更高 $Y$ 值的更强信念。\n\n这两种效应都朝着同一方向作用：它们都增加了实现最终成功目标的概率。因此，$\\text{PPS}(x)$ 是 $x$ 的一个非递减函数。\n\n无效性规则规定，如果 $\\text{PPS}(x)  \\gamma$，试验就停止。因为 $\\text{PPS}(x)$ 关于 $x$ 是非递减的，所以存在一个整数阈值 $c$，使得对于所有期中结果 $x \\le c$，都满足无效条件，而对于所有 $x  c$，则不满足。无效边界 $c$ 是导致试验停止的期中应答者的最大数量。\n$$\nc = \\max \\{ x \\in \\{0, 1, \\ldots, n_1\\} \\mid \\text{PPS}(x)  \\gamma \\}\n$$\n如果对于所有可能的 $x$ 值（从 $0$ 到 $n_1$），都有 $\\text{PPS}(x) \\ge \\gamma$，那么就不会发生因无效而停止的情况，我们定义 $c = -1$。\n$c$ 的值可以通过计算 $x = n_1, n_1-1, \\ldots, 0$ 时的 $\\text{PPS}(x)$ 并找到第一个满足无效条件的值来确定。\n\n### 第 4 部分：期望样本量与节省量\n\n适应性设计的样本量 $N$ 是一个随机变量。如果试验在期中分析时因无效而停止，它取值为 $n_1$；如果继续，则取值为 $n$。如果观测到的期中应答者计数 $X$ 满足 $X \\le c$，试验就会停止。\n\n为了评估该设计的操作特性，我们假设一个真实的潜在应答概率 $p_{\\text{true}}$。在此假设下，期中应答者的数量 $X$ 服从二项分布：\n$$\nX \\sim \\text{Binomial}(n_1, p_{\\text{true}})\n$$\n因无效而停止的概率 $P_{\\text{stop}}$ 是观测到结果落在无效区域的概率：\n$$\nP_{\\text{stop}} = \\Pr(X \\le c) = \\sum_{i=0}^{c} \\binom{n_1}{i} p_{\\text{true}}^i (1-p_{\\text{true}})^{n_1-i}\n$$\n这是 $\\text{Binomial}(n_1, p_{\\text{true}})$ 分布在 $c$ 处的累积分布函数（CDF）。如果 $c=-1$，则 $P_{\\text{stop}}=0$。\n\n期望样本量 $\\mathbb{E}[N]$ 是两种可能样本量的加权平均值，权重由它们各自的概率给出：\n$$\n\\mathbb{E}[N] = n_1 \\cdot P_{\\text{stop}} + n \\cdot (1 - P_{\\text{stop}})\n$$\n期望样本量节省量是固定最大样本量 $n$ 与期望样本量 $\\mathbb{E}[N]$ 之间的差值：\n$$\n\\text{Savings} = n - \\mathbb{E}[N] = n - (n_1 P_{\\text{stop}} + n - n P_{\\text{stop}}) = (n - n_1) P_{\\text{stop}}\n$$\n节省比例是该节省量表示为最大样本量 $n$ 的一个比例：\n$$\n\\text{Savings Fraction} = \\frac{\\text{Savings}}{n} = \\frac{(n-n_1)P_{\\text{stop}}}{n}\n$$\n这些量是使用推导出的无效边界 $c$ 和给定的 $p_{\\text{true}}$ 为每个测试用例计算的。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import beta, binom\nfrom scipy.special import betaln, gammaln\n\ndef solve():\n    \"\"\"\n    Main function to solve the Bayesian adaptive design problem for all test cases.\n    \"\"\"\n    test_cases = [\n        # (n, n1, p0, a, b, tau, gamma, p_true)\n        (100, 40, 0.25, 1, 1, 0.95, 0.10, 0.20),  # Case A\n        (100, 40, 0.25, 1, 1, 0.95, 0.10, 0.30),  # Case B\n        (100, 40, 0.25, 1, 1, 0.95, 0.10, 0.50),  # Case C\n        (100, 40, 0.25, 1, 1, 0.90, 0.50, 0.20),  # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        n, n1, p0, a, b, tau, gamma_thresh, p_true = case\n\n        # Part 1: Find the minimal number of final responders for success, k_star\n        k_star = -1\n        for k in range(n + 1):\n            # Posterior distribution: Beta(a+k, b+n-k)\n            # Success prob. is Pr(p > p0 | final data) = 1 - CDF(p0) = SF(p0)\n            success_prob = beta.sf(p0, a + k, b + n - k)\n            if success_prob >= tau:\n                k_star = k\n                break\n        \n        if k_star == -1:\n            # This case should not occur with the given parameters, but it's a safeguard.\n            # It means even with n responders, the success criterion is not met.\n            c = n1\n            expected_n = float(n)\n            savings = 0.0\n            savings_fraction = 0.0\n            results.append([int(c), round(expected_n, 6), round(savings, 6), round(savings_fraction, 6)])\n            continue\n\n        n2 = n - n1\n\n        # Part 2  3: Compute PPS and find futility boundary c\n        memo_pps = {}\n\n        def get_pps(x, n1, n2, a, b, k_star):\n            \"\"\"\n            Calculates the Predictive Probability of Success (PPS) for a given\n            interim outcome of x responders in n1 patients.\n            \"\"\"\n            if x in memo_pps:\n                return memo_pps[x]\n\n            a_prime = a + x\n            b_prime = b + n1 - x\n            \n            y_min = k_star - x\n            if y_min > n2:\n                memo_pps[x] = 0.0\n                return 0.0\n            \n            # The number of future responders Y follows a Beta-Binomial distribution\n            # Y ~ BetaBinom(n2, a_prime, b_prime)\n            # We calculate PPS = Pr(Y >= y_min)\n            \n            # Use log probabilities for numerical stability\n            log_beta_ab_prime = betaln(a_prime, b_prime)\n            \n            total_prob = 0.0\n            for y in range(max(0, y_min), n2 + 1):\n                # Log of the Beta-Binomial PMF:\n                # log(C(n2, y)) + log(B(a'+y, b'+n2-y)) - log(B(a', b'))\n                log_C_n2_y = gammaln(n2 + 1) - gammaln(y + 1) - gammaln(n2 - y + 1)\n                log_beta_term = betaln(a_prime + y, b_prime + n2 - y)\n                log_pmf = log_C_n2_y + log_beta_term - log_beta_ab_prime\n                total_prob += np.exp(log_pmf)\n            \n            memo_pps[x] = total_prob\n            return total_prob\n\n        # Search for futility boundary c\n        c = -1\n        for x in range(n1, -1, -1):\n            pps_val = get_pps(x, n1, n2, a, b, k_star)\n            if pps_val  gamma_thresh:\n                c = x\n                break\n\n        # Part 4: Quantify expected sample size and savings\n        if c == -1:\n            # No futility boundary found, trial always continues to n\n            prob_stop = 0.0\n        else:\n            # Probability of stopping is Pr(X = c) where X ~ Binomial(n1, p_true)\n            prob_stop = binom.cdf(c, n1, p_true)\n        \n        expected_n = n1 * prob_stop + n * (1 - prob_stop)\n        savings = n - expected_n\n        savings_fraction = savings / n if n > 0 else 0.0\n\n        results.append([int(c), round(expected_n, 6), round(savings, 6), round(savings_fraction, 6)])\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\".replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}