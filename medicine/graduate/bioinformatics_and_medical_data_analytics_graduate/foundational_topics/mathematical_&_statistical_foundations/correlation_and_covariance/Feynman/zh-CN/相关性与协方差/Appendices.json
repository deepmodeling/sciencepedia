{
    "hands_on_practices": [
        {
            "introduction": "数据分析中一个常见的误区是将零相关性等同于统计独立性。本练习将通过构建一个函数上相关但协方差为零的变量对的清晰示例，提供一个动手实践的证明，来揭示这一观点的错误性。理解这一区别对于正确解读统计关系至关重要。",
            "id": "5184658",
            "problem": "在一个人工智能（AI）构建的临床影像生物标志物流程中，假设从一个自监督模型中提取的标准化潜变量特征在一个训练队列中进行了分位数校准，使得标准化潜变量 $X$ 服从 $\\mathrm{Uniform}(-1,1)$ 分布。一个下游工程化生物标志物 $Y$ 通过非线性能量变换 $Y=X^2$ 形成，以提高对学习表示中符号模糊性的鲁棒性。请仅使用适用于数据科学和生物统计学的概率论和测度论统计学的基础定义，推导 $X$ 和 $Y$ 之间的协方差，并论证 $X$ 和 $Y$ 是否独立。你的推导必须从期望、协方差和独立性的核心定义开始，并且不使用任何现成的捷径。\n\n请提供一个完整的论证，证明 $X$ 和 $Y$ 不独立，该论证不应仅依赖于启发式的几何学（例如，不要简单地说“支撑集位于一条曲线上”），而是基于独立性的第一性原理测度论性质，或等价地，通过对可测事件进行显式的条件概率计算来证明。请将协方差的最终数值作为你的答案。无需四舍五入。",
            "solution": "该问题被评估为有效，因为它具有科学依据、良定且客观。它提出了一个概率论中标准的、可形式化的问题，为获得唯一解提供了所有必要信息，没有矛盾或歧义。我们可以开始解题。\n\n该问题要求推导两个随机变量 $X$ 和 $Y$ 之间的协方差，并严格论证它们是否独立。推导过程必须从第一性原理出发。\n\n设 $X$ 是一个在区间 $[-1, 1]$ 上服从均匀分布的随机变量。其概率密度函数（PDF），记为 $f_X(x)$，由下式给出：\n$$ f_X(x) = \\begin{cases} \\frac{1}{1 - (-1)} = \\frac{1}{2}  \\text{for } x \\in [-1, 1] \\\\ 0  \\text{otherwise} \\end{cases} $$\n第二个随机变量 $Y$ 由变换 $Y = X^2$ 定义。\n\n**第一部分：推导协方差 $\\mathrm{Cov}(X,Y)$**\n\n两个随机变量 $X$ 和 $Y$ 之间协方差的定义是：\n$$ \\mathrm{Cov}(X,Y) = E[(X - E[X])(Y - E[Y])] $$\n为了计算方便，这等价于：\n$$ \\mathrm{Cov}(X,Y) = E[XY] - E[X]E[Y] $$\n我们将计算此表达式中的每一项。\n\n首先，我们计算 $X$ 的期望 $E[X]$：\n$$ E[X] = \\int_{-\\infty}^{\\infty} x f_X(x) \\,dx = \\int_{-1}^{1} x \\left(\\frac{1}{2}\\right) \\,dx = \\frac{1}{2} \\int_{-1}^{1} x \\,dx $$\n积分为：\n$$ E[X] = \\frac{1}{2} \\left[ \\frac{x^2}{2} \\right]_{-1}^{1} = \\frac{1}{4} [x^2]_{-1}^{1} = \\frac{1}{4} (1^2 - (-1)^2) = \\frac{1}{4} (1 - 1) = 0 $$\n因此，$E[X] = 0$。这个结果从 $X$ 的均匀分布关于 0 对称的性质中也可以明显看出。\n\n接下来，我们计算 $Y$ 的期望 $E[Y]$。因为 $Y = X^2$，我们有 $E[Y] = E[X^2]$。\n$$ E[Y] = E[X^2] = \\int_{-\\infty}^{\\infty} x^2 f_X(x) \\,dx = \\int_{-1}^{1} x^2 \\left(\\frac{1}{2}\\right) \\,dx = \\frac{1}{2} \\int_{-1}^{1} x^2 \\,dx $$\n积分为：\n$$ E[Y] = \\frac{1}{2} \\left[ \\frac{x^3}{3} \\right]_{-1}^{1} = \\frac{1}{6} [x^3]_{-1}^{1} = \\frac{1}{6} (1^3 - (-1)^3) = \\frac{1}{6} (1 - (-1)) = \\frac{2}{6} = \\frac{1}{3} $$\n因此，$E[Y] = \\frac{1}{3}$。\n\n现在，我们计算乘积 $XY$ 的期望 $E[XY]$。代入 $Y = X^2$：\n$$ E[XY] = E[X \\cdot X^2] = E[X^3] $$\n$$ E[X^3] = \\int_{-\\infty}^{\\infty} x^3 f_X(x) \\,dx = \\int_{-1}^{1} x^3 \\left(\\frac{1}{2}\\right) \\,dx = \\frac{1}{2} \\int_{-1}^{1} x^3 \\,dx $$\n被积函数 $x^3$ 是一个奇函数，积分区间 $[-1, 1]$ 关于原点对称。因此，积分为零。具体计算如下：\n$$ E[X^3] = \\frac{1}{2} \\left[ \\frac{x^4}{4} \\right]_{-1}^{1} = \\frac{1}{8} [x^4]_{-1}^{1} = \\frac{1}{8} (1^4 - (-1)^4) = \\frac{1}{8} (1 - 1) = 0 $$\n因此，$E[XY] = 0$。\n\n最后，我们将这些期望值代入协方差公式：\n$$ \\mathrm{Cov}(X,Y) = E[XY] - E[X]E[Y] = 0 - (0)\\left(\\frac{1}{3}\\right) = 0 $$\n$X$ 和 $Y$ 之间的协方差为 $0$。这表明 $X$ 和 $Y$ 是不相关的。\n\n**第二部分：独立性检验**\n\n两个随机变量 $X$ 和 $Y$ 被定义为独立的，当且仅当对于所有可测集（Borel 集）$A, B \\subset \\mathbb{R}$，以下条件成立：\n$$ P(X \\in A, Y \\in B) = P(X \\in A) P(Y \\in B) $$\n如果我们能找到哪怕只有一对集合 $A$ 和 $B$ 使该等式不成立，那么这两个变量就不是独立的。我们将通过构造这样一个反例来证明其不独立性。\n\n让我们选择以下事件（可测集）：\n- 令 $A$ 为区间 $(0.5, 1]$，使得事件为 $\\{X \\in (0.5, 1]\\}$。\n- 令 $B$ 为区间 $(0.5, 1]$，使得事件为 $\\{Y \\in (0.5, 1]\\}$。\n\n首先，我们计算各自的概率。\n事件 $\\{X \\in A\\}$ 的概率是：\n$$ P(X \\in A) = P(0.5  X \\le 1) = \\int_{0.5}^{1} f_X(x) \\,dx = \\int_{0.5}^{1} \\frac{1}{2} \\,dx = \\frac{1}{2} [x]_{0.5}^{1} = \\frac{1}{2}(1 - 0.5) = \\frac{0.5}{2} = \\frac{1}{4} $$\n\n为了计算事件 $\\{Y \\in B\\}$ 的概率，我们首先确定与此事件对应的 $X$ 值的范围。\n事件 $\\{Y \\in B\\}$ 等价于 $\\{0.5  Y \\le 1\\}$，即 $\\{0.5  X^2 \\le 1\\}$。\n该不等式在 $\\sqrt{0.5}  X \\le 1$ 或 $-1 \\le X  -\\sqrt{0.5}$ 时成立。我们将 $\\sqrt{0.5}$ 记为 $1/\\sqrt{2}$。\n$$ P(Y \\in B) = P(\\{X \\in [-1, -1/\\sqrt{2})\\} \\cup \\{X \\in (1/\\sqrt{2}, 1]\\}) $$\n由于这两个关于 $X$ 的区间是不相交的，我们可以将它们的概率相加：\n$$ P(Y \\in B) = \\int_{-1}^{-1/\\sqrt{2}} \\frac{1}{2} \\,dx + \\int_{1/\\sqrt{2}}^{1} \\frac{1}{2} \\,dx = \\frac{1}{2} (-1/\\sqrt{2} - (-1)) + \\frac{1}{2} (1 - 1/\\sqrt{2}) $$\n$$ P(Y \\in B) = \\frac{1}{2} (1 - 1/\\sqrt{2}) + \\frac{1}{2} (1 - 1/\\sqrt{2}) = 1 - \\frac{1}{\\sqrt{2}} $$\n各自概率的乘积为：\n$$ P(X \\in A) P(Y \\in B) = \\frac{1}{4} \\left(1 - \\frac{1}{\\sqrt{2}}\\right) $$\n\n现在，我们计算联合概率 $P(X \\in A, Y \\in B)$。\n这对应于事件 $\\{X \\in (0.5, 1]\\} \\cap \\{Y \\in (0.5, 1]\\}$。\n代入 $Y$ 的定义，即为 $\\{X \\in (0.5, 1]\\} \\cap \\{X^2 \\in (0.5, 1]\\}$。\n条件 $X^2 \\in (0.5, 1]$ 意味着 $X \\in [-1, -1/\\sqrt{2}) \\cup (1/\\sqrt{2}, 1]$。\n联合事件是 $X$ 的集合的交集：\n$$ (0.5, 1] \\cap ([-1, -1/\\sqrt{2}) \\cup (1/\\sqrt{2}, 1]) $$\n因为 $1/\\sqrt{2} \\approx 0.707$，大于 $0.5$。该交集可简化为：\n$$ (1/\\sqrt{2}, 1] $$\n所以，联合概率为：\n$$ P(X \\in A, Y \\in B) = P(X \\in (1/\\sqrt{2}, 1]) = \\int_{1/\\sqrt{2}}^{1} \\frac{1}{2} \\,dx = \\frac{1}{2} [x]_{1/\\sqrt{2}}^{1} = \\frac{1}{2} \\left(1 - \\frac{1}{\\sqrt{2}}\\right) $$\n\n最后，我们将联合概率与边缘概率的乘积进行比较：\n$$ P(X \\in A, Y \\in B) = \\frac{1}{2} \\left(1 - \\frac{1}{\\sqrt{2}}\\right) $$\n$$ P(X \\in A) P(Y \\in B) = \\frac{1}{4} \\left(1 - \\frac{1}{\\sqrt{2}}\\right) $$\n显然，\n$$ \\frac{1}{2} \\left(1 - \\frac{1}{\\sqrt{2}}\\right) \\neq \\frac{1}{4} \\left(1 - \\frac{1}{\\sqrt{2}}\\right) $$\n因为我们找到了一个事件对，使得 $P(X \\in A, Y \\in B) \\neq P(X \\in A)P(Y \\in B)$，我们得出结论：$X$ 和 $Y$ 不独立。\n\n这个例子说明了一个关键原则：零协方差（不相关性）并不意味着独立性，除非变量是联合正态分布的（此例并非如此）。关系 $Y=X^2$ 是一种确定性的非线性依赖关系，这种关系无法被用于检测线性关系的协方差度量所捕捉。知道 $Y$ 的值会限制 $X$ 的可能取值（例如，如果 $Y=1/4$，那么 $X$ 必须是 $1/2$ 或 $-1/2$），这正是统计依赖的本质。我们的形式化证明严格地证实了这一点。\n\n所要求的最终答案是协方差的数值。\n$$ \\mathrm{Cov}(X,Y) = 0 $$",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "生物数据常常表现出非线性关系、存在离群值和偏态分布，这使得选择合适的关联度量变得复杂。这个编程实践将挑战你在各种现实场景下，比较皮尔逊（Pearson）和斯皮尔曼（Spearman）相关性在原始数据和对数转换数据上的表现。掌握这一技能将使你能够为自己的数据选择最稳健、信息最丰富的分析方法。",
            "id": "4550272",
            "problem": "您正在分析匹配样本中成对的代谢物丰度测量值。许多代谢物呈现右偏、近似对数正态的分布，且代谢物之间的关系可能是乘性的。您的任务是量化两种代谢物在进行自然对数变换（使用一个小的伪计数来处理零值）前后的关联性，并从第一性原理出发，推断在不同数据生成机制下关联性度量的观察变化。\n\n您必须实现一个程序，为每个指定的测试用例计算以下四个量：\n- 原始尺度上的标准样本皮尔逊相关系数，\n- 原始尺度上的标准样本斯皮尔曼等级相关系数，\n- 对数变换尺度上的标准样本皮尔逊相关系数，以及\n- 对数变换尺度上的标准样本斯皮尔曼等级相关系数。\n\n对数变换必须定义为在每个值上加上一个伪计数 $\\varepsilon$ 后取自然对数，即 $z \\mapsto \\log(z + \\varepsilon)$，其中 $\\varepsilon = 10^{-6}$。在计算斯皮尔曼等级相关系数时，若存在并列排名，必须使用平均等级。\n\n对于每个测试用例，您会得到一对严格非负的实数向量 $\\mathbf{x}$ 和 $\\mathbf{y}$，它们代表了匹配样本中两种代谢物的丰度。所有条目都使用任意但一致的浓度单位，并且是正实数，除非明确指定为零。\n\n计算并返回相关系数，四舍五入到 $6$ 位小数。您的程序应生成单行输出，其中包含一个结果列表，每个测试用例对应一个内部列表，并按下面给出的顺序排列。每个内部列表的形式必须是 $[\\rho_{\\text{Pearson, raw}}, \\rho_{\\text{Spearman, raw}}, \\rho_{\\text{Pearson, log}}, \\rho_{\\text{Spearman, log}}]$，其中每个条目都是一个四舍五入到 $6$ 位小数的浮点数。最终输出必须是单行：一个由这些内部列表组成的逗号分隔列表，并用方括号括起来，例如 $[[a,b,c,d],[e,f,g,h],\\dots]$。\n\n测试套件：\n- 用例 A（乘性、右偏、近似幂律关系）：设\n$\\mathbf{x}_A = [\\,0.2,\\,0.3,\\,0.5,\\,0.8,\\,1.2,\\,1.8,\\,2.5,\\,3.5,\\,5.0,\\,7.5,\\,10.0,\\,15.0\\,]$，并按分量定义 $\\mathbf{y}_A$ 为\n$y_{A,i} = 0.5 \\cdot x_{A,i}^{0.9} \\cdot \\eta_i$，其中\n$\\boldsymbol{\\eta} = [\\,1.05,\\,0.95,\\,1.1,\\,1.02,\\,0.9,\\,1.1,\\,1.05,\\,0.92,\\,1.08,\\,1.0,\\,1.12,\\,0.9\\,]$。\n- 用例 B（低丰度下含零值的加性线性关系）：设\n$\\mathbf{x}_B = [\\,0.0,\\,0.0,\\,0.1,\\,0.2,\\,0.4,\\,0.8,\\,1.6,\\,3.2,\\,6.4,\\,12.8\\,]$，并定义\n$\\mathbf{y}_B = [\\,0.05 + 2x_{B,i}\\,]_{i=1}^{10}$，即对于每个索引 $i$，$y_{B,i} = 0.05 + 2 x_{B,i}$。\n- 用例 C（带轻微乘性噪声的反比乘性关系）：设\n$\\mathbf{x}_C = [\\,0.5,\\,0.8,\\,1.0,\\,1.5,\\,2.0,\\,3.0,\\,5.0,\\,8.0,\\,13.0\\,]$，并按分量定义 $\\mathbf{y}_C$ 为\n$y_{C,i} = \\dfrac{3.0}{x_{C,i}} \\cdot \\zeta_i$，其中\n$\\boldsymbol{\\zeta} = [\\,1.02,\\,0.98,\\,1.05,\\,1.0,\\,0.95,\\,1.1,\\,0.9,\\,1.05,\\,0.97\\,]$。\n- 用例 D（原始尺度上由异常值驱动的表观线性关系）：设\n$\\mathbf{x}_D = [\\,0.95,\\,1.02,\\,1.10,\\,0.98,\\,1.05,\\,1.08,\\,1.12,\\,1.00,\\,50.0,\\,40.0,\\,0.97,\\,1.03\\,]$ 且\n$\\mathbf{y}_D = [\\,1.10,\\,0.90,\\,1.05,\\,1.02,\\,0.95,\\,1.08,\\,0.97,\\,1.00,\\,100.0,\\,95.0,\\,1.04,\\,0.96\\,]$。\n\n要求与约束：\n- 仅使用源于基本统计定义的均值、方差、协方差、皮尔逊相关系数和斯皮尔曼等级相关系数的标准样本定义。\n- 对所有用例，使用自然对数进行变换，并使用伪计数 $\\varepsilon = 10^{-6}$。\n- 将每个报告的相关系数四舍五入到 $6$ 位小数。\n- 您的程序应精确地生成一行输出，其中包含一个含有 $4$ 个内部列表的列表，每个内部列表按规定包含 $4$ 个浮点数，并按照 A、B、C、D 的顺序排列。\n\n预期的科学推理目标是确定相关性度量在生物信息学和医学数据分析的代谢组学中常见的偏态、乘性、加性、反比和含异常值的数据情景下的行为。计算中不要包含任何物理单位转换；输出中不应使用任何明确的物理单位。最终输出必须严格遵守上述单行格式，除了有效的 Python 列表语法所必需的空格外，不得包含额外的文本或空白字符。",
            "solution": "问题陈述已经过严格审查，并被确定为有效。它在科学上基于标准统计学原理，问题定义明确，提供了所有必要信息，并且表述客观。该问题提出了一个定义清晰的计算任务，旨在探索与生物信息学和医学数据分析相关的相关性与数据变换的基本概念。因此，我们可以着手提供一个完整的解决方案。\n\n这个问题的核心是分析两种标准统计关联度量——皮尔逊积矩相关系数和斯皮尔曼等级相关系数——在不同数据生成模型下以及应用对数变换后的行为。\n\n### 1. 理论基础\n\n我们首先定义需要计算的量。给定两个大小为 $n$ 的成对样本向量 $\\mathbf{x} = (x_1, x_2, \\dots, x_n)$ 和 $\\mathbf{y} = (y_1, y_2, \\dots, y_n)$。\n\n**样本皮尔逊相关系数**（表示为 $\\rho_P$）衡量两个变量之间线性关系的强度和方向。它定义为两个变量的协方差除以它们标准差的乘积：\n$$ \\rho_P(\\mathbf{x}, \\mathbf{y}) = \\frac{\\sum_{i=1}^{n}(x_i - \\bar{x})(y_i - \\bar{y})}{\\sqrt{\\sum_{i=1}^{n}(x_i - \\bar{x})^2} \\sqrt{\\sum_{i=1}^{n}(y_i - \\bar{y})^2}} $$\n其中 $\\bar{x}$ 和 $\\bar{y}$ 分别是 $\\mathbf{x}$ 和 $\\mathbf{y}$ 的样本均值。$\\rho_P$ 的取值范围是 $-1$ 到 $+1$，其中 $+1$ 表示完全正线性关系，$-1$ 表示完全负线性关系，而 $0$ 表示没有线性关系。皮尔逊相关系数对异常值敏感，并且不能有效捕捉非线性关联，即使它们是单调的。\n\n**样本斯皮尔曼等级相关系数**（表示为 $\\rho_S$）衡量两个变量之间单调关系的强度和方向。它被定义为等级变换后变量的皮尔逊相关系数。设 $R(\\mathbf{x}) = (R(x_1), \\dots, R(x_n))$ 和 $R(\\mathbf{y}) = (R(y_1), \\dots, R(y_n))$ 分别是 $\\mathbf{x}$ 和 $\\mathbf{y}$ 的等级向量。对于并列值，分配平均等级。斯皮尔曼相关系数则为：\n$$ \\rho_S(\\mathbf{x}, \\mathbf{y}) = \\rho_P(R(\\mathbf{x}), R(\\mathbf{y})) $$\n由于 $\\rho_S$ 是基于等级计算的，因此它对异常值具有稳健性，并且可以完美地捕捉任何单调关系（例如指数关系、对数关系），从而得到 $+1$ 或 $-1$ 的值。\n\n指定的**对数变换**是 $z \\mapsto \\log(z + \\varepsilon)$，其中 $\\log$ 是自然对数，$\\varepsilon = 10^{-6}$ 是一个小的伪计数。这种变换常用于右偏数据（如代谢物丰度），主要有两个原因：\n1. 它降低了大数值（异常值）的影响，使分布更加对称。\n2. 它能将乘性关系线性化。如果 $y = c \\cdot x^k \\cdot \\eta$，那么 $\\log(y) = \\log(c) + k \\log(x) + \\log(\\eta)$，这是 $\\log(y)$ 和 $\\log(x)$ 之间的线性关系。\n\n斯皮尔曼相关系数的性质带来了一个关键特性。由于自然对数是一个严格单调递增的函数，变换 $z \\mapsto \\log(z+\\varepsilon)$ 会保留数据点的顺序。也就是说，如果 $x_i > x_j$，那么 $\\log(x_i+\\varepsilon) > \\log(x_j+\\varepsilon)$。因此，任何数据点的等级在变换后保持不变：$R(x_i) = R(\\log(x_i+\\varepsilon))$。这意味着在原始数据上计算的斯皮尔曼相关系数将与在对数变换后的数据上计算的斯皮尔曼相关系数完全相同：\n$$ \\rho_S(\\mathbf{x}, \\mathbf{y}) = \\rho_S(\\log(\\mathbf{x}+\\varepsilon), \\log(\\mathbf{y}+\\varepsilon)) $$\n我们的计算必须反映这一恒等关系。\n\n### 2. 测试用例分析\n\n现在我们将应用这些原理来预测和解释每个用例的结果。\n\n**用例 A：乘性、右偏关系**\n数据由 $y_{A,i} = 0.5 \\cdot x_{A,i}^{0.9} \\cdot \\eta_i$ 生成。这是一个带有乘性噪声的非线性幂律关系。该关系是强单调且正向的。\n-   **原始尺度**：该关系是非线性的，因此 $\\rho_{\\text{Pearson, raw}}$ 会很高但小于 $1$。等级几乎可以完美捕捉这种单调关系，所以 $\\rho_{\\text{Spearman, raw}}$ 会非常接近 $1$。\n-   **对数变换尺度**：应用对数变换得到 $\\log(y_{A,i}) = \\log(0.5) + 0.9\\log(x_{A,i}) + \\log(\\eta_i)$。这是 $\\log(y_A)$ 和 $\\log(x_A)$ 之间带有一些噪声的线性关系。因此，预计 $\\rho_{\\text{Pearson, log}}$ 将高于原始尺度上的值，并非常接近 $1$。如前所述，$\\rho_{\\text{Spearman, log}}$ 将与 $\\rho_{\\text{Spearman, raw}}$ 完全相同。\n\n**用例 B：带零值的加性线性关系**\n数据由 $y_{B,i} = 0.05 + 2 x_{B,i}$ 生成。这是一个完美的线性关系。向量 $\\mathbf{x}_B$ 包含两个零值，需要使用伪计数进行对数变换。\n-   **原始尺度**：关系是完美的线性和单调的。因此，$\\rho_{\\text{Pearson, raw}}$ 和 $\\rho_{\\text{Spearman, raw}}$ 都必须恰好是 $1.0$。\n-   **对数变换尺度**：对数变换 $\\log(y) = \\log(0.05 + 2x)$ 相对于 $\\log(x)$ 不再是线性的。该变换破坏了完美的线性关系。因此，$\\rho_{\\text{Pearson, log}}$ 将小于 $1$。关系仍然是单调的，所以等级被保留。因此，$\\rho_{\\text{Spearman, log}}$ 将保持为 $1.0$。\n\n**用例 C：反比乘性关系**\n数据由 $y_{C,i} = \\frac{3.0}{x_{C,i}} \\cdot \\zeta_i$ 生成。这是一个非线性的、反向单调的关系。\n-   **原始尺度**：关系 $y \\propto 1/x$ 是一条双曲线，是非线性的。$\\rho_{\\text{Pearson, raw}}$ 将为负值，但不等于 $-1$。该关系是完全（反向）单调的，所以 $\\rho_{\\text{Spearman, raw}}$ 将非常接近 $-1$。\n-   **对数变换尺度**：变换得到 $\\log(y_{C,i}) = \\log(3.0) - 1.0\\log(x_{C,i}) + \\log(\\zeta_i)$。这是 $\\log(y_C)$ 和 $\\log(x_C)$ 之间斜率为负的线性关系。因此，预计 $\\rho_{\\text{Pearson, log}}$ 将非常接近 $-1$。$\\rho_{\\text{Spearman, log}}$ 将与 $\\rho_{\\text{Spearman, raw}}$ 完全相同。\n\n**用例 D：由异常值驱动的表观线性关系**\n该数据集包含一团没有明显相关性的点和两个落在一条正斜率直线上的极端异常值。\n-   **原始尺度**：两个异常值对 $(50.0, 100.0)$ 和 $(40.0, 95.0)$ 将对皮尔逊相关系数的计算产生巨大的杠杆作用，将相关系数拉向一个很高的正值。相比之下，斯皮尔曼相关系数基于等级，对此类异常值具有稳健性。它将反映大部分数据中缺乏单调趋势的情况，导致 $\\rho_{\\text{Spearman, raw}}$ 值较低。\n-   **对数变换尺度**：对数变换会显著压缩异常值（例如，$\\log(50) \\approx 3.9$ 对比 $\\log(1) = 0$），从而减小它们的杠杆作用。变换后，数据将更像一团点云，之前很高的 $\\rho_{\\text{Pearson, log}}$ 将显著下降。$\\rho_{\\text{Spearman, log}}$ 将与原始尺度上的值保持一致，反映其固有的稳健性。\n\n### 3. 计算实现\n\n实现将首先为每个测试用例定义数据。对于每个用例，我们将计算原始向量和对数变换后的向量。我们将使用 `numpy.corrcoef` 来计算皮尔逊相关系数。对于斯皮尔曼相关系数，我们将首先使用 `scipy.stats.rankdata` 并设置 `method='average'` 以处理并列排名来获取数据的等级，然后计算所得等级向量的皮尔逊相关系数。最终结果将四舍五入到 $6$ 位小数，并按指定格式输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import rankdata\n\ndef solve():\n    \"\"\"\n    Solves the correlation analysis problem for the given test cases.\n    \"\"\"\n    \n    # Define the pseudocount for the log-transformation.\n    EPSILON = 1e-6\n\n    # Test Case Definitions\n    # Case A\n    x_A = np.array([0.2, 0.3, 0.5, 0.8, 1.2, 1.8, 2.5, 3.5, 5.0, 7.5, 10.0, 15.0])\n    eta = np.array([1.05, 0.95, 1.1, 1.02, 0.9, 1.1, 1.05, 0.92, 1.08, 1.0, 1.12, 0.9])\n    y_A = 0.5 * x_A**0.9 * eta\n\n    # Case B\n    x_B = np.array([0.0, 0.0, 0.1, 0.2, 0.4, 0.8, 1.6, 3.2, 6.4, 12.8])\n    y_B = 0.05 + 2 * x_B\n\n    # Case C\n    x_C = np.array([0.5, 0.8, 1.0, 1.5, 2.0, 3.0, 5.0, 8.0, 13.0])\n    zeta = np.array([1.02, 0.98, 1.05, 1.0, 0.95, 1.1, 0.9, 1.05, 0.97])\n    y_C = 3.0 / x_C * zeta\n\n    # Case D\n    x_D = np.array([0.95, 1.02, 1.10, 0.98, 1.05, 1.08, 1.12, 1.00, 50.0, 40.0, 0.97, 1.03])\n    y_D = np.array([1.10, 0.90, 1.05, 1.02, 0.95, 1.08, 0.97, 1.00, 100.0, 95.0, 1.04, 0.96])\n\n    test_cases = [\n        (x_A, y_A),\n        (x_B, y_B),\n        (x_C, y_C),\n        (x_D, y_D)\n    ]\n\n    def pearson_corr(x, y):\n        \"\"\"Computes the sample Pearson correlation coefficient.\"\"\"\n        # Use np.corrcoef which is numerically stable.\n        # It returns a 2x2 matrix, the value is at [0,1] or [1,0].\n        with np.errstate(invalid='ignore'): # Handles cases with zero variance\n            corr_matrix = np.corrcoef(x, y)\n        if np.isnan(corr_matrix).all():\n            return 0.0 # Or handle as per definition for constant vectors\n        return corr_matrix[0, 1]\n\n    def spearman_corr(x, y):\n        \"\"\"Computes the sample Spearman rank correlation coefficient.\"\"\"\n        # Rank the data, using 'average' for ties as specified.\n        rank_x = rankdata(x, method='average')\n        rank_y = rankdata(y, method='average')\n        # Spearman correlation is the Pearson correlation of the ranks.\n        return pearson_corr(rank_x, rank_y)\n\n    results = []\n    for x_raw, y_raw in test_cases:\n        # 1. Pearson correlation on raw scale\n        rho_p_raw = pearson_corr(x_raw, y_raw)\n\n        # 2. Spearman correlation on raw scale\n        rho_s_raw = spearman_corr(x_raw, y_raw)\n        \n        # Perform the log transformation\n        x_log = np.log(x_raw + EPSILON)\n        y_log = np.log(y_raw + EPSILON)\n        \n        # 3. Pearson correlation on log-transformed scale\n        rho_p_log = pearson_corr(x_log, y_log)\n\n        # 4. Spearman correlation on log-transformed scale\n        # As explained in the solution, this is equivalent to the raw Spearman\n        # correlation because log is monotonic. We compute it explicitly.\n        rho_s_log = spearman_corr(x_log, y_log)\n        \n        case_results = [\n            round(rho_p_raw, 6),\n            round(rho_s_raw, 6),\n            round(rho_p_log, 6),\n            round(rho_s_log, 6)\n        ]\n        results.append(case_results)\n\n    # Format the final output string as specified.\n    # e.g., [[a,b,c,d],[e,f,g,h]]\n    # Using map(str, r) for each sublist isn't quite right for the final\n    # python list literal format. The example implies the brackets are part of the string.\n    # The requirement is a single line string that is a valid Python list of lists.\n    # `str(results)` produces the correct format but might have spacing differences.\n    # A robust way is to build the string manually.\n    \n    outer_list_str = []\n    for inner_list in results:\n        # Convert each float in the inner list to a string\n        inner_list_str = f\"[{','.join(map(str, inner_list))}]\"\n        outer_list_str.append(inner_list_str)\n    \n    final_output = f\"[{','.join(outer_list_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "在复杂的生物系统中，两个变量间的简单相关性可能具有误导性，因为它可能源于一个共同的原因（即混淆）。本练习将介绍偏相关性的概念，帮助你滤除此类间接影响，并识别直接关系。你将构建并比较边际相关网络和偏相关网络，这是进行因果推断和网络生物学分析的一项基础技能。",
            "id": "4550410",
            "problem": "一项关于代谢性炎症的队列研究收集了 $n$ 名独立参与者的四个变量的标准化测量值：脂肪组织中的炎性细胞因子白细胞介素-6（interleukin-6）信使核糖核酸（mRNA）表达水平（$X_1$），血浆中的C-反应蛋白（C-reactive protein, CRP）浓度（$X_2$），身体质量指数（$X_3$），以及胰岛素抵抗稳态模型评估（Homeostatic Model Assessment of Insulin Resistance, HOMA-IR）（$X_4$）。假设 $\\{X_1, X_2, X_3, X_4\\}$ 的联合分布是均值为零、相关矩阵为 $R$ 的多元正态分布。经验估计的相关矩阵（为了便于阅读，非对角线元素四舍五入到两位小数）为\n$$\nR \\;=\\;\n\\begin{pmatrix}\n1  0.70  0.30  0.25 \\\\\n0.70  1  0.40  0.35 \\\\\n0.30  0.40  1  0.65 \\\\\n0.25  0.35  0.65  1\n\\end{pmatrix}.\n$$\n仅使用协方差、相关性以及逆协方差（精度）矩阵性质的核心定义，完成以下任务：\n1. 通过将每对关联以其余变量为条件，计算由 $R$ 所隐含的偏相关矩阵。\n2. 在节点 $\\{X_1, X_2, X_3, X_4\\}$ 上构建两个无向网络：\n   (i) 一个边际相关网络，当且仅当 $|r_{ij}|  \\tau$ 时，$X_i$ 和 $X_j$ 之间存在一条边，\n   以及\n   (ii) 一个偏相关网络，当且仅当 $|\\rho_{ij\\cdot \\text{rest}}|  \\tau$ 时，$X_i$ 和 $X_j$ 之间存在一条边，\n   其中 $\\tau = 0.30$。\n3. 通过计算两个边集的 Jaccard 指数来比较这两个边集，Jaccard 指数定义为它们的交集大小除以并集大小。将你的答案四舍五入到四位有效数字。\n\n简要地，根据与多元正态图模型一致的混杂或中介作用，解释为什么在边际相关网络中存在但在偏相关网络中缺失的任何边可能会出现。你最终报告的量必须是 Jaccard 指数的单个数值，四舍五入到四位有效数字。",
            "solution": "该问题具有科学依据，提法明确，并包含了推导出唯一解所需的所有信息。所提供的相关矩阵是对称的，对角线元素为1，并且是正定的，这证实了其有效性。因此，我们可以开始解题。\n\n该问题要求计算偏相关矩阵，构建两个网络，并使用 Jaccard 指数比较它们的边集。变量表示为 $X_1, X_2, X_3, X_4$。\n\n对于一组服从多元正态分布的变量，两个变量 $X_i$ 和 $X_j$ 在给定所有其他变量（表示为“rest”）的条件下的偏相关性，与相关矩阵的逆矩阵 $P = R^{-1}$ 的元素直接相关。这个逆矩阵 $P$ 也被称为精度矩阵。偏相关 $\\rho_{ij \\cdot \\text{rest}}$ 的计算公式为：\n$$ \\rho_{ij \\cdot \\text{rest}} = - \\frac{p_{ij}}{\\sqrt{p_{ii} p_{jj}}} $$\n其中 $p_{ij}$ 是精度矩阵 $P$ 的第 $i$ 行和第 $j$ 列的元素。\n\n给定的相关矩阵 $R$ 是：\n$$\nR \\;=\\;\n\\begin{pmatrix}\n1  0.70  0.30  0.25 \\\\\n0.70  1  0.40  0.35 \\\\\n0.30  0.40  1  0.65 \\\\\n0.25  0.35  0.65  1\n\\end{pmatrix}\n$$\n首先，我们计算 $R$ 的逆矩阵以获得精度矩阵 $P = R^{-1}$。执行矩阵求逆运算得出：\n$$\nP \\;\\approx\\;\n\\begin{pmatrix}\n2.1557  -1.6186  0.1802  0.0405 \\\\\n-1.6186  2.5401  -0.5269  -0.1985 \\\\\n0.1802  -0.5269  1.8315  -1.0425 \\\\\n0.0405  -0.1985  -1.0425  1.7088\n\\end{pmatrix}\n$$\n现在，我们将偏相关公式应用于每个非对角线元素。例如，对于对 $(X_1, X_2)$：\n$$ \\rho_{12 \\cdot 34} = - \\frac{p_{12}}{\\sqrt{p_{11} p_{22}}} \\approx - \\frac{-1.6186}{\\sqrt{(2.1557)(2.5401)}} \\approx 0.6917 $$\n对所有变量对重复此过程，我们构建了偏相关矩阵，其中每对相关性都是以其余两个变量为条件的：\n$$\n\\rho_{\\cdot\\text{rest}} \\;\\approx\\;\n\\begin{pmatrix}\n1  0.6917  -0.0907  -0.0211 \\\\\n0.6917  1  0.2443  0.0953 \\\\\n-0.0907  0.2443  1  0.5893 \\\\\n-0.0211  0.0953  0.5893  1\n\\end{pmatrix}\n$$\n下一步是使用阈值 $\\tau = 0.30$ 在节点集 $V = \\{X_1, X_2, X_3, X_4\\}$ 上构建两个网络。\n\n边际相关网络有一个边集 $E_M$，当且仅当边际相关性的绝对值 $|r_{ij}|$ 大于 $0.30$ 时，边 $(X_i, X_j)$ 存在。检查矩阵 $R$：\n- $|r_{12}| = 0.70  0.30 \\implies$ 边 $(X_1, X_2) \\in E_M$\n- $|r_{13}| = 0.30 \\ngtr 0.30 \\implies$ 无边\n- $|r_{14}| = 0.25 \\ngtr 0.30 \\implies$ 无边\n- $|r_{23}| = 0.40  0.30 \\implies$ 边 $(X_2, X_3) \\in E_M$\n- $|r_{24}| = 0.35  0.30 \\implies$ 边 $(X_2, X_4) \\in E_M$\n- $|r_{34}| = 0.65  0.30 \\implies$ 边 $(X_3, X_4) \\in E_M$\n边际网络的边集为 $E_M = \\{(X_1, X_2), (X_2, X_3), (X_2, X_4), (X_3, X_4)\\}$。该集合的大小为 $|E_M| = 4$。\n\n偏相关网络有一个边集 $E_P$，当且仅当偏相关的绝对值 $|\\rho_{ij\\cdot \\text{rest}}|$ 大于 $0.30$ 时，边 $(X_i, X_j)$ 存在。检查矩阵 $\\rho_{\\cdot\\text{rest}}$：\n- $|\\rho_{12 \\cdot 34}| \\approx 0.6917  0.30 \\implies$ 边 $(X_1, X_2) \\in E_P$\n- $|\\rho_{13 \\cdot 24}| \\approx 0.0907 \\ngtr 0.30 \\implies$ 无边\n- $|\\rho_{14 \\cdot 23}| \\approx 0.0211 \\ngtr 0.30 \\implies$ 无边\n- $|\\rho_{23 \\cdot 14}| \\approx 0.2443 \\ngtr 0.30 \\implies$ 无边\n- $|\\rho_{24 \\cdot 13}| \\approx 0.0953 \\ngtr 0.30 \\implies$ 无边\n- $|\\rho_{34 \\cdot 12}| \\approx 0.5893  0.30 \\implies$ 边 $(X_3, X_4) \\in E_P$\n偏相关网络的边集为 $E_P = \\{(X_1, X_2), (X_3, X_4)\\}$。该集合的大小为 $|E_P| = 2$。\n\n在边际网络 $E_M$ 中存在但在偏相关网络 $E_P$ 中缺失的边是 $(X_2, X_3)$ 和 $(X_2, X_4)$。边际相关 $r_{ij}$ 衡量两个变量之间的总关联，而偏相关 $\\rho_{ij \\cdot \\text{rest}}$ 衡量在以所有其他变量为条件（即，进行统计调整）后剩余的关联。在高斯图模型的背景下，偏相关网络代表直接的条件依赖关系。在偏相关网络中，一条缺失的边，例如 $(X_2, X_3)$，意味着在给定 $X_1$ 和 $X_4$ 的条件下，$X_2$ 和 $X_3$ 是条件独立的。观察到的边际相关 ($r_{23} = 0.40$) 并非源于直接关系，而是由其他变量所中介或混杂。例如，CRP ($X_2$) 和 BMI ($X_3$) 之间的相关性很可能是它们与 IL-6 mRNA ($X_1$) 和 HOMA-IR ($X_4$) 共同关系的间接效应。同样的推理也解释了边 $(X_2, X_4)$ 的消失。\n\n最后，我们计算两个边集的 Jaccard 指数 $J$，其定义为它们的交集大小除以并集大小。\n边集的交集是 $E_M \\cap E_P = \\{(X_1, X_2), (X_3, X_4)\\}$。交集的大小为 $|E_M \\cap E_P| = 2$。\n边集的并集是 $E_M \\cup E_P = \\{(X_1, X_2), (X_2, X_3), (X_2, X_4), (X_3, X_4)\\}$。并集的大小为 $|E_M \\cup E_P| = 4$。\nJaccard 指数为：\n$$ J = \\frac{|E_M \\cap E_P|}{|E_M \\cup E_P|} = \\frac{2}{4} = 0.5 $$\n根据要求四舍五入到四位有效数字，结果是 $0.5000$。",
            "answer": "$$\\boxed{0.5000}$$"
        }
    ]
}