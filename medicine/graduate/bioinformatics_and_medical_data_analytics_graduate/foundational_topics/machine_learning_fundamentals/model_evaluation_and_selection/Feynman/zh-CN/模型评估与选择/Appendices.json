{
    "hands_on_practices": [
        {
            "introduction": "概率模型输出的是一个风险评分，但临床决策通常需要一个明确的“是”或“否”的判断。本练习将指导您如何通过设定不同的分类阈值，将连续的概率输出转化为二元预测。通过亲手计算在不同阈值下的灵敏度（sensitivity）和特异度（specificity），您将深刻理解这两者之间的制衡关系，这是评估任何二元分类器性能的基石。",
            "id": "4585247",
            "problem": "一个单阶段二元疾病分类器为每位患者 $i \\in \\{1,\\dots,100\\}$ 输出预测概率 $p_i \\in [0,1]$。一条决策规则规定，如果 $p_i \\ge t$，则患者被预测为阳性，否则预测为阴性。给定100名患者，他们根据相同的预测概率及其真实的二元标签进行了分组。分组如下：\n- 30名患者的$p_i = 0.05$，其中0名为真阳性。\n- 20名患者的$p_i = 0.15$，其中0名为真阳性。\n- 20名患者的$p_i = 0.25$，其中0名为真阳性。\n- 10名患者的$p_i = 0.35$，其中1名为真阳性。\n- 10名患者的$p_i = 0.60$，其中3名为真阳性。\n- 10名患者的$p_i = 0.80$，其中6名为真阳性。\n\n该队列中的疾病患病率为 $\\pi = 0.1$。\n\n使用基于混淆矩阵的灵敏度和特异度的标准定义，计算在阈值 $t=0.2$ 和阈值 $t=0.5$ 时的这两个指标。然后，构建定义为这些阈值间Youden’s $J$ 统计量变化的对比值，其中Youden’s $J$ 统计量是灵敏度与特异度之和减1。将 $J(0.2)-J(0.5)$ 的值报告为一个简化的精确数字。无需四舍五入，最终答案中不应包含单位。",
            "solution": "用户提供的问题已经过严格验证，被认为是自洽、一致且科学合理的。所有必要的数据和定义都已提供，没有矛盾之处。该问题是适定的、客观的，完全属于数据分析中模型评估的范畴。\n\n目标是计算在两个决策阈值 $t=0.2$ 和 $t=0.5$ 之间Youden's $J$ 统计量的变化。Youden's $J$ 统计量定义为 $J = \\text{灵敏度} + \\text{特异度} - 1$。\n\n首先，我们必须确定这100名患者队列中实际阳性和实际阴性的病例总数。数据是根据预测概率分组提供的。让我们汇总真阳性患者的数量。\n- $p_i = 0.05$ 的组：0个阳性病例。\n- $p_i = 0.15$ 的组：0个阳性病例。\n- $p_i = 0.25$ 的组：0个阳性病例。\n- $p_i = 0.35$ 的组：1个阳性病例。\n- $p_i = 0.60$ 的组：3个阳性病例。\n- $p_i = 0.80$ 的组：6个阳性病例。\n\n真阳性患者的总数，用 $P$ 表示，是以下各项之和：\n$$P = 0 + 0 + 0 + 1 + 3 + 6 = 10$$\n队列中的患者总数是各组患者人数之和：$30 + 20 + 20 + 10 + 10 + 10 = 100$。\n真阴性患者的总数，用 $N$ 表示，是患者总数减去真阳性患者总数：\n$$N = 100 - P = 100 - 10 = 90$$\n患病率 $\\pi$ 是 $\\frac{P}{100} = \\frac{10}{100} = 0.1$，这与问题陈述中提供的值相符，证实了数据的一致性。\n\n灵敏度和特异度的定义如下：\n$$ \\text{灵敏度} = \\frac{\\text{真阳性 (TP)}}{\\text{阳性总数 (P)}} $$\n$$ \\text{特异度} = \\frac{\\text{真阴性 (TN)}}{\\text{阴性总数 (N)}} $$\n\n我们现在为每个阈值计算这些指标。\n\n**情况1：阈值 $t = 0.2$**\n\n如果患者的预测概率 $p_i$ 大于或等于 $t=0.2$，则该患者被预测为阳性。满足此标准的组是 $p_i$ 为 $0.25$、$0.35$、$0.60$ 和 $0.80$ 的组。\n\n在此阈值下的真阳性数量 $TP(0.2)$，是这些被预测为阳性的组中真阳性患者的总和：\n$$TP(0.2) = 0 + 1 + 3 + 6 = 10$$\n在 $t=0.2$ 时的灵敏度为：\n$$\\text{灵敏度}(0.2) = \\frac{TP(0.2)}{P} = \\frac{10}{10} = 1$$\n\n如果 $p_i  0.2$，则患者被预测为阴性。满足此标准的组是 $p_i$ 为 $0.05$ 和 $0.15$ 的组。\n真阴性数量 $TN(0.2)$，是这些被预测为阴性的组中真阴性患者的总和。\n- 对于 $p_i = 0.05$ 的组：有30名患者，其中0名为阳性，所以全部30名均为阴性。\n- 对于 $p_i = 0.15$ 的组：有20名患者，其中0名为阳性，所以全部20名均为阴性。\n$$TN(0.2) = 30 + 20 = 50$$\n在 $t=0.2$ 时的特异度为：\n$$\\text{特异度}(0.2) = \\frac{TN(0.2)}{N} = \\frac{50}{90} = \\frac{5}{9}$$\n在 $t=0.2$ 时的Youden's $J$ 统计量为：\n$$J(0.2) = \\text{灵敏度}(0.2) + \\text{特异度}(0.2) - 1 = 1 + \\frac{5}{9} - 1 = \\frac{5}{9}$$\n\n**情况2：阈值 $t = 0.5$**\n\n如果 $p_i \\ge 0.5$，则患者被预测为阳性。满足此标准的组是 $p_i$ 为 $0.60$ 和 $0.80$ 的组。\n在此阈值下的真阳性数量 $TP(0.5)$，是这些组中真阳性患者的总和：\n$$TP(0.5) = 3 + 6 = 9$$\n在 $t=0.5$ 时的灵敏度为：\n$$\\text{灵敏度}(0.5) = \\frac{TP(0.5)}{P} = \\frac{9}{10}$$\n\n如果 $p_i  0.5$，则患者被预测为阴性。满足此标准的组是 $p_i$ 为 $0.05$、$0.15$、$0.25$ 和 $0.35$ 的组。\n真阴性数量 $TN(0.5)$，是这些被预测为阴性的组中真阴性患者的总和。\n- 对于 $p_i = 0.05$ 的组：30名阴性患者。\n- 对于 $p_i = 0.15$ 的组：20名阴性患者。\n- 对于 $p_i = 0.25$ 的组：20名阴性患者。\n- 对于 $p_i = 0.35$ 的组：有10名患者，其中1名为阳性，所以 $10 - 1 = 9$ 名为阴性。\n$$TN(0.5) = 30 + 20 + 20 + 9 = 79$$\n在 $t=0.5$ 时的特异度为：\n$$\\text{特异度}(0.5) = \\frac{TN(0.5)}{N} = \\frac{79}{90}$$\n在 $t=0.5$ 时的Youden's $J$ 统计量为：\n$$J(0.5) = \\text{灵敏度}(0.5) + \\text{特异度}(0.5) - 1 = \\frac{9}{10} + \\frac{79}{90} - 1$$\n为了合并这些项，我们找到一个公分母，即 $90$：\n$$J(0.5) = \\frac{9 \\times 9}{10 \\times 9} + \\frac{79}{90} - \\frac{90}{90} = \\frac{81}{90} + \\frac{79}{90} - \\frac{90}{90} = \\frac{81 + 79 - 90}{90} = \\frac{160 - 90}{90} = \\frac{70}{90} = \\frac{7}{9}$$\n\n**最终计算**\n\n问题要求计算对比值 $J(0.2) - J(0.5)$。\n$$J(0.2) - J(0.5) = \\frac{5}{9} - \\frac{7}{9} = \\frac{5-7}{9} = -\\frac{2}{9}$$\n结果是一个精确的、简化的分数。",
            "answer": "$$\\boxed{-\\frac{2}{9}}$$"
        },
        {
            "introduction": "受试者工作特征曲线下面积（Area Under the Receiver Operating Characteristic, AUROC）是衡量模型排序能力的黄金标准，但它是否能完全代表模型的临床实用价值？本练习设计了一个巧妙的场景，挑战了“AUROC至上”的观念。您将分析两个AUROC完全相同的模型，并发现它们能达到的最大$F_1$分数却有所不同，从而揭示出预测分数的分布如何影响模型在实际应用中的最佳性能。",
            "id": "4585277",
            "problem": "一个临床信息学团队正在评估两种用于从电子健康记录中早期检测脓毒性休克的概率性二元分类器。在一个由 $N=10$ 名成人重症监护室患者组成的队列中，真实标签是固定的，其中 $Y_i \\in \\{0,1\\}$ 表示患者 $i$ 的脓毒性休克 ($1$) 或非休克 ($0$) 状态。标签为：$Y_1=1$, $Y_2=1$, $Y_3=0$, $Y_4=1$, $Y_5=0$, $Y_6=1$, $Y_7=0$, $Y_8=0$, $Y_9=0$, $Y_{10}=1$，因此有 $m=5$ 个阳性样本和 $n=5$ 个阴性样本。\n\n两个模型产生风险评分，这些评分被解释为预测概率：\n- 模型 $\\mathrm{A}$ 过度自信，其输出为 $s^{(\\mathrm{A})}_1=0.98$, $s^{(\\mathrm{A})}_2=0.92$, $s^{(\\mathrm{A})}_3=0.83$, $s^{(\\mathrm{A})}_4=0.79$, $s^{(\\mathrm{A})}_5=0.72$, $s^{(\\mathrm{A})}_6=0.68$, $s^{(\\mathrm{A})}_7=0.55$, $s^{(\\mathrm{A})}_8=0.51$, $s^{(\\mathrm{A})}_9=0.44$, $s^{(\\mathrm{A})}_{10}=0.37$，反映了明显的分数分离。\n- 模型 $\\mathrm{B}$ 较为保守，并更好地校准到患病率，其分数为压缩的：$s^{(\\mathrm{B})}_1=0.88$, $s^{(\\mathrm{B})}_2=0.78$, $s^{(\\mathrm{B})}_3=0.81$, $s^{(\\mathrm{B})}_4=0.80$, $s^{(\\mathrm{B})}_5=0.79$, $s^{(\\mathrm{B})}_6=0.77$, $s^{(\\mathrm{B})}_7=0.76$, $s^{(\\mathrm{B})}_8=0.74$, $s^{(\\mathrm{B})}_9=0.73$, $s^{(\\mathrm{B})}_{10}=0.75$，因此分数降序对应的患者索引顺序是 $\\{1,3,4,5,2,6,7,10,8,9\\}$。\n\n使用以下基本定义：\n- 受试者工作特征曲线下面积 (AUROC) 等于随机抽取的阳性样本分数严格高于随机抽取的阴性样本分数的概率，再加上分数相等概率的一半。对于有 $m$ 个阳性样本和 $n$ 个阴性样本的有限样本，它可以计算为 $\\mathrm{AUROC} = \\frac{U}{mn}$，其中 $U$ 是 Mann–Whitney $U$ 统计量，用于计数阳性-阴性一致对的数量（对于分数相等的情况给予二分之一的权重）。\n- 对于一个使用阈值的分类器，$F_1$ 分数为 $F_1 = \\frac{2\\,\\mathrm{TP}}{2\\,\\mathrm{TP}+\\mathrm{FP}+\\mathrm{FN}}$，其中 $\\mathrm{TP}$、$\\mathrm{FP}$ 和 $\\mathrm{FN}$ 分别表示真阳性、假阳性和假阴性。分数上的一个阈值会产生一个基于排名的选择，即选择前 $k$ 个预测为阳性的样本，其中 $k \\in \\{1,2,\\dots,N\\}$，并从分数降序排列的前缀中确定 $(\\mathrm{TP},\\mathrm{FP},\\mathrm{FN})$。\n\n任务：使用 Mann–Whitney $U$ 统计量的排名解释，验证模型 $\\mathrm{A}$ 和 $\\mathrm{B}$ 具有相同的 AUROC，然后确定每个模型在所有阈值下可实现的最大 $F_1$ 分数，最后计算差值 $F_{1,\\max}^{(\\mathrm{B})} - F_{1,\\max}^{(\\mathrm{A})}$。将最终答案表示为单个最简分数。不需要四舍五入。",
            "solution": "该问题需要一个三部分的分析：首先，验证两个模型 $\\mathrm{A}$ 和 $\\mathrm{B}$ 具有相同的受试者工作特征曲线下面积 (AUROC) 值；其次，确定每个模型在所有可能的分类阈值下可实现的最大 $F_1$ 分数；第三，计算这些最大 $F_1$ 分数之间的差值。\n\n真实数据包含 $N=10$ 名患者。真实标签集合为 $\\{Y_1=1, Y_2=1, Y_3=0, Y_4=1, Y_5=0, Y_6=1, Y_7=0, Y_8=0, Y_9=0, Y_{10}=1\\}$。\n这给出了 $m=5$ 个阳性实例（患者 $\\{1, 2, 4, 6, 10\\}$）和 $n=5$ 个阴性实例（患者 $\\{3, 5, 7, 8, 9\\}$）。\n\n## 第一部分：验证相同的 AUROC\n\nAUROC 定义为 $\\frac{U}{mn}$，其中 $U$ 是 Mann–Whitney $U$ 统计量。对于没有分数相等情况的样本，$U$ 是一对阳性实例和阴性实例中，阳性实例得分更高的对数。由于 AUROC 仅取决于分数的排名顺序，我们首先为两个模型确定每个患者的排名，排名 $1$ 为最高分，排名 $10$ 为最低分。\n\n**模型 A：**\n分数 $s_i^{(\\mathrm{A})}$ 是按患者索引 $i=1, 2, \\dots, 10$ 的降序提供的。\n按排名排序的患者索引列表是 $\\{1, 2, 3, 4, 5, 6, 7, 8, 9, 10\\}$。\n对应的真实标签序列是 $\\{Y_1, Y_2, \\dots, Y_{10}\\}$，即 $\\{1, 1, 0, 1, 0, 1, 0, 0, 0, 1\\}$。\n阳性样本（标签 $1$）是患者 $\\{1, 2, 4, 6, 10\\}$。他们的排名是 $\\{1, 2, 4, 6, 10\\}$。\n阴性样本（标签 $0$）是患者 $\\{3, 5, 7, 8, 9\\}$。他们的排名是 $\\{3, 5, 7, 8, 9\\}$。\n\n我们通过对每个阳性实例，分数比它低的（即排名数值更高的）阴性实例的数量进行求和，来计算 $U_A$。\n- 患者 $1$（排名 $1$）：排名高于所有 $5$ 个阴性样本（排名 $3, 5, 7, 8, 9$）。贡献：$5$。\n- 患者 $2$（排名 $2$）：排名高于所有 $5$ 个阴性样本。贡献：$5$。\n- 患者 $4$（排名 $4$）：排名高于 $4$ 个阴性样本（排名 $5, 7, 8, 9$）。贡献：$4$。\n- 患者 $6$（排名 $6$）：排名高于 $3$ 个阴性样本（排名 $7, 8, 9$）。贡献：$3$。\n- 患者 $10$（排名 $10$）：排名高于 $0$ 个阴性样本。贡献：$0$。\n模型 A 的 $U$ 统计量为 $U_A = 5+5+4+3+0=17$。\n模型 A 的 AUROC 为 $\\mathrm{AUROC}_A = \\frac{U_A}{mn} = \\frac{17}{5 \\times 5} = \\frac{17}{25}$。\n\n**模型 B：**\n问题提供了按排名排序的患者索引列表：$\\{1, 3, 4, 5, 2, 6, 7, 10, 8, 9\\}$。\n对应的真实标签序列是 $\\{Y_1, Y_3, Y_4, Y_5, Y_2, Y_6, Y_7, Y_{10}, Y_8, Y_9\\}$，即 $\\{1, 0, 1, 0, 1, 1, 0, 1, 0, 0\\}$。\n阳性样本是患者 $\\{1, 4, 2, 6, 10\\}$。他们的排名是 $\\{1, 3, 5, 6, 8\\}$。\n阴性样本是患者 $\\{3, 5, 7, 8, 9\\}$。他们的排名是 $\\{2, 4, 7, 9, 10\\}$。\n\n我们类似地计算 $U_B$：\n- 患者 $1$（排名 $1$）：排名高于所有 $5$ 个阴性样本（排名 $2, 4, 7, 9, 10$）。贡献：$5$。\n- 患者 $4$（排名 $3$）：排名高于 $4$ 个阴性样本（排名 $4, 7, 9, 10$）。贡献：$4$。\n- 患者 $2$（排名 $5$）：排名高于 $3$ 个阴性样本（排名 $7, 9, 10$）。贡献：$3$。\n- 患者 $6$（排名 $6$）：排名高于 $3$ 个阴性样本（排名 $7, 9, 10$）。贡献：$3$。\n- 患者 $10$（排名 $8$）：排名高于 $2$ 个阴性样本（排名 $9, 10$）。贡献：$2$。\n模型 B 的 $U$ 统计量为 $U_B = 5+4+3+3+2=17$。\n模型 B 的 AUROC 为 $\\mathrm{AUROC}_B = \\frac{U_B}{mn} = \\frac{17}{5 \\times 5} = \\frac{17}{25}$。\n\n因此，我们验证了 $\\mathrm{AUROC}_A = \\mathrm{AUROC}_B = \\frac{17}{25}$。\n\n## 第二部分：可实现的最大 $F_1$ 分数\n\n$F_1$ 分数由 $F_1 = \\frac{2\\,\\mathrm{TP}}{2\\,\\mathrm{TP}+\\mathrm{FP}+\\mathrm{FN}}$ 给出。一个分类阈值对应于从排名列表中选择前 $k$ 名患者，其中 $k \\in \\{1, \\dots, 10\\}$。对于这样的选择，预测为阳性的数量是 $k = \\mathrm{TP}+\\mathrm{FP}$。实际阳性样本的总数固定为 $m = \\mathrm{TP}+\\mathrm{FN} = 5$。\n我们可以将 $F_1$ 分数重写为 $k$ 的函数：\n$$F_1(k) = \\frac{2\\,\\mathrm{TP}(k)}{(\\mathrm{TP}(k)+\\mathrm{FP}(k)) + (\\mathrm{TP}(k)+\\mathrm{FN}(k))} = \\frac{2\\,\\mathrm{TP}(k)}{k + m} = \\frac{2\\,\\mathrm{TP}(k)}{k+5}$$\n其中 $\\mathrm{TP}(k)$ 是排名前 $k$ 的患者中的真阳性数量。我们现在为每个模型计算 $k=1, \\dots, 10$ 时的 $F_1(k)$。\n\n**模型 A：**\n按排名排序的标签序列是 $\\{1, 1, 0, 1, 0, 1, 0, 0, 0, 1\\}$。\n- $k=1$: $\\mathrm{TP}(1)=1$, $F_1(1) = \\frac{2(1)}{1+5} = \\frac{2}{6} = \\frac{1}{3}$。\n- $k=2$: $\\mathrm{TP}(2)=2$, $F_1(2) = \\frac{2(2)}{2+5} = \\frac{4}{7}$。\n- $k=3$: $\\mathrm{TP}(3)=2$, $F_1(3) = \\frac{2(2)}{3+5} = \\frac{4}{8} = \\frac{1}{2}$。\n- $k=4$: $\\mathrm{TP}(4)=3$, $F_1(4) = \\frac{2(3)}{4+5} = \\frac{6}{9} = \\frac{2}{3}$。\n- $k=5$: $\\mathrm{TP}(5)=3$, $F_1(5) = \\frac{2(3)}{5+5} = \\frac{6}{10} = \\frac{3}{5}$。\n- $k=6$: $\\mathrm{TP}(6)=4$, $F_1(6) = \\frac{2(4)}{6+5} = \\frac{8}{11}$。\n- $k=7$: $\\mathrm{TP}(7)=4$, $F_1(7) = \\frac{2(4)}{7+5} = \\frac{8}{12} = \\frac{2}{3}$。\n- $k=8$: $\\mathrm{TP}(8)=4$, $F_1(8) = \\frac{2(4)}{8+5} = \\frac{8}{13}$。\n- $k=9$: $\\mathrm{TP}(9)=4$, $F_1(9) = \\frac{2(4)}{9+5} = \\frac{8}{14} = \\frac{4}{7}$。\n- $k=10$: $\\mathrm{TP}(10)=5$, $F_1(10) = \\frac{2(5)}{10+5} = \\frac{10}{15} = \\frac{2}{3}$。\n为了找到最大值，我们比较这些值。$\\frac{8}{11} \\approx 0.727$ 大于 $\\frac{2}{3} \\approx 0.667$ 和 $\\frac{8}{13} \\approx 0.615$。因此，模型 A 的最大 $F_1$ 分数是 $F_{1,\\max}^{(\\mathrm{A})} = \\frac{8}{11}$。\n\n**模型 B：**\n按排名排序的标签序列是 $\\{1, 0, 1, 0, 1, 1, 0, 1, 0, 0\\}$。\n- $k=1$: $\\mathrm{TP}(1)=1$, $F_1(1) = \\frac{2(1)}{1+5} = \\frac{1}{3}$。\n- $k=2$: $\\mathrm{TP}(2)=1$, $F_1(2) = \\frac{2(1)}{2+5} = \\frac{2}{7}$。\n- $k=3$: $\\mathrm{TP}(3)=2$, $F_1(3) = \\frac{2(2)}{3+5} = \\frac{1}{2}$。\n- $k=4$: $\\mathrm{TP}(4)=2$, $F_1(4) = \\frac{2(2)}{4+5} = \\frac{4}{9}$。\n- $k=5$: $\\mathrm{TP}(5)=3$, $F_1(5) = \\frac{2(3)}{5+5} = \\frac{3}{5}$。\n- $k=6$: $\\mathrm{TP}(6)=4$, $F_1(6) = \\frac{2(4)}{6+5} = \\frac{8}{11}$。\n- $k=7$: $\\mathrm{TP}(7)=4$, $F_1(7) = \\frac{2(4)}{7+5} = \\frac{2}{3}$。\n- $k=8$: $\\mathrm{TP}(8)=5$, $F_1(8) = \\frac{2(5)}{8+5} = \\frac{10}{13}$。\n- $k=9$: $\\mathrm{TP}(9)=5$, $F_1(9) = \\frac{2(5)}{9+5} = \\frac{10}{14} = \\frac{5}{7}$。\n- $k=10$: $\\mathrm{TP}(10)=5$, $F_1(10) = \\frac{2(5)}{10+5} = \\frac{2}{3}$。\n为了找到最大值，我们比较较大的值：$\\frac{8}{11} \\approx 0.727$，$\\frac{10}{13} \\approx 0.769$ 和 $\\frac{5}{7} \\approx 0.714$。最大值是 $\\frac{10}{13}$。因此，模型 B 的最大 $F_1$ 分数是 $F_{1,\\max}^{(\\mathrm{B})} = \\frac{10}{13}$。\n\n## 第三部分：最大 $F_1$ 分数的差值\n\n最后的任务是计算差值 $F_{1,\\max}^{(\\mathrm{B})} - F_{1,\\max}^{(\\mathrm{A})}$。\n$$F_{1,\\max}^{(\\mathrm{B})} - F_{1,\\max}^{(\\mathrm{A})} = \\frac{10}{13} - \\frac{8}{11}$$\n为了进行分数减法，我们找到一个公分母，即 $13 \\times 11 = 143$。\n$$\\frac{10 \\times 11}{13 \\times 11} - \\frac{8 \\times 13}{11 \\times 13} = \\frac{110}{143} - \\frac{104}{143} = \\frac{110 - 104}{143} = \\frac{6}{143}$$\n分数 $\\frac{6}{143}$ 是最简形式，因为 $6 = 2 \\times 3$ 和 $143=11 \\times 13$ 没有公因数。\n这个结果表明，即使具有相同的区分能力 (AUROC)，模型在像 $F_1$ 分数这样的基于阈值的度量标准下也可能表现出不同的最优性能，这是由于它们对个体案例的排名方式存在差异。",
            "answer": "$$\\boxed{\\frac{6}{143}}$$"
        },
        {
            "introduction": "一个优秀的概率模型不仅要能正确排序病例的风险高低，其输出的预测概率值本身也应具有真实的意义。本练习将引导您探索模型评估的另一个关键维度：校准度，即模型预测的80%风险是否真的对应80%的事件发生率。通过计算期望校准误差（Expected Calibration Error, ECE），您将学会量化模型的“诚实度”，这对于在临床决策等高风险领域建立可信赖的模型至关重要。",
            "id": "4585259",
            "problem": "一个用于二元疾病终点的概率分类器为 $1000$ 名患者输出了预测概率。为了以科学严谨的方式评估校准度，回顾一下，校准度是在预测的整个分布上比较经验事件率与预测概率。在实践中，通常通过将预测分组到不同的箱中，并计算每个箱内经验事件率与该箱的代表性预测概率之间的绝对偏差的加权平均值，来近似总体期望。\n\n给定基于预测分数构建的十分位数分箱，对于每个箱 $b \\in \\{1,\\dots,10\\}$，有患者数量 $n_b$、箱内平均预测概率 $\\bar{c}_b$ 和观测到的阳性样本数 $y_b$：\n- 第1箱：$n_1 = 90$，$\\bar{c}_1 = 0.06$，$y_1 = 3$。\n- 第2箱：$n_2 = 110$，$\\bar{c}_2 = 0.14$，$y_2 = 10$。\n- 第3箱：$n_3 = 95$，$\\bar{c}_3 = 0.22$，$y_3 = 18$。\n- 第4箱：$n_4 = 105$，$\\bar{c}_4 = 0.31$，$y_4 = 35$。\n- 第5箱：$n_5 = 120$，$\\bar{c}_5 = 0.39$，$y_5 = 52$。\n- 第6箱：$n_6 = 80$，$\\bar{c}_6 = 0.48$，$y_6 = 44$。\n- 第7箱：$n_7 = 130$，$\\bar{c}_7 = 0.59$，$y_7 = 79$。\n- 第8箱：$n_8 = 100$，$\\bar{c}_8 = 0.69$，$y_8 = 77$。\n- 第9箱：$n_9 = 90$，$\\bar{c}_9 = 0.81$，$y_9 = 77$。\n- 第10箱：$n_{10} = 80$，$\\bar{c}_{10} = 0.92$，$y_{10} = 76$。\n\n使用与经验分箱频率加权一致的期望校准误差的绝对偏差版本，计算此模型在这 $1000$ 名患者上的期望校准误差。然后，从关于期望和抽样变异性的第一性原理出发，简要讨论为什么十分位数分箱估计量可能存在偏差，以及去偏策略（例如，渐近修正或平方校准误差的估计量）如何在不施加强参数化假设的情况下解决这种偏差。你的最终数值答案必须是期望校准误差的值，四舍五入到四位有效数字。不要包含任何单位，也不要将答案表示为百分比。",
            "solution": "该问题是有效的，因为它在统计模型评估领域具有科学依据，问题适定、数据一致且充分，且其表述客观。我们将首先计算期望校准误差（ECE），然后讨论分箱校准估计量的内在偏差。\n\n期望校准误差（ECE）定义为箱内经验事件率与平均预测概率之间绝对差的加权平均值。其公式为：\n$$\n\\text{ECE} = \\sum_{b=1}^{B} \\frac{n_b}{N} |\\bar{o}_b - \\bar{c}_b|\n$$\n其中 $B$ 是分箱数量，$N$ 是总患者数，$n_b$ 是分箱 $b$ 中的患者数，$\\bar{c}_b$ 是分箱 $b$ 中的平均预测概率，$\\bar{o}_b$ 是分箱 $b$ 中的经验事件率。\n\n总患者数为 $N = \\sum_{b=1}^{10} n_b = 90 + 110 + 95 + 105 + 120 + 80 + 130 + 100 + 90 + 80 = 1000$。分箱数量为 $B=10$。\n\n对于每个分箱 $b$，我们首先计算经验事件率 $\\bar{o}_b = y_b / n_b$，其中 $y_b$ 是观测到的阳性样本数。然后，我们计算每个分箱对 ECE 的贡献，即 $\\frac{n_b}{N} |\\bar{o}_b - \\bar{c}_b|$。\n\n-   **第1箱**：$n_1=90, \\bar{c}_1=0.06, y_1=3$。\n    $\\bar{o}_1 = \\frac{3}{90} = \\frac{1}{30} \\approx 0.0333$。\n    贡献：$\\frac{90}{1000} \\left| \\frac{1}{30} - 0.06 \\right| = 0.09 \\left| \\frac{1}{30} - \\frac{6}{100} \\right| = 0.09 \\left| \\frac{10 - 18}{300} \\right| = 0.09 \\left( \\frac{8}{300} \\right) = \\frac{0.72}{300} = 0.0024$。\n\n-   **第2箱**：$n_2=110, \\bar{c}_2=0.14, y_2=10$。\n    $\\bar{o}_2 = \\frac{10}{110} = \\frac{1}{11} \\approx 0.0909$。\n    贡献：$\\frac{110}{1000} \\left| \\frac{1}{11} - 0.14 \\right| = 0.11 \\left| \\frac{1}{11} - \\frac{14}{100} \\right| = 0.11 \\left| \\frac{100 - 154}{1100} \\right| = 0.11 \\left( \\frac{54}{1100} \\right) = \\frac{5.94}{1100} = 0.0054$。\n\n-   **第3箱**：$n_3=95, \\bar{c}_3=0.22, y_3=18$。\n    $\\bar{o}_3 = \\frac{18}{95} \\approx 0.1895$。\n    贡献：$\\frac{95}{1000} \\left| \\frac{18}{95} - 0.22 \\right| = 0.095 \\left| \\frac{18}{95} - \\frac{22}{100} \\right| = \\frac{95}{1000} \\left| \\frac{1800 - 2090}{9500} \\right| = \\frac{95}{1000} \\left( \\frac{290}{9500} \\right) = \\frac{1}{1000} \\left( \\frac{290}{100} \\right) = 0.0029$。\n\n-   **第4箱**：$n_4=105, \\bar{c}_4=0.31, y_4=35$。\n    $\\bar{o}_4 = \\frac{35}{105} = \\frac{1}{3} \\approx 0.3333$。\n    贡献：$\\frac{105}{1000} \\left| \\frac{1}{3} - 0.31 \\right| = 0.105 \\left| \\frac{1}{3} - \\frac{31}{100} \\right| = 0.105 \\left| \\frac{100 - 93}{300} \\right| = 0.105 \\left( \\frac{7}{300} \\right) = \\frac{0.735}{300} = 0.00245$。\n\n-   **第5箱**：$n_5=120, \\bar{c}_5=0.39, y_5=52$。\n    $\\bar{o}_5 = \\frac{52}{120} = \\frac{13}{30} \\approx 0.4333$。\n    贡献：$\\frac{120}{1000} \\left| \\frac{13}{30} - 0.39 \\right| = 0.12 \\left| \\frac{13}{30} - \\frac{39}{100} \\right| = 0.12 \\left| \\frac{130 - 117}{300} \\right| = 0.12 \\left( \\frac{13}{300} \\right) = \\frac{1.56}{300} = 0.0052$。\n\n-   **第6箱**：$n_6=80, \\bar{c}_6=0.48, y_6=44$。\n    $\\bar{o}_6 = \\frac{44}{80} = \\frac{11}{20} = 0.55$。\n    贡献：$\\frac{80}{1000} |0.55 - 0.48| = 0.08 \\times 0.07 = 0.0056$。\n\n-   **第7箱**：$n_7=130, \\bar{c}_7=0.59, y_7=79$。\n    $\\bar{o}_7 = \\frac{79}{130} \\approx 0.6077$。\n    贡献：$\\frac{130}{1000} \\left| \\frac{79}{130} - 0.59 \\right| = 0.13 \\left| \\frac{790 - 767}{1300} \\right| = \\frac{130}{1000} \\left( \\frac{23}{1300} \\right) = \\frac{23}{10000} = 0.0023$。\n\n-   **第8箱**：$n_8=100, \\bar{c}_8=0.69, y_8=77$。\n    $\\bar{o}_8 = \\frac{77}{100} = 0.77$。\n    贡献：$\\frac{100}{1000} |0.77 - 0.69| = 0.1 \\times 0.08 = 0.008$。\n\n-   **第9箱**：$n_9=90, \\bar{c}_9=0.81, y_9=77$。\n    $\\bar{o}_9 = \\frac{77}{90} \\approx 0.8556$。\n    贡献：$\\frac{90}{1000} \\left| \\frac{77}{90} - 0.81 \\right| = 0.09 \\left| \\frac{770 - 729}{900} \\right| = \\frac{90}{1000} \\left( \\frac{41}{900} \\right) = \\frac{41}{10000} = 0.0041$。\n\n-   **第10箱**：$n_{10}=80, \\bar{c}_{10}=0.92, y_{10}=76$。\n    $\\bar{o}_{10} = \\frac{76}{80} = \\frac{19}{20} = 0.95$。\n    贡献：$\\frac{80}{1000} |0.95 - 0.92| = 0.08 \\times 0.03 = 0.0024$。\n\n将所有 $10$ 个分箱的贡献相加：\n$$\n\\text{ECE} = 0.0024 + 0.0054 + 0.0029 + 0.00245 + 0.0052 + 0.0056 + 0.0023 + 0.008 + 0.0041 + 0.0024\n$$\n$$\n\\text{ECE} = 0.04075\n$$\n问题要求答案四舍五入到四位有效数字。计算出的值 $0.04075$ 已经有四位有效数字（$4, 0, 7, 5$）。\n\n---\n\n**关于分箱估计量偏差的讨论**\n\n从第一性原理出发，对于一个二元结果 $Y \\in \\{0, 1\\}$，一个预测概率函数为 $C$ 的模型的真实校准误差是，在预测的分布上，真实条件事件概率与预测概率之差的期望值：\n$$\n\\text{CE}_{\\text{true}} = \\mathbb{E}_C [ |\\mathbb{P}(Y=1 | C) - C| ]\n$$\n分箱估计量 $\\widehat{\\text{ECE}} = \\sum_{b=1}^{B} \\frac{n_b}{N} |\\bar{o}_b - \\bar{c}_b|$ 是该数量的一个有限样本近似。然而，这个估计量是内在有偏的，主要原因是抽样变异性。对于给定的分箱 $b$，经验事件率 $\\bar{o}_b = y_b/n_b$ 是一个样本均值，因此是真实平均概率 $p_b = \\mathbb{E}[Y | \\text{预测值在分箱 } b \\text{ 内}]$ 的一个无偏估计量。也就是说，$\\mathbb{E}[\\bar{o}_b] = p_b$。在分箱内我们关注的量近似为 $|p_b - \\bar{c}_b|$。然而，该估计量计算的是 $|\\bar{o}_b - \\bar{c}_b|$ 的期望。因为绝对值函数 $f(x)=|x|$ 是一个凸函数，根据詹森不等式可得：$\\mathbb{E}[|\\bar{o}_b - \\bar{c}_b|] \\ge |\\mathbb{E}[\\bar{o}_b - \\bar{c}_b]| = |p_b - \\bar{c}_b|$。这个不等式意味着分箱估计量 $\\widehat{\\text{ECE}}$ 系统性地高估了真实的校准误差。这个偏差 $\\mathbb{E}[|\\bar{o}_b - \\bar{c}_b|] - |p_b - \\bar{c}_b|$ 源于 $\\bar{o}_b$ 的抽样方差。即使一个模型在某个分箱内是完美校准的（即 $p_b = \\bar{c}_b$），由于有限抽样，$\\bar{o}_b$ 仍会围绕 $p_b$ 波动，导致 $|\\bar{o}_b - \\bar{c}_b|$ 的值不为零，从而对估计误差产生正的贡献。\n\n去偏策略旨在修正这种统计学上的伪影。如题中所提示，分析平方校准误差提供了一个更清晰的例子。平方校准误差的分箱估计量为 $\\widehat{\\text{SCE}} = \\sum_b \\frac{n_b}{N} (\\bar{o}_b - \\bar{c}_b)^2$。单个分箱项的期望值为：\n$$\n\\mathbb{E}[(\\bar{o}_b - \\bar{c}_b)^2] = \\mathbb{E}[(\\bar{o}_b - p_b + p_b - \\bar{c}_b)^2] = \\mathbb{E}[(\\bar{o}_b - p_b)^2] + (p_b - \\bar{c}_b)^2 + 2(p_b - \\bar{c}_b)\\mathbb{E}[\\bar{o}_b - p_b]\n$$\n由于 $\\mathbb{E}[\\bar{o}_b - p_b] = 0$，交叉项消失。第一项是 $\\bar{o}_b$ 的方差。因此：\n$$\n\\mathbb{E}[(\\bar{o}_b - \\bar{c}_b)^2] = \\text{Var}(\\bar{o}_b) + (p_b - \\bar{c}_b)^2\n$$\n偏差恰好是 $\\text{Var}(\\bar{o}_b)$。假设分箱中的 $n_b$ 个结果是概率为 $p_b$ 的独立伯努利试验，则 $\\bar{o}_b$ 的方差为 $\\frac{p_b(1-p_b)}{n_b}$。这可以从样本中估计为 $\\frac{\\bar{o}_b(1-\\bar{o}_b)}{n_b}$。因此，分箱内平方误差的一个去偏估计量是 $(\\bar{o}_b - \\bar{c}_b)^2 - \\frac{\\bar{o}_b(1-\\bar{o}_b)}{n_b}$。这种修正仅依赖于一个弱的二项抽样假设，而不依赖于校准函数本身的强参数形式。类似地，虽然更为复杂，但可以通过分析一个（渐近正态的）样本均值与一个固定值之间绝对偏差的期望值，为绝对偏差ECE推导出渐近修正。这些方法可以更准确地估计模型的真实校准性能。",
            "answer": "$$\\boxed{0.04075}$$"
        }
    ]
}