{
    "hands_on_practices": [
        {
            "introduction": "理论知识需要通过实践来巩固。本节的第一个练习将精确率和召回率这些抽象概念置于一个具体的临床情境中。通过分析一个用于癌症筛查的机器学习分类器的性能数据，您将练习从混淆矩阵中计算这些基本指标，并解读它们对于患者诊断和医疗资源分配的直接影响。这项实践旨在培养将原始性能数据转化为有意义的临床见解的核心技能。",
            "id": "4597653",
            "problem": "一家临床基因组学实验室开发了一种机器学习分类器，该分类器整合了游离脱氧核糖核酸（cfDNA）甲基化谱与临床协变量，用于筛查无症状成年人的结直肠癌。在一项多中心前瞻性研究中，该分类器在一个固定的决策阈值下，在一个独立的保留队列上进行了评估。该研究招募了来自初级保健诊所的$N$名年龄在$50$–$75$岁之间且无既往癌症诊断的参与者；结肠镜检查被用作参考标准。在操作阈值下，保留队列的汇总混淆矩阵计数如下：\n- 真阳性 (TP): $180$\n- 假阳性 (FP): $300$\n- 假阴性 (FN): $45$\n- 真阴性 (TN): $4475$\n\n假设这些计数是准确的，并且在研究窗口期内结直肠癌的状态是恒定的。使用适用于生物信息学和医学数据分析中二元分类的事件频率和条件概率的基本定义，计算在此阈值下的精确率-召回率指标，并推断每项指标在此筛查背景下的临床意义。在您的推理中，明确地将精确率与检测阳性的个体中患病的概率联系起来，将召回率与患病个体被检测正确识别的概率联系起来，并评论疾病患病率如何影响精确率。\n\n最后，计算此操作点上精确率和召回率的调和平均数（$\\mathrm{F1}$-分数），并将此单一标量作为您的最终数值答案报告。将您的最终数值答案四舍五入至四位有效数字，并以无量纲小数形式表示（不带百分号）。",
            "solution": "在尝试任何解答之前，需对问题进行验证。\n\n### 步骤1：提取给定信息\n问题提供了用于结直肠癌筛查的机器学习分类器的混淆矩阵数据：\n- 真阳性 ($TP$): $180$\n- 假阳性 ($FP$): $300$\n- 假阴性 ($FN$): $45$\n- 真阴性 ($TN$): $4475$\n\n任务是计算精确率、召回率和F1分数。还需要解释在此背景下精确率和召回率的临床意义，包括疾病患病率对精确率的影响。最终的数值答案必须是F1分数，并四舍五入至四位有效数字。\n\n### 步骤2：使用提取的给定信息进行验证\n根据既定标准对问题进行评估。\n- **科学性**：问题设定在医学诊断和机器学习评估的标准且现实的背景下。所用指标——$TP$、$FP$、$FN$、$TN$、精确率、召回率和F1分数——是二元分类性能分析的基础。使用cfDNA甲基化进行癌症筛查的场景是当前生物信息学研究的一个重要领域。所提供的计数在内部是一致的，并且对于筛查研究来说是合理的。\n- **良构性**：问题陈述是自包含的。它提供了计算所要求指标所需的所有数据（混淆矩阵计数）。目标是明确的：计算和解释特定的性能指标，并报告F1分数。存在一个唯一且稳定的解。\n- **客观性**：问题以精确、定量和无偏见的语言阐述，不含任何主观论断。\n- **完整性与一致性**：数据对于任务是完整的。患病个体总数（$TP + FN = 180 + 45 = 225$）和未患病个体总数（$FP + TN = 300 + 4475 = 4775$）之和等于检测呈阳性的个体总数（$TP + FP = 180 + 300 = 480$）和检测呈阴性的个体总数（$FN + TN = 45 + 4475 = 4520$）之和，即$225 + 4775 = 5000$且$480 + 4520 = 5000$。数据是一致的。\n\n### 步骤3：结论与行动\n问题被判定为**有效**，因为它具有科学性、良构性、客观性和内部一致性。我们可以继续进行解答。\n\n***\n\n解答首先根据提供的混淆矩阵计数定义核心指标。设$D$表示个体患有结直肠癌（“阳性”状况）的事件，$\\neg D$表示他们没有患病的事件。设$T^+$为分类器返回阳性结果的事件，设$T^-$为分类器返回阴性结果的事件。提供的计数如下：\n- 真阳性 ($TP$)：患病且检测呈阳性的个体数。$TP = 180$。\n- 假阳性 ($FP$)：未患病但检测呈阳性的个体数。$FP = 300$。\n- 假阴性 ($FN$)：患病但检测呈阴性的个体数。$FN = 45$。\n- 真阴性 ($TN$)：未患病且检测呈阴性的个体数。$TN = 4475$。\n\n从这些计数中，我们可以确定几个关键群体的总个体数：\n- 患病总数（状况为阳性）：$P = TP + FN = 180 + 45 = 225$。\n- 未患病总数（状况为阴性）：$N_{neg} = FP + TN = 300 + 4475 = 4775$。\n- 分类为阳性的总数（检测结果为阳性）：$T_{pos} = TP + FP = 180 + 300 = 480$。\n- 分类为阴性的总数（检测结果为阴性）：$T_{neg} = FN + TN = 45 + 4475 = 4520$。\n- 研究总人口：$N_{total} = TP + FP + FN + TN = 180 + 300 + 45 + 4475 = 5000$。\n\n问题要求计算和解释精确率和召回率。\n\n**精确率**，也称为阳性预测值（$PPV$），是阳性检测结果中正确的比例。其定义为：\n$$\n\\text{Precision} = \\frac{TP}{TP + FP}\n$$\n在概率术语中，精确率是在检测结果为阳性的条件下患有该疾病的条件概率，即$P(D|T^+)$。它回答了这样一个问题：“如果一个病人收到了阳性的检测结果，他实际患有癌症的概率是多少？”\n对于此分类器：\n$$\n\\text{Precision} = \\frac{180}{180 + 300} = \\frac{180}{480} = \\frac{3}{8} = 0.375\n$$\n$0.375$的精确率意味着，在此筛查环境中，检测结果为阳性的个体中只有$37.5\\%$会通过结肠镜检查确诊患有结直肠癌。剩下的$62.5\\%$是假阳性。这具有重大的临床意义：低精确率会导致大量不必要的、侵入性的且昂贵的后续程序（结肠镜检查）施用于健康个体，从而引起患者焦虑并加重医疗系统的负担。\n\n**召回率**，也称为灵敏度或真阳性率（$TPR$），是所有患病个体中被检测正确识别的比例。其定义为：\n$$\n\\text{Recall} = \\frac{TP}{TP + FN}\n$$\n在概率术语中，召回率是在患有该疾病的条件下检测结果为阳性的条件概率，即$P(T^+|D)$。它回答了这样一个问题：“在所有真正患有癌症的病人中，该检测能正确识别出多大比例？”\n对于此分类器：\n$$\n\\text{Recall} = \\frac{180}{180 + 45} = \\frac{180}{225} = \\frac{4}{5} = 0.8\n$$\n$0.8$的召回率意味着该检测成功识别了研究人群中$80\\%$的结直肠癌患者。剩下的$20\\%$是假阴性——被检测漏掉的患病个体。在癌症筛查的背景下，高召回率至关重要。漏诊（假阴性）会延误治疗，导致更差的临床结果。因此，$0.8$的召回率表明，虽然该检测是有效的，但它仍然会漏掉五分之一的癌症病例。\n\n问题还要求评论疾病**患病率**如何影响精确率。研究队列中的疾病患病率是实际患病个体的比例：\n$$\n\\text{Prevalence} = \\frac{TP + FN}{N_{total}} = \\frac{225}{5000} = 0.045\n$$\n精确率、召回率和患病率之间的关系由贝叶斯定理形式化。精确率$P(D|T^+)$可以表示为：\n$$\n\\text{Precision} = P(D|T^+) = \\frac{P(T^+|D) P(D)}{P(T^+)}\n$$\n其中$P(D)$是患病率，$P(T^+|D)$是召回率。分母$P(T^+)$可以使用全概率律展开：\n$$\nP(T^+) = P(T^+|D)P(D) + P(T^+|\\neg D)P(\\neg D)\n$$\n这里，$P(T^+|\\neg D)$是假阳性率（$FPR = \\frac{FP}{FP+TN}$），而$P(\\neg D) = 1 - \\text{prevalence}$。代入后得到：\n$$\n\\text{Precision} = \\frac{\\text{Recall} \\times \\text{Prevalence}}{\\text{Recall} \\times \\text{Prevalence} + \\text{FPR} \\times (1 - \\text{Prevalence})}\n$$\n这个方程表明，精确率高度依赖于患病率。即使对于一个具有优异召回率和低$FPR$的检测，如果疾病的患病率很低（这在无症状筛查人群中对于癌症是典型情况），分母中的$\\text{FPR} \\times (1 - \\text{Prevalence})$项相对于$\\text{Recall} \\times \\text{Prevalence}$项可能会很大，从而降低精确率。在这种情况下，患病率为$4.5\\%$，相对大量的健康个体（$4775$）与患病个体（$225$）相比，为假阳性的发生提供了很多机会，这反过来又降低了精确率。\n\n最后，我们计算**F1分数**，它是精确率和召回率的调和平均数。它提供了一个平衡这两方面考量的单一指标。其定义为：\n$$\nF_1 = 2 \\times \\frac{\\text{Precision} \\times \\text{Recall}}{\\text{Precision} + \\text{Recall}}\n$$\n或者，它可以直接从混淆矩阵计数计算：\n$$\nF_1 = \\frac{2TP}{2TP + FP + FN}\n$$\n使用后一个公式进行直接计算：\n$$\nF_1 = \\frac{2 \\times 180}{2 \\times 180 + 300 + 45} = \\frac{360}{360 + 345} = \\frac{360}{705}\n$$\n计算其小数值：\n$$\nF_1 = \\frac{360}{705} \\approx 0.51063829...\n$$\n问题要求将此值四舍五入至四位有效数字。\n$$\nF_1 \\approx 0.5106\n$$\n这个大约为$0.5106$的F1分数反映了该分类器在此操作阈值下中等精确率（$0.375$）和高召回率（$0.8$）之间的权衡。",
            "answer": "$$\\boxed{0.5106}$$"
        },
        {
            "introduction": "在不同的应用场景中，精确率与召回率的相对重要性也各不相同。例如，在诊断致命疾病时，我们可能更关注召回率（避免漏诊），而在进行初步筛选时，则可能更看重精确率（减少不必要的进一步检查）。本练习将介绍 $F_{\\beta}$ 分数，它是一个可调整权重的评估工具，用于量化并平衡精确率与召回率之间的权衡，使我们能够根据特定的临床或科研需求定制评估标准。",
            "id": "4597657",
            "problem": "一个临床基因变异检出软件在一个经过整理的肿瘤测序数据集上进行评估，该数据集具有体细胞突变检测中典型的显著类别不平衡。设该软件的精确率 $P$ 和召回率 $R$ 根据混淆矩阵计数定义为 $P = \\mathrm{TP}/(\\mathrm{TP}+\\mathrm{FP})$ 和 $R = \\mathrm{TP}/(\\mathrm{TP}+\\mathrm{FN})$，其中 $\\mathrm{TP}$ 表示真阳性，$\\mathrm{FP}$ 表示假阳性，$\\mathrm{FN}$ 表示假阴性。需要一个综合评分 $F_{\\beta}(P,R)$ 来结合 $P$ 和 $R$，并满足以下要求：它对于 $P$ 和 $R$ 都是单调递增的；当 $P=0$ 或 $R=0$ 时，它等于 $0$；当且仅当 $P=R=1$ 时，它等于 $1$；当 $\\beta=1$ 时，它在 $P$ 和 $R$ 上是对称的；对于一般的 $\\beta>0$，在惩罚 $P$ 和 $R$ 之间的不平衡时，它将召回率的重要性视为精确率的 $\\beta$ 倍。从 $P$ 和 $R$ 的基本定义以及对 $F_{\\beta}$ 的要求出发，推导出一个与这些性质一致的 $F_{\\beta}(P,R)$ 的闭式表达式。然后，对于一个精确率 $P=0.98$、召回率 $R=0.85$ 的变异检出软件，计算 $F_{0.5}$ 和 $F_{2}$。将您的数值结果四舍五入到四位有效数字，并以小数形式表示。最后，阐明在临床变异检出的背景下，$\\beta$ 的哪种选择更强调避免假阳性，哪种更强调避免假阴性，并根据推导出的表达式及其参数依赖性简要论证您的解释。最终报告的值必须仅为计算出的 $F_{0.5}$ 和 $F_{2}$。",
            "solution": "问题要求推导 $F_{\\beta}$ 分数，计算其在特定值下的结果，并解释参数 $\\beta$ 的含义。\n\n**1. $F_{\\beta}(P,R)$ 表达式的推导**\n\n问题为结合精确率 ($P$) 和召回率 ($R$) 的综合评分 $F_{\\beta}(P,R)$ 提供了一系列要求。这些要求是标准 F-度量（F-measure）的特征，F-度量是精确率和召回率的加权调和平均数。调和平均数是合适的，因为它会严重惩罚任一指标较低的情况，从而满足了当 $P=0$ 或 $R=0$ 时 $F_{\\beta}=0$ 的要求。\n\n加权调和平均数的倒数是其各分量倒数的加权算术平均数。因此，我们可以将 $F_{\\beta}^{-1}$ 写成 $P^{-1}$ 和 $R^{-1}$ 的线性组合：\n$$F_{\\beta}^{-1} = \\alpha_P P^{-1} + \\alpha_R R^{-1}$$\n其中 $\\alpha_P$ 和 $\\alpha_R$ 是权重。为满足当 $P=R=1$ 时 $F_{\\beta}=1$ 的要求，权重必须归一化，使得 $\\alpha_P + \\alpha_R = 1$。\n\n关键要求是该分数“将召回率的重要性视为精确率的 $\\beta$ 倍”。在 F-度量的背景下，这通常被形式化为将召回率倒数的权重与精确率倒数的权重之比设为 $\\beta^2$。这意味着：\n$$\\frac{\\alpha_R}{\\alpha_P} = \\beta^2$$\n使用 $\\beta^2$ 而不是 $\\beta$ 是一个标准惯例，源于 F-度量在检索有效性方面的理论基础。\n我们现在求解关于权重 $\\alpha_P$ 和 $\\alpha_R$ 的两个方程组：\n$$ \\begin{cases} \\alpha_P + \\alpha_R = 1 \\\\ \\alpha_R = \\beta^2 \\alpha_P \\end{cases} $$\n将第二个方程代入第一个方程，得到：\n$$ \\alpha_P + \\beta^2 \\alpha_P = 1 \\implies \\alpha_P(1+\\beta^2) = 1 \\implies \\alpha_P = \\frac{1}{1+\\beta^2} $$\n那么，召回率的权重为：\n$$ \\alpha_R = 1 - \\alpha_P = 1 - \\frac{1}{1+\\beta^2} = \\frac{1+\\beta^2-1}{1+\\beta^2} = \\frac{\\beta^2}{1+\\beta^2} $$\n将这些权重代回 $F_{\\beta}^{-1}$ 的表达式中：\n$$F_{\\beta}^{-1} = \\frac{1}{1+\\beta^2} \\frac{1}{P} + \\frac{\\beta^2}{1+\\beta^2} \\frac{1}{R} = \\frac{1}{1+\\beta^2} \\left( \\frac{1}{P} + \\frac{\\beta^2}{R} \\right)$$\n取倒数求得 $F_{\\beta}$：\n$$F_{\\beta} = (1+\\beta^2) \\left( \\frac{1}{\\frac{1}{P} + \\frac{\\beta^2}{R}} \\right)$$\n为了得到更常见的闭式形式，我们简化括号中的项：\n$$\\frac{1}{P} + \\frac{\\beta^2}{R} = \\frac{R + \\beta^2 P}{PR}$$\n将此代回，得到 $F_{\\beta}$ 分数的最终表达式：\n$$F_{\\beta}(P,R) = (1+\\beta^2) \\frac{PR}{\\beta^2 P + R}$$\n这个推导出的公式满足问题陈述中列出的所有性质。\n\n**2. 计算 $F_{0.5}$ 和 $F_{2}$**\n\n给定精确率 $P=0.98$ 和召回率 $R=0.85$。\n\n对于 $\\beta = 0.5$：\n$$F_{0.5} = (1 + (0.5)^2) \\frac{0.98 \\times 0.85}{(0.5)^2 \\times 0.98 + 0.85}$$\n$$F_{0.5} = (1 + 0.25) \\frac{0.833}{0.25 \\times 0.98 + 0.85}$$\n$$F_{0.5} = 1.25 \\times \\frac{0.833}{0.245 + 0.85} = 1.25 \\times \\frac{0.833}{1.095}$$\n$$F_{0.5} = \\frac{1.04125}{1.095} \\approx 0.9509132...$$\n四舍五入到四位有效数字，我们得到 $F_{0.5} = 0.9509$。\n\n对于 $\\beta = 2$：\n$$F_2 = (1 + 2^2) \\frac{0.98 \\times 0.85}{2^2 \\times 0.98 + 0.85}$$\n$$F_2 = (1 + 4) \\frac{0.833}{4 \\times 0.98 + 0.85}$$\n$$F_2 = 5 \\times \\frac{0.833}{3.92 + 0.85} = 5 \\times \\frac{0.833}{4.77}$$\n$$F_2 = \\frac{4.165}{4.77} \\approx 0.8731656...$$\n四舍五入到四位有效数字，我们得到 $F_2 = 0.8732$。\n\n**3. $\\beta$ 的解释**\n\n为了理解 $\\beta$ 如何与避免假阳性和避免假阴性相关联，我们可以用混淆矩阵的计数来表示 $F_{\\beta}$：真阳性 ($\\mathrm{TP}$)、假阳性 ($\\mathrm{FP}$) 和假阴性 ($\\mathrm{FN}$)。\n使用 $P = \\frac{\\mathrm{TP}}{\\mathrm{TP}+\\mathrm{FP}}$ 和 $R = \\frac{\\mathrm{TP}}{\\mathrm{TP}+\\mathrm{FN}}$， $F_{\\beta}$ 公式变为：\n$$F_\\beta = (1+\\beta^2) \\frac{\\frac{\\mathrm{TP}}{\\mathrm{TP}+\\mathrm{FP}} \\cdot \\frac{\\mathrm{TP}}{\\mathrm{TP}+\\mathrm{FN}}}{\\beta^2 \\frac{\\mathrm{TP}}{\\mathrm{TP}+\\mathrm{FP}} + \\frac{\\mathrm{TP}}{\\mathrm{TP}+\\mathrm{FN}}} = (1+\\beta^2) \\frac{\\mathrm{TP}}{\\beta^2(\\mathrm{TP}+\\mathrm{FN}) + (\\mathrm{TP}+\\mathrm{FP})} = \\frac{(1+\\beta^2)\\mathrm{TP}}{(1+\\beta^2)\\mathrm{TP} + \\beta^2\\mathrm{FN} + \\mathrm{FP}}$$\n从这个表达式中，我们观察到假阴性 ($\\mathrm{FN}$) 的计数被一个 $\\beta^2$ 的因子加权，而假阳性 ($\\mathrm{FP}$) 的计数被一个 $1$ 的因子加权。\n\n-   **选择避免假阳性 ($\\mathrm{FP}$)**：为了强调避免假阳性，我们必须更重地惩罚它们。这对应于使 $\\mathrm{FP}$ 的权重大于或等于 $\\mathrm{FN}$ 的权重。这意味着 $1 \\ge \\beta^2$，即 $0 < \\beta \\le 1$。因此，选择 $\\beta < 1$（例如 $F_{0.5}$）会更侧重于精确率，从而更侧重于避免假阳性。\n\n-   **选择避免假阴性 ($\\mathrm{FN}$)**：为了强调避免假阴性，我们必须更重地惩罚它们。这对应于使 $\\mathrm{FN}$ 的权重大于 $\\mathrm{FP}$ 的权重。这意味着 $\\beta^2 > 1$，即 $\\beta > 1$。因此，选择 $\\beta > 1$（例如 $F_2$）会更侧重于召回率，从而更侧重于避免假阴性。\n\n在临床背景下，假阴性可能意味着漏掉一个癌症突变，导致未能诊断或治疗患者。假阳性可能导致不必要的焦虑、活检或有毒的治疗。$\\beta$ 的选择反映了对这两种错误类型的相对成本的临床判断。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.9509 & 0.8732 \\end{pmatrix}}$$"
        },
        {
            "introduction": "现实世界中的生物信息学问题通常涉及对存在严重类别不平衡的多个标签进行预测。这个思想实验探讨了微观平均（micro-averaging）和宏观平均（macro-averaging）这两个关键性能指标之间的差异。通过一个假设的临床表型分析场景，您将发现一个看似提升的总体性能指标（微观平均 AP）如何可能掩盖模型在罕见但临床意义重大的标签上的性能严重下降，这揭示了模型评估中一个常见但关键的陷阱。",
            "id": "4597647",
            "problem": "一个临床自然语言处理系统对重症监护室出院记录进行多标签表型分析，以预测两种表型的存在：一种常见表型 $A$（例如，2型糖尿病）和一种罕见表型 $B$（例如，一种罕见的代谢性疾病）。评估遵循多标签分类的标准精确率-召回率分析。考虑一个留出队列，其中每种表型都在 $10$ 个“记录-患者”对上进行评估，从而为每种表型产生 $10$ 个“标签-实例”对。表型 $A$ 的真实标签有 $4$ 个正例 ($A_1, A_2, A_3, A_4$) 和 $6$ 个负例 ($A_5, \\dots, A_{10}$)。表型 $B$ 的真实标签有 $1$ 个正例 ($B_1$) 和 $9$ 个负例 ($B_2, \\dots, B_{10}$)。两个模型 $M_0$ 和 $M_1$ 输出在 $[0,1]$ 区间内的分数，这些分数被解释为置信度。每种表型的得分如下所示。\n\n对于表型 $A$：\n- 在 $M_0$下：$A_1$ (正例) $= 0.90$，$A_2$ (正例) $= 0.70$，$A_3$ (正例) $= 0.60$，$A_4$ (正例) $= 0.40$，$A_5$ (负例) $= 0.95$，$A_6$ (负例) $= 0.80$，$A_7$ (负例) $= 0.50$，$A_8$ (负例) $= 0.45$，$A_9$ (负例) $= 0.30$，$A_{10}$ (负例) $= 0.20$。\n- 在 $M_1$下：$A_1$ (正例) $= 0.98$，$A_2$ (正例) $= 0.97$，$A_3$ (正例) $= 0.96$，$A_4$ (正例) $= 0.50$，$A_5$ (负例) $= 0.49$，$A_6$ (负例) $= 0.48$，$A_7$ (负例) $= 0.47$，$A_8$ (负例) $= 0.46$，$A_9$ (负例) $= 0.45$，$A_{10}$ (负例) $= 0.44$。\n\n对于表型 $B$：\n- 在 $M_0$下：$B_1$ (正例) $= 0.96$，$B_2$ (负例) $= 0.85$，$B_3$ (负例) $= 0.75$，$B_4$ (负例) $= 0.65$，$B_5$ (负例) $= 0.55$，$B_6$ (负例) $= 0.44$，$B_7$ (负例) $= 0.43$，$B_8$ (负例) $= 0.35$，$B_9$ (负例) $= 0.25$，$B_{10}$ (负例) $= 0.15$。\n- 在 $M_1$下：$B_1$ (正例) $= 0.10$，$B_2$ (负例) $= 0.95$，$B_3$ (负例) $= 0.85$，$B_4$ (负例) $= 0.75$，$B_5$ (负例) $= 0.65$，$B_6$ (负例) $= 0.55$，$B_7$ (负例) $= 0.43$，$B_8$ (负例) $= 0.35$，$B_9$ (负例) $= 0.25$，$B_{10}$ (负例) $= 0.15$。\n\n任务：\n- 根据精确率-召回率分析的基本原理，为每个模型 $M_0$ 和 $M_1$ 计算：$A$ 和 $B$ 的各表型平均精确率 (AP)；跨 $A$ 和 $B$ 的宏平均精确率 (macro AP)；以及通过汇集所有 $20$ 个“标签-实例”对并按分数排序而获得的微平均精确率 (micro AP)。\n- 使用您的计算结果来判断微平均AP和宏平均AP从 $M_0$ 到 $M_1$ 的变化，并解释其对罕见表型性能的影响。\n\n以下哪些陈述是正确的？\n\nA. 从 $M_0$ 到 $M_1$，微平均AP增加（从 $\\dfrac{181}{315}$ 到 $\\dfrac{133}{180}$），而宏平均AP减少（从 $\\dfrac{61}{80}$ 到 $\\dfrac{11}{20}$）。这表明，尽管微平均值有所提高，但罕见表型 $B$ 的性能却恶化了。\n\nB. 从 $M_0$ 到 $M_1$，微平均和宏平均AP都增加了；因此，罕见表型的性能与常见表型的性能一起得到了改善。\n\nC. 微平均AP等于各表型AP的未加权平均值；因此，如果宏平均AP减少，微平均AP也必须减少。\n\nD. 常见表型 $A$ 的改善是以牺牲罕见表型 $B$ 为代价的，这说明在不平衡的生物医学表型分析中，仅报告微平均AP可能会掩盖对稀有标签的损害；宏平均或各表型AP也应被报告。\n\nE. 对于表型 $B$，由于只有一个正例，其各表型AP等于其召回率，因此当该正例排名较低时，其性能不会恶化。",
            "solution": "该问题要求对两个模型 $M_0$ 和 $M_1$ 在一个包含常见表型 $A$ 和罕见表型 $B$ 的多标签分类任务上进行全面的精确率-召回率分析。我们必须计算各表型平均精确率 ($AP$)、宏平均 $AP$ 和微平均 $AP$ 来评估所给的陈述。\n\n首先，我们来定义平均精确率 ($AP$)。对于一个给定的类别，实例按其预测分数降序排列。$AP$ 是在每个正例的排名位置上计算出的精确率值的平均值。其形式化定义为：\n$$AP = \\frac{\\sum_{k=1}^{N} (P(k) \\times rel(k))}{\\text{Total number of positive instances}}$$\n其中 $N$ 是实例总数，$k$ 是排名，$P(k)$ 是排名 $k$ 处的精确率（即，前 $k$ 个预测中正例的比例），$rel(k)$ 是一个指示函数，如果排名 $k$ 处的实例是真正的正例，则为 $1$，否则为 $0$。\n\n表型 $A$ 的正例总数为 $4$。表型 $B$ 的正例总数为 $1$。\n\n### 模型 $M_0$ 的分析\n\n**1. 表型 A 的平均精确率 ($AP_A(M_0)$)**\n\n首先，我们根据模型 $M_0$ 的分数为表型 $A$ 的实例排序：\n- 排名 1: $A_5$ (负例) - $0.95$\n- 排名 2: $A_1$ (正例) - $0.90$\n- 排名 3: $A_6$ (负例) - $0.80$\n- 排名 4: $A_2$ (正例) - $0.70$\n- 排名 5: $A_3$ (正例) - $0.60$\n- 排名 6: $A_7$ (负例) - $0.50$\n- 排名 7: $A_8$ (负例) - $0.45$\n- 排名 8: $A_4$ (正例) - $0.40$\n- 排名 9: $A_9$ (负例) - $0.30$\n- 排名 10: $A_{10}$ (负例) - $0.20$\n\n在正例排名位置上的精确率值为：\n- 在排名 $2$ 处 ($A_1$): $P(2) = 1/2$\n- 在排名 $4$ 处 ($A_2$): $P(4) = 2/4 = 1/2$\n- 在排名 $5$ 处 ($A_3$): $P(5) = 3/5$\n- 在排名 $8$ 处 ($A_4$): $P(8) = 4/8 = 1/2$\n\n$AP$ 是这些精确率值的平均值：\n$$AP_A(M_0) = \\frac{1}{4} \\left( \\frac{1}{2} + \\frac{2}{4} + \\frac{3}{5} + \\frac{4}{8} \\right) = \\frac{1}{4} \\left( 0.5 + 0.5 + 0.6 + 0.5 \\right) = \\frac{2.1}{4} = 0.525 = \\frac{21}{40}$$\n\n**2. 表型 B 的平均精确率 ($AP_B(M_0)$)**\n\n我们为表型 $B$ 的实例排序：\n- 排名 1: $B_1$ (正例) - $0.96$\n- ……以此类推。\n\n只有一个正例 $B_1$，它排在第一位。其排名位置上的精确率是：\n- 在排名 $1$ 处 ($B_1$): $P(1) = 1/1 = 1$\n\n$AP$ 是：\n$$AP_B(M_0) = \\frac{1}{1} (1) = 1.0$$\n\n**3. $M_0$ 的宏平均 AP**\n\n宏平均是各表型 AP 的未加权平均值。\n$$MacroAP(M_0) = \\frac{AP_A(M_0) + AP_B(M_0)}{2} = \\frac{0.525 + 1.0}{2} = 0.7625 = \\frac{1525}{2000} = \\frac{61}{80}$$\n\n**4. $M_0$ 的微平均 AP**\n\n对于微平均，我们将所有 $20$ 个“标签-实例”对汇集起来，计算一个单一的 $AP$。总共有 $4+1=5$ 个正例。\n在 $M_0$ 下所有 $20$ 个实例的排序列表：\n1. $B_1$ (正例, B) $0.96$\n2. $A_5$ (负例, A) $0.95$\n3. $A_1$ (正例, A) $0.90$\n4. $B_2$ (负例, B) $0.85$\n5. $A_6$ (负例, A) $0.80$\n6. $B_3$ (负例, B) $0.75$\n7. $A_2$ (正例, A) $0.70$\n8. $B_4$ (负例, B) $0.65$\n9. $A_3$ (正例, A) $0.60$\n10. $B_5$ (负例, B) $0.55$\n11. $A_7$ (负例, A) $0.50$\n12. $A_8$ (负例, A) $0.45$\n13. $B_6$ (负例, B) $0.44$\n14. $B_7$ (负例, B) $0.43$\n15. $A_4$ (正例, A) $0.40$\n... (其余为负例)。\n\n在五个正例排名位置上的精确率是：\n- 在排名 $1$ 处 ($B_1$): $P(1) = 1/1$\n- 在排名 $3$ 处 ($A_1$): $P(3) = 2/3$\n- 在排名 $7$ 处 ($A_2$): $P(7) = 3/7$\n- 在排名 $9$ 处 ($A_3$): $P(9) = 4/9$\n- 在排名 $15$ 处 ($A_4$): $P(15) = 5/15 = 1/3$\n\n$$MicroAP(M_0) = \\frac{1}{5} \\left( \\frac{1}{1} + \\frac{2}{3} + \\frac{3}{7} + \\frac{4}{9} + \\frac{1}{3} \\right) = \\frac{1}{5} \\left( 1 + \\left(\\frac{2}{3}+\\frac{1}{3}\\right) + \\frac{3}{7} + \\frac{4}{9} \\right) = \\frac{1}{5} \\left( 2 + \\frac{27+28}{63} \\right) = \\frac{1}{5} \\left( \\frac{126+55}{63} \\right) = \\frac{181}{315}$$\n\n### 模型 $M_1$ 的分析\n\n**1. 表型 A 的平均精确率 ($AP_A(M_1)$)**\n\n在 $M_1$ 下表型 A 的实例排序：\n- 排名 1: $A_1$ (正例) - $0.98$\n- 排名 2: $A_2$ (正例) - $0.97$\n- 排名 3: $A_3$ (正例) - $0.96$\n- 排名 4: $A_4$ (正例) - $0.50$\n- 排名 5: $A_5$ (负例) - $0.49$\n...以此类推。\n\n所有四个正例都排在最前面。\n- 在排名 $1$ 处 ($A_1$): $P(1) = 1/1$\n- 在排名 $2$ 处 ($A_2$): $P(2) = 2/2 = 1$\n- 在排名 $3$ 处 ($A_3$): $P(3) = 3/3 = 1$\n- 在排名 $4$ 处 ($A_4$): $P(4) = 4/4 = 1$\n\n$$AP_A(M_1) = \\frac{1}{4} (1+1+1+1) = 1.0$$\n\n**2. 表型 B 的平均精确率 ($AP_B(M_1)$)**\n\n在 $M_1$ 下表型 B 的实例排序：\n- 排名 1: $B_2$ (负例) - $0.95$\n...\n- 排名 9: $B_{10}$ (负例) - $0.15$\n- 排名 10: $B_1$ (正例) - $0.10$\n\n唯一的正例排在最后。\n- 在排名 $10$ 处 ($B_1$): $P(10) = 1/10$\n\n$$AP_B(M_1) = \\frac{1}{1} \\left( \\frac{1}{10} \\right) = 0.1$$\n\n**3. $M_1$ 的宏平均 AP**\n\n$$MacroAP(M_1) = \\frac{AP_A(M_1) + AP_B(M_1)}{2} = \\frac{1.0 + 0.1}{2} = 0.55 = \\frac{11}{20}$$\n\n**4. $M_1$ 的微平均 AP**\n\n我们汇集所有 $20$ 个实例。总共有 $5$ 个正例。排序列表：\n1. $A_1$ (正例, A) $0.98$\n2. $A_2$ (正例, A) $0.97$\n3. $A_3$ (正例, A) $0.96$\n4. $B_2$ (负例, B) $0.95$\n5. $B_3$ (负例, B) $0.85$\n6. $B_4$ (负例, B) $0.75$\n7. $B_5$ (负例, B) $0.65$\n8. $B_6$ (负例, B) $0.55$\n9. $A_4$ (正例, A) $0.50$\n...\n20. $B_1$ (正例, B) $0.10$\n\n在五个正例排名位置上的精确率是：\n- 在排名 $1$ 处 ($A_1$): $P(1) = 1/1$\n- 在排名 $2$ 处 ($A_2$): $P(2) = 2/2 = 1$\n- 在排名 $3$ 处 ($A_3$): $P(3) = 3/3 = 1$\n- 在排名 $9$ 处 ($A_4$): $P(9) = 4/9$\n- 在排名 $20$ 处 ($B_1$): $P(20) = 5/20 = 1/4$\n\n$$MicroAP(M_1) = \\frac{1}{5} \\left( 1 + 1 + 1 + \\frac{4}{9} + \\frac{1}{4} \\right) = \\frac{1}{5} \\left( 3 + \\frac{16+9}{36} \\right) = \\frac{1}{5} \\left( 3 + \\frac{25}{36} \\right) = \\frac{1}{5} \\left( \\frac{108+25}{36} \\right) = \\frac{133}{180}$$\n\n### 结果摘要\n| 指标 | 模型 $M_0$ | 模型 $M_1$ | 变化 ($M_0 \\to M_1$) |\n|---|---|---|---|\n| $AP_A$ | $0.525$ | $1.0$ | 增加 |\n| $AP_B$ | $1.0$ | $0.1$ | 减少 |\n| 宏平均 AP | $0.7625 = \\frac{61}{80}$ | $0.55 = \\frac{11}{20}$ | 减少 |\n| 微平均 AP | $\\approx 0.5746 = \\frac{181}{315}$ | $\\approx 0.7389 = \\frac{133}{180}$ | 增加 |\n\n### 选项评估\n\n**A. 从 $M_0$ 到 $M_1$，微平均AP增加（从 $\\dfrac{181}{315}$ 到 $\\dfrac{133}{180}$），而宏平均AP减少（从 $\\dfrac{61}{80}$ 到 $\\dfrac{11}{20}$）。这表明，尽管微平均值有所提高，但罕见表型 $B$ 的性能却恶化了。**\n\n我们的计算证实了此陈述中的每个数值和趋势。\n- 微平均AP增加：$\\frac{181}{315} \\approx 0.5746$ 增加到 $\\frac{133}{180} \\approx 0.7389$。\n- 宏平均AP减少：$\\frac{61}{80} = 0.7625$ 减少到 $\\frac{11}{20} = 0.55$。\n- 解释也是正确的：宏平均AP的下降是由罕见表型 $B$ 的性能崩溃（从 $AP_B=1.0$ 到 $AP_B=0.1$）所驱动的。微平均AP由实例数量更多的表型 $A$（有 $4$ 个正例，而 $B$ 只有 $1$ 个）主导，由于 $A$ 的性能显著提高（从 $AP_A=0.525$ 到 $AP_A=1.0$），因此微平均AP得到了改善。\n**结论：正确。**\n\n**B. 从 $M_0$ 到 $M_1$，微平均和宏平均AP都增加了；因此，罕见表型的性能与常见表型的性能一起得到了改善。**\n\n这个陈述在事实上是错误的。我们的计算表明宏平均AP减少了。因此，其前提是错误的。\n**结论：错误。**\n\n**C. 微平均AP等于各表型AP的未加权平均值；因此，如果宏平均AP减少，微平均AP也必须减少。**\n\n该陈述的第一部分是**宏平均AP**的定义，而不是微平均AP。微平均AP是通过汇集所有预测来计算的。本题的结果就是一个直接的反例：宏平均AP减少了，而微平均AP增加了。该陈述在其定义和逻辑推导上都存在根本性错误。\n**结论：错误。**\n\n**D. 常见表型 $A$ 的改善是以牺牲罕见表型 $B$ 为代价的，这说明在不平衡的生物医学表型分析中，仅报告微平均AP可能会掩盖对稀有标签的损害；宏平均或各表型AP也应被报告。**\n\n该陈述对结果提供了准确的解释。\n- $AP_A$ 从 $0.525$ 提高到 $1.0$。\n- $AP_B$ 从 $1.0$ 恶化到 $0.1$。\n- 微平均AP提高了，如果孤立地看，这会错误地暗示 $M_1$ 是一个毫无疑问更好的模型。这掩盖了罕见表型 $B$ 上严重的性能下降。这种情况完美地说明了在不平衡设置中使用微平均的一个已知陷阱。建议同时报告宏平均或各表型指标是避免此问题的标准最佳实践。\n**结论：正确。**\n\n**E. 对于表型 $B$，由于只有一个正例，其各表型AP等于其召回率，因此当该正例排名较低时，其性能不会恶化。**\n\n前提“AP等于其召回率”定义不清，并且通常是错误的。对于只有一个正例的类别，如果该正例排在第 $k$ 位，其 $AP$ 正是该排名处的精确率，即 $P(k) = 1/k$。在排名 $k$ 处的召回率是 $1$（因为唯一的正例已被找到）。只有当 $k=1$ 时，$AP$ 才等于召回率。结论“当该正例排名较低时，AP不会恶化”与事实恰恰相反。随着排名 $k$ 的增加（即正例排名更低），$AP = 1/k$ 会减小（恶化）。我们的计算显示，随着其排名从 $1$ 变为 $10$， $AP_B$ 从 $1.0$ 恶化到了 $0.1$。\n**结论：错误。**",
            "answer": "$$\\boxed{AD}$$"
        }
    ]
}