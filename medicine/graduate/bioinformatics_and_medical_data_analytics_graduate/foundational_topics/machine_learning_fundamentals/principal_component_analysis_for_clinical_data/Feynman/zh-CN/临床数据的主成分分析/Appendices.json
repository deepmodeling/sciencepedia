{
    "hands_on_practices": [
        {
            "introduction": "在对临床数据应用主成分分析（PCA）之前，必须对原始数据进行适当的预处理。本练习将引导您完成两个关键步骤：处理不同单位和尺度的变量，以及对分类变量进行编码。通过这个基于一个假设性数据集的计算实践，您将巩固对为何通常首选基于相关性的PCA的理解，并掌握如何从混合类型数据构建分析所需的输入矩阵。",
            "id": "4598175",
            "problem": "一个研究团队正准备应用主成分分析 (PCA) 对一个成人队列进行临床风险分层。考虑一个包含 $n=6$ 名患者的合成数据集，记录了以下变量：空腹血糖（单位为 $\\mathrm{mg/dL}$）、收缩压（单位为 $\\mathrm{mmHg}$），以及一个2型糖尿病的二元诊断指标，其中 $1$ 表示已诊断，$0$ 表示未诊断。患者层面的数据如下（每个元组为（血糖，收缩压，诊断））：\n$$(90, 110, 0),\\quad (100, 120, 0),\\quad (110, 130, 0),\\quad (120, 140, 1),\\quad (130, 150, 1),\\quad (140, 160, 1).$$\n任务：\n- 在对混合临床变量进行 PCA 的背景下，论证将诊断编码为 $0$ 和 $1$ 的合理性，并论证构建基于相关性的 PCA 所需的中心化和标准化选择的合理性。\n- 使用适当的编码和中心化（以及您认为为正确构建相关矩阵所必需的任何额外预处理），计算这三个变量的样本相关矩阵。\n- 计算所得相关矩阵的最大特征值，在基于相关性的 PCA 中，该值对应于第一主成分所解释的方差。\n\n以单一闭式解析表达式的形式提供最大特征值。无需四舍五入，最终表达式中不应包含单位。",
            "solution": "该问题是有效的，因为它具有科学依据、定义良好、客观且自洽。它展示了主成分分析 (PCA) 在一个合成临床数据集上的一个标准（尽管是简化的）应用。任务涉及论证混合数据类型的处理方法并执行必要的计算，这些在数学上是合理的，并且是该主题的核心。\n\n分析过程分三个阶段进行：\n1.  为对混合数据类型进行基于相关性的 PCA 而采取的预处理步骤的合理性论证。\n2.  样本相关矩阵的计算。\n3.  相关矩阵最大特征值的计算。\n\n设三个变量分别表示为 $X_1$（空腹血糖）、$X_2$（收缩压）和 $X_3$（糖尿病诊断）。数据集包含 $n=6$ 个观测值。\n\n**1. 预处理的合理性论证**\n\n主成分分析旨在数据集中识别出最大方差的正交轴。然而，一个变量的方差取决于其尺度和单位。给定的变量，血糖和收缩压，分别以不同的单位（$\\mathrm{mg/dL}$ 和 $\\mathrm{mmHg}$）测量，并具有不同的典型范围。如果直接对原始数据（即对协方差矩阵）进行 PCA，那么数值上方差最大的变量将不成比例地主导第一主成分，而不管其在数据结构中的实际重要性如何。为了缓解这个问题，标准做法是标准化数据。这对每个变量包括两个步骤：通过减去样本均值进行中心化，以及通过除以样本标准差进行缩放。对此类标准化数据执行 PCA 在数学上等同于对样本相关矩阵执行 PCA。这种方法确保每个变量的均值为 $0$，方差为 $1$，从而使它们处于同等地位。\n\n第三个变量，即诊断指标，是二元的。将其数值编码为 $0$ 和 $1$ 是将分类数据纳入此类分析的常用方法。当计算一个连续变量和一个编码为 $0$ 和 $1$ 的二分变量之间的皮尔逊相关系数时，其结果在代数上等价于点二列相关系数。该系数是衡量连续变量与二元类别之间线性关联的有效度量，这证明了将诊断变量纳入相关矩阵的合理性。\n\n**2. 样本相关矩阵的计算**\n\n样本相关矩阵 $R$ 是一个 $3 \\times 3$ 矩阵，其中元素 $R_{ij}$ 是变量 $X_i$ 和 $X_j$ 之间的样本相关系数。数据向量如下：\n$$ X_1 = \\begin{pmatrix} 90 \\\\ 100 \\\\ 110 \\\\ 120 \\\\ 130 \\\\ 140 \\end{pmatrix}, \\quad X_2 = \\begin{pmatrix} 110 \\\\ 120 \\\\ 130 \\\\ 140 \\\\ 150 \\\\ 160 \\end{pmatrix}, \\quad X_3 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\\\ 1 \\\\ 1 \\end{pmatrix} $$\n首先，我们计算样本均值（$\\bar{x}_i$）：\n$$ \\bar{x}_1 = \\frac{1}{6}(90+100+110+120+130+140) = \\frac{690}{6} = 115 $$\n$$ \\bar{x}_2 = \\frac{1}{6}(110+120+130+140+150+160) = \\frac{810}{6} = 135 $$\n$$ \\bar{x}_3 = \\frac{1}{6}(0+0+0+1+1+1) = \\frac{3}{6} = \\frac{1}{2} $$\n接下来，我们计算样本方差（$s_i^2$）和标准差（$s_i$），使用分母为 $n-1 = 5$ 的无偏估计量：\n$$ s_1^2 = \\frac{1}{5} \\sum_{k=1}^{6} (x_{1k} - \\bar{x}_1)^2 = \\frac{1}{5}[(-25)^2 + (-15)^2 + (-5)^2 + 5^2 + 15^2 + 25^2] = \\frac{1}{5}[625+225+25+25+225+625] = \\frac{1750}{5} = 350 $$\n$$ s_1 = \\sqrt{350} $$\n$X_2$ 的数据是 $X_1$ 的一个简单线性变换，具体为 $X_2 = X_1 + 20$。因此，它们中心化后的向量是相同的，并且它们的方差相等。\n$$ s_2^2 = 350 \\implies s_2 = \\sqrt{350} $$\n对于 $X_3$：\n$$ s_3^2 = \\frac{1}{5} \\sum_{k=1}^{6} (x_{3k} - \\bar{x}_3)^2 = \\frac{1}{5}[3 \\cdot (0 - \\frac{1}{2})^2 + 3 \\cdot (1 - \\frac{1}{2})^2] = \\frac{1}{5}[3 \\cdot \\frac{1}{4} + 3 \\cdot \\frac{1}{4}] = \\frac{1}{5}[\\frac{6}{4}] = \\frac{3}{10} $$\n$$ s_3 = \\sqrt{\\frac{3}{10}} $$\n样本相关系数为 $R_{ij} = \\frac{\\text{Cov}(X_i, X_j)}{s_i s_j}$，其中 $\\text{Cov}(X_i, X_j) = \\frac{1}{n-1}\\sum_{k=1}^{6} (x_{ik} - \\bar{x}_i)(x_{jk} - \\bar{x}_j)$。对角元素 $R_{ii}$ 均为 $1$。\n对于 $R_{12}$：由于 $X_2 = X_1 + 20$，这两个变量完全线性相关。因此，$R_{12} = 1$。\n对于 $R_{13}$：\n$$ \\text{Cov}(X_1, X_3) = \\frac{1}{5} \\sum_{k=1}^{6} (x_{1k} - \\bar{x}_1)(x_{3k} - \\bar{x}_3) = \\frac{1}{5} [(-25)(-\\frac{1}{2}) + (-15)(-\\frac{1}{2}) + (-5)(-\\frac{1}{2}) + (5)(\\frac{1}{2}) + (15)(\\frac{1}{2}) + (25)(\\frac{1}{2})] $$\n$$ \\text{Cov}(X_1, X_3) = \\frac{1}{5} [\\frac{1}{2}(25+15+5) + \\frac{1}{2}(5+15+25)] = \\frac{1}{5} [\\frac{45}{2} + \\frac{45}{2}] = \\frac{45}{5} = 9 $$\n$$ R_{13} = \\frac{9}{s_1 s_3} = \\frac{9}{\\sqrt{350}\\sqrt{3/10}} = \\frac{9}{\\sqrt{350 \\cdot 0.3}} = \\frac{9}{\\sqrt{105}} $$\n对于 $R_{23}$：由于 $X_1$ 和 $X_2$ 的中心化向量相同，所以 $\\text{Cov}(X_2, X_3) = \\text{Cov}(X_1, X_3) = 9$。同时，$s_2=s_1$。因此，$R_{23} = R_{13} = \\frac{9}{\\sqrt{105}}$。\n设 $c = \\frac{9}{\\sqrt{105}}$。相关矩阵为：\n$$ R = \\begin{pmatrix} 1  1  c \\\\ 1  1  c \\\\ c  c  1 \\end{pmatrix} $$\n\n**3. 最大特征值的计算**\n\n我们需要通过解特征方程 $\\det(R - \\lambda I) = 0$ 来求出 $R$ 的特征值 $\\lambda$。\n$$ \\det \\begin{pmatrix} 1-\\lambda  1  c \\\\ 1  1-\\lambda  c \\\\ c  c  1-\\lambda \\end{pmatrix} = 0 $$\n展开行列式：\n$$ (1-\\lambda)((1-\\lambda)^2 - c^2) - 1( (1-\\lambda) - c^2 ) + c(c - c(1-\\lambda)) = 0 $$\n$$ (1-\\lambda)^3 - c^2(1-\\lambda) - (1-\\lambda) + c^2 + c^2(1 - 1 + \\lambda) = 0 $$\n$$ (1-\\lambda)^3 - (1-\\lambda) - c^2(1-\\lambda) + c^2 + \\lambda c^2 = 0 $$\n$$ (1-\\lambda)^3 - (1-\\lambda) - c^2 + \\lambda c^2 + c^2 + \\lambda c^2 = 0 $$\n$$ (1-\\lambda)^3 - (1-\\lambda) + 2\\lambda c^2 = 0 $$\n提出因子 $(1-\\lambda)$：\n$$ (1-\\lambda)[(1-\\lambda)^2 - 1] + 2\\lambda c^2 = 0 $$\n$$ (1-\\lambda)[\\lambda^2 - 2\\lambda] + 2\\lambda c^2 = 0 $$\n$$ \\lambda(1-\\lambda)(\\lambda-2) + 2\\lambda c^2 = 0 $$\n一个解是 $\\lambda=0$。如果 $\\lambda \\neq 0$，我们可以两边同除以 $\\lambda$：\n$$ (1-\\lambda)(\\lambda-2) + 2c^2 = 0 $$\n$$ -\\lambda^2 + 3\\lambda - 2 + 2c^2 = 0 $$\n$$ \\lambda^2 - 3\\lambda + (2 - 2c^2) = 0 $$\n使用二次方程求根公式求另外两个特征值：\n$$ \\lambda = \\frac{3 \\pm \\sqrt{(-3)^2 - 4(1)(2-2c^2)}}{2} = \\frac{3 \\pm \\sqrt{9 - 8 + 8c^2}}{2} = \\frac{3 \\pm \\sqrt{1 + 8c^2}}{2} $$\n三个特征值分别为 $\\lambda_1 = 0$、$\\lambda_2 = \\frac{3 - \\sqrt{1 + 8c^2}}{2}$ 和 $\\lambda_3 = \\frac{3 + \\sqrt{1 + 8c^2}}{2}$。最大特征值是 $\\lambda_{max} = \\lambda_3$。\n现在，我们代入 $c^2$ 的值：\n$$ c^2 = \\left(\\frac{9}{\\sqrt{105}}\\right)^2 = \\frac{81}{105} = \\frac{27}{35} $$\n将 $c^2$ 代入 $\\lambda_{max}$ 的表达式中：\n$$ \\lambda_{max} = \\frac{3 + \\sqrt{1 + 8\\left(\\frac{27}{35}\\right)}}{2} = \\frac{3 + \\sqrt{1 + \\frac{216}{35}}}{2} = \\frac{3 + \\sqrt{\\frac{35}{35} + \\frac{216}{35}}}{2} = \\frac{3 + \\sqrt{\\frac{251}{35}}}{2} $$\n这就是最大特征值的最终闭式解析表达式。\n特征值之和为 $0 + \\frac{3 - \\sqrt{1 + 8c^2}}{2} + \\frac{3 + \\sqrt{1 + 8c^2}}{2} = \\frac{6}{2} = 3$，这与相关矩阵的迹 $\\text{Tr}(R) = 1+1+1=3$ 相符。最大特征值代表了从相关矩阵派生的第一主成分所解释的方差。",
            "answer": "$$ \\boxed{\\frac{3 + \\sqrt{\\frac{251}{35}}}{2}} $$"
        },
        {
            "introduction": "许多临床或生物学指标（如基因表达量）并不服从正态分布，其数据往往呈现严重的右偏态，这可能扭曲PCA的结果。本练习探讨了如何处理这类具有乘性误差和偏态分布的数据，通过应用对数等方差稳定变换，使数据更符合PCA等分析方法的基本假设。掌握这一技能对于确保从真实世界生物数据中获得稳健和有意义的分析结果至关重要。",
            "id": "4598130",
            "problem": "一个研究团队正准备将主成分分析（PCA）应用于一组无量纲的临床指标，这些指标是相对于患者特定基线值的倍数变化构建的。众所周知，许多此类指标表现出极端的右偏（正偏）和乘性误差，这与生化浓度中常见的对数正态生成机制相一致。该团队希望在拟合PCA之前，为应用一种方差稳定变换提供理由，然后通过一个小的数值例子来量化两个此类指标之间的样本协方差在变换后的变化。\n\n从核心定义和经过充分检验的事实出发，论证对具有乘性噪声的临床指标应用单调方差稳定变换（如对数变换或Box-Cox变换）的理由。然后，对于从 $n=6$ 名患者收集的以下无量纲倍数变化数据：\n- 指标 $A$：$1$, $1$, $2$, $8$, $32$, $64$，\n- 指标 $B$：$0.5$, $1$, $2$, $8$, $24$, $48$，\n\n使用样本协方差的定义，计算 $A$ 和 $B$ 之间的样本协方差以及 $\\ln(A)$ 和 $\\ln(B)$ 之间的样本协方差。将“样本协方差的变化”定义为差值\n$$\\Delta = \\operatorname{Cov}(\\ln(A),\\ln(B)) - \\operatorname{Cov}(A,B)。$$\n将 $\\Delta$ 的最终数值四舍五入到四位有效数字。这些指标是无量纲的，因此最终答案不需要物理单位。",
            "solution": "该问题需要分两部分回答：首先，在使用主成分分析（PCA）之前，为对指定类型的临床数据应用对数变换提供理论依据；其次，针对给定的数据集，具体计算此类变换后样本协方差的变化。\n\n### 第1部分：对数变换的合理性论证\n\n主成分分析是一种识别数据集中最大方差的正交轴（主成分）的技术。第一个主成分是原始变量的线性组合，它能解释数据中最大量的方差。因此，PCA对输入变量的尺度和方差高度敏感。一个方差过大的变量可能会主导第一个主成分，从而可能掩盖其他变量的贡献，并导致对底层数据结构的误解。\n\n问题陈述指出，临床指标表现出极端的右偏和乘性误差，这与对数正态生成机制相一致。设随机变量 $X$ 代表这样一个指标。如果 $X$ 服从对数正态分布，那么它的自然对数 $Y = \\ln(X)$ 就服从正态分布。设 $Y \\sim \\mathcal{N}(\\mu, \\sigma^2)$。$X$ 的期望值（均值）和方差由下式给出：\n$$ \\mathbb{E}[X] = \\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right) $$\n$$ \\operatorname{Var}(X) = \\left(\\exp(\\sigma^2) - 1\\right) \\exp\\left(2\\mu + \\sigma^2\\right) $$\n将均值的表达式代入方差方程，我们可以看到它们之间的关系：\n$$ \\operatorname{Var}(X) = \\left(\\exp(\\sigma^2) - 1\\right) \\left(\\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right)\\right)^2 = \\left(\\exp(\\sigma^2) - 1\\right) (\\mathbb{E}[X])^2 $$\n这表明 $X$ 的方差与其均值的平方成正比，即 $\\operatorname{Var}(X) \\propto (\\mathbb{E}[X])^2$。因此，标准差与均值成正比，即 $\\operatorname{SD}(X) \\propto \\mathbb{E}[X]$。这种方差对均值的依赖性是一种异方差性。在PCA的背景下，均值较大的变量将具有不成比例的更大方差，导致它们对分析产生不当影响。\n\n方差稳定变换是应用于数据的一个函数 $g$，使得变换后变量 $g(X)$ 的方差近似为常数，且独立于其均值。我们可以使用Delta方法找到一个合适的变换，该方法为随机变量函数的方差提供了一阶近似：\n$$ \\operatorname{Var}(g(X)) \\approx \\left(g'(\\mathbb{E}[X])\\right)^2 \\operatorname{Var}(X) $$\n其中 $g'$ 是 $g$ 的一阶导数。我们寻找一个函数 $g$ 使得 $\\operatorname{Var}(g(X))$ 是一个常数，比如 $c^2$。代入 $X$ 的方差结构，并记 $\\mu_X = \\mathbb{E}[X]$：\n$$ c^2 \\approx \\left(g'(\\mu_X)\\right)^2 \\left(k \\cdot \\mu_X^2\\right) $$\n其中 $k = \\exp(\\sigma^2) - 1$ 是比例常数。为了使左侧为常数，我们需要：\n$$ g'(\\mu_X) \\propto \\frac{1}{\\mu_X} $$\n对这个关于 $\\mu_X$ 的微分方程积分，得到：\n$$ g(\\mu_X) \\propto \\ln(\\mu_X) $$\n因此，对于标准差与均值成正比的乘性误差数据，自然对数是合适的方差稳定变换。应用对数变换将乘性误差结构转换为加性误差结构，稳定了方差，并减轻了右偏，使数据更加对称，从而更好地符合PCA的基本假设。这有力地证明了将其应用于所述临床指标的合理性。\n\n### 第2部分：样本协方差变化的计算\n\n给定 $n=6$ 名患者的两个指标 $A$ 和 $B$ 的数据：\n- 指标 $A$：$\\{1, 1, 2, 8, 32, 64\\}$\n- 指标 $B$：$\\{0.5, 1, 2, 8, 24, 48\\}$\n\n两组观测值 $\\{x_i\\}_{i=1}^n$ 和 $\\{y_i\\}_{i=1}^n$ 之间的样本协方差定义为：\n$$ \\operatorname{Cov}(X,Y) = \\frac{1}{n-1} \\sum_{i=1}^n (x_i - \\bar{x})(y_i - \\bar{y}) $$\n一个计算上等价的公式是 $\\operatorname{Cov}(X,Y) = \\frac{1}{n-1} \\left( \\sum_{i=1}^n x_i y_i - n\\bar{x}\\bar{y} \\right)$。我们将使用这个形式进行计算。\n\n**步骤2.1：计算 $\\operatorname{Cov}(A,B)$**\n\n首先，我们计算样本均值 $\\bar{A}$ 和 $\\bar{B}$：\n$$ \\bar{A} = \\frac{1}{6}(1+1+2+8+32+64) = \\frac{108}{6} = 18 $$\n$$ \\bar{B} = \\frac{1}{6}(0.5+1+2+8+24+48) = \\frac{83.5}{6} $$\n接下来，我们计算乘积和 $\\sum A_i B_i$：\n$$ \\sum_{i=1}^6 A_i B_i = (1)(0.5) + (1)(1) + (2)(2) + (8)(8) + (32)(24) + (64)(48) $$\n$$ \\sum_{i=1}^6 A_i B_i = 0.5 + 1 + 4 + 64 + 768 + 3072 = 3909.5 $$\n现在，我们计算 $n=6$ 时的 $\\operatorname{Cov}(A,B)$：\n$$ \\operatorname{Cov}(A,B) = \\frac{1}{6-1} \\left( \\sum_{i=1}^6 A_i B_i - 6\\bar{A}\\bar{B} \\right) = \\frac{1}{5} \\left( 3909.5 - 6(18)\\left(\\frac{83.5}{6}\\right) \\right) $$\n$$ \\operatorname{Cov}(A,B) = \\frac{1}{5} (3909.5 - 18 \\cdot 83.5) = \\frac{1}{5} (3909.5 - 1503) = \\frac{2406.5}{5} = 481.3 $$\n\n**步骤2.2：计算 $\\operatorname{Cov}(\\ln(A), \\ln(B))$**\n\n设 $A' = \\ln(A)$ 和 $B' = \\ln(B)$。变换后的数据是：\n- $A' = \\{\\ln(1), \\ln(1), \\ln(2), \\ln(8), \\ln(32), \\ln(64)\\} = \\{0, 0, \\ln(2), 3\\ln(2), 5\\ln(2), 6\\ln(2)\\}$\n- $B' = \\{\\ln(0.5), \\ln(1), \\ln(2), \\ln(8), \\ln(24), \\ln(48)\\} = \\{-\\ln(2), 0, \\ln(2), 3\\ln(2), \\ln(3)+3\\ln(2), \\ln(3)+4\\ln(2)\\}$\n样本均值 $\\bar{A'}$ 和 $\\bar{B'}$ 是：\n$$ \\bar{A'} = \\frac{1}{6}(0+0+1+3+5+6)\\ln(2) = \\frac{15}{6}\\ln(2) = \\frac{5}{2}\\ln(2) $$\n$$ \\bar{B'} = \\frac{1}{6}(-\\ln(2) + 0 + \\ln(2) + 3\\ln(2) + \\ln(3)+3\\ln(2) + \\ln(3)+4\\ln(2)) = \\frac{1}{6}(10\\ln(2) + 2\\ln(3)) = \\frac{5}{3}\\ln(2) + \\frac{1}{3}\\ln(3) $$\n乘积和 $\\sum A'_i B'_i$：\n$$ \\sum A'_i B'_i = (0) + (0) + (\\ln(2))(\\ln(2)) + (3\\ln(2))(3\\ln(2)) + (5\\ln(2))(\\ln(3)+3\\ln(2)) + (6\\ln(2))(\\ln(3)+4\\ln(2)) $$\n$$ \\sum A'_i B'_i = (\\ln(2))^2 + 9(\\ln(2))^2 + 5\\ln(2)\\ln(3) + 15(\\ln(2))^2 + 6\\ln(2)\\ln(3) + 24(\\ln(2))^2 $$\n$$ \\sum A'_i B'_i = (1+9+15+24)(\\ln(2))^2 + (5+6)\\ln(2)\\ln(3) = 49(\\ln(2))^2 + 11\\ln(2)\\ln(3) $$\n现在，我们计算 $\\operatorname{Cov}(\\ln(A), \\ln(B))$：\n$$ \\operatorname{Cov}(A', B') = \\frac{1}{5} \\left( \\sum_{i=1}^6 A'_i B'_i - 6\\bar{A'}\\bar{B'} \\right) $$\n项 $6\\bar{A'}\\bar{B'}$ 是：\n$$ 6\\bar{A'}\\bar{B'} = 6 \\left(\\frac{5}{2}\\ln(2)\\right) \\left(\\frac{5}{3}\\ln(2) + \\frac{1}{3}\\ln(3)\\right) = 15\\ln(2) \\left(\\frac{1}{3}(5\\ln(2) + \\ln(3))\\right) = 5\\ln(2)(5\\ln(2) + \\ln(3)) $$\n$$ 6\\bar{A'}\\bar{B'} = 25(\\ln(2))^2 + 5\\ln(2)\\ln(3) $$\n偏差的交叉乘积之和是：\n$$ \\sum_{i=1}^6 (A'_i - \\bar{A'})(B'_i - \\bar{B'}) = (49(\\ln(2))^2 + 11\\ln(2)\\ln(3)) - (25(\\ln(2))^2 + 5\\ln(2)\\ln(3)) $$\n$$ = 24(\\ln(2))^2 + 6\\ln(2)\\ln(3) $$\n所以协方差是：\n$$ \\operatorname{Cov}(\\ln(A), \\ln(B)) = \\frac{1}{5} \\left( 24(\\ln(2))^2 + 6\\ln(2)\\ln(3) \\right) $$\n使用数值 $\\ln(2) \\approx 0.693147$ 和 $\\ln(3) \\approx 1.098612$：\n$$ \\operatorname{Cov}(\\ln(A), \\ln(B)) \\approx \\frac{1}{5} (24(0.480453) + 6(0.761567)) = \\frac{1}{5}(11.530872 + 4.569402) = \\frac{16.100274}{5} \\approx 3.220055 $$\n\n**步骤2.3：计算样本协方差的变化 $\\Delta$**\n\n变化定义为 $\\Delta = \\operatorname{Cov}(\\ln(A),\\ln(B)) - \\operatorname{Cov}(A,B)$。\n$$ \\Delta \\approx 3.220055 - 481.3 = -478.079945 $$\n将结果四舍五入到四位有效数字：\n$$ \\Delta \\approx -478.1 $$",
            "answer": "$$\\boxed{-478.1}$$"
        },
        {
            "introduction": "在构建预测模型时，PCA是一种强大的降维工具，但其应用过程充满了潜在的陷阱。如果将PCA不当地整合到交叉验证流程中，极易导致“数据泄露”，从而产生过于乐观的模型性能评估。本练习通过分析几种不同的建模流程，帮助您辨别并构建一个无泄漏的、严谨的评估方案，这是在临床数据科学领域进行可靠建模的必备技能。",
            "id": "4598164",
            "problem": "一个临床转录组学数据集包含 $n$ 名患者和 $p$ 个信使核糖核酸（mRNA）表达特征，这些数据在治疗开始前收集。对于每位患者 $i \\in \\{1,\\dots,n\\}$，都记录了一个特征向量 $\\mathbf{x}_i \\in \\mathbb{R}^p$ 和一个二元结果标签 $y_i \\in \\{0,1\\}$，该标签指示患者是否在 $2$ 年内出现疾病进展。您打算在 $K$ 折交叉验证（CV）下评估一个基于主成分分析（PCA）的分类器，其中 $K \\ge 2$。\n\n需要使用的基本定义和事实：\n- 交叉验证（CV）通过将数据划分为不相交的训练折和验证折来估计泛化性能，并确保任何在训练折上拟合的函数都应用于验证折，而不使用验证信息进行拟合。\n- 中心化和缩放通过仅使用训练集的统计数据来定义：对于特征 $j$，训练均值 $\\hat{\\mu}_{\\mathcal{T},j}$ 和标准差 $\\hat{\\sigma}_{\\mathcal{T},j}$ 产生标准化坐标 $z_{i,j} = (x_{i,j} - \\hat{\\mu}_{\\mathcal{T},j}) / \\hat{\\sigma}_{\\mathcal{T},j}$。\n- 主成分分析（PCA）计算在训练数据上估计的样本协方差矩阵 $\\hat{\\Sigma}_{\\mathcal{T}}$ 的特征向量，以获得一个投影矩阵 $\\mathbf{V}_{\\mathcal{T}}$ 和得分向量 $\\mathbf{s}_i = \\mathbf{V}_{\\mathcal{T}}^\\top \\mathbf{z}_i$。\n- 无泄漏的流程要求每个依赖于数据的变换（例如，插补、中心化、缩放、批次校正、PCA拟合、超参数调整）都专门在训练折上拟合，并应用于验证折。\n\n请考虑以下提议的流程和关于数据泄漏的陈述。选择所有正确避免了数据泄漏，并正确描述了因使用完整数据进行中心化和缩放而产生泄漏的选项。\n\nA. 从所有 $n$ 名患者的数据中一次性计算中心化和缩放参数 $\\hat{\\mu}_j$ 和 $\\hat{\\sigma}_j$，对所有特征进行标准化，在所有标准化后的患者数据上拟合PCA以获得 $\\mathbf{V}$，然后通过在特定折的训练PCA得分上训练分类器，同时在验证得分上进行评估，来执行 $K$ 折交叉验证。这可以稳定预处理过程并避免泄漏，因为PCA和缩放是无监督的。\n\nB. 对于每个具有训练索引集 $\\mathcal{T}$ 和验证索引集 $\\mathcal{V}$ 的交叉验证折，仅使用 $\\{\\mathbf{x}_i : i \\in \\mathcal{T}\\}$ 来拟合缺失值插补参数、中心化参数 $\\hat{\\mu}_{\\mathcal{T}}$、缩放参数 $\\hat{\\sigma}_{\\mathcal{T}}$ 和PCA投影矩阵 $\\mathbf{V}_{\\mathcal{T}}$。如果要调整主成分数量 $k$，则在 $\\mathcal{T}$ 上进行内部交叉验证来选择 $k$。使用在训练集上拟合的变换来转换 $\\{\\mathbf{x}_i : i \\in \\mathcal{V}\\}$ 并评估分类器。这样可以避免泄漏。\n\nC. 使用留一法交叉验证，即 $K = n$。对于每个留出的患者 $i$，使用所有 $n$ 名患者的数据来计算中心化和缩放参数以稳定估计值，在其余 $n-1$ 名患者上拟合PCA，将留出的患者投影到PCA主成分上，然后进行评估。因为PCA排除了留出的患者，所以没有泄漏。\n\nD. 为减轻批次效应，在所有 $n$ 名患者的数据上拟合一个批次校正模型（如经验贝叶斯ComBat）以去除位点特异性偏移，然后执行 $K$ 折交叉验证，在每一折中，中心化、缩放和PCA仅使用训练患者的数据进行拟合。由于批次校正属于无监督学习，因此对所有患者进行此预处理不会泄漏信息。\n\nE. 实现一个单一的映射流程 $\\phi_{\\mathcal{T}}$，该流程在每个交叉验证折中仅在 $\\mathcal{T}$ 上进行拟合，并依次包含缺失值插补、中心化、缩放、PCA和分类器训练。通过仅使用 $\\mathcal{T}$ 的内部交叉验证来选择超参数（包括主成分数量 $k$ 和分类器正则化参数）。将 $\\phi_{\\mathcal{T}}$ 应用于 $\\mathcal{V}$ 以获得验证预测。这可以避免泄漏，并在独立同分布采样下产生无偏的交叉验证估计。\n\n您的任务：根据以上定义以及验证数据不得影响任何已拟合变换的要求，识别所有正确的选项。在此过程中，请论证当使用完整数据计算中心化和缩放时泄漏是如何产生的，以及在 $p \\gg n$ 且存在潜在批次效应的临床环境中，什么是适用于基于PCA模型的恰当交叉验证流程。",
            "solution": "评估问题陈述的有效性。\n\n### 步骤1：提取给定信息\n- **数据集**：一个临床转录组学数据集，包含 $n$ 名患者和 $p$ 个信使核糖核酸（mRNA）表达特征。\n- **特征向量**：对于每位患者 $i \\in \\{1,\\dots,n\\}$，有 $\\mathbf{x}_i \\in \\mathbb{R}^p$。\n- **结果标签**：对于每位患者，有 $y_i \\in \\{0,1\\}$，指示一个二元结果（2年内疾病进展）。\n- **既定任务**：在 $K$ 折交叉验证（CV）下评估一个基于主成分分析（PCA）的分类器，其中 $K \\ge 2$。\n- **交叉验证（CV）的定义**：将数据划分为不相交的训练折和验证折。在训练折上拟合函数，并将其应用于验证折。拟合时不使用来自验证折的信息。\n- **中心化和缩放的定义**：这些变换使用仅限训练集的统计数据。对于特征 $j$，使用训练均值 $\\hat{\\mu}_{\\mathcal{T},j}$ 和标准差 $\\hat{\\sigma}_{\\mathcal{T},j}$ 来计算标准化坐标 $z_{i,j} = (x_{i,j} - \\hat{\\mu}_{\\mathcal{T},j}) / \\hat{\\sigma}_{\\mathcal{T},j}$。\n- **PCA的定义**：PCA计算在训练数据上估计的样本协方差矩阵 $\\hat{\\Sigma}_{\\mathcal{T}}$ 的特征向量。这会产生一个投影矩阵 $\\mathbf{V}_{\\mathcal{T}}$。得到的得分向量为 $\\mathbf{s}_i = \\mathbf{V}_{\\mathcal{T}}^\\top \\mathbf{z}_i$。\n- **无泄漏流程的定义**：每个依赖于数据的变换（例如，插补、中心化、缩放、批次校正、PCA拟合、超参数调整）都专门在训练折（$\\mathcal{T}$）上拟合，并随后应用于验证折（$\\mathcal{V}$）。\n\n### 步骤2：使用提取的给定信息进行验证\n问题陈述描述了生物信息学和机器学习中一个标准且至关重要的任务：使用交叉验证正确评估预测模型。\n\n- **科学依据充分**：该问题牢固地植根于机器学习和统计学习理论的既定原则。所述场景——高维（$p \\gg n$）转录组学数据集、二元临床结果，以及使用PCA进行降维——是现代生物信息学中的一个典型例子。为CV、缩放、PCA和数据泄漏提供的定义是标准且正确的。\n- **问题定义明确**：该问题的结构使其有确定的答案。它要求识别哪些提议的流程遵循了所提供的、定义明确的无泄漏CV过程原则。这些定义足以明确地对每个选项进行分类。\n- **客观性**：语言技术性强、精确且没有主观性。定义是形式化的，并且在该领域被普遍接受。\n\n问题陈述没有违反任何无效标准。这是一个有效的、定义明确的、并且具有科学相关性的问题，它测试了应用机器学习方法学中的一个关键概念。\n\n### 步骤3：结论与行动\n问题陈述是**有效的**。将通过对照提供的定义分析每个选项来推导出解决方案。\n\n### 推导与选项分析\n\n交叉验证的核心原则是估计模型构建*过程*在未见数据上的性能。这要求在每次迭代中，验证折都必须被当作是真正未见过的数据。流程中任何从数据中“学习”或“拟合”参数的步骤——无论是监督的还是无监督的——都必须只使用该折的训练数据来完成。在训练或预处理阶段使用来自验证折的任何信息都构成**数据泄漏**，这会导致对泛化性能的过于乐观的偏倚估计，因此是无效的。\n\n**对使用完整数据进行中心化和缩放所导致泄漏的定性分析：**\n当中心化和缩放参数（均值 $\\hat{\\mu}_j$ 和标准差 $\\hat{\\sigma}_j$）是基于包含 $n$ 名患者的完整数据集计算时，每个数据点都对这些统计量有贡献。对于任何给定的CV折，验证集 $\\mathcal{V}$ 都参与了用于变换训练集 $\\mathcal{T}$ 的均值和标准差的计算。这违反了保留验证集的原则。模型在“看到”验证集进行评估之前，就被隐式地给予了关于验证数据分布的位置和尺度的信息。这使得验证数据相对于训练好的模型而言，不如真正的新数据那么“陌生”，从而导致人为夸大的性能估计。同样的逻辑也适用于PCA、批次校正或任何其他数据驱动的变换。声称某种方法是“无监督的”（即不使用结果标签 $y_i$）的论点是无关紧要的，因为泄漏与特征数据 $\\mathbf{x}_i$ 有关。\n\n**逐项选项分析：**\n\n**A. 从所有 $n$ 名患者的数据中一次性计算中心化和缩放参数 $\\hat{\\mu}_j$ 和 $\\hat{\\sigma}_j$，对所有特征进行标准化，在所有标准化后的患者数据上拟合PCA以获得 $\\mathbf{V}$，然后通过在特定折的训练PCA得分上训练分类器，同时在验证得分上进行评估，来执行 $K$ 折交叉验证。这可以稳定预处理过程并避免泄漏，因为PCA和缩放是无监督的。**\n\n- **分析**：这个流程明确违反了无泄漏原则。中心化/缩放和PCA都是在CV过程开始*之前*使用所有 $n$ 名患者的数据进行拟合的。这意味着对于每一折，训练过程（包括训练数据的变换）都受到了验证数据的影响。声称这样做是允许的，因为这些方法是“无监督的”，这是一个常见但深刻的谬误。数据泄漏通过特征向量 $\\mathbf{x}_i$ 发生，而不仅仅是通过标签 $y_i$。\n- **结论**：**不正确**。\n\n**B. 对于每个具有训练索引集 $\\mathcal{T}$ 和验证索引集 $\\mathcal{V}$ 的交叉验证折，仅使用 $\\{\\mathbf{x}_i : i \\in \\mathcal{T}\\}$ 来拟合缺失值插补参数、中心化参数 $\\hat{\\mu}_{\\mathcal{T}}$、缩放参数 $\\hat{\\sigma}_{\\mathcal{T}}$ 和PCA投影矩阵 $\\mathbf{V}_{\\mathcal{T}}$。如果要调整主成分数量 $k$，则在 $\\mathcal{T}$ 上进行内部交叉验证来选择 $k$。使用在训练集上拟合的变换来转换 $\\{\\mathbf{x}_i : i \\in \\mathcal{V}\\}$ 并评估分类器。这样可以避免泄漏。**\n\n- **分析**：这个流程正确地描述了恰当的CV过程。所有依赖于数据的拟合步骤（插补、缩放、PCA和通过内部CV进行的超参数调整）都严格限制在每一折的训练集 $\\mathcal{T}$ 内。然后将得到的变换和调优后的模型应用于被留出的验证集 $\\mathcal{V}$。这完全符合无泄漏流程的定义。\n- **结论**：**正确**。\n\n**C. 使用留一法交叉验证，即 $K = n$。对于每个留出的患者 $i$，使用所有 $n$ 名患者的数据来计算中心化和缩放参数以稳定估计值，在其余 $n-1$ 名患者上拟合PCA，将留出的患者投影到PCA主成分上，然后进行评估。因为PCA排除了留出的患者，所以没有泄漏。**\n\n- **分析**：这个流程包含一个关键缺陷。虽然它正确地在 $n-1$ 名训练患者上拟合PCA，但它明确指出中心化和缩放参数是使用所有 $n$ 名患者的数据计算的。这将信息从留出的患者泄漏到了训练数据的预处理中。声称因为PCA步骤正确而避免了泄漏的理由是一种误导，它忽略了缩放步骤的泄漏。虽然来自单个样本的泄漏量可能很小，但这违反了原则，并且该陈述错误地声称没有泄漏。\n- **结论**：**不正确**。\n\n**D. 为减轻批次效应，在所有 $n$ 名患者的数据上拟合一个批次校正模型（如经验贝叶斯ComBat）以去除位点特异性偏移，然后执行 $K$ 折交叉验证，在每一折中，中心化、缩放和PCA仅使用训练患者的数据进行拟合。由于批次校正属于无监督学习，因此对所有患者进行此预处理不会泄漏信息。**\n\n- **分析**：这个流程犯了与选项A相同的根本性错误，只不过这次是批次校正。批次校正模型从数据中学习位置和尺度参数，以协调不同批次之间的分布。在所有 $n$ 名患者上拟合模型意味着任何给定折的验证集信息被用来调整训练集数据（反之亦然）。这是一种数据泄漏形式。后续步骤描述正确，但初始的、全局的批次校正已经污染了CV过程。基于该方法“无监督”性质的理由同样是错误的。\n- **结论**：**不正确**。\n\n**E. 实现一个单一的映射流程 $\\phi_{\\mathcal{T}}$，该流程在每个交叉验证折中仅在 $\\mathcal{T}$ 上进行拟合，并依次包含缺失值插补、中心化、缩放、PCA和分类器训练。通过仅使用 $\\mathcal{T}$ 的内部交叉验证来选择超参数（包括主成分数量 $k$ 和分类器正则化参数）。将 $\\phi_{\\mathcal{T}}$ 应用于 $\\mathcal{V}$ 以获得验证预测。这可以避免泄漏，并在独立同分布采样下产生无偏的交叉验证估计。**\n\n- **分析**：这个选项提供了对一个正确的、无泄漏的CV流程的正式且完整的描述。它将整个模型构建过程概念化为单个映射 $\\phi_{\\mathcal{T}}$，该映射在每个训练折 $\\mathcal{T}$ 上都重新学习。这包括所有预处理、超参数调整（通过在 $\\mathcal{T}$ 上正确指定的嵌套CV）和最终的模型拟合。然后将此复合函数应用于验证折 $\\mathcal{V}$。这个过程避免了泄漏并产生无偏的性能估计（假设数据是独立同分布的），这一结论是这种严谨方法论的主要目标和好处。该陈述完全正确。\n- **结论**：**正确**。",
            "answer": "$$\\boxed{BE}$$"
        }
    ]
}