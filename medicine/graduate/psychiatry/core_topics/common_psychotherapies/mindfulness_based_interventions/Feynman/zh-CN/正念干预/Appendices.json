{
    "hands_on_practices": [
        {
            "introduction": "在启动任何临床试验之前，一个关键的初始步骤是确定研究所需的样本量。这确保研究有足够的统计功效（power）来检测出有临床意义的治疗效果，是伦理和高效研究的基石。本练习  将引导您从基本原理出发，推导并计算一个典型的正念干预研究所需的样本量。",
            "id": "4730090",
            "problem": "一个精神病学研究团队正在计划一项$2$臂平行分组随机对照试验（RCT），旨在比较正念认知疗法（MBCT）与结构上等效的健康教育对照组在复发性重度抑郁症成人患者中的效果。主要结局是在治疗后测量的一个连续的症状严重程度评分（例如，一个经过验证的抑郁量表）。根据先前关于正念干预的文献，该团队的目标是两臂间的标准化均数差（SMD）为 $d=0.40$。假设如下：\n- 每臂的结局独立同分布，近似服从方差相等的正态分布。\n- 分配比例为 $1{:}1$。\n- 要求双侧 I 型错误率为 $\\alpha=0.05$，统计功效为 $1-\\beta=0.80$。\n- 在计划阶段，可接受使用大样本正态近似来处理双样本 $t$ 检验。\n\n从假设检验的基本原理和标准化均数差（SMD）的定义出发，推导出检测目标效应所需的样本量公式，然后计算试验所需的最小总样本量。您必须：\n- 明确地根据 $d$、$\\alpha$ 和 $\\beta$ 推导出每臂所需样本量的表达式，不得直接套用任何预先记忆的简化公式。\n- 使用标准正态分布的临界值，对 $d=0.40$、$\\alpha=0.05$ 和 $1-\\beta=0.80$ 的情况计算该表达式的值。\n- 将最终答案报告为达到指定操作特性所需的最小整数总样本量 $N_{\\text{total}}$（即，取满足要求的最小整数）。仅提供总样本量作为答案。",
            "solution": "根据指定标准对问题进行验证。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n-   研究设计：$2$臂平行分组随机对照试验（RCT）。\n-   干预措施：正念认知疗法（MBCT）。\n-   对照组：结构上等效的健康教育对照组。\n-   人群：复发性重度抑郁症成人患者。\n-   主要结局：连续的症状严重程度评分。\n-   目标效应量：标准化均数差（SMD），$d=0.40$。\n-   假设：\n    1.  每臂的结局独立同分布，近似服从方差相等的正态分布。\n    2.  分配比例为 $1{:}1$。\n    3.  双侧 I 型错误率为 $\\alpha=0.05$。\n    4.  统计功效 $1-\\beta=0.80$。\n    5.  可接受使用大样本正态近似来处理双样本 $t$ 检验。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题基于生物统计学的基本原理，特别是临床试验的统计功效和样本量计算，具有坚实的科学基础。其参数和背景在精神病学研究中是标准且切合实际的。\n-   **适定性**：该问题提供了所有必要信息（$\\alpha$、$\\beta$、$d$、分配比例和检验类型），足以推导出一个唯一且有意义的解。\n-   **客观性**：该问题的陈述语言精确、量化且无偏见。\n-   **完整性与一致性**：该问题是自洽的，没有内在矛盾。各项假设相互一致，并且是此类计算的标准假设。\n\n**步骤3：结论与行动**\n该问题被评估为**有效**。它在科学上是合理的，问题是适定的，并且是客观的。可以并且将会推导出一个严谨的解。\n\n### 推导与求解\n\n设 $\\mu_I$ 和 $\\mu_C$ 分别为干预组（MBCT）和对照组的真实平均症状评分。设 $\\sigma^2$ 为每臂评分的共同方差。由于分配比例为 $1{:}1$ ，每臂的样本量记为 $n$。总样本量为 $N_{\\text{total}} = 2n$。\n\n原假设（$H_0$）和双侧备择假设（$H_A$）如下：\n$$ H_0: \\mu_I = \\mu_C \\quad (\\text{i.e., } \\mu_I - \\mu_C = 0) $$\n$$ H_A: \\mu_I \\neq \\mu_C \\quad (\\text{i.e., } \\mu_I - \\mu_C \\neq 0) $$\n\n设 $\\bar{X}_I$ 和 $\\bar{X}_C$ 为两臂的样本均值。问题允许使用大样本正态近似，因此检验统计量基于正态分布。检验统计量 $Z$ 根据样本均值之差构建：\n$$ Z = \\frac{(\\bar{X}_I - \\bar{X}_C) - (\\mu_I - \\mu_C)}{\\sqrt{\\frac{\\sigma^2}{n} + \\frac{\\sigma^2}{n}}} = \\frac{\\bar{X}_I - \\bar{X}_C - (\\mu_I - \\mu_C)}{\\sigma\\sqrt{\\frac{2}{n}}} $$\n在原假设（$H_0$）下，$\\mu_I - \\mu_C = 0$，因此统计量简化为：\n$$ Z_{H_0} = \\frac{\\bar{X}_I - \\bar{X}_C}{\\sigma\\sqrt{\\frac{2}{n}}} $$\n在 $H_0$ 下，$Z_{H_0}$ 服从标准正态分布 $N(0, 1)$。\n\nI 型错误率 $\\alpha$ 是在 $H_0$ 为真时拒绝它的概率。对于显著性水平为 $\\alpha=0.05$ 的双侧检验，如果 $|Z_{H_0}| > z_{1-\\alpha/2}$，我们就拒绝 $H_0$，其中 $z_{1-\\alpha/2}$ 是标准正态分布的上 $(1-\\alpha/2)$ 分位数。在此，即为 $z_{0.975}$。\n\n统计功效 $1-\\beta$ 是在备择假设 $H_A$ 为真时正确拒绝 $H_0$ 的概率。我们针对由标准化均数差 $d = \\frac{\\mu_I - \\mu_C}{\\sigma}$ 定义的特定备择假设来评估统计功效。设 $\\delta = \\mu_I - \\mu_C$。则 $d = \\delta/\\sigma$。\n在这个特定的备择假设下，检验统计量 $Z_{H_0}$ 不再是标准正态分布。其均值为：\n$$ E[Z_{H_0}] = E\\left[\\frac{\\bar{X}_I - \\bar{X}_C}{\\sigma\\sqrt{\\frac{2}{n}}}\\right] = \\frac{E[\\bar{X}_I - \\bar{X}_C]}{\\sigma\\sqrt{\\frac{2}{n}}} = \\frac{\\delta}{\\sigma\\sqrt{\\frac{2}{n}}} = \\frac{d\\sigma}{\\sigma\\sqrt{\\frac{2}{n}}} = d\\sqrt{\\frac{n}{2}} $$\n统计功效是在 $H_A$ 为真的条件下，观测到的统计量落入拒绝域的概率。\n$$ 1 - \\beta = P(|Z_{H_0}| > z_{1-\\alpha/2} | H_A) $$\n对于正效应量 $d>0$，统计量落入下侧拒绝域的概率可以忽略不计。因此，统计功效主要由上侧决定：\n$$ 1 - \\beta \\approx P(Z_{H_0} > z_{1-\\alpha/2} | H_A) $$\n为计算此概率，我们使用 $Z_{H_0}$ 在 $H_A$ 下的非零均值对其进行标准化：\n$$ 1 - \\beta \\approx P\\left( \\frac{Z_{H_0} - d\\sqrt{\\frac{n}{2}}}{1} > z_{1-\\alpha/2} - d\\sqrt{\\frac{n}{2}} \\right) $$\n现在，概率表达式内左侧的项是一个标准正态变量。设 $Z' \\sim N(0, 1)$。\n$$ 1 - \\beta \\approx P\\left( Z' > z_{1-\\alpha/2} - d\\sqrt{\\frac{n}{2}} \\right) $$\n根据统计功效的定义，我们也有 $1 - \\beta = P(Z' > z_{\\beta}) = P(Z' > -z_{1-\\beta})$。令参数相等可得：\n$$ -z_{1-\\beta} = z_{1-\\alpha/2} - d\\sqrt{\\frac{n}{2}} $$\n现在，我们推导 $n$ 的表达式：\n$$ d\\sqrt{\\frac{n}{2}} = z_{1-\\alpha/2} + z_{1-\\beta} $$\n$$ \\sqrt{n} = \\frac{\\sqrt{2}(z_{1-\\alpha/2} + z_{1-\\beta})}{d} $$\n$$ n = \\frac{2(z_{1-\\alpha/2} + z_{1-\\beta})^2}{d^2} $$\n这就是每臂所需样本量的公式。\n\n接下来，我们使用给定的参数计算该表达式的值：$d=0.40$，$\\alpha=0.05$，以及 $1-\\beta=0.80$。\n这意味着 $\\beta=0.20$。\n我们需要标准正态分位数：\n- 对于双侧显著性水平 $\\alpha=0.05$，临界值为 $z_{1-\\alpha/2} = z_{1-0.025} = z_{0.975} \\approx 1.95996$。\n- 对于统计功效 $1-\\beta=0.80$，临界值为 $z_{1-\\beta} = z_{0.80} \\approx 0.84162$。\n\n将这些值代入推导出的 $n$ 的公式中：\n$$ n = \\frac{2(1.95996 + 0.84162)^2}{(0.40)^2} $$\n$$ n = \\frac{2(2.80158)^2}{0.16} $$\n$$ n = \\frac{2(7.84885...)}{0.16} $$\n$$ n = \\frac{15.6977...}{0.16} $$\n$$ n \\approx 98.11 $$\n由于参与者人数必须是整数，且统计功效必须至少为 $0.80$，我们必须将计算出的 $n$ 值向上取整。\n$$ n_{\\text{per arm}} = \\lceil 98.11 \\rceil = 99 $$\n因此，每臂所需的最小样本量为 $99$。\n总样本量是两臂样本量之和：\n$$ N_{\\text{total}} = n_{\\text{per arm}} + n_{\\text{per arm}} = 99 + 99 = 198 $$\n\n因此，在双侧显著性水平为 $0.05$ 的条件下，要达到 $80\\%$ 的统计功效来检测 $0.40$ 的标准化均数差，所需的最小总样本量为 $198$ 名参与者（每臂 $99$ 名）。",
            "answer": "$$\n\\boxed{198}\n$$"
        },
        {
            "introduction": "随着数字健康技术的发展，我们现在能够收集到关于患者参与度的精细数据，例如家庭练习的时长。本练习  提供了一个仿真的现实世界场景，您将分析来自应用程序（app）的练习日志，以探究正念练习的“剂量”与临床症状改善之间的关系，这是理解正念干预作用机制的核心问题之一。",
            "id": "4730080",
            "problem": "提供给您的是接受正念干预参与者的基于应用的家庭练习日志，以及干预前后使用经过验证的精神科量表测得的症状评分。目标是根据应用日志量化依从性，并使用基于通用原则而非预设公式的剂量-反应模型，计算总练习分钟数（“剂量”）与症状变化之间的关系。您的解决方案必须从基本原理出发，实现一个完成以下任务的完整程序。\n\n基本基础和定义：\n- 心理治疗中的依从性定义为参与者的行为与医疗服务提供者共同商定的建议相符的程度。在当前情境下，建议是每日练习。日志包含每日的练习分钟数。缺失的条目表示当天没有记录日志。\n- 对于每位参与者 $i$，设 $N$ 表示干预期间的计划天数，$m_{i,d}$ 表示第 $d$ 天记录的练习分钟数（缺失值由一个专门的缺失标记明确表示），$\\theta$ 表示将某一天计为依从日的每日分钟数阈值。\n- 将参与者 $i$ 的剂量 $D_i$ 定义为所有有记录天数的累计分钟数，并将缺失日志视为 $0$ 分钟。将参与者 $i$ 的依从比例 $A_i$ 定义为练习分钟数 $m_{i,d} \\ge \\theta$ 的天数除以 $N$。\n- 设 $S_{i,\\text{pre}}$ 和 $S_{i,\\text{post}}$ 分别表示干预前后的症状评分。定义症状变化 $Y_i = S_{i,\\text{pre}} - S_{i,\\text{post}}$，因此较大的 $Y_i$ 代表更显著的症状改善（以量表分数为单位）。\n\n待推导和拟合的剂量-反应模型：\n- 假设一个单调、凹的剂量-反应函数 $f(D)$，满足 $f(0) = 0$，具有有限的渐近最大效应 $E_{\\max}$，并拥有一个特征剂量 $EC_{50}$，其定义为 $f(EC_{50}) = \\frac{1}{2} E_{\\max}$。在观测值 $Y_i$ 围绕均值函数 $f(D_i)$ 的残差服从独立高斯分布的假设下，推导一个符合这些性质的 $f(D)$ 的参数形式。然后，通过高斯最大似然估计（在所述残差假设下等同于非线性最小二乘法）来拟合其参数。\n- 作为比较，同样在高斯残差假设下拟合一个线性模型 $g(D) = \\beta_0 + \\beta_1 D$，并为推导的剂量-反应模型和线性模型计算决定系数 $R^2$。通过比较 $R^2$ 值，判断推导的剂量-反应模型是否至少能解释与线性模型同样多的方差。\n\n依从性量化细节：\n- 将缺失的每日日志明确视作“缺失”，不计为依从日。在计算剂量时，将缺失视为 $0$ 分钟。这对应于临床数据分析中常用的一种保守假设，即缺失反映了未进行练习。\n- 依从性阈值和计划天数因测试用例而异，具体如下所述。\n\n单位和输出规范：\n- 练习分钟数必须以分钟为单位处理和报告。\n- 症状变化必须以量表分数为单位处理和报告。\n- 对于每个测试用例，程序必须输出一个列表，其中包含：参与者的平均依从性（小数，四舍五入到三位小数）、估计的 $E_{\\max}$（量表分数，四舍五入到三位小数）、估计的 $EC_{50}$（分钟，四舍五入到三位小数），以及一个布尔值，如果推导的剂量-反应模型的 $R^2$ 大于或等于线性模型，则为真，否则为假。\n- 将所有测试用例的结果汇总到一行输出中，该输出包含一个由逗号分隔的列表，并用方括号括起来（例如，\"[[x1,y1,z1,b1],[x2,y2,z2,b2],[x3,y3,z3,b3]]\"），其中浮点数四舍五入到三位小数，布尔值保持不变。\n\n测试套件：\n- 测试用例 1（“理想路径”，中等剂量，极少缺失值）：\n  - 计划天数 $N = 14$；依从性阈值 $\\theta = 10$ 分钟/天。\n  - 参与者：$6$。\n  - 每位参与者的每日练习分钟数（长度为 $14$ 的列表；单位为分钟；缺失值用字面量“None”表示）：\n    - P1：[$0$, $0$, $15$, $0$, $0$, $10$, $0$, $5$, $0$, $0$, $0$, $0$, $0$, $0$]\n    - P2：[$0$, $10$, $10$, $0$, $20$, $0$, $0$, $10$, $5$, $0$, $0$, $25$, $0$, $0$]\n    - P3：[$15$, $15$, $0$, $0$, $30$, $0$, $0$, $20$, $20$, $0$, $10$, $20$, $0$, $0$]\n    - P4：[$20$, $20$, $20$, $0$, $30$, $0$, $20$, $20$, $20$, $10$, $20$, $20$, $0$, $0$]\n    - P5：[$25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $0$, $0$]\n    - P6：[$30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $20$, $0$]\n  - 症状评分：\n    - 干预前：[$18$, $18$, $18$, $18$, $18$, $18$]\n    - 干预后：[$16.767$, $15.017$, $14.0$, $13.543$, $12.567$, $12.464$]\n- 测试用例 2（边界情况，大量缺失值和低剂量）：\n  - 计划天数 $N = 14$；依从性阈值 $\\theta = 10$ 分钟/天。\n  - 参与者：$5$。\n  - 每位参与者的每日练习分钟数（缺失值用“None”表示）：\n    - P1：[None, None, $0$, None, $0$, None, None, $0$, None, None, $0$, None, None, None]\n    - P2：[None, $0$, None, $0$, None, $0$, None, $0$, None, $0$, None, $0$, None, $0$]\n    - P3：[None, $0$, $10$, $0$, None, $0$, $0$, None, $10$, $0$, None, $0$, None, $0$]\n    - P4：[$10$, None, $0$, $10$, None, $0$, $10$, None, $0$, $10$, $0$, None, $0$, None]\n    - P5：[None, $15$, None, $15$, $0$, None, $0$, $15$, None, $0$, $15$, None, $0$, None]\n  - 症状评分：\n    - 干预前：[$17$, $16$, $20$, $15$, $19$]\n    - 干预后：[$17.0$, $16.1$, $18.9$, $13.4$, $16.7$]\n- 测试用例 3（高剂量和饱和效应，更长的计划周期）：\n  - 计划天数 $N = 28$；依从性阈值 $\\theta = 15$ 分钟/天。\n  - 参与者：$5$。\n  - 每位参与者的每日练习分钟数：\n    - P1：[$20$, $20$, $0$, $0$, $20$, $0$, $20$, $0$, $0$, $20$, $0$, $0$, $20$, $0$, $20$, $0$, $0$, $0$, $20$, $0$, $0$, $0$, $20$, $0$, $0$, $0$, $20$, $0$]\n    - P2：[$20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $0$, $0$, $0$, $0$, $0$, $0$, $0$, $0$, $0$, $0$, $0$, $0$, $0$]\n    - P3：[$20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $20$, $0$, $0$, $0$, $0$, $0$, $0$, $0$, $0$]\n    - P4：[$25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $25$, $0$, $0$, $0$, $0$, $0$, $0$, $0$, $0$]\n    - P5：[$30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $30$, $0$, $0$, $0$, $0$, $0$, $0$, $0$, $0$]\n  - 症状评分：\n    - 干预前：[$20$, $20$, $20$, $20$, $20$]\n    - 干预后：[$15.4$, $14.8$, $14.0$, $13.2$, $13.0$]\n\n计算和输出要求：\n- 完全按照上述定义实现依从性量化和剂量计算。\n- 按照规定，在高斯残差假设下推导并拟合剂量-反应模型的参数。同时拟合线性比较模型。为两个模型计算 $R^2$。\n- 对于每个测试用例，输出一个包含四个元素的列表：平均依从性（小数）、$E_{\\max}$（量表分数）、$EC_{50}$（分钟）以及一个布尔值，指示推导的剂量-反应模型的 $R^2$ 是否 $\\ge$ 线性模型。所有浮点数必须四舍五入到三位小数。\n- 您的程序应生成一行输出，其中包含一个由逗号分隔的列表形式的结果，并用方括号括起来（例如，\"[[result_case1],[result_case2],[result_case3]]\"）。\n\n程序不应读取任何用户输入；必须使用上面提供的测试套件并确定性地执行。",
            "solution": "该问题被评估为有效。它在科学上基于剂量-反应模型的原理，这是临床研究中的一种标准方法。该问题定义明确，提供了所有必要的定义、数据和约束，以得出一个唯一的、有意义的解决方案。它是客观的，使用了精确的语言和定量措施。所有数据都是自洽且一致的。\n\n在此，我们提供一个完整的解决方案，遵循分步推导和计算计划。\n\n### 步骤 1：依从性、剂量和症状变化的量化\n\n初始步骤涉及处理为每个测试用例提供的原始数据，以计算建模所需的主要变量。对于总共 $P$ 名参与者中的每一位参与者 $i$：\n\n1.  **剂量 ($D_i$)**：剂量定义为在 $N$ 天干预期内的总累计练习分钟数。根据规定，每日日志中的缺失条目（由 `None` 标记表示）被视为 $0$ 分钟练习。设 $m_{i,d}$ 为参与者 $i$ 在第 $d$ 天记录的分钟数。剂量 $D_i$ 计算如下：\n    $$D_i = \\sum_{d=1}^{N} \\tilde{m}_{i,d}$$\n    其中，如果记录了数值，则 $\\tilde{m}_{i,d} = m_{i,d}$；如果第 $d$ 天的日志缺失，则 $\\tilde{m}_{i,d} = 0$。\n\n2.  **依从比例 ($A_i$)**：依从性是相对于每日练习阈值 $\\theta$ 定义的。如果参与者在某一天 $d$ 的记录练习时间达到或超过此阈值，即 $m_{i,d} \\ge \\theta$，则该参与者在该天被视为“依从”。缺失的天数不计为依从。参与者 $i$ 的依从比例是在总计划周期 $N$ 内其依从天数所占的比例：\n    $$A_i = \\frac{1}{N} \\sum_{d=1}^{N} \\mathbb{I}(m_{i,d} \\ge \\theta)$$\n    其中 $\\mathbb{I}(\\cdot)$ 是指示函数，当条件为真时等于 $1$，否则等于 $0$。该条件仅对非缺失的 $m_{i,d}$ 进行评估。队列的平均依从性是个人依从比例的平均值：$\\bar{A} = \\frac{1}{P} \\sum_{i=1}^{P} A_i$。\n\n3.  **症状变化 ($Y_i$)**：结果变量是从干预前 ($S_{i,\\text{pre}}$) 到干预后 ($S_{i,\\text{post}}$) 的症状评分变化。正值表示症状改善。\n    $$Y_i = S_{i,\\text{pre}} - S_{i,\\text{post}}$$\n\n这些计算为每位参与者生成一组配对数据点 $(D_i, Y_i)$，这些数据点构成了剂量-反应模型的基础。\n\n### 步骤 2：剂量-反应模型的推导与设定\n\n该问题要求推导一个参数函数 $f(D)$ 来模拟剂量 $D$ 和症状变化 $Y$ 之间的关系，并受一组特定的生物物理约束：\n1.  **单调性**：效应不能随剂量增加而减少。\n2.  **凹性**：改善的速率随剂量增加而降低（收益递减）。\n3.  **零剂量零效应**：$f(0) = 0$。\n4.  **有限饱和**：当剂量变得非常大时（$D \\to \\infty$），效应趋于一个最大值 $E_{\\max}$。\n5.  **特征剂量 ($EC_{50}$)**：达到最大效应一半时所需的剂量，即 $f(EC_{50}) = \\frac{1}{2} E_{\\max}$。\n\n一个能够优雅地满足所有这些性质的函数形式是标准双曲线，在药理学和酶动力学中通常被称为 Michaelis-Menten 模型或 Emax 模型。我们为 $f(D)$ 提出以下形式：\n$$f(D; E_{\\max}, EC_{50}) = \\frac{E_{\\max} \\cdot D}{EC_{50} + D}$$\n性质验证：\n-   $f(0) = \\frac{E_{\\max} \\cdot 0}{EC_{50} + 0} = 0$。（满足性质 3）\n-   $\\lim_{D\\to\\infty} f(D) = \\lim_{D\\to\\infty} \\frac{E_{\\max} \\cdot D}{EC_{50} + D} = \\lim_{D\\to\\infty} \\frac{E_{\\max}}{EC_{50}/D + 1} = E_{\\max}$。（满足性质 4）\n-   $f(EC_{50}) = \\frac{E_{\\max} \\cdot EC_{50}}{EC_{50} + EC_{50}} = \\frac{E_{\\max} \\cdot EC_{50}}{2 \\cdot EC_{50}} = \\frac{1}{2} E_{\\max}$。（满足性质 5）\n-   关于 $D$ 的一阶导数是 $f'(D) = \\frac{E_{\\max} \\cdot EC_{50}}{(EC_{50} + D)^2}$。假设是治疗效应，其中 $E_{\\max} > 0$ 且 $EC_{50} > 0$，则对于所有 $D \\ge 0$ 都有 $f'(D) > 0$，证实了函数是单调递增的。（满足性质 1）\n-   二阶导数是 $f''(D) = -2 \\frac{E_{\\max} \\cdot EC_{50}}{(EC_{50} + D)^3}$。对于 $D \\ge 0$，$f''(D)  0$，证实了函数是凹的。（满足性质 2）\n\n这个函数 $f(D)$（带有参数 $E_{\\max}$ 和 $EC_{50}$）将被用于拟合数据。\n\n### 步骤 3：模型拟合与比较\n\n推导的剂量-反应模型和线性比较模型的参数都是通过最小化残差平方和来估计的，这在独立同分布高斯残差的假设下等同于最大似然估计。\n\n-   **推导模型**：找到使 $\\sum_{i=1}^{P} (Y_i - f(D_i; E_{\\max}, EC_{50}))^2$ 最小化的 $(\\hat{E}_{\\max}, \\hat{EC}_{50})$。\n-   **线性模型**：比较模型为 $g(D) = \\beta_0 + \\beta_1 D$。我们找到使 $\\sum_{i=1}^{P} (Y_i - (\\beta_0 + \\beta_1 D_i))^2$ 最小化的 $(\\hat{\\beta}_0, \\hat{\\beta}_1)$。\n\n这些最小化问题将使用 Levenberg-Marquardt 算法进行数值求解，该算法在 `scipy.optimize.curve_fit` 中实现。\n\n为了比较模型，我们为每个拟合计算决定系数 $R^2$。$R^2$ 量化了因变量 ($Y_i$) 中可由自变量 ($D_i$) 预测的方差比例。\n\n$$R^2 = 1 - \\frac{SS_{\\text{res}}}{SS_{\\text{tot}}}$$\n其中：\n-   总平方和为 $SS_{\\text{tot}} = \\sum_{i=1}^{P} (Y_i - \\bar{Y})^2$，其中 $\\bar{Y}$ 是观测到的症状变化的平均值。\n-   残差平方和为 $SS_{\\text{res}} = \\sum_{i=1}^{P} (Y_i - \\hat{Y}_i)^2$，其中 $\\hat{Y}_i$ 是模型的预测值（$f(D_i)$ 或 $g(D_i)$）。\n\n我们将为推导模型计算 $R^2_{\\text{Emax}}$，为线性模型计算 $R^2_{\\text{linear}}$。每个测试用例的最终布尔结果由条件 $R^2_{\\text{Emax}} \\ge R^2_{\\text{linear}}$ 确定。\n\n实现过程将按顺序处理每个测试用例，执行这些计算并将结果——平均依从性、$\\hat{E}_{\\max}$、$\\hat{EC}_{50}$ 和布尔比较——整理成指定的最终输出格式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Solves the dose-response modeling problem for all specified test cases.\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"N\": 14, \"theta\": 10,\n            \"minutes\": [\n                [0, 0, 15, 0, 0, 10, 0, 5, 0, 0, 0, 0, 0, 0],\n                [0, 10, 10, 0, 20, 0, 0, 10, 5, 0, 0, 25, 0, 0],\n                [15, 15, 0, 0, 30, 0, 0, 20, 20, 0, 10, 20, 0, 0],\n                [20, 20, 20, 0, 30, 0, 20, 20, 20, 10, 20, 20, 0, 0],\n                [25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 0, 0],\n                [30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 20, 0]\n            ],\n            \"scores_pre\": [18, 18, 18, 18, 18, 18],\n            \"scores_post\": [16.767, 15.017, 14.0, 13.543, 12.567, 12.464]\n        },\n        {\n            \"N\": 14, \"theta\": 10,\n            \"minutes\": [\n                [None, None, 0, None, 0, None, None, 0, None, None, 0, None, None, None],\n                [None, 0, None, 0, None, 0, None, 0, None, 0, None, 0, None, 0],\n                [None, 0, 10, 0, None, 0, 0, None, 10, 0, None, 0, None, 0],\n                [10, None, 0, 10, None, 0, 10, None, 0, 10, 0, None, 0, None],\n                [None, 15, None, 15, 0, None, 0, 15, None, 0, 15, None, 0, None]\n            ],\n            \"scores_pre\": [17, 16, 20, 15, 19],\n            \"scores_post\": [17.0, 16.1, 18.9, 13.4, 16.7]\n        },\n        {\n            \"N\": 28, \"theta\": 15,\n            \"minutes\": [\n                [20, 20, 0, 0, 20, 0, 20, 0, 0, 20, 0, 0, 20, 0, 20, 0, 0, 0, 20, 0, 0, 0, 20, 0, 0, 0, 20, 0],\n                [20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n                [20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 0, 0, 0, 0, 0, 0, 0, 0],\n                [25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 0, 0, 0, 0, 0, 0, 0, 0],\n                [30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 0, 0, 0, 0, 0, 0, 0, 0]\n            ],\n            \"scores_pre\": [20, 20, 20, 20, 20],\n            \"scores_post\": [15.4, 14.8, 14.0, 13.2, 13.0]\n        }\n    ]\n    \n    # Emax dose-response model\n    def emax_model(D, E_max, EC_50):\n        # To avoid division by zero if EC50 is negative during fitting\n        return (E_max * D) / (EC_50 + D)\n\n    # Linear comparator model\n    def linear_model(D, beta_0, beta_1):\n        return beta_0 + beta_1 * D\n\n    # R-squared calculation\n    def calculate_r_squared(y_true, y_pred):\n        ss_tot = np.sum((y_true - np.mean(y_true))**2)\n        ss_res = np.sum((y_true - y_pred)**2)\n        # Handle case where ss_tot is zero to avoid division by zero error\n        if ss_tot == 0:\n            return 1.0 if ss_res == 0 else 0.0\n        return 1 - (ss_res / ss_tot)\n\n    all_results = []\n\n    for case in test_cases:\n        N = case[\"N\"]\n        theta = case[\"theta\"]\n        minutes_data = case[\"minutes\"]\n        scores_pre = np.array(case[\"scores_pre\"])\n        scores_post = np.array(case[\"scores_post\"])\n\n        num_participants = len(minutes_data)\n        doses = np.zeros(num_participants)\n        adherence_proportions = np.zeros(num_participants)\n\n        for i in range(num_participants):\n            participant_minutes = minutes_data[i]\n            total_minutes = 0\n            adherent_days = 0\n            for m in participant_minutes:\n                if m is not None:\n                    total_minutes += m\n                    if m = theta:\n                        adherent_days += 1\n            doses[i] = total_minutes\n            adherence_proportions[i] = adherent_days / N\n        \n        mean_adherence = np.mean(adherence_proportions)\n        symptom_changes = scores_pre - scores_post\n\n        # Fit Emax model\n        try:\n            # Provide reasonable initial guesses to aid convergence\n            p0_emax = [np.max(symptom_changes), np.median(doses)]\n            params_emax, _ = curve_fit(emax_model, doses, symptom_changes, p0=p0_emax, maxfev=5000)\n            E_max_fit, EC_50_fit = params_emax\n        except RuntimeError:\n            E_max_fit, EC_50_fit = np.nan, np.nan\n\n        # Fit linear model\n        try:\n            p0_linear = [0, 1]\n            params_linear, _ = curve_fit(linear_model, doses, symptom_changes, p0=p0_linear)\n            beta0_fit, beta1_fit = params_linear\n        except RuntimeError:\n            beta0_fit, beta1_fit = np.nan, np.nan\n\n\n        # Calculate R-squared for both models\n        y_pred_emax = emax_model(doses, E_max_fit, EC_50_fit)\n        r2_emax = calculate_r_squared(symptom_changes, y_pred_emax)\n\n        y_pred_linear = linear_model(doses, beta0_fit, beta1_fit)\n        r2_linear = calculate_r_squared(symptom_changes, y_pred_linear)\n        \n        is_emax_better_or_equal = r2_emax = r2_linear\n\n        result_case = [\n            round(mean_adherence, 3),\n            round(E_max_fit, 3),\n            round(EC_50_fit, 3),\n            is_emax_better_or_equal\n        ]\n        all_results.append(result_case)\n\n    # Format the final output string as a list of lists.\n    # str(list) automatically adds spaces, which is fine according to typical JSON/list string representations.\n    # The prompt's template `','.join(map(str, results))` suggests this rendering is acceptable.\n    final_output_str = f\"[{','.join(map(str, all_results))}]\"\n    \n    # Python's str(list) adds spaces, e.g., '[1, 2, 3]'. To match '[1,2,3]' we rebuild.\n    # Although the ambiguity of the prompt format allows for spaces, this is more precise.\n    inner_strs = []\n    for res in all_results:\n        # Manually format each inner list without spaces\n        inner_str = f\"[{res[0]},{res[1]},{res[2]},{str(res[3]).lower() if isinstance(res[3], bool) else res[3]}]\"\n        inner_strs.append(inner_str)\n    \n    # The problem description is slightly ambiguous here.\n    # Example format: [[x1,y1,z1,b1],[x2,y2,z2,b2]] -> implies lowercase boolean\n    # Python str(True) is \"True\".\n    # We will generate python-standard boolean strings (\"True\", \"False\") as it is more common and less ambiguous\n    # than converting to lower case without explicit instruction.\n    # The format `f\"[{','.join(map(str, all_results))}]\"` produces python standard bools.\n    \n    print(final_output_str.replace(\" \", \"\"))\n\nsolve()\n\n```"
        },
        {
            "introduction": "当一项临床试验得出统计上显著的结果后，我们还必须评估其临床意义。本练习  介绍“需治数”（Number Needed to Treat, NNT）这一重要指标。NNT将统计结果转化为一个直观的疗效衡量标准，帮助临床医生和决策者判断干预措施的实际应用价值。",
            "id": "4730132",
            "problem": "一项院内随机对照试验 (RCT) 比较了一项为期 $8$ 周的正念认知疗法 (MBCT)——一种正念干预 (MBI)——与一项针对患有广泛性焦虑障碍 (GAD) 的成年人的积极对照条件——压力管理教育 (SME) 的效果。缓解被预先定义为，在急性期结束时，在广泛性焦虑障碍7项量表 (GAD-7) 上的得分达到并维持 $\\leq 4$ 至少连续 $4$ 周。\n\n在符合方案分析中，$n_{1} = 200$ 名参与者被随机分配到 MBCT 组，$n_{0} = 200$ 名被分配到 SME 组。其中，MBCT 组有 $k_{1} = 72$ 人实现缓解，SME 组有 $k_{0} = 48$ 人实现缓解。假设满足由随机化引出的标准因果推断条件，包括可交换性、一致性和稳定单元处理值假设 (SUTVA)。将每个组内的个体缓解结果视为独立伯努利随机变量的实现。\n\n仅使用事件概率、作为缓解概率之差的绝对风险降低以及定义为“平均每多获得一例缓解，需要用 MBCT 替代 SME 治疗的患者数量”的临床效用指标这些基本定义，推导出适当的估计量并根据数据计算其值。使用常规报告规则报告需治数 (NNT)，即取大于或等于绝对风险降低精确倒数的最小整数。以单一数字形式提供 NNT。此外，解读该结果是否达到了预设的临床意义服务水平阈值（该指标为 $10$ 或更小），并从第一性原理出发证明你的结论。\n\n你的最终答案必须是一个不带单位的单一数字。任何地方都不要使用百分号。如果需要取整，仅应用上述指定的常规 NNT 报告规则。",
            "solution": "问题陈述已经过严格验证，被认为是科学上可靠、定义明确、客观且信息自足的。它呈现了一个基于随机对照试验 (RCT) 数据的标准生物统计学分析场景。所有必要信息均已提供，定义清晰且与临床流行病学和因果推断的既定原则一致。因此，可以提供一个完整且合理的解答。\n\n目标是计算需治数 (NNT) 并根据给定的阈值解释其临床意义。\n\n首先，我们定义感兴趣的参数。设 $p_1$ 为正念认知疗法 (MBCT) 组参与者实现缓解的真实概率，设 $p_0$ 为压力管理教育 (SME) 组参与者实现缓解的真实概率。问题陈述指出，个体缓解结果应被视为独立的伯努利随机变量。\n\n符合方案分析提供的数据如下：\n-   MBCT 组参与者人数：$n_{1} = 200$。\n-   MBCT 组缓解人数：$k_{1} = 72$。\n-   SME 组参与者人数：$n_{0} = 200$。\n-   SME 组缓解人数：$k_{0} = 48$。\n\n真实缓解概率 $p_1$ 和 $p_0$ 的无偏估计量和最大似然估计量是各组的样本比例。设 $\\hat{p}_1$ 和 $\\hat{p}_0$ 表示这些估计量。\n\nMBCT 组的估计缓解概率为：\n$$\n\\hat{p}_1 = \\frac{k_{1}}{n_{1}} = \\frac{72}{200} = 0.36\n$$\nSME 组的估计缓解概率为：\n$$\n\\hat{p}_0 = \\frac{k_{0}}{n_{0}} = \\frac{48}{200} = 0.24\n$$\n\n绝对风险降低 (ARR) 定义为治疗组和对照组之间有利结局概率的差异。在本案例中，有利结局是缓解。\n$$\nARR = p_1 - p_0\n$$\nARR 的样本估计量，记为 $\\widehat{ARR}$，使用样本比例计算：\n$$\n\\widehat{ARR} = \\hat{p}_1 - \\hat{p}_0 = 0.36 - 0.24 = 0.12\n$$\n这个值 $\\widehat{ARR}=0.12$，表示与 SME 相比，归因于 MBCT 的缓解率增加了 $12$ 个百分点。\n\n接下来，我们按要求从第一性原理推导 NNT。NNT 定义为，为了平均多实现一例有利结局（缓解），需要用干预措施 (MBCT) 替代对照措施 (SME) 治疗的患者数量。\n\n设 $N$ 为接受治疗的患者数量。如果这 $N$ 名患者接受 MBCT，预期缓解人数为 $E[\\text{Remissions}_{\\text{MBCT}}] = N \\times p_1$。如果这相同的 $N$ 名患者接受 SME，预期缓解人数为 $E[\\text{Remissions}_{\\text{SME}}] = N \\times p_0$。\n\n通过用 MBCT 替代 SME 治疗这 $N$ 名患者所获得的预期*额外*缓解人数是这些期望值的差：\n$$\nE[\\text{Additional Remissions}] = (N \\times p_1) - (N \\times p_0) = N \\times (p_1 - p_0) = N \\times ARR\n$$\n为了求 NNT，我们将预期额外缓解人数设为 $1$：\n$$\n1 = NNT \\times ARR\n$$\n解出 NNT 得到公式：\n$$\nNNT = \\frac{1}{ARR}\n$$\n因此，NNT 的估计量是估计的 ARR 的倒数：\n$$\n\\widehat{NNT}_{\\text{exact}} = \\frac{1}{\\widehat{ARR}}\n$$\n使用计算出的 $\\widehat{ARR}$，我们计算 NNT 估计量的精确值：\n$$\n\\widehat{NNT}_{\\text{exact}} = \\frac{1}{0.12} = \\frac{1}{12/100} = \\frac{100}{12} = \\frac{25}{3} \\approx 8.333...\n$$\n问题指定了 NNT 的常规报告规则：必须报告为大于或等于精确值的最小整数。这等同于应用向上取整函数 $\\lceil \\cdot \\rceil$。\n$$\nNNT_{\\text{reported}} = \\lceil \\widehat{NNT}_{\\text{exact}} \\rceil = \\lceil \\frac{25}{3} \\rceil = \\lceil 8.333... \\rceil = 9\n$$\n计算出的 NNT 为 $9$。这意味着，平均而言，每 $9$ 名 GAD 患者使用 MBCT 替代 SME 进行治疗，就会多有一名患者实现缓解。\n\n最后，我们必须根据预设的临床意义服务水平阈值（即 NNT 为 $10$ 或更小）来解释这一结果。我们计算出的 NNT 是 $9$。由于 $9 \\leq 10$，该结果达到了临床意义的阈值。较低的 NNT 表示治疗更有效，因为只需治疗较少的患者即可看到一个额外的益处。因此，根据该试验的预先设定标准，MBCT 优于 SME 且 NNT 为 $9$ 的这一发现被认为具有临床意义。",
            "answer": "$$\n\\boxed{9}\n$$"
        }
    ]
}