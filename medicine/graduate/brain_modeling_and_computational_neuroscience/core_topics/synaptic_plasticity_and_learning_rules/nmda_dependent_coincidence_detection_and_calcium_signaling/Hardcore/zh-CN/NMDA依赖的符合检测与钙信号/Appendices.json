{
    "hands_on_practices": [
        {
            "introduction": "NMDA受体的核心功能是作为分子“重合检测器”，而这一特性根本上源于其独特的电压依赖性镁离子（$\\mathrm{Mg}^{2+}$）阻断机制。本练习将引导你从生物物理学的第一性原理出发，推导出这种电压依赖性。通过亲自构建基于Woodhull模型的方程，你将深刻理解为何突触后膜的去极化是解除$\\mathrm{Mg}^{2+}$阻断、从而允许钙离子内流的必要条件。",
            "id": "4005615",
            "problem": "考虑一个在脉冲时间依赖性重合检测过程中，由N-甲基-D-天冬氨酸（NMDA）受体介导的钙信号的单突触模型。其基本机制是细胞外镁离子 $\\left[\\mathrm{Mg}^{2+}\\right]$ 在膜电场内的一个结合位点上产生的电压依赖性阻断。假设以下基本生物物理事实：\n\n- 一个价为 $z$ 的二价离子，在距离细胞外侧分数电距离为 $\\delta$ 的单个阻断位点的平衡占据率，受一个玻尔兹曼因子支配，该因子根据 $K_{d}(V) = K_{d}^{0}\\,\\exp\\!\\left(\\frac{z\\,\\delta\\,F\\,V}{R\\,T}\\right)$ 修改了表观解离常数，其中 $K_{d}^{0}$ 是 $V=0$ 时的解离常数，$F$ 是法拉第常数，$R$ 是气体常数，$T$ 是绝对温度。\n- 在重合瞬间，谷氨酸快速结合且通道开放的情况下，未被镁离子阻断的NMDA通道的瞬时分数，由电压 $V$ 下未被占据的结合位点的分数给出。\n\n将未阻断分数 $b(V)$ 定义为在膜电位 $V$ 下未被 $\\mathrm{Mg}^{2+}$ 阻断的通道分数，该分数由阻断剂浓度和结合位点占据率之间的平衡推导得出。当 $b(V)$ 超过一个阈值 $b^{\\ast}$ 时，便实现了有效的重合检测，该阈值由激活下游信号通路所需的钙微域需求决定。对于本问题，取 $b^{\\ast} = 0.20$。\n\n使用上述物理基础和定义，推导出当 $b(V^{\\ast}) = b^{\\ast}$ 时的膜电位 $V^{\\ast}$ 作为 $\\left[\\mathrm{Mg}^{2+}\\right]$, $K_{d}^{0}$, $z$, $\\delta$, $F$, $R$ 和 $T$ 的函数表达式。然后，对于一个静息电位为 $V_{\\mathrm{rest}} = -65 \\ \\mathrm{mV}$ 的神经元，计算在两种细胞外镁离子浓度下（$\\left[\\mathrm{Mg}^{2+}\\right] = 1.0 \\ \\mathrm{mM}$ 和 $\\left[\\mathrm{Mg}^{2+}\\right] = 2.0 \\ \\mathrm{mM}$）所需的去极化 $\\Delta V = V^{\\ast} - V_{\\mathrm{rest}}$。\n\n使用 $z = 2$, $\\delta = 0.70$, $F = 96485 \\ \\mathrm{C} \\ \\mathrm{mol}^{-1}$, $R = 8.314 \\ \\mathrm{J} \\ \\mathrm{mol}^{-1} \\ \\mathrm{K}^{-1}$, $T = 310 \\ \\mathrm{K}$ 和 $K_{d}^{0} = 1.0 \\ \\mathrm{mM}$。以 $\\mathrm{mV}$ 为单位表示最终的去极化值。将答案四舍五入至四位有效数字。",
            "solution": "问题陈述被认为是有效的，因为它有科学依据、适定、客观且内部一致。它描述了一个标准的NMDA受体功能生物物理模型（Woodhull模型），并提出了一个可解的定量问题。\n\n第一步是推导NMDA通道未阻断分数 $b(V)$ 的显式表达式。镁离子 $\\mathrm{Mg}^{2+}$ 与通道孔内阻断位点的结合可以描述为一个可逆反应：\n$$\n\\text{未阻断通道} + \\mathrm{Mg}^{2+} \\rightleftharpoons \\text{已阻断通道}\n$$\n在平衡状态下，反应物和产物浓度之间的关系由解离常数 $K_{d}$ 定义。在此背景下，实体是各种状态的分数，因此我们考虑未阻断位点的分数 $b$ 和已阻断位点的分数 $1-b$。阻断剂是细胞外镁离子浓度 $\\left[\\mathrm{Mg}^{2+}\\right]$。电压依赖性解离常数 $K_{d}(V)$ 表示为：\n$$\nK_{d}(V) = \\frac{b \\cdot \\left[\\mathrm{Mg}^{2+}\\right]}{1-b}\n$$\n这个方程可以重排以求解未阻断分数 $b$，我们将其记为 $b(V)$ 以明确其电压依赖性：\n$$\nK_{d}(V) (1-b(V)) = b(V) \\left[\\mathrm{Mg}^{2+}\\right]\n$$\n$$\nK_{d}(V) = b(V) K_{d}(V) + b(V) \\left[\\mathrm{Mg}^{2+}\\right] = b(V) \\left( K_{d}(V) + \\left[\\mathrm{Mg}^{2+}\\right] \\right)\n$$\n$$\nb(V) = \\frac{K_{d}(V)}{K_{d}(V) + \\left[\\mathrm{Mg}^{2+}\\right]} = \\frac{1}{1 + \\frac{\\left[\\mathrm{Mg}^{2+}\\right]}{K_{d}(V)}}\n$$\n问题给出了电压依赖性解离常数的表达式：\n$$\nK_{d}(V) = K_{d}^{0}\\,\\exp\\!\\left(\\frac{z\\,\\delta\\,F\\,V}{R\\,T}\\right)\n$$\n其中 $K_{d}^{0}$ 是 $V=0$ 时的解离常数，$z$ 是离子价，$δ$ 是结合位点的分数电距离，$F$ 是法拉第常数，$R$ 是气体常数，$T$ 是绝对温度。\n\n将此代入 $b(V)$ 的表达式可得：\n$$\nb(V) = \\frac{1}{1 + \\frac{\\left[\\mathrm{Mg}^{2+}\\right]}{K_{d}^{0}\\,\\exp\\!\\left(\\frac{z\\,\\delta\\,F\\,V}{R\\,T}\\right)}} = \\frac{1}{1 + \\frac{\\left[\\mathrm{Mg}^{2+}\\right]}{K_{d}^{0}} \\exp\\!\\left(-\\frac{z\\,\\delta\\,F\\,V}{R\\,T}\\right)}\n$$\n问题要求推导出当未阻断分数达到阈值 $b^{\\ast}$ 时的膜电位 $V^{\\ast}$ 的表达式。我们设 $b(V^{\\ast}) = b^{\\ast}$：\n$$\nb^{\\ast} = \\frac{1}{1 + \\frac{\\left[\\mathrm{Mg}^{2+}\\right]}{K_{d}^{0}} \\exp\\!\\left(-\\frac{z\\,\\delta\\,F\\,V^{\\ast}}{R\\,T}\\right)}\n$$\n现在我们求解 $V^{\\ast}$：\n$$\n\\frac{1}{b^{\\ast}} = 1 + \\frac{\\left[\\mathrm{Mg}^{2+}\\right]}{K_{d}^{0}} \\exp\\!\\left(-\\frac{z\\,\\delta\\,F\\,V^{\\ast}}{R\\,T}\\right)\n$$\n$$\n\\frac{1}{b^{\\ast}} - 1 = \\frac{1-b^{\\ast}}{b^{\\ast}} = \\frac{\\left[\\mathrm{Mg}^{2+}\\right]}{K_{d}^{0}} \\exp\\!\\left(-\\frac{z\\,\\delta\\,F\\,V^{\\ast}}{R\\,T}\\right)\n$$\n$$\n\\frac{K_{d}^{0}}{\\left[\\mathrm{Mg}^{2+}\\right]} \\frac{1-b^{\\ast}}{b^{\\ast}} = \\exp\\!\\left(-\\frac{z\\,\\delta\\,F\\,V^{\\ast}}{R\\,T}\\right)\n$$\n对两边取自然对数：\n$$\n\\ln\\left(\\frac{K_{d}^{0}}{\\left[\\mathrm{Mg}^{2+}\\right]} \\frac{1-b^{\\ast}}{b^{\\ast}}\\right) = -\\frac{z\\,\\delta\\,F\\,V^{\\ast}}{R\\,T}\n$$\n最后，分离出 $V^{\\ast}$：\n$$\nV^{\\ast} = -\\frac{R\\,T}{z\\,\\delta\\,F} \\ln\\left(\\frac{K_{d}^{0}}{\\left[\\mathrm{Mg}^{2+}\\right]} \\frac{1-b^{\\ast}}{b^{\\ast}}\\right)\n$$\n利用性质 $\\ln(1/x) = -\\ln(x)$，我们可以将其写成更方便的形式：\n$$\nV^{\\ast} = \\frac{R\\,T}{z\\,\\delta\\,F} \\ln\\left(\\frac{\\left[\\mathrm{Mg}^{2+}\\right]}{K_{d}^{0}} \\frac{b^{\\ast}}{1-b^{\\ast}}\\right)\n$$\n这就是阈电位 $V^{\\ast}$ 的通用表达式。\n\n接下来，我们计算两种指定情况下 $V^{\\ast}$ 的数值和所需的去极化 $\\Delta V = V^{\\ast} - V_{\\mathrm{rest}}$。给定的参数如下：\n$z = 2$\n$\\delta = 0.70$\n$F = 96485 \\ \\mathrm{C} \\ \\mathrm{mol}^{-1}$\n$R = 8.314 \\ \\mathrm{J} \\ \\mathrm{mol}^{-1} \\ \\mathrm{K}^{-1}$\n$T = 310 \\ \\mathrm{K}$\n$K_{d}^{0} = 1.0 \\ \\mathrm{mM}$\n$b^{\\ast} = 0.20$\n$V_{\\mathrm{rest}} = -65 \\ \\mathrm{mV}$\n\n首先，我们计算常数前置因子 $\\frac{R\\,T}{z\\,\\delta\\,F}$：\n$$\n\\frac{R\\,T}{z\\,\\delta\\,F} = \\frac{(8.314 \\ \\mathrm{J} \\ \\mathrm{mol}^{-1} \\ \\mathrm{K}^{-1})(310 \\ \\mathrm{K})}{(2)(0.70)(96485 \\ \\mathrm{C} \\ \\mathrm{mol}^{-1})} = \\frac{2577.34}{135079} \\ \\mathrm{V} \\approx 0.0190801 \\ \\mathrm{V} = 19.0801 \\ \\mathrm{mV}\n$$\n以及包含 $b^{\\ast}$ 的项：\n$$\n\\frac{b^{\\ast}}{1-b^{\\ast}} = \\frac{0.20}{1-0.20} = \\frac{0.20}{0.80} = 0.25\n$$\n因此 $V^{\\ast}$ 的表达式变为：\n$$\nV^{\\ast} = (19.0801 \\ \\mathrm{mV}) \\ln\\left(\\frac{\\left[\\mathrm{Mg}^{2+}\\right]}{1.0 \\ \\mathrm{mM}} \\times 0.25\\right)\n$$\n\n情况 1：$\\left[\\mathrm{Mg}^{2+}\\right] = 1.0 \\ \\mathrm{mM}$\n$$\nV_{1}^{\\ast} = (19.0801 \\ \\mathrm{mV}) \\ln\\left(\\frac{1.0}{1.0} \\times 0.25\\right) = (19.0801 \\ \\mathrm{mV}) \\ln(0.25) \\approx (19.0801 \\ \\mathrm{mV})(-1.38629) \\approx -26.4565 \\ \\mathrm{mV}\n$$\n所需的去极化为：\n$$\n\\Delta V_{1} = V_{1}^{\\ast} - V_{\\mathrm{rest}} \\approx -26.4565 \\ \\mathrm{mV} - (-65 \\ \\mathrm{mV}) = 38.5435 \\ \\mathrm{mV}\n$$\n四舍五入到四位有效数字，$\\Delta V_{1} = 38.54 \\ \\mathrm{mV}$。\n\n情况 2：$\\left[\\mathrm{Mg}^{2+}\\right] = 2.0 \\ \\mathrm{mM}$\n$$\nV_{2}^{\\ast} = (19.0801 \\ \\mathrm{mV}) \\ln\\left(\\frac{2.0}{1.0} \\times 0.25\\right) = (19.0801 \\ \\mathrm{mV}) \\ln(0.5) \\approx (19.0801 \\ \\mathrm{mV})(-0.693147) \\approx -13.2282 \\ \\mathrm{mV}\n$$\n所需的去极化为：\n$$\n\\Delta V_{2} = V_{2}^{\\ast} - V_{\\mathrm{rest}} \\approx -13.2282 \\ \\mathrm{mV} - (-65 \\ \\mathrm{mV}) = 51.7718 \\ \\mathrm{mV}\n$$\n四舍五入到四位有效数字，$\\Delta V_{2} = 51.77 \\ \\mathrm{mV}$。\n\n结果表明，当细胞外镁离子浓度较高时，需要更大的去极化来解除镁离子的阻断，这与生物物理学原理是一致的。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n38.54  51.77\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在掌握了NMDA受体门控的基础物理原理之后，我们可以构建一个更完整的计算模型，以动态地模拟树突棘中发生的真实生理过程。这项练习要求你通过编程来计算当突触前谷氨酸能输入与一个反向传播的动作电位（bAP）在时间上重合时，通过NMDA受体和电压门控钙通道（VGCCs）进入细胞的总钙离子量。这不仅能让你直观地看到“重合检测”如何转化为一个具体的、可量化的钙信号，也为理解尖峰时刻依赖可塑性（STDP）的诱导机制奠定了基础。",
            "id": "4005633",
            "problem": "要求您计算一个树突隔室中每个尖峰对的总钙内流，该隔室接收单个谷氨酸能输入和背向传播动作电位，使用一个基于电导的模型，该模型包含 N-甲基-D-天冬氨酸（NMDA）受体和电压门控钙通道（VGCC）的典型生物物理组件。该模型包含 NMDA 受体的电压依赖性镁离子阻断、NMDA 电流的钙离子组分以及 VGCC 的电压依赖性激活。您的解决方案必须实现指定的膜电压和谷氨酸门控波形，推导出钙电流，并将其随时间积分以获得电荷。\n\n使用的基本原理和定义：\n\n- 使用线性电流关系 $I = g \\cdot a(V,t) \\cdot (V - E)$，其中 $I$ 是电流，$g$ 是最大电导，$a(V,t)$ 是一个可能依赖于电压 $V$ 和时间 $t$ 的门控或调制因子，$E$ 是反转电位。当应用于 NMDA 时，$a(V,t)$ 是谷氨酸门控波形和镁离子阻断因子的乘积。当应用于 VGCC 时，$a(V,t)$ 是稳态激活函数。\n\n- 使用电荷的定义，即电流的时间积分，$Q = \\int I(t) \\, dt$。将钙内流定义为正值，对应内向钙电流。如果 $I_{\\mathrm{Ca}}(t)$ 为负（内向），则内流为 $Q_{\\mathrm{influx}} = -\\int I_{\\mathrm{Ca}}(t) \\, dt$。\n\n- 使用广泛接受的 NMDA 经验性镁离子阻断公式：\n$$B(V) = \\frac{1}{1 + \\left(\\frac{[\\mathrm{Mg}]}{3.57}\\right) \\exp(-0.062 \\, V)}$$\n其中 $[\\mathrm{Mg}]$ 是细胞外镁离子浓度，单位为 $\\mathrm{mM}$，V 的单位为 $\\mathrm{mV}$。\n\n- 使用 VGCC 的稳态电压依赖性激活函数：\n$$m_{\\infty}(V) = \\frac{1}{1 + \\exp\\left(-\\frac{V - V_{1/2}}{k}\\right)}$$\n\n波形：\n\n- 膜电位被建模为基线电位加上一个由指数函数之差建模的背向传播尖峰：\n$$V(t) = V_{\\mathrm{rest}} + A_{\\mathrm{AP}}\\left[\\exp\\left(-\\frac{t - t_{\\mathrm{post}}}{\\tau_{\\mathrm{f}}}\\right) - \\exp\\left(-\\frac{t - t_{\\mathrm{post}}}{\\tau_{\\mathrm{r}}}\\right)\\right] H(t - t_{\\mathrm{post}})$$\n其中 $H(\\cdot)$ 是赫维赛德阶跃函数，$V_{\\mathrm{rest}}$ 是静息电位，$A_{\\mathrm{AP}}$ 是尖峰振幅，$\\tau_{\\mathrm{r}}$ 是上升时间常数，$\\tau_{\\mathrm{f}}$ 是衰减时间常数。\n\n- 谷氨酸门控波形是一个alpha函数：\n$$G(t) = A_{\\mathrm{G}} \\cdot \\left(\\frac{t - t_{\\mathrm{pre}}}{\\tau_{\\mathrm{g}}}\\right) \\exp\\left(1 - \\frac{t - t_{\\mathrm{pre}}}{\\tau_{\\mathrm{g}}}\\right) H(t - t_{\\mathrm{pre}})$$\n其中 $A_{\\mathrm{G}}$ 是谷氨酸振幅，$t_{\\mathrm{pre}}$ 是突触前时间，$\\tau_{\\mathrm{g}}$ 是谷氨酸时间尺度。alpha函数的峰值出现在 $t = t_{\\mathrm{pre}} + \\tau_{\\mathrm{g}}$，当 $A_{\\mathrm{G}} = 1$ 时，其振幅为单位1。\n\n需要计算的电流：\n\n- NMDA 电流：\n$$I_{\\mathrm{NMDA}}(t) = g_{\\mathrm{NMDA}} \\cdot B(V(t)) \\cdot G(t) \\cdot \\left(V(t) - E_{\\mathrm{NMDA}}\\right)$$\n\n- NMDA 电流的钙离子组分：\n$$I_{\\mathrm{Ca,NMDA}}(t) = P_{\\mathrm{Ca}} \\cdot I_{\\mathrm{NMDA}}(t)$$\n其中 $P_{\\mathrm{Ca}}$ 是由钙离子承载的 NMDA 电流的比例。\n\n- VGCC 钙电流：\n$$I_{\\mathrm{Ca,VGCC}}(t) = g_{\\mathrm{VGCC}} \\cdot m_{\\infty}(V(t)) \\cdot \\left(V(t) - E_{\\mathrm{Ca}}\\right)$$\n\n总钙电流：\n$$I_{\\mathrm{Ca,tot}}(t) = I_{\\mathrm{Ca,NMDA}}(t) + I_{\\mathrm{Ca,VGCC}}(t)$$\n\n每个尖峰对的总钙内流：\n$$Q_{\\mathrm{Ca}} = -\\int_{0}^{T_{\\mathrm{max}}} I_{\\mathrm{Ca,tot}}(t) \\, dt$$\n\n单位：\n\n- 使用 $g_{\\mathrm{NMDA}}$ 和 $g_{\\mathrm{VGCC}}$，单位为 $\\mathrm{nS}$。\n- 使用 $V(t)$、$E_{\\mathrm{NMDA}}$、$E_{\\mathrm{Ca}}$ 和 $V_{1/2}$，单位为 $\\mathrm{mV}$。\n- 使用时间，单位为 $\\mathrm{ms}$。\n- 根据 $I = g \\cdot (V - E)$ 计算的电流，其中 $g$ 的单位为 $\\mathrm{nS}$，$V - E$ 的单位为 $\\mathrm{mV}$，得出 $I$ 的单位为 $\\mathrm{pA}$。将单位为 $\\mathrm{pA}$ 的电流 $I$ 对单位为 $\\mathrm{ms}$ 的时间进行积分，得出电荷的单位为 $\\mathrm{fC}$；通过除以 $1000$ 将其转换为 $\\mathrm{pC}$。\n- 将最终的钙内流以 $\\mathrm{pC}$ 为单位表示为一个小数，四舍五入到小数点后六位。\n\n所有测试用例的固定常量：\n\n- $V_{\\mathrm{rest}} = -65.0 \\, \\mathrm{mV}$。\n- $A_{\\mathrm{AP}} = 100.0 \\, \\mathrm{mV}$。\n- $\\tau_{\\mathrm{r}} = 0.5 \\, \\mathrm{ms}$, $\\tau_{\\mathrm{f}} = 2.0 \\, \\mathrm{ms}$。\n- $\\tau_{\\mathrm{g}} = 5.0 \\, \\mathrm{ms}$。\n- $E_{\\mathrm{NMDA}} = 0.0 \\, \\mathrm{mV}$。\n- $E_{\\mathrm{Ca}} = 120.0 \\, \\mathrm{mV}$。\n- $V_{1/2} = -20.0 \\, \\mathrm{mV}$, $k = 6.0 \\, \\mathrm{mV}$。\n- 时间网格：$T_{\\mathrm{max}} = 120.0 \\, \\mathrm{ms}$，时间步长 $\\Delta t = 0.01 \\, \\mathrm{ms}$。\n\n测试套件：\n\n提供四个参数集 $(g_{\\mathrm{NMDA}}, P_{\\mathrm{Ca}}, g_{\\mathrm{VGCC}}, t_{\\mathrm{pre}}, t_{\\mathrm{post}}, A_{\\mathrm{G}}, [\\mathrm{Mg}])$：\n\n1. 案例1（突触前-后近乎重合，中等电导）：$(5.0 \\, \\mathrm{nS}, 0.12, 4.0 \\, \\mathrm{nS}, 50.0 \\, \\mathrm{ms}, 52.0 \\, \\mathrm{ms}, 1.0, 1.0 \\, \\mathrm{mM})$。\n\n2. 案例2（反因果时序，重合较弱）：$(5.0 \\, \\mathrm{nS}, 0.12, 4.0 \\, \\mathrm{nS}, 60.0 \\, \\mathrm{ms}, 50.0 \\, \\mathrm{ms}, 1.0, 1.0 \\, \\mathrm{mM})$。\n\n3. 案例3（无谷氨酸释放，仅 VGCC 内流）：$(5.0 \\, \\mathrm{nS}, 0.12, 4.0 \\, \\mathrm{nS}, 50.0 \\, \\mathrm{ms}, 52.0 \\, \\mathrm{ms}, 0.0, 1.0 \\, \\mathrm{mM})$。\n\n4. 案例4（近乎重合时序，高镁离子阻断）：$(5.0 \\, \\mathrm{nS}, 0.12, 4.0 \\, \\mathrm{nS}, 50.0 \\, \\mathrm{ms}, 52.0 \\, \\mathrm{ms}, 1.0, 3.0 \\, \\mathrm{mM})$。\n\n要求的最终输出格式：\n\n您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表，其中每个条目是相应测试用例的总钙内流 $Q_{\\mathrm{Ca}}$（单位为 $\\mathrm{pC}$），四舍五入到小数点后六位（例如，$[0.012345,0.001234,0.000987,0.009999]$）。",
            "solution": "该问题要求在一个树突隔室模型中，计算突触前谷氨酸释放和突触后背向传播动作电位（bAP）后的总钙内流 $Q_{\\mathrm{Ca}}$。解决方案涉及在指定时间间隔内对总钙电流进行数值积分。该模型将 N-甲基-D-天冬氨酸（NMDA）受体和电压门控钙通道（VGCC）作为钙的来源。方法是离散化时间并在每个时间步长计算系统状态，然后对各部分贡献求和以获得总电荷。\n\n基本步骤如下：\n1.  **时间离散化**：建立一个从 $t=0$ 到 $t=T_{\\mathrm{max}}$ 的离散时间网格，步长为 $\\Delta t$。所有随时间变化的函数都将在此网格上进行评估。\n    $T_{\\mathrm{max}} = 120.0 \\, \\mathrm{ms}$ 且 $\\Delta t = 0.01 \\, \\mathrm{ms}$。\n\n2.  **波形生成**：计算所有时间点的膜电位 $V(t)$ 和谷氨酸门控 $G(t)$ 波形。\n    -   膜电位 $V(t)$ 是静息电位 $V_{\\mathrm{rest}}$ 和一个代表 bAP 的时间依赖性分量的总和，该分量仅在 $t \\geq t_{\\mathrm{post}}$ 时激活。\n        $$V(t) = V_{\\mathrm{rest}} + A_{\\mathrm{AP}}\\left[\\exp\\left(-\\frac{t - t_{\\mathrm{post}}}{\\tau_{\\mathrm{f}}}\\right) - \\exp\\left(-\\frac{t - t_{\\mathrm{post}}}{\\tau_{\\mathrm{r}}}\\right)\\right] H(t - t_{\\mathrm{post}})$$\n        此处，$H(\\cdot)$ 是赫维赛德阶跃函数，$V_{\\mathrm{rest}} = -65.0 \\, \\mathrm{mV}$，$A_{\\mathrm{AP}} = 100.0 \\, \\mathrm{mV}$，$\\tau_{\\mathrm{r}} = 0.5 \\, \\mathrm{ms}$，以及 $\\tau_{\\mathrm{f}} = 2.0 \\, \\mathrm{ms}$。\n    -   谷氨酸门控变量 $G(t)$ 由一个 alpha 函数描述，仅在 $t \\geq t_{\\mathrm{pre}}$ 时激活。\n        $$G(t) = A_{\\mathrm{G}} \\cdot \\left(\\frac{t - t_{\\mathrm{pre}}}{\\tau_{\\mathrm{g}}}\\right) \\exp\\left(1 - \\frac{t - t_{\\mathrm{pre}}}{\\tau_{\\mathrm{g}}}\\right) H(t - t_{\\mathrm{pre}})$$\n        此处，$\\tau_{\\mathrm{g}} = 5.0 \\, \\mathrm{ms}$，$A_{\\mathrm{G}}$ 和 $t_{\\mathrm{pre}}$ 由每个测试用例给出。当 $A_{\\mathrm{G}}=0$ 时，对所有 $t$ 都有 $G(t)=0$。\n\n3.  **电压依赖性门控和调制**：在每个时间步长，使用计算出的 $V(t)$ 数组计算两种通道类型的电压依赖性项。\n    -   NMDA 受体的镁离子阻断 $B(V)$ 由以下公式给出：\n        $$B(V(t)) = \\frac{1}{1 + \\left(\\frac{[\\mathrm{Mg}]}{3.57}\\right) \\exp(-0.062 \\, V(t))}$$\n        其中 $[\\mathrm{Mg}]$ 是每个测试用例的参数。\n    -   VGCC 的稳态激活 $m_{\\infty}(V)$ 由一个 S 型函数给出：\n        $$m_{\\infty}(V(t)) = \\frac{1}{1 + \\exp\\left(-\\frac{V(t) - V_{1/2}}{k}\\right)}$$\n        固定参数为 $V_{1/2} = -20.0 \\, \\mathrm{mV}$ 和 $k = 6.0 \\, \\mathrm{mV}$。\n\n4.  **钙电流计算**：然后在每个时间步长计算来自每个来源的钙电流。\n    -   首先计算总 NMDA 电流：\n        $$I_{\\mathrm{NMDA}}(t) = g_{\\mathrm{NMDA}} \\cdot B(V(t)) \\cdot G(t) \\cdot \\left(V(t) - E_{\\mathrm{NMDA}}\\right)$$\n        该电流的钙离子组分是总电流的一小部分 $P_{\\mathrm{Ca}}$：\n        $$I_{\\mathrm{Ca,NMDA}}(t) = P_{\\mathrm{Ca}} \\cdot I_{\\mathrm{NMDA}}(t)$$\n        反转电位为 $E_{\\mathrm{NMDA}} = 0.0 \\, \\mathrm{mV}$。\n    -   VGCC 钙电流为：\n        $$I_{\\mathrm{Ca,VGCC}}(t) = g_{\\mathrm{VGCC}} \\cdot m_{\\infty}(V(t)) \\cdot \\left(V(t) - E_{\\mathrm{Ca}}\\right)$$\n        钙反转电位为 $E_{\\mathrm{Ca}} = 120.0 \\, \\mathrm{mV}$。\n    -   总钙电流是这两个组分的总和：\n        $$I_{\\mathrm{Ca,tot}}(t) = I_{\\mathrm{Ca,NMDA}}(t) + I_{\\mathrm{Ca,VGCC}}(t)$$\n\n5.  **数值积分与单位换算**：总钙内流 $Q_{\\mathrm{Ca}}$ 是总钙电流的负时间积分。该积分通过对离散时间步长的求和来近似：\n    $$Q_{\\mathrm{Ca}} = -\\int_{0}^{T_{\\mathrm{max}}} I_{\\mathrm{Ca,tot}}(t) \\, dt \\approx -\\sum_{i} I_{\\mathrm{Ca,tot}}(t_i) \\cdot \\Delta t$$\n    符号为负，因为按照惯例，内向电流为负，而内流是一个正量。单位处理如下：电导（$g_{\\mathrm{NMDA}}, g_{\\mathrm{VGCC}}$）单位为 $\\mathrm{nS}$，电位单位为 $\\mathrm{mV}$，得到的电流 $I$ 单位为 $\\mathrm{pA}$ ($10^{-12} \\, \\mathrm{A}$)。将单位为 $\\mathrm{pA}$ 的电流对单位为 $\\mathrm{ms}$ ($10^{-3} \\, \\mathrm{s}$) 的时间进行积分，得到电荷单位为 $\\mathrm{fC}$ ($10^{-15} \\, \\mathrm{C}$)。最后通过将以 $\\mathrm{fC}$ 为单位的结果除以 $1000$，将其转换为皮库仑（$\\mathrm{pC}$）。然后将结果四舍五入到小数点后六位。\n\n对测试套件中提供的四个参数集中的每一个都重复此整个过程。该实现使用 `numpy` 库提供的向量化操作以提高效率。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the total calcium influx per spike pair in a dendritic compartment model.\n    \"\"\"\n    # Fixed constants for all test cases\n    V_rest = -65.0      # mV\n    A_AP = 100.0        # mV\n    tau_r = 0.5         # ms\n    tau_f = 2.0         # ms\n    tau_g = 5.0         # ms\n    E_NMDA = 0.0        # mV\n    E_Ca = 120.0        # mV\n    V_half = -20.0      # mV, VGCC activation\n    k = 6.0             # mV, VGCC activation slope\n    \n    # Time grid parameters\n    T_max = 120.0       # ms\n    dt = 0.01           # ms\n    \n    # Time vector\n    t = np.arange(0, T_max, dt)\n\n    # Test suite: (g_NMDA, P_Ca, g_VGCC, t_pre, t_post, A_G, [Mg])\n    test_cases = [\n        # Case 1 (near-coincident pre-post, moderate conductances)\n        (5.0, 0.12, 4.0, 50.0, 52.0, 1.0, 1.0),\n        # Case 2 (anti-causal timing with weaker coincidence)\n        (5.0, 0.12, 4.0, 60.0, 50.0, 1.0, 1.0),\n        # Case 3 (no glutamate release, VGCC-only influx)\n        (5.0, 0.12, 4.0, 50.0, 52.0, 0.0, 1.0),\n        # Case 4 (near-coincident timing with high magnesium block)\n        (5.0, 0.12, 4.0, 50.0, 52.0, 1.0, 3.0),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        g_NMDA, P_Ca, g_VGCC, t_pre, t_post, A_G, Mg_conc = case\n\n        # 1. Calculate membrane potential waveform V(t)\n        time_since_post = t - t_post\n        spike_term = np.zeros_like(t)\n        # Heaviside step function implementation\n        event_indices_ap = time_since_post >= 0\n        spike_term[event_indices_ap] = A_AP * (\n            np.exp(-time_since_post[event_indices_ap] / tau_f) - \n            np.exp(-time_since_post[event_indices_ap] / tau_r)\n        )\n        V = V_rest + spike_term\n\n        # 2. Calculate glutamate gating waveform G(t)\n        G = np.zeros_like(t)\n        # Optimization: if A_G is 0, G(t) is always 0.\n        if A_G > 0:\n            time_since_pre = t - t_pre\n            # Heaviside step function implementation\n            event_indices_g = time_since_pre >= 0\n            arg_g = time_since_pre[event_indices_g] / tau_g\n            G[event_indices_g] = A_G * arg_g * np.exp(1.0 - arg_g)\n\n        # 3. Calculate voltage-dependent factors\n        # Magnesium block for NMDA\n        B_V = 1.0 / (1.0 + (Mg_conc / 3.57) * np.exp(-0.062 * V))\n        \n        # Steady-state activation for VGCC\n        m_inf_V = 1.0 / (1.0 + np.exp(-(V - V_half) / k))\n\n        # 4. Calculate currents\n        # NMDA current and its calcium component\n        I_NMDA = g_NMDA * B_V * G * (V - E_NMDA)\n        I_Ca_NMDA = P_Ca * I_NMDA\n        \n        # VGCC calcium current\n        I_Ca_VGCC = g_VGCC * m_inf_V * (V - E_Ca)\n        \n        # Total calcium current\n        I_Ca_tot = I_Ca_NMDA + I_Ca_VGCC\n\n        # 5. Integrate and convert units\n        # Integral (charge in fC, since current is pA and time is ms)\n        Q_Ca_fC = -np.sum(I_Ca_tot) * dt\n        \n        # Convert from femtocoulombs to picocoulombs\n        Q_Ca_pC = Q_Ca_fC / 1000.0\n        \n        results.append(Q_Ca_pC)\n\n    # Format the final output string\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "理论模型预测的是细胞内钙离子的浓度变化，但在实验中，我们通常通过测量钙指示剂的荧光强度来间接观测这一过程。本练习旨在弥合理论预测与实验测量之间的鸿沟，让你着手处理一个在定量神经科学中至关重要的逆向问题。你将学习如何将一个受到光漂白和指示剂饱和效应影响的原始荧光信号，准确地转换回绝对的钙离子浓度，这是任何希望将计算模型与真实实验数据进行比较的研究者都必须掌握的关键技能。",
            "id": "4005642",
            "problem": "在一个给定的场景中，由N-甲基-D-天冬氨酸（NMDA）受体介导的、发生在突触前输入和突触后去极化之间的符合检测，会在树突棘中产生细胞内钙离子浓度 $[\\mathrm{Ca}^{2+}]$ 的瞬时性升高。这种钙离子瞬变由一种通过双光子（TP）激发进行成像的单波长、单结合位点钙离子指示剂来报告。测得的荧光同时受到指示剂的非线性饱和和光漂白的影响。你的任务是通过反演校准曲线并校正光漂白，将测得的双光子荧光信号转换为绝对 $[\\mathrm{Ca}^{2+}]$ 浓度，同时要防止指示剂饱和的影响。\n\n模型假设与定义：\n- 指示剂的结合遵循单一位点的质量作用定律：\n  $$K_d = \\frac{[\\mathrm{Ca}^{2+}][D]}{[D\\cdot \\mathrm{Ca}^{2+}]},$$\n  其中总指示剂浓度为 $[D]_{\\mathrm{tot}} = [D] + [D\\cdot \\mathrm{Ca}^{2+}]$。分数占有率为\n  $$f = \\frac{[D\\cdot \\mathrm{Ca}^{2+}]}{[D]_{\\mathrm{tot}}} = \\frac{[\\mathrm{Ca}^{2+}]}{K_d + [\\mathrm{Ca}^{2+}]}.$$\n- 荧光校准曲线建模为\n  $$F = F_{\\min} + f\\,(F_{\\max} - F_{\\min}) = F_{\\min} + (F_{\\max} - F_{\\min})\\frac{[\\mathrm{Ca}^{2+}]}{K_d + [\\mathrm{Ca}^{2+}]},$$\n  其中 $F_{\\min}$ 和 $F_{\\max}$ 分别是最小和最大荧光强度（任意单位）。\n- 光漂白被建模为有效荧光团数量的一阶指数衰减：\n  $$B(t) = e^{-\\beta t},$$\n  衰减速率为 $\\beta$（单位为 $\\mathrm{s}^{-1}$）。测得的荧光为\n  $$F_{\\mathrm{meas}}(t) = B(t)\\,F(t).$$\n\n反演目标：\n- 给定 $F_{\\mathrm{meas}}(t)$、$F_{\\min}$、$F_{\\max}$、$K_d$ 和 $\\beta$，计算经光漂白校正后的荧光\n  $$F_{\\mathrm{corr}}(t) = \\frac{F_{\\mathrm{meas}}(t)}{B(t)},$$\n  然后反演校准曲线以获得\n  $$y(t) = \\frac{F_{\\mathrm{corr}}(t) - F_{\\min}}{F_{\\max} - F_{\\min}},\\quad [\\mathrm{Ca}^{2+}](t) = \\frac{K_d\\,y(t)}{1 - y(t)}.$$\n- 为校正指示剂饱和，如果对于某个阈值 $y_{\\max}$，有 $y(t) \\ge y_{\\max}$，则在反演前将 $y(t)$ 的值限制在 $y_{\\max}$。使用 $y_{\\max} = 0.98$。\n\n用于 $F_{\\mathrm{meas}}(t)$ 的测试套件和生成模型：\n- 使用 $K_d = 0.3\\,\\mu\\mathrm{M}$，$F_{\\min} = 100$（任意单位），$F_{\\max} = 900$（任意单位）。\n- 使用均匀采样的时间向量：$t \\in \\{0.0, 0.1, 0.2, \\dots, 1.0\\}$，单位为 $\\mathrm{s}$。\n- 基础钙离子瞬变是基线加上一个以 $t_0$ 为中心、时间常数为 $\\tau$、振幅为 $A$ 的 $\\alpha$-函数峰：\n  $$[\\mathrm{Ca}^{2+}]_{\\mathrm{true}}(t) = C_0 + \\begin{cases}\n  A\\,\\frac{t - t_0}{\\tau}\\,e^{1 - \\frac{t - t_0}{\\tau}},  t \\ge t_0,\\\\\n  0,  t  t_0,\n  \\end{cases}$$\n  其中 $t_0 = 0.3\\,\\mathrm{s}$，$\\tau = 0.1\\,\\mathrm{s}$，基线 $C_0$ 的单位为 $\\mu\\mathrm{M}$。注意，$\\alpha$-函数在 $t = t_0 + \\tau$ 时达到峰值，峰高为 $A$，因此 $[\\mathrm{Ca}^{2+}]_{\\mathrm{true}}(t)$ 的峰值在 $t = 0.4\\,\\mathrm{s}$ 时为 $C_0 + A$。\n- 使用正向模型计算无噪声荧光：\n  $$F(t) = F_{\\min} + (F_{\\max} - F_{\\min})\\frac{[\\mathrm{Ca}^{2+}]_{\\mathrm{true}}(t)}{K_d + [\\mathrm{Ca}^{2+}]_{\\mathrm{true}}(t)},\\quad F_{\\mathrm{meas}}(t) = e^{-\\beta t}\\,F(t).$$\n\n提供四个测试用例来检验算法：\n1. 一般情况（理想路径）：$C_0 = 0.05\\,\\mu\\mathrm{M}$，$A = 0.8\\,\\mu\\mathrm{M}$，$\\beta = 0.05\\,\\mathrm{s}^{-1}$。\n2. 饱和边界情况：$C_0 = 0.05\\,\\mu\\mathrm{M}$，$A = 20.0\\,\\mu\\mathrm{M}$，$\\beta = 0.05\\,\\mathrm{s}^{-1}$。\n3. 强光漂白情况：$C_0 = 0.05\\,\\mu\\mathrm{M}$，$A = 0.5\\,\\mu\\mathrm{M}$，$\\beta = 0.30\\,\\mathrm{s}^{-1}$。\n4. 边界情况（无光漂白）：$C_0 = 0.05\\,\\mu\\mathrm{M}$，$A = 0.2\\,\\mu\\mathrm{M}$，$\\beta = 0.00\\,\\mathrm{s}^{-1}$。\n\n要求的最终输出：\n- 对于每个测试用例，使用带有饱和限制的反演方法计算校正后的 $[\\mathrm{Ca}^{2+}](t)$ 时间序列，并返回在时间 $t$ 上的峰值。\n- 峰值以 $\\mu\\mathrm{M}$ 为单位表示，并四舍五入到三位小数。\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[x_1,x_2,x_3,x_4]$），其中每个 $x_i$ 是第 $i$ 个测试用例的 $[\\mathrm{Ca}^{2+}]$ 峰值。",
            "solution": "### 问题验证\n\n**步骤1：提取给定条件**\n\n问题提供了以下定义、模型、常数和参数：\n- **指示剂结合模型**：单一位点的质量作用定律。\n  - 解离常数：$K_d = \\frac{[\\mathrm{Ca}^{2+}][D]}{[D\\cdot \\mathrm{Ca}^{2+}]}$\n  - 总指示剂浓度：$[D]_{\\mathrm{tot}} = [D] + [D\\cdot \\mathrm{Ca}^{2+}]$\n  - 分数占有率：$f = \\frac{[D\\cdot \\mathrm{Ca}^{2+}]}{[D]_{\\mathrm{tot}}} = \\frac{[\\mathrm{Ca}^{2+}]}{K_d + [\\mathrm{Ca}^{2+}]}$\n- **荧光校准曲线**：\n  - $F = F_{\\min} + f\\,(F_{\\max} - F_{\\min}) = F_{\\min} + (F_{\\max} - F_{\\min})\\frac{[\\mathrm{Ca}^{2+}]}{K_d + [\\mathrm{Ca}^{2+}]}$\n  - 最小荧光强度：$F_{\\min} = 100$（任意单位）\n  - 最大荧光强度：$F_{\\max} = 900$（任意单位）\n  - 解离常数：$K_d = 0.3\\,\\mu\\mathrm{M}$\n- **光漂白模型**：一阶指数衰减。\n  - 漂白因子：$B(t) = e^{-\\beta t}$\n  - 漂白速率：$\\beta$ 单位为 $\\mathrm{s}^{-1}$\n  - 测得的荧光：$F_{\\mathrm{meas}}(t) = B(t)\\,F(t)$\n- **反演目标**：\n  - 经光漂白校正的荧光：$F_{\\mathrm{corr}}(t) = \\frac{F_{\\mathrm{meas}}(t)}{B(t)}$\n  - 归一化荧光：$y(t) = \\frac{F_{\\mathrm{corr}}(t) - F_{\\min}}{F_{\\max} - F_{\\min}}$\n  - 钙离子浓度反演：$[\\mathrm{Ca}^{2+}](t) = \\frac{K_d\\,y(t)}{1 - y(t)}$\n  - 饱和限制阈值：$y_{\\max} = 0.98$\n- **测试数据生成模型**：\n  - 时间向量：$t \\in \\{0.0, 0.1, 0.2, \\dots, 1.0\\}$ 单位为 $\\mathrm{s}$\n  - 真实钙瞬变模型（$\\alpha$-函数）：\n    $$[\\mathrm{Ca}^{2+}]_{\\mathrm{true}}(t) = C_0 + \\begin{cases}\n    A\\,\\frac{t - t_0}{\\tau}\\,e^{1 - \\frac{t - t_0}{\\tau}},  t \\ge t_0,\\\\\n    0,  t  t_0,\n    \\end{cases}$$\n  - $\\alpha$-函数参数：$t_0 = 0.3\\,\\mathrm{s}$，$\\tau = 0.1\\,\\mathrm{s}$\n- **测试用例**：\n  1. 一般情况：$C_0 = 0.05\\,\\mu\\mathrm{M}$，$A = 0.8\\,\\mu\\mathrm{M}$，$\\beta = 0.05\\,\\mathrm{s}^{-1}$\n  2. 饱和情况：$C_0 = 0.05\\,\\mu\\mathrm{M}$，$A = 20.0\\,\\mu\\mathrm{M}$，$\\beta = 0.05\\,\\mathrm{s}^{-1}$\n  3. 强光漂白情况：$C_0 = 0.05\\,\\mu\\mathrm{M}$，$A = 0.5\\,\\mu\\mathrm{M}$，$\\beta = 0.30\\,\\mathrm{s}^{-1}$\n  4. 无光漂白情况：$C_0 = 0.05\\,\\mu\\mathrm{M}$，$A = 0.2\\,\\mu\\mathrm{M}$，$\\beta = 0.00\\,\\mathrm{s}^{-1}$\n\n**步骤2：使用提取的给定条件进行验证**\n\n根据验证标准对问题进行评估：\n- **科学依据**：该问题在钙成像的生物物理学中有充分的依据。用于指示剂结合的Hill型方程、用于光漂白的一阶指数衰减以及用于突触样瞬变的alpha函数都是计算神经科学和细胞生物学中标准且被广泛接受的模型。\n- **适定性**：这是一个适定问题。它提供了一整套方程、参数和初始条件。正向问题（生成测试数据）和反向问题（恢复钙离子浓度）都有明确的定义。当 $y(t) \\to 1$ 时，反演公式 $[\\mathrm{Ca}^{2+}](t) = K_d\\,y(t)/(1 - y(t))$ 中的潜在奇点问题已通过将 $y(t)$ 限制在上限 $y_{\\max} = 0.98$ 来明确处理，从而确保了有限且稳定的解。\n- **客观性**：该问题使用精确的数学和科学语言陈述，没有歧义或主观论断。\n- **完整性与一致性**：所有必需的参数（$K_d$、$F_{\\min}$、$F_{\\max}$、$t_0$、$\\tau$、$y_{\\max}$ 以及针对特定测试用例的 $C_0$、$A$、$\\beta$ 值）都已提供。这些模型内部一致，不包含矛盾。\n- **真实性**：所选参数值（$K_d=0.3\\,\\mu\\mathrm{M}$、钙振幅、漂白速率）对于典型的细胞成像实验而言，在物理和生物学上都是合理的。\n- **无其他缺陷**：该问题并非无关紧要、比喻性或无法验证的。它代表了定量荧光显微镜学中的一项标准数据分析任务。\n\n**步骤3：结论与行动**\n\n问题有效。将提供一个合理的解决方案。\n\n### 解决方案\n\n任务是实现一个算法，该算法首先基于钙动力学和指示剂响应的生物物理模型生成合成的测量荧光数据 $F_{\\mathrm{meas}}(t)$，然后反演此过程以恢复潜在的钙离子浓度 $[\\mathrm{Ca}^{2+}](t)$。反演过程必须考虑光漂白和指示剂饱和。对于每个测试用例，恢复的钙离子浓度的峰值是最终输出。\n\n对于每个测试用例，该算法分两个主要阶段进行：一个用于生成数据的正向建模阶段，以及一个用于分析数据的反向计算阶段。\n\n**阶段1：正向模型 - 生成测量荧光**\n\n首先，我们定义模拟的通用参数和时域。\n- 全局常数：$K_d = 0.3\\,\\mu\\mathrm{M}$，$F_{\\min} = 100$，$F_{\\max} = 900$。\n- 饱和限制：$y_{\\max} = 0.98$。\n- 时间向量：一个从 $0.0\\,\\mathrm{s}$ 到 $1.0\\,\\mathrm{s}$，步长为 $0.1\\,\\mathrm{s}$ 的离散时间序列 $t_i$。\n- 钙瞬变参数：$t_0 = 0.3\\,\\mathrm{s}$，$\\tau = 0.1\\,\\mathrm{s}$。\n\n对于由一组参数 $(C_0, A, \\beta)$ 定义的每个测试用例：\n\n1.  **计算真实钙瞬变 $[\\mathrm{Ca}^{2+}]_{\\mathrm{true}}(t)$**：\n    使用提供的 $\\alpha$-函数模型生成基础钙信号。对于时间向量中的每个时间点 $t_i$：\n    $$[\\mathrm{Ca}^{2+}]_{\\mathrm{true}}(t_i) = C_0 + \\begin{cases}\n    A\\,\\frac{t_i - t_0}{\\tau}\\,e^{1 - \\frac{t_i - t_0}{\\tau}},  t_i \\ge t_0,\\\\\n    0,  t_i  t_0.\n    \\end{cases}$$\n    这将创建一个代表基准真实细胞内钙离子浓度的时间序列。\n\n2.  **计算理想荧光 $F(t)$**：\n    使用校准曲线，我们将钙离子浓度转换为在没有光漂白的情况下会观察到的理想荧光信号。\n    $$F(t_i) = F_{\\min} + (F_{\\max} - F_{\\min})\\frac{[\\mathrm{Ca}^{2+}]_{\\mathrm{true}}(t_i)}{K_d + [\\mathrm{Ca}^{2+}]_{\\mathrm{true}}(t_i)}$$\n\n3.  **应用光漂白以获得测量荧光 $F_{\\mathrm{meas}}(t)$**：\n    理想荧光因光漂白而衰减，其特征是速率 $\\beta$ 的指数衰减。\n    $$F_{\\mathrm{meas}}(t_i) = F(t_i) \\, e^{-\\beta t_i}$$\n    这个 $F_{\\mathrm{meas}}(t)$ 时间序列是合成数据，用作反演算法的输入。\n\n**阶段2：反向计算 - 估算钙离子浓度**\n\n给定生成的 $F_{\\mathrm{meas}}(t)$ 以及已知的校准和漂白参数，我们逆转该过程。\n\n1.  **校正光漂白**：\n    第一步是通过将测量的荧光除以漂白衰减因子 $B(t) = e^{-\\beta t}$ 来校正漂白效应。\n    $$F_{\\mathrm{corr}}(t_i) = \\frac{F_{\\mathrm{meas}}(t_i)}{e^{-\\beta t_i}}$$\n    在这个无噪声模型中，$F_{\\mathrm{corr}}(t)$ 将与理想荧光 $F(t)$ 完全相同。\n\n2.  **归一化校正后的荧光**：\n    校正后的荧光 $F_{\\mathrm{corr}}(t_i)$ 被归一化到 $[0, 1]$ 范围，以获得分数占有率，记为 $y(t_i)$。\n    $$y(t_i) = \\frac{F_{\\mathrm{corr}}(t_i) - F_{\\min}}{F_{\\max} - F_{\\min}}$$\n\n3.  **应用饱和限制**：\n    为防止因指示剂饱和（其中 $y(t_i)$ 接近 $1$）而导致的反演伪影并确保数值稳定性，归一化信号被限制在上限阈值 $y_{\\max}$。\n    对于每个时间点 $t_i$，如果 $y(t_i) \\ge y_{\\max}$，我们设置 $y(t_i) = y_{\\max}$。这实际上对可解析的钙离子浓度设置了一个上限。\n\n4.  **反演以估算钙离子浓度 $[\\mathrm{Ca}^{2+}](t)$**：\n    使用经过限制和归一化的荧光 $y(t_i)$ 来反演结合方程并计算估算的钙离子浓度。\n    $$[\\mathrm{Ca}^{2+}](t_i) = \\frac{K_d\\,y(t_i)}{1 - y(t_i)}$$\n\n5.  **确定峰值**：\n    从得到的估算钙离子时间序列 $[\\mathrm{Ca}^{2+}](t)$ 中，找出最大值。\n    $$\\text{peak } [\\mathrm{Ca}^{2+}] = \\max_{i} \\left( [\\mathrm{Ca}^{2+}](t_i) \\right)$$\n    这个峰值，四舍五入到三位小数，是该测试用例的最终结果。\n\n**应用于测试用例**\n\n- **情况1（一般）**：当 $[\\mathrm{Ca}^{2+}]_{\\mathrm{true}}$ 峰值为 $0.85\\,\\mu\\mathrm{M}$ 时，指示剂未饱和。反演过程应能准确恢复此峰值。\n- **情况2（饱和）**：真实钙峰值为 $20.05\\,\\mu\\mathrm{M}$。这个浓度足以使指示剂深度饱和，导致归一化荧光 $y(t)$ 超过 $y_{\\max}=0.98$。限制机制将被激活，恢复的钙峰值将被限制在 $[\\mathrm{Ca}^{2+}]_{\\max} = \\frac{K_d y_{\\max}}{1 - y_{\\max}} = \\frac{0.3 \\times 0.98}{1 - 0.98} = 14.7\\,\\mu\\mathrm{M}$。\n- **情况3（强光漂白）**：真实峰值为 $0.55\\,\\mu\\mathrm{M}$。尽管存在强光漂白，校正步骤 $F_{\\mathrm{corr}}(t) = F_{\\mathrm{meas}}(t) / B(t)$ 被设计为在这个理想模型中精确地逆转其影响。恢复的峰值应为 $0.55\\,\\mu\\mathrm{M}$。\n- **情况4（无光漂白）**：当 $\\beta=0.0\\,\\mathrm{s}^{-1}$ 时，对于所有 $t$，$B(t)=1$。模型简化，但逻辑保持不变。恢复的峰值应准确反映 $0.25\\,\\mu\\mathrm{M}$ 的真实峰值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Generates synthetic calcium imaging data and applies an inversion algorithm\n    to recover calcium concentrations, accounting for photobleaching and\n    indicator saturation.\n    \"\"\"\n    \n    # Define global parameters\n    Kd = 0.3  # Dissociation constant in uM\n    Fmin = 100.0  # Minimum fluorescence\n    Fmax = 900.0  # Maximum fluorescence\n    y_max = 0.98  # Saturation clamp threshold for normalized fluorescence\n\n    # Define time vector parameters\n    t_start = 0.0\n    t_end = 1.0\n    t_step = 0.1\n    t = np.arange(t_start, t_end + t_step / 2, t_step) # Use arange to match problem spec {0.0, ..., 1.0}\n\n    # Define alpha-function parameters\n    t0 = 0.3  # s\n    tau = 0.1  # s\n\n    # Define the four test cases: (C0, A, beta)\n    test_cases = [\n        (0.05, 0.8, 0.05),   # Case 1: General case\n        (0.05, 20.0, 0.05),  # Case 2: Saturation-edge case\n        (0.05, 0.5, 0.30),   # Case 3: Strong bleaching case\n        (0.05, 0.2, 0.00),   # Case 4: Boundary case (no bleaching)\n    ]\n\n    results = []\n    for C0, A, beta in test_cases:\n        # --- Phase 1: Forward Model - Generate Measured Fluorescence ---\n\n        # 1. Compute the True Calcium Transient\n        # The alpha-function is zero for t  t0\n        condition = t = t0\n        alpha_term = np.zeros_like(t)\n        # Calculate for t = t0 to avoid potential warnings with negative bases\n        t_ge_t0 = t[condition]\n        if t_ge_t0.size  0:\n            alpha_term[condition] = A * (t_ge_t0 - t0) / tau * np.exp(1 - (t_ge_t0 - t0) / tau)\n        \n        ca_true_t = C0 + alpha_term\n\n        # 2. Compute the Ideal Fluorescence\n        F_t = Fmin + (Fmax - Fmin) * (ca_true_t / (Kd + ca_true_t))\n\n        # 3. Apply Photobleaching\n        bleaching_factor = np.exp(-beta * t)\n        F_meas_t = F_t * bleaching_factor\n\n        # --- Phase 2: Inverse Calculation - Estimate Calcium Concentration ---\n\n        # 1. Correct for Photobleaching\n        # Note: In a noiseless model, F_corr_t should be identical to F_t.\n        # This handles beta=0 correctly as exp(0)=1.\n        F_corr_t = F_meas_t / bleaching_factor\n\n        # 2. Normalize the Corrected Fluorescence\n        y_t = (F_corr_t - Fmin) / (Fmax - Fmin)\n\n        # 3. Apply Saturation Clamping\n        y_clamped_t = np.minimum(y_t, y_max)\n\n        # 4. Invert to Estimate Calcium Concentration\n        # The denominator can approach zero if y is close to 1. Clamping prevents this.\n        ca_est_t = Kd * y_clamped_t / (1 - y_clamped_t)\n\n        # 5. Determine the Peak Value\n        peak_ca_est = np.max(ca_est_t)\n        \n        # Format result to three decimal places and append\n        results.append(f\"{peak_ca_est:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}