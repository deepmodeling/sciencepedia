{
    "hands_on_practices": [
        {
            "introduction": "要量化神经元对运动方向的偏好，我们需要一个明确的指标。方向选择性指数（DSI）是神经科学中广泛使用的一个标准。然而，原始神经放电数据中通常包含与刺激无关的自发放电，这会影响DSI的计算。这个练习将通过一个具体的计算，帮助你理解如何计算DSI，并揭示基线放电校正对于准确评估刺激驱动的选择性的重要性。",
            "id": "3999440",
            "problem": "在视觉皮层的方向选择性模型中，一个定向运动刺激引发的神经发放率可以表示为一个线性方向调谐分量与一个自发基线相加，然后通过一个强制非负性的生物物理非线性函数处理后的结果。具体来说，假设在偏好方向和非偏好方向运动下的瞬时发放率分别为 $$R_{\\mathrm{pref}}$$ 和 $$R_{\\mathrm{null}}$$，单位为 $$\\mathrm{spikes}\\ \\mathrm{s}^{-1}$$。自发基线（自发发放率）为 $$r_0$$。半波整流器由 $$[x]_+ = \\max(0,x)$$ 建模，这与发放率的非负性一致。\n\n方向选择性指数 (DSI) 由两个特定方向的响应定义为 $$\\mathrm{DSI} = \\frac{R_{\\mathrm{pref}} - R_{\\mathrm{null}}}{R_{\\mathrm{pref}} + R_{\\mathrm{null}}}$$。基线发放和整流会使该指数产生偏差，因为它们同时提高了 $$R_{\\mathrm{pref}}$$ 和 $$R_{\\mathrm{null}}$$ 的值，并可能阻止减去 $$r_0$$ 后出现负值。\n\n使用以下科学上合理的测量值：\n- $$R_{\\mathrm{pref}} = 38\\ \\mathrm{spikes}\\ \\mathrm{s}^{-1}$$，\n- $$R_{\\mathrm{null}} = 12\\ \\mathrm{spikes}\\ \\mathrm{s}^{-1}$$，\n- $$r_0 = 10\\ \\mathrm{spikes}\\ \\mathrm{s}^{-1}$$，\n\n计算：\n1. 直接使用 $$R_{\\mathrm{pref}}$$ 和 $$R_{\\mathrm{null}}$$ 计算原始方向选择性指数 $$\\mathrm{DSI}_{\\mathrm{raw}}$$。\n2. 计算基线校正的方向选择性指数 $$\\mathrm{DSI}_{\\mathrm{corr}}$$。该指数通过先从每个测量率中减去 $$r_0$$，对结果进行半波整流，然后用经过基线减除和整流后的响应构建相同的指数得到。\n\n将 $$\\mathrm{DSI}_{\\mathrm{raw}}$$ 和 $$\\mathrm{DSI}_{\\mathrm{corr}}$$ 表示为无单位小数，并将每个值四舍五入到四位有效数字。按 $$\\mathrm{DSI}_{\\mathrm{raw}}$$、$$\\mathrm{DSI}_{\\mathrm{corr}}$$ 的顺序报告两个值。",
            "solution": "首先验证问题以确保其具有科学依据、问题设定良好且客观。\n\n### 第1步：提取已知条件\n问题提供了以下数据和定义：\n-   偏好方向的瞬时发放率：$$R_{\\mathrm{pref}} = 38\\ \\mathrm{spikes}\\ \\mathrm{s}^{-1}$$\n-   非偏好方向的瞬时发放率：$$R_{\\mathrm{null}} = 12\\ \\mathrm{spikes}\\ \\mathrm{s}^{-1}$$\n-   自发基线发放率：$$r_0 = 10\\ \\mathrm{spikes}\\ \\mathrm{s}^{-1}$$\n-   半波整流函数：$$[x]_+ = \\max(0,x)$$\n-   方向选择性指数 (DSI) 的定义：$$\\mathrm{DSI} = \\frac{R_{\\mathrm{pref}} - R_{\\mathrm{null}}}{R_{\\mathrm{pref}} + R_{\\mathrm{null}}}$$\n-   任务1：计算原始DSI，$$\\mathrm{DSI}_{\\mathrm{raw}}$$。\n-   任务2：计算基线校正的DSI，$$\\mathrm{DSI}_{\\mathrm{corr}}$$。\n-   四舍五入要求：将结果报告为无单位小数，保留四位有效数字。\n-   报告顺序：$$\\mathrm{DSI}_{\\mathrm{raw}}$$，$$\\mathrm{DSI}_{\\mathrm{corr}}$$。\n\n### 第2步：使用提取的已知条件进行验证\n该问题是计算神经科学中的一个标准计算，涉及一个简化但广泛使用的神经元响应模型。发放率、自发活动、整流（强制非负性）和方向选择性指数等概念是该领域的基础。所提供的发放率数值在生理上是合理的。该问题是自洽的，提供了所有必要的数据和定义。指令清晰，并能导出一个唯一的、有意义的解。不存在科学或事实上的不健全、无歧义、无矛盾之处。因此，该问题被认定为**有效**。\n\n### 解题过程\n解题过程是根据所提供的定义和数据，计算两个要求的量：$$\\mathrm{DSI}_{\\mathrm{raw}}$$ 和 $$\\mathrm{DSI}_{\\mathrm{corr}}$$。\n\n**1. 原始方向选择性指数 ($$\\mathrm{DSI}_{\\mathrm{raw}}$$) 的计算**\n\n原始DSI是使用给定的公式直接从测量的发放率 $$R_{\\mathrm{pref}}$$ 和 $$R_{\\mathrm{null}}$$ 计算得出的。\nDSI的公式是：\n$$\\mathrm{DSI} = \\frac{R_{\\mathrm{pref}} - R_{\\mathrm{null}}}{R_{\\mathrm{pref}} + R_{\\mathrm{null}}}$$\n代入给定值 $$R_{\\mathrm{pref}} = 38$$ 和 $$R_{\\mathrm{null}} = 12$$：\n$$\\mathrm{DSI}_{\\mathrm{raw}} = \\frac{38 - 12}{38 + 12}$$\n$$\\mathrm{DSI}_{\\mathrm{raw}} = \\frac{26}{50}$$\n$$\\mathrm{DSI}_{\\mathrm{raw}} = 0.52$$\n四舍五入到四位有效数字，我们得到 $$\\mathrm{DSI}_{\\mathrm{raw}} = 0.5200$$。\n\n**2. 基线校正的方向选择性指数 ($$\\mathrm{DSI}_{\\mathrm{corr}}$$) 的计算**\n\n基线校正的DSI是使用先对自发基线率 $$r_0$$ 进行校正，然后进行半波整流的响应来计算的。\n\n让我们将基线减除并整流后的响应定义为 $$R'_{\\mathrm{pref}}$$ 和 $$R'_{\\mathrm{null}}$$。\n首先，我们从测量率中减去基线率 $$r_0$$：\n-   偏好方向，整流前：$$R_{\\mathrm{pref}} - r_0 = 38 - 10 = 28$$\n-   非偏好方向，整流前：$$R_{\\mathrm{null}} - r_0 = 12 - 10 = 2$$\n\n接下来，我们将半波整流函数 $$[x]_+ = \\max(0, x)$$ 应用于这些相减后的值：\n$$R'_{\\mathrm{pref}} = [R_{\\mathrm{pref}} - r_0]_+ = [28]_+ = \\max(0, 28) = 28$$\n$$R'_{\\mathrm{null}} = [R_{\\mathrm{null}} - r_0]_+ = [2]_+ = \\max(0, 2) = 2$$\n\n现在，我们使用这些校正后的响应 $$R'_{\\mathrm{pref}}$$ 和 $$R'_{\\mathrm{null}}$$ 来计算DSI：\n$$\\mathrm{DSI}_{\\mathrm{corr}} = \\frac{R'_{\\mathrm{pref}} - R'_{\\mathrm{null}}}{R'_{\\mathrm{pref}} + R'_{\\mathrm{null}}}$$\n代入校正后的值：\n$$\\mathrm{DSI}_{\\mathrm{corr}} = \\frac{28 - 2}{28 + 2}$$\n$$\\mathrm{DSI}_{\\mathrm{corr}} = \\frac{26}{30} = \\frac{13}{15}$$\n为了将其表示为小数，我们进行除法运算：\n$$\\mathrm{DSI}_{\\mathrm{corr}} = 0.86666...$$\n四舍五入到四位有效数字，我们得到 $$\\mathrm{DSI}_{\\mathrm{corr}} = 0.8667$$。\n\n问题要求按顺序给出 $$\\mathrm{DSI}_{\\mathrm{raw}}$$ 和 $$\\mathrm{DSI}_{\\mathrm{corr}}$$ 两个值，并四舍五入到四位有效数字。\n最终结果是 $$0.5200$$ 和 $$0.8667$$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.5200  0.8667 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在理解了如何量化方向选择性之后，我们来探讨其产生的基本机制。经典的Barlow-Levick模型提出，方向选择性可以源于具有不同时间延迟的输入的相互作用。本练习将指导你实现一个基于电导的神经元模型，该模型接收两个具有不对称延迟的输入，从而亲手构建并验证这个简单而强大的机制是如何产生方向选择性的。",
            "id": "3999490",
            "problem": "您的任务是形式化并计算一个简单的基于电导的神经元中的方向选择性。该神经元接收两个空间分离的兴奋性输入，这两个输入具有不同的轴突延迟。该神经元是一个等电位单房室，具有被动漏电和两个突触电导，由一个移动的刺激驱动，该刺激相继激活两个输入位点。任务是推导、实现和评估突触求和何时仅在偏好方向上是建设性的。\n\n使用以下基本基础和定义：\n\n- 神经元遵循单房室的被动膜方程，其总电导随时间变化，\n$$\nC_m \\frac{dV(t)}{dt} \\;=\\; -g_L\\left(V(t) - E_L\\right) \\;-\\; \\sum_{i=1}^2 g_i(t)\\left(V(t) - E_E\\right),\n$$\n其中 $C_m$ 是膜电容，$g_L$ 是漏电导，$E_L$ 是漏泄反转电位，$E_E$ 是兴奋性突触反转电位，$g_i(t)$ 是突触电导。\n\n- 每个突触电导都是一个在到达胞体时触发的 alpha 函数，\n$$\ng_i(t) \\;=\\; \\bar g \\,\\alpha\\!\\left(t - t_{a,i}\\right), \\quad \\alpha(s) \\;=\\; \\begin{cases}\n\\frac{s}{\\tau_s}\\,\\exp\\!\\left(1 - \\frac{s}{\\tau_s}\\right),  s \\ge 0,\\\\\n0,  s  0,\n\\end{cases}\n$$\n其中 $\\bar g$ 是突触峰值电导，$\\tau_s$ 是突触时间常数。\n\n- 两个输入位于位置 $x_1$ 和 $x_2$，其中 $x_1 = 0$ 且 $x_2 = \\Delta x$，$\\Delta x \\ge 0$。一个点状刺激以恒定速度 $v$ 沿着连接 $x_1$ 和 $x_2$ 的直线移动。在偏好方向上，刺激以速度 $v$ 从 $x_1$ 移动到 $x_2$，因此刺激到达位置的时间为 $t_{s,1}^{\\mathrm{PD}} = 0$ 和 $t_{s,2}^{\\mathrm{PD}} = \\Delta x / v$。在非偏好方向上，刺激以相同的速度大小从 $x_2$ 移动到 $x_1$，得到 $t_{s,1}^{\\mathrm{ND}} = \\Delta x / v$ 和 $t_{s,2}^{\\mathrm{ND}} = 0$。\n\n- 每个输入从其位置到胞体都有一个轴突传导延迟，分别表示为 $d_1$ 和 $d_2$，因此对于方向 $\\mathrm{dir} \\in \\{\\mathrm{PD}, \\mathrm{ND}\\}$，突触到达胞体的时间为 $t_{a,i}^{\\mathrm{dir}} = t_{s,i}^{\\mathrm{dir}} + d_i$。\n\n- 初始条件为 $V(0) = E_L$。\n\n科学任务：\n\n1. 从膜方程和突触电导的定义出发，推导在何种条件下时间求和仅在偏好方向上是建设性的。这个条件应涉及 $\\Delta x$、$v$、$d_1$、$d_2$ 和 $\\tau_s$。请根据突触到达的相对时间和突触时间常数来精确陈述您的条件。\n\n2. 使用上述生物物理参数实现 $V(t)$ 的时域模拟，并计算每个测试用例在偏好和非偏好方向上的峰值膜电位（以毫伏为单位）。在时间步长内，使用电导分段恒定的线性常微分方程的精确步长解，或使用与基本基础一致且同样合理的稳定数值方法。\n\n3. 对于每个测试用例，计算方向选择性指数 (DSI)，定义为\n$$\n\\mathrm{DSI} \\;=\\; \\frac{V_{\\max}^{\\mathrm{PD}} - V_{\\max}^{\\mathrm{ND}}}{V_{\\max}^{\\mathrm{PD}} + V_{\\max}^{\\mathrm{ND}}},\n$$\n其中 $V_{\\max}^{\\mathrm{PD}}$ 和 $V_{\\max}^{\\mathrm{ND}}$ 分别是偏好和非偏好方向上的峰值膜电位（以毫伏为单位）。将 DSI 报告为一个无量纲的十进制数。\n\n所有模拟使用以下固定的生物物理参数：\n- $C_m = 200\\,\\mathrm{pF}$,\n- $g_L = 10\\,\\mathrm{nS}$,\n- $E_L = -65\\,\\mathrm{mV}$,\n- $E_E = 0\\,\\mathrm{mV}$,\n- $\\bar g = 5\\,\\mathrm{nS}$,\n- $\\tau_s = 2\\,\\mathrm{ms}$.\n\n使用模拟时间步长 $\\Delta t = 0.05\\,\\mathrm{ms}$，总模拟窗口 $T = 100\\,\\mathrm{ms}$。所有时间量的单位必须是毫秒，距离单位是毫米，电导单位是纳西门子，电容单位是皮法，电压单位是毫伏。您必须以毫米/毫秒为单位计算和使用 $v$。\n\n测试套件：\n\n为以下四个参数集提供结果，其中每个测试用例是一个元组 $(\\Delta x, v, d_1, d_2)$，使用上述指定的单位：\n\n- 案例 A（偏好方向对齐）：$(0.2, 0.05, 4.0, 0.0)$。\n- 案例 B（非偏好方向对齐）：$(0.2, 0.05, 0.0, 4.0)$。\n- 案例 C（对称延迟）：$(0.2, 0.05, 2.0, 2.0)$。\n- 案例 D（同位输入）：$(0.0, 0.05, 1.0, 3.0)$。\n\n实现和输出要求：\n\n- 实现模拟并计算每个测试用例的 $V_{\\max}^{\\mathrm{PD}}$ 和 $V_{\\max}^{\\mathrm{ND}}$（以毫伏为单位）。\n- 计算每个测试用例的方向选择性指数，如上定义。\n- 最终程序输出必须是单行，包含一个 Python 列表，内含四个浮点 DSI 值，按 A、B、C、D 的顺序对应每个测试用例，每个值四舍五入到六位小数，格式为逗号分隔的列表并用方括号括起，例如：“[0.123456,-0.234567,0.000000,0.000000]”。",
            "solution": "我们从基于电导的单房室被动膜方程开始，\n$$\nC_m \\frac{dV(t)}{dt} \\;=\\; -g_L\\left(V(t) - E_L\\right) \\;-\\; \\sum_{i=1}^2 g_i(t)\\left(V(t) - E_E\\right),\n$$\n初始条件为 $V(0)=E_L$。突触电导是 alpha 函数形式\n$$\ng_i(t) = \\bar g \\,\\alpha\\!\\left(t - t_{a,i}\\right),\\quad \\alpha(s) = \\frac{s}{\\tau_s}\\,e^{1 - s/\\tau_s}\\;\\text{for}\\; s\\ge 0,\\;\\text{and}\\; \\alpha(s)=0\\;\\text{for}\\; s  0,\n$$\n其中 $t_{a,i}$ 是突触到达胞体的时间。对于偏好方向（从 $x_1$ 到 $x_2$），我们有两个位置的刺激到达时间\n$$\nt_{s,1}^{\\mathrm{PD}}=0,\\qquad t_{s,2}^{\\mathrm{PD}}=\\frac{\\Delta x}{v},\n$$\n并且考虑到轴突延迟 $d_1$ 和 $d_2$，胞体到达时间为\n$$\nt_{a,1}^{\\mathrm{PD}}=d_1,\\qquad t_{a,2}^{\\mathrm{PD}}=\\frac{\\Delta x}{v} + d_2.\n$$\n对于非偏好方向（从 $x_2$ 到 $x_1$），\n$$\nt_{s,2}^{\\mathrm{ND}}=0,\\qquad t_{s,1}^{\\mathrm{ND}}=\\frac{\\Delta x}{v},\n$$\n所以胞体到达时间为\n$$\nt_{a,2}^{\\mathrm{ND}}=d_2,\\qquad t_{a,1}^{\\mathrm{ND}}=\\frac{\\Delta x}{v} + d_1.\n$$\n\n建设性求和要求两个突触电导在胞体上的时间有显著重叠，这发生在它们到达时间之差远小于突触时间常数时。对于偏好方向，到达时间差为\n$$\n\\Delta t_{\\mathrm{PD}} \\;=\\; t_{a,2}^{\\mathrm{PD}} - t_{a,1}^{\\mathrm{PD}} \\;=\\; \\frac{\\Delta x}{v} + d_2 - d_1.\n$$\n对于非偏好方向，\n$$\n\\Delta t_{\\mathrm{ND}} \\;=\\; t_{a,1}^{\\mathrm{ND}} - t_{a,2}^{\\mathrm{ND}} \\;=\\; \\frac{\\Delta x}{v} + d_1 - d_2 \\;=\\; -\\Delta t_{\\mathrm{PD}}.\n$$\n因此，仅在偏好方向上发生建设性求和的一个充分必要的时间条件是 $|\\Delta t_{\\mathrm{PD}}| \\ll \\tau_s$ 同时 $|\\Delta t_{\\mathrm{ND}}| \\gg \\tau_s$。实现这一点的一个自然方法是设置\n$$\n\\Delta t_{\\mathrm{PD}} = \\frac{\\Delta x}{v} + d_2 - d_1 \\approx 0 \\quad \\Longleftrightarrow \\quad d_1 - d_2 \\approx \\frac{\\Delta x}{v},\n$$\n这样，在偏好方向上，延迟补偿了刺激在不同位置间的传播时间。在这种情况下，非偏好方向的时间间隔变为\n$$\n\\Delta t_{\\mathrm{ND}} = -\\Delta t_{\\mathrm{PD}} \\approx 0 \\;\\text{仅在上述关系精确成立时，符号才会翻转。}\n$$\n然而，代入精确补偿 $d_1 - d_2 = \\Delta x / v$ 会得到 $\\Delta t_{\\mathrm{PD}} = 0$ 和\n$$\n\\Delta t_{\\mathrm{ND}} \\;=\\; \\frac{\\Delta x}{v} + d_1 - d_2 \\;=\\; \\frac{\\Delta x}{v} + \\frac{\\Delta x}{v} \\;=\\; \\frac{2\\Delta x}{v},\n$$\n当 $\\frac{2\\Delta x}{v} \\gg \\tau_s$ 时，这个值相对于 $\\tau_s$ 很大。因此，仅在偏好方向上发生建设性求和的精确条件是\n$$\n\\left| \\frac{\\Delta x}{v} + d_2 - d_1 \\right| \\ll \\tau_s\n\\quad \\text{并且} \\quad\n\\frac{2\\Delta x}{v} \\gg \\tau_s.\n$$\n第一个条件确保了在偏好方向上的时间重合，第二个条件确保了在非偏好方向上的时间分离。\n\n模拟的算法设计：\n\n- 我们在时间步长为 $\\Delta t$、总时长为 $T$ 的时间网格上进行模拟。在每个时间步，使用带有相应 $t_{a,i}$ 的 alpha 函数计算任一方向的总突触电导 $g_{\\mathrm{syn}}(t) = g_1(t) + g_2(t)$。\n- 膜方程是系数随时间变化的线性方程。在一个总电导近似恒定的小时间步内，常微分方程\n$$\n\\frac{dV}{dt} = -\\frac{g_L + g_{\\mathrm{syn}}(t)}{C_m} V + \\frac{g_L E_L + g_{\\mathrm{syn}}(t) E_E}{C_m}\n$$\n具有精确的步长解\n$$\nV(t+\\Delta t) = V_\\infty(t) + \\left(V(t) - V_\\infty(t)\\right)\\exp\\!\\left(-\\frac{g_L + g_{\\mathrm{syn}}(t)}{C_m}\\Delta t\\right),\n$$\n其中 $V_\\infty(t) = \\frac{g_L E_L + g_{\\mathrm{syn}}(t) E_E}{g_L + g_{\\mathrm{syn}}(t)}$ 是瞬时不动点。\n- 初始化 $V(0)=E_L$ 并迭代以获得偏好和非偏好方向的 $V(t)$。记录峰值 $V_{\\max}^{\\mathrm{PD}}$ 和 $V_{\\max}^{\\mathrm{ND}}$。\n- 计算方向选择性指数\n$$\n\\mathrm{DSI} = \\frac{V_{\\max}^{\\mathrm{PD}} - V_{\\max}^{\\mathrm{ND}}}{V_{\\max}^{\\mathrm{PD}} + V_{\\max}^{\\mathrm{ND}}}.\n$$\n\n测试套件覆盖范围：\n\n- 案例 A 设置 $d_1 - d_2 = \\Delta x / v$ (其中 $\\Delta x = 0.2$，$v = 0.05$，所以 $\\Delta x/v = 4.0$)，满足了偏好方向的重合条件，并造成了 $2\\Delta x/v = 8.0$ 的非偏好方向时间间隔，这比 $\\tau_s = 2.0$ 大，所以我们预期 $\\mathrm{DSI}$ 会是大的正数。\n- 案例 B 设置 $d_1 - d_2 = -\\Delta x / v$，对齐了非偏好方向，所以预期 $\\mathrm{DSI}$ 为负数。\n- 案例 C 使用对称延迟 $d_1 = d_2$，所以 $|\\Delta t_{\\mathrm{PD}}| = |\\Delta t_{\\mathrm{ND}}| = \\Delta x/v$，导致相似的峰值响应和接近零的 $\\mathrm{DSI}$。\n- 案例 D 设置 $\\Delta x = 0$，使得刺激在不同方向上的到达时间相同，所以 $\\mathrm{DSI}$ 应该接近零。\n\n程序实现了上述模拟，计算了以毫伏为单位的峰值电压，并输出一行包含四个方向选择性指数值的 Python 列表，每个值四舍五入到六位小数，按指定测试用例的顺序排列。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef alpha_function(t, tau_s):\n    \"\"\"\n    Alpha function: alpha(s) = (s/tau_s) * exp(1 - s/tau_s) for s = 0, else 0.\n    Vectorized for numpy arrays.\n    \"\"\"\n    s = t\n    out = np.zeros_like(s)\n    mask = s = 0.0\n    sm = s[mask]\n    # Avoid underflow/overflow issues by direct computation; tau_s  0 by design.\n    out[mask] = (sm / tau_s) * np.exp(1.0 - sm / tau_s)\n    return out\n\ndef simulate_peak_response(C_m, g_L, E_L, E_E, g_peak, tau_s,\n                           delta_x, v, d1, d2,\n                           dt=0.05, T=100.0, direction='PD'):\n    \"\"\"\n    Simulate the membrane potential V(t) for a given direction (PD or ND)\n    and return the peak membrane potential in mV.\n    Units:\n      - C_m in pF, g_* in nS, E_* in mV, tau_s in ms, dt in ms, T in ms\n      - delta_x in mm, v in mm/ms, d1, d2 in ms\n    \"\"\"\n    # Time vector\n    t = np.arange(0.0, T + dt, dt)\n\n    # Stimulus arrival times at locations x1=0, x2=delta_x for PD and ND\n    ts1_PD = 0.0\n    ts2_PD = (delta_x / v) if v != 0 else 0.0\n    ts1_ND = (delta_x / v) if v != 0 else 0.0\n    ts2_ND = 0.0\n\n    if direction == 'PD':\n        ta1 = ts1_PD + d1\n        ta2 = ts2_PD + d2\n    else:\n        ta1 = ts1_ND + d1\n        ta2 = ts2_ND + d2\n\n    # Synaptic conductances (nS) as alpha functions\n    g1 = g_peak * alpha_function(t - ta1, tau_s)\n    g2 = g_peak * alpha_function(t - ta2, tau_s)\n    gsyn = g1 + g2\n\n    # Precompute constants\n    V = E_L  # initial condition at rest\n    Vmax = V\n\n    # Iterate with exact per-step solution:\n    # V_{k+1} = V_inf + (V_k - V_inf) * exp(-(g_L + gsyn)/C_m * dt)\n    # where V_inf = (g_L*E_L + gsyn*E_E)/(g_L + gsyn)\n    for k in range(len(t) - 1):\n        gtot = g_L + gsyn[k]  # nS\n        # Instantaneous fixed point\n        V_inf = (g_L * E_L + gsyn[k] * E_E) / gtot\n        # Effective rate in 1/ms since (nS)/(pF) = 1/ms\n        rate = gtot / C_m\n        V = V_inf + (V - V_inf) * np.exp(-rate * dt)\n        if V  Vmax:\n            Vmax = V\n\n    return Vmax\n\ndef direction_selectivity_index(Vpd_peak, Vnd_peak):\n    \"\"\"\n    Compute DSI = (PD - ND)/(PD + ND).\n    \"\"\"\n    denom = Vpd_peak + Vnd_peak\n    # To be safe, handle extremely small denom (though in this model denom  0)\n    if denom == 0.0:\n        return 0.0\n    return (Vpd_peak - Vnd_peak) / denom\n\ndef solve():\n    # Fixed biophysical parameters\n    C_m = 200.0    # pF\n    g_L = 10.0     # nS\n    E_L = -65.0    # mV\n    E_E = 0.0      # mV\n    g_peak = 5.0   # nS\n    tau_s = 2.0    # ms\n\n    # Simulation parameters\n    dt = 0.05      # ms\n    T = 100.0      # ms\n\n    # Test cases: (delta_x [mm], v [mm/ms], d1 [ms], d2 [ms])\n    test_cases = [\n        (0.2, 0.05, 4.0, 0.0),  # Case A: PD alignment (d1 - d2 = delta_x/v = 4.0 ms)\n        (0.2, 0.05, 0.0, 4.0),  # Case B: ND alignment (d1 - d2 = -4.0 ms)\n        (0.2, 0.05, 2.0, 2.0),  # Case C: symmetric delays\n        (0.0, 0.05, 1.0, 3.0),  # Case D: co-located inputs delta_x = 0\n    ]\n\n    results = []\n    for (delta_x, v, d1, d2) in test_cases:\n        # Preferred direction\n        Vpd_peak = simulate_peak_response(C_m, g_L, E_L, E_E, g_peak, tau_s,\n                                          delta_x, v, d1, d2,\n                                          dt=dt, T=T, direction='PD')\n        # Null direction\n        Vnd_peak = simulate_peak_response(C_m, g_L, E_L, E_E, g_peak, tau_s,\n                                          delta_x, v, d1, d2,\n                                          dt=dt, T=T, direction='ND')\n        dsi = direction_selectivity_index(Vpd_peak, Vnd_peak)\n        # Round to six decimals for output\n        results.append(round(dsi, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "在掌握了基本原理后，让我们将模型提升到更接近生物真实的复杂电路层面。视网膜中的星暴无长突细胞（SAC）到方向选择性神经节细胞（DSGC）的突触是方向选择性计算的典型例子。这项高级仿真练习将探索空间不对称的抑制作用如何与树突延迟相结合，共同塑造DSGC的响应，让你能够通过调整SAC的动力学特性来研究其对细胞偏好方向的影响。",
            "id": "3999419",
            "problem": "考虑一个简化的、机械性的方向选择性神经节细胞（Direction-Selective Ganglion Cell, DSGC）响应模型，该模型由一个移动的亮度光点驱动，其方向选择性源于兴奋性双极细胞输入与星暴无长突细胞（Starburst Amacrine Cells, SACs）抑制性输入之间的相互作用。视网膜被建模为一个二维空间域，DSGC位于原点。一个刺激光点以恒定速度沿直线路径移动，其方向角以度为单位指定。\n\n刺激强度由以下时空函数定义：\n$$\nS(\\mathbf{r}, t) = A \\exp\\left( -\\frac{\\|\\mathbf{r} - \\mathbf{s}(t)\\|^2}{2\\sigma_s^2} \\right),\n$$\n其中 $\\mathbf{r} = (x, y)$ 是以视角（degrees of visual angle）为单位的空间位置，$t$ 是以秒为单位的时间，$A$ 是刺激幅度，$\\sigma_s$ 是以度为单位的光点空间标准差，$\\mathbf{s}(t) = \\mathbf{r}_0 + v t \\mathbf{u}(\\varphi)$ 是移动光点的中心，其初始位置为 $\\mathbf{r}_0 = -L \\mathbf{u}(\\varphi)$，速度为 $v$（单位：度/秒），单位方向向量为 $\\mathbf{u}(\\varphi) = (\\cos\\varphi, \\sin\\varphi)$，其中 $\\varphi$ 以度为单位指定。\n\nDSGC的兴奋性驱动被建模为线性空间加权，后接一个因果时间低通滤波器。空间权重为：\n$$\nW_e(\\mathbf{r}) = \\exp\\left( -\\frac{\\|\\mathbf{r}\\|^2}{2\\sigma_e^2} \\right),\n$$\n兴奋性时间核为：\n$$\nk_e(t) = H(t)\\frac{1}{\\tau_e} \\exp\\left( -\\frac{t}{\\tau_e} \\right),\n$$\n其中 $H(t)$ 是亥维赛德阶跃函数，$\\tau_e$ 是以秒为单位的兴奋性时间常数，$\\sigma_e$ 是以度为单位的兴奋性空间标准差。兴奋性电流为：\n$$\nE(t) = \\left( \\iint W_e(\\mathbf{r}) S(\\mathbf{r}, t) \\, d\\mathbf{r} \\right) * k_e(t),\n$$\n其中 $*$ 表示时间上的卷积。\n\n由SAC介导的抑制被建模为具有树突延迟和因果时间核的方向门控空间加权。定义单位径向向量：\n$$\n\\hat{\\mathbf{r}} = \\frac{\\mathbf{r}}{\\|\\mathbf{r}\\|},\n$$\n对于 $\\mathbf{r} \\neq \\mathbf{0}$。设一个温和的方位各向异性调制抑制权重，其偏置角为 $\\theta_{\\text{bias}}$，调制深度为 $\\eta$：\n$$\nM(\\mathbf{r}) = 1 + \\eta \\cos(\\theta(\\mathbf{r}) - \\theta_{\\text{bias}}), \\quad \\theta(\\mathbf{r}) = \\operatorname{atan2}(y, x),\n$$\n并设离心门控为：\n$$\nG(\\mathbf{r}, \\varphi) = H\\left( \\mathbf{u}(\\varphi) \\cdot \\hat{\\mathbf{r}} \\right).\n$$\n抑制性空间权重为：\n$$\nW_i(\\mathbf{r}, \\varphi) = \\exp\\left( -\\frac{\\|\\mathbf{r}\\|}{\\lambda} \\right) M(\\mathbf{r}) G(\\mathbf{r}, \\varphi),\n$$\n空间衰减常数 $\\lambda$ 的单位为度。SAC树突延迟为：\n$$\n\\tau_d(\\mathbf{r}) = \\tau_{\\text{sac0}} + d \\, \\|\\mathbf{r}\\|,\n$$\n其中 $\\tau_{\\text{sac0}}$ 是以秒为单位的基础延迟，$d$ 是以秒/度为单位的每距离延迟参数。抑制性时间核为：\n$$\nk_i(t) = H(t)\\frac{1}{\\tau_i} \\exp\\left( -\\frac{t}{\\tau_i} \\right),\n$$\n抑制性时间常数 $\\tau_i$ 的单位为秒。原始抑制性驱动（滤波前）是延迟的空间积分：\n$$\nI_{\\text{raw}}(t; \\varphi) = \\iint W_i(\\mathbf{r}, \\varphi) S(\\mathbf{r}, t - \\tau_d(\\mathbf{r})) \\, d\\mathbf{r},\n$$\n滤波后的抑制性电流为：\n$$\nI(t; \\varphi) = I_{\\text{raw}}(\\cdot; \\varphi) * k_i(t).\n$$\n\n净突触驱动建模为：\n$$\ng(t; \\varphi) = E(t) - g_i I(t; \\varphi),\n$$\n其中抑制性增益 $g_i$ 无量纲，方向 $\\varphi$ 的响应代理取为在固定的仿真窗口 $[0, T_{\\text{end}}]$ 上的半波整流积分：\n$$\nR(\\varphi) = \\int_{0}^{T_{\\text{end}}} \\max\\{0, g(t; \\varphi)\\} \\, dt,\n$$\n\n将首选方向（Preferred Direction, PD）定义为在离散方向集上使 $R(\\varphi)$ 最大化的角度 $\\varphi$（以度为单位）。设离散集为：\n$$\n\\Phi = \\{0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330\\}.\n$$\n\n你的任务是实现一个程序，为基线参数集和三个改变了星暴无长突细胞（SAC）动力学的参数集，计算每个 $\\varphi \\in \\Phi$ 的 $R(\\varphi)$，然后提取每个集合的首选方向，并量化每次改变相对于基线所引起的首选方向的偏移。\n\n除非另有说明，在所有测试用例中均使用以下固定常数：\n- $A = 1.0$（无量纲强度），\n- $\\sigma_s = 0.1$ 度，\n- $\\sigma_e = 0.2$ 度，\n- $\\tau_e = 0.010$ 秒，\n- $\\tau_i = 0.020$ 秒，\n- $g_i = 1.2$（无量纲），\n- $v = 5.0$ 度/秒，\n- $L = 0.8$ 度，\n- $\\eta = 0.2$（无量纲），\n- $\\theta_{\\text{bias}} = 60$ 度，\n- $T_{\\text{end}} = 0.5$ 秒，\n- 空间域是一个方形网格，在两个坐标轴上均跨越 $[-1.5, 1.5]$ 度，均匀间距为 $0.05$ 度，\n- 时间步长为 $\\Delta t = 0.001$ 秒。\n\n基线参数集为：\n- $\\tau_{\\text{sac0}} = 0.030$ 秒，\n- $d = 0.010$ 秒/度，\n- $\\lambda = 0.50$ 度。\n\n三个更改后的参数集是：\n1. 较慢的SAC基础延迟：$\\tau_{\\text{sac0}} = 0.060$ 秒，$d = 0.010$ 秒/度，$\\lambda = 0.50$ 度。\n2. 更强的树突延迟缩放：$\\tau_{\\text{sac0}} = 0.030$ 秒，$d = 0.025$ 秒/度，$\\lambda = 0.50$ 度。\n3. 更紧凑的抑制性空间衰减：$\\tau_{\\text{sac0}} = 0.030$ 秒，$d = 0.010$ 秒/度，$\\lambda = 0.25$ 度。\n\n你必须：\n- 为基线和每个更改后的集合计算所有 $\\varphi \\in \\Phi$ 的 $R(\\varphi)$。\n- 确定基线的首选方向角，记为 $\\varphi_{\\text{PD,base}}$，单位为度。\n- 确定每个更改后集合的首选方向角，对 $k \\in \\{1,2,3\\}$ 记为 $\\varphi_{\\text{PD,case}k}$，单位为度。\n- 对每种情况 $k$，量化角度偏移 $\\Delta_k$（单位为度），其值为 $\\varphi_{\\text{PD,case}k}$ 和 $\\varphi_{\\text{PD,base}}$ 在圆上的最小绝对差，即\n$$\n\\Delta_k = \\min_{m \\in \\mathbb{Z}} \\left| \\varphi_{\\text{PD,case}k} - \\varphi_{\\text{PD,base}} + 360 m \\right|,\n$$\n限制在 $[0, 180]$ 度的区间内。\n\n程序中所有角度必须以度为单位处理和报告。时间必须以秒为单位处理。距离必须以视角（度）为单位处理。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序和类型如下：\n- $\\varphi_{\\text{PD,base}}$，浮点数，单位为度，\n- $\\Delta_1$，浮点数，单位为度，\n- $\\Delta_2$，浮点数，单位为度，\n- $\\Delta_3$，浮点数，单位为度。\n\n例如，输出格式必须与以下完全一样：\n$$\n[\\text{baseline\\_PD}, \\text{shift\\_case1}, \\text{shift\\_case2}, \\text{shift\\_case3}],\n$$\n每个条目都是一个浮点数。\n\n测试套件：\n- 基线：$\\tau_{\\text{sac0}} = 0.030$，$d = 0.010$，$\\lambda = 0.50$。\n- 情况1：$\\tau_{\\text{sac0}} = 0.060$，$d = 0.010$，$\\lambda = 0.50$。\n- 情况2：$\\tau_{\\text{sac0}} = 0.030$，$d = 0.025$，$\\lambda = 0.50$。\n- 情况3：$\\tau_{\\text{sac0}} = 0.030$，$d = 0.010$，$\\lambda = 0.25$。\n\n你的解决方案必须是一个完整、可运行的程序，通过离散化执行这些计算，并完全按照指定格式打印最后一行。不需要用户输入。",
            "solution": "用户提供了一个理论神经科学领域的计算问题。该问题旨在对方向选择性神经节细胞（Direction-Selective Ganglion Cell, DSGC）的响应进行建模，并确定在不同生理参数条件下其运动的首选方向。在尝试求解之前，需要对问题陈述进行严格验证。\n\n### 步骤1：提取已知信息\n\n问题提供了以下数学定义、常数和数值参数：\n\n**模型方程：**\n- 刺激强度：$S(\\mathbf{r}, t) = A \\exp\\left( -\\frac{\\|\\mathbf{r} - \\mathbf{s}(t)\\|^2}{2\\sigma_s^2} \\right)$\n- 刺激中心路径：$\\mathbf{s}(t) = \\mathbf{r}_0 + v t \\mathbf{u}(\\varphi)$，其中 $\\mathbf{r}_0 = -L \\mathbf{u}(\\varphi)$ 且 $\\mathbf{u}(\\varphi) = (\\cos\\varphi, \\sin\\varphi)$\n- 兴奋性空间权重：$W_e(\\mathbf{r}) = \\exp\\left( -\\frac{\\|\\mathbf{r}\\|^2}{2\\sigma_e^2} \\right)$\n- 兴奋性时间核：$k_e(t) = H(t)\\frac{1}{\\tau_e} \\exp\\left( -\\frac{t}{\\tau_e} \\right)$\n- 兴奋性电流：$E(t) = \\left( \\iint W_e(\\mathbf{r}) S(\\mathbf{r}, t) \\, d\\mathbf{r} \\right) * k_e(t)$\n- 抑制性空间权重：$W_i(\\mathbf{r}, \\varphi) = \\exp\\left( -\\frac{\\|\\mathbf{r}\\|}{\\lambda} \\right) M(\\mathbf{r}) G(\\mathbf{r}, \\varphi)$\n- 方位调制：$M(\\mathbf{r}) = 1 + \\eta \\cos(\\theta(\\mathbf{r}) - \\theta_{\\text{bias}})$，其中 $\\theta(\\mathbf{r}) = \\operatorname{atan2}(y, x)$\n- 离心门控：$G(\\mathbf{r}, \\varphi) = H\\left( \\mathbf{u}(\\varphi) \\cdot \\hat{\\mathbf{r}} \\right)$，其中 $\\hat{\\mathbf{r}} = \\frac{\\mathbf{r}}{\\|\\mathbf{r}\\|}$ 对于 $\\mathbf{r} \\neq \\mathbf{0}$\n- 树突延迟：$\\tau_d(\\mathbf{r}) = \\tau_{\\text{sac0}} + d \\, \\|\\mathbf{r}\\|$\n- 抑制性时间核：$k_i(t) = H(t)\\frac{1}{\\tau_i} \\exp\\left( -\\frac{t}{\\tau_i} \\right)$\n- 原始抑制性驱动：$I_{\\text{raw}}(t; \\varphi) = \\iint W_i(\\mathbf{r}, \\varphi) S(\\mathbf{r}, t - \\tau_d(\\mathbf{r})) \\, d\\mathbf{r}$\n- 抑制性电流：$I(t; \\varphi) = I_{\\text{raw}}(\\cdot; \\varphi) * k_i(t)$\n- 净突触驱动：$g(t; \\varphi) = E(t) - g_i I(t; \\varphi)$\n- 响应代理：$R(\\varphi) = \\int_{0}^{T_{\\text{end}}} \\max\\{0, g(t; \\varphi)\\} \\, dt$\n\n**任务定义：**\n- 离散方向集：$\\Phi = \\{0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330\\}$ 度\n- 首选方向 (PD)：使 $R(\\varphi)$ 最大化的角度 $\\varphi \\in \\Phi$\n- 角度偏移：$\\Delta_k = \\min_{m \\in \\mathbb{Z}} \\left| \\varphi_{\\text{PD,case}k} - \\varphi_{\\text{PD,base}} + 360 m \\right|$，限制在 $[0, 180]$ 度\n\n**固定常数：**\n- $A = 1.0$，$\\sigma_s = 0.1$ 度，$\\sigma_e = 0.2$ 度，$\\tau_e = 0.010$ 秒，$\\tau_i = 0.020$ 秒，$g_i = 1.2$，$v = 5.0$ 度/秒，$L = 0.8$ 度，$\\eta = 0.2$，$\\theta_{\\text{bias}} = 60$ 度，$T_{\\text{end}} = 0.5$ 秒。\n\n**数值参数：**\n- 空间域：$[-1.5, 1.5] \\times [-1.5, 1.5]$ 度\n- 空间步长：$0.05$ 度\n- 时间步长：$\\Delta t = 0.001$ 秒\n\n**参数集：**\n- 基线：$\\tau_{\\text{sac0}} = 0.030$ 秒， $d = 0.010$ 秒/度，$\\lambda = 0.50$ 度\n- 情况1：$\\tau_{\\text{sac0}} = 0.060$ 秒，$d = 0.010$ 秒/度，$\\lambda = 0.50$ 度\n- 情况2：$\\tau_{\\text{sac0}} = 0.030$ 秒，$d = 0.025$ 秒/度，$\\lambda = 0.50$ 度\n- 情况3：$\\tau_{\\text{sac0}} = 0.030$ 秒，$d = 0.010$ 秒/度，$\\lambda = 0.25$ 度\n\n### 步骤2：使用提取的已知信息进行验证\n\n对问题进行严格验证，以判断其是否符合指定标准。\n\n- **科学依据充分：** 该问题描述了一个视网膜方向选择性的机械模型，这是计算神经科学领域的一个重要研究课题。模型各组成部分——高斯感受野、时空滤波、来自星暴无长突细胞（SAC）的非对称抑制以及树突延迟——都基于已建立的生物物理和理论原理（例如，Barlow-Levick模型的扩展）。该问题在科学上是合理的。\n- **良构的（Well-Posed）：** 所有方程、参数、边界条件（隐含在刺激路径中）、仿真域和离散化步骤都已明确提供。任务是在有限集合上找到函数的最大值，这是一个明确定义的操作。问题是自洽的，能够得出一个唯一的数值解。\n- **客观的：** 问题以精确的数学语言表述，没有主观性、歧义或观点。\n- **缺陷分析：**\n    1.  **科学/事实不合理：** 无。该模型是对视网膜回路的一个合理（尽管简化）的表示。\n    2.  **非形式化/不相关：** 无。问题是完全可形式化的，并且与其所述主题核心相关。\n    3.  **不完整/矛盾的设置：** 无。所有必要信息均已提供且内部一致。\n    4.  **不现实/不可行：** 无。参数值在生理学上是合理的范围内。所需的计算虽然密集，但对于现代处理器是可行的。单位（度、秒）是一致的。\n    5.  **病态/结构不良：** 无。问题结构导向一个唯一、稳定且有意义的数值结果。对于在 $\\mathbf{r}=\\mathbf{0}$ 处 $\\hat{\\mathbf{r}}$ 和 $\\theta(\\mathbf{r})$ 的定义存在轻微歧义，但标准的数值约定（例如，在未定义处将贡献设为0）可以解决此问题，而不会影响问题的完整性。\n    6.  **伪深刻/琐碎：** 无。该问题需要进行非平凡的数值模拟，涉及空间积分、时间卷积以及处理依赖于空间的时间延迟，代表了一项合法的计算建模任务。\n    7.  **超出科学可验证性：** 无。通过独立实现所述算法，计算结果是完全可验证的。\n\n### 步骤3：结论与行动\n\n问题陈述是**有效的**。这是一个良构的、有科学依据且计算上可行的理论神经科学问题。我们可以继续进行求解。\n\n### 解决方案设计\n\n问题的核心是针对一组刺激方向和生理参数，对DSGC的响应进行数值模拟。该解决方案将通过在空间和时间网格上离散化所提供的连续方程来实现。\n\n**1. 离散化：**\n- 将为 $[-1.5, 1.5] \\times [-1.5, 1.5]$ 度的域构建一个均匀的空间网格，步长为 $\\Delta x = \\Delta y = 0.05$ 度。微分面积元 $d\\mathbf{r}$ 近似为 $\\Delta A = \\Delta x \\Delta y$。\n- 将从 $t=0$ 到 $t=T_{\\text{end}} = 0.5$ 秒构建一个均匀的时间网格，时间步长为 $\\Delta t = 0.001$ 秒。\n- 积分变为由 $\\Delta A$ 或 $\\Delta t$ 加权的求和，卷积变为离散卷积。\n\n**2. 算法流程：**\n总体结构包括一个遍历四个参数集（基线和三种情况）的外层循环，以及一个遍历12个离散刺激方向 $\\varphi \\in \\Phi$ 的内层循环。\n\n对于每个方向 $\\varphi$ 和每个参数集：\n\n**a. 刺激生成：**\n刺激 $S(\\mathbf{r}, t)$ 是一个以恒定速度移动的高斯光点。它在每个空间网格点 $(\\mathbf{r}_{ij})$ 和每个时间步 $(t_k)$ 的值将被预先计算并存储在一个三维数组或“影片” $S_{ijk} = S(\\mathbf{r}_{ij}, t_k)$ 中。这对于计算有时间延迟的抑制是必要的。\n\n**b. 兴奋性通路, $E(t)$：**\n1.  对于每个时间步 $t_k$，通过在空间网格上求和来计算兴奋性权重 $W_e(\\mathbf{r})$ 和刺激 $S(\\mathbf{r}, t_k)$ 之间的空间重叠：$I_e(t_k) = \\sum_{i,j} W_e(\\mathbf{r}_{ij}) S(\\mathbf{r}_{ij}, t_k) \\Delta A$。\n2.  然后将得到的时间序列 $I_e(t)$ 与兴奋性时间核 $k_e(t)$ 的离散版本进行卷积，得到兴奋性电流 $E(t)$。卷积积分近似为一个离散和，并按 $\\Delta t$ 缩放。\n\n**c. 抑制性通路, $I(t; \\varphi)$：**\n由于存在依赖于空间的时间延迟 $\\tau_d(\\mathbf{r})$，这是计算上要求最高的部分。\n1.  为给定的 $\\varphi$ 计算方向依赖的抑制性空间权重 $W_i(\\mathbf{r}, \\varphi)$。这涉及计算调制项 $M(\\mathbf{r})$ 和门控项 $G(\\mathbf{r}, \\varphi)$。在 $\\mathbf{r}=\\mathbf{0}$ 处 $\\hat{\\mathbf{r}}$ 和 $\\theta(\\mathbf{r})$ 的奇点通过采用标准数值约定（例如，将在原点处未定义项的贡献设为0）来处理。\n2.  计算原始抑制性驱动 $I_{\\text{raw}}(t; \\varphi)$。对于每个时间步 $t_k$，我们必须评估积分 $\\iint W_i(\\mathbf{r}, \\varphi) S(\\mathbf{r}, t_k - \\tau_d(\\mathbf{r})) \\, d\\mathbf{r}$。\n3.  在数值上，对于每个网格点 $\\mathbf{r}_{ij}$，这需要刺激在延迟时间 $t' = t_k - \\tau_d(\\mathbf{r}_{ij})$ 的值。由于 $t'$ 通常不会落在离散的时间步上，因此使用时间上的线性插值。对于每个空间点 $(i,j)$ 和时间点 $k$，我们找到 $t'$ 的两个最近的时间索引，并对预计算的刺激值 $S_{ijk}$ 进行插值。\n4.  然后将插值后的刺激切片乘以 $W_i(\\mathbf{r}_{ij}, \\varphi)$ 并在空间网格上求和，得到 $I_{\\text{raw}}(t_k; \\varphi)$。\n5.  最后，将此时间序列 $I_{\\text{raw}}(t; \\varphi)$ 与离散的抑制性核 $k_i(t)$ 进行卷积，得到抑制性电流 $I(t; \\varphi)$。\n\n**d. 响应计算：**\n1.  净突触驱动计算为 $g(t; \\varphi) = E(t) - g_i I(t; \\varphi)$。\n2.  通过对半波整流信号进行数值积分来计算响应 $R(\\varphi)$：$R(\\varphi) = \\sum_k \\max\\{0, g(t_k; \\varphi)\\} \\Delta t$。\n\n**3. 分析：**\n- 对于每个参数集，获得响应集合 $\\{R(\\varphi) | \\varphi \\in \\Phi\\}$。首选方向（PD）是对应于最大响应的角度 $\\varphi$。\n- 对于每种情况 $k \\in \\{1,2,3\\}$，相对于基线PD计算偏移量 $\\Delta_k$，使用圆上最短角度的公式：$\\Delta_k = \\min(|\\text{PD}_k - \\text{PD}_{\\text{base}}|, 360 - |\\text{PD}_k - \\text{PD}_{\\text{base}}|)$。\n\n这种结构化的数值方法确保了模型方程的忠实实现，以产生所需的结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the preferred direction (PD) of a model DSGC for a baseline and three\n    altered parameter sets, and calculates the shift in PD for each alteration.\n    \"\"\"\n\n    # --- Fixed constants and numerical parameters ---\n    A = 1.0  # Stimulus amplitude\n    SIGMA_S = 0.1  # Stimulus spatial std dev (deg)\n    SIGMA_E = 0.2  # Excitatory spatial std dev (deg)\n    TAU_E = 0.010  # Excitatory time constant (s)\n    TAU_I = 0.020  # Inhibitory time constant (s)\n    G_I = 1.2  # Inhibitory gain\n    V = 5.0  # Stimulus speed (deg/s)\n    L = 0.8  # Stimulus path start distance (deg)\n    ETA = 0.2  # Inhibitory modulation depth\n    THETA_BIAS_DEG = 60.0  # Inhibitory bias angle (deg)\n    T_END = 0.5  # Simulation end time (s)\n\n    # Discretization parameters\n    DX = 0.05  # Spatial step (deg)\n    DT = 0.001  # Time step (s)\n    \n    # Set of directions to test\n    PHI_DIRECTIONS = np.array([0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330], dtype=float)\n\n    # --- Parameter sets for the four cases ---\n    param_sets = [\n        # Baseline\n        {'tau_sac0': 0.030, 'd': 0.010, 'lambda': 0.50},\n        # Case 1: Slower base SAC delay\n        {'tau_sac0': 0.060, 'd': 0.010, 'lambda': 0.50},\n        # Case 2: Stronger dendritic delay scaling\n        {'tau_sac0': 0.030, 'd': 0.025, 'lambda': 0.50},\n        # Case 3: Tighter inhibitory spatial falloff\n        {'tau_sac0': 0.030, 'd': 0.010, 'lambda': 0.25},\n    ]\n\n    # --- Set up grids (do once to save computation) ---\n    x_coords = np.arange(-1.5, 1.5 + DX / 2, DX)\n    y_coords = np.arange(-1.5, 1.5 + DX / 2, DX)\n    t_coords = np.arange(0, T_END + DT / 2, DT)\n    \n    X, Y = np.meshgrid(x_coords, y_coords)\n    R = np.sqrt(X**2 + Y**2)\n    Theta = np.arctan2(Y, X) # atan2(y,x)\n    y_indices, x_indices = np.indices(X.shape)\n    \n    # Pre-compute static components\n    W_e = np.exp(-(R**2) / (2 * SIGMA_E**2))\n    \n    # Temporal kernels\n    kernel_e_full = (1 / TAU_E) * np.exp(-np.arange(0, T_END*2, DT) / TAU_E)\n    kernel_i_full = (1 / TAU_I) * np.exp(-np.arange(0, T_END*2, DT) / TAU_I)\n    \n    preferred_directions = []\n\n    for params in param_sets:\n        tau_sac0 = params['tau_sac0']\n        d_delay = params['d']\n        lambda_falloff = params['lambda']\n\n        responses = []\n        for phi_deg in PHI_DIRECTIONS:\n            phi_rad = np.deg2rad(phi_deg)\n            u = np.array([np.cos(phi_rad), np.sin(phi_rad)])\n\n            # --- Calculate Stimulus Movie S(t, y, x) ---\n            s_0 = -L * u\n            s_t = s_0[:, np.newaxis] + V * t_coords * u[:, np.newaxis] # Shape (2, N_t)\n            \n            # Use broadcasting for efficiency\n            dist_sq = (X[np.newaxis, :, :] - s_t[0, :, np.newaxis, np.newaxis])**2 + \\\n                      (Y[np.newaxis, :, :] - s_t[1, :, np.newaxis, np.newaxis])**2\n            \n            S_movie = A * np.exp(-dist_sq / (2 * SIGMA_S**2))\n\n            # --- Excitatory Pathway E(t) ---\n            Ie_t = np.sum(W_e * S_movie, axis=(1, 2)) * DX * DX\n            E_t = np.convolve(Ie_t, kernel_e_full, 'full')[:len(t_coords)] * DT\n\n            # --- Inhibitory Pathway I(t) ---\n            tau_d_grid = tau_sac0 + d_delay * R\n            \n            theta_bias_rad = np.deg2rad(THETA_BIAS_DEG)\n            M = 1 + ETA * np.cos(Theta - theta_bias_rad)\n            \n            dot_prod_over_R = np.divide(u[0] * X + u[1] * Y, R, out=np.zeros_like(R), where=R != 0)\n            G = np.heaviside(dot_prod_over_R, 0)\n            \n            W_i = np.exp(-R / lambda_falloff) * M * G\n\n            # Calculate I_raw(t) with time-delay interpolation\n            I_raw_t = np.zeros_like(t_coords)\n            \n            # Vectorized interpolation\n            delayed_times = t_coords[:, np.newaxis, np.newaxis] - tau_d_grid\n            delayed_indices_float = delayed_times / DT\n            \n            idx0 = np.floor(delayed_indices_float).astype(int)\n            w1 = delayed_indices_float - idx0\n            w0 = 1.0 - w1\n            \n            np.clip(idx0, 0, len(t_coords) - 1, out=idx0)\n            idx1 = np.clip(idx0 + 1, 0, len(t_coords) - 1)\n\n            S0 = S_movie[idx0, y_indices, x_indices]\n            S1 = S_movie[idx1, y_indices, x_indices]\n            \n            S_interp = S0 * w0 + S1 * w1\n            \n            I_raw_t = np.sum(W_i * S_interp, axis=(1, 2)) * DX * DX\n                \n            I_t = np.convolve(I_raw_t, kernel_i_full, 'full')[:len(t_coords)] * DT\n\n            # --- Net Drive and Response ---\n            g_t = E_t - G_I * I_t\n            R_phi = np.sum(np.maximum(0, g_t)) * DT\n            responses.append(R_phi)\n\n        pd_index = np.argmax(responses)\n        preferred_directions.append(PHI_DIRECTIONS[pd_index])\n\n    # --- Final Analysis ---\n    pd_base = preferred_directions[0]\n    pd_cases = preferred_directions[1:]\n    \n    shifts = []\n    for pd_case in pd_cases:\n        diff = np.abs(pd_case - pd_base)\n        shift = min(diff, 360.0 - diff)\n        shifts.append(shift)\n\n    results = [pd_base] + shifts\n    \n    # Print the final result in the specified format\n    print(f\"[{','.join(map(str, [float(r) for r in results]))}]\")\n\nsolve()\n\n```"
        }
    ]
}