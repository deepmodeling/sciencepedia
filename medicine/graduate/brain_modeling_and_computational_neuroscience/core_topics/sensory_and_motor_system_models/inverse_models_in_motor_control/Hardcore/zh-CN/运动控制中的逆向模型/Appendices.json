{
    "hands_on_practices": [
        {
            "introduction": "我们从一个核心问题开始：大脑是如何学习从期望结果到所需运动指令的映射？本练习将引导你理解基于梯度的学习这一基本机制。通过计算任务误差对运动指令变化的敏感度，你将掌握逆向模型如何通过经验进行迭代更新的基础原理 。",
            "id": "3992041",
            "problem": "考虑一个受大脑启发的运动控制逆模型，该模型选择一个命令向量 $u \\in \\mathbb{R}^{3}$，通过一个非线性系统 $x = f(u) \\in \\mathbb{R}^{2}$ 和一个任务映射 $y = h(x) \\in \\mathbb{R}^{2}$，以实现期望的任务输出 $y^{\\star} \\in \\mathbb{R}^{2}$。中枢神经系统（CNS）被假设通过减小一个标量任务误差 $E(u) = \\frac{1}{2} \\|h(f(u)) - y^{\\star}\\|^{2}$ 来学习一个将 $y^{\\star}$ 映射到命令 $u$ 的逆模型。假设使用系统在名义命令 $u_{0}$ 附近的一阶线性化来评估微小的命令变化，即 $x \\approx f(u_{0}) + J_{u}(u_{0})(u - u_{0})$，其中 $J_{u}(u_{0})$ 是 $f$ 在 $u_{0}$ 点关于 $u$ 的雅可比矩阵。从第一性原理（链式法则以及梯度和方向导数的定义）出发，推导任务误差 $E$ 对微小命令变化的一阶灵敏度，并解释这种局部近似如何支持基于梯度的逆模型更新。\n\n使用以下科学上合理的非线性映射和参数进行计算：\n- $f(u) = \\begin{pmatrix} \\tanh(u_{1}) + u_{2} u_{3} \\\\ u_{1}^{2} - \\cos(u_{2}) \\end{pmatrix}$,\n- $h(x) = \\begin{pmatrix} x_{1}^{2} + \\sin(x_{2}) \\\\ \\exp(x_{1}) + x_{2} \\end{pmatrix}$,\n- $u_{0} = \\begin{pmatrix} 0.3 \\\\ 0.2 \\\\ -0.5 \\end{pmatrix}$,\n- $y^{\\star} = \\begin{pmatrix} 0.2 \\\\ 0.4 \\end{pmatrix}$,\n- 命令变化方向 $\\Delta u = \\begin{pmatrix} 0.1 \\\\ -0.2 \\\\ 0.05 \\end{pmatrix}$。\n\n使用线性化和链式法则，计算 $E$ 在 $u_{0}$ 点沿 $\\Delta u$ 方向的方向导数，即 $\\left.\\frac{d}{d\\epsilon} E(u_{0} + \\epsilon \\Delta u)\\right|_{\\epsilon = 0}$，并将您的数值答案四舍五入到四位有效数字。答案不带单位。",
            "solution": "该问题陈述具有科学依据，提法恰当且完整。它描述了计算运动控制中的一个标准问题，采用了非线性函数复合、雅可比矩阵、链式法则和基于梯度的优化等有效的数学概念。所有必要的函数、参数和初始条件都已给出，且内部没有矛盾。因此，该问题是有效的，我们可以着手求解。\n\n问题的核心是确定任务误差 $E$ 对命令向量 $u$ 微小变化的一阶灵敏度。沿特定变化方向 $\\Delta u$ 的这种灵敏度由方向导数给出。\n\n首先，我们来形式化各个组成部分。\n任务误差是命令向量 $u$ 的一个标量函数：\n$$E(u) = \\frac{1}{2} \\|h(f(u)) - y^{\\star}\\|^{2}$$\n设表示从命令到任务输出的完整前向模型的复合函数为 $y(u) = h(f(u))$。设误差向量为 $e(u) = y(u) - y^{\\star}$。任务误差可以写成：\n$$E(u) = \\frac{1}{2} e(u)^T e(u)$$\n我们需要求出 $E$ 在名义命令 $u_0$ 处，沿命令变化方向 $\\Delta u$ 的方向导数。其定义为：\n$$\\nabla_{\\Delta u} E(u_0) = \\left.\\frac{d}{d\\epsilon} E(u_0 + \\epsilon \\Delta u)\\right|_{\\epsilon = 0}$$\n根据方向导数的性质，这等价于 $E$ 在 $u_0$ 处的梯度与方向向量 $\\Delta u$ 的点积：\n$$\\nabla_{\\Delta u} E(u_0) = \\nabla E(u_0)^T \\Delta u$$\n我们的第一步是推导误差函数 $\\nabla E(u)$ 的梯度。我们使用多变量函数的链式法则。$E$ 的微分为：\n$$dE = \\frac{\\partial E}{\\partial e} de = e(u)^T de$$\n误差向量 $e(u)$ 的微分是 $de = dy$，因为 $y^{\\star}$ 是一个常数向量。\n任务输出 $y(u) = h(f(u))$ 的微分可以通过两次应用链式法则来找到。令 $x = f(u)$。\n首先，$dy = J_h(x) dx$，其中 $J_h(x)$ 是 $h$ 关于 $x$ 的雅可比矩阵。\n其次，$dx = J_f(u) du$，其中 $J_f(u)$ 是 $f$ 关于 $u$ 的雅可比矩阵。\n将这些代回，我们得到：\n$$dy = J_h(f(u)) J_f(u) du$$\n令 $J_y(u) = J_h(f(u)) J_f(u)$ 为完整前向模型 $y(u)$ 的雅可比矩阵。\n那么，$dE = e(u)^T J_y(u) du$。\n梯度 $\\nabla E(u)$ 的定义是 $dE = \\nabla E(u)^T du$。通过比较 $dE$ 的两个表达式，我们确定：\n$$\\nabla E(u)^T = e(u)^T J_y(u) = e(u)^T J_h(f(u)) J_f(u)$$\n取转置得到梯度向量：\n$$\\nabla E(u) = J_f(u)^T J_h(f(u))^T e(u)$$\n这个梯度向量 $\\nabla E(u)$ 指向任务误差 $E$ 的最速上升方向。对于基于梯度的学习，中枢神经系统会沿着相反方向更新运动命令，$u_{k+1} = u_k - \\eta \\nabla E(u_k)$，其中 $\\eta$ 是一个小的正学习率。这个过程迭代地调整命令以最小化任务误差，从而学习到将期望输出 $y^{\\star}$ 映射到所需命令 $u$ 的逆模型。\n\n于是，方向导数为：\n$$\\nabla_{\\Delta u} E(u_0) = \\nabla E(u_0)^T \\Delta u = e(u_0)^T J_h(x_0) J_f(u_0) \\Delta u$$\n其中 $x_0 = f(u_0)$。我们现在进行数值计算。\n\n给定的值为：\n$u_0 = \\begin{pmatrix} 0.3 \\\\ 0.2 \\\\ -0.5 \\end{pmatrix}$，$y^{\\star} = \\begin{pmatrix} 0.2 \\\\ 0.4 \\end{pmatrix}$，$\\Delta u = \\begin{pmatrix} 0.1 \\\\ -0.2 \\\\ 0.05 \\end{pmatrix}$。\n\n步骤 1：计算 $x_0 = f(u_0)$。\n$f(u) = \\begin{pmatrix} \\tanh(u_{1}) + u_{2} u_{3} \\\\ u_{1}^{2} - \\cos(u_{2}) \\end{pmatrix}$\n$x_0 = f(u_0) = \\begin{pmatrix} \\tanh(0.3) + (0.2)(-0.5) \\\\ (0.3)^{2} - \\cos(0.2) \\end{pmatrix} = \\begin{pmatrix} \\tanh(0.3) - 0.1 \\\\ 0.09 - \\cos(0.2) \\end{pmatrix}$\n使用数值，$\\tanh(0.3) \\approx 0.29131$ 且 $\\cos(0.2) \\approx 0.98007$。\n$x_0 \\approx \\begin{pmatrix} 0.29131 - 0.1 \\\\ 0.09 - 0.98007 \\end{pmatrix} = \\begin{pmatrix} 0.19131 \\\\ -0.89007 \\end{pmatrix}$。我们将其分量命名为 $x_{0,1}$ 和 $x_{0,2}$。\n\n步骤 2：计算雅可比矩阵 $J_f(u_0)$ 和 $J_h(x_0)$。\n$J_f(u) = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial u_1}  \\frac{\\partial f_1}{\\partial u_2}  \\frac{\\partial f_1}{\\partial u_3} \\\\ \\frac{\\partial f_2}{\\partial u_1}  \\frac{\\partial f_2}{\\partial u_2}  \\frac{\\partial f_2}{\\partial u_3} \\end{pmatrix} = \\begin{pmatrix} 1-\\tanh^2(u_1)  u_3  u_2 \\\\ 2u_1  \\sin(u_2)  0 \\end{pmatrix}$\n在 $u_0$ 点：\n$J_f(u_0) = \\begin{pmatrix} 1-\\tanh^2(0.3)  -0.5  0.2 \\\\ 2(0.3)  \\sin(0.2)  0 \\end{pmatrix} \\approx \\begin{pmatrix} 1-(0.29131)^2  -0.5  0.2 \\\\ 0.6  0.19867  0 \\end{pmatrix} = \\begin{pmatrix} 0.91515  -0.5  0.2 \\\\ 0.6  0.19867  0 \\end{pmatrix}$。\n\n$h(x) = \\begin{pmatrix} x_{1}^{2} + \\sin(x_{2}) \\\\ \\exp(x_{1}) + x_{2} \\end{pmatrix}$\n$J_h(x) = \\begin{pmatrix} \\frac{\\partial h_1}{\\partial x_1}  \\frac{\\partial h_1}{\\partial x_2} \\\\ \\frac{\\partial h_2}{\\partial x_1}  \\frac{\\partial h_2}{\\partial x_2} \\end{pmatrix} = \\begin{pmatrix} 2x_1  \\cos(x_2) \\\\ \\exp(x_1)  1 \\end{pmatrix}$\n在 $x_0$ 点：\n$J_h(x_0) = \\begin{pmatrix} 2x_{0,1}  \\cos(x_{0,2}) \\\\ \\exp(x_{0,1})  1 \\end{pmatrix} \\approx \\begin{pmatrix} 2(0.19131)  \\cos(-0.89007) \\\\ \\exp(0.19131)  1 \\end{pmatrix} = \\begin{pmatrix} 0.38262  \\cos(0.89007) \\\\ 1.21085  1 \\end{pmatrix} \\approx \\begin{pmatrix} 0.38262  0.62933 \\\\ 1.21085  1 \\end{pmatrix}$。\n\n步骤 3：计算误差向量 $e(u_0) = h(f(u_0)) - y^{\\star} = h(x_0) - y^{\\star}$。\n$y_0 = h(x_0) \\approx \\begin{pmatrix} (0.19131)^2 + \\sin(-0.89007) \\\\ \\exp(0.19131) + (-0.89007) \\end{pmatrix} = \\begin{pmatrix} 0.03660 - 0.77712 \\\\ 1.21085 - 0.89007 \\end{pmatrix} = \\begin{pmatrix} -0.74052 \\\\ 0.32078 \\end{pmatrix}$。\n$e(u_0) = y_0 - y^{\\star} \\approx \\begin{pmatrix} -0.74052 - 0.2 \\\\ 0.32078 - 0.4 \\end{pmatrix} = \\begin{pmatrix} -0.94052 \\\\ -0.07922 \\end{pmatrix}$。\n\n步骤 4：计算完整乘积 $e(u_0)^T J_h(x_0) J_f(u_0) \\Delta u$。\n我们首先计算向量 $v = J_f(u_0) \\Delta u$：\n$v \\approx \\begin{pmatrix} 0.91515  -0.5  0.2 \\\\ 0.6  0.19867  0 \\end{pmatrix} \\begin{pmatrix} 0.1 \\\\ -0.2 \\\\ 0.05 \\end{pmatrix} = \\begin{pmatrix} (0.91515)(0.1) + (-0.5)(-0.2) + (0.2)(0.05) \\\\ (0.6)(0.1) + (0.19867)(-0.2) + (0)(0.05) \\end{pmatrix} = \\begin{pmatrix} 0.091515 + 0.1 + 0.01 \\\\ 0.06 - 0.039734 + 0 \\end{pmatrix} = \\begin{pmatrix} 0.201515 \\\\ 0.020266 \\end{pmatrix}$。\n\n接下来，我们计算行向量 $w^T = e(u_0)^T J_h(x_0)$：\n$w^T \\approx \\begin{pmatrix} -0.94052  -0.07922 \\end{pmatrix} \\begin{pmatrix} 0.38262  0.62933 \\\\ 1.21085  1 \\end{pmatrix}$\n$w^T = \\begin{pmatrix} (-0.94052)(0.38262) + (-0.07922)(1.21085)  (-0.94052)(0.62933) + (-0.07922)(1) \\end{pmatrix}$\n$w^T = \\begin{pmatrix} -0.35987 - 0.09592  -0.59190 - 0.07922 \\end{pmatrix} = \\begin{pmatrix} -0.45579  -0.67112 \\end{pmatrix}$。\n\n最后，方向导数为 $w^T v$：\n$\\nabla_{\\Delta u} E(u_0) \\approx \\begin{pmatrix} -0.45579  -0.67112 \\end{pmatrix} \\begin{pmatrix} 0.201515 \\\\ 0.020266 \\end{pmatrix}$\n$= (-0.45579)(0.201515) + (-0.67112)(0.020266)$\n$= -0.091849 - 0.013601 = -0.10545$。\n\n对所有中间步骤使用更高的精度：\n$x_0 = \\begin{pmatrix} 0.19131260 \\\\ -0.89006658 \\end{pmatrix}$\n$e(u_0) = \\begin{pmatrix} -0.94051586 \\\\ -0.07921628 \\end{pmatrix}$\n$J_f(u_0) = \\begin{pmatrix} 0.9151523  -0.5  0.2 \\\\ 0.6  0.19866933  0 \\end{pmatrix}$\n$J_h(x_0) = \\begin{pmatrix} 0.3826252  0.6293315 \\\\ 1.2108503  1 \\end{pmatrix}$\n$J_y(u_0) = J_h(x_0) J_f(u_0) = \\begin{pmatrix} 0.7277589  -0.0662836  0.07652504 \\\\ 1.7081498  -0.4067558  0.24217006 \\end{pmatrix}$\n$J_y(u_0) \\Delta u = \\begin{pmatrix} 0.08985895 \\\\ 0.2642747 \\end{pmatrix}$\n$e(u_0)^T (J_y(u_0) \\Delta u) = (-0.94051586)(0.08985895) + (-0.07921628)(0.2642747) = -0.08451336 - 0.02093498 = -0.10544834$。\n\n四舍五入到四位有效数字，结果是 $-0.1054$。\n负值表示将命令向量从 $u_0$ 沿 $\\Delta u$ 方向移动会导致任务误差 $E$ 减小。从学习的角度来看，这是一个理想的变化。",
            "answer": "$$\\boxed{-0.1054}$$"
        },
        {
            "introduction": "尽管逆向模型功能强大，但它们也面临着固有的计算挑战。本练习探讨了其中最关键的问题之一：运动学奇异点，即逆向映射变得不稳定或无法明确定义的点。通过分析一个简单手臂模型的雅可比矩阵条件数，你将深刻理解为何某些姿势难以控制，以及如何用数学方法量化这种不稳定性 。",
            "id": "3992093",
            "problem": "考虑一个平面二自由度机械臂，其连杆长度为 $l_1$ 和 $l_2$，肩关节角度为 $\\theta_1$，肘关节角度为 $\\theta_2$。末端执行器的位置由正向运动学给出：$x(\\theta_1,\\theta_2) = l_1 \\cos(\\theta_1) + l_2 \\cos(\\theta_1 + \\theta_2)$ 和 $y(\\theta_1,\\theta_2) = l_1 \\sin(\\theta_1) + l_2 \\sin(\\theta_1 + \\theta_2)$。用于任务空间速度控制的逆模型使用雅可比矩阵 $J(\\theta_1,\\theta_2)$，它将关节速度 $\\dot{\\theta} = (\\dot{\\theta}_1,\\dot{\\theta}_2)$ 映射到末端执行器速度 $\\dot{\\mathbf{r}} = (\\dot{x},\\dot{y})$，通过 $\\dot{\\mathbf{r}} = J \\dot{\\theta}$，并使用伪逆 $J^+$ 求解 $\\dot{\\theta} = J^+ \\dot{\\mathbf{r}}$。此逆映射的数值稳定性取决于条件数 $\\kappa(J)$，其定义为 $J$ 的最大奇异值与最小奇异值之比。\n\n严格从给定的正向运动学以及雅可比矩阵、奇异值和条件数的标准定义出发，推导雅可比矩阵 $J$，计算 $J^{\\top}J$，并确定在肘部伸直构型 $\\theta_2 \\approx 0$ 附近的 $\\kappa(J)$。使用关于 $|\\theta_2|$ 的主阶渐近分析，获得 $\\kappa(J)$ 的一个闭式表达式，该表达式能够捕捉其在 $\\theta_2 \\to 0$ 时的发散行为，并且仅用 $l_1$、$l_2$ 和 $\\theta_2$ 表示。最后，基于此推导，解释 $\\kappa(J)$ 的行为如何影响逆运动学和运动控制逆模型在接近肘部伸直姿态时的数值稳定性。最终答案必须是 $\\kappa(J)$ 关于 $|\\theta_2|$ 的主阶渐近的单个解析表达式。不需要四舍五入，也不需要单位。",
            "solution": "该问题是适定的，并且科学上基于机器人运动学和线性代数的原理。我们可以开始推导。\n\n平面二自由度机械臂的正向运动学由末端执行器位置坐标 $(x, y)$ 作为关节角度 $(\\theta_1, \\theta_2)$ 的函数给出：\n$$x(\\theta_1, \\theta_2) = l_1 \\cos(\\theta_1) + l_2 \\cos(\\theta_1 + \\theta_2)$$\n$$y(\\theta_1, \\theta_2) = l_1 \\sin(\\theta_1) + l_2 \\sin(\\theta_1 + \\theta_2)$$\n其中 $l_1$ 和 $l_2$ 分别是第一和第二连杆的长度。\n\n首先，我们推导雅可比矩阵 $J$，它通过方程 $\\dot{\\mathbf{r}} = J \\dot{\\theta}$ 将关节速度 $\\dot{\\theta} = (\\dot{\\theta}_1, \\dot{\\theta}_2)^{\\top}$ 与末端执行器速度 $\\dot{\\mathbf{r}} = (\\dot{x}, \\dot{y})^{\\top}$ 联系起来。雅可比矩阵是位置向量关于关节角度的偏导数矩阵：\n$$J = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\theta_1}  \\frac{\\partial x}{\\partial \\theta_2} \\\\ \\frac{\\partial y}{\\partial \\theta_1}  \\frac{\\partial y}{\\partial \\theta_2} \\end{pmatrix}$$\n计算各个偏导数：\n$\\frac{\\partial x}{\\partial \\theta_1} = -l_1 \\sin(\\theta_1) - l_2 \\sin(\\theta_1 + \\theta_2)$\n$\\frac{\\partial x}{\\partial \\theta_2} = -l_2 \\sin(\\theta_1 + \\theta_2)$\n$\\frac{\\partial y}{\\partial \\theta_1} = l_1 \\cos(\\theta_1) + l_2 \\cos(\\theta_1 + \\theta_2)$\n$\\frac{\\partial y}{\\partial \\theta_2} = l_2 \\cos(\\theta_1 + \\theta_2)$\n\n因此，雅可比矩阵为：\n$$J = \\begin{pmatrix} -l_1 \\sin(\\theta_1) - l_2 \\sin(\\theta_1 + \\theta_2)  -l_2 \\sin(\\theta_1 + \\theta_2) \\\\ l_1 \\cos(\\theta_1) + l_2 \\cos(\\theta_1 + \\theta_2)  l_2 \\cos(\\theta_1 + \\theta_2) \\end{pmatrix}$$\n\n条件数 $\\kappa(J)$ 定义为 $J$ 的最大奇异值 $\\sigma_{\\text{max}}$ 与最小奇异值 $\\sigma_{\\text{min}}$ 之比。奇异值是矩阵 $J^{\\top}J$ 特征值的平方根。我们现在计算 $J^{\\top}J$。\n我们记 $s_1 = \\sin(\\theta_1)$，$c_1 = \\cos(\\theta_1)$，$s_{12} = \\sin(\\theta_1 + \\theta_2)$ 以及 $c_{12} = \\cos(\\theta_1 + \\theta_2)$。\n$J^{\\top}J = \\begin{pmatrix} -l_1 s_1 - l_2 s_{12}  l_1 c_1 + l_2 c_{12} \\\\ -l_2 s_{12}  l_2 c_{12} \\end{pmatrix} \\begin{pmatrix} -l_1 s_1 - l_2 s_{12}  -l_2 s_{12} \\\\ l_1 c_1 + l_2 c_{12}  l_2 c_{12} \\end{pmatrix}$\n\n$J^{\\top}J$ 的元素为：\n$(J^{\\top}J)_{11} = (-l_1 s_1 - l_2 s_{12})^2 + (l_1 c_1 + l_2 c_{12})^2 = l_1^2(s_1^2+c_1^2) + l_2^2(s_{12}^2+c_{12}^2) + 2l_1 l_2 (s_1 s_{12} + c_1 c_{12})$\n使用三角恒等式，可简化为：\n$(J^{\\top}J)_{11} = l_1^2 + l_2^2 + 2l_1 l_2 \\cos(\\theta_2)$\n\n$(J^{\\top}J)_{22} = (-l_2 s_{12})^2 + (l_2 c_{12})^2 = l_2^2 (s_{12}^2 + c_{12}^2) = l_2^2$\n\n$(J^{\\top}J)_{12} = (J^{\\top}J)_{21} = (-l_1 s_1 - l_2 s_{12})(-l_2 s_{12}) + (l_1 c_1 + l_2 c_{12})(l_2 c_{12})$\n$= l_1 l_2 s_1 s_{12} + l_2^2 s_{12}^2 + l_1 l_2 c_1 c_{12} + l_2^2 c_{12}^2 = l_1 l_2 (s_1 s_{12} + c_1 c_{12}) + l_2^2 (s_{12}^2+c_{12}^2)$\n$= l_1 l_2 \\cos(\\theta_2) + l_2^2$\n\n所以，该矩阵为：\n$$J^{\\top}J = \\begin{pmatrix} l_1^2 + l_2^2 + 2l_1 l_2 \\cos(\\theta_2)  l_2^2 + l_1 l_2 \\cos(\\theta_2) \\\\ l_2^2 + l_1 l_2 \\cos(\\theta_2)  l_2^2 \\end{pmatrix}$$\n\n奇异值的平方 $\\sigma^2$ 是 $J^{\\top}J$ 的特征值 $\\lambda$。它们是特征方程 $\\det(J^{\\top}J - \\lambda I) = 0$ 的根。特征值由 $\\lambda^2 - \\text{Tr}(J^{\\top}J)\\lambda + \\det(J^{\\top}J) = 0$ 给出。\n\n我们来计算 $J^{\\top}J$ 的迹和行列式：\n$\\text{Tr}(J^{\\top}J) = (l_1^2 + l_2^2 + 2l_1 l_2 \\cos(\\theta_2)) + l_2^2 = l_1^2 + 2l_2^2 + 2l_1 l_2 \\cos(\\theta_2)$\n$\\det(J^{\\top}J) = (l_1^2 + l_2^2 + 2l_1 l_2 \\cos(\\theta_2))(l_2^2) - (l_2^2 + l_1 l_2 \\cos(\\theta_2))^2$\n$= l_1^2 l_2^2 + l_2^4 + 2l_1 l_2^3 \\cos(\\theta_2) - (l_2^4 + 2l_1 l_2^3 \\cos(\\theta_2) + l_1^2 l_2^2 \\cos^2(\\theta_2))$\n$= l_1^2 l_2^2 - l_1^2 l_2^2 \\cos^2(\\theta_2) = l_1^2 l_2^2 (1 - \\cos^2(\\theta_2)) = l_1^2 l_2^2 \\sin^2(\\theta_2)$\n注意 $\\det(J^{\\top}J) = (\\det J)^2$，这与 $\\det J = l_1 l_2 \\sin(\\theta_2)$ 是一致的。\n\n我们关心的是在肘部伸直构型附近的行为，即当 $\\theta_2 \\approx 0$ 时。我们进行主阶渐近分析。对于小的 $\\theta_2$：\n$\\cos(\\theta_2) \\approx 1 - \\frac{\\theta_2^2}{2}$\n$\\sin(\\theta_2) \\approx \\theta_2$\n\n迹变为：\n$\\text{Tr}(J^{\\top}J) \\approx l_1^2 + 2l_2^2 + 2l_1 l_2 (1 - \\frac{\\theta_2^2}{2}) = (l_1^2 + 2l_2^2 + 2l_1 l_2) - l_1 l_2 \\theta_2^2$\n迹的主阶项是常数：\n$\\text{Tr}_0 = \\lim_{\\theta_2 \\to 0} \\text{Tr}(J^{\\top}J) = l_1^2 + 2l_1 l_2 + 2l_2^2 = (l_1+l_2)^2 + l_2^2$\n\n行列式变为：\n$\\det(J^{\\top}J) \\approx l_1^2 l_2^2 \\theta_2^2$\n\n特征值为 $\\lambda_{\\text{max,min}} = \\frac{1}{2}(\\text{Tr} \\pm \\sqrt{\\text{Tr}^2 - 4\\det})$。\n当 $\\det$ 很小时，我们可以近似特征值。较大的特征值约等于迹，较小的特征值约等于行列式除以迹。\n$\\lambda_{\\text{max}} = \\sigma_{\\text{max}}^2 \\approx \\text{Tr}(J^{\\top}J) \\approx \\text{Tr}_0 = l_1^2 + 2l_1 l_2 + 2l_2^2$\n$\\lambda_{\\text{min}} = \\sigma_{\\text{min}}^2 \\approx \\frac{\\det(J^{\\top}J)}{\\text{Tr}(J^{\\top}J)} \\approx \\frac{l_1^2 l_2^2 \\theta_2^2}{l_1^2 + 2l_1 l_2 + 2l_2^2}$\n\n条件数为 $\\kappa(J) = \\frac{\\sigma_{\\text{max}}}{\\sigma_{\\text{min}}} = \\sqrt{\\frac{\\lambda_{\\text{max}}}{\\lambda_{\\text{min}}}}$。\n使用我们的渐近表达式：\n$\\kappa(J)^2 \\approx \\frac{l_1^2 + 2l_1 l_2 + 2l_2^2}{\\frac{l_1^2 l_2^2 \\theta_2^2}{l_1^2 + 2l_1 l_2 + 2l_2^2}} = \\frac{(l_1^2 + 2l_1 l_2 + 2l_2^2)^2}{l_1^2 l_2^2 \\theta_2^2}$\n\n取平方根，并注意奇异值是非负的，我们得到条件数的主阶渐近表达式：\n$\\kappa(J) \\approx \\frac{l_1^2 + 2l_1 l_2 + 2l_2^2}{l_1 l_2 |\\theta_2|}$\n\n这个表达式揭示了当 $\\theta_2 \\to 0$ 时，条件数 $\\kappa(J)$ 以 $1/|\\theta_2|$ 的形式发散。这对数值稳定性和运动控制具有深远的影响。\n\n解释：\n1.  **奇异点附近的病态问题**：构型 $\\theta_2 = 0$ 是一个运动学奇异点，此时机械臂完全伸展。在此点，雅可比矩阵降秩，意味着末端执行器失去了向所有方向移动的能力。具体来说，它只能沿垂直于机械臂轴线的方向移动。我们的分析表明，当接近这个奇异点时，$\\kappa(J) \\to \\infty$，表明雅可比矩阵变得病态。\n\n2.  **误差放大**：在求解线性系统时，条件数限定了相对误差的放大量。对于逆速度问题 $\\dot{\\theta} = J^{+} \\dot{\\mathbf{r}}$，一个大的 $\\kappa(J)$ 意味着在期望的末端执行器速度 $\\dot{\\mathbf{r}}$ 中的小误差（可能来自传感器噪声、规划误差或数值浮点不精确性）会被放大为计算出的关节速度 $\\dot{\\theta}$ 中的巨大误差。这将导致不稳定和不规则的运动。\n\n3.  **不可行的关节速度**：大的 $\\kappa(J)$ 也意味着伪逆的范数 $\\|J^{+}\\|_2$ 很大。因此，为了在某些方向（特别是沿机械臂轴线的径向方向）上实现一个适度的末端执行器速度 $\\dot{\\mathbf{r}}$，所需的关节速度 $\\dot{\\theta}$ 会变得巨大，并可能超出生理或机械执行器的能力。控制信号在奇异点附近会“爆炸”。\n\n4.  **对运动控制逆模型的影响**：如果大脑的运动控制系统依赖于一个类似于 $J^{+}$ 的内部逆模型，那么在运动学奇异点处的这种固有不稳定性会构成一个重大的计算问题。$\\kappa(J)$ 的发散意味着简单的求逆对于控制通过或接近这些姿态的运动来说，不是一个可行的策略。这表明中枢神经系统必须采用更复杂的策略，例如：\n    -   在运动规划期间避免奇异姿态。\n    -   使用正则化技术（例如，阻尼最小二乘法，$J^{\\top}(JJ^{\\top} + \\lambda^2 I)^{-1}$），这种方法通过牺牲跟踪精度来换取解的稳定性，防止关节速度爆炸。\n    -   依赖于不同的控制范式，例如阻抗控制或正向模型，尤其是在奇异点附近。\n因此，$\\kappa(J)$ 的行为为理解为什么某些姿态难以控制，以及为什么神经控制策略必须对这类计算挑战具有鲁棒性，提供了形式化的数学基础。",
            "answer": "$$\n\\boxed{\\frac{l_1^2 + 2 l_1 l_2 + 2 l_2^2}{l_1 l_2 |\\theta_2|}}\n$$"
        },
        {
            "introduction": "现实世界中的运动并非在空无一物的空间中进行，而必须遵守物理边界和障碍物的限制。这最后一个练习将逆向问题提升到了约束优化的领域。你将应用正式的 Karush-Kuhn-Tucker (KKT) 条件，来寻找一个既能達成目标又能避开障碍物的最优运动指令，从而体会真实运动规划的复杂性 。",
            "id": "3992122",
            "problem": "一个长度为 $L$ 的平面单关节臂绕肩部在平面内旋转，产生一个末端执行器位置 $\\mathbf{x}(\\theta) = (x(\\theta), y(\\theta))$，其正向运动学由 $x(\\theta) = L \\cos(\\theta)$ 和 $y(\\theta) = L \\sin(\\theta)$ 给出。运动控制中的逆模型旨在寻找一个电机指令 $\\theta$，以达到期望的末端执行器目标 $\\mathbf{x}_{d} = (x_{d}, y_{d})$，同时避开工作空间中的障碍物。考虑成本函数\n$$\nJ(\\theta) = \\frac{1}{2}\\left[(x(\\theta) - x_{d})^{2} + (y(\\theta) - y_{d})^{2}\\right] + \\frac{\\lambda}{2}(\\theta - \\theta_{0})^{2},\n$$\n该函数编码了到达目标的准确性以及向一个标称电机指令 $\\theta_{0}$ 的正则化。工作空间在 $x_{w}$ 处有一个垂直的障碍物边界，可行区域要求末端执行器保持在该边界的右侧，这由不等式约束\n$$\nh(\\theta) = x_{w} - x(\\theta) \\le 0.\n$$\n表示。使用以下参数：$L = 0.5$ $\\mathrm{m}$，$(x_{d}, y_{d}) = (0.3, 0.4)$ $\\mathrm{m}$，$x_{w} = 0.35$ $\\mathrm{m}$，$\\lambda = 0.1$，以及 $\\theta_{0} = \\arctan2(y_{d}, x_{d})$。\n\n从正向运动学和约束优化的基本定义出发：\n\n- 建立约束逆运动学问题，该问题在满足 $h(\\theta) \\le 0$ 的条件下最小化 $J(\\theta)$。\n- 推导约束最小化器 $\\theta^{\\star}$ 的卡鲁什-库恩-塔克 (Karush–Kuhn–Tucker, KKT) 条件，引入一个非负的拉格朗日乘子 $\\mu$。\n- 对于给定的数值，确定障碍物约束在约束最优点处是否激活，并计算约束最优关节角 $\\theta^{\\star}$（以弧度为单位）。将最终数值答案四舍五入到四位有效数字。角度以弧度表示。",
            "solution": "用户要求解答一个在平面单关节臂运动控制背景下的约束优化问题。该过程包括建立问题、推导卡鲁什-库恩-塔克 (KKT) 条件，并使用所提供的数值参数求解最优关节角 $\\theta^{\\star}$。\n\n### 步骤 1：问题验证\n\n首先，对问题陈述进行验证。\n\n**1.1. 提取的已知条件**\n- **正向运动学**：末端执行器位置为 $\\mathbf{x}(\\theta) = (x(\\theta), y(\\theta))$，其中 $x(\\theta) = L \\cos(\\theta)$ 且 $y(\\theta) = L \\sin(\\theta)$。\n- **成本函数**：$J(\\theta) = \\frac{1}{2}\\left[(x(\\theta) - x_{d})^{2} + (y(\\theta) - y_{d})^{2}\\right] + \\frac{\\lambda}{2}(\\theta - \\theta_{0})^{2}$。\n- **不等式约束**：$h(\\theta) = x_{w} - x(\\theta) \\le 0$。\n- **参数**：\n    - 臂长：$L = 0.5$ $\\mathrm{m}$。\n    - 期望目标位置：$(x_{d}, y_{d}) = (0.3, 0.4)$ $\\mathrm{m}$。\n    - 障碍物边界：$x_{w} = 0.35$ $\\mathrm{m}$。\n    - 正则化权重：$\\lambda = 0.1$。\n    - 标称电机指令：$\\theta_{0} = \\arctan2(y_{d}, x_{d})$。\n\n**1.2. 验证**\n该问题具有科学依据，使用了机器人学和计算神经科学的标准模型。它被恰当地表述为一个标准的非线性规划问题，具有连续且可微的目标函数和约束。所有必要的数据都已提供且自洽。具体来说，到期望目标的距离是 $\\sqrt{x_d^2 + y_d^2} = \\sqrt{0.3^2 + 0.4^2} = \\sqrt{0.09 + 0.16} = \\sqrt{0.25} = 0.5$ $\\mathrm{m}$，这等于臂长 $L$。这证实了目标是可达的。问题陈述客观而精确。因此，该问题是有效的。\n\n### 步骤 2：建立与求解\n\n**2.1. 建立约束优化问题**\n问题在于找到电机指令 $\\theta$，使其在满足不等式约束 $h(\\theta) \\le 0$ 的同时，最小化成本函数 $J(\\theta)$。这可以表述为：\n$$\n\\underset{\\theta}{\\text{minimize}} \\quad J(\\theta) = \\frac{1}{2}\\left[(L \\cos(\\theta) - x_{d})^{2} + (L \\sin(\\theta) - y_{d})^{2}\\right] + \\frac{\\lambda}{2}(\\theta - \\theta_{0})^{2}\n$$\n$$\n\\text{subject to} \\quad h(\\theta) = x_{w} - L \\cos(\\theta) \\le 0\n$$\n\n**2.2. 推导卡鲁什-库恩-塔克 (KKT) 条件**\n对于这种形式的约束优化问题，如果存在一个拉格朗日乘子 $\\mu$ 使得 KKT 条件得到满足，那么点 $\\theta^{\\star}$ 就是一个最优点。拉格朗日函数是：\n$$\n\\mathcal{L}(\\theta, \\mu) = J(\\theta) + \\mu h(\\theta)\n$$\nKKT 条件是：\n1.  **平稳性 (Stationarity)**：拉格朗日函数关于 $\\theta$ 的梯度在最优点 $\\theta^{\\star}$ 处必须为零：$\\frac{d\\mathcal{L}}{d\\theta}|_{\\theta=\\theta^{\\star}} = 0$。\n2.  **原始可行性 (Primal Feasibility)**：解必须满足约束条件：$h(\\theta^{\\star}) \\le 0$。\n3.  **对偶可行性 (Dual Feasibility)**：拉格朗日乘子必须是非负的：$\\mu \\ge 0$。\n4.  **互补松弛性 (Complementary Slackness)**：乘子与约束函数的乘积必须为零：$\\mu h(\\theta^{\\star}) = 0$。\n\n为了应用平稳性条件，我们计算 $J(\\theta)$ 和 $h(\\theta)$ 的导数：\n$$\n\\frac{dJ}{d\\theta} = (x(\\theta) - x_{d}) \\frac{dx}{d\\theta} + (y(\\theta) - y_{d}) \\frac{dy}{d\\theta} + \\lambda(\\theta - \\theta_{0})\n$$\n当 $\\frac{dx}{d\\theta} = -L \\sin(\\theta)$ 且 $\\frac{dy}{d\\theta} = L \\cos(\\theta)$ 时，我们得到：\n$$\n\\frac{dJ}{d\\theta} = (L \\cos(\\theta) - x_{d})(-L \\sin(\\theta)) + (L \\sin(\\theta) - y_{d})(L \\cos(\\theta)) + \\lambda(\\theta - \\theta_{0})\n$$\n$$\n\\frac{dJ}{d\\theta} = -L^2\\cos(\\theta)\\sin(\\theta) + x_{d} L \\sin(\\theta) + L^2\\sin(\\theta)\\cos(\\theta) - y_{d} L \\cos(\\theta) + \\lambda(\\theta - \\theta_{0})\n$$\n$$\n\\frac{dJ}{d\\theta} = x_{d} L \\sin(\\theta) - y_{d} L \\cos(\\theta) + \\lambda(\\theta - \\theta_{0})\n$$\n约束函数的导数是：\n$$\n\\frac{dh}{d\\theta} = \\frac{d}{d\\theta}(x_{w} - L \\cos(\\theta)) = L \\sin(\\theta)\n$$\n因此，平稳性条件 $\\frac{dJ}{d\\theta} + \\mu \\frac{dh}{d\\theta} = 0$ 为：\n$$\nx_{d} L \\sin(\\theta^{\\star}) - y_{d} L \\cos(\\theta^{\\star}) + \\lambda(\\theta^{\\star} - \\theta_{0}) + \\mu L \\sin(\\theta^{\\star}) = 0\n$$\n\n**2.3. 约束分析与 $\\theta^{\\star}$ 的计算**\n首先，我们分析约束是否是激活的。我们考虑 $J(\\theta)$ 的无约束最小化器，它出现在 $\\frac{dJ}{d\\theta} = 0$ 的地方。标称角是 $\\theta_{0} = \\arctan2(y_d, x_d)$。如前所示，期望目标 $(x_d, y_d)$ 位于半径为 $L$ 的圆上，因此我们可以写成 $x_d = L\\cos(\\theta_0)$ 和 $y_d = L\\sin(\\theta_0)$。将这些代入 $\\frac{dJ}{d\\theta}$ 的表达式中：\n$$\n(L \\cos\\theta_0) L \\sin\\theta - (L \\sin\\theta_0) L \\cos\\theta + \\lambda(\\theta - \\theta_0) = 0\n$$\n$$\nL^2(\\sin\\theta \\cos\\theta_0 - \\cos\\theta \\sin\\theta_0) + \\lambda(\\theta - \\theta_0) = 0\n$$\n$$\nL^2 \\sin(\\theta - \\theta_0) + \\lambda(\\theta - \\theta_0) = 0\n$$\n该方程的一个明显解是 $\\theta - \\theta_0 = 0$，这意味着无约束最小值在 $\\theta_{unc} = \\theta_0$ 处。\n现在，我们必须通过在 $\\theta_0$ 处评估约束函数 $h(\\theta)$ 来检查这个无约束解是否可行：\n$$\nh(\\theta_0) = x_w - x(\\theta_0) = x_w - L\\cos(\\theta_0) = x_w - x_d\n$$\n使用给定的值，$x_w = 0.35$ 和 $x_d = 0.3$：\n$$\nh(\\theta_0) = 0.35 - 0.3 = 0.05\n$$\n由于 $h(\\theta_0) = 0.05 > 0$，原始可行性条件 $h(\\theta) \\le 0$ 被违反。无约束最优点位于禁止区域内。\n因此，约束最优点 $\\theta^{\\star}$ 必须位于可行区域的边界上。这意味着障碍物约束在最优点处是**激活的**。\n\n根据互补松弛性条件 $\\mu h(\\theta^{\\star})=0$ 以及我们已经确定 $h(\\theta^{\\star}) \\ne 0$ 是不可行的，我们必须有 $\\mu > 0$ 和 $h(\\theta^{\\star})=0$。\n激活的约束条件是：\n$$\nh(\\theta^{\\star}) = x_w - L \\cos(\\theta^{\\star}) = 0\n$$\n$$\n\\cos(\\theta^{\\star}) = \\frac{x_w}{L} = \\frac{0.35}{0.5} = 0.7\n$$\n该方程在主值范围 $(-\\pi, \\pi]$ 内产生两个可能的解 $\\theta^{\\star}$：$\\theta^{\\star} = \\arccos(0.7)$ 和 $\\theta^{\\star} = -\\arccos(0.7)$。为了确定哪一个是真正的最小化器，我们可以检查哪一个满足所有的 KKT 条件，特别是 $\\mu \\ge 0$。\n从平稳性条件，我们求解 $\\mu$：\n$$\n\\mu = - \\frac{x_{d} L \\sin(\\theta^{\\star}) - y_{d} L \\cos(\\theta^{\\star}) + \\lambda(\\theta^{\\star} - \\theta_{0})}{L \\sin(\\theta^{\\star})}\n$$\n我们需要计算 $\\theta_0$：\n$$\n\\theta_0 = \\arctan2(0.4, 0.3) = \\arccos\\left(\\frac{0.3}{\\sqrt{0.3^2+0.4^2}}\\right) = \\arccos(0.6) \\approx 0.9273 \\text{ rad}\n$$\n现在我们测试 $\\theta^{\\star}$ 的两个候选解：\n\n**候选解 1：$\\theta^{\\star} = \\arccos(0.7) \\approx 0.7954$ rad**\n这里，$\\sin(\\theta^{\\star}) = \\sqrt{1 - 0.7^2} = \\sqrt{0.51} > 0$。分母 $L \\sin(\\theta^{\\star})$ 为正。\n我们计算分子：\n$x_{d} L \\sin(\\theta^{\\star}) - y_{d} L \\cos(\\theta^{\\star}) = 0.3 \\times 0.5 \\times \\sqrt{0.51} - 0.4 \\times 0.5 \\times 0.7 = 0.15\\sqrt{0.51} - 0.14 \\approx 0.1071 - 0.14 = -0.0329$。\n$\\lambda(\\theta^{\\star} - \\theta_0) = 0.1(\\arccos(0.7) - \\arccos(0.6)) \\approx 0.1(0.7954 - 0.9273) = -0.01319$。\n分子约等于 $-0.0329 - 0.01319 = -0.04609$，为负值。\n那么 $\\mu = - \\frac{\\text{负值}}{\\text{正值}} > 0$。此解与所有 KKT 条件一致。\n\n**候选解 2：$\\theta^{\\star} = -\\arccos(0.7) \\approx -0.7954$ rad**\n这里，$\\sin(\\theta^{\\star}) = -\\sqrt{1 - 0.7^2} = -\\sqrt{0.51}  0$。分母 $L \\sin(\\theta^{\\star})$ 为负。\n分子的第一部分变为：$x_{d} L \\sin(\\theta^{\\star}) - y_{d} L \\cos(\\theta^{\\star}) = 0.15(-\\sqrt{0.51}) - 0.14 \\approx -0.1071 - 0.14 = -0.2471$。\n分子的第二部分是：$\\lambda(\\theta^{\\star} - \\theta_0) = 0.1(-\\arccos(0.7) - \\arccos(0.6)) \\approx 0.1(-0.7954 - 0.9273) = -0.1723$。\n分子约等于 $-0.2471 - 0.1723 = -0.4194$，为负值。\n那么 $\\mu = - \\frac{\\text{负值}}{\\text{负值}}  0$。这违反了对偶可行性条件 $\\mu \\ge 0$。\n\n唯一满足 KKT 条件的解是 $\\theta^{\\star} = \\arccos(0.7)$。\n\n**最终计算**\n约束最优关节角为 $\\theta^{\\star} = \\arccos(0.7)$。\n数值上，$\\theta^{\\star} \\approx 0.795398...$ 弧度。\n四舍五入到四位有效数字，我们得到 $\\theta^{\\star} = 0.7954$ 弧度。\n总结：该问题是有效的。我们将其建立为一个约束优化问题并推导了 KKT 条件。通过证明无约束最优点是不可行的，我们确定了障碍物约束在最优点处是激活的。通过求解约束边界上的角度并检查 KKT 条件，得出了唯一的解。",
            "answer": "$$\n\\boxed{0.7954}\n$$"
        }
    ]
}