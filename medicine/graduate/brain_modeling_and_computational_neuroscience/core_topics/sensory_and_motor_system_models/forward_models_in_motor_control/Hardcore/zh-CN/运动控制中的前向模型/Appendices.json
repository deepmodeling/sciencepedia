{
    "hands_on_practices": [
        {
            "introduction": "本章的第一个练习将前向模型分解为其最简单的形式。我们将为一个单关节构建一个单步预测器，重点关注当前状态（角度和角速度）如何决定预测的下一状态。这个练习通过一个简单的离散时间动态模型，阐明了状态空间预测的基本机制，并揭示了模型选择（例如，欧拉积分法）对预测结果的具体影响。",
            "id": "3982443",
            "problem": "单个人类肘关节可以理想化为一个单自由度旋转被控对象，其运动学遵循对连续时间关系的离散时间前向欧拉积分。考虑一个由中枢神经系统（CNS）部署的最小内部前馈模型，该模型使用所指令的类力矩信号的传出副本（EC）来提前一个采样步长预测动作的直接感觉后果（关节角度）。该被控对象由一个包含关节角度和角速度的状态来建模，其离散时间动力学由 $x_{t+1}=x_{t}+\\Delta t\\,\\omega_{t}$ 和 $\\omega_{t+1}=\\omega_{t}+\\Delta t\\,\\alpha\\,u_{t}$ 给出，其中 $x_{t}$ 是时间步 $t$ 的关节角度，$\\omega_{t}$ 是时间步 $t$ 的角速度，$\\Delta t$ 是采样间隔，$\\alpha$ 是一个已知的正增益，它将运动指令映射到角加速度，而 $u_{t}$ 是时间 $t$ 的运动指令。假设无噪声的感觉测量就是角度本身，因此时间 $t$ 的感觉后果是 $s_{t}=x_{t}$。构建一个最小前馈模型，该模型使用当前状态 $(x_{t},\\omega_{t})$ 和运动指令 $u_{t}$ 的传出副本，向前推进一步以预测下一个时间步的角度测量值 $\\hat{s}_{t+1}$。从第一性原理和运动控制中状态空间前馈模型的核心定义出发，推导预测的感觉角度 $\\hat{s}_{t+1}$ 的闭式解析表达式，该表达式用 $x_{t}$、$\\omega_{t}$、$\\Delta t$、$\\alpha$ 和 $u_{t}$ 表示。将最终答案表示为单个解析表达式。无需四舍五入。",
            "solution": "问题陈述已经过严格验证，并被认为是科学基础扎实、适定、客观且内部一致的。它提出了一个标准的、尽管简化的单关节系统状态空间模型，并要求基于明确定义的动力学进行一步预测。所有必要的数据和定义都已提供。因此，该问题是有效的。\n\n核心任务是推导下一个时间步的预测感觉角度 $\\hat{s}_{t+1}$ 的表达式。在运动控制的背景下，前馈模型是一个内部神经过程，它模拟运动系统（“被控对象”）的动力学，以预测运动指令的感觉后果。它将被控对象的当前估计状态和运动指令的传出副本作为输入，并输出下一个感觉状态的预测。\n\n问题将系统在离散时间步 $t$ 的状态定义为关节角度 $x_t$ 和角速度 $\\omega_t$。运动指令为 $u_t$。时间 $t$ 的感觉测量是角度本身，所以 $s_t = x_t$。因此，在时间 $t+1$ 的预测感觉角度，记为 $\\hat{s}_{t+1}$，等同于在时间 $t+1$ 的预测关节角度，我们将其记为 $\\hat{x}_{t+1}$。\n\n问题明确给出了被控对象的离散时间动力学，它们是使用前向欧拉积分方案建模的。这些动力学构成了中枢神经系统（CNS）用于其预测的“内部模型”。方程如下：\n$$x_{t+1} = x_{t} + \\Delta t\\,\\omega_{t}$$\n$$\\omega_{t+1} = \\omega_{t} + \\Delta t\\,\\alpha\\,u_{t}$$\n其中，$\\Delta t$ 是采样间隔，$\\alpha$ 是一个增益参数。\n\n前馈模型的功能是基于在时间 $t$ 的已知状态 $(x_t, \\omega_t)$ 和在时间 $t$ 的已知运动指令 $u_t$，计算在时间 $t+1$ 的预测状态 $(\\hat{x}_{t+1}, \\hat{\\omega}_{t+1})$。这是通过将系统的动力学方程在时间上向前应用一步来实现的。\n\n为了找到预测角度 $\\hat{x}_{t+1}$，我们必须应用第一个动力学方程。这个方程定义了角度如何从一个时间步演化到下一个时间步：\n$$\\hat{x}_{t+1} = x_{t} + \\Delta t\\,\\omega_{t}$$\n下一个角度的预测值 $\\hat{x}_{t+1}$ 是使用当前角度 $x_t$ 和当前角速度 $\\omega_t$ 计算的。\n\n第二个动力学方程描述了角速度的演化：\n$$\\hat{\\omega}_{t+1} = \\omega_{t} + \\Delta t\\,\\alpha\\,u_{t}$$\n模型的这一部分使用当前速度 $\\omega_t$ 和运动指令 $u_t$ 来预测下一个时间步的速度 $\\hat{\\omega}_{t+1}$。\n\n问题要求的是预测的感觉角度 $\\hat{s}_{t+1}$，也就是 $\\hat{x}_{t+1}$。根据提供的第一个动力学方程，可以直接得到 $\\hat{x}_{t+1}$ 的表达式。\n$$\\hat{s}_{t+1} = \\hat{x}_{t+1} = x_{t} + \\Delta t\\,\\omega_{t}$$\n重要的是要注意，根据所提供的特定离散时间动力学（显式前向欧拉法），下一个时间步的角度预测值 $\\hat{x}_{t+1}$ 仅取决于当前的状态变量 $x_t$ 和 $\\omega_t$。运动指令 $u_t$ 和增益 $\\alpha$ 会影响下一个时间步的预测角*速度* $\\hat{\\omega}_{t+1}$，但它们不会出现在下一个时间步的预测*角度*的表达式中。推导必须严格遵守所指定的模型。尽管其他数值积分方案（例如，半隐式欧拉法）可能会导致位置更新依赖于 $u_t$，但问题陈述在动力学定义上是明确的。提示中提供的变量列表（$x_{t}$、$\\omega_{t}$、$\\Delta t$、$\\alpha$ 和 $u_{t}$）代表了系统可用的完整参数集，而不是要求所有参数都必须出现在这个特定预测的最终表达式中。\n\n因此，预测的感觉角度 $\\hat{s}_{t+1}$ 的闭式解析表达式是直接从所提供的角度 $x$ 的状态更新方程推导出来的。",
            "answer": "$$\\boxed{x_{t} + \\Delta t \\, \\omega_{t}}$$"
        },
        {
            "introduction": "一个关键的假设是大脑利用前向模型来“净化”嘈杂的感觉信号。这个练习从纯粹的预测转向最优估计，演示了如何将前向模型的预测与嘈杂的本体感觉测量相结合。通过推导并计算最优权重，我们将看到大脑如何根据每个信息源的可靠性（方差的倒数）进行加权，从而获得比任何单一信息源都更精确的状态估计。",
            "id": "3982407",
            "problem": "在运动控制的背景下，中枢神经系统（CNS）将感觉结果的前馈模型预测与实际的本体感觉测量值相结合，以估计真实的关节角度。考虑在时间 $t$ 的单个关节角度，用标量随机变量 $x_t$ 表示，单位为弧度。本体感觉测量值建模为 $y_t = x_t + \\varepsilon_t$，其中 $\\varepsilon_t$ 是方差为 $R$ 的零均值高斯噪声；前馈模型预测的感觉结果建模为 $\\hat{y}_t = x_t + \\eta_t$，其中 $\\eta_t$ 是方差为 $P$ 的零均值高斯噪声。假设 $\\varepsilon_t$ 和 $\\eta_t$ 相互独立且与 $x_t$ 独立，并且两个测量通道都是无偏的。\n\n仅使用在加性独立高斯噪声下的无偏线性估计的基本原理和均方误差的定义，推导通过融合 $y_t$ 和 $\\hat{y}_t$ 来最小化估计 $x_t$ 时期望平方误差的估计器。然后，使用参数 $R = 0.01$ 和 $P = 0.005$ 计算可实现的最小均方误差（在最优情况下，该值等于估计误差的方差）。\n\n以平方弧度（rad$^2$）表示最终的最小均方误差，并将您的答案四舍五入到四位有效数字。角度单位为弧度。",
            "solution": "该问题的陈述具有科学依据、良定、客观且完整。它提出了最优估计理论中的一个经典问题，具体来说是融合对单一潜在状态的两个带噪声的测量。所有必要的组成部分——测量的模型、噪声的统计特性、独立性假设以及目标函数（最小化均方误差）——都已提供且相互一致。因此，可以推导出有效的解。\n\n目标是通过线性组合本体感觉测量值 $y_t$ 和前馈模型预测值 $\\hat{y}_t$ 来找到真实关节角度 $x_t$ 的最优估计。设融合后的估计值为 $\\hat{x}_t$。由于我们寻求一个线性估计器，它可以写成两个可用信号的加权和：\n$$\n\\hat{x}_t = w_1 y_t + w_2 \\hat{y}_t\n$$\n其中 $w_1$ 和 $w_2$ 是待确定的权重。\n\n问题要求估计器是无偏的。如果估计误差的期望为零，则估计器是无偏的，这意味着估计的期望值等于被估计的真实量的期望值。\n$$\nE[\\hat{x}_t] = E[x_t]\n$$\n让我们计算线性估计器的期望：\n$$\nE[\\hat{x}_t] = E[w_1 y_t + w_2 \\hat{y}_t] = w_1 E[y_t] + w_2 E[\\hat{y}_t]\n$$\n问题陈述 $y_t = x_t + \\varepsilon_t$ 和 $\\hat{y}_t = x_t + \\eta_t$。噪声项 $\\varepsilon_t$ 和 $\\eta_t$ 均为零均值，即 $E[\\varepsilon_t] = 0$ 和 $E[\\eta_t] = 0$。因此，测量的期望值为：\n$$\nE[y_t] = E[x_t + \\varepsilon_t] = E[x_t] + E[\\varepsilon_t] = E[x_t]\n$$\n$$\nE[\\hat{y}_t] = E[x_t + \\eta_t] = E[x_t] + E[\\eta_t] = E[x_t]\n$$\n将这些代回 $E[\\hat{x}_t]$ 的表达式中：\n$$\nE[\\hat{x}_t] = w_1 E[x_t] + w_2 E[x_t] = (w_1 + w_2) E[x_t]\n$$\n为了使无偏性条件 $E[\\hat{x}_t] = E[x_t]$ 对 $x_t$ 的任何可能分布都成立，权重之和必须为1：\n$$\nw_1 + w_2 = 1\n$$\n这个约束使我们可以用一个未知权重（比如 $w = w_1$）来表示估计器，因此 $w_2 = 1 - w$：\n$$\n\\hat{x}_t = w y_t + (1 - w) \\hat{y}_t\n$$\n下一步是最小化均方误差（MSE），定义为 $\\text{MSE} = E[(\\hat{x}_t - x_t)^2]$。我们首先用噪声源来表示估计误差 $e_t = \\hat{x}_t - x_t$：\n$$\ne_t = \\left(w y_t + (1 - w) \\hat{y}_t\\right) - x_t\n$$\n代入 $y_t = x_t + \\varepsilon_t$ 和 $\\hat{y}_t = x_t + \\eta_t$：\n$$\ne_t = w(x_t + \\varepsilon_t) + (1 - w)(x_t + \\eta_t) - x_t\n$$\n$$\ne_t = w x_t + w \\varepsilon_t + x_t - w x_t + \\eta_t - w \\eta_t - x_t\n$$\n$$\ne_t = w \\varepsilon_t + (1 - w) \\eta_t\n$$\n注意，误差的期望是 $E[e_t] = w E[\\varepsilon_t] + (1-w)E[\\eta_t] = w(0) + (1-w)(0) = 0$，这证实了估计器是无偏的。MSE 是该误差平方的期望，由于误差均值为零，这等价于误差的方差。\n$$\n\\text{MSE} = E[e_t^2] = E\\left[(w \\varepsilon_t + (1 - w) \\eta_t)^2\\right]\n$$\n$$\n\\text{MSE} = E\\left[w^2 \\varepsilon_t^2 + (1 - w)^2 \\eta_t^2 + 2w(1 - w)\\varepsilon_t \\eta_t\\right]\n$$\n根据期望的线性性质：\n$$\n\\text{MSE} = w^2 E[\\varepsilon_t^2] + (1 - w)^2 E[\\eta_t^2] + 2w(1 - w)E[\\varepsilon_t \\eta_t]\n$$\n问题指定噪声方差为 $\\text{Var}(\\varepsilon_t) = E[\\varepsilon_t^2] - (E[\\varepsilon_t])^2 = E[\\varepsilon_t^2] = R$ 和 $\\text{Var}(\\eta_t) = E[\\eta_t^2] - (E[\\eta_t])^2 = E[\\eta_t^2] = P$。它还声明 $\\varepsilon_t$ 和 $\\eta_t$ 是相互独立的。因此，它们乘积的期望等于它们各自期望的乘积：$E[\\varepsilon_t \\eta_t] = E[\\varepsilon_t] E[\\eta_t] = 0 \\cdot 0 = 0$。\n将这些代入MSE表达式，得到MSE作为权重 $w$ 的函数：\n$$\n\\text{MSE}(w) = w^2 R + (1 - w)^2 P\n$$\n为了找到最小化MSE的权重 $w$，我们对 $\\text{MSE}(w)$ 关于 $w$ 求导，并将结果设为零：\n$$\n\\frac{d}{dw}\\text{MSE}(w) = \\frac{d}{dw}\\left[w^2 R + (1 - w)^2 P\\right] = 2wR + 2(1 - w)(-1)P = 2wR - 2P + 2wP\n$$\n将导数设为零：\n$$\n2wR - 2P + 2wP = 0\n$$\n$$\nw(R+P) = P\n$$\n因此，最优权重 $w^*$ 为：\n$$\nw^* = w_1^* = \\frac{P}{R+P}\n$$\n第二个测量对应的最优权重为 $w_2^* = 1 - w^* = 1 - \\frac{P}{R+P} = \\frac{R}{R+P}$。为了确认这是一个最小值，二阶导数 $\\frac{d^2}{dw^2}\\text{MSE}(w) = 2R + 2P$ 是正的，因为方差 $R$ 和 $P$ 都是正的。\n\n最后，我们通过将最优权重 $w^*$ 代回MSE公式来计算可实现的最小MSE，$\\text{MSE}_{\\min}$：\n$$\n\\text{MSE}_{\\min} = (w^*)^2 R + (1 - w^*)^2 P\n$$\n$$\n\\text{MSE}_{\\min} = \\left(\\frac{P}{R+P}\\right)^2 R + \\left(\\frac{R}{R+P}\\right)^2 P\n$$\n$$\n\\text{MSE}_{\\min} = \\frac{P^2 R}{(R+P)^2} + \\frac{R^2 P}{(R+P)^2} = \\frac{P^2 R + R^2 P}{(R+P)^2}\n$$\n从分子中提出公因式 $RP$：\n$$\n\\text{MSE}_{\\min} = \\frac{RP(P+R)}{(R+P)^2} = \\frac{RP}{R+P}\n$$\n这个简洁的结果表明，最小MSE的倒数（融合后的精度）是各个方差倒数（各个精度）之和：$\\frac{1}{\\text{MSE}_{\\min}} = \\frac{1}{P} + \\frac{1}{R}$。\n\n现在，我们代入给定的数值，$R = 0.01 \\, \\text{rad}^2$ 和 $P = 0.005 \\, \\text{rad}^2$：\n$$\n\\text{MSE}_{\\min} = \\frac{(0.01)(0.005)}{0.01 + 0.005} = \\frac{0.00005}{0.015}\n$$\n$$\n\\text{MSE}_{\\min} = \\frac{5 \\times 10^{-5}}{1.5 \\times 10^{-2}} = \\frac{5}{1.5} \\times 10^{-3} = \\frac{10}{3} \\times 10^{-3} = \\frac{1}{300}\n$$\n换算成小数，这是 $0.003333...$ $\\text{rad}^2$。问题要求四舍五入到四位有效数字。前四位有效数字是 $3$、$3$、$3$ 和 $3$。第五位数字是 $3$，小于 $5$，因此不进位。\n最小均方误差为 $0.003333 \\, \\text{rad}^2$。",
            "answer": "$$\\boxed{0.003333}$$"
        },
        {
            "introduction": "真实的生物系统很少是线性的。最后一个练习直面这种复杂性，为一个包含非线性动力学和感觉转换的更真实的肢体建模。我们将应用扩展卡尔曼滤波器（EKF）这一强大工具，推导其在每个时间步进行线性化所需的雅可比矩阵，从而将前向模型的概念从简单的线性系统推广到实际的非线性生物力学应用中。",
            "id": "3982422",
            "problem": "考虑一个单自由度的肘状肢体，其内部前向模型可以预测状态演化和感官后果。设状态为 $x_t = \\begin{pmatrix} q_t \\\\ \\omega_t \\end{pmatrix}$，其中 $q_t$ 是关节角度，$\\omega_t$ 是关节角速度。控制输入 $u_t$ 是一个神经指令，通过一个饱和非线性映射到肌肉扭矩。离散时间前向动力学由下式给出\n$$\nx_{t+1} = f(x_t,u_t) + w_t,\n$$\n其中\n$$\nf(x_t,u_t) \\equiv\n\\begin{pmatrix}\nq_t \\\\\n\\omega_t\n\\end{pmatrix}\n+\n\\Delta t\\,\n\\begin{pmatrix}\n\\omega_t \\\\\n\\frac{1}{I}\\big(\\beta\\,\\tanh(u_t) - b\\,\\omega_t - \\kappa\\,\\sin(q_t)\\big)\n\\end{pmatrix},\n$$\n其中 $I0$ 是肢体惯量，$b0$ 是粘性阻尼，$\\kappa0$ 是与重力相关的刚度（例如，对于质量 $m$、重力加速度 $g$ 和杠杆臂 $L$，有 $\\kappa = m g L$），$\\beta0$ 缩放控制到扭矩的映射，$\\Delta t0$ 是采样间隔。过程噪声 $w_t$ 是零均值高斯噪声，其协方差为 $Q_t$，记作 $w_t \\sim \\mathcal{N}(0,Q_t)$。感官测量为\n$$\ny_t = h(x_t) + v_t,\n$$\n其中\n$$\nh(x_t) \\equiv\n\\begin{pmatrix}\nq_t \\\\\n\\arctan(\\omega_t)\n\\end{pmatrix},\n$$\n测量噪声为 $v_t \\sim \\mathcal{N}(0,R_t)$。\n\n从非线性状态空间贝叶斯滤波的定义和扩展卡尔曼滤波器（EKF；Extended Kalman Filter）所基于的线性化原理出发，使用 $f$ 和 $h$ 在当前工作点的一阶泰勒展开，推导用于状态均值和协方差的EKF预测和更新方程。然后，对于上述特定模型，显式计算预测和更新步骤所需的雅可比矩阵 $\\frac{\\partial f}{\\partial x}$、$\\frac{\\partial f}{\\partial u}$ 和 $\\frac{\\partial h}{\\partial x}$，并在一般状态 $x_t = \\begin{pmatrix} q_t \\\\ \\omega_t \\end{pmatrix}$ 和输入 $u_t$ 处进行求值。\n\n答案规格：以单个分块行矩阵 $[A_t\\;\\;B_t\\;\\;H_t]$ 的形式提供最终答案，其中 $A_t \\in \\mathbb{R}^{2\\times 2}$，$B_t \\in \\mathbb{R}^{2\\times 1}$，$H_t \\in \\mathbb{R}^{2\\times 2}$。以符号形式表达最终答案（无需数值代入），且不包含任何单位。无需四舍五入。",
            "solution": "首先对用户提供的问题进行验证过程。\n\n### 步骤 1：提取已知条件\n- 状态向量：$x_t = \\begin{pmatrix} q_t \\\\ \\omega_t \\end{pmatrix}$，其中 $q_t$ 是关节角度，$\\omega_t$ 是关节角速度。\n- 控制输入：$u_t$。\n- 离散时间动力学模型：$x_{t+1} = f(x_t,u_t) + w_t$。\n- 动力学函数：$f(x_t,u_t) \\equiv \\begin{pmatrix} q_t \\\\ \\omega_t \\end{pmatrix} + \\Delta t\\, \\begin{pmatrix} \\omega_t \\\\ \\frac{1}{I}\\big(\\beta\\,\\tanh(u_t) - b\\,\\omega_t - \\kappa\\,\\sin(q_t)\\big) \\end{pmatrix}$。\n- 模型参数：$I0$, $b0$, $\\kappa0$, $\\beta0$, $\\Delta t0$。\n- 过程噪声：$w_t \\sim \\mathcal{N}(0,Q_t)$。\n- 感官测量模型：$y_t = h(x_t) + v_t$。\n- 测量函数：$h(x_t) \\equiv \\begin{pmatrix} q_t \\\\ \\arctan(\\omega_t) \\end{pmatrix}$。\n- 测量噪声：$v_t \\sim \\mathcal{N}(0,R_t)$。\n- 任务：推导通用的扩展卡尔曼滤波器（EKF）预测和更新方程。然后，为给定模型计算雅可比矩阵 $\\frac{\\partial f}{\\partial x}$、$\\frac{\\partial f}{\\partial u}$ 和 $\\frac{\\partial h}{\\partial x}$，并在一般状态 $x_t$ 和输入 $u_t$ 处进行求值。\n- 最终答案规格：以分块行矩阵 $[A_t \\;\\; B_t \\;\\; H_t]$ 的形式提供结果，其中 $A_t = \\frac{\\partial f}{\\partial x}$，$B_t = \\frac{\\partial f}{\\partial u}$，$H_t = \\frac{\\partial h}{\\partial x}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **科学依据**：该问题描述了一个物理上合理的生物力学系统（一个在重力、粘性阻尼和受控扭矩作用下的单关节肢体），使用了标准的状态空间表示法。非线性项（$\\sin$、$\\tanh$、$\\arctan$）在此类模型中是常见且有意义的。使用EKF对此系统进行状态估计是计算神经科学和控制工程中的一个典型问题。该公式在科学上是合理的。\n- **良态的**：问题定义清晰，提供了所有必要的方程和参数。它要求进行一组特定的推导（通用EKF方程）和计算（特定的雅可比矩阵），这些问题存在唯一且稳定的数学解。\n- **客观的**：问题以精确、客观的数学语言陈述，没有任何歧义或主观内容。\n\n未发现任何缺陷。问题是自洽的、一致的且科学有效的。\n\n### 步骤 3：结论与行动\n问题被视为有效。将提供完整解答。\n\n### 解题推导\n\n扩展卡尔曼滤波器（EKF）是一种用于非线性动力系统中状态估计的算法。它在每个时间步围绕当前状态估计对系统动力学和测量模型进行线性化，以传播状态概率分布的均值和协方差。设在时间 $t$ 给出截至时间 $t$ 的测量值时的状态估计及其协方差分别表示为 $\\hat{x}_{t|t}$ 和 $P_{t|t}$。EKF在两个步骤中运行：预测和更新。\n\n**1. 预测步骤**\n给定时间 $t$ 的估计 $\\hat{x}_{t|t}$ 和协方差 $P_{t|t}$，目标是预测时间 $t+1$ 的状态和协方差。\n预测的状态均值 $\\hat{x}_{t+1|t}$ 是通过将先前的估计通过非线性动力学函数 $f$ 传播得到的：\n$$\n\\hat{x}_{t+1|t} = f(\\hat{x}_{t|t}, u_t)\n$$\n预测的状态协方差 $P_{t+1|t}$ 是通过围绕 $\\hat{x}_{t|t}$ 和 $u_t$ 线性化动力学得到的。线性化的动力学由雅可比矩阵 $A_t = \\frac{\\partial f}{\\partial x}\\big|_{\\hat{x}_{t|t}, u_t}$ 确定。然后协方差如下传播，并加上协方差为 $Q_t$ 的过程噪声：\n$$\nP_{t+1|t} = A_t P_{t|t} A_t^T + Q_t\n$$\n\n**2. 更新步骤**\n当在时间 $t+1$ 获得新的测量值 $y_{t+1}$ 时，预测的状态 $\\hat{x}_{t+1|t}$ 和协方差 $P_{t+1|t}$ 将被更新。\n首先，测量模型在预测状态 $\\hat{x}_{t+1|t}$ 周围被线性化。相关的雅可比矩阵是 $H_{t+1} = \\frac{\\partial h}{\\partial x}\\big|_{\\hat{x}_{t+1|t}}$。\n新息或测量残差是实际测量值 $y_{t+1}$ 与预测测量值 $h(\\hat{x}_{t+1|t})$ 之间的差：\n$$\n\\tilde{y}_{t+1} = y_{t+1} - h(\\hat{x}_{t+1|t})\n$$\n新息协方差 $S_{t+1}$ 为：\n$$\nS_{t+1} = H_{t+1} P_{t+1|t} H_{t+1}^T + R_{t+1}\n$$\n然后计算最优卡尔曼增益 $K_{t+1}$：\n$$\nK_{t+1} = P_{t+1|t} H_{t+1}^T S_{t+1}^{-1}\n$$\n最后，计算更新后的状态均值 $\\hat{x}_{t+1|t+1}$ 和协方差 $P_{t+1|t+1}$：\n$$\n\\hat{x}_{t+1|t+1} = \\hat{x}_{t+1|t} + K_{t+1} \\tilde{y}_{t+1}\n$$\n$$\nP_{t+1|t+1} = (I - K_{t+1} H_{t+1}) P_{t+1|t}\n$$\n其中 $I$ 是单位矩阵。这就完成了一个时间步长的EKF循环。\n\n**雅可比矩阵计算**\n问题要求计算在一般状态 $x_t = \\begin{pmatrix} q_t \\\\ \\omega_t \\end{pmatrix}$ 和输入 $u_t$ 处求值的雅可比矩阵 $A_t = \\frac{\\partial f}{\\partial x}$、 $B_t = \\frac{\\partial f}{\\partial u}$ 和 $H_t = \\frac{\\partial h}{\\partial x}$。\n\n状态向量为 $x_t = \\begin{pmatrix} q_t \\\\ \\omega_t \\end{pmatrix}$。动力学函数 $f(x_t, u_t)$ 的分量为：\n$$\nf_1(q_t, \\omega_t, u_t) = q_t + \\Delta t \\, \\omega_t\n$$\n$$\nf_2(q_t, \\omega_t, u_t) = \\omega_t + \\frac{\\Delta t}{I}\\big(\\beta\\,\\tanh(u_t) - b\\,\\omega_t - \\kappa\\,\\sin(q_t)\\big)\n$$\n\n**$A_t = \\frac{\\partial f}{\\partial x}$ 的计算：**\n$A_t$ 是一个 $2 \\times 2$ 矩阵，其元素为 $A_{ij} = \\frac{\\partial f_i}{\\partial x_j}$，其中 $x_1 = q_t$，$x_2 = \\omega_t$。\n$$\n\\frac{\\partial f_1}{\\partial q_t} = \\frac{\\partial}{\\partial q_t}(q_t + \\Delta t \\, \\omega_t) = 1\n$$\n$$\n\\frac{\\partial f_1}{\\partial \\omega_t} = \\frac{\\partial}{\\partial \\omega_t}(q_t + \\Delta t \\, \\omega_t) = \\Delta t\n$$\n$$\n\\frac{\\partial f_2}{\\partial q_t} = \\frac{\\partial}{\\partial q_t}\\left(\\omega_t + \\frac{\\Delta t}{I}\\big(\\beta\\,\\tanh(u_t) - b\\,\\omega_t - \\kappa\\,\\sin(q_t)\\big)\\right) = -\\frac{\\kappa \\Delta t}{I}\\cos(q_t)\n$$\n$$\n\\frac{\\partial f_2}{\\partial \\omega_t} = \\frac{\\partial}{\\partial \\omega_t}\\left(\\omega_t + \\frac{\\Delta t}{I}\\big(\\beta\\,\\tanh(u_t) - b\\,\\omega_t - \\kappa\\,\\sin(q_t)\\big)\\right) = 1 - \\frac{b \\Delta t}{I}\n$$\n因此，动力学关于状态的雅可比矩阵为：\n$$\nA_t = \\frac{\\partial f}{\\partial x} = \\begin{pmatrix} 1  \\Delta t \\\\ -\\frac{\\kappa \\Delta t}{I}\\cos(q_t)  1 - \\frac{b \\Delta t}{I} \\end{pmatrix}\n$$\n\n**$B_t = \\frac{\\partial f}{\\partial u}$ 的计算：**\n$B_t$ 是一个 $2 \\times 1$ 矩阵，其元素为 $B_i = \\frac{\\partial f_i}{\\partial u_t}$。\n$$\n\\frac{\\partial f_1}{\\partial u_t} = \\frac{\\partial}{\\partial u_t}(q_t + \\Delta t \\, \\omega_t) = 0\n$$\n$$\n\\frac{\\partial f_2}{\\partial u_t} = \\frac{\\partial}{\\partial u_t}\\left(\\omega_t + \\frac{\\Delta t}{I}\\big(\\beta\\,\\tanh(u_t) - b\\,\\omega_t - \\kappa\\,\\sin(q_t)\\big)\\right) = \\frac{\\beta \\Delta t}{I}\\frac{d}{du_t}(\\tanh(u_t)) = \\frac{\\beta \\Delta t}{I}\\sech^2(u_t)\n$$\n因此，动力学关于控制输入的雅可比矩阵为：\n$$\nB_t = \\frac{\\partial f}{\\partial u} = \\begin{pmatrix} 0 \\\\ \\frac{\\beta \\Delta t}{I}\\sech^2(u_t) \\end{pmatrix}\n$$\n\n**$H_t = \\frac{\\partial h}{\\partial x}$ 的计算：**\n测量函数 $h(x_t)$ 的分量为：\n$$\nh_1(q_t, \\omega_t) = q_t\n$$\n$$\nh_2(q_t, \\omega_t) = \\arctan(\\omega_t)\n$$\n$H_t$ 是一个 $2 \\times 2$ 矩阵，其元素为 $H_{ij} = \\frac{\\partial h_i}{\\partial x_j}$。\n$$\n\\frac{\\partial h_1}{\\partial q_t} = \\frac{\\partial}{\\partial q_t}(q_t) = 1\n$$\n$$\n\\frac{\\partial h_1}{\\partial \\omega_t} = \\frac{\\partial}{\\partial \\omega_t}(q_t) = 0\n$$\n$$\n\\frac{\\partial h_2}{\\partial q_t} = \\frac{\\partial}{\\partial q_t}(\\arctan(\\omega_t)) = 0\n$$\n$$\n\\frac{\\partial h_2}{\\partial \\omega_t} = \\frac{\\partial}{\\partial \\omega_t}(\\arctan(\\omega_t)) = \\frac{1}{1 + \\omega_t^2}\n$$\n因此，测量函数关于状态的雅可比矩阵为：\n$$\nH_t = \\frac{\\partial h}{\\partial x} = \\begin{pmatrix} 1  0 \\\\ 0  \\frac{1}{1 + \\omega_t^2} \\end{pmatrix}\n$$\n\n最终答案是分块行串联 $[A_t \\;\\; B_t \\;\\; H_t]$，这是一个 $2 \\times 5$ 的矩阵。\n$$\n[A_t \\;\\; B_t \\;\\; H_t] = \\begin{pmatrix} 1  \\Delta t  0  1  0 \\\\ -\\frac{\\kappa \\Delta t}{I}\\cos(q_t)  1 - \\frac{b \\Delta t}{I}  \\frac{\\beta \\Delta t}{I}\\sech^2(u_t)  0  \\frac{1}{1 + \\omega_t^2} \\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  \\Delta t  0  1  0 \\\\\n-\\frac{\\kappa \\Delta t}{I}\\cos(q_t)  1 - \\frac{b \\Delta t}{I}  \\frac{\\beta \\Delta t}{I}\\sech^2(u_t)  0  \\frac{1}{1 + \\omega_t^2}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}