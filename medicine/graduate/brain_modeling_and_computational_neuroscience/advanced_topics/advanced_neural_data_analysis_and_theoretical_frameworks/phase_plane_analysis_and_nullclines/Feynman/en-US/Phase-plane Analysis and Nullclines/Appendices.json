{
    "hands_on_practices": [
        {
            "introduction": "Many complex biophysical systems, including neurons, evolve on multiple time scales. In the FitzHugh-Nagumo model, the membrane potential $v$ changes much faster than the recovery variable $w$. This practice  leverages this separation to simplify the system's dynamics. By analyzing the system in the singular limit where the slow variable is momentarily frozen, you will derive the \"critical manifold\" where the fast dynamics settle, and then uncover the reduced, one-dimensional equation that governs the slow drift along this manifold.",
            "id": "4009577",
            "problem": "Consider a two-dimensional fast-slow neuronal model of FitzHugh–Nagumo type in dimensionless form,\n$$\n\\frac{dv}{dt} = f(v,w), \\qquad \\frac{dw}{dt} = \\epsilon\\, g(v,w),\n$$\nwhere $0  \\epsilon \\ll 1$ encodes the separation of time scales between the fast membrane potential $v$ and the slow recovery variable $w$. Let\n$$\nf(v,w) = v - \\frac{v^{3}}{3} - w + I_{0}, \\qquad g(v,w) = \\alpha\\, v - \\beta\\, w + \\gamma,\n$$\nwith parameters $I_{0}\\in \\mathbb{R}$ and $\\alpha,\\beta,\\gamma \\in \\mathbb{R}$. All variables and parameters are dimensionless. Using only the foundational definitions of nullclines, critical manifolds, and slow-time rescaling for fast-slow systems, perform the following:\n\n1. In the singular limit $\\epsilon \\to 0$, derive the critical manifold defined by $f(v,w)=0$ for the fast subsystem, expressed explicitly as a relation between $w$ and $v$.\n\n2. Assuming normal hyperbolicity away from fold points of the critical manifold, derive the reduced slow flow on the critical manifold in the slow time $\\tau = \\epsilon t$ by constraining $v$ and $w$ to satisfy the critical manifold relation. Express the reduced slow flow as a single analytic expression that depends only on $v$ and the parameters.\n\nProvide your final answer as a single closed-form analytic expression for the reduced slow flow $\\frac{dw}{d\\tau}$ as a function of $v$, $\\alpha$, $\\beta$, $\\gamma$, and $I_{0}$. No numerical approximation is required and no units are involved. State only the final expression.",
            "solution": "The problem requires the derivation of the critical manifold and the reduced slow flow for a given FitzHugh–Nagumo type fast-slow system. The system is described by the following set of ordinary differential equations:\n$$\n\\frac{dv}{dt} = v - \\frac{v^{3}}{3} - w + I_{0}\n$$\n$$\n\\frac{dw}{dt} = \\epsilon (\\alpha v - \\beta w + \\gamma)\n$$\nwhere $v$ is the fast variable, $w$ is the slow variable, and $0  \\epsilon \\ll 1$ is the parameter that separates the time scales. All other symbols, $I_{0}$, $\\alpha$, $\\beta$, and $\\gamma$, are real parameters.\n\nThe derivation proceeds in two steps as requested.\n\nFirst, we identify the critical manifold. The critical manifold is defined in the singular limit where $\\epsilon \\to 0$. In this limit, the system becomes:\n$$\n\\frac{dv}{dt} = v - \\frac{v^{3}}{3} - w + I_{0}\n$$\n$$\n\\frac{dw}{dt} = 0\n$$\nThe second equation, $\\frac{dw}{dt} = 0$, implies that $w$ evolves infinitely slowly compared to $v$. In the time scale of the fast variable $v$, $w$ can be treated as a constant parameter. The fast dynamics of $v$ will rapidly converge to an equilibrium state, provided such a state is stable. The set of all such equilibrium points for the fast subsystem constitutes the critical manifold, denoted $C_{0}$. To find these points, we set the fast dynamics to zero:\n$$\n\\frac{dv}{dt} = f(v,w) = 0\n$$\nSubstituting the given expression for $f(v,w)$:\n$$\nv - \\frac{v^{3}}{3} - w + I_{0} = 0\n$$\nThe problem asks for this relation to be expressed explicitly with $w$ as a function of $v$. Rearranging the equation, we obtain the equation for the critical manifold:\n$$\nw = v - \\frac{v^{3}}{3} + I_{0}\n$$\nThis cubic curve in the $(v,w)$-plane is the critical manifold $C_{0}$. The system's state $(v(t), w(t))$ is assumed to be constrained to this manifold for the slow dynamics, which is valid on the normally hyperbolic parts of $C_{0}$.\n\nSecond, we derive the reduced slow flow on this critical manifold. The dynamics of the slow variable $w$ are given by $\\frac{dw}{dt} = \\epsilon g(v,w)$. To analyze the flow on the slow time scale, we introduce a new time variable $\\tau = \\epsilon t$. Using the chain rule for derivatives:\n$$\n\\frac{dw}{d\\tau} = \\frac{dw}{dt} \\frac{dt}{d\\tau}\n$$\nFrom the definition $\\tau = \\epsilon t$, we have $\\frac{d\\tau}{dt} = \\epsilon$, which implies $\\frac{dt}{d\\tau} = \\frac{1}{\\epsilon}$. Substituting this into the chain rule expression:\n$$\n\\frac{dw}{d\\tau} = \\frac{1}{\\epsilon} \\frac{dw}{dt}\n$$\nNow, we use the original equation for $\\frac{dw}{dt}$:\n$$\n\\frac{dw}{d\\tau} = \\frac{1}{\\epsilon} \\left[ \\epsilon (\\alpha v - \\beta w + \\gamma) \\right]\n$$\n$$\n\\frac{dw}{d\\tau} = \\alpha v - \\beta w + \\gamma\n$$\nThis equation describes the slow flow throughout the phase space. The reduced slow flow is the dynamics constrained to the critical manifold $C_{0}$. To find it, we substitute the expression for $w$ from the critical manifold equation, $w = v - \\frac{v^{3}}{3} + I_{0}$, into the equation for $\\frac{dw}{d\\tau}$:\n$$\n\\frac{dw}{d\\tau} = \\alpha v - \\beta \\left( v - \\frac{v^{3}}{3} + I_{0} \\right) + \\gamma\n$$\nWe now expand and simplify this expression to obtain the reduced slow flow solely as a function of $v$ and the parameters:\n$$\n\\frac{dw}{d\\tau} = \\alpha v - \\beta v + \\frac{\\beta v^{3}}{3} - \\beta I_{0} + \\gamma\n$$\nGrouping the terms by powers of $v$:\n$$\n\\frac{dw}{d\\tau} = \\frac{\\beta}{3}v^{3} + (\\alpha - \\beta)v + (\\gamma - \\beta I_{0})\n$$\nThe problem asks for the single analytic expression for the reduced slow flow $\\frac{dw}{d\\tau}$. This expression is the right-hand side of the final equation derived above. It describes the evolution along the critical manifold in the slow time $\\tau$.",
            "answer": "$$\n\\boxed{\\frac{\\beta}{3}v^{3} + (\\alpha - \\beta)v + \\gamma - \\beta I_{0}}\n$$"
        },
        {
            "introduction": "A neuron's decision to fire an action potential is not merely about whether an input is strong, but also about the system's internal state. This \"all-or-none\" threshold has a beautiful geometric interpretation in the phase plane as a separatrix. This practice  is a computational deep-dive into locating this critical boundary, which is formed by the manifolds of a saddle fixed point. By computationally tracing the unstable manifold, you will directly visualize the threshold that separates stimuli that lead to a spike from those that decay back to rest.",
            "id": "4009653",
            "problem": "You are given a two-dimensional deterministic dynamical system that models a reduced excitable neuron in the phase plane, inspired by the FitzHugh–Nagumo reduction of the Hodgkin–Huxley model. The state variables are the membrane potential $v$ and a slow recovery variable $w$, and the dynamics are defined by\n$$\n\\frac{dv}{dt} = f(v,w) = v - \\frac{v^3}{3} - w + I, \\quad \\frac{dw}{dt} = g(v,w) = \\varepsilon\\,(v + a - b\\,w),\n$$\nwhere $I$ is an external current, $\\varepsilon$ is a small positive constant setting the slow timescale of $w$, $a$ is a bias parameter, and $b$ is a coupling parameter. The phase-plane analysis of this system involves the $v$-nullcline $f(v,w) = 0$ and the $w$-nullcline $g(v,w) = 0$. The $v$-nullcline is a cubic curve in $(v,w)$, and the central “middle branch” corresponds to the portion with $|v|  1$.\n\nStarting from the following foundational definitions and facts:\n- A fixed point $(v^\\ast, w^\\ast)$ satisfies $f(v^\\ast,w^\\ast) = 0$ and $g(v^\\ast,w^\\ast) = 0$ by definition.\n- The Jacobian matrix of the system evaluated at a fixed point is\n$$\nJ(v^\\ast,w^\\ast) = \n\\begin{bmatrix}\n\\frac{\\partial f}{\\partial v}(v^\\ast,w^\\ast)  \\frac{\\partial f}{\\partial w}(v^\\ast,w^\\ast) \\\\\n\\frac{\\partial g}{\\partial v}(v^\\ast,w^\\ast)  \\frac{\\partial g}{\\partial w}(v^\\ast,w^\\ast)\n\\end{bmatrix},\n$$\nwith entries computed from the given $f$ and $g$.\n- In two dimensions, a fixed point is a saddle if and only if $\\det(J(v^\\ast,w^\\ast))  0$, which implies one eigenvalue with positive real part and one with negative real part.\n- The unstable manifold of a saddle is tangent at $(v^\\ast,w^\\ast)$ to the eigenvector of $J(v^\\ast,w^\\ast)$ associated with the eigenvalue whose real part is positive. Integrating the flow forward in time from initial conditions slightly displaced along this eigenvector generates the unstable manifold branches.\n\nYour tasks are:\n1. For each parameter set in the test suite below, locate the fixed point $(v^\\ast, w^\\ast)$ that lies on the middle branch of the cubic $v$-nullcline (select the real solution with $|v^\\ast|$ minimized; if multiple real solutions satisfy $|v^\\ast|  1$, choose the one with the smallest $|v^\\ast|$).\n2. Compute the Jacobian matrix $J(v^\\ast,w^\\ast)$ and decide whether the fixed point is a saddle by evaluating the sign of $\\det(J(v^\\ast,w^\\ast))$.\n3. If the fixed point is a saddle, compute the unstable eigenvector (associated with the eigenvalue of $J$ with the largest real part) and its angle $\\theta$ in radians measured from the positive $v$-axis via $\\theta = \\operatorname{atan2}(e_w,e_v)$, where $(e_v,e_w)$ are the components of the unstable eigenvector. If the largest real part is not positive, report $\\theta$ from that eigenvector but denote that no unstable manifold exists for spiking tests.\n4. Initialize two nearby points on the unstable manifold branches as $(v^\\ast, w^\\ast) \\pm \\delta\\,\\mathbf{e}$, where $\\mathbf{e}$ is the unstable eigenvector normalized to unit length and $\\delta = 10^{-3}$. Integrate the system forward in dimensionless time to $T = 200$ using a numerical ordinary differential equation solver. Define a spike detection criterion by threshold crossing $v(t) \\geq v_{\\mathrm{spike}}$, with $v_{\\mathrm{spike}} = 1.2$. Record, for each branch, whether the event $v(t)$ crosses $v_{\\mathrm{spike}}$ for the first time with an increasing $v(t)$.\n5. Report, for each parameter set, the tuple $[v^\\ast, w^\\ast, \\theta, \\text{spike\\_plus}, \\text{spike\\_minus}, \\text{is\\_middle\\_branch}, \\text{is\\_saddle}]$, where:\n   - $v^\\ast$ and $w^\\ast$ are floats,\n   - $\\theta$ is a float (angle in radians),\n   - $\\text{spike\\_plus}$ and $\\text{spike\\_minus}$ are booleans for the $+\\delta$ and $-\\delta$ unstable branches,\n   - $\\text{is\\_middle\\_branch}$ is a boolean indicating whether $|v^\\ast|  1$,\n   - $\\text{is\\_saddle}$ is a boolean indicating $\\det(J(v^\\ast,w^\\ast))  0$.\n\nUse only dimensionless quantities; no physical units are required. Angles must be reported in radians.\n\nTest suite (each entry is $(\\varepsilon, a, b, I)$):\n- Case 1 (typical excitable/spiking with saddle on middle branch): $(0.08, 0.7, 3.0, 0.5)$.\n- Case 2 (boundary, non-hyperbolic fixed point): $(0.08, 0.0, 1.0, 0.0)$.\n- Case 3 (no saddle, determinant positive): $(0.08, 0.7, 0.2, 0.1)$.\n\nYour program should produce a single line of output containing the results for the three cases as a comma-separated list enclosed in square brackets. The format must be\n$$\n[\\,[v^\\ast_1,w^\\ast_1,\\theta_1,\\text{spike\\_plus}_1,\\text{spike\\_minus}_1,\\text{is\\_middle\\_branch}_1,\\text{is\\_saddle}_1],\\,[v^\\ast_2,w^\\ast_2,\\theta_2,\\text{spike\\_plus}_2,\\text{spike\\_minus}_2,\\text{is\\_middle\\_branch}_2,\\text{is\\_saddle}_2],\\,[v^\\ast_3,w^\\ast_3,\\theta_3,\\text{spike\\_plus}_3,\\text{spike\\_minus}_3,\\text{is\\_middle\\_branch}_3,\\text{is\\_saddle}_3]\\,],\n$$\nwith booleans rendered as Python literals and numbers in standard decimal form.",
            "solution": "The user has provided a problem from the field of computational neuroscience, requiring a phase-plane analysis of a simplified excitable neuron model akin to the FitzHugh-Nagumo system. The problem is well-defined, scientifically sound, and all necessary parameters and procedures are specified. The tasks involve finding a fixed point, analyzing its stability, determining the direction of its unstable manifold (if any), and simulating the system's trajectories to check for spiking behavior.\n\nThe dynamical system is given by the ordinary differential equations (ODEs):\n$$\n\\frac{dv}{dt} = f(v,w) = v - \\frac{v^3}{3} - w + I\n$$\n$$\n\\frac{dw}{dt} = g(v,w) = \\varepsilon (v + a - bw)\n$$\n\nThe solution process will be executed for each parameter set $(\\varepsilon, a, b, I)$ provided in the test suite.\n\n**Step 1: Locating the Fixed Point**\n\nA fixed point $(v^\\ast, w^\\ast)$ of the system is a state where the dynamics cease, i.e., $\\frac{dv}{dt} = 0$ and $\\frac{dw}{dt} = 0$. This provides a system of two algebraic equations:\n1. From the $v$-nullcline, $f(v^\\ast, w^\\ast) = 0$: $v^\\ast - \\frac{(v^\\ast)^3}{3} - w^\\ast + I = 0 \\implies w^\\ast = v^\\ast - \\frac{(v^\\ast)^3}{3} + I$.\n2. From the $w$-nullcline, $g(v^\\ast, w^\\ast) = 0$: Since $\\varepsilon  0$, this simplifies to $v^\\ast + a - bw^\\ast = 0$.\n\nBy substituting the expression for $w^\\ast$ from the $v$-nullcline into the $w$-nullcline equation, we obtain a single equation for $v^\\ast$:\n$$\nv^\\ast + a - b\\left(v^\\ast - \\frac{(v^\\ast)^3}{3} + I\\right) = 0\n$$\nRearranging this gives a cubic polynomial equation in $v^\\ast$:\n$$\n\\frac{b}{3}(v^\\ast)^3 + (1-b)v^\\ast + (a-bI) = 0\n$$\nThe roots of this cubic polynomial determine the $v$-coordinates of the fixed points. We will solve this equation numerically to find all its roots (real and complex). We then filter for the real roots by selecting those with an imaginary part whose magnitude is smaller than a small tolerance (e.g., $10^{-9}$). According to the problem statement, from the set of real roots, we must select the one, denoted $v^\\ast$, that has the minimum absolute value.\n\nOnce $v^\\ast$ is found, the corresponding $w$-coordinate, $w^\\ast$, is calculated from the linear $w$-nullcline equation: $w^\\ast = \\frac{v^\\ast + a}{b}$ (assuming $b \\neq 0$, which is true for all test cases). The boolean flag `is_middle_branch` is then determined by the condition $|v^\\ast|  1$.\n\n**Step 2: Stability Analysis via the Jacobian Matrix**\n\nThe stability of the fixed point $(v^\\ast, w^\\ast)$ is determined by the eigenvalues of the Jacobian matrix $J$ evaluated at that point. The partial derivatives are:\n$$\n\\frac{\\partial f}{\\partial v} = 1 - v^2, \\quad \\frac{\\partial f}{\\partial w} = -1\n$$\n$$\n\\frac{\\partial g}{\\partial v} = \\varepsilon, \\quad \\frac{\\partial g}{\\partial w} = -\\varepsilon b\n$$\nThe Jacobian matrix at $(v^\\ast, w^\\ast)$ is therefore:\n$$\nJ(v^\\ast,w^\\ast) =\n\\begin{bmatrix}\n1 - (v^\\ast)^2  -1 \\\\\n\\varepsilon  -\\varepsilon b\n\\end{bmatrix}\n$$\nA fixed point is a saddle if its Jacobian has a determinant less than zero, i.e., $\\det(J)  0$. This implies the eigenvalues are real and have opposite signs, one positive (unstable direction) and one negative (stable direction). We will compute $\\det(J) = (1-(v^\\ast)^2)(-\\varepsilon b) - (-1)(\\varepsilon) = \\varepsilon [1 - b(1-(v^\\ast)^2)]$ and set the boolean flag `is_saddle` accordingly.\n\n**Step 3: Unstable Eigenvector and Angle**\n\nThe unstable manifold of a saddle point is tangent to the eigenvector associated with the positive eigenvalue. More generally, the problem asks for the eigenvector associated with the eigenvalue having the largest real part. We compute the eigenvalues and eigenvectors of $J(v^\\ast, w^\\ast)$ numerically.\n\nLet $(\\lambda_1, \\lambda_2)$ be the eigenvalues and $(\\mathbf{e}_1, \\mathbf{e}_2)$ be the corresponding eigenvectors. We identify the eigenvalue with the largest real part, say $\\lambda_k$, and its corresponding eigenvector $\\mathbf{e}_k = (e_v, e_w)$.\nThe angle $\\theta$ of this eigenvector relative to the positive $v$-axis is calculated as $\\theta = \\operatorname{atan2}(e_w, e_v)$.\n\nA point of clarification is needed for cases where the eigenvalues are a complex conjugate pair (e.g., an unstable spiral/focus). In such cases, the eigenvectors are also complex. The problem asks for an angle $\\theta$, which implies a real-valued vector. A reasonable interpretation, which will be adopted here, is to use the real part of the complex eigenvector to define the direction for analysis. If $\\mathbf{e}_k = \\mathbf{e}_{\\text{real}} + i \\mathbf{e}_{\\text{imag}}$, we will use the components of $\\mathbf{e}_{\\text{real}}$ to compute $\\theta$.\n\n**Step 4: Numerical Integration and Spike Detection**\n\nTo determine if trajectories starting near the fixed point generate a spike, we perform numerical integration of the ODE system. We define two initial conditions perturbed from the fixed point along the direction of the \"unstable\" eigenvector $\\mathbf{e}$:\n$$\n\\mathbf{y}_{0, \\text{plus}} = (v^\\ast, w^\\ast) + \\delta \\hat{\\mathbf{e}}\n$$\n$$\n\\mathbf{y}_{0, \\text{minus}} = (v^\\ast, w^\\ast) - \\delta \\hat{\\mathbf{e}}\n$$\nwhere $\\hat{\\mathbf{e}}$ is the normalized (unit length) eigenvector direction vector (real part, as discussed), and $\\delta = 10^{-3}$ is the perturbation magnitude.\n\nWe will use the `solve_ivp` function from the `scipy.integrate` library to integrate the system from $t=0$ to $T=200$ for both initial conditions. Spike detection is implemented using the event handling feature of `solve_ivp`. A spike is defined as the event where the trajectory crosses the threshold $v(t) = v_{\\text{spike}} = 1.2$ with a positive velocity ($dv/dt  0$). The event function is $v(t) - 1.2$, and we look for a crossing in the increasing direction. If the event is detected for the `plus` branch, `spike_plus` is `True`; otherwise, it's `False`. The same logic applies to the `minus` branch for `spike_minus`.\n\n**Step 5: Assembling the Final Report**\n\nFor each parameter set, the calculated values—$v^\\ast$, $w^\\ast$, $\\theta$, `spike_plus`, `spike_minus`, `is_middle_branch`, and `is_saddle`—are collected into a list. The final output is a list containing these result lists for all test cases, formatted as specified.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    It iterates through parameter sets, analyzes the system for each,\n    and prints the formatted results.\n    \"\"\"\n    # Test suite: each entry is a tuple (epsilon, a, b, I)\n    test_cases = [\n        (0.08, 0.7, 3.0, 0.5),  # Case 1: Saddle on middle branch\n        (0.08, 0.0, 1.0, 0.0),  # Case 2: Non-hyperbolic fixed point\n        (0.08, 0.7, 0.2, 0.1)   # Case 3: Unstable focus\n    ]\n\n    results = []\n    for params in test_cases:\n        epsilon, a, b, I = params\n        result = analyze_system(epsilon, a, b, I)\n        results.append(result)\n\n    # Format the final output string as a list of lists.\n    # The conversion to string handles boolean literals correctly.\n    formatted_results = f\"[{','.join(map(str, results))}]\"\n    print(formatted_results)\n\ndef analyze_system(epsilon, a, b, I):\n    \"\"\"\n    Analyzes the FitzHugh-Nagumo-like system for a given set of parameters.\n    \n    Returns:\n        A list containing [v_star, w_star, theta, spike_plus, spike_minus,\n        is_middle_branch, is_saddle].\n    \"\"\"\n    # 1. Find the fixed point (v*, w*)\n    # The v-coordinate of the fixed point is a root of a cubic polynomial:\n    # (b/3)*v^3 + (1-b)*v + (a-b*I) = 0\n    poly_coeffs = [b / 3.0, 0, 1 - b, a - b * I]\n    roots = np.roots(poly_coeffs)\n\n    # Filter for real roots (imaginary part is negligible)\n    real_roots = roots[np.abs(np.imag(roots))  1e-9]\n    real_roots = np.real(real_roots)\n\n    # Select the real root with the minimum absolute value\n    if len(real_roots) == 0:\n        # This should not happen for the given test cases\n        raise ValueError(\"No real roots found for the fixed point equation.\")\n    v_star = real_roots[np.argmin(np.abs(real_roots))]\n    \n    # Calculate w_star from the w-nullcline\n    if abs(b)  1e-9: # Handle b=0 case, though not in test suite\n        w_star = np.nan # Undefined, but here v_star must be -a\n    else:\n        w_star = (v_star + a) / b\n\n    is_middle_branch = abs(v_star)  1.0\n\n    # 2. Compute Jacobian matrix and stability\n    J = np.array([\n        [1 - v_star**2, -1],\n        [epsilon, -epsilon * b]\n    ])\n    det_J = np.linalg.det(J)\n    is_saddle = det_J  0\n\n    # 3. Compute eigenvalues and the \"unstable\" eigenvector\n    eigvals, eigvecs = np.linalg.eig(J)\n    \n    # Find eigenvector corresponding to eigenvalue with largest real part\n    idx_unstable = np.argmax(np.real(eigvals))\n    unstable_eigvec = eigvecs[:, idx_unstable]\n    \n    # Eigenvector can be complex. We use its real part to define a direction.\n    # This is a necessary interpretation for cases with spiral dynamics.\n    e_v, e_w = np.real(unstable_eigvec)\n    \n    # Calculate angle theta\n    theta = np.arctan2(e_w, e_v)\n\n    # 4. Numerical integration to check for spikes\n    delta = 1e-3\n    t_span = (0, 200)\n    v_spike_threshold = 1.2\n    \n    # Normalize the direction vector\n    eigvec_real_part = np.real(unstable_eigvec)\n    norm = np.linalg.norm(eigvec_real_part)\n    if norm  1e-9:\n        unit_eigvec = eigvec_real_part / norm\n    else: # Should not happen in these cases, but for robustness\n        unit_eigvec = np.array([1.0, 0.0])\n\n    # ODE system definition\n    def fhn_ode(t, y, epsilon, a, b, I):\n        v, w = y\n        dvdt = v - v**3 / 3 - w + I\n        dwdt = epsilon * (v + a - b * w)\n        return [dvdt, dwdt]\n\n    # Spike detection event function for solve_ivp\n    def spike_event(t, y, *args):\n        return y[0] - v_spike_threshold\n    spike_event.terminal = True  # Stop integration after first spike\n    spike_event.direction = 1    # Detect crossing from negative to positive\n\n    y_star = np.array([v_star, w_star])\n    \n    # Check +delta branch\n    y0_plus = y_star + delta * unit_eigvec\n    sol_plus = solve_ivp(fhn_ode, t_span, y0_plus, args=(epsilon, a, b, I),\n                         events=spike_event, dense_output=True)\n    spike_plus = len(sol_plus.t_events[0])  0\n\n    # Check -delta branch\n    y0_minus = y_star - delta * unit_eigvec\n    sol_minus = solve_ivp(fhn_ode, t_span, y0_minus, args=(epsilon, a, b, I),\n                          events=spike_event, dense_output=True)\n    spike_minus = len(sol_minus.t_events[0])  0\n    \n    # 5. Assemble results\n    return [\n        v_star,\n        w_star,\n        theta,\n        spike_plus,\n        spike_minus,\n        is_middle_branch,\n        is_saddle\n    ]\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "Phase-plane analysis is not just for qualitative sketches; it can yield powerful quantitative predictions. For systems exhibiting relaxation oscillations, the period of the rhythm is dominated by the time spent slowly traversing the stable branches of the fast nullcline. This exercise  demonstrates how to calculate this \"slow passage time\" semi-analytically. By deriving an expression for the slow dynamics and integrating it numerically, you can estimate the oscillation period, providing a direct link between the geometry of the phase plane and a fundamental temporal property of the neural oscillator.",
            "id": "4009602",
            "problem": "Consider the planar slow-fast neuronal model, a dimensionless form of the FitzHugh–Nagumo system, defined by the ordinary differential equations (ODE) for a membrane voltage variable $V$ and a recovery variable $w$:\n$$\n\\frac{dV}{dt} = f(V,w) = V - \\frac{V^3}{3} - w + I,\n$$\n$$\n\\frac{dw}{dt} = g(V,w) = \\epsilon \\left(V + a - b\\,w\\right),\n$$\nwhere $I$, $a$, $b$, and $\\epsilon$ are parameters with $0  \\epsilon \\ll 1$. The $V$-nullcline is the set of points where $\\frac{dV}{dt} = 0$, i.e., $f(V,w) = 0$, which yields the algebraic relation\n$$\nw = W(V; I) = V - \\frac{V^3}{3} + I.\n$$\nAssume the system is in a relaxation oscillation regime where the trajectory alternates between slow evolution along attracting branches of the $V$-nullcline and fast jumps between branches. For the fast subsystem with $w$ treated as a parameter, the attracting branches of the $V$-nullcline occur where $\\frac{\\partial f}{\\partial V} = 1 - V^2  0$, i.e., for $V  -1$ (left attracting branch) and $V > 1$ (right attracting branch). The fold (knee) points are at $V = -1$ and $V = 1$.\n\nUnder the approximation that fast jumps conserve $w$ and occur instantaneously up to specified small durations, the landing points on the opposite attracting branches are determined by solving $W(V; I) = \\text{constant}$ set by the $w$-value at the knee. For the cubic $W(V; I)$ above, the singular fast jumps connect $V = -1$ to $V = 2$ and $V = 1$ to $V = -2$. Therefore, in one oscillation cycle, the slow evolution occurs along:\n- the left attracting branch from $V = -2$ to $V = -1$,\n- the right attracting branch from $V = 2$ to $V = 1$.\n\nYour task is to estimate the oscillation period $T$ by summing the slow passage times along these two attracting branches and the specified fast jump durations. You must start from fundamental definitions and laws (chain rule, nullcline constraint, and projection of slow dynamics along invariant manifolds) and derive the numerical procedure to evaluate the slow passage time integrals along each branch. You must not assume or use any pre-given shortcut formulas. Use numerical quadrature to evaluate the required integrals in terms of $V$ and $W(V; I)$, and add the given fast jump times to obtain $T$ for each parameter set.\n\nImplement a program that, for each parameter set, computes:\n- the time spent on the left branch from $V = -2$ to $V = -1$,\n- the time spent on the right branch from $V = 2$ to $V = 1$,\n- the sum of the two specified fast jump durations,\nand returns the total period $T$ as a float.\n\nYour program must produce a single line of output containing the results as a comma-separated list of floats rounded to six decimal places and enclosed in square brackets (e.g., \"[$result_1, result_2, result_3, result_4, result_5$]\").\n\nUse the following test suite, expressed as tuples $(\\epsilon, a, b, I, \\tau_1, \\tau_2)$, where $\\tau_1$ and $\\tau_2$ are the durations of the two fast jumps (in the same dimensionless time units as $t$):\n\n- Test case $1$ (general case): $(0.05, 0.7, 0.8, 0.5, 0.0, 0.0)$.\n- Test case $2$ (smaller $\\epsilon$ boundary): $(0.01, 0.7, 0.8, 0.5, 0.0, 0.0)$.\n- Test case $3$ (no coupling in $w$-equation, nonzero jump times): $(0.05, 0.7, 0.0, 0.5, 0.005, 0.005)$.\n- Test case $4$ (negative $a$, moderate $b$): $(0.03, -0.2, 0.5, 0.3, 0.01, 0.02)$.\n- Test case $5$ (very small $\\epsilon$, stronger $b$): $(0.005, 0.2, 1.0, 0.0, 0.0, 0.0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[$result_1$, $result_2$, $result_3$, $result_4$, $result_5$]\"), where each $result_i$ is the estimated period $T$ for the corresponding test case, rounded to six decimal places. No other output is permitted.",
            "solution": "The problem is valid. It is a well-posed problem in computational neuroscience and dynamical systems, based on the established FitzHugh–Nagumo model. The parameters and conditions provided are complete, consistent, and scientifically sound.\n\nThe objective is to estimate the period, $T$, of a relaxation oscillation in a slow-fast planar system. The total period is the sum of the time spent evolving along two slow branches of the $V$-nullcline and the durations of two fast jumps.\n$$\nT = T_{\\text{left}} + T_{\\text{right}} + \\tau_{\\text{jumps}}\n$$\nwhere $T_{\\text{left}}$ is the time on the left attracting branch, $T_{\\text{right}}$ is the time on the right attracting branch, and $\\tau_{\\text{jumps}} = \\tau_1 + \\tau_2$ is the total specified duration for the fast jumps.\n\nThe core of the problem is to derive an expression for the slow passage times, $T_{\\text{left}}$ and $T_{\\text{right}}$, from fundamental principles. The system dynamics are governed by:\n$$\n\\frac{dV}{dt} = V - \\frac{V^3}{3} - w + I\n$$\n$$\n\\frac{dw}{dt} = \\epsilon \\left(V + a - b\\,w\\right)\n$$\nIn the limit where $\\epsilon$ is very small ($0  \\epsilon \\ll 1$), the system exhibits slow-fast dynamics. The variable $V$ is fast, and $w$ is slow. During the slow phases of the oscillation, the trajectory is constrained to lie on the stable branches of the $V$-nullcline, which is defined by setting $\\frac{dV}{dt} = 0$:\n$$\nw = W(V; I) = V - \\frac{V^3}{3} + I\n$$\nThis equation represents an algebraic constraint between $V$ and $w$ during slow evolution. To find the effective dynamics of $V$ along this nullcline, we can differentiate the constraint with respect to time $t$. Using the chain rule:\n$$\n\\frac{dw}{dt} = \\frac{d}{dt} \\left( V(t) - \\frac{V(t)^3}{3} + I \\right) = \\left( 1 - V^2 \\right) \\frac{dV}{dt}\n$$\nWe have a second expression for $\\frac{dw}{dt}$ from the original system equations. By equating these two expressions, we can describe the evolution of the system projected onto the slow manifold:\n$$\n\\left( 1 - V^2 \\right) \\frac{dV}{dt} = \\epsilon \\left(V + a - b\\,w\\right)\n$$\nNow, we enforce the slow-manifold constraint by substituting $w = W(V; I)$ into the right-hand side of the equation:\n$$\n\\left( 1 - V^2 \\right) \\frac{dV}{dt} = \\epsilon \\left(V + a - b\\left[V - \\frac{V^3}{3} + I\\right]\\right)\n$$\nThis yields a single ordinary differential equation for $V(t)$ valid during the slow evolution phases:\n$$\n\\frac{dV}{dt} = \\frac{\\epsilon \\left( \\frac{b}{3}V^3 + (1-b)V + (a-bI) \\right)}{1 - V^2}\n$$\nTo find the time taken for $V$ to travel from a starting value $V_{\\text{start}}$ to an ending value $V_{\\text{end}}$, we rearrange the equation to separate variables and integrate:\n$$\ndt = \\frac{1 - V^2}{\\epsilon \\left( \\frac{b}{3}V^3 + (1-b)V + (a-bI) \\right)} dV\n$$\nThe total time for a slow segment is the integral of $dt$:\n$$\nT_{\\text{slow}} = \\int_{V_{\\text{start}}}^{V_{\\text{end}}} \\frac{1 - V^2}{\\epsilon \\left( \\frac{b}{3}V^3 + (1-b)V + (a-bI) \\right)} dV\n$$\nThis general formula can now be applied to the two specific segments of the oscillation cycle described in the problem.\n\n$1$. The time on the left branch, $T_{\\text{left}}$, where the system evolves from $V = -2$ to $V = -1$:\n$$\nT_{\\text{left}} = \\int_{-2}^{-1} \\frac{1 - V^2}{\\epsilon \\left( \\frac{b}{3}V^3 + (1-b)V + (a-bI) \\right)} dV\n$$\nIn this interval, $V$ increases, so $\\frac{dV}{dt}  0$. The term $1-V^2$ is negative for $V \\in [-2, -1]$. Therefore, the polynomial in the denominator must also be negative, ensuring the integrand is positive.\n\n$2$. The time on the right branch, $T_{\\text{right}}$, where the system evolves from $V = 2$ to $V = 1$:\n$$\nT_{\\text{right}} = \\int_{2}^{1} \\frac{1 - V^2}{\\epsilon \\left( \\frac{b}{3}V^3 + (1-b)V + (a-bI) \\right)} dV\n$$\nIn this interval, $V$ decreases, so $\\frac{dV}{dt}  0$. The term $1-V^2$ is negative for $V \\in [1, 2]$. Therefore, the polynomial in the denominator must be positive. This makes the integrand negative. However, integrating from a larger limit ($V=2$) to a smaller limit ($V=1$) correctly yields a positive time duration.\n\nThese integrals do not generally have simple closed-form analytical solutions and must be evaluated using numerical quadrature. The final period $T$ for each parameter set $(\\epsilon, a, b, I, \\tau_1, \\tau_2)$ is then calculated as:\n$$\nT = T_{\\text{left}} + T_{\\text{right}} + \\tau_1 + \\tau_2\n$$\nThe numerical implementation will define a function for the integrand and use a scientific library function such as `scipy.integrate.quad` to compute the definite integrals for $T_{\\text{left}}$ and $T_{\\text{right}}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the estimated period of a relaxation oscillation in a FitzHugh-Nagumo model\n    for a given set of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is of the form (epsilon, a, b, I, tau1, tau2)\n    test_cases = [\n        (0.05, 0.7, 0.8, 0.5, 0.0, 0.0),        # Test case 1\n        (0.01, 0.7, 0.8, 0.5, 0.0, 0.0),        # Test case 2\n        (0.05, 0.7, 0.0, 0.5, 0.005, 0.005),    # Test case 3\n        (0.03, -0.2, 0.5, 0.3, 0.01, 0.02),     # Test case 4\n        (0.005, 0.2, 1.0, 0.0, 0.0, 0.0),       # Test case 5\n    ]\n\n    # This function defines the integrand for the slow passage time calculation.\n    # It corresponds to dt/dV.\n    def time_integrand(V, epsilon, a, b, I):\n        \"\"\"\n        Integrand for calculating slow passage time, derived from the system dynamics.\n        \n        Args:\n            V (float): The voltage variable.\n            epsilon (float): The slow-fast time scale parameter.\n            a (float): Parameter in the recovery variable equation.\n            b (float): Parameter in the recovery variable equation.\n            I (float): External current parameter.\n            \n        Returns:\n            float: The value of dt/dV at a given V.\n        \"\"\"\n        numerator = 1.0 - V**2\n        # The denominator is epsilon * P(V), where P(V) is a polynomial in V.\n        denominator = epsilon * (b / 3.0 * V**3 + (1.0 - b) * V + (a - b * I))\n        \n        # Avoid division by zero, though for a well-posed relaxation oscillator,\n        # the denominator should not be zero in the integration ranges.\n        if denominator == 0:\n            return np.inf\n\n        return numerator / denominator\n\n    total_periods = []\n    for params in test_cases:\n        epsilon, a, b, I, tau1, tau2 = params\n\n        # Component 1: Time spent on the left branch (V from -2 to -1)\n        # quad returns a tuple (result, error_estimate)\n        t_left, _ = quad(time_integrand, -2.0, -1.0, args=(epsilon, a, b, I))\n\n        # Component 2: Time spent on the right branch (V from 2 to 1)\n        t_right, _ = quad(time_integrand, 2.0, 1.0, args=(epsilon, a, b, I))\n\n        # Component 3: Sum of fast jump durations\n        t_jumps = tau1 + tau2\n        \n        # Total period is the sum of all components\n        total_period = t_left + t_right + t_jumps\n        total_periods.append(total_period)\n\n    # Format the results as a list of strings, each rounded to six decimal places.\n    formatted_results = [f\"{period:.6f}\" for period in total_periods]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}