{
    "hands_on_practices": [
        {
            "introduction": "Before we can infer spikes, we must first build a solid mathematical model of how calcium concentration changes over time. Many sophisticated spike deconvolution algorithms are built upon a simple, yet powerful, discrete-time autoregressive (AR) model. This first exercise  guides you through the fundamental step of deriving this discrete model from the continuous-time biophysics of exponential decay, connecting the decay time constant $\\tau$ to the discrete decay factor $\\gamma$.",
            "id": "4019621",
            "problem": "Consider a calcium concentration signal modeled continuously by the linear time-invariant ordinary differential equation $\\,\\frac{dC(t)}{dt}=-\\frac{1}{\\tau}C(t)\\,$, where $\\,\\tau>0\\,$ is the decay time constant and $\\,C(t)\\,$ denotes the concentration at time $\\,t\\,$. The fluorescence is sampled uniformly at interval $\\,\\Delta t>0\\,$, producing the discrete sequence $\\,\\{C_{k}\\}_{k\\in\\mathbb{Z}}\\,$ with $\\,C_{k}=C(k\\,\\Delta t)\\,$. In spike inference models, a common discrete-time representation of the passive decay between spikes is an autoregressive of order $\\,1\\,$ (AR(1)) recursion $\\,C_{k+1}=\\gamma\\,C_{k}\\,$, where $\\,\\gamma\\,$ is a dimensionless coefficient determined by the underlying continuous-time dynamics and the sampling interval.\n\nStarting only from the given continuous-time law of exponential decay and the uniform sampling assumption, derive the exact closed-form expression for the discrete-time AR(1) coefficient $\\,\\gamma\\,$ that makes $\\,C_{k+1}=\\gamma\\,C_{k}\\,$ consistent with the continuous-time model over one sampling interval. Express your final answer as a single analytic expression in terms of $\\,\\tau\\,$ and $\\,\\Delta t\\,$. No numerical evaluation or rounding is required.",
            "solution": "The problem statement has been validated and is deemed sound. It is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution without contradictions. The problem pertains to the discretization of a continuous-time linear system, a fundamental task in computational modeling and signal processing, specifically within the context of spike inference from calcium imaging data. We may therefore proceed with the derivation.\n\nThe starting point is the continuous-time ordinary differential equation (ODE) describing the passive decay of the calcium concentration, $\\,C(t)\\,$.\n$$\n\\frac{dC(t)}{dt} = -\\frac{1}{\\tau}C(t)\n$$\nHere, $\\,\\tau > 0\\,$ is the decay time constant. This is a first-order linear homogeneous ODE with constant coefficients. It can be solved by separation of variables.\n$$\n\\frac{dC}{C} = -\\frac{1}{\\tau}dt\n$$\nWe integrate both sides of the equation. To find the evolution of the concentration from a time $\\,t_1\\,$ to a later time $\\,t_2\\,$, we integrate from $\\,C(t_1)\\,$ to $\\,C(t_2)\\,$ on the left and from $\\,t_1\\,$ to $\\,t_2\\,$ on the right.\n$$\n\\int_{C(t_1)}^{C(t_2)} \\frac{1}{C} dC = \\int_{t_1}^{t_2} -\\frac{1}{\\tau} dt\n$$\nPerforming the integration yields:\n$$\n\\left[ \\ln |C| \\right]_{C(t_1)}^{C(t_2)} = -\\frac{1}{\\tau} \\left[ t \\right]_{t_1}^{t_2}\n$$\nSince calcium concentration is a non-negative quantity, we can drop the absolute value.\n$$\n\\ln(C(t_2)) - \\ln(C(t_1)) = -\\frac{1}{\\tau}(t_2 - t_1)\n$$\nUsing the properties of logarithms, this becomes:\n$$\n\\ln\\left(\\frac{C(t_2)}{C(t_1)}\\right) = -\\frac{t_2 - t_1}{\\tau}\n$$\nExponentiating both sides gives the solution relating the concentration at two different points in time:\n$$\n\\frac{C(t_2)}{C(t_1)} = \\exp\\left(-\\frac{t_2 - t_1}{\\tau}\\right)\n$$\n$$\nC(t_2) = C(t_1) \\exp\\left(-\\frac{t_2 - t_1}{\\tau}\\right)\n$$\nThis equation describes the evolution of the concentration $\\,C(t)\\,$ from any time $\\,t_1\\,$ to any subsequent time $\\,t_2\\,$.\n\nThe problem states that the continuous signal $\\,C(t)\\,$ is sampled uniformly at an interval $\\,\\Delta t > 0\\,$. The discrete samples are denoted $\\,C_k = C(k \\Delta t)\\,$ for any integer $\\,k\\,$. We want to find a relationship between two consecutive samples, $\\,C_k\\,$ and $\\,C_{k+1}\\,$.\n\nLet us apply the general solution we derived. We set $\\,t_1 = k \\Delta t\\,$ and $\\,t_2 = (k+1) \\Delta t\\,$. The concentrations at these times are $\\,C(t_1) = C(k \\Delta t) = C_k\\,$ and $\\,C(t_2) = C((k+1) \\Delta t) = C_{k+1}\\,$. The time difference is $\\,t_2 - t_1 = (k+1)\\Delta t - k \\Delta t = \\Delta t\\,$.\n\nSubstituting these into the general solution:\n$$\nC_{k+1} = C_k \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\n$$\nThis equation represents the exact discrete-time evolution derived from the continuous-time decay model.\n\nThe problem posits that this discrete-time evolution is modeled as a first-order autoregressive (AR(1)) process:\n$$\nC_{k+1} = \\gamma C_k\n$$\nwhere $\\,\\gamma\\,$ is the dimensionless AR(1) coefficient.\n\nTo ensure consistency between the continuous-time dynamics and the discrete-time AR(1) model, we must equate the two expressions for $\\,C_{k+1}\\,$.\n$$\n\\gamma C_k = C_k \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\n$$\nFor this relation to hold for any non-trivial concentration $\\,C_k \\neq 0\\,$, the coefficients must be equal. Therefore, we can identify $\\,\\gamma\\,$ by direct comparison:\n$$\n\\gamma = \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\n$$\nThis is the closed-form expression for the discrete-time AR(1) coefficient $\\,\\gamma\\,$ in terms of the continuous-time decay constant $\\,\\tau\\,$ and the sampling interval $\\,\\Delta t\\,$. The conditions $\\,\\tau > 0\\,$ and $\\,\\Delta t > 0\\,$ ensure that $\\,0 < \\gamma < 1\\,$, which is physically consistent with a passive decay process.",
            "answer": "$$\n\\boxed{\\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)}\n$$"
        },
        {
            "introduction": "Understanding the forward model—how a known spike train generates a calcium signal—is a crucial prerequisite for tackling the inverse problem of spike inference. This practice  provides a hands-on calculation of a calcium trace resulting from a few spikes, using the first-order autoregressive (AR(1)) model. By manually stepping through the dynamics, you will develop a concrete intuition for how individual spike responses superimpose and decay over time.",
            "id": "4019639",
            "problem": "Consider a standard generative model for intracellular calcium concentration in a neuron under spiking activity, where the continuous-time calcium concentration $C(t)$ follows first-order linear kinetics with exponential decay and spike-driven increments. Specifically, between spikes the dynamics obey the linear ordinary differential equation (ODE) $dC(t)/dt = -C(t)/\\tau$, and each spike produces an instantaneous increment of amplitude $\\alpha$ in $C(t)$. When sampled at a fixed interval $\\Delta t$, this continuous-time model induces a discrete-time first-order auto-regressive (AR(1)) process for the sampled sequence $C_t = C(t\\Delta t)$ with the update $C_t$ determined by exponential decay between samples and additive contributions from spikes.\n\nAssume the following scientifically standard conditions:\n- The sampling interval is $\\Delta t = 1$ (arbitrary time units), making time indices $t \\in \\{0,1,2,\\dots\\}$.\n- The decay factor is $\\gamma = \\exp(-\\Delta t/\\tau)$ and is given numerically as $\\gamma = 0.95$.\n- The spike amplitude is $\\alpha = 1$ (dimensionless amplitude increment per spike).\n- The spike train $s_t$ is dimensionless and takes value $1$ at spike times and $0$ otherwise. There are exactly two spikes: one at $t=10$ and one at $t=20$, so $s_{10} = 1$, $s_{20} = 1$, and $s_t = 0$ for all other $t$.\n- The initial calcium concentration is $C_0 = 0$, and there is no activity prior to $t=10$.\n\nNeglect any observation noise, baseline fluorescence offset, or other measurement effects, and treat $C_t$ as dimensionless.\n\nUsing only these premises (exponential decay between samples and unit increments at spike times), compute the discrete-time calcium concentrations $C_t$ for $t=10,11,\\dots,25$ as exact analytical expressions in terms of powers of $0.95$. Express your final answer as a single row matrix listing $C_{10}, C_{11}, \\dots, C_{25}$, with no numerical rounding or approximation. No units are required in the final answer since $C_t$ is dimensionless. Do not include any percentages in your expressions.",
            "solution": "The problem asks for the computation of a discrete-time calcium concentration sequence $C_t$ based on a generative model.\n\nFirst, we must validate the problem statement.\nThe givens are:\n- A continuous-time calcium concentration model with dynamics $dC(t)/dt = -C(t)/\\tau$ between spikes and instantaneous increments of amplitude $\\alpha$ per spike.\n- A discrete-time representation $C_t = C(t\\Delta t)$ which is a first-order auto-regressive (AR(1)) process.\n- Sampling interval: $\\Delta t = 1$.\n- Decay factor: $\\gamma = \\exp(-\\Delta t/\\tau) = 0.95$.\n- Spike amplitude: $\\alpha = 1$.\n- Spike train: $s_t=1$ at $t=10$ and $t=20$, and $s_t=0$ for all other non-negative integer times $t$.\n- Initial condition: $C_0 = 0$.\n- The model is to be treated as exact, with no noise or other measurement artifacts.\n\nThe problem is scientifically grounded, as this AR(1) model is a standard and simplified representation of calcium dynamics used in computational neuroscience for spike inference. It is well-posed, with all necessary parameters, initial conditions, and inputs specified, ensuring a unique solution. The language is objective and precise. The problem is not incomplete, contradictory, unrealistic, or ill-posed. Therefore, the problem is deemed valid and a solution can be derived.\n\nThe discrete-time dynamics of the calcium concentration $C_t$ can be formulated from the problem description. The value at time step $t$ is the sum of the decayed value from the previous time step, $C_{t-1}$, and the contribution from any spike occurring at time $t$. The decay over one time step $\\Delta t$ is given by the factor $\\gamma$. The contribution from a spike is the amplitude $\\alpha$. Thus, the update rule for the AR(1) model is:\n$$C_t = \\gamma C_{t-1} + \\alpha s_t$$\n\nSubstituting the given values $\\gamma = 0.95$ and $\\alpha = 1$, the equation becomes:\n$$C_t = 0.95 C_{t-1} + s_t$$\n\nThe initial condition is $C_0=0$. The spike train $s_t$ is non-zero only at $t=10$ and $t=20$.\n\nWe can solve this linear recurrence relation by unrolling it, which reveals the general solution as a convolution of the spike train with the system's impulse response. The solution at time $t$ is the sum of the responses to all past spikes, decayed appropriately.\nFor a single spike at time $t_0$, the response for $t \\ge t_0$ is $C_t = \\alpha \\gamma^{t-t_0}$. Since the system is linear, the total response is the superposition of the responses to each individual spike.\nThe given spike train consists of two spikes, one at $t=10$ and one at $t=20$. The total calcium concentration $C_t$ is the sum of the responses from these two events:\n$$C_t = \\alpha \\sum_{\\text{spike times } t_i \\le t} \\gamma^{t-t_i}$$\nWith $\\alpha=1$ and spike times $\\{10, 20\\}$, this becomes:\n$$C_t = \\begin{cases} 0 & \\text{for } t < 10 \\\\ \\gamma^{t-10} & \\text{for } 10 \\le t < 20 \\\\ \\gamma^{t-10} + \\gamma^{t-20} & \\text{for } t \\ge 20 \\end{cases}$$\n\nUsing this general form with $\\gamma=0.95$, we can compute the required values for $t=10, 11, \\dots, 25$.\n\nFor $t \\in \\{10, 11, \\dots, 19\\}$:\n$C_t = (0.95)^{t-10}$.\n$C_{10} = (0.95)^{10-10} = (0.95)^0 = 1$.\n$C_{11} = (0.95)^{11-10} = (0.95)^1 = 0.95$.\n$C_{12} = (0.95)^{12-10} = (0.95)^2$.\n...\n$C_{19} = (0.95)^{19-10} = (0.95)^9$.\n\nFor $t \\in \\{20, 21, \\dots, 25\\}$:\n$C_t = (0.95)^{t-10} + (0.95)^{t-20}$.\n$C_{20} = (0.95)^{20-10} + (0.95)^{20-20} = (0.95)^{10} + (0.95)^0 = 1 + (0.95)^{10}$.\n$C_{21} = (0.95)^{21-10} + (0.95)^{21-20} = (0.95)^{11} + (0.95)^1 = 0.95 + (0.95)^{11}$.\n$C_{22} = (0.95)^{22-10} + (0.95)^{22-20} = (0.95)^{12} + (0.95)^2$.\n$C_{23} = (0.95)^{23-10} + (0.95)^{23-20} = (0.95)^{13} + (0.95)^3$.\n$C_{24} = (0.95)^{24-10} + (0.95)^{24-20} = (0.95)^{14} + (0.95)^4$.\n$C_{25} = (0.95)^{25-10} + (0.95)^{25-20} = (0.95)^{15} + (0.95)^5$.\n\nWe now list the $16$ required values in a sequence as requested for the final answer.\n$C_{10} = 1$\n$C_{11} = 0.95$\n$C_{12} = (0.95)^2$\n$C_{13} = (0.95)^3$\n$C_{14} = (0.95)^4$\n$C_{15} = (0.95)^5$\n$C_{16} = (0.95)^6$\n$C_{17} = (0.95)^7$\n$C_{18} = (0.95)^8$\n$C_{19} = (0.95)^9$\n$C_{20} = 1 + (0.95)^{10}$\n$C_{21} = 0.95 + (0.95)^{11}$\n$C_{22} = (0.95)^2 + (0.95)^{12}$\n$C_{23} = (0.95)^3 + (0.95)^{13}$\n$C_{24} = (0.95)^4 + (0.95)^{14}$\n$C_{25} = (0.95)^5 + (0.95)^{15}$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 1 & 0.95 & (0.95)^{2} & (0.95)^{3} & (0.95)^{4} & (0.95)^{5} & (0.95)^{6} & (0.95)^{7} & (0.95)^{8} & (0.95)^{9} & 1+(0.95)^{10} & 0.95+(0.95)^{11} & (0.95)^{2}+(0.95)^{12} & (0.95)^{3}+(0.95)^{13} & (0.95)^{4}+(0.95)^{14} & (0.95)^{5}+(0.95)^{15} \\end{pmatrix} } $$"
        },
        {
            "introduction": "Real-world spike inference is an inverse problem, often formulated as an optimization task that balances fitting the observed data with a prior belief that spikes are sparse. This exercise  immerses you in the mechanics of a state-of-the-art method, proximal gradient descent, to solve such a problem. You will execute a single update step, combining a gradient descent on the data-fit error with a soft-thresholding operation that enforces sparsity, providing a window into how these algorithms iteratively uncover the most likely underlying spike train.",
            "id": "4019632",
            "problem": "Consider a calcium imaging generative model in which the calcium impulse response is produced by an Autoregressive of order $1$ (AR($1$)) process with decay parameter $\\gamma \\in (0,1)$ and unit amplitude. In discrete time with bin width normalized to $1$, the impulse response is $g_{t} = \\gamma^{t}$ for $t \\geq 0$. Let the spike train be a vector $s \\in \\mathbb{R}^{T}$, and let the observed fluorescence be modeled (ignoring baseline and measurement noise for this step) as $y \\approx H s$, where $H \\in \\mathbb{R}^{T \\times T}$ is the lower-triangular Toeplitz convolution matrix built from the impulse response. In this problem, take $T = 2$, $\\gamma = \\frac{1}{2}$, and let the observation be $y = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$. The corresponding Toeplitz matrix is\n$$\nH = \\begin{pmatrix}\n1 & 0 \\\\\n\\frac{1}{2} & 1\n\\end{pmatrix}.\n$$\nWe aim to infer the spike train by minimizing the convex objective\n$$\nf(s) = \\frac{1}{2} \\| y - H s \\|_{2}^{2} + \\lambda \\| s \\|_{1},\n$$\nwith the regularization parameter set to $\\lambda = 0.1$. Starting from the initial condition $s^{(0)} = \\begin{pmatrix} 0 & 0 \\end{pmatrix}^{\\top}$, perform one proximal gradient step with a fixed step size $\\eta = \\frac{1}{\\| H \\|^{2}}$, where $\\| H \\|$ denotes the spectral norm of $H$. Compute the updated iterate $s^{(1)}$ exactly. Express your final answer as a single row vector using the LaTeX $\\texttt{pmatrix}$ environment, and do not round; provide the exact closed-form expression.",
            "solution": "The calcium imaging model uses linear convolution to map spikes $s$ to fluorescence $y$ via the Toeplitz operator $H$ derived from the Autoregressive of order $1$ (AR($1$)) impulse response. The spike inference objective is\n$$\nf(s) = g(s) + h(s),\n$$\nwhere the smooth data-fit term is\n$$\ng(s) = \\frac{1}{2} \\| y - H s \\|_{2}^{2},\n$$\nand the nonsmooth regularization is\n$$\nh(s) = \\lambda \\| s \\|_{1}.\n$$\nThe proximal gradient method applies the iteration\n$$\ns^{(k+1)} = \\operatorname{prox}_{\\eta h}\\!\\left(s^{(k)} - \\eta \\nabla g(s^{(k)})\\right),\n$$\nwith $\\eta$ chosen so that it is no larger than the inverse of the Lipschitz constant of $\\nabla g$, which for a quadratic $g$ equals the squared spectral norm of $H$, i.e., $\\| H \\|^{2}$. Here it is specified that $\\eta = \\frac{1}{\\| H \\|^{2}}$.\n\nFirst, compute the gradient of the smooth part. Since\n$$\ng(s) = \\frac{1}{2} \\| y - H s \\|_{2}^{2},\n$$\nthe gradient is\n$$\n\\nabla g(s) = H^{\\top} (H s - y).\n$$\nWith $s^{(0)} = \\begin{pmatrix} 0 & 0 \\end{pmatrix}^{\\top}$, we have\n$$\n\\nabla g(s^{(0)}) = H^{\\top} (H s^{(0)} - y) = H^{\\top} (0 - y) = - H^{\\top} y.\n$$\nTherefore, the forward (gradient) step is\n$$\ns^{(0)} - \\eta \\nabla g(s^{(0)}) = 0 - \\eta (- H^{\\top} y) = \\eta H^{\\top} y.\n$$\n\nNext, compute $H^{\\top} y$ explicitly. Given\n$$\nH = \\begin{pmatrix}\n1 & 0 \\\\\n\\frac{1}{2} & 1\n\\end{pmatrix},\n\\quad\nH^{\\top} = \\begin{pmatrix}\n1 & \\frac{1}{2} \\\\\n0 & 1\n\\end{pmatrix},\n\\quad\ny = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix},\n$$\nwe obtain\n$$\nH^{\\top} y = \\begin{pmatrix}\n1 & \\frac{1}{2} \\\\\n0 & 1\n\\end{pmatrix}\n\\begin{pmatrix}\n1 \\\\ 0\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1 \\\\ 0\n\\end{pmatrix}.\n$$\nThus,\n$$\ns^{(0)} - \\eta \\nabla g(s^{(0)}) = \\eta \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}.\n$$\n\nNow compute the step size $\\eta = \\frac{1}{\\| H \\|^{2}}$. The squared spectral norm satisfies\n$$\n\\| H \\|^{2} = \\lambda_{\\max}\\!\\left(H^{\\top} H\\right),\n$$\nwhere $\\lambda_{\\max}(\\cdot)$ denotes the largest eigenvalue. Compute\n$$\nH^{\\top} H\n=\n\\begin{pmatrix}\n1 & \\frac{1}{2} \\\\\n0 & 1\n\\end{pmatrix}\n\\begin{pmatrix}\n1 & 0 \\\\\n\\frac{1}{2} & 1\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1 + \\left(\\frac{1}{2}\\right)^{2} & \\frac{1}{2} \\\\\n\\frac{1}{2} & 1\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{5}{4} & \\frac{1}{2} \\\\\n\\frac{1}{2} & 1\n\\end{pmatrix}.\n$$\nThe characteristic polynomial of $H^{\\top} H$ is\n$$\n\\det\\!\\left(\n\\begin{pmatrix}\n\\frac{5}{4} & \\frac{1}{2} \\\\\n\\frac{1}{2} & 1\n\\end{pmatrix}\n-\n\\lambda\n\\begin{pmatrix}\n1 & 0 \\\\\n0 & 1\n\\end{pmatrix}\n\\right)\n=\n\\left(\\frac{5}{4} - \\lambda\\right)\\left(1 - \\lambda\\right) - \\left(\\frac{1}{2}\\right)^{2}\n=\n\\lambda^{2} - \\frac{9}{4} \\lambda + 1.\n$$\nSolving $\\lambda^{2} - \\frac{9}{4}\\lambda + 1 = 0$ gives\n$$\n\\lambda = \\frac{1}{8}\\left(9 \\pm \\sqrt{17}\\right),\n$$\nso\n$$\n\\lambda_{\\max}\\!\\left(H^{\\top} H\\right) = \\frac{1}{8}\\left(9 + \\sqrt{17}\\right),\n\\quad\n\\eta = \\frac{1}{\\| H \\|^{2}} = \\frac{1}{\\lambda_{\\max}(H^{\\top} H)} = \\frac{8}{9 + \\sqrt{17}}.\n$$\n\nThe proximal operator of the scaled $\\ell_{1}$ norm is separable and given by element-wise soft-thresholding. For a vector $v$ and threshold $\\tau > 0$,\n$$\n\\operatorname{prox}_{\\tau \\| \\cdot \\|_{1}}(v) = S_{\\tau}(v),\n$$\nwhere\n$$\n\\left[S_{\\tau}(v)\\right]_{i} = \\operatorname{sign}(v_{i}) \\max\\!\\left(|v_{i}| - \\tau, 0\\right).\n$$\nIn our case, the argument to the proximal operator is $v = \\eta H^{\\top} y = \\begin{pmatrix} \\eta \\\\ 0 \\end{pmatrix}$ and the threshold is $\\tau = \\eta \\lambda = \\frac{8}{9 + \\sqrt{17}} \\cdot 0.1 = \\frac{4}{5(9 + \\sqrt{17})}$. Therefore,\n$$\ns^{(1)} = S_{\\eta \\lambda}\\!\\left(\\eta H^{\\top} y\\right)\n=\n\\begin{pmatrix}\n\\max\\!\\left(\\eta - \\eta \\lambda, 0\\right) \\\\\n\\max\\!\\left(0 - \\eta \\lambda, 0\\right)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\eta (1 - \\lambda) \\\\\n0\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{8}{9 + \\sqrt{17}} \\cdot \\frac{9}{10} \\\\\n0\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{36}{5(9 + \\sqrt{17})} \\\\\n0\n\\end{pmatrix}.\n$$\n\nFinally, express $s^{(1)}$ as a single row vector:\n$$\ns^{(1)} = \\begin{pmatrix} \\frac{36}{5(9 + \\sqrt{17})} & 0 \\end{pmatrix}.\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}\\frac{36}{5\\left(9+\\sqrt{17}\\right)} & 0\\end{pmatrix}}$$"
        }
    ]
}