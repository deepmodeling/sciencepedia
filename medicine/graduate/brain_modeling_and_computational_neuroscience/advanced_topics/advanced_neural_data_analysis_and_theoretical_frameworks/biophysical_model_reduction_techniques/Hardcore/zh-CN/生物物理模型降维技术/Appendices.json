{
    "hands_on_practices": [
        {
            "introduction": "许多生物物理模型的分析复杂性源于其固有的非线性离子电流。一个核心的降维技术是用更易于处理的函数来近似这些非线性项。本练习  将指导您为经典的 FitzHugh-Nagumo 模型构建一个分段线性近似，同时保留控制其兴奋行为的关键几何特征——零斜线的“膝状”形态。通过这个过程，您将亲身体验如何简化模型以进行分析，并量化这种简化在阈值附近的准确性。",
            "id": "3965641",
            "problem": "考虑一个无量纲形式的 FitzHugh–Nagumo (FHN) 型简化二维神经元模型，其膜电压为 $V$，恢复变量为 $w$：\n$$\n\\frac{dV}{dt} = f(V) - w + I, \\quad \\frac{dw}{dt} = a \\left(V + b - c w\\right),\n$$\n其中 $f(V)$ 代表离子电流-电压的非线性关系，$I$ 是外部输入，$a$、$b$、$c$ 是参数，且 $c > 0$。该系统的零斜线定义为时间导数为零的点集：$V$-零斜线为 $w = f(V) + I$，$w$-零斜线为 $w = \\frac{V + b}{c}$。假设离子电流函数为三次函数 $f(V) = V - \\frac{V^{3}}{3}$，使得 $V$-零斜线呈现出典型的三次曲线形状，其拐点（knees）位于 $V = -1$ 和 $V = 1$。\n\n为了便于分析和简化，构建一个 $f(V)$ 的三段分段线性近似 $p(V)$。该近似通过在锚点 $V = -1$、$V = 0$、$V = 1$ 处与 $f(V)$ 匹配，并通过使用额外的锚点 $V=2$ 来固定右侧分支的斜率，从而再现三次零斜线的几何形状。具体来说，要求 $p(V)$ 满足 $p(-1) = f(-1)$、$p(0) = f(0)$、$p(1) = f(1)$，并且在 $V \\geq 1$ 上的右侧分支线段穿过点 $\\left(2, f(2)\\right)$。你可以假设左侧分支具有对称性。\n\n将阈值电流 $I_{T}$ 定义为 $I$ 的一个唯一值，在该值下零斜线在右侧拐点 $V=1$ 处相交，即 $f(1) + I_{T} = \\frac{1 + b}{c}$。考虑在阈值附近对输入施加一个小的扰动 $\\delta I$，$I = I_{T} + \\delta I$，并分析交点的 $V$ 值如何偏离 $V=1$。令 $\\delta V_{\\text{cubic}}$ 表示由精确三次模型预测的主阶偏移量，$\\delta V_{\\text{PWL}}$ 表示由分段线性模型预测的主阶偏移量。使用关于 $V=1$ 和 $I=I_{T}$ 的一阶展开，推导主阶相对误差\n$$\nE(c) = \\frac{\\delta V_{\\text{PWL}} - \\delta V_{\\text{cubic}}}{\\delta V_{\\text{cubic}}},\n$$\n的闭式解析表达式，该表达式仅为 $c$ 的函数。\n\n请以单一闭式表达式的形式提供您的最终答案。不需要进行数值近似或四舍五入。",
            "solution": "用户希望我解决以下问题：\n考虑一个无量纲形式的 FitzHugh–Nagumo (FHN) 型简化二维神经元模型，其膜电压为 $V$，恢复变量为 $w$：\n$$\n\\frac{dV}{dt} = f(V) - w + I, \\quad \\frac{dw}{dt} = a \\left(V + b - c w\\right),\n$$\n其中 $f(V)$ 代表离子电流-电压的非线性关系，$I$ 是外部输入，$a$、$b$、$c$ 是参数，且 $c > 0$。该系统的零斜线定义为时间导数为零的点集：$V$-零斜线为 $w = f(V) + I$，$w$-零斜线为 $w = \\frac{V + b}{c}$。假设离子电流函数为三次函数 $f(V) = V - \\frac{V^{3}}{3}$，使得 $V$-零斜线呈现出典型的三次曲线形状，其拐点（knees）位于 $V = -1$ 和 $V = 1$。\n\n为了便于分析和简化，构建一个 $f(V)$ 的三段分段线性近似 $p(V)$。该近似通过在锚点 $V = -1$、$V = 0$、$V = 1$ 处与 $f(V)$ 匹配，并通过使用额外的锚点 $V=2$ 来固定右侧分支的斜率，从而再现三次零斜线的几何形状。具体来说，要求 $p(V)$ 满足 $p(-1) = f(-1)$、$p(0) = f(0)$、$p(1) = f(1)$，并且在 $V \\geq 1$ 上的右侧分支线段穿过点 $\\left(2, f(2)\\right)$。你可以假设左侧分支具有对称性。\n\n将阈值电流 $I_{T}$ 定义为 $I$ 的一个唯一值，在该值下零斜线在右侧拐点 $V=1$ 处相交，即 $f(1) + I_{T} = \\frac{1 + b}{c}$。考虑在阈值附近对输入施加一个小的扰动 $\\delta I$，$I = I_{T} + \\delta I$，并分析交点的 $V$ 值如何偏离 $V=1$。令 $\\delta V_{\\text{cubic}}$ 表示由精确三次模型预测的主阶偏移量，$\\delta V_{\\text{PWL}}$ 表示由分段线性模型预测的主阶偏移量。使用关于 $V=1$ 和 $I=I_{T}$ 的一阶展开，推导主阶相对误差\n$$\nE(c) = \\frac{\\delta V_{\\text{PWL}} - \\delta V_{\\text{cubic}}}{\\delta V_{\\text{cubic}}},\n$$\n的闭式解析表达式，该表达式仅为 $c$ 的函数。\n\n请以单一闭式表达式的形式提供您的最终答案。不需要进行数值近似或四舍五入。\n\n### 第一步：提取已知条件\n-   系统方程：$\\frac{dV}{dt} = f(V) - w + I$, $\\frac{dw}{dt} = a(V + b - c w)$\n-   三次非线性项：$f(V) = V - \\frac{V^3}{3}$\n-   参数：$a, b, c$，且 $c>0$\n-   $V$-零斜线：$w = f(V) + I$\n-   $w$-零斜线：$w = \\frac{V+b}{c}$\n-   分段线性近似 $p(V)$ 的约束条件：\n    -   $p(-1) = f(-1)$\n    -   $p(0) = f(0)$\n    -   $p(1) = f(1)$\n    -   $V \\geq 1$ 的线段通过点 $(2, f(2))$。\n    -   左侧分支对称。\n-   阈值电流 $I_T$：由 $f(1) + I_T = \\frac{1+b}{c}$ 定义\n-   扰动：$I = I_T + \\delta I$\n-   三次模型的交点偏移：$\\delta V_{\\text{cubic}}$\n-   分段线性模型的交点偏移：$\\delta V_{\\text{PWL}}$\n-   目标表达式：$E(c) = \\frac{\\delta V_{\\text{PWL}} - \\delta V_{\\text{cubic}}}{\\delta V_{\\text{cubic}}}$\n\n### 第二步：使用提取的已知条件进行验证\n该问题具有科学依据，植根于计算神经科学的基石——FitzHugh-Nagumo 神经元模型的标准分析。使用分段线性近似是一种常见的模型简化技术。该问题是适定的（well-posed），为推导一个特定量提供了一套清晰明确的数学指令。所有必要的定义和约束条件都已给出，使问题本身是自洽的。语言客观、正式。问题结构合理，要求基于一阶微扰分析进行推导，这是一阶微扰分析是应用数学和物理学中的标准技术。不存在矛盾、不切实际的假设或逻辑缺陷。因此，该问题被认定为有效。\n\n### 第三步：结论与行动\n问题有效。我将继续进行求解。\n\n零斜线的交点由方程 $g(V) + I = \\frac{V+b}{c}$ 决定，其中 $g(V)$ 可以是三次函数 $f(V)$ 或其分段线性近似 $p(V)$。我们可以将其写成一个隐函数 $H(V, I) = 0$，其中 $H(V, I) = g(V) + I - \\frac{V+b}{c}$。\n\n我们关心的是，当电流 $I$ 从 $I=I_T$ 发生微小变化 $\\delta I$ 时，交点 $V$ 从 $V=1$ 的偏移。这可以通过在点 $(V,I) = (1, I_T)$ 周围对 $H(V, I)$ 进行一阶展开来找到。\n$$ H(1+\\delta V, I_T+\\delta I) \\approx H(1, I_T) + \\frac{\\partial H}{\\partial V}\\bigg|_{(1,I_T)} \\delta V + \\frac{\\partial H}{\\partial I}\\bigg|_{(1,I_T)} \\delta I = 0 $$\n根据定义，$H(1, I_T) = 0$。偏导数为：\n$$ \\frac{\\partial H}{\\partial V} = g'(V) - \\frac{1}{c} \\quad \\text{与} \\quad \\frac{\\partial H}{\\partial I} = 1 $$\n在 $V=1$ 处求值并代入展开式，得到：\n$$ \\left(g'(1) - \\frac{1}{c}\\right) \\delta V + \\delta I \\approx 0 $$\n这为主阶偏移 $\\delta V$ 提供了一个通用公式：\n$$ \\delta V \\approx \\frac{-\\delta I}{g'(1) - \\frac{1}{c}} = \\frac{\\delta I}{\\frac{1}{c} - g'(1)} $$\n现在我们将此公式应用于三次模型和分段线性模型。\n\n**1. 三次模型的偏移 ($\\delta V_{\\text{cubic}}$)**\n对于三次模型，$g(V) = f(V) = V - \\frac{V^3}{3}$。其导数为：\n$$ f'(V) = \\frac{d}{dV}\\left(V - \\frac{V^3}{3}\\right) = 1 - V^2 $$\n在右侧拐点 $V=1$ 处，斜率为：\n$$ f'(1) = 1 - 1^2 = 0 $$\n将 $g'(1) = f'(1) = 0$ 代入通用偏移公式：\n$$ \\delta V_{\\text{cubic}} \\approx \\frac{\\delta I}{\\frac{1}{c} - 0} = c \\, \\delta I $$\n\n**2. 分段线性模型的偏移 ($\\delta V_{\\text{PWL}}$)**\n对于分段线性模型，我们需要 $V>1$ 时 $p(V)$ 的斜率。题目规定，$V \\geq 1$ 上的 $p(V)$ 线段是一条经过点 $(1, p(1))$ 和 $(2, f(2))$ 的直线。\n首先，我们计算这些点的坐标。由于 $p(V)$ 必须在锚点处与 $f(V)$ 匹配：\n$$ p(1) = f(1) = 1 - \\frac{1^3}{3} = \\frac{2}{3} $$\n第二个点是：\n$$ f(2) = 2 - \\frac{2^3}{3} = 2 - \\frac{8}{3} = -\\frac{2}{3} $$\n对于 $V \\geq 1$ 的线段斜率是连接点 $(1, 2/3)$ 和 $(2, -2/3)$ 的斜率。对于导致 $V>1$ 的小扰动，相关斜率取在 $V=1$ 的右侧，我们记为 $p'(1_+)$。\n$$ p'(1_+) = \\frac{f(2) - p(1)}{2 - 1} = \\frac{-2/3 - 2/3}{1} = -\\frac{4}{3} $$\n现在我们将 $g'(1) = p'(1_+) = -4/3$ 代入通用偏移公式：\n$$ \\delta V_{\\text{PWL}} \\approx \\frac{\\delta I}{\\frac{1}{c} - \\left(-\\frac{4}{3}\\right)} = \\frac{\\delta I}{\\frac{1}{c} + \\frac{4}{3}} $$\n化简分母：\n$$ \\frac{1}{c} + \\frac{4}{3} = \\frac{3 + 4c}{3c} $$\n所以，偏移量是：\n$$ \\delta V_{\\text{PWL}} \\approx \\frac{\\delta I}{\\frac{3 + 4c}{3c}} = \\frac{3c}{3 + 4c} \\delta I $$\n\n**3. 相对误差 $E(c)$**\n相对误差定义为 $E(c) = \\frac{\\delta V_{\\text{PWL}} - \\delta V_{\\text{cubic}}}{\\delta V_{\\text{cubic}}}$。这可以改写为：\n$$ E(c) = \\frac{\\delta V_{\\text{PWL}}}{\\delta V_{\\text{cubic}}} - 1 $$\n代入主阶偏移的表达式：\n$$ E(c) = \\frac{\\frac{3c}{3 + 4c} \\delta I}{c \\, \\delta I} - 1 $$\n项 $\\delta I$ 和 $c$（对于 $c \\neq 0$）可以消去：\n$$ E(c) = \\frac{3}{3 + 4c} - 1 $$\n为了得到一个单一的分数，我们通分：\n$$ E(c) = \\frac{3 - (3 + 4c)}{3 + 4c} = \\frac{3 - 3 - 4c}{3 + 4c} = \\frac{-4c}{3 + 4c} $$\n这就是作为 $c$ 的函数的主阶相对误差的最终闭式表达式。",
            "answer": "$$\\boxed{\\frac{-4c}{3 + 4c}}$$"
        },
        {
            "introduction": "简化模型的实用性在很大程度上取决于其参数是否能与可测量的生物物理属性相关联。本练习  聚焦于这一关键的校准步骤，要求您为一个带有适应性的整合发放（integrate-and-fire）模型推导出一个参数设置规则。您将学习如何通过分析推导，将模型中代表尖峰后适应电流的抽象参数 $b$ 与神经元可观测到的不应期联系起来，从而使抽象模型能更忠实地反映真实神经元的行为。",
            "id": "3965661",
            "problem": "给定一个单室神经元的膜方程的生物物理学简化模型，该模型具有脉冲触发的适应性。其基本动力学遵循带有欧姆泄漏和辅助适应性电流的膜的电容定律。状态变量为膜电位 $V(t)$ 和适应性电流 $w(t)$。带有脉冲触发适应性的漏积分放电（LIF）模型由以下微分方程定义\n$$\nC \\frac{dV}{dt} = - g_L \\big(V(t) - E_L \\big) - w(t) + I(t),\n$$\n$$\n\\tau_w \\frac{dw}{dt} = - w(t), \\quad \\text{用于阈下演化，}\n$$\n以及脉冲/重置规则\n$$\n\\text{若 } V(t^-) \\ge V_{\\mathrm{th}}, \\quad \\text{则 } V(t^+) \\leftarrow V_r, \\quad w(t^+) \\leftarrow w(t^-) + b,\n$$\n其中 $C$ 是膜电容，$g_L$ 是泄漏电导，$E_L$ 是泄漏反转电位，$I(t)$ 是输入电流，$\\tau_w$ 是适应性时间常数，$V_{\\mathrm{th}}$ 是阈值电压，$V_r$ 是重置电压，而 $b$ 是适应性电流中由脉冲触发的跳变。重置规则将脉冲触发的类钾电流的生物物理进入过程建模为辅助变量的跳变。\n\n从电容定律和线性阈下动力学出发，推导出一个 $b$ 的显式校准公式。在该校准下，对于恒定输入 $I(t) = I_0$，在 $t=0$ 时刻发生脉冲/重置（$V(0) = V_r$ 且 $w(0) = w_0^+$）后，到达下一次阈值穿越的时间恰好等于一个预设的绝对不应期 $T_{\\mathrm{ref}}$。假设在脉冲之间，适应性电流遵循给定的指数衰减，并且唯一的脉冲触发效应是跳变 $b$，因此如果脉冲前的残余适应性为零，则有 $w_0^+ = b$。展示如何根据 $V(T_{\\mathrm{ref}}) = V_{\\mathrm{th}}$ 的要求计算 $b$，并处理 $\\tau_w = \\tau_m$ 的特殊情况，其中 $\\tau_m = C/g_L$ 是膜时间常数。\n\n您的程序必须实现从第一性原理推导出的闭式校准规则，并将其应用于以下测试套件。请精确使用指定的物理单位：\n- 电容 $C$ 单位为 $\\mathrm{F}$。\n- 电导 $g_L$ 单位为 $\\mathrm{S}$。\n- 电压 $E_L$, $V_{\\mathrm{th}}$, $V_r$ 单位为 $\\mathrm{V}$。\n- 电流 $I_0$ 和脉冲触发的跳变 $b$ 单位为 $\\mathrm{A}$。\n- 时间常数 $\\tau_w$, $\\tau_m$ 和绝对不应期 $T_{\\mathrm{ref}}$ 单位为 $\\mathrm{s}$。\n\n如果校准公式得出的 $b$ 为负值，则将 $b$ 设置为 $0$，因为在此背景下，负的脉冲触发适应性跳变在生物物理上是不合理的。此问题不涉及角度。将 $b$ 的最终答案表示为以安培为单位的浮点数。\n\n推导基础和约束：\n- 从电容定律和线性泄漏电流定义开始。\n- 将 $w(t)$ 视为具有脉冲触发跳变和指数衰减的辅助电流。\n- 除了这些基本原理外，不要假设或使用任何目标公式。\n\n对于恒定输入 $I(t) = I_0$，考虑重置后的阈下解，并计算使 $V(T_{\\mathrm{ref}}) = V_{\\mathrm{th}}$ 成立的 $b$ 值。处理一般情况 $\\tau_w \\ne \\tau_m$ 和极限情况 $\\tau_w = \\tau_m$。\n\n测试套件参数集（每个项目符号定义一种情况）：\n- 情况 A（一般情况，正校准）：$C = 2\\times 10^{-10}\\,\\mathrm{F}$，$g_L = 1\\times 10^{-8}\\,\\mathrm{S}$，$E_L = -7.0\\times 10^{-2}\\,\\mathrm{V}$，$V_{\\mathrm{th}} = -5.0\\times 10^{-2}\\,\\mathrm{V}$，$V_r = -6.5\\times 10^{-2}\\,\\mathrm{V}$，$I_0 = 1.0\\times 10^{-9}\\,\\mathrm{A}$，$\\tau_w = 5.0\\times 10^{-2}\\,\\mathrm{s}$，$T_{\\mathrm{ref}} = 5.0\\times 10^{-3}\\,\\mathrm{s}$。\n- 情况 B（边界情况，时间常数相等）：$C = 2\\times 10^{-10}\\,\\mathrm{F}$，$g_L = 1\\times 10^{-8}\\,\\mathrm{S}$，$E_L = -7.0\\times 10^{-2}\\,\\mathrm{V}$，$V_{\\mathrm{th}} = -5.0\\times 10^{-2}\\,\\mathrm{V}$，$V_r = -6.5\\times 10^{-2}\\,\\mathrm{V}$，$I_0 = 1.2\\times 10^{-9}\\,\\mathrm{A}$，$\\tau_w = 2.0\\times 10^{-2}\\,\\mathrm{s}$，$T_{\\mathrm{ref}} = 5.0\\times 10^{-3}\\,\\mathrm{s}$。\n- 情况 C（边缘情况，钳制为零）：$C = 2\\times 10^{-10}\\,\\mathrm{F}$，$g_L = 1\\times 10^{-8}\\,\\mathrm{S}$，$E_L = -7.0\\times 10^{-2}\\,\\mathrm{V}$，$V_{\\mathrm{th}} = -5.0\\times 10^{-2}\\,\\mathrm{V}$，$V_r = -6.5\\times 10^{-2}\\,\\mathrm{V}$，$I_0 = 4.0\\times 10^{-10}\\,\\mathrm{A}$，$\\tau_w = 5.0\\times 10^{-2}\\,\\mathrm{s}$，$T_{\\mathrm{ref}} = 5.0\\times 10^{-3}\\,\\mathrm{s}$。\n- 情况 D（一般情况，慢适应）：$C = 2\\times 10^{-10}\\,\\mathrm{F}$，$g_L = 1\\times 10^{-8}\\,\\mathrm{S}$，$E_L = -7.0\\times 10^{-2}\\,\\mathrm{V}$，$V_{\\mathrm{th}} = -5.0\\times 10^{-2}\\,\\mathrm{V}$，$V_r = -6.5\\times 10^{-2}\\,\\mathrm{V}$，$I_0 = 9.0\\times 10^{-10}\\,\\mathrm{A}$，$\\tau_w = 5.0\\times 10^{-1}\\,\\mathrm{s}$，$T_{\\mathrm{ref}} = 5.0\\times 10^{-3}\\,\\mathrm{s}$。\n\n您的程序应生成一行输出，其中包含四种情况下校准的脉冲触发适应性跳变 $b$（以安培为单位），格式为方括号括起来的逗号分隔列表（例如，$\\big[$$b_A$$,$$b_B$$,$$b_C$$,$$b_D$$\\big]$）。这些值必须是浮点数，单位为 $\\mathrm{A}$，输出字符串中不显示单位。",
            "solution": "该问题是有效的，因为它基于已建立的生物物理建模原理，问题设定良好，具有完整且一致的参数集，并以客观、可形式化的语言表述。我们将继续推导脉冲触发适应性跳变 $b$ 的闭式校准。\n\n目标是找到适应性跳变参数 $b$ 的值，使得在脉冲后经过指定时间 $T_{\\mathrm{ref}}$ 时，膜电位 $V(t)$ 达到阈值 $V_{\\mathrm{th}}$。神经元的状态由两个耦合的常微分方程描述，分别对应膜电位 $V(t)$ 和适应性电流 $w(t)$。\n\n对于阈下动力学，控制方程为：\n$$\nC \\frac{dV}{dt} = - g_L \\big(V(t) - E_L \\big) - w(t) + I_0\n$$\n$$\n\\tau_w \\frac{dw}{dt} = - w(t)\n$$\n问题规定，在 $t=0$ 时刻的脉冲之后，状态立即重置为 $V(0) = V_r$ 和 $w(0) = w(0^-) + b$。我们需要在假设脉冲前残余适应性为零（即 $w(0^-) = 0$）的情况下校准 $b$。因此，脉冲间期内适应性电流的初始条件为 $w(0) = b$。\n\n首先，我们求解适应性电流 $w(t)$ 的微分方程，初始条件为 $w(0)=b$。这是一个一阶线性齐次常微分方程，其解是一个直接的指数衰减函数：\n$$\nw(t) = b \\, e^{-t/\\tau_w}\n$$\n接下来，我们将 $w(t)$ 的表达式代入膜电位 $V(t)$ 的方程中：\n$$\nC \\frac{dV}{dt} = - g_L (V(t) - E_L) - b \\, e^{-t/\\tau_w} + I_0\n$$\n为了标准化这个方程，我们两边同除以泄漏电导 $g_L$，并引入膜时间常数 $\\tau_m = C/g_L$。\n$$\n\\frac{C}{g_L} \\frac{dV}{dt} = - (V(t) - E_L) - \\frac{b}{g_L} e^{-t/\\tau_w} + \\frac{I_0}{g_L}\n$$\n$$\n\\tau_m \\frac{dV}{dt} + V(t) = E_L + \\frac{I_0}{g_L} - \\frac{b}{g_L} e^{-t/\\tau_w}\n$$\n这是一个关于 $V(t)$ 的一阶线性非齐次常微分方程。其解取决于膜时间常数 $\\tau_m$ 是否等于适应性时间常数 $\\tau_w$。我们必须考虑两种情况。让我们将在没有适应性情况下的稳态电压定义为 $V_\\infty = E_L + I_0/g_L$。方程变为：\n$$\n\\frac{dV}{dt} + \\frac{1}{\\tau_m}V(t) = \\frac{V_\\infty}{\\tau_m} - \\frac{b}{C} e^{-t/\\tau_w}\n$$\n\n**情况 1：一般情况 ($\\tau_w \\ne \\tau_m$)**\n我们使用积分因子 $I(t) = e^{\\int (1/\\tau_m) dt} = e^{t/\\tau_m}$ 求解该常微分方程。解为：\n$$\nV(t)e^{t/\\tau_m} = \\int \\left( \\frac{V_\\infty}{\\tau_m} - \\frac{b}{C} e^{-t/\\tau_w} \\right) e^{t/\\tau_m} dt + K\n$$\n$$\nV(t)e^{t/\\tau_m} = \\frac{V_\\infty}{\\tau_m} \\int e^{t/\\tau_m} dt - \\frac{b}{C} \\int e^{t(1/\\tau_m - 1/\\tau_w)} dt + K\n$$\n$$\nV(t)e^{t/\\tau_m} = V_\\infty e^{t/\\tau_m} - \\frac{b}{C} \\frac{1}{1/\\tau_m - 1/\\tau_w} e^{t(1/\\tau_m - 1/\\tau_w)} + K\n$$\n两边乘以 $e^{-t/\\tau_m}$ 得到 $V(t)$ 的通解：\n$$\nV(t) = V_\\infty - \\frac{b}{C} \\frac{\\tau_m \\tau_w}{\\tau_w - \\tau_m} e^{-t/\\tau_w} + K e^{-t/\\tau_m}\n$$\n我们使用初始条件 $V(0) = V_r$ 来求积分常数 $K$：\n$$\nV_r = V_\\infty - \\frac{b}{C} \\frac{\\tau_m \\tau_w}{\\tau_w - \\tau_m} + K \\implies K = V_r - V_\\infty + \\frac{b}{C} \\frac{\\tau_m \\tau_w}{\\tau_w - \\tau_m}\n$$\n将 $K$ 代回并整理各项：\n$$\nV(t) = V_\\infty + (V_r - V_\\infty)e^{-t/\\tau_m} - \\frac{b}{C} \\frac{\\tau_m \\tau_w}{\\tau_w - \\tau_m} (e^{-t/\\tau_w} - e^{-t/\\tau_m})\n$$\n使用 $\\tau_m/C = (C/g_L)/C = 1/g_L$，这可以写成：\n$$\nV(t) = V_\\infty + (V_r - V_\\infty)e^{-t/\\tau_m} - \\frac{b \\tau_w}{g_L(\\tau_w - \\tau_m)} (e^{-t/\\tau_w} - e^{-t/\\tau_m})\n$$\n为了求 $b$，我们施加条件 $V(T_{\\mathrm{ref}}) = V_{\\mathrm{th}}$：\n$$\nV_{\\mathrm{th}} = V_\\infty + (V_r - V_\\infty)e^{-T_{\\mathrm{ref}}/\\tau_m} - \\frac{b \\tau_w}{g_L(\\tau_w - \\tau_m)} (e^{-T_{\\mathrm{ref}}/\\tau_w} - e^{-T_{\\mathrm{ref}}/\\tau_m})\n$$\n令 $V_{\\mathrm{no-adapt}}(t) = V_\\infty + (V_r - V_\\infty)e^{-t/\\tau_m}$ 为无适应性（$b=0$）时的电压轨迹。整理方程求解 $b$：\n$$\n\\frac{b \\tau_w}{g_L(\\tau_w - \\tau_m)} (e^{-T_{\\mathrm{ref}}/\\tau_w} - e^{-T_{\\mathrm{ref}}/\\tau_m}) = V_{\\mathrm{no-adapt}}(T_{\\mathrm{ref}}) - V_{\\mathrm{th}}\n$$\n$$\nb = \\frac{g_L(\\tau_w - \\tau_m)}{\\tau_w(e^{-T_{\\mathrm{ref}}/\\tau_w} - e^{-T_{\\mathrm{ref}}/\\tau_m})} \\Big[ V_\\infty(1 - e^{-T_{\\mathrm{ref}}/\\tau_m}) + V_r e^{-T_{\\mathrm{ref}}/\\tau_m} - V_{\\mathrm{th}} \\Big]\n$$\n\n**情况 2：特殊情况 ($\\tau_w = \\tau_m = \\tau$)**\n当时间常数相等时，$V(t)$ 的常微分方程表现出共振：\n$$\n\\frac{dV}{dt} + \\frac{1}{\\tau}V(t) = \\frac{V_\\infty}{\\tau} - \\frac{b}{C} e^{-t/\\tau}\n$$\n使用积分因子 $e^{t/\\tau}$：\n$$\nV(t)e^{t/\\tau} = \\int \\left( \\frac{V_\\infty}{\\tau} - \\frac{b}{C} e^{-t/\\tau} \\right) e^{t/\\tau} dt + K\n$$\n$$\nV(t)e^{t/\\tau} = \\int \\frac{V_\\infty}{\\tau} e^{t/\\tau} dt - \\int \\frac{b}{C} dt + K\n$$\n$$\nV(t)e^{t/\\tau} = V_\\infty e^{t/\\tau} - \\frac{b}{C}t + K\n$$\n$V(t)$ 的通解为：\n$$\nV(t) = V_\\infty - \\frac{b t}{C} e^{-t/\\tau} + K e^{-t/\\tau}\n$$\n使用初始条件 $V(0) = V_r$：\n$$\nV_r = V_\\infty + K \\implies K = V_r - V_\\infty\n$$\n将 $K$ 代回：\n$$\nV(t) = V_\\infty + (V_r - V_\\infty)e^{-t/\\tau} - \\frac{b t}{C}e^{-t/\\tau}\n$$\n我们施加条件 $V(T_{\\mathrm{ref}}) = V_{\\mathrm{th}}$：\n$$\nV_{\\mathrm{th}} = V_\\infty + (V_r - V_\\infty)e^{-T_{\\mathrm{ref}}/\\tau} - \\frac{b T_{\\mathrm{ref}}}{C}e^{-T_{\\mathrm{ref}}/\\tau}\n$$\n整理方程求解 $b$：\n$$\n\\frac{b T_{\\mathrm{ref}}}{C}e^{-T_{\\mathrm{ref}}/\\tau} = V_\\infty + (V_r - V_\\infty)e^{-T_{\\mathrm{ref}}/\\tau} - V_{\\mathrm{th}}\n$$\n$$\nb = \\frac{C}{T_{\\mathrm{ref}}e^{-T_{\\mathrm{ref}}/\\tau}} \\Big[ V_\\infty(1 - e^{-T_{\\mathrm{ref}}/\\tau}) + V_r e^{-T_{\\mathrm{ref}}/\\tau} - V_{\\mathrm{th}} \\Big]\n$$\n\n**最终校准规则**\n校准流程如下：\n1.  计算膜时间常数 $\\tau_m = C/g_L$ 和稳态电压 $V_\\infty = E_L + I_0/g_L$。\n2.  计算在没有适应性的情况下，$T_{\\mathrm{ref}}$ 时刻的电压：$V_{\\mathrm{no-adapt}}(T_{\\mathrm{ref}}) = V_\\infty(1 - e^{-T_{\\mathrm{ref}}/\\tau_m}) + V_r e^{-T_{\\mathrm{ref}}/\\tau_m}$。\n3.  计算所需的电压抑制量：$\\Delta V = V_{\\mathrm{no-adapt}}(T_{\\mathrm{ref}}) - V_{\\mathrm{th}}$。如果 $\\Delta V \\le 0$，则不需要适应性，因此 $b = 0$。\n4.  如果 $\\Delta V > 0$，计算 $b$：\n    - 如果 $\\tau_w \\ne \\tau_m$： \n      $$ b = \\frac{g_L(\\tau_w - \\tau_m)}{\\tau_w(e^{-T_{\\mathrm{ref}}/\\tau_w} - e^{-T_{\\mathrm{ref}}/\\tau_m})} \\Delta V $$\n    - 如果 $\\tau_w = \\tau_m = \\tau$：\n      $$ b = \\frac{C}{T_{\\mathrm{ref}}e^{-T_{\\mathrm{ref}}/\\tau}} \\Delta V $$\n5.  根据问题陈述，由于在此背景下负的 $b$ 值在生物物理上是不合理的，因此 $b$ 的最终值被钳制在零：$b_{\\mathrm{final}} = \\max(0, b)$。这与步骤 3 一致，因为 $b$ 表达式中的前置因子是正的。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the spike-triggered adaptation jump 'b' for a set of test cases\n    based on a leaky integrate-and-fire model with adaptation.\n    \"\"\"\n\n    # Test suite parameter sets.\n    # (C, g_L, E_L, V_th, V_r, I_0, tau_w, T_ref)\n    # Units: F, S, V, V, V, A, s, s\n    test_cases = [\n        # Case A: Generic, positive calibration\n        (2e-10, 1e-8, -7.0e-2, -5.0e-2, -6.5e-2, 1.0e-9, 5.0e-2, 5.0e-3),\n        # Case B: Boundary, equal time constants\n        (2e-10, 1e-8, -7.0e-2, -5.0e-2, -6.5e-2, 1.2e-9, 2.0e-2, 5.0e-3),\n        # Case C: Edge, clamped to zero\n        (2e-10, 1e-8, -7.0e-2, -5.0e-2, -6.5e-2, 4.0e-10, 5.0e-2, 5.0e-3),\n        # Case D: Generic, slow adaptation\n        (2e-10, 1e-8, -7.0e-2, -5.0e-2, -6.5e-2, 9.0e-10, 5.0e-1, 5.0e-3),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        C, g_L, E_L, V_th, V_r, I_0, tau_w, T_ref = case\n\n        # Calculate membrane time constant and steady-state voltage\n        tau_m = C / g_L\n        V_inf = E_L + I_0 / g_L\n\n        # Calculate voltage at T_ref without adaptation (b=0)\n        V_no_adapt_T_ref = V_inf + (V_r - V_inf) * np.exp(-T_ref / tau_m)\n\n        # Calculate the required voltage suppression by the adaptation current\n        delta_V = V_no_adapt_T_ref - V_th\n\n        # If the unadapted voltage is already below threshold, no adaptation is needed.\n        if delta_V <= 0:\n            b = 0.0\n        else:\n            # Check for the special case where time constants are equal\n            # using a small tolerance for floating-point comparison.\n            if abs(tau_w - tau_m) < 1e-9:\n                # Case tau_w = tau_m = tau\n                tau = tau_m\n                prefactor_numerator = C\n                prefactor_denominator = T_ref * np.exp(-T_ref / tau)\n                b = (prefactor_numerator / prefactor_denominator) * delta_V\n            else:\n                # Generic case tau_w != tau_m\n                prefactor_numerator = g_L * (tau_w - tau_m)\n                exp_term_w = np.exp(-T_ref / tau_w)\n                exp_term_m = np.exp(-T_ref / tau_m)\n                prefactor_denominator = tau_w * (exp_term_w - exp_term_m)\n                \n                # Check for division by zero, although handled by the tau_w vs tau_m check\n                if abs(prefactor_denominator) < 1e-15:\n                    # Fallback to the limit case logic, this shouldn't be hit with the tolerance.\n                    tau = tau_m\n                    b = (C / (T_ref * np.exp(-T_ref / tau))) * delta_V\n                else:\n                    b = (prefactor_numerator / prefactor_denominator) * delta_V\n        \n        # Clamp b at 0 as per problem specification for biophysical plausibility.\n        final_b = max(0.0, b)\n        results.append(final_b)\n\n    # Format the output as a comma-separated list in brackets.\n    output_str = f\"[{','.join(f'{r:.12e}' for r in results)}]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "当处理具有空间延伸性的系统（如树突）时，模型的维度会急剧增加，使得直接模拟和分析变得非常困难。本练习  介绍了一种强大的、基于数据的降维方法——本征正交分解（Proper Orthogonal Decomposition, POD）。您将通过一个完整的计算流程，从生成高维树突模型的仿真数据快照，到使用奇异值分解（SVD）提取主导动态模态，最终构建并评估一个低维的“投影”模型。这个实践是现代计算神经科学中处理高维系统降维问题的基石。",
            "id": "3965680",
            "problem": "考虑一个一维被动树突电缆，其被建模为一个具有密封末端边界的线性时不变空间离散化系统。从线性被动电缆方程和标准的有限差分空间离散化出发，隔室电压的状态向量 $v(t) \\in \\mathbb{R}^n$ 满足常微分方程 (ODE) $dv/dt = A v(t) + B u(t)$，其中 $A \\in \\mathbb{R}^{n \\times n}$ 是从漏泄和轴向耦合导出的系统矩阵，$B \\in \\mathbb{R}^{n \\times p}$ 将 $p$ 个注入点的输入电流映射到隔室，而 $u(t) \\in \\mathbb{R}^p$ 是时变输入电流向量。具有 Neumann 边界条件的密封末端拉普拉斯算子由三对角矩阵 $L \\in \\mathbb{R}^{n \\times n}$ 定义，其元素为 $L_{0,0} = -1$，$L_{0,1} = 1$，对于 $i \\in \\{1,\\dots,n-2\\}$，$L_{i,i} = -2$，$L_{i,i-1} = 1$，$L_{i,i+1} = 1$，以及 $L_{n-1,n-2} = 1$，$L_{n-1,n-1} = -1$。系统矩阵为 $A = -\\alpha I_n + \\beta L$，其中 $I_n$ 是 $n \\times n$ 单位矩阵，漏泄参数 $\\alpha > 0$，轴向耦合参数 $\\beta > 0$。输入映射 $B$ 的列是对应于注入点的标准基向量。输入库由在 $p$ 个注入通道上的 $m$ 个时间局域化高斯脉冲组成。对于库索引 $\\ell \\in \\{1,\\dots,m\\}$、通道索引 $j \\in \\{1,\\dots,p\\}$、时间网格 $t_k = k \\,\\Delta t$（其中 $k \\in \\{0,1,\\dots,K-1\\}$ 且 $K = \\lfloor T/\\Delta t \\rfloor$）、脉冲振幅 $a_{\\ell,j} = 0.3 + 0.7 \\,\\lvert \\sin(0.37 \\ell + 0.91 j) \\rvert$、中心时间 $\\tau_{\\ell,j} = 0.1 T + 0.7 T \\, \\frac{\\ell}{m+1} + 0.05 T \\, \\frac{j}{p+1}$ 以及宽度 $\\sigma > 0$，将输入定义为 $u_j^{(\\ell)}(t_k) = a_{\\ell,j} \\exp\\!\\left(-\\frac{1}{2}\\left(\\frac{t_k - \\tau_{\\ell,j}}{\\sigma}\\right)^2\\right)$。使用显式 Euler 格式进行时间步进：$v_{k+1} = v_k + \\Delta t \\left( A v_k + B u^{(\\ell)}(t_k) \\right)$，其中 $v_0 = 0$。\n\n您必须根据对整个输入库的树突电压响应的快照矩阵构建 Proper Orthogonal Decomposition (POD)，并推导 Galerkin 降阶模型。具体而言：\n\n- 通过拼接所有库输入 $\\ell$ 和时间 $k$ 的所有时间状态 $v_k^{(\\ell)}$，形成快照矩阵 $S \\in \\mathbb{R}^{n \\times L}$，其中 $L = m K$。\n- 计算奇异值分解 (SVD)，$S = U \\Sigma V^\\top$，其中 $U \\in \\mathbb{R}^{n \\times r_{\\max}}$ 是标准正交的，$\\Sigma$ 中包含奇异值，$V \\in \\mathbb{R}^{L \\times r_{\\max}}$ 是标准正交的，且 $r_{\\max} = \\min(n,L)$。\n- 给定一个能量阈值 $\\eta \\in (0,1)$，选择最小的 $r$，使得 $\\sum_{i=1}^r \\sigma_i^2 / \\sum_{i=1}^{r_{\\max}} \\sigma_i^2 \\ge \\eta$，其中 $\\sigma_i$ 是奇异值（$\\Sigma$ 的对角元素）。\n- 通过前 $r$ 个左奇异向量 $U_r \\in \\mathbb{R}^{n \\times r}$ 定义降阶模型 (ROM) 子空间。构建 Galerkin 投影矩阵 $A_r = U_r^\\top A U_r \\in \\mathbb{R}^{r \\times r}$ 和 $B_r = U_r^\\top B \\in \\mathbb{R}^{r \\times p}$。\n- 通过两个度量来估计截断误差：忽略的能量分数 $E_{\\text{loss}} = 1 - \\frac{\\sum_{i=1}^r \\sigma_i^2}{\\sum_{i=1}^{r_{\\max}} \\sigma_i^2}$ 和相对投影残差 $\\varepsilon_{\\text{proj}} = \\frac{\\lVert S - U_r U_r^\\top S \\rVert_F}{\\lVert S \\rVert_F}$，其中 $\\lVert \\cdot \\rVert_F$ 表示 Frobenius 范数。\n- 此外，通过对库中的每个输入模拟降阶动力学 $x_{k+1} = x_k + \\Delta t \\left( A_r x_k + B_r u^{(\\ell)}(t_k) \\right)$（其中 $x_0 = 0$），重构 $\\hat{v}_k^{(\\ell)} = U_r x_k$，并计算动态重构误差 $\\varepsilon_{\\text{rom}} = \\frac{\\sqrt{\\sum_{\\ell=1}^m \\sum_{k=0}^{K-1} \\lVert v_k^{(\\ell)} - \\hat{v}_k^{(\\ell)} \\rVert_2^2}}{\\sqrt{\\sum_{\\ell=1}^m \\sum_{k=0}^{K-1} \\lVert v_k^{(\\ell)} \\rVert_2^2}}$。\n\n在此公式中，所有量都是无量纲的；不要报告任何物理单位。三角函数内的角度以弧度为单位。最终输出必须是数值。\n\n您的程序必须实现上述流程并解决以下测试套件。对于每个测试，使用给定的参数构建 $A$ 和 $B$，生成输入库和快照，计算 POD，推导 Galerkin ROM，并评估 $r$、$E_{\\text{loss}}$、$\\varepsilon_{\\text{proj}}$ 和 $\\varepsilon_{\\text{rom}}$。\n\n测试套件（每个测试用例是一个指定 $(n, \\Delta t, T, \\alpha, \\beta, \\text{注入索引}, m, \\sigma, \\eta)$ 的元组）：\n\n- 测试 1：$(20, 0.0005, 0.12, 1.0, 12.0, [0, 19], 5, 0.01, 0.95)$。\n- 测试 2：$(30, 0.0010, 0.20, 0.5, 8.0, [0, 14, 29], 4, 0.015, 0.99)$。\n- 测试 3：$(15, 0.0005, 0.05, 2.0, 20.0, [7], 3, 0.005, 0.90)$。\n- 测试 4：$(25, 0.0020, 0.20, 0.2, 2.0, [7, 17], 6, 0.02, 0.50)$。\n\n您的程序应生成单行输出，其中包含所有测试的结果，格式为一个用方括号括起来的逗号分隔列表，其中每个测试结果都是一个遵循此确切顺序的内部列表 $[r, E_{\\text{loss}}, \\varepsilon_{\\text{proj}}, \\varepsilon_{\\text{rom}}]$。例如，输出格式必须为 $[[r_1,E_{\\text{loss},1},\\varepsilon_{\\text{proj},1},\\varepsilon_{\\text{rom},1}],[r_2,E_{\\text{loss},2},\\varepsilon_{\\text{proj},2},\\varepsilon_{\\text{rom},2}],\\dots]$，不含任何额外文本。",
            "solution": "该问题要求为一个线性时不变 (LTI) 系统，具体来说是一个被动树突电缆的离散化模型，实现一个标准的模型降阶流程。该流程涉及 Proper Orthogonal Decomposition (POD) 和 Galerkin 投影。目标是从模拟数据构建一个降阶模型 (ROM)，并使用几个已定义的度量来评估其准确性。\n\n验证过程确认了该问题具有科学依据、是适定且客观的。它描述了模型降阶在计算神经科学中的一个标准应用，提供了所有必要的定义、参数和评估标准。不存在矛盾、歧义或科学缺陷。因此，我们着手解决该问题。\n\n解决方案分五个顺序步骤进行开发：\n1.  **全阶模型 (FOM) 公式化和数据生成**：我们首先构建 FOM，它是一个描述隔室电压动力学的线性常微分方程 (ODE) 系统。\n2.  **Proper Orthogonal Decomposition (POD)**：我们使用模拟数据为系统动力学寻找一个最优的低维基。\n3.  **降阶模型 (ROM) 构建**：我们通过将 FOM 投影到低维 POD 基上创建 ROM。\n4.  **ROM 模拟和状态重构**：我们模拟计算成本更低的 ROM。\n5.  **误差评估**：我们通过将 ROM 与 FOM 进行比较来量化其准确性。\n\n### 1. 全阶模型 (FOM) 公式化和数据生成\n系统的状态由向量 $v(t) \\in \\mathbb{R}^n$ 给出，代表 $n$ 个离散隔室中的电压。其动力学由 LTI 系统控制：\n$$\n\\frac{dv}{dt} = A v(t) + B u(t)\n$$\n系统矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 定义为 $A = -\\alpha I_n + \\beta L$，其中 $\\alpha > 0$ 是漏泄参数，$\\beta > 0$ 是轴向耦合参数，$I_n$ 是 $n \\times n$ 单位矩阵，$L \\in \\mathbb{R}^{n \\times n}$ 是具有密封末端 (Neumann) 边界条件的一维电缆的离散拉普拉斯矩阵。矩阵 $L$ 是一个对称三对角矩阵，其元素为：\n-   对于 $i \\in \\{1, \\dots, n-2\\}$，$L_{i,i} = -2$，且 $L_{0,0} = L_{n-1,n-1} = -1$。\n-   对于 $i \\in \\{0, \\dots, n-2\\}$，$L_{i, i+1} = L_{i+1, i} = 1$。\n-   所有其他元素均为 $0$。\n\n输入矩阵 $B \\in \\mathbb{R}^{n \\times p}$ 将 $p$ 个外部输入电流映射到它们各自的注入隔室。其列是标准基向量，如果第 $j$ 个输入通道注入到第 $i$ 个隔室，则 $(B)_{ij} = 1$，否则为 $0$。\n\n输入库由 $m$ 个不同的刺激组成。每个刺激是一组 $p$ 个时变高斯电流脉冲。对于第 $\\ell$ 个库输入 ($\\ell \\in \\{1,\\dots,m\\}$) 和第 $j$ 个通道 ($j \\in \\{1,\\dots,p\\}$)，在离散时间网格 $t_k = k \\Delta t$ 上的输入电流为：\n$$\nu_j^{(\\ell)}(t_k) = a_{\\ell,j} \\exp\\left(-\\frac{1}{2}\\left(\\frac{t_k - \\tau_{\\ell,j}}{\\sigma}\\right)^2\\right)\n$$\n其振幅为 $a_{\\ell,j} = 0.3 + 0.7 |\\sin(0.37 \\ell + 0.91 j)|$，中心时间为 $\\tau_{\\ell,j} = 0.1 T + 0.7 T \\frac{\\ell}{m+1} + 0.05 T \\frac{j}{p+1}$。\n\n从初始条件 $v(0) = 0$ 开始，我们使用时间步长为 $\\Delta t$ 的显式 Euler 方法为 $m$ 个库输入中的每一个模拟 FOM：\n$$\nv_{k+1}^{(\\ell)} = v_k^{(\\ell)} + \\Delta t \\left( A v_k^{(\\ell)} + B u^{(\\ell)}(t_k) \\right)\n$$\n对于 $k = 0, 1, \\dots, K-1$，其中 $K = \\lfloor T/\\Delta t \\rfloor$。收集所有 $\\ell \\in \\{1, \\dots, m\\}$ 的生成状态向量 $v_1^{(\\ell)}, v_2^{(\\ell)}, \\dots, v_K^{(\\ell)}$。这些被称为快照的向量被按列拼接，形成快照矩阵 $S \\in \\mathbb{R}^{n \\times L}$，其中 $L = mK$。\n\n### 2. Proper Orthogonal Decomposition (POD)\nPOD 的核心是找到一个能最优表示 $S$ 中快照的正交基。这通过计算快照矩阵的奇异值分解 (SVD) 来实现：\n$$\nS = U \\Sigma V^\\top\n$$\n其中 $U \\in \\mathbb{R}^{n \\times r_{\\max}}$ 具有标准正交列（左奇异向量或 POD 模态），$\\Sigma \\in \\mathbb{R}^{r_{\\max} \\times r_{\\max}}$ 是一个包含按降序排列的非负奇异值 $\\sigma_i$ 的对角矩阵，$V \\in \\mathbb{R}^{L \\times r_{\\max}}$ 具有标准正交列，并且 $r_{\\max} = \\min(n, L)$。$U$ 的列构成了 POD 基。\n\n每个模态的“能量”与其对应奇异值的平方 $\\sigma_i^2$ 成正比。为了创建一个低维近似，我们选择前 $r$ 个模态，这些模态捕获了总能量的特定比例 $\\eta$。降阶阶数 $r$ 是满足以下条件的最小整数：\n$$\n\\frac{\\sum_{i=1}^r \\sigma_i^2}{\\sum_{i=1}^{r_{\\max}} \\sigma_i^2} \\ge \\eta\n$$\n\n### 3. 降阶模型 (ROM) 构建\nFOM 状态 $v(t)$ 由前 $r$ 个 POD 模态的线性组合来近似：$v(t) \\approx U_r x(t)$，其中 $U_r \\in \\mathbb{R}^{n \\times r}$ 包含 $U$ 的前 $r$ 列，$x(t) \\in \\mathbb{R}^r$ 是降阶状态坐标的向量。\n\n将此近似代入 FOM 方程，并应用 Galerkin 投影（通过左乘 $U_r^\\top$ 将方程投影到由 $U_r$ 张成的子空间上），即可得到 ROM：\n$$\n\\frac{dx}{dt} = (U_r^\\top A U_r) x(t) + (U_r^\\top B) u(t)\n$$\n这给出了降阶系统动力学 $dx/dt = A_r x(t) + B_r u(t)$，其矩阵 $A_r = U_r^\\top A U_r \\in \\mathbb{R}^{r \\times r}$ 和 $B_r = U_r^\\top B \\in \\mathbb{R}^{r \\times p}$ 的维度要小得多。\n\n### 4. ROM 模拟和状态重构\n使用相同的显式 Euler 格式模拟降阶动力学，初始条件为 $x_0 = U_r^\\top v_0 = 0$：\n$$\nx_{k+1} = x_k + \\Delta t (A_r x_k + B_r u^{(\\ell)}(t_k))\n$$\n对于每个时间步，可以通过从降阶状态重构来近似全维状态：$\\hat{v}_{k+1}^{(\\ell)} = U_r x_{k+1}$。\n\n### 5. 误差评估\n使用三个度量来评估降阶的准确性：\n1.  **忽略的能量分数 ($E_{\\text{loss}}$)**：这衡量了原始快照中未被所选 $r$ 个模态捕获的能量（方差）的分数。\n    $$\n    E_{\\text{loss}} = 1 - \\frac{\\sum_{i=1}^r \\sigma_i^2}{\\sum_{i=1}^{r_{\\max}} \\sigma_i^2}\n    $$\n2.  **相对投影残差 ($\\varepsilon_{\\text{proj}}$)**：这量化了将原始快照投影到 POD 子空间然后重构它们的误差。它被定义为 $\\varepsilon_{\\text{proj}} = \\frac{\\lVert S - U_r U_r^\\top S \\rVert_F}{\\lVert S \\rVert_F}$，其中 $\\lVert \\cdot \\rVert_F$ 是 Frobenius 范数。利用 SVD 的性质，这可以简化为：\n    $$\n    \\varepsilon_{\\text{proj}} = \\sqrt{\\frac{\\sum_{i=r+1}^{r_{\\max}} \\sigma_i^2}{\\sum_{i=1}^{r_{\\max}} \\sigma_i^2}} = \\sqrt{E_{\\text{loss}}}\n    $$\n3.  **动态重构误差 ($\\varepsilon_{\\text{rom}}$)**：这是最全面的度量，衡量了真实 FOM 轨迹与通过模拟 ROM 生成的轨迹之间的归一化均方根误差。它是在所有库输入和所有时间步上计算的。\n    $$\n    \\varepsilon_{\\text{rom}} = \\frac{\\sqrt{\\sum_{\\ell=1}^m \\sum_{k=1}^{K} \\lVert v_k^{(\\ell)} - \\hat{v}_k^{(\\ell)} \\rVert_2^2}}{\\sqrt{\\sum_{\\ell=1}^m \\sum_{k=1}^{K} \\lVert v_k^{(\\ell)} \\rVert_2^2}}\n    $$\n    该度量直接评估了 ROM 的动力学对 FOM 动力学的近似程度。\n\n现在，实现将针对每个提供的测试用例遵循这些步骤。",
            "answer": "```python\nimport numpy as np\n\ndef run_case(n, dt, T, alpha, beta, inj_indices, m, sigma, eta):\n    \"\"\"\n    Runs a single test case for the POD-Galerkin model reduction.\n    \"\"\"\n    # 1. Setup and Model Construction\n    p = len(inj_indices)\n    K = int(T / dt)\n    time_grid = np.arange(K) * dt\n\n    # Construct Laplacian matrix L for sealed-end (Neumann) BCs\n    L = np.diag(np.ones(n - 1), 1) + np.diag(np.ones(n - 1), -1) - 2 * np.eye(n)\n    L[0, 0] = -1.0\n    L[n - 1, n - 1] = -1.0\n    \n    # Construct full-order system matrices A and B\n    A = -alpha * np.eye(n) + beta * L\n    B = np.zeros((n, p))\n    for j_idx, i_comp in enumerate(inj_indices):\n        B[i_comp, j_idx] = 1.0\n\n    # 2. Generate Input Library and Snapshots from FOM\n    fom_trajectories = []\n    snapshot_list = []\n\n    for l_idx in range(m):\n        ell = l_idx + 1\n        \n        # Generate input signal u(t) for this library entry\n        u_input = np.zeros((K, p))\n        for j_idx in range(p):\n            j = j_idx + 1\n            a_lj = 0.3 + 0.7 * np.abs(np.sin(0.37 * ell + 0.91 * j))\n            tau_lj = 0.1 * T + 0.7 * T * (ell / (m + 1)) + 0.05 * T * (j / (p + 1))\n            u_input[:, j_idx] = a_lj * np.exp(-0.5 * ((time_grid - tau_lj) / sigma)**2)\n\n        # Simulate FOM using Explicit Euler\n        v = np.zeros(n)\n        current_trajectory = []\n        for k in range(K):\n            u_k = u_input[k, :]\n            v = v + dt * (A @ v + B @ u_k)\n            snapshot_list.append(v)\n            current_trajectory.append(v)\n        fom_trajectories.append(np.array(current_trajectory))\n\n    S = np.array(snapshot_list).T\n    \n    # 3. Perform SVD and Determine Reduced Order r\n    U, s, Vh = np.linalg.svd(S, full_matrices=False)\n    s_sq = s**2\n    total_energy = np.sum(s_sq)\n    \n    r = 0\n    if total_energy > 0:\n        cum_energy_frac = np.cumsum(s_sq) / total_energy\n        # Find smallest r such that cumulative energy >= eta\n        r = np.searchsorted(cum_energy_frac, eta, side='left') + 1\n    else: # Handle zero snapshot matrix case\n        r = 1\n\n    # 4. Calculate Static Error Metrics\n    energy_at_r = np.sum(s_sq[:r])\n    E_loss = 1.0 - energy_at_r / total_energy if total_energy > 0 else 1.0\n    eps_proj = np.sqrt(E_loss)\n\n    # 5. Construct and Simulate ROM\n    Ur = U[:, :r]\n    Ar = Ur.T @ A @ Ur\n    Br = Ur.T @ B\n    \n    sum_sq_err = 0.0\n    sum_sq_norm_v = 0.0\n\n    for l_idx in range(m):\n        ell = l_idx + 1\n        v_fom_traj = fom_trajectories[l_idx]\n        \n        u_input = np.zeros((K, p))\n        for j_idx in range(p):\n            j = j_idx + 1\n            a_lj = 0.3 + 0.7 * np.abs(np.sin(0.37 * ell + 0.91 * j))\n            tau_lj = 0.1 * T + 0.7 * T * (ell / (m + 1)) + 0.05 * T * (j / (p + 1))\n            u_input[:, j_idx] = a_lj * np.exp(-0.5 * ((time_grid - tau_lj) / sigma)**2)\n            \n        x = np.zeros(r)\n        \n        for k in range(K):\n            # Simulate ROM for one step\n            u_k = u_input[k, :]\n            x = x + dt * (Ar @ x + Br @ u_k)\n            # Reconstruct full state from ROM state\n            v_hat = Ur @ x\n            \n            # Get corresponding FOM state\n            v_fom = v_fom_traj[k]\n            \n            # Accumulate errors\n            sum_sq_err += np.sum((v_fom - v_hat)**2)\n            sum_sq_norm_v += np.sum(v_fom**2)\n\n    # 6. Calculate Dynamical Reconstruction Error\n    eps_rom = np.sqrt(sum_sq_err / sum_sq_norm_v) if sum_sq_norm_v > 0 else 0.0\n    \n    return [int(r), E_loss, eps_proj, eps_rom]\n\ndef solve():\n    # Test suite from the problem statement\n    test_cases = [\n        (20, 0.0005, 0.12, 1.0, 12.0, [0, 19], 5, 0.01, 0.95),\n        (30, 0.0010, 0.20, 0.5, 8.0, [0, 14, 29], 4, 0.015, 0.99),\n        (15, 0.0005, 0.05, 2.0, 20.0, [7], 3, 0.005, 0.90),\n        (25, 0.0020, 0.20, 0.2, 2.0, [7, 17], 6, 0.02, 0.50),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_case(*case)\n        results.append(result)\n\n    # Format the output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}