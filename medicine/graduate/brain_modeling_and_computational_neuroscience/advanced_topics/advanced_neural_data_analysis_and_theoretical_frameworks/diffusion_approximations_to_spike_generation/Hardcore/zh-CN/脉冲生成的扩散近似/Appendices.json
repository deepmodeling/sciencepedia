{
    "hands_on_practices": [
        {
            "introduction": "在随机动态的世界里，神经元发放尖峰可以被看作是一个粒子克服能量壁垒的逃逸过程。本练习将运用物理学中经典的克拉默斯速率理论 (Kramers’ rate theory)，推导在阈值附近，尖峰发放的瞬时风险（或称“风险函数”）如何依赖于膜电位，从而揭示指数整合发放 (EIF) 模型中关键参数的物理来源。这项实践将理论物理学的概念与神经元模型的构建联系起来，加深对尖峰生成随机性的理解 。",
            "id": "3975121",
            "problem": "考虑一个一维过阻尼随机描述，用于模拟突触轰击下的膜电位动力学，其模型为伊藤（Itō）随机微分方程\n$$\n\\mathrm{d}V(t) \\;=\\; -\\partial_{V}U(V)\\,\\mathrm{d}t \\;+\\; \\sqrt{2D}\\,\\mathrm{d}W_t,\n$$\n其中 $V$ 是膜电位，$U(V)$ 是一个有效势，编码了确定性的跨膜电流，$D0$ 是由突触噪声引起的有效扩散强度，$W_t$ 是一个标准维纳过程。假设锋电位发放可以被视为从一个位于阈下电位的亚稳态势阱，在电压 $V_{\\mathrm{th}}$ 处越过一个势垒的逃逸过程，并定义状态依赖的风险率 $h(V)$ 为在膜电位为 $V$ 的条件下，从该势阱的吸引盆中逃逸的瞬时速率。\n\n在小噪声情形下，越垒速率由一维过阻尼动力学的克莱默斯（Kramers）速率理论所支配，其中速率的主导指数依赖性受势垒高度控制。在刚好低于 $V_{\\mathrm{th}}$ 的一个狭窄电压邻域内，假设从当前状态 $V$ 测量的势垒高度允许以下线性近似\n$$\n\\Delta U(V) \\;\\equiv\\; U(V_{\\mathrm{b}}) - U(V) \\;\\approx\\; \\alpha\\bigl(V_{\\mathrm{th}} - V\\bigr),\n$$\n其中 $\\alpha0$ 是一个由有效势的局部斜率决定的常数，$V_{\\mathrm{b}}$ 是势垒顶部的电压。此外，假设克莱默斯指前因子在该邻域内随 $V$ 变化缓慢，并且可以被视为一个常数 $h_00$。\n\n利用这些假设，推导风险率 $h(V)$ 的主导阶电压依赖关系，并确定控制此依赖关系的特征指数标度。用一个包含 $D$ 和 $\\alpha$ 的单一闭式表达式给出特征标度的最终答案。最终答案的单位应与 $V$ 的电压单位相同。无需进行数值计算。",
            "solution": "出发点是过阻尼郎之万方程\n$$\n\\mathrm{d}V(t) \\;=\\; -\\partial_{V}U(V)\\,\\mathrm{d}t \\;+\\; \\sqrt{2D}\\,\\mathrm{d}W_t,\n$$\n在小噪声情形下，该方程允许使用克莱默斯类型的描述来刻画从亚稳态势阱到阈值势垒的逃逸事件。风险率 $h(V)$ 定义为，在当前状态处于势阱吸引盆内电压为 $V$ 的条件下，发生逃逸的瞬时速率。在一维过阻尼动力学的经典克莱默斯框架中，在小噪声极限下，从势阱越过势垒的逃逸速率的主导阶由以下形式的表达式给出\n$$\nh(V) \\;\\approx\\; A(V)\\,\\exp\\!\\left(-\\frac{\\Delta U(V)}{D}\\right),\n$$\n其中 $\\Delta U(V)$ 是从当前状态 $V$ 测量的势垒高度，$A(V)$ 是一个指前因子，它取决于势阱和势垒附近势的局部曲率以及摩擦系数。在当前的假设下，摩擦已被吸收到单位中，因此 $D$ 扮演了有效温度的角色，并且 $A(V)$ 随 $V$ 变化缓慢。\n\n我们关注指数依赖关系，在适当单位下的小噪声极限 $D \\ll 1$ 中，该关系占主导地位。在阈值附近，势垒高度近似为\n$$\n\\Delta U(V) \\;\\approx\\; \\alpha\\bigl(V_{\\mathrm{th}} - V\\bigr),\n$$\n其中 $\\alpha0$ 表征了势垒顶部与当前状态之间有效势差的局部斜率。将此线性近似代入克莱默斯速率公式，得到\n$$\nh(V) \\;\\approx\\; A(V)\\,\\exp\\!\\left(-\\frac{\\alpha(V_{\\mathrm{th}} - V)}{D}\\right).\n$$\n如果 $A(V)$ 在所考虑的狭窄阈下邻域内随 $V$ 变化缓慢，我们可以用在 $V=V_{\\mathrm{th}}$ （此处势垒消失）处求得的常数 $h_0$ 来代替它，即，\n$$\nh(V) \\;\\approx\\; h_0\\,\\exp\\!\\left(-\\frac{\\alpha(V_{\\mathrm{th}} - V)}{D}\\right).\n$$\n重写指数部分，我们得到指数形式的风险率\n$$\nh(V) \\;\\approx\\; h_0\\,\\exp\\!\\left(\\frac{V - V_{\\mathrm{th}}}{\\Delta}\\right),\n$$\n其中特征指数标度 $\\Delta$ 的定义使得\n$$\n\\frac{1}{\\Delta} \\;=\\; \\frac{\\alpha}{D}.\n$$\n因此，\n$$\n\\Delta \\;=\\; \\frac{D}{\\alpha}.\n$$\n\n更一般地，如果势垒高度表示为 $\\Delta U(V)$ 而不限定于线性近似常数 $\\alpha$，同样的推理可得\n$$\n\\Delta \\;=\\; \\left.\\frac{D}{\\partial_{V}\\Delta U(V)}\\right|_{V=V_{\\mathrm{th}}},\n$$\n前提是 $\\partial_{V}\\Delta U(V)$ 在阈值电压处求值且为正。在 $\\Delta U(V) \\approx \\alpha(V_{\\mathrm{th}} - V)$ 的特殊情况下，我们有 $\\partial_{V}\\Delta U(V) = -\\alpha$，斜率的绝对值以 $\\alpha0$ 的形式进入，得到相同的 $\\Delta = D/\\alpha$，它设定了决定风险率在阈值附近随 $V$ 增长速度的电压标度。\n\n因此，在小噪声克莱默斯情形下，控制状态依赖风险率对膜电位指数敏感性的特征标度 $\\Delta$ 是扩散强度与势垒高度相对于电压的局部斜率之比。",
            "answer": "$$\\boxed{\\frac{D}{\\alpha}}$$"
        },
        {
            "introduction": "在将尖峰发放理解为逃逸过程之后，一个自然而然的问题是：逃逸事件具体发生在何时？本练习旨在通过推导首渡时间 (First-Passage Time, FPT) 的概率密度来精确刻画尖峰发放的时刻分布。我们将使用镜像法这一强大的数学工具，为漂移布朗运动这一经典扩散模型求解其FPT密度，并进一步证明，在阈值附近，它能很好地近似更为复杂的 Ornstein-Uhlenbeck 过程的动态 。",
            "id": "3975060",
            "problem": "神经元在吸收性尖峰阈值附近的膜电位可以通过一维扩散来建模。首先考虑具有恒定漂移和扩散系数的漂移布朗运动近似，其由随机微分方程 $dV_{t} = \\mu\\,dt + \\sigma\\,dW_{t}$ 给出，从 $V_{0} = v$（其中 $v  \\theta$）开始，并在 $V = \\theta$ 处有一个吸收边界。令 $p(x,t\\,|\\,v)$ 表示在半直线 $(-\\infty,\\theta)$ 上的转移密度，其吸收边界条件为 $p(\\theta,t\\,|\\,v) = 0$，初始条件为 $p(x,0\\,|\\,v) = \\delta(x - v)$。使用应用于相应 Fokker–Planck 方程的镜像法，推导出到达 $V = \\theta$ 的首次穿越时间密度 $f_{\\mathrm{BM}}(t;\\mu,\\sigma,\\theta,v)$。您的推导必须从 Fokker–Planck 方程开始，并通过构造一个能精确抵消边界值的镜像解来施加吸收边界。\n\n现在考虑 Ornstein–Uhlenbeck (OU) 过程，它为泄漏整合发放神经元提供了一个典型的近阈值模型：\n$$\ndV_{t} = -\\lambda\\left(V_{t} - \\bar{V}\\right)\\,dt + \\sigma\\,dW_{t},\n$$\n其中 $V_{0} = \\theta - \\delta$（$0  \\delta \\ll 1$），吸收阈值同样为 $V = \\theta$，扩散系数也为 $\\sigma$。定义阈值处的局部漂移为 $b_{\\theta} \\equiv -\\lambda\\left(\\theta - \\bar{V}\\right)$。使用近阈值扩散近似，在短时间和微小位移上用常数值 $b_{\\theta}$ 局部替代 OU 漂移，比较 OU 穿越时间密度 $f_{\\mathrm{OU}}(t;\\delta)$ 与漂移布朗运动穿越时间密度 $f_{\\mathrm{BM}}(t;b_{\\theta},\\sigma,\\theta,\\theta-\\delta)$，在渐近标度 $t = s\\,\\delta/|b_{\\theta}|$ 下，其中 $s \\in (0,\\infty)$ 为固定值，而 $\\delta \\to 0$。\n\n计算极限\n$$\n\\lim_{\\delta \\to 0}\\,\\frac{f_{\\mathrm{OU}}\\!\\left(t;\\delta\\right)}{f_{\\mathrm{BM}}\\!\\left(t;b_{\\theta},\\sigma,\\theta,\\theta-\\delta\\right)}\\quad\\text{with}\\quad t = s\\,\\delta/|b_{\\theta}|,\n$$\n并将您的最终答案表示为等于此极限比值的单个常数。最终答案不需要数值四舍五入，也不需要报告物理单位。",
            "solution": "用户要求我解决一个由两部分组成的问题。首先，我需要使用镜像法推导漂移布朗运动的首次穿越时间（FPT）密度。其次，我需要计算一个比值的极限，该比值涉及 Ornstein-Uhlenbeck (OU) 过程的 FPT 密度和先前推导的布朗运动（BM）FPT 密度，计算需在特定的渐近标度下进行。\n\n### 步骤 1：提取已知条件\n\n**第 1 部分：布朗运动 (BM)**\n- 随机过程：一维漂移布朗运动。\n- 随机微分方程 (SDE)：$dV_{t} = \\mu\\,dt + \\sigma\\,dW_{t}$。\n- 初始条件：$V_{0} = v$，其中 $v  \\theta$。\n- 边界条件：在 $V = \\theta$ 处的吸收边界。\n- 转移密度：$p(x,t\\,|\\,v)$。\n- 密度的边界条件：$p(\\theta,t\\,|\\,v) = 0$。\n- 密度的初始条件：$p(x,0\\,|\\,v) = \\delta(x - v)$。\n- 要求的推导方法：应用于 Fokker-Planck 方程的镜像法。\n- 目标量：首次穿越时间密度，$f_{\\mathrm{BM}}(t;\\mu,\\sigma,\\theta,v)$。\n\n**第 2 部分：Ornstein-Uhlenbeck (OU) vs. BM**\n- OU 过程 SDE：$dV_{t} = -\\lambda\\left(V_{t} - \\bar{V}\\right)\\,dt + \\sigma\\,dW_{t}$。\n- OU 初始条件：$V_{0} = \\theta - \\delta$，其中 $0  \\delta \\ll 1$。\n- OU 吸收边界：$V = \\theta$。\n- 定义：阈值处的局部漂移 $b_{\\theta} \\equiv -\\lambda\\left(\\theta - \\bar{V}\\right)$。\n- 用于比较的 BM 过程：漂移为 $\\mu = b_{\\theta}$，扩散为 $\\sigma$，从 $v = \\theta-\\delta$ 开始，阈值为 $\\theta$ 的漂移 BM。\n- OU FPT 密度：$f_{\\mathrm{OU}}(t;\\delta)$。\n- 用于比较的 BM FPT 密度：$f_{\\mathrm{BM}}\\!\\left(t;b_{\\theta},\\sigma,\\theta,\\theta-\\delta\\right)$。\n- 渐近标度：$t = s\\,\\delta/|b_{\\theta}|$，其中 $s \\in (0,\\infty)$ 为固定值且 $\\delta \\to 0$。\n- 目标量：在给定标度下的极限 $\\lim_{\\delta \\to 0}\\,\\frac{f_{\\mathrm{OU}}\\!\\left(t;\\delta\\right)}{f_{\\mathrm{BM}}\\!\\left(t;b_{\\theta},\\sigma,\\theta,\\theta-\\delta\\right)}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n- **科学依据**：该问题牢固地植根于随机过程理论及其在计算神经科学中的应用，特别是对神经尖峰生成的建模。漂移布朗运动和 Ornstein-Uhlenbeck 过程是该领域的经典模型。首次穿越时间的概念对于理解尖峰时间至关重要。该问题具有科学合理性。\n- **适定性**：该问题是适定的。第 1 部分的推导是一个标准练习。第 2 部分的极限用一个明确的标度关系指定，该关系定义了一个精确的渐近状态。预期会有一个唯一且有意义的解。\n- **客观性**：该问题以精确的数学和科学语言陈述，没有主观性或歧义。所需的计算是演绎性的。\n- **完整性**：该问题提供了进行推导和计算所需的所有必要定义和条件。\n\n### 步骤 3：结论和行动\n\n问题是有效的。我将继续进行求解。\n\n### 第 1 部分：布朗运动首次穿越时间密度的推导\n\n过程 $dV_t = \\mu dt + \\sigma dW_t$ 的转移概率密度 $p(x, t | v)$ 的演化由 Fokker-Planck 方程控制：\n$$\n\\frac{\\partial p}{\\partial t} = -\\mu \\frac{\\partial p}{\\partial x} + \\frac{\\sigma^2}{2} \\frac{\\partial^2 p}{\\partial x^2}\n$$\n该问题定义在半直线 $x \\in (-\\infty, \\theta)$ 上，初始条件为 $p(x, 0 | v) = \\delta(x-v)$，吸收边界条件为对所有 $t  0$ 都有 $p(\\theta, t | v) = 0$。\n\n我们使用镜像法。首先，我们考虑无限制过程（自由扩散）的解，这是一个均值随时间线性漂移的高斯分布：\n$$\np_{\\text{free}}(x, t | v) = \\frac{1}{\\sqrt{2\\pi\\sigma^2 t}} \\exp\\left(-\\frac{(x - v - \\mu t)^2}{2\\sigma^2 t}\\right)\n$$\n为了满足在 $x=\\theta$ 处的吸收边界条件，我们引入一个从位置 $v'$ 开始、权重为 $C$ 的“负”镜像源。完整解是真实源和镜像源的叠加：\n$$\np(x, t | v) = p_{\\text{free}}(x, t | v) - C \\cdot p_{\\text{free}}(x, t | v')\n$$\n边界条件 $p(\\theta, t | v) = 0$ 意味着 $p_{\\text{free}}(\\theta, t | v) = C \\cdot p_{\\text{free}}(\\theta, t | v')$。将其写出：\n$$\n\\exp\\left(-\\frac{(\\theta - v - \\mu t)^2}{2\\sigma^2 t}\\right) = C \\exp\\left(-\\frac{(\\theta - v' - \\mu t)^2}{2\\sigma^2 t}\\right)\n$$\n这必须对所有 $t0$ 成立。取自然对数得到：\n$$\n\\ln(C) = \\frac{(\\theta - v' - \\mu t)^2 - (\\theta - v - \\mu t)^2}{2\\sigma^2 t}\n$$\n为了确保 $\\ln(C)$ 是一个不依赖于 $t$ 的常数，我们展开分子：\n$$\n(\\theta - v' - \\mu t)^2 - (\\theta - v - \\mu t)^2 = [(\\theta-v')^2 - (\\theta-v)^2] - 2\\mu t[(\\theta-v') - (\\theta-v)]\n$$\n$\\ln(C)$ 的表达式变为：\n$$\n\\ln(C) = \\frac{(\\theta-v')^2 - (\\theta-v)^2}{2\\sigma^2 t} - \\frac{\\mu(v-v')}{\\sigma^2}\n$$\n为使此为常数，与 $1/t$ 成正比的项必须为零。这要求 $(\\theta-v')^2 = (\\theta-v)^2$。由于我们需要一个不同的镜像源（$v' \\neq v$），我们必须有 $\\theta-v' = -(\\theta-v)$，这意味着 $v' = 2\\theta - v$。\n通过这个 $v'$ 的选择，常数项给出 $\\ln(C)$：\n$$\n\\ln(C) = -\\frac{\\mu(v - (2\\theta-v))}{\\sigma^2} = -\\frac{\\mu(2v - 2\\theta)}{\\sigma^2} = \\frac{2\\mu(\\theta - v)}{\\sigma^2}\n$$\n所以，$C = \\exp\\left(\\frac{2\\mu(\\theta - v)}{\\sigma^2}\\right)$。完整的密度是：\n$$\np(x,t|v) = \\frac{1}{\\sqrt{2\\pi \\sigma^2 t}} \\left[ \\exp\\left(-\\frac{(x - v - \\mu t)^2}{2\\sigma^2 t}\\right) - \\exp\\left(\\frac{2\\mu(\\theta-v)}{\\sigma^2}\\right) \\exp\\left(-\\frac{(x - (2\\theta-v) - \\mu t)^2}{2\\sigma^2 t}\\right) \\right]\n$$\n首次穿越时间密度 $f_{\\mathrm{BM}}(t)$ 是在边界 $x=\\theta$ 处计算的概率通量 $J(x, t)$。通量由下式给出：\n$$\nJ(x, t) = \\mu p(x,t|v) - \\frac{\\sigma^2}{2} \\frac{\\partial p(x,t|v)}{\\partial x}\n$$\n由于 $p(\\theta, t|v) = 0$，FPT 密度为 $f_{\\mathrm{BM}}(t) = J(\\theta,t) = -\\frac{\\sigma^2}{2} \\frac{\\partial p}{\\partial x}\\big|_{x=\\theta}$。\n我们计算空间导数 $\\frac{\\partial p}{\\partial x}$ 并在 $x=\\theta$ 处求值。$p(x,t|v)$ 的导数是：\n$$\n\\frac{\\partial p}{\\partial x} = p_1(x) \\left(-\\frac{x-v-\\mu t}{\\sigma^2 t}\\right) - C \\cdot p_2(x) \\left(-\\frac{x-v'-\\mu t}{\\sigma^2 t}\\right)\n$$\n其中 $p_1$ 和 $p_2$ 分别是从 $v$ 和 $v'$ 出发的自由传播子。在 $x=\\theta$ 处，我们知道 $p_1(\\theta) = C \\cdot p_2(\\theta)$。设这个值为 $P_\\theta(t)$。\n$$\n\\frac{\\partial p}{\\partial x}\\bigg|_{x=\\theta} = P_\\theta(t) \\left[ -\\frac{\\theta-v-\\mu t}{\\sigma^2 t} + \\frac{\\theta-v'-\\mu t}{\\sigma^2 t} \\right]\n$$\n代入 $v' = 2\\theta-v$：\n$$\n\\frac{\\partial p}{\\partial x}\\bigg|_{x=\\theta} = \\frac{P_\\theta(t)}{\\sigma^2 t} \\left[ -(\\theta-v-\\mu t) + (\\theta-(2\\theta-v)-\\mu t) \\right] = \\frac{P_\\theta(t)}{\\sigma^2 t} [ -(\\theta-v) + (-\\theta+v) ] = -\\frac{2(\\theta-v)}{\\sigma^2 t} P_\\theta(t)\n$$\n代入 $P_\\theta(t) = \\frac{1}{\\sqrt{2\\pi\\sigma^2 t}} \\exp\\left(-\\frac{(\\theta - v - \\mu t)^2}{2\\sigma^2 t}\\right)$ 的表达式：\n$$\n\\frac{\\partial p}{\\partial x}\\bigg|_{x=\\theta} = -\\frac{2(\\theta-v)}{\\sigma^2 t \\sqrt{2\\pi\\sigma^2 t}} \\exp\\left(-\\frac{(\\theta - v - \\mu t)^2}{2\\sigma^2 t}\\right)\n$$\n最后，我们得到 FPT 密度：\n$$\nf_{\\mathrm{BM}}(t;\\mu,\\sigma,\\theta,v) = -\\frac{\\sigma^2}{2} \\left( -\\frac{2(\\theta-v)}{ t \\sqrt{2\\pi\\sigma^2 t^3}} \\right) \\exp\\left(-\\frac{(\\theta - v - \\mu t)^2}{2\\sigma^2 t}\\right)\n$$\n$$\nf_{\\mathrm{BM}}(t;\\mu,\\sigma,\\theta,v) = \\frac{\\theta-v}{\\sqrt{2\\pi\\sigma^2 t^3}} \\exp\\left(-\\frac{(\\theta - v - \\mu t)^2}{2\\sigma^2 t}\\right)\n$$\n\n### 第 2 部分：FPT 密度比值的渐近极限\n\n我们需要计算当 $\\delta \\to 0$ 且 $t = s\\delta/|b_\\theta|$ 时，$\\frac{f_{\\mathrm{OU}}(t;\\delta)}{f_{\\mathrm{BM}}(t;b_{\\theta},\\sigma,\\theta,\\theta-\\delta)}$ 的极限。\n首先，我们使用推导出的公式写出分母 $f_{\\mathrm{BM}}$，其参数为 $\\mu = b_\\theta$ 和到阈值的初始距离 $\\theta-v = \\delta$：\n$$\nf_{\\mathrm{BM}}(t; b_{\\theta}, \\sigma, \\theta, \\theta-\\delta) = \\frac{\\delta}{\\sqrt{2\\pi\\sigma^2 t^3}} \\exp\\left(-\\frac{(\\delta - b_\\theta t)^2}{2\\sigma^2 t}\\right)\n$$\n接下来，我们需要一个在指定的渐近状态（$\\delta \\to 0$ 且 $t \\to 0$）下有效的 OU FPT 密度 $f_{\\mathrm{OU}}(t;\\delta)$ 的表达式。对于一个在非常靠近边界处开始的过程，其 FPT 密度可以被一个具有有效恒定漂移的布朗运动的 FPT 密度精确近似。这个有效漂移的一个高度精确的选择是该过程从起点到边界的区间上的漂移平均值。\nOU 过程的漂移是 $m(V) = -\\lambda(V-\\bar{V})$。起点是 $v = \\theta-\\delta$，边界是 $\\theta$。在区间 $[\\theta-\\delta, \\theta]$ 上的平均漂移 $\\mu_{\\text{avg}}$ 是：\n$$\n\\mu_{\\text{avg}} = \\frac{1}{\\theta - (\\theta-\\delta)} \\int_{\\theta-\\delta}^{\\theta} m(V) dV = \\frac{1}{\\delta} \\int_{\\theta-\\delta}^{\\theta} [-\\lambda(V-\\bar{V})] dV\n$$\n$$\n\\mu_{\\text{avg}} = -\\frac{\\lambda}{\\delta} \\left[ \\frac{V^2}{2} - \\bar{V}V \\right]_{\\theta-\\delta}^{\\theta} = -\\frac{\\lambda}{\\delta} \\left[ \\left(\\frac{\\theta^2}{2} - \\bar{V}\\theta\\right) - \\left(\\frac{(\\theta-\\delta)^2}{2} - \\bar{V}(\\theta-\\delta)\\right) \\right]\n$$\n$$\n\\mu_{\\text{avg}} = -\\frac{\\lambda}{\\delta} \\left[ \\frac{\\theta^2 - (\\theta^2 - 2\\theta\\delta + \\delta^2)}{2} - \\bar{V}\\delta \\right] = -\\frac{\\lambda}{\\delta} \\left[ \\theta\\delta - \\frac{\\delta^2}{2} - \\bar{V}\\delta \\right]\n$$\n$$\n\\mu_{\\text{avg}} = -\\lambda\\left(\\theta - \\bar{V} - \\frac{\\delta}{2}\\right) = -\\lambda(\\theta - \\bar{V}) + \\frac{\\lambda\\delta}{2} = b_{\\theta} + \\frac{\\lambda\\delta}{2}\n$$\n因此，对于 $\\delta \\to 0$，$f_{\\mathrm{OU}}(t;\\delta)$ 渐近等价于漂移为 $\\mu_{\\text{avg}}$ 的 BM 的 FPT 密度：\n$$\nf_{\\mathrm{OU}}(t;\\delta) \\sim f_{\\mathrm{BM}}(t; b_{\\theta} + \\lambda\\delta/2, \\sigma, \\theta, \\theta-\\delta) = \\frac{\\delta}{\\sqrt{2\\pi\\sigma^2 t^3}} \\exp\\left(-\\frac{(\\delta - (b_{\\theta} + \\lambda\\delta/2) t)^2}{2\\sigma^2 t}\\right)\n$$\n因此，所求极限是两个具有略微不同漂移的 BM FPT 密度之比的极限：\n$$\n\\lim_{\\delta \\to 0} \\frac{f_{\\mathrm{BM}}(t; b_{\\theta} + \\lambda\\delta/2, \\dots)}{f_{\\mathrm{BM}}(t; b_{\\theta}, \\dots)}\n$$\n密度的比值是：\n$$\n\\frac{\\exp\\left(-\\frac{(\\delta - (b_{\\theta} + \\lambda\\delta/2) t)^2}{2\\sigma^2 t}\\right)}{\\exp\\left(-\\frac{(\\delta - b_{\\theta} t)^2}{2\\sigma^2 t}\\right)} = \\exp\\left( \\frac{(\\delta - b_\\theta t)^2 - (\\delta - (b_{\\theta} + \\lambda\\delta/2) t)^2}{2\\sigma^2 t} \\right)\n$$\n让我们分析指数部分。分子是平方差 $A^2-B^2 = (A-B)(A+B)$：\n$A = \\delta - b_\\theta t$\n$B = \\delta - (b_\\theta + \\lambda\\delta/2)t = \\delta - b_\\theta t - \\frac{\\lambda\\delta}{2}t$\n$A-B = \\frac{\\lambda\\delta}{2}t$\n$A+B = 2(\\delta - b_\\theta t) - \\frac{\\lambda\\delta}{2}t$\n分子是 $(A-B)(A+B) = \\frac{\\lambda\\delta t}{2} \\left( 2\\delta - 2b_\\theta t - \\frac{\\lambda\\delta t}{2} \\right) = \\lambda\\delta^2 t - \\lambda b_\\theta \\delta t^2 - \\frac{\\lambda^2\\delta^2 t^2}{4}$。\n指数是：\n$$\n\\frac{\\lambda\\delta^2 t - \\lambda b_\\theta \\delta t^2 - \\frac{\\lambda^2\\delta^2 t^2}{4}}{2\\sigma^2 t} = \\frac{\\lambda\\delta^2}{2\\sigma^2} - \\frac{\\lambda b_\\theta \\delta t}{2\\sigma^2} - \\frac{\\lambda^2\\delta^2 t}{8\\sigma^2}\n$$\n现在，我们应用标度 $t = s\\delta/|b_\\theta|$。最后一项是 $O(\\delta^3)$ 并且将消失。前两项是：\n$$\n\\frac{\\lambda\\delta^2}{2\\sigma^2} - \\frac{\\lambda b_\\theta \\delta}{2\\sigma^2} \\left( \\frac{s\\delta}{|b_\\theta|} \\right) = \\frac{\\lambda\\delta^2}{2\\sigma^2} - \\frac{\\lambda s \\delta^2}{2\\sigma^2} \\frac{b_\\theta}{|b_\\theta|}\n$$\n项 $\\frac{b_\\theta}{|b_\\theta|}$ 是 $\\mathrm{sgn}(b_\\theta)$，其值为 $+1$ 或 $-1$（假设 $b_\\theta \\neq 0$）。无论哪种情况，整个指数表达式的阶都是 $O(\\delta^2)$。\n当 $\\delta \\to 0$ 时，指数趋近于 $0$。\n因此，比值的极限是 $\\exp(0) = 1$。\n\n$$\n\\lim_{\\delta \\to 0}\\,\\frac{f_{\\mathrm{OU}}\\!\\left(t;\\delta\\right)}{f_{\\mathrm{BM}}\\!\\left(t;b_{\\theta},\\sigma,\\theta,\\theta-\\delta\\right)}\\bigg|_{t = s\\delta/|b_{\\theta}|} = \\lim_{\\delta \\to 0} \\exp\\left( O(\\delta^2) \\right) = \\exp(0) = 1\n$$\n这个结果表明，在指定的标度极限下，其中到阈值的距离和穿越时间都成比例地趋于零，OU 漂移在小区间上的变化是一个高阶效应。因此，OU 过程变得与一个简单的 BM 过程无法区分，后者的漂移在阈值处被近似为常数。",
            "answer": "$$ \\boxed{1} $$"
        },
        {
            "introduction": "理论模型最终需要通过计算机模拟来验证和探索，而模拟的准确性在很大程度上取决于所选择的数值积分方案。本练习将目光投向更符合生物学实际的、具有乘性噪声的电导整合发放模型 (conductance-based LIF)，这种噪声源于离子通道电导的随机波动。你将亲手实现并比较两种主流的随机微分方程数值解法——欧拉-丸山法 (Euler-Maruyama) 和米尔斯坦法 (Milstein)，通过量化它们在预测发放率上的差异，深刻体会为复杂模型选择正确数值工具的重要性 。",
            "id": "3975122",
            "problem": "考虑一个基于电导的漏电积分放电 (LIF) 神经元的标量伊藤随机微分方程 (SDE) 模型，该模型在扩散近似下具有乘性突触噪声。设膜电压用 $V(t)$ 表示（单位：毫伏），静息电位为 $E_L$（单位：毫伏），兴奋性反转电位为 $E_e$（单位：毫伏），抑制性反转电位为 $E_i$（单位：毫伏），阈值为 $V_{\\mathrm{th}}$（单位：毫伏）。膜时间常数为 $\\tau$（单位：毫秒）。兴奋性和抑制性平均电导增益（每毫秒）分别为 $g_e$ 和 $g_i$。扩散强度（每毫秒）为 $D_e$ 和 $D_i$，噪声由单个有效的维纳过程 $W(t)$ 建模，该过程是通过聚合独立的兴奋性和抑制性波动得到的。该 SDE 为：\n$$\n\\mathrm{d}V = a(V)\\,\\mathrm{d}t + b(V)\\,\\mathrm{d}W,\n$$\n其中\n$$\na(V) = -\\frac{V - E_L}{\\tau} + g_e\\,(E_e - V) + g_i\\,(E_i - V),\n$$\n以及\n$$\nb(V) = \\sqrt{2 D_e (E_e - V)^2 + 2 D_i (E_i - V)^2}.\n$$\n当 $V$ 从下方穿过 $V_{\\mathrm{th}}$ 时产生脉冲；发生脉冲后，电压瞬时重置为 $V_r$（单位：毫伏），并继续演化，没有不应期。初始条件为 $V(0) = V_r$。\n\n任务：从上述伊藤 SDE 的基本定义和数值 SDE 积分器的标准离散时间解释出发，推导并实现两种用于此乘性噪声 LIF 模型的数值格式。模拟在持续时间为 $T$ 毫秒的有限时间区间上进行，采用固定的时间步长 $\\Delta t$ 毫秒：\n\n- 欧拉-丸山 (EM) 格式。\n- 用于具有状态依赖扩散的标量伊藤 SDE 的 Milstein 格式。\n\n您的程序必须：\n- 对于每个测试用例，两种格式使用共享的高斯增量序列（即，在给定的测试用例中，相同的 $\\Delta W_n \\sim \\mathcal{N}(0,\\Delta t)$ 应用于 EM 和 Milstein），以便仅隔离由离散化引起的差异。\n- 模拟持续时间为 $T$ 的 LIF 动态，并在每一步结束时检测脉冲：如果一步结束时更新的电压大于或等于 $V_{\\mathrm{th}}$，则记录一个脉冲，并立即重置为 $V_r$ 用于下一步。每步最多计算一个脉冲。\n- 对每种格式，计算其发放频率，即脉冲数除以 $T$（以秒为单位）（即赫兹）。发放频率以 $\\mathrm{Hz}$ 表示，发放频率之间的差异表示为浮点数。\n\n物理和数值参数（电压单位为毫伏，时间单位为毫秒）：\n- $E_L = -65$,\n- $E_e = 0$,\n- $E_i = -75$,\n- $V_{\\mathrm{th}} = -50$,\n- $V_r = -65$,\n- $\\tau = 20$,\n- $g_e = 0.02$,\n- $g_i = 0.02$.\n\n测试套件：对于下面的每个元组 $(\\Delta t, T, \\text{seed}, D_e, D_i)$，运行两种格式，计算发放频率，然后报告定义为 $(\\text{Milstein 发放频率}) - (\\text{欧拉-丸山发放频率})$ 的差异（单位为 $\\mathrm{Hz}$），四舍五入到三位小数。\n- 情况 1：$(0.01, 5000, 123, 0.0005, 0.0002)$,\n- 情况 2：$(0.1, 5000, 456, 0.0005, 0.0002)$,\n- 情况 3：$(0.5, 5000, 789, 0.0005, 0.0002)$,\n- 情况 4（无噪声的边缘情况）：$(0.1, 5000, 999, 0, 0)$。\n\n角度单位不适用。百分比不适用。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序与上述测试用例相同，例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$，其中每个 $\\text{result}_k$ 四舍五入到三位小数，以 $\\mathrm{Hz}$ 表示。",
            "solution": "该问题要求推导并实现两种数值格式——欧拉-丸山 (EM) 格式和 Milstein 格式——以求解一个具有乘性噪声的漏电积分放电 (LIF) 神经元的随机微分方程 (SDE) 模型。目标是比较这两种格式在不同模拟参数下预测的发放频率。\n\n控制膜电压 $V(t)$ 的 SDE 由下式给出：\n$$\n\\mathrm{d}V = a(V)\\,\\mathrm{d}t + b(V)\\,\\mathrm{d}W\n$$\n其中漂移系数 $a(V)$ 和扩散系数 $b(V)$ 分别为：\n$$\na(V) = -\\frac{V - E_L}{\\tau} + g_e\\,(E_e - V) + g_i\\,(E_i - V)\n$$\n$$\nb(V) = \\sqrt{2 D_e (E_e - V)^2 + 2 D_i (E_i - V)^2}\n$$\n我们将首先推导两种数值格式的离散时间更新规则。SDE 的离散时间近似将状态从时间 $t_n$ 更新到 $t_{n+1} = t_n + \\Delta t$，其中时间 $t_n$ 的电压表示为 $V_n$。维纳过程增量 $\\Delta W_n = W(t_{n+1}) - W(t_n)$ 是一个从均值为 $0$、方差为 $\\Delta t$ 的正态分布中抽取的随机变量，即 $\\Delta W_n \\sim \\mathcal{N}(0, \\Delta t)$。这可以写成 $\\Delta W_n = \\sqrt{\\Delta t} Z_n$，其中 $Z_n \\sim \\mathcal{N}(0, 1)$。\n\n**1. 欧拉-丸山 (EM) 格式推导**\n\n欧拉-丸山格式是确定性前向欧拉方法到 SDE 最直接的扩展。它通过近似 SDE 的积分形式推导得出：\n$$\nV(t_{n+1}) = V(t_n) + \\int_{t_n}^{t_{n+1}} a(V(s))\\,\\mathrm{d}s + \\int_{t_n}^{t_{n+1}} b(V(s))\\,\\mathrm{d}W(s)\n$$\n该近似假设系数 $a(V)$ 和 $b(V)$ 在区间 $[t_n, t_{n+1}]$ 上是常数，且等于它们在区间开始时的值 $V_n$。这得出了更新规则：\n$$\nV_{n+1} = V_n + a(V_n)\\Delta t + b(V_n)\\Delta W_n\n$$\n代入给定的 $a(V)$ 和 $b(V)$ 表达式：\n$$\nV_{n+1} = V_n + \\left(-\\frac{V_n - E_L}{\\tau} + g_e\\,(E_e - V_n) + g_i\\,(E_i - V_n)\\right)\\Delta t + \\sqrt{2 D_e (E_e - V_n)^2 + 2 D_i (E_i - V_n)^2} \\Delta W_n\n$$\n这是 EM 格式的更新规则。\n\n**2. Milstein 格式推导**\n\n对于具有状态依赖扩散（乘性噪声）的 SDE，Milstein 格式通过引入一个来自伊藤-泰勒展开的高阶项来改进 EM 格式。对于标量 SDE，通用的 Milstein 格式为：\n$$\nV_{n+1} = V_n + a(V_n)\\Delta t + b(V_n)\\Delta W_n + \\frac{1}{2} b(V_n) b'(V_n) \\left( (\\Delta W_n)^2 - \\Delta t \\right)\n$$\n其中 $b'(V) = \\frac{\\mathrm{d}b}{\\mathrm{d}V}$。最后一项是“Milstein 修正项”。为了应用此格式，我们必须计算 $b(V)$ 的导数。直接计算乘积 $b(V)b'(V)$ 在数值上更稳定，在分析上也更方便。让我们从 $b(V)^2$ 开始：\n$$\nb(V)^2 = 2 D_e (E_e - V)^2 + 2 D_i (E_i - V)^2\n$$\n使用链式法则对两边关于 $V$ 求导，得到：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}V} [b(V)^2] = 2 b(V) b'(V)\n$$\n对右侧表达式求导：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}V} \\left[ 2 D_e (E_e - V)^2 + 2 D_i (E_i - V)^2 \\right] = 2 D_e \\cdot 2(E_e - V)(-1) + 2 D_i \\cdot 2(E_i - V)(-1)\n$$\n$$\n= -4 D_e (E_e - V) - 4 D_i (E_i - V) = -4 [D_e (E_e - V) + D_i (E_i - V)]\n$$\n令两个导数表达式相等，我们发现：\n$$\n2 b(V) b'(V) = -4 [D_e (E_e - V) + D_i (E_i - V)]\n$$\n$$\nb(V) b'(V) = -2 [D_e (E_e - V) + D_i (E_i - V)]\n$$\n现在，我们将此乘积代入 Milstein 修正项：\n$$\n\\text{修正项} = \\frac{1}{2} \\left( -2 [D_e (E_e - V_n) + D_i (E_i - V_n)] \\right) \\left( (\\Delta W_n)^2 - \\Delta t \\right)\n$$\n$$\n= - [D_e (E_e - V_n) + D_i (E_i - V_n)] \\left( (\\Delta W_n)^2 - \\Delta t \\right)\n$$\n这种形式避免了除以 $b(V)$，从而防止了当 $b(V)$ 变为零时（如在无噪声情况下，$D_e=D_i=0$）可能出现的问题。\n完整的 Milstein 更新规则是 EM 更新规则加上此修正项：\n$$\nV_{n+1} = V_n + a(V_n)\\Delta t + b(V_n)\\Delta W_n - [D_e (E_e - V_n) + D_i (E_i - V_n)] \\left( (\\Delta W_n)^2 - \\Delta t \\right)\n$$\n在 $D_e = 0$ 且 $D_i = 0$ 的特殊情况下，$b(V)$ 和修正项的系数均为零。因此，Milstein 格式正确地简化为 EM 格式，而 EM 格式又简化为所得常微分方程的确定性前向欧拉方法。\n\n**3. 模拟算法**\n\n模拟在总时间 $T$ 内以固定的时间步长 $\\Delta t$ 进行，共计 $N = T/\\Delta t$ 步。为了公平比较这两种格式，两者使用相同的维纳增量序列 $\\{\\Delta W_n\\}_{n=0}^{N-1}$。\n\n单个测试用例的算法如下：\n1. 将两种格式的电压初始化为重置电位：$V_{\\text{EM}, 0} = V_r$ 和 $V_{\\text{Mil}, 0} = V_r$。\n2. 将两种格式的脉冲计数初始化为零：$N_{\\text{spikes, EM}} = 0$ 和 $N_{\\text{spikes, Mil}} = 0$。\n3. 生成一个包含 $N$ 个随机数 $Z_n \\sim \\mathcal{N}(0, 1)$ 的数组，并计算维纳增量 $\\Delta W_n = \\sqrt{\\Delta t} Z_n$。\n4. 对于从 $0$ 到 $N-1$ 的每个时间步 $n$：\n    a. **欧拉-丸山步骤**：\n        i. 计算 $a(V_{\\text{EM}, n})$ 和 $b(V_{\\text{EM}, n})$。\n        ii. 更新电压：$V_{\\text{EM}, n+1}^{*} = V_{\\text{EM}, n} + a(V_{\\text{EM}, n})\\Delta t + b(V_{\\text{EM}, n})\\Delta W_n$。\n        iii. 检查脉冲：如果 $V_{\\text{EM}, n+1}^{*} \\ge V_{\\text{th}}$，则 $N_{\\text{spikes, EM}}$ 增一，并设置 $V_{\\text{EM}, n+1} = V_r$。否则，设置 $V_{\\text{EM}, n+1} = V_{\\text{EM}, n+1}^{*}$。\n    b. **Milstein 步骤**：\n        i. 计算 $a(V_{\\text{Mil}, n})$、$b(V_{\\text{Mil}, n})$ 和 Milstein 修正项。\n        ii. 更新电压：$V_{\\text{Mil}, n+1}^{*} = V_{\\text{Mil}, n} + a(V_{\\text{Mil}, n})\\Delta t + b(V_{\\text{Mil}, n})\\Delta W_n + \\text{修正项}$。\n        iii. 检查脉冲：如果 $V_{\\text{Mil}, n+1}^{*} \\ge V_{\\text{th}}$，则 $N_{\\text{spikes, Mil}}$ 增一，并设置 $V_{\\text{Mil}, n+1} = V_r$。否则，设置 $V_{\\text{Mil}, n+1} = V_{\\text{Mil}, n+1}^{*}$。\n5. 循环结束后，计算以赫兹为单位的发放频率。由于 $T$ 以毫秒为单位，所以以秒为单位的时间是 $T_{sec} = T/1000$。\n   - $f_{\\text{EM}} = N_{\\text{spikes, EM}} / T_{\\text{sec}}$\n   - $f_{\\text{Mil}} = N_{\\text{spikes, Mil}} / T_{\\text{sec}}$\n6. 计算测试用例的最终结果，即差值：$f_{\\text{Mil}} - f_{\\text{EM}}$。\n\n对测试套件中提供的每组参数都执行此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run simulations for all test cases and print results.\n    \"\"\"\n\n    # --- Neuron and simulation parameters from the problem statement ---\n    # These are fixed for all test cases.\n    params = {\n        'EL': -65.0,   # Resting potential (mV)\n        'Ee': 0.0,     # Excitatory reversal potential (mV)\n        'Ei': -75.0,   # Inhibitory reversal potential (mV)\n        'Vth': -50.0,  # Threshold potential (mV)\n        'Vr': -65.0,   # Reset potential (mV)\n        'tau': 20.0,   # Membrane time constant (ms)\n        'ge': 0.02,    # Excitatory conductance gain (ms^-1)\n        'gi': 0.02,    # Inhibitory conductance gain (ms^-1)\n    }\n    \n    # Test cases: (dt, T, seed, De, Di)\n    test_cases = [\n        (0.01, 5000.0, 123, 0.0005, 0.0002),\n        (0.1, 5000.0, 456, 0.0005, 0.0002),\n        (0.5, 5000.0, 789, 0.0005, 0.0002),\n        (0.1, 5000.0, 999, 0.0, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        dt, T, seed, De, Di = case\n        rate_diff = run_simulation(dt, T, seed, De, Di, params)\n        results.append(f\"{rate_diff:.3f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef run_simulation(dt, T, seed, De, Di, params):\n    \"\"\"\n    Simulates the LIF neuron using both Euler-Maruyama and Milstein schemes.\n\n    Args:\n        dt (float): Time step in ms.\n        T (float): Total simulation time in ms.\n        seed (int): Seed for the random number generator.\n        De (float): Excitatory diffusion strength.\n        Di (float): Inhibitory diffusion strength.\n        params (dict): Dictionary of neuron model parameters.\n\n    Returns:\n        float: The difference in firing rates (Milstein - EM) in Hz.\n    \"\"\"\n    EL, Ee, Ei = params['EL'], params['Ee'], params['Ei']\n    Vth, Vr = params['Vth'], params['Vr']\n    tau, ge, gi = params['tau'], params['ge'], params['gi']\n    \n    n_steps = int(T / dt)\n    \n    # Generate a shared sequence of Wiener increments\n    rng = np.random.default_rng(seed)\n    Z = rng.standard_normal(size=n_steps)\n    dW = np.sqrt(dt) * Z\n    \n    # Initialize state variables and spike counters\n    V_em = Vr\n    V_mil = Vr\n    spikes_em = 0\n    spikes_mil = 0\n    \n    # --- Main simulation loop ---\n    for i in range(n_steps):\n        dw_i = dW[i]\n        \n        # --- Euler-Maruyama (EM) Step ---\n        # Drift term a(V)\n        a_em = -(V_em - EL) / tau + ge * (Ee - V_em) + gi * (Ei - V_em)\n        \n        # Diffusion term b(V)\n        b_em_sq = 2.0 * De * (Ee - V_em)**2 + 2.0 * Di * (Ei - V_em)**2\n        b_em = np.sqrt(b_em_sq) if b_em_sq > 0 else 0.0\n        \n        # Update voltage\n        V_em_next = V_em + a_em * dt + b_em * dw_i\n        \n        # Spike and reset\n        if V_em_next >= Vth:\n            spikes_em += 1\n            V_em = Vr\n        else:\n            V_em = V_em_next\n            \n        # --- Milstein Step ---\n        # Drift term a(V)\n        a_mil = -(V_mil - EL) / tau + ge * (Ee - V_mil) + gi * (Ei - V_mil)\n        \n        # Diffusion term b(V)\n        b_mil_sq = 2.0 * De * (Ee - V_mil)**2 + 2.0 * Di * (Ei - V_mil)**2\n        b_mil = np.sqrt(b_mil_sq) if b_mil_sq > 0 else 0.0\n        \n        # Milstein correction term\n        # C = -[De*(Ee - V) + Di*(Ei - V)] * (dW^2 - dt)\n        milstein_correction_coeff = -(De * (Ee - V_mil) + Di * (Ei - V_mil))\n        correction = milstein_correction_coeff * (dw_i**2 - dt)\n        \n        # Update voltage\n        V_mil_next = V_mil + a_mil * dt + b_mil * dw_i + correction\n        \n        # Spike and reset\n        if V_mil_next >= Vth:\n            spikes_mil += 1\n            V_mil = Vr\n        else:\n            V_mil = V_mil_next\n            \n    # Calculate firing rates in Hz (T is in ms)\n    T_sec = T / 1000.0\n    rate_em = spikes_em / T_sec\n    rate_mil = spikes_mil / T_sec\n    \n    return rate_mil - rate_em\n\nsolve()\n```"
        }
    ]
}