{
    "hands_on_practices": [
        {
            "introduction": "The Fokker-Planck equation is a partial differential equation whose solutions are critically determined by the boundary conditions imposed. This is especially true for biophysical models with multiplicative noise, where the diffusion term $B(V)$ may vanish or diverge at the boundaries of the state space. This practice challenges you to apply the theory of stochastic processes to select the physically and mathematically correct boundary conditions for a neuron model with such state-dependent noise .",
            "id": "3982091",
            "problem": "Consider a one-dimensional neuronal membrane potential model driven by multiplicative conductance fluctuations, represented as an Itô Stochastic Differential Equation (SDE) on the interval $\\left(V_{r},V_{\\mathrm{th}}\\right)$:\n$$\n\\mathrm{d}V_{t} = a\\!\\left(V_{t}\\right)\\,\\mathrm{d}t + b\\!\\left(V_{t}\\right)\\,\\mathrm{d}W_{t},\n$$\nwhere $a\\!\\left(V\\right)$ is a continuously differentiable drift field, $b\\!\\left(V\\right)$ is a nonnegative diffusion amplitude encoding multiplicative noise, and $W_{t}$ is standard Brownian motion. Assume $a\\!\\left(V\\right)$ remains finite and continuous up to the boundaries, and the diffusion amplitude exhibits the following asymptotics:\n$$\nb\\!\\left(V\\right) \\sim k\\left(V - V_{r}\\right)^{\\alpha}\\quad\\text{as}\\quad V\\downarrow V_{r},\\qquad k>0,\\ \\alpha\\ge 1,\n$$\n$$\nb\\!\\left(V\\right) \\sim k'\\left(V_{\\mathrm{th}} - V\\right)^{-\\beta}\\quad\\text{as}\\quad V\\uparrow V_{\\mathrm{th}},\\qquad k'>0,\\ \\beta>0.\n$$\nThe corresponding Fokker–Planck equation (FPE) for the probability density $p\\!\\left(V,t\\right)$ is\n$$\n\\partial_{t}p\\!\\left(V,t\\right) = -\\partial_{V}\\!\\left[A\\!\\left(V\\right)p\\!\\left(V,t\\right)\\right] + \\tfrac{1}{2}\\,\\partial_{V}^{2}\\!\\left[B\\!\\left(V\\right)p\\!\\left(V,t\\right)\\right],\n$$\nwith $A\\!\\left(V\\right)=a\\!\\left(V\\right)$ and $B\\!\\left(V\\right)=b^{2}\\!\\left(V\\right)$, and probability current\n$$\nJ\\!\\left(V,t\\right) = A\\!\\left(V\\right)p\\!\\left(V,t\\right) - \\tfrac{1}{2}\\,\\partial_{V}\\!\\left[B\\!\\left(V\\right)p\\!\\left(V,t\\right)\\right].\n$$\nYou are asked to select the boundary prescription at $V=V_{r}$ and $V=V_{\\mathrm{th}}$ that ensures well-posedness of the FPE and physical plausibility for neuronal dynamics, in the sense of (i) conservation of total probability on $\\left(V_{r},V_{\\mathrm{th}}\\right)$ until threshold crossing, (ii) finite probability current at the boundaries, and (iii) consistent treatment of spike emission at $V=V_{\\mathrm{th}}$.\n\nWhich option best describes the appropriate boundary conditions under the given asymptotics?\n\nA. Impose an absorbing (Dirichlet) boundary at $V=V_{\\mathrm{th}}$ by $p\\!\\left(V_{\\mathrm{th}},t\\right)=0$, and a reflecting (zero-current) boundary at $V=V_{r}$ by $J\\!\\left(V_{r},t\\right)=0$.\n\nB. Treat $V=V_{r}$ as a natural boundary (no explicit boundary condition is imposed; solutions are determined by interior dynamics with integrability consistent with probability conservation), and enforce an absorbing boundary at $V=V_{\\mathrm{th}}$ via the weighted condition\n$$\n\\lim_{V\\uparrow V_{\\mathrm{th}}}\\,b\\!\\left(V\\right)\\,p\\!\\left(V,t\\right)=0,\n$$\nensuring finite flux and proper spike emission.\n\nC. Impose reflecting boundaries at both ends by $J\\!\\left(V_{r},t\\right)=0$ and $J\\!\\left(V_{\\mathrm{th}},t\\right)=0$ to prevent probability leakage, irrespective of the behavior of $b\\!\\left(V\\right)$.\n\nD. Impose absorbing (Dirichlet) boundaries at both ends by $p\\!\\left(V_{r},t\\right)=p\\!\\left(V_{\\mathrm{th}},t\\right)=0$ to guarantee well-posedness when $b\\!\\left(V\\right)$ is singular or vanishes.\n\nSelect the single best option.",
            "solution": "The user wants me to validate and solve a problem concerning the boundary conditions for a Fokker-Planck equation (FPE) that models neuronal membrane potential dynamics.\n\n### Step 1: Extract Givens\n\n-   **Stochastic Process:** A one-dimensional Itô Stochastic Differential Equation (SDE) for the membrane potential $V_t$ on the interval $\\left(V_{r},V_{\\mathrm{th}}\\right)$:\n    $$ \\mathrm{d}V_{t} = a\\!\\left(V_{t}\\right)\\,\\mathrm{d}t + b\\!\\left(V_{t}\\right)\\,\\mathrm{d}W_{t} $$\n-   **Drift Coefficient:** $a(V)$ is a continuously differentiable function, finite on the closed interval $[V_{r},V_{\\mathrm{th}}]$.\n-   **Diffusion Coefficient:** $b(V)$ is a nonnegative function.\n-   **Asymptotic Behavior of Diffusion Coefficient:**\n    1.  As $V \\downarrow V_{r}$: $b(V) \\sim k(V - V_r)^{\\alpha}$ for constants $k>0$ and $\\alpha \\ge 1$.\n    2.  As $V \\uparrow V_{\\mathrm{th}}$: $b(V) \\sim k'(V_{\\mathrm{th}} - V)^{-\\beta}$ for constants $k'>0$ and $\\beta > 0$.\n-   **Fokker-Planck Equation (FPE):** The evolution of the probability density $p(V,t)$ is given by:\n    $$ \\partial_{t}p\\!\\left(V,t\\right) = -\\partial_{V}\\!\\left[A\\!\\left(V\\right)p\\!\\left(V,t\\right)\\right] + \\tfrac{1}{2}\\,\\partial_{V}^{2}\\!\\left[B\\!\\left(V\\right)p\\!\\left(V,t\\right)\\right] $$\n    with $A(V) = a(V)$ and $B(V) = b^2(V)$.\n-   **Probability Current:**\n    $$ J\\!\\left(V,t\\right) = A\\!\\left(V\\right)p\\!\\left(V,t\\right) - \\tfrac{1}{2}\\,\\partial_{V}\\!\\left[B\\!\\left(V\\right)p\\!\\left(V,t\\right)\\right] $$\n-   **Objective:** Determine the boundary conditions at $V_r$ and $V_{\\mathrm{th}}$ that ensure well-posedness and physical plausibility, specifically: (i) probability conservation until absorption, (ii) finite probability current, and (iii) correct modeling of spike emission.\n\n### Step 2: Validate Using Extracted Givens\n\n-   **Scientific Groundedness:** The problem is firmly located within the well-established field of theoretical and computational neuroscience. The use of SDEs and the corresponding FPE to model neuronal dynamics is a standard and powerful technique. The specific forms of multiplicative noise (vanishing at a reversal potential, diverging at a threshold) are plausible and subjects of advanced study. The problem is a direct application of the Feller boundary classification for one-dimensional diffusions, a cornerstone of stochastic process theory. The setup is scientifically and mathematically sound.\n-   **Well-Posedness & Completeness:** The problem is well-posed as a question of boundary classification. It provides all necessary information: the governing equation, the domain, and the asymptotic behavior of the coefficients at the boundaries. The criteria for a \"correct\" answer (well-posedness, physical plausibility) are clearly stated. No essential information is missing, and there are no contradictions.\n-   **Objectivity:** The problem is stated in precise mathematical terms, free of ambiguity, subjectivity, or non-scientific language.\n\nThe problem statement is entirely valid. It is a standard, albeit non-trivial, problem in the application of stochastic calculus to biophysical modeling. I will proceed with the solution.\n\n### Derivation\n\nThe nature of the boundaries of a one-dimensional diffusion process is determined by the behavior of the drift $A(V)$ and diffusion $B(V)=b^2(V)$ coefficients near those boundaries. This is systematically addressed by Feller's boundary classification. We analyze each boundary, $V=V_r$ and $V=V_{\\mathrm{th}}$, separately.\n\n**Analysis of the Lower Boundary at $V = V_r$ (Reset Potential)**\n\nThe physical role of $V_r$ is a reset potential, which typically acts as a floor for the membrane voltage. The process should not be able to cross below this value. We must classify this boundary based on the given asymptotics.\n\nThe given behavior is $b(V) \\sim k(V - V_r)^{\\alpha}$ with $\\alpha \\ge 1$. This implies the diffusion term in the FPE is $B(V) = b^2(V) \\sim k^2(V - V_r)^{2\\alpha}$. Since $\\alpha \\ge 1$, we have $2\\alpha \\ge 2$.\n\nA key test for the reachability of a boundary is Feller's test. A boundary $z$ is inaccessible (or cannot be reached in finite time) from the interior if the integral of $(1+|A(y)|)/B(y)$ diverges at $z$. Let's evaluate this for $V_r$:\n$$\n\\int_{V_r}^{c} \\frac{1+|A(y)|}{B(y)} \\mathrm{d}y \\quad \\text{for some } c \\in (V_r, V_{\\mathrm{th}})\n$$\nNear $V_r$, $A(y)$ is finite, say $A(y) \\to A(V_r)$, and $B(y) \\propto (y-V_r)^{2\\alpha}$. The integrand behaves as:\n$$\n\\frac{1+|A(y)|}{B(y)} \\sim \\frac{1+|A(V_r)|}{k^2(y-V_r)^{2\\alpha}}\n$$\nWe must check the convergence of $\\int_{V_r+\\epsilon} (y-V_r)^{-2\\alpha} \\mathrm{d}y$. This integral diverges if the exponent is greater than or equal to $1$. Here, the exponent is $2\\alpha$, and since $\\alpha \\ge 1$, we have $2\\alpha \\ge 2$. The integral diverges.\n\nA boundary that is not reachable from the interior is classified as a **natural boundary** or an entrance boundary. Given that we start the process inside the interval, it cannot reach $V_r$ in finite time. Such a boundary is effectively repelling. For a natural boundary, no explicit boundary condition needs to be, or can be, imposed. The requirement that the solution $p(V,t)$ be a normalizing probability density is sufficient to determine the solution's behavior. A direct consequence of a boundary being natural is that the probability current vanishes there:\n$$ J(V_r, t) = 0 $$\nThis is not a condition we impose, but a result of the SDE's structure. This aligns with the physical picture: the vanishing noise prevents the particle from reaching the boundary, so no probability can leak out. This conserves probability within the domain.\n\n**Analysis of the Upper Boundary at $V = V_{\\mathrm{th}}$ (Spiking Threshold)**\n\nThe threshold $V_{\\mathrm{th}}$ is where a neuron is considered to fire a spike. In this context, it should be an **absorbing boundary**: any trajectory reaching it is removed from the sub-threshold-dynamics simulation.\n\nThe diffusion amplitude diverges: $b(V) \\sim k'(V_{\\mathrm{th}} - V)^{-\\beta}$ with $\\beta > 0$. Thus, $B(V) \\sim (k')^2(V_{\\mathrm{th}} - V)^{-2\\beta}$.\nLet's check the reachability of $V_{\\mathrm{th}}$ using Feller's test:\n$$\n\\int_{c}^{V_{\\mathrm{th}}} \\frac{1+|A(y)|}{B(y)} \\mathrm{d}y \\sim \\int_{c}^{V_{\\mathrm{th}}} \\frac{1+|A(V_{\\mathrm{th}})|}{(k')^2(y-V_{\\mathrm{th}})^{-2\\beta}} \\mathrm{d}y = C \\int_{c}^{V_{\\mathrm{th}}} (V_{\\mathrm{th}}-y)^{2\\beta} \\mathrm{d}y\n$$\nSince $\\beta > 0$, the exponent $2\\beta$ is positive. The function $(V_{\\mathrm{th}}-y)^{2\\beta}$ is integrable over a finite interval up to $V_{\\mathrm{th}}$. The integral converges. Therefore, the boundary $V_{\\mathrm{th}}$ is reachable in finite time.\n\nSince the boundary is reachable, we must impose a condition. For an absorbing boundary, the probability density is expected to vanish. The simplest condition is the Dirichlet condition, $p(V_{\\mathrm{th}}, t) = 0$. However, with a singular diffusion coefficient, this is not sufficient to guarantee a finite probability current $J(V_{\\mathrm{th}}, t)$, which represents the firing rate of the neuron. An infinite firing rate is unphysical.\n\nTo find the correct condition, we can use the Lamperti transformation. Let's define a new spatial coordinate $X$ such that $\\mathrm{d}X = \\mathrm{d}V / b(V)$. The SDE for $X_t$ becomes an SDE with a unit diffusion coefficient, where standard boundary conditions apply.\n$$\n\\mathrm{d}X_t = \\left(\\frac{a(V_t)}{b(V_t)} - \\frac{1}{2} b'(V_t)\\right) \\mathrm{d}t + \\mathrm{d}W_t\n$$\nThe FPE for the density $p_X(X,t)$ in the new coordinate has a constant diffusion term, so its boundaries are regular. The absorbing boundary condition in the $X$ coordinate is simply $p_X(X_{\\mathrm{th}}, t) = 0$. The probability densities are related by the Jacobian of the transformation: $p(V,t)\\,\\mathrm{d}V = p_X(X,t)\\,\\mathrm{d}X$. This gives $p(V,t) = p_X(X,t) \\frac{\\mathrm{d}X}{\\mathrm{d}V} = \\frac{p_X(X(V),t)}{b(V)}$.\nRearranging, we have $b(V) p(V,t) = p_X(X(V),t)$. Taking the limit as $V \\uparrow V_{\\mathrm{th}}$:\n$$\n\\lim_{V\\uparrow V_{\\mathrm{th}}} b(V)p(V,t) = \\lim_{X\\uparrow X_{\\mathrm{th}}} p_X(X,t)\n$$\nSince the correct condition in the transformed space is $p_X(X_{\\mathrm{th}},t)=0$, the appropriate condition in the original $V$ coordinate is:\n$$\n\\lim_{V\\uparrow V_{\\mathrm{th}}} b(V)p(V,t) = 0\n$$\nThis weighted condition ensures that the probability density vanishes sufficiently fast to counteract the diverging diffusion, leading to a well-defined and finite probability current $J(V_{\\mathrm{th}}, t)$, which corresponds to a finite firing rate.\n\n### Option-by-Option Analysis\n\n**A. Impose an absorbing (Dirichlet) boundary at $V=V_{\\mathrm{th}}$ by $p\\!\\left(V_{\\mathrm{th}},t\\right)=0$, and a reflecting (zero-current) boundary at $V=V_{r}$ by $J\\!\\left(V_{r},t\\right)=0$.**\n-   The condition at $V_r$ is misleading. The boundary is *naturally* reflecting; $J(V_r,t)=0$ is a consequence of the dynamics, not a condition to be imposed.\n-   The condition at $V_{\\mathrm{th}}$ is a simple Dirichlet condition, which is insufficient to guarantee finite flux in the presence of the singular diffusion coefficient.\n-   **Verdict: Incorrect.**\n\n**B. Treat $V=V_{r}$ as a natural boundary (no explicit boundary condition is imposed; solutions are determined by interior dynamics with integrability consistent with probability conservation), and enforce an absorbing boundary at $V=V_{\\mathrm{th}}$ via the weighted condition $\\lim_{V\\uparrow V_{\\mathrm{th}}}\\,b\\!\\left(V\\right)\\,p\\!\\left(V,t\\right)=0$, ensuring finite flux and proper spike emission.**\n-   The description of the boundary at $V_r$ as natural is precisely correct based on our analysis. The explanation provided in the option is an accurate definition of a natural boundary.\n-   The weighted condition at $V_{\\mathrm{th}}$ is the correct formulation for an absorbing boundary with diverging diffusion, as derived from the Lamperti transformation. It correctly ensures a finite exit flux (firing rate).\n-   **Verdict: Correct.**\n\n**C. Impose reflecting boundaries at both ends by $J\\!\\left(V_{r},t\\right)=0$ and $J\\!\\left(V_{\\mathrm{th}},t\\right)=0$.**\n-   The condition $J(V_{\\mathrm{th}},t)=0$ implies a reflecting boundary at the threshold. This is physically incorrect for a model of spiking neurons, as it would mean no spikes can ever occur and probability is perpetually trapped.\n-   **Verdict: Incorrect.**\n\n**D. Impose absorbing (Dirichlet) boundaries at both ends by $p\\!\\left(V_{r},t\\right)=p\\!\\left(V_{\\mathrm{th}},t\\right)=0$.**\n-   An absorbing boundary at $V_r$ is physically incorrect. The reset potential is not a point of absorption.\n-   As with option A, the simple Dirichlet condition at $V_{\\mathrm{th}}$ is insufficient.\n-   **Verdict: Incorrect.**",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "Once a problem is well-posed, a primary goal is often to compute key observables, such as the population's average firing rate $r$. This exercise transitions from continuous theory to numerical implementation, guiding you through the population density method for solving the stationary Fokker-Planck equation. You will learn how to discretize the equation and its boundary conditions into a linear system to find the steady-state firing rate of a leaky integrate-and-fire (LIF) neuron population .",
            "id": "4051216",
            "problem": "Consider a homogeneous population of uncoupled leaky integrate-and-fire (LIF) neurons under a diffusion approximation. Let the membrane voltage be denoted by $V$, and suppose each neuron obeys the stochastic differential equation (SDE) $dV = A(V)\\,dt + \\sigma\\,dW_t$, where $A(V) = -\\dfrac{V - V_{\\mathrm{L}}}{\\tau} + \\mu$. Here, $\\tau$ is the membrane time constant in seconds, $V_{\\mathrm{L}}$ is the leak reversal potential in volts, $\\mu$ is a constant drift term in volts per second, $\\sigma$ is the noise amplitude in volts per square root second, and $W_t$ is a standard Wiener process. The corresponding Fokker-Planck equation (FPE) for the probability density $p(V,t)$ is $\\dfrac{\\partial p}{\\partial t} = -\\dfrac{\\partial J}{\\partial V}$ with probability flux $J(V,t) = A(V)\\,p(V,t) - D\\,\\dfrac{\\partial p}{\\partial V}$, where $D = \\dfrac{\\sigma^2}{2}$.\n\nIn the steady state, let $p(V)$ be time-independent and let the flux be piecewise constant except at the reset voltage due to reinjection of mass. Impose the following boundary conditions in voltage space:\n- Absorbing boundary at the threshold voltage $V_{\\mathrm{th}}$, i.e., $p(V_{\\mathrm{th}}) = 0$, and the outgoing flux at threshold equals the steady firing rate $r$ in per second.\n- Reinjection at the reset voltage $V_{\\mathrm{r}}$, modeled as a point source of probability current of strength $r$, yielding a jump in flux across $V_{\\mathrm{r}}$ equal to $r$.\n- Zero-flux boundary at a lower bound $V_{\\min}$, i.e., $J(V_{\\min}) = 0$.\n- Normalization condition $\\int_{V_{\\min}}^{V_{\\mathrm{th}}} p(V)\\,dV = 1$.\n\nYour task is to formulate and implement the population density method by discretizing the stationary Fokker-Planck equation with appropriate flux boundary conditions to compute the steady-state firing rate $r$ and the stationary density $p(V)$ numerically. Use a uniform grid of $N+1$ points on the interval $[V_{\\min}, V_{\\mathrm{th}}]$ with grid spacing $\\Delta V = \\dfrac{V_{\\mathrm{th}} - V_{\\min}}{N}$. Denote the grid points by $V_i = V_{\\min} + i\\,\\Delta V$ for $i \\in \\{0,1,\\dots,N\\}$ and the discrete density by $p_i \\approx p(V_i)$. Approximate the steady-state flux at grid point $V_i$ by the first-order finite-volume expression $J_i = A(V_i)\\,p_i - D\\,\\dfrac{p_i - p_{i-1}}{\\Delta V}$ for $i \\in \\{1,2,\\dots,N\\}$. Let the reset index $k$ be the index closest to $V_{\\mathrm{r}}$ on this grid.\n\nEnforce the following discrete conditions:\n- For $i \\in \\{1,2,\\dots,k\\}$, set $J_i = 0$ to reflect zero flux below reset.\n- For $i \\in \\{k+1,k+2,\\dots,N-1\\}$, set $J_i = r$ to reflect constant outgoing flux above reset.\n- At threshold, enforce $J_N = r$ with $p_N = 0$ via $r - D\\,\\dfrac{p_{N-1}}{\\Delta V} = 0$.\n- Enforce normalization $\\sum_{i=0}^{N-1} p_i\\,\\Delta V = 1$.\n\nThis yields a linear system in the unknowns $\\{p_0,p_1,\\dots,p_{N-1},r\\}$, which you must solve to obtain $r$ and $p_i$. You must ensure scientific realism by using parameter values that produce physically plausible densities and rates. Express firing rates in per second ($\\mathrm{s}^{-1}$).\n\nImplement a complete program that:\n- Builds and solves the described linear system for each test case.\n- Returns the steady-state firing rate $r$ for each test case as a floating-point number in $\\mathrm{s}^{-1}$.\n- Internally also computes the stationary density $p_i$ on the grid, although only the rates are required to be output.\n\nTest Suite:\nUse the following parameter sets as the test suite. For all cases, use $A(V) = -\\dfrac{V - V_{\\mathrm{L}}}{\\tau} + \\mu$ and $D = \\dfrac{\\sigma^2}{2}$.\n\n- Case $1$ (general case): $\\tau = 0.02$ $\\mathrm{s}$, $V_{\\mathrm{L}} = -0.065$ $\\mathrm{V}$, $\\mu = 0.001$ $\\mathrm{V/s}$, $\\sigma = 0.003$ $\\mathrm{V/\\sqrt{s}}$, $V_{\\mathrm{th}} = -0.050$ $\\mathrm{V}$, $V_{\\mathrm{r}} = -0.065$ $\\mathrm{V}$, $V_{\\min} = -0.085$ $\\mathrm{V}$, $N = 200$.\n- Case $2$ (low diffusion edge): $\\tau = 0.02$ $\\mathrm{s}$, $V_{\\mathrm{L}} = -0.065$ $\\mathrm{V}$, $\\mu = 0.001$ $\\mathrm{V/s}$, $\\sigma = 0.0001$ $\\mathrm{V/\\sqrt{s}}$, $V_{\\mathrm{th}} = -0.050$ $\\mathrm{V}$, $V_{\\mathrm{r}} = -0.065$ $\\mathrm{V}$, $V_{\\min} = -0.085$ $\\mathrm{V}$, $N = 200$.\n- Case $3$ (high drift): $\\tau = 0.02$ $\\mathrm{s}$, $V_{\\mathrm{L}} = -0.065$ $\\mathrm{V}$, $\\mu = 0.010$ $\\mathrm{V/s}$, $\\sigma = 0.002$ $\\mathrm{V/\\sqrt{s}}$, $V_{\\mathrm{th}} = -0.050$ $\\mathrm{V}$, $V_{\\mathrm{r}} = -0.065$ $\\mathrm{V}$, $V_{\\min} = -0.085$ $\\mathrm{V}$, $N = 200$.\n- Case $4$ (reset at lower bound): $\\tau = 0.02$ $\\mathrm{s}$, $V_{\\mathrm{L}} = -0.065$ $\\mathrm{V}$, $\\mu = 0.002$ $\\mathrm{V/s}$, $\\sigma = 0.004$ $\\mathrm{V/\\sqrt{s}}$, $V_{\\mathrm{th}} = -0.050$ $\\mathrm{V}$, $V_{\\mathrm{r}} = -0.075$ $\\mathrm{V}$, $V_{\\min} = -0.075$ $\\mathrm{V}$, $N = 150$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the firing rates for the four test cases as a comma-separated list enclosed in square brackets, for example, $[r_1,r_2,r_3,r_4]$, where each $r_i$ is a floating-point number in $\\mathrm{s}^{-1}$ with default Python formatting. No other text should be printed.",
            "solution": "The user wants to solve a problem in computational neuroscience, specifically calculating the steady-state firing rate of a population of leaky integrate-and-fire (LIF) neurons using the Fokker-Planck formalism.\n\n### Problem Validation\n\nFirst, I will validate the problem statement according to the specified protocol.\n\n#### Step 1: Extract Givens\n\n- **Stochastic Differential Equation (SDE)**: $dV = A(V)\\,dt + \\sigma\\,dW_t$\n- **Drift Term**: $A(V) = -\\dfrac{V - V_{\\mathrm{L}}}{\\tau} + \\mu$\n- **Parameters**:\n    - $\\tau$: membrane time constant (s)\n    - $V_{\\mathrm{L}}$: leak reversal potential (V)\n    - $\\mu$: constant drift term (V/s)\n    - $\\sigma$: noise amplitude (V/$\\sqrt{\\mathrm{s}}$)\n- **Fokker-Planck Equation (FPE)**: $\\dfrac{\\partial p}{\\partial t} = -\\dfrac{\\partial J}{\\partial V}$\n- **Probability Flux**: $J(V,t) = A(V)\\,p(V,t) - D\\,\\dfrac{\\partial p}{\\partial V}$, where $D = \\dfrac{\\sigma^2}{2}$.\n- **Steady-State Conditions**:\n    - $\\dfrac{\\partial p}{\\partial t} = 0$, so $J(V)$ is piecewise constant.\n    - $r$: steady firing rate ($\\mathrm{s}^{-1}$).\n- **Boundary Conditions**:\n    - Absorbing boundary at threshold: $p(V_{\\mathrm{th}}) = 0$.\n    - Outgoing flux at threshold: $J(V_{\\mathrm{th}}) = r$.\n    - Reinjection at reset: Flux jump of $r$ across $V_{\\mathrm{r}}$.\n    - Zero-flux at lower bound: $J(V_{\\min}) = 0$.\n    - Normalization: $\\int_{V_{\\min}}^{V_{\\mathrm{th}}} p(V)\\,dV = 1$.\n- **Numerical Discretization**:\n    - Grid: Uniform with $N+1$ points on $[V_{\\min}, V_{\\mathrm{th}}]$.\n    - Grid spacing: $\\Delta V = \\dfrac{V_{\\mathrm{th}} - V_{\\min}}{N}$.\n    - Grid points: $V_i = V_{\\min} + i\\,\\Delta V$ for $i \\in \\{0, 1, \\dots, N\\}$.\n    - Discrete density: $p_i \\approx p(V_i)$.\n    - Reset index: $k$ is the index closest to $V_{\\mathrm{r}}$.\n    - Discrete flux: $J_i = A(V_i)\\,p_i - D\\,\\dfrac{p_i - p_{i-1}}{\\Delta V}$ for $i \\in \\{1, 2, \\dots, N\\}$.\n- **Discrete System Conditions**:\n    - For $i \\in \\{1, 2, \\dots, k\\}$: $J_i = 0$.\n    - For $i \\in \\{k+1, k+2, \\dots, N-1\\}$: $J_i = r$.\n    - At threshold ($i=N$): $J_N = r$ with $p_N = 0$, imposed via $r - D\\,\\dfrac{p_{N-1}}{\\Delta V} = 0$.\n    - Normalization: $\\sum_{i=0}^{N-1} p_i\\,\\Delta V = 1$.\n- **Test Suite**:\n    - Case 1: $\\tau = 0.02$ $\\mathrm{s}$, $V_{\\mathrm{L}} = -0.065$ $\\mathrm{V}$, $\\mu = 0.001$ $\\mathrm{V/s}$, $\\sigma = 0.003$ $\\mathrm{V/\\sqrt{s}}$, $V_{\\mathrm{th}} = -0.050$ $\\mathrm{V}$, $V_{\\mathrm{r}} = -0.065$ $\\mathrm{V}$, $V_{\\min} = -0.085$ $\\mathrm{V}$, $N = 200$.\n    - Case 2: $\\tau = 0.02$ $\\mathrm{s}$, $V_{\\mathrm{L}} = -0.065$ $\\mathrm{V}$, $\\mu = 0.001$ $\\mathrm{V/s}$, $\\sigma = 0.0001$ $\\mathrm{V/\\sqrt{s}}$, $V_{\\mathrm{th}} = -0.050$ $\\mathrm{V}$, $V_{\\mathrm{r}} = -0.065$ $\\mathrm{V}$, $V_{\\min} = -0.085$ $\\mathrm{V}$, $N = 200$.\n    - Case 3: $\\tau = 0.02$ $\\mathrm{s}$, $V_{\\mathrm{L}} = -0.065$ $\\mathrm{V}$, $\\mu = 0.010$ $\\mathrm{V/s}$, $\\sigma = 0.002$ $\\mathrm{V/\\sqrt{s}}$, $V_{\\mathrm{th}} = -0.050$ $\\mathrm{V}$, $V_{\\mathrm{r}} = -0.065$ $\\mathrm{V}$, $V_{\\min} = -0.085$ $\\mathrm{V}$, $N = 200$.\n    - Case 4: $\\tau = 0.02$ $\\mathrm{s}$, $V_{\\mathrm{L}} = -0.065$ $\\mathrm{V}$, $\\mu = 0.002$ $\\mathrm{V/s}$, $\\sigma = 0.004$ $\\mathrm{V/\\sqrt{s}}$, $V_{\\mathrm{th}} = -0.050$ $\\mathrm{V}$, $V_{\\mathrm{r}} = -0.075$ $\\mathrm{V}$, $V_{\\min} = -0.075$ $\\mathrm{V}$, $N = 150$.\n\n#### Step 2: Validate Using Extracted Givens\n\n- **Scientifically Grounded**: The problem describes the diffusion approximation for a population of LIF neurons, leading to a Fokker-Planck equation. This is a canonical and scientifically established method in theoretical and computational neuroscience. The parameters are provided in consistent SI units (V, s) and their magnitudes are physically plausible for biological neurons.\n- **Well-Posed**: The problem requires solving for $N+1$ unknowns: the $N$ probability density values $\\{p_0, p_1, \\dots, p_{N-1}\\}$ and the firing rate $r$. The problem provides $N+1$ linear equations: $k$ equations from $J_i=0$, $N-1-k$ equations from $J_i=r$, one equation for the boundary condition at threshold $J_N=r$, and one normalization equation. The total number of linear equations ($k + (N-1-k) + 1 + 1 = N+1$) matches the number of unknowns. This forms a linear system of the form $M \\mathbf{x} = \\mathbf{b}$, which is expected to have a unique solution for the given physical parameters.\n- **Objective**: The problem is stated using precise mathematical definitions and objective language, free from ambiguity or subjective claims.\n- **Other Flaws**: The problem is self-contained, with all necessary data and conditions provided. It does not contain contradictions; even in Case 4 where $V_{\\mathrm{r}} = V_{\\min}$, the discrete formulation handles this as a specific boundary case where reinjection occurs at the lower reflective barrier. The problem is not trivial, requiring a careful implementation of a numerical method.\n\n#### Step 3: Verdict and Action\n\nThe problem is **valid**. I will proceed with the solution.\n\n### Solution Derivation and Implementation\n\nThe task is to compute the steady-state firing rate $r$ by solving a system of linear equations derived from the discretized stationary Fokker-Planck equation. The unknowns are the probability densities $p_i$ at each grid point $V_i$ for $i \\in \\{0, \\dots, N-1\\}$ and the firing rate $r$. This gives a total of $N+1$ unknowns. We must construct a linear system $M \\mathbf{x} = \\mathbf{b}$ of size $(N+1) \\times (N+1)$, where $\\mathbf{x} = [p_0, p_1, \\dots, p_{N-1}, r]^T$.\n\n1.  **Define Grid and Parameters**:\n    The voltage domain $[V_{\\min}, V_{\\mathrm{th}}]$ is discretized into $N$ intervals of width $\\Delta V = (V_{\\mathrm{th}} - V_{\\min}) / N$. The grid points are $V_i = V_{\\min} + i\\Delta V$. The diffusion coefficient is $D = \\sigma^2/2$. The drift is $A_i = A(V_i) = -(V_i - V_{\\mathrm{L}})/\\tau + \\mu$. The reset index $k$ is the grid index closest to $V_{\\mathrm{r}}$.\n\n2.  **Formulate the Linear System**:\n    We assemble the $(N+1) \\times (N+1)$ matrix $M$ and the $(N+1) \\times 1$ vector $\\mathbf{b}$ based on the $N+1$ discrete conditions. The columns of $M$ correspond to the coefficients of $p_0, \\dots, p_{N-1}, r$.\n\n    - **Flux equations for $i \\in \\{1, \\dots, k\\}$ ($k$ equations)**:\n      The condition is $J_i = 0$. Substituting the discrete flux expression:\n      $A_i p_i - D \\dfrac{p_i - p_{i-1}}{\\Delta V} = 0 \\implies \\left(\\dfrac{D}{\\Delta V}\\right) p_{i-1} + \\left(A_i - \\dfrac{D}{\\Delta V}\\right) p_i = 0$.\n      For each $i$ in this range, we fill row $i-1$ of matrix $M$:\n      $M[i-1, i-1] = \\dfrac{D}{\\Delta V}$\n      $M[i-1, i] = A_i - \\dfrac{D}{\\Delta V}$\n\n    - **Flux equations for $i \\in \\{k+1, \\dots, N-1\\}$ ($N-1-k$ equations)**:\n      The condition is $J_i = r$.\n      $A_i p_i - D \\dfrac{p_i - p_{i-1}}{\\Delta V} = r \\implies \\left(\\dfrac{D}{\\Delta V}\\right) p_{i-1} + \\left(A_i - \\dfrac{D}{\\Delta V}\\right) p_i - r = 0$.\n      For each $i$ in this range, we fill row $i-1$ of matrix $M$. Note that the last column, index $N$, corresponds to the unknown $r$.\n      $M[i-1, i-1] = \\dfrac{D}{\\Delta V}$\n      $M[i-1, i] = A_i - \\dfrac{D}{\\Delta V}$\n      $M[i-1, N] = -1$\n\n    - **Threshold flux equation ($1$ equation)**:\n      The condition at $i=N$ is $r - D \\dfrac{p_{N-1}}{\\Delta V} = 0$. This comes from $J_N = r$ with the approximation $J_N \\approx -D\\frac{p_N - p_{N-1}}{\\Delta V}$ and the boundary condition $p_N=p(V_{th})=0$.\n      This gives $-\\left(\\dfrac{D}{\\Delta V}\\right) p_{N-1} + r = 0$.\n      This corresponds to row $N-1$ of matrix $M$:\n      $M[N-1, N-1] = -\\dfrac{D}{\\Delta V}$\n      $M[N-1, N] = 1$\n\n    - **Normalization equation ($1$ equation)**:\n      The condition is $\\sum_{i=0}^{N-1} p_i \\Delta V = 1$. The trapezoidal rule is used here, but the problem statement specifies a simpler sum which we follow.\n      This corresponds to the last row, $N$, of matrix $M$:\n      $M[N, j] = \\Delta V$ for $j \\in \\{0, \\dots, N-1\\}$\n      $M[N, N] = 0$\n      The corresponding entry in the vector $\\mathbf{b}$ is $b_N = 1$. All other entries of $\\mathbf{b}$ are $0$.\n\n3.  **Solve the System**:\n    With the matrix $M$ and vector $\\mathbf{b}$ fully constructed, the system $M \\mathbf{x} = \\mathbf{b}$ is solved for the vector of unknowns $\\mathbf{x}$. The last element of the solution vector, $x_N$, is the steady-state firing rate $r$. The implementation will use `numpy.linalg.solve` for this purpose. This procedure is repeated for each parameter set in the test suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    \"\"\"\n    # Test cases defined in the problem statement.\n    test_cases = [\n        {\n            \"tau\": 0.02, \"V_L\": -0.065, \"mu\": 0.001, \"sigma\": 0.003,\n            \"V_th\": -0.050, \"V_r\": -0.065, \"V_min\": -0.085, \"N\": 200\n        },\n        {\n            \"tau\": 0.02, \"V_L\": -0.065, \"mu\": 0.001, \"sigma\": 0.0001,\n            \"V_th\": -0.050, \"V_r\": -0.065, \"V_min\": -0.085, \"N\": 200\n        },\n        {\n            \"tau\": 0.02, \"V_L\": -0.065, \"mu\": 0.010, \"sigma\": 0.002,\n            \"V_th\": -0.050, \"V_r\": -0.065, \"V_min\": -0.085, \"N\": 200\n        },\n        {\n            \"tau\": 0.02, \"V_L\": -0.065, \"mu\": 0.002, \"sigma\": 0.004,\n            \"V_th\": -0.050, \"V_r\": -0.075, \"V_min\": -0.075, \"N\": 150\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        r = calculate_firing_rate(**params)\n        results.append(r)\n\n    # Print the final result in the specified format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_firing_rate(tau, V_L, mu, sigma, V_th, V_r, V_min, N):\n    \"\"\"\n    Calculates the steady-state firing rate for a single set of parameters.\n    \"\"\"\n    # System parameters\n    D = sigma**2 / 2.0\n    def A(V):\n        return -(V - V_L) / tau + mu\n\n    # Discretization\n    V_grid = np.linspace(V_min, V_th, N + 1)\n    dV = (V_th - V_min) / N\n    k = np.argmin(np.abs(V_grid - V_r))\n\n    # Initialize the linear system M*x = b\n    # The unknowns x are [p_0, p_1, ..., p_{N-1}, r]\n    M = np.zeros((N + 1, N + 1))\n    b = np.zeros(N + 1)\n\n    A_vals = A(V_grid)\n\n    # Row indices of M correspond to equation numbers (0 to N)\n    # Column indices of M correspond to unknowns (p_0 to p_{N-1}, then r)\n\n    # Flux equations for i in {1, ..., k}: J_i = 0\n    # These equations correspond to rows 0 to k-1 of the matrix M\n    for i in range(1, k + 1):\n        row = i - 1\n        # Coefficient for p_{i-1}\n        M[row, i - 1] = D / dV\n        # Coefficient for p_i\n        M[row, i] = A_vals[i] - D / dV\n    \n    # Flux equations for i in {k+1, ..., N-1}: J_i = r\n    # These equations correspond to rows k to N-2 of M\n    for i in range(k + 1, N):\n        row = i - 1\n        # Coefficient for p_{i-1}\n        M[row, i - 1] = D / dV\n        # Coefficient for p_i\n        M[row, i] = A_vals[i] - D / dV\n        # Coefficient for r (unknown at index N)\n        M[row, N] = -1.0\n\n    # Threshold equation for i = N: J_N = r with p_N = 0\n    # This equation corresponds to row N-1 of M\n    row = N - 1\n    # Coefficient for p_{N-1}\n    M[row, N - 1] = -D / dV\n    # Coefficient for r\n    M[row, N] = 1.0\n\n    # Normalization equation: sum(p_i * dV) = 1\n    # This equation corresponds to row N of M\n    row = N\n    M[row, 0:N] = dV\n    M[row, N] = 0.0\n    b[row] = 1.0\n\n    # Solve the linear system\n    try:\n        solution = np.linalg.solve(M, b)\n    except np.linalg.LinAlgError:\n        # Return a value indicating failure, e.g., NaN, if the matrix is singular\n        return np.nan\n        \n    # The firing rate r is the last element of the solution vector\n    r = solution[-1]\n\n    return r\n\nsolve()\n```"
        },
        {
            "introduction": "While solving the full Fokker-Planck equation provides a complete statistical description, its computational cost often motivates the use of simpler approximations like moment closures. A crucial skill for any computational modeler is to understand the limitations of such approximations. This practice involves simulating the full time-dependent FPE to create a \"ground truth\" solution, which you will then use to quantify the accuracy of a Gaussian moment closure approximation under transient input conditions .",
            "id": "3982084",
            "problem": "Consider a population of neurons modeled by the Leaky Integrate-and-Fire (LIF) model with stochastic input, where the subthreshold membrane potential dynamics of an individual neuron are described by the Itô stochastic differential equation (SDE)\n$$\n\\mathrm{d}v(t) = a(v(t),t)\\,\\mathrm{d}t + \\sqrt{2 D}\\,\\mathrm{d}W_t,\n$$\nwith drift\n$$\na(v,t) = -\\frac{v - V_L}{\\tau} + \\mu(t),\n$$\nwhere $v$ is the membrane potential in millivolts (mV), $t$ is time in seconds (s), $V_L$ is the leak reversal potential (mV), $\\tau$ is the membrane time constant (s), $D$ is the diffusion coefficient (mV$^2$/s), and $W_t$ is a standard Wiener process. Spikes occur when $v$ reaches the threshold $V_{\\mathrm{th}}$ (mV); after a spike, the neuron is reset to $V_r$ (mV). The stochastic population density $p(v,t)$ over membrane potential obeys the Fokker-Planck (FP) equation\n$$\n\\frac{\\partial p(v,t)}{\\partial t} = -\\frac{\\partial}{\\partial v}\\left[a(v,t)\\,p(v,t)\\right] + \\frac{\\partial^2}{\\partial v^2}\\left[D\\,p(v,t)\\right],\n$$\nposed on the bounded domain $v \\in [V_{\\min}, V_{\\mathrm{th}}]$, with the absorbing boundary condition $p(V_{\\mathrm{th}},t)=0$ and a reflecting boundary at $V_{\\min}$ implemented by zero net probability current there. The probability current is\n$$\nJ(v,t) = a(v,t)\\,p(v,t) - D \\frac{\\partial p(v,t)}{\\partial v},\n$$\nand the spike flux at threshold, $J(V_{\\mathrm{th}},t)$, is reinjected as a source at the reset potential $V_r$ to conserve mass. The initial density $p(v,0)$ is a Gaussian on $[V_{\\min}, V_{\\mathrm{th}}]$, truncated to the domain and normalized.\n\nA common approximation to the FP dynamics is Gaussian moment closure, where one assumes $p(v,t)$ remains Gaussian (ignoring threshold absorption and reset) and evolves only through its mean and variance. Under this closure, the mean $m(t)$ and variance $s^2(t)$ obey ordinary differential equations (ODEs) derived from the SDE drift and diffusion.\n\nTask: Implement a numerical solver to compute, for each specified transient input $\\mu(t)$, both:\n- A full finite-volume solution of the FP equation with absorbing threshold, reflecting lower boundary, and reset reinjection; and\n- A Gaussian moment closure solution evolving the mean and variance ODEs and reconstructing a Gaussian density on the same spatial grid.\n\nThen, at a specified final time $T$, assess the accuracy of Gaussian moment closure by computing the $L^1$ error between the full FP density and the Gaussian density restricted to $[V_{\\min}, V_{\\mathrm{th}}]$:\n$$\nE = \\int_{V_{\\min}}^{V_{\\mathrm{th}}} \\left| p_{\\mathrm{FP}}(v,T) - p_{\\mathrm{G}}(v,T) \\right|\\,\\mathrm{d}v,\n$$\napproximated by a Riemann sum on the numerical grid. The error $E$ is dimensionless.\n\nUse a conservative finite-volume scheme with upwind for the advective current and central differences for the diffusive current. Ensure explicit time-stepping stability through appropriate choices of time step. For Gaussian moment closure, integrate the mean and variance ODEs using the same time step as the FP solver.\n\nPhysical units:\n- Voltage in millivolts (mV).\n- Time in seconds (s).\n- Diffusion coefficient in mV$^2$/s.\n- Output error is dimensionless and should be expressed as a decimal float.\n\nTest suite:\nFor all cases below, use the same fixed discretization parameters unless otherwise stated: $N$ grid cells, time step $\\Delta t$, and domain $[V_{\\min}, V_{\\mathrm{th}}]$. The transient input is piecewise-constant,\n$$\n\\mu(t) = \\begin{cases}\n\\mu_0, & 0 \\le t < t_{\\mathrm{on}}, \\\\\n\\mu_0 + \\mu_1, & t_{\\mathrm{on}} \\le t < t_{\\mathrm{off}}, \\\\\n\\mu_0, & t \\ge t_{\\mathrm{off}},\n\\end{cases}\n$$\nwith specified $\\mu_0$ and $\\mu_1$ in mV/s. The initial density is Gaussian with mean $m_0$ (mV) and variance $s_0^2$ (mV$^2$), truncated to $[V_{\\min}, V_{\\mathrm{th}}]$ and normalized.\n\nProvide the $L^1$ error $E$ for each of the following four parameter sets:\n\n- Case 1 (happy path, moderate transient): $\\tau = 0.02$ s, $V_L = -65$ mV, $V_{\\mathrm{th}} = -50$ mV, $V_r = -65$ mV, $V_{\\min} = -80$ mV, $D = 0.3$ mV$^2$/s, $m_0 = -67$ mV, $s_0^2 = 1.5$ mV$^2$, $\\mu_0 = 10$ mV/s, $\\mu_1 = 20$ mV/s, $t_{\\mathrm{on}} = 0.005$ s, $t_{\\mathrm{off}} = 0.03$ s, $T = 0.05$ s, $N = 300$, $\\Delta t = 1\\times 10^{-4}$ s.\n\n- Case 2 (boundary-light, low drive): $\\tau = 0.02$ s, $V_L = -65$ mV, $V_{\\mathrm{th}} = -50$ mV, $V_r = -65$ mV, $V_{\\min} = -80$ mV, $D = 0.3$ mV$^2$/s, $m_0 = -65$ mV, $s_0^2 = 1.0$ mV$^2$, $\\mu_0 = 0$ mV/s, $\\mu_1 = 0$ mV/s, $t_{\\mathrm{on}} = 0.0$ s, $t_{\\mathrm{off}} = 0.0$ s, $T = 0.03$ s, $N = 300$, $\\Delta t = 1\\times 10^{-4}$ s.\n\n- Case 3 (edge case, strong transient): $\\tau = 0.02$ s, $V_L = -65$ mV, $V_{\\mathrm{th}} = -50$ mV, $V_r = -65$ mV, $V_{\\min} = -80$ mV, $D = 0.3$ mV$^2$/s, $m_0 = -67$ mV, $s_0^2 = 1.0$ mV$^2$, $\\mu_0 = 0$ mV/s, $\\mu_1 = 80$ mV/s, $t_{\\mathrm{on}} = 0.005$ s, $t_{\\mathrm{off}} = 0.015$ s, $T = 0.02$ s, $N = 300$, $\\Delta t = 1\\times 10^{-4}$ s.\n\n- Case 4 (deterministic limit, zero diffusion): $\\tau = 0.02$ s, $V_L = -65$ mV, $V_{\\mathrm{th}} = -50$ mV, $V_r = -65$ mV, $V_{\\min} = -80$ mV, $D = 0.0$ mV$^2$/s, $m_0 = -67$ mV, $s_0^2 = 1.0$ mV$^2$, $\\mu_0 = 0$ mV/s, $\\mu_1 = 30$ mV/s, $t_{\\mathrm{on}} = 0.005$ s, $t_{\\mathrm{off}} = 0.025$ s, $T = 0.03$ s, $N = 300$, $\\Delta t = 1\\times 10^{-4}$ s.\n\nFinal output format:\nYour program should produce a single line of output containing the four $L^1$ errors as a comma-separated list enclosed in square brackets (e.g., \"[e1,e2,e3,e4]\"), where each entry is a decimal float corresponding to the respective case above.",
            "solution": "The problem is valid. It presents a well-posed, scientifically grounded task in computational neuroscience, providing all necessary parameters, equations, and conditions for a unique solution. The models and numerical methods described are standard in the field.\n\nThe solution is approached by implementing two separate numerical simulations that are run in parallel: one for the full Fokker-Planck (FP) equation and one for the Gaussian moment closure approximation. Both are advanced in time using an explicit Euler method with the same time step, $\\Delta t$.\n\n### 1. Gaussian Moment Closure\nThe Gaussian moment closure approximates the probability density $p(v,t)$ as a Gaussian distribution, $p_{\\mathrm{G}}(v,t)$, for all time, characterized solely by its mean $m(t)$ and variance $s^2(t)$. This approximation neglects the effects of the absorbing and resetting boundaries. The dynamics of the moments are derived from the stochastic differential equation (SDE) for a single neuron:\n$$\n\\mathrm{d}v = a(v,t)\\,\\mathrm{d}t + \\sqrt{2D}\\,\\mathrm{d}W_t, \\quad \\text{where} \\quad a(v,t) = -\\frac{v-V_L}{\\tau} + \\mu(t).\n$$\nTaking the expectation of the SDE gives the ODE for the mean $m(t) = \\mathbb{E}[v(t)]$:\n$$\n\\frac{d m(t)}{dt} = \\mathbb{E}\\left[-\\frac{v-V_L}{\\tau} + \\mu(t)\\right] = -\\frac{\\mathbb{E}[v]-V_L}{\\tau} + \\mu(t)\n$$\n$$\n\\frac{d m}{d t} = -\\frac{m - V_L}{\\tau} + \\mu(t).\n$$\nApplying Itô's lemma to $(v-m)^2$ and taking the expectation yields the ODE for the variance $s^2(t) = \\mathbb{E}[(v-m)^2]$:\n$$\n\\frac{d s^2(t)}{dt} = \\mathbb{E}\\left[-\\frac{2(v-m)^2}{\\tau}\\right] + 2D = -\\frac{2\\mathbb{E}[(v-m)^2]}{\\tau} + 2D\n$$\n$$\n\\frac{d s^2}{d t} = -\\frac{2s^2}{\\tau} + 2D.\n$$\nThese two ODEs are integrated from their initial conditions $m(0)=m_0$ and $s^2(0)=s_0^2$ to the final time $T$ using an explicit Euler scheme:\n$$\nm_{k+1} = m_k + \\Delta t \\left( -\\frac{m_k - V_L}{\\tau} + \\mu(t_k) \\right)\n$$\n$$\ns^2_{k+1} = s^2_k + \\Delta t \\left( -\\frac{2s^2_k}{\\tau} + 2D \\right)\n$$\nwhere $t_k = k\\Delta t$.\n\n### 2. Fokker-Planck Equation Solver (Finite Volume Method)\nThe full FP dynamics are solved numerically on a spatial grid discretizing the domain $v \\in [V_{\\min}, V_{\\mathrm{th}}]$ into $N$ cells of width $\\Delta v = (V_{\\mathrm{th}}-V_{\\min})/N$. The probability density $p(v,t)$ is represented by its values $p_i(t)$ at the center of each cell $i$. The time evolution of $p_i(t)$ is governed by the conservation law for probability:\n$$\n\\frac{d p_i}{d t} = \\frac{1}{\\Delta v} \\left( J_{i-1/2} - J_{i+1/2} \\right) + S_i,\n$$\nwhere $J_{i \\pm 1/2}$ is the probability current at the interfaces of cell $i$, and $S_i$ is a source term. We use an explicit Euler method for time-stepping.\n\nThe probability current $J(v,t) = a(v,t)p(v,t) - D \\frac{\\partial p(v,t)}{\\partial v}$ is discretized at the cell interfaces $v_{i+1/2}$.\n- The advective term $a(v,t)p(v,t)$ is handled with a first-order upwind scheme to ensure stability. The flux at interface $i+1/2$ is $a_{i+1/2} p_i$ if the drift $a_{i+1/2} > 0$ and $a_{i+1/2} p_{i+1}$ if $a_{i+1/2} < 0$.\n- The diffusive term $-D \\frac{\\partial p}{\\partial v}$ is discretized using a second-order central difference: $-D(p_{i+1}-p_i)/\\Delta v$.\n\nThe complete discretized flux at interface $v_{i+1/2}$ is:\n$$\nJ_{i+1/2} = \\max(a_{i+1/2}, 0) p_i + \\min(a_{i+1/2}, 0) p_{i+1} - D \\frac{p_{i+1} - p_i}{\\Delta v}.\n$$\n\nBoundary conditions are implemented as follows:\n- **Reflecting at $V_{\\min}$:** The net flux is zero, so $J_{-1/2} = 0$.\n- **Absorbing at $V_{\\mathrm{th}}$:** The density is held at zero, $p(V_{\\mathrm{th}}, t) = 0$. This is imposed by setting the density in a \"ghost\" cell $p_N=0$ when computing the flux $J_{N-1/2}$ out of the last grid cell. The flux at threshold, $J_{\\mathrm{th}} \\equiv J_{N-1/2}$, represents the neuron firing rate.\n- **Reset:** The total probability flux lost at threshold, $J_{\\mathrm{th}}$, is re-injected as a source term into the cell corresponding to the reset potential $V_r$. If $V_r$ falls into cell $j$, the update for that cell includes an additional term: $p_j^{k+1} \\leftarrow p_j^{k+1} + (J_{\\mathrm{th}}^k \\Delta t) / \\Delta v$.\n\n### 3. Initial Conditions and Error Calculation\nThe initial density $p(v,0)$ is a Gaussian with mean $m_0$ and variance $s_0^2$, truncated to the domain $[V_{\\min}, V_{\\mathrm{th}}]$. To ensure $\\int_{V_{\\min}}^{V_{\\mathrm{th}}} p(v,0) dv = 1$, we compute the normalization constant using the error function, `erf`, available in SciPy:\n$$\nC = \\frac{1}{2} \\left[ \\text{erf}\\left(\\frac{V_{\\mathrm{th}}-m_0}{\\sqrt{2s_0^2}}\\right) - \\text{erf}\\left(\\frac{V_{\\min}-m_0}{\\sqrt{2s_0^2}}\\right) \\right].\n$$\nThe initial density on the grid is $p_i(0) = \\frac{1}{C\\sqrt{2\\pi s_0^2}} \\exp\\left(-\\frac{(v_i - m_0)^2}{2s_0^2}\\right)$. For the specified parameters, this normalization is very close to $1$.\n\nAfter evolving both systems to time $T$, we obtain the final FP density $p_{\\mathrm{FP}}(v,T)$ and the final Gaussian parameters $m(T)$ and $s^2(T)$. A Gaussian density $p_{\\mathrm{G}}(v,T)$ is constructed from these parameters on the same grid. The $L^1$ error is then computed via a Riemann sum:\n$$\nE = \\int_{V_{\\min}}^{V_{\\mathrm{th}}} |p_{\\mathrm{FP}}(v,T) - p_{\\mathrm{G}}(v,T)| dv \\approx \\sum_{i=0}^{N-1} |p_{\\mathrm{FP},i}(T) - p_{\\mathrm{G},i}(T)| \\Delta v.\n$$\nThis procedure is repeated for each of the four test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import erf\n\ndef run_simulation(\n    tau, V_L, V_th, V_r, V_min, D, m0, s0_2, mu0, mu1, t_on, t_off, T, N, dt\n):\n    \"\"\"\n    Solves the Fokker-Planck and Gaussian closure models and computes the L1 error.\n    \"\"\"\n    # 1. Grid and Time Setup\n    dv = (V_th - V_min) / N\n    v_centers = V_min + (np.arange(N) + 0.5) * dv\n    v_interfaces = V_min + np.arange(N + 1) * dv\n    time_steps = int(round(T / dt))\n\n    # 2. Initial Conditions\n    # Fokker-Planck Initial Density (Truncated & Normalized Gaussian)\n    s0 = np.sqrt(s0_2)\n    if s0 > 0:\n        z_th = (V_th - m0) / (np.sqrt(2) * s0)\n        z_min = (V_min - m0) / (np.sqrt(2) * s0)\n        norm_factor = 0.5 * (erf(z_th) - erf(z_min))\n        if norm_factor < 1e-9: norm_factor = 1.0 # Avoid division by zero if all mass is outside\n        \n        p_fp = (1.0 / (s0 * np.sqrt(2 * np.pi) * norm_factor)) * \\\n               np.exp(-(v_centers - m0)**2 / (2 * s0_2))\n    else: # Dirac delta initial condition\n        p_fp = np.zeros(N)\n        idx = np.argmin(np.abs(v_centers - m0))\n        p_fp[idx] = 1.0 / dv\n\n    # Gaussian Closure Initial State\n    m_g, s2_g = m0, s0_2\n\n    # Reset bin index for FP solver\n    reset_idx = int((V_r - V_min) / dv)\n    # Ensure index is within bounds [0, N-1]\n    reset_idx = max(0, min(N - 1, reset_idx))\n\n    # 3. Time Evolution Loop\n    for k in range(time_steps):\n        t = k * dt\n        \n        mu_t = mu0 + mu1 if t_on <= t < t_off else mu0\n        \n        # --- A. Gaussian Moment Closure Step ---\n        dm_dt = -(m_g - V_L) / tau + mu_t\n        ds2_dt = -2 * s2_g / tau + 2 * D\n        \n        m_g += dm_dt * dt\n        s2_g += ds2_dt * dt\n        s2_g = max(0, s2_g) # Ensure variance is non-negative\n\n        # --- B. Fokker-Planck Step ---\n        a_int = -(v_interfaces - V_L) / tau + mu_t\n        \n        J = np.zeros(N + 1) # Fluxes at N+1 interfaces\n        \n        # Internal fluxes: J_{1/2} to J_{N-3/2}, corresponding to J[1]...J[N-1]\n        p_left, p_right = p_fp[:-1], p_fp[1:]\n        a_mid = a_int[1:N]\n        \n        # Advection term (upwind)\n        J_adv = np.where(a_mid >= 0, a_mid * p_left, a_mid * p_right)\n        \n        # Diffusion term (central difference)\n        J_diff = -D * (p_right - p_left) / dv\n        \n        J[1:N] = J_adv + J_diff\n\n        # Boundary fluxes\n        # J[0] = J_{-1/2} (at V_min) is 0 (reflecting)\n        J[0] = 0.0\n        \n        # J[N] = J_{N-1/2} (at V_th) is absorbing\n        a_th = a_int[N]\n        J_th_adv = max(a_th, 0) * p_fp[-1]\n        J_th_diff = -D * (0.0 - p_fp[-1]) / dv # Assume ghost cell p_N = 0\n        J[N] = J_th_adv + J_th_diff\n        \n        spike_flux = J[N]\n        \n        # Update densities using flux divergence\n        p_fp += (J[:-1] - J[1:]) * (dt / dv)\n        \n        # Re-inject spike flux at V_r\n        p_fp[reset_idx] += spike_flux * dt / dv\n        \n    # 4. Final Error Calculation\n    # Final Gaussian density\n    if s2_g > 1e-12:\n        p_g = (1.0 / np.sqrt(2 * np.pi * s2_g)) * \\\n              np.exp(-(v_centers - m_g)**2 / (2 * s2_g))\n    else: # Approximate delta function if variance is zero/tiny\n        p_g = np.zeros(N)\n        idx = np.argmin(np.abs(v_centers - m_g))\n        p_g[idx] = 1.0 / dv\n\n    # L1 Error\n    l1_error = np.sum(np.abs(p_fp - p_g)) * dv\n    \n    return l1_error\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        {'tau': 0.02, 'V_L': -65., 'V_th': -50., 'V_r': -65., 'V_min': -80., 'D': 0.3, 'm0': -67., 's0_2': 1.5, 'mu0': 10., 'mu1': 20., 't_on': 0.005, 't_off': 0.03, 'T': 0.05, 'N': 300, 'dt': 1e-4},\n        # Case 2\n        {'tau': 0.02, 'V_L': -65., 'V_th': -50., 'V_r': -65., 'V_min': -80., 'D': 0.3, 'm0': -65., 's0_2': 1.0, 'mu0': 0., 'mu1': 0., 't_on': 0.0, 't_off': 0.0, 'T': 0.03, 'N': 300, 'dt': 1e-4},\n        # Case 3\n        {'tau': 0.02, 'V_L': -65., 'V_th': -50., 'V_r': -65., 'V_min': -80., 'D': 0.3, 'm0': -67., 's0_2': 1.0, 'mu0': 0., 'mu1': 80., 't_on': 0.005, 't_off': 0.015, 'T': 0.02, 'N': 300, 'dt': 1e-4},\n        # Case 4\n        {'tau': 0.02, 'V_L': -65., 'V_th': -50., 'V_r': -65., 'V_min': -80., 'D': 0.0, 'm0': -67., 's0_2': 1.0, 'mu0': 0., 'mu1': 30., 't_on': 0.005, 't_off': 0.025, 'T': 0.03, 'N': 300, 'dt': 1e-4},\n    ]\n\n    results = []\n    for params in test_cases:\n        error = run_simulation(**params)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n\n```"
        }
    ]
}