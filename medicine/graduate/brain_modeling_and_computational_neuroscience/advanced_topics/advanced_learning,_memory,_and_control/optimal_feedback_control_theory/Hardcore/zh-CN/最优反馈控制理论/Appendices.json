{
    "hands_on_practices": [
        {
            "introduction": "要想真正掌握最优反馈控制，我们必须从其最基本的构件——动态规划——入手。本练习要求您使用贝尔曼方程，从第一性原理出发求解一个简单的有限时域线性二次控制问题。通过一步步完成这个解析推导，您将巩固对反向递推逻辑的理解，并揭示最优控制律是如何随时间构建的。",
            "id": "4006058",
            "problem": "考虑一个简化的神经控制情境，其中单个标量皮层活动变量 $x_t$ 编码一个与运动相关的状态，该状态需要通过运动指令 $u_t$ 在一个短的规划时域内进行调节。该神经对象根据离散时间线性动力学 $x_{t+1} = a x_t + b u_t$ 演化，其中 $a \\in \\mathbb{R}$ 模拟内在状态传播，$b \\in \\mathbb{R}$ 模拟控制效能。在一个两步时域 $t \\in \\{0,1\\}$ 内，目标是选择控制量 $u_0$ 和 $u_1$ 以最小化累积二次代价\n$$J = q x_0^{2} + r u_0^{2} + q x_1^{2} + r u_1^{2} + q x_2^{2},$$\n其中 $q \\ge 0$ 惩罚状态偏差（可解释为任务误差或与神经目标的偏差），$r > 0$ 惩罚控制努力（可解释为运动指令的能量成本）。在时间 $t=2$ 时的最终惩罚 $q x_2^{2}$ 反映了终端偏差成本。假设初始状态 $x_0 \\in \\mathbb{R}$ 已知且 $b \\ne 0$。使用应用于此有限时域问题的 Bellman 最优性原理（动态规划），显式地推导出最优初始控制 $u_0^{\\star}$，作为 $a$、$b$、$q$、$r$ 和 $x_0$ 的函数。将您的最终答案表示为单个闭式解析表达式。无需四舍五入，答案不附带任何物理单位。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n**步骤 1：提取已知条件**\n- **系统动力学：** 状态 $x_t \\in \\mathbb{R}$ 根据离散时间线性方程 $x_{t+1} = a x_t + b u_t$ 演化。\n- **控制输入：** $u_t \\in \\mathbb{R}$。\n- **系统参数：** $a \\in \\mathbb{R}$，$b \\in \\mathbb{R}$，约束条件为 $b \\ne 0$。\n- **时间范围：** 问题定义在一个两步时域内，$t \\in \\{0,1\\}$，状态最高到 $x_2$。\n- **代价函数：** 目标是最小化累积代价 $J = q x_0^{2} + r u_0^{2} + q x_1^{2} + r u_1^{2} + q x_2^{2}$。\n- **代价参数：** $q \\ge 0$ 且 $r > 0$。\n- **初始条件：** 初始状态 $x_0 \\in \\mathbb{R}$ 已知。\n- **目标：** 推导最优初始控制 $u_0^{\\star}$，作为 $a$、$b$、$q$、$r$ 和 $x_0$ 的函数。\n- **方法论：** 使用 Bellman 最优性原理（动态规划）。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题是一个经典的有限时域、离散时间线性二次调节器（LQR）问题。这是最优控制理论中的一个基本课题，也是一个成熟的、科学上有效的框架，用于为控制系统建模，包括计算神经科学中的简化模型。\n- **适定性：** 该问题是适定的。由于状态惩罚系数 $q \\ge 0$ 且控制惩罚系数 $r > 0$，代价函数是二次且凸的。系统动力学是线性的。条件 $r > 0$ 确保了控制输入存在唯一最小值。条件 $b \\ne 0$ 确保了系统是可控的。因此，对于最优控制序列，存在一个唯一的、稳定的、有意义的解。\n- **目标：** 问题使用精确的数学语言陈述，没有歧义或主观声明。\n- **缺陷清单：** 该问题未违反任何无效性标准。它在科学上是合理的、可形式化的、完整的、可行的和适定的。这是一个需要实质性推理的标准问题。\n\n**步骤 3：结论与行动**\n该问题是**有效的**。将推导解答。\n\n### 最优控制的推导\n问题在于找到最小化代价函数 $J$ 的控制序列 $u_0, u_1$。我们将使用动态规划，从最后的时间步 $t=2$ 开始逆向求解。\n\n代价函数为 $J = q x_0^{2} + r u_0^{2} + q x_1^{2} + r u_1^{2} + q x_2^{2}$。这可以通过定义阶段代价 $L(x_t, u_t) = q x_t^2 + r u_t^2$（对于 $t \\in \\{0, 1\\}$）和终端代价 $M(x_2) = q x_2^2$ 来构建动态规划。总代价则为 $J = L(x_0, u_0) + L(x_1, u_1) + M(x_2)$。\n\n我们定义最优未来成本（或价值函数）$V_t(x_t)$ 为从时间 $t$ 的状态 $x_t$ 到时域末端可实现的最小代价。\n\n**步骤 T=2（最后一步）：**\n在终端时间 $t=2$ 的价值函数就是终端代价：\n$$V_2(x_2) = M(x_2) = q x_2^2$$\n这是状态的二次函数。我们可以将其写为 $V_2(x_2) = P_2 x_2^2$，其中 $P_2 = q$。\n\n**步骤 T=1：**\n根据 Bellman 原理，在时间 $t=1$ 的价值函数由下式给出：\n$$V_1(x_1) = \\min_{u_1} \\left[ L(x_1, u_1) + V_2(x_2) \\right]$$\n代入阶段代价、价值函数 $V_2$ 和系统动力学 $x_2 = a x_1 + b u_1$ 的表达式：\n$$V_1(x_1) = \\min_{u_1} \\left[ q x_1^2 + r u_1^2 + P_2(a x_1 + b u_1)^2 \\right]$$\n为了找到最小化此表达式的最优控制 $u_1^{\\star}$，我们对 $u_1$ 求偏导数并令其为零。由于 $r>0$，关于 $u_1$ 的二次函数是严格凸的，这将得到唯一的最小值。\n$$\\frac{\\partial}{\\partial u_1} \\left[ q x_1^2 + r u_1^2 + P_2(a x_1 + b u_1)^2 \\right] = 2 r u_1 + 2 P_2 (a x_1 + b u_1) b = 0$$\n$$r u_1 + P_2 a b x_1 + P_2 b^2 u_1 = 0$$\n$$(r + P_2 b^2) u_1 = -P_2 a b x_1$$\n$$u_1^{\\star}(x_1) = -\\frac{P_2 a b}{r + P_2 b^2} x_1$$\n这是 $t=1$ 时的最优反馈控制律。现在我们通过将 $u_1^{\\star}$ 代入其定义来找到价值函数 $V_1(x_1)$。该价值函数也将是状态的二次函数，$V_1(x_1) = P_1 x_1^2$。\n$$V_1(x_1) = q x_1^2 + r (u_1^{\\star})^2 + P_2(a x_1 + b u_1^{\\star})^2$$\n代入 $u_1^{\\star} = -K_1 x_1$，其中 $K_1 = \\frac{P_2 a b}{r + P_2 b^2}$：\n$$V_1(x_1) = q x_1^2 + r K_1^2 x_1^2 + P_2(a - b K_1)^2 x_1^2 = \\left( q + r K_1^2 + P_2(a - b K_1)^2 \\right) x_1^2$$\n因此，$P_1 = q + r K_1^2 + P_2(a - b K_1)^2$。这个更新的一个更直接的形式是离散时间 Riccati 方程，$P_1 = q + a^2 P_2 - \\frac{(a b P_2)^2}{r + b^2 P_2} = q + \\frac{a^2 P_2 r}{r + b^2 P_2}$。\n代入 $P_2 = q$：\n$$P_1 = q + \\frac{a^2 q r}{r + q b^2}$$\n\n**步骤 T=0：**\n我们对 $t=0$ 重复此过程以找到所需的最优控制 $u_0^{\\star}$。在 $t=0$ 时的价值函数为：\n$$V_0(x_0) = \\min_{u_0} \\left[ L(x_0, u_0) + V_1(x_1) \\right]$$\n代入阶段代价、$V_1(x_1) = P_1 x_1^2$ 和动力学 $x_1 = a x_0 + b u_0$：\n$$V_0(x_0) = \\min_{u_0} \\left[ q x_0^2 + r u_0^2 + P_1(a x_0 + b u_0)^2 \\right]$$\n项 $q x_0^2$ 不依赖于 $u_0$，因此不影响优化。为了找到 $u_0^{\\star}$，我们将最小值内的表达式对 $u_0$ 求导并令其为零：\n$$\\frac{\\partial}{\\partial u_0} \\left[ q x_0^2 + r u_0^2 + P_1(a x_0 + b u_0)^2 \\right] = 2 r u_0 + 2 P_1(a x_0 + b u_0) b = 0$$\n$$r u_0 + P_1 a b x_0 + P_1 b^2 u_0 = 0$$\n$$(r + P_1 b^2) u_0 = -P_1 a b x_0$$\n$$u_0^{\\star}(x_0) = -\\frac{P_1 a b}{r + P_1 b^2} x_0$$\n最后一步是将 $P_1$ 的表达式代入此方程，以得到作为给定参数函数的 $u_0^{\\star}$。\n我们有 $P_1 = q + \\frac{a^2 q r}{r + q b^2} = \\frac{q(r + q b^2) + a^2 q r}{r + q b^2} = \\frac{q r + q^2 b^2 + a^2 q r}{r + q b^2} = \\frac{q(r(1+a^2) + q b^2)}{r + q b^2}$。\n\n现在，我们计算 $u_0^{\\star}$ 表达式的各个组成部分：\n分子项是 $P_1 a b x_0$：\n$$P_1 a b x_0 = a b x_0 \\frac{q(r(1+a^2) + q b^2)}{r + q b^2}$$\n分母项是 $r + P_1 b^2$：\n$$r + P_1 b^2 = r + b^2 \\left( q + \\frac{a^2 q r}{r + q b^2} \\right) = r + q b^2 + \\frac{a^2 q r b^2}{r + q b^2}$$\n$$= \\frac{(r+q b^2)^2 + a^2 q r b^2}{r + q b^2}$$\n现在，构建 $u_0^{\\star}$ 的分数形式：\n$$u_0^{\\star} = - \\frac{P_1 a b}{r + P_1 b^2} x_0 = -abx_0 \\frac{P_1}{r+P_1b^2} = -abx_0 \\frac{\\frac{q(r(1+a^2) + q b^2)}{r + q b^2}}{\\frac{(r+q b^2)^2 + a^2 q r b^2}{r + q b^2}}$$\n通过消去分子分数和分母分数中的公分母项 $(r + q b^2)$ 来进行简化：\n$$u_0^{\\star} = -abx_0 \\frac{q(r(1+a^2) + q b^2)}{(r+q b^2)^2 + a^2 q r b^2}$$\n这可以写成一个单一的分数：\n$$u_0^{\\star} = - \\frac{a b q (r(1+a^2) + q b^2) x_0}{(r+q b^2)^2 + a^2 r q b^2}$$\n这个最终表达式给出了最优初始控制 $u_0^{\\star}$，它是系统参数 $a, b$、代价参数 $q, r$ 和初始状态 $x_0$ 的函数，符合题目要求。",
            "answer": "$$\\boxed{-\\frac{a b q (r(1+a^{2}) + q b^{2}) x_0}{(r+q b^{2})^{2} + a^{2} r q b^{2}}}$$"
        },
        {
            "introduction": "除了寻找控制律，最优控制的一个关键方面是理解系统本身的内在属性。本练习将介绍可控性格拉姆矩阵（controllability Gramian），这是一个量化驱动系统状态所需“能量”的强大工具。通过计算格拉姆矩阵并解释其结构，您将对为什么状态空间中的某些方向比其他方向“更容易”控制建立起几何直觉，这是理解运动效率的核心概念。",
            "id": "4006062",
            "problem": "考虑一个连续时间线性时不变神经群体模型，其状态 $\\mathbf{x}(t) \\in \\mathbb{R}^{2}$ 遵循动力学方程 $\\frac{d\\mathbf{x}}{dt} = A \\mathbf{x} + B u(t)$，其中 $A \\in \\mathbb{R}^{2 \\times 2}$ 模拟突触泄漏和区域间耦合，而 $B \\in \\mathbb{R}^{2 \\times 1}$ 指定了单个刺激通道。设\n$$\nA = \\begin{pmatrix}\n-1  2 \\\\\n-3  -2\n\\end{pmatrix}, \n\\quad\nB = \\begin{pmatrix}\n1 \\\\\n0\n\\end{pmatrix}.\n$$\n假设 $A$ 是稳定的（所有特征值的实部都严格为负），并定义无穷时域可控性格拉姆矩阵为\n$$\nW_c = \\int_{0}^{\\infty} \\exp(A t)\\, B B^{\\top} \\exp(A^{\\top} t)\\, dt.\n$$\n从给定的积分定义以及矩阵指数和线性时不变系统的基本性质出发，精确计算 $W_c$。然后，运用连续时间最优反馈控制理论的基础知识，解释为什么 $W_c$ 的特征向量指出了状态空间中较易或较难控制的方向，以及这与最小控制能量有何关系。\n\n最后，设控制目标是在某个足够大的终端时间将系统从静息状态 $\\mathbf{x}(0) = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 驱动到目标状态 $\\mathbf{x}_f = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$，以便无穷时域可控性格拉姆矩阵适用。在所有对于足够大的 $T$ 能实现 $\\mathbf{x}(T) = \\mathbf{x}_f$ 的容许输入 $u(t)$ 中，你需要计算的是最小平方 $L^{2}$ 控制能量。请将你的最终答案表示为一个实数（无量纲）。无需四舍五入。",
            "solution": "用户希望解决一个基于最优反馈控制理论的问题。\n\n### 步骤1：提取已知条件\n-   系统动力学：$\\frac{d\\mathbf{x}}{dt} = A \\mathbf{x} + B u(t)$，其中 $\\mathbf{x}(t) \\in \\mathbb{R}^{2}$。\n-   系统矩阵：$A = \\begin{pmatrix} -1  2 \\\\ -3  -2 \\end{pmatrix}$。\n-   输入矩阵：$B = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$。\n-   假设：矩阵 $A$ 是稳定的。\n-   无穷时域可控性格拉姆矩阵的定义：$W_c = \\int_{0}^{\\infty} \\exp(A t)\\, B B^{\\top} \\exp(A^{\\top} t)\\, dt$。\n-   初始状态：$\\mathbf{x}(0) = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。\n-   目标状态：$\\mathbf{x}_f = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n-   目标：\n    1.  精确计算 $W_c$。\n    2.  解释为什么 $W_c$ 的特征向量指出了较易/较难控制的方向。\n    3.  在无穷时域极限下，计算将系统从 $\\mathbf{x}(0)$ 驱动到 $\\mathbf{x}_f$ 的最小平方 $L^2$ 控制能量。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据、适定且客观。它根植于标准的线性时不变（LTI）控制理论。\n\n1.  **科学或事实上的不健全性**：该模型是一个标准的LTI状态空间表示，是控制理论的基石，也是计算神经科学中常见的简化方法。可控性格拉姆矩阵和最小控制能量的概念是基础且数学上严谨的。\n2.  **适定性**：该问题需要检查 $A$ 的稳定性以及矩阵对 $(A, B)$ 的可控性。\n    -   **$A$ 的稳定性**：特征方程为 $\\det(A - \\lambda I) = 0$。\n        $$ (\\!-\\!1-\\lambda)(-2-\\lambda) - (2)(-3) = \\lambda^2+3\\lambda+2+6 = \\lambda^2+3\\lambda+8 = 0 $$\n        特征值为 $\\lambda = \\frac{-3 \\pm \\sqrt{3^2 - 4(1)(8)}}{2} = \\frac{-3 \\pm i\\sqrt{23}}{2}$。两个特征值的实部均为 $-\\frac{3}{2}$，严格为负。因此，系统矩阵 $A$ 是稳定的（赫尔维茨稳定），假设成立。$W_c$ 的积分收敛。\n    -   **可控性**：可控性矩阵为 $\\mathcal{C} = \\begin{pmatrix} B  AB \\end{pmatrix}$。\n        $$ AB = \\begin{pmatrix} -1  2 \\\\ -3  -2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -1 \\\\ -3 \\end{pmatrix} $$\n        $$ \\mathcal{C} = \\begin{pmatrix} 1  -1 \\\\ 0  -3 \\end{pmatrix} $$\n        行列式为 $\\det(\\mathcal{C}) = (1)(-3) - (-1)(0) = -3 \\neq 0$。系统是可控的，因此任何有限状态 $\\mathbf{x}_f$ 都可以从原点到达。\n3.  **完整性**：所有必需的矩阵、定义和边界条件都已提供。\n\n该问题有效。\n\n### 步骤3：结论与行动\n问题有效，可以解决。\n\n解答按要求分为三部分。\n\n**第1部分：可控性格拉姆矩阵 $W_c$ 的计算**\n\n对于一个稳定的LTI系统，无穷时域可控性格拉姆矩阵 $W_c = \\int_{0}^{\\infty} \\exp(A t)\\, B B^{\\top} \\exp(A^{\\top} t)\\, dt$ 是以下连续时间李雅普诺夫方程的唯一对称正定解：\n$$ A W_c + W_c A^{\\top} = -BB^{\\top} $$\n这个方程是通过对被积函数 $\\exp(A t)\\, B B^{\\top} \\exp(A^{\\top} t)$ 的导数从 $t=0$ 到 $t=\\infty$ 进行积分，并利用 $A$ 的稳定性推导出的一个基本性质。\n\n设 $W_c = \\begin{pmatrix} w_{11}  w_{12} \\\\ w_{21}  w_{22} \\end{pmatrix}$。由于对称性，$w_{12} = w_{21}$。\n各矩阵为：\n$$ A = \\begin{pmatrix} -1  2 \\\\ -3  -2 \\end{pmatrix}, \\quad A^{\\top} = \\begin{pmatrix} -1  -3 \\\\ 2  -2 \\end{pmatrix} $$\n$$ -BB^{\\top} = -\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} \\begin{pmatrix} 1  0 \\end{pmatrix} = -\\begin{pmatrix} 1  0 \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} -1  0 \\\\ 0  0 \\end{pmatrix} $$\n将这些代入李雅普诺夫方程：\n$$ \\begin{pmatrix} -1  2 \\\\ -3  -2 \\end{pmatrix} \\begin{pmatrix} w_{11}  w_{12} \\\\ w_{12}  w_{22} \\end{pmatrix} + \\begin{pmatrix} w_{11}  w_{12} \\\\ w_{12}  w_{22} \\end{pmatrix} \\begin{pmatrix} -1  -3 \\\\ 2  -2 \\end{pmatrix} = \\begin{pmatrix} -1  0 \\\\ 0  0 \\end{pmatrix} $$\n将左侧的矩阵相乘得到：\n$$ \\begin{pmatrix} -w_{11} + 2w_{12}  -w_{12} + 2w_{22} \\\\ -3w_{11} - 2w_{12}  -3w_{12} - 2w_{22} \\end{pmatrix} + \\begin{pmatrix} -w_{11} + 2w_{12}  -3w_{11} - 2w_{12} \\\\ -w_{12} + 2w_{22}  -3w_{12} - 2w_{22} \\end{pmatrix} = \\begin{pmatrix} -1  0 \\\\ 0  0 \\end{pmatrix} $$\n将这些矩阵相加得到：\n$$ \\begin{pmatrix} -2w_{11} + 4w_{12}  -3w_{11} - 3w_{12} + 2w_{22} \\\\ -3w_{11} - 3w_{12} + 2w_{22}  -6w_{12} - 4w_{22} \\end{pmatrix} = \\begin{pmatrix} -1  0 \\\\ 0  0 \\end{pmatrix} $$\n这就得到了一个关于 $W_c$ 三个未知元素的三元线性方程组：\n1.  $-2w_{11} + 4w_{12} = -1$\n2.  $-3w_{11} - 3w_{12} + 2w_{22} = 0$\n3.  $-6w_{12} - 4w_{22} = 0$\n\n从方程（3）可得，$w_{22} = -\\frac{6}{4}w_{12} = -\\frac{3}{2}w_{12}$。\n将此代入方程（2）：\n$$ -3w_{11} - 3w_{12} + 2\\left(-\\frac{3}{2}w_{12}\\right) = 0 \\implies -3w_{11} - 3w_{12} - 3w_{12} = 0 \\implies -3w_{11} = 6w_{12} \\implies w_{11} = -2w_{12} $$\n将 $w_{11}$ 的这个结果代入方程（1）：\n$$ -2(-2w_{12}) + 4w_{12} = -1 \\implies 4w_{12} + 4w_{12} = -1 \\implies 8w_{12} = -1 \\implies w_{12} = -\\frac{1}{8} $$\n现在，我们求出其他分量：\n$$ w_{11} = -2\\left(-\\frac{1}{8}\\right) = \\frac{1}{4} $$\n$$ w_{22} = -\\frac{3}{2}\\left(-\\frac{1}{8}\\right) = \\frac{3}{16} $$\n因此，可控性格拉姆矩阵为：\n$$ W_c = \\begin{pmatrix} \\frac{1}{4}  -\\frac{1}{8} \\\\ -\\frac{1}{8}  \\frac{3}{16} \\end{pmatrix} $$\n\n**第2部分：$W_c$ 特征向量的解释**\n\n可控性格拉姆矩阵 $W_c$ 刻画了从原点出发的可达状态。所有从 $\\mathbf{x}(0) = \\mathbf{0}$ 出发，使用总平方 $L^2$ 范数（能量）为单位1的控制输入 $u(t)$（即 $\\int_0^\\infty u(t)^2 dt \\leq 1$）可以达到的状态 $\\mathbf{x}$ 的集合，在状态空间中形成一个由二次型 $\\mathbf{x}^{\\top} W_c^{-1} \\mathbf{x} \\leq 1$ 定义的椭球。\n\n$W_c$ 的特征向量定义了这个可达集椭球的主轴。设对称矩阵 $W_c$ 的特征分解为 $W_c = V \\Lambda V^{\\top}$，其中 $V$ 是一个正交矩阵，其列是特征向量 $\\mathbf{v}_i$，$Λ$ 是相应特征值 $\\lambda_i$ 构成的对角矩阵。其逆矩阵为 $W_c^{-1} = V \\Lambda^{-1} V^{\\top}$。\n\n椭球方程变为 $\\mathbf{x}^{\\top} (V \\Lambda^{-1} V^{\\top}) \\mathbf{x} \\leq 1$。通过将坐标变换到特征向量基 $\\mathbf{y} = V^{\\top}\\mathbf{x}$，方程简化为 $\\mathbf{y}^{\\top} \\Lambda^{-1} \\mathbf{y} \\leq 1$，或 $\\sum_i \\frac{y_i^2}{\\lambda_i} \\leq 1$。沿第 $i$ 个特征向量方向的半轴长度为 $\\sqrt{\\lambda_i}$。\n\n大的特征值 $\\lambda_i$ 对应于椭球的一个长半轴。这意味着单位能量输入可以在相应特征向量 $\\mathbf{v}_i$ 的方向上将状态驱动得很远。因此，状态空间中与具有大特征值的特征向量对齐的方向是“容易”控制的；它们只需要很少的控制能量就能实现给定的位移。\n\n相反，小的特征值 $\\lambda_j$ 对应于一个短半轴。这意味着即使是单位能量输入也只能在 $\\mathbf{v}_j$ 的方向上将状态移动一小段距离。这些方向是“难以”控制的，需要大量的控制能量才能实现显著的位移。\n\n达到目标状态 $\\mathbf{x}_f$ 所需的最小控制能量公式 $E_{\\min} = \\mathbf{x}_f^{\\top} W_c^{-1} \\mathbf{x}_f$ 明确地捕捉了这种关系。如果 $\\mathbf{x}_f$ 是一个特征向量 $\\mathbf{v}_i$，那么 $E_{\\min} = \\mathbf{v}_i^{\\top} (V \\Lambda^{-1} V^{\\top}) \\mathbf{v}_i = \\mathbf{e}_i^{\\top} \\Lambda^{-1} \\mathbf{e}_i = 1/\\lambda_i$，其中 $\\mathbf{e}_i$ 是标准基向量。最小能量与特征值成反比，这在形式上将较大的特征值与较易控制联系起来。\n\n**第3部分：最小控制能量的计算**\n\n问题要求计算将系统在足够大的时间 $T$ 内从 $\\mathbf{x}(0) = \\mathbf{0}$ 引导到 $\\mathbf{x}(T) = \\mathbf{x}_f$ 的最小平方 $L^2$ 控制能量 $E_{\\min} = \\int_0^T u(t)^2 dt$。对于 $T \\to \\infty$，这个最小能量由以下二次型给出：\n$$ E_{\\min} = \\mathbf{x}_f^{\\top} W_c^{-1} \\mathbf{x}_f $$\n其中 $W_c$ 是在第1部分中计算的无穷时域可控性格拉姆矩阵。首先，我们必须计算 $W_c$ 的逆矩阵：\n$$ W_c = \\begin{pmatrix} \\frac{1}{4}  -\\frac{1}{8} \\\\ -\\frac{1}{8}  \\frac{3}{16} \\end{pmatrix} = \\frac{1}{16} \\begin{pmatrix} 4  -2 \\\\ -2  3 \\end{pmatrix} $$\n行列式为：\n$$ \\det(W_c) = \\left(\\frac{1}{4}\\right)\\left(\\frac{3}{16}\\right) - \\left(-\\frac{1}{8}\\right)^2 = \\frac{3}{64} - \\frac{1}{64} = \\frac{2}{64} = \\frac{1}{32} $$\n逆矩阵 $W_c^{-1}$ 为：\n$$ W_c^{-1} = \\frac{1}{\\det(W_c)} \\begin{pmatrix} \\frac{3}{16}  \\frac{1}{8} \\\\ \\frac{1}{8}  \\frac{1}{4} \\end{pmatrix} = 32 \\begin{pmatrix} \\frac{3}{16}  \\frac{1}{8} \\\\ \\frac{1}{8}  \\frac{1}{4} \\end{pmatrix} = \\begin{pmatrix} 32 \\cdot \\frac{3}{16}  32 \\cdot \\frac{1}{8} \\\\ 32 \\cdot \\frac{1}{8}  32 \\cdot \\frac{1}{4} \\end{pmatrix} = \\begin{pmatrix} 6  4 \\\\ 4  8 \\end{pmatrix} $$\n现在，我们用目标状态 $\\mathbf{x}_f = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$ 计算最小能量 $E_{\\min}$：\n$$ E_{\\min} = \\begin{pmatrix} 1  -1 \\end{pmatrix} \\begin{pmatrix} 6  4 \\\\ 4  8 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} $$\n首先，执行矩阵-向量乘法：\n$$ \\begin{pmatrix} 6  4 \\\\ 4  8 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 6(1) + 4(-1) \\\\ 4(1) + 8(-1) \\end{pmatrix} = \\begin{pmatrix} 6 - 4 \\\\ 4 - 8 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ -4 \\end{pmatrix} $$\n然后，执行最后的向量-向量乘法：\n$$ E_{\\min} = \\begin{pmatrix} 1  -1 \\end{pmatrix} \\begin{pmatrix} 2 \\\\ -4 \\end{pmatrix} = 1(2) + (-1)(-4) = 2 + 4 = 6 $$\n最小平方 $L^2$ 控制能量是 6。",
            "answer": "$$ \\boxed{6} $$"
        },
        {
            "introduction": "许多生物系统，如人的手臂，都是冗余的，这意味着有无数种方法可以完成同一项任务。本练习将最优控制应用于一个实际的机器人问题，使用二次规划来寻找关节层面的指令，以在实现期望的末端执行器运动的同时，最小化能量消耗并维持一个偏好的姿态。这项动手编程任务展示了瞬时最优控制如何解决冗余问题，这是为复杂的感觉运动行为建模时的一个关键挑战。",
            "id": "4006060",
            "problem": "考虑一个平面冗余机械臂，其具有三个旋转关节，被建模为一个运动链，连杆长度分别为 $L_1$、$L_2$ 和 $L_3$（单位：米）。设关节角度向量为 $q \\in \\mathbb{R}^3$（单位：弧度），关节速度指令为 $\\dot{q} \\in \\mathbb{R}^3$（单位：弧度/秒）。末端执行器在平面内的笛卡尔速度为 $v \\in \\mathbb{R}^2$（单位：米/秒），它通过运动学线性化关系与关节速度相关联\n$$\nv = J(q) \\, \\dot{q},\n$$\n其中 $J(q) \\in \\mathbb{R}^{2 \\times 3}$ 是机械臂在构型 $q$ 处的平面雅可比矩阵。\n\n在最优反馈控制 (OFC) 中，我们设计一个控制律以在最小化能量消耗的同时完成任务。在这里，于单个时间瞬间，您将计算零空间控制，该控制在保持精确的末端执行器速度跟踪约束的同时，最小化二次型能量消耗。这表示为以下凸二次规划 (QP) 问题：\n$$\n\\begin{aligned}\n\\text{minimize}_{\\dot{q} \\in \\mathbb{R}^3} \\quad  \\frac{1}{2} \\, \\dot{q}^\\top R \\, \\dot{q} + \\frac{1}{2} \\, \\lVert \\dot{q} - u_0 \\rVert_Q^2 \\\\\n\\text{subject to} \\quad  J(q) \\, \\dot{q} = v_d,\n\\end{aligned}\n$$\n其中 $R \\in \\mathbb{R}^{3 \\times 3}$ 是一个对称正定能量权重矩阵，$Q \\in \\mathbb{R}^{3 \\times 3}$ 是一个对称正定权重矩阵，而 $u_0 \\in \\mathbb{R}^3$ 是一个姿态调节反馈项，由下式给出\n$$\nu_0 = k_p \\, (q_{\\text{ref}} - q).\n$$\n此处 $k_p > 0$ 是一个标量姿态反馈增益，单位为 $\\text{s}^{-1}$，$q_{\\text{ref}} \\in \\mathbb{R}^3$ 是一个参考姿态，单位为弧度。矩阵 $Q$ 取为 $Q = \\alpha I_3$，其中 $\\alpha > 0$，$I_3$ 是 $3 \\times 3$ 的单位矩阵。等式约束强制末端执行器精确跟踪期望的笛卡尔速度 $v_d \\in \\mathbb{R}^2$（单位：米/秒）。\n\n您必须：\n- 对平面内的串联链使用标准的平面 $3$ 连杆正向运动学定义，并通过末端执行器位置对 $q$ 的偏导数来推导 $J(q)$。\n- 将该 QP 问题表述为带有二次项和线性项的标准形式，并使用 Karush–Kuhn–Tucker (KKT) 条件在该单个时间瞬间精确求解。\n- 为每个测试用例计算最优关节速度 $\\dot{q}^\\star$，使其在满足等式约束的同时最小化二次代价。\n\n推导和实现的基本依据：\n- 机械臂的运动学关系 $v = J(q)\\,\\dot{q}$。\n- 通过正向运动学的偏导数定义平面雅可比矩阵。\n- 带等式约束的凸二次规划的结构以及 KKT 系统。\n\n使用以下固定的连杆长度（单位：米）：$L_1 = 0.3$，$L_2 = 0.3$，$L_3 = 0.2$。\n\n所有关节角度必须以弧度为单位，关节速度以弧度/秒为单位，笛卡尔速度以米/秒为单位，连杆长度以米为单位。数值输出必须是关节速度（单位：弧度/秒），并四舍五入到六位小数。\n\n测试套件：\n- 案例 $1$ (正常路径)：$q = [0.2, -0.5, 0.3]$, $q_{\\text{ref}} = [0.0, 0.0, 0.0]$, $v_d = [0.05, -0.02]$, $R = \\mathrm{diag}(2.0, 1.0, 1.0)$, $\\alpha = 0.1$, $k_p = 2.0$。\n- 案例 $2$ (零任务速度下的零空间运动)：$q = [1.0, -1.2, 0.5]$, $q_{\\text{ref}} = [0.2, -0.4, 0.1]$, $v_d = [0.0, 0.0]$, $R = \\mathrm{diag}(1.0, 1.0, 1.0)$, $\\alpha = 0.5$, $k_p = 1.5$。\n- 案例 $3$ (高能量消耗惩罚，小姿态权重)：$q = [0.1, 0.2, -0.1]$, $q_{\\text{ref}} = [0.2, 0.2, -0.4]$, $v_d = [0.02, 0.02]$, $R = \\mathrm{diag}(10.0, 10.0, 10.0)$, $\\alpha = 0.01$, $k_p = 1.0$。\n- 案例 $4$ (各向异性能量权重)：$q = [0.6, 0.4, -0.3]$, $q_{\\text{ref}} = [0.0, 0.5, -0.2]$, $v_d = [-0.03, 0.04]$, $R = \\mathrm{diag}(0.5, 2.0, 5.0)$, $\\alpha = 0.5$, $k_p = 2.0$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。列表中的每个元素是对应于一个测试用例的 $\\dot{q}^\\star$ 的三个浮点数列表，四舍五入到六位小数。例如：$[[a_1,a_2,a_3],[b_1,b_2,b_3],\\dots]$。",
            "solution": "该问题是有效的。它在科学上基于机器人运动学和最优控制理论的原理，作为一个带线性约束的凸二次规划问题，其提法是适定的 (well-posed)，并且为获得唯一解提供了所有必要的参数和条件。\n\n任务是为一个 3 连杆平面冗余机械臂计算最优关节速度指令 $\\dot{q}^\\star$。这通过在单个时间瞬间求解一个二次规划 (QP) 问题来实现。该解在满足精确的末端执行器速度跟踪约束的条件下，最小化一个包含控制能量消耗项和姿态调节项的代价函数。解将使用拉格朗日乘子法推导，对于此问题，这对应于 Karush-Kuhn-Tucker (KKT) 条件。\n\n首先，我们建立机械臂的正向运动学和雅可比矩阵。设关节角度为 $q = [q_1, q_2, q_3]^\\top$。对于从原点开始的串联链，其末端执行器位置 $p_e(q) = [x_e(q), y_e(q)]^\\top$ 由下式给出：\n$$ x_e(q) = L_1 \\cos(q_1) + L_2 \\cos(q_1+q_2) + L_3 \\cos(q_1+q_2+q_3) $$\n$$ y_e(q) = L_1 \\sin(q_1) + L_2 \\sin(q_1+q_2) + L_3 \\sin(q_1+q_2+q_3) $$\n其中 $L_1$、$L_2$ 和 $L_3$ 是连杆长度。\n\n末端执行器速度 $v = \\dot{p}_e$ 通过机械臂雅可比矩阵 $J(q) = \\frac{\\partial p_e}{\\partial q} \\in \\mathbb{R}^{2 \\times 3}$ 与关节速度 $\\dot{q}$ 相关。雅可比矩阵的元素是末端执行器位置分量关于每个关节角度的偏导数。令 $c_1 = \\cos(q_1)$，$s_1 = \\sin(q_1)$，$c_{12} = \\cos(q_1+q_2)$，$s_{12} = \\sin(q_1+q_2)$，$c_{123} = \\cos(q_1+q_2+q_3)$，以及 $s_{123} = \\sin(q_1+q_2+q_3)$。雅可比矩阵为：\n$$ J(q) = \\begin{bmatrix} \\frac{\\partial x_e}{\\partial q_1}  \\frac{\\partial x_e}{\\partial q_2}  \\frac{\\partial x_e}{\\partial q_3} \\\\ \\frac{\\partial y_e}{\\partial q_1}  \\frac{\\partial y_e}{\\partial q_2}  \\frac{\\partial y_e}{\\partial q_3} \\end{bmatrix} $$\n偏导数是：\n$$ \\frac{\\partial x_e}{\\partial q_1} = -L_1 s_1 - L_2 s_{12} - L_3 s_{123} $$\n$$ \\frac{\\partial x_e}{\\partial q_2} = -L_2 s_{12} - L_3 s_{123} $$\n$$ \\frac{\\partial x_e}{\\partial q_3} = -L_3 s_{123} $$\n$$ \\frac{\\partial y_e}{\\partial q_1} = L_1 c_1 + L_2 c_{12} + L_3 c_{123} $$\n$$ \\frac{\\partial y_e}{\\partial q_2} = L_2 c_{12} + L_3 c_{123} $$\n$$ \\frac{\\partial y_e}{\\partial q_3} = L_3 c_{123} $$\n\n接下来，我们构建 QP 问题。目标是最小化代价函数：\n$$ C(\\dot{q}) = \\frac{1}{2} \\dot{q}^\\top R \\dot{q} + \\frac{1}{2} \\lVert \\dot{q} - u_0 \\rVert_Q^2 $$\n约束条件为 $J(q) \\dot{q} = v_d$。\n该代价函数可以展开并重写为标准的二次型形式。\n$$ C(\\dot{q}) = \\frac{1}{2} \\dot{q}^\\top R \\dot{q} + \\frac{1}{2} (\\dot{q} - u_0)^\\top Q (\\dot{q} - u_0) $$\n$$ C(\\dot{q}) = \\frac{1}{2} \\dot{q}^\\top R \\dot{q} + \\frac{1}{2} (\\dot{q}^\\top Q \\dot{q} - \\dot{q}^\\top Q u_0 - u_0^\\top Q \\dot{q} + u_0^\\top Q u_0) $$\n由于 $Q$ 是对称的，因此 $u_0^\\top Q \\dot{q} = (\\dot{q}^\\top Q u_0)^\\top = \\dot{q}^\\top Q u_0$。\n$$ C(\\dot{q}) = \\frac{1}{2} \\dot{q}^\\top (R+Q) \\dot{q} - (Q u_0)^\\top \\dot{q} + \\frac{1}{2} u_0^\\top Q u_0 $$\n常数项 $\\frac{1}{2} u_0^\\top Q u_0$ 不影响最小值的位置，因此我们可以从优化中忽略它。该 QP 问题为：\n$$\n\\begin{aligned}\n\\text{minimize}_{\\dot{q} \\in \\mathbb{R}^3} \\quad  \\frac{1}{2} \\dot{q}^\\top H \\dot{q} + c^\\top \\dot{q} \\\\\n\\text{subject to} \\quad  J(q) \\dot{q} = v_d,\n\\end{aligned}\n$$\n其中 $H = R+Q$ 是海森矩阵 (Hessian matrix)，$c = -Q u_0$ 是线性代价向量。由于 $R$ 和 $Q$ 是对称正定的，因此 $H$ 也是对称正定的，这使得该问题是严格凸的，并保证有唯一的最小值。\n\n为了求解这个等式约束的 QP 问题，我们构造拉格朗日函数 $\\mathcal{L}(\\dot{q}, \\lambda)$：\n$$ \\mathcal{L}(\\dot{q}, \\lambda) = \\frac{1}{2} \\dot{q}^\\top H \\dot{q} - (Q u_0)^\\top \\dot{q} + \\lambda^\\top (J(q)\\dot{q} - v_d) $$\n其中 $\\lambda \\in \\mathbb{R}^2$ 是拉格朗日乘子向量。KKT 最优性条件要求拉格朗日函数的梯度为零。\n\n1. 稳定性条件 (Stationarity): $\\nabla_{\\dot{q}} \\mathcal{L} = 0$\n$$ \\frac{\\partial \\mathcal{L}}{\\partial \\dot{q}} = H \\dot{q} - Q u_0 + J(q)^\\top \\lambda = 0 $$\n$$ H \\dot{q} = Q u_0 - J(q)^\\top \\lambda $$\n由于 $H$ 是可逆的，我们可以用 $\\lambda$ 表示 $\\dot{q}$：\n$$ \\dot{q} = H^{-1} (Q u_0 - J(q)^\\top \\lambda) $$\n\n2. 原始可行性 (Primal Feasibility): 约束必须成立。\n$$ J(q) \\dot{q} = v_d $$\n\n我们将 $\\dot{q}$ 的表达式代入可行性约束中，以求解 $\\lambda$：\n$$ J(q) [H^{-1} (Q u_0 - J(q)^\\top \\lambda)] = v_d $$\n$$ J(q) H^{-1} Q u_0 - J(q) H^{-1} J(q)^\\top \\lambda = v_d $$\n$$ (J(q) H^{-1} J(q)^\\top) \\lambda = J(q) H^{-1} Q u_0 - v_d $$\n对于非奇异构型，雅可比矩阵 $J(q)$ 具有满行秩，矩阵 $S = J(q) H^{-1} J(q)^\\top$ 是一个 $2 \\times 2$ 的可逆矩阵。我们可以求解 $\\lambda$：\n$$ \\lambda = (J(q) H^{-1} J(q)^\\top)^{-1} (J(q) H^{-1} Q u_0 - v_d) $$\n\n最后，我们将 $\\lambda$ 代回到 $\\dot{q}$ 的表达式中，以获得最优关节速度 $\\dot{q}^\\star$：\n$$ \\dot{q}^\\star = H^{-1} (Q u_0 - J(q)^\\top \\lambda) $$\n姿态调节反馈项为 $u_0 = k_p (q_{\\text{ref}} - q)$，权重矩阵为 $Q = \\alpha I_3$，其中 $I_3$ 是 $3 \\times 3$ 的单位矩阵。\n\n计算的算法如下：\n1. 对于每个测试用例，获取参数：$q$，$q_{\\text{ref}}$，$v_d$，$R$，$\\alpha$，$k_p$。\n2. 计算姿态反馈项：$u_0 = k_p (q_{\\text{ref}} - q)$。\n3. 构建矩阵 $Q = \\alpha I_3$ 和 $H = R+Q$。\n4. 为当前关节构型 $q$ 计算雅可比矩阵 $J(q)$。\n5. 计算矩阵 $S = J(q) H^{-1} J(q)^\\top$。这涉及到对 $H$ 求逆。\n6. 计算向量 $b = J(q) H^{-1} Q u_0 - v_d$。\n7. 求解 $2 \\times 2$ 线性系统 $S \\lambda = b$ 以得到拉格朗日乘子 $\\lambda$。\n8. 计算最优关节速度向量 $\\dot{q}^\\star = H^{-1} (Q u_0 - J(q)^\\top \\lambda)$。\n9. 按规定格式打包结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the optimal joint velocities for a 3-link planar manipulator\n    based on a quadratic programming formulation for optimal feedback control.\n    \"\"\"\n\n    # Fixed link lengths in meters\n    L1, L2, L3 = 0.3, 0.3, 0.2\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"q\": np.array([0.2, -0.5, 0.3]),\n            \"q_ref\": np.array([0.0, 0.0, 0.0]),\n            \"v_d\": np.array([0.05, -0.02]),\n            \"R\": np.diag([2.0, 1.0, 1.0]),\n            \"alpha\": 0.1,\n            \"k_p\": 2.0,\n        },\n        {\n            \"q\": np.array([1.0, -1.2, 0.5]),\n            \"q_ref\": np.array([0.2, -0.4, 0.1]),\n            \"v_d\": np.array([0.0, 0.0]),\n            \"R\": np.diag([1.0, 1.0, 1.0]),\n            \"alpha\": 0.5,\n            \"k_p\": 1.5,\n        },\n        {\n            \"q\": np.array([0.1, 0.2, -0.1]),\n            \"q_ref\": np.array([0.2, 0.2, -0.4]),\n            \"v_d\": np.array([0.02, 0.02]),\n            \"R\": np.diag([10.0, 10.0, 10.0]),\n            \"alpha\": 0.01,\n            \"k_p\": 1.0,\n        },\n        {\n            \"q\": np.array([0.6, 0.4, -0.3]),\n            \"q_ref\": np.array([0.0, 0.5, -0.2]),\n            \"v_d\": np.array([-0.03, 0.04]),\n            \"R\": np.diag([0.5, 2.0, 5.0]),\n            \"alpha\": 0.5,\n            \"k_p\": 2.0,\n        },\n    ]\n\n    results = []\n    \n    def compute_jacobian(q):\n        \"\"\"Computes the 2x3 planar manipulator Jacobian.\"\"\"\n        q1, q2, q3 = q[0], q[1], q[2]\n        \n        s1 = np.sin(q1)\n        c1 = np.cos(q1)\n        s12 = np.sin(q1 + q2)\n        c12 = np.cos(q1 + q2)\n        s123 = np.sin(q1 + q2 + q3)\n        c123 = np.cos(q1 + q2 + q3)\n\n        J = np.zeros((2, 3))\n        J[0, 0] = -L1 * s1 - L2 * s12 - L3 * s123\n        J[0, 1] = -L2 * s12 - L3 * s123\n        J[0, 2] = -L3 * s123\n        J[1, 0] = L1 * c1 + L2 * c12 + L3 * c123\n        J[1, 1] = L2 * c12 + L3 * c123\n        J[1, 2] = L3 * c123\n        \n        return J\n\n    for case in test_cases:\n        q = case[\"q\"]\n        q_ref = case[\"q_ref\"]\n        v_d = case[\"v_d\"]\n        R = case[\"R\"]\n        alpha = case[\"alpha\"]\n        k_p = case[\"k_p\"]\n\n        # Step 1: Compute posture feedback term u0\n        u0 = k_p * (q_ref - q)\n\n        # Step 2: Construct Q and H matrices\n        Q = alpha * np.identity(3)\n        H = R + Q\n        H_inv = np.linalg.inv(H)\n\n        # Step 3: Compute Jacobian\n        J = compute_jacobian(q)\n\n        # Step 4: Solve for Lagrange multipliers lambda\n        # lambda = (J H_inv J^T)^-1 * (J H_inv Q u0 - v_d)\n        JH_inv = J @ H_inv\n        JH_inv_JT = JH_inv @ J.T\n        \n        # Check if JH_inv_JT is invertible\n        if abs(np.linalg.det(JH_inv_JT))  1e-12:\n            # Handle singularity, though not expected for these test cases\n            # Use pseudo-inverse for robustness, although direct inverse is fine here\n            JH_inv_JT_inv = np.linalg.pinv(JH_inv_JT)\n        else:\n            JH_inv_JT_inv = np.linalg.inv(JH_inv_JT)\n\n        rhs = JH_inv @ Q @ u0 - v_d\n        lambda_val = JH_inv_JT_inv @ rhs\n        \n        # Step 5: Compute optimal joint velocity q_dot_star\n        # q_dot_star = H_inv * (Q * u0 - J^T * lambda)\n        q_dot_star = H_inv @ (Q @ u0 - J.T @ lambda_val)\n\n        # Round to six decimal places and convert to list\n        result = [round(x, 6) for x in q_dot_star]\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}