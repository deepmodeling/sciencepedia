{
    "hands_on_practices": [
        {
            "introduction": "我们如何从数学上描述一个神经网络在刺激消失后仍能维持活动的能力？这项练习将通过一个简化的线性循环网络来探讨这一基本问题。通过分析网络连接矩阵的特征值，你将推导出维持持续性活动的核心数学条件，为理解更复杂的工作记忆模型奠定理论基石 。",
            "id": "4033660",
            "problem": "考虑一个用于工作记忆的线性循环速率网络模型，该模型包含 $N$ 个单元，其活动向量 $\\mathbf{x}(t) \\in \\mathbb{R}^{N}$ 的演化遵循以下公式\n$$\n\\tau \\,\\dot{\\mathbf{x}}(t) \\,=\\, -\\mathbf{x}(t) + J\\,\\mathbf{x}(t) + \\mathbf{I}(t),\n$$\n其中 $\\tau > 0$ 是单细胞膜时间常数，$J \\in \\mathbb{R}^{N \\times N}$ 是突触连接矩阵，$\\mathbf{I}(t)$ 是一个外部输入，它在 $t  t_{0}$ 时编码一个刺激，并在 $t \\geq t_{0}$ 时被移除，因此在延迟期间 $\\mathbf{I}(t) = \\mathbf{0}$。工作记忆问题在于，网络在输入移除后是表现出持续活动、边缘积分还是活动衰减。对于常数 $A$ 的线性自治系统 $\\dot{\\mathbf{x}}(t) = A\\,\\mathbf{x}(t)$，其通解由 $A$ 的谱通过矩阵指数确定，系统的长期行为由具有最大实部的特征值决定。\n\n从网络方程和线性动力系统的基本性质出发，重构延迟期间的自治动力学，推导有效系统矩阵的谱如何控制渐进行为，并推导 $J$ 的最大特征值在以下情况下的条件：(i) 持续活动，此处定义为在 $t \\geq t_{0}$ 时沿至少一个模式的非衰减或增长活动；(ii) 边缘积分，定义为沿至少一个模式既不增长也不衰减（渐进恒定振幅）；以及 (iii) 衰减，定义为所有模式的活动随时间消失。令 $\\lambda_{\\max} \\equiv \\max_{i} \\Re \\lambda_{i}(J)$ 表示 $J$ 的特征值 $\\lambda_{i}(J)$ 中的最大实部。\n\n最后，计算主导指数速率常数 $r_{\\mathrm{dom}}$，它决定了沿具有最大实部的模式的渐进指数增长或衰减，用 $\\tau$ 和 $\\lambda_{\\max}$ 表示。将 $r_{\\mathrm{dom}}$ 以 $\\mathrm{s}^{-1}$ 为单位表示。您的最终答案必须是 $r_{\\mathrm{dom}}$ 的一个单一闭式表达式。",
            "solution": "用户希望分析一个线性循环速率网络模型，并推导出不同动态行为的条件，最终找到主导指数速率常数。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件**\n\n问题提供了以下信息：\n- 网络活动向量 $\\mathbf{x}(t) \\in \\mathbb{R}^{N}$ 根据微分方程演化：\n$$\n\\tau \\,\\dot{\\mathbf{x}}(t) \\,=\\, -\\mathbf{x}(t) + J\\,\\mathbf{x}(t) + \\mathbf{I}(t)\n$$\n- $\\tau > 0$ 是单细胞膜时间常数。\n- $J \\in \\mathbb{R}^{N \\times N}$ 是突触连接矩阵。\n- $\\mathbf{I}(t)$ 是一个外部输入，在 $t \\geq t_0$（延迟期间）时为零。\n- 感兴趣的三种行为定义如下：\n  - (i) **持续活动**：在 $t \\geq t_{0}$ 时，沿至少一个模式的非衰减或增长活动。\n  - (ii) **边缘积分**：沿至少一个模式既不增长也不衰减（渐进恒定振幅）。\n  - (iii) **衰减**：所有模式的活动随时间消失。\n- 符号 $\\lambda_{\\max} \\equiv \\max_{i} \\Re \\lambda_{i}(J)$ 表示 $J$ 的特征值 $\\lambda_{i}(J)$ 中的最大实部。\n- 目标是重构动力学，推导 $\\lambda_{\\max}$ 在三种行为下的条件，并计算主导指数速率常数 $r_{\\mathrm{dom}}$。\n\n**1.2. 使用提取的已知条件进行验证**\n\n- **科学依据**：该模型是计算神经科学中用于研究网络动力学和工作记忆的标准线性速率模型。使用线性系统理论和特征值进行分析是该模型的基本且正确的方法。该问题在科学上是合理的。\n- **适定性**：问题陈述清晰。给出了控制方程，指定了延迟期间的条件，并提供了动力学机制的定义。它要求进行特定的推导并得出一个最终量 $r_{\\mathrm{dom}}$，该量可以从给定信息中唯一确定。\n- **客观性**：问题使用精确的数学语言和公认的科学术语表达，没有主观性或歧义。\n\n**1.3. 结论与行动**\n\n该问题是有效的，因为它具有科学依据、适定性和客观性。没有矛盾、信息缺失或其他缺陷。我将继续进行求解。\n\n### 步骤 2：解题推导\n\n分析始于网络的动力学方程：\n$$\n\\tau \\,\\dot{\\mathbf{x}}(t) \\,=\\, -\\mathbf{x}(t) + J\\,\\mathbf{x}(t) + \\mathbf{I}(t)\n$$\n问题指出，在延迟期间，即 $t \\geq t_0$ 时，外部输入被移除，因此 $\\mathbf{I}(t) = \\mathbf{0}$。延迟期间的动力学方程因此为：\n$$\n\\tau \\,\\dot{\\mathbf{x}}(t) \\,=\\, -\\mathbf{x}(t) + J\\,\\mathbf{x}(t)\n$$\n我们可以将右侧的活动向量 $\\mathbf{x}(t)$ 提取出来。令 $I$ 为 $N \\times N$ 单位矩阵，我们得到：\n$$\n\\tau \\,\\dot{\\mathbf{x}}(t) \\,=\\, (J - I)\\,\\mathbf{x}(t)\n$$\n为了将其重构为线性自治系统的标准形式 $\\dot{\\mathbf{x}}(t) = A\\,\\mathbf{x}(t)$，我们除以时间常数 $\\tau$（这是允许的，因为 $\\tau > 0$）：\n$$\n\\dot{\\mathbf{x}}(t) \\,=\\, \\frac{1}{\\tau}(J - I)\\,\\mathbf{x}(t)\n$$\n这就是延迟期间重构后的自治系统。有效系统矩阵为 $A = \\frac{1}{\\tau}(J - I)$。\n\n该线性系统的通解由矩阵指数给出：\n$$\n\\mathbf{x}(t) = \\exp(A(t - t_0))\\,\\mathbf{x}(t_0)\n$$\n其中 $\\mathbf{x}(t_0)$ 是网络在延迟期开始时的状态。当 $t \\to \\infty$ 时，系统的渐进行为由矩阵 $A$ 的特征值决定。设 $A$ 的特征值为 $\\mu_i$。解可以表示为与这些特征值相关的模式的叠加。长期行为由对应于最大实部特征值的模式主导，我们将其表示为 $\\mu_{\\max} = \\max_i \\Re(\\mu_i)$。\n\n我们需要将 $A$ 的特征值 $\\mu_i$ 与连接矩阵 $J$ 的特征值 $\\lambda_i$ 联系起来。设 $v_i$ 是 $J$ 的一个特征向量，对应于特征值 $\\lambda_i$，使得 $Jv_i = \\lambda_i v_i$。我们可以将矩阵 $A$ 应用于此特征向量 $v_i$：\n$$\nA\\,v_i = \\frac{1}{\\tau}(J - I)\\,v_i = \\frac{1}{\\tau}(Jv_i - Iv_i) = \\frac{1}{\\tau}(\\lambda_i v_i - v_i) = \\frac{\\lambda_i - 1}{\\tau} v_i\n$$\n这表明 $v_i$ 也是 $A$ 的一个特征向量，对应的特征值为 $\\mu_i = \\frac{\\lambda_i - 1}{\\tau}$。这个关系对所有特征值都成立。\n\n每个特征值 $\\mu_i$ 的实部由下式给出：\n$$\n\\Re(\\mu_i) = \\Re\\left(\\frac{\\lambda_i - 1}{\\tau}\\right)\n$$\n由于 $\\tau$ 是一个正实数，我们可以写出：\n$$\n\\Re(\\mu_i) = \\frac{\\Re(\\lambda_i) - 1}{\\tau}\n$$\n因此，$A$ 的具有最大实部的特征值 $\\mu_{\\max}$ 与 $J$ 的具有最大实部的特征值 $\\lambda_{\\max} \\equiv \\max_i \\Re(\\lambda_i(J))$ 的关系如下：\n$$\n\\mu_{\\max} = \\max_i \\Re(\\mu_i) = \\max_i \\left( \\frac{\\Re(\\lambda_i) - 1}{\\tau} \\right) = \\frac{(\\max_i \\Re(\\lambda_i)) - 1}{\\tau} = \\frac{\\lambda_{\\max} - 1}{\\tau}\n$$\n系统的渐进行为取决于 $\\mu_{\\max}$ 的符号：\n- 如果 $\\mu_{\\max} > 0$，主导模式呈指数增长，导致活动无界。\n- 如果 $\\mu_{\\max} = 0$，主导模式具有恒定振幅（或以恒定振幅振荡），而所有其他模式要么是稳定的，要么是衰减的。\n- 如果 $\\mu_{\\max}  0$，所有模式都指数衰减至零。\n\n我们现在可以推导出 $\\lambda_{\\max}$ 在三种指定行为下的条件：\n\n(i) **持续活动**：这被定义为非衰减或增长的活动。这对应于活动不消失的情况，要求至少有一个模式不衰减。这发生在 $\\mu_{\\max} \\geq 0$ 时。\n$$\n\\frac{\\lambda_{\\max} - 1}{\\tau} \\geq 0 \\quad \\implies \\quad \\lambda_{\\max} - 1 \\geq 0 \\quad \\implies \\quad \\lambda_{\\max} \\geq 1\n$$\n\n(ii) **边缘积分**：这被定义为既不增长也不衰减。这对应于一个系统，其主导模式是稳定的但不衰减，即它有一个纯虚特征值，而所有其他特征值都具有非正实部。这恰好是 $\\mu_{\\max} = 0$ 的情况。\n$$\n\\frac{\\lambda_{\\max} - 1}{\\tau} = 0 \\quad \\implies \\quad \\lambda_{\\max} - 1 = 0 \\quad \\implies \\quad \\lambda_{\\max} = 1\n$$\n\n(iii) **衰减**：这被定义为活动随时间消失。这要求所有模式都呈指数衰减，这发生在 $\\mu_{\\max}  0$ 时。\n$$\n\\frac{\\lambda_{\\max} - 1}{\\tau}  0 \\quad \\implies \\quad \\lambda_{\\max} - 1  0 \\quad \\implies \\quad \\lambda_{\\max}  1\n$$\n这三个关于 $\\lambda_{\\max}$ 的条件对延迟期间网络的长期行为进行了分类。\n\n最后，我们被要求计算主导指数速率常数 $r_{\\mathrm{dom}}$。沿主导模式的活动演化与 $\\exp(\\mu_{\\max} t)$ 成正比。这种指数演化的速率常数就是 $\\mu_{\\max}$。因此，$r_{\\mathrm{dom}} = \\mu_{\\max}$。\n将我们找到的用 $\\lambda_{\\max}$ 和 $\\tau$ 表示的 $\\mu_{\\max}$ 表达式代入：\n$$\nr_{\\mathrm{dom}} = \\frac{\\lambda_{\\max} - 1}{\\tau}\n$$\n考虑到 $\\tau$ 的单位是时间（例如，秒，$s$），而 $\\lambda_{\\max}$ 是一个无量纲的特征值，那么 $r_{\\mathrm{dom}}$ 的单位就是时间的倒数（例如，$s^{-1}$），符合要求。",
            "answer": "$$\n\\boxed{\\frac{\\lambda_{\\max} - 1}{\\tau}}\n$$"
        },
        {
            "introduction": "真实的大脑皮层环路不仅包含兴奋性连接，更依赖于与抑制性连接的精妙平衡。这项练习将引导你分析一个由兴奋性和抑制性神经元群体组成的网络模型。你将通过符号推导，计算出防止兴奋性活动失控所需的临界抑制强度，从而揭示“抑制稳定”这一关键的神经计算原理 。",
            "id": "4033663",
            "problem": "考虑一个用于描述工作记忆 (WM) 的局部皮层微环路的标准双群体率模型，该模型包含一个兴奋性群体和一个抑制性群体。在一个不动点附近将动力学线性化，以获得关于小偏差 $\\delta r_{E}(t)$ 和 $\\delta r_{I}(t)$ 的系统：\n$$\n\\tau_{E}\\,\\frac{d}{dt}\\,\\delta r_{E}(t) \\;=\\; -\\,\\delta r_{E}(t) \\;+\\; w_{EE}\\,\\delta r_{E}(t) \\;-\\; w_{EI}\\,\\delta r_{I}(t),\n$$\n$$\n\\tau_{I}\\,\\frac{d}{dt}\\,\\delta r_{I}(t) \\;=\\; -\\,\\delta r_{I}(t) \\;+\\; w_{IE}\\,\\delta r_{E}(t) \\;-\\; w_{II}\\,\\delta r_{I}(t).\n$$\n此处 $\\tau_{E} \\,>\\, 0$ 和 $\\tau_{I} \\,>\\, 0$ 是时间常数，而 $w_{EE}, w_{EI}, w_{IE}, w_{II}$ 是非负突触增益。假设存在兴奋性爆发趋势 $w_{EE} \\,>\\, 1$，并设 $w_{EI} \\,>\\, 0$, $w_{IE} \\,>\\, 0$, $w_{II} \\,\\ge\\, 0$。你可以假设参数满足\n$$\n\\frac{w_{EE}-1}{\\tau_{E}} \\le \\frac{1+w_{II}}{\\tau_{I}},\n$$\n这样，任何可能的稳定化（如果可实现）都不会因为雅可比矩阵的迹为正而被排除。\n\n仅使用动力学系统线性稳定性的第一性原理，且不借助任何预先指定的快捷公式，确定临界兴奋性到抑制性增益 $w_{IE}^{\\star}$，该增益将雅可比矩阵的特征值置于复平面的闭合左半平面中，从而临界稳定该兴奋性爆发。将你的最终答案表示为由 $w_{EE}$、$w_{EI}$ 和 $w_{II}$ 构成的闭式符号表达式。无需进行数值舍入，最终答案是无量纲的。",
            "solution": "该问题要求找到突触增益 $w_{IE}$ 的临界值，记为 $w_{IE}^{\\star}$，该值能使一个线性化的双群体神经元率模型达到临界稳定性。分析将从动力学系统线性稳定性理论的第一性原理出发。\n\n围绕不动点的小偏差 $\\delta r_{E}(t)$ 和 $\\delta r_{I}(t)$ 的动力学由以下线性常微分方程组给出：\n$$\n\\tau_{E}\\,\\frac{d}{dt}\\,\\delta r_{E}(t) \\;=\\; (w_{EE}-1)\\,\\delta r_{E}(t) \\;-\\; w_{EI}\\,\\delta r_{I}(t)\n$$\n$$\n\\tau_{I}\\,\\frac{d}{dt}\\,\\delta r_{I}(t) \\;=\\; w_{IE}\\,\\delta r_{E}(t) \\;-\\; (1+w_{II})\\,\\delta r_{I}(t)\n$$\n我们可以将此系统表示为标准矩阵形式 $\\frac{d}{dt}\\mathbf{x}(t) = \\mathbf{J}\\mathbf{x}(t)$，其中 $\\mathbf{x}(t)$ 是状态向量，$\\mathbf{J}$ 是系统在不动点处计算的雅可比矩阵。首先，我们重新整理方程以分离出时间导数：\n$$\n\\frac{d}{dt}\\,\\delta r_{E}(t) \\;=\\; \\frac{w_{EE}-1}{\\tau_{E}}\\,\\delta r_{E}(t) \\;-\\; \\frac{w_{EI}}{\\tau_{E}}\\,\\delta r_{I}(t)\n$$\n$$\n\\frac{d}{dt}\\,\\delta r_{I}(t) \\;=\\; \\frac{w_{IE}}{\\tau_{I}}\\,\\delta r_{E}(t) \\;-\\; \\frac{1+w_{II}}{\\tau_{I}}\\,\\delta r_{I}(t)\n$$\n状态向量为 $\\mathbf{x}(t) = \\begin{pmatrix} \\delta r_{E}(t) \\\\ \\delta r_{I}(t) \\end{pmatrix}$。因此，雅可比矩阵 $\\mathbf{J}$ 为：\n$$\n\\mathbf{J} = \\begin{pmatrix}\n\\frac{w_{EE}-1}{\\tau_{E}} & -\\frac{w_{EI}}{\\tau_{E}} \\\\\n\\frac{w_{IE}}{\\tau_{I}} & -\\frac{1+w_{II}}{\\tau_{I}}\n\\end{pmatrix}\n$$\n不动点的稳定性由雅可比矩阵 $\\mathbf{J}$ 的特征值 $\\lambda$ 决定。特征值是特征方程 $\\det(\\mathbf{J} - \\lambda\\mathbf{I}) = 0$ 的根，其中 $\\mathbf{I}$ 是 $2 \\times 2$ 的单位矩阵。对于一个二维系统，该方程可以写成一般形式：\n$$\n\\lambda^2 - \\text{Tr}(\\mathbf{J})\\lambda + \\det(\\mathbf{J}) = 0\n$$\n为使不动点稳定，所有特征值必须具有负实部，即 $\\text{Re}(\\lambda)  0$。对于一个二维系统，稳定性的充分必要条件（劳斯-赫尔维茨判据）是：\n1. $\\text{Tr}(\\mathbf{J})  0$\n2. $\\det(\\mathbf{J}) > 0$\n\n让我们计算 $\\mathbf{J}$ 的迹和行列式。迹是对角元素之和：\n$$\n\\text{Tr}(\\mathbf{J}) = \\frac{w_{EE}-1}{\\tau_{E}} - \\frac{1+w_{II}}{\\tau_{I}}\n$$\n问题陈述中给出的条件是 $\\frac{w_{EE}-1}{\\tau_{E}} \\le \\frac{1+w_{II}}{\\tau_{I}}$，这等价于 $\\frac{w_{EE}-1}{\\tau_{E}} - \\frac{1+w_{II}}{\\tau_{I}} \\le 0$。因此，根据假设，条件 $\\text{Tr}(\\mathbf{J}) \\le 0$ 是满足的。这确保了特征值之和 $\\lambda_1 + \\lambda_2$ 为非正，从而排除了由两个正实数特征值或具有正实部的复数特征值（不稳定螺线点或节点）引起的不稳定性。\n\n接下来，我们计算 $\\mathbf{J}$ 的行列式：\n$$\n\\det(\\mathbf{J}) = \\left(\\frac{w_{EE}-1}{\\tau_{E}}\\right)\\left(-\\frac{1+w_{II}}{\\tau_{I}}\\right) - \\left(-\\frac{w_{EI}}{\\tau_{E}}\\right)\\left(\\frac{w_{IE}}{\\tau_{I}}\\right)\n$$\n$$\n\\det(\\mathbf{J}) = -\\frac{(w_{EE}-1)(1+w_{II})}{\\tau_{E}\\tau_{I}} + \\frac{w_{EI}w_{IE}}{\\tau_{E}\\tau_{I}}\n$$\n$$\n\\det(\\mathbf{J}) = \\frac{w_{EI}w_{IE} - (w_{EE}-1)(1+w_{II})}{\\tau_{E}\\tau_{I}}\n$$\n在已确定 $\\text{Tr}(\\mathbf{J}) \\le 0$ 的情况下，系统的稳定性仅取决于 $\\det(\\mathbf{J})$ 的符号。如果 $\\det(\\mathbf{J}) > 0$，系统是稳定的；如果 $\\det(\\mathbf{J})  0$，系统是不稳定的。一个 $\\text{Tr}(\\mathbf{J}) \\le 0$ 且 $\\det(\\mathbf{J})  0$ 的不稳定系统对应于一个鞍点，它有一个正实数特征值和一个负实数特征值。这个正特征值将导致问题中提到的“兴奋性爆发”。\n\n问题要求的是临界增益 $w_{IE}^{\\star}$，该增益使系统处于稳定性的边界，即特征值位于复平面的闭合左半平面。鉴于 $\\text{Tr}(\\mathbf{J}) \\le 0$，这种从稳定到不稳定的转变发生在行列式穿过零点时。因此，临界稳定性条件是 $\\det(\\mathbf{J}) = 0$。在这一点上，其中一个特征值为零（$\\lambda_1\\lambda_2 = \\det(\\mathbf{J}) = 0$），这对应于一个鞍-节分岔。\n\n我们将行列式设为零，并求解 $w_{IE}$，我们将其标记为 $w_{IE}^{\\star}$：\n$$\n\\det(\\mathbf{J}) = \\frac{w_{EI}w_{IE}^{\\star} - (w_{EE}-1)(1+w_{II})}{\\tau_{E}\\tau_{I}} = 0\n$$\n由于时间常数 $\\tau_{E}$ 和 $\\tau_{I}$ 严格为正，它们的乘积 $\\tau_{E}\\tau_{I}$ 非零。因此，要使该分式为零，其分子必须为零：\n$$\nw_{EI}w_{IE}^{\\star} - (w_{EE}-1)(1+w_{II}) = 0\n$$\n现在我们可以求解 $w_{IE}^{\\star}$。问题指明了 $w_{EE} > 1$，$w_{EI} > 0$ 且 $w_{II} \\ge 0$。\n$$\nw_{EI}w_{IE}^{\\star} = (w_{EE}-1)(1+w_{II})\n$$\n由于 $w_{EI} > 0$，我们可以用它来除，以分离出 $w_{IE}^{\\star}$：\n$$\nw_{IE}^{\\star} = \\frac{(w_{EE}-1)(1+w_{II})}{w_{EI}}\n$$\n这就是兴奋性到抑制性突触增益的临界值。对于任何 $w_{IE} > w_{IE}^{\\star}$，行列式将为正（因为 $w_{EI}>0$），系统将是稳定的。对于 $w_{IE}  w_{IE}^{\\star}$，行列式将为负，系统将是不稳定的。因此，值 $w_{IE}^{\\star}$ 代表了为临界稳定系统以抵抗兴奋性爆发所需的最小增益。",
            "answer": "$$\\boxed{\\frac{(w_{EE}-1)(1+w_{II})}{w_{EI}}}$$"
        },
        {
            "introduction": "理解了产生持续性活动的原理后，我们如何在复杂的、经过训练的神经网络中识别出这些活动模式？这项练习将一个循环神经网络（RNN）的动力学行为简化为一个线性系统，并要求你对其进行分析。你将学习一种实用的数据分析方法，通过寻找动力学矩阵中特征值接近于1的特征向量，来确定存储信息的“持续性流形”，从而连接起理论模型与复杂系统分析的桥梁 。",
            "id": "4033662",
            "problem": "给定一个已训练的循环神经网络（Recurrent Neural Network, RNN）在不动点附近的离散时间线性化近似模型。状态向量中微小扰动的局部动态被建模为 $x_{t+1} = W x_t$，其中 $W$ 是循环权重矩阵（即动态系统在不动点处的雅可比矩阵）。持久性活动模式对应于状态空间中在迭代下不衰减的方向，对于线性化模型，这些方向与 $W$ 的接近于 1 的特征值对齐。你的任务是以编程方式计算指定矩阵的特征值和特征向量，将持久性流形识别为与给定容差范围内接近 $1$ 的特征值相关联的特征向量所张成的空间，并构造到该流形上的正交投影。\n\n从标准线性系统理论和谱分解出发，并纯粹使用数学运算，为每个测试用例实现以下步骤：\n- 计算 $W$ 的所有特征值 $\\lambda_i$ 及其对应的右特征向量 $v_i$。\n- 选择满足 $\\lvert \\lambda_i - 1 \\rvert \\le \\tau$ 和 $\\lvert \\operatorname{Im}(\\lambda_i) \\rvert \\le \\tau$ 的索引 $i$，其中 $\\tau$ 是给定的容差。这将筛选出复平面上接近 $1$ 且足够实以表示线性化映射中静止方向的特征值。\n- 构建实数矩阵 $V$，其列是所选特征向量 $v_i$ 的实部。\n- 通过正交化为 $V$ 的列空间构建一个标准正交基 $Q$，然后构造到持久性流形上的正交投影 $P = Q Q^\\top$。如果没有特征值满足筛选标准，则将 $P$ 定义为零矩阵，流形的维数定义为 $0$。\n- 对于每个测试用例，报告持久性流形的维数 $d$、所选特征值中最大的复平面距离 $\\max_i \\lvert \\lambda_i - 1 \\rvert$（如果没有选中的特征值，则为 $0$），以及弗罗贝尼乌斯范数 $\\lVert P \\rVert_F$。所有适用的角度均以弧度为单位。\n\n你的程序必须使用以下测试套件。对于每个用例，请完全按照规定构造 $W$。\n\n测试用例 1（理想情况，单个近单位特征值）：\n- 维数 $n = 3$。\n- 令 $M_1$ 为具有以下元素的 $3 \\times 3$ 矩阵\n$$\n  \\begin{bmatrix}\n  0.4 & -1.1 & 0.2 \\\\\n  0.3 & 0.5 & -0.7 \\\\\n  0.1 & 0.9 & 0.6\n  \\end{bmatrix}\n$$，\n  并令 $Q_1$ 为 $M_1$ 的简约 $QR$ 分解（使得 $M_1 = Q_1 R_1$）中的正交因子。\n- 令 $D_1 = \\operatorname{diag}(0.98, 0.80, 0.30)$。\n- 定义 $W_1 = Q_1 D_1 Q_1^\\top$。\n- 容差 $\\tau = 0.03$。\n\n测试用例 2（边界情况，具有精确单位值和重数）：\n- 维数 $n = 4$。\n- 令 $M_2$ 为具有以下元素的 $4 \\times 4$ 矩阵\n$$\n  \\begin{bmatrix}\n  1.0 & -0.2 & 0.3 & 0.4 \\\\\n  -0.5 & 0.7 & 0.9 & -0.1 \\\\\n  0.6 & 0.8 & -0.3 & 0.2 \\\\\n  0.1 & -0.4 & 0.5 & 1.2\n  \\end{bmatrix}\n$$，\n  并令 $Q_2$ 为 $M_2$ 的简约 $QR$ 分解中的正交因子。\n- 令 $D_2 = \\operatorname{diag}(1.00, 1.00, 0.95, 0.70)$。\n- 定义 $W_2 = Q_2 D_2 Q_2^\\top$。\n- 容差 $\\tau = 0.001$。\n\n测试用例 3（无持久性模式）：\n- 维数 $n = 5$。\n- 令 $M_3$ 为具有以下元素的 $5 \\times 5$ 矩阵\n$$\n  \\begin{bmatrix}\n  0.9 & -0.1 & 0.3 & -0.4 & 0.5 \\\\\n  0.2 & 0.7 & -0.6 & 0.8 & -0.3 \\\\\n  -0.5 & 0.4 & 1.1 & -0.2 & 0.6 \\\\\n  0.3 & -0.8 & 0.2 & 0.9 & -0.7 \\\\\n  -0.4 & 0.6 & -0.1 & 0.2 & 0.8\n  \\end{bmatrix}\n$$，\n  并令 $Q_3$ 为 $M_3$ 的简约 $QR$ 分解中的正交因子。\n- 令 $D_3 = \\operatorname{diag}(0.85, 0.60, 0.30, 0.20, 0.40)$。\n- 定义 $W_3 = Q_3 D_3 Q_3^\\top$。\n- 容差 $\\tau = 0.05$。\n\n测试用例 4（单位圆上远离单位值的共轭复数对）：\n- 维数 $n = 3$。\n- 令 $\\theta = \\pi/4$，$B = \\begin{bmatrix} \\cos(\\theta) & -\\sin(\\theta) \\\\ \\sin(\\theta) & \\cos(\\theta) \\end{bmatrix}$，并令 $W_4$ 为分块对角矩阵 $\\operatorname{blockdiag}(B, 0.90)$。\n- 容差 $\\tau = 0.05$。\n\n最终输出规范：\n- 对每个测试用例，计算一个列表 $[d, m, f]$，其中 $d$ 是持久性流形的整数维数， $m$ 是所选特征值中最大 $\\lvert \\lambda_i - 1 \\rvert$ 的浮点数值（如果没有选中的特征值，则为 $0$），$f$ 是弗罗贝尼乌斯范数 $\\lVert P \\rVert_F$ 的浮点数值。将浮点数表示为四舍五入到 $6$ 位小数的十进制数。\n- 你的程序应生成单行输出，其中包含按四个测试用例顺序排列的结果，格式为用方括号括起来的逗号分隔列表：例如，如果每个用例的结果是 $r_1, r_2, r_3, r_4$，则打印 $[r_1,r_2,r_3,r_4]$，其中每个 $r_i$ 本身都是上述格式的列表。",
            "solution": "我们通过离散时间线性系统 $x_{t+1} = W x_t$ 来建模一个已训练的循环神经网络在不动点附近的局部动态，其中 $W$ 是不动点处的雅可比矩阵。基础线性系统理论指出，沿 $W$ 的特征值为 $\\lambda$ 的特征向量 $v$ 方向上的行为是 $x_t = \\lambda^t c v$，其中 $c$ 是某个标量。因此，如果 $\\lvert \\lambda \\rvert  1$，扰动会衰减；如果 $\\lvert \\lambda \\rvert > 1$，扰动会增长；如果 $\\lambda = 1$，扰动会精确地保持不变。对于线性化状态下的持久性活动，接近 $1$ 的特征值对应于缓慢变化或静止的模式，其中 $\\lambda = 1$ 是理想的持久性模式。\n\n我们将持久性模式的检测形式化为筛选接近单位值的特征值。具体来说，我们通过谱分解计算 $W$ 的所有特征值 $\\{\\lambda_i\\}$ 和对应的右特征向量 $\\{v_i\\}$。我们选择满足准则\n$$\n\\lvert \\lambda_i - 1 \\rvert \\le \\tau \\quad \\text{和} \\quad \\lvert \\operatorname{Im}(\\lambda_i) \\rvert \\le \\tau,\n$$\n的索引 $i$，这确保了在复平面上接近 $1$ 且近似为实数，适用于循环线性映射中的静止方向。对应的特征向量 $\\{v_i\\}$ 张成了候选的持久性流形。\n\n为了构建一个实数子空间基，我们构建实值矩阵 $V \\in \\mathbb{R}^{n \\times k}$，其列是所选特征向量的实部。然后，我们使用正交化方法（例如，通过 $QR$ 分解）为 $V$ 的列空间计算一个标准正交基 $Q \\in \\mathbb{R}^{n \\times d}$。持久性流形的维数 $d$ 等于 $V$ 中线性无关列的数量。到该流形的正交投影由\n$$\nP = Q Q^\\top,\n$$\n给出，因为 $Q$ 的列是标准正交的。这个 $P$ 将任何状态向量映射到持久性子空间上。为了进行量化报告，我们计算：\n- 持久性流形的维数 $d$。\n- 所选特征值中与单位值的最大复平面距离，$m = \\max_i \\lvert \\lambda_i - 1 \\rvert$，如果没有选中的特征值，则 $m = 0$。\n- 投影的弗罗贝尼乌斯范数，$\\lVert P \\rVert_F$。因为 $P$ 是到一个 $d$ 维子空间上的正交投影，我们有\n$$\n\\|P\\|_F^2 = \\operatorname{trace}(P^\\top P) = \\operatorname{trace}(P) = d,\n$$\n所以 $\\|P\\|_F = \\sqrt{d}$。这个恒等式为实现提供了一个内部一致性检查。\n\n每个测试用例的算法步骤：\n1. 完全按照规定构造 $W$：\n   - 对于测试用例 1、2 和 3，计算给定满秩矩阵 $M$ 的简约 $QR$ 分解 $M = Q R$，取正交因子 $Q$，并对于给定的对角矩阵 $D$ 设置 $W = Q D Q^\\top$，以确保得到一个具有所需特征值的对称矩阵。\n   - 对于测试用例 4，将 $W$ 设置为旋转角度为 $\\theta = \\pi/4$ 的旋转矩阵 $B$ 和标量 $0.90$ 的分块对角矩阵。\n2. 使用标准特征分解计算特征值 $\\lambda_i$ 和特征向量 $v_i$。\n3. 选择满足 $\\lvert \\lambda_i - 1 \\rvert \\le \\tau$ 和 $\\lvert \\operatorname{Im}(\\lambda_i) \\rvert \\le \\tau$ 的索引。\n4. 如果没有索引被选中，则设置 $d = 0$，$m = 0$，并将 $P$ 设为零矩阵，得到 $\\lVert P \\rVert_F = 0$。\n5. 否则，通过取所选特征向量的实部来形成 $V$，对其列进行正交化以获得 $Q$，并设置 $P = Q Q^\\top$。计算 $d = Q \\text{ 的列数}$，$m = \\max_i \\lvert \\lambda_i - 1 \\rvert$ 和 $f = \\lVert P \\rVert_F$。\n6. 将 $m$ 和 $f$ 四舍五入到 $6$ 位小数以供输出。\n\n测试套件的预期定性结果：\n- 测试用例 1：$D_1$ 包含 $0.98$，在容差 $\\tau = 0.03$ 内接近 $1$，因此 $d = 1$，$m \\approx 0.02$，且 $f \\approx 1.0$。\n- 测试用例 2：$D_2$ 包含两个精确为 $1.00$ 的特征值，因此 $d = 2$，$m = 0.0$，且 $f \\approx \\sqrt{2}$。\n- 测试用例 3：没有接近 $1$ 的特征值，因此 $d = 0$，$m = 0.0$，且 $f = 0.0$。\n- 测试用例 4：当 $\\theta = \\pi/4$ 时，复数对 $e^{\\pm i \\theta}$ 位于单位圆上，但在复平面上远离 $1$，且 $0.90$ 不在 $1$ 的 $\\tau = 0.05$ 容差范围内，因此 $d = 0$，$m = 0.0$，且 $f = 0.0$。\n\n最终程序将这些每个用例的 $[d, m, f]$ 结果汇总成单行表示 $[[d_1, m_1, f_1],[d_2, m_2, f_2],[d_3, m_3, f_3],[d_4, m_4, f_4]]$，并完全按照指定格式打印。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef orthonormalize_columns(V, rtol=1e-8):\n    \"\"\"\n    Orthonormalize the columns of V using QR decomposition and\n    drop near-zero columns based on the diagonal of R.\n    Returns Q_reduced with orthonormal columns spanning col(V).\n    \"\"\"\n    if V.size == 0 or V.shape[1] == 0:\n        return np.zeros((V.shape[0], 0))\n    Q, R = np.linalg.qr(V, mode='reduced')\n    diag = np.abs(np.diag(R))\n    # Keep columns where the corresponding R diagonal is sufficiently large\n    mask = diag > rtol\n    return Q[:, mask]\n\ndef projection_from_basis(Q):\n    \"\"\"\n    Given an orthonormal basis Q (columns orthonormal), return the projection P = Q Q^T.\n    If Q has zero columns, return zero matrix of appropriate size.\n    \"\"\"\n    n = Q.shape[0]\n    if Q.shape[1] == 0:\n        return np.zeros((n, n))\n    return Q @ Q.T\n\ndef build_W_from_M_and_D(M, D_diag):\n    \"\"\"\n    Given a full-rank matrix M and diagonal entries D_diag, compute reduced QR of M to get Q,\n    and return W = Q * diag(D_diag) * Q^T.\n    \"\"\"\n    Q, _ = np.linalg.qr(M, mode='reduced')\n    D = np.diag(D_diag)\n    return Q @ D @ Q.T\n\ndef analyze_persistent_manifold(W, tau):\n    \"\"\"\n    Compute eigenvalues/eigenvectors of W, select those with |lambda - 1| = tau and\n    |Im(lambda)| = tau, form real parts of eigenvectors, orthonormalize, construct projection,\n    and return (dimension, max_distance, frobenius_norm) with floats rounded to 6 decimals.\n    \"\"\"\n    eigvals, eigvecs = np.linalg.eig(W)\n    # Selection: near unity and near-real\n    diffs = np.abs(eigvals - 1.0)\n    near_real = np.abs(np.imag(eigvals)) = tau\n    selected = np.where((diffs = tau)  near_real)[0]\n\n    if selected.size == 0:\n        return [0, round(0.0, 6), round(0.0, 6)]\n\n    V = np.real(eigvecs[:, selected])\n    Q = orthonormalize_columns(V, rtol=1e-10)\n    d = Q.shape[1]\n    P = projection_from_basis(Q)\n    fro_norm = float(np.linalg.norm(P, 'fro'))\n    max_distance = float(np.max(diffs[selected]))\n    return [int(d), round(max_distance, 6), round(fro_norm, 6)]\n\ndef solve():\n    # Define the test cases from the problem statement.\n\n    # Test case 1\n    M1 = np.array([\n        [0.4, -1.1,  0.2],\n        [0.3,  0.5, -0.7],\n        [0.1,  0.9,  0.6]\n    ], dtype=float)\n    D1 = [0.98, 0.80, 0.30]\n    W1 = build_W_from_M_and_D(M1, D1)\n    tau1 = 0.03\n\n    # Test case 2\n    M2 = np.array([\n        [ 1.0, -0.2,  0.3,  0.4],\n        [-0.5,  0.7,  0.9, -0.1],\n        [ 0.6,  0.8, -0.3,  0.2],\n        [ 0.1, -0.4,  0.5,  1.2]\n    ], dtype=float)\n    D2 = [1.00, 1.00, 0.95, 0.70]\n    W2 = build_W_from_M_and_D(M2, D2)\n    tau2 = 0.001\n\n    # Test case 3\n    M3 = np.array([\n        [ 0.9, -0.1,  0.3, -0.4,  0.5],\n        [ 0.2,  0.7, -0.6,  0.8, -0.3],\n        [-0.5,  0.4,  1.1, -0.2,  0.6],\n        [ 0.3, -0.8,  0.2,  0.9, -0.7],\n        [-0.4,  0.6, -0.1,  0.2,  0.8]\n    ], dtype=float)\n    D3 = [0.85, 0.60, 0.30, 0.20, 0.40]\n    W3 = build_W_from_M_and_D(M3, D3)\n    tau3 = 0.05\n\n    # Test case 4\n    theta = np.pi / 4.0  # radians\n    B = np.array([\n        [np.cos(theta), -np.sin(theta)],\n        [np.sin(theta),  np.cos(theta)]\n    ], dtype=float)\n    W4 = np.block([\n        [B,                np.zeros((2,1))],\n        [np.zeros((1,2)),  np.array([[0.90]])]\n    ])\n    tau4 = 0.05\n\n    test_cases = [\n        (W1, tau1),\n        (W2, tau2),\n        (W3, tau3),\n        (W4, tau4)\n    ]\n\n    results = []\n    for W, tau in test_cases:\n        result = analyze_persistent_manifold(W, tau)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}