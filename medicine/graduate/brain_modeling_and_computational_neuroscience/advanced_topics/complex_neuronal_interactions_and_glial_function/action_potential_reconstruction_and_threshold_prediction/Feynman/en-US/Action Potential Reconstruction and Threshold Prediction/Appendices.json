{
    "hands_on_practices": [
        {
            "introduction": "Understanding the action potential threshold requires moving beyond a simple voltage value to a deeper appreciation of the underlying dynamics. This practice guides you through the analysis of a reduced neuron model, revealing how the threshold for spike generation emerges from the interplay of ionic currents, represented here as a phase-plane bifurcation . By exploring how parameters like leak conductance alter the system's geometry, you will gain a rigorous, principle-based understanding of what it means for a neuron to 'decide' to fire.",
            "id": "3960964",
            "problem": "Consider a two-dimensional reduction of a conductance-based neuron near spike onset, in which the fast membrane voltage variable $V$ is approximated by a cubic nonlinearity arising from the balance of inward activation and outward currents, and the slow recovery variable $w$ is linear in $V$. Let the explicit leak conductance $g_{L}$ enter the fast current balance as a linear Ohmic term. The reduced, dimensionless system is\n$$\n\\begin{aligned}\n\\frac{dV}{dt} &= f(V,w;I,g_{L}) \\equiv (\\alpha-g_{L})\\,V - \\beta V^{3} - w + I,\\\\\n\\frac{dw}{dt} &= \\epsilon\\left(\\kappa V + \\lambda - w\\right),\n\\end{aligned}\n$$\nwith parameters $\\alpha>0$, $\\beta>0$, $\\kappa>0$, $\\lambda \\in \\mathbb{R}$, and $0<\\epsilon\\ll 1$. The external stimulus $I$ is a constant applied current. This model is a canonical cubic fast–slow reduction derived from the current conservation law\n$$\nC\\frac{dV}{dt} = -I_{\\text{ion}}(V,w;g_{L}) + I,\n$$\nwhere the leak current is linear in $V$ with slope $g_{L}$ and the fast inward current has been approximated by a linear term in $V$ minus a saturating cubic nonlinearity. The $V$-nullcline is the cubic\n$$\nw = (\\alpha-g_{L})\\,V - \\beta V^{3} + I,\n$$\nand the $w$-nullcline is the straight line\n$$\nw = \\kappa V + \\lambda.\n$$\n\nAnswer the following:\n\n1) Starting from these nullclines and the definition of the knee points of the cubic as the solutions of $dw/dV = 0$, determine how increasing $g_{L}$ shifts the $V$-nullcline and moves its knee points in the $(V,w)$-plane. State your result in terms of $(\\alpha-g_{L})$ and $\\beta$.\n\n2) In the singular limit $\\epsilon\\to 0^{+}$, the onset of repetitive spiking as $I$ is slowly increased from rest occurs either via a saddle-node on invariant circle (SNIC) or via a Hopf bifurcation, depending on geometry. Using only the geometry of the nullclines and linearization at equilibrium, derive a condition on $g_{L}$ (relative to the other parameters) that separates these two onset types when $I$ is varied. Your condition must be stated in terms of the relative slope between the cubic $V$-nullcline and the $w$-nullcline at their intersection.\n\n3) Under the condition you identified that yields a saddle-node on invariant circle (SNIC) onset, the rheobase (the minimal constant current $I$ for which repetitive spiking occurs) is attained when the line $w=\\kappa V+\\lambda$ is tangent to the cubic $w=(\\alpha-g_{L})V-\\beta V^{3}+I$ at the left knee (i.e., at negative $V$). By enforcing the tangency conditions, derive a closed-form expression for the rheobase $I_{\\mathrm{rh}}(g_{L})$ in terms of $\\alpha$, $\\beta$, $\\kappa$, $\\lambda$, and $g_{L}$. Express your final answer as a single analytic expression. No numerical rounding is required. State clearly any sign choice you make for the knee point.\n\nProvide your reasoning from the fundamental current-balance law, the definitions of nullclines and knee points, and linear stability criteria, and avoid invoking pre-packaged formulas for rheobase. Your final answer must be the explicit analytic expression for $I_{\\mathrm{rh}}(g_{L})$ in dimensionless units, enclosed in a single expression.",
            "solution": "The problem presents a canonical fast-slow dynamical system representing a reduced conductance-based neuron model. We are tasked with analyzing the geometric properties of its nullclines and deriving conditions for different firing onsets, ultimately calculating the rheobase current for one specific onset type. The analysis will proceed in three parts as requested.\n\nThe system is given by:\n$$\n\\begin{aligned}\n\\frac{dV}{dt} &= (\\alpha-g_{L})\\,V - \\beta V^{3} - w + I \\\\\n\\frac{dw}{dt} &= \\epsilon\\left(\\kappa V + \\lambda - w\\right)\n\\end{aligned}\n$$\nThe $V$-nullcline, where $\\frac{dV}{dt}=0$, is the cubic function $w(V) = (\\alpha-g_{L})V - \\beta V^3 + I$. The $w$-nullcline, where $\\frac{dw}{dt}=0$, is the line $w(V) = \\kappa V + \\lambda$. The parameters are defined as $\\alpha>0$, $\\beta>0$, $\\kappa>0$, $\\lambda \\in \\mathbb{R}$, and $0<\\epsilon\\ll 1$.\n\n**Part 1: Effect of leak conductance $g_{L}$ on the $V$-nullcline and its knee points**\n\nThe equation for the $V$-nullcline is $w = (\\alpha-g_{L})V - \\beta V^3 + I$. The leak conductance $g_L$ appears in the linear term. Increasing $g_L$ decreases the coefficient $(\\alpha-g_{L})$. For a given $I$, this has the effect of \"flattening\" the cubic shape. For $V > 0$, an increase in $g_L$ decreases the value of $w$ on the nullcline. For $V < 0$, an increase in $g_L$ increases the value of $w$. This constitutes a shear transformation that pivots the nullcline around the point $(0, I)$.\n\nThe knee points of the cubic $V$-nullcline are its local extrema, defined by the condition $\\frac{dw}{dV} = 0$. We compute the derivative with respect to $V$:\n$$\n\\frac{dw}{dV} = (\\alpha-g_{L}) - 3\\beta V^2\n$$\nSetting this to zero yields the $V$-coordinates of the knee points:\n$$\n(\\alpha-g_{L}) - 3\\beta V^2 = 0 \\implies V^2 = \\frac{\\alpha-g_{L}}{3\\beta}\n$$\nFor two real knee points to exist, we must have $\\alpha-g_{L} > 0$. Assuming this condition holds, the $V$-coordinates are:\n$$\nV_{\\text{knees}} = \\pm\\sqrt{\\frac{\\alpha-g_{L}}{3\\beta}}\n$$\nAs $g_L$ increases, the term $(\\alpha-g_{L})$ decreases. Consequently, the magnitude $|V_{\\text{knees}}|$ decreases, meaning the knee points move horizontally towards the $w$-axis ($V=0$).\n\nTo find the $w$-coordinates of the knee points, we substitute $V_{\\text{knees}}$ back into the nullcline equation:\n$$\nw_{\\text{knees}} = (\\alpha-g_{L})V_{\\text{knees}} - \\beta V_{\\text{knees}}^3 + I = V_{\\text{knees}}\\left((\\alpha-g_{L}) - \\beta V_{\\text{knees}}^2\\right) + I\n$$\nUsing the relation $V_{\\text{knees}}^2 = \\frac{\\alpha-g_{L}}{3\\beta}$, we substitute for the $\\beta V_{\\text{knees}}^2$ term:\n$$\nw_{\\text{knees}} = V_{\\text{knees}}\\left((\\alpha-g_{L}) - \\beta \\frac{\\alpha-g_{L}}{3\\beta}\\right) + I = V_{\\text{knees}}\\left((\\alpha-g_{L}) - \\frac{1}{3}(\\alpha-g_{L})\\right) + I = \\frac{2}{3}(\\alpha-g_{L})V_{\\text{knees}} + I\n$$\nSubstituting the expression for $V_{\\text{knees}}$:\n$$\nw_{\\text{knees}} = \\frac{2}{3}(\\alpha-g_{L})\\left(\\pm\\sqrt{\\frac{\\alpha-g_{L}}{3\\beta}}\\right) + I = \\pm\\frac{2(\\alpha-g_{L})^{3/2}}{3\\sqrt{3\\beta}} + I\n$$\nAs $g_L$ increases, $(\\alpha-g_{L})$ decreases, so the magnitude of the term $\\pm\\frac{2(\\alpha-g_{L})^{3/2}}{3\\sqrt{3\\beta}}}$ also decreases. This means the $w$-coordinates of the knees move towards the value $I$.\n\nIn summary, increasing the leak conductance $g_L$ causes the two knee points of the $V$-nullcline to move closer to each other, converging on the point $(0, I)$ in the $(V, w)$-plane.\n\n**Part 2: Condition distinguishing SNIC and Hopf bifurcation onsets**\n\nThe onset of repetitive spiking occurs when the stable fixed point of the system (the resting state) loses stability as the current $I$ is increased. The type of bifurcation depends on how the eigenvalues of the Jacobian matrix cross the imaginary axis. A fixed point $(V_*, w_*)$ is an intersection of the nullclines. The Jacobian matrix $J$ at a fixed point is:\n$$\nJ = \\begin{pmatrix} \\frac{\\partial\\dot{V}}{\\partial V} & \\frac{\\partial\\dot{V}}{\\partial w} \\\\ \\frac{\\partial\\dot{w}}{\\partial V} & \\frac{\\partial\\dot{w}}{\\partial w} \\end{pmatrix}_{(V_*, w_*)} = \\begin{pmatrix} (\\alpha-g_{L}) - 3\\beta V_*^2 & -1 \\\\ \\epsilon\\kappa & -\\epsilon \\end{pmatrix}\n$$\nLet $S_V = (\\alpha-g_{L}) - 3\\beta V_*^2$ be the slope of the $V$-nullcline at the fixed point. The Jacobian becomes $J = \\begin{pmatrix} S_V & -1 \\\\ \\epsilon\\kappa & -\\epsilon \\end{pmatrix}$.\nThe trace and determinant are:\n$$\n\\text{Tr}(J) = S_V - \\epsilon\n$$\n$$\n\\text{Det}(J) = S_V(-\\epsilon) - (-1)(\\epsilon\\kappa) = \\epsilon(\\kappa - S_V)\n$$\nA fixed point is stable if $\\text{Tr}(J) < 0$ and $\\text{Det}(J) > 0$. In the singular limit $\\epsilon\\to 0^+$, these conditions become $S_V < 0$ and $\\kappa > S_V$. The resting state of a neuron is a stable fixed point, typically at a negative potential $V_*$. The $V$-nullcline has an N-shape, and the stable fixed points lie on the outer branches where the slope $S_V$ is negative. Thus, for the resting state, $S_V < 0$, and since $\\kappa > 0$, the stability conditions are satisfied.\n\nAs $I$ is increased, the $V$-nullcline shifts upwards, and the fixed point $(V_*, w_*)$ moves. Stability is lost when either $\\text{Tr}(J)$ or $\\text{Det}(J)$ becomes zero.\nA saddle-node bifurcation occurs when $\\text{Det}(J)=0$, which implies $S_V = \\kappa$. This corresponds to the $w$-nullcline becoming tangent to the $V$-nullcline.\nA Hopf bifurcation occurs when $\\text{Tr}(J)=0$ while $\\text{Det}(J)>0$, which implies $S_V = \\epsilon \\approx 0$.\n\nThe type of bifurcation is determined by the global geometry of the nullclines. Fixed points are solutions to $(\\alpha-g_{L})V - \\beta V^3 + I = \\kappa V + \\lambda$, which can be rewritten as $\\beta V^3 + (\\kappa - (\\alpha-g_L))V + \\lambda - I = 0$. The number of real roots for $V$ determines the number of fixed points.\nThis depends on the sign of the coefficient of the linear term, $\\kappa - (\\alpha-g_L)$.\nCase 1: $\\kappa > \\alpha-g_L$. The function $F(V) = \\beta V^3 + (\\kappa - (\\alpha-g_L))V$ is monotonic. For any value of $I$, there is always exactly one fixed point. As $I$ increases, this fixed point moves from the stable left branch (where $S_V < 0$) to the unstable middle branch (where $S_V>0$). The loss of stability occurs when $S_V$ crosses from negative to positive. The bifurcation point is where $\\text{Tr}(J) = S_V - \\epsilon = 0$, or $S_V=\\epsilon$. Since at this point $\\text{Det}(J) = \\epsilon(\\kappa - \\epsilon) > 0$ (as $\\kappa > \\alpha-g_L > 0$ and $\\epsilon \\ll 1$), this is a Hopf bifurcation.\n\nCase 2: $\\kappa < \\alpha-g_L$. The coefficient $\\kappa - (\\alpha-g_L)$ is negative. The function $F(V)$ is non- monotonic, allowing for one or three real roots depending on the value of $I$. This means there is a range of $I$ for which the system has three fixed points (a stable node, a saddle, and an unstable node/spiral). As $I$ is increased from a low value, the initial stable resting state (node) moves towards the saddle point. At a critical value of $I$, they merge and annihilate. This is a saddle-node bifurcation. Since the trajectory leaving the bifurcation point follows a large excursion in phase space (a spike) that returns near the saddle-node point, it is a saddle-node on invariant circle (SNIC) bifurcation.\n\nTherefore, the condition separating the two onset types is the relative slope of the $w$-nullcline, $\\kappa$, compared to the maximum positive slope of the $V$-nullcline. The slope of the $V$-nullcline is $S_V(V) = (\\alpha-g_L) - 3\\beta V^2$. Its maximum value occurs at $V=0$ and is $S_{V, \\text{max}} = \\alpha-g_L$.\nThe condition is:\n- **SNIC onset** if the slope of the $w$-nullcline is less than the maximal slope of the $V$-nullcline: $\\kappa < \\alpha-g_L$.\n- **Hopf onset** if the slope of the $w$-nullcline is greater than the maximal slope of the $V$-nullcline: $\\kappa > \\alpha-g_L$.\n\n**Part 3: Rheobase current $I_{\\mathrm{rh}}(g_{L})$ for SNIC onset**\n\nWe are in the SNIC regime, where $\\kappa < \\alpha-g_L$. The rheobase current $I_{\\text{rh}}$ is the minimum current that causes the neuron to fire, which corresponds to the value of $I$ at which the saddle-node bifurcation occurs. As stated in the problem and consistent with our analysis, this happens when the $w$-nullcline $w = \\kappa V + \\lambda$ is tangent to the $V$-nullcline $w = (\\alpha-g_L)V - \\beta V^3 + I$. The problem specifies that this tangency occurs at the \"left knee\", which we interpret as the saddle-node point at negative voltage, $V<0$.\n\nThe conditions for tangency at a point $V=V_{\\text{rh}}$ are:\n1.  The values of $w$ are equal: $\\kappa V_{\\text{rh}} + \\lambda = (\\alpha-g_L)V_{\\text{rh}} - \\beta V_{\\text{rh}}^3 + I_{\\text{rh}}$\n2.  The slopes (derivatives with respect to $V$) are equal: $\\kappa = (\\alpha-g_L) - 3\\beta V_{\\text{rh}}^2$\n\nFrom the second condition, we solve for $V_{\\text{rh}}$:\n$$\n3\\beta V_{\\text{rh}}^2 = \\alpha-g_L-\\kappa \\implies V_{\\text{rh}}^2 = \\frac{\\alpha-g_L-\\kappa}{3\\beta}\n$$\nThe bifurcating fixed point is on the left, so we take the negative root for $V_{\\text{rh}}$:\n$$\nV_{\\text{rh}} = -\\sqrt{\\frac{\\alpha-g_L-\\kappa}{3\\beta}}\n$$\nThis choice is consistent, as a real solution requires $\\alpha-g_L-\\kappa > 0$, the condition for the SNIC regime.\n\nNow, we use the first condition to solve for $I_{\\text{rh}}$:\n$$\nI_{\\text{rh}} = (\\kappa - (\\alpha-g_L))V_{\\text{rh}} + \\beta V_{\\text{rh}}^3 + \\lambda\n$$\nWe can factor out $V_{\\text{rh}}$:\n$$\nI_{\\text{rh}} = V_{\\text{rh}}\\left(\\kappa - (\\alpha-g_L) + \\beta V_{\\text{rh}}^2\\right) + \\lambda\n$$\nSubstitute $\\beta V_{\\text{rh}}^2 = \\frac{1}{3}(\\alpha-g_L-\\kappa)$:\n$$\nI_{\\text{rh}} = V_{\\text{rh}}\\left(\\kappa - (\\alpha-g_L) + \\frac{1}{3}(\\alpha-g_L-\\kappa)\\right) + \\lambda\n$$\n$$\nI_{\\text{rh}} = V_{\\text{rh}}\\left(-(\\alpha-g_L-\\kappa) + \\frac{1}{3}(\\alpha-g_L-\\kappa)\\right) + \\lambda\n$$\n$$\nI_{\\text{rh}} = V_{\\text{rh}}\\left(-\\frac{2}{3}(\\alpha-g_L-\\kappa)\\right) + \\lambda\n$$\nNow, substitute the expression for $V_{\\text{rh}}$:\n$$\nI_{\\text{rh}} = \\left(-\\sqrt{\\frac{\\alpha-g_L-\\kappa}{3\\beta}}\\right)\\left(-\\frac{2}{3}(\\alpha-g_L-\\kappa)\\right) + \\lambda\n$$\nThe two negative signs cancel, yielding:\n$$\nI_{\\text{rh}}(g_{L}) = \\frac{2}{3}(\\alpha-g_L-\\kappa) \\sqrt{\\frac{\\alpha-g_L-\\kappa}{3\\beta}} + \\lambda\n$$\nThis expression can be simplified to its final form:\n$$\nI_{\\text{rh}}(g_{L}) = \\lambda + \\frac{2(\\alpha-g_L-\\kappa)^{3/2}}{3\\sqrt{3\\beta}}\n$$\nThis is the closed-form expression for the rheobase current as a function of the leak conductance $g_L$ and the other system parameters, under the condition for a SNIC bifurcation.",
            "answer": "$$\n\\boxed{\\lambda + \\frac{2}{3\\sqrt{3\\beta}}(\\alpha - g_{L} - \\kappa)^{3/2}}\n$$"
        },
        {
            "introduction": "A neuron's firing threshold is not just a property of its soma, but is also shaped by how inputs are processed in its dendrites. This computational exercise explores the critical role of dendritic properties in synaptic integration, contrasting a passive dendrite with one capable of generating local spikes . By quantifying how active backpropagation alters the required synaptic strength to trigger a somatic action potential, you will uncover how neurons can dynamically regulate their input-output function.",
            "id": "3960948",
            "problem": "You are tasked with predicting the change in the minimal synaptic conductance required to elicit a somatic Action Potential (AP) when active dendritic backpropagation is present versus absent, for a synaptic input located at an electrotonic position along a dendrite. Your program must compute, for each test case, the difference between the active-case threshold conductance and the passive-case threshold conductance at the soma, expressed in nanosiemens.\n\nStart from the following foundational base and definitions:\n\n- The linearized steady-state passive cable relationship states that a small, local synaptic current injected at electrotonic distance $x/\\lambda$ yields a somatic voltage response that is exponentially attenuated by a factor $\\exp(-x/\\lambda)$.\n- The synaptic current under a small-signal approximation is $I_{\\mathrm{syn}} \\approx g_{\\mathrm{syn}} \\left(E_{\\mathrm{syn}} - V_{\\mathrm{rest}}\\right)$, where $g_{\\mathrm{syn}}$ is the synaptic conductance, $E_{\\mathrm{syn}}$ is the synaptic reversal potential, and $V_{\\mathrm{rest}}$ is the resting membrane potential.\n- The somatic voltage threshold for spike initiation is $\\Theta_s$, and the dendritic local activation threshold for initiating a dendritic spike is $\\Theta_d$. Define $\\Delta V_{\\mathrm{th}} = \\Theta_s - V_{\\mathrm{rest}}$ and $\\Delta V_{d} = \\Theta_d - V_{\\mathrm{rest}}$.\n- The passive somatic voltage response to a synaptic input located at electrotonic distance $x/\\lambda$ can be modeled as proportional to $I_{\\mathrm{syn}} R_{\\mathrm{soma}} \\exp(-x/\\lambda)$, where $R_{\\mathrm{soma}}$ is the somatic input resistance.\n- Active backpropagation is modeled as an additional somatic depolarization $S_{\\mathrm{bp}}(x)$ that is added once the dendritic site reaches its local threshold $\\Theta_d$. This backpropagated contribution decays as $\\exp(-x/\\lambda_{\\mathrm{bp}})$ with respect to the synapse’s electrotonic position, where $\\lambda_{\\mathrm{bp}}$ represents the effective space constant during active backpropagation. To explicitly parameterize the attenuation using $x/\\lambda$, define $\\rho = \\lambda / \\lambda_{\\mathrm{bp}}$ and model the backpropagated somatic contribution as $S_{\\mathrm{bp}}(x) = S_0 \\exp(-\\rho \\, x/\\lambda)$, where $S_0$ is the backpropagated somatic depolarization in millivolts that would be observed for a spike initiated effectively at $x=0$.\n\nYour task is to:\n\n- Derive from first principles the expressions for the minimal synaptic conductance at the soma needed to reach the somatic threshold in the passive case and in the active case, accounting for the possible piecewise conditions that arise due to the dendritic spike trigger.\n- Build an algorithm that, for each parameter set in the test suite below, computes the difference between the active threshold conductance and the passive threshold conductance, i.e., $\\Delta g = g_{\\mathrm{th}}^{\\mathrm{active}} - g_{\\mathrm{th}}^{\\mathrm{passive}}$, expressed in nanosiemens and rounded to three decimal places.\n\nUnits and conventions:\n\n- All membrane potentials must be interpreted in millivolts, $\\,\\mathrm{mV}$.\n- All resistances must be interpreted in megaohms, $\\,\\mathrm{M\\Omega}$, and converted internally to ohms, $\\,\\Omega$.\n- Synaptic conductances must be computed in siemens, $\\,\\mathrm{S}$, and the final reported values must be returned in nanosiemens, $\\,\\mathrm{nS}$.\n- The exponential attenuation arguments use the electrotonic distance $x/\\lambda$; angles are not used in this problem.\n\nInput to your program is fixed internally as the following test suite. Each test case is a tuple\n$\\left(x/\\lambda,\\ \\rho,\\ R_{\\mathrm{soma}},\\ R_{\\mathrm{dend}},\\ V_{\\mathrm{rest}},\\ E_{\\mathrm{syn}},\\ \\Theta_s,\\ \\Theta_d,\\ S_0\\right)$\nwith units $\\left(\\text{dimensionless},\\ \\text{dimensionless},\\ \\mathrm{M\\Omega},\\ \\mathrm{M\\Omega},\\ \\mathrm{mV},\\ \\mathrm{mV},\\ \\mathrm{mV},\\ \\mathrm{mV},\\ \\mathrm{mV}\\right)$:\n\n- Case $1$: $\\left(0.2,\\ 0.5,\\ 100,\\ 150,\\ -65,\\ 0,\\ -50,\\ -55,\\ 20\\right)$\n- Case $2$: $\\left(1.0,\\ 0.5,\\ 100,\\ 150,\\ -65,\\ 0,\\ -50,\\ -55,\\ 20\\right)$\n- Case $3$: $\\left(3.0,\\ 0.5,\\ 100,\\ 150,\\ -65,\\ 0,\\ -50,\\ -55,\\ 20\\right)$\n- Case $4$: $\\left(0.2,\\ 1.0,\\ 100,\\ 50,\\ -65,\\ 0,\\ -50,\\ -55,\\ 8\\right)$\n- Case $5$: $\\left(2.0,\\ 1.5,\\ 100,\\ 200,\\ -65,\\ 0,\\ -50,\\ -55,\\ 2\\right)$\n\nAlgorithmic requirements:\n\n- For each case, implement the passive threshold and active threshold logic according to the physically derived conditions, including the possibility that the soma reaches threshold purely via linear summation before the dendritic site triggers, and the possibility that once triggered, the backpropagated contribution reduces the required synaptic conductance.\n- Ensure internal unit conversions are correct: convert $\\mathrm{mV}$ to $\\mathrm{V}$ by multiplying by $10^{-3}$ and $\\mathrm{M\\Omega}$ to $\\Omega$ by multiplying by $10^{6}$.\n\nFinal output format:\n\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for the five test cases in order. Each entry should be the change in threshold conductance $\\Delta g$ in $\\mathrm{nS}$, rounded to three decimal places. For example: $\\left[\\text{val}_1,\\text{val}_2,\\text{val}_3,\\text{val}_4,\\text{val}_5\\right]$ must be printed exactly as a single Python list literal on one line.",
            "solution": "The problem is assessed to be valid. It is scientifically grounded in the principles of computational neuroscience, well-posed with sufficient information for a unique solution, and objectively stated. The model, while simplified, is a standard representation of synaptic integration and dendritic computation.\n\nThe task is to compute the difference in the threshold synaptic conductance required to elicit a somatic Action Potential (AP) between a neuron model with active dendritic properties and a purely passive one. This difference is denoted as $\\Delta g = g_{\\mathrm{th}}^{\\mathrm{active}} - g_{\\mathrm{th}}^{\\mathrm{passive}}$.\n\nFirst, let us define the key quantities based on the problem statement. All potentials are in volts ($\\mathrm{V}$) and resistances in ohms ($\\Omega$) for internal calculations, converted from the given units of millivolts ($\\mathrm{mV}$) and megaohms ($\\mathrm{M\\Omega}$).\n\nThe synaptic current $I_{\\mathrm{syn}}$ is given by the small-signal approximation:\n$$I_{\\mathrm{syn}} = g_{\\mathrm{syn}} (E_{\\mathrm{syn}} - V_{\\mathrm{rest}})$$\nwhere $g_{\\mathrm{syn}}$ is the synaptic conductance, $E_{\\mathrm{syn}}$ is the synaptic reversal potential, and $V_{\\mathrm{rest}}$ is the resting membrane potential. Let us define the synaptic driving potential as $\\Delta V_{\\mathrm{syn}} = E_{\\mathrm{syn}} - V_{\\mathrm{rest}}$.\n\nThe voltage change at the soma, $\\Delta V_{\\mathrm{soma}}$, due to a synaptic current at an electrotonic distance $X = x/\\lambda$ is attenuated by a factor of $\\exp(-X)$:\n$$\\Delta V_{\\mathrm{soma}} = I_{\\mathrm{syn}} R_{\\mathrm{soma}} \\exp(-X)$$\nwhere $R_{\\mathrm{soma}}$ is the somatic input resistance.\n\nThe local voltage change at the dendritic site of the synapse, $\\Delta V_{\\mathrm{local}}$, is determined by the local input resistance at that location, $R_{\\mathrm{dend}}$:\n$$\\Delta V_{\\mathrm{local}} = I_{\\mathrm{syn}} R_{\\mathrm{dend}}$$\n\nThe voltage change required to reach the somatic and dendritic thresholds from rest are:\n$$\\Delta V_{\\mathrm{th}} = \\Theta_s - V_{\\mathrm{rest}}$$\n$$\\Delta V_{d} = \\Theta_d - V_{\\mathrm{rest}}$$\n\n**Step 1: Derivation of the Passive Threshold Conductance ($g_{\\mathrm{th}}^{\\mathrm{passive}}$)**\n\nIn the passive case, a somatic AP is triggered when the somatic potential reaches the threshold $\\Theta_s$, meaning $\\Delta V_{\\mathrm{soma}} = \\Delta V_{\\mathrm{th}}$. We can set up the equality and solve for the threshold conductance, $g_{\\mathrm{th}}^{\\mathrm{passive}}$.\n$$\\Delta V_{\\mathrm{th}} = I_{\\mathrm{syn}} R_{\\mathrm{soma}} \\exp(-X)$$\nSubstituting the expression for $I_{\\mathrm{syn}}$:\n$$\\Delta V_{\\mathrm{th}} = g_{\\mathrm{th}}^{\\mathrm{passive}} (E_{\\mathrm{syn}} - V_{\\mathrm{rest}}) R_{\\mathrm{soma}} \\exp(-X)$$\nSolving for $g_{\\mathrm{th}}^{\\mathrm{passive}}$:\n$$g_{\\mathrm{th}}^{\\mathrm{passive}} = \\frac{\\Delta V_{\\mathrm{th}}}{(E_{\\mathrm{syn}} - V_{\\mathrm{rest}}) R_{\\mathrm{soma}} \\exp(-X)}$$\n\n**Step 2: Derivation of the Active Threshold Conductance ($g_{\\mathrm{th}}^{\\mathrm{active}}$)**\n\nThe active case introduces a conditional non-linearity: if the local dendritic potential reaches its threshold $\\Theta_d$, an additional depolarizing contribution $S_{\\mathrm{bp}}(x) = S_0 \\exp(-\\rho X)$ is added to the soma. We must determine which threshold is reached first as $g_{\\mathrm{syn}}$ is increased: the local dendritic threshold or the somatic threshold.\n\nLet's find the conductance required to trip the dendritic threshold, $g_{\\mathrm{dend}}$. This occurs when $\\Delta V_{\\mathrm{local}} = \\Delta V_{d}$:\n$$\\Delta V_{d} = I_{\\mathrm{syn}} R_{\\mathrm{dend}} = g_{\\mathrm{dend}} (E_{\\mathrm{syn}} - V_{\\mathrm{rest}}) R_{\\mathrm{dend}}$$\nSolving for $g_{\\mathrm{dend}}$:\n$$g_{\\mathrm{dend}} = \\frac{\\Delta V_{d}}{(E_{\\mathrm{syn}} - V_{\\mathrm{rest}}) R_{\\mathrm{dend}}}$$\n\nNow we compare $g_{\\mathrm{dend}}$ with $g_{\\mathrm{th}}^{\\mathrm{passive}}$ to determine the sequence of events.\n\n**Case A: Somatic threshold is reached first ($g_{\\mathrm{th}}^{\\mathrm{passive}} \\le g_{\\mathrm{dend}}$)**\nIf the conductance required to fire the soma passively is less than or equal to the conductance required to trigger the dendritic spike, the somatic AP will initiate before the dendritic non-linearity can be engaged. In this scenario, the active mechanism is irrelevant. The threshold conductance is the same as in the passive case.\n$$g_{\\mathrm{th}}^{\\mathrm{active}} = g_{\\mathrm{th}}^{\\mathrm{passive}}$$\n\n**Case B: Dendritic threshold is reached first ($g_{\\mathrm{th}}^{\\mathrm{passive}} > g_{\\mathrm{dend}}$)**\nIf the dendritic site reaches its threshold first, the backpropagating potential $S_{\\mathrm{bp}}(x)$ is generated. We must then check if this additional depolarization is sufficient to push the soma over its threshold $\\Theta_s$.\n\nThe total somatic depolarization at the moment the dendritic spike is triggered (i.e., at $g_{\\mathrm{syn}} = g_{\\mathrm{dend}}$) is the sum of the passive synaptic contribution and the backpropagated potential:\n$$\\Delta V_{\\mathrm{soma, total}} = \\Delta V_{\\mathrm{soma}}(g_{\\mathrm{dend}}) + S_{\\mathrm{bp}}(x)$$\nThe synaptic current at this point is $I_{\\mathrm{syn}} = g_{\\mathrm{dend}}(E_{\\mathrm{syn}} - V_{\\mathrm{rest}}) = \\Delta V_d / R_{\\mathrm{dend}}$.\nSo, the passive component of the somatic voltage is $\\Delta V_{\\mathrm{soma}}(g_{\\mathrm{dend}}) = (\\Delta V_d / R_{\\mathrm{dend}}) R_{\\mathrm{soma}} \\exp(-X)$.\nThe total somatic voltage change is:\n$$\\Delta V_{\\mathrm{soma, at\\_dend\\_spike}} = \\frac{\\Delta V_d R_{\\mathrm{soma}}}{R_{\\mathrm{dend}}} \\exp(-X) + S_0 \\exp(-\\rho X)$$\n\nTwo sub-cases arise:\n\n**B1: Dendritic spike is sufficient to trigger somatic AP ($\\Delta V_{\\mathrm{soma, at\\_dend\\_spike}} \\ge \\Delta V_{\\mathrm{th}}$)**\nIf the total somatic depolarization at the moment of the dendritic spike is enough to reach the somatic threshold, then the minimum conductance required is simply the conductance needed to trigger the dendritic spike.\n$$g_{\\mathrm{th}}^{\\mathrm{active}} = g_{\\mathrm{dend}}$$\n\n**B2: Dendritic spike is insufficient to trigger somatic AP ($\\Delta V_{\\mathrm{soma, at\\_dend\\_spike}} < \\Delta V_{\\mathrm{th}}$)**\nIf the somatic threshold is not yet reached, we need to increase the synaptic conductance $g_{\\mathrm{syn}}$ further. For any conductance $g_{\\mathrm{syn}} \\ge g_{\\mathrm{dend}}$, the total somatic voltage is given by $\\Delta V_{\\mathrm{soma}}(g_{\\mathrm{syn}}) + S_{\\mathrm{bp}}(x)$. We need to find the value of $g_{\\mathrm{syn}}$ (which we call $g_{\\mathrm{th}}^{\\mathrm{active}}$) that satisfies:\n$$g_{\\mathrm{th}}^{\\mathrm{active}}(E_{\\mathrm{syn}} - V_{\\mathrm{rest}}) R_{\\mathrm{soma}} \\exp(-X) + S_0 \\exp(-\\rho X) = \\Delta V_{\\mathrm{th}}$$\nSolving for $g_{\\mathrm{th}}^{\\mathrm{active}}$:\n$$g_{\\mathrm{th}}^{\\mathrm{active}} = \\frac{\\Delta V_{\\mathrm{th}} - S_0 \\exp(-\\rho X)}{(E_{\\mathrm{syn}} - V_{\\mathrm{rest}}) R_{\\mathrm{soma}} \\exp(-X)}$$\n\n**Step 3: Algorithm Summary and Computation**\n\nThe final value, $\\Delta g = g_{\\mathrm{th}}^{\\mathrm{active}} - g_{\\mathrm{th}}^{\\mathrm{passive}}$, is calculated for each test case by following the logic derived above. All input parameters in $\\mathrm{mV}$ and $\\mathrm{M\\Omega}$ are converted to $\\mathrm{V}$ and $\\Omega$ respectively before being used in the formulas. The resulting conductances in Siemens ($\\mathrm{S}$) are then used to compute $\\Delta g$, which is finally converted to nanosiemens ($\\mathrm{nS}$) by multiplying by $10^9$ and rounded to three decimal places.\n\nThe overall algorithm is:\n1.  Convert all input parameters to base SI units ($\\mathrm{V}$, $\\Omega$).\n2.  Calculate $g_{\\mathrm{th}}^{\\mathrm{passive}}$.\n3.  Calculate $g_{\\mathrm{dend}}$.\n4.  If $g_{\\mathrm{th}}^{\\mathrm{passive}} \\le g_{\\mathrm{dend}}$, set $g_{\\mathrm{th}}^{\\mathrm{active}} = g_{\\mathrm{th}}^{\\mathrm{passive}}$.\n5.  If $g_{\\mathrm{th}}^{\\mathrm{passive}} > g_{\\mathrm{dend}}$:\n    a. Calculate $\\Delta V_{\\mathrm{soma, at\\_dend\\_spike}}$.\n    b. If $\\Delta V_{\\mathrm{soma, at\\_dend\\_spike}} \\ge \\Delta V_{\\mathrm{th}}$, set $g_{\\mathrm{th}}^{\\mathrm{active}} = g_{\\mathrm{dend}}$.\n    c. Otherwise, calculate $g_{\\mathrm{th}}^{\\mathrm{active}}$ using the formula from sub-case B2.\n6.  Compute $\\Delta g = g_{\\mathrm{th}}^{\\mathrm{active}} - g_{\\mathrm{th}}^{\\mathrm{passive}}$.\n7.  Convert $\\Delta g$ from $\\mathrm{S}$ to $\\mathrm{nS}$ and round.\n\nThis procedure is implemented for each provided test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the change in threshold synaptic conductance due to active dendritic backpropagation.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (x/lambda, rho, R_soma_Mohm, R_dend_Mohm, V_rest_mV, E_syn_mV, Theta_s_mV, Theta_d_mV, S0_mV)\n    test_cases = [\n        (0.2, 0.5, 100, 150, -65, 0, -50, -55, 20),\n        (1.0, 0.5, 100, 150, -65, 0, -50, -55, 20),\n        (3.0, 0.5, 100, 150, -65, 0, -50, -55, 20),\n        (0.2, 1.0, 100, 50, -65, 0, -50, -55, 8),\n        (2.0, 1.5, 100, 200, -65, 0, -50, -55, 2),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters for the current test case\n        x_lambda, rho, R_soma_Mohm, R_dend_Mohm, V_rest_mV, E_syn_mV, Theta_s_mV, Theta_d_mV, S0_mV = case\n\n        # --- Unit Conversion to base SI units (V, Ohm) ---\n        R_soma = R_soma_Mohm * 1e6\n        R_dend = R_dend_Mohm * 1e6\n        V_rest = V_rest_mV * 1e-3\n        E_syn = E_syn_mV * 1e-3\n        Theta_s = Theta_s_mV * 1e-3\n        Theta_d = Theta_d_mV * 1e-3\n        S0 = S0_mV * 1e-3\n\n        # --- Derived quantities ---\n        delta_V_th = Theta_s - V_rest   # Somatic threshold voltage change\n        delta_V_d = Theta_d - V_rest    # Dendritic threshold voltage change\n        delta_V_syn = E_syn - V_rest      # Synaptic driving potential\n\n        # --- Step 1: Calculate Passive Threshold Conductance ---\n        # The conductance at the synapse needed to reach somatic threshold in a passive dendrite.\n        # Check for division by zero, though not expected with given data.\n        denominator_passive = delta_V_syn * R_soma * np.exp(-x_lambda)\n        if denominator_passive == 0:\n            # Handle case of infinite conductance if necessary\n            g_th_passive = float('inf')\n        else:\n            g_th_passive = delta_V_th / denominator_passive\n\n        # --- Step 2: Calculate Active Threshold Conductance ---\n        \n        # Conductance required to trigger the local dendritic spike\n        denominator_dend = delta_V_syn * R_dend\n        if denominator_dend == 0:\n            g_dend = float('inf')\n        else:\n            g_dend = delta_V_d / denominator_dend\n\n        g_th_active = 0.0\n\n        # Compare passive somatic threshold with dendritic threshold to determine which fires first\n        if g_th_passive = g_dend:\n            # Case A: Somatic AP is triggered before or at the same time as the dendritic spike.\n            # Active mechanism is not engaged or is irrelevant.\n            g_th_active = g_th_passive\n        else:\n            # Case B: Dendritic spike is triggered first.\n            V_soma_at_dend_spike = (delta_V_d * R_soma / R_dend) * np.exp(-x_lambda) + S0 * np.exp(-rho * x_lambda)\n            \n            if V_soma_at_dend_spike >= delta_V_th:\n                # Case B1: The dendritic spike provides enough depolarization to trigger a somatic AP immediately.\n                # The threshold conductance is just that needed for the dendritic spike.\n                g_th_active = g_dend\n            else:\n                # Case B2: More conductance is needed after the dendritic spike.\n                # The total voltage is the sum of passive attenuation and the now-active backpropagation contribution.\n                numerator = delta_V_th - S0 * np.exp(-rho * x_lambda)\n                denominator = delta_V_syn * R_soma * np.exp(-x_lambda)\n                if denominator == 0:\n                    g_th_active = float('inf')\n                else:\n                    g_th_active = numerator / denominator\n\n        # --- Step 3: Calculate the difference and format the output ---\n        delta_g_S = g_th_active - g_th_passive  # Difference in Siemens\n        delta_g_nS = delta_g_S * 1e9         # Convert to nanoSiemens\n        \n        results.append(round(delta_g_nS, 3))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "After an action potential is initiated, how is it perceived by an external observer? This hands-on practice bridges the gap between intracellular biophysics and extracellular recordings by simulating the potential generated by a traveling spike in the axon initial segment (AIS) . By modeling the transmembrane currents and applying volume conductor theory, you will reconstruct the extracellular waveform and learn how its key features, like amplitude and width, depend on the underlying neuronal activity and the electrode's position.",
            "id": "3960959",
            "problem": "Consider a homogeneous, isotropic, and quasi-static extracellular medium surrounding a neuron, modeled with scalar conductivity $\\sigma$ expressed in $\\mathrm{S/m}$. The axon initial segment (AIS) is represented as a straight cylindrical cable of length $L$ and radius $a$, aligned along the $x$-axis, and discretized into $N$ equal cylindrical compartments. The center of compartment $k$ ($k = 0,1,\\dots,N-1$) is at axial coordinate $x_k = (k + \\tfrac{1}{2}) \\ell$, where $\\ell = L/N$ is the compartment length. Each compartment has membrane surface area $A_k = 2 \\pi a \\ell$. An extracellular point electrode is placed at coordinates $(x_e, y_e, z_e)$, with the AIS axis coincident with the $x$-axis at $(y,z)=(0,0)$. Distances are three-dimensional Euclidean distances in $\\mathrm{m}$.\n\nYou must reconstruct the extracellular action potential at the electrode due solely to AIS transmembrane currents under the quasi-static volume conductor approximation. Begin from a valid base: the cable equation and Maxwell’s equations in the quasi-static limit, using well-tested facts such as linear superposition of current sources in a homogeneous ohmic medium. Do not invoke any pre-given target expressions for the extracellular potential; derive the necessary expressions from first principles.\n\nModel the AIS dynamics as a traveling spike with conduction velocity $v$ moving in the $+x$ direction. The membrane potential at axial position $x$ is\n$$\nV_m(x,t) = V_{\\mathrm{rest}} + \\Delta V \\cdot \\frac{1}{2}\\left(1 + \\tanh\\left(\\frac{\\left(t - \\frac{x}{v}\\right) - t_0}{\\tau_v}\\right)\\right),\n$$\nwhere $V_{\\mathrm{rest}}$ is the resting potential in $\\mathrm{V}$, $\\Delta V$ is the spike amplitude in $\\mathrm{V}$, $t_0$ is the upstroke center in $\\mathrm{s}$, and $\\tau_v$ is the upstroke timescale in $\\mathrm{s}$. The capacitive current density (membrane charge displacement) is\n$$\nj_{\\mathrm{cap}}(x,t) = C_m \\frac{\\partial V_m(x,t)}{\\partial t},\n$$\nwith $C_m$ the specific membrane capacitance in $\\mathrm{F/m^2}$. The ionic current densities are approximated as the sum of a fast inward sodium-like pulse and a delayed outward potassium-like pulse:\n$$\nj_{\\mathrm{Na}}(x,t) = - j_{\\mathrm{Na},0} \\exp\\left(-\\frac{\\left(\\left(t - \\frac{x}{v}\\right) - t_{\\mathrm{Na}}\\right)^2}{2 \\tau_{\\mathrm{Na}}^2}\\right),\n\\quad\nj_{\\mathrm{K}}(x,t) = + j_{\\mathrm{K},0} \\exp\\left(-\\frac{\\left(\\left(t - \\frac{x}{v}\\right) - t_{\\mathrm{K}}\\right)^2}{2 \\tau_{\\mathrm{K}}^2}\\right),\n$$\nwhere $j_{\\mathrm{Na},0}$ and $j_{\\mathrm{K},0}$ are the peak magnitudes in $\\mathrm{A/m^2}$, and $t_{\\mathrm{Na}}, \\tau_{\\mathrm{Na}}, t_{\\mathrm{K}}, \\tau_{\\mathrm{K}}$ are the centers and timescales in $\\mathrm{s}$.\n\nThe transmembrane current for compartment $k$ is\n$$\nI_m^{(k)}(t) = A_k \\left( j_{\\mathrm{cap}}(x_k,t) + j_{\\mathrm{Na}}(x_k,t) + j_{\\mathrm{K}}(x_k,t) \\right),\n$$\nand the extracellular potential at the electrode is obtained by superposition over compartments.\n\nYour program must:\n- Derive, then implement, the reconstruction of the extracellular potential at the electrode due to $\\{I_m^{(k)}(t)\\}$.\n- Compute the following shape features of the electrode potential waveform $\\phi_e(t)$:\n  1. The magnitude of the most negative deflection (the negative peak) in $\\mathrm{\\mu V}$, returned as a positive float.\n  2. The full width at half-minimum (FWHM) of the negative deflection in $\\mathrm{ms}$, defined as the time interval between the two points where $\\phi_e(t)$ reaches half of its most negative value on either side of the negative peak.\n- Predict the minimal dimensionless scaling factor $s$ on $I_m^{(k)}(t)$ such that the negative peak magnitude reaches or exceeds a provided detection threshold $\\theta$ in $\\mathrm{\\mu V}$. Use the linearity of the volume conductor model.\n\nUse the following fixed parameters and units:\n- Geometry: $L = 30\\,\\mathrm{\\mu m}$, $a = 0.5\\,\\mathrm{\\mu m}$, $N=15$.\n- Electrophysiology: $C_m = 0.01\\,\\mathrm{F/m^2}$, $V_{\\mathrm{rest}} = -70\\,\\mathrm{mV}$, $\\Delta V = 90\\,\\mathrm{mV}$, $t_0=0.25\\,\\mathrm{ms}$, $\\tau_v=0.12\\,\\mathrm{ms}$, $t_{\\mathrm{Na}}=0.30\\,\\mathrm{ms}$, $\\tau_{\\mathrm{Na}}=0.10\\,\\mathrm{ms}$, $t_{\\mathrm{K}}=1.00\\,\\mathrm{ms}$, $\\tau_{\\mathrm{K}}=0.40\\,\\mathrm{ms}$, $j_{\\mathrm{Na},0}=8\\,\\mathrm{A/m^2}$, $j_{\\mathrm{K},0}=4\\,\\mathrm{A/m^2}$.\n- Medium: $\\sigma = 0.3\\,\\mathrm{S/m}$.\n- Conduction velocity: $v = 0.6\\,\\mathrm{m/s}$.\n- Electrode $z$-coordinate: $z_e = 0\\,\\mathrm{\\mu m}$.\n- Time window and sampling: $t \\in [t_{\\min}, t_{\\max}]$ with $t_{\\min} = -1.0\\,\\mathrm{ms}$, $t_{\\max} = 3.0\\,\\mathrm{ms}$, and $\\Delta t = 0.01\\,\\mathrm{ms}$.\n\nTest suite (three cases):\n- Case 1 (happy path): $x_e = 15\\,\\mathrm{\\mu m}$, $y_e = 10\\,\\mathrm{\\mu m}$, $\\theta = 15\\,\\mathrm{\\mu V}$.\n- Case 2 (near electrode, start-aligned): $x_e = 0\\,\\mathrm{\\mu m}$, $y_e = 5\\,\\mathrm{\\mu m}$, $\\theta = 10\\,\\mathrm{\\mu V}$.\n- Case 3 (far electrode, end-aligned): $x_e = 30\\,\\mathrm{\\mu m}$, $y_e = 50\\,\\mathrm{\\mu m}$, $\\theta = 5\\,\\mathrm{\\mu V}$.\n\nYour program should output, for each case, a list of three floats of the form $[\\mathrm{amp}_{\\mu V}, s, \\mathrm{FWHM}_{\\mathrm{ms}}]$, where $\\mathrm{amp}_{\\mu V}$ is the magnitude of the negative peak in $\\mathrm{\\mu V}$, $s$ is the minimal scaling factor (dimensionless), and $\\mathrm{FWHM}_{\\mathrm{ms}}$ is the full width at half-minimum in $\\mathrm{ms}$. Aggregate the three case results into a single line of output containing a comma-separated list enclosed in square brackets. For example, your final output format must be\n$$\n[\\,[\\mathrm{amp}_1, s_1, \\mathrm{FWHM}_1],\\,[\\mathrm{amp}_2, s_2, \\mathrm{FWHM}_2],\\,[\\mathrm{amp}_3, s_3, \\mathrm{FWHM}_3]\\,].\n$$\nAll physical quantities must be computed in SI units internally; convert the final amplitudes to $\\mathrm{\\mu V}$ and FWHM to $\\mathrm{ms}$ for output. Angles are not used. Percentages are not used; express scaling factors as decimals.",
            "solution": "### Principle-Based Solution Derivation and Algorithmic Design\n\nThe problem requires the reconstruction and analysis of the extracellular potential generated by a traveling action potential in the axon initial segment (AIS). The solution is derived from the principles of electrostatics in a conductive medium and implemented numerically.\n\n**1. Extracellular Potential from Current Sources**\nUnder the quasi-static approximation, which is valid for low-frequency biological signals, the electric potential $\\phi$ in a homogeneous, isotropic conductive medium with conductivity $\\sigma$ is governed by Poisson's equation. For a single point current source $I$ in an unbounded medium, the potential at a distance $r$ is given by:\n$$ \\phi(r) = \\frac{I}{4 \\pi \\sigma r} $$\nThe AIS is modeled as a collection of discrete current sources. By the principle of linear superposition, the total potential at the electrode location $\\mathbf{r}_e = (x_e, y_e, z_e)$ is the sum of the potentials from each of the $N$ compartments of the AIS:\n$$ \\phi_e(t) = \\sum_{k=0}^{N-1} \\phi_k(t) = \\sum_{k=0}^{N-1} \\frac{I_m^{(k)}(t)}{4 \\pi \\sigma r_k} $$\nHere, $I_m^{(k)}(t)$ is the total transmembrane current from compartment $k$ at time $t$, and $r_k$ is the Euclidean distance from the center of compartment $k$ to the electrode:\n$$ r_k = \\sqrt{(x_e - x_k)^2 + y_e^2 + z_e^2} $$\n\n**2. Calculating the Transmembrane Current**\nThe total transmembrane current for each compartment, $I_m^{(k)}(t)$, is the product of the total current density $j_m(x_k, t)$ and the compartment's surface area $A_k = 2 \\pi a \\ell$. The total current density is the sum of capacitive and ionic components:\n$$ I_m^{(k)}(t) = A_k \\left( j_{\\mathrm{cap}}(x_k, t) + j_{\\mathrm{Na}}(x_k, t) + j_{\\mathrm{K}}(x_k, t) \\right) $$\nThe components are calculated as follows:\n- **Capacitive Current ($j_{\\mathrm{cap}}$):** This current is proportional to the rate of change of the membrane potential, $j_{\\mathrm{cap}} = C_m \\frac{\\partial V_m}{\\partial t}$. Taking the time derivative of the given $V_m(x,t)$ function yields:\n$$ \\frac{\\partial V_m}{\\partial t} = \\frac{\\Delta V}{2\\tau_v} \\mathrm{sech}^2\\left(\\frac{(t - x/v) - t_0}{\\tau_v}\\right) $$\nThe capacitive current density is thus driven by the upstroke of the action potential.\n- **Ionic Currents ($j_{\\mathrm{Na}}$, $j_{\\mathrm{K}}$):** These are given directly by the problem as Gaussian functions representing the influx of sodium and efflux of potassium, delayed relative to the voltage upstroke and each other.\n\n**3. Numerical Simulation and Feature Extraction**\nThe algorithm proceeds as follows:\n1.  **Discretize:** Create a time vector $t$ and a vector of compartment center positions $x_k$.\n2.  **Compute Currents:** For each time point and each compartment, calculate $j_{\\mathrm{cap}}$, $j_{\\mathrm{Na}}$, and $j_{\\mathrm{K}}$, and sum them to get the total transmembrane current $I_m^{(k)}(t)$. This is best done using vectorized operations.\n3.  **Compute Potential:** For each time point, calculate the total extracellular potential $\\phi_e(t)$ by summing the contributions from all compartments, weighted by their geometric factors $1/(4 \\pi \\sigma r_k)$.\n4.  **Extract Features:**\n    -   **Negative Peak Magnitude ($\\mathrm{amp}_{\\mu V}$):** Find the minimum value of the computed $\\phi_e(t)$ waveform. The magnitude is its absolute value, converted to microvolts.\n    -   **Scaling Factor ($s$):** The system is linear. The minimal scaling factor to reach a detection threshold $\\theta$ is calculated directly from the linearity principle: $s = \\theta / \\mathrm{amp}$.\n    -   **FWHM ($\\mathrm{FWHM}_{\\mathrm{ms}}$):** Find the time of the negative peak. Then, find the two time points (one before, one after the peak) where the waveform crosses the half-minimum value ($\\phi_{\\min}/2$). Linear interpolation between discrete time steps is used for accuracy. The difference between these two times gives the FWHM, which is converted to milliseconds.\n\nThis entire process is repeated for each test case, which specifies a different electrode position and detection threshold.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and analyzes the extracellular potential of an axon initial segment.\n    \"\"\"\n    # Define fixed parameters in SI units\n    L = 30e-6  # m\n    a = 0.5e-6  # m\n    N = 15  # number of compartments\n    C_m = 0.01  # F/m^2\n    V_rest = -70e-3  # V\n    delta_V = 90e-3  # V\n    v = 0.6  # m/s\n    sigma = 0.3  # S/m\n    z_e = 0.0  # m\n\n    # Time parameters in s\n    t0 = 0.25e-3\n    tau_v = 0.12e-3\n    t_Na = 0.30e-3\n    tau_Na = 0.10e-3\n    t_K = 1.00e-3\n    tau_K = 0.40e-3\n\n    # Current density magnitudes in A/m^2\n    j_Na0 = 8.0\n    j_K0 = 4.0\n\n    # Time discretization in s\n    t_min = -1.0e-3\n    t_max = 3.0e-3\n    dt = 0.01e-3\n    t = np.arange(t_min, t_max + dt, dt) # Time vector\n\n    # Spatial discretization\n    ell = L / N  # Compartment length, m\n    A_k = 2 * np.pi * a * ell  # Compartment surface area, m^2\n    x_k = (np.arange(N) + 0.5) * ell  # Compartment center coordinates, m\n\n    # Test cases\n    test_cases = [\n        # (x_e_um, y_e_um, theta_uV)\n        (15.0, 10.0, 15.0),  # Case 1\n        (0.0, 5.0, 10.0),   # Case 2\n        (30.0, 50.0, 5.0),  # Case 3\n    ]\n\n    results = []\n    \n    # Pre-compute time-dependent components\n    # Use broadcasting: t is (T, 1), x_k is (1, N) - result is (T, N)\n    t_reshaped = t[:, np.newaxis]\n    x_k_reshaped = x_k[np.newaxis, :]\n    \n    # Propagation time delay\n    t_prop = t_reshaped - x_k_reshaped / v\n\n    # Capacitive current density (A/m^2)\n    xi = (t_prop - t0) / tau_v\n    # Note sech(x) = 1/cosh(x)\n    j_cap = C_m * (delta_V / (2 * tau_v)) * (1 / np.cosh(xi))**2\n\n    # Sodium current density (A/m^2)\n    arg_Na = -((t_prop - t_Na)**2) / (2 * tau_Na**2)\n    j_Na = -j_Na0 * np.exp(arg_Na)\n    \n    # Potassium current density (A/m^2)\n    arg_K = -((t_prop - t_K)**2) / (2 * tau_K**2)\n    j_K = j_K0 * np.exp(arg_K)\n\n    # Total transmembrane current (A)\n    j_m = j_cap + j_Na + j_K  # Total current density (A/m^2)\n    I_m = A_k * j_m          # Total current per compartment (A), shape (T, N)\n\n    for case in test_cases:\n        x_e_um, y_e_um, theta_uV = case\n        x_e = x_e_um * 1e-6  # m\n        y_e = y_e_um * 1e-6  # m\n        theta_V = theta_uV * 1e-6 # V\n        \n        # Calculate geometric factor 1 / (4*pi*sigma*r)\n        r_k = np.sqrt((x_e - x_k)**2 + y_e**2 + z_e**2)\n        G_k = 1 / (4 * np.pi * sigma * r_k) # Shape (N,)\n        \n        # Compute extracellular potential by summing contributions\n        # This is a matrix-vector product: (T, N) @ (N,) - (T,)\n        phi_e = np.dot(I_m, G_k)\n\n        # 1. Negative peak magnitude\n        phi_min = np.min(phi_e)\n        amp_V = -phi_min\n        amp_muV = amp_V * 1e6\n\n        # 2. Minimal scaling factor\n        if amp_V > 0:\n            s = theta_V / amp_V\n        else: # Handle case of no negative peak\n            s = float('inf') if theta_V > 0 else 0.0\n\n        # 3. Full width at half-minimum (FWHM)\n        min_idx = np.argmin(phi_e)\n        half_min = phi_min / 2.0\n        \n        # Find crossing points using linear interpolation\n        # Rising edge (before peak)\n        try:\n            # Search for the last point before the peak that is above half_min\n            idx1 = np.where(phi_e[:min_idx+1] > half_min)[0][-1]\n            # Interpolate to find time t1\n            y1, y2 = phi_e[idx1], phi_e[idx1 + 1]\n            t1_s, t2_s = t[idx1], t[idx1 + 1]\n            t_cross1 = t1_s + (t2_s - t1_s) * (half_min - y1) / (y2 - y1)\n        except IndexError:\n            t_cross1 = np.nan # Not found\n\n        # Falling edge (after peak)\n        try:\n            # Search for the first point after the peak that is above half_min\n            idx2 = np.where(phi_e[min_idx:] > half_min)[0][0] + min_idx\n            # Interpolate to find time t2\n            y1, y2 = phi_e[idx2 - 1], phi_e[idx2]\n            t1_s, t2_s = t[idx2 - 1], t[idx2]\n            t_cross2 = t1_s + (t2_s - t1_s) * (half_min - y1) / (y2 - y1)\n        except IndexError:\n            t_cross2 = np.nan # Not found\n\n        if not np.isnan(t_cross1) and not np.isnan(t_cross2):\n             FWHM_s = t_cross2 - t_cross1\n        else:\n             FWHM_s = 0.0 # Or np.nan, but problem implies it's well-defined.\n        \n        FWHM_ms = FWHM_s * 1e3\n        \n        results.append([amp_muV, s, FWHM_ms])\n\n    # Format the final output string exactly as specified\n    final_results = []\n    for r in results:\n        final_results.append([round(val, 8) for val in r])\n\n    print(f\"[{','.join(map(str, final_results))}]\")\n\n\nsolve()\n```"
        }
    ]
}