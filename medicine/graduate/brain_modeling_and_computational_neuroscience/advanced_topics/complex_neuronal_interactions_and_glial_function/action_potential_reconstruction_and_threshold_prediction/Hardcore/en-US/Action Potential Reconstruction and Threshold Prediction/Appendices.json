{
    "hands_on_practices": [
        {
            "introduction": "Understanding how a neuron decides to fire an action potential is a cornerstone of computational neuroscience. This exercise delves into the heart of spike generation by analyzing a simplified, yet powerful, dynamical model. By exploring the geometry of nullclines and the stability of the resting state, you will derive from first principles how a biophysical property like leak conductance, $g_{L}$, not only sets the firing threshold but also determines the fundamental class of excitability the neuron displays .",
            "id": "3960964",
            "problem": "Consider a two-dimensional reduction of a conductance-based neuron near spike onset, in which the fast membrane voltage variable $V$ is approximated by a cubic nonlinearity arising from the balance of inward activation and outward currents, and the slow recovery variable $w$ is linear in $V$. Let the explicit leak conductance $g_{L}$ enter the fast current balance as a linear Ohmic term. The reduced, dimensionless system is\n$$\n\\begin{aligned}\n\\frac{dV}{dt} = f(V,w;I,g_{L}) \\equiv (\\alpha-g_{L})\\,V - \\beta V^{3} - w + I,\\\\\n\\frac{dw}{dt} = \\epsilon\\left(\\kappa V + \\lambda - w\\right),\n\\end{aligned}\n$$\nwith parameters $\\alpha0$, $\\beta0$, $\\kappa0$, $\\lambda \\in \\mathbb{R}$, and $0\\epsilon\\ll 1$. The external stimulus $I$ is a constant applied current. This model is a canonical cubic fast–slow reduction derived from the current conservation law\n$$\nC\\frac{dV}{dt} = -I_{\\text{ion}}(V,w;g_{L}) + I,\n$$\nwhere the leak current is linear in $V$ with slope $g_{L}$ and the fast inward current has been approximated by a linear term in $V$ minus a saturating cubic nonlinearity. The $V$-nullcline is the cubic\n$$\nw = (\\alpha-g_{L})\\,V - \\beta V^{3} + I,\n$$\nand the $w$-nullcline is the straight line\n$$\nw = \\kappa V + \\lambda.\n$$\n\nAnswer the following:\n\n1) Starting from these nullclines and the definition of the knee points of the cubic as the solutions of $dw/dV = 0$, determine how increasing $g_{L}$ shifts the $V$-nullcline and moves its knee points in the $(V,w)$-plane. State your result in terms of $(\\alpha-g_{L})$ and $\\beta$.\n\n2) In the singular limit $\\epsilon\\to 0^{+}$, the onset of repetitive spiking as $I$ is slowly increased from rest occurs either via a saddle-node on invariant circle (SNIC) or via a Hopf bifurcation, depending on geometry. Using only the geometry of the nullclines and linearization at equilibrium, derive a condition on $g_{L}$ (relative to the other parameters) that separates these two onset types when $I$ is varied. Your condition must be stated in terms of the relative slope between the cubic $V$-nullcline and the $w$-nullcline at their intersection.\n\n3) Under the condition you identified that yields a saddle-node on invariant circle (SNIC) onset, the rheobase (the minimal constant current $I$ for which repetitive spiking occurs) is attained when the line $w=\\kappa V+\\lambda$ is tangent to the cubic $w=(\\alpha-g_{L})V-\\beta V^{3}+I$ at the left knee (i.e., at negative $V$). By enforcing the tangency conditions, derive a closed-form expression for the rheobase $I_{\\mathrm{rh}}(g_{L})$ in terms of $\\alpha$, $\\beta$, $\\kappa$, $\\lambda$, and $g_{L}$. Express your final answer as a single analytic expression. No numerical rounding is required. State clearly any sign choice you make for the knee point.\n\nProvide your reasoning from the fundamental current-balance law, the definitions of nullclines and knee points, and linear stability criteria, and avoid invoking pre-packaged formulas for rheobase. Your final answer must be the explicit analytic expression for $I_{\\mathrm{rh}}(g_{L})$ in dimensionless units, enclosed in a single expression.",
            "solution": "The problem presents a canonical fast-slow dynamical system representing a reduced conductance-based neuron model. We are tasked with analyzing the geometric properties of its nullclines and deriving conditions for different firing onsets, ultimately calculating the rheobase current for one specific onset type. The analysis will proceed in three parts as requested.\n\nThe system is given by:\n$$\n\\begin{aligned}\n\\frac{dV}{dt} = (\\alpha-g_{L})\\,V - \\beta V^{3} - w + I \\\\\n\\frac{dw}{dt} = \\epsilon\\left(\\kappa V + \\lambda - w\\right)\n\\end{aligned}\n$$\nThe $V$-nullcline, where $\\frac{dV}{dt}=0$, is the cubic function $w(V) = (\\alpha-g_{L})V - \\beta V^3 + I$. The $w$-nullcline, where $\\frac{dw}{dt}=0$, is the line $w(V) = \\kappa V + \\lambda$. The parameters are defined as $\\alpha0$, $\\beta0$, $\\kappa0$, $\\lambda \\in \\mathbb{R}$, and $0\\epsilon\\ll 1$.\n\n**Part 1: Effect of leak conductance $g_{L}$ on the $V$-nullcline and its knee points**\n\nThe equation for the $V$-nullcline is $w = (\\alpha-g_{L})V - \\beta V^3 + I$. The leak conductance $g_L$ appears in the linear term. Increasing $g_L$ decreases the coefficient $(\\alpha-g_{L})$. For a given $I$, this has the effect of \"flattening\" the cubic shape. For $V  0$, an increase in $g_L$ decreases the value of $w$ on the nullcline. For $V  0$, an increase in $g_L$ increases the value of $w$. This constitutes a shear transformation that pivots the nullcline around the point $(0, I)$.\n\nThe knee points of the cubic $V$-nullcline are its local extrema, defined by the condition $\\frac{dw}{dV} = 0$. We compute the derivative with respect to $V$:\n$$\n\\frac{dw}{dV} = (\\alpha-g_{L}) - 3\\beta V^2\n$$\nSetting this to zero yields the $V$-coordinates of the knee points:\n$$\n(\\alpha-g_{L}) - 3\\beta V^2 = 0 \\implies V^2 = \\frac{\\alpha-g_{L}}{3\\beta}\n$$\nFor two real knee points to exist, we must have $\\alpha-g_{L}  0$. Assuming this condition holds, the $V$-coordinates are:\n$$\nV_{\\text{knees}} = \\pm\\sqrt{\\frac{\\alpha-g_{L}}{3\\beta}}\n$$\nAs $g_L$ increases, the term $(\\alpha-g_{L})$ decreases. Consequently, the magnitude $|V_{\\text{knees}}|$ decreases, meaning the knee points move horizontally towards the $w$-axis ($V=0$).\n\nTo find the $w$-coordinates of the knee points, we substitute $V_{\\text{knees}}$ back into the nullcline equation:\n$$\nw_{\\text{knees}} = (\\alpha-g_{L})V_{\\text{knees}} - \\beta V_{\\text{knees}}^3 + I = V_{\\text{knees}}\\left((\\alpha-g_{L}) - \\beta V_{\\text{knees}}^2\\right) + I\n$$\nUsing the relation $V_{\\text{knees}}^2 = \\frac{\\alpha-g_{L}}{3\\beta}$, we substitute for the $\\beta V_{\\text{knees}}^2$ term:\n$$\nw_{\\text{knees}} = V_{\\text{knees}}\\left((\\alpha-g_{L}) - \\beta \\frac{\\alpha-g_{L}}{3\\beta}\\right) + I = V_{\\text{knees}}\\left((\\alpha-g_{L}) - \\frac{1}{3}(\\alpha-g_{L})\\right) + I = \\frac{2}{3}(\\alpha-g_{L})V_{\\text{knees}} + I\n$$\nSubstituting the expression for $V_{\\text{knees}}$:\n$$\nw_{\\text{knees}} = \\frac{2}{3}(\\alpha-g_{L})\\left(\\pm\\sqrt{\\frac{\\alpha-g_{L}}{3\\beta}}\\right) + I = \\pm\\frac{2(\\alpha-g_{L})^{3/2}}{3\\sqrt{3\\beta}} + I\n$$\nAs $g_L$ increases, $(\\alpha-g_{L})$ decreases, so the magnitude of the term $\\pm\\frac{2(\\alpha-g_{L})^{3/2}}{3\\sqrt{3\\beta}}}$ also decreases. This means the $w$-coordinates of the knees move towards the value $I$.\n\nIn summary, increasing the leak conductance $g_L$ causes the two knee points of the $V$-nullcline to move closer to each other, converging on the point $(0, I)$ in the $(V, w)$-plane.\n\n**Part 2: Condition distinguishing SNIC and Hopf bifurcation onsets**\n\nThe onset of repetitive spiking occurs when the stable fixed point of the system (the resting state) loses stability as the current $I$ is increased. The type of bifurcation depends on how the eigenvalues of the Jacobian matrix cross the imaginary axis. A fixed point $(V_*, w_*)$ is an intersection of the nullclines. The Jacobian matrix $J$ at a fixed point is:\n$$\nJ = \\begin{pmatrix} \\frac{\\partial\\dot{V}}{\\partial V}  \\frac{\\partial\\dot{V}}{\\partial w} \\\\ \\frac{\\partial\\dot{w}}{\\partial V}  \\frac{\\partial\\dot{w}}{\\partial w} \\end{pmatrix}_{(V_*, w_*)} = \\begin{pmatrix} (\\alpha-g_{L}) - 3\\beta V_*^2  -1 \\\\ \\epsilon\\kappa  -\\epsilon \\end{pmatrix}\n$$\nLet $S_V = (\\alpha-g_{L}) - 3\\beta V_*^2$ be the slope of the $V$-nullcline at the fixed point. The Jacobian becomes $J = \\begin{pmatrix} S_V  -1 \\\\ \\epsilon\\kappa  -\\epsilon \\end{pmatrix}$.\nThe trace and determinant are:\n$$\n\\text{Tr}(J) = S_V - \\epsilon\n$$\n$$\n\\text{Det}(J) = S_V(-\\epsilon) - (-1)(\\epsilon\\kappa) = \\epsilon(\\kappa - S_V)\n$$\nA fixed point is stable if $\\text{Tr}(J)  0$ and $\\text{Det}(J)  0$. In the singular limit $\\epsilon\\to 0^+$, these conditions become $S_V  0$ and $\\kappa  S_V$. The resting state of a neuron is a stable fixed point, typically at a negative potential $V_*$. The $V$-nullcline has an N-shape, and the stable fixed points lie on the outer branches where the slope $S_V$ is negative. Thus, for the resting state, $S_V  0$, and since $\\kappa  0$, the stability conditions are satisfied.\n\nAs $I$ is increased, the $V$-nullcline shifts upwards, and the fixed point $(V_*, w_*)$ moves. Stability is lost when either $\\text{Tr}(J)$ or $\\text{Det}(J)$ becomes zero.\nA saddle-node bifurcation occurs when $\\text{Det}(J)=0$, which implies $S_V = \\kappa$. This corresponds to the $w$-nullcline becoming tangent to the $V$-nullcline.\nA Hopf bifurcation occurs when $\\text{Tr}(J)=0$ while $\\text{Det}(J)0$, which implies $S_V = \\epsilon \\approx 0$.\n\nThe type of bifurcation is determined by the global geometry of the nullclines. Fixed points are solutions to $(\\alpha-g_{L})V - \\beta V^3 + I = \\kappa V + \\lambda$, which can be rewritten as $\\beta V^3 + (\\kappa - (\\alpha-g_L))V + \\lambda - I = 0$. The number of real roots for $V$ determines the number of fixed points.\nThis depends on the sign of the coefficient of the linear term, $\\kappa - (\\alpha-g_L)$.\nCase 1: $\\kappa  \\alpha-g_L$. The function $F(V) = \\beta V^3 + (\\kappa - (\\alpha-g_L))V$ is monotonic. For any value of $I$, there is always exactly one fixed point. As $I$ increases, this fixed point moves from the stable left branch (where $S_V  0$) to the unstable middle branch (where $S_V0$). The loss of stability occurs when $S_V$ crosses from negative to positive. The bifurcation point is where $\\text{Tr}(J) = S_V - \\epsilon = 0$, or $S_V=\\epsilon$. Since at this point $\\text{Det}(J) = \\epsilon(\\kappa - \\epsilon)  0$ (as $\\kappa  \\alpha-g_L  0$ and $\\epsilon \\ll 1$), this is a Hopf bifurcation.\n\nCase 2: $\\kappa  \\alpha-g_L$. The coefficient $\\kappa - (\\alpha-g_L)$ is negative. The function $F(V)$ is non- monotonic, allowing for one or three real roots depending on the value of $I$. This means there is a range of $I$ for which the system has three fixed points (a stable node, a saddle, and an unstable node/spiral). As $I$ is increased from a low value, the initial stable resting state (node) moves towards the saddle point. At a critical value of $I$, they merge and annihilate. This is a saddle-node bifurcation. Since the trajectory leaving the bifurcation point follows a large excursion in phase space (a spike) that returns near the saddle-node point, it is a saddle-node on invariant circle (SNIC) bifurcation.\n\nTherefore, the condition separating the two onset types is the relative slope of the $w$-nullcline, $\\kappa$, compared to the maximum positive slope of the $V$-nullcline. The slope of the $V$-nullcline is $S_V(V) = (\\alpha-g_L) - 3\\beta V^2$. Its maximum value occurs at $V=0$ and is $S_{V, \\text{max}} = \\alpha-g_L$.\nThe condition is:\n- **SNIC onset** if the slope of the $w$-nullcline is less than the maximal slope of the $V$-nullcline: $\\kappa  \\alpha-g_L$.\n- **Hopf onset** if the slope of the $w$-nullcline is greater than the maximal slope of the $V$-nullcline: $\\kappa  \\alpha-g_L$.\n\n**Part 3: Rheobase current $I_{\\mathrm{rh}}(g_{L})$ for SNIC onset**\n\nWe are in the SNIC regime, where $\\kappa  \\alpha-g_L$. The rheobase current $I_{\\text{rh}}$ is the minimum current that causes the neuron to fire, which corresponds to the value of $I$ at which the saddle-node bifurcation occurs. As stated in the problem and consistent with our analysis, this happens when the $w$-nullcline $w = \\kappa V + \\lambda$ is tangent to the $V$-nullcline $w = (\\alpha-g_L)V - \\beta V^3 + I$. The problem specifies that this tangency occurs at the \"left knee\", which we interpret as the saddle-node point at negative voltage, $V0$.\n\nThe conditions for tangency at a point $V=V_{\\text{rh}}$ are:\n1.  The values of $w$ are equal: $\\kappa V_{\\text{rh}} + \\lambda = (\\alpha-g_L)V_{\\text{rh}} - \\beta V_{\\text{rh}}^3 + I_{\\text{rh}}$\n2.  The slopes (derivatives with respect to $V$) are equal: $\\kappa = (\\alpha-g_L) - 3\\beta V_{\\text{rh}}^2$\n\nFrom the second condition, we solve for $V_{\\text{rh}}$:\n$$\n3\\beta V_{\\text{rh}}^2 = \\alpha-g_L-\\kappa \\implies V_{\\text{rh}}^2 = \\frac{\\alpha-g_L-\\kappa}{3\\beta}\n$$\nThe bifurcating fixed point is on the left, so we take the negative root for $V_{\\text{rh}}$:\n$$\nV_{\\text{rh}} = -\\sqrt{\\frac{\\alpha-g_L-\\kappa}{3\\beta}}\n$$\nThis choice is consistent, as a real solution requires $\\alpha-g_L-\\kappa  0$, the condition for the SNIC regime.\n\nNow, we use the first condition to solve for $I_{\\text{rh}}$:\n$$\nI_{\\text{rh}} = (\\kappa - (\\alpha-g_L))V_{\\text{rh}} + \\beta V_{\\text{rh}}^3 + \\lambda\n$$\nWe can factor out $V_{\\text{rh}}$:\n$$\nI_{\\text{rh}} = V_{\\text{rh}}\\left(\\kappa - (\\alpha-g_L) + \\beta V_{\\text{rh}}^2\\right) + \\lambda\n$$\nSubstitute $\\beta V_{\\text{rh}}^2 = \\frac{1}{3}(\\alpha-g_L-\\kappa)$:\n$$\nI_{\\text{rh}} = V_{\\text{rh}}\\left(\\kappa - (\\alpha-g_L) + \\frac{1}{3}(\\alpha-g_L-\\kappa)\\right) + \\lambda\n$$\n$$\nI_{\\text{rh}} = V_{\\text{rh}}\\left(-(\\alpha-g_L-\\kappa) + \\frac{1}{3}(\\alpha-g_L-\\kappa)\\right) + \\lambda\n$$\n$$\nI_{\\text{rh}} = V_{\\text{rh}}\\left(-\\frac{2}{3}(\\alpha-g_L-\\kappa)\\right) + \\lambda\n$$\nNow, substitute the expression for $V_{\\text{rh}}$:\n$$\nI_{\\text{rh}} = \\left(-\\sqrt{\\frac{\\alpha-g_L-\\kappa}{3\\beta}}\\right)\\left(-\\frac{2}{3}(\\alpha-g_L-\\kappa)\\right) + \\lambda\n$$\nThe two negative signs cancel, yielding:\n$$\nI_{\\text{rh}}(g_{L}) = \\frac{2}{3}(\\alpha-g_L-\\kappa) \\sqrt{\\frac{\\alpha-g_L-\\kappa}{3\\beta}} + \\lambda\n$$\nThis expression can be simplified to its final form:\n$$\nI_{\\text{rh}}(g_{L}) = \\lambda + \\frac{2(\\alpha-g_L-\\kappa)^{3/2}}{3\\sqrt{3\\beta}}\n$$\nThis is the closed-form expression for the rheobase current as a function of the leak conductance $g_L$ and the other system parameters, under the condition for a SNIC bifurcation.",
            "answer": "$$\n\\boxed{\\lambda + \\frac{2}{3\\sqrt{3\\beta}}(\\alpha - g_{L} - \\kappa)^{3/2}}\n$$"
        },
        {
            "introduction": "An action potential is not a single point event, but a wave of current flowing across the cell membrane, which generates a rich signal in the extracellular space. This practice guides you through building a forward model to reconstruct the extracellular signature of a spike propagating along the axon initial segment (AIS). By discretizing the AIS into compartments and summing their contributions, you will learn how the spatial and temporal interplay of transmembrane currents shapes the waveform that neurophysiologists measure experimentally .",
            "id": "3960959",
            "problem": "Consider a homogeneous, isotropic, and quasi-static extracellular medium surrounding a neuron, modeled with scalar conductivity $\\sigma$ expressed in $\\mathrm{S/m}$. The axon initial segment (AIS) is represented as a straight cylindrical cable of length $L$ and radius $a$, aligned along the $x$-axis, and discretized into $N$ equal cylindrical compartments. The center of compartment $k$ ($k = 0,1,\\dots,N-1$) is at axial coordinate $x_k = (k + \\tfrac{1}{2}) \\ell$, where $\\ell = L/N$ is the compartment length. Each compartment has membrane surface area $A_k = 2 \\pi a \\ell$. An extracellular point electrode is placed at coordinates $(x_e, y_e, z_e)$, with the AIS axis coincident with the $x$-axis at $(y,z)=(0,0)$. Distances are three-dimensional Euclidean distances in $\\mathrm{m}$.\n\nYou must reconstruct the extracellular action potential at the electrode due solely to AIS transmembrane currents under the quasi-static volume conductor approximation. Begin from a valid base: the cable equation and Maxwell’s equations in the quasi-static limit, using well-tested facts such as linear superposition of current sources in a homogeneous ohmic medium. Do not invoke any pre-given target expressions for the extracellular potential; derive the necessary expressions from first principles.\n\nModel the AIS dynamics as a traveling spike with conduction velocity $v$ moving in the $+x$ direction. The membrane potential at axial position $x$ is\n$$\nV_m(x,t) = V_{\\mathrm{rest}} + \\Delta V \\cdot \\frac{1}{2}\\left(1 + \\tanh\\left(\\frac{\\left(t - \\frac{x}{v}\\right) - t_0}{\\tau_v}\\right)\\right),\n$$\nwhere $V_{\\mathrm{rest}}$ is the resting potential in $\\mathrm{V}$, $\\Delta V$ is the spike amplitude in $\\mathrm{V}$, $t_0$ is the upstroke center in $\\mathrm{s}$, and $\\tau_v$ is the upstroke timescale in $\\mathrm{s}$. The capacitive current density (membrane charge displacement) is\n$$\nj_{\\mathrm{cap}}(x,t) = C_m \\frac{\\partial V_m(x,t)}{\\partial t},\n$$\nwith $C_m$ the specific membrane capacitance in $\\mathrm{F/m^2}$. The ionic current densities are approximated as the sum of a fast inward sodium-like pulse and a delayed outward potassium-like pulse:\n$$\nj_{\\mathrm{Na}}(x,t) = - j_{\\mathrm{Na},0} \\exp\\left(-\\frac{\\left(\\left(t - \\frac{x}{v}\\right) - t_{\\mathrm{Na}}\\right)^2}{2 \\tau_{\\mathrm{Na}}^2}\\right),\n\\quad\nj_{\\mathrm{K}}(x,t) = + j_{\\mathrm{K},0} \\exp\\left(-\\frac{\\left(\\left(t - \\frac{x}{v}\\right) - t_{\\mathrm{K}}\\right)^2}{2 \\tau_{\\mathrm{K}}^2}\\right),\n$$\nwhere $j_{\\mathrm{Na},0}$ and $j_{\\mathrm{K},0}$ are the peak magnitudes in $\\mathrm{A/m^2}$, and $t_{\\mathrm{Na}}, \\tau_{\\mathrm{Na}}, t_{\\mathrm{K}}, \\tau_{\\mathrm{K}}$ are the centers and timescales in $\\mathrm{s}$.\n\nThe transmembrane current for compartment $k$ is\n$$\nI_m^{(k)}(t) = A_k \\left( j_{\\mathrm{cap}}(x_k,t) + j_{\\mathrm{Na}}(x_k,t) + j_{\\mathrm{K}}(x_k,t) \\right),\n$$\nand the extracellular potential at the electrode is obtained by superposition over compartments.\n\nYour program must:\n- Derive, then implement, the reconstruction of the extracellular potential at the electrode due to $\\{I_m^{(k)}(t)\\}$.\n- Compute the following shape features of the electrode potential waveform $\\phi_e(t)$:\n  1. The magnitude of the most negative deflection (the negative peak) in $\\mathrm{\\mu V}$, returned as a positive float.\n  2. The full width at half-minimum (FWHM) of the negative deflection in $\\mathrm{ms}$, defined as the time interval between the two points where $\\phi_e(t)$ reaches half of its most negative value on either side of the negative peak.\n- Predict the minimal dimensionless scaling factor $s$ such that the negative peak magnitude reaches or exceeds a provided detection threshold $\\theta$ in $\\mathrm{\\mu V}$. Use the linearity of the volume conductor model.\n\nUse the following fixed parameters and units:\n- Geometry: $L = 30\\,\\mathrm{\\mu m}$, $a = 0.5\\,\\mathrm{\\mu m}$, $N=15$.\n- Electrophysiology: $C_m = 0.01\\,\\mathrm{F/m^2}$, $V_{\\mathrm{rest}} = -70\\,\\mathrm{mV}$, $\\Delta V = 90\\,\\mathrm{mV}$, $t_0=0.25\\,\\mathrm{ms}$, $\\tau_v=0.12\\,\\mathrm{ms}$, $t_{\\mathrm{Na}}=0.30\\,\\mathrm{ms}$, $\\tau_{\\mathrm{Na}}=0.10\\,\\mathrm{ms}$, $t_{\\mathrm{K}}=1.00\\,\\mathrm{ms}$, $\\tau_{\\mathrm{K}}=0.40\\,\\mathrm{ms}$, $j_{\\mathrm{Na},0}=8\\,\\mathrm{A/m^2}$, $j_{\\mathrm{K},0}=4\\,\\mathrm{A/m^2}$.\n- Medium: $\\sigma = 0.3\\,\\mathrm{S/m}$.\n- Conduction velocity: $v = 0.6\\,\\mathrm{m/s}$.\n- Electrode $z$-coordinate: $z_e = 0\\,\\mathrm{\\mu m}$.\n- Time window and sampling: $t \\in [t_{\\min}, t_{\\max}]$ with $t_{\\min} = -1.0\\,\\mathrm{ms}$, $t_{\\max} = 3.0\\,\\mathrm{ms}$, and $\\Delta t = 0.01\\,\\mathrm{ms}$.\n\nTest suite (three cases):\n- Case 1 (happy path): $x_e = 15\\,\\mathrm{\\mu m}$, $y_e = 10\\,\\mathrm{\\mu m}$, $\\theta = 15\\,\\mathrm{\\mu V}$.\n- Case 2 (near electrode, start-aligned): $x_e = 0\\,\\mathrm{\\mu m}$, $y_e = 5\\,\\mathrm{\\mu m}$, $\\theta = 10\\,\\mathrm{\\mu V}$.\n- Case 3 (far electrode, end-aligned): $x_e = 30\\,\\mathrm{\\mu m}$, $y_e = 50\\,\\mathrm{\\mu m}$, $\\theta = 5\\,\\mathrm{\\mu V}$.\n\nYour program should output, for each case, a list of three floats of the form $[\\mathrm{amp}_{\\mu V}, s, \\mathrm{FWHM}_{\\mathrm{ms}}]$, where $\\mathrm{amp}_{\\mu V}$ is the magnitude of the negative peak in $\\mathrm{\\mu V}$, $s$ is the minimal scaling factor (dimensionless), and $\\mathrm{FWHM}_{\\mathrm{ms}}$ is the full width at half-minimum in $\\mathrm{ms}$. Aggregate the three case results into a single line of output containing a comma-separated list enclosed in square brackets. For example, your final output format must be\n$$\n[\\,[\\mathrm{amp}_1, s_1, \\mathrm{FWHM}_1],\\,[\\mathrm{amp}_2, s_2, \\mathrm{FWHM}_2],\\,[\\mathrm{amp}_3, s_3, \\mathrm{FWHM}_3]\\,].\n$$\nAll physical quantities must be computed in SI units internally; convert the final amplitudes to $\\mathrm{\\mu V}$ and FWHM to $\\mathrm{ms}$ for output. Angles are not used. Percentages are not used; express scaling factors as decimals.",
            "solution": "### Step 1: Extract Givens\n**Geometry:**\n- Axon initial segment (AIS) length: $L = 30\\,\\mathrm{\\mu m}$\n- AIS radius: $a = 0.5\\,\\mathrm{\\mu m}$\n- Number of compartments: $N=15$\n- Compartment length: $\\ell = L/N$\n- Compartment surface area: $A_k = 2 \\pi a \\ell$\n- Compartment center axial coordinate: $x_k = (k + \\tfrac{1}{2}) \\ell$ for $k = 0,1,\\dots,N-1$\n- Electrode coordinates: $(x_e, y_e, z_e)$, with $z_e = 0\\,\\mathrm{\\mu m}$\n\n**Electrophysiology:**\n- Specific membrane capacitance: $C_m = 0.01\\,\\mathrm{F/m^2}$\n- Resting membrane potential: $V_{\\mathrm{rest}} = -70\\,\\mathrm{mV}$\n- Spike amplitude: $\\Delta V = 90\\,\\mathrm{mV}$\n- Conduction velocity: $v = 0.6\\,\\mathrm{m/s}$\n- Membrane potential model: $V_m(x,t) = V_{\\mathrm{rest}} + \\Delta V \\cdot \\frac{1}{2}\\left(1 + \\tanh\\left(\\frac{\\left(t - \\frac{x}{v}\\right) - t_0}{\\tau_v}\\right)\\right)$\n- $V_m$ upstroke center: $t_0=0.25\\,\\mathrm{ms}$\n- $V_m$ upstroke timescale: $\\tau_v=0.12\\,\\mathrm{ms}$\n- Capacitive current density: $j_{\\mathrm{cap}}(x,t) = C_m \\frac{\\partial V_m(x,t)}{\\partial t}$\n- Sodium current density: $j_{\\mathrm{Na}}(x,t) = - j_{\\mathrm{Na},0} \\exp\\left(-\\frac{\\left(\\left(t - \\frac{x}{v}\\right) - t_{\\mathrm{Na}}\\right)^2}{2 \\tau_{\\mathrm{Na}}^2}\\right)$\n- Potassium current density: $j_{\\mathrm{K}}(x,t) = + j_{\\mathrm{K},0} \\exp\\left(-\\frac{\\left(\\left(t - \\frac{x}{v}\\right) - t_{\\mathrm{K}}\\right)^2}{2 \\tau_{\\mathrm{K}}^2}\\right)$\n- Sodium current peak magnitude: $j_{\\mathrm{Na},0}=8\\,\\mathrm{A/m^2}$\n- Sodium current center: $t_{\\mathrm{Na}}=0.30\\,\\mathrm{ms}$\n- Sodium current timescale: $\\tau_{\\mathrm{Na}}=0.10\\,\\mathrm{ms}$\n- Potassium current peak magnitude: $j_{\\mathrm{K},0}=4\\,\\mathrm{A/m^2}$\n- Potassium current center: $t_{\\mathrm{K}}=1.00\\,\\mathrm{ms}$\n- Potassium current timescale: $\\tau_{\\mathrm{K}}=0.40\\,\\mathrm{ms}$\n- Compartment transmembrane current: $I_m^{(k)}(t) = A_k \\left( j_{\\mathrm{cap}}(x_k,t) + j_{\\mathrm{Na}}(x_k,t) + j_{\\mathrm{K}}(x_k,t) \\right)$\n\n**Medium and Time:**\n- Extracellular conductivity: $\\sigma = 0.3\\,\\mathrm{S/m}$\n- Time window: $t \\in [-1.0\\,\\mathrm{ms}, 3.0\\,\\mathrm{ms}]$\n- Time step: $\\Delta t = 0.01\\,\\mathrm{ms}$\n\n**Test Cases:**\n- Case 1: $x_e = 15\\,\\mathrm{\\mu m}$, $y_e = 10\\,\\mathrm{\\mu m}$, $\\theta = 15\\,\\mathrm{\\mu V}$\n- Case 2: $x_e = 0\\,\\mathrm{\\mu m}$, $y_e = 5\\,\\mathrm{\\mu m}$, $\\theta = 10\\,\\mathrm{\\mu V}$\n- Case 3: $x_e = 30\\,\\mathrm{\\mu m}$, $y_e = 50\\,\\mathrm{\\mu m}$, $\\theta = 5\\,\\mathrm{\\mu V}$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in established principles of computational neuroscience, namely volume conductor theory and cable theory for neuronal modeling. The use of the quasi-static approximation of Maxwell's equations is standard for low-frequency biopotentials. The mathematical models for membrane potential and ionic currents are simplified but standard representations. The problem is well-posed, providing all necessary parameters, equations, and a clear set of objectives. There are no contradictions, ambiguities, or subjective claims. The parameters are within biophysically plausible ranges. The problem is objective, formalizable, and non-trivial.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A full solution will be provided.\n\n### Principle-Based Solution Derivation and Algorithmic Design\n\nThe problem requires the reconstruction and analysis of the extracellular potential generated by an axon initial segment (AIS). The derivation begins from fundamental principles of electrostatics in a conductive medium.\n\n**1. Potential from a Point Current Source**\nUnder the quasi-static approximation, the electric field in a homogeneous, isotropic conductive medium with conductivity $\\sigma$ is governed by Ohm's law, $\\mathbf{J} = \\sigma \\mathbf{E}$, and charge conservation, $\\nabla \\cdot \\mathbf{J} = I_{\\mathrm{v}}$, where $I_{\\mathrm{v}}$ is the volume current source density. With $\\mathbf{E} = -\\nabla \\phi$, this gives Poisson's equation for the electric potential $\\phi$:\n$$ \\nabla^2 \\phi = -\\frac{I_{\\mathrm{v}}}{\\sigma} $$\nFor a point current source of strength $I$ located at the origin, $I_{\\mathrm{v}} = I \\delta(\\mathbf{r})$, where $\\delta(\\mathbf{r})$ is the Dirac delta function. The solution in a three-dimensional unbounded medium is:\n$$ \\phi(r) = \\frac{I}{4 \\pi \\sigma r} $$\nwhere $r$ is the Euclidean distance from the source.\n\n**2. Superposition for Multiple Sources**\nThe AIS is discretized into $N$ cylindrical compartments. Each compartment $k$ acts as a current source/sink with a time-varying transmembrane current $I_m^{(k)}(t)$. By the principle of superposition, the total potential $\\phi_e(t)$ at the electrode location $\\mathbf{r}_e = (x_e, y_e, z_e)$ is the sum of the potentials from each compartment, approximated as a point source at its center $\\mathbf{r}_k = (x_k, 0, 0)$.\n$$ \\phi_e(t) = \\sum_{k=0}^{N-1} \\frac{I_m^{(k)}(t)}{4 \\pi \\sigma r_k} $$\nThe distance $r_k$ between the center of compartment $k$ and the electrode is:\n$$ r_k = \\|\\mathbf{r}_e - \\mathbf{r}_k\\| = \\sqrt{(x_e - x_k)^2 + y_e^2 + z_e^2} $$\n\n**3. Transmembrane Current Calculation**\nThe total current $I_m^{(k)}(t)$ from compartment $k$ is the product of the total transmembrane current density $j_m(x_k, t)$ and the compartment's surface area $A_k = 2 \\pi a \\ell$, where $\\ell = L/N$.\n$$ I_m^{(k)}(t) = A_k \\cdot j_m(x_k, t) = A_k \\left( j_{\\mathrm{cap}}(x_k, t) + j_{\\mathrm{Na}}(x_k, t) + j_{\\mathrm{K}}(x_k, t) \\right) $$\nThe components of the current density are:\n- **Capacitive Current ($j_{\\mathrm{cap}}$):** This is determined by the rate of change of the membrane potential. We first compute the time derivative of $V_m(x, t)$:\n$$ \\frac{\\partial V_m(x,t)}{\\partial t} = \\frac{\\partial}{\\partial t} \\left[ V_{\\mathrm{rest}} + \\frac{\\Delta V}{2}\\left(1 + \\tanh\\left(\\frac{t - x/v - t_0}{\\tau_v}\\right)\\right) \\right] $$\n$$ \\frac{\\partial V_m(x,t)}{\\partial t} = \\frac{\\Delta V}{2} \\cdot \\mathrm{sech}^2\\left(\\frac{t - x/v - t_0}{\\tau_v}\\right) \\cdot \\frac{1}{\\tau_v} $$\nwhere $\\mathrm{sech}(u) = 1/\\cosh(u)$. The capacitive current density is thus:\n$$ j_{\\mathrm{cap}}(x,t) = C_m \\frac{\\partial V_m(x,t)}{\\partial t} = C_m \\frac{\\Delta V}{2\\tau_v} \\mathrm{sech}^2\\left(\\frac{t - x/v - t_0}{\\tau_v}\\right) $$\n- **Ionic Currents ($j_{\\mathrm{Na}}$, $j_{\\mathrm{K}}$):** These are given directly by Gaussian functions modeling inward sodium and outward potassium flow.\n$$ j_{\\mathrm{Na}}(x,t) = - j_{\\mathrm{Na},0} \\exp\\left(-\\frac{\\left((t - x/v) - t_{\\mathrm{Na}}\\right)^2}{2 \\tau_{\\mathrm{Na}}^2}\\right) $$\n$$ j_{\\mathrm{K}}(x,t) = + j_{\\mathrm{K},0} \\exp\\left(-\\frac{\\left((t - x/v) - t_{\\mathrm{K}}\\right)^2}{2 \\tau_{\\mathrm{K}}^2}\\right) $$\nThe term $(t - x/v)$ represents the arrival time of the traveling wave at position $x$.\n\n**4. Waveform Feature Extraction**\nOnce the time series $\\phi_e(t)$ is computed, we extract the required features:\n1.  **Negative Peak Magnitude ($\\mathrm{amp}$):** We find the minimum value of the potential waveform, $\\phi_{\\min} = \\min_t(\\phi_e(t))$. The magnitude is its absolute value, $\\mathrm{amp} = |\\phi_{\\min}| = -\\phi_{\\min}$ (since $\\phi_{\\min}$ is negative). This value is converted to microvolts ($\\mathrm{\\mu V}$) for output.\n2.  **Full Width at Half-Minimum (FWHM):** This measures the duration of the negative peak. We first find the half-minimum value, $\\phi_{1/2} = \\phi_{\\min} / 2$. Then, we find the two time points, $t_1$ and $t_2$, on either side of the peak time $t_{\\min}$, where $\\phi_e(t)$ crosses $\\phi_{1/2}$. The FWHM is the difference $t_2 - t_1$. Linear interpolation is used between discrete time samples to accurately locate $t_1$ and $t_2$. The result is converted to milliseconds ($\\mathrm{ms}$) for output.\n3.  **Minimal Scaling Factor ($s$):** The system is linear, meaning if currents $\\{I_m^{(k)}\\}$ produce potential $\\phi_e$, then currents $\\{s \\cdot I_m^{(k)}\\}$ produce potential $s \\cdot \\phi_e$. We need to find the minimal $s \\ge 0$ such that the magnitude of the new negative peak, $s \\cdot \\mathrm{amp}$, reaches or exceeds the threshold $\\theta$.\n    $$ s \\cdot \\mathrm{amp} \\ge \\theta $$\n    The minimal factor is thus $s = \\theta / \\mathrm{amp}$. This is a dimensionless quantity.\n\n**Algorithmic Implementation**\nThe calculation will be implemented using vectorized operations for efficiency. A time vector `t` and compartment position vector `x_k` are created. The time-dependent currents for all compartments are computed simultaneously using broadcasting, resulting in a matrix where rows represent time points and columns represent compartments. The final potential $\\phi_e(t)$ is obtained by a matrix-vector product between the total transmembrane current matrix and a geometric weight vector derived from the distances $r_k$. Following this, the feature extraction procedures are applied as described above for each test case. All calculations are performed in base SI units, with conversions to $\\mathrm{\\mu V}$ and $\\mathrm{ms}$ applied only for the final output.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and analyzes the extracellular potential of an axon initial segment.\n    \"\"\"\n    # Define fixed parameters in SI units\n    L = 30e-6  # m\n    a = 0.5e-6  # m\n    N = 15  # number of compartments\n    C_m = 0.01  # F/m^2\n    V_rest = -70e-3  # V\n    delta_V = 90e-3  # V\n    v = 0.6  # m/s\n    sigma = 0.3  # S/m\n    z_e = 0.0  # m\n\n    # Time parameters in s\n    t0 = 0.25e-3\n    tau_v = 0.12e-3\n    t_Na = 0.30e-3\n    tau_Na = 0.10e-3\n    t_K = 1.00e-3\n    tau_K = 0.40e-3\n\n    # Current density magnitudes in A/m^2\n    j_Na0 = 8.0\n    j_K0 = 4.0\n\n    # Time discretization in s\n    t_min = -1.0e-3\n    t_max = 3.0e-3\n    dt = 0.01e-3\n    t = np.arange(t_min, t_max + dt, dt) # Time vector\n\n    # Spatial discretization\n    ell = L / N  # Compartment length, m\n    A_k = 2 * np.pi * a * ell  # Compartment surface area, m^2\n    x_k = (np.arange(N) + 0.5) * ell  # Compartment center coordinates, m\n\n    # Test cases\n    test_cases = [\n        # (x_e_um, y_e_um, theta_uV)\n        (15.0, 10.0, 15.0),  # Case 1\n        (0.0, 5.0, 10.0),   # Case 2\n        (30.0, 50.0, 5.0),  # Case 3\n    ]\n\n    results = []\n    \n    # Pre-compute time-dependent components\n    # Use broadcasting: t is (T, 1), x_k is (1, N) - result is (T, N)\n    t_reshaped = t[:, np.newaxis]\n    x_k_reshaped = x_k[np.newaxis, :]\n    \n    # Propagation time delay\n    t_prop = t_reshaped - x_k_reshaped / v\n\n    # Capacitive current density (A/m^2)\n    xi = (t_prop - t0) / tau_v\n    # Note sech(x) = 1/cosh(x)\n    j_cap = C_m * (delta_V / (2 * tau_v)) * (1 / np.cosh(xi))**2\n\n    # Sodium current density (A/m^2)\n    arg_Na = -((t_prop - t_Na)**2) / (2 * tau_Na**2)\n    j_Na = -j_Na0 * np.exp(arg_Na)\n    \n    # Potassium current density (A/m^2)\n    arg_K = -((t_prop - t_K)**2) / (2 * tau_K**2)\n    j_K = j_K0 * np.exp(arg_K)\n\n    # Total transmembrane current (A)\n    j_m = j_cap + j_Na + j_K  # Total current density (A/m^2)\n    I_m = A_k * j_m          # Total current per compartment (A), shape (T, N)\n\n    for case in test_cases:\n        x_e_um, y_e_um, theta_uV = case\n        x_e = x_e_um * 1e-6  # m\n        y_e = y_e_um * 1e-6  # m\n        theta_V = theta_uV * 1e-6 # V\n        \n        # Calculate geometric factor 1 / (4*pi*sigma*r)\n        r_k = np.sqrt((x_e - x_k)**2 + y_e**2 + z_e**2)\n        G_k = 1 / (4 * np.pi * sigma * r_k) # Shape (N,)\n        \n        # Compute extracellular potential by summing contributions\n        # This is a matrix-vector product: (T, N) @ (N,) - (T,)\n        phi_e = np.dot(I_m, G_k)\n\n        # 1. Negative peak magnitude\n        phi_min = np.min(phi_e)\n        amp_V = -phi_min\n        amp_muV = amp_V * 1e6\n\n        # 2. Minimal scaling factor\n        if amp_V > 0:\n            s = theta_V / amp_V\n        else: # Handle case of no negative peak\n            s = float('inf') if theta_V > 0 else 0.0\n\n        # 3. Full width at half-minimum (FWHM)\n        min_idx = np.argmin(phi_e)\n        half_min = phi_min / 2.0\n        \n        # Find crossing points using linear interpolation\n        # Rising edge (before peak)\n        try:\n            # Search for the last point before the peak that is above half_min\n            idx1 = np.where(phi_e[:min_idx+1] > half_min)[0][-1]\n            # Interpolate to find time t1\n            y1, y2 = phi_e[idx1], phi_e[idx1 + 1]\n            t1_s, t2_s = t[idx1], t[idx1 + 1]\n            t_cross1 = t1_s + (t2_s - t1_s) * (half_min - y1) / (y2 - y1)\n        except IndexError:\n            t_cross1 = np.nan # Not found\n\n        # Falling edge (after peak)\n        try:\n            # Search for the first point after the peak that is above half_min\n            idx2 = np.where(phi_e[min_idx:] > half_min)[0][0] + min_idx\n            # Interpolate to find time t2\n            y1, y2 = phi_e[idx2 - 1], phi_e[idx2]\n            t1_s, t2_s = t[idx2 - 1], t[idx2]\n            t_cross2 = t1_s + (t2_s - t1_s) * (half_min - y1) / (y2 - y1)\n        except IndexError:\n            t_cross2 = np.nan # Not found\n\n        if not np.isnan(t_cross1) and not np.isnan(t_cross2):\n             FWHM_s = t_cross2 - t_cross1\n        else:\n             FWHM_s = 0.0 # Or np.nan, but problem implies it's well-defined.\n        \n        FWHM_ms = FWHM_s * 1e3\n        \n        results.append([amp_muV, s, FWHM_ms])\n\n    final_results = []\n    for r in results:\n        final_results.append([round(val, 8) for val in r])\n\n    print(f\"[{','.join(map(str, final_results))}]\")\n\n\nsolve()\n```"
        },
        {
            "introduction": "The brain tissue through which electrical signals travel is not a simple, uniform medium, a fact that has profound implications for interpreting extracellular recordings. This problem challenges you to go beyond the standard isotropic assumption and model the effect of anisotropic conductivity on the extracellular potential. Through this analysis, you will quantify how overlooking the tissue's physical properties can lead to systematic errors in estimating the precise timing of neural spikes, a critical lesson for accurately decoding neural activity .",
            "id": "3960982",
            "problem": "You are modeling the extracellular potential generated by a single neuronal current source in a homogeneous, infinite, ohmic medium with anisotropic conductivity. Under the quasi-static approximation, the electric potential field satisfies a divergence form equation driven by a point source. Your tasks are to derive, implement, and use the forward-model Green’s function for anisotropic conductivity to quantify the timing bias incurred when threshold timing is inferred under the incorrect assumption of isotropy.\n\nStart from the following base principles and definitions, and do not invoke any pre-derived target expressions for the anisotropic Green’s function. You must derive any specific expressions you use from these bases.\n\n- Ohmic conduction: the current density is $ \\mathbf{J} = \\boldsymbol{\\sigma} \\mathbf{E} $, where $ \\boldsymbol{\\sigma} $ is a constant, symmetric, positive-definite conductivity tensor and $ \\mathbf{E} = -\\nabla \\phi $ is the electric field from potential $ \\phi $.\n- Charge conservation and quasi-static approximation imply the governing Partial Differential Equation (PDE) $ \\nabla \\cdot (\\boldsymbol{\\sigma} \\nabla \\phi) = -I \\delta(\\mathbf{r} - \\mathbf{r}_0) $, where $ I $ is the injected current, $ \\delta(\\cdot) $ is the Dirac delta distribution, and $ \\mathbf{r}_0 $ is the source location.\n- In an isotropic medium with scalar conductivity $ s $, the isotropic Green’s function for a point source located at $ \\mathbf{r}_0 $ in $ \\mathbb{R}^3 $ has the form $ \\phi(\\mathbf{r}) \\propto \\frac{1}{s \\|\\mathbf{r} - \\mathbf{r}_0\\|} $.\n\nAssume the neuronal transmembrane current time course is known and monotonically increasing on the time interval of interest, modeled by a saturating exponential\n$$\nI(t) = I_{\\max} \\left(1 - e^{-\\frac{t - t_0}{\\tau}}\\right), \\quad t \\ge t_0,\n$$\nwhere $ I_{\\max}  0 $ is the asymptotic peak current, $ t_0 $ is the onset time, and $ \\tau  0 $ is the rise time constant. The extracellular potential at a fixed electrode location $ \\mathbf{r}_e $ is related to the source current by linear superposition:\n$$\n\\phi(\\mathbf{r}_e, t) = G(\\mathbf{r}_e - \\mathbf{r}_0; \\boldsymbol{\\sigma}) \\, I(t),\n$$\nwhere $ G(\\cdot; \\boldsymbol{\\sigma}) $ is the forward-model Green’s function kernel evaluated at the electrode-source displacement vector $ \\mathbf{r}_e - \\mathbf{r}_0 $.\n\nYour goal is to:\n\n1. Derive the closed-form anisotropic Green’s function $ G(\\mathbf{r}; \\boldsymbol{\\sigma}) $ for a homogeneous, infinite medium with a diagonal conductivity tensor $ \\boldsymbol{\\sigma} = \\mathrm{diag}(\\sigma_x, \\sigma_y, \\sigma_z) $.\n2. Given a scalar isotropic conductivity assumption $ s $, derive the ratio $ R $ between the isotropic and anisotropic forward-model kernels at the same displacement $ \\mathbf{r} $, defined as\n$$\nR = \\frac{G_{\\mathrm{iso}}(\\mathbf{r}; s)}{G(\\mathbf{r}; \\boldsymbol{\\sigma})},\n$$\nwhere $ G_{\\mathrm{iso}}(\\mathbf{r}; s) $ is the isotropic kernel under conductivity $ s $.\n3. Define the inferred threshold timing under an isotropic assumption as the solution $ t_{\\mathrm{est}} $ to\n$$\n\\phi(\\mathbf{r}_e, t_{\\mathrm{est}}) = G_{\\mathrm{iso}}(\\mathbf{r}_e - \\mathbf{r}_0; s) \\, I_{\\mathrm{thr}},\n$$\nwhere $ I_{\\mathrm{thr}} $ is a fixed membrane current threshold. The true threshold timing is $ t_{\\mathrm{true}} $ solving\n$$\nI(t_{\\mathrm{true}}) = I_{\\mathrm{thr}}.\n$$\nUsing the derived expressions and the given $ I(t) $, obtain a closed-form formula for the timing bias\n$$\n\\Delta t = t_{\\mathrm{est}} - t_{\\mathrm{true}}.\n$$\n\nThen, implement a complete, runnable program that computes $ \\Delta t $ for the following test suite. Express all times in milliseconds as real-valued floats.\n\nTest suite (each case specifies $ (\\sigma_x, \\sigma_y, \\sigma_z) $ in siemens per meter, $ s $ in siemens per meter, $ \\mathbf{r}_e - \\mathbf{r}_0 $ in meters, $ I_{\\max} $ and $ I_{\\mathrm{thr}} $ in amperes, and $ (t_0, \\tau) $ in seconds):\n\n- Case $ 1 $ (baseline isotropy, happy path):\n  - $ (\\sigma_x, \\sigma_y, \\sigma_z) = (0.3, 0.3, 0.3) $\n  - $ s = 0.3 $\n  - $ \\mathbf{r}_e - \\mathbf{r}_0 = (50 \\times 10^{-6}, 0, 0) $\n  - $ I_{\\max} = 2 \\times 10^{-9} $, $ I_{\\mathrm{thr}} = 1 \\times 10^{-9} $\n  - $ t_0 = 0 $, $ \\tau = 0.4 \\times 10^{-3} $\n- Case $ 2 $ (anisotropy, electrode along high-conductivity axis):\n  - $ (\\sigma_x, \\sigma_y, \\sigma_z) = (0.6, 0.3, 0.2) $\n  - $ s = 0.3 $\n  - $ \\mathbf{r}_e - \\mathbf{r}_0 = (50 \\times 10^{-6}, 0, 0) $\n  - $ I_{\\max} = 2 \\times 10^{-9} $, $ I_{\\mathrm{thr}} = 1 \\times 10^{-9} $\n  - $ t_0 = 0 $, $ \\tau = 0.4 \\times 10^{-3} $\n- Case $ 3 $ (anisotropy, electrode along low-conductivity axis):\n  - $ (\\sigma_x, \\sigma_y, \\sigma_z) = (0.6, 0.3, 0.2) $\n  - $ s = 0.3 $\n  - $ \\mathbf{r}_e - \\mathbf{r}_0 = (0, 50 \\times 10^{-6}, 0) $\n  - $ I_{\\max} = 2 \\times 10^{-9} $, $ I_{\\mathrm{thr}} = 1 \\times 10^{-9} $\n  - $ t_0 = 0 $, $ \\tau = 0.4 \\times 10^{-3} $\n- Case $ 4 $ (anisotropy, oblique electrode-source displacement):\n  - $ (\\sigma_x, \\sigma_y, \\sigma_z) = (0.6, 0.3, 0.2) $\n  - $ s = 0.3 $\n  - $ \\mathbf{r}_e - \\mathbf{r}_0 = (30 \\times 10^{-6}, 40 \\times 10^{-6}, 0) $\n  - $ I_{\\max} = 2 \\times 10^{-9} $, $ I_{\\mathrm{thr}} = 1 \\times 10^{-9} $\n  - $ t_0 = 0 $, $ \\tau = 0.4 \\times 10^{-3} $\n- Case $ 5 $ (boundary case: near-saturation threshold):\n  - $ (\\sigma_x, \\sigma_y, \\sigma_z) = (0.4, 0.2, 0.2) $\n  - $ s = 0.3 $\n  - $ \\mathbf{r}_e - \\mathbf{r}_0 = (50 \\times 10^{-6}, 0, 0) $\n  - $ I_{\\max} = 2 \\times 10^{-9} $, $ I_{\\mathrm{thr}} = 1.9 \\times 10^{-9} $\n  - $ t_0 = 0 $, $ \\tau = 0.5 \\times 10^{-3} $\n\nYour program should produce a single line of output containing the timing biases for the five cases, expressed in milliseconds, as a comma-separated list enclosed in square brackets (for example, $ [\\Delta t_1, \\Delta t_2, \\Delta t_3, \\Delta t_4, \\Delta t_5] $). The program must compute $ \\Delta t $ exactly as defined above and must be runnable as-is, requiring no external input. Ensure scientific realism by using the derived formulas for $ G(\\mathbf{r}; \\boldsymbol{\\sigma}) $ and $ G_{\\mathrm{iso}}(\\mathbf{r}; s) $, and by handling only physically valid configurations (for instance, do not evaluate at $ \\mathbf{r}_e = \\mathbf{r}_0 $ where the Green’s function diverges). The angle unit is not required because no angular quantities are used. Times must be reported in milliseconds.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. The underlying principles from electrostatics and calculus are standard and correctly stated. We will proceed by first deriving the necessary analytical expressions and then implementing them numerically for the given test cases.\n\n### Part 1: Derivation of the Anisotropic Green's Function\n\nWe begin with the governing partial differential equation (PDE) for the electric potential $\\phi$ in a medium with anisotropic conductivity $\\boldsymbol{\\sigma}$, driven by a point current source of strength $I$ at location $\\mathbf{r}_0$:\n$$\n\\nabla \\cdot (\\boldsymbol{\\sigma} \\nabla \\phi) = -I \\delta(\\mathbf{r} - \\mathbf{r}_0)\n$$\nThe Green's function, denoted $G(\\mathbf{r}; \\mathbf{r}_0)$, is the solution to this equation for a unit source ($I=1$) at $\\mathbf{r}_0$. By translational invariance of the infinite, homogeneous medium, we can set the source at the origin, $\\mathbf{r}_0 = \\mathbf{0}$, and solve for $G(\\mathbf{r}) \\equiv G(\\mathbf{r}; \\mathbf{0})$. The solution for a source at an arbitrary $\\mathbf{r}_0$ is then $G(\\mathbf{r} - \\mathbf{r}_0)$. The PDE becomes:\n$$\n\\nabla \\cdot (\\boldsymbol{\\sigma} \\nabla G) = -\\delta(\\mathbf{r})\n$$\nThe problem specifies a diagonal conductivity tensor $\\boldsymbol{\\sigma} = \\mathrm{diag}(\\sigma_x, \\sigma_y, \\sigma_z)$, where $\\sigma_x, \\sigma_y, \\sigma_z$ are constants. The divergence term expands to:\n$$\n\\nabla \\cdot (\\boldsymbol{\\sigma} \\nabla G) = \\frac{\\partial}{\\partial x}\\left(\\sigma_x \\frac{\\partial G}{\\partial x}\\right) + \\frac{\\partial}{\\partial y}\\left(\\sigma_y \\frac{\\partial G}{\\partial y}\\right) + \\frac{\\partial}{\\partial z}\\left(\\sigma_z \\frac{\\partial G}{\\partial z}\\right) = \\sigma_x \\frac{\\partial^2 G}{\\partial x^2} + \\sigma_y \\frac{\\partial^2 G}{\\partial y^2} + \\sigma_z \\frac{\\partial^2 G}{\\partial z^2}\n$$\nThe PDE is thus a scaled Poisson's equation:\n$$\n\\sigma_x \\frac{\\partial^2 G}{\\partial x^2} + \\sigma_y \\frac{\\partial^2 G}{\\partial y^2} + \\sigma_z \\frac{\\partial^2 G}{\\partial z^2} = -\\delta(x)\\delta(y)\\delta(z)\n$$\nTo solve this, we introduce a coordinate transformation that rescales the space to make the conductivity isotropic. Let $\\mathbf{r}' = (x', y', z')$ be the new coordinates defined by:\n$$\nx' = \\frac{x}{\\sqrt{\\sigma_x}}, \\quad y' = \\frac{y}{\\sqrt{\\sigma_y}}, \\quad z' = \\frac{z}{\\sqrt{\\sigma_z}}\n$$\nUsing the chain rule, the second partial derivatives transform as:\n$$\n\\frac{\\partial^2 G}{\\partial x^2} = \\frac{1}{\\sigma_x} \\frac{\\partial^2 G}{\\partial x'^2}, \\quad \\frac{\\partial^2 G}{\\partial y^2} = \\frac{1}{\\sigma_y} \\frac{\\partial^2 G}{\\partial y'^2}, \\quad \\frac{\\partial^2 G}{\\partial z^2} = \\frac{1}{\\sigma_z} \\frac{\\partial^2 G}{\\partial z'^2}\n$$\nSubstituting these into the PDE gives:\n$$\n\\sigma_x \\left(\\frac{1}{\\sigma_x} \\frac{\\partial^2 G}{\\partial x'^2}\\right) + \\sigma_y \\left(\\frac{1}{\\sigma_y} \\frac{\\partial^2 G}{\\partial y'^2}\\right) + \\sigma_z \\left(\\frac{1}{\\sigma_z} \\frac{\\partial^2 G}{\\partial z'^2}\\right) = -\\delta(x)\\delta(y)\\delta(z)\n$$\nThis simplifies to $\\nabla'^2 G = -\\delta(x)\\delta(y)\\delta(z)$, where $\\nabla'^2$ is the Laplacian in the primed coordinates. We must also transform the Dirac delta function. Using the scaling property $\\delta(ax) = |a|^{-1}\\delta(x)$, we have:\n$$\n\\delta(\\mathbf{r}) = \\delta(x)\\delta(y)\\delta(z) = \\delta(\\sqrt{\\sigma_x}x')\\delta(\\sqrt{\\sigma_y}y')\\delta(\\sqrt{\\sigma_z}z') = \\frac{1}{\\sqrt{\\sigma_x\\sigma_y\\sigma_z}} \\delta(x')\\delta(y')\\delta(z') = \\frac{1}{\\sqrt{\\det(\\boldsymbol{\\sigma})}} \\delta(\\mathbf{r}')\n$$\nThe transformed PDE is now the standard Poisson equation:\n$$\n\\nabla'^2 G(\\mathbf{r}') = -\\frac{1}{\\sqrt{\\det(\\boldsymbol{\\sigma})}} \\delta(\\mathbf{r}')\n$$\nThe well-known solution in $\\mathbb{R}^3$ for the equation $\\nabla^2 u = -S \\delta(\\mathbf{r})$ is $u(\\mathbf{r}) = \\frac{S}{4\\pi \\|\\mathbf{r}\\|}$. Applying this, we get the solution in the primed coordinates:\n$$\nG(\\mathbf{r}') = \\frac{1}{4\\pi \\sqrt{\\det(\\boldsymbol{\\sigma})}} \\frac{1}{\\|\\mathbf{r}'\\|}\n$$\nFinally, we transform back to the original coordinates $\\mathbf{r} = (x,y,z)$. The norm $\\|\\mathbf{r}'\\|$ is:\n$$\n\\|\\mathbf{r}'\\| = \\sqrt{x'^2 + y'^2 + z'^2} = \\sqrt{\\frac{x^2}{\\sigma_x} + \\frac{y^2}{\\sigma_y} + \\frac{z^2}{\\sigma_z}}\n$$\nSubstituting this back, we obtain the anisotropic Green's function for a source at the origin:\n$$\nG(\\mathbf{r}; \\boldsymbol{\\sigma}) = \\frac{1}{4\\pi \\sqrt{\\sigma_x \\sigma_y \\sigma_z} \\sqrt{\\frac{x^2}{\\sigma_x} + \\frac{y^2}{\\sigma_y} + \\frac{z^2}{\\sigma_z}}}\n$$\nThis kernel represents the potential at position $\\mathbf{r}$ due to a unit current source at the origin in an anisotropic medium. For a source at $\\mathbf{r}_0$ and an electrode at $\\mathbf{r}_e$, we simply replace $\\mathbf{r}$ with the displacement vector $\\mathbf{r}_e - \\mathbf{r}_0$.\n\n### Part 2: Derivation of the Ratio $R$\n\nThe problem defines the isotropic Green's function $G_{\\mathrm{iso}}(\\mathbf{r}; s)$ as the solution in a medium with a scalar conductivity $s$. This corresponds to the special case where $\\sigma_x = \\sigma_y = \\sigma_z = s$. Substituting this into our derived anisotropic Green's function:\n$$\nG_{\\mathrm{iso}}(\\mathbf{r}; s) = \\frac{1}{4\\pi \\sqrt{s^3} \\sqrt{\\frac{x^2}{s} + \\frac{y^2}{s} + \\frac{z^2}{s}}} = \\frac{1}{4\\pi s^{3/2} \\frac{\\sqrt{x^2+y^2+z^2}}{\\sqrt{s}}} = \\frac{1}{4\\pi s \\|\\mathbf{r}\\|}\n$$\nThis is the standard result, providing a sanity check on our derivation. The ratio $R$ is defined as:\n$$\nR = \\frac{G_{\\mathrm{iso}}(\\mathbf{r}; s)}{G(\\mathbf{r}; \\boldsymbol{\\sigma})} = \\frac{\\frac{1}{4\\pi s \\|\\mathbf{r}\\|}}{\\frac{1}{4\\pi \\sqrt{\\sigma_x \\sigma_y \\sigma_z} \\sqrt{\\frac{x^2}{\\sigma_x} + \\frac{y^2}{\\sigma_y} + \\frac{z^2}{\\sigma_z}}}}\n$$\nSimplifying this expression gives the formula for $R$:\n$$\nR = \\frac{\\sqrt{\\sigma_x \\sigma_y \\sigma_z} \\sqrt{\\frac{x^2}{\\sigma_x} + \\frac{y^2}{\\sigma_y} + \\frac{z^2}{\\sigma_z}}}{s \\sqrt{x^2+y^2+z^2}}\n$$\nwhere $\\mathbf{r} = (x,y,z) = \\mathbf{r}_e - \\mathbf{r}_0$.\n\n### Part 3: Derivation of the Timing Bias $\\Delta t$\n\nThe true threshold crossing time, $t_{\\mathrm{true}}$, is when the source current $I(t)$ reaches the threshold value $I_{\\mathrm{thr}}$:\n$$\nI(t_{\\mathrm{true}}) = I_{\\max} \\left(1 - e^{-\\frac{t_{\\mathrm{true}} - t_0}{\\tau}}\\right) = I_{\\mathrm{thr}}\n$$\nSolving for $t_{\\mathrm{true}}$:\n$$\n1 - e^{-\\frac{t_{\\mathrm{true}} - t_0}{\\tau}} = \\frac{I_{\\mathrm{thr}}}{I_{\\max}} \\implies e^{-\\frac{t_{\\mathrm{true}} - t_0}{\\tau}} = 1 - \\frac{I_{\\mathrm{thr}}}{I_{\\max}}\n$$\n$$\nt_{\\mathrm{true}} = t_0 - \\tau \\ln\\left(1 - \\frac{I_{\\mathrm{thr}}}{I_{\\max}}\\right)\n$$\nThe estimated time, $t_{\\mathrm{est}}$, is inferred by incorrectly assuming an isotropic medium. The potential is measured at the electrode, $\\phi(\\mathbf{r}_e, t_{\\mathrm{est}})$, and this value is equated to the potential predicted by the isotropic model with a current of $I_{\\mathrm{thr}}$:\n$$\n\\phi(\\mathbf{r}_e, t_{\\mathrm{est}}) = G_{\\mathrm{iso}}(\\mathbf{r}_e - \\mathbf{r}_0; s) \\, I_{\\mathrm{thr}}\n$$\nThe true potential, however, is given by the anisotropic model:\n$$\n\\phi(\\mathbf{r}_e, t_{\\mathrm{est}}) = G(\\mathbf{r}_e - \\mathbf{r}_0; \\boldsymbol{\\sigma}) \\, I(t_{\\mathrm{est}})\n$$\nEquating these two expressions allows us to find the source current $I(t_{\\mathrm{est}})$ that corresponds to the inferred time:\n$$\nG(\\mathbf{r}_e - \\mathbf{r}_0; \\boldsymbol{\\sigma}) \\, I(t_{\\mathrm{est}}) = G_{\\mathrm{iso}}(\\mathbf{r}_e - \\mathbf{r}_0; s) \\, I_{\\mathrm{thr}}\n$$\n$$\nI(t_{\\mathrm{est}}) = \\frac{G_{\\mathrm{iso}}(\\mathbf{r}_e - \\mathbf{r}_0; s)}{G(\\mathbf{r}_e - \\mathbf{r}_0; \\boldsymbol{\\sigma})} \\, I_{\\mathrm{thr}} = R \\cdot I_{\\mathrm{thr}}\n$$\nWe now solve for $t_{\\mathrm{est}}$ using this effective current threshold:\n$$\nI(t_{\\mathrm{est}}) = I_{\\max} \\left(1 - e^{-\\frac{t_{\\mathrm{est}} - t_0}{\\tau}}\\right) = R \\cdot I_{\\mathrm{thr}}\n$$\nFollowing the same steps as for $t_{\\mathrm{true}}$, we find:\n$$\nt_{\\mathrm{est}} = t_0 - \\tau \\ln\\left(1 - \\frac{R \\cdot I_{\\mathrm{thr}}}{I_{\\max}}\\right)\n$$\nThis solution is valid provided that $I_{\\max}  R \\cdot I_{\\mathrm{thr}}$, a condition met by the test cases. The timing bias $\\Delta t$ is the difference $t_{\\mathrm{est}} - t_{\\mathrm{true}}$:\n$$\n\\Delta t = \\left(t_0 - \\tau \\ln\\left(1 - \\frac{R \\cdot I_{\\mathrm{thr}}}{I_{\\max}}\\right)\\right) - \\left(t_0 - \\tau \\ln\\left(1 - \\frac{I_{\\mathrm{thr}}}{I_{\\max}}\\right)\\right)\n$$\n$$\n\\Delta t = \\tau \\left[\\ln\\left(1 - \\frac{I_{\\mathrm{thr}}}{I_{\\max}}\\right) - \\ln\\left(1 - \\frac{R \\cdot I_{\\mathrm{thr}}}{I_{\\max}}\\right)\\right]\n$$\nUsing the logarithmic identity $\\ln(a) - \\ln(b) = \\ln(a/b)$, we arrive at the final closed-form expression for the timing bias:\n$$\n\\Delta t = \\tau \\ln\\left( \\frac{1 - \\frac{I_{\\mathrm{thr}}}{I_{\\max}}}{1 - \\frac{R \\cdot I_{\\mathrm{thr}}}{I_{\\max}}} \\right) = \\tau \\ln\\left( \\frac{I_{\\max} - I_{\\mathrm{thr}}}{I_{\\max} - R \\cdot I_{\\mathrm{thr}}} \\right)\n$$\nThis formula will be implemented to solve the problem for the given test suite. The result will be converted from seconds to milliseconds.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the timing bias in threshold detection due to assuming isotropic\n    conductivity in an anisotropic medium.\n    \"\"\"\n    # Test suite (each case specifies (sigma_x, sigma_y, sigma_z), s, r_vec, I_max, I_thr, (t0, tau))\n    # Units: sigma (S/m), s (S/m), r_vec (m), I (A), t (s)\n    test_cases = [\n        # Case 1: baseline isotropy, happy path\n        {\n            \"sigmas\": (0.3, 0.3, 0.3), \"s\": 0.3, \"r_vec\": (50e-6, 0, 0),\n            \"I_max\": 2e-9, \"I_thr\": 1e-9, \"t0\": 0, \"tau\": 0.4e-3\n        },\n        # Case 2: anisotropy, electrode along high-conductivity axis\n        {\n            \"sigmas\": (0.6, 0.3, 0.2), \"s\": 0.3, \"r_vec\": (50e-6, 0, 0),\n            \"I_max\": 2e-9, \"I_thr\": 1e-9, \"t0\": 0, \"tau\": 0.4e-3\n        },\n        # Case 3: anisotropy, electrode along low-conductivity axis\n        {\n            \"sigmas\": (0.6, 0.3, 0.2), \"s\": 0.3, \"r_vec\": (0, 50e-6, 0),\n            \"I_max\": 2e-9, \"I_thr\": 1e-9, \"t0\": 0, \"tau\": 0.4e-3\n        },\n        # Case 4: anisotropy, oblique electrode-source displacement\n        {\n            \"sigmas\": (0.6, 0.3, 0.2), \"s\": 0.3, \"r_vec\": (30e-6, 40e-6, 0),\n            \"I_max\": 2e-9, \"I_thr\": 1e-9, \"t0\": 0, \"tau\": 0.4e-3\n        },\n        # Case 5: boundary case: near-saturation threshold\n        {\n            \"sigmas\": (0.4, 0.2, 0.2), \"s\": 0.3, \"r_vec\": (50e-6, 0, 0),\n            \"I_max\": 2e-9, \"I_thr\": 1.9e-9, \"t0\": 0, \"tau\": 0.5e-3\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma_x, sigma_y, sigma_z = case[\"sigmas\"]\n        s = case[\"s\"]\n        r_x, r_y, r_z = case[\"r_vec\"]\n        I_max = case[\"I_max\"]\n        I_thr = case[\"I_thr\"]\n        tau = case[\"tau\"]\n\n        # Calculate the ratio R between isotropic and anisotropic Green's functions\n        \n        # Norm of the displacement vector\n        r_norm_sq = r_x**2 + r_y**2 + r_z**2\n        if r_norm_sq == 0:\n            # Handle the singularity case, though not expected in test data\n            # R is undefined, leading to invalid timing bias.\n            # In a real scenario, this would be an error. Here we can use NaN.\n            results.append(np.nan)\n            continue\n            \n        r_norm = np.sqrt(r_norm_sq)\n\n        # Scaled squared norm in anisotropic space\n        r_scaled_norm_sq = (r_x**2 / sigma_x) + (r_y**2 / sigma_y) + (r_z**2 / sigma_z)\n        r_scaled_norm = np.sqrt(r_scaled_norm_sq)\n        \n        # Determinant of the conductivity tensor\n        det_sigma = sigma_x * sigma_y * sigma_z\n        \n        # Ratio R\n        numerator = np.sqrt(det_sigma) * r_scaled_norm\n        denominator = s * r_norm\n        R = numerator / denominator\n\n        # Calculate the timing bias delta_t in seconds\n        # delta_t = tau * log( (I_max - I_thr) / (I_max - R * I_thr) )\n        log_argument_num = I_max - I_thr\n        log_argument_den = I_max - R * I_thr\n        \n        # Check for physical validity (argument of log must be positive)\n        if log_argument_num = 0 or log_argument_den = 0:\n            # Threshold is unreachable\n            delta_t_s = np.inf\n        else:\n            delta_t_s = tau * np.log(log_argument_num / log_argument_den)\n\n        # Convert to milliseconds and append to results\n        delta_t_ms = delta_t_s * 1000.0\n        results.append(delta_t_ms)\n\n    # Format output as a comma-separated list of floating point numbers\n    # Ensure a consistent representation for floating point numbers\n    formatted_results = [f\"{res:.10f}\".rstrip('0').rstrip('.') if res != 0 else \"0.0\" for res in results]\n    \n    # Custom formatting for case 1 to exactly match 0.0\n    if results[0] == 0:\n        formatted_results[0] = \"0.0\"\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}