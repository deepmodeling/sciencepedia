{
    "hands_on_practices": [
        {
            "introduction": "为了理解复杂的 BOLD 信号，我们从最简单的构建模块开始：一个一阶线性模型。这个练习将引导你推导一个假想的血管活性信号对阶跃神经输入的响应，从而让你对时间常数和增益等基本概念有一个扎实的理解。这些概念是所有血液动力学模型的基础。",
            "id": "3998853",
            "problem": "在对功能性磁共振成像（fMRI）测量的血氧水平依赖（BOLD）信号进行建模时，一个常见的抽象概念是，一个潜在的血管活性信号 $s(t)$ 将神经输入 $u(t)$ 转换为血管反应。考虑以下用于血管活性信号的最小、一阶、线性时不变模型：\n$$\\dot{s}(t) \\equiv \\frac{d s(t)}{dt} = -\\frac{s(t)}{\\tau_s} + \\kappa\\, u(t),$$\n其中 $\\tau_s > 0$ 是一个时间常数，$\\kappa > 0$ 是一个增益。神经驱动是一个单位阶跃 $u(t) = H(t)$，其中 $H(t)$ 是亥维赛函数，当 $t0$ 时 $H(t)=0$，当 $t\\ge 0$ 时 $H(t)=1$。假设系统在刺激前处于静止状态，因此当 $t0$ 时 $s(t)=0$，并且在 $t=0$ 时没有发生脉冲输入。\n\n仅从给定的微分方程、$H(t)$ 的定义以及常系数线性微分方程的第一性原理出发，推导出一个对所有实数 $t$ 都有效的 $s(t)$ 的闭式表达式。将你最终的 $s(t)$ 紧凑地表示为一个可能包含 $H(t)$ 的单一表达式。\n\n然后，使用你推导出的解，根据 $t=0^{+}$ 时的初始变化率、趋向稳态的过程以及在持续输入下 $s(t)$ 将达到的稳态水平，简要解释 $\\tau_s$ 和 $\\kappa$ 的生理意义。\n\n你的最终答案必须是 $s(t)$ 的单一解析表达式，并且不得包含单位。不要对你的表达式进行四舍五入或近似。",
            "solution": "将通过首先提取给定条件，然后评估其科学和数学完整性来验证该问题。\n\n### 第1步：提取给定条件\n- **微分方程**: $\\dot{s}(t) \\equiv \\frac{d s(t)}{dt} = -\\frac{s(t)}{\\tau_s} + \\kappa\\, u(t)$\n- **常数**: $\\tau_s  0$ (时间常数), $\\kappa  0$ (增益)\n- **输入函数**: $u(t) = H(t)$，其中 $H(t)$ 是亥维赛阶跃函数：当 $t0$ 时 $H(t)=0$，当 $t\\ge 0$ 时 $H(t)=1$。\n- **初始条件**: 系统处于静止状态，当 $t0$ 时 $s(t)=0$。\n- **约束条件**: 在 $t=0$ 时没有发生脉冲输入。\n\n### 第2步：使用提取的给定条件进行验证\n根据验证标准对问题进行评估。\n\n- **有科学依据**: 所提出的模型是一个一阶线性时不变（LTI）系统。这是所有STEM领域（包括计算神经科学）中用来近似复杂系统动力学的标准和基础建模方法。它代表了fMRI BOLD响应更全面生物物理模型（如Balloon-Windkessel模型）中一个简化但有效的部分。该模型在科学上是公认的。\n- **适定性**: 该问题是一个具有常系数和明确定义强迫函数的一阶线性常微分方程的初值问题。提供了初始条件 $s(t)=0$ (当 $t0$ 时)。非脉冲输入的约束意味着状态变量 $s(t)$ 在 $t=0$ 处是连续的，这足以确定唯一的积分常数。因此，该问题是适定的，并存在唯一的稳定解。\n- **客观性**: 问题使用精确的数学语言和定义陈述。所有术语都是客观的，没有歧义或主观解释。\n- **完整性和一致性**: 问题是自洽的。它提供了控制方程、输入函数、所有必要的参数（$\\tau_s, \\kappa$）以及系统的初始状态。没有矛盾之处。\n- **真实性**: 该模型是复杂生物过程的简化，但它是其领域中一个合理且广泛使用的抽象。参数 $\\tau_s$ 和 $\\kappa$ 具有直接的生理学解释，问题要求对此进行探讨。\n- **其他缺陷**: 该问题不是隐喻性的、琐碎的、同义反复的或无法验证的。这是一个求解线性常微分方程的标准练习。\n\n### 第3步：结论与行动\n问题有效。将推导解答。\n\n### 解答推导\n问题要求解以下一阶线性常微分方程（ODE）：\n$$\n\\frac{ds(t)}{dt} = -\\frac{s(t)}{\\tau_s} + \\kappa\\, u(t)\n$$\n初始条件为当 $t0$ 时 $s(t)=0$，输入为 $u(t)=H(t)$。\n\n该ODE可以重写为标准形式：\n$$\n\\frac{ds(t)}{dt} + \\frac{1}{\\tau_s} s(t) = \\kappa\\, H(t)\n$$\n\n将在两个时间域推导解：$t0$ 和 $t \\ge 0$。\n\n**情况1：$t  0$**\n当 $t  0$ 时，$H(t)=0$。ODE 变为一个齐次方程：\n$$\n\\frac{ds(t)}{dt} + \\frac{1}{\\tau_s} s(t) = 0\n$$\n通解为 $s(t) = C e^{-t/\\tau_s}$，其中 $C$ 是某个常数。然而，问题明确指出当 $t0$ 时 $s(t)=0$。如果我们设置 $C=0$，这与通解是一致的。\n\n**情况2：$t \\ge 0$**\n当 $t \\ge 0$ 时，$H(t)=1$。ODE 变为一个非齐次方程：\n$$\n\\frac{ds(t)}{dt} + \\frac{1}{\\tau_s} s(t) = \\kappa\n$$\n解 $s(t)$ 是齐次解 $s_h(t)$ 和一个特解 $s_p(t)$ 的和。\n\n如前所述，齐次解为 $s_h(t) = A e^{-t/\\tau_s}$，其中 $A$ 是一个积分常数。\n\n对于特解，由于强迫项 $\\kappa$ 是一个常数，我们可以假设一个常数特解 $s_p(t) = K$。将其代入 ODE 得到：\n$$\n\\frac{d}{dt}(K) + \\frac{1}{\\tau_s} K = \\kappa\n$$\n$$\n0 + \\frac{K}{\\tau_s} = \\kappa \\implies K = \\kappa \\tau_s\n$$\n因此，特解是 $s_p(t) = \\kappa \\tau_s$。\n\n对于 $t \\ge 0$ 的通解是齐次解和特解的和：\n$$\ns(t) = s_h(t) + s_p(t) = A e^{-t/\\tau_s} + \\kappa \\tau_s\n$$\n\n为了求出常数 $A$，我们使用初始条件。问题陈述没有脉冲输入，这意味着状态变量 $s(t)$ 在 $t=0$ 处必须是连续的。因此，$s(t)$ 在 $t$ 从右侧趋近于 $0$ ($t \\to 0^{+}$) 时的值必须等于 $t$ 从左侧趋近于 $0$ ($t \\to 0^{-}$) 时的值。\n$$\ns(0) = \\lim_{t \\to 0^+} s(t) = \\lim_{t \\to 0^-} s(t)\n$$\n根据 $t0$ 时的初始条件，我们知道 $\\lim_{t \\to 0^-} s(t) = 0$。因此，$s(0) = 0$。\n\n將此條件應用於 $t \\ge 0$ 的通解：\n$$\ns(0) = A e^{-0/\\tau_s} + \\kappa \\tau_s = A \\cdot 1 + \\kappa \\tau_s = 0\n$$\n解出 $A$ 得到 $A = -\\kappa \\tau_s$。\n\n将 $A$ 的值代回到 $t \\ge 0$ 的解中：\n$$\ns(t) = -\\kappa \\tau_s e^{-t/\\tau_s} + \\kappa \\tau_s = \\kappa \\tau_s (1 - e^{-t/\\tau_s})\n$$\n\n为了将所有实数 $t$ 的解表示为单一表达式，我们使用亥维赛函数 $H(t)$ 合并 $t0$ 和 $t \\ge 0$ 的结果：\n- 当 $t0$ 时，$s(t)=0$。\n- 当 $t \\ge 0$ 时，$s(t) = \\kappa \\tau_s (1 - e^{-t/\\tau_s})$。\n\n这对应于将 $t \\ge 0$ 的解乘以 $H(t)$，当 $t0$ 时 $H(t)$ 为 $0$，当 $t \\ge 0$ 时 $H(t)$ 为 $1$。\n最终的 $s(t)$ 统一表达式为：\n$$\ns(t) = \\kappa \\tau_s (1 - e^{-t/\\tau_s}) H(t)\n$$\n\n### 参数解释\n问题要求解释 $\\tau_s$ 和 $\\kappa$。\n\n1.  **$\\kappa$ (增益) 的解释**：\n    信号的初始变化率是其在 $t=0^{+}$ 处的导数。根据 ODE，且 $s(0)=0$ 和 $u(0^{+})=1$：\n    $$\n    \\dot{s}(0^{+}) = -\\frac{s(0)}{\\tau_s} + \\kappa u(0^{+}) = -\\frac{0}{\\tau_s} + \\kappa(1) = \\kappa\n    $$\n    因此，$\\kappa$ 表示在神经输入阶跃增加后血管活性信号的初始速度或增长率。它是一个增益参数，量化了神经活动驱动血管反应的效能。较大的 $\\kappa$ 意味着更剧烈的初始血管反应。\n\n2.  **$\\tau_s$ (时间常数) 和稳态水平的解释**：\n    当 $t \\to \\infty$ 时，指数项 $e^{-t/\\tau_s}$ 趋近于 $0$。信号的稳态值 $s_{\\infty}$ 是：\n    $$\n    s_{\\infty} = \\lim_{t \\to \\infty} s(t) = \\lim_{t \\to \\infty} \\left[ \\kappa \\tau_s (1 - e^{-t/\\tau_s}) \\right] = \\kappa \\tau_s (1 - 0) = \\kappa \\tau_s\n    $$\n    乘积 $\\kappa \\tau_s$ 是持续刺激下血管活性信号的最大振幅或稳态水平。\n    参数 $\\tau_s$ 是这种指数式趋近稳态的时间常数。在时间 $t=\\tau_s$ 时，信号达到：\n    $$\n    s(\\tau_s) = \\kappa \\tau_s (1 - e^{-\\tau_s/\\tau_s}) = \\kappa \\tau_s (1 - e^{-1}) \\approx 0.632\\, s_{\\infty}\n    $$\n    因此，$\\tau_s$ 是血管活性信号达到其最终稳态值约 $63.2\\%$ 所需的时间。它表征了血管反应的迟缓性：较小的 $\\tau_s$ 意味着更快的反应，能更快达到其最大水平，而较大的 $\\tau_s$ 意味着更慢、更延迟的反应。",
            "answer": "$$\n\\boxed{\\kappa \\tau_s (1 - \\exp(-t/\\tau_s)) H(t)}\n$$"
        },
        {
            "introduction": "在一阶系统的基础上，我们现在来探索一个更具生物物理真实性的模型：用于模拟静脉血容量的“气球-文德克塞尔”（Balloon-Windkessel）模型。这项练习涉及将一个非线性系统线性化——这是一种在建模中广泛使用且功能强大的技术——来分析血流变化如何影响静脉血容量，并量化其特征延迟。通过这个练习，你将深入了解血管系统的“迟缓”特性，这是 BOLD 信号的一个关键特征。",
            "id": "3998782",
            "problem": "考虑一个用于功能性磁共振成像血氧水平依赖 (fMRI BOLD) 信号建模的单室静脉“球囊”模型，其中静脉血容量 $V(t)$ 根据质量守恒定律发生变化：$dV/dt$ 等于动脉流入量 $F_{\\text{in}}(t)$ 减去静脉流出量 $F_{\\text{out}}(t)$。设 Windkessel 流出定律由 $F_{\\text{out}}(t) \\propto V(t)^{1/\\alpha}$ 给出，其中 $\\alpha  0$ 是 Grubb 指数。将变量归一化至其静息（基线）值：$v(t) \\equiv V(t)/V_{0}$ 和 $f_{\\text{in}}(t) \\equiv F_{\\text{in}}(t)/F_{0}$，其中 $V_{0}$ 和 $F_{0}$ 分别是静息状态下的静脉血容量和血流量。定义平均渡越时间 $\\tau_{0} \\equiv V_{0}/F_{0}$。在归一化形式下，假设流出量为 $f_{\\text{out}}(t) = v(t)^{1/\\alpha}$，且静脉血容量动力学由下式决定\n$$\n\\tau_{0}\\,\\frac{dv(t)}{dt} = f_{\\text{in}}(t) - v(t)^{1/\\alpha}.\n$$\n假设在 $t  0$ 时，系统处于静息状态，即 $v(t) = 1$ 且 $f_{\\text{in}}(t) = 1$。在 $t = 0$ 时，动脉流入量发生一个幅度为 $10\\%$ 的持续阶跃增加，即对于 $t \\geq 0$，有 $f_{\\text{in}}(t) = 1 + 0.1\\,u(t)$，其中 $u(t)$ 是单位阶跃函数。假设扰动足够小，可以在静息状态附近进行线性化，并对偏离基线的量取一阶近似。\n\n仅使用这些原理和定义，推导线性化的静脉血容量动力学，解析求解阶跃响应，并由此计算：\n- 静脉血容量的稳态分数变化 $\\Delta v_{\\text{ss}} \\equiv \\lim_{t \\to \\infty} \\left(v(t) - 1\\right)$，以小数形式表示（不要使用百分号），以及\n- 血流量与血容量之间的特征延迟，此处定义为一阶线性化动力学的时间常数 $\\tau_{v}$，即阶跃响应在流入量阶跃后达到其稳态变化的 $1 - 1/\\exp(1)$ 分数时所需的时间。以秒为单位表示该延迟。\n\n使用参数值 $\\alpha = 0.4$ 和 $\\tau_{0} = 1.8\\,\\text{s}$。将 $\\Delta v_{\\text{ss}}$ 四舍五入到四位有效数字，将 $\\tau_{v}$ 四舍五入到三位有效数字。将您的最终答案以一个双元素行矩阵 $\\left(\\Delta v_{\\text{ss}}, \\tau_{v}\\right)$ 的形式报告。",
            "solution": "用户希望我基于 fMRI BOLD 信号球囊模型解决一个问题。\n\n### 步骤 1：问题验证\n\n在尝试求解之前，该问题经过了严格的验证过程。\n\n#### 提取已知条件\n- **静脉血容量动力学**：$\\frac{dV}{dt} = F_{\\text{in}}(t) - F_{\\text{out}}(t)$\n- **Windkessel 流出定律**：$F_{\\text{out}}(t) \\propto V(t)^{1/\\alpha}$，Grubb 指数 $\\alpha  0$。\n- **归一化变量**：$v(t) \\equiv V(t)/V_{0}$，$f_{\\text{in}}(t) \\equiv F_{\\text{in}}(t)/F_{0}$。\n- **平均渡越时间**：$\\tau_{0} \\equiv V_{0}/F_{0}$。\n- **归一化动力学方程**：$\\tau_{0}\\,\\frac{dv(t)}{dt} = f_{\\text{in}}(t) - v(t)^{1/\\alpha}$。\n- **静息状态 ($t  0$)**：$v(t) = 1$，$f_{\\text{in}}(t) = 1$。\n- **输入扰动 ($t \\geq 0$)**：$f_{\\text{in}}(t) = 1 + 0.1\\,u(t)$，其中 $u(t)$ 是单位阶跃函数。这对应于动脉流入量持续增加 $10\\%$。\n- **分析方法**：一阶小扰动分析（线性化）。\n- **要求输出**：\n    1.  静脉血容量的稳态分数变化，$\\Delta v_{\\text{ss}} \\equiv \\lim_{t \\to \\infty} \\left(v(t) - 1\\right)$。\n    2.  特征延迟（时间常数）$\\tau_{v}$，定义为阶跃响应达到其稳态变化的 $1 - 1/\\exp(1)$ 所需的时间。\n- **参数值**：$\\alpha = 0.4$，$\\tau_{0} = 1.8\\,\\text{s}$。\n- **取整说明**：$\\Delta v_{\\text{ss}}$ 取四位有效数字，$\\tau_{v}$ 取三位有效数字。\n\n#### 结论与行动\n\n该问题是**有效的**。\n- **科学依据**：球囊模型是 fMRI 动态因果建模的基石，而 Windkessel 模型是血液动力学中的一个标准原理。该公式在计算神经科学领域具有科学合理性和公认地位。\n- **适定性**：该问题提供了一个具有指定初始条件和明确定义输入函数的非线性常微分方程 (ODE)。要求线性化并求解标准系统响应指标（稳态增益和时间常数）是一个数学上适定的任务。\n- **客观性**：该问题以精确的数学术语陈述，没有歧义或主观因素。所有参数和条件都已明确给出。\n\n该问题满足所有有效性标准。将提供完整解答。\n\n### 步骤 2：推导与求解\n\n起点是归一化的静脉血容量动力学方程：\n$$\n\\tau_{0}\\,\\frac{dv(t)}{dt} = f_{\\text{in}}(t) - v(t)^{1/\\alpha}\n$$\n在 $t  0$ 时，系统处于稳态，即 $v(t)=1$ 且 $f_{\\text{in}}(t)=1$。我们可以将这些值代入方程来验证这是一个平衡点：\n$$\n\\tau_{0}\\,\\frac{d(1)}{dt} = 1 - 1^{1/\\alpha} \\implies 0 = 1 - 1 = 0\n$$\n为了分析对小扰动的响应，我们在该静息状态附近对系统进行线性化。我们定义偏离基线的小量：\n$$\nv(t) = 1 + \\delta v(t)\n$$\n$$\nf_{\\text{in}}(t) = 1 + \\delta f_{\\text{in}}(t)\n$$\n其中 $|\\delta v(t)| \\ll 1$ 且 $|\\delta f_{\\text{in}}(t)| \\ll 1$。\n\n$v(t)$ 的时间导数为：\n$$\n\\frac{dv(t)}{dt} = \\frac{d}{dt}(1 + \\delta v(t)) = \\frac{d(\\delta v)}{dt}\n$$\n非线性流出项 $v(t)^{1/\\alpha}$ 通过在 $\\delta v = 0$ 附近使用一阶泰勒级数展开进行线性化。对于函数 $g(x) = (1+x)^n$，其展开式为 $g(x) \\approx g(0) + g'(0)x$。此处，$x=\\delta v$ 且 $n=1/\\alpha$，因此 $g'(\\delta v) = \\frac{1}{\\alpha}(1+\\delta v)^{(1/\\alpha)-1}$。在 $\\delta v = 0$ 时，$g(0)=1$ 且 $g'(0)=\\frac{1}{\\alpha}$。因此：\n$$\nv(t)^{1/\\alpha} = (1 + \\delta v(t))^{1/\\alpha} \\approx 1 + \\frac{1}{\\alpha}\\delta v(t)\n$$\n将这些线性化表达式代回原始的常微分方程：\n$$\n\\tau_{0}\\,\\frac{d(\\delta v)}{dt} = \\left(1 + \\delta f_{\\text{in}}(t)\\right) - \\left(1 + \\frac{1}{\\alpha}\\delta v(t)\\right)\n$$\n通过消去基线项 `1` 来简化方程：\n$$\n\\tau_{0}\\,\\frac{d(\\delta v)}{dt} = \\delta f_{\\text{in}}(t) - \\frac{1}{\\alpha}\\delta v(t)\n$$\n这是血容量扰动的线性化运动方程。我们可以将其重排为一阶线性时不变 (LTI) 系统的标准形式：\n$$\n\\tau_{0}\\,\\frac{d(\\delta v)}{dt} + \\frac{1}{\\alpha}\\delta v(t) = \\delta f_{\\text{in}}(t)\n$$\n为了确定时间常数，我们将方程两边除以 $\\delta v(t)$ 项的系数：\n$$\n(\\alpha\\tau_{0})\\,\\frac{d(\\delta v)}{dt} + \\delta v(t) = \\alpha\\,\\delta f_{\\text{in}}(t)\n$$\n一个由方程 $\\tau \\frac{dy}{dt} + y = Kx(t)$ 描述的一阶系统，其时间常数为 $\\tau$。通过比较，线性化静脉血容量响应的时间常数（问题中记为 $\\tau_v$）为：\n$$\n\\tau_{v} = \\alpha\\tau_{0}\n$$\n这就是血流量与血容量之间的特征延迟。使用给定的参数值 $\\alpha = 0.4$ 和 $\\tau_{0} = 1.8\\,\\text{s}$：\n$$\n\\tau_{v} = 0.4 \\times 1.8\\,\\text{s} = 0.72\\,\\text{s}\n$$\n问题要求将此值四舍五入到三位有效数字，即 $0.720\\,\\text{s}$。\n\n接下来，我们计算稳态血容量分数变化 $\\Delta v_{\\text{ss}}$。这是扰动 $\\delta v(t)$ 在 $t \\to \\infty$ 时的极限。在稳态下，系统不再变化，因此时间导数为零，即 $\\frac{d(\\delta v)}{dt} = 0$。线性化方程变为：\n$$\n\\frac{1}{\\alpha}\\delta v_{\\text{ss}} = \\delta f_{\\text{in, ss}}\n$$\n其中 $\\delta v_{\\text{ss}}$ 和 $\\delta f_{\\text{in, ss}}$ 是扰动的稳态值。问题指出，对于 $t \\geq 0$，流入量有一个持续 $10\\%$ 的阶跃增加。这意味着对流入量的扰动在 $t \\geq 0$ 时为常数 $\\delta f_{\\text{in}}(t) = 0.1$。因此，稳态输入变化为 $\\delta f_{\\text{in, ss}} = 0.1$。\n求解稳态血容量扰动：\n$$\n\\Delta v_{\\text{ss}} = \\delta v_{\\text{ss}} = \\alpha \\cdot \\delta f_{\\text{in, ss}}\n$$\n代入 $\\alpha$ 和 $\\delta f_{\\text{in, ss}}$ 的值：\n$$\n\\Delta v_{\\text{ss}} = 0.4 \\times 0.1 = 0.04\n$$\n问题要求将此结果四舍五入到四位有效数字，得到 $0.04000$。\n\n为完整起见，我们推导阶跃响应 $\\delta v(t)$ 的完整解析解。对于 $t \\geq 0$，常微分方程为：\n$$\n\\tau_{v}\\,\\frac{d(\\delta v)}{dt} + \\delta v(t) = \\alpha \\cdot (0.1)\n$$\n初始条件为 $\\delta v(0) = 0$，因为系统在阶跃发生前处于静止状态。该常微分方程的解的形式为：\n$$\n\\delta v(t) = \\delta v_{\\text{ss}}(1 - \\exp(-t/\\tau_{v}))\n$$\n代入推导出的 $\\delta v_{\\text{ss}}$ 和 $\\tau_v$ 的表达式：\n$$\n\\delta v(t) = 0.1\\alpha(1 - \\exp(-t/(\\alpha\\tau_0)))\n$$\n这证实了当 $t \\to \\infty$ 时的稳态变化确实是 $0.1\\alpha$，并且控制向这个新稳态指数逼近的时间常数是 $\\alpha\\tau_{0}$。问题中将延迟定义为达到最终值 $1-1/e$ 分数所需的时间，这是对此类一阶指数响应时间常数的标准定义。\n\n需要报告的最终值：\n- 稳态分数变化：$\\Delta v_{\\text{ss}} = 0.04000$。\n- 特征延迟：$\\tau_v = 0.720\\,\\text{s}$。\n要求的输出是一个行矩阵 $(\\Delta v_{\\text{ss}}, \\tau_{v})$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.04000  0.720\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在模拟了 BOLD 信号如何生成之后，我们转向分析 fMRI 数据的实际挑战。这个计算练习模拟了一个常见问题：我们所假设的“标准”血液动力学响应函数（HRF）与大脑中真实的、略有延迟的响应之间存在失配。通过这项实践，你将量化这种失配在统计分析中引入的偏差，并亲眼见证如何通过在模型中增加一个时间导数基函数来显著提高结果的准确性。",
            "id": "3998785",
            "problem": "请将功能性磁共振成像 (fMRI) 血氧水平依赖 (BOLD) 信号的卷积模型视为一个线性时不变系统：观测信号是刺激时间序列与血流动力学响应函数 (HRF) 卷积的结果。设刺激是一个以固定时间分辨率采样的离散时间序列。BOLD 信号遵循卷积的线性叠加和时移特性。通用线性模型 (GLM) 为线性回归参数提供了一个普通最小二乘估计量。\n\n您的任务是量化当使用不匹配的典型HRF拟合由延迟HRF生成的数据时所引入的偏差，并衡量通过时间导数基增强GLM所带来的改善效果。请使用基于卷积模型和线性回归的原理推导来定义和计算幅度偏差及其减少量。\n\n请使用以下基础：\n\n- 观测到的 BOLD 信号被建模为卷积：对于一个刺激序列 $s[n]$ 和一个 HRF $h[n]$，无噪声响应为 $y[n] = \\sum_{k=0}^{\\infty} s[k] h[n-k] \\Delta t$，其中 $\\Delta t$ 是以秒为单位的采样间隔。\n- GLM 假设 $y = X \\beta + \\varepsilon$ 并使用普通最小二乘法来估计 $\\hat{\\beta} = (X^{\\top} X)^{-1} X^{\\top} y$，其中 $X$ 是设计矩阵，$\\varepsilon$ 是残差（此处设 $\\varepsilon = 0$ 以分离模型不匹配偏差）。\n- 典型血流动力学响应函数 (HRF) $h_{0}(t)$ 定义为伽马密度函数的差，在神经影像学中被广泛使用。在离散时间中，在有限支撑集上以间隔 $\\Delta t$ 对其进行采样。\n\n请精确实现以下内容：\n\n1.  设采样间隔为 $\\Delta t = 0.5$ 秒。设总模拟时长为 $T = 120$ 秒。构建离散时间网格 $t = 0, \\Delta t, 2\\Delta t, \\ldots, T - \\Delta t$。\n\n2.  对 $t \\ge 0$ 定义典型 HRF $h_{0}(t)$：\n    $$h_{0}(t) = g(t; a_{1}, b_{1}) - c \\, g(t; a_{2}, b_{2}),$$\n    其中 $g(t; a, b)$ 是伽马密度函数\n    $$g(t; a, b) = \\frac{t^{a-1} e^{-t/b}}{b^{a} \\Gamma(a)}, \\quad t \\ge 0,$$\n    并使用参数 $a_{1} = 6$、$b_{1} = 1$、$a_{2} = 16$、$b_{2} = 1$ 和 $c = 1/6$。在 $t = 0, \\Delta t, \\ldots, t_{\\max}$（其中 $t_{\\max} = 32$ 秒）上对 $h_{0}(t)$ 进行采样，并对于 $t  0$ 设 $h_{0}(t) = 0$。\n\n3.  构建一个刺激序列 $s[n]$，该序列包含在时间点 $10$ 秒、$30$ 秒、$50$ 秒、$70$ 秒和 $90$ 秒开始的五个 $1$ 秒钟的方波事件。也就是说，如果一个事件在时间 $t_{e}$ 开始，则对于索引 $n$ 满足 $t[n] \\in [t_{e}, t_{e} + 1)$ 的情况，设 $s[n] = 1$，否则设 $s[n] = 0$。\n\n4.  将延迟 HRF 定义为 $h_{d}(t) = h_{0}(t - d)$，其中当 $t - d  0$ 时 $h_{d}(t) = 0$，$d$ 是一个以秒为单位的常数延迟，可以是正值（延迟响应）或负值（提前响应）。通过 $d/\\Delta t$ 的整数样本移位，实现采样后 HRF 的离散时间移位。\n\n5.  通过离散卷积生成无噪声的观测数据 $y[n]$：\n    $$y[n] = \\Delta t \\sum_{k=0}^{N-1} s[k] h_{d}[n-k],$$\n    并截断至刺激的长度 $N$。\n\n6.  构建仅含典型 HRF 的 GLM 设计矩阵 $X_{1} = [r_{c}, \\mathbf{1}]$，其中 $\\mathbf{1}$ 是全1列向量，而\n    $$r_{c}[n] = \\Delta t \\sum_{k=0}^{N-1} s[k] h_{0}[n-k],$$\n    是典型回归量。计算普通最小二乘估计值 $\\hat{\\beta}_{1}$，并将幅度估计值 $\\hat{A}_{1}$ 定义为典型回归量的系数，即 $\\hat{\\beta}_{1}$ 的第一个分量。设真实幅度为 $A_{\\text{true}} = 1$。将偏差定义为 $b_{1} = \\hat{A}_{1} - A_{\\text{true}}$。\n\n7.  构建导数增强的 GLM 设计矩阵 $X_{2} = [r_{c}, r_{d}, \\mathbf{1}]$，其中 $r_{d}[n]$ 是通过将刺激与典型 HRF 的时间导数进行卷积得到的回归量：\n    $$r_{d}[n] = \\Delta t \\sum_{k=0}^{N-1} s[k] \\left(\\frac{d}{dt} h_{0}\\right)[n-k],$$\n    其中导数通过有限差分在采样后的 $h_{0}(t)$ 上进行数值计算。计算 $\\hat{\\beta}_{2}$ 并将 $\\hat{A}_{2}$ 定义为 $\\hat{\\beta}_{2}$ 的第一个分量，其偏差为 $b_{2} = \\hat{A}_{2} - A_{\\text{true}}$。\n\n8.  将由导数基带来的改善量化为绝对偏差的减少量：\n    $$R = |b_{1}| - |b_{2}|.$$\n    正值 $R$ 表示幅度偏差减小。\n\n测试套件：\n\n针对以下延迟 $d$（以秒为单位）评估改善量 $R$：\n\n-   案例 1：$d = 0.0$（无延迟，边界情况）。\n-   案例 2：$d = 0.5$（小的正延迟）。\n-   案例 3：$d = 2.0$（中等正延迟）。\n-   案例 4：$d = 4.0$（大的正延迟）。\n-   案例 5：$d = -0.5$（小的负延迟）。\n\n要求输出：\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如 $[r_{1}, r_{2}, r_{3}, r_{4}, r_{5}]$），其中每个 $r_{i}$ 是对应测试案例计算出的改善量 $R$。所有数值均以十进制浮点数表示。整个过程中的时间单位为秒；幅度和偏差均为无量纲。",
            "solution": "该问题要求对功能性磁共振成像 (fMRI) 信号模型中，当真实血流动力学响应函数 (HRF) 与建模所用的 HRF 存在不匹配时，对幅度估计中的偏差进行定量分析，并评估使用时间导数基函数增强通用线性模型 (GLM) 以校正此偏差的有效性。整个过程基于线性时不变 (LTI) 系统理论和普通最小二乘 (OLS) 估计。\n\n首先，我们按规定建立数学和计算框架。\n\n**1. 时间离散化与刺激定义**\n模拟在总时长 $T = 120$ 秒内进行，采样间隔为 $\\Delta t = 0.5$ 秒。这定义了一个离散时间网格 $t_n = n \\Delta t$，其中 $n = 0, 1, \\ldots, N-1$，$N = T/\\Delta t = 240$。\n刺激 $s[n]$ 是一个表示神经事件的二元序列。它包含五个从时间点 $t_e \\in \\{10, 30, 50, 70, 90\\}$ 秒开始的1秒方波函数。对于每个从 $t_e$ 开始的事件，所有满足 $t_e \\le t_n  t_e + 1$ 的时间点上的离散刺激样本 $s[n]$ 都被设为1，否则为0。\n\n**2. 血流动力学响应函数 (HRF) 定义**\n典型 HRF，记为 $h_0(t)$，模拟了 BOLD 信号对短暂、脉冲式神经事件的响应。它被定义为两个伽马概率密度函数的差：\n$$h_{0}(t) = g(t; a_{1}, b_{1}) - c \\, g(t; a_{2}, b_{2})$$\n其中伽马密度函数 $g(t; a, b)$ 由下式给出：\n$$g(t; a, b) = \\frac{t^{a-1} e^{-t/b}}{b^{a} \\Gamma(a)}, \\quad t \\ge 0$$\n参数指定为 $a_{1} = 6$、$b_{1} = 1$、$a_{2} = 16$、$b_{2} = 1$ 和 $c = 1/6$。我们在时间分辨率 $\\Delta t$ 下，在 $t_{max} = 32$ 秒的有限支撑集上对 $h_0(t)$ 进行采样，以获得离散滤波器核 $h_0[n]$。\n\n数据所基于的真实 HRF 是典型 HRF 的时移版本，$h_d(t) = h_0(t-d)$，其中 $d$ 是以秒为单位的延迟。正值 $d$ 对应延迟响应，负值 $d$ 对应提前响应。在离散域中，这是通过将采样后的核 $h_0[n]$ 移动等于 $d/\\Delta t$ 的样本数量来实现的。对于 $k = d/\\Delta t$ 个样本的移位，如果 $k0$，我们在 $h_0[n]$ 前面加上 $k$ 个零并截断末尾；如果 $k0$，我们移除前 $|k|$ 个样本并在末尾追加 $|k|$ 个零。这样就产生了离散的延迟核 $h_d[n]$。\n\n**3. 通过卷积生成数据**\n在 LTI 系统假设下，无噪声 BOLD 信号 $y[n]$ 是刺激 $s[n]$ 与真实（延迟）HRF 核 $h_d[n]$ 的离散卷积，并按采样间隔 $\\Delta t$ 进行缩放：\n$$y[n] = \\Delta t \\sum_{k=0}^{N-1} s[k] h_{d}[n-k]$$\n此操作模拟了对刺激序列中每个分量响应的线性叠加。\n\n**4. GLM估计与偏差计算**\n通用线性模型 (GLM) 框架用于估计响应的幅度。模型为 $y = X \\beta + \\varepsilon$。我们考虑一个无噪声场景（$\\varepsilon=0$）以分离由模型不匹配引起的偏差。参数 $\\beta$ 的 OLS 估计值为 $\\hat{\\beta} = (X^{\\top} X)^{-1} X^{\\top} y$。\n\n**模型1：仅含典型HRF的GLM**\n第一个模型尝试仅使用典型 HRF 来解释数据 $y$。设计矩阵 $X_1$ 由两个回归量构成：\n1.  典型回归量 $r_c[n]$，通过将刺激 $s[n]$ 与典型 HRF $h_0[n]$ 进行卷积形成：$r_c[n] = \\Delta t \\sum_k s[k] h_0[n-k]$。\n2.  一个截距项，即一个全为1的列向量，用于模拟基线信号水平。\n因此，$X_1 = [r_c, \\mathbf{1}]$。我们求解系统 $y = X_1 \\beta_1$ 得到 $\\hat{\\beta}_1 = [\\hat{A}_1, \\text{intercept}]^{\\top}$。根据构造，响应的真实幅度为 $A_{\\text{true}} = 1$。第一个估计量的偏差是 $b_1 = \\hat{A}_1 - A_{\\text{true}}$。当 $d \\neq 0$ 时，$y$ 与 $r_c$ 不匹配，导致非零偏差 $b_1$。\n\n**模型2：导数增强的GLM**\n第二个模型基于延迟 HRF 的一阶泰勒级数近似：\n$$h_d(t) = h_0(t-d) \\approx h_0(t) - d \\cdot \\frac{d}{dt}h_0(t)$$\n与刺激 $s(t)$ 进行卷积表明，所得到的信号 $y(t)$ 可以由 $r_c(t) = s(t) * h_0(t)$ 和 $s(t) * \\frac{d}{dt}h_0(t)$ 的线性组合来近似。这启发我们在 GLM 中增加一个基于 HRF 时间导数的回归量。\n\n典型 HRF 的导数 $\\frac{d}{dt}h_0(t)$ 是通过在采样核 $h_0[n]$ 上使用有限差分法进行数值计算得到的。这个导数核与刺激进行卷积，创建导数回归量：$r_d[n] = \\Delta t \\sum_k s[k] (\\frac{d}{dt}h_0)[n-k]$。\n\n增强后的设计矩阵是 $X_2 = [r_c, r_d, \\mathbf{1}]$。我们求解 $y = X_2 \\beta_2$ 得到 $\\hat{\\beta}_2 = [\\hat{A}_2, \\hat{\\beta}_{d}, \\text{intercept}]^{\\top}$。幅度估计值 $\\hat{A}_2$ 是典型回归量的系数。其偏差为 $b_2 = \\hat{A}_2 - A_{\\text{true}}$。通过考虑时间上的移位，该模型预期能提供更准确的幅度估计，从而与 $|b_1|$ 相比，偏差 $|b_2|$ 更小。\n\n**5. 量化改善效果**\n包含时间导数基所带来的改善被量化为绝对偏差的减少量：\n$$R = |b_1| - |b_2|$$\n$R$ 的正值表示增强模型提供了偏差更小的响应幅度估计。我们为测试套件中每个指定的延迟 $d$ 计算 $R$。",
            "answer": "[0.0,0.0185918512390772,0.3168132909476008,0.4449544923199859,0.02102871131105096]"
        }
    ]
}