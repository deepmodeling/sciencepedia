{
    "hands_on_practices": [
        {
            "introduction": "血氧水平依赖（BOLD）信号的建模始于理解神经活动如何转化为血管反应。本练习  引导您分析一个将神经输入转换为潜在血管活性信号的一阶线性模型。通过求解这个基本的微分方程，您将掌握增益和时间常数等关键参数的物理意义，为理解更复杂的血液动力学模型（如 Balloon-Windkessel 模型）奠定基础。",
            "id": "3998853",
            "problem": "在为功能性磁共振成像（fMRI）测量的血氧水平依赖（BOLD）信号建模时，一个常见的抽象概念是，一个潜藏的血管活性信号 $s(t)$ 将神经输入 $u(t)$ 转换为血管反应。考虑以下用于血管活性信号的最小一阶线性时不变模型：\n$$\\dot{s}(t) \\equiv \\frac{d s(t)}{dt} = -\\frac{s(t)}{\\tau_s} + \\kappa\\, u(t),$$\n其中 $\\tau_s > 0$ 是一个时间常数，$\\kappa > 0$ 是一个增益。神经驱动是一个单位阶跃 $u(t) = H(t)$，其中 $H(t)$ 是 Heaviside 函数，当 $t0$ 时 $H(t)=0$，当 $t\\ge 0$ 时 $H(t)=1$。假设系统在刺激前处于静止状态，因此当 $t0$ 时 $s(t)=0$，并且在 $t=0$ 时没有冲激输入发生。\n\n仅从给定的微分方程、$H(t)$ 的定义以及常系数线性微分方程的第一性原理出发，推导一个对所有实数 $t$ 均有效的 $s(t)$ 的闭式表达式。将最终的 $s(t)$ 简洁地表示为一个可能包含 $H(t)$ 的单一表达式。\n\n然后，利用你推导出的解，根据 $t=0^{+}$ 时的初始变化率、趋于稳态的过程以及在持续输入下 $s(t)$ 将达到的稳态水平，简要解释 $\\tau_s$ 和 $\\kappa$ 的生理学意义。\n\n你的最终答案必须是 $s(t)$ 的单一解析表达式，且不得包含单位。不要对你的表达式进行四舍五入或近似。",
            "solution": "我们将首先通过提取已知条件来验证问题，然后评估其科学和数学上的完整性。\n\n### 步骤1：提取已知条件\n- **微分方程**: $\\dot{s}(t) \\equiv \\frac{d s(t)}{dt} = -\\frac{s(t)}{\\tau_s} + \\kappa\\, u(t)$\n- **常数**: $\\tau_s  0$ (时间常数), $\\kappa  0$ (增益)\n- **输入函数**: $u(t) = H(t)$，其中 $H(t)$ 是亥维赛阶跃函数：当 $t0$ 时 $H(t)=0$，当 $t\\ge 0$ 时 $H(t)=1$。\n- **初始条件**: 系统处于静止状态，当 $t0$ 时 $s(t)=0$。\n- **约束**: 在 $t=0$ 时没有冲激输入。\n\n### 步骤2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n\n- **科学依据**：所提出的模型是一个一阶线性时不变（LTI）系统。这是所有STEM领域（包括计算神经科学）中用来近似复杂系统动力学的标准和基础建模方法。它代表了更全面的fMRI BOLD响应生物物理模型（如Balloon-Windkessel模型）的一个简化但有效的分量。该模型在科学上是公认的。\n- **适定性**：该问题是一个具有常系数和明确定义的强迫函数的一阶线性常微分方程的初值问题。提供了初始条件 $s(t)=0$ for $t0$。非冲激输入约束意味着状态变量 $s(t)$ 在 $t=0$ 处是连续的，这足以确定唯一的积分常数。因此，该问题是适定的，并存在唯一的稳定解。\n- **客观性**：问题使用精确的数学语言和定义进行陈述。所有术语都是客观的，没有模棱两可或主观解释。\n- **完整性与一致性**：问题是自洽的。它提供了控制方程、输入函数、所有必要参数（$\\tau_s, \\kappa$）以及系统的初始状态。没有矛盾之处。\n- **现实性**：该模型是对复杂生物过程的简化，但它是其领域内一个合理且广泛使用的抽象。参数 $\\tau_s$ 和 $\\kappa$ 具有直接的生理学解释，问题要求对此进行探讨。\n- **其他缺陷**：该问题不是隐喻性的、琐碎的、同义反复的或无法验证的。这是一个求解线性常微分方程的标准练习。\n\n### 步骤3：结论与行动\n问题有效。我们将推导解答。\n\n### 解答推导\n问题要求解以下一阶线性常微分方程（ODE）：\n$$\n\\frac{ds(t)}{dt} = -\\frac{s(t)}{\\tau_s} + \\kappa\\, u(t)\n$$\n初始条件为当 $t0$ 时 $s(t)=0$，输入为 $u(t)=H(t)$。\n\n该 ODE 可重写为标准形式：\n$$\n\\frac{ds(t)}{dt} + \\frac{1}{\\tau_s} s(t) = \\kappa\\, H(t)\n$$\n\n我们将分两个时间域推导解：$t0$ 和 $t \\ge 0$。\n\n**情况1：$t  0$**\n当 $t  0$ 时，$H(t)=0$。ODE 变为一个齐次方程：\n$$\n\\frac{ds(t)}{dt} + \\frac{1}{\\tau_s} s(t) = 0\n$$\n其通解为 $s(t) = C e^{-t/\\tau_s}$，其中 $C$ 是某个常数。然而，问题明确指出当 $t0$ 时 $s(t)=0$。设 $C=0$ 满足此条件。\n\n**情况2：$t \\ge 0$**\n当 $t \\ge 0$ 时，$H(t)=1$。ODE 变为一个非齐次方程：\n$$\n\\frac{ds(t)}{dt} + \\frac{1}{\\tau_s} s(t) = \\kappa\n$$\n解 $s(t)$ 是齐次解 $s_h(t)$ 和一个特解 $s_p(t)$ 的和。\n\n如前所述，齐次解为 $s_h(t) = A e^{-t/\\tau_s}$，其中 $A$ 是一个积分常数。\n\n对于特解，由于强迫项 $\\kappa$ 是一个常数，我们可以假设一个常数特解 $s_p(t) = K$。将其代入 ODE 得：\n$$\n\\frac{d}{dt}(K) + \\frac{1}{\\tau_s} K = \\kappa\n$$\n$$\n0 + \\frac{K}{\\tau_s} = \\kappa \\implies K = \\kappa \\tau_s\n$$\n因此，特解是 $s_p(t) = \\kappa \\tau_s$。\n\n对于 $t \\ge 0$ 的通解是齐次解和特解的和：\n$$\ns(t) = s_h(t) + s_p(t) = A e^{-t/\\tau_s} + \\kappa \\tau_s\n$$\n\n为了求出常数 $A$，我们使用初始条件。问题指出没有冲激输入，这意味着状态变量 $s(t)$ 在 $t=0$ 处必须是连续的。因此，$s(t)$ 在 $t$ 从右侧趋近于 $0$（$t \\to 0^{+}$）时的值必须等于 $t$ 从左侧趋近于 $0$（$t \\to 0^{-}$）时的值。\n$$\ns(0) = \\lim_{t \\to 0^+} s(t) = \\lim_{t \\to 0^-} s(t)\n$$\n根据 $t0$ 时的初始条件，我们知道 $\\lim_{t \\to 0^-} s(t) = 0$。因此，$s(0) = 0$。\n\n将此条件应用于 $t \\ge 0$ 的通解：\n$$\ns(0) = A e^{-0/\\tau_s} + \\kappa \\tau_s = A \\cdot 1 + \\kappa \\tau_s = 0\n$$\n解出 $A$ 得 $A = -\\kappa \\tau_s$。\n\n将 $A$ 的这个值代回 $t \\ge 0$ 的解中：\n$$\ns(t) = -\\kappa \\tau_s e^{-t/\\tau_s} + \\kappa \\tau_s = \\kappa \\tau_s (1 - e^{-t/\\tau_s})\n$$\n\n为了用单一表达式表示对所有实数 $t$ 的解，我们使用亥维赛函数 $H(t)$ 合并 $t0$ 和 $t \\ge 0$ 的结果：\n- 当 $t0$ 时，$s(t)=0$。\n- 当 $t \\ge 0$ 时，$s(t) = \\kappa \\tau_s (1 - e^{-t/\\tau_s})$。\n\n这对应于将 $t \\ge 0$ 的解乘以 $H(t)$，其中当 $t0$ 时 $H(t)$ 为 $0$，当 $t \\ge 0$ 时 $H(t)$ 为 $1$。\n最终，$s(t)$ 的统一表达式是：\n$$\ns(t) = \\kappa \\tau_s (1 - e^{-t/\\tau_s}) H(t)\n$$\n\n### 参数解释\n问题要求对 $\\tau_s$ 和 $\\kappa$ 作出解释。\n\n1.  **$\\kappa$ (增益) 的解释**：\n    信号的初始变化率是其在 $t=0^{+}$ 时的导数。根据 ODE，在 $s(0)=0$ 和 $u(0^{+})=1$ 的条件下：\n    $$\n    \\dot{s}(0^{+}) = -\\frac{s(0)}{\\tau_s} + \\kappa u(0^{+}) = -\\frac{0}{\\tau_s} + \\kappa(1) = \\kappa\n    $$\n    因此，$\\kappa$ 代表了在神经输入发生阶跃增加后，血管活性信号的初始速度或增加率。它是一个增益参数，量化了神经活动驱动血管反应的效能。较大的 $\\kappa$ 意味着更剧烈的初始血管反应。\n\n2.  **$\\tau_s$ (时间常数) 和稳态水平的解释**：\n    当 $t \\to \\infty$ 时，指数项 $e^{-t/\\tau_s}$ 趋近于 $0$。信号的稳态值 $s_{\\infty}$ 为：\n    $$\n    s_{\\infty} = \\lim_{t \\to \\infty} s(t) = \\lim_{t \\to \\infty} \\left[ \\kappa \\tau_s (1 - e^{-t/\\tau_s}) \\right] = \\kappa \\tau_s (1 - 0) = \\kappa \\tau_s\n    $$\n    乘积 $\\kappa \\tau_s$ 是在持续刺激下血管活性信号的最大振幅或稳态水平。\n    参数 $\\tau_s$ 是此指数趋近稳态过程的时间常数。在时间 $t=\\tau_s$ 时，信号达到：\n    $$\n    s(\\tau_s) = \\kappa \\tau_s (1 - e^{-\\tau_s/\\tau_s}) = \\kappa \\tau_s (1 - e^{-1}) \\approx 0.632\\, s_{\\infty}\n    $$\n    因此，$\\tau_s$ 是血管活性信号达到其最终稳态值约 $63.2\\%$ 所需的时间。它表征了血管反应的迟滞性：较小的 $\\tau_s$ 意味着更快的响应，能更快达到其最大水平；而较大的 $\\tau_s$ 意味着更慢、更延迟的响应。",
            "answer": "$$\n\\boxed{\\kappa \\tau_s (1 - \\exp(-t/\\tau_s)) H(t)}\n$$"
        },
        {
            "introduction": "虽然我们用微分方程来描述内部动态，但功能性磁共振成像（fMRI）分析中更常用的是系统对短暂神经脉冲的响应——即血液动力学响应函数（HRF）。本练习  邀请您深入研究标准“双伽马”HRF模型的数学结构。通过运用微积分从第一性原理出发，您将计算出响应峰值延迟和刺激后 undershoot 等关键特征，并将这些数学属性与其背后复杂的生理过程联系起来。",
            "id": "3998829",
            "problem": "考虑功能性磁共振成像 (fMRI) 的血氧水平依赖 (BOLD) 血流动力学响应函数 (HRF)，其模型为两个类伽马分量之差：\n$$\nh(t) \\;=\\; A_{1}\\, t^{a_{1}-1}\\,\\exp\\!\\left(-\\frac{t}{b_{1}}\\right) \\;-\\; A_{2}\\, t^{a_{2}-1}\\,\\exp\\!\\left(-\\frac{t}{b_{2}}\\right),\n$$\n选择参数以捕捉一个主要的正波瓣，后跟一个延迟的负向过冲。假设在时间 $t=0$ 有一个短暂的神经元脉冲，并使用以下参数值：\n$$\nA_{1} = 1,\\quad a_{1} = 2,\\quad b_{1} = 4\\ \\text{s},\\qquad A_{2} = \\frac{1}{6},\\quad a_{2} = 3,\\quad b_{2} = 4\\ \\text{s}.\n$$\n使用这些参数，从第一性原理推导 $h(t)$ 的第一个局部最大值的时间 $t_{p}$（正波瓣的峰值延迟），以及过冲的持续时间 $D_{u}$，其定义为正波瓣后的第一个过零点与负向局部最小值之间的时间。您的推导必须从 $h(t)$ 的定义开始，并使用基于微积分的极值条件。将您的最终有序对 $\\big(t_{p},\\,D_{u}\\big)$ 以秒为单位表示。此外，请根据神经血管耦合和刺激后血管/代谢动力学，解释峰值延迟和过冲的生理学关联。不得假设任何极值快捷公式；必须从给定的 $h(t)$ 出发展示所有步骤。",
            "solution": "在尝试解答之前，首先对问题进行验证。\n\n### 步骤1：提取已知条件\n血流动力学响应函数 (HRF) 由下式给出：\n$$\nh(t) \\;=\\; A_{1}\\, t^{a_{1}-1}\\,\\exp\\!\\left(-\\frac{t}{b_{1}}\\right) \\;-\\; A_{2}\\, t^{a_{2}-1}\\,\\exp\\!\\left(-\\frac{t}{b_{2}}\\right)\n$$\n参数值为：\n$$\nA_{1} = 1,\\quad a_{1} = 2,\\quad b_{1} = 4\\ \\text{s},\\qquad A_{2} = \\frac{1}{6},\\quad a_{2} = 3,\\quad b_{2} = 4\\ \\text{s}.\n$$\n任务是：\n1.  推导 $h(t)$ 的第一个局部最大值的时间 $t_{p}$。\n2.  推导过冲的持续时间 $D_{u}$，其定义为正波瓣后的第一个过零点与负向局部最小值之间的时间。\n3.  将最终答案表示为有序对 $(t_{p}, D_{u})$。\n4.  解释峰值延迟和过冲的生理相关性。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据：** 将HRF建模为两个伽马函数之差是计算神经科学和fMRI数据分析中一个标准且被广泛接受的模型（例如，统计参数图 (SPM) 中的经典HRF）。所要求的生理学解释基于神经血管耦合的既定原理。该问题具有科学合理性。\n- **适定性：** 该问题提供了一个显式函数和所有必需的参数。它要求计算具体的、可计算的量（极值和根），这是一个标准的微积分问题。存在唯一解且可以被推导出来。\n- **客观性：** 问题以精确、正式的语言表述。没有主观或基于观点的部分。\n- **完整性和一致性：** 问题是自洽的。提供了所有必需的参数。没有矛盾之处。参数的选择会产生所述的正波瓣后跟一个过冲的形状。\n\n### 步骤3：结论与行动\n问题有效。我们将提供一个完整的、有理有据的解答。\n\n### 解答推导\n\n首先，我们将给定的参数值代入 $h(t)$ 的表达式中：\n$$\nh(t) = (1) t^{2-1} \\exp\\left(-\\frac{t}{4}\\right) - \\left(\\frac{1}{6}\\right) t^{3-1} \\exp\\left(-\\frac{t}{4}\\right)\n$$\n$$\nh(t) = t \\exp\\left(-\\frac{t}{4}\\right) - \\frac{1}{6} t^2 \\exp\\left(-\\frac{t}{4}\\right)\n$$\n我们可以提取公因式：\n$$\nh(t) = \\left(t - \\frac{1}{6} t^2 \\right) \\exp\\left(-\\frac{t}{4}\\right)\n$$\n此函数定义域为 $t \\ge 0$。\n\n**1. 确定峰值延迟 ($t_{p}$)**\n\n峰值延迟 $t_{p}$ 是 $h(t)$ 的第一个局部最大值出现的时间。这发生在一个临界点，在该点一阶导数 $h'(t)$ 为零，二阶导数 $h''(t)$ 为负。\n\n我们使用乘法法则 $(uv)' = u'v + uv'$ 计算 $h(t)$ 的一阶导数，其中 $u(t) = t - \\frac{1}{6} t^2$，$v(t) = \\exp\\left(-\\frac{t}{4}\\right)$。\n这两部分的导数是：\n$u'(t) = 1 - \\frac{2}{6}t = 1 - \\frac{1}{3}t$\n$v'(t) = -\\frac{1}{4} \\exp\\left(-\\frac{t}{4}\\right)$\n\n现在，我们组合出 $h'(t)$：\n$$\nh'(t) = \\left(1 - \\frac{1}{3}t\\right)\\exp\\left(-\\frac{t}{4}\\right) + \\left(t - \\frac{1}{6}t^2\\right)\\left(-\\frac{1}{4}\\exp\\left(-\\frac{t}{4}\\right)\\right)\n$$\n提取指数项：\n$$\nh'(t) = \\left[ \\left(1 - \\frac{1}{3}t\\right) - \\frac{1}{4}\\left(t - \\frac{1}{6}t^2\\right) \\right] \\exp\\left(-\\frac{t}{4}\\right)\n$$\n化简方括号内的表达式：\n$$\nh'(t) = \\left[ 1 - \\frac{1}{3}t - \\frac{1}{4}t + \\frac{1}{24}t^2 \\right] \\exp\\left(-\\frac{t}{4}\\right)\n$$\n$$\nh'(t) = \\left[ \\frac{1}{24}t^2 - \\left(\\frac{1}{3} + \\frac{1}{4}\\right)t + 1 \\right] \\exp\\left(-\\frac{t}{4}\\right)\n$$\n$$\nh'(t) = \\left[ \\frac{1}{24}t^2 - \\frac{7}{12}t + 1 \\right] \\exp\\left(-\\frac{t}{4}\\right)\n$$\n为求临界点，我们令 $h'(t) = 0$。由于对所有实数 $t$ 都有 $\\exp\\left(-\\frac{t}{4}\\right) > 0$，我们只需解以下二次方程：\n$$\n\\frac{1}{24}t^2 - \\frac{7}{12}t + 1 = 0\n$$\n整个方程乘以 $24$ 以消除分数，得到：\n$$\nt^2 - 14t + 24 = 0\n$$\n这个二次方程可以因式分解为：\n$$\n(t - 2)(t - 12) = 0\n$$\n临界点是 $t_1 = 2$ 和 $t_2 = 12$。\n\n为了对这些点进行分类，我们使用二阶导数检验。我们对 $h'(t)$ 求导。令 $f(t) = \\frac{1}{24}t^2 - \\frac{7}{12}t + 1$。那么 $h'(t) = f(t)\\exp(-t/4)$ 且 $f'(t) = \\frac{1}{12}t - \\frac{7}{12}$。\n$$\nh''(t) = f'(t)\\exp\\left(-\\frac{t}{4}\\right) + f(t)\\left(-\\frac{1}{4}\\exp\\left(-\\frac{t}{4}\\right)\\right) = \\left[f'(t) - \\frac{1}{4}f(t)\\right]\\exp\\left(-\\frac{t}{4}\\right)\n$$\n在临界点处，$f(t) = 0$，所以表达式简化为 $h''(t_{crit}) = f'(t_{crit})\\exp(-t_{crit}/4)$。\n对于 $t = 2$：\n$$\nh''(2) = \\left(\\frac{1}{12}(2) - \\frac{7}{12}\\right)\\exp\\left(-\\frac{2}{4}\\right) = \\left(\\frac{2-7}{12}\\right)\\exp\\left(-\\frac{1}{2}\\right) = -\\frac{5}{12}\\exp\\left(-\\frac{1}{2}\\right)\n$$\n因为 $h''(2)  0$，所以 $t = 2$ 是一个局部最大值。这对应于正波瓣的峰值。\n对于 $t = 12$：\n$$\nh''(12) = \\left(\\frac{1}{12}(12) - \\frac{7}{12}\\right)\\exp\\left(-\\frac{12}{4}\\right) = \\left(1 - \\frac{7}{12}\\right)\\exp(-3) = \\frac{5}{12}\\exp(-3)\n$$\n因为 $h''(12) > 0$，所以 $t = 12$ 是一个局部最小值。这对应于负向过冲的谷底。\n\n因此，第一个局部最大值的时间（峰值延迟）是 $t_p = 2$ 秒。\n\n**2. 确定过冲的持续时间 ($D_{u}$)**\n\n持续时间 $D_{u}$ 是过冲开始与其最小值点之间的时间差。过冲始于初始正波瓣之后 $h(t)$ 的第一个过零点。设此时间为 $t_0$。过冲的最小值发生在我们找到的局部最小值处，$t_m = 12$ 秒。因此，$D_u = t_m - t_0$。\n\n为求过零点，我们令 $h(t) = 0$：\n$$\n\\left(t - \\frac{1}{6} t^2 \\right) \\exp\\left(-\\frac{t}{4}\\right) = 0\n$$\n由于 $\\exp\\left(-\\frac{t}{4}\\right) \\neq 0$，我们解：\n$$\nt - \\frac{1}{6} t^2 = 0\n$$\n$$\nt\\left(1 - \\frac{1}{6} t\\right) = 0\n$$\n根为 $t = 0$ 和 $1 - \\frac{1}{6}t = 0$，解得 $t = 6$。\n根 $t = 0$ 是响应的开始。函数在 $0  t  6$ 时为正，在 $t > 6$ 时为负。因此，标志着过冲开始的过零点在 $t_0 = 6$ 秒。\n\n负向局部最小值在 $t_m = 12$ 秒。\n过冲的持续时间计算如下：\n$$\nD_u = t_m - t_0 = 12 - 6 = 6\\ \\text{s}.\n$$\n\n最终的有序对是 $(t_p, D_u) = (2, 6)$。\n\n**3. 生理相关性**\n\n**峰值延迟 ($t_p$)**：BOLD信号的峰值延迟 $t_p$ 代表了神经血管耦合过程的累积延迟。在短暂的神经活动爆发后，一个复杂的生理级联反应被启动。这包括神经元和星形胶质细胞释放血管活性信号分子，这些分子作用于附近小动脉的平滑肌细胞，使其舒张。这种血管舒张导致局部脑血流量 (CBF) 显著增加。流入的富含氧合血红蛋白 (oxy-Hb) 的动脉血到达速度快于神经元消耗氧气的速度，导致顺磁性的脱氧血红蛋白 (dHb) 的局部浓度净减少。由于dHb会抑制磁共振信号，其减少导致BOLD信号增强。时间 $t_p$ 包含了从突触活动到血管响应再到血氧变化的整个事件链的总延迟。它是建模fMRI数据的关键参数，因为它反映了血流动力学系统的时间迟滞性。\n\n**刺激后过冲（与 $D_u$ 相关）**：过冲是指在主要的正向响应之后，BOLD信号下降到其刺激前基线水平以下的现象。其初始阶段的持续时间 $D_u$ 反映了潜在恢复动力学的时间尺度。有两种主要假说解释过冲现象：\n1.  **血管（气球模型）：** 该模型假设脑血流量 (CBF) 和脑血容量 (CBV) 回到基线的速率不匹配。刺激停止后，CBF可能相对较快地恢复到基线，但因初始血流涌入而被动扩张的静脉血管，其恢复到静息容积的速度则更慢（即“静脉气球”的缓慢放气）。在此阶段，升高的静脉CBV与正常化的CBF和持续的基础耗氧量相结合，导致脱氧血红蛋白 (dHb) 浓度积累到高于基线水平，从而引起BOLD信号下降。该持续时间反映了这种缓慢的血管顺应性恢复的时间过程。\n2.  **代谢：** 另一种或补充性的解释是，脑氧代谢率 (CMRO2) 的持续增加，其持续时间超过了CBF响应。如果神经组织在血流正常化后仍以较高速率消耗氧气，氧摄取分数将增加，导致dHb浓度升高，从而产生负的BOLD信号。这可能是由于恢复离子梯度的代谢成本，或兴奋后短暂的神经元抑制期。\n\n在任何一种情况下，过冲及其持续时间都是当神经组织返回其静息状态时，血流量、血容量和氧代谢之间复杂相互作用和不同时间常数的标志。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2  6\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "理论模型在fMRI数据分析中的应用核心是通用线性模型（GLM）。然而，一个关键的挑战是，大脑不同区域的真实血液动力学响应函数（HRF）可能与我们模型中使用的“标准”HRF存在差异。本编程练习  旨在通过模拟来量化这种模型错配所导致的偏差，并展示如何通过在GLM中加入时间导数基函数来有效校正这种偏差，这是一种基于泰勒级数展开的优雅解决方案。这个实践将理论知识与fMRI数据分析的实际挑战联系起来，揭示了高级信号处理技术在提高神经影像学推斷准确性方面的重要性。",
            "id": "3998785",
            "problem": "请将功能性磁共振成像 (fMRI) 的血氧水平依赖 (BOLD) 信号的卷积模型看作一个线性时不变系统：观测到的信号是刺激时间序列与血流动力学响应函数 (HRF) 卷积的结果。设刺激是一个以固定时间分辨率采样的离散时间序列。BOLD 信号遵循卷积的线性叠加和时移特性。通用线性模型 (GLM) 为线性回归参数提供了一个普通最小二乘估计量。\n\n您的任务是量化当将不匹配的典型HRF拟合到由延迟的HRF生成的数据时引入的偏差，并测量在用时间导数基增强GLM时的改进效果。请使用基于卷积模型和线性回归的原理推导来定义和计算幅度偏差及其减少量。\n\n请使用以下基础：\n\n- 观测到的BOLD信号被建模为卷积：对于刺激序列 $s[n]$ 和HRF $h[n]$，无噪声响应为 $y[n] = \\sum_{k=0}^{\\infty} s[k] h[n-k] \\Delta t$，其中 $\\Delta t$ 是以秒为单位的采样间隔。\n- GLM假设 $y = X \\beta + \\varepsilon$ 并使用普通最小二乘法来估计 $\\hat{\\beta} = (X^{\\top} X)^{-1} X^{\\top} y$，其中 $X$ 是设计矩阵，$\\varepsilon$ 是残差（此处设 $\\varepsilon = 0$ 以分离模型不匹配偏差）。\n- 典型血流动力学响应函数 (HRF) $h_{0}(t)$ 定义为伽马密度函数的差，这在神经影像学中被广泛使用。在离散时间内，在一个有限的支撑集上以间隔 $\\Delta t$ 对其进行采样。\n\n请精确实现以下内容：\n\n1.  设采样间隔为 $\\Delta t = 0.5$ 秒。设总模拟时长为 $T = 120$ 秒。构建离散时间网格 $t = 0, \\Delta t, 2\\Delta t, \\ldots, T - \\Delta t$。\n\n2.  对 $t \\ge 0$ 定义典型HRF $h_{0}(t)$ 为\n    $$h_{0}(t) = g(t; a_{1}, b_{1}) - c \\, g(t; a_{2}, b_{2}),$$\n    其中 $g(t; a, b)$ 是伽马密度函数\n    $$g(t; a, b) = \\frac{t^{a-1} e^{-t/b}}{b^{a} \\Gamma(a)}, \\quad t \\ge 0,$$\n    并使用参数 $a_{1} = 6$, $b_{1} = 1$, $a_{2} = 16$, $b_{2} = 1$ 和 $c = 1/6$。在 $t = 0, \\Delta t, \\ldots, t_{\\max}$ 上采样 $h_{0}(t)$，其中 $t_{\\max} = 32$ 秒，并对 $t  0$ 设 $h_{0}(t) = 0$。\n\n3.  构建一个刺激序列 $s[n]$，包含五个1秒的箱式事件，分别在时间点 $10$ 秒、$30$ 秒、$50$ 秒、$70$ 秒和 $90$ 秒。也就是说，如果一个事件在时间 $t_{e}$ 开始，则对于索引 $n$ 满足 $t[n] \\in [t_e, t_e + 1)$ 的情况，设 $s[n] = 1$，否则 $s[n] = 0$。\n\n4.  定义延迟的HRF为 $h_{d}(t) = h_{0}(t - d)$，其中对于 $t - d  0$ 有 $h_{d}(t) = 0$，$d$ 是一个以秒为单位的恒定延迟，可以是正值（晚响应）或负值（早响应）。通过 $d/\\Delta t$ 的整数样本移位来实现采样后HRF的离散时间平移。\n\n5.  通过离散卷积生成无噪声的观测数据 $y[n]$：\n    $$y[n] = \\Delta t \\sum_{k=0}^{N-1} s[k] h_{d}[n-k],$$\n    截断至刺激的长度 $N$。\n\n6.  构建仅含典型HRF的GLM设计矩阵 $X_{1} = [r_{c}, \\mathbf{1}]$，其中 $\\mathbf{1}$ 是全为1的列向量，\n    $$r_{c}[n] = \\Delta t \\sum_{k=0}^{N-1} s[k] h_{0}[n-k],$$\n    是典型回归量。计算普通最小二乘估计 $\\hat{\\beta}_{1}$，并将幅度估计 $\\hat{A}_{1}$ 定义为典型回归量的系数，即 $\\hat{\\beta}_{1}$ 的第一个分量。设真实幅度为 $A_{\\text{true}} = 1$。将偏差定义为 $b_{1} = \\hat{A}_{1} - A_{\\text{true}}$。\n\n7.  构建导数增强的GLM设计矩阵 $X_{2} = [r_{c}, r_{d}, \\mathbf{1}]$，其中 $r_{d}[n]$ 是通过将刺激与典型HRF的时间导数卷积得到的回归量：\n    $$r_{d}[n] = \\Delta t \\sum_{k=0}^{N-1} s[k] \\left(\\frac{d}{dt} h_{0}\\right)[n-k],$$\n    其中导数通过有限差分在采样后的 $h_{0}(t)$ 上进行数值计算。计算 $\\hat{\\beta}_{2}$ 并将 $\\hat{A}_{2}$ 定义为 $\\hat{\\beta}_{2}$ 的第一个分量，其偏差为 $b_{2} = \\hat{A}_{2} - A_{\\text{true}}$。\n\n8.  将由导数基带来的改进量化为绝对偏差的减少量：\n    $$R = |b_{1}| - |b_{2}|.$$\n    正的 $R$ 值表示幅度偏差减小。\n\n测试套件：\n\n对以下延迟 $d$（以秒为单位）评估改进量 $R$：\n\n-   案例1：$d = 0.0$（无延迟，边界情况）。\n-   案例2：$d = 0.5$（小的正延迟）。\n-   案例3：$d = 2.0$（中等正延迟）。\n-   案例4：$d = 4.0$（大的正延迟）。\n-   案例5：$d = -0.5$（小的负延迟）。\n\n要求输出：\n\n您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果（例如，$[r_{1}, r_{2}, r_{3}, r_{4}, r_{5}]$），其中每个 $r_{i}$ 是对应测试案例计算出的改进量 $R$。所有数字均表示为十进制浮点数。整个问题中时间单位为秒；幅度无量纲，偏差也无量纲。",
            "solution": "该问题要求对功能性磁共振成像 (fMRI) 信号模型中，当真实与建模的血流动力学响应函数 (HRF) 存在不匹配时，对幅度估计偏差进行定量分析，并评估在通用线性模型 (GLM) 中增加时间导数基函数以校正此偏差的有效性。整个过程基于线性时不变 (LTI) 系统理论和普通最小二乘 (OLS) 估计。\n\n首先，我们建立指定的数学和计算框架。\n\n**1. 时间离散化与刺激定义**\n模拟在总时长 $T = 120$ 秒内进行，采样间隔为 $\\Delta t = 0.5$ 秒。这定义了一个离散时间网格 $t_n = n \\Delta t$，其中 $n = 0, 1, \\ldots, N-1$，$N = T/\\Delta t = 240$。\n刺激 $s[n]$ 是一个代表神经事件的二进制序列。它由五个1秒的箱式函数组成，分别在时间 $t_e \\in \\{10, 30, 50, 70, 90\\}$ 秒开始。对于每个从 $t_e$ 开始的事件，所有满足 $t_e \\le t_n  t_e + 1$ 的时间点 $t_n$ 对应的离散刺激样本 $s[n]$ 都设为1，否则为0。\n\n**2. 血流动力学响应函数 (HRF) 定义**\n典型HRF，记为 $h_0(t)$，模拟了BOLD信号对一个短暂的、脉冲状神经事件的响应。它被定义为两个伽马概率密度函数的差：\n$$h_{0}(t) = g(t; a_{1}, b_{1}) - c \\, g(t; a_{2}, b_{2})$$\n其中伽马密度函数 $g(t; a, b)$ 由下式给出：\n$$g(t; a, b) = \\frac{t^{a-1} e^{-t/b}}{b^{a} \\Gamma(a)}, \\quad t \\ge 0$$\n参数指定为 $a_{1} = 6$, $b_{1} = 1$, $a_{2} = 16$, $b_{2} = 1$ 和 $c = 1/6$。我们在 $t_{max} = 32$ 秒的有限支撑集上以时间分辨率 $\\Delta t$ 对 $h_0(t)$ 进行采样，以获得离散滤波器核 $h_0[n]$。\n\n数据所基于的真实HRF是典型HRF的时移版本，$h_d(t) = h_0(t-d)$，其中 $d$ 是以秒为单位的延迟。正的 $d$ 对应于延迟的响应，负的 $d$ 对应于提前的响应。在离散域中，这是通过将采样后的核 $h_0[n]$ 平移 $d/\\Delta t$ 个样本来实现的。对于 $k = d/\\Delta t$ 个样本的平移，如果 $k>0$，我们在 $h_0[n]$ 前面加上 $k$ 个零并截断末尾；如果 $k0$，我们移除前 $|k|$ 个样本并在末尾追加 $|k|$ 个零。这样就产生了离散的延迟核 $h_d[n]$。\n\n**3. 通过卷积生成数据**\n在LTI系统假设下，无噪声的BOLD信号 $y[n]$ 是刺激 $s[n]$ 与真实（延迟的）HRF核 $h_d[n]$ 的离散卷积，并按采样间隔 $\\Delta t$ 进行缩放：\n$$y[n] = \\Delta t \\sum_{k=0}^{N-1} s[k] h_{d}[n-k]$$\n此操作模拟了对刺激序列中每个分量响应的线性叠加。\n\n**4. GLM估计与偏差计算**\n通用线性模型 (GLM) 框架用于估计响应的幅度。该模型为 $y = X \\beta + \\varepsilon$。我们考虑一个无噪声场景 ($\\varepsilon=0$)，以分离由模型不匹配引起的偏差。参数 $\\beta$ 的OLS估计为 $\\hat{\\beta} = (X^{\\top} X)^{-1} X^{\\top} y$。\n\n**模型1：仅含典型HRF的GLM**\n第一个模型试图仅使用典型HRF来解释数据 $y$。设计矩阵 $X_1$ 由两个回归量构成：\n1.  典型回归量 $r_c[n]$，通过将刺激 $s[n]$ 与典型HRF $h_0[n]$ 卷积形成：$r_c[n] = \\Delta t \\sum_k s[k] h_0[n-k]$。\n2.  一个截距项，即一列1，用于模拟基线信号水平。\n因此，$X_1 = [r_c, \\mathbf{1}]$。我们求解系统 $y = X_1 \\beta_1$ 得到 $\\hat{\\beta}_1 = [\\hat{A}_1, \\text{intercept}]^{\\top}$。通过构造，响应的真实幅度为 $A_{\\text{true}} = 1$。这第一个估计量的偏差是 $b_1 = \\hat{A}_1 - A_{\\text{true}}$。当 $d \\neq 0$ 时，$y$ 与 $r_c$ 不匹配，导致非零偏差 $b_1$。\n\n**模型2：导数增强的GLM**\n第二个模型基于延迟HRF的一阶泰勒级数近似：\n$$h_d(t) = h_0(t-d) \\approx h_0(t) - d \\cdot \\frac{d}{dt}h_0(t)$$\n与刺激 $s(t)$ 进行卷积表明，得到的信号 $y(t)$ 可以近似为 $r_c(t) = s(t) * h_0(t)$ 和 $s(t) * \\frac{d}{dt}h_0(t)$ 的线性组合。这启发我们在GLM中增加一个基于HRF时间导数的回归量。\n\n典型HRF的导数 $\\frac{d}{dt}h_0(t)$ 是通过在采样后的核 $h_0[n]$ 上使用有限差分法进行数值计算的。这个导数核与刺激进行卷积，创建导数回归量：$r_d[n] = \\Delta t \\sum_k s[k] (\\frac{d}{dt}h_0)[n-k]$。\n\n增强后的设计矩阵是 $X_2 = [r_c, r_d, \\mathbf{1}]$。我们求解 $y = X_2 \\beta_2$ 得到 $\\hat{\\beta}_2 = [\\hat{A}_2, \\hat{\\beta}_{d}, \\text{intercept}]^{\\top}$。幅度估计 $\\hat{A}_2$ 是典型回归量的系数。其偏差为 $b_2 = \\hat{A}_2 - A_{\\text{true}}$。通过考虑时间上的移位，该模型预期能提供更准确的幅度估计，从而导致比 $|b_1|$ 更小的偏差 $|b_2|$。\n\n**5. 量化改进效果**\n包含时间导数基所带来的改进效果被量化为绝对偏差的减少量：\n$$R = |b_1| - |b_2|$$\n$R$ 的正值表示增强模型提供了对响应幅度偏差更小的估计。我们为测试套件中每个指定的延迟 $d$ 计算 $R$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import gamma\n\ndef solve():\n    \"\"\"\n    Computes the reduction in amplitude estimation bias for an fMRI GLM\n    by augmenting the model with a temporal derivative basis function.\n    \"\"\"\n\n    def g_pdf(t, a, b):\n        \"\"\"Gamma probability density function.\"\"\"\n        # Handle t=0 case where t**(a-1) is 0 for a > 1\n        t_safe = np.maximum(t, 1e-12)\n        val = (t_safe**(a - 1) * np.exp(-t_safe / b)) / (b**a * gamma(a))\n        val[t == 0] = 0.0\n        return val\n\n    def calculate_improvement(d):\n        \"\"\"\n        Calculates the bias improvement R for a given delay d.\n        \"\"\"\n        # 1. Setup time grid and constants\n        dt = 0.5  # Sampling interval in seconds\n        T = 120.0  # Total duration in seconds\n        t_max_hrf = 32.0  # HRF support duration\n        time_vec = np.arange(0, T, dt)\n        N = len(time_vec)\n        A_true = 1.0\n\n        # 2. Define canonical HRF h0(t)\n        hrf_time_vec = np.arange(0, t_max_hrf + dt, dt)\n        a1, b1 = 6.0, 1.0\n        a2, b2 = 16.0, 1.0\n        c = 1.0 / 6.0\n        h0_sampled = g_pdf(hrf_time_vec, a1, b1) - c * g_pdf(hrf_time_vec, a2, b2)\n\n        # 3. Construct stimulus train s[n]\n        s = np.zeros(N)\n        event_times = [10.0, 30.0, 50.0, 70.0, 90.0]\n        event_duration = 1.0\n        for t_e in event_times:\n            event_indices = (time_vec >= t_e)  (time_vec  t_e + event_duration)\n            s[event_indices] = 1.0\n\n        # 4. Define the delayed HRF h_d(t)\n        shift_samples = int(round(d / dt))\n        h_d_sampled = np.zeros_like(h0_sampled)\n        if shift_samples == 0:\n            h_d_sampled = h0_sampled.copy()\n        elif shift_samples > 0:\n            h_d_sampled[shift_samples:] = h0_sampled[:-shift_samples]\n        else: # shift_samples  0\n            h_d_sampled[:shift_samples] = h0_sampled[-shift_samples:]\n\n        # 5. Generate noise-free observed data y[n]\n        y = dt * np.convolve(s, h_d_sampled, mode='full')[:N]\n\n        # 6. Canonical-only GLM (GLM 1)\n        r_c = dt * np.convolve(s, h0_sampled, mode='full')[:N]\n        intercept = np.ones(N)\n        X1 = np.vstack([r_c, intercept]).T\n        \n        beta1, _, _, _ = np.linalg.lstsq(X1, y, rcond=None)\n        A1_hat = beta1[0]\n        b1 = A1_hat - A_true\n\n        # 7. Derivative-augmented GLM (GLM 2)\n        h0_deriv = np.gradient(h0_sampled, dt)\n        r_d = dt * np.convolve(s, h0_deriv, mode='full')[:N]\n        X2 = np.vstack([r_c, r_d, intercept]).T\n        \n        beta2, _, _, _ = np.linalg.lstsq(X2, y, rcond=None)\n        A2_hat = beta2[0]\n        b2 = A2_hat - A_true\n\n        # 8. Quantify improvement R\n        R = abs(b1) - abs(b2)\n        return R\n\n    # Test Suite: Delays d in seconds\n    test_cases = [\n        0.0,   # Case 1: no delay\n        0.5,   # Case 2: small positive delay\n        2.0,   # Case 3: moderate positive delay\n        4.0,   # Case 4: large positive delay\n        -0.5   # Case 5: small negative delay\n    ]\n\n    results = []\n    for d_val in test_cases:\n        improvement = calculate_improvement(d_val)\n        results.append(improvement)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}