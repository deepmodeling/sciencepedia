{
    "hands_on_practices": [
        {
            "introduction": "在实验神经科学中，一个普遍的挑战是如何从强噪声背景中提取微弱的神经信号。本练习直面这一挑战，为你提供了一个计算和推导的机会，以量化脑电（EEG）记录中的信噪比（SNR）。更重要的是，你将亲自推导出信号平均法改善信噪比的基本原理，即信噪比与试验次数的平方根成正比，这是处理诱发反应数据的基石技术 。",
            "id": "3997826",
            "problem": "在一个测量体感诱发响应的脑电图 (EEG) 实验中，每次试验记录的信号被建模为一个确定性的、时间锁定的诱发波形与加性噪声之和。该诱发波形的峰值振幅为 $A_{\\text{peak}} = 5.00\\ \\mu\\mathrm{V}$。加性噪声 $n(t)$ 是零均值、平稳且服从高斯分布的。仪器采用了一个理想的单位增益带通滤波器，其通带为 $f \\in [1, 40]\\ \\mathrm{Hz}$。噪声的单边功率谱密度在通带内是恒定的，为 $S_0 = 0.50\\ \\mu\\mathrm{V}^{2}/\\mathrm{Hz}$，而在通带外可以忽略不计。\n\n仅使用第一性原理和适用于宏观脑信号（脑电图 (EEG)、脑磁图 (MEG)、局部场电位 (LFP)）建模的定义，按以下步骤进行：\n- 将信噪比 (SNR) 的操作性定义取为诱发波形的峰值振幅与带通滤波器输出端噪声的标准差之比。\n- 假设噪声实现在各次试验间是独立同分布的，并且诱发波形在各次试验间是完美时间锁定且形状相同的。\n- 从这些假设出发，并基于上述定义，推导平均 $N$ 次试验如何影响信噪比。\n- 确定最小的整数 $N$，使得试验平均后的诱发响应的信噪比至少为 $8.00$（无量纲）。将最终答案报告为这个整数。不需要对非整数进行四舍五入；提供满足条件的最小整数 $N$。",
            "solution": "首先验证问题，以确保其具有科学依据、自洽且适定。\n\n### 步骤1：提取已知条件\n- **信号模型：** 第 $i$ 次试验中记录的信号 $s_i(t)$ 是一个确定性诱发波形 $w(t)$ 和加性噪声 $n_i(t)$ 的和，即 $s_i(t) = w(t) + n_i(t)$。\n- **诱发波形：** 峰值振幅为 $A_{\\text{peak}} = 5.00\\ \\mu\\mathrm{V}$。假设波形 $w(t)$ 在所有试验中都是相同且完美时间锁定的。\n- **噪声特性：** 噪声 $n(t)$ 是零均值、平稳且服从高斯分布的。噪声实现 $n_i(t)$ 在各次试验间是独立同分布 (i.i.d.) 的。\n- **滤波：** 一个理想的单位增益带通滤波器，其通带为 $f \\in [1, 40]\\ \\mathrm{Hz}$。令 $f_{\\text{low}} = 1\\ \\mathrm{Hz}$ 且 $f_{\\text{high}} = 40\\ \\mathrm{Hz}$。\n- **噪声功率谱密度 (PSD)：** 单边功率谱密度 $S_0$ 在通带内是恒定的，为 $S_0 = 0.50\\ \\mu\\mathrm{V}^{2}/\\mathrm{Hz}$，在通带外可忽略。\n- **信噪比 (SNR) 定义：** 信噪比 (SNR) 定义为诱发波形的峰值振幅与噪声的标准差之比。\n- **目标：** 首先，推导平均 $N$ 次试验如何影响信噪比。其次，确定使试验平均后响应的信噪比至少为 $8.00$ 的最小整数 $N$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学合理性，因为它基于诱发电位分析（EEG、MEG、LFP）中使用的标准信号平均范式。信号模型、噪声假设以及功率谱密度的使用是信号处理和计算神经科学中的基本概念。给定的参数（$A_{\\text{peak}}$、$S_0$、频带）对于脑电图测量是物理上现实的。信噪比的操作性定义清晰明确。该问题是适定的、完整的，并且不包含任何矛盾。因此，该问题被认为是有效的。\n\n### 步骤3：推导与求解\n\n求解过程首先计算单次试验 ($N=1$) 的噪声特性和由此产生的信噪比。然后，分析平均 $N$ 次试验对信号和噪声分量的影响，以推导试验次数与信噪比之间的关系。最后，利用此关系求出所需的试验次数 $N$。\n\n**1. 单次试验的噪声标准差**\n\n对于一个零均值平稳随机过程，其方差 $\\sigma_n^2$ 等于其总功率。总功率通过对所有频率上的功率谱密度 (PSD) 进行积分得到。给定单边功率谱密度 $S_f(f)$ 和一个理想的带通滤波器，滤波后噪声的方差为：\n$$\n\\sigma_n^2 = \\int_{0}^{\\infty} S_f(f) \\, df\n$$\n在本问题中，滤波器是一个理想的带通滤波器，其通带为 $[f_{\\text{low}}, f_{\\text{high}}]$，噪声功率谱密度在此带内为 $S_0$，带外为零。因此，积分变为：\n$$\n\\sigma_n^2 = \\int_{f_{\\text{low}}}^{f_{\\text{high}}} S_0 \\, df\n$$\n由于 $S_0$ 是常数，我们可以计算该积分：\n$$\n\\sigma_n^2 = S_0 (f_{\\text{high}} - f_{\\text{low}})\n$$\n代入给定值：\n- $S_0 = 0.50\\ \\mu\\mathrm{V}^{2}/\\mathrm{Hz}$\n- $f_{\\text{low}} = 1\\ \\mathrm{Hz}$\n- $f_{\\text{high}} = 40\\ \\mathrm{Hz}$\n$$\n\\sigma_n^2 = (0.50\\ \\mu\\mathrm{V}^{2}/\\mathrm{Hz}) \\times (40\\ \\mathrm{Hz} - 1\\ \\mathrm{Hz}) = 0.50 \\times 39\\ \\mu\\mathrm{V}^{2} = 19.5\\ \\mu\\mathrm{V}^{2}\n$$\n噪声的标准差 $\\sigma_n$ 是方差的平方根：\n$$\n\\sigma_n = \\sqrt{19.5}\\ \\mu\\mathrm{V}\n$$\n\n**2. 单次试验的信噪比 ($N=1$)**\n\n根据问题的操作性定义，单次试验的信噪比（表示为 $\\text{SNR}_1$）是信号峰值振幅与噪声标准差之比：\n$$\n\\text{SNR}_1 = \\frac{A_{\\text{peak}}}{\\sigma_n} = \\frac{5.00\\ \\mu\\mathrm{V}}{\\sqrt{19.5}\\ \\mu\\mathrm{V}} = \\frac{5.00}{\\sqrt{19.5}}\n$$\n\n**3. 平均 $N$ 次试验对信噪比的影响**\n\n令 $\\bar{s}_N(t)$ 为对 $N$ 次试验进行平均后的信号：\n$$\n\\bar{s}_N(t) = \\frac{1}{N} \\sum_{i=1}^{N} s_i(t) = \\frac{1}{N} \\sum_{i=1}^{N} (w(t) + n_i(t))\n$$\n根据求和的线性性，这可以分解为信号和噪声两个分量：\n$$\n\\bar{s}_N(t) = \\left(\\frac{1}{N} \\sum_{i=1}^{N} w(t)\\right) + \\left(\\frac{1}{N} \\sum_{i=1}^{N} n_i(t)\\right)\n$$\n平均后的信号由平均后的诱发波形 $\\bar{w}_N(t)$ 和平均后的噪声 $\\bar{n}_N(t)$ 组成。\n\n- **平均后的诱发波形：** 由于诱发波形 $w(t)$ 是确定性的，并且在所有试验中都相同，因此其平均值为：\n  $$\n  \\bar{w}_N(t) = \\frac{1}{N} \\sum_{i=1}^{N} w(t) = \\frac{1}{N} (N \\cdot w(t)) = w(t)\n  $$\n  平均后的诱发波形的峰值振幅保持为 $A_{\\text{peak}}$。\n\n- **平均后的噪声：** 平均后的噪声为 $\\bar{n}_N(t) = \\frac{1}{N} \\sum_{i=1}^{N} n_i(t)$。我们需要求其标准差 $\\sigma_{\\bar{n}_N}$。我们首先求其方差 $\\sigma_{\\bar{n}_N}^2 = \\text{Var}(\\bar{n}_N(t))$。\n  $$\n  \\sigma_{\\bar{n}_N}^2 = \\text{Var}\\left(\\frac{1}{N} \\sum_{i=1}^{N} n_i(t)\\right)\n  $$\n  使用性质 $\\text{Var}(c X) = c^2 \\text{Var}(X)$，我们得到：\n  $$\n  \\sigma_{\\bar{n}_N}^2 = \\frac{1}{N^2} \\text{Var}\\left(\\sum_{i=1}^{N} n_i(t)\\right)\n  $$\n  由于噪声实现 $n_i(t)$ 在各次试验间是独立的，和的方差等于方差的和：\n  $$\n  \\text{Var}\\left(\\sum_{i=1}^{N} n_i(t)\\right) = \\sum_{i=1}^{N} \\text{Var}(n_i(t))\n  $$\n  此外，由于噪声是同分布的，对于所有的 $i$，都有 $\\text{Var}(n_i(t)) = \\sigma_n^2$。\n  $$\n  \\sum_{i=1}^{N} \\text{Var}(n_i(t)) = \\sum_{i=1}^{N} \\sigma_n^2 = N \\sigma_n^2\n  $$\n  将其代回，我们得到平均后噪声的方差：\n  $$\n  \\sigma_{\\bar{n}_N}^2 = \\frac{1}{N^2} (N \\sigma_n^2) = \\frac{\\sigma_n^2}{N}\n  $$\n  因此，平均后噪声的标准差为：\n  $$\n  \\sigma_{\\bar{n}_N} = \\sqrt{\\frac{\\sigma_n^2}{N}} = \\frac{\\sigma_n}{\\sqrt{N}}\n  $$\n\n平均后信号的信噪比 $\\text{SNR}_N$ 是平均后波形的峰值振幅与平均后噪声的标准差之比：\n$$\n\\text{SNR}_N = \\frac{A_{\\text{peak}}}{\\sigma_{\\bar{n}_N}} = \\frac{A_{\\text{peak}}}{\\sigma_n / \\sqrt{N}} = \\left(\\frac{A_{\\text{peak}}}{\\sigma_n}\\right) \\sqrt{N}\n$$\n这证明了所推导的关系：\n$$\n\\text{SNR}_N = \\text{SNR}_1 \\sqrt{N}\n$$\n信噪比随试验次数的平方根而提高。\n\n**4. 计算所需的试验次数 $N$**\n\n问题要求找到最小的整数 $N$，使得 $\\text{SNR}_N \\ge 8.00$。\n$$\n\\text{SNR}_1 \\sqrt{N} \\ge 8.00\n$$\n代入 $\\text{SNR}_1$ 的表达式：\n$$\n\\left(\\frac{5.00}{\\sqrt{19.5}}\\right) \\sqrt{N} \\ge 8.00\n$$\n现在，我们求解 $N$：\n$$\n\\sqrt{N} \\ge 8.00 \\times \\frac{\\sqrt{19.5}}{5.00}\n$$\n两边平方：\n$$\nN \\ge \\left(8.00 \\times \\frac{\\sqrt{19.5}}{5.00}\\right)^2\n$$\n$$\nN \\ge \\left(\\frac{8.00}{5.00}\\right)^2 \\times 19.5\n$$\n$$\nN \\ge (1.6)^2 \\times 19.5\n$$\n$$\nN \\ge 2.56 \\times 19.5\n$$\n$$\nN \\ge 49.92\n$$\n问题要求满足此条件的最小整数 $N$。大于或等于 $49.92$ 的最小整数是 $50$。",
            "answer": "$$\n\\boxed{50}\n$$"
        },
        {
            "introduction": "脑电图（EEG）和脑磁图（MEG）研究的一个核心目标是解决“逆问题”：从头皮记录的信号中精确定位大脑活动的来源。然而，任何逆问题解决方案的准确性都受限于其内在的数学和物理约束。本练习将让你亲手实现并评估一种标准的源定位算法，并向你介绍一个关键的评估工具——分辨率矩阵（resolution matrix），它能够量化逆算子在多大程度上模糊或混淆了真实的神经源，从而让你深刻理解脑成像技术的分辨能力和局限性 。",
            "id": "3997760",
            "problem": "您正在对通过脑电图 (EEG)、脑磁图 (MEG) 或局部场电位 (LFP) 记录的宏观脑信号进行建模。在线性正向模型中，测量的传感器信号通过一个确定性的导联场矩阵与皮层源活动相关联。逆问题的目标是从传感器测量中估计皮层源。分辨率矩阵量化了给定的逆算子如何在不同皮层位置上模糊和混合真实源，从而表征了点扩散和泄露。\n\n从基本原理开始：\n- 线性正向模型为 $y = G x + n$，其中 $y \\in \\mathbb{R}^{m}$ 是传感器测量值，$x \\in \\mathbb{R}^{n}$ 是皮层源振幅，$G \\in \\mathbb{R}^{m \\times n}$ 是导联场（或增益）矩阵，$n$ 是加性噪声。\n- 逆估计 $\\hat{x}$ 是通过最小化一个平衡数据保真度和二次源惩罚项的凸目标函数得到的：$J(x) = \\|y - G x\\|_{2}^{2} + \\lambda \\|x\\|_{2}^{2}$，其中标量正则化参数 $\\lambda > 0$。\n- 将逆算子 $W$ 定义为由上述最小化产生的线性映射 $\\hat{x} = W y$。\n- 分辨率矩阵为 $R = W G$，它在逆向过程中将真实源映射到估计源，即当 $n = 0$ 时，有 $\\hat{x} = R x$。\n\n您的任务：\n1. 推导并实现通过最小化 $J(x)$ 所隐含的线性最小范数Tikhonov逆算子 $W$，并计算分辨率矩阵 $R = W G$。\n2. 对于 $R$ 的每一列 $j$，将其解释为在皮层位置 $j$ 处单位源的点扩散函数 (PSF)。定义并计算：\n   - 位置 $j$ 处的自增益，为 $R_{j j}$。\n   - 位置 $j$ 处的泄露分数，为 $\\displaystyle \\frac{\\sum_{i \\neq j} |R_{i j}|}{\\sum_{i} |R_{i j}|}$，约定当分母为 $0$ 时，该分数为 $0$。\n   - 一个峰值正确指示符，如果 $\\arg\\max_{i} |R_{i j}| = j$ 则等于 $1$，否则等于 $0$。\n3. 通过计算以下指标来聚合所有位置的度量：\n   - 平均自增益 $\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} R_{j j}$。\n   - 平均泄露分数 $\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} \\frac{\\sum_{i \\neq j} |R_{i j}|}{\\sum_{i} |R_{i j}|}$（使用相同的 $0$ 约定）。\n   - 峰值正确分数 $\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} \\mathbf{1}\\{\\arg\\max_{i} |R_{i j}| = j\\}$，其中 $\\mathbf{1}\\{\\cdot\\}$ 是指示函数。\n4. 所有量都是无量纲的。将最终的数值输出表示为保留六位小数的浮点数。\n\n测试套件：\n使用以下导联场矩阵 $G$（每个 $G$ 均为 $3 \\times 4$，因此 $m = 3$ 个传感器和 $n = 4$ 个源）和正则化参数 $\\lambda$：\n\n- 案例 A: \n  $$G_{1} = \\begin{bmatrix}\n  0.8  0.1  0.0  0.05 \\\\\n  0.0  0.9  0.1  0.0 \\\\\n  0.1  0.0  0.7  0.2\n  \\end{bmatrix}, \\quad \\lambda = 10^{-8}.$$\n- 案例 B: \n  $$G_{1} \\text{ 如上}, \\quad \\lambda = 0.5.$$\n- 案例 C:\n  $$G_{2} = \\begin{bmatrix}\n  0.6  0.58  0.0  0.1 \\\\\n  0.2  0.19  0.1  0.0 \\\\\n  0.1  0.09  0.7  0.2\n  \\end{bmatrix}, \\quad \\lambda = 10^{-3}.$$\n- 案例 D:\n  $$G_{2} \\text{ 如上}, \\quad \\lambda = 0.5.$$\n- 案例 E:\n  $$G_{3} = \\begin{bmatrix}\n  0.7  0.3  0.0  1.0 \\\\\n  0.2  0.1  0.1  0.3 \\\\\n  0.1  0.05  0.8  0.15\n  \\end{bmatrix}, \\quad \\lambda = 0.1.$$\n\n程序要求：\n- 实现推导过程以计算每个案例的 $W$ 和 $R = W G$。\n- 对于每个案例，计算三个聚合指标：平均自增益、平均泄露分数和峰值正确分数。将每个指标四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试案例的结果本身应该是一个包含三个四舍五入浮点数的列表。例如，格式必须如下所示：\n  $$\\texttt{[[m1,l1,p1],[m2,l2,p2],[m3,l3,p3],[m4,l4,p4],[m5,l5,p5]]}$$\n其中 $m_{k}$ 是案例 $k$ 的平均自增益，$l_{k}$ 是平均泄露分数，$p_{k}$ 是峰值正确分数。",
            "solution": "该问题要求推导和实现用于脑信号线性正向模型的Tikhonov正则化最小范数逆算子，计算相应的分辨率矩阵，并计算几个派生的分辨率度量。\n\n### 第1步：问题验证\n\n**1.1. 提取已知条件**\n\n- **正向模型**：传感器测量值 $y \\in \\mathbb{R}^{m}$、皮层源振幅 $x \\in \\mathbb{R}^{n}$、导联场矩阵 $G \\in \\mathbb{R}^{m \\times n}$ 和加性噪声 $n$ 之间的关系由线性方程 $y = G x + n$ 给出。\n- **目标函数**：源估计 $\\hat{x}$ 是通过最小化目标函数 $J(x) = \\|y - G x\\|_{2}^{2} + \\lambda \\|x\\|_{2}^{2}$ 找到的，其中 $\\lambda > 0$ 是一个标量正则化参数。\n- **逆算子**：逆算子 $W$ 是使得 $\\hat{x} = W y$ 的线性映射。\n- **分辨率矩阵**：分辨率矩阵 $R$ 定义为 $R = W G$。\n- **分辨率度量（针对 $R$ 的每一列 $j$）**：\n    - 自增益：$R_{j j}$。\n    - 泄露分数：$\\displaystyle \\frac{\\sum_{i \\neq j} |R_{i j}|}{\\sum_{i} |R_{i j}|}$。如果分母为 $0$，则此值为 $0$。\n    - 峰值正确指示符：如果 $\\arg\\max_{i} |R_{i j}| = j$，则为 $1$，否则为 $0$。\n- **聚合度量**：\n    - 平均自增益：$\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} R_{j j}$。\n    - 平均泄露分数：$\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} \\frac{\\sum_{i \\neq j} |R_{i j}|}{\\sum_{i} |R_{i j}|}$。\n    - 峰值正确分数：$\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} \\mathbf{1}\\{\\arg\\max_{i} |R_{i j}| = j\\}$，其中 $\\mathbf{1}\\{\\cdot\\}$ 是指示函数。\n- **测试案例**：提供了五个导联场矩阵 $G$（$m=3$，$n=4$）和正则化参数 $\\lambda$ 的组合。\n\n**1.2. 验证分析**\n\n- **科学依据**：该问题是电磁脑源成像的基石。线性正向模型、Tikhonov正则化（也称为最小范数估计或MNE）以及分辨率矩阵的分析是计算神经科学和生物医学信号处理中标准且成熟的概念。该问题在科学上是合理的。\n- **良态性**：目标函数 $J(x)$ 是两个平方范数之和。对于 $\\lambda > 0$，它是严格凸的，这保证了唯一最小值的存在。推导过程得出了逆算子的唯一解。因此，该问题是良态的。\n- **客观性**：所有术语都经过了精确的数学定义。问题陈述没有歧义或主观语言。\n- **完整性与一致性**：问题提供了计算所需度量的所有必要数据（$G$、$\\lambda$）和定义。没有矛盾之处。\n\n**1.3. 结论**\n\n该问题是有效的。它具有科学依据、良态、客观且自洽。\n\n### 第2步：推导与求解计划\n\n**2.1. 逆算子 $W$ 的推导**\n\n目标是找到使目标函数 $J(x)$ 最小化的源向量 $\\hat{x}$。\n$$J(x) = \\|y - G x\\|_{2}^{2} + \\lambda \\|x\\|_{2}^{2}$$\n我们可以使用转置重写欧几里得范数的平方：\n$$J(x) = (y - G x)^T (y - G x) + \\lambda x^T x$$\n展开第一项：\n$$J(x) = (y^T - x^T G^T) (y - G x) + \\lambda x^T x$$\n$$J(x) = y^T y - y^T G x - x^T G^T y + x^T G^T G x + \\lambda x^T x$$\n由于 $y^T G x$ 是一个标量，它等于其转置，即 $(y^T G x)^T = x^T G^T y$。我们可以合并中间两项：\n$$J(x) = y^T y - 2 x^T G^T y + x^T (G^T G) x + \\lambda x^T I_n x$$\n$$J(x) = y^T y - 2 x^T G^T y + x^T (G^T G + \\lambda I_n) x$$\n其中 $I_n$ 是 $n \\times n$ 的单位矩阵。\n\n为了找到这个凸函数的最小值，我们计算它关于 $x$ 的梯度并将其设为零。使用标准矩阵微积分法则（对于对称矩阵 $A$，有 $\\nabla_v(b^T v) = b$ 和 $\\nabla_v(v^T A v) = 2Av$），我们得到：\n$$\\nabla_x J(x) = -2 G^T y + 2 (G^T G + \\lambda I_n) x$$\n将梯度设为零向量：\n$$0 = -2 G^T y + 2 (G^T G + \\lambda I_n) \\hat{x}$$\n$$(G^T G + \\lambda I_n) \\hat{x} = G^T y$$\n矩阵 $G^T G$ 是半正定的。由于 $\\lambda > 0$，矩阵 $(G^T G + \\lambda I_n)$ 是正定的，因此是可逆的。我们可以解出最优源估计 $\\hat{x}$：\n$$\\hat{x} = (G^T G + \\lambda I_n)^{-1} G^T y$$\n根据定义，逆算子 $W$ 是从 $y$ 到 $\\hat{x}$ 的线性映射，即 $\\hat{x} = W y$。通过比较 $\\hat{x}$ 的两个表达式，我们可以确定 $W$：\n$$W = (G^T G + \\lambda I_n)^{-1} G^T$$\n\n**2.2. 分辨率矩阵 $R$ 的计算**\n\n分辨率矩阵 $R$ 在没有噪声（$n=0$）的情况下，将真实源 $x$ 映射到其估计值 $\\hat{x}$。它定义为 $R = W G$。代入推导出的 $W$ 表达式：\n$$R = \\left( (G^T G + \\lambda I_n)^{-1} G^T \\right) G$$\n$$R = (G^T G + \\lambda I_n)^{-1} (G^T G)$$\n这是一个 $n \\times n$ 的矩阵，描述了整个正向-逆向建模过程的模糊和串扰效应。理想的逆运算会得到 $R = I_n$，这意味着每个估计源都完美地恢复了相应的真实源，而没有来自其他源的泄露。\n\n**2.3. 度量计算算法**\n\n对于每个测试案例 $(G, \\lambda)$：\n1.  令 $n$ 为 $G$ 的列数（即源的数量，$n=4$）。\n2.  计算矩阵乘积 $G^T G$。\n3.  构造 $n \\times n$ 的单位矩阵 $I_n$。\n4.  计算矩阵 $M = G^T G + \\lambda I_n$。\n5.  计算逆矩阵 $M^{-1}$。\n6.  计算分辨率矩阵 $R = M^{-1} (G^T G)$。\n7.  计算聚合度量：\n    a.  **平均自增益**：计算 $R$ 对角线元素的平均值。$\\text{mean\\_sg} = \\frac{1}{n} \\text{trace}(R)$。\n    b.  **平均泄露分数**：对于从 $0$ 到 $n-1$ 的每一列 $j$：\n        i.   计算整列绝对值的和：$S_j = \\sum_{i=0}^{n-1} |R_{ij}|$。\n        ii.  如果 $S_j > 0$，则列 $j$ 的泄露分数为 $\\ell_j = \\frac{S_j - |R_{jj}|}{S_j}$。\n        iii. 如果 $S_j = 0$，则 $\\ell_j = 0$。\n        iv.  平均泄露分数为 $\\text{mean\\_lf} = \\frac{1}{n} \\sum_{j=0}^{n-1} \\ell_j$。\n    c.  **峰值正确分数**：对于从 $0$ 到 $n-1$ 的每一列 $j$：\n        i.   找到该列绝对值最大的行索引 $i_{\\max}$：$i_{\\max} = \\arg\\max_i |R_{ij}|$。\n        ii.  列 $j$ 的峰值正确指示符是 $p_j = 1$ 如果 $i_{\\max} = j$，否则 $p_j = 0$。\n        iii. 峰值正确分数为 $\\text{mean\\_pcf} = \\frac{1}{n} \\sum_{j=0}^{n-1} p_j$。\n8.  将三个聚合度量中的每一个都四舍五入到六位小数并存储。\n\n此过程将应用于所提供的五个测试案例中的每一个。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes resolution matrix metrics for several EEG/MEG inverse problem test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (np.array([\n            [0.8, 0.1, 0.0, 0.05],\n            [0.0, 0.9, 0.1, 0.0],\n            [0.1, 0.0, 0.7, 0.2]\n        ]), 1e-8),\n        (np.array([\n            [0.8, 0.1, 0.0, 0.05],\n            [0.0, 0.9, 0.1, 0.0],\n            [0.1, 0.0, 0.7, 0.2]\n        ]), 0.5),\n        (np.array([\n            [0.6, 0.58, 0.0, 0.1],\n            [0.2, 0.19, 0.1, 0.0],\n            [0.1, 0.09, 0.7, 0.2]\n        ]), 1e-3),\n        (np.array([\n            [0.6, 0.58, 0.0, 0.1],\n            [0.2, 0.19, 0.1, 0.0],\n            [0.1, 0.09, 0.7, 0.2]\n        ]), 0.5),\n        (np.array([\n            [0.7, 0.3, 0.0, 1.0],\n            [0.2, 0.1, 0.1, 0.3],\n            [0.1, 0.05, 0.8, 0.15]\n        ]), 0.1)\n    ]\n\n    all_results = []\n    for G, lambda_reg in test_cases:\n        m, n = G.shape\n\n        # Compute the resolution matrix R = (G^T G + lambda * I)^-1 * (G^T G)\n        GTG = G.T @ G\n        I_n = np.identity(n)\n        \n        # Matrix to be inverted\n        M = GTG + lambda_reg * I_n\n        \n        # Inverse of M\n        M_inv = np.linalg.inv(M)\n        \n        # Resolution matrix\n        R = M_inv @ GTG\n\n        # --- Calculate Aggregate Metrics ---\n\n        # 1. Mean Self-Gain\n        mean_self_gain = np.mean(np.diag(R))\n\n        # 2. Mean Leakage Fraction  3. Peak-Correct Fraction\n        leakage_fractions = []\n        peak_correct_indicators = []\n        \n        for j in range(n):\n            # Get the j-th column of the resolution matrix\n            psf_j = R[:, j]\n            abs_psf_j = np.abs(psf_j)\n            \n            # --- Leakage Fraction for column j ---\n            total_abs_sum = np.sum(abs_psf_j)\n            \n            leakage_frac_j = 0.0\n            if total_abs_sum > 0:\n                # Sum of absolute off-diagonal elements\n                off_diagonal_abs_sum = total_abs_sum - abs_psf_j[j]\n                leakage_frac_j = off_diagonal_abs_sum / total_abs_sum\n            \n            leakage_fractions.append(leakage_frac_j)\n\n            # --- Peak-Correct Indicator for column j ---\n            peak_location = np.argmax(abs_psf_j)\n            is_peak_correct = 1.0 if peak_location == j else 0.0\n            peak_correct_indicators.append(is_peak_correct)\n\n        mean_leakage_fraction = np.mean(leakage_fractions)\n        peak_correct_fraction = np.mean(peak_correct_indicators)\n\n        # Store the formatted results for this case\n        case_results = [\n            f\"{mean_self_gain:.6f}\",\n            f\"{mean_leakage_fraction:.6f}\",\n            f\"{peak_correct_fraction:.6f}\"\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string as per the problem requirements.\n    # e.g., [[m1,l1,p1],[m2,l2,p2],...]\n    inner_strings = [f\"[{','.join(res)}]\" for res in all_results]\n    final_output = f\"[{','.join(inner_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}