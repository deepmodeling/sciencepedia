{
    "hands_on_practices": [
        {
            "introduction": "临界系统一个最显著的经验特征是其活动在时间上的标度不变性，这通常表现为功率谱密度中的“$1/f$”噪声。本练习  将引导你通过推导，揭示临界状态下时间自相关函数的幂律衰减与功率谱的幂律形式之间的基本关系。通过运用维纳-辛钦定理，你将深入理解时间域的临界动力学如何直接转化为频域中可观测的标志性特征。",
            "id": "4027960",
            "problem": "考虑一个由大型循环网络生成的、处于连续相变临界点附近的平稳、零均值标量神经活动信号 $x(t)$。设自相关函数定义为 $C(t) = \\langle x(0) x(t) \\rangle$，功率谱密度 (PSD) 通过维纳-辛钦定理定义为 $S(f) = 2 \\int_{0}^{\\infty} C(t) \\cos(2 \\pi f t) \\, dt$，其中 $f$ 是时间频率。\n\n两种动力学机制是相关的：\n1. 在非临界机制下，相关性以有限的相关时间衰减，$C(t) \\approx A \\exp(-t/\\tau)$，其中 $\\tau  \\infty$，振幅 $A  0$。\n2. 在临界状态下，相关时间发散，相关性在扩展的惯性范围（受微观和宏观截止限制）内变为无标度，$C(t) \\approx A \\, t^{-\\alpha_{t}}$，对于区间 $[t_{0}, T]$ 内的 $t$，其中 $0  \\alpha_{t}  1$，$t_{0} \\ll T$，且 $A  0$。\n\n严格从上述定义和傅里叶余弦变换的标准渐近性质出发，推导两种机制下 $S(f)$ 的低频形式（对于临界情况，你可以引入一个消失的指数调节项来证明极限交换的合理性）。然后，推导在临界机制下由 $S(f) \\sim f^{-\\beta}$ 定义的谱标度指数 $\\beta$，并用 $\\alpha_{t}$ 表示。\n\n你的最终答案必须是 $\\beta$ 关于 $\\alpha_{t}$ 的单个闭式解析表达式。",
            "solution": "首先验证问题陈述，以确保其科学基础扎实、问题适定且客观。\n\n### 步骤 1：提取已知条件\n-   **信号**：平稳、零均值的标量神经活动信号 $x(t)$。\n-   **自相关函数**：$C(t) = \\langle x(0) x(t) \\rangle$。\n-   **功率谱密度 (PSD)**：$S(f) = 2 \\int_{0}^{\\infty} C(t) \\cos(2 \\pi f t) \\, dt$，其中 $f$ 是时间频率。\n-   **非临界机制**：自相关函数形式为 $C(t) \\approx A \\exp(-t/\\tau)$，具有有限的相关时间 $\\tau  \\infty$ 和振幅 $A  0$。\n-   **临界机制**：自相关函数呈幂律衰减，$C(t) \\approx A \\, t^{-\\alpha_{t}}$，对于区间 $[t_{0}, T]$ 内的 $t$，其中 $0  \\alpha_{t}  1$，$t_{0} \\ll T$，且 $A  0$。\n-   **定义**：在临界机制下，谱标度指数 $\\beta$ 由关系式 $S(f) \\sim f^{-\\beta}$ 定义。\n-   **目标**：推导两种机制下 $S(f)$ 的低频形式，并找出用 $\\alpha_{t}$ 表示 $\\beta$ 的表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学基础**：该问题基于临界性假说，这是计算神经科学和统计物理学中一个公认的框架。自相关函数、通过维纳-辛钦定理定义的功率谱密度、指数相关衰减（非临界）和幂律相关衰减（临界）的定义都是标准且正确的。\n2.  **适定性**：该问题是适定的。它提供了所有必要的定义和约束（例如，$0  \\alpha_t  1$），以推导出 $\\alpha_t$ 和 $\\beta$ 之间唯一且有意义的关系。\n3.  **客观性**：问题陈述使用了精确、正式的语言，没有歧义或主观论断。\n\n### 步骤 3：结论与行动\n该问题有效。将提供完整解答。\n\n### 推导过程\n\n分析过程是通过计算两种指定机制下的功率谱密度 $S(f)$ 来进行的。\n\n**1. 非临界机制**\n\n在这种机制下，自相关函数由 $C(t) \\approx A \\exp(-t/\\tau)$ 给出。功率谱密度 $S(f)$ 是 $C(t)$ 的傅里叶余弦变换：\n$$S(f) = 2 \\int_{0}^{\\infty} A \\exp(-t/\\tau) \\cos(2 \\pi f t) \\, dt$$\n这是一个标准的积分形式。根据指数函数的傅里叶余弦变换公式 $\\int_{0}^{\\infty} \\exp(-at) \\cos(bt) \\, dt = \\frac{a}{a^2 + b^2}$，我们设 $a = 1/\\tau$ 和 $b = 2\\pi f$。\n$$S(f) = 2A \\left( \\frac{1/\\tau}{(1/\\tau)^2 + (2\\pi f)^2} \\right)$$\n$$S(f) = 2A \\left( \\frac{1/\\tau}{1/\\tau^2 + 4\\pi^2 f^2} \\right) = 2A \\frac{\\tau}{1 + (2\\pi f \\tau)^2}$$\n这种函数形式是洛伦兹分布。在低频极限下，当 $f \\to 0$ 时，分母趋近于 $1$。\n$$S(f \\to 0) \\approx 2A\\tau$$\n在低频下，频谱是平坦的（白噪声），这是具有有限相关时间的系统的特征。在这种情况下，标度指数为 $\\beta=0$。\n\n**2. 临界机制**\n\n在临界状态下，自相关函数在扩展的时间尺度范围内近似为幂律，$C(t) \\approx A t^{-\\alpha_{t}}$。条件 $0  \\alpha_{t}  1$ 至关重要。PSD 由下式给出：\n$$S(f) \\approx 2 \\int_{0}^{\\infty} A t^{-\\alpha_{t}} \\cos(2 \\pi f t) \\, dt$$\n$S(f)$ 的低频行为由 $C(t)$ 的长时间行为决定。该积分的收敛性是微妙的，因为当 $0  \\alpha_t  1$ 时，函数 $t^{-\\alpha_t}$ 不在 $L^1[0, \\infty)$ 中，因为 $\\int_0^\\infty t^{-\\alpha_t} dt$ 在上极限处发散。然而，傅里叶余弦变换是良定义的。\n\n为了确定随频率 $f$ 的标度关系，我们进行变量替换。令 $u = 2\\pi f t$。这得到 $t = u / (2\\pi f)$ 和 $dt = du / (2\\pi f)$。将这些代入 $S(f)$ 的积分中：\n$$S(f) \\approx 2A \\int_{0}^{\\infty} \\left(\\frac{u}{2\\pi f}\\right)^{-\\alpha_{t}} \\cos(u) \\, \\frac{du}{2\\pi f}$$\n我们可以将包含 $f$ 的项提取出来：\n$$S(f) \\approx 2A (2\\pi f)^{\\alpha_{t}} \\frac{1}{2\\pi f} \\int_{0}^{\\infty} u^{-\\alpha_{t}} \\cos(u) \\, du$$\n$$S(f) \\approx \\frac{A}{\\pi} (2\\pi f)^{\\alpha_{t}-1} \\int_{0}^{\\infty} u^{-\\alpha_{t}} \\cos(u) \\, du$$\n简化与频率相关的项：\n$$S(f) \\approx \\frac{A (2\\pi)^{\\alpha_{t}-1}}{\\pi} f^{-(1-\\alpha_{t})} \\int_{0}^{\\infty} u^{-\\alpha_{t}} \\cos(u) \\, du$$\n积分 $\\int_{0}^{\\infty} u^{-\\alpha_{t}} \\cos(u) \\, du$ 是一个定积分，其值仅取决于参数 $\\alpha_{t}$。在给定范围 $0  \\alpha_{t}  1$ 内，该积分收敛到一个有限的正数常量。该常量的确切值为 $\\Gamma(1-\\alpha_t) \\sin(\\pi \\alpha_t / 2)$，其中 $\\Gamma$ 是伽马函数。\n\n设 $K(\\alpha_t) = \\frac{A (2\\pi)^{\\alpha_{t}-1}}{\\pi} \\int_{0}^{\\infty} u^{-\\alpha_{t}} \\cos(u) \\, du$。由于 $K(\\alpha_t)$ 是一个关于频率 $f$ 的常数，我们得到以下标度关系：\n$$S(f) \\propto f^{-(1-\\alpha_{t})}$$\n问题通过关系式 $S(f) \\sim f^{-\\beta}$ 定义了谱标度指数 $\\beta$。通过将此定义与我们推导出的结果进行比较，我们可以直接确定 $\\beta$ 的表达式。\n$$f^{-\\beta} \\sim f^{-(1-\\alpha_{t})}$$\n因此，谱标度指数 $\\beta$ 与时间相关指数 $\\alpha_{t}$ 的关系为：\n$$\\beta = 1 - \\alpha_{t}$$\n这个结果是临界动力学的一个基本特征，即时间上的幂律衰减（指数为 $\\alpha_t$）转化为频率上的幂律谱（指数为 $\\beta = 1 - \\alpha_t$）。条件 $0  \\alpha_t  1$ 确保了 $0  \\beta  1$，这是在许多处于或接近临界状态的复杂系统中观察到的所谓“$1/f$ 噪声”或“粉红噪声”的特征。",
            "answer": "$$\\boxed{1 - \\alpha_{t}}$$"
        },
        {
            "introduction": "临界性的理论预测通常是在无限大的系统（即热力学极限）中做出的，但这与真实的、有限大小的神经系统存在差距。本练习  旨在解决一个关键问题：这些理论预测如何体现在有限尺寸的系统中，例如皮层回路或计算机模拟。你将运用有限尺寸标度律这一强大工具，来推导诸如磁化率峰值等关键可观测量如何随系统规模$N$变化，这对于正确解读实验和模拟数据至关重要。",
            "id": "4027966",
            "problem": "考虑一个空间嵌入的、稀疏连接的神经网络，其活动传播参数 $p$ 处于连续相变点附近，其中 $p_{c}$ 表示临界值。设网络有 $N$ 个神经元，排列在一个有效的 $d$ 维几何结构中，其线性尺度 $L$ 满足 $L \\sim N^{1/d}$，并假设相互作用是短程的。序参量 $m$ 是处于稳态的活跃神经元的比例。磁化率 $\\chi$ 定义为 $m$ 对微小均匀外部驱动 $h$ 的线性响应，即 $\\chi = \\left.\\frac{\\partial m}{\\partial h}\\right|_{h \\to 0}$，并且根据经验观察，在热力学极限下，此类模型中的磁化率根据 $\\chi \\sim |p - p_{c}|^{-\\gamma}$ 发散，而活动涨落的相关长度 $\\xi$ 根据 $\\xi \\sim |p - p_{c}|^{-\\nu}$ 发散。\n\n仅利用这些基本原理以及当 $\\xi$ 与 $L$ 相当时由有限尺寸引起的截断（有限尺寸圆滑效应），推导当 $N \\to \\infty$ 且 $d$ 固定时，磁化率峰值的有限尺寸位置 $p_{\\max}$ 及其有限尺寸高度 $\\chi_{\\max}(N)$ 如何随 $N$ 标度。然后，对于一个属于二维Ising普适类（指数为 $\\gamma = \\frac{7}{4}$ 和 $\\nu = 1$）的网络，该网络嵌入一个模型化为 $d = 2$ 的皮层中，并且 $N = 10^{8}$，在忽略非普适性乘法常数的主导幂律近似下，计算无量纲量\n$$\nS(N) \\equiv \\frac{\\chi_{\\max}(N)}{|p_{\\max} - p_{c}|}\n$$\n将最终答案表示为一个无单位的数字。如果可以给出精确值，则无需四舍五入；否则，将答案四舍五入到四位有效数字。",
            "solution": "该场景描述了一个具有标准标度行为的连续相变。根据定义，在热力学极限下，磁化率的标度关系为 $\\chi \\sim |p - p_{c}|^{-\\gamma}$，相关长度的标度关系为 $\\xi \\sim |p - p_{c}|^{-\\nu}$。在一个嵌入 $d$ 维空间、包含 $N$ 个神经元的有限系统中，其线性尺寸为 $L \\sim N^{1/d}$。\n\n出现有限尺寸圆滑效应是因为 $\\xi$ 的发散不能超过系统尺寸 $L$。当控制参数 $p$ 调整到足够接近 $p_{c}$，以至于相关长度 $\\xi$ 饱和到系统尺寸 $L$ 时，磁化率达到峰值 $\\chi_{\\max}(N)$。峰值的条件是\n$$\n\\xi \\sim L \\quad \\Rightarrow \\quad |p_{\\max} - p_{c}| \\sim L^{-1/\\nu}.\n$$\n这给出了峰值位置偏移的标度关系，\n$$\n|p_{\\max} - p_{c}| \\sim L^{-1/\\nu}.\n$$\n代入关系式 $L \\sim N^{1/d}$ 可得\n$$\n|p_{\\max} - p_{c}| \\sim N^{-1/(d \\nu)}.\n$$\n\n接下来，计算在这个偏移位置上的磁化率。由于 $\\chi \\sim |p - p_{c}|^{-\\gamma}$，代入 $|p_{\\max} - p_{c}| \\sim L^{-1/\\nu}$ 可得\n$$\n\\chi_{\\max}(N) \\sim \\left(L^{-1/\\nu}\\right)^{-\\gamma} = L^{\\gamma/\\nu}.\n$$\n使用 $L \\sim N^{1/d}$，\n$$\n\\chi_{\\max}(N) \\sim N^{\\gamma/(d \\nu)}.\n$$\n\n我们需要计算的量是\n$$\nS(N) \\equiv \\frac{\\chi_{\\max}(N)}{|p_{\\max} - p_{c}|}.\n$$\n使用推导出的标度关系，\n$$\nS(N) \\sim \\frac{N^{\\gamma/(d \\nu)}}{N^{-1/(d \\nu)}} = N^{\\left(\\gamma + 1\\right)/(d \\nu)}.\n$$\n\n对于指定的普适类和几何结构，使用 $\\gamma = \\frac{7}{4}$，$\\nu = 1$ 和 $d = 2$。那么\n$$\n\\frac{\\gamma + 1}{d \\nu} = \\frac{\\frac{7}{4} + 1}{2 \\cdot 1} = \\frac{\\frac{11}{4}}{2} = \\frac{11}{8}.\n$$\n因此，\n$$\nS(N) \\sim N^{11/8}.\n$$\n当 $N = 10^{8}$ 时，\n$$\nS(10^{8}) \\sim \\left(10^{8}\\right)^{11/8} = 10^{11}.\n$$\n这是在主导幂律近似（忽略了非普适性乘法常数）下的精确计算。无需四舍五入。",
            "answer": "$$\\boxed{1 \\times 10^{11}}$$"
        },
        {
            "introduction": "大脑是一个高度异构的复杂系统，这催生了诸如格里菲斯相（Griffiths phase）等替代理论，它们也能产生类似临界性的行为。这项计算练习  要求你设计一个模拟实验，以区分简单的“精细调tuning”临界模型和更复杂的、无序的格里菲斯相模型。这项任务将理论知识应用于计算假设检验的实践，你将实现一个分支过程模型，分析其统计输出，并构建一个分类器，这完整地模拟了计算神经科学家的部分工作流程。",
            "id": "4027904",
            "problem": "考虑神经系统中的临界假说，在该假说中，当系统在临界点附近运行时，自发的神经活动会表现出无标度雪崩。雪崩生成的一个极简数学框架是 Galton–Watson 分支过程，其中每个活动单元（例如，神经元或局部群体）产生随机数量的后代。设每个活动单元的预期后代数表示为 $m$。在同质系统中，将 $m$ 调谐至 $m=1$ 会产生临界性，而 $m  1$ 是亚临界状态，$m1$ 是超临界状态。在具有淬灭无序的空间异质系统中，嵌入在整体亚临界介质中的 $m1$ 的稀有区域可以生成一个被称为 Griffiths 相的扩展表观类临界行为区域，其特征是非普适的幂律指数和跨子系统（例如，皮层区域或实验条件）的广泛变异性。\n\n您的任务是设计并实现一个计算实验，通过分析跨皮层区域的变异性来区分 Griffiths 相和调谐临界性。将每个皮层区域建模为由 $K$ 个微斑块组成，每个微斑块具有一个固定的（淬灭的）繁殖均值 $m_k$。雪崩在一个微斑块中开始，并作为该斑块中的 Galton–Watson 过程进行，其后代分布为均值为 $m_k$ 的泊松分布，并受限于有限的系统规模 $N$（即，雪崩规模不能超过 $N$）。对于区域 $a$，模拟 $A$ 次雪崩并收集雪崩规模 $\\{s_i^{(a)}\\}_{i=1}^A$。对于区域级别的尾指数估计，使用幂律尾部的连续最大似然估计量：对于选定的下限截断值 $s_{\\min}$，指数 $\\tau^{(a)}$ 估计为\n$$\n\\hat{\\tau}^{(a)} \\;=\\; 1 \\;+\\; \\frac{n_a}{\\sum_{i=1}^{n_a} \\ln\\!\\left(\\frac{s_i^{(a)}}{s_{\\min}}\\right)},\n$$\n其中，求和是对区域 $a$ 中满足 $s_i^{(a)} \\ge s_{\\min}$ 的 $n_a$ 个雪崩规模进行的。\n\n为给定场景定义以下跨区域度量：\n- 跨区域平均尾指数 $\\overline{\\tau} = \\frac{1}{M}\\sum_{a=1}^{M} \\hat{\\tau}^{(a)}$，其中 $M$ 是区域数量。\n- 跨区域变异性 $V_\\tau = \\sqrt{\\frac{1}{M}\\sum_{a=1}^{M} \\left(\\hat{\\tau}^{(a)} - \\overline{\\tau}\\right)^2}$。\n- 稀有区域饱和指标 $R$，定义为所有区域中达到上限 $N$（即 $s_i^{(a)} = N$）的雪崩所占的比例，该比例在所有区域上聚合计算。\n\n使用的科学依据：\n- 在同质分支中，$m=1$ 产生具有特征指数的无标度雪崩；$m1$ 产生指数截断和在有限 $N$ 下的少量饱和。\n- 在由淬灭无序引起的 Griffiths 相中，嵌入在亚临界主体中的稀有超临界斑块（$m_k>1$）会导致非普适的有效指数和跨区域变异性增强，以及由于稀有斑块中的爆发性增长而导致雪崩饱和 $N$ 的频率增加。\n\n您的程序必须：\n1. 实现上述对每个区域的模拟，其中雪崩是一个后代分布为 Poisson($m_k$) 的 Galton–Watson 过程，从单个微斑块中的一个活动单元开始，当过程消亡或累积规模达到 $N$ 时停止。\n2. 使用上述公式为每个区域估计 $\\hat{\\tau}^{(a)}$。从集合 $\\{5,2,1\\}$ 中自适应地选择 $s_{\\min}$：从 $s_{\\min}=5$ 开始，如果尾部样本量 $n_a  100$，则减小到 $s_{\\min}=2$，如果 $n_a$ 仍然小于 $100$，则减小到 $s_{\\min}=1$。\n3. 计算该场景的 $\\overline{\\tau}$、$V_\\tau$ 和 $R$。\n4. 使用以下决策规则对场景进行分类，该规则将经验性检验形式化：\n   - 如果 $V_\\tau  0.08$ 且 $R  0.02$，则输出整数 $2$ (Griffiths-样)。\n   - 否则，如果 $\\left|\\overline{\\tau} - 1.5\\right| \\le 0.15$，$V_\\tau \\le 0.05$，且 $0.005 \\le R \\le 0.05$，则输出整数 $1$ (调谐临界)。\n   - 否则，输出整数 $0$ (非临界/偏离临界)。\n\n使用以下场景测试套件，每个场景提供 $(M, N\\text{-list}, K, A, \\text{异质性参数})$：\n- 场景 1 (Griffiths-样)：$M=8$，$N\\text{-list} = [220,260,300,340,380,420,460,500]$，$K=50$，$A=3000$，有比例为 $p_{\\mathrm{rr}}=0.05$ 的稀有斑块，其 $m_k \\sim \\mathcal{N}(\\mu_{\\mathrm{super}}, \\sigma_{\\mathrm{super}})$，其中 $\\mu_{\\mathrm{super}}=1.05$，$\\sigma_{\\mathrm{super}}=0.01$；其余 $1-p_{\\mathrm{rr}}$ 的主体斑块，其 $m_k \\sim \\mathcal{N}(\\mu_{\\mathrm{sub}}, \\sigma_{\\mathrm{sub}})$，其中 $\\mu_{\\mathrm{sub}}=0.95$，$\\sigma_{\\mathrm{sub}}=0.02$。将 $m_k$ 截断在区间 $[0.2, 2.0]$ 内。\n- 场景 2 (调谐临界)：$M=8$，$N\\text{-list} = [220,260,300,340,380,420,460,500]$，$K=50$，$A=3000$，所有斑块的 $m_k$ 均从 $m_k \\sim \\mathcal{N}(\\mu_{\\mathrm{crit}}, \\sigma_{\\mathrm{crit}})$ 采样，其中 $\\mu_{\\mathrm{crit}}=1.0$，$\\sigma_{\\mathrm{crit}}=0.005$，截断在 $[0.2, 2.0]$ 内。\n- 场景 3 (亚临界/偏离临界)：$M=8$，$N\\text{-list} = [220,260,300,340,380,420,460,500]$，$K=50$，$A=3000$，所有斑块的 $m_k$ 均从 $m_k \\sim \\mathcal{N}(\\mu_{\\mathrm{sub}}, \\sigma_{\\mathrm{sub}})$ 采样，其中 $\\mu_{\\mathrm{sub}}=0.90$，$\\sigma_{\\mathrm{sub}}=0.02$，截断在 $[0.2, 2.0]$ 内。\n\n对于每个场景，假设雪崩开始时从相应区域的 $K$ 个斑块中均匀选择一个，然后完全在该斑块内演化（从而在斑块层面尊重淬灭无序）。所有随机抽样应通过固定一个全局伪随机种子来保证可复现。\n\n您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[result1,result2,result3]”），每个结果是对应于上述所列顺序的场景的整数分类。不涉及任何物理单位或角度；仅报告指定的整数输出。",
            "solution": "该问题要求设计并实现一个计算实验，将神经活动模式分为三类：Griffiths-样、调谐临界和非临界/偏离临界。该分类基于使用一个 Galton-Watson 分支过程模型，跨越多个不同区域模拟神经雪崩，每个区域的特点是其微斑块结构中的淬灭无序。\n\n解决方案首先构建模拟框架，然后定义用于分析的统计度量，最后实现所提供的分类规则。每一步都基于问题描述中阐述的计算神经科学和统计物理学原理。\n\n### 1. 模型与仿真框架\n\n模拟的核心是 Galton-Watson 分支过程，这是雪崩动力学的标准模型。雪崩从单个活动单元开始，并以离散代的方式进行。在每一代中，每个活动单元产生一定数量的“后代”单元，这些后代成为下一代的活动单元。当某一代产生零个后代时，过程终止（消亡）。\n\n**单次雪崩的模拟：**\n一次雪崩在一个由繁殖均值 $m_k$ 表征的单个微斑块 $k$ 内进行模拟。每个活动单元的后代数量从均值为 $m_k$ 的泊松分布中抽取。如果当前代有 $N_{\\text{active}}$ 个单元，后代的总数是 $N_{\\text{active}}$ 个来自 $\\text{Poisson}(m_k)$ 分布的独立抽样之和。根据泊松分布的性质，这个总和等效于从 $\\text{Poisson}(N_{\\text{active}} \\cdot m_k)$ 分布中进行单次抽样。这种数学等效性被用来提高计算效率。\n\n模拟受限于一个有限的系统规模 $N$，该规模对每个皮层区域是特定的。如果雪崩的累积规模（总共激活的单元数）加上新生成的后代超过或等于 $N$，则认为雪崩已使系统饱和。其规模记录为 $N$，过程终止。否则，更新总规模和活动单元数，过程继续。雪崩的最终规模 $s$ 是其整个生命周期中激活的单元总数。\n\n**皮层区域与淬灭无序的建模：**\n系统包含 $M$ 个皮层区域。每个区域 $a$ 由 $K$ 个微斑块组成，并被分配一个特定的系统规模上限 $N_a$。“淬灭无序”通过为 $K$ 个斑块中的每一个分配一个固定的、不随时间变化的繁殖均值 $m_k$ 来表示。这些 $m_k$ 值在每个场景中为每个区域生成一次，并在该区域模拟的所有 $A$ 次雪崩中保持不变。\n\n对于一个区域中的 $A$ 次雪崩中的每一次，从 $K$ 个可用斑块中均匀随机选择一个斑块 $k$。然后整个雪崩根据该斑块特定繁殖均值 $m_k$ 控制的分支过程动力学展开。\n\n为一个区域生成集合 $\\{m_k\\}_{k=1}^K$ 的方式取决于具体场景：\n- **场景 1 (Griffiths-样)：** 一小部分比例为 $p_{\\mathrm{rr}}$ 的斑块被指定为“稀有区域”，具有超临界繁殖均值，$m_k \\sim \\mathcal{N}(\\mu_{\\mathrm{super}}, \\sigma_{\\mathrm{super}})$，其中 $\\mu_{\\mathrm{super}}  1$。大多数斑块是亚临界的，其 $m_k \\sim \\mathcal{N}(\\mu_{\\mathrm{sub}}, \\sigma_{\\mathrm{sub}})$，其中 $\\mu_{\\mathrm{sub}}  1$。这种异质性是 Griffiths 相模型的决定性特征。稀有斑块的数量确定为 $\\text{round}(p_{\\mathrm{rr}} \\cdot K)$。\n- **场景 2  3 (同质)：** 一个区域中的所有 $K$ 个斑块的 $m_k$ 值都从单一正态分布中抽取：对于调谐临界情况，中心在 1 附近（$\\mu_{\\mathrm{crit}}=1.0$）；对于亚临界情况，显著小于 1（$\\mu_{\\mathrm{sub}}=0.90$）。小的方差 $\\sigma$ 模拟了轻微的同质无序。\n\n在所有情况下，抽样的 $m_k$ 值都被截断到指定的区间 $[0.2, 2.0]$ 内。\n\n### 2. 统计分析与度量\n\n为 $M$ 个区域中的每一个模拟 $A$ 次雪崩后，我们分析得到的雪崩规模分布 $\\{s_i^{(a)}\\}_{i=1}^A$ 以计算三个关键度量。\n\n**尾指数估计 ($\\hat{\\tau}^{(a)}$)：**\n对于每个区域 $a$，估计雪崩规模分布的尾指数。临界系统预期会表现出幂律分布，$P(s) \\sim s^{-\\tau}$。问题提供了在给定下限截断值 $s_{\\min}$ 的情况下，$\\tau$ 的连续最大似然估计量：\n$$ \\hat{\\tau}^{(a)} \\;=\\; 1 \\;+\\; \\frac{n_a}{\\sum_{i=1}^{n_a} \\ln\\!\\left(\\frac{s_i^{(a)}}{s_{\\min}}\\right)} $$\n这里，$n_a$ 是区域 $a$ 中规模 $s_i^{(a)} \\ge s_{\\min}$ 的雪崩数量。为确保估计的稳健性，$s_{\\min}$ 是自适应选择的。我们首先尝试 $s_{\\min}=5$。如果这产生的数据点少于 $n_a=100$ 个用于拟合，我们将截断值放宽到 $s_{\\min}=2$。如果计数仍然低于 100，我们使用 $s_{\\min}=1$。该过程在拟合分布尾部和确保足够样本量之间取得了平衡。\n\n**跨区域度量 ($\\overline{\\tau}$, $V_\\tau$, $R$)：**\n各个区域层面的估计值 $\\hat{\\tau}^{(a)}$ 在 $M$ 个区域间进行聚合，以计算两个全局度量：\n1.  平均尾指数，$\\overline{\\tau} = \\frac{1}{M}\\sum_{a=1}^{M} \\hat{\\tau}^{(a)}$。\n2.  尾指数的变异性（总体标准差），$V_\\tau = \\sqrt{\\frac{1}{M}\\sum_{a=1}^{M} \\left(\\hat{\\tau}^{(a)} - \\overline{\\tau}\\right)^2}$。\n\n第三个度量，稀有区域饱和指标 $R$，通过汇集所有区域的所有雪崩数据来计算。它被定义为达到各自区域规模上限 $N_a$ 的雪崩的总比例：\n$$ R = \\frac{\\sum_{a=1}^{M} |\\{i \\mid s_i^{(a)} = N_a\\}|}{M \\cdot A} $$\n\n### 3. 分类逻辑\n\n三个度量——$\\overline{\\tau}$、$V_\\tau$ 和 $R$——构成一个特征向量，捕捉了模拟系统的基本动力学。一个基于问题中提供的阈值的决策树，对每个场景进行分类：\n- **Griffiths-样 (输出 $2$)：** 以高变异性和频繁的大事件为特征。如果 $V_\\tau  0.08$ 且 $R  0.02$，则识别为此类。高变异性源于稀有超临界斑块的随机分布导致不同区域的动力学多样化，而高饱和率是这些斑块驱动爆发性雪崩的直接后果。\n- **调谐临界 (输出 $1$)：** 其特征行为与临界性的理论预测一致。如果平均指数接近理论值 $1.5$ (具体为 $|\\overline{\\tau} - 1.5| \\le 0.15$)、变异性低 ($V_\\tau \\le 0.05$) 且饱和度适中 ($0.005 \\le R \\le 0.05$)，则识别为此类。\n- **非临界/偏离临界 (输出 $0$)：** 任何不满足上述标准的场景，这将包括产生很少大雪崩且统计数据与临界性不一致的亚临界系统。\n\n### 4. 实现策略\n\n实现过程是将上述原理直接转化为使用 `numpy` 库的 Python 脚本。在开始时为一个伪随机数生成器设定种子以确保可复现性。主逻辑遍历每个预定义的场景，执行以下步骤：\n1.  对于 $M$ 个区域中的每一个，根据场景参数生成并存储淬灭的 $m_k$ 值集。\n2.  对于每个区域，模拟 $A$ 次雪崩，每次从随机选择的斑块开始。存储产生的雪崩规模。\n3.  计算该区域的饱和计数并估计其尾指数 $\\hat{\\tau}^{(a)}$。\n4.  处理完所有区域后，计算聚合度量 $\\overline{\\tau}$、$V_\\tau$ 和 $R$。\n5.  应用分类规则来确定该场景的整数输出。\n6.  收集所有场景的结果并按指定格式打印。使用 `np.nanmean` 和 `np.nanstd` 为任何单个区域中 $\\hat{\\tau}$ 估计可能出现的失败提供了鲁棒性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# language: Python\n# version: 3.12\n# libraries:\n#   - name: numpy, version: 1.23.5\n#   - name: scipy, version: 1.11.4 (not used)\n\ndef generate_m_ks_for_area(params, K, rng):\n    \"\"\"\n    Generates the quenched list of m_k values for a single area based on scenario parameters.\n    \"\"\"\n    m_clip_min, m_clip_max = params[\"m_clip\"]\n    \n    if params[\"heterogeneous\"]:\n        p_rr = params[\"p_rr\"]\n        # Use int(x + 0.5) for standard rounding of positive numbers for reproducibility.\n        n_rare = int(p_rr * K + 0.5)\n        n_bulk = K - n_rare\n        \n        m_super_params = params[\"super\"]\n        m_sub_params = params[\"sub\"]\n        \n        m_rare = rng.normal(loc=m_super_params[\"mean\"], scale=m_super_params[\"std\"], size=n_rare)\n        m_bulk = rng.normal(loc=m_sub_params[\"mean\"], scale=m_sub_params[\"std\"], size=n_bulk)\n        \n        m_ks = np.concatenate((m_rare, m_bulk))\n    else:\n        m_dist_params = params[\"dist\"]\n        m_ks = rng.normal(loc=m_dist_params[\"mean\"], scale=m_dist_params[\"std\"], size=K)\n        \n    m_ks = np.clip(m_ks, m_clip_min, m_clip_max)\n    rng.shuffle(m_ks)\n    return m_ks\n\ndef run_avalanche(m_k, N, rng):\n    \"\"\"\n    Simulates a single Galton-Watson avalanche with a size cap N.\n    \"\"\"\n    active_units = 1\n    total_size = 1\n\n    if N == 1:\n        return 1\n\n    while active_units  0:\n        # Sum of 'k' Poisson(lambda) variables is a Poisson(k*lambda) variable.\n        # This is a correct and efficient way to calculate total offspring.\n        num_offspring = rng.poisson(m_k * active_units)\n        \n        if total_size + num_offspring = N:\n            return N\n        \n        total_size += num_offspring\n        active_units = num_offspring\n        \n    return total_size\n\ndef estimate_tau(avalanche_sizes):\n    \"\"\"\n    Estimates the tail exponent tau using the continuous MLE and adaptive s_min.\n    \"\"\"\n    sizes = np.asarray(avalanche_sizes)\n    s_min_choices = [5, 2, 1]\n    \n    s_min_final = -1\n    tail_sizes = np.array([])\n    \n    for s_min in s_min_choices:\n        tail = sizes[sizes = s_min]\n        if len(tail) = 100:\n            s_min_final = s_min\n            tail_sizes = tail\n            break\n            \n    if s_min_final == -1:\n        s_min_final = 1\n        tail_sizes = sizes[sizes = s_min_final]\n\n    n_a = len(tail_sizes)\n    \n    if n_a == 0:\n        return np.nan\n\n    log_sum = np.sum(np.log(tail_sizes / s_min_final))\n    \n    if log_sum = 1e-9: # Avoid division by zero or near-zero\n        return np.nan\n        \n    tau_hat = 1.0 + n_a / log_sum\n    return tau_hat\n\ndef classify_scenario(tau_bar, v_tau, R):\n    \"\"\"\n    Classifies the scenario based on the computed metrics.\n    \"\"\"\n    if v_tau > 0.08 and R > 0.02:\n        return 2\n    elif abs(tau_bar - 1.5) = 0.15 and v_tau = 0.05 and 0.005 = R = 0.05:\n        return 1\n    else:\n        return 0\n\ndef run_scenario(params, rng):\n    \"\"\"\n    Runs the full simulation for one scenario and returns its classification.\n    \"\"\"\n    M, N_list, K, A = params[\"M\"], params[\"N_list\"], params[\"K\"], params[\"A\"]\n    \n    all_area_taus = []\n    total_saturated_count = 0\n    \n    all_areas_m_ks = [generate_m_ks_for_area(params, K, rng) for _ in range(M)]\n    \n    for i in range(M):\n        N_area = N_list[i]\n        m_ks_area = all_areas_m_ks[i]\n        \n        area_avalanche_sizes = np.empty(A, dtype=int)\n        \n        patch_indices = rng.integers(0, K, size=A)\n        \n        for j in range(A):\n            m_k = m_ks_area[patch_indices[j]]\n            size = run_avalanche(m_k, N_area, rng)\n            area_avalanche_sizes[j] = size\n            \n        total_saturated_count += np.sum(area_avalanche_sizes == N_area)\n        \n        tau_a = estimate_tau(area_avalanche_sizes)\n        all_area_taus.append(tau_a)\n        \n    tau_bar = np.nanmean(all_area_taus)\n    v_tau = np.nanstd(all_area_taus) # Population standard deviation (ddof=0 default)\n    R = total_saturated_count / (M * A)\n    \n    if np.isnan(tau_bar) or np.isnan(v_tau):\n        return 0\n        \n    return classify_scenario(tau_bar, v_tau, R)\n\ndef solve():\n    \"\"\"\n    Main function to define scenarios, run simulations, and print results.\n    \"\"\"\n    RNG = np.random.default_rng(0)\n\n    test_cases = [\n        # Scenario 1 (Griffiths-like)\n        {\n            \"name\": \"Griffiths-like\",\n            \"M\": 8, \"N_list\": [220, 260, 300, 340, 380, 420, 460, 500],\n            \"K\": 50, \"A\": 3000,\n            \"heterogeneous\": True,\n            \"p_rr\": 0.05,\n            \"super\": {\"mean\": 1.05, \"std\": 0.01},\n            \"sub\": {\"mean\": 0.95, \"std\": 0.02},\n            \"m_clip\": [0.2, 2.0]\n        },\n        # Scenario 2 (Tuned critical)\n        {\n            \"name\": \"Tuned critical\",\n            \"M\": 8, \"N_list\": [220, 260, 300, 340, 380, 420, 460, 500],\n            \"K\": 50, \"A\": 3000,\n            \"heterogeneous\": False,\n            \"dist\": {\"mean\": 1.0, \"std\": 0.005},\n            \"m_clip\": [0.2, 2.0]\n        },\n        # Scenario 3 (Subcritical/off-critical)\n        {\n            \"name\": \"Subcritical/off-critical\",\n            \"M\": 8, \"N_list\": [220, 260, 300, 340, 380, 420, 460, 500],\n            \"K\": 50, \"A\": 3000,\n            \"heterogeneous\": False,\n            \"dist\": {\"mean\": 0.90, \"std\": 0.02},\n            \"m_clip\": [0.2, 2.0]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_scenario(case, RNG)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}