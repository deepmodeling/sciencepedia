{
    "hands_on_practices": [
        {
            "introduction": "Understanding synchronization begins with the simplest case: a single oscillator driven by an external periodic force. This foundational exercise guides you through the analytical derivation of the conditions for 1:1 phase locking, a cornerstone of entrainment theory . By transforming the system's dynamics into a more tractable form, you will uncover the precise relationship between frequency difference, forcing strength, and the stable phase relationship that emerges.",
            "id": "4026095",
            "problem": "Consider a single phase-reduced neural oscillator subjected to weak sinusoidal forcing, modeled by the forced phase equation $ \\dot{\\phi}(t) = \\omega + F \\sin\\!\\big(\\Omega t - \\phi(t)\\big) $, where $ \\phi(t) $ is the oscillator phase, $ \\omega $ is the natural frequency of the unforced oscillator, $ F \\ge 0 $ is the forcing amplitude, and $ \\Omega $ is the forcing frequency. The phenomenon of entrainment refers to the long-time evolution in which the oscillator frequency matches the forcing frequency and the phase difference between the oscillator and the drive approaches a time-independent constant. Assume $ 1\\!:\\!1 $ entrainment (frequency locking with zero average phase drift) occurs, and define the phase difference $ \\delta(t) = \\phi(t) - \\Omega t $. Using only standard phase reduction assumptions and linear stability analysis of fixed points for one-dimensional autonomous systems, derive the fixed-point condition that determines the locked phase difference and determine the linear stability of the locked state. Provide, as your final answer, a single closed-form analytic expression for the stable locked phase difference $ \\delta^{\\ast} $ in terms of $ \\omega $, $ \\Omega $, and $ F $. Express the final answer in radians.",
            "solution": "The problem is first validated against the specified criteria.\n\n### Step 1: Extract Givens\n- **Model Equation**: $ \\dot{\\phi}(t) = \\omega + F \\sin\\!\\big(\\Omega t - \\phi(t)\\big) $\n- **Variables**:\n    - $ \\phi(t) $: oscillator phase at time $t$\n    - $ \\omega $: natural frequency of the unforced oscillator\n    - $ F $: forcing amplitude, $F \\ge 0$\n    - $ \\Omega $: forcing frequency\n- **Definitions**:\n    - **Entrainment**: The long-time evolution where the oscillator frequency matches the forcing frequency and the phase difference approaches a time-independent constant.\n    - **Phase Difference**: $ \\delta(t) = \\phi(t) - \\Omega t $\n- **Assumptions**: $ 1\\!:\\!1 $ entrainment occurs.\n- **Task**:\n    1. Derive the fixed-point condition for the locked phase difference.\n    2. Determine the linear stability of the locked state.\n    3. Provide the closed-form analytic expression for the stable locked phase difference, $ \\delta^{\\ast} $.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed for validity:\n- **Scientifically Grounded**: The provided model, $ \\dot{\\phi} = \\omega + F \\sin(\\Omega t - \\phi) $, is a canonical form of the Adler equation. It is a fundamental and widely used model in physics, engineering, and computational neuroscience to study synchronization, phase locking, and entrainment in weakly forced or coupled oscillators. The problem is based on established scientific principles.\n- **Well-Posed**: The problem is clearly stated. It asks for the derivation of a specific quantity ($ \\delta^{\\ast} $) from a given differential equation under the assumption of entrainment. The mathematical structure is that of a first-order non-autonomous ordinary differential equation which can be transformed into an autonomous one, for which standard methods of analysis (fixed-point and stability analysis) apply. A unique, stable solution is expected under the stated conditions.\n- **Objective**: The language is precise and quantitative, free of any subjective or ambiguous terminology.\n- **Completeness and Consistency**: The problem provides all necessary information: the governing equation, definitions of all variables and parameters, and the key assumption of entrainment. There are no contradictions.\n- **Realism**: The model is a standard idealization used in the field. The parameters are generic and do not represent physically impossible values.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is scientifically sound, well-posed, objective, and self-contained. The solution process can proceed.\n\n### Solution Derivation\nThe dynamics of the oscillator phase are given by the equation:\n$$ \\dot{\\phi}(t) = \\omega + F \\sin(\\Omega t - \\phi(t)) $$\nThe problem defines the phase difference as $ \\delta(t) = \\phi(t) - \\Omega t $. We seek to find the dynamics governing $ \\delta(t) $. To do this, we differentiate $ \\delta(t) $ with respect to time $ t $:\n$$ \\dot{\\delta}(t) = \\frac{d}{dt} \\big( \\phi(t) - \\Omega t \\big) = \\dot{\\phi}(t) - \\Omega $$\nSubstituting the expression for $ \\dot{\\phi}(t) $ into this equation gives:\n$$ \\dot{\\delta}(t) = \\big( \\omega + F \\sin(\\Omega t - \\phi(t)) \\big) - \\Omega $$\nThe term inside the sine function can be expressed in terms of $ \\delta(t) $:\n$$ \\Omega t - \\phi(t) = -(\\phi(t) - \\Omega t) = -\\delta(t) $$\nUsing the property of the sine function that $ \\sin(-x) = -\\sin(x) $, the equation for $ \\dot{\\delta}(t) $ becomes:\n$$ \\dot{\\delta}(t) = \\omega - \\Omega - F \\sin(\\delta(t)) $$\nThis is a first-order, autonomous ordinary differential equation for the phase difference $ \\delta(t) $.\n\nThe condition for entrainment, or phase locking, is that the phase difference approaches a time-independent constant value, which we denote as $ \\delta^{\\ast} $. This corresponds to a fixed point of the dynamics for $ \\delta(t) $. A fixed point occurs when $ \\dot{\\delta}(t) = 0 $.\nSetting $ \\dot{\\delta}(t) = 0 $ yields the fixed-point condition:\n$$ 0 = \\omega - \\Omega - F \\sin(\\delta^{\\ast}) $$\nRearranging this equation gives the condition that determines the locked phase difference(s):\n$$ F \\sin(\\delta^{\\ast}) = \\omega - \\Omega $$\n$$ \\sin(\\delta^{\\ast}) = \\frac{\\omega - \\Omega}{F} $$\nFor a real solution for $ \\delta^{\\ast} $ to exist, the value of the right-hand side must be within the range of the sine function, which is $ [-1, 1] $. This leads to the condition for frequency locking:\n$$ \\left| \\frac{\\omega - \\Omega}{F} \\right| \\le 1 \\quad \\implies \\quad |\\omega - \\Omega| \\le F $$\nThe problem statement assumes that entrainment occurs, so we proceed under the assumption that this condition is met.\n\nTo determine the stability of a fixed point $ \\delta^{\\ast} $, we perform a linear stability analysis. Let the right-hand side of the autonomous ODE for $ \\delta $ be $g(\\delta)$:\n$$ g(\\delta) = \\omega - \\Omega - F \\sin(\\delta) $$\nA fixed point $ \\delta^{\\ast} $ is linearly stable if the derivative of $ g(\\delta) $ evaluated at the fixed point is negative, i.e., $ g'(\\delta^{\\ast})  0 $. It is unstable if $ g'(\\delta^{\\ast})  0 $.\nThe derivative of $ g(\\delta) $ is:\n$$ g'(\\delta) = \\frac{d}{d\\delta} \\big( \\omega - \\Omega - F \\sin(\\delta) \\big) = -F \\cos(\\delta) $$\nThus, for a stable fixed point, we must have:\n$$ g'(\\delta^{\\ast}) = -F \\cos(\\delta^{\\ast})  0 $$\nSince the forcing amplitude $ F $ is given as $ F \\ge 0 $, and the case $ F=0 $ is trivial (no forcing), we consider $ F  0 $. The stability condition simplifies to:\n$$ \\cos(\\delta^{\\ast})  0 $$\nThe equation $ \\sin(\\delta^{\\ast}) = \\frac{\\omega - \\Omega}{F} $ generally has two distinct solutions for $ \\delta^{\\ast} $ in any interval of length $ 2\\pi $, provided $ |\\omega - \\Omega|  F $. Let $ C = \\frac{\\omega - \\Omega}{F} $.\n\nThe first solution is the principal value, given by the arcsin function:\n$$ \\delta_1^{\\ast} = \\arcsin(C) = \\arcsin\\left(\\frac{\\omega - \\Omega}{F}\\right) $$\nBy definition, the range of the $ \\arcsin $ function is $ [-\\frac{\\pi}{2}, \\frac{\\pi}{2}] $. For any value $ \\theta \\in [-\\frac{\\pi}{2}, \\frac{\\pi}{2}] $, its cosine, $ \\cos(\\theta) $, is non-negative ($ \\cos(\\theta) \\ge 0 $). Specifically, if $ |\\omega - \\Omega|  F $, then $ |C|  1 $ and $ \\delta_1^{\\ast} \\in (-\\frac{\\pi}{2}, \\frac{\\pi}{2}) $, which implies $ \\cos(\\delta_1^{\\ast})  0 $. Therefore, the fixed point $ \\delta_1^{\\ast} $ is stable.\n\nThe second solution in the interval $ [-\\frac{\\pi}{2}, \\frac{3\\pi}{2}) $ is:\n$$ \\delta_2^{\\ast} = \\pi - \\delta_1^{\\ast} = \\pi - \\arcsin\\left(\\frac{\\omega - \\Omega}{F}\\right) $$\nThis solution lies in the range $ [\\frac{\\pi}{2}, \\frac{3\\pi}{2}] $. For any value $ \\theta \\in [\\frac{\\pi}{2}, \\frac{3\\pi}{2}] $, its cosine, $ \\cos(\\theta) $, is non-positive ($ \\cos(\\theta) \\le 0 $). Specifically, if $ |\\omega - \\Omega|  F $, then $ \\delta_2^{\\ast} \\in (\\frac{\\pi}{2}, \\frac{3\\pi}{2}) $, which implies $ \\cos(\\delta_2^{\\ast})  0 $. For this fixed point, the stability criterion becomes $ g'(\\delta_2^{\\ast}) = -F \\cos(\\delta_2^{\\ast})  0 $. Therefore, the fixed point $ \\delta_2^{\\ast} $ is unstable.\n\nThe problem asks for the stable locked phase difference. Based on the linear stability analysis, this is the solution $ \\delta_1^{\\ast} $.\n\nThe stable locked phase difference is therefore:\n$$ \\delta^{\\ast} = \\arcsin\\left(\\frac{\\omega - \\Omega}{F}\\right) $$\nThis expression gives the constant phase difference, in radians, that the oscillator maintains with respect to the external drive when it is entrained.",
            "answer": "$$ \\boxed{\\arcsin\\left(\\frac{\\omega - \\Omega}{F}\\right)} $$"
        },
        {
            "introduction": "While a single forced oscillator is instructive, many biological phenomena arise from the collective behavior of large populations of interacting units. This practice invites you to simulate the celebrated Kuramoto model, a paradigm for emergent synchronization in networks of oscillators . You will numerically estimate the critical coupling strength at which the system spontaneously transitions from incoherence to collective order, gaining hands-on experience with concepts like order parameters and finite-size effects.",
            "id": "4026154",
            "problem": "You are asked to write a complete, runnable program that estimates the onset of partial synchronization in a network of phase oscillators in the Kuramoto model, using a principled numerical procedure grounded in well-tested definitions from dynamical systems theory. Consider a population of $N$ phase oscillators with phases $\\theta_{i}(t)$ and natural frequencies $\\omega_{i}$ drawn independently from a Lorentzian (Cauchy) distribution centered at $\\omega_{0} = 0$ with half-width at half-maximum $\\Delta  0$, i.e., the probability density is\n$$\ng(\\omega) = \\frac{\\Delta}{\\pi}\\,\\frac{1}{\\omega^{2} + \\Delta^{2}}.\n$$\nThe dynamics are the Kuramoto phase oscillator equations\n$$\n\\frac{d\\theta_{i}}{dt} = \\omega_{i} + \\frac{K}{N}\\sum_{j=1}^{N}\\sin\\!\\big(\\theta_{j} - \\theta_{i}\\big),\n$$\nwhere $K \\ge 0$ is the global coupling strength and angles are in radians. Define the complex order parameter by\n$$\nre^{i\\psi} = \\frac{1}{N}\\sum_{j=1}^{N} e^{i\\theta_{j}},\n$$\nwhere $r \\in [0,1]$ measures phase coherence and $\\psi$ is the mean phase. Your task is to numerically estimate the critical coupling $K_{c}$ at which the system transitions from an incoherent state (with $r \\approx 0$ for large $N$) to a partially synchronized state (with $r  0$), under the following specifications.\n\nStarting from the above definitions and laws, implement a direct time-domain simulation of the oscillator dynamics to obtain the time-averaged order parameter $\\langle r \\rangle_{t}$ for a given $K$, where the time average excludes an initial transient. Use angles in radians throughout, and a uniform random initialization of $\\theta_{i}(0)$ over $[0,2\\pi)$. To ensure scientific realism in the detection of onset, define a numerical detection threshold that scales with finite-size fluctuations; set a threshold\n$$\nr_{\\mathrm{th}} = \\frac{c}{\\sqrt{N}},\n$$\nwith $c$ a fixed constant. Define $K_{c}$ numerically as the smallest $K$ for which the time-averaged order parameter $\\langle r \\rangle_{t}$ strictly exceeds $r_{\\mathrm{th}}$. Use an adaptive search strategy that first brackets the crossing on a coarse grid and then refines the estimate by bisection on $K$.\n\nYour program must adhere to the following numerical choices:\n- Use explicit Euler time stepping with time step $dt = 0.02$, total integration time $T = 25.0$, and transient time $T_{\\mathrm{trans}} = 10.0$ discarded before averaging $\\langle r \\rangle_{t}$.\n- Use $c = 3.5$ in the threshold $r_{\\mathrm{th}}$.\n- To sample $\\omega_{i}$ from the Lorentzian distribution, use inverse-transform sampling:\n$$\n\\omega_{i} = \\Delta \\tan\\!\\big(\\pi(u_{i} - \\tfrac{1}{2})\\big),\n$$\nwith $u_{i}$ independent and uniformly distributed in $[0,1]$. Center $\\omega_{0} = 0$ for all tests.\n- For the adaptive search over $K$, use a coarse grid with $M = 24$ evenly spaced points on $[0, K_{\\max}]$, where $K_{\\max} = 6\\Delta$, to bracket the crossing; if bracketed, perform $J = 12$ bisection iterations to refine $K_{c}$.\n- Use the same random seed per test case across all $K$ values to keep the network realization fixed when scanning $K$. The program should internally fix these seeds as specified in the test suite below.\n\nImplement the order parameter and dynamics exactly as defined above, and ensure angles are treated in radians. There are no physical units beyond radians for angles; time and coupling are dimensionless in this formulation. All mathematical calculations must directly follow from the provided definitions and must not invoke any unprovided shortcut expressions.\n\nTest Suite:\nEstimate $K_{c}$ for the following test cases, each specified by $(N,\\Delta,\\text{seed})$:\n- Case $1$: $(N,\\Delta,\\text{seed}) = (256, 0.5, 1337)$.\n- Case $2$: $(N,\\Delta,\\text{seed}) = (512, 1.0, 2021)$.\n- Case $3$: $(N,\\Delta,\\text{seed}) = (1024, 2.0, 7)$.\n- Edge Case $4$: $(N,\\Delta,\\text{seed}) = (64, 0.2, 99)$.\n\nAnswer Specification:\n- For each test case, return the estimated critical coupling $K_{c}$ as a float, rounded to three decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases, for example, $\\,[K_{c}^{(1)}, K_{c}^{(2)}, K_{c}^{(3)}, K_{c}^{(4)}]\\,.$\n- The output must be exactly one line with the bracketed list and no additional text.\n\nYour program must be self-contained, require no input, and run deterministically given the fixed seeds above. Angles must be in radians; report the floats with three decimal places and no units.",
            "solution": "The problem statement has been analyzed and is determined to be valid. It is scientifically grounded, well-posed, objective, and provides a complete and consistent set of specifications for a numerical experiment. The task is to estimate the critical coupling strength $K_c$ for the onset of synchronization in a network of Kuramoto oscillators. This will be achieved by direct time-domain simulation and a systematic search algorithm.\n\nThe solution is constructed based on the following principles:\n\n1.  **The Kuramoto Model and Synchronization**\n    The system consists of $N$ phase oscillators, where the state of each oscillator $i$ is described by its phase angle $\\theta_i(t)$. The time evolution of each phase is governed by the Kuramoto equation:\n    $$\n    \\frac{d\\theta_{i}}{dt} = \\omega_{i} + \\frac{K}{N}\\sum_{j=1}^{N}\\sin(\\theta_{j} - \\theta_{i})\n    $$\n    Here, $\\omega_i$ is the intrinsic natural frequency of oscillator $i$, drawn from a Lorentzian distribution $g(\\omega)$ centered at $\\omega_0=0$ with half-width $\\Delta$. The term $\\frac{K}{N}\\sum\\limits_{j=1}^{N}\\sin(\\theta_{j} - \\theta_{i})$ represents the influence of all other oscillators on oscillator $i$, with $K \\ge 0$ being the uniform coupling strength.\n    The collective behavior of the network is quantified by the complex order parameter $z(t) = r(t)e^{i\\psi(t)}$, defined as:\n    $$\n    re^{i\\psi} = \\frac{1}{N}\\sum_{j=1}^{N} e^{i\\theta_{j}}\n    $$\n    The magnitude $r \\in [0,1]$ measures the degree of phase coherence. For an incoherent state, the phases are randomly distributed, and $r \\approx 0$ for large $N$. For a partially synchronized state, a macroscopic fraction of oscillators rotate together, resulting in $r  0$. The critical coupling $K_c$ is the value of $K$ at which the system transitions from incoherence to partial synchronization.\n\n2.  **Efficient Numerical Integration**\n    The system of differential equations is solved numerically using the explicit Euler method. A direct evaluation of the summation term in the dynamics for each oscillator has a computational complexity of $O(N^2)$ per time step, which is inefficient. The summation can be expressed in terms of the order parameter, reducing the complexity to $O(N)$. The coupling term is rewritten as:\n    $$\n    \\frac{K}{N}\\sum_{j=1}^{N}\\sin(\\theta_{j} - \\theta_{i}) = \\frac{K}{N} \\text{Im}\\left( \\sum_{j=1}^{N} e^{i(\\theta_{j}-\\theta_{i})} \\right) = \\frac{K}{N} \\text{Im}\\left( e^{-i\\theta_{i}} \\sum_{j=1}^{N} e^{i\\theta_{j}} \\right)\n    $$\n    Substituting the definition of the order parameter, this becomes:\n    $$\n    \\frac{K}{N} \\text{Im}\\left( e^{-i\\theta_{i}} (Nre^{i\\psi}) \\right) = K \\text{Im}\\left( r e^{i(\\psi - \\theta_{i})} \\right) = K r \\sin(\\psi - \\theta_{i})\n    $$\n    The equation of motion simplifies to an efficient form:\n    $$\n    \\frac{d\\theta_{i}}{dt} = \\omega_{i} + K r(t) \\sin(\\psi(t) - \\theta_{i}(t))\n    $$\n    The explicit Euler discretization with a time step $dt$ is therefore:\n    $$\n    \\theta_i(t+\\Delta t) = \\theta_i(t) + dt \\left( \\omega_{i} + K r(t) \\sin(\\psi(t) - \\theta_{i}(t)) \\right)\n    $$\n    The simulation for a given $K$ will run for a total time $T = 25.0$ with a time step $dt=0.02$.\n\n3.  **Detection of Synchronization Onset**\n    For a finite system of size $N$, statistical fluctuations will cause the order parameter $r$ to be non-zero even in the incoherent state, typically scaling as $r \\sim O(1/\\sqrt{N})$. To distinguish true partial synchronization from these finite-size effects, a numerical threshold is established:\n    $$\n    r_{\\mathrm{th}} = \\frac{c}{\\sqrt{N}}\n    $$\n    With the specified constant $c=3.5$, this threshold provides a robust criterion for the onset of synchronization. The critical coupling $K_c$ is then defined as the smallest value of $K$ for which the time-averaged order parameter, $\\langle r \\rangle_t$, strictly exceeds this threshold. The time average is computed over the latter part of the simulation, from $T_{\\mathrm{trans}} = 10.0$ to $T = 25.0$, to exclude initial transient behavior.\n\n4.  **Adaptive Search for Critical Coupling $K_c$**\n    An efficient, two-stage adaptive search strategy is employed to find $K_c$.\n    - **Bracketing:** The search range for $K$ is set to $[0, K_{\\max}]$, where $K_{\\max} = 6\\Delta$. This range is divided into a coarse grid of $M=24$ points. For each point $K$ on the grid, a full simulation is run to compute $\\langle r \\rangle_t$. The algorithm then identifies the first pair of adjacent grid points, $(K_{low}, K_{high})$, that bracket the transition, i.e., where $\\langle r \\rangle_t(K_{low}) \\le r_{\\mathrm{th}}$ and $\\langle r \\rangle_t(K_{high})  r_{\\mathrm{th}}$.\n    - **Bisection:** Once the bracket $[K_{low}, K_{high}]$ is found, the bisection method is used to refine the estimate of $K_c$. This iterative process is repeated for $J=12$ steps. In each step, the midpoint $K_{mid} = (K_{low} + K_{high})/2$ is tested. If $\\langle r \\rangle_t(K_{mid})  r_{\\mathrm{th}}$, the new upper bound becomes $K_{mid}$; otherwise, the new lower bound becomes $K_{mid}$. After $J$ iterations, the final upper bound of the search interval is taken as the estimate for $K_c$.\n\n5.  **Reproducibility and Implementation**\n    To ensure deterministic and reproducible results, the random number generator is seeded for each test case. Both the natural frequencies $\\omega_i$, generated via inverse transform sampling, and the initial phases $\\theta_i(0)$, are generated once per test case and reused for all simulations within that case's $K$-scan. This procedure ensures that the observed changes in $\\langle r \\rangle_t$ are due solely to the variation in $K$, not random variations in the network realization. Vectorized operations from the `numpy` library are used to implement the simulation efficiently.",
            "answer": "```python\nimport numpy as np\n\ndef simulate(K, N, omega, theta_0, dt, T, T_trans):\n    \"\"\"\n    Simulates the Kuramoto model for a given coupling strength K.\n\n    Args:\n        K (float): The coupling strength.\n        N (int): The number of oscillators.\n        omega (np.ndarray): The array of natural frequencies.\n        theta_0 (np.ndarray): The array of initial phases.\n        dt (float): The time step for integration.\n        T (float): The total simulation time.\n        T_trans (float): The transient time to discard.\n\n    Returns:\n        float: The time-averaged order parameter magnitude r.\n    \"\"\"\n    theta = np.copy(theta_0)\n    \n    n_steps = int(T / dt)\n    n_trans_steps = int(T_trans / dt)\n    \n    r_values = []\n    \n    for step in range(n_steps):\n        # Calculate complex order parameter z = r * exp(i*psi)\n        z = np.mean(np.exp(1j * theta))\n        r = np.abs(z)\n        psi = np.angle(z)\n        \n        # Store r after transient period\n        if step = n_trans_steps:\n            r_values.append(r)\n            \n        # Update phases using Euler method with the O(N) optimization\n        d_theta_dt = omega + K * r * np.sin(psi - theta)\n        theta += d_theta_dt * dt\n        # Keep angles in range [0, 2*pi) for numerical stability, though not strictly required.\n        theta = theta % (2 * np.pi)\n        \n    return np.mean(r_values) if r_values else 0.0\n\ndef find_kc(N, Delta, seed):\n    \"\"\"\n    Finds the critical coupling Kc for a given set of parameters.\n\n    Args:\n        N (int): The number of oscillators.\n        Delta (float): The half-width of the Lorentzian distribution.\n        seed (int): The random seed for reproducibility.\n\n    Returns:\n        float: The estimated critical coupling Kc.\n    \"\"\"\n    # Numerical parameters from the problem description\n    c = 3.5\n    dt = 0.02\n    T = 25.0\n    T_trans = 10.0\n    M = 24  # Coarse grid points\n    J = 12  # Bisection iterations\n    K_max = 6.0 * Delta\n    \n    # Setup reproducible random number generation\n    rng = np.random.default_rng(seed)\n    \n    # Generate fixed network properties (frequencies and initial phases)\n    u = rng.uniform(0.0, 1.0, size=N)\n    omega = Delta * np.tan(np.pi * (u - 0.5))\n    theta_0 = rng.uniform(0.0, 2 * np.pi, size=N)\n    \n    # Define the synchronization threshold\n    r_th = c / np.sqrt(N)\n    \n    # --- Phase 1: Bracketing on a coarse grid ---\n    K_grid = np.linspace(0, K_max, M)\n    r_grid_values = []\n    \n    for K_val in K_grid:\n        avg_r = simulate(K_val, N, omega, theta_0, dt, T, T_trans)\n        r_grid_values.append(avg_r)\n\n    # Check for K_c = 0 case\n    if r_grid_values[0]  r_th:\n        return 0.0\n\n    # Find the bracket [K_low, K_high]\n    K_low, K_high = -1.0, -1.0\n    for i in range(1, M):\n        if r_grid_values[i-1] = r_th and r_grid_values[i]  r_th:\n            K_low = K_grid[i-1]\n            K_high = K_grid[i]\n            break\n    \n    # If no crossing is found, return K_max (transition is outside the search range)\n    if K_low == -1.0:\n        return K_max\n\n    # --- Phase 2: Bisection to refine Kc ---\n    for _ in range(J):\n        K_mid = (K_low + K_high) / 2.0\n        avg_r_mid = simulate(K_mid, N, omega, theta_0, dt, T, T_trans)\n        \n        if avg_r_mid  r_th:\n            K_high = K_mid\n        else:\n            K_low = K_mid\n            \n    # As per definition, Kc is the smallest K where r  r_th.\n    # The bisection narrows the interval [K_low, K_high] containing the transition.\n    # K_high is the upper bound of this interval, representing our refined estimate.\n    return K_high\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Test Suite: (N, Delta, seed)\n    test_cases = [\n        (256, 0.5, 1337),\n        (512, 1.0, 2021),\n        (1024, 2.0, 7),\n        (64, 0.2, 99),\n    ]\n\n    results = []\n    for N, Delta, seed in test_cases:\n        kc_estimate = find_kc(N, Delta, seed)\n        results.append(round(kc_estimate, 3))\n\n    # Format and print the final output as a single line\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "Real-world oscillators, particularly in neuroscience, are invariably subject to noise, which can disrupt or mask synchronization. This final practice immerses you in the realistic scenario of detecting entrainment amidst stochastic fluctuations . By simulating a noisy driven oscillator across a range of parameters, you will map out the famous 'Arnold tongue'—the region where locking is robust—and learn to apply statistical methods to quantify the reliability of your detection.",
            "id": "4026113",
            "problem": "Consider a population-phase reduction of a cortical network modeled as a single effective oscillator subjected to a sinusoidal external drive. The oscillator’s phase $\\theta(t)$ evolves according to the stochastic differential equation (SDE)\n$$\n\\frac{d\\theta}{dt} \\;=\\; \\omega_0 \\;+\\; A \\,\\sin\\!\\big(\\Omega t \\;-\\; \\theta(t)\\big) \\;+\\; \\xi(t),\n$$\nwhere $\\omega_0$ is the intrinsic angular frequency of the unforced cortical oscillator, $A$ is the coupling amplitude of the external drive, $\\Omega$ is the external drive angular frequency, and $\\xi(t)$ is zero-mean Gaussian white noise with autocorrelation $\\langle \\xi(t)\\xi(t')\\rangle = 2D\\,\\delta(t-t')$. The angle unit is radians and the time unit is seconds. The stochastic term models endogenous fluctuations and yields phase diffusion with diffusion coefficient $D$ expressed in $\\mathrm{rad^2/s}$. The external drive is intended to produce entrainment and phase locking; the region in the $(\\Omega, A)$ plane where phase locking occurs is known to form Arnold tongues.\n\nYou will implement a simulated experiment to map entrainment across a small grid of $(\\Omega, A)$ by numerical integration and estimate statistical power for detecting entrainment using the Phase-Locking Value (PLV) and the Rayleigh test for non-uniformity of circular data. For each condition $(\\Omega, A)$, you will run multiple independent trials (replicates) with random initial phases, compute the PLV over time in each trial, apply a significance test, and estimate the statistical power as the fraction of trials that reach significance at a specified level.\n\nDefinitions and measurement procedures to implement:\n- The Phase-Locking Value (PLV) for one trial over a sampled trajectory $\\{\\theta(t_n)\\}_{n=1}^N$ is defined as\n$$\n\\mathrm{PLV} \\;=\\; \\left|\\frac{1}{N}\\sum_{n=1}^{N} e^{\\,i\\,\\big(\\theta(t_n)-\\Omega t_n\\big)}\\right|,\n$$\nwith $i$ the imaginary unit and angles in radians.\n- Under the null hypothesis of uniformly distributed phases, the Rayleigh test statistic is\n$$\nZ \\;=\\; N\\,\\mathrm{PLV}^2,\n$$\nand the $p$-value can be approximated by\n$$\np \\;\\approx\\; e^{-Z}.\n$$\nReject the null when $p  \\alpha$, where $\\alpha$ is the specified significance level.\n\nNumerical integration requirements:\n- Use the Euler–Maruyama method to integrate the SDE. With time step $\\Delta t$, update as\n$$\n\\theta_{n+1} \\;=\\; \\theta_n \\;+\\; \\Big(\\omega_0 \\;+\\; A \\sin\\!\\big(\\Omega t_n - \\theta_n\\big)\\Big)\\,\\Delta t \\;+\\; \\sqrt{2D\\,\\Delta t}\\;\\eta_n,\n$$\nwhere each $\\eta_n$ is independently drawn from a standard normal distribution $\\mathcal{N}(0,1)$.\n- Use angles in radians and angular frequencies in $\\mathrm{rad/s}$. If a frequency $f$ is specified in $\\mathrm{Hz}$, convert to angular frequency by $\\Omega = 2\\pi f$. If a coupling amplitude $a$ is provided in $\\mathrm{Hz}$, convert to angular coupling amplitude by $A = 2\\pi a$ to ensure consistent units in the phase equation.\n\nStatistical power estimation:\n- For each $(\\Omega, A)$ condition, simulate $M$ independent trials. In each trial, draw the initial phase $\\theta(0)$ uniformly from $[0,2\\pi)$ and compute PLV from samples over the full duration.\n- Compute the Rayleigh $p$-value per trial and determine whether it is below $\\alpha$.\n- The statistical power at $(\\Omega, A)$ is the fraction of the $M$ trials that yield $p\\alpha$.\n\nSimulation parameters and units:\n- Time step $\\Delta t$ must be in seconds.\n- Total duration $T$ must be in seconds.\n- Angles must be in radians.\n- Frequencies specified in $\\mathrm{Hz}$ must be converted to $\\mathrm{rad/s}$ as stated.\n- Diffusion coefficient $D$ must be in $\\mathrm{rad^2/s}$.\n- Report statistical power as decimal fractions.\n\nTest suite to implement and evaluate:\n- Use the following three test cases. In each case, the set of stimulus frequencies $\\{f_s\\}$ is in $\\mathrm{Hz}$ and the set of coupling amplitudes $\\{a\\}$ is in $\\mathrm{Hz}$, both to be converted to angular units by multiplication with $2\\pi$ as described:\n\nCase $1$ (general, low noise):\n- Intrinsic frequency $f_0 = 40$ $\\mathrm{Hz}$.\n- Stimulus frequencies $\\{f_s\\} = \\{37, 40, 43\\}$ $\\mathrm{Hz}$.\n- Coupling amplitudes $\\{a\\} = \\{2, 8\\}$ $\\mathrm{Hz}$.\n- Diffusion coefficient $D = 2$ $\\mathrm{rad^2/s}$.\n- Duration $T = 0.8$ $\\mathrm{s}$.\n- Time step $\\Delta t = 0.0005$ $\\mathrm{s}$.\n- Trials per condition $M = 200$.\n- Significance level $\\alpha = 0.05$.\n\nCase $2$ (boundary amplitude):\n- Intrinsic frequency $f_0 = 40$ $\\mathrm{Hz}$.\n- Stimulus frequencies $\\{f_s\\} = \\{37, 40, 43\\}$ $\\mathrm{Hz}$.\n- Coupling amplitudes $\\{a\\} = \\{3\\}$ $\\mathrm{Hz}$.\n- Diffusion coefficient $D = 2$ $\\mathrm{rad^2/s}$.\n- Duration $T = 0.8$ $\\mathrm{s}$.\n- Time step $\\Delta t = 0.0005$ $\\mathrm{s}$.\n- Trials per condition $M = 200$.\n- Significance level $\\alpha = 0.05$.\n\nCase $3$ (high noise, strong drive):\n- Intrinsic frequency $f_0 = 40$ $\\mathrm{Hz}$.\n- Stimulus frequencies $\\{f_s\\} = \\{37, 40, 43\\}$ $\\mathrm{Hz}$.\n- Coupling amplitudes $\\{a\\} = \\{8\\}$ $\\mathrm{Hz}$.\n- Diffusion coefficient $D = 20$ $\\mathrm{rad^2/s}$.\n- Duration $T = 0.8$ $\\mathrm{s}$.\n- Time step $\\Delta t = 0.0005$ $\\mathrm{s}$.\n- Trials per condition $M = 200$.\n- Significance level $\\alpha = 0.05$.\n\nOutput specification:\n- For each case, compute the statistical power for all combinations of $(f_s, a)$ in the specified sets. Inside each case, order the results by increasing coupling amplitude $a$ and, within each $a$, by increasing stimulus frequency $f_s$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where the top-level list contains three inner lists corresponding to the three cases, and each inner list contains the statistical power values (as decimals) in the order specified above. For example, the printed structure must be of the form\n$$\n[\\,[p_{1,1}, p_{1,2}, \\dots],\\; [p_{2,1}, p_{2,2}, \\dots],\\; [p_{3,1}, p_{3,2}, \\dots]\\,],\n$$\nwith no additional text.\n\nEnsure the program is self-contained, uses no external input, and adheres to the execution environment constraints. The final outputs must be decimal fractions (floats) representing statistical power in each condition.",
            "solution": "The problem requires the implementation of a numerical simulation to estimate statistical power for detecting entrainment in a stochastic phase oscillator model. This model represents a cortical population's collective phase dynamics under the influence of an external sinusoidal drive.\n\nThe phase $\\theta(t)$ of the oscillator is governed by the stochastic differential equation (SDE):\n$$\n\\frac{d\\theta}{dt} \\;=\\; \\omega_0 \\;+\\; A \\,\\sin\\!\\big(\\Omega t \\;-\\; \\theta(t)\\big) \\;+\\; \\xi(t)\n$$\nHere, $\\omega_0$ is the oscillator's intrinsic angular frequency, $A$ is the coupling amplitude to the external drive, $\\Omega$ is the angular frequency of the drive, and $\\xi(t)$ represents Gaussian white noise. The noise is characterized by its autocorrelation function $\\langle \\xi(t)\\xi(t')\\rangle = 2D\\,\\delta(t-t')$, where $D$ is the phase diffusion coefficient expressed in $\\mathrm{rad^2/s}$.\n\nTo solve this problem, we will follow a structured, multi-step approach:\n$1$. Discretize the SDE using the Euler-Maruyama method.\n$2$. Implement the specified unit conversions.\n$3$. Define the procedure for calculating the Phase-Locking Value (PLV) from a simulated phase trajectory.\n$4$. Implement the Rayleigh test for statistical significance and the subsequent estimation of statistical power.\n$5$. Systematically run the simulations for all specified test cases and parameter combinations.\n\nStep $1$: Numerical Integration\nThe provided SDE is integrated numerically using the Euler-Maruyama method. Given a time step $\\Delta t$, the phase at time $t_{n+1} = (n+1)\\Delta t$, denoted $\\theta_{n+1}$, is updated from its value at time $t_n = n\\Delta t$, denoted $\\theta_n$, according to the rule:\n$$\n\\theta_{n+1} \\;=\\; \\theta_n \\;+\\; \\Big(\\omega_0 \\;+\\; A \\sin\\!\\big(\\Omega t_n - \\theta_n\\big)\\Big)\\,\\Delta t \\;+\\; \\sqrt{2D\\,\\Delta t}\\;\\eta_n\n$$\nwhere each $\\eta_n$ is an independent random variable drawn from a standard normal distribution, $\\mathcal{N}(0,1)$. The term $\\sqrt{2D\\,\\Delta t}\\;\\eta_n$ represents the Wiener process increment over the interval $\\Delta t$.\n\nStep $2$: Unit Handling\nThe model parameters are given in mixed units. The intrinsic frequency $f_0$, stimulus frequencies $f_s$, and coupling amplitudes $a$ are provided in Hertz ($\\mathrm{Hz}$). The SDE requires angular frequencies and amplitudes in units of $\\mathrm{rad/s}$. Therefore, we apply the following conversions:\n- Intrinsic angular frequency: $\\omega_0 = 2\\pi f_0$\n- Drive angular frequency: $\\Omega = 2\\pi f_s$\n- Drive angular amplitude: $A = 2\\pi a$\nThe diffusion coefficient $D$ is already in the correct units of $\\mathrm{rad^2/s}$, and the time step $\\Delta t$ is in seconds.\n\nStep $3$: Quantifying Entrainment with Phase-Locking Value (PLV)\nEntrainment, or phase locking, occurs when the phase of the oscillator, $\\theta(t)$, follows the phase of the external drive, $\\Omega t$, with a relatively constant phase difference. This relationship is quantified using the Phase-Locking Value (PLV). For a discrete time series of phase values $\\{\\theta(t_n)\\}_{n=1}^N$ sampled over a duration, the PLV is the magnitude of the mean of the complex phase vectors:\n$$\n\\mathrm{PLV} \\;=\\; \\left|\\frac{1}{N}\\sum_{n=1}^{N} e^{\\,i\\,\\big(\\theta(t_n)-\\Omega t_n\\big)}\\right|\n$$\nwhere $i$ is the imaginary unit. A PLV close to $1$ indicates strong and consistent phase locking, while a PLV close to $0$ suggests no phase relationship, consistent with the phase difference being uniformly distributed.\n\nStep $4$: Statistical Power Estimation\nTo determine if the observed phase locking is statistically significant, we use the Rayleigh test. The null hypothesis, $H_0$, is that there is no phase locking, meaning the phase differences $\\phi_n = \\theta(t_n) - \\Omega t_n$ are uniformly distributed on the interval $[0, 2\\pi)$. The Rayleigh test statistic, $Z$, is calculated as:\n$$\nZ \\;=\\; N\\,\\mathrm{PLV}^2\n$$\nwhere $N$ is the number of samples used to compute the PLV. The $p$-value, which is the probability of observing a test statistic at least as extreme as $Z$ under $H_0$, is approximated for large $N$ by:\n$$\np \\;\\approx\\; e^{-Z}\n$$\nFor a given significance level $\\alpha$ (in this case, $\\alpha=0.05$), we reject the null hypothesis if $p  \\alpha$.\n\nStatistical power is the probability of correctly detecting an effect when it is present. We estimate it by simulating $M$ independent trials for each parameter condition $(\\Omega, A)$. The statistical power is then the fraction of these trials that yield a significant result (i.e., $p  \\alpha$):\n$$\n\\text{Power} = \\frac{\\text{Number of trials with } p  \\alpha}{M}\n$$\n\nStep $5$: Simulation Execution\nThe algorithm is executed for the three specified test cases. For each case, we iterate through all combinations of stimulus frequency $f_s$ and coupling amplitude $a$.\n- For each condition $(f_s, a)$:\n  - Convert $f_0, f_s, a$ to their angular counterparts $\\omega_0, \\Omega, A$.\n  - Run $M=200$ trials.\n  - In each trial:\n    - Draw an initial phase $\\theta_0$ from a uniform distribution $U(0, 2\\pi)$.\n    - Simulate the phase trajectory $\\theta_n$ for $N = T/\\Delta t = 0.8 / 0.0005 = 1600$ steps using the Euler-Maruyama update rule.\n    - Compute the PLV using the $N=1600$ samples from $t_1$ to $t_N$.\n    - Calculate the $p$-value using the Rayleigh test statistic.\n    - Count the trial as significant if $p  0.05$.\n  - Compute the power as the fraction of significant trials.\n- The resulting power values are collected and formatted into the nested list structure as required, maintaining the specified ordering by increasing $a$ and, within each $a$, by increasing $f_s$. This process provides a map of statistical power across the tested parameter space, indicating where the external drive is strong enough to produce detectable entrainment against the endogenous noise.",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation_for_condition(f0, fs, a, D, T, dt, M, alpha):\n    \"\"\"\n    Runs a simulation for a single parameter condition to estimate statistical power.\n\n    Args:\n        f0 (float): Intrinsic frequency in Hz.\n        fs (float): Stimulus frequency in Hz.\n        a (float): Coupling amplitude in Hz.\n        D (float): Diffusion coefficient in rad^2/s.\n        T (float): Total simulation duration in seconds.\n        dt (float): Time step in seconds.\n        M (int): Number of trials.\n        alpha (float): Significance level.\n\n    Returns:\n        float: Estimated statistical power.\n    \"\"\"\n    # Convert units from Hz to rad/s\n    omega0 = 2.0 * np.pi * f0\n    Omega = 2.0 * np.pi * fs\n    A = 2.0 * np.pi * a\n\n    # Simulation parameters\n    num_steps = int(T / dt)\n    time_vec = np.linspace(0, T, num_steps + 1)\n\n    # Pre-calculate noise standard deviation for the update step\n    noise_std = np.sqrt(2.0 * D * dt)\n\n    significant_trials = 0\n    for _ in range(M):\n        # Initialize phase trajectory array\n        theta = np.zeros(num_steps + 1)\n        # Initial phase drawn uniformly from [0, 2*pi)\n        theta[0] = np.random.uniform(0, 2.0 * np.pi)\n\n        # Generate all random numbers needed for the trial at once for efficiency\n        eta = np.random.randn(num_steps)\n\n        # Euler-Maruyama integration loop\n        for n in range(num_steps):\n            tn = time_vec[n]\n            deterministic_term = (omega0 + A * np.sin(Omega * tn - theta[n])) * dt\n            stochastic_term = noise_std * eta[n]\n            theta[n + 1] = theta[n] + deterministic_term + stochastic_term\n\n        # Calculate PLV using samples from t_1 to t_N (N = num_steps)\n        # This corresponds to indices 1 to num_steps in the 0-indexed arrays.\n        phase_differences = theta[1:] - Omega * time_vec[1:]\n        plv = np.abs(np.mean(np.exp(1j * phase_differences)))\n\n        # Perform the Rayleigh test\n        N_samples = num_steps\n        Z = N_samples * (plv ** 2)\n        p_value = np.exp(-Z)\n        \n        if p_value  alpha:\n            significant_trials += 1\n            \n    power = significant_trials / M\n    return power\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results in the specified format.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"f0\": 40.0, \"fs_list\": [37.0, 40.0, 43.0], \"a_list\": [2.0, 8.0],\n            \"D\": 2.0, \"T\": 0.8, \"dt\": 0.0005, \"M\": 200, \"alpha\": 0.05\n        },\n        {\n            \"f0\": 40.0, \"fs_list\": [37.0, 40.0, 43.0], \"a_list\": [3.0],\n            \"D\": 2.0, \"T\": 0.8, \"dt\": 0.0005, \"M\": 200, \"alpha\": 0.05\n        },\n        {\n            \"f0\": 40.0, \"fs_list\": [37.0, 40.0, 43.0], \"a_list\": [8.0],\n            \"D\": 20.0, \"T\": 0.8, \"dt\": 0.0005, \"M\": 200, \"alpha\": 0.05\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        case_results = []\n        # Per problem specification, order by increasing 'a' then by increasing 'fs'.\n        # The lists are already sorted, but explicit sorting ensures compliance.\n        a_list_sorted = sorted(case[\"a_list\"])\n        fs_list_sorted = sorted(case[\"fs_list\"])\n\n        for a in a_list_sorted:\n            for fs in fs_list_sorted:\n                power = run_simulation_for_condition(\n                    case[\"f0\"], fs, a, case[\"D\"], case[\"T\"],\n                    case[\"dt\"], case[\"M\"], case[\"alpha\"]\n                )\n                case_results.append(power)\n        all_results.append(case_results)\n        \n    # Format the final output string to exactly match the required structure:\n    # [[p1,p2,...],[pi,...],[pj,...]]\n    inner_lists_str = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    final_output_str = f\"[{','.join(inner_lists_str)}]\"\n    \n    print(final_output_str)\n\n# Execute the main function.\nsolve()\n```"
        }
    ]
}