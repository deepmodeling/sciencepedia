{
    "hands_on_practices": [
        {
            "introduction": "Before simulating complex networks, it is essential to analytically understand the fundamental mechanism of entrainment in its simplest form. This exercise focuses on the canonical model of a weakly forced oscillator, often described by the Adler equation. By working through this problem, you will derive the core mathematical condition for 1:1 frequency locking and learn how to assess the stability of the locked state, providing a rigorous foundation for the concepts of synchronization and phase locking .",
            "id": "4026095",
            "problem": "Consider a single phase-reduced neural oscillator subjected to weak sinusoidal forcing, modeled by the forced phase equation $ \\dot{\\phi}(t) = \\omega + F \\sin\\!\\big(\\Omega t - \\phi(t)\\big) $, where $ \\phi(t) $ is the oscillator phase, $ \\omega $ is the natural frequency of the unforced oscillator, $ F \\ge 0 $ is the forcing amplitude, and $ \\Omega $ is the forcing frequency. The phenomenon of entrainment refers to the long-time evolution in which the oscillator frequency matches the forcing frequency and the phase difference between the oscillator and the drive approaches a time-independent constant. Assume $ 1\\!:\\!1 $ entrainment (frequency locking with zero average phase drift) occurs, and define the phase difference $ \\delta(t) = \\phi(t) - \\Omega t $. Using only standard phase reduction assumptions and linear stability analysis of fixed points for one-dimensional autonomous systems, derive the fixed-point condition that determines the locked phase difference and determine the linear stability of the locked state. Provide, as your final answer, a single closed-form analytic expression for the stable locked phase difference $ \\delta^{\\ast} $ in terms of $ \\omega $, $ \\Omega $, and $ F $. Express the final answer in radians.",
            "solution": "The problem is first validated against the specified criteria.\n\n### Step 1: Extract Givens\n- **Model Equation**: $ \\dot{\\phi}(t) = \\omega + F \\sin\\!\\big(\\Omega t - \\phi(t)\\big) $\n- **Variables**:\n    - $ \\phi(t) $: oscillator phase at time $t$\n    - $ \\omega $: natural frequency of the unforced oscillator\n    - $ F $: forcing amplitude, $F \\ge 0$\n    - $ \\Omega $: forcing frequency\n- **Definitions**:\n    - **Entrainment**: The long-time evolution where the oscillator frequency matches the forcing frequency and the phase difference approaches a time-independent constant.\n    - **Phase Difference**: $ \\delta(t) = \\phi(t) - \\Omega t $\n- **Assumptions**: $ 1\\!:\\!1 $ entrainment occurs.\n- **Task**:\n    1. Derive the fixed-point condition for the locked phase difference.\n    2. Determine the linear stability of the locked state.\n    3. Provide the closed-form analytic expression for the stable locked phase difference, $ \\delta^{\\ast} $.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed for validity:\n- **Scientifically Grounded**: The provided model, $ \\dot{\\phi} = \\omega + F \\sin(\\Omega t - \\phi) $, is a canonical form of the Adler equation. It is a fundamental and widely used model in physics, engineering, and computational neuroscience to study synchronization, phase locking, and entrainment in weakly forced or coupled oscillators. The problem is based on established scientific principles.\n- **Well-Posed**: The problem is clearly stated. It asks for the derivation of a specific quantity ($ \\delta^{\\ast} $) from a given differential equation under the assumption of entrainment. The mathematical structure is that of a first-order non-autonomous ordinary differential equation which can be transformed into an autonomous one, for which standard methods of analysis (fixed-point and stability analysis) apply. A unique, stable solution is expected under the stated conditions.\n- **Objective**: The language is precise and quantitative, free of any subjective or ambiguous terminology.\n- **Completeness and Consistency**: The problem provides all necessary information: the governing equation, definitions of all variables and parameters, and the key assumption of entrainment. There are no contradictions.\n- **Realism**: The model is a standard idealization used in the field. The parameters are generic and do not represent physically impossible values.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is scientifically sound, well-posed, objective, and self-contained. The solution process can proceed.\n\n### Solution Derivation\nThe dynamics of the oscillator phase are given by the equation:\n$$ \\dot{\\phi}(t) = \\omega + F \\sin(\\Omega t - \\phi(t)) $$\nThe problem defines the phase difference as $ \\delta(t) = \\phi(t) - \\Omega t $. We seek to find the dynamics governing $ \\delta(t) $. To do this, we differentiate $ \\delta(t) $ with respect to time $ t $:\n$$ \\dot{\\delta}(t) = \\frac{d}{dt} \\big( \\phi(t) - \\Omega t \\big) = \\dot{\\phi}(t) - \\Omega $$\nSubstituting the expression for $ \\dot{\\phi}(t) $ into this equation gives:\n$$ \\dot{\\delta}(t) = \\big( \\omega + F \\sin(\\Omega t - \\phi(t)) \\big) - \\Omega $$\nThe term inside the sine function can be expressed in terms of $ \\delta(t) $:\n$$ \\Omega t - \\phi(t) = -(\\phi(t) - \\Omega t) = -\\delta(t) $$\nUsing the property of the sine function that $ \\sin(-x) = -\\sin(x) $, the equation for $ \\dot{\\delta}(t) $ becomes:\n$$ \\dot{\\delta}(t) = \\omega - \\Omega - F \\sin(\\delta(t)) $$\nThis is a first-order, autonomous ordinary differential equation for the phase difference $ \\delta(t) $.\n\nThe condition for entrainment, or phase locking, is that the phase difference approaches a time-independent constant value, which we denote as $ \\delta^{\\ast} $. This corresponds to a fixed point of the dynamics for $ \\delta(t) $. A fixed point occurs when $ \\dot{\\delta}(t) = 0 $.\nSetting $ \\dot{\\delta}(t) = 0 $ yields the fixed-point condition:\n$$ 0 = \\omega - \\Omega - F \\sin(\\delta^{\\ast}) $$\nRearranging this equation gives the condition that determines the locked phase difference(s):\n$$ F \\sin(\\delta^{\\ast}) = \\omega - \\Omega $$\n$$ \\sin(\\delta^{\\ast}) = \\frac{\\omega - \\Omega}{F} $$\nFor a real solution for $ \\delta^{\\ast} $ to exist, the value of the right-hand side must be within the range of the sine function, which is $ [-1, 1] $. This leads to the condition for frequency locking:\n$$ \\left| \\frac{\\omega - \\Omega}{F} \\right| \\le 1 \\quad \\implies \\quad |\\omega - \\Omega| \\le F $$\nThe problem statement assumes that entrainment occurs, so we proceed under the assumption that this condition is met.\n\nTo determine the stability of a fixed point $ \\delta^{\\ast} $, we perform a linear stability analysis. Let the right-hand side of the autonomous ODE for $ \\delta $ be $g(\\delta)$:\n$$ g(\\delta) = \\omega - \\Omega - F \\sin(\\delta) $$\nA fixed point $ \\delta^{\\ast} $ is linearly stable if the derivative of $ g(\\delta) $ evaluated at the fixed point is negative, i.e., $ g'(\\delta^{\\ast}) < 0 $. It is unstable if $ g'(\\delta^{\\ast}) > 0 $.\nThe derivative of $ g(\\delta) $ is:\n$$ g'(\\delta) = \\frac{d}{d\\delta} \\big( \\omega - \\Omega - F \\sin(\\delta) \\big) = -F \\cos(\\delta) $$\nThus, for a stable fixed point, we must have:\n$$ g'(\\delta^{\\ast}) = -F \\cos(\\delta^{\\ast}) < 0 $$\nSince the forcing amplitude $ F $ is given as $ F \\ge 0 $, and the case $ F=0 $ is trivial (no forcing), we consider $ F > 0 $. The stability condition simplifies to:\n$$ \\cos(\\delta^{\\ast}) > 0 $$\nThe equation $ \\sin(\\delta^{\\ast}) = \\frac{\\omega - \\Omega}{F} $ generally has two distinct solutions for $ \\delta^{\\ast} $ in any interval of length $ 2\\pi $, provided $ |\\omega - \\Omega| < F $. Let $ C = \\frac{\\omega - \\Omega}{F} $.\n\nThe first solution is the principal value, given by the arcsin function:\n$$ \\delta_1^{\\ast} = \\arcsin(C) = \\arcsin\\left(\\frac{\\omega - \\Omega}{F}\\right) $$\nBy definition, the range of the $ \\arcsin $ function is $ [-\\frac{\\pi}{2}, \\frac{\\pi}{2}] $. For any value $ \\theta \\in [-\\frac{\\pi}{2}, \\frac{\\pi}{2}] $, its cosine, $ \\cos(\\theta) $, is non-negative ($ \\cos(\\theta) \\ge 0 $). Specifically, if $ |\\omega - \\Omega| < F $, then $ |C| < 1 $ and $ \\delta_1^{\\ast} \\in (-\\frac{\\pi}{2}, \\frac{\\pi}{2}) $, which implies $ \\cos(\\delta_1^{\\ast}) > 0 $. Therefore, the fixed point $ \\delta_1^{\\ast} $ is stable.\n\nThe second solution in the interval $ [-\\frac{\\pi}{2}, \\frac{3\\pi}{2}) $ is:\n$$ \\delta_2^{\\ast} = \\pi - \\delta_1^{\\ast} = \\pi - \\arcsin\\left(\\frac{\\omega - \\Omega}{F}\\right) $$\nThis solution lies in the range $ [\\frac{\\pi}{2}, \\frac{3\\pi}{2}] $. For any value $ \\theta \\in [\\frac{\\pi}{2}, \\frac{3\\pi}{2}] $, its cosine, $ \\cos(\\theta) $, is non-positive ($ \\cos(\\theta) \\le 0 $). Specifically, if $ |\\omega - \\Omega| < F $, then $ \\delta_2^{\\ast} \\in (\\frac{\\pi}{2}, \\frac{3\\pi}{2}) $, which implies $ \\cos(\\delta_2^{\\ast}) < 0 $. For this fixed point, the stability criterion becomes $ g'(\\delta_2^{\\ast}) = -F \\cos(\\delta_2^{\\ast}) > 0 $. Therefore, the fixed point $ \\delta_2^{\\ast} $ is unstable.\n\nThe problem asks for the stable locked phase difference. Based on the linear stability analysis, this is the solution $ \\delta_1^{\\ast} $.\n\nThe stable locked phase difference is therefore:\n$$ \\delta^{\\ast} = \\arcsin\\left(\\frac{\\omega - \\Omega}{F}\\right) $$\nThis expression gives the constant phase difference, in radians, that the oscillator maintains with respect to the external drive when it is entrained.",
            "answer": "$$ \\boxed{\\arcsin\\left(\\frac{\\omega - \\Omega}{F}\\right)} $$"
        },
        {
            "introduction": "The one-dimensional phase models we often use are powerful simplifications of oscillators that live in higher-dimensional state spaces with dynamics in both amplitude and phase. This practice delves into the geometric foundation of phase reduction by introducing the concept of isochrons: curves in the state space connecting all points that converge to the limit cycle with the exact same asymptotic phase. By numerically integrating a two-dimensional oscillator, you will verify this defining property and gain a deeper, more intuitive understanding of what the variable 'phase' truly represents .",
            "id": "4026122",
            "problem": "Consider a smooth two-dimensional dynamical system that serves as the normal form of a supercritical Hopf oscillator frequently used in brain modeling and computational neuroscience to describe rhythmic neural activity. Let the state be $(r,\\theta)$ with $r \\ge 0$ representing amplitude and $\\theta \\in \\mathbb{R}$ representing angle in radians, and let the dynamics be governed by\n$$\n\\frac{dr}{dt} = \\lambda r - r^3, \\quad \\frac{d\\theta}{dt} = \\omega - c r^2,\n$$\nwhere $\\lambda > 0$ is a real parameter controlling the amplitude dynamics, $\\omega > 0$ is an angular frequency in radians per second, and $c \\in \\mathbb{R}$ controls nonisochrony. The oscillator possesses an attracting limit cycle at amplitude $r^* = \\sqrt{\\lambda}$ with constant cycle frequency. In the basin of attraction of this limit cycle, each initial condition $(r_0,\\theta_0)$ has an asymptotic phase $\\phi \\in [0,2\\pi)$, and the set of points sharing the same $\\phi$ defines an isochron. The scientifically tested fact we rely on is that for hyperbolic attracting limit cycles, isochrons are the stable manifolds of points on the cycle under the flow, and any two initial conditions on the same isochron converge to the cycle with identical asymptotic phase even if their amplitudes differ.\n\nYour task is to compute asymptotic phase numerically for selected initial conditions and use it to demonstrate the isochron property for this oscillator. You must implement the following requirements in a complete, runnable program:\n\n- Use the dynamical system specified above with parameters $\\lambda = 1.0$ (unitless), $c = 0.7$ (unitless), and $\\omega = 2\\pi \\cdot 1.2$ radians per second. Angles must be handled in radians, time in seconds.\n- For any given initial condition $(r_0,\\theta_0)$, estimate the asymptotic phase $\\phi \\in [0,2\\pi)$ numerically by integrating the system forward in time to a sufficiently large final time $t_{\\mathrm{end}}$ so that the trajectory is effectively on the limit cycle, and then computing the phase relative to the cycle. Your algorithm must be purely numerical and must not use any closed-form target expression for $\\phi$.\n- Define a tolerance $\\varepsilon = 1\\times 10^{-3}$ (in radians) for deciding equality of phases via minimal angular distance on the unit circle.\n\nTest Suite:\nEvaluate the following four test pairs of initial conditions, each pair consisting of two initial conditions. For each pair, compute the two asymptotic phases and output a boolean indicating whether they match within tolerance $\\varepsilon$. The four pairs are:\n\n1. Pair A (different amplitudes, constructed to lie on the same isochron):\n   - $(r_1,\\theta_1) = (0.5, 1.0)$,\n   - $(r_2,\\theta_2) = (2.0, 1.0 + 0.7(\\ln 2.0 - \\ln 0.5))$.\n2. Pair B (widely different amplitudes, constructed to lie on the same isochron):\n   - $(r_1,\\theta_1) = (0.1, 2.0)$,\n   - $(r_2,\\theta_2) = (3.0, 2.0 + 0.7(\\ln 3.0 - \\ln 0.1))$.\n3. Pair C (same amplitude but different angles, not on the same isochron):\n   - $(r_1,\\theta_1) = (0.5, 1.0)$,\n   - $(r_2,\\theta_2) = (0.5, 1.3)$.\n4. Pair D (one on-cycle amplitude and one far off-cycle amplitude, constructed to lie on the same isochron):\n   - $(r_1,\\theta_1) = (1.0, 0.7)$,\n   - $(r_2,\\theta_2) = (10.0, 0.7 + 0.7(\\ln 10.0 - \\ln 1.0))$.\n\nAll angles above are in radians, and $\\ln$ denotes the natural logarithm. Your numerical integrator must use scientifically reasonable tolerances to ensure sufficient accuracy for deciding phase equality at the specified $\\varepsilon$.\n\nAnswer Specification:\n- For each pair, compute a boolean indicating whether the two numerically estimated asymptotic phases are equal within $\\varepsilon$ when compared using minimal angular distance modulo $2\\pi$.\n- The final output must be a single line containing a comma-separated list of these four booleans enclosed in square brackets, for example, $[b_1,b_2,b_3,b_4]$, where each $b_i$ is either $\\mathrm{True}$ or $\\mathrm{False}$.\n\nYour program must produce exactly one line in the specified format and must not require any user input or external resources. Angles must be in radians, time in seconds, and any numerical result must be unit-consistent with these choices.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded, well-posed, objective, and contains all necessary information to proceed with a solution. The system described is the normal form for a supercritical Hopf bifurcation in polar coordinates, a canonical model for limit cycle oscillators in various scientific fields, including computational neuroscience. The concepts of asymptotic phase and isochrons are correctly defined, and the test cases are constructed consistently with the analytical theory of isochrons for this specific system.\n\nThe task is to numerically verify the isochron property for given pairs of initial conditions. An isochron is the set of all initial conditions whose trajectories converge to the limit cycle with the same asymptotic phase. We will implement a numerical procedure to estimate the asymptotic phase for each initial condition and then compare the phases for each pair.\n\nThe dynamical system is given by the following ordinary differential equations (ODEs) for the state $(r, \\theta)$, where $r$ is the amplitude and $\\theta$ is the phase angle:\n$$\n\\frac{dr}{dt} = \\lambda r - r^3\n$$\n$$\n\\frac{d\\theta}{dt} = \\omega - c r^2\n$$\nThe parameters are specified as $\\lambda = 1.0$, $c = 0.7$, and $\\omega = 2\\pi \\cdot 1.2$.\nFor $\\lambda > 0$, the amplitude equation has a stable fixed point at $r^* = \\sqrt{\\lambda}$. This corresponds to a stable limit cycle of radius $r^* = \\sqrt{1.0} = 1.0$. The angular frequency of oscillation on this limit cycle is constant and given by:\n$$\n\\Omega = \\frac{d\\theta}{dt}\\bigg|_{r=r^*} = \\omega - c(r^*)^2 = \\omega - c\\lambda\n$$\n\nOur method for numerically estimating the asymptotic phase $\\phi$ for an initial condition $(r_0, \\theta_0)$ is based on the definition of asymptotic phase. For any trajectory $(r(t), \\theta(t))$ that starts in the basin of attraction of the limit cycle, its phase angle asymptotically approaches a uniformly rotating phase plus a constant offset:\n$$\n\\lim_{t \\to \\infty} [\\theta(t) - (\\Omega t + \\phi)] = 0\n$$\nThis implies that for a sufficiently large final time $t_{\\mathrm{end}}$, we can approximate the asymptotic phase $\\phi$ as:\n$$\n\\phi \\approx \\theta(t_{\\mathrm{end}}) - \\Omega t_{\\mathrm{end}}\n$$\nThe result is then normalized to the interval $[0, 2\\pi)$.\n\nTo implement this, we must first choose a suitable final time $t_{\\mathrm{end}}$. The convergence of the amplitude $r(t)$ to the limit cycle radius $r^*=1$ is governed by the equation $\\frac{dr}{dt} = r(1-r^2)$. The characteristic time scale for this convergence is on the order of $1/(2\\lambda) = 0.5$ seconds. Choosing a final time $t_{\\mathrm{end}}$ that is many multiples of this time scale, such as $t_{\\mathrm{end}}=50.0$ seconds, ensures that the trajectory's amplitude $r(t_{\\mathrm{end}})$ is computationally indistinguishable from $r^*=1.0$.\n\nThe core of the algorithm is as follows:\n1.  For each initial condition $(r_0, \\theta_0)$ in a given pair, we numerically integrate the system of ODEs from $t=0$ to $t=t_{\\mathrm{end}}$. We will use the `scipy.integrate.solve_ivp` function with high-precision tolerances (e.g., relative tolerance `rtol`$=1 \\times 10^{-8}$ and absolute tolerance `atol`$=1 \\times 10^{-10}$) to ensure the numerical error is significantly smaller than the comparison tolerance $\\varepsilon$.\n2.  From the integration result, we extract the final phase $\\theta(t_{\\mathrm{end}})$.\n3.  We calculate the limit cycle frequency $\\Omega = \\omega - c\\lambda$.\n4.  We compute the estimated asymptotic phase $\\phi$ for each initial condition using the formula $\\phi = (\\theta(t_{\\mathrm{end}}) - \\Omega t_{\\mathrm{end}}) \\pmod{2\\pi}$.\n\nOnce the two asymptotic phases for a pair, $\\phi_1$ and $\\phi_2$, have been estimated, we must compare them. Two phases are considered equal if their minimal angular distance on the unit circle is less than the specified tolerance $\\varepsilon = 1 \\times 10^{-3}$ radians. The minimal angular distance $\\Delta\\phi$ can be robustly calculated as:\n$$\n\\Delta\\phi = |\\text{atan2}(\\sin(\\phi_1 - \\phi_2), \\cos(\\phi_1 - \\phi_2))|\n$$\nThe pair of initial conditions is deemed to lie on the same isochron if $\\Delta\\phi < \\varepsilon$.\n\nThis procedure will be applied to each of the four test pairs provided in the problem statement. For pairs A, B, and D, the initial conditions have been analytically constructed to lie on the same isochron. Therefore, we expect the numerical procedure to yield `True` (phases are equal). For pair C, the initial conditions are explicitly different in a way that places them on different isochrons, so we expect the result to be `False`. The program will output a list of these four boolean results.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Computes and compares asymptotic phases for a Hopf oscillator to test the\n    isochron property.\n    \"\"\"\n    # System parameters\n    lambda_val = 1.0\n    c_val = 0.7\n    omega_val = 2.0 * np.pi * 1.2\n\n    # Comparison tolerance\n    epsilon = 1.0e-3\n    \n    # Numerical integration parameters\n    t_end = 50.0\n    rtol = 1e-9\n    atol = 1e-12\n\n    # Define the dynamical system for the integrator\n    def hopf_oscillator(t, y):\n        \"\"\"\n        Defines the ODEs for the supercritical Hopf oscillator in polar coordinates.\n        y[0] = r (amplitude)\n        y[1] = theta (angle)\n        \"\"\"\n        r, theta = y\n        dr_dt = lambda_val * r - r**3\n        dtheta_dt = omega_val - c_val * r**2\n        return [dr_dt, dtheta_dt]\n\n    # Limit cycle properties\n    r_star = np.sqrt(lambda_val)\n    Omega_lc = omega_val - c_val * r_star**2\n\n    def compute_asymptotic_phase(r0, theta0):\n        \"\"\"\n        Numerically integrates the system to find the asymptotic phase.\n        The algorithm is purely numerical and relies on the definition:\n        phi = lim_{t->inf} (theta(t) - Omega * t)\n        \"\"\"\n        y0 = [r0, theta0]\n        # Integrate the ODE from t=0 to t_end\n        sol = solve_ivp(\n            hopf_oscillator, \n            [0, t_end], \n            y0, \n            rtol=rtol, \n            atol=atol,\n            method='RK45'\n        )\n        # Extract the final state\n        theta_end = sol.y[1, -1]\n        \n        # Calculate asymptotic phase and normalize to [0, 2*pi)\n        phi = (theta_end - Omega_lc * t_end) % (2.0 * np.pi)\n        return phi\n\n    def are_phases_equal(phi1, phi2):\n        \"\"\"\n        Compares two phases using the minimal angular distance on the unit circle.\n        \"\"\"\n        # Calculate the signed difference\n        delta_phi = phi1 - phi2\n        \n        # atan2(sin(d), cos(d)) maps the difference to [-pi, pi], its absolute\n        # value is the minimal distance on the circle in [0, pi].\n        distance = np.abs(np.arctan2(np.sin(delta_phi), np.cos(delta_phi)))\n        \n        return distance < epsilon\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        # Pair A\n        ((0.5, 1.0), \n         (2.0, 1.0 + c_val * (np.log(2.0) - np.log(0.5)))),\n        # Pair B\n        ((0.1, 2.0), \n         (3.0, 2.0 + c_val * (np.log(3.0) - np.log(0.1)))),\n        # Pair C\n        ((0.5, 1.0), \n         (0.5, 1.3)),\n        # Pair D\n        ((1.0, 0.7), \n         (10.0, 0.7 + c_val * (np.log(10.0) - np.log(1.0))))\n    ]\n\n    results = []\n    for ic1, ic2 in test_cases:\n        r1_0, theta1_0 = ic1\n        r2_0, theta2_0 = ic2\n        \n        # Compute asymptotic phases for both initial conditions\n        phi1 = compute_asymptotic_phase(r1_0, theta1_0)\n        phi2 = compute_asymptotic_phase(r2_0, theta2_0)\n        \n        # Compare the phases and store the boolean result\n        results.append(are_phases_equal(phi1, phi2))\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Real biological oscillators are inevitably noisy, which complicates the perfect phase locking seen in deterministic models. This practice applies the principles of entrainment to the more realistic challenge of detecting synchronization in a noisy system. You will conduct a simulated experiment to map the \"Arnold tongue\"—the region in the parameter space of forcing frequency and amplitude where the oscillator entrains to the drive—and learn to use statistical tools like the Phase-Locking Value (PLV) to quantify your findings, a core skill for analyzing both experimental and computational data .",
            "id": "4026113",
            "problem": "Consider a population-phase reduction of a cortical network modeled as a single effective oscillator subjected to a sinusoidal external drive. The oscillator’s phase $\\theta(t)$ evolves according to the stochastic differential equation (SDE)\n$$\n\\frac{d\\theta}{dt} \\;=\\; \\omega_0 \\;+\\; A \\,\\sin\\!\\big(\\Omega t \\;-\\; \\theta(t)\\big) \\;+\\; \\xi(t),\n$$\nwhere $\\omega_0$ is the intrinsic angular frequency of the unforced cortical oscillator, $A$ is the coupling amplitude of the external drive, $\\Omega$ is the external drive angular frequency, and $\\xi(t)$ is zero-mean Gaussian white noise with autocorrelation $\\langle \\xi(t)\\xi(t')\\rangle = 2D\\,\\delta(t-t')$. The angle unit is radians and the time unit is seconds. The stochastic term models endogenous fluctuations and yields phase diffusion with diffusion coefficient $D$ expressed in $\\mathrm{rad^2/s}$. The external drive is intended to produce entrainment and phase locking; the region in the $(\\Omega, A)$ plane where phase locking occurs is known to form Arnold tongues.\n\nYou will implement a simulated experiment to map entrainment across a small grid of $(\\Omega, A)$ by numerical integration and estimate statistical power for detecting entrainment using the Phase-Locking Value (PLV) and the Rayleigh test for non-uniformity of circular data. For each condition $(\\Omega, A)$, you will run multiple independent trials (replicates) with random initial phases, compute the PLV over time in each trial, apply a significance test, and estimate the statistical power as the fraction of trials that reach significance at a specified level.\n\nDefinitions and measurement procedures to implement:\n- The Phase-Locking Value (PLV) for one trial over a sampled trajectory $\\{\\theta(t_n)\\}_{n=1}^N$ is defined as\n$$\n\\mathrm{PLV} \\;=\\; \\left|\\frac{1}{N}\\sum_{n=1}^{N} e^{\\,i\\,\\big(\\theta(t_n)-\\Omega t_n\\big)}\\right|,\n$$\nwith $i$ the imaginary unit and angles in radians.\n- Under the null hypothesis of uniformly distributed phases, the Rayleigh test statistic is\n$$\nZ \\;=\\; N\\,\\mathrm{PLV}^2,\n$$\nand the $p$-value can be approximated by\n$$\np \\;\\approx\\; e^{-Z}.\n$$\nReject the null when $p < \\alpha$, where $\\alpha$ is the specified significance level.\n\nNumerical integration requirements:\n- Use the Euler–Maruyama method to integrate the SDE. With time step $\\Delta t$, update as\n$$\n\\theta_{n+1} \\;=\\; \\theta_n \\;+\\; \\Big(\\omega_0 \\;+\\; A \\sin\\!\\big(\\Omega t_n - \\theta_n\\big)\\Big)\\,\\Delta t \\;+\\; \\sqrt{2D\\,\\Delta t}\\;\\eta_n,\n$$\nwhere each $\\eta_n$ is independently drawn from a standard normal distribution $\\mathcal{N}(0,1)$.\n- Use angles in radians and angular frequencies in $\\mathrm{rad/s}$. If a frequency $f$ is specified in $\\mathrm{Hz}$, convert to angular frequency by $\\Omega = 2\\pi f$. If a coupling amplitude $a$ is provided in $\\mathrm{Hz}$, convert to angular coupling amplitude by $A = 2\\pi a$ to ensure consistent units in the phase equation.\n\nStatistical power estimation:\n- For each $(\\Omega, A)$ condition, simulate $M$ independent trials. In each trial, draw the initial phase $\\theta(0)$ uniformly from $[0,2\\pi)$ and compute PLV from samples over the full duration.\n- Compute the Rayleigh $p$-value per trial and determine whether it is below $\\alpha$.\n- The statistical power at $(\\Omega, A)$ is the fraction of the $M$ trials that yield $p<\\alpha$.\n\nSimulation parameters and units:\n- Time step $\\Delta t$ must be in seconds.\n- Total duration $T$ must be in seconds.\n- Angles must be in radians.\n- Frequencies specified in $\\mathrm{Hz}$ must be converted to $\\mathrm{rad/s}$ as stated.\n- Diffusion coefficient $D$ must be in $\\mathrm{rad^2/s}$.\n- Report statistical power as decimal fractions.\n\nTest suite to implement and evaluate:\n- Use the following three test cases. In each case, the set of stimulus frequencies $\\{f_s\\}$ is in $\\mathrm{Hz}$ and the set of coupling amplitudes $\\{a\\}$ is in $\\mathrm{Hz}$, both to be converted to angular units by multiplication with $2\\pi$ as described:\n\nCase $1$ (general, low noise):\n- Intrinsic frequency $f_0 = 40$ $\\mathrm{Hz}$.\n- Stimulus frequencies $\\{f_s\\} = \\{37, 40, 43\\}$ $\\mathrm{Hz}$.\n- Coupling amplitudes $\\{a\\} = \\{2, 8\\}$ $\\mathrm{Hz}$.\n- Diffusion coefficient $D = 2$ $\\mathrm{rad^2/s}$.\n- Duration $T = 0.8$ $\\mathrm{s}$.\n- Time step $\\Delta t = 0.0005$ $\\mathrm{s}$.\n- Trials per condition $M = 200$.\n- Significance level $\\alpha = 0.05$.\n\nCase $2$ (boundary amplitude):\n- Intrinsic frequency $f_0 = 40$ $\\mathrm{Hz}$.\n- Stimulus frequencies $\\{f_s\\} = \\{37, 40, 43\\}$ $\\mathrm{Hz}$.\n- Coupling amplitudes $\\{a\\} = \\{3\\}$ $\\mathrm{Hz}$.\n- Diffusion coefficient $D = 2$ $\\mathrm{rad^2/s}$.\n- Duration $T = 0.8$ $\\mathrm{s}$.\n- Time step $\\Delta t = 0.0005$ $\\mathrm{s}$.\n- Trials per condition $M = 200$.\n- Significance level $\\alpha = 0.05$.\n\nCase $3$ (high noise, strong drive):\n- Intrinsic frequency $f_0 = 40$ $\\mathrm{Hz}$.\n- Stimulus frequencies $\\{f_s\\} = \\{37, 40, 43\\}$ $\\mathrm{Hz}$.\n- Coupling amplitudes $\\{a\\} = \\{8\\}$ $\\mathrm{Hz}$.\n- Diffusion coefficient $D = 20$ $\\mathrm{rad^2/s}$.\n- Duration $T = 0.8$ $\\mathrm{s}$.\n- Time step $\\Delta t = 0.0005$ $\\mathrm{s}$.\n- Trials per condition $M = 200$.\n- Significance level $\\alpha = 0.05$.\n\nOutput specification:\n- For each case, compute the statistical power for all combinations of $(f_s, a)$ in the specified sets. Inside each case, order the results by increasing coupling amplitude $a$ and, within each $a$, by increasing stimulus frequency $f_s$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where the top-level list contains three inner lists corresponding to the three cases, and each inner list contains the statistical power values (as decimals) in the order specified above. For example, the printed structure must be of the form\n$$\n[\\,[p_{1,1}, p_{1,2}, \\dots],\\; [p_{2,1}, p_{2,2}, \\dots],\\; [p_{3,1}, p_{3,2}, \\dots]\\,],\n$$\nwith no additional text.\n\nEnsure the program is self-contained, uses no external input, and adheres to the execution environment constraints. The final outputs must be decimal fractions (floats) representing statistical power in each condition.",
            "solution": "The problem requires the implementation of a numerical simulation to estimate statistical power for detecting entrainment in a stochastic phase oscillator model. This model represents a cortical population's collective phase dynamics under the influence of an external sinusoidal drive.\n\nThe phase $\\theta(t)$ of the oscillator is governed by the stochastic differential equation (SDE):\n$$\n\\frac{d\\theta}{dt} \\;=\\; \\omega_0 \\;+\\; A \\,\\sin\\!\\big(\\Omega t \\;-\\; \\theta(t)\\big) \\;+\\; \\xi(t)\n$$\nHere, $\\omega_0$ is the oscillator's intrinsic angular frequency, $A$ is the coupling amplitude to the external drive, $\\Omega$ is the angular frequency of the drive, and $\\xi(t)$ represents Gaussian white noise. The noise is characterized by its autocorrelation function $\\langle \\xi(t)\\xi(t')\\rangle = 2D\\,\\delta(t-t')$, where $D$ is the phase diffusion coefficient expressed in $\\mathrm{rad^2/s}$.\n\nTo solve this problem, we will follow a structured, multi-step approach:\n$1$. Discretize the SDE using the Euler-Maruyama method.\n$2$. Implement the specified unit conversions.\n$3$. Define the procedure for calculating the Phase-Locking Value (PLV) from a simulated phase trajectory.\n$4$. Implement the Rayleigh test for statistical significance and the subsequent estimation of statistical power.\n$5$. Systematically run the simulations for all specified test cases and parameter combinations.\n\nStep $1$: Numerical Integration\nThe provided SDE is integrated numerically using the Euler-Maruyama method. Given a time step $\\Delta t$, the phase at time $t_{n+1} = (n+1)\\Delta t$, denoted $\\theta_{n+1}$, is updated from its value at time $t_n = n\\Delta t$, denoted $\\theta_n$, according to the rule:\n$$\n\\theta_{n+1} \\;=\\; \\theta_n \\;+\\; \\Big(\\omega_0 \\;+\\; A \\sin\\!\\big(\\Omega t_n - \\theta_n\\big)\\Big)\\,\\Delta t \\;+\\; \\sqrt{2D\\,\\Delta t}\\;\\eta_n\n$$\nwhere each $\\eta_n$ is an independent random variable drawn from a standard normal distribution, $\\mathcal{N}(0,1)$. The term $\\sqrt{2D\\,\\Delta t}\\;\\eta_n$ represents the Wiener process increment over the interval $\\Delta t$.\n\nStep $2$: Unit Handling\nThe model parameters are given in mixed units. The intrinsic frequency $f_0$, stimulus frequencies $f_s$, and coupling amplitudes $a$ are provided in Hertz ($\\mathrm{Hz}$). The SDE requires angular frequencies and amplitudes in units of $\\mathrm{rad/s}$. Therefore, we apply the following conversions:\n- Intrinsic angular frequency: $\\omega_0 = 2\\pi f_0$\n- Drive angular frequency: $\\Omega = 2\\pi f_s$\n- Drive angular amplitude: $A = 2\\pi a$\nThe diffusion coefficient $D$ is already in the correct units of $\\mathrm{rad^2/s}$, and the time step $\\Delta t$ is in seconds.\n\nStep $3$: Quantifying Entrainment with Phase-Locking Value (PLV)\nEntrainment, or phase locking, occurs when the phase of the oscillator, $\\theta(t)$, follows the phase of the external drive, $\\Omega t$, with a relatively constant phase difference. This relationship is quantified using the Phase-Locking Value (PLV). For a discrete time series of phase values $\\{\\theta(t_n)\\}_{n=1}^N$ sampled over a duration, the PLV is the magnitude of the mean of the complex phase vectors:\n$$\n\\mathrm{PLV} \\;=\\; \\left|\\frac{1}{N}\\sum_{n=1}^{N} e^{\\,i\\,\\big(\\theta(t_n)-\\Omega t_n\\big)}\\right|\n$$\nwhere $i$ is the imaginary unit. A PLV close to $1$ indicates strong and consistent phase locking, while a PLV close to $0$ suggests no phase relationship, consistent with the phase difference being uniformly distributed.\n\nStep $4$: Statistical Power Estimation\nTo determine if the observed phase locking is statistically significant, we use the Rayleigh test. The null hypothesis, $H_0$, is that there is no phase locking, meaning the phase differences $\\phi_n = \\theta(t_n) - \\Omega t_n$ are uniformly distributed on the interval $[0, 2\\pi)$. The Rayleigh test statistic, $Z$, is calculated as:\n$$\nZ \\;=\\; N\\,\\mathrm{PLV}^2\n$$\nwhere $N$ is the number of samples used to compute the PLV. The $p$-value, which is the probability of observing a test statistic at least as extreme as $Z$ under $H_0$, is approximated for large $N$ by:\n$$\np \\;\\approx\\; e^{-Z}\n$$\nFor a given significance level $\\alpha$ (in this case, $\\alpha=0.05$), we reject the null hypothesis if $p < \\alpha$.\n\nStatistical power is the probability of correctly detecting an effect when it is present. We estimate it by simulating $M$ independent trials for each parameter condition $(\\Omega, A)$. The statistical power is then the fraction of these trials that yield a significant result (i.e., $p < \\alpha$):\n$$\n\\text{Power} = \\frac{\\text{Number of trials with } p < \\alpha}{M}\n$$\n\nStep $5$: Simulation Execution\nThe algorithm is executed for the three specified test cases. For each case, we iterate through all combinations of stimulus frequency $f_s$ and coupling amplitude $a$.\n- For each condition $(f_s, a)$:\n  - Convert $f_0, f_s, a$ to their angular counterparts $\\omega_0, \\Omega, A$.\n  - Run $M=200$ trials.\n  - In each trial:\n    - Draw an initial phase $\\theta_0$ from a uniform distribution $U(0, 2\\pi)$.\n    - Simulate the phase trajectory $\\theta_n$ for $N = T/\\Delta t = 0.8 / 0.0005 = 1600$ steps using the Euler-Maruyama update rule.\n    - Compute the PLV using the $N=1600$ samples from $t_1$ to $t_N$.\n    - Calculate the $p$-value using the Rayleigh test statistic.\n    - Count the trial as significant if $p < 0.05$.\n  - Compute the power as the fraction of significant trials.\n- The resulting power values are collected and formatted into the nested list structure as required, maintaining the specified ordering by increasing $a$ and, within each $a$, by increasing $f_s$. This process provides a map of statistical power across the tested parameter space, indicating where the external drive is strong enough to produce detectable entrainment against the endogenous noise.",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation_for_condition(f0, fs, a, D, T, dt, M, alpha):\n    \"\"\"\n    Runs a simulation for a single parameter condition to estimate statistical power.\n\n    Args:\n        f0 (float): Intrinsic frequency in Hz.\n        fs (float): Stimulus frequency in Hz.\n        a (float): Coupling amplitude in Hz.\n        D (float): Diffusion coefficient in rad^2/s.\n        T (float): Total simulation duration in seconds.\n        dt (float): Time step in seconds.\n        M (int): Number of trials.\n        alpha (float): Significance level.\n\n    Returns:\n        float: Estimated statistical power.\n    \"\"\"\n    # Convert units from Hz to rad/s\n    omega0 = 2.0 * np.pi * f0\n    Omega = 2.0 * np.pi * fs\n    A = 2.0 * np.pi * a\n\n    # Simulation parameters\n    num_steps = int(T / dt)\n    time_vec = np.linspace(0, T, num_steps + 1)\n\n    # Pre-calculate noise standard deviation for the update step\n    noise_std = np.sqrt(2.0 * D * dt)\n\n    significant_trials = 0\n    for _ in range(M):\n        # Initialize phase trajectory array\n        theta = np.zeros(num_steps + 1)\n        # Initial phase drawn uniformly from [0, 2*pi)\n        theta[0] = np.random.uniform(0, 2.0 * np.pi)\n\n        # Generate all random numbers needed for the trial at once for efficiency\n        eta = np.random.randn(num_steps)\n\n        # Euler-Maruyama integration loop\n        for n in range(num_steps):\n            tn = time_vec[n]\n            deterministic_term = (omega0 + A * np.sin(Omega * tn - theta[n])) * dt\n            stochastic_term = noise_std * eta[n]\n            theta[n + 1] = theta[n] + deterministic_term + stochastic_term\n\n        # Calculate PLV using samples from t_1 to t_N (N = num_steps)\n        # This corresponds to indices 1 to num_steps in the 0-indexed arrays.\n        phase_differences = theta[1:] - Omega * time_vec[1:]\n        plv = np.abs(np.mean(np.exp(1j * phase_differences)))\n\n        # Perform the Rayleigh test\n        N_samples = num_steps\n        Z = N_samples * (plv ** 2)\n        p_value = np.exp(-Z)\n        \n        if p_value < alpha:\n            significant_trials += 1\n            \n    power = significant_trials / M\n    return power\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results in the specified format.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"f0\": 40.0, \"fs_list\": [37.0, 40.0, 43.0], \"a_list\": [2.0, 8.0],\n            \"D\": 2.0, \"T\": 0.8, \"dt\": 0.0005, \"M\": 200, \"alpha\": 0.05\n        },\n        {\n            \"f0\": 40.0, \"fs_list\": [37.0, 40.0, 43.0], \"a_list\": [3.0],\n            \"D\": 2.0, \"T\": 0.8, \"dt\": 0.0005, \"M\": 200, \"alpha\": 0.05\n        },\n        {\n            \"f0\": 40.0, \"fs_list\": [37.0, 40.0, 43.0], \"a_list\": [8.0],\n            \"D\": 20.0, \"T\": 0.8, \"dt\": 0.0005, \"M\": 200, \"alpha\": 0.05\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        case_results = []\n        # Per problem specification, order by increasing 'a' then by increasing 'fs'.\n        # The lists are already sorted, but explicit sorting ensures compliance.\n        a_list_sorted = sorted(case[\"a_list\"])\n        fs_list_sorted = sorted(case[\"fs_list\"])\n\n        for a in a_list_sorted:\n            for fs in fs_list_sorted:\n                power = run_simulation_for_condition(\n                    case[\"f0\"], fs, a, case[\"D\"], case[\"T\"],\n                    case[\"dt\"], case[\"M\"], case[\"alpha\"]\n                )\n                case_results.append(power)\n        all_results.append(case_results)\n        \n    # Format the final output string to exactly match the required structure:\n    # [[p1,p2,...],[pi,...],[pj,...]]\n    inner_lists_str = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    final_output_str = f\"[{','.join(inner_lists_str)}]\"\n    \n    print(final_output_str)\n\n# Execute the main function.\nsolve()\n```"
        }
    ]
}