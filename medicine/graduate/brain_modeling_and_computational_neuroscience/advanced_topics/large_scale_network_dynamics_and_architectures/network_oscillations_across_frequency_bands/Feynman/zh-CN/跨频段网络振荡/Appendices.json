{
    "hands_on_practices": [
        {
            "introduction": "大脑中的大规模振荡并非均匀一致，而是受到底层解剖连接结构的塑造。此练习向您介绍如何使用图拉普拉斯算子（graph Laplacian）的特征模态来理解网络结构如何作为决定振荡模式的“空间滤波器”。通过这个计算实践 ，您将亲手模拟并预测在不同空间输入模式下，哪些特定的网络振荡频率（例如alpha波段与gamma波段）会被激发，从而将抽象的图论概念与具体的神经动力学联系起来。",
            "id": "4001991",
            "problem": "给定一个简化的大脑皮层网络模型，该模型表示为一个具有对称邻接矩阵和相应组合拉普拉斯算子的无向图。该网络在小扰动下的动力学由一个线性二阶系统建模，该系统源于对耦合的兴奋-抑制神经元集群的线性化。其关键原则包括：基于图拉普拉斯算子特征模态的模态分解、线性时不变动力学以及带限功率积分。您的任务是计算拉普拉斯算子的特征模态，推导每个模态的频域响应，并确定在不同的空间输入分布下，哪些模态在 alpha 波段与 gamma 波段中表达。\n\n使用的基本定义：\n- 图的组合拉普拉斯算子定义为 $L = D - A$，其中 $A$ 是邻接矩阵，$D$ 是对角度矩阵。\n- 一个关于模态坐标 $x_k(t)$ 的线性二阶阻尼系统的表达式为 $\\ddot{x}_k(t) + 2 \\zeta \\omega_0 \\dot{x}_k(t) + \\omega_0^2 \\left(1 + \\beta \\lambda_k \\right) x_k(t) = u_k(t)$，其中 $\\lambda_k$ 是第 $k$ 个拉普拉斯特征值，$\\omega_0$ 是基础角频率，$\\zeta$ 是阻尼比，$\\beta$ 是一个将空间耦合映射到有效刚度的耦合系数，$u_k(t)$ 是输入在第 $k$ 个特征模态上的投影。\n- 每个模态的频域幅值响应可以通过对上述微分方程进行变换，并在指定频带上对响应的幅值平方进行积分来获得。\n\n图的构建与测试套件：\n您将评估三个测试用例，每个用例由一个图和一个输入分布定义。所有图都是无向的，具有 $N$ 个节点和无权边（$0$ 或 $1$）。对于每个用例，都必须从 $A$ 计算出组合拉普拉斯算子 $L$。\n\n- 测试用例 1（理想情况，全局驱动）：\n  - 图：一个包含 $N = 8$ 个节点的环形图，其中每个节点连接到其两个最近邻（度为 $2$），包括环绕连接。\n  - 输入分布：一个均匀空间输入向量 $u \\in \\mathbb{R}^N$，其所有条目 $u_i = 1$。\n\n- 测试用例 2（局部驱动，混合模态激励）：\n  - 图：与测试用例 1 中相同的 $N = 8$ 环形图。\n  - 输入分布：一个在节点索引 $0$ 处为 one-hot（独热）的局部输入向量 $u$（即，$u_0 = 1$ 且对于 $i \\neq 0$，$u_i = 0$）。\n\n- 测试用例 3（边缘情况，高空间频率驱动）：\n  - 图：相同的 $N = 8$ 环形图。\n  - 输入分布：一个交替空间模式 $u$，其条目为 $u_i = (-1)^i$，$i = 0, 1, \\dots, 7$，该模式会激励高空间频率模态。\n\n模型参数：\n- 基础角频率 $\\omega_0 = 2 \\pi f_0$，其中 $f_0 = 10$（单位：Hz）。\n- 阻尼比 $\\zeta = 0.20$（无量纲）。\n- 耦合系数 $\\beta = 8.0$（无量纲）。\n- 频带：alpha 波段从 $f_{\\alpha,\\min} = 8$ 到 $f_{\\alpha,\\max} = 12$（单位：Hz），gamma 波段从 $f_{\\gamma,\\min} = 30$ 到 $f_{\\gamma,\\max} = 80$（单位：Hz）。\n- 用于数值积分的频率采样步长 $\\Delta f = 0.5$（单位：Hz）。\n\n所需计算：\n- 为每个测试用例计算拉普拉斯算子 $L$ 的特征值 $\\lambda_k$ 和标准正交特征向量 $v_k$，模态按升序特征值索引（$k = 0, 1, \\dots, N-1$）。\n- 将输入分布 $u$ 投影到特征基上：$u_k = v_k^\\top u$。\n- 对于每个模态 $k$，计算其在 alpha 波段和 gamma 波段的频带功率。该功率定义为：将模态频域响应的幅值平方乘以 $|u_k|^2$，然后在指定频带上进行数值积分。使用在 $f = f_{\\min}, f_{\\min} + \\Delta f, \\dots, f_{\\max}$ 处采样的频率，并通过 $\\omega = 2\\pi f$（单位：rad/s）转换为角频率。假设输入频谱在频率上是恒定的（单位谱密度），因此频带功率与 $\\int |H_k(\\omega)|^2 |u_k|^2 \\, \\mathrm{d}\\omega$ 成正比。\n- 要将模态分类为在某个频带中“表达”，请对每个用例和每个频带使用以下规则：\n  - 计算所有具有不可忽略 $|u_k|$ 的模态的频带功率列表 $P_{\\alpha}(k)$ 和 $P_{\\gamma}(k)$。将可忽略投影的数值阈值定义为 $|u_k|^2  10^{-12}$。\n  - 如果 $P_{\\alpha}(k) \\geq 0.20 \\cdot \\max_j P_{\\alpha}(j)$ 且 $P_{\\alpha}(k) \\geq P_{\\gamma}(k)$，则模态 $k$ 在 alpha 波段中表达。\n  - 如果 $P_{\\gamma}(k) \\geq 0.20 \\cdot \\max_j P_{\\gamma}(j)$ 且 $P_{\\gamma}(k) > P_{\\alpha}(k)$，则模态 $k$ 在 gamma 波段中表达。\n\n输出要求：\n- 将每个测试用例的最终分类表示为一对整数列表：第一个列表包含 alpha 表达模态的索引，第二个列表包含 gamma 表达模态的索引。索引必须按升序给出。\n- 单位：所有频率均以 Hz 为单位。积分内部以弧度/秒为单位运算，但积分限以 Hz 指定。\n- 您的程序应生成单行输出，其中包含三个测试用例的聚合结果，形式为逗号分隔的各用例结果列表，每个用例的结果格式化为包含在一对方括号内的一对列表。例如：$[[\\text{alpha\\_modes\\_case1},\\text{gamma\\_modes\\_case1}],[\\text{alpha\\_modes\\_case2},\\text{gamma\\_modes\\_case2}],[\\text{alpha\\_modes\\_case3},\\text{gamma\\_modes\\_case3}]]$。",
            "solution": "该问题要求分析一个简化的大脑皮层网络模型，以确定在不同的空间输入条件下，其哪些振荡模态在 alpha 和 gamma 频带中表达。解决方案首先建立理论框架，然后将其应用于具体的测试用例。\n\n### 1. 理论框架\n\n网络动力学是针对其每个空间模态进行建模的，这些模态通过图拉普拉斯算子的特征分解获得。\n\n#### 1.1. 图拉普拉斯算子与特征模态\n该网络表示为一个具有邻接矩阵 $A$ 和度矩阵 $D$ 的无向图。组合拉普拉斯算子定义为 $L = D - A$。由于 $L$ 是一个实对称矩阵，它有一套完备的标准正交特征向量 $v_k$ 和相应的实数非负特征值 $\\lambda_k$，满足特征值方程：\n$$\nL v_k = \\lambda_k v_k\n$$\n对于 $k = 0, 1, \\dots, N-1$，其中 $N$ 是节点数。特征值按升序索引，$\\lambda_0 \\le \\lambda_1 \\le \\dots \\le \\lambda_{N-1}$。特征向量 $\\{v_k\\}$ 构成了网络空间模式的一个标准正交基。\n\n#### 1.2. 模态动力学与频率响应\n每个模态的动力学由其坐标 $x_k(t)$ 表示，并由一个线性二阶阻尼谐振子方程描述：\n$$\n\\ddot{x}_k(t) + 2 \\zeta \\omega_0 \\dot{x}_k(t) + \\omega_0^2 \\left(1 + \\beta \\lambda_k \\right) x_k(t) = u_k(t)\n$$\n此处，$\\zeta$ 是阻尼比，$\\omega_0$ 是基础角频率，$\\beta$ 是耦合系数，$u_k(t)$ 是外部输入向量 $u(t)$ 在第 $k$ 个特征模态上的投影。对于一个时不变的空间输入分布 $u$，我们有 $u_k(t) = (v_k^\\top u) \\cdot f(t)$，其中 $f(t)$ 是输入的时间分量。该问题假设输入频谱在频率上是恒定的，这对应于时间上的一个冲激输入，$f(t) = \\delta(t)$。空间分布的投影为 $u_k = v_k^\\top u$。\n\n为了找到频率响应，我们对微分方程应用傅里叶变换，其中导数 $\\frac{d}{dt}$ 的变换是乘以 $i\\omega$。这得到：\n$$\n(i\\omega)^2 X_k(\\omega) + 2 \\zeta \\omega_0 (i\\omega) X_k(\\omega) + \\omega_{k, \\text{res}}^2 X_k(\\omega) = U_k(\\omega)\n$$\n其中 $X_k(\\omega)$ 和 $U_k(\\omega)$ 分别是 $x_k(t)$ 和 $u_k(t)$ 的傅里叶变换，并且我们定义了依赖于模态的共振角频率 $\\omega_{k, \\text{res}}$ 为：\n$$\n\\omega_{k, \\text{res}} = \\omega_0 \\sqrt{1 + \\beta \\lambda_k}\n$$\n模态 $k$ 的传递函数 $H_k(\\omega) = X_k(\\omega) / U_k(\\omega)$ 是：\n$$\nH_k(\\omega) = \\frac{1}{(\\omega_{k, \\text{res}}^2 - \\omega^2) + i(2 \\zeta \\omega_0 \\omega)}\n$$\n响应的功率谱密度与 $|H_k(\\omega)|^2 |u_k|^2$ 成正比。传递函数的幅值平方是：\n$$\n|H_k(\\omega)|^2 = \\frac{1}{(\\omega_{k, \\text{res}}^2 - \\omega^2)^2 + (2 \\zeta \\omega_0 \\omega)^2}\n$$\n\n#### 1.3. 频带功率计算\n模态 $k$ 在特定频带 $[f_{\\min}, f_{\\max}]$ 内的功率是通过对其功率谱密度进行数值积分来计算的。这可以通过在离散频率步长 $\\Delta f$ 上的黎曼和来近似：\n$$\nP_{\\text{band}}(k) \\propto |u_k|^2 \\sum_{f = f_{\\min}, f_{\\min}+\\Delta f, \\dots, f_{\\max}} |H_k(2\\pi f)|^2\n$$\n来自积分步长 $\\Delta \\omega = 2\\pi \\Delta f$ 的恒定比例因子被省略了，因为分类规则基于比率，这使得该因子无关紧要。\n\n### 2. 测试用例分析\n\n所有测试用例都使用一个 $N=8$ 节点的环形图，模型参数为 $\\omega_0 = 2\\pi(10)$，$\\zeta = 0.20$ 和 $\\beta=8.0$。该图是 2-正则的，因此 $D=2I$。邻接矩阵 $A$ 的条目在 $|i-j| \\pmod 8 = 1$ 时为 $A_{ij}=1$。拉普拉斯算子为 $L=2I - A$。数值计算得出以下具有简并性的特征值：$\\lambda_0 = 0.0$，$\\lambda_{1,2} \\approx 0.586$，$\\lambda_{3,4} = 2.0$，$\\lambda_{5,6} \\approx 3.414$ 和 $\\lambda_7 = 4.0$。\n\n#### 测试用例 1：均匀输入\n-   **输入**：$u = [1, 1, 1, 1, 1, 1, 1, 1]^\\top$。\n-   **投影**：此输入与对应于 $\\lambda_0=0$ 的常数特征向量 $v_0$ 平行。由于特征向量的正交性，$u_k = v_k^\\top u = 0$ 对所有 $k \\neq 0$ 成立。唯一不可忽略的投影是 $u_0$。\n-   **共振频率**：对于模态 $k=0$，$\\lambda_0=0$，因此共振频率为 $f_{0, \\text{res}} = f_0\\sqrt{1+\\beta \\cdot 0} = f_0 = 10$ Hz。\n-   **分类**：位于 $10$ Hz 的共振峰正好落在 alpha 波段（$8-12$ Hz）内。因此，$P_{\\alpha}(0)$ 会很大，而 $P_{\\gamma}(0)$ 会很小。所有其他模态的功率为零。根据规则，模态 $0$ 满足 $P_{\\alpha}(0) \\ge 0.20 \\cdot \\max_j P_{\\alpha}(j)$ 且 $P_{\\alpha}(0) \\ge P_{\\gamma}(0)$。\n-   **结果**：Alpha 模态：$[0]$，Gamma 模态：$[ ]$。\n\n#### 测试用例 2：局部输入\n-   **输入**：$u = [1, 0, 0, 0, 0, 0, 0, 0]^\\top$。\n-   **投影**：这种局部输入会投影到多个特征模态上。投影系数为 $u_k = v_k^\\top u = v_k[0]$，即第 $k$ 个特征向量的第一个分量。这会激励具有不同空间频率的模态。\n-   **共振频率**：\n    -   $k=0$ ($\\lambda_0=0$): $f_{0, \\text{res}}=10$ Hz (Alpha 波段)。\n    -   $k=1,2$ ($\\lambda_{1,2}\\approx0.586$): $f_{1,2,\\text{res}} \\approx 10\\sqrt{1+8(0.586)} \\approx 23.8$ Hz (Beta 波段)。\n    -   $k=3,4$ ($\\lambda_{3,4}=2.0$): $f_{3,4,\\text{res}} = 10\\sqrt{1+8(2)} = 10\\sqrt{17} \\approx 41.2$ Hz (Gamma 波段)。\n    -   $k=5,6$ ($\\lambda_{5,6}\\approx3.414$): $f_{5,6,\\text{res}} \\approx 10\\sqrt{1+8(3.414)} \\approx 53.2$ Hz (Gamma 波段)。\n    -   $k=7$ ($\\lambda_7=4.0$): $f_{7,\\text{res}} = 10\\sqrt{1+8(4)} = 10\\sqrt{33} \\approx 57.4$ Hz (Gamma 波段)。\n-   **分类**：模态 0 的共振在 alpha 波段，并将主导 alpha 功率。共振在 gamma 波段的模态（$k=3,4,5,6,7$）将主要贡献于 gamma 功率。特征值的简并性意味着对于每一对简并模态，特征求解器选择的具体基向量决定了投影 `u_k`。通常，简并对中的一个特征向量的第一个分量非零，而另一个为零，从而集中了功率。\n    - 模态 0 被分类为 alpha 模态。\n    - 共振频率在 $40-60$ Hz 附近的模态将具有高 gamma 功率和低 alpha 功率。那些具有显著投影的模态将通过阈值被分类为 gamma 模态。数值计算显示这些模态是 $3, 5, 7$。\n-   **结果**：Alpha 模态：$[0]$，Gamma 模态：$[3, 5, 7]$。\n\n#### 测试用例 3：交替输入\n-   **输入**：$u = [1, -1, 1, -1, 1, -1, 1, -1]^\\top$。\n-   **投影**：这个输入模式，即环形图上可能最高频率的空间正弦波，与最大特征值 $\\lambda_7=4.0$ 关联的特征向量 $v_7$ 平行。因此，对于 $k \\neq 7$，$u_k = 0$。\n-   **共振频率**：对于模态 $k=7$，$\\lambda_7=4.0$，因此共振频率为 $f_{7, \\text{res}} \\approx 57.4$ Hz。\n-   **分类**：$57.4$ Hz 的共振在 gamma 波段（$30-80$ Hz）内。$P_{\\gamma}(7)$ 会很大，而 $P_{\\alpha}(7)$ 会很小。模态 7 满足了 gamma 表达的分类规则。没有其他模态被激励。\n-   **结果**：Alpha 模态：$[ ]$，Gamma 模态：$[7]$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the network oscillation problem for three test cases.\n    \"\"\"\n\n    # --- Model Parameters ---\n    N = 8\n    f0 = 10.0  # Hz\n    omega0 = 2 * np.pi * f0  # rad/s\n    zeta = 0.20\n    beta = 8.0\n    \n    # --- Frequency Bands and Integration Setup ---\n    alpha_band = (8.0, 12.0)  # Hz\n    gamma_band = (30.0, 80.0) # Hz\n    delta_f = 0.5  # Hz\n\n    freq_alpha = np.arange(alpha_band[0], alpha_band[1] + delta_f, delta_f)\n    omega_alpha = 2 * np.pi * freq_alpha\n    \n    freq_gamma = np.arange(gamma_band[0], gamma_band[1] + delta_f, delta_f)\n    omega_gamma = 2 * np.pi * freq_gamma\n\n    # --- Graph Construction (N=8 ring) ---\n    A = np.zeros((N, N))\n    for i in range(N):\n        A[i, (i + 1) % N] = 1\n        A[i, (i - 1 + N) % N] = 1\n    \n    D = np.diag(np.sum(A, axis=1))\n    L = D - A\n\n    # --- Eigen-decomposition ---\n    # eigh returns eigenvalues in ascending order and corresponding eigenvectors\n    lambdas, V = np.linalg.eigh(L)\n\n    # --- Test Cases ---\n    test_cases = [\n        (\"Uniform\", np.ones(N)),\n        (\"Localized\", np.array([1.0] + [0.0] * (N - 1))),\n        (\"Alternating\", np.array([(-1)**i for i in range(N)])),\n    ]\n\n    all_results = []\n\n    for name, u in test_cases:\n        # Project input onto eigenbasis\n        u_k_proj = V.T @ u\n        u_k_sq_mag = u_k_proj**2\n\n        # --- Compute Band Power for Each Mode ---\n        P_alpha = np.zeros(N)\n        P_gamma = np.zeros(N)\n\n        for k in range(N):\n            if u_k_sq_mag[k]  1e-12:\n                continue\n            \n            lambda_k = lambdas[k]\n            omega_k_res_sq = omega0**2 * (1 + beta * lambda_k)\n\n            # --- Alpha band power ---\n            H_k_alpha_sq = 1 / ((omega_k_res_sq - omega_alpha**2)**2 + (2 * zeta * omega0 * omega_alpha)**2)\n            P_alpha[k] = u_k_sq_mag[k] * np.sum(H_k_alpha_sq)\n\n            # --- Gamma band power ---\n            H_k_gamma_sq = 1 / ((omega_k_res_sq - omega_gamma**2)**2 + (2 * zeta * omega0 * omega_gamma)**2)\n            P_gamma[k] = u_k_sq_mag[k] * np.sum(H_k_gamma_sq)\n\n        # --- Classify Modes ---\n        alpha_modes = []\n        gamma_modes = []\n\n        # Filter for modes with non-negligible projection for thresholding\n        active_indices = np.where(u_k_sq_mag >= 1e-12)[0]\n        \n        if len(active_indices) > 0:\n            max_P_alpha = np.max(P_alpha[active_indices])\n            max_P_gamma = np.max(P_gamma[active_indices])\n        else: # Handle case of no excited modes\n            max_P_alpha = 0\n            max_P_gamma = 0\n        \n\n        for k in active_indices:\n            # Alpha expression rule\n            is_alpha = (P_alpha[k] >= 0.20 * max_P_alpha and \n                        P_alpha[k] >= P_gamma[k])\n            \n            # Gamma expression rule\n            is_gamma = (P_gamma[k] >= 0.20 * max_P_gamma and\n                        P_gamma[k] > P_alpha[k])\n            \n            if is_alpha:\n                alpha_modes.append(k)\n            if is_gamma:\n                gamma_modes.append(k)\n\n        alpha_modes.sort()\n        gamma_modes.sort()\n        \n        all_results.append([alpha_modes, gamma_modes])\n\n    # Format the final output string exactly as required\n    # The default str() for a list includes spaces. The required `print` suggests this is acceptable.\n    # Eg `str([[0],[1,2]])` -> `'[[0], [1, 2]]'`\n    # The problem description's example formatting seems to have omitted spaces for brevity.\n    # Following the provided print machinery is the safest interpretation.\n    result_strings = [str(res).replace(' ', '') for res in all_results]\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在模拟了振荡的产生机制后，下一步是从记录的信号（如局部场电位 LFP）中对其进行分析。谱分析是识别和量化神经振荡的核心工具。此练习  将带您深入谱估计的理论核心，要求您从第一性原理推导周期图（periodogram），并直面其在有限数据下的局限性，如偏差和谱泄漏。掌握这些基础知识对于正确应用和理解如Welch法或多窗法（multitaper）等高级谱分析技术至关重要。",
            "id": "4002012",
            "problem": "考虑一个长度为 $N$ 的零均值、宽平稳离散时间局部场电位 (LFP) 信号 $x[n]$，该信号从一个在经典频段（例如 delta、theta、beta、gamma）上表现出振荡活动的皮层网络中采样得到。其自协方差序列为 $\\gamma_{x}[\\tau] = \\mathbb{E}\\{x[n] x[n+\\tau]\\}$，功率谱密度 (PSD) $S(\\omega)$ 通过 Wiener–Khinchin 定理定义为 $S(\\omega) = \\sum_{\\tau=-\\infty}^{\\infty} \\gamma_{x}[\\tau] \\exp(-\\mathrm{i} \\omega \\tau)$，其中角频率 $\\omega \\in [-\\pi, \\pi]$。一个有限观测窗 $w[n]$ 被应用于 $x[n]$，得到 $x_{w}[n] = w[n] x[n]$，其中 $w[n]$ 仅在 $n \\in \\{0, 1, \\dots, N-1\\}$ 时非零。\n\n从这些定义和傅里叶分析的基本原理出发，从 $x_{w}[n]$ 推导功率谱密度的周期图估计量 $I_{N}(\\omega)$，并在 $x[n]$ 是高斯且宽平稳的假设下，表达其期望 $\\mathbb{E}\\{I_{N}(\\omega)\\}$ 和方差 $\\mathrm{Var}\\{I_{N}(\\omega)\\}$。明确指出与 $w[n]$ 相关联的谱窗 $W_{N}(\\omega)$，并用谱泄漏核来刻画偏差 $\\mathbb{E}\\{I_{N}(\\omega)\\} - S(\\omega)$。将您的表达式具体化到矩形窗的情况，即当 $n = 0, 1, \\dots, N-1$ 时 $w[n] = 1$，否则 $w[n] = 0$，并用闭式形式表达相应的谱核。\n\n接下来，提出一种专为跨多个频段的网络振荡的LFP分析设计的减少泄漏的谱估计策略，可使用 Welch 方法（分段、加窗后求平均）或多窗格法（使用正交数据窗，如离散扁长球状序列）。通过分析窗的旁瓣结构或窗谱的能量集中度如何影响相邻频段间的泄漏，来证明您选择的合理性。\n\n最后，假设您实施一种组合策略，其中LFP被划分为 $M$ 段，每段使用 $K$ 个权重相等的正交窗，并且在固定的角频率 $\\omega$ 处，对跨越不同段和窗的独立加窗谱估计进行平均。在独立性近似和高斯假设下，请用真实PSD $S(\\omega)$、分段数 $M$ 和窗数 $K$ 来表示在 $\\omega$ 处最终平均估计量的方差，并提供一个单一的、闭式解析表达式。将您的最终答案表示为解析表达式。无需进行数值舍入。",
            "solution": "我们从一个零均值、宽平稳 (WSS) 的离散时间过程 $x[n]$ 开始，其自协方差为 $\\gamma_{x}[\\tau] = \\mathbb{E}\\{x[n] x[n+\\tau]\\}$，功率谱密度 (PSD) 为 $S(\\omega) = \\sum_{\\tau=-\\infty}^{\\infty} \\gamma_{x}[\\tau] \\exp(-\\mathrm{i} \\omega \\tau}$，其中 $\\omega \\in [-\\pi, \\pi]$。Wiener–Khinchin 定理将 $S(\\omega)$ 与 $\\gamma_{x}[\\tau]$ 联系起来，是进行非参数谱估计的根本基础。\n\n有限的观测将该过程乘以一个确定性窗 $w[n]$，得到 $x_{w}[n] = w[n] x[n]$, $n = 0, 1, \\dots, N-1$。定义加窗数据的有限长度离散时间傅里叶变换 (DTFT)\n$$\nX_{w}(\\omega) = \\sum_{n=0}^{N-1} x_{w}[n] \\exp(-\\mathrm{i} \\omega n)\n= \\sum_{n=0}^{N-1} w[n] x[n] \\exp(-\\mathrm{i} \\omega n).\n$$\n周期图估计量定义为\n$$\nI_{N}(\\omega) = \\frac{1}{2 \\pi N} \\left| X_{w}(\\omega) \\right|^{2}.\n$$\n为了分析期望和偏差，我们用窗的DTFT来表示 $I_{N}(\\omega)$。定义窗变换\n$$\nW_{N}(\\omega) = \\sum_{n=0}^{N-1} w[n] \\exp(-\\mathrm{i} \\omega n),\n$$\n并将 $X_{w}(\\omega)$ 写成底层变换与谱窗的频域卷积。利用 WSS 和高斯假设，周期图的期望可以写成真实PSD与经过适当归一化的窗变换幅值平方的频谱卷积。具体来说，\n$$\n\\mathbb{E}\\{ I_{N}(\\omega) \\}\n= \\frac{1}{2 \\pi N} \\mathbb{E}\\{ X_{w}(\\omega) X_{w}^{\\ast}(\\omega) \\}\n= \\frac{1}{2 \\pi} \\int_{-\\pi}^{\\pi} S(\\lambda) \\, F_{N}(\\omega - \\lambda) \\, \\mathrm{d}\\lambda,\n$$\n其中谱核 $F_{N}(\\omega)$ 由下式给出\n$$\nF_{N}(\\omega) = \\frac{1}{2 \\pi N} \\left| W_{N}(\\omega) \\right|^{2}.\n$$\n这表明对于有限的 $N$，周期图是一个有偏估计量，其偏差由真实谱与其和 $F_{N}(\\cdot)$ 的卷积之间的差决定。该偏差为\n$$\n\\mathrm{bias}_{N}(\\omega) = \\mathbb{E}\\{ I_{N}(\\omega) \\} - S(\\omega)\n= \\frac{1}{2 \\pi} \\int_{-\\pi}^{\\pi} S(\\lambda) \\, F_{N}(\\omega - \\lambda) \\, \\mathrm{d}\\lambda - S(\\omega).\n$$\n当 $N \\to \\infty$ 且 $S(\\omega)$ 足够平滑时，$F_{N}(\\omega)$ 在频域上集中为一个狄拉克-德尔塔函数，这意味着 $\\mathbb{E}\\{ I_{N}(\\omega) \\} \\to S(\\omega)$（渐近无偏性）。对于有限的 $N$，$F_{N}(\\omega)$ 中的旁瓣会导致谱泄漏。\n\n具体到矩形窗的情况，即当 $n = 0, 1, \\dots, N-1$ 时 $w[n] = 1$，否则 $w[n] = 0$。那么\n$$\nW_{N}(\\omega) = \\sum_{n=0}^{N-1} \\exp(-\\mathrm{i} \\omega n)\n= \\exp\\!\\left( -\\mathrm{i} \\omega \\frac{N-1}{2} \\right) \\frac{\\sin\\!\\left( \\frac{N \\omega}{2} \\right)}{\\sin\\!\\left( \\frac{\\omega}{2} \\right)}.\n$$\n因此，谱核是 Fejér 核：\n$$\nF_{N}(\\omega) = \\frac{1}{2 \\pi N} \\left| W_{N}(\\omega) \\right|^{2}\n= \\frac{1}{2 \\pi N} \\left( \\frac{\\sin\\!\\left( \\frac{N \\omega}{2} \\right)}{\\sin\\!\\left( \\frac{\\omega}{2} \\right)} \\right)^{2}.\n$$\n因此，\n$$\n\\mathbb{E}\\{ I_{N}(\\omega) \\} \n= \\frac{1}{2 \\pi} \\int_{-\\pi}^{\\pi} S(\\lambda) \\, \\frac{1}{N} \\left( \\frac{\\sin\\!\\left( \\frac{N (\\omega - \\lambda)}{2} \\right)}{\\sin\\!\\left( \\frac{\\omega - \\lambda}{2} \\right)} \\right)^{2} \\frac{ \\mathrm{d}\\lambda }{2 \\pi}\n$$\n其中需要理解的是，归一化因子强制满足 $\\int_{-\\pi}^{\\pi} F_{N}(\\omega) \\, \\mathrm{d}\\omega = 1$。\n\n我们接下来评估 $I_{N}(\\omega)$ 的方差。在高斯性和WSS条件下，在不同傅里叶频率处的傅里叶分量 $X_{w}(\\omega)$ 近似为零均值的复高斯分布。对于矩形窗和傅里叶网格频率，并忽略 $O(1/N)$ 阶的相关性，$I_{N}(\\omega)$ 的行为类似于复高斯变量的幅值平方，从而得到一个指数分布。更精确地说，对于固定的 $\\omega$ 和大的 $N$，\n$$\n\\frac{I_{N}(\\omega)}{S(\\omega)} \\approx \\frac{1}{2} \\chi^{2}_{2},\n$$\n一个自由度为2的缩放卡方随机变量。$\\frac{1}{2} \\chi^{2}_{2}$ 的均值和方差分别为1和1，这意味着\n$$\n\\mathbb{E}\\{ I_{N}(\\omega) \\} \\approx S(\\omega), \\quad \\mathrm{Var}\\{ I_{N}(\\omega) \\} \\approx S(\\omega)^{2}.\n$$\n因此，原始周期图是渐近无偏的，但不是一致的，因为当 $N \\to \\infty$ 时其方差不会消失。\n\n为了在跨多个频段的网络振荡的LFP分析中减轻谱泄漏，可以使用 Welch 方法或多窗格法。Welch 方法将数据分段并使用重叠窗，对每段应用一个数据窗（例如 Hann 窗）以降低 $F_{N}(\\omega)$ 中的旁瓣水平，然后计算每段的周期图并进行平均。Hann 窗通过抑制旁瓣来减少谱泄漏，其代价是主瓣变宽（在偏差和方差之间进行权衡）。多窗格法使用 $K$ 个正交的离散扁长球状序列窗（Slepian 序列），这些窗能在选定的带宽内最大化谱能量集中度，从而在减少泄漏的同时，提供跨窗的近似独立的谱估计。\n\n考虑一种组合策略：将数据划分为 $M$ 段，每段应用 $K$ 个正交窗，在固定的 $\\omega$ 处计算加窗周期图，并对所有 $M K$ 个估计值进行等权重平均。在跨段和跨窗的独立性近似下，并假设每个加窗估计的方差与原始周期图的方差相同（当 $K$ 适中且窗是正交的，并且在感兴趣的频带内具有接近单位的谱能量集中度时，这一假设是合理的），$M K$ 个独立的类指数分布变量的平均值会产生一个形状参数为 $M K$ 的伽马分布，其方差与 $M K$ 成反比：\n$$\n\\mathrm{Var}\\left\\{ \\frac{1}{M K} \\sum_{m=1}^{M} \\sum_{k=1}^{K} I_{m,k}(\\omega) \\right\\} \n= \\frac{1}{(M K)^{2}} \\sum_{m=1}^{M} \\sum_{k=1}^{K} \\mathrm{Var}\\{ I_{m,k}(\\omega) \\}\n\\approx \\frac{M K \\, S(\\omega)^{2}}{(M K)^{2}}\n= \\frac{S(\\omega)^{2}}{M K}.\n$$\n此处 $I_{m,k}(\\omega)$ 表示使用窗 $k$ 从第 $m$ 段得到的加窗周期图。该近似假设由于加窗和窗的正交性，不同 $(m,k)$ 对之间的协方差可以忽略不计，这在高级非参数谱估计中是一个标准假设。\n\n因此，在角频率 $\\omega$ 处，组合的 Welch–多窗格平均估计量的方差为\n$$\n\\mathrm{Var}\\{ \\widehat{S}(\\omega) \\} \\approx \\frac{S(\\omega)^{2}}{M K}.\n$$\n这个闭式解析表达式体现了通过分段平均 ($M$) 和窗平均 ($K$) 实现的方差减小，而泄漏则通过窗谱能量集中度（多窗格法）和旁瓣抑制（Welch 加窗法）得到缓解。",
            "answer": "$$\\boxed{\\frac{S(\\omega)^{2}}{M K}}$$"
        },
        {
            "introduction": "当我们可以表征单个振荡时，便可以研究它们之间的相互作用，即跨频耦合。相位-振幅耦合（Phase-Amplitude Coupling, PAC）是其中研究最广泛的一种形式，它描述了低频振荡的相位如何调制高频振荡的振幅。然而，非正弦的波形本身就可能产生虚假的PAC信号，这是一个主要的混淆因素。此练习  挑战您对这一伪影进行数学建模，推导波形特征（如占空比和偏度）如何产生伪PAC。这有助于培养严谨的科学思维，并强调在数据分析中理解潜在混淆变量的重要性。",
            "id": "4002065",
            "problem": "考虑一个大脑中的网络振荡，其在相位坐标中被建模为一个角频率为 $\\omega_{0}$、相位 $\\phi \\in [0, 2\\pi)$ 的周期性低频波形。在此，经验相位-振幅耦合 (PAC) 定义为高频振幅包络对低频振荡相位的依赖关系。一个基于振幅加权平均向量长度的基本 PAC 估计量由下式给出\n$$\nM \\equiv \\frac{\\left| \\int_{0}^{2\\pi} A(\\phi)\\,\\exp(i\\,\\phi)\\,\\frac{d\\phi}{2\\pi} \\right|}{\\int_{0}^{2\\pi} A(\\phi)\\,\\frac{d\\phi}{2\\pi}},\n$$\n其中 $A(\\phi)$ 是作为低频相位 $\\phi$ 函数的高频振幅包络，且所有角度均以弧度为单位。\n\n非正弦波形会产生表观或伪 PAC。一个现实的来源是边缘不对称性：高频振幅集中在低频周期的上升沿和下降沿附近。将波形建模为每个周期一个占空比为 $D \\in (0, 1)$ 的脉冲，使得上升沿和下降沿的相位差为 $\\Delta = 2\\pi D$，即，如果上升沿出现在相位 $\\phi_{r}$，下降沿出现在相位 $\\phi_{f}$，则 $\\phi_{f} - \\phi_{r} = \\Delta$。假设每个周期的高频振幅包络主要由位于边缘的两个窄贡献主导，并可近似为\n$$\nA(\\phi) = \\alpha_{r}\\,g(\\phi - \\phi_{r}) + \\alpha_{f}\\,g(\\phi - \\phi_{f}),\n$$\n其中 $g(\\cdot)$ 是一个单位面积的窄核函数，$\\int_{-\\infty}^{\\infty} g(u)\\,du = 1$，并且 $\\alpha_{r} > 0, \\alpha_{f} > 0$ 是反映边缘锐度的权重。定义偏度参数 $s \\in [-1, 1]$，通过设置 $\\alpha_{r} = W\\frac{1+s}{2}$ 和 $\\alpha_{f} = W\\frac{1-s}{2}$，其中 $W > 0$ 是一个任意比例因子，这样 $s=0$ 对应对称边缘，$s>0$ 强调上升沿，$s0$ 强调下降沿。\n\n在一个标准的时间平移替代数据程序下，该程序将 $N_{c}$ 个周期内的低频相位和高频振幅之间的相对排列随机化，由于有限样本的各向同性向量加法，振幅加权平均向量长度 $M$ 具有正偏差。你可以假设，在替代数据随机化下，求和的二维复向量表现为零均值的各向同性随机游走，其步长等于边缘处的振幅权重。\n\n从给定的定义和建模假设出发，并且仅使用关于边缘能量的傅里叶局域化、随机化相位的各向同性以及二维随机游走统计特性的成熟结论，推导经替代数据校正的表观 PAC 幅值\n$$\nM_{\\mathrm{corr}}(D, s, N_{c}) \\equiv M_{\\mathrm{true}}(D, s) - M_{\\mathrm{bias}}(s, N_{c}),\n$$\n的闭式解析表达式，该表达式應为占空比 $D$、偏度 $s$ 和周期数 $N_{c}$ 的显式函数。你的推导必须从第一性原理出发，并为你使用的任何近似（例如，$g$ 的窄核极限和各向同性求和的瑞利期望）说明其合理性。将最终答案表示为关于 $D$、$s$ 和 $N_{c}$ 的单一闭式解析表达式。最终表达式中不应包含任何单位。角度必须以弧度为单位。无需进行数值计算。",
            "solution": "问题要求推导经替代数据校正的表观相位-振幅耦合 (PAC) 幅值 $M_{\\mathrm{corr}}(D, s, N_{c})$ 的闭式解析表达式，其定义为真实 PAC 幅值 $M_{\\mathrm{true}}(D, s)$ 与由有限样本数量引入的偏差 $M_{\\mathrmbias}(s, N_{c})$ 之差。推导将分为两个主要部分：首先，基于给定的波形模型计算 $M_{\\mathrm{true}}$；其次，基于替代数据程序的统计模型计算 $M_{\\mathrm{bias}}$。\n\n首先，我们计算真实 PAC 幅值 $M_{\\mathrm{true}}$。PAC 估计量的定义如下：\n$$\nM \\equiv \\frac{\\left| \\int_{0}^{2\\pi} A(\\phi)\\,\\exp(i\\,\\phi)\\,\\frac{d\\phi}{2\\pi} \\right|}{\\int_{0}^{2\\pi} A(\\phi)\\,\\frac{d\\phi}{2\\pi}}\n$$\n这可以解释为振幅分布 $A(\\phi)$ 的一阶圆矩的模与其零阶矩（平均振幅）的比值。我们将复数分子记为 $Z_{num}$，实数分母记为 $Z_{den}$。\n\n$Z_{den} = \\int_{0}^{2\\pi} A(\\phi)\\,\\frac{d\\phi}{2\\pi}$\n$Z_{num} = \\int_{0}^{2\\pi} A(\\phi)\\,\\exp(i\\,\\phi)\\,\\frac{d\\phi}{2\\pi}$\n\n振幅包络建模为 $A(\\phi) = \\alpha_{r}\\,g(\\phi - \\phi_{r}) + \\alpha_{f}\\,g(\\phi - \\phi_{f})$。问题中指出 $g(\\cdot)$ 是一个单位面积的窄核函数。在核函数极窄的极限情况下，我们可以用狄拉克δ函数 $\\delta(u)$ 来近似 $g(u)$。单位面积属性 $\\int g(u)du = 1$ 与此近似是一致的。\n\n使用狄拉克δ近似，$A(\\phi) \\approx \\alpha_{r}\\,\\delta(\\phi - \\phi_{r}) + \\alpha_{f}\\,\\delta(\\phi - \\phi_{f})$。我们现在可以计算分母和分子的积分。\n\n分母是平均振幅：\n$$\nZ_{den} = \\frac{1}{2\\pi}\\int_{0}^{2\\pi} \\left[ \\alpha_{r}\\,\\delta(\\phi - \\phi_{r}) + \\alpha_{f}\\,\\delta(\\phi - \\phi_{f}) \\right] d\\phi\n$$\n利用δ函数的筛选性质 $\\int f(x)\\delta(x-x_0)dx = f(x_0)$，我们得到：\n$$\nZ_{den} = \\frac{1}{2\\pi} (\\alpha_{r} + \\alpha_{f})\n$$\n\n复数分子是：\n$$\nZ_{num} = \\frac{1}{2\\pi}\\int_{0}^{2\\pi} \\left[ \\alpha_{r}\\,\\delta(\\phi - \\phi_{r}) + \\alpha_{f}\\,\\delta(\\phi - \\phi_{f}) \\right] \\exp(i\\,\\phi) d\\phi\n$$\n再次应用筛选性质：\n$$\nZ_{num} = \\frac{1}{2\\pi} \\left( \\alpha_{r}\\exp(i\\,\\phi_{r}) + \\alpha_{f}\\exp(i\\,\\phi_{f}) \\right)\n$$\n\n现在，我们通过计算比值 $|Z_{num}| / Z_{den}$ 来计算 $M_{\\mathrm{true}}$：\n$$\nM_{\\mathrm{true}} = \\frac{\\left| \\frac{1}{2\\pi} \\left( \\alpha_{r}\\exp(i\\,\\phi_{r}) + \\alpha_{f}\\exp(i\\,\\phi_{f}) \\right) \\right|}{\\frac{1}{2\\pi} (\\alpha_{r} + \\alpha_{f})} = \\frac{|\\alpha_{r}\\exp(i\\,\\phi_{r}) + \\alpha_{f}\\exp(i\\,\\phi_{f})|}{\\alpha_{r} + \\alpha_{f}}\n$$\n分子中复数和的模为 $\\sqrt{(\\alpha_{r}\\cos\\phi_{r} + \\alpha_{f}\\cos\\phi_{f})^{2} + (\\alpha_{r}\\sin\\phi_{r} + \\alpha_{f}\\sin\\phi_{f})^{2}}$。这可以简化为 $\\sqrt{\\alpha_{r}^{2} + \\alpha_{f}^{2} + 2\\alpha_{r}\\alpha_{f}\\cos(\\phi_{f}-\\phi_{r})}$。\n给定 $\\phi_{f} - \\phi_{r} = \\Delta = 2\\pi D$。代入此式：\n$$\nM_{\\mathrm{true}} = \\frac{\\sqrt{\\alpha_{r}^{2} + \\alpha_{f}^{2} + 2\\alpha_{r}\\alpha_{f}\\cos(2\\pi D)}}{\\alpha_{r} + \\alpha_{f}}\n$$\n接下来，我们将用偏度 $s$ 和比例因子 $W$ 表示的 $\\alpha_{r}$ 和 $\\alpha_{f}$ 的定义代入：\n$\\alpha_{r} = W\\frac{1+s}{2}$ 和 $\\alpha_{f} = W\\frac{1-s}{2}$。\n和为 $\\alpha_{r} + \\alpha_{f} = W\\frac{1+s}{2} + W\\frac{1-s}{2} = W$。\n平方和为 $\\alpha_{r}^{2} + \\alpha_{f}^{2} = W^{2}\\frac{(1+s)^{2}}{4} + W^{2}\\frac{(1-s)^{2}}{4} = \\frac{W^{2}}{4}(1+2s+s^{2} + 1-2s+s^{2}) = \\frac{W^{2}}{2}(1+s^{2})$。\n乘积为 $2\\alpha_{r}\\alpha_{f} = 2W^{2}\\frac{(1+s)(1-s)}{4} = \\frac{W^{2}}{2}(1-s^{2})$。\n\n将这些代入 $M_{\\mathrm{true}}$ 的表达式中：\n$$\nM_{\\mathrm{true}} = \\frac{\\sqrt{\\frac{W^{2}}{2}(1+s^{2}) + \\frac{W^{2}}{2}(1-s^{2})\\cos(2\\pi D)}}{W} = \\sqrt{\\frac{1}{2}\\left(1+s^{2} + (1-s^{2})\\cos(2\\pi D)\\right)}\n$$\n使用半角恒等式 $\\cos(2x) = 1 - 2\\sin^{2}(x)$:\n$$\nM_{\\mathrm{true}} = \\sqrt{\\frac{1}{2}\\left(1+s^{2} + (1-s^{2})(1-2\\sin^{2}(\\pi D))\\right)} = \\sqrt{\\frac{1}{2}\\left(2 - 2(1-s^{2})\\sin^{2}(\\pi D)\\right)}\n$$\n$$\nM_{\\mathrm{true}}(D, s) = \\sqrt{1 - (1-s^{2})\\sin^{2}(\\pi D)} = \\sqrt{1 - \\sin^{2}(\\pi D) + s^{2}\\sin^{2}(\\pi D)} = \\sqrt{\\cos^{2}(\\pi D) + s^{2}\\sin^{2}(\\pi D)}\n$$\n\n其次，我们计算偏差项 $M_{\\mathrm{bias}}(s, N_{c})$。问题中指出，在替代数据随机化下，数据表现为零均值的各向同性随机游走，其步长等于振幅权重。对于 $N_{c}$ 个周期，每个周期有两个边缘贡献，我们在复平面上有 $2N_{c}$ 个随机向量的和。一次替代数据试验的总复向量是 $Z = \\sum_{k=1}^{N_{c}} \\left(\\alpha_{r}\\exp(i\\theta_{r,k}) + \\alpha_{f}\\exp(i\\theta_{f,k})\\right)$，其中 $\\theta_{r,k}$ 和 $\\theta_{f,k}$ 是在 $[0, 2\\pi)$ 上均匀分布的独立随机相位。这是一个 $2N_{c}$ 个向量的和，其中 $N_c$ 个向量的长度为 $\\alpha_{r}$，$N_c$ 个向量的长度为 $\\alpha_{f}$。均值 $E[Z]=0$。\n\n一次替代数据试验的 PAC 幅值为 $M_{surr} = |Z| / (N_{c}(\\alpha_{r}+\\alpha_{f})) = |Z|/(N_{c}W)$。偏差是期望值 $M_{\\mathrm{bias}} = E[M_{surr}] = E[|Z|]/(N_{c}W)$。\n\n对于大量随机向量的和，所得的复变量 $Z$ 可以很好地由一个圆形复正態分布来近似。其模 $|Z|$ 服从瑞利分布。一个服从瑞利分布的变量的期望值为 $E[|Z|] = \\sigma \\sqrt{\\pi/2}$，其中 $\\sigma^{2}$ 是 $Z$ 的实部或虚部的方差。该复变量本身的方差是 $E[|Z|^{2}] = \\sigma_{Z}^{2} = 2\\sigma^{2}$。\n方差 $\\sigma_{Z}^{2}$ 是各分量向量长度平方的和：\n$$\n\\sigma_{Z}^{2} = E[|Z|^{2}] = \\sum_{j=1}^{2N_{c}} L_{j}^{2} = N_{c}\\alpha_{r}^{2} + N_{c}\\alpha_{f}^{2} = N_{c}(\\alpha_{r}^{2} + \\alpha_{f}^{2})\n$$\n使用我们之前的结果 $\\alpha_{r}^{2} + \\alpha_{f}^{2} = \\frac{W^{2}}{2}(1+s^{2})$，我们有：\n$$\n\\sigma_{Z}^{2} = N_{c}\\frac{W^{2}}{2}(1+s^{2})\n$$\n实部的方差是 $\\sigma^{2} = \\frac{1}{2}\\sigma_{Z}^{2} = N_{c}\\frac{W^{2}}{4}(1+s^{2})$。\n标准差是 $\\sigma = \\sqrt{N_{c}\\frac{W^{2}}{4}(1+s^{2})} = \\frac{W}{2}\\sqrt{N_{c}(1+s^{2})}$。\n和的期望模值为：\n$$\nE[|Z|] = \\sigma \\sqrt{\\frac{\\pi}{2}} = \\frac{W}{2}\\sqrt{N_{c}(1+s^{2})} \\sqrt{\\frac{\\pi}{2}} = \\frac{W\\sqrt{\\pi}}{2\\sqrt{2}}\\sqrt{N_{c}(1+s^{2})}\n$$\n现在我们可以计算偏差：\n$$\nM_{\\mathrm{bias}}(s, N_{c}) = \\frac{E[|Z|]}{N_{c}W} = \\frac{\\frac{W\\sqrt{\\pi}}{2\\sqrt{2}}\\sqrt{N_{c}(1+s^{2})}}{N_{c}W} = \\frac{\\sqrt{\\pi(1+s^{2})}}{2\\sqrt{2}\\sqrt{N_{c}}} = \\sqrt{\\frac{\\pi(1+s^{2})}{8N_{c}}}\n$$\n\n最后，我们通过从真实值中减去偏差来得到经替代数据校正的 PAC 幅值：\n$$\nM_{\\mathrm{corr}}(D, s, N_{c}) = M_{\\mathrm{true}}(D, s) - M_{\\mathrm{bias}}(s, N_{c})\n$$\n$$\nM_{\\mathrm{corr}}(D, s, N_{c}) = \\sqrt{\\cos^{2}(\\pi D) + s^{2}\\sin^{2}(\\pi D)} - \\sqrt{\\frac{\\pi(1+s^{2})}{8N_{c}}}\n$$\n这是作为 $D$、$s$ 和 $N_{c}$ 函数的最终闭式解析表达式。",
            "answer": "$$\n\\boxed{\\sqrt{\\cos^{2}(\\pi D) + s^{2}\\sin^{2}(\\pi D)} - \\sqrt{\\frac{\\pi(1+s^{2})}{8N_{c}}}}\n$$"
        }
    ]
}