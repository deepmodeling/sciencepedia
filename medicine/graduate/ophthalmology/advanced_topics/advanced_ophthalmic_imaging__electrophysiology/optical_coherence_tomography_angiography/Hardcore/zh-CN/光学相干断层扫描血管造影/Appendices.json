{
    "hands_on_practices": [
        {
            "introduction": "光学相干断层扫描血管成像（OCTA）的可靠性始于高质量的结构OCT信号重建。本练习将引导您解决光谱域OCT（SD-OCT）中的一个核心问题：$k$空间线性化。您将从第一性原理出发，推导为何必须对光谱仪采集的非均匀波数（$k$）样本进行重采样，并通过编写代码，利用校准反射镜的数据来实现这一关键校正步骤。这项实践将加深您对傅里叶域OCT信号处理基础的理解，这是获得精确深度信息和可靠血流信号的先决条件。",
            "id": "4705151",
            "problem": "在此任务中，您需要在光学相干断层扫描血管成像 (OCTA) 的背景下，基于谱域光学相干断层扫描 (SD-OCT) 的第一性原理进行工作。光学相干断层扫描血管成像 (OCTA) 通过比较重复的结构性SD-OCT采集来获得运动对比度；因此，结构性傅里叶域重建的保真度是可靠OCTA的先决条件。光谱仪中的离散相机在波长上进行均匀采样，而重建深度的傅里叶变换则需要对角波数进行均匀采样。您的任务是推导出将相机信号重采样为均匀间隔的角波数样本的必要性，并实现一个基于校准的算法，该算法使用固定反射镜的采集数据来执行此类重采样。\n\n请从核心的干涉测量和采样原理出发，推导为何必须将光谱仪输出重采样为均匀的角波数样本。从广泛使用的干涉形式开始，即来自单程物理深度为 $z$ 的单个反射体的光谱干涉图具有形式 $I(k) = S(k)\\left(C + A\\cos(2kz)\\right)$，其中 $k$ 是角波数（单位为弧度/米），$S(k)$ 是一个缓慢变化的光谱包络，$C$ 和 $A$ 是由光源和参考臂功率决定的常数。解释为何像素索引 $i$ 上的均匀采样对应于 $k$ 上的非均匀采样（由于色散和光谱仪几何结构），并说明这如何在像素间导致一个啁啾相位 $2k(i)z$。若不加以校正，该相位会在离散傅里叶变换后使深度峰展宽和定位错误。在此基础上，提出一个算法路径，利用校准反射镜来估计像素到 $k$ 的映射，并在深度重建前将任何测量的光谱重采样到一个均匀的 $k$ 网格上。\n\n您的程序必须仅使用校准反射镜的信息和已知的光谱端点来实现以下功能：\n- 生成合成校准数据，以模拟一个在像素到 $k$ 映射中具有色散引起的非线性的光谱仪。使用提供的测试套件参数，通过在像素索引 $i$ 处计算余弦分量 $\\cos(2z_0 k_{\\text{true}}(i))$ 并添加零均值噪声来合成反射镜干涉图 $I[i]$。真实映射 $k_{\\text{true}}(i)$ 必须构建为在下面定义的角波数端点 $k_{\\min}$ 和 $k_{\\max}$ 之间线性斜坡的扭曲版本，每个测试用例中会提供具体的扭曲系数。\n- 仅使用反射镜干涉图和已知的端点波长，估计一个严格递增的映射 $i \\mapsto \\hat{k}(i)$，该映射应在由端点解决的仿射模糊性范围内尽可能接近真实映射。在执行校准时，您不能假设了解任何内部扭曲参数；您可以依赖一种物理上合理的相位提取方法，该方法使用校准反射镜干涉图来恢复累积相位 $\\varphi(i)$ 及其解包裹形式。所有角度均以弧度为单位。\n- 使用估计的映射，将任何测量的光谱从像素索引重采样到一个包含 $N$ 个点的均匀 $k$ 网格上，该网格跨越 $[k_{\\min}, k_{\\max}]$。然后执行离散傅里叶域重建以定位反射镜深度，并报告绝对轴向定位误差。\n\n您可以作为起点假设的基本事实包括：(i) 对于在空气中传播（折射率 $n = 1$），$k = 2\\pi/\\lambda$，其中 $\\lambda$ 是自由空间波长；(ii) 单个反射体的光谱干涉图具有余弦相位项 $\\cos(2kz)$；(iii) 当输入样本在 $k$ 上均匀间隔时，离散傅里叶变换可以恢复反射率作为路径长度的函数。您必须推导出，而不仅仅是陈述，为什么 $k$ 采样的非均匀性会破坏傅里叶域重建，以及为什么基于校准的重采样可以校正它。\n\n合成模型和单位：\n- 设 $N$ 为光谱仪线上相机的像素数。像素索引为 $i \\in \\{0,1,\\dots,N-1\\}$。\n- 波长端点为 $\\lambda_{\\min}$ 和 $\\lambda_{\\max}$（单位为纳米），相应的角波数端点为 $k_{\\max} = 2\\pi/\\lambda_{\\min}$ 和 $k_{\\min} = 2\\pi/\\lambda_{\\max}$（单位为弧度/米）。\n- 未扭曲的线性角波数斜坡为 $k_{\\text{lin}}(i) = k_{\\min} + (k_{\\max} - k_{\\min})\\cdot i/(N-1)$。\n- 真实映射是一个扭曲版本 $k_{\\text{true}}(i) = k_{\\text{lin}}(i) + \\left(d_2 x^2 + d_3 x^3\\right)\\cdot (k_{\\max} - k_{\\min})$，其中 $x = i/(N-1) - 1/2$，$d_2$ 和 $d_3$ 是无量纲扭曲系数。该模型代表了使 $k$ 与像素索引呈非线性关系的光谱仪色散和光学畸变。\n- 校准反射镜产生一个带噪声的余弦采样 $I[i] = \\cos\\left(2 z_0 k_{\\text{true}}(i)\\right) + \\eta[i]$，其中 $\\eta[i]$ 是具有指定标准差的零均值高斯噪声。单程物理深度为 $z_0$（单位为毫米）。所有相位均以弧度为单位。\n\n深度重建和报告：\n- 在重采样到跨越 $[k_{\\min},k_{\\max}]$ 的 $N$ 个点的均匀 $k$ 间距上后，计算经切趾处理的零均值光谱的离散傅里叶变换的幅度。设正深度峰值索引为 $m \\in \\{1,2,\\dots,\\lfloor N/2\\rfloor\\}$，它在远离直流分量的范围内最大化幅度谱。对于均匀的 $k$ 间距 $\\Delta k = (k_{\\max}-k_{\\min})/(N-1)$，对应于索引 $m$ 的深度为 $z(m) = \\pi m/(N \\Delta k)$（单位为米）。用此公式估计反射镜深度 $\\hat{z}$。\n- 对每个测试用例，输出绝对误差 $|\\hat{z} - z_0|$（单位为微米），表示为一个四舍五入到三位小数的浮点数。\n\n角度单位要求：所有角度均以弧度为单位。物理单位要求：波长输入单位为纳米，深度输入单位为毫米，但您必须在内部转换为国际单位制（SI），以便角波数单位为弧度/米，深度单位为米。报告的误差必须以微米为单位。\n\n测试套件：\n- 用例 A (理想情况): $N = 1024$，$\\lambda_{\\min} = 800$ 纳米，$\\lambda_{\\max} = 880$ 纳米，$z_0 = 0.90$ 毫米，$d_2 = 0.03$，$d_3 = -0.02$，噪声标准差 $= 0.02$ (无量纲)，随机种子 $= 1$。\n- 用例 B (更强的非线性和更高的噪声): $N = 1024$，$\\lambda_{\\min} = 800$ 纳米，$\\lambda_{\\max} = 880$ 纳米，$z_0 = 1.95$ 毫米，$d_2 = 0.08$，$d_3 = 0.05$，噪声标准差 $= 0.10$ (无量纲)，随机种子 $= 2$。\n- 用例 C (更窄的带宽和更少的像素): $N = 512$，$\\lambda_{\\min} = 850$ 纳米，$\\lambda_{\\max} = 900$ 纳米，$z_0 = 1.20$ 毫米，$d_2 = -0.05$，$d_3 = 0.07$，噪声标准差 $= 0.05$ (无量纲)，随机种子 $= 3$。\n\n您的程序必须使用上述模型合成校准干涉图，仅使用反射镜信息和已知的光谱端点进行基于校准的 $k$ 线性化，通过离散傅里叶变换重建深度剖面，在每种情况下估计 $\\hat{z}$，并计算以微米为单位的绝对误差。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序为 [用例 A, 用例 B, 用例 C]，每个数字四舍五入到三位小数。例如：\"[xA,xB,xC]\"，其中 xA, xB, xC 是三个浮点数。",
            "solution": "该问题陈述经评估具有科学依据、问题明确且客观，因此被认为是有效的。以下是完整的解决方案。\n\n## 理论推导与算法设计\n\n### 1. SD-OCT的基本原理\n\n谱域光学相干断层扫描（SD-OCT）通过分析来自参考臂和样品臂的干涉光的频谱内容来工作。对于距离零延迟位置单程物理深度为 $z$ 的单个反射体，光谱仪测量的光谱强度 $I(k)$ 可以用以下干涉方程描述：\n$$\nI(k) = S(k) \\left( R_R + R_S + 2\\sqrt{R_R R_S} \\cos(2kz) \\right)\n$$\n其中 $k = 2\\pi/\\lambda$ 是角波数，$\\lambda$ 是真空波长，$S(k)$ 是光源的光谱功率分布，$R_R$ 和 $R_S$ 分别是参考臂和样品反射体的反射率。为简化起见，这通常写为：\n$$\nI(k) = S(k) \\left( C + A\\cos(2kz) \\right)\n$$\n关键的洞见在于，深度信息 $z$ 被编码在 $k$ 空间中光谱的余弦调制频率上。\n\n### 2. k空间均匀采样的必要性\n\nSD-OCT的目标是重建样品随深度变化的反射率剖面，即A扫描，记为 $R(z)$。这是通过认识到干涉项 $A S(k) \\cos(2kz)$ 和深度域反射率是一个傅里叶变换对来实现的。具体来说，光谱干涉图关于 $k$ 的傅里叶变换产生空间相关函数，其中包含对应于反射体深度的峰值。\n作为计算算法使用的离散傅里叶变换（DFT）定义为：\n$$\nX[m] = \\sum_{j=0}^{N-1} x[j] e^{-i 2\\pi mj/N}\n$$\n这个变换内在地假设输入序列 $x[j]$ 是由在其自变量的均匀间隔上采集的样本组成的。在我们的情境中，DFT的输入必须是在均匀间隔的角波数上采样的光谱强度 $I(k_j)$，即 $k_j = k_{\\min} + j \\Delta k$，其中步长 $\\Delta k$ 是一个常数。\n\n然而，典型的光谱仪并不会在 $k$ 上进行均匀采样。它由一个衍射光栅和一个线性探测器阵列（例如CCD或CMOS相机）组成，衍射光栅将光色散到探测器上。探测器上的位置（由像素索引 $i$ 给出）与波长 $\\lambda$ 近似成线性关系，而不是与波数 $k$。\n关系式 $k = 2\\pi/\\lambda$ 是根本非线性的。如果我们假设一个从像素索引 $i$ 到波长 $\\lambda(i) = \\lambda_0 + c \\cdot i$ 的简单线性映射，那么相应的波数为 $k(i) = 2\\pi / (\\lambda_0 + c \\cdot i)$。$k$ 空间中相邻样本之间的间距是：\n$$\n\\Delta k_i = k(i+1) - k(i) = \\frac{2\\pi}{\\lambda_0 + c(i+1)} - \\frac{2\\pi}{\\lambda_0 + c i} \\neq \\text{constant}\n$$\n这表明，在像素索引 $i$ （甚至在波长 $\\lambda$）上进行均匀采样，会导致在角波数 $k$ 上的非均匀采样。在实践中，光学畸变和光栅非线性（如问题中由多项式项 $d_2$ 和 $d_3$ 建模）会进一步扭曲 $i \\mapsto k(i)$ 的关系。\n\n### 3. 非均匀采样的后果\n\n如果将一个非均匀采样的干涉图 $I[i] = I(k(i))$ 直接输入到DFT算法中，结果将是一个损坏的A扫描。余弦项的相位是 $\\phi(k) = 2zk$。当在非均匀点 $k(i)$ 上采样时，离散相位是 $\\phi[i] = 2z k(i)$。这个信号关于样本索引 $i$ 的“瞬时频率”与相位的导数成正比，即 $d\\phi/di = 2z \\cdot (dk/di)$。由于 $k(i)$ 是 $i$ 的非线性函数，所以 $dk/di$ 不是常数。这意味着采样后的余弦项 $\\cos(2z k(i))$ 是一个啁啾信号，其频率在相机像素间变化。\n\n对啁啾信号进行DFT不会产生一个尖锐、明确的峰。相反，信号能量会分散到一系列DFT频格中。这表现为轴向点扩散函数（PSF）的展宽，从而降低了OCT图像的轴向分辨率。它还会降低峰值信噪比，并可能在测量的深度位置 $z$ 中引入误差。因此，为了实现高保真度的深度重建，必须在执行傅里叶变换之前，将原始光谱仪数据重采样到一个均匀的 $k$ 空间网格上。\n\n### 4. 校准与重采样的算法路径\n\n`像素到k` 的映射 $i \\mapsto k(i)$ 可以通过使用一个位于固定深度 $z_0$ 的单个固定反射镜进行校准来实验性地估计。\n\n**第1步：从校准数据中提取相位**\n来自校准反射镜的干涉图为 $I[i] = C' + A' \\cos(2z_0 k(i)) + \\eta[i]$。交流分量的相位 $\\phi(i) = 2z_0 k(i)$ 包含了我们想要的映射函数 $k(i)$。这个相位可以如下提取：\n- 通过减去信号的均值来移除直流分量 $C'$：$I_{AC}[i] = I[i] - \\text{mean}(I)$。\n- 使用希尔伯特变换 $\\mathcal{H}$ 构建一个解析信号：$I_{analytic}[i] = I_{AC}[i] + j \\mathcal{H}\\{I_{AC}[i]\\}$。\n- 瞬时相位是这个复信号的辐角：$\\phi_{wrapped}[i] = \\arg(I_{analytic}[i])$。这个相位被包裹在 $(-\\pi, \\pi]$ 范围内。\n- 应用相位解包裹算法来移除 $2\\pi$ 的不连续性，得到一个连续的相位剖面 $\\phi_{unwrapped}(i)$。\n\n**第2步：校准 $k(i)$ 映射**\n解包裹后的相位与真实的 $k$ 映射呈线性关系：$\\phi_{unwrapped}(i) \\approx \\alpha \\cdot k(i) + \\beta$，其中 $\\alpha = 2z_0$，$\\beta$ 是一个恒定的相位偏移。因此，我们可以说我们期望的映射 $\\hat{k}(i)$ 是测量的解包裹相位的一个线性变换：\n$$\n\\hat{k}(i) = a \\cdot \\phi_{unwrapped}(i) + b\n$$\n常数 $a$ 和 $b$ 由光谱仪光谱范围的已知边界条件确定。我们已知端点波长 $\\lambda_{\\min}$ 和 $\\lambda_{\\max}$，它们对应于已知的角波数 $k_{\\max} = 2\\pi/\\lambda_{\\min}$ 和 $k_{\\min} = 2\\pi/\\lambda_{\\max}$。假设像素索引 $i=0$ 和 $i=N-1$ 对应于这些端点，我们可以建立一个由两个线性方程组成的方程组：\n$$\n\\begin{cases}\nk_{\\min} = a \\cdot \\phi_{unwrapped}(0) + b \\\\\nk_{\\max} = a \\cdot \\phi_{unwrapped}(N-1) + b\n\\end{cases}\n$$\n解出 $a$ 和 $b$ 得：\n$$\na = \\frac{k_{\\max} - k_{\\min}}{\\phi_{unwrapped}(N-1) - \\phi_{unwrapped}(0)}\n$$\n$$\nb = k_{\\min} - a \\cdot \\phi_{unwrapped}(0)\n$$\n这提供了校准后的映射 $\\hat{k}(i)$，它近似于真实的 $k_{\\text{true}}(i)$。这个映射必须是严格递增的，这通过确保 $\\phi_{unwrapped}(i)$ 是单调递增的来强制实现（如有必要，可以翻转其符号）。\n\n**第3步：重采样与深度重建**\n有了估计的映射 $\\hat{k}(i)$，任何测量的光谱 $I_{meas}[i]$ 都可以被处理。\n- 定义一个 $k$ 空间中的目标均匀网格：$k_{uniform}[j] = k_{\\min} + j \\Delta k$，其中 $j=0, \\dots, N-1$，$\\Delta k = (k_{\\max} - k_{\\min})/(N-1)$。\n- 使用一维插值（例如线性插值）将测量的光谱 $I_{meas}[i]$（它是在非均匀点 $\\hat{k}(i)$ 上采样的）重采样到均匀网格 $k_{uniform}$ 上。这会产生重采样后的光谱 $I_{resampled}[j]$。\n- 为DFT准备重采样后的光谱：\n    - 将其乘以一个窗函数（例如汉宁窗）以减少频谱泄漏。\n    - 减去其均值以移除直流伪影。\n- 通过DFT计算深度剖面（A扫描）：$Z = \\text{DFT}(I_{resampled, processed})$。\n- 分析正深度范围（$m \\in \\{1, \\dots, \\lfloor N/2 \\rfloor\\}$）的幅度谱 $|\\Z[m]|$ 以找到最大峰值的索引 $m_{peak}$。\n- 使用从傅里叶理论导出并在问题中指定的公式计算估计深度 $\\hat{z}$：$\\hat{z} = \\pi m_{peak} / (N \\Delta k)$。\n- 最后，计算绝对轴向定位误差 $|\\hat{z} - z_0|$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.signal import hilbert\n\ndef solve():\n    \"\"\"\n    Solves the OCT k-space resampling and depth reconstruction problem\n    for the given test suite.\n    \"\"\"\n    test_cases = [\n        {\n            \"N\": 1024, \"lambda_min_nm\": 800, \"lambda_max_nm\": 880,\n            \"z0_mm\": 0.90, \"d2\": 0.03, \"d3\": -0.02,\n            \"noise_std\": 0.02, \"seed\": 1,\n        },\n        {\n            \"N\": 1024, \"lambda_min_nm\": 800, \"lambda_max_nm\": 880,\n            \"z0_mm\": 1.95, \"d2\": 0.08, \"d3\": 0.05,\n            \"noise_std\": 0.10, \"seed\": 2,\n        },\n        {\n            \"N\": 512, \"lambda_min_nm\": 850, \"lambda_max_nm\": 900,\n            \"z0_mm\": 1.20, \"d2\": -0.05, \"d3\": 0.07,\n            \"noise_std\": 0.05, \"seed\": 3,\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        N = params[\"N\"]\n        lambda_min_nm = params[\"lambda_min_nm\"]\n        lambda_max_nm = params[\"lambda_max_nm\"]\n        z0_mm = params[\"z0_mm\"]\n        d2 = params[\"d2\"]\n        d3 = params[\"d3\"]\n        noise_std = params[\"noise_std\"]\n        seed = params[\"seed\"]\n\n        # --- Unit Conversions to SI ---\n        z0_m = z0_mm * 1e-3\n        lambda_min_m = lambda_min_nm * 1e-9\n        lambda_max_m = lambda_max_nm * 1e-9\n\n        # --- k-space Setup ---\n        k_max = 2 * np.pi / lambda_min_m\n        k_min = 2 * np.pi / lambda_max_m\n        k_range = k_max - k_min\n\n        # --- Synthesize Calibration Data ---\n        pixel_indices = np.arange(N)\n        # x is a normalized coordinate from -0.5 to 0.5\n        x = pixel_indices / (N - 1) - 0.5\n        \n        # Linear and warped k-mappings\n        k_lin = k_min + k_range * pixel_indices / (N - 1)\n        k_warp_poly = (d2 * x**2 + d3 * x**3) * k_range\n        k_true = k_lin + k_warp_poly\n\n        # Generate interferogram with noise\n        rng = np.random.default_rng(seed)\n        noise = rng.normal(0, noise_std, N)\n        I_calib = np.cos(2 * z0_m * k_true) + noise\n\n        # --- Calibration: Estimate k(i) Mapping ---\n        # 1. Hilbert transform-based phase extraction\n        I_ac = I_calib - np.mean(I_calib)\n        analytic_signal = hilbert(I_ac)\n        wrapped_phase = np.angle(analytic_signal)\n        unwrapped_phase = np.unwrap(wrapped_phase)\n\n        # 2. Ensure phase is monotonically increasing, as k increases with pixel index\n        if unwrapped_phase[-1]  unwrapped_phase[0]:\n            unwrapped_phase = -unwrapped_phase\n            # If we flip the sign, the phase might have an overall offset.\n            # We must re-center it around its start to maintain consistency.\n            unwrapped_phase -= unwrapped_phase[0] - (-unwrapped_phase[0])\n\n        # 3. Solve for linear scaling factors to map phase to k\n        phi_0 = unwrapped_phase[0]\n        phi_N = unwrapped_phase[-1]\n        \n        # a = (y2 - y1) / (x2 - x1)\n        a = k_range / (phi_N - phi_0)\n        # b = y1 - a * x1\n        b = k_min - a * phi_0\n        \n        k_est = a * unwrapped_phase + b\n\n        # --- Resampling and Depth Reconstruction ---\n        # 1. Define uniform k grid\n        k_uniform = np.linspace(k_min, k_max, N)\n        delta_k = (k_max - k_min) / (N - 1)\n\n        # 2. Interpolate the measured spectrum onto the uniform grid\n        # We use the calibration interferogram itself as the spectrum to resample.\n        I_resampled = np.interp(k_uniform, k_est, I_calib)\n\n        # 3. Prepare for FFT\n        window = np.hanning(N)\n        I_windowed = I_resampled * window\n        I_final = I_windowed - np.mean(I_windowed)\n        \n        # 4. Perform FFT and find peak\n        Z = np.fft.fft(I_final)\n        \n        # Analyze positive depth range, excluding DC component at index 0\n        positive_depth_range = Z[1 : N // 2]\n        Z_mag = np.abs(positive_depth_range)\n        \n        # Find peak index (add 1 because our slice started at index 1)\n        m_peak_local = np.argmax(Z_mag)\n        m_peak = m_peak_local + 1\n\n        # --- Calculate Depth and Error ---\n        # Use the formula provided in the problem statement\n        z_hat_m = (np.pi * m_peak) / (N * delta_k)\n        \n        error_m = np.abs(z_hat_m - z0_m)\n        error_um = error_m * 1e6\n        \n        results.append(round(error_um, 3))\n\n    # --- Final Output Formatting ---\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "从OCTA图像中提取有意义的定量生物标志物是临床研究的关键。本练习将重点探讨两种常用的定量指标：灌注密度（PD）和血管密度（VD），并揭示它们在评估血管病理时的不同敏感性。通过对一个模拟毛细血管脱落场景进行具体计算，您将亲手量化这两种度量方式的差异，并理解为何基于骨架化的VD指标对毛细血管的丢失比基于面积的PD指标更为敏感。这项实践对于准确解读定量OCTA数据和设计严谨的研究至关重要。",
            "id": "4705189",
            "problem": "采集了一幅 3 $\\times$ 3 $\\mathrm{mm}$ 的黄斑区浅层毛细血管丛光学相干层析血管成像 (OCTA) 图，并通过二值化和骨架化进行处理。光学相干层析血管成像 (OCTA) 是一种通过检测血流的运动对比度来可视化灌注血管系统的成像方式。该图像包含 $300 \\times 300$ 个像素，覆盖 3 $\\times$ 3 $\\mathrm{mm}$ 的视场。在浅层毛细血管丛的定量分析中，使用以下操作性定义：灌注密度 (PD) 定义为无量纲分数 $N_{\\mathrm{vessel}} / N_{\\mathrm{total}}$，其中 $N_{\\mathrm{vessel}}$ 是二值化血管像素的数量，$N_{\\mathrm{total}}$ 是视场中的总像素数；血管密度 (VD) 定义为无量纲分数 $N_{\\mathrm{skeleton}} / N_{\\mathrm{total}}$，其中 $N_{\\mathrm{skeleton}}$ 是骨架化血管像素（中心线像素）的数量，$N_{\\mathrm{total}}$ 的定义同上。一个中心的 1 $\\times$ 1 $\\mathrm{mm}$ 子区域对应于嵌入在较大视场内的 $100 \\times 100$ 像素。\n\n在发生任何病理变化之前，整个 3 $\\times$ 3 $\\mathrm{mm}$ 视场有 $N_{\\mathrm{vessel}} = 28{,}800$ 个二值化血管像素和 $N_{\\mathrm{skeleton}} = 18{,}000$ 个骨架化血管像素。在中心的 1 $\\times$ 1 $\\mathrm{mm}$ 子区域内，脱落前的计数为 $N_{\\mathrm{vessel,sub}} = 4{,}000$ 和 $N_{\\mathrm{skeleton,sub}} = 3{,}000$。\n\n在中心子区域发生了一次靶向性毛细血管脱落事件，该事件未影响较大的小动脉和小静脉，但消除了毛细血管床的主要部分。脱落后，中心子区域的计数变为 $N_{\\mathrm{vessel,sub}} = 2{,}000$ 和 $N_{\\mathrm{skeleton,sub}} = 600$。假设视场的其余部分保持不变。\n\n仅使用所提供的定义和基于计数的推理，计算：\n1. 整个 3 $\\times$ 3 $\\mathrm{mm}$ 视场在脱落前的灌注密度 $PD_{\\mathrm{pre}}$ 和血管密度 $VD_{\\mathrm{pre}}$（所有密度均以无量纲分数表示）。\n2. 整个视场在脱落后的灌注密度 $PD_{\\mathrm{post}}$ 和血管密度 $VD_{\\mathrm{post}}$。\n3. 灌注密度的分数变化 $\\Delta PD / PD_{\\mathrm{pre}}$ 和血管密度的分数变化 $\\Delta VD / VD_{\\mathrm{pre}}$，其中 $\\Delta PD = PD_{\\mathrm{post}} - PD_{\\mathrm{pre}}$ 且 $\\Delta VD = VD_{\\mathrm{post}} - VD_{\\mathrm{pre}}$。\n4. 偏倚因子 $B$，定义为分数变化幅度的比率，即 $B = \\frac{|\\Delta VD / VD_{\\mathrm{pre}}|}{|\\Delta PD / PD_{\\mathrm{pre}}|}$。\n\n根据定义和变化情景，简要解释为什么在出现毛细血管脱落时，骨架化会使 VD 相对于 PD 的敏感性产生偏倚。将 $B$ 的单个数值作为最终答案，并将最终答案四舍五入到四位有效数字。所有密度均以无量纲分数表示。",
            "solution": "该问题围绕着使用二值化和骨架化从光学相干层析血管成像 (OCTA) 图像中派生出的定量指标展开。基本定义如下：\n- 灌注密度 $PD$ 是在二值化图中被分类为血流阳性的像素所占的比例：$PD = \\frac{N_{\\mathrm{vessel}}}{N_{\\mathrm{total}}}$。\n- 血管密度 $VD$ 是构成血管骨架化中心线表示的像素所占的比例：$VD = \\frac{N_{\\mathrm{skeleton}}}{N_{\\mathrm{total}}}$。\n\n3 $\\times$ 3 $\\mathrm{mm}$ 视场中的总像素数为 $N_{\\mathrm{total}} = 300 \\times 300 = 90{,}000$。\n\n步骤1：计算整个视场在脱落前的 PD 和 VD。\n已知脱落前 $N_{\\mathrm{vessel}} = 28{,}800$ 且 $N_{\\mathrm{skeleton}} = 18{,}000$，\n\n$$\nPD_{\\mathrm{pre}} = \\frac{28{,}800}{90{,}000} = \\frac{288}{900} = \\frac{32}{100} = \\frac{8}{25}.\n$$\n\n\n$$\nVD_{\\mathrm{pre}} = \\frac{18{,}000}{90{,}000} = \\frac{180}{900} = \\frac{20}{100} = \\frac{1}{5}.\n$$\n\n\n步骤2：确定整个视场在脱落后的计数，并计算 PD 和 VD。\n脱落仅限于中心的 $100 \\times 100$ 像素子区域。脱落前子区域的计数为 $N_{\\mathrm{vessel,sub}} = 4{,}000$ 和 $N_{\\mathrm{skeleton,sub}} = 3{,}000$。脱落后子区域的计数为 $N_{\\mathrm{vessel,sub}} = 2{,}000$ 和 $N_{\\mathrm{skeleton,sub}} = 600$。因此，该子区域减少了\n\n$$\n\\Delta N_{\\mathrm{vessel,sub}} = 4{,}000 - 2{,}000 = 2{,}000,\n$$\n\n\n$$\n\\Delta N_{\\mathrm{skeleton,sub}} = 3{,}000 - 600 = 2{,}400.\n$$\n\n假设视场的其余部分保持不变，则整个视场脱落后的计数变为\n\n$$\nN_{\\mathrm{vessel,post}} = 28{,}800 - 2{,}000 = 26{,}800,\n$$\n\n\n$$\nN_{\\mathrm{skeleton,post}} = 18{,}000 - 2{,}400 = 15{,}600.\n$$\n\n因此，\n\n$$\nPD_{\\mathrm{post}} = \\frac{26{,}800}{90{,}000} = \\frac{268}{900} = \\frac{67}{225}.\n$$\n\n\n$$\nVD_{\\mathrm{post}} = \\frac{15{,}600}{90{,}000} = \\frac{156}{900} = \\frac{26}{150} = \\frac{13}{75}.\n$$\n\n\n步骤3：计算分数变化。\n定义 $\\Delta PD = PD_{\\mathrm{post}} - PD_{\\mathrm{pre}}$ 和 $\\Delta VD = VD_{\\mathrm{post}} - VD_{\\mathrm{pre}}$。使用精确分数计算：\n\n$$\n\\Delta PD = \\frac{67}{225} - \\frac{8}{25}.\n$$\n\n通分：$\\frac{8}{25} = \\frac{360}{1125}$ 且 $\\frac{67}{225} = \\frac{335}{1125}$，所以\n\n$$\n\\Delta PD = \\frac{335}{1125} - \\frac{360}{1125} = -\\frac{25}{1125} = -\\frac{1}{45}.\n$$\n\n则灌注密度的分数变化为\n\n$$\n\\frac{\\Delta PD}{PD_{\\mathrm{pre}}} = \\frac{-\\frac{1}{45}}{\\frac{8}{25}} = -\\frac{1}{45} \\cdot \\frac{25}{8} = -\\frac{25}{360} = -\\frac{5}{72}.\n$$\n\n同理，对于血管密度，\n\n$$\n\\Delta VD = \\frac{13}{75} - \\frac{1}{5} = \\frac{13}{75} - \\frac{15}{75} = -\\frac{2}{75},\n$$\n\n\n$$\n\\frac{\\Delta VD}{VD_{\\mathrm{pre}}} = \\frac{-\\frac{2}{75}}{\\frac{1}{5}} = -\\frac{2}{75} \\cdot 5 = -\\frac{10}{75} = -\\frac{2}{15}.\n$$\n\n\n步骤4：计算偏倚因子 $B$。\n根据定义，\n\n$$\nB = \\frac{\\left|\\frac{\\Delta VD}{VD_{\\mathrm{pre}}}\\right|}{\\left|\\frac{\\Delta PD}{PD_{\\mathrm{pre}}}\\right|} = \\frac{\\left|\\,-\\frac{2}{15}\\,\\right|}{\\left|\\,-\\frac{5}{72}\\,\\right|} = \\frac{\\frac{2}{15}}{\\frac{5}{72}} = \\frac{2}{15} \\cdot \\frac{72}{5} = \\frac{144}{75} = \\frac{48}{25}.\n$$\n\n\n对偏倚的解释和讨论：\n灌注密度 $PD$ 是基于面积的，计算所有血管像素，因此受血管口径的加权影响：由于宽度较大，小动脉和小静脉会贡献许多像素。经过骨架化处理后的血管密度 $VD$ 是基于长度的，仅计算中心线像素，与血管宽度无关。在毛细血管脱落中，许多小口径的毛细血管消失，从而大幅减少了总血管长度，而大血管则保持完整。因此，$VD$ 的下降幅度大于 $PD$，因为骨架化移除了宽度信息，并强调了毛细血管中心线的损失。计算出的偏倚因子 $B = \\frac{48}{25}$ 量化了在给定情景下，$VD$ 的分数变化比 $PD$ 的分数变化大 $\\frac{48}{25}$ 倍。\n\n数值报告：\n将 $B = \\frac{48}{25} = 1.92$ 四舍五入到四位有效数字，得到 $1.920$。",
            "answer": "$$\\boxed{1.920}$$"
        },
        {
            "introduction": "投影伪影是OCTA技术的主要限制之一，它会在无血流的深层组织中产生虚假的血流信号，从而干扰诊断。本练习将引导您设计一种先进的算法来解决这一问题。您将基于一个合理的信号模型，运用最小均方误差原理推导出一个最佳线性滤波器的参数，该滤波器能够有效抑制伪影，同时保留深层结构中真实的血流信号。这项实践不仅能让您掌握一种重要的伪影去除技术，更能让您体会到如何利用信号处理理论来提升医学成像的保真度。",
            "id": "4705126",
            "problem": "光学相干断层扫描血管成像 (OCTA) 系统通过计算重复采集的复数值光学相干断层扫描 (OCT) 信号之间的强度去相关来测量深度分辨的血流。令深度 $z$ 处的局部去相关定义为 $D(z) = 1 - |\\gamma(z)|$，其中 $\\gamma(z)$ 是深度 $z$ 处重复 OCT 信号之间归一化复数互相关的幅值。令结构强度为 $I(z) = \\mathbb{E}[|A(z)|^{2}]$，其中 $A(z)$ 是复数 OCT 振幅，$\\mathbb{E}[\\cdot]$ 表示系综平均。\n\n当来自表层血管系统的动态散射通过多次散射和阴影调制在更深层次引起伪去相关时，就会出现投影伪影。在深层切片的一个小的横向区域上，将深度样本 $z_i$ 处的测量去相关建模为\n$$\nS_i = F_i + \\beta\\, I_i\\, P + \\epsilon_i,\n$$\n其中 $F_i$ 是真实的深层血流去相关（感兴趣的信号），$\\beta$ 是一个未知的投影增益常数，$I_i$ 是局部结构强度（假设经过高通归一化，使得 $\\mathbb{E}[I_i]=0$ 且 $\\mathrm{Var}(I_i)=\\sigma_I^{2}$），$P$ 是该切片共有的一个随机表层血流驱动，而 $\\epsilon_i$ 是测量噪声。假设 $F_i$、$I_i$、$P$ 和 $\\epsilon_i$ 是相互独立的零均值随机变量，其方差分别为 $\\mathrm{Var}(F_i)=\\sigma_F^{2}$、$\\mathrm{Var}(P)=\\sigma_P^{2}$ 和 $\\mathrm{Var}(\\epsilon_i)=\\sigma_{\\epsilon}^{2}$。\n\n一个表层去相关代理被测量为\n$$\nM = P + \\nu,\n$$\n其中 $\\nu$ 是独立的零均值噪声，其方差为 $\\mathrm{Var}(\\nu)=\\sigma_{\\nu}^{2}$。\n\n考虑一个投影分辨线性滤波器，它减去一个与由表层去相关代理加权的局部结构强度成正比的项：\n$$\n\\widehat{F}_i = S_i - \\alpha\\, I_i\\, M,\n$$\n其中标量参数 $\\alpha \\in \\mathbb{R}$ 待定。\n\n仅使用上述建模假设和标准的均方最优性原理，推导使期望均方误差 $\\mathbb{E}\\big[(\\widehat{F}_i - F_i)^{2}\\big]$ 最小化的 $\\alpha$ 值。通过对残余伪影功率的显式计算，说明该滤波器如何在保留深层血流分量的同时减少投影伪影。\n\n最后，对于参数值 $\\beta = 0.6$、$\\sigma_P^{2} = 2.5 \\times 10^{-3}$ 和 $\\sigma_{\\nu}^{2} = 5.0 \\times 10^{-4}$，计算最优的 $\\alpha$。将你的答案四舍五入到四位有效数字。将最终结果表示为一个无量纲数。",
            "solution": "该问题要求推导最优线性滤波器参数 $\\alpha$，以最小化光学相干断层扫描血管成像 (OCTA) 中的投影伪影。优化准则是最小化估计的真实血流信号 $\\widehat{F}_i$ 与实际真实血流信号 $F_i$ 之间的期望均方误差。\n\n目标是找到使成本函数 $J(\\alpha)$ 最小化的 $\\alpha \\in \\mathbb{R}$ 的值，该成本函数定义为期望均方误差：\n$$\nJ(\\alpha) = \\mathbb{E}\\big[(\\widehat{F}_i - F_i)^{2}\\big]\n$$\n首先，我们用问题中定义的基本随机变量来表示误差项 $\\widehat{F}_i - F_i$。滤波后的信号由 $\\widehat{F}_i = S_i - \\alpha\\, I_i\\, M$ 给出。\n将此代入误差表达式中得到：\n$$\n\\widehat{F}_i - F_i = (S_i - \\alpha\\, I_i\\, M) - F_i\n$$\n问题给出了测量信号 $S_i$ 和表层去相关代理 $M$ 的模型：\n$$\nS_i = F_i + \\beta\\, I_i\\, P + \\epsilon_i\n$$\n$$\nM = P + \\nu\n$$\n将这些模型代入误差项：\n$$\n\\widehat{F}_i - F_i = (F_i + \\beta\\, I_i\\, P + \\epsilon_i) - \\alpha\\, I_i\\, (P + \\nu) - F_i\n$$\n合并同类项，$F_i$ 分量相互抵消，得到：\n$$\n\\widehat{F}_i - F_i = (\\beta\\, I_i\\, P - \\alpha\\, I_i\\, P) - \\alpha\\, I_i\\, \\nu + \\epsilon_i = (\\beta - \\alpha) I_i\\, P - \\alpha\\, I_i\\, \\nu + \\epsilon_i\n$$\n现在，我们可以用这个误差表达式来写出成本函数 $J(\\alpha)$：\n$$\nJ(\\alpha) = \\mathbb{E}\\left[ \\big( (\\beta - \\alpha) I_i\\, P - \\alpha\\, I_i\\, \\nu + \\epsilon_i \\big)^2 \\right]\n$$\n为了计算期望，我们展开平方项：\n$$\nJ(\\alpha) = \\mathbb{E}\\left[ (\\beta - \\alpha)^2 I_i^2 P^2 + \\alpha^2 I_i^2 \\nu^2 + \\epsilon_i^2 - 2\\alpha(\\beta - \\alpha)I_i^2 P \\nu + 2(\\beta - \\alpha)I_i P \\epsilon_i - 2\\alpha I_i \\nu \\epsilon_i \\right]\n$$\n根据期望算子的线性性质，我们可以分别对每一项取期望。问题说明随机变量 $F_i$、$I_i$、$P$、$\\epsilon_i$ 和 $\\nu$ 是相互独立且均值为零的。这意味着任何包含单个变量奇数次幂的这些变量的乘积的期望为零。因此，所有交叉乘积项的期望都为零：\n$$\n\\mathbb{E}[I_i^2 P \\nu] = \\mathbb{E}[I_i^2] \\mathbb{E}[P] \\mathbb{E}[\\nu] = \\mathbb{E}[I_i^2] \\cdot 0 \\cdot 0 = 0\n$$\n$$\n\\mathbb{E}[I_i P \\epsilon_i] = \\mathbb{E}[I_i] \\mathbb{E}[P] \\mathbb{E}[\\epsilon_i] = 0 \\cdot 0 \\cdot 0 = 0\n$$\n$$\n\\mathbb{E}[I_i \\nu \\epsilon_i] = \\mathbb{E}[I_i] \\mathbb{E}[\\nu] \\mathbb{E}[\\epsilon_i] = 0 \\cdot 0 \\cdot 0 = 0\n$$\n成本函数简化为平方项期望的总和：\n$$\nJ(\\alpha) = \\mathbb{E}\\left[ (\\beta - \\alpha)^2 I_i^2 P^2 \\right] + \\mathbb{E}\\left[ \\alpha^2 I_i^2 \\nu^2 \\right] + \\mathbb{E}\\left[ \\epsilon_i^2 \\right]\n$$\n再次利用独立性，我们可以分离各项的期望：\n$$\nJ(\\alpha) = (\\beta - \\alpha)^2 \\mathbb{E}[I_i^2] \\mathbb{E}[P^2] + \\alpha^2 \\mathbb{E}[I_i^2] \\mathbb{E}[\\nu^2] + \\mathbb{E}[\\epsilon_i^2]\n$$\n对于一个零均值随机变量 $X$，其方差为 $\\mathrm{Var}(X) = \\mathbb{E}[X^2]$。使用给定的方差 $\\mathrm{Var}(I_i)=\\sigma_I^{2}$、$\\mathrm{Var}(P)=\\sigma_P^{2}$、$\\mathrm{Var}(\\nu)=\\sigma_{\\nu}^{2}$ 和 $\\mathrm{Var}(\\epsilon_i)=\\sigma_{\\epsilon}^{2}$：\n$$\nJ(\\alpha) = (\\beta - \\alpha)^2 \\sigma_I^2 \\sigma_P^2 + \\alpha^2 \\sigma_I^2 \\sigma_\\nu^2 + \\sigma_\\epsilon^2\n$$\n为了找到使 $J(\\alpha)$ 最小化的 $\\alpha$ 值，我们对 $J(\\alpha)$ 关于 $\\alpha$ 求导，并令结果为零：\n$$\n\\frac{dJ}{d\\alpha} = \\frac{d}{d\\alpha} \\left[ (\\beta^2 - 2\\beta\\alpha + \\alpha^2) \\sigma_I^2 \\sigma_P^2 + \\alpha^2 \\sigma_I^2 \\sigma_\\nu^2 + \\sigma_\\epsilon^2 \\right]\n$$\n$$\n\\frac{dJ}{d\\alpha} = (-2\\beta + 2\\alpha) \\sigma_I^2 \\sigma_P^2 + 2\\alpha \\sigma_I^2 \\sigma_\\nu^2\n$$\n令导数为零以找到驻点：\n$$\n2\\alpha \\sigma_I^2 \\sigma_P^2 - 2\\beta \\sigma_I^2 \\sigma_P^2 + 2\\alpha \\sigma_I^2 \\sigma_\\nu^2 = 0\n$$\n假设 $\\sigma_I^2 \\neq 0$，我们可以除以 $2\\sigma_I^2$：\n$$\n\\alpha \\sigma_P^2 - \\beta \\sigma_P^2 + \\alpha \\sigma_\\nu^2 = 0\n$$\n$$\n\\alpha (\\sigma_P^2 + \\sigma_\\nu^2) = \\beta \\sigma_P^2\n$$\n求解 $\\alpha$ 得到最优值 $\\alpha_{opt}$：\n$$\n\\alpha_{opt} = \\beta \\frac{\\sigma_P^2}{\\sigma_P^2 + \\sigma_\\nu^2}\n$$\n二阶导数 $\\frac{d^2J}{d\\alpha^2} = 2\\sigma_I^2(\\sigma_P^2 + \\sigma_\\nu^2)$ 是正的（因为方差是非负的），这证实了此 $\\alpha$ 值对应一个最小值。\n\n接下来，我们分析该滤波器如何影响信号和伪影分量。估计的信号为：\n$$\n\\widehat{F}_i = S_i - \\alpha I_i M = (F_i + \\beta I_i P + \\epsilon_i) - \\alpha I_i (P+\\nu) = F_i + (\\beta-\\alpha)I_i P - \\alpha I_i \\nu + \\epsilon_i\n$$\n真实的血流分量 $F_i$ 在滤波后的信号中以系数1出现。这表明该滤波器完美地保留了感兴趣的深层血流信号。\n\n原始信号 $S_i$ 中的投影伪影是 $\\beta I_i P$ 项。其功率是 $\\mathrm{Var}(\\beta I_i P) = \\beta^2 \\mathrm{Var}(I_i P) = \\beta^2 \\mathbb{E}[I_i^2 P^2] = \\beta^2 \\mathbb{E}[I_i^2]\\mathbb{E}[P^2] = \\beta^2 \\sigma_I^2 \\sigma_P^2$。滤波后信号 $\\widehat{F}_i$ 中的残余伪影功率是剩余的伪影相关项 $(\\beta-\\alpha)I_i P - \\alpha I_i \\nu$ 的方差。该功率恰好是均方误差中依赖于 $\\alpha$ 的分量：\n$$\nP_{resid}(\\alpha) = \\mathrm{Var}((\\beta-\\alpha)I_i P - \\alpha I_i \\nu) = (\\beta - \\alpha)^2 \\sigma_I^2 \\sigma_P^2 + \\alpha^2 \\sigma_I^2 \\sigma_\\nu^2\n$$\n我们对 $\\alpha_{opt}$ 的推导就是基于最小化该项。代入 $\\alpha_{opt}$ 得到最小残余伪影功率：\n$$\nP_{resid, min} = P_{resid}(\\alpha_{opt}) = \\left(\\beta - \\beta \\frac{\\sigma_P^2}{\\sigma_P^2 + \\sigma_\\nu^2}\\right)^2 \\sigma_I^2 \\sigma_P^2 + \\left(\\beta \\frac{\\sigma_P^2}{\\sigma_P^2 + \\sigma_\\nu^2}\\right)^2 \\sigma_I^2 \\sigma_\\nu^2\n$$\n$$\nP_{resid, min} = \\beta^2 \\left(\\frac{\\sigma_\\nu^2}{\\sigma_P^2 + \\sigma_\\nu^2}\\right)^2 \\sigma_I^2 \\sigma_P^2 + \\beta^2 \\frac{(\\sigma_P^2)^2}{(\\sigma_P^2 + \\sigma_\\nu^2)^2} \\sigma_I^2 \\sigma_\\nu^2\n$$\n$$\nP_{resid, min} = \\frac{\\beta^2 \\sigma_I^2}{(\\sigma_P^2 + \\sigma_\\nu^2)^2} \\left[ (\\sigma_\\nu^2)^2 \\sigma_P^2 + (\\sigma_P^2)^2 \\sigma_\\nu^2 \\right] = \\frac{\\beta^2 \\sigma_I^2 \\sigma_P^2 \\sigma_\\nu^2 (\\sigma_\\nu^2 + \\sigma_P^2)}{(\\sigma_P^2 + \\sigma_\\nu^2)^2}\n$$\n$$\nP_{resid, min} = (\\beta^2 \\sigma_I^2 \\sigma_P^2) \\left( \\frac{\\sigma_\\nu^2}{\\sigma_P^2 + \\sigma_\\nu^2} \\right)\n$$\n由于原始伪影功率是 $\\beta^2 \\sigma_I^2 \\sigma_P^2$ 且对于非零方差，缩减因子 $\\frac{\\sigma_\\nu^2}{\\sigma_P^2 + \\sigma_\\nu^2}$ 严格小于1，此计算明确表明该滤波器减少了投影伪影功率。\n\n最后，我们为给定的参数值计算最优的 $\\alpha$：$\\beta = 0.6$、$\\sigma_P^{2} = 2.5 \\times 10^{-3}$ 和 $\\sigma_{\\nu}^{2} = 5.0 \\times 10^{-4}$。\n$$\n\\alpha_{opt} = 0.6 \\times \\frac{2.5 \\times 10^{-3}}{2.5 \\times 10^{-3} + 5.0 \\times 10^{-4}}\n$$\n$$\n\\alpha_{opt} = 0.6 \\times \\frac{2.5 \\times 10^{-3}}{3.0 \\times 10^{-3}}\n$$\n$$\n\\alpha_{opt} = 0.6 \\times \\frac{2.5}{3.0} = \\frac{6}{10} \\times \\frac{5}{6} = \\frac{30}{60} = \\frac{1}{2} = 0.5\n$$\n问题要求四舍五入到四位有效数字。精确值为 $0.5$。\n表示为四位有效数字，结果是 $0.5000$。",
            "answer": "$$\n\\boxed{0.5000}\n$$"
        }
    ]
}