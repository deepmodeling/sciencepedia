{
    "hands_on_practices": [
        {
            "introduction": "点扩散函数 (PSF) 通常可以用高斯函数来建模，这是理解其对图像分辨率影响的起点。为了量化这种模糊效应，我们使用一个叫做半峰全宽 ($FWHM$) 的关键指标。这个练习将指导你推导出高斯函数标准差 ($\\sigma$) 与 $FWHM$ 之间的直接关系，从而巩固你对一个数学参数如何转化为物理分辨率度量的理解 。",
            "id": "4892468",
            "problem": "在一维、线性和移位不变的医学成像系统中，点扩散函数 (PSF) 是表征空间模糊的脉冲响应。假设点扩散函数 (PSF) 是标准差为 $\\sigma$ 的高斯函数，其函数形式为 $h(x)=\\dfrac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\dfrac{x^{2}}{2\\sigma^{2}}\\right)$。一个非负对称函数的半峰全宽 (FWHM) 定义为该函数达到其全局最大值一半的两个点之间的距离。\n\n仅使用这些定义和自然对数的基本性质，推导此高斯点扩散函数 (PSF) 的半峰全宽 (FWHM) 关于 $\\sigma$ 的解析表达式。然后，对 $\\sigma = 0.6$ 毫米，计算您的表达式。以毫米为单位表示最终数值结果，并将您的答案四舍五入到四位有效数字。",
            "solution": "我们从一维空间中高斯点扩散函数 (PSF) 的定义开始，\n$$\nh(x)=\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right).\n$$\n根据定义，一个非负对称函数的半峰全宽 (FWHM) 是函数值等于其最大值一半的两个点之间的距离。高斯函数 $h(x)$ 是偶函数，在 $x=0$ 处达到其全局最大值。其最大值为\n$$\nh(0)=\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}.\n$$\n令 $x_{1/2}>0$ 表示 $h(x)$ 等于其最大值一半的正位置。半峰值条件是\n$$\nh(x_{1/2})=\\frac{1}{2}\\,h(0).\n$$\n代入 $h(x)$ 的显式形式并消去公共的归一化因子，得到\n$$\n\\exp\\!\\left(-\\frac{x_{1/2}^{2}}{2\\sigma^{2}}\\right)=\\frac{1}{2}.\n$$\n对两边取自然对数，得到\n$$\n-\\frac{x_{1/2}^{2}}{2\\sigma^{2}}=\\ln\\!\\left(\\frac{1}{2}\\right)=-\\ln(2),\n$$\n使得\n$$\nx_{1/2}^{2}=2\\sigma^{2}\\ln(2)\\quad\\Rightarrow\\quad x_{1/2}=\\sigma\\,\\sqrt{2\\ln(2)}.\n$$\n因为高斯函数是对称的，所以两个半峰值点位于 $x=\\pm x_{1/2}$，因此半峰全宽是这两点之间的距离：\n$$\n\\mathrm{FWHM}=2\\,x_{1/2}=2\\,\\sigma\\,\\sqrt{2\\ln(2)}.\n$$\n\n为给定的标准差 $\\sigma$ 计算此值，代入 $\\sigma=0.6$ 毫米：\n$$\n\\mathrm{FWHM}=2\\,(0.6)\\,\\sqrt{2\\ln(2)}\\ \\text{ 毫米}。\n$$\n计算无量纲因子 $\\sqrt{2\\ln(2)}$。在符号上，保持常数不变，直到最终的数值计算。使用 $\\ln(2)$ 作为 $2$ 的自然对数，我们有\n$$\n\\mathrm{FWHM}=(1.2)\\,\\sqrt{2\\ln(2)}\\ \\text{ 毫米}。\n$$\n在最后一步进行数值计算，\n$$\n\\sqrt{2\\ln(2)}\\approx 1.177410022,\\quad \\text{所以}\\quad \\mathrm{FWHM}\\approx (1.2)\\times(1.177410022)=1.412892026\\ \\text{ 毫米}。\n$$\n按要求四舍五入到四位有效数字并以毫米为单位表示该值，得到\n$$\n\\mathrm{FWHM}=1.413\\ \\text{ 毫米}。\n$$",
            "answer": "$$\\boxed{1.413}$$"
        },
        {
            "introduction": "在空间域中理解PSF是第一步，但我们也可以通过调制传递函数 (MTF) 在频率域中分析成像系统的性能。这个练习使用一个简单直观的探测器单元模型（矩形PSF），来推导其对应的MTF 。通过这个过程，你将揭示PSF和MTF之间的基本傅里叶变换关系，并理解物理限制（如探测器尺寸）如何影响系统对空间频率信息的传递能力。",
            "id": "4555628",
            "problem": "在一个分析由线性、移不变探测器采集的医学图像一维线轮廓的放射组学工作流程中，每个探测器单元的有限宽度会导致入射信号的空间平均。将此平均效应建模为系统的点扩展函数 (PSF)，其中 PSF 是一个宽度为 $\\Delta$、面积归一化为1的矩形函数。调制传递函数 (MTF) 定义为 PSF 的傅里叶变换的模。假设傅里叶变换的约定为\n$$\nH(f) = \\int_{-\\infty}^{\\infty} h(x)\\,\\exp(-i\\,2\\pi f x)\\,dx,\n$$\n其中 $f$ 是空间频率，单位为 周期/毫米。令矩形函数定义为\n$$\n\\mathrm{rect}(u) = \n\\begin{cases}\n1,  |u| \\leq \\tfrac{1}{2},\\\\\n0,  \\text{其他情况}.\n\\end{cases}\n$$\n\n从点扩展函数和傅里叶变换的定义出发，推导此探测器模型的调制传递函数 $M(f) = |H(f)|$ 的解析表达式。然后，确定使 $M(f)$ 恰好为零的最小正空间频率 $f$（MTF的第一个零点），并用 $\\Delta$ 表示。最后，对于探测器单元宽度 $\\Delta = 0.73\\,\\mathrm{mm}$，计算这个第一零点频率的值。\n\n以 周期/毫米 为单位表示最终频率，并将您的答案四舍五入到四位有效数字。",
            "solution": "用户要求推导特定成像系统模型的调制传递函数 (MTF)，并计算该 MTF 的第一个零点。\n\n**第一步：问题验证**\n\n根据指定标准对问题陈述进行验证。\n\n*   **提取已知条件：**\n    *   该系统是一个线性、移不变探测器。\n    *   点扩展函数 (PSF)，记为 $h(x)$，对宽度为 $\\Delta$ 的探测器单元的空间平均进行建模。PSF 是一个宽度为 $\\Delta$、面积归一化为1的矩形函数。\n    *   调制传递函数 (MTF) 定义为 $M(f) = |H(f)|$。\n    *   傅里叶变换定义为 $H(f) = \\int_{-\\infty}^{\\infty} h(x)\\,\\exp(-i\\,2\\pi f x)\\,dx$。\n    *   空间频率 $f$ 的单位为 周期/毫米。\n    *   矩形函数定义为，当 $|u| \\leq \\tfrac{1}{2}$ 时 $\\mathrm{rect}(u) = 1$，其他情况为 $0$。\n    *   探测器单元宽度给定为 $\\Delta = 0.73\\,\\mathrm{mm}$。\n*   **验证结论：**\n    *   该问题**有科学依据**，因为 PSF、MTF 和傅里叶分析的概念是成像科学和线性系统理论中的基本原理。将探测器单元的响应建模为矩形 PSF 是一个标准且有效的一阶近似。\n    *   该问题是**适定的**，提供了所有必要的定义、常数和一组明确的目标，从而可以得出一个唯一且有意义的解。\n    *   该问题是**客观的**，并使用清晰、明确的科学语言。\n    *   该问题没有违反任何无效标准。它是完整的、一致的、现实的，并且需要基于已建立的数学方法进行非平凡的推理。\n\n该问题被判定为**有效**。我们继续进行求解。\n\n**第二步：推导点扩展函数 (PSF)**\n\n问题陈述 PSF $h(x)$ 是一个以原点为中心、宽度为 $\\Delta$ 的矩形函数，并且其面积归一化为1。\n\n标准矩形函数 $\\mathrm{rect}(u)$ 的宽度为 $1$，高度为 $1$。要创建一个宽度为 $\\Delta$ 的矩形函数，我们将其自变量缩放 $\\Delta$，得到 $\\mathrm{rect}(x/\\Delta)$。当 $|x/\\Delta| \\leq \\frac{1}{2}$（等价于 $|x| \\leq \\Delta/2$）时，此函数等于 $1$。该函数的宽度确实是 $\\Delta$，高度是 $1$。\n\n$\\mathrm{rect}(x/\\Delta)$ 的面积由其宽度乘以高度给出，即 $\\Delta \\times 1 = \\Delta$。为了将 PSF 的面积归一化为1，我们必须将该函数除以其面积 $\\Delta$。\n\n因此，PSF 的解析表达式为：\n$$\nh(x) = \\frac{1}{\\Delta} \\mathrm{rect}\\left(\\frac{x}{\\Delta}\\right)\n$$\n具体来说，即：\n$$\nh(x) = \n\\begin{cases}\n\\frac{1}{\\Delta},  |x| \\leq \\frac{\\Delta}{2} \\\\\n0,  |x| > \\frac{\\Delta}{2}\n\\end{cases}\n$$\n\n**第三步：推导传递函数 H(f)**\n\n传递函数 $H(f)$ 是 PSF $h(x)$ 的傅里叶变换。使用所提供的傅里叶变换定义：\n$$\nH(f) = \\int_{-\\infty}^{\\infty} h(x)\\,\\exp(-i\\,2\\pi f x)\\,dx\n$$\n我们代入 $h(x)$ 的表达式。由于 $h(x)$ 仅在区间 $[-\\Delta/2, \\Delta/2]$ 内非零，因此可以相应地调整积分上下限：\n$$\nH(f) = \\int_{-\\Delta/2}^{\\Delta/2} \\frac{1}{\\Delta}\\,\\exp(-i\\,2\\pi f x)\\,dx\n$$\n常数项 $\\frac{1}{\\Delta}$ 可以提到积分外面：\n$$\nH(f) = \\frac{1}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\exp(-i\\,2\\pi f x)\\,dx\n$$\n现在我们对 $x$ 进行积分：\n$$\nH(f) = \\frac{1}{\\Delta} \\left[ \\frac{\\exp(-i\\,2\\pi f x)}{-i\\,2\\pi f} \\right]_{x=-\\Delta/2}^{x=\\Delta/2}\n$$\n在积分上下限处计算表达式的值：\n$$\nH(f) = \\frac{1}{\\Delta(-i\\,2\\pi f)} \\left( \\exp\\left(-i\\,2\\pi f \\frac{\\Delta}{2}\\right) - \\exp\\left(-i\\,2\\pi f \\left(-\\frac{\\Delta}{2}\\right)\\right) \\right)\n$$\n$$\nH(f) = \\frac{1}{-i\\,2\\pi f \\Delta} \\left( \\exp(-i\\,\\pi f \\Delta) - \\exp(i\\,\\pi f \\Delta) \\right)\n$$\n使用正弦函数的欧拉恒等式 $\\sin(\\theta) = \\frac{\\exp(i\\theta) - \\exp(-i\\theta)}{2i}$，我们可以写出 $\\exp(-i\\theta) - \\exp(i\\theta) = -2i\\sin(\\theta)$。令 $\\theta = \\pi f \\Delta$。\n$$\nH(f) = \\frac{1}{-i\\,2\\pi f \\Delta} \\left( -2i\\sin(\\pi f \\Delta) \\right)\n$$\n项 $-i$ 和 $2$相互抵消：\n$$\nH(f) = \\frac{\\sin(\\pi f \\Delta)}{\\pi f \\Delta}\n$$\n这个函数通常被称为归一化sinc函数，$\\mathrm{sinc}(u) = \\frac{\\sin(\\pi u)}{\\pi u}$。因此，我们可以写成 $H(f) = \\mathrm{sinc}(f\\Delta)$。\n\n**第四步：推导调制传递函数 (MTF)**\n\nMTF $M(f)$ 定义为 $H(f)$ 的模：\n$$\nM(f) = |H(f)| = \\left| \\frac{\\sin(\\pi f \\Delta)}{\\pi f \\Delta} \\right| = |\\mathrm{sinc}(f\\Delta)|\n$$\n这就是所要求的 MTF 的解析表达式。\n\n**第五步：寻找 MTF 的第一个零点**\n\n我们需要找到使 $M(f)=0$ 的最小正空间频率 $f > 0$。\n$$\nM(f) = \\left| \\frac{\\sin(\\pi f \\Delta)}{\\pi f \\Delta} \\right| = 0\n$$\n这种情况发生在分子为零且分母不为零时。分子 $\\sin(\\pi f \\Delta)$ 在其参数是 $\\pi$ 的整数倍时为零：\n$$\n\\pi f \\Delta = n\\pi, \\quad \\text{for } n \\in \\mathbb{Z}\n$$\n其中 $\\mathbb{Z}$ 是所有整数的集合。这可以简化为：\n$$\nf\\Delta = n \\quad \\implies \\quad f = \\frac{n}{\\Delta}\n$$\n我们寻找的是最小的*正*频率，所以必须有 $n > 0$。$n=0$ 的情况对应于 $f=0$。在 $f=0$ 处，$M(0) = \\lim_{f\\to 0} |\\mathrm{sinc}(f\\Delta)| = |\\mathrm{sinc}(0)| = 1$，这是最大值，而不是零点。\n\n最小的正整数 $n$ 是 $n=1$。因此，MTF 的第一个零点出现在：\n$$\nf_{\\text{zero}} = \\frac{1}{\\Delta}\n$$\n\n**第六步：数值计算**\n\n问题提供了探测器单元宽度 $\\Delta = 0.73\\,\\mathrm{mm}$。我们现在可以计算第一零点频率的数值：\n$$\nf_{\\text{zero}} = \\frac{1}{0.73\\,\\mathrm{mm}} \\approx 1.369863... \\,\\mathrm{cycles/mm}\n$$\n问题要求答案四舍五入到四位有效数字。前四位有效数字是 $1$、$3$、$6$ 和 $9$。第五位数字是 $8$，所以我们将第四位数字向上取整。\n$$\nf_{\\text{zero}} \\approx 1.370 \\,\\mathrm{cycles/mm}\n$$",
            "answer": "$$\n\\boxed{1.370}\n$$"
        },
        {
            "introduction": "理想化的、空间不变的PSF模型在理论上很有用，但真实世界的成像系统通常更复杂。例如，在正电子发射断层扫描 (PET) 中，PSF会随着离视场中心的距离增加而退化。这项高级实践模拟了一个校准实验，引导你完成生成数据、从数据中估计PSF参数，并拟合一个位置依赖的PSF模型 。这个练习将理论与系统表征和数据分析的实际挑战联系起来，让你体验从原始数据到建立物理模型的全过程。",
            "id": "4555649",
            "problem": "您的任务是形式化并实现一个校准实验，该实验使用放置在多个径向位置的点源来测量正电子发射断层扫描 (PET) 系统的点扩散函数 (PSF)。目标是从测量数据中估计一个与位置相关的 PSF 模型。该问题必须从第一性原理出发解决，从基本定义和广为接受的公式开始，不依赖任何未经证实的方法。\n\n定义与基本原理：\n- 点扩散函数 (PSF) 是成像系统的脉冲响应。对于沿探测器轴的一维剖面，一个理想化的对称 PSF 可用归一化高斯函数建模。如果 PSF 是标准差为 $\\sigma$ 的高斯函数，其半峰全宽 (FWHM) 由下式给出：\n$$\\mathrm{FWHM} = 2 \\sqrt{2 \\ln 2} \\, \\sigma.$$\n- 对于位于位置 $r$ 的点源，测得的一维线剖面可以表示为在空间采样位置 $\\{x_j\\}$（单位为毫米）处的采样计数 $\\{c_j\\}$，其中计数被假定为根据高斯强度分布生成。在背景可忽略的理想条件下，计数的加权样本均值和方差可近似高斯参数：\n$$\\mu \\approx \\frac{\\sum_j c_j x_j}{\\sum_j c_j}, \\quad \\sigma^2 \\approx \\frac{\\sum_j c_j (x_j - \\mu)^2}{\\sum_j c_j}.$$\n- 对于与位置相关的 PSF，一个一阶物理上合理的模型假设独立的模糊贡献以正交方式相加。这导出了一个方差模型：\n$$\\sigma^2(r) = \\sigma_0^2 + (b r)^2,$$\n其中 $\\sigma_0$ 是固有的轴上分辨率（单位为毫米），$b$ 是一个参数化离轴模糊增长的无量纲系数，$r$ 是径向位置（单位为毫米）。\n\n您的任务：\n1. 对于每个测试用例，使用具有已知振幅和位置偏移的高斯剖面，在每个指定的径向位置 $r$ 处模拟测量数据 $\\{(x_j, c_j)\\}$。具体来说，对于每个径向位置 $r$，通过以下公式计算空间样本 $x_j$ 处的计数：\n$$c_j = \\mathrm{round}\\left(A \\cdot \\exp\\left(-\\frac{(x_j - \\mu)^2}{2 \\, \\sigma(r)^2}\\right)\\right),$$\n其中 $A$ 是振幅（计数），$\\mu$ 是位置偏移（单位为毫米），$\\sigma(r)$ 由上述模型给出，其中 $\\sigma_0$ 和 $b$ 为该测试用例提供的值。\n2. 根据每个 $r$ 处的模拟计数，使用上面给出的加权矩公式估计经验 $\\mu(r)$ 和 $\\sigma(r)$。\n3. 使用普通最小二乘法对变换后的线性关系拟合与位置相关的模型参数 $(\\sigma_0, b)$：\n$$\\sigma^2(r) = \\sigma_0^2 + (b r)^2,$$\n通过将 $y_i = \\sigma(r_i)^2$ 对 $x_i = r_i^2$ 进行回归。将 $\\sigma_0$ 提取为 $\\sqrt{\\text{截距}}$，将 $b$ 提取为 $\\sqrt{\\text{斜率}}$。\n4. 对于每个测试用例，使用拟合的 $(\\sigma_0, b)$，并利用高斯 FWHM 关系式计算在 $r = 150$ 毫米处的预测 $\\mathrm{FWHM}$。\n5. 所有长度量均以毫米表示，所有报告的浮点数输出均四舍五入到小数点后三位。\n\n测试套件：\n实现并解决以下三个独立的测试用例。在每个用例中，指定的参数会产生三个不同的径向测量剖面。\n\n- 用例 1 (一般情况)：\n    - 空间采样位置 $x_j$ (毫米)：$[-10,-8,-6,-4,-2,0,2,4,6,8,10]$。\n    - 振幅 $A = 1200$。\n    - 真实固有分辨率 $\\sigma_0 = 2.5$ 毫米。\n    - 离轴系数 $b = 0.006$ (无量纲)。\n    - 径向位置 $r$ (毫米)：$[0, 100, 200]$。\n    - 位置偏移 $\\mu$ (毫米)：$[0.0, 0.5, -0.3]$。\n\n- 用例 2 (接近视场边缘的边界情况)：\n    - 空间采样位置 $x_j$ (毫米)：$[-12,-9,-6,-3,0,3,6,9,12]$。\n    - 振幅 $A = 900$。\n    - 真实固有分辨率 $\\sigma_0 = 2.2$ 毫米。\n    - 离轴系数 $b = 0.008$ (无量纲)。\n    - 径向位置 $r$ (毫米)：$[0, 150, 250]$。\n    - 位置偏移 $\\mu$ (毫米)：$[0.0, -0.7, 0.4]$。\n\n- 用例 3 (最小采样的边缘情况)：\n    - 空间采样位置 $x_j$ (毫米)：$[-2, 0, 2]$。\n    - 振幅 $A = 1100$。\n    - 真实固有分辨率 $\\sigma_0 = 3.0$ 毫米。\n    - 离轴系数 $b = 0.0$ (无量纲)。\n    - 径向位置 $r$ (毫米)：$[0, 180, 240]$。\n    - 位置偏移 $\\mu$ (毫米)：$[0.0, 0.0, 0.0]$。\n\n要求的最终输出格式：\n- 对于每个测试用例，您的程序必须输出一个包含三个值的列表：$[\\sigma_0, b, \\mathrm{FWHM}(r=150\\,\\mathrm{mm})]$，所有值都四舍五入到小数点后三位。\n- 将三个测试用例的结果汇总到单行中：一个用方括号括起来的逗号分隔列表，其中每个元素是上述的单个用例列表，例如：\n$$[[\\sigma_{0,1}, b_1, \\mathrm{FWHM}_{1@150}], [\\sigma_{0,2}, b_2, \\mathrm{FWHM}_{2@150}], [\\sigma_{0,3}, b_3, \\mathrm{FWHM}_{3@150}]].$$\n- 您的程序应生成单行输出，其中包含严格遵循此方括号列表格式的结果。\n\n此问题中所有角度均视为无关。所有长度量必须以毫米表示，所有输出必须四舍五入到小数点后三位。任何地方都不使用百分比；在适当的地方使用小数浮点数。解决方案不得从用户或外部文件读取输入。",
            "solution": "该校准实验通过点扩散函数 (PSF) 的脉冲响应定义以及一个关于正电子发射断层扫描 (PET) 系统中分辨率如何随径向位置下降的物理模型来进行形式化。实现过程从原理到算法如下。\n\n基于原理的基础：\n1. 点扩散函数 (PSF) 是成像系统对空间脉冲的响应。在一维情况下，理想化的各向同性 PSF 由高斯函数表示：\n$$g(x; \\mu, \\sigma) = \\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left( -\\frac{(x-\\mu)^2}{2\\sigma^2} \\right).$$\n在使用点源进行 PET 校准的实践中，我们测量离散空间样本 $\\{x_j\\}$ 处的计数，我们将其建模为与高斯函数成比例，并记录为整数计数。\n2. 对于标准差为 $\\sigma$ 的高斯函数，其半峰全宽 (FWHM) 为\n$$\\mathrm{FWHM} = 2\\sqrt{2\\ln 2}\\,\\sigma.$$\n此关系式是连接 $\\sigma$ 和 FWHM 的一个经过充分检验的公式。\n\n推导与位置相关的模型：\n3. PET 中的分辨率由几个独立的模糊源贡献，包括探测器固有分辨率、正电子射程、非共线性以及视差或作用深度效应。当这些贡献独立时，它们的方差以正交方式相加。一个关于径向依赖性的一阶模型是：\n$$\\sigma^2(r) = \\sigma_0^2 + (b r)^2,$$\n其中 $\\sigma_0$（单位为毫米）是轴上的方差贡献，$b$（无量纲）在一个贡献（例如，视差误差随 $r$ 增长）的线性假设下参数化径向增长。这是一个广泛使用的建模方法，在高等本科水平上是物理上合理的。\n\n从采样数据进行测量和估计：\n4. 对于每个径向位置 $r$，我们通过以下公式模拟在采样位置 $x_j$ 处的测量计数：\n$$c_j = \\mathrm{round}\\left( A \\exp\\left( -\\frac{(x_j - \\mu)^2}{2\\,\\sigma(r)^2} \\right) \\right),$$\n其中 $A$ 是一个已知振幅，$\\mu$ 是一个反映不完美中心对齐的微小偏移。这些计数模拟了沿一条线探测到的事件的直方图。\n5. 从测量的计数 $\\{c_j\\}$ 中，我们通过加权矩来估计中心位置和展宽：\n$$\\mu(r) \\approx \\frac{\\sum_j c_j x_j}{\\sum_j c_j}, \\quad \\sigma(r)^2 \\approx \\frac{\\sum_j c_j (x_j - \\mu(r))^2}{\\sum_j c_j}.$$\n这些公式是在加权反映了按计数缩放的概率密度的假设下，从均值和方差的定义中得到的。\n\n通过线性化进行模型拟合：\n6. 为了估计 $\\sigma_0$ 和 $b$，我们使用线性化形式。定义 $y_i = \\sigma(r_i)^2$ 和 $x_i = r_i^2$，则\n$$y_i = \\sigma_0^2 + b^2 x_i.$$\n我们通过普通最小二乘法拟合一条直线 $y = \\alpha + \\beta x$，其中 $\\alpha = \\sigma_0^2$ 且 $\\beta = b^2$。给定样本均值 $\\bar{x} = \\frac{1}{N}\\sum_i x_i$ 和 $\\bar{y} = \\frac{1}{N}\\sum_i y_i$，斜率和截距为\n$$\\beta = \\frac{\\sum_i (x_i - \\bar{x})(y_i - \\bar{y})}{\\sum_i (x_i - \\bar{x})^2}, \\quad \\alpha = \\bar{y} - \\beta \\bar{x}.$$\n然后提取\n$$\\sigma_0 = \\sqrt{\\max(\\alpha, 0)}, \\quad b = \\sqrt{\\max(\\beta, 0)}.$$\n将负值限制为零可以避免由于数值伪影而产生的非物理估计。\n\n预测：\n7. 利用拟合的 $\\sigma_0$ 和 $b$，在 $r = 150$ 毫米处的预测标准差为\n$$\\sigma(150) = \\sqrt{\\sigma_0^2 + (b \\cdot 150)^2},$$\n预测的半峰全宽为\n$$\\mathrm{FWHM}(150) = 2 \\sqrt{2 \\ln 2} \\, \\sigma(150).$$\n\n程序中实现的算法步骤：\n- 对每个测试用例，使用提供的 $x_j$、振幅 $A$ 和偏移 $\\mu$ 值，结合 PSF 模型 $\\sigma(r) = \\sqrt{\\sigma_0^2 + (b r)^2}$，生成每个指定 $r$ 处的测量计数。\n- 对每个 $r$，通过加权矩估计 $\\mu(r)$ 和 $\\sigma(r)$。\n- 拟合线性化模型 $\\sigma^2(r)$ 对 $r^2$ 以获得 $\\sigma_0$ 和 $b$。\n- 计算 $\\mathrm{FWHM}(150)$。\n- 将所有输出四舍五入到小数点后三位，并生成所要求的单行方括号列表。\n\n科学真实性与测试覆盖范围：\n- 用例 1 是一个贯穿整个视场的通用、良好采样的场景。\n- 用例 2 包括接近典型视场边缘的较大径向位置，用以测试拟合的稳健性。\n- 用例 3 使用最少的采样点，在稀疏采样的情况下对估计过程进行压力测试，并假定整个半径上的分辨率是恒定的。\n\n所有量均按要求以毫米表示。不使用角度。最终的打印输出严格遵守单行方括号列表格式，所有浮点数输出均保留三位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef generate_counts(x_grid_mm, amplitude, sigma_mm, mu_mm):\n    \"\"\"\n    Generate integer counts from a Gaussian profile at sample positions x_grid_mm.\n    c_j = round(A * exp(-(x_j - mu)^2 / (2 * sigma^2)))\n    \"\"\"\n    x = np.asarray(x_grid_mm, dtype=float)\n    counts = np.rint(amplitude * np.exp(-((x - mu_mm) ** 2) / (2.0 * sigma_mm ** 2)))\n    return counts.astype(int)\n\ndef estimate_gaussian_moments(x_grid_mm, counts):\n    \"\"\"\n    Estimate weighted mean and variance from counts at positions x_grid_mm.\n    mu = sum(c_j * x_j) / sum(c_j)\n    var = sum(c_j * (x_j - mu)^2) / sum(c_j)\n    \"\"\"\n    x = np.asarray(x_grid_mm, dtype=float)\n    c = np.asarray(counts, dtype=float)\n    total = np.sum(c)\n    if total == 0:\n        # Degenerate case: no counts; return zeros\n        return 0.0, 0.0\n    mu_hat = np.sum(c * x) / total\n    var_hat = np.sum(c * (x - mu_hat) ** 2) / total\n    sigma_hat = np.sqrt(max(var_hat, 0.0))\n    return mu_hat, sigma_hat\n\ndef fit_sigma_model(r_mm_list, sigma_hat_list):\n    \"\"\"\n    Fit sigma^2(r) = s0^2 + (b * r)^2 using OLS on y = s0^2 + (b^2) * x,\n    where x = r^2, y = sigma^2.\n    Returns s0 (mm) and b (dimensionless).\n    \"\"\"\n    r = np.asarray(r_mm_list, dtype=float)\n    sigma = np.asarray(sigma_hat_list, dtype=float)\n    x = r ** 2\n    y = sigma ** 2\n    x_mean = np.mean(x)\n    y_mean = np.mean(y)\n    denom = np.sum((x - x_mean) ** 2)\n    if denom == 0.0:\n        # If all r are identical (should not happen in provided test cases), fallback:\n        slope = 0.0\n        intercept = y_mean\n    else:\n        slope = np.sum((x - x_mean) * (y - y_mean)) / denom\n        intercept = y_mean - slope * x_mean\n    # Clamp to non-negative for physical plausibility\n    slope = max(slope, 0.0)\n    intercept = max(intercept, 0.0)\n    s0 = np.sqrt(intercept)\n    b = np.sqrt(slope)\n    return s0, b\n\ndef fwhm_from_sigma(sigma_mm):\n    \"\"\"Compute FWHM (mm) from sigma (mm) for a Gaussian: FWHM = 2*sqrt(2*ln(2))*sigma.\"\"\"\n    return 2.0 * np.sqrt(2.0 * np.log(2.0)) * sigma_mm\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"x_grid_mm\": [-10,-8,-6,-4,-2,0,2,4,6,8,10],\n            \"A\": 1200,\n            \"sigma0_mm\": 2.5,\n            \"b\": 0.006,\n            \"r_mm\": [0, 100, 200],\n            \"mu_offsets_mm\": [0.0, 0.5, -0.3],\n        },\n        {\n            \"x_grid_mm\": [-12,-9,-6,-3,0,3,6,9,12],\n            \"A\": 900,\n            \"sigma0_mm\": 2.2,\n            \"b\": 0.008,\n            \"r_mm\": [0, 150, 250],\n            \"mu_offsets_mm\": [0.0, -0.7, 0.4],\n        },\n        {\n            \"x_grid_mm\": [-2, 0, 2],\n            \"A\": 1100,\n            \"sigma0_mm\": 3.0,\n            \"b\": 0.0,\n            \"r_mm\": [0, 180, 240],\n            \"mu_offsets_mm\": [0.0, 0.0, 0.0],\n        },\n    ]\n\n    results_str = []\n    for case in test_cases:\n        x_grid = case[\"x_grid_mm\"]\n        A = case[\"A\"]\n        sigma0_true = case[\"sigma0_mm\"]\n        b_true = case[\"b\"]\n        r_list = case[\"r_mm\"]\n        mu_offsets = case[\"mu_offsets_mm\"]\n\n        # For each radial position, generate counts and estimate sigma via weighted moments\n        sigma_estimates = []\n        for r, mu in zip(r_list, mu_offsets):\n            sigma_r = np.sqrt(sigma0_true ** 2 + (b_true * r) ** 2)\n            counts = generate_counts(x_grid, A, sigma_r, mu)\n            _, sigma_hat = estimate_gaussian_moments(x_grid, counts)\n            sigma_estimates.append(sigma_hat)\n\n        # Fit position-dependent model: sigma^2 vs r^2\n        s0_hat, b_hat = fit_sigma_model(r_list, sigma_estimates)\n\n        # Predict FWHM at r=150 mm\n        sigma_150 = np.sqrt(s0_hat ** 2 + (b_hat * 150.0) ** 2)\n        fwhm_150 = fwhm_from_sigma(sigma_150)\n\n        # Round to three decimals and format\n        s0_str = f\"{s0_hat:.3f}\"\n        b_str = f\"{b_hat:.3f}\"\n        fwhm_str = f\"{fwhm_150:.3f}\"\n        results_str.append(f\"[{s0_str},{b_str},{fwhm_str}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        }
    ]
}