{
    "hands_on_practices": [
        {
            "introduction": "在定义复杂的空间栖息地之前，我们可以先从测量肿瘤内体素强度的整体变异性入手。本练习将使用两个基本指标——变异系数（$\\mathrm{CV}$）和香农熵（$H$）——来从一组假设的体素强度中量化异质性。这有助于建立关于数据分布的离散程度和无序性如何与生物异质性相关联的直观理解。",
            "id": "4547773",
            "problem": "一个影像组学工作流被应用于一个实体瘤的单次扫描、多参数磁共振成像 (MRI)。生境成像已根据归一化信号强度将肿瘤分割为一个缺氧核心和一个增殖边缘。强度值已被最小-最大归一化到单位区间，因此每个体素强度都是在 $[0,1]$ 范围内的无量纲值。现给定连续肿瘤区域（结合了两种生境）内 $20$ 个体素的强度值如下：缺氧核心体素 $0.90, 0.85, 0.92, 0.88, 0.81, 0.95, 0.78, 0.83, 0.89, 0.87$ 和增殖边缘体素 $0.45, 0.52, 0.40, 0.55, 0.47, 0.58, 0.50, 0.60, 0.43, 0.48$。使用统计学和信息论中的核心定义，按以下步骤进行。\n\n1. 将给定的 $20$ 个体素集视为一个有限总体。计算总体均值 $\\mu$ 和总体标准差 $\\sigma$（定义为 $\\sigma=\\sqrt{\\frac{1}{N}\\sum_{i=1}^{N}(x_i-\\mu)^{2}}$，其中 $N=20$，$x_i$ 是给定的体素强度）。然后计算变异系数，概念上定义为离散程度与中心趋势之比，即 $\\mathrm{CV}=\\sigma/\\mu$。将 $\\mathrm{CV}$ 表示为无量纲量。\n\n2. 为了量化分布异质性，通过将体素强度分箱到四个不重叠的区间来构建直方图：$\\mathcal{B}_1=[0.35,0.50)$、$\\mathcal{B}_2=[0.50,0.65)$、$\\mathcal{B}_3=[0.65,0.80)$ 和 $\\mathcal{B}_4=[0.80,1.00]$。令 $p_i$ 为区间 $\\mathcal{B}_i$ 的经验概率，由 $\\mathcal{B}_i$ 中的计数除以 $N$ 得到。使用信息论中基于自然对数的定义，计算香农熵 $H=-\\sum_{i=1}^{4}p_i\\,\\ln(p_i)$。将 $H$ 以自然信息单位 (奈特) 表示。\n\n3. 运用关于离散度和不确定性的第一性原理，简要解释计算出的 $\\mathrm{CV}$ 和 $H$ 对于跨越两种生境的瘤内异质性意味着什么。\n\n将两个数值结果四舍五入到四位有效数字。将 $\\mathrm{CV}$ 报告为无量纲值，将 $H$ 以奈特为单位报告。对于最终答案，仅提供数对 $(\\mathrm{CV}, H)$。",
            "solution": "问题陈述已经过验证，并被确定为是合理的。它在科学上基于影像组学、统计学和信息论的既定原理，问题定义良好，包含了所有必要的数据和定义，并以客观、正式的语言表述。它提出了一个可解的、非平凡的问题。\n\n该问题要求对一组给定的来自肿瘤的 $N=20$ 个体素强度进行三部分分析，这些体素被分割为一个缺氧核心和一个增殖边缘。\n\n首先，完整的 $N=20$ 个体素强度 $x_i$ 集合是：\n$$ \\{0.90, 0.85, 0.92, 0.88, 0.81, 0.95, 0.78, 0.83, 0.89, 0.87, 0.45, 0.52, 0.40, 0.55, 0.47, 0.58, 0.50, 0.60, 0.43, 0.48\\} $$\n\n**第 1 部分：计算 $\\mu$、$\\sigma$ 和 $\\mathrm{CV}$**\n\n总体均值 $\\mu$ 是 $N$ 个强度值的算术平均值。\n强度值的总和是：\n$$ \\sum_{i=1}^{20} x_i = (0.90+0.85+0.92+0.88+0.81+0.95+0.78+0.83+0.89+0.87) + (0.45+0.52+0.40+0.55+0.47+0.58+0.50+0.60+0.43+0.48) $$\n$$ \\sum_{i=1}^{20} x_i = 8.68 + 4.98 = 13.66 $$\n总体均值为：\n$$ \\mu = \\frac{1}{N} \\sum_{i=1}^{N} x_i = \\frac{13.66}{20} = 0.683 $$\n接下来，我们计算总体标准差 $\\sigma$。我们首先使用公式 $\\sigma^2 = \\left(\\frac{1}{N}\\sum_{i=1}^{N} x_i^2\\right) - \\mu^2$ 计算总体方差 $\\sigma^2$。\n强度值的平方和是：\n$$ \\sum_{i=1}^{20} x_i^2 = (0.90^2 + \\dots + 0.87^2) + (0.45^2 + \\dots + 0.48^2) $$\n$$ \\sum_{i=1}^{20} x_i^2 = (0.81 + 0.7225 + 0.8464 + 0.7744 + 0.6561 + 0.9025 + 0.6084 + 0.6889 + 0.7921 + 0.7569) + (0.2025 + 0.2704 + 0.16 + 0.3025 + 0.2209 + 0.3364 + 0.25 + 0.36 + 0.1849 + 0.2304) $$\n$$ \\sum_{i=1}^{20} x_i^2 = 7.5582 + 2.5180 = 10.0762 $$\n方差为：\n$$ \\sigma^2 = \\frac{10.0762}{20} - (0.683)^2 = 0.50381 - 0.466489 = 0.037321 $$\n标准差是方差的平方根：\n$$ \\sigma = \\sqrt{0.037321} \\approx 0.1931864 $$\n变异系数 $\\mathrm{CV}$ 是标准差与均值的比值：\n$$ \\mathrm{CV} = \\frac{\\sigma}{\\mu} = \\frac{0.1931864}{0.683} \\approx 0.282850 $$\n四舍五入到四位有效数字，$\\mathrm{CV} \\approx 0.2829$。\n\n**第 2 部分：计算香农熵 $H$**\n\n我们首先将 $N=20$ 个体素强度分到四个指定的区间中，并确定其计数。\n区间为 $\\mathcal{B}_1=[0.35,0.50)$、$\\mathcal{B}_2=[0.50,0.65)$、$\\mathcal{B}_3=[0.65,0.80)$ 和 $\\mathcal{B}_4=[0.80,1.00]$。\n- $\\mathcal{B}_1$ 的计数：体素强度 $\\{0.45, 0.40, 0.47, 0.43, 0.48\\}$。计数为 $c_1=5$。\n- $\\mathcal{B}_2$ 的计数：体素强度 $\\{0.52, 0.55, 0.58, 0.50, 0.60\\}$。计数为 $c_2=5$。\n- $\\mathcal{B}_3$ 的计数：体素强度 $\\{0.78\\}$。计数为 $c_3=1$。\n- $\\mathcal{B}_4$ 的计数：体素强度 $\\{0.90, 0.85, 0.92, 0.88, 0.81, 0.95, 0.83, 0.89, 0.87\\}$。计数为 $c_4=9$。\n总计数为 $c_1+c_2+c_3+c_4 = 5+5+1+9=20$，与 $N$ 相符。\n经验概率 $p_i = c_i/N$ 为：\n$$ p_1 = \\frac{5}{20} = 0.25 $$\n$$ p_2 = \\frac{5}{20} = 0.25 $$\n$$ p_3 = \\frac{1}{20} = 0.05 $$\n$$ p_4 = \\frac{9}{20} = 0.45 $$\n香农熵 $H$ 使用公式 $H=-\\sum_{i=1}^{4}p_i\\,\\ln(p_i)$ 计算。\n$$ H = -[p_1\\ln(p_1) + p_2\\ln(p_2) + p_3\\ln(p_3) + p_4\\ln(p_4)] $$\n$$ H = -[0.25\\ln(0.25) + 0.25\\ln(0.25) + 0.05\\ln(0.05) + 0.45\\ln(0.45)] $$\n代入自然对数值：\n$$ H \\approx -[0.25(-1.38629) + 0.25(-1.38629) + 0.05(-2.99573) + 0.45(-0.79851)] $$\n$$ H \\approx -[-0.34657 - 0.34657 - 0.14979 - 0.35933] $$\n$$ H \\approx -[-1.20226] \\approx 1.20226 \\text{ 奈特} $$\n四舍五入到四位有效数字，$H \\approx 1.202$ 奈特。\n\n**第 3 部分：解释**\n\n计算出的度量指标 $\\mathrm{CV}$ 和 $H$ 量化了瘤内异质性的不同方面。\n- 变异系数 $\\mathrm{CV} \\approx 0.2829$ 衡量了体素强度的相对离散度。根据第一性原理，它是离散程度 ($\\sigma$) 与中心趋势 ($\\mu$) 的比值。$28.3\\%$ 的值表明了中等偏高的变异水平。这表示体素强度并非紧密聚集在均值周围，而是显著分散。这种分散是合并两个具有明显不同平均强度水平的不同体素群体（缺氧核心和增殖边缘）的直接且预期的结果。\n- 香农熵 $H \\approx 1.202$ 奈特，衡量了体素强度在预定义区间内分布的不确定性或无序性。对于四个区间，可能的最大熵为 $H_{\\text{max}} = \\ln(4) \\approx 1.386$ 奈特，这在所有区间被均等填充时发生。计算出的值很高，约为最大值的 $87\\%$。根据第一性原理，熵量化了在特定强度区间中观察到一个体素的不可预测性。$H$ 的高值意味着体素强度分布在多个区间中，而不是集中在一个区间，这反映了一个复杂的强度分布剖面。这种缺乏单一主导强度状态的现象是异质性的一个标志，此处是由两种不同肿瘤生境的共存引起的。\n\n总之，高 $\\mathrm{CV}$ 值和高 $H$ 值都表明了显著的瘤内异质性。$\\mathrm{CV}$ 捕捉了强度变化的幅度，而 $H$ 则捕捉了强度分布形状的复杂性和不可预测性。",
            "answer": "$$ \\boxed{\\begin{pmatrix} 0.2829 & 1.202 \\end{pmatrix}} $$"
        },
        {
            "introduction": "栖息地成像通过结合来自多种扫描类型（例如MRI和PET）的信息，超越了单参数分析。本练习将模拟这一过程，使用$k$-均值聚类算法将具有相似多参数特征谱的体素分组到不同的簇中。随后，您需要将这些通过计算得出的簇解释为具有生物学意义的栖息地，这是高级放射组学中的一项核心任务。",
            "id": "4547809",
            "problem": "给定来自磁共振成像 (MRI) 和正电子发射断层扫描 (PET) 的肿瘤内体素的多参数成像特征向量。每个体素具有三个特征：表观扩散系数 (ADC，单位为 $\\mathrm{mm^2/s}$)、归一化的T2加权强度 (无量纲) 和标准化摄取值 (SUV，无量纲)。在放射组学中，可以通过对此类多参数特征向量进行聚类，将瘤内异质性建模为不同的生境。您的任务是在标准化的特征空间中实现一个确定性的 $k$-均值聚类算法 ($k=3$)，然后根据每个簇在原始单位下的特征概况将其解释为一种生境。\n\n使用以下基础理论：\n- 在 $k$-均值聚类中，目标是最小化簇内平方和。给定数据点 $\\{x_i\\}_{i=1}^n$（其中 $x_i \\in \\mathbb{R}^d$）和 $k$ 个簇及其质心 $\\{\\mu_j\\}_{j=1}^k$，目标函数为：\n$$\n\\min_{\\{\\mu_j\\},\\{c_i\\}} \\sum_{i=1}^n \\left\\| x_i - \\mu_{c_i} \\right\\|_2^2,\n$$\n其中 $c_i \\in \\{0,1,\\dots,k-1\\}$ 表示点 $i$ 的簇分配。\n- 对每个特征维度 $f$ 进行 z-分数标准化，将原始值 $x_{i,f}$ 转换为：\n$$\nz_{i,f} = \\frac{x_{i,f} - \\bar{x}_f}{s_f},\n$$\n其中 $\\bar{x}_f$ 是特征 $f$ 在所有点上的均值，$s_f$ 是样本标准差。如果 $s_f=0$，则将 $s_f$ 设为 $1$ 以避免除以零（这将导致该特征下所有 $i$ 的 $z_{i,f}$ 均为 $0$，这与没有变异的情况是一致的）。\n\n算法要求：\n- 在标准化空间中进行聚类。\n- 质心的初始化必须是确定性的：按 SUV 递增排序；若 SUV 相同，则按 ADC 递增排序；若仍有相同，则按 T2 递增排序。选择此排序顺序中的第一个、中位数和最后一个点作为 $k=3$ 的初始质心。\n- 分配步骤：在标准化空间中，根据欧几里得距离将每个点分配给最近的质心。如果到多个质心的距离完全相等，则选择其质心向量在标准化空间中具有较小欧几里得范数的质心；如果范数也相等，则选择索引较小的质心。\n- 更新步骤：将每个质心移动到当前分配给它的所有点在标准化空间中的均值位置。如果在任何迭代中某个质心没有分配到任何点，则在该次迭代中保持其位置不变。\n- 停止准则：当连续两次迭代之间的分配结果不再改变，或达到 $100$ 次迭代时，以先到者为准，停止算法。\n\n聚类后计算：\n- 计算原始单位下的簇质心（ADC 单位为 $\\mathrm{mm^2/s}$，T2 和 SUV 无量纲），方法是计算分配给每个簇的所有点的原始特征的平均值。如果收敛时某个簇没有分配到任何点，则将其质心设置为所有原始特征的全局均值向量。\n- 使用原始单位和在所有点上计算的全局中位数的生境解释规则：\n    - 计算所有点的 ADC 中位数 $\\tilde{m}_{\\mathrm{ADC}}$ 和 SUV 中位数 $\\tilde{m}_{\\mathrm{SUV}}$。\n    - 对于每个原始单位下的簇质心 $(\\bar{\\mathrm{ADC}}, \\bar{\\mathrm{T2}}, \\bar{\\mathrm{SUV}})$，按如下方式分配一个生境代码：\n        - 代码 $1$ (侵袭性/增殖样)：如果 $\\bar{\\mathrm{SUV}} > \\tilde{m}_{\\mathrm{SUV}}$ 且 $\\bar{\\mathrm{ADC}} < \\tilde{m}_{\\mathrm{ADC}}$。\n        - 代码 $2$ (坏死性/水肿样)：如果 $\\bar{\\mathrm{SUV}} \\le \\tilde{m}_{\\mathrm{SUV}}$ 且 $\\bar{\\mathrm{ADC}} \\ge \\tilde{m}_{\\mathrm{ADC}}$。\n        - 代码 $3$ (中间型/存活样)：其他情况。\n    - 将每个点的簇分配映射到其簇的生境代码，以得出每个点的生境标签。\n\n单位和输出：\n- ADC 必须以 $\\mathrm{mm^2/s}$ 为单位处理，在输出质心中以该单位的浮点数表示。T2 和 SUV 是无量纲的，表示为浮点数。\n- 最终输出必须是单行文本，包含所有测试用例的结果列表，每个测试用例的结果是一个包含三个元素的列表：\n    $[C,A,H]$，其中\n    - $C$：一个扁平化的质心值列表，按簇索引 $0,1,2$ 排序，每个质心内按 $[\\mathrm{ADC}, \\mathrm{T2}, \\mathrm{SUV}]$ 排序，每个值四舍五入到 $6$ 位小数。\n    - $A$：每个点的簇分配列表（整数 $0,1,2$）。\n    - $H$：每个点的生境代码列表（整数 $1,2,3$）。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，嵌套列表的格式也类似（例如 $[[C_1,A_1,H_1],[C_2,A_2,H_2],\\dots]$）。\n\n测试套件：\n- 情况 $1$ (清晰的三个生境)：$9$ 个点\n    - $[0.00080, 0.30, 12.0]$, $[0.00085, 0.25, 11.0]$, $[0.00090, 0.35, 13.0]$,\n    - $[0.00170, 0.75, 3.0]$, $[0.00160, 0.70, 2.5]$, $[0.00180, 0.80, 4.0]$,\n    - $[0.00120, 0.50, 7.0]$, $[0.00125, 0.55, 6.5]$, $[0.00110, 0.45, 6.8]$.\n- 情况 $2$ (退化的相同点)：$6$ 个点\n    - $[0.00120, 0.50, 6.0]$ 重复 $6$ 次。\n- 情况 $3$ (近乎一致的聚类趋势)：$4$ 个点\n    - $[0.00100, 0.40, 8.0]$, $[0.00101, 0.41, 8.1]$, $[0.00099, 0.39, 7.9]$, $[0.00100, 0.40, 8.0]$.\n- 情况 $4$ (对称变化的平局情况)：$4$ 个点\n    - $[0.00120, 0.50, 6.0]$, $[0.00130, 0.50, 6.0]$, $[0.00110, 0.50, 6.0]$, $[0.00120, 0.50, 6.0]$.\n\n请完全按照描述实现指定的确定性 $k$-均值算法、生境解释和输出格式。不需要外部输入。程序必须能够直接运行并打印所需的单行输出。",
            "solution": "该问题要求实现一个确定性的k-均值聚类算法，用于根据多参数成像数据将肿瘤体素分割为不同的生境。该过程涉及特征标准化、一个指定的迭代聚类程序，以及对结果簇的基于规则的解释。解决方案将按照所需方法的步骤逐一分解。\n\n每个体素的输入数据是一个三维特征向量，包括表观扩散系数 (ADC，单位 $\\mathrm{mm^2/s}$)、归一化的T2加权强度 (无量纲) 和标准化摄取值 (SUV，无量纲)。簇的数量固定为 $k=3$。\n\n第一步是对原始特征向量进行标准化。聚类是在这个标准化空间中进行的，以确保具有不同尺度和单位的特征对距离计算的贡献相等。对于每个特征维度 $f$，点 $i$ 的原始值 $x_{i,f}$ 通过以下公式转换为z-分数 $z_{i,f}$：\n$$\nz_{i,f} = \\frac{x_{i,f} - \\bar{x}_f}{s_f}\n$$\n其中 $\\bar{x}_f$ 是特征 $f$ 在所有 $n$ 个数据点上的均值，$s_f$ 是样本标准差。问题提供了一个特定规则来处理特征没有方差的情况：如果 $s_f=0$，则在除法前将 $s_f$ 的值设为 $1$。这会正确地导致该恒定特征维度下所有点的 $z_{i,f}$ 均为 $0$。\n\n接下来，对标准化后的数据点 $\\{z_i\\}_{i=1}^n$ 应用确定性的k-均值算法。该算法旨在最小化簇内平方欧几里得距离之和，即 $\\sum_{i=1}^n \\left\\| z_i - \\mu_{c_i} \\right\\|_2^2$，其中 $\\mu_j$ 是簇 $j$ 的质心，$c_i$ 是点 $i$ 的簇分配。算法流程如下：\n\n1.  **质心初始化**：初始质心是确定性选择的，以确保可复现性。首先，对所有数据点进行排序。主排序键是 SUV，按升序排列。平局情况通过按 ADC 升序排序来打破，任何剩余的平局则通过按 T2 加权强度升序排序来打破。对于 $n$ 个点，初始的三个质心被设置为此排序列表中位于第一个 (索引 $0$)、中位数 (索引 $\\lfloor(n-1)/2\\rfloor$) 和最后一个 (索引 $n-1$) 位置的点的标准化特征向量。\n\n2.  **迭代优化**：算法随后迭代执行两个步骤，即分配和更新，直到满足停止条件。\n    *   **分配步骤**：每个数据点 $z_i$ 被分配给其质心 $\\mu_j$ 在欧几里得距离上最近的簇 $j$。为处理平局，如果一个点到多个质心的距离相等，它将被分配给其质心向量具有最小欧几里得范数 $\\|\\mu_j\\|_2$ 的簇。如果仍然存在平局（即质心范数也相等），则该点被分配给索引 $j \\in \\{0, 1, 2\\}$ 最小的簇。\n    *   **更新步骤**：在所有点都被分配后，更新质心。对于每个簇 $j$，新的质心 $\\mu_j$ 计算为当前分配给它的所有标准化数据点的分量均值。如果一个簇变为空（即分配给它的点数为零），则在该次迭代中其质心不被更新。\n\n3.  **终止**：当所有点的簇分配在连续两次迭代中不再改变，或者达到最大 $100$ 次迭代时，迭代过程停止。\n\n聚类过程收敛后，进行后处理以在肿瘤生物学的背景下解释结果。\n\n1.  **质心转换**：将处于标准化空间中的最终簇质心转换回原始特征空间。对于每个簇 $j$，其在原始单位下的质心 $(\\bar{\\mathrm{ADC}}_j, \\bar{\\mathrm{T2}}_j, \\bar{\\mathrm{SUV}}_j)$ 通过计算分配给该簇的所有点的原始特征向量的均值来获得。如果一个簇在收敛时为空，其质心被定义为所有原始特征向量的全局均值向量。\n\n2.  **生境解释**：每个簇根据其在原始特征空间中的属性被分类为三种生境类型之一。此分类使用在所有输入数据点上计算的全局中位数 ADC $\\tilde{m}_{\\mathrm{ADC}}$ 和全局中位数 SUV $\\tilde{m}_{\\mathrm{SUV}}$。规则如下：\n    *   **代码 $1$ (侵袭性/增殖样)**：如果簇的平均 SUV 高于中位数 SUV 且其平均 ADC 低于中位数 ADC ($\\bar{\\mathrm{SUV}} > \\tilde{m}_{\\mathrm{SUV}}$ 且 $\\bar{\\mathrm{ADC}} < \\tilde{m}_{\\mathrm{ADC}}$)，则分配此代码。这对应于高代谢活性和高细胞密度。\n    *   **代码 $2$ (坏死性/水肿样)**：如果簇的平均 SUV 小于或等于中位数 SUV 且其平均 ADC 大于或等于中位数 ADC ($\\bar{\\mathrm{SUV}} \\le \\tilde{m}_{\\mathrm{SUV}}$ 且 $\\bar{\\mathrm{ADC}} \\ge \\tilde{m}_{\\mathrm{ADC}}$)，则分配此代码。这对应于低代谢活性和低细胞密度/高含水量。\n    *   **代码 $3$ (中间型/存活样)**：如果不满足上述任一条件，则分配此代码。\n\n最后，将每个测试用例的结果编译成特定的输出格式。对于每个用例，输出是一个列表 $[C, A, H]$，其中 $C$ 是三个原始空间质心向量的扁平化列表（按簇索引 $0, 1, 2$ 和特征 ADC, T2, SUV 排序），值四舍五入到 $6$ 位小数；$A$ 是每个点的最终簇分配（$0, 1, 2$）列表；$H$ 是每个点对应的生境代码（$1, 2, 3$）列表。最终程序输出是包含所有给定测试用例结果列表的单行文本。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a deterministic k-means clustering for radiomics habitat analysis.\n    The function processes a suite of test cases, applying standardization,\n    a custom k-means algorithm, and a rule-based habitat interpretation.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (clear three habitats): 9 points\n        [\n            [0.00080, 0.30, 12.0], [0.00085, 0.25, 11.0], [0.00090, 0.35, 13.0],\n            [0.00170, 0.75, 3.0], [0.00160, 0.70, 2.5], [0.00180, 0.80, 4.0],\n            [0.00120, 0.50, 7.0], [0.00125, 0.55, 6.5], [0.00110, 0.45, 6.8]\n        ],\n        # Case 2 (degenerate identical points): 6 points\n        [\n            [0.00120, 0.50, 6.0], [0.00120, 0.50, 6.0], [0.00120, 0.50, 6.0],\n            [0.00120, 0.50, 6.0], [0.00120, 0.50, 6.0], [0.00120, 0.50, 6.0]\n        ],\n        # Case 3 (near-uniform cluster tendency): 4 points\n        [\n            [0.00100, 0.40, 8.0], [0.00101, 0.41, 8.1],\n            [0.00099, 0.39, 7.9], [0.00100, 0.40, 8.0]\n        ],\n        # Case 4 (tie behavior with symmetric variation): 4 points\n        [\n            [0.00120, 0.50, 6.0], [0.00130, 0.50, 6.0],\n            [0.00110, 0.50, 6.0], [0.00120, 0.50, 6.0]\n        ]\n    ]\n\n    all_results = []\n    _K = 3\n    _MAX_ITER = 100\n\n    for data in test_cases:\n        X_orig = np.array(data, dtype=float)\n        n_points, n_features = X_orig.shape\n\n        # Step 1: Standardization\n        mean_orig = np.mean(X_orig, axis=0)\n        std_orig = np.std(X_orig, axis=0, ddof=1)\n        std_orig[std_orig == 0] = 1.0  # Handle zero variance as per problem spec\n        X_std = (X_orig - mean_orig) / std_orig\n\n        # Step 2: Deterministic Centroid Initialization\n        # Sort indices by SUV (col 2), then ADC (col 0), then T2 (col 1)\n        # np.lexsort keys are in reverse order of sorting priority\n        sort_indices = np.lexsort((X_orig[:, 1], X_orig[:, 0], X_orig[:, 2]))\n        \n        median_idx_pos = (n_points - 1) // 2\n        centroid_indices = [\n            sort_indices[0],\n            sort_indices[median_idx_pos],\n            sort_indices[n_points - 1]\n        ]\n        centroids_std = X_std[centroid_indices]\n\n        # Step 3: k-means Iterations\n        assignments = np.full(n_points, -1, dtype=int)\n        for _ in range(_MAX_ITER):\n            old_assignments = np.copy(assignments)\n\n            # Assignment Step\n            sq_dists = np.sum((X_std[:, np.newaxis, :] - centroids_std[np.newaxis, :, :])**2, axis=2)\n\n            for i in range(n_points):\n                min_sq_dist = np.min(sq_dists[i])\n                tied_indices = np.where(sq_dists[i] == min_sq_dist)[0]\n                \n                if len(tied_indices) == 1:\n                    assignments[i] = tied_indices[0]\n                else:\n                    # Tie-breaking 1: Centroid norm\n                    tied_centroids = centroids_std[tied_indices]\n                    sq_norms = np.sum(tied_centroids**2, axis=1)\n                    min_sq_norm = np.min(sq_norms)\n                    \n                    # Indices within tied_indices that have the minimum norm\n                    norm_tied_indices = np.where(sq_norms == min_sq_norm)[0]\n                    \n                    # Tie-breaking 2: Smallest original centroid index\n                    final_candidate_indices = tied_indices[norm_tied_indices]\n                    assignments[i] = np.min(final_candidate_indices)\n\n            # Update Step\n            new_centroids_std = np.copy(centroids_std)\n            for j in range(_K):\n                points_in_cluster = X_std[assignments == j]\n                if len(points_in_cluster) > 0:\n                    new_centroids_std[j] = np.mean(points_in_cluster, axis=0)\n                # Else: centroid remains unchanged if cluster is empty\n            centroids_std = new_centroids_std\n            \n            # Convergence Check\n            if np.array_equal(assignments, old_assignments):\n                break\n\n        # Step 4: Post-processing\n        # C: Centroids in original units\n        centroids_orig = []\n        global_mean_orig = np.mean(X_orig, axis=0)\n        for j in range(_K):\n            cluster_points_orig = X_orig[assignments == j]\n            if len(cluster_points_orig) > 0:\n                centroids_orig.append(np.mean(cluster_points_orig, axis=0))\n            else:\n                centroids_orig.append(global_mean_orig)\n        \n        C_flat = np.array(centroids_orig).flatten().tolist()\n        C = [round(val, 6) for val in C_flat]\n\n        # A: Final assignments\n        A = assignments.tolist()\n\n        # H: Habitat codes\n        median_adc = np.median(X_orig[:, 0])\n        median_suv = np.median(X_orig[:, 2])\n\n        cluster_habitat_codes = {}\n        for j in range(_K):\n            adc_bar, _, suv_bar = centroids_orig[j]\n            if suv_bar > median_suv and adc_bar  median_adc:\n                code = 1\n            elif suv_bar = median_suv and adc_bar >= median_adc:\n                code = 2\n            else:\n                code = 3\n            cluster_habitat_codes[j] = code\n        \n        H = [cluster_habitat_codes[assign] for assign in A]\n\n        all_results.append([C, A, H])\n\n    # Final print statement in the exact required format.\n    # str().replace() is used to produce the compact, no-space list representation.\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "任何栖息地成像图谱的实用价值都取决于其可复现性。如果两位不同的专家（或算法）从同一影像中得出截然不同的图谱，那么从中提取的特征将是不可靠的。本练习引入戴斯相似系数（$DSC$），用于定量评估不同分割结果之间的一致性，从而突显确保全肿瘤和栖息地勾画的稳健性和一致性这一关键挑战。",
            "id": "4547790",
            "problem": "为了使用生境成像研究肿瘤内异质性，对一个通过对比增强磁共振成像（MRI）获取的肿瘤进行了两次分割。两名独立的分析员生成了二值化的完整肿瘤掩模，分别记为集合 $A$ 和 $B$，并且还将每个肿瘤掩模划分为两个不重叠的生境：一个缺氧核心区 $H$ 和一个增殖边缘区 $P$。以下所有计数单位均为体素，并且均指代具有相同体素几何形状的同一次三维采集。\n\n给定以下体素计数：\n- 总体肿瘤大小：$|A| = 52{,}000$， $|B| = 49{,}500$。\n- 总体肿瘤重叠：$|A \\cap B| = 44{,}100$。\n- 每个分割内的生境大小：$|A_H| = 24{,}000$， $|A_P| = 28{,}000$， $|B_H| = 20{,}500$， $|B_P| = 29{,}000$。\n- 相同生境的重叠：$|A_H \\cap B_H| = 18{,}900$， $|A_P \\cap B_P| = 20{,}400$。\n\n假设在每次分割中，生境 $H$ 和 $P$ 是肿瘤的不相交划分，即 $A_H \\cap A_P = \\varnothing$ 和 $B_H \\cap B_P = \\varnothing$，并且 $A_H \\cup A_P = A$，$B_H \\cup B_P = B$。\n\n仅使用基于重叠的二值分割相似性的基本集合论定义，计算总体肿瘤分割 $A$ 和 $B$ 之间的 Dice 相似系数。然后，通过基于重叠如何与放射组学特征的重测可重复性相关的原则性推理，解释所提供的生境级别重叠如何揭示特定生境放射组学特征相对于完整肿瘤特征的可重复性，并明确考虑跨生境标签不一致的可能性（例如，在 $A$ 中标记为 $H$ 但在 $B$ 中标记为 $P$ 的体素）。\n\n提供完整肿瘤 Dice 相似系数的最终数值。将您的答案四舍五入到四位有效数字。将最终系数表示为无单位的纯数字。",
            "solution": "用户提供了一个来自放射组学领域的问题，涉及肿瘤和生境分割的可重复性。任务是验证该问题，如果有效，则计算完整肿瘤的 Dice 相似系数，并解释生境级别的分割一致性。\n\n### 步骤1：问题验证\n\n首先，我将提取给定信息，并验证问题陈述的内部一致性和科学合理性。\n\n给定的信息如下：\n- 两个完整肿瘤分割，由体素集合 $A$ 和 $B$ 表示。\n- 每个分割被划分为一个缺氧核心区 ($H$) 和一个增殖边缘区 ($P$)。划分为 $A = A_H \\cup A_P$ 和 $B = B_H \\cup B_P$。\n- 这些划分是不相交的：$A_H \\cap A_P = \\varnothing$ 和 $B_H \\cap B_P = \\varnothing$。\n- 体素计数（集合的基数）：\n  - $|A| = 52,000$\n  - $|B| = 49,500$\n  - $|A \\cap B| = 44,100$\n  - $|A_H| = 24,000$\n  - $|A_P| = 28,000$\n  - $|B_H| = 20,500$\n  - $|B_P| = 29,000$\n  - $|A_H \\cap B_H| = 18,900$\n  - $|A_P \\cap B_P| = 20,400$\n\n现在，我检查内部一致性。\n不相交划分的并集应等于分割的总大小。\n- 对于分割 $A$：$|A_H| + |A_P| = 24,000 + 28,000 = 52,000$。这与给定的 $|A| = 52,000$ 相符。\n- 对于分割 $B$：$|B_H| + |B_P| = 20,500 + 29,000 = 49,500$。这与给定的 $|B| = 49,500$ 相符。\n\n接下来，我将验证交集数据的一致性。总交集 $A \\cap B$ 由四个不相交的子集组成，对应于生境划分的交集：\n$A \\cap B = (A_H \\cup A_P) \\cap (B_H \\cup B_P) = (A_H \\cap B_H) \\cup (A_H \\cap B_P) \\cup (A_P \\cap B_H) \\cup (A_P \\cap B_P)$。\n由于这四个集合互不相交，它们的并集的基数是它们基数的和：\n$|A \\cap B| = |A_H \\cap B_H| + |A_H \\cap B_P| + |A_P \\cap B_H| + |A_P \\cap B_P|$。\n代入给定值：\n$44,100 = 18,900 + |A_H \\cap B_P| + |A_P \\cap B_H| + 20,400$\n$44,100 = 39,300 + |A_H \\cap B_P| + |A_P \\cap B_H|$\n这意味着具有跨生境不一致（分析员同意该体素是肿瘤，但对生境有分歧）的体素总数为：\n$|A_H \\cap B_P| + |A_P \\cap B_H| = 44,100 - 39,300 = 4,800$。\n由于所有基数都是非负的，并且所有子集的基数都小于或等于其超集的基数（例如， $|A \\cap B| \\le |A|$ 和 $|A \\cap B| \\le |B|$），因此所提供的数字在逻辑上和数学上是一致的。该问题是良定的，基于标准的图像分析实践具有科学依据，并且不包含任何歧义或矛盾。\n\n### 步骤2：问题求解\n\n该问题是有效的。我现在将进行求解，求解过程包括两个部分：计算和解释。\n\n**第1部分：计算完整肿瘤的 Dice 相似系数**\n\nDice 相似系数 (DSC) 是一个用于比较两个二值分割空间重叠度的标准度量。对于两个集合 $A$ 和 $B$，其定义为：\n$$DSC(A, B) = \\frac{2 |A \\cap B|}{|A| + |B|}$$\n使用为完整肿瘤分割提供的值：\n- $|A| = 52,000$\n- $|B| = 49,500$\n- $|A \\cap B| = 44,100$\n\n将这些值代入公式：\n$$DSC(A, B) = \\frac{2 \\times 44,100}{52,000 + 49,500} = \\frac{88,200}{101,500}$$\n$$DSC(A, B) \\approx 0.8689655...$$\n四舍五入到四位有效数字，完整肿瘤的 Dice 相似系数为 $0.8690$。\n\n**第2部分：解释生境级别的重叠**\n\n为了解释特定生境特征的可重复性，我们必须将生境的重叠与完整肿瘤的重叠进行比较。我将计算每种生境类型的 Dice 相似系数。\n\n对于缺氧生境 ($H$)：\n- $|A_H| = 24,000$\n- $|B_H| = 20,500$\n- $|A_H \\cap B_H| = 18,900$\n$$DSC(A_H, B_H) = \\frac{2 |A_H \\cap B_H|}{|A_H| + |B_H|} = \\frac{2 \\times 18,900}{24,000 + 20,500} = \\frac{37,800}{44,500}$$\n$$DSC(A_H, B_H) \\approx 0.849438... \\approx 0.8494$$\n\n对于增殖生境 ($P$)：\n- $|A_P| = 28,000$\n- $|B_P| = 29,000$\n- $|A_P \\cap B_P| = 20,400$\n$$DSC(A_P, B_P) = \\frac{2 |A_P \\cap B_P|}{|A_P| + |B_P|} = \\frac{2 \\times 20,400}{28,000 + 29,000} = \\frac{40,800}{57,000}$$\n$$DSC(A_P, B_P) \\approx 0.715789... \\approx 0.7158$$\n\n**解释：**\n\n1.  **总体可重复性：** 完整肿瘤的 Dice 得分，$DSC(A, B) \\approx 0.8690$，很高（通常对于手动分割，$DSC  0.85$ 被认为是极好的一致性）。这表明从整个肿瘤体积中提取的放射组学特征在两位分析员之间很可能是高度可重复的。\n\n2.  **特定生境的可重复性：**\n    - 缺氧核心区 ($H$) 的 Dice 得分为 $DSC(A_H, B_H) \\approx 0.8494$。这略低于完整肿瘤的得分，但仍表明具有良好的可重复性。来自缺氧核心区的特征相当稳定。\n    - 增殖边缘区 ($P$) 的 Dice 得分为 $DSC(A_P, B_P) \\approx 0.7158$。该值大大低于完整肿瘤和缺氧核心区的得分。此范围内的 Dice 得分（通常被认为是“尚可”到“中等”的一致性）表明增殖边缘区的勾画可重复性显著降低。仅从该生境提取的放射组学特征将表现出较差的重测信度，应非常谨慎地解释。\n\n3.  **跨生境不一致的影响：**\n    如验证时所确定的，有 $4,800$ 个体素属于肿瘤交集 ($A \\cap B$)，但被两位分析员标记为不同的生境（即 $|A_H \\cap B_P| + |A_P \\cap B_H| = 4,800$）。这些体素代表了在一致认同的肿瘤体内，对组织生物学分类的根本性分歧。\n    - 这 $4,800$ 个体素对完整肿瘤 DSC 的分子有正向贡献，从而夸大了在完整肿瘤层面感知到的一致性。它们构成了总交集区域的 $4,800 / 44,100 \\approx 10.9\\%$。\n    - 然而，这些相同的体素在生境层面上是不一致的来源。在计算缺氧和增殖生境的 DSC 时，它们都被计为“不匹配”。例如，一个在 $A_H \\cap B_P$ 中的体素属于集合 $A_H$ 但不属于 $B_H$，因此降低了 $DSC(A_H, B_H)$；同时它属于集合 $B_P$ 但不属于 $A_P$，从而降低了 $DSC(A_P, B_P)$。\n    - 这明确地表明，生境成像中变异性的一个重要来源不仅是肿瘤外边界的勾画，还有内部分区的分类。特别是增殖边缘区较低的可重复性表明，其与缺氧核心区的边界模糊不清，分析员难以一致地定义。\n\n总之，虽然完整肿瘤特征分析看起来是稳健的，但过渡到更精细尺度的生境分析会引入可重复性的显著损失，特别是对于增殖边缘区。这种不稳定性的来源不仅是边界勾画，还包括对肿瘤内部体素的生境分类存在大量不一致，这突显了特定生境放射组学临床应用的一个关键挑战。",
            "answer": "$$\n\\boxed{0.8690}\n$$"
        }
    ]
}