{
    "hands_on_practices": [
        {
            "introduction": "在构建公平的AI模型时，我们可能会追求多个看似都合理的目标。本练习将通过一个简化的思想实验，揭示一个深刻的内在冲突：模型对每个亚组都进行完美校准（即其风险评分准确反映真实概率）与实现人口统计均等（即所有亚组获得阳性预测的比例相同）这两个目标，在基础患病率不同时，是无法同时达成的。通过推导这个不可避免的权衡，你将深入理解在选择公平性定义时所面临的挑战。",
            "id": "4530653",
            "problem": "一个影像组学人工智能（AI）模型被部署用于通过计算机断层扫描（CT）评估肺部恶性肿瘤风险。医院的患者群体被划分为两个亚组，记为 $A$ 和 $B$，它们代表了两种具有不同疾病基础率的不同转诊途径。该模型针对每个亚组输出一个经过校准的风险评分，其含义如下：对于每个亚组 $G \\in \\{A, B\\}$ 和每个可能的评分值 $r$，亚组校准意味着条件患病率等于该评分，即 $\\mathbb{E}[Y \\mid R = r, G] = r$，其中 $Y \\in \\{0,1\\}$ 表示是否为恶性肿瘤，$R \\in \\{r_{L}, r_{H}\\}$ 是模型评分，取值为 $r_{L}$ 和 $r_{H}$ 两个，且满足 $0  r_{L}  r_{H}  1$。假设亚组的基础率分别为 $p_{A} = \\mathbb{P}(Y = 1 \\mid G = A)$ 和 $p_{B} = \\mathbb{P}(Y = 1 \\mid G = B)$，并且该模型是亚组校准的，其评分服从两点分布：在亚组 $G$ 中，评分等于 $r_{L}$ 的概率为 $q_{G}$，等于 $r_{H}$ 的概率为 $1 - q_{G}$，其中某个 $q_{G} \\in [0,1]$。\n\n医院对评分应用一个单一的决策阈值 $t$，该阈值与亚组成员身份无关，并且当且仅当 $R \\geq t$ 时，将扫描结果标记为阳性。假设阈值满足 $r_{L}  t  r_{H}$，因此只有 $R = r_{H}$ 的扫描结果才会被标记。人口统计均等要求在各个亚组中被标记的扫描结果的比例相等。将人口统计均等差距定义为\n$$\\Delta \\equiv \\mathbb{P}(R \\geq t \\mid G = B) - \\mathbb{P}(R \\geq t \\mid G = A)。$$\n\n仅使用亚组校准的定义和全概率定律，在 $r_{L} = 0.1$、$r_{H} = 0.9$、$p_{A} = 0.2$ 和 $p_{B} = 0.5$ 的具体、科学上合理的影像组学设置下，计算 $\\Delta$。将您的最终答案表示为最简分数。在进行此计算时，您将构建一个反例，以表明亚组校准和人口统计均等（在跨亚组统一应用的单一阈值下）除了在退化情况下外是不相容的。无需四舍五入。",
            "solution": "问题要求计算人口统计均等差距 $\\Delta$，其定义为\n$$ \\Delta \\equiv \\mathbb{P}(R \\geq t \\mid G = B) - \\mathbb{P}(R \\geq t \\mid G = A) $$\n其中 $R$ 是模型的风险评分，$t$ 是决策阈值，$G \\in \\{A, B\\}$ 表示亚组。\n\n模型的评分 $R$ 只能取两个值，$r_L$ 和 $r_H$。决策阈值 $t$ 被指定在区间 $r_L  t  r_H$ 内。因此，一个扫描结果被标记为阳性（当且仅当 $R \\geq t$ 时发生）等价于事件 $R = r_H$。\n通过这种简化，人口统计均等差距 $\\Delta$可以表示为：\n$$ \\Delta = \\mathbb{P}(R = r_H \\mid G = B) - \\mathbb{P}(R = r_H \\mid G = A) $$\n问题陈述，对于任何亚组 $G$，评分 $R$ 等于 $r_L$ 的概率为 $q_G$，等于 $r_H$ 的概率为 $1 - q_G$。\n因此，$\\mathbb{P}(R = r_H \\mid G) = 1 - q_G$。将此代入 $\\Delta$ 的表达式中，得到：\n$$ \\Delta = (1 - q_B) - (1 - q_A) = q_A - q_B $$\n为了求出 $\\Delta$，我们必须首先确定 $q_A$ 和 $q_B$ 的值。根据题目要求，我们需使用全概率定律和亚组校准的定义。\n\n对于任何亚组 $G$，恶性肿瘤的基础率 $p_G = \\mathbb{P}(Y = 1 \\mid G)$ 可以通过对评分 $R$ 进行条件化，使用全概率定律来表示：\n$$ p_G = \\mathbb{P}(Y=1 \\mid G) = \\sum_{r \\in \\{r_L, r_H\\}} \\mathbb{P}(Y=1 \\mid R=r, G) \\mathbb{P}(R=r \\mid G) $$\n展开为：\n$$ p_G = \\mathbb{P}(Y=1 \\mid R=r_L, G) \\mathbb{P}(R=r_L \\mid G) + \\mathbb{P}(Y=1 \\mid R=r_H, G) \\mathbb{P}(R=r_H \\mid G) $$\n问题将亚组校准定义为 $\\mathbb{E}[Y \\mid R=r, G] = r$。由于 $Y$ 是一个伯努利变量（$Y \\in \\{0, 1\\}$），其条件期望等于 $Y=1$ 的条件概率。因此，亚组校准意味着：\n$$ \\mathbb{P}(Y=1 \\mid R=r, G) = r $$\n应用此条件，我们得到 $\\mathbb{P}(Y=1 \\mid R=r_L, G) = r_L$ 和 $\\mathbb{P}(Y=1 \\mid R=r_H, G) = r_H$。\n\n将这些校准条件和给定的评分概率 $\\mathbb{P}(R=r_L \\mid G) = q_G$ 和 $\\mathbb{P}(R=r_H \\mid G) = 1-q_G$ 代入 $p_G$ 的方程中：\n$$ p_G = r_L \\cdot q_G + r_H \\cdot (1 - q_G) $$\n该方程建立了亚组基础率 $p_G$ 与其评分分布参数 $q_G$ 之间的直接关系。我们现在可以解出 $q_G$：\n$$ p_G = r_L q_G + r_H - r_H q_G $$\n$$ p_G - r_H = q_G (r_L - r_H) $$\n$$ q_G = \\frac{p_G - r_H}{r_L - r_H} = \\frac{-(r_H - p_G)}{-(r_H - r_L)} = \\frac{r_H - p_G}{r_H - r_L} $$\n这个关于 $q_G$ 的表达式对亚组 $A$ 和 $B$ 都成立。\n\n现在我们可以将 $q_A$ 和 $q_B$ 的表达式代回 $\\Delta$ 的方程中：\n$$ \\Delta = q_A - q_B = \\left( \\frac{r_H - p_A}{r_H - r_L} \\right) - \\left( \\frac{r_H - p_B}{r_H - r_L} \\right) $$\n将各项合并到共同的分母上：\n$$ \\Delta = \\frac{(r_H - p_A) - (r_H - p_B)}{r_H - r_L} = \\frac{r_H - p_A - r_H + p_B}{r_H - r_L} $$\n$$ \\Delta = \\frac{p_B - p_A}{r_H - r_L} $$\n这个一般性结果表明，对于一个具有两点评分分布且经过亚组校准的模型，在单一阈值下，只要亚组的基础率不同（$p_A \\neq p_B$），人口统计均等差距就非零。人口统计均等（$\\Delta = 0$）仅在 $p_A = p_B$ 的退化情况下才能实现。\n\n最后一步是使用所提供的数据计算 $\\Delta$ 的数值：\n$r_L = 0.1$\n$r_H = 0.9$\n$p_A = 0.2$\n$p_B = 0.5$\n\n将这些值代入推导出的 $\\Delta$ 公式中：\n$$ \\Delta = \\frac{0.5 - 0.2}{0.9 - 0.1} = \\frac{0.3}{0.8} $$\n要将其表示为最简分数：\n$$ \\Delta = \\frac{3/10}{8/10} = \\frac{3}{8} $$",
            "answer": "$$\n\\boxed{\\frac{3}{8}}\n$$"
        },
        {
            "introduction": "另一个关键的公平性权衡出现在“预测均等”和“机会均等”之间。本练习要求你从贝叶斯定理出发，证明当一个放射组学模型在不同患病率的亚组间实现预测均等（即阳性预测值 $PPV$ 相等）时，它必然会导致这些亚组间的真阳性率（$TPR$）和假阳性率（$FPR$）产生差异。这个练习将帮助你理解，确保模型的预测结果对每个群体具有相同“意义”的代价，可能是模型在不同群体中犯错的方式不尽相同。",
            "id": "4530630",
            "problem": "一家医院部署了一个基于影像组学的人工智能分诊系统，用于标记需要紧急审查的胸部计算机断层扫描（CT）图像。令 $A \\in \\{0,1\\}$ 表示一个二元患者群体属性（例如，两个不同的临床亚群），令 $Y \\in \\{0,1\\}$ 表示是否存在可采取行动的影像组学发现的真实情况。该系统输出一个二元决策 $\\hat{Y} \\in \\{0,1\\}$，指示扫描是否被标记为需要紧急审查。定义特定群体的患病率为 $\\pi_{a} = \\mathbb{P}(Y=1 \\mid A=a)$，真阳性率为 $\\mathrm{TPR}_{a} = \\mathbb{P}(\\hat{Y}=1 \\mid Y=1, A=a)$，假阳性率为 $\\mathrm{FPR}_{a} = \\mathbb{P}(\\hat{Y}=1 \\mid Y=0, A=a)$，以及阳性预测值为 $\\mathrm{PPV}_{a} = \\mathbb{P}(Y=1 \\mid \\hat{Y}=1, A=a)$。\n\n该医院的公平性政策要求跨群体实现预测均等（predictive parity），即 $\\mathrm{PPV}_{0} = \\mathrm{PPV}_{1} = \\alpha$，其中 $\\alpha$ 是一个固定的目标值。在实践中，对于这个分诊系统，假设不同群体的患病率不同，$\\pi_{0} = 0.05$ 且 $\\pi_{1} = 0.15$，并且政策目标是 $\\alpha = 0.40$。\n\n从贝叶斯定理和上述定义出发（不使用任何预先推导的捷径公式），推导跨群体相等的 $\\mathrm{PPV}_{a}=\\alpha$ 如何意味着一个连接 $\\mathrm{TPR}_{a}$ 和 $\\mathrm{FPR}_{a}$ 的特定约束，该约束依赖于 $\\pi_{a}$。然后，在给定的 $\\pi_{0}$、$\\pi_{1}$ 和 $\\alpha$ 条件下，计算比率\n$$\n\\frac{\\rho_{1}}{\\rho_{0}},\n$$\n其中 $\\rho_{a} = \\frac{\\mathrm{TPR}_{a}}{\\mathrm{FPR}_{a}}$。将你的最终答案表示为最简分数形式。最后，用一两句话解释这个数值比率对于在这种临床分诊场景下，同时均衡两个群体的 $\\mathrm{TPR}$ 和 $\\mathrm{FPR}$ 的可能性意味着什么。",
            "solution": "我们从定义和贝叶斯定理开始。根据贝叶斯定理和全概率公式，\n$$\n\\mathrm{PPV}_{a}\n= \\mathbb{P}(Y=1 \\mid \\hat{Y}=1, A=a)\n= \\frac{\\mathbb{P}(\\hat{Y}=1 \\mid Y=1, A=a)\\,\\mathbb{P}(Y=1 \\mid A=a)}{\\mathbb{P}(\\hat{Y}=1 \\mid A=a)}.\n$$\n分母通过全概率公式展开为\n$$\n\\mathbb{P}(\\hat{Y}=1 \\mid A=a)\n= \\mathbb{P}(\\hat{Y}=1 \\mid Y=1, A=a)\\,\\mathbb{P}(Y=1 \\mid A=a)\n+ \\mathbb{P}(\\hat{Y}=1 \\mid Y=0, A=a)\\,\\mathbb{P}(Y=0 \\mid A=a).\n$$\n识别出 $\\mathrm{TPR}_{a} = \\mathbb{P}(\\hat{Y}=1 \\mid Y=1, A=a)$，$\\mathrm{FPR}_{a} = \\mathbb{P}(\\hat{Y}=1 \\mid Y=0, A=a)$，$\\pi_{a} = \\mathbb{P}(Y=1 \\mid A=a)$，以及 $1-\\pi_{a} = \\mathbb{P}(Y=0 \\mid A=a)$，我们得到\n$$\n\\mathrm{PPV}_{a} = \\frac{\\pi_{a}\\,\\mathrm{TPR}_{a}}{\\pi_{a}\\,\\mathrm{TPR}_{a} + (1-\\pi_{a})\\,\\mathrm{FPR}_{a}}.\n$$\n对两个群体施加预测均等 $\\mathrm{PPV}_{a} = \\alpha$ 的条件，对于每个 $a$ 可得，\n$$\n\\alpha\\left(\\pi_{a}\\,\\mathrm{TPR}_{a} + (1-\\pi_{a})\\,\\mathrm{FPR}_{a}\\right) = \\pi_{a}\\,\\mathrm{TPR}_{a}.\n$$\n重新整理各项以分离出比率 $\\rho_{a} = \\frac{\\mathrm{TPR}_{a}}{\\mathrm{FPR}_{a}}$，得到\n$$\n\\alpha(1-\\pi_{a})\\,\\mathrm{FPR}_{a} = \\pi_{a}(1-\\alpha)\\,\\mathrm{TPR}_{a}\n\\quad \\Rightarrow \\quad\n\\frac{\\mathrm{TPR}_{a}}{\\mathrm{FPR}_{a}} = \\frac{\\alpha(1-\\pi_{a})}{\\pi_{a}(1-\\alpha)}.\n$$\n因此，在跨群体具有相等阳性预测值的条件下，所需的似然比类操作点 $\\rho_{a}$ 依赖于特定群体的患病率 $\\pi_{a}$。如果 $\\pi_{a}$ 在不同群体间存在差异，那么 $\\rho_{a}$ 也将不同，这意味着 $\\mathrm{TPR}_{a}$ 和 $\\mathrm{FPR}_{a}$ 之间的权衡在不同群体间不能相同。\n\n现在我们使用给定的参数 $\\pi_{0} = 0.05$, $\\pi_{1} = 0.15$, $\\alpha = 0.40$ 来计算 $\\rho_{0}$ 和 $\\rho_{1}$。首先计算公共因子 $1-\\alpha = 0.60$。\n\n对于群体 $A=0$：\n$$\n\\rho_{0} = \\frac{\\alpha(1-\\pi_{0})}{\\pi_{0}(1-\\alpha)} = \\frac{0.40 \\cdot (1-0.05)}{0.05 \\cdot 0.60} = \\frac{0.40 \\cdot 0.95}{0.03} = \\frac{0.38}{0.03} = \\frac{38}{3}.\n$$\n\n对于群体 $A=1$：\n$$\n\\rho_{1} = \\frac{\\alpha(1-\\pi_{1})}{\\pi_{1}(1-\\alpha)} = \\frac{0.40 \\cdot (1-0.15)}{0.15 \\cdot 0.60} = \\frac{0.40 \\cdot 0.85}{0.09} = \\frac{0.34}{0.09} = \\frac{34}{9}.\n$$\n\n因此，所求的比率为\n$$\n\\frac{\\rho_{1}}{\\rho_{0}} = \\frac{\\frac{34}{9}}{\\frac{38}{3}} = \\frac{34}{9} \\cdot \\frac{3}{38} = \\frac{102}{342} = \\frac{17}{57}.\n$$\n\n在临床分诊场景下的解释：因为 $\\pi_{0} \\neq \\pi_{1}$，要实现跨群体相等的 $\\mathrm{PPV}$ 就需要不同的 $\\rho_{a}$，从而导致不同的 $\\mathrm{TPR}_{a}$–$\\mathrm{FPR}_{a}$ 权衡。因此，当患病率不同时，在保持预测均等的同时，通常不可能同时均衡化不同群体的 $\\mathrm{TPR}$ 和 $\\mathrm{FPR}$，这突显了影像组学分诊中一个基本的公平性权衡。",
            "answer": "$$\\boxed{\\frac{17}{57}}$$"
        },
        {
            "introduction": "理论上的公平性冲突在现实世界中会转化为可测量的差异。本练习将理论付诸实践，要求你编写一个模拟程序，量化不同站点间微小的疾病患病率差异如何在一个固定的AI决策系统下，演变成临床决策（如治疗率）、模型可信度（如阳性预测值）乃至整体临床效用的显著不平等。通过亲手实现这个模拟，你将直观地感受到即使AI模型本身在各群体中的错误率（$TPR$ 和 $FPR$）表现一致，外部环境的差异也会导致系统性的偏见。",
            "id": "4530612",
            "problem": "要求您形式化并实现一个确定性模拟，以量化当使用分类器的固定工作点时，两个站点间疾病患病率的微小变化如何传播为临床决策中的差异。假设一个影像组学人工智能（AI）模型，该模型在一个固定的阈值下输出一个二元决策 $\\hat{Y} \\in \\{0,1\\}$，该阈值选择一次后在所有站点保持不变。令 $Y \\in \\{0,1\\}$ 表示真实的疾病状态。用 $S \\in \\{A,B\\}$ 表示站点指示符。在固定的工作点，假设错误率与站点无关：对于 $s \\in \\{A,B\\}$，真阳性率（TPR）为 $tpr = \\mathbb{P}(\\hat{Y}=1 \\mid Y=1,S=s)$，假阳性率（FPR）为 $fpr = \\mathbb{P}(\\hat{Y}=1 \\mid Y=0,S=s)$。令特定站点的疾病患病率为 $p_s = \\mathbb{P}(Y=1 \\mid S=s)$。决策策略是当且仅当 $\\hat{Y}=1$ 时进行治疗，因此站点 $s$ 的治疗率为 $\\tau_s = \\mathbb{P}(\\hat{Y}=1 \\mid S=s)$。站点 $s$ 的阳性预测值（PPV）为 $\\pi_s = \\mathbb{P}(Y=1 \\mid \\hat{Y}=1,S=s)$。考虑一个针对每位患者的简单线性效用模型，其中每个真阳性治疗带来收益 $b$，每个假阳性治疗带来损害 $h$。站点 $s$ 每位患者的预期净效用为 $u_s = b \\cdot \\mathbb{P}(Y=1,\\hat{Y}=1 \\mid S=s) - h \\cdot \\mathbb{P}(Y=0,\\hat{Y}=1 \\mid S=s)$。\n\n仅从全概率公式和 Bayes 定理出发，推导出用 $p_s$、$tpr$、$fpr$、$b$ 和 $h$ 表示 $\\tau_s$、$\\pi_s$ 和 $u_s$ 的公式。然后，定义站点 $A$ 和 $B$ 之间的三个差异性度量：\n- 治疗率的绝对差异 $\\Delta_{\\tau} = \\lvert \\tau_A - \\tau_B \\rvert$，\n- 阳性预测值的绝对差异 $\\Delta_{\\pi} = \\lvert \\pi_A - \\pi_B \\rvert$，\n- 预期效用的绝对差异 $\\Delta_{u} = \\lvert u_A - u_B \\rvert$。\n\n您的任务是实现一个程序，为每个测试用例计算向量 $[\\Delta_{\\tau}, \\Delta_{\\pi}, \\Delta_{u}]$ 作为十进制数。如果计算任何表达式所需的分母为零，则将相应的分数定义为零，以避免除以零的错误。\n\n程序必须使用以下测试套件，其中每个用例是一个元组 $(tpr, fpr, p_A, p_B, b, h)$：\n- 用例 1：$(0.85, 0.10, 0.20, 0.25, 1.0, 0.2)$，\n- 用例 2：$(0.85, 0.10, 0.20, 0.20, 1.0, 0.2)$，\n- 用例 3：$(0.90, 0.05, 0.02, 0.03, 1.0, 0.1)$，\n- 用例 4：$(0.95, 0.01, 0.50, 0.55, 1.0, 0.5)$，\n- 用例 5：$(0.70, 0.30, 0.98, 0.99, 1.0, 0.4)$，\n- 用例 6：$(0.00, 0.00, 0.40, 0.60, 1.0, 1.0)$，\n- 用例 7：$(0.80, 0.00, 0.10, 0.30, 1.0, 0.2)$。\n\n所有量都必须视为无单位的概率或效用；不要使用百分号，也不要引入任何物理单位。每个输出数字必须四舍五入到恰好 $6$ 位小数。\n\n您的程序应生成单行输出，其中包含结果，格式为一个逗号分隔的列表，列表中的元素是每个测试用例的向量，并用方括号括起来，例如 $[[x_{11},x_{12},x_{13}],[x_{21},x_{22},x_{23}],\\dots]$，其中每个 $x_{ij}$ 是一个对应于某个测试用例的 $[\\Delta_{\\tau}, \\Delta_{\\pi}, \\Delta_{u}]$ 的浮点数，四舍五入到恰好6位小数。",
            "solution": "问题陈述已被分析并确定为有效。它在科学上基于概率论及其在评估AI模型中的应用，提法明确且提供了所有必要信息，表述客观。任务是推导并实现公式，以量化因两个站点间疾病患病率的差异而导致的、由AI驱动的临床决策中的差异。\n\n我们首先为一个通用站点 $s \\in \\{A, B\\}$ 推导所需公式，其中所有概率都隐式地以站点 $S=s$ 为条件。给定参数是特定站点的疾病患病率 $p_s = \\mathbb{P}(Y=1 \\mid S=s)$，与站点无关的真阳性率 $tpr = \\mathbb{P}(\\hat{Y}=1 \\mid Y=1)$，以及与站点无关的假阳性率 $fpr = \\mathbb{P}(\\hat{Y}=1 \\mid Y=0)$。效用参数是真阳性治疗的收益 $b$ 和假阳性治疗的损害 $h$。\n\n**1. 治疗率（$\\tau_s$）的推导**\n\n站点 $s$ 的治疗率 $\\tau_s = \\mathbb{P}(\\hat{Y}=1 \\mid S=s)$，是对于来自该站点的患者，模型做出阳性预测的总概率。我们使用全概率公式，通过以真实疾病状态 $Y \\in \\{0, 1\\}$ 为条件来推导。\n$$\n\\tau_s = \\mathbb{P}(\\hat{Y}=1 \\mid S=s) = \\mathbb{P}(\\hat{Y}=1 \\mid Y=1, S=s)\\mathbb{P}(Y=1 \\mid S=s) + \\mathbb{P}(\\hat{Y}=1 \\mid Y=0, S=s)\\mathbb{P}(Y=0 \\mid S=s)\n$$\n代入所给定义：\n- $\\mathbb{P}(\\hat{Y}=1 \\mid Y=1, S=s) = tpr$\n- $\\mathbb{P}(Y=1 \\mid S=s) = p_s$\n- $\\mathbb{P}(\\hat{Y}=1 \\mid Y=0, S=s) = fpr$\n- $\\mathbb{P}(Y=0 \\mid S=s) = 1 - p_s$\n\n我们得到站点 $s$ 的治疗率表达式：\n$$\n\\tau_s = tpr \\cdot p_s + fpr \\cdot (1 - p_s)\n$$\n\n**2. 阳性预测值（$\\pi_s$）的推导**\n\n站点 $s$ 的阳性预测值（PPV）$\\pi_s = \\mathbb{P}(Y=1 \\mid \\hat{Y}=1, S=s)$，是一个预测为阳性的患者确实患有该疾病的概率。我们应用贝叶斯定理：\n$$\n\\pi_s = \\mathbb{P}(Y=1 \\mid \\hat{Y}=1, S=s) = \\frac{\\mathbb{P}(\\hat{Y}=1 \\mid Y=1, S=s) \\mathbb{P}(Y=1 \\mid S=s)}{\\mathbb{P}(\\hat{Y}=1 \\mid S=s)}\n$$\n分子是 $tpr \\cdot p_s$，分母是上面推导出的治疗率 $\\tau_s$。\n$$\n\\pi_s = \\frac{tpr \\cdot p_s}{tpr \\cdot p_s + fpr \\cdot (1 - p_s)} = \\frac{tpr \\cdot p_s}{\\tau_s}\n$$\n根据问题说明，如果分母 $\\tau_s$ 为零，我们定义 $\\pi_s = 0$。这种情况发生当且仅当 $tpr=0$（对于 $p_s0$）和 $fpr=0$（对于 $1-p_s0$），这意味着分类器从不预测为阳性，因此 $\\mathbb{P}(\\hat{Y}=1 \\mid S=s)=0$。\n\n**3. 预期净效用（$u_s$）的推导**\n\n站点 $s$ 每位患者的预期净效用定义为：\n$$\nu_s = b \\cdot \\mathbb{P}(Y=1, \\hat{Y}=1 \\mid S=s) - h \\cdot \\mathbb{P}(Y=0, \\hat{Y}=1 \\mid S=s)\n$$\n我们使用条件概率的定义 $\\mathbb{P}(A, B \\mid C) = \\mathbb{P}(A \\mid B, C)\\mathbb{P}(B \\mid C)$ 来表示联合概率。\n站点 $s$ 的真阳性治疗概率为：\n$$\n\\mathbb{P}(Y=1, \\hat{Y}=1 \\mid S=s) = \\mathbb{P}(\\hat{Y}=1 \\mid Y=1, S=s)\\mathbb{P}(Y=1 \\mid S=s) = tpr \\cdot p_s\n$$\n站点 $s$ 的假阳性治疗概率为：\n$$\n\\mathbb{P}(Y=0, \\hat{Y}=1 \\mid S=s) = \\mathbb{P}(\\hat{Y}=1 \\mid Y=0, S=s)\\mathbb{P}(Y=0 \\mid S=s) = fpr \\cdot (1 - p_s)\n$$\n将这些代入效用公式，得到：\n$$\nu_s = b \\cdot tpr \\cdot p_s - h \\cdot fpr \\cdot (1 - p_s)\n$$\n\n**4. 差异性度量**\n\n在为每个站点 $s \\in \\{A, B\\}$ 建立了 $\\tau_s$、$\\pi_s$ 和 $u_s$ 的公式之后，差异性度量被计算为站点间的绝对差异：\n- 治疗率的绝对差异：$\\Delta_{\\tau} = \\lvert \\tau_A - \\tau_B \\rvert$\n- 阳性预测值的绝对差异：$\\Delta_{\\pi} = \\lvert \\pi_A - \\pi_B \\rvert$\n- 预期效用的绝对差异：$\\Delta_{u} = \\lvert u_A - u_B \\rvert$\n\n这些公式被实现以计算每个指定测试用例所需的向量 $[\\Delta_{\\tau}, \\Delta_{\\pi}, \\Delta_{u}]$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates and prints disparity metrics for a series of test cases based on a\n    probabilistic model of AI-driven clinical decisions.\n    \"\"\"\n    test_cases = [\n        # (tpr, fpr, p_A, p_B, b, h)\n        (0.85, 0.10, 0.20, 0.25, 1.0, 0.2),\n        (0.85, 0.10, 0.20, 0.20, 1.0, 0.2),\n        (0.90, 0.05, 0.02, 0.03, 1.0, 0.1),\n        (0.95, 0.01, 0.50, 0.55, 1.0, 0.5),\n        (0.70, 0.30, 0.98, 0.99, 1.0, 0.4),\n        (0.00, 0.00, 0.40, 0.60, 1.0, 1.0),\n        (0.80, 0.00, 0.10, 0.30, 1.0, 0.2),\n    ]\n\n    def calculate_site_metrics(tpr, fpr, p, b, h):\n        \"\"\"\n        Calculates treatment rate, PPV, and expected utility for a single site.\n\n        Args:\n            tpr (float): True Positive Rate.\n            fpr (float): False Positive Rate.\n            p (float): Disease prevalence at the site.\n            b (float): Benefit for a true positive.\n            h (float): Harm for a false positive.\n\n        Returns:\n            tuple: A tuple containing (tau, pi, u).\n        \"\"\"\n        # Treatment Rate (tau_s)\n        tau = tpr * p + fpr * (1.0 - p)\n        \n        # Positive Predictive Value (pi_s)\n        # Handle division by zero as specified\n        if tau == 0.0:\n            pi = 0.0\n        else:\n            pi = (tpr * p) / tau\n            \n        # Expected Net Utility (u_s)\n        u = b * tpr * p - h * fpr * (1.0 - p)\n        \n        return tau, pi, u\n\n    all_results = []\n    for case in test_cases:\n        tpr, fpr, p_A, p_B, b, h = case\n        \n        # Calculate metrics for site A\n        tau_A, pi_A, u_A = calculate_site_metrics(tpr, fpr, p_A, b, h)\n        \n        # Calculate metrics for site B\n        tau_B, pi_B, u_B = calculate_site_metrics(tpr, fpr, p_B, b, h)\n        \n        # Calculate disparity metrics\n        delta_tau = np.abs(tau_A - tau_B)\n        delta_pi = np.abs(pi_A - pi_B)\n        delta_u = np.abs(u_A - u_B)\n        \n        result_vector = [delta_tau, delta_pi, delta_u]\n        all_results.append(result_vector)\n\n    # Format the output string as per the problem specification.\n    # Each number is rounded to 6 decimal places.\n    # The final output is a list of lists: [[v11,v12,v13],[v21,v22,v23],...]\n    formatted_results = []\n    for res_vec in all_results:\n        formatted_vec = [f\"{x:.6f}\" for x in res_vec]\n        formatted_results.append(f\"[{','.join(formatted_vec)}]\")\n        \n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}