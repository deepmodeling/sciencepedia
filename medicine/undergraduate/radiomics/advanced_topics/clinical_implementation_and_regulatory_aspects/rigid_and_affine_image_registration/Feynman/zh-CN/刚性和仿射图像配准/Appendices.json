{
    "hands_on_practices": [
        {
            "introduction": "在图像配准中，我们经常需要组合多个基本变换（如旋转和平移）来实现复杂的对齐。一个常见且关键的问题是：变换的顺序会影响最终结果吗？本练习将通过一个具体的计算，让你亲手验证旋转和平移的组合不满足交换律，即先旋转后平移与先平移后旋转会得到不同的结果。理解这一点对于正确构建和应用变换序列至关重要。",
            "id": "4559305",
            "problem": "在二维放射组学配准的背景下，假设一个刚性变换由一个绕原点的旋转和一个平移定义，每个都用齐次坐标表示。刚性变换是仿射变换的一个特例，其旋转矩阵是正交的且行列式等于 $1$，并带有一个平移向量。该问题的基础由以下经过充分验证的事实构成：变换的复合对应于矩阵乘法，而齐次坐标将仿射映射表示为对增广向量的线性变换。\n\n设 $T_{1}$ 是一个绕原点旋转角度 $\\theta$ 的旋转，用齐次坐标表示为矩阵\n$$\nT_{1} \\;=\\;\n\\begin{pmatrix}\n\\cos(\\theta)  -\\sin(\\theta)  0 \\\\\n\\sin(\\theta)  \\cos(\\theta)  0 \\\\\n0  0  1\n\\end{pmatrix},\n$$\n并设 $T_{2}$ 是一个按向量 $(t_{x}, t_{y})$ 的平移，表示为\n$$\nT_{2} \\;=\\;\n\\begin{pmatrix}\n1  0  t_{x} \\\\\n0  1  t_{y} \\\\\n0  0  1\n\\end{pmatrix}.\n$$\n将图像点 $p = (x_{0}, y_{0})$ 视为齐次列向量 $p_{h} = (x_{0}, y_{0}, 1)^{\\top}$。使用上述定义，计算变换后的点 $p_{12} = T_{1} T_{2} p_{h}$（对应于先应用 $T_{2}$ 后应用 $T_{1}$）和变换后的点 $p_{21} = T_{2} T_{1} p_{h}$（对应于先应用 $T_{1}$ 后应用 $T_{2}$），使用以下特定参数\n$$\n\\theta = \\frac{\\pi}{4} \\text{ radians}, \\quad t_{x} = 3, \\quad t_{y} = -2, \\quad x_{0} = 1, \\quad y_{0} = 2.\n$$\n然后，计算平方欧几里得距离\n$$\n\\|p_{12} - p_{21}\\|^{2} \\;=\\; (x_{12} - x_{21})^{2} + (y_{12} - y_{21})^{2},\n$$\n其中 $(x_{12}, y_{12})$ 和 $(x_{21}, y_{21})$ 分别是 $p_{12}$ 和 $p_{21}$ 的笛卡尔坐标分量。\n\n将你的最终答案表示为一个最简根式形式的精确实数。角度必须以弧度处理。不需要四舍五入。使用计算出的值简要论证在这种情况下复合是否是可交换的，但最终的数值答案必须是 $\\|p_{12} - p_{21}\\|^{2}$ 的单个值。",
            "solution": "问题陈述经核实具有科学依据、问题明确、客观且完整。它描述了在几何变换领域中使用齐次坐标的一个标准计算，提供了所有必要的定义和参数。未发现任何缺陷。\n\n问题要求计算通过以不同顺序应用旋转和平移得到的两个点之间的平方欧几里得距离。一个点 $p=(x_0, y_0)$ 由齐次列向量 $p_h = (x_0, y_0, 1)^{\\top}$ 表示。\n\n给定的变换是一个旋转 $T_1$ 和一个平移 $T_2$。\n绕原点旋转角度 $\\theta$ 的旋转由以下公式给出：\n$$\nT_{1} =\n\\begin{pmatrix}\n\\cos(\\theta)  -\\sin(\\theta)  0 \\\\\n\\sin(\\theta)  \\cos(\\theta)  0 \\\\\n0  0  1\n\\end{pmatrix}\n$$\n按向量 $(t_x, t_y)$ 的平移由以下公式给出：\n$$\nT_{2} =\n\\begin{pmatrix}\n1  0  t_{x} \\\\\n0  1  t_{y} \\\\\n0  0  1\n\\end{pmatrix}\n$$\n具体参数为 $\\theta = \\frac{\\pi}{4}$ 弧度，$t_x = 3$，$t_y = -2$，点为 $p_0 = (1, 2)$，因此 $p_h = (1, 2, 1)^{\\top}$。\n\n首先，我们将 $\\theta$ 的值代入旋转矩阵 $T_1$。我们有 $\\cos(\\frac{\\pi}{4}) = \\frac{\\sqrt{2}}{2}$ 和 $\\sin(\\frac{\\pi}{4}) = \\frac{\\sqrt{2}}{2}$。\n$$\nT_{1} =\n\\begin{pmatrix}\n\\frac{\\sqrt{2}}{2}  -\\frac{\\sqrt{2}}{2}  0 \\\\\n\\frac{\\sqrt{2}}{2}  \\frac{\\sqrt{2}}{2}  0 \\\\\n0  0  1\n\\end{pmatrix}\n$$\n给定值的平移矩阵 $T_2$ 是：\n$$\nT_{2} =\n\\begin{pmatrix}\n1  0  3 \\\\\n0  1  -2 \\\\\n0  0  1\n\\end{pmatrix}\n$$\n齐次坐标中的点是 $p_h = \\begin{pmatrix} 1 \\\\ 2 \\\\ 1 \\end{pmatrix}$。\n\n我们需要计算变换后的点 $p_{12} = T_1 T_2 p_h$ 和 $p_{21} = T_2 T_1 p_h$。矩阵乘法的顺序是从右到左，所以 $T_1 T_2 p_h$ 表示先应用 $T_2$，然后应用 $T_1$。\n\n让我们分析作用在笛卡尔坐标点 $P_0=(x_0, y_0)$ 上的变换的一般形式。变换 $p_{12} = T_1 T_2 p_h$ 对应于“先平移，后旋转”。在笛卡尔坐标中，这是 $P_{12} = R(P_0 + t)$，其中 $R$ 是 $2 \\times 2$ 的旋转矩阵， $t$ 是平移向量 $(t_x, t_y)^{\\top}$。\n变换 $p_{21} = T_2 T_1 p_h$ 对应于“先旋转，后平移”。在笛卡尔坐标中，这是 $P_{21} = R P_0 + t$。\n\n两个结果笛卡尔点之间的向量差是：\n$$\nP_{12} - P_{21} = (R(P_0 + t)) - (R P_0 + t) = R P_0 + R t - R P_0 - t = R t - t = (R - I) t\n$$\n其中 $I$ 是 $2 \\times 2$ 的单位矩阵。值得注意的是，得到的差向量与初始点 $P_0$ 无关。\n\n平方欧几里得距离是这个差向量的范数的平方：$\\|(R - I)t\\|^2$。\n我们来计算这个量。\n旋转矩阵是 $R = \\begin{pmatrix} \\frac{\\sqrt{2}}{2}  -\\frac{\\sqrt{2}}{2} \\\\ \\frac{\\sqrt{2}}{2}  \\frac{\\sqrt{2}}{2} \\end{pmatrix}$。\n平移向量是 $t = \\begin{pmatrix} 3 \\\\ -2 \\end{pmatrix}$。\n单位矩阵是 $I = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$。\n\n首先，计算矩阵 $R - I$：\n$$\nR - I =\n\\begin{pmatrix}\n\\frac{\\sqrt{2}}{2}  -\\frac{\\sqrt{2}}{2} \\\\\n\\frac{\\sqrt{2}}{2}  \\frac{\\sqrt{2}}{2}\n\\end{pmatrix} -\n\\begin{pmatrix}\n1  0 \\\\\n0  1\n\\end{pmatrix} =\n\\begin{pmatrix}\n\\frac{\\sqrt{2}}{2} - 1  -\\frac{\\sqrt{2}}{2} \\\\\n\\frac{\\sqrt{2}}{2}  \\frac{\\sqrt{2}}{2} - 1\n\\end{pmatrix}\n$$\n接下来，计算向量 $(R-I)t$：\n$$\n(R-I)t =\n\\begin{pmatrix}\n\\frac{\\sqrt{2}}{2} - 1  -\\frac{\\sqrt{2}}{2} \\\\\n\\frac{\\sqrt{2}}{2}  \\frac{\\sqrt{2}}{2} - 1\n\\end{pmatrix}\n\\begin{pmatrix}\n3 \\\\\n-2\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n3(\\frac{\\sqrt{2}}{2} - 1) - (-2)(\\frac{\\sqrt{2}}{2}) \\\\\n3(\\frac{\\sqrt{2}}{2}) + (-2)(\\frac{\\sqrt{2}}{2} - 1)\n\\end{pmatrix}\n$$\n$$\n=\n\\begin{pmatrix}\n\\frac{3\\sqrt{2}}{2} - 3 + \\frac{2\\sqrt{2}}{2} \\\\\n\\frac{3\\sqrt{2}}{2} - \\frac{2\\sqrt{2}}{2} + 2\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{5\\sqrt{2}}{2} - 3 \\\\\n\\frac{\\sqrt{2}}{2} + 2\n\\end{pmatrix}\n$$\n该向量表示 $(x_{12} - x_{21}, y_{12} - y_{21})^{\\top}$。\n\n最后，我们计算平方欧几里得距离，即该向量各分量平方的和：\n$$\n\\|p_{12} - p_{21}\\|^2 = \\left( \\frac{5\\sqrt{2}}{2} - 3 \\right)^2 + \\left( \\frac{\\sqrt{2}}{2} + 2 \\right)^2\n$$\n我们展开每一项：\n$$\n\\left( \\frac{5\\sqrt{2}}{2} - 3 \\right)^2 = \\left(\\frac{5\\sqrt{2}}{2}\\right)^2 - 2 \\left(\\frac{5\\sqrt{2}}{2}\\right)(3) + 3^2 = \\frac{25 \\cdot 2}{4} - 15\\sqrt{2} + 9 = \\frac{50}{4} - 15\\sqrt{2} + 9 = \\frac{25}{2} + 9 - 15\\sqrt{2} = \\frac{43}{2} - 15\\sqrt{2}\n$$\n$$\n\\left( \\frac{\\sqrt{2}}{2} + 2 \\right)^2 = \\left(\\frac{\\sqrt{2}}{2}\\right)^2 + 2 \\left(\\frac{\\sqrt{2}}{2}\\right)(2) + 2^2 = \\frac{2}{4} + 2\\sqrt{2} + 4 = \\frac{1}{2} + 4 + 2\\sqrt{2} = \\frac{9}{2} + 2\\sqrt{2}\n$$\n将两个结果相加：\n$$\n\\|p_{12} - p_{21}\\|^2 = \\left( \\frac{43}{2} - 15\\sqrt{2} \\right) + \\left( \\frac{9}{2} + 2\\sqrt{2} \\right) = \\frac{43+9}{2} + (-15+2)\\sqrt{2} = \\frac{52}{2} - 13\\sqrt{2} = 26 - 13\\sqrt{2}\n$$\n平方欧几里得距离是 $26 - 13\\sqrt{2}$。\n\n关于复合的交换性：由于 $\\|p_{12} - p_{21}\\|^2 = 26 - 13\\sqrt{2} \\approx 26 - 13(1.414) = 7.618 \\neq 0$，点 $p_{12}$ 和 $p_{21}$ 不相同。这表明对于给定的点 $p_h$，$T_1 T_2 p_h \\neq T_2 T_1 p_h$。因此，这个特定的旋转和平移变换的复合是不可交换的。总的来说，只有当平移向量为零或旋转是单位变换时，旋转和平移的复合才是可交换的。",
            "answer": "$$\\boxed{26 - 13\\sqrt{2}}$$"
        },
        {
            "introduction": "图像配准模型主要分为刚性变换和仿射变换。选择哪种模型取决于我们期望在图像间保持哪些几何属性。本练习将揭示这两种变换的本质区别：刚性变换保持物体的形状和大小，而仿射变换则允许更灵活的形变，如拉伸和剪切。我们将通过一个实例，展示一个简单的仿射变换如何将一个完美的球体变成一个椭球体——这是任何刚性变换都无法完成的任务。",
            "id": "4559313",
            "problem": "在一个三维放射组学配准场景中，考虑一个分割后的病灶，其在源图像中的真实形状可被建模为一个以原点为中心、半径为 $r$ 的球面，由集合 $S_{r} = \\{ \\mathbf{x} \\in \\mathbb{R}^{3} : \\| \\mathbf{x} \\|_{2} = r \\}$ 给出。刚性变换定义为 $\\mathcal{R}(\\mathbf{x}) = \\mathbf{R}\\mathbf{x} + \\mathbf{t}$，其中 $\\mathbf{R} \\in \\mathbb{R}^{3 \\times 3}$ 满足 $\\mathbf{R}^{\\top}\\mathbf{R} = \\mathbf{I}$ 和 $\\det(\\mathbf{R}) = 1$；仿射变换定义为 $\\mathcal{A}(\\mathbf{x}) = \\mathbf{A}\\mathbf{x} + \\mathbf{b}$，其中 $\\mathbf{A} \\in \\mathbb{R}^{3 \\times 3}$ 是可逆矩阵。在对齐一个表现出各向异性体素缩放的目标图像的背景下，请您构建一个反例，以区分仿射配准与刚性配准的表示能力。\n\n请完成以下任务：\n\n1. 仅使用上述核心定义和欧几里得范数性质，取特定的各向异性线性映射 $\\mathbf{A} = \\mathrm{diag}(2, 1, 1)$ 和平移 $\\mathbf{b} = \\mathbf{0}$。推导由 $\\mathbf{y} = \\mathcal{A}(\\mathbf{x})$（其中 $\\mathbf{x} \\in S_{r}$）满足的隐式二次型，并证明其图像是一个主半轴与坐标轴对齐的椭球体。\n\n2. 仅使用刚性变换的保长度性质，通过反证法论证不存在任何刚性变换能将球面 $S_{r}$ 映射到您在第1部分中得到的椭球体上。\n\n3. 考虑第1部分中得到的椭球体在 $z = 0$ 处的平面截面，这是一个在 $x$–$y$ 平面上的椭圆。计算此椭圆的离心率 $e$，其定义为 $e = \\sqrt{1 - \\frac{b^{2}}{a^{2}}}$，其中 $a$ 和 $b$ 分别是椭圆的长半轴和短半轴。以精确表达式给出最终答案，不进行四舍五入，不带单位。最终答案仅提供 $e$ 的值。",
            "solution": "问题陈述是线性代数和几何学中的一个有效练习，展示了刚性变换和仿射变换在表示能力上的差异，这是图像配准中的一个基本概念。所提供的定义是标准的，任务是适定的且在数学上是严谨的。我们将进行一个严谨的、分步的解答。\n\n问题将源对象定义为一个以原点为中心、半径为 $r$ 的球面 $S_r$，由点集 $\\mathbf{x} = (x_1, x_2, x_3)^{\\top} \\in \\mathbb{R}^{3}$ 给出，这些点的欧几里得范数的平方为常数：\n$$\n\\|\\mathbf{x}\\|_{2}^{2} = x_1^{2} + x_2^{2} + x_3^{2} = r^{2}\n$$\n\n**第1部分：仿射变换后形状的推导**\n\n给定一个特定的仿射变换 $\\mathcal{A}(\\mathbf{x}) = \\mathbf{A}\\mathbf{x} + \\mathbf{b}$，其线性映射为 $\\mathbf{A} = \\mathrm{diag}(2, 1, 1)$，平移向量为 $\\mathbf{b} = \\mathbf{0}$。设 $\\mathbf{y} = (y_1, y_2, y_3)^{\\top}$ 是变换后集合中的一个点，使得对于某个 $\\mathbf{x} \\in S_r$，有 $\\mathbf{y} = \\mathcal{A}(\\mathbf{x})$。当 $\\mathbf{b} = \\mathbf{0}$ 时，这简化为 $\\mathbf{y} = \\mathbf{A}\\mathbf{x}$。\n\n由于矩阵 $\\mathbf{A}$ 如下所示：\n$$\n\\mathbf{A} = \\begin{pmatrix} 2  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n$\\mathbf{y}$ 和 $\\mathbf{x}$ 的分量之间的关系是：\n$$\ny_1 = 2x_1, \\quad y_2 = x_2, \\quad y_3 = x_3\n$$\n为了找到 $\\mathbf{y}$ 的分量所满足的隐式方程，我们必须用 $\\mathbf{y}$ 的分量来表示 $\\mathbf{x}$ 的分量，然后将它们代入球面 $S_r$ 的方程中。矩阵 $\\mathbf{A}$ 是可逆的，其逆矩阵为 $\\mathbf{A}^{-1} = \\mathrm{diag}(1/2, 1, 1)$。因此，$\\mathbf{x} = \\mathbf{A}^{-1}\\mathbf{y}$，可得：\n$$\nx_1 = \\frac{1}{2}y_1, \\quad x_2 = y_2, \\quad x_3 = y_3\n$$\n将这些表达式代入球面方程 $x_1^{2} + x_2^{2} + x_3^{2} = r^{2}$，我们得到变换后曲面的方程：\n$$\n\\left(\\frac{y_1}{2}\\right)^{2} + (y_2)^{2} + (y_3)^{2} = r^{2}\n$$\n这可以简化为：\n$$\n\\frac{y_1^{2}}{4} + y_2^{2} + y_3^{2} = r^{2}\n$$\n为了将其表示为二次曲面的标准形式，我们两边同除以 $r^{2}$（假设 $r > 0$，这对于一个非零半径的球面是隐含的）：\n$$\n\\frac{y_1^{2}}{4r^{2}} + \\frac{y_2^{2}}{r^{2}} + \\frac{y_3^{2}}{r^{2}} = 1\n$$\n这可以重写为：\n$$\n\\frac{y_1^{2}}{(2r)^{2}} + \\frac{y_2^{2}}{r^{2}} + \\frac{y_3^{2}}{r^{2}} = 1\n$$\n这就是定义一个以原点为中心的椭球体的隐式二次型。该方程只包含 $y_1$、$y_2$ 和 $y_3$ 的平方项，意味着没有交叉乘积项（例如 $y_1y_2$）。这表明椭球体的主轴与坐标轴对齐。主半轴的长度由分母的平方根给出，分别为 $2r$、$r$ 和 $r$。\n\n**第2部分：关于刚性变换不可行性的反证论述**\n\n刚性变换 $\\mathcal{R}(\\mathbf{x}) = \\mathbf{R}\\mathbf{x} + \\mathbf{t}$ 的定义性质是矩阵 $\\mathbf{R}$ 是正交的，即 $\\mathbf{R}^{\\top}\\mathbf{R} = \\mathbf{I}$。此类变换的一个基本性质是它们是等距变换，意即它们保持任意两点之间的欧几里得距离不变。对于任意 $\\mathbf{p}, \\mathbf{q} \\in \\mathbb{R}^{3}$：\n$$\n\\|\\mathcal{R}(\\mathbf{p}) - \\mathcal{R}(\\mathbf{q})\\|_{2} = \\|(\\mathbf{R}\\mathbf{p} + \\mathbf{t}) - (\\mathbf{R}\\mathbf{q} + \\mathbf{t})\\|_{2} = \\|\\mathbf{R}(\\mathbf{p} - \\mathbf{q})\\|_{2} = \\sqrt{(\\mathbf{p} - \\mathbf{q})^{\\top}\\mathbf{R}^{\\top}\\mathbf{R}(\\mathbf{p} - \\mathbf{q})} = \\sqrt{(\\mathbf{p} - \\mathbf{q})^{\\top}\\mathbf{I}(\\mathbf{p} - \\mathbf{q})} = \\|\\mathbf{p} - \\mathbf{q}\\|_{2}\n$$\n这表明距离是保持不变的。我们将使用这个保长度性质来构建一个反证法证明。\n\n为了进行反证，我们假设存在一个刚性变换 $\\mathcal{R}$，它将球面 $S_r$ 映射到第1部分中推导出的椭球体 $E$ 上。\n设 $\\mathbf{x}$ 是球面 $S_r$ 上的任意一点。点 $\\mathbf{x}$ 到球面中心（原点 $\\mathbf{0}$）的距离是 $\\|\\mathbf{x} - \\mathbf{0}\\|_{2} = r$。\n设 $\\mathbf{y} = \\mathcal{R}(\\mathbf{x})$ 是椭球体 $E$ 上的对应点。球心 $\\mathbf{0}$ 被映射到点 $\\mathbf{c} = \\mathcal{R}(\\mathbf{0}) = \\mathbf{R}\\mathbf{0} + \\mathbf{t} = \\mathbf{t}$。\n因为 $\\mathcal{R}$ 是一个等距变换，所以变换后的点 $\\mathbf{y}$ 和变换后的中心 $\\mathbf{c}$ 之间的距离必须与原始点 $\\mathbf{x}$ 和原始中心 $\\mathbf{0}$ 之间的距离相同。\n$$\n\\|\\mathbf{y} - \\mathbf{c}\\|_{2} = \\|\\mathcal{R}(\\mathbf{x}) - \\mathcal{R}(\\mathbf{0})\\|_{2} = \\|\\mathbf{x} - \\mathbf{0}\\|_{2} = r\n$$\n这个等式必须对椭球体 $E$ 上的每一个点 $\\mathbf{y}$ 都成立。方程 $\\|\\mathbf{y} - \\mathbf{c}\\|_{2} = r$ 是以 $\\mathbf{c}$ 为中心、半径为 $r$ 的球面的定义。因此，关于刚性变换将 $S_r$ 映射到 $E$ 的假设意味着 $E$ 必须是一个半径为 $r$ 的球面。\n\n然而，根据第1部分，我们确定了 $E$ 是一个主半轴长度分别为 $2r$、$r$ 和 $r$ 的椭球体。一个曲面是球面的充要条件是其所有主半轴都相等。在我们的情况下，由于 $r > 0$，我们有 $2r \\neq r$。因此，椭球体 $E$ 不是一个球面。\n\n这导致了一个矛盾：我们的假设意味着 $E$ 必须是一个球面，但 $E$ 的性质表明它不是一个球面。因此，最初的假设必定是错误的。没有任何刚性变换可以将球面 $S_r$ 映射到椭球体 $E$ 上。\n\n**第3部分：离心率的计算**\n\n我们被要求计算椭球体在 $z = 0$ 处的平面截面的离心率。在我们的坐标系中，这对应于设 $y_3 = 0$。使用第1部分中的椭球体方程：\n$$\n\\frac{y_1^{2}}{(2r)^{2}} + \\frac{y_2^{2}}{r^{2}} + \\frac{y_3^{2}}{r^{2}} = 1\n$$\n令 $y_3=0$ 得到在 $y_1$-$y_2$ 平面上的截面方程：\n$$\n\\frac{y_1^{2}}{(2r)^{2}} + \\frac{y_2^{2}}{r^{2}} = 1\n$$\n这是以原点为中心的椭圆的标准方程。半轴是分母的平方根。\n沿 $y_1$ 轴的半轴是 $\\sqrt{(2r)^{2}} = 2r$。\n沿 $y_2$ 轴的半轴是 $\\sqrt{r^{2}} = r$。\n\n长半轴（记为 $a$）是两者中较长的一个，短半轴（记为 $b$）是较短的一个。由于 $r > 0$，我们有 $2r > r$。因此：\n- 长半轴：$a = 2r$\n- 短半轴：$b = r$\n\n椭圆的离心率 $e$ 由公式 $e = \\sqrt{1 - \\frac{b^{2}}{a^{2}}}$ 给出。代入 $a$ 和 $b$ 的值：\n$$\ne = \\sqrt{1 - \\frac{r^{2}}{(2r)^{2}}} = \\sqrt{1 - \\frac{r^{2}}{4r^{2}}}\n$$\n分数中的 $r^{2}$ 项被消去：\n$$\ne = \\sqrt{1 - \\frac{1}{4}} = \\sqrt{\\frac{3}{4}}\n$$\n化简表达式得到离心率的最终精确值：\n$$\ne = \\frac{\\sqrt{3}}{2}\n$$",
            "answer": "$$\\boxed{\\frac{\\sqrt{3}}{2}}$$"
        },
        {
            "introduction": "在将抽象的数学变换应用于实际的医学图像时，我们必须处理一个关键细节：像素坐标（或索引空间）与物理空间之间的差异。由于成像设备和扫描协议的原因，体素在不同维度上可能具有不同的物理尺寸（即各向异性）。本练习将探讨在这种情况下，直接在索引空间中进行旋转为何会导致物理上的形状扭曲，并指导你推导出正确的变换方法，以确保几何操作在真实的物理空间中得以忠实执行。",
            "id": "4559278",
            "problem": "在放射组学工作流程中，刚性和仿射图像配准必须遵循物理空间的欧几里得几何，而非体素索引的隐式网格。考虑一个三维图像体积，其沿坐标轴的体素间距是各向异性的，由 $s_{x}$、$s_{y}$ 和 $s_{z}$（单位：毫米）给出。索引空间坐标用 $\\mathbf{i} \\in \\mathbb{R}^{3}$ 表示，物理空间坐标由 $\\mathbf{x} = \\mathbf{S}\\,\\mathbf{i}$ 给出，其中 $\\mathbf{S} = \\mathrm{diag}(s_{x}, s_{y}, s_{z})$。假设希望在物理空间中围绕 $z$ 轴应用一个角度为 $\\theta$ 的刚性旋转。\n\n一种朴素的实现方式是直接在索引空间中应用旋转矩阵 $\\mathbf{R}_{z}(\\theta)$，将 $\\mathbf{i}$ 映射为 $\\mathbf{R}_{z}(\\theta)\\,\\mathbf{i}$，然后转换为物理空间。相比之下，正确的实现方式是在物理空间中应用旋转，或者等效地，构造一个与物理旋转一致的、校正后的索引空间仿射变换。\n\n仅使用物理空间中欧几里得范数的定义、索引到物理空间的映射 $\\mathbf{x} = \\mathbf{S}\\,\\mathbf{i}$ 以及物理空间中的刚性旋转保持欧几里得长度不变的性质，完成以下任务：\n\n1. 对于索引空间单位向量 $\\mathbf{v} = (1, 0, 0)^{\\top}$ 和一个围绕 $z$ 轴旋转角度 $\\theta$ 的操作，请从第一性原理出发，推导朴素变换后向量的物理空间长度与原始物理空间长度之比 $r(\\theta)$ 的表达式。您的推导必须从 $\\mathbf{x} = \\mathbf{S}\\,\\mathbf{i}$ 和欧几里得范数开始，并且除了这些定义之外，不得假定任何专门的公式。\n\n2. 推导校正后的索引空间线性变换矩阵 $\\mathbf{M}$。当将此矩阵应用于索引坐标（即 $\\mathbf{i} \\mapsto \\mathbf{M}\\,\\mathbf{i}$）时，其产生的物理空间效果与在物理空间中应用 $\\mathbf{R}_{z}(\\theta)$ 相同。请根据定义证明，这个校正后的变换保持了 $\\mathbf{v}$ 的物理长度。\n\n3. 对于 $s_{x} = 0.8$ 毫米，$s_{y} = 2.0$ 毫米以及 $\\theta = 30$ 度，计算畸变幅度 $d = r(\\theta) - 1$。将最终答案表示为一个无量纲数，并四舍五入到四位有效数字。按要求以度为单位说明角度；在最终的数值计算中无需进行单位转换。",
            "solution": "该问题被验证为科学上合理、适定、客观且完整。所需推导和计算的所有必要数据和定义均已提供。所涉及的概念是医学图像分析和线性代数的基础。\n\n解答按照题目要求分为三个部分呈现。\n\n### 第1部分：比率 $r(\\theta)$ 的推导\n\n设索引空间坐标为 $\\mathbf{i} = (i_x, i_y, i_z)^{\\top}$，物理空间坐标为 $\\mathbf{x} = (x, y, z)^{\\top}$。它们之间的映射由 $\\mathbf{x} = \\mathbf{S}\\,\\mathbf{i}$ 给出，其中 $\\mathbf{S}$ 是对角缩放矩阵 $\\mathbf{S} = \\mathrm{diag}(s_{x}, s_{y}, s_{z})$。向量 $\\mathbf{u} = (u_1, u_2, u_3)^{\\top}$ 的欧几里得范数为 $\\|\\mathbf{u}\\| = \\sqrt{u_1^2 + u_2^2 + u_3^2}$。\n\n初始索引空间向量给定为 $\\mathbf{i}_{\\text{orig}} = \\mathbf{v} = (1, 0, 0)^{\\top}$。\n对应的原始物理空间向量 $\\mathbf{x}_{\\text{orig}}$ 通过应用缩放矩阵 $\\mathbf{S}$ 得到：\n$$\n\\mathbf{x}_{\\text{orig}} = \\mathbf{S}\\,\\mathbf{i}_{\\text{orig}} = \\begin{pmatrix} s_x  0  0 \\\\ 0  s_y  0 \\\\ 0  0  s_z \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} s_x \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n这个原始向量的物理空间长度（欧几里得范数）是：\n$$\n\\|\\mathbf{x}_{\\text{orig}}\\| = \\sqrt{s_x^2 + 0^2 + 0^2} = s_x\n$$\n（我们假设 $s_x > 0$，因为它代表物理间距）。\n\n朴素的实现方式是直接在索引空间中应用旋转。围绕 $z$ 轴旋转角度 $\\theta$ 的旋转矩阵是：\n$$\n\\mathbf{R}_{z}(\\theta) = \\begin{pmatrix} \\cos\\theta  -\\sin\\theta  0 \\\\ \\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n朴素变换后的索引空间向量 $\\mathbf{i}_{\\text{naive}}$ 是：\n$$\n\\mathbf{i}_{\\text{naive}} = \\mathbf{R}_{z}(\\theta)\\,\\mathbf{i}_{\\text{orig}} = \\begin{pmatrix} \\cos\\theta  -\\sin\\theta  0 \\\\ \\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\\\ 0 \\end{pmatrix}\n$$\n这个朴素变换后的索引空间向量接着被转换到物理空间，得到 $\\mathbf{x}_{\\text{naive}}$：\n$$\n\\mathbf{x}_{\\text{naive}} = \\mathbf{S}\\,\\mathbf{i}_{\\text{naive}} = \\begin{pmatrix} s_x  0  0 \\\\ 0  s_y  0 \\\\ 0  0  s_z \\end{pmatrix} \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} s_x \\cos\\theta \\\\ s_y \\sin\\theta \\\\ 0 \\end{pmatrix}\n$$\n这个朴素变换后向量的物理空间长度是：\n$$\n\\|\\mathbf{x}_{\\text{naive}}\\| = \\sqrt{(s_x \\cos\\theta)^2 + (s_y \\sin\\theta)^2 + 0^2} = \\sqrt{s_x^2 \\cos^2\\theta + s_y^2 \\sin^2\\theta}\n$$\n比率 $r(\\theta)$ 是朴素变换后向量的物理空间长度除以原始物理空间长度：\n$$\nr(\\theta) = \\frac{\\|\\mathbf{x}_{\\text{naive}}\\|}{\\|\\mathbf{x}_{\\text{orig}}\\|} = \\frac{\\sqrt{s_x^2 \\cos^2\\theta + s_y^2 \\sin^2\\theta}}{s_x}\n$$\n这可以简化为：\n$$\nr(\\theta) = \\sqrt{\\frac{s_x^2 \\cos^2\\theta + s_y^2 \\sin^2\\theta}{s_x^2}} = \\sqrt{\\cos^2\\theta + \\left(\\frac{s_y}{s_x}\\right)^2 \\sin^2\\theta}\n$$\n\n### 第2部分：校正变换矩阵 $\\mathbf{M}$ 的推导\n\n正确的实现方式是在物理空间中应用旋转。设 $\\mathbf{x}$ 是一个对应于索引空间向量 $\\mathbf{i}$ 的物理空间向量（因此 $\\mathbf{x} = \\mathbf{S}\\mathbf{i}$）。正确旋转后的物理空间向量 $\\mathbf{x}_{\\text{corr}}$ 是：\n$$\n\\mathbf{x}_{\\text{corr}} = \\mathbf{R}_{z}(\\theta)\\,\\mathbf{x} = \\mathbf{R}_{z}(\\theta)(\\mathbf{S}\\mathbf{i})\n$$\n我们寻求一个校正后的索引空间变换矩阵 $\\mathbf{M}$，使得新的索引空间向量 $\\mathbf{i}_{\\text{corr}} = \\mathbf{M}\\mathbf{i}$ 映射到正确旋转后的物理向量 $\\mathbf{x}_{\\text{corr}}$。即 $\\mathbf{x}_{\\text{corr}} = \\mathbf{S}\\mathbf{i}_{\\text{corr}} = \\mathbf{S}(\\mathbf{M}\\mathbf{i})$。\n\n令 $\\mathbf{x}_{\\text{corr}}$ 的两个表达式相等：\n$$\n\\mathbf{S}\\mathbf{M}\\mathbf{i} = \\mathbf{R}_{z}(\\theta)\\mathbf{S}\\mathbf{i}\n$$\n由于这对任意向量 $\\mathbf{i}$ 都必须成立，我们可以令矩阵相等：\n$$\n\\mathbf{S}\\mathbf{M} = \\mathbf{R}_{z}(\\theta)\\mathbf{S}\n$$\n为了求解 $\\mathbf{M}$，我们从左侧乘以 $\\mathbf{S}$ 的逆矩阵。由于 $\\mathbf{S}$ 是一个对角元素非零（物理间距）的对角矩阵，其逆矩阵为 $\\mathbf{S}^{-1} = \\mathrm{diag}(1/s_x, 1/s_y, 1/s_z)$。\n$$\n\\mathbf{M} = \\mathbf{S}^{-1}\\mathbf{R}_{z}(\\theta)\\mathbf{S}\n$$\n我们现在显式地计算这个乘积：\n$$\n\\mathbf{M} = \\begin{pmatrix} \\frac{1}{s_x}  0  0 \\\\ 0  \\frac{1}{s_y}  0 \\\\ 0  0  \\frac{1}{s_z} \\end{pmatrix} \\left[ \\begin{pmatrix} \\cos\\theta  -\\sin\\theta  0 \\\\ \\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} s_x  0  0 \\\\ 0  s_y  0 \\\\ 0  0  s_z \\end{pmatrix} \\right]\n$$\n$$\n\\mathbf{M} = \\begin{pmatrix} \\frac{1}{s_x}  0  0 \\\\ 0  \\frac{1}{s_y}  0 \\\\ 0  0  \\frac{1}{s_z} \\end{pmatrix} \\begin{pmatrix} s_x \\cos\\theta  -s_y \\sin\\theta  0 \\\\ s_x \\sin\\theta  s_y \\cos\\theta  0 \\\\ 0  0  s_z \\end{pmatrix}\n$$\n$$\n\\mathbf{M} = \\begin{pmatrix} \\cos\\theta  -\\frac{s_y}{s_x}\\sin\\theta  0 \\\\ \\frac{s_x}{s_y}\\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n这就是校正后的索引空间线性变换矩阵。\n\n为证明该变换保持了 $\\mathbf{v}$ 的物理长度，我们考虑校正变换后物理向量的长度。原始物理向量是 $\\mathbf{x}_{\\text{orig}} = \\mathbf{S}\\mathbf{v}$。其长度为 $\\|\\mathbf{S}\\mathbf{v}\\|$。变换后的物理向量是 $\\mathbf{x}_{\\text{corr}} = \\mathbf{S}(\\mathbf{M}\\mathbf{v})$。根据我们的推导，我们知道 $\\mathbf{S}\\mathbf{M} = \\mathbf{R}_z(\\theta)\\mathbf{S}$，所以我们可以写出：\n$$\n\\mathbf{x}_{\\text{corr}} = (\\mathbf{S}\\mathbf{M})\\mathbf{v} = (\\mathbf{R}_z(\\theta)\\mathbf{S})\\mathbf{v} = \\mathbf{R}_z(\\theta)(\\mathbf{S}\\mathbf{v}) = \\mathbf{R}_z(\\theta)\\mathbf{x}_{\\text{orig}}\n$$\n题目给定，物理空间中的刚性旋转保持欧几里得长度不变。从 $\\mathbf{x}_{\\text{orig}}$到 $\\mathbf{x}_{\\text{corr}}$ 的映射正是在物理空间中应用的刚性旋转 $\\mathbf{R}_z(\\theta)$。因此，根据题目前提：\n$$\n\\|\\mathbf{x}_{\\text{corr}}\\| = \\|\\mathbf{R}_z(\\theta)\\mathbf{x}_{\\text{orig}}\\| = \\|\\mathbf{x}_{\\text{orig}}\\|\n$$\n这证实了校正后的变换保持了向量的物理长度。\n\n### 第3部分：畸变幅度 $d$ 的计算\n\n畸变幅度定义为 $d = r(\\theta) - 1$。使用第1部分中 $r(\\theta)$ 的表达式：\n$$\nd = \\sqrt{\\cos^2\\theta + \\left(\\frac{s_y}{s_x}\\right)^2 \\sin^2\\theta} - 1\n$$\n给定值为 $s_x = 0.8$，$s_y = 2.0$，以及 $\\theta = 30^\\circ$。\n首先，我们计算体素间距的比率：\n$$\n\\frac{s_y}{s_x} = \\frac{2.0}{0.8} = 2.5\n$$\n$\\theta = 30^\\circ$ 的三角函数值为：\n$$\n\\cos(30^\\circ) = \\frac{\\sqrt{3}}{2}, \\quad \\sin(30^\\circ) = \\frac{1}{2}\n$$\n它们的平方是：\n$$\n\\cos^2(30^\\circ) = \\frac{3}{4} = 0.75\n$$\n$$\n\\sin^2(30^\\circ) = \\frac{1}{4} = 0.25\n$$\n将这些值代入 $d$ 的表达式中：\n$$\nd = \\sqrt{0.75 + (2.5)^2 (0.25)} - 1\n$$\n$$\nd = \\sqrt{0.75 + (6.25)(0.25)} - 1\n$$\n$$\nd = \\sqrt{0.75 + 1.5625} - 1\n$$\n$$\nd = \\sqrt{2.3125} - 1\n$$\n计算数值：\n$$\n\\sqrt{2.3125} \\approx 1.5206906...\n$$\n$$\nd \\approx 1.5206906 - 1 = 0.5206906...\n$$\n将最终答案四舍五入到四位有效数字，我们得到：\n$$\nd \\approx 0.5207\n$$\n无量纲的畸变幅度约为 $0.5207$，这对应于约 $52.07\\%$ 的长度增加。",
            "answer": "$$\\boxed{0.5207}$$"
        }
    ]
}